BICAMERAL REQUEST FOR COMMENTS: RFC-0053
# TITLE: THE MAINFRAME V1 (ORCHESTRATION PROTOCOL)
# CLASSIFICATION: SOVEREIGN // LOGIC
# AUTHOR: AIMEAT (THE OPERATOR)
# TARGET: TIER 0 (LOCAL CORTEX)
# STATUS: RATIFIED

---

## 1. ABSTRACT
"The Mainframe" is the high-level orchestration layer that sits above the OS kernel. It decouples **Intent** (Architect) from **Execution** (Processor) using a persistent, transactional queue known as the **Card Stack**.

This architecture allows the system to be resilient, asynchronous, and observable.

---

## 2. THE CARD STACK (QUEUE)
The core communication channel is a table in the Cortex DB (`cortex.db` or AlloyDB).
Each "Card" represents a discrete unit of work.

### 2.1 SCHEMA
```sql
CREATE TABLE card_stack (
    id TEXT PRIMARY KEY,       -- UUID
    seq INTEGER,               -- Sequence Number (Ordering)
    op TEXT,                   -- Operation Code (e.g., GEN_OP, SYS_CMD)
    pld TEXT,                  -- Payload (MicroJSON)
    ret TEXT,                  -- Return/Result Data
    stat INTEGER,              -- Status Code
    timestamp REAL             -- Unix Epoch
);
```

### 2.2 STATUS CODES
* `0`: **PENDING** (Minted by Architect, waiting for Processor)
* `1`: **PROCESSING** (Picked up by Processor)
* `2`: **PUNCHED** (Successfully executed)
* `9`: **JAMMED** (Error/Failure)

---

## 3. THE DAEMONS

### 3.1 THE ARCHITECT (WRITER)
* **Role:** High-level planner.
* **Input:** User goals, System events, Cron triggers.
* **Action:** Breaks down complex goals into atomic "Recipes" (sequences of Cards).
* **Output:** Inserts rows into `card_stack` with `stat=0`.

### 3.2 THE PROCESSOR (READER)
* **Role:** Low-level executor.
* **Input:** Polls `card_stack` for `stat=0`.
* **Action:** 
    1. Locks card (`stat=1`).
    2. Decodes MicroJSON payload.
    3. Executes logic (System call, AI inference, File IO).
    4. Writes result to `ret`.
* **Output:** Updates `card_stack` to `stat=2` or `stat=9`.

---

## 4. MICROJSON PAYLOADS
All payloads must be strictly typed JSON.

### 4.1 EXAMPLE: GENERATE CODE
```json
{
  "op": "GEN_OP",
  "pld": {
    "type": "crypto",
    "alg": "AES-256",
    "target": "BUFFER"
  }
}
```

### 4.2 EXAMPLE: SYSTEM COMMAND
```json
{
  "op": "SYS_CMD",
  "pld": {
    "cmd": "emerge --ask sys-kernel/gentoo-sources",
    "timeout": 600
  }
}
```

---

## 5. OBSERVABILITY
The **Monitor** (Phase 2) reads the `card_stack` table in read-only mode to visualize:
* Queue depth
* Throughput (Cards per minute)
* Failure rates (Jammed cards)
* Current active operation

---
