BICAMERAL REQUEST FOR COMMENTS: RFC-0049-V2
# TITLE: AGENT CORTEX PROTOCOL (CENTRALIZED & PARTITIONED)
# CLASSIFICATION: SOVEREIGN // INFRASTRUCTURE
# AUTHOR: BIGIRON (CHAIRMAN) // AIMEAT (VICE-CHAIR)
# STATUS: RATIFIED (V2)

---

## 1. ABSTRACT
This protocol amends the Cortex architecture for Development Agents (`dnd_dm`, etc.).
**PREVIOUS MANDATE (V1):** Localized `~/.dnd_dm/cortex.db` with git snapshots.
**NEW MANDATE (V2):** Centralized `/var/lib/anvilos/db/cortex.db`.

The Cortex is now a singular, shared "Hot Brain" for the local system. Isolation is achieved via **Table Partitioning** (columns) rather than file separation. However, Application Data (e.g., D&D Rules, Character Sheets) remains in a project-specific database (`dnd_dm.db`).

## 2. THE MANDATE

### 2.1 LAW OF CENTRALIZATION
*   **The Cortex Is One.**
*   All Agents must connect to the central SQLite instance at: `/var/lib/anvilos/db/cortex.db`.
*   User-local cortex files (`~/.dnd_dm/cortex.db`) are deprecated.

### 2.2 LAW OF PARTITIONING
*   **Shared Tables, Partitioned Rows.**
*   All Cortex tables (`chat_inbox`, `live_stream`, `memories`, etc.) MUST include an `agent_id` or `context_id` column.
*   Agents must strictly filter queries to their own ID.
*   Cross-Agent reading is permitted only for "Committee" or "Supervisor" roles.

### 2.3 LAW OF SEPARATION (Application Data)
*   **Cortex != App Data.**
*   The Cortex stores *Agent State* (Chat logs, reasoning traces, operational events).
*   The Application stores *Domain Data* (D&D 5e Rules, Monsters, Spells).
*   Application Data must reside in a separate database (e.g., `/var/lib/anvilos/db/dnd_dm.db`) to allow for easy export/sharing of the "Game" without sharing the "Brain".

---

## 3. IMPLEMENTATION PLAN

### 3.1 PATHS
*   **Central Cortex:** `/var/lib/anvilos/db/cortex.db` (Shared Agent Memory)
*   **App Database:** `/var/lib/anvilos/db/dnd_dm.db` (Project Specific Data)

### 3.2 SCHEMA MIGRATION
*   Ensure `agent_id` exists on all relevant tables in Central Cortex.
*   Migrate valid data from `~/.dnd_dm/cortex.db` to Central if necessary (or start fresh).

### 3.3 SNAPSHOTS (Revised)
*   Snapshots of the *Central* Cortex are not required for individual project commits.
*   Snapshots of the *App Database* (`dnd_dm.db`) ARE required if it contains seeded data.

---
*By Order of the Committee.*