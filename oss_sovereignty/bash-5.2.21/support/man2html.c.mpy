{
  "module_name": "man2html.c",
  "hash_id": "3c918da40d5aad84d6ba7aa8c75bc00e4482bdd5c2df88558c025c7e2a4c8fc2",
  "original_prompt": "Ingested from bash-5.2.21/support/man2html.c",
  "human_readable_source": " \n\n \n#ifdef HAVE_CONFIG_H\n#include <config.h>\n#endif\n\n#define NROFF 0\n\n#include <unistd.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/stat.h>\n#include <ctype.h>\n#include <sys/types.h>\n#include <time.h>\n#include <sys/time.h>\n#include <errno.h>\n\n#define NULL_TERMINATED(n) ((n) + 1)\n\n#define HUGE_STR_MAX  10000\n#define LARGE_STR_MAX 2000\n#define MED_STR_MAX   500\n#define SMALL_STR_MAX 100\n#define TINY_STR_MAX  10\n\n#define MAX_MAN_PATHS 100\t \n#define MAX_ZCATS     10\t \n#define MAX_WORDLIST  100\n\n#ifndef EXIT_SUCCESS\n#define EXIT_SUCCESS 0\n#endif\n#ifndef EXIT_FAILURE\n#define EXIT_FAILURE 1\n#endif\n#ifndef EXIT_USAGE\n#define EXIT_USAGE 2\n#endif\n\nstatic char location_base[NULL_TERMINATED(MED_STR_MAX)] = \"\";\n\nstatic char th_page_and_sec[128] = { '\\0' };\nstatic char th_datestr[128] = { '\\0' };\nstatic char th_version[128] = { '\\0' };\n\nchar   *signature = \"<HR>\\nThis document was created by man2html from %s.<BR>\\nTime: %s\\n\";\n\n \n#define TIMEFORMAT \"%d %B %Y %T %Z\"\n\nchar *manpage;\n\n \n#define BL_DESC_LIST   1\n#define BL_BULLET_LIST 2\n#define BL_ENUM_LIST   4\n\n \n#define BD_LITERAL  1\n#define BD_INDENT   2\n\n#ifndef HAVE_STRERROR\nstatic char *\nstrerror(int e)\n{\n\tstatic char emsg[40];\n\n#if defined (HAVE_SYS_ERRLIST)\n\textern int sys_nerr;\n\textern char *sys_errlist[];\n\n\tif (e > 0 && e < sys_nerr)\n\t\treturn (sys_errlist[e]);\n\telse\n#endif\t\t\t\t \n\t{\n\t\tsprintf(emsg, \"Unknown system error %d\", e);\n\t\treturn (&emsg[0]);\n\t}\n}\n#endif\t\t\t\t \n\nstatic char *\nstrgrow(char *old, int len)\n{\n\tchar   *new = realloc(old, (strlen(old) + len + 1) * sizeof(char));\n\n\tif (!new) {\n\t\tfprintf(stderr, \"man2html: out of memory\");\n\t\texit(EXIT_FAILURE);\n\t}\n\treturn new;\n}\n\nstatic char *\nstralloc(int len)\n{\n\t \n\tchar   *new = malloc((len + 1) * sizeof(char));\n\n\tif (!new) {\n\t\tfprintf(stderr, \"man2html: out of memory\");\n\t\texit(EXIT_FAILURE);\n\t}\n\treturn new;\n}\n\nvoid *\nxmalloc (size_t size)\n{\n\tvoid *ret;\n\n\tret = malloc (size);\n\tif (ret == 0) {\n\t\tfprintf(stderr, \"man2html: out of memory\");\n\t\texit(EXIT_FAILURE);\n\t}\n\treturn ret;\n}\n\n \nstatic char *\nstrduplicate(char *from)\n{\n\tchar   *new = stralloc(strlen(from));\n\n\tstrcpy(new, from);\n\treturn new;\n}\n\n \nstatic char *\nstrmaxcpy(char *to, char *from, int n)\n{\n\tint     len = strlen(from);\n\n\tstrncpy(to, from, n);\n\tto[(len <= n) ? len : n] = '\\0';\n\treturn to;\n}\n\nstatic char *\nstrmaxcat(char *to, char *from, int n)\n{\n\tint     to_len = strlen(to);\n\n\tif (to_len < n) {\n\t\tint     from_len = strlen(from);\n\t\tint     cp = (to_len + from_len <= n) ? from_len : n - to_len;\n\n\t\tstrncpy(to + to_len, from, cp);\n\t\tto[to_len + cp] = '\\0';\n\t}\n\treturn to;\n}\n\n \nstatic char *\nstrlimitcpy(char *to, char *from, int n, int limit)\n{\n\tint     len = n > limit ? limit : n;\n\n\tstrmaxcpy(to, from, len);\n\tto[len] = '\\0';\n\treturn to;\n}\n\n \nstatic char *\nescape_input(char *str)\n{\n\tint     i, j = 0;\n\tstatic char new[NULL_TERMINATED(MED_STR_MAX)];\n\n\tif (strlen(str) * 2 + 1 > MED_STR_MAX) {\n\t\tfprintf(stderr,\n\t\t\t\"man2html: escape_input - str too long:\\n%-80s...\\n\",\n\t\t\tstr);\n\t\texit(EXIT_FAILURE);\n\t}\n\tfor (i = 0; i < strlen(str); i++) {\n\t\tif (!(((str[i] >= 'A') && (str[i] <= 'Z')) ||\n\t\t      ((str[i] >= 'a') && (str[i] <= 'z')) ||\n\t\t      ((str[i] >= '0') && (str[i] <= '9')))) {\n\t\t\tnew[j] = '\\\\';\n\t\t\tj++;\n\t\t}\n\t\tnew[j] = str[i];\n\t\tj++;\n\t}\n\tnew[j] = '\\0';\n\treturn new;\n}\n\nstatic void\nusage(void)\n{\n\tfprintf(stderr, \"man2html: usage: man2html filename\\n\");\n}\n\n\n\n \n\ntypedef struct STRDEF STRDEF;\nstruct STRDEF {\n\tint     nr, slen;\n\tchar   *st;\n\tSTRDEF *next;\n};\n\ntypedef struct INTDEF INTDEF;\nstruct INTDEF {\n\tint     nr;\n\tint     val;\n\tint     incr;\n\tINTDEF *next;\n};\n\nstatic char NEWLINE[2] = \"\\n\";\nstatic char idxlabel[6] = \"ixAAA\";\n\n#define INDEXFILE \"/tmp/manindex.list\"\n\nstatic char *fname;\nstatic FILE *idxfile;\n\nstatic STRDEF *chardef, *strdef, *defdef;\nstatic INTDEF *intdef;\n\n#define V(A,B) ((A)*256+(B))\n\nstatic INTDEF standardint[] = {\n\t{V('n', ' '), NROFF, 0, NULL},\n\t{V('t', ' '), 1 - NROFF, 0, NULL},\n\t{V('o', ' '), 1, 0, NULL},\n\t{V('e', ' '), 0, 0, NULL},\n\t{V('.', 'l'), 70, 0, NULL},\n\t{V('.', '$'), 0, 0, NULL},\n\t{V('.', 'A'), NROFF, 0, NULL},\n\t{V('.', 'T'), 1 - NROFF, 0, NULL},\n\t{V('.', 'V'), 1, 0, NULL},\t \n{0, 0, 0, NULL}};\n\nstatic STRDEF standardstring[] = {\n\t{V('R', ' '), 1, \"&#174;\", NULL},\n\t{V('l', 'q'), 2, \"``\", NULL},\n\t{V('r', 'q'), 2, \"''\", NULL},\n\t{0, 0, NULL, NULL}\n};\n\n\nstatic STRDEF standardchar[] = {\n\t{V('*', '*'), 1, \"*\", NULL},\n\t{V('*', 'A'), 1, \"A\", NULL},\n\t{V('*', 'B'), 1, \"B\", NULL},\n\t{V('*', 'C'), 2, \"Xi\", NULL},\n\t{V('*', 'D'), 5, \"Delta\", NULL},\n\t{V('*', 'E'), 1, \"E\", NULL},\n\t{V('*', 'F'), 3, \"Phi\", NULL},\n\t{V('*', 'G'), 5, \"Gamma\", NULL},\n\t{V('*', 'H'), 5, \"Theta\", NULL},\n\t{V('*', 'I'), 1, \"I\", NULL},\n\t{V('*', 'K'), 1, \"K\", NULL},\n\t{V('*', 'L'), 6, \"Lambda\", NULL},\n\t{V('*', 'M'), 1, \"M\", NULL},\n\t{V('*', 'N'), 1, \"N\", NULL},\n\t{V('*', 'O'), 1, \"O\", NULL},\n\t{V('*', 'P'), 2, \"Pi\", NULL},\n\t{V('*', 'Q'), 3, \"Psi\", NULL},\n\t{V('*', 'R'), 1, \"P\", NULL},\n\t{V('*', 'S'), 5, \"Sigma\", NULL},\n\t{V('*', 'T'), 1, \"T\", NULL},\n\t{V('*', 'U'), 1, \"Y\", NULL},\n\t{V('*', 'W'), 5, \"Omega\", NULL},\n\t{V('*', 'X'), 1, \"X\", NULL},\n\t{V('*', 'Y'), 1, \"H\", NULL},\n\t{V('*', 'Z'), 1, \"Z\", NULL},\n\t{V('*', 'a'), 5, \"alpha\", NULL},\n\t{V('*', 'b'), 4, \"beta\", NULL},\n\t{V('*', 'c'), 2, \"xi\", NULL},\n\t{V('*', 'd'), 5, \"delta\", NULL},\n\t{V('*', 'e'), 7, \"epsilon\", NULL},\n\t{V('*', 'f'), 3, \"phi\", NULL},\n\t{V('*', 'g'), 5, \"gamma\", NULL},\n\t{V('*', 'h'), 5, \"theta\", NULL},\n\t{V('*', 'i'), 4, \"iota\", NULL},\n\t{V('*', 'k'), 5, \"kappa\", NULL},\n\t{V('*', 'l'), 6, \"lambda\", NULL},\n\t{V('*', 'm'), 1, \"&#181;\", NULL},\n\t{V('*', 'n'), 2, \"nu\", NULL},\n\t{V('*', 'o'), 1, \"o\", NULL},\n\t{V('*', 'p'), 2, \"pi\", NULL},\n\t{V('*', 'q'), 3, \"psi\", NULL},\n\t{V('*', 'r'), 3, \"rho\", NULL},\n\t{V('*', 's'), 5, \"sigma\", NULL},\n\t{V('*', 't'), 3, \"tau\", NULL},\n\t{V('*', 'u'), 7, \"upsilon\", NULL},\n\t{V('*', 'w'), 5, \"omega\", NULL},\n\t{V('*', 'x'), 3, \"chi\", NULL},\n\t{V('*', 'y'), 3, \"eta\", NULL},\n\t{V('*', 'z'), 4, \"zeta\", NULL},\n\t{V('t', 's'), 5, \"sigma\", NULL},\n\t{V('+', '-'), 1, \"&#177;\", NULL},\n\t{V('1', '2'), 1, \"&#189;\", NULL},\n\t{V('1', '4'), 1, \"&#188;\", NULL},\n\t{V('3', '4'), 1, \"&#190;\", NULL},\n\t{V('F', 'i'), 3, \"ffi\", NULL},\n\t{V('F', 'l'), 3, \"ffl\", NULL},\n\t{V('a', 'a'), 1, \"&#180;\", NULL},\n\t{V('a', 'p'), 1, \"~\", NULL},\n\t{V('b', 'r'), 1, \"|\", NULL},\n\t{V('b', 'u'), 1, \"*\", NULL},\n\t{V('b', 'v'), 1, \"|\", NULL},\n\t{V('c', 'i'), 1, \"o\", NULL},\n\t{V('c', 'o'), 1, \"&#169;\", NULL},\n\t{V('c', 't'), 1, \"&#162;\", NULL},\n\t{V('d', 'e'), 1, \"&#176;\", NULL},\n\t{V('d', 'g'), 1, \"+\", NULL},\n\t{V('d', 'i'), 1, \"&#247;\", NULL},\n\t{V('e', 'm'), 1, \"-\", NULL},\n\t{V('e', 'm'), 3, \"---\", NULL},\n\t{V('e', 'q'), 1, \"=\", NULL},\n\t{V('e', 's'), 1, \"&#216;\", NULL},\n\t{V('f', 'f'), 2, \"ff\", NULL},\n\t{V('f', 'i'), 2, \"fi\", NULL},\n\t{V('f', 'l'), 2, \"fl\", NULL},\n\t{V('f', 'm'), 1, \"&#180;\", NULL},\n\t{V('g', 'a'), 1, \"`\", NULL},\n\t{V('h', 'y'), 1, \"-\", NULL},\n\t{V('l', 'c'), 2, \"|&#175;\", NULL},\n\t{V('l', 'f'), 2, \"|_\", NULL},\n\t{V('l', 'k'), 1, \"<FONT SIZE=+2>{</FONT>\", NULL},\n\t{V('m', 'i'), 1, \"-\", NULL},\n\t{V('m', 'u'), 1, \"&#215;\", NULL},\n\t{V('n', 'o'), 1, \"&#172;\", NULL},\n\t{V('o', 'r'), 1, \"|\", NULL},\n\t{V('p', 'l'), 1, \"+\", NULL},\n\t{V('r', 'c'), 2, \"&#175;|\", NULL},\n\t{V('r', 'f'), 2, \"_|\", NULL},\n\t{V('r', 'g'), 1, \"&#174;\", NULL},\n\t{V('r', 'k'), 1, \"<FONT SIZE=+2>}</FONT>\", NULL},\n\t{V('r', 'n'), 1, \"&#175;\", NULL},\n\t{V('r', 'u'), 1, \"_\", NULL},\n\t{V('s', 'c'), 1, \"&#167;\", NULL},\n\t{V('s', 'l'), 1, \"/\", NULL},\n\t{V('s', 'q'), 2, \"[]\", NULL},\n\t{V('u', 'l'), 1, \"_\", NULL},\n\t{0, 0, NULL, NULL}\n};\n\n \n\n\nstatic char eqndelimopen = 0, eqndelimclose = 0;\nstatic char escapesym = '\\\\', nobreaksym = '\\'', controlsym = '.', fieldsym = 0, padsym = 0;\n\nstatic char *buffer = NULL;\nstatic int buffpos = 0, buffmax = 0;\nstatic int scaninbuff = 0;\nstatic int itemdepth = 0;\nstatic int dl_set[20] = {0};\nstatic int still_dd = 0;\nstatic int tabstops[20] = {8, 16, 24, 32, 40, 48, 56, 64, 72, 80, 88, 96};\nstatic int maxtstop = 12;\nstatic int curpos = 0;\n\nstatic char *scan_troff(char *c, int san, char **result);\nstatic char *scan_troff_mandoc(char *c, int san, char **result);\n\nstatic char **argument = NULL;\n\nstatic char charb[TINY_STR_MAX];\n\nstatic void\nprint_sig(void)\n{\n\tchar    datbuf[NULL_TERMINATED(MED_STR_MAX)];\n\tstruct tm *timetm;\n\ttime_t  clock;\n\n\tdatbuf[0] = '\\0';\n\tclock = time(NULL);\n\ttimetm = localtime(&clock);\n\tstrftime(datbuf, MED_STR_MAX, TIMEFORMAT, timetm);\n\tprintf(signature, manpage, datbuf);\n}\n\nstatic char *\nexpand_char(int nr)\n{\n\tSTRDEF *h;\n\n\th = chardef;\n\tif (!nr)\n\t\treturn NULL;\n\twhile (h)\n\t\tif (h->nr == nr) {\n\t\t\tcurpos += h->slen;\n\t\t\treturn h->st;\n\t\t} else\n\t\t\th = h->next;\n\tcharb[0] = nr / 256;\n\tcharb[1] = nr % 256;\n\tcharb[2] = '\\0';\n\tif (charb[0] == '<') {\t \n\t\tcharb[4] = charb[1];\n\t\tstrncpy(charb, \"&lt;\", 4);\n\t\tcharb[5] = '\\0';\n\t}\n\tcurpos += 2;\n\treturn charb;\n}\n\nstatic char *\nexpand_string(int nr)\n{\n\tSTRDEF *h = strdef;\n\n\tif (!nr)\n\t\treturn NULL;\n\twhile (h)\n\t\tif (h->nr == nr) {\n\t\t\tcurpos += h->slen;\n\t\t\treturn h->st;\n\t\t} else\n\t\t\th = h->next;\n\treturn NULL;\n}\n\nstatic char *\nread_man_page(char *filename)\n{\n\tchar   *man_buf = NULL;\n\tint     i;\n\tFILE   *man_stream = NULL;\n\tstruct stat stbuf;\n\tint     buf_size;\n\n\tif (stat(filename, &stbuf) == -1)\n\t\treturn NULL;\n\n\tbuf_size = stbuf.st_size;\n\tman_buf = stralloc(buf_size + 5);\n\tman_stream = fopen(filename, \"r\");\n\tif (man_stream) {\n\t\tman_buf[0] = '\\n';\n\t\tif (fread(man_buf + 1, 1, buf_size, man_stream) == buf_size) {\n\t\t\tman_buf[buf_size] = '\\n';\n\t\t\tman_buf[buf_size + 1] = man_buf[buf_size + 2] = '\\0';\n\t\t} else {\n\t\t\tfree(man_buf);\n\t\t\tman_buf = NULL;\n\t\t}\n\t\tfclose(man_stream);\n\t}\n\treturn man_buf;\n}\n\n\nstatic char outbuffer[NULL_TERMINATED(HUGE_STR_MAX)];\nstatic int obp = 0;\nstatic int no_newline_output = 0;\nstatic int newline_for_fun = 0;\nstatic int output_possible = 0;\nstatic int out_length = 0;\n\n \nstatic void\nadd_links(char *c)\n{\n\tint     i, j, nr;\n\tchar   *f, *g, *h;\n\tchar   *idtest[6];\t \n\n\tout_length += strlen(c);\n\t \n\tnr = 0;\n\tidtest[0] = strstr(c + 1, \"://\");\n\tidtest[1] = strchr(c + 1, '@');\n\tidtest[2] = strstr(c, \"www.\");\n\tidtest[3] = strstr(c, \"ftp.\");\n#if 0\n\tidtest[4] = strchr(c + 1, '(');\n#else\n\tidtest[4] = 0;\n#endif\n\tidtest[5] = strstr(c + 1, \".h&gt;\");\n\tfor (i = 0; i < 6; i++)\n\t\tnr += (idtest[i] != NULL);\n\twhile (nr) {\n\t\tj = -1;\n\t\tfor (i = 0; i < 6; i++)\n\t\t\tif (idtest[i] && (j < 0 || idtest[i] < idtest[j]))\n\t\t\t\tj = i;\n\t\tswitch (j) {\n\t\tcase 5:\t \n\t\t\tf = idtest[5];\n\t\t\th = f + 2;\n\t\t\tg = f;\n\t\t\twhile (g > c && g[-1] != ';')\n\t\t\t\tg--;\n\t\t\tif (g != c) {\n\t\t\t\tchar    t;\n\n\t\t\t\tt = *g;\n\t\t\t\t*g = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\t*g = t;\n\t\t\t\t*h = '\\0';\n\t\t\t\tprintf(\"<A HREF=\\\"file:/usr/include/%s\\\">%s</A>&gt;\", g, g);\n\t\t\t\tc = f + 6;\n\t\t\t} else {\n\t\t\t\tf[5] = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\tf[5] = ';';\n\t\t\t\tc = f + 5;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 4:\t \n#if 0\n\t\t\tf = idtest[j];\n\t\t\t \n\t\t\tg = strchr(f, ')');\n\t\t\tif (g && f - g < 6 && (isalnum(f[-1]) || f[-1] == '>') &&\n\t\t\t    ((isdigit(f[1]) && f[1] != '0' &&\n\t\t\t      (f[2] == ')' || (isalpha(f[2]) && f[3] == ')') || f[2] == 'X')) ||\n\t\t\t   (f[2] == ')' && (f[1] == 'n' || f[1] == 'l')))) {\n\t\t\t\t \n\t\t\t\th = f - 1;\n\t\t\t\t \n\t\t\t\twhile (h > c && *h == '>') {\n\t\t\t\t\twhile (h != c && *h != '<')\n\t\t\t\t\t\th--;\n\t\t\t\t\tif (h != c)\n\t\t\t\t\t\th--;\n\t\t\t\t}\n\t\t\t\tif (isalnum(*h)) {\n\t\t\t\t\tchar    t, sec, subsec, *e;\n\n\t\t\t\t\te = h + 1;\n\t\t\t\t\tsec = f[1];\n\t\t\t\t\tsubsec = f[2];\n\t\t\t\t\tif ((subsec == 'X' && f[3] != ')') || subsec == ')')\n\t\t\t\t\t\tsubsec = '\\0';\n\t\t\t\t\twhile (h > c && (isalnum(h[-1]) || h[-1] == '_' ||\n\t\t\t\t\t      h[-1] == '-' || h[-1] == '.'))\n\t\t\t\t\t\th--;\n\t\t\t\t\tt = *h;\n\t\t\t\t\t*h = '\\0';\n\t\t\t\t\tfputs(c, stdout);\n\t\t\t\t\t*h = t;\n\t\t\t\t\tt = *e;\n\t\t\t\t\t*e = '\\0';\n\t\t\t\t\tif (subsec)\n\t\t\t\t\t\tprintf(\"<A HREF=\\\"\"\n\t\t\t\t\t\t       CGIBASE\n\t\t\t\t\t\t  \"?man%c/%s.%c%c\\\">%s</A>\",\n\t\t\t\t\t\t       sec, h, sec, tolower(subsec), h);\n\t\t\t\t\telse\n\t\t\t\t\t\tprintf(\"<A HREF=\\\"\"\n\t\t\t\t\t\t       CGIBASE\n\t\t\t\t\t\t    \"?man%c/%s.%c\\\">%s</A>\",\n\t\t\t\t\t\t       sec, h, sec, h);\n\t\t\t\t\t*e = t;\n\t\t\t\t\tc = e;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*f = '\\0';\n\t\t\tfputs(c, stdout);\n\t\t\t*f = '(';\n\t\t\tidtest[4] = f - 1;\n\t\t\tc = f;\n#endif\n\t\t\tbreak;\t \n\t\tcase 3:\t \n\t\tcase 2:\t \n\t\t\tg = f = idtest[j];\n\t\t\twhile (*g && (isalnum(*g) || *g == '_' || *g == '-' || *g == '+' ||\n\t\t\t\t      *g == '.'))\n\t\t\t\tg++;\n\t\t\tif (g[-1] == '.')\n\t\t\t\tg--;\n\t\t\tif (g - f > 4) {\n\t\t\t\tchar    t;\n\n\t\t\t\tt = *f;\n\t\t\t\t*f = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\t*f = t;\n\t\t\t\tt = *g;\n\t\t\t\t*g = '\\0';\n\t\t\t\tprintf(\"<A HREF=\\\"%s://%s\\\">%s</A>\", (j == 3 ? \"ftp\" : \"http\"),\n\t\t\t\t       f, f);\n\t\t\t\t*g = t;\n\t\t\t\tc = g;\n\t\t\t} else {\n\t\t\t\tf[3] = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\tc = f + 3;\n\t\t\t\tf[3] = '.';\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 1:\t \n\t\t\tg = f = idtest[1];\n\t\t\twhile (g > c && (isalnum(g[-1]) || g[-1] == '_' || g[-1] == '-' ||\n\t\t\t      g[-1] == '+' || g[-1] == '.' || g[-1] == '%'))\n\t\t\t\tg--;\n\t\t\th = f + 1;\n\t\t\twhile (*h && (isalnum(*h) || *h == '_' || *h == '-' || *h == '+' ||\n\t\t\t\t      *h == '.'))\n\t\t\t\th++;\n\t\t\tif (*h == '.')\n\t\t\t\th--;\n\t\t\tif (h - f > 4 && f - g > 1) {\n\t\t\t\tchar    t;\n\n\t\t\t\tt = *g;\n\t\t\t\t*g = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\t*g = t;\n\t\t\t\tt = *h;\n\t\t\t\t*h = '\\0';\n\t\t\t\tprintf(\"<A HREF=\\\"mailto:%s\\\">%s</A>\", g, g);\n\t\t\t\t*h = t;\n\t\t\t\tc = h;\n\t\t\t} else {\n\t\t\t\t*f = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\t*f = '@';\n\t\t\t\tidtest[1] = c;\n\t\t\t\tc = f;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0:\t \n\t\t\tg = f = idtest[0];\n\t\t\twhile (g > c && isalpha(g[-1]) && islower(g[-1]))\n\t\t\t\tg--;\n\t\t\th = f + 3;\n\t\t\twhile (*h && !isspace(*h) && *h != '<' && *h != '>' && *h != '\"' &&\n\t\t\t       *h != '&')\n\t\t\t\th++;\n\t\t\tif (f - g > 2 && f - g < 7 && h - f > 3) {\n\t\t\t\tchar    t;\n\n\t\t\t\tt = *g;\n\t\t\t\t*g = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\t*g = t;\n\t\t\t\tt = *h;\n\t\t\t\t*h = '\\0';\n\t\t\t\tprintf(\"<A HREF=\\\"%s\\\">%s</A>\", g, g);\n\t\t\t\t*h = t;\n\t\t\t\tc = h;\n\t\t\t} else {\n\t\t\t\tf[1] = '\\0';\n\t\t\t\tfputs(c, stdout);\n\t\t\t\tf[1] = '/';\n\t\t\t\tc = f + 1;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tnr = 0;\n\t\tif (idtest[0] && idtest[0] < c)\n\t\t\tidtest[0] = strstr(c + 1, \"://\");\n\t\tif (idtest[1] && idtest[1] < c)\n\t\t\tidtest[1] = strchr(c + 1, '@');\n\t\tif (idtest[2] && idtest[2] < c)\n\t\t\tidtest[2] = strstr(c, \"www.\");\n\t\tif (idtest[3] && idtest[3] < c)\n\t\t\tidtest[3] = strstr(c, \"ftp.\");\n\t\tif (idtest[4] && idtest[4] < c)\n\t\t\tidtest[4] = strchr(c + 1, '(');\n\t\tif (idtest[5] && idtest[5] < c)\n\t\t\tidtest[5] = strstr(c + 1, \".h&gt;\");\n\t\tfor (i = 0; i < 6; i++)\n\t\t\tnr += (idtest[i] != NULL);\n\t}\n\tfputs(c, stdout);\n}\n\nstatic int current_font = 0;\nstatic int current_size = 0;\nstatic int fillout = 1;\n\nstatic void\nout_html(char *c)\n{\n\tif (!c)\n\t\treturn;\n\tif (no_newline_output) {\n\t\tint     i = 0;\n\n\t\tno_newline_output = 1;\n\t\twhile (c[i]) {\n\t\t\tif (!no_newline_output)\n\t\t\t\tc[i - 1] = c[i];\n\t\t\tif (c[i] == '\\n')\n\t\t\t\tno_newline_output = 1;\n\t\t\ti++;\n\t\t}\n\t\tif (!no_newline_output)\n\t\t\tc[i - 1] = 0;\n\t}\n\tif (scaninbuff) {\n\t\twhile (*c) {\n\t\t\tif (buffpos >= buffmax) {\n\t\t\t\tchar   *h;\n\n\t\t\t\th = realloc(buffer, buffmax * 2);\n\t\t\t\tif (!h)\n\t\t\t\t\treturn;\n\t\t\t\tbuffer = h;\n\t\t\t\tbuffmax *= 2;\n\t\t\t}\n\t\t\tbuffer[buffpos++] = *c++;\n\t\t}\n\t} else if (output_possible) {\n\t\twhile (*c) {\n\t\t\toutbuffer[obp++] = *c;\n\t\t\tif (*c == '\\n' || obp > HUGE_STR_MAX) {\n\t\t\t\toutbuffer[obp] = '\\0';\n\t\t\t\tadd_links(outbuffer);\n\t\t\t\tobp = 0;\n\t\t\t}\n\t\t\tc++;\n\t\t}\n\t}\n}\n\n#define FO0 \"\"\n#define FC0 \"\"\n#define FO1 \"<I>\"\n#define FC1 \"</I>\"\n#define FO2 \"<B>\"\n#define FC2 \"</B>\"\n#define FO3 \"<TT>\"\n#define FC3 \"</TT>\"\n\nstatic char *switchfont[16] = {\n\t\"\", FC0 FO1, FC0 FO2, FC0 FO3,\n\tFC1 FO0, \"\", FC1 FO2, FC1 FO3,\n\tFC2 FO0, FC2 FO1, \"\", FC2 FO3,\n\tFC3 FO0, FC3 FO1, FC3 FO2, \"\"\n};\n\nstatic char *\nchange_to_font(int nr)\n{\n\tint     i;\n\n\tswitch (nr) {\n\tcase '0':\n\t\tnr++;\n\tcase '1':\n\tcase '2':\n\tcase '3':\n\tcase '4':\n\t\tnr = nr - '1';\n\t\tbreak;\n\tcase V('C', 'W'):\n\t\tnr = 3;\n\t\tbreak;\n\tcase 'L':\n\t\tnr = 3;\n\t\tbreak;\n\tcase 'B':\n\t\tnr = 2;\n\t\tbreak;\n\tcase 'I':\n\t\tnr = 1;\n\t\tbreak;\n\tcase 'P':\n\tcase 'R':\n\t\tnr = 0;\n\t\tbreak;\n\tcase 0:\n\tcase 1:\n\tcase 2:\n\tcase 3:\n\t\tbreak;\n\tdefault:\n\t\tnr = 0;\n\t\tbreak;\n\t}\n\ti = current_font * 4 + nr % 4;\n\tcurrent_font = nr % 4;\n\treturn switchfont[i];\n}\n\nstatic char sizebuf[200];\n\nstatic char *\nchange_to_size(int nr)\n{\n\tint     i;\n\n\tswitch (nr) {\n\tcase '0':\n\tcase '1':\n\tcase '2':\n\tcase '3':\n\tcase '4':\n\tcase '5':\n\tcase '6':\n\tcase '7':\n\tcase '8':\n\tcase '9':\n\t\tnr = nr - '0';\n\t\tbreak;\n\tcase '\\0':\n\t\tbreak;\n\tdefault:\n\t\tnr = current_size + nr;\n\t\tif (nr > 9)\n\t\t\tnr = 9;\n\t\tif (nr < -9)\n\t\t\tnr = -9;\n\t\tbreak;\n\t}\n\tif (nr == current_size)\n\t\treturn \"\";\n\ti = current_font;\n\tsizebuf[0] = '\\0';\n\tstrcat(sizebuf, change_to_font(0));\n\tif (current_size)\n\t\tstrcat(sizebuf, \"</FONT>\");\n\tcurrent_size = nr;\n\tif (nr) {\n\t\tint     l;\n\n\t\tstrcat(sizebuf, \"<FONT SIZE=\");\n\t\tl = strlen(sizebuf);\n\t\tif (nr > 0)\n\t\t\tsizebuf[l++] = '+';\n\t\telse\n\t\t\tsizebuf[l++] = '-', nr = -nr;\n\t\tsizebuf[l++] = nr + '0';\n\t\tsizebuf[l++] = '>';\n\t\tsizebuf[l] = '\\0';\n\t}\n\tstrcat(sizebuf, change_to_font(i));\n\treturn sizebuf;\n}\n\nstatic int asint = 0;\nstatic int intresult = 0;\n\n#define SKIPEOL while (*c && *c++!='\\n')\n\nstatic int skip_escape = 0;\nstatic int single_escape = 0;\n\nstatic char *\nscan_escape(char *c)\n{\n\tchar   *h = NULL;\n\tchar    b[5];\n\tINTDEF *intd;\n\tint     exoutputp, exskipescape;\n\tint     i, j;\n\n\tintresult = 0;\n\tswitch (*c) {\n\tcase 'e':\n\t\th = \"\\\\\";\n\t\tcurpos++;\n\t\tbreak;\n\tcase '0':\n\tcase ' ':\n\t\th = \"&nbsp;\";\n\t\tcurpos++;\n\t\tbreak;\n\tcase '|':\n\t\th = \"\";\n\t\tbreak;\n\tcase '\"':\n\t\tSKIPEOL;\n\t\tc--;\n\t\th = \"\";\n\t\tbreak;\n\tcase '$':\n\t\tif (argument) {\n\t\t\tc++;\n\t\t\ti = (*c - '1');\n\t\t\tif (!(h = argument[i]))\n\t\t\t\th = \"\";\n\t\t}\n\t\tbreak;\n\tcase 'z':\n\t\tc++;\n\t\tif (*c == '\\\\') {\n\t\t\tc = scan_escape(c + 1);\n\t\t\tc--;\n\t\t\th = \"\";\n\t\t} else {\n\t\t\tb[0] = *c;\n\t\t\tb[1] = '\\0';\n\t\t\th = \"\";\n\t\t}\n\t\tbreak;\n\tcase 'k':\n\t\tc++;\n\t\tif (*c == '(')\n\t\t\tc += 2;\n\tcase '^':\n\tcase '!':\n\tcase '%':\n\tcase 'a':\n\tcase 'd':\n\tcase 'r':\n\tcase 'u':\n\tcase '\\n':\n\tcase '&':\n\t\th = \"\";\n\t\tbreak;\n\tcase '(':\n\t\tc++;\n\t\ti = c[0] * 256 + c[1];\n\t\tc++;\n\t\th = expand_char(i);\n\t\tbreak;\n\tcase '*':\n\t\tc++;\n\t\tif (*c == '(') {\n\t\t\tc++;\n\t\t\ti = c[0] * 256 + c[1];\n\t\t\tc++;\n\t\t} else\n\t\t\ti = *c * 256 + ' ';\n\t\th = expand_string(i);\n\t\tbreak;\n\tcase 'f':\n\t\tc++;\n\t\tif (*c == '\\\\') {\n\t\t\tc++;\n\t\t\tc = scan_escape(c);\n\t\t\tc--;\n\t\t\ti = intresult;\n\t\t} else if (*c != '(')\n\t\t\ti = *c;\n\t\telse {\n\t\t\tc++;\n\t\t\ti = c[0] * 256 + c[1];\n\t\t\tc++;\n\t\t}\n\t\tif (!skip_escape)\n\t\t\th = change_to_font(i);\n\t\telse\n\t\t\th = \"\";\n\t\tbreak;\n\tcase 's':\n\t\tc++;\n\t\tj = 0;\n\t\ti = 0;\n\t\tif (*c == '-') {\n\t\t\tj = -1;\n\t\t\tc++;\n\t\t} else if (*c == '+') {\n\t\t\tj = 1;\n\t\t\tc++;\n\t\t}\n\t\tif (*c == '0')\n\t\t\tc++;\n\t\telse if (*c == '\\\\') {\n\t\t\tc++;\n\t\t\tc = scan_escape(c);\n\t\t\ti = intresult;\n\t\t\tif (!j)\n\t\t\t\tj = 1;\n\t\t} else\n\t\t\twhile (isdigit(*c) && (!i || (!j && i < 4)))\n\t\t\t\ti = i * 10 + (*c++) - '0';\n\t\tif (!j) {\n\t\t\tj = 1;\n\t\t\tif (i)\n\t\t\t\ti = i - 10;\n\t\t}\n\t\tif (!skip_escape)\n\t\t\th = change_to_size(i * j);\n\t\telse\n\t\t\th = \"\";\n\t\tc--;\n\t\tbreak;\n\tcase 'n':\n\t\tc++;\n\t\tj = 0;\n\t\tswitch (*c) {\n\t\tcase '+':\n\t\t\tj = 1;\n\t\t\tc++;\n\t\t\tbreak;\n\t\tcase '-':\n\t\t\tj = -1;\n\t\t\tc++;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tif (*c == '(') {\n\t\t\tc++;\n\t\t\ti = V(c[0], c[1]);\n\t\t\tc = c + 1;\n\t\t} else {\n\t\t\ti = V(c[0], ' ');\n\t\t}\n\t\tintd = intdef;\n\t\twhile (intd && intd->nr != i)\n\t\t\tintd = intd->next;\n\t\tif (intd) {\n\t\t\tintd->val = intd->val + j * intd->incr;\n\t\t\tintresult = intd->val;\n\t\t} else {\n\t\t\tswitch (i) {\n\t\t\tcase V('.', 's'):\n\t\t\t\tintresult = current_size;\n\t\t\t\tbreak;\n\t\t\tcase V('.', 'f'):\n\t\t\t\tintresult = current_font;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tintresult = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\th = \"\";\n\t\tbreak;\n\tcase 'w':\n\t\tc++;\n\t\ti = *c;\n\t\tc++;\n\t\texoutputp = output_possible;\n\t\texskipescape = skip_escape;\n\t\toutput_possible = 0;\n\t\tskip_escape = 1;\n\t\tj = 0;\n\t\twhile (*c != i) {\n\t\t\tj++;\n\t\t\tif (*c == escapesym)\n\t\t\t\tc = scan_escape(c + 1);\n\t\t\telse\n\t\t\t\tc++;\n\t\t}\n\t\toutput_possible = exoutputp;\n\t\tskip_escape = exskipescape;\n\t\tintresult = j;\n\t\tbreak;\n\tcase 'l':\n\t\th = \"<HR>\";\n\t\tcurpos = 0;\n\tcase 'b':\n\tcase 'v':\n\tcase 'x':\n\tcase 'o':\n\tcase 'L':\n\tcase 'h':\n\t\tc++;\n\t\ti = *c;\n\t\tc++;\n\t\texoutputp = output_possible;\n\t\texskipescape = skip_escape;\n\t\toutput_possible = 0;\n\t\tskip_escape = 1;\n\t\twhile (*c != i)\n\t\t\tif (*c == escapesym)\n\t\t\t\tc = scan_escape(c + 1);\n\t\t\telse\n\t\t\t\tc++;\n\t\toutput_possible = exoutputp;\n\t\tskip_escape = exskipescape;\n\t\tbreak;\n\tcase 'c':\n\t\tno_newline_output = 1;\n\t\tbreak;\n\tcase '{':\n\t\tnewline_for_fun++;\n\t\th = \"\";\n\t\tbreak;\n\tcase '}':\n\t\tif (newline_for_fun)\n\t\t\tnewline_for_fun--;\n\t\th = \"\";\n\t\tbreak;\n\tcase 'p':\n\t\th = \"<BR>\\n\";\n\t\tcurpos = 0;\n\t\tbreak;\n\tcase 't':\n\t\th = \"\\t\";\n\t\tcurpos = (curpos + 8) & 0xfff8;\n\t\tbreak;\n\tcase '<':\n\t\th = \"&lt;\";\n\t\tcurpos++;\n\t\tbreak;\n\tcase '>':\n\t\th = \"&gt;\";\n\t\tcurpos++;\n\t\tbreak;\n\tcase '\\\\':\n\t\tif (single_escape) {\n\t\t\tc--;\n\t\t\tbreak;\n\t\t}\n\tdefault:\n\t\tb[0] = *c;\n\t\tb[1] = 0;\n\t\th = b;\n\t\tcurpos++;\n\t\tbreak;\n\t}\n\tc++;\n\tif (!skip_escape)\n\t\tout_html(h);\n\treturn c;\n}\n\ntypedef struct TABLEITEM TABLEITEM;\n\nstruct TABLEITEM {\n\tchar   *contents;\n\tint     size, align, valign, colspan, rowspan, font, vleft, vright, space,\n\t        width;\n\tTABLEITEM *next;\n};\n\nstatic TABLEITEM emptyfield = {NULL, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, NULL};\n\ntypedef struct TABLEROW TABLEROW;\n\nstruct TABLEROW {\n\tTABLEITEM *first;\n\tTABLEROW *prev, *next;\n};\n\nstatic char *tableopt[] = {\n\t\"center\", \"expand\", \"box\", \"allbox\", \"doublebox\",\n\t\"tab\", \"linesize\", \"delim\", NULL\n};\nstatic int tableoptl[] = {6, 6, 3, 6, 9, 3, 8, 5, 0};\n\nstatic void\nclear_table(TABLEROW * table)\n{\n\tTABLEROW *tr1, *tr2;\n\tTABLEITEM *ti1, *ti2;\n\n\ttr1 = table;\n\twhile (tr1->prev)\n\t\ttr1 = tr1->prev;\n\twhile (tr1) {\n\t\tti1 = tr1->first;\n\t\twhile (ti1) {\n\t\t\tti2 = ti1->next;\n\t\t\tif (ti1->contents)\n\t\t\t\tfree(ti1->contents);\n\t\t\tfree(ti1);\n\t\t\tti1 = ti2;\n\t\t}\n\t\ttr2 = tr1;\n\t\ttr1 = tr1->next;\n\t\tfree(tr2);\n\t}\n}\n\nstatic char *scan_expression(char *c, int *result);\n\nstatic char *\nscan_format(char *c, TABLEROW ** result, int *maxcol)\n{\n\tTABLEROW *layout, *currow;\n\tTABLEITEM *curfield;\n\tint     i, j;\n\n\tif (*result) {\n\t\tclear_table(*result);\n\t}\n\tlayout = currow = (TABLEROW *) xmalloc(sizeof(TABLEROW));\n\tcurrow->next = currow->prev = NULL;\n\tcurrow->first = curfield = (TABLEITEM *) xmalloc(sizeof(TABLEITEM));\n\t*curfield = emptyfield;\n\twhile (*c && *c != '.') {\n\t\tswitch (*c) {\n\t\tcase 'C':\n\t\tcase 'c':\n\t\tcase 'N':\n\t\tcase 'n':\n\t\tcase 'R':\n\t\tcase 'r':\n\t\tcase 'A':\n\t\tcase 'a':\n\t\tcase 'L':\n\t\tcase 'l':\n\t\tcase 'S':\n\t\tcase 's':\n\t\tcase '^':\n\t\tcase '_':\n\t\t\tif (curfield->align) {\n\t\t\t\tcurfield->next = (TABLEITEM *) xmalloc(sizeof(TABLEITEM));\n\t\t\t\tcurfield = curfield->next;\n\t\t\t\t*curfield = emptyfield;\n\t\t\t}\n\t\t\tcurfield->align = toupper(*c);\n\t\t\tc++;\n\t\t\tbreak;\n\t\tcase 'i':\n\t\tcase 'I':\n\t\tcase 'B':\n\t\tcase 'b':\n\t\t\tcurfield->font = toupper(*c);\n\t\t\tc++;\n\t\t\tbreak;\n\t\tcase 'f':\n\t\tcase 'F':\n\t\t\tc++;\n\t\t\tcurfield->font = toupper(*c);\n\t\t\tc++;\n\t\t\tif (!isspace(*c))\n\t\t\t\tc++;\n\t\t\tbreak;\n\t\tcase 't':\n\t\tcase 'T':\n\t\t\tcurfield->valign = 't';\n\t\t\tc++;\n\t\t\tbreak;\n\t\tcase 'p':\n\t\tcase 'P':\n\t\t\tc++;\n\t\t\ti = j = 0;\n\t\t\tif (*c == '+') {\n\t\t\t\tj = 1;\n\t\t\t\tc++;\n\t\t\t}\n\t\t\tif (*c == '-') {\n\t\t\t\tj = -1;\n\t\t\t\tc++;\n\t\t\t}\n\t\t\twhile (isdigit(*c))\n\t\t\t\ti = i * 10 + (*c++) - '0';\n\t\t\tif (j)\n\t\t\t\tcurfield->size = i * j;\n\t\t\telse\n\t\t\t\tcurfield->size = j - 10;\n\t\t\tbreak;\n\t\tcase 'v':\n\t\tcase 'V':\n\t\tcase 'w':\n\t\tcase 'W':\n\t\t\tc = scan_expression(c + 2, &curfield->width);\n\t\t\tbreak;\n\t\tcase '|':\n\t\t\tif (curfield->align)\n\t\t\t\tcurfield->vleft++;\n\t\t\telse\n\t\t\t\tcurfield->vright++;\n\t\t\tc++;\n\t\t\tbreak;\n\t\tcase 'e':\n\t\tcase 'E':\n\t\t\tc++;\n\t\t\tbreak;\n\t\tcase '0':\n\t\tcase '1':\n\t\tcase '2':\n\t\tcase '3':\n\t\tcase '4':\n\t\tcase '5':\n\t\tcase '6':\n\t\tcase '7':\n\t\tcase '8':\n\t\tcase '9':\n\t\t\ti = 0;\n\t\t\twhile (isdigit(*c))\n\t\t\t\ti = i * 10 + (*c++) - '0';\n\t\t\tcurfield->space = i;\n\t\t\tbreak;\n\t\tcase ',':\n\t\tcase '\\n':\n\t\t\tcurrow->next = (TABLEROW *) xmalloc(sizeof(TABLEROW));\n\t\t\tcurrow->next->prev = currow;\n\t\t\tcurrow = currow->next;\n\t\t\tcurrow->next = NULL;\n\t\t\tcurfield = currow->first = (TABLEITEM *) xmalloc(sizeof(TABLEITEM));\n\t\t\t*curfield = emptyfield;\n\t\t\tc++;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tc++;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (*c == '.')\n\t\twhile (*c++ != '\\n');\n\t*maxcol = 0;\n\tcurrow = layout;\n\twhile (currow) {\n\t\tcurfield = layout->first;\n\t\ti = 0;\n\t\twhile (curfield) {\n\t\t\ti++;\n\t\t\tcurfield = curfield->next;\n\t\t}\n\t\tif (i > *maxcol)\n\t\t\t*maxcol = i;\n\t\tcurrow = currow->next;\n\t}\n\t*result = layout;\n\treturn c;\n}\n\nstatic TABLEROW *\nnext_row(TABLEROW * tr)\n{\n\tif (tr->next) {\n\t\ttr = tr->next;\n\t\tif (!tr->next)\n\t\t\tnext_row(tr);\n\t\treturn tr;\n\t} else {\n\t\tTABLEITEM *ti, *ti2;\n\n\t\ttr->next = (TABLEROW *) xmalloc(sizeof(TABLEROW));\n\t\ttr->next->prev = tr;\n\t\tti = tr->first;\n\t\ttr = tr->next;\n\t\ttr->next = NULL;\n\t\tif (ti)\n\t\t\ttr->first = ti2 = (TABLEITEM *) xmalloc(sizeof(TABLEITEM));\n\t\telse\n\t\t\ttr->first = ti2 = NULL;\n\t\twhile (ti != ti2) {\n\t\t\t*ti2 = *ti;\n\t\t\tti2->contents = NULL;\n\t\t\tif ((ti = ti->next)) {\n\t\t\t\tti2->next = (TABLEITEM *) xmalloc(sizeof(TABLEITEM));\n\t\t\t}\n\t\t\tti2 = ti2->next;\n\t\t}\n\t\treturn tr;\n\t}\n}\n\nstatic char itemreset[20] = \"\\\\fR\\\\s0\";\n\nstatic char *\nscan_table(char *c)\n{\n\tchar   *t, *h, *g;\n\tint     center = 0, expand = 0, box = 0, border = 0, linesize = 1;\n\tint     i, j, maxcol = 0, finished = 0;\n\tint     oldfont, oldsize, oldfillout;\n\tchar    itemsep = '\\t';\n\tTABLEROW *layout = NULL, *currow, *ftable;\n\tTABLEITEM *curfield;\n\n\twhile (*c++ != '\\n');\n\th = c;\n\tif (*h == '.')\n\t\treturn c - 1;\n\toldfont = current_font;\n\toldsize = current_size;\n\toldfillout = fillout;\n\tout_html(change_to_font(0));\n\tout_html(change_to_size(0));\n\tif (!fillout) {\n\t\tfillout = 1;\n\t\tout_html(\"</PRE>\");\n\t}\n\twhile (*h && *h != '\\n')\n\t\th++;\n\tif (h[-1] == ';') {\n\t\t \n\t\twhile (c < h) {\n\t\t\twhile (isspace(*c))\n\t\t\t\tc++;\n\t\t\tfor (i = 0; tableopt[i] && strncmp(tableopt[i], c, tableoptl[i]); i++);\n\t\t\tc = c + tableoptl[i];\n\t\t\tswitch (i) {\n\t\t\tcase 0:\n\t\t\t\tcenter = 1;\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\texpand = 1;\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tbox = 1;\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tborder = 1;\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tbox = 2;\n\t\t\t\tbreak;\n\t\t\tcase 5:\n\t\t\t\twhile (*c++ != '(');\n\t\t\t\titemsep = *c++;\n\t\t\t\tbreak;\n\t\t\tcase 6:\n\t\t\t\twhile (*c++ != '(');\n\t\t\t\tlinesize = 0;\n\t\t\t\twhile (isdigit(*c))\n\t\t\t\t\tlinesize = linesize * 10 + (*c++) - '0';\n\t\t\t\tbreak;\n\t\t\tcase 7:\n\t\t\t\twhile (*c != ')')\n\t\t\t\t\tc++;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tc++;\n\t\t}\n\t\tc = h + 1;\n\t}\n\t \n\tc = scan_format(c, &layout, &maxcol);\n\tcurrow = layout;\n\tnext_row(currow);\n\tcurfield = layout->first;\n\ti = 0;\n\twhile (!finished) {\n\t\t \n\t\th = c;\n\t\tif ((*c == '_' || *c == '=') && (c[1] == itemsep || c[1] == '\\n')) {\n\t\t\tif (c[-1] == '\\n' && c[1] == '\\n') {\n\t\t\t\tif (currow->prev) {\n\t\t\t\t\tcurrow->prev->next = (TABLEROW *) xmalloc(sizeof(TABLEROW));\n\t\t\t\t\tcurrow->prev->next->next = currow;\n\t\t\t\t\tcurrow->prev->next->prev = currow->prev;\n\t\t\t\t\tcurrow->prev = currow->prev->next;\n\t\t\t\t} else {\n\t\t\t\t\tcurrow->prev = layout = (TABLEROW *) xmalloc(sizeof(TABLEROW));\n\t\t\t\t\tcurrow->prev->prev = NULL;\n\t\t\t\t\tcurrow->prev->next = currow;\n\t\t\t\t}\n\t\t\t\tcurfield = currow->prev->first =\n\t\t\t\t\t(TABLEITEM *) xmalloc(sizeof(TABLEITEM));\n\t\t\t\t*curfield = emptyfield;\n\t\t\t\tcurfield->align = *c;\n\t\t\t\tcurfield->colspan = maxcol;\n\t\t\t\tcurfield = currow->first;\n\t\t\t\tc = c + 2;\n\t\t\t} else {\n\t\t\t\tif (curfield) {\n\t\t\t\t\tcurfield->align = *c;\n\t\t\t\t\tdo {\n\t\t\t\t\t\tcurfield = curfield->next;\n\t\t\t\t\t} while (curfield && curfield->align == 'S');\n\t\t\t\t}\n\t\t\t\tif (c[1] == '\\n') {\n\t\t\t\t\tcurrow = next_row(currow);\n\t\t\t\t\tcurfield = currow->first;\n\t\t\t\t}\n\t\t\t\tc = c + 2;\n\t\t\t}\n\t\t} else if (*c == 'T' && c[1] == '{') {\n\t\t\th = c + 2;\n\t\t\tc = strstr(h, \"\\nT}\");\n\t\t\tc++;\n\t\t\t*c = '\\0';\n\t\t\tg = NULL;\n\t\t\tscan_troff(h, 0, &g);\n\t\t\tscan_troff(itemreset, 0, &g);\n\t\t\t*c = 'T';\n\t\t\tc += 3;\n\t\t\tif (curfield) {\n\t\t\t\tcurfield->contents = g;\n\t\t\t\tdo {\n\t\t\t\t\tcurfield = curfield->next;\n\t\t\t\t} while (curfield && curfield->align == 'S');\n\t\t\t} else if (g)\n\t\t\t\tfree(g);\n\t\t\tif (c[-1] == '\\n') {\n\t\t\t\tcurrow = next_row(currow);\n\t\t\t\tcurfield = currow->first;\n\t\t\t}\n\t\t} else if (*c == '.' && c[1] == 'T' && c[2] == '&' && c[-1] == '\\n') {\n\t\t\tTABLEROW *hr;\n\n\t\t\twhile (*c++ != '\\n');\n\t\t\thr = currow;\n\t\t\tcurrow = currow->prev;\n\t\t\thr->prev = NULL;\n\t\t\tc = scan_format(c, &hr, &i);\n\t\t\thr->prev = currow;\n\t\t\tcurrow->next = hr;\n\t\t\tcurrow = hr;\n\t\t\tnext_row(currow);\n\t\t\tcurfield = currow->first;\n\t\t} else if (*c == '.' && c[1] == 'T' && c[2] == 'E' && c[-1] == '\\n') {\n\t\t\tfinished = 1;\n\t\t\twhile (*c++ != '\\n');\n\t\t\tif (currow->prev)\n\t\t\t\tcurrow->prev->next = NULL;\n\t\t\tcurrow->prev = NULL;\n\t\t\tclear_table(currow);\n\t\t} else if (*c == '.' && c[-1] == '\\n' && !isdigit(c[1])) {\n\t\t\t \n\t\t\twhile (*c++ != '\\n');\n\t\t} else {\n\t\t\th = c;\n\t\t\twhile (*c && (*c != itemsep || c[-1] == '\\\\') &&\n\t\t\t       (*c != '\\n' || c[-1] == '\\\\'))\n\t\t\t\tc++;\n\t\t\ti = 0;\n\t\t\tif (*c == itemsep) {\n\t\t\t\ti = 1;\n\t\t\t\t*c = '\\n';\n\t\t\t}\n\t\t\tif (h[0] == '\\\\' && h[2] == '\\n' &&\n\t\t\t    (h[1] == '_' || h[1] == '^')) {\n\t\t\t\tif (curfield) {\n\t\t\t\t\tcurfield->align = h[1];\n\t\t\t\t\tdo {\n\t\t\t\t\t\tcurfield = curfield->next;\n\t\t\t\t\t} while (curfield && curfield->align == 'S');\n\t\t\t\t}\n\t\t\t\th = h + 3;\n\t\t\t} else {\n\t\t\t\tg = NULL;\n\t\t\t\th = scan_troff(h, 1, &g);\n\t\t\t\tscan_troff(itemreset, 0, &g);\n\t\t\t\tif (curfield) {\n\t\t\t\t\tcurfield->contents = g;\n\t\t\t\t\tdo {\n\t\t\t\t\t\tcurfield = curfield->next;\n\t\t\t\t\t} while (curfield && curfield->align == 'S');\n\t\t\t\t} else if (g)\n\t\t\t\t\tfree(g);\n\t\t\t}\n\t\t\tif (i)\n\t\t\t\t*c = itemsep;\n\t\t\tc = h;\n\t\t\tif (c[-1] == '\\n') {\n\t\t\t\tcurrow = next_row(currow);\n\t\t\t\tcurfield = currow->first;\n\t\t\t}\n\t\t}\n\t}\n\t \n\tcurrow = layout;\n\twhile (currow->next)\n\t\tcurrow = currow->next;\n\twhile (currow) {\n\t\tTABLEITEM *ti, *ti1 = NULL, *ti2 = NULL;\n\n\t\tti = currow->first;\n\t\tif (currow->prev)\n\t\t\tti1 = currow->prev->first;\n\t\twhile (ti) {\n\t\t\tswitch (ti->align) {\n\t\t\tcase 'S':\n\t\t\t\tif (ti2) {\n\t\t\t\t\tti2->colspan++;\n\t\t\t\t\tif (ti2->rowspan < ti->rowspan)\n\t\t\t\t\t\tti2->rowspan = ti->rowspan;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase '^':\n\t\t\t\tif (ti1)\n\t\t\t\t\tti1->rowspan++;\n\t\t\tdefault:\n\t\t\t\tif (!ti2)\n\t\t\t\t\tti2 = ti;\n\t\t\t\telse {\n\t\t\t\t\tdo {\n\t\t\t\t\t\tti2 = ti2->next;\n\t\t\t\t\t} while (ti2 && curfield->align == 'S');\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tti = ti->next;\n\t\t\tif (ti1)\n\t\t\t\tti1 = ti1->next;\n\t\t}\n\t\tcurrow = currow->prev;\n\t}\n\t \n\tif (center)\n\t\tout_html(\"<CENTER>\");\n\tif (box == 2)\n\t\tout_html(\"<TABLE BORDER><TR><TD>\");\n\tout_html(\"<TABLE\");\n\tif (box || border) {\n\t\tout_html(\" BORDER\");\n\t\tif (!border)\n\t\t\tout_html(\"><TR><TD><TABLE\");\n\t\tif (expand)\n\t\t\tout_html(\" WIDTH=100%\");\n\t}\n\tout_html(\">\\n\");\n\tcurrow = layout;\n\twhile (currow) {\n\t\tj = 0;\n\t\tout_html(\"<TR VALIGN=top>\");\n\t\tcurfield = currow->first;\n\t\twhile (curfield) {\n\t\t\tif (curfield->align != 'S' && curfield->align != '^') {\n\t\t\t\tout_html(\"<TD\");\n\t\t\t\tswitch (curfield->align) {\n\t\t\t\tcase 'N':\n\t\t\t\t\tcurfield->space += 4;\n\t\t\t\tcase 'R':\n\t\t\t\t\tout_html(\" ALIGN=right\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'C':\n\t\t\t\t\tout_html(\" ALIGN=center\");\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (!curfield->valign && curfield->rowspan > 1)\n\t\t\t\t\tout_html(\" VALIGN=center\");\n\t\t\t\tif (curfield->colspan > 1) {\n\t\t\t\t\tchar    buf[5];\n\n\t\t\t\t\tout_html(\" COLSPAN=\");\n\t\t\t\t\tsprintf(buf, \"%i\", curfield->colspan);\n\t\t\t\t\tout_html(buf);\n\t\t\t\t}\n\t\t\t\tif (curfield->rowspan > 1) {\n\t\t\t\t\tchar    buf[5];\n\n\t\t\t\t\tout_html(\" ROWSPAN=\");\n\t\t\t\t\tsprintf(buf, \"%i\", curfield->rowspan);\n\t\t\t\t\tout_html(buf);\n\t\t\t\t}\n\t\t\t\tj = j + curfield->colspan;\n\t\t\t\tout_html(\">\");\n\t\t\t\tif (curfield->size)\n\t\t\t\t\tout_html(change_to_size(curfield->size));\n\t\t\t\tif (curfield->font)\n\t\t\t\t\tout_html(change_to_font(curfield->font));\n\t\t\t\tswitch (curfield->align) {\n\t\t\t\tcase '=':\n\t\t\t\t\tout_html(\"<HR><HR>\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase '_':\n\t\t\t\t\tout_html(\"<HR>\");\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (curfield->contents)\n\t\t\t\t\t\tout_html(curfield->contents);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (curfield->space)\n\t\t\t\t\tfor (i = 0; i < curfield->space; i++)\n\t\t\t\t\t\tout_html(\"&nbsp;\");\n\t\t\t\tif (curfield->font)\n\t\t\t\t\tout_html(change_to_font(0));\n\t\t\t\tif (curfield->size)\n\t\t\t\t\tout_html(change_to_size(0));\n\t\t\t\tif (j >= maxcol && curfield->align > '@' && curfield->align != '_')\n\t\t\t\t\tout_html(\"<BR>\");\n\t\t\t\tout_html(\"</TD>\");\n\t\t\t}\n\t\t\tcurfield = curfield->next;\n\t\t}\n\t\tout_html(\"</TR>\\n\");\n\t\tcurrow = currow->next;\n\t}\n\tif (box && !border)\n\t\tout_html(\"</TABLE>\");\n\tout_html(\"</TABLE>\");\n\tif (box == 2)\n\t\tout_html(\"</TABLE>\");\n\tif (center)\n\t\tout_html(\"</CENTER>\\n\");\n\telse\n\t\tout_html(\"\\n\");\n\tif (!oldfillout)\n\t\tout_html(\"<PRE>\");\n\tfillout = oldfillout;\n\tout_html(change_to_size(oldsize));\n\tout_html(change_to_font(oldfont));\n\treturn c;\n}\n\nstatic char *\nscan_expression(char *c, int *result)\n{\n\tint     value = 0, value2, j = 0, sign = 1, opex = 0;\n\tchar    oper = 'c';\n\n\tif (*c == '!') {\n\t\tc = scan_expression(c + 1, &value);\n\t\tvalue = (!value);\n\t} else if (*c == 'n') {\n\t\tc++;\n\t\tvalue = NROFF;\n\t} else if (*c == 't') {\n\t\tc++;\n\t\tvalue = 1 - NROFF;\n\t} else if (*c == '\\'' || *c == '\"' || *c < ' ' || (*c == '\\\\' && c[1] == '(')) {\n\t\t \n\t\tchar   *st1 = NULL, *st2 = NULL, *h;\n\t\tchar   *tcmp = NULL;\n\t\tchar    sep;\n\n\t\tsep = *c;\n\t\tif (sep == '\\\\') {\n\t\t\ttcmp = c;\n\t\t\tc = c + 3;\n\t\t}\n\t\tc++;\n\t\th = c;\n\t\twhile (*c != sep && (!tcmp || strncmp(c, tcmp, 4)))\n\t\t\tc++;\n\t\t*c = '\\n';\n\t\tscan_troff(h, 1, &st1);\n\t\t*c = sep;\n\t\tif (tcmp)\n\t\t\tc = c + 3;\n\t\tc++;\n\t\th = c;\n\t\twhile (*c != sep && (!tcmp || strncmp(c, tcmp, 4)))\n\t\t\tc++;\n\t\t*c = '\\n';\n\t\tscan_troff(h, 1, &st2);\n\t\t*c = sep;\n\t\tif (!st1 && !st2)\n\t\t\tvalue = 1;\n\t\telse if (!st1 || !st2)\n\t\t\tvalue = 0;\n\t\telse\n\t\t\tvalue = (!strcmp(st1, st2));\n\t\tif (st1)\n\t\t\tfree(st1);\n\t\tif (st2)\n\t\t\tfree(st2);\n\t\tif (tcmp)\n\t\t\tc = c + 3;\n\t\tc++;\n\t} else {\n\t\twhile (*c && !isspace(*c) && *c != ')') {\n\t\t\topex = 0;\n\t\t\tswitch (*c) {\n\t\t\tcase '(':\n\t\t\t\tc = scan_expression(c + 1, &value2);\n\t\t\t\tvalue2 = sign * value2;\n\t\t\t\topex = 1;\n\t\t\t\tbreak;\n\t\t\tcase '.':\n\t\t\tcase '0':\n\t\t\tcase '1':\n\t\t\tcase '2':\n\t\t\tcase '3':\n\t\t\tcase '4':\n\t\t\tcase '5':\n\t\t\tcase '6':\n\t\t\tcase '7':\n\t\t\tcase '8':\n\t\t\tcase '9':{\n\t\t\t\t\tint     num = 0, denum = 1;\n\n\t\t\t\t\tvalue2 = 0;\n\t\t\t\t\twhile (isdigit(*c))\n\t\t\t\t\t\tvalue2 = value2 * 10 + ((*c++) - '0');\n\t\t\t\t\tif (*c == '.') {\n\t\t\t\t\t\tc++;\n\t\t\t\t\t\twhile (isdigit(*c)) {\n\t\t\t\t\t\t\tnum = num * 10 + ((*c++) - '0');\n\t\t\t\t\t\t\tdenum = denum * 10;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (isalpha(*c)) {\n\t\t\t\t\t\t \n\t\t\t\t\t\tswitch (*c) {\n\t\t\t\t\t\tcase 'i':\t \n\t\t\t\t\t\t\tvalue2 = value2 * 10 + (num * 10 + denum / 2) / denum;\n\t\t\t\t\t\t\tnum = 0;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tc++;\n\t\t\t\t\t}\n\t\t\t\t\tvalue2 = value2 + (num + denum / 2) / denum;\n\t\t\t\t\tvalue2 = sign * value2;\n\t\t\t\t\topex = 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tcase '\\\\':\n\t\t\t\tc = scan_escape(c + 1);\n\t\t\t\tvalue2 = intresult * sign;\n\t\t\t\tif (isalpha(*c))\n\t\t\t\t\tc++;\t \n\t\t\t\topex = 1;\n\t\t\t\tbreak;\n\t\t\tcase '-':\n\t\t\t\tif (oper) {\n\t\t\t\t\tsign = -1;\n\t\t\t\t\tc++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tcase '>':\n\t\t\tcase '<':\n\t\t\tcase '+':\n\t\t\tcase '/':\n\t\t\tcase '*':\n\t\t\tcase '%':\n\t\t\tcase '&':\n\t\t\tcase '=':\n\t\t\tcase ':':\n\t\t\t\tif (c[1] == '=')\n\t\t\t\t\toper = (*c++) + 16;\n\t\t\t\telse\n\t\t\t\t\toper = *c;\n\t\t\t\tc++;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tc++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (opex) {\n\t\t\t\tsign = 1;\n\t\t\t\tswitch (oper) {\n\t\t\t\tcase 'c':\n\t\t\t\t\tvalue = value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '-':\n\t\t\t\t\tvalue = value - value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '+':\n\t\t\t\t\tvalue = value + value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '*':\n\t\t\t\t\tvalue = value * value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '/':\n\t\t\t\t\tif (value2)\n\t\t\t\t\t\tvalue = value / value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '%':\n\t\t\t\t\tif (value2)\n\t\t\t\t\t\tvalue = value % value2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase '<':\n\t\t\t\t\tvalue = (value < value2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase '>':\n\t\t\t\t\tvalue = (value > value2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase '>' + 16:\n\t\t\t\t\tvalue = (value >= value2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase '<' + 16:\n\t\t\t\t\tvalue = (value <= value2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase '=':\n\t\t\t\tcase '=' + 16:\n\t\t\t\t\tvalue = (value == value2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase '&':\n\t\t\t\t\tvalue = (value && value2);\n\t\t\t\t\tbreak;\n\t\t\t\tcase ':':\n\t\t\t\t\tvalue = (value || value2);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tfprintf(stderr, \"man2html: unknown operator %c.\\n\", oper);\n\t\t\t\t}\n\t\t\t\toper = 0;\n\t\t\t}\n\t\t}\n\t\tif (*c == ')')\n\t\t\tc++;\n\t}\n\t*result = value;\n\treturn c;\n}\n\nstatic void\ntrans_char(char *c, char s, char t)\n{\n\tchar   *sl = c;\n\tint     slash = 0;\n\n\twhile (*sl != '\\n' || slash) {\n\t\tif (!slash) {\n\t\t\tif (*sl == escapesym)\n\t\t\t\tslash = 1;\n\t\t\telse if (*sl == s)\n\t\t\t\t*sl = t;\n\t\t} else\n\t\t\tslash = 0;\n\t\tsl++;\n\t}\n}\n\n \nstatic char *\nunescape (char *c)\n{\n\tint\ti, l;\n\n\tl = strlen (c);\n\ti = 0;\n\twhile (i < l && c[i]) {\n\t\tif (c[i] == '\\a') {\n\t\t\tif (c[i+1])\n\t\t\t\tmemmove (c + i, c + i + 1, l - i);\n\t\t\telse {\n\t\t\t\tc[i] = '\\0';\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\ti++;\n\t}\n\treturn c;\n}\n\t\nstatic char *\nfill_words(char *c, char *words[], int *n)\n{\n\tchar   *sl = c;\n\tint     slash = 0;\n\tint     skipspace = 0;\n\n\t*n = 0;\n\twords[*n] = sl;\n\twhile (*sl && (*sl != '\\n' || slash)) {\n\t\tif (!slash) {\n\t\t\tif (*sl == '\"') {\n\t\t\t\t*sl = '\\a';\n\t\t\t\tskipspace = !skipspace;\n\t\t\t} else if (*sl == '\\a') {\n\t\t\t\t \n\t\t\t\tskipspace = !skipspace;\n\t\t\t} else if (*sl == escapesym)\n\t\t\t\tslash = 1;\n\t\t\telse if ((*sl == ' ' || *sl == '\\t') && !skipspace) {\n\t\t\t\t*sl = '\\n';\n\t\t\t\tif (words[*n] != sl)\n\t\t\t\t\t(*n)++;\n\t\t\t\twords[*n] = sl + 1;\n\t\t\t}\n\t\t} else {\n\t\t\tif (*sl == '\"') {\n\t\t\t\tsl--;\n\t\t\t\t*sl = '\\n';\n\t\t\t\tif (words[*n] != sl)\n\t\t\t\t\t(*n)++;\n\t\t\t\tsl++;\n\t\t\t\twhile (*sl && *sl != '\\n')\n\t\t\t\t\tsl++;\n\t\t\t\twords[*n] = sl;\n\t\t\t\tsl--;\n\t\t\t}\n\t\t\tslash = 0;\n\t\t}\n\t\tsl++;\n\t}\n\tif (sl != words[*n])\n\t\t(*n)++;\n\treturn sl;\n}\n\nstatic char *abbrev_list[] = {\n\t\"GSBG\", \"Getting Started \",\n\t\"SUBG\", \"Customizing SunOS\",\n\t\"SHBG\", \"Basic Troubleshooting\",\n\t\"SVBG\", \"SunView User's Guide\",\n\t\"MMBG\", \"Mail and Messages\",\n\t\"DMBG\", \"Doing More with SunOS\",\n\t\"UNBG\", \"Using the Network\",\n\t\"GDBG\", \"Games, Demos &amp; Other Pursuits\",\n\t\"CHANGE\", \"SunOS 4.1 Release Manual\",\n\t\"INSTALL\", \"Installing SunOS 4.1\",\n\t\"ADMIN\", \"System and Network Administration\",\n\t\"SECUR\", \"Security Features Guide\",\n\t\"PROM\", \"PROM User's Manual\",\n\t\"DIAG\", \"Sun System Diagnostics\",\n\t\"SUNDIAG\", \"Sundiag User's Guide\",\n\t\"MANPAGES\", \"SunOS Reference Manual\",\n\t\"REFMAN\", \"SunOS Reference Manual\",\n\t\"SSI\", \"Sun System Introduction\",\n\t\"SSO\", \"System Services Overview\",\n\t\"TEXT\", \"Editing Text Files\",\n\t\"DOCS\", \"Formatting Documents\",\n\t\"TROFF\", \"Using <B>nroff</B> and <B>troff</B>\",\n\t\"INDEX\", \"Global Index\",\n\t\"CPG\", \"C Programmer's Guide\",\n\t\"CREF\", \"C Reference Manual\",\n\t\"ASSY\", \"Assembly Language Reference\",\n\t\"PUL\", \"Programming Utilities and Libraries\",\n\t\"DEBUG\", \"Debugging Tools\",\n\t\"NETP\", \"Network Programming\",\n\t\"DRIVER\", \"Writing Device Drivers\",\n\t\"STREAMS\", \"STREAMS Programming\",\n\t\"SBDK\", \"SBus Developer's Kit\",\n\t\"WDDS\", \"Writing Device Drivers for the SBus\",\n\t\"FPOINT\", \"Floating-Point Programmer's Guide\",\n\t\"SVPG\", \"SunView 1 Programmer's Guide\",\n\t\"SVSPG\", \"SunView 1 System Programmer's Guide\",\n\t\"PIXRCT\", \"Pixrect Reference Manual\",\n\t\"CGI\", \"SunCGI Reference Manual\",\n\t\"CORE\", \"SunCore Reference Manual\",\n\t\"4ASSY\", \"Sun-4 Assembly Language Reference\",\n\t\"SARCH\", \"<FONT SIZE=-1>SPARC</FONT> Architecture Manual\",\n\t\"KR\", \"The C Programming Language\",\nNULL, NULL};\n\nstatic char *\nlookup_abbrev(char *c)\n{\n\tint     i = 0;\n\n\tif (!c)\n\t\treturn \"\";\n\twhile (abbrev_list[i] && strcmp(c, abbrev_list[i]))\n\t\ti = i + 2;\n\tif (abbrev_list[i])\n\t\treturn abbrev_list[i + 1];\n\telse\n\t\treturn c;\n}\n\nstatic char manidx[NULL_TERMINATED(HUGE_STR_MAX)];\nstatic int subs = 0;\nstatic int mip = 0;\nstatic char label[5] = \"lbAA\";\n\nstatic void\nadd_to_index(int level, char *item)\n{\n\tchar   *c = NULL;\n\n\tlabel[3]++;\n\tif (label[3] > 'Z') {\n\t\tlabel[3] = 'A';\n\t\tlabel[2]++;\n\t}\n\tif (level != subs) {\n\t\tif (subs) {\n\t\t\tstrmaxcpy(manidx + mip, \"</DL>\\n\", HUGE_STR_MAX - mip);\n\t\t\tmip += 6;\n\t\t} else {\n\t\t\tstrmaxcpy(manidx + mip, \"<DL>\\n\", HUGE_STR_MAX - mip);\n\t\t\tmip += 5;\n\t\t}\n\t}\n\tsubs = level;\n\tscan_troff(item, 1, &c);\n\tsprintf(manidx + mip, \"<DT><A HREF=\\\"#%s\\\">%s</A><DD>\\n\", label, c);\n\tif (c)\n\t\tfree(c);\n\twhile (manidx[mip])\n\t\tmip++;\n}\n\nstatic char *\nskip_till_newline(char *c)\n{\n\tint     lvl = 0;\n\n\twhile (*c && *c != '\\n' || lvl > 0) {\n\t\tif (*c == '\\\\') {\n\t\t\tc++;\n\t\t\tif (*c == '}')\n\t\t\t\tlvl--;\n\t\t\telse if (*c == '{')\n\t\t\t\tlvl++;\n\t\t}\n\t\tc++;\n\t}\n\tc++;\n\tif (lvl < 0 && newline_for_fun) {\n\t\tnewline_for_fun = newline_for_fun + lvl;\n\t\tif (newline_for_fun < 0)\n\t\t\tnewline_for_fun = 0;\n\t}\n\treturn c;\n}\n\nstatic void\noutputPageHeader(char *l, char *c, char *r)\n{\n\tout_html(\"<TABLE WIDTH=100%>\\n<TR>\\n\");\n\tout_html(\"<TH ALIGN=LEFT width=33%>\");\n\tout_html(l);\n\tout_html(\"<TH ALIGN=CENTER width=33%>\");\n\tout_html(c);\n\tout_html(\"<TH ALIGN=RIGHT width=33%>\");\n\tout_html(r);\n\tout_html(\"\\n</TR>\\n</TABLE>\\n\");\n}\n\nstatic void\noutputPageFooter(char *l, char *c, char *r)\n{\n\tout_html(\"<HR>\\n\");\n\toutputPageHeader(l, c, r);\n}\n\nstatic int ifelseval = 0;\n\nstatic char *\nscan_request(char *c)\n{\n\t \n\tstatic int mandoc_synopsis = 0;\t \n\tstatic int mandoc_command = 0;\t \n\tstatic int mandoc_bd_options;\t \n\n\tint     i, j, mode = 0;\n\tchar   *h;\n\tchar   *wordlist[MAX_WORDLIST];\n\tint     words;\n\tchar   *sl;\n\tSTRDEF *owndef;\n\n\twhile (*c == ' ' || *c == '\\t')\n\t\tc++;\n\tif (c[0] == '\\n')\n\t\treturn c + 1;\n\tif (c[1] == '\\n')\n\t\tj = 1;\n\telse\n\t\tj = 2;\n\twhile (c[j] == ' ' || c[j] == '\\t')\n\t\tj++;\n\tif (c[0] == escapesym) {\n\t\t \n\t\t \n\t\tif (c[1] == '$')\n\t\t\tc = skip_till_newline(c);\n\t\telse\n\t\t\tc = scan_escape(c + 1);\n\t} else {\n\t\ti = V(c[0], c[1]);\n\t\tswitch (i) {\n\t\tcase V('a', 'b'):\n\t\t\th = c + j;\n\t\t\twhile (*h && *h != '\\n')\n\t\t\t\th++;\n\t\t\t*h = '\\0';\n\t\t\tif (scaninbuff && buffpos) {\n\t\t\t\tbuffer[buffpos] = '\\0';\n\t\t\t\tputs(buffer);\n\t\t\t}\n\t\t\t \n\t\t\texit(0);\n\t\t\tbreak;\n\t\tcase V('d', 'i'):\n\t\t\t{\n\t\t\t\tSTRDEF *de;\n\t\t\t\tint     oldcurpos = curpos;\n\n\t\t\t\tc = c + j;\n\t\t\t\ti = V(c[0], c[1]);\n\t\t\t\tif (*c == '\\n') {\n\t\t\t\t\tc++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\twhile (*c && *c != '\\n')\n\t\t\t\t\tc++;\n\t\t\t\tc++;\n\t\t\t\th = c;\n\t\t\t\twhile (*c && strncmp(c, \".di\", 3))\n\t\t\t\t\twhile (*c && *c++ != '\\n');\n\t\t\t\t*c = '\\0';\n\t\t\t\tde = strdef;\n\t\t\t\twhile (de && de->nr != i)\n\t\t\t\t\tde = de->next;\n\t\t\t\tif (!de) {\n\t\t\t\t\tde = (STRDEF *) xmalloc(sizeof(STRDEF));\n\t\t\t\t\tde->nr = i;\n\t\t\t\t\tde->slen = 0;\n\t\t\t\t\tde->next = strdef;\n\t\t\t\t\tde->st = NULL;\n\t\t\t\t\tstrdef = de;\n\t\t\t\t} else {\n\t\t\t\t\tif (de->st)\n\t\t\t\t\t\tfree(de->st);\n\t\t\t\t\tde->slen = 0;\n\t\t\t\t\tde->st = NULL;\n\t\t\t\t}\n\t\t\t\tscan_troff(h, 0, &de->st);\n\t\t\t\t*c = '.';\n\t\t\t\twhile (*c && *c++ != '\\n');\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('d', 's'):\n\t\t\tmode = 1;\n\t\tcase V('a', 's'):\n\t\t\t{\n\t\t\t\tSTRDEF *de;\n\t\t\t\tint     oldcurpos = curpos;\n\n\t\t\t\tc = c + j;\n\t\t\t\ti = V(c[0], c[1]);\n\t\t\t\tj = 0;\n\t\t\t\twhile (c[j] && c[j] != '\\n')\n\t\t\t\t\tj++;\n\t\t\t\tif (j < 3) {\n\t\t\t\t\tc = c + j;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tif (c[1] == ' ')\n\t\t\t\t\tc = c + 1;\n\t\t\t\telse\n\t\t\t\t\tc = c + 2;\n\t\t\t\twhile (isspace(*c))\n\t\t\t\t\tc++;\n\t\t\t\tif (*c == '\"')\n\t\t\t\t\tc++;\n\t\t\t\tde = strdef;\n\t\t\t\twhile (de && de->nr != i)\n\t\t\t\t\tde = de->next;\n\t\t\t\tsingle_escape = 1;\n\t\t\t\tcurpos = 0;\n\t\t\t\tif (!de) {\n\t\t\t\t\tchar   *h;\n\n\t\t\t\t\tde = (STRDEF *) xmalloc(sizeof(STRDEF));\n\t\t\t\t\tde->nr = i;\n\t\t\t\t\tde->slen = 0;\n\t\t\t\t\tde->next = strdef;\n\t\t\t\t\tde->st = NULL;\n\t\t\t\t\tstrdef = de;\n\t\t\t\t\th = NULL;\n\t\t\t\t\tc = scan_troff(c, 1, &h);\n\t\t\t\t\tde->st = h;\n\t\t\t\t\tde->slen = curpos;\n\t\t\t\t} else {\n\t\t\t\t\tif (mode) {\n\t\t\t\t\t\tchar   *h = NULL;\n\n\t\t\t\t\t\tc = scan_troff(c, 1, &h);\n\t\t\t\t\t\tfree(de->st);\n\t\t\t\t\t\tde->slen = 0;\n\t\t\t\t\t\tde->st = h;\n\t\t\t\t\t} else\n\t\t\t\t\t\tc = scan_troff(c, 1, &de->st);\n\t\t\t\t\tde->slen += curpos;\n\t\t\t\t}\n\t\t\t\tsingle_escape = 0;\n\t\t\t\tcurpos = oldcurpos;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase V('b', 'r'):\n\t\t\tif (still_dd)\n\t\t\t\tout_html(\"<DD>\");\n\t\t\telse\n\t\t\t\tout_html(\"<BR>\\n\");\n\t\t\tcurpos = 0;\n\t\t\tc = c + j;\n\t\t\tif (c[0] == escapesym) {\n\t\t\t\tc = scan_escape(c + 1);\n\t\t\t}\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('c', '2'):\n\t\t\tc = c + j;\n\t\t\tif (*c != '\\n') {\n\t\t\t\tnobreaksym = *c;\n\t\t\t} else\n\t\t\t\tnobreaksym = '\\'';\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('c', 'c'):\n\t\t\tc = c + j;\n\t\t\tif (*c != '\\n') {\n\t\t\t\tcontrolsym = *c;\n\t\t\t} else\n\t\t\t\tcontrolsym = '.';\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('c', 'e'):\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n') {\n\t\t\t\ti = 1;\n\t\t\t} else {\n\t\t\t\ti = 0;\n\t\t\t\twhile ('0' <= *c && *c <= '9') {\n\t\t\t\t\ti = i * 10 + *c - '0';\n\t\t\t\t\tc++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tc = skip_till_newline(c);\n\t\t\t \n\t\t\tif (i > 0) {\n\t\t\t\tout_html(\"<CENTER>\\n\");\n\t\t\t\twhile (i && *c) {\n\t\t\t\t\tchar   *line = NULL;\n\n\t\t\t\t\tc = scan_troff(c, 1, &line);\n\t\t\t\t\tif (line && strncmp(line, \"<BR>\", 4)) {\n\t\t\t\t\t\tout_html(line);\n\t\t\t\t\t\tout_html(\"<BR>\\n\");\n\t\t\t\t\t\ti--;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tout_html(\"</CENTER>\\n\");\n\t\t\t\tcurpos = 0;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase V('e', 'c'):\n\t\t\tc = c + j;\n\t\t\tif (*c != '\\n') {\n\t\t\t\tescapesym = *c;\n\t\t\t} else\n\t\t\t\tescapesym = '\\\\';\n\t\t\tbreak;\n\t\t\tc = skip_till_newline(c);\n\t\tcase V('e', 'o'):\n\t\t\tescapesym = '\\0';\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('e', 'x'):\n\t\t\texit(0);\n\t\t\tbreak;\n\t\tcase V('f', 'c'):\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n') {\n\t\t\t\tfieldsym = padsym = '\\0';\n\t\t\t} else {\n\t\t\t\tfieldsym = c[0];\n\t\t\t\tpadsym = c[1];\n\t\t\t}\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('f', 'i'):\n\t\t\tif (!fillout) {\n\t\t\t\tout_html(change_to_font(0));\n\t\t\t\tout_html(change_to_size('0'));\n\t\t\t\tout_html(\"</PRE>\\n\");\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tfillout = 1;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('f', 't'):\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n') {\n\t\t\t\tout_html(change_to_font(0));\n\t\t\t} else {\n\t\t\t\tif (*c == escapesym) {\n\t\t\t\t\tint     fn;\n\n\t\t\t\t\tc = scan_expression(c, &fn);\n\t\t\t\t\tc--;\n\t\t\t\t\tout_html(change_to_font(fn));\n\t\t\t\t} else {\n\t\t\t\t\tout_html(change_to_font(*c));\n\t\t\t\t\tc++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('e', 'l'):\n\t\t\t \n\t\t\tif (ifelseval) {\n\t\t\t\tc = c + j;\n\t\t\t\tc[-1] = '\\n';\n\t\t\t\tc = scan_troff(c, 1, NULL);\n\t\t\t} else\n\t\t\t\tc = skip_till_newline(c + j);\n\t\t\tbreak;\n\t\tcase V('i', 'e'):\n\t\t\t \n\t\tcase V('i', 'f'):\n\t\t\t \n\t\t\tc = c + j;\n\t\t\tc = scan_expression(c, &i);\n\t\t\tifelseval = !i;\n\t\t\tif (i) {\n\t\t\t\t*c = '\\n';\n\t\t\t\tc++;\n\t\t\t\tc = scan_troff(c, 1, NULL);\n\t\t\t} else\n\t\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('i', 'g'):\n\t\t\t{\n\t\t\t\tchar   *endwith = \"..\\n\";\n\n\t\t\t\ti = 3;\n\t\t\t\tc = c + j;\n\t\t\t\tif (*c != '\\n') {\n\t\t\t\t\tendwith = c - 1;\n\t\t\t\t\ti = 1;\n\t\t\t\t\tc[-1] = '.';\n\t\t\t\t\twhile (*c && *c != '\\n')\n\t\t\t\t\t\tc++, i++;\n\t\t\t\t}\n\t\t\t\tc++;\n\t\t\t\twhile (*c && strncmp(c, endwith, i))\n\t\t\t\t\twhile (*c++ != '\\n');\n\t\t\t\twhile (*c++ != '\\n');\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('n', 'f'):\n\t\t\tif (fillout) {\n\t\t\t\tout_html(change_to_font(0));\n\t\t\t\tout_html(change_to_size('0'));\n\t\t\t\tout_html(\"<PRE>\\n\");\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tfillout = 0;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('p', 's'):\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n') {\n\t\t\t\tout_html(change_to_size('0'));\n\t\t\t} else {\n\t\t\t\tj = 0;\n\t\t\t\ti = 0;\n\t\t\t\tif (*c == '-') {\n\t\t\t\t\tj = -1;\n\t\t\t\t\tc++;\n\t\t\t\t} else if (*c == '+') {\n\t\t\t\t\tj = 1;\n\t\t\t\t\tc++;\n\t\t\t\t}\n\t\t\t\tc = scan_expression(c, &i);\n\t\t\t\tif (!j) {\n\t\t\t\t\tj = 1;\n\t\t\t\t\tif (i > 5)\n\t\t\t\t\t\ti = i - 10;\n\t\t\t\t}\n\t\t\t\tout_html(change_to_size(i * j));\n\t\t\t}\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('s', 'p'):\n\t\t\tc = c + j;\n\t\t\tif (fillout)\n\t\t\t\tout_html(\"<P>\");\n\t\t\telse {\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tNEWLINE[0] = '\\n';\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('s', 'o'):\n\t\t\t{\n\t\t\t\tFILE   *f;\n\t\t\t\tstruct stat stbuf;\n\t\t\t\tint     l = 0;\n\t\t\t\tchar   *buf;\n\t\t\t\tchar   *name = NULL;\n\n\t\t\t\tcurpos = 0;\n\t\t\t\tc = c + j;\n\t\t\t\tif (*c == '/') {\n\t\t\t\t\th = c;\n\t\t\t\t} else {\n\t\t\t\t\th = c - 3;\n\t\t\t\t\th[0] = '.';\n\t\t\t\t\th[1] = '.';\n\t\t\t\t\th[2] = '/';\n\t\t\t\t}\n\t\t\t\twhile (*c != '\\n')\n\t\t\t\t\tc++;\n\t\t\t\t*c = '\\0';\n\t\t\t\tscan_troff(h, 1, &name);\n\t\t\t\tif (name[3] == '/')\n\t\t\t\t\th = name + 3;\n\t\t\t\telse\n\t\t\t\t\th = name;\n\t\t\t\tif (stat(h, &stbuf) != -1)\n\t\t\t\t\tl = stbuf.st_size;\n#if NOCGI\n\t\t\t\tif (!out_length) {\n\t\t\t\t\tchar   *t, *s;\n\n\t\t\t\t\tt = strrchr(fname, '/');\n\t\t\t\t\tif (!t)\n\t\t\t\t\t\tt = fname;\n\t\t\t\t\tfprintf(stderr, \"ln -s %s.html %s.html\\n\", h, t);\n\t\t\t\t\ts = strrchr(t, '.');\n\t\t\t\t\tif (!s)\n\t\t\t\t\t\ts = t;\n\t\t\t\t\tprintf(\"<HTML><HEAD><TITLE> Manpage of %s</TITLE>\\n\"\n\t\t\t\t\t       \"</HEAD><BODY>\\n\"\n\t\t\t\t\t       \"See the manpage for <A HREF=\\\"%s.html\\\">%s</A>.\\n\"\n\t\t\t\t\t       \"</BODY></HTML>\\n\",\n\t\t\t\t\t       s, h, h);\n\t\t\t\t} else\n#endif\n\t\t\t\t{\n\t\t\t\t\t \n\t\t\t\t\tbuf = read_man_page(h);\n\t\t\t\t\tif (!buf) {\n\n\t\t\t\t\t\tfprintf(stderr, \"man2html: unable to open or read file %s.\\n\",\n\t\t\t\t\t\t\th);\n\t\t\t\t\t\tout_html(\"<BLOCKQUOTE>\"\n\t\t\t\t\t\t\t \"man2html: unable to open or read file.\\n\");\n\t\t\t\t\t\tout_html(h);\n\t\t\t\t\t\tout_html(\"</BLOCKQUOTE>\\n\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbuf[0] = buf[l] = '\\n';\n\t\t\t\t\t\tbuf[l + 1] = buf[l + 2] = '\\0';\n\t\t\t\t\t\tscan_troff(buf + 1, 0, NULL);\n\t\t\t\t\t}\n\t\t\t\t\tif (buf)\n\t\t\t\t\t\tfree(buf);\n\t\t\t\t}\n\t\t\t\t*c++ = '\\n';\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('t', 'a'):\n\t\t\tc = c + j;\n\t\t\tj = 0;\n\t\t\twhile (*c != '\\n') {\n\t\t\t\tsl = scan_expression(c, &tabstops[j]);\n\t\t\t\tif (*c == '-' || *c == '+')\n\t\t\t\t\ttabstops[j] += tabstops[j - 1];\n\t\t\t\tc = sl;\n\t\t\t\twhile (*c == ' ' || *c == '\\t')\n\t\t\t\t\tc++;\n\t\t\t\tj++;\n\t\t\t}\n\t\t\tmaxtstop = j;\n\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('t', 'i'):\n\t\t\t \n\t\t\tout_html(\"<BR>\\n\");\n\t\t\tc = c + j;\n\t\t\tc = scan_expression(c, &j);\n\t\t\tfor (i = 0; i < j; i++)\n\t\t\t\tout_html(\"&nbsp;\");\n\t\t\tcurpos = j;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('t', 'm'):\n\t\t\tc = c + j;\n\t\t\th = c;\n\t\t\twhile (*c != '\\n')\n\t\t\t\tc++;\n\t\t\t*c = '\\0';\n\t\t\t \n\t\t\t*c = '\\n';\n\t\t\tbreak;\n\t\tcase V('B', ' '):\n\t\tcase V('B', '\\n'):\n\t\tcase V('I', ' '):\n\t\tcase V('I', '\\n'):\n\t\t\t \n\t\t\tout_html(change_to_font(*c));\n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff(c, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('O', 'P'):\t \n\t\t\t \n\t\t\tmode = 1;\n\t\t\tc[0] = 'B';\n\t\t\tc[1] = 'I';\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(\"[\");\n\t\t\tcurpos++;\n\t\tcase V('B', 'R'):\n\t\tcase V('B', 'I'):\n\t\tcase V('I', 'B'):\n\t\tcase V('I', 'R'):\n\t\tcase V('R', 'B'):\n\t\tcase V('R', 'I'):\n\t\t\t{\n\t\t\t\tchar    font[2];\n\n\t\t\t\tfont[0] = c[0];\n\t\t\t\tfont[1] = c[1];\n\t\t\t\tc = c + j;\n\t\t\t\tif (*c == '\\n')\n\t\t\t\t\tc++;\n\t\t\t\tsl = fill_words(c, wordlist, &words);\n\t\t\t\tc = sl + 1;\n\t\t\t\t \n\t\t\t\tfor (i = 0; i < words; i++) {\n\t\t\t\t\tif (mode) {\n\t\t\t\t\t\tout_html(\" \");\n\t\t\t\t\t\tcurpos++;\n\t\t\t\t\t}\n\t\t\t\t\twordlist[i][-1] = ' ';\n\t\t\t\t\tout_html(change_to_font(font[i & 1]));\n\t\t\t\t\tscan_troff(wordlist[i], 1, NULL);\n\t\t\t\t}\n\t\t\t\tout_html(change_to_font('R'));\n\t\t\t\tif (mode) {\n\t\t\t\t\tout_html(\" ]\");\n\t\t\t\t\tcurpos++;\n\t\t\t\t}\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tif (!fillout)\n\t\t\t\t\tcurpos = 0;\n\t\t\t\telse\n\t\t\t\t\tcurpos++;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase V('D', 'T'):\n\t\t\tfor (j = 0; j < 20; j++)\n\t\t\t\ttabstops[j] = (j + 1) * 8;\n\t\t\tmaxtstop = 20;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('I', 'P'):\n\t\t\tsl = fill_words(c + j, wordlist, &words);\n\t\t\tc = sl + 1;\n\t\t\tif (!dl_set[itemdepth]) {\n\t\t\t\tout_html(\"<DL COMPACT>\\n\");\n\t\t\t\tdl_set[itemdepth] = 1;\n\t\t\t}\n\t\t\tout_html(\"<DT>\");\n\t\t\tif (words) {\n\t\t\t\tscan_troff(wordlist[0], 1, NULL);\n\t\t\t}\n\t\t\tout_html(\"<DD>\");\n\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('T', 'P'):\n\t\t\tif (!dl_set[itemdepth]) {\n\t\t\t\tout_html(\"<DL COMPACT>\\n\");\n\t\t\t\tdl_set[itemdepth] = 1;\n\t\t\t}\n\t\t\tout_html(\"<DT>\");\n\t\t\tc = skip_till_newline(c);\n\t\t\t \n\t\t\tif (!*c)\n\t\t\t\tstill_dd = 1;\n\t\t\telse {\n\t\t\t\tc = scan_troff(c, 1, NULL);\n\t\t\t\tout_html(\"<DD>\");\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('I', 'X'):\n\t\t\t \n\t\t\tsl = fill_words(c + j, wordlist, &words);\n\t\t\tc = sl + 1;\n\t\t\tj = 4;\n\t\t\twhile (idxlabel[j] == 'Z')\n\t\t\t\tidxlabel[j--] = 'A';\n\t\t\tidxlabel[j]++;\n#ifdef MAKEINDEX\n\t\t\tfprintf(idxfile, \"%s@%s@\", fname, idxlabel);\n\t\t\tfor (j = 0; j < words; j++) {\n\t\t\t\th = NULL;\n\t\t\t\tscan_troff(wordlist[j], 1, &h);\n\t\t\t\tfprintf(idxfile, \"_\\b@%s\", h);\n\t\t\t\tfree(h);\n\t\t\t}\n\t\t\tfprintf(idxfile, \"\\n\");\n#endif\n\t\t\tout_html(\"<A NAME=\\\"\");\n\t\t\tout_html(idxlabel);\n\t\t\t \n\t\t\tout_html(\"\\\"></A>\");\n\t\t\tbreak;\n\t\tcase V('L', 'P'):\n\t\tcase V('P', 'P'):\n\t\t\tif (dl_set[itemdepth]) {\n\t\t\t\tout_html(\"</DL>\\n\");\n\t\t\t\tdl_set[itemdepth] = 0;\n\t\t\t}\n\t\t\tif (fillout)\n\t\t\t\tout_html(\"<P>\\n\");\n\t\t\telse {\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tNEWLINE[0] = '\\n';\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('H', 'P'):\n\t\t\tif (!dl_set[itemdepth]) {\n\t\t\t\tout_html(\"<DL COMPACT>\");\n\t\t\t\tdl_set[itemdepth] = 1;\n\t\t\t}\n\t\t\tout_html(\"<DT>\\n\");\n\t\t\tstill_dd = 1;\n\t\t\tc = skip_till_newline(c);\n\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('P', 'D'):\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('R', 's'):\t \n\t\tcase V('R', 'S'):\n\t\t\tsl = fill_words(c + j, wordlist, &words);\n\t\t\tj = 1;\n\t\t\tif (words > 0)\n\t\t\t\tscan_expression(wordlist[0], &j);\n\t\t\tif (j >= 0) {\n\t\t\t\titemdepth++;\n\t\t\t\tdl_set[itemdepth] = 0;\n\t\t\t\tout_html(\"<DL COMPACT><DT><DD>\");\n\t\t\t\tc = skip_till_newline(c);\n\t\t\t\tcurpos = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('R', 'e'):\t \n\t\tcase V('R', 'E'):\n\t\t\tif (itemdepth > 0) {\n\t\t\t\tif (dl_set[itemdepth])\n\t\t\t\t\tout_html(\"</DL>\");\n\t\t\t\tout_html(\"</DL>\\n\");\n\t\t\t\titemdepth--;\n\t\t\t}\n\t\t\tc = skip_till_newline(c);\n\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('S', 'B'):\n\t\t\tout_html(change_to_size(-1));\n\t\t\tout_html(change_to_font('B'));\n\t\t\tc = scan_troff(c + j, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(change_to_size('0'));\n\t\t\tbreak;\n\t\tcase V('S', 'M'):\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(change_to_size(-1));\n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = scan_troff(c, 1, NULL);\n\t\t\tout_html(change_to_size('0'));\n\t\t\tbreak;\n\t\tcase V('S', 's'):\t \n\t\t\tmandoc_command = 1;\n\t\tcase V('S', 'S'):\n\t\t\tmode = 1;\n\t\tcase V('S', 'h'):\t \n\t\t\t \n\t\t\tmandoc_command = !mode || mandoc_command;\n\t\tcase V('S', 'H'):\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\twhile (itemdepth || dl_set[itemdepth]) {\n\t\t\t\tout_html(\"</DL>\\n\");\n\t\t\t\tif (dl_set[itemdepth])\n\t\t\t\t\tdl_set[itemdepth] = 0;\n\t\t\t\telse if (itemdepth > 0)\n\t\t\t\t\titemdepth--;\n\t\t\t}\n\t\t\tout_html(change_to_font(0));\n\t\t\tout_html(change_to_size(0));\n\t\t\tif (!fillout) {\n\t\t\t\tfillout = 1;\n\t\t\t\tout_html(\"</PRE>\");\n\t\t\t}\n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tadd_to_index(mode, c);\n\t\t\tout_html(\"<A NAME=\\\"\");\n\t\t\tout_html(label);\n\t\t\t \n\t\t\tif (mode)\n\t\t\t\tout_html(\"\\\">&nbsp;</A>\\n<H4>\");\n\t\t\telse\n\t\t\t\tout_html(\"\\\">&nbsp;</A>\\n<H3>\");\n\t\t\tmandoc_synopsis = strncmp(c, \"SYNOPSIS\", 8) == 0;\n\t\t\tc = mandoc_command ? scan_troff_mandoc(c, 1, NULL) : scan_troff(c, 1, NULL);\n\t\t\tif (mode)\n\t\t\t\tout_html(\"</H4>\\n\");\n\t\t\telse\n\t\t\t\tout_html(\"</H3>\\n\");\n\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('T', 'S'):\n\t\t\tc = scan_table(c);\n\t\t\tbreak;\n\t\tcase V('D', 't'):\t \n\t\t\tmandoc_command = 1;\n\t\tcase V('T', 'H'):\n\t\t\tif (!output_possible) {\n\t\t\t\tsl = fill_words(c + j, wordlist, &words);\n\t\t\t\tif (words > 1) {\n\t\t\t\t\tchar\t*t;\n\t\t\t\t\tfor (i = 1; i < words; i++)\n\t\t\t\t\t\twordlist[i][-1] = '\\0';\n\t\t\t\t\t*sl = '\\0';\n\t\t\t\t\toutput_possible = 1;\n\t\t\t\t\tsprintf(th_page_and_sec, \"%s(%s)\", wordlist[0], wordlist[1]);\n\t\t\t\t\tif (words > 2) {\n\t\t\t\t\t\tt = unescape(wordlist[2]);\n\t\t\t\t\t\tstrncpy(th_datestr, t, sizeof(th_datestr));\n\t\t\t\t\t\tth_datestr[sizeof(th_datestr) - 1] = '\\0';\n\t\t\t\t\t} else\n\t\t\t\t\t\tth_datestr[0] = '\\0';\n\t\t\t\t\tif (words > 3) {\n\t\t\t\t\t\tt = unescape(wordlist[3]);\n\t\t\t\t\t\tstrncpy(th_version, t, sizeof(th_version));\n\t\t\t\t\t\tth_version[sizeof(th_version) - 1] = '\\0';\n\t\t\t\t\t} else\n\t\t\t\t\t\tth_version[0] = '\\0';\n\t\t\t\t\tout_html(\"<HTML><HEAD>\\n<TITLE>\");\n\t\t\t\t\tout_html(th_page_and_sec);\n\t\t\t\t\tout_html(\" Manual Page\");\n\t\t\t\t\tout_html(\"</TITLE>\\n</HEAD>\\n<BODY>\");\n\n\t\t\t\t\toutputPageHeader(th_page_and_sec, th_datestr, th_page_and_sec);\n\t\t\t\t\t\n\t\t\t\t\tout_html(\"<BR><A HREF=\\\"#index\\\">Index</A>\\n\");\n\t\t\t\t\t*sl = '\\n';\n\t\t\t\t\tout_html(\"<HR>\\n\");\n\t\t\t\t\tif (mandoc_command)\n\t\t\t\t\t\tout_html(\"<BR>BSD mandoc<BR>\");\n\t\t\t\t}\n\t\t\t\tc = sl + 1;\n\t\t\t} else\n\t\t\t\tc = skip_till_newline(c);\n\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('T', 'X'):\n\t\t\tsl = fill_words(c + j, wordlist, &words);\n\t\t\t*sl = '\\0';\n\t\t\tout_html(change_to_font('I'));\n\t\t\tif (words > 1)\n\t\t\t\twordlist[1][-1] = '\\0';\n\t\t\tc = lookup_abbrev(wordlist[0]);\n\t\t\tcurpos += strlen(c);\n\t\t\tout_html(c);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tif (words > 1)\n\t\t\t\tout_html(wordlist[1]);\n\t\t\t*sl = '\\n';\n\t\t\tc = sl + 1;\n\t\t\tbreak;\n\t\tcase V('r', 'm'):\n\t\t\t \n\t\tcase V('r', 'n'):\n\t\t\t \n\t\t\t{\n\t\t\t\tSTRDEF *de;\n\n\t\t\t\tc = c + j;\n\t\t\t\ti = V(c[0], c[1]);\n\t\t\t\tc = c + 2;\n\t\t\t\twhile (isspace(*c) && *c != '\\n')\n\t\t\t\t\tc++;\n\t\t\t\tj = V(c[0], c[1]);\n\t\t\t\twhile (*c && *c != '\\n')\n\t\t\t\t\tc++;\n\t\t\t\tc++;\n\t\t\t\tde = strdef;\n\t\t\t\twhile (de && de->nr != j)\n\t\t\t\t\tde = de->next;\n\t\t\t\tif (de) {\n\t\t\t\t\tif (de->st)\n\t\t\t\t\t\tfree(de->st);\n\t\t\t\t\tde->nr = 0;\n\t\t\t\t}\n\t\t\t\tde = strdef;\n\t\t\t\twhile (de && de->nr != i)\n\t\t\t\t\tde = de->next;\n\t\t\t\tif (de)\n\t\t\t\t\tde->nr = j;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('n', 'x'):\n\t\t\t \n\t\tcase V('i', 'n'):\n\t\t\t \n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('n', 'r'):\n\t\t\t \n\t\t\t{\n\t\t\t\tINTDEF *intd;\n\n\t\t\t\tc = c + j;\n\t\t\t\ti = V(c[0], c[1]);\n\t\t\t\tc = c + 2;\n\t\t\t\tintd = intdef;\n\t\t\t\twhile (intd && intd->nr != i)\n\t\t\t\t\tintd = intd->next;\n\t\t\t\tif (!intd) {\n\t\t\t\t\tintd = (INTDEF *) xmalloc(sizeof(INTDEF));\n\t\t\t\t\tintd->nr = i;\n\t\t\t\t\tintd->val = 0;\n\t\t\t\t\tintd->incr = 0;\n\t\t\t\t\tintd->next = intdef;\n\t\t\t\t\tintdef = intd;\n\t\t\t\t}\n\t\t\t\twhile (*c == ' ' || *c == '\\t')\n\t\t\t\t\tc++;\n\t\t\t\tc = scan_expression(c, &intd->val);\n\t\t\t\tif (*c != '\\n') {\n\t\t\t\t\twhile (*c == ' ' || *c == '\\t')\n\t\t\t\t\t\tc++;\n\t\t\t\t\tc = scan_expression(c, &intd->incr);\n\t\t\t\t}\n\t\t\t\tc = skip_till_newline(c);\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('a', 'm'):\n\t\t\t \n\t\t\t \n\t\t\tmode = 1;\n\t\tcase V('d', 'e'):\n\t\t\t \n\t\t\t \n\t\t\t{\n\t\t\t\tSTRDEF *de;\n\t\t\t\tint     olen = 0;\n\n\t\t\t\tc = c + j;\n\t\t\t\tsl = fill_words(c, wordlist, &words);\n\t\t\t\ti = V(c[0], c[1]);\n\t\t\t\tj = 2;\n\t\t\t\tif (words == 1)\n\t\t\t\t\twordlist[1] = \"..\";\n\t\t\t\telse {\n\t\t\t\t\twordlist[1]--;\n\t\t\t\t\twordlist[1][0] = '.';\n\t\t\t\t\tj = 3;\n\t\t\t\t}\n\t\t\t\tc = sl + 1;\n\t\t\t\tsl = c;\n\t\t\t\twhile (*c && strncmp(c, wordlist[1], j))\n\t\t\t\t\tc = skip_till_newline(c);\n\t\t\t\tde = defdef;\n\t\t\t\twhile (de && de->nr != i)\n\t\t\t\t\tde = de->next;\n\t\t\t\tif (mode && de)\n\t\t\t\t\tolen = strlen(de->st);\n\t\t\t\tj = olen + c - sl;\n\t\t\t\th = stralloc(j * 2 + 4);\n\t\t\t\tif (h) {\n\t\t\t\t\tfor (j = 0; j < olen; j++)\n\t\t\t\t\t\th[j] = de->st[j];\n\t\t\t\t\tif (!j || h[j - 1] != '\\n')\n\t\t\t\t\t\th[j++] = '\\n';\n\t\t\t\t\twhile (sl != c) {\n\t\t\t\t\t\tif (sl[0] == '\\\\' && sl[1] == '\\\\') {\n\t\t\t\t\t\t\th[j++] = '\\\\';\n\t\t\t\t\t\t\tsl++;\n\t\t\t\t\t\t} else\n\t\t\t\t\t\t\th[j++] = *sl;\n\t\t\t\t\t\tsl++;\n\t\t\t\t\t}\n\t\t\t\t\th[j] = '\\0';\n\t\t\t\t\tif (de) {\n\t\t\t\t\t\tif (de->st)\n\t\t\t\t\t\t\tfree(de->st);\n\t\t\t\t\t\tde->st = h;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tde = (STRDEF *) xmalloc(sizeof(STRDEF));\n\t\t\t\t\t\tde->nr = i;\n\t\t\t\t\t\tde->next = defdef;\n\t\t\t\t\t\tde->st = h;\n\t\t\t\t\t\tdefdef = de;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('B', 'l'):\t \n\t\t\t{\n\t\t\t\tchar    list_options[NULL_TERMINATED(MED_STR_MAX)];\n\t\t\t\tchar   *nl = strchr(c, '\\n');\n\n\t\t\t\tc = c + j;\n\t\t\t\tif (dl_set[itemdepth]) {\t \n\t\t\t\t\titemdepth++;\n\t\t\t\t}\n\t\t\t\tif (nl) {\t \n\t\t\t\t\tstrlimitcpy(list_options, c, nl - c, MED_STR_MAX);\n\t\t\t\t}\n\t\t\t\tif (strstr(list_options, \"-bullet\")) {\t \n\t\t\t\t\tdl_set[itemdepth] = BL_BULLET_LIST;\n\t\t\t\t\tout_html(\"<UL>\\n\");\n\t\t\t\t} else if (strstr(list_options, \"-enum\")) {\t \n\t\t\t\t\tdl_set[itemdepth] = BL_ENUM_LIST;\n\t\t\t\t\tout_html(\"<OL>\\n\");\n\t\t\t\t} else {\t \n\t\t\t\t\tdl_set[itemdepth] = BL_DESC_LIST;\n\t\t\t\t\tout_html(\"<DL COMPACT>\\n\");\n\t\t\t\t}\n\t\t\t\tif (fillout)\n\t\t\t\t\tout_html(\"<P>\\n\");\n\t\t\t\telse {\n\t\t\t\t\tout_html(NEWLINE);\n\t\t\t\t\tNEWLINE[0] = '\\n';\n\t\t\t\t}\n\t\t\t\tcurpos = 0;\n\t\t\t\tc = skip_till_newline(c);\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('E', 'l'):\t \n\t\t\tc = c + j;\n\t\t\tif (dl_set[itemdepth] & BL_DESC_LIST) {\n\t\t\t\tout_html(\"</DL>\\n\");\n\t\t\t} else if (dl_set[itemdepth] & BL_BULLET_LIST) {\n\t\t\t\tout_html(\"</UL>\\n\");\n\t\t\t} else if (dl_set[itemdepth] & BL_ENUM_LIST) {\n\t\t\t\tout_html(\"</OL>\\n\");\n\t\t\t}\n\t\t\tdl_set[itemdepth] = 0;\n\t\t\tif (itemdepth > 0)\n\t\t\t\titemdepth--;\n\t\t\tif (fillout)\n\t\t\t\tout_html(\"<P>\\n\");\n\t\t\telse {\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tNEWLINE[0] = '\\n';\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('I', 't'):\t \n\t\t\tc = c + j;\n\t\t\tif (strncmp(c, \"Xo\", 2) == 0 && isspace(*(c + 2))) {\n\t\t\t\tc = skip_till_newline(c);\n\t\t\t}\n\t\t\tif (dl_set[itemdepth] & BL_DESC_LIST) {\n\t\t\t\tout_html(\"<DT>\");\n\t\t\t\tout_html(change_to_font('B'));\n\t\t\t\tif (*c == '\\n') {\t \n\t\t\t\t\tc++;\n\t\t\t\t\tc = scan_troff(c, 1, NULL);\n\t\t\t\t} else {\t \n\t\t\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\t\t}\n\t\t\t\tout_html(change_to_font('R'));\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tout_html(\"<DD>\");\n\t\t\t} else if (dl_set[itemdepth] & (BL_BULLET_LIST | BL_ENUM_LIST)) {\n\t\t\t\tout_html(\"<LI>\");\n\t\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\t\tout_html(NEWLINE);\n\t\t\t}\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('B', 'k'):\t \n\t\tcase V('E', 'k'):\t \n\t\tcase V('D', 'd'):\t \n\t\tcase V('O', 's'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('B', 't'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tout_html(\" is currently in beta test.\");\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('B', 'x'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(\"BSD \");\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('D', 'l'):\t \n\t\t\tc = c + j;\n\t\t\tout_html(NEWLINE);\n\t\t\tout_html(\"<BLOCKQUOTE>\");\n\t\t\tout_html(change_to_font('L'));\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(\"</BLOCKQUOTE>\");\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('B', 'd'):\t \n\t\t\t{\t \n\t\t\t\tchar    bd_options[NULL_TERMINATED(MED_STR_MAX)];\n\t\t\t\tchar   *nl = strchr(c, '\\n');\n\n\t\t\t\tc = c + j;\n\t\t\t\tif (nl) {\n\t\t\t\t\tstrlimitcpy(bd_options, c, nl - c, MED_STR_MAX);\n\t\t\t\t}\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tmandoc_bd_options = 0;\t \n\t\t\t\tif (strstr(bd_options, \"-offset indent\")) {\n\t\t\t\t\tmandoc_bd_options |= BD_INDENT;\n\t\t\t\t\tout_html(\"<BLOCKQUOTE>\\n\");\n\t\t\t\t}\n\t\t\t\tif (strstr(bd_options, \"-literal\")\n\t\t\t\t    || strstr(bd_options, \"-unfilled\")) {\n\t\t\t\t\tif (fillout) {\n\t\t\t\t\t\tmandoc_bd_options |= BD_LITERAL;\n\t\t\t\t\t\tout_html(change_to_font(0));\n\t\t\t\t\t\tout_html(change_to_size('0'));\n\t\t\t\t\t\tout_html(\"<PRE>\\n\");\n\t\t\t\t\t}\n\t\t\t\t\tcurpos = 0;\n\t\t\t\t\tfillout = 0;\n\t\t\t\t}\n\t\t\t\tc = skip_till_newline(c);\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('E', 'd'):\t \n\t\t\tif (mandoc_bd_options & BD_LITERAL) {\n\t\t\t\tif (!fillout) {\n\t\t\t\t\tout_html(change_to_font(0));\n\t\t\t\t\tout_html(change_to_size('0'));\n\t\t\t\t\tout_html(\"</PRE>\\n\");\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (mandoc_bd_options & BD_INDENT)\n\t\t\t\tout_html(\"</BLOCKQUOTE>\\n\");\n\t\t\tcurpos = 0;\n\t\t\tfillout = 1;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('B', 'e'):\t \n\t\t\tc = c + j;\n\t\t\tif (fillout)\n\t\t\t\tout_html(\"<P>\");\n\t\t\telse {\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tNEWLINE[0] = '\\n';\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('X', 'r'):\t \n\t\t\t{\n\t\t\t\t \n\t\t\t\tchar    buff[NULL_TERMINATED(MED_STR_MAX)];\n\t\t\t\tchar   *bufptr;\n\n\t\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\t\tbufptr = buff;\n\t\t\t\tc = c + j;\n\t\t\t\tif (*c == '\\n')\n\t\t\t\t\tc++;\t \n\t\t\t\twhile (isspace(*c) && *c != '\\n')\n\t\t\t\t\tc++;\n\t\t\t\twhile (isalnum(*c)) {\t \n\t\t\t\t\t*bufptr = *c;\n\t\t\t\t\tbufptr++;\n\t\t\t\t\tif (bufptr >= buff + MED_STR_MAX)\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tc++;\n\t\t\t\t}\n\t\t\t\twhile (isspace(*c) && *c != '\\n')\n\t\t\t\t\tc++;\t \n\t\t\t\tif (isdigit(*c)) {\t \n\t\t\t\t\t*bufptr = '(';\n\t\t\t\t\tbufptr++;\n\t\t\t\t\tif (bufptr < buff + MED_STR_MAX) {\n\t\t\t\t\t\twhile (isalnum(*c)) {\n\t\t\t\t\t\t\t*bufptr = *c;\n\t\t\t\t\t\t\tbufptr++;\n\t\t\t\t\t\t\tif (bufptr >= buff + MED_STR_MAX)\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tc++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (bufptr < buff + MED_STR_MAX) {\n\t\t\t\t\t\t\t*bufptr = ')';\n\t\t\t\t\t\t\tbufptr++;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twhile (*c != '\\n') {\t \n\t\t\t\t\tif (!isspace(*c)) {\n\t\t\t\t\t\t*bufptr = *c;\n\t\t\t\t\t\tbufptr++;\n\t\t\t\t\t\tif (bufptr >= buff + MED_STR_MAX)\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tc++;\n\t\t\t\t}\n\t\t\t\t*bufptr = '\\n';\n\t\t\t\tscan_troff_mandoc(buff, 1, NULL);\n\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tif (fillout)\n\t\t\t\t\tcurpos++;\n\t\t\t\telse\n\t\t\t\t\tcurpos = 0;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase V('F', 'l'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tout_html(\"-\");\n\t\t\tif (*c != '\\n') {\n\t\t\t\tout_html(change_to_font('B'));\n\t\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\t\tout_html(change_to_font('R'));\n\t\t\t}\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('P', 'a'):\t \n\t\tcase V('P', 'f'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('P', 'p'):\t \n\t\t\tif (fillout)\n\t\t\t\tout_html(\"<P>\\n\");\n\t\t\telse {\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tNEWLINE[0] = '\\n';\n\t\t\t}\n\t\t\tcurpos = 0;\n\t\t\tc = skip_till_newline(c);\n\t\t\tbreak;\n\t\tcase V('D', 'q'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(\"``\");\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(\"''\");\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('O', 'p'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(\"[\");\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(\"]\");\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('O', 'o'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(\"[\");\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('O', 'c'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(\"]\");\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('P', 'q'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(\"(\");\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(\")\");\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('Q', 'l'):\t \n\t\t\t{\t \n\t\t\t\tchar   *sp;\n\n\t\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\t\tc = c + j;\n\t\t\t\tif (*c == '\\n')\n\t\t\t\t\tc++;\n\t\t\t\tsp = c;\n\t\t\t\tdo {\t \n\t\t\t\t\twhile (*sp && isspace(*sp))\n\t\t\t\t\t\tsp++;\n\t\t\t\t\twhile (*sp && !isspace(*sp))\n\t\t\t\t\t\tsp++;\n\t\t\t\t} while (*sp && isupper(*(sp - 2)) && islower(*(sp - 1)));\n\n\t\t\t\t \n\t\t\t\tif (*sp)\n\t\t\t\t\t*sp = '\\n';\n\t\t\t\tout_html(\"`\");\t \n\t\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\t\tout_html(\"'\");\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tif (fillout)\n\t\t\t\t\tcurpos++;\n\t\t\t\telse\n\t\t\t\t\tcurpos = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('S', 'q'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(\"`\");\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(\"'\");\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('A', 'r'):\t \n\t\t\t \n\t\t\tout_html(change_to_font('I'));\n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n') {\t \n\t\t\t\tout_html(\"file ...\");\n\t\t\t} else {\n\t\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\t}\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('A', 'd'):\t \n\t\tcase V('E', 'm'):\t \n\t\tcase V('V', 'a'):\t \n\t\tcase V('X', 'c'):\t \n\t\t\t \n\t\t\tout_html(change_to_font('I'));\n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('N', 'd'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(\" - \");\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('N', 'm'):\t \n\t\t\t{\n\t\t\t\tstatic char mandoc_name[NULL_TERMINATED(SMALL_STR_MAX)] = \"\";\n\n\t\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\t\tc = c + j;\n\t\t\t\tif (mandoc_synopsis) {\t \n\t\t\t\t\tstatic int count = 0;\t \n\n\t\t\t\t\tif (count) {\n\t\t\t\t\t\tout_html(\"<BR>\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tchar   *end = strchr(c, '\\n');\n\n\t\t\t\t\t\tif (end) {\t \n\t\t\t\t\t\t\tstrlimitcpy(mandoc_name, c, end - c, SMALL_STR_MAX);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcount++;\n\t\t\t\t}\n\t\t\t\tout_html(change_to_font('B'));\n\t\t\t\twhile (*c == ' ' || *c == '\\t')\n\t\t\t\t\tc++;\n\t\t\t\tif (*c == '\\n') {\t \n\t\t\t\t\tout_html(mandoc_name);\n\t\t\t\t} else {\n\t\t\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\t\t}\n\t\t\t\tout_html(change_to_font('R'));\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tif (fillout)\n\t\t\t\t\tcurpos++;\n\t\t\t\telse\n\t\t\t\t\tcurpos = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\tcase V('C', 'd'):\t \n\t\tcase V('C', 'm'):\t \n\t\tcase V('I', 'c'):\t \n\t\tcase V('M', 's'):\t \n\t\tcase V('O', 'r'):\t \n\t\tcase V('S', 'y'):\t \n\t\t\t \n\t\t\tout_html(change_to_font('B'));\n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('D', 'v'):\t \n\t\tcase V('E', 'v'):\t \n\t\tcase V('F', 'r'):\t \n\t\tcase V('L', 'i'):\t \n\t\tcase V('N', 'o'):\t \n\t\tcase V('N', 's'):\t \n\t\tcase V('T', 'n'):\t \n\t\tcase V('n', 'N'):\t \n\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tout_html(change_to_font('B'));\n\t\t\tc = scan_troff_mandoc(c, 1, NULL);\n\t\t\tout_html(change_to_font('R'));\n\t\t\tout_html(NEWLINE);\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('%', 'A'):\t \n\t\tcase V('%', 'D'):\n\t\tcase V('%', 'N'):\n\t\tcase V('%', 'O'):\n\t\tcase V('%', 'P'):\n\t\tcase V('%', 'Q'):\n\t\tcase V('%', 'V'):\n\t\t\tc = c + j;\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff(c, 1, NULL);\t \n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tcase V('%', 'B'):\n\t\tcase V('%', 'J'):\n\t\tcase V('%', 'R'):\n\t\tcase V('%', 'T'):\n\t\t\tc = c + j;\n\t\t\tout_html(change_to_font('I'));\n\t\t\tif (*c == '\\n')\n\t\t\t\tc++;\n\t\t\tc = scan_troff(c, 1, NULL);\t \n\t\t\tout_html(change_to_font('R'));\n\t\t\tif (fillout)\n\t\t\t\tcurpos++;\n\t\t\telse\n\t\t\t\tcurpos = 0;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\t \n\t\t\towndef = defdef;\n\t\t\twhile (owndef && owndef->nr != i)\n\t\t\t\towndef = owndef->next;\n\t\t\tif (owndef) {\n\t\t\t\tchar  **oldargument;\n\t\t\t\tint     deflen;\n\t\t\t\tint     onff;\n\n\t\t\t\tsl = fill_words(c + j, wordlist, &words);\n\t\t\t\tc = sl + 1;\n\t\t\t\t*sl = '\\0';\n\t\t\t\tfor (i = 1; i < words; i++)\n\t\t\t\t\twordlist[i][-1] = '\\0';\n\t\t\t\tfor (i = 0; i < words; i++) {\n\t\t\t\t\tchar   *h = NULL;\n\n\t\t\t\t\tif (mandoc_command) {\n\t\t\t\t\t\tscan_troff_mandoc(wordlist[i], 1, &h);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tscan_troff(wordlist[i], 1, &h);\n\t\t\t\t\t}\n\t\t\t\t\twordlist[i] = h;\n\t\t\t\t}\n\t\t\t\tfor (i = words; i < 20; i++)\n\t\t\t\t\twordlist[i] = NULL;\n\t\t\t\tdeflen = strlen(owndef->st);\n\t\t\t\tfor (i = 0; owndef->st[deflen + 2 + i] = owndef->st[i]; i++);\n\t\t\t\toldargument = argument;\n\t\t\t\targument = wordlist;\n\t\t\t\tonff = newline_for_fun;\n\t\t\t\tif (mandoc_command) {\n\t\t\t\t\tscan_troff_mandoc(owndef->st + deflen + 2, 0, NULL);\n\t\t\t\t} else {\n\t\t\t\t\tscan_troff(owndef->st + deflen + 2, 0, NULL);\n\t\t\t\t}\n\t\t\t\tnewline_for_fun = onff;\n\t\t\t\targument = oldargument;\n\t\t\t\tfor (i = 0; i < words; i++)\n\t\t\t\t\tif (wordlist[i])\n\t\t\t\t\t\tfree(wordlist[i]);\n\t\t\t\t*sl = '\\n';\n\t\t\t} else if (mandoc_command &&\n\t\t\t\t   ((isupper(*c) && islower(*(c + 1)))\n\t\t\t\t    || (islower(*c) && isupper(*(c + 1))))\n\t\t\t\t) {\t \n\t\t\t\tchar    buf[4];\n\n\t\t\t\tstrncpy(buf, c, 2);\n\t\t\t\tbuf[2] = ' ';\n\t\t\t\tbuf[3] = '\\0';\n\t\t\t\tout_html(buf);\t \n\t\t\t\tc = c + j;\n\t\t\t\ttrans_char(c, '\"', '\\a');\n\t\t\t\tif (*c == '\\n')\n\t\t\t\t\tc++;\n\t\t\t\tout_html(change_to_font('R'));\n\t\t\t\tc = scan_troff(c, 1, NULL);\n\t\t\t\tout_html(NEWLINE);\n\t\t\t\tif (fillout)\n\t\t\t\t\tcurpos++;\n\t\t\t\telse\n\t\t\t\t\tcurpos = 0;\n\t\t\t} else {\n\t\t\t\tc = skip_till_newline(c);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (fillout) {\n\t\tout_html(NEWLINE);\n\t\tcurpos++;\n\t}\n\tNEWLINE[0] = '\\n';\n\treturn c;\n}\n\nstatic void\nflush(void)\n{\n}\n\nstatic int contained_tab = 0;\nstatic int mandoc_line = 0;\t \n\n \nstatic char *\nscan_troff(char *c, int san, char **result)\n{\n\tchar   *h;\n\tchar    intbuff[NULL_TERMINATED(MED_STR_MAX)];\n\tint     ibp = 0;\n\tint     i;\n\tchar   *exbuffer;\n\tint     exbuffpos, exbuffmax, exscaninbuff, exnewline_for_fun;\n\tint     usenbsp = 0;\n\n#define FLUSHIBP  if (ibp) { intbuff[ibp]=0; out_html(intbuff); ibp=0; }\n\n\texbuffer = buffer;\n\texbuffpos = buffpos;\n\texbuffmax = buffmax;\n\texnewline_for_fun = newline_for_fun;\n\texscaninbuff = scaninbuff;\n\tnewline_for_fun = 0;\n\tif (result) {\n\t\tif (*result) {\n\t\t\tbuffer = *result;\n\t\t\tbuffpos = strlen(buffer);\n\t\t\tbuffmax = buffpos;\n\t\t} else {\n\t\t\tbuffer = stralloc(LARGE_STR_MAX);\n\t\t\tbuffpos = 0;\n\t\t\tbuffmax = LARGE_STR_MAX;\n\t\t}\n\t\tscaninbuff = 1;\n\t}\n\th = c;\n\t \n\n\twhile (*h && (!san || newline_for_fun || *h != '\\n')) {\n\n\t\tif (*h == escapesym) {\n\t\t\th++;\n\t\t\tFLUSHIBP;\n\t\t\th = scan_escape(h);\n\t\t} else if (*h == controlsym && h[-1] == '\\n') {\n\t\t\th++;\n\t\t\tFLUSHIBP;\n\t\t\th = scan_request(h);\n\t\t\tif (san && h[-1] == '\\n')\n\t\t\t\th--;\n\t\t} else if (mandoc_line\n\t\t\t   && *(h) && isupper(*(h))\n\t\t\t   && *(h + 1) && islower(*(h + 1))\n\t\t\t   && *(h + 2) && isspace(*(h + 2))) {\n\t\t\t \n\t\t\tFLUSHIBP;\n\t\t\th = scan_request(h);\n\t\t\tif (san && h[-1] == '\\n')\n\t\t\t\th--;\n\t\t} else if (*h == nobreaksym && h[-1] == '\\n') {\n\t\t\th++;\n\t\t\tFLUSHIBP;\n\t\t\th = scan_request(h);\n\t\t\tif (san && h[-1] == '\\n')\n\t\t\t\th--;\n\t\t} else {\n\t\t\tint     mx;\n\n\t\t\tif (h[-1] == '\\n' && still_dd && isalnum(*h)) {\n\t\t\t\t \n\t\t\t\tFLUSHIBP;\n\t\t\t\tout_html(\"<DD>\");\n\t\t\t\tcurpos = 0;\n\t\t\t\tstill_dd = 0;\n\t\t\t}\n\t\t\tswitch (*h) {\n\t\t\tcase '&':\n\t\t\t\tintbuff[ibp++] = '&';\n\t\t\t\tintbuff[ibp++] = 'a';\n\t\t\t\tintbuff[ibp++] = 'm';\n\t\t\t\tintbuff[ibp++] = 'p';\n\t\t\t\tintbuff[ibp++] = ';';\n\t\t\t\tcurpos++;\n\t\t\t\tbreak;\n\t\t\tcase '<':\n\t\t\t\tintbuff[ibp++] = '&';\n\t\t\t\tintbuff[ibp++] = 'l';\n\t\t\t\tintbuff[ibp++] = 't';\n\t\t\t\tintbuff[ibp++] = ';';\n\t\t\t\tcurpos++;\n\t\t\t\tbreak;\n\t\t\tcase '>':\n\t\t\t\tintbuff[ibp++] = '&';\n\t\t\t\tintbuff[ibp++] = 'g';\n\t\t\t\tintbuff[ibp++] = 't';\n\t\t\t\tintbuff[ibp++] = ';';\n\t\t\t\tcurpos++;\n\t\t\t\tbreak;\n\t\t\tcase '\"':\n\t\t\t\tintbuff[ibp++] = '&';\n\t\t\t\tintbuff[ibp++] = 'q';\n\t\t\t\tintbuff[ibp++] = 'u';\n\t\t\t\tintbuff[ibp++] = 'o';\n\t\t\t\tintbuff[ibp++] = 't';\n\t\t\t\tintbuff[ibp++] = ';';\n\t\t\t\tcurpos++;\n\t\t\t\tbreak;\n\t\t\tcase '\\n':\n\t\t\t\tif (h[-1] == '\\n' && fillout) {\n\t\t\t\t\tintbuff[ibp++] = '<';\n\t\t\t\t\tintbuff[ibp++] = 'P';\n\t\t\t\t\tintbuff[ibp++] = '>';\n\t\t\t\t}\n\t\t\t\tif (contained_tab && fillout) {\n\t\t\t\t\tintbuff[ibp++] = '<';\n\t\t\t\t\tintbuff[ibp++] = 'B';\n\t\t\t\t\tintbuff[ibp++] = 'R';\n\t\t\t\t\tintbuff[ibp++] = '>';\n\t\t\t\t}\n\t\t\t\tcontained_tab = 0;\n\t\t\t\tcurpos = 0;\n\t\t\t\tusenbsp = 0;\n\t\t\t\tintbuff[ibp++] = '\\n';\n\t\t\t\tbreak;\n\t\t\tcase '\\t':\n\t\t\t\t{\n\t\t\t\t\tint     curtab = 0;\n\n\t\t\t\t\tcontained_tab = 1;\n\t\t\t\t\tFLUSHIBP;\n\t\t\t\t\t \n\t\t\t\t\ttabstops[19] = curpos + 1;\n\t\t\t\t\twhile (curtab < maxtstop && tabstops[curtab] <= curpos)\n\t\t\t\t\t\tcurtab++;\n\t\t\t\t\tif (curtab < maxtstop) {\n\t\t\t\t\t\tif (!fillout) {\n\t\t\t\t\t\t\twhile (curpos < tabstops[curtab]) {\n\t\t\t\t\t\t\t\tintbuff[ibp++] = ' ';\n\t\t\t\t\t\t\t\tif (ibp > 480) {\n\t\t\t\t\t\t\t\t\tFLUSHIBP;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcurpos++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tout_html(\"<TT>\");\n\t\t\t\t\t\t\twhile (curpos < tabstops[curtab]) {\n\t\t\t\t\t\t\t\tout_html(\"&nbsp;\");\n\t\t\t\t\t\t\t\tcurpos++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tout_html(\"</TT>\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tif (*h == ' ' && (h[-1] == '\\n' || usenbsp)) {\n\t\t\t\t\tFLUSHIBP;\n\t\t\t\t\tif (!usenbsp && fillout) {\n\t\t\t\t\t\tout_html(\"<BR>\");\n\t\t\t\t\t\tcurpos = 0;\n\t\t\t\t\t}\n\t\t\t\t\tusenbsp = fillout;\n\t\t\t\t\tif (usenbsp)\n\t\t\t\t\t\tout_html(\"&nbsp;\");\n\t\t\t\t\telse\n\t\t\t\t\t\tintbuff[ibp++] = ' ';\n\t\t\t\t} else if (*h > 31 && *h < 127)\n\t\t\t\t\tintbuff[ibp++] = *h;\n\t\t\t\telse if (((unsigned char) (*h)) > 127) {\n\t\t\t\t\tintbuff[ibp++] = '&';\n\t\t\t\t\tintbuff[ibp++] = '#';\n\t\t\t\t\tintbuff[ibp++] = '0' + ((unsigned char) (*h)) / 100;\n\t\t\t\t\tintbuff[ibp++] = '0' + (((unsigned char) (*h)) % 100) / 10;\n\t\t\t\t\tintbuff[ibp++] = '0' + ((unsigned char) (*h)) % 10;\n\t\t\t\t\tintbuff[ibp++] = ';';\n\t\t\t\t}\n\t\t\t\tcurpos++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (ibp > (MED_STR_MAX - 20))\n\t\t\t\tFLUSHIBP;\n\t\t\th++;\n\t\t}\n\t}\n\tFLUSHIBP;\n\tif (buffer)\n\t\tbuffer[buffpos] = '\\0';\n\tif (san && *h)\n\t\th++;\n\tnewline_for_fun = exnewline_for_fun;\n\tif (result) {\n\t\t*result = buffer;\n\t\tbuffer = exbuffer;\n\t\tbuffpos = exbuffpos;\n\t\tbuffmax = exbuffmax;\n\t\tscaninbuff = exscaninbuff;\n\t}\n\treturn h;\n}\n\n\nstatic char *\nscan_troff_mandoc(char *c, int san, char **result)\n{\n\tchar   *ret, *end = c;\n\tint     oldval = mandoc_line;\n\n\tmandoc_line = 1;\n\twhile (*end && *end != '\\n') {\n\t\tend++;\n\t}\n\n\tif (end > c + 2\n\t    && ispunct(*(end - 1))\n\t    && isspace(*(end - 2)) && *(end - 2) != '\\n') {\n\t\t \n\t\t*(end - 2) = '\\n';\n\t\tret = scan_troff(c, san, result);\n\t\t*(end - 2) = *(end - 1);\n\t\t*(end - 1) = ' ';\n\t} else {\n\t\tret = scan_troff(c, san, result);\n\t}\n\tmandoc_line = oldval;\n\treturn ret;\n}\n\nint\nmain(int argc, char **argv)\n{\n\tFILE   *f;\n\tchar   *t;\n\tint     l, i;\n\tchar   *buf;\n\tchar   *h, *fullname;\n\tSTRDEF *stdf;\n\n\tt = NULL;\n\twhile ((i = getopt(argc, argv, \"\")) != EOF) {\n\t\tswitch (i) {\n\t\tdefault:\n\t\t\tusage();\n\t\t\texit(EXIT_USAGE);\n\t\t}\n\t}\n\n\tif (argc != 2) {\n\t\tusage();\n\t\texit(EXIT_USAGE);\n\t}\n\tmanpage = h = t = argv[1];\n\ti = 0;\n\n\tbuf = read_man_page(h);\n\tif (!buf) {\n\t\tfprintf(stderr, \"man2html: cannot read %s: %s\\n\", h, strerror(errno));\n\t\texit(1);\n\t}\n#ifdef MAKEINDEX\n\tidxfile = fopen(INDEXFILE, \"a\");\n#endif\n\tstdf = &standardchar[0];\n\ti = 0;\n\twhile (stdf->nr) {\n\t\tstdf->next = &standardchar[i];\n\t\tstdf = stdf->next;\n\t\ti++;\n\t}\n\tchardef = &standardchar[0];\n\n\tstdf = &standardstring[0];\n\ti = 0;\n\twhile (stdf->nr) {\n\t\tstdf->next = &standardstring[i];\n\t\tstdf = stdf->next;\n\t\ti++;\n\t}\n\tstrdef = &standardstring[0];\n\n\tintdef = &standardint[0];\n\ti = 0;\n\twhile (intdef->nr) {\n\t\tintdef->next = &standardint[i];\n\t\tintdef = intdef->next;\n\t\ti++;\n\t}\n\tintdef = &standardint[0];\n\n\tdefdef = NULL;\n\n\tscan_troff(buf + 1, 0, NULL);\n\n\twhile (itemdepth || dl_set[itemdepth]) {\n\t\tout_html(\"</DL>\\n\");\n\t\tif (dl_set[itemdepth])\n\t\t\tdl_set[itemdepth] = 0;\n\t\telse if (itemdepth > 0)\n\t\t\titemdepth--;\n\t}\n\n\tout_html(change_to_font(0));\n\tout_html(change_to_size(0));\n\tif (!fillout) {\n\t\tfillout = 1;\n\t\tout_html(\"</PRE>\");\n\t}\n\tout_html(NEWLINE);\n\n\tif (output_possible) {\n\t\toutputPageFooter(th_version, th_datestr, th_page_and_sec);\n\t\t \n\t\tfputs(\"<HR>\\n<A NAME=\\\"index\\\">&nbsp;</A><H2>Index</H2>\\n<DL>\\n\", stdout);\n\t\tmanidx[mip] = 0;\n\t\tfputs(manidx, stdout);\n\t\tif (subs)\n\t\t\tfputs(\"</DL>\\n\", stdout);\n\t\tfputs(\"</DL>\\n\", stdout);\n\t\tprint_sig();\n\t\tfputs(\"</BODY>\\n</HTML>\\n\", stdout);\n\t} else\n\t\tfprintf(stderr, \"man2html: no output produced\\n\");\n#ifdef MAKEINDEX\n\tif (idxfile)\n\t\tfclose(idxfile);\n#endif\n\texit(EXIT_SUCCESS);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}