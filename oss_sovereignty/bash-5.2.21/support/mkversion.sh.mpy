{
  "module_name": "mkversion.sh",
  "hash_id": "de10418ef27e7a6e635aa60c18befffe7637c52dccc7f62875b036da0be2bf08",
  "original_prompt": "Ingested from bash-5.2.21/support/mkversion.sh",
  "human_readable_source": "#! /bin/sh\n\n# Simple program to make new version numbers for the shell.\n# Big deal, but it was getting out of hand to do everything\n# in the makefile.  This creates a file named by the -o option,\n# otherwise everything is echoed to the standard output.\n\n# Copyright (C) 1996-2020 Free Software Foundation, Inc.\n#\n#   This program is free software: you can redistribute it and/or modify\n#   it under the terms of the GNU General Public License as published by\n#   the Free Software Foundation, either version 3 of the License, or\n#   (at your option) any later version.\n#\n#   This program is distributed in the hope that it will be useful,\n#   but WITHOUT ANY WARRANTY; without even the implied warranty of\n#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n#   GNU General Public License for more details.\n#\n#   You should have received a copy of the GNU General Public License\n#   along with this program.  If not, see <http://www.gnu.org/licenses/>.\n#\n\nPROGNAME=`basename $0`\nUSAGE=\"$PROGNAME [-b] [-S srcdir] -d version -p patchlevel [-s status] [-o outfile]\"\n\nsource_dir=\".\"\n\nwhile [ $# -gt 0 ]; do\n\tcase \"$1\" in\n\t-o)\tshift; OUTFILE=$1; shift ;;\n\t-b)\tshift; inc_build=yes ;;\n\t-s)\tshift; rel_status=$1; shift ;;\n\t-p)\tshift; patch_level=$1; shift ;;\n\t-d)\tshift; dist_version=$1; shift ;;\n\t-S)\tshift; source_dir=\"$1\"; shift ;;\n\t*)\techo \"$PROGNAME: usage: $USAGE\" >&2 ; exit 2 ;;\n\tesac\ndone\n\n# Required arguments\nif [ -z \"$dist_version\" ]; then\n\techo \"${PROGNAME}: required argument -d missing\" >&2\n\techo \"$PROGNAME: usage: $USAGE\" >&2\n\texit 1\nfi\n\n#if [ -z \"$patch_level\" ]; then\n#\techo \"${PROGNAME}: required argument -p missing\" >&2\n#\techo \"$PROGNAME: usage: $USAGE\" >&2\n#\texit 1\n#fi\n\n# Defaults\nif [ -z \"$rel_status\" ]; then\n\trel_status=\"release\"\nfi\n\nbuild_ver=\nif [ -r .build ]; then\n\tbuild_ver=`cat .build`\nfi\nif [ -z \"$build_ver\" ]; then\n\tbuild_ver=0\nfi\n\n# increment the build version if that's what's required\n\nif [ -n \"$inc_build\" ]; then\n\tbuild_ver=`expr 1 + $build_ver`\nfi\n\n# what's the patch level?\nif [ -z \"$patch_level\" ]; then\n\tpatchlevel_h=$source_dir/patchlevel.h\n\tif [ -s $patchlevel_h ]; then\n\t\tpatch_level=`cat $patchlevel_h | grep '^#define[ \t]*PATCHLEVEL' | awk '{print $NF}'`\n\tfi\nfi\nif [ -z \"$patch_level\" ]; then\n\tpatch_level=0\nfi\n\n# If we have an output file specified, make it the standard output\nif [ -n \"$OUTFILE\" ]; then\n\tif exec >$OUTFILE; then\n\t\t:\n\telse\n\t\techo \"${PROGNAME}: cannot redirect standard output to $OUTFILE\" >&2\n\t\texit 1\n\tfi\nfi\n\n# Output the leading comment.\necho \"/* Version control for the shell.  This file gets changed when you say\"\necho \"   \\`make version.h' to the Makefile.  It is created by mkversion. */\"\n\n# Output the distribution version.  Single numbers are converted to x.00.\n# Allow, as a special case, `[:digit:].[:digit:][:alpha:]' for\n# intermediate versions (e.g., `2.5a').\n# Any characters other than digits and `.' are invalid.\ncase \"$dist_version\" in\n[0-9].[0-9][a-z])\t;;\t# special case\n*[!0-9.]*)\techo \"mkversion.sh: ${dist_version}: bad distribution version\" >&2\n\t\texit 1 ;;\n*.*)\t;;\n*)\tdist_version=${dist_version}.00 ;;\nesac\n\ndist_major=`echo $dist_version | sed 's:\\..*$::'`\n[ -z \"${dist_major}\" ] && dist_major=0\n\ndist_minor=`echo $dist_version | sed 's:^.*\\.::'`\ncase \"$dist_minor\" in\n\"\")\tdist_minor=0 ;;\n[a-z])\tdist_minor=0${dist_minor} ;;\n?)\tdist_minor=${dist_minor} ;;\n*)\t;;\nesac\n\n#float_dist=`echo $dist_version | awk '{printf \"%.2f\\n\", $1}'`\nfloat_dist=${dist_major}.${dist_minor}\n\necho\necho \"/* The distribution version number of this shell. */\"\necho \"#define DISTVERSION \\\"${float_dist}\\\"\"\n\n# Output the patch level\n#echo\n#echo \"/* The patch level of this version of the shell. */\"\n#echo \"#define PATCHLEVEL ${patch_level}\"\n\n# Output the build version\necho\necho \"/* The last built version of this shell. */\"\necho \"#define BUILDVERSION ${build_ver}\"\n\n# Output the release status\necho\necho \"/* The release status of this shell. */\"\necho \"#define RELSTATUS \\\"${rel_status}\\\"\"\n\necho\necho \"/* The default shell compatibility-level (the current version) */\"\necho \"#define DEFAULT_COMPAT_LEVEL ${dist_major}${dist_minor}\"\n\n# Output the SCCS version string\nsccs_string=\"${float_dist}.${patch_level}(${build_ver}) ${rel_status} GNU\"\necho\necho \"/* A version string for use by sccs and the what command. */\"\necho \"#define SCCSVERSION \\\"@(#)Bash version ${sccs_string}\\\"\"\n\n# extern function declarations\n#echo\n#echo '/* Functions from version.c. */'\n#echo 'extern char *shell_version_string PARAMS((void));'\n#echo 'extern void show_shell_version PARAMS((int));'\n\nif [ -n \"$inc_build\" ]; then\n\t# Make sure we can write to .build\n\tif [ -f .build ] && [ ! -w .build ]; then\n\t\techo \"$PROGNAME: cannot write to .build, not incrementing build version\" >&2\n\telse\n\t\techo \"$build_ver\" > .build\n\tfi\nfi\n\t\nexit 0\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}