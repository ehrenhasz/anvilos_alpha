{
  "module_name": "array2.c",
  "hash_id": "22f856f08a4f284cbc76e2ad6aacfddecffadd6c57e0d542b3faeaedbc16723f",
  "original_prompt": "Ingested from bash-5.2.21/array2.c",
  "human_readable_source": " \n\n \n\n#include \"config.h\"\n\n#if defined (ARRAY_VARS)\n\n#if defined (HAVE_UNISTD_H)\n#  ifdef _MINIX\n#    include <sys/types.h>\n#  endif\n#  include <unistd.h>\n#endif\n\n#include <stdio.h>\n#include \"bashansi.h\"\n\n#include \"shell.h\"\n#include \"array.h\"\n#include \"builtins/common.h\"\n\n#define ARRAY_MAX_DOUBLE\t16777216\n\nstatic ARRAY_ELEMENT **array_copy_elements PARAMS((ARRAY *));\nstatic char *array_to_string_internal PARAMS((ARRAY *, arrayind_t, arrayind_t, char *, int));\n\nstatic char *spacesep = \" \";\n\nvoid\narray_alloc (a, n)\nARRAY\t*a;\narrayind_t n;\n{\n\tarrayind_t i;\n\n\tif (a == 0)\n\t\treturn;\t \n\ta->elements = (ARRAY_ELEMENT **)xmalloc (n * sizeof (ARRAY_ELEMENT *));\n\tfor (i = 0; i < n; i++)\n\t\ta->elements[i] = 0;\n\ta->alloc_size = n;\n}\n\nvoid\narray_resize (a, n)\nARRAY\t*a;\narrayind_t n;\n{\n\tARRAY_ELEMENT **e, *ae;\n\tarrayind_t i, nsize;\n\n\tif (a == 0)\n\t\treturn;\n\tif (a->alloc_size > 0 && n >= a->max_index && n <= a->alloc_size)\n\t\treturn;\n\n\te = (ARRAY_ELEMENT **)xrealloc (a->elements, n * sizeof (ARRAY_ELEMENT *));\n\ta->elements = e;\n\n\tfor (i = a->alloc_size; i < n; i++)\n\t\ta->elements[i] = (ARRAY_ELEMENT *)NULL;\n\n\ta->alloc_size = n;\n}\n\nvoid\narray_expand (a, n)\nARRAY\t*a;\narrayind_t\tn;\n{\n\tarrayind_t nsize;\n\n\tif (n >= a->alloc_size) {\n\t\tnsize = a->alloc_size ? a->alloc_size : ARRAY_DEFAULT_SIZE;\n\t\twhile (n >= nsize)\n\t\t\tnsize <<= 1;\n\t\tif (nsize > ARRAY_MAX_DOUBLE)\n\t\t\tnsize = n + ARRAY_DEFAULT_SIZE;\n\t\tarray_resize (a, nsize);\n\t}\n}\n\t\nARRAY *\narray_create()\n{\n\tARRAY\t*r;\n\n\tr = (ARRAY *)xmalloc(sizeof(ARRAY));\n\tr->max_index = r->first_index = -1;\n\tr->num_elements = 0;\n\tr->alloc_size = 0;\n\tr->elements = (ARRAY_ELEMENT **)NULL;\n\treturn(r);\n}\n\nvoid\narray_flush (a)\nARRAY\t*a;\n{\n\tint r;\n\n\tif (a == 0)\n\t\treturn;\n\tif (array_empty(a)) {\n\t\ta->max_index = a->first_index = -1;\t \n\t\treturn;\n\t}\n \tfor (r = a->first_index; r <= a->max_index; r++)\n\t\tif (a->elements[r]) {\n\t\t\tarray_dispose_element(a->elements[r]);\n\t\t\ta->elements[r] = 0;\n\t\t}\n\ta->max_index = a->first_index = -1;\n\ta->num_elements = 0;\n}\n\nvoid\narray_dispose_elements(elist)\nARRAY_ELEMENT\t**elist;\n{\n\tarrayind_t i;\n\n\tif (elist == 0)\n\t\treturn;\n\tfor (i = 0; elist[i]; i++)\n\t\tarray_dispose_element(elist[i]);\n\tfree(elist);\n}\n\nvoid\narray_dispose(a)\nARRAY\t*a;\n{\n\tif (a == 0)\n\t\treturn;\n\tarray_dispose_elements (a->elements);\n\ta->alloc_size = 0;\n\tfree(a);\n}\n\nstatic ARRAY_ELEMENT **\narray_copy_elements (a)\nARRAY\t*a;\n{\n\tARRAY_ELEMENT **ret;\n\tarrayind_t i;\n\n\tif (a == 0 || a->num_elements == 0)\n\t\treturn (ARRAY_ELEMENT **)NULL;\n\tret = (ARRAY_ELEMENT **)xmalloc (a->alloc_size * sizeof (ARRAY_ELEMENT *));\n\tfor (i = 0; i < a->alloc_size; i++)\n\t\tret[i] = a->elements[i] ? array_copy_element (a->elements[i]) : 0;\n\treturn ret;\n}\n\nARRAY *\narray_copy(a)\nARRAY\t*a;\n{\n\tARRAY *a1;\n\n\tif (a == 0)\n\t\treturn((ARRAY *) NULL);\n\ta1 = array_create();\n\ta1->max_index = a->max_index;\n\ta1->first_index = a->first_index;\n\ta1->num_elements = a->num_elements;\n\n\ta1->alloc_size = a->alloc_size;\n\ta1->elements = array_copy_elements (a);\n\n\treturn(a1);\n}\n\n \nARRAY *\narray_slice(array, s, e)\nARRAY\t\t*array;\narrayind_t\ts, e;\n{\n\tARRAY\t*a;\n\tARRAY_ELEMENT *p, *n;\n\tarrayind_t i, ni;\n\tarrayind_t mi, nsize;\n\n\ta = array_create ();\n\n\tnsize = ARRAY_DEFAULT_SIZE;\n\twhile (nsize < array->alloc_size)\n\t\tnsize <<= 1;\n\tif (nsize > ARRAY_MAX_DOUBLE)\n\t\tnsize = array->alloc_size + ARRAY_DEFAULT_SIZE;\n\n\tarray_resize (a, nsize);\n\n\tfor (i = s; i < e; i++) {\n\t\tp = array->elements[i];\n\t\tn = p ? array_create_element (element_index(p), element_value(p)) : (ARRAY_ELEMENT *)NULL;\n\t\ta->elements[i] = n;\t\t\n\t}\n\ta->num_elements = e - s;\n\ta->max_index = e;\n\ta->first_index = s;\n\n\treturn a;\n}\n\n \nvoid\narray_walk(a, func, udata)\nARRAY\t*a;\nsh_ae_map_func_t *func;\nvoid\t*udata;\n{\n\tarrayind_t i;\n\tregister ARRAY_ELEMENT *ae;\n\n\tif (a == 0 || array_empty(a))\n\t\treturn;\n\tfor (i = array_first_index (a); i <= array_max_index(a); i++) {\n\t\tif ((ae = a->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tif ((*func)(ae, udata) < 0)\n\t\t\treturn;\n\t}\n}\n\n \nARRAY_ELEMENT **\narray_shift(a, n, flags)\nARRAY\t*a;\nint\tn, flags;\n{\n\tARRAY_ELEMENT **r, *ae;\n\tregister arrayind_t ni, ri;\n\tint\ti, j;\n\n\tif (a == 0 || array_empty(a) || n <= 0)\n\t\treturn ((ARRAY_ELEMENT **)NULL);\n\n\tr = (ARRAY_ELEMENT **)xmalloc ((n + 1) * sizeof (ARRAY_ELEMENT *));\n\n\t \n\tif (n >= a->num_elements) {\n\t\tif (flags & AS_DISPOSE) {\n\t\t\tarray_flush (a);\n\t\t\treturn ((ARRAY_ELEMENT **)NULL);\n\t\t}\n\t\tfor (ri = 0, i = a->first_index; i <= a->max_index; i++)\n\t\t\tif (a->elements[i]) {\n\t\t\t\tr[ri++] = a->elements[i];\n\t\t\t\ta->elements[i] = 0;\n\t\t\t}\n\n\t\ta->first_index = a->max_index = -1;\n\t\ta->num_elements = 0;\n\t\tr[ri] = (ARRAY_ELEMENT *)NULL;\n\t\treturn r;\n\t}\n\n\t \n\tfor (i = a->first_index, ri = 0, j = 0; j < n; i++) {\n\t\tif ((ae = a->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tif (i > a->max_index)\n\t\t\tbreak;\n\t\tni = i + n;\n\t\tj++;\n\t\tif (ae)\n\t\t\tr[ri++] = a->elements[i];\n\t\ta->elements[i] = a->elements[ni];\n\t\tif (a->elements[i])\n\t\t\telement_index(a->elements[i]) = i;\n\t}\n\tr[ri]= (ARRAY_ELEMENT *)NULL;\n\n#ifdef DEBUG\nif (j < n)\n\titrace(\"array_shift: short count: j = %d n = %d\", j, n);\n#endif\n\n\t \n\tfor (; i <= a->max_index; i++) {\n\t\tni = i + n;\n\t\ta->elements[i] = (ni <= a->max_index) ? a->elements[ni] : (ARRAY_ELEMENT *)NULL;\n\t\tif (a->elements[i])\n\t\t\telement_index(a->elements[i]) = i;\n\t}\n\n\ta->num_elements -= n;\t\t \n\tif (a->num_elements == 0)\n\t\ta->first_index = a->max_index == -1;\n\telse {\n\t\ta->max_index -= n;\n\t\tfor (i = 0; i <= a->max_index; i++)\n\t\t\tif (a->elements[i])\n\t\t\t\tbreak;\n\t\ta->first_index = i;\n\t}\n\n\tif (flags & AS_DISPOSE) {\n\t\tfor (i = 0; i < ri; i++)\n\t\t\tarray_dispose_element(r[i]);\n\t\tfree (r);\n\t\treturn ((ARRAY_ELEMENT **)NULL);\n\t}\n\n\treturn r;\n}\n\n \nint\narray_rshift (a, n, s)\nARRAY\t*a;\nint\tn;\nchar\t*s;\n{\n\tregister ARRAY_ELEMENT\t*ae, *new;\n\tarrayind_t ni, nsize;\n\n\tif (a == 0 || (array_empty(a) && s == 0))\n\t\treturn 0;\n\telse if (n <= 0)\n\t\treturn (a->num_elements);\n\n\tif (n >= a->alloc_size)\n\t\tarray_expand(a, n);\n\n\t \n\tfor (ni = a->max_index; ni >= 0; ni--) {\n\t\ta->elements[ni+n] = a->elements[ni];\n\t\tif (a->elements[ni+n])\n\t\t\telement_index(a->elements[ni+n]) = ni + n;\n\t\ta->elements[ni] = (ARRAY_ELEMENT *)NULL;\n\t}\n\ta->max_index += n;\n\n#if 0\n\t \n\tfor (ni = a->first_index; ni >= 0 && ni < n; ni++)\n\t\ta->elements[ni] = (ARRAY_ELEMENT *)NULL;\n#endif\n\ta->first_index += n;\n\t\n\tif (s) {\n\t\tnew = array_create_element(0, s);\n\t\ta->elements[0] = new;\n\t\ta->num_elements++;\n\t\ta->first_index = 0;\n\t\tif (array_num_elements(a) == 1)\t\t \n\t\t\ta->max_index = 0;\n\t}\n\n\treturn (a->num_elements);\n}\n\nARRAY_ELEMENT *\narray_unshift_element(a)\nARRAY\t*a;\n{\n\tARRAY_ELEMENT **r, *ret;\n\t\n\tr = array_shift (a, 1, 0);\n\tret = r[0];\n\tfree (r);\n\treturn ret;\n}\n\nint\narray_shift_element(a, v)\nARRAY\t*a;\nchar\t*v;\n{\n\treturn (array_rshift (a, 1, v));\n}\n\nARRAY *\narray_quote(array)\nARRAY\t*array;\n{\n\tregister arrayind_t i;\n\tARRAY_ELEMENT\t*a;\n\tchar\t*t;\n\n\tif (array == 0 || array_head(array) == 0 || array_empty(array))\n\t\treturn (ARRAY *)NULL;\n\tfor (i = array_first_index(array); i <= array_max_index(array); i++) {\n\t\tif ((a = array->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tt = quote_string (a->value);\n\t\tFREE(a->value);\n\t\ta->value = t;\n\t}\n\treturn array;\n}\n\nARRAY *\narray_quote_escapes(array)\nARRAY\t*array;\n{\n\tregister arrayind_t i;\n\tARRAY_ELEMENT\t*a;\n\tchar\t*t;\n\n\tif (array == 0 || array_head(array) == 0 || array_empty(array))\n\t\treturn (ARRAY *)NULL;\n\tfor (i = array_first_index(array); i <= array_max_index(array); i++) {\n\t\tif ((a = array->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tt = quote_escapes (a->value);\n\t\tFREE(a->value);\n\t\ta->value = t;\n\t}\n\treturn array;\n}\n\nARRAY *\narray_dequote(array)\nARRAY\t*array;\n{\n\tregister arrayind_t i;\n\tARRAY_ELEMENT\t*a;\n\tchar\t*t;\n\n\tif (array == 0 || array_head(array) == 0 || array_empty(array))\n\t\treturn (ARRAY *)NULL;\n\n\tfor (i = array->first_index; i <= array->max_index; i++) {\n\t\tif ((a = array->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tt = dequote_string (a->value);\n\t\tFREE(a->value);\n\t\ta->value = t;\n\t}\n\treturn array;\n}\n\nARRAY *\narray_dequote_escapes(array)\nARRAY\t*array;\n{\n\tregister arrayind_t i;\n\tARRAY_ELEMENT\t*a;\n\tchar\t*t;\n\n\tif (array == 0 || array_head(array) == 0 || array_empty(array))\n\t\treturn (ARRAY *)NULL;\n\tfor (i = array->first_index; i <= array->max_index; i++) {\n\t\tif ((a = array->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tt = dequote_escapes (a->value);\n\t\tFREE(a->value);\n\t\ta->value = t;\n\t}\n\treturn array;\n}\n\nARRAY *\narray_remove_quoted_nulls(array)\nARRAY\t*array;\n{\n\tregister arrayind_t i;\n\tARRAY_ELEMENT\t*a;\n\n\tif (array == 0 || array_head(array) == 0 || array_empty(array))\n\t\treturn (ARRAY *)NULL;\n\tfor (i = array->first_index; i <= array->max_index; i++) {\n\t\tif ((a = array->elements[i]) == 0)\n\t\t\tcontinue;\n\t\ta->value = remove_quoted_nulls (a->value);\n\t}\n\treturn array;\n}\n\n \nchar *\narray_subrange (a, start, nelem, starsub, quoted, pflags)\nARRAY\t*a;\narrayind_t\tstart, nelem;\nint\tstarsub, quoted, pflags;\n{\n\tARRAY\t\t*a2;\n\tarrayind_t\ts, e;\n\tint\t\ti;\n\tchar\t\t*t;\n\tWORD_LIST\t*wl;\n\n\tif (array_empty (a) || start > array_max_index(a))\n\t\treturn ((char *)NULL);\n\n\t \n\tfor (s = start; a->elements[s] == 0 && s <= a->max_index; s++)\n\t\t;\n\n\tif (s > a->max_index)\n\t\treturn ((char *)NULL);\n\n\t \n\tfor (i = 0, e = s; e <= a->max_index && i < nelem; e++) {\n\t\tif (a->elements[e])\t\t \n\t\t\ti++;\n\t}\n\n\ta2 = array_slice(a, s, e);\n\n\twl = array_to_word_list(a2);\n\tarray_dispose(a2);\n\tif (wl == 0)\n\t\treturn (char *)NULL;\n\tt = string_list_pos_params(starsub ? '*' : '@', wl, quoted, pflags);\t \n\tdispose_words(wl);\n\n\treturn t;\n}\n\nchar *\narray_patsub (a, pat, rep, mflags)\nARRAY\t*a;\nchar\t*pat, *rep;\nint\tmflags;\n{\n\tchar\t*t;\n\tint\tpchar, qflags, pflags;\n\tWORD_LIST\t*wl, *save;\n\n\tif (a == 0 || array_head(a) == 0 || array_empty(a))\n\t\treturn ((char *)NULL);\n\n\twl = array_to_word_list(a);\n\tif (wl == 0)\n\t\treturn (char *)NULL;\n\n\tfor (save = wl; wl; wl = wl->next) {\n\t\tt = pat_subst (wl->word->word, pat, rep, mflags);\n\t\tFREE (wl->word->word);\n\t\twl->word->word = t;\n\t}\n\n\tpchar = (mflags & MATCH_STARSUB) == MATCH_STARSUB ? '*' : '@';\n\tqflags = (mflags & MATCH_QUOTED) == MATCH_QUOTED ? Q_DOUBLE_QUOTES : 0;\n\tpflags = (mflags & MATCH_ASSIGNRHS) ? PF_ASSIGNRHS : 0;\n\n\tt = string_list_pos_params (pchar, save, qflags, pflags);\n\tdispose_words(save);\n\n\treturn t;\n}\n\nchar *\narray_modcase (a, pat, modop, mflags)\nARRAY\t*a;\nchar\t*pat;\nint\tmodop;\nint\tmflags;\n{\n\tchar\t*t;\n\tint\tpchar, qflags, pflags;\n\tWORD_LIST\t*wl, *save;\n\n\tif (a == 0 || array_head(a) == 0 || array_empty(a))\n\t\treturn ((char *)NULL);\n\n\twl = array_to_word_list(a);\n\tif (wl == 0)\n\t\treturn ((char *)NULL);\n\n\tfor (save = wl; wl; wl = wl->next) {\n\t\tt = sh_modcase(wl->word->word, pat, modop);\n\t\tFREE(wl->word->word);\n\t\twl->word->word = t;\n\t}\n\n\tpchar = (mflags & MATCH_STARSUB) == MATCH_STARSUB ? '*' : '@';\n\tqflags = (mflags & MATCH_QUOTED) == MATCH_QUOTED ? Q_DOUBLE_QUOTES : 0;\n\tpflags = (mflags & MATCH_ASSIGNRHS) ? PF_ASSIGNRHS : 0;\n\n\tt = string_list_pos_params (pchar, save, qflags, pflags);\n\tdispose_words(save);\n\n\treturn t;\n}\n\n \nARRAY_ELEMENT *\narray_create_element(indx, value)\narrayind_t\tindx;\nchar\t*value;\n{\n\tARRAY_ELEMENT *r;\n\n\tr = (ARRAY_ELEMENT *)xmalloc(sizeof(ARRAY_ELEMENT));\n\tr->ind = indx;\n\tr->value = value ? savestring(value) : (char *)NULL;\n\treturn(r);\n}\n\nARRAY_ELEMENT *\narray_copy_element(ae)\nARRAY_ELEMENT\t*ae;\n{\n\treturn(ae ? array_create_element(element_index(ae), element_value(ae))\n\t\t  : (ARRAY_ELEMENT *) NULL);\n}\n\nvoid\narray_dispose_element(ae)\nARRAY_ELEMENT\t*ae;\n{\n\tif (ae) {\n\t\tFREE(ae->value);\n\t\tfree(ae);\n\t}\n}\n\n \nint\narray_insert(a, i, v)\nARRAY\t*a;\narrayind_t\ti;\nchar\t*v;\n{\n\tregister ARRAY_ELEMENT *new, *old;\n\tarrayind_t nsize;\n\n\tif (a == 0)\n\t\treturn(-1);\n\tif (i >= a->alloc_size)\n\t\tarray_expand(a, i);\n\told = a->elements[i];\n\tif (i > array_max_index(a))\n\t\ta->max_index = i;\n\tif (array_first_index(a) < 0 || i < array_first_index(a))\n\t\ta->first_index = i;\n\n\tif (old) {\t \n\t\tfree(element_value(old));\n\t\told->value = v ? savestring (v) : (char *)NULL;\n\t\told->ind = i;\n\t\treturn(0);\n\t} else {\n\t\ta->elements[i] = array_create_element(i, v);\n\t\ta->num_elements++;\n\t}\n\n\treturn (-1);\t\t \n}\n\n \nARRAY_ELEMENT *\narray_remove(a, i)\nARRAY\t*a;\narrayind_t\ti;\n{\n\tregister ARRAY_ELEMENT *ae;\n\tarrayind_t ind;\n\n\tif (a == 0 || array_empty(a))\n\t\treturn((ARRAY_ELEMENT *) NULL);\n\tif (i > array_max_index(a) || i < array_first_index(a))\n\t\treturn((ARRAY_ELEMENT *)NULL);\n\tae = a->elements[i];\n\ta->elements[i] = 0;\n\tif (ae) {\n\t\ta->num_elements--;\n\t\tif (a->num_elements == 0)\n\t\t\ta->first_index = a->max_index == -1;\n\t\tif (i == array_max_index(a)) {\n\t\t\tfor (ind = i; ind >= array_first_index(a); ind--)\n\t\t\t\tif (a->elements[ind])\n\t\t\t\t\tbreak;\n\t\t\ta->max_index = ind;\n\t\t}\n\t\tif (i == array_first_index(a)) {\n\t\t\tfor (ind = i; ind <= array_max_index(a); ind++)\n\t\t\t\tif (a->elements[ind])\n\t\t\t\t\tbreak;\n\t\t\ta->first_index = ind;\n\t\t}\n\t}\n\treturn (ae);\n}\n\n \nchar *\narray_reference(a, i)\nARRAY\t*a;\narrayind_t\ti;\n{\n\tregister ARRAY_ELEMENT *ae;\n\n\tif (a == 0 || array_empty(a))\n\t\treturn((char *) NULL);\n\tif (i > array_max_index(a) || i < array_first_index(a))\n\t\treturn((char *)NULL);\n\tae = a->elements[i];\n\n\treturn(ae ? element_value(ae) : (char *)NULL);\n}\n\n \n\nWORD_LIST *\narray_to_word_list(a)\nARRAY\t*a;\n{\n\tregister arrayind_t i;\n\tWORD_LIST\t*list;\n\tARRAY_ELEMENT\t*ae;\n\n\tif (a == 0 || array_empty(a))\n\t\treturn((WORD_LIST *)NULL);\n\tlist = (WORD_LIST *)NULL;\n\n\tfor (i = array_first_index(a); i <= array_max_index(a); i++) {\n\t\tif ((ae = a->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tlist = make_word_list (make_bare_word(element_value(ae)), list);\n\t}\n\treturn (REVERSE_LIST(list, WORD_LIST *));\n}\n\nARRAY *\narray_from_word_list (list)\nWORD_LIST\t*list;\n{\n\tARRAY\t*a;\n\n\tif (list == 0)\n\t\treturn((ARRAY *)NULL);\n\ta = array_create();\n\treturn (array_assign_list (a, list));\n}\n\nWORD_LIST *\narray_keys_to_word_list(a)\nARRAY\t*a;\n{\n\tarrayind_t\tind;\n\tWORD_LIST\t*list;\n\tARRAY_ELEMENT\t*ae;\n\tchar\t\t*t;\n\n\tif (a == 0 || array_empty(a))\n\t\treturn((WORD_LIST *)NULL);\n\tlist = (WORD_LIST *)NULL;\n\tfor (ind = array_first_index(a); ind <= array_max_index(a); ind++) {\n\t\tif ((ae = a->elements[ind]) == 0)\n\t\t\tcontinue;\n\t\tt = itos(element_index(ae));\n\t\tlist = make_word_list (make_bare_word(t), list);\n\t\tfree(t);\n\t}\n\treturn (REVERSE_LIST(list, WORD_LIST *));\n}\n\nWORD_LIST *\narray_to_kvpair_list(a)\nARRAY\t*a;\n{\n\tarrayind_t\tind;\n\tWORD_LIST\t*list;\n\tARRAY_ELEMENT\t*ae;\n\tchar\t\t*k, *v;\n\n\tif (a == 0 || array_empty(a))\n\t\treturn((WORD_LIST *)NULL);\n\tlist = (WORD_LIST *)NULL;\n\tfor (ind = array_first_index(a); ind <= array_max_index(a); ind++) {\n\t\tif ((ae = a->elements[ind]) == 0)\n\t\t\tcontinue;\n\t\tk = itos(element_index(ae));\n\t\tv = element_value (ae);\n\t\tlist = make_word_list (make_bare_word(k), list);\n\t\tlist = make_word_list (make_bare_word(v), list);\n\t\tfree(k);\n\t}\n\treturn (REVERSE_LIST(list, WORD_LIST *));\n}\n\nARRAY *\narray_assign_list (array, list)\nARRAY\t*array;\nWORD_LIST\t*list;\n{\n\tregister WORD_LIST *l;\n\tregister arrayind_t i;\n\n\tfor (l = list, i = 0; l; l = l->next, i++)\n\t\tarray_insert(array, i, l->word->word);\n\treturn array;\n}\n\nchar **\narray_to_argv (a, countp)\nARRAY\t*a;\nint\t*countp;\n{\n\tchar\t\t**ret, *t;\n\tint\t\ti;\n\tarrayind_t\tind;\n\tARRAY_ELEMENT\t*ae;\n\n\tif (a == 0 || array_empty(a)) {\n\t\tif (countp)\n\t\t\t*countp = 0;\n\t\treturn ((char **)NULL);\n\t}\n\tret = strvec_create (array_num_elements (a) + 1);\n\ti = 0;\n\tfor (ind = array_first_index(a); ind <= array_max_index(a); ind++) {\n\t\tif (a->elements[ind])\n\t\t\tret[i++] = savestring (element_value(a->elements[ind]));\n\t}\n\tret[i] = (char *)NULL;\n\tif (countp)\n\t\t*countp = i;\n\treturn (ret);\n}\n\nARRAY *\narray_from_argv(a, vec, count)\nARRAY\t*a;\nchar\t**vec;\nint\tcount;\n{\n\tarrayind_t\ti;\n\tchar\t*t;\n\n\tif (a == 0 || array_num_elements (a) == 0) {\n\t\tfor (i = 0; i < count; i++)\n\t\t\tarray_insert(a, i, vec[i]);\n\t\treturn a;\n\t}\n\n\t \n\tif (array_num_elements (a) == count && count == 1) {\n\t\tt = vec[0] ? savestring (vec[0]) : 0;\n\t\tARRAY_VALUE_REPLACE(a, 0, t);\n\t} else if (array_num_elements (a) <= count) {\n\t\t \n\t\tfor (i = 0; i < array_num_elements (a); i++) {\n\t\t\tt = vec[i] ? savestring (vec[i]) : 0;\n\t\t\tARRAY_VALUE_REPLACE(a, i, t);\n\t\t}\n\n\t\t \n\t\tfor ( ; i < count; i++)\n\t\t\tarray_insert(a, i, vec[i]);\n\t} else {\n\t\t \n\t\tfor (i = 0; i < count; i++) {\n\t\t\tt = vec[i] ? savestring (vec[i]) : 0;\n\t\t\tARRAY_VALUE_REPLACE(a, i, t);\n\t\t}\n\n\t\tfor ( ; i <= array_max_index (a); i++) {\n\t\t\tarray_dispose_element(a->elements[i]);\n\t\t\ta->elements[i] = (ARRAY_ELEMENT *)NULL;\n\t\t}\n\n\t\t \n\t\tset_max_index(a, count - 1);\n\t\tset_first_index(a, 0);\n\t\tset_num_elements(a, count);\n\t}\n\treturn a;\n}\n\n \narrayind_t\nelement_forw(a, ind)\nARRAY\t*a;\narrayind_t ind;\n{\n\tregister arrayind_t\ti;\n\n\tfor (i = ind + 1; i <= array_max_index(a); i++)\n\t\tif (a->elements[i])\n\t\t\tbreak;\n\tif (a->elements[i])\n\t\treturn i;\n\treturn (array_max_index(a));\n}\n\n \narrayind_t\nelement_back (a, ind)\nARRAY\t*a;\narrayind_t ind;\n{\n\tregister arrayind_t\ti;\n\n\tfor (i = ind - 1; i >= array_first_index(a); i--)\n\t\tif (a->elements[i])\n\t\t\tbreak;\n\tif (a->elements[i] && i >= array_first_index(a))\n\t\treturn i;\n\treturn (array_first_index(a));\n}\n\n \nstatic char *\narray_to_string_internal (a, start, end, sep, quoted)\nARRAY\t*a;\narrayind_t\tstart, end;\nchar\t*sep;\nint\tquoted;\n{\n\tarrayind_t i;\n\tchar\t*result, *t;\n\tARRAY_ELEMENT *ae;\n\tint\tslen, rsize, rlen, reg;\n\n\tslen = strlen(sep);\n\tresult = NULL;\n\tfor (rsize = rlen = 0, i = start; i <= end; i++) {\n\t\tif ((ae = a->elements[i]) == 0)\n\t\t\tcontinue;\n\t\tif (rsize == 0)\n\t\t\tresult = (char *)xmalloc (rsize = 64);\n\t\tif (element_value(ae)) {\n\t\t\tt = quoted ? quote_string(element_value(ae)) : element_value(ae);\n\t\t\treg = strlen(t);\n\t\t\tRESIZE_MALLOCED_BUFFER (result, rlen, (reg + slen + 2),\n\t\t\t\t\t\trsize, rsize);\n\t\t\tstrcpy(result + rlen, t);\n\t\t\trlen += reg;\n\t\t\tif (quoted)\n\t\t\t\tfree(t);\n\t\t\t \n\t\t\tif (element_forw(a, i) <= end) {\n\t\t\t\tstrcpy(result + rlen, sep);\n\t\t\t\trlen += slen;\n\t\t\t}\n\t\t}\n\t}\n\tif (result)\n\t\tresult[rlen] = '\\0';\t \n\treturn(result);\n}\n\nchar *\narray_to_kvpair (a, quoted)\nARRAY\t*a;\nint\tquoted;\n{\n\tarrayind_t\tind;\n\tchar\t*result, *valstr, *is;\n\tchar\tindstr[INT_STRLEN_BOUND(intmax_t) + 1];\n\tARRAY_ELEMENT *ae;\n\tint\trsize, rlen, elen;\n\n\tif (a == 0 || array_empty (a))\n\t\treturn((char *)NULL);\n\n\tresult = (char *)xmalloc (rsize = 128);\n\tresult[rlen = 0] = '\\0';\n\n\tfor (ind = array_first_index(a); ind <= array_max_index(a); ind++) {\n\t\tif ((ae = a->elements[ind]) == 0)\n\t\t\tcontinue;\n\t\tis = inttostr (element_index(ae), indstr, sizeof(indstr));\n\t\tvalstr = element_value (ae) ?\n\t\t\t\t(ansic_shouldquote (element_value (ae)) ?\n\t\t\t\t   ansic_quote (element_value(ae), 0, (int *)0) :\n\t\t\t\t   sh_double_quote (element_value (ae)))\n\t\t\t\t\t    : (char *)NULL;\n\t\telen = STRLEN (is) + 8 + STRLEN (valstr);\n\t\tRESIZE_MALLOCED_BUFFER (result, rlen, (elen + 1), rsize, rsize);\n\n\t\tstrcpy (result + rlen, is);\n\t\trlen += STRLEN (is);\n\t\tresult[rlen++] = ' ';\n\t\tif (valstr) {\n\t\t\tstrcpy (result + rlen, valstr);\n\t\t\trlen += STRLEN (valstr);\n\t\t} else {\n\t\t\tstrcpy (result + rlen, \"\\\"\\\"\");\n\t\t\trlen += 2;\n\t\t}\n\n\t\tif (ind < array_max_index (a))\n\t\t  result[rlen++] = ' ';\n\n\t\tFREE (valstr);\n\t}\n\tRESIZE_MALLOCED_BUFFER (result, rlen, 1, rsize, 8);\n\tresult[rlen] = '\\0';\n\n\tif (quoted) {\n\t\t \n\t\tvalstr = sh_single_quote (result);\n\t\tfree (result);\n\t\tresult = valstr;\n\t}\n\treturn(result);\n}\n\nchar *\narray_to_assign (a, quoted)\nARRAY\t*a;\nint\tquoted;\n{\n\tarrayind_t\tind;\n\tchar\t*result, *valstr, *is;\n\tchar\tindstr[INT_STRLEN_BOUND(intmax_t) + 1];\n\tARRAY_ELEMENT *ae;\n\tint\trsize, rlen, elen;\n\n\tif (a == 0 || array_empty (a))\n\t\treturn((char *)NULL);\n\n\tresult = (char *)xmalloc (rsize = 128);\n\tresult[0] = '(';\n\trlen = 1;\n\n\tfor (ind = array_first_index(a); ind <= array_max_index(a); ind++) {\n\t\tif ((ae = a->elements[ind]) == 0)\n\t\t\tcontinue;\n\t\tis = inttostr (element_index(ae), indstr, sizeof(indstr));\n\t\tvalstr = element_value (ae) ?\n\t\t\t\t(ansic_shouldquote (element_value (ae)) ?\n\t\t\t\t   ansic_quote (element_value(ae), 0, (int *)0) :\n\t\t\t\t   sh_double_quote (element_value (ae)))\n\t\t\t\t\t    : (char *)NULL;\n\t\telen = STRLEN (is) + 8 + STRLEN (valstr);\n\t\tRESIZE_MALLOCED_BUFFER (result, rlen, (elen + 1), rsize, rsize);\n\n\t\tresult[rlen++] = '[';\n\t\tstrcpy (result + rlen, is);\n\t\trlen += STRLEN (is);\n\t\tresult[rlen++] = ']';\n\t\tresult[rlen++] = '=';\n\t\tif (valstr) {\n\t\t\tstrcpy (result + rlen, valstr);\n\t\t\trlen += STRLEN (valstr);\n\t\t}\n\n\t\tif (ind < array_max_index(a))\n\t\t  result[rlen++] = ' ';\n\n\t\tFREE (valstr);\n\t}\n\tRESIZE_MALLOCED_BUFFER (result, rlen, 1, rsize, 8);\n\tresult[rlen++] = ')';\n\tresult[rlen] = '\\0';\n\tif (quoted) {\n\t\t \n\t\tvalstr = sh_single_quote (result);\n\t\tfree (result);\n\t\tresult = valstr;\n\t}\n\treturn(result);\n}\n\nchar *\narray_to_string (a, sep, quoted)\nARRAY\t*a;\nchar\t*sep;\nint\tquoted;\n{\n\tif (a == 0)\n\t\treturn((char *)NULL);\n\tif (array_empty(a))\n\t\treturn(savestring(\"\"));\n\treturn (array_to_string_internal (a, array_first_index(a), array_max_index(a), sep, quoted));\n}\n\n#if defined (INCLUDE_UNUSED) || defined (TEST_ARRAY)\n \nARRAY *\narray_from_string(s, sep)\nchar\t*s, *sep;\n{\n\tARRAY\t*a;\n\tWORD_LIST *w;\n\n\tif (s == 0)\n\t\treturn((ARRAY *)NULL);\n\tw = list_string (s, sep, 0);\n\tif (w == 0)\n\t\treturn((ARRAY *)NULL);\n\ta = array_from_word_list (w);\n\treturn (a);\n}\n#endif\n\n#if defined (TEST_ARRAY)\n \nint interrupt_immediately = 0;\n\nint\nsignal_is_trapped(s)\nint\ts;\n{\n\treturn 0;\n}\n\nvoid\nfatal_error(const char *s, ...)\n{\n\tfprintf(stderr, \"array_test: fatal memory error\\n\");\n\tabort();\n}\n\nvoid\nprogramming_error(const char *s, ...)\n{\n\tfprintf(stderr, \"array_test: fatal programming error\\n\");\n\tabort();\n}\n\nWORD_DESC *\nmake_bare_word (s)\nconst char\t*s;\n{\n\tWORD_DESC *w;\n\n\tw = (WORD_DESC *)xmalloc(sizeof(WORD_DESC));\n\tw->word = s ? savestring(s) : savestring (\"\");\n\tw->flags = 0;\n\treturn w;\n}\n\nWORD_LIST *\nmake_word_list(x, l)\nWORD_DESC\t*x;\nWORD_LIST\t*l;\n{\n\tWORD_LIST *w;\n\n\tw = (WORD_LIST *)xmalloc(sizeof(WORD_LIST));\n\tw->word = x;\n\tw->next = l;\n\treturn w;\n}\n\nWORD_LIST *\nlist_string(s, t, i)\nchar\t*s, *t;\nint\ti;\n{\n\tchar\t*r, *a;\n\tWORD_LIST\t*wl;\n\n\tif (s == 0)\n\t\treturn (WORD_LIST *)NULL;\n\tr = savestring(s);\n\twl = (WORD_LIST *)NULL;\n\ta = strtok(r, t);\n\twhile (a) {\n\t\twl = make_word_list (make_bare_word(a), wl);\n\t\ta = strtok((char *)NULL, t);\n\t}\n\treturn (REVERSE_LIST (wl, WORD_LIST *));\n}\n\nGENERIC_LIST *\nlist_reverse (list)\nGENERIC_LIST\t*list;\n{\n\tregister GENERIC_LIST *next, *prev;\n\n\tfor (prev = 0; list; ) {\n\t\tnext = list->next;\n\t\tlist->next = prev;\n\t\tprev = list;\n\t\tlist = next;\n\t}\n\treturn prev;\n}\n\nchar *\npat_subst(s, t, u, i)\nchar\t*s, *t, *u;\nint\ti;\n{\n\treturn ((char *)NULL);\n}\n\nchar *\nquote_string(s)\nchar\t*s;\n{\n\treturn savestring(s);\n}\n\nprint_element(ae)\nARRAY_ELEMENT\t*ae;\n{\n\tchar\tlbuf[INT_STRLEN_BOUND (intmax_t) + 1];\n\n\tprintf(\"array[%s] = %s\\n\",\n\t\tinttostr (element_index(ae), lbuf, sizeof (lbuf)),\n\t\telement_value(ae));\n}\n\nprint_array(a)\nARRAY\t*a;\n{\n\tprintf(\"\\n\");\n\tarray_walk(a, print_element, (void *)NULL);\n}\n\nmain()\n{\n\tARRAY\t*a, *new_a, *copy_of_a;\n\tARRAY_ELEMENT\t*ae, *aew;\n\tchar\t*s;\n\n\ta = array_create();\n\tarray_insert(a, 1, \"one\");\n\tarray_insert(a, 7, \"seven\");\n\tarray_insert(a, 4, \"four\");\n\tarray_insert(a, 1029, \"one thousand twenty-nine\");\n\tarray_insert(a, 12, \"twelve\");\n\tarray_insert(a, 42, \"forty-two\");\n\tprint_array(a);\n\ts = array_to_string (a, \" \", 0);\n\tprintf(\"s = %s\\n\", s);\n\tcopy_of_a = array_from_string(s, \" \");\n\tprintf(\"copy_of_a:\");\n\tprint_array(copy_of_a);\n\tarray_dispose(copy_of_a);\n\tprintf(\"\\n\");\n\tfree(s);\n\tae = array_remove(a, 4);\n\tarray_dispose_element(ae);\n\tae = array_remove(a, 1029);\n\tarray_dispose_element(ae);\n\tarray_insert(a, 16, \"sixteen\");\n\tprint_array(a);\n\ts = array_to_string (a, \" \", 0);\n\tprintf(\"s = %s\\n\", s);\n\tcopy_of_a = array_from_string(s, \" \");\n\tprintf(\"copy_of_a:\");\n\tprint_array(copy_of_a);\n\tarray_dispose(copy_of_a);\n\tprintf(\"\\n\");\n\tfree(s);\n\tarray_insert(a, 2, \"two\");\n\tarray_insert(a, 1029, \"new one thousand twenty-nine\");\n\tarray_insert(a, 0, \"zero\");\n\tarray_insert(a, 134, \"\");\n\tprint_array(a);\n\ts = array_to_string (a, \":\", 0);\n\tprintf(\"s = %s\\n\", s);\n\tcopy_of_a = array_from_string(s, \":\");\n\tprintf(\"copy_of_a:\");\n\tprint_array(copy_of_a);\n\tarray_dispose(copy_of_a);\n\tprintf(\"\\n\");\n\tfree(s);\n\tnew_a = array_copy(a);\n\tprint_array(new_a);\n\ts = array_to_string (new_a, \":\", 0);\n\tprintf(\"s = %s\\n\", s);\n\tcopy_of_a = array_from_string(s, \":\");\n\tfree(s);\n\tprintf(\"copy_of_a:\");\n\tprint_array(copy_of_a);\n\tarray_shift(copy_of_a, 2, AS_DISPOSE);\n\tprintf(\"copy_of_a shifted by two:\");\n\tprint_array(copy_of_a);\n\tae = array_shift(copy_of_a, 2, 0);\n\tprintf(\"copy_of_a shifted by two:\");\n\tprint_array(copy_of_a);\n\tfor ( ; ae; ) {\n\t\taew = element_forw(ae);\n\t\tarray_dispose_element(ae);\n\t\tae = aew;\n\t}\n\tarray_rshift(copy_of_a, 1, (char *)0);\n\tprintf(\"copy_of_a rshift by 1:\");\n\tprint_array(copy_of_a);\n\tarray_rshift(copy_of_a, 2, \"new element zero\");\n\tprintf(\"copy_of_a rshift again by 2 with new element zero:\");\n\tprint_array(copy_of_a);\n\ts = array_to_assign(copy_of_a, 0);\n\tprintf(\"copy_of_a=%s\\n\", s);\n\tfree(s);\n\tae = array_shift(copy_of_a, array_num_elements(copy_of_a), 0);\n\tfor ( ; ae; ) {\n\t\taew = element_forw(ae);\n\t\tarray_dispose_element(ae);\n\t\tae = aew;\n\t}\n\tarray_dispose(copy_of_a);\n\tprintf(\"\\n\");\n\tarray_dispose(a);\n\tarray_dispose(new_a);\n}\n\n#endif  \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}