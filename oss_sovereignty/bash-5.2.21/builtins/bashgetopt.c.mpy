{
  "module_name": "bashgetopt.c",
  "hash_id": "154e609cc5213b7f3be61cc2b9d0fbaaa7db373f546395399c238c7cde2ed208",
  "original_prompt": "Ingested from bash-5.2.21/builtins/bashgetopt.c",
  "human_readable_source": " \n\n \n\n#include <config.h>\n\n#if defined (HAVE_UNISTD_H)\n#  include <unistd.h>\n#endif\n\n#include \"../bashansi.h\"\n#include <chartypes.h>\n#include <errno.h>\n\n#include \"../shell.h\"\n#include \"common.h\"\n\n#include \"bashgetopt.h\"\n\n#define ISOPT(s)\t(((*(s) == '-') || (plus && *(s) == '+')) && (s)[1])\n#define NOTOPT(s)\t(((*(s) != '-') && (!plus || *(s) != '+')) || (s)[1] == '\\0')\n\t\t\t\nstatic int\tsp;\n\nchar    *list_optarg;\nint\tlist_optflags;\nint\tlist_optopt;\nint\tlist_opttype;\n\nstatic WORD_LIST *lhead = (WORD_LIST *)NULL;\nWORD_LIST\t*lcurrent = (WORD_LIST *)NULL;\nWORD_LIST\t*loptend;\t \n\nint\ninternal_getopt(list, opts)\nWORD_LIST\t*list;\nchar\t\t*opts;\n{\n\tregister int c;\n\tregister char *cp;\n\tint\tplus;\t \n\tstatic char errstr[3] = { '-', '\\0', '\\0' };\n\n\tplus = *opts == '+';\n\tif (plus)\n\t\topts++;\n\n\tif (list == 0) {\n\t\tlist_optarg = (char *)NULL;\n\t\tlist_optflags = 0;\n\t\tloptend = (WORD_LIST *)NULL;\t \n\t\treturn -1;\n\t}\n\n\tif (list != lhead || lhead == 0) {\n\t\t \n\t\tsp = 1;\n\t\tlcurrent = lhead = list;\n\t\tloptend = (WORD_LIST *)NULL;\n\t}\n\n\tif (sp == 1) {\n\t\tif (lcurrent == 0 || NOTOPT(lcurrent->word->word)) {\n\t\t    \tlhead = (WORD_LIST *)NULL;\n\t\t    \tloptend = lcurrent;\n\t\t\treturn(-1);\n\t\t} else if (ISHELP (lcurrent->word->word)) {\n\t\t\tlhead = (WORD_LIST *)NULL;\n\t\t\tloptend = lcurrent;\n\t\t\treturn (GETOPT_HELP);\n\t\t} else if (lcurrent->word->word[0] == '-' &&\n\t\t\t   lcurrent->word->word[1] == '-' &&\n\t\t\t   lcurrent->word->word[2] == 0) {\n\t\t\tlhead = (WORD_LIST *)NULL;\n\t\t\tloptend = lcurrent->next;\n\t\t\treturn(-1);\n\t\t}\n\t\terrstr[0] = list_opttype = lcurrent->word->word[0];\n\t}\n\n\tlist_optopt = c = lcurrent->word->word[sp];\n\n\tif (c == ':' || (cp = strchr(opts, c)) == NULL) {\n\t\terrstr[1] = c;\n\t\tsh_invalidopt (errstr);\t\t\n\t\tif (lcurrent->word->word[++sp] == '\\0') {\n\t\t\tlcurrent = lcurrent->next;\n\t\t\tsp = 1;\n\t\t}\n\t\tlist_optarg = NULL;\n\t\tlist_optflags = 0;\n\t\tif (lcurrent)\n\t\t\tloptend = lcurrent->next;\n\t\treturn('?');\n\t}\n\n\tif (*++cp == ':' || *cp == ';') {\n\t\t \n\t\t \n\t\t \n\t\tif (lcurrent->word->word[sp+1]) {\n\t\t\tlist_optarg = lcurrent->word->word + sp + 1;\n\t\t\tlist_optflags = 0;\n\t\t\tlcurrent = lcurrent->next;\n\t\t \n#if 0\n\t\t} else if (lcurrent->next && (*cp == ':' || lcurrent->next->word->word[0] != '-')) {\n#else\n\t\t} else if (lcurrent->next && (*cp == ':' || NOTOPT(lcurrent->next->word->word))) {\n#endif\n\t\t\tlcurrent = lcurrent->next;\n\t\t\tlist_optarg = lcurrent->word->word;\n\t\t\tlist_optflags = lcurrent->word->flags;\n\t\t\tlcurrent = lcurrent->next;\n\t\t} else if (*cp == ';') {\n\t\t\tlist_optarg = (char *)NULL;\n\t\t\tlist_optflags = 0;\n\t\t\tlcurrent = lcurrent->next;\n\t\t} else {\t \n\t\t\terrstr[1] = c;\n\t\t\tsh_needarg (errstr);\n\t\t\tsp = 1;\n\t\t\tlist_optarg = (char *)NULL;\n\t\t\tlist_optflags = 0;\n\t\t\treturn('?');\n\t\t}\n\t\tsp = 1;\n\t} else if (*cp == '#') {\n\t\t \n\t\tif (lcurrent->word->word[sp+1]) {\n\t\t\tif (DIGIT(lcurrent->word->word[sp+1])) {\n\t\t\t\tlist_optarg = lcurrent->word->word + sp + 1;\n\t\t\t\tlist_optflags = 0;\n\t\t\t\tlcurrent = lcurrent->next;\n\t\t\t} else {\n\t\t\t\tlist_optarg = (char *)NULL;\n\t\t\t\tlist_optflags = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tif (lcurrent->next && legal_number(lcurrent->next->word->word, (intmax_t *)0)) {\n\t\t\t\tlcurrent = lcurrent->next;\n\t\t\t\tlist_optarg = lcurrent->word->word;\n\t\t\t\tlist_optflags = lcurrent->word->flags;\n\t\t\t\tlcurrent = lcurrent->next;\n\t\t\t} else {\n\t\t\t\terrstr[1] = c;\n\t\t\t\tsh_neednumarg (errstr);\n\t\t\t\tsp = 1;\n\t\t\t\tlist_optarg = (char *)NULL;\n\t\t\t\tlist_optflags = 0;\n\t\t\t\treturn ('?');\n\t\t\t}\n\t\t}\n\n\t} else {\n\t\t \n\t\tif (lcurrent->word->word[++sp] == '\\0') {\n\t\t\tsp = 1;\n\t\t\tlcurrent = lcurrent->next;\n\t\t}\n\t\tlist_optarg = (char *)NULL;\n\t\tlist_optflags = 0;\n\t}\n\n\treturn(c);\n}\n\n \n\nvoid\nreset_internal_getopt ()\n{\n\tlhead = lcurrent = loptend = (WORD_LIST *)NULL;\n\tsp = 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}