{
  "module_name": "localcharset.c",
  "hash_id": "43567b1d10a6bdca41f97e68ec01c6d5e457d2c8d8197437dce100b9062e0b81",
  "original_prompt": "Ingested from bash-5.2.21/lib/intl/localcharset.c",
  "human_readable_source": " \n\n \n\n \n\n#ifdef HAVE_CONFIG_H\n# include <config.h>\n#endif\n\n \n#include \"localcharset.h\"\n\n#if HAVE_STDDEF_H\n# include <stddef.h>\n#endif\n\n#include <stdio.h>\n#if HAVE_STRING_H\n# include <string.h>\n#else\n# include <strings.h>\n#endif\n#if HAVE_STDLIB_H\n# include <stdlib.h>\n#endif\n\n#if defined _WIN32 || defined __WIN32__\n# undef WIN32    \n# define WIN32\n#endif\n\n#if defined __EMX__\n \n# define OS2\n#endif\n\n#if !defined WIN32\n# if HAVE_LANGINFO_CODESET\n#  include <langinfo.h>\n# else\n#  if HAVE_SETLOCALE\n#   include <locale.h>\n#  endif\n# endif\n#elif defined WIN32\n# define WIN32_LEAN_AND_MEAN\n# include <windows.h>\n#endif\n#if defined OS2\n# define INCL_DOS\n# include <os2.h>\n#endif\n\n#if ENABLE_RELOCATABLE\n# include \"relocatable.h\"\n#else\n# define relocate(pathname) (pathname)\n#endif\n\n#if defined _WIN32 || defined __WIN32__ || defined __EMX__ || defined __DJGPP__\n   \n# define ISSLASH(C) ((C) == '/' || (C) == '\\\\')\n#endif\n\n#ifndef DIRECTORY_SEPARATOR\n# define DIRECTORY_SEPARATOR '/'\n#endif\n\n#ifndef ISSLASH\n# define ISSLASH(C) ((C) == DIRECTORY_SEPARATOR)\n#endif\n\n#ifdef HAVE_GETC_UNLOCKED\n# undef getc\n# define getc getc_unlocked\n#endif\n\n \n#if __STDC__ != 1\n# define volatile  \n#endif\n \nstatic const char * volatile charset_aliases;\n\n \nstatic const char *\nget_charset_aliases ()\n{\n  const char *cp;\n\n  cp = charset_aliases;\n  if (cp == NULL)\n    {\n#if !(defined VMS || defined WIN32)\n      FILE *fp;\n      const char *dir = relocate (LIBDIR);\n      const char *base = \"charset.alias\";\n      char *file_name;\n\n       \n      {\n\tsize_t dir_len = strlen (dir);\n\tsize_t base_len = strlen (base);\n\tint add_slash = (dir_len > 0 && !ISSLASH (dir[dir_len - 1]));\n\tfile_name = (char *) malloc (dir_len + add_slash + base_len + 1);\n\tif (file_name != NULL)\n\t  {\n\t    memcpy (file_name, dir, dir_len);\n\t    if (add_slash)\n\t      file_name[dir_len] = DIRECTORY_SEPARATOR;\n\t    memcpy (file_name + dir_len + add_slash, base, base_len + 1);\n\t  }\n      }\n\n      if (file_name == NULL || (fp = fopen (file_name, \"r\")) == NULL)\n\t \n\tcp = \"\";\n      else\n\t{\n\t   \n\t  int c;\n\t  char buf1[50+1];\n\t  char buf2[50+1];\n\t  char *res_ptr = NULL;\n\t  size_t res_size = 0;\n\t  size_t l1, l2;\n\n\t  for (;;)\n\t    {\n\t      c = getc (fp);\n\t      if (c == EOF)\n\t\tbreak;\n\t      if (c == '\\n' || c == ' ' || c == '\\t')\n\t\tcontinue;\n\t      if (c == '#')\n\t\t{\n\t\t   \n\t\t  do\n\t\t    c = getc (fp);\n\t\t  while (!(c == EOF || c == '\\n'));\n\t\t  if (c == EOF)\n\t\t    break;\n\t\t  continue;\n\t\t}\n\t      ungetc (c, fp);\n\t      if (fscanf (fp, \"%50s %50s\", buf1, buf2) < 2)\n\t\tbreak;\n\t      l1 = strlen (buf1);\n\t      l2 = strlen (buf2);\n\t      if (res_size == 0)\n\t\t{\n\t\t  res_size = l1 + 1 + l2 + 1;\n\t\t  res_ptr = (char *) malloc (res_size + 1);\n\t\t}\n\t      else\n\t\t{\n\t\t  res_size += l1 + 1 + l2 + 1;\n\t\t  res_ptr = (char *) realloc (res_ptr, res_size + 1);\n\t\t}\n\t      if (res_ptr == NULL)\n\t\t{\n\t\t   \n\t\t  res_size = 0;\n\t\t  break;\n\t\t}\n\t      strcpy (res_ptr + res_size - (l2 + 1) - (l1 + 1), buf1);\n\t      strcpy (res_ptr + res_size - (l2 + 1), buf2);\n\t    }\n\t  fclose (fp);\n\t  if (res_size == 0)\n\t    cp = \"\";\n\t  else\n\t    {\n\t      *(res_ptr + res_size) = '\\0';\n\t      cp = res_ptr;\n\t    }\n\t}\n\n      if (file_name != NULL)\n\tfree (file_name);\n\n#else\n\n# if defined VMS\n       \n       \n      cp = \"ISO8859-1\" \"\\0\" \"ISO-8859-1\" \"\\0\"\n\t   \"ISO8859-2\" \"\\0\" \"ISO-8859-2\" \"\\0\"\n\t   \"ISO8859-5\" \"\\0\" \"ISO-8859-5\" \"\\0\"\n\t   \"ISO8859-7\" \"\\0\" \"ISO-8859-7\" \"\\0\"\n\t   \"ISO8859-8\" \"\\0\" \"ISO-8859-8\" \"\\0\"\n\t   \"ISO8859-9\" \"\\0\" \"ISO-8859-9\" \"\\0\"\n\t    \n\t   \"eucJP\" \"\\0\" \"EUC-JP\" \"\\0\"\n\t   \"SJIS\" \"\\0\" \"SHIFT_JIS\" \"\\0\"\n\t   \"DECKANJI\" \"\\0\" \"DEC-KANJI\" \"\\0\"\n\t   \"SDECKANJI\" \"\\0\" \"EUC-JP\" \"\\0\"\n\t    \n\t   \"eucTW\" \"\\0\" \"EUC-TW\" \"\\0\"\n\t   \"DECHANYU\" \"\\0\" \"DEC-HANYU\" \"\\0\"\n\t   \"DECHANZI\" \"\\0\" \"GB2312\" \"\\0\"\n\t    \n\t   \"DECKOREAN\" \"\\0\" \"EUC-KR\" \"\\0\";\n# endif\n\n# if defined WIN32\n       \n\n      cp = \"CP936\" \"\\0\" \"GBK\" \"\\0\"\n\t   \"CP1361\" \"\\0\" \"JOHAB\" \"\\0\"\n\t   \"CP20127\" \"\\0\" \"ASCII\" \"\\0\"\n\t   \"CP20866\" \"\\0\" \"KOI8-R\" \"\\0\"\n\t   \"CP21866\" \"\\0\" \"KOI8-RU\" \"\\0\"\n\t   \"CP28591\" \"\\0\" \"ISO-8859-1\" \"\\0\"\n\t   \"CP28592\" \"\\0\" \"ISO-8859-2\" \"\\0\"\n\t   \"CP28593\" \"\\0\" \"ISO-8859-3\" \"\\0\"\n\t   \"CP28594\" \"\\0\" \"ISO-8859-4\" \"\\0\"\n\t   \"CP28595\" \"\\0\" \"ISO-8859-5\" \"\\0\"\n\t   \"CP28596\" \"\\0\" \"ISO-8859-6\" \"\\0\"\n\t   \"CP28597\" \"\\0\" \"ISO-8859-7\" \"\\0\"\n\t   \"CP28598\" \"\\0\" \"ISO-8859-8\" \"\\0\"\n\t   \"CP28599\" \"\\0\" \"ISO-8859-9\" \"\\0\"\n\t   \"CP28605\" \"\\0\" \"ISO-8859-15\" \"\\0\";\n# endif\n#endif\n\n      charset_aliases = cp;\n    }\n\n  return cp;\n}\n\n \n\n#ifdef STATIC\nSTATIC\n#endif\nconst char *\nlocale_charset ()\n{\n  const char *codeset;\n  const char *aliases;\n\n#if !(defined WIN32 || defined OS2)\n\n# if HAVE_LANGINFO_CODESET\n\n   \n  codeset = nl_langinfo (CODESET);\n\n# else\n\n   \n  const char *locale = NULL;\n\n   \n#  if HAVE_SETLOCALE && 0\n  locale = setlocale (LC_CTYPE, NULL);\n#  endif\n  if (locale == NULL || locale[0] == '\\0')\n    {\n      locale = getenv (\"LC_ALL\");\n      if (locale == NULL || locale[0] == '\\0')\n\t{\n\t  locale = getenv (\"LC_CTYPE\");\n\t  if (locale == NULL || locale[0] == '\\0')\n\t    locale = getenv (\"LANG\");\n\t}\n    }\n\n   \n  codeset = locale;\n\n# endif\n\n#elif defined WIN32\n\n  static char buf[2 + 10 + 1];\n\n   \n  sprintf (buf, \"CP%u\", GetACP ());\n  codeset = buf;\n\n#elif defined OS2\n\n  const char *locale;\n  static char buf[2 + 10 + 1];\n  ULONG cp[3];\n  ULONG cplen;\n\n   \n  locale = getenv (\"LC_ALL\");\n  if (locale == NULL || locale[0] == '\\0')\n    {\n      locale = getenv (\"LC_CTYPE\");\n      if (locale == NULL || locale[0] == '\\0')\n\tlocale = getenv (\"LANG\");\n    }\n  if (locale != NULL && locale[0] != '\\0')\n    {\n       \n      const char *dot = strchr (locale, '.');\n\n      if (dot != NULL)\n\t{\n\t  const char *modifier;\n\n\t  dot++;\n\t   \n\t  modifier = strchr (dot, '@');\n\t  if (modifier == NULL)\n\t    return dot;\n\t  if (modifier - dot < sizeof (buf))\n\t    {\n\t      memcpy (buf, dot, modifier - dot);\n\t      buf [modifier - dot] = '\\0';\n\t      return buf;\n\t    }\n\t}\n\n       \n      codeset = locale;\n    }\n  else\n    {\n       \n      if (DosQueryCp (sizeof (cp), cp, &cplen))\n\tcodeset = \"\";\n      else\n\t{\n\t  sprintf (buf, \"CP%u\", cp[0]);\n\t  codeset = buf;\n\t}\n    }\n\n#endif\n\n  if (codeset == NULL)\n     \n    codeset = \"\";\n\n   \n  for (aliases = get_charset_aliases ();\n       *aliases != '\\0';\n       aliases += strlen (aliases) + 1, aliases += strlen (aliases) + 1)\n    if (strcmp (codeset, aliases) == 0\n\t|| (aliases[0] == '*' && aliases[1] == '\\0'))\n      {\n\tcodeset = aliases + strlen (aliases) + 1;\n\tbreak;\n      }\n\n   \n  if (codeset[0] == '\\0')\n    codeset = \"ASCII\";\n\n  return codeset;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}