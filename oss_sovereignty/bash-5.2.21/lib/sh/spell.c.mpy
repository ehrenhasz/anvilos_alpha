{
  "module_name": "spell.c",
  "hash_id": "616b4fe6f814bb3d7c0e31c678c7a18fa2a6ef5900550ba76c1ef9f5875a618f",
  "original_prompt": "Ingested from bash-5.2.21/lib/sh/spell.c",
  "human_readable_source": " \n\n \n\n#include <config.h>\n\n#if defined (HAVE_UNISTD_H)\n#  ifdef _MINIX\n#    include <sys/types.h>\n#  endif\n#  include <unistd.h>\n#endif\n\n#include <bashtypes.h>\n#include <posixdir.h>\n#include <posixstat.h>\n#if defined (HAVE_SYS_PARAM_H)\n#include <sys/param.h>\n#endif\n\n#include <stdio.h>\n\n#include <bashansi.h>\n#include <maxpath.h>\n#include <stdc.h>\n\nstatic int mindist PARAMS((char *, char *, char *));\nstatic int spdist PARAMS((char *, char *));\n\n \n\n \nint\nspname(oldname, newname)\n     char *oldname;\n     char *newname;\n{\n  char *op, *np, *p;\n  char guess[PATH_MAX + 1], best[PATH_MAX + 1];\n\n  op = oldname;\n  np = newname;\n  for (;;)\n    {\n      while (*op == '/')     \n\t*np++ = *op++;\n      *np = '\\0';\n\n      if (*op == '\\0')     \n\t{\n\t   \n\t  if (oldname[1] == '\\0' && newname[1] == '\\0' &&\n\t\toldname[0] != '.' && newname[0] == '.')\n\t    return -1;\n\t  return strcmp(oldname, newname) != 0;\n\t}\n\n       \n      for (p = guess; *op != '/' && *op != '\\0'; op++)\n\tif (p < guess + PATH_MAX)\n\t  *p++ = *op;\n      *p = '\\0';\n\n      if (mindist(newname, guess, best) >= 3)\n\treturn -1;   \n\n       \n      for (p = best; *np = *p++; np++)\n\t;\n    }\n}\n\n \nstatic int\nmindist(dir, guess, best)\n     char *dir;\n     char *guess;\n     char *best;\n{\n  DIR *fd;\n  struct dirent *dp;\n  int dist, x;\n\n  dist = 3;     \n  if (*dir == '\\0')\n    dir = \".\";\n\n  if ((fd = opendir(dir)) == NULL)\n    return dist;\n\n  while ((dp = readdir(fd)) != NULL)\n    {\n       \n      x = spdist(dp->d_name, guess);\n      if (x <= dist && x != 3)\n\t{\n\t  strcpy(best, dp->d_name);\n\t  dist = x;\n\t  if (dist == 0)     \n\t    break;\n\t}\n    }\n  (void)closedir(fd);\n\n   \n  if (best[0] == '.' && best[1] == '\\0')\n    dist = 3;\n  return dist;\n}\n\n \nstatic int\nspdist(cur, new)\n     char *cur, *new;\n{\n  while (*cur == *new)\n    {\n      if (*cur == '\\0')\n\treturn 0;     \n      cur++;\n      new++;\n    }\n\n  if (*cur)\n    {\n      if (*new)\n\t{\n\t  if (cur[1] && new[1] && cur[0] == new[1] && cur[1] == new[0] && strcmp (cur + 2, new + 2) == 0)\n\t    return 1;   \n\n\t  if (strcmp (cur + 1, new + 1) == 0)\n\t    return 2;   \n\t}\n\n      if (strcmp(&cur[1], &new[0]) == 0)\n\treturn 2;     \n    }\n\n  if (*new && strcmp(cur, new + 1) == 0)\n    return 2;       \n\n  return 3;\n}\n\nchar *\ndirspell (dirname)\n     char *dirname;\n{\n  int n;\n  char *guess;\n\n  n = (strlen (dirname) * 3 + 1) / 2 + 1;\n  guess = (char *)malloc (n);\n  if (guess == 0)\n    return 0;\n\n  switch (spname (dirname, guess))\n    {\n    case -1:\n    default:\n      free (guess);\n      return (char *)NULL;\n    case 0:\n    case 1:\n      return guess;\n    }\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}