{
  "module_name": "strvis.c",
  "hash_id": "a746957194abf61581c2862fe72959b660b1f2885dd25d2a4c2074f5aca81cfb",
  "original_prompt": "Ingested from bash-5.2.21/lib/sh/strvis.c",
  "human_readable_source": " \n\n \n\n \n#include <config.h>\n\n#include <unistd.h>\n\n#include \"bashansi.h\"\n#include <stdio.h>\n\n#include \"chartypes.h\"\n#include \"bashintl.h\"\n#include \"shmbutil.h\"\n\n#define SAFECHAR(c)   ((c) == ' ' || (c) == '\\t')\n\n#ifndef RUBOUT\n#define RUBOUT 0x7f\n#endif\n\n#ifndef CTRL_CHAR\n#define CTRL_CHAR(c)\t((c) < 0x20)\n#endif\n\n#ifndef META_CHAR\n#define META_CHAR(c)\t((c) > 0x7f && (c) <= UCHAR_MAX)\n#endif\n\n#ifndef UNCTRL\n#define UNCTRL(c)\t(TOUPPER ((c) | 0x40))\n#endif\n\n#ifndef UNMETA\n#define UNMETA(c)\t((c) & 0x7f)\n#endif\n\nint\nsh_charvis (s, sindp, slen, ret, rindp)\n     const char *s;\n     size_t *sindp;\n     size_t slen;\n     char *ret;\n     size_t *rindp;\n{\n  unsigned char c;\n  size_t si, ri;\n  const char *send;\n  DECLARE_MBSTATE;\n\n  si = *sindp;\n  ri = *rindp;\n  c = s[*sindp];\n\n#if defined (HANDLE_MULTIBYTE)\n  send = (locale_mb_cur_max > 1) ? s + slen : 0;\n#else\n  send = 0;\n#endif\n\n  if (SAFECHAR (c))\n    {\n      ret[ri++] = c;\n      si++;\n    }\n  else if (c == RUBOUT)\n    {\n      ret[ri++] = '^';\n      ret[ri++] = '?';\n      si++;\n    }\n  else if (CTRL_CHAR (c))\n    {\n      ret[ri++] = '^';\n      ret[ri++] = UNCTRL (c);\n      si++;\n    }\n#if defined (HANDLE_MULTIBYTE)\n  else if (locale_utf8locale && (c & 0x80))\n    COPY_CHAR_I (ret, ri, s, send, si);\n  else if (locale_mb_cur_max > 1 && is_basic (c) == 0)\n    COPY_CHAR_I (ret, ri, s, send, si);\n#endif\n  else if (META_CHAR (c))\n    {\n      ret[ri++] = 'M';\n      ret[ri++] = '-';\n      ret[ri++] = UNMETA (c);\n      si++;\n    }\n  else\n    ret[ri++] = s[si++];\n  \n  *sindp = si;\n  *rindp = ri;\n\n  return si;    \n}\n\n \nchar *\nsh_strvis (string)\n     const char *string;\n{\n  size_t slen, sind;\n  char *ret;\n  size_t retind, retsize;\n  unsigned char c;\n  DECLARE_MBSTATE;\n\n  if (string == 0)\n    return 0;\n  if (*string == '\\0')\n    {\n      if ((ret = (char *)malloc (1)) == 0)\n\treturn 0;\n      ret[0] = '\\0';\n      return ret;\n    }\n\n  slen = strlen (string);\n  retsize = 3 * slen + 1;\n\n  ret = (char *)malloc (retsize);\n  if (ret == 0)\n    return 0;\n\n  retind = 0;\n  sind = 0;\n\n  while (string[sind])\n    sind = sh_charvis (string, &sind, slen, ret, &retind);\n\n  ret[retind] = '\\0';\n  return ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}