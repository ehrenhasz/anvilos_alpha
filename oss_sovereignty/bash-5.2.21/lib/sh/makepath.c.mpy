{
  "module_name": "makepath.c",
  "hash_id": "f401b381826055adaeae4be9c2b0ccaa497774ee332b4634b7ccc9e1c51eb055",
  "original_prompt": "Ingested from bash-5.2.21/lib/sh/makepath.c",
  "human_readable_source": " \n\n \n\n#include <config.h>\n\n#if defined (HAVE_UNISTD_H)\n#  ifdef _MINIX\n#    include <sys/types.h>\n#  endif\n#  include <unistd.h>\n#endif\n\n#include <bashansi.h>\n#include \"shell.h\"\n\n#include <tilde/tilde.h>\n\n#ifndef NULL\n#  define NULL 0\n#endif\n\n \n\n#ifndef MP_DOTILDE\n#  define MP_DOTILDE\t0x01\n#  define MP_DOCWD\t0x02\n#  define MP_RMDOT\t0x04\n#  define MP_IGNDOT\t0x08\n#endif\n\nextern char *get_working_directory PARAMS((char *));\n\nstatic char *nullpath = \"\";\n\n \n\n#define MAKEDOT() \\\n  do { \\\n    xpath = (char *)xmalloc (2); \\\n    xpath[0] = '.'; \\\n    xpath[1] = '\\0'; \\\n    pathlen = 1; \\\n  } while (0)\n\nchar *\nsh_makepath (path, dir, flags)\n     const char *path, *dir;\n     int flags;\n{\n  int dirlen, pathlen;\n  char *ret, *xpath, *xdir, *r, *s;\n\n  if (path == 0 || *path == '\\0')\n    {\n      if (flags & MP_DOCWD)\n\t{\n\t  xpath = get_working_directory (\"sh_makepath\");\n\t  if (xpath == 0)\n\t    {\n\t      ret = get_string_value (\"PWD\");\n\t      if (ret)\n\t\txpath = savestring (ret);\n\t    }\n\t  if (xpath == 0)\n\t    MAKEDOT();\n\t  else\n\t    pathlen = strlen (xpath);\n\t}\n      else\n\tMAKEDOT();\n    }\n  else if ((flags & MP_IGNDOT) && path[0] == '.' && (path[1] == '\\0' ||\n\t\t\t\t\t\t     (path[1] == '/' && path[2] == '\\0')))\n    {\n      xpath = nullpath;\n      pathlen = 0;\n    }\n  else\n    {\n      xpath = ((flags & MP_DOTILDE) && *path == '~') ? bash_tilde_expand (path, 0) : (char *)path;\n      pathlen = strlen (xpath);\n    }\n\n  xdir = (char *)dir;\n  dirlen = strlen (xdir);\n  if ((flags & MP_RMDOT) && dir[0] == '.' && dir[1] == '/')\n    {\n      xdir += 2;\n      dirlen -= 2;\n    }\n\n  r = ret = (char *)xmalloc (2 + dirlen + pathlen);\n  s = xpath;\n  while (*s)\n    *r++ = *s++;\n  if (s > xpath && s[-1] != '/')\n    *r++ = '/';      \n  s = xdir;\n  while (*r++ = *s++)\n    ;\n  if (xpath != path && xpath != nullpath)\n    free (xpath);\n  return (ret);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}