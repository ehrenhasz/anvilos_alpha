{
  "module_name": "shtty.c",
  "hash_id": "09457a1852b56c63dd5ae8e555210cd969a14f37edb3f5676523728d77138a6b",
  "original_prompt": "Ingested from bash-5.2.21/lib/sh/shtty.c",
  "human_readable_source": " \n\n \n\n#ifdef HAVE_CONFIG_H\n#  include <config.h>\n#endif\n\n#ifdef HAVE_UNISTD_H\n#  include <unistd.h>\n#endif\n\n#include <shtty.h>\n\nstatic TTYSTRUCT ttin, ttout;\nstatic int ttsaved = 0;\n\nint\nttgetattr(fd, ttp)\nint\tfd;\nTTYSTRUCT *ttp;\n{\n#ifdef TERMIOS_TTY_DRIVER\n  return tcgetattr(fd, ttp);\n#else\n#  ifdef TERMIO_TTY_DRIVER\n  return ioctl(fd, TCGETA, ttp);\n#  else\n  return ioctl(fd, TIOCGETP, ttp);\n#  endif\n#endif\n}\n\nint\nttsetattr(fd, ttp)\nint\tfd;\nTTYSTRUCT *ttp;\n{\n#ifdef TERMIOS_TTY_DRIVER\n  return tcsetattr(fd, TCSADRAIN, ttp);\n#else\n#  ifdef TERMIO_TTY_DRIVER\n  return ioctl(fd, TCSETAW, ttp);\n#  else\n  return ioctl(fd, TIOCSETN, ttp);\n#  endif\n#endif\n}\n\nvoid\nttsave()\n{\n  if (ttsaved)\n   return;\n  ttgetattr (0, &ttin);\n  ttgetattr (1, &ttout);\n  ttsaved = 1;\n}\n\nvoid\nttrestore()\n{\n  if (ttsaved == 0)\n    return;\n  ttsetattr (0, &ttin);\n  ttsetattr (1, &ttout);\n  ttsaved = 0;\n}\n\n \nTTYSTRUCT *\nttattr (fd)\n     int fd;\n{\n  if (ttsaved == 0)\n    return ((TTYSTRUCT *)0);\n  if (fd == 0)\n    return &ttin;\n  else if (fd == 1)\n    return &ttout;\n  else\n    return ((TTYSTRUCT *)0);\n}\n\n \nint\ntt_setonechar(ttp)\n     TTYSTRUCT *ttp;\n{\n#if defined (TERMIOS_TTY_DRIVER) || defined (TERMIO_TTY_DRIVER)\n\n   \n  ttp->c_lflag &= ~ICANON;\n\n  ttp->c_lflag |= ISIG;\n#  ifdef IEXTEN\n  ttp->c_lflag |= IEXTEN;\n#  endif\n\n  ttp->c_iflag |= ICRNL;\t \n  ttp->c_iflag &= ~INLCR;\t \n\n#  ifdef OPOST\n  ttp->c_oflag |= OPOST;\n#  endif\n#  ifdef ONLCR\n  ttp->c_oflag |= ONLCR;\n#  endif\n#  ifdef OCRNL\n  ttp->c_oflag &= ~OCRNL;\n#  endif\n#  ifdef ONOCR\n  ttp->c_oflag &= ~ONOCR;\n#  endif\n#  ifdef ONLRET\n  ttp->c_oflag &= ~ONLRET;\n#  endif\n\n  ttp->c_cc[VMIN] = 1;\n  ttp->c_cc[VTIME] = 0;\n\n#else\n\n  ttp->sg_flags |= CBREAK;\n\n#endif\n\n  return 0;\n}\n\n \nint\nttfd_onechar (fd, ttp)\n     int fd;\n     TTYSTRUCT *ttp;\n{\n  if (tt_setonechar(ttp) < 0)\n    return -1;\n  return (ttsetattr (fd, ttp));\n}\n\n \nint\nttonechar ()\n{\n  TTYSTRUCT tt;\n\n  if (ttsaved == 0)\n    return -1;\n  tt = ttin;\n  return (ttfd_onechar (0, &tt));\n}\n\n \nint\ntt_setnoecho(ttp)\n     TTYSTRUCT *ttp;\n{\n#if defined (TERMIOS_TTY_DRIVER) || defined (TERMIO_TTY_DRIVER)\n  ttp->c_lflag &= ~(ECHO|ECHOK|ECHONL);\n#else\n  ttp->sg_flags &= ~ECHO;\n#endif\n\n  return 0;\n}\n\n \nint\nttfd_noecho (fd, ttp)\n     int fd;\n     TTYSTRUCT *ttp;\n{\n  if (tt_setnoecho (ttp) < 0)\n    return -1;\n  return (ttsetattr (fd, ttp));\n}\n\n \nint\nttnoecho ()\n{\n  TTYSTRUCT tt;\n\n  if (ttsaved == 0)\n    return -1;\n  tt = ttin;\n  return (ttfd_noecho (0, &tt));\n}\n\n \nint\ntt_seteightbit (ttp)\n     TTYSTRUCT *ttp;\n{\n#if defined (TERMIOS_TTY_DRIVER) || defined (TERMIO_TTY_DRIVER)\n  ttp->c_iflag &= ~ISTRIP;\n  ttp->c_cflag |= CS8;\n  ttp->c_cflag &= ~PARENB;\n#else\n  ttp->sg_flags |= ANYP;\n#endif\n\n  return 0;\n}\n\n \nint\nttfd_eightbit (fd, ttp)\n     int fd;\n     TTYSTRUCT *ttp;\n{\n  if (tt_seteightbit (ttp) < 0)\n    return -1;\n  return (ttsetattr (fd, ttp));\n}\n\n \nint\ntteightbit ()\n{\n  TTYSTRUCT tt;\n\n  if (ttsaved == 0)\n    return -1;\n  tt = ttin;\n  return (ttfd_eightbit (0, &tt));\n}\n\n \nint\ntt_setnocanon (ttp)\n     TTYSTRUCT *ttp;\n{\n#if defined (TERMIOS_TTY_DRIVER) || defined (TERMIO_TTY_DRIVER)\n  ttp->c_lflag &= ~ICANON;\n#endif\n\n  return 0;\n}\n\n \nint\nttfd_nocanon (fd, ttp)\n     int fd;\n     TTYSTRUCT *ttp;\n{\n  if (tt_setnocanon (ttp) < 0)\n    return -1;\n  return (ttsetattr (fd, ttp));\n}\n\n \nint\nttnocanon ()\n{\n  TTYSTRUCT tt;\n\n  if (ttsaved == 0)\n    return -1;\n  tt = ttin;\n  return (ttfd_nocanon (0, &tt));\n}\n\n \nint\ntt_setcbreak(ttp)\n     TTYSTRUCT *ttp;\n{\n  if (tt_setonechar (ttp) < 0)\n    return -1;\n  return (tt_setnoecho (ttp));\n}\n\n \nint\nttfd_cbreak (fd, ttp)\n     int fd;\n     TTYSTRUCT *ttp;\n{\n  if (tt_setcbreak (ttp) < 0)\n    return -1;\n  return (ttsetattr (fd, ttp));\n}\n\n \nint\nttcbreak ()\n{\n  TTYSTRUCT tt;\n\n  if (ttsaved == 0)\n    return -1;\n  tt = ttin;\n  return (ttfd_cbreak (0, &tt));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}