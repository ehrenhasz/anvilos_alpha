{
  "module_name": "input_avail.c",
  "hash_id": "6542717601903cdc0f586ebe76aba4a13cb0bc72d348fbadbc3c4ce5ffefcc6d",
  "original_prompt": "Ingested from bash-5.2.21/lib/sh/input_avail.c",
  "human_readable_source": " \n\n \n\n#if defined (__TANDEM)\n#  include <floss.h>\n#endif\n\n#if defined (HAVE_CONFIG_H)\n#  include <config.h>\n#endif\n\n#include <sys/types.h>\n#include <fcntl.h>\n#if defined (HAVE_SYS_FILE_H)\n#  include <sys/file.h>\n#endif  \n\n#if defined (HAVE_PSELECT)\n#  include <signal.h>\n#endif\n\n#if defined (HAVE_UNISTD_H)\n#  include <unistd.h>\n#endif  \n\n#include \"bashansi.h\"\n\n#include \"posixselect.h\"\n\n#if defined (FIONREAD_IN_SYS_IOCTL)\n#  include <sys/ioctl.h>\n#endif\n\n#include <stdio.h>\n#include <errno.h>\n\n#if !defined (errno)\nextern int errno;\n#endif  \n\n#if !defined (O_NDELAY) && defined (O_NONBLOCK)\n#  define O_NDELAY O_NONBLOCK\t \n#endif\n\n \nint\ninput_avail (fd)\n     int fd;\n{\n  int result, chars_avail;\n#if defined(HAVE_SELECT)\n  fd_set readfds, exceptfds;\n  struct timeval timeout;\n#endif\n\n  if (fd < 0)\n    return -1;\n\n  chars_avail = 0;\n\n#if defined (HAVE_SELECT)\n  FD_ZERO (&readfds);\n  FD_ZERO (&exceptfds);\n  FD_SET (fd, &readfds);\n  FD_SET (fd, &exceptfds);\n  timeout.tv_sec = 0;\n  timeout.tv_usec = 0;\n  result = select (fd + 1, &readfds, (fd_set *)NULL, &exceptfds, &timeout);\n  return ((result <= 0) ? 0 : 1);\n#endif\n\n#if defined (FIONREAD)\n  errno = 0;\n  result = ioctl (fd, FIONREAD, &chars_avail);\n  if (result == -1 && errno == EIO)\n    return -1;\n  return (chars_avail);\n#endif\n\n  return 0;\n}\n\n \nint\nnchars_avail (fd, nchars)\n     int fd;\n     int nchars;\n{\n  int result, chars_avail;\n#if defined(HAVE_SELECT)\n  fd_set readfds, exceptfds;\n#endif\n#if defined (HAVE_PSELECT) || defined (HAVE_SELECT)\n  sigset_t set, oset;\n#endif\n\n  if (fd < 0 || nchars < 0)\n    return -1;\n  if (nchars == 0)\n    return (input_avail (fd));\n\n  chars_avail = 0;\n\n#if defined (HAVE_SELECT)\n  FD_ZERO (&readfds);\n  FD_ZERO (&exceptfds);\n  FD_SET (fd, &readfds);\n  FD_SET (fd, &exceptfds);\n#endif\n#if defined (HAVE_SELECT) || defined (HAVE_PSELECT)\n  sigprocmask (SIG_BLOCK, (sigset_t *)NULL, &set);\n#  ifdef SIGCHLD\n  sigaddset (&set, SIGCHLD);\n#  endif\n  sigemptyset (&oset);\n#endif\n\n  while (1)\n    {\n      result = 0;\n#if defined (HAVE_PSELECT)\n       \n      result = pselect (fd + 1, &readfds, (fd_set *)NULL, &exceptfds, (struct timespec *)NULL, &set);\n#elif defined (HAVE_SELECT)\n      sigprocmask (SIG_BLOCK, &set, &oset);\n      result = select (fd + 1, &readfds, (fd_set *)NULL, &exceptfds, (struct timeval *)NULL);\n      sigprocmask (SIG_BLOCK, &oset, (sigset_t *)NULL);\n#endif\n      if (result < 0)\n        return -1;\n\n#if defined (FIONREAD)\n      errno = 0;\n      result = ioctl (fd, FIONREAD, &chars_avail);\n      if (result == -1 && errno == EIO)\n        return -1;\n      if (chars_avail >= nchars)\n        break;\n#else\n      break;\n#endif\n    }\n\n  return 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}