{
  "module_name": "random.c",
  "hash_id": "6de60aa0f9abf953a4f90f42d210ec2775ea0cc7a000543d0cad9f34ddcde096",
  "original_prompt": "Ingested from bash-5.2.21/lib/sh/random.c",
  "human_readable_source": " \n\n \n\n#include \"config.h\"\n\n#include \"bashtypes.h\"\n\n#if defined (HAVE_SYS_RANDOM_H)\n#  include <sys/random.h>\n#endif\n\n#if defined (HAVE_UNISTD_H)\n#  include <unistd.h>\n#endif\n#include \"filecntl.h\"\n\n#include <stdio.h>\n#include \"bashansi.h\"\n\n#include \"shell.h\"\n\nextern time_t shell_start_time;\n\nextern int last_random_value;\n\nstatic u_bits32_t intrand32 PARAMS((u_bits32_t));\nstatic u_bits32_t genseed PARAMS((void));\n\nstatic u_bits32_t brand32 PARAMS((void));\nstatic void sbrand32 PARAMS((u_bits32_t));\nstatic void perturb_rand32 PARAMS((void));\n\n \nstatic u_bits32_t rseed = 1;\n\n \nstatic u_bits32_t\nintrand32 (last)\n     u_bits32_t last;\n{\n   \n  ret = (last == 0) ? 123459876 : last;\n  h = ret / 127773;\n  l = ret - (127773 * h);\n  t = 16807 * l - 2836 * h;\n  ret = (t < 0) ? t + 0x7fffffff : t;\n\n  return (ret);\n}\n\nstatic u_bits32_t\ngenseed ()\n{\n  struct timeval tv;\n  u_bits32_t iv;\n\n  gettimeofday (&tv, NULL);\n  iv = (u_bits32_t)seedrand;\t\t \n  iv = tv.tv_sec ^ tv.tv_usec ^ getpid () ^ getppid () ^ current_user.uid ^ iv;\n  return (iv);\n}\n\n#define BASH_RAND_MAX\t32767\t\t \n\n \nint\nbrand ()\n{\n  unsigned int ret;\n\n  rseed = intrand32 (rseed);\n  if (shell_compatibility_level > 50)\n    ret = (rseed >> 16) ^ (rseed & 65535);\n  else\n    ret = rseed;\n  return (ret & BASH_RAND_MAX);\n}\n\n \nvoid\nsbrand (seed)\n     unsigned long seed;\n{\n  rseed = seed;\n  last_random_value = 0;\n}\n\nvoid\nseedrand ()\n{\n  u_bits32_t iv;\n\n  iv = genseed ();\n  sbrand (iv);\n}\n\nstatic u_bits32_t rseed32 = 1073741823;\nstatic int last_rand32;\n\nstatic int urandfd = -1;\n\n#define BASH_RAND32_MAX\t0x7fffffff\t \n\n \nstatic u_bits32_t\nbrand32 ()\n{\n  u_bits32_t ret;\n\n  rseed32 = intrand32 (rseed32);\n  return (rseed32 & BASH_RAND32_MAX);\n}\n\nstatic void\nsbrand32 (seed)\n     u_bits32_t seed;\n{\n  last_rand32 = rseed32 = seed;\n}\n\nvoid\nseedrand32 ()\n{\n  u_bits32_t iv;\n\n  iv = genseed ();\n  sbrand32 (iv);\n}\n\nstatic void\nperturb_rand32 ()\n{\n  rseed32 ^= genseed ();\n}\n\n \nvoid\nurandom_close ()\n{\n  if (urandfd >= 0)\n    close (urandfd);\n  urandfd = -1;\n}\n\n#if !defined (HAVE_GETRANDOM)\n \n#ifndef GRND_NONBLOCK\n#  define GRND_NONBLOCK 1\n#  define GRND_RANDOM 2\n#endif\n\nstatic ssize_t\ngetrandom (buf, len, flags)\n     void *buf;\n     size_t len;\n     unsigned int flags;\n{\n  int oflags;\n  ssize_t r;\n  static int urand_unavail = 0;\n\n#if HAVE_GETENTROPY\n  r = getentropy (buf, len);\n  return (r == 0) ? len : -1;\n#endif\n\n  if (urandfd == -1 && urand_unavail == 0)\n    {\n      oflags = O_RDONLY;\n      if (flags & GRND_NONBLOCK)\n\toflags |= O_NONBLOCK;\n      urandfd = open (\"/dev/urandom\", oflags, 0);\n      if (urandfd >= 0)\n\tSET_CLOSE_ON_EXEC (urandfd);\n      else\n\t{\n\t  urand_unavail = 1;\n\t  return -1;\n\t}\n    }\n  if (urandfd >= 0 && (r = read (urandfd, buf, len)) == len)\n    return (r);\n  return -1;\n}\n#endif\n      \nu_bits32_t\nget_urandom32 ()\n{\n  u_bits32_t ret;\n\n  if (getrandom ((void *)&ret, sizeof (ret), GRND_NONBLOCK) == sizeof (ret))\n    return (last_rand32 = ret);\n\n#if defined (HAVE_ARC4RANDOM)\n  ret = arc4random ();\n#else\n  if (subshell_environment)\n    perturb_rand32 ();\n  do\n    ret = brand32 ();\n  while (ret == last_rand32);\n#endif\n  return (last_rand32 = ret);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}