{
  "module_name": "fnxform.c",
  "hash_id": "938951c9d2324960038eea233a1890d1e3b34a8626f363b25c1dcfb8c8e44b14",
  "original_prompt": "Ingested from bash-5.2.21/lib/sh/fnxform.c",
  "human_readable_source": " \n\n \n\n#include <config.h>\n#if defined (HAVE_UNISTD_H)\n#  include <unistd.h>\n#endif\n#include \"bashansi.h\"\n#include <stdio.h>\n#include \"bashtypes.h\"\n\n#include \"stdc.h\"\n#include \"bashintl.h\"\n#include <xmalloc.h>\n\n#if defined (HAVE_ICONV)\n#  include <iconv.h>\n#endif\n\n#if defined (HAVE_LOCALE_CHARSET)\nextern const char *locale_charset PARAMS((void));\n#else\nextern char *get_locale_var PARAMS((char *));\n#endif\n\n#if defined (HAVE_ICONV)\nstatic iconv_t conv_fromfs = (iconv_t)-1;\nstatic iconv_t conv_tofs = (iconv_t)-1;\n\n#define OUTLEN_MAX 4096\n\nstatic char *outbuf = 0;\nstatic size_t outlen = 0;\n\nstatic char *curencoding PARAMS((void));\nstatic void init_tofs PARAMS((void));\nstatic void init_fromfs PARAMS((void));\n\nstatic char *\ncurencoding ()\n{\n  char *loc;\n#if defined (HAVE_LOCALE_CHARSET)\n  loc = (char *)locale_charset ();\n  return loc;\n#else\n  char *dot, *mod;\n\n  loc = get_locale_var (\"LC_CTYPE\");\n  if (loc == 0 || *loc == 0)\n    return \"\";\n  dot = strchr (loc, '.');\n  if (dot == 0)\n    return loc;\n  mod = strchr (dot, '@');\n  if (mod)\n    *mod = '\\0';\n  return ++dot;\n#endif\n}  \n\nstatic void\ninit_tofs ()\n{\n  char *cur;\n\n  cur = curencoding ();\n  conv_tofs = iconv_open (\"UTF-8-MAC\", cur);\n}\n\nstatic void\ninit_fromfs ()\n{\n  char *cur;\n\n  cur = curencoding ();\n  conv_fromfs = iconv_open (cur, \"UTF-8-MAC\");\n}\n\nchar *\nfnx_tofs (string, len)\n     char *string;\n     size_t len;\n{\n#ifdef MACOSX\n  ICONV_CONST char *inbuf;\n  char *tempbuf;\n  size_t templen;\n  \n  if (conv_tofs == (iconv_t)-1)\n    init_tofs ();\n  if (conv_tofs == (iconv_t)-1)\n    return string;\n\n   \n  if (outlen >= OUTLEN_MAX && len < OUTLEN_MAX - 8)\n    {\n      free (outbuf);\n      outbuf = 0;\n      outlen = 0;\n    }\n\n  inbuf = string;\n  if (outbuf == 0 || outlen < len + 8)\n    {\n      outlen = len + 8;\n      outbuf = outbuf ? xrealloc (outbuf, outlen + 1) : xmalloc (outlen + 1);\n    }\n  tempbuf = outbuf;\n  templen = outlen;\n\n  iconv (conv_tofs, NULL, NULL, NULL, NULL);\n\n  if (iconv (conv_tofs, &inbuf, &len, &tempbuf, &templen) == (size_t)-1)\n    return string;\n\n  *tempbuf = '\\0';\n  return outbuf;\n#else\n  return string;\n#endif\n}\n\nchar *\nfnx_fromfs (string, len)\n     char *string;\n     size_t len;\n{\n#ifdef MACOSX\n  ICONV_CONST char *inbuf;\n  char *tempbuf;\n  size_t templen;\n\n  if (conv_fromfs == (iconv_t)-1)\n    init_fromfs ();\n  if (conv_fromfs == (iconv_t)-1)\n    return string;\n\n   \n  if (outlen >= OUTLEN_MAX && len < OUTLEN_MAX - 8)\n    {\n      free (outbuf);\n      outbuf = 0;\n      outlen = 0;\n    }\n\n  inbuf = string;\n  if (outbuf == 0 || outlen < (len + 8))\n    {\n      outlen = len + 8;\n      outbuf = outbuf ? xrealloc (outbuf, outlen + 1) : xmalloc (outlen + 1);\n    }\n  tempbuf = outbuf;\n  templen = outlen;\n\n  iconv (conv_fromfs, NULL, NULL, NULL, NULL);\n\n  if (iconv (conv_fromfs, &inbuf, &len, &tempbuf, &templen) == (size_t)-1)\n    return string;\n\n  *tempbuf = '\\0';\n  return outbuf;\n#else\n  return string;\n#endif\n}\n\n#else\nchar *\nfnx_tofs (string)\n     char *string;\n{\n  return string;\n}\n\nchar *\nfnx_fromfs (string)\n     char *string;\n{\n  return string;\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}