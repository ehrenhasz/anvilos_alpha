{
  "module_name": "pcomplib.c",
  "hash_id": "3f6a32e90c5399785c8e62a32050adf3cb8ba726fc1eacf623351f77b9718437",
  "original_prompt": "Ingested from bash-5.2.21/pcomplib.c",
  "human_readable_source": " \n\n \n\n#include <config.h>\n\n#if defined (PROGRAMMABLE_COMPLETION)\n\n#include \"bashansi.h\"\n#include <stdio.h>\n\n#if defined (HAVE_UNISTD_H)\n#  ifdef _MINIX\n#    include <sys/types.h>\n#  endif\n#  include <unistd.h>\n#endif\n\n#include \"bashintl.h\"\n\n#include \"shell.h\"\n#include \"pcomplete.h\"\n\n#define COMPLETE_HASH_BUCKETS\t512\t \n\n#define STRDUP(x)\t((x) ? savestring (x) : (char *)NULL)\n\nHASH_TABLE *prog_completes = (HASH_TABLE *)NULL;\n\nstatic void free_progcomp PARAMS((PTR_T));\n\nCOMPSPEC *\ncompspec_create ()\n{\n  COMPSPEC *ret;\n\n  ret = (COMPSPEC *)xmalloc (sizeof (COMPSPEC));\n  ret->refcount = 0;\n\n  ret->actions = (unsigned long)0;\n  ret->options = (unsigned long)0;\n\n  ret->globpat = (char *)NULL;\n  ret->words = (char *)NULL;\n  ret->prefix = (char *)NULL;\n  ret->suffix = (char *)NULL;\n  ret->funcname = (char *)NULL;\n  ret->command = (char *)NULL;\n  ret->lcommand = (char *)NULL;\n  ret->filterpat = (char *)NULL;\n\n  return ret;\n}\n\nvoid\ncompspec_dispose (cs)\n     COMPSPEC *cs;\n{\n  cs->refcount--;\n  if (cs->refcount == 0)\n    {\n      FREE (cs->globpat);\n      FREE (cs->words);\n      FREE (cs->prefix);\n      FREE (cs->suffix);\n      FREE (cs->funcname);\n      FREE (cs->command);\n      FREE (cs->lcommand);\n      FREE (cs->filterpat);\n\n      free (cs);\n    }\n}\n\nCOMPSPEC *\ncompspec_copy (cs)\n     COMPSPEC *cs;\n{\n  COMPSPEC *new;\n\n  new = (COMPSPEC *)xmalloc (sizeof (COMPSPEC));\n\n  new->refcount = 1; \t \n  new->actions = cs->actions;\n  new->options = cs->options;\n\n  new->globpat = STRDUP (cs->globpat);\n  new->words = STRDUP (cs->words);\n  new->prefix = STRDUP (cs->prefix);\n  new->suffix = STRDUP (cs->suffix);\n  new->funcname = STRDUP (cs->funcname);\n  new->command = STRDUP (cs->command);\n  new->lcommand = STRDUP (cs->lcommand);\n  new->filterpat = STRDUP (cs->filterpat);\n\n  return new;\n}\n\nvoid\nprogcomp_create ()\n{\n  if (prog_completes == 0)\n    prog_completes = hash_create (COMPLETE_HASH_BUCKETS);\n}\n\nint\nprogcomp_size ()\n{\n  return (HASH_ENTRIES (prog_completes));\n}\n\nstatic void\nfree_progcomp (data)\n     PTR_T data;\n{\n  COMPSPEC *cs;\n\n  cs = (COMPSPEC *)data;\n  compspec_dispose (cs);\n}\n  \nvoid\nprogcomp_flush ()\n{\n  if (prog_completes)\n    hash_flush (prog_completes, free_progcomp);\n}\n\nvoid\nprogcomp_dispose ()\n{\n  if (prog_completes)\n    hash_dispose (prog_completes);\n  prog_completes = (HASH_TABLE *)NULL;\n}\n\nint\nprogcomp_remove (cmd)\n     char *cmd;\n{\n  register BUCKET_CONTENTS *item;\n\n  if (prog_completes == 0)\n    return 1;\n\n  item = hash_remove (cmd, prog_completes, 0);\n  if (item)\n    {\n      if (item->data)\n\tfree_progcomp (item->data);\n      free (item->key);\n      free (item);\n      return (1);\n    }\n  return (0);\n}\n\nint\nprogcomp_insert (cmd, cs)\n      char *cmd;\n      COMPSPEC *cs;\n{\n  register BUCKET_CONTENTS *item;\n\n  if (cs == NULL)\n    programming_error (_(\"progcomp_insert: %s: NULL COMPSPEC\"), cmd);\n\n  if (prog_completes == 0)\n    progcomp_create ();\n\n  cs->refcount++;\n  item = hash_insert (cmd, prog_completes, 0);\n  if (item->data)\n    free_progcomp (item->data);\n  else\n    item->key = savestring (cmd);\n  item->data = cs;\n\n  return 1;\n}\n\nCOMPSPEC *\nprogcomp_search (cmd)\n     const char *cmd;\n{\n  register BUCKET_CONTENTS *item;\n  COMPSPEC *cs;\n\n  if (prog_completes == 0)\n    return ((COMPSPEC *)NULL);\n\n  item = hash_search (cmd, prog_completes, 0);\n\n  if (item == NULL)\n    return ((COMPSPEC *)NULL);\n\n  cs = (COMPSPEC *)item->data;\n\n  return (cs);\n}\n\nvoid\nprogcomp_walk (pfunc)\n     hash_wfunc *pfunc;\n{\n  if (prog_completes == 0 || pfunc == 0 || HASH_ENTRIES (prog_completes) == 0)\n    return;\n\n  hash_walk (prog_completes, pfunc);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}