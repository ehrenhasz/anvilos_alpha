{
  "module_name": "fcntl-o.m4",
  "hash_id": "ca17ffd537cf3b58debcd7f6ef4b70cfdce8222bb8857eeea5da39df7b788634",
  "original_prompt": "Ingested from bash-5.2.21/m4/fcntl-o.m4",
  "human_readable_source": "# fcntl-o.m4 serial 6\ndnl Copyright (C) 2006, 2009-2019 Free Software Foundation, Inc.\ndnl This file is free software; the Free Software Foundation\ndnl gives unlimited permission to copy and/or distribute it,\ndnl with or without modifications, as long as this notice is preserved.\n\ndnl Written by Paul Eggert.\n\nAC_PREREQ([2.60])\n\n# Test whether the flags O_NOATIME and O_NOFOLLOW actually work.\n# Define HAVE_WORKING_O_NOATIME to 1 if O_NOATIME works, or to 0 otherwise.\n# Define HAVE_WORKING_O_NOFOLLOW to 1 if O_NOFOLLOW works, or to 0 otherwise.\nAC_DEFUN([gl_FCNTL_O_FLAGS],\n[\n  dnl Persuade glibc <fcntl.h> to define O_NOATIME and O_NOFOLLOW.\n  AC_REQUIRE([AC_USE_SYSTEM_EXTENSIONS])\n\n  AC_REQUIRE([AC_CANONICAL_HOST]) dnl for cross-compiles\n  AC_CHECK_HEADERS_ONCE([unistd.h])\n  AC_CHECK_FUNCS_ONCE([symlink])\n  AC_CACHE_CHECK([for working fcntl.h], [gl_cv_header_working_fcntl_h],\n    [AC_RUN_IFELSE(\n       [AC_LANG_PROGRAM(\n          [[#include <sys/types.h>\n           #include <sys/stat.h>\n           #if HAVE_UNISTD_H\n           # include <unistd.h>\n           #else /* on Windows with MSVC */\n           # include <io.h>\n           # include <stdlib.h>\n           # defined sleep(n) _sleep ((n) * 1000)\n           #endif\n           #include <fcntl.h>\n           #ifndef O_NOATIME\n            #define O_NOATIME 0\n           #endif\n           #ifndef O_NOFOLLOW\n            #define O_NOFOLLOW 0\n           #endif\n           static int const constants[] =\n            {\n              O_CREAT, O_EXCL, O_NOCTTY, O_TRUNC, O_APPEND,\n              O_NONBLOCK, O_SYNC, O_ACCMODE, O_RDONLY, O_RDWR, O_WRONLY\n            };\n          ]],\n          [[\n            int result = !constants;\n            #if HAVE_SYMLINK\n            {\n              static char const sym[] = \"conftest.sym\";\n              if (symlink (\"/dev/null\", sym) != 0)\n                result |= 2;\n              else\n                {\n                  int fd = open (sym, O_WRONLY | O_NOFOLLOW | O_CREAT, 0);\n                  if (fd >= 0)\n                    {\n                      close (fd);\n                      result |= 4;\n                    }\n                }\n              if (unlink (sym) != 0 || symlink (\".\", sym) != 0)\n                result |= 2;\n              else\n                {\n                  int fd = open (sym, O_RDONLY | O_NOFOLLOW);\n                  if (fd >= 0)\n                    {\n                      close (fd);\n                      result |= 4;\n                    }\n                }\n              unlink (sym);\n            }\n            #endif\n            {\n              static char const file[] = \"confdefs.h\";\n              int fd = open (file, O_RDONLY | O_NOATIME);\n              if (fd < 0)\n                result |= 8;\n              else\n                {\n                  struct stat st0;\n                  if (fstat (fd, &st0) != 0)\n                    result |= 16;\n                  else\n                    {\n                      char c;\n                      sleep (1);\n                      if (read (fd, &c, 1) != 1)\n                        result |= 24;\n                      else\n                        {\n                          if (close (fd) != 0)\n                            result |= 32;\n                          else\n                            {\n                              struct stat st1;\n                              if (stat (file, &st1) != 0)\n                                result |= 40;\n                              else\n                                if (st0.st_atime != st1.st_atime)\n                                  result |= 64;\n                            }\n                        }\n                    }\n                }\n            }\n            return result;]])],\n       [gl_cv_header_working_fcntl_h=yes],\n       [case $? in #(\n        4) gl_cv_header_working_fcntl_h='no (bad O_NOFOLLOW)';; #(\n        64) gl_cv_header_working_fcntl_h='no (bad O_NOATIME)';; #(\n        68) gl_cv_header_working_fcntl_h='no (bad O_NOATIME, O_NOFOLLOW)';; #(\n         *) gl_cv_header_working_fcntl_h='no';;\n        esac],\n       [case \"$host_os\" in\n                  # Guess 'no' on native Windows.\n          mingw*) gl_cv_header_working_fcntl_h='no' ;;\n          *)      gl_cv_header_working_fcntl_h=cross-compiling ;;\n        esac\n       ])\n    ])\n\n  case $gl_cv_header_working_fcntl_h in #(\n  *O_NOATIME* | no | cross-compiling) ac_val=0;; #(\n  *) ac_val=1;;\n  esac\n  AC_DEFINE_UNQUOTED([HAVE_WORKING_O_NOATIME], [$ac_val],\n    [Define to 1 if O_NOATIME works.])\n\n  case $gl_cv_header_working_fcntl_h in #(\n  *O_NOFOLLOW* | no | cross-compiling) ac_val=0;; #(\n  *) ac_val=1;;\n  esac\n  AC_DEFINE_UNQUOTED([HAVE_WORKING_O_NOFOLLOW], [$ac_val],\n    [Define to 1 if O_NOFOLLOW works.])\n])\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}