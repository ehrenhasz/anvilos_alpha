






























. @sysconfdir@/zfs/zfs-functions



chkroot() {
	while read -r _ mp _; do
		if [ "$mp" = "/" ]; then
			return 0
		fi
	done < /proc/self/mounts

	return 1
}

do_depend()
{
	
	if [ "$(mountinfo -s /)" = 'zfs' ]
	then
		before localmount
	else
		after localmount
	fi

	
	before bootmisc logger

	after zfs-import sysfs
	use mtab
	keyword -lxc -openvz -prefix -vserver
}


do_mount()
{
	local verbose overlay

	check_boolean "$VERBOSE_MOUNT" && verbose=v
	check_boolean "$DO_OVERLAY_MOUNTS" && overlay=O

	zfs_action "Mounting ZFS filesystem(s)" \
	    "$ZFS" mount "-a$verbose$overlay" "$MOUNT_EXTRA_OPTIONS"

	return 0
}


do_unmount()
{
	
	
	
	
	zfs_action "Unmounting ZFS filesystems" "$ZFS" unmount -a

	return 0
}

do_start()
{
	check_boolean "$ZFS_MOUNT" || exit 0

	check_module_loaded "zfs" || exit 0

	
	
	if ! chkroot
	then
		mount -f /
	fi

	do_mount
}

do_stop()
{
	check_boolean "$ZFS_UNMOUNT" || exit 0

	check_module_loaded "zfs" || exit 0

	do_unmount
}



if [ ! -e /sbin/openrc-run ]
then
	case "$1" in
		start)
			do_start
			;;
		stop)
			do_stop
			;;
		force-reload|condrestart|reload|restart|status)
			
			;;
		*)
			[ -n "$1" ] && echo "Error: Unknown command $1."
			echo "Usage: $0 {start|stop}"
			exit 3
			;;
	esac

	exit $?
else
	
	depend() { do_depend; }
	start() { do_start; }
	stop() { do_stop; }
fi
