{
  "module_name": "report_tags.c",
  "hash_id": "cc8e30243bf3547486d797f5053f04b7db559b6fdecbe43763fbd21eac9464dd",
  "original_prompt": "Ingested from linux-6.6.14/mm/kasan/report_tags.c",
  "human_readable_source": "\n \n\n#include <linux/atomic.h>\n\n#include \"kasan.h\"\n\nextern struct kasan_stack_ring stack_ring;\n\nstatic const char *get_common_bug_type(struct kasan_report_info *info)\n{\n\t \n\tif (info->access_addr + info->access_size < info->access_addr)\n\t\treturn \"out-of-bounds\";\n\n\treturn \"invalid-access\";\n}\n\nvoid kasan_complete_mode_report_info(struct kasan_report_info *info)\n{\n\tunsigned long flags;\n\tu64 pos;\n\tstruct kasan_stack_ring_entry *entry;\n\tvoid *ptr;\n\tu32 pid;\n\tdepot_stack_handle_t stack;\n\tbool is_free;\n\tbool alloc_found = false, free_found = false;\n\n\tif ((!info->cache || !info->object) && !info->bug_type) {\n\t\tinfo->bug_type = get_common_bug_type(info);\n\t\treturn;\n\t}\n\n\twrite_lock_irqsave(&stack_ring.lock, flags);\n\n\tpos = atomic64_read(&stack_ring.pos);\n\n\t \n\n\tfor (u64 i = pos - 1; i != pos - 1 - stack_ring.size; i--) {\n\t\tif (alloc_found && free_found)\n\t\t\tbreak;\n\n\t\tentry = &stack_ring.entries[i % stack_ring.size];\n\n\t\t \n\t\tptr = (void *)smp_load_acquire(&entry->ptr);\n\n\t\tif (kasan_reset_tag(ptr) != info->object ||\n\t\t    get_tag(ptr) != get_tag(info->access_addr))\n\t\t\tcontinue;\n\n\t\tpid = READ_ONCE(entry->pid);\n\t\tstack = READ_ONCE(entry->stack);\n\t\tis_free = READ_ONCE(entry->is_free);\n\n\t\tif (is_free) {\n\t\t\t \n\t\t\tif (free_found)\n\t\t\t\tbreak;\n\n\t\t\tinfo->free_track.pid = pid;\n\t\t\tinfo->free_track.stack = stack;\n\t\t\tfree_found = true;\n\n\t\t\t \n\t\t\tif (!info->bug_type)\n\t\t\t\tinfo->bug_type = \"slab-use-after-free\";\n\t\t} else {\n\t\t\t \n\t\t\tif (alloc_found)\n\t\t\t\tbreak;\n\n\t\t\tinfo->alloc_track.pid = pid;\n\t\t\tinfo->alloc_track.stack = stack;\n\t\t\talloc_found = true;\n\n\t\t\t \n\t\t\tif (!info->bug_type)\n\t\t\t\tinfo->bug_type = \"slab-out-of-bounds\";\n\t\t}\n\t}\n\n\twrite_unlock_irqrestore(&stack_ring.lock, flags);\n\n\t \n\tif (!info->bug_type)\n\t\tinfo->bug_type = get_common_bug_type(info);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}