{
  "module_name": "dbgfs-test.h",
  "hash_id": "98d8a8dfb9545e6084b17b0d29ba85f70e0ecce16ea1ba233c40bd64274c73fb",
  "original_prompt": "Ingested from linux-6.6.14/mm/damon/dbgfs-test.h",
  "human_readable_source": " \n \n\n#ifdef CONFIG_DAMON_DBGFS_KUNIT_TEST\n\n#ifndef _DAMON_DBGFS_TEST_H\n#define _DAMON_DBGFS_TEST_H\n\n#include <kunit/test.h>\n\nstatic void damon_dbgfs_test_str_to_ints(struct kunit *test)\n{\n\tchar *question;\n\tint *answers;\n\tint expected[] = {12, 35, 46};\n\tssize_t nr_integers = 0, i;\n\n\tquestion = \"123\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)1, nr_integers);\n\tKUNIT_EXPECT_EQ(test, 123, answers[0]);\n\tkfree(answers);\n\n\tquestion = \"123abc\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)1, nr_integers);\n\tKUNIT_EXPECT_EQ(test, 123, answers[0]);\n\tkfree(answers);\n\n\tquestion = \"a123\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)0, nr_integers);\n\tkfree(answers);\n\n\tquestion = \"12 35\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)2, nr_integers);\n\tfor (i = 0; i < nr_integers; i++)\n\t\tKUNIT_EXPECT_EQ(test, expected[i], answers[i]);\n\tkfree(answers);\n\n\tquestion = \"12 35 46\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)3, nr_integers);\n\tfor (i = 0; i < nr_integers; i++)\n\t\tKUNIT_EXPECT_EQ(test, expected[i], answers[i]);\n\tkfree(answers);\n\n\tquestion = \"12 35 abc 46\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)2, nr_integers);\n\tfor (i = 0; i < 2; i++)\n\t\tKUNIT_EXPECT_EQ(test, expected[i], answers[i]);\n\tkfree(answers);\n\n\tquestion = \"\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)0, nr_integers);\n\tkfree(answers);\n\n\tquestion = \"\\n\";\n\tanswers = str_to_ints(question, strlen(question), &nr_integers);\n\tKUNIT_EXPECT_EQ(test, (ssize_t)0, nr_integers);\n\tkfree(answers);\n}\n\nstatic void damon_dbgfs_test_set_targets(struct kunit *test)\n{\n\tstruct damon_ctx *ctx = dbgfs_new_ctx();\n\tchar buf[64];\n\n\t \n\tdamon_select_ops(ctx, DAMON_OPS_PADDR);\n\n\tdbgfs_set_targets(ctx, 0, NULL);\n\tsprint_target_ids(ctx, buf, 64);\n\tKUNIT_EXPECT_STREQ(test, (char *)buf, \"\\n\");\n\n\tdbgfs_set_targets(ctx, 1, NULL);\n\tsprint_target_ids(ctx, buf, 64);\n\tKUNIT_EXPECT_STREQ(test, (char *)buf, \"42\\n\");\n\n\tdbgfs_set_targets(ctx, 0, NULL);\n\tsprint_target_ids(ctx, buf, 64);\n\tKUNIT_EXPECT_STREQ(test, (char *)buf, \"\\n\");\n\n\tdbgfs_destroy_ctx(ctx);\n}\n\nstatic void damon_dbgfs_test_set_init_regions(struct kunit *test)\n{\n\tstruct damon_ctx *ctx = damon_new_ctx();\n\t \n\tchar * const valid_inputs[] = {\"1 10 20\\n 1   20 30\\n1 35 45\",\n\t\t\"1 10 20\\n\",\n\t\t\"1 10 20\\n0 39 59\\n0 70 134\\n  1  20 25\\n\",\n\t\t\"\"};\n\t \n\tchar * const valid_expects[] = {\"1 10 20\\n1 20 30\\n1 35 45\\n\",\n\t\t\"1 10 20\\n\",\n\t\t\"0 39 59\\n0 70 134\\n1 10 20\\n1 20 25\\n\",\n\t\t\"\"};\n\tchar * const invalid_inputs[] = {\"3 10 20\\n\",\t \n\t\t\"1 10 20\\n 1 14 26\\n\",\t\t \n\t\t\"0 10 20\\n1 30 40\\n 0 5 8\"};\t \n\tchar *input, *expect;\n\tint i, rc;\n\tchar buf[256];\n\n\tdamon_select_ops(ctx, DAMON_OPS_PADDR);\n\n\tdbgfs_set_targets(ctx, 3, NULL);\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(valid_inputs); i++) {\n\t\tinput = valid_inputs[i];\n\t\texpect = valid_expects[i];\n\n\t\trc = set_init_regions(ctx, input, strnlen(input, 256));\n\t\tKUNIT_EXPECT_EQ(test, rc, 0);\n\n\t\tmemset(buf, 0, 256);\n\t\tsprint_init_regions(ctx, buf, 256);\n\n\t\tKUNIT_EXPECT_STREQ(test, (char *)buf, expect);\n\t}\n\t \n\tfor (i = 0; i < ARRAY_SIZE(invalid_inputs); i++) {\n\t\tinput = invalid_inputs[i];\n\t\tpr_info(\"input: %s\\n\", input);\n\t\trc = set_init_regions(ctx, input, strnlen(input, 256));\n\t\tKUNIT_EXPECT_EQ(test, rc, -EINVAL);\n\n\t\tmemset(buf, 0, 256);\n\t\tsprint_init_regions(ctx, buf, 256);\n\n\t\tKUNIT_EXPECT_STREQ(test, (char *)buf, \"\");\n\t}\n\n\tdbgfs_set_targets(ctx, 0, NULL);\n\tdamon_destroy_ctx(ctx);\n}\n\nstatic struct kunit_case damon_test_cases[] = {\n\tKUNIT_CASE(damon_dbgfs_test_str_to_ints),\n\tKUNIT_CASE(damon_dbgfs_test_set_targets),\n\tKUNIT_CASE(damon_dbgfs_test_set_init_regions),\n\t{},\n};\n\nstatic struct kunit_suite damon_test_suite = {\n\t.name = \"damon-dbgfs\",\n\t.test_cases = damon_test_cases,\n};\nkunit_test_suite(damon_test_suite);\n\n#endif  \n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}