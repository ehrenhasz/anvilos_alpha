{
  "module_name": "page_poison.c",
  "hash_id": "ea87cf58ce6316685fb235c0ab4be659343dfc6e8594277f49225e4582d01c1f",
  "original_prompt": "Ingested from linux-6.6.14/mm/page_poison.c",
  "human_readable_source": "\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/mm.h>\n#include <linux/mmdebug.h>\n#include <linux/highmem.h>\n#include <linux/poison.h>\n#include <linux/ratelimit.h>\n#include <linux/kasan.h>\n\nbool _page_poisoning_enabled_early;\nEXPORT_SYMBOL(_page_poisoning_enabled_early);\nDEFINE_STATIC_KEY_FALSE(_page_poisoning_enabled);\nEXPORT_SYMBOL(_page_poisoning_enabled);\n\nstatic int __init early_page_poison_param(char *buf)\n{\n\treturn kstrtobool(buf, &_page_poisoning_enabled_early);\n}\nearly_param(\"page_poison\", early_page_poison_param);\n\nstatic void poison_page(struct page *page)\n{\n\tvoid *addr = kmap_atomic(page);\n\n\t \n\tkasan_disable_current();\n\tmemset(kasan_reset_tag(addr), PAGE_POISON, PAGE_SIZE);\n\tkasan_enable_current();\n\tkunmap_atomic(addr);\n}\n\nvoid __kernel_poison_pages(struct page *page, int n)\n{\n\tint i;\n\n\tfor (i = 0; i < n; i++)\n\t\tpoison_page(page + i);\n}\n\nstatic bool single_bit_flip(unsigned char a, unsigned char b)\n{\n\tunsigned char error = a ^ b;\n\n\treturn error && !(error & (error - 1));\n}\n\nstatic void check_poison_mem(struct page *page, unsigned char *mem, size_t bytes)\n{\n\tstatic DEFINE_RATELIMIT_STATE(ratelimit, 5 * HZ, 10);\n\tunsigned char *start;\n\tunsigned char *end;\n\n\tstart = memchr_inv(mem, PAGE_POISON, bytes);\n\tif (!start)\n\t\treturn;\n\n\tfor (end = mem + bytes - 1; end > start; end--) {\n\t\tif (*end != PAGE_POISON)\n\t\t\tbreak;\n\t}\n\n\tif (!__ratelimit(&ratelimit))\n\t\treturn;\n\telse if (start == end && single_bit_flip(*start, PAGE_POISON))\n\t\tpr_err(\"pagealloc: single bit error\\n\");\n\telse\n\t\tpr_err(\"pagealloc: memory corruption\\n\");\n\n\tprint_hex_dump(KERN_ERR, \"\", DUMP_PREFIX_ADDRESS, 16, 1, start,\n\t\t\tend - start + 1, 1);\n\tdump_stack();\n\tdump_page(page, \"pagealloc: corrupted page details\");\n}\n\nstatic void unpoison_page(struct page *page)\n{\n\tvoid *addr;\n\n\taddr = kmap_atomic(page);\n\tkasan_disable_current();\n\t \n\tcheck_poison_mem(page, kasan_reset_tag(addr), PAGE_SIZE);\n\tkasan_enable_current();\n\tkunmap_atomic(addr);\n}\n\nvoid __kernel_unpoison_pages(struct page *page, int n)\n{\n\tint i;\n\n\tfor (i = 0; i < n; i++)\n\t\tunpoison_page(page + i);\n}\n\n#ifndef CONFIG_ARCH_SUPPORTS_DEBUG_PAGEALLOC\nvoid __kernel_map_pages(struct page *page, int numpages, int enable)\n{\n\t \n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}