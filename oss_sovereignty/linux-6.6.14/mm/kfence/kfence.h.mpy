{
  "module_name": "kfence.h",
  "hash_id": "6611c734aed001b0b4639453f31e805427fe92d4dca8259bcfa4b3eef532c24a",
  "original_prompt": "Ingested from linux-6.6.14/mm/kfence/kfence.h",
  "human_readable_source": " \n \n\n#ifndef MM_KFENCE_KFENCE_H\n#define MM_KFENCE_KFENCE_H\n\n#include <linux/mm.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n\n#include \"../slab.h\"  \n\n \n#define KFENCE_CANARY_PATTERN_U8(addr) ((u8)0xaa ^ (u8)((unsigned long)(addr) & 0x7))\n\n \n#define KFENCE_CANARY_PATTERN_U64 ((u64)0xaaaaaaaaaaaaaaaa ^ (u64)(le64_to_cpu(0x0706050403020100)))\n\n \n#define KFENCE_STACK_DEPTH 64\n\n \nenum kfence_object_state {\n\tKFENCE_OBJECT_UNUSED,\t\t \n\tKFENCE_OBJECT_ALLOCATED,\t \n\tKFENCE_OBJECT_FREED,\t\t \n};\n\n \nstruct kfence_track {\n\tpid_t pid;\n\tint cpu;\n\tu64 ts_nsec;\n\tint num_stack_entries;\n\tunsigned long stack_entries[KFENCE_STACK_DEPTH];\n};\n\n \nstruct kfence_metadata {\n\tstruct list_head list;\t\t \n\tstruct rcu_head rcu_head;\t \n\n\t \n\traw_spinlock_t lock;\n\n\t \n\tenum kfence_object_state state;\n\n\t \n\tunsigned long addr;\n\n\t \n\tsize_t size;\n\n\t \n\tstruct kmem_cache *cache;\n\n\t \n\tunsigned long unprotected_page;\n\n\t \n\tstruct kfence_track alloc_track;\n\tstruct kfence_track free_track;\n\t \n\tu32 alloc_stack_hash;\n#ifdef CONFIG_MEMCG\n\tstruct obj_cgroup *objcg;\n#endif\n};\n\n#define KFENCE_METADATA_SIZE PAGE_ALIGN(sizeof(struct kfence_metadata) * \\\n\t\t\t\t\tCONFIG_KFENCE_NUM_OBJECTS)\n\nextern struct kfence_metadata *kfence_metadata;\n\nstatic inline struct kfence_metadata *addr_to_metadata(unsigned long addr)\n{\n\tlong index;\n\n\t \n\n\tif (!is_kfence_address((void *)addr))\n\t\treturn NULL;\n\n\t \n\tindex = (addr - (unsigned long)__kfence_pool) / (PAGE_SIZE * 2) - 1;\n\tif (index < 0 || index >= CONFIG_KFENCE_NUM_OBJECTS)\n\t\treturn NULL;\n\n\treturn &kfence_metadata[index];\n}\n\n \nenum kfence_error_type {\n\tKFENCE_ERROR_OOB,\t\t \n\tKFENCE_ERROR_UAF,\t\t \n\tKFENCE_ERROR_CORRUPTION,\t \n\tKFENCE_ERROR_INVALID,\t\t \n\tKFENCE_ERROR_INVALID_FREE,\t \n};\n\nvoid kfence_report_error(unsigned long address, bool is_write, struct pt_regs *regs,\n\t\t\t const struct kfence_metadata *meta, enum kfence_error_type type);\n\nvoid kfence_print_object(struct seq_file *seq, const struct kfence_metadata *meta);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}