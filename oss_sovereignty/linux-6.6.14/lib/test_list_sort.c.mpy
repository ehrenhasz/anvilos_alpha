{
  "module_name": "test_list_sort.c",
  "hash_id": "9ca005dc7fd41de5e1572968041d9ca7b05d8ad463181ef1c7a81622ca20d8c7",
  "original_prompt": "Ingested from linux-6.6.14/lib/test_list_sort.c",
  "human_readable_source": "\n#include <kunit/test.h>\n\n#include <linux/kernel.h>\n#include <linux/list_sort.h>\n#include <linux/list.h>\n#include <linux/module.h>\n#include <linux/printk.h>\n#include <linux/slab.h>\n#include <linux/random.h>\n\n \n#define TEST_LIST_LEN (512+128+2)  \n\n#define TEST_POISON1 0xDEADBEEF\n#define TEST_POISON2 0xA324354C\n\nstruct debug_el {\n\tunsigned int poison1;\n\tstruct list_head list;\n\tunsigned int poison2;\n\tint value;\n\tunsigned int serial;\n};\n\nstatic void check(struct kunit *test, struct debug_el *ela, struct debug_el *elb)\n{\n\tstruct debug_el **elts = test->priv;\n\n\tKUNIT_EXPECT_LT_MSG(test, ela->serial, (unsigned int)TEST_LIST_LEN, \"incorrect serial\");\n\tKUNIT_EXPECT_LT_MSG(test, elb->serial, (unsigned int)TEST_LIST_LEN, \"incorrect serial\");\n\n\tKUNIT_EXPECT_PTR_EQ_MSG(test, elts[ela->serial], ela, \"phantom element\");\n\tKUNIT_EXPECT_PTR_EQ_MSG(test, elts[elb->serial], elb, \"phantom element\");\n\n\tKUNIT_EXPECT_EQ_MSG(test, ela->poison1, TEST_POISON1, \"bad poison\");\n\tKUNIT_EXPECT_EQ_MSG(test, ela->poison2, TEST_POISON2, \"bad poison\");\n\n\tKUNIT_EXPECT_EQ_MSG(test, elb->poison1, TEST_POISON1, \"bad poison\");\n\tKUNIT_EXPECT_EQ_MSG(test, elb->poison2, TEST_POISON2, \"bad poison\");\n}\n\n \nstatic int cmp(void *priv, const struct list_head *a, const struct list_head *b)\n{\n\tstruct debug_el *ela, *elb;\n\n\tela = container_of(a, struct debug_el, list);\n\telb = container_of(b, struct debug_el, list);\n\n\tcheck(priv, ela, elb);\n\treturn ela->value - elb->value;\n}\n\nstatic void list_sort_test(struct kunit *test)\n{\n\tint i, count = 1;\n\tstruct debug_el *el, **elts;\n\tstruct list_head *cur;\n\tLIST_HEAD(head);\n\n\telts = kunit_kcalloc(test, TEST_LIST_LEN, sizeof(*elts), GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, elts);\n\ttest->priv = elts;\n\n\tfor (i = 0; i < TEST_LIST_LEN; i++) {\n\t\tel = kunit_kmalloc(test, sizeof(*el), GFP_KERNEL);\n\t\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, el);\n\n\t\t  \n\t\tel->value = get_random_u32_below(TEST_LIST_LEN / 3);\n\t\tel->serial = i;\n\t\tel->poison1 = TEST_POISON1;\n\t\tel->poison2 = TEST_POISON2;\n\t\telts[i] = el;\n\t\tlist_add_tail(&el->list, &head);\n\t}\n\n\tlist_sort(test, &head, cmp);\n\n\tfor (cur = head.next; cur->next != &head; cur = cur->next) {\n\t\tstruct debug_el *el1;\n\t\tint cmp_result;\n\n\t\tKUNIT_ASSERT_PTR_EQ_MSG(test, cur->next->prev, cur,\n\t\t\t\t\t\"list is corrupted\");\n\n\t\tcmp_result = cmp(test, cur, cur->next);\n\t\tKUNIT_ASSERT_LE_MSG(test, cmp_result, 0, \"list is not sorted\");\n\n\t\tel = container_of(cur, struct debug_el, list);\n\t\tel1 = container_of(cur->next, struct debug_el, list);\n\t\tif (cmp_result == 0) {\n\t\t\tKUNIT_ASSERT_LE_MSG(test, el->serial, el1->serial,\n\t\t\t\t\t    \"order of equivalent elements not preserved\");\n\t\t}\n\n\t\tcheck(test, el, el1);\n\t\tcount++;\n\t}\n\tKUNIT_EXPECT_PTR_EQ_MSG(test, head.prev, cur, \"list is corrupted\");\n\n\tKUNIT_EXPECT_EQ_MSG(test, count, TEST_LIST_LEN,\n\t\t\t    \"list length changed after sorting!\");\n}\n\nstatic struct kunit_case list_sort_cases[] = {\n\tKUNIT_CASE(list_sort_test),\n\t{}\n};\n\nstatic struct kunit_suite list_sort_suite = {\n\t.name = \"list_sort\",\n\t.test_cases = list_sort_cases,\n};\n\nkunit_test_suites(&list_sort_suite);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}