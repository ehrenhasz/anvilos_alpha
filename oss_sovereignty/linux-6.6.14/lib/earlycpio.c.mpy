{
  "module_name": "earlycpio.c",
  "hash_id": "f27f97a58e97955151cc75b0f112f5946678234cbc08e3e40dfa351605263294",
  "original_prompt": "Ingested from linux-6.6.14/lib/earlycpio.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/earlycpio.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n\nenum cpio_fields {\n\tC_MAGIC,\n\tC_INO,\n\tC_MODE,\n\tC_UID,\n\tC_GID,\n\tC_NLINK,\n\tC_MTIME,\n\tC_FILESIZE,\n\tC_MAJ,\n\tC_MIN,\n\tC_RMAJ,\n\tC_RMIN,\n\tC_NAMESIZE,\n\tC_CHKSUM,\n\tC_NFIELDS\n};\n\n \n\nstruct cpio_data find_cpio_data(const char *path, void *data,\n\t\t\t\tsize_t len,  long *nextoff)\n{\n\tconst size_t cpio_header_len = 8*C_NFIELDS - 2;\n\tstruct cpio_data cd = { NULL, 0, \"\" };\n\tconst char *p, *dptr, *nptr;\n\tunsigned int ch[C_NFIELDS], *chp, v;\n\tunsigned char c, x;\n\tsize_t mypathsize = strlen(path);\n\tint i, j;\n\n\tp = data;\n\n\twhile (len > cpio_header_len) {\n\t\tif (!*p) {\n\t\t\t \n\t\t\tp += 4;\n\t\t\tlen -= 4;\n\t\t\tcontinue;\n\t\t}\n\n\t\tj = 6;\t\t \n\t\tchp = ch;\n\t\tfor (i = C_NFIELDS; i; i--) {\n\t\t\tv = 0;\n\t\t\twhile (j--) {\n\t\t\t\tv <<= 4;\n\t\t\t\tc = *p++;\n\n\t\t\t\tx = c - '0';\n\t\t\t\tif (x < 10) {\n\t\t\t\t\tv += x;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tx = (c | 0x20) - 'a';\n\t\t\t\tif (x < 6) {\n\t\t\t\t\tv += x + 10;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tgoto quit;  \n\t\t\t}\n\t\t\t*chp++ = v;\n\t\t\tj = 8;\t \n\t\t}\n\n\t\tif ((ch[C_MAGIC] - 0x070701) > 1)\n\t\t\tgoto quit;  \n\n\t\tlen -= cpio_header_len;\n\n\t\tdptr = PTR_ALIGN(p + ch[C_NAMESIZE], 4);\n\t\tnptr = PTR_ALIGN(dptr + ch[C_FILESIZE], 4);\n\n\t\tif (nptr > p + len || dptr < p || nptr < dptr)\n\t\t\tgoto quit;  \n\n\t\tif ((ch[C_MODE] & 0170000) == 0100000 &&\n\t\t    ch[C_NAMESIZE] >= mypathsize &&\n\t\t    !memcmp(p, path, mypathsize)) {\n\n\t\t\tif (nextoff)\n\t\t\t\t*nextoff = (long)nptr - (long)data;\n\n\t\t\tif (ch[C_NAMESIZE] - mypathsize >= MAX_CPIO_FILE_NAME) {\n\t\t\t\tpr_warn(\n\t\t\t\t\"File %s exceeding MAX_CPIO_FILE_NAME [%d]\\n\",\n\t\t\t\tp, MAX_CPIO_FILE_NAME);\n\t\t\t}\n\t\t\tstrscpy(cd.name, p + mypathsize, MAX_CPIO_FILE_NAME);\n\n\t\t\tcd.data = (void *)dptr;\n\t\t\tcd.size = ch[C_FILESIZE];\n\t\t\treturn cd;  \n\t\t}\n\t\tlen -= (nptr - p);\n\t\tp = nptr;\n\t}\n\nquit:\n\treturn cd;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}