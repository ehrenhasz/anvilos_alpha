{
  "module_name": "usercopy.c",
  "hash_id": "ce88b6e582d36a8b475f5b77776506ffa3705cb06c225f13dba18ac9c8aa5f32",
  "original_prompt": "Ingested from linux-6.6.14/lib/usercopy.c",
  "human_readable_source": "\n#include <linux/bitops.h>\n#include <linux/fault-inject-usercopy.h>\n#include <linux/instrumented.h>\n#include <linux/uaccess.h>\n#include <linux/nospec.h>\n\n \n\n#ifndef INLINE_COPY_FROM_USER\nunsigned long _copy_from_user(void *to, const void __user *from, unsigned long n)\n{\n\tunsigned long res = n;\n\tmight_fault();\n\tif (!should_fail_usercopy() && likely(access_ok(from, n))) {\n\t\t \n\t\tbarrier_nospec();\n\t\tinstrument_copy_from_user_before(to, from, n);\n\t\tres = raw_copy_from_user(to, from, n);\n\t\tinstrument_copy_from_user_after(to, from, n, res);\n\t}\n\tif (unlikely(res))\n\t\tmemset(to + (n - res), 0, res);\n\treturn res;\n}\nEXPORT_SYMBOL(_copy_from_user);\n#endif\n\n#ifndef INLINE_COPY_TO_USER\nunsigned long _copy_to_user(void __user *to, const void *from, unsigned long n)\n{\n\tmight_fault();\n\tif (should_fail_usercopy())\n\t\treturn n;\n\tif (likely(access_ok(to, n))) {\n\t\tinstrument_copy_to_user(to, from, n);\n\t\tn = raw_copy_to_user(to, from, n);\n\t}\n\treturn n;\n}\nEXPORT_SYMBOL(_copy_to_user);\n#endif\n\n \nint check_zeroed_user(const void __user *from, size_t size)\n{\n\tunsigned long val;\n\tuintptr_t align = (uintptr_t) from % sizeof(unsigned long);\n\n\tif (unlikely(size == 0))\n\t\treturn 1;\n\n\tfrom -= align;\n\tsize += align;\n\n\tif (!user_read_access_begin(from, size))\n\t\treturn -EFAULT;\n\n\tunsafe_get_user(val, (unsigned long __user *) from, err_fault);\n\tif (align)\n\t\tval &= ~aligned_byte_mask(align);\n\n\twhile (size > sizeof(unsigned long)) {\n\t\tif (unlikely(val))\n\t\t\tgoto done;\n\n\t\tfrom += sizeof(unsigned long);\n\t\tsize -= sizeof(unsigned long);\n\n\t\tunsafe_get_user(val, (unsigned long __user *) from, err_fault);\n\t}\n\n\tif (size < sizeof(unsigned long))\n\t\tval &= aligned_byte_mask(size);\n\ndone:\n\tuser_read_access_end();\n\treturn (val == 0);\nerr_fault:\n\tuser_read_access_end();\n\treturn -EFAULT;\n}\nEXPORT_SYMBOL(check_zeroed_user);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}