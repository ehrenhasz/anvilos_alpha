{
  "module_name": "dhry_run.c",
  "hash_id": "2130fc9627533f01e4e5e735bc80d31070f8b436765fd4c3596e29bb3664d894",
  "original_prompt": "Ingested from linux-6.6.14/lib/dhry_run.c",
  "human_readable_source": "\n \n\n#include \"dhry.h\"\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/mutex.h>\n#include <linux/smp.h>\n\n#define DHRY_VAX\t1757\n\nstatic int dhry_run_set(const char *val, const struct kernel_param *kp);\nstatic const struct kernel_param_ops run_ops = {\n\t.flags = KERNEL_PARAM_OPS_FL_NOARG,\n\t.set = dhry_run_set,\n};\nstatic bool dhry_run;\nmodule_param_cb(run, &run_ops, &dhry_run, 0200);\nMODULE_PARM_DESC(run, \"Run the test (default: false)\");\n\nstatic int iterations = -1;\nmodule_param(iterations, int, 0644);\nMODULE_PARM_DESC(iterations,\n\t\t\"Number of iterations through the benchmark (default: auto)\");\n\nstatic void dhry_benchmark(void)\n{\n\tunsigned int cpu = get_cpu();\n\tint i, n;\n\n\tif (iterations > 0) {\n\t\tn = dhry(iterations);\n\t\tgoto report;\n\t}\n\n\tfor (i = DHRY_VAX; i > 0; i <<= 1) {\n\t\tn = dhry(i);\n\t\tif (n != -EAGAIN)\n\t\t\tbreak;\n\t}\n\nreport:\n\tput_cpu();\n\tif (n >= 0)\n\t\tpr_info(\"CPU%u: Dhrystones per Second: %d (%d DMIPS)\\n\", cpu,\n\t\t\tn, n / DHRY_VAX);\n\telse if (n == -EAGAIN)\n\t\tpr_err(\"Please increase the number of iterations\\n\");\n\telse\n\t\tpr_err(\"Dhrystone benchmark failed error %pe\\n\", ERR_PTR(n));\n}\n\nstatic int dhry_run_set(const char *val, const struct kernel_param *kp)\n{\n\tint ret;\n\n\tif (val) {\n\t\tret = param_set_bool(val, kp);\n\t\tif (ret)\n\t\t\treturn ret;\n\t} else {\n\t\tdhry_run = true;\n\t}\n\n\tif (dhry_run && system_state == SYSTEM_RUNNING)\n\t\tdhry_benchmark();\n\n\treturn 0;\n}\n\nstatic int __init dhry_init(void)\n{\n\tif (dhry_run)\n\t\tdhry_benchmark();\n\n\treturn 0;\n}\nmodule_init(dhry_init);\n\nMODULE_AUTHOR(\"Geert Uytterhoeven <geert+renesas@glider.be>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}