{
  "module_name": "find_bit_benchmark.c",
  "hash_id": "b7a3efe0ae0cadb9fa4f5fc8aa7c943d7dc817942708cc0a84951d9a89064cdf",
  "original_prompt": "Ingested from linux-6.6.14/lib/find_bit_benchmark.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/bitops.h>\n#include <linux/kernel.h>\n#include <linux/list.h>\n#include <linux/module.h>\n#include <linux/printk.h>\n#include <linux/random.h>\n\n#define BITMAP_LEN\t(4096UL * 8 * 10)\n#define SPARSE\t\t500\n\nstatic DECLARE_BITMAP(bitmap, BITMAP_LEN) __initdata;\nstatic DECLARE_BITMAP(bitmap2, BITMAP_LEN) __initdata;\n\n \nstatic int __init test_find_first_bit(void *bitmap, unsigned long len)\n{\n\tunsigned long i, cnt;\n\tktime_t time;\n\n\ttime = ktime_get();\n\tfor (cnt = i = 0; i < len; cnt++) {\n\t\ti = find_first_bit(bitmap, len);\n\t\t__clear_bit(i, bitmap);\n\t}\n\ttime = ktime_get() - time;\n\tpr_err(\"find_first_bit:     %18llu ns, %6ld iterations\\n\", time, cnt);\n\n\treturn 0;\n}\n\nstatic int __init test_find_first_and_bit(void *bitmap, const void *bitmap2, unsigned long len)\n{\n\tstatic DECLARE_BITMAP(cp, BITMAP_LEN) __initdata;\n\tunsigned long i, cnt;\n\tktime_t time;\n\n\tbitmap_copy(cp, bitmap, BITMAP_LEN);\n\n\ttime = ktime_get();\n\tfor (cnt = i = 0; i < len; cnt++) {\n\t\ti = find_first_and_bit(cp, bitmap2, len);\n\t\t__clear_bit(i, cp);\n\t}\n\ttime = ktime_get() - time;\n\tpr_err(\"find_first_and_bit: %18llu ns, %6ld iterations\\n\", time, cnt);\n\n\treturn 0;\n}\n\nstatic int __init test_find_next_bit(const void *bitmap, unsigned long len)\n{\n\tunsigned long i, cnt;\n\tktime_t time;\n\n\ttime = ktime_get();\n\tfor (cnt = i = 0; i < BITMAP_LEN; cnt++)\n\t\ti = find_next_bit(bitmap, BITMAP_LEN, i) + 1;\n\ttime = ktime_get() - time;\n\tpr_err(\"find_next_bit:      %18llu ns, %6ld iterations\\n\", time, cnt);\n\n\treturn 0;\n}\n\nstatic int __init test_find_next_zero_bit(const void *bitmap, unsigned long len)\n{\n\tunsigned long i, cnt;\n\tktime_t time;\n\n\ttime = ktime_get();\n\tfor (cnt = i = 0; i < BITMAP_LEN; cnt++)\n\t\ti = find_next_zero_bit(bitmap, len, i) + 1;\n\ttime = ktime_get() - time;\n\tpr_err(\"find_next_zero_bit: %18llu ns, %6ld iterations\\n\", time, cnt);\n\n\treturn 0;\n}\n\nstatic int __init test_find_last_bit(const void *bitmap, unsigned long len)\n{\n\tunsigned long l, cnt = 0;\n\tktime_t time;\n\n\ttime = ktime_get();\n\tdo {\n\t\tcnt++;\n\t\tl = find_last_bit(bitmap, len);\n\t\tif (l >= len)\n\t\t\tbreak;\n\t\tlen = l;\n\t} while (len);\n\ttime = ktime_get() - time;\n\tpr_err(\"find_last_bit:      %18llu ns, %6ld iterations\\n\", time, cnt);\n\n\treturn 0;\n}\n\nstatic int __init test_find_nth_bit(const unsigned long *bitmap, unsigned long len)\n{\n\tunsigned long l, n, w = bitmap_weight(bitmap, len);\n\tktime_t time;\n\n\ttime = ktime_get();\n\tfor (n = 0; n < w; n++) {\n\t\tl = find_nth_bit(bitmap, len, n);\n\t\tWARN_ON(l >= len);\n\t}\n\ttime = ktime_get() - time;\n\tpr_err(\"find_nth_bit:       %18llu ns, %6ld iterations\\n\", time, w);\n\n\treturn 0;\n}\n\nstatic int __init test_find_next_and_bit(const void *bitmap,\n\t\tconst void *bitmap2, unsigned long len)\n{\n\tunsigned long i, cnt;\n\tktime_t time;\n\n\ttime = ktime_get();\n\tfor (cnt = i = 0; i < BITMAP_LEN; cnt++)\n\t\ti = find_next_and_bit(bitmap, bitmap2, BITMAP_LEN, i + 1);\n\ttime = ktime_get() - time;\n\tpr_err(\"find_next_and_bit:  %18llu ns, %6ld iterations\\n\", time, cnt);\n\n\treturn 0;\n}\n\nstatic int __init find_bit_test(void)\n{\n\tunsigned long nbits = BITMAP_LEN / SPARSE;\n\n\tpr_err(\"\\nStart testing find_bit() with random-filled bitmap\\n\");\n\n\tget_random_bytes(bitmap, sizeof(bitmap));\n\tget_random_bytes(bitmap2, sizeof(bitmap2));\n\n\ttest_find_next_bit(bitmap, BITMAP_LEN);\n\ttest_find_next_zero_bit(bitmap, BITMAP_LEN);\n\ttest_find_last_bit(bitmap, BITMAP_LEN);\n\ttest_find_nth_bit(bitmap, BITMAP_LEN / 10);\n\n\t \n\ttest_find_first_bit(bitmap, BITMAP_LEN / 10);\n\ttest_find_first_and_bit(bitmap, bitmap2, BITMAP_LEN / 2);\n\ttest_find_next_and_bit(bitmap, bitmap2, BITMAP_LEN);\n\n\tpr_err(\"\\nStart testing find_bit() with sparse bitmap\\n\");\n\n\tbitmap_zero(bitmap, BITMAP_LEN);\n\tbitmap_zero(bitmap2, BITMAP_LEN);\n\n\twhile (nbits--) {\n\t\t__set_bit(get_random_u32_below(BITMAP_LEN), bitmap);\n\t\t__set_bit(get_random_u32_below(BITMAP_LEN), bitmap2);\n\t}\n\n\ttest_find_next_bit(bitmap, BITMAP_LEN);\n\ttest_find_next_zero_bit(bitmap, BITMAP_LEN);\n\ttest_find_last_bit(bitmap, BITMAP_LEN);\n\ttest_find_nth_bit(bitmap, BITMAP_LEN);\n\ttest_find_first_bit(bitmap, BITMAP_LEN);\n\ttest_find_first_and_bit(bitmap, bitmap2, BITMAP_LEN);\n\ttest_find_next_and_bit(bitmap, bitmap2, BITMAP_LEN);\n\n\t \n\treturn -EINVAL;\n}\nmodule_init(find_bit_test);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}