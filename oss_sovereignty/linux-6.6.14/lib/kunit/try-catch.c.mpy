{
  "module_name": "try-catch.c",
  "hash_id": "820b66fbb9c8105b5271cdde2fc8c503c174941d192787ed60eebf9a62020c15",
  "original_prompt": "Ingested from linux-6.6.14/lib/kunit/try-catch.c",
  "human_readable_source": "\n \n\n#include <kunit/test.h>\n#include <linux/completion.h>\n#include <linux/kernel.h>\n#include <linux/kthread.h>\n\n#include \"try-catch-impl.h\"\n\nvoid __noreturn kunit_try_catch_throw(struct kunit_try_catch *try_catch)\n{\n\ttry_catch->try_result = -EFAULT;\n\tkthread_complete_and_exit(try_catch->try_completion, -EFAULT);\n}\nEXPORT_SYMBOL_GPL(kunit_try_catch_throw);\n\nstatic int kunit_generic_run_threadfn_adapter(void *data)\n{\n\tstruct kunit_try_catch *try_catch = data;\n\n\ttry_catch->try(try_catch->context);\n\n\tkthread_complete_and_exit(try_catch->try_completion, 0);\n}\n\nstatic unsigned long kunit_test_timeout(void)\n{\n\t \n\treturn 300 * msecs_to_jiffies(MSEC_PER_SEC);  \n}\n\nvoid kunit_try_catch_run(struct kunit_try_catch *try_catch, void *context)\n{\n\tDECLARE_COMPLETION_ONSTACK(try_completion);\n\tstruct kunit *test = try_catch->test;\n\tstruct task_struct *task_struct;\n\tint exit_code, time_remaining;\n\n\ttry_catch->context = context;\n\ttry_catch->try_completion = &try_completion;\n\ttry_catch->try_result = 0;\n\ttask_struct = kthread_run(kunit_generic_run_threadfn_adapter,\n\t\t\t\t  try_catch,\n\t\t\t\t  \"kunit_try_catch_thread\");\n\tif (IS_ERR(task_struct)) {\n\t\ttry_catch->catch(try_catch->context);\n\t\treturn;\n\t}\n\n\ttime_remaining = wait_for_completion_timeout(&try_completion,\n\t\t\t\t\t\t     kunit_test_timeout());\n\tif (time_remaining == 0) {\n\t\tkunit_err(test, \"try timed out\\n\");\n\t\ttry_catch->try_result = -ETIMEDOUT;\n\t\tkthread_stop(task_struct);\n\t}\n\n\texit_code = try_catch->try_result;\n\n\tif (!exit_code)\n\t\treturn;\n\n\tif (exit_code == -EFAULT)\n\t\ttry_catch->try_result = 0;\n\telse if (exit_code == -EINTR)\n\t\tkunit_err(test, \"wake_up_process() was never called\\n\");\n\telse if (exit_code)\n\t\tkunit_err(test, \"Unknown error: %d\\n\", exit_code);\n\n\ttry_catch->catch(try_catch->context);\n}\nEXPORT_SYMBOL_GPL(kunit_try_catch_run);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}