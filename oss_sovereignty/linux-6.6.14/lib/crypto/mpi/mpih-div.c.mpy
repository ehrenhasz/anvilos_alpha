{
  "module_name": "mpih-div.c",
  "hash_id": "4bc58e448d4e572945d9e05446ba15907bcc70a8cfb234f5e031e338d5f74c9c",
  "original_prompt": "Ingested from linux-6.6.14/lib/crypto/mpi/mpih-div.c",
  "human_readable_source": "\n \n\n#include \"mpi-internal.h\"\n#include \"longlong.h\"\n\n#ifndef UMUL_TIME\n#define UMUL_TIME 1\n#endif\n#ifndef UDIV_TIME\n#define UDIV_TIME UMUL_TIME\n#endif\n\n\nmpi_limb_t\nmpihelp_mod_1(mpi_ptr_t dividend_ptr, mpi_size_t dividend_size,\n\t\t\tmpi_limb_t divisor_limb)\n{\n\tmpi_size_t i;\n\tmpi_limb_t n1, n0, r;\n\tmpi_limb_t dummy __maybe_unused;\n\n\t \n\tif (!dividend_size)\n\t\treturn 0;\n\n\t \n\tif (UDIV_TIME > (2 * UMUL_TIME + 6)\n\t\t\t&& (UDIV_TIME - (2 * UMUL_TIME + 6)) * dividend_size > UDIV_TIME) {\n\t\tint normalization_steps;\n\n\t\tnormalization_steps = count_leading_zeros(divisor_limb);\n\t\tif (normalization_steps) {\n\t\t\tmpi_limb_t divisor_limb_inverted;\n\n\t\t\tdivisor_limb <<= normalization_steps;\n\n\t\t\t \n\t\t\tif (!(divisor_limb << 1))\n\t\t\t\tdivisor_limb_inverted = ~(mpi_limb_t)0;\n\t\t\telse\n\t\t\t\tudiv_qrnnd(divisor_limb_inverted, dummy,\n\t\t\t\t\t\t-divisor_limb, 0, divisor_limb);\n\n\t\t\tn1 = dividend_ptr[dividend_size - 1];\n\t\t\tr = n1 >> (BITS_PER_MPI_LIMB - normalization_steps);\n\n\t\t\t \n\t\t\tfor (i = dividend_size - 2; i >= 0; i--) {\n\t\t\t\tn0 = dividend_ptr[i];\n\t\t\t\tUDIV_QRNND_PREINV(dummy, r, r,\n\t\t\t\t\t\t((n1 << normalization_steps)\n\t\t\t\t\t\t | (n0 >> (BITS_PER_MPI_LIMB - normalization_steps))),\n\t\t\t\t\t\tdivisor_limb, divisor_limb_inverted);\n\t\t\t\tn1 = n0;\n\t\t\t}\n\t\t\tUDIV_QRNND_PREINV(dummy, r, r,\n\t\t\t\t\tn1 << normalization_steps,\n\t\t\t\t\tdivisor_limb, divisor_limb_inverted);\n\t\t\treturn r >> normalization_steps;\n\t\t} else {\n\t\t\tmpi_limb_t divisor_limb_inverted;\n\n\t\t\t \n\t\t\tif (!(divisor_limb << 1))\n\t\t\t\tdivisor_limb_inverted = ~(mpi_limb_t)0;\n\t\t\telse\n\t\t\t\tudiv_qrnnd(divisor_limb_inverted, dummy,\n\t\t\t\t\t\t-divisor_limb, 0, divisor_limb);\n\n\t\t\ti = dividend_size - 1;\n\t\t\tr = dividend_ptr[i];\n\n\t\t\tif (r >= divisor_limb)\n\t\t\t\tr = 0;\n\t\t\telse\n\t\t\t\ti--;\n\n\t\t\tfor ( ; i >= 0; i--) {\n\t\t\t\tn0 = dividend_ptr[i];\n\t\t\t\tUDIV_QRNND_PREINV(dummy, r, r,\n\t\t\t\t\t\tn0, divisor_limb, divisor_limb_inverted);\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\t} else {\n\t\tif (UDIV_NEEDS_NORMALIZATION) {\n\t\t\tint normalization_steps;\n\n\t\t\tnormalization_steps = count_leading_zeros(divisor_limb);\n\t\t\tif (normalization_steps) {\n\t\t\t\tdivisor_limb <<= normalization_steps;\n\n\t\t\t\tn1 = dividend_ptr[dividend_size - 1];\n\t\t\t\tr = n1 >> (BITS_PER_MPI_LIMB - normalization_steps);\n\n\t\t\t\t \n\t\t\t\tfor (i = dividend_size - 2; i >= 0; i--) {\n\t\t\t\t\tn0 = dividend_ptr[i];\n\t\t\t\t\tudiv_qrnnd(dummy, r, r,\n\t\t\t\t\t\t((n1 << normalization_steps)\n\t\t\t\t\t\t | (n0 >> (BITS_PER_MPI_LIMB - normalization_steps))),\n\t\t\t\t\t\tdivisor_limb);\n\t\t\t\t\tn1 = n0;\n\t\t\t\t}\n\t\t\t\tudiv_qrnnd(dummy, r, r,\n\t\t\t\t\t\tn1 << normalization_steps,\n\t\t\t\t\t\tdivisor_limb);\n\t\t\t\treturn r >> normalization_steps;\n\t\t\t}\n\t\t}\n\t\t \n\t\ti = dividend_size - 1;\n\t\tr = dividend_ptr[i];\n\n\t\tif (r >= divisor_limb)\n\t\t\tr = 0;\n\t\telse\n\t\t\ti--;\n\n\t\tfor (; i >= 0; i--) {\n\t\t\tn0 = dividend_ptr[i];\n\t\t\tudiv_qrnnd(dummy, r, r, n0, divisor_limb);\n\t\t}\n\t\treturn r;\n\t}\n}\n\n \n\nmpi_limb_t\nmpihelp_divrem(mpi_ptr_t qp, mpi_size_t qextra_limbs,\n\t       mpi_ptr_t np, mpi_size_t nsize, mpi_ptr_t dp, mpi_size_t dsize)\n{\n\tmpi_limb_t most_significant_q_limb = 0;\n\n\tswitch (dsize) {\n\tcase 0:\n\t\t \n\t\t \n\t\treturn 1 / dsize;\n\n\tcase 1:\n\t\t{\n\t\t\tmpi_size_t i;\n\t\t\tmpi_limb_t n1;\n\t\t\tmpi_limb_t d;\n\n\t\t\td = dp[0];\n\t\t\tn1 = np[nsize - 1];\n\n\t\t\tif (n1 >= d) {\n\t\t\t\tn1 -= d;\n\t\t\t\tmost_significant_q_limb = 1;\n\t\t\t}\n\n\t\t\tqp += qextra_limbs;\n\t\t\tfor (i = nsize - 2; i >= 0; i--)\n\t\t\t\tudiv_qrnnd(qp[i], n1, n1, np[i], d);\n\t\t\tqp -= qextra_limbs;\n\n\t\t\tfor (i = qextra_limbs - 1; i >= 0; i--)\n\t\t\t\tudiv_qrnnd(qp[i], n1, n1, 0, d);\n\n\t\t\tnp[0] = n1;\n\t\t}\n\t\tbreak;\n\n\tcase 2:\n\t\t{\n\t\t\tmpi_size_t i;\n\t\t\tmpi_limb_t n1, n0, n2;\n\t\t\tmpi_limb_t d1, d0;\n\n\t\t\tnp += nsize - 2;\n\t\t\td1 = dp[1];\n\t\t\td0 = dp[0];\n\t\t\tn1 = np[1];\n\t\t\tn0 = np[0];\n\n\t\t\tif (n1 >= d1 && (n1 > d1 || n0 >= d0)) {\n\t\t\t\tsub_ddmmss(n1, n0, n1, n0, d1, d0);\n\t\t\t\tmost_significant_q_limb = 1;\n\t\t\t}\n\n\t\t\tfor (i = qextra_limbs + nsize - 2 - 1; i >= 0; i--) {\n\t\t\t\tmpi_limb_t q;\n\t\t\t\tmpi_limb_t r;\n\n\t\t\t\tif (i >= qextra_limbs)\n\t\t\t\t\tnp--;\n\t\t\t\telse\n\t\t\t\t\tnp[0] = 0;\n\n\t\t\t\tif (n1 == d1) {\n\t\t\t\t\t \n\t\t\t\t\tq = ~(mpi_limb_t) 0;\n\n\t\t\t\t\tr = n0 + d1;\n\t\t\t\t\tif (r < d1) {\t \n\t\t\t\t\t\tadd_ssaaaa(n1, n0, r - d0,\n\t\t\t\t\t\t\t   np[0], 0, d0);\n\t\t\t\t\t\tqp[i] = q;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tn1 = d0 - (d0 != 0 ? 1 : 0);\n\t\t\t\t\tn0 = -d0;\n\t\t\t\t} else {\n\t\t\t\t\tudiv_qrnnd(q, r, n1, n0, d1);\n\t\t\t\t\tumul_ppmm(n1, n0, d0, q);\n\t\t\t\t}\n\n\t\t\t\tn2 = np[0];\nq_test:\n\t\t\t\tif (n1 > r || (n1 == r && n0 > n2)) {\n\t\t\t\t\t \n\t\t\t\t\tq--;\n\t\t\t\t\tsub_ddmmss(n1, n0, n1, n0, 0, d0);\n\t\t\t\t\tr += d1;\n\t\t\t\t\tif (r >= d1)\t \n\t\t\t\t\t\tgoto q_test;\n\t\t\t\t}\n\n\t\t\t\tqp[i] = q;\n\t\t\t\tsub_ddmmss(n1, n0, r, n2, n1, n0);\n\t\t\t}\n\t\t\tnp[1] = n1;\n\t\t\tnp[0] = n0;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\t{\n\t\t\tmpi_size_t i;\n\t\t\tmpi_limb_t dX, d1, n0;\n\n\t\t\tnp += nsize - dsize;\n\t\t\tdX = dp[dsize - 1];\n\t\t\td1 = dp[dsize - 2];\n\t\t\tn0 = np[dsize - 1];\n\n\t\t\tif (n0 >= dX) {\n\t\t\t\tif (n0 > dX\n\t\t\t\t    || mpihelp_cmp(np, dp, dsize - 1) >= 0) {\n\t\t\t\t\tmpihelp_sub_n(np, np, dp, dsize);\n\t\t\t\t\tn0 = np[dsize - 1];\n\t\t\t\t\tmost_significant_q_limb = 1;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = qextra_limbs + nsize - dsize - 1; i >= 0; i--) {\n\t\t\t\tmpi_limb_t q;\n\t\t\t\tmpi_limb_t n1, n2;\n\t\t\t\tmpi_limb_t cy_limb;\n\n\t\t\t\tif (i >= qextra_limbs) {\n\t\t\t\t\tnp--;\n\t\t\t\t\tn2 = np[dsize];\n\t\t\t\t} else {\n\t\t\t\t\tn2 = np[dsize - 1];\n\t\t\t\t\tMPN_COPY_DECR(np + 1, np, dsize - 1);\n\t\t\t\t\tnp[0] = 0;\n\t\t\t\t}\n\n\t\t\t\tif (n0 == dX) {\n\t\t\t\t\t \n\t\t\t\t\tq = ~(mpi_limb_t) 0;\n\t\t\t\t} else {\n\t\t\t\t\tmpi_limb_t r;\n\n\t\t\t\t\tudiv_qrnnd(q, r, n0, np[dsize - 1], dX);\n\t\t\t\t\tumul_ppmm(n1, n0, d1, q);\n\n\t\t\t\t\twhile (n1 > r\n\t\t\t\t\t       || (n1 == r\n\t\t\t\t\t\t   && n0 > np[dsize - 2])) {\n\t\t\t\t\t\tq--;\n\t\t\t\t\t\tr += dX;\n\t\t\t\t\t\tif (r < dX)\t \n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tn1 -= n0 < d1;\n\t\t\t\t\t\tn0 -= d1;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t \n\t\t\t\tcy_limb = mpihelp_submul_1(np, dp, dsize, q);\n\n\t\t\t\tif (n2 != cy_limb) {\n\t\t\t\t\tmpihelp_add_n(np, np, dp, dsize);\n\t\t\t\t\tq--;\n\t\t\t\t}\n\n\t\t\t\tqp[i] = q;\n\t\t\t\tn0 = np[dsize - 1];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn most_significant_q_limb;\n}\n\n \n\nmpi_limb_t\nmpihelp_divmod_1(mpi_ptr_t quot_ptr,\n\t\tmpi_ptr_t dividend_ptr, mpi_size_t dividend_size,\n\t\tmpi_limb_t divisor_limb)\n{\n\tmpi_size_t i;\n\tmpi_limb_t n1, n0, r;\n\tmpi_limb_t dummy __maybe_unused;\n\n\tif (!dividend_size)\n\t\treturn 0;\n\n\t \n\tif (UDIV_TIME > (2 * UMUL_TIME + 6)\n\t\t\t&& (UDIV_TIME - (2 * UMUL_TIME + 6)) * dividend_size > UDIV_TIME) {\n\t\tint normalization_steps;\n\n\t\tnormalization_steps = count_leading_zeros(divisor_limb);\n\t\tif (normalization_steps) {\n\t\t\tmpi_limb_t divisor_limb_inverted;\n\n\t\t\tdivisor_limb <<= normalization_steps;\n\n\t\t\t \n\t\t\t \n\t\t\tif (!(divisor_limb << 1))\n\t\t\t\tdivisor_limb_inverted = ~(mpi_limb_t)0;\n\t\t\telse\n\t\t\t\tudiv_qrnnd(divisor_limb_inverted, dummy,\n\t\t\t\t\t\t-divisor_limb, 0, divisor_limb);\n\n\t\t\tn1 = dividend_ptr[dividend_size - 1];\n\t\t\tr = n1 >> (BITS_PER_MPI_LIMB - normalization_steps);\n\n\t\t\t \n\t\t\tfor (i = dividend_size - 2; i >= 0; i--) {\n\t\t\t\tn0 = dividend_ptr[i];\n\t\t\t\tUDIV_QRNND_PREINV(quot_ptr[i + 1], r, r,\n\t\t\t\t\t\t((n1 << normalization_steps)\n\t\t\t\t\t\t | (n0 >> (BITS_PER_MPI_LIMB - normalization_steps))),\n\t\t\t\t\t\tdivisor_limb, divisor_limb_inverted);\n\t\t\t\tn1 = n0;\n\t\t\t}\n\t\t\tUDIV_QRNND_PREINV(quot_ptr[0], r, r,\n\t\t\t\t\tn1 << normalization_steps,\n\t\t\t\t\tdivisor_limb, divisor_limb_inverted);\n\t\t\treturn r >> normalization_steps;\n\t\t} else {\n\t\t\tmpi_limb_t divisor_limb_inverted;\n\n\t\t\t \n\t\t\t \n\t\t\tif (!(divisor_limb << 1))\n\t\t\t\tdivisor_limb_inverted = ~(mpi_limb_t) 0;\n\t\t\telse\n\t\t\t\tudiv_qrnnd(divisor_limb_inverted, dummy,\n\t\t\t\t\t\t-divisor_limb, 0, divisor_limb);\n\n\t\t\ti = dividend_size - 1;\n\t\t\tr = dividend_ptr[i];\n\n\t\t\tif (r >= divisor_limb)\n\t\t\t\tr = 0;\n\t\t\telse\n\t\t\t\tquot_ptr[i--] = 0;\n\n\t\t\tfor ( ; i >= 0; i--) {\n\t\t\t\tn0 = dividend_ptr[i];\n\t\t\t\tUDIV_QRNND_PREINV(quot_ptr[i], r, r,\n\t\t\t\t\t\tn0, divisor_limb, divisor_limb_inverted);\n\t\t\t}\n\t\t\treturn r;\n\t\t}\n\t} else {\n\t\tif (UDIV_NEEDS_NORMALIZATION) {\n\t\t\tint normalization_steps;\n\n\t\t\tnormalization_steps = count_leading_zeros(divisor_limb);\n\t\t\tif (normalization_steps) {\n\t\t\t\tdivisor_limb <<= normalization_steps;\n\n\t\t\t\tn1 = dividend_ptr[dividend_size - 1];\n\t\t\t\tr = n1 >> (BITS_PER_MPI_LIMB - normalization_steps);\n\n\t\t\t\t \n\t\t\t\tfor (i = dividend_size - 2; i >= 0; i--) {\n\t\t\t\t\tn0 = dividend_ptr[i];\n\t\t\t\t\tudiv_qrnnd(quot_ptr[i + 1], r, r,\n\t\t\t\t\t\t((n1 << normalization_steps)\n\t\t\t\t\t\t | (n0 >> (BITS_PER_MPI_LIMB - normalization_steps))),\n\t\t\t\t\t\tdivisor_limb);\n\t\t\t\t\tn1 = n0;\n\t\t\t\t}\n\t\t\t\tudiv_qrnnd(quot_ptr[0], r, r,\n\t\t\t\t\t\tn1 << normalization_steps,\n\t\t\t\t\t\tdivisor_limb);\n\t\t\t\treturn r >> normalization_steps;\n\t\t\t}\n\t\t}\n\t\t \n\t\ti = dividend_size - 1;\n\t\tr = dividend_ptr[i];\n\n\t\tif (r >= divisor_limb)\n\t\t\tr = 0;\n\t\telse\n\t\t\tquot_ptr[i--] = 0;\n\n\t\tfor (; i >= 0; i--) {\n\t\t\tn0 = dividend_ptr[i];\n\t\t\tudiv_qrnnd(quot_ptr[i], r, r, n0, divisor_limb);\n\t\t}\n\t\treturn r;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}