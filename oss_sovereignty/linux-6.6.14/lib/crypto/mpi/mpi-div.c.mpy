{
  "module_name": "mpi-div.c",
  "hash_id": "24d452c541a31f772a50ff16173bbce9da84582d9c295076cedf2bc7c39105e1",
  "original_prompt": "Ingested from linux-6.6.14/lib/crypto/mpi/mpi-div.c",
  "human_readable_source": " \n\n#include \"mpi-internal.h\"\n#include \"longlong.h\"\n\nvoid mpi_tdiv_qr(MPI quot, MPI rem, MPI num, MPI den);\nvoid mpi_fdiv_qr(MPI quot, MPI rem, MPI dividend, MPI divisor);\n\nvoid mpi_fdiv_r(MPI rem, MPI dividend, MPI divisor)\n{\n\tint divisor_sign = divisor->sign;\n\tMPI temp_divisor = NULL;\n\n\t \n\tif (rem == divisor) {\n\t\ttemp_divisor = mpi_copy(divisor);\n\t\tdivisor = temp_divisor;\n\t}\n\n\tmpi_tdiv_r(rem, dividend, divisor);\n\n\tif (((divisor_sign?1:0) ^ (dividend->sign?1:0)) && rem->nlimbs)\n\t\tmpi_add(rem, rem, divisor);\n\n\tif (temp_divisor)\n\t\tmpi_free(temp_divisor);\n}\n\nvoid mpi_fdiv_q(MPI quot, MPI dividend, MPI divisor)\n{\n\tMPI tmp = mpi_alloc(mpi_get_nlimbs(quot));\n\tmpi_fdiv_qr(quot, tmp, dividend, divisor);\n\tmpi_free(tmp);\n}\n\nvoid mpi_fdiv_qr(MPI quot, MPI rem, MPI dividend, MPI divisor)\n{\n\tint divisor_sign = divisor->sign;\n\tMPI temp_divisor = NULL;\n\n\tif (quot == divisor || rem == divisor) {\n\t\ttemp_divisor = mpi_copy(divisor);\n\t\tdivisor = temp_divisor;\n\t}\n\n\tmpi_tdiv_qr(quot, rem, dividend, divisor);\n\n\tif ((divisor_sign ^ dividend->sign) && rem->nlimbs) {\n\t\tmpi_sub_ui(quot, quot, 1);\n\t\tmpi_add(rem, rem, divisor);\n\t}\n\n\tif (temp_divisor)\n\t\tmpi_free(temp_divisor);\n}\n\n \n\nvoid mpi_tdiv_r(MPI rem, MPI num, MPI den)\n{\n\tmpi_tdiv_qr(NULL, rem, num, den);\n}\n\nvoid mpi_tdiv_qr(MPI quot, MPI rem, MPI num, MPI den)\n{\n\tmpi_ptr_t np, dp;\n\tmpi_ptr_t qp, rp;\n\tmpi_size_t nsize = num->nlimbs;\n\tmpi_size_t dsize = den->nlimbs;\n\tmpi_size_t qsize, rsize;\n\tmpi_size_t sign_remainder = num->sign;\n\tmpi_size_t sign_quotient = num->sign ^ den->sign;\n\tunsigned int normalization_steps;\n\tmpi_limb_t q_limb;\n\tmpi_ptr_t marker[5];\n\tint markidx = 0;\n\n\t \n\trsize = nsize + 1;\n\tmpi_resize(rem, rsize);\n\n\tqsize = rsize - dsize;\t   \n\tif (qsize <= 0) {\n\t\tif (num != rem) {\n\t\t\trem->nlimbs = num->nlimbs;\n\t\t\trem->sign = num->sign;\n\t\t\tMPN_COPY(rem->d, num->d, nsize);\n\t\t}\n\t\tif (quot) {\n\t\t\t \n\t\t\tquot->nlimbs = 0;\n\t\t\tquot->sign = 0;\n\t\t}\n\t\treturn;\n\t}\n\n\tif (quot)\n\t\tmpi_resize(quot, qsize);\n\n\t \n\tnp = num->d;\n\tdp = den->d;\n\trp = rem->d;\n\n\t \n\tif (dsize == 1) {\n\t\tmpi_limb_t rlimb;\n\t\tif (quot) {\n\t\t\tqp = quot->d;\n\t\t\trlimb = mpihelp_divmod_1(qp, np, nsize, dp[0]);\n\t\t\tqsize -= qp[qsize - 1] == 0;\n\t\t\tquot->nlimbs = qsize;\n\t\t\tquot->sign = sign_quotient;\n\t\t} else\n\t\t\trlimb = mpihelp_mod_1(np, nsize, dp[0]);\n\t\trp[0] = rlimb;\n\t\trsize = rlimb != 0?1:0;\n\t\trem->nlimbs = rsize;\n\t\trem->sign = sign_remainder;\n\t\treturn;\n\t}\n\n\n\tif (quot) {\n\t\tqp = quot->d;\n\t\t \n\t\tif (qp == np) {  \n\t\t\tnp = marker[markidx++] = mpi_alloc_limb_space(nsize);\n\t\t\tMPN_COPY(np, qp, nsize);\n\t\t}\n\t} else  \n\t\tqp = rp + dsize;\n\n\tnormalization_steps = count_leading_zeros(dp[dsize - 1]);\n\n\t \n\tif (normalization_steps) {\n\t\tmpi_ptr_t tp;\n\t\tmpi_limb_t nlimb;\n\n\t\t \n\t\ttp = marker[markidx++] = mpi_alloc_limb_space(dsize);\n\t\tmpihelp_lshift(tp, dp, dsize, normalization_steps);\n\t\tdp = tp;\n\n\t\t \n\t\tnlimb = mpihelp_lshift(rp, np, nsize, normalization_steps);\n\t\tif (nlimb) {\n\t\t\trp[nsize] = nlimb;\n\t\t\trsize = nsize + 1;\n\t\t} else\n\t\t\trsize = nsize;\n\t} else {\n\t\t \n\t\tif (dp == rp || (quot && (dp == qp))) {\n\t\t\tmpi_ptr_t tp;\n\n\t\t\ttp = marker[markidx++] = mpi_alloc_limb_space(dsize);\n\t\t\tMPN_COPY(tp, dp, dsize);\n\t\t\tdp = tp;\n\t\t}\n\n\t\t \n\t\tif (rp != np)\n\t\t\tMPN_COPY(rp, np, nsize);\n\n\t\trsize = nsize;\n\t}\n\n\tq_limb = mpihelp_divrem(qp, 0, rp, rsize, dp, dsize);\n\n\tif (quot) {\n\t\tqsize = rsize - dsize;\n\t\tif (q_limb) {\n\t\t\tqp[qsize] = q_limb;\n\t\t\tqsize += 1;\n\t\t}\n\n\t\tquot->nlimbs = qsize;\n\t\tquot->sign = sign_quotient;\n\t}\n\n\trsize = dsize;\n\tMPN_NORMALIZE(rp, rsize);\n\n\tif (normalization_steps && rsize) {\n\t\tmpihelp_rshift(rp, rp, rsize, normalization_steps);\n\t\trsize -= rp[rsize - 1] == 0?1:0;\n\t}\n\n\trem->nlimbs = rsize;\n\trem->sign\t= sign_remainder;\n\twhile (markidx) {\n\t\tmarkidx--;\n\t\tmpi_free_limb_space(marker[markidx]);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}