{
  "module_name": "poly1305-donna64.c",
  "hash_id": "3c2148525a958401044df27dee481db1a41139ae9667da54610e86f731521c37",
  "original_prompt": "Ingested from linux-6.6.14/lib/crypto/poly1305-donna64.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <asm/unaligned.h>\n#include <crypto/internal/poly1305.h>\n\nvoid poly1305_core_setkey(struct poly1305_core_key *key,\n\t\t\t  const u8 raw_key[POLY1305_BLOCK_SIZE])\n{\n\tu64 t0, t1;\n\n\t \n\tt0 = get_unaligned_le64(&raw_key[0]);\n\tt1 = get_unaligned_le64(&raw_key[8]);\n\n\tkey->key.r64[0] = t0 & 0xffc0fffffffULL;\n\tkey->key.r64[1] = ((t0 >> 44) | (t1 << 20)) & 0xfffffc0ffffULL;\n\tkey->key.r64[2] = ((t1 >> 24)) & 0x00ffffffc0fULL;\n\n\t \n\tkey->precomputed_s.r64[0] = key->key.r64[1] * 20;\n\tkey->precomputed_s.r64[1] = key->key.r64[2] * 20;\n}\nEXPORT_SYMBOL(poly1305_core_setkey);\n\nvoid poly1305_core_blocks(struct poly1305_state *state,\n\t\t\t  const struct poly1305_core_key *key, const void *src,\n\t\t\t  unsigned int nblocks, u32 hibit)\n{\n\tconst u8 *input = src;\n\tu64 hibit64;\n\tu64 r0, r1, r2;\n\tu64 s1, s2;\n\tu64 h0, h1, h2;\n\tu64 c;\n\tu128 d0, d1, d2, d;\n\n\tif (!nblocks)\n\t\treturn;\n\n\thibit64 = ((u64)hibit) << 40;\n\n\tr0 = key->key.r64[0];\n\tr1 = key->key.r64[1];\n\tr2 = key->key.r64[2];\n\n\th0 = state->h64[0];\n\th1 = state->h64[1];\n\th2 = state->h64[2];\n\n\ts1 = key->precomputed_s.r64[0];\n\ts2 = key->precomputed_s.r64[1];\n\n\tdo {\n\t\tu64 t0, t1;\n\n\t\t \n\t\tt0 = get_unaligned_le64(&input[0]);\n\t\tt1 = get_unaligned_le64(&input[8]);\n\n\t\th0 += t0 & 0xfffffffffffULL;\n\t\th1 += ((t0 >> 44) | (t1 << 20)) & 0xfffffffffffULL;\n\t\th2 += (((t1 >> 24)) & 0x3ffffffffffULL) | hibit64;\n\n\t\t \n\t\td0 = (u128)h0 * r0;\n\t\td = (u128)h1 * s2;\n\t\td0 += d;\n\t\td = (u128)h2 * s1;\n\t\td0 += d;\n\t\td1 = (u128)h0 * r1;\n\t\td = (u128)h1 * r0;\n\t\td1 += d;\n\t\td = (u128)h2 * s2;\n\t\td1 += d;\n\t\td2 = (u128)h0 * r2;\n\t\td = (u128)h1 * r1;\n\t\td2 += d;\n\t\td = (u128)h2 * r0;\n\t\td2 += d;\n\n\t\t \n\t\tc = (u64)(d0 >> 44);\n\t\th0 = (u64)d0 & 0xfffffffffffULL;\n\t\td1 += c;\n\t\tc = (u64)(d1 >> 44);\n\t\th1 = (u64)d1 & 0xfffffffffffULL;\n\t\td2 += c;\n\t\tc = (u64)(d2 >> 42);\n\t\th2 = (u64)d2 & 0x3ffffffffffULL;\n\t\th0 += c * 5;\n\t\tc = h0 >> 44;\n\t\th0 = h0 & 0xfffffffffffULL;\n\t\th1 += c;\n\n\t\tinput += POLY1305_BLOCK_SIZE;\n\t} while (--nblocks);\n\n\tstate->h64[0] = h0;\n\tstate->h64[1] = h1;\n\tstate->h64[2] = h2;\n}\nEXPORT_SYMBOL(poly1305_core_blocks);\n\nvoid poly1305_core_emit(const struct poly1305_state *state, const u32 nonce[4],\n\t\t\tvoid *dst)\n{\n\tu8 *mac = dst;\n\tu64 h0, h1, h2, c;\n\tu64 g0, g1, g2;\n\tu64 t0, t1;\n\n\t \n\th0 = state->h64[0];\n\th1 = state->h64[1];\n\th2 = state->h64[2];\n\n\tc = h1 >> 44;\n\th1 &= 0xfffffffffffULL;\n\th2 += c;\n\tc = h2 >> 42;\n\th2 &= 0x3ffffffffffULL;\n\th0 += c * 5;\n\tc = h0 >> 44;\n\th0 &= 0xfffffffffffULL;\n\th1 += c;\n\tc = h1 >> 44;\n\th1 &= 0xfffffffffffULL;\n\th2 += c;\n\tc = h2 >> 42;\n\th2 &= 0x3ffffffffffULL;\n\th0 += c * 5;\n\tc = h0 >> 44;\n\th0 &= 0xfffffffffffULL;\n\th1 += c;\n\n\t \n\tg0 = h0 + 5;\n\tc  = g0 >> 44;\n\tg0 &= 0xfffffffffffULL;\n\tg1 = h1 + c;\n\tc  = g1 >> 44;\n\tg1 &= 0xfffffffffffULL;\n\tg2 = h2 + c - (1ULL << 42);\n\n\t \n\tc = (g2 >> ((sizeof(u64) * 8) - 1)) - 1;\n\tg0 &= c;\n\tg1 &= c;\n\tg2 &= c;\n\tc  = ~c;\n\th0 = (h0 & c) | g0;\n\th1 = (h1 & c) | g1;\n\th2 = (h2 & c) | g2;\n\n\tif (likely(nonce)) {\n\t\t \n\t\tt0 = ((u64)nonce[1] << 32) | nonce[0];\n\t\tt1 = ((u64)nonce[3] << 32) | nonce[2];\n\n\t\th0 += t0 & 0xfffffffffffULL;\n\t\tc = h0 >> 44;\n\t\th0 &= 0xfffffffffffULL;\n\t\th1 += (((t0 >> 44) | (t1 << 20)) & 0xfffffffffffULL) + c;\n\t\tc = h1 >> 44;\n\t\th1 &= 0xfffffffffffULL;\n\t\th2 += (((t1 >> 24)) & 0x3ffffffffffULL) + c;\n\t\th2 &= 0x3ffffffffffULL;\n\t}\n\n\t \n\th0 = h0 | (h1 << 44);\n\th1 = (h1 >> 20) | (h2 << 24);\n\n\tput_unaligned_le64(h0, &mac[0]);\n\tput_unaligned_le64(h1, &mac[8]);\n}\nEXPORT_SYMBOL(poly1305_core_emit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}