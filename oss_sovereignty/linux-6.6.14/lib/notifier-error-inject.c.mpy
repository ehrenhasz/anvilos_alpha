{
  "module_name": "notifier-error-inject.c",
  "hash_id": "93664258aab458e3ab380b963bd8642563928689303b0358c91c2329f303cacf",
  "original_prompt": "Ingested from linux-6.6.14/lib/notifier-error-inject.c",
  "human_readable_source": "\n#include <linux/module.h>\n\n#include \"notifier-error-inject.h\"\n\nstatic int debugfs_errno_set(void *data, u64 val)\n{\n\t*(int *)data = clamp_t(int, val, -MAX_ERRNO, 0);\n\treturn 0;\n}\n\nstatic int debugfs_errno_get(void *data, u64 *val)\n{\n\t*val = *(int *)data;\n\treturn 0;\n}\n\nDEFINE_SIMPLE_ATTRIBUTE_SIGNED(fops_errno, debugfs_errno_get, debugfs_errno_set,\n\t\t\t\"%lld\\n\");\n\nstatic struct dentry *debugfs_create_errno(const char *name, umode_t mode,\n\t\t\t\tstruct dentry *parent, int *value)\n{\n\treturn debugfs_create_file(name, mode, parent, value, &fops_errno);\n}\n\nstatic int notifier_err_inject_callback(struct notifier_block *nb,\n\t\t\t\tunsigned long val, void *p)\n{\n\tint err = 0;\n\tstruct notifier_err_inject *err_inject =\n\t\tcontainer_of(nb, struct notifier_err_inject, nb);\n\tstruct notifier_err_inject_action *action;\n\n\tfor (action = err_inject->actions; action->name; action++) {\n\t\tif (action->val == val) {\n\t\t\terr = action->error;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (err)\n\t\tpr_info(\"Injecting error (%d) to %s\\n\", err, action->name);\n\n\treturn notifier_from_errno(err);\n}\n\nstruct dentry *notifier_err_inject_dir;\nEXPORT_SYMBOL_GPL(notifier_err_inject_dir);\n\nstruct dentry *notifier_err_inject_init(const char *name, struct dentry *parent,\n\t\t\tstruct notifier_err_inject *err_inject, int priority)\n{\n\tstruct notifier_err_inject_action *action;\n\tumode_t mode = S_IFREG | S_IRUSR | S_IWUSR;\n\tstruct dentry *dir;\n\tstruct dentry *actions_dir;\n\n\terr_inject->nb.notifier_call = notifier_err_inject_callback;\n\terr_inject->nb.priority = priority;\n\n\tdir = debugfs_create_dir(name, parent);\n\n\tactions_dir = debugfs_create_dir(\"actions\", dir);\n\n\tfor (action = err_inject->actions; action->name; action++) {\n\t\tstruct dentry *action_dir;\n\n\t\taction_dir = debugfs_create_dir(action->name, actions_dir);\n\n\t\t \n\t\tdebugfs_create_errno(\"error\", mode, action_dir, &action->error);\n\t}\n\treturn dir;\n}\nEXPORT_SYMBOL_GPL(notifier_err_inject_init);\n\nstatic int __init err_inject_init(void)\n{\n\tnotifier_err_inject_dir =\n\t\tdebugfs_create_dir(\"notifier-error-inject\", NULL);\n\n\treturn 0;\n}\n\nstatic void __exit err_inject_exit(void)\n{\n\tdebugfs_remove_recursive(notifier_err_inject_dir);\n}\n\nmodule_init(err_inject_init);\nmodule_exit(err_inject_exit);\n\nMODULE_DESCRIPTION(\"Notifier error injection module\");\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Akinobu Mita <akinobu.mita@gmail.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}