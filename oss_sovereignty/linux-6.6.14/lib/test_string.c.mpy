{
  "module_name": "test_string.c",
  "hash_id": "1b38cf2f40380348d6c563820182483cba795e119fee76915d50a684461f801e",
  "original_prompt": "Ingested from linux-6.6.14/lib/test_string.c",
  "human_readable_source": "\n#include <linux/module.h>\n#include <linux/printk.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n\nstatic __init int memset16_selftest(void)\n{\n\tunsigned i, j, k;\n\tu16 v, *p;\n\n\tp = kmalloc(256 * 2 * 2, GFP_KERNEL);\n\tif (!p)\n\t\treturn -1;\n\n\tfor (i = 0; i < 256; i++) {\n\t\tfor (j = 0; j < 256; j++) {\n\t\t\tmemset(p, 0xa1, 256 * 2 * sizeof(v));\n\t\t\tmemset16(p + i, 0xb1b2, j);\n\t\t\tfor (k = 0; k < 512; k++) {\n\t\t\t\tv = p[k];\n\t\t\t\tif (k < i) {\n\t\t\t\t\tif (v != 0xa1a1)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t} else if (k < i + j) {\n\t\t\t\t\tif (v != 0xb1b2)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t} else {\n\t\t\t\t\tif (v != 0xa1a1)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\nfail:\n\tkfree(p);\n\tif (i < 256)\n\t\treturn (i << 24) | (j << 16) | k | 0x8000;\n\treturn 0;\n}\n\nstatic __init int memset32_selftest(void)\n{\n\tunsigned i, j, k;\n\tu32 v, *p;\n\n\tp = kmalloc(256 * 2 * 4, GFP_KERNEL);\n\tif (!p)\n\t\treturn -1;\n\n\tfor (i = 0; i < 256; i++) {\n\t\tfor (j = 0; j < 256; j++) {\n\t\t\tmemset(p, 0xa1, 256 * 2 * sizeof(v));\n\t\t\tmemset32(p + i, 0xb1b2b3b4, j);\n\t\t\tfor (k = 0; k < 512; k++) {\n\t\t\t\tv = p[k];\n\t\t\t\tif (k < i) {\n\t\t\t\t\tif (v != 0xa1a1a1a1)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t} else if (k < i + j) {\n\t\t\t\t\tif (v != 0xb1b2b3b4)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t} else {\n\t\t\t\t\tif (v != 0xa1a1a1a1)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\nfail:\n\tkfree(p);\n\tif (i < 256)\n\t\treturn (i << 24) | (j << 16) | k | 0x8000;\n\treturn 0;\n}\n\nstatic __init int memset64_selftest(void)\n{\n\tunsigned i, j, k;\n\tu64 v, *p;\n\n\tp = kmalloc(256 * 2 * 8, GFP_KERNEL);\n\tif (!p)\n\t\treturn -1;\n\n\tfor (i = 0; i < 256; i++) {\n\t\tfor (j = 0; j < 256; j++) {\n\t\t\tmemset(p, 0xa1, 256 * 2 * sizeof(v));\n\t\t\tmemset64(p + i, 0xb1b2b3b4b5b6b7b8ULL, j);\n\t\t\tfor (k = 0; k < 512; k++) {\n\t\t\t\tv = p[k];\n\t\t\t\tif (k < i) {\n\t\t\t\t\tif (v != 0xa1a1a1a1a1a1a1a1ULL)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t} else if (k < i + j) {\n\t\t\t\t\tif (v != 0xb1b2b3b4b5b6b7b8ULL)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t} else {\n\t\t\t\t\tif (v != 0xa1a1a1a1a1a1a1a1ULL)\n\t\t\t\t\t\tgoto fail;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\nfail:\n\tkfree(p);\n\tif (i < 256)\n\t\treturn (i << 24) | (j << 16) | k | 0x8000;\n\treturn 0;\n}\n\nstatic __init int strchr_selftest(void)\n{\n\tconst char *test_string = \"abcdefghijkl\";\n\tconst char *empty_string = \"\";\n\tchar *result;\n\tint i;\n\n\tfor (i = 0; i < strlen(test_string) + 1; i++) {\n\t\tresult = strchr(test_string, test_string[i]);\n\t\tif (result - test_string != i)\n\t\t\treturn i + 'a';\n\t}\n\n\tresult = strchr(empty_string, '\\0');\n\tif (result != empty_string)\n\t\treturn 0x101;\n\n\tresult = strchr(empty_string, 'a');\n\tif (result)\n\t\treturn 0x102;\n\n\tresult = strchr(test_string, 'z');\n\tif (result)\n\t\treturn 0x103;\n\n\treturn 0;\n}\n\nstatic __init int strnchr_selftest(void)\n{\n\tconst char *test_string = \"abcdefghijkl\";\n\tconst char *empty_string = \"\";\n\tchar *result;\n\tint i, j;\n\n\tfor (i = 0; i < strlen(test_string) + 1; i++) {\n\t\tfor (j = 0; j < strlen(test_string) + 2; j++) {\n\t\t\tresult = strnchr(test_string, j, test_string[i]);\n\t\t\tif (j <= i) {\n\t\t\t\tif (!result)\n\t\t\t\t\tcontinue;\n\t\t\t\treturn ((i + 'a') << 8) | j;\n\t\t\t}\n\t\t\tif (result - test_string != i)\n\t\t\t\treturn ((i + 'a') << 8) | j;\n\t\t}\n\t}\n\n\tresult = strnchr(empty_string, 0, '\\0');\n\tif (result)\n\t\treturn 0x10001;\n\n\tresult = strnchr(empty_string, 1, '\\0');\n\tif (result != empty_string)\n\t\treturn 0x10002;\n\n\tresult = strnchr(empty_string, 1, 'a');\n\tif (result)\n\t\treturn 0x10003;\n\n\tresult = strnchr(NULL, 0, '\\0');\n\tif (result)\n\t\treturn 0x10004;\n\n\treturn 0;\n}\n\nstatic __init int strspn_selftest(void)\n{\n\tstatic const struct strspn_test {\n\t\tconst char str[16];\n\t\tconst char accept[16];\n\t\tconst char reject[16];\n\t\tunsigned a;\n\t\tunsigned r;\n\t} tests[] __initconst = {\n\t\t{ \"foobar\", \"\", \"\", 0, 6 },\n\t\t{ \"abba\", \"abc\", \"ABBA\", 4, 4 },\n\t\t{ \"abba\", \"a\", \"b\", 1, 1 },\n\t\t{ \"\", \"abc\", \"abc\", 0, 0},\n\t};\n\tconst struct strspn_test *s = tests;\n\tsize_t i, res;\n\n\tfor (i = 0; i < ARRAY_SIZE(tests); ++i, ++s) {\n\t\tres = strspn(s->str, s->accept);\n\t\tif (res != s->a)\n\t\t\treturn 0x100 + 2*i;\n\t\tres = strcspn(s->str, s->reject);\n\t\tif (res != s->r)\n\t\t\treturn 0x100 + 2*i + 1;\n\t}\n\treturn 0;\n}\n\nstatic __exit void string_selftest_remove(void)\n{\n}\n\nstatic __init int string_selftest_init(void)\n{\n\tint test, subtest;\n\n\ttest = 1;\n\tsubtest = memset16_selftest();\n\tif (subtest)\n\t\tgoto fail;\n\n\ttest = 2;\n\tsubtest = memset32_selftest();\n\tif (subtest)\n\t\tgoto fail;\n\n\ttest = 3;\n\tsubtest = memset64_selftest();\n\tif (subtest)\n\t\tgoto fail;\n\n\ttest = 4;\n\tsubtest = strchr_selftest();\n\tif (subtest)\n\t\tgoto fail;\n\n\ttest = 5;\n\tsubtest = strnchr_selftest();\n\tif (subtest)\n\t\tgoto fail;\n\n\ttest = 6;\n\tsubtest = strspn_selftest();\n\tif (subtest)\n\t\tgoto fail;\n\n\tpr_info(\"String selftests succeeded\\n\");\n\treturn 0;\nfail:\n\tpr_crit(\"String selftest failure %d.%08x\\n\", test, subtest);\n\treturn 0;\n}\n\nmodule_init(string_selftest_init);\nmodule_exit(string_selftest_remove);\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}