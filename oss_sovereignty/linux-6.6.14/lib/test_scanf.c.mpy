{
  "module_name": "test_scanf.c",
  "hash_id": "5b914cd9b7782bf7594615272ef267b93ea46eb5e0905e3bb4f55d1c0f227824",
  "original_prompt": "Ingested from linux-6.6.14/lib/test_scanf.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/bitops.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/overflow.h>\n#include <linux/printk.h>\n#include <linux/random.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n\n#include \"../tools/testing/selftests/kselftest_module.h\"\n\n#define BUF_SIZE 1024\n\nKSTM_MODULE_GLOBALS();\nstatic char *test_buffer __initdata;\nstatic char *fmt_buffer __initdata;\nstatic struct rnd_state rnd_state __initdata;\n\ntypedef int (*check_fn)(const void *check_data, const char *string,\n\t\t\tconst char *fmt, int n_args, va_list ap);\n\nstatic void __scanf(4, 6) __init\n_test(check_fn fn, const void *check_data, const char *string, const char *fmt,\n\tint n_args, ...)\n{\n\tva_list ap, ap_copy;\n\tint ret;\n\n\ttotal_tests++;\n\n\tva_start(ap, n_args);\n\tva_copy(ap_copy, ap);\n\tret = vsscanf(string, fmt, ap_copy);\n\tva_end(ap_copy);\n\n\tif (ret != n_args) {\n\t\tpr_warn(\"vsscanf(\\\"%s\\\", \\\"%s\\\", ...) returned %d expected %d\\n\",\n\t\t\tstring, fmt, ret, n_args);\n\t\tgoto fail;\n\t}\n\n\tret = (*fn)(check_data, string, fmt, n_args, ap);\n\tif (ret)\n\t\tgoto fail;\n\n\tva_end(ap);\n\n\treturn;\n\nfail:\n\tfailed_tests++;\n\tva_end(ap);\n}\n\n#define _check_numbers_template(arg_fmt, expect, str, fmt, n_args, ap)\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tpr_debug(\"\\\"%s\\\", \\\"%s\\\" ->\\n\", str, fmt);\t\t\t\t\\\n\tfor (; n_args > 0; n_args--, expect++) {\t\t\t\t\\\n\t\ttypeof(*expect) got = *va_arg(ap, typeof(expect));\t\t\\\n\t\tpr_debug(\"\\t\" arg_fmt \"\\n\", got);\t\t\t\t\\\n\t\tif (got != *expect) {\t\t\t\t\t\t\\\n\t\t\tpr_warn(\"vsscanf(\\\"%s\\\", \\\"%s\\\", ...) expected \" arg_fmt \" got \" arg_fmt \"\\n\", \\\n\t\t\t\tstr, fmt, *expect, got);\t\t\t\\\n\t\t\treturn 1;\t\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\treturn 0;\t\t\t\t\t\t\t\t\\\n} while (0)\n\nstatic int __init check_ull(const void *check_data, const char *string,\n\t\t\t    const char *fmt, int n_args, va_list ap)\n{\n\tconst unsigned long long *pval = check_data;\n\n\t_check_numbers_template(\"%llu\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_ll(const void *check_data, const char *string,\n\t\t\t   const char *fmt, int n_args, va_list ap)\n{\n\tconst long long *pval = check_data;\n\n\t_check_numbers_template(\"%lld\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_ulong(const void *check_data, const char *string,\n\t\t\t   const char *fmt, int n_args, va_list ap)\n{\n\tconst unsigned long *pval = check_data;\n\n\t_check_numbers_template(\"%lu\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_long(const void *check_data, const char *string,\n\t\t\t  const char *fmt, int n_args, va_list ap)\n{\n\tconst long *pval = check_data;\n\n\t_check_numbers_template(\"%ld\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_uint(const void *check_data, const char *string,\n\t\t\t     const char *fmt, int n_args, va_list ap)\n{\n\tconst unsigned int *pval = check_data;\n\n\t_check_numbers_template(\"%u\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_int(const void *check_data, const char *string,\n\t\t\t    const char *fmt, int n_args, va_list ap)\n{\n\tconst int *pval = check_data;\n\n\t_check_numbers_template(\"%d\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_ushort(const void *check_data, const char *string,\n\t\t\t       const char *fmt, int n_args, va_list ap)\n{\n\tconst unsigned short *pval = check_data;\n\n\t_check_numbers_template(\"%hu\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_short(const void *check_data, const char *string,\n\t\t\t       const char *fmt, int n_args, va_list ap)\n{\n\tconst short *pval = check_data;\n\n\t_check_numbers_template(\"%hd\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_uchar(const void *check_data, const char *string,\n\t\t\t       const char *fmt, int n_args, va_list ap)\n{\n\tconst unsigned char *pval = check_data;\n\n\t_check_numbers_template(\"%hhu\", pval, string, fmt, n_args, ap);\n}\n\nstatic int __init check_char(const void *check_data, const char *string,\n\t\t\t       const char *fmt, int n_args, va_list ap)\n{\n\tconst signed char *pval = check_data;\n\n\t_check_numbers_template(\"%hhd\", pval, string, fmt, n_args, ap);\n}\n\n \nstatic const unsigned long long numbers[] __initconst = {\n\t0x0ULL,\n\t0x1ULL,\n\t0x7fULL,\n\t0x80ULL,\n\t0x81ULL,\n\t0xffULL,\n\t0x100ULL,\n\t0x101ULL,\n\t0x7fffULL,\n\t0x8000ULL,\n\t0x8001ULL,\n\t0xffffULL,\n\t0x10000ULL,\n\t0x10001ULL,\n\t0x7fffffffULL,\n\t0x80000000ULL,\n\t0x80000001ULL,\n\t0xffffffffULL,\n\t0x100000000ULL,\n\t0x100000001ULL,\n\t0x7fffffffffffffffULL,\n\t0x8000000000000000ULL,\n\t0x8000000000000001ULL,\n\t0xfffffffffffffffeULL,\n\t0xffffffffffffffffULL,\n};\n\n#define value_representable_in_type(T, val)\t\t\t\t\t \\\n(is_signed_type(T)\t\t\t\t\t\t\t\t \\\n\t? ((long long)(val) >= type_min(T)) && ((long long)(val) <= type_max(T)) \\\n\t: ((unsigned long long)(val) <= type_max(T)))\n\n\n#define test_one_number(T, gen_fmt, scan_fmt, val, fn)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tconst T expect_val = (T)(val);\t\t\t\t\t\\\n\tT result = ~expect_val;  \t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tsnprintf(test_buffer, BUF_SIZE, gen_fmt, expect_val);\t\t\\\n\t_test(fn, &expect_val, test_buffer, \"%\" scan_fmt, 1, &result);\t\\\n} while (0)\n\n#define simple_numbers_loop(T, gen_fmt, scan_fmt, fn)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tint i;\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tfor (i = 0; i < ARRAY_SIZE(numbers); i++) {\t\t\t\\\n\t\tif (value_representable_in_type(T, numbers[i]))\t\t\\\n\t\t\ttest_one_number(T, gen_fmt, scan_fmt,\t\t\\\n\t\t\t\t\tnumbers[i], fn);\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tif (value_representable_in_type(T, -numbers[i]))\t\\\n\t\t\ttest_one_number(T, gen_fmt, scan_fmt,\t\t\\\n\t\t\t\t\t-numbers[i], fn);\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\nstatic void __init numbers_simple(void)\n{\n\tsimple_numbers_loop(unsigned long long,\t\"%llu\",\t  \"llu\", check_ull);\n\tsimple_numbers_loop(long long,\t\t\"%lld\",\t  \"lld\", check_ll);\n\tsimple_numbers_loop(long long,\t\t\"%lld\",\t  \"lli\", check_ll);\n\tsimple_numbers_loop(unsigned long long,\t\"%llx\",\t  \"llx\", check_ull);\n\tsimple_numbers_loop(long long,\t\t\"%llx\",\t  \"llx\", check_ll);\n\tsimple_numbers_loop(long long,\t\t\"0x%llx\", \"lli\", check_ll);\n\tsimple_numbers_loop(unsigned long long, \"0x%llx\", \"llx\", check_ull);\n\tsimple_numbers_loop(long long,\t\t\"0x%llx\", \"llx\", check_ll);\n\n\tsimple_numbers_loop(unsigned long,\t\"%lu\",\t  \"lu\", check_ulong);\n\tsimple_numbers_loop(long,\t\t\"%ld\",\t  \"ld\", check_long);\n\tsimple_numbers_loop(long,\t\t\"%ld\",\t  \"li\", check_long);\n\tsimple_numbers_loop(unsigned long,\t\"%lx\",\t  \"lx\", check_ulong);\n\tsimple_numbers_loop(long,\t\t\"%lx\",\t  \"lx\", check_long);\n\tsimple_numbers_loop(long,\t\t\"0x%lx\",  \"li\", check_long);\n\tsimple_numbers_loop(unsigned long,\t\"0x%lx\",  \"lx\", check_ulong);\n\tsimple_numbers_loop(long,\t\t\"0x%lx\",  \"lx\", check_long);\n\n\tsimple_numbers_loop(unsigned int,\t\"%u\",\t  \"u\", check_uint);\n\tsimple_numbers_loop(int,\t\t\"%d\",\t  \"d\", check_int);\n\tsimple_numbers_loop(int,\t\t\"%d\",\t  \"i\", check_int);\n\tsimple_numbers_loop(unsigned int,\t\"%x\",\t  \"x\", check_uint);\n\tsimple_numbers_loop(int,\t\t\"%x\",\t  \"x\", check_int);\n\tsimple_numbers_loop(int,\t\t\"0x%x\",   \"i\", check_int);\n\tsimple_numbers_loop(unsigned int,\t\"0x%x\",   \"x\", check_uint);\n\tsimple_numbers_loop(int,\t\t\"0x%x\",   \"x\", check_int);\n\n\tsimple_numbers_loop(unsigned short,\t\"%hu\",\t  \"hu\", check_ushort);\n\tsimple_numbers_loop(short,\t\t\"%hd\",\t  \"hd\", check_short);\n\tsimple_numbers_loop(short,\t\t\"%hd\",\t  \"hi\", check_short);\n\tsimple_numbers_loop(unsigned short,\t\"%hx\",\t  \"hx\", check_ushort);\n\tsimple_numbers_loop(short,\t\t\"%hx\",\t  \"hx\", check_short);\n\tsimple_numbers_loop(short,\t\t\"0x%hx\",  \"hi\", check_short);\n\tsimple_numbers_loop(unsigned short,\t\"0x%hx\",  \"hx\", check_ushort);\n\tsimple_numbers_loop(short,\t\t\"0x%hx\",  \"hx\", check_short);\n\n\tsimple_numbers_loop(unsigned char,\t\"%hhu\",\t  \"hhu\", check_uchar);\n\tsimple_numbers_loop(signed char,\t\"%hhd\",\t  \"hhd\", check_char);\n\tsimple_numbers_loop(signed char,\t\"%hhd\",\t  \"hhi\", check_char);\n\tsimple_numbers_loop(unsigned char,\t\"%hhx\",\t  \"hhx\", check_uchar);\n\tsimple_numbers_loop(signed char,\t\"%hhx\",\t  \"hhx\", check_char);\n\tsimple_numbers_loop(signed char,\t\"0x%hhx\", \"hhi\", check_char);\n\tsimple_numbers_loop(unsigned char,\t\"0x%hhx\", \"hhx\", check_uchar);\n\tsimple_numbers_loop(signed char,\t\"0x%hhx\", \"hhx\", check_char);\n}\n\n \nstatic u32 __init next_test_random(u32 max_bits)\n{\n\tu32 n_bits = hweight32(prandom_u32_state(&rnd_state)) % (max_bits + 1);\n\n\treturn prandom_u32_state(&rnd_state) & GENMASK(n_bits, 0);\n}\n\nstatic unsigned long long __init next_test_random_ull(void)\n{\n\tu32 rand1 = prandom_u32_state(&rnd_state);\n\tu32 n_bits = (hweight32(rand1) * 3) % 64;\n\tu64 val = (u64)prandom_u32_state(&rnd_state) * rand1;\n\n\treturn val & GENMASK_ULL(n_bits, 0);\n}\n\n#define random_for_type(T)\t\t\t\t\\\n\t((T)(sizeof(T) <= sizeof(u32)\t\t\t\\\n\t\t? next_test_random(BITS_PER_TYPE(T))\t\\\n\t\t: next_test_random_ull()))\n\n \n#define NEGATIVES_PATTERN 0x3246\t \n\n#define fill_random_array(arr)\t\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tunsigned int neg_pattern = NEGATIVES_PATTERN;\t\t\t\t\\\n\tint i;\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tfor (i = 0; i < ARRAY_SIZE(arr); i++, neg_pattern >>= 1) {\t\t\\\n\t\t(arr)[i] = random_for_type(typeof((arr)[0]));\t\t\t\\\n\t\tif (is_signed_type(typeof((arr)[0])) && (neg_pattern & 1))\t\\\n\t\t\t(arr)[i] = -(arr)[i];\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n} while (0)\n\n \nstatic int __init __printf(4, 5)\nappend_fmt(char *buf, int *buf_pos, int buf_len, const char *val_fmt, ...)\n{\n\tva_list ap;\n\tint field_len;\n\n\tva_start(ap, val_fmt);\n\tfield_len = vsnprintf(buf + *buf_pos, buf_len - *buf_pos, val_fmt, ap);\n\tva_end(ap);\n\n\tif (field_len < 0)\n\t\tfield_len = 0;\n\n\t*buf_pos += field_len;\n\n\treturn field_len;\n}\n\n \nstatic void __init append_delim(char *str_buf, int *str_buf_pos, int str_buf_len,\n\t\t\t\tchar *fmt_buf, int *fmt_buf_pos, int fmt_buf_len,\n\t\t\t\tconst char *delim_str)\n{\n\tappend_fmt(str_buf, str_buf_pos, str_buf_len, delim_str);\n\tappend_fmt(fmt_buf, fmt_buf_pos, fmt_buf_len, delim_str);\n}\n\n#define test_array_8(fn, check_data, string, fmt, arr)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tBUILD_BUG_ON(ARRAY_SIZE(arr) != 8);\t\t\t\t\t\\\n\t_test(fn, check_data, string, fmt, 8,\t\t\t\t\t\\\n\t\t&(arr)[0], &(arr)[1], &(arr)[2], &(arr)[3],\t\t\t\\\n\t\t&(arr)[4], &(arr)[5], &(arr)[6], &(arr)[7]);\t\t\t\\\n} while (0)\n\n#define numbers_list_8(T, gen_fmt, field_sep, scan_fmt, fn)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tint i, pos = 0, fmt_pos = 0;\t\t\t\t\t\t\\\n\tT expect[8], result[8];\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tfill_random_array(expect);\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tfor (i = 0; i < ARRAY_SIZE(expect); i++) {\t\t\t\t\\\n\t\tif (i != 0)\t\t\t\t\t\t\t\\\n\t\t\tappend_delim(test_buffer, &pos, BUF_SIZE,\t\t\\\n\t\t\t\t     fmt_buffer, &fmt_pos, BUF_SIZE,\t\t\\\n\t\t\t\t     field_sep);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\t\tappend_fmt(test_buffer, &pos, BUF_SIZE, gen_fmt, expect[i]);\t\\\n\t\tappend_fmt(fmt_buffer, &fmt_pos, BUF_SIZE, \"%%%s\", scan_fmt);\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\ttest_array_8(fn, expect, test_buffer, fmt_buffer, result);\t\t\\\n} while (0)\n\n#define numbers_list_fix_width(T, gen_fmt, field_sep, width, scan_fmt, fn)\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tchar full_fmt[16];\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tsnprintf(full_fmt, sizeof(full_fmt), \"%u%s\", width, scan_fmt);\t\t\\\n\tnumbers_list_8(T, gen_fmt, field_sep, full_fmt, fn);\t\t\t\\\n} while (0)\n\n#define numbers_list_val_width(T, gen_fmt, field_sep, scan_fmt, fn)\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tint i, val_len, pos = 0, fmt_pos = 0;\t\t\t\t\t\\\n\tT expect[8], result[8];\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tfill_random_array(expect);\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tfor (i = 0; i < ARRAY_SIZE(expect); i++) {\t\t\t\t\\\n\t\tif (i != 0)\t\t\t\t\t\t\t\\\n\t\t\tappend_delim(test_buffer, &pos, BUF_SIZE,\t\t\\\n\t\t\t\t     fmt_buffer, &fmt_pos, BUF_SIZE, field_sep);\\\n\t\t\t\t\t\t\t\t\t\t\\\n\t\tval_len = append_fmt(test_buffer, &pos, BUF_SIZE, gen_fmt,\t\\\n\t\t\t\t     expect[i]);\t\t\t\t\\\n\t\tappend_fmt(fmt_buffer, &fmt_pos, BUF_SIZE,\t\t\t\\\n\t\t\t   \"%%%u%s\", val_len, scan_fmt);\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\ttest_array_8(fn, expect, test_buffer, fmt_buffer, result);\t\t\\\n} while (0)\n\nstatic void __init numbers_list_ll(const char *delim)\n{\n\tnumbers_list_8(unsigned long long, \"%llu\",   delim, \"llu\", check_ull);\n\tnumbers_list_8(long long,\t   \"%lld\",   delim, \"lld\", check_ll);\n\tnumbers_list_8(long long,\t   \"%lld\",   delim, \"lli\", check_ll);\n\tnumbers_list_8(unsigned long long, \"%llx\",   delim, \"llx\", check_ull);\n\tnumbers_list_8(unsigned long long, \"0x%llx\", delim, \"llx\", check_ull);\n\tnumbers_list_8(long long,\t   \"0x%llx\", delim, \"lli\", check_ll);\n}\n\nstatic void __init numbers_list_l(const char *delim)\n{\n\tnumbers_list_8(unsigned long,\t   \"%lu\",    delim, \"lu\", check_ulong);\n\tnumbers_list_8(long,\t\t   \"%ld\",    delim, \"ld\", check_long);\n\tnumbers_list_8(long,\t\t   \"%ld\",    delim, \"li\", check_long);\n\tnumbers_list_8(unsigned long,\t   \"%lx\",    delim, \"lx\", check_ulong);\n\tnumbers_list_8(unsigned long,\t   \"0x%lx\",  delim, \"lx\", check_ulong);\n\tnumbers_list_8(long,\t\t   \"0x%lx\",  delim, \"li\", check_long);\n}\n\nstatic void __init numbers_list_d(const char *delim)\n{\n\tnumbers_list_8(unsigned int,\t   \"%u\",     delim, \"u\", check_uint);\n\tnumbers_list_8(int,\t\t   \"%d\",     delim, \"d\", check_int);\n\tnumbers_list_8(int,\t\t   \"%d\",     delim, \"i\", check_int);\n\tnumbers_list_8(unsigned int,\t   \"%x\",     delim, \"x\", check_uint);\n\tnumbers_list_8(unsigned int,\t   \"0x%x\",   delim, \"x\", check_uint);\n\tnumbers_list_8(int,\t\t   \"0x%x\",   delim, \"i\", check_int);\n}\n\nstatic void __init numbers_list_h(const char *delim)\n{\n\tnumbers_list_8(unsigned short,\t   \"%hu\",    delim, \"hu\", check_ushort);\n\tnumbers_list_8(short,\t\t   \"%hd\",    delim, \"hd\", check_short);\n\tnumbers_list_8(short,\t\t   \"%hd\",    delim, \"hi\", check_short);\n\tnumbers_list_8(unsigned short,\t   \"%hx\",    delim, \"hx\", check_ushort);\n\tnumbers_list_8(unsigned short,\t   \"0x%hx\",  delim, \"hx\", check_ushort);\n\tnumbers_list_8(short,\t\t   \"0x%hx\",  delim, \"hi\", check_short);\n}\n\nstatic void __init numbers_list_hh(const char *delim)\n{\n\tnumbers_list_8(unsigned char,\t   \"%hhu\",   delim, \"hhu\", check_uchar);\n\tnumbers_list_8(signed char,\t   \"%hhd\",   delim, \"hhd\", check_char);\n\tnumbers_list_8(signed char,\t   \"%hhd\",   delim, \"hhi\", check_char);\n\tnumbers_list_8(unsigned char,\t   \"%hhx\",   delim, \"hhx\", check_uchar);\n\tnumbers_list_8(unsigned char,\t   \"0x%hhx\", delim, \"hhx\", check_uchar);\n\tnumbers_list_8(signed char,\t   \"0x%hhx\", delim, \"hhi\", check_char);\n}\n\nstatic void __init numbers_list(const char *delim)\n{\n\tnumbers_list_ll(delim);\n\tnumbers_list_l(delim);\n\tnumbers_list_d(delim);\n\tnumbers_list_h(delim);\n\tnumbers_list_hh(delim);\n}\n\nstatic void __init numbers_list_field_width_ll(const char *delim)\n{\n\tnumbers_list_fix_width(unsigned long long, \"%llu\",   delim, 20, \"llu\", check_ull);\n\tnumbers_list_fix_width(long long,\t   \"%lld\",   delim, 20, \"lld\", check_ll);\n\tnumbers_list_fix_width(long long,\t   \"%lld\",   delim, 20, \"lli\", check_ll);\n\tnumbers_list_fix_width(unsigned long long, \"%llx\",   delim, 16, \"llx\", check_ull);\n\tnumbers_list_fix_width(unsigned long long, \"0x%llx\", delim, 18, \"llx\", check_ull);\n\tnumbers_list_fix_width(long long,\t   \"0x%llx\", delim, 18, \"lli\", check_ll);\n}\n\nstatic void __init numbers_list_field_width_l(const char *delim)\n{\n#if BITS_PER_LONG == 64\n\tnumbers_list_fix_width(unsigned long,\t\"%lu\",\t     delim, 20, \"lu\", check_ulong);\n\tnumbers_list_fix_width(long,\t\t\"%ld\",\t     delim, 20, \"ld\", check_long);\n\tnumbers_list_fix_width(long,\t\t\"%ld\",\t     delim, 20, \"li\", check_long);\n\tnumbers_list_fix_width(unsigned long,\t\"%lx\",\t     delim, 16, \"lx\", check_ulong);\n\tnumbers_list_fix_width(unsigned long,\t\"0x%lx\",     delim, 18, \"lx\", check_ulong);\n\tnumbers_list_fix_width(long,\t\t\"0x%lx\",     delim, 18, \"li\", check_long);\n#else\n\tnumbers_list_fix_width(unsigned long,\t\"%lu\",\t     delim, 10, \"lu\", check_ulong);\n\tnumbers_list_fix_width(long,\t\t\"%ld\",\t     delim, 11, \"ld\", check_long);\n\tnumbers_list_fix_width(long,\t\t\"%ld\",\t     delim, 11, \"li\", check_long);\n\tnumbers_list_fix_width(unsigned long,\t\"%lx\",\t     delim, 8,  \"lx\", check_ulong);\n\tnumbers_list_fix_width(unsigned long,\t\"0x%lx\",     delim, 10, \"lx\", check_ulong);\n\tnumbers_list_fix_width(long,\t\t\"0x%lx\",     delim, 10, \"li\", check_long);\n#endif\n}\n\nstatic void __init numbers_list_field_width_d(const char *delim)\n{\n\tnumbers_list_fix_width(unsigned int,\t\"%u\",\t     delim, 10, \"u\", check_uint);\n\tnumbers_list_fix_width(int,\t\t\"%d\",\t     delim, 11, \"d\", check_int);\n\tnumbers_list_fix_width(int,\t\t\"%d\",\t     delim, 11, \"i\", check_int);\n\tnumbers_list_fix_width(unsigned int,\t\"%x\",\t     delim, 8,  \"x\", check_uint);\n\tnumbers_list_fix_width(unsigned int,\t\"0x%x\",\t     delim, 10, \"x\", check_uint);\n\tnumbers_list_fix_width(int,\t\t\"0x%x\",\t     delim, 10, \"i\", check_int);\n}\n\nstatic void __init numbers_list_field_width_h(const char *delim)\n{\n\tnumbers_list_fix_width(unsigned short,\t\"%hu\",\t     delim, 5, \"hu\", check_ushort);\n\tnumbers_list_fix_width(short,\t\t\"%hd\",\t     delim, 6, \"hd\", check_short);\n\tnumbers_list_fix_width(short,\t\t\"%hd\",\t     delim, 6, \"hi\", check_short);\n\tnumbers_list_fix_width(unsigned short,\t\"%hx\",\t     delim, 4, \"hx\", check_ushort);\n\tnumbers_list_fix_width(unsigned short,\t\"0x%hx\",     delim, 6, \"hx\", check_ushort);\n\tnumbers_list_fix_width(short,\t\t\"0x%hx\",     delim, 6, \"hi\", check_short);\n}\n\nstatic void __init numbers_list_field_width_hh(const char *delim)\n{\n\tnumbers_list_fix_width(unsigned char,\t\"%hhu\",\t     delim, 3, \"hhu\", check_uchar);\n\tnumbers_list_fix_width(signed char,\t\"%hhd\",\t     delim, 4, \"hhd\", check_char);\n\tnumbers_list_fix_width(signed char,\t\"%hhd\",\t     delim, 4, \"hhi\", check_char);\n\tnumbers_list_fix_width(unsigned char,\t\"%hhx\",\t     delim, 2, \"hhx\", check_uchar);\n\tnumbers_list_fix_width(unsigned char,\t\"0x%hhx\",    delim, 4, \"hhx\", check_uchar);\n\tnumbers_list_fix_width(signed char,\t\"0x%hhx\",    delim, 4, \"hhi\", check_char);\n}\n\n \nstatic void __init numbers_list_field_width_typemax(const char *delim)\n{\n\tnumbers_list_field_width_ll(delim);\n\tnumbers_list_field_width_l(delim);\n\tnumbers_list_field_width_d(delim);\n\tnumbers_list_field_width_h(delim);\n\tnumbers_list_field_width_hh(delim);\n}\n\nstatic void __init numbers_list_field_width_val_ll(const char *delim)\n{\n\tnumbers_list_val_width(unsigned long long, \"%llu\",   delim, \"llu\", check_ull);\n\tnumbers_list_val_width(long long,\t   \"%lld\",   delim, \"lld\", check_ll);\n\tnumbers_list_val_width(long long,\t   \"%lld\",   delim, \"lli\", check_ll);\n\tnumbers_list_val_width(unsigned long long, \"%llx\",   delim, \"llx\", check_ull);\n\tnumbers_list_val_width(unsigned long long, \"0x%llx\", delim, \"llx\", check_ull);\n\tnumbers_list_val_width(long long,\t   \"0x%llx\", delim, \"lli\", check_ll);\n}\n\nstatic void __init numbers_list_field_width_val_l(const char *delim)\n{\n\tnumbers_list_val_width(unsigned long,\t\"%lu\",\t     delim, \"lu\", check_ulong);\n\tnumbers_list_val_width(long,\t\t\"%ld\",\t     delim, \"ld\", check_long);\n\tnumbers_list_val_width(long,\t\t\"%ld\",\t     delim, \"li\", check_long);\n\tnumbers_list_val_width(unsigned long,\t\"%lx\",\t     delim, \"lx\", check_ulong);\n\tnumbers_list_val_width(unsigned long,\t\"0x%lx\",     delim, \"lx\", check_ulong);\n\tnumbers_list_val_width(long,\t\t\"0x%lx\",     delim, \"li\", check_long);\n}\n\nstatic void __init numbers_list_field_width_val_d(const char *delim)\n{\n\tnumbers_list_val_width(unsigned int,\t\"%u\",\t     delim, \"u\", check_uint);\n\tnumbers_list_val_width(int,\t\t\"%d\",\t     delim, \"d\", check_int);\n\tnumbers_list_val_width(int,\t\t\"%d\",\t     delim, \"i\", check_int);\n\tnumbers_list_val_width(unsigned int,\t\"%x\",\t     delim, \"x\", check_uint);\n\tnumbers_list_val_width(unsigned int,\t\"0x%x\",\t     delim, \"x\", check_uint);\n\tnumbers_list_val_width(int,\t\t\"0x%x\",\t     delim, \"i\", check_int);\n}\n\nstatic void __init numbers_list_field_width_val_h(const char *delim)\n{\n\tnumbers_list_val_width(unsigned short,\t\"%hu\",\t     delim, \"hu\", check_ushort);\n\tnumbers_list_val_width(short,\t\t\"%hd\",\t     delim, \"hd\", check_short);\n\tnumbers_list_val_width(short,\t\t\"%hd\",\t     delim, \"hi\", check_short);\n\tnumbers_list_val_width(unsigned short,\t\"%hx\",\t     delim, \"hx\", check_ushort);\n\tnumbers_list_val_width(unsigned short,\t\"0x%hx\",     delim, \"hx\", check_ushort);\n\tnumbers_list_val_width(short,\t\t\"0x%hx\",     delim, \"hi\", check_short);\n}\n\nstatic void __init numbers_list_field_width_val_hh(const char *delim)\n{\n\tnumbers_list_val_width(unsigned char,\t\"%hhu\",\t     delim, \"hhu\", check_uchar);\n\tnumbers_list_val_width(signed char,\t\"%hhd\",\t     delim, \"hhd\", check_char);\n\tnumbers_list_val_width(signed char,\t\"%hhd\",\t     delim, \"hhi\", check_char);\n\tnumbers_list_val_width(unsigned char,\t\"%hhx\",\t     delim, \"hhx\", check_uchar);\n\tnumbers_list_val_width(unsigned char,\t\"0x%hhx\",    delim, \"hhx\", check_uchar);\n\tnumbers_list_val_width(signed char,\t\"0x%hhx\",    delim, \"hhi\", check_char);\n}\n\n \nstatic void __init numbers_list_field_width_val_width(const char *delim)\n{\n\tnumbers_list_field_width_val_ll(delim);\n\tnumbers_list_field_width_val_l(delim);\n\tnumbers_list_field_width_val_d(delim);\n\tnumbers_list_field_width_val_h(delim);\n\tnumbers_list_field_width_val_hh(delim);\n}\n\n \nstatic void __init numbers_slice(void)\n{\n\tnumbers_list_field_width_val_width(\"\");\n}\n\n#define test_number_prefix(T, str, scan_fmt, expect0, expect1, n_args, fn)\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tconst T expect[2] = { expect0, expect1 };\t\t\t\t\\\n\tT result[2] = { (T)~expect[0], (T)~expect[1] };\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\t_test(fn, &expect, str, scan_fmt, n_args, &result[0], &result[1]);\t\\\n} while (0)\n\n \nstatic void __init numbers_prefix_overflow(void)\n{\n\t \n\ttest_number_prefix(long long,\t\"-1 1\", \"%1lld %lld\",\t0, 0, 0, check_ll);\n\ttest_number_prefix(long,\t\"-1 1\", \"%1ld %ld\",\t0, 0, 0, check_long);\n\ttest_number_prefix(int,\t\t\"-1 1\", \"%1d %d\",\t0, 0, 0, check_int);\n\ttest_number_prefix(short,\t\"-1 1\", \"%1hd %hd\",\t0, 0, 0, check_short);\n\ttest_number_prefix(signed char,\t\"-1 1\", \"%1hhd %hhd\",\t0, 0, 0, check_char);\n\n\ttest_number_prefix(long long,\t\"-1 1\", \"%1lli %lli\",\t0, 0, 0, check_ll);\n\ttest_number_prefix(long,\t\"-1 1\", \"%1li %li\",\t0, 0, 0, check_long);\n\ttest_number_prefix(int,\t\t\"-1 1\", \"%1i %i\",\t0, 0, 0, check_int);\n\ttest_number_prefix(short,\t\"-1 1\", \"%1hi %hi\",\t0, 0, 0, check_short);\n\ttest_number_prefix(signed char,\t\"-1 1\", \"%1hhi %hhi\",\t0, 0, 0, check_char);\n\n\t \n\ttest_number_prefix(unsigned long long,\t\"0xA7\", \"%1llx%llx\", 0, 0, 1, check_ull);\n\ttest_number_prefix(unsigned long,\t\"0xA7\", \"%1lx%lx\",   0, 0, 1, check_ulong);\n\ttest_number_prefix(unsigned int,\t\"0xA7\", \"%1x%x\",     0, 0, 1, check_uint);\n\ttest_number_prefix(unsigned short,\t\"0xA7\", \"%1hx%hx\",   0, 0, 1, check_ushort);\n\ttest_number_prefix(unsigned char,\t\"0xA7\", \"%1hhx%hhx\", 0, 0, 1, check_uchar);\n\ttest_number_prefix(long long,\t\t\"0xA7\", \"%1lli%llx\", 0, 0, 1, check_ll);\n\ttest_number_prefix(long,\t\t\"0xA7\", \"%1li%lx\",   0, 0, 1, check_long);\n\ttest_number_prefix(int,\t\t\t\"0xA7\", \"%1i%x\",     0, 0, 1, check_int);\n\ttest_number_prefix(short,\t\t\"0xA7\", \"%1hi%hx\",   0, 0, 1, check_short);\n\ttest_number_prefix(char,\t\t\"0xA7\", \"%1hhi%hhx\", 0, 0, 1, check_char);\n\n\t \n\ttest_number_prefix(unsigned long long,\t\"0xA7\", \"%2llx%llx\", 0, 0xa7, 2, check_ull);\n\ttest_number_prefix(unsigned long,\t\"0xA7\", \"%2lx%lx\",   0, 0xa7, 2, check_ulong);\n\ttest_number_prefix(unsigned int,\t\"0xA7\", \"%2x%x\",     0, 0xa7, 2, check_uint);\n\ttest_number_prefix(unsigned short,\t\"0xA7\", \"%2hx%hx\",   0, 0xa7, 2, check_ushort);\n\ttest_number_prefix(unsigned char,\t\"0xA7\", \"%2hhx%hhx\", 0, 0xa7, 2, check_uchar);\n\n\t \n\ttest_number_prefix(long long,\t\"0x67\", \"%2lli%lli\", 0, 67, 2, check_ll);\n\ttest_number_prefix(long,\t\"0x67\", \"%2li%li\",   0, 67, 2, check_long);\n\ttest_number_prefix(int,\t\t\"0x67\", \"%2i%i\",     0, 67, 2, check_int);\n\ttest_number_prefix(short,\t\"0x67\", \"%2hi%hi\",   0, 67, 2, check_short);\n\ttest_number_prefix(char,\t\"0x67\", \"%2hhi%hhi\", 0, 67, 2, check_char);\n\n\ttest_number_prefix(long long,\t\"0xA7\", \"%2lli%lli\", 0, 0,  1, check_ll);\n\ttest_number_prefix(long,\t\"0xA7\", \"%2li%li\",   0, 0,  1, check_long);\n\ttest_number_prefix(int,\t\t\"0xA7\", \"%2i%i\",     0, 0,  1, check_int);\n\ttest_number_prefix(short,\t\"0xA7\", \"%2hi%hi\",   0, 0,  1, check_short);\n\ttest_number_prefix(char,\t\"0xA7\", \"%2hhi%hhi\", 0, 0,  1, check_char);\n}\n\n#define _test_simple_strtoxx(T, fn, gen_fmt, expect, base)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tT got;\t\t\t\t\t\t\t\t\t\\\n\tchar *endp;\t\t\t\t\t\t\t\t\\\n\tint len;\t\t\t\t\t\t\t\t\\\n\tbool fail = false;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\ttotal_tests++;\t\t\t\t\t\t\t\t\\\n\tlen = snprintf(test_buffer, BUF_SIZE, gen_fmt, expect);\t\t\t\\\n\tgot = (fn)(test_buffer, &endp, base);\t\t\t\t\t\\\n\tpr_debug(#fn \"(\\\"%s\\\", %d) -> \" gen_fmt \"\\n\", test_buffer, base, got);\t\\\n\tif (got != (expect)) {\t\t\t\t\t\t\t\\\n\t\tfail = true;\t\t\t\t\t\t\t\\\n\t\tpr_warn(#fn \"(\\\"%s\\\", %d): got \" gen_fmt \" expected \" gen_fmt \"\\n\", \\\n\t\t\ttest_buffer, base, got, expect);\t\t\t\\\n\t} else if (endp != test_buffer + len) {\t\t\t\t\t\\\n\t\tfail = true;\t\t\t\t\t\t\t\\\n\t\tpr_warn(#fn \"(\\\"%s\\\", %d) startp=0x%px got endp=0x%px expected 0x%px\\n\", \\\n\t\t\ttest_buffer, base, test_buffer,\t\t\t\t\\\n\t\t\ttest_buffer + len, endp);\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tif (fail)\t\t\t\t\t\t\t\t\\\n\t\tfailed_tests++;\t\t\t\t\t\t\t\\\n} while (0)\n\n#define test_simple_strtoxx(T, fn, gen_fmt, base)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\t\\\n\tint i;\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tfor (i = 0; i < ARRAY_SIZE(numbers); i++) {\t\t\t\t\\\n\t\t_test_simple_strtoxx(T, fn, gen_fmt, (T)numbers[i], base);\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\t\tif (is_signed_type(T))\t\t\t\t\t\t\\\n\t\t\t_test_simple_strtoxx(T, fn, gen_fmt,\t\t\t\\\n\t\t\t\t\t      -(T)numbers[i], base);\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n} while (0)\n\nstatic void __init test_simple_strtoull(void)\n{\n\ttest_simple_strtoxx(unsigned long long, simple_strtoull, \"%llu\",   10);\n\ttest_simple_strtoxx(unsigned long long, simple_strtoull, \"%llu\",   0);\n\ttest_simple_strtoxx(unsigned long long, simple_strtoull, \"%llx\",   16);\n\ttest_simple_strtoxx(unsigned long long, simple_strtoull, \"0x%llx\", 16);\n\ttest_simple_strtoxx(unsigned long long, simple_strtoull, \"0x%llx\", 0);\n}\n\nstatic void __init test_simple_strtoll(void)\n{\n\ttest_simple_strtoxx(long long, simple_strtoll, \"%lld\",\t 10);\n\ttest_simple_strtoxx(long long, simple_strtoll, \"%lld\",\t 0);\n\ttest_simple_strtoxx(long long, simple_strtoll, \"%llx\",\t 16);\n\ttest_simple_strtoxx(long long, simple_strtoll, \"0x%llx\", 16);\n\ttest_simple_strtoxx(long long, simple_strtoll, \"0x%llx\", 0);\n}\n\nstatic void __init test_simple_strtoul(void)\n{\n\ttest_simple_strtoxx(unsigned long, simple_strtoul, \"%lu\",   10);\n\ttest_simple_strtoxx(unsigned long, simple_strtoul, \"%lu\",   0);\n\ttest_simple_strtoxx(unsigned long, simple_strtoul, \"%lx\",   16);\n\ttest_simple_strtoxx(unsigned long, simple_strtoul, \"0x%lx\", 16);\n\ttest_simple_strtoxx(unsigned long, simple_strtoul, \"0x%lx\", 0);\n}\n\nstatic void __init test_simple_strtol(void)\n{\n\ttest_simple_strtoxx(long, simple_strtol, \"%ld\",   10);\n\ttest_simple_strtoxx(long, simple_strtol, \"%ld\",   0);\n\ttest_simple_strtoxx(long, simple_strtol, \"%lx\",   16);\n\ttest_simple_strtoxx(long, simple_strtol, \"0x%lx\", 16);\n\ttest_simple_strtoxx(long, simple_strtol, \"0x%lx\", 0);\n}\n\n \nstatic const char * const number_delimiters[] __initconst = {\n\t\" \", \":\", \",\", \"-\", \"/\",\n};\n\nstatic void __init test_numbers(void)\n{\n\tint i;\n\n\t \n\tnumbers_simple();\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(number_delimiters); i++) {\n\t\tnumbers_list(number_delimiters[i]);\n\n\t\t \n\t\tnumbers_list_field_width_typemax(number_delimiters[i]);\n\n\t\t \n\t\tnumbers_list_field_width_val_width(number_delimiters[i]);\n\t}\n\n\t \n\tnumbers_slice();\n\n\tnumbers_prefix_overflow();\n}\n\nstatic void __init selftest(void)\n{\n\ttest_buffer = kmalloc(BUF_SIZE, GFP_KERNEL);\n\tif (!test_buffer)\n\t\treturn;\n\n\tfmt_buffer = kmalloc(BUF_SIZE, GFP_KERNEL);\n\tif (!fmt_buffer) {\n\t\tkfree(test_buffer);\n\t\treturn;\n\t}\n\n\tprandom_seed_state(&rnd_state, 3141592653589793238ULL);\n\n\ttest_numbers();\n\n\ttest_simple_strtoull();\n\ttest_simple_strtoll();\n\ttest_simple_strtoul();\n\ttest_simple_strtol();\n\n\tkfree(fmt_buffer);\n\tkfree(test_buffer);\n}\n\nKSTM_MODULE_LOADERS(test_scanf);\nMODULE_AUTHOR(\"Richard Fitzgerald <rf@opensource.cirrus.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}