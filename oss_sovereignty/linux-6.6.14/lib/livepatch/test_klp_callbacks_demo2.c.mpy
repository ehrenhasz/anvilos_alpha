{
  "module_name": "test_klp_callbacks_demo2.c",
  "hash_id": "279282f6ff6a553e1c1dc5fcf3bbfafcaeb0c0f2d2a835cdf1477e41c3b2e22d",
  "original_prompt": "Ingested from linux-6.6.14/lib/livepatch/test_klp_callbacks_demo2.c",
  "human_readable_source": "\n\n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/livepatch.h>\n\nstatic int replace;\nmodule_param(replace, int, 0644);\nMODULE_PARM_DESC(replace, \"replace (default=0)\");\n\nstatic const char *const module_state[] = {\n\t[MODULE_STATE_LIVE]\t= \"[MODULE_STATE_LIVE] Normal state\",\n\t[MODULE_STATE_COMING]\t= \"[MODULE_STATE_COMING] Full formed, running module_init\",\n\t[MODULE_STATE_GOING]\t= \"[MODULE_STATE_GOING] Going away\",\n\t[MODULE_STATE_UNFORMED]\t= \"[MODULE_STATE_UNFORMED] Still setting it up\",\n};\n\nstatic void callback_info(const char *callback, struct klp_object *obj)\n{\n\tif (obj->mod)\n\t\tpr_info(\"%s: %s -> %s\\n\", callback, obj->mod->name,\n\t\t\tmodule_state[obj->mod->state]);\n\telse\n\t\tpr_info(\"%s: vmlinux\\n\", callback);\n}\n\n \nstatic int pre_patch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n\treturn 0;\n}\n\n \nstatic void post_patch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n}\n\n \nstatic void pre_unpatch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n}\n\n \nstatic void post_unpatch_callback(struct klp_object *obj)\n{\n\tcallback_info(__func__, obj);\n}\n\nstatic struct klp_func no_funcs[] = {\n\t{ }\n};\n\nstatic struct klp_object objs[] = {\n\t{\n\t\t.name = NULL,\t \n\t\t.funcs = no_funcs,\n\t\t.callbacks = {\n\t\t\t.pre_patch = pre_patch_callback,\n\t\t\t.post_patch = post_patch_callback,\n\t\t\t.pre_unpatch = pre_unpatch_callback,\n\t\t\t.post_unpatch = post_unpatch_callback,\n\t\t},\n\t}, { }\n};\n\nstatic struct klp_patch patch = {\n\t.mod = THIS_MODULE,\n\t.objs = objs,\n\t \n};\n\nstatic int test_klp_callbacks_demo2_init(void)\n{\n\tpatch.replace = replace;\n\treturn klp_enable_patch(&patch);\n}\n\nstatic void test_klp_callbacks_demo2_exit(void)\n{\n}\n\nmodule_init(test_klp_callbacks_demo2_init);\nmodule_exit(test_klp_callbacks_demo2_exit);\nMODULE_LICENSE(\"GPL\");\nMODULE_INFO(livepatch, \"Y\");\nMODULE_AUTHOR(\"Joe Lawrence <joe.lawrence@redhat.com>\");\nMODULE_DESCRIPTION(\"Livepatch test: livepatch demo2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}