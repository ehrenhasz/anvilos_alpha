{
  "module_name": "recov_avx2.c",
  "hash_id": "47e52e5e7640c3bcf47b421832d194e1f53f0a5fa34313fd4e3f3fc2e87054b7",
  "original_prompt": "Ingested from linux-6.6.14/lib/raid6/recov_avx2.c",
  "human_readable_source": "\n \n\n#include <linux/raid/pq.h>\n#include \"x86.h\"\n\nstatic int raid6_has_avx2(void)\n{\n\treturn boot_cpu_has(X86_FEATURE_AVX2) &&\n\t\tboot_cpu_has(X86_FEATURE_AVX);\n}\n\nstatic void raid6_2data_recov_avx2(int disks, size_t bytes, int faila,\n\t\tint failb, void **ptrs)\n{\n\tu8 *p, *q, *dp, *dq;\n\tconst u8 *pbmul;\t \n\tconst u8 *qmul;\t\t \n\tconst u8 x0f = 0x0f;\n\n\tp = (u8 *)ptrs[disks-2];\n\tq = (u8 *)ptrs[disks-1];\n\n\t \n\tdp = (u8 *)ptrs[faila];\n\tptrs[faila] = (void *)raid6_empty_zero_page;\n\tptrs[disks-2] = dp;\n\tdq = (u8 *)ptrs[failb];\n\tptrs[failb] = (void *)raid6_empty_zero_page;\n\tptrs[disks-1] = dq;\n\n\traid6_call.gen_syndrome(disks, bytes, ptrs);\n\n\t \n\tptrs[faila]   = dp;\n\tptrs[failb]   = dq;\n\tptrs[disks-2] = p;\n\tptrs[disks-1] = q;\n\n\t \n\tpbmul = raid6_vgfmul[raid6_gfexi[failb-faila]];\n\tqmul  = raid6_vgfmul[raid6_gfinv[raid6_gfexp[faila] ^\n\t\traid6_gfexp[failb]]];\n\n\tkernel_fpu_begin();\n\n\t \n\tasm volatile(\"vpbroadcastb %0, %%ymm7\" : : \"m\" (x0f));\n\n\twhile (bytes) {\n#ifdef CONFIG_X86_64\n\t\tasm volatile(\"vmovdqa %0, %%ymm1\" : : \"m\" (q[0]));\n\t\tasm volatile(\"vmovdqa %0, %%ymm9\" : : \"m\" (q[32]));\n\t\tasm volatile(\"vmovdqa %0, %%ymm0\" : : \"m\" (p[0]));\n\t\tasm volatile(\"vmovdqa %0, %%ymm8\" : : \"m\" (p[32]));\n\t\tasm volatile(\"vpxor %0, %%ymm1, %%ymm1\" : : \"m\" (dq[0]));\n\t\tasm volatile(\"vpxor %0, %%ymm9, %%ymm9\" : : \"m\" (dq[32]));\n\t\tasm volatile(\"vpxor %0, %%ymm0, %%ymm0\" : : \"m\" (dp[0]));\n\t\tasm volatile(\"vpxor %0, %%ymm8, %%ymm8\" : : \"m\" (dp[32]));\n\n\t\t \n\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm4\" : : \"m\" (qmul[0]));\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm5\" : : \"m\" (qmul[16]));\n\n\t\tasm volatile(\"vpsraw $4, %ymm1, %ymm3\");\n\t\tasm volatile(\"vpsraw $4, %ymm9, %ymm12\");\n\t\tasm volatile(\"vpand %ymm7, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpand %ymm7, %ymm9, %ymm9\");\n\t\tasm volatile(\"vpand %ymm7, %ymm3, %ymm3\");\n\t\tasm volatile(\"vpand %ymm7, %ymm12, %ymm12\");\n\t\tasm volatile(\"vpshufb %ymm9, %ymm4, %ymm14\");\n\t\tasm volatile(\"vpshufb %ymm1, %ymm4, %ymm4\");\n\t\tasm volatile(\"vpshufb %ymm12, %ymm5, %ymm15\");\n\t\tasm volatile(\"vpshufb %ymm3, %ymm5, %ymm5\");\n\t\tasm volatile(\"vpxor %ymm14, %ymm15, %ymm15\");\n\t\tasm volatile(\"vpxor %ymm4, %ymm5, %ymm5\");\n\n\t\t \n\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm4\" : : \"m\" (pbmul[0]));\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm1\" : : \"m\" (pbmul[16]));\n\t\tasm volatile(\"vpsraw $4, %ymm0, %ymm2\");\n\t\tasm volatile(\"vpsraw $4, %ymm8, %ymm6\");\n\t\tasm volatile(\"vpand %ymm7, %ymm0, %ymm3\");\n\t\tasm volatile(\"vpand %ymm7, %ymm8, %ymm14\");\n\t\tasm volatile(\"vpand %ymm7, %ymm2, %ymm2\");\n\t\tasm volatile(\"vpand %ymm7, %ymm6, %ymm6\");\n\t\tasm volatile(\"vpshufb %ymm14, %ymm4, %ymm12\");\n\t\tasm volatile(\"vpshufb %ymm3, %ymm4, %ymm4\");\n\t\tasm volatile(\"vpshufb %ymm6, %ymm1, %ymm13\");\n\t\tasm volatile(\"vpshufb %ymm2, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpxor %ymm4, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpxor %ymm12, %ymm13, %ymm13\");\n\n\t\t \n\t\tasm volatile(\"vpxor %ymm5, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpxor %ymm15, %ymm13, %ymm13\");\n\n\t\t \n\t\tasm volatile(\"vmovdqa %%ymm1, %0\" : \"=m\" (dq[0]));\n\t\tasm volatile(\"vmovdqa %%ymm13,%0\" : \"=m\" (dq[32]));\n\t\tasm volatile(\"vpxor %ymm1, %ymm0, %ymm0\");\n\t\tasm volatile(\"vpxor %ymm13, %ymm8, %ymm8\");\n\n\t\tasm volatile(\"vmovdqa %%ymm0, %0\" : \"=m\" (dp[0]));\n\t\tasm volatile(\"vmovdqa %%ymm8, %0\" : \"=m\" (dp[32]));\n\n\t\tbytes -= 64;\n\t\tp += 64;\n\t\tq += 64;\n\t\tdp += 64;\n\t\tdq += 64;\n#else\n\t\tasm volatile(\"vmovdqa %0, %%ymm1\" : : \"m\" (*q));\n\t\tasm volatile(\"vmovdqa %0, %%ymm0\" : : \"m\" (*p));\n\t\tasm volatile(\"vpxor %0, %%ymm1, %%ymm1\" : : \"m\" (*dq));\n\t\tasm volatile(\"vpxor %0, %%ymm0, %%ymm0\" : : \"m\" (*dp));\n\n\t\t \n\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm4\" : : \"m\" (qmul[0]));\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm5\" : : \"m\" (qmul[16]));\n\n\t\t \n\t\tasm volatile(\"vpsraw $4, %ymm1, %ymm3\");\n\t\tasm volatile(\"vpand %ymm7, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpand %ymm7, %ymm3, %ymm3\");\n\t\tasm volatile(\"vpshufb %ymm1, %ymm4, %ymm4\");\n\t\tasm volatile(\"vpshufb %ymm3, %ymm5, %ymm5\");\n\t\tasm volatile(\"vpxor %ymm4, %ymm5, %ymm5\");\n\n\t\t \n\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm4\" : : \"m\" (pbmul[0]));\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm1\" : : \"m\" (pbmul[16]));\n\n\t\tasm volatile(\"vpsraw $4, %ymm0, %ymm2\");\n\t\tasm volatile(\"vpand %ymm7, %ymm0, %ymm3\");\n\t\tasm volatile(\"vpand %ymm7, %ymm2, %ymm2\");\n\t\tasm volatile(\"vpshufb %ymm3, %ymm4, %ymm4\");\n\t\tasm volatile(\"vpshufb %ymm2, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpxor %ymm4, %ymm1, %ymm1\");\n\n\t\t \n\t\tasm volatile(\"vpxor %ymm5, %ymm1, %ymm1\");\n\t\t \n\t\tasm volatile(\"vmovdqa %%ymm1, %0\" : \"=m\" (dq[0]));\n\n\t\tasm volatile(\"vpxor %ymm1, %ymm0, %ymm0\");\n\t\tasm volatile(\"vmovdqa %%ymm0, %0\" : \"=m\" (dp[0]));\n\n\t\tbytes -= 32;\n\t\tp += 32;\n\t\tq += 32;\n\t\tdp += 32;\n\t\tdq += 32;\n#endif\n\t}\n\n\tkernel_fpu_end();\n}\n\nstatic void raid6_datap_recov_avx2(int disks, size_t bytes, int faila,\n\t\tvoid **ptrs)\n{\n\tu8 *p, *q, *dq;\n\tconst u8 *qmul;\t\t \n\tconst u8 x0f = 0x0f;\n\n\tp = (u8 *)ptrs[disks-2];\n\tq = (u8 *)ptrs[disks-1];\n\n\t \n\tdq = (u8 *)ptrs[faila];\n\tptrs[faila] = (void *)raid6_empty_zero_page;\n\tptrs[disks-1] = dq;\n\n\traid6_call.gen_syndrome(disks, bytes, ptrs);\n\n\t \n\tptrs[faila]   = dq;\n\tptrs[disks-1] = q;\n\n\t \n\tqmul  = raid6_vgfmul[raid6_gfinv[raid6_gfexp[faila]]];\n\n\tkernel_fpu_begin();\n\n\tasm volatile(\"vpbroadcastb %0, %%ymm7\" : : \"m\" (x0f));\n\n\twhile (bytes) {\n#ifdef CONFIG_X86_64\n\t\tasm volatile(\"vmovdqa %0, %%ymm3\" : : \"m\" (dq[0]));\n\t\tasm volatile(\"vmovdqa %0, %%ymm8\" : : \"m\" (dq[32]));\n\t\tasm volatile(\"vpxor %0, %%ymm3, %%ymm3\" : : \"m\" (q[0]));\n\t\tasm volatile(\"vpxor %0, %%ymm8, %%ymm8\" : : \"m\" (q[32]));\n\n\t\t \n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm0\" : : \"m\" (qmul[0]));\n\t\tasm volatile(\"vmovapd %ymm0, %ymm13\");\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm1\" : : \"m\" (qmul[16]));\n\t\tasm volatile(\"vmovapd %ymm1, %ymm14\");\n\n\t\tasm volatile(\"vpsraw $4, %ymm3, %ymm6\");\n\t\tasm volatile(\"vpsraw $4, %ymm8, %ymm12\");\n\t\tasm volatile(\"vpand %ymm7, %ymm3, %ymm3\");\n\t\tasm volatile(\"vpand %ymm7, %ymm8, %ymm8\");\n\t\tasm volatile(\"vpand %ymm7, %ymm6, %ymm6\");\n\t\tasm volatile(\"vpand %ymm7, %ymm12, %ymm12\");\n\t\tasm volatile(\"vpshufb %ymm3, %ymm0, %ymm0\");\n\t\tasm volatile(\"vpshufb %ymm8, %ymm13, %ymm13\");\n\t\tasm volatile(\"vpshufb %ymm6, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpshufb %ymm12, %ymm14, %ymm14\");\n\t\tasm volatile(\"vpxor %ymm0, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpxor %ymm13, %ymm14, %ymm14\");\n\n\t\t \n\t\tasm volatile(\"vmovdqa %0, %%ymm2\" : : \"m\" (p[0]));\n\t\tasm volatile(\"vmovdqa %0, %%ymm12\" : : \"m\" (p[32]));\n\t\tasm volatile(\"vpxor %ymm1, %ymm2, %ymm2\");\n\t\tasm volatile(\"vpxor %ymm14, %ymm12, %ymm12\");\n\n\t\t \n\n\t\tasm volatile(\"vmovdqa %%ymm1, %0\" : \"=m\" (dq[0]));\n\t\tasm volatile(\"vmovdqa %%ymm14, %0\" : \"=m\" (dq[32]));\n\t\tasm volatile(\"vmovdqa %%ymm2, %0\" : \"=m\" (p[0]));\n\t\tasm volatile(\"vmovdqa %%ymm12,%0\" : \"=m\" (p[32]));\n\n\t\tbytes -= 64;\n\t\tp += 64;\n\t\tq += 64;\n\t\tdq += 64;\n#else\n\t\tasm volatile(\"vmovdqa %0, %%ymm3\" : : \"m\" (dq[0]));\n\t\tasm volatile(\"vpxor %0, %%ymm3, %%ymm3\" : : \"m\" (q[0]));\n\n\t\t \n\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm0\" : : \"m\" (qmul[0]));\n\t\tasm volatile(\"vbroadcasti128 %0, %%ymm1\" : : \"m\" (qmul[16]));\n\n\t\tasm volatile(\"vpsraw $4, %ymm3, %ymm6\");\n\t\tasm volatile(\"vpand %ymm7, %ymm3, %ymm3\");\n\t\tasm volatile(\"vpand %ymm7, %ymm6, %ymm6\");\n\t\tasm volatile(\"vpshufb %ymm3, %ymm0, %ymm0\");\n\t\tasm volatile(\"vpshufb %ymm6, %ymm1, %ymm1\");\n\t\tasm volatile(\"vpxor %ymm0, %ymm1, %ymm1\");\n\n\t\t \n\n\t\tasm volatile(\"vmovdqa %0, %%ymm2\" : : \"m\" (p[0]));\n\t\tasm volatile(\"vpxor %ymm1, %ymm2, %ymm2\");\n\n\t\t \n\n\t\tasm volatile(\"vmovdqa %%ymm1, %0\" : \"=m\" (dq[0]));\n\t\tasm volatile(\"vmovdqa %%ymm2, %0\" : \"=m\" (p[0]));\n\n\t\tbytes -= 32;\n\t\tp += 32;\n\t\tq += 32;\n\t\tdq += 32;\n#endif\n\t}\n\n\tkernel_fpu_end();\n}\n\nconst struct raid6_recov_calls raid6_recov_avx2 = {\n\t.data2 = raid6_2data_recov_avx2,\n\t.datap = raid6_datap_recov_avx2,\n\t.valid = raid6_has_avx2,\n#ifdef CONFIG_X86_64\n\t.name = \"avx2x2\",\n#else\n\t.name = \"avx2x1\",\n#endif\n\t.priority = 2,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}