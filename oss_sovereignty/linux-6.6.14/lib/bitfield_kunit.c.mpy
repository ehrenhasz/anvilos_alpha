{
  "module_name": "bitfield_kunit.c",
  "hash_id": "d88cb5abdeea95a43abafd8e739a533ae5aecd32362417dbca7b929a5edc75f5",
  "original_prompt": "Ingested from linux-6.6.14/lib/bitfield_kunit.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <kunit/test.h>\n#include <linux/bitfield.h>\n\n#define CHECK_ENC_GET_U(tp, v, field, res) do {\t\t\t\t\\\n\t\t{\t\t\t\t\t\t\t\\\n\t\t\tu##tp _res;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t\t_res = u##tp##_encode_bits(v, field);\t\t\\\n\t\t\tKUNIT_ASSERT_FALSE_MSG(context, _res != res,\t\\\n\t\t\t\t       \"u\" #tp \"_encode_bits(\" #v \", \" #field \") is 0x%llx != \" #res \"\\n\",\t\\\n\t\t\t\t       (u64)_res);\t\t\t\\\n\t\t\tKUNIT_ASSERT_FALSE(context,\t\t\t\\\n\t\t\t\t   u##tp##_get_bits(_res, field) != v);\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} while (0)\n\n#define CHECK_ENC_GET_LE(tp, v, field, res) do {\t\t\t\\\n\t\t{\t\t\t\t\t\t\t\\\n\t\t\t__le##tp _res;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t\t_res = le##tp##_encode_bits(v, field);\t\t\\\n\t\t\tKUNIT_ASSERT_FALSE_MSG(context,\t\t\t\\\n\t\t\t\t       _res != cpu_to_le##tp(res),\t\\\n\t\t\t\t       \"le\" #tp \"_encode_bits(\" #v \", \" #field \") is 0x%llx != 0x%llx\",\\\n\t\t\t\t       (u64)le##tp##_to_cpu(_res),\t\\\n\t\t\t\t       (u64)(res));\t\t\t\\\n\t\t\tKUNIT_ASSERT_FALSE(context,\t\t\t\\\n\t\t\t\t   le##tp##_get_bits(_res, field) != v);\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} while (0)\n\n#define CHECK_ENC_GET_BE(tp, v, field, res) do {\t\t\t\\\n\t\t{\t\t\t\t\t\t\t\\\n\t\t\t__be##tp _res;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t\t_res = be##tp##_encode_bits(v, field);\t\t\\\n\t\t\tKUNIT_ASSERT_FALSE_MSG(context,\t\t\t\\\n\t\t\t\t       _res != cpu_to_be##tp(res),\t\\\n\t\t\t\t       \"be\" #tp \"_encode_bits(\" #v \", \" #field \") is 0x%llx != 0x%llx\",\t\\\n\t\t\t\t       (u64)be##tp##_to_cpu(_res),\t\\\n\t\t\t\t       (u64)(res));\t\t\t\\\n\t\t\tKUNIT_ASSERT_FALSE(context,\t\t\t\\\n\t\t\t\t   be##tp##_get_bits(_res, field) != v);\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} while (0)\n\n#define CHECK_ENC_GET(tp, v, field, res) do {\t\t\t\t\\\n\t\tCHECK_ENC_GET_U(tp, v, field, res);\t\t\t\\\n\t\tCHECK_ENC_GET_LE(tp, v, field, res);\t\t\t\\\n\t\tCHECK_ENC_GET_BE(tp, v, field, res);\t\t\t\\\n\t} while (0)\n\nstatic void __init test_bitfields_constants(struct kunit *context)\n{\n\t \n\n\tCHECK_ENC_GET(16,  1, 0x000f, 0x0001);\n\tCHECK_ENC_GET(16,  3, 0x00f0, 0x0030);\n\tCHECK_ENC_GET(16,  5, 0x0f00, 0x0500);\n\tCHECK_ENC_GET(16,  7, 0xf000, 0x7000);\n\tCHECK_ENC_GET(16, 14, 0x000f, 0x000e);\n\tCHECK_ENC_GET(16, 15, 0x00f0, 0x00f0);\n\n\tCHECK_ENC_GET_U(8,  1, 0x0f, 0x01);\n\tCHECK_ENC_GET_U(8,  3, 0xf0, 0x30);\n\tCHECK_ENC_GET_U(8, 14, 0x0f, 0x0e);\n\tCHECK_ENC_GET_U(8, 15, 0xf0, 0xf0);\n\n\tCHECK_ENC_GET(32,  1, 0x00000f00, 0x00000100);\n\tCHECK_ENC_GET(32,  3, 0x0000f000, 0x00003000);\n\tCHECK_ENC_GET(32,  5, 0x000f0000, 0x00050000);\n\tCHECK_ENC_GET(32,  7, 0x00f00000, 0x00700000);\n\tCHECK_ENC_GET(32, 14, 0x0f000000, 0x0e000000);\n\tCHECK_ENC_GET(32, 15, 0xf0000000, 0xf0000000);\n\n\tCHECK_ENC_GET(64,  1, 0x00000f0000000000ull, 0x0000010000000000ull);\n\tCHECK_ENC_GET(64,  3, 0x0000f00000000000ull, 0x0000300000000000ull);\n\tCHECK_ENC_GET(64,  5, 0x000f000000000000ull, 0x0005000000000000ull);\n\tCHECK_ENC_GET(64,  7, 0x00f0000000000000ull, 0x0070000000000000ull);\n\tCHECK_ENC_GET(64, 14, 0x0f00000000000000ull, 0x0e00000000000000ull);\n\tCHECK_ENC_GET(64, 15, 0xf000000000000000ull, 0xf000000000000000ull);\n}\n\n#define CHECK(tp, mask) do {\t\t\t\t\t\t\\\n\t\tu64 v;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tfor (v = 0; v < 1 << hweight32(mask); v++)\t\t\\\n\t\t\tKUNIT_ASSERT_FALSE(context,\t\t\t\\\n\t\t\t\ttp##_encode_bits(v, mask) != v << __ffs64(mask));\\\n\t} while (0)\n\nstatic void __init test_bitfields_variables(struct kunit *context)\n{\n\tCHECK(u8, 0x0f);\n\tCHECK(u8, 0xf0);\n\tCHECK(u8, 0x38);\n\n\tCHECK(u16, 0x0038);\n\tCHECK(u16, 0x0380);\n\tCHECK(u16, 0x3800);\n\tCHECK(u16, 0x8000);\n\n\tCHECK(u32, 0x80000000);\n\tCHECK(u32, 0x7f000000);\n\tCHECK(u32, 0x07e00000);\n\tCHECK(u32, 0x00018000);\n\n\tCHECK(u64, 0x8000000000000000ull);\n\tCHECK(u64, 0x7f00000000000000ull);\n\tCHECK(u64, 0x0001800000000000ull);\n\tCHECK(u64, 0x0000000080000000ull);\n\tCHECK(u64, 0x000000007f000000ull);\n\tCHECK(u64, 0x0000000018000000ull);\n\tCHECK(u64, 0x0000001f8000000ull);\n}\n\n#ifdef TEST_BITFIELD_COMPILE\nstatic void __init test_bitfields_compile(struct kunit *context)\n{\n\t \n\tCHECK_ENC_GET(16, 16, 0x0f00, 0x1000);\n\tu32_encode_bits(7, 0x06000000);\n\n\t \n\tu16_encode_bits(0, 0x60000);\n}\n#endif\n\nstatic struct kunit_case __refdata bitfields_test_cases[] = {\n\tKUNIT_CASE(test_bitfields_constants),\n\tKUNIT_CASE(test_bitfields_variables),\n\t{}\n};\n\nstatic struct kunit_suite bitfields_test_suite = {\n\t.name = \"bitfields\",\n\t.test_cases = bitfields_test_cases,\n};\n\nkunit_test_suites(&bitfields_test_suite);\n\nMODULE_AUTHOR(\"Johannes Berg <johannes@sipsolutions.net>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}