{
  "module_name": "random32.c",
  "hash_id": "e9a4f288e095a70e02e3275f8b55c65f42a311e653f9cc8db4e05462976013ad",
  "original_prompt": "Ingested from linux-6.6.14/lib/random32.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/percpu.h>\n#include <linux/export.h>\n#include <linux/jiffies.h>\n#include <linux/random.h>\n#include <linux/sched.h>\n#include <linux/bitops.h>\n#include <linux/slab.h>\n#include <asm/unaligned.h>\n\n \nu32 prandom_u32_state(struct rnd_state *state)\n{\n#define TAUSWORTHE(s, a, b, c, d) ((s & c) << d) ^ (((s << a) ^ s) >> b)\n\tstate->s1 = TAUSWORTHE(state->s1,  6U, 13U, 4294967294U, 18U);\n\tstate->s2 = TAUSWORTHE(state->s2,  2U, 27U, 4294967288U,  2U);\n\tstate->s3 = TAUSWORTHE(state->s3, 13U, 21U, 4294967280U,  7U);\n\tstate->s4 = TAUSWORTHE(state->s4,  3U, 12U, 4294967168U, 13U);\n\n\treturn (state->s1 ^ state->s2 ^ state->s3 ^ state->s4);\n}\nEXPORT_SYMBOL(prandom_u32_state);\n\n \nvoid prandom_bytes_state(struct rnd_state *state, void *buf, size_t bytes)\n{\n\tu8 *ptr = buf;\n\n\twhile (bytes >= sizeof(u32)) {\n\t\tput_unaligned(prandom_u32_state(state), (u32 *) ptr);\n\t\tptr += sizeof(u32);\n\t\tbytes -= sizeof(u32);\n\t}\n\n\tif (bytes > 0) {\n\t\tu32 rem = prandom_u32_state(state);\n\t\tdo {\n\t\t\t*ptr++ = (u8) rem;\n\t\t\tbytes--;\n\t\t\trem >>= BITS_PER_BYTE;\n\t\t} while (bytes > 0);\n\t}\n}\nEXPORT_SYMBOL(prandom_bytes_state);\n\nstatic void prandom_warmup(struct rnd_state *state)\n{\n\t \n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n\tprandom_u32_state(state);\n}\n\nvoid prandom_seed_full_state(struct rnd_state __percpu *pcpu_state)\n{\n\tint i;\n\n\tfor_each_possible_cpu(i) {\n\t\tstruct rnd_state *state = per_cpu_ptr(pcpu_state, i);\n\t\tu32 seeds[4];\n\n\t\tget_random_bytes(&seeds, sizeof(seeds));\n\t\tstate->s1 = __seed(seeds[0],   2U);\n\t\tstate->s2 = __seed(seeds[1],   8U);\n\t\tstate->s3 = __seed(seeds[2],  16U);\n\t\tstate->s4 = __seed(seeds[3], 128U);\n\n\t\tprandom_warmup(state);\n\t}\n}\nEXPORT_SYMBOL(prandom_seed_full_state);\n\n#ifdef CONFIG_RANDOM32_SELFTEST\nstatic struct prandom_test1 {\n\tu32 seed;\n\tu32 result;\n} test1[] = {\n\t{ 1U, 3484351685U },\n\t{ 2U, 2623130059U },\n\t{ 3U, 3125133893U },\n\t{ 4U,  984847254U },\n};\n\nstatic struct prandom_test2 {\n\tu32 seed;\n\tu32 iteration;\n\tu32 result;\n} test2[] = {\n\t \n\t{  931557656U, 959U, 2975593782U },\n\t{ 1339693295U, 876U, 3887776532U },\n\t{ 1545556285U, 961U, 1615538833U },\n\t{  601730776U, 723U, 1776162651U },\n\t{ 1027516047U, 687U,  511983079U },\n\t{  416526298U, 700U,  916156552U },\n\t{ 1395522032U, 652U, 2222063676U },\n\t{  366221443U, 617U, 2992857763U },\n\t{ 1539836965U, 714U, 3783265725U },\n\t{  556206671U, 994U,  799626459U },\n\t{  684907218U, 799U,  367789491U },\n\t{ 2121230701U, 931U, 2115467001U },\n\t{ 1668516451U, 644U, 3620590685U },\n\t{  768046066U, 883U, 2034077390U },\n\t{ 1989159136U, 833U, 1195767305U },\n\t{  536585145U, 996U, 3577259204U },\n\t{ 1008129373U, 642U, 1478080776U },\n\t{ 1740775604U, 939U, 1264980372U },\n\t{ 1967883163U, 508U,   10734624U },\n\t{ 1923019697U, 730U, 3821419629U },\n\t{  442079932U, 560U, 3440032343U },\n\t{ 1961302714U, 845U,  841962572U },\n\t{ 2030205964U, 962U, 1325144227U },\n\t{ 1160407529U, 507U,  240940858U },\n\t{  635482502U, 779U, 4200489746U },\n\t{ 1252788931U, 699U,  867195434U },\n\t{ 1961817131U, 719U,  668237657U },\n\t{ 1071468216U, 983U,  917876630U },\n\t{ 1281848367U, 932U, 1003100039U },\n\t{  582537119U, 780U, 1127273778U },\n\t{ 1973672777U, 853U, 1071368872U },\n\t{ 1896756996U, 762U, 1127851055U },\n\t{  847917054U, 500U, 1717499075U },\n\t{ 1240520510U, 951U, 2849576657U },\n\t{ 1685071682U, 567U, 1961810396U },\n\t{ 1516232129U, 557U,    3173877U },\n\t{ 1208118903U, 612U, 1613145022U },\n\t{ 1817269927U, 693U, 4279122573U },\n\t{ 1510091701U, 717U,  638191229U },\n\t{  365916850U, 807U,  600424314U },\n\t{  399324359U, 702U, 1803598116U },\n\t{ 1318480274U, 779U, 2074237022U },\n\t{  697758115U, 840U, 1483639402U },\n\t{ 1696507773U, 840U,  577415447U },\n\t{ 2081979121U, 981U, 3041486449U },\n\t{  955646687U, 742U, 3846494357U },\n\t{ 1250683506U, 749U,  836419859U },\n\t{  595003102U, 534U,  366794109U },\n\t{   47485338U, 558U, 3521120834U },\n\t{  619433479U, 610U, 3991783875U },\n\t{  704096520U, 518U, 4139493852U },\n\t{ 1712224984U, 606U, 2393312003U },\n\t{ 1318233152U, 922U, 3880361134U },\n\t{  855572992U, 761U, 1472974787U },\n\t{   64721421U, 703U,  683860550U },\n\t{  678931758U, 840U,  380616043U },\n\t{  692711973U, 778U, 1382361947U },\n\t{  677703619U, 530U, 2826914161U },\n\t{   92393223U, 586U, 1522128471U },\n\t{ 1222592920U, 743U, 3466726667U },\n\t{  358288986U, 695U, 1091956998U },\n\t{ 1935056945U, 958U,  514864477U },\n\t{  735675993U, 990U, 1294239989U },\n\t{ 1560089402U, 897U, 2238551287U },\n\t{   70616361U, 829U,   22483098U },\n\t{  368234700U, 731U, 2913875084U },\n\t{   20221190U, 879U, 1564152970U },\n\t{  539444654U, 682U, 1835141259U },\n\t{ 1314987297U, 840U, 1801114136U },\n\t{ 2019295544U, 645U, 3286438930U },\n\t{  469023838U, 716U, 1637918202U },\n\t{ 1843754496U, 653U, 2562092152U },\n\t{  400672036U, 809U, 4264212785U },\n\t{  404722249U, 965U, 2704116999U },\n\t{  600702209U, 758U,  584979986U },\n\t{  519953954U, 667U, 2574436237U },\n\t{ 1658071126U, 694U, 2214569490U },\n\t{  420480037U, 749U, 3430010866U },\n\t{  690103647U, 969U, 3700758083U },\n\t{ 1029424799U, 937U, 3787746841U },\n\t{ 2012608669U, 506U, 3362628973U },\n\t{ 1535432887U, 998U,   42610943U },\n\t{ 1330635533U, 857U, 3040806504U },\n\t{ 1223800550U, 539U, 3954229517U },\n\t{ 1322411537U, 680U, 3223250324U },\n\t{ 1877847898U, 945U, 2915147143U },\n\t{ 1646356099U, 874U,  965988280U },\n\t{  805687536U, 744U, 4032277920U },\n\t{ 1948093210U, 633U, 1346597684U },\n\t{  392609744U, 783U, 1636083295U },\n\t{  690241304U, 770U, 1201031298U },\n\t{ 1360302965U, 696U, 1665394461U },\n\t{ 1220090946U, 780U, 1316922812U },\n\t{  447092251U, 500U, 3438743375U },\n\t{ 1613868791U, 592U,  828546883U },\n\t{  523430951U, 548U, 2552392304U },\n\t{  726692899U, 810U, 1656872867U },\n\t{ 1364340021U, 836U, 3710513486U },\n\t{ 1986257729U, 931U,  935013962U },\n\t{  407983964U, 921U,  728767059U },\n};\n\nstatic void prandom_state_selftest_seed(struct rnd_state *state, u32 seed)\n{\n#define LCG(x)\t ((x) * 69069U)\t \n\tstate->s1 = __seed(LCG(seed),        2U);\n\tstate->s2 = __seed(LCG(state->s1),   8U);\n\tstate->s3 = __seed(LCG(state->s2),  16U);\n\tstate->s4 = __seed(LCG(state->s3), 128U);\n}\n\nstatic int __init prandom_state_selftest(void)\n{\n\tint i, j, errors = 0, runs = 0;\n\tbool error = false;\n\n\tfor (i = 0; i < ARRAY_SIZE(test1); i++) {\n\t\tstruct rnd_state state;\n\n\t\tprandom_state_selftest_seed(&state, test1[i].seed);\n\t\tprandom_warmup(&state);\n\n\t\tif (test1[i].result != prandom_u32_state(&state))\n\t\t\terror = true;\n\t}\n\n\tif (error)\n\t\tpr_warn(\"prandom: seed boundary self test failed\\n\");\n\telse\n\t\tpr_info(\"prandom: seed boundary self test passed\\n\");\n\n\tfor (i = 0; i < ARRAY_SIZE(test2); i++) {\n\t\tstruct rnd_state state;\n\n\t\tprandom_state_selftest_seed(&state, test2[i].seed);\n\t\tprandom_warmup(&state);\n\n\t\tfor (j = 0; j < test2[i].iteration - 1; j++)\n\t\t\tprandom_u32_state(&state);\n\n\t\tif (test2[i].result != prandom_u32_state(&state))\n\t\t\terrors++;\n\n\t\truns++;\n\t\tcond_resched();\n\t}\n\n\tif (errors)\n\t\tpr_warn(\"prandom: %d/%d self tests failed\\n\", errors, runs);\n\telse\n\t\tpr_info(\"prandom: %d self tests passed\\n\", runs);\n\treturn 0;\n}\ncore_initcall(prandom_state_selftest);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}