{
  "module_name": "cpumask_kunit.c",
  "hash_id": "bdb884c1d0049b15e8014848b360f45feb99dcf6b43f9228cf7faa98cbcc74f8",
  "original_prompt": "Ingested from linux-6.6.14/lib/cpumask_kunit.c",
  "human_readable_source": "\n \n\n#include <kunit/test.h>\n#include <linux/cpu.h>\n#include <linux/cpumask.h>\n\n#define MASK_MSG(m) \\\n\t\"%s contains %sCPUs %*pbl\", #m, (cpumask_weight(m) ? \"\" : \"no \"), \\\n\tnr_cpumask_bits, cpumask_bits(m)\n\n#define EXPECT_FOR_EACH_CPU_EQ(test, mask)\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tconst cpumask_t *m = (mask);\t\t\t\\\n\t\tint mask_weight = cpumask_weight(m);\t\t\\\n\t\tint cpu, iter = 0;\t\t\t\t\\\n\t\tfor_each_cpu(cpu, m)\t\t\t\t\\\n\t\t\titer++;\t\t\t\t\t\\\n\t\tKUNIT_EXPECT_EQ_MSG((test), mask_weight, iter, MASK_MSG(mask));\t\\\n\t} while (0)\n\n#define EXPECT_FOR_EACH_CPU_OP_EQ(test, op, mask1, mask2)\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\t\\\n\t\tconst cpumask_t *m1 = (mask1);\t\t\t\t\t\\\n\t\tconst cpumask_t *m2 = (mask2);\t\t\t\t\t\\\n\t\tint weight;                                                     \\\n\t\tint cpu, iter = 0;\t\t\t\t\t\t\\\n\t\tcpumask_##op(&mask_tmp, m1, m2);                                \\\n\t\tweight = cpumask_weight(&mask_tmp);\t\t\t\t\\\n\t\tfor_each_cpu_##op(cpu, mask1, mask2)\t\t\t\t\\\n\t\t\titer++;\t\t\t\t\t\t\t\\\n\t\tKUNIT_EXPECT_EQ((test), weight, iter);\t\t\t\t\\\n\t} while (0)\n\n#define EXPECT_FOR_EACH_CPU_WRAP_EQ(test, mask)\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tconst cpumask_t *m = (mask);\t\t\t\\\n\t\tint mask_weight = cpumask_weight(m);\t\t\\\n\t\tint cpu, iter = 0;\t\t\t\t\\\n\t\tfor_each_cpu_wrap(cpu, m, nr_cpu_ids / 2)\t\\\n\t\t\titer++;\t\t\t\t\t\\\n\t\tKUNIT_EXPECT_EQ_MSG((test), mask_weight, iter, MASK_MSG(mask));\t\\\n\t} while (0)\n\n#define EXPECT_FOR_EACH_CPU_BUILTIN_EQ(test, name)\t\t\\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tint mask_weight = num_##name##_cpus();\t\t\\\n\t\tint cpu, iter = 0;\t\t\t\t\\\n\t\tfor_each_##name##_cpu(cpu)\t\t\t\\\n\t\t\titer++;\t\t\t\t\t\\\n\t\tKUNIT_EXPECT_EQ_MSG((test), mask_weight, iter, MASK_MSG(cpu_##name##_mask));\t\\\n\t} while (0)\n\nstatic cpumask_t mask_empty;\nstatic cpumask_t mask_all;\nstatic cpumask_t mask_tmp;\n\nstatic void test_cpumask_weight(struct kunit *test)\n{\n\tKUNIT_EXPECT_TRUE_MSG(test, cpumask_empty(&mask_empty), MASK_MSG(&mask_empty));\n\tKUNIT_EXPECT_TRUE_MSG(test, cpumask_full(&mask_all), MASK_MSG(&mask_all));\n\n\tKUNIT_EXPECT_EQ_MSG(test, 0, cpumask_weight(&mask_empty), MASK_MSG(&mask_empty));\n\tKUNIT_EXPECT_EQ_MSG(test, nr_cpu_ids, cpumask_weight(cpu_possible_mask),\n\t\t\t    MASK_MSG(cpu_possible_mask));\n\tKUNIT_EXPECT_EQ_MSG(test, nr_cpu_ids, cpumask_weight(&mask_all), MASK_MSG(&mask_all));\n}\n\nstatic void test_cpumask_first(struct kunit *test)\n{\n\tKUNIT_EXPECT_LE_MSG(test, nr_cpu_ids, cpumask_first(&mask_empty), MASK_MSG(&mask_empty));\n\tKUNIT_EXPECT_EQ_MSG(test, 0, cpumask_first(cpu_possible_mask), MASK_MSG(cpu_possible_mask));\n\n\tKUNIT_EXPECT_EQ_MSG(test, 0, cpumask_first_zero(&mask_empty), MASK_MSG(&mask_empty));\n\tKUNIT_EXPECT_LE_MSG(test, nr_cpu_ids, cpumask_first_zero(cpu_possible_mask),\n\t\t\t    MASK_MSG(cpu_possible_mask));\n}\n\nstatic void test_cpumask_last(struct kunit *test)\n{\n\tKUNIT_EXPECT_LE_MSG(test, nr_cpumask_bits, cpumask_last(&mask_empty),\n\t\t\t    MASK_MSG(&mask_empty));\n\tKUNIT_EXPECT_EQ_MSG(test, nr_cpu_ids - 1, cpumask_last(cpu_possible_mask),\n\t\t\t    MASK_MSG(cpu_possible_mask));\n}\n\nstatic void test_cpumask_next(struct kunit *test)\n{\n\tKUNIT_EXPECT_EQ_MSG(test, 0, cpumask_next_zero(-1, &mask_empty), MASK_MSG(&mask_empty));\n\tKUNIT_EXPECT_LE_MSG(test, nr_cpu_ids, cpumask_next_zero(-1, cpu_possible_mask),\n\t\t\t    MASK_MSG(cpu_possible_mask));\n\n\tKUNIT_EXPECT_LE_MSG(test, nr_cpu_ids, cpumask_next(-1, &mask_empty),\n\t\t\t    MASK_MSG(&mask_empty));\n\tKUNIT_EXPECT_EQ_MSG(test, 0, cpumask_next(-1, cpu_possible_mask),\n\t\t\t    MASK_MSG(cpu_possible_mask));\n}\n\nstatic void test_cpumask_iterators(struct kunit *test)\n{\n\tEXPECT_FOR_EACH_CPU_EQ(test, &mask_empty);\n\tEXPECT_FOR_EACH_CPU_WRAP_EQ(test, &mask_empty);\n\tEXPECT_FOR_EACH_CPU_OP_EQ(test, and, &mask_empty, &mask_empty);\n\tEXPECT_FOR_EACH_CPU_OP_EQ(test, and, cpu_possible_mask, &mask_empty);\n\tEXPECT_FOR_EACH_CPU_OP_EQ(test, andnot, &mask_empty, &mask_empty);\n\n\tEXPECT_FOR_EACH_CPU_EQ(test, cpu_possible_mask);\n\tEXPECT_FOR_EACH_CPU_WRAP_EQ(test, cpu_possible_mask);\n\tEXPECT_FOR_EACH_CPU_OP_EQ(test, and, cpu_possible_mask, cpu_possible_mask);\n\tEXPECT_FOR_EACH_CPU_OP_EQ(test, andnot, cpu_possible_mask, &mask_empty);\n}\n\nstatic void test_cpumask_iterators_builtin(struct kunit *test)\n{\n\tEXPECT_FOR_EACH_CPU_BUILTIN_EQ(test, possible);\n\n\t \n\tcpu_hotplug_disable();\n\n\tEXPECT_FOR_EACH_CPU_BUILTIN_EQ(test, online);\n\tEXPECT_FOR_EACH_CPU_BUILTIN_EQ(test, present);\n\n\tcpu_hotplug_enable();\n}\n\nstatic int test_cpumask_init(struct kunit *test)\n{\n\tcpumask_clear(&mask_empty);\n\tcpumask_setall(&mask_all);\n\n\treturn 0;\n}\n\nstatic struct kunit_case test_cpumask_cases[] = {\n\tKUNIT_CASE(test_cpumask_weight),\n\tKUNIT_CASE(test_cpumask_first),\n\tKUNIT_CASE(test_cpumask_last),\n\tKUNIT_CASE(test_cpumask_next),\n\tKUNIT_CASE(test_cpumask_iterators),\n\tKUNIT_CASE(test_cpumask_iterators_builtin),\n\t{}\n};\n\nstatic struct kunit_suite test_cpumask_suite = {\n\t.name = \"cpumask\",\n\t.init = test_cpumask_init,\n\t.test_cases = test_cpumask_cases,\n};\nkunit_test_suite(test_cpumask_suite);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}