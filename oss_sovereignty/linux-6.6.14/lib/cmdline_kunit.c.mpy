{
  "module_name": "cmdline_kunit.c",
  "hash_id": "36fcf3d7a2ffafdda274f1acb82cf8eb4b3ed74d110458c4864380dca28e5006",
  "original_prompt": "Ingested from linux-6.6.14/lib/cmdline_kunit.c",
  "human_readable_source": "\n \n\n#include <kunit/test.h>\n#include <linux/kernel.h>\n#include <linux/random.h>\n#include <linux/string.h>\n\nstatic const char *cmdline_test_strings[] = {\n\t\"\\\"\\\"\", \"\"  , \"=\" , \"\\\"-\", \",\"    , \"-,\"   , \",-\"   , \"-\" ,\n\t\"+,\"  , \"--\", \",,\", \"''\" , \"\\\"\\\",\", \"\\\",\\\"\", \"-\\\"\\\"\", \"\\\"\",\n};\n\nstatic const int cmdline_test_values[] = {\n\t1, 1, 1, 1, 2, 3, 2, 3,\n\t1, 3, 2, 1, 1, 1, 3, 1,\n};\n\nstatic_assert(ARRAY_SIZE(cmdline_test_strings) == ARRAY_SIZE(cmdline_test_values));\n\nstatic const char *cmdline_test_range_strings[] = {\n\t\"-7\" , \"--7\"  , \"-1-2\"    , \"7--9\",\n\t\"7-\" , \"-7--9\", \"7-9,\"    , \"9-7\" ,\n\t\"5-a\", \"a-5\"  , \"5-8\"     , \",8-5\",\n\t\"+,1\", \"-,4\"  , \"-3,0-1,6\", \"4,-\" ,\n\t\" +2\", \" -9\"  , \"0-1,-3,6\", \"- 9\" ,\n};\n\nstatic const int cmdline_test_range_values[][16] = {\n\t{ 1, -7, }, { 0, -0, }, { 4, -1, 0, +1, 2, }, { 0, 7, },\n\t{ 0, +7, }, { 0, -7, }, { 3, +7, 8, +9, 0, }, { 0, 9, },\n\t{ 0, +5, }, { 0, -0, }, { 4, +5, 6, +7, 8, }, { 0, 0, },\n\t{ 0, +0, }, { 0, -0, }, { 4, -3, 0, +1, 6, }, { 1, 4, },\n\t{ 0, +0, }, { 0, -0, }, { 4, +0, 1, -3, 6, }, { 0, 0, },\n};\n\nstatic_assert(ARRAY_SIZE(cmdline_test_range_strings) == ARRAY_SIZE(cmdline_test_range_values));\n\nstatic void cmdline_do_one_test(struct kunit *test, const char *in, int rc, int offset)\n{\n\tconst char *fmt = \"Pattern: %s\";\n\tconst char *out = in;\n\tint dummy;\n\tint ret;\n\n\tret = get_option((char **)&out, &dummy);\n\n\tKUNIT_EXPECT_EQ_MSG(test, ret, rc, fmt, in);\n\tKUNIT_EXPECT_PTR_EQ_MSG(test, out, in + offset, fmt, in);\n}\n\nstatic void cmdline_test_noint(struct kunit *test)\n{\n\tunsigned int i = 0;\n\n\tdo {\n\t\tconst char *str = cmdline_test_strings[i];\n\t\tint rc = 0;\n\t\tint offset;\n\n\t\t \n\t\toffset = !!(*str == '-');\n\t\tcmdline_do_one_test(test, str, rc, offset);\n\t} while (++i < ARRAY_SIZE(cmdline_test_strings));\n}\n\nstatic void cmdline_test_lead_int(struct kunit *test)\n{\n\tunsigned int i = 0;\n\tchar in[32];\n\n\tdo {\n\t\tconst char *str = cmdline_test_strings[i];\n\t\tint rc = cmdline_test_values[i];\n\t\tint offset;\n\n\t\tsprintf(in, \"%u%s\", get_random_u8(), str);\n\t\t \n\t\toffset = strlen(in) - strlen(str) + !!(rc == 2);\n\t\tcmdline_do_one_test(test, in, rc, offset);\n\t} while (++i < ARRAY_SIZE(cmdline_test_strings));\n}\n\nstatic void cmdline_test_tail_int(struct kunit *test)\n{\n\tunsigned int i = 0;\n\tchar in[32];\n\n\tdo {\n\t\tconst char *str = cmdline_test_strings[i];\n\t\t \n\t\tint rc = strcmp(str, \"\") ? (strcmp(str, \"-\") ? 0 : 1) : 1;\n\t\tint offset;\n\n\t\tsprintf(in, \"%s%u\", str, get_random_u8());\n\t\t \n\t\toffset = rc ? strlen(in) : !!(*str == '-');\n\t\tcmdline_do_one_test(test, in, rc, offset);\n\t} while (++i < ARRAY_SIZE(cmdline_test_strings));\n}\n\nstatic void cmdline_do_one_range_test(struct kunit *test, const char *in,\n\t\t\t\t      unsigned int n, const int *e)\n{\n\tunsigned int i;\n\tint r[16];\n\tint *p;\n\n\tmemset(r, 0, sizeof(r));\n\tget_options(in, ARRAY_SIZE(r), r);\n\tKUNIT_EXPECT_EQ_MSG(test, r[0], e[0], \"in test %u (parsed) expected %d numbers, got %d\",\n\t\t\t    n, e[0], r[0]);\n\tfor (i = 1; i < ARRAY_SIZE(r); i++)\n\t\tKUNIT_EXPECT_EQ_MSG(test, r[i], e[i], \"in test %u at %u\", n, i);\n\n\tmemset(r, 0, sizeof(r));\n\tget_options(in, 0, r);\n\tKUNIT_EXPECT_EQ_MSG(test, r[0], e[0], \"in test %u (validated) expected %d numbers, got %d\",\n\t\t\t    n, e[0], r[0]);\n\n\tp = memchr_inv(&r[1], 0, sizeof(r) - sizeof(r[0]));\n\tKUNIT_EXPECT_PTR_EQ_MSG(test, p, NULL, \"in test %u at %u out of bound\", n, p - r);\n}\n\nstatic void cmdline_test_range(struct kunit *test)\n{\n\tunsigned int i = 0;\n\n\tdo {\n\t\tconst char *str = cmdline_test_range_strings[i];\n\t\tconst int *e = cmdline_test_range_values[i];\n\n\t\tcmdline_do_one_range_test(test, str, i, e);\n\t} while (++i < ARRAY_SIZE(cmdline_test_range_strings));\n}\n\nstatic struct kunit_case cmdline_test_cases[] = {\n\tKUNIT_CASE(cmdline_test_noint),\n\tKUNIT_CASE(cmdline_test_lead_int),\n\tKUNIT_CASE(cmdline_test_tail_int),\n\tKUNIT_CASE(cmdline_test_range),\n\t{}\n};\n\nstatic struct kunit_suite cmdline_test_suite = {\n\t.name = \"cmdline\",\n\t.test_cases = cmdline_test_cases,\n};\nkunit_test_suite(cmdline_test_suite);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}