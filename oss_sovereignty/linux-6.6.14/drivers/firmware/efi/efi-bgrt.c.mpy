{
  "module_name": "efi-bgrt.c",
  "hash_id": "7fc9f192ce01c124575623c80becae46aa57dd0cce8c07a956a49ef5371085ae",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/efi/efi-bgrt.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/acpi.h>\n#include <linux/efi.h>\n#include <linux/efi-bgrt.h>\n\nstruct acpi_table_bgrt bgrt_tab;\nsize_t bgrt_image_size;\n\nstruct bmp_header {\n\tu16 id;\n\tu32 size;\n} __packed;\n\nvoid __init efi_bgrt_init(struct acpi_table_header *table)\n{\n\tvoid *image;\n\tstruct bmp_header bmp_header;\n\tstruct acpi_table_bgrt *bgrt = &bgrt_tab;\n\n\tif (acpi_disabled)\n\t\treturn;\n\n\tif (!efi_enabled(EFI_MEMMAP))\n\t\treturn;\n\n\tif (table->length < sizeof(bgrt_tab)) {\n\t\tpr_notice(\"Ignoring BGRT: invalid length %u (expected %zu)\\n\",\n\t\t       table->length, sizeof(bgrt_tab));\n\t\treturn;\n\t}\n\t*bgrt = *(struct acpi_table_bgrt *)table;\n\t \n\tif (bgrt->version > 1) {\n\t\tpr_notice(\"Ignoring BGRT: invalid version %u (expected 1)\\n\",\n\t\t       bgrt->version);\n\t\tgoto out;\n\t}\n\tif (bgrt->image_type != 0) {\n\t\tpr_notice(\"Ignoring BGRT: invalid image type %u (expected 0)\\n\",\n\t\t       bgrt->image_type);\n\t\tgoto out;\n\t}\n\tif (!bgrt->image_address) {\n\t\tpr_notice(\"Ignoring BGRT: null image address\\n\");\n\t\tgoto out;\n\t}\n\n\tif (efi_mem_type(bgrt->image_address) != EFI_BOOT_SERVICES_DATA) {\n\t\tpr_notice(\"Ignoring BGRT: invalid image address\\n\");\n\t\tgoto out;\n\t}\n\timage = early_memremap(bgrt->image_address, sizeof(bmp_header));\n\tif (!image) {\n\t\tpr_notice(\"Ignoring BGRT: failed to map image header memory\\n\");\n\t\tgoto out;\n\t}\n\n\tmemcpy(&bmp_header, image, sizeof(bmp_header));\n\tearly_memunmap(image, sizeof(bmp_header));\n\tif (bmp_header.id != 0x4d42) {\n\t\tpr_notice(\"Ignoring BGRT: Incorrect BMP magic number 0x%x (expected 0x4d42)\\n\",\n\t\t\tbmp_header.id);\n\t\tgoto out;\n\t}\n\tbgrt_image_size = bmp_header.size;\n\tefi_mem_reserve(bgrt->image_address, bgrt_image_size);\n\n\treturn;\nout:\n\tmemset(bgrt, 0, sizeof(bgrt_tab));\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}