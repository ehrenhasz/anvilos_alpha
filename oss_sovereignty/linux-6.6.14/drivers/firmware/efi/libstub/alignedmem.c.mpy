{
  "module_name": "alignedmem.c",
  "hash_id": "d449a613f2050d4b0a4f7be7fa1a9a314b3a6546f41c51c43e0114b4b8d94240",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/efi/libstub/alignedmem.c",
  "human_readable_source": "\n\n#include <linux/efi.h>\n#include <asm/efi.h>\n\n#include \"efistub.h\"\n\n \nefi_status_t efi_allocate_pages_aligned(unsigned long size, unsigned long *addr,\n\t\t\t\t\tunsigned long max, unsigned long align,\n\t\t\t\t\tint memory_type)\n{\n\tefi_physical_addr_t alloc_addr;\n\tefi_status_t status;\n\tint slack;\n\n\tmax = min(max, EFI_ALLOC_LIMIT);\n\n\tif (align < EFI_ALLOC_ALIGN)\n\t\talign = EFI_ALLOC_ALIGN;\n\n\talloc_addr = ALIGN_DOWN(max + 1, align) - 1;\n\tsize = round_up(size, EFI_ALLOC_ALIGN);\n\tslack = align / EFI_PAGE_SIZE - 1;\n\n\tstatus = efi_bs_call(allocate_pages, EFI_ALLOCATE_MAX_ADDRESS,\n\t\t\t     memory_type, size / EFI_PAGE_SIZE + slack,\n\t\t\t     &alloc_addr);\n\tif (status != EFI_SUCCESS)\n\t\treturn status;\n\n\t*addr = ALIGN((unsigned long)alloc_addr, align);\n\n\tif (slack > 0) {\n\t\tint l = (alloc_addr & (align - 1)) / EFI_PAGE_SIZE;\n\n\t\tif (l) {\n\t\t\tefi_bs_call(free_pages, alloc_addr, slack - l + 1);\n\t\t\tslack = l - 1;\n\t\t}\n\t\tif (slack)\n\t\t\tefi_bs_call(free_pages, *addr + size, slack);\n\t}\n\treturn EFI_SUCCESS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}