{
  "module_name": "Makefile.zboot",
  "hash_id": "9bb69b733179c855dc070941ab8abf7f229fe409be33002e59d48fa40a6786fb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/efi/libstub/Makefile.zboot",
  "human_readable_source": "# SPDX-License-Identifier: GPL-2.0\n\n# to be include'd by arch/$(ARCH)/boot/Makefile after setting\n# EFI_ZBOOT_PAYLOAD, EFI_ZBOOT_BFD_TARGET, EFI_ZBOOT_MACH_TYPE and\n# EFI_ZBOOT_FORWARD_CFI\n\nquiet_cmd_copy_and_pad = PAD     $@\n      cmd_copy_and_pad = cp $< $@ && \\\n\t\t\t truncate -s $(shell hexdump -s16 -n4 -e '\"%u\"' $<) $@\n\n# Pad the file to the size of the uncompressed image in memory, including BSS\n$(obj)/vmlinux.bin: $(obj)/$(EFI_ZBOOT_PAYLOAD) FORCE\n\t$(call if_changed,copy_and_pad)\n\ncomp-type-$(CONFIG_KERNEL_GZIP)\t\t:= gzip\ncomp-type-$(CONFIG_KERNEL_LZ4)\t\t:= lz4\ncomp-type-$(CONFIG_KERNEL_LZMA)\t\t:= lzma\ncomp-type-$(CONFIG_KERNEL_LZO)\t\t:= lzo\ncomp-type-$(CONFIG_KERNEL_XZ)\t\t:= xzkern\ncomp-type-$(CONFIG_KERNEL_ZSTD)\t\t:= zstd22\n\n# in GZIP, the appended le32 carrying the uncompressed size is part of the\n# format, but in other cases, we just append it at the end for convenience,\n# causing the original tools to complain when checking image integrity.\n# So disregard it when calculating the payload size in the zimage header.\nzboot-method-y                         := $(comp-type-y)_with_size\nzboot-size-len-y                       := 4\n\nzboot-method-$(CONFIG_KERNEL_GZIP)     := gzip\nzboot-size-len-$(CONFIG_KERNEL_GZIP)   := 0\n\n$(obj)/vmlinuz: $(obj)/vmlinux.bin FORCE\n\t$(call if_changed,$(zboot-method-y))\n\n# avoid eager evaluation to prevent references to non-existent build artifacts\nOBJCOPYFLAGS_vmlinuz.o = -I binary -O $(EFI_ZBOOT_BFD_TARGET) $(EFI_ZBOOT_OBJCOPY_FLAGS) \\\n\t\t\t  --rename-section .data=.gzdata,load,alloc,readonly,contents\n$(obj)/vmlinuz.o: $(obj)/vmlinuz FORCE\n\t$(call if_changed,objcopy)\n\naflags-zboot-header-$(EFI_ZBOOT_FORWARD_CFI) := \\\n\t\t-DPE_DLL_CHAR_EX=IMAGE_DLLCHARACTERISTICS_EX_FORWARD_CFI_COMPAT\n\nAFLAGS_zboot-header.o += -DMACHINE_TYPE=IMAGE_FILE_MACHINE_$(EFI_ZBOOT_MACH_TYPE) \\\n\t\t\t -DZBOOT_EFI_PATH=\"\\\"$(realpath $(obj)/vmlinuz.efi.elf)\\\"\" \\\n\t\t\t -DZBOOT_SIZE_LEN=$(zboot-size-len-y) \\\n\t\t\t -DCOMP_TYPE=\"\\\"$(comp-type-y)\\\"\" \\\n\t\t\t $(aflags-zboot-header-y)\n\n$(obj)/zboot-header.o: $(srctree)/drivers/firmware/efi/libstub/zboot-header.S FORCE\n\t$(call if_changed_rule,as_o_S)\n\nZBOOT_DEPS := $(obj)/zboot-header.o $(objtree)/drivers/firmware/efi/libstub/lib.a\n\nLDFLAGS_vmlinuz.efi.elf := -T $(srctree)/drivers/firmware/efi/libstub/zboot.lds\n$(obj)/vmlinuz.efi.elf: $(obj)/vmlinuz.o $(ZBOOT_DEPS) FORCE\n\t$(call if_changed,ld)\n\nOBJCOPYFLAGS_vmlinuz.efi := -O binary\n$(obj)/vmlinuz.efi: $(obj)/vmlinuz.efi.elf FORCE\n\t$(call if_changed,objcopy)\n\ntargets += zboot-header.o vmlinux.bin vmlinuz vmlinuz.o vmlinuz.efi.elf vmlinuz.efi\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}