{
  "module_name": "loongarch.c",
  "hash_id": "0044beb75eb37dbf7a754deac25a618ff91b38fda924daa606ac368e99d969e5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/efi/libstub/loongarch.c",
  "human_readable_source": "\n \n\n#include <asm/efi.h>\n#include <asm/addrspace.h>\n#include \"efistub.h\"\n\ntypedef void __noreturn (*kernel_entry_t)(bool efi, unsigned long cmdline,\n\t\t\t\t\t  unsigned long systab);\n\nefi_status_t check_platform_features(void)\n{\n\treturn EFI_SUCCESS;\n}\n\nstruct exit_boot_struct {\n\tefi_memory_desc_t\t*runtime_map;\n\tint\t\t\truntime_entry_count;\n};\n\nstatic efi_status_t exit_boot_func(struct efi_boot_memmap *map, void *priv)\n{\n\tstruct exit_boot_struct *p = priv;\n\n\t \n\tefi_get_virtmap(map->map, map->map_size, map->desc_size,\n\t\t\tp->runtime_map, &p->runtime_entry_count);\n\n\treturn EFI_SUCCESS;\n}\n\nunsigned long __weak kernel_entry_address(unsigned long kernel_addr)\n{\n\treturn *(unsigned long *)(kernel_addr + 8) - VMLINUX_LOAD_ADDRESS + kernel_addr;\n}\n\nefi_status_t efi_boot_kernel(void *handle, efi_loaded_image_t *image,\n\t\t\t     unsigned long kernel_addr, char *cmdline_ptr)\n{\n\tkernel_entry_t real_kernel_entry;\n\tstruct exit_boot_struct priv;\n\tunsigned long desc_size;\n\tefi_status_t status;\n\tu32 desc_ver;\n\n\tstatus = efi_alloc_virtmap(&priv.runtime_map, &desc_size, &desc_ver);\n\tif (status != EFI_SUCCESS) {\n\t\tefi_err(\"Unable to retrieve UEFI memory map.\\n\");\n\t\treturn status;\n\t}\n\n\tefi_info(\"Exiting boot services\\n\");\n\n\tefi_novamap = false;\n\tstatus = efi_exit_boot_services(handle, &priv, exit_boot_func);\n\tif (status != EFI_SUCCESS)\n\t\treturn status;\n\n\t \n\tefi_rt_call(set_virtual_address_map,\n\t\t    priv.runtime_entry_count * desc_size, desc_size,\n\t\t    desc_ver, priv.runtime_map);\n\n\t \n\tcsr_write64(CSR_DMW0_INIT, LOONGARCH_CSR_DMWIN0);\n\tcsr_write64(CSR_DMW1_INIT, LOONGARCH_CSR_DMWIN1);\n\n\treal_kernel_entry = (void *)kernel_entry_address(kernel_addr);\n\n\treal_kernel_entry(true, (unsigned long)cmdline_ptr,\n\t\t\t  (unsigned long)efi_system_table);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}