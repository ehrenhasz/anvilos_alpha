{
  "module_name": "reboot.c",
  "hash_id": "0039340d95e3eb478eb398050d093ec1e9339c63d16fd6d86126275e7d10f9a3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/efi/reboot.c",
  "human_readable_source": "\n \n#include <linux/efi.h>\n#include <linux/reboot.h>\n\nstatic struct sys_off_handler *efi_sys_off_handler;\n\nint efi_reboot_quirk_mode = -1;\n\nvoid efi_reboot(enum reboot_mode reboot_mode, const char *__unused)\n{\n\tconst char *str[] = { \"cold\", \"warm\", \"shutdown\", \"platform\" };\n\tint efi_mode, cap_reset_mode;\n\n\tif (!efi_rt_services_supported(EFI_RT_SUPPORTED_RESET_SYSTEM))\n\t\treturn;\n\n\tswitch (reboot_mode) {\n\tcase REBOOT_WARM:\n\tcase REBOOT_SOFT:\n\t\tefi_mode = EFI_RESET_WARM;\n\t\tbreak;\n\tdefault:\n\t\tefi_mode = EFI_RESET_COLD;\n\t\tbreak;\n\t}\n\n\t \n\tif (efi_reboot_quirk_mode != -1)\n\t\tefi_mode = efi_reboot_quirk_mode;\n\n\tif (efi_capsule_pending(&cap_reset_mode)) {\n\t\tif (efi_mode != cap_reset_mode)\n\t\t\tprintk(KERN_CRIT \"efi: %s reset requested but pending \"\n\t\t\t       \"capsule update requires %s reset... Performing \"\n\t\t\t       \"%s reset.\\n\", str[efi_mode], str[cap_reset_mode],\n\t\t\t       str[cap_reset_mode]);\n\t\tefi_mode = cap_reset_mode;\n\t}\n\n\tefi.reset_system(efi_mode, EFI_SUCCESS, 0, NULL);\n}\n\nbool __weak efi_poweroff_required(void)\n{\n\treturn false;\n}\n\nstatic int efi_power_off(struct sys_off_data *data)\n{\n\tefi.reset_system(EFI_RESET_SHUTDOWN, EFI_SUCCESS, 0, NULL);\n\n\treturn NOTIFY_DONE;\n}\n\nstatic int __init efi_shutdown_init(void)\n{\n\tif (!efi_rt_services_supported(EFI_RT_SUPPORTED_RESET_SYSTEM))\n\t\treturn -ENODEV;\n\n\tif (efi_poweroff_required()) {\n\t\t \n\t\tefi_sys_off_handler =\n\t\t\tregister_sys_off_handler(SYS_OFF_MODE_POWER_OFF,\n\t\t\t\t\t\t SYS_OFF_PRIO_FIRMWARE + 1,\n\t\t\t\t\t\t efi_power_off, NULL);\n\t\tif (IS_ERR(efi_sys_off_handler))\n\t\t\treturn PTR_ERR(efi_sys_off_handler);\n\t}\n\n\treturn 0;\n}\nlate_initcall(efi_shutdown_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}