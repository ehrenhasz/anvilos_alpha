{
  "module_name": "iscsi_ibft_find.c",
  "hash_id": "1b778c966e1271b217ba5c9f2d12938be67ccccc70e802e4ee5a215184268512",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/iscsi_ibft_find.c",
  "human_readable_source": "\n \n\n#include <linux/memblock.h>\n#include <linux/blkdev.h>\n#include <linux/ctype.h>\n#include <linux/device.h>\n#include <linux/efi.h>\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/limits.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/stat.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <linux/acpi.h>\n#include <linux/iscsi_ibft.h>\n\n#include <asm/mmzone.h>\n\n \nphys_addr_t ibft_phys_addr;\nEXPORT_SYMBOL_GPL(ibft_phys_addr);\n\nstatic const struct {\n\tchar *sign;\n} ibft_signs[] = {\n\t{ \"iBFT\" },\n\t{ \"BIFT\" },\t \n};\n\n#define IBFT_SIGN_LEN 4\n#define VGA_MEM 0xA0000  \n#define VGA_SIZE 0x20000  \n\n \nvoid __init reserve_ibft_region(void)\n{\n\tunsigned long pos, virt_pos = 0;\n\tunsigned int len = 0;\n\tvoid *virt = NULL;\n\tint i;\n\n\tibft_phys_addr = 0;\n\n\t \n\tif (efi_enabled(EFI_BOOT))\n\t\treturn;\n\n\tfor (pos = IBFT_START; pos < IBFT_END; pos += 16) {\n\t\t \n\t\tif (pos == VGA_MEM)\n\t\t\tpos += VGA_SIZE;\n\n\t\t \n\t\tif (offset_in_page(pos) == 0) {\n\t\t\tif (virt)\n\t\t\t\tearly_memunmap(virt, PAGE_SIZE);\n\t\t\tvirt = early_memremap_ro(pos, PAGE_SIZE);\n\t\t\tvirt_pos = pos;\n\t\t}\n\n\t\tfor (i = 0; i < ARRAY_SIZE(ibft_signs); i++) {\n\t\t\tif (memcmp(virt + (pos - virt_pos), ibft_signs[i].sign,\n\t\t\t\t   IBFT_SIGN_LEN) == 0) {\n\t\t\t\tunsigned long *addr =\n\t\t\t\t    (unsigned long *)(virt + pos - virt_pos + 4);\n\t\t\t\tlen = *addr;\n\t\t\t\t \n\t\t\t\tif (pos + len <= (IBFT_END-1)) {\n\t\t\t\t\tibft_phys_addr = pos;\n\t\t\t\t\tmemblock_reserve(ibft_phys_addr, PAGE_ALIGN(len));\n\t\t\t\t\tpr_info(\"iBFT found at %pa.\\n\", &ibft_phys_addr);\n\t\t\t\t\tgoto out;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\nout:\n\tearly_memunmap(virt, PAGE_SIZE);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}