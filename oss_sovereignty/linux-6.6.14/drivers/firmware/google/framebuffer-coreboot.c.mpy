{
  "module_name": "framebuffer-coreboot.c",
  "hash_id": "b5f4d679a5baf2afc33459aebb2f5541563df33de8bde20687a3f57a5a27b2b4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/google/framebuffer-coreboot.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/mm.h>\n#include <linux/module.h>\n#include <linux/platform_data/simplefb.h>\n#include <linux/platform_device.h>\n\n#include \"coreboot_table.h\"\n\n#define CB_TAG_FRAMEBUFFER 0x12\n\nstatic const struct simplefb_format formats[] = SIMPLEFB_FORMATS;\n\nstatic int framebuffer_probe(struct coreboot_device *dev)\n{\n\tint i;\n\tu32 length;\n\tstruct lb_framebuffer *fb = &dev->framebuffer;\n\tstruct platform_device *pdev;\n\tstruct resource res;\n\tstruct simplefb_platform_data pdata = {\n\t\t.width = fb->x_resolution,\n\t\t.height = fb->y_resolution,\n\t\t.stride = fb->bytes_per_line,\n\t\t.format = NULL,\n\t};\n\n\tfor (i = 0; i < ARRAY_SIZE(formats); ++i) {\n\t\tif (fb->bits_per_pixel     == formats[i].bits_per_pixel &&\n\t\t    fb->red_mask_pos       == formats[i].red.offset &&\n\t\t    fb->red_mask_size      == formats[i].red.length &&\n\t\t    fb->green_mask_pos     == formats[i].green.offset &&\n\t\t    fb->green_mask_size    == formats[i].green.length &&\n\t\t    fb->blue_mask_pos      == formats[i].blue.offset &&\n\t\t    fb->blue_mask_size     == formats[i].blue.length)\n\t\t\tpdata.format = formats[i].name;\n\t}\n\tif (!pdata.format)\n\t\treturn -ENODEV;\n\n\tmemset(&res, 0, sizeof(res));\n\tres.flags = IORESOURCE_MEM | IORESOURCE_BUSY;\n\tres.name = \"Coreboot Framebuffer\";\n\tres.start = fb->physical_address;\n\tlength = PAGE_ALIGN(fb->y_resolution * fb->bytes_per_line);\n\tres.end = res.start + length - 1;\n\tif (res.end <= res.start)\n\t\treturn -EINVAL;\n\n\tpdev = platform_device_register_resndata(&dev->dev,\n\t\t\t\t\t\t \"simple-framebuffer\", 0,\n\t\t\t\t\t\t &res, 1, &pdata,\n\t\t\t\t\t\t sizeof(pdata));\n\tif (IS_ERR(pdev))\n\t\tpr_warn(\"coreboot: could not register framebuffer\\n\");\n\telse\n\t\tdev_set_drvdata(&dev->dev, pdev);\n\n\treturn PTR_ERR_OR_ZERO(pdev);\n}\n\nstatic void framebuffer_remove(struct coreboot_device *dev)\n{\n\tstruct platform_device *pdev = dev_get_drvdata(&dev->dev);\n\n\tplatform_device_unregister(pdev);\n}\n\nstatic struct coreboot_driver framebuffer_driver = {\n\t.probe = framebuffer_probe,\n\t.remove = framebuffer_remove,\n\t.drv = {\n\t\t.name = \"framebuffer\",\n\t},\n\t.tag = CB_TAG_FRAMEBUFFER,\n};\nmodule_coreboot_driver(framebuffer_driver);\n\nMODULE_AUTHOR(\"Samuel Holland <samuel@sholland.org>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}