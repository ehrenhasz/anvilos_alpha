{
  "module_name": "vpd_decode.c",
  "hash_id": "e71d5d1de6c5b63f046cd0898268e8549e64b1da79c717c965be1fc41b8bb592",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/google/vpd_decode.c",
  "human_readable_source": "\n \n\n#include \"vpd_decode.h\"\n\nstatic int vpd_decode_len(const u32 max_len, const u8 *in,\n\t\t\t  u32 *length, u32 *decoded_len)\n{\n\tu8 more;\n\tint i = 0;\n\n\tif (!length || !decoded_len)\n\t\treturn VPD_FAIL;\n\n\t*length = 0;\n\tdo {\n\t\tif (i >= max_len)\n\t\t\treturn VPD_FAIL;\n\n\t\tmore = in[i] & 0x80;\n\t\t*length <<= 7;\n\t\t*length |= in[i] & 0x7f;\n\t\t++i;\n\t} while (more);\n\n\t*decoded_len = i;\n\treturn VPD_OK;\n}\n\nstatic int vpd_decode_entry(const u32 max_len, const u8 *input_buf,\n\t\t\t    u32 *_consumed, const u8 **entry, u32 *entry_len)\n{\n\tu32 decoded_len;\n\tu32 consumed = *_consumed;\n\n\tif (vpd_decode_len(max_len - consumed, &input_buf[consumed],\n\t\t\t   entry_len, &decoded_len) != VPD_OK)\n\t\treturn VPD_FAIL;\n\tif (max_len - consumed < decoded_len)\n\t\treturn VPD_FAIL;\n\n\tconsumed += decoded_len;\n\t*entry = input_buf + consumed;\n\n\t \n\tif (max_len - consumed < *entry_len)\n\t\treturn VPD_FAIL;\n\n\tconsumed += *entry_len;\n\t*_consumed = consumed;\n\treturn VPD_OK;\n}\n\nint vpd_decode_string(const u32 max_len, const u8 *input_buf, u32 *consumed,\n\t\t      vpd_decode_callback callback, void *callback_arg)\n{\n\tint type;\n\tu32 key_len;\n\tu32 value_len;\n\tconst u8 *key;\n\tconst u8 *value;\n\n\t \n\tif (*consumed >= max_len)\n\t\treturn VPD_FAIL;\n\n\ttype = input_buf[*consumed];\n\n\tswitch (type) {\n\tcase VPD_TYPE_INFO:\n\tcase VPD_TYPE_STRING:\n\t\t(*consumed)++;\n\n\t\tif (vpd_decode_entry(max_len, input_buf, consumed, &key,\n\t\t\t\t     &key_len) != VPD_OK)\n\t\t\treturn VPD_FAIL;\n\n\t\tif (vpd_decode_entry(max_len, input_buf, consumed, &value,\n\t\t\t\t     &value_len) != VPD_OK)\n\t\t\treturn VPD_FAIL;\n\n\t\tif (type == VPD_TYPE_STRING)\n\t\t\treturn callback(key, key_len, value, value_len,\n\t\t\t\t\tcallback_arg);\n\t\tbreak;\n\n\tdefault:\n\t\treturn VPD_FAIL;\n\t}\n\n\treturn VPD_OK;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}