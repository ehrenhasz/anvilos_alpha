{
  "module_name": "cbmem.c",
  "hash_id": "f79e43d63e25843fc1a516becbc9e18c6ab9a66ae4f8ad0ac03913b97bb52adc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/google/cbmem.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/kernel.h>\n#include <linux/kobject.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <linux/sysfs.h>\n\n#include \"coreboot_table.h\"\n\nstruct cbmem_entry {\n\tchar *mem_file_buf;\n\tu32 size;\n};\n\nstatic struct cbmem_entry *to_cbmem_entry(struct kobject *kobj)\n{\n\treturn dev_get_drvdata(kobj_to_dev(kobj));\n}\n\nstatic ssize_t mem_read(struct file *filp, struct kobject *kobj,\n\t\t\tstruct bin_attribute *bin_attr, char *buf, loff_t pos,\n\t\t\tsize_t count)\n{\n\tstruct cbmem_entry *entry = to_cbmem_entry(kobj);\n\n\treturn memory_read_from_buffer(buf, count, &pos, entry->mem_file_buf,\n\t\t\t\t       entry->size);\n}\n\nstatic ssize_t mem_write(struct file *filp, struct kobject *kobj,\n\t\t\t struct bin_attribute *bin_attr, char *buf, loff_t pos,\n\t\t\t size_t count)\n{\n\tstruct cbmem_entry *entry = to_cbmem_entry(kobj);\n\n\tif (pos < 0 || pos >= entry->size)\n\t\treturn -EINVAL;\n\tif (count > entry->size - pos)\n\t\tcount = entry->size - pos;\n\n\tmemcpy(entry->mem_file_buf + pos, buf, count);\n\treturn count;\n}\nstatic BIN_ATTR_ADMIN_RW(mem, 0);\n\nstatic ssize_t address_show(struct device *dev, struct device_attribute *attr,\n\t\t\t    char *buf)\n{\n\tstruct coreboot_device *cbdev = dev_to_coreboot_device(dev);\n\n\treturn sysfs_emit(buf, \"0x%llx\\n\", cbdev->cbmem_entry.address);\n}\nstatic DEVICE_ATTR_RO(address);\n\nstatic ssize_t size_show(struct device *dev, struct device_attribute *attr,\n\t\t\t char *buf)\n{\n\tstruct coreboot_device *cbdev = dev_to_coreboot_device(dev);\n\n\treturn sysfs_emit(buf, \"0x%x\\n\", cbdev->cbmem_entry.entry_size);\n}\nstatic DEVICE_ATTR_RO(size);\n\nstatic struct attribute *attrs[] = {\n\t&dev_attr_address.attr,\n\t&dev_attr_size.attr,\n\tNULL,\n};\n\nstatic struct bin_attribute *bin_attrs[] = {\n\t&bin_attr_mem,\n\tNULL,\n};\n\nstatic const struct attribute_group cbmem_entry_group = {\n\t.attrs = attrs,\n\t.bin_attrs = bin_attrs,\n};\n\nstatic const struct attribute_group *dev_groups[] = {\n\t&cbmem_entry_group,\n\tNULL,\n};\n\nstatic int cbmem_entry_probe(struct coreboot_device *dev)\n{\n\tstruct cbmem_entry *entry;\n\n\tentry = devm_kzalloc(&dev->dev, sizeof(*entry), GFP_KERNEL);\n\tif (!entry)\n\t\treturn -ENOMEM;\n\n\tdev_set_drvdata(&dev->dev, entry);\n\tentry->mem_file_buf = devm_memremap(&dev->dev, dev->cbmem_entry.address,\n\t\t\t\t\t    dev->cbmem_entry.entry_size,\n\t\t\t\t\t    MEMREMAP_WB);\n\tif (IS_ERR(entry->mem_file_buf))\n\t\treturn PTR_ERR(entry->mem_file_buf);\n\n\tentry->size = dev->cbmem_entry.entry_size;\n\n\treturn 0;\n}\n\nstatic struct coreboot_driver cbmem_entry_driver = {\n\t.probe = cbmem_entry_probe,\n\t.drv = {\n\t\t.name = \"cbmem\",\n\t\t.owner = THIS_MODULE,\n\t\t.dev_groups = dev_groups,\n\t},\n\t.tag = LB_TAG_CBMEM_ENTRY,\n};\nmodule_coreboot_driver(cbmem_entry_driver);\n\nMODULE_AUTHOR(\"Jack Rosenthal <jrosenth@chromium.org>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}