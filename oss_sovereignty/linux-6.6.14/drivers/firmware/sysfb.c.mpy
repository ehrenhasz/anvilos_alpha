{
  "module_name": "sysfb.c",
  "hash_id": "e89d775aee8630412a79111c22f2dae50646b888b7f0806445e8beb55e712e1a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/sysfb.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/mm.h>\n#include <linux/platform_data/simplefb.h>\n#include <linux/platform_device.h>\n#include <linux/screen_info.h>\n#include <linux/sysfb.h>\n\nstatic struct platform_device *pd;\nstatic DEFINE_MUTEX(disable_lock);\nstatic bool disabled;\n\nstatic bool sysfb_unregister(void)\n{\n\tif (IS_ERR_OR_NULL(pd))\n\t\treturn false;\n\n\tplatform_device_unregister(pd);\n\tpd = NULL;\n\n\treturn true;\n}\n\n \nvoid sysfb_disable(void)\n{\n\tmutex_lock(&disable_lock);\n\tsysfb_unregister();\n\tdisabled = true;\n\tmutex_unlock(&disable_lock);\n}\nEXPORT_SYMBOL_GPL(sysfb_disable);\n\nstatic __init int sysfb_init(void)\n{\n\tstruct screen_info *si = &screen_info;\n\tstruct simplefb_platform_data mode;\n\tconst char *name;\n\tbool compatible;\n\tint ret = 0;\n\n\tmutex_lock(&disable_lock);\n\tif (disabled)\n\t\tgoto unlock_mutex;\n\n\tsysfb_apply_efi_quirks();\n\n\t \n\tcompatible = sysfb_parse_mode(si, &mode);\n\tif (compatible) {\n\t\tpd = sysfb_create_simplefb(si, &mode);\n\t\tif (!IS_ERR(pd))\n\t\t\tgoto unlock_mutex;\n\t}\n\n\t \n\tif (si->orig_video_isVGA == VIDEO_TYPE_EFI)\n\t\tname = \"efi-framebuffer\";\n\telse if (si->orig_video_isVGA == VIDEO_TYPE_VLFB)\n\t\tname = \"vesa-framebuffer\";\n\telse if (si->orig_video_isVGA == VIDEO_TYPE_VGAC)\n\t\tname = \"vga-framebuffer\";\n\telse if (si->orig_video_isVGA == VIDEO_TYPE_EGAC)\n\t\tname = \"ega-framebuffer\";\n\telse\n\t\tname = \"platform-framebuffer\";\n\n\tpd = platform_device_alloc(name, 0);\n\tif (!pd) {\n\t\tret = -ENOMEM;\n\t\tgoto unlock_mutex;\n\t}\n\n\tsysfb_set_efifb_fwnode(pd);\n\n\tret = platform_device_add_data(pd, si, sizeof(*si));\n\tif (ret)\n\t\tgoto err;\n\n\tret = platform_device_add(pd);\n\tif (ret)\n\t\tgoto err;\n\n\tgoto unlock_mutex;\nerr:\n\tplatform_device_put(pd);\nunlock_mutex:\n\tmutex_unlock(&disable_lock);\n\treturn ret;\n}\n\n \nsubsys_initcall_sync(sysfb_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}