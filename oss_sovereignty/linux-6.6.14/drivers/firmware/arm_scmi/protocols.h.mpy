{
  "module_name": "protocols.h",
  "hash_id": "cf498e12ba3c6051a65c47f499940a1dd4d1bb0783d8891f805002ddaff785fb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/arm_scmi/protocols.h",
  "human_readable_source": " \n \n#ifndef _SCMI_PROTOCOLS_H\n#define _SCMI_PROTOCOLS_H\n\n#include <linux/bitfield.h>\n#include <linux/completion.h>\n#include <linux/device.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/hashtable.h>\n#include <linux/list.h>\n#include <linux/module.h>\n#include <linux/refcount.h>\n#include <linux/scmi_protocol.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n\n#include <asm/unaligned.h>\n\n#define PROTOCOL_REV_MINOR_MASK\tGENMASK(15, 0)\n#define PROTOCOL_REV_MAJOR_MASK\tGENMASK(31, 16)\n#define PROTOCOL_REV_MAJOR(x)\t((u16)(FIELD_GET(PROTOCOL_REV_MAJOR_MASK, (x))))\n#define PROTOCOL_REV_MINOR(x)\t((u16)(FIELD_GET(PROTOCOL_REV_MINOR_MASK, (x))))\n\nenum scmi_common_cmd {\n\tPROTOCOL_VERSION = 0x0,\n\tPROTOCOL_ATTRIBUTES = 0x1,\n\tPROTOCOL_MESSAGE_ATTRIBUTES = 0x2,\n};\n\n \nstruct scmi_msg_resp_prot_version {\n\t__le16 minor_version;\n\t__le16 major_version;\n};\n\n \nstruct scmi_msg {\n\tvoid *buf;\n\tsize_t len;\n};\n\n \nstruct scmi_msg_hdr {\n\tu8 id;\n\tu8 protocol_id;\n\tu8 type;\n\tu16 seq;\n\tu32 status;\n\tbool poll_completion;\n};\n\n \nstruct scmi_xfer {\n\tint transfer_id;\n\tstruct scmi_msg_hdr hdr;\n\tstruct scmi_msg tx;\n\tstruct scmi_msg rx;\n\tstruct completion done;\n\tstruct completion *async_done;\n\tbool pending;\n\tstruct hlist_node node;\n\trefcount_t users;\n#define SCMI_XFER_FREE\t\t0\n#define SCMI_XFER_BUSY\t\t1\n\tatomic_t busy;\n#define SCMI_XFER_SENT_OK\t0\n#define SCMI_XFER_RESP_OK\t1\n#define SCMI_XFER_DRESP_OK\t2\n\tint state;\n#define SCMI_XFER_FLAG_IS_RAW\tBIT(0)\n#define SCMI_XFER_IS_RAW(x)\t((x)->flags & SCMI_XFER_FLAG_IS_RAW)\n#define SCMI_XFER_FLAG_CHAN_SET\tBIT(1)\n#define SCMI_XFER_IS_CHAN_SET(x)\t\\\n\t((x)->flags & SCMI_XFER_FLAG_CHAN_SET)\n\tint flags;\n\t \n\tspinlock_t lock;\n\tvoid *priv;\n};\n\nstruct scmi_xfer_ops;\nstruct scmi_proto_helpers_ops;\n\n \nstruct scmi_protocol_handle {\n\tstruct device *dev;\n\tconst struct scmi_xfer_ops *xops;\n\tconst struct scmi_proto_helpers_ops *hops;\n\tint (*set_priv)(const struct scmi_protocol_handle *ph, void *priv);\n\tvoid *(*get_priv)(const struct scmi_protocol_handle *ph);\n};\n\n \nstruct scmi_iterator_state {\n\tunsigned int desc_index;\n\tunsigned int num_returned;\n\tunsigned int num_remaining;\n\tunsigned int max_resources;\n\tunsigned int loop_idx;\n\tsize_t rx_len;\n\tvoid *priv;\n};\n\n \nstruct scmi_iterator_ops {\n\tvoid (*prepare_message)(void *message, unsigned int desc_index,\n\t\t\t\tconst void *priv);\n\tint (*update_state)(struct scmi_iterator_state *st,\n\t\t\t    const void *response, void *priv);\n\tint (*process_response)(const struct scmi_protocol_handle *ph,\n\t\t\t\tconst void *response,\n\t\t\t\tstruct scmi_iterator_state *st, void *priv);\n};\n\nstruct scmi_fc_db_info {\n\tint width;\n\tu64 set;\n\tu64 mask;\n\tvoid __iomem *addr;\n};\n\nstruct scmi_fc_info {\n\tvoid __iomem *set_addr;\n\tvoid __iomem *get_addr;\n\tstruct scmi_fc_db_info *set_db;\n};\n\n \nstruct scmi_proto_helpers_ops {\n\tint (*extended_name_get)(const struct scmi_protocol_handle *ph,\n\t\t\t\t u8 cmd_id, u32 res_id, char *name, size_t len);\n\tvoid *(*iter_response_init)(const struct scmi_protocol_handle *ph,\n\t\t\t\t    struct scmi_iterator_ops *ops,\n\t\t\t\t    unsigned int max_resources, u8 msg_id,\n\t\t\t\t    size_t tx_size, void *priv);\n\tint (*iter_response_run)(void *iter);\n\tvoid (*fastchannel_init)(const struct scmi_protocol_handle *ph,\n\t\t\t\t u8 describe_id, u32 message_id,\n\t\t\t\t u32 valid_size, u32 domain,\n\t\t\t\t void __iomem **p_addr,\n\t\t\t\t struct scmi_fc_db_info **p_db);\n\tvoid (*fastchannel_db_ring)(struct scmi_fc_db_info *db);\n};\n\n \nstruct scmi_xfer_ops {\n\tint (*version_get)(const struct scmi_protocol_handle *ph, u32 *version);\n\tint (*xfer_get_init)(const struct scmi_protocol_handle *ph, u8 msg_id,\n\t\t\t     size_t tx_size, size_t rx_size,\n\t\t\t     struct scmi_xfer **p);\n\tvoid (*reset_rx_to_maxsz)(const struct scmi_protocol_handle *ph,\n\t\t\t\t  struct scmi_xfer *xfer);\n\tint (*do_xfer)(const struct scmi_protocol_handle *ph,\n\t\t       struct scmi_xfer *xfer);\n\tint (*do_xfer_with_response)(const struct scmi_protocol_handle *ph,\n\t\t\t\t     struct scmi_xfer *xfer);\n\tvoid (*xfer_put)(const struct scmi_protocol_handle *ph,\n\t\t\t struct scmi_xfer *xfer);\n};\n\ntypedef int (*scmi_prot_init_ph_fn_t)(const struct scmi_protocol_handle *);\n\n \nstruct scmi_protocol {\n\tconst u8\t\t\t\tid;\n\tstruct module\t\t\t\t*owner;\n\tconst scmi_prot_init_ph_fn_t\t\tinstance_init;\n\tconst scmi_prot_init_ph_fn_t\t\tinstance_deinit;\n\tconst void\t\t\t\t*ops;\n\tconst struct scmi_protocol_events\t*events;\n};\n\n#define DEFINE_SCMI_PROTOCOL_REGISTER_UNREGISTER(name, proto)\t\\\nstatic const struct scmi_protocol *__this_proto = &(proto);\t\\\n\t\t\t\t\t\t\t\t\\\nint __init scmi_##name##_register(void)\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\\\n\treturn scmi_protocol_register(__this_proto);\t\t\\\n}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\\\nvoid __exit scmi_##name##_unregister(void)\t\t\t\\\n{\t\t\t\t\t\t\t\t\\\n\tscmi_protocol_unregister(__this_proto);\t\t\t\\\n}\n\n#define DECLARE_SCMI_REGISTER_UNREGISTER(func)\t\t\\\n\tint __init scmi_##func##_register(void);\t\\\n\tvoid __exit scmi_##func##_unregister(void)\nDECLARE_SCMI_REGISTER_UNREGISTER(base);\nDECLARE_SCMI_REGISTER_UNREGISTER(clock);\nDECLARE_SCMI_REGISTER_UNREGISTER(perf);\nDECLARE_SCMI_REGISTER_UNREGISTER(power);\nDECLARE_SCMI_REGISTER_UNREGISTER(reset);\nDECLARE_SCMI_REGISTER_UNREGISTER(sensors);\nDECLARE_SCMI_REGISTER_UNREGISTER(voltage);\nDECLARE_SCMI_REGISTER_UNREGISTER(system);\nDECLARE_SCMI_REGISTER_UNREGISTER(powercap);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}