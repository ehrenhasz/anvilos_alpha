{
  "module_name": "soc_id.c",
  "hash_id": "3c1afef07bcbf60c9771bf98c813eca08a48a8f5fa7272a42b90a130f9e84b6d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/firmware/smccc/soc_id.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"SMCCC: SOC_ID: \" fmt\n\n#include <linux/arm-smccc.h>\n#include <linux/bitfield.h>\n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/sys_soc.h>\n\n#define SMCCC_SOC_ID_JEP106_BANK_IDX_MASK\tGENMASK(30, 24)\n \n#define SMCCC_SOC_ID_JEP106_ID_CODE_MASK\tGENMASK(22, 16)\n#define SMCCC_SOC_ID_IMP_DEF_SOC_ID_MASK\tGENMASK(15, 0)\n\n#define JEP106_BANK_CONT_CODE(x)\t\\\n\t(u8)(FIELD_GET(SMCCC_SOC_ID_JEP106_BANK_IDX_MASK, (x)))\n#define JEP106_ID_CODE(x)\t\\\n\t(u8)(FIELD_GET(SMCCC_SOC_ID_JEP106_ID_CODE_MASK, (x)))\n#define IMP_DEF_SOC_ID(x)\t\\\n\t(u16)(FIELD_GET(SMCCC_SOC_ID_IMP_DEF_SOC_ID_MASK, (x)))\n\nstatic struct soc_device *soc_dev;\nstatic struct soc_device_attribute *soc_dev_attr;\n\nstatic int __init smccc_soc_init(void)\n{\n\tint soc_id_rev, soc_id_version;\n\tstatic char soc_id_str[20], soc_id_rev_str[12];\n\tstatic char soc_id_jep106_id_str[12];\n\n\tif (arm_smccc_get_version() < ARM_SMCCC_VERSION_1_2)\n\t\treturn 0;\n\n\tsoc_id_version = arm_smccc_get_soc_id_version();\n\tif (soc_id_version == SMCCC_RET_NOT_SUPPORTED) {\n\t\tpr_info(\"ARCH_SOC_ID not implemented, skipping ....\\n\");\n\t\treturn 0;\n\t}\n\n\tif (soc_id_version < 0) {\n\t\tpr_err(\"Invalid SoC Version: %x\\n\", soc_id_version);\n\t\treturn -EINVAL;\n\t}\n\n\tsoc_id_rev = arm_smccc_get_soc_id_revision();\n\tif (soc_id_rev < 0) {\n\t\tpr_err(\"Invalid SoC Revision: %x\\n\", soc_id_rev);\n\t\treturn -EINVAL;\n\t}\n\n\tsoc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);\n\tif (!soc_dev_attr)\n\t\treturn -ENOMEM;\n\n\tsprintf(soc_id_rev_str, \"0x%08x\", soc_id_rev);\n\tsprintf(soc_id_jep106_id_str, \"jep106:%02x%02x\",\n\t\tJEP106_BANK_CONT_CODE(soc_id_version),\n\t\tJEP106_ID_CODE(soc_id_version));\n\tsprintf(soc_id_str, \"%s:%04x\", soc_id_jep106_id_str,\n\t\tIMP_DEF_SOC_ID(soc_id_version));\n\n\tsoc_dev_attr->soc_id = soc_id_str;\n\tsoc_dev_attr->revision = soc_id_rev_str;\n\tsoc_dev_attr->family = soc_id_jep106_id_str;\n\n\tsoc_dev = soc_device_register(soc_dev_attr);\n\tif (IS_ERR(soc_dev)) {\n\t\tkfree(soc_dev_attr);\n\t\treturn PTR_ERR(soc_dev);\n\t}\n\n\tpr_info(\"ID = %s Revision = %s\\n\", soc_dev_attr->soc_id,\n\t\tsoc_dev_attr->revision);\n\n\treturn 0;\n}\nmodule_init(smccc_soc_init);\n\nstatic void __exit smccc_soc_exit(void)\n{\n\tif (soc_dev)\n\t\tsoc_device_unregister(soc_dev);\n\tkfree(soc_dev_attr);\n}\nmodule_exit(smccc_soc_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}