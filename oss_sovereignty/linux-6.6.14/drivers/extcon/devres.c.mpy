{
  "module_name": "devres.c",
  "hash_id": "403721fa5745764cde657f51a8b9bc57587e539e4f103e68fe3179b15c4aad20",
  "original_prompt": "Ingested from linux-6.6.14/drivers/extcon/devres.c",
  "human_readable_source": "\n \n\n#include \"extcon.h\"\n\nstatic int devm_extcon_dev_match(struct device *dev, void *res, void *data)\n{\n\tstruct extcon_dev **r = res;\n\n\tif (WARN_ON(!r || !*r))\n\t\treturn 0;\n\n\treturn *r == data;\n}\n\nstatic void devm_extcon_dev_release(struct device *dev, void *res)\n{\n\textcon_dev_free(*(struct extcon_dev **)res);\n}\n\n\nstatic void devm_extcon_dev_unreg(struct device *dev, void *res)\n{\n\textcon_dev_unregister(*(struct extcon_dev **)res);\n}\n\nstruct extcon_dev_notifier_devres {\n\tstruct extcon_dev *edev;\n\tunsigned int id;\n\tstruct notifier_block *nb;\n};\n\nstatic void devm_extcon_dev_notifier_unreg(struct device *dev, void *res)\n{\n\tstruct extcon_dev_notifier_devres *this = res;\n\n\textcon_unregister_notifier(this->edev, this->id, this->nb);\n}\n\nstatic void devm_extcon_dev_notifier_all_unreg(struct device *dev, void *res)\n{\n\tstruct extcon_dev_notifier_devres *this = res;\n\n\textcon_unregister_notifier_all(this->edev, this->nb);\n}\n\n \nstruct extcon_dev *devm_extcon_dev_allocate(struct device *dev,\n\t\t\t\t\tconst unsigned int *supported_cable)\n{\n\tstruct extcon_dev **ptr, *edev;\n\n\tptr = devres_alloc(devm_extcon_dev_release, sizeof(*ptr), GFP_KERNEL);\n\tif (!ptr)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tedev = extcon_dev_allocate(supported_cable);\n\tif (IS_ERR(edev)) {\n\t\tdevres_free(ptr);\n\t\treturn edev;\n\t}\n\n\tedev->dev.parent = dev;\n\n\t*ptr = edev;\n\tdevres_add(dev, ptr);\n\n\treturn edev;\n}\nEXPORT_SYMBOL_GPL(devm_extcon_dev_allocate);\n\n \nvoid devm_extcon_dev_free(struct device *dev, struct extcon_dev *edev)\n{\n\tWARN_ON(devres_release(dev, devm_extcon_dev_release,\n\t\t\t       devm_extcon_dev_match, edev));\n}\nEXPORT_SYMBOL_GPL(devm_extcon_dev_free);\n\n \nint devm_extcon_dev_register(struct device *dev, struct extcon_dev *edev)\n{\n\tstruct extcon_dev **ptr;\n\tint ret;\n\n\tptr = devres_alloc(devm_extcon_dev_unreg, sizeof(*ptr), GFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\n\tret = extcon_dev_register(edev);\n\tif (ret) {\n\t\tdevres_free(ptr);\n\t\treturn ret;\n\t}\n\n\t*ptr = edev;\n\tdevres_add(dev, ptr);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(devm_extcon_dev_register);\n\n \nvoid devm_extcon_dev_unregister(struct device *dev, struct extcon_dev *edev)\n{\n\tWARN_ON(devres_release(dev, devm_extcon_dev_unreg,\n\t\t\t       devm_extcon_dev_match, edev));\n}\nEXPORT_SYMBOL_GPL(devm_extcon_dev_unregister);\n\n \nint devm_extcon_register_notifier(struct device *dev, struct extcon_dev *edev,\n\t\t\t\tunsigned int id, struct notifier_block *nb)\n{\n\tstruct extcon_dev_notifier_devres *ptr;\n\tint ret;\n\n\tptr = devres_alloc(devm_extcon_dev_notifier_unreg, sizeof(*ptr),\n\t\t\t\tGFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\n\tret = extcon_register_notifier(edev, id, nb);\n\tif (ret) {\n\t\tdevres_free(ptr);\n\t\treturn ret;\n\t}\n\n\tptr->edev = edev;\n\tptr->id = id;\n\tptr->nb = nb;\n\tdevres_add(dev, ptr);\n\n\treturn 0;\n}\nEXPORT_SYMBOL(devm_extcon_register_notifier);\n\n \nvoid devm_extcon_unregister_notifier(struct device *dev,\n\t\t\t\tstruct extcon_dev *edev, unsigned int id,\n\t\t\t\tstruct notifier_block *nb)\n{\n\tWARN_ON(devres_release(dev, devm_extcon_dev_notifier_unreg,\n\t\t\t       devm_extcon_dev_match, edev));\n}\nEXPORT_SYMBOL(devm_extcon_unregister_notifier);\n\n \nint devm_extcon_register_notifier_all(struct device *dev, struct extcon_dev *edev,\n\t\t\t\tstruct notifier_block *nb)\n{\n\tstruct extcon_dev_notifier_devres *ptr;\n\tint ret;\n\n\tptr = devres_alloc(devm_extcon_dev_notifier_all_unreg, sizeof(*ptr),\n\t\t\t\tGFP_KERNEL);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\n\tret = extcon_register_notifier_all(edev, nb);\n\tif (ret) {\n\t\tdevres_free(ptr);\n\t\treturn ret;\n\t}\n\n\tptr->edev = edev;\n\tptr->nb = nb;\n\tdevres_add(dev, ptr);\n\n\treturn 0;\n}\nEXPORT_SYMBOL(devm_extcon_register_notifier_all);\n\n \nvoid devm_extcon_unregister_notifier_all(struct device *dev,\n\t\t\t\tstruct extcon_dev *edev,\n\t\t\t\tstruct notifier_block *nb)\n{\n\tWARN_ON(devres_release(dev, devm_extcon_dev_notifier_all_unreg,\n\t\t\t       devm_extcon_dev_match, edev));\n}\nEXPORT_SYMBOL(devm_extcon_unregister_notifier_all);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}