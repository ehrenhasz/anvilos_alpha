{
  "module_name": "irq-ath79-cpu.c",
  "hash_id": "fa0f2ea18232d4e434e6e5727c4b79601819cb8d2a8d0070cf3129d9d81b63f3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/irqchip/irq-ath79-cpu.c",
  "human_readable_source": "\n \n\n#include <linux/interrupt.h>\n#include <linux/irqchip.h>\n#include <linux/of.h>\n\n#include <asm/irq_cpu.h>\n#include <asm/mach-ath79/ath79.h>\n\n \n\nstatic unsigned irq_wb_chan[8] = {\n\t-1, -1, -1, -1, -1, -1, -1, -1,\n};\n\nasmlinkage void plat_irq_dispatch(void)\n{\n\tunsigned long pending;\n\tint irq;\n\n\tpending = read_c0_status() & read_c0_cause() & ST0_IM;\n\n\tif (!pending) {\n\t\tspurious_interrupt();\n\t\treturn;\n\t}\n\n\tpending >>= CAUSEB_IP;\n\twhile (pending) {\n\t\tirq = fls(pending) - 1;\n\t\tif (irq < ARRAY_SIZE(irq_wb_chan) && irq_wb_chan[irq] != -1)\n\t\t\tath79_ddr_wb_flush(irq_wb_chan[irq]);\n\t\tdo_IRQ(MIPS_CPU_IRQ_BASE + irq);\n\t\tpending &= ~BIT(irq);\n\t}\n}\n\nstatic int __init ar79_cpu_intc_of_init(\n\tstruct device_node *node, struct device_node *parent)\n{\n\tint err, i, count;\n\n\t \n\tcount = of_count_phandle_with_args(\n\t\tnode, \"qca,ddr-wb-channels\", \"#qca,ddr-wb-channel-cells\");\n\n\tfor (i = 0; i < count; i++) {\n\t\tstruct of_phandle_args args;\n\t\tu32 irq = i;\n\n\t\tof_property_read_u32_index(\n\t\t\tnode, \"qca,ddr-wb-channel-interrupts\", i, &irq);\n\t\tif (irq >= ARRAY_SIZE(irq_wb_chan))\n\t\t\tcontinue;\n\n\t\terr = of_parse_phandle_with_args(\n\t\t\tnode, \"qca,ddr-wb-channels\",\n\t\t\t\"#qca,ddr-wb-channel-cells\",\n\t\t\ti, &args);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tirq_wb_chan[irq] = args.args[0];\n\t}\n\n\treturn mips_cpu_irq_of_init(node, parent);\n}\nIRQCHIP_DECLARE(ar79_cpu_intc, \"qca,ar7100-cpu-intc\",\n\t\tar79_cpu_intc_of_init);\n\nvoid __init ath79_cpu_irq_init(unsigned irq_wb_chan2, unsigned irq_wb_chan3)\n{\n\tirq_wb_chan[2] = irq_wb_chan2;\n\tirq_wb_chan[3] = irq_wb_chan3;\n\tmips_cpu_irq_init();\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}