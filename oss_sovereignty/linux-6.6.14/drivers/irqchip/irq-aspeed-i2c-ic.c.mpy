{
  "module_name": "irq-aspeed-i2c-ic.c",
  "hash_id": "c1eef9e2e553cf42e3d4ce74a4ea26f4829515d5f37fc0bed5d21cc24746ce80",
  "original_prompt": "Ingested from linux-6.6.14/drivers/irqchip/irq-aspeed-i2c-ic.c",
  "human_readable_source": "\n \n\n#include <linux/irq.h>\n#include <linux/irqchip.h>\n#include <linux/irqchip/chained_irq.h>\n#include <linux/irqdomain.h>\n#include <linux/of_address.h>\n#include <linux/of_irq.h>\n#include <linux/io.h>\n\n\n#define ASPEED_I2C_IC_NUM_BUS 14\n\nstruct aspeed_i2c_ic {\n\tvoid __iomem\t\t*base;\n\tint\t\t\tparent_irq;\n\tstruct irq_domain\t*irq_domain;\n};\n\n \nstatic void aspeed_i2c_ic_irq_handler(struct irq_desc *desc)\n{\n\tstruct aspeed_i2c_ic *i2c_ic = irq_desc_get_handler_data(desc);\n\tstruct irq_chip *chip = irq_desc_get_chip(desc);\n\tunsigned long bit, status;\n\n\tchained_irq_enter(chip, desc);\n\tstatus = readl(i2c_ic->base);\n\tfor_each_set_bit(bit, &status, ASPEED_I2C_IC_NUM_BUS)\n\t\tgeneric_handle_domain_irq(i2c_ic->irq_domain, bit);\n\n\tchained_irq_exit(chip, desc);\n}\n\n \nstatic int aspeed_i2c_ic_map_irq_domain(struct irq_domain *domain,\n\t\t\t\t\tunsigned int irq, irq_hw_number_t hwirq)\n{\n\tirq_set_chip_and_handler(irq, &dummy_irq_chip, handle_simple_irq);\n\tirq_set_chip_data(irq, domain->host_data);\n\n\treturn 0;\n}\n\nstatic const struct irq_domain_ops aspeed_i2c_ic_irq_domain_ops = {\n\t.map = aspeed_i2c_ic_map_irq_domain,\n};\n\nstatic int __init aspeed_i2c_ic_of_init(struct device_node *node,\n\t\t\t\t\tstruct device_node *parent)\n{\n\tstruct aspeed_i2c_ic *i2c_ic;\n\tint ret = 0;\n\n\ti2c_ic = kzalloc(sizeof(*i2c_ic), GFP_KERNEL);\n\tif (!i2c_ic)\n\t\treturn -ENOMEM;\n\n\ti2c_ic->base = of_iomap(node, 0);\n\tif (!i2c_ic->base) {\n\t\tret = -ENOMEM;\n\t\tgoto err_free_ic;\n\t}\n\n\ti2c_ic->parent_irq = irq_of_parse_and_map(node, 0);\n\tif (!i2c_ic->parent_irq) {\n\t\tret = -EINVAL;\n\t\tgoto err_iounmap;\n\t}\n\n\ti2c_ic->irq_domain = irq_domain_add_linear(node, ASPEED_I2C_IC_NUM_BUS,\n\t\t\t\t\t\t   &aspeed_i2c_ic_irq_domain_ops,\n\t\t\t\t\t\t   NULL);\n\tif (!i2c_ic->irq_domain) {\n\t\tret = -ENOMEM;\n\t\tgoto err_iounmap;\n\t}\n\n\ti2c_ic->irq_domain->name = \"aspeed-i2c-domain\";\n\n\tirq_set_chained_handler_and_data(i2c_ic->parent_irq,\n\t\t\t\t\t aspeed_i2c_ic_irq_handler, i2c_ic);\n\n\tpr_info(\"i2c controller registered, irq %d\\n\", i2c_ic->parent_irq);\n\n\treturn 0;\n\nerr_iounmap:\n\tiounmap(i2c_ic->base);\nerr_free_ic:\n\tkfree(i2c_ic);\n\treturn ret;\n}\n\nIRQCHIP_DECLARE(ast2400_i2c_ic, \"aspeed,ast2400-i2c-ic\", aspeed_i2c_ic_of_init);\nIRQCHIP_DECLARE(ast2500_i2c_ic, \"aspeed,ast2500-i2c-ic\", aspeed_i2c_ic_of_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}