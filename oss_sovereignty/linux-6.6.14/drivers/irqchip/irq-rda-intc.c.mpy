{
  "module_name": "irq-rda-intc.c",
  "hash_id": "b78997d0036366c39dc3c0139e75338b5fe9fb3b0137127899c5d70b9eda43cd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/irqchip/irq-rda-intc.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/interrupt.h>\n#include <linux/irq.h>\n#include <linux/irqchip.h>\n#include <linux/irqdomain.h>\n#include <linux/of_address.h>\n\n#include <asm/exception.h>\n\n#define RDA_INTC_FINALSTATUS\t0x00\n#define RDA_INTC_MASK_SET\t0x08\n#define RDA_INTC_MASK_CLR\t0x0c\n\n#define RDA_IRQ_MASK_ALL\t0xFFFFFFFF\n\n#define RDA_NR_IRQS 32\n\nstatic void __iomem *rda_intc_base;\nstatic struct irq_domain *rda_irq_domain;\n\nstatic void rda_intc_mask_irq(struct irq_data *d)\n{\n\twritel_relaxed(BIT(d->hwirq), rda_intc_base + RDA_INTC_MASK_CLR);\n}\n\nstatic void rda_intc_unmask_irq(struct irq_data *d)\n{\n\twritel_relaxed(BIT(d->hwirq), rda_intc_base + RDA_INTC_MASK_SET);\n}\n\nstatic int rda_intc_set_type(struct irq_data *data, unsigned int flow_type)\n{\n\t \n\tif ((flow_type & (IRQF_TRIGGER_HIGH | IRQF_TRIGGER_LOW)) == flow_type)\n\t\treturn 0;\n\n\treturn -EINVAL;\n}\n\nstatic void __exception_irq_entry rda_handle_irq(struct pt_regs *regs)\n{\n\tu32 stat = readl_relaxed(rda_intc_base + RDA_INTC_FINALSTATUS);\n\tu32 hwirq;\n\n\twhile (stat) {\n\t\thwirq = __fls(stat);\n\t\tgeneric_handle_domain_irq(rda_irq_domain, hwirq);\n\t\tstat &= ~BIT(hwirq);\n\t}\n}\n\nstatic struct irq_chip rda_irq_chip = {\n\t.name\t\t= \"rda-intc\",\n\t.irq_mask\t= rda_intc_mask_irq,\n\t.irq_unmask\t= rda_intc_unmask_irq,\n\t.irq_set_type\t= rda_intc_set_type,\n};\n\nstatic int rda_irq_map(struct irq_domain *d,\n\t\t       unsigned int virq, irq_hw_number_t hw)\n{\n\tirq_set_status_flags(virq, IRQ_LEVEL);\n\tirq_set_chip_and_handler(virq, &rda_irq_chip, handle_level_irq);\n\tirq_set_chip_data(virq, d->host_data);\n\tirq_set_probe(virq);\n\n\treturn 0;\n}\n\nstatic const struct irq_domain_ops rda_irq_domain_ops = {\n\t.map = rda_irq_map,\n\t.xlate = irq_domain_xlate_onecell,\n};\n\nstatic int __init rda8810_intc_init(struct device_node *node,\n\t\t\t\t    struct device_node *parent)\n{\n\trda_intc_base = of_io_request_and_map(node, 0, \"rda-intc\");\n\tif (IS_ERR(rda_intc_base))\n\t\treturn PTR_ERR(rda_intc_base);\n\n\t \n\twritel_relaxed(RDA_IRQ_MASK_ALL, rda_intc_base + RDA_INTC_MASK_CLR);\n\n\trda_irq_domain = irq_domain_create_linear(&node->fwnode, RDA_NR_IRQS,\n\t\t\t\t\t\t  &rda_irq_domain_ops,\n\t\t\t\t\t\t  rda_intc_base);\n\tif (!rda_irq_domain) {\n\t\tiounmap(rda_intc_base);\n\t\treturn -ENOMEM;\n\t}\n\n\tset_handle_irq(rda_handle_irq);\n\n\treturn 0;\n}\n\nIRQCHIP_DECLARE(rda_intc, \"rda,8810pl-intc\", rda8810_intc_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}