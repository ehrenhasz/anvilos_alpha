{
  "module_name": "irq-jcore-aic.c",
  "hash_id": "f52f1bf513ea7817a8a6c7f3743e78a2f776eadbe22978ab1d15509158d91172",
  "original_prompt": "Ingested from linux-6.6.14/drivers/irqchip/irq-jcore-aic.c",
  "human_readable_source": " \n\n#include <linux/irq.h>\n#include <linux/io.h>\n#include <linux/irqchip.h>\n#include <linux/irqdomain.h>\n#include <linux/cpu.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/of_irq.h>\n\n#define JCORE_AIC_MAX_HWIRQ\t127\n#define JCORE_AIC1_MIN_HWIRQ\t16\n#define JCORE_AIC2_MIN_HWIRQ\t64\n\n#define JCORE_AIC1_INTPRI_REG\t8\n\nstatic struct irq_chip jcore_aic;\n\n \n\nstatic void handle_jcore_irq(struct irq_desc *desc)\n{\n\tif (irqd_is_per_cpu(irq_desc_get_irq_data(desc)))\n\t\thandle_percpu_irq(desc);\n\telse\n\t\thandle_simple_irq(desc);\n}\n\nstatic int jcore_aic_irqdomain_map(struct irq_domain *d, unsigned int irq,\n\t\t\t\t   irq_hw_number_t hwirq)\n{\n\tstruct irq_chip *aic = d->host_data;\n\n\tirq_set_chip_and_handler(irq, aic, handle_jcore_irq);\n\n\treturn 0;\n}\n\nstatic const struct irq_domain_ops jcore_aic_irqdomain_ops = {\n\t.map = jcore_aic_irqdomain_map,\n\t.xlate = irq_domain_xlate_onecell,\n};\n\nstatic void noop(struct irq_data *data)\n{\n}\n\nstatic int __init aic_irq_of_init(struct device_node *node,\n\t\t\t\t  struct device_node *parent)\n{\n\tunsigned min_irq = JCORE_AIC2_MIN_HWIRQ;\n\tunsigned dom_sz = JCORE_AIC_MAX_HWIRQ+1;\n\tstruct irq_domain *domain;\n\tint ret;\n\n\tpr_info(\"Initializing J-Core AIC\\n\");\n\n\t \n\tif (of_device_is_compatible(node, \"jcore,aic1\")) {\n\t\tunsigned cpu;\n\n\t\tfor_each_present_cpu(cpu) {\n\t\t\tvoid __iomem *base = of_iomap(node, cpu);\n\n\t\t\tif (!base) {\n\t\t\t\tpr_err(\"Unable to map AIC for cpu %u\\n\", cpu);\n\t\t\t\treturn -ENOMEM;\n\t\t\t}\n\t\t\t__raw_writel(0xffffffff, base + JCORE_AIC1_INTPRI_REG);\n\t\t\tiounmap(base);\n\t\t}\n\t\tmin_irq = JCORE_AIC1_MIN_HWIRQ;\n\t}\n\n\t \n\tjcore_aic.irq_mask = noop;\n\tjcore_aic.irq_unmask = noop;\n\tjcore_aic.name = \"AIC\";\n\n\tret = irq_alloc_descs(-1, min_irq, dom_sz - min_irq,\n\t\t\t      of_node_to_nid(node));\n\n\tif (ret < 0)\n\t\treturn ret;\n\n\tdomain = irq_domain_add_legacy(node, dom_sz - min_irq, min_irq, min_irq,\n\t\t\t\t       &jcore_aic_irqdomain_ops,\n\t\t\t\t       &jcore_aic);\n\tif (!domain)\n\t\treturn -ENOMEM;\n\n\treturn 0;\n}\n\nIRQCHIP_DECLARE(jcore_aic2, \"jcore,aic2\", aic_irq_of_init);\nIRQCHIP_DECLARE(jcore_aic1, \"jcore,aic1\", aic_irq_of_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}