{
  "module_name": "acpi_cmos_rtc.c",
  "hash_id": "9d2afd45f889ddabd497a0cb62767fc1380c86999de9b0221b80e8b3b9ca7741",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpi_cmos_rtc.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"ACPI: \" fmt\n\n#include <linux/acpi.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/mc146818rtc.h>\n\n#include \"internal.h\"\n\nstatic const struct acpi_device_id acpi_cmos_rtc_ids[] = {\n\t{ \"PNP0B00\" },\n\t{ \"PNP0B01\" },\n\t{ \"PNP0B02\" },\n\t{}\n};\n\nstatic acpi_status\nacpi_cmos_rtc_space_handler(u32 function, acpi_physical_address address,\n\t\t      u32 bits, u64 *value64,\n\t\t      void *handler_context, void *region_context)\n{\n\tint i;\n\tu8 *value = (u8 *)value64;\n\n\tif (address > 0xff || !value64)\n\t\treturn AE_BAD_PARAMETER;\n\n\tif (function != ACPI_WRITE && function != ACPI_READ)\n\t\treturn AE_BAD_PARAMETER;\n\n\tspin_lock_irq(&rtc_lock);\n\n\tfor (i = 0; i < DIV_ROUND_UP(bits, 8); ++i, ++address, ++value)\n\t\tif (function == ACPI_READ)\n\t\t\t*value = CMOS_READ(address);\n\t\telse\n\t\t\tCMOS_WRITE(*value, address);\n\n\tspin_unlock_irq(&rtc_lock);\n\n\treturn AE_OK;\n}\n\nint acpi_install_cmos_rtc_space_handler(acpi_handle handle)\n{\n\tacpi_status status;\n\n\tstatus = acpi_install_address_space_handler(handle,\n\t\t\tACPI_ADR_SPACE_CMOS,\n\t\t\t&acpi_cmos_rtc_space_handler,\n\t\t\tNULL, NULL);\n\tif (ACPI_FAILURE(status)) {\n\t\tpr_err(\"Error installing CMOS-RTC region handler\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\treturn 1;\n}\nEXPORT_SYMBOL_GPL(acpi_install_cmos_rtc_space_handler);\n\nvoid acpi_remove_cmos_rtc_space_handler(acpi_handle handle)\n{\n\tif (ACPI_FAILURE(acpi_remove_address_space_handler(handle,\n\t\t\tACPI_ADR_SPACE_CMOS, &acpi_cmos_rtc_space_handler)))\n\t\tpr_err(\"Error removing CMOS-RTC region handler\\n\");\n}\nEXPORT_SYMBOL_GPL(acpi_remove_cmos_rtc_space_handler);\n\nstatic int acpi_cmos_rtc_attach_handler(struct acpi_device *adev, const struct acpi_device_id *id)\n{\n\treturn acpi_install_cmos_rtc_space_handler(adev->handle);\n}\n\nstatic void acpi_cmos_rtc_detach_handler(struct acpi_device *adev)\n{\n\tacpi_remove_cmos_rtc_space_handler(adev->handle);\n}\n\nstatic struct acpi_scan_handler cmos_rtc_handler = {\n\t.ids = acpi_cmos_rtc_ids,\n\t.attach = acpi_cmos_rtc_attach_handler,\n\t.detach = acpi_cmos_rtc_detach_handler,\n};\n\nvoid __init acpi_cmos_rtc_init(void)\n{\n\tacpi_scan_add_handler(&cmos_rtc_handler);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}