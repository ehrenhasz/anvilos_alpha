{
  "module_name": "bgrt.c",
  "hash_id": "1372d9baf372d668e63528a43edaa481799590f78b08ac1d771c97bd9c9fa592",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/bgrt.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/device.h>\n#include <linux/sysfs.h>\n#include <linux/efi-bgrt.h>\n\nstatic void *bgrt_image;\nstatic struct kobject *bgrt_kobj;\n\n#define BGRT_SHOW(_name, _member) \\\n\tstatic ssize_t _name##_show(struct kobject *kobj,\t\t\t\\\n\t\t\t\t    struct kobj_attribute *attr, char *buf)\t\\\n\t{\t\t\t\t\t\t\t\t\t\\\n\t\treturn sysfs_emit(buf, \"%d\\n\", bgrt_tab._member);\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\tstatic struct kobj_attribute bgrt_attr_##_name = __ATTR_RO(_name)\n\nBGRT_SHOW(version, version);\nBGRT_SHOW(status, status);\nBGRT_SHOW(type, image_type);\nBGRT_SHOW(xoffset, image_offset_x);\nBGRT_SHOW(yoffset, image_offset_y);\n\nstatic ssize_t image_read(struct file *file, struct kobject *kobj,\n\t       struct bin_attribute *attr, char *buf, loff_t off, size_t count)\n{\n\tmemcpy(buf, attr->private + off, count);\n\treturn count;\n}\n\nstatic BIN_ATTR_RO(image, 0);\t \n\nstatic struct attribute *bgrt_attributes[] = {\n\t&bgrt_attr_version.attr,\n\t&bgrt_attr_status.attr,\n\t&bgrt_attr_type.attr,\n\t&bgrt_attr_xoffset.attr,\n\t&bgrt_attr_yoffset.attr,\n\tNULL,\n};\n\nstatic struct bin_attribute *bgrt_bin_attributes[] = {\n\t&bin_attr_image,\n\tNULL,\n};\n\nstatic const struct attribute_group bgrt_attribute_group = {\n\t.attrs = bgrt_attributes,\n\t.bin_attrs = bgrt_bin_attributes,\n};\n\nint __init acpi_parse_bgrt(struct acpi_table_header *table)\n{\n\tefi_bgrt_init(table);\n\treturn 0;\n}\n\nstatic int __init bgrt_init(void)\n{\n\tint ret;\n\n\tif (!bgrt_tab.image_address)\n\t\treturn -ENODEV;\n\n\tbgrt_image = memremap(bgrt_tab.image_address, bgrt_image_size,\n\t\t\t      MEMREMAP_WB);\n\tif (!bgrt_image) {\n\t\tpr_notice(\"Ignoring BGRT: failed to map image memory\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tbin_attr_image.private = bgrt_image;\n\tbin_attr_image.size = bgrt_image_size;\n\n\tbgrt_kobj = kobject_create_and_add(\"bgrt\", acpi_kobj);\n\tif (!bgrt_kobj) {\n\t\tret = -EINVAL;\n\t\tgoto out_memmap;\n\t}\n\n\tret = sysfs_create_group(bgrt_kobj, &bgrt_attribute_group);\n\tif (ret)\n\t\tgoto out_kobject;\n\n\treturn 0;\n\nout_kobject:\n\tkobject_put(bgrt_kobj);\nout_memmap:\n\tmemunmap(bgrt_image);\n\treturn ret;\n}\ndevice_initcall(bgrt_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}