{
  "module_name": "custom_method.c",
  "hash_id": "6524c502daf14b634daa66b4559d210c340c1c140784092161b90ca662afde4b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/custom_method.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/uaccess.h>\n#include <linux/debugfs.h>\n#include <linux/acpi.h>\n#include <linux/security.h>\n\n#include \"internal.h\"\n\nMODULE_LICENSE(\"GPL\");\n\nstatic struct dentry *cm_dentry;\n\n \n\nstatic ssize_t cm_write(struct file *file, const char __user *user_buf,\n\t\t\tsize_t count, loff_t *ppos)\n{\n\tstatic char *buf;\n\tstatic u32 max_size;\n\tstatic u32 uncopied_bytes;\n\n\tstruct acpi_table_header table;\n\tacpi_status status;\n\tint ret;\n\n\tret = security_locked_down(LOCKDOWN_ACPI_TABLES);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!(*ppos)) {\n\t\t \n\t\tif (count <= sizeof(struct acpi_table_header))\n\t\t\treturn -EINVAL;\n\t\tif (copy_from_user(&table, user_buf,\n\t\t\t\t   sizeof(struct acpi_table_header)))\n\t\t\treturn -EFAULT;\n\t\tuncopied_bytes = max_size = table.length;\n\t\t \n\t\tkfree(buf);\n\t\tbuf = kzalloc(max_size, GFP_KERNEL);\n\t\tif (!buf)\n\t\t\treturn -ENOMEM;\n\t}\n\n\tif (buf == NULL)\n\t\treturn -EINVAL;\n\n\tif ((*ppos > max_size) ||\n\t    (*ppos + count > max_size) ||\n\t    (*ppos + count < count) ||\n\t    (count > uncopied_bytes)) {\n\t\tkfree(buf);\n\t\tbuf = NULL;\n\t\treturn -EINVAL;\n\t}\n\n\tif (copy_from_user(buf + (*ppos), user_buf, count)) {\n\t\tkfree(buf);\n\t\tbuf = NULL;\n\t\treturn -EFAULT;\n\t}\n\n\tuncopied_bytes -= count;\n\t*ppos += count;\n\n\tif (!uncopied_bytes) {\n\t\tstatus = acpi_install_method(buf);\n\t\tkfree(buf);\n\t\tbuf = NULL;\n\t\tif (ACPI_FAILURE(status))\n\t\t\treturn -EINVAL;\n\t\tadd_taint(TAINT_OVERRIDDEN_ACPI_TABLE, LOCKDEP_NOW_UNRELIABLE);\n\t}\n\n\treturn count;\n}\n\nstatic const struct file_operations cm_fops = {\n\t.write = cm_write,\n\t.llseek = default_llseek,\n};\n\nstatic int __init acpi_custom_method_init(void)\n{\n\tcm_dentry = debugfs_create_file(\"custom_method\", S_IWUSR,\n\t\t\t\t\tacpi_debugfs_dir, NULL, &cm_fops);\n\treturn 0;\n}\n\nstatic void __exit acpi_custom_method_exit(void)\n{\n\tdebugfs_remove(cm_dentry);\n}\n\nmodule_init(acpi_custom_method_init);\nmodule_exit(acpi_custom_method_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}