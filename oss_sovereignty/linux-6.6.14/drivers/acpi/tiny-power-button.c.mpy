{
  "module_name": "tiny-power-button.c",
  "hash_id": "cfc9a53859e991b09d2eb11644660478342968025a8cf3f73e84d4cfc51880bc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/tiny-power-button.c",
  "human_readable_source": "\n#include <linux/module.h>\n#include <linux/sched/signal.h>\n#include <linux/acpi.h>\n#include <acpi/button.h>\n\nMODULE_AUTHOR(\"Josh Triplett\");\nMODULE_DESCRIPTION(\"ACPI Tiny Power Button Driver\");\nMODULE_LICENSE(\"GPL\");\n\nstatic int power_signal __read_mostly = CONFIG_ACPI_TINY_POWER_BUTTON_SIGNAL;\nmodule_param(power_signal, int, 0644);\nMODULE_PARM_DESC(power_signal, \"Power button sends this signal to init\");\n\nstatic const struct acpi_device_id tiny_power_button_device_ids[] = {\n\t{ ACPI_BUTTON_HID_POWER, 0 },\n\t{ ACPI_BUTTON_HID_POWERF, 0 },\n\t{ \"\", 0 },\n};\nMODULE_DEVICE_TABLE(acpi, tiny_power_button_device_ids);\n\nstatic void acpi_tiny_power_button_notify(acpi_handle handle, u32 event, void *data)\n{\n\tkill_cad_pid(power_signal, 1);\n}\n\nstatic void acpi_tiny_power_button_notify_run(void *not_used)\n{\n\tacpi_tiny_power_button_notify(NULL, ACPI_FIXED_HARDWARE_EVENT, NULL);\n}\n\nstatic u32 acpi_tiny_power_button_event(void *not_used)\n{\n\tacpi_os_execute(OSL_NOTIFY_HANDLER, acpi_tiny_power_button_notify_run, NULL);\n\treturn ACPI_INTERRUPT_HANDLED;\n}\n\nstatic int acpi_tiny_power_button_add(struct acpi_device *device)\n{\n\tacpi_status status;\n\n\tif (device->device_type == ACPI_BUS_TYPE_POWER_BUTTON) {\n\t\tstatus = acpi_install_fixed_event_handler(ACPI_EVENT_POWER_BUTTON,\n\t\t\t\t\t\t\t  acpi_tiny_power_button_event,\n\t\t\t\t\t\t\t  NULL);\n\t} else {\n\t\tstatus = acpi_install_notify_handler(device->handle,\n\t\t\t\t\t\t     ACPI_DEVICE_NOTIFY,\n\t\t\t\t\t\t     acpi_tiny_power_button_notify,\n\t\t\t\t\t\t     NULL);\n\t}\n\tif (ACPI_FAILURE(status))\n\t\treturn -ENODEV;\n\n\treturn 0;\n}\n\nstatic void acpi_tiny_power_button_remove(struct acpi_device *device)\n{\n\tif (device->device_type == ACPI_BUS_TYPE_POWER_BUTTON) {\n\t\tacpi_remove_fixed_event_handler(ACPI_EVENT_POWER_BUTTON,\n\t\t\t\t\t\tacpi_tiny_power_button_event);\n\t} else {\n\t\tacpi_remove_notify_handler(device->handle, ACPI_DEVICE_NOTIFY,\n\t\t\t\t\t   acpi_tiny_power_button_notify);\n\t}\n\tacpi_os_wait_events_complete();\n}\n\nstatic struct acpi_driver acpi_tiny_power_button_driver = {\n\t.name = \"tiny-power-button\",\n\t.class = \"tiny-power-button\",\n\t.ids = tiny_power_button_device_ids,\n\t.ops = {\n\t\t.add = acpi_tiny_power_button_add,\n\t\t.remove = acpi_tiny_power_button_remove,\n\t},\n};\n\nmodule_acpi_driver(acpi_tiny_power_button_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}