{
  "module_name": "osi.c",
  "hash_id": "8fe24408df0ec21ae1f7255e60a08b3b36b3ae3268b1eb7bb663c915a3c04dea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/osi.c",
  "human_readable_source": "\n \n\n \n \n#define pr_fmt(fmt) \"ACPI: \" fmt\n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/acpi.h>\n#include <linux/dmi.h>\n#include <linux/platform_data/x86/apple.h>\n\n#include \"internal.h\"\n\n\n#define OSI_STRING_LENGTH_MAX\t64\n#define OSI_STRING_ENTRIES_MAX\t16\n\nstruct acpi_osi_entry {\n\tchar string[OSI_STRING_LENGTH_MAX];\n\tbool enable;\n};\n\nstatic struct acpi_osi_config {\n\tu8\t\tdefault_disabling;\n\tunsigned int\tlinux_enable:1;\n\tunsigned int\tlinux_dmi:1;\n\tunsigned int\tlinux_cmdline:1;\n\tunsigned int\tdarwin_enable:1;\n\tunsigned int\tdarwin_dmi:1;\n\tunsigned int\tdarwin_cmdline:1;\n} osi_config;\n\nstatic struct acpi_osi_config osi_config;\nstatic struct acpi_osi_entry\nosi_setup_entries[OSI_STRING_ENTRIES_MAX] __initdata = {\n\t{\"Module Device\", true},\n\t{\"Processor Device\", true},\n\t{\"3.0 _SCP Extensions\", true},\n\t{\"Processor Aggregator Device\", true},\n};\n\nstatic u32 acpi_osi_handler(acpi_string interface, u32 supported)\n{\n\tif (!strcmp(\"Linux\", interface)) {\n\t\tpr_notice_once(FW_BUG\n\t\t\t\"BIOS _OSI(Linux) query %s%s\\n\",\n\t\t\tosi_config.linux_enable ? \"honored\" : \"ignored\",\n\t\t\tosi_config.linux_cmdline ? \" via cmdline\" :\n\t\t\tosi_config.linux_dmi ? \" via DMI\" : \"\");\n\t}\n\tif (!strcmp(\"Darwin\", interface)) {\n\t\tpr_notice_once(\n\t\t\t\"BIOS _OSI(Darwin) query %s%s\\n\",\n\t\t\tosi_config.darwin_enable ? \"honored\" : \"ignored\",\n\t\t\tosi_config.darwin_cmdline ? \" via cmdline\" :\n\t\t\tosi_config.darwin_dmi ? \" via DMI\" : \"\");\n\t}\n\n\treturn supported;\n}\n\nvoid __init acpi_osi_setup(char *str)\n{\n\tstruct acpi_osi_entry *osi;\n\tbool enable = true;\n\tint i;\n\n\tif (!acpi_gbl_create_osi_method)\n\t\treturn;\n\n\tif (str == NULL || *str == '\\0') {\n\t\tpr_info(\"_OSI method disabled\\n\");\n\t\tacpi_gbl_create_osi_method = FALSE;\n\t\treturn;\n\t}\n\n\tif (*str == '!') {\n\t\tstr++;\n\t\tif (*str == '\\0') {\n\t\t\t \n\t\t\tif (!osi_config.default_disabling)\n\t\t\t\tosi_config.default_disabling =\n\t\t\t\t\tACPI_DISABLE_ALL_VENDOR_STRINGS;\n\t\t\treturn;\n\t\t} else if (*str == '*') {\n\t\t\tosi_config.default_disabling = ACPI_DISABLE_ALL_STRINGS;\n\t\t\tfor (i = 0; i < OSI_STRING_ENTRIES_MAX; i++) {\n\t\t\t\tosi = &osi_setup_entries[i];\n\t\t\t\tosi->enable = false;\n\t\t\t}\n\t\t\treturn;\n\t\t} else if (*str == '!') {\n\t\t\tosi_config.default_disabling = 0;\n\t\t\treturn;\n\t\t}\n\t\tenable = false;\n\t}\n\n\tfor (i = 0; i < OSI_STRING_ENTRIES_MAX; i++) {\n\t\tosi = &osi_setup_entries[i];\n\t\tif (!strcmp(osi->string, str)) {\n\t\t\tosi->enable = enable;\n\t\t\tbreak;\n\t\t} else if (osi->string[0] == '\\0') {\n\t\t\tosi->enable = enable;\n\t\t\tstrncpy(osi->string, str, OSI_STRING_LENGTH_MAX);\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic void __init __acpi_osi_setup_darwin(bool enable)\n{\n\tosi_config.darwin_enable = !!enable;\n\tif (enable) {\n\t\tacpi_osi_setup(\"!\");\n\t\tacpi_osi_setup(\"Darwin\");\n\t} else {\n\t\tacpi_osi_setup(\"!!\");\n\t\tacpi_osi_setup(\"!Darwin\");\n\t}\n}\n\nstatic void __init acpi_osi_setup_darwin(bool enable)\n{\n\t \n\tosi_config.darwin_dmi = 0;\n\tosi_config.darwin_cmdline = 1;\n\t__acpi_osi_setup_darwin(enable);\n}\n\n \nstatic void __init __acpi_osi_setup_linux(bool enable)\n{\n\tosi_config.linux_enable = !!enable;\n\tif (enable)\n\t\tacpi_osi_setup(\"Linux\");\n\telse\n\t\tacpi_osi_setup(\"!Linux\");\n}\n\nstatic void __init acpi_osi_setup_linux(bool enable)\n{\n\t \n\tosi_config.linux_dmi = 0;\n\tosi_config.linux_cmdline = 1;\n\t__acpi_osi_setup_linux(enable);\n}\n\n \nstatic void __init acpi_osi_setup_late(void)\n{\n\tstruct acpi_osi_entry *osi;\n\tchar *str;\n\tint i;\n\tacpi_status status;\n\n\tif (osi_config.default_disabling) {\n\t\tstatus = acpi_update_interfaces(osi_config.default_disabling);\n\t\tif (ACPI_SUCCESS(status))\n\t\t\tpr_info(\"Disabled all _OSI OS vendors%s\\n\",\n\t\t\t\tosi_config.default_disabling ==\n\t\t\t\tACPI_DISABLE_ALL_STRINGS ?\n\t\t\t\t\" and feature groups\" : \"\");\n\t}\n\n\tfor (i = 0; i < OSI_STRING_ENTRIES_MAX; i++) {\n\t\tosi = &osi_setup_entries[i];\n\t\tstr = osi->string;\n\t\tif (*str == '\\0')\n\t\t\tbreak;\n\t\tif (osi->enable) {\n\t\t\tstatus = acpi_install_interface(str);\n\t\t\tif (ACPI_SUCCESS(status))\n\t\t\t\tpr_info(\"Added _OSI(%s)\\n\", str);\n\t\t} else {\n\t\t\tstatus = acpi_remove_interface(str);\n\t\t\tif (ACPI_SUCCESS(status))\n\t\t\t\tpr_info(\"Deleted _OSI(%s)\\n\", str);\n\t\t}\n\t}\n}\n\nstatic int __init osi_setup(char *str)\n{\n\tif (str && !strcmp(\"Linux\", str))\n\t\tacpi_osi_setup_linux(true);\n\telse if (str && !strcmp(\"!Linux\", str))\n\t\tacpi_osi_setup_linux(false);\n\telse if (str && !strcmp(\"Darwin\", str))\n\t\tacpi_osi_setup_darwin(true);\n\telse if (str && !strcmp(\"!Darwin\", str))\n\t\tacpi_osi_setup_darwin(false);\n\telse\n\t\tacpi_osi_setup(str);\n\n\treturn 1;\n}\n__setup(\"acpi_osi=\", osi_setup);\n\nbool acpi_osi_is_win8(void)\n{\n\treturn acpi_gbl_osi_data >= ACPI_OSI_WIN_8;\n}\nEXPORT_SYMBOL(acpi_osi_is_win8);\n\nstatic void __init acpi_osi_dmi_darwin(void)\n{\n\tpr_notice(\"DMI detected to setup _OSI(\\\"Darwin\\\"): Apple hardware\\n\");\n\tosi_config.darwin_dmi = 1;\n\t__acpi_osi_setup_darwin(true);\n}\n\nstatic void __init acpi_osi_dmi_linux(bool enable,\n\t\t\t\t      const struct dmi_system_id *d)\n{\n\tpr_notice(\"DMI detected to setup _OSI(\\\"Linux\\\"): %s\\n\", d->ident);\n\tosi_config.linux_dmi = 1;\n\t__acpi_osi_setup_linux(enable);\n}\n\nstatic int __init dmi_enable_osi_linux(const struct dmi_system_id *d)\n{\n\tacpi_osi_dmi_linux(true, d);\n\n\treturn 0;\n}\n\nstatic int __init dmi_disable_osi_vista(const struct dmi_system_id *d)\n{\n\tpr_notice(\"DMI detected: %s\\n\", d->ident);\n\tacpi_osi_setup(\"!Windows 2006\");\n\tacpi_osi_setup(\"!Windows 2006 SP1\");\n\tacpi_osi_setup(\"!Windows 2006 SP2\");\n\n\treturn 0;\n}\n\nstatic int __init dmi_disable_osi_win7(const struct dmi_system_id *d)\n{\n\tpr_notice(\"DMI detected: %s\\n\", d->ident);\n\tacpi_osi_setup(\"!Windows 2009\");\n\n\treturn 0;\n}\n\nstatic int __init dmi_disable_osi_win8(const struct dmi_system_id *d)\n{\n\tpr_notice(\"DMI detected: %s\\n\", d->ident);\n\tacpi_osi_setup(\"!Windows 2012\");\n\n\treturn 0;\n}\n\n \nstatic const struct dmi_system_id acpi_osi_dmi_table[] __initconst = {\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"Fujitsu Siemens\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"FUJITSU SIEMENS\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"ESPRIMO Mobile V5505\"),\n\t\t},\n\t},\n\t{\n\t \n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"MSI GX723\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"Micro-Star International\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"GX723\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"Sony VGN-NS10J_S\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"VGN-NS10J_S\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"Sony VGN-SR290J\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"VGN-SR290J\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"VGN-NS50B_L\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"VGN-NS50B_L\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"VGN-SR19XN\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"Sony Corporation\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"VGN-SR19XN\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"Toshiba Satellite L355\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"TOSHIBA\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_VERSION, \"Satellite L355\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_win7,\n\t.ident = \"ASUS K50IJ\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer Inc.\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"K50IJ\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"Toshiba P305D\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"TOSHIBA\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"Satellite P305D\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_vista,\n\t.ident = \"Toshiba NB100\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"TOSHIBA\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"NB100\"),\n\t\t},\n\t},\n\n\t \n\t{\n\t.callback = dmi_disable_osi_win8,\n\t.ident = \"Dell Inspiron 7737\",\n\t.matches = {\n\t\t    DMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc.\"),\n\t\t    DMI_MATCH(DMI_PRODUCT_NAME, \"Inspiron 7737\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_win8,\n\t.ident = \"Dell Inspiron 7537\",\n\t.matches = {\n\t\t    DMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc.\"),\n\t\t    DMI_MATCH(DMI_PRODUCT_NAME, \"Inspiron 7537\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_win8,\n\t.ident = \"Dell Inspiron 5437\",\n\t.matches = {\n\t\t    DMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc.\"),\n\t\t    DMI_MATCH(DMI_PRODUCT_NAME, \"Inspiron 5437\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_win8,\n\t.ident = \"Dell Inspiron 3437\",\n\t.matches = {\n\t\t    DMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc.\"),\n\t\t    DMI_MATCH(DMI_PRODUCT_NAME, \"Inspiron 3437\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_win8,\n\t.ident = \"Dell Vostro 3446\",\n\t.matches = {\n\t\t    DMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc.\"),\n\t\t    DMI_MATCH(DMI_PRODUCT_NAME, \"Vostro 3446\"),\n\t\t},\n\t},\n\t{\n\t.callback = dmi_disable_osi_win8,\n\t.ident = \"Dell Vostro 3546\",\n\t.matches = {\n\t\t    DMI_MATCH(DMI_SYS_VENDOR, \"Dell Inc.\"),\n\t\t    DMI_MATCH(DMI_PRODUCT_NAME, \"Vostro 3546\"),\n\t\t},\n\t},\n\n\t \n\n\t \n\t{\n\t.callback = dmi_enable_osi_linux,\n\t.ident = \"Asus EEE PC 1015PX\",\n\t.matches = {\n\t\t     DMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer INC.\"),\n\t\t     DMI_MATCH(DMI_PRODUCT_NAME, \"1015PX\"),\n\t\t},\n\t},\n\t{}\n};\n\nstatic __init void acpi_osi_dmi_blacklisted(void)\n{\n\tdmi_check_system(acpi_osi_dmi_table);\n\n\t \n\tif (x86_apple_machine)\n\t\tacpi_osi_dmi_darwin();\n}\n\nint __init early_acpi_osi_init(void)\n{\n\tacpi_osi_dmi_blacklisted();\n\n\treturn 0;\n}\n\nint __init acpi_osi_init(void)\n{\n\tacpi_install_interface_handler(acpi_osi_handler);\n\tacpi_osi_setup_late();\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}