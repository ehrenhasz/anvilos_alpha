{
  "module_name": "event.c",
  "hash_id": "0d0e2d0befad70e227c6287a072d1693230dd1b50214d1ca07565d4a42899730",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/event.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"ACPI: \" fmt\n\n#include <linux/spinlock.h>\n#include <linux/export.h>\n#include <linux/proc_fs.h>\n#include <linux/init.h>\n#include <linux/poll.h>\n#include <linux/gfp.h>\n#include <linux/acpi.h>\n#include <net/netlink.h>\n#include <net/genetlink.h>\n\n#include \"internal.h\"\n\n \nstatic BLOCKING_NOTIFIER_HEAD(acpi_chain_head);\n\nint acpi_notifier_call_chain(struct acpi_device *dev, u32 type, u32 data)\n{\n\tstruct acpi_bus_event event;\n\n\tstrcpy(event.device_class, dev->pnp.device_class);\n\tstrcpy(event.bus_id, dev->pnp.bus_id);\n\tevent.type = type;\n\tevent.data = data;\n\treturn (blocking_notifier_call_chain(&acpi_chain_head, 0, (void *)&event)\n\t\t\t== NOTIFY_BAD) ? -EINVAL : 0;\n}\nEXPORT_SYMBOL(acpi_notifier_call_chain);\n\nint register_acpi_notifier(struct notifier_block *nb)\n{\n\treturn blocking_notifier_chain_register(&acpi_chain_head, nb);\n}\nEXPORT_SYMBOL(register_acpi_notifier);\n\nint unregister_acpi_notifier(struct notifier_block *nb)\n{\n\treturn blocking_notifier_chain_unregister(&acpi_chain_head, nb);\n}\nEXPORT_SYMBOL(unregister_acpi_notifier);\n\n#ifdef CONFIG_NET\nstatic unsigned int acpi_event_seqnum;\nstruct acpi_genl_event {\n\tacpi_device_class device_class;\n\tchar bus_id[15];\n\tu32 type;\n\tu32 data;\n};\n\n \nenum {\n\tACPI_GENL_ATTR_UNSPEC,\n\tACPI_GENL_ATTR_EVENT,\t \n\t__ACPI_GENL_ATTR_MAX,\n};\n#define ACPI_GENL_ATTR_MAX (__ACPI_GENL_ATTR_MAX - 1)\n\n \nenum {\n\tACPI_GENL_CMD_UNSPEC,\n\tACPI_GENL_CMD_EVENT,\t \n\t__ACPI_GENL_CMD_MAX,\n};\n#define ACPI_GENL_CMD_MAX (__ACPI_GENL_CMD_MAX - 1)\n\n#define ACPI_GENL_FAMILY_NAME\t\t\"acpi_event\"\n#define ACPI_GENL_VERSION\t\t0x01\n#define ACPI_GENL_MCAST_GROUP_NAME \t\"acpi_mc_group\"\n\nstatic const struct genl_multicast_group acpi_event_mcgrps[] = {\n\t{ .name = ACPI_GENL_MCAST_GROUP_NAME, },\n};\n\nstatic struct genl_family acpi_event_genl_family __ro_after_init = {\n\t.module = THIS_MODULE,\n\t.name = ACPI_GENL_FAMILY_NAME,\n\t.version = ACPI_GENL_VERSION,\n\t.maxattr = ACPI_GENL_ATTR_MAX,\n\t.mcgrps = acpi_event_mcgrps,\n\t.n_mcgrps = ARRAY_SIZE(acpi_event_mcgrps),\n};\n\nint acpi_bus_generate_netlink_event(const char *device_class,\n\t\t\t\t      const char *bus_id,\n\t\t\t\t      u8 type, int data)\n{\n\tstruct sk_buff *skb;\n\tstruct nlattr *attr;\n\tstruct acpi_genl_event *event;\n\tvoid *msg_header;\n\tint size;\n\n\t \n\tsize = nla_total_size(sizeof(struct acpi_genl_event)) +\n\t    nla_total_size(0);\n\n\tskb = genlmsg_new(size, GFP_ATOMIC);\n\tif (!skb)\n\t\treturn -ENOMEM;\n\n\t \n\tmsg_header = genlmsg_put(skb, 0, acpi_event_seqnum++,\n\t\t\t\t &acpi_event_genl_family, 0,\n\t\t\t\t ACPI_GENL_CMD_EVENT);\n\tif (!msg_header) {\n\t\tnlmsg_free(skb);\n\t\treturn -ENOMEM;\n\t}\n\n\t \n\tattr =\n\t    nla_reserve(skb, ACPI_GENL_ATTR_EVENT,\n\t\t\tsizeof(struct acpi_genl_event));\n\tif (!attr) {\n\t\tnlmsg_free(skb);\n\t\treturn -EINVAL;\n\t}\n\n\tevent = nla_data(attr);\n\tmemset(event, 0, sizeof(struct acpi_genl_event));\n\n\tstrscpy(event->device_class, device_class, sizeof(event->device_class));\n\tstrscpy(event->bus_id, bus_id, sizeof(event->bus_id));\n\tevent->type = type;\n\tevent->data = data;\n\n\t \n\tgenlmsg_end(skb, msg_header);\n\n\tgenlmsg_multicast(&acpi_event_genl_family, skb, 0, 0, GFP_ATOMIC);\n\treturn 0;\n}\n\nEXPORT_SYMBOL(acpi_bus_generate_netlink_event);\n\nstatic int __init acpi_event_genetlink_init(void)\n{\n\treturn genl_register_family(&acpi_event_genl_family);\n}\n\n#else\nint acpi_bus_generate_netlink_event(const char *device_class,\n\t\t\t\t      const char *bus_id,\n\t\t\t\t      u8 type, int data)\n{\n\treturn 0;\n}\n\nEXPORT_SYMBOL(acpi_bus_generate_netlink_event);\n\nstatic int acpi_event_genetlink_init(void)\n{\n\treturn -ENODEV;\n}\n#endif\n\nstatic int __init acpi_event_init(void)\n{\n\tint error;\n\n\tif (acpi_disabled)\n\t\treturn 0;\n\n\t \n\terror = acpi_event_genetlink_init();\n\tif (error)\n\t\tpr_warn(\"Failed to create genetlink family for ACPI event\\n\");\n\n\treturn 0;\n}\n\nfs_initcall(acpi_event_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}