{
  "module_name": "rhct.c",
  "hash_id": "8d9e8292b80601e5ca2349a2f15bb84d90187f84ddf4934506cd5193581e01c6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/riscv/rhct.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt)     \"ACPI: RHCT: \" fmt\n\n#include <linux/acpi.h>\n\nstatic struct acpi_table_header *acpi_get_rhct(void)\n{\n\tstatic struct acpi_table_header *rhct;\n\tacpi_status status;\n\n\t \n\tif (!rhct) {\n\t\tstatus = acpi_get_table(ACPI_SIG_RHCT, 0, &rhct);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tpr_warn_once(\"No RHCT table found\\n\");\n\t\t\treturn NULL;\n\t\t}\n\t}\n\n\treturn rhct;\n}\n\n \nint acpi_get_riscv_isa(struct acpi_table_header *table, unsigned int cpu, const char **isa)\n{\n\tstruct acpi_rhct_node_header *node, *ref_node, *end;\n\tu32 size_hdr = sizeof(struct acpi_rhct_node_header);\n\tu32 size_hartinfo = sizeof(struct acpi_rhct_hart_info);\n\tstruct acpi_rhct_hart_info *hart_info;\n\tstruct acpi_rhct_isa_string *isa_node;\n\tstruct acpi_table_rhct *rhct;\n\tu32 *hart_info_node_offset;\n\tu32 acpi_cpu_id = get_acpi_id_for_cpu(cpu);\n\n\tBUG_ON(acpi_disabled);\n\n\tif (!table) {\n\t\trhct = (struct acpi_table_rhct *)acpi_get_rhct();\n\t\tif (!rhct)\n\t\t\treturn -ENOENT;\n\t} else {\n\t\trhct = (struct acpi_table_rhct *)table;\n\t}\n\n\tend = ACPI_ADD_PTR(struct acpi_rhct_node_header, rhct, rhct->header.length);\n\n\tfor (node = ACPI_ADD_PTR(struct acpi_rhct_node_header, rhct, rhct->node_offset);\n\t     node < end;\n\t     node = ACPI_ADD_PTR(struct acpi_rhct_node_header, node, node->length)) {\n\t\tif (node->type == ACPI_RHCT_NODE_TYPE_HART_INFO) {\n\t\t\thart_info = ACPI_ADD_PTR(struct acpi_rhct_hart_info, node, size_hdr);\n\t\t\thart_info_node_offset = ACPI_ADD_PTR(u32, hart_info, size_hartinfo);\n\t\t\tif (acpi_cpu_id != hart_info->uid)\n\t\t\t\tcontinue;\n\n\t\t\tfor (int i = 0; i < hart_info->num_offsets; i++) {\n\t\t\t\tref_node = ACPI_ADD_PTR(struct acpi_rhct_node_header,\n\t\t\t\t\t\t\trhct, hart_info_node_offset[i]);\n\t\t\t\tif (ref_node->type == ACPI_RHCT_NODE_TYPE_ISA_STRING) {\n\t\t\t\t\tisa_node = ACPI_ADD_PTR(struct acpi_rhct_isa_string,\n\t\t\t\t\t\t\t\tref_node, size_hdr);\n\t\t\t\t\t*isa = isa_node->isa;\n\t\t\t\t\treturn 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn -1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}