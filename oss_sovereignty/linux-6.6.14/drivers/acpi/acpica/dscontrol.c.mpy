{
  "module_name": "dscontrol.c",
  "hash_id": "811bc2cae746c4a47dcfee1466d6a31196064ad00fb1e24677193eeadb223e70",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dscontrol.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"amlcode.h\"\n#include \"acdispat.h\"\n#include \"acinterp.h\"\n#include \"acdebug.h\"\n\n#define _COMPONENT          ACPI_DISPATCHER\nACPI_MODULE_NAME(\"dscontrol\")\n\n \nacpi_status\nacpi_ds_exec_begin_control_op(struct acpi_walk_state *walk_state,\n\t\t\t      union acpi_parse_object *op)\n{\n\tacpi_status status = AE_OK;\n\tunion acpi_generic_state *control_state;\n\n\tACPI_FUNCTION_NAME(ds_exec_begin_control_op);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH, \"Op=%p Opcode=%2.2X State=%p\\n\",\n\t\t\t  op, op->common.aml_opcode, walk_state));\n\n\tswitch (op->common.aml_opcode) {\n\tcase AML_WHILE_OP:\n\t\t \n\t\tif (walk_state->control_state) {\n\t\t\tif (walk_state->control_state->control.\n\t\t\t    aml_predicate_start ==\n\t\t\t    (walk_state->parser_state.aml - 1)) {\n\n\t\t\t\t \n\n\t\t\t\twalk_state->control_state->common.state =\n\t\t\t\t    ACPI_CONTROL_CONDITIONAL_EXECUTING;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tACPI_FALLTHROUGH;\n\n\tcase AML_IF_OP:\n\t\t \n\t\tcontrol_state = acpi_ut_create_control_state();\n\t\tif (!control_state) {\n\t\t\tstatus = AE_NO_MEMORY;\n\t\t\tbreak;\n\t\t}\n\t\t \n\t\tcontrol_state->control.aml_predicate_start =\n\t\t    walk_state->parser_state.aml - 1;\n\t\tcontrol_state->control.package_end =\n\t\t    walk_state->parser_state.pkg_end;\n\t\tcontrol_state->control.opcode = op->common.aml_opcode;\n\t\tcontrol_state->control.loop_timeout = acpi_os_get_timer() +\n\t\t    ((u64)acpi_gbl_max_loop_iterations * ACPI_100NSEC_PER_SEC);\n\n\t\t \n\n\t\tacpi_ut_push_generic_state(&walk_state->control_state,\n\t\t\t\t\t   control_state);\n\t\tbreak;\n\n\tcase AML_ELSE_OP:\n\n\t\t \n\t\t \n\n\t\tif (walk_state->last_predicate) {\n\t\t\tstatus = AE_CTRL_TRUE;\n\t\t}\n\n\t\tbreak;\n\n\tcase AML_RETURN_OP:\n\n\t\tbreak;\n\n\tdefault:\n\n\t\tbreak;\n\t}\n\n\treturn (status);\n}\n\n \n\nacpi_status\nacpi_ds_exec_end_control_op(struct acpi_walk_state *walk_state,\n\t\t\t    union acpi_parse_object *op)\n{\n\tacpi_status status = AE_OK;\n\tunion acpi_generic_state *control_state;\n\n\tACPI_FUNCTION_NAME(ds_exec_end_control_op);\n\n\tswitch (op->common.aml_opcode) {\n\tcase AML_IF_OP:\n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH, \"[IF_OP] Op=%p\\n\", op));\n\n\t\t \n\t\twalk_state->last_predicate =\n\t\t    (u8)walk_state->control_state->common.value;\n\n\t\t \n\t\tcontrol_state =\n\t\t    acpi_ut_pop_generic_state(&walk_state->control_state);\n\t\tacpi_ut_delete_generic_state(control_state);\n\t\tbreak;\n\n\tcase AML_ELSE_OP:\n\n\t\tbreak;\n\n\tcase AML_WHILE_OP:\n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH, \"[WHILE_OP] Op=%p\\n\", op));\n\n\t\tcontrol_state = walk_state->control_state;\n\t\tif (control_state->common.value) {\n\n\t\t\t \n\n\t\t\t \n\t\t\tif (ACPI_TIME_AFTER(acpi_os_get_timer(),\n\t\t\t\t\t    control_state->control.\n\t\t\t\t\t    loop_timeout)) {\n\t\t\t\tstatus = AE_AML_LOOP_TIMEOUT;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t \n\t\t\tstatus = AE_CTRL_PENDING;\n\t\t\twalk_state->aml_last_while =\n\t\t\t    control_state->control.aml_predicate_start;\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t  \"[WHILE_OP] termination! Op=%p\\n\", op));\n\n\t\t \n\n\t\tcontrol_state =\n\t\t    acpi_ut_pop_generic_state(&walk_state->control_state);\n\t\tacpi_ut_delete_generic_state(control_state);\n\t\tbreak;\n\n\tcase AML_RETURN_OP:\n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t  \"[RETURN_OP] Op=%p Arg=%p\\n\", op,\n\t\t\t\t  op->common.value.arg));\n\n\t\t \n\t\tif (op->common.value.arg) {\n\n\t\t\t \n\n\t\t\tacpi_ds_clear_implicit_return(walk_state);\n\n\t\t\t \n\n\t\t\tstatus =\n\t\t\t    acpi_ds_create_operands(walk_state,\n\t\t\t\t\t\t    op->common.value.arg);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn (status);\n\t\t\t}\n\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ex_resolve_to_value(&walk_state->operands[0],\n\t\t\t\t\t\t     walk_state);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn (status);\n\t\t\t}\n\n\t\t\t \n\t\t\twalk_state->return_desc = walk_state->operands[0];\n\t\t} else if (walk_state->result_count) {\n\n\t\t\t \n\n\t\t\tacpi_ds_clear_implicit_return(walk_state);\n\n\t\t\t \n\t\t\tif ((ACPI_GET_DESCRIPTOR_TYPE\n\t\t\t     (walk_state->results->results.obj_desc[0]) ==\n\t\t\t     ACPI_DESC_TYPE_OPERAND)\n\t\t\t    && ((walk_state->results->results.obj_desc[0])->\n\t\t\t\tcommon.type == ACPI_TYPE_LOCAL_REFERENCE)\n\t\t\t    && ((walk_state->results->results.obj_desc[0])->\n\t\t\t\treference.class != ACPI_REFCLASS_INDEX)) {\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ex_resolve_to_value(&walk_state->\n\t\t\t\t\t\t\t     results->results.\n\t\t\t\t\t\t\t     obj_desc[0],\n\t\t\t\t\t\t\t     walk_state);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn (status);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twalk_state->return_desc =\n\t\t\t    walk_state->results->results.obj_desc[0];\n\t\t} else {\n\t\t\t \n\n\t\t\tif (walk_state->num_operands) {\n\t\t\t\tacpi_ut_remove_reference(walk_state->\n\t\t\t\t\t\t\t operands[0]);\n\t\t\t}\n\n\t\t\twalk_state->operands[0] = NULL;\n\t\t\twalk_state->num_operands = 0;\n\t\t\twalk_state->return_desc = NULL;\n\t\t}\n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t  \"Completed RETURN_OP State=%p, RetVal=%p\\n\",\n\t\t\t\t  walk_state, walk_state->return_desc));\n\n\t\t \n\n\t\tstatus = AE_CTRL_TERMINATE;\n\t\tbreak;\n\n\tcase AML_NOOP_OP:\n\n\t\t \n\n\t\tbreak;\n\n\tcase AML_BREAKPOINT_OP:\n\n\t\tacpi_db_signal_break_point(walk_state);\n\n\t\t \n\n\t\tstatus = acpi_os_signal(ACPI_SIGNAL_BREAKPOINT,\n\t\t\t\t\t\"Executed AML Breakpoint opcode\");\n\t\tbreak;\n\n\tcase AML_BREAK_OP:\n\tcase AML_CONTINUE_OP:\t \n\n\t\t \n\n\t\twhile (walk_state->control_state &&\n\t\t       (walk_state->control_state->control.opcode !=\n\t\t\tAML_WHILE_OP)) {\n\t\t\tcontrol_state =\n\t\t\t    acpi_ut_pop_generic_state(&walk_state->\n\t\t\t\t\t\t      control_state);\n\t\t\tacpi_ut_delete_generic_state(control_state);\n\t\t}\n\n\t\t \n\n\t\tif (!walk_state->control_state) {\n\t\t\treturn (AE_AML_NO_WHILE);\n\t\t}\n\n\t\t \n\n\t\twalk_state->aml_last_while =\n\t\t    walk_state->control_state->control.package_end;\n\n\t\t \n\n\t\tif (op->common.aml_opcode == AML_BREAK_OP) {\n\t\t\tstatus = AE_CTRL_BREAK;\n\t\t} else {\n\t\t\tstatus = AE_CTRL_CONTINUE;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\n\t\tACPI_ERROR((AE_INFO, \"Unknown control opcode=0x%X Op=%p\",\n\t\t\t    op->common.aml_opcode, op));\n\n\t\tstatus = AE_AML_BAD_OPCODE;\n\t\tbreak;\n\t}\n\n\treturn (status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}