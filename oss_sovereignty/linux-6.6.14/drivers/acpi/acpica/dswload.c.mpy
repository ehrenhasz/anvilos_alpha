{
  "module_name": "dswload.c",
  "hash_id": "5f27a40d2c38dd9e1c7d6c22b2efbd1823e3e6cc1ca21fad08157385dbcd11cd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dswload.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acparser.h\"\n#include \"amlcode.h\"\n#include \"acdispat.h\"\n#include \"acinterp.h\"\n#include \"acnamesp.h\"\n#ifdef ACPI_ASL_COMPILER\n#include \"acdisasm.h\"\n#endif\n\n#define _COMPONENT          ACPI_DISPATCHER\nACPI_MODULE_NAME(\"dswload\")\n\n \nacpi_status\nacpi_ds_init_callbacks(struct acpi_walk_state *walk_state, u32 pass_number)\n{\n\n\tswitch (pass_number) {\n\tcase 0:\n\n\t\t \n\n\t\twalk_state->parse_flags = ACPI_PARSE_LOAD_PASS1 |\n\t\t    ACPI_PARSE_DELETE_TREE | ACPI_PARSE_DISASSEMBLE;\n\t\twalk_state->descending_callback = NULL;\n\t\twalk_state->ascending_callback = NULL;\n\t\tbreak;\n\n\tcase 1:\n\n\t\t \n\n\t\twalk_state->parse_flags = ACPI_PARSE_LOAD_PASS1 |\n\t\t    ACPI_PARSE_DELETE_TREE;\n\t\twalk_state->descending_callback = acpi_ds_load1_begin_op;\n\t\twalk_state->ascending_callback = acpi_ds_load1_end_op;\n\t\tbreak;\n\n\tcase 2:\n\n\t\t \n\n\t\twalk_state->parse_flags = ACPI_PARSE_LOAD_PASS1 |\n\t\t    ACPI_PARSE_DELETE_TREE;\n\t\twalk_state->descending_callback = acpi_ds_load2_begin_op;\n\t\twalk_state->ascending_callback = acpi_ds_load2_end_op;\n\t\tbreak;\n\n\tcase 3:\n\n\t\t \n\n\t\twalk_state->parse_flags |= ACPI_PARSE_EXECUTE |\n\t\t    ACPI_PARSE_DELETE_TREE;\n\t\twalk_state->descending_callback = acpi_ds_exec_begin_op;\n\t\twalk_state->ascending_callback = acpi_ds_exec_end_op;\n\t\tbreak;\n\n\tdefault:\n\n\t\treturn (AE_BAD_PARAMETER);\n\t}\n\n\treturn (AE_OK);\n}\n\n \n\nacpi_status\nacpi_ds_load1_begin_op(struct acpi_walk_state *walk_state,\n\t\t       union acpi_parse_object **out_op)\n{\n\tunion acpi_parse_object *op;\n\tstruct acpi_namespace_node *node;\n\tacpi_status status;\n\tacpi_object_type object_type;\n\tchar *path;\n\tu32 flags;\n\n\tACPI_FUNCTION_TRACE_PTR(ds_load1_begin_op, walk_state->op);\n\n\top = walk_state->op;\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH, \"Op=%p State=%p\\n\", op,\n\t\t\t  walk_state));\n\n\t \n\n\tif (op) {\n\t\tif (!(walk_state->op_info->flags & AML_NAMED)) {\n\t\t\t*out_op = op;\n\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t}\n\n\t\t \n\n\t\tif (op->common.node) {\n\t\t\t*out_op = op;\n\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t}\n\t}\n\n\tpath = acpi_ps_get_next_namestring(&walk_state->parser_state);\n\n\t \n\n\tobject_type = walk_state->op_info->object_type;\n\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t  \"State=%p Op=%p [%s]\\n\", walk_state, op,\n\t\t\t  acpi_ut_get_type_name(object_type)));\n\n\tswitch (walk_state->opcode) {\n\tcase AML_SCOPE_OP:\n\t\t \n\t\tstatus =\n\t\t    acpi_ns_lookup(walk_state->scope_info, path, object_type,\n\t\t\t\t   ACPI_IMODE_EXECUTE, ACPI_NS_SEARCH_PARENT,\n\t\t\t\t   walk_state, &(node));\n#ifdef ACPI_ASL_COMPILER\n\t\tif (status == AE_NOT_FOUND) {\n\t\t\t \n\t\t\tacpi_dm_add_op_to_external_list(op, path,\n\t\t\t\t\t\t\tACPI_TYPE_DEVICE, 0, 0);\n\t\t\tstatus =\n\t\t\t    acpi_ns_lookup(walk_state->scope_info, path,\n\t\t\t\t\t   object_type, ACPI_IMODE_LOAD_PASS1,\n\t\t\t\t\t   ACPI_NS_SEARCH_PARENT, walk_state,\n\t\t\t\t\t   &node);\n\t\t}\n#endif\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info, path,\n\t\t\t\t\t     status);\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\t \n\t\tswitch (node->type) {\n\t\tcase ACPI_TYPE_ANY:\n\t\tcase ACPI_TYPE_LOCAL_SCOPE:\t \n\t\tcase ACPI_TYPE_DEVICE:\n\t\tcase ACPI_TYPE_POWER:\n\t\tcase ACPI_TYPE_PROCESSOR:\n\t\tcase ACPI_TYPE_THERMAL:\n\n\t\t\t \n\t\t\tbreak;\n\n\t\tcase ACPI_TYPE_INTEGER:\n\t\tcase ACPI_TYPE_STRING:\n\t\tcase ACPI_TYPE_BUFFER:\n\t\t\t \n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n\t\t\t\t\t  \"Type override - [%4.4s] had invalid type (%s) \"\n\t\t\t\t\t  \"for Scope operator, changed to type ANY\\n\",\n\t\t\t\t\t  acpi_ut_get_node_name(node),\n\t\t\t\t\t  acpi_ut_get_type_name(node->type)));\n\n\t\t\tnode->type = ACPI_TYPE_ANY;\n\t\t\twalk_state->scope_info->common.value = ACPI_TYPE_ANY;\n\t\t\tbreak;\n\n\t\tcase ACPI_TYPE_METHOD:\n\t\t\t \n\t\t\tif ((node == acpi_gbl_root_node) &&\n\t\t\t    (walk_state->\n\t\t\t     parse_flags & ACPI_PARSE_MODULE_LEVEL)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tACPI_FALLTHROUGH;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Invalid type (%s) for target of \"\n\t\t\t\t    \"Scope operator [%4.4s] (Cannot override)\",\n\t\t\t\t    acpi_ut_get_type_name(node->type),\n\t\t\t\t    acpi_ut_get_node_name(node)));\n\n\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\t \n\t\tif (walk_state->deferred_node) {\n\n\t\t\t \n\n\t\t\tnode = walk_state->deferred_node;\n\t\t\tstatus = AE_OK;\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\t\tif (walk_state->method_node) {\n\t\t\tnode = NULL;\n\t\t\tstatus = AE_OK;\n\t\t\tbreak;\n\t\t}\n\n\t\tflags = ACPI_NS_NO_UPSEARCH;\n\t\tif ((walk_state->opcode != AML_SCOPE_OP) &&\n\t\t    (!(walk_state->parse_flags & ACPI_PARSE_DEFERRED_OP))) {\n\t\t\tif (walk_state->namespace_override) {\n\t\t\t\tflags |= ACPI_NS_OVERRIDE_IF_FOUND;\n\t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t\t\t  \"[%s] Override allowed\\n\",\n\t\t\t\t\t\t  acpi_ut_get_type_name\n\t\t\t\t\t\t  (object_type)));\n\t\t\t} else {\n\t\t\t\tflags |= ACPI_NS_ERROR_IF_FOUND;\n\t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t\t\t  \"[%s] Cannot already exist\\n\",\n\t\t\t\t\t\t  acpi_ut_get_type_name\n\t\t\t\t\t\t  (object_type)));\n\t\t\t}\n\t\t} else {\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t\t  \"[%s] Both Find or Create allowed\\n\",\n\t\t\t\t\t  acpi_ut_get_type_name(object_type)));\n\t\t}\n\n\t\t \n\t\tstatus =\n\t\t    acpi_ns_lookup(walk_state->scope_info, path, object_type,\n\t\t\t\t   ACPI_IMODE_LOAD_PASS1, flags, walk_state,\n\t\t\t\t   &node);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tif (status == AE_ALREADY_EXISTS) {\n\n\t\t\t\t \n\n\t\t\t\tif (node->flags & ANOBJ_IS_EXTERNAL) {\n\t\t\t\t\t \n\t\t\t\t\tnode->flags &= ~ANOBJ_IS_EXTERNAL;\n\t\t\t\t\tnode->type = (u8) object_type;\n\n\t\t\t\t\t \n\n\t\t\t\t\tif (acpi_ns_opens_scope(object_type)) {\n\t\t\t\t\t\tstatus =\n\t\t\t\t\t\t    acpi_ds_scope_stack_push\n\t\t\t\t\t\t    (node, object_type,\n\t\t\t\t\t\t     walk_state);\n\t\t\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\t\t\treturn_ACPI_STATUS\n\t\t\t\t\t\t\t    (status);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tstatus = AE_OK;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t\t     path, status);\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t}\n\n\t \n\n\tif (!op) {\n\n\t\t \n\n\t\top = acpi_ps_alloc_op(walk_state->opcode, walk_state->aml);\n\t\tif (!op) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\t}\n\n\t \n\n#ifdef ACPI_CONSTANT_EVAL_ONLY\n\top->named.path = path;\n#endif\n\n\tif (node) {\n\t\t \n\t\top->common.node = node;\n\t\top->named.name = node->name.integer;\n\t}\n\n\tacpi_ps_append_arg(acpi_ps_get_parent_scope(&walk_state->parser_state),\n\t\t\t   op);\n\t*out_op = op;\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status acpi_ds_load1_end_op(struct acpi_walk_state *walk_state)\n{\n\tunion acpi_parse_object *op;\n\tacpi_object_type object_type;\n\tacpi_status status = AE_OK;\n#ifdef ACPI_ASL_COMPILER\n\tu8 param_count;\n#endif\n\n\tACPI_FUNCTION_TRACE(ds_load1_end_op);\n\n\top = walk_state->op;\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH, \"Op=%p State=%p\\n\", op,\n\t\t\t  walk_state));\n\n\t \n\tif ((walk_state->parse_flags & ACPI_PARSE_DISASSEMBLE) &&\n\t    (walk_state->op_info->flags & AML_CREATE)) {\n\t\tstatus = acpi_ds_create_buffer_field(op, walk_state);\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tif (!(walk_state->op_info->flags & (AML_NAMED | AML_FIELD))) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\n\tobject_type = walk_state->op_info->object_type;\n\n\tif (walk_state->op_info->flags & AML_FIELD) {\n\t\t \n\t\tif (!walk_state->method_node) {\n\t\t\tif (walk_state->opcode == AML_FIELD_OP ||\n\t\t\t    walk_state->opcode == AML_BANK_FIELD_OP ||\n\t\t\t    walk_state->opcode == AML_INDEX_FIELD_OP) {\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ds_init_field_objects(op, walk_state);\n\t\t\t}\n\t\t}\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\tif (!walk_state->method_node) {\n\t\tif (op->common.aml_opcode == AML_REGION_OP) {\n\t\t\tstatus =\n\t\t\t    acpi_ex_create_region(op->named.data,\n\t\t\t\t\t\t  op->named.length,\n\t\t\t\t\t\t  (acpi_adr_space_type)\n\t\t\t\t\t\t  ((op->common.value.arg)->\n\t\t\t\t\t\t   common.value.integer),\n\t\t\t\t\t\t  walk_state);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t} else if (op->common.aml_opcode == AML_DATA_REGION_OP) {\n\t\t\tstatus =\n\t\t\t    acpi_ex_create_region(op->named.data,\n\t\t\t\t\t\t  op->named.length,\n\t\t\t\t\t\t  ACPI_ADR_SPACE_DATA_TABLE,\n\t\t\t\t\t\t  walk_state);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (op->common.aml_opcode == AML_NAME_OP) {\n\n\t\t \n\n\t\tif (op->common.value.arg) {\n\t\t\tobject_type = (acpi_ps_get_opcode_info((op->common.\n\t\t\t\t\t\t\t\tvalue.arg)->\n\t\t\t\t\t\t\t       common.\n\t\t\t\t\t\t\t       aml_opcode))->\n\t\t\t    object_type;\n\n\t\t\t \n\n\t\t\tif (op->common.node) {\n\t\t\t\top->common.node->type = (u8) object_type;\n\t\t\t}\n\t\t}\n\t}\n#ifdef ACPI_ASL_COMPILER\n\t \n\tif (acpi_gbl_disasm_flag &&\n\t    op->common.node && op->common.aml_opcode == AML_EXTERNAL_OP) {\n\t\t \n\t\tparam_count =\n\t\t    (u8)op->common.value.arg->common.next->common.value.integer;\n\t\tobject_type = (u8)op->common.value.arg->common.value.integer;\n\t\top->common.node->flags |= ANOBJ_IS_EXTERNAL;\n\t\top->common.node->type = (u8)object_type;\n\n\t\tacpi_dm_create_subobject_for_external((u8)object_type,\n\t\t\t\t\t\t      &op->common.node,\n\t\t\t\t\t\t      param_count);\n\n\t\t \n\t\tacpi_dm_add_op_to_external_list(op, op->named.path,\n\t\t\t\t\t\t(u8)object_type, param_count,\n\t\t\t\t\t\tACPI_EXT_ORIGIN_FROM_OPCODE |\n\t\t\t\t\t\tACPI_EXT_RESOLVED_REFERENCE);\n\t}\n#endif\n\n\t \n\tif (!walk_state->method_node) {\n\t\tif (op->common.aml_opcode == AML_METHOD_OP) {\n\t\t\t \n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t\t  \"LOADING-Method: State=%p Op=%p NamedObj=%p\\n\",\n\t\t\t\t\t  walk_state, op, op->named.node));\n\n\t\t\tif (!acpi_ns_get_attached_object(op->named.node)) {\n\t\t\t\twalk_state->operands[0] =\n\t\t\t\t    ACPI_CAST_PTR(void, op->named.node);\n\t\t\t\twalk_state->num_operands = 1;\n\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ds_create_operands(walk_state,\n\t\t\t\t\t\t\t    op->common.value.\n\t\t\t\t\t\t\t    arg);\n\t\t\t\tif (ACPI_SUCCESS(status)) {\n\t\t\t\t\tstatus =\n\t\t\t\t\t    acpi_ex_create_method(op->named.\n\t\t\t\t\t\t\t\t  data,\n\t\t\t\t\t\t\t\t  op->named.\n\t\t\t\t\t\t\t\t  length,\n\t\t\t\t\t\t\t\t  walk_state);\n\t\t\t\t}\n\n\t\t\t\twalk_state->operands[0] = NULL;\n\t\t\t\twalk_state->num_operands = 0;\n\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t \n\n\tif (!walk_state->method_node &&\n\t    op->common.aml_opcode != AML_EXTERNAL_OP &&\n\t    acpi_ns_opens_scope(object_type)) {\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t  \"(%s): Popping scope for Op %p\\n\",\n\t\t\t\t  acpi_ut_get_type_name(object_type), op));\n\n\t\tstatus = acpi_ds_scope_stack_pop(walk_state);\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}