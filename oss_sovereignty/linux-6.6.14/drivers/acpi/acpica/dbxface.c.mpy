{
  "module_name": "dbxface.c",
  "hash_id": "abfb156aa295d515d937f0c056fa18210974538ad459b8f9eb80ee4d7f11fc27",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dbxface.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"amlcode.h\"\n#include \"acdebug.h\"\n#include \"acinterp.h\"\n#include \"acparser.h\"\n\n#define _COMPONENT          ACPI_CA_DEBUGGER\nACPI_MODULE_NAME(\"dbxface\")\n\n \nstatic acpi_status\nacpi_db_start_command(struct acpi_walk_state *walk_state,\n\t\t      union acpi_parse_object *op);\n\n#ifdef ACPI_OBSOLETE_FUNCTIONS\nvoid acpi_db_method_end(struct acpi_walk_state *walk_state);\n#endif\n\n#ifdef ACPI_DISASSEMBLER\nstatic union acpi_parse_object *acpi_db_get_display_op(struct acpi_walk_state\n\t\t\t\t\t\t       *walk_state,\n\t\t\t\t\t\t       union acpi_parse_object\n\t\t\t\t\t\t       *op);\n#endif\n\n \n\nstatic acpi_status\nacpi_db_start_command(struct acpi_walk_state *walk_state,\n\t\t      union acpi_parse_object *op)\n{\n\tacpi_status status;\n\n\t \n\n\t \n\n\t \n\n\tacpi_gbl_method_executing = TRUE;\n\tstatus = AE_CTRL_TRUE;\n\n\twhile (status == AE_CTRL_TRUE) {\n\n\t\t \n\n\t\tstatus = acpi_os_notify_command_complete();\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tgoto error_exit;\n\t\t}\n\n\t\t \n\n\t\tstatus = acpi_os_wait_command_ready();\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tgoto error_exit;\n\t\t}\n\n\t\tstatus =\n\t\t    acpi_db_command_dispatch(acpi_gbl_db_line_buf, walk_state,\n\t\t\t\t\t     op);\n\t}\n\n\t \n\nerror_exit:\n\tif (ACPI_FAILURE(status) && status != AE_CTRL_TERMINATE) {\n\t\tACPI_EXCEPTION((AE_INFO, status,\n\t\t\t\t\"While parsing/handling command line\"));\n\t}\n\treturn (status);\n}\n\n \n\nvoid acpi_db_signal_break_point(struct acpi_walk_state *walk_state)\n{\n\n#ifndef ACPI_APPLICATION\n\tif (acpi_gbl_db_thread_id != acpi_os_get_thread_id()) {\n\t\treturn;\n\t}\n#endif\n\n\t \n\tacpi_gbl_cm_single_step = TRUE;\n\tacpi_os_printf(\"**break** Executed AML BreakPoint opcode\\n\");\n}\n\n#ifdef ACPI_DISASSEMBLER\n \n\nstatic union acpi_parse_object *acpi_db_get_display_op(struct acpi_walk_state\n\t\t\t\t\t\t       *walk_state,\n\t\t\t\t\t\t       union acpi_parse_object\n\t\t\t\t\t\t       *op)\n{\n\tunion acpi_parse_object *display_op;\n\tunion acpi_parse_object *parent_op;\n\n\tdisplay_op = op;\n\tparent_op = op->common.parent;\n\tif (parent_op) {\n\t\tif ((walk_state->control_state) &&\n\t\t    (walk_state->control_state->common.state ==\n\t\t     ACPI_CONTROL_PREDICATE_EXECUTING)) {\n\t\t\t \n\t\t\twhile (parent_op) {\n\t\t\t\tif ((parent_op->common.aml_opcode == AML_IF_OP)\n\t\t\t\t    || (parent_op->common.aml_opcode ==\n\t\t\t\t\tAML_WHILE_OP)) {\n\t\t\t\t\tdisplay_op = parent_op;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tparent_op = parent_op->common.parent;\n\t\t\t}\n\t\t} else {\n\t\t\twhile (parent_op) {\n\t\t\t\tif ((parent_op->common.aml_opcode == AML_IF_OP)\n\t\t\t\t    || (parent_op->common.aml_opcode ==\n\t\t\t\t\tAML_ELSE_OP)\n\t\t\t\t    || (parent_op->common.aml_opcode ==\n\t\t\t\t\tAML_SCOPE_OP)\n\t\t\t\t    || (parent_op->common.aml_opcode ==\n\t\t\t\t\tAML_METHOD_OP)\n\t\t\t\t    || (parent_op->common.aml_opcode ==\n\t\t\t\t\tAML_WHILE_OP)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tdisplay_op = parent_op;\n\t\t\t\tparent_op = parent_op->common.parent;\n\t\t\t}\n\t\t}\n\t}\n\treturn display_op;\n}\n#endif\n\n \n\nacpi_status\nacpi_db_single_step(struct acpi_walk_state *walk_state,\n\t\t    union acpi_parse_object *op, u32 opcode_class)\n{\n\tunion acpi_parse_object *next;\n\tacpi_status status = AE_OK;\n\tu32 original_debug_level;\n\tu32 aml_offset;\n\n\tACPI_FUNCTION_ENTRY();\n\n#ifndef ACPI_APPLICATION\n\tif (acpi_gbl_db_thread_id != acpi_os_get_thread_id()) {\n\t\treturn (AE_OK);\n\t}\n#endif\n\n\t \n\n\tif (acpi_gbl_abort_method) {\n\t\tacpi_gbl_abort_method = FALSE;\n\t\treturn (AE_ABORT_METHOD);\n\t}\n\n\taml_offset = (u32)ACPI_PTR_DIFF(op->common.aml,\n\t\t\t\t\twalk_state->parser_state.aml_start);\n\n\t \n\n\tif (walk_state->method_breakpoint &&\n\t    (walk_state->method_breakpoint <= aml_offset)) {\n\n\t\t \n\t\t \n\n\t\tacpi_os_printf(\"***Break*** at AML offset %X\\n\", aml_offset);\n\t\tacpi_gbl_cm_single_step = TRUE;\n\t\tacpi_gbl_step_to_next_call = FALSE;\n\t\twalk_state->method_breakpoint = 0;\n\t}\n\n\t \n\n\telse if (walk_state->user_breakpoint &&\n\t\t (walk_state->user_breakpoint == aml_offset)) {\n\t\tacpi_os_printf(\"***UserBreakpoint*** at AML offset %X\\n\",\n\t\t\t       aml_offset);\n\t\tacpi_gbl_cm_single_step = TRUE;\n\t\tacpi_gbl_step_to_next_call = FALSE;\n\t\twalk_state->method_breakpoint = 0;\n\t}\n\n\t \n\tif (op->common.aml_opcode == AML_INT_NAMEDFIELD_OP) {\n\t\treturn (AE_OK);\n\t}\n\n\tswitch (opcode_class) {\n\tcase AML_CLASS_UNKNOWN:\n\tcase AML_CLASS_ARGUMENT:\t \n\n\t\treturn (AE_OK);\n\n\tdefault:\n\n\t\t \n\t\tbreak;\n\t}\n\n\t \n\tif ((acpi_gbl_db_output_to_file) ||\n\t    (acpi_gbl_cm_single_step) || (acpi_dbg_level & ACPI_LV_PARSE)) {\n\t\tif ((acpi_gbl_db_output_to_file) ||\n\t\t    (acpi_dbg_level & ACPI_LV_PARSE)) {\n\t\t\tacpi_os_printf\n\t\t\t    (\"\\nAML Debug: Next AML Opcode to execute:\\n\");\n\t\t}\n\n\t\t \n\t\toriginal_debug_level = acpi_dbg_level;\n\t\tacpi_dbg_level &= ~(ACPI_LV_PARSE | ACPI_LV_FUNCTIONS);\n\t\tnext = op->common.next;\n\t\top->common.next = NULL;\n\n\t\t \n\n#ifdef ACPI_DISASSEMBLER\n\t\tacpi_dm_disassemble(walk_state,\n\t\t\t\t    acpi_db_get_display_op(walk_state, op),\n\t\t\t\t    ACPI_UINT32_MAX);\n#else\n\t\t \n\t\tacpi_os_printf(\"AML Opcode: %4.4X %s\\n\", op->common.aml_opcode,\n\t\t\t       acpi_ps_get_opcode_name(op->common.aml_opcode));\n#endif\n\n\t\tif ((op->common.aml_opcode == AML_IF_OP) ||\n\t\t    (op->common.aml_opcode == AML_WHILE_OP)) {\n\t\t\tif (walk_state->control_state->common.value) {\n\t\t\t\tacpi_os_printf\n\t\t\t\t    (\"Predicate = [True], IF block was executed\\n\");\n\t\t\t} else {\n\t\t\t\tacpi_os_printf\n\t\t\t\t    (\"Predicate = [False], Skipping IF block\\n\");\n\t\t\t}\n\t\t} else if (op->common.aml_opcode == AML_ELSE_OP) {\n\t\t\tacpi_os_printf\n\t\t\t    (\"Predicate = [False], ELSE block was executed\\n\");\n\t\t}\n\n\t\t \n\n\t\top->common.next = next;\n\t\tacpi_os_printf(\"\\n\");\n\t\tif ((acpi_gbl_db_output_to_file) ||\n\t\t    (acpi_dbg_level & ACPI_LV_PARSE)) {\n\t\t\tacpi_os_printf(\"\\n\");\n\t\t}\n\t\tacpi_dbg_level = original_debug_level;\n\t}\n\n\t \n\n\tif (!acpi_gbl_cm_single_step) {\n\t\treturn (AE_OK);\n\t}\n\n\t \n\tif (acpi_gbl_step_to_next_call) {\n\t\tif (op->common.aml_opcode != AML_INT_METHODCALL_OP) {\n\n\t\t\t \n\n\t\t\treturn (AE_OK);\n\t\t}\n\n\t\t \n\n\t\tacpi_gbl_step_to_next_call = FALSE;\n\t}\n\n\t \n\tif (op->common.aml_opcode == AML_INT_METHODCALL_OP) {\n\n\t\t \n\n\t\tacpi_gbl_cm_single_step = FALSE;\n\n\t\t \n\t\twalk_state->method_breakpoint = 1;\t \n\t}\n\n\tacpi_ex_exit_interpreter();\n\tstatus = acpi_db_start_command(walk_state, op);\n\tacpi_ex_enter_interpreter();\n\n\t \n\n\treturn (status);\n}\n\n \n\nacpi_status acpi_initialize_debugger(void)\n{\n\tacpi_status status;\n\n\tACPI_FUNCTION_TRACE(acpi_initialize_debugger);\n\n\t \n\n\tacpi_gbl_db_buffer = NULL;\n\tacpi_gbl_db_filename = NULL;\n\tacpi_gbl_db_output_to_file = FALSE;\n\n\tacpi_gbl_db_debug_level = ACPI_LV_VERBOSITY2;\n\tacpi_gbl_db_console_debug_level = ACPI_NORMAL_DEFAULT | ACPI_LV_TABLES;\n\tacpi_gbl_db_output_flags = ACPI_DB_CONSOLE_OUTPUT;\n\n\tacpi_gbl_db_opt_no_ini_methods = FALSE;\n\tacpi_gbl_db_opt_no_region_support = FALSE;\n\n\tacpi_gbl_db_buffer = acpi_os_allocate(ACPI_DEBUG_BUFFER_SIZE);\n\tif (!acpi_gbl_db_buffer) {\n\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t}\n\tmemset(acpi_gbl_db_buffer, 0, ACPI_DEBUG_BUFFER_SIZE);\n\n\t \n\n\tacpi_gbl_db_scope_buf[0] = AML_ROOT_PREFIX;\n\tacpi_gbl_db_scope_buf[1] = 0;\n\tacpi_gbl_db_scope_node = acpi_gbl_root_node;\n\n\t \n\n\tacpi_gbl_db_terminate_loop = FALSE;\n\n\t \n\tif (acpi_gbl_debugger_configuration & DEBUGGER_MULTI_THREADED) {\n\n\t\t \n\n\t\tstatus = acpi_os_initialize_debugger();\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tacpi_os_printf(\"Could not get debugger mutex\\n\");\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\t \n\n\t\tacpi_gbl_db_threads_terminated = FALSE;\n\t\tstatus = acpi_os_execute(OSL_DEBUGGER_MAIN_THREAD,\n\t\t\t\t\t acpi_db_execute_thread, NULL);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tACPI_EXCEPTION((AE_INFO, status,\n\t\t\t\t\t\"Could not start debugger thread\"));\n\t\t\tacpi_gbl_db_threads_terminated = TRUE;\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t} else {\n\t\tacpi_gbl_db_thread_id = acpi_os_get_thread_id();\n\t}\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n\nACPI_EXPORT_SYMBOL(acpi_initialize_debugger)\n\n \nvoid acpi_terminate_debugger(void)\n{\n\n\t \n\n\tacpi_gbl_db_terminate_loop = TRUE;\n\n\tif (acpi_gbl_debugger_configuration & DEBUGGER_MULTI_THREADED) {\n\n\t\t \n\n\t\twhile (!acpi_gbl_db_threads_terminated) {\n\t\t\tacpi_os_sleep(100);\n\t\t}\n\n\t\tacpi_os_terminate_debugger();\n\t}\n\n\tif (acpi_gbl_db_buffer) {\n\t\tacpi_os_free(acpi_gbl_db_buffer);\n\t\tacpi_gbl_db_buffer = NULL;\n\t}\n\n\t \n\n\tacpi_gbl_db_output_flags = ACPI_DB_DISABLE_OUTPUT;\n}\n\nACPI_EXPORT_SYMBOL(acpi_terminate_debugger)\n\n \nvoid acpi_set_debugger_thread_id(acpi_thread_id thread_id)\n{\n\tacpi_gbl_db_thread_id = thread_id;\n}\n\nACPI_EXPORT_SYMBOL(acpi_set_debugger_thread_id)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}