{
  "module_name": "dswload2.c",
  "hash_id": "da34473689e0d032fba914fb198c44221095e38a874de3d2a2dc2f9419f2dfbc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dswload2.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acparser.h\"\n#include \"amlcode.h\"\n#include \"acdispat.h\"\n#include \"acinterp.h\"\n#include \"acnamesp.h\"\n#include \"acevents.h\"\n#ifdef ACPI_EXEC_APP\n#include \"aecommon.h\"\n#endif\n\n#define _COMPONENT          ACPI_DISPATCHER\nACPI_MODULE_NAME(\"dswload2\")\n\n \nacpi_status\nacpi_ds_load2_begin_op(struct acpi_walk_state *walk_state,\n\t\t       union acpi_parse_object **out_op)\n{\n\tunion acpi_parse_object *op;\n\tstruct acpi_namespace_node *node;\n\tacpi_status status;\n\tacpi_object_type object_type;\n\tchar *buffer_ptr;\n\tu32 flags;\n\n\tACPI_FUNCTION_TRACE(ds_load2_begin_op);\n\n\top = walk_state->op;\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH, \"Op=%p State=%p\\n\", op,\n\t\t\t  walk_state));\n\n\tif (op) {\n\t\tif ((walk_state->control_state) &&\n\t\t    (walk_state->control_state->common.state ==\n\t\t     ACPI_CONTROL_CONDITIONAL_EXECUTING)) {\n\n\t\t\t \n\n\t\t\tstatus = acpi_ds_exec_begin_op(walk_state, out_op);\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\t \n\n\t\tif ((!(walk_state->op_info->flags & AML_NSOPCODE) &&\n\t\t     (walk_state->opcode != AML_INT_NAMEPATH_OP)) ||\n\t\t    (!(walk_state->op_info->flags & AML_NAMED))) {\n\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t}\n\n\t\t \n\n\t\tif (walk_state->opcode == AML_INT_NAMEPATH_OP) {\n\n\t\t\t \n\n\t\t\tbuffer_ptr = op->common.value.string;\n\t\t\tif (!buffer_ptr) {\n\n\t\t\t\t \n\n\t\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t\t}\n\t\t} else {\n\t\t\t \n\n\t\t\tbuffer_ptr = ACPI_CAST_PTR(char, &op->named.name);\n\t\t}\n\t} else {\n\t\t \n\n\t\tbuffer_ptr =\n\t\t    acpi_ps_get_next_namestring(&walk_state->parser_state);\n\t}\n\n\t \n\n\tobject_type = walk_state->op_info->object_type;\n\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t  \"State=%p Op=%p Type=%X\\n\", walk_state, op,\n\t\t\t  object_type));\n\n\tswitch (walk_state->opcode) {\n\tcase AML_FIELD_OP:\n\tcase AML_BANK_FIELD_OP:\n\tcase AML_INDEX_FIELD_OP:\n\n\t\tnode = NULL;\n\t\tstatus = AE_OK;\n\t\tbreak;\n\n\tcase AML_INT_NAMEPATH_OP:\n\t\t \n\t\tstatus =\n\t\t    acpi_ns_lookup(walk_state->scope_info, buffer_ptr,\n\t\t\t\t   object_type, ACPI_IMODE_EXECUTE,\n\t\t\t\t   ACPI_NS_SEARCH_PARENT, walk_state, &(node));\n\t\tbreak;\n\n\tcase AML_SCOPE_OP:\n\n\t\t \n\n\t\tif (op && (op->named.node == acpi_gbl_root_node)) {\n\t\t\tnode = op->named.node;\n\n\t\t\tstatus =\n\t\t\t    acpi_ds_scope_stack_push(node, object_type,\n\t\t\t\t\t\t     walk_state);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t} else {\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ns_lookup(walk_state->scope_info, buffer_ptr,\n\t\t\t\t\t   object_type, ACPI_IMODE_EXECUTE,\n\t\t\t\t\t   ACPI_NS_SEARCH_PARENT, walk_state,\n\t\t\t\t\t   &(node));\n\t\t\tif (ACPI_FAILURE(status)) {\n#ifdef ACPI_ASL_COMPILER\n\t\t\t\tif (status == AE_NOT_FOUND) {\n\t\t\t\t\tstatus = AE_OK;\n\t\t\t\t} else {\n\t\t\t\t\tACPI_ERROR_NAMESPACE(walk_state->\n\t\t\t\t\t\t\t     scope_info,\n\t\t\t\t\t\t\t     buffer_ptr,\n\t\t\t\t\t\t\t     status);\n\t\t\t\t}\n#else\n\t\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t\t     buffer_ptr, status);\n#endif\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t}\n\n\t\t \n\t\tswitch (node->type) {\n\t\tcase ACPI_TYPE_ANY:\n\t\tcase ACPI_TYPE_LOCAL_SCOPE:\t \n\t\tcase ACPI_TYPE_DEVICE:\n\t\tcase ACPI_TYPE_POWER:\n\t\tcase ACPI_TYPE_PROCESSOR:\n\t\tcase ACPI_TYPE_THERMAL:\n\n\t\t\t \n\t\t\tbreak;\n\n\t\tcase ACPI_TYPE_INTEGER:\n\t\tcase ACPI_TYPE_STRING:\n\t\tcase ACPI_TYPE_BUFFER:\n\n\t\t\t \n\t\t\tACPI_WARNING((AE_INFO,\n\t\t\t\t      \"Type override - [%4.4s] had invalid type (%s) \"\n\t\t\t\t      \"for Scope operator, changed to type ANY\",\n\t\t\t\t      acpi_ut_get_node_name(node),\n\t\t\t\t      acpi_ut_get_type_name(node->type)));\n\n\t\t\tnode->type = ACPI_TYPE_ANY;\n\t\t\twalk_state->scope_info->common.value = ACPI_TYPE_ANY;\n\t\t\tbreak;\n\n\t\tcase ACPI_TYPE_METHOD:\n\n\t\t\t \n\t\t\tif ((node == acpi_gbl_root_node) &&\n\t\t\t    (walk_state->\n\t\t\t     parse_flags & ACPI_PARSE_MODULE_LEVEL)) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tACPI_FALLTHROUGH;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Invalid type (%s) for target of \"\n\t\t\t\t    \"Scope operator [%4.4s] (Cannot override)\",\n\t\t\t\t    acpi_ut_get_type_name(node->type),\n\t\t\t\t    acpi_ut_get_node_name(node)));\n\n\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\n\t\t \n\n\t\tif (op && op->common.node) {\n\n\t\t\t \n\n\t\t\tnode = op->common.node;\n\n\t\t\tif (acpi_ns_opens_scope(object_type)) {\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ds_scope_stack_push(node, object_type,\n\t\t\t\t\t\t\t     walk_state);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t}\n\n\t\t \n\t\tif (walk_state->deferred_node) {\n\n\t\t\t \n\n\t\t\tnode = walk_state->deferred_node;\n\t\t\tstatus = AE_OK;\n\t\t\tbreak;\n\t\t}\n\n\t\tflags = ACPI_NS_NO_UPSEARCH;\n\t\tif (walk_state->pass_number == ACPI_IMODE_EXECUTE) {\n\n\t\t\t \n\n\t\t\tflags |= ACPI_NS_ERROR_IF_FOUND;\n\n\t\t\tif (!\n\t\t\t    (walk_state->\n\t\t\t     parse_flags & ACPI_PARSE_MODULE_LEVEL)) {\n\t\t\t\tflags |= ACPI_NS_TEMPORARY;\n\t\t\t}\n\t\t}\n#ifdef ACPI_ASL_COMPILER\n\n\t\t \n\t\tif (walk_state->opcode == AML_EXTERNAL_OP) {\n\t\t\tflags |= ACPI_NS_DONT_OPEN_SCOPE;\n\t\t}\n#endif\n\n\t\t \n\t\tif (walk_state->op_info->flags & AML_NAMED) {\n\t\t\tflags |= ACPI_NS_PREFIX_MUST_EXIST;\n\t\t}\n\n\t\t \n\n\t\tstatus =\n\t\t    acpi_ns_lookup(walk_state->scope_info, buffer_ptr,\n\t\t\t\t   object_type, ACPI_IMODE_LOAD_PASS2, flags,\n\t\t\t\t   walk_state, &node);\n\n\t\tif (ACPI_SUCCESS(status) && (flags & ACPI_NS_TEMPORARY)) {\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t\t  \"***New Node [%4.4s] %p is temporary\\n\",\n\t\t\t\t\t  acpi_ut_get_node_name(node), node));\n\t\t}\n\t\tbreak;\n\t}\n\n\tif (ACPI_FAILURE(status)) {\n\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t     buffer_ptr, status);\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tif (!op) {\n\n\t\t \n\n\t\top = acpi_ps_alloc_op(walk_state->opcode, walk_state->aml);\n\t\tif (!op) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\t \n\n\t\tif (node) {\n\t\t\top->named.name = node->name.integer;\n\t\t}\n\t\t*out_op = op;\n\t}\n\n\t \n\top->common.node = node;\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status acpi_ds_load2_end_op(struct acpi_walk_state *walk_state)\n{\n\tunion acpi_parse_object *op;\n\tacpi_status status = AE_OK;\n\tacpi_object_type object_type;\n\tstruct acpi_namespace_node *node;\n\tunion acpi_parse_object *arg;\n\tstruct acpi_namespace_node *new_node;\n\tu32 i;\n\tu8 region_space;\n#ifdef ACPI_EXEC_APP\n\tunion acpi_operand_object *obj_desc;\n\tchar *namepath;\n#endif\n\n\tACPI_FUNCTION_TRACE(ds_load2_end_op);\n\n\top = walk_state->op;\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH, \"Opcode [%s] Op %p State %p\\n\",\n\t\t\t  walk_state->op_info->name, op, walk_state));\n\n\t \n\n\tif (!(walk_state->op_info->flags & AML_NSOBJECT)) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\tif (op->common.aml_opcode == AML_SCOPE_OP) {\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t  \"Ending scope Op=%p State=%p\\n\", op,\n\t\t\t\t  walk_state));\n\t}\n\n\tobject_type = walk_state->op_info->object_type;\n\n\t \n\tnode = op->common.node;\n\n\t \n\twalk_state->operands[0] = (void *)node;\n\twalk_state->num_operands = 1;\n\n\t \n\n\tif (acpi_ns_opens_scope(object_type) &&\n\t    (op->common.aml_opcode != AML_INT_METHODCALL_OP)) {\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t  \"(%s) Popping scope for Op %p\\n\",\n\t\t\t\t  acpi_ut_get_type_name(object_type), op));\n\n\t\tstatus = acpi_ds_scope_stack_pop(walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tgoto cleanup;\n\t\t}\n\t}\n\n\t \n\n\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t  \"Create-Load [%s] State=%p Op=%p NamedObj=%p\\n\",\n\t\t\t  acpi_ps_get_opcode_name(op->common.aml_opcode),\n\t\t\t  walk_state, op, node));\n\n\t \n\n\targ = op->common.value.arg;\n\n\tswitch (walk_state->op_info->type) {\n\n\tcase AML_TYPE_CREATE_FIELD:\n\t\t \n\t\tstatus = acpi_ds_create_buffer_field(op, walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tACPI_EXCEPTION((AE_INFO, status,\n\t\t\t\t\t\"CreateBufferField failure\"));\n\t\t\tgoto cleanup;\n\t\t\t}\n\t\tbreak;\n\n\tcase AML_TYPE_NAMED_FIELD:\n\t\t \n\t\tif (walk_state->method_node) {\n\t\t\tstatus = acpi_ds_init_field_objects(op, walk_state);\n\t\t}\n\n\t\tswitch (op->common.aml_opcode) {\n\t\tcase AML_INDEX_FIELD_OP:\n\n\t\t\tstatus =\n\t\t\t    acpi_ds_create_index_field(op,\n\t\t\t\t\t\t       (acpi_handle)arg->common.\n\t\t\t\t\t\t       node, walk_state);\n\t\t\tbreak;\n\n\t\tcase AML_BANK_FIELD_OP:\n\n\t\t\tstatus =\n\t\t\t    acpi_ds_create_bank_field(op, arg->common.node,\n\t\t\t\t\t\t      walk_state);\n\t\t\tbreak;\n\n\t\tcase AML_FIELD_OP:\n\n\t\t\tstatus =\n\t\t\t    acpi_ds_create_field(op, arg->common.node,\n\t\t\t\t\t\t walk_state);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase AML_TYPE_NAMED_SIMPLE:\n\n\t\tstatus = acpi_ds_create_operands(walk_state, arg);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tgoto cleanup;\n\t\t}\n\n\t\tswitch (op->common.aml_opcode) {\n\t\tcase AML_PROCESSOR_OP:\n\n\t\t\tstatus = acpi_ex_create_processor(walk_state);\n\t\t\tbreak;\n\n\t\tcase AML_POWER_RESOURCE_OP:\n\n\t\t\tstatus = acpi_ex_create_power_resource(walk_state);\n\t\t\tbreak;\n\n\t\tcase AML_MUTEX_OP:\n\n\t\t\tstatus = acpi_ex_create_mutex(walk_state);\n\t\t\tbreak;\n\n\t\tcase AML_EVENT_OP:\n\n\t\t\tstatus = acpi_ex_create_event(walk_state);\n\t\t\tbreak;\n\n\t\tcase AML_ALIAS_OP:\n\n\t\t\tstatus = acpi_ex_create_alias(walk_state);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tstatus = AE_OK;\n\t\t\tgoto cleanup;\n\t\t}\n\n\t\t \n\n\t\tfor (i = 1; i < walk_state->num_operands; i++) {\n\t\t\tacpi_ut_remove_reference(walk_state->operands[i]);\n\t\t\twalk_state->operands[i] = NULL;\n\t\t}\n\n\t\tbreak;\n\n\tcase AML_TYPE_NAMED_COMPLEX:\n\n\t\tswitch (op->common.aml_opcode) {\n\t\tcase AML_REGION_OP:\n\t\tcase AML_DATA_REGION_OP:\n\n\t\t\tif (op->common.aml_opcode == AML_REGION_OP) {\n\t\t\t\tregion_space = (acpi_adr_space_type)\n\t\t\t\t    ((op->common.value.arg)->common.value.\n\t\t\t\t     integer);\n\t\t\t} else {\n\t\t\t\tregion_space = ACPI_ADR_SPACE_DATA_TABLE;\n\t\t\t}\n\n\t\t\t \n\t\t\tif (walk_state->method_node) {\n\t\t\t\t \n\t\t\t\tstatus = acpi_ex_create_region(op->named.data,\n\t\t\t\t\t\t\t       op->named.length,\n\t\t\t\t\t\t\t       region_space,\n\t\t\t\t\t\t\t       walk_state);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstatus =\n\t\t\t    acpi_ev_initialize_region\n\t\t\t    (acpi_ns_get_attached_object(node));\n\t\t\tbreak;\n\n\t\tcase AML_NAME_OP:\n\n\t\t\tstatus = acpi_ds_create_node(walk_state, node, op);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tgoto cleanup;\n\t\t\t}\n#ifdef ACPI_EXEC_APP\n\t\t\t \n\t\t\tnamepath = acpi_ns_get_external_pathname(node);\n\t\t\tstatus = ae_lookup_init_file_entry(namepath, &obj_desc);\n\t\t\tif (ACPI_SUCCESS(status)) {\n\n\t\t\t\t \n\n\t\t\t\tif (node->object) {\n\t\t\t\t\tacpi_ns_detach_object(node);\n\t\t\t\t}\n\t\t\t\tacpi_ns_attach_object(node, obj_desc,\n\t\t\t\t\t\t      obj_desc->common.type);\n\t\t\t}\n\t\t\tACPI_FREE(namepath);\n\t\t\tstatus = AE_OK;\n#endif\n\t\t\tbreak;\n\n\t\tcase AML_METHOD_OP:\n\t\t\t \n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t\t  \"LOADING-Method: State=%p Op=%p NamedObj=%p\\n\",\n\t\t\t\t\t  walk_state, op, op->named.node));\n\n\t\t\tif (!acpi_ns_get_attached_object(op->named.node)) {\n\t\t\t\twalk_state->operands[0] =\n\t\t\t\t    ACPI_CAST_PTR(void, op->named.node);\n\t\t\t\twalk_state->num_operands = 1;\n\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ds_create_operands(walk_state,\n\t\t\t\t\t\t\t    op->common.value.\n\t\t\t\t\t\t\t    arg);\n\t\t\t\tif (ACPI_SUCCESS(status)) {\n\t\t\t\t\tstatus =\n\t\t\t\t\t    acpi_ex_create_method(op->named.\n\t\t\t\t\t\t\t\t  data,\n\t\t\t\t\t\t\t\t  op->named.\n\t\t\t\t\t\t\t\t  length,\n\t\t\t\t\t\t\t\t  walk_state);\n\t\t\t\t}\n\n\t\t\t\twalk_state->operands[0] = NULL;\n\t\t\t\twalk_state->num_operands = 0;\n\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase AML_CLASS_INTERNAL:\n\n\t\t \n\t\tbreak;\n\n\tcase AML_CLASS_METHOD_CALL:\n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_DISPATCH,\n\t\t\t\t  \"RESOLVING-MethodCall: State=%p Op=%p NamedObj=%p\\n\",\n\t\t\t\t  walk_state, op, node));\n\n\t\t \n\t\tstatus =\n\t\t    acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t   arg->common.value.string, ACPI_TYPE_ANY,\n\t\t\t\t   ACPI_IMODE_LOAD_PASS2,\n\t\t\t\t   ACPI_NS_SEARCH_PARENT |\n\t\t\t\t   ACPI_NS_DONT_OPEN_SCOPE, walk_state,\n\t\t\t\t   &(new_node));\n\t\tif (ACPI_SUCCESS(status)) {\n\t\t\t \n\t\t\tif (new_node->type != ACPI_TYPE_METHOD) {\n\t\t\t\tstatus = AE_AML_OPERAND_TYPE;\n\t\t\t}\n\n\t\t\t \n\t\t\top->common.node = new_node;\n\t\t} else {\n\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t     arg->common.value.string, status);\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\n\t\tbreak;\n\t}\n\ncleanup:\n\n\t \n\n\twalk_state->operands[0] = NULL;\n\twalk_state->num_operands = 0;\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}