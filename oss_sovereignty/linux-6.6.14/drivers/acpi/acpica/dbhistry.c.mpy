{
  "module_name": "dbhistry.c",
  "hash_id": "fb71f394b76735ac20c8bcb528d8d05d5883c056001686d85dbb3bc6e752e024",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dbhistry.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acdebug.h\"\n\n#define _COMPONENT          ACPI_CA_DEBUGGER\nACPI_MODULE_NAME(\"dbhistry\")\n\n#define HI_NO_HISTORY       0\n#define HI_RECORD_HISTORY   1\n#define HISTORY_SIZE        40\ntypedef struct history_info {\n\tchar *command;\n\tu32 cmd_num;\n\n} HISTORY_INFO;\n\nstatic HISTORY_INFO acpi_gbl_history_buffer[HISTORY_SIZE];\nstatic u16 acpi_gbl_lo_history = 0;\nstatic u16 acpi_gbl_num_history = 0;\nstatic u16 acpi_gbl_next_history_index = 0;\n\n \n\nvoid acpi_db_add_to_history(char *command_line)\n{\n\tu16 cmd_len;\n\tu16 buffer_len;\n\n\t \n\n\tcmd_len = (u16)strlen(command_line);\n\tif (!cmd_len) {\n\t\treturn;\n\t}\n\n\tif (acpi_gbl_history_buffer[acpi_gbl_next_history_index].command !=\n\t    NULL) {\n\t\tbuffer_len =\n\t\t    (u16)\n\t\t    strlen(acpi_gbl_history_buffer[acpi_gbl_next_history_index].\n\t\t\t   command);\n\n\t\tif (cmd_len > buffer_len) {\n\t\t\tacpi_os_free(acpi_gbl_history_buffer\n\t\t\t\t     [acpi_gbl_next_history_index].command);\n\t\t\tacpi_gbl_history_buffer[acpi_gbl_next_history_index].\n\t\t\t    command = acpi_os_allocate(cmd_len + 1);\n\t\t}\n\t} else {\n\t\tacpi_gbl_history_buffer[acpi_gbl_next_history_index].command =\n\t\t    acpi_os_allocate(cmd_len + 1);\n\t}\n\n\tstrcpy(acpi_gbl_history_buffer[acpi_gbl_next_history_index].command,\n\t       command_line);\n\n\tacpi_gbl_history_buffer[acpi_gbl_next_history_index].cmd_num =\n\t    acpi_gbl_next_cmd_num;\n\n\t \n\n\tif ((acpi_gbl_num_history == HISTORY_SIZE) &&\n\t    (acpi_gbl_next_history_index == acpi_gbl_lo_history)) {\n\t\tacpi_gbl_lo_history++;\n\t\tif (acpi_gbl_lo_history >= HISTORY_SIZE) {\n\t\t\tacpi_gbl_lo_history = 0;\n\t\t}\n\t}\n\n\tacpi_gbl_next_history_index++;\n\tif (acpi_gbl_next_history_index >= HISTORY_SIZE) {\n\t\tacpi_gbl_next_history_index = 0;\n\t}\n\n\tacpi_gbl_next_cmd_num++;\n\tif (acpi_gbl_num_history < HISTORY_SIZE) {\n\t\tacpi_gbl_num_history++;\n\t}\n}\n\n \n\nvoid acpi_db_display_history(void)\n{\n\tu32 i;\n\tu16 history_index;\n\n\thistory_index = acpi_gbl_lo_history;\n\n\t \n\n\tfor (i = 0; i < acpi_gbl_num_history; i++) {\n\t\tif (acpi_gbl_history_buffer[history_index].command) {\n\t\t\tacpi_os_printf(\"%3u %s\\n\",\n\t\t\t\t       acpi_gbl_history_buffer[history_index].\n\t\t\t\t       cmd_num,\n\t\t\t\t       acpi_gbl_history_buffer[history_index].\n\t\t\t\t       command);\n\t\t}\n\n\t\thistory_index++;\n\t\tif (history_index >= HISTORY_SIZE) {\n\t\t\thistory_index = 0;\n\t\t}\n\t}\n}\n\n \n\nchar *acpi_db_get_from_history(char *command_num_arg)\n{\n\tu32 cmd_num;\n\n\tif (command_num_arg == NULL) {\n\t\tcmd_num = acpi_gbl_next_cmd_num - 1;\n\t}\n\n\telse {\n\t\tcmd_num = strtoul(command_num_arg, NULL, 0);\n\t}\n\n\treturn (acpi_db_get_history_by_index(cmd_num));\n}\n\n \n\nchar *acpi_db_get_history_by_index(u32 cmd_num)\n{\n\tu32 i;\n\tu16 history_index;\n\n\t \n\n\thistory_index = acpi_gbl_lo_history;\n\tfor (i = 0; i < acpi_gbl_num_history; i++) {\n\t\tif (acpi_gbl_history_buffer[history_index].cmd_num == cmd_num) {\n\n\t\t\t \n\n\t\t\treturn (acpi_gbl_history_buffer[history_index].command);\n\t\t}\n\n\t\t \n\n\t\thistory_index++;\n\t\tif (history_index >= HISTORY_SIZE) {\n\t\t\thistory_index = 0;\n\t\t}\n\t}\n\n\tacpi_os_printf(\"Invalid history number: %u\\n\", history_index);\n\treturn (NULL);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}