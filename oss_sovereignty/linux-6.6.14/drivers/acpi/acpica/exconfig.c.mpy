{
  "module_name": "exconfig.c",
  "hash_id": "d57747f041ff146bc5185f9cfc6547d8a6b8d79c30e9aa2c70245001ab297091",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exconfig.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acinterp.h\"\n#include \"acnamesp.h\"\n#include \"actables.h\"\n#include \"acdispat.h\"\n#include \"acevents.h\"\n#include \"amlcode.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exconfig\")\n\n \nstatic acpi_status\nacpi_ex_add_table(u32 table_index, union acpi_operand_object **ddb_handle);\n\nstatic acpi_status\nacpi_ex_region_read(union acpi_operand_object *obj_desc,\n\t\t    u32 length, u8 *buffer);\n\n \n\nstatic acpi_status\nacpi_ex_add_table(u32 table_index, union acpi_operand_object **ddb_handle)\n{\n\tunion acpi_operand_object *obj_desc;\n\n\tACPI_FUNCTION_TRACE(ex_add_table);\n\n\t \n\n\tobj_desc = acpi_ut_create_internal_object(ACPI_TYPE_LOCAL_REFERENCE);\n\tif (!obj_desc) {\n\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t}\n\n\t \n\n\tobj_desc->common.flags |= AOPOBJ_DATA_VALID;\n\tobj_desc->reference.class = ACPI_REFCLASS_TABLE;\n\tobj_desc->reference.value = table_index;\n\t*ddb_handle = obj_desc;\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_ex_load_table_op(struct acpi_walk_state *walk_state,\n\t\t      union acpi_operand_object **return_desc)\n{\n\tacpi_status status;\n\tunion acpi_operand_object **operand = &walk_state->operands[0];\n\tstruct acpi_namespace_node *parent_node;\n\tstruct acpi_namespace_node *start_node;\n\tstruct acpi_namespace_node *parameter_node = NULL;\n\tunion acpi_operand_object *return_obj;\n\tunion acpi_operand_object *ddb_handle;\n\tu32 table_index;\n\n\tACPI_FUNCTION_TRACE(ex_load_table_op);\n\n\t \n\n\treturn_obj = acpi_ut_create_integer_object((u64)0);\n\tif (!return_obj) {\n\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t}\n\n\t*return_desc = return_obj;\n\n\t \n\n\tacpi_ex_exit_interpreter();\n\tstatus = acpi_tb_find_table(operand[0]->string.pointer,\n\t\t\t\t    operand[1]->string.pointer,\n\t\t\t\t    operand[2]->string.pointer, &table_index);\n\tacpi_ex_enter_interpreter();\n\tif (ACPI_FAILURE(status)) {\n\t\tif (status != AE_NOT_FOUND) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\t \n\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\n\tstart_node = walk_state->scope_info->scope.node;\n\tparent_node = acpi_gbl_root_node;\n\n\t \n\n\tif (operand[3]->string.length > 0) {\n\t\t \n\t\tstatus = acpi_ns_get_node_unlocked(start_node,\n\t\t\t\t\t\t   operand[3]->string.pointer,\n\t\t\t\t\t\t   ACPI_NS_SEARCH_PARENT,\n\t\t\t\t\t\t   &parent_node);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\t \n\n\tif (operand[4]->string.length > 0) {\n\t\tif ((operand[4]->string.pointer[0] != AML_ROOT_PREFIX) &&\n\t\t    (operand[4]->string.pointer[0] != AML_PARENT_PREFIX)) {\n\t\t\t \n\t\t\tstart_node = parent_node;\n\t\t}\n\n\t\t \n\n\t\tstatus = acpi_ns_get_node_unlocked(start_node,\n\t\t\t\t\t\t   operand[4]->string.pointer,\n\t\t\t\t\t\t   ACPI_NS_SEARCH_PARENT,\n\t\t\t\t\t\t   &parameter_node);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\t \n\n\tACPI_INFO((\"Dynamic OEM Table Load:\"));\n\tacpi_ex_exit_interpreter();\n\tstatus = acpi_tb_load_table(table_index, parent_node);\n\tacpi_ex_enter_interpreter();\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tstatus = acpi_ex_add_table(table_index, &ddb_handle);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tacpi_ex_exit_interpreter();\n\tacpi_ns_initialize_objects();\n\tacpi_ex_enter_interpreter();\n\n\t \n\n\tif (parameter_node) {\n\n\t\t \n\n\t\tstatus = acpi_ex_store(operand[5],\n\t\t\t\t       ACPI_CAST_PTR(union acpi_operand_object,\n\t\t\t\t\t\t     parameter_node),\n\t\t\t\t       walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\t(void)acpi_ex_unload_table(ddb_handle);\n\n\t\t\tacpi_ut_remove_reference(ddb_handle);\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\t \n\n\tacpi_ut_remove_reference(ddb_handle);\n\n\t \n\n\treturn_obj->integer.value = 0xFFFFFFFFFFFFFFFF;\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nstatic acpi_status\nacpi_ex_region_read(union acpi_operand_object *obj_desc, u32 length, u8 *buffer)\n{\n\tacpi_status status;\n\tu64 value;\n\tu32 region_offset = 0;\n\tu32 i;\n\n\t \n\n\tfor (i = 0; i < length; i++) {\n\t\tstatus =\n\t\t    acpi_ev_address_space_dispatch(obj_desc, NULL, ACPI_READ,\n\t\t\t\t\t\t   region_offset, 8, &value);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn (status);\n\t\t}\n\n\t\t*buffer = (u8)value;\n\t\tbuffer++;\n\t\tregion_offset++;\n\t}\n\n\treturn (AE_OK);\n}\n\n \n\nacpi_status\nacpi_ex_load_op(union acpi_operand_object *obj_desc,\n\t\tunion acpi_operand_object *target,\n\t\tstruct acpi_walk_state *walk_state)\n{\n\tunion acpi_operand_object *ddb_handle;\n\tstruct acpi_table_header *table_header;\n\tstruct acpi_table_header *table;\n\tu32 table_index;\n\tacpi_status status;\n\tu32 length;\n\n\tACPI_FUNCTION_TRACE(ex_load_op);\n\n\tif (target->common.descriptor_type == ACPI_DESC_TYPE_NAMED) {\n\t\ttarget =\n\t\t    acpi_ns_get_attached_object(ACPI_CAST_PTR\n\t\t\t\t\t\t(struct acpi_namespace_node,\n\t\t\t\t\t\t target));\n\t}\n\tif (target->common.type != ACPI_TYPE_INTEGER) {\n\t\tACPI_ERROR((AE_INFO, \"Type not integer: %X\",\n\t\t\t    target->common.type));\n\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t}\n\n\ttarget->integer.value = 0;\n\n\t \n\n\tswitch (obj_desc->common.type) {\n\tcase ACPI_TYPE_REGION:\n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t  \"Load table from Region %p\\n\", obj_desc));\n\n\t\t \n\n\t\tif (obj_desc->region.space_id != ACPI_ADR_SPACE_SYSTEM_MEMORY) {\n\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t}\n\n\t\t \n\t\tif (!(obj_desc->common.flags & AOPOBJ_DATA_VALID)) {\n\t\t\tstatus = acpi_ds_get_region_arguments(obj_desc);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t}\n\n\t\t \n\n\t\ttable_header = ACPI_ALLOCATE(sizeof(struct acpi_table_header));\n\t\tif (!table_header) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\tstatus =\n\t\t    acpi_ex_region_read(obj_desc,\n\t\t\t\t\tsizeof(struct acpi_table_header),\n\t\t\t\t\tACPI_CAST_PTR(u8, table_header));\n\t\tlength = table_header->length;\n\t\tACPI_FREE(table_header);\n\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\t \n\n\t\tif (length < sizeof(struct acpi_table_header)) {\n\t\t\treturn_ACPI_STATUS(AE_INVALID_TABLE_LENGTH);\n\t\t}\n\n\t\t \n\n\t\t \n\n\t\ttable = ACPI_ALLOCATE(length);\n\t\tif (!table) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\t \n\n\t\tstatus = acpi_ex_region_read(obj_desc, length,\n\t\t\t\t\t     ACPI_CAST_PTR(u8, table));\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tACPI_FREE(table);\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\t \n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t  \"Load table from Buffer or Field %p\\n\",\n\t\t\t\t  obj_desc));\n\n\t\t \n\n\t\tif (obj_desc->buffer.length < sizeof(struct acpi_table_header)) {\n\t\t\treturn_ACPI_STATUS(AE_INVALID_TABLE_LENGTH);\n\t\t}\n\n\t\t \n\n\t\ttable_header =\n\t\t    ACPI_CAST_PTR(struct acpi_table_header,\n\t\t\t\t  obj_desc->buffer.pointer);\n\t\tlength = table_header->length;\n\n\t\t \n\n\t\tif (length > obj_desc->buffer.length) {\n\t\t\treturn_ACPI_STATUS(AE_AML_BUFFER_LIMIT);\n\t\t}\n\t\tif (length < sizeof(struct acpi_table_header)) {\n\t\t\treturn_ACPI_STATUS(AE_INVALID_TABLE_LENGTH);\n\t\t}\n\n\t\t \n\t\ttable = ACPI_ALLOCATE(length);\n\t\tif (!table) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\tmemcpy(table, table_header, length);\n\t\tbreak;\n\n\tdefault:\n\n\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t}\n\n\t \n\n\tACPI_INFO((\"Dynamic OEM Table Load:\"));\n\tacpi_ex_exit_interpreter();\n\tstatus = acpi_tb_install_and_load_table(ACPI_PTR_TO_PHYSADDR(table),\n\t\t\t\t\t\tACPI_TABLE_ORIGIN_INTERNAL_VIRTUAL,\n\t\t\t\t\t\ttable, TRUE, &table_index);\n\tacpi_ex_enter_interpreter();\n\tif (ACPI_FAILURE(status)) {\n\n\t\t \n\n\t\tACPI_FREE(table);\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\tstatus = acpi_ex_add_table(table_index, &ddb_handle);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tacpi_ex_exit_interpreter();\n\tacpi_ns_initialize_objects();\n\tacpi_ex_enter_interpreter();\n\n\t \n\n\tacpi_ut_remove_reference(ddb_handle);\n\n\t \n\n\ttarget->integer.value = 0xFFFFFFFFFFFFFFFF;\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status acpi_ex_unload_table(union acpi_operand_object *ddb_handle)\n{\n\tacpi_status status = AE_OK;\n\tunion acpi_operand_object *table_desc = ddb_handle;\n\tu32 table_index;\n\n\tACPI_FUNCTION_TRACE(ex_unload_table);\n\n\t \n\tACPI_WARNING((AE_INFO, \"Received request to unload an ACPI table\"));\n\n\t \n\tACPI_EXCEPTION((AE_INFO, AE_NOT_IMPLEMENTED,\n\t\t\t\"AML Unload operator is not supported\"));\n\n\t \n\tif ((!ddb_handle) ||\n\t    (ACPI_GET_DESCRIPTOR_TYPE(ddb_handle) != ACPI_DESC_TYPE_OPERAND) ||\n\t    (ddb_handle->common.type != ACPI_TYPE_LOCAL_REFERENCE) ||\n\t    (!(ddb_handle->common.flags & AOPOBJ_DATA_VALID))) {\n\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t}\n\n\t \n\n\ttable_index = table_desc->reference.value;\n\n\t \n\tacpi_ex_exit_interpreter();\n\tstatus = acpi_tb_unload_table(table_index);\n\tacpi_ex_enter_interpreter();\n\n\t \n\tif (ACPI_SUCCESS(status)) {\n\t\tddb_handle->common.flags &= ~AOPOBJ_DATA_VALID;\n\t}\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}