{
  "module_name": "dsfield.c",
  "hash_id": "039245aa542cea813bb5ca37a1b89c2ac69ac73071be9b37e36c0b9297a3f6a8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dsfield.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"amlcode.h\"\n#include \"acdispat.h\"\n#include \"acinterp.h\"\n#include \"acnamesp.h\"\n#include \"acparser.h\"\n\n#ifdef ACPI_EXEC_APP\n#include \"aecommon.h\"\n#endif\n\n#define _COMPONENT          ACPI_DISPATCHER\nACPI_MODULE_NAME(\"dsfield\")\n\n \n#ifdef ACPI_ASL_COMPILER\n#include \"acdisasm.h\"\nstatic acpi_status\nacpi_ds_create_external_region(acpi_status lookup_status,\n\t\t\t       union acpi_parse_object *op,\n\t\t\t       char *path,\n\t\t\t       struct acpi_walk_state *walk_state,\n\t\t\t       struct acpi_namespace_node **node);\n#endif\n\nstatic acpi_status\nacpi_ds_get_field_names(struct acpi_create_field_info *info,\n\t\t\tstruct acpi_walk_state *walk_state,\n\t\t\tunion acpi_parse_object *arg);\n\n#ifdef ACPI_ASL_COMPILER\n \n\nstatic acpi_status\nacpi_ds_create_external_region(acpi_status lookup_status,\n\t\t\t       union acpi_parse_object *op,\n\t\t\t       char *path,\n\t\t\t       struct acpi_walk_state *walk_state,\n\t\t\t       struct acpi_namespace_node **node)\n{\n\tacpi_status status;\n\tunion acpi_operand_object *obj_desc;\n\n\tif (lookup_status != AE_NOT_FOUND) {\n\t\treturn (lookup_status);\n\t}\n\n\t \n\tacpi_dm_add_op_to_external_list(op, path, ACPI_TYPE_REGION, 0, 0);\n\n\tstatus = acpi_ns_lookup(walk_state->scope_info, path, ACPI_TYPE_REGION,\n\t\t\t\tACPI_IMODE_LOAD_PASS1, ACPI_NS_SEARCH_PARENT,\n\t\t\t\twalk_state, node);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn (status);\n\t}\n\n\t \n\n\tobj_desc = acpi_ut_create_internal_object(ACPI_TYPE_REGION);\n\tif (!obj_desc) {\n\t\treturn (AE_NO_MEMORY);\n\t}\n\n\tobj_desc->region.node = *node;\n\tstatus = acpi_ns_attach_object(*node, obj_desc, ACPI_TYPE_REGION);\n\treturn (status);\n}\n#endif\n\n \n\nacpi_status\nacpi_ds_create_buffer_field(union acpi_parse_object *op,\n\t\t\t    struct acpi_walk_state *walk_state)\n{\n\tunion acpi_parse_object *arg;\n\tstruct acpi_namespace_node *node;\n\tacpi_status status;\n\tunion acpi_operand_object *obj_desc;\n\tunion acpi_operand_object *second_desc = NULL;\n\tu32 flags;\n\n\tACPI_FUNCTION_TRACE(ds_create_buffer_field);\n\n\t \n\tif (op->common.aml_opcode == AML_CREATE_FIELD_OP) {\n\n\t\t \n\n\t\targ = acpi_ps_get_arg(op, 3);\n\t} else {\n\t\t \n\n\t\targ = acpi_ps_get_arg(op, 2);\n\t}\n\n\tif (!arg) {\n\t\treturn_ACPI_STATUS(AE_AML_NO_OPERAND);\n\t}\n\n\tif (walk_state->deferred_node) {\n\t\tnode = walk_state->deferred_node;\n\t} else {\n\t\t \n\n\t\tif (!(walk_state->parse_flags & ACPI_PARSE_EXECUTE)) {\n\t\t\tACPI_ERROR((AE_INFO, \"Parse execute mode is not set\"));\n\t\t\treturn_ACPI_STATUS(AE_AML_INTERNAL);\n\t\t}\n\n\t\t \n\n\t\tflags = ACPI_NS_NO_UPSEARCH | ACPI_NS_DONT_OPEN_SCOPE |\n\t\t    ACPI_NS_ERROR_IF_FOUND;\n\n\t\t \n\t\tif (walk_state->method_node &&\n\t\t    !(walk_state->parse_flags & ACPI_PARSE_MODULE_LEVEL)) {\n\t\t\tflags |= ACPI_NS_TEMPORARY;\n\t\t}\n\n\t\t \n\n\t\tstatus = acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t\targ->common.value.string, ACPI_TYPE_ANY,\n\t\t\t\t\tACPI_IMODE_LOAD_PASS1, flags,\n\t\t\t\t\twalk_state, &node);\n\t\tif ((walk_state->parse_flags & ACPI_PARSE_DISASSEMBLE)\n\t\t    && status == AE_ALREADY_EXISTS) {\n\t\t\tstatus = AE_OK;\n\t\t} else if (ACPI_FAILURE(status)) {\n\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t     arg->common.value.string, status);\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\t \n\top->common.node = node;\n\n\t \n\tobj_desc = acpi_ns_get_attached_object(node);\n\tif (obj_desc) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\n\t \n\n\tobj_desc = acpi_ut_create_internal_object(ACPI_TYPE_BUFFER_FIELD);\n\tif (!obj_desc) {\n\t\tstatus = AE_NO_MEMORY;\n\t\tgoto cleanup;\n\t}\n\n\t \n\tsecond_desc = obj_desc->common.next_object;\n\tsecond_desc->extra.aml_start = op->named.data;\n\tsecond_desc->extra.aml_length = op->named.length;\n\tobj_desc->buffer_field.node = node;\n\n\t \n\n\tstatus = acpi_ns_attach_object(node, obj_desc, ACPI_TYPE_BUFFER_FIELD);\n\tif (ACPI_FAILURE(status)) {\n\t\tgoto cleanup;\n\t}\n\ncleanup:\n\n\t \n\n\tacpi_ut_remove_reference(obj_desc);\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nstatic acpi_status\nacpi_ds_get_field_names(struct acpi_create_field_info *info,\n\t\t\tstruct acpi_walk_state *walk_state,\n\t\t\tunion acpi_parse_object *arg)\n{\n\tacpi_status status;\n\tu64 position;\n\tunion acpi_parse_object *child;\n\n#ifdef ACPI_EXEC_APP\n\tunion acpi_operand_object *result_desc;\n\tunion acpi_operand_object *obj_desc;\n\tchar *name_path;\n#endif\n\n\tACPI_FUNCTION_TRACE_PTR(ds_get_field_names, info);\n\n\t \n\n\tinfo->field_bit_position = 0;\n\n\t \n\n\twhile (arg) {\n\t\t \n\t\tswitch (arg->common.aml_opcode) {\n\t\tcase AML_INT_RESERVEDFIELD_OP:\n\n\t\t\tposition = (u64)info->field_bit_position +\n\t\t\t    (u64)arg->common.value.size;\n\n\t\t\tif (position > ACPI_UINT32_MAX) {\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Bit offset within field too large (> 0xFFFFFFFF)\"));\n\t\t\t\treturn_ACPI_STATUS(AE_SUPPORT);\n\t\t\t}\n\n\t\t\tinfo->field_bit_position = (u32) position;\n\t\t\tbreak;\n\n\t\tcase AML_INT_ACCESSFIELD_OP:\n\t\tcase AML_INT_EXTACCESSFIELD_OP:\n\t\t\t \n\n\t\t\t \n\n\t\t\tinfo->field_flags = (u8)\n\t\t\t    ((info->\n\t\t\t      field_flags & ~(AML_FIELD_ACCESS_TYPE_MASK)) |\n\t\t\t     ((u8)((u32)(arg->common.value.integer & 0x07))));\n\n\t\t\t \n\n\t\t\tinfo->attribute = (u8)\n\t\t\t    ((arg->common.value.integer >> 8) & 0xFF);\n\n\t\t\t \n\n\t\t\tinfo->access_length = (u8)\n\t\t\t    ((arg->common.value.integer >> 16) & 0xFF);\n\t\t\tbreak;\n\n\t\tcase AML_INT_CONNECTION_OP:\n\t\t\t \n\t\t\tinfo->resource_buffer = NULL;\n\t\t\tinfo->connection_node = NULL;\n\t\t\tinfo->pin_number_index = 0;\n\n\t\t\t \n\t\t\tchild = arg->common.value.arg;\n\t\t\tif (child->common.aml_opcode == AML_INT_BYTELIST_OP) {\n\t\t\t\tinfo->resource_buffer = child->named.data;\n\t\t\t\tinfo->resource_length =\n\t\t\t\t    (u16)child->named.value.integer;\n\t\t\t} else {\n\t\t\t\t \n\n\t\t\t\tstatus = acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t\t\t\tchild->common.value.\n\t\t\t\t\t\t\tname, ACPI_TYPE_ANY,\n\t\t\t\t\t\t\tACPI_IMODE_EXECUTE,\n\t\t\t\t\t\t\tACPI_NS_DONT_OPEN_SCOPE,\n\t\t\t\t\t\t\twalk_state,\n\t\t\t\t\t\t\t&info->connection_node);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\tACPI_ERROR_NAMESPACE(walk_state->\n\t\t\t\t\t\t\t     scope_info,\n\t\t\t\t\t\t\t     child->common.\n\t\t\t\t\t\t\t     value.name,\n\t\t\t\t\t\t\t     status);\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase AML_INT_NAMEDFIELD_OP:\n\n\t\t\t \n\n\t\t\tstatus = acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t\t\t(char *)&arg->named.name,\n\t\t\t\t\t\tinfo->field_type,\n\t\t\t\t\t\tACPI_IMODE_EXECUTE,\n\t\t\t\t\t\tACPI_NS_DONT_OPEN_SCOPE,\n\t\t\t\t\t\twalk_state, &info->field_node);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t\t     (char *)&arg->named.name,\n\t\t\t\t\t\t     status);\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t} else {\n\t\t\t\targ->common.node = info->field_node;\n\t\t\t\tinfo->field_bit_length = arg->common.value.size;\n\n\t\t\t\t \n\t\t\t\tif (!acpi_ns_get_attached_object\n\t\t\t\t    (info->field_node)) {\n\t\t\t\t\tstatus = acpi_ex_prep_field_value(info);\n\t\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t\t}\n#ifdef ACPI_EXEC_APP\n\t\t\t\t\tname_path =\n\t\t\t\t\t    acpi_ns_get_external_pathname(info->\n\t\t\t\t\t\t\t\t\t  field_node);\n\t\t\t\t\tif (ACPI_SUCCESS\n\t\t\t\t\t    (ae_lookup_init_file_entry\n\t\t\t\t\t     (name_path, &obj_desc))) {\n\t\t\t\t\t\tacpi_ex_write_data_to_field\n\t\t\t\t\t\t    (obj_desc,\n\t\t\t\t\t\t     acpi_ns_get_attached_object\n\t\t\t\t\t\t     (info->field_node),\n\t\t\t\t\t\t     &result_desc);\n\t\t\t\t\t\tacpi_ut_remove_reference\n\t\t\t\t\t\t    (obj_desc);\n\t\t\t\t\t}\n\t\t\t\t\tACPI_FREE(name_path);\n#endif\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t \n\n\t\t\tposition = (u64)info->field_bit_position +\n\t\t\t    (u64)arg->common.value.size;\n\n\t\t\tif (position > ACPI_UINT32_MAX) {\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Field [%4.4s] bit offset too large (> 0xFFFFFFFF)\",\n\t\t\t\t\t    ACPI_CAST_PTR(char,\n\t\t\t\t\t\t\t  &info->field_node->\n\t\t\t\t\t\t\t  name)));\n\t\t\t\treturn_ACPI_STATUS(AE_SUPPORT);\n\t\t\t}\n\n\t\t\tinfo->field_bit_position += info->field_bit_length;\n\t\t\tinfo->pin_number_index++;\t \n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Invalid opcode in field list: 0x%X\",\n\t\t\t\t    arg->common.aml_opcode));\n\t\t\treturn_ACPI_STATUS(AE_AML_BAD_OPCODE);\n\t\t}\n\n\t\targ = arg->common.next;\n\t}\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_ds_create_field(union acpi_parse_object *op,\n\t\t     struct acpi_namespace_node *region_node,\n\t\t     struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tunion acpi_parse_object *arg;\n\tstruct acpi_create_field_info info;\n\n\tACPI_FUNCTION_TRACE_PTR(ds_create_field, op);\n\n\t \n\n\targ = op->common.value.arg;\n\n\tif (!region_node) {\n\t\tstatus =\n\t\t    acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t   arg->common.value.name, ACPI_TYPE_REGION,\n\t\t\t\t   ACPI_IMODE_EXECUTE, ACPI_NS_SEARCH_PARENT,\n\t\t\t\t   walk_state, &region_node);\n#ifdef ACPI_ASL_COMPILER\n\t\tstatus = acpi_ds_create_external_region(status, arg,\n\t\t\t\t\t\t\targ->common.value.name,\n\t\t\t\t\t\t\twalk_state,\n\t\t\t\t\t\t\t&region_node);\n#endif\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t     arg->common.value.name, status);\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\tmemset(&info, 0, sizeof(struct acpi_create_field_info));\n\n\t \n\n\targ = arg->common.next;\n\tinfo.field_flags = (u8) arg->common.value.integer;\n\tinfo.attribute = 0;\n\n\t \n\n\tinfo.field_type = ACPI_TYPE_LOCAL_REGION_FIELD;\n\tinfo.region_node = region_node;\n\n\tstatus = acpi_ds_get_field_names(&info, walk_state, arg->common.next);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tif (info.region_node->object->region.space_id ==\n\t    ACPI_ADR_SPACE_PLATFORM_COMM) {\n\t\tregion_node->object->field.internal_pcc_buffer =\n\t\t    ACPI_ALLOCATE_ZEROED(info.region_node->object->region.\n\t\t\t\t\t length);\n\t\tif (!region_node->object->field.internal_pcc_buffer) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ds_init_field_objects(union acpi_parse_object *op,\n\t\t\t   struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tunion acpi_parse_object *arg = NULL;\n\tstruct acpi_namespace_node *node;\n\tu8 type = 0;\n\tu32 flags;\n\n\tACPI_FUNCTION_TRACE_PTR(ds_init_field_objects, op);\n\n\t \n\n\tif (!(walk_state->parse_flags & ACPI_PARSE_EXECUTE)) {\n\t\tif (walk_state->parse_flags & ACPI_PARSE_DEFERRED_OP) {\n\n\t\t\t \n\n\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t}\n\n\t\tACPI_ERROR((AE_INFO, \"Parse deferred mode is not set\"));\n\t\treturn_ACPI_STATUS(AE_AML_INTERNAL);\n\t}\n\n\t \n\tswitch (walk_state->opcode) {\n\tcase AML_FIELD_OP:\n\n\t\targ = acpi_ps_get_arg(op, 2);\n\t\ttype = ACPI_TYPE_LOCAL_REGION_FIELD;\n\t\tbreak;\n\n\tcase AML_BANK_FIELD_OP:\n\n\t\targ = acpi_ps_get_arg(op, 4);\n\t\ttype = ACPI_TYPE_LOCAL_BANK_FIELD;\n\t\tbreak;\n\n\tcase AML_INDEX_FIELD_OP:\n\n\t\targ = acpi_ps_get_arg(op, 3);\n\t\ttype = ACPI_TYPE_LOCAL_INDEX_FIELD;\n\t\tbreak;\n\n\tdefault:\n\n\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t}\n\n\t \n\n\tflags = ACPI_NS_NO_UPSEARCH | ACPI_NS_DONT_OPEN_SCOPE |\n\t    ACPI_NS_ERROR_IF_FOUND;\n\n\t \n\tif (walk_state->method_node &&\n\t    !(walk_state->parse_flags & ACPI_PARSE_MODULE_LEVEL)) {\n\t\tflags |= ACPI_NS_TEMPORARY;\n\t}\n#ifdef ACPI_EXEC_APP\n\tflags |= ACPI_NS_OVERRIDE_IF_FOUND;\n#endif\n\t \n\twhile (arg) {\n\t\t \n\t\tif (arg->common.aml_opcode == AML_INT_NAMEDFIELD_OP) {\n\t\t\tstatus = acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t\t\t(char *)&arg->named.name, type,\n\t\t\t\t\t\tACPI_IMODE_LOAD_PASS1, flags,\n\t\t\t\t\t\twalk_state, &node);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t\t     (char *)&arg->named.name,\n\t\t\t\t\t\t     status);\n\t\t\t\tif (status != AE_ALREADY_EXISTS) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\n\t\t\t\t \n\t\t\t}\n\n\t\t\targ->common.node = node;\n\t\t}\n\n\t\t \n\n\t\targ = arg->common.next;\n\t}\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_ds_create_bank_field(union acpi_parse_object *op,\n\t\t\t  struct acpi_namespace_node *region_node,\n\t\t\t  struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tunion acpi_parse_object *arg;\n\tstruct acpi_create_field_info info;\n\n\tACPI_FUNCTION_TRACE_PTR(ds_create_bank_field, op);\n\n\t \n\n\targ = op->common.value.arg;\n\tif (!region_node) {\n\t\tstatus =\n\t\t    acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t   arg->common.value.name, ACPI_TYPE_REGION,\n\t\t\t\t   ACPI_IMODE_EXECUTE, ACPI_NS_SEARCH_PARENT,\n\t\t\t\t   walk_state, &region_node);\n#ifdef ACPI_ASL_COMPILER\n\t\tstatus = acpi_ds_create_external_region(status, arg,\n\t\t\t\t\t\t\targ->common.value.name,\n\t\t\t\t\t\t\twalk_state,\n\t\t\t\t\t\t\t&region_node);\n#endif\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t\t     arg->common.value.name, status);\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\t \n\n\targ = arg->common.next;\n\tstatus =\n\t    acpi_ns_lookup(walk_state->scope_info, arg->common.value.string,\n\t\t\t   ACPI_TYPE_ANY, ACPI_IMODE_EXECUTE,\n\t\t\t   ACPI_NS_SEARCH_PARENT, walk_state,\n\t\t\t   &info.register_node);\n\tif (ACPI_FAILURE(status)) {\n\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t     arg->common.value.string, status);\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\targ = arg->common.next;\n\n\t \n\n\targ = arg->common.next;\n\tinfo.field_flags = (u8) arg->common.value.integer;\n\n\t \n\n\tinfo.field_type = ACPI_TYPE_LOCAL_BANK_FIELD;\n\tinfo.region_node = region_node;\n\n\t \n\tinfo.data_register_node = (struct acpi_namespace_node *)op;\n\n\tstatus = acpi_ds_get_field_names(&info, walk_state, arg->common.next);\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ds_create_index_field(union acpi_parse_object *op,\n\t\t\t   struct acpi_namespace_node *region_node,\n\t\t\t   struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tunion acpi_parse_object *arg;\n\tstruct acpi_create_field_info info;\n\n\tACPI_FUNCTION_TRACE_PTR(ds_create_index_field, op);\n\n\t \n\n\targ = op->common.value.arg;\n\tstatus =\n\t    acpi_ns_lookup(walk_state->scope_info, arg->common.value.string,\n\t\t\t   ACPI_TYPE_ANY, ACPI_IMODE_EXECUTE,\n\t\t\t   ACPI_NS_SEARCH_PARENT, walk_state,\n\t\t\t   &info.register_node);\n\tif (ACPI_FAILURE(status)) {\n\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t     arg->common.value.string, status);\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\targ = arg->common.next;\n\tstatus =\n\t    acpi_ns_lookup(walk_state->scope_info, arg->common.value.string,\n\t\t\t   ACPI_TYPE_ANY, ACPI_IMODE_EXECUTE,\n\t\t\t   ACPI_NS_SEARCH_PARENT, walk_state,\n\t\t\t   &info.data_register_node);\n\tif (ACPI_FAILURE(status)) {\n\t\tACPI_ERROR_NAMESPACE(walk_state->scope_info,\n\t\t\t\t     arg->common.value.string, status);\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\targ = arg->common.next;\n\tinfo.field_flags = (u8) arg->common.value.integer;\n\n\t \n\n\tinfo.field_type = ACPI_TYPE_LOCAL_INDEX_FIELD;\n\tinfo.region_node = region_node;\n\n\tstatus = acpi_ds_get_field_names(&info, walk_state, arg->common.next);\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}