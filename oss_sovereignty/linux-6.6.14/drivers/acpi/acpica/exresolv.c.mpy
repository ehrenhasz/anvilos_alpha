{
  "module_name": "exresolv.c",
  "hash_id": "d2a6d0e628489e54656364ee5fa0c1ea25bba673e72e4b1677547bf631468595",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exresolv.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"amlcode.h\"\n#include \"acdispat.h\"\n#include \"acinterp.h\"\n#include \"acnamesp.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exresolv\")\n\n \nstatic acpi_status\nacpi_ex_resolve_object_to_value(union acpi_operand_object **stack_ptr,\n\t\t\t\tstruct acpi_walk_state *walk_state);\n\n \n\nacpi_status\nacpi_ex_resolve_to_value(union acpi_operand_object **stack_ptr,\n\t\t\t struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\n\tACPI_FUNCTION_TRACE_PTR(ex_resolve_to_value, stack_ptr);\n\n\tif (!stack_ptr || !*stack_ptr) {\n\t\tACPI_ERROR((AE_INFO, \"Internal - null pointer\"));\n\t\treturn_ACPI_STATUS(AE_AML_NO_OPERAND);\n\t}\n\n\t \n\tif (ACPI_GET_DESCRIPTOR_TYPE(*stack_ptr) == ACPI_DESC_TYPE_OPERAND) {\n\t\tstatus = acpi_ex_resolve_object_to_value(stack_ptr, walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\tif (!*stack_ptr) {\n\t\t\tACPI_ERROR((AE_INFO, \"Internal - null pointer\"));\n\t\t\treturn_ACPI_STATUS(AE_AML_NO_OPERAND);\n\t\t}\n\t}\n\n\t \n\tif (ACPI_GET_DESCRIPTOR_TYPE(*stack_ptr) == ACPI_DESC_TYPE_NAMED) {\n\t\tstatus =\n\t\t    acpi_ex_resolve_node_to_value(ACPI_CAST_INDIRECT_PTR\n\t\t\t\t\t\t  (struct acpi_namespace_node,\n\t\t\t\t\t\t   stack_ptr), walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Resolved object %p\\n\", *stack_ptr));\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nstatic acpi_status\nacpi_ex_resolve_object_to_value(union acpi_operand_object **stack_ptr,\n\t\t\t\tstruct acpi_walk_state *walk_state)\n{\n\tacpi_status status = AE_OK;\n\tunion acpi_operand_object *stack_desc;\n\tunion acpi_operand_object *obj_desc = NULL;\n\tu8 ref_type;\n\n\tACPI_FUNCTION_TRACE(ex_resolve_object_to_value);\n\n\tstack_desc = *stack_ptr;\n\n\t \n\n\tswitch (stack_desc->common.type) {\n\tcase ACPI_TYPE_LOCAL_REFERENCE:\n\n\t\tref_type = stack_desc->reference.class;\n\n\t\tswitch (ref_type) {\n\t\tcase ACPI_REFCLASS_LOCAL:\n\t\tcase ACPI_REFCLASS_ARG:\n\t\t\t \n\t\t\tstatus = acpi_ds_method_data_get_value(ref_type,\n\t\t\t\t\t\t\t       stack_desc->\n\t\t\t\t\t\t\t       reference.value,\n\t\t\t\t\t\t\t       walk_state,\n\t\t\t\t\t\t\t       &obj_desc);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t\t  \"[Arg/Local %X] ValueObj is %p\\n\",\n\t\t\t\t\t  stack_desc->reference.value,\n\t\t\t\t\t  obj_desc));\n\n\t\t\t \n\t\t\tacpi_ut_remove_reference(stack_desc);\n\t\t\t*stack_ptr = obj_desc;\n\t\t\tbreak;\n\n\t\tcase ACPI_REFCLASS_INDEX:\n\n\t\t\tswitch (stack_desc->reference.target_type) {\n\t\t\tcase ACPI_TYPE_BUFFER_FIELD:\n\n\t\t\t\t \n\t\t\t\tbreak;\n\n\t\t\tcase ACPI_TYPE_PACKAGE:\n\n\t\t\t\t \n\n\t\t\t\tif ((walk_state->opcode ==\n\t\t\t\t     AML_INT_METHODCALL_OP)\n\t\t\t\t    || (walk_state->opcode ==\n\t\t\t\t\tAML_COPY_OBJECT_OP)) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\t \n\n\t\t\t\tobj_desc = *stack_desc->reference.where;\n\t\t\t\tif (obj_desc) {\n\t\t\t\t\t \n\t\t\t\t\tacpi_ut_add_reference(obj_desc);\n\t\t\t\t\t*stack_ptr = obj_desc;\n\t\t\t\t} else {\n\t\t\t\t\t \n\t\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t\t    \"Attempt to dereference an Index to \"\n\t\t\t\t\t\t    \"NULL package element Idx=%p\",\n\t\t\t\t\t\t    stack_desc));\n\t\t\t\t\tstatus = AE_AML_UNINITIALIZED_ELEMENT;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\t \n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Unknown TargetType 0x%X in Index/Reference object %p\",\n\t\t\t\t\t    stack_desc->reference.target_type,\n\t\t\t\t\t    stack_desc));\n\t\t\t\tstatus = AE_AML_INTERNAL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ACPI_REFCLASS_REFOF:\n\t\tcase ACPI_REFCLASS_DEBUG:\n\t\tcase ACPI_REFCLASS_TABLE:\n\n\t\t\t \n\n\t\t\tbreak;\n\n\t\tcase ACPI_REFCLASS_NAME:\t \n\n\t\t\t \n\n\t\t\tif ((stack_desc->reference.node->type ==\n\t\t\t     ACPI_TYPE_DEVICE)\n\t\t\t    || (stack_desc->reference.node->type ==\n\t\t\t\tACPI_TYPE_THERMAL)) {\n\n\t\t\t\t \n\n\t\t\t\t*stack_ptr = (void *)stack_desc->reference.node;\n\t\t\t} else {\n\t\t\t\t \n\n\t\t\t\t*stack_ptr =\n\t\t\t\t    (stack_desc->reference.node)->object;\n\t\t\t\tacpi_ut_add_reference(*stack_ptr);\n\t\t\t}\n\n\t\t\tacpi_ut_remove_reference(stack_desc);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Unknown Reference type 0x%X in %p\",\n\t\t\t\t    ref_type, stack_desc));\n\t\t\tstatus = AE_AML_INTERNAL;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\n\n\t\tstatus = acpi_ds_get_buffer_arguments(stack_desc);\n\t\tbreak;\n\n\tcase ACPI_TYPE_PACKAGE:\n\n\t\tstatus = acpi_ds_get_package_arguments(stack_desc);\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER_FIELD:\n\tcase ACPI_TYPE_LOCAL_REGION_FIELD:\n\tcase ACPI_TYPE_LOCAL_BANK_FIELD:\n\tcase ACPI_TYPE_LOCAL_INDEX_FIELD:\n\n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t  \"FieldRead SourceDesc=%p Type=%X\\n\",\n\t\t\t\t  stack_desc, stack_desc->common.type));\n\n\t\tstatus =\n\t\t    acpi_ex_read_data_from_field(walk_state, stack_desc,\n\t\t\t\t\t\t &obj_desc);\n\n\t\t \n\n\t\tacpi_ut_remove_reference(*stack_ptr);\n\t\t*stack_ptr = (void *)obj_desc;\n\t\tbreak;\n\n\tdefault:\n\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ex_resolve_multiple(struct acpi_walk_state *walk_state,\n\t\t\t union acpi_operand_object *operand,\n\t\t\t acpi_object_type *return_type,\n\t\t\t union acpi_operand_object **return_desc)\n{\n\tunion acpi_operand_object *obj_desc = ACPI_CAST_PTR(void, operand);\n\tstruct acpi_namespace_node *node =\n\t    ACPI_CAST_PTR(struct acpi_namespace_node, operand);\n\tacpi_object_type type;\n\tacpi_status status;\n\n\tACPI_FUNCTION_TRACE(acpi_ex_resolve_multiple);\n\n\t \n\n\tswitch (ACPI_GET_DESCRIPTOR_TYPE(obj_desc)) {\n\tcase ACPI_DESC_TYPE_OPERAND:\n\n\t\ttype = obj_desc->common.type;\n\t\tbreak;\n\n\tcase ACPI_DESC_TYPE_NAMED:\n\n\t\ttype = ((struct acpi_namespace_node *)obj_desc)->type;\n\t\tobj_desc = acpi_ns_get_attached_object(node);\n\n\t\t \n\n\t\tif (type == ACPI_TYPE_LOCAL_ALIAS) {\n\t\t\ttype = ((struct acpi_namespace_node *)obj_desc)->type;\n\t\t\tobj_desc = acpi_ns_get_attached_object((struct\n\t\t\t\t\t\t\t\tacpi_namespace_node\n\t\t\t\t\t\t\t\t*)obj_desc);\n\t\t}\n\n\t\tswitch (type) {\n\t\tcase ACPI_TYPE_DEVICE:\n\t\tcase ACPI_TYPE_THERMAL:\n\n\t\t\t \n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tif (!obj_desc) {\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"[%4.4s] Node is unresolved or uninitialized\",\n\t\t\t\t\t    acpi_ut_get_node_name(node)));\n\t\t\t\treturn_ACPI_STATUS(AE_AML_UNINITIALIZED_NODE);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t}\n\n\t \n\n\tif (type != ACPI_TYPE_LOCAL_REFERENCE) {\n\t\tgoto exit;\n\t}\n\n\t \n\twhile (obj_desc->common.type == ACPI_TYPE_LOCAL_REFERENCE) {\n\t\tswitch (obj_desc->reference.class) {\n\t\tcase ACPI_REFCLASS_REFOF:\n\t\tcase ACPI_REFCLASS_NAME:\n\n\t\t\t \n\n\t\t\tif (obj_desc->reference.class == ACPI_REFCLASS_REFOF) {\n\t\t\t\tnode = obj_desc->reference.object;\n\t\t\t} else {\t \n\n\t\t\t\tnode = obj_desc->reference.node;\n\t\t\t}\n\n\t\t\t \n\n\t\t\tif (ACPI_GET_DESCRIPTOR_TYPE(node) !=\n\t\t\t    ACPI_DESC_TYPE_NAMED) {\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Not a namespace node %p [%s]\",\n\t\t\t\t\t    node,\n\t\t\t\t\t    acpi_ut_get_descriptor_name(node)));\n\t\t\t\treturn_ACPI_STATUS(AE_AML_INTERNAL);\n\t\t\t}\n\n\t\t\t \n\n\t\t\tobj_desc = acpi_ns_get_attached_object(node);\n\t\t\tif (!obj_desc) {\n\n\t\t\t\t \n\n\t\t\t\ttype = acpi_ns_get_type(node);\n\t\t\t\tgoto exit;\n\t\t\t}\n\n\t\t\t \n\n\t\t\tif (obj_desc == operand) {\n\t\t\t\treturn_ACPI_STATUS(AE_AML_CIRCULAR_REFERENCE);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ACPI_REFCLASS_INDEX:\n\n\t\t\t \n\n\t\t\ttype = obj_desc->reference.target_type;\n\t\t\tif (type != ACPI_TYPE_PACKAGE) {\n\t\t\t\tgoto exit;\n\t\t\t}\n\n\t\t\t \n\t\t\tobj_desc = *(obj_desc->reference.where);\n\t\t\tif (!obj_desc) {\n\n\t\t\t\t \n\n\t\t\t\ttype = 0;\t \n\t\t\t\tgoto exit;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ACPI_REFCLASS_TABLE:\n\n\t\t\ttype = ACPI_TYPE_DDB_HANDLE;\n\t\t\tgoto exit;\n\n\t\tcase ACPI_REFCLASS_LOCAL:\n\t\tcase ACPI_REFCLASS_ARG:\n\n\t\t\tif (return_desc) {\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ds_method_data_get_value(obj_desc->\n\t\t\t\t\t\t\t\t  reference.\n\t\t\t\t\t\t\t\t  class,\n\t\t\t\t\t\t\t\t  obj_desc->\n\t\t\t\t\t\t\t\t  reference.\n\t\t\t\t\t\t\t\t  value,\n\t\t\t\t\t\t\t\t  walk_state,\n\t\t\t\t\t\t\t\t  &obj_desc);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\t\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\t} else {\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ds_method_data_get_node(obj_desc->\n\t\t\t\t\t\t\t\t reference.\n\t\t\t\t\t\t\t\t class,\n\t\t\t\t\t\t\t\t obj_desc->\n\t\t\t\t\t\t\t\t reference.\n\t\t\t\t\t\t\t\t value,\n\t\t\t\t\t\t\t\t walk_state,\n\t\t\t\t\t\t\t\t &node);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\n\t\t\t\tobj_desc = acpi_ns_get_attached_object(node);\n\t\t\t\tif (!obj_desc) {\n\t\t\t\t\ttype = ACPI_TYPE_ANY;\n\t\t\t\t\tgoto exit;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ACPI_REFCLASS_DEBUG:\n\n\t\t\t \n\n\t\t\ttype = ACPI_TYPE_DEBUG_OBJECT;\n\t\t\tgoto exit;\n\n\t\tdefault:\n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Unknown Reference Class 0x%2.2X\",\n\t\t\t\t    obj_desc->reference.class));\n\t\t\treturn_ACPI_STATUS(AE_AML_INTERNAL);\n\t\t}\n\t}\n\n\t \n\ttype = obj_desc->common.type;\n\nexit:\n\t \n\n\tswitch (type) {\n\tcase ACPI_TYPE_LOCAL_REGION_FIELD:\n\tcase ACPI_TYPE_LOCAL_BANK_FIELD:\n\tcase ACPI_TYPE_LOCAL_INDEX_FIELD:\n\n\t\ttype = ACPI_TYPE_FIELD_UNIT;\n\t\tbreak;\n\n\tcase ACPI_TYPE_LOCAL_SCOPE:\n\n\t\t \n\n\t\ttype = ACPI_TYPE_ANY;\n\t\tbreak;\n\n\tdefault:\n\n\t\t \n\n\t\tbreak;\n\t}\n\n\t*return_type = type;\n\tif (return_desc) {\n\t\t*return_desc = obj_desc;\n\t}\n\treturn_ACPI_STATUS(AE_OK);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}