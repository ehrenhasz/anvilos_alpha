{
  "module_name": "hwsleep.c",
  "hash_id": "43cd7a98456a969b231f504c5bb4a2d8237cd6c6ebdec839e13fca1b506b353d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/hwsleep.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n\n#define _COMPONENT          ACPI_HARDWARE\nACPI_MODULE_NAME(\"hwsleep\")\n\n#if (!ACPI_REDUCED_HARDWARE)\t \n \nacpi_status acpi_hw_legacy_sleep(u8 sleep_state)\n{\n\tstruct acpi_bit_register_info *sleep_type_reg_info;\n\tstruct acpi_bit_register_info *sleep_enable_reg_info;\n\tu32 pm1a_control;\n\tu32 pm1b_control;\n\tu32 in_value;\n\tacpi_status status;\n\n\tACPI_FUNCTION_TRACE(hw_legacy_sleep);\n\n\tsleep_type_reg_info =\n\t    acpi_hw_get_bit_register_info(ACPI_BITREG_SLEEP_TYPE);\n\tsleep_enable_reg_info =\n\t    acpi_hw_get_bit_register_info(ACPI_BITREG_SLEEP_ENABLE);\n\n\t \n\n\tstatus = acpi_write_bit_register(ACPI_BITREG_WAKE_STATUS,\n\t\t\t\t\t ACPI_CLEAR_STATUS);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\tstatus = acpi_hw_disable_all_gpes();\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\tstatus = acpi_hw_clear_acpi_status();\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\tacpi_gbl_system_awake_and_running = FALSE;\n\n\t  \n\tstatus = acpi_hw_enable_all_wakeup_gpes();\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tstatus = acpi_hw_register_read(ACPI_REGISTER_PM1_CONTROL,\n\t\t\t\t       &pm1a_control);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\tACPI_DEBUG_PRINT((ACPI_DB_INIT,\n\t\t\t  \"Entering sleep state [S%u]\\n\", sleep_state));\n\n\t \n\n\tpm1a_control &= ~(sleep_type_reg_info->access_bit_mask |\n\t\t\t  sleep_enable_reg_info->access_bit_mask);\n\tpm1b_control = pm1a_control;\n\n\t \n\n\tpm1a_control |=\n\t    (acpi_gbl_sleep_type_a << sleep_type_reg_info->bit_position);\n\tpm1b_control |=\n\t    (acpi_gbl_sleep_type_b << sleep_type_reg_info->bit_position);\n\n\t \n\n\t \n\n\tstatus = acpi_hw_write_pm1_control(pm1a_control, pm1b_control);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tpm1a_control |= sleep_enable_reg_info->access_bit_mask;\n\tpm1b_control |= sleep_enable_reg_info->access_bit_mask;\n\n\t \n\n\tif (sleep_state < ACPI_STATE_S4) {\n\t\tACPI_FLUSH_CPU_CACHE();\n\t}\n\n\tstatus = acpi_os_enter_sleep(sleep_state, pm1a_control, pm1b_control);\n\tif (status == AE_CTRL_TERMINATE) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tstatus = acpi_hw_write_pm1_control(pm1a_control, pm1b_control);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tif (sleep_state > ACPI_STATE_S3) {\n\t\t \n\t\tacpi_os_stall(10 * ACPI_USEC_PER_SEC);\n\n\t\tstatus = acpi_hw_register_write(ACPI_REGISTER_PM1_CONTROL,\n\t\t\t\t\t\tsleep_enable_reg_info->\n\t\t\t\t\t\taccess_bit_mask);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\t \n\n\tdo {\n\t\tstatus =\n\t\t    acpi_read_bit_register(ACPI_BITREG_WAKE_STATUS, &in_value);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t} while (!in_value);\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status acpi_hw_legacy_wake_prep(u8 sleep_state)\n{\n\tacpi_status status = AE_OK;\n\tstruct acpi_bit_register_info *sleep_type_reg_info;\n\tstruct acpi_bit_register_info *sleep_enable_reg_info;\n\tu32 pm1a_control;\n\tu32 pm1b_control;\n\n\tACPI_FUNCTION_TRACE(hw_legacy_wake_prep);\n\n\t \n\tif (acpi_gbl_sleep_type_a_s0 != ACPI_SLEEP_TYPE_INVALID) {\n\t\tsleep_type_reg_info =\n\t\t    acpi_hw_get_bit_register_info(ACPI_BITREG_SLEEP_TYPE);\n\t\tsleep_enable_reg_info =\n\t\t    acpi_hw_get_bit_register_info(ACPI_BITREG_SLEEP_ENABLE);\n\n\t\t \n\n\t\tstatus = acpi_hw_register_read(ACPI_REGISTER_PM1_CONTROL,\n\t\t\t\t\t       &pm1a_control);\n\t\tif (ACPI_SUCCESS(status)) {\n\n\t\t\t \n\n\t\t\tpm1a_control &= ~(sleep_type_reg_info->access_bit_mask |\n\t\t\t\t\t  sleep_enable_reg_info->\n\t\t\t\t\t  access_bit_mask);\n\t\t\tpm1b_control = pm1a_control;\n\n\t\t\t \n\n\t\t\tpm1a_control |= (acpi_gbl_sleep_type_a_s0 <<\n\t\t\t\t\t sleep_type_reg_info->bit_position);\n\t\t\tpm1b_control |= (acpi_gbl_sleep_type_b_s0 <<\n\t\t\t\t\t sleep_type_reg_info->bit_position);\n\n\t\t\t \n\n\t\t\t(void)acpi_hw_write_pm1_control(pm1a_control,\n\t\t\t\t\t\t\tpm1b_control);\n\t\t}\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status acpi_hw_legacy_wake(u8 sleep_state)\n{\n\tacpi_status status;\n\n\tACPI_FUNCTION_TRACE(hw_legacy_wake);\n\n\t \n\n\tacpi_gbl_sleep_type_a = ACPI_SLEEP_TYPE_INVALID;\n\tacpi_hw_execute_sleep_method(METHOD_PATHNAME__SST, ACPI_SST_WAKING);\n\n\t \n\tstatus = acpi_hw_disable_all_gpes();\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tstatus = acpi_hw_enable_all_runtime_gpes();\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\tacpi_hw_execute_sleep_method(METHOD_PATHNAME__WAK, sleep_state);\n\n\t \n\t(void)acpi_write_bit_register(ACPI_BITREG_WAKE_STATUS,\n\t\t\t\t      ACPI_CLEAR_STATUS);\n\tacpi_gbl_system_awake_and_running = TRUE;\n\n\t \n\n\t(void)\n\t    acpi_write_bit_register(acpi_gbl_fixed_event_info\n\t\t\t\t    [ACPI_EVENT_POWER_BUTTON].\n\t\t\t\t    enable_register_id, ACPI_ENABLE_EVENT);\n\n\t(void)\n\t    acpi_write_bit_register(acpi_gbl_fixed_event_info\n\t\t\t\t    [ACPI_EVENT_POWER_BUTTON].\n\t\t\t\t    status_register_id, ACPI_CLEAR_STATUS);\n\n\t \n\n\t(void)\n\t    acpi_write_bit_register(acpi_gbl_fixed_event_info\n\t\t\t\t    [ACPI_EVENT_SLEEP_BUTTON].\n\t\t\t\t    enable_register_id, ACPI_ENABLE_EVENT);\n\n\t(void)\n\t    acpi_write_bit_register(acpi_gbl_fixed_event_info\n\t\t\t\t    [ACPI_EVENT_SLEEP_BUTTON].\n\t\t\t\t    status_register_id, ACPI_CLEAR_STATUS);\n\n\tacpi_hw_execute_sleep_method(METHOD_PATHNAME__SST, ACPI_SST_WORKING);\n\treturn_ACPI_STATUS(status);\n}\n\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}