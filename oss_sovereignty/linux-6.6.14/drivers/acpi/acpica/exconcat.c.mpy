{
  "module_name": "exconcat.c",
  "hash_id": "6c9e781b1371640d88945216ce54cca46c39e688abe6b6ce1ec81f4946520990",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exconcat.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acinterp.h\"\n#include \"amlresrc.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exconcat\")\n\n \nstatic acpi_status\nacpi_ex_convert_to_object_type_string(union acpi_operand_object *obj_desc,\n\t\t\t\t      union acpi_operand_object **result_desc);\n\n \n\nacpi_status\nacpi_ex_do_concatenate(union acpi_operand_object *operand0,\n\t\t       union acpi_operand_object *operand1,\n\t\t       union acpi_operand_object **actual_return_desc,\n\t\t       struct acpi_walk_state *walk_state)\n{\n\tunion acpi_operand_object *local_operand0 = operand0;\n\tunion acpi_operand_object *local_operand1 = operand1;\n\tunion acpi_operand_object *temp_operand1 = NULL;\n\tunion acpi_operand_object *return_desc;\n\tchar *buffer;\n\tacpi_object_type operand0_type;\n\tacpi_object_type operand1_type;\n\tacpi_status status;\n\n\tACPI_FUNCTION_TRACE(ex_do_concatenate);\n\n\t \n\n\tswitch (operand0->common.type) {\n\tcase ACPI_TYPE_INTEGER:\n\tcase ACPI_TYPE_STRING:\n\tcase ACPI_TYPE_BUFFER:\n\n\t\toperand0_type = operand0->common.type;\n\t\tbreak;\n\n\tdefault:\n\n\t\t \n\n\t\tstatus =\n\t\t    acpi_ex_convert_to_object_type_string(operand0,\n\t\t\t\t\t\t\t  &local_operand0);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tgoto cleanup;\n\t\t}\n\n\t\toperand0_type = ACPI_TYPE_STRING;\n\t\tbreak;\n\t}\n\n\t \n\n\tswitch (operand1->common.type) {\n\tcase ACPI_TYPE_INTEGER:\n\tcase ACPI_TYPE_STRING:\n\tcase ACPI_TYPE_BUFFER:\n\n\t\toperand1_type = operand1->common.type;\n\t\tbreak;\n\n\tdefault:\n\n\t\t \n\n\t\tstatus =\n\t\t    acpi_ex_convert_to_object_type_string(operand1,\n\t\t\t\t\t\t\t  &local_operand1);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tgoto cleanup;\n\t\t}\n\n\t\toperand1_type = ACPI_TYPE_STRING;\n\t\tbreak;\n\t}\n\n\t \n\tswitch (operand0_type) {\n\tcase ACPI_TYPE_INTEGER:\n\n\t\tstatus =\n\t\t    acpi_ex_convert_to_integer(local_operand1, &temp_operand1,\n\t\t\t\t\t       ACPI_IMPLICIT_CONVERSION);\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\n\n\t\tstatus =\n\t\t    acpi_ex_convert_to_buffer(local_operand1, &temp_operand1);\n\t\tbreak;\n\n\tcase ACPI_TYPE_STRING:\n\n\t\tswitch (operand1_type) {\n\t\tcase ACPI_TYPE_INTEGER:\n\t\tcase ACPI_TYPE_STRING:\n\t\tcase ACPI_TYPE_BUFFER:\n\n\t\t\t \n\n\t\t\tstatus =\n\t\t\t    acpi_ex_convert_to_string(local_operand1,\n\t\t\t\t\t\t      &temp_operand1,\n\t\t\t\t\t\t      ACPI_IMPLICIT_CONVERT_HEX);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tstatus = AE_OK;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\n\t\tACPI_ERROR((AE_INFO, \"Invalid object type: 0x%X\",\n\t\t\t    operand0->common.type));\n\t\tstatus = AE_AML_INTERNAL;\n\t}\n\n\tif (ACPI_FAILURE(status)) {\n\t\tgoto cleanup;\n\t}\n\n\t \n\n\tif ((local_operand1 != operand1) && (local_operand1 != temp_operand1)) {\n\t\tacpi_ut_remove_reference(local_operand1);\n\t}\n\n\tlocal_operand1 = temp_operand1;\n\n\t \n\tswitch (operand0_type) {\n\tcase ACPI_TYPE_INTEGER:\n\n\t\t \n\t\t \n\n\t\treturn_desc = acpi_ut_create_buffer_object((acpi_size)\n\t\t\t\t\t\t\t   ACPI_MUL_2\n\t\t\t\t\t\t\t   (acpi_gbl_integer_byte_width));\n\t\tif (!return_desc) {\n\t\t\tstatus = AE_NO_MEMORY;\n\t\t\tgoto cleanup;\n\t\t}\n\n\t\tbuffer = (char *)return_desc->buffer.pointer;\n\n\t\t \n\n\t\tmemcpy(buffer, &operand0->integer.value,\n\t\t       acpi_gbl_integer_byte_width);\n\n\t\t \n\n\t\tmemcpy(buffer + acpi_gbl_integer_byte_width,\n\t\t       &local_operand1->integer.value,\n\t\t       acpi_gbl_integer_byte_width);\n\t\tbreak;\n\n\tcase ACPI_TYPE_STRING:\n\n\t\t \n\n\t\treturn_desc = acpi_ut_create_string_object(((acpi_size)\n\t\t\t\t\t\t\t    local_operand0->\n\t\t\t\t\t\t\t    string.length +\n\t\t\t\t\t\t\t    local_operand1->\n\t\t\t\t\t\t\t    string.length));\n\t\tif (!return_desc) {\n\t\t\tstatus = AE_NO_MEMORY;\n\t\t\tgoto cleanup;\n\t\t}\n\n\t\tbuffer = return_desc->string.pointer;\n\n\t\t \n\n\t\tstrcpy(buffer, local_operand0->string.pointer);\n\t\tstrcat(buffer, local_operand1->string.pointer);\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\n\n\t\t \n\n\t\treturn_desc = acpi_ut_create_buffer_object(((acpi_size)\n\t\t\t\t\t\t\t    operand0->buffer.\n\t\t\t\t\t\t\t    length +\n\t\t\t\t\t\t\t    local_operand1->\n\t\t\t\t\t\t\t    buffer.length));\n\t\tif (!return_desc) {\n\t\t\tstatus = AE_NO_MEMORY;\n\t\t\tgoto cleanup;\n\t\t}\n\n\t\tbuffer = (char *)return_desc->buffer.pointer;\n\n\t\t \n\n\t\tmemcpy(buffer, operand0->buffer.pointer,\n\t\t       operand0->buffer.length);\n\t\tmemcpy(buffer + operand0->buffer.length,\n\t\t       local_operand1->buffer.pointer,\n\t\t       local_operand1->buffer.length);\n\t\tbreak;\n\n\tdefault:\n\n\t\t \n\n\t\tACPI_ERROR((AE_INFO, \"Invalid object type: 0x%X\",\n\t\t\t    operand0->common.type));\n\t\tstatus = AE_AML_INTERNAL;\n\t\tgoto cleanup;\n\t}\n\n\t*actual_return_desc = return_desc;\n\ncleanup:\n\tif (local_operand0 != operand0) {\n\t\tacpi_ut_remove_reference(local_operand0);\n\t}\n\n\tif (local_operand1 != operand1) {\n\t\tacpi_ut_remove_reference(local_operand1);\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nstatic acpi_status\nacpi_ex_convert_to_object_type_string(union acpi_operand_object *obj_desc,\n\t\t\t\t      union acpi_operand_object **result_desc)\n{\n\tunion acpi_operand_object *return_desc;\n\tconst char *type_string;\n\n\ttype_string = acpi_ut_get_type_name(obj_desc->common.type);\n\n\treturn_desc = acpi_ut_create_string_object(((acpi_size)strlen(type_string) + 9));\t \n\tif (!return_desc) {\n\t\treturn (AE_NO_MEMORY);\n\t}\n\n\tstrcpy(return_desc->string.pointer, \"[\");\n\tstrcat(return_desc->string.pointer, type_string);\n\tstrcat(return_desc->string.pointer, \" Object]\");\n\n\t*result_desc = return_desc;\n\treturn (AE_OK);\n}\n\n \n\nacpi_status\nacpi_ex_concat_template(union acpi_operand_object *operand0,\n\t\t\tunion acpi_operand_object *operand1,\n\t\t\tunion acpi_operand_object **actual_return_desc,\n\t\t\tstruct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tunion acpi_operand_object *return_desc;\n\tu8 *new_buf;\n\tu8 *end_tag;\n\tacpi_size length0;\n\tacpi_size length1;\n\tacpi_size new_length;\n\n\tACPI_FUNCTION_TRACE(ex_concat_template);\n\n\t \n\n\t \n\n\tstatus = acpi_ut_get_resource_end_tag(operand0, &end_tag);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tlength0 = ACPI_PTR_DIFF(end_tag, operand0->buffer.pointer);\n\n\t \n\n\tstatus = acpi_ut_get_resource_end_tag(operand1, &end_tag);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tlength1 = ACPI_PTR_DIFF(end_tag, operand1->buffer.pointer);\n\n\t \n\n\tnew_length = length0 + length1 + sizeof(struct aml_resource_end_tag);\n\n\t \n\n\treturn_desc = acpi_ut_create_buffer_object(new_length);\n\tif (!return_desc) {\n\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t}\n\n\t \n\tnew_buf = return_desc->buffer.pointer;\n\tmemcpy(new_buf, operand0->buffer.pointer, length0);\n\tmemcpy(new_buf + length0, operand1->buffer.pointer, length1);\n\n\t \n\n\tnew_buf[new_length - 1] = 0;\n\tnew_buf[new_length - 2] = ACPI_RESOURCE_NAME_END_TAG | 1;\n\n\t \n\n\t*actual_return_desc = return_desc;\n\treturn_ACPI_STATUS(AE_OK);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}