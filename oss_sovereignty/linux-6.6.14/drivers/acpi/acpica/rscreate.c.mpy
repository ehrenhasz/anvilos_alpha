{
  "module_name": "rscreate.c",
  "hash_id": "402cbca4403b25b2f0f7165fc7154aa2ada188aaa953497043ee2d836b3b7a93",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/rscreate.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acresrc.h\"\n#include \"acnamesp.h\"\n\n#define _COMPONENT          ACPI_RESOURCES\nACPI_MODULE_NAME(\"rscreate\")\n\n \nacpi_status\nacpi_buffer_to_resource(u8 *aml_buffer,\n\t\t\tu16 aml_buffer_length,\n\t\t\tstruct acpi_resource **resource_ptr)\n{\n\tacpi_status status;\n\tacpi_size list_size_needed;\n\tvoid *resource;\n\tvoid *current_resource_ptr;\n\n\tACPI_FUNCTION_TRACE(acpi_buffer_to_resource);\n\n\t \n\n\t \n\n\tstatus =\n\t    acpi_rs_get_list_length(aml_buffer, aml_buffer_length,\n\t\t\t\t    &list_size_needed);\n\tif (status == AE_AML_NO_RESOURCE_END_TAG) {\n\t\tstatus = AE_OK;\n\t}\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tresource = ACPI_ALLOCATE_ZEROED(list_size_needed);\n\tcurrent_resource_ptr = resource;\n\tif (!resource) {\n\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t}\n\n\t \n\n\tstatus = acpi_ut_walk_aml_resources(NULL, aml_buffer, aml_buffer_length,\n\t\t\t\t\t    acpi_rs_convert_aml_to_resources,\n\t\t\t\t\t    &current_resource_ptr);\n\tif (status == AE_AML_NO_RESOURCE_END_TAG) {\n\t\tstatus = AE_OK;\n\t}\n\tif (ACPI_FAILURE(status)) {\n\t\tACPI_FREE(resource);\n\t} else {\n\t\t*resource_ptr = resource;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\nACPI_EXPORT_SYMBOL(acpi_buffer_to_resource)\n\n \nacpi_status\nacpi_rs_create_resource_list(union acpi_operand_object *aml_buffer,\n\t\t\t     struct acpi_buffer *output_buffer)\n{\n\n\tacpi_status status;\n\tu8 *aml_start;\n\tacpi_size list_size_needed = 0;\n\tu32 aml_buffer_length;\n\tvoid *resource;\n\n\tACPI_FUNCTION_TRACE(rs_create_resource_list);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"AmlBuffer = %p\\n\", aml_buffer));\n\n\t \n\n\taml_buffer_length = aml_buffer->buffer.length;\n\taml_start = aml_buffer->buffer.pointer;\n\n\t \n\tstatus = acpi_rs_get_list_length(aml_start, aml_buffer_length,\n\t\t\t\t\t &list_size_needed);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"Status=%X ListSizeNeeded=%X\\n\",\n\t\t\t  status, (u32) list_size_needed));\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tstatus = acpi_ut_initialize_buffer(output_buffer, list_size_needed);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tresource = output_buffer->pointer;\n\tstatus = acpi_ut_walk_aml_resources(NULL, aml_start, aml_buffer_length,\n\t\t\t\t\t    acpi_rs_convert_aml_to_resources,\n\t\t\t\t\t    &resource);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"OutputBuffer %p Length %X\\n\",\n\t\t\t  output_buffer->pointer, (u32) output_buffer->length));\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_rs_create_pci_routing_table(union acpi_operand_object *package_object,\n\t\t\t\t struct acpi_buffer *output_buffer)\n{\n\tu8 *buffer;\n\tunion acpi_operand_object **top_object_list;\n\tunion acpi_operand_object **sub_object_list;\n\tunion acpi_operand_object *obj_desc;\n\tacpi_size buffer_size_needed = 0;\n\tu32 number_of_elements;\n\tu32 index;\n\tstruct acpi_pci_routing_table *user_prt;\n\tstruct acpi_namespace_node *node;\n\tacpi_status status;\n\tstruct acpi_buffer path_buffer;\n\n\tACPI_FUNCTION_TRACE(rs_create_pci_routing_table);\n\n\t \n\n\t \n\n\tstatus =\n\t    acpi_rs_get_pci_routing_table_length(package_object,\n\t\t\t\t\t\t &buffer_size_needed);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"BufferSizeNeeded = %X\\n\",\n\t\t\t  (u32) buffer_size_needed));\n\n\t \n\n\tstatus = acpi_ut_initialize_buffer(output_buffer, buffer_size_needed);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\ttop_object_list = package_object->package.elements;\n\tnumber_of_elements = package_object->package.count;\n\tbuffer = output_buffer->pointer;\n\tuser_prt = ACPI_CAST_PTR(struct acpi_pci_routing_table, buffer);\n\n\tfor (index = 0; index < number_of_elements; index++) {\n\n\t\t \n\t\tbuffer += user_prt->length;\n\t\tuser_prt = ACPI_CAST_PTR(struct acpi_pci_routing_table, buffer);\n\n\t\t \n\t\tuser_prt->length = (sizeof(struct acpi_pci_routing_table) - 4);\n\n\t\t \n\n\t\tif ((*top_object_list)->package.count != 4) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"(PRT[%u]) Need package of length 4, found length %u\",\n\t\t\t\t    index, (*top_object_list)->package.count));\n\t\t\treturn_ACPI_STATUS(AE_AML_PACKAGE_LIMIT);\n\t\t}\n\n\t\t \n\t\tsub_object_list = (*top_object_list)->package.elements;\n\n\t\t \n\n\t\tobj_desc = sub_object_list[0];\n\t\tif (!obj_desc || obj_desc->common.type != ACPI_TYPE_INTEGER) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"(PRT[%u].Address) Need Integer, found %s\",\n\t\t\t\t    index,\n\t\t\t\t    acpi_ut_get_object_type_name(obj_desc)));\n\t\t\treturn_ACPI_STATUS(AE_BAD_DATA);\n\t\t}\n\n\t\tuser_prt->address = obj_desc->integer.value;\n\n\t\t \n\n\t\tobj_desc = sub_object_list[1];\n\t\tif (!obj_desc || obj_desc->common.type != ACPI_TYPE_INTEGER) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"(PRT[%u].Pin) Need Integer, found %s\",\n\t\t\t\t    index,\n\t\t\t\t    acpi_ut_get_object_type_name(obj_desc)));\n\t\t\treturn_ACPI_STATUS(AE_BAD_DATA);\n\t\t}\n\n\t\tuser_prt->pin = (u32) obj_desc->integer.value;\n\n\t\t \n\t\tobj_desc = sub_object_list[2];\n\t\tif (obj_desc) {\n\t\t\tswitch (obj_desc->common.type) {\n\t\t\tcase ACPI_TYPE_LOCAL_REFERENCE:\n\n\t\t\t\tif (obj_desc->reference.class !=\n\t\t\t\t    ACPI_REFCLASS_NAME) {\n\t\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t\t    \"(PRT[%u].Source) Need name, found Reference Class 0x%X\",\n\t\t\t\t\t\t    index,\n\t\t\t\t\t\t    obj_desc->reference.class));\n\t\t\t\t\treturn_ACPI_STATUS(AE_BAD_DATA);\n\t\t\t\t}\n\n\t\t\t\tnode = obj_desc->reference.node;\n\n\t\t\t\t \n\n\t\t\t\tpath_buffer.length = output_buffer->length -\n\t\t\t\t    (u32) ((u8 *) user_prt->source -\n\t\t\t\t\t   (u8 *) output_buffer->pointer);\n\t\t\t\tpath_buffer.pointer = user_prt->source;\n\n\t\t\t\tstatus = acpi_ns_handle_to_pathname((acpi_handle)node, &path_buffer, FALSE);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\n\t\t\t\t \n\n\t\t\t\tuser_prt->length +=\n\t\t\t\t    (u32)strlen(user_prt->source) + 1;\n\t\t\t\tbreak;\n\n\t\t\tcase ACPI_TYPE_STRING:\n\n\t\t\t\tstrcpy(user_prt->source,\n\t\t\t\t       obj_desc->string.pointer);\n\n\t\t\t\t \n\t\t\t\tuser_prt->length += obj_desc->string.length + 1;\n\t\t\t\tbreak;\n\n\t\t\tcase ACPI_TYPE_INTEGER:\n\t\t\t\t \n\t\t\t\tuser_prt->length += sizeof(u32);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"(PRT[%u].Source) Need Ref/String/Integer, found %s\",\n\t\t\t\t\t    index,\n\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t    (obj_desc)));\n\t\t\t\treturn_ACPI_STATUS(AE_BAD_DATA);\n\t\t\t}\n\t\t}\n\n\t\t \n\n\t\tuser_prt->length =\n\t\t    (u32) ACPI_ROUND_UP_TO_64BIT(user_prt->length);\n\n\t\t \n\n\t\tobj_desc = sub_object_list[3];\n\t\tif (!obj_desc || obj_desc->common.type != ACPI_TYPE_INTEGER) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"(PRT[%u].SourceIndex) Need Integer, found %s\",\n\t\t\t\t    index,\n\t\t\t\t    acpi_ut_get_object_type_name(obj_desc)));\n\t\t\treturn_ACPI_STATUS(AE_BAD_DATA);\n\t\t}\n\n\t\tuser_prt->source_index = (u32) obj_desc->integer.value;\n\n\t\t \n\n\t\ttop_object_list++;\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"OutputBuffer %p Length %X\\n\",\n\t\t\t  output_buffer->pointer, (u32) output_buffer->length));\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_rs_create_aml_resources(struct acpi_buffer *resource_list,\n\t\t\t     struct acpi_buffer *output_buffer)\n{\n\tacpi_status status;\n\tacpi_size aml_size_needed = 0;\n\n\tACPI_FUNCTION_TRACE(rs_create_aml_resources);\n\n\t \n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"ResourceList Buffer = %p\\n\",\n\t\t\t  resource_list->pointer));\n\n\t \n\n\tstatus =\n\t    acpi_rs_get_aml_length(resource_list->pointer,\n\t\t\t\t   resource_list->length, &aml_size_needed);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"AmlSizeNeeded=%X, %s\\n\",\n\t\t\t  (u32)aml_size_needed, acpi_format_exception(status)));\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tstatus = acpi_ut_initialize_buffer(output_buffer, aml_size_needed);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tstatus = acpi_rs_convert_resources_to_aml(resource_list->pointer,\n\t\t\t\t\t\t  aml_size_needed,\n\t\t\t\t\t\t  output_buffer->pointer);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO, \"OutputBuffer %p Length %X\\n\",\n\t\t\t  output_buffer->pointer, (u32) output_buffer->length));\n\treturn_ACPI_STATUS(AE_OK);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}