{
  "module_name": "dbstats.c",
  "hash_id": "91517b427af77d06de98a6e8bd6dbfb2909c30faf2a19636d6c2f22580d513a4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dbstats.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acdebug.h\"\n#include \"acnamesp.h\"\n\n#define _COMPONENT          ACPI_CA_DEBUGGER\nACPI_MODULE_NAME(\"dbstats\")\n\n \nstatic void acpi_db_count_namespace_objects(void);\n\nstatic void acpi_db_enumerate_object(union acpi_operand_object *obj_desc);\n\nstatic acpi_status\nacpi_db_classify_one_object(acpi_handle obj_handle,\n\t\t\t    u32 nesting_level,\n\t\t\t    void *context, void **return_value);\n\n#if defined ACPI_DBG_TRACK_ALLOCATIONS || defined ACPI_USE_LOCAL_CACHE\nstatic void acpi_db_list_info(struct acpi_memory_list *list);\n#endif\n\n \nstatic struct acpi_db_argument_info acpi_db_stat_types[] = {\n\t{\"ALLOCATIONS\"},\n\t{\"OBJECTS\"},\n\t{\"MEMORY\"},\n\t{\"MISC\"},\n\t{\"TABLES\"},\n\t{\"SIZES\"},\n\t{\"STACK\"},\n\t{NULL}\t\t\t \n};\n\n#define CMD_STAT_ALLOCATIONS     0\n#define CMD_STAT_OBJECTS         1\n#define CMD_STAT_MEMORY          2\n#define CMD_STAT_MISC            3\n#define CMD_STAT_TABLES          4\n#define CMD_STAT_SIZES           5\n#define CMD_STAT_STACK           6\n\n#if defined ACPI_DBG_TRACK_ALLOCATIONS || defined ACPI_USE_LOCAL_CACHE\n \n\nstatic void acpi_db_list_info(struct acpi_memory_list *list)\n{\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\n\tu32 outstanding;\n#endif\n\n\tacpi_os_printf(\"\\n%s\\n\", list->list_name);\n\n\t \n\n\tif (list->max_depth > 0) {\n\t\tacpi_os_printf\n\t\t    (\"    Cache: [Depth    MaxD Avail  Size]                \"\n\t\t     \"%8.2X %8.2X %8.2X %8.2X\\n\", list->current_depth,\n\t\t     list->max_depth, list->max_depth - list->current_depth,\n\t\t     (list->current_depth * list->object_size));\n\t}\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\n\tif (list->max_depth > 0) {\n\t\tacpi_os_printf\n\t\t    (\"    Cache: [Requests Hits Misses ObjSize]             \"\n\t\t     \"%8.2X %8.2X %8.2X %8.2X\\n\", list->requests, list->hits,\n\t\t     list->requests - list->hits, list->object_size);\n\t}\n\n\toutstanding = acpi_db_get_cache_info(list);\n\n\tif (list->object_size) {\n\t\tacpi_os_printf\n\t\t    (\"    Mem:   [Alloc    Free Max    CurSize Outstanding] \"\n\t\t     \"%8.2X %8.2X %8.2X %8.2X %8.2X\\n\", list->total_allocated,\n\t\t     list->total_freed, list->max_occupied,\n\t\t     outstanding * list->object_size, outstanding);\n\t} else {\n\t\tacpi_os_printf\n\t\t    (\"    Mem:   [Alloc Free Max CurSize Outstanding Total] \"\n\t\t     \"%8.2X %8.2X %8.2X %8.2X %8.2X %8.2X\\n\",\n\t\t     list->total_allocated, list->total_freed,\n\t\t     list->max_occupied, list->current_total_size, outstanding,\n\t\t     list->total_size);\n\t}\n#endif\n}\n#endif\n\n \n\nstatic void acpi_db_enumerate_object(union acpi_operand_object *obj_desc)\n{\n\tu32 i;\n\n\tif (!obj_desc) {\n\t\treturn;\n\t}\n\n\t \n\n\tacpi_gbl_num_objects++;\n\n\tif (obj_desc->common.type > ACPI_TYPE_NS_NODE_MAX) {\n\t\tacpi_gbl_obj_type_count_misc++;\n\t} else {\n\t\tacpi_gbl_obj_type_count[obj_desc->common.type]++;\n\t}\n\n\t \n\n\tswitch (obj_desc->common.type) {\n\tcase ACPI_TYPE_PACKAGE:\n\n\t\tfor (i = 0; i < obj_desc->package.count; i++) {\n\t\t\tacpi_db_enumerate_object(obj_desc->package.elements[i]);\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_TYPE_DEVICE:\n\n\t\tacpi_db_enumerate_object(obj_desc->device.notify_list[0]);\n\t\tacpi_db_enumerate_object(obj_desc->device.notify_list[1]);\n\t\tacpi_db_enumerate_object(obj_desc->device.handler);\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER_FIELD:\n\n\t\tif (acpi_ns_get_secondary_object(obj_desc)) {\n\t\t\tacpi_gbl_obj_type_count[ACPI_TYPE_BUFFER_FIELD]++;\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_TYPE_REGION:\n\n\t\tacpi_gbl_obj_type_count[ACPI_TYPE_LOCAL_REGION_FIELD]++;\n\t\tacpi_db_enumerate_object(obj_desc->region.handler);\n\t\tbreak;\n\n\tcase ACPI_TYPE_POWER:\n\n\t\tacpi_db_enumerate_object(obj_desc->power_resource.\n\t\t\t\t\t notify_list[0]);\n\t\tacpi_db_enumerate_object(obj_desc->power_resource.\n\t\t\t\t\t notify_list[1]);\n\t\tbreak;\n\n\tcase ACPI_TYPE_PROCESSOR:\n\n\t\tacpi_db_enumerate_object(obj_desc->processor.notify_list[0]);\n\t\tacpi_db_enumerate_object(obj_desc->processor.notify_list[1]);\n\t\tacpi_db_enumerate_object(obj_desc->processor.handler);\n\t\tbreak;\n\n\tcase ACPI_TYPE_THERMAL:\n\n\t\tacpi_db_enumerate_object(obj_desc->thermal_zone.notify_list[0]);\n\t\tacpi_db_enumerate_object(obj_desc->thermal_zone.notify_list[1]);\n\t\tacpi_db_enumerate_object(obj_desc->thermal_zone.handler);\n\t\tbreak;\n\n\tdefault:\n\n\t\tbreak;\n\t}\n}\n\n \n\nstatic acpi_status\nacpi_db_classify_one_object(acpi_handle obj_handle,\n\t\t\t    u32 nesting_level,\n\t\t\t    void *context, void **return_value)\n{\n\tstruct acpi_namespace_node *node;\n\tunion acpi_operand_object *obj_desc;\n\tu32 type;\n\n\tacpi_gbl_num_nodes++;\n\n\tnode = (struct acpi_namespace_node *)obj_handle;\n\tobj_desc = acpi_ns_get_attached_object(node);\n\n\tacpi_db_enumerate_object(obj_desc);\n\n\ttype = node->type;\n\tif (type > ACPI_TYPE_NS_NODE_MAX) {\n\t\tacpi_gbl_node_type_count_misc++;\n\t} else {\n\t\tacpi_gbl_node_type_count[type]++;\n\t}\n\n\treturn (AE_OK);\n\n#ifdef ACPI_FUTURE_IMPLEMENTATION\n\n\t \n\n\tif (acpi_ps_is_named_op(op->opcode)) {\n\t\tnum_nodes++;\n\t}\n\n\tif (is_method) {\n\t\tnum_method_elements++;\n\t}\n\n\tnum_grammar_elements++;\n\top = acpi_ps_get_depth_next(root, op);\n\n\tsize_of_parse_tree = (num_grammar_elements - num_method_elements) *\n\t    (u32)sizeof(union acpi_parse_object);\n\tsize_of_method_trees =\n\t    num_method_elements * (u32)sizeof(union acpi_parse_object);\n\tsize_of_node_entries =\n\t    num_nodes * (u32)sizeof(struct acpi_namespace_node);\n\tsize_of_acpi_objects =\n\t    num_nodes * (u32)sizeof(union acpi_operand_object);\n#endif\n}\n\n \n\nstatic void acpi_db_count_namespace_objects(void)\n{\n\tu32 i;\n\n\tacpi_gbl_num_nodes = 0;\n\tacpi_gbl_num_objects = 0;\n\n\tacpi_gbl_obj_type_count_misc = 0;\n\tfor (i = 0; i < (ACPI_TYPE_NS_NODE_MAX - 1); i++) {\n\t\tacpi_gbl_obj_type_count[i] = 0;\n\t\tacpi_gbl_node_type_count[i] = 0;\n\t}\n\n\t(void)acpi_ns_walk_namespace(ACPI_TYPE_ANY, ACPI_ROOT_OBJECT,\n\t\t\t\t     ACPI_UINT32_MAX, FALSE,\n\t\t\t\t     acpi_db_classify_one_object, NULL, NULL,\n\t\t\t\t     NULL);\n}\n\n \n\nacpi_status acpi_db_display_statistics(char *type_arg)\n{\n\tu32 i;\n\tu32 temp;\n\n\tacpi_ut_strupr(type_arg);\n\ttemp = acpi_db_match_argument(type_arg, acpi_db_stat_types);\n\tif (temp == ACPI_TYPE_NOT_FOUND) {\n\t\tacpi_os_printf(\"Invalid or unsupported argument\\n\");\n\t\treturn (AE_OK);\n\t}\n\n\tswitch (temp) {\n\tcase CMD_STAT_ALLOCATIONS:\n\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\n\t\tacpi_ut_dump_allocation_info();\n#endif\n\t\tbreak;\n\n\tcase CMD_STAT_TABLES:\n\n\t\tacpi_os_printf(\"ACPI Table Information (not implemented):\\n\\n\");\n\t\tbreak;\n\n\tcase CMD_STAT_OBJECTS:\n\n\t\tacpi_db_count_namespace_objects();\n\n\t\tacpi_os_printf\n\t\t    (\"\\nObjects defined in the current namespace:\\n\\n\");\n\n\t\tacpi_os_printf(\"%16.16s %10.10s %10.10s\\n\",\n\t\t\t       \"ACPI_TYPE\", \"NODES\", \"OBJECTS\");\n\n\t\tfor (i = 0; i < ACPI_TYPE_NS_NODE_MAX; i++) {\n\t\t\tacpi_os_printf(\"%16.16s %10u %10u\\n\",\n\t\t\t\t       acpi_ut_get_type_name(i),\n\t\t\t\t       acpi_gbl_node_type_count[i],\n\t\t\t\t       acpi_gbl_obj_type_count[i]);\n\t\t}\n\n\t\tacpi_os_printf(\"%16.16s %10u %10u\\n\", \"Misc/Unknown\",\n\t\t\t       acpi_gbl_node_type_count_misc,\n\t\t\t       acpi_gbl_obj_type_count_misc);\n\n\t\tacpi_os_printf(\"%16.16s %10u %10u\\n\", \"TOTALS:\",\n\t\t\t       acpi_gbl_num_nodes, acpi_gbl_num_objects);\n\t\tbreak;\n\n\tcase CMD_STAT_MEMORY:\n\n#ifdef ACPI_DBG_TRACK_ALLOCATIONS\n\t\tacpi_os_printf\n\t\t    (\"\\n----Object Statistics (all in hex)---------\\n\");\n\n\t\tacpi_db_list_info(acpi_gbl_global_list);\n\t\tacpi_db_list_info(acpi_gbl_ns_node_list);\n#endif\n\n#ifdef ACPI_USE_LOCAL_CACHE\n\t\tacpi_os_printf\n\t\t    (\"\\n----Cache Statistics (all in hex)---------\\n\");\n\t\tacpi_db_list_info(acpi_gbl_operand_cache);\n\t\tacpi_db_list_info(acpi_gbl_ps_node_cache);\n\t\tacpi_db_list_info(acpi_gbl_ps_node_ext_cache);\n\t\tacpi_db_list_info(acpi_gbl_state_cache);\n#endif\n\n\t\tbreak;\n\n\tcase CMD_STAT_MISC:\n\n\t\tacpi_os_printf(\"\\nMiscellaneous Statistics:\\n\\n\");\n\t\tacpi_os_printf(\"%-28s:     %7u\\n\", \"Calls to AcpiPsFind\",\n\t\t\t       acpi_gbl_ps_find_count);\n\t\tacpi_os_printf(\"%-28s:     %7u\\n\", \"Calls to AcpiNsLookup\",\n\t\t\t       acpi_gbl_ns_lookup_count);\n\n\t\tacpi_os_printf(\"\\nMutex usage:\\n\\n\");\n\t\tfor (i = 0; i < ACPI_NUM_MUTEX; i++) {\n\t\t\tacpi_os_printf(\"%-28s:     %7u\\n\",\n\t\t\t\t       acpi_ut_get_mutex_name(i),\n\t\t\t\t       acpi_gbl_mutex_info[i].use_count);\n\t\t}\n\t\tbreak;\n\n\tcase CMD_STAT_SIZES:\n\n\t\tacpi_os_printf(\"\\nInternal object sizes:\\n\\n\");\n\n\t\tacpi_os_printf(\"Common         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_common));\n\t\tacpi_os_printf(\"Number         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_integer));\n\t\tacpi_os_printf(\"String         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_string));\n\t\tacpi_os_printf(\"Buffer         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_buffer));\n\t\tacpi_os_printf(\"Package        %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_package));\n\t\tacpi_os_printf(\"BufferField    %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_buffer_field));\n\t\tacpi_os_printf(\"Device         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_device));\n\t\tacpi_os_printf(\"Event          %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_event));\n\t\tacpi_os_printf(\"Method         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_method));\n\t\tacpi_os_printf(\"Mutex          %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_mutex));\n\t\tacpi_os_printf(\"Region         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_region));\n\t\tacpi_os_printf(\"PowerResource  %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_power_resource));\n\t\tacpi_os_printf(\"Processor      %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_processor));\n\t\tacpi_os_printf(\"ThermalZone    %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_thermal_zone));\n\t\tacpi_os_printf(\"RegionField    %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_region_field));\n\t\tacpi_os_printf(\"BankField      %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_bank_field));\n\t\tacpi_os_printf(\"IndexField     %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_index_field));\n\t\tacpi_os_printf(\"Reference      %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_reference));\n\t\tacpi_os_printf(\"Notify         %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_notify_handler));\n\t\tacpi_os_printf(\"AddressSpace   %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_addr_handler));\n\t\tacpi_os_printf(\"Extra          %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_extra));\n\t\tacpi_os_printf(\"Data           %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_object_data));\n\n\t\tacpi_os_printf(\"\\n\");\n\n\t\tacpi_os_printf(\"ParseObject    %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_parse_obj_common));\n\t\tacpi_os_printf(\"ParseObjectNamed %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_parse_obj_named));\n\t\tacpi_os_printf(\"ParseObjectAsl %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_parse_obj_asl));\n\t\tacpi_os_printf(\"OperandObject  %3d\\n\",\n\t\t\t       (u32)sizeof(union acpi_operand_object));\n\t\tacpi_os_printf(\"NamespaceNode  %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_namespace_node));\n\t\tacpi_os_printf(\"AcpiObject     %3d\\n\",\n\t\t\t       (u32)sizeof(union acpi_object));\n\n\t\tacpi_os_printf(\"\\n\");\n\n\t\tacpi_os_printf(\"Generic State  %3d\\n\",\n\t\t\t       (u32)sizeof(union acpi_generic_state));\n\t\tacpi_os_printf(\"Common State   %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_common_state));\n\t\tacpi_os_printf(\"Control State  %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_control_state));\n\t\tacpi_os_printf(\"Update State   %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_update_state));\n\t\tacpi_os_printf(\"Scope State    %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_scope_state));\n\t\tacpi_os_printf(\"Parse Scope    %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_pscope_state));\n\t\tacpi_os_printf(\"Package State  %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_pkg_state));\n\t\tacpi_os_printf(\"Thread State   %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_thread_state));\n\t\tacpi_os_printf(\"Result Values  %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_result_values));\n\t\tacpi_os_printf(\"Notify Info    %3d\\n\",\n\t\t\t       (u32)sizeof(struct acpi_notify_info));\n\t\tbreak;\n\n\tcase CMD_STAT_STACK:\n#if defined(ACPI_DEBUG_OUTPUT)\n\n\t\ttemp =\n\t\t    (u32)ACPI_PTR_DIFF(acpi_gbl_entry_stack_pointer,\n\t\t\t\t       acpi_gbl_lowest_stack_pointer);\n\n\t\tacpi_os_printf(\"\\nSubsystem Stack Usage:\\n\\n\");\n\t\tacpi_os_printf(\"Entry Stack Pointer        %p\\n\",\n\t\t\t       acpi_gbl_entry_stack_pointer);\n\t\tacpi_os_printf(\"Lowest Stack Pointer       %p\\n\",\n\t\t\t       acpi_gbl_lowest_stack_pointer);\n\t\tacpi_os_printf(\"Stack Use                  %X (%u)\\n\", temp,\n\t\t\t       temp);\n\t\tacpi_os_printf(\"Deepest Procedure Nesting  %u\\n\",\n\t\t\t       acpi_gbl_deepest_nesting);\n#endif\n\t\tbreak;\n\n\tdefault:\n\n\t\tbreak;\n\t}\n\n\tacpi_os_printf(\"\\n\");\n\treturn (AE_OK);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}