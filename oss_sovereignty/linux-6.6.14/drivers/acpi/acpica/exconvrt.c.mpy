{
  "module_name": "exconvrt.c",
  "hash_id": "896959d432d2358a8a362482b83c5a9b6256f93c2b23772e1c34923a9c44a2eb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exconvrt.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acinterp.h\"\n#include \"amlcode.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exconvrt\")\n\n \nstatic u32\nacpi_ex_convert_to_ascii(u64 integer, u16 base, u8 *string, u8 max_length);\n\n \n\nacpi_status\nacpi_ex_convert_to_integer(union acpi_operand_object *obj_desc,\n\t\t\t   union acpi_operand_object **result_desc,\n\t\t\t   u32 implicit_conversion)\n{\n\tunion acpi_operand_object *return_desc;\n\tu8 *pointer;\n\tu64 result;\n\tu32 i;\n\tu32 count;\n\n\tACPI_FUNCTION_TRACE_PTR(ex_convert_to_integer, obj_desc);\n\n\tswitch (obj_desc->common.type) {\n\tcase ACPI_TYPE_INTEGER:\n\n\t\t \n\n\t\t*result_desc = obj_desc;\n\t\treturn_ACPI_STATUS(AE_OK);\n\n\tcase ACPI_TYPE_BUFFER:\n\tcase ACPI_TYPE_STRING:\n\n\t\t \n\n\t\tpointer = obj_desc->buffer.pointer;\n\t\tcount = obj_desc->buffer.length;\n\t\tbreak;\n\n\tdefault:\n\n\t\treturn_ACPI_STATUS(AE_TYPE);\n\t}\n\n\t \n\tresult = 0;\n\n\t \n\n\tswitch (obj_desc->common.type) {\n\tcase ACPI_TYPE_STRING:\n\t\t \n\t\tif (implicit_conversion) {\n\t\t\tresult =\n\t\t\t    acpi_ut_implicit_strtoul64(ACPI_CAST_PTR\n\t\t\t\t\t\t       (char, pointer));\n\t\t} else {\n\t\t\tresult =\n\t\t\t    acpi_ut_explicit_strtoul64(ACPI_CAST_PTR\n\t\t\t\t\t\t       (char, pointer));\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\n\n\t\t \n\n\t\tif (!count) {\n\t\t\treturn_ACPI_STATUS(AE_AML_BUFFER_LIMIT);\n\t\t}\n\n\t\t \n\n\t\tif (count > acpi_gbl_integer_byte_width) {\n\t\t\tcount = acpi_gbl_integer_byte_width;\n\t\t}\n\n\t\t \n\t\tfor (i = 0; i < count; i++) {\n\t\t\t \n\t\t\tresult |= (((u64) pointer[i]) << (i * 8));\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\n\t\t \n\n\t\tbreak;\n\t}\n\n\t \n\n\treturn_desc = acpi_ut_create_integer_object(result);\n\tif (!return_desc) {\n\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Converted value: %8.8X%8.8X\\n\",\n\t\t\t  ACPI_FORMAT_UINT64(result)));\n\n\t \n\n\t(void)acpi_ex_truncate_for32bit_table(return_desc);\n\t*result_desc = return_desc;\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_ex_convert_to_buffer(union acpi_operand_object *obj_desc,\n\t\t\t  union acpi_operand_object **result_desc)\n{\n\tunion acpi_operand_object *return_desc;\n\tu8 *new_buf;\n\n\tACPI_FUNCTION_TRACE_PTR(ex_convert_to_buffer, obj_desc);\n\n\tswitch (obj_desc->common.type) {\n\tcase ACPI_TYPE_BUFFER:\n\n\t\t \n\n\t\t*result_desc = obj_desc;\n\t\treturn_ACPI_STATUS(AE_OK);\n\n\tcase ACPI_TYPE_INTEGER:\n\t\t \n\t\treturn_desc =\n\t\t    acpi_ut_create_buffer_object(acpi_gbl_integer_byte_width);\n\t\tif (!return_desc) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\t \n\n\t\tnew_buf = return_desc->buffer.pointer;\n\t\tmemcpy(new_buf, &obj_desc->integer.value,\n\t\t       acpi_gbl_integer_byte_width);\n\t\tbreak;\n\n\tcase ACPI_TYPE_STRING:\n\t\t \n\t\treturn_desc = acpi_ut_create_buffer_object((acpi_size)\n\t\t\t\t\t\t\t   obj_desc->string.\n\t\t\t\t\t\t\t   length + 1);\n\t\tif (!return_desc) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\t \n\n\t\tnew_buf = return_desc->buffer.pointer;\n\t\tstrncpy((char *)new_buf, (char *)obj_desc->string.pointer,\n\t\t\tobj_desc->string.length);\n\t\tbreak;\n\n\tdefault:\n\n\t\treturn_ACPI_STATUS(AE_TYPE);\n\t}\n\n\t \n\n\treturn_desc->common.flags |= AOPOBJ_DATA_VALID;\n\t*result_desc = return_desc;\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nstatic u32\nacpi_ex_convert_to_ascii(u64 integer, u16 base, u8 *string, u8 data_width)\n{\n\tu64 digit;\n\tu32 i;\n\tu32 j;\n\tu32 k = 0;\n\tu32 hex_length;\n\tu32 decimal_length;\n\tu32 remainder;\n\tu8 supress_zeros;\n\n\tACPI_FUNCTION_ENTRY();\n\n\tswitch (base) {\n\tcase 10:\n\n\t\t \n\n\t\tswitch (data_width) {\n\t\tcase 1:\n\n\t\t\tdecimal_length = ACPI_MAX8_DECIMAL_DIGITS;\n\t\t\tbreak;\n\n\t\tcase 4:\n\n\t\t\tdecimal_length = ACPI_MAX32_DECIMAL_DIGITS;\n\t\t\tbreak;\n\n\t\tcase 8:\n\t\tdefault:\n\n\t\t\tdecimal_length = ACPI_MAX64_DECIMAL_DIGITS;\n\t\t\tbreak;\n\t\t}\n\n\t\tsupress_zeros = TRUE;\t \n\t\tremainder = 0;\n\n\t\tfor (i = decimal_length; i > 0; i--) {\n\n\t\t\t \n\n\t\t\tdigit = integer;\n\t\t\tfor (j = 0; j < i; j++) {\n\t\t\t\t(void)acpi_ut_short_divide(digit, 10, &digit,\n\t\t\t\t\t\t\t   &remainder);\n\t\t\t}\n\n\t\t\t \n\n\t\t\tif (remainder != 0) {\n\t\t\t\tsupress_zeros = FALSE;\n\t\t\t}\n\n\t\t\tif (!supress_zeros) {\n\t\t\t\tstring[k] = (u8) (ACPI_ASCII_ZERO + remainder);\n\t\t\t\tk++;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\n\tcase 16:\n\n\t\t \n\n\t\thex_length = (data_width * 2);\n\t\tfor (i = 0, j = (hex_length - 1); i < hex_length; i++, j--) {\n\n\t\t\t \n\n\t\t\tstring[k] = (u8)\n\t\t\t    acpi_ut_hex_to_ascii_char(integer, ACPI_MUL_4(j));\n\t\t\tk++;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\treturn (0);\n\t}\n\n\t \n\tif (!k) {\n\t\tstring[0] = ACPI_ASCII_ZERO;\n\t\tk = 1;\n\t}\n\n\tstring[k] = 0;\n\treturn ((u32) k);\n}\n\n \n\nacpi_status\nacpi_ex_convert_to_string(union acpi_operand_object * obj_desc,\n\t\t\t  union acpi_operand_object ** result_desc, u32 type)\n{\n\tunion acpi_operand_object *return_desc;\n\tu8 *new_buf;\n\tu32 i;\n\tu32 string_length = 0;\n\tu16 base = 16;\n\tu8 separator = ',';\n\n\tACPI_FUNCTION_TRACE_PTR(ex_convert_to_string, obj_desc);\n\n\tswitch (obj_desc->common.type) {\n\tcase ACPI_TYPE_STRING:\n\n\t\t \n\n\t\t*result_desc = obj_desc;\n\t\treturn_ACPI_STATUS(AE_OK);\n\n\tcase ACPI_TYPE_INTEGER:\n\n\t\tswitch (type) {\n\t\tcase ACPI_EXPLICIT_CONVERT_DECIMAL:\n\t\t\t \n\t\t\tstring_length = ACPI_MAX_DECIMAL_DIGITS;\n\t\t\tbase = 10;\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tstring_length = ACPI_MUL_2(acpi_gbl_integer_byte_width);\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\t\treturn_desc =\n\t\t    acpi_ut_create_string_object((acpi_size)string_length);\n\t\tif (!return_desc) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\tnew_buf = return_desc->buffer.pointer;\n\n\t\t \n\n\t\tstring_length =\n\t\t    acpi_ex_convert_to_ascii(obj_desc->integer.value, base,\n\t\t\t\t\t     new_buf,\n\t\t\t\t\t     acpi_gbl_integer_byte_width);\n\n\t\t \n\n\t\treturn_desc->string.length = string_length;\n\t\tnew_buf[string_length] = 0;\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\n\n\t\t \n\n\t\tswitch (type) {\n\t\tcase ACPI_EXPLICIT_CONVERT_DECIMAL:\t \n\t\t\t \n\t\t\tbase = 10;\n\n\t\t\t \n\t\t\tfor (i = 0; i < obj_desc->buffer.length; i++) {\n\t\t\t\tif (obj_desc->buffer.pointer[i] >= 100) {\n\t\t\t\t\tstring_length += 4;\n\t\t\t\t} else if (obj_desc->buffer.pointer[i] >= 10) {\n\t\t\t\t\tstring_length += 3;\n\t\t\t\t} else {\n\t\t\t\t\tstring_length += 2;\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ACPI_IMPLICIT_CONVERT_HEX:\n\t\t\t \n\t\t\tseparator = ' ';\n\t\t\tstring_length = (obj_desc->buffer.length * 5);\n\t\t\tbreak;\n\n\t\tcase ACPI_EXPLICIT_CONVERT_HEX:\n\t\t\t \n\t\t\tseparator = ',';\n\t\t\tstring_length = (obj_desc->buffer.length * 5);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t\t}\n\n\t\t \n\t\tif (string_length) {\n\t\t\tstring_length--;\n\t\t}\n\n\t\treturn_desc =\n\t\t    acpi_ut_create_string_object((acpi_size)string_length);\n\t\tif (!return_desc) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\tnew_buf = return_desc->buffer.pointer;\n\n\t\t \n\t\tfor (i = 0; i < obj_desc->buffer.length; i++) {\n\t\t\tif (base == 16) {\n\n\t\t\t\t \n\n\t\t\t\t*new_buf++ = '0';\n\t\t\t\t*new_buf++ = 'x';\n\t\t\t}\n\n\t\t\tnew_buf += acpi_ex_convert_to_ascii((u64) obj_desc->\n\t\t\t\t\t\t\t    buffer.pointer[i],\n\t\t\t\t\t\t\t    base, new_buf, 1);\n\n\t\t\t \n\n\t\t\t*new_buf++ = separator;\n\t\t}\n\n\t\t \n\t\tif (obj_desc->buffer.length) {\n\t\t\tnew_buf--;\n\t\t}\n\t\t*new_buf = 0;\n\t\tbreak;\n\n\tdefault:\n\n\t\treturn_ACPI_STATUS(AE_TYPE);\n\t}\n\n\t*result_desc = return_desc;\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_ex_convert_to_target_type(acpi_object_type destination_type,\n\t\t\t       union acpi_operand_object *source_desc,\n\t\t\t       union acpi_operand_object **result_desc,\n\t\t\t       struct acpi_walk_state *walk_state)\n{\n\tacpi_status status = AE_OK;\n\n\tACPI_FUNCTION_TRACE(ex_convert_to_target_type);\n\n\t \n\n\t*result_desc = source_desc;\n\n\t \n\tswitch (GET_CURRENT_ARG_TYPE(walk_state->op_info->runtime_args)) {\n\tcase ARGI_SIMPLE_TARGET:\n\tcase ARGI_FIXED_TARGET:\n\tcase ARGI_INTEGER_REF:\t \n\n\t\tswitch (destination_type) {\n\t\tcase ACPI_TYPE_LOCAL_REGION_FIELD:\n\t\t\t \n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tif (destination_type != source_desc->common.type) {\n\t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n\t\t\t\t\t\t  \"Explicit operator, will store (%s) over existing type (%s)\\n\",\n\t\t\t\t\t\t  acpi_ut_get_object_type_name\n\t\t\t\t\t\t  (source_desc),\n\t\t\t\t\t\t  acpi_ut_get_type_name\n\t\t\t\t\t\t  (destination_type)));\n\t\t\t\tstatus = AE_TYPE;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\n\tcase ARGI_TARGETREF:\n\tcase ARGI_STORE_TARGET:\n\n\t\tswitch (destination_type) {\n\t\tcase ACPI_TYPE_INTEGER:\n\t\tcase ACPI_TYPE_BUFFER_FIELD:\n\t\tcase ACPI_TYPE_LOCAL_BANK_FIELD:\n\t\tcase ACPI_TYPE_LOCAL_INDEX_FIELD:\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ex_convert_to_integer(source_desc, result_desc,\n\t\t\t\t\t\t       ACPI_IMPLICIT_CONVERSION);\n\t\t\tbreak;\n\n\t\tcase ACPI_TYPE_STRING:\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ex_convert_to_string(source_desc, result_desc,\n\t\t\t\t\t\t      ACPI_IMPLICIT_CONVERT_HEX);\n\t\t\tbreak;\n\n\t\tcase ACPI_TYPE_BUFFER:\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ex_convert_to_buffer(source_desc, result_desc);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Bad destination type during conversion: 0x%X\",\n\t\t\t\t    destination_type));\n\t\t\tstatus = AE_AML_INTERNAL;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase ARGI_REFERENCE:\n\t\t \n\t\tbreak;\n\n\tdefault:\n\n\t\tACPI_ERROR((AE_INFO,\n\t\t\t    \"Unknown Target type ID 0x%X AmlOpcode 0x%X DestType %s\",\n\t\t\t    GET_CURRENT_ARG_TYPE(walk_state->op_info->\n\t\t\t\t\t\t runtime_args),\n\t\t\t    walk_state->opcode,\n\t\t\t    acpi_ut_get_type_name(destination_type)));\n\t\tstatus = AE_AML_INTERNAL;\n\t}\n\n\t \n\tif (status == AE_TYPE) {\n\t\tstatus = AE_OK;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}