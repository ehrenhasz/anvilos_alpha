{
  "module_name": "utprint.c",
  "hash_id": "5b5ddf03d627bd9f6fe675563499a0a0a700e472816e0bb8a5bee1a2aca35092",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/utprint.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n\n#define _COMPONENT          ACPI_UTILITIES\nACPI_MODULE_NAME(\"utprint\")\n\n#define ACPI_FORMAT_SIGN            0x01\n#define ACPI_FORMAT_SIGN_PLUS       0x02\n#define ACPI_FORMAT_SIGN_PLUS_SPACE 0x04\n#define ACPI_FORMAT_ZERO            0x08\n#define ACPI_FORMAT_LEFT            0x10\n#define ACPI_FORMAT_UPPER           0x20\n#define ACPI_FORMAT_PREFIX          0x40\n \nstatic acpi_size\nacpi_ut_bound_string_length(const char *string, acpi_size count);\n\nstatic char *acpi_ut_bound_string_output(char *string, const char *end, char c);\n\nstatic char *acpi_ut_format_number(char *string,\n\t\t\t\t   char *end,\n\t\t\t\t   u64 number,\n\t\t\t\t   u8 base, s32 width, s32 precision, u8 type);\n\nstatic char *acpi_ut_put_number(char *string, u64 number, u8 base, u8 upper);\n\n \n\nstatic acpi_size\nacpi_ut_bound_string_length(const char *string, acpi_size count)\n{\n\tu32 length = 0;\n\n\twhile (*string && count) {\n\t\tlength++;\n\t\tstring++;\n\t\tcount--;\n\t}\n\n\treturn (length);\n}\n\n \n\nstatic char *acpi_ut_bound_string_output(char *string, const char *end, char c)\n{\n\n\tif (string < end) {\n\t\t*string = c;\n\t}\n\n\t++string;\n\treturn (string);\n}\n\n \n\nstatic char *acpi_ut_put_number(char *string, u64 number, u8 base, u8 upper)\n{\n\tconst char *digits;\n\tu64 digit_index;\n\tchar *pos;\n\n\tpos = string;\n\tdigits = upper ? acpi_gbl_upper_hex_digits : acpi_gbl_lower_hex_digits;\n\n\tif (number == 0) {\n\t\t*(pos++) = '0';\n\t} else {\n\t\twhile (number) {\n\t\t\t(void)acpi_ut_divide(number, base, &number,\n\t\t\t\t\t     &digit_index);\n\t\t\t*(pos++) = digits[digit_index];\n\t\t}\n\t}\n\n\t \n\treturn (pos);\n}\n\n \n\nconst char *acpi_ut_scan_number(const char *string, u64 *number_ptr)\n{\n\tu64 number = 0;\n\n\twhile (isdigit((int)*string)) {\n\t\tacpi_ut_short_multiply(number, 10, &number);\n\t\tnumber += *(string++) - '0';\n\t}\n\n\t*number_ptr = number;\n\treturn (string);\n}\n\n \n\nconst char *acpi_ut_print_number(char *string, u64 number)\n{\n\tchar ascii_string[20];\n\tconst char *pos1;\n\tchar *pos2;\n\n\tpos1 = acpi_ut_put_number(ascii_string, number, 10, FALSE);\n\tpos2 = string;\n\n\twhile (pos1 != ascii_string) {\n\t\t*(pos2++) = *(--pos1);\n\t}\n\n\t*pos2 = 0;\n\treturn (string);\n}\n\n \n\nstatic char *acpi_ut_format_number(char *string,\n\t\t\t\t   char *end,\n\t\t\t\t   u64 number,\n\t\t\t\t   u8 base, s32 width, s32 precision, u8 type)\n{\n\tchar *pos;\n\tchar sign;\n\tchar zero;\n\tu8 need_prefix;\n\tu8 upper;\n\ts32 i;\n\tchar reversed_string[66];\n\n\t \n\n\tif (base < 2 || base > 16) {\n\t\treturn (NULL);\n\t}\n\n\tif (type & ACPI_FORMAT_LEFT) {\n\t\ttype &= ~ACPI_FORMAT_ZERO;\n\t}\n\n\tneed_prefix = ((type & ACPI_FORMAT_PREFIX)\n\t\t       && base != 10) ? TRUE : FALSE;\n\tupper = (type & ACPI_FORMAT_UPPER) ? TRUE : FALSE;\n\tzero = (type & ACPI_FORMAT_ZERO) ? '0' : ' ';\n\n\t \n\n\tsign = '\\0';\n\tif (type & ACPI_FORMAT_SIGN) {\n\t\tif ((s64)number < 0) {\n\t\t\tsign = '-';\n\t\t\tnumber = -(s64)number;\n\t\t\twidth--;\n\t\t} else if (type & ACPI_FORMAT_SIGN_PLUS) {\n\t\t\tsign = '+';\n\t\t\twidth--;\n\t\t} else if (type & ACPI_FORMAT_SIGN_PLUS_SPACE) {\n\t\t\tsign = ' ';\n\t\t\twidth--;\n\t\t}\n\t}\n\tif (need_prefix) {\n\t\twidth--;\n\t\tif (base == 16) {\n\t\t\twidth--;\n\t\t}\n\t}\n\n\t \n\n\tpos = acpi_ut_put_number(reversed_string, number, base, upper);\n\ti = (s32)ACPI_PTR_DIFF(pos, reversed_string);\n\n\t \n\n\tif (i > precision) {\n\t\tprecision = i;\n\t}\n\n\twidth -= precision;\n\n\t \n\n\tif (!(type & (ACPI_FORMAT_ZERO | ACPI_FORMAT_LEFT))) {\n\t\twhile (--width >= 0) {\n\t\t\tstring = acpi_ut_bound_string_output(string, end, ' ');\n\t\t}\n\t}\n\tif (sign) {\n\t\tstring = acpi_ut_bound_string_output(string, end, sign);\n\t}\n\tif (need_prefix) {\n\t\tstring = acpi_ut_bound_string_output(string, end, '0');\n\t\tif (base == 16) {\n\t\t\tstring =\n\t\t\t    acpi_ut_bound_string_output(string, end,\n\t\t\t\t\t\t\tupper ? 'X' : 'x');\n\t\t}\n\t}\n\tif (!(type & ACPI_FORMAT_LEFT)) {\n\t\twhile (--width >= 0) {\n\t\t\tstring = acpi_ut_bound_string_output(string, end, zero);\n\t\t}\n\t}\n\n\twhile (i <= --precision) {\n\t\tstring = acpi_ut_bound_string_output(string, end, '0');\n\t}\n\twhile (--i >= 0) {\n\t\tstring = acpi_ut_bound_string_output(string, end,\n\t\t\t\t\t\t     reversed_string[i]);\n\t}\n\twhile (--width >= 0) {\n\t\tstring = acpi_ut_bound_string_output(string, end, ' ');\n\t}\n\n\treturn (string);\n}\n\n \n\nint vsnprintf(char *string, acpi_size size, const char *format, va_list args)\n{\n\tu8 base;\n\tu8 type;\n\ts32 width;\n\ts32 precision;\n\tchar qualifier;\n\tu64 number;\n\tchar *pos;\n\tchar *end;\n\tchar c;\n\tconst char *s;\n\tconst void *p;\n\ts32 length;\n\tint i;\n\n\tpos = string;\n\n\tif (size != ACPI_UINT32_MAX) {\n\t\tend = string + size;\n\t} else {\n\t\tend = ACPI_CAST_PTR(char, ACPI_UINT32_MAX);\n\t}\n\n\tfor (; *format; ++format) {\n\t\tif (*format != '%') {\n\t\t\tpos = acpi_ut_bound_string_output(pos, end, *format);\n\t\t\tcontinue;\n\t\t}\n\n\t\ttype = 0;\n\t\tbase = 10;\n\n\t\t \n\n\t\tdo {\n\t\t\t++format;\n\t\t\tif (*format == '#') {\n\t\t\t\ttype |= ACPI_FORMAT_PREFIX;\n\t\t\t} else if (*format == '0') {\n\t\t\t\ttype |= ACPI_FORMAT_ZERO;\n\t\t\t} else if (*format == '+') {\n\t\t\t\ttype |= ACPI_FORMAT_SIGN_PLUS;\n\t\t\t} else if (*format == ' ') {\n\t\t\t\ttype |= ACPI_FORMAT_SIGN_PLUS_SPACE;\n\t\t\t} else if (*format == '-') {\n\t\t\t\ttype |= ACPI_FORMAT_LEFT;\n\t\t\t} else {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t} while (1);\n\n\t\t \n\n\t\twidth = -1;\n\t\tif (isdigit((int)*format)) {\n\t\t\tformat = acpi_ut_scan_number(format, &number);\n\t\t\twidth = (s32)number;\n\t\t} else if (*format == '*') {\n\t\t\t++format;\n\t\t\twidth = va_arg(args, int);\n\t\t\tif (width < 0) {\n\t\t\t\twidth = -width;\n\t\t\t\ttype |= ACPI_FORMAT_LEFT;\n\t\t\t}\n\t\t}\n\n\t\t \n\n\t\tprecision = -1;\n\t\tif (*format == '.') {\n\t\t\t++format;\n\t\t\tif (isdigit((int)*format)) {\n\t\t\t\tformat = acpi_ut_scan_number(format, &number);\n\t\t\t\tprecision = (s32)number;\n\t\t\t} else if (*format == '*') {\n\t\t\t\t++format;\n\t\t\t\tprecision = va_arg(args, int);\n\t\t\t}\n\n\t\t\tif (precision < 0) {\n\t\t\t\tprecision = 0;\n\t\t\t}\n\t\t}\n\n\t\t \n\n\t\tqualifier = -1;\n\t\tif (*format == 'h' || *format == 'l' || *format == 'L') {\n\t\t\tqualifier = *format;\n\t\t\t++format;\n\n\t\t\tif (qualifier == 'l' && *format == 'l') {\n\t\t\t\tqualifier = 'L';\n\t\t\t\t++format;\n\t\t\t}\n\t\t}\n\n\t\tswitch (*format) {\n\t\tcase '%':\n\n\t\t\tpos = acpi_ut_bound_string_output(pos, end, '%');\n\t\t\tcontinue;\n\n\t\tcase 'c':\n\n\t\t\tif (!(type & ACPI_FORMAT_LEFT)) {\n\t\t\t\twhile (--width > 0) {\n\t\t\t\t\tpos =\n\t\t\t\t\t    acpi_ut_bound_string_output(pos,\n\t\t\t\t\t\t\t\t\tend,\n\t\t\t\t\t\t\t\t\t' ');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tc = (char)va_arg(args, int);\n\t\t\tpos = acpi_ut_bound_string_output(pos, end, c);\n\n\t\t\twhile (--width > 0) {\n\t\t\t\tpos =\n\t\t\t\t    acpi_ut_bound_string_output(pos, end, ' ');\n\t\t\t}\n\t\t\tcontinue;\n\n\t\tcase 's':\n\n\t\t\ts = va_arg(args, char *);\n\t\t\tif (!s) {\n\t\t\t\ts = \"<NULL>\";\n\t\t\t}\n\t\t\tlength = (s32)acpi_ut_bound_string_length(s, precision);\n\t\t\tif (!(type & ACPI_FORMAT_LEFT)) {\n\t\t\t\twhile (length < width--) {\n\t\t\t\t\tpos =\n\t\t\t\t\t    acpi_ut_bound_string_output(pos,\n\t\t\t\t\t\t\t\t\tend,\n\t\t\t\t\t\t\t\t\t' ');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (i = 0; i < length; ++i) {\n\t\t\t\tpos = acpi_ut_bound_string_output(pos, end, *s);\n\t\t\t\t++s;\n\t\t\t}\n\n\t\t\twhile (length < width--) {\n\t\t\t\tpos =\n\t\t\t\t    acpi_ut_bound_string_output(pos, end, ' ');\n\t\t\t}\n\t\t\tcontinue;\n\n\t\tcase 'o':\n\n\t\t\tbase = 8;\n\t\t\tbreak;\n\n\t\tcase 'X':\n\n\t\t\ttype |= ACPI_FORMAT_UPPER;\n\t\t\tACPI_FALLTHROUGH;\n\n\t\tcase 'x':\n\n\t\t\tbase = 16;\n\t\t\tbreak;\n\n\t\tcase 'd':\n\t\tcase 'i':\n\n\t\t\ttype |= ACPI_FORMAT_SIGN;\n\n\t\tcase 'u':\n\n\t\t\tbreak;\n\n\t\tcase 'p':\n\n\t\t\tif (width == -1) {\n\t\t\t\twidth = 2 * sizeof(void *);\n\t\t\t\ttype |= ACPI_FORMAT_ZERO;\n\t\t\t}\n\n\t\t\tp = va_arg(args, void *);\n\t\t\tpos =\n\t\t\t    acpi_ut_format_number(pos, end, ACPI_TO_INTEGER(p),\n\t\t\t\t\t\t  16, width, precision, type);\n\t\t\tcontinue;\n\n\t\tdefault:\n\n\t\t\tpos = acpi_ut_bound_string_output(pos, end, '%');\n\t\t\tif (*format) {\n\t\t\t\tpos =\n\t\t\t\t    acpi_ut_bound_string_output(pos, end,\n\t\t\t\t\t\t\t\t*format);\n\t\t\t} else {\n\t\t\t\t--format;\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (qualifier == 'L') {\n\t\t\tnumber = va_arg(args, u64);\n\t\t\tif (type & ACPI_FORMAT_SIGN) {\n\t\t\t\tnumber = (s64)number;\n\t\t\t}\n\t\t} else if (qualifier == 'l') {\n\t\t\tnumber = va_arg(args, unsigned long);\n\t\t\tif (type & ACPI_FORMAT_SIGN) {\n\t\t\t\tnumber = (s32)number;\n\t\t\t}\n\t\t} else if (qualifier == 'h') {\n\t\t\tnumber = (u16)va_arg(args, int);\n\t\t\tif (type & ACPI_FORMAT_SIGN) {\n\t\t\t\tnumber = (s16)number;\n\t\t\t}\n\t\t} else {\n\t\t\tnumber = va_arg(args, unsigned int);\n\t\t\tif (type & ACPI_FORMAT_SIGN) {\n\t\t\t\tnumber = (signed int)number;\n\t\t\t}\n\t\t}\n\n\t\tpos = acpi_ut_format_number(pos, end, number, base,\n\t\t\t\t\t    width, precision, type);\n\t}\n\n\tif (size > 0) {\n\t\tif (pos < end) {\n\t\t\t*pos = '\\0';\n\t\t} else {\n\t\t\tend[-1] = '\\0';\n\t\t}\n\t}\n\n\treturn ((int)ACPI_PTR_DIFF(pos, string));\n}\n\n \n\nint snprintf(char *string, acpi_size size, const char *format, ...)\n{\n\tva_list args;\n\tint length;\n\n\tva_start(args, format);\n\tlength = vsnprintf(string, size, format, args);\n\tva_end(args);\n\n\treturn (length);\n}\n\n \n\nint sprintf(char *string, const char *format, ...)\n{\n\tva_list args;\n\tint length;\n\n\tva_start(args, format);\n\tlength = vsnprintf(string, ACPI_UINT32_MAX, format, args);\n\tva_end(args);\n\n\treturn (length);\n}\n\n#ifdef ACPI_APPLICATION\n \n\nint vprintf(const char *format, va_list args)\n{\n\tacpi_cpu_flags flags;\n\tint length;\n\n\tflags = acpi_os_acquire_lock(acpi_gbl_print_lock);\n\tlength = vsnprintf(acpi_gbl_print_buffer,\n\t\t\t   sizeof(acpi_gbl_print_buffer), format, args);\n\n\t(void)fwrite(acpi_gbl_print_buffer, length, 1, ACPI_FILE_OUT);\n\tacpi_os_release_lock(acpi_gbl_print_lock, flags);\n\n\treturn (length);\n}\n\n \n\nint printf(const char *format, ...)\n{\n\tva_list args;\n\tint length;\n\n\tva_start(args, format);\n\tlength = vprintf(format, args);\n\tva_end(args);\n\n\treturn (length);\n}\n\n \n\nint vfprintf(FILE * file, const char *format, va_list args)\n{\n\tacpi_cpu_flags flags;\n\tint length;\n\n\tflags = acpi_os_acquire_lock(acpi_gbl_print_lock);\n\tlength = vsnprintf(acpi_gbl_print_buffer,\n\t\t\t   sizeof(acpi_gbl_print_buffer), format, args);\n\n\t(void)fwrite(acpi_gbl_print_buffer, length, 1, file);\n\tacpi_os_release_lock(acpi_gbl_print_lock, flags);\n\n\treturn (length);\n}\n\n \n\nint fprintf(FILE * file, const char *format, ...)\n{\n\tva_list args;\n\tint length;\n\n\tva_start(args, format);\n\tlength = vfprintf(file, format, args);\n\tva_end(args);\n\n\treturn (length);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}