{
  "module_name": "exstore.c",
  "hash_id": "63ce62ffbd511329699023bcb31748867b3d3d73ef19c926051a7aea4e063df3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exstore.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acdispat.h\"\n#include \"acinterp.h\"\n#include \"amlcode.h\"\n#include \"acnamesp.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exstore\")\n\n \nstatic acpi_status\nacpi_ex_store_object_to_index(union acpi_operand_object *val_desc,\n\t\t\t      union acpi_operand_object *dest_desc,\n\t\t\t      struct acpi_walk_state *walk_state);\n\nstatic acpi_status\nacpi_ex_store_direct_to_node(union acpi_operand_object *source_desc,\n\t\t\t     struct acpi_namespace_node *node,\n\t\t\t     struct acpi_walk_state *walk_state);\n\n \n\nacpi_status\nacpi_ex_store(union acpi_operand_object *source_desc,\n\t      union acpi_operand_object *dest_desc,\n\t      struct acpi_walk_state *walk_state)\n{\n\tacpi_status status = AE_OK;\n\tunion acpi_operand_object *ref_desc = dest_desc;\n\n\tACPI_FUNCTION_TRACE_PTR(ex_store, dest_desc);\n\n\t \n\n\tif (!source_desc || !dest_desc) {\n\t\tACPI_ERROR((AE_INFO, \"Null parameter\"));\n\t\treturn_ACPI_STATUS(AE_AML_NO_OPERAND);\n\t}\n\n\t \n\n\tif (ACPI_GET_DESCRIPTOR_TYPE(dest_desc) == ACPI_DESC_TYPE_NAMED) {\n\t\t \n\t\tstatus = acpi_ex_store_object_to_node(source_desc,\n\t\t\t\t\t\t      (struct\n\t\t\t\t\t\t       acpi_namespace_node *)\n\t\t\t\t\t\t      dest_desc, walk_state,\n\t\t\t\t\t\t      ACPI_IMPLICIT_CONVERSION);\n\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tswitch (dest_desc->common.type) {\n\tcase ACPI_TYPE_LOCAL_REFERENCE:\n\n\t\tbreak;\n\n\tcase ACPI_TYPE_INTEGER:\n\n\t\t \n\n\t\tif (dest_desc->common.flags & AOPOBJ_AML_CONSTANT) {\n\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t}\n\n\t\tACPI_FALLTHROUGH;\n\n\tdefault:\n\n\t\t \n\n\t\tACPI_ERROR((AE_INFO,\n\t\t\t    \"Target is not a Reference or Constant object - [%s] %p\",\n\t\t\t    acpi_ut_get_object_type_name(dest_desc),\n\t\t\t    dest_desc));\n\n\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t}\n\n\t \n\tswitch (ref_desc->reference.class) {\n\tcase ACPI_REFCLASS_REFOF:\n\n\t\t \n\n\t\tstatus = acpi_ex_store_object_to_node(source_desc,\n\t\t\t\t\t\t      ref_desc->reference.\n\t\t\t\t\t\t      object, walk_state,\n\t\t\t\t\t\t      ACPI_IMPLICIT_CONVERSION);\n\t\tbreak;\n\n\tcase ACPI_REFCLASS_INDEX:\n\n\t\t \n\n\t\tstatus =\n\t\t    acpi_ex_store_object_to_index(source_desc, ref_desc,\n\t\t\t\t\t\t  walk_state);\n\t\tbreak;\n\n\tcase ACPI_REFCLASS_LOCAL:\n\tcase ACPI_REFCLASS_ARG:\n\n\t\t \n\n\t\tstatus =\n\t\t    acpi_ds_store_object_to_local(ref_desc->reference.class,\n\t\t\t\t\t\t  ref_desc->reference.value,\n\t\t\t\t\t\t  source_desc, walk_state);\n\t\tbreak;\n\n\tcase ACPI_REFCLASS_DEBUG:\n\t\t \n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t  \"**** Write to Debug Object: Object %p [%s] ****:\\n\\n\",\n\t\t\t\t  source_desc,\n\t\t\t\t  acpi_ut_get_object_type_name(source_desc)));\n\n\t\tACPI_DEBUG_OBJECT(source_desc, 0, 0);\n\t\tbreak;\n\n\tdefault:\n\n\t\tACPI_ERROR((AE_INFO, \"Unknown Reference Class 0x%2.2X\",\n\t\t\t    ref_desc->reference.class));\n\t\tACPI_DUMP_ENTRY(ref_desc, ACPI_LV_INFO);\n\n\t\tstatus = AE_AML_INTERNAL;\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nstatic acpi_status\nacpi_ex_store_object_to_index(union acpi_operand_object *source_desc,\n\t\t\t      union acpi_operand_object *index_desc,\n\t\t\t      struct acpi_walk_state *walk_state)\n{\n\tacpi_status status = AE_OK;\n\tunion acpi_operand_object *obj_desc;\n\tunion acpi_operand_object *new_desc;\n\tu8 value = 0;\n\tu32 i;\n\n\tACPI_FUNCTION_TRACE(ex_store_object_to_index);\n\n\t \n\tswitch (index_desc->reference.target_type) {\n\tcase ACPI_TYPE_PACKAGE:\n\t\t \n\t\tobj_desc = *(index_desc->reference.where);\n\n\t\tif (source_desc->common.type == ACPI_TYPE_LOCAL_REFERENCE &&\n\t\t    source_desc->reference.class == ACPI_REFCLASS_TABLE) {\n\n\t\t\t \n\n\t\t\tacpi_ut_add_reference(source_desc);\n\t\t\tnew_desc = source_desc;\n\t\t} else {\n\t\t\t \n\n\t\t\tstatus =\n\t\t\t    acpi_ut_copy_iobject_to_iobject(source_desc,\n\t\t\t\t\t\t\t    &new_desc,\n\t\t\t\t\t\t\t    walk_state);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t}\n\n\t\tif (obj_desc) {\n\n\t\t\t \n\n\t\t\tfor (i = 0; i < ((union acpi_operand_object *)\n\t\t\t\t\t index_desc->reference.object)->common.\n\t\t\t     reference_count; i++) {\n\t\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\t}\n\t\t}\n\n\t\t*(index_desc->reference.where) = new_desc;\n\n\t\t \n\n\t\tfor (i = 1; i < ((union acpi_operand_object *)\n\t\t\t\t index_desc->reference.object)->common.\n\t\t     reference_count; i++) {\n\t\t\tacpi_ut_add_reference(new_desc);\n\t\t}\n\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER_FIELD:\n\t\t \n\n\t\t \n\t\tobj_desc = index_desc->reference.object;\n\t\tif ((obj_desc->common.type != ACPI_TYPE_BUFFER) &&\n\t\t    (obj_desc->common.type != ACPI_TYPE_STRING)) {\n\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t}\n\n\t\t \n\t\tswitch (source_desc->common.type) {\n\t\tcase ACPI_TYPE_INTEGER:\n\n\t\t\t \n\n\t\t\tvalue = (u8) (source_desc->integer.value);\n\t\t\tbreak;\n\n\t\tcase ACPI_TYPE_BUFFER:\n\t\tcase ACPI_TYPE_STRING:\n\n\t\t\t \n\n\t\t\tvalue = source_desc->buffer.pointer[0];\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Source must be type [Integer/Buffer/String], found [%s]\",\n\t\t\t\t    acpi_ut_get_object_type_name(source_desc)));\n\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t}\n\n\t\t \n\n\t\tobj_desc->buffer.pointer[index_desc->reference.value] = value;\n\t\tbreak;\n\n\tdefault:\n\t\tACPI_ERROR((AE_INFO,\n\t\t\t    \"Target is not of type [Package/BufferField]\"));\n\t\tstatus = AE_AML_TARGET_TYPE;\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ex_store_object_to_node(union acpi_operand_object *source_desc,\n\t\t\t     struct acpi_namespace_node *node,\n\t\t\t     struct acpi_walk_state *walk_state,\n\t\t\t     u8 implicit_conversion)\n{\n\tacpi_status status = AE_OK;\n\tunion acpi_operand_object *target_desc;\n\tunion acpi_operand_object *new_desc;\n\tacpi_object_type target_type;\n\n\tACPI_FUNCTION_TRACE_PTR(ex_store_object_to_node, source_desc);\n\n\t \n\n\ttarget_type = acpi_ns_get_type(node);\n\ttarget_desc = acpi_ns_get_attached_object(node);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Storing %p [%s] to node %p [%s]\\n\",\n\t\t\t  source_desc,\n\t\t\t  acpi_ut_get_object_type_name(source_desc), node,\n\t\t\t  acpi_ut_get_type_name(target_type)));\n\n\t \n\n\tif (walk_state->opcode != AML_COPY_OBJECT_OP) {\n\t\t \n\t\tswitch (target_type) {\n\t\tcase ACPI_TYPE_PACKAGE:\n\t\t\t \n\t\t\tif (walk_state->opcode == AML_STORE_OP) {\n\t\t\t\tif (source_desc->common.type !=\n\t\t\t\t    ACPI_TYPE_PACKAGE) {\n\t\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t\t    \"Cannot assign type [%s] to [Package] \"\n\t\t\t\t\t\t    \"(source must be type Pkg)\",\n\t\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t\t    (source_desc)));\n\n\t\t\t\t\treturn_ACPI_STATUS(AE_AML_TARGET_TYPE);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tACPI_FALLTHROUGH;\n\n\t\tcase ACPI_TYPE_DEVICE:\n\t\tcase ACPI_TYPE_EVENT:\n\t\tcase ACPI_TYPE_MUTEX:\n\t\tcase ACPI_TYPE_REGION:\n\t\tcase ACPI_TYPE_POWER:\n\t\tcase ACPI_TYPE_PROCESSOR:\n\t\tcase ACPI_TYPE_THERMAL:\n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Target must be [Buffer/Integer/String/Reference]\"\n\t\t\t\t    \", found [%s] (%4.4s)\",\n\t\t\t\t    acpi_ut_get_type_name(node->type),\n\t\t\t\t    node->name.ascii));\n\n\t\t\treturn_ACPI_STATUS(AE_AML_TARGET_TYPE);\n\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\tstatus = acpi_ex_resolve_object(&source_desc, target_type, walk_state);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tswitch (target_type) {\n\t\t \n\tcase ACPI_TYPE_INTEGER:\n\tcase ACPI_TYPE_STRING:\n\tcase ACPI_TYPE_BUFFER:\n\n\t\tif ((walk_state->opcode == AML_COPY_OBJECT_OP) ||\n\t\t    !implicit_conversion) {\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ex_store_direct_to_node(source_desc, node,\n\t\t\t\t\t\t\t walk_state);\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\n\t\tstatus =\n\t\t    acpi_ex_store_object_to_object(source_desc, target_desc,\n\t\t\t\t\t\t   &new_desc, walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\tif (new_desc != target_desc) {\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ns_attach_object(node, new_desc,\n\t\t\t\t\t\t  new_desc->common.type);\n\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t\t  \"Store type [%s] into [%s] via Convert/Attach\\n\",\n\t\t\t\t\t  acpi_ut_get_object_type_name\n\t\t\t\t\t  (source_desc),\n\t\t\t\t\t  acpi_ut_get_object_type_name\n\t\t\t\t\t  (new_desc)));\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER_FIELD:\n\tcase ACPI_TYPE_LOCAL_REGION_FIELD:\n\tcase ACPI_TYPE_LOCAL_BANK_FIELD:\n\tcase ACPI_TYPE_LOCAL_INDEX_FIELD:\n\t\t \n\t\tstatus = acpi_ex_write_data_to_field(source_desc, target_desc,\n\t\t\t\t\t\t     &walk_state->result_obj);\n\t\tbreak;\n\n\tdefault:\n\t\t \n\t\tstatus =\n\t\t    acpi_ex_store_direct_to_node(source_desc, node, walk_state);\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nstatic acpi_status\nacpi_ex_store_direct_to_node(union acpi_operand_object *source_desc,\n\t\t\t     struct acpi_namespace_node *node,\n\t\t\t     struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tunion acpi_operand_object *new_desc;\n\n\tACPI_FUNCTION_TRACE(ex_store_direct_to_node);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t  \"Storing [%s] (%p) directly into node [%s] (%p)\"\n\t\t\t  \" with no implicit conversion\\n\",\n\t\t\t  acpi_ut_get_object_type_name(source_desc),\n\t\t\t  source_desc, acpi_ut_get_type_name(node->type),\n\t\t\t  node));\n\n\t \n\n\tstatus =\n\t    acpi_ut_copy_iobject_to_iobject(source_desc, &new_desc, walk_state);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tstatus = acpi_ns_attach_object(node, new_desc, new_desc->common.type);\n\tacpi_ut_remove_reference(new_desc);\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}