{
  "module_name": "nspredef.c",
  "hash_id": "e424c8a169cdf1daeb742dbd643bcbadbca214971ee04bc9353f94e8659a4545",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/nspredef.c",
  "human_readable_source": "\n \n\n#define ACPI_CREATE_PREDEFINED_TABLE\n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acnamesp.h\"\n#include \"acpredef.h\"\n\n#define _COMPONENT          ACPI_NAMESPACE\nACPI_MODULE_NAME(\"nspredef\")\n\n \n \nstatic acpi_status\nacpi_ns_check_reference(struct acpi_evaluate_info *info,\n\t\t\tunion acpi_operand_object *return_object);\n\nstatic u32 acpi_ns_get_bitmapped_type(union acpi_operand_object *return_object);\n\n \n\nacpi_status\nacpi_ns_check_return_value(struct acpi_namespace_node *node,\n\t\t\t   struct acpi_evaluate_info *info,\n\t\t\t   u32 user_param_count,\n\t\t\t   acpi_status return_status,\n\t\t\t   union acpi_operand_object **return_object_ptr)\n{\n\tacpi_status status;\n\tconst union acpi_predefined_info *predefined;\n\n\tACPI_FUNCTION_TRACE(ns_check_return_value);\n\n\t \n\n\tpredefined = info->predefined;\n\tif (!predefined) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\tif ((return_status != AE_OK) && (return_status != AE_CTRL_RETURN_VALUE)) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\tif (acpi_gbl_disable_auto_repair ||\n\t    (!predefined->info.expected_btypes) ||\n\t    (predefined->info.expected_btypes == ACPI_RTYPE_ALL)) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\tstatus = acpi_ns_check_object_type(info, return_object_ptr,\n\t\t\t\t\t   predefined->info.expected_btypes,\n\t\t\t\t\t   ACPI_NOT_PACKAGE_ELEMENT);\n\tif (ACPI_FAILURE(status)) {\n\t\tgoto exit;\n\t}\n\n\t \n\tif (!(*return_object_ptr)) {\n\t\tgoto exit;\n\t}\n\n\t \n\tif ((*return_object_ptr)->common.type == ACPI_TYPE_PACKAGE) {\n\t\tinfo->parent_package = *return_object_ptr;\n\t\tstatus = acpi_ns_check_package(info, return_object_ptr);\n\t\tif (ACPI_FAILURE(status)) {\n\n\t\t\t \n\n\t\t\tif ((status != AE_AML_OPERAND_TYPE) &&\n\t\t\t    (status != AE_AML_OPERAND_VALUE)) {\n\t\t\t\tgoto exit;\n\t\t\t}\n\t\t}\n\t}\n\n\t \n\tstatus = acpi_ns_complex_repairs(info, node, status, return_object_ptr);\n\nexit:\n\t \n\tif (ACPI_FAILURE(status) || (info->return_flags & ACPI_OBJECT_REPAIRED)) {\n\t\tnode->flags |= ANOBJ_EVALUATED;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ns_check_object_type(struct acpi_evaluate_info *info,\n\t\t\t  union acpi_operand_object **return_object_ptr,\n\t\t\t  u32 expected_btypes, u32 package_index)\n{\n\tunion acpi_operand_object *return_object = *return_object_ptr;\n\tacpi_status status = AE_OK;\n\tchar type_buffer[96];\t \n\n\t \n\n\tif (return_object &&\n\t    ACPI_GET_DESCRIPTOR_TYPE(return_object) == ACPI_DESC_TYPE_NAMED) {\n\t\tACPI_WARN_PREDEFINED((AE_INFO, info->full_pathname,\n\t\t\t\t      info->node_flags,\n\t\t\t\t      \"Invalid return type - Found a Namespace node [%4.4s] type %s\",\n\t\t\t\t      return_object->node.name.ascii,\n\t\t\t\t      acpi_ut_get_type_name(return_object->node.\n\t\t\t\t\t\t\t    type)));\n\t\treturn (AE_AML_OPERAND_TYPE);\n\t}\n\n\t \n\tinfo->return_btype = acpi_ns_get_bitmapped_type(return_object);\n\tif (info->return_btype == ACPI_RTYPE_ANY) {\n\n\t\t \n\t\tgoto type_error_exit;\n\t}\n\n\t \n\n\tif ((info->return_btype & expected_btypes) == ACPI_RTYPE_REFERENCE) {\n\t\tstatus = acpi_ns_check_reference(info, return_object);\n\t\treturn (status);\n\t}\n\n\t \n\n\tstatus = acpi_ns_simple_repair(info, expected_btypes,\n\t\t\t\t       package_index, return_object_ptr);\n\tif (ACPI_SUCCESS(status)) {\n\t\treturn (AE_OK);\t \n\t}\n\ntype_error_exit:\n\n\t \n\n\tacpi_ut_get_expected_return_types(type_buffer, expected_btypes);\n\n\tif (!return_object) {\n\t\tACPI_WARN_PREDEFINED((AE_INFO, info->full_pathname,\n\t\t\t\t      info->node_flags,\n\t\t\t\t      \"Expected return object of type %s\",\n\t\t\t\t      type_buffer));\n\t} else if (package_index == ACPI_NOT_PACKAGE_ELEMENT) {\n\t\tACPI_WARN_PREDEFINED((AE_INFO, info->full_pathname,\n\t\t\t\t      info->node_flags,\n\t\t\t\t      \"Return type mismatch - found %s, expected %s\",\n\t\t\t\t      acpi_ut_get_object_type_name\n\t\t\t\t      (return_object), type_buffer));\n\t} else {\n\t\tACPI_WARN_PREDEFINED((AE_INFO, info->full_pathname,\n\t\t\t\t      info->node_flags,\n\t\t\t\t      \"Return Package type mismatch at index %u - \"\n\t\t\t\t      \"found %s, expected %s\", package_index,\n\t\t\t\t      acpi_ut_get_object_type_name\n\t\t\t\t      (return_object), type_buffer));\n\t}\n\n\treturn (AE_AML_OPERAND_TYPE);\n}\n\n \n\nstatic acpi_status\nacpi_ns_check_reference(struct acpi_evaluate_info *info,\n\t\t\tunion acpi_operand_object *return_object)\n{\n\n\t \n\tif (return_object->reference.class == ACPI_REFCLASS_NAME) {\n\t\treturn (AE_OK);\n\t}\n\n\tACPI_WARN_PREDEFINED((AE_INFO, info->full_pathname, info->node_flags,\n\t\t\t      \"Return type mismatch - unexpected reference object type [%s] %2.2X\",\n\t\t\t      acpi_ut_get_reference_name(return_object),\n\t\t\t      return_object->reference.class));\n\n\treturn (AE_AML_OPERAND_TYPE);\n}\n\n \n\nstatic u32 acpi_ns_get_bitmapped_type(union acpi_operand_object *return_object)\n{\n\tu32 return_btype;\n\n\tif (!return_object) {\n\t\treturn (ACPI_RTYPE_NONE);\n\t}\n\n\t \n\n\tswitch (return_object->common.type) {\n\tcase ACPI_TYPE_INTEGER:\n\n\t\treturn_btype = ACPI_RTYPE_INTEGER;\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\n\n\t\treturn_btype = ACPI_RTYPE_BUFFER;\n\t\tbreak;\n\n\tcase ACPI_TYPE_STRING:\n\n\t\treturn_btype = ACPI_RTYPE_STRING;\n\t\tbreak;\n\n\tcase ACPI_TYPE_PACKAGE:\n\n\t\treturn_btype = ACPI_RTYPE_PACKAGE;\n\t\tbreak;\n\n\tcase ACPI_TYPE_LOCAL_REFERENCE:\n\n\t\treturn_btype = ACPI_RTYPE_REFERENCE;\n\t\tbreak;\n\n\tdefault:\n\n\t\t \n\n\t\treturn_btype = ACPI_RTYPE_ANY;\n\t\tbreak;\n\t}\n\n\treturn (return_btype);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}