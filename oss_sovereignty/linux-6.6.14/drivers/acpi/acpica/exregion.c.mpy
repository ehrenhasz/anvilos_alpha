{
  "module_name": "exregion.c",
  "hash_id": "b5be579457e15a6eb56a212e11f550a1e1ef8a7fd939cf0c606548aa8bddf8ee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exregion.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acinterp.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exregion\")\n\n \nacpi_status\nacpi_ex_system_memory_space_handler(u32 function,\n\t\t\t\t    acpi_physical_address address,\n\t\t\t\t    u32 bit_width,\n\t\t\t\t    u64 *value,\n\t\t\t\t    void *handler_context, void *region_context)\n{\n\tacpi_status status = AE_OK;\n\tvoid *logical_addr_ptr = NULL;\n\tstruct acpi_mem_space_context *mem_info = region_context;\n\tstruct acpi_mem_mapping *mm = mem_info->cur_mm;\n\tu32 length;\n\tacpi_size map_length;\n\tacpi_size page_boundary_map_length;\n#ifdef ACPI_MISALIGNMENT_NOT_SUPPORTED\n\tu32 remainder;\n#endif\n\n\tACPI_FUNCTION_TRACE(ex_system_memory_space_handler);\n\n\t \n\n\tswitch (bit_width) {\n\tcase 8:\n\n\t\tlength = 1;\n\t\tbreak;\n\n\tcase 16:\n\n\t\tlength = 2;\n\t\tbreak;\n\n\tcase 32:\n\n\t\tlength = 4;\n\t\tbreak;\n\n\tcase 64:\n\n\t\tlength = 8;\n\t\tbreak;\n\n\tdefault:\n\n\t\tACPI_ERROR((AE_INFO, \"Invalid SystemMemory width %u\",\n\t\t\t    bit_width));\n\t\treturn_ACPI_STATUS(AE_AML_OPERAND_VALUE);\n\t}\n\n#ifdef ACPI_MISALIGNMENT_NOT_SUPPORTED\n\t \n\t(void)acpi_ut_short_divide((u64) address, length, NULL, &remainder);\n\tif (remainder != 0) {\n\t\treturn_ACPI_STATUS(AE_AML_ALIGNMENT);\n\t}\n#endif\n\n\t \n\tif (!mm || (address < mm->physical_address) ||\n\t    ((u64) address + length > (u64) mm->physical_address + mm->length)) {\n\t\t \n\t\tfor (mm = mem_info->first_mm; mm; mm = mm->next_mm) {\n\t\t\tif (mm == mem_info->cur_mm)\n\t\t\t\tcontinue;\n\n\t\t\tif (address < mm->physical_address)\n\t\t\t\tcontinue;\n\n\t\t\tif ((u64) address + length >\n\t\t\t\t\t(u64) mm->physical_address + mm->length)\n\t\t\t\tcontinue;\n\n\t\t\tmem_info->cur_mm = mm;\n\t\t\tgoto access;\n\t\t}\n\n\t\t \n\t\tmm = ACPI_ALLOCATE_ZEROED(sizeof(*mm));\n\t\tif (!mm) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Unable to save memory mapping at 0x%8.8X%8.8X, size %u\",\n\t\t\t\t    ACPI_FORMAT_UINT64(address), length));\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\t \n\t\tmap_length = (acpi_size)\n\t\t    ((mem_info->address + mem_info->length) - address);\n\n\t\t \n\t\tpage_boundary_map_length = (acpi_size)\n\t\t    (ACPI_ROUND_UP(address, ACPI_DEFAULT_PAGE_SIZE) - address);\n\t\tif (page_boundary_map_length == 0) {\n\t\t\tpage_boundary_map_length = ACPI_DEFAULT_PAGE_SIZE;\n\t\t}\n\n\t\tif (map_length > page_boundary_map_length) {\n\t\t\tmap_length = page_boundary_map_length;\n\t\t}\n\n\t\t \n\n\t\tlogical_addr_ptr = acpi_os_map_memory(address, map_length);\n\t\tif (!logical_addr_ptr) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Could not map memory at 0x%8.8X%8.8X, size %u\",\n\t\t\t\t    ACPI_FORMAT_UINT64(address),\n\t\t\t\t    (u32)map_length));\n\t\t\tACPI_FREE(mm);\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\t \n\n\t\tmm->logical_address = logical_addr_ptr;\n\t\tmm->physical_address = address;\n\t\tmm->length = map_length;\n\n\t\t \n\t\tmm->next_mm = mem_info->first_mm;\n\t\tmem_info->first_mm = mm;\n\n\t\tmem_info->cur_mm = mm;\n\t}\n\naccess:\n\t \n\tlogical_addr_ptr = mm->logical_address +\n\t\t((u64) address - (u64) mm->physical_address);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n\t\t\t  \"System-Memory (width %u) R/W %u Address=%8.8X%8.8X\\n\",\n\t\t\t  bit_width, function, ACPI_FORMAT_UINT64(address)));\n\n\t \n\tswitch (function) {\n\tcase ACPI_READ:\n\n\t\t*value = 0;\n\t\tswitch (bit_width) {\n\t\tcase 8:\n\n\t\t\t*value = (u64)ACPI_GET8(logical_addr_ptr);\n\t\t\tbreak;\n\n\t\tcase 16:\n\n\t\t\t*value = (u64)ACPI_GET16(logical_addr_ptr);\n\t\t\tbreak;\n\n\t\tcase 32:\n\n\t\t\t*value = (u64)ACPI_GET32(logical_addr_ptr);\n\t\t\tbreak;\n\n\t\tcase 64:\n\n\t\t\t*value = (u64)ACPI_GET64(logical_addr_ptr);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_WRITE:\n\n\t\tswitch (bit_width) {\n\t\tcase 8:\n\n\t\t\tACPI_SET8(logical_addr_ptr, *value);\n\t\t\tbreak;\n\n\t\tcase 16:\n\n\t\t\tACPI_SET16(logical_addr_ptr, *value);\n\t\t\tbreak;\n\n\t\tcase 32:\n\n\t\t\tACPI_SET32(logical_addr_ptr, *value);\n\t\t\tbreak;\n\n\t\tcase 64:\n\n\t\t\tACPI_SET64(logical_addr_ptr, *value);\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\n\t\tstatus = AE_BAD_PARAMETER;\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ex_system_io_space_handler(u32 function,\n\t\t\t\tacpi_physical_address address,\n\t\t\t\tu32 bit_width,\n\t\t\t\tu64 *value,\n\t\t\t\tvoid *handler_context, void *region_context)\n{\n\tacpi_status status = AE_OK;\n\tu32 value32;\n\n\tACPI_FUNCTION_TRACE(ex_system_io_space_handler);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n\t\t\t  \"System-IO (width %u) R/W %u Address=%8.8X%8.8X\\n\",\n\t\t\t  bit_width, function, ACPI_FORMAT_UINT64(address)));\n\n\t \n\n\tswitch (function) {\n\tcase ACPI_READ:\n\n\t\tstatus = acpi_hw_read_port((acpi_io_address)address,\n\t\t\t\t\t   &value32, bit_width);\n\t\t*value = value32;\n\t\tbreak;\n\n\tcase ACPI_WRITE:\n\n\t\tstatus = acpi_hw_write_port((acpi_io_address)address,\n\t\t\t\t\t    (u32)*value, bit_width);\n\t\tbreak;\n\n\tdefault:\n\n\t\tstatus = AE_BAD_PARAMETER;\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n#ifdef ACPI_PCI_CONFIGURED\n \n\nacpi_status\nacpi_ex_pci_config_space_handler(u32 function,\n\t\t\t\t acpi_physical_address address,\n\t\t\t\t u32 bit_width,\n\t\t\t\t u64 *value,\n\t\t\t\t void *handler_context, void *region_context)\n{\n\tacpi_status status = AE_OK;\n\tstruct acpi_pci_id *pci_id;\n\tu16 pci_register;\n\n\tACPI_FUNCTION_TRACE(ex_pci_config_space_handler);\n\n\t \n\tpci_id = (struct acpi_pci_id *)region_context;\n\tpci_register = (u16) (u32) address;\n\n\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n\t\t\t  \"Pci-Config %u (%u) Seg(%04x) Bus(%04x) \"\n\t\t\t  \"Dev(%04x) Func(%04x) Reg(%04x)\\n\",\n\t\t\t  function, bit_width, pci_id->segment, pci_id->bus,\n\t\t\t  pci_id->device, pci_id->function, pci_register));\n\n\tswitch (function) {\n\tcase ACPI_READ:\n\n\t\t*value = 0;\n\t\tstatus =\n\t\t    acpi_os_read_pci_configuration(pci_id, pci_register, value,\n\t\t\t\t\t\t   bit_width);\n\t\tbreak;\n\n\tcase ACPI_WRITE:\n\n\t\tstatus =\n\t\t    acpi_os_write_pci_configuration(pci_id, pci_register,\n\t\t\t\t\t\t    *value, bit_width);\n\t\tbreak;\n\n\tdefault:\n\n\t\tstatus = AE_BAD_PARAMETER;\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n#endif\n\n \n\nacpi_status\nacpi_ex_cmos_space_handler(u32 function,\n\t\t\t   acpi_physical_address address,\n\t\t\t   u32 bit_width,\n\t\t\t   u64 *value,\n\t\t\t   void *handler_context, void *region_context)\n{\n\tacpi_status status = AE_OK;\n\n\tACPI_FUNCTION_TRACE(ex_cmos_space_handler);\n\n\treturn_ACPI_STATUS(status);\n}\n\n#ifdef ACPI_PCI_CONFIGURED\n \n\nacpi_status\nacpi_ex_pci_bar_space_handler(u32 function,\n\t\t\t      acpi_physical_address address,\n\t\t\t      u32 bit_width,\n\t\t\t      u64 *value,\n\t\t\t      void *handler_context, void *region_context)\n{\n\tacpi_status status = AE_OK;\n\n\tACPI_FUNCTION_TRACE(ex_pci_bar_space_handler);\n\n\treturn_ACPI_STATUS(status);\n}\n#endif\n\n \n\nacpi_status\nacpi_ex_data_table_space_handler(u32 function,\n\t\t\t\t acpi_physical_address address,\n\t\t\t\t u32 bit_width,\n\t\t\t\t u64 *value,\n\t\t\t\t void *handler_context, void *region_context)\n{\n\tstruct acpi_data_table_mapping *mapping;\n\tchar *pointer;\n\n\tACPI_FUNCTION_TRACE(ex_data_table_space_handler);\n\n\tmapping = (struct acpi_data_table_mapping *) region_context;\n\tpointer = ACPI_CAST_PTR(char, mapping->pointer) +\n\t    (address - ACPI_PTR_TO_PHYSADDR(mapping->pointer));\n\n\t \n\tswitch (function) {\n\tcase ACPI_READ:\n\n\t\tmemcpy(ACPI_CAST_PTR(char, value), pointer,\n\t\t       ACPI_DIV_8(bit_width));\n\t\tbreak;\n\n\tcase ACPI_WRITE:\n\n\t\tmemcpy(pointer, ACPI_CAST_PTR(char, value),\n\t\t       ACPI_DIV_8(bit_width));\n\t\tbreak;\n\n\tdefault:\n\n\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t}\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}