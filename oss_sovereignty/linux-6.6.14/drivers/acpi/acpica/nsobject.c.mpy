{
  "module_name": "nsobject.c",
  "hash_id": "3d3c963c8ed4e7228e8a1d7da7963f1149c82bb1ffcea09bed7e095a6f1a7b45",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/nsobject.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acnamesp.h\"\n\n#define _COMPONENT          ACPI_NAMESPACE\nACPI_MODULE_NAME(\"nsobject\")\n\n \nacpi_status\nacpi_ns_attach_object(struct acpi_namespace_node *node,\n\t\t      union acpi_operand_object *object, acpi_object_type type)\n{\n\tunion acpi_operand_object *obj_desc;\n\tunion acpi_operand_object *last_obj_desc;\n\tacpi_object_type object_type = ACPI_TYPE_ANY;\n\n\tACPI_FUNCTION_TRACE(ns_attach_object);\n\n\t \n\tif (!node) {\n\n\t\t \n\n\t\tACPI_ERROR((AE_INFO, \"Null NamedObj handle\"));\n\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t}\n\n\tif (!object && (ACPI_TYPE_ANY != type)) {\n\n\t\t \n\n\t\tACPI_ERROR((AE_INFO,\n\t\t\t    \"Null object, but type not ACPI_TYPE_ANY\"));\n\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t}\n\n\tif (ACPI_GET_DESCRIPTOR_TYPE(node) != ACPI_DESC_TYPE_NAMED) {\n\n\t\t \n\n\t\tACPI_ERROR((AE_INFO, \"Invalid handle %p [%s]\",\n\t\t\t    node, acpi_ut_get_descriptor_name(node)));\n\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t}\n\n\t \n\n\tif (node->object == object) {\n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t  \"Obj %p already installed in NameObj %p\\n\",\n\t\t\t\t  object, node));\n\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\n\tif (!object) {\n\t\tobj_desc = NULL;\n\t\tobject_type = ACPI_TYPE_ANY;\n\t}\n\n\t \n\telse if ((ACPI_GET_DESCRIPTOR_TYPE(object) == ACPI_DESC_TYPE_NAMED) &&\n\t\t ((struct acpi_namespace_node *)object)->object) {\n\t\t \n\t\tobj_desc = ((struct acpi_namespace_node *)object)->object;\n\t\tobject_type = ((struct acpi_namespace_node *)object)->type;\n\t}\n\n\t \n\telse {\n\t\tobj_desc = (union acpi_operand_object *)object;\n\n\t\t \n\n\t\tobject_type = type;\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Installing %p into Node %p [%4.4s]\\n\",\n\t\t\t  obj_desc, node, acpi_ut_get_node_name(node)));\n\n\t \n\n\tif (node->object) {\n\t\tacpi_ns_detach_object(node);\n\t}\n\n\tif (obj_desc) {\n\t\t \n\t\tacpi_ut_add_reference(obj_desc);\n\n\t\t \n\t\tlast_obj_desc = obj_desc;\n\t\twhile (last_obj_desc->common.next_object) {\n\t\t\tlast_obj_desc = last_obj_desc->common.next_object;\n\t\t}\n\n\t\t \n\n\t\tlast_obj_desc->common.next_object = node->object;\n\t}\n\n\tnode->type = (u8) object_type;\n\tnode->object = obj_desc;\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nvoid acpi_ns_detach_object(struct acpi_namespace_node *node)\n{\n\tunion acpi_operand_object *obj_desc;\n\n\tACPI_FUNCTION_TRACE(ns_detach_object);\n\n\tobj_desc = node->object;\n\n\tif (!obj_desc || (obj_desc->common.type == ACPI_TYPE_LOCAL_DATA)) {\n\t\treturn_VOID;\n\t}\n\n\tif (node->flags & ANOBJ_ALLOCATED_BUFFER) {\n\n\t\t \n\n\t\tif (obj_desc->common.type == ACPI_TYPE_METHOD) {\n\t\t\tACPI_FREE(obj_desc->method.aml_start);\n\t\t}\n\t}\n\n\tif (obj_desc->common.type == ACPI_TYPE_REGION) {\n\t\tacpi_ut_remove_address_range(obj_desc->region.space_id, node);\n\t}\n\n\t \n\n\tnode->object = NULL;\n\tif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) == ACPI_DESC_TYPE_OPERAND) {\n\n\t\t \n\n\t\tnode->object = obj_desc->common.next_object;\n\n\t\t \n\n\t\tif (node->object &&\n\t\t    (node->object->common.type != ACPI_TYPE_LOCAL_DATA)) {\n\t\t\tnode->object = node->object->common.next_object;\n\t\t}\n\n\t\t \n\t\tif (obj_desc->common.next_object &&\n\t\t    ((obj_desc->common.next_object)->common.type ==\n\t\t     ACPI_TYPE_LOCAL_DATA)) {\n\t\t\tobj_desc->common.next_object = NULL;\n\t\t}\n\t}\n\n\t \n\n\tnode->type = ACPI_TYPE_ANY;\n\n\tACPI_DEBUG_PRINT((ACPI_DB_NAMES, \"Node %p [%4.4s] Object %p\\n\",\n\t\t\t  node, acpi_ut_get_node_name(node), obj_desc));\n\n\t \n\n\tacpi_ut_remove_reference(obj_desc);\n\treturn_VOID;\n}\n\n \n\nunion acpi_operand_object *acpi_ns_get_attached_object(struct\n\t\t\t\t\t\t       acpi_namespace_node\n\t\t\t\t\t\t       *node)\n{\n\tACPI_FUNCTION_TRACE_PTR(ns_get_attached_object, node);\n\n\tif (!node) {\n\t\tACPI_WARNING((AE_INFO, \"Null Node ptr\"));\n\t\treturn_PTR(NULL);\n\t}\n\n\tif (!node->object ||\n\t    ((ACPI_GET_DESCRIPTOR_TYPE(node->object) != ACPI_DESC_TYPE_OPERAND)\n\t     && (ACPI_GET_DESCRIPTOR_TYPE(node->object) !=\n\t\t ACPI_DESC_TYPE_NAMED))\n\t    || ((node->object)->common.type == ACPI_TYPE_LOCAL_DATA)) {\n\t\treturn_PTR(NULL);\n\t}\n\n\treturn_PTR(node->object);\n}\n\n \n\nunion acpi_operand_object *acpi_ns_get_secondary_object(union\n\t\t\t\t\t\t\tacpi_operand_object\n\t\t\t\t\t\t\t*obj_desc)\n{\n\tACPI_FUNCTION_TRACE_PTR(ns_get_secondary_object, obj_desc);\n\n\tif ((!obj_desc) ||\n\t    (obj_desc->common.type == ACPI_TYPE_LOCAL_DATA) ||\n\t    (!obj_desc->common.next_object) ||\n\t    ((obj_desc->common.next_object)->common.type ==\n\t     ACPI_TYPE_LOCAL_DATA)) {\n\t\treturn_PTR(NULL);\n\t}\n\n\treturn_PTR(obj_desc->common.next_object);\n}\n\n \n\nacpi_status\nacpi_ns_attach_data(struct acpi_namespace_node *node,\n\t\t    acpi_object_handler handler, void *data)\n{\n\tunion acpi_operand_object *prev_obj_desc;\n\tunion acpi_operand_object *obj_desc;\n\tunion acpi_operand_object *data_desc;\n\n\t \n\n\tprev_obj_desc = NULL;\n\tobj_desc = node->object;\n\twhile (obj_desc) {\n\t\tif ((obj_desc->common.type == ACPI_TYPE_LOCAL_DATA) &&\n\t\t    (obj_desc->data.handler == handler)) {\n\t\t\treturn (AE_ALREADY_EXISTS);\n\t\t}\n\n\t\tprev_obj_desc = obj_desc;\n\t\tobj_desc = obj_desc->common.next_object;\n\t}\n\n\t \n\n\tdata_desc = acpi_ut_create_internal_object(ACPI_TYPE_LOCAL_DATA);\n\tif (!data_desc) {\n\t\treturn (AE_NO_MEMORY);\n\t}\n\n\tdata_desc->data.handler = handler;\n\tdata_desc->data.pointer = data;\n\n\t \n\n\tif (prev_obj_desc) {\n\t\tprev_obj_desc->common.next_object = data_desc;\n\t} else {\n\t\tnode->object = data_desc;\n\t}\n\n\treturn (AE_OK);\n}\n\n \n\nacpi_status\nacpi_ns_detach_data(struct acpi_namespace_node *node,\n\t\t    acpi_object_handler handler)\n{\n\tunion acpi_operand_object *obj_desc;\n\tunion acpi_operand_object *prev_obj_desc;\n\n\tprev_obj_desc = NULL;\n\tobj_desc = node->object;\n\twhile (obj_desc) {\n\t\tif ((obj_desc->common.type == ACPI_TYPE_LOCAL_DATA) &&\n\t\t    (obj_desc->data.handler == handler)) {\n\t\t\tif (prev_obj_desc) {\n\t\t\t\tprev_obj_desc->common.next_object =\n\t\t\t\t    obj_desc->common.next_object;\n\t\t\t} else {\n\t\t\t\tnode->object = obj_desc->common.next_object;\n\t\t\t}\n\n\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\treturn (AE_OK);\n\t\t}\n\n\t\tprev_obj_desc = obj_desc;\n\t\tobj_desc = obj_desc->common.next_object;\n\t}\n\n\treturn (AE_NOT_FOUND);\n}\n\n \n\nacpi_status\nacpi_ns_get_attached_data(struct acpi_namespace_node *node,\n\t\t\t  acpi_object_handler handler, void **data)\n{\n\tunion acpi_operand_object *obj_desc;\n\n\tobj_desc = node->object;\n\twhile (obj_desc) {\n\t\tif ((obj_desc->common.type == ACPI_TYPE_LOCAL_DATA) &&\n\t\t    (obj_desc->data.handler == handler)) {\n\t\t\t*data = obj_desc->data.pointer;\n\t\t\treturn (AE_OK);\n\t\t}\n\n\t\tobj_desc = obj_desc->common.next_object;\n\t}\n\n\treturn (AE_NOT_FOUND);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}