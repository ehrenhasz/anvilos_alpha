{
  "module_name": "exnames.c",
  "hash_id": "7a233d326ffb7af23e5fba79a95c4f34e11930c34fc2299f57c936b7fa60718a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exnames.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acinterp.h\"\n#include \"amlcode.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exnames\")\n\n \nstatic char *acpi_ex_allocate_name_string(u32 prefix_count, u32 num_name_segs);\n\nstatic acpi_status acpi_ex_name_segment(u8 **in_aml_address, char *name_string);\n\n \n\nstatic char *acpi_ex_allocate_name_string(u32 prefix_count, u32 num_name_segs)\n{\n\tchar *temp_ptr;\n\tchar *name_string;\n\tu32 size_needed;\n\n\tACPI_FUNCTION_TRACE(ex_allocate_name_string);\n\n\t \n\tif (prefix_count == ACPI_UINT32_MAX) {\n\n\t\t \n\n\t\tsize_needed = 1 + (ACPI_NAMESEG_SIZE * num_name_segs) + 2 + 1;\n\t} else {\n\t\tsize_needed =\n\t\t    prefix_count + (ACPI_NAMESEG_SIZE * num_name_segs) + 2 + 1;\n\t}\n\n\t \n\tname_string = ACPI_ALLOCATE(size_needed);\n\tif (!name_string) {\n\t\tACPI_ERROR((AE_INFO,\n\t\t\t    \"Could not allocate size %u\", size_needed));\n\t\treturn_PTR(NULL);\n\t}\n\n\ttemp_ptr = name_string;\n\n\t \n\n\tif (prefix_count == ACPI_UINT32_MAX) {\n\t\t*temp_ptr++ = AML_ROOT_PREFIX;\n\t} else {\n\t\twhile (prefix_count--) {\n\t\t\t*temp_ptr++ = AML_PARENT_PREFIX;\n\t\t}\n\t}\n\n\t \n\n\tif (num_name_segs > 2) {\n\n\t\t \n\n\t\t*temp_ptr++ = AML_MULTI_NAME_PREFIX;\n\t\t*temp_ptr++ = (char)num_name_segs;\n\t} else if (2 == num_name_segs) {\n\n\t\t \n\n\t\t*temp_ptr++ = AML_DUAL_NAME_PREFIX;\n\t}\n\n\t \n\t*temp_ptr = 0;\n\n\treturn_PTR(name_string);\n}\n\n \n\nstatic acpi_status acpi_ex_name_segment(u8 ** in_aml_address, char *name_string)\n{\n\tchar *aml_address = (void *)*in_aml_address;\n\tacpi_status status = AE_OK;\n\tu32 index;\n\tchar char_buf[5];\n\n\tACPI_FUNCTION_TRACE(ex_name_segment);\n\n\t \n\tchar_buf[0] = *aml_address;\n\n\tif ('0' <= char_buf[0] && char_buf[0] <= '9') {\n\t\tACPI_ERROR((AE_INFO, \"Invalid leading digit: %c\", char_buf[0]));\n\t\treturn_ACPI_STATUS(AE_CTRL_PENDING);\n\t}\n\n\tfor (index = 0;\n\t     (index < ACPI_NAMESEG_SIZE)\n\t     && (acpi_ut_valid_name_char(*aml_address, 0)); index++) {\n\t\tchar_buf[index] = *aml_address++;\n\t}\n\n\t \n\n\tif (index == 4) {\n\n\t\t \n\n\t\tchar_buf[4] = '\\0';\n\n\t\tif (name_string) {\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_NAMES,\n\t\t\t\t\t  \"Appending NameSeg %s\\n\", char_buf));\n\t\t\tstrcat(name_string, char_buf);\n\t\t} else {\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_NAMES,\n\t\t\t\t\t  \"No Name string - %s\\n\", char_buf));\n\t\t}\n\t} else if (index == 0) {\n\t\t \n\t\tACPI_DEBUG_PRINT((ACPI_DB_INFO,\n\t\t\t\t  \"Leading character is not alpha: %02Xh (not a name)\\n\",\n\t\t\t\t  char_buf[0]));\n\t\tstatus = AE_CTRL_PENDING;\n\t} else {\n\t\t \n\t\tstatus = AE_AML_BAD_NAME;\n\t\tACPI_ERROR((AE_INFO,\n\t\t\t    \"Bad character 0x%02x in name, at %p\",\n\t\t\t    *aml_address, aml_address));\n\t}\n\n\t*in_aml_address = ACPI_CAST_PTR(u8, aml_address);\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ex_get_name_string(acpi_object_type data_type,\n\t\t\tu8 * in_aml_address,\n\t\t\tchar **out_name_string, u32 * out_name_length)\n{\n\tacpi_status status = AE_OK;\n\tu8 *aml_address = in_aml_address;\n\tchar *name_string = NULL;\n\tu32 num_segments;\n\tu32 prefix_count = 0;\n\tu8 has_prefix = FALSE;\n\n\tACPI_FUNCTION_TRACE_PTR(ex_get_name_string, aml_address);\n\n\tif (ACPI_TYPE_LOCAL_REGION_FIELD == data_type ||\n\t    ACPI_TYPE_LOCAL_BANK_FIELD == data_type ||\n\t    ACPI_TYPE_LOCAL_INDEX_FIELD == data_type) {\n\n\t\t \n\n\t\tname_string = acpi_ex_allocate_name_string(0, 1);\n\t\tif (!name_string) {\n\t\t\tstatus = AE_NO_MEMORY;\n\t\t} else {\n\t\t\tstatus =\n\t\t\t    acpi_ex_name_segment(&aml_address, name_string);\n\t\t}\n\t} else {\n\t\t \n\t\tswitch (*aml_address) {\n\t\tcase AML_ROOT_PREFIX:\n\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_LOAD,\n\t\t\t\t\t  \"RootPrefix(\\\\) at %p\\n\",\n\t\t\t\t\t  aml_address));\n\n\t\t\t \n\t\t\taml_address++;\n\t\t\tprefix_count = ACPI_UINT32_MAX;\n\t\t\thas_prefix = TRUE;\n\t\t\tbreak;\n\n\t\tcase AML_PARENT_PREFIX:\n\n\t\t\t \n\n\t\t\tdo {\n\t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_LOAD,\n\t\t\t\t\t\t  \"ParentPrefix (^) at %p\\n\",\n\t\t\t\t\t\t  aml_address));\n\n\t\t\t\taml_address++;\n\t\t\t\tprefix_count++;\n\n\t\t\t} while (*aml_address == AML_PARENT_PREFIX);\n\n\t\t\thas_prefix = TRUE;\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\n\t\tswitch (*aml_address) {\n\t\tcase AML_DUAL_NAME_PREFIX:\n\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_LOAD,\n\t\t\t\t\t  \"DualNamePrefix at %p\\n\",\n\t\t\t\t\t  aml_address));\n\n\t\t\taml_address++;\n\t\t\tname_string =\n\t\t\t    acpi_ex_allocate_name_string(prefix_count, 2);\n\t\t\tif (!name_string) {\n\t\t\t\tstatus = AE_NO_MEMORY;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t \n\n\t\t\thas_prefix = TRUE;\n\n\t\t\tstatus =\n\t\t\t    acpi_ex_name_segment(&aml_address, name_string);\n\t\t\tif (ACPI_SUCCESS(status)) {\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ex_name_segment(&aml_address,\n\t\t\t\t\t\t\t name_string);\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase AML_MULTI_NAME_PREFIX:\n\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_LOAD,\n\t\t\t\t\t  \"MultiNamePrefix at %p\\n\",\n\t\t\t\t\t  aml_address));\n\n\t\t\t \n\n\t\t\taml_address++;\n\t\t\tnum_segments = *aml_address;\n\n\t\t\tname_string =\n\t\t\t    acpi_ex_allocate_name_string(prefix_count,\n\t\t\t\t\t\t\t num_segments);\n\t\t\tif (!name_string) {\n\t\t\t\tstatus = AE_NO_MEMORY;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t \n\n\t\t\taml_address++;\n\t\t\thas_prefix = TRUE;\n\n\t\t\twhile (num_segments &&\n\t\t\t       (status =\n\t\t\t\tacpi_ex_name_segment(&aml_address,\n\t\t\t\t\t\t     name_string)) == AE_OK) {\n\t\t\t\tnum_segments--;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase 0:\n\n\t\t\t \n\n\t\t\tif (prefix_count == ACPI_UINT32_MAX) {\n\t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t\t\t  \"NameSeg is \\\"\\\\\\\" followed by NULL\\n\"));\n\t\t\t}\n\n\t\t\t \n\n\t\t\taml_address++;\n\t\t\tname_string =\n\t\t\t    acpi_ex_allocate_name_string(prefix_count, 0);\n\t\t\tif (!name_string) {\n\t\t\t\tstatus = AE_NO_MEMORY;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tname_string =\n\t\t\t    acpi_ex_allocate_name_string(prefix_count, 1);\n\t\t\tif (!name_string) {\n\t\t\t\tstatus = AE_NO_MEMORY;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tstatus =\n\t\t\t    acpi_ex_name_segment(&aml_address, name_string);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (AE_CTRL_PENDING == status && has_prefix) {\n\n\t\t \n\n\t\tACPI_ERROR((AE_INFO, \"Malformed Name at %p\", name_string));\n\t\tstatus = AE_AML_BAD_NAME;\n\t}\n\n\tif (ACPI_FAILURE(status)) {\n\t\tif (name_string) {\n\t\t\tACPI_FREE(name_string);\n\t\t}\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t*out_name_string = name_string;\n\t*out_name_length = (u32) (aml_address - in_aml_address);\n\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}