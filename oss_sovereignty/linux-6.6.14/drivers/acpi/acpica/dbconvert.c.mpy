{
  "module_name": "dbconvert.c",
  "hash_id": "47c2d9475cee286e3de235c08567c488abaef5bd66f4b5398840d086f4c7c972",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dbconvert.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acdebug.h\"\n\n#define _COMPONENT          ACPI_CA_DEBUGGER\nACPI_MODULE_NAME(\"dbconvert\")\n\n#define DB_DEFAULT_PKG_ELEMENTS     33\n \nacpi_status acpi_db_hex_char_to_value(int hex_char, u8 *return_value)\n{\n\tu8 value;\n\n\t \n\n\tif (!isxdigit(hex_char)) {\n\t\treturn (AE_BAD_HEX_CONSTANT);\n\t}\n\n\tif (hex_char <= 0x39) {\n\t\tvalue = (u8)(hex_char - 0x30);\n\t} else {\n\t\tvalue = (u8)(toupper(hex_char) - 0x37);\n\t}\n\n\t*return_value = value;\n\treturn (AE_OK);\n}\n\n \n\nstatic acpi_status acpi_db_hex_byte_to_binary(char *hex_byte, u8 *return_value)\n{\n\tu8 local0;\n\tu8 local1;\n\tacpi_status status;\n\n\t \n\n\tstatus = acpi_db_hex_char_to_value(hex_byte[0], &local0);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn (status);\n\t}\n\n\t \n\n\tstatus = acpi_db_hex_char_to_value(hex_byte[1], &local1);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn (status);\n\t}\n\n\t*return_value = (u8)((local0 << 4) | local1);\n\treturn (AE_OK);\n}\n\n \n\nstatic acpi_status\nacpi_db_convert_to_buffer(char *string, union acpi_object *object)\n{\n\tu32 i;\n\tu32 j;\n\tu32 length;\n\tu8 *buffer;\n\tacpi_status status;\n\n\t \n\n\tacpi_ut_remove_whitespace(&string);\n\n\t \n\n\tfor (i = 0, length = 0; string[i];) {\n\t\ti += 2;\n\t\tlength++;\n\n\t\twhile (string[i] && ((string[i] == ',') || (string[i] == ' '))) {\n\t\t\ti++;\n\t\t}\n\t}\n\n\tbuffer = ACPI_ALLOCATE(length);\n\tif (!buffer) {\n\t\treturn (AE_NO_MEMORY);\n\t}\n\n\t \n\n\tfor (i = 0, j = 0; string[i];) {\n\t\tstatus = acpi_db_hex_byte_to_binary(&string[i], &buffer[j]);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tACPI_FREE(buffer);\n\t\t\treturn (status);\n\t\t}\n\n\t\tj++;\n\t\ti += 2;\n\t\twhile (string[i] && ((string[i] == ',') || (string[i] == ' '))) {\n\t\t\ti++;\n\t\t}\n\t}\n\n\tobject->type = ACPI_TYPE_BUFFER;\n\tobject->buffer.pointer = buffer;\n\tobject->buffer.length = length;\n\treturn (AE_OK);\n}\n\n \n\nacpi_status acpi_db_convert_to_package(char *string, union acpi_object *object)\n{\n\tchar *this;\n\tchar *next;\n\tu32 i;\n\tacpi_object_type type;\n\tunion acpi_object *elements;\n\tacpi_status status;\n\n\telements =\n\t    ACPI_ALLOCATE_ZEROED(DB_DEFAULT_PKG_ELEMENTS *\n\t\t\t\t sizeof(union acpi_object));\n\n\tthis = string;\n\tfor (i = 0; i < (DB_DEFAULT_PKG_ELEMENTS - 1); i++) {\n\t\tthis = acpi_db_get_next_token(this, &next, &type);\n\t\tif (!this) {\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\n\t\tstatus = acpi_db_convert_to_object(type, this, &elements[i]);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\tacpi_db_delete_objects(i + 1, elements);\n\t\t\tACPI_FREE(elements);\n\t\t\treturn (status);\n\t\t}\n\n\t\tthis = next;\n\t}\n\n\tobject->type = ACPI_TYPE_PACKAGE;\n\tobject->package.count = i;\n\tobject->package.elements = elements;\n\treturn (AE_OK);\n}\n\n \n\nacpi_status\nacpi_db_convert_to_object(acpi_object_type type,\n\t\t\t  char *string, union acpi_object *object)\n{\n\tacpi_status status = AE_OK;\n\n\tswitch (type) {\n\tcase ACPI_TYPE_STRING:\n\n\t\tobject->type = ACPI_TYPE_STRING;\n\t\tobject->string.pointer = string;\n\t\tobject->string.length = (u32)strlen(string);\n\t\tbreak;\n\n\tcase ACPI_TYPE_BUFFER:\n\n\t\tstatus = acpi_db_convert_to_buffer(string, object);\n\t\tbreak;\n\n\tcase ACPI_TYPE_PACKAGE:\n\n\t\tstatus = acpi_db_convert_to_package(string, object);\n\t\tbreak;\n\n\tdefault:\n\n\t\tobject->type = ACPI_TYPE_INTEGER;\n\t\tstatus = acpi_ut_strtoul64(string, &object->integer.value);\n\t\tbreak;\n\t}\n\n\treturn (status);\n}\n\n \n\nu8 *acpi_db_encode_pld_buffer(struct acpi_pld_info *pld_info)\n{\n\tu32 *buffer;\n\tu32 dword;\n\n\tbuffer = ACPI_ALLOCATE_ZEROED(ACPI_PLD_BUFFER_SIZE);\n\tif (!buffer) {\n\t\treturn (NULL);\n\t}\n\n\t \n\n\tdword = 0;\n\tACPI_PLD_SET_REVISION(&dword, pld_info->revision);\n\tACPI_PLD_SET_IGNORE_COLOR(&dword, pld_info->ignore_color);\n\tACPI_PLD_SET_RED(&dword, pld_info->red);\n\tACPI_PLD_SET_GREEN(&dword, pld_info->green);\n\tACPI_PLD_SET_BLUE(&dword, pld_info->blue);\n\tACPI_MOVE_32_TO_32(&buffer[0], &dword);\n\n\t \n\n\tdword = 0;\n\tACPI_PLD_SET_WIDTH(&dword, pld_info->width);\n\tACPI_PLD_SET_HEIGHT(&dword, pld_info->height);\n\tACPI_MOVE_32_TO_32(&buffer[1], &dword);\n\n\t \n\n\tdword = 0;\n\tACPI_PLD_SET_USER_VISIBLE(&dword, pld_info->user_visible);\n\tACPI_PLD_SET_DOCK(&dword, pld_info->dock);\n\tACPI_PLD_SET_LID(&dword, pld_info->lid);\n\tACPI_PLD_SET_PANEL(&dword, pld_info->panel);\n\tACPI_PLD_SET_VERTICAL(&dword, pld_info->vertical_position);\n\tACPI_PLD_SET_HORIZONTAL(&dword, pld_info->horizontal_position);\n\tACPI_PLD_SET_SHAPE(&dword, pld_info->shape);\n\tACPI_PLD_SET_ORIENTATION(&dword, pld_info->group_orientation);\n\tACPI_PLD_SET_TOKEN(&dword, pld_info->group_token);\n\tACPI_PLD_SET_POSITION(&dword, pld_info->group_position);\n\tACPI_PLD_SET_BAY(&dword, pld_info->bay);\n\tACPI_MOVE_32_TO_32(&buffer[2], &dword);\n\n\t \n\n\tdword = 0;\n\tACPI_PLD_SET_EJECTABLE(&dword, pld_info->ejectable);\n\tACPI_PLD_SET_OSPM_EJECT(&dword, pld_info->ospm_eject_required);\n\tACPI_PLD_SET_CABINET(&dword, pld_info->cabinet_number);\n\tACPI_PLD_SET_CARD_CAGE(&dword, pld_info->card_cage_number);\n\tACPI_PLD_SET_REFERENCE(&dword, pld_info->reference);\n\tACPI_PLD_SET_ROTATION(&dword, pld_info->rotation);\n\tACPI_PLD_SET_ORDER(&dword, pld_info->order);\n\tACPI_MOVE_32_TO_32(&buffer[3], &dword);\n\n\tif (pld_info->revision >= 2) {\n\n\t\t \n\n\t\tdword = 0;\n\t\tACPI_PLD_SET_VERT_OFFSET(&dword, pld_info->vertical_offset);\n\t\tACPI_PLD_SET_HORIZ_OFFSET(&dword, pld_info->horizontal_offset);\n\t\tACPI_MOVE_32_TO_32(&buffer[4], &dword);\n\t}\n\n\treturn (ACPI_CAST_PTR(u8, buffer));\n}\n\n \n\n#define ACPI_PLD_OUTPUT     \"%20s : %-6X\\n\"\n\nvoid acpi_db_dump_pld_buffer(union acpi_object *obj_desc)\n{\n\tunion acpi_object *buffer_desc;\n\tstruct acpi_pld_info *pld_info;\n\tu8 *new_buffer;\n\tacpi_status status;\n\n\t \n\n\tif (obj_desc->type != ACPI_TYPE_PACKAGE) {\n\t\treturn;\n\t}\n\n\tbuffer_desc = &obj_desc->package.elements[0];\n\tif (buffer_desc->type != ACPI_TYPE_BUFFER) {\n\t\treturn;\n\t}\n\n\t \n\n\tstatus = acpi_decode_pld_buffer(buffer_desc->buffer.pointer,\n\t\t\t\t\tbuffer_desc->buffer.length, &pld_info);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn;\n\t}\n\n\t \n\n\tnew_buffer = acpi_db_encode_pld_buffer(pld_info);\n\tif (!new_buffer) {\n\t\tgoto exit;\n\t}\n\n\t \n\n\tif (memcmp(new_buffer, buffer_desc->buffer.pointer,\n\t\t   buffer_desc->buffer.length)) {\n\t\tacpi_os_printf\n\t\t    (\"Converted _PLD buffer does not compare. New:\\n\");\n\n\t\tacpi_ut_dump_buffer(new_buffer,\n\t\t\t\t    buffer_desc->buffer.length, DB_BYTE_DISPLAY,\n\t\t\t\t    0);\n\t}\n\n\t \n\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Revision\", pld_info->revision);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_IgnoreColor\",\n\t\t       pld_info->ignore_color);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Red\", pld_info->red);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Green\", pld_info->green);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Blue\", pld_info->blue);\n\n\t \n\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Width\", pld_info->width);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Height\", pld_info->height);\n\n\t \n\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_UserVisible\",\n\t\t       pld_info->user_visible);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Dock\", pld_info->dock);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Lid\", pld_info->lid);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Panel\", pld_info->panel);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_VerticalPosition\",\n\t\t       pld_info->vertical_position);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_HorizontalPosition\",\n\t\t       pld_info->horizontal_position);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Shape\", pld_info->shape);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_GroupOrientation\",\n\t\t       pld_info->group_orientation);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_GroupToken\",\n\t\t       pld_info->group_token);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_GroupPosition\",\n\t\t       pld_info->group_position);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Bay\", pld_info->bay);\n\n\t \n\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Ejectable\", pld_info->ejectable);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_EjectRequired\",\n\t\t       pld_info->ospm_eject_required);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_CabinetNumber\",\n\t\t       pld_info->cabinet_number);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_CardCageNumber\",\n\t\t       pld_info->card_cage_number);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Reference\", pld_info->reference);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Rotation\", pld_info->rotation);\n\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_Order\", pld_info->order);\n\n\t \n\n\tif (buffer_desc->buffer.length > 16) {\n\t\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_VerticalOffset\",\n\t\t\t       pld_info->vertical_offset);\n\t\tacpi_os_printf(ACPI_PLD_OUTPUT, \"PLD_HorizontalOffset\",\n\t\t\t       pld_info->horizontal_offset);\n\t}\n\n\tACPI_FREE(new_buffer);\nexit:\n\tACPI_FREE(pld_info);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}