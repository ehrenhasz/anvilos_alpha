{
  "module_name": "dsobject.c",
  "hash_id": "6ddea585fca2645fdf62609d3936800b15817786f2ab60a678b7bd4575113d0e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dsobject.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acparser.h\"\n#include \"amlcode.h\"\n#include \"acdispat.h\"\n#include \"acnamesp.h\"\n#include \"acinterp.h\"\n\n#define _COMPONENT          ACPI_DISPATCHER\nACPI_MODULE_NAME(\"dsobject\")\n\n \nacpi_status\nacpi_ds_build_internal_object(struct acpi_walk_state *walk_state,\n\t\t\t      union acpi_parse_object *op,\n\t\t\t      union acpi_operand_object **obj_desc_ptr)\n{\n\tunion acpi_operand_object *obj_desc;\n\tacpi_status status;\n\n\tACPI_FUNCTION_TRACE(ds_build_internal_object);\n\n\t*obj_desc_ptr = NULL;\n\tif (op->common.aml_opcode == AML_INT_NAMEPATH_OP) {\n\t\t \n\t\tif (!op->common.node) {\n\n\t\t\t \n\n\t\t\tif ((op->common.parent->common.aml_opcode ==\n\t\t\t     AML_PACKAGE_OP)\n\t\t\t    || (op->common.parent->common.aml_opcode ==\n\t\t\t\tAML_VARIABLE_PACKAGE_OP)) {\n\t\t\t\t \n\t\t\t\tgoto create_new_object;\n\t\t\t} else {\n\t\t\t\tstatus = acpi_ns_lookup(walk_state->scope_info,\n\t\t\t\t\t\t\top->common.value.string,\n\t\t\t\t\t\t\tACPI_TYPE_ANY,\n\t\t\t\t\t\t\tACPI_IMODE_EXECUTE,\n\t\t\t\t\t\t\tACPI_NS_SEARCH_PARENT |\n\t\t\t\t\t\t\tACPI_NS_DONT_OPEN_SCOPE,\n\t\t\t\t\t\t\tNULL,\n\t\t\t\t\t\t\tACPI_CAST_INDIRECT_PTR\n\t\t\t\t\t\t\t(struct\n\t\t\t\t\t\t\t acpi_namespace_node,\n\t\t\t\t\t\t\t &(op->common.node)));\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\tACPI_ERROR_NAMESPACE(walk_state->\n\t\t\t\t\t\t\t     scope_info,\n\t\t\t\t\t\t\t     op->common.value.\n\t\t\t\t\t\t\t     string, status);\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\ncreate_new_object:\n\n\t \n\n\tobj_desc = acpi_ut_create_internal_object((acpi_ps_get_opcode_info\n\t\t\t\t\t\t   (op->common.aml_opcode))->\n\t\t\t\t\t\t  object_type);\n\tif (!obj_desc) {\n\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t}\n\n\tstatus =\n\t    acpi_ds_init_object_from_op(walk_state, op, op->common.aml_opcode,\n\t\t\t\t\t&obj_desc);\n\tif (ACPI_FAILURE(status)) {\n\t\tacpi_ut_remove_reference(obj_desc);\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\tif ((op->common.parent->common.aml_opcode == AML_PACKAGE_OP) ||\n\t    (op->common.parent->common.aml_opcode == AML_VARIABLE_PACKAGE_OP)) {\n\t\tobj_desc->reference.resolved = TRUE;\n\n\t\tif ((op->common.aml_opcode == AML_INT_NAMEPATH_OP) &&\n\t\t    !obj_desc->reference.node) {\n\t\t\t \n\t\t\tobj_desc->reference.node =\n\t\t\t    walk_state->scope_info->scope.node;\n\t\t\tobj_desc->reference.aml = op->common.aml;\n\t\t\tobj_desc->reference.resolved = FALSE;\n\t\t}\n\t}\n\n\t*obj_desc_ptr = obj_desc;\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ds_build_internal_buffer_obj(struct acpi_walk_state *walk_state,\n\t\t\t\t  union acpi_parse_object *op,\n\t\t\t\t  u32 buffer_length,\n\t\t\t\t  union acpi_operand_object **obj_desc_ptr)\n{\n\tunion acpi_parse_object *arg;\n\tunion acpi_operand_object *obj_desc;\n\tunion acpi_parse_object *byte_list;\n\tu32 byte_list_length = 0;\n\n\tACPI_FUNCTION_TRACE(ds_build_internal_buffer_obj);\n\n\t \n\tobj_desc = *obj_desc_ptr;\n\tif (!obj_desc) {\n\n\t\t \n\n\t\tobj_desc = acpi_ut_create_internal_object(ACPI_TYPE_BUFFER);\n\t\t*obj_desc_ptr = obj_desc;\n\t\tif (!obj_desc) {\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\t}\n\n\t \n\targ = op->common.value.arg;\t \n\n\tbyte_list = arg->named.next;\n\tif (byte_list) {\n\t\tif (byte_list->common.aml_opcode != AML_INT_BYTELIST_OP) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Expecting bytelist, found AML opcode 0x%X in op %p\",\n\t\t\t\t    byte_list->common.aml_opcode, byte_list));\n\n\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\treturn (AE_TYPE);\n\t\t}\n\n\t\tbyte_list_length = (u32) byte_list->common.value.integer;\n\t}\n\n\t \n\tobj_desc->buffer.length = buffer_length;\n\tif (byte_list_length > buffer_length) {\n\t\tobj_desc->buffer.length = byte_list_length;\n\t}\n\n\t \n\n\tif (obj_desc->buffer.length == 0) {\n\t\tobj_desc->buffer.pointer = NULL;\n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t  \"Buffer defined with zero length in AML, creating\\n\"));\n\t} else {\n\t\tobj_desc->buffer.pointer =\n\t\t    ACPI_ALLOCATE_ZEROED(obj_desc->buffer.length);\n\t\tif (!obj_desc->buffer.pointer) {\n\t\t\tacpi_ut_delete_object_desc(obj_desc);\n\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t}\n\n\t\t \n\n\t\tif (byte_list) {\n\t\t\tmemcpy(obj_desc->buffer.pointer, byte_list->named.data,\n\t\t\t       byte_list_length);\n\t\t}\n\t}\n\n\tobj_desc->buffer.flags |= AOPOBJ_DATA_VALID;\n\top->common.node = ACPI_CAST_PTR(struct acpi_namespace_node, obj_desc);\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_ds_create_node(struct acpi_walk_state *walk_state,\n\t\t    struct acpi_namespace_node *node,\n\t\t    union acpi_parse_object *op)\n{\n\tacpi_status status;\n\tunion acpi_operand_object *obj_desc;\n\n\tACPI_FUNCTION_TRACE_PTR(ds_create_node, op);\n\n\t \n\tif (acpi_ns_get_attached_object(node)) {\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\tif (!op->common.value.arg) {\n\n\t\t \n\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\n\tstatus =\n\t    acpi_ds_build_internal_object(walk_state, op->common.value.arg,\n\t\t\t\t\t  &obj_desc);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tnode->type = obj_desc->common.type;\n\n\t \n\n\tstatus = acpi_ns_attach_object(node, obj_desc, node->type);\n\n\t \n\n\tacpi_ut_remove_reference(obj_desc);\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ds_init_object_from_op(struct acpi_walk_state *walk_state,\n\t\t\t    union acpi_parse_object *op,\n\t\t\t    u16 opcode,\n\t\t\t    union acpi_operand_object **ret_obj_desc)\n{\n\tconst struct acpi_opcode_info *op_info;\n\tunion acpi_operand_object *obj_desc;\n\tacpi_status status = AE_OK;\n\n\tACPI_FUNCTION_TRACE(ds_init_object_from_op);\n\n\tobj_desc = *ret_obj_desc;\n\top_info = acpi_ps_get_opcode_info(opcode);\n\tif (op_info->class == AML_CLASS_UNKNOWN) {\n\n\t\t \n\n\t\treturn_ACPI_STATUS(AE_TYPE);\n\t}\n\n\t \n\n\tswitch (obj_desc->common.type) {\n\tcase ACPI_TYPE_BUFFER:\n\t\t \n\t\tobj_desc->buffer.node =\n\t\t    ACPI_CAST_PTR(struct acpi_namespace_node,\n\t\t\t\t  walk_state->operands[0]);\n\t\tobj_desc->buffer.aml_start = op->named.data;\n\t\tobj_desc->buffer.aml_length = op->named.length;\n\t\tbreak;\n\n\tcase ACPI_TYPE_PACKAGE:\n\t\t \n\t\tobj_desc->package.node =\n\t\t    ACPI_CAST_PTR(struct acpi_namespace_node,\n\t\t\t\t  walk_state->operands[0]);\n\n\t\tif (!op->named.data) {\n\t\t\treturn_ACPI_STATUS(AE_OK);\n\t\t}\n\n\t\tobj_desc->package.aml_start = op->named.data;\n\t\tobj_desc->package.aml_length = op->named.length;\n\t\tbreak;\n\n\tcase ACPI_TYPE_INTEGER:\n\n\t\tswitch (op_info->type) {\n\t\tcase AML_TYPE_CONSTANT:\n\t\t\t \n\t\t\tobj_desc->common.flags = AOPOBJ_AML_CONSTANT;\n\n\t\t\tswitch (opcode) {\n\t\t\tcase AML_ZERO_OP:\n\n\t\t\t\tobj_desc->integer.value = 0;\n\t\t\t\tbreak;\n\n\t\t\tcase AML_ONE_OP:\n\n\t\t\t\tobj_desc->integer.value = 1;\n\t\t\t\tbreak;\n\n\t\t\tcase AML_ONES_OP:\n\n\t\t\t\tobj_desc->integer.value = ACPI_UINT64_MAX;\n\n\t\t\t\t \n\n\t\t\t\t(void)acpi_ex_truncate_for32bit_table(obj_desc);\n\t\t\t\tbreak;\n\n\t\t\tcase AML_REVISION_OP:\n\n\t\t\t\tobj_desc->integer.value = ACPI_CA_VERSION;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Unknown constant opcode 0x%X\",\n\t\t\t\t\t    opcode));\n\t\t\t\tstatus = AE_AML_OPERAND_TYPE;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase AML_TYPE_LITERAL:\n\n\t\t\tobj_desc->integer.value = op->common.value.integer;\n\n\t\t\tif (acpi_ex_truncate_for32bit_table(obj_desc)) {\n\n\t\t\t\t \n\n\t\t\t\tACPI_WARNING((AE_INFO,\n\t\t\t\t\t      \"Truncated 64-bit constant found in 32-bit table: %8.8X%8.8X => %8.8X\",\n\t\t\t\t\t      ACPI_FORMAT_UINT64(op->common.\n\t\t\t\t\t\t\t\t value.integer),\n\t\t\t\t\t      (u32)obj_desc->integer.value));\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tACPI_ERROR((AE_INFO, \"Unknown Integer type 0x%X\",\n\t\t\t\t    op_info->type));\n\t\t\tstatus = AE_AML_OPERAND_TYPE;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase ACPI_TYPE_STRING:\n\n\t\tobj_desc->string.pointer = op->common.value.string;\n\t\tobj_desc->string.length = (u32)strlen(op->common.value.string);\n\n\t\t \n\t\tobj_desc->common.flags |= AOPOBJ_STATIC_POINTER;\n\t\tbreak;\n\n\tcase ACPI_TYPE_METHOD:\n\t\tbreak;\n\n\tcase ACPI_TYPE_LOCAL_REFERENCE:\n\n\t\tswitch (op_info->type) {\n\t\tcase AML_TYPE_LOCAL_VARIABLE:\n\n\t\t\t \n\n\t\t\tobj_desc->reference.value =\n\t\t\t    ((u32)opcode) - AML_FIRST_LOCAL_OP;\n\t\t\tobj_desc->reference.class = ACPI_REFCLASS_LOCAL;\n\n\t\t\tstatus =\n\t\t\t    acpi_ds_method_data_get_node(ACPI_REFCLASS_LOCAL,\n\t\t\t\t\t\t\t obj_desc->reference.\n\t\t\t\t\t\t\t value, walk_state,\n\t\t\t\t\t\t\t ACPI_CAST_INDIRECT_PTR\n\t\t\t\t\t\t\t (struct\n\t\t\t\t\t\t\t  acpi_namespace_node,\n\t\t\t\t\t\t\t  &obj_desc->reference.\n\t\t\t\t\t\t\t  object));\n\t\t\tbreak;\n\n\t\tcase AML_TYPE_METHOD_ARGUMENT:\n\n\t\t\t \n\n\t\t\tobj_desc->reference.value =\n\t\t\t    ((u32)opcode) - AML_FIRST_ARG_OP;\n\t\t\tobj_desc->reference.class = ACPI_REFCLASS_ARG;\n\n\t\t\tstatus = acpi_ds_method_data_get_node(ACPI_REFCLASS_ARG,\n\t\t\t\t\t\t\t      obj_desc->\n\t\t\t\t\t\t\t      reference.value,\n\t\t\t\t\t\t\t      walk_state,\n\t\t\t\t\t\t\t      ACPI_CAST_INDIRECT_PTR\n\t\t\t\t\t\t\t      (struct\n\t\t\t\t\t\t\t       acpi_namespace_node,\n\t\t\t\t\t\t\t       &obj_desc->\n\t\t\t\t\t\t\t       reference.\n\t\t\t\t\t\t\t       object));\n\t\t\tbreak;\n\n\t\tdefault:\t \n\n\t\t\tswitch (op->common.aml_opcode) {\n\t\t\tcase AML_INT_NAMEPATH_OP:\n\n\t\t\t\t \n\n\t\t\t\tobj_desc->reference.node = op->common.node;\n\t\t\t\tobj_desc->reference.class = ACPI_REFCLASS_NAME;\n\t\t\t\tif (op->common.node) {\n\t\t\t\t\tobj_desc->reference.object =\n\t\t\t\t\t    op->common.node->object;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase AML_DEBUG_OP:\n\n\t\t\t\tobj_desc->reference.class = ACPI_REFCLASS_DEBUG;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Unimplemented reference type for AML opcode: 0x%4.4X\",\n\t\t\t\t\t    opcode));\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\n\t\tACPI_ERROR((AE_INFO, \"Unimplemented data type: 0x%X\",\n\t\t\t    obj_desc->common.type));\n\n\t\tstatus = AE_AML_OPERAND_TYPE;\n\t\tbreak;\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}