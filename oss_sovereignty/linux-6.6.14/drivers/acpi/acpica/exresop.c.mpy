{
  "module_name": "exresop.c",
  "hash_id": "0aab473e73a3c32c8f8693f13148c0ae75dbbc0532258cc2256bdea61110f38b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/exresop.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"amlcode.h\"\n#include \"acparser.h\"\n#include \"acinterp.h\"\n#include \"acnamesp.h\"\n\n#define _COMPONENT          ACPI_EXECUTER\nACPI_MODULE_NAME(\"exresop\")\n\n \nstatic acpi_status\nacpi_ex_check_object_type(acpi_object_type type_needed,\n\t\t\t  acpi_object_type this_type, void *object);\n\n \n\nstatic acpi_status\nacpi_ex_check_object_type(acpi_object_type type_needed,\n\t\t\t  acpi_object_type this_type, void *object)\n{\n\tACPI_FUNCTION_ENTRY();\n\n\tif (type_needed == ACPI_TYPE_ANY) {\n\n\t\t \n\n\t\treturn (AE_OK);\n\t}\n\n\tif (type_needed == ACPI_TYPE_LOCAL_REFERENCE) {\n\t\t \n\t\tif ((this_type == ACPI_TYPE_INTEGER) &&\n\t\t    (((union acpi_operand_object *)object)->common.flags &\n\t\t     AOPOBJ_AML_CONSTANT)) {\n\t\t\treturn (AE_OK);\n\t\t}\n\t}\n\n\tif (type_needed != this_type) {\n\t\tACPI_ERROR((AE_INFO,\n\t\t\t    \"Needed type [%s], found [%s] %p\",\n\t\t\t    acpi_ut_get_type_name(type_needed),\n\t\t\t    acpi_ut_get_type_name(this_type), object));\n\n\t\treturn (AE_AML_OPERAND_TYPE);\n\t}\n\n\treturn (AE_OK);\n}\n\n \n\nacpi_status\nacpi_ex_resolve_operands(u16 opcode,\n\t\t\t union acpi_operand_object **stack_ptr,\n\t\t\t struct acpi_walk_state *walk_state)\n{\n\tunion acpi_operand_object *obj_desc;\n\tacpi_status status = AE_OK;\n\tu8 object_type;\n\tu32 arg_types;\n\tconst struct acpi_opcode_info *op_info;\n\tu32 this_arg_type;\n\tacpi_object_type type_needed;\n\tu16 target_op = 0;\n\n\tACPI_FUNCTION_TRACE_U32(ex_resolve_operands, opcode);\n\n\top_info = acpi_ps_get_opcode_info(opcode);\n\tif (op_info->class == AML_CLASS_UNKNOWN) {\n\t\treturn_ACPI_STATUS(AE_AML_BAD_OPCODE);\n\t}\n\n\targ_types = op_info->runtime_args;\n\tif (arg_types == ARGI_INVALID_OPCODE) {\n\t\tACPI_ERROR((AE_INFO, \"Unknown AML opcode 0x%X\", opcode));\n\n\t\treturn_ACPI_STATUS(AE_AML_INTERNAL);\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t  \"Opcode %X [%s] RequiredOperandTypes=%8.8X\\n\",\n\t\t\t  opcode, op_info->name, arg_types));\n\n\t \n\twhile (GET_CURRENT_ARG_TYPE(arg_types)) {\n\t\tif (!stack_ptr || !*stack_ptr) {\n\t\t\tACPI_ERROR((AE_INFO, \"Null stack entry at %p\",\n\t\t\t\t    stack_ptr));\n\n\t\t\treturn_ACPI_STATUS(AE_AML_INTERNAL);\n\t\t}\n\n\t\t \n\n\t\tobj_desc = *stack_ptr;\n\n\t\t \n\n\t\tswitch (ACPI_GET_DESCRIPTOR_TYPE(obj_desc)) {\n\t\tcase ACPI_DESC_TYPE_NAMED:\n\n\t\t\t \n\n\t\t\tobject_type =\n\t\t\t    ((struct acpi_namespace_node *)obj_desc)->type;\n\n\t\t\t \n\t\t\tif (object_type == ACPI_TYPE_LOCAL_ALIAS) {\n\t\t\t\tobj_desc = acpi_ns_get_attached_object((struct\n\t\t\t\t\t\t\t\t\tacpi_namespace_node\n\t\t\t\t\t\t\t\t\t*)\n\t\t\t\t\t\t\t\t       obj_desc);\n\t\t\t\t*stack_ptr = obj_desc;\n\t\t\t\tobject_type =\n\t\t\t\t    ((struct acpi_namespace_node *)obj_desc)->\n\t\t\t\t    type;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tcase ACPI_DESC_TYPE_OPERAND:\n\n\t\t\t \n\n\t\t\tobject_type = obj_desc->common.type;\n\n\t\t\t \n\n\t\t\tif (!acpi_ut_valid_object_type(object_type)) {\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Bad operand object type [0x%X]\",\n\t\t\t\t\t    object_type));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\n\t\t\tif (object_type == (u8) ACPI_TYPE_LOCAL_REFERENCE) {\n\n\t\t\t\t \n\n\t\t\t\tswitch (obj_desc->reference.class) {\n\t\t\t\tcase ACPI_REFCLASS_DEBUG:\n\n\t\t\t\t\ttarget_op = AML_DEBUG_OP;\n\n\t\t\t\t\tACPI_FALLTHROUGH;\n\n\t\t\t\tcase ACPI_REFCLASS_ARG:\n\t\t\t\tcase ACPI_REFCLASS_LOCAL:\n\t\t\t\tcase ACPI_REFCLASS_INDEX:\n\t\t\t\tcase ACPI_REFCLASS_REFOF:\n\t\t\t\tcase ACPI_REFCLASS_TABLE:\t \n\t\t\t\tcase ACPI_REFCLASS_NAME:\t \n\n\t\t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t\t\t\t  \"Operand is a Reference, Class [%s] %2.2X\\n\",\n\t\t\t\t\t\t\t  acpi_ut_get_reference_name\n\t\t\t\t\t\t\t  (obj_desc),\n\t\t\t\t\t\t\t  obj_desc->reference.\n\t\t\t\t\t\t\t  class));\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t\t    \"Unknown Reference Class 0x%2.2X in %p\",\n\t\t\t\t\t\t    obj_desc->reference.class,\n\t\t\t\t\t\t    obj_desc));\n\n\t\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tACPI_ERROR((AE_INFO, \"Invalid descriptor %p [%s]\",\n\t\t\t\t    obj_desc,\n\t\t\t\t    acpi_ut_get_descriptor_name(obj_desc)));\n\n\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t}\n\n\t\t \n\n\t\tthis_arg_type = GET_CURRENT_ARG_TYPE(arg_types);\n\t\tINCREMENT_ARG_LIST(arg_types);\n\n\t\t \n\t\tswitch (this_arg_type) {\n\t\tcase ARGI_REF_OR_STRING:\t \n\n\t\t\tif ((ACPI_GET_DESCRIPTOR_TYPE(obj_desc) ==\n\t\t\t     ACPI_DESC_TYPE_OPERAND) &&\n\t\t\t    (obj_desc->common.type == ACPI_TYPE_STRING)) {\n\t\t\t\t \n\t\t\t\tgoto next_operand;\n\t\t\t}\n\n\t\t\t \n\t\t\tACPI_FALLTHROUGH;\n\n\t\tcase ARGI_REFERENCE:\t \n\t\tcase ARGI_INTEGER_REF:\n\t\tcase ARGI_OBJECT_REF:\n\t\tcase ARGI_DEVICE_REF:\n\t\tcase ARGI_TARGETREF:\t \n\t\tcase ARGI_FIXED_TARGET:\t \n\t\tcase ARGI_SIMPLE_TARGET:\t \n\t\tcase ARGI_STORE_TARGET:\n\n\t\t\t \n\t\t\tif (ACPI_GET_DESCRIPTOR_TYPE(obj_desc) ==\n\t\t\t    ACPI_DESC_TYPE_NAMED) {\n\t\t\t\tgoto next_operand;\n\t\t\t}\n\n\t\t\tstatus =\n\t\t\t    acpi_ex_check_object_type(ACPI_TYPE_LOCAL_REFERENCE,\n\t\t\t\t\t\t      object_type, obj_desc);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_DATAREFOBJ:\t \n\t\t\t \n\t\t\tif ((opcode == AML_STORE_OP) &&\n\t\t\t    ((*stack_ptr)->common.type ==\n\t\t\t     ACPI_TYPE_LOCAL_REFERENCE)\n\t\t\t    && ((*stack_ptr)->reference.class ==\n\t\t\t\tACPI_REFCLASS_INDEX)) {\n\t\t\t\tgoto next_operand;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\t\tstatus = acpi_ex_resolve_to_value(stack_ptr, walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\t \n\n\t\tobj_desc = *stack_ptr;\n\n\t\t \n\t\tswitch (this_arg_type) {\n\t\t\t \n\t\tcase ARGI_MUTEX:\n\n\t\t\t \n\n\t\t\ttype_needed = ACPI_TYPE_MUTEX;\n\t\t\tbreak;\n\n\t\tcase ARGI_EVENT:\n\n\t\t\t \n\n\t\t\ttype_needed = ACPI_TYPE_EVENT;\n\t\t\tbreak;\n\n\t\tcase ARGI_PACKAGE:\t \n\n\t\t\t \n\n\t\t\ttype_needed = ACPI_TYPE_PACKAGE;\n\t\t\tbreak;\n\n\t\tcase ARGI_ANYTYPE:\n\n\t\t\t \n\n\t\t\ttype_needed = ACPI_TYPE_ANY;\n\t\t\tbreak;\n\n\t\tcase ARGI_DDBHANDLE:\n\n\t\t\t \n\n\t\t\ttype_needed = ACPI_TYPE_LOCAL_REFERENCE;\n\t\t\tbreak;\n\n\t\t\t \n\t\tcase ARGI_INTEGER:\n\n\t\t\t \n\t\t\tstatus = acpi_ex_convert_to_integer(obj_desc, stack_ptr,\n\t\t\t\t\t\t\t    ACPI_IMPLICIT_CONVERSION);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tif (status == AE_TYPE) {\n\t\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t\t    \"Needed [Integer/String/Buffer], found [%s] %p\",\n\t\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t\t}\n\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\n\t\t\tif (obj_desc != *stack_ptr) {\n\t\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_BUFFER:\n\t\t\t \n\t\t\tstatus = acpi_ex_convert_to_buffer(obj_desc, stack_ptr);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tif (status == AE_TYPE) {\n\t\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t\t    \"Needed [Integer/String/Buffer], found [%s] %p\",\n\t\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t\t}\n\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\n\t\t\tif (obj_desc != *stack_ptr) {\n\t\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_STRING:\n\t\t\t \n\t\t\tstatus =\n\t\t\t    acpi_ex_convert_to_string(obj_desc, stack_ptr,\n\t\t\t\t\t\t      ACPI_IMPLICIT_CONVERT_HEX);\n\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\tif (status == AE_TYPE) {\n\t\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t\t    \"Needed [Integer/String/Buffer], found [%s] %p\",\n\t\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t\t}\n\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\n\t\t\tif (obj_desc != *stack_ptr) {\n\t\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_COMPUTEDATA:\n\n\t\t\t \n\n\t\t\tswitch (obj_desc->common.type) {\n\t\t\tcase ACPI_TYPE_INTEGER:\n\t\t\tcase ACPI_TYPE_STRING:\n\t\t\tcase ACPI_TYPE_BUFFER:\n\n\t\t\t\t \n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Needed [Integer/String/Buffer], found [%s] %p\",\n\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_BUFFER_OR_STRING:\n\n\t\t\t \n\n\t\t\tswitch (obj_desc->common.type) {\n\t\t\tcase ACPI_TYPE_STRING:\n\t\t\tcase ACPI_TYPE_BUFFER:\n\n\t\t\t\t \n\t\t\t\tbreak;\n\n\t\t\tcase ACPI_TYPE_INTEGER:\n\n\t\t\t\t \n\n\t\t\t\tstatus =\n\t\t\t\t    acpi_ex_convert_to_buffer(obj_desc,\n\t\t\t\t\t\t\t      stack_ptr);\n\t\t\t\tif (ACPI_FAILURE(status)) {\n\t\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t\t}\n\n\t\t\t\tif (obj_desc != *stack_ptr) {\n\t\t\t\t\tacpi_ut_remove_reference(obj_desc);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Needed [Integer/String/Buffer], found [%s] %p\",\n\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_DATAOBJECT:\n\t\t\t \n\t\t\tswitch (obj_desc->common.type) {\n\t\t\tcase ACPI_TYPE_PACKAGE:\n\t\t\tcase ACPI_TYPE_STRING:\n\t\t\tcase ACPI_TYPE_BUFFER:\n\t\t\tcase ACPI_TYPE_LOCAL_REFERENCE:\n\n\t\t\t\t \n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Needed [Buffer/String/Package/Reference], found [%s] %p\",\n\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_COMPLEXOBJ:\n\n\t\t\t \n\n\t\t\tswitch (obj_desc->common.type) {\n\t\t\tcase ACPI_TYPE_PACKAGE:\n\t\t\tcase ACPI_TYPE_STRING:\n\t\t\tcase ACPI_TYPE_BUFFER:\n\n\t\t\t\t \n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Needed [Buffer/String/Package], found [%s] %p\",\n\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_REGION_OR_BUFFER:\t \n\n\t\t\t \n\t\t\tswitch (obj_desc->common.type) {\n\t\t\tcase ACPI_TYPE_BUFFER:\n\t\t\tcase ACPI_TYPE_REGION:\n\n\t\t\t\t \n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Needed [Region/Buffer], found [%s] %p\",\n\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tcase ARGI_DATAREFOBJ:\n\n\t\t\t \n\n\t\t\tswitch (obj_desc->common.type) {\n\t\t\tcase ACPI_TYPE_INTEGER:\n\t\t\tcase ACPI_TYPE_PACKAGE:\n\t\t\tcase ACPI_TYPE_STRING:\n\t\t\tcase ACPI_TYPE_BUFFER:\n\t\t\tcase ACPI_TYPE_BUFFER_FIELD:\n\t\t\tcase ACPI_TYPE_LOCAL_REFERENCE:\n\t\t\tcase ACPI_TYPE_LOCAL_REGION_FIELD:\n\t\t\tcase ACPI_TYPE_LOCAL_BANK_FIELD:\n\t\t\tcase ACPI_TYPE_LOCAL_INDEX_FIELD:\n\t\t\tcase ACPI_TYPE_DDB_HANDLE:\n\n\t\t\t\t \n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tif (acpi_gbl_enable_interpreter_slack) {\n\t\t\t\t\t \n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (target_op == AML_DEBUG_OP) {\n\n\t\t\t\t\t \n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Needed Integer/Buffer/String/Package/Ref/Ddb]\"\n\t\t\t\t\t    \", found [%s] %p\",\n\t\t\t\t\t    acpi_ut_get_object_type_name\n\t\t\t\t\t    (obj_desc), obj_desc));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_OPERAND_TYPE);\n\t\t\t}\n\t\t\tgoto next_operand;\n\n\t\tdefault:\n\n\t\t\t \n\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Internal - Unknown ARGI (required operand) type 0x%X\",\n\t\t\t\t    this_arg_type));\n\n\t\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t\t}\n\n\t\t \n\t\tstatus =\n\t\t    acpi_ex_check_object_type(type_needed,\n\t\t\t\t\t      (*stack_ptr)->common.type,\n\t\t\t\t\t      *stack_ptr);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\nnext_operand:\n\t\t \n\t\tif (GET_CURRENT_ARG_TYPE(arg_types)) {\n\t\t\tstack_ptr--;\n\t\t}\n\t}\n\n\tACPI_DUMP_OPERANDS(walk_state->operands,\n\t\t\t   acpi_ps_get_opcode_name(opcode),\n\t\t\t   walk_state->num_operands);\n\n\treturn_ACPI_STATUS(status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}