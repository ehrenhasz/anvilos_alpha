{
  "module_name": "dsmthdat.c",
  "hash_id": "15ab40cde071ea87d475233871fa2b220a9dcf7655b60b0029e723f11a8d5668",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/acpica/dsmthdat.c",
  "human_readable_source": "\n \n\n#include <acpi/acpi.h>\n#include \"accommon.h\"\n#include \"acdispat.h\"\n#include \"acnamesp.h\"\n#include \"acinterp.h\"\n\n#define _COMPONENT          ACPI_DISPATCHER\nACPI_MODULE_NAME(\"dsmthdat\")\n\n \nstatic void\nacpi_ds_method_data_delete_value(u8 type,\n\t\t\t\t u32 index, struct acpi_walk_state *walk_state);\n\nstatic acpi_status\nacpi_ds_method_data_set_value(u8 type,\n\t\t\t      u32 index,\n\t\t\t      union acpi_operand_object *object,\n\t\t\t      struct acpi_walk_state *walk_state);\n\n#ifdef ACPI_OBSOLETE_FUNCTIONS\nacpi_object_type\nacpi_ds_method_data_get_type(u16 opcode,\n\t\t\t     u32 index, struct acpi_walk_state *walk_state);\n#endif\n\n \n\nvoid acpi_ds_method_data_init(struct acpi_walk_state *walk_state)\n{\n\tu32 i;\n\n\tACPI_FUNCTION_TRACE(ds_method_data_init);\n\n\t \n\n\tfor (i = 0; i < ACPI_METHOD_NUM_ARGS; i++) {\n\t\tACPI_MOVE_32_TO_32(&walk_state->arguments[i].name,\n\t\t\t\t   NAMEOF_ARG_NTE);\n\n\t\twalk_state->arguments[i].name.integer |= (i << 24);\n\t\twalk_state->arguments[i].descriptor_type = ACPI_DESC_TYPE_NAMED;\n\t\twalk_state->arguments[i].type = ACPI_TYPE_ANY;\n\t\twalk_state->arguments[i].flags = ANOBJ_METHOD_ARG;\n\t}\n\n\t \n\n\tfor (i = 0; i < ACPI_METHOD_NUM_LOCALS; i++) {\n\t\tACPI_MOVE_32_TO_32(&walk_state->local_variables[i].name,\n\t\t\t\t   NAMEOF_LOCAL_NTE);\n\n\t\twalk_state->local_variables[i].name.integer |= (i << 24);\n\t\twalk_state->local_variables[i].descriptor_type =\n\t\t    ACPI_DESC_TYPE_NAMED;\n\t\twalk_state->local_variables[i].type = ACPI_TYPE_ANY;\n\t\twalk_state->local_variables[i].flags = ANOBJ_METHOD_LOCAL;\n\t}\n\n\treturn_VOID;\n}\n\n \n\nvoid acpi_ds_method_data_delete_all(struct acpi_walk_state *walk_state)\n{\n\tu32 index;\n\n\tACPI_FUNCTION_TRACE(ds_method_data_delete_all);\n\n\t \n\n\tfor (index = 0; index < ACPI_METHOD_NUM_LOCALS; index++) {\n\t\tif (walk_state->local_variables[index].object) {\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Deleting Local%u=%p\\n\",\n\t\t\t\t\t  index,\n\t\t\t\t\t  walk_state->local_variables[index].\n\t\t\t\t\t  object));\n\n\t\t\t \n\n\t\t\tacpi_ns_detach_object(&walk_state->\n\t\t\t\t\t      local_variables[index]);\n\t\t}\n\t}\n\n\t \n\n\tfor (index = 0; index < ACPI_METHOD_NUM_ARGS; index++) {\n\t\tif (walk_state->arguments[index].object) {\n\t\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Deleting Arg%u=%p\\n\",\n\t\t\t\t\t  index,\n\t\t\t\t\t  walk_state->arguments[index].object));\n\n\t\t\t \n\n\t\t\tacpi_ns_detach_object(&walk_state->arguments[index]);\n\t\t}\n\t}\n\n\treturn_VOID;\n}\n\n \n\nacpi_status\nacpi_ds_method_data_init_args(union acpi_operand_object **params,\n\t\t\t      u32 max_param_count,\n\t\t\t      struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tu32 index = 0;\n\n\tACPI_FUNCTION_TRACE_PTR(ds_method_data_init_args, params);\n\n\tif (!params) {\n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t  \"No parameter list passed to method\\n\"));\n\t\treturn_ACPI_STATUS(AE_OK);\n\t}\n\n\t \n\n\twhile ((index < ACPI_METHOD_NUM_ARGS) &&\n\t       (index < max_param_count) && params[index]) {\n\t\t \n\t\tstatus =\n\t\t    acpi_ds_method_data_set_value(ACPI_REFCLASS_ARG, index,\n\t\t\t\t\t\t  params[index], walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\n\t\tindex++;\n\t}\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"%u args passed to method\\n\", index));\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nacpi_status\nacpi_ds_method_data_get_node(u8 type,\n\t\t\t     u32 index,\n\t\t\t     struct acpi_walk_state *walk_state,\n\t\t\t     struct acpi_namespace_node **node)\n{\n\tACPI_FUNCTION_TRACE(ds_method_data_get_node);\n\n\t \n\tswitch (type) {\n\tcase ACPI_REFCLASS_LOCAL:\n\n\t\tif (index > ACPI_METHOD_MAX_LOCAL) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Local index %u is invalid (max %u)\",\n\t\t\t\t    index, ACPI_METHOD_MAX_LOCAL));\n\t\t\treturn_ACPI_STATUS(AE_AML_INVALID_INDEX);\n\t\t}\n\n\t\t \n\n\t\t*node = &walk_state->local_variables[index];\n\t\tbreak;\n\n\tcase ACPI_REFCLASS_ARG:\n\n\t\tif (index > ACPI_METHOD_MAX_ARG) {\n\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t    \"Arg index %u is invalid (max %u)\",\n\t\t\t\t    index, ACPI_METHOD_MAX_ARG));\n\t\t\treturn_ACPI_STATUS(AE_AML_INVALID_INDEX);\n\t\t}\n\n\t\t \n\n\t\t*node = &walk_state->arguments[index];\n\t\tbreak;\n\n\tdefault:\n\n\t\tACPI_ERROR((AE_INFO, \"Type %u is invalid\", type));\n\t\treturn_ACPI_STATUS(AE_TYPE);\n\t}\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nstatic acpi_status\nacpi_ds_method_data_set_value(u8 type,\n\t\t\t      u32 index,\n\t\t\t      union acpi_operand_object *object,\n\t\t\t      struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tstruct acpi_namespace_node *node;\n\n\tACPI_FUNCTION_TRACE(ds_method_data_set_value);\n\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t  \"NewObj %p Type %2.2X, Refs=%u [%s]\\n\", object,\n\t\t\t  type, object->common.reference_count,\n\t\t\t  acpi_ut_get_type_name(object->common.type)));\n\n\t \n\n\tstatus = acpi_ds_method_data_get_node(type, index, walk_state, &node);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\tacpi_ut_add_reference(object);\n\n\t \n\n\tnode->object = object;\n\treturn_ACPI_STATUS(status);\n}\n\n \n\nacpi_status\nacpi_ds_method_data_get_value(u8 type,\n\t\t\t      u32 index,\n\t\t\t      struct acpi_walk_state *walk_state,\n\t\t\t      union acpi_operand_object **dest_desc)\n{\n\tacpi_status status;\n\tstruct acpi_namespace_node *node;\n\tunion acpi_operand_object *object;\n\n\tACPI_FUNCTION_TRACE(ds_method_data_get_value);\n\n\t \n\n\tif (!dest_desc) {\n\t\tACPI_ERROR((AE_INFO, \"Null object descriptor pointer\"));\n\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t}\n\n\t \n\n\tstatus = acpi_ds_method_data_get_node(type, index, walk_state, &node);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\n\tobject = node->object;\n\n\t \n\n\tif (!object) {\n\t\t \n\n\t\t \n\n\t\tif (acpi_gbl_enable_interpreter_slack) {\n\t\t\tobject = acpi_ut_create_integer_object((u64) 0);\n\t\t\tif (!object) {\n\t\t\t\treturn_ACPI_STATUS(AE_NO_MEMORY);\n\t\t\t}\n\n\t\t\tnode->object = object;\n\t\t}\n\n\t\t \n\n\t\telse\n\t\t\tswitch (type) {\n\t\t\tcase ACPI_REFCLASS_ARG:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Uninitialized Arg[%u] at node %p\",\n\t\t\t\t\t    index, node));\n\n\t\t\t\treturn_ACPI_STATUS(AE_AML_UNINITIALIZED_ARG);\n\n\t\t\tcase ACPI_REFCLASS_LOCAL:\n\t\t\t\t \n\t\t\t\treturn_ACPI_STATUS(AE_AML_UNINITIALIZED_LOCAL);\n\n\t\t\tdefault:\n\n\t\t\t\tACPI_ERROR((AE_INFO,\n\t\t\t\t\t    \"Not a Arg/Local opcode: 0x%X\",\n\t\t\t\t\t    type));\n\t\t\t\treturn_ACPI_STATUS(AE_AML_INTERNAL);\n\t\t\t}\n\t}\n\n\t \n\t*dest_desc = object;\n\tacpi_ut_add_reference(object);\n\n\treturn_ACPI_STATUS(AE_OK);\n}\n\n \n\nstatic void\nacpi_ds_method_data_delete_value(u8 type,\n\t\t\t\t u32 index, struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tstruct acpi_namespace_node *node;\n\tunion acpi_operand_object *object;\n\n\tACPI_FUNCTION_TRACE(ds_method_data_delete_value);\n\n\t \n\n\tstatus = acpi_ds_method_data_get_node(type, index, walk_state, &node);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_VOID;\n\t}\n\n\t \n\n\tobject = acpi_ns_get_attached_object(node);\n\n\t \n\tnode->object = NULL;\n\n\tif ((object) &&\n\t    (ACPI_GET_DESCRIPTOR_TYPE(object) == ACPI_DESC_TYPE_OPERAND)) {\n\t\t \n\t\tacpi_ut_remove_reference(object);\n\t}\n\n\treturn_VOID;\n}\n\n \n\nacpi_status\nacpi_ds_store_object_to_local(u8 type,\n\t\t\t      u32 index,\n\t\t\t      union acpi_operand_object *obj_desc,\n\t\t\t      struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tstruct acpi_namespace_node *node;\n\tunion acpi_operand_object *current_obj_desc;\n\tunion acpi_operand_object *new_obj_desc;\n\n\tACPI_FUNCTION_TRACE(ds_store_object_to_local);\n\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Type=%2.2X Index=%u Obj=%p\\n\",\n\t\t\t  type, index, obj_desc));\n\n\t \n\n\tif (!obj_desc) {\n\t\treturn_ACPI_STATUS(AE_BAD_PARAMETER);\n\t}\n\n\t \n\n\tstatus = acpi_ds_method_data_get_node(type, index, walk_state, &node);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\tcurrent_obj_desc = acpi_ns_get_attached_object(node);\n\tif (current_obj_desc == obj_desc) {\n\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC, \"Obj=%p already installed!\\n\",\n\t\t\t\t  obj_desc));\n\t\treturn_ACPI_STATUS(status);\n\t}\n\n\t \n\tnew_obj_desc = obj_desc;\n\tif (obj_desc->common.reference_count > 1) {\n\t\tstatus =\n\t\t    acpi_ut_copy_iobject_to_iobject(obj_desc, &new_obj_desc,\n\t\t\t\t\t\t    walk_state);\n\t\tif (ACPI_FAILURE(status)) {\n\t\t\treturn_ACPI_STATUS(status);\n\t\t}\n\t}\n\n\t \n\tif (current_obj_desc) {\n\t\t \n\t\tif (type == ACPI_REFCLASS_ARG) {\n\t\t\t \n\t\t\tif ((ACPI_GET_DESCRIPTOR_TYPE(current_obj_desc) ==\n\t\t\t     ACPI_DESC_TYPE_OPERAND) &&\n\t\t\t    (current_obj_desc->common.type ==\n\t\t\t     ACPI_TYPE_LOCAL_REFERENCE) &&\n\t\t\t    (current_obj_desc->reference.class ==\n\t\t\t     ACPI_REFCLASS_REFOF)) {\n\t\t\t\tACPI_DEBUG_PRINT((ACPI_DB_EXEC,\n\t\t\t\t\t\t  \"Arg (%p) is an ObjRef(Node), storing in node %p\\n\",\n\t\t\t\t\t\t  new_obj_desc,\n\t\t\t\t\t\t  current_obj_desc));\n\n\t\t\t\t \n\t\t\t\tstatus =\n\t\t\t\t    acpi_ex_store_object_to_node(new_obj_desc,\n\t\t\t\t\t\t\t\t current_obj_desc->\n\t\t\t\t\t\t\t\t reference.\n\t\t\t\t\t\t\t\t object,\n\t\t\t\t\t\t\t\t walk_state,\n\t\t\t\t\t\t\t\t ACPI_NO_IMPLICIT_CONVERSION);\n\n\t\t\t\t \n\n\t\t\t\tif (new_obj_desc != obj_desc) {\n\t\t\t\t\tacpi_ut_remove_reference(new_obj_desc);\n\t\t\t\t}\n\n\t\t\t\treturn_ACPI_STATUS(status);\n\t\t\t}\n\t\t}\n\n\t\t \n\n\t\tacpi_ds_method_data_delete_value(type, index, walk_state);\n\t}\n\n\t \n\tstatus =\n\t    acpi_ds_method_data_set_value(type, index, new_obj_desc,\n\t\t\t\t\t  walk_state);\n\n\t \n\n\tif (new_obj_desc != obj_desc) {\n\t\tacpi_ut_remove_reference(new_obj_desc);\n\t}\n\n\treturn_ACPI_STATUS(status);\n}\n\n#ifdef ACPI_OBSOLETE_FUNCTIONS\n \n\nacpi_object_type\nacpi_ds_method_data_get_type(u16 opcode,\n\t\t\t     u32 index, struct acpi_walk_state *walk_state)\n{\n\tacpi_status status;\n\tstruct acpi_namespace_node *node;\n\tunion acpi_operand_object *object;\n\n\tACPI_FUNCTION_TRACE(ds_method_data_get_type);\n\n\t \n\n\tstatus = acpi_ds_method_data_get_node(opcode, index, walk_state, &node);\n\tif (ACPI_FAILURE(status)) {\n\t\treturn_VALUE((ACPI_TYPE_NOT_FOUND));\n\t}\n\n\t \n\n\tobject = acpi_ns_get_attached_object(node);\n\tif (!object) {\n\n\t\t \n\n\t\treturn_VALUE(ACPI_TYPE_ANY);\n\t}\n\n\t \n\n\treturn_VALUE(object->type);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}