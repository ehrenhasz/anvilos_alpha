{
  "module_name": "mce.c",
  "hash_id": "60553afe9a3e06394b6a01b4d9fc590dd7b8d4e86ce686e43cdf526b7a0bce68",
  "original_prompt": "Ingested from linux-6.6.14/drivers/acpi/nfit/mce.c",
  "human_readable_source": "\n \n#include <linux/notifier.h>\n#include <linux/acpi.h>\n#include <linux/nd.h>\n#include <asm/mce.h>\n#include \"nfit.h\"\n\nstatic int nfit_handle_mce(struct notifier_block *nb, unsigned long val,\n\t\t\tvoid *data)\n{\n\tstruct mce *mce = (struct mce *)data;\n\tstruct acpi_nfit_desc *acpi_desc;\n\tstruct nfit_spa *nfit_spa;\n\n\t \n\tif (!mce_is_memory_error(mce) || mce_is_correctable(mce))\n\t\treturn NOTIFY_DONE;\n\n\t \n\tif (!mce_usable_address(mce))\n\t\treturn NOTIFY_DONE;\n\n\t \n\tmutex_lock(&acpi_desc_lock);\n\tlist_for_each_entry(acpi_desc, &acpi_descs, list) {\n\t\tunsigned int align = 1UL << MCI_MISC_ADDR_LSB(mce->misc);\n\t\tstruct device *dev = acpi_desc->dev;\n\t\tint found_match = 0;\n\n\t\tmutex_lock(&acpi_desc->init_mutex);\n\t\tlist_for_each_entry(nfit_spa, &acpi_desc->spas, list) {\n\t\t\tstruct acpi_nfit_system_address *spa = nfit_spa->spa;\n\n\t\t\tif (nfit_spa_type(spa) != NFIT_SPA_PM)\n\t\t\t\tcontinue;\n\t\t\t \n\t\t\tif (spa->address > mce->addr)\n\t\t\t\tcontinue;\n\t\t\tif ((spa->address + spa->length - 1) < mce->addr)\n\t\t\t\tcontinue;\n\t\t\tfound_match = 1;\n\t\t\tdev_dbg(dev, \"addr in SPA %d (0x%llx, 0x%llx)\\n\",\n\t\t\t\tspa->range_index, spa->address, spa->length);\n\t\t\t \n\t\t\tbreak;\n\t\t}\n\t\tmutex_unlock(&acpi_desc->init_mutex);\n\n\t\tif (!found_match)\n\t\t\tcontinue;\n\n\t\t \n\t\tnvdimm_bus_add_badrange(acpi_desc->nvdimm_bus,\n\t\t\t\tALIGN_DOWN(mce->addr, align), align);\n\t\tnvdimm_region_notify(nfit_spa->nd_region,\n\t\t\t\tNVDIMM_REVALIDATE_POISON);\n\n\t\tif (acpi_desc->scrub_mode == HW_ERROR_SCRUB_ON) {\n\t\t\t \n\t\t\tacpi_nfit_ars_rescan(acpi_desc, 0);\n\t\t}\n\t\tmce->kflags |= MCE_HANDLED_NFIT;\n\t\tbreak;\n\t}\n\n\tmutex_unlock(&acpi_desc_lock);\n\treturn NOTIFY_DONE;\n}\n\nstatic struct notifier_block nfit_mce_dec = {\n\t.notifier_call\t= nfit_handle_mce,\n\t.priority\t= MCE_PRIO_NFIT,\n};\n\nvoid nfit_mce_register(void)\n{\n\tmce_register_decode_chain(&nfit_mce_dec);\n}\n\nvoid nfit_mce_unregister(void)\n{\n\tmce_unregister_decode_chain(&nfit_mce_dec);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}