{
  "module_name": "proc.c",
  "hash_id": "ffb45595de7e3e9453782bb495f53dabe9a16a954c03ceb3878a1c4b81d7d781",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pnp/isapnp/proc.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/isapnp.h>\n#include <linux/proc_fs.h>\n#include <linux/init.h>\n#include <linux/uaccess.h>\n\nextern struct pnp_protocol isapnp_protocol;\n\nstatic struct proc_dir_entry *isapnp_proc_bus_dir = NULL;\n\nstatic loff_t isapnp_proc_bus_lseek(struct file *file, loff_t off, int whence)\n{\n\treturn fixed_size_llseek(file, off, whence, 256);\n}\n\nstatic ssize_t isapnp_proc_bus_read(struct file *file, char __user * buf,\n\t\t\t\t    size_t nbytes, loff_t * ppos)\n{\n\tstruct pnp_dev *dev = pde_data(file_inode(file));\n\tint pos = *ppos;\n\tint cnt, size = 256;\n\n\tif (pos >= size)\n\t\treturn 0;\n\tif (nbytes >= size)\n\t\tnbytes = size;\n\tif (pos + nbytes > size)\n\t\tnbytes = size - pos;\n\tcnt = nbytes;\n\n\tif (!access_ok(buf, cnt))\n\t\treturn -EINVAL;\n\n\tisapnp_cfg_begin(dev->card->number, dev->number);\n\tfor (; pos < 256 && cnt > 0; pos++, buf++, cnt--) {\n\t\tunsigned char val;\n\t\tval = isapnp_read_byte(pos);\n\t\t__put_user(val, buf);\n\t}\n\tisapnp_cfg_end();\n\n\t*ppos = pos;\n\treturn nbytes;\n}\n\nstatic const struct proc_ops isapnp_proc_bus_proc_ops = {\n\t.proc_lseek\t= isapnp_proc_bus_lseek,\n\t.proc_read\t= isapnp_proc_bus_read,\n};\n\nstatic int isapnp_proc_attach_device(struct pnp_dev *dev)\n{\n\tstruct pnp_card *bus = dev->card;\n\tchar name[16];\n\n\tif (!bus->procdir) {\n\t\tsprintf(name, \"%02x\", bus->number);\n\t\tbus->procdir = proc_mkdir(name, isapnp_proc_bus_dir);\n\t\tif (!bus->procdir)\n\t\t\treturn -ENOMEM;\n\t}\n\tsprintf(name, \"%02x\", dev->number);\n\tdev->procent = proc_create_data(name, S_IFREG | S_IRUGO, bus->procdir,\n\t\t\t\t\t    &isapnp_proc_bus_proc_ops, dev);\n\tif (!dev->procent)\n\t\treturn -ENOMEM;\n\tproc_set_size(dev->procent, 256);\n\treturn 0;\n}\n\nint __init isapnp_proc_init(void)\n{\n\tstruct pnp_dev *dev;\n\n\tisapnp_proc_bus_dir = proc_mkdir(\"bus/isapnp\", NULL);\n\tprotocol_for_each_dev(&isapnp_protocol, dev) {\n\t\tisapnp_proc_attach_device(dev);\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}