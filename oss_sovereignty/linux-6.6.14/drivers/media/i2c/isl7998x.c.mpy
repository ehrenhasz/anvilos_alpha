{
  "module_name": "isl7998x.c",
  "hash_id": "5eb4b631eb727bd98397befed96c184cdff5965ad229242e7990345dccbc12a3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/i2c/isl7998x.c",
  "human_readable_source": "\n \n\n#include <linux/bitfield.h>\n#include <linux/delay.h>\n#include <linux/gpio/consumer.h>\n#include <linux/i2c.h>\n#include <linux/module.h>\n#include <linux/of_graph.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/v4l2-mediabus.h>\n#include <linux/videodev2.h>\n\n#include <media/v4l2-async.h>\n#include <media/v4l2-common.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-fwnode.h>\n#include <media/v4l2-ioctl.h>\n\n \n#define V4L2_CID_TEST_PATTERN_CHANNELS\t(V4L2_CID_USER_ISL7998X_BASE + 0)\n\n \n#define V4L2_CID_TEST_PATTERN_COLOR\t(V4L2_CID_USER_ISL7998X_BASE + 1)\n\n \n#define V4L2_CID_TEST_PATTERN_BARS\t(V4L2_CID_USER_ISL7998X_BASE + 2)\n\n#define ISL7998X_INPUTS\t\t\t4\n\n#define ISL7998X_REG(page, reg)\t\t(((page) << 8) | (reg))\n\n#define ISL7998X_REG_PN_SIZE\t\t\t256\n#define ISL7998X_REG_PN_BASE(n)\t\t\t((n) * ISL7998X_REG_PN_SIZE)\n\n#define ISL7998X_REG_PX_DEC_PAGE(page)\t\tISL7998X_REG((page), 0xff)\n#define ISL7998X_REG_PX_DEC_PAGE_MASK\t\t0xf\n#define ISL7998X_REG_P0_PRODUCT_ID_CODE\t\tISL7998X_REG(0, 0x00)\n#define ISL7998X_REG_P0_PRODUCT_REV_CODE\tISL7998X_REG(0, 0x01)\n#define ISL7998X_REG_P0_SW_RESET_CTL\t\tISL7998X_REG(0, 0x02)\n#define ISL7998X_REG_P0_IO_BUFFER_CTL\t\tISL7998X_REG(0, 0x03)\n#define ISL7998X_REG_P0_IO_BUFFER_CTL_1_1\tISL7998X_REG(0, 0x04)\n#define ISL7998X_REG_P0_IO_PAD_PULL_EN_CTL\tISL7998X_REG(0, 0x05)\n#define ISL7998X_REG_P0_IO_BUFFER_CTL_1_2\tISL7998X_REG(0, 0x06)\n#define ISL7998X_REG_P0_VIDEO_IN_CHAN_CTL\tISL7998X_REG(0, 0x07)\n#define ISL7998X_REG_P0_CLK_CTL_1\t\tISL7998X_REG(0, 0x08)\n#define ISL7998X_REG_P0_CLK_CTL_2\t\tISL7998X_REG(0, 0x09)\n#define ISL7998X_REG_P0_CLK_CTL_3\t\tISL7998X_REG(0, 0x0a)\n#define ISL7998X_REG_P0_CLK_CTL_4\t\tISL7998X_REG(0, 0x0b)\n#define ISL7998X_REG_P0_MPP1_SYNC_CTL\t\tISL7998X_REG(0, 0x0c)\n#define ISL7998X_REG_P0_MPP2_SYNC_CTL\t\tISL7998X_REG(0, 0x0d)\n#define ISL7998X_REG_P0_IRQ_SYNC_CTL\t\tISL7998X_REG(0, 0x0e)\n#define ISL7998X_REG_P0_INTERRUPT_STATUS\tISL7998X_REG(0, 0x10)\n#define ISL7998X_REG_P0_CHAN_1_IRQ\t\tISL7998X_REG(0, 0x11)\n#define ISL7998X_REG_P0_CHAN_2_IRQ\t\tISL7998X_REG(0, 0x12)\n#define ISL7998X_REG_P0_CHAN_3_IRQ\t\tISL7998X_REG(0, 0x13)\n#define ISL7998X_REG_P0_CHAN_4_IRQ\t\tISL7998X_REG(0, 0x14)\n#define ISL7998X_REG_P0_SHORT_DIAG_IRQ\t\tISL7998X_REG(0, 0x15)\n#define ISL7998X_REG_P0_CHAN_1_IRQ_EN\t\tISL7998X_REG(0, 0x16)\n#define ISL7998X_REG_P0_CHAN_2_IRQ_EN\t\tISL7998X_REG(0, 0x17)\n#define ISL7998X_REG_P0_CHAN_3_IRQ_EN\t\tISL7998X_REG(0, 0x18)\n#define ISL7998X_REG_P0_CHAN_4_IRQ_EN\t\tISL7998X_REG(0, 0x19)\n#define ISL7998X_REG_P0_SHORT_DIAG_IRQ_EN\tISL7998X_REG(0, 0x1a)\n#define ISL7998X_REG_P0_CHAN_1_STATUS\t\tISL7998X_REG(0, 0x1b)\n#define ISL7998X_REG_P0_CHAN_2_STATUS\t\tISL7998X_REG(0, 0x1c)\n#define ISL7998X_REG_P0_CHAN_3_STATUS\t\tISL7998X_REG(0, 0x1d)\n#define ISL7998X_REG_P0_CHAN_4_STATUS\t\tISL7998X_REG(0, 0x1e)\n#define ISL7998X_REG_P0_SHORT_DIAG_STATUS\tISL7998X_REG(0, 0x1f)\n#define ISL7998X_REG_P0_CLOCK_DELAY\t\tISL7998X_REG(0, 0x20)\n\n#define ISL7998X_REG_PX_DEC_INPUT_FMT(pg)\tISL7998X_REG((pg), 0x02)\n#define ISL7998X_REG_PX_DEC_STATUS_1(pg)\tISL7998X_REG((pg), 0x03)\n#define ISL7998X_REG_PX_DEC_STATUS_1_VDLOSS\tBIT(7)\n#define ISL7998X_REG_PX_DEC_STATUS_1_HLOCK\tBIT(6)\n#define ISL7998X_REG_PX_DEC_STATUS_1_VLOCK\tBIT(3)\n#define ISL7998X_REG_PX_DEC_HS_DELAY_CTL(pg)\tISL7998X_REG((pg), 0x04)\n#define ISL7998X_REG_PX_DEC_ANCTL(pg)\t\tISL7998X_REG((pg), 0x06)\n#define ISL7998X_REG_PX_DEC_CROP_HI(pg)\t\tISL7998X_REG((pg), 0x07)\n#define ISL7998X_REG_PX_DEC_VDELAY_LO(pg)\tISL7998X_REG((pg), 0x08)\n#define ISL7998X_REG_PX_DEC_VACTIVE_LO(pg)\tISL7998X_REG((pg), 0x09)\n#define ISL7998X_REG_PX_DEC_HDELAY_LO(pg)\tISL7998X_REG((pg), 0x0a)\n#define ISL7998X_REG_PX_DEC_HACTIVE_LO(pg)\tISL7998X_REG((pg), 0x0b)\n#define ISL7998X_REG_PX_DEC_CNTRL1(pg)\t\tISL7998X_REG((pg), 0x0c)\n#define ISL7998X_REG_PX_DEC_CSC_CTL(pg)\t\tISL7998X_REG((pg), 0x0d)\n#define ISL7998X_REG_PX_DEC_BRIGHT(pg)\t\tISL7998X_REG((pg), 0x10)\n#define ISL7998X_REG_PX_DEC_CONTRAST(pg)\tISL7998X_REG((pg), 0x11)\n#define ISL7998X_REG_PX_DEC_SHARPNESS(pg)\tISL7998X_REG((pg), 0x12)\n#define ISL7998X_REG_PX_DEC_SAT_U(pg)\t\tISL7998X_REG((pg), 0x13)\n#define ISL7998X_REG_PX_DEC_SAT_V(pg)\t\tISL7998X_REG((pg), 0x14)\n#define ISL7998X_REG_PX_DEC_HUE(pg)\t\tISL7998X_REG((pg), 0x15)\n#define ISL7998X_REG_PX_DEC_VERT_PEAK(pg)\tISL7998X_REG((pg), 0x17)\n#define ISL7998X_REG_PX_DEC_CORING(pg)\t\tISL7998X_REG((pg), 0x18)\n#define ISL7998X_REG_PX_DEC_SDT(pg)\t\tISL7998X_REG((pg), 0x1c)\n#define ISL7998X_REG_PX_DEC_SDT_DET\t\tBIT(7)\n#define ISL7998X_REG_PX_DEC_SDT_NOW\t\tGENMASK(6, 4)\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD\tGENMASK(2, 0)\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_NTSC_M\t\t0\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL\t\t1\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_SECAM\t\t2\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_NTSC_443\t3\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL_M\t\t4\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL_CN\t\t5\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL_60\t\t6\n#define ISL7998X_REG_PX_DEC_SDT_STANDARD_UNKNOWN\t7\n#define ISL7998X_REG_PX_DEC_SDTR(pg)\t\tISL7998X_REG((pg), 0x1d)\n#define ISL7998X_REG_PX_DEC_SDTR_ATSTART\tBIT(7)\n#define ISL7998X_REG_PX_DEC_CLMPG(pg)\t\tISL7998X_REG((pg), 0x20)\n#define ISL7998X_REG_PX_DEC_IAGC(pg)\t\tISL7998X_REG((pg), 0x21)\n#define ISL7998X_REG_PX_DEC_AGCGAIN(pg)\t\tISL7998X_REG((pg), 0x22)\n#define ISL7998X_REG_PX_DEC_PEAKWT(pg)\t\tISL7998X_REG((pg), 0x23)\n#define ISL7998X_REG_PX_DEC_CLMPL(pg)\t\tISL7998X_REG((pg), 0x24)\n#define ISL7998X_REG_PX_DEC_SYNCT(pg)\t\tISL7998X_REG((pg), 0x25)\n#define ISL7998X_REG_PX_DEC_MISSCNT(pg)\t\tISL7998X_REG((pg), 0x26)\n#define ISL7998X_REG_PX_DEC_PCLAMP(pg)\t\tISL7998X_REG((pg), 0x27)\n#define ISL7998X_REG_PX_DEC_VERT_CTL_1(pg)\tISL7998X_REG((pg), 0x28)\n#define ISL7998X_REG_PX_DEC_VERT_CTL_2(pg)\tISL7998X_REG((pg), 0x29)\n#define ISL7998X_REG_PX_DEC_CLR_KILL_LVL(pg)\tISL7998X_REG((pg), 0x2a)\n#define ISL7998X_REG_PX_DEC_COMB_FILTER_CTL(pg)\tISL7998X_REG((pg), 0x2b)\n#define ISL7998X_REG_PX_DEC_LUMA_DELAY(pg)\tISL7998X_REG((pg), 0x2c)\n#define ISL7998X_REG_PX_DEC_MISC1(pg)\t\tISL7998X_REG((pg), 0x2d)\n#define ISL7998X_REG_PX_DEC_MISC2(pg)\t\tISL7998X_REG((pg), 0x2e)\n#define ISL7998X_REG_PX_DEC_MISC3(pg)\t\tISL7998X_REG((pg), 0x2f)\n#define ISL7998X_REG_PX_DEC_MVSN(pg)\t\tISL7998X_REG((pg), 0x30)\n#define ISL7998X_REG_PX_DEC_CSTATUS2(pg)\tISL7998X_REG((pg), 0x31)\n#define ISL7998X_REG_PX_DEC_HFREF(pg)\t\tISL7998X_REG((pg), 0x32)\n#define ISL7998X_REG_PX_DEC_CLMD(pg)\t\tISL7998X_REG((pg), 0x33)\n#define ISL7998X_REG_PX_DEC_ID_DET_CTL(pg)\tISL7998X_REG((pg), 0x34)\n#define ISL7998X_REG_PX_DEC_CLCNTL(pg)\t\tISL7998X_REG((pg), 0x35)\n#define ISL7998X_REG_PX_DEC_DIFF_CLMP_CTL_1(pg)\tISL7998X_REG((pg), 0x36)\n#define ISL7998X_REG_PX_DEC_DIFF_CLMP_CTL_2(pg)\tISL7998X_REG((pg), 0x37)\n#define ISL7998X_REG_PX_DEC_DIFF_CLMP_CTL_3(pg)\tISL7998X_REG((pg), 0x38)\n#define ISL7998X_REG_PX_DEC_DIFF_CLMP_CTL_4(pg)\tISL7998X_REG((pg), 0x39)\n#define ISL7998X_REG_PX_DEC_SHORT_DET_CTL(pg)\tISL7998X_REG((pg), 0x3a)\n#define ISL7998X_REG_PX_DEC_SHORT_DET_CTL_1(pg)\tISL7998X_REG((pg), 0x3b)\n#define ISL7998X_REG_PX_DEC_AFE_TST_MUX_CTL(pg)\tISL7998X_REG((pg), 0x3c)\n#define ISL7998X_REG_PX_DEC_DATA_CONV(pg)\tISL7998X_REG((pg), 0x3d)\n#define ISL7998X_REG_PX_DEC_INTERNAL_TEST(pg)\tISL7998X_REG((pg), 0x3f)\n#define ISL7998X_REG_PX_DEC_H_DELAY_CTL(pg)\tISL7998X_REG((pg), 0x43)\n#define ISL7998X_REG_PX_DEC_H_DELAY_II_HI(pg)\tISL7998X_REG((pg), 0x44)\n#define ISL7998X_REG_PX_DEC_H_DELAY_II_LOW(pg)\tISL7998X_REG((pg), 0x45)\n\n#define ISL7998X_REG_PX_ACA_CTL_1(pg)\t\tISL7998X_REG((pg), 0x80)\n#define ISL7998X_REG_PX_ACA_GAIN_CTL(pg)\tISL7998X_REG((pg), 0x81)\n#define ISL7998X_REG_PX_ACA_Y_AVG_HI_LIMIT(pg)\tISL7998X_REG((pg), 0x82)\n#define ISL7998X_REG_PX_ACA_Y_AVG_LO_LIMIT(pg)\tISL7998X_REG((pg), 0x83)\n#define ISL7998X_REG_PX_ACA_Y_DET_THRESHOLD(pg)\tISL7998X_REG((pg), 0x84)\n#define ISL7998X_REG_PX_ACA_BLACK_LVL(pg)\tISL7998X_REG((pg), 0x85)\n#define ISL7998X_REG_PX_ACA_CENTER_LVL(pg)\tISL7998X_REG((pg), 0x86)\n#define ISL7998X_REG_PX_ACA_WHITE_LVL(pg)\tISL7998X_REG((pg), 0x87)\n#define ISL7998X_REG_PX_ACA_MEAN_OFF_LIMIT(pg)\tISL7998X_REG((pg), 0x88)\n#define ISL7998X_REG_PX_ACA_MEAN_OFF_UPGAIN(pg)\tISL7998X_REG((pg), 0x89)\n#define ISL7998X_REG_PX_ACA_MEAN_OFF_SLOPE(pg)\tISL7998X_REG((pg), 0x8a)\n#define ISL7998X_REG_PX_ACA_MEAN_OFF_DNGAIN(pg)\tISL7998X_REG((pg), 0x8b)\n#define ISL7998X_REG_PX_ACA_DELTA_CO_THRES(pg)\tISL7998X_REG((pg), 0x8c)\n#define ISL7998X_REG_PX_ACA_DELTA_SLOPE(pg)\tISL7998X_REG((pg), 0x8d)\n#define ISL7998X_REG_PX_ACA_LO_HI_AVG_THRES(pg)\tISL7998X_REG((pg), 0x8e)\n#define ISL7998X_REG_PX_ACA_LO_MAX_LVL_CTL(pg)\tISL7998X_REG((pg), 0x8f)\n#define ISL7998X_REG_PX_ACA_HI_MAX_LVL_CTL(pg)\tISL7998X_REG((pg), 0x90)\n#define ISL7998X_REG_PX_ACA_LO_UPGAIN_CTL(pg)\tISL7998X_REG((pg), 0x91)\n#define ISL7998X_REG_PX_ACA_LO_DNGAIN_CTL(pg)\tISL7998X_REG((pg), 0x92)\n#define ISL7998X_REG_PX_ACA_HI_UPGAIN_CTL(pg)\tISL7998X_REG((pg), 0x93)\n#define ISL7998X_REG_PX_ACA_HI_DNGAIN_CTL(pg)\tISL7998X_REG((pg), 0x94)\n#define ISL7998X_REG_PX_ACA_LOPASS_FLT_COEF(pg)\tISL7998X_REG((pg), 0x95)\n#define ISL7998X_REG_PX_ACA_PDF_INDEX(pg)\tISL7998X_REG((pg), 0x96)\n#define ISL7998X_REG_PX_ACA_HIST_WIN_H_STT(pg)\tISL7998X_REG((pg), 0x97)\n#define ISL7998X_REG_PX_ACA_HIST_WIN_H_SZ1(pg)\tISL7998X_REG((pg), 0x98)\n#define ISL7998X_REG_PX_ACA_HIST_WIN_H_SZ2(pg)\tISL7998X_REG((pg), 0x99)\n#define ISL7998X_REG_PX_ACA_HIST_WIN_V_STT(pg)\tISL7998X_REG((pg), 0x9a)\n#define ISL7998X_REG_PX_ACA_HIST_WIN_V_SZ1(pg)\tISL7998X_REG((pg), 0x9b)\n#define ISL7998X_REG_PX_ACA_HIST_WIN_V_SZ2(pg)\tISL7998X_REG((pg), 0x9c)\n#define ISL7998X_REG_PX_ACA_Y_AVG(pg)\t\tISL7998X_REG((pg), 0xa0)\n#define ISL7998X_REG_PX_ACA_Y_AVG_LIM(pg)\tISL7998X_REG((pg), 0xa1)\n#define ISL7998X_REG_PX_ACA_LO_AVG(pg)\t\tISL7998X_REG((pg), 0xa2)\n#define ISL7998X_REG_PX_ACA_HI_AVG(pg)\t\tISL7998X_REG((pg), 0xa3)\n#define ISL7998X_REG_PX_ACA_Y_MAX(pg)\t\tISL7998X_REG((pg), 0xa4)\n#define ISL7998X_REG_PX_ACA_Y_MIN(pg)\t\tISL7998X_REG((pg), 0xa5)\n#define ISL7998X_REG_PX_ACA_MOFFSET(pg)\t\tISL7998X_REG((pg), 0xa6)\n#define ISL7998X_REG_PX_ACA_LO_GAIN(pg)\t\tISL7998X_REG((pg), 0xa7)\n#define ISL7998X_REG_PX_ACA_HI_GAIN(pg)\t\tISL7998X_REG((pg), 0xa8)\n#define ISL7998X_REG_PX_ACA_LL_SLOPE(pg)\tISL7998X_REG((pg), 0xa9)\n#define ISL7998X_REG_PX_ACA_LH_SLOPE(pg)\tISL7998X_REG((pg), 0xaa)\n#define ISL7998X_REG_PX_ACA_HL_SLOPE(pg)\tISL7998X_REG((pg), 0xab)\n#define ISL7998X_REG_PX_ACA_HH_SLOPE(pg)\tISL7998X_REG((pg), 0xac)\n#define ISL7998X_REG_PX_ACA_X_LOW(pg)\t\tISL7998X_REG((pg), 0xad)\n#define ISL7998X_REG_PX_ACA_X_MEAN(pg)\t\tISL7998X_REG((pg), 0xae)\n#define ISL7998X_REG_PX_ACA_X_HIGH(pg)\t\tISL7998X_REG((pg), 0xaf)\n#define ISL7998X_REG_PX_ACA_Y_LOW(pg)\t\tISL7998X_REG((pg), 0xb0)\n#define ISL7998X_REG_PX_ACA_Y_MEAN(pg)\t\tISL7998X_REG((pg), 0xb1)\n#define ISL7998X_REG_PX_ACA_Y_HIGH(pg)\t\tISL7998X_REG((pg), 0xb2)\n#define ISL7998X_REG_PX_ACA_CTL_2(pg)\t\tISL7998X_REG((pg), 0xb3)\n#define ISL7998X_REG_PX_ACA_CTL_3(pg)\t\tISL7998X_REG((pg), 0xb4)\n#define ISL7998X_REG_PX_ACA_CTL_4(pg)\t\tISL7998X_REG((pg), 0xb5)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_HIST(pg)\tISL7998X_REG((pg), 0xc0)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_TL_H(pg)\tISL7998X_REG((pg), 0xc1)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_TL_L(pg)\tISL7998X_REG((pg), 0xc2)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_TL_H(pg)\tISL7998X_REG((pg), 0xc3)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_TL_L(pg)\tISL7998X_REG((pg), 0xc4)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_TR_H(pg)\tISL7998X_REG((pg), 0xc5)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_TR_L(pg)\tISL7998X_REG((pg), 0xc6)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_TR_H(pg)\tISL7998X_REG((pg), 0xc7)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_TR_L(pg)\tISL7998X_REG((pg), 0xc8)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_BL_H(pg)\tISL7998X_REG((pg), 0xc9)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_BL_L(pg)\tISL7998X_REG((pg), 0xca)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_BL_H(pg)\tISL7998X_REG((pg), 0xcb)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_BL_L(pg)\tISL7998X_REG((pg), 0xcc)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_BR_H(pg)\tISL7998X_REG((pg), 0xcd)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_BR_L(pg)\tISL7998X_REG((pg), 0xce)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_BR_H(pg)\tISL7998X_REG((pg), 0xcf)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_BR_L(pg)\tISL7998X_REG((pg), 0xd0)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_LM_H(pg)\tISL7998X_REG((pg), 0xd1)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_LM_L(pg)\tISL7998X_REG((pg), 0xd2)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_LM_H(pg)\tISL7998X_REG((pg), 0xd3)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_LM_L(pg)\tISL7998X_REG((pg), 0xd4)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_TM_H(pg)\tISL7998X_REG((pg), 0xd5)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_TM_L(pg)\tISL7998X_REG((pg), 0xd6)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_TM_H(pg)\tISL7998X_REG((pg), 0xd7)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_TM_L(pg)\tISL7998X_REG((pg), 0xd8)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_BM_H(pg)\tISL7998X_REG((pg), 0xd9)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_BM_L(pg)\tISL7998X_REG((pg), 0xda)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_BM_H(pg)\tISL7998X_REG((pg), 0xdb)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_BM_L(pg)\tISL7998X_REG((pg), 0xdc)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_RM_H(pg)\tISL7998X_REG((pg), 0xdd)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_X_RM_L(pg)\tISL7998X_REG((pg), 0xde)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_RM_H(pg)\tISL7998X_REG((pg), 0xdf)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_RM_L(pg)\tISL7998X_REG((pg), 0xe0)\n#define ISL7998X_REG_PX_ACA_HIST_DATA_LO(pg)\tISL7998X_REG((pg), 0xe1)\n#define ISL7998X_REG_PX_ACA_HIST_DATA_MID(pg)\tISL7998X_REG((pg), 0xe2)\n#define ISL7998X_REG_PX_ACA_HIST_DATA_HI(pg)\tISL7998X_REG((pg), 0xe3)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_Y_CLR(pg)\tISL7998X_REG((pg), 0xe4)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_CB_CLR(pg)\tISL7998X_REG((pg), 0xe5)\n#define ISL7998X_REG_PX_ACA_FLEX_WIN_CR_CLR(pg)\tISL7998X_REG((pg), 0xe6)\n#define ISL7998X_REG_PX_ACA_XFER_HIST_HOST(pg)\tISL7998X_REG((pg), 0xe7)\n\n#define ISL7998X_REG_P5_LI_ENGINE_CTL\t\tISL7998X_REG(5, 0x00)\n#define ISL7998X_REG_P5_LI_ENGINE_LINE_CTL\tISL7998X_REG(5, 0x01)\n#define ISL7998X_REG_P5_LI_ENGINE_PIC_WIDTH\tISL7998X_REG(5, 0x02)\n#define ISL7998X_REG_P5_LI_ENGINE_SYNC_CTL\tISL7998X_REG(5, 0x03)\n#define ISL7998X_REG_P5_LI_ENGINE_VC_ASSIGNMENT\tISL7998X_REG(5, 0x04)\n#define ISL7998X_REG_P5_LI_ENGINE_TYPE_CTL\tISL7998X_REG(5, 0x05)\n#define ISL7998X_REG_P5_LI_ENGINE_FIFO_CTL\tISL7998X_REG(5, 0x06)\n#define ISL7998X_REG_P5_MIPI_READ_START_CTL\tISL7998X_REG(5, 0x07)\n#define ISL7998X_REG_P5_PSEUDO_FRM_FIELD_CTL\tISL7998X_REG(5, 0x08)\n#define ISL7998X_REG_P5_ONE_FIELD_MODE_CTL\tISL7998X_REG(5, 0x09)\n#define ISL7998X_REG_P5_MIPI_INT_HW_TST_CTR\tISL7998X_REG(5, 0x0a)\n#define ISL7998X_REG_P5_TP_GEN_BAR_PATTERN\tISL7998X_REG(5, 0x0b)\n#define ISL7998X_REG_P5_MIPI_PCNT_PSFRM\t\tISL7998X_REG(5, 0x0c)\n#define ISL7998X_REG_P5_LI_ENGINE_TP_GEN_CTL\tISL7998X_REG(5, 0x0d)\n#define ISL7998X_REG_P5_MIPI_VBLANK_PSFRM\tISL7998X_REG(5, 0x0e)\n#define ISL7998X_REG_P5_LI_ENGINE_CTL_2\t\tISL7998X_REG(5, 0x0f)\n#define ISL7998X_REG_P5_MIPI_WCNT_1\t\tISL7998X_REG(5, 0x10)\n#define ISL7998X_REG_P5_MIPI_WCNT_2\t\tISL7998X_REG(5, 0x11)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_1\tISL7998X_REG(5, 0x12)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_2\tISL7998X_REG(5, 0x13)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_3\tISL7998X_REG(5, 0x14)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_4\tISL7998X_REG(5, 0x15)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_5\tISL7998X_REG(5, 0x16)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_6\tISL7998X_REG(5, 0x17)\n#define ISL7998X_REG_P5_MIPI_DPHY_PARAMS_1\tISL7998X_REG(5, 0x18)\n#define ISL7998X_REG_P5_MIPI_DPHY_SOT_PERIOD\tISL7998X_REG(5, 0x19)\n#define ISL7998X_REG_P5_MIPI_DPHY_EOT_PERIOD\tISL7998X_REG(5, 0x1a)\n#define ISL7998X_REG_P5_MIPI_DPHY_PARAMS_2\tISL7998X_REG(5, 0x1b)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_7\tISL7998X_REG(5, 0x1c)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_8\tISL7998X_REG(5, 0x1d)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_9\tISL7998X_REG(5, 0x1e)\n#define ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_10\tISL7998X_REG(5, 0x1f)\n#define ISL7998X_REG_P5_TP_GEN_MIPI\t\tISL7998X_REG(5, 0x20)\n#define ISL7998X_REG_P5_ESC_MODE_TIME_CTL\tISL7998X_REG(5, 0x21)\n#define ISL7998X_REG_P5_AUTO_TEST_ERR_DET\tISL7998X_REG(5, 0x22)\n#define ISL7998X_REG_P5_MIPI_TIMING\t\tISL7998X_REG(5, 0x23)\n#define ISL7998X_REG_P5_PIC_HEIGHT_HIGH\t\tISL7998X_REG(5, 0x24)\n#define ISL7998X_REG_P5_PIC_HEIGHT_LOW\t\tISL7998X_REG(5, 0x25)\n#define ISL7998X_REG_P5_MIPI_SP_HS_TRL_CTL\tISL7998X_REG(5, 0x26)\n#define ISL7998X_REG_P5_FIFO_THRSH_CNT_1\tISL7998X_REG(5, 0x28)\n#define ISL7998X_REG_P5_FIFO_THRSH_CNT_2\tISL7998X_REG(5, 0x29)\n#define ISL7998X_REG_P5_TP_GEN_RND_SYNC_CTL_1\tISL7998X_REG(5, 0x2a)\n#define ISL7998X_REG_P5_TP_GEN_RND_SYNC_CTL_2\tISL7998X_REG(5, 0x2b)\n#define ISL7998X_REG_P5_PSF_FIELD_END_CTL_1\tISL7998X_REG(5, 0x2c)\n#define ISL7998X_REG_P5_PSF_FIELD_END_CTL_2\tISL7998X_REG(5, 0x2d)\n#define ISL7998X_REG_P5_PSF_FIELD_END_CTL_3\tISL7998X_REG(5, 0x2e)\n#define ISL7998X_REG_P5_PSF_FIELD_END_CTL_4\tISL7998X_REG(5, 0x2f)\n#define ISL7998X_REG_P5_MIPI_ANA_DATA_CTL_1\tISL7998X_REG(5, 0x30)\n#define ISL7998X_REG_P5_MIPI_ANA_DATA_CTL_2\tISL7998X_REG(5, 0x31)\n#define ISL7998X_REG_P5_MIPI_ANA_CLK_CTL\tISL7998X_REG(5, 0x32)\n#define ISL7998X_REG_P5_PLL_ANA_STATUS\t\tISL7998X_REG(5, 0x33)\n#define ISL7998X_REG_P5_PLL_ANA_MISC_CTL\tISL7998X_REG(5, 0x34)\n#define ISL7998X_REG_P5_MIPI_ANA\t\tISL7998X_REG(5, 0x35)\n#define ISL7998X_REG_P5_PLL_ANA\t\t\tISL7998X_REG(5, 0x36)\n#define ISL7998X_REG_P5_TOTAL_PF_LINE_CNT_1\tISL7998X_REG(5, 0x38)\n#define ISL7998X_REG_P5_TOTAL_PF_LINE_CNT_2\tISL7998X_REG(5, 0x39)\n#define ISL7998X_REG_P5_H_LINE_CNT_1\t\tISL7998X_REG(5, 0x3a)\n#define ISL7998X_REG_P5_H_LINE_CNT_2\t\tISL7998X_REG(5, 0x3b)\n#define ISL7998X_REG_P5_HIST_LINE_CNT_1\t\tISL7998X_REG(5, 0x3c)\n#define ISL7998X_REG_P5_HIST_LINE_CNT_2\t\tISL7998X_REG(5, 0x3d)\n\nstatic const struct reg_sequence isl7998x_init_seq_1[] = {\n\t{ ISL7998X_REG_P0_SHORT_DIAG_IRQ_EN, 0xff },\n\t{ ISL7998X_REG_PX_DEC_SDT(0x1), 0x00 },\n\t{ ISL7998X_REG_PX_DEC_SHORT_DET_CTL_1(0x1), 0x03 },\n\t{ ISL7998X_REG_PX_DEC_SDT(0x2), 0x00 },\n\t{ ISL7998X_REG_PX_DEC_SHORT_DET_CTL_1(0x2), 0x03 },\n\t{ ISL7998X_REG_PX_DEC_SDT(0x3), 0x00 },\n\t{ ISL7998X_REG_PX_DEC_SHORT_DET_CTL_1(0x3), 0x03 },\n\t{ ISL7998X_REG_PX_DEC_SDT(0x4), 0x00 },\n\t{ ISL7998X_REG_PX_DEC_SHORT_DET_CTL_1(0x4), 0x03 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_CTL, 0x00 },\n\t{ ISL7998X_REG_P0_SW_RESET_CTL, 0x1f, 10 },\n\t{ ISL7998X_REG_P0_IO_BUFFER_CTL, 0x00 },\n\t{ ISL7998X_REG_P0_MPP2_SYNC_CTL, 0xc9 },\n\t{ ISL7998X_REG_P0_IRQ_SYNC_CTL, 0xc9 },\n\t{ ISL7998X_REG_P0_CHAN_1_IRQ, 0x03 },\n\t{ ISL7998X_REG_P0_CHAN_2_IRQ, 0x00 },\n\t{ ISL7998X_REG_P0_CHAN_3_IRQ, 0x00 },\n\t{ ISL7998X_REG_P0_CHAN_4_IRQ, 0x00 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_CTL, 0x02 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_LINE_CTL, 0x85 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_PIC_WIDTH, 0xa0 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_SYNC_CTL, 0x18 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_TYPE_CTL, 0x40 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_FIFO_CTL, 0x40 },\n\t{ ISL7998X_REG_P5_MIPI_WCNT_1, 0x05 },\n\t{ ISL7998X_REG_P5_MIPI_WCNT_2, 0xa0 },\n\t{ ISL7998X_REG_P5_TP_GEN_MIPI, 0x00 },\n\t{ ISL7998X_REG_P5_ESC_MODE_TIME_CTL, 0x0c },\n\t{ ISL7998X_REG_P5_MIPI_SP_HS_TRL_CTL, 0x00 },\n\t{ ISL7998X_REG_P5_TP_GEN_RND_SYNC_CTL_1, 0x00 },\n\t{ ISL7998X_REG_P5_TP_GEN_RND_SYNC_CTL_2, 0x19 },\n\t{ ISL7998X_REG_P5_PSF_FIELD_END_CTL_1, 0x18 },\n\t{ ISL7998X_REG_P5_PSF_FIELD_END_CTL_2, 0xf1 },\n\t{ ISL7998X_REG_P5_PSF_FIELD_END_CTL_3, 0x00 },\n\t{ ISL7998X_REG_P5_PSF_FIELD_END_CTL_4, 0xf1 },\n\t{ ISL7998X_REG_P5_MIPI_ANA_DATA_CTL_1, 0x00 },\n\t{ ISL7998X_REG_P5_MIPI_ANA_DATA_CTL_2, 0x00 },\n\t{ ISL7998X_REG_P5_MIPI_ANA_CLK_CTL, 0x00 },\n\t{ ISL7998X_REG_P5_PLL_ANA_STATUS, 0xc0 },\n\t{ ISL7998X_REG_P5_PLL_ANA_MISC_CTL, 0x18 },\n\t{ ISL7998X_REG_P5_PLL_ANA, 0x00 },\n\t{ ISL7998X_REG_P0_SW_RESET_CTL, 0x10, 10 },\n\t \n\t{ ISL7998X_REG_PX_DEC_VDELAY_LO(0xf), 0x14 },\n\t{ ISL7998X_REG_PX_DEC_MISC3(0xf), 0xe6 },\n\t{ ISL7998X_REG_PX_DEC_CLMD(0xf), 0x85 },\n\t{ ISL7998X_REG_PX_DEC_H_DELAY_II_LOW(0xf), 0x11 },\n\t{ ISL7998X_REG_PX_ACA_XFER_HIST_HOST(0xf), 0x00 },\n\t{ ISL7998X_REG_P0_CLK_CTL_1, 0x1f },\n\t{ ISL7998X_REG_P0_CLK_CTL_2, 0x43 },\n\t{ ISL7998X_REG_P0_CLK_CTL_3, 0x4f },\n};\n\nstatic const struct reg_sequence isl7998x_init_seq_2[] = {\n\t{ ISL7998X_REG_P5_LI_ENGINE_SYNC_CTL, 0x10 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_VC_ASSIGNMENT, 0xe4 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_TYPE_CTL, 0x00 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_FIFO_CTL, 0x60 },\n\t{ ISL7998X_REG_P5_MIPI_READ_START_CTL, 0x2b },\n\t{ ISL7998X_REG_P5_PSEUDO_FRM_FIELD_CTL, 0x02 },\n\t{ ISL7998X_REG_P5_ONE_FIELD_MODE_CTL, 0x00 },\n\t{ ISL7998X_REG_P5_MIPI_INT_HW_TST_CTR, 0x62 },\n\t{ ISL7998X_REG_P5_TP_GEN_BAR_PATTERN, 0x02 },\n\t{ ISL7998X_REG_P5_MIPI_PCNT_PSFRM, 0x36 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_TP_GEN_CTL, 0x00 },\n\t{ ISL7998X_REG_P5_MIPI_VBLANK_PSFRM, 0x6c },\n\t{ ISL7998X_REG_P5_LI_ENGINE_CTL_2, 0x00 },\n\t{ ISL7998X_REG_P5_MIPI_WCNT_1, 0x05 },\n\t{ ISL7998X_REG_P5_MIPI_WCNT_2, 0xa0 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_1, 0x77 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_2, 0x17 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_3, 0x08 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_4, 0x38 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_5, 0x14 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_6, 0xf6 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_PARAMS_1, 0x00 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_SOT_PERIOD, 0x17 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_EOT_PERIOD, 0x0a },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_PARAMS_2, 0x71 },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_7, 0x7a },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_8, 0x0f },\n\t{ ISL7998X_REG_P5_MIPI_DPHY_TIMING_CTL_9, 0x8c },\n\t{ ISL7998X_REG_P5_MIPI_SP_HS_TRL_CTL, 0x08 },\n\t{ ISL7998X_REG_P5_FIFO_THRSH_CNT_1, 0x01 },\n\t{ ISL7998X_REG_P5_FIFO_THRSH_CNT_2, 0x0e },\n\t{ ISL7998X_REG_P5_TP_GEN_RND_SYNC_CTL_1, 0x00 },\n\t{ ISL7998X_REG_P5_TP_GEN_RND_SYNC_CTL_2, 0x00 },\n\t{ ISL7998X_REG_P5_TOTAL_PF_LINE_CNT_1, 0x03 },\n\t{ ISL7998X_REG_P5_TOTAL_PF_LINE_CNT_2, 0xc0 },\n\t{ ISL7998X_REG_P5_H_LINE_CNT_1, 0x06 },\n\t{ ISL7998X_REG_P5_H_LINE_CNT_2, 0xb3 },\n\t{ ISL7998X_REG_P5_HIST_LINE_CNT_1, 0x00 },\n\t{ ISL7998X_REG_P5_HIST_LINE_CNT_2, 0xf1 },\n\t{ ISL7998X_REG_P5_LI_ENGINE_FIFO_CTL, 0x00 },\n\t{ ISL7998X_REG_P5_MIPI_ANA, 0x00 },\n\t \n\t{ ISL7998X_REG_P0_SW_RESET_CTL, 0x00, 50 },\n};\n\nenum isl7998x_pads {\n\tISL7998X_PAD_OUT,\n\tISL7998X_PAD_VIN1,\n\tISL7998X_PAD_VIN2,\n\tISL7998X_PAD_VIN3,\n\tISL7998X_PAD_VIN4,\n\tISL7998X_NUM_PADS\n};\n\nstruct isl7998x_datafmt {\n\tu32\t\t\tcode;\n\tenum v4l2_colorspace\tcolorspace;\n};\n\nstatic const struct isl7998x_datafmt isl7998x_colour_fmts[] = {\n\t{ MEDIA_BUS_FMT_UYVY8_2X8, V4L2_COLORSPACE_SRGB },\n};\n\n \nstatic const s64 link_freq_menu_items[] = {\n\t \n\t108000000,\n\t \n\t216000000,\n\t \n\t432000000,\n};\n\n \nstatic const char * const isl7998x_test_pattern_menu[] = {\n\t\"Disabled\",\n\t\"Enabled\",\n};\n\nstatic const char * const isl7998x_test_pattern_bars[] = {\n\t\"bbbbwb\", \"bbbwwb\", \"bbwbwb\", \"bbwwwb\",\n};\n\nstatic const char * const isl7998x_test_pattern_colors[] = {\n\t\"Yellow\", \"Blue\", \"Green\", \"Pink\",\n};\n\nstruct isl7998x_mode {\n\tunsigned int width;\n\tunsigned int height;\n\tenum v4l2_field field;\n};\n\nstatic const struct isl7998x_mode supported_modes[] = {\n\t{\n\t\t.width = 720,\n\t\t.height = 576,\n\t\t.field = V4L2_FIELD_SEQ_TB,\n\t},\n\t{\n\t\t.width = 720,\n\t\t.height = 480,\n\t\t.field = V4L2_FIELD_SEQ_BT,\n\t},\n};\n\nstatic const struct isl7998x_video_std {\n\tconst v4l2_std_id norm;\n\tunsigned int id;\n\tconst struct isl7998x_mode *mode;\n} isl7998x_std_res[] = {\n\t{ V4L2_STD_NTSC_443,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_NTSC_443,\n\t  &supported_modes[1] },\n\t{ V4L2_STD_PAL_M,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL_M,\n\t  &supported_modes[1] },\n\t{ V4L2_STD_PAL_Nc,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL_CN,\n\t  &supported_modes[0] },\n\t{ V4L2_STD_PAL_N,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL,\n\t  &supported_modes[0] },\n\t{ V4L2_STD_PAL_60,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL_60,\n\t  &supported_modes[1] },\n\t{ V4L2_STD_NTSC,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_NTSC_M,\n\t  &supported_modes[1] },\n\t{ V4L2_STD_PAL,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_PAL,\n\t  &supported_modes[0] },\n\t{ V4L2_STD_SECAM,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_SECAM,\n\t  &supported_modes[0] },\n\t{ V4L2_STD_UNKNOWN,\n\t  ISL7998X_REG_PX_DEC_SDT_STANDARD_UNKNOWN,\n\t  &supported_modes[1] },\n};\n\nstruct isl7998x {\n\tstruct v4l2_subdev\t\tsubdev;\n\tstruct regmap\t\t\t*regmap;\n\tstruct gpio_desc\t\t*pd_gpio;\n\tstruct gpio_desc\t\t*rstb_gpio;\n\tunsigned int\t\t\tnr_mipi_lanes;\n\tu32\t\t\t\tnr_inputs;\n\n\tconst struct isl7998x_datafmt\t*fmt;\n\tv4l2_std_id\t\t\tnorm;\n\tstruct media_pad\t\tpads[ISL7998X_NUM_PADS];\n\n\tint\t\t\t\tenabled;\n\n\t \n\tstruct mutex\t\t\tlock;\n\n\tstruct v4l2_ctrl_handler\tctrl_handler;\n\t \n\tstruct mutex\t\t\tctrl_mutex;\n\n\t \n\tstruct v4l2_ctrl\t\t*link_freq;\n\tu8\t\t\t\ttest_pattern;\n\tu8\t\t\t\ttest_pattern_bars;\n\tu8\t\t\t\ttest_pattern_chans;\n\tu8\t\t\t\ttest_pattern_color;\n};\n\nstatic struct isl7998x *sd_to_isl7998x(struct v4l2_subdev *sd)\n{\n\treturn container_of(sd, struct isl7998x, subdev);\n}\n\nstatic struct isl7998x *i2c_to_isl7998x(const struct i2c_client *client)\n{\n\treturn sd_to_isl7998x(i2c_get_clientdata(client));\n}\n\nstatic unsigned int isl7998x_norm_to_val(v4l2_std_id norm)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < ARRAY_SIZE(isl7998x_std_res); i++)\n\t\tif (isl7998x_std_res[i].norm & norm)\n\t\t\tbreak;\n\tif (i == ARRAY_SIZE(isl7998x_std_res))\n\t\treturn ISL7998X_REG_PX_DEC_SDT_STANDARD_UNKNOWN;\n\n\treturn isl7998x_std_res[i].id;\n}\n\nstatic const struct isl7998x_mode *isl7998x_norm_to_mode(v4l2_std_id norm)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < ARRAY_SIZE(isl7998x_std_res); i++)\n\t\tif (isl7998x_std_res[i].norm & norm)\n\t\t\tbreak;\n\t \n\tif (i == ARRAY_SIZE(isl7998x_std_res))\n\t\treturn &supported_modes[1];\n\n\treturn isl7998x_std_res[i].mode;\n}\n\nstatic int isl7998x_get_nr_inputs(struct device_node *of_node)\n{\n\tstruct device_node *port;\n\tunsigned int inputs = 0;\n\tunsigned int i;\n\n\tif (of_graph_get_endpoint_count(of_node) > ISL7998X_NUM_PADS)\n\t\treturn -EINVAL;\n\n\t \n\tfor (i = ISL7998X_PAD_VIN1; i <= ISL7998X_PAD_VIN4; i++) {\n\t\tport = of_graph_get_port_by_id(of_node, i);\n\t\tif (!port)\n\t\t\tcontinue;\n\n\t\tinputs |= BIT(i);\n\t\tof_node_put(port);\n\t}\n\n\tswitch (inputs) {\n\tcase BIT(ISL7998X_PAD_VIN1):\n\t\treturn 1;\n\tcase BIT(ISL7998X_PAD_VIN1) | BIT(ISL7998X_PAD_VIN2):\n\t\treturn 2;\n\tcase BIT(ISL7998X_PAD_VIN1) | BIT(ISL7998X_PAD_VIN2) |\n\t     BIT(ISL7998X_PAD_VIN3) | BIT(ISL7998X_PAD_VIN4):\n\t\treturn 4;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int isl7998x_wait_power_on(struct isl7998x *isl7998x)\n{\n\tstruct device *dev = isl7998x->subdev.dev;\n\tu32 chip_id;\n\tint ret;\n\tint err;\n\n\tret = read_poll_timeout(regmap_read, err, !err, 2000, 20000, false,\n\t\t\t\tisl7998x->regmap,\n\t\t\t\tISL7998X_REG_P0_PRODUCT_ID_CODE, &chip_id);\n\tif (ret) {\n\t\tdev_err(dev, \"timeout while waiting for ISL7998X\\n\");\n\t\treturn ret;\n\t}\n\n\tdev_dbg(dev, \"Found ISL799%x\\n\", chip_id);\n\n\treturn ret;\n}\n\nstatic int isl7998x_set_standard(struct isl7998x *isl7998x, v4l2_std_id norm)\n{\n\tconst struct isl7998x_mode *mode = isl7998x_norm_to_mode(norm);\n\tunsigned int val = isl7998x_norm_to_val(norm);\n\tunsigned int width = mode->width;\n\tunsigned int i;\n\tint ret;\n\n\tfor (i = 0; i < ISL7998X_INPUTS; i++) {\n\t\tret = regmap_write_bits(isl7998x->regmap,\n\t\t\t\t\tISL7998X_REG_PX_DEC_SDT(i + 1),\n\t\t\t\t\tISL7998X_REG_PX_DEC_SDT_STANDARD,\n\t\t\t\t\tval);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = regmap_write(isl7998x->regmap,\n\t\t\t   ISL7998X_REG_P5_LI_ENGINE_LINE_CTL,\n\t\t\t   0x20 | ((width >> 7) & 0x1f));\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_write(isl7998x->regmap,\n\t\t\t   ISL7998X_REG_P5_LI_ENGINE_PIC_WIDTH,\n\t\t\t   (width << 1) & 0xff);\n\tif (ret)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nstatic int isl7998x_init(struct isl7998x *isl7998x)\n{\n\tconst unsigned int lanes = isl7998x->nr_mipi_lanes;\n\tstatic const u32 isl7998x_video_in_chan_map[] = { 0x00, 0x11, 0x02, 0x02 };\n\tconst struct reg_sequence isl7998x_init_seq_custom[] = {\n\t\t{ ISL7998X_REG_P0_VIDEO_IN_CHAN_CTL,\n\t\t  isl7998x_video_in_chan_map[isl7998x->nr_inputs - 1] },\n\t\t{ ISL7998X_REG_P0_CLK_CTL_4,\n\t\t  (lanes == 1) ? 0x40 : 0x41 },\n\t\t{ ISL7998X_REG_P5_LI_ENGINE_CTL,\n\t\t  (lanes == 1) ? 0x01 : 0x02 },\n\t};\n\tstruct device *dev = isl7998x->subdev.dev;\n\tstruct regmap *regmap = isl7998x->regmap;\n\tint ret;\n\n\tdev_dbg(dev, \"configuring %d lanes for %d inputs (norm %s)\\n\",\n\t\tisl7998x->nr_mipi_lanes, isl7998x->nr_inputs,\n\t\tv4l2_norm_to_name(isl7998x->norm));\n\n\tret = regmap_register_patch(regmap, isl7998x_init_seq_1,\n\t\t\t\t    ARRAY_SIZE(isl7998x_init_seq_1));\n\tif (ret)\n\t\treturn ret;\n\n\tmutex_lock(&isl7998x->lock);\n\tret = isl7998x_set_standard(isl7998x, isl7998x->norm);\n\tmutex_unlock(&isl7998x->lock);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_register_patch(regmap, isl7998x_init_seq_custom,\n\t\t\t\t    ARRAY_SIZE(isl7998x_init_seq_custom));\n\tif (ret)\n\t\treturn ret;\n\n\treturn regmap_register_patch(regmap, isl7998x_init_seq_2,\n\t\t\t\t     ARRAY_SIZE(isl7998x_init_seq_2));\n}\n\nstatic int isl7998x_set_test_pattern(struct isl7998x *isl7998x)\n{\n\tconst struct reg_sequence isl7998x_init_seq_tpg_off[] = {\n\t\t{ ISL7998X_REG_P5_LI_ENGINE_TP_GEN_CTL, 0 },\n\t\t{ ISL7998X_REG_P5_LI_ENGINE_CTL_2, 0 }\n\t};\n\tconst struct reg_sequence isl7998x_init_seq_tpg_on[] = {\n\t\t{ ISL7998X_REG_P5_TP_GEN_BAR_PATTERN,\n\t\t  isl7998x->test_pattern_bars << 6 },\n\t\t{ ISL7998X_REG_P5_LI_ENGINE_CTL_2,\n\t\t  isl7998x->norm & V4L2_STD_PAL ? BIT(2) : 0 },\n\t\t{ ISL7998X_REG_P5_LI_ENGINE_TP_GEN_CTL,\n\t\t  (isl7998x->test_pattern_chans << 4) |\n\t\t  (isl7998x->test_pattern_color << 2) }\n\t};\n\tstruct device *dev = isl7998x->subdev.dev;\n\tstruct regmap *regmap = isl7998x->regmap;\n\tint ret;\n\n\tif (pm_runtime_get_if_in_use(dev) <= 0)\n\t\treturn 0;\n\n\tif (isl7998x->test_pattern != 0) {\n\t\tdev_dbg(dev, \"enabling test pattern: channels 0x%x, %s, %s\\n\",\n\t\t\tisl7998x->test_pattern_chans,\n\t\t\tisl7998x_test_pattern_bars[isl7998x->test_pattern_bars],\n\t\t\tisl7998x_test_pattern_colors[isl7998x->test_pattern_color]);\n\t\tret = regmap_register_patch(regmap, isl7998x_init_seq_tpg_on,\n\t\t\t\t\t    ARRAY_SIZE(isl7998x_init_seq_tpg_on));\n\t} else {\n\t\tret = regmap_register_patch(regmap, isl7998x_init_seq_tpg_off,\n\t\t\t\t\t    ARRAY_SIZE(isl7998x_init_seq_tpg_off));\n\t}\n\n\tpm_runtime_put(dev);\n\n\treturn ret;\n}\n\n#ifdef CONFIG_VIDEO_ADV_DEBUG\nstatic int isl7998x_g_register(struct v4l2_subdev *sd,\n\t\t\t       struct v4l2_dbg_register *reg)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tint ret;\n\tu32 val;\n\n\tret = regmap_read(isl7998x->regmap, reg->reg, &val);\n\tif (ret)\n\t\treturn ret;\n\n\treg->size = 1;\n\treg->val = val;\n\n\treturn 0;\n}\n\nstatic int isl7998x_s_register(struct v4l2_subdev *sd,\n\t\t\t       const struct v4l2_dbg_register *reg)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\n\treturn regmap_write(isl7998x->regmap, reg->reg, reg->val);\n}\n#endif\n\nstatic int isl7998x_g_std(struct v4l2_subdev *sd, v4l2_std_id *norm)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\n\tmutex_lock(&isl7998x->lock);\n\t*norm = isl7998x->norm;\n\tmutex_unlock(&isl7998x->lock);\n\n\treturn 0;\n}\n\nstatic int isl7998x_s_std(struct v4l2_subdev *sd, v4l2_std_id norm)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\tstruct device *dev = &client->dev;\n\tint ret = 0;\n\n\tmutex_lock(&isl7998x->lock);\n\tif (isl7998x->enabled) {\n\t\tret = -EBUSY;\n\t\tmutex_unlock(&isl7998x->lock);\n\t\treturn ret;\n\t}\n\tisl7998x->norm = norm;\n\tmutex_unlock(&isl7998x->lock);\n\n\tif (pm_runtime_get_if_in_use(dev) <= 0)\n\t\treturn ret;\n\n\tret = isl7998x_set_standard(isl7998x, norm);\n\n\tpm_runtime_put(dev);\n\n\treturn ret;\n}\n\nstatic int isl7998x_querystd(struct v4l2_subdev *sd, v4l2_std_id *std)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\tstruct device *dev = &client->dev;\n\tunsigned int std_id[ISL7998X_INPUTS];\n\tunsigned int i;\n\tint ret;\n\tu32 reg;\n\n\tret = pm_runtime_resume_and_get(dev);\n\tif (ret)\n\t\treturn ret;\n\n\tdev_dbg(dev, \"starting video standard detection\\n\");\n\n\tmutex_lock(&isl7998x->lock);\n\tif (isl7998x->enabled) {\n\t\tret = -EBUSY;\n\t\tgoto out_unlock;\n\t}\n\n\tret = isl7998x_set_standard(isl7998x, V4L2_STD_UNKNOWN);\n\tif (ret)\n\t\tgoto out_unlock;\n\n\tfor (i = 0; i < ISL7998X_INPUTS; i++) {\n\t\tret = regmap_write(isl7998x->regmap,\n\t\t\t\t   ISL7998X_REG_PX_DEC_SDTR(i + 1),\n\t\t\t\t   ISL7998X_REG_PX_DEC_SDTR_ATSTART);\n\t\tif (ret)\n\t\t\tgoto out_reset_std;\n\t}\n\n\tfor (i = 0; i < ISL7998X_INPUTS; i++) {\n\t\tret = regmap_read_poll_timeout(isl7998x->regmap,\n\t\t\t\t\t       ISL7998X_REG_PX_DEC_SDT(i + 1),\n\t\t\t\t\t       reg,\n\t\t\t\t\t       !(reg & ISL7998X_REG_PX_DEC_SDT_DET),\n\t\t\t\t\t       2000, 500 * USEC_PER_MSEC);\n\t\tif (ret)\n\t\t\tgoto out_reset_std;\n\t\tstd_id[i] = FIELD_GET(ISL7998X_REG_PX_DEC_SDT_NOW, reg);\n\t}\n\n\t \n\tfor (i = 0; i < isl7998x->nr_inputs; i++) {\n\t\tdev_dbg(dev, \"input %d: detected %s\\n\",\n\t\t\ti, v4l2_norm_to_name(isl7998x_std_res[std_id[i]].norm));\n\t\tif (std_id[0] != std_id[i])\n\t\t\tdev_warn(dev,\n\t\t\t\t \"incompatible standards: %s on input %d (expected %s)\\n\",\n\t\t\t\t v4l2_norm_to_name(isl7998x_std_res[std_id[i]].norm), i,\n\t\t\t\t v4l2_norm_to_name(isl7998x_std_res[std_id[0]].norm));\n\t}\n\n\t*std = isl7998x_std_res[std_id[0]].norm;\n\nout_reset_std:\n\tisl7998x_set_standard(isl7998x, isl7998x->norm);\nout_unlock:\n\tmutex_unlock(&isl7998x->lock);\n\tpm_runtime_put(dev);\n\n\treturn ret;\n}\n\nstatic int isl7998x_g_tvnorms(struct v4l2_subdev *sd, v4l2_std_id *std)\n{\n\t*std = V4L2_STD_ALL;\n\n\treturn 0;\n}\n\nstatic int isl7998x_g_input_status(struct v4l2_subdev *sd, u32 *status)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\tstruct device *dev = &client->dev;\n\tunsigned int i;\n\tint ret = 0;\n\tu32 reg;\n\n\tif (!pm_runtime_active(dev)) {\n\t\t*status |= V4L2_IN_ST_NO_POWER;\n\t\treturn 0;\n\t}\n\n\tfor (i = 0; i < isl7998x->nr_inputs; i++) {\n\t\tret = regmap_read(isl7998x->regmap,\n\t\t\t\t  ISL7998X_REG_PX_DEC_STATUS_1(i + 1), &reg);\n\t\tif (!ret) {\n\t\t\tif (reg & ISL7998X_REG_PX_DEC_STATUS_1_VDLOSS)\n\t\t\t\t*status |= V4L2_IN_ST_NO_SIGNAL;\n\t\t\tif (!(reg & ISL7998X_REG_PX_DEC_STATUS_1_HLOCK))\n\t\t\t\t*status |= V4L2_IN_ST_NO_H_LOCK;\n\t\t\tif (!(reg & ISL7998X_REG_PX_DEC_STATUS_1_VLOCK))\n\t\t\t\t*status |= V4L2_IN_ST_NO_V_LOCK;\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nstatic int isl7998x_s_stream(struct v4l2_subdev *sd, int enable)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\tstruct device *dev = &client->dev;\n\tint ret = 0;\n\tu32 reg;\n\n\tdev_dbg(dev, \"stream %s\\n\", enable ? \"ON\" : \"OFF\");\n\n\tmutex_lock(&isl7998x->lock);\n\tif (isl7998x->enabled == enable)\n\t\tgoto out;\n\tisl7998x->enabled = enable;\n\n\tif (enable) {\n\t\tret = isl7998x_set_test_pattern(isl7998x);\n\t\tif (ret)\n\t\t\tgoto out;\n\t}\n\n\tregmap_read(isl7998x->regmap,\n\t\t    ISL7998X_REG_P5_LI_ENGINE_CTL, &reg);\n\tif (enable)\n\t\treg &= ~BIT(7);\n\telse\n\t\treg |= BIT(7);\n\tret = regmap_write(isl7998x->regmap,\n\t\t\t   ISL7998X_REG_P5_LI_ENGINE_CTL, reg);\n\nout:\n\tmutex_unlock(&isl7998x->lock);\n\n\treturn ret;\n}\n\nstatic int isl7998x_pre_streamon(struct v4l2_subdev *sd, u32 flags)\n{\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\tstruct device *dev = &client->dev;\n\n\treturn pm_runtime_resume_and_get(dev);\n}\n\nstatic int isl7998x_post_streamoff(struct v4l2_subdev *sd)\n{\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\tstruct device *dev = &client->dev;\n\n\tpm_runtime_put(dev);\n\n\treturn 0;\n}\n\nstatic int isl7998x_enum_mbus_code(struct v4l2_subdev *sd,\n\t\t\t\t   struct v4l2_subdev_state *sd_state,\n\t\t\t\t   struct v4l2_subdev_mbus_code_enum *code)\n{\n\tif (code->index >= ARRAY_SIZE(isl7998x_colour_fmts))\n\t\treturn -EINVAL;\n\n\tcode->code = isl7998x_colour_fmts[code->index].code;\n\n\treturn 0;\n}\n\nstatic int isl7998x_enum_frame_size(struct v4l2_subdev *sd,\n\t\t\t\t    struct v4l2_subdev_state *sd_state,\n\t\t\t\t    struct v4l2_subdev_frame_size_enum *fse)\n{\n\tif (fse->index >= ARRAY_SIZE(supported_modes))\n\t\treturn -EINVAL;\n\n\tif (fse->code != isl7998x_colour_fmts[0].code)\n\t\treturn -EINVAL;\n\n\tfse->min_width = supported_modes[fse->index].width;\n\tfse->max_width = fse->min_width;\n\tfse->min_height = supported_modes[fse->index].height;\n\tfse->max_height = fse->min_height;\n\n\treturn 0;\n}\n\nstatic int isl7998x_get_fmt(struct v4l2_subdev *sd,\n\t\t\t    struct v4l2_subdev_state *sd_state,\n\t\t\t    struct v4l2_subdev_format *format)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tstruct v4l2_mbus_framefmt *mf = &format->format;\n\tconst struct isl7998x_mode *mode;\n\n\tmutex_lock(&isl7998x->lock);\n\n\tif (format->which == V4L2_SUBDEV_FORMAT_TRY) {\n\t\tformat->format = *v4l2_subdev_get_try_format(sd, sd_state,\n\t\t\t\t\t\t\t     format->pad);\n\t\tgoto out;\n\t}\n\n\tmode = isl7998x_norm_to_mode(isl7998x->norm);\n\n\tmf->width\t= mode->width;\n\tmf->height\t= mode->height;\n\tmf->code\t= isl7998x->fmt->code;\n\tmf->field\t= mode->field;\n\tmf->colorspace\t= 0;\n\nout:\n\tmutex_unlock(&isl7998x->lock);\n\n\treturn 0;\n}\n\nstatic int isl7998x_set_fmt(struct v4l2_subdev *sd,\n\t\t\t    struct v4l2_subdev_state *sd_state,\n\t\t\t    struct v4l2_subdev_format *format)\n{\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tstruct v4l2_mbus_framefmt *mf = &format->format;\n\tconst struct isl7998x_mode *mode;\n\n\tmutex_lock(&isl7998x->lock);\n\n\tmode = isl7998x_norm_to_mode(isl7998x->norm);\n\n\tmf->width = mode->width;\n\tmf->height = mode->height;\n\tmf->code = isl7998x->fmt->code;\n\tmf->field = mode->field;\n\n\tif (format->which == V4L2_SUBDEV_FORMAT_TRY)\n\t\t*v4l2_subdev_get_try_format(sd, sd_state, format->pad) = format->format;\n\n\tmutex_unlock(&isl7998x->lock);\n\n\treturn 0;\n}\n\nstatic int isl7998x_set_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct isl7998x *isl7998x = container_of(ctrl->handler,\n\t\t\t\t\t\t struct isl7998x, ctrl_handler);\n\tint ret = 0;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_TEST_PATTERN_BARS:\n\t\tmutex_lock(&isl7998x->lock);\n\t\tisl7998x->test_pattern_bars = ctrl->val & 0x3;\n\t\tret = isl7998x_set_test_pattern(isl7998x);\n\t\tmutex_unlock(&isl7998x->lock);\n\t\tbreak;\n\tcase V4L2_CID_TEST_PATTERN_CHANNELS:\n\t\tmutex_lock(&isl7998x->lock);\n\t\tisl7998x->test_pattern_chans = ctrl->val & 0xf;\n\t\tret = isl7998x_set_test_pattern(isl7998x);\n\t\tmutex_unlock(&isl7998x->lock);\n\t\tbreak;\n\tcase V4L2_CID_TEST_PATTERN_COLOR:\n\t\tmutex_lock(&isl7998x->lock);\n\t\tisl7998x->test_pattern_color = ctrl->val & 0x3;\n\t\tret = isl7998x_set_test_pattern(isl7998x);\n\t\tmutex_unlock(&isl7998x->lock);\n\t\tbreak;\n\tcase V4L2_CID_TEST_PATTERN:\n\t\tmutex_lock(&isl7998x->lock);\n\t\tisl7998x->test_pattern = ctrl->val;\n\t\tret = isl7998x_set_test_pattern(isl7998x);\n\t\tmutex_unlock(&isl7998x->lock);\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nstatic const struct v4l2_subdev_core_ops isl7998x_subdev_core_ops = {\n#ifdef CONFIG_VIDEO_ADV_DEBUG\n\t.g_register\t= isl7998x_g_register,\n\t.s_register\t= isl7998x_s_register,\n#endif\n};\n\nstatic const struct v4l2_subdev_video_ops isl7998x_subdev_video_ops = {\n\t.g_std\t\t= isl7998x_g_std,\n\t.s_std\t\t= isl7998x_s_std,\n\t.querystd\t= isl7998x_querystd,\n\t.g_tvnorms\t= isl7998x_g_tvnorms,\n\t.g_input_status\t= isl7998x_g_input_status,\n\t.s_stream\t= isl7998x_s_stream,\n\t.pre_streamon\t= isl7998x_pre_streamon,\n\t.post_streamoff\t= isl7998x_post_streamoff,\n};\n\nstatic const struct v4l2_subdev_pad_ops isl7998x_subdev_pad_ops = {\n\t.enum_mbus_code\t\t= isl7998x_enum_mbus_code,\n\t.enum_frame_size\t= isl7998x_enum_frame_size,\n\t.get_fmt\t\t= isl7998x_get_fmt,\n\t.set_fmt\t\t= isl7998x_set_fmt,\n};\n\nstatic const struct v4l2_subdev_ops isl7998x_subdev_ops = {\n\t.core\t\t= &isl7998x_subdev_core_ops,\n\t.video\t\t= &isl7998x_subdev_video_ops,\n\t.pad\t\t= &isl7998x_subdev_pad_ops,\n};\n\nstatic const struct media_entity_operations isl7998x_entity_ops = {\n\t.link_validate = v4l2_subdev_link_validate,\n};\n\nstatic const struct v4l2_ctrl_ops isl7998x_ctrl_ops = {\n\t.s_ctrl\t\t\t= isl7998x_set_ctrl,\n};\n\nstatic const struct v4l2_ctrl_config isl7998x_ctrls[] = {\n\t{\n\t\t.ops\t\t= &isl7998x_ctrl_ops,\n\t\t.id\t\t= V4L2_CID_TEST_PATTERN_BARS,\n\t\t.type\t\t= V4L2_CTRL_TYPE_MENU,\n\t\t.name\t\t= \"Test Pattern Bars\",\n\t\t.max\t\t= ARRAY_SIZE(isl7998x_test_pattern_bars) - 1,\n\t\t.def\t\t= 0,\n\t\t.qmenu\t\t= isl7998x_test_pattern_bars,\n\t}, {\n\t\t.ops\t\t= &isl7998x_ctrl_ops,\n\t\t.id\t\t= V4L2_CID_TEST_PATTERN_CHANNELS,\n\t\t.type\t\t= V4L2_CTRL_TYPE_INTEGER,\n\t\t.name\t\t= \"Test Pattern Channels\",\n\t\t.min\t\t= 0,\n\t\t.max\t\t= 0xf,\n\t\t.step\t\t= 1,\n\t\t.def\t\t= 0xf,\n\t\t.flags\t\t= 0,\n\t}, {\n\t\t.ops\t\t= &isl7998x_ctrl_ops,\n\t\t.id\t\t= V4L2_CID_TEST_PATTERN_COLOR,\n\t\t.type\t\t= V4L2_CTRL_TYPE_MENU,\n\t\t.name\t\t= \"Test Pattern Color\",\n\t\t.max\t\t= ARRAY_SIZE(isl7998x_test_pattern_colors) - 1,\n\t\t.def\t\t= 0,\n\t\t.qmenu\t\t= isl7998x_test_pattern_colors,\n\t},\n};\n\n#define ISL7998X_REG_DECODER_ACA_READABLE_RANGE(page)\t\t\t\\\n\t \t\t\t\t\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_INPUT_FMT(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_HS_DELAY_CTL(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_ANCTL(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_CSC_CTL(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_BRIGHT(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_HUE(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_VERT_PEAK(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_CORING(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_SDT(page),\t\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_SDTR(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_CLMPG(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_DATA_CONV(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_INTERNAL_TEST(page),\t\\\n\t\t\t ISL7998X_REG_PX_DEC_INTERNAL_TEST(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_H_DELAY_CTL(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_H_DELAY_II_LOW(page)),\t\\\n\t \t\t\t\t\t\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_CTL_1(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_ACA_HIST_WIN_V_SZ2(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_Y_AVG(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_ACA_CTL_4(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_FLEX_WIN_HIST(page),\t\\\n\t\t\t ISL7998X_REG_PX_ACA_XFER_HIST_HOST(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_PAGE(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_PAGE(page))\n\n#define ISL7998X_REG_DECODER_ACA_WRITEABLE_RANGE(page)\t\t\t\\\n\t \t\t\t\t\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_INPUT_FMT(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_INPUT_FMT(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_HS_DELAY_CTL(page),\t\\\n\t\t\t ISL7998X_REG_PX_DEC_HS_DELAY_CTL(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_ANCTL(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_CSC_CTL(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_BRIGHT(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_HUE(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_VERT_PEAK(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_CORING(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_SDT(page),\t\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_SDTR(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_CLMPG(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_MISC3(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_CLMD(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_DATA_CONV(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_INTERNAL_TEST(page),\t\\\n\t\t\t ISL7998X_REG_PX_DEC_INTERNAL_TEST(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_H_DELAY_CTL(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_H_DELAY_II_LOW(page)),\t\\\n\t \t\t\t\t\t\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_CTL_1(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_ACA_HIST_WIN_V_SZ2(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_CTL_2(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_ACA_CTL_4(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_FLEX_WIN_HIST(page),\t\\\n\t\t\t ISL7998X_REG_PX_ACA_HIST_DATA_LO(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_XFER_HIST_HOST(page),\t\\\n\t\t\t ISL7998X_REG_PX_ACA_XFER_HIST_HOST(page)),\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_PAGE(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_PAGE(page))\n\n#define ISL7998X_REG_DECODER_ACA_VOLATILE_RANGE(page)\t\t\t\\\n\t \t\t\t\t\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_STATUS_1(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_STATUS_1(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_SDT(page),\t\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_SDT(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_MVSN(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_DEC_HFREF(page)),\t\t\\\n\t \t\t\t\t\t\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_Y_AVG(page),\t\t\\\n\t\t\t ISL7998X_REG_PX_ACA_Y_HIGH(page)),\t\t\\\n\tregmap_reg_range(ISL7998X_REG_PX_ACA_HIST_DATA_LO(page),\t\\\n\t\t\t ISL7998X_REG_PX_ACA_FLEX_WIN_CR_CLR(page))\n\nstatic const struct regmap_range isl7998x_readable_ranges[] = {\n\tregmap_reg_range(ISL7998X_REG_P0_PRODUCT_ID_CODE,\n\t\t\t ISL7998X_REG_P0_IRQ_SYNC_CTL),\n\tregmap_reg_range(ISL7998X_REG_P0_INTERRUPT_STATUS,\n\t\t\t ISL7998X_REG_P0_CLOCK_DELAY),\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_PAGE(0),\n\t\t\t ISL7998X_REG_PX_DEC_PAGE(0)),\n\n\tISL7998X_REG_DECODER_ACA_READABLE_RANGE(1),\n\tISL7998X_REG_DECODER_ACA_READABLE_RANGE(2),\n\tISL7998X_REG_DECODER_ACA_READABLE_RANGE(3),\n\tISL7998X_REG_DECODER_ACA_READABLE_RANGE(4),\n\n\tregmap_reg_range(ISL7998X_REG_P5_LI_ENGINE_CTL,\n\t\t\t ISL7998X_REG_P5_MIPI_SP_HS_TRL_CTL),\n\tregmap_reg_range(ISL7998X_REG_P5_FIFO_THRSH_CNT_1,\n\t\t\t ISL7998X_REG_P5_PLL_ANA),\n\tregmap_reg_range(ISL7998X_REG_P5_TOTAL_PF_LINE_CNT_1,\n\t\t\t ISL7998X_REG_P5_HIST_LINE_CNT_2),\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_PAGE(5),\n\t\t\t ISL7998X_REG_PX_DEC_PAGE(5)),\n};\n\nstatic const struct regmap_range isl7998x_writeable_ranges[] = {\n\tregmap_reg_range(ISL7998X_REG_P0_SW_RESET_CTL,\n\t\t\t ISL7998X_REG_P0_IRQ_SYNC_CTL),\n\tregmap_reg_range(ISL7998X_REG_P0_CHAN_1_IRQ,\n\t\t\t ISL7998X_REG_P0_SHORT_DIAG_IRQ_EN),\n\tregmap_reg_range(ISL7998X_REG_P0_CLOCK_DELAY,\n\t\t\t ISL7998X_REG_P0_CLOCK_DELAY),\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_PAGE(0),\n\t\t\t ISL7998X_REG_PX_DEC_PAGE(0)),\n\n\tISL7998X_REG_DECODER_ACA_WRITEABLE_RANGE(1),\n\tISL7998X_REG_DECODER_ACA_WRITEABLE_RANGE(2),\n\tISL7998X_REG_DECODER_ACA_WRITEABLE_RANGE(3),\n\tISL7998X_REG_DECODER_ACA_WRITEABLE_RANGE(4),\n\n\tregmap_reg_range(ISL7998X_REG_P5_LI_ENGINE_CTL,\n\t\t\t ISL7998X_REG_P5_ESC_MODE_TIME_CTL),\n\tregmap_reg_range(ISL7998X_REG_P5_MIPI_SP_HS_TRL_CTL,\n\t\t\t ISL7998X_REG_P5_PLL_ANA),\n\tregmap_reg_range(ISL7998X_REG_P5_TOTAL_PF_LINE_CNT_1,\n\t\t\t ISL7998X_REG_P5_HIST_LINE_CNT_2),\n\tregmap_reg_range(ISL7998X_REG_PX_DEC_PAGE(5),\n\t\t\t ISL7998X_REG_PX_DEC_PAGE(5)),\n\n\tISL7998X_REG_DECODER_ACA_WRITEABLE_RANGE(0xf),\n};\n\nstatic const struct regmap_range isl7998x_volatile_ranges[] = {\n\t \n\tregmap_reg_range(ISL7998X_REG_P0_PRODUCT_ID_CODE,\n\t\t\t ISL7998X_REG_P0_PRODUCT_ID_CODE),\n\tregmap_reg_range(ISL7998X_REG_P0_MPP1_SYNC_CTL,\n\t\t\t ISL7998X_REG_P0_IRQ_SYNC_CTL),\n\tregmap_reg_range(ISL7998X_REG_P0_INTERRUPT_STATUS,\n\t\t\t ISL7998X_REG_P0_INTERRUPT_STATUS),\n\tregmap_reg_range(ISL7998X_REG_P0_CHAN_1_STATUS,\n\t\t\t ISL7998X_REG_P0_SHORT_DIAG_STATUS),\n\n\tISL7998X_REG_DECODER_ACA_VOLATILE_RANGE(1),\n\tISL7998X_REG_DECODER_ACA_VOLATILE_RANGE(2),\n\tISL7998X_REG_DECODER_ACA_VOLATILE_RANGE(3),\n\tISL7998X_REG_DECODER_ACA_VOLATILE_RANGE(4),\n\n\tregmap_reg_range(ISL7998X_REG_P5_AUTO_TEST_ERR_DET,\n\t\t\t ISL7998X_REG_P5_PIC_HEIGHT_LOW),\n};\n\nstatic const struct regmap_access_table isl7998x_readable_table = {\n\t.yes_ranges = isl7998x_readable_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(isl7998x_readable_ranges),\n};\n\nstatic const struct regmap_access_table isl7998x_writeable_table = {\n\t.yes_ranges = isl7998x_writeable_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(isl7998x_writeable_ranges),\n};\n\nstatic const struct regmap_access_table isl7998x_volatile_table = {\n\t.yes_ranges = isl7998x_volatile_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(isl7998x_volatile_ranges),\n};\n\nstatic const struct regmap_range_cfg isl7998x_ranges[] = {\n\t{\n\t\t.range_min\t= ISL7998X_REG_PN_BASE(0),\n\t\t.range_max\t= ISL7998X_REG_PX_ACA_XFER_HIST_HOST(0xf),\n\t\t.selector_reg\t= ISL7998X_REG_PX_DEC_PAGE(0),\n\t\t.selector_mask\t= ISL7998X_REG_PX_DEC_PAGE_MASK,\n\t\t.window_start\t= 0,\n\t\t.window_len\t= 256,\n\t}\n};\n\nstatic const struct regmap_config isl7998x_regmap = {\n\t.reg_bits\t= 8,\n\t.val_bits\t= 8,\n\t.max_register\t= ISL7998X_REG_PX_ACA_XFER_HIST_HOST(0xf),\n\t.ranges\t\t= isl7998x_ranges,\n\t.num_ranges\t= ARRAY_SIZE(isl7998x_ranges),\n\t.rd_table\t= &isl7998x_readable_table,\n\t.wr_table\t= &isl7998x_writeable_table,\n\t.volatile_table\t= &isl7998x_volatile_table,\n\t.cache_type\t= REGCACHE_RBTREE,\n};\n\nstatic int isl7998x_mc_init(struct isl7998x *isl7998x)\n{\n\tunsigned int i;\n\n\tisl7998x->subdev.entity.ops = &isl7998x_entity_ops;\n\tisl7998x->subdev.entity.function = MEDIA_ENT_F_VID_IF_BRIDGE;\n\n\tisl7998x->pads[ISL7998X_PAD_OUT].flags = MEDIA_PAD_FL_SOURCE;\n\tfor (i = ISL7998X_PAD_VIN1; i < ISL7998X_NUM_PADS; i++)\n\t\tisl7998x->pads[i].flags = MEDIA_PAD_FL_SINK;\n\n\treturn media_entity_pads_init(&isl7998x->subdev.entity,\n\t\t\t\t      ISL7998X_NUM_PADS,\n\t\t\t\t      isl7998x->pads);\n}\n\nstatic int get_link_freq_menu_index(unsigned int lanes,\n\t\t\t\t    unsigned int inputs)\n{\n\tint ret = -EINVAL;\n\n\tswitch (lanes) {\n\tcase 1:\n\t\tif (inputs == 1)\n\t\t\tret = 0;\n\t\tif (inputs == 2)\n\t\t\tret = 1;\n\t\tif (inputs == 4)\n\t\t\tret = 2;\n\t\tbreak;\n\tcase 2:\n\t\tif (inputs == 2)\n\t\t\tret = 0;\n\t\tif (inputs == 4)\n\t\t\tret = 1;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nstatic void isl7998x_remove_controls(struct isl7998x *isl7998x)\n{\n\tv4l2_ctrl_handler_free(&isl7998x->ctrl_handler);\n\tmutex_destroy(&isl7998x->ctrl_mutex);\n}\n\nstatic int isl7998x_init_controls(struct isl7998x *isl7998x)\n{\n\tstruct v4l2_subdev *sd = &isl7998x->subdev;\n\tint link_freq_index;\n\tunsigned int i;\n\tint ret;\n\n\tret = v4l2_ctrl_handler_init(&isl7998x->ctrl_handler,\n\t\t\t\t     2 + ARRAY_SIZE(isl7998x_ctrls));\n\tif (ret)\n\t\treturn ret;\n\n\tmutex_init(&isl7998x->ctrl_mutex);\n\tisl7998x->ctrl_handler.lock = &isl7998x->ctrl_mutex;\n\tlink_freq_index = get_link_freq_menu_index(isl7998x->nr_mipi_lanes,\n\t\t\t\t\t\t   isl7998x->nr_inputs);\n\tif (link_freq_index < 0 ||\n\t    link_freq_index >= ARRAY_SIZE(link_freq_menu_items)) {\n\t\tdev_err(sd->dev,\n\t\t\t\"failed to find MIPI link freq: %d lanes, %d inputs\\n\",\n\t\t\tisl7998x->nr_mipi_lanes, isl7998x->nr_inputs);\n\t\tret = -EINVAL;\n\t\tgoto err;\n\t}\n\n\tisl7998x->link_freq = v4l2_ctrl_new_int_menu(&isl7998x->ctrl_handler,\n\t\t\t\t\t\t     &isl7998x_ctrl_ops,\n\t\t\t\t\t\t     V4L2_CID_LINK_FREQ,\n\t\t\t\t\t\t     ARRAY_SIZE(link_freq_menu_items) - 1,\n\t\t\t\t\t\t     link_freq_index,\n\t\t\t\t\t\t     link_freq_menu_items);\n\tif (isl7998x->link_freq)\n\t\tisl7998x->link_freq->flags |= V4L2_CTRL_FLAG_READ_ONLY;\n\n\tfor (i = 0; i < ARRAY_SIZE(isl7998x_ctrls); i++)\n\t\tv4l2_ctrl_new_custom(&isl7998x->ctrl_handler,\n\t\t\t\t     &isl7998x_ctrls[i], NULL);\n\n\tv4l2_ctrl_new_std_menu_items(&isl7998x->ctrl_handler,\n\t\t\t\t     &isl7998x_ctrl_ops,\n\t\t\t\t     V4L2_CID_TEST_PATTERN,\n\t\t\t\t     ARRAY_SIZE(isl7998x_test_pattern_menu) - 1,\n\t\t\t\t     0, 0, isl7998x_test_pattern_menu);\n\n\tret = isl7998x->ctrl_handler.error;\n\tif (ret)\n\t\tgoto err;\n\n\tisl7998x->subdev.ctrl_handler = &isl7998x->ctrl_handler;\n\tv4l2_ctrl_handler_setup(&isl7998x->ctrl_handler);\n\n\treturn 0;\n\nerr:\n\tisl7998x_remove_controls(isl7998x);\n\n\treturn ret;\n}\n\nstatic int isl7998x_probe(struct i2c_client *client)\n{\n\tstruct device *dev = &client->dev;\n\tstruct v4l2_fwnode_endpoint endpoint = {\n\t\t.bus_type = V4L2_MBUS_CSI2_DPHY,\n\t};\n\tstruct fwnode_handle *ep;\n\tstruct isl7998x *isl7998x;\n\tstruct i2c_adapter *adapter = to_i2c_adapter(client->dev.parent);\n\tint nr_inputs;\n\tint ret;\n\n\tret = i2c_check_functionality(adapter, I2C_FUNC_SMBUS_WORD_DATA);\n\tif (!ret) {\n\t\tdev_warn(&adapter->dev,\n\t\t\t \"I2C-Adapter doesn't support I2C_FUNC_SMBUS_WORD\\n\");\n\t\treturn -EIO;\n\t}\n\n\tisl7998x = devm_kzalloc(dev, sizeof(*isl7998x), GFP_KERNEL);\n\tif (!isl7998x)\n\t\treturn -ENOMEM;\n\n\tisl7998x->pd_gpio = devm_gpiod_get_optional(dev, \"powerdown\",\n\t\t\t\t\t\t    GPIOD_OUT_HIGH);\n\tif (IS_ERR(isl7998x->pd_gpio))\n\t\treturn dev_err_probe(dev, PTR_ERR(isl7998x->pd_gpio),\n\t\t\t\t     \"Failed to retrieve/request PD GPIO\\n\");\n\n\tisl7998x->rstb_gpio = devm_gpiod_get_optional(dev, \"reset\",\n\t\t\t\t\t\t      GPIOD_OUT_HIGH);\n\tif (IS_ERR(isl7998x->rstb_gpio))\n\t\treturn dev_err_probe(dev, PTR_ERR(isl7998x->rstb_gpio),\n\t\t\t\t     \"Failed to retrieve/request RSTB GPIO\\n\");\n\n\tisl7998x->regmap = devm_regmap_init_i2c(client, &isl7998x_regmap);\n\tif (IS_ERR(isl7998x->regmap))\n\t\treturn dev_err_probe(dev, PTR_ERR(isl7998x->regmap),\n\t\t\t\t     \"Failed to allocate register map\\n\");\n\n\tep = fwnode_graph_get_endpoint_by_id(dev_fwnode(dev),\n\t\t\t\t\t     ISL7998X_PAD_OUT, 0, 0);\n\tif (!ep)\n\t\treturn dev_err_probe(dev, -EINVAL, \"Missing endpoint node\\n\");\n\n\tret = v4l2_fwnode_endpoint_parse(ep, &endpoint);\n\tfwnode_handle_put(ep);\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret, \"Failed to parse endpoint\\n\");\n\n\tif (endpoint.bus.mipi_csi2.num_data_lanes == 0 ||\n\t    endpoint.bus.mipi_csi2.num_data_lanes > 2)\n\t\treturn dev_err_probe(dev, -EINVAL,\n\t\t\t\t     \"Invalid number of MIPI lanes\\n\");\n\n\tisl7998x->nr_mipi_lanes = endpoint.bus.mipi_csi2.num_data_lanes;\n\n\tnr_inputs = isl7998x_get_nr_inputs(dev->of_node);\n\tif (nr_inputs < 0)\n\t\treturn dev_err_probe(dev, nr_inputs,\n\t\t\t\t     \"Invalid number of input ports\\n\");\n\tisl7998x->nr_inputs = nr_inputs;\n\n\tv4l2_i2c_subdev_init(&isl7998x->subdev, client, &isl7998x_subdev_ops);\n\tisl7998x->subdev.flags |= V4L2_SUBDEV_FL_HAS_DEVNODE;\n\n\tret = isl7998x_mc_init(isl7998x);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tisl7998x->fmt = &isl7998x_colour_fmts[0];\n\tisl7998x->norm = V4L2_STD_NTSC;\n\tisl7998x->enabled = 0;\n\n\tmutex_init(&isl7998x->lock);\n\n\tret = isl7998x_init_controls(isl7998x);\n\tif (ret)\n\t\tgoto err_entity_cleanup;\n\n\tret = v4l2_async_register_subdev(&isl7998x->subdev);\n\tif (ret < 0)\n\t\tgoto err_controls_cleanup;\n\n\tpm_runtime_enable(dev);\n\n\treturn 0;\n\nerr_controls_cleanup:\n\tisl7998x_remove_controls(isl7998x);\nerr_entity_cleanup:\n\tmedia_entity_cleanup(&isl7998x->subdev.entity);\n\n\treturn ret;\n}\n\nstatic void isl7998x_remove(struct i2c_client *client)\n{\n\tstruct isl7998x *isl7998x = i2c_to_isl7998x(client);\n\n\tpm_runtime_disable(&client->dev);\n\tv4l2_async_unregister_subdev(&isl7998x->subdev);\n\tisl7998x_remove_controls(isl7998x);\n\tmedia_entity_cleanup(&isl7998x->subdev.entity);\n}\n\nstatic const struct of_device_id isl7998x_of_match[] = {\n\t{ .compatible = \"isil,isl79987\", },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, isl7998x_of_match);\n\nstatic const struct i2c_device_id isl7998x_id[] = {\n\t{ \"isl79987\", 0 },\n\t{   },\n};\nMODULE_DEVICE_TABLE(i2c, isl7998x_id);\n\nstatic int __maybe_unused isl7998x_runtime_resume(struct device *dev)\n{\n\tstruct v4l2_subdev *sd = dev_get_drvdata(dev);\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\tint ret;\n\n\tgpiod_set_value(isl7998x->rstb_gpio, 1);\n\tgpiod_set_value(isl7998x->pd_gpio, 0);\n\tgpiod_set_value(isl7998x->rstb_gpio, 0);\n\n\tret = isl7998x_wait_power_on(isl7998x);\n\tif (ret)\n\t\tgoto err;\n\n\tret = isl7998x_init(isl7998x);\n\tif (ret)\n\t\tgoto err;\n\n\treturn 0;\n\nerr:\n\tgpiod_set_value(isl7998x->pd_gpio, 1);\n\n\treturn ret;\n}\n\nstatic int __maybe_unused isl7998x_runtime_suspend(struct device *dev)\n{\n\tstruct v4l2_subdev *sd = dev_get_drvdata(dev);\n\tstruct isl7998x *isl7998x = sd_to_isl7998x(sd);\n\n\tgpiod_set_value(isl7998x->pd_gpio, 1);\n\n\treturn 0;\n}\n\nstatic const struct dev_pm_ops isl7998x_pm_ops = {\n\tSET_RUNTIME_PM_OPS(isl7998x_runtime_suspend,\n\t\t\t   isl7998x_runtime_resume,\n\t\t\t   NULL)\n};\n\nstatic struct i2c_driver isl7998x_i2c_driver = {\n\t.driver = {\n\t\t.name = \"isl7998x\",\n\t\t.of_match_table = isl7998x_of_match,\n\t\t.pm = &isl7998x_pm_ops,\n\t},\n\t.probe\t\t= isl7998x_probe,\n\t.remove\t\t= isl7998x_remove,\n\t.id_table\t= isl7998x_id,\n};\n\nmodule_i2c_driver(isl7998x_i2c_driver);\n\nMODULE_DESCRIPTION(\"Intersil ISL7998x Analog to MIPI CSI-2/BT656 decoder\");\nMODULE_AUTHOR(\"Marek Vasut <marex@denx.de>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}