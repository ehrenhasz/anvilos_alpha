{
  "module_name": "cx25840-audio.c",
  "hash_id": "44b2815e3dbbb3b84118e04d4b27315ba3ee6ed1e8ac6fdb32d05b17b6a9062d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/i2c/cx25840/cx25840-audio.c",
  "human_readable_source": "\n \n\n\n#include <linux/videodev2.h>\n#include <linux/i2c.h>\n#include <media/v4l2-common.h>\n#include <media/drv-intf/cx25840.h>\n\n#include \"cx25840-core.h\"\n\n \n\nstatic int cx25840_set_audclk_freq(struct i2c_client *client, u32 freq)\n{\n\tstruct cx25840_state *state = to_state(i2c_get_clientdata(client));\n\n\tif (state->aud_input != CX25840_AUDIO_SERIAL) {\n\t\tswitch (freq) {\n\t\tcase 32000:\n\t\t\t \n\t\t\tcx25840_write4(client, 0x108, 0x1006040f);\n\n\t\t\t \n\n\t\t\t \n\t\t\tcx25840_write4(client, 0x110, 0x01bb39ee);\n\n\t\t\t \n\t\t\tcx25840_write(client, 0x127, 0x50);\n\n\t\t\tif (is_cx2583x(state))\n\t\t\t\tbreak;\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x0801f77f);\n\t\t\tcx25840_write4(client, 0x904, 0x0801f77f);\n\t\t\tcx25840_write4(client, 0x90c, 0x0801f77f);\n\t\t\tbreak;\n\n\t\tcase 44100:\n\t\t\t \n\t\t\tcx25840_write4(client, 0x108, 0x1009040f);\n\n\t\t\t \n\n\t\t\t \n\t\t\tcx25840_write4(client, 0x110, 0x00ec6bd6);\n\n\t\t\t \n\t\t\tcx25840_write(client, 0x127, 0x50);\n\n\t\t\tif (is_cx2583x(state))\n\t\t\t\tbreak;\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08016d59);\n\t\t\tcx25840_write4(client, 0x904, 0x08016d59);\n\t\t\tcx25840_write4(client, 0x90c, 0x08016d59);\n\t\t\tbreak;\n\n\t\tcase 48000:\n\t\t\t \n\t\t\tcx25840_write4(client, 0x108, 0x100a040f);\n\n\t\t\t \n\n\t\t\t \n\t\t\tcx25840_write4(client, 0x110, 0x0098d6e5);\n\n\t\t\t \n\t\t\tcx25840_write(client, 0x127, 0x50);\n\n\t\t\tif (is_cx2583x(state))\n\t\t\t\tbreak;\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x904, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x90c, 0x08014faa);\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tswitch (freq) {\n\t\tcase 32000:\n\t\t\t \n\t\t\tcx25840_write4(client, 0x108, 0x1e08040f);\n\n\t\t\t \n\n\t\t\t \n\t\t\tcx25840_write4(client, 0x110, 0x012a0869);\n\n\t\t\t \n\t\t\tcx25840_write(client, 0x127, 0x54);\n\n\t\t\tif (is_cx2583x(state))\n\t\t\t\tbreak;\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x8f8, 0x08010000);\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08020000);\n\t\t\tcx25840_write4(client, 0x904, 0x08020000);\n\t\t\tcx25840_write4(client, 0x90c, 0x08020000);\n\t\t\tbreak;\n\n\t\tcase 44100:\n\t\t\t \n\t\t\tcx25840_write4(client, 0x108, 0x1809040f);\n\n\t\t\t \n\n\t\t\t \n\t\t\tcx25840_write4(client, 0x110, 0x00ec6bd6);\n\n\t\t\t \n\t\t\tcx25840_write(client, 0x127, 0x50);\n\n\t\t\tif (is_cx2583x(state))\n\t\t\t\tbreak;\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x8f8, 0x080160cd);\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08017385);\n\t\t\tcx25840_write4(client, 0x904, 0x08017385);\n\t\t\tcx25840_write4(client, 0x90c, 0x08017385);\n\t\t\tbreak;\n\n\t\tcase 48000:\n\t\t\t \n\t\t\tcx25840_write4(client, 0x108, 0x180a040f);\n\n\t\t\t \n\n\t\t\t \n\t\t\tcx25840_write4(client, 0x110, 0x0098d6e5);\n\n\t\t\t \n\t\t\tcx25840_write(client, 0x127, 0x50);\n\n\t\t\tif (is_cx2583x(state))\n\t\t\t\tbreak;\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x8f8, 0x08018000);\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08015555);\n\t\t\tcx25840_write4(client, 0x904, 0x08015555);\n\t\t\tcx25840_write4(client, 0x90c, 0x08015555);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tstate->audclk_freq = freq;\n\n\treturn 0;\n}\n\nstatic inline int cx25836_set_audclk_freq(struct i2c_client *client, u32 freq)\n{\n\treturn cx25840_set_audclk_freq(client, freq);\n}\n\nstatic int cx23885_set_audclk_freq(struct i2c_client *client, u32 freq)\n{\n\tstruct cx25840_state *state = to_state(i2c_get_clientdata(client));\n\n\tif (state->aud_input != CX25840_AUDIO_SERIAL) {\n\t\tswitch (freq) {\n\t\tcase 32000:\n\t\tcase 44100:\n\t\tcase 48000:\n\t\t\t \n\t\t\t \n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tswitch (freq) {\n\t\tcase 32000:\n\t\tcase 44100:\n\t\t\t \n\t\t\t \n\t\t\tbreak;\n\n\t\tcase 48000:\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x8f8, 0x0801867c);\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x904, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x90c, 0x08014faa);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tstate->audclk_freq = freq;\n\n\treturn 0;\n}\n\nstatic int cx231xx_set_audclk_freq(struct i2c_client *client, u32 freq)\n{\n\tstruct cx25840_state *state = to_state(i2c_get_clientdata(client));\n\n\tif (state->aud_input != CX25840_AUDIO_SERIAL) {\n\t\tswitch (freq) {\n\t\tcase 32000:\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x0801f77f);\n\t\t\tcx25840_write4(client, 0x904, 0x0801f77f);\n\t\t\tcx25840_write4(client, 0x90c, 0x0801f77f);\n\t\t\tbreak;\n\n\t\tcase 44100:\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08016d59);\n\t\t\tcx25840_write4(client, 0x904, 0x08016d59);\n\t\t\tcx25840_write4(client, 0x90c, 0x08016d59);\n\t\t\tbreak;\n\n\t\tcase 48000:\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x904, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x90c, 0x08014faa);\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tswitch (freq) {\n\t\t \n\t\tcase 32000:\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x8f8, 0x08010000);\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08020000);\n\t\t\tcx25840_write4(client, 0x904, 0x08020000);\n\t\t\tcx25840_write4(client, 0x90c, 0x08020000);\n\t\t\tbreak;\n\n\t\tcase 44100:\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x8f8, 0x080160cd);\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08017385);\n\t\t\tcx25840_write4(client, 0x904, 0x08017385);\n\t\t\tcx25840_write4(client, 0x90c, 0x08017385);\n\t\t\tbreak;\n\n\t\tcase 48000:\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x8f8, 0x0801867c);\n\n\t\t\t \n\t\t\t \n\t\t\tcx25840_write4(client, 0x900, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x904, 0x08014faa);\n\t\t\tcx25840_write4(client, 0x90c, 0x08014faa);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tstate->audclk_freq = freq;\n\n\treturn 0;\n}\n\nstatic int set_audclk_freq(struct i2c_client *client, u32 freq)\n{\n\tstruct cx25840_state *state = to_state(i2c_get_clientdata(client));\n\n\tif (freq != 32000 && freq != 44100 && freq != 48000)\n\t\treturn -EINVAL;\n\n\tif (is_cx231xx(state))\n\t\treturn cx231xx_set_audclk_freq(client, freq);\n\n\tif (is_cx2388x(state))\n\t\treturn cx23885_set_audclk_freq(client, freq);\n\n\tif (is_cx2583x(state))\n\t\treturn cx25836_set_audclk_freq(client, freq);\n\n\treturn cx25840_set_audclk_freq(client, freq);\n}\n\nvoid cx25840_audio_set_path(struct i2c_client *client)\n{\n\tstruct cx25840_state *state = to_state(i2c_get_clientdata(client));\n\n\tif (!is_cx2583x(state)) {\n\t\t \n\t\tcx25840_and_or(client, 0x810, ~0x1, 0x01);\n\n\t\t \n\t\tcx25840_and_or(client, 0x803, ~0x10, 0);\n\n\t\t \n\t\tcx25840_write(client, 0x8d3, 0x1f);\n\n\t\tif (state->aud_input == CX25840_AUDIO_SERIAL) {\n\t\t\t \n\t\t\tcx25840_write4(client, 0x8d0, 0x01011012);\n\n\t\t\t \n\t\t} else {\n\t\t\t \n\t\t\tcx25840_write4(client, 0x8d0, 0x1f063870);\n\t\t}\n\t}\n\n\tset_audclk_freq(client, state->audclk_freq);\n\n\tif (!is_cx2583x(state)) {\n\t\tif (state->aud_input != CX25840_AUDIO_SERIAL) {\n\t\t\t \n\t\t\tcx25840_and_or(client, 0x803, ~0x10, 0x10);\n\t\t}\n\n\t\t \n\t\tcx25840_and_or(client, 0x810, ~0x1, 0x00);\n\n\t\t \n\t\tif (is_cx2388x(state) || is_cx231xx(state))\n\t\t\tcx25840_and_or(client, 0x803, ~0x10, 0x10);\n\t}\n}\n\nstatic void set_volume(struct i2c_client *client, int volume)\n{\n\tint vol;\n\n\t \n\tvol = volume >> 9;\n\n\t \n\tif (vol <= 23) {\n\t\tvol = 0;\n\t} else {\n\t\tvol -= 23;\n\t}\n\n\t \n\tcx25840_write(client, 0x8d4, 228 - (vol * 2));\n}\n\nstatic void set_balance(struct i2c_client *client, int balance)\n{\n\tint bal = balance >> 8;\n\tif (bal > 0x80) {\n\t\t \n\t\tcx25840_and_or(client, 0x8d5, 0x7f, 0x80);\n\t\t \n\t\tcx25840_and_or(client, 0x8d5, ~0x7f, bal & 0x7f);\n\t} else {\n\t\t \n\t\tcx25840_and_or(client, 0x8d5, 0x7f, 0x00);\n\t\t \n\t\tcx25840_and_or(client, 0x8d5, ~0x7f, 0x80 - bal);\n\t}\n}\n\nint cx25840_s_clock_freq(struct v4l2_subdev *sd, u32 freq)\n{\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\tstruct cx25840_state *state = to_state(sd);\n\tint retval;\n\n\tif (!is_cx2583x(state))\n\t\tcx25840_and_or(client, 0x810, ~0x1, 1);\n\tif (state->aud_input != CX25840_AUDIO_SERIAL) {\n\t\tcx25840_and_or(client, 0x803, ~0x10, 0);\n\t\tcx25840_write(client, 0x8d3, 0x1f);\n\t}\n\tretval = set_audclk_freq(client, freq);\n\tif (state->aud_input != CX25840_AUDIO_SERIAL)\n\t\tcx25840_and_or(client, 0x803, ~0x10, 0x10);\n\tif (!is_cx2583x(state))\n\t\tcx25840_and_or(client, 0x810, ~0x1, 0);\n\treturn retval;\n}\n\nstatic int cx25840_audio_s_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct v4l2_subdev *sd = to_sd(ctrl);\n\tstruct cx25840_state *state = to_state(sd);\n\tstruct i2c_client *client = v4l2_get_subdevdata(sd);\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_AUDIO_VOLUME:\n\t\tif (state->mute->val)\n\t\t\tset_volume(client, 0);\n\t\telse\n\t\t\tset_volume(client, state->volume->val);\n\t\tbreak;\n\tcase V4L2_CID_AUDIO_BASS:\n\t\t \n\t\tcx25840_and_or(client, 0x8d9, ~0x3f,\n\t\t\t\t\t48 - (ctrl->val * 48 / 0xffff));\n\t\tbreak;\n\tcase V4L2_CID_AUDIO_TREBLE:\n\t\t \n\t\tcx25840_and_or(client, 0x8db, ~0x3f,\n\t\t\t\t\t48 - (ctrl->val * 48 / 0xffff));\n\t\tbreak;\n\tcase V4L2_CID_AUDIO_BALANCE:\n\t\tset_balance(client, ctrl->val);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\nconst struct v4l2_ctrl_ops cx25840_audio_ctrl_ops = {\n\t.s_ctrl = cx25840_audio_s_ctrl,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}