{
  "module_name": "firedtv-rc.c",
  "hash_id": "2751b7886b2f1407a705f6b3897d390c7e47fc7e2fdb3b4d732d3cf604625ff8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/firewire/firedtv-rc.c",
  "human_readable_source": "\n \n\n#include <linux/bitops.h>\n#include <linux/input.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n\n#include \"firedtv.h\"\n\n \nstatic const u16 oldtable[] = {\n\n\t \n\n\tKEY_ESC,\n\tKEY_F9,\n\tKEY_1,\n\tKEY_2,\n\tKEY_3,\n\tKEY_4,\n\tKEY_5,\n\tKEY_6,\n\tKEY_7,\n\tKEY_8,\n\tKEY_9,\n\tKEY_I,\n\tKEY_0,\n\tKEY_ENTER,\n\tKEY_RED,\n\tKEY_UP,\n\tKEY_GREEN,\n\tKEY_F10,\n\tKEY_SPACE,\n\tKEY_F11,\n\tKEY_YELLOW,\n\tKEY_DOWN,\n\tKEY_BLUE,\n\tKEY_Z,\n\tKEY_P,\n\tKEY_PAGEDOWN,\n\tKEY_LEFT,\n\tKEY_W,\n\tKEY_RIGHT,\n\tKEY_P,\n\tKEY_M,\n\n\t \n\n\tKEY_R,\n\tKEY_V,\n\tKEY_C,\n};\n\n \nstatic const u16 keytable[] = {\n\n\t \n\n\t[0x00] = KEY_POWER,\n\t[0x01] = KEY_SLEEP,\n\t[0x02] = KEY_STOP,\n\t[0x03] = KEY_OK,\n\t[0x04] = KEY_RIGHT,\n\t[0x05] = KEY_1,\n\t[0x06] = KEY_2,\n\t[0x07] = KEY_3,\n\t[0x08] = KEY_LEFT,\n\t[0x09] = KEY_4,\n\t[0x0a] = KEY_5,\n\t[0x0b] = KEY_6,\n\t[0x0c] = KEY_UP,\n\t[0x0d] = KEY_7,\n\t[0x0e] = KEY_8,\n\t[0x0f] = KEY_9,\n\t[0x10] = KEY_DOWN,\n\t[0x11] = KEY_TITLE,\t \n\t[0x12] = KEY_0,\n\t[0x13] = KEY_F20,\t \n\t[0x14] = KEY_SCREEN,\t \n\t[0x15] = KEY_MUTE,\n\t[0x16] = KEY_SUBTITLE,\n\t[0x17] = KEY_RECORD,\n\t[0x18] = KEY_TEXT,\n\t[0x19] = KEY_AUDIO,\n\t[0x1a] = KEY_RED,\n\t[0x1b] = KEY_PREVIOUS,\n\t[0x1c] = KEY_REWIND,\n\t[0x1d] = KEY_PLAYPAUSE,\n\t[0x1e] = KEY_NEXT,\n\t[0x1f] = KEY_VOLUMEUP,\n\n\t \n\n\t[0x20] = KEY_CHANNELUP,\n\t[0x21] = KEY_F21,\t \n\t[0x22] = KEY_TV,\n\t[0x23] = KEY_DVD,\n\t[0x24] = KEY_VCR,\n\t[0x25] = KEY_AUX,\n\t[0x26] = KEY_GREEN,\n\t[0x27] = KEY_YELLOW,\n\t[0x28] = KEY_BLUE,\n\t[0x29] = KEY_CHANNEL,\t \n\t[0x2a] = KEY_VENDOR,\t \n\t[0x2b] = KEY_VOLUMEDOWN,\n\t[0x2c] = KEY_CHANNELDOWN,\n\t[0x2d] = KEY_LAST,\n\t[0x2e] = KEY_INFO,\n\t[0x2f] = KEY_FORWARD,\n\t[0x30] = KEY_LIST,\n\t[0x31] = KEY_FAVORITES,\n\t[0x32] = KEY_MENU,\n\t[0x33] = KEY_EPG,\n\t[0x34] = KEY_EXIT,\n};\n\nint fdtv_register_rc(struct firedtv *fdtv, struct device *dev)\n{\n\tstruct input_dev *idev;\n\tint i, err;\n\n\tidev = input_allocate_device();\n\tif (!idev)\n\t\treturn -ENOMEM;\n\n\tfdtv->remote_ctrl_dev = idev;\n\tidev->name = \"FireDTV remote control\";\n\tidev->dev.parent = dev;\n\tidev->evbit[0] = BIT_MASK(EV_KEY);\n\tidev->keycode = kmemdup(keytable, sizeof(keytable), GFP_KERNEL);\n\tif (!idev->keycode) {\n\t\terr = -ENOMEM;\n\t\tgoto fail;\n\t}\n\tidev->keycodesize = sizeof(keytable[0]);\n\tidev->keycodemax = ARRAY_SIZE(keytable);\n\n\tfor (i = 0; i < ARRAY_SIZE(keytable); i++)\n\t\tset_bit(keytable[i], idev->keybit);\n\n\terr = input_register_device(idev);\n\tif (err)\n\t\tgoto fail_free_keymap;\n\n\treturn 0;\n\nfail_free_keymap:\n\tkfree(idev->keycode);\nfail:\n\tinput_free_device(idev);\n\treturn err;\n}\n\nvoid fdtv_unregister_rc(struct firedtv *fdtv)\n{\n\tcancel_work_sync(&fdtv->remote_ctrl_work);\n\tkfree(fdtv->remote_ctrl_dev->keycode);\n\tinput_unregister_device(fdtv->remote_ctrl_dev);\n}\n\nvoid fdtv_handle_rc(struct firedtv *fdtv, unsigned int code)\n{\n\tstruct input_dev *idev = fdtv->remote_ctrl_dev;\n\tu16 *keycode = idev->keycode;\n\n\tif (code >= 0x0300 && code <= 0x031f)\n\t\tcode = keycode[code - 0x0300];\n\telse if (code >= 0x0340 && code <= 0x0354)\n\t\tcode = keycode[code - 0x0320];\n\telse if (code >= 0x4501 && code <= 0x451f)\n\t\tcode = oldtable[code - 0x4501];\n\telse if (code >= 0x4540 && code <= 0x4542)\n\t\tcode = oldtable[code - 0x4521];\n\telse {\n\t\tdev_dbg(fdtv->device,\n\t\t\t\"invalid key code 0x%04x from remote control\\n\",\n\t\t\tcode);\n\t\treturn;\n\t}\n\n\tinput_report_key(idev, code, 1);\n\tinput_sync(idev);\n\tinput_report_key(idev, code, 0);\n\tinput_sync(idev);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}