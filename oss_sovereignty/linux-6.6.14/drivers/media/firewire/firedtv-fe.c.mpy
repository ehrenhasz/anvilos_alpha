{
  "module_name": "firedtv-fe.c",
  "hash_id": "a17dd3740f60fc3f23addace742eb216b19f9ea5fcc35b7ebba155b6afebcc3f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/firewire/firedtv-fe.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/types.h>\n\n#include <media/dvb_frontend.h>\n\n#include \"firedtv.h\"\n\nstatic int fdtv_dvb_init(struct dvb_frontend *fe)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\tint err;\n\n\t \n\tfdtv->isochannel = fdtv->adapter.num;\n\n\terr = cmp_establish_pp_connection(fdtv, fdtv->subunit,\n\t\t\t\t\t  fdtv->isochannel);\n\tif (err) {\n\t\tdev_err(fdtv->device,\n\t\t\t\"could not establish point to point connection\\n\");\n\t\treturn err;\n\t}\n\n\treturn fdtv_start_iso(fdtv);\n}\n\nstatic int fdtv_sleep(struct dvb_frontend *fe)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\n\tfdtv_stop_iso(fdtv);\n\tcmp_break_pp_connection(fdtv, fdtv->subunit, fdtv->isochannel);\n\tfdtv->isochannel = -1;\n\treturn 0;\n}\n\n#define LNBCONTROL_DONTCARE 0xff\n\nstatic int fdtv_diseqc_send_master_cmd(struct dvb_frontend *fe,\n\t\t\t\t       struct dvb_diseqc_master_cmd *cmd)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\n\treturn avc_lnb_control(fdtv, LNBCONTROL_DONTCARE, LNBCONTROL_DONTCARE,\n\t\t\t       LNBCONTROL_DONTCARE, 1, cmd);\n}\n\nstatic int fdtv_diseqc_send_burst(struct dvb_frontend *fe,\n\t\t\t\t  enum fe_sec_mini_cmd minicmd)\n{\n\treturn 0;\n}\n\nstatic int fdtv_set_tone(struct dvb_frontend *fe, enum fe_sec_tone_mode tone)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\n\tfdtv->tone = tone;\n\treturn 0;\n}\n\nstatic int fdtv_set_voltage(struct dvb_frontend *fe,\n\t\t\t    enum fe_sec_voltage voltage)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\n\tfdtv->voltage = voltage;\n\treturn 0;\n}\n\nstatic int fdtv_read_status(struct dvb_frontend *fe, enum fe_status *status)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\tstruct firedtv_tuner_status stat;\n\n\tif (avc_tuner_status(fdtv, &stat))\n\t\treturn -EINVAL;\n\n\tif (stat.no_rf)\n\t\t*status = 0;\n\telse\n\t\t*status = FE_HAS_SIGNAL | FE_HAS_VITERBI | FE_HAS_SYNC |\n\t\t\t  FE_HAS_CARRIER | FE_HAS_LOCK;\n\treturn 0;\n}\n\nstatic int fdtv_read_ber(struct dvb_frontend *fe, u32 *ber)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\tstruct firedtv_tuner_status stat;\n\n\tif (avc_tuner_status(fdtv, &stat))\n\t\treturn -EINVAL;\n\n\t*ber = stat.ber;\n\treturn 0;\n}\n\nstatic int fdtv_read_signal_strength(struct dvb_frontend *fe, u16 *strength)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\tstruct firedtv_tuner_status stat;\n\n\tif (avc_tuner_status(fdtv, &stat))\n\t\treturn -EINVAL;\n\n\t*strength = stat.signal_strength << 8;\n\treturn 0;\n}\n\nstatic int fdtv_read_snr(struct dvb_frontend *fe, u16 *snr)\n{\n\tstruct firedtv *fdtv = fe->sec_priv;\n\tstruct firedtv_tuner_status stat;\n\n\tif (avc_tuner_status(fdtv, &stat))\n\t\treturn -EINVAL;\n\n\t \n\t*snr = stat.carrier_noise_ratio * 257;\n\treturn 0;\n}\n\nstatic int fdtv_read_uncorrected_blocks(struct dvb_frontend *fe, u32 *ucblocks)\n{\n\treturn -EOPNOTSUPP;\n}\n\nstatic int fdtv_set_frontend(struct dvb_frontend *fe)\n{\n\tstruct dtv_frontend_properties *p = &fe->dtv_property_cache;\n\tstruct firedtv *fdtv = fe->sec_priv;\n\n\treturn avc_tuner_dsd(fdtv, p);\n}\n\nvoid fdtv_frontend_init(struct firedtv *fdtv, const char *name)\n{\n\tstruct dvb_frontend_ops *ops = &fdtv->fe.ops;\n\tstruct dvb_frontend_internal_info *fi = &ops->info;\n\n\tops->init\t\t\t= fdtv_dvb_init;\n\tops->sleep\t\t\t= fdtv_sleep;\n\n\tops->set_frontend\t\t= fdtv_set_frontend;\n\n\tops->read_status\t\t= fdtv_read_status;\n\tops->read_ber\t\t\t= fdtv_read_ber;\n\tops->read_signal_strength\t= fdtv_read_signal_strength;\n\tops->read_snr\t\t\t= fdtv_read_snr;\n\tops->read_ucblocks\t\t= fdtv_read_uncorrected_blocks;\n\n\tops->diseqc_send_master_cmd\t= fdtv_diseqc_send_master_cmd;\n\tops->diseqc_send_burst\t\t= fdtv_diseqc_send_burst;\n\tops->set_tone\t\t\t= fdtv_set_tone;\n\tops->set_voltage\t\t= fdtv_set_voltage;\n\n\tswitch (fdtv->type) {\n\tcase FIREDTV_DVB_S:\n\t\tops->delsys[0]\t\t= SYS_DVBS;\n\n\t\tfi->frequency_min_hz\t=   950 * MHz;\n\t\tfi->frequency_max_hz\t=  2150 * MHz;\n\t\tfi->frequency_stepsize_hz = 125 * kHz;\n\t\tfi->symbol_rate_min\t= 1000000;\n\t\tfi->symbol_rate_max\t= 40000000;\n\n\t\tfi->caps\t\t= FE_CAN_INVERSION_AUTO |\n\t\t\t\t\t  FE_CAN_FEC_1_2\t|\n\t\t\t\t\t  FE_CAN_FEC_2_3\t|\n\t\t\t\t\t  FE_CAN_FEC_3_4\t|\n\t\t\t\t\t  FE_CAN_FEC_5_6\t|\n\t\t\t\t\t  FE_CAN_FEC_7_8\t|\n\t\t\t\t\t  FE_CAN_FEC_AUTO\t|\n\t\t\t\t\t  FE_CAN_QPSK;\n\t\tbreak;\n\n\tcase FIREDTV_DVB_S2:\n\t\tops->delsys[0]\t\t= SYS_DVBS;\n\t\tops->delsys[1]\t\t= SYS_DVBS2;\n\n\t\tfi->frequency_min_hz\t=   950 * MHz;\n\t\tfi->frequency_max_hz\t=  2150 * MHz;\n\t\tfi->frequency_stepsize_hz = 125 * kHz;\n\t\tfi->symbol_rate_min\t= 1000000;\n\t\tfi->symbol_rate_max\t= 40000000;\n\n\t\tfi->caps\t\t= FE_CAN_INVERSION_AUTO |\n\t\t\t\t\t  FE_CAN_FEC_1_2        |\n\t\t\t\t\t  FE_CAN_FEC_2_3        |\n\t\t\t\t\t  FE_CAN_FEC_3_4        |\n\t\t\t\t\t  FE_CAN_FEC_5_6        |\n\t\t\t\t\t  FE_CAN_FEC_7_8        |\n\t\t\t\t\t  FE_CAN_FEC_AUTO       |\n\t\t\t\t\t  FE_CAN_QPSK           |\n\t\t\t\t\t  FE_CAN_2G_MODULATION;\n\t\tbreak;\n\n\tcase FIREDTV_DVB_C:\n\t\tops->delsys[0]\t\t= SYS_DVBC_ANNEX_A;\n\n\t\tfi->frequency_min_hz\t=      47 * MHz;\n\t\tfi->frequency_max_hz\t=     866 * MHz;\n\t\tfi->frequency_stepsize_hz = 62500;\n\t\tfi->symbol_rate_min\t= 870000;\n\t\tfi->symbol_rate_max\t= 6900000;\n\n\t\tfi->caps\t\t= FE_CAN_INVERSION_AUTO |\n\t\t\t\t\t  FE_CAN_QAM_16\t\t|\n\t\t\t\t\t  FE_CAN_QAM_32\t\t|\n\t\t\t\t\t  FE_CAN_QAM_64\t\t|\n\t\t\t\t\t  FE_CAN_QAM_128\t|\n\t\t\t\t\t  FE_CAN_QAM_256\t|\n\t\t\t\t\t  FE_CAN_QAM_AUTO;\n\t\tbreak;\n\n\tcase FIREDTV_DVB_T:\n\t\tops->delsys[0]\t\t= SYS_DVBT;\n\n\t\tfi->frequency_min_hz\t=  49 * MHz;\n\t\tfi->frequency_max_hz\t= 861 * MHz;\n\t\tfi->frequency_stepsize_hz = 62500;\n\n\t\tfi->caps\t\t= FE_CAN_INVERSION_AUTO\t\t|\n\t\t\t\t\t  FE_CAN_FEC_2_3\t\t|\n\t\t\t\t\t  FE_CAN_TRANSMISSION_MODE_AUTO |\n\t\t\t\t\t  FE_CAN_GUARD_INTERVAL_AUTO\t|\n\t\t\t\t\t  FE_CAN_HIERARCHY_AUTO;\n\t\tbreak;\n\n\tdefault:\n\t\tdev_err(fdtv->device, \"no frontend for model type %d\\n\",\n\t\t\tfdtv->type);\n\t}\n\tstrscpy(fi->name, name, sizeof(fi->name));\n\n\tfdtv->fe.dvb = &fdtv->adapter;\n\tfdtv->fe.sec_priv = fdtv;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}