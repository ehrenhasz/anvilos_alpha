{
  "module_name": "img-ir-sony.c",
  "hash_id": "5c0b4ae7346eb9cb996b9555716b52e5dab53955a440f7eaf92f0e09ac01fcaa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/rc/img-ir/img-ir-sony.c",
  "human_readable_source": "\n \n\n#include \"img-ir-hw.h\"\n\n \nstatic int img_ir_sony_scancode(int len, u64 raw, u64 enabled_protocols,\n\t\t\t\tstruct img_ir_scancode_req *request)\n{\n\tunsigned int dev, subdev, func;\n\n\tswitch (len) {\n\tcase 12:\n\t\tif (!(enabled_protocols & RC_PROTO_BIT_SONY12))\n\t\t\treturn -EINVAL;\n\t\tfunc   = raw & 0x7f;\t \n\t\traw    >>= 7;\n\t\tdev    = raw & 0x1f;\t \n\t\tsubdev = 0;\n\t\trequest->protocol = RC_PROTO_SONY12;\n\t\tbreak;\n\tcase 15:\n\t\tif (!(enabled_protocols & RC_PROTO_BIT_SONY15))\n\t\t\treturn -EINVAL;\n\t\tfunc   = raw & 0x7f;\t \n\t\traw    >>= 7;\n\t\tdev    = raw & 0xff;\t \n\t\tsubdev = 0;\n\t\trequest->protocol = RC_PROTO_SONY15;\n\t\tbreak;\n\tcase 20:\n\t\tif (!(enabled_protocols & RC_PROTO_BIT_SONY20))\n\t\t\treturn -EINVAL;\n\t\tfunc   = raw & 0x7f;\t \n\t\traw    >>= 7;\n\t\tdev    = raw & 0x1f;\t \n\t\traw    >>= 5;\n\t\tsubdev = raw & 0xff;\t \n\t\trequest->protocol = RC_PROTO_SONY20;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\trequest->scancode = dev << 16 | subdev << 8 | func;\n\treturn IMG_IR_SCANCODE;\n}\n\n \nstatic int img_ir_sony_filter(const struct rc_scancode_filter *in,\n\t\t\t      struct img_ir_filter *out, u64 protocols)\n{\n\tunsigned int dev, subdev, func;\n\tunsigned int dev_m, subdev_m, func_m;\n\tunsigned int len = 0;\n\n\tdev      = (in->data >> 16) & 0xff;\n\tdev_m    = (in->mask >> 16) & 0xff;\n\tsubdev   = (in->data >> 8)  & 0xff;\n\tsubdev_m = (in->mask >> 8)  & 0xff;\n\tfunc     = (in->data >> 0)  & 0x7f;\n\tfunc_m   = (in->mask >> 0)  & 0x7f;\n\n\tprotocols &= RC_PROTO_BIT_SONY12 | RC_PROTO_BIT_SONY15 |\n\t\t\t\t\t\t\tRC_PROTO_BIT_SONY20;\n\n\t \n\tif (!is_power_of_2(protocols)) {\n\t\tif (subdev & subdev_m)\n\t\t\tprotocols = RC_PROTO_BIT_SONY20;\n\t\telse if (dev & dev_m & 0xe0)\n\t\t\tprotocols = RC_PROTO_BIT_SONY15;\n\t\telse\n\t\t\tprotocols = RC_PROTO_BIT_SONY12;\n\t}\n\n\tif (protocols == RC_PROTO_BIT_SONY20) {\n\t\t \n\t\tif (dev & dev_m & 0xe0)\n\t\t\treturn -EINVAL;\n\t\tlen = 20;\n\t\tdev_m &= 0x1f;\n\t} else if (protocols == RC_PROTO_BIT_SONY15) {\n\t\tlen = 15;\n\t\tsubdev_m = 0;\n\t} else {\n\t\t \n\t\tsubdev_m &= (dev_m >> 5) | 0xf8;\n\t\tdev_m &= 0x1f;\n\t}\n\n\t \n\tdev &= dev_m;\n\tsubdev &= subdev_m;\n\n\t \n\tout->data = func          |\n\t\t    dev      << 7 |\n\t\t    subdev   << 15;\n\tout->mask = func_m        |\n\t\t    dev_m    << 7 |\n\t\t    subdev_m << 15;\n\n\tif (len) {\n\t\tout->minlen = len;\n\t\tout->maxlen = len;\n\t}\n\treturn 0;\n}\n\n \nstruct img_ir_decoder img_ir_sony = {\n\t.type = RC_PROTO_BIT_SONY12 | RC_PROTO_BIT_SONY15 | RC_PROTO_BIT_SONY20,\n\t.control = {\n\t\t.decoden = 1,\n\t\t.code_type = IMG_IR_CODETYPE_PULSELEN,\n\t},\n\t \n\t.unit = 600000,  \n\t.timings = {\n\t\t \n\t\t.ldr = {\n\t\t\t.pulse = { 4\t  },\n\t\t\t.space = { 1\t  },\n\t\t},\n\t\t \n\t\t.s00 = {\n\t\t\t.pulse = { 1\t  },\n\t\t\t.space = { 1\t  },\n\t\t},\n\t\t \n\t\t.s01 = {\n\t\t\t.pulse = { 2\t  },\n\t\t\t.space = { 1\t  },\n\t\t},\n\t\t \n\t\t.ft = {\n\t\t\t.minlen = 12,\n\t\t\t.maxlen = 20,\n\t\t\t.ft_min = 10,\t \n\t\t},\n\t},\n\t \n\t.scancode = img_ir_sony_scancode,\n\t.filter = img_ir_sony_filter,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}