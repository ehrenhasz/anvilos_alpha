{
  "module_name": "tuner-i2c.h",
  "hash_id": "e548b060419d1455d0b79dbeabf5919e0b0fe8777667e3605b65c9db8609a178",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/tuners/tuner-i2c.h",
  "human_readable_source": " \n \n\n#ifndef __TUNER_I2C_H__\n#define __TUNER_I2C_H__\n\n#include <linux/i2c.h>\n#include <linux/slab.h>\n\nstruct tuner_i2c_props {\n\tu8 addr;\n\tstruct i2c_adapter *adap;\n\n\t \n\tint count;\n\tchar *name;\n};\n\nstatic inline int tuner_i2c_xfer_send(struct tuner_i2c_props *props,\n\t\t\t\t      unsigned char *buf, int len)\n{\n\tstruct i2c_msg msg = { .addr = props->addr, .flags = 0,\n\t\t\t       .buf = buf, .len = len };\n\tint ret = i2c_transfer(props->adap, &msg, 1);\n\n\treturn (ret == 1) ? len : ret;\n}\n\nstatic inline int tuner_i2c_xfer_recv(struct tuner_i2c_props *props,\n\t\t\t\t      unsigned char *buf, int len)\n{\n\tstruct i2c_msg msg = { .addr = props->addr, .flags = I2C_M_RD,\n\t\t\t       .buf = buf, .len = len };\n\tint ret = i2c_transfer(props->adap, &msg, 1);\n\n\treturn (ret == 1) ? len : ret;\n}\n\nstatic inline int tuner_i2c_xfer_send_recv(struct tuner_i2c_props *props,\n\t\t\t\t\t   unsigned char *obuf, int olen,\n\t\t\t\t\t   unsigned char *ibuf, int ilen)\n{\n\tstruct i2c_msg msg[2] = { { .addr = props->addr, .flags = 0,\n\t\t\t\t    .buf = obuf, .len = olen },\n\t\t\t\t  { .addr = props->addr, .flags = I2C_M_RD,\n\t\t\t\t    .buf = ibuf, .len = ilen } };\n\tint ret = i2c_transfer(props->adap, msg, 2);\n\n\treturn (ret == 2) ? ilen : ret;\n}\n\n \n\n#define tuner_printk(kernlvl, i2cprops, fmt, arg...) do {\t\t\\\n\tprintk(kernlvl \"%s %d-%04x: \" fmt, i2cprops.name,\t\t\\\n\t\t\ti2cprops.adap ?\t\t\t\t\t\\\n\t\t\t\ti2c_adapter_id(i2cprops.adap) : -1,\t\\\n\t\t\ti2cprops.addr, ##arg);\t\t\t\t\\\n\t } while (0)\n\n \n\n#define __tuner_warn(i2cprops, fmt, arg...) do {\t\t\t\\\n\ttuner_printk(KERN_WARNING, i2cprops, fmt, ##arg);\t\t\\\n\t} while (0)\n\n#define __tuner_info(i2cprops, fmt, arg...) do {\t\t\t\\\n\ttuner_printk(KERN_INFO, i2cprops, fmt, ##arg);\t\t\t\\\n\t} while (0)\n\n#define __tuner_err(i2cprops, fmt, arg...) do {\t\t\t\t\\\n\ttuner_printk(KERN_ERR, i2cprops, fmt, ##arg);\t\t\t\\\n\t} while (0)\n\n#define __tuner_dbg(i2cprops, fmt, arg...) do {\t\t\t\t\\\n\tif ((debug))\t\t\t\t\t\t\t\\\n\t\ttuner_printk(KERN_DEBUG, i2cprops, fmt, ##arg);\t\t\\\n\t} while (0)\n\n#define tuner_warn(fmt, arg...) __tuner_warn(priv->i2c_props, fmt, ##arg)\n#define tuner_info(fmt, arg...) __tuner_info(priv->i2c_props, fmt, ##arg)\n#define tuner_err(fmt, arg...) __tuner_err(priv->i2c_props, fmt, ##arg)\n#define tuner_dbg(fmt, arg...) __tuner_dbg(priv->i2c_props, fmt, ##arg)\n\n \n\n \n\n#define hybrid_tuner_request_state(type, state, list, i2cadap, i2caddr, devname)\\\n({\t\t\t\t\t\t\t\t\t\\\n\tint __ret = 0;\t\t\t\t\t\t\t\\\n\tlist_for_each_entry(state, &list, hybrid_tuner_instance_list) {\t\\\n\t\tif (((i2cadap) && (state->i2c_props.adap)) &&\t\t\\\n\t\t    ((i2c_adapter_id(state->i2c_props.adap) ==\t\t\\\n\t\t      i2c_adapter_id(i2cadap)) &&\t\t\t\\\n\t\t     (i2caddr == state->i2c_props.addr))) {\t\t\\\n\t\t\t__tuner_info(state->i2c_props,\t\t\t\\\n\t\t\t\t     \"attaching existing instance\\n\");\t\\\n\t\t\tstate->i2c_props.count++;\t\t\t\\\n\t\t\t__ret = state->i2c_props.count;\t\t\t\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tif (0 == __ret) {\t\t\t\t\t\t\\\n\t\tstate = kzalloc(sizeof(type), GFP_KERNEL);\t\t\\\n\t\tif (!state) {\t\t\t\t\t\t\\\n\t\t\t__ret = -ENOMEM;\t\t\t\t\\\n\t\t\tgoto __fail;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\tstate->i2c_props.addr = i2caddr;\t\t\t\\\n\t\tstate->i2c_props.adap = i2cadap;\t\t\t\\\n\t\tstate->i2c_props.name = devname;\t\t\t\\\n\t\t__tuner_info(state->i2c_props,\t\t\t\t\\\n\t\t\t     \"creating new instance\\n\");\t\t\\\n\t\tlist_add_tail(&state->hybrid_tuner_instance_list, &list);\\\n\t\tstate->i2c_props.count++;\t\t\t\t\\\n\t\t__ret = state->i2c_props.count;\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n__fail:\t\t\t\t\t\t\t\t\t\\\n\t__ret;\t\t\t\t\t\t\t\t\\\n})\n\n#define hybrid_tuner_release_state(state)\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tint __ret;\t\t\t\t\t\t\t\\\n\tstate->i2c_props.count--;\t\t\t\t\t\\\n\t__ret = state->i2c_props.count;\t\t\t\t\t\\\n\tif (!state->i2c_props.count) {\t\t\t\t\t\\\n\t\t__tuner_info(state->i2c_props, \"destroying instance\\n\");\\\n\t\tlist_del(&state->hybrid_tuner_instance_list);\t\t\\\n\t\tkfree(state);\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t__ret;\t\t\t\t\t\t\t\t\\\n})\n\n#define hybrid_tuner_report_instance_count(state)\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tint __ret = 0;\t\t\t\t\t\t\t\\\n\tif (state)\t\t\t\t\t\t\t\\\n\t\t__ret = state->i2c_props.count;\t\t\t\t\\\n\t__ret;\t\t\t\t\t\t\t\t\\\n})\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}