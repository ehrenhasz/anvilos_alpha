{
  "module_name": "tda9887.c",
  "hash_id": "b353eda6f0a9b7b02773520feca305c5797d199219f72038a27e4560cb8706af",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/tuners/tda9887.c",
  "human_readable_source": "\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/i2c.h>\n#include <linux/types.h>\n#include <linux/init.h>\n#include <linux/errno.h>\n#include <linux/delay.h>\n#include <linux/videodev2.h>\n#include <media/v4l2-common.h>\n#include <media/tuner.h>\n#include \"tuner-i2c.h\"\n#include \"tda9887.h\"\n\n\n \n\nstatic int debug;\nmodule_param(debug, int, 0644);\nMODULE_PARM_DESC(debug, \"enable verbose debug messages\");\n\nstatic DEFINE_MUTEX(tda9887_list_mutex);\nstatic LIST_HEAD(hybrid_tuner_instance_list);\n\nstruct tda9887_priv {\n\tstruct tuner_i2c_props i2c_props;\n\tstruct list_head hybrid_tuner_instance_list;\n\n\tunsigned char\t   data[4];\n\tunsigned int       config;\n\tunsigned int       mode;\n\tunsigned int       audmode;\n\tv4l2_std_id        std;\n\n\tbool               standby;\n};\n\n \n\n#define UNSET       (-1U)\n\nstruct tvnorm {\n\tv4l2_std_id       std;\n\tchar              *name;\n\tunsigned char     b;\n\tunsigned char     c;\n\tunsigned char     e;\n};\n\n \n\n\n\n\n\n\n#define cVideoTrapBypassOFF     0x00    \n#define cVideoTrapBypassON      0x01    \n\n#define cAutoMuteFmInactive     0x00    \n#define cAutoMuteFmActive       0x02    \n\n#define cIntercarrier           0x00    \n#define cQSS                    0x04    \n\n#define cPositiveAmTV           0x00    \n#define cFmRadio                0x08    \n#define cNegativeFmTV           0x10    \n\n\n#define cForcedMuteAudioON      0x20    \n#define cForcedMuteAudioOFF     0x00    \n\n#define cOutputPort1Active      0x00    \n#define cOutputPort1Inactive    0x40    \n\n#define cOutputPort2Active      0x00    \n#define cOutputPort2Inactive    0x80    \n\n\n\n#define cDeemphasisOFF          0x00    \n#define cDeemphasisON           0x20    \n\n#define cDeemphasis75           0x00    \n#define cDeemphasis50           0x40    \n\n#define cAudioGain0             0x00    \n#define cAudioGain6             0x80    \n\n#define cTopMask                0x1f    \n#define cTopDefault\t\t0x10\t\n\n\n#define cAudioIF_4_5             0x00    \n#define cAudioIF_5_5             0x01    \n#define cAudioIF_6_0             0x02    \n#define cAudioIF_6_5             0x03    \n\n\n#define cVideoIFMask\t\t0x1c\t\n \n#define cVideoIF_58_75           0x00    \n#define cVideoIF_45_75           0x04    \n#define cVideoIF_38_90           0x08    \n#define cVideoIF_38_00           0x0C    \n#define cVideoIF_33_90           0x10    \n#define cVideoIF_33_40           0x14    \n#define cRadioIF_45_75           0x18    \n#define cRadioIF_38_90           0x1C    \n\n \n#define cRadioIF_33_30\t\t0x00\t\n#define cRadioIF_41_30\t\t0x04\t\n\n \n#define cRadioAGC_SIF\t\t0x00\t\n#define cRadioAGC_FM\t\t0x08\t\n\n#define cTunerGainNormal         0x00    \n#define cTunerGainLow            0x20    \n\n#define cGating_18               0x00    \n#define cGating_36               0x40    \n\n#define cAgcOutON                0x80    \n#define cAgcOutOFF               0x00    \n\n \n\nstatic struct tvnorm tvnorms[] = {\n\t{\n\t\t.std   = V4L2_STD_PAL_BG | V4L2_STD_PAL_H | V4L2_STD_PAL_N,\n\t\t.name  = \"PAL-BGHN\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cDeemphasisON  |\n\t\t\t   cDeemphasis50  |\n\t\t\t   cTopDefault),\n\t\t.e     = ( cGating_36     |\n\t\t\t   cAudioIF_5_5   |\n\t\t\t   cVideoIF_38_90 ),\n\t},{\n\t\t.std   = V4L2_STD_PAL_I,\n\t\t.name  = \"PAL-I\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cDeemphasisON  |\n\t\t\t   cDeemphasis50  |\n\t\t\t   cTopDefault),\n\t\t.e     = ( cGating_36     |\n\t\t\t   cAudioIF_6_0   |\n\t\t\t   cVideoIF_38_90 ),\n\t},{\n\t\t.std   = V4L2_STD_PAL_DK,\n\t\t.name  = \"PAL-DK\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cDeemphasisON  |\n\t\t\t   cDeemphasis50  |\n\t\t\t   cTopDefault),\n\t\t.e     = ( cGating_36     |\n\t\t\t   cAudioIF_6_5   |\n\t\t\t   cVideoIF_38_90 ),\n\t},{\n\t\t.std   = V4L2_STD_PAL_M | V4L2_STD_PAL_Nc,\n\t\t.name  = \"PAL-M/Nc\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cDeemphasisON  |\n\t\t\t   cDeemphasis75  |\n\t\t\t   cTopDefault),\n\t\t.e     = ( cGating_36     |\n\t\t\t   cAudioIF_4_5   |\n\t\t\t   cVideoIF_45_75 ),\n\t},{\n\t\t.std   = V4L2_STD_SECAM_B | V4L2_STD_SECAM_G | V4L2_STD_SECAM_H,\n\t\t.name  = \"SECAM-BGH\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cTopDefault),\n\t\t.e     = ( cAudioIF_5_5   |\n\t\t\t   cVideoIF_38_90 ),\n\t},{\n\t\t.std   = V4L2_STD_SECAM_L,\n\t\t.name  = \"SECAM-L\",\n\t\t.b     = ( cPositiveAmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cTopDefault),\n\t\t.e     = ( cGating_36\t  |\n\t\t\t   cAudioIF_6_5   |\n\t\t\t   cVideoIF_38_90 ),\n\t},{\n\t\t.std   = V4L2_STD_SECAM_LC,\n\t\t.name  = \"SECAM-L'\",\n\t\t.b     = ( cOutputPort2Inactive |\n\t\t\t   cPositiveAmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cTopDefault),\n\t\t.e     = ( cGating_36\t  |\n\t\t\t   cAudioIF_6_5   |\n\t\t\t   cVideoIF_33_90 ),\n\t},{\n\t\t.std   = V4L2_STD_SECAM_DK,\n\t\t.name  = \"SECAM-DK\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cDeemphasisON  |\n\t\t\t   cDeemphasis50  |\n\t\t\t   cTopDefault),\n\t\t.e     = ( cGating_36     |\n\t\t\t   cAudioIF_6_5   |\n\t\t\t   cVideoIF_38_90 ),\n\t},{\n\t\t.std   = V4L2_STD_NTSC_M | V4L2_STD_NTSC_M_KR,\n\t\t.name  = \"NTSC-M\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cDeemphasisON  |\n\t\t\t   cDeemphasis75  |\n\t\t\t   cTopDefault),\n\t\t.e     = ( cGating_36     |\n\t\t\t   cAudioIF_4_5   |\n\t\t\t   cVideoIF_45_75 ),\n\t},{\n\t\t.std   = V4L2_STD_NTSC_M_JP,\n\t\t.name  = \"NTSC-M-JP\",\n\t\t.b     = ( cNegativeFmTV  |\n\t\t\t   cQSS           ),\n\t\t.c     = ( cDeemphasisON  |\n\t\t\t   cDeemphasis50  |\n\t\t\t   cTopDefault),\n\t\t.e     = ( cGating_36     |\n\t\t\t   cAudioIF_4_5   |\n\t\t\t   cVideoIF_58_75 ),\n\t}\n};\n\nstatic struct tvnorm radio_stereo = {\n\t.name = \"Radio Stereo\",\n\t.b    = ( cFmRadio       |\n\t\t  cQSS           ),\n\t.c    = ( cDeemphasisOFF |\n\t\t  cAudioGain6    |\n\t\t  cTopDefault),\n\t.e    = ( cTunerGainLow  |\n\t\t  cAudioIF_5_5   |\n\t\t  cRadioIF_38_90 ),\n};\n\nstatic struct tvnorm radio_mono = {\n\t.name = \"Radio Mono\",\n\t.b    = ( cFmRadio       |\n\t\t  cQSS           ),\n\t.c    = ( cDeemphasisON  |\n\t\t  cDeemphasis75  |\n\t\t  cTopDefault),\n\t.e    = ( cTunerGainLow  |\n\t\t  cAudioIF_5_5   |\n\t\t  cRadioIF_38_90 ),\n};\n\n \n\nstatic void dump_read_message(struct dvb_frontend *fe, unsigned char *buf)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\n\tstatic char *afc[16] = {\n\t\t\"- 12.5 kHz\",\n\t\t\"- 37.5 kHz\",\n\t\t\"- 62.5 kHz\",\n\t\t\"- 87.5 kHz\",\n\t\t\"-112.5 kHz\",\n\t\t\"-137.5 kHz\",\n\t\t\"-162.5 kHz\",\n\t\t\"-187.5 kHz [min]\",\n\t\t\"+187.5 kHz [max]\",\n\t\t\"+162.5 kHz\",\n\t\t\"+137.5 kHz\",\n\t\t\"+112.5 kHz\",\n\t\t\"+ 87.5 kHz\",\n\t\t\"+ 62.5 kHz\",\n\t\t\"+ 37.5 kHz\",\n\t\t\"+ 12.5 kHz\",\n\t};\n\ttuner_info(\"read: 0x%2x\\n\", buf[0]);\n\ttuner_info(\"  after power on : %s\\n\", (buf[0] & 0x01) ? \"yes\" : \"no\");\n\ttuner_info(\"  afc            : %s\\n\", afc[(buf[0] >> 1) & 0x0f]);\n\ttuner_info(\"  fmif level     : %s\\n\", (buf[0] & 0x20) ? \"high\" : \"low\");\n\ttuner_info(\"  afc window     : %s\\n\", (buf[0] & 0x40) ? \"in\" : \"out\");\n\ttuner_info(\"  vfi level      : %s\\n\", (buf[0] & 0x80) ? \"high\" : \"low\");\n}\n\nstatic void dump_write_message(struct dvb_frontend *fe, unsigned char *buf)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\n\tstatic char *sound[4] = {\n\t\t\"AM/TV\",\n\t\t\"FM/radio\",\n\t\t\"FM/TV\",\n\t\t\"FM/radio\"\n\t};\n\tstatic char *adjust[32] = {\n\t\t\"-16\", \"-15\", \"-14\", \"-13\", \"-12\", \"-11\", \"-10\", \"-9\",\n\t\t\"-8\",  \"-7\",  \"-6\",  \"-5\",  \"-4\",  \"-3\",  \"-2\",  \"-1\",\n\t\t\"0\",   \"+1\",  \"+2\",  \"+3\",  \"+4\",  \"+5\",  \"+6\",  \"+7\",\n\t\t\"+8\",  \"+9\",  \"+10\", \"+11\", \"+12\", \"+13\", \"+14\", \"+15\"\n\t};\n\tstatic char *deemph[4] = {\n\t\t\"no\", \"no\", \"75\", \"50\"\n\t};\n\tstatic char *carrier[4] = {\n\t\t\"4.5 MHz\",\n\t\t\"5.5 MHz\",\n\t\t\"6.0 MHz\",\n\t\t\"6.5 MHz / AM\"\n\t};\n\tstatic char *vif[8] = {\n\t\t\"58.75 MHz\",\n\t\t\"45.75 MHz\",\n\t\t\"38.9 MHz\",\n\t\t\"38.0 MHz\",\n\t\t\"33.9 MHz\",\n\t\t\"33.4 MHz\",\n\t\t\"45.75 MHz + pin13\",\n\t\t\"38.9 MHz + pin13\",\n\t};\n\tstatic char *rif[4] = {\n\t\t\"44 MHz\",\n\t\t\"52 MHz\",\n\t\t\"52 MHz\",\n\t\t\"44 MHz\",\n\t};\n\n\ttuner_info(\"write: byte B 0x%02x\\n\", buf[1]);\n\ttuner_info(\"  B0   video mode      : %s\\n\",\n\t\t   (buf[1] & 0x01) ? \"video trap\" : \"sound trap\");\n\ttuner_info(\"  B1   auto mute fm    : %s\\n\",\n\t\t   (buf[1] & 0x02) ? \"yes\" : \"no\");\n\ttuner_info(\"  B2   carrier mode    : %s\\n\",\n\t\t   (buf[1] & 0x04) ? \"QSS\" : \"Intercarrier\");\n\ttuner_info(\"  B3-4 tv sound/radio  : %s\\n\",\n\t\t   sound[(buf[1] & 0x18) >> 3]);\n\ttuner_info(\"  B5   force mute audio: %s\\n\",\n\t\t   (buf[1] & 0x20) ? \"yes\" : \"no\");\n\ttuner_info(\"  B6   output port 1   : %s\\n\",\n\t\t   (buf[1] & 0x40) ? \"high (inactive)\" : \"low (active)\");\n\ttuner_info(\"  B7   output port 2   : %s\\n\",\n\t\t   (buf[1] & 0x80) ? \"high (inactive)\" : \"low (active)\");\n\n\ttuner_info(\"write: byte C 0x%02x\\n\", buf[2]);\n\ttuner_info(\"  C0-4 top adjustment  : %s dB\\n\",\n\t\t   adjust[buf[2] & 0x1f]);\n\ttuner_info(\"  C5-6 de-emphasis     : %s\\n\",\n\t\t   deemph[(buf[2] & 0x60) >> 5]);\n\ttuner_info(\"  C7   audio gain      : %s\\n\",\n\t\t   (buf[2] & 0x80) ? \"-6\" : \"0\");\n\n\ttuner_info(\"write: byte E 0x%02x\\n\", buf[3]);\n\ttuner_info(\"  E0-1 sound carrier   : %s\\n\",\n\t\t   carrier[(buf[3] & 0x03)]);\n\ttuner_info(\"  E6   l pll gating   : %s\\n\",\n\t\t   (buf[3] & 0x40) ? \"36\" : \"13\");\n\n\tif (buf[1] & 0x08) {\n\t\t \n\t\ttuner_info(\"  E2-4 video if        : %s\\n\",\n\t\t\t   rif[(buf[3] & 0x0c) >> 2]);\n\t\ttuner_info(\"  E7   vif agc output  : %s\\n\",\n\t\t\t   (buf[3] & 0x80)\n\t\t\t   ? ((buf[3] & 0x10) ? \"fm-agc radio\" :\n\t\t\t\t\t\t\"sif-agc radio\")\n\t\t\t   : \"fm radio carrier afc\");\n\t} else {\n\t\t \n\t\ttuner_info(\"  E2-4 video if        : %s\\n\",\n\t\t\t   vif[(buf[3] & 0x1c) >> 2]);\n\t\ttuner_info(\"  E5   tuner gain      : %s\\n\",\n\t\t\t   (buf[3] & 0x80)\n\t\t\t   ? ((buf[3] & 0x20) ? \"external\" : \"normal\")\n\t\t\t   : ((buf[3] & 0x20) ? \"minimum\"  : \"normal\"));\n\t\ttuner_info(\"  E7   vif agc output  : %s\\n\",\n\t\t\t   (buf[3] & 0x80) ? ((buf[3] & 0x20)\n\t\t\t\t? \"pin3 port, pin22 vif agc out\"\n\t\t\t\t: \"pin22 port, pin3 vif acg ext in\")\n\t\t\t\t: \"pin3+pin22 port\");\n\t}\n\ttuner_info(\"--\\n\");\n}\n\n \n\nstatic int tda9887_set_tvnorm(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\tstruct tvnorm *norm = NULL;\n\tchar *buf = priv->data;\n\tint i;\n\n\tif (priv->mode == V4L2_TUNER_RADIO) {\n\t\tif (priv->audmode == V4L2_TUNER_MODE_MONO)\n\t\t\tnorm = &radio_mono;\n\t\telse\n\t\t\tnorm = &radio_stereo;\n\t} else {\n\t\tfor (i = 0; i < ARRAY_SIZE(tvnorms); i++) {\n\t\t\tif (tvnorms[i].std & priv->std) {\n\t\t\t\tnorm = tvnorms+i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (NULL == norm) {\n\t\ttuner_dbg(\"Unsupported tvnorm entry - audio muted\\n\");\n\t\treturn -1;\n\t}\n\n\ttuner_dbg(\"configure for: %s\\n\", norm->name);\n\tbuf[1] = norm->b;\n\tbuf[2] = norm->c;\n\tbuf[3] = norm->e;\n\treturn 0;\n}\n\nstatic unsigned int port1  = UNSET;\nstatic unsigned int port2  = UNSET;\nstatic unsigned int qss    = UNSET;\nstatic unsigned int adjust = UNSET;\n\nmodule_param(port1, int, 0644);\nmodule_param(port2, int, 0644);\nmodule_param(qss, int, 0644);\nmodule_param(adjust, int, 0644);\n\nstatic int tda9887_set_insmod(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\tchar *buf = priv->data;\n\n\tif (UNSET != port1) {\n\t\tif (port1)\n\t\t\tbuf[1] |= cOutputPort1Inactive;\n\t\telse\n\t\t\tbuf[1] &= ~cOutputPort1Inactive;\n\t}\n\tif (UNSET != port2) {\n\t\tif (port2)\n\t\t\tbuf[1] |= cOutputPort2Inactive;\n\t\telse\n\t\t\tbuf[1] &= ~cOutputPort2Inactive;\n\t}\n\n\tif (UNSET != qss) {\n\t\tif (qss)\n\t\t\tbuf[1] |= cQSS;\n\t\telse\n\t\t\tbuf[1] &= ~cQSS;\n\t}\n\n\tif (adjust < 0x20) {\n\t\tbuf[2] &= ~cTopMask;\n\t\tbuf[2] |= adjust;\n\t}\n\treturn 0;\n}\n\nstatic int tda9887_do_config(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\tchar *buf = priv->data;\n\n\tif (priv->config & TDA9887_PORT1_ACTIVE)\n\t\tbuf[1] &= ~cOutputPort1Inactive;\n\tif (priv->config & TDA9887_PORT1_INACTIVE)\n\t\tbuf[1] |= cOutputPort1Inactive;\n\tif (priv->config & TDA9887_PORT2_ACTIVE)\n\t\tbuf[1] &= ~cOutputPort2Inactive;\n\tif (priv->config & TDA9887_PORT2_INACTIVE)\n\t\tbuf[1] |= cOutputPort2Inactive;\n\n\tif (priv->config & TDA9887_QSS)\n\t\tbuf[1] |= cQSS;\n\tif (priv->config & TDA9887_INTERCARRIER)\n\t\tbuf[1] &= ~cQSS;\n\n\tif (priv->config & TDA9887_AUTOMUTE)\n\t\tbuf[1] |= cAutoMuteFmActive;\n\tif (priv->config & TDA9887_DEEMPHASIS_MASK) {\n\t\tbuf[2] &= ~0x60;\n\t\tswitch (priv->config & TDA9887_DEEMPHASIS_MASK) {\n\t\tcase TDA9887_DEEMPHASIS_NONE:\n\t\t\tbuf[2] |= cDeemphasisOFF;\n\t\t\tbreak;\n\t\tcase TDA9887_DEEMPHASIS_50:\n\t\t\tbuf[2] |= cDeemphasisON | cDeemphasis50;\n\t\t\tbreak;\n\t\tcase TDA9887_DEEMPHASIS_75:\n\t\t\tbuf[2] |= cDeemphasisON | cDeemphasis75;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (priv->config & TDA9887_TOP_SET) {\n\t\tbuf[2] &= ~cTopMask;\n\t\tbuf[2] |= (priv->config >> 8) & cTopMask;\n\t}\n\tif ((priv->config & TDA9887_INTERCARRIER_NTSC) &&\n\t    (priv->std & V4L2_STD_NTSC))\n\t\tbuf[1] &= ~cQSS;\n\tif (priv->config & TDA9887_GATING_18)\n\t\tbuf[3] &= ~cGating_36;\n\n\tif (priv->mode == V4L2_TUNER_RADIO) {\n\t\tif (priv->config & TDA9887_RIF_41_3) {\n\t\t\tbuf[3] &= ~cVideoIFMask;\n\t\t\tbuf[3] |= cRadioIF_41_30;\n\t\t}\n\t\tif (priv->config & TDA9887_GAIN_NORMAL)\n\t\t\tbuf[3] &= ~cTunerGainLow;\n\t}\n\n\treturn 0;\n}\n\n \n\nstatic int tda9887_status(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\tunsigned char buf[1];\n\tint rc;\n\n\trc = tuner_i2c_xfer_recv(&priv->i2c_props, buf, 1);\n\tif (rc != 1)\n\t\ttuner_info(\"i2c i/o error: rc == %d (should be 1)\\n\", rc);\n\tdump_read_message(fe, buf);\n\treturn 0;\n}\n\nstatic void tda9887_configure(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\tint rc;\n\n\tmemset(priv->data,0,sizeof(priv->data));\n\ttda9887_set_tvnorm(fe);\n\n\t \n\tpriv->data[1] |= cOutputPort1Inactive;\n\tpriv->data[1] |= cOutputPort2Inactive;\n\n\ttda9887_do_config(fe);\n\ttda9887_set_insmod(fe);\n\n\tif (priv->standby)\n\t\tpriv->data[1] |= cForcedMuteAudioON;\n\n\ttuner_dbg(\"writing: b=0x%02x c=0x%02x e=0x%02x\\n\",\n\t\t  priv->data[1], priv->data[2], priv->data[3]);\n\tif (debug > 1)\n\t\tdump_write_message(fe, priv->data);\n\n\tif (4 != (rc = tuner_i2c_xfer_send(&priv->i2c_props,priv->data,4)))\n\t\ttuner_info(\"i2c i/o error: rc == %d (should be 4)\\n\", rc);\n\n\tif (debug > 2) {\n\t\tmsleep_interruptible(1000);\n\t\ttda9887_status(fe);\n\t}\n}\n\n \n\nstatic void tda9887_tuner_status(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\ttuner_info(\"Data bytes: b=0x%02x c=0x%02x e=0x%02x\\n\",\n\t\t   priv->data[1], priv->data[2], priv->data[3]);\n}\n\nstatic int tda9887_get_afc(struct dvb_frontend *fe, s32 *afc)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\tstatic const int AFC_BITS_2_kHz[] = {\n\t\t-12500,  -37500,  -62500,  -97500,\n\t\t-112500, -137500, -162500, -187500,\n\t\t187500,  162500,  137500,  112500,\n\t\t97500 ,  62500,   37500 ,  12500\n\t};\n\t__u8 reg = 0;\n\n\tif (priv->mode != V4L2_TUNER_RADIO)\n\t\treturn 0;\n\tif (1 == tuner_i2c_xfer_recv(&priv->i2c_props, &reg, 1))\n\t\t*afc = AFC_BITS_2_kHz[(reg >> 1) & 0x0f];\n\treturn 0;\n}\n\nstatic void tda9887_standby(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\n\tpriv->standby = true;\n\n\ttda9887_configure(fe);\n}\n\nstatic void tda9887_set_params(struct dvb_frontend *fe,\n\t\t\t       struct analog_parameters *params)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\n\tpriv->standby = false;\n\tpriv->mode    = params->mode;\n\tpriv->audmode = params->audmode;\n\tpriv->std     = params->std;\n\ttda9887_configure(fe);\n}\n\nstatic int tda9887_set_config(struct dvb_frontend *fe, void *priv_cfg)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\n\tpriv->config = *(unsigned int *)priv_cfg;\n\ttda9887_configure(fe);\n\n\treturn 0;\n}\n\nstatic void tda9887_release(struct dvb_frontend *fe)\n{\n\tstruct tda9887_priv *priv = fe->analog_demod_priv;\n\n\tmutex_lock(&tda9887_list_mutex);\n\n\tif (priv)\n\t\thybrid_tuner_release_state(priv);\n\n\tmutex_unlock(&tda9887_list_mutex);\n\n\tfe->analog_demod_priv = NULL;\n}\n\nstatic const struct analog_demod_ops tda9887_ops = {\n\t.info\t\t= {\n\t\t.name\t= \"tda9887\",\n\t},\n\t.set_params     = tda9887_set_params,\n\t.standby        = tda9887_standby,\n\t.tuner_status   = tda9887_tuner_status,\n\t.get_afc        = tda9887_get_afc,\n\t.release        = tda9887_release,\n\t.set_config     = tda9887_set_config,\n};\n\nstruct dvb_frontend *tda9887_attach(struct dvb_frontend *fe,\n\t\t\t\t    struct i2c_adapter *i2c_adap,\n\t\t\t\t    u8 i2c_addr)\n{\n\tstruct tda9887_priv *priv = NULL;\n\tint instance;\n\n\tmutex_lock(&tda9887_list_mutex);\n\n\tinstance = hybrid_tuner_request_state(struct tda9887_priv, priv,\n\t\t\t\t\t      hybrid_tuner_instance_list,\n\t\t\t\t\t      i2c_adap, i2c_addr, \"tda9887\");\n\tswitch (instance) {\n\tcase 0:\n\t\tmutex_unlock(&tda9887_list_mutex);\n\t\treturn NULL;\n\tcase 1:\n\t\tfe->analog_demod_priv = priv;\n\t\tpriv->standby = true;\n\t\ttuner_info(\"tda988[5/6/7] found\\n\");\n\t\tbreak;\n\tdefault:\n\t\tfe->analog_demod_priv = priv;\n\t\tbreak;\n\t}\n\n\tmutex_unlock(&tda9887_list_mutex);\n\n\tmemcpy(&fe->ops.analog_ops, &tda9887_ops,\n\t       sizeof(struct analog_demod_ops));\n\n\treturn fe;\n}\nEXPORT_SYMBOL_GPL(tda9887_attach);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}