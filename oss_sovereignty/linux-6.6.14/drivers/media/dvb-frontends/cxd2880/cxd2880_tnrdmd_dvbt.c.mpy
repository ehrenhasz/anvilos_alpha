{
  "module_name": "cxd2880_tnrdmd_dvbt.c",
  "hash_id": "3c265952b66b1258ea05d6361529865af86b02b0ed12f60eeaa11bae5d89dbf4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/dvb-frontends/cxd2880/cxd2880_tnrdmd_dvbt.c",
  "human_readable_source": "\n \n\n#include <media/dvb_frontend.h>\n\n#include \"cxd2880_tnrdmd_dvbt.h\"\n#include \"cxd2880_tnrdmd_dvbt_mon.h\"\n\nstatic const struct cxd2880_reg_value tune_dmd_setting_seq1[] = {\n\t{0x00, 0x00}, {0x31, 0x01},\n};\n\nstatic const struct cxd2880_reg_value tune_dmd_setting_seq2[] = {\n\t{0x00, 0x04}, {0x5c, 0xfb}, {0x00, 0x10}, {0xa4, 0x03},\n\t{0x00, 0x14}, {0xb0, 0x00}, {0x00, 0x25},\n};\n\nstatic const struct cxd2880_reg_value tune_dmd_setting_seq3[] = {\n\t{0x00, 0x12}, {0x44, 0x00},\n};\n\nstatic const struct cxd2880_reg_value tune_dmd_setting_seq4[] = {\n\t{0x00, 0x11}, {0x87, 0xd2},\n};\n\nstatic const struct cxd2880_reg_value tune_dmd_setting_seq5[] = {\n\t{0x00, 0x00}, {0xfd, 0x01},\n};\n\nstatic const struct cxd2880_reg_value sleep_dmd_setting_seq1[] = {\n\t{0x00, 0x04}, {0x5c, 0xd8}, {0x00, 0x10}, {0xa4, 0x00},\n};\n\nstatic const struct cxd2880_reg_value sleep_dmd_setting_seq2[] = {\n\t{0x00, 0x11}, {0x87, 0x04},\n};\n\nstatic int x_tune_dvbt_demod_setting(struct cxd2880_tnrdmd\n\t\t\t\t     *tnr_dmd,\n\t\t\t\t     enum cxd2880_dtv_bandwidth\n\t\t\t\t     bandwidth,\n\t\t\t\t     enum cxd2880_tnrdmd_clockmode\n\t\t\t\t     clk_mode)\n{\n\tstatic const u8 clk_mode_ckffrq_a[2] = { 0x52, 0x49 };\n\tstatic const u8 clk_mode_ckffrq_b[2] = { 0x5d, 0x55 };\n\tstatic const u8 clk_mode_ckffrq_c[2] = { 0x60, 0x00 };\n\tstatic const u8 ratectl_margin[2] = { 0x01, 0xf0 };\n\tstatic const u8 maxclkcnt_a[3] = { 0x73, 0xca, 0x49 };\n\tstatic const u8 maxclkcnt_b[3] = { 0xc8, 0x13, 0xaa };\n\tstatic const u8 maxclkcnt_c[3] = { 0xdc, 0x6c, 0x00 };\n\n\tstatic const u8 bw8_nomi_ac[5] = { 0x15, 0x00, 0x00, 0x00, 0x00};\n\tstatic const u8 bw8_nomi_b[5] = { 0x14, 0x6a, 0xaa, 0xaa, 0xaa};\n\tstatic const u8 bw8_gtdofst_a[2] = { 0x01, 0x28 };\n\tstatic const u8 bw8_gtdofst_b[2] = { 0x11, 0x44 };\n\tstatic const u8 bw8_gtdofst_c[2] = { 0x15, 0x28 };\n\tstatic const u8 bw8_mrc_a[5] = { 0x30, 0x00, 0x00, 0x90, 0x00 };\n\tstatic const u8 bw8_mrc_b[5] = { 0x36, 0x71, 0x00, 0xa3, 0x55 };\n\tstatic const u8 bw8_mrc_c[5] = { 0x38, 0x00, 0x00, 0xa8, 0x00 };\n\tstatic const u8 bw8_notch[4] = { 0xb3, 0x00, 0x01, 0x02 };\n\n\tstatic const u8 bw7_nomi_ac[5] = { 0x18, 0x00, 0x00, 0x00, 0x00};\n\tstatic const u8 bw7_nomi_b[5] = { 0x17, 0x55, 0x55, 0x55, 0x55};\n\tstatic const u8 bw7_gtdofst_a[2] = { 0x12, 0x4c };\n\tstatic const u8 bw7_gtdofst_b[2] = { 0x1f, 0x15 };\n\tstatic const u8 bw7_gtdofst_c[2] = { 0x1f, 0xf8 };\n\tstatic const u8 bw7_mrc_a[5] = { 0x36, 0xdb, 0x00, 0xa4, 0x92 };\n\tstatic const u8 bw7_mrc_b[5] = { 0x3e, 0x38, 0x00, 0xba, 0xaa };\n\tstatic const u8 bw7_mrc_c[5] = { 0x40, 0x00, 0x00, 0xc0, 0x00 };\n\tstatic const u8 bw7_notch[4] = { 0xb8, 0x00, 0x00, 0x03 };\n\n\tstatic const u8 bw6_nomi_ac[5] = { 0x1c, 0x00, 0x00, 0x00, 0x00};\n\tstatic const u8 bw6_nomi_b[5] = { 0x1b, 0x38, 0xe3, 0x8e, 0x38};\n\tstatic const u8 bw6_gtdofst_a[2] = { 0x1f, 0xf8 };\n\tstatic const u8 bw6_gtdofst_b[2] = { 0x24, 0x43 };\n\tstatic const u8 bw6_gtdofst_c[2] = { 0x25, 0x4c };\n\tstatic const u8 bw6_mrc_a[5] = { 0x40, 0x00, 0x00, 0xc0, 0x00 };\n\tstatic const u8 bw6_mrc_b[5] = { 0x48, 0x97, 0x00, 0xd9, 0xc7 };\n\tstatic const u8 bw6_mrc_c[5] = { 0x4a, 0xaa, 0x00, 0xdf, 0xff };\n\tstatic const u8 bw6_notch[4] = { 0xbe, 0xab, 0x00, 0x03 };\n\n\tstatic const u8 bw5_nomi_ac[5] = { 0x21, 0x99, 0x99, 0x99, 0x99};\n\tstatic const u8 bw5_nomi_b[5] = { 0x20, 0xaa, 0xaa, 0xaa, 0xaa};\n\tstatic const u8 bw5_gtdofst_a[2] = { 0x26, 0x5d };\n\tstatic const u8 bw5_gtdofst_b[2] = { 0x2b, 0x84 };\n\tstatic const u8 bw5_gtdofst_c[2] = { 0x2c, 0xc2 };\n\tstatic const u8 bw5_mrc_a[5] = { 0x4c, 0xcc, 0x00, 0xe6, 0x66 };\n\tstatic const u8 bw5_mrc_b[5] = { 0x57, 0x1c, 0x01, 0x05, 0x55 };\n\tstatic const u8 bw5_mrc_c[5] = { 0x59, 0x99, 0x01, 0x0c, 0xcc };\n\tstatic const u8 bw5_notch[4] = { 0xc8, 0x01, 0x00, 0x03 };\n\tconst u8 *data = NULL;\n\tu8 sst_data;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  tune_dmd_setting_seq1,\n\t\t\t\t\t  ARRAY_SIZE(tune_dmd_setting_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x04);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (clk_mode) {\n\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tdata = clk_mode_ckffrq_a;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\tdata = clk_mode_ckffrq_b;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\tdata = clk_mode_ckffrq_c;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x65, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x5d, 0x07);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_SUB) {\n\t\tu8 data[2] = { 0x01, 0x01 };\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x00, 0x00);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0xce, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  tune_dmd_setting_seq2,\n\t\t\t\t\t  ARRAY_SIZE(tune_dmd_setting_seq2));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xf0, ratectl_margin, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN ||\n\t    tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB) {\n\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t  tune_dmd_setting_seq3,\n\t\t\t\t\t\t  ARRAY_SIZE(tune_dmd_setting_seq3));\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB) {\n\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t  tune_dmd_setting_seq4,\n\t\t\t\t\t\t  ARRAY_SIZE(tune_dmd_setting_seq4));\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_SUB) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x00, 0x04);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = maxclkcnt_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = maxclkcnt_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = maxclkcnt_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x68, data, 3);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x04);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (bandwidth) {\n\tcase CXD2880_DTV_BW_8_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw8_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw8_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x60, data, 5);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x00);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw8_gtdofst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw8_gtdofst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw8_gtdofst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x7d, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tsst_data = 0x35;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tsst_data = 0x34;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x71, sst_data);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw8_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw8_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw8_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, &data[0], 2);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x51, &data[2], 3);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x72, &bw8_notch[0], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x6b, &bw8_notch[2], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_DTV_BW_7_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw7_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw7_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x60, data, 5);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x02);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw7_gtdofst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw7_gtdofst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw7_gtdofst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x7d, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tsst_data = 0x2f;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tsst_data = 0x2e;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x71, sst_data);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw7_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw7_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw7_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, &data[0], 2);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x51, &data[2], 3);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x72, &bw7_notch[0], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x6b, &bw7_notch[2], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_DTV_BW_6_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw6_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw6_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x60, data, 5);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x04);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw6_gtdofst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw6_gtdofst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw6_gtdofst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x7d, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tsst_data = 0x29;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tsst_data = 0x2a;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x71, sst_data);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw6_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw6_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw6_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, &data[0], 2);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x51, &data[2], 3);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x72, &bw6_notch[0], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x6b, &bw6_notch[2], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_DTV_BW_5_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw5_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw5_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x60, data, 5);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x06);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw5_gtdofst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw5_gtdofst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw5_gtdofst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x7d, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tsst_data = 0x24;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tsst_data = 0x23;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x71, sst_data);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw5_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw5_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw5_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, &data[0], 2);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x51, &data[2], 3);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x72, &bw5_notch[0], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x6b, &bw5_notch[2], 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t   CXD2880_IO_TGT_DMD,\n\t\t\t\t\t   tune_dmd_setting_seq5,\n\t\t\t\t\t   ARRAY_SIZE(tune_dmd_setting_seq5));\n}\n\nstatic int x_sleep_dvbt_demod_setting(struct cxd2880_tnrdmd\n\t\t\t\t\t\t   *tnr_dmd)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  sleep_dmd_setting_seq1,\n\t\t\t\t\t  ARRAY_SIZE(sleep_dmd_setting_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t  sleep_dmd_setting_seq2,\n\t\t\t\t\t\t  ARRAY_SIZE(sleep_dmd_setting_seq2));\n\n\treturn ret;\n}\n\nstatic int dvbt_set_profile(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t    enum cxd2880_dvbt_profile profile)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x67,\n\t\t\t\t      (profile == CXD2880_DVBT_PROFILE_HP)\n\t\t\t\t      ? 0x00 : 0x01);\n}\n\nint cxd2880_tnrdmd_dvbt_tune1(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t      struct cxd2880_dvbt_tune_param\n\t\t\t      *tune_param)\n{\n\tint ret;\n\n\tif (!tnr_dmd || !tune_param)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret =\n\t    cxd2880_tnrdmd_common_tune_setting1(tnr_dmd, CXD2880_DTV_SYS_DVBT,\n\t\t\t\t\t\ttune_param->center_freq_khz,\n\t\t\t\t\t\ttune_param->bandwidth, 0, 0);\n\tif (ret)\n\t\treturn ret;\n\n\tret =\n\t    x_tune_dvbt_demod_setting(tnr_dmd, tune_param->bandwidth,\n\t\t\t\t      tnr_dmd->clk_mode);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret =\n\t\t    x_tune_dvbt_demod_setting(tnr_dmd->diver_sub,\n\t\t\t\t\t      tune_param->bandwidth,\n\t\t\t\t\t      tnr_dmd->diver_sub->clk_mode);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn dvbt_set_profile(tnr_dmd, tune_param->profile);\n}\n\nint cxd2880_tnrdmd_dvbt_tune2(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t      struct cxd2880_dvbt_tune_param\n\t\t\t      *tune_param)\n{\n\tint ret;\n\n\tif (!tnr_dmd || !tune_param)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret =\n\t    cxd2880_tnrdmd_common_tune_setting2(tnr_dmd, CXD2880_DTV_SYS_DVBT,\n\t\t\t\t\t\t0);\n\tif (ret)\n\t\treturn ret;\n\n\ttnr_dmd->state = CXD2880_TNRDMD_STATE_ACTIVE;\n\ttnr_dmd->frequency_khz = tune_param->center_freq_khz;\n\ttnr_dmd->sys = CXD2880_DTV_SYS_DVBT;\n\ttnr_dmd->bandwidth = tune_param->bandwidth;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\ttnr_dmd->diver_sub->state = CXD2880_TNRDMD_STATE_ACTIVE;\n\t\ttnr_dmd->diver_sub->frequency_khz = tune_param->center_freq_khz;\n\t\ttnr_dmd->diver_sub->sys = CXD2880_DTV_SYS_DVBT;\n\t\ttnr_dmd->diver_sub->bandwidth = tune_param->bandwidth;\n\t}\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_dvbt_sleep_setting(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = x_sleep_dvbt_demod_setting(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\tret = x_sleep_dvbt_demod_setting(tnr_dmd->diver_sub);\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_dvbt_check_demod_lock(struct cxd2880_tnrdmd\n\t\t\t\t\t *tnr_dmd,\n\t\t\t\t\t enum\n\t\t\t\t\t cxd2880_tnrdmd_lock_result\n\t\t\t\t\t *lock)\n{\n\tint ret;\n\n\tu8 sync_stat = 0;\n\tu8 ts_lock = 0;\n\tu8 unlock_detected = 0;\n\tu8 unlock_detected_sub = 0;\n\n\tif (!tnr_dmd || !lock)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt_mon_sync_stat(tnr_dmd, &sync_stat, &ts_lock,\n\t\t\t\t\t      &unlock_detected);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SINGLE) {\n\t\tif (sync_stat == 6)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\telse if (unlock_detected)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\t\telse\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\t\treturn 0;\n\t}\n\n\tif (sync_stat == 6) {\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\treturn 0;\n\t}\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt_mon_sync_stat_sub(tnr_dmd, &sync_stat,\n\t\t\t\t\t\t  &unlock_detected_sub);\n\tif (ret)\n\t\treturn ret;\n\n\tif (sync_stat == 6)\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\telse if (unlock_detected && unlock_detected_sub)\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\telse\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_dvbt_check_ts_lock(struct cxd2880_tnrdmd\n\t\t\t\t      *tnr_dmd,\n\t\t\t\t      enum\n\t\t\t\t      cxd2880_tnrdmd_lock_result\n\t\t\t\t      *lock)\n{\n\tint ret;\n\n\tu8 sync_stat = 0;\n\tu8 ts_lock = 0;\n\tu8 unlock_detected = 0;\n\tu8 unlock_detected_sub = 0;\n\n\tif (!tnr_dmd || !lock)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt_mon_sync_stat(tnr_dmd, &sync_stat, &ts_lock,\n\t\t\t\t\t      &unlock_detected);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SINGLE) {\n\t\tif (ts_lock)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\telse if (unlock_detected)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\t\telse\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\t\treturn 0;\n\t}\n\n\tif (ts_lock) {\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\treturn 0;\n\t} else if (!unlock_detected) {\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\t\treturn 0;\n\t}\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt_mon_sync_stat_sub(tnr_dmd, &sync_stat,\n\t\t\t\t\t\t  &unlock_detected_sub);\n\tif (ret)\n\t\treturn ret;\n\n\tif (unlock_detected && unlock_detected_sub)\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\telse\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}