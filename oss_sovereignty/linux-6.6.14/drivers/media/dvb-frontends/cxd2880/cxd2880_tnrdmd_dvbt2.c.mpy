{
  "module_name": "cxd2880_tnrdmd_dvbt2.c",
  "hash_id": "84dfe3d947e3964fb27320f8f883f16cbda2d1181e8f6d099cef3b4b48388863",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/dvb-frontends/cxd2880/cxd2880_tnrdmd_dvbt2.c",
  "human_readable_source": "\n \n\n#include <media/dvb_frontend.h>\n\n#include \"cxd2880_tnrdmd_dvbt2.h\"\n#include \"cxd2880_tnrdmd_dvbt2_mon.h\"\n\nstatic const struct cxd2880_reg_value tune_dmd_setting_seq1[] = {\n\t{0x00, 0x00}, {0x31, 0x02},\n};\n\nstatic const struct cxd2880_reg_value tune_dmd_setting_seq2[] = {\n\t{0x00, 0x04}, {0x5d, 0x0b},\n};\n\nstatic int x_tune_dvbt2_demod_setting(struct cxd2880_tnrdmd\n\t\t\t\t      *tnr_dmd,\n\t\t\t\t      enum cxd2880_dtv_bandwidth\n\t\t\t\t      bandwidth,\n\t\t\t\t      enum cxd2880_tnrdmd_clockmode\n\t\t\t\t      clk_mode)\n{\n\tstatic const u8 tsif_settings[2] = { 0x01, 0x01 };\n\tstatic const u8 init_settings[14] = {\n\t\t0x07, 0x06, 0x01, 0xf0,\t0x00, 0x00, 0x04, 0xb0, 0x00, 0x00,\n\t\t0x09, 0x9c, 0x0e, 0x4c\n\t};\n\tstatic const u8 clk_mode_settings_a1[9] = {\n\t\t0x52, 0x49, 0x2c, 0x51,\t0x51, 0x3d, 0x15, 0x29, 0x0c\n\t};\n\n\tstatic const u8 clk_mode_settings_b1[9] = {\n\t\t0x5d, 0x55, 0x32, 0x5c,\t0x5c, 0x45, 0x17, 0x2e, 0x0d\n\t};\n\n\tstatic const u8 clk_mode_settings_c1[9] = {\n\t\t0x60, 0x00, 0x34, 0x5e,\t0x5e, 0x47, 0x18, 0x2f, 0x0e\n\t};\n\n\tstatic const u8 clk_mode_settings_a2[13] = {\n\t\t0x04, 0xe7, 0x94, 0x92,\t0x09, 0xcf, 0x7e, 0xd0, 0x49,\n\t\t0xcd, 0xcd, 0x1f, 0x5b\n\t};\n\n\tstatic const u8 clk_mode_settings_b2[13] = {\n\t\t0x05, 0x90, 0x27, 0x55,\t0x0b, 0x20, 0x8f, 0xd6, 0xea,\n\t\t0xc8, 0xc8, 0x23, 0x91\n\t};\n\n\tstatic const u8 clk_mode_settings_c2[13] = {\n\t\t0x05, 0xb8, 0xd8, 0x00,\t0x0b, 0x72, 0x93, 0xf3, 0x00,\n\t\t0xcd, 0xcd, 0x24, 0x95\n\t};\n\n\tstatic const u8 clk_mode_settings_a3[5] = {\n\t\t0x0b, 0x6a, 0xc9, 0x03, 0x33\n\t};\n\tstatic const u8 clk_mode_settings_b3[5] = {\n\t\t0x01, 0x02, 0xe4, 0x03, 0x39\n\t};\n\tstatic const u8 clk_mode_settings_c3[5] = {\n\t\t0x01, 0x02, 0xeb, 0x03, 0x3b\n\t};\n\n\tstatic const u8 gtdofst[2] = { 0x3f, 0xff };\n\n\tstatic const u8 bw8_gtdofst_a[2] = { 0x19, 0xd2 };\n\tstatic const u8 bw8_nomi_ac[6] = { 0x15, 0x00, 0x00, 0x00, 0x00, 0x00 };\n\tstatic const u8 bw8_nomi_b[6] = { 0x14, 0x6a, 0xaa, 0xaa, 0xab, 0x00 };\n\tstatic const u8 bw8_sst_a[2] = { 0x06, 0x2a };\n\tstatic const u8 bw8_sst_b[2] = { 0x06, 0x29 };\n\tstatic const u8 bw8_sst_c[2] = { 0x06, 0x28 };\n\tstatic const u8 bw8_mrc_a[9] = {\n\t\t0x28, 0x00, 0x50, 0x00, 0x60, 0x00, 0x00, 0x90, 0x00\n\t};\n\tstatic const u8 bw8_mrc_b[9] = {\n\t\t0x2d, 0x5e, 0x5a, 0xbd, 0x6c, 0xe3, 0x00, 0xa3, 0x55\n\t};\n\tstatic const u8 bw8_mrc_c[9] = {\n\t\t0x2e, 0xaa, 0x5d, 0x55, 0x70, 0x00, 0x00, 0xa8, 0x00\n\t};\n\n\tstatic const u8 bw7_nomi_ac[6] = { 0x18, 0x00, 0x00, 0x00, 0x00, 0x00 };\n\tstatic const u8 bw7_nomi_b[6] = { 0x17, 0x55, 0x55, 0x55, 0x55, 0x00 };\n\tstatic const u8 bw7_sst_a[2] = { 0x06, 0x23 };\n\tstatic const u8 bw7_sst_b[2] = { 0x06, 0x22 };\n\tstatic const u8 bw7_sst_c[2] = { 0x06, 0x21 };\n\tstatic const u8 bw7_mrc_a[9] = {\n\t\t0x2d, 0xb6, 0x5b, 0x6d,\t0x6d, 0xb6, 0x00, 0xa4, 0x92\n\t};\n\tstatic const u8 bw7_mrc_b[9] = {\n\t\t0x33, 0xda, 0x67, 0xb4,\t0x7c, 0x71, 0x00, 0xba, 0xaa\n\t};\n\tstatic const u8 bw7_mrc_c[9] = {\n\t\t0x35, 0x55, 0x6a, 0xaa,\t0x80, 0x00, 0x00, 0xc0, 0x00\n\t};\n\n\tstatic const u8 bw6_nomi_ac[6] = { 0x1c, 0x00, 0x00, 0x00, 0x00, 0x00 };\n\tstatic const u8 bw6_nomi_b[6] = { 0x1b, 0x38, 0xe3, 0x8e, 0x39, 0x00 };\n\tstatic const u8 bw6_sst_a[2] = { 0x06, 0x1c };\n\tstatic const u8 bw6_sst_b[2] = { 0x06, 0x1b };\n\tstatic const u8 bw6_sst_c[2] = { 0x06, 0x1a };\n\tstatic const u8 bw6_mrc_a[9] = {\n\t\t0x35, 0x55, 0x6a, 0xaa, 0x80, 0x00, 0x00, 0xc0, 0x00\n\t};\n\tstatic const u8 bw6_mrc_b[9] = {\n\t\t0x3c, 0x7e, 0x78, 0xfc,\t0x91, 0x2f, 0x00, 0xd9, 0xc7\n\t};\n\tstatic const u8 bw6_mrc_c[9] = {\n\t\t0x3e, 0x38, 0x7c, 0x71,\t0x95, 0x55, 0x00, 0xdf, 0xff\n\t};\n\n\tstatic const u8 bw5_nomi_ac[6] = { 0x21, 0x99, 0x99, 0x99, 0x9a, 0x00 };\n\tstatic const u8 bw5_nomi_b[6] = { 0x20, 0xaa, 0xaa, 0xaa, 0xab, 0x00 };\n\tstatic const u8 bw5_sst_a[2] = { 0x06, 0x15 };\n\tstatic const u8 bw5_sst_b[2] = { 0x06, 0x15 };\n\tstatic const u8 bw5_sst_c[2] = { 0x06, 0x14 };\n\tstatic const u8 bw5_mrc_a[9] = {\n\t\t0x40, 0x00, 0x6a, 0xaa, 0x80, 0x00, 0x00, 0xe6, 0x66\n\t};\n\tstatic const u8 bw5_mrc_b[9] = {\n\t\t0x48, 0x97, 0x78, 0xfc, 0x91, 0x2f, 0x01, 0x05, 0x55\n\t};\n\tstatic const u8 bw5_mrc_c[9] = {\n\t\t0x4a, 0xaa, 0x7c, 0x71, 0x95, 0x55, 0x01, 0x0c, 0xcc\n\t};\n\n\tstatic const u8 bw1_7_nomi_a[6] = {\n\t\t0x68, 0x0f, 0xa2, 0x32, 0xcf, 0x03\n\t};\n\tstatic const u8 bw1_7_nomi_c[6] = {\n\t\t0x68, 0x0f, 0xa2, 0x32, 0xcf, 0x03\n\t};\n\tstatic const u8 bw1_7_nomi_b[6] = {\n\t\t0x65, 0x2b, 0xa4, 0xcd, 0xd8, 0x03\n\t};\n\tstatic const u8 bw1_7_sst_a[2] = { 0x06, 0x0c };\n\tstatic const u8 bw1_7_sst_b[2] = { 0x06, 0x0c };\n\tstatic const u8 bw1_7_sst_c[2] = { 0x06, 0x0b };\n\tstatic const u8 bw1_7_mrc_a[9] = {\n\t\t0x40, 0x00, 0x6a, 0xaa,\t0x80, 0x00, 0x02, 0xc9, 0x8f\n\t};\n\tstatic const u8 bw1_7_mrc_b[9] = {\n\t\t0x48, 0x97, 0x78, 0xfc, 0x91, 0x2f, 0x03, 0x29, 0x5d\n\t};\n\tstatic const u8 bw1_7_mrc_c[9] = {\n\t\t0x4a, 0xaa, 0x7c, 0x71,\t0x95, 0x55, 0x03, 0x40, 0x7d\n\t};\n\n\tconst u8 *data = NULL;\n\tconst u8 *data2 = NULL;\n\tconst u8 *data3 = NULL;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  tune_dmd_setting_seq1,\n\t\t\t\t\t  ARRAY_SIZE(tune_dmd_setting_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  tune_dmd_setting_seq2,\n\t\t\t\t\t  ARRAY_SIZE(tune_dmd_setting_seq2));\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_SUB) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x00, 0x00);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0xce, tsif_settings, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x20);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x8a, init_settings[0]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x90, init_settings[1]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x25);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xf0, &init_settings[2], 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x2a);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0xdc, init_settings[4]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0xde, init_settings[5]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x2d);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x73, &init_settings[6], 4);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x8f, &init_settings[10], 4);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (clk_mode) {\n\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tdata = clk_mode_settings_a1;\n\t\tdata2 = clk_mode_settings_a2;\n\t\tdata3 = clk_mode_settings_a3;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\tdata = clk_mode_settings_b1;\n\t\tdata2 = clk_mode_settings_b2;\n\t\tdata3 = clk_mode_settings_b3;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\tdata = clk_mode_settings_c1;\n\t\tdata2 = clk_mode_settings_c2;\n\t\tdata3 = clk_mode_settings_c3;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x04);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x1d, &data[0], 3);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x22, data[3]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x24, data[4]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x26, data[5]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x29, &data[6], 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x2d, data[8]);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_SUB) {\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x2e, &data2[0], 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x35, &data2[6], 7);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x3c, &data3[0], 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x56, &data3[2], 3);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (bandwidth) {\n\tcase CXD2880_DTV_BW_8_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw8_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw8_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x10, data, 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x00);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw8_gtdofst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = gtdofst;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x19, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw8_sst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw8_sst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw8_sst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x1b, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw8_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw8_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw8_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, data, 9);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\t\tbreak;\n\n\tcase CXD2880_DTV_BW_7_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw7_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw7_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x10, data, 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x02);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x19, gtdofst, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw7_sst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw7_sst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw7_sst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x1b, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw7_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw7_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw7_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, data, 9);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\t\tbreak;\n\n\tcase CXD2880_DTV_BW_6_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw6_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw6_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x10, data, 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x04);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x19, gtdofst, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw6_sst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw6_sst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw6_sst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x1b, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw6_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw6_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw6_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, data, 9);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\t\tbreak;\n\n\tcase CXD2880_DTV_BW_5_MHZ:\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw5_nomi_ac;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw5_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x10, data, 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x06);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x19, gtdofst, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw5_sst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw5_sst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw5_sst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x1b, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw5_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw5_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw5_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, data, 9);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\t\tbreak;\n\n\tcase CXD2880_DTV_BW_1_7_MHZ:\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw1_7_nomi_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw1_7_nomi_c;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw1_7_nomi_b;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x10, data, 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x4a, 0x03);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x19, gtdofst, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tdata = bw1_7_sst_a;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tdata = bw1_7_sst_b;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdata = bw1_7_sst_c;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x1b, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\t\tdata = bw1_7_mrc_a;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tdata = bw1_7_mrc_b;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\t\tdata = bw1_7_mrc_c;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t      0x4b, data, 9);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xfd, 0x01);\n}\n\nstatic int x_sleep_dvbt2_demod_setting(struct cxd2880_tnrdmd\n\t\t\t\t       *tnr_dmd)\n{\n\tstatic const u8 difint_clip[] = {\n\t\t0, 1, 0, 2, 0, 4, 0, 8, 0, 16, 0, 32\n\t};\n\tint ret = 0;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x00, 0x1d);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x47, difint_clip, 12);\n\t}\n\n\treturn ret;\n}\n\nstatic int dvbt2_set_profile(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t     enum cxd2880_dvbt2_profile profile)\n{\n\tu8 t2_mode_tune_mode = 0;\n\tu8 seq_not2_dtime = 0;\n\tu8 dtime1 = 0;\n\tu8 dtime2 = 0;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tswitch (tnr_dmd->clk_mode) {\n\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tdtime1 = 0x27;\n\t\tdtime2 = 0x0c;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\tdtime1 = 0x2c;\n\t\tdtime2 = 0x0d;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\tdtime1 = 0x2e;\n\t\tdtime2 = 0x0e;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (profile) {\n\tcase CXD2880_DVBT2_PROFILE_BASE:\n\t\tt2_mode_tune_mode = 0x01;\n\t\tseq_not2_dtime = dtime2;\n\t\tbreak;\n\n\tcase CXD2880_DVBT2_PROFILE_LITE:\n\t\tt2_mode_tune_mode = 0x05;\n\t\tseq_not2_dtime = dtime1;\n\t\tbreak;\n\n\tcase CXD2880_DVBT2_PROFILE_ANY:\n\t\tt2_mode_tune_mode = 0x00;\n\t\tseq_not2_dtime = dtime1;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x2e);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x10, t2_mode_tune_mode);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x04);\n\tif (ret)\n\t\treturn ret;\n\n\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x2c, seq_not2_dtime);\n}\n\nint cxd2880_tnrdmd_dvbt2_tune1(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t       struct cxd2880_dvbt2_tune_param\n\t\t\t       *tune_param)\n{\n\tint ret;\n\n\tif (!tnr_dmd || !tune_param)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN &&\n\t    tune_param->profile == CXD2880_DVBT2_PROFILE_ANY)\n\t\treturn -ENOTTY;\n\n\tret =\n\t    cxd2880_tnrdmd_common_tune_setting1(tnr_dmd, CXD2880_DTV_SYS_DVBT2,\n\t\t\t\t\t\ttune_param->center_freq_khz,\n\t\t\t\t\t\ttune_param->bandwidth, 0, 0);\n\tif (ret)\n\t\treturn ret;\n\n\tret =\n\t    x_tune_dvbt2_demod_setting(tnr_dmd, tune_param->bandwidth,\n\t\t\t\t       tnr_dmd->clk_mode);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret =\n\t\t    x_tune_dvbt2_demod_setting(tnr_dmd->diver_sub,\n\t\t\t\t\t       tune_param->bandwidth,\n\t\t\t\t\t       tnr_dmd->diver_sub->clk_mode);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = dvbt2_set_profile(tnr_dmd, tune_param->profile);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret =\n\t\t    dvbt2_set_profile(tnr_dmd->diver_sub, tune_param->profile);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tif (tune_param->data_plp_id == CXD2880_DVBT2_TUNE_PARAM_PLPID_AUTO)\n\t\tret = cxd2880_tnrdmd_dvbt2_set_plp_cfg(tnr_dmd, 1, 0);\n\telse\n\t\tret =\n\t\t    cxd2880_tnrdmd_dvbt2_set_plp_cfg(tnr_dmd, 0,\n\t\t\t\t\t     (u8)(tune_param->data_plp_id));\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_dvbt2_tune2(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t       struct cxd2880_dvbt2_tune_param\n\t\t\t       *tune_param)\n{\n\tu8 en_fef_intmtnt_ctrl = 1;\n\tint ret;\n\n\tif (!tnr_dmd || !tune_param)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tswitch (tune_param->profile) {\n\tcase CXD2880_DVBT2_PROFILE_BASE:\n\t\ten_fef_intmtnt_ctrl = tnr_dmd->en_fef_intmtnt_base;\n\t\tbreak;\n\tcase CXD2880_DVBT2_PROFILE_LITE:\n\t\ten_fef_intmtnt_ctrl = tnr_dmd->en_fef_intmtnt_lite;\n\t\tbreak;\n\tcase CXD2880_DVBT2_PROFILE_ANY:\n\t\tif (tnr_dmd->en_fef_intmtnt_base &&\n\t\t    tnr_dmd->en_fef_intmtnt_lite)\n\t\t\ten_fef_intmtnt_ctrl = 1;\n\t\telse\n\t\t\ten_fef_intmtnt_ctrl = 0;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret =\n\t    cxd2880_tnrdmd_common_tune_setting2(tnr_dmd,\n\t\t\t\t\t\tCXD2880_DTV_SYS_DVBT2,\n\t\t\t\t\t\ten_fef_intmtnt_ctrl);\n\tif (ret)\n\t\treturn ret;\n\n\ttnr_dmd->state = CXD2880_TNRDMD_STATE_ACTIVE;\n\ttnr_dmd->frequency_khz = tune_param->center_freq_khz;\n\ttnr_dmd->sys = CXD2880_DTV_SYS_DVBT2;\n\ttnr_dmd->bandwidth = tune_param->bandwidth;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\ttnr_dmd->diver_sub->state = CXD2880_TNRDMD_STATE_ACTIVE;\n\t\ttnr_dmd->diver_sub->frequency_khz = tune_param->center_freq_khz;\n\t\ttnr_dmd->diver_sub->sys = CXD2880_DTV_SYS_DVBT2;\n\t\ttnr_dmd->diver_sub->bandwidth = tune_param->bandwidth;\n\t}\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_dvbt2_sleep_setting(struct cxd2880_tnrdmd\n\t\t\t\t       *tnr_dmd)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = x_sleep_dvbt2_demod_setting(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\tret = x_sleep_dvbt2_demod_setting(tnr_dmd->diver_sub);\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_dvbt2_check_demod_lock(struct cxd2880_tnrdmd\n\t\t\t\t\t  *tnr_dmd,\n\t\t\t\t\t  enum\n\t\t\t\t\t  cxd2880_tnrdmd_lock_result\n\t\t\t\t\t  *lock)\n{\n\tint ret;\n\n\tu8 sync_stat = 0;\n\tu8 ts_lock = 0;\n\tu8 unlock_detected = 0;\n\tu8 unlock_detected_sub = 0;\n\n\tif (!tnr_dmd || !lock)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt2_mon_sync_stat(tnr_dmd, &sync_stat, &ts_lock,\n\t\t\t\t\t       &unlock_detected);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SINGLE) {\n\t\tif (sync_stat == 6)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\telse if (unlock_detected)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\t\telse\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\t\treturn 0;\n\t}\n\n\tif (sync_stat == 6) {\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\treturn 0;\n\t}\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt2_mon_sync_stat_sub(tnr_dmd, &sync_stat,\n\t\t\t\t\t\t   &unlock_detected_sub);\n\tif (ret)\n\t\treturn ret;\n\n\tif (sync_stat == 6)\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\telse if (unlock_detected && unlock_detected_sub)\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\telse\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_dvbt2_check_ts_lock(struct cxd2880_tnrdmd\n\t\t\t\t       *tnr_dmd,\n\t\t\t\t       enum\n\t\t\t\t       cxd2880_tnrdmd_lock_result\n\t\t\t\t       *lock)\n{\n\tint ret;\n\n\tu8 sync_stat = 0;\n\tu8 ts_lock = 0;\n\tu8 unlock_detected = 0;\n\tu8 unlock_detected_sub = 0;\n\n\tif (!tnr_dmd || !lock)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt2_mon_sync_stat(tnr_dmd, &sync_stat, &ts_lock,\n\t\t\t\t\t       &unlock_detected);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SINGLE) {\n\t\tif (ts_lock)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\telse if (unlock_detected)\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\t\telse\n\t\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\t\treturn 0;\n\t}\n\n\tif (ts_lock) {\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_LOCKED;\n\t\treturn 0;\n\t} else if (!unlock_detected) {\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\t\treturn 0;\n\t}\n\n\tret =\n\t    cxd2880_tnrdmd_dvbt2_mon_sync_stat_sub(tnr_dmd, &sync_stat,\n\t\t\t\t\t\t   &unlock_detected_sub);\n\tif (ret)\n\t\treturn ret;\n\n\tif (unlock_detected && unlock_detected_sub)\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_UNLOCKED;\n\telse\n\t\t*lock = CXD2880_TNRDMD_LOCK_RESULT_NOTDETECT;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_dvbt2_set_plp_cfg(struct cxd2880_tnrdmd\n\t\t\t\t     *tnr_dmd, u8 auto_plp,\n\t\t\t\t     u8 plp_id)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x23);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!auto_plp) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0xaf, plp_id);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xad, auto_plp ? 0x00 : 0x01);\n}\n\nint cxd2880_tnrdmd_dvbt2_diver_fef_setting(struct cxd2880_tnrdmd\n\t\t\t\t\t   *tnr_dmd)\n{\n\tstruct cxd2880_dvbt2_ofdm ofdm;\n\tstatic const u8 data[] = { 0, 8, 0, 16, 0, 32, 0, 64, 0, 128, 1, 0};\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SINGLE)\n\t\treturn 0;\n\n\tret = cxd2880_tnrdmd_dvbt2_mon_ofdm(tnr_dmd, &ofdm);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!ofdm.mixed)\n\t\treturn 0;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x1d);\n\tif (ret)\n\t\treturn ret;\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_DMD,\n\t\t\t\t       0x47, data, 12);\n}\n\nint cxd2880_tnrdmd_dvbt2_check_l1post_valid(struct cxd2880_tnrdmd\n\t\t\t\t\t    *tnr_dmd,\n\t\t\t\t\t    u8 *l1_post_valid)\n{\n\tint ret;\n\n\tu8 data;\n\n\tif (!tnr_dmd || !l1_post_valid)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x0b);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x86, &data, 1);\n\tif (ret)\n\t\treturn ret;\n\n\t*l1_post_valid = data & 0x01;\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}