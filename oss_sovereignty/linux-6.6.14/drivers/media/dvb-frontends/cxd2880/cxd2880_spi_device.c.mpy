{
  "module_name": "cxd2880_spi_device.c",
  "hash_id": "43adcd9180fe084547b961f3af51631455db9fee6e49c0b0e11e5ec943c9cefe",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/dvb-frontends/cxd2880/cxd2880_spi_device.c",
  "human_readable_source": "\n \n\n#include <linux/spi/spi.h>\n\n#include \"cxd2880_spi_device.h\"\n\nstatic int cxd2880_spi_device_write(struct cxd2880_spi *spi,\n\t\t\t\t    const u8 *data, u32 size)\n{\n\tstruct cxd2880_spi_device *spi_device = NULL;\n\tstruct spi_message msg;\n\tstruct spi_transfer tx;\n\tint result = 0;\n\n\tif (!spi || !spi->user || !data || size == 0)\n\t\treturn -EINVAL;\n\n\tspi_device = spi->user;\n\n\tmemset(&tx, 0, sizeof(tx));\n\ttx.tx_buf = data;\n\ttx.len = size;\n\n\tspi_message_init(&msg);\n\tspi_message_add_tail(&tx, &msg);\n\tresult = spi_sync(spi_device->spi, &msg);\n\n\tif (result < 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}\n\nstatic int cxd2880_spi_device_write_read(struct cxd2880_spi *spi,\n\t\t\t\t\t const u8 *tx_data,\n\t\t\t\t\t u32 tx_size,\n\t\t\t\t\t u8 *rx_data,\n\t\t\t\t\t u32 rx_size)\n{\n\tstruct cxd2880_spi_device *spi_device = NULL;\n\tint result = 0;\n\n\tif (!spi || !spi->user || !tx_data ||\n\t    !tx_size || !rx_data || !rx_size)\n\t\treturn -EINVAL;\n\n\tspi_device = spi->user;\n\n\tresult = spi_write_then_read(spi_device->spi, tx_data,\n\t\t\t\t     tx_size, rx_data, rx_size);\n\tif (result < 0)\n\t\treturn -EIO;\n\n\treturn 0;\n}\n\nint\ncxd2880_spi_device_initialize(struct cxd2880_spi_device *spi_device,\n\t\t\t      enum cxd2880_spi_mode mode,\n\t\t\t      u32 speed_hz)\n{\n\tint result = 0;\n\tstruct spi_device *spi = spi_device->spi;\n\n\tswitch (mode) {\n\tcase CXD2880_SPI_MODE_0:\n\t\tspi->mode = SPI_MODE_0;\n\t\tbreak;\n\tcase CXD2880_SPI_MODE_1:\n\t\tspi->mode = SPI_MODE_1;\n\t\tbreak;\n\tcase CXD2880_SPI_MODE_2:\n\t\tspi->mode = SPI_MODE_2;\n\t\tbreak;\n\tcase CXD2880_SPI_MODE_3:\n\t\tspi->mode = SPI_MODE_3;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tspi->max_speed_hz = speed_hz;\n\tspi->bits_per_word = 8;\n\tresult = spi_setup(spi);\n\tif (result != 0) {\n\t\tpr_err(\"spi_setup failed %d\\n\", result);\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nint cxd2880_spi_device_create_spi(struct cxd2880_spi *spi,\n\t\t\t\t  struct cxd2880_spi_device *spi_device)\n{\n\tif (!spi || !spi_device)\n\t\treturn -EINVAL;\n\n\tspi->read = NULL;\n\tspi->write = cxd2880_spi_device_write;\n\tspi->write_read = cxd2880_spi_device_write_read;\n\tspi->flags = 0;\n\tspi->user = spi_device;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}