{
  "module_name": "cxd2880_tnrdmd.c",
  "hash_id": "738b31139cab38d823179413407faa3c470bc0601c0fe93ec5110e601cf95303",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/dvb-frontends/cxd2880/cxd2880_tnrdmd.c",
  "human_readable_source": "\n \n\n#include <media/dvb_frontend.h>\n#include \"cxd2880_common.h\"\n#include \"cxd2880_tnrdmd.h\"\n#include \"cxd2880_tnrdmd_mon.h\"\n#include \"cxd2880_tnrdmd_dvbt.h\"\n#include \"cxd2880_tnrdmd_dvbt2.h\"\n\nstatic const struct cxd2880_reg_value p_init1_seq[] = {\n\t{0x11, 0x16}, {0x00, 0x10},\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq1[] = {\n\t{0x4f, 0x18}, {0x61, 0x00}, {0x71, 0x00}, {0x9d, 0x01},\n\t{0x7d, 0x02}, {0x8f, 0x01}, {0x8b, 0xc6}, {0x9a, 0x03},\n\t{0x1c, 0x00},\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq2[] = {\n\t{0xb9, 0x07}, {0x33, 0x01}, {0xc1, 0x01}, {0xc4, 0x1e},\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq3[] = {\n\t{0x00, 0x10}, {0x51, 0x01}, {0xc5, 0x07}, {0x00, 0x11},\n\t{0x70, 0xe9}, {0x76, 0x0a}, {0x78, 0x32}, {0x7a, 0x46},\n\t{0x7c, 0x86}, {0x7e, 0xa4}, {0x00, 0x10}, {0xe1, 0x01},\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq4[] = {\n\t{0x15, 0x00}, {0x00, 0x16}\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq5[] = {\n\t{0x00, 0x00}, {0x25, 0x00}\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq6[] = {\n\t{0x02, 0x00}, {0x00, 0x00}, {0x21, 0x01}, {0x00, 0xe1},\n\t{0x8f, 0x16}, {0x67, 0x60}, {0x6a, 0x0f}, {0x6c, 0x17}\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq7[] = {\n\t{0x00, 0xe2}, {0x41, 0xa0}, {0x4b, 0x68}, {0x00, 0x00},\n\t{0x21, 0x00}, {0x10, 0x01},\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq8[] = {\n\t{0x00, 0x10}, {0x25, 0x01},\n};\n\nstatic const struct cxd2880_reg_value rf_init1_seq9[] = {\n\t{0x00, 0x10}, {0x14, 0x01}, {0x00, 0x00}, {0x26, 0x00},\n};\n\nstatic const struct cxd2880_reg_value rf_init2_seq1[] = {\n\t{0x00, 0x14}, {0x1b, 0x01},\n};\n\nstatic const struct cxd2880_reg_value rf_init2_seq2[] = {\n\t{0x00, 0x00}, {0x21, 0x01}, {0x00, 0xe1}, {0xd3, 0x00},\n\t{0x00, 0x00}, {0x21, 0x00},\n};\n\nstatic const struct cxd2880_reg_value x_tune1_seq1[] = {\n\t{0x00, 0x00}, {0x10, 0x01},\n};\n\nstatic const struct cxd2880_reg_value x_tune1_seq2[] = {\n\t{0x62, 0x00}, {0x00, 0x15},\n};\n\nstatic const struct cxd2880_reg_value x_tune2_seq1[] = {\n\t{0x00, 0x1a}, {0x29, 0x01},\n};\n\nstatic const struct cxd2880_reg_value x_tune2_seq2[] = {\n\t{0x62, 0x01}, {0x00, 0x11}, {0x2d, 0x00}, {0x2f, 0x00},\n};\n\nstatic const struct cxd2880_reg_value x_tune2_seq3[] = {\n\t{0x00, 0x00}, {0x10, 0x00}, {0x21, 0x01},\n};\n\nstatic const struct cxd2880_reg_value x_tune2_seq4[] = {\n\t{0x00, 0xe1}, {0x8a, 0x87},\n};\n\nstatic const struct cxd2880_reg_value x_tune2_seq5[] = {\n\t{0x00, 0x00}, {0x21, 0x00},\n};\n\nstatic const struct cxd2880_reg_value x_tune3_seq[] = {\n\t{0x00, 0x00}, {0x21, 0x01}, {0x00, 0xe2}, {0x41, 0xa0},\n\t{0x00, 0x00}, {0x21, 0x00}, {0xfe, 0x01},\n};\n\nstatic const struct cxd2880_reg_value x_tune4_seq[] = {\n\t{0x00, 0x00}, {0xfe, 0x01},\n};\n\nstatic const struct cxd2880_reg_value x_sleep1_seq[] = {\n\t{0x00, 0x00}, {0x57, 0x03},\n};\n\nstatic const struct cxd2880_reg_value x_sleep2_seq1[] = {\n\t{0x00, 0x2d}, {0xb1, 0x01},\n};\n\nstatic const struct cxd2880_reg_value x_sleep2_seq2[] = {\n\t{0x00, 0x10}, {0xf4, 0x00}, {0xf3, 0x00}, {0xf2, 0x00},\n\t{0xf1, 0x00}, {0xf0, 0x00}, {0xef, 0x00},\n};\n\nstatic const struct cxd2880_reg_value x_sleep3_seq[] = {\n\t{0x00, 0x00}, {0xfd, 0x00},\n};\n\nstatic const struct cxd2880_reg_value x_sleep4_seq[] = {\n\t{0x00, 0x00}, {0x21, 0x01}, {0x00, 0xe2}, {0x41, 0x00},\n\t{0x00, 0x00}, {0x21, 0x00},\n};\n\nstatic const struct cxd2880_reg_value spll_reset_seq1[] = {\n\t{0x00, 0x10}, {0x29, 0x01}, {0x28, 0x01}, {0x27, 0x01},\n\t{0x26, 0x01},\n};\n\nstatic const struct cxd2880_reg_value spll_reset_seq2[] = {\n\t{0x00, 0x00}, {0x10, 0x00},\n};\n\nstatic const struct cxd2880_reg_value spll_reset_seq3[] = {\n\t{0x00, 0x00}, {0x27, 0x00}, {0x22, 0x01},\n};\n\nstatic const struct cxd2880_reg_value spll_reset_seq4[] = {\n\t{0x00, 0x00}, {0x27, 0x01},\n};\n\nstatic const struct cxd2880_reg_value spll_reset_seq5[] = {\n\t{0x00, 0x00}, {0x10, 0x01},\n};\n\nstatic const struct cxd2880_reg_value t_power_x_seq1[] = {\n\t{0x00, 0x10}, {0x29, 0x01}, {0x28, 0x01}, {0x27, 0x01},\n};\n\nstatic const struct cxd2880_reg_value t_power_x_seq2[] = {\n\t{0x00, 0x00}, {0x10, 0x00},\n};\n\nstatic const struct cxd2880_reg_value t_power_x_seq3[] = {\n\t{0x00, 0x00}, {0x27, 0x00}, {0x25, 0x01},\n};\n\nstatic const struct cxd2880_reg_value t_power_x_seq4[] = {\n\t{0x00, 0x00}, {0x2a, 0x00},\n};\n\nstatic const struct cxd2880_reg_value t_power_x_seq5[] = {\n\t{0x00, 0x00}, {0x25, 0x00},\n};\n\nstatic const struct cxd2880_reg_value t_power_x_seq6[] = {\n\t{0x00, 0x00}, {0x27, 0x01},\n};\n\nstatic const struct cxd2880_reg_value t_power_x_seq7[] = {\n\t{0x00, 0x00}, {0x10, 0x01},\n};\n\nstatic const struct cxd2880_reg_value set_ts_pin_seq[] = {\n\t{0x50, 0x3f}, {0x52, 0x1f},\n\n};\n\nstatic const struct cxd2880_reg_value set_ts_output_seq1[] = {\n\t{0x00, 0x00}, {0x52, 0x00},\n};\n\nstatic const struct cxd2880_reg_value set_ts_output_seq2[] = {\n\t{0x00, 0x00}, {0xc3, 0x00},\n\n};\n\nstatic const struct cxd2880_reg_value set_ts_output_seq3[] = {\n\t{0x00, 0x00}, {0xc3, 0x01},\n\n};\n\nstatic const struct cxd2880_reg_value set_ts_output_seq4[] = {\n\t{0x00, 0x00}, {0x52, 0x1f},\n\n};\n\nstatic int p_init1(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data = 0;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SINGLE ||\n\t    tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tswitch (tnr_dmd->create_param.ts_output_if) {\n\t\tcase CXD2880_TNRDMD_TSOUT_IF_TS:\n\t\t\tdata = 0x00;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_TSOUT_IF_SPI:\n\t\t\tdata = 0x01;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_TSOUT_IF_SDIO:\n\t\t\tdata = 0x02;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x10, data);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  p_init1_seq,\n\t\t\t\t\t  ARRAY_SIZE(p_init1_seq));\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (tnr_dmd->chip_id) {\n\tcase CXD2880_TNRDMD_CHIP_ID_CXD2880_ES1_0X:\n\t\tdata = 0x1a;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CHIP_ID_CXD2880_ES1_11:\n\t\tdata = 0x16;\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOTTY;\n\t}\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x10, data);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->create_param.en_internal_ldo)\n\t\tdata = 0x01;\n\telse\n\t\tdata = 0x00;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x11, data);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x13, data);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x12, data);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (tnr_dmd->chip_id) {\n\tcase CXD2880_TNRDMD_CHIP_ID_CXD2880_ES1_0X:\n\t\tdata = 0x01;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_CHIP_ID_CXD2880_ES1_11:\n\t\tdata = 0x00;\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOTTY;\n\t}\n\n\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x69, data);\n}\n\nstatic int p_init2(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data[6] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = tnr_dmd->create_param.xosc_cap;\n\tdata[1] = tnr_dmd->create_param.xosc_i;\n\tswitch (tnr_dmd->create_param.xtal_share_type) {\n\tcase CXD2880_TNRDMD_XTAL_SHARE_NONE:\n\t\tdata[2] = 0x01;\n\t\tdata[3] = 0x00;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_XTAL_SHARE_EXTREF:\n\t\tdata[2] = 0x00;\n\t\tdata[3] = 0x00;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_XTAL_SHARE_MASTER:\n\t\tdata[2] = 0x01;\n\t\tdata[3] = 0x01;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_XTAL_SHARE_SLAVE:\n\t\tdata[2] = 0x00;\n\t\tdata[3] = 0x01;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\tdata[4] = 0x06;\n\tdata[5] = 0x00;\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_SYS,\n\t\t\t\t       0x13, data, 6);\n}\n\nstatic int p_init3(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data[2] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (tnr_dmd->diver_mode) {\n\tcase CXD2880_TNRDMD_DIVERMODE_SINGLE:\n\t\tdata[0] = 0x00;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_DIVERMODE_MAIN:\n\t\tdata[0] = 0x03;\n\t\tbreak;\n\tcase CXD2880_TNRDMD_DIVERMODE_SUB:\n\t\tdata[0] = 0x02;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tdata[1] = 0x01;\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_SYS,\n\t\t\t\t       0x1f, data, 2);\n}\n\nstatic int rf_init1(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data[8] = { 0 };\n\tstatic const u8 rf_init1_cdata1[40] = {\n\t\t0x05, 0x05, 0x05, 0x05, 0x05, 0x05, 0x05,\n\t\t0x05, 0x05, 0x04, 0x04, 0x04, 0x03, 0x03,\n\t\t0x03, 0x04, 0x04, 0x05, 0x05, 0x05, 0x02,\n\t\t0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,\n\t\t0x02, 0x03, 0x02, 0x01, 0x01, 0x01, 0x02,\n\t\t0x02, 0x03, 0x04, 0x04, 0x04\n\t};\n\n\tstatic const u8 rf_init1_cdata2[5] = {0xff, 0x00, 0x00, 0x00, 0x00};\n\tstatic const u8 rf_init1_cdata3[80] = {\n\t\t0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00,\n\t\t0x01, 0x00, 0x02, 0x00, 0x63, 0x00, 0x00,\n\t\t0x00, 0x03, 0x00, 0x04, 0x00, 0x04, 0x00,\n\t\t0x06, 0x00, 0x06, 0x00, 0x08, 0x00, 0x09,\n\t\t0x00, 0x0b, 0x00, 0x0b, 0x00, 0x0d, 0x00,\n\t\t0x0d, 0x00, 0x0f, 0x00, 0x0f, 0x00, 0x0f,\n\t\t0x00, 0x10, 0x00, 0x79, 0x00, 0x00, 0x00,\n\t\t0x02, 0x00, 0x00, 0x00, 0x03, 0x00, 0x01,\n\t\t0x00, 0x03, 0x00, 0x03, 0x00, 0x03, 0x00,\n\t\t0x04, 0x00, 0x04, 0x00, 0x06, 0x00, 0x05,\n\t\t0x00, 0x07, 0x00, 0x07, 0x00, 0x08, 0x00,\n\t\t0x0a, 0x03, 0xe0\n\t};\n\n\tstatic const u8 rf_init1_cdata4[8] = {\n\t\t0x20, 0x20, 0x30, 0x41, 0x50, 0x5f, 0x6f, 0x80\n\t};\n\n\tstatic const u8 rf_init1_cdata5[50] = {\n\t\t0x00, 0x09, 0x00, 0x08, 0x00, 0x07, 0x00,\n\t\t0x06, 0x00, 0x05, 0x00, 0x03, 0x00, 0x02,\n\t\t0x00, 0x00, 0x00, 0x78, 0x00, 0x00, 0x00,\n\t\t0x06, 0x00, 0x08, 0x00, 0x08, 0x00, 0x0c,\n\t\t0x00, 0x0c, 0x00, 0x0d, 0x00, 0x0f, 0x00,\n\t\t0x0e, 0x00, 0x0e, 0x00, 0x10, 0x00, 0x0f,\n\t\t0x00, 0x0e, 0x00, 0x10, 0x00, 0x0f, 0x00,\n\t\t0x0e\n\t};\n\n\tu8 addr = 0;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x01;\n\tdata[1] = 0x00;\n\tdata[2] = 0x01;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x21, data, 3);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x01;\n\tdata[1] = 0x01;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x17, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->create_param.stationary_use) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x1a, 0x06);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  rf_init1_seq1,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = 0x00;\n\tif (tnr_dmd->create_param.is_cxd2881gg &&\n\t    tnr_dmd->create_param.xtal_share_type ==\n\t\tCXD2880_TNRDMD_XTAL_SHARE_SLAVE)\n\t\tdata[1] = 0x00;\n\telse\n\t\tdata[1] = 0x1f;\n\tdata[2] = 0x0a;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xb5, data, 3);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  rf_init1_seq2,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq2));\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->chip_id == CXD2880_TNRDMD_CHIP_ID_CXD2880_ES1_0X) {\n\t\tdata[0] = 0x34;\n\t\tdata[1] = 0x2c;\n\t} else {\n\t\tdata[0] = 0x2f;\n\t\tdata[1] = 0x25;\n\t}\n\tdata[2] = 0x15;\n\tdata[3] = 0x19;\n\tdata[4] = 0x1b;\n\tdata[5] = 0x15;\n\tdata[6] = 0x19;\n\tdata[7] = 0x1b;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xd9, data, 8);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x11);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x6c;\n\tdata[1] = 0x10;\n\tdata[2] = 0xa6;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x44, data, 3);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x16;\n\tdata[1] = 0xa8;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x50, data, 2);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x00;\n\tdata[1] = 0x22;\n\tdata[2] = 0x00;\n\tdata[3] = 0x88;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x62, data, 4);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x74, 0x75);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x7f, rf_init1_cdata1, 40);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x16);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x00;\n\tdata[1] = 0x71;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x10, data, 2);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x23, 0x89);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x27, rf_init1_cdata2, 5);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x3a, rf_init1_cdata3, 80);\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = 0x03;\n\tdata[1] = 0xe0;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xbc, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  rf_init1_seq3,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq3));\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->create_param.stationary_use) {\n\t\tdata[0] = 0x06;\n\t\tdata[1] = 0x07;\n\t\tdata[2] = 0x1a;\n\t} else {\n\t\tdata[0] = 0x00;\n\t\tdata[1] = 0x08;\n\t\tdata[2] = 0x19;\n\t}\n\tdata[3] = 0x0e;\n\tdata[4] = 0x09;\n\tdata[5] = 0x0e;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x12);\n\tif (ret)\n\t\treturn ret;\n\tfor (addr = 0x10; addr < 0x9f; addr += 6) {\n\t\tif (tnr_dmd->lna_thrs_tbl_air) {\n\t\t\tu8 idx = 0;\n\n\t\t\tidx = (addr - 0x10) / 6;\n\t\t\tdata[0] =\n\t\t\t    tnr_dmd->lna_thrs_tbl_air->thrs[idx].off_on;\n\t\t\tdata[1] =\n\t\t\t    tnr_dmd->lna_thrs_tbl_air->thrs[idx].on_off;\n\t\t}\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t\t      addr, data, 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tdata[0] = 0x00;\n\tdata[1] = 0x08;\n\tif (tnr_dmd->create_param.stationary_use)\n\t\tdata[2] = 0x1a;\n\telse\n\t\tdata[2] = 0x19;\n\tdata[3] = 0x0e;\n\tdata[4] = 0x09;\n\tdata[5] = 0x0e;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x13);\n\tif (ret)\n\t\treturn ret;\n\tfor (addr = 0x10; addr < 0xcf; addr += 6) {\n\t\tif (tnr_dmd->lna_thrs_tbl_cable) {\n\t\t\tu8 idx = 0;\n\n\t\t\tidx = (addr - 0x10) / 6;\n\t\t\tdata[0] =\n\t\t\t    tnr_dmd->lna_thrs_tbl_cable->thrs[idx].off_on;\n\t\t\tdata[1] =\n\t\t\t    tnr_dmd->lna_thrs_tbl_cable->thrs[idx].on_off;\n\t\t}\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t\t      addr, data, 6);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x11);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x08;\n\tdata[1] = 0x09;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xbd, data, 2);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x08;\n\tdata[1] = 0x09;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xc4, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xc9, rf_init1_cdata4, 8);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x14);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x15;\n\tdata[1] = 0x18;\n\tdata[2] = 0x00;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x10, data, 3);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  rf_init1_seq4,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq4));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x12, rf_init1_cdata5, 50);\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x0a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x10, data, 1);\n\tif (ret)\n\t\treturn ret;\n\tif ((data[0] & 0x01) == 0x00)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  rf_init1_seq5,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq5));\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x0a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x11, data, 1);\n\tif (ret)\n\t\treturn ret;\n\tif ((data[0] & 0x01) == 0x00)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  rf_init1_seq6,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq6));\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = 0x00;\n\tdata[1] = 0xfe;\n\tdata[2] = 0xee;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x6e, data, 3);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0xa1;\n\tdata[1] = 0x8b;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x8d, data, 2);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x08;\n\tdata[1] = 0x09;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x77, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->create_param.stationary_use) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x80, 0xaa);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  rf_init1_seq7,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq7));\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  rf_init1_seq8,\n\t\t\t\t\t  ARRAY_SIZE(rf_init1_seq8));\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x1a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x10, data, 1);\n\tif (ret)\n\t\treturn ret;\n\tif ((data[0] & 0x01) == 0x00)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t   CXD2880_IO_TGT_SYS,\n\t\t\t\t\t   rf_init1_seq9,\n\t\t\t\t\t   ARRAY_SIZE(rf_init1_seq9));\n}\n\nstatic int rf_init2(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data[5] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x40;\n\tdata[1] = 0x40;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xea, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tdata[0] = 0x00;\n\tif (tnr_dmd->chip_id == CXD2880_TNRDMD_CHIP_ID_CXD2880_ES1_0X)\n\t\tdata[1] = 0x00;\n\telse\n\t\tdata[1] = 0x01;\n\tdata[2] = 0x01;\n\tdata[3] = 0x03;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x30, data, 4);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  rf_init2_seq1,\n\t\t\t\t\t  ARRAY_SIZE(rf_init2_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t   CXD2880_IO_TGT_DMD,\n\t\t\t\t\t   rf_init2_seq2,\n\t\t\t\t\t   ARRAY_SIZE(rf_init2_seq2));\n}\n\nstatic int x_tune1(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t   enum cxd2880_dtv_sys sys, u32 freq_khz,\n\t\t   enum cxd2880_dtv_bandwidth bandwidth,\n\t\t   u8 is_cable, int shift_frequency_khz)\n{\n\tu8 data[11] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  x_tune1_seq1,\n\t\t\t\t\t  ARRAY_SIZE(x_tune1_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tdata[2] = 0x0e;\n\tdata[4] = 0x03;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xe7, data, 5);\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = 0x1f;\n\tdata[1] = 0x80;\n\tdata[2] = 0x18;\n\tdata[3] = 0x00;\n\tdata[4] = 0x07;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xe7, data, 5);\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tdata[0] = 0x72;\n\tdata[1] = 0x81;\n\tdata[3] = 0x1d;\n\tdata[4] = 0x6f;\n\tdata[5] = 0x7e;\n\tdata[7] = 0x1c;\n\tswitch (sys) {\n\tcase CXD2880_DTV_SYS_DVBT:\n\t\tdata[2] = 0x94;\n\t\tdata[6] = 0x91;\n\t\tbreak;\n\tcase CXD2880_DTV_SYS_DVBT2:\n\t\tdata[2] = 0x96;\n\t\tdata[6] = 0x93;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x44, data, 8);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  x_tune1_seq2,\n\t\t\t\t\t  ARRAY_SIZE(x_tune1_seq2));\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = 0x03;\n\tdata[1] = 0xe2;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x1e, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = is_cable ? 0x01 : 0x00;\n\tdata[1] = 0x00;\n\tdata[2] = 0x6b;\n\tdata[3] = 0x4d;\n\n\tswitch (bandwidth) {\n\tcase CXD2880_DTV_BW_1_7_MHZ:\n\t\tdata[4] = 0x03;\n\t\tbreak;\n\tcase CXD2880_DTV_BW_5_MHZ:\n\tcase CXD2880_DTV_BW_6_MHZ:\n\t\tdata[4] = 0x00;\n\t\tbreak;\n\tcase CXD2880_DTV_BW_7_MHZ:\n\t\tdata[4] = 0x01;\n\t\tbreak;\n\tcase CXD2880_DTV_BW_8_MHZ:\n\t\tdata[4] = 0x02;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tdata[5] = 0x00;\n\n\tfreq_khz += shift_frequency_khz;\n\n\tdata[6] = (freq_khz >> 16) & 0x0f;\n\tdata[7] = (freq_khz >> 8) & 0xff;\n\tdata[8] = freq_khz & 0xff;\n\tdata[9] = 0xff;\n\tdata[10] = 0xfe;\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_SYS,\n\t\t\t\t       0x52, data, 11);\n}\n\nstatic int x_tune2(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t   enum cxd2880_dtv_bandwidth bandwidth,\n\t\t   enum cxd2880_tnrdmd_clockmode clk_mode,\n\t\t   int shift_frequency_khz)\n{\n\tu8 data[3] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x11);\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = 0x01;\n\tdata[1] = 0x0e;\n\tdata[2] = 0x01;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x2d, data, 3);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  x_tune2_seq1,\n\t\t\t\t\t  ARRAY_SIZE(x_tune2_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x2c, data, 1);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x60, data[0]);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  x_tune2_seq2,\n\t\t\t\t\t  ARRAY_SIZE(x_tune2_seq2));\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  x_tune2_seq3,\n\t\t\t\t\t  ARRAY_SIZE(x_tune2_seq3));\n\tif (ret)\n\t\treturn ret;\n\n\tif (shift_frequency_khz != 0) {\n\t\tint shift_freq = 0;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x00, 0xe1);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x60, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tshift_freq = shift_frequency_khz * 1000;\n\n\t\tswitch (clk_mode) {\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\tdefault:\n\t\t\tif (shift_freq >= 0)\n\t\t\t\tshift_freq = (shift_freq + 183 / 2) / 183;\n\t\t\telse\n\t\t\t\tshift_freq = (shift_freq - 183 / 2) / 183;\n\t\t\tbreak;\n\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\tif (shift_freq >= 0)\n\t\t\t\tshift_freq = (shift_freq + 178 / 2) / 178;\n\t\t\telse\n\t\t\t\tshift_freq = (shift_freq - 178 / 2) / 178;\n\t\t\tbreak;\n\t\t}\n\n\t\tshift_freq +=\n\t\t    cxd2880_convert2s_complement((data[0] << 8) | data[1], 16);\n\n\t\tif (shift_freq > 32767)\n\t\t\tshift_freq = 32767;\n\t\telse if (shift_freq < -32768)\n\t\t\tshift_freq = -32768;\n\n\t\tdata[0] = (shift_freq >> 8) & 0xff;\n\t\tdata[1] = shift_freq & 0xff;\n\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x60, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x69, data, 1);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tshift_freq = -shift_frequency_khz;\n\n\t\tif (bandwidth == CXD2880_DTV_BW_1_7_MHZ) {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdefault:\n\t\t\t\tif (shift_freq >= 0)\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 +\n\t\t\t\t\t     17578 / 2) / 17578;\n\t\t\t\telse\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 -\n\t\t\t\t\t     17578 / 2) / 17578;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tif (shift_freq >= 0)\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 +\n\t\t\t\t\t     17090 / 2) / 17090;\n\t\t\t\telse\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 -\n\t\t\t\t\t     17090 / 2) / 17090;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\tswitch (clk_mode) {\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\t\tdefault:\n\t\t\t\tif (shift_freq >= 0)\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 +\n\t\t\t\t\t     35156 / 2) / 35156;\n\t\t\t\telse\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 -\n\t\t\t\t\t     35156 / 2) / 35156;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\t\t\tif (shift_freq >= 0)\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 +\n\t\t\t\t\t     34180 / 2) / 34180;\n\t\t\t\telse\n\t\t\t\t\tshift_freq =\n\t\t\t\t\t    (shift_freq * 1000 -\n\t\t\t\t\t     34180 / 2) / 34180;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tshift_freq += cxd2880_convert2s_complement(data[0], 8);\n\n\t\tif (shift_freq > 127)\n\t\t\tshift_freq = 127;\n\t\telse if (shift_freq < -128)\n\t\t\tshift_freq = -128;\n\n\t\tdata[0] = shift_freq & 0xff;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x69, data[0]);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tif (tnr_dmd->create_param.stationary_use) {\n\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t  x_tune2_seq4,\n\t\t\t\t\t\t  ARRAY_SIZE(x_tune2_seq4));\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t   CXD2880_IO_TGT_DMD,\n\t\t\t\t\t   x_tune2_seq5,\n\t\t\t\t\t   ARRAY_SIZE(x_tune2_seq5));\n}\n\nstatic int x_tune3(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t   enum cxd2880_dtv_sys sys,\n\t\t   u8 en_fef_intmtnt_ctrl)\n{\n\tu8 data[6] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  x_tune3_seq,\n\t\t\t\t\t  ARRAY_SIZE(x_tune3_seq));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tif (sys == CXD2880_DTV_SYS_DVBT2 && en_fef_intmtnt_ctrl)\n\t\tmemset(data, 0x01, sizeof(data));\n\telse\n\t\tmemset(data, 0x00, sizeof(data));\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0xef, data, 6);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x2d);\n\tif (ret)\n\t\treturn ret;\n\tif (sys == CXD2880_DTV_SYS_DVBT2 && en_fef_intmtnt_ctrl)\n\t\tdata[0] = 0x00;\n\telse\n\t\tdata[0] = 0x01;\n\n\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xb1, data[0]);\n}\n\nstatic int x_tune4(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data[2] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->diver_sub->io->write_reg(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\tCXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x14;\n\tdata[1] = 0x00;\n\tret = tnr_dmd->diver_sub->io->write_regs(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\tCXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t0x55, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x0b;\n\tdata[1] = 0xff;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x53, data, 2);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x57, 0x01);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x0b;\n\tdata[1] = 0xff;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x55, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->diver_sub->io->write_reg(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\tCXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x14;\n\tdata[1] = 0x00;\n\tret = tnr_dmd->diver_sub->io->write_regs(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t 0x53, data, 2);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->diver_sub->io->write_reg(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\tCXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t0x57, 0x02);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  x_tune4_seq,\n\t\t\t\t\t  ARRAY_SIZE(x_tune4_seq));\n\tif (ret)\n\t\treturn ret;\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->diver_sub->io,\n\t\t\t\t\t   CXD2880_IO_TGT_DMD,\n\t\t\t\t\t   x_tune4_seq,\n\t\t\t\t\t   ARRAY_SIZE(x_tune4_seq));\n}\n\nstatic int x_sleep1(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data[3] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  x_sleep1_seq,\n\t\t\t\t\t  ARRAY_SIZE(x_sleep1_seq));\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = 0x00;\n\tdata[1] = 0x00;\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x53, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->diver_sub->io->write_reg(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\tCXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x1f;\n\tdata[1] = 0xff;\n\tdata[2] = 0x03;\n\tret = tnr_dmd->diver_sub->io->write_regs(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t 0x55, data, 3);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x00;\n\tdata[1] = 0x00;\n\tret = tnr_dmd->diver_sub->io->write_regs(tnr_dmd->diver_sub->io,\n\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t 0x53, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tdata[0] = 0x1f;\n\tdata[1] = 0xff;\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_SYS,\n\t\t\t\t       0x55, data, 2);\n}\n\nstatic int x_sleep2(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data = 0;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  x_sleep2_seq1,\n\t\t\t\t\t  ARRAY_SIZE(x_sleep2_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0xb2, &data, 1);\n\tif (ret)\n\t\treturn ret;\n\n\tif ((data & 0x01) == 0x00)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t   CXD2880_IO_TGT_SYS,\n\t\t\t\t\t   x_sleep2_seq2,\n\t\t\t\t\t   ARRAY_SIZE(x_sleep2_seq2));\n}\n\nstatic int x_sleep3(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t   CXD2880_IO_TGT_DMD,\n\t\t\t\t\t   x_sleep3_seq,\n\t\t\t\t\t   ARRAY_SIZE(x_sleep3_seq));\n}\n\nstatic int x_sleep4(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t   CXD2880_IO_TGT_DMD,\n\t\t\t\t\t   x_sleep4_seq,\n\t\t\t\t\t   ARRAY_SIZE(x_sleep4_seq));\n}\n\nstatic int spll_reset(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t      enum cxd2880_tnrdmd_clockmode clockmode)\n{\n\tu8 data[4] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  spll_reset_seq1,\n\t\t\t\t\t  ARRAY_SIZE(spll_reset_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  spll_reset_seq2,\n\t\t\t\t\t  ARRAY_SIZE(spll_reset_seq2));\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  spll_reset_seq3,\n\t\t\t\t\t  ARRAY_SIZE(spll_reset_seq3));\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (clockmode) {\n\tcase CXD2880_TNRDMD_CLOCKMODE_A:\n\t\tdata[0] = 0x00;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CLOCKMODE_B:\n\t\tdata[0] = 0x01;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CLOCKMODE_C:\n\t\tdata[0] = 0x02;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x30, data[0]);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x22, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(2000, 3000);\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x0a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x10, data, 1);\n\tif (ret)\n\t\treturn ret;\n\tif ((data[0] & 0x01) == 0x00)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  spll_reset_seq4,\n\t\t\t\t\t  ARRAY_SIZE(spll_reset_seq4));\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  spll_reset_seq5,\n\t\t\t\t\t  ARRAY_SIZE(spll_reset_seq5));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tmemset(data, 0x00, sizeof(data));\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_SYS,\n\t\t\t\t       0x26, data, 4);\n}\n\nstatic int t_power_x(struct cxd2880_tnrdmd *tnr_dmd, u8 on)\n{\n\tu8 data[3] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  t_power_x_seq1,\n\t\t\t\t\t  ARRAY_SIZE(t_power_x_seq1));\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  t_power_x_seq2,\n\t\t\t\t\t  ARRAY_SIZE(t_power_x_seq2));\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  t_power_x_seq3,\n\t\t\t\t\t  ARRAY_SIZE(t_power_x_seq3));\n\tif (ret)\n\t\treturn ret;\n\n\tif (on) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x2b, 0x01);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tusleep_range(1000, 2000);\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x00, 0x0a);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x12, data, 1);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tif ((data[0] & 0x01) == 0)\n\t\t\treturn -EINVAL;\n\n\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t  t_power_x_seq4,\n\t\t\t\t\t\t  ARRAY_SIZE(t_power_x_seq4));\n\t\tif (ret)\n\t\t\treturn ret;\n\t} else {\n\t\tdata[0] = 0x03;\n\t\tdata[1] = 0x00;\n\t\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t\t      0x2a, data, 2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tusleep_range(1000, 2000);\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x00, 0x0a);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x13, data, 1);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tif ((data[0] & 0x01) == 0)\n\t\t\treturn -EINVAL;\n\t}\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  t_power_x_seq5,\n\t\t\t\t\t  ARRAY_SIZE(t_power_x_seq5));\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x0a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x11, data, 1);\n\tif (ret)\n\t\treturn ret;\n\tif ((data[0] & 0x01) == 0)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t  t_power_x_seq6,\n\t\t\t\t\t  ARRAY_SIZE(t_power_x_seq6));\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(1000, 2000);\n\n\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t  t_power_x_seq7,\n\t\t\t\t\t  ARRAY_SIZE(t_power_x_seq7));\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tmemset(data, 0x00, sizeof(data));\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_SYS,\n\t\t\t\t       0x27, data, 3);\n}\n\nstruct cxd2880_tnrdmd_ts_clk_cfg {\n\tu8 srl_clk_mode;\n\tu8 srl_duty_mode;\n\tu8 ts_clk_period;\n};\n\nstatic int set_ts_clk_mode_and_freq(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t    enum cxd2880_dtv_sys sys)\n{\n\tint ret;\n\tu8 backwards_compatible = 0;\n\tstruct cxd2880_tnrdmd_ts_clk_cfg ts_clk_cfg;\n\tu8 ts_rate_ctrl_off = 0;\n\tu8 ts_in_off = 0;\n\tu8 ts_clk_manaul_on = 0;\n\tu8 data = 0;\n\n\tstatic const struct cxd2880_tnrdmd_ts_clk_cfg srl_ts_clk_stgs[2][2] = {\n\t\t{\n\t\t\t{3, 1, 8,},\n\t\t\t{0, 2, 16,}\n\t\t}, {\n\t\t\t{1, 1, 8,},\n\t\t\t{2, 2, 16,}\n\t\t}\n\t};\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->is_ts_backwards_compatible_mode) {\n\t\tbackwards_compatible = 1;\n\t\tts_rate_ctrl_off = 1;\n\t\tts_in_off = 1;\n\t} else {\n\t\tbackwards_compatible = 0;\n\t\tts_rate_ctrl_off = 0;\n\t\tts_in_off = 0;\n\t}\n\n\tif (tnr_dmd->ts_byte_clk_manual_setting) {\n\t\tts_clk_manaul_on = 1;\n\t\tts_rate_ctrl_off = 0;\n\t}\n\n\tret = cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xd3, ts_rate_ctrl_off, 0x01);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xde, ts_in_off, 0x01);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xda, ts_clk_manaul_on, 0x01);\n\tif (ret)\n\t\treturn ret;\n\n\tts_clk_cfg = srl_ts_clk_stgs[tnr_dmd->srl_ts_clk_mod_cnts]\n\t\t\t\t    [tnr_dmd->srl_ts_clk_frq];\n\n\tif (tnr_dmd->ts_byte_clk_manual_setting)\n\t\tts_clk_cfg.ts_clk_period = tnr_dmd->ts_byte_clk_manual_setting;\n\n\tret = cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xc4, ts_clk_cfg.srl_clk_mode, 0x03);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0xd1, ts_clk_cfg.srl_duty_mode, 0x03);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD, 0xd9,\n\t\t\t\t     ts_clk_cfg.ts_clk_period);\n\tif (ret)\n\t\treturn ret;\n\n\tdata = backwards_compatible ? 0x00 : 0x01;\n\n\tif (sys == CXD2880_DTV_SYS_DVBT) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x00, 0x10);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret =\n\t\t    cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t\t    CXD2880_IO_TGT_DMD,\n\t\t\t\t\t    0x66, data, 0x01);\n\t}\n\n\treturn ret;\n}\n\nstatic int pid_ftr_setting(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t   struct cxd2880_tnrdmd_pid_ftr_cfg\n\t\t\t   *pid_ftr_cfg)\n{\n\tint i;\n\tint ret;\n\tu8 data[65];\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!pid_ftr_cfg)\n\t\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t\t      0x50, 0x02);\n\n\tdata[0] = pid_ftr_cfg->is_negative ? 0x01 : 0x00;\n\n\tfor (i = 0; i < 32; i++) {\n\t\tif (pid_ftr_cfg->pid_cfg[i].is_en) {\n\t\t\tdata[1 + (i * 2)] = (pid_ftr_cfg->pid_cfg[i].pid >> 8) | 0x20;\n\t\t\tdata[2 + (i * 2)] =  pid_ftr_cfg->pid_cfg[i].pid & 0xff;\n\t\t} else {\n\t\t\tdata[1 + (i * 2)] = 0x00;\n\t\t\tdata[2 + (i * 2)] = 0x00;\n\t\t}\n\t}\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_DMD,\n\t\t\t\t       0x50, data, 65);\n}\n\nstatic int load_cfg_mem(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tint ret;\n\tu8 i;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tfor (i = 0; i < tnr_dmd->cfg_mem_last_entry; i++) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     tnr_dmd->cfg_mem[i].tgt,\n\t\t\t\t\t     0x00, tnr_dmd->cfg_mem[i].bank);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t\t      tnr_dmd->cfg_mem[i].tgt,\n\t\t\t\t\t      tnr_dmd->cfg_mem[i].address,\n\t\t\t\t\t      tnr_dmd->cfg_mem[i].value,\n\t\t\t\t\t      tnr_dmd->cfg_mem[i].bit_mask);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int set_cfg_mem(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t       enum cxd2880_io_tgt tgt,\n\t\t       u8 bank, u8 address, u8 value, u8 bit_mask)\n{\n\tu8 i;\n\tu8 value_stored = 0;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tfor (i = 0; i < tnr_dmd->cfg_mem_last_entry; i++) {\n\t\tif (value_stored == 0 &&\n\t\t    tnr_dmd->cfg_mem[i].tgt == tgt &&\n\t\t    tnr_dmd->cfg_mem[i].bank == bank &&\n\t\t    tnr_dmd->cfg_mem[i].address == address) {\n\t\t\ttnr_dmd->cfg_mem[i].value &= ~bit_mask;\n\t\t\ttnr_dmd->cfg_mem[i].value |= (value & bit_mask);\n\n\t\t\ttnr_dmd->cfg_mem[i].bit_mask |= bit_mask;\n\n\t\t\tvalue_stored = 1;\n\t\t}\n\t}\n\n\tif (value_stored)\n\t\treturn 0;\n\n\tif (tnr_dmd->cfg_mem_last_entry < CXD2880_TNRDMD_MAX_CFG_MEM_COUNT) {\n\t\ttnr_dmd->cfg_mem[tnr_dmd->cfg_mem_last_entry].tgt = tgt;\n\t\ttnr_dmd->cfg_mem[tnr_dmd->cfg_mem_last_entry].bank = bank;\n\t\ttnr_dmd->cfg_mem[tnr_dmd->cfg_mem_last_entry].address = address;\n\t\ttnr_dmd->cfg_mem[tnr_dmd->cfg_mem_last_entry].value = (value & bit_mask);\n\t\ttnr_dmd->cfg_mem[tnr_dmd->cfg_mem_last_entry].bit_mask = bit_mask;\n\t\ttnr_dmd->cfg_mem_last_entry++;\n\t} else {\n\t\treturn -ENOMEM;\n\t}\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_create(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t  struct cxd2880_io *io,\n\t\t\t  struct cxd2880_tnrdmd_create_param\n\t\t\t  *create_param)\n{\n\tif (!tnr_dmd || !io || !create_param)\n\t\treturn -EINVAL;\n\n\tmemset(tnr_dmd, 0, sizeof(struct cxd2880_tnrdmd));\n\n\ttnr_dmd->io = io;\n\ttnr_dmd->create_param = *create_param;\n\n\ttnr_dmd->diver_mode = CXD2880_TNRDMD_DIVERMODE_SINGLE;\n\ttnr_dmd->diver_sub = NULL;\n\n\ttnr_dmd->srl_ts_clk_mod_cnts = 1;\n\ttnr_dmd->en_fef_intmtnt_base = 1;\n\ttnr_dmd->en_fef_intmtnt_lite = 1;\n\ttnr_dmd->rf_lvl_cmpstn = NULL;\n\ttnr_dmd->lna_thrs_tbl_air = NULL;\n\ttnr_dmd->lna_thrs_tbl_cable = NULL;\n\tatomic_set(&tnr_dmd->cancel, 0);\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_diver_create(struct cxd2880_tnrdmd\n\t\t\t\t*tnr_dmd_main,\n\t\t\t\tstruct cxd2880_io *io_main,\n\t\t\t\tstruct cxd2880_tnrdmd *tnr_dmd_sub,\n\t\t\t\tstruct cxd2880_io *io_sub,\n\t\t\t\tstruct\n\t\t\t\tcxd2880_tnrdmd_diver_create_param\n\t\t\t\t*create_param)\n{\n\tstruct cxd2880_tnrdmd_create_param *main_param, *sub_param;\n\n\tif (!tnr_dmd_main || !io_main || !tnr_dmd_sub || !io_sub ||\n\t    !create_param)\n\t\treturn -EINVAL;\n\n\tmemset(tnr_dmd_main, 0, sizeof(struct cxd2880_tnrdmd));\n\tmemset(tnr_dmd_sub, 0, sizeof(struct cxd2880_tnrdmd));\n\n\tmain_param = &tnr_dmd_main->create_param;\n\tsub_param = &tnr_dmd_sub->create_param;\n\n\ttnr_dmd_main->io = io_main;\n\ttnr_dmd_main->diver_mode = CXD2880_TNRDMD_DIVERMODE_MAIN;\n\ttnr_dmd_main->diver_sub = tnr_dmd_sub;\n\ttnr_dmd_main->create_param.en_internal_ldo =\n\t    create_param->en_internal_ldo;\n\n\tmain_param->ts_output_if = create_param->ts_output_if;\n\tmain_param->xtal_share_type = CXD2880_TNRDMD_XTAL_SHARE_MASTER;\n\tmain_param->xosc_cap = create_param->xosc_cap_main;\n\tmain_param->xosc_i = create_param->xosc_i_main;\n\tmain_param->is_cxd2881gg = create_param->is_cxd2881gg;\n\tmain_param->stationary_use = create_param->stationary_use;\n\n\ttnr_dmd_sub->io = io_sub;\n\ttnr_dmd_sub->diver_mode = CXD2880_TNRDMD_DIVERMODE_SUB;\n\ttnr_dmd_sub->diver_sub = NULL;\n\n\tsub_param->en_internal_ldo = create_param->en_internal_ldo;\n\tsub_param->ts_output_if = create_param->ts_output_if;\n\tsub_param->xtal_share_type = CXD2880_TNRDMD_XTAL_SHARE_SLAVE;\n\tsub_param->xosc_cap = 0;\n\tsub_param->xosc_i = create_param->xosc_i_sub;\n\tsub_param->is_cxd2881gg = create_param->is_cxd2881gg;\n\tsub_param->stationary_use = create_param->stationary_use;\n\n\ttnr_dmd_main->srl_ts_clk_mod_cnts = 1;\n\ttnr_dmd_main->en_fef_intmtnt_base = 1;\n\ttnr_dmd_main->en_fef_intmtnt_lite = 1;\n\ttnr_dmd_main->rf_lvl_cmpstn = NULL;\n\ttnr_dmd_main->lna_thrs_tbl_air = NULL;\n\ttnr_dmd_main->lna_thrs_tbl_cable = NULL;\n\n\ttnr_dmd_sub->srl_ts_clk_mod_cnts = 1;\n\ttnr_dmd_sub->en_fef_intmtnt_base = 1;\n\ttnr_dmd_sub->en_fef_intmtnt_lite = 1;\n\ttnr_dmd_sub->rf_lvl_cmpstn = NULL;\n\ttnr_dmd_sub->lna_thrs_tbl_air = NULL;\n\ttnr_dmd_sub->lna_thrs_tbl_cable = NULL;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_init1(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tint ret;\n\n\tif (!tnr_dmd || tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\ttnr_dmd->chip_id = CXD2880_TNRDMD_CHIP_ID_UNKNOWN;\n\ttnr_dmd->state = CXD2880_TNRDMD_STATE_UNKNOWN;\n\ttnr_dmd->clk_mode = CXD2880_TNRDMD_CLOCKMODE_UNKNOWN;\n\ttnr_dmd->frequency_khz = 0;\n\ttnr_dmd->sys = CXD2880_DTV_SYS_UNKNOWN;\n\ttnr_dmd->bandwidth = CXD2880_DTV_BW_UNKNOWN;\n\ttnr_dmd->scan_mode = 0;\n\tatomic_set(&tnr_dmd->cancel, 0);\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\ttnr_dmd->diver_sub->chip_id = CXD2880_TNRDMD_CHIP_ID_UNKNOWN;\n\t\ttnr_dmd->diver_sub->state = CXD2880_TNRDMD_STATE_UNKNOWN;\n\t\ttnr_dmd->diver_sub->clk_mode = CXD2880_TNRDMD_CLOCKMODE_UNKNOWN;\n\t\ttnr_dmd->diver_sub->frequency_khz = 0;\n\t\ttnr_dmd->diver_sub->sys = CXD2880_DTV_SYS_UNKNOWN;\n\t\ttnr_dmd->diver_sub->bandwidth = CXD2880_DTV_BW_UNKNOWN;\n\t\ttnr_dmd->diver_sub->scan_mode = 0;\n\t\tatomic_set(&tnr_dmd->diver_sub->cancel, 0);\n\t}\n\n\tret = cxd2880_tnrdmd_chip_id(tnr_dmd, &tnr_dmd->chip_id);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!CXD2880_TNRDMD_CHIP_ID_VALID(tnr_dmd->chip_id))\n\t\treturn -ENOTTY;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret =\n\t\t    cxd2880_tnrdmd_chip_id(tnr_dmd->diver_sub,\n\t\t\t\t\t   &tnr_dmd->diver_sub->chip_id);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (!CXD2880_TNRDMD_CHIP_ID_VALID(tnr_dmd->diver_sub->chip_id))\n\t\t\treturn -ENOTTY;\n\t}\n\n\tret = p_init1(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = p_init1(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tusleep_range(1000, 2000);\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = p_init2(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = p_init2(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(5000, 6000);\n\n\tret = p_init3(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = p_init3(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = rf_init1(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\tret = rf_init1(tnr_dmd->diver_sub);\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_init2(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 cpu_task_completed;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_tnrdmd_check_internal_cpu_status(tnr_dmd,\n\t\t\t\t\t\t     &cpu_task_completed);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!cpu_task_completed)\n\t\treturn -EINVAL;\n\n\tret = rf_init2(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = rf_init2(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = load_cfg_mem(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = load_cfg_mem(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\ttnr_dmd->state = CXD2880_TNRDMD_STATE_SLEEP;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\ttnr_dmd->diver_sub->state = CXD2880_TNRDMD_STATE_SLEEP;\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_check_internal_cpu_status(struct cxd2880_tnrdmd\n\t\t\t\t\t     *tnr_dmd,\n\t\t\t\t\t     u8 *task_completed)\n{\n\tu16 cpu_status = 0;\n\tint ret;\n\n\tif (!tnr_dmd || !task_completed)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_tnrdmd_mon_internal_cpu_status(tnr_dmd, &cpu_status);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SINGLE) {\n\t\tif (cpu_status == 0)\n\t\t\t*task_completed = 1;\n\t\telse\n\t\t\t*task_completed = 0;\n\n\t\treturn 0;\n\t}\n\tif (cpu_status != 0) {\n\t\t*task_completed = 0;\n\t\treturn 0;\n\t}\n\n\tret = cxd2880_tnrdmd_mon_internal_cpu_status_sub(tnr_dmd, &cpu_status);\n\tif (ret)\n\t\treturn ret;\n\n\tif (cpu_status == 0)\n\t\t*task_completed = 1;\n\telse\n\t\t*task_completed = 0;\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_common_tune_setting1(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t\tenum cxd2880_dtv_sys sys,\n\t\t\t\t\tu32 frequency_khz,\n\t\t\t\t\tenum cxd2880_dtv_bandwidth\n\t\t\t\t\tbandwidth, u8 one_seg_opt,\n\t\t\t\t\tu8 one_seg_opt_shft_dir)\n{\n\tu8 data;\n\tenum cxd2880_tnrdmd_clockmode new_clk_mode =\n\t\t\t\tCXD2880_TNRDMD_CLOCKMODE_A;\n\tint shift_frequency_khz;\n\tu8 cpu_task_completed;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tif (frequency_khz < 4000)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_tnrdmd_sleep(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00,\n\t\t\t\t     0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x2b,\n\t\t\t\t     &data,\n\t\t\t\t     1);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (sys) {\n\tcase CXD2880_DTV_SYS_DVBT:\n\t\tif (data == 0x00) {\n\t\t\tret = t_power_x(tnr_dmd, 1);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tif (tnr_dmd->diver_mode ==\n\t\t\t    CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\t\tret = t_power_x(tnr_dmd->diver_sub, 1);\n\t\t\t\tif (ret)\n\t\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\n\tcase CXD2880_DTV_SYS_DVBT2:\n\t\tif (data == 0x01) {\n\t\t\tret = t_power_x(tnr_dmd, 0);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tif (tnr_dmd->diver_mode ==\n\t\t\t    CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\t\tret = t_power_x(tnr_dmd->diver_sub, 0);\n\t\t\t\tif (ret)\n\t\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret = spll_reset(tnr_dmd, new_clk_mode);\n\tif (ret)\n\t\treturn ret;\n\n\ttnr_dmd->clk_mode = new_clk_mode;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = spll_reset(tnr_dmd->diver_sub, new_clk_mode);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\ttnr_dmd->diver_sub->clk_mode = new_clk_mode;\n\t}\n\n\tret = load_cfg_mem(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = load_cfg_mem(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tif (one_seg_opt) {\n\t\tif (tnr_dmd->diver_mode ==\n\t\t    CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tshift_frequency_khz = 350;\n\t\t} else {\n\t\t\tif (one_seg_opt_shft_dir)\n\t\t\t\tshift_frequency_khz = 350;\n\t\t\telse\n\t\t\t\tshift_frequency_khz = -350;\n\n\t\t\tif (tnr_dmd->create_param.xtal_share_type ==\n\t\t\t    CXD2880_TNRDMD_XTAL_SHARE_SLAVE)\n\t\t\t\tshift_frequency_khz *= -1;\n\t\t}\n\t} else {\n\t\tif (tnr_dmd->diver_mode ==\n\t\t    CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\t\tshift_frequency_khz = 150;\n\t\t} else {\n\t\t\tswitch (tnr_dmd->create_param.xtal_share_type) {\n\t\t\tcase CXD2880_TNRDMD_XTAL_SHARE_NONE:\n\t\t\tcase CXD2880_TNRDMD_XTAL_SHARE_EXTREF:\n\t\t\tdefault:\n\t\t\t\tshift_frequency_khz = 0;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_XTAL_SHARE_MASTER:\n\t\t\t\tshift_frequency_khz = 150;\n\t\t\t\tbreak;\n\t\t\tcase CXD2880_TNRDMD_XTAL_SHARE_SLAVE:\n\t\t\t\tshift_frequency_khz = -150;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tret =\n\t    x_tune1(tnr_dmd, sys, frequency_khz, bandwidth,\n\t\t    tnr_dmd->is_cable_input, shift_frequency_khz);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret =\n\t\t    x_tune1(tnr_dmd->diver_sub, sys, frequency_khz,\n\t\t\t    bandwidth, tnr_dmd->is_cable_input,\n\t\t\t    -shift_frequency_khz);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tusleep_range(10000, 11000);\n\n\tret =\n\t    cxd2880_tnrdmd_check_internal_cpu_status(tnr_dmd,\n\t\t\t\t\t     &cpu_task_completed);\n\tif (ret)\n\t\treturn ret;\n\n\tif (!cpu_task_completed)\n\t\treturn -EINVAL;\n\n\tret =\n\t    x_tune2(tnr_dmd, bandwidth, tnr_dmd->clk_mode,\n\t\t    shift_frequency_khz);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret =\n\t\t    x_tune2(tnr_dmd->diver_sub, bandwidth,\n\t\t\t    tnr_dmd->diver_sub->clk_mode,\n\t\t\t    -shift_frequency_khz);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tif (tnr_dmd->create_param.ts_output_if == CXD2880_TNRDMD_TSOUT_IF_TS) {\n\t\tret = set_ts_clk_mode_and_freq(tnr_dmd, sys);\n\t} else {\n\t\tstruct cxd2880_tnrdmd_pid_ftr_cfg *pid_ftr_cfg;\n\n\t\tif (tnr_dmd->pid_ftr_cfg_en)\n\t\t\tpid_ftr_cfg = &tnr_dmd->pid_ftr_cfg;\n\t\telse\n\t\t\tpid_ftr_cfg = NULL;\n\n\t\tret = pid_ftr_setting(tnr_dmd, pid_ftr_cfg);\n\t}\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_common_tune_setting2(struct cxd2880_tnrdmd\n\t\t\t\t\t*tnr_dmd,\n\t\t\t\t\tenum cxd2880_dtv_sys sys,\n\t\t\t\t\tu8 en_fef_intmtnt_ctrl)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = x_tune3(tnr_dmd, sys, en_fef_intmtnt_ctrl);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = x_tune3(tnr_dmd->diver_sub, sys, en_fef_intmtnt_ctrl);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret = x_tune4(tnr_dmd);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn cxd2880_tnrdmd_set_ts_output(tnr_dmd, 1);\n}\n\nint cxd2880_tnrdmd_sleep(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state == CXD2880_TNRDMD_STATE_SLEEP)\n\t\treturn 0;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = cxd2880_tnrdmd_set_ts_output(tnr_dmd, 0);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = x_sleep1(tnr_dmd);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = x_sleep2(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = x_sleep2(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tswitch (tnr_dmd->sys) {\n\tcase CXD2880_DTV_SYS_DVBT:\n\t\tret = cxd2880_tnrdmd_dvbt_sleep_setting(tnr_dmd);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_DTV_SYS_DVBT2:\n\t\tret = cxd2880_tnrdmd_dvbt2_sleep_setting(tnr_dmd);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tret = x_sleep3(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = x_sleep3(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = x_sleep4(tnr_dmd);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\tret = x_sleep4(tnr_dmd->diver_sub);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\ttnr_dmd->state = CXD2880_TNRDMD_STATE_SLEEP;\n\ttnr_dmd->frequency_khz = 0;\n\ttnr_dmd->sys = CXD2880_DTV_SYS_UNKNOWN;\n\ttnr_dmd->bandwidth = CXD2880_DTV_BW_UNKNOWN;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN) {\n\t\ttnr_dmd->diver_sub->state = CXD2880_TNRDMD_STATE_SLEEP;\n\t\ttnr_dmd->diver_sub->frequency_khz = 0;\n\t\ttnr_dmd->diver_sub->sys = CXD2880_DTV_SYS_UNKNOWN;\n\t\ttnr_dmd->diver_sub->bandwidth = CXD2880_DTV_BW_UNKNOWN;\n\t}\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_set_cfg(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t   enum cxd2880_tnrdmd_cfg_id id,\n\t\t\t   int value)\n{\n\tint ret = 0;\n\tu8 data[2] = { 0 };\n\tu8 need_sub_setting = 0;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tswitch (id) {\n\tcase CXD2880_TNRDMD_CFG_OUTPUT_SEL_MSB:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xc4,\n\t\t\t\t\t\t\t value ? 0x00 : 0x10,\n\t\t\t\t\t\t\t 0x10);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSVALID_ACTIVE_HI:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xc5,\n\t\t\t\t\t\t\t value ? 0x00 : 0x02,\n\t\t\t\t\t\t\t 0x02);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSSYNC_ACTIVE_HI:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xc5,\n\t\t\t\t\t\t\t value ? 0x00 : 0x04,\n\t\t\t\t\t\t\t 0x04);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSERR_ACTIVE_HI:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xcb,\n\t\t\t\t\t\t\t value ? 0x00 : 0x01,\n\t\t\t\t\t\t\t 0x01);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_LATCH_ON_POSEDGE:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xc5,\n\t\t\t\t\t\t\t value ? 0x01 : 0x00,\n\t\t\t\t\t\t\t 0x01);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSCLK_CONT:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\ttnr_dmd->srl_ts_clk_mod_cnts = value ? 0x01 : 0x00;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSCLK_MASK:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tif (value < 0 || value > 0x1f)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xc6, value,\n\t\t\t\t\t\t\t 0x1f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSVALID_MASK:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tif (value < 0 || value > 0x1f)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xc8, value,\n\t\t\t\t\t\t\t 0x1f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSERR_MASK:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tif (value < 0 || value > 0x1f)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xc9, value,\n\t\t\t\t\t\t\t 0x1f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSERR_VALID_DIS:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x91,\n\t\t\t\t\t\t\t value ? 0x01 : 0x00,\n\t\t\t\t\t\t\t 0x01);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSPIN_CURRENT:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t 0x00, 0x51, value,\n\t\t\t\t\t\t\t 0x3f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSPIN_PULLUP_MANUAL:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t 0x00, 0x50,\n\t\t\t\t\t\t\t value ? 0x80 : 0x00,\n\t\t\t\t\t\t\t 0x80);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSPIN_PULLUP:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t 0x00, 0x50, value,\n\t\t\t\t\t\t\t 0x3f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSCLK_FREQ:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tif (value < 0 || value > 1)\n\t\t\treturn -EINVAL;\n\n\t\ttnr_dmd->srl_ts_clk_frq =\n\t\t    (enum cxd2880_tnrdmd_serial_ts_clk)value;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TSBYTECLK_MANUAL:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tif (value < 0 || value > 0xff)\n\t\t\treturn -EINVAL;\n\n\t\ttnr_dmd->ts_byte_clk_manual_setting = value;\n\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TS_PACKET_GAP:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\tif (value < 0 || value > 7)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0xd6, value,\n\t\t\t\t\t\t\t 0x07);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TS_BACKWARDS_COMPATIBLE:\n\t\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\t\treturn -EINVAL;\n\n\t\ttnr_dmd->is_ts_backwards_compatible_mode = value ? 1 : 0;\n\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_PWM_VALUE:\n\t\tif (value < 0 || value > 0x1000)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x22,\n\t\t\t\t\t\t\t value ? 0x01 : 0x00,\n\t\t\t\t\t\t\t 0x01);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tdata[0] = (value >> 8) & 0x1f;\n\t\tdata[1] = value & 0xff;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x23,\n\t\t\t\t\t\t\t data[0], 0x1f);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x24,\n\t\t\t\t\t\t\t data[1], 0xff);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_INTERRUPT:\n\t\tdata[0] = (value >> 8) & 0xff;\n\t\tdata[1] = value & 0xff;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t 0x00, 0x48, data[0],\n\t\t\t\t\t\t\t 0xff);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t 0x00, 0x49, data[1],\n\t\t\t\t\t\t\t 0xff);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_INTERRUPT_LOCK_SEL:\n\t\tdata[0] = value & 0x07;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t 0x00, 0x4a, data[0],\n\t\t\t\t\t\t\t 0x07);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_INTERRUPT_INV_LOCK_SEL:\n\t\tdata[0] = (value & 0x07) << 3;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t 0x00, 0x4a, data[0],\n\t\t\t\t\t\t\t 0x38);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_FIXED_CLOCKMODE:\n\t\tif (value < CXD2880_TNRDMD_CLOCKMODE_UNKNOWN ||\n\t\t    value > CXD2880_TNRDMD_CLOCKMODE_C)\n\t\t\treturn -EINVAL;\n\t\ttnr_dmd->fixed_clk_mode = (enum cxd2880_tnrdmd_clockmode)value;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_CABLE_INPUT:\n\t\ttnr_dmd->is_cable_input = value ? 1 : 0;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT2_FEF_INTERMITTENT_BASE:\n\t\ttnr_dmd->en_fef_intmtnt_base = value ? 1 : 0;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT2_FEF_INTERMITTENT_LITE:\n\t\ttnr_dmd->en_fef_intmtnt_lite = value ? 1 : 0;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TS_BUF_ALMOST_EMPTY_THRS:\n\t\tdata[0] = (value >> 8) & 0x07;\n\t\tdata[1] = value & 0xff;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x99, data[0],\n\t\t\t\t\t\t\t 0x07);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x9a, data[1],\n\t\t\t\t\t\t\t 0xff);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TS_BUF_ALMOST_FULL_THRS:\n\t\tdata[0] = (value >> 8) & 0x07;\n\t\tdata[1] = value & 0xff;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x9b, data[0],\n\t\t\t\t\t\t\t 0x07);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x9c, data[1],\n\t\t\t\t\t\t\t 0xff);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_TS_BUF_RRDY_THRS:\n\t\tdata[0] = (value >> 8) & 0x07;\n\t\tdata[1] = value & 0xff;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x9d, data[0],\n\t\t\t\t\t\t\t 0x07);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x00, 0x9e, data[1],\n\t\t\t\t\t\t\t 0xff);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_BLINDTUNE_DVBT2_FIRST:\n\t\ttnr_dmd->blind_tune_dvbt2_first = value ? 1 : 0;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT_BERN_PERIOD:\n\t\tif (value < 0 || value > 31)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x10, 0x60,\n\t\t\t\t\t\t\t value & 0x1f, 0x1f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT_VBER_PERIOD:\n\t\tif (value < 0 || value > 7)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x10, 0x6f,\n\t\t\t\t\t\t\t value & 0x07, 0x07);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT2_BBER_MES:\n\t\tif (value < 0 || value > 15)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x20, 0x72,\n\t\t\t\t\t\t\t value & 0x0f, 0x0f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT2_LBER_MES:\n\t\tif (value < 0 || value > 15)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x20, 0x6f,\n\t\t\t\t\t\t\t value & 0x0f, 0x0f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT_PER_MES:\n\t\tif (value < 0 || value > 15)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x10, 0x5c,\n\t\t\t\t\t\t\t value & 0x0f, 0x0f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_CFG_DVBT2_PER_MES:\n\t\tif (value < 0 || value > 15)\n\t\t\treturn -EINVAL;\n\n\t\tret =\n\t\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t\t CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t 0x24, 0xdc,\n\t\t\t\t\t\t\t value & 0x0f, 0x0f);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (need_sub_setting &&\n\t    tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\tret = cxd2880_tnrdmd_set_cfg(tnr_dmd->diver_sub, id, value);\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_gpio_set_cfg(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\tu8 id,\n\t\t\t\tu8 en,\n\t\t\t\tenum cxd2880_tnrdmd_gpio_mode mode,\n\t\t\t\tu8 open_drain, u8 invert)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (id > 2)\n\t\treturn -EINVAL;\n\n\tif (mode > CXD2880_TNRDMD_GPIO_MODE_EEW)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret =\n\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd, CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t 0x00, 0x40 + id, mode,\n\t\t\t\t\t\t 0x0f);\n\tif (ret)\n\t\treturn ret;\n\n\tret =\n\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd, CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t 0x00, 0x43,\n\t\t\t\t\t\t open_drain ? (1 << id) : 0,\n\t\t\t\t\t\t 1 << id);\n\tif (ret)\n\t\treturn ret;\n\n\tret =\n\t    cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd, CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t 0x00, 0x44,\n\t\t\t\t\t\t invert ? (1 << id) : 0,\n\t\t\t\t\t\t 1 << id);\n\tif (ret)\n\t\treturn ret;\n\n\treturn cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t    CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t    0x00, 0x45,\n\t\t\t\t\t\t    en ? 0 : (1 << id),\n\t\t\t\t\t\t    1 << id);\n}\n\nint cxd2880_tnrdmd_gpio_set_cfg_sub(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t    u8 id,\n\t\t\t\t    u8 en,\n\t\t\t\t    enum cxd2880_tnrdmd_gpio_mode\n\t\t\t\t    mode, u8 open_drain, u8 invert)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_gpio_set_cfg(tnr_dmd->diver_sub, id, en, mode,\n\t\t\t\t\t   open_drain, invert);\n}\n\nint cxd2880_tnrdmd_gpio_read(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t     u8 id, u8 *value)\n{\n\tu8 data = 0;\n\tint ret;\n\n\tif (!tnr_dmd || !value)\n\t\treturn -EINVAL;\n\n\tif (id > 2)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x0a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x20, &data, 1);\n\tif (ret)\n\t\treturn ret;\n\n\t*value = (data >> id) & 0x01;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_gpio_read_sub(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t u8 id, u8 *value)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_gpio_read(tnr_dmd->diver_sub, id, value);\n}\n\nint cxd2880_tnrdmd_gpio_write(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t      u8 id, u8 value)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (id > 2)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_set_and_save_reg_bits(tnr_dmd,\n\t\t\t\t\t\t    CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t    0x00, 0x46,\n\t\t\t\t\t\t    value ? (1 << id) : 0,\n\t\t\t\t\t\t    1 << id);\n}\n\nint cxd2880_tnrdmd_gpio_write_sub(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t  u8 id, u8 value)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_gpio_write(tnr_dmd->diver_sub, id, value);\n}\n\nint cxd2880_tnrdmd_interrupt_read(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t  u16 *value)\n{\n\tint ret;\n\tu8 data[2] = { 0 };\n\n\tif (!tnr_dmd || !value)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x0a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x15, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\t*value = (data[0] << 8) | data[1];\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_interrupt_clear(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t   u16 value)\n{\n\tint ret;\n\tu8 data[2] = { 0 };\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = (value >> 8) & 0xff;\n\tdata[1] = value & 0xff;\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_SYS,\n\t\t\t\t       0x3c, data, 2);\n}\n\nint cxd2880_tnrdmd_ts_buf_clear(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\tu8 clear_overflow_flag,\n\t\t\t\tu8 clear_underflow_flag,\n\t\t\t\tu8 clear_buf)\n{\n\tint ret;\n\tu8 data[2] = { 0 };\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tdata[0] = clear_overflow_flag ? 0x02 : 0x00;\n\tdata[0] |= clear_underflow_flag ? 0x01 : 0x00;\n\tdata[1] = clear_buf ? 0x01 : 0x00;\n\n\treturn tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t       CXD2880_IO_TGT_DMD,\n\t\t\t\t       0x9f, data, 2);\n}\n\nint cxd2880_tnrdmd_chip_id(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t   enum cxd2880_tnrdmd_chip_id *chip_id)\n{\n\tint ret;\n\tu8 data = 0;\n\n\tif (!tnr_dmd || !chip_id)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0xfd, &data, 1);\n\tif (ret)\n\t\treturn ret;\n\n\t*chip_id = (enum cxd2880_tnrdmd_chip_id)data;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_set_and_save_reg_bits(struct cxd2880_tnrdmd\n\t\t\t\t\t *tnr_dmd,\n\t\t\t\t\t enum cxd2880_io_tgt tgt,\n\t\t\t\t\t u8 bank, u8 address,\n\t\t\t\t\t u8 value, u8 bit_mask)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io, tgt, 0x00, bank);\n\tif (ret)\n\t\treturn ret;\n\n\tret = cxd2880_io_set_reg_bits(tnr_dmd->io,\n\t\t\t\t      tgt, address, value, bit_mask);\n\tif (ret)\n\t\treturn ret;\n\n\treturn set_cfg_mem(tnr_dmd, tgt, bank, address, value, bit_mask);\n}\n\nint cxd2880_tnrdmd_set_scan_mode(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t enum cxd2880_dtv_sys sys,\n\t\t\t\t u8 scan_mode_end)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\ttnr_dmd->scan_mode = scan_mode_end;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn cxd2880_tnrdmd_set_scan_mode(tnr_dmd->diver_sub, sys,\n\t\t\t\t\t\t    scan_mode_end);\n\telse\n\t\treturn 0;\n}\n\nint cxd2880_tnrdmd_set_pid_ftr(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t       struct cxd2880_tnrdmd_pid_ftr_cfg\n\t\t\t       *pid_ftr_cfg)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->create_param.ts_output_if == CXD2880_TNRDMD_TSOUT_IF_TS)\n\t\treturn -ENOTTY;\n\n\tif (pid_ftr_cfg) {\n\t\ttnr_dmd->pid_ftr_cfg = *pid_ftr_cfg;\n\t\ttnr_dmd->pid_ftr_cfg_en = 1;\n\t} else {\n\t\ttnr_dmd->pid_ftr_cfg_en = 0;\n\t}\n\n\tif (tnr_dmd->state == CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn pid_ftr_setting(tnr_dmd, pid_ftr_cfg);\n\telse\n\t\treturn 0;\n}\n\nint cxd2880_tnrdmd_set_rf_lvl_cmpstn(struct cxd2880_tnrdmd\n\t\t\t\t     *tnr_dmd,\n\t\t\t\t     int (*rf_lvl_cmpstn)\n\t\t\t\t     (struct cxd2880_tnrdmd *,\n\t\t\t\t     int *))\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\ttnr_dmd->rf_lvl_cmpstn = rf_lvl_cmpstn;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_set_rf_lvl_cmpstn_sub(struct cxd2880_tnrdmd\n\t\t\t\t\t *tnr_dmd,\n\t\t\t\t\t int (*rf_lvl_cmpstn)\n\t\t\t\t\t (struct cxd2880_tnrdmd *,\n\t\t\t\t\t int *))\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_set_rf_lvl_cmpstn(tnr_dmd->diver_sub,\n\t\t\t\t\t\trf_lvl_cmpstn);\n}\n\nint cxd2880_tnrdmd_set_lna_thrs(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\tstruct cxd2880_tnrdmd_lna_thrs_tbl_air\n\t\t\t\t*tbl_air,\n\t\t\t\tstruct cxd2880_tnrdmd_lna_thrs_tbl_cable\n\t\t\t\t*tbl_cable)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\ttnr_dmd->lna_thrs_tbl_air = tbl_air;\n\ttnr_dmd->lna_thrs_tbl_cable = tbl_cable;\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_set_lna_thrs_sub(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t    struct\n\t\t\t\t    cxd2880_tnrdmd_lna_thrs_tbl_air\n\t\t\t\t    *tbl_air,\n\t\t\t\t    struct cxd2880_tnrdmd_lna_thrs_tbl_cable\n\t\t\t\t    *tbl_cable)\n{\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_set_lna_thrs(tnr_dmd->diver_sub,\n\t\t\t\t\t   tbl_air, tbl_cable);\n}\n\nint cxd2880_tnrdmd_set_ts_pin_high_low(struct cxd2880_tnrdmd\n\t\t\t\t       *tnr_dmd, u8 en, u8 value)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->create_param.ts_output_if != CXD2880_TNRDMD_TSOUT_IF_TS)\n\t\treturn -ENOTTY;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tif (en) {\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x50, ((value & 0x1f) | 0x80));\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t\t     0x52, (value & 0x1f));\n\t} else {\n\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t  set_ts_pin_seq,\n\t\t\t\t\t\t  ARRAY_SIZE(set_ts_pin_seq));\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = load_cfg_mem(tnr_dmd);\n\t}\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_set_ts_output(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t u8 en)\n{\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode == CXD2880_TNRDMD_DIVERMODE_SUB)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_SLEEP &&\n\t    tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tswitch (tnr_dmd->create_param.ts_output_if) {\n\tcase CXD2880_TNRDMD_TSOUT_IF_TS:\n\t\tif (en) {\n\t\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t  set_ts_output_seq1,\n\t\t\t\t\t\t\t  ARRAY_SIZE(set_ts_output_seq1));\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t  set_ts_output_seq2,\n\t\t\t\t\t\t\t  ARRAY_SIZE(set_ts_output_seq2));\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t} else {\n\t\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t\t  CXD2880_IO_TGT_DMD,\n\t\t\t\t\t\t\t  set_ts_output_seq3,\n\t\t\t\t\t\t\t  ARRAY_SIZE(set_ts_output_seq3));\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\n\t\t\tret = cxd2880_io_write_multi_regs(tnr_dmd->io,\n\t\t\t\t\t\t\t  CXD2880_IO_TGT_SYS,\n\t\t\t\t\t\t\t  set_ts_output_seq4,\n\t\t\t\t\t\t\t  ARRAY_SIZE(set_ts_output_seq4));\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t}\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_TSOUT_IF_SPI:\n\t\tbreak;\n\n\tcase CXD2880_TNRDMD_TSOUT_IF_SDIO:\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nint slvt_freeze_reg(struct cxd2880_tnrdmd *tnr_dmd)\n{\n\tu8 data;\n\tint ret;\n\n\tif (!tnr_dmd)\n\t\treturn -EINVAL;\n\n\tswitch (tnr_dmd->create_param.ts_output_if) {\n\tcase CXD2880_TNRDMD_TSOUT_IF_SPI:\n\tcase CXD2880_TNRDMD_TSOUT_IF_SDIO:\n\n\t\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t\t     0x00, &data, 1);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tbreak;\n\tcase CXD2880_TNRDMD_TSOUT_IF_TS:\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_DMD,\n\t\t\t\t      0x01, 0x01);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}