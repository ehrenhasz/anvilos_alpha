{
  "module_name": "cxd2880_tnrdmd_mon.c",
  "hash_id": "e42dcda9833b1ab31068150742d34cf3777cf4f3344876247e96111eb44a0620",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/dvb-frontends/cxd2880/cxd2880_tnrdmd_mon.c",
  "human_readable_source": "\n \n\n#include \"cxd2880_common.h\"\n#include \"cxd2880_tnrdmd_mon.h\"\n\nstatic const u8 rf_lvl_seq[2] = {\n\t0x80, 0x00,\n};\n\nint cxd2880_tnrdmd_mon_rf_lvl(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t      int *rf_lvl_db)\n{\n\tu8 rdata[2];\n\tint ret;\n\n\tif (!tnr_dmd || !rf_lvl_db)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->state != CXD2880_TNRDMD_STATE_ACTIVE)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x10, 0x01);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x10);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_regs(tnr_dmd->io,\n\t\t\t\t      CXD2880_IO_TGT_SYS,\n\t\t\t\t      0x5b, rf_lvl_seq, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tusleep_range(2000, 3000);\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x1a);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x15, rdata, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tif (rdata[0] || rdata[1])\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x11, rdata, 2);\n\tif (ret)\n\t\treturn ret;\n\n\t*rf_lvl_db =\n\t    cxd2880_convert2s_complement((rdata[0] << 3) |\n\t\t\t\t\t ((rdata[1] & 0xe0) >> 5), 11);\n\n\t*rf_lvl_db *= 125;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x00, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_DMD,\n\t\t\t\t     0x10, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\tif (tnr_dmd->rf_lvl_cmpstn)\n\t\tret = tnr_dmd->rf_lvl_cmpstn(tnr_dmd, rf_lvl_db);\n\n\treturn ret;\n}\n\nint cxd2880_tnrdmd_mon_rf_lvl_sub(struct cxd2880_tnrdmd *tnr_dmd,\n\t\t\t\t  int *rf_lvl_db)\n{\n\tif (!tnr_dmd || !rf_lvl_db)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_mon_rf_lvl(tnr_dmd->diver_sub, rf_lvl_db);\n}\n\nint cxd2880_tnrdmd_mon_internal_cpu_status(struct cxd2880_tnrdmd\n\t\t\t\t\t   *tnr_dmd, u16 *status)\n{\n\tu8 data[2] = { 0 };\n\tint ret;\n\n\tif (!tnr_dmd || !status)\n\t\treturn -EINVAL;\n\n\tret = tnr_dmd->io->write_reg(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x00, 0x1a);\n\tif (ret)\n\t\treturn ret;\n\tret = tnr_dmd->io->read_regs(tnr_dmd->io,\n\t\t\t\t     CXD2880_IO_TGT_SYS,\n\t\t\t\t     0x15, data, 2);\n\tif (ret)\n\t\treturn ret;\n\n\t*status = (data[0] << 8) | data[1];\n\n\treturn 0;\n}\n\nint cxd2880_tnrdmd_mon_internal_cpu_status_sub(struct\n\t\t\t\t\t       cxd2880_tnrdmd\n\t\t\t\t\t       *tnr_dmd,\n\t\t\t\t\t       u16 *status)\n{\n\tif (!tnr_dmd || !status)\n\t\treturn -EINVAL;\n\n\tif (tnr_dmd->diver_mode != CXD2880_TNRDMD_DIVERMODE_MAIN)\n\t\treturn -EINVAL;\n\n\treturn cxd2880_tnrdmd_mon_internal_cpu_status(tnr_dmd->diver_sub,\n\t\t\t\t\t\t      status);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}