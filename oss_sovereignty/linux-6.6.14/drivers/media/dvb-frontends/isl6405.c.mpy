{
  "module_name": "isl6405.c",
  "hash_id": "d5a766a15c3e88eb66c764053950d628e6671d2c1ac730e9363c434e5c8f7e7a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/dvb-frontends/isl6405.c",
  "human_readable_source": "\n \n#include <linux/delay.h>\n#include <linux/errno.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/string.h>\n#include <linux/slab.h>\n\n#include <media/dvb_frontend.h>\n#include \"isl6405.h\"\n\nstruct isl6405 {\n\tu8\t\t\tconfig;\n\tu8\t\t\toverride_or;\n\tu8\t\t\toverride_and;\n\tstruct i2c_adapter\t*i2c;\n\tu8\t\t\ti2c_addr;\n};\n\nstatic int isl6405_set_voltage(struct dvb_frontend *fe,\n\t\t\t       enum fe_sec_voltage voltage)\n{\n\tstruct isl6405 *isl6405 = (struct isl6405 *) fe->sec_priv;\n\tstruct i2c_msg msg = {\t.addr = isl6405->i2c_addr, .flags = 0,\n\t\t\t\t.buf = &isl6405->config,\n\t\t\t\t.len = sizeof(isl6405->config) };\n\n\tif (isl6405->override_or & 0x80) {\n\t\tisl6405->config &= ~(ISL6405_VSEL2 | ISL6405_EN2);\n\t\tswitch (voltage) {\n\t\tcase SEC_VOLTAGE_OFF:\n\t\t\tbreak;\n\t\tcase SEC_VOLTAGE_13:\n\t\t\tisl6405->config |= ISL6405_EN2;\n\t\t\tbreak;\n\t\tcase SEC_VOLTAGE_18:\n\t\t\tisl6405->config |= (ISL6405_EN2 | ISL6405_VSEL2);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t} else {\n\t\tisl6405->config &= ~(ISL6405_VSEL1 | ISL6405_EN1);\n\t\tswitch (voltage) {\n\t\tcase SEC_VOLTAGE_OFF:\n\t\t\tbreak;\n\t\tcase SEC_VOLTAGE_13:\n\t\t\tisl6405->config |= ISL6405_EN1;\n\t\t\tbreak;\n\t\tcase SEC_VOLTAGE_18:\n\t\t\tisl6405->config |= (ISL6405_EN1 | ISL6405_VSEL1);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\tisl6405->config |= isl6405->override_or;\n\tisl6405->config &= isl6405->override_and;\n\n\treturn (i2c_transfer(isl6405->i2c, &msg, 1) == 1) ? 0 : -EIO;\n}\n\nstatic int isl6405_enable_high_lnb_voltage(struct dvb_frontend *fe, long arg)\n{\n\tstruct isl6405 *isl6405 = (struct isl6405 *) fe->sec_priv;\n\tstruct i2c_msg msg = {\t.addr = isl6405->i2c_addr, .flags = 0,\n\t\t\t\t.buf = &isl6405->config,\n\t\t\t\t.len = sizeof(isl6405->config) };\n\n\tif (isl6405->override_or & 0x80) {\n\t\tif (arg)\n\t\t\tisl6405->config |= ISL6405_LLC2;\n\t\telse\n\t\t\tisl6405->config &= ~ISL6405_LLC2;\n\t} else {\n\t\tif (arg)\n\t\t\tisl6405->config |= ISL6405_LLC1;\n\t\telse\n\t\t\tisl6405->config &= ~ISL6405_LLC1;\n\t}\n\tisl6405->config |= isl6405->override_or;\n\tisl6405->config &= isl6405->override_and;\n\n\treturn (i2c_transfer(isl6405->i2c, &msg, 1) == 1) ? 0 : -EIO;\n}\n\nstatic void isl6405_release(struct dvb_frontend *fe)\n{\n\t \n\tisl6405_set_voltage(fe, SEC_VOLTAGE_OFF);\n\n\t \n\tkfree(fe->sec_priv);\n\tfe->sec_priv = NULL;\n}\n\nstruct dvb_frontend *isl6405_attach(struct dvb_frontend *fe, struct i2c_adapter *i2c,\n\t\t\t\t    u8 i2c_addr, u8 override_set, u8 override_clear)\n{\n\tstruct isl6405 *isl6405 = kmalloc(sizeof(struct isl6405), GFP_KERNEL);\n\tif (!isl6405)\n\t\treturn NULL;\n\n\t \n\tif (override_set & 0x80)\n\t\tisl6405->config = ISL6405_ISEL2;\n\telse\n\t\tisl6405->config = ISL6405_ISEL1;\n\tisl6405->i2c = i2c;\n\tisl6405->i2c_addr = i2c_addr;\n\tfe->sec_priv = isl6405;\n\n\t \n\tisl6405->override_or = override_set;\n\n\t \n\tisl6405->override_and = ~override_clear;\n\n\t \n\tif (isl6405_set_voltage(fe, SEC_VOLTAGE_OFF)) {\n\t\tkfree(isl6405);\n\t\tfe->sec_priv = NULL;\n\t\treturn NULL;\n\t}\n\n\t \n\tfe->ops.release_sec = isl6405_release;\n\n\t \n\tfe->ops.set_voltage = isl6405_set_voltage;\n\tfe->ops.enable_high_lnb_voltage = isl6405_enable_high_lnb_voltage;\n\n\treturn fe;\n}\nEXPORT_SYMBOL_GPL(isl6405_attach);\n\nMODULE_DESCRIPTION(\"Driver for lnb supply and control ic isl6405\");\nMODULE_AUTHOR(\"Hartmut Hackmann & Oliver Endriss\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}