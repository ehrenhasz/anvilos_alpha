{
  "module_name": "cal.h",
  "hash_id": "a72432f6095ce15ccef73bc8eb043624fbab05c1408e252c3973e27e8245477b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/ti/cal/cal.h",
  "human_readable_source": " \n \n#ifndef __TI_CAL_H__\n#define __TI_CAL_H__\n\n#include <linux/bitfield.h>\n#include <linux/io.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/spinlock.h>\n#include <linux/videodev2.h>\n#include <linux/wait.h>\n\n#include <media/media-device.h>\n#include <media/v4l2-async.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-dev.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-fwnode.h>\n#include <media/v4l2-subdev.h>\n#include <media/videobuf2-v4l2.h>\n\n#define CAL_MODULE_NAME\t\t\t\"cal\"\n#define CAL_MAX_NUM_CONTEXT\t\t8\n#define CAL_NUM_CSI2_PORTS\t\t2\n\n \n#define CAL_MIN_WIDTH_BYTES\t\t16\n#define CAL_MAX_WIDTH_BYTES\t\t(8192 * 8)\n#define CAL_MIN_HEIGHT_LINES\t\t1\n#define CAL_MAX_HEIGHT_LINES\t\t16383\n\n#define CAL_CAMERARX_PAD_SINK\t\t0\n#define CAL_CAMERARX_PAD_FIRST_SOURCE\t1\n#define CAL_CAMERARX_NUM_SOURCE_PADS\t1\n#define CAL_CAMERARX_NUM_PADS\t\t(1 + CAL_CAMERARX_NUM_SOURCE_PADS)\n\nstatic inline bool cal_rx_pad_is_sink(u32 pad)\n{\n\t \n\treturn pad == 0;\n}\n\nstatic inline bool cal_rx_pad_is_source(u32 pad)\n{\n\t \n\treturn pad >= CAL_CAMERARX_PAD_FIRST_SOURCE &&\n\t       pad <= CAL_CAMERARX_NUM_SOURCE_PADS;\n}\n\nstruct device;\nstruct device_node;\nstruct resource;\nstruct regmap;\nstruct regmap_fied;\n\n \nenum cal_camerarx_field {\n\tF_CTRLCLKEN,\n\tF_CAMMODE,\n\tF_LANEENABLE,\n\tF_CSI_MODE,\n\tF_MAX_FIELDS,\n};\n\nenum cal_dma_state {\n\tCAL_DMA_RUNNING,\n\tCAL_DMA_STOP_REQUESTED,\n\tCAL_DMA_STOP_PENDING,\n\tCAL_DMA_STOPPED,\n};\n\nstruct cal_format_info {\n\tu32\tfourcc;\n\tu32\tcode;\n\t \n\tu8\tbpp;\n\tbool\tmeta;\n};\n\n \nstruct cal_buffer {\n\t \n\tstruct vb2_v4l2_buffer\tvb;\n\tstruct list_head\tlist;\n};\n\n \nstruct cal_dmaqueue {\n\t \n\tspinlock_t\t\tlock;\n\n\t \n\tstruct list_head\tqueue;\n\t \n\tstruct cal_buffer\t*pending;\n\t \n\tstruct cal_buffer\t*active;\n\n\t \n\tenum cal_dma_state\tstate;\n\t \n\tstruct wait_queue_head\twait;\n};\n\nstruct cal_camerarx_data {\n\tstruct {\n\t\tunsigned int lsb;\n\t\tunsigned int msb;\n\t} fields[F_MAX_FIELDS];\n\tunsigned int num_lanes;\n};\n\nstruct cal_data {\n\tconst struct cal_camerarx_data *camerarx;\n\tunsigned int num_csi2_phy;\n\tunsigned int flags;\n};\n\n \n\nstruct cal_camerarx {\n\tvoid __iomem\t\t*base;\n\tstruct resource\t\t*res;\n\tstruct regmap_field\t*fields[F_MAX_FIELDS];\n\n\tstruct cal_dev\t\t*cal;\n\tunsigned int\t\tinstance;\n\n\tstruct v4l2_fwnode_endpoint\tendpoint;\n\tstruct device_node\t*source_ep_node;\n\tstruct device_node\t*source_node;\n\tstruct v4l2_subdev\t*source;\n\n\tstruct v4l2_subdev\tsubdev;\n\tstruct media_pad\tpads[CAL_CAMERARX_NUM_PADS];\n\n\t \n\tspinlock_t\t\tvc_lock;\n\tu8\t\t\tvc_enable_count[4];\n\tu16\t\t\tvc_frame_number[4];\n\tu32\t\t\tvc_sequence[4];\n\n\tunsigned int\t\tenable_count;\n};\n\nstruct cal_dev {\n\tstruct clk\t\t*fclk;\n\tint\t\t\tirq;\n\tvoid __iomem\t\t*base;\n\tstruct resource\t\t*res;\n\tstruct device\t\t*dev;\n\n\tconst struct cal_data\t*data;\n\tu32\t\t\trevision;\n\n\t \n\tstruct regmap\t\t*syscon_camerrx;\n\tu32\t\t\tsyscon_camerrx_offset;\n\n\t \n\tstruct cal_camerarx\t*phy[CAL_NUM_CSI2_PORTS];\n\n\tu32 num_contexts;\n\tstruct cal_ctx\t\t*ctx[CAL_MAX_NUM_CONTEXT];\n\n\tstruct media_device\tmdev;\n\tstruct v4l2_device\tv4l2_dev;\n\tstruct v4l2_async_notifier notifier;\n\n\tunsigned long\t\treserved_pix_proc_mask;\n};\n\n \nstruct cal_ctx {\n\tstruct v4l2_ctrl_handler ctrl_handler;\n\tstruct video_device\tvdev;\n\tstruct media_pad\tpad;\n\n\tstruct cal_dev\t\t*cal;\n\tstruct cal_camerarx\t*phy;\n\n\t \n\tstruct mutex\t\tmutex;\n\n\tstruct cal_dmaqueue\tdma;\n\n\t \n\tconst struct cal_format_info\t*fmtinfo;\n\t \n\tstruct v4l2_format\tv_fmt;\n\n\t \n\tconst struct cal_format_info\t**active_fmt;\n\tunsigned int\t\tnum_active_fmt;\n\n\tstruct vb2_queue\tvb_vidq;\n\tu8\t\t\tdma_ctx;\n\tu8\t\t\tcport;\n\tu8\t\t\tcsi2_ctx;\n\tu8\t\t\tpix_proc;\n\tu8\t\t\tvc;\n\tu8\t\t\tdatatype;\n\n\tbool\t\t\tuse_pix_proc;\n};\n\nextern unsigned int cal_debug;\nextern int cal_video_nr;\nextern bool cal_mc_api;\n\n#define cal_dbg(level, cal, fmt, arg...)\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tif (cal_debug >= (level))\t\t\t\t\\\n\t\t\tdev_printk(KERN_DEBUG, (cal)->dev, fmt, ##arg);\t\\\n\t} while (0)\n#define cal_info(cal, fmt, arg...)\t\t\t\t\t\\\n\tdev_info((cal)->dev, fmt, ##arg)\n#define cal_err(cal, fmt, arg...)\t\t\t\t\t\\\n\tdev_err((cal)->dev, fmt, ##arg)\n\n#define ctx_dbg(level, ctx, fmt, arg...)\t\t\t\t\\\n\tcal_dbg(level, (ctx)->cal, \"ctx%u: \" fmt, (ctx)->dma_ctx, ##arg)\n#define ctx_info(ctx, fmt, arg...)\t\t\t\t\t\\\n\tcal_info((ctx)->cal, \"ctx%u: \" fmt, (ctx)->dma_ctx, ##arg)\n#define ctx_err(ctx, fmt, arg...)\t\t\t\t\t\\\n\tcal_err((ctx)->cal, \"ctx%u: \" fmt, (ctx)->dma_ctx, ##arg)\n\n#define phy_dbg(level, phy, fmt, arg...)\t\t\t\t\\\n\tcal_dbg(level, (phy)->cal, \"phy%u: \" fmt, (phy)->instance, ##arg)\n#define phy_info(phy, fmt, arg...)\t\t\t\t\t\\\n\tcal_info((phy)->cal, \"phy%u: \" fmt, (phy)->instance, ##arg)\n#define phy_err(phy, fmt, arg...)\t\t\t\t\t\\\n\tcal_err((phy)->cal, \"phy%u: \" fmt, (phy)->instance, ##arg)\n\nstatic inline u32 cal_read(struct cal_dev *cal, u32 offset)\n{\n\treturn ioread32(cal->base + offset);\n}\n\nstatic inline void cal_write(struct cal_dev *cal, u32 offset, u32 val)\n{\n\tiowrite32(val, cal->base + offset);\n}\n\nstatic __always_inline u32 cal_read_field(struct cal_dev *cal, u32 offset, u32 mask)\n{\n\treturn FIELD_GET(mask, cal_read(cal, offset));\n}\n\nstatic inline void cal_write_field(struct cal_dev *cal, u32 offset, u32 value,\n\t\t\t\t   u32 mask)\n{\n\tu32 val = cal_read(cal, offset);\n\n\tval &= ~mask;\n\tval |= (value << __ffs(mask)) & mask;\n\tcal_write(cal, offset, val);\n}\n\nstatic inline void cal_set_field(u32 *valp, u32 field, u32 mask)\n{\n\tu32 val = *valp;\n\n\tval &= ~mask;\n\tval |= (field << __ffs(mask)) & mask;\n\t*valp = val;\n}\n\nextern const struct cal_format_info cal_formats[];\nextern const unsigned int cal_num_formats;\nconst struct cal_format_info *cal_format_by_fourcc(u32 fourcc);\nconst struct cal_format_info *cal_format_by_code(u32 code);\n\nvoid cal_quickdump_regs(struct cal_dev *cal);\n\nvoid cal_camerarx_disable(struct cal_camerarx *phy);\nvoid cal_camerarx_i913_errata(struct cal_camerarx *phy);\nstruct cal_camerarx *cal_camerarx_create(struct cal_dev *cal,\n\t\t\t\t\t unsigned int instance);\nvoid cal_camerarx_destroy(struct cal_camerarx *phy);\n\nint cal_ctx_prepare(struct cal_ctx *ctx);\nvoid cal_ctx_unprepare(struct cal_ctx *ctx);\nvoid cal_ctx_set_dma_addr(struct cal_ctx *ctx, dma_addr_t addr);\nvoid cal_ctx_start(struct cal_ctx *ctx);\nvoid cal_ctx_stop(struct cal_ctx *ctx);\n\nint cal_ctx_v4l2_register(struct cal_ctx *ctx);\nvoid cal_ctx_v4l2_unregister(struct cal_ctx *ctx);\nint cal_ctx_v4l2_init(struct cal_ctx *ctx);\nvoid cal_ctx_v4l2_cleanup(struct cal_ctx *ctx);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}