{
  "module_name": "vpu_color.c",
  "hash_id": "f7ed93b9ed420d784927e54b325d5d05ba7178a008157b3facb8147d3a29e536",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/amphion/vpu_color.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/device.h>\n#include <linux/ioctl.h>\n#include <linux/list.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/delay.h>\n#include <linux/types.h>\n#include <media/v4l2-device.h>\n#include \"vpu.h\"\n#include \"vpu_helpers.h\"\n\nstatic const u8 colorprimaries[] = {\n\tV4L2_COLORSPACE_LAST,\n\tV4L2_COLORSPACE_REC709,          \n\t0,\n\t0,\n\tV4L2_COLORSPACE_470_SYSTEM_M,    \n\tV4L2_COLORSPACE_470_SYSTEM_BG,   \n\tV4L2_COLORSPACE_SMPTE170M,       \n\tV4L2_COLORSPACE_SMPTE240M,       \n\t0,                               \n\tV4L2_COLORSPACE_BT2020,          \n\t0,                               \n};\n\nstatic const u8 colortransfers[] = {\n\tV4L2_XFER_FUNC_LAST,\n\tV4L2_XFER_FUNC_709,              \n\t0,\n\t0,\n\t0,                               \n\t0,                               \n\tV4L2_XFER_FUNC_709,              \n\tV4L2_XFER_FUNC_SMPTE240M,        \n\tV4L2_XFER_FUNC_NONE,             \n\t0,\n\t0,\n\t0,                               \n\t0,                               \n\tV4L2_XFER_FUNC_SRGB,             \n\tV4L2_XFER_FUNC_709,              \n\tV4L2_XFER_FUNC_709,              \n\tV4L2_XFER_FUNC_SMPTE2084,        \n\t0,                               \n\t0                                \n};\n\nstatic const u8 colormatrixcoefs[] = {\n\tV4L2_YCBCR_ENC_LAST,\n\tV4L2_YCBCR_ENC_709,               \n\t0,\n\t0,\n\t0,                                \n\tV4L2_YCBCR_ENC_601,               \n\tV4L2_YCBCR_ENC_601,               \n\tV4L2_YCBCR_ENC_SMPTE240M,         \n\t0,\n\tV4L2_YCBCR_ENC_BT2020,            \n\tV4L2_YCBCR_ENC_BT2020_CONST_LUM   \n};\n\nu32 vpu_color_cvrt_primaries_v2i(u32 primaries)\n{\n\treturn vpu_helper_find_in_array_u8(colorprimaries, ARRAY_SIZE(colorprimaries), primaries);\n}\n\nu32 vpu_color_cvrt_primaries_i2v(u32 primaries)\n{\n\treturn primaries < ARRAY_SIZE(colorprimaries) ? colorprimaries[primaries] : 0;\n}\n\nu32 vpu_color_cvrt_transfers_v2i(u32 transfers)\n{\n\treturn vpu_helper_find_in_array_u8(colortransfers, ARRAY_SIZE(colortransfers), transfers);\n}\n\nu32 vpu_color_cvrt_transfers_i2v(u32 transfers)\n{\n\treturn transfers < ARRAY_SIZE(colortransfers) ? colortransfers[transfers] : 0;\n}\n\nu32 vpu_color_cvrt_matrix_v2i(u32 matrix)\n{\n\treturn vpu_helper_find_in_array_u8(colormatrixcoefs, ARRAY_SIZE(colormatrixcoefs), matrix);\n}\n\nu32 vpu_color_cvrt_matrix_i2v(u32 matrix)\n{\n\treturn matrix < ARRAY_SIZE(colormatrixcoefs) ? colormatrixcoefs[matrix] : 0;\n}\n\nu32 vpu_color_cvrt_full_range_v2i(u32 full_range)\n{\n\treturn (full_range == V4L2_QUANTIZATION_FULL_RANGE);\n}\n\nu32 vpu_color_cvrt_full_range_i2v(u32 full_range)\n{\n\tif (full_range)\n\t\treturn V4L2_QUANTIZATION_FULL_RANGE;\n\n\treturn V4L2_QUANTIZATION_LIM_RANGE;\n}\n\nint vpu_color_check_primaries(u32 primaries)\n{\n\treturn vpu_color_cvrt_primaries_v2i(primaries) ? 0 : -EINVAL;\n}\n\nint vpu_color_check_transfers(u32 transfers)\n{\n\treturn vpu_color_cvrt_transfers_v2i(transfers) ? 0 : -EINVAL;\n}\n\nint vpu_color_check_matrix(u32 matrix)\n{\n\treturn vpu_color_cvrt_matrix_v2i(matrix) ? 0 : -EINVAL;\n}\n\nint vpu_color_check_full_range(u32 full_range)\n{\n\tint ret = -EINVAL;\n\n\tswitch (full_range) {\n\tcase V4L2_QUANTIZATION_FULL_RANGE:\n\tcase V4L2_QUANTIZATION_LIM_RANGE:\n\t\tret = 0;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nint vpu_color_get_default(u32 primaries, u32 *ptransfers, u32 *pmatrix, u32 *pfull_range)\n{\n\tu32 transfers;\n\tu32 matrix;\n\tu32 full_range;\n\n\tswitch (primaries) {\n\tcase V4L2_COLORSPACE_REC709:\n\t\ttransfers = V4L2_XFER_FUNC_709;\n\t\tmatrix = V4L2_YCBCR_ENC_709;\n\t\tbreak;\n\tcase V4L2_COLORSPACE_470_SYSTEM_M:\n\tcase V4L2_COLORSPACE_470_SYSTEM_BG:\n\tcase V4L2_COLORSPACE_SMPTE170M:\n\t\ttransfers = V4L2_XFER_FUNC_709;\n\t\tmatrix = V4L2_YCBCR_ENC_601;\n\t\tbreak;\n\tcase V4L2_COLORSPACE_SMPTE240M:\n\t\ttransfers = V4L2_XFER_FUNC_SMPTE240M;\n\t\tmatrix = V4L2_YCBCR_ENC_SMPTE240M;\n\t\tbreak;\n\tcase V4L2_COLORSPACE_BT2020:\n\t\ttransfers = V4L2_XFER_FUNC_709;\n\t\tmatrix = V4L2_YCBCR_ENC_BT2020;\n\t\tbreak;\n\tdefault:\n\t\ttransfers = V4L2_XFER_FUNC_DEFAULT;\n\t\tmatrix = V4L2_YCBCR_ENC_DEFAULT;\n\t\tbreak;\n\t}\n\tfull_range = V4L2_QUANTIZATION_LIM_RANGE;\n\n\tif (ptransfers)\n\t\t*ptransfers = transfers;\n\tif (pmatrix)\n\t\t*pmatrix = matrix;\n\tif (pfull_range)\n\t\t*pfull_range = full_range;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}