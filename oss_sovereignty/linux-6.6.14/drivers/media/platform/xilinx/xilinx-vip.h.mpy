{
  "module_name": "xilinx-vip.h",
  "hash_id": "79b406f4b4b5b44ad55b15b44057caef374862291132bfc6f3189238565d77f8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/xilinx/xilinx-vip.h",
  "human_readable_source": " \n \n\n#ifndef __XILINX_VIP_H__\n#define __XILINX_VIP_H__\n\n#include <linux/bitops.h>\n#include <linux/io.h>\n#include <media/v4l2-subdev.h>\n\nstruct clk;\n\n \n#define XVIP_MIN_WIDTH\t\t\t32\n#define XVIP_MAX_WIDTH\t\t\t7680\n#define XVIP_MIN_HEIGHT\t\t\t32\n#define XVIP_MAX_HEIGHT\t\t\t7680\n\n \n#define XVIP_PAD_SINK\t\t\t0\n#define XVIP_PAD_SOURCE\t\t\t1\n\n \n#define XVIP_CTRL_CONTROL\t\t\t0x0000\n#define XVIP_CTRL_CONTROL_SW_ENABLE\t\tBIT(0)\n#define XVIP_CTRL_CONTROL_REG_UPDATE\t\tBIT(1)\n#define XVIP_CTRL_CONTROL_BYPASS\t\tBIT(4)\n#define XVIP_CTRL_CONTROL_TEST_PATTERN\t\tBIT(5)\n#define XVIP_CTRL_CONTROL_FRAME_SYNC_RESET\tBIT(30)\n#define XVIP_CTRL_CONTROL_SW_RESET\t\tBIT(31)\n#define XVIP_CTRL_STATUS\t\t\t0x0004\n#define XVIP_CTRL_STATUS_PROC_STARTED\t\tBIT(0)\n#define XVIP_CTRL_STATUS_EOF\t\t\tBIT(1)\n#define XVIP_CTRL_ERROR\t\t\t\t0x0008\n#define XVIP_CTRL_ERROR_SLAVE_EOL_EARLY\t\tBIT(0)\n#define XVIP_CTRL_ERROR_SLAVE_EOL_LATE\t\tBIT(1)\n#define XVIP_CTRL_ERROR_SLAVE_SOF_EARLY\t\tBIT(2)\n#define XVIP_CTRL_ERROR_SLAVE_SOF_LATE\t\tBIT(3)\n#define XVIP_CTRL_IRQ_ENABLE\t\t\t0x000c\n#define XVIP_CTRL_IRQ_ENABLE_PROC_STARTED\tBIT(0)\n#define XVIP_CTRL_IRQ_EOF\t\t\tBIT(1)\n#define XVIP_CTRL_VERSION\t\t\t0x0010\n#define XVIP_CTRL_VERSION_MAJOR_MASK\t\t(0xff << 24)\n#define XVIP_CTRL_VERSION_MAJOR_SHIFT\t\t24\n#define XVIP_CTRL_VERSION_MINOR_MASK\t\t(0xff << 16)\n#define XVIP_CTRL_VERSION_MINOR_SHIFT\t\t16\n#define XVIP_CTRL_VERSION_REVISION_MASK\t\t(0xf << 12)\n#define XVIP_CTRL_VERSION_REVISION_SHIFT\t12\n#define XVIP_CTRL_VERSION_PATCH_MASK\t\t(0xf << 8)\n#define XVIP_CTRL_VERSION_PATCH_SHIFT\t\t8\n#define XVIP_CTRL_VERSION_INTERNAL_MASK\t\t(0xff << 0)\n#define XVIP_CTRL_VERSION_INTERNAL_SHIFT\t0\n\n \n#define XVIP_ACTIVE_SIZE\t\t\t0x0020\n#define XVIP_ACTIVE_VSIZE_MASK\t\t\t(0x7ff << 16)\n#define XVIP_ACTIVE_VSIZE_SHIFT\t\t\t16\n#define XVIP_ACTIVE_HSIZE_MASK\t\t\t(0x7ff << 0)\n#define XVIP_ACTIVE_HSIZE_SHIFT\t\t\t0\n#define XVIP_ENCODING\t\t\t\t0x0028\n#define XVIP_ENCODING_NBITS_8\t\t\t(0 << 4)\n#define XVIP_ENCODING_NBITS_10\t\t\t(1 << 4)\n#define XVIP_ENCODING_NBITS_12\t\t\t(2 << 4)\n#define XVIP_ENCODING_NBITS_16\t\t\t(3 << 4)\n#define XVIP_ENCODING_NBITS_MASK\t\t(3 << 4)\n#define XVIP_ENCODING_NBITS_SHIFT\t\t4\n#define XVIP_ENCODING_VIDEO_FORMAT_YUV422\t(0 << 0)\n#define XVIP_ENCODING_VIDEO_FORMAT_YUV444\t(1 << 0)\n#define XVIP_ENCODING_VIDEO_FORMAT_RGB\t\t(2 << 0)\n#define XVIP_ENCODING_VIDEO_FORMAT_YUV420\t(3 << 0)\n#define XVIP_ENCODING_VIDEO_FORMAT_MASK\t\t(3 << 0)\n#define XVIP_ENCODING_VIDEO_FORMAT_SHIFT\t0\n\n \nstruct xvip_device {\n\tstruct v4l2_subdev subdev;\n\tstruct device *dev;\n\tvoid __iomem *iomem;\n\tstruct clk *clk;\n\tu32 saved_ctrl;\n};\n\n \nstruct xvip_video_format {\n\tunsigned int vf_code;\n\tunsigned int width;\n\tconst char *pattern;\n\tunsigned int code;\n\tunsigned int bpp;\n\tu32 fourcc;\n};\n\nconst struct xvip_video_format *xvip_get_format_by_code(unsigned int code);\nconst struct xvip_video_format *xvip_get_format_by_fourcc(u32 fourcc);\nconst struct xvip_video_format *xvip_of_get_format(struct device_node *node);\nvoid xvip_set_format_size(struct v4l2_mbus_framefmt *format,\n\t\t\t  const struct v4l2_subdev_format *fmt);\nint xvip_enum_mbus_code(struct v4l2_subdev *subdev,\n\t\t\tstruct v4l2_subdev_state *sd_state,\n\t\t\tstruct v4l2_subdev_mbus_code_enum *code);\nint xvip_enum_frame_size(struct v4l2_subdev *subdev,\n\t\t\t struct v4l2_subdev_state *sd_state,\n\t\t\t struct v4l2_subdev_frame_size_enum *fse);\n\nstatic inline u32 xvip_read(struct xvip_device *xvip, u32 addr)\n{\n\treturn ioread32(xvip->iomem + addr);\n}\n\nstatic inline void xvip_write(struct xvip_device *xvip, u32 addr, u32 value)\n{\n\tiowrite32(value, xvip->iomem + addr);\n}\n\nstatic inline void xvip_clr(struct xvip_device *xvip, u32 addr, u32 clr)\n{\n\txvip_write(xvip, addr, xvip_read(xvip, addr) & ~clr);\n}\n\nstatic inline void xvip_set(struct xvip_device *xvip, u32 addr, u32 set)\n{\n\txvip_write(xvip, addr, xvip_read(xvip, addr) | set);\n}\n\nvoid xvip_clr_or_set(struct xvip_device *xvip, u32 addr, u32 mask, bool set);\nvoid xvip_clr_and_set(struct xvip_device *xvip, u32 addr, u32 clr, u32 set);\n\nint xvip_init_resources(struct xvip_device *xvip);\nvoid xvip_cleanup_resources(struct xvip_device *xvip);\n\nstatic inline void xvip_reset(struct xvip_device *xvip)\n{\n\txvip_write(xvip, XVIP_CTRL_CONTROL, XVIP_CTRL_CONTROL_SW_RESET);\n}\n\nstatic inline void xvip_start(struct xvip_device *xvip)\n{\n\txvip_set(xvip, XVIP_CTRL_CONTROL,\n\t\t XVIP_CTRL_CONTROL_SW_ENABLE | XVIP_CTRL_CONTROL_REG_UPDATE);\n}\n\nstatic inline void xvip_stop(struct xvip_device *xvip)\n{\n\txvip_clr(xvip, XVIP_CTRL_CONTROL, XVIP_CTRL_CONTROL_SW_ENABLE);\n}\n\nstatic inline void xvip_resume(struct xvip_device *xvip)\n{\n\txvip_write(xvip, XVIP_CTRL_CONTROL,\n\t\t   xvip->saved_ctrl | XVIP_CTRL_CONTROL_SW_ENABLE);\n}\n\nstatic inline void xvip_suspend(struct xvip_device *xvip)\n{\n\txvip->saved_ctrl = xvip_read(xvip, XVIP_CTRL_CONTROL);\n\txvip_write(xvip, XVIP_CTRL_CONTROL,\n\t\t   xvip->saved_ctrl & ~XVIP_CTRL_CONTROL_SW_ENABLE);\n}\n\nstatic inline void xvip_set_frame_size(struct xvip_device *xvip,\n\t\t\t\t       const struct v4l2_mbus_framefmt *format)\n{\n\txvip_write(xvip, XVIP_ACTIVE_SIZE,\n\t\t   (format->height << XVIP_ACTIVE_VSIZE_SHIFT) |\n\t\t   (format->width << XVIP_ACTIVE_HSIZE_SHIFT));\n}\n\nstatic inline void xvip_get_frame_size(struct xvip_device *xvip,\n\t\t\t\t       struct v4l2_mbus_framefmt *format)\n{\n\tu32 reg;\n\n\treg = xvip_read(xvip, XVIP_ACTIVE_SIZE);\n\tformat->width = (reg & XVIP_ACTIVE_HSIZE_MASK) >>\n\t\t\tXVIP_ACTIVE_HSIZE_SHIFT;\n\tformat->height = (reg & XVIP_ACTIVE_VSIZE_MASK) >>\n\t\t\t XVIP_ACTIVE_VSIZE_SHIFT;\n}\n\nstatic inline void xvip_enable_reg_update(struct xvip_device *xvip)\n{\n\txvip_set(xvip, XVIP_CTRL_CONTROL, XVIP_CTRL_CONTROL_REG_UPDATE);\n}\n\nstatic inline void xvip_disable_reg_update(struct xvip_device *xvip)\n{\n\txvip_clr(xvip, XVIP_CTRL_CONTROL, XVIP_CTRL_CONTROL_REG_UPDATE);\n}\n\nstatic inline void xvip_print_version(struct xvip_device *xvip)\n{\n\tu32 version;\n\n\tversion = xvip_read(xvip, XVIP_CTRL_VERSION);\n\n\tdev_info(xvip->dev, \"device found, version %u.%02x%x\\n\",\n\t\t ((version & XVIP_CTRL_VERSION_MAJOR_MASK) >>\n\t\t  XVIP_CTRL_VERSION_MAJOR_SHIFT),\n\t\t ((version & XVIP_CTRL_VERSION_MINOR_MASK) >>\n\t\t  XVIP_CTRL_VERSION_MINOR_SHIFT),\n\t\t ((version & XVIP_CTRL_VERSION_REVISION_MASK) >>\n\t\t  XVIP_CTRL_VERSION_REVISION_SHIFT));\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}