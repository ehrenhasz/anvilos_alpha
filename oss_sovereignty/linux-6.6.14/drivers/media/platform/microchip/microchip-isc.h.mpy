{
  "module_name": "microchip-isc.h",
  "hash_id": "98bfdcbe07f3cc2974d42d81fb6571b1b3d02afc1a2b4a0299bc1bbb158cbf15",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/microchip/microchip-isc.h",
  "human_readable_source": " \n \n#ifndef _MICROCHIP_ISC_H_\n\n#include <linux/clk-provider.h>\n#include <linux/platform_device.h>\n\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/videobuf2-dma-contig.h>\n\n#define ISC_CLK_MAX_DIV\t\t255\n\nenum isc_clk_id {\n\tISC_ISPCK = 0,\n\tISC_MCK = 1,\n};\n\nstruct isc_clk {\n\tstruct clk_hw   hw;\n\tstruct clk      *clk;\n\tstruct regmap   *regmap;\n\tspinlock_t\tlock;\t \n\tu8\t\tid;\n\tu8\t\tparent_id;\n\tu32\t\tdiv;\n\tstruct device\t*dev;\n};\n\n#define to_isc_clk(v) container_of(v, struct isc_clk, hw)\n\nstruct isc_buffer {\n\tstruct vb2_v4l2_buffer  vb;\n\tstruct list_head\tlist;\n};\n\nstruct isc_subdev_entity {\n\tstruct v4l2_subdev\t\t*sd;\n\tstruct v4l2_async_connection\t*asd;\n\tstruct device_node\t\t*epn;\n\tstruct v4l2_async_notifier      notifier;\n\n\tu32 pfe_cfg0;\n\n\tstruct list_head list;\n};\n\n \n\nstruct isc_format {\n\tu32\tfourcc;\n\tu32\tmbus_code;\n\tu32\tcfa_baycfg;\n\tu32\tpfe_cfg0_bps;\n\n\tbool\traw;\n};\n\n \n#define DPC_DPCENABLE\tBIT(0)\n#define DPC_GDCENABLE\tBIT(1)\n#define DPC_BLCENABLE\tBIT(2)\n#define WB_ENABLE\tBIT(3)\n#define CFA_ENABLE\tBIT(4)\n#define CC_ENABLE\tBIT(5)\n#define GAM_ENABLE\tBIT(6)\n#define GAM_BENABLE\tBIT(7)\n#define GAM_GENABLE\tBIT(8)\n#define GAM_RENABLE\tBIT(9)\n#define VHXS_ENABLE\tBIT(10)\n#define CSC_ENABLE\tBIT(11)\n#define CBC_ENABLE\tBIT(12)\n#define SUB422_ENABLE\tBIT(13)\n#define SUB420_ENABLE\tBIT(14)\n\n#define GAM_ENABLES\t(GAM_RENABLE | GAM_GENABLE | GAM_BENABLE | GAM_ENABLE)\n\n \nstruct fmt_config {\n\tstruct isc_format\t*sd_format;\n\n\tu32\t\t\tfourcc;\n\tu8\t\t\tbpp;\n\tu8\t\t\tbpp_v4l2;\n\n\tu32\t\t\trlp_cfg_mode;\n\tu32\t\t\tdcfg_imode;\n\tu32\t\t\tdctrl_dview;\n\n\tu32\t\t\tbits_pipeline;\n};\n\n#define HIST_ENTRIES\t\t512\n#define HIST_BAYER\t\t(ISC_HIS_CFG_MODE_B + 1)\n\nenum{\n\tHIST_INIT = 0,\n\tHIST_ENABLED,\n\tHIST_DISABLED,\n};\n\nstruct isc_ctrls {\n\tstruct v4l2_ctrl_handler handler;\n\n\tu32 brightness;\n\tu32 contrast;\n\tu8 gamma_index;\n#define ISC_WB_NONE\t0\n#define ISC_WB_AUTO\t1\n#define ISC_WB_ONETIME\t2\n\tu8 awb;\n\n\t \n\tu32 gain[HIST_BAYER];\n\ts32 offset[HIST_BAYER];\n\n\tu32 hist_entry[HIST_ENTRIES];\n\tu32 hist_count[HIST_BAYER];\n\tu8 hist_id;\n\tu8 hist_stat;\n#define HIST_MIN_INDEX\t\t0\n#define HIST_MAX_INDEX\t\t1\n\tu32 hist_minmax[HIST_BAYER][2];\n};\n\n#define ISC_PIPE_LINE_NODE_NUM\t15\n\n \nstruct isc_reg_offsets {\n\tu32 csc;\n\tu32 cbc;\n\tu32 sub422;\n\tu32 sub420;\n\tu32 rlp;\n\tu32 his;\n\tu32 dma;\n\tu32 version;\n\tu32 his_entry;\n};\n\nenum isc_mc_pads {\n\tISC_PAD_SINK\t= 0,\n\tISC_PADS_NUM\t= 1,\n};\n\nenum isc_scaler_pads {\n\tISC_SCALER_PAD_SINK\t= 0,\n\tISC_SCALER_PAD_SOURCE\t= 1,\n\tISC_SCALER_PADS_NUM\t= 2,\n};\n\n \nstruct isc_device {\n\tstruct regmap\t\t*regmap;\n\tstruct clk\t\t*hclock;\n\tstruct clk\t\t*ispck;\n\tstruct isc_clk\t\tisc_clks[2];\n\tbool\t\t\tispck_required;\n\tu32\t\t\tdcfg;\n\n\tstruct device\t\t*dev;\n\tstruct v4l2_device\tv4l2_dev;\n\tstruct video_device\tvideo_dev;\n\n\tstruct vb2_queue\tvb2_vidq;\n\tspinlock_t\t\tdma_queue_lock;\n\tstruct list_head\tdma_queue;\n\tstruct isc_buffer\t*cur_frm;\n\tunsigned int\t\tsequence;\n\tbool\t\t\tstop;\n\tstruct completion\tcomp;\n\n\tstruct v4l2_format\tfmt;\n\tstruct v4l2_format\ttry_fmt;\n\n\tstruct fmt_config\tconfig;\n\tstruct fmt_config\ttry_config;\n\n\tstruct isc_ctrls\tctrls;\n\tstruct work_struct\tawb_work;\n\n\tstruct mutex\t\tlock;\n\tstruct mutex\t\tawb_mutex;\n\tspinlock_t\t\tawb_lock;\n\n\tstruct regmap_field\t*pipeline[ISC_PIPE_LINE_NODE_NUM];\n\n\tstruct isc_subdev_entity\t*current_subdev;\n\tstruct list_head\t\tsubdev_entities;\n\n\tstruct {\n#define ISC_CTRL_DO_WB 1\n#define ISC_CTRL_R_GAIN 2\n#define ISC_CTRL_B_GAIN 3\n#define ISC_CTRL_GR_GAIN 4\n#define ISC_CTRL_GB_GAIN 5\n#define ISC_CTRL_R_OFF 6\n#define ISC_CTRL_B_OFF 7\n#define ISC_CTRL_GR_OFF 8\n#define ISC_CTRL_GB_OFF 9\n\t\tstruct v4l2_ctrl\t*awb_ctrl;\n\t\tstruct v4l2_ctrl\t*do_wb_ctrl;\n\t\tstruct v4l2_ctrl\t*r_gain_ctrl;\n\t\tstruct v4l2_ctrl\t*b_gain_ctrl;\n\t\tstruct v4l2_ctrl\t*gr_gain_ctrl;\n\t\tstruct v4l2_ctrl\t*gb_gain_ctrl;\n\t\tstruct v4l2_ctrl\t*r_off_ctrl;\n\t\tstruct v4l2_ctrl\t*b_off_ctrl;\n\t\tstruct v4l2_ctrl\t*gr_off_ctrl;\n\t\tstruct v4l2_ctrl\t*gb_off_ctrl;\n\t};\n\n#define GAMMA_ENTRIES\t64\n\t \n\tconst u32\t(*gamma_table)[GAMMA_ENTRIES];\n\tu32\t\tgamma_max;\n\n\tu32\t\tmax_width;\n\tu32\t\tmax_height;\n\n\tstruct {\n\t\tvoid (*config_dpc)(struct isc_device *isc);\n\t\tvoid (*config_csc)(struct isc_device *isc);\n\t\tvoid (*config_cbc)(struct isc_device *isc);\n\t\tvoid (*config_cc)(struct isc_device *isc);\n\t\tvoid (*config_gam)(struct isc_device *isc);\n\t\tvoid (*config_rlp)(struct isc_device *isc);\n\n\t\tvoid (*config_ctrls)(struct isc_device *isc,\n\t\t\t\t     const struct v4l2_ctrl_ops *ops);\n\n\t\tvoid (*adapt_pipeline)(struct isc_device *isc);\n\t};\n\n\tstruct isc_reg_offsets\t\toffsets;\n\tconst struct isc_format\t\t*controller_formats;\n\tstruct isc_format\t\t*formats_list;\n\tu32\t\t\t\tcontroller_formats_size;\n\tu32\t\t\t\tformats_list_size;\n\n\tstruct {\n\t\tstruct media_pad\t\tpads[ISC_PADS_NUM];\n\t\tstruct media_device\t\tmdev;\n\t\tstruct media_pipeline\t\tmpipe;\n\n\t\tu32\t\t\t\tremote_pad;\n\t};\n\n\tstruct {\n\t\tstruct v4l2_subdev\t\tscaler_sd;\n\t\tstruct media_pad\t\tscaler_pads[ISC_SCALER_PADS_NUM];\n\t\tstruct v4l2_mbus_framefmt\tscaler_format[ISC_SCALER_PADS_NUM];\n\t};\n};\n\nextern const struct regmap_config microchip_isc_regmap_config;\nextern const struct v4l2_async_notifier_operations microchip_isc_async_ops;\n\nirqreturn_t microchip_isc_interrupt(int irq, void *dev_id);\nint microchip_isc_pipeline_init(struct isc_device *isc);\nint microchip_isc_clk_init(struct isc_device *isc);\nvoid microchip_isc_subdev_cleanup(struct isc_device *isc);\nvoid microchip_isc_clk_cleanup(struct isc_device *isc);\n\nint isc_scaler_link(struct isc_device *isc);\nint isc_scaler_init(struct isc_device *isc);\nint isc_mc_init(struct isc_device *isc, u32 ver);\nvoid isc_mc_cleanup(struct isc_device *isc);\n\nstruct isc_format *isc_find_format_by_code(struct isc_device *isc,\n\t\t\t\t\t   unsigned int code, int *index);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}