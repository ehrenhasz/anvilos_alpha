{
  "module_name": "bdisp-debug.c",
  "hash_id": "8f1529db05e57c6d584b97cf5f98ad2925b96e6fbc766322ee53733b81e58a82",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/st/sti/bdisp/bdisp-debug.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/pm_runtime.h>\n\n#include \"bdisp.h\"\n#include \"bdisp-filter.h\"\n#include \"bdisp-reg.h\"\n\nvoid bdisp_dbg_perf_begin(struct bdisp_dev *bdisp)\n{\n\tbdisp->dbg.hw_start = ktime_get();\n}\n\nvoid bdisp_dbg_perf_end(struct bdisp_dev *bdisp)\n{\n\ts64 time_us;\n\n\ttime_us = ktime_us_delta(ktime_get(), bdisp->dbg.hw_start);\n\n\tif (!bdisp->dbg.min_duration)\n\t\tbdisp->dbg.min_duration = time_us;\n\telse\n\t\tbdisp->dbg.min_duration = min(time_us, bdisp->dbg.min_duration);\n\n\tbdisp->dbg.last_duration = time_us;\n\tbdisp->dbg.max_duration = max(time_us, bdisp->dbg.max_duration);\n\tbdisp->dbg.tot_duration += time_us;\n}\n\nstatic void bdisp_dbg_dump_ins(struct seq_file *s, u32 val)\n{\n\tseq_printf(s, \"INS\\t0x%08X\\t\", val);\n\n\tswitch (val & BLT_INS_S1_MASK) {\n\tcase BLT_INS_S1_OFF:\n\t\tbreak;\n\tcase BLT_INS_S1_MEM:\n\t\tseq_puts(s, \"SRC1=mem - \");\n\t\tbreak;\n\tcase BLT_INS_S1_CF:\n\t\tseq_puts(s, \"SRC1=ColorFill - \");\n\t\tbreak;\n\tcase BLT_INS_S1_COPY:\n\t\tseq_puts(s, \"SRC1=copy - \");\n\t\tbreak;\n\tcase BLT_INS_S1_FILL:\n\t\tseq_puts(s, \"SRC1=fil - \");\n\t\tbreak;\n\tdefault:\n\t\tseq_puts(s, \"SRC1=??? - \");\n\t\tbreak;\n\t}\n\n\tswitch (val & BLT_INS_S2_MASK) {\n\tcase BLT_INS_S2_OFF:\n\t\tbreak;\n\tcase BLT_INS_S2_MEM:\n\t\tseq_puts(s, \"SRC2=mem - \");\n\t\tbreak;\n\tcase BLT_INS_S2_CF:\n\t\tseq_puts(s, \"SRC2=ColorFill - \");\n\t\tbreak;\n\tdefault:\n\t\tseq_puts(s, \"SRC2=??? - \");\n\t\tbreak;\n\t}\n\n\tif ((val & BLT_INS_S3_MASK) == BLT_INS_S3_MEM)\n\t\tseq_puts(s, \"SRC3=mem - \");\n\n\tif (val & BLT_INS_IVMX)\n\t\tseq_puts(s, \"IVMX - \");\n\tif (val & BLT_INS_CLUT)\n\t\tseq_puts(s, \"CLUT - \");\n\tif (val & BLT_INS_SCALE)\n\t\tseq_puts(s, \"Scale - \");\n\tif (val & BLT_INS_FLICK)\n\t\tseq_puts(s, \"Flicker - \");\n\tif (val & BLT_INS_CLIP)\n\t\tseq_puts(s, \"Clip - \");\n\tif (val & BLT_INS_CKEY)\n\t\tseq_puts(s, \"ColorKey - \");\n\tif (val & BLT_INS_OVMX)\n\t\tseq_puts(s, \"OVMX - \");\n\tif (val & BLT_INS_DEI)\n\t\tseq_puts(s, \"Deint - \");\n\tif (val & BLT_INS_PMASK)\n\t\tseq_puts(s, \"PlaneMask - \");\n\tif (val & BLT_INS_VC1R)\n\t\tseq_puts(s, \"VC1R - \");\n\tif (val & BLT_INS_ROTATE)\n\t\tseq_puts(s, \"Rotate - \");\n\tif (val & BLT_INS_GRAD)\n\t\tseq_puts(s, \"GradFill - \");\n\tif (val & BLT_INS_AQLOCK)\n\t\tseq_puts(s, \"AQLock - \");\n\tif (val & BLT_INS_PACE)\n\t\tseq_puts(s, \"Pace - \");\n\tif (val & BLT_INS_IRQ)\n\t\tseq_puts(s, \"IRQ - \");\n\n\tseq_putc(s, '\\n');\n}\n\nstatic void bdisp_dbg_dump_tty(struct seq_file *s, u32 val)\n{\n\tseq_printf(s, \"TTY\\t0x%08X\\t\", val);\n\tseq_printf(s, \"Pitch=%d - \", val & 0xFFFF);\n\n\tswitch ((val & BLT_TTY_COL_MASK) >> BLT_TTY_COL_SHIFT) {\n\tcase BDISP_RGB565:\n\t\tseq_puts(s, \"RGB565 - \");\n\t\tbreak;\n\tcase BDISP_RGB888:\n\t\tseq_puts(s, \"RGB888 - \");\n\t\tbreak;\n\tcase BDISP_XRGB8888:\n\t\tseq_puts(s, \"xRGB888 - \");\n\t\tbreak;\n\tcase BDISP_ARGB8888:\n\t\tseq_puts(s, \"ARGB8888 - \");\n\t\tbreak;\n\tcase BDISP_NV12:\n\t\tseq_puts(s, \"NV12 - \");\n\t\tbreak;\n\tcase BDISP_YUV_3B:\n\t\tseq_puts(s, \"YUV420P - \");\n\t\tbreak;\n\tdefault:\n\t\tseq_puts(s, \"ColorFormat ??? - \");\n\t\tbreak;\n\t}\n\n\tif (val & BLT_TTY_ALPHA_R)\n\t\tseq_puts(s, \"AlphaRange - \");\n\tif (val & BLT_TTY_CR_NOT_CB)\n\t\tseq_puts(s, \"CrNotCb - \");\n\tif (val & BLT_TTY_MB)\n\t\tseq_puts(s, \"MB - \");\n\tif (val & BLT_TTY_HSO)\n\t\tseq_puts(s, \"HSO inverse - \");\n\tif (val & BLT_TTY_VSO)\n\t\tseq_puts(s, \"VSO inverse - \");\n\tif (val & BLT_TTY_DITHER)\n\t\tseq_puts(s, \"Dither - \");\n\tif (val & BLT_TTY_CHROMA)\n\t\tseq_puts(s, \"Write CHROMA - \");\n\tif (val & BLT_TTY_BIG_END)\n\t\tseq_puts(s, \"BigEndian - \");\n\n\tseq_putc(s, '\\n');\n}\n\nstatic void bdisp_dbg_dump_xy(struct seq_file *s, u32 val, char *name)\n{\n\tseq_printf(s, \"%s\\t0x%08X\\t\", name, val);\n\tseq_printf(s, \"(%d,%d)\\n\", val & 0xFFFF, (val >> 16));\n}\n\nstatic void bdisp_dbg_dump_sz(struct seq_file *s, u32 val, char *name)\n{\n\tseq_printf(s, \"%s\\t0x%08X\\t\", name, val);\n\tseq_printf(s, \"%dx%d\\n\", val & 0x1FFF, (val >> 16) & 0x1FFF);\n}\n\nstatic void bdisp_dbg_dump_sty(struct seq_file *s,\n\t\t\t       u32 val, u32 addr, char *name)\n{\n\tbool s1, s2, s3;\n\n\tseq_printf(s, \"%s\\t0x%08X\\t\", name, val);\n\n\tif (!addr || !name || (strlen(name) < 2))\n\t\tgoto done;\n\n\ts1 = name[strlen(name) - 1] == '1';\n\ts2 = name[strlen(name) - 1] == '2';\n\ts3 = name[strlen(name) - 1] == '3';\n\n\tseq_printf(s, \"Pitch=%d - \", val & 0xFFFF);\n\n\tswitch ((val & BLT_TTY_COL_MASK) >> BLT_TTY_COL_SHIFT) {\n\tcase BDISP_RGB565:\n\t\tseq_puts(s, \"RGB565 - \");\n\t\tbreak;\n\tcase BDISP_RGB888:\n\t\tseq_puts(s, \"RGB888 - \");\n\t\tbreak;\n\tcase BDISP_XRGB8888:\n\t\tseq_puts(s, \"xRGB888 - \");\n\t\tbreak;\n\tcase BDISP_ARGB8888:\n\t\tseq_puts(s, \"ARGB888 - \");\n\t\tbreak;\n\tcase BDISP_NV12:\n\t\tseq_puts(s, \"NV12 - \");\n\t\tbreak;\n\tcase BDISP_YUV_3B:\n\t\tseq_puts(s, \"YUV420P - \");\n\t\tbreak;\n\tdefault:\n\t\tseq_puts(s, \"ColorFormat ??? - \");\n\t\tbreak;\n\t}\n\n\tif ((val & BLT_TTY_ALPHA_R) && !s3)\n\t\tseq_puts(s, \"AlphaRange - \");\n\tif ((val & BLT_S1TY_A1_SUBSET) && !s3)\n\t\tseq_puts(s, \"A1SubSet - \");\n\tif ((val & BLT_TTY_MB) && !s1)\n\t\tseq_puts(s, \"MB - \");\n\tif (val & BLT_TTY_HSO)\n\t\tseq_puts(s, \"HSO inverse - \");\n\tif (val & BLT_TTY_VSO)\n\t\tseq_puts(s, \"VSO inverse - \");\n\tif ((val & BLT_S1TY_CHROMA_EXT) && (s1 || s2))\n\t\tseq_puts(s, \"ChromaExt - \");\n\tif ((val & BLT_S3TY_BLANK_ACC) && s3)\n\t\tseq_puts(s, \"Blank Acc - \");\n\tif ((val & BTL_S1TY_SUBBYTE) && !s3)\n\t\tseq_puts(s, \"SubByte - \");\n\tif ((val & BLT_S1TY_RGB_EXP) && !s3)\n\t\tseq_puts(s, \"RGBExpand - \");\n\tif ((val & BLT_TTY_BIG_END) && !s3)\n\t\tseq_puts(s, \"BigEndian - \");\n\ndone:\n\tseq_putc(s, '\\n');\n}\n\nstatic void bdisp_dbg_dump_fctl(struct seq_file *s, u32 val)\n{\n\tseq_printf(s, \"FCTL\\t0x%08X\\t\", val);\n\n\tif ((val & BLT_FCTL_Y_HV_SCALE) == BLT_FCTL_Y_HV_SCALE)\n\t\tseq_puts(s, \"Resize Luma - \");\n\telse if ((val & BLT_FCTL_Y_HV_SCALE) == BLT_FCTL_Y_HV_SAMPLE)\n\t\tseq_puts(s, \"Sample Luma - \");\n\n\tif ((val & BLT_FCTL_HV_SCALE) == BLT_FCTL_HV_SCALE)\n\t\tseq_puts(s, \"Resize Chroma\");\n\telse if ((val & BLT_FCTL_HV_SCALE) == BLT_FCTL_HV_SAMPLE)\n\t\tseq_puts(s, \"Sample Chroma\");\n\n\tseq_putc(s, '\\n');\n}\n\nstatic void bdisp_dbg_dump_rsf(struct seq_file *s, u32 val, char *name)\n{\n\tu32 inc;\n\n\tseq_printf(s, \"%s\\t0x%08X\\t\", name, val);\n\n\tif (!val)\n\t\tgoto done;\n\n\tinc = val & 0xFFFF;\n\tseq_printf(s, \"H: %d(6.10) / scale~%dx0.1 - \", inc, 1024 * 10 / inc);\n\n\tinc = val >> 16;\n\tseq_printf(s, \"V: %d(6.10) / scale~%dx0.1\", inc, 1024 * 10 / inc);\n\ndone:\n\tseq_putc(s, '\\n');\n}\n\nstatic void bdisp_dbg_dump_rzi(struct seq_file *s, u32 val, char *name)\n{\n\tseq_printf(s, \"%s\\t0x%08X\\t\", name, val);\n\n\tif (!val)\n\t\tgoto done;\n\n\tseq_printf(s, \"H: init=%d repeat=%d - \", val & 0x3FF, (val >> 12) & 7);\n\tval >>= 16;\n\tseq_printf(s, \"V: init=%d repeat=%d\", val & 0x3FF, (val >> 12) & 7);\n\ndone:\n\tseq_putc(s, '\\n');\n}\n\nstatic void bdisp_dbg_dump_ivmx(struct seq_file *s,\n\t\t\t\tu32 c0, u32 c1, u32 c2, u32 c3)\n{\n\tseq_printf(s, \"IVMX0\\t0x%08X\\n\", c0);\n\tseq_printf(s, \"IVMX1\\t0x%08X\\n\", c1);\n\tseq_printf(s, \"IVMX2\\t0x%08X\\n\", c2);\n\tseq_printf(s, \"IVMX3\\t0x%08X\\t\", c3);\n\n\tif (!c0 && !c1 && !c2 && !c3) {\n\t\tseq_putc(s, '\\n');\n\t\treturn;\n\t}\n\n\tif ((c0 == bdisp_rgb_to_yuv[0]) &&\n\t    (c1 == bdisp_rgb_to_yuv[1]) &&\n\t    (c2 == bdisp_rgb_to_yuv[2]) &&\n\t    (c3 == bdisp_rgb_to_yuv[3])) {\n\t\tseq_puts(s, \"RGB to YUV\\n\");\n\t\treturn;\n\t}\n\n\tif ((c0 == bdisp_yuv_to_rgb[0]) &&\n\t    (c1 == bdisp_yuv_to_rgb[1]) &&\n\t    (c2 == bdisp_yuv_to_rgb[2]) &&\n\t    (c3 == bdisp_yuv_to_rgb[3])) {\n\t\tseq_puts(s, \"YUV to RGB\\n\");\n\t\treturn;\n\t}\n\tseq_puts(s, \"Unknown conversion\\n\");\n}\n\nstatic int last_nodes_show(struct seq_file *s, void *data)\n{\n\t \n\tstruct bdisp_dev *bdisp = s->private;\n\tstruct bdisp_node *node;\n\tint i = 0;\n\n\tif (!bdisp->dbg.copy_node[0]) {\n\t\tseq_puts(s, \"No node built yet\\n\");\n\t\treturn 0;\n\t}\n\n\tdo {\n\t\tnode = bdisp->dbg.copy_node[i];\n\t\tif (!node)\n\t\t\tbreak;\n\t\tseq_printf(s, \"--------\\nNode %d:\\n\", i);\n\t\tseq_puts(s, \"-- General --\\n\");\n\t\tseq_printf(s, \"NIP\\t0x%08X\\n\", node->nip);\n\t\tseq_printf(s, \"CIC\\t0x%08X\\n\", node->cic);\n\t\tbdisp_dbg_dump_ins(s, node->ins);\n\t\tseq_printf(s, \"ACK\\t0x%08X\\n\", node->ack);\n\t\tseq_puts(s, \"-- Target --\\n\");\n\t\tseq_printf(s, \"TBA\\t0x%08X\\n\", node->tba);\n\t\tbdisp_dbg_dump_tty(s, node->tty);\n\t\tbdisp_dbg_dump_xy(s, node->txy, \"TXY\");\n\t\tbdisp_dbg_dump_sz(s, node->tsz, \"TSZ\");\n\t\t \n\t\tseq_puts(s, \"-- Source 1 --\\n\");\n\t\tseq_printf(s, \"S1BA\\t0x%08X\\n\", node->s1ba);\n\t\tbdisp_dbg_dump_sty(s, node->s1ty, node->s1ba, \"S1TY\");\n\t\tbdisp_dbg_dump_xy(s, node->s1xy, \"S1XY\");\n\t\tseq_puts(s, \"-- Source 2 --\\n\");\n\t\tseq_printf(s, \"S2BA\\t0x%08X\\n\", node->s2ba);\n\t\tbdisp_dbg_dump_sty(s, node->s2ty, node->s2ba, \"S2TY\");\n\t\tbdisp_dbg_dump_xy(s, node->s2xy, \"S2XY\");\n\t\tbdisp_dbg_dump_sz(s, node->s2sz, \"S2SZ\");\n\t\tseq_puts(s, \"-- Source 3 --\\n\");\n\t\tseq_printf(s, \"S3BA\\t0x%08X\\n\", node->s3ba);\n\t\tbdisp_dbg_dump_sty(s, node->s3ty, node->s3ba, \"S3TY\");\n\t\tbdisp_dbg_dump_xy(s, node->s3xy, \"S3XY\");\n\t\tbdisp_dbg_dump_sz(s, node->s3sz, \"S3SZ\");\n\t\t \n\t\t \n\t\tseq_puts(s, \"-- Filter & Mask --\\n\");\n\t\tbdisp_dbg_dump_fctl(s, node->fctl);\n\t\t \n\t\tseq_puts(s, \"-- Chroma Filter --\\n\");\n\t\tbdisp_dbg_dump_rsf(s, node->rsf, \"RSF\");\n\t\tbdisp_dbg_dump_rzi(s, node->rzi, \"RZI\");\n\t\tseq_printf(s, \"HFP\\t0x%08X\\n\", node->hfp);\n\t\tseq_printf(s, \"VFP\\t0x%08X\\n\", node->vfp);\n\t\tseq_puts(s, \"-- Luma Filter --\\n\");\n\t\tbdisp_dbg_dump_rsf(s, node->y_rsf, \"Y_RSF\");\n\t\tbdisp_dbg_dump_rzi(s, node->y_rzi, \"Y_RZI\");\n\t\tseq_printf(s, \"Y_HFP\\t0x%08X\\n\", node->y_hfp);\n\t\tseq_printf(s, \"Y_VFP\\t0x%08X\\n\", node->y_vfp);\n\t\t \n\t\t \n\t\t \n\t\t \n\t\tseq_puts(s, \"-- Input Versatile Matrix --\\n\");\n\t\tbdisp_dbg_dump_ivmx(s, node->ivmx0, node->ivmx1,\n\t\t\t\t    node->ivmx2, node->ivmx3);\n\t\t \n\t\t \n\t\t \n\t\t \n\t} while ((++i < MAX_NB_NODE) && node->nip);\n\n\treturn 0;\n}\n\nstatic int last_nodes_raw_show(struct seq_file *s, void *data)\n{\n\tstruct bdisp_dev *bdisp = s->private;\n\tstruct bdisp_node *node;\n\tu32 *val;\n\tint j, i = 0;\n\n\tif (!bdisp->dbg.copy_node[0]) {\n\t\tseq_puts(s, \"No node built yet\\n\");\n\t\treturn 0;\n\t}\n\n\tdo {\n\t\tnode = bdisp->dbg.copy_node[i];\n\t\tif (!node)\n\t\t\tbreak;\n\n\t\tseq_printf(s, \"--------\\nNode %d:\\n\", i);\n\t\tval = (u32 *)node;\n\t\tfor (j = 0; j < sizeof(struct bdisp_node) / sizeof(u32); j++)\n\t\t\tseq_printf(s, \"0x%08X\\n\", *val++);\n\t} while ((++i < MAX_NB_NODE) && node->nip);\n\n\treturn 0;\n}\n\nstatic const char *bdisp_fmt_to_str(struct bdisp_frame frame)\n{\n\tswitch (frame.fmt->pixelformat) {\n\tcase V4L2_PIX_FMT_YUV420:\n\t\treturn \"YUV420P\";\n\tcase V4L2_PIX_FMT_NV12:\n\t\tif (frame.field == V4L2_FIELD_INTERLACED)\n\t\t\treturn \"NV12 interlaced\";\n\t\telse\n\t\t\treturn \"NV12\";\n\tcase V4L2_PIX_FMT_RGB565:\n\t\treturn \"RGB16\";\n\tcase V4L2_PIX_FMT_RGB24:\n\t\treturn \"RGB24\";\n\tcase V4L2_PIX_FMT_XBGR32:\n\t\treturn \"XRGB\";\n\tcase V4L2_PIX_FMT_ABGR32:\n\t\treturn \"ARGB\";\n\tdefault:\n\t\treturn \"????\";\n\t}\n}\n\nstatic int last_request_show(struct seq_file *s, void *data)\n{\n\tstruct bdisp_dev *bdisp = s->private;\n\tstruct bdisp_request *request = &bdisp->dbg.copy_request;\n\tstruct bdisp_frame src, dst;\n\n\tif (!request->nb_req) {\n\t\tseq_puts(s, \"No request\\n\");\n\t\treturn 0;\n\t}\n\n\tsrc = request->src;\n\tdst = request->dst;\n\n\tseq_printf(s, \"\\nRequest #%d\\n\", request->nb_req);\n\n\tseq_printf(s, \"Format:    %s\\t\\t\\t%s\\n\",\n\t\t   bdisp_fmt_to_str(src), bdisp_fmt_to_str(dst));\n\tseq_printf(s, \"Crop area: %dx%d @ %d,%d  ==>\\t%dx%d @ %d,%d\\n\",\n\t\t   src.crop.width, src.crop.height,\n\t\t   src.crop.left, src.crop.top,\n\t\t   dst.crop.width, dst.crop.height,\n\t\t   dst.crop.left, dst.crop.top);\n\tseq_printf(s, \"Buff size: %dx%d\\t\\t%dx%d\\n\\n\",\n\t\t   src.width, src.height, dst.width, dst.height);\n\n\tif (request->hflip)\n\t\tseq_puts(s, \"Horizontal flip\\n\\n\");\n\n\tif (request->vflip)\n\t\tseq_puts(s, \"Vertical flip\\n\\n\");\n\n\treturn 0;\n}\n\n#define DUMP(reg) seq_printf(s, #reg \" \\t0x%08X\\n\", readl(bdisp->regs + reg))\n\nstatic int regs_show(struct seq_file *s, void *data)\n{\n\tstruct bdisp_dev *bdisp = s->private;\n\tint ret;\n\tunsigned int i;\n\n\tret = pm_runtime_resume_and_get(bdisp->dev);\n\tif (ret < 0) {\n\t\tseq_puts(s, \"Cannot wake up IP\\n\");\n\t\treturn 0;\n\t}\n\n\tseq_printf(s, \"Reg @ = 0x%p\\n\", bdisp->regs);\n\n\tseq_puts(s, \"\\nStatic:\\n\");\n\tDUMP(BLT_CTL);\n\tDUMP(BLT_ITS);\n\tDUMP(BLT_STA1);\n\tDUMP(BLT_AQ1_CTL);\n\tDUMP(BLT_AQ1_IP);\n\tDUMP(BLT_AQ1_LNA);\n\tDUMP(BLT_AQ1_STA);\n\tDUMP(BLT_ITM0);\n\n\tseq_puts(s, \"\\nPlugs:\\n\");\n\tDUMP(BLT_PLUGS1_OP2);\n\tDUMP(BLT_PLUGS1_CHZ);\n\tDUMP(BLT_PLUGS1_MSZ);\n\tDUMP(BLT_PLUGS1_PGZ);\n\tDUMP(BLT_PLUGS2_OP2);\n\tDUMP(BLT_PLUGS2_CHZ);\n\tDUMP(BLT_PLUGS2_MSZ);\n\tDUMP(BLT_PLUGS2_PGZ);\n\tDUMP(BLT_PLUGS3_OP2);\n\tDUMP(BLT_PLUGS3_CHZ);\n\tDUMP(BLT_PLUGS3_MSZ);\n\tDUMP(BLT_PLUGS3_PGZ);\n\tDUMP(BLT_PLUGT_OP2);\n\tDUMP(BLT_PLUGT_CHZ);\n\tDUMP(BLT_PLUGT_MSZ);\n\tDUMP(BLT_PLUGT_PGZ);\n\n\tseq_puts(s, \"\\nNode:\\n\");\n\tDUMP(BLT_NIP);\n\tDUMP(BLT_CIC);\n\tDUMP(BLT_INS);\n\tDUMP(BLT_ACK);\n\tDUMP(BLT_TBA);\n\tDUMP(BLT_TTY);\n\tDUMP(BLT_TXY);\n\tDUMP(BLT_TSZ);\n\tDUMP(BLT_S1BA);\n\tDUMP(BLT_S1TY);\n\tDUMP(BLT_S1XY);\n\tDUMP(BLT_S2BA);\n\tDUMP(BLT_S2TY);\n\tDUMP(BLT_S2XY);\n\tDUMP(BLT_S2SZ);\n\tDUMP(BLT_S3BA);\n\tDUMP(BLT_S3TY);\n\tDUMP(BLT_S3XY);\n\tDUMP(BLT_S3SZ);\n\tDUMP(BLT_FCTL);\n\tDUMP(BLT_RSF);\n\tDUMP(BLT_RZI);\n\tDUMP(BLT_HFP);\n\tDUMP(BLT_VFP);\n\tDUMP(BLT_Y_RSF);\n\tDUMP(BLT_Y_RZI);\n\tDUMP(BLT_Y_HFP);\n\tDUMP(BLT_Y_VFP);\n\tDUMP(BLT_IVMX0);\n\tDUMP(BLT_IVMX1);\n\tDUMP(BLT_IVMX2);\n\tDUMP(BLT_IVMX3);\n\tDUMP(BLT_OVMX0);\n\tDUMP(BLT_OVMX1);\n\tDUMP(BLT_OVMX2);\n\tDUMP(BLT_OVMX3);\n\tDUMP(BLT_DEI);\n\n\tseq_puts(s, \"\\nFilter:\\n\");\n\tfor (i = 0; i < BLT_NB_H_COEF; i++) {\n\t\tseq_printf(s, \"BLT_HFC%d \\t0x%08X\\n\", i,\n\t\t\t   readl(bdisp->regs + BLT_HFC_N + i * 4));\n\t}\n\tfor (i = 0; i < BLT_NB_V_COEF; i++) {\n\t\tseq_printf(s, \"BLT_VFC%d \\t0x%08X\\n\", i,\n\t\t\t   readl(bdisp->regs + BLT_VFC_N + i * 4));\n\t}\n\n\tseq_puts(s, \"\\nLuma filter:\\n\");\n\tfor (i = 0; i < BLT_NB_H_COEF; i++) {\n\t\tseq_printf(s, \"BLT_Y_HFC%d \\t0x%08X\\n\", i,\n\t\t\t   readl(bdisp->regs + BLT_Y_HFC_N + i * 4));\n\t}\n\tfor (i = 0; i < BLT_NB_V_COEF; i++) {\n\t\tseq_printf(s, \"BLT_Y_VFC%d \\t0x%08X\\n\", i,\n\t\t\t   readl(bdisp->regs + BLT_Y_VFC_N + i * 4));\n\t}\n\n\tpm_runtime_put(bdisp->dev);\n\n\treturn 0;\n}\n\n#define SECOND 1000000\n\nstatic int perf_show(struct seq_file *s, void *data)\n{\n\tstruct bdisp_dev *bdisp = s->private;\n\tstruct bdisp_request *request = &bdisp->dbg.copy_request;\n\ts64 avg_time_us;\n\tint avg_fps, min_fps, max_fps, last_fps;\n\n\tif (!request->nb_req) {\n\t\tseq_puts(s, \"No request\\n\");\n\t\treturn 0;\n\t}\n\n\tavg_time_us = div64_s64(bdisp->dbg.tot_duration, request->nb_req);\n\tif (avg_time_us > SECOND)\n\t\tavg_fps = 0;\n\telse\n\t\tavg_fps = SECOND / (s32)avg_time_us;\n\n\tif (bdisp->dbg.min_duration > SECOND)\n\t\tmin_fps = 0;\n\telse\n\t\tmin_fps = SECOND / (s32)bdisp->dbg.min_duration;\n\n\tif (bdisp->dbg.max_duration > SECOND)\n\t\tmax_fps = 0;\n\telse\n\t\tmax_fps = SECOND / (s32)bdisp->dbg.max_duration;\n\n\tif (bdisp->dbg.last_duration > SECOND)\n\t\tlast_fps = 0;\n\telse\n\t\tlast_fps = SECOND / (s32)bdisp->dbg.last_duration;\n\n\tseq_printf(s, \"HW processing (%d requests):\\n\", request->nb_req);\n\tseq_printf(s, \" Average: %5lld us  (%3d fps)\\n\",\n\t\t   avg_time_us, avg_fps);\n\tseq_printf(s, \" Min-Max: %5lld us  (%3d fps) - %5lld us  (%3d fps)\\n\",\n\t\t   bdisp->dbg.min_duration, min_fps,\n\t\t   bdisp->dbg.max_duration, max_fps);\n\tseq_printf(s, \" Last:    %5lld us  (%3d fps)\\n\",\n\t\t   bdisp->dbg.last_duration, last_fps);\n\n\treturn 0;\n}\n\n#define bdisp_dbg_create_entry(name) \\\n\tdebugfs_create_file(#name, S_IRUGO, bdisp->dbg.debugfs_entry, bdisp, \\\n\t\t\t    &name##_fops)\n\nDEFINE_SHOW_ATTRIBUTE(regs);\nDEFINE_SHOW_ATTRIBUTE(last_nodes);\nDEFINE_SHOW_ATTRIBUTE(last_nodes_raw);\nDEFINE_SHOW_ATTRIBUTE(last_request);\nDEFINE_SHOW_ATTRIBUTE(perf);\n\nvoid bdisp_debugfs_create(struct bdisp_dev *bdisp)\n{\n\tchar dirname[16];\n\n\tsnprintf(dirname, sizeof(dirname), \"%s%d\", BDISP_NAME, bdisp->id);\n\tbdisp->dbg.debugfs_entry = debugfs_create_dir(dirname, NULL);\n\n\tbdisp_dbg_create_entry(regs);\n\tbdisp_dbg_create_entry(last_nodes);\n\tbdisp_dbg_create_entry(last_nodes_raw);\n\tbdisp_dbg_create_entry(last_request);\n\tbdisp_dbg_create_entry(perf);\n}\n\nvoid bdisp_debugfs_remove(struct bdisp_dev *bdisp)\n{\n\tdebugfs_remove_recursive(bdisp->dbg.debugfs_entry);\n\tbdisp->dbg.debugfs_entry = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}