{
  "module_name": "delta.h",
  "hash_id": "dacd09a09f247bebc4b08ac76aba53ccb25b7e6342fd3ac91736ec0d0dcfdde1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/st/sti/delta/delta.h",
  "human_readable_source": " \n \n\n#ifndef DELTA_H\n#define DELTA_H\n\n#include <linux/rpmsg.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-mem2mem.h>\n\n#include \"delta-cfg.h\"\n\n \nenum delta_state {\n\tDELTA_STATE_WF_FORMAT,\n\tDELTA_STATE_WF_STREAMINFO,\n\tDELTA_STATE_READY,\n\tDELTA_STATE_WF_EOS,\n\tDELTA_STATE_EOS\n};\n\n \nstruct delta_streaminfo {\n\tu32 flags;\n\tu32 streamformat;\n\tu32 width;\n\tu32 height;\n\tu32 dpb;\n\tstruct v4l2_rect crop;\n\tstruct v4l2_fract pixelaspect;\n\tenum v4l2_field field;\n\tu8 profile[32];\n\tu8 level[32];\n\tu8 other[32];\n\tenum v4l2_colorspace colorspace;\n\tenum v4l2_xfer_func xfer_func;\n\tenum v4l2_ycbcr_encoding ycbcr_enc;\n\tenum v4l2_quantization quantization;\n};\n\n#define DELTA_STREAMINFO_FLAG_CROP\t\t0x0001\n#define DELTA_STREAMINFO_FLAG_PIXELASPECT\t0x0002\n#define DELTA_STREAMINFO_FLAG_OTHER\t\t0x0004\n\n \nstruct delta_au {\n\tstruct vb2_v4l2_buffer vbuf;\t \n\tstruct list_head list;\t \n\n\tbool prepared;\n\tu32 size;\n\tvoid *vaddr;\n\tdma_addr_t paddr;\n\tu32 flags;\n\tu64 dts;\n};\n\n \nstruct delta_frameinfo {\n\tu32 flags;\n\tu32 pixelformat;\n\tu32 width;\n\tu32 height;\n\tu32 aligned_width;\n\tu32 aligned_height;\n\tu32 size;\n\tstruct v4l2_rect crop;\n\tstruct v4l2_fract pixelaspect;\n\tenum v4l2_field field;\n\tenum v4l2_colorspace colorspace;\n\tenum v4l2_xfer_func xfer_func;\n\tenum v4l2_ycbcr_encoding ycbcr_enc;\n\tenum v4l2_quantization quantization;\n};\n\n#define DELTA_FRAMEINFO_FLAG_CROP\t\t0x0001\n#define DELTA_FRAMEINFO_FLAG_PIXELASPECT\t0x0002\n\n \nstruct delta_frame {\n\tstruct vb2_v4l2_buffer vbuf;\t \n\tstruct list_head list;\t \n\n\tstruct delta_frameinfo info;\n\tbool prepared;\n\tu32 index;\n\tvoid *vaddr;\n\tdma_addr_t paddr;\n\tu32 state;\n\tu32 flags;\n\tu64 dts;\n\tenum v4l2_field field;\n};\n\n \n#define DELTA_FRAME_FREE\t0x00  \n#define DELTA_FRAME_REF\t\t0x01  \n#define DELTA_FRAME_BSY\t\t0x02  \n#define DELTA_FRAME_DEC\t\t0x04  \n#define DELTA_FRAME_OUT\t\t0x08  \n#define DELTA_FRAME_RDY\t\t0x10  \n#define DELTA_FRAME_M2M\t\t0x20  \n\n \nstruct delta_dts {\n\tstruct list_head list;\n\tu64 val;\n};\n\nstruct delta_buf {\n\tu32 size;\n\tvoid *vaddr;\n\tdma_addr_t paddr;\n\tconst char *name;\n\tunsigned long attrs;\n};\n\nstruct delta_ipc_ctx {\n\tint cb_err;\n\tu32 copro_hdl;\n\tstruct completion done;\n\tstruct delta_buf ipc_buf_struct;\n\tstruct delta_buf *ipc_buf;\n};\n\nstruct delta_ipc_param {\n\tu32 size;\n\tvoid *data;\n};\n\nstruct delta_ctx;\n\n \nstruct delta_dec {\n\tconst char *name;\n\tu32 streamformat;\n\tu32 pixelformat;\n\tu32 max_width;\n\tu32 max_height;\n\tbool pm;\n\n\t \n\tint (*open)(struct delta_ctx *ctx);\n\tint (*close)(struct delta_ctx *ctx);\n\n\t \n\tint (*setup_frame)(struct delta_ctx *ctx, struct delta_frame *frame);\n\n\t \n\tint (*get_streaminfo)(struct delta_ctx *ctx,\n\t\t\t      struct delta_streaminfo *streaminfo);\n\n\t \n\tint (*get_frameinfo)(struct delta_ctx *ctx,\n\t\t\t     struct delta_frameinfo *frameinfo);\n\n\t \n\tint (*set_frameinfo)(struct delta_ctx *ctx,\n\t\t\t     struct delta_frameinfo *frameinfo);\n\n\t \n\tint (*decode)(struct delta_ctx *ctx, struct delta_au *au);\n\n\t \n\tint (*get_frame)(struct delta_ctx *ctx, struct delta_frame **frame);\n\n\t \n\tint (*recycle)(struct delta_ctx *ctx, struct delta_frame *frame);\n\n\t \n\tint (*flush)(struct delta_ctx *ctx);\n\n\t \n\tint (*drain)(struct delta_ctx *ctx);\n};\n\nstruct delta_dev;\n\n \nstruct delta_ctx {\n\tu32 flags;\n\tstruct v4l2_fh fh;\n\tstruct delta_dev *dev;\n\tconst struct delta_dec *dec;\n\tstruct delta_ipc_ctx ipc_ctx;\n\n\tenum delta_state state;\n\tu32 frame_num;\n\tu32 au_num;\n\tsize_t max_au_size;\n\tstruct delta_streaminfo streaminfo;\n\tstruct delta_frameinfo frameinfo;\n\tu32 nb_of_frames;\n\tstruct delta_frame *frames[DELTA_MAX_FRAMES];\n\tu32 decoded_frames;\n\tu32 output_frames;\n\tu32 dropped_frames;\n\tu32 stream_errors;\n\tu32 decode_errors;\n\tu32 sys_errors;\n\tstruct list_head dts;\n\tchar name[100];\n\tstruct work_struct run_work;\n\tstruct mutex lock;\n\tbool aborting;\n\tvoid *priv;\n};\n\n#define DELTA_FLAG_STREAMINFO 0x0001\n#define DELTA_FLAG_FRAMEINFO 0x0002\n\n#define DELTA_MAX_FORMATS  DELTA_MAX_DECODERS\n\n \nstruct delta_dev {\n\tstruct v4l2_device v4l2_dev;\n\tstruct video_device *vdev;\n\tstruct platform_device *pdev;\n\tstruct device *dev;\n\tstruct v4l2_m2m_dev *m2m_dev;\n\tstruct mutex lock;\n\tstruct clk *clk_delta;\n\tstruct clk *clk_st231;\n\tstruct clk *clk_flash_promip;\n\tconst struct delta_dec *decoders[DELTA_MAX_DECODERS];\n\tu32 nb_of_decoders;\n\tu32 pixelformats[DELTA_MAX_FORMATS];\n\tu32 nb_of_pixelformats;\n\tu32 streamformats[DELTA_MAX_FORMATS];\n\tu32 nb_of_streamformats;\n\tu8 instance_id;\n\tstruct workqueue_struct *work_queue;\n\tstruct rpmsg_driver rpmsg_driver;\n\tstruct rpmsg_device *rpmsg_device;\n};\n\nstatic inline char *frame_type_str(u32 flags)\n{\n\tif (flags & V4L2_BUF_FLAG_KEYFRAME)\n\t\treturn \"I\";\n\tif (flags & V4L2_BUF_FLAG_PFRAME)\n\t\treturn \"P\";\n\tif (flags & V4L2_BUF_FLAG_BFRAME)\n\t\treturn \"B\";\n\tif (flags & V4L2_BUF_FLAG_LAST)\n\t\treturn \"EOS\";\n\treturn \"?\";\n}\n\nstatic inline char *frame_field_str(enum v4l2_field field)\n{\n\tif (field == V4L2_FIELD_NONE)\n\t\treturn \"-\";\n\tif (field == V4L2_FIELD_TOP)\n\t\treturn \"T\";\n\tif (field == V4L2_FIELD_BOTTOM)\n\t\treturn \"B\";\n\tif (field == V4L2_FIELD_INTERLACED)\n\t\treturn \"I\";\n\tif (field == V4L2_FIELD_INTERLACED_TB)\n\t\treturn \"TB\";\n\tif (field == V4L2_FIELD_INTERLACED_BT)\n\t\treturn \"BT\";\n\treturn \"?\";\n}\n\nstatic inline char *frame_state_str(u32 state, char *str, unsigned int len)\n{\n\tsnprintf(str, len, \"%s %s %s %s %s %s\",\n\t\t (state & DELTA_FRAME_REF)  ? \"ref\" : \"   \",\n\t\t (state & DELTA_FRAME_BSY)  ? \"bsy\" : \"   \",\n\t\t (state & DELTA_FRAME_DEC)  ? \"dec\" : \"   \",\n\t\t (state & DELTA_FRAME_OUT)  ? \"out\" : \"   \",\n\t\t (state & DELTA_FRAME_M2M)  ? \"m2m\" : \"   \",\n\t\t (state & DELTA_FRAME_RDY)  ? \"rdy\" : \"   \");\n\treturn str;\n}\n\nint delta_get_frameinfo_default(struct delta_ctx *ctx,\n\t\t\t\tstruct delta_frameinfo *frameinfo);\nint delta_recycle_default(struct delta_ctx *pctx,\n\t\t\t  struct delta_frame *frame);\n\nint delta_get_free_frame(struct delta_ctx *ctx,\n\t\t\t struct delta_frame **pframe);\n\nint delta_get_sync(struct delta_ctx *ctx);\nvoid delta_put_autosuspend(struct delta_ctx *ctx);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}