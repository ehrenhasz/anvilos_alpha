{
  "module_name": "hva.h",
  "hash_id": "8bff9e5ee85e0eaa657db124c5a990b72886b465d918ed17583b6a4d26a54829",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/st/sti/hva/hva.h",
  "human_readable_source": " \n \n\n#ifndef HVA_H\n#define HVA_H\n\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/videobuf2-v4l2.h>\n#include <media/v4l2-mem2mem.h>\n\n#define fh_to_ctx(f)    (container_of(f, struct hva_ctx, fh))\n\n#define hva_to_dev(h)   (h->dev)\n\n#define ctx_to_dev(c)   (c->hva_dev->dev)\n\n#define ctx_to_hdev(c)  (c->hva_dev)\n\n#define HVA_NAME\t\"st-hva\"\n#define HVA_PREFIX\t\"[---:----]\"\n\nextern const struct hva_enc nv12h264enc;\nextern const struct hva_enc nv21h264enc;\n\n \nstruct hva_frameinfo {\n\tu32\tpixelformat;\n\tu32\twidth;\n\tu32\theight;\n\tu32\taligned_width;\n\tu32\taligned_height;\n\tu32\tsize;\n};\n\n \nstruct hva_streaminfo {\n\tu32\tstreamformat;\n\tu32\twidth;\n\tu32\theight;\n\tu8\tprofile[32];\n\tu8\tlevel[32];\n};\n\n \nstruct hva_controls {\n\tstruct v4l2_fract\t\t\t\t\ttime_per_frame;\n\tenum v4l2_mpeg_video_bitrate_mode\t\t\tbitrate_mode;\n\tu32\t\t\t\t\t\t\tgop_size;\n\tu32\t\t\t\t\t\t\tbitrate;\n\tenum v4l2_mpeg_video_aspect\t\t\t\taspect;\n\tenum v4l2_mpeg_video_h264_profile\t\t\tprofile;\n\tenum v4l2_mpeg_video_h264_level\t\t\t\tlevel;\n\tenum v4l2_mpeg_video_h264_entropy_mode\t\t\tentropy_mode;\n\tu32\t\t\t\t\t\t\tcpb_size;\n\tbool\t\t\t\t\t\t\tdct8x8;\n\tu32\t\t\t\t\t\t\tqpmin;\n\tu32\t\t\t\t\t\t\tqpmax;\n\tbool\t\t\t\t\t\t\tvui_sar;\n\tenum v4l2_mpeg_video_h264_vui_sar_idc\t\t\tvui_sar_idc;\n\tbool\t\t\t\t\t\t\tsei_fp;\n\tenum v4l2_mpeg_video_h264_sei_fp_arrangement_type\tsei_fp_type;\n};\n\n \nstruct hva_frame {\n\tstruct vb2_v4l2_buffer\tvbuf;\n\tstruct list_head\tlist;\n\tstruct hva_frameinfo\tinfo;\n\tdma_addr_t\t\tpaddr;\n\tvoid\t\t\t*vaddr;\n\tbool\t\t\tprepared;\n};\n\n \n#define to_hva_frame(vb) \\\n\tcontainer_of(vb, struct hva_frame, vbuf)\n\n \nstruct hva_stream {\n\tstruct vb2_v4l2_buffer\tvbuf;\n\tstruct list_head\tlist;\n\tdma_addr_t\t\tpaddr;\n\tvoid\t\t\t*vaddr;\n\tbool\t\t\tprepared;\n\tunsigned int\t\tsize;\n\tunsigned int\t\tbytesused;\n};\n\n \n#define to_hva_stream(vb) \\\n\tcontainer_of(vb, struct hva_stream, vbuf)\n\n#ifdef CONFIG_VIDEO_STI_HVA_DEBUGFS\n \nstruct hva_ctx_dbg {\n\tstruct dentry\t*debugfs_entry;\n\tbool\t\tis_valid_period;\n\tktime_t\t\tbegin;\n\tu32\t\ttotal_duration;\n\tu32\t\tcnt_duration;\n\tu32\t\tmin_duration;\n\tu32\t\tmax_duration;\n\tu32\t\tavg_duration;\n\tu32\t\tmax_fps;\n\tu32\t\ttotal_period;\n\tu32\t\tcnt_period;\n\tu32\t\tmin_period;\n\tu32\t\tmax_period;\n\tu32\t\tavg_period;\n\tu32\t\ttotal_stream_size;\n\tu32\t\tavg_fps;\n\tu32\t\twindow_duration;\n\tu32\t\tcnt_window;\n\tu32\t\twindow_stream_size;\n\tu32\t\tlast_bitrate;\n\tu32\t\tmin_bitrate;\n\tu32\t\tmax_bitrate;\n\tu32\t\tavg_bitrate;\n};\n#endif\n\nstruct hva_dev;\nstruct hva_enc;\n\n \nstruct hva_ctx {\n\tstruct hva_dev\t\t\t*hva_dev;\n\tstruct v4l2_fh\t\t\tfh;\n\tstruct v4l2_ctrl_handler\tctrl_handler;\n\tstruct hva_controls\t\tctrls;\n\tu8\t\t\t\tid;\n\tbool\t\t\t\taborting;\n\tchar\t\t\t\tname[100];\n\tstruct work_struct\t\trun_work;\n\t \n\tstruct mutex\t\t\tlock;\n\tu32\t\t\t\tflags;\n\tu32\t\t\t\tframe_num;\n\tu32\t\t\t\tstream_num;\n\tu32\t\t\t\tmax_stream_size;\n\tenum v4l2_colorspace\t\tcolorspace;\n\tenum v4l2_xfer_func\t\txfer_func;\n\tenum v4l2_ycbcr_encoding\tycbcr_enc;\n\tenum v4l2_quantization\t\tquantization;\n\tstruct hva_streaminfo\t\tstreaminfo;\n\tstruct hva_frameinfo\t\tframeinfo;\n\tstruct hva_enc\t\t\t*enc;\n\tvoid\t\t\t\t*priv;\n\tbool\t\t\t\thw_err;\n\tu32\t\t\t\tencoded_frames;\n\tu32\t\t\t\tsys_errors;\n\tu32\t\t\t\tencode_errors;\n\tu32\t\t\t\tframe_errors;\n#ifdef CONFIG_VIDEO_STI_HVA_DEBUGFS\n\tstruct hva_ctx_dbg\t\tdbg;\n#endif\n};\n\n#define HVA_FLAG_STREAMINFO\t0x0001\n#define HVA_FLAG_FRAMEINFO\t0x0002\n\n#ifdef CONFIG_VIDEO_STI_HVA_DEBUGFS\n \nstruct hva_dev_dbg {\n\tstruct dentry\t*debugfs_entry;\n\tstruct hva_ctx\tlast_ctx;\n};\n#endif\n\n#define HVA_MAX_INSTANCES\t16\n#define HVA_MAX_ENCODERS\t10\n#define HVA_MAX_FORMATS\t\tHVA_MAX_ENCODERS\n\n \nstruct hva_dev {\n\tstruct v4l2_device\tv4l2_dev;\n\tstruct video_device\t*vdev;\n\tstruct platform_device\t*pdev;\n\tstruct device\t\t*dev;\n\t \n\tstruct mutex\t\tlock;\n\tstruct v4l2_m2m_dev\t*m2m_dev;\n\tstruct hva_ctx\t\t*instances[HVA_MAX_INSTANCES];\n\tunsigned int\t\tnb_of_instances;\n\tunsigned int\t\tinstance_id;\n\tvoid __iomem\t\t*regs;\n\tu32\t\t\tesram_addr;\n\tu32\t\t\tesram_size;\n\tstruct clk\t\t*clk;\n\tint\t\t\tirq_its;\n\tint\t\t\tirq_err;\n\tstruct workqueue_struct *work_queue;\n\t \n\tstruct mutex\t\tprotect_mutex;\n\tstruct completion\tinterrupt;\n\tunsigned long int\tip_version;\n\tconst struct hva_enc\t*encoders[HVA_MAX_ENCODERS];\n\tu32\t\t\tnb_of_encoders;\n\tu32\t\t\tpixelformats[HVA_MAX_FORMATS];\n\tu32\t\t\tnb_of_pixelformats;\n\tu32\t\t\tstreamformats[HVA_MAX_FORMATS];\n\tu32\t\t\tnb_of_streamformats;\n\tu32\t\t\tsfl_reg;\n\tu32\t\t\tsts_reg;\n\tu32\t\t\tlmi_err_reg;\n\tu32\t\t\temi_err_reg;\n\tu32\t\t\thec_mif_err_reg;\n#ifdef CONFIG_VIDEO_STI_HVA_DEBUGFS\n\tstruct hva_dev_dbg\tdbg;\n#endif\n};\n\n \n\nstruct hva_enc {\n\tconst char\t*name;\n\tu32\t\tstreamformat;\n\tu32\t\tpixelformat;\n\tu32\t\tmax_width;\n\tu32\t\tmax_height;\n\tint\t\t(*open)(struct hva_ctx *ctx);\n\tint\t\t(*close)(struct hva_ctx *ctx);\n\tint\t\t(*encode)(struct hva_ctx *ctx, struct hva_frame *frame,\n\t\t\t\t  struct hva_stream *stream);\n};\n\n#ifdef CONFIG_VIDEO_STI_HVA_DEBUGFS\nvoid hva_debugfs_create(struct hva_dev *hva);\nvoid hva_debugfs_remove(struct hva_dev *hva);\nvoid hva_dbg_ctx_create(struct hva_ctx *ctx);\nvoid hva_dbg_ctx_remove(struct hva_ctx *ctx);\nvoid hva_dbg_perf_begin(struct hva_ctx *ctx);\nvoid hva_dbg_perf_end(struct hva_ctx *ctx, struct hva_stream *stream);\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}