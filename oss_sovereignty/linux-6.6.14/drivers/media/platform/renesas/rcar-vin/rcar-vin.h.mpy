{
  "module_name": "rcar-vin.h",
  "hash_id": "524e328c45c8b85069235da5af980c12839b202bbfdb9d00079c05755a9e07ec",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/renesas/rcar-vin/rcar-vin.h",
  "human_readable_source": " \n \n\n#ifndef __RCAR_VIN__\n#define __RCAR_VIN__\n\n#include <linux/kref.h>\n\n#include <media/v4l2-async.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-dev.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-fwnode.h>\n#include <media/videobuf2-v4l2.h>\n\n \n#define HW_BUFFER_NUM 3\n\n \n#define HW_BUFFER_MASK 0x7f\n\n \n#define RCAR_VIN_NUM 32\n\nstruct rvin_dev;\nstruct rvin_group;\n\nenum model_id {\n\tRCAR_H1,\n\tRCAR_M1,\n\tRCAR_GEN2,\n\tRCAR_GEN3,\n};\n\nenum rvin_csi_id {\n\tRVIN_CSI20,\n\tRVIN_CSI21,\n\tRVIN_CSI40,\n\tRVIN_CSI41,\n\tRVIN_CSI_MAX,\n};\n\nenum rvin_isp_id {\n\tRVIN_ISP0,\n\tRVIN_ISP1,\n\tRVIN_ISP2,\n\tRVIN_ISP4,\n\tRVIN_ISP_MAX,\n};\n\n#define RVIN_REMOTES_MAX \\\n\t(((unsigned int)RVIN_CSI_MAX) > ((unsigned int)RVIN_ISP_MAX) ? \\\n\t RVIN_CSI_MAX : RVIN_ISP_MAX)\n\n \nenum rvin_dma_state {\n\tSTOPPED = 0,\n\tSTARTING,\n\tRUNNING,\n\tSTOPPING,\n\tSUSPENDED,\n};\n\n \nenum rvin_buffer_type {\n\tFULL,\n\tHALF_TOP,\n\tHALF_BOTTOM,\n};\n\n \nstruct rvin_video_format {\n\tu32 fourcc;\n\tu8 bpp;\n};\n\n \nstruct rvin_parallel_entity {\n\tstruct v4l2_async_connection *asc;\n\tstruct v4l2_subdev *subdev;\n\n\tenum v4l2_mbus_type mbus_type;\n\tstruct v4l2_mbus_config_parallel bus;\n\n\tunsigned int source_pad;\n\tunsigned int sink_pad;\n};\n\n \nstruct rvin_group_route {\n\tunsigned int master;\n\tenum rvin_csi_id csi;\n\tunsigned int chsel;\n};\n\n \nstruct rvin_info {\n\tenum model_id model;\n\tbool use_mc;\n\tbool use_isp;\n\tbool nv12;\n\n\tunsigned int max_width;\n\tunsigned int max_height;\n\tconst struct rvin_group_route *routes;\n\tvoid (*scaler)(struct rvin_dev *vin);\n};\n\n \nstruct rvin_dev {\n\tstruct device *dev;\n\tvoid __iomem *base;\n\tconst struct rvin_info *info;\n\n\tstruct video_device vdev;\n\tstruct v4l2_device v4l2_dev;\n\tstruct v4l2_ctrl_handler ctrl_handler;\n\tstruct v4l2_async_notifier notifier;\n\n\tstruct rvin_parallel_entity parallel;\n\n\tstruct rvin_group *group;\n\tunsigned int id;\n\tstruct media_pad pad;\n\n\tstruct mutex lock;\n\tstruct vb2_queue queue;\n\tvoid *scratch;\n\tdma_addr_t scratch_phys;\n\n\tspinlock_t qlock;\n\tstruct {\n\t\tstruct vb2_v4l2_buffer *buffer;\n\t\tenum rvin_buffer_type type;\n\t\tdma_addr_t phys;\n\t} buf_hw[HW_BUFFER_NUM];\n\tstruct list_head buf_list;\n\tunsigned int sequence;\n\tenum rvin_dma_state state;\n\n\tbool is_csi;\n\tunsigned int chsel;\n\n\tu32 mbus_code;\n\tstruct v4l2_pix_format format;\n\n\tstruct v4l2_rect crop;\n\tstruct v4l2_rect compose;\n\tvoid (*scaler)(struct rvin_dev *vin);\n\tv4l2_std_id std;\n\n\tunsigned int alpha;\n};\n\n#define vin_to_source(vin)\t\t((vin)->parallel.subdev)\n\n \n#define vin_dbg(d, fmt, arg...)\t\tdev_dbg(d->dev, fmt, ##arg)\n#define vin_info(d, fmt, arg...)\tdev_info(d->dev, fmt, ##arg)\n#define vin_warn(d, fmt, arg...)\tdev_warn(d->dev, fmt, ##arg)\n#define vin_err(d, fmt, arg...)\t\tdev_err(d->dev, fmt, ##arg)\n\n \nstruct rvin_group {\n\tstruct kref refcount;\n\n\tstruct media_device mdev;\n\n\tstruct mutex lock;\n\tunsigned int count;\n\tstruct v4l2_async_notifier notifier;\n\tstruct rvin_dev *vin[RCAR_VIN_NUM];\n\n\tint (*link_setup)(struct rvin_dev *vin);\n\n\tstruct {\n\t\tstruct v4l2_async_connection *asc;\n\t\tstruct v4l2_subdev *subdev;\n\t} remotes[RVIN_REMOTES_MAX];\n};\n\nint rvin_dma_register(struct rvin_dev *vin, int irq);\nvoid rvin_dma_unregister(struct rvin_dev *vin);\n\nint rvin_v4l2_register(struct rvin_dev *vin);\nvoid rvin_v4l2_unregister(struct rvin_dev *vin);\n\nconst struct rvin_video_format *rvin_format_from_pixel(struct rvin_dev *vin,\n\t\t\t\t\t\t       u32 pixelformat);\n\n\n \nvoid rvin_scaler_gen2(struct rvin_dev *vin);\nvoid rvin_scaler_gen3(struct rvin_dev *vin);\nvoid rvin_crop_scale_comp(struct rvin_dev *vin);\n\nint rvin_set_channel_routing(struct rvin_dev *vin, u8 chsel);\nvoid rvin_set_alpha(struct rvin_dev *vin, unsigned int alpha);\n\nint rvin_start_streaming(struct rvin_dev *vin);\nvoid rvin_stop_streaming(struct rvin_dev *vin);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}