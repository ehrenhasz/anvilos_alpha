{
  "module_name": "rcar-fcp.c",
  "hash_id": "ffb85f6cdee932daccbc30b748efb3192fa92d7b61148e73f5b7fab01d38eb32",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/renesas/rcar-fcp.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/dma-mapping.h>\n#include <linux/list.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/mutex.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n#include <linux/slab.h>\n\n#include <media/rcar-fcp.h>\n\nstruct rcar_fcp_device {\n\tstruct list_head list;\n\tstruct device *dev;\n};\n\nstatic LIST_HEAD(fcp_devices);\nstatic DEFINE_MUTEX(fcp_lock);\n\n \n\n \nstruct rcar_fcp_device *rcar_fcp_get(const struct device_node *np)\n{\n\tstruct rcar_fcp_device *fcp;\n\n\tmutex_lock(&fcp_lock);\n\n\tlist_for_each_entry(fcp, &fcp_devices, list) {\n\t\tif (fcp->dev->of_node != np)\n\t\t\tcontinue;\n\n\t\tget_device(fcp->dev);\n\t\tgoto done;\n\t}\n\n\tfcp = ERR_PTR(-EPROBE_DEFER);\n\ndone:\n\tmutex_unlock(&fcp_lock);\n\treturn fcp;\n}\nEXPORT_SYMBOL_GPL(rcar_fcp_get);\n\n \nvoid rcar_fcp_put(struct rcar_fcp_device *fcp)\n{\n\tif (fcp)\n\t\tput_device(fcp->dev);\n}\nEXPORT_SYMBOL_GPL(rcar_fcp_put);\n\nstruct device *rcar_fcp_get_device(struct rcar_fcp_device *fcp)\n{\n\treturn fcp->dev;\n}\nEXPORT_SYMBOL_GPL(rcar_fcp_get_device);\n\n \nint rcar_fcp_enable(struct rcar_fcp_device *fcp)\n{\n\tif (!fcp)\n\t\treturn 0;\n\n\treturn pm_runtime_resume_and_get(fcp->dev);\n}\nEXPORT_SYMBOL_GPL(rcar_fcp_enable);\n\n \nvoid rcar_fcp_disable(struct rcar_fcp_device *fcp)\n{\n\tif (fcp)\n\t\tpm_runtime_put(fcp->dev);\n}\nEXPORT_SYMBOL_GPL(rcar_fcp_disable);\n\n \n\nstatic int rcar_fcp_probe(struct platform_device *pdev)\n{\n\tstruct rcar_fcp_device *fcp;\n\n\tfcp = devm_kzalloc(&pdev->dev, sizeof(*fcp), GFP_KERNEL);\n\tif (fcp == NULL)\n\t\treturn -ENOMEM;\n\n\tfcp->dev = &pdev->dev;\n\n\tdma_set_max_seg_size(fcp->dev, UINT_MAX);\n\n\tpm_runtime_enable(&pdev->dev);\n\n\tmutex_lock(&fcp_lock);\n\tlist_add_tail(&fcp->list, &fcp_devices);\n\tmutex_unlock(&fcp_lock);\n\n\tplatform_set_drvdata(pdev, fcp);\n\n\treturn 0;\n}\n\nstatic void rcar_fcp_remove(struct platform_device *pdev)\n{\n\tstruct rcar_fcp_device *fcp = platform_get_drvdata(pdev);\n\n\tmutex_lock(&fcp_lock);\n\tlist_del(&fcp->list);\n\tmutex_unlock(&fcp_lock);\n\n\tpm_runtime_disable(&pdev->dev);\n}\n\nstatic const struct of_device_id rcar_fcp_of_match[] = {\n\t{ .compatible = \"renesas,fcpf\" },\n\t{ .compatible = \"renesas,fcpv\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, rcar_fcp_of_match);\n\nstatic struct platform_driver rcar_fcp_platform_driver = {\n\t.probe\t\t= rcar_fcp_probe,\n\t.remove_new\t= rcar_fcp_remove,\n\t.driver\t\t= {\n\t\t.name\t= \"rcar-fcp\",\n\t\t.of_match_table = rcar_fcp_of_match,\n\t\t.suppress_bind_attrs = true,\n\t},\n};\n\nmodule_platform_driver(rcar_fcp_platform_driver);\n\nMODULE_ALIAS(\"rcar-fcp\");\nMODULE_AUTHOR(\"Laurent Pinchart <laurent.pinchart@ideasonboard.com>\");\nMODULE_DESCRIPTION(\"Renesas FCP Driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}