{
  "module_name": "rockchip_vpu_hw.c",
  "hash_id": "361cb31d336639d6693c8f384f123e0a5c9f3d4342596a6fc880d02d64706d83",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/verisilicon/rockchip_vpu_hw.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n\n#include \"hantro.h\"\n#include \"hantro_jpeg.h\"\n#include \"hantro_g1_regs.h\"\n#include \"hantro_h1_regs.h\"\n#include \"rockchip_vpu2_regs.h\"\n#include \"rockchip_vpu981_regs.h\"\n\n#define RK3066_ACLK_MAX_FREQ (300 * 1000 * 1000)\n#define RK3288_ACLK_MAX_FREQ (400 * 1000 * 1000)\n#define RK3588_ACLK_MAX_FREQ (300 * 1000 * 1000)\n\n#define ROCKCHIP_VPU981_MIN_SIZE 64\n\n \n\nstatic const struct hantro_fmt rockchip_vpu_enc_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_YUV420M,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.enc_fmt = ROCKCHIP_VPU_ENC_FMT_YUV420P,\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV12M,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.enc_fmt = ROCKCHIP_VPU_ENC_FMT_YUV420SP,\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_YUYV,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.enc_fmt = ROCKCHIP_VPU_ENC_FMT_YUYV422,\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_UYVY,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.enc_fmt = ROCKCHIP_VPU_ENC_FMT_UYVY422,\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_JPEG,\n\t\t.codec_mode = HANTRO_MODE_JPEG_ENC,\n\t\t.max_depth = 2,\n\t\t.header_size = JPEG_HEADER_SIZE,\n\t\t.frmsize = {\n\t\t\t.min_width = 96,\n\t\t\t.max_width = 8192,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = 32,\n\t\t\t.max_height = 8192,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic const struct hantro_fmt rockchip_vpu1_postproc_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_YUYV,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.postprocessed = true,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic const struct hantro_fmt rockchip_vpu981_postproc_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV12,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.match_depth = true,\n\t\t.postprocessed = true,\n\t\t.frmsize = {\n\t\t\t.min_width = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_P010,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.match_depth = true,\n\t\t.postprocessed = true,\n\t\t.frmsize = {\n\t\t\t.min_width = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic const struct hantro_fmt rk3066_vpu_dec_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV12,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_H264_SLICE,\n\t\t.codec_mode = HANTRO_MODE_H264_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_MPEG2_SLICE,\n\t\t.codec_mode = HANTRO_MODE_MPEG2_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_VP8_FRAME,\n\t\t.codec_mode = HANTRO_MODE_VP8_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic const struct hantro_fmt rk3288_vpu_dec_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV12,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_4K_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_4K_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_H264_SLICE,\n\t\t.codec_mode = HANTRO_MODE_H264_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_4K_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_4K_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_MPEG2_SLICE,\n\t\t.codec_mode = HANTRO_MODE_MPEG2_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_VP8_FRAME,\n\t\t.codec_mode = HANTRO_MODE_VP8_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic const struct hantro_fmt rockchip_vdpu2_dec_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV12,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_H264_SLICE,\n\t\t.codec_mode = HANTRO_MODE_H264_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_MPEG2_SLICE,\n\t\t.codec_mode = HANTRO_MODE_MPEG2_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_VP8_FRAME,\n\t\t.codec_mode = HANTRO_MODE_VP8_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic const struct hantro_fmt rk3399_vpu_dec_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV12,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_MPEG2_SLICE,\n\t\t.codec_mode = HANTRO_MODE_MPEG2_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_FHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_FHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_VP8_FRAME,\n\t\t.codec_mode = HANTRO_MODE_VP8_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = FMT_MIN_WIDTH,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = FMT_MIN_HEIGHT,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic const struct hantro_fmt rockchip_vpu981_dec_fmts[] = {\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV12_4L4,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.match_depth = true,\n\t\t.frmsize = {\n\t\t\t.min_width = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_NV15_4L4,\n\t\t.codec_mode = HANTRO_MODE_NONE,\n\t\t.match_depth = true,\n\t\t.frmsize = {\n\t\t\t.min_width = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n\t{\n\t\t.fourcc = V4L2_PIX_FMT_AV1_FRAME,\n\t\t.codec_mode = HANTRO_MODE_AV1_DEC,\n\t\t.max_depth = 2,\n\t\t.frmsize = {\n\t\t\t.min_width = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_width = FMT_UHD_WIDTH,\n\t\t\t.step_width = MB_DIM,\n\t\t\t.min_height = ROCKCHIP_VPU981_MIN_SIZE,\n\t\t\t.max_height = FMT_UHD_HEIGHT,\n\t\t\t.step_height = MB_DIM,\n\t\t},\n\t},\n};\n\nstatic irqreturn_t rockchip_vpu1_vepu_irq(int irq, void *dev_id)\n{\n\tstruct hantro_dev *vpu = dev_id;\n\tenum vb2_buffer_state state;\n\tu32 status;\n\n\tstatus = vepu_read(vpu, H1_REG_INTERRUPT);\n\tstate = (status & H1_REG_INTERRUPT_FRAME_RDY) ?\n\t\tVB2_BUF_STATE_DONE : VB2_BUF_STATE_ERROR;\n\n\tvepu_write(vpu, 0, H1_REG_INTERRUPT);\n\tvepu_write(vpu, 0, H1_REG_AXI_CTRL);\n\n\thantro_irq_done(vpu, state);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t rockchip_vpu2_vdpu_irq(int irq, void *dev_id)\n{\n\tstruct hantro_dev *vpu = dev_id;\n\tenum vb2_buffer_state state;\n\tu32 status;\n\n\tstatus = vdpu_read(vpu, VDPU_REG_INTERRUPT);\n\tstate = (status & VDPU_REG_INTERRUPT_DEC_IRQ) ?\n\t\tVB2_BUF_STATE_DONE : VB2_BUF_STATE_ERROR;\n\n\tvdpu_write(vpu, 0, VDPU_REG_INTERRUPT);\n\tvdpu_write(vpu, 0, VDPU_REG_AXI_CTRL);\n\n\thantro_irq_done(vpu, state);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t rockchip_vpu2_vepu_irq(int irq, void *dev_id)\n{\n\tstruct hantro_dev *vpu = dev_id;\n\tenum vb2_buffer_state state;\n\tu32 status;\n\n\tstatus = vepu_read(vpu, VEPU_REG_INTERRUPT);\n\tstate = (status & VEPU_REG_INTERRUPT_FRAME_READY) ?\n\t\tVB2_BUF_STATE_DONE : VB2_BUF_STATE_ERROR;\n\n\tvepu_write(vpu, 0, VEPU_REG_INTERRUPT);\n\tvepu_write(vpu, 0, VEPU_REG_AXI_CTRL);\n\n\thantro_irq_done(vpu, state);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t rk3588_vpu981_irq(int irq, void *dev_id)\n{\n\tstruct hantro_dev *vpu = dev_id;\n\tenum vb2_buffer_state state;\n\tu32 status;\n\n\tstatus = vdpu_read(vpu, AV1_REG_INTERRUPT);\n\tstate = (status & AV1_REG_INTERRUPT_DEC_RDY_INT) ?\n\t\tVB2_BUF_STATE_DONE : VB2_BUF_STATE_ERROR;\n\n\tvdpu_write(vpu, 0, AV1_REG_INTERRUPT);\n\tvdpu_write(vpu, AV1_REG_CONFIG_DEC_CLK_GATE_E, AV1_REG_CONFIG);\n\n\thantro_irq_done(vpu, state);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int rk3036_vpu_hw_init(struct hantro_dev *vpu)\n{\n\t \n\tclk_set_rate(vpu->clocks[0].clk, RK3066_ACLK_MAX_FREQ);\n\treturn 0;\n}\n\nstatic int rk3066_vpu_hw_init(struct hantro_dev *vpu)\n{\n\t \n\tclk_set_rate(vpu->clocks[0].clk, RK3066_ACLK_MAX_FREQ);\n\tclk_set_rate(vpu->clocks[2].clk, RK3066_ACLK_MAX_FREQ);\n\treturn 0;\n}\n\nstatic int rk3588_vpu981_hw_init(struct hantro_dev *vpu)\n{\n\t \n\tclk_set_rate(vpu->clocks[0].clk, RK3588_ACLK_MAX_FREQ);\n\treturn 0;\n}\n\nstatic int rockchip_vpu_hw_init(struct hantro_dev *vpu)\n{\n\t \n\tclk_set_rate(vpu->clocks[0].clk, RK3288_ACLK_MAX_FREQ);\n\treturn 0;\n}\n\nstatic void rk3066_vpu_dec_reset(struct hantro_ctx *ctx)\n{\n\tstruct hantro_dev *vpu = ctx->dev;\n\n\tvdpu_write(vpu, G1_REG_INTERRUPT_DEC_IRQ_DIS, G1_REG_INTERRUPT);\n\tvdpu_write(vpu, G1_REG_CONFIG_DEC_CLK_GATE_E, G1_REG_CONFIG);\n}\n\nstatic void rockchip_vpu1_enc_reset(struct hantro_ctx *ctx)\n{\n\tstruct hantro_dev *vpu = ctx->dev;\n\n\tvepu_write(vpu, H1_REG_INTERRUPT_DIS_BIT, H1_REG_INTERRUPT);\n\tvepu_write(vpu, 0, H1_REG_ENC_CTRL);\n\tvepu_write(vpu, 0, H1_REG_AXI_CTRL);\n}\n\nstatic void rockchip_vpu2_dec_reset(struct hantro_ctx *ctx)\n{\n\tstruct hantro_dev *vpu = ctx->dev;\n\n\tvdpu_write(vpu, VDPU_REG_INTERRUPT_DEC_IRQ_DIS, VDPU_REG_INTERRUPT);\n\tvdpu_write(vpu, 0, VDPU_REG_EN_FLAGS);\n\tvdpu_write(vpu, 1, VDPU_REG_SOFT_RESET);\n}\n\nstatic void rockchip_vpu2_enc_reset(struct hantro_ctx *ctx)\n{\n\tstruct hantro_dev *vpu = ctx->dev;\n\n\tvepu_write(vpu, VEPU_REG_INTERRUPT_DIS_BIT, VEPU_REG_INTERRUPT);\n\tvepu_write(vpu, 0, VEPU_REG_ENCODE_START);\n\tvepu_write(vpu, 0, VEPU_REG_AXI_CTRL);\n}\n\n \nstatic const struct hantro_codec_ops rk3036_vpu_codec_ops[] = {\n\t[HANTRO_MODE_H264_DEC] = {\n\t\t.run = hantro_g1_h264_dec_run,\n\t\t.reset = hantro_g1_reset,\n\t\t.init = hantro_h264_dec_init,\n\t\t.exit = hantro_h264_dec_exit,\n\t},\n\t[HANTRO_MODE_MPEG2_DEC] = {\n\t\t.run = hantro_g1_mpeg2_dec_run,\n\t\t.reset = hantro_g1_reset,\n\t\t.init = hantro_mpeg2_dec_init,\n\t\t.exit = hantro_mpeg2_dec_exit,\n\t},\n\t[HANTRO_MODE_VP8_DEC] = {\n\t\t.run = hantro_g1_vp8_dec_run,\n\t\t.reset = hantro_g1_reset,\n\t\t.init = hantro_vp8_dec_init,\n\t\t.exit = hantro_vp8_dec_exit,\n\t},\n};\n\nstatic const struct hantro_codec_ops rk3066_vpu_codec_ops[] = {\n\t[HANTRO_MODE_JPEG_ENC] = {\n\t\t.run = hantro_h1_jpeg_enc_run,\n\t\t.reset = rockchip_vpu1_enc_reset,\n\t\t.done = hantro_h1_jpeg_enc_done,\n\t},\n\t[HANTRO_MODE_H264_DEC] = {\n\t\t.run = hantro_g1_h264_dec_run,\n\t\t.reset = rk3066_vpu_dec_reset,\n\t\t.init = hantro_h264_dec_init,\n\t\t.exit = hantro_h264_dec_exit,\n\t},\n\t[HANTRO_MODE_MPEG2_DEC] = {\n\t\t.run = hantro_g1_mpeg2_dec_run,\n\t\t.reset = rk3066_vpu_dec_reset,\n\t\t.init = hantro_mpeg2_dec_init,\n\t\t.exit = hantro_mpeg2_dec_exit,\n\t},\n\t[HANTRO_MODE_VP8_DEC] = {\n\t\t.run = hantro_g1_vp8_dec_run,\n\t\t.reset = rk3066_vpu_dec_reset,\n\t\t.init = hantro_vp8_dec_init,\n\t\t.exit = hantro_vp8_dec_exit,\n\t},\n};\n\nstatic const struct hantro_codec_ops rk3288_vpu_codec_ops[] = {\n\t[HANTRO_MODE_JPEG_ENC] = {\n\t\t.run = hantro_h1_jpeg_enc_run,\n\t\t.reset = rockchip_vpu1_enc_reset,\n\t\t.done = hantro_h1_jpeg_enc_done,\n\t},\n\t[HANTRO_MODE_H264_DEC] = {\n\t\t.run = hantro_g1_h264_dec_run,\n\t\t.reset = hantro_g1_reset,\n\t\t.init = hantro_h264_dec_init,\n\t\t.exit = hantro_h264_dec_exit,\n\t},\n\t[HANTRO_MODE_MPEG2_DEC] = {\n\t\t.run = hantro_g1_mpeg2_dec_run,\n\t\t.reset = hantro_g1_reset,\n\t\t.init = hantro_mpeg2_dec_init,\n\t\t.exit = hantro_mpeg2_dec_exit,\n\t},\n\t[HANTRO_MODE_VP8_DEC] = {\n\t\t.run = hantro_g1_vp8_dec_run,\n\t\t.reset = hantro_g1_reset,\n\t\t.init = hantro_vp8_dec_init,\n\t\t.exit = hantro_vp8_dec_exit,\n\t},\n};\n\nstatic const struct hantro_codec_ops rk3399_vpu_codec_ops[] = {\n\t[HANTRO_MODE_JPEG_ENC] = {\n\t\t.run = rockchip_vpu2_jpeg_enc_run,\n\t\t.reset = rockchip_vpu2_enc_reset,\n\t\t.done = rockchip_vpu2_jpeg_enc_done,\n\t},\n\t[HANTRO_MODE_H264_DEC] = {\n\t\t.run = rockchip_vpu2_h264_dec_run,\n\t\t.reset = rockchip_vpu2_dec_reset,\n\t\t.init = hantro_h264_dec_init,\n\t\t.exit = hantro_h264_dec_exit,\n\t},\n\t[HANTRO_MODE_MPEG2_DEC] = {\n\t\t.run = rockchip_vpu2_mpeg2_dec_run,\n\t\t.reset = rockchip_vpu2_dec_reset,\n\t\t.init = hantro_mpeg2_dec_init,\n\t\t.exit = hantro_mpeg2_dec_exit,\n\t},\n\t[HANTRO_MODE_VP8_DEC] = {\n\t\t.run = rockchip_vpu2_vp8_dec_run,\n\t\t.reset = rockchip_vpu2_dec_reset,\n\t\t.init = hantro_vp8_dec_init,\n\t\t.exit = hantro_vp8_dec_exit,\n\t},\n};\n\nstatic const struct hantro_codec_ops rk3568_vepu_codec_ops[] = {\n\t[HANTRO_MODE_JPEG_ENC] = {\n\t\t.run = rockchip_vpu2_jpeg_enc_run,\n\t\t.reset = rockchip_vpu2_enc_reset,\n\t\t.done = rockchip_vpu2_jpeg_enc_done,\n\t},\n};\n\nstatic const struct hantro_codec_ops rk3588_vpu981_codec_ops[] = {\n\t[HANTRO_MODE_AV1_DEC] = {\n\t\t.run = rockchip_vpu981_av1_dec_run,\n\t\t.init = rockchip_vpu981_av1_dec_init,\n\t\t.exit = rockchip_vpu981_av1_dec_exit,\n\t\t.done = rockchip_vpu981_av1_dec_done,\n\t},\n};\n \n\nstatic const struct hantro_irq rockchip_vdpu1_irqs[] = {\n\t{ \"vdpu\", hantro_g1_irq },\n};\n\nstatic const struct hantro_irq rockchip_vpu1_irqs[] = {\n\t{ \"vepu\", rockchip_vpu1_vepu_irq },\n\t{ \"vdpu\", hantro_g1_irq },\n};\n\nstatic const struct hantro_irq rockchip_vdpu2_irqs[] = {\n\t{ \"vdpu\", rockchip_vpu2_vdpu_irq },\n};\n\nstatic const struct hantro_irq rockchip_vpu2_irqs[] = {\n\t{ \"vepu\", rockchip_vpu2_vepu_irq },\n\t{ \"vdpu\", rockchip_vpu2_vdpu_irq },\n};\n\nstatic const struct hantro_irq rk3568_vepu_irqs[] = {\n\t{ \"vepu\", rockchip_vpu2_vepu_irq },\n};\n\nstatic const char * const rk3066_vpu_clk_names[] = {\n\t\"aclk_vdpu\", \"hclk_vdpu\",\n\t\"aclk_vepu\", \"hclk_vepu\"\n};\n\nstatic const struct hantro_irq rk3588_vpu981_irqs[] = {\n\t{ \"vdpu\", rk3588_vpu981_irq },\n};\n\nstatic const char * const rockchip_vpu_clk_names[] = {\n\t\"aclk\", \"hclk\"\n};\n\nstatic const char * const rk3588_vpu981_vpu_clk_names[] = {\n\t\"aclk\", \"hclk\",\n};\n\n \n\nconst struct hantro_variant rk3036_vpu_variant = {\n\t.dec_offset = 0x400,\n\t.dec_fmts = rk3066_vpu_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rk3066_vpu_dec_fmts),\n\t.postproc_fmts = rockchip_vpu1_postproc_fmts,\n\t.num_postproc_fmts = ARRAY_SIZE(rockchip_vpu1_postproc_fmts),\n\t.postproc_ops = &hantro_g1_postproc_ops,\n\t.codec = HANTRO_MPEG2_DECODER | HANTRO_VP8_DECODER |\n\t\t HANTRO_H264_DECODER,\n\t.codec_ops = rk3036_vpu_codec_ops,\n\t.irqs = rockchip_vdpu1_irqs,\n\t.num_irqs = ARRAY_SIZE(rockchip_vdpu1_irqs),\n\t.init = rk3036_vpu_hw_init,\n\t.clk_names = rockchip_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rockchip_vpu_clk_names)\n};\n\n \nconst struct hantro_variant rk3066_vpu_variant = {\n\t.enc_offset = 0x0,\n\t.enc_fmts = rockchip_vpu_enc_fmts,\n\t.num_enc_fmts = ARRAY_SIZE(rockchip_vpu_enc_fmts),\n\t.dec_offset = 0x400,\n\t.dec_fmts = rk3066_vpu_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rk3066_vpu_dec_fmts),\n\t.postproc_fmts = rockchip_vpu1_postproc_fmts,\n\t.num_postproc_fmts = ARRAY_SIZE(rockchip_vpu1_postproc_fmts),\n\t.postproc_ops = &hantro_g1_postproc_ops,\n\t.codec = HANTRO_JPEG_ENCODER | HANTRO_MPEG2_DECODER |\n\t\t HANTRO_VP8_DECODER | HANTRO_H264_DECODER,\n\t.codec_ops = rk3066_vpu_codec_ops,\n\t.irqs = rockchip_vpu1_irqs,\n\t.num_irqs = ARRAY_SIZE(rockchip_vpu1_irqs),\n\t.init = rk3066_vpu_hw_init,\n\t.clk_names = rk3066_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rk3066_vpu_clk_names)\n};\n\nconst struct hantro_variant rk3288_vpu_variant = {\n\t.enc_offset = 0x0,\n\t.enc_fmts = rockchip_vpu_enc_fmts,\n\t.num_enc_fmts = ARRAY_SIZE(rockchip_vpu_enc_fmts),\n\t.dec_offset = 0x400,\n\t.dec_fmts = rk3288_vpu_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rk3288_vpu_dec_fmts),\n\t.postproc_fmts = rockchip_vpu1_postproc_fmts,\n\t.num_postproc_fmts = ARRAY_SIZE(rockchip_vpu1_postproc_fmts),\n\t.postproc_ops = &hantro_g1_postproc_ops,\n\t.codec = HANTRO_JPEG_ENCODER | HANTRO_MPEG2_DECODER |\n\t\t HANTRO_VP8_DECODER | HANTRO_H264_DECODER,\n\t.codec_ops = rk3288_vpu_codec_ops,\n\t.irqs = rockchip_vpu1_irqs,\n\t.num_irqs = ARRAY_SIZE(rockchip_vpu1_irqs),\n\t.init = rockchip_vpu_hw_init,\n\t.clk_names = rockchip_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rockchip_vpu_clk_names)\n};\n\n \n\nconst struct hantro_variant rk3328_vpu_variant = {\n\t.dec_offset = 0x400,\n\t.dec_fmts = rockchip_vdpu2_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rockchip_vdpu2_dec_fmts),\n\t.codec = HANTRO_MPEG2_DECODER | HANTRO_VP8_DECODER |\n\t\t HANTRO_H264_DECODER,\n\t.codec_ops = rk3399_vpu_codec_ops,\n\t.irqs = rockchip_vdpu2_irqs,\n\t.num_irqs = ARRAY_SIZE(rockchip_vdpu2_irqs),\n\t.init = rockchip_vpu_hw_init,\n\t.clk_names = rockchip_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rockchip_vpu_clk_names),\n};\n\n \nconst struct hantro_variant rk3399_vpu_variant = {\n\t.enc_offset = 0x0,\n\t.enc_fmts = rockchip_vpu_enc_fmts,\n\t.num_enc_fmts = ARRAY_SIZE(rockchip_vpu_enc_fmts),\n\t.dec_offset = 0x400,\n\t.dec_fmts = rk3399_vpu_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rk3399_vpu_dec_fmts),\n\t.codec = HANTRO_JPEG_ENCODER | HANTRO_MPEG2_DECODER |\n\t\t HANTRO_VP8_DECODER,\n\t.codec_ops = rk3399_vpu_codec_ops,\n\t.irqs = rockchip_vpu2_irqs,\n\t.num_irqs = ARRAY_SIZE(rockchip_vpu2_irqs),\n\t.init = rockchip_vpu_hw_init,\n\t.clk_names = rockchip_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rockchip_vpu_clk_names)\n};\n\nconst struct hantro_variant rk3568_vepu_variant = {\n\t.enc_offset = 0x0,\n\t.enc_fmts = rockchip_vpu_enc_fmts,\n\t.num_enc_fmts = ARRAY_SIZE(rockchip_vpu_enc_fmts),\n\t.codec = HANTRO_JPEG_ENCODER,\n\t.codec_ops = rk3568_vepu_codec_ops,\n\t.irqs = rk3568_vepu_irqs,\n\t.num_irqs = ARRAY_SIZE(rk3568_vepu_irqs),\n\t.init = rockchip_vpu_hw_init,\n\t.clk_names = rockchip_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rockchip_vpu_clk_names)\n};\n\nconst struct hantro_variant rk3568_vpu_variant = {\n\t.dec_offset = 0x400,\n\t.dec_fmts = rockchip_vdpu2_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rockchip_vdpu2_dec_fmts),\n\t.codec = HANTRO_MPEG2_DECODER |\n\t\t HANTRO_VP8_DECODER | HANTRO_H264_DECODER,\n\t.codec_ops = rk3399_vpu_codec_ops,\n\t.irqs = rockchip_vdpu2_irqs,\n\t.num_irqs = ARRAY_SIZE(rockchip_vdpu2_irqs),\n\t.init = rockchip_vpu_hw_init,\n\t.clk_names = rockchip_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rockchip_vpu_clk_names)\n};\n\nconst struct hantro_variant px30_vpu_variant = {\n\t.enc_offset = 0x0,\n\t.enc_fmts = rockchip_vpu_enc_fmts,\n\t.num_enc_fmts = ARRAY_SIZE(rockchip_vpu_enc_fmts),\n\t.dec_offset = 0x400,\n\t.dec_fmts = rockchip_vdpu2_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rockchip_vdpu2_dec_fmts),\n\t.codec = HANTRO_JPEG_ENCODER | HANTRO_MPEG2_DECODER |\n\t\t HANTRO_VP8_DECODER | HANTRO_H264_DECODER,\n\t.codec_ops = rk3399_vpu_codec_ops,\n\t.irqs = rockchip_vpu2_irqs,\n\t.num_irqs = ARRAY_SIZE(rockchip_vpu2_irqs),\n\t.init = rk3036_vpu_hw_init,\n\t.clk_names = rockchip_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rockchip_vpu_clk_names)\n};\n\nconst struct hantro_variant rk3588_vpu981_variant = {\n\t.dec_offset = 0x0,\n\t.dec_fmts = rockchip_vpu981_dec_fmts,\n\t.num_dec_fmts = ARRAY_SIZE(rockchip_vpu981_dec_fmts),\n\t.postproc_fmts = rockchip_vpu981_postproc_fmts,\n\t.num_postproc_fmts = ARRAY_SIZE(rockchip_vpu981_postproc_fmts),\n\t.postproc_ops = &rockchip_vpu981_postproc_ops,\n\t.codec = HANTRO_AV1_DECODER,\n\t.codec_ops = rk3588_vpu981_codec_ops,\n\t.irqs = rk3588_vpu981_irqs,\n\t.num_irqs = ARRAY_SIZE(rk3588_vpu981_irqs),\n\t.init = rk3588_vpu981_hw_init,\n\t.clk_names = rk3588_vpu981_vpu_clk_names,\n\t.num_clocks = ARRAY_SIZE(rk3588_vpu981_vpu_clk_names)\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}