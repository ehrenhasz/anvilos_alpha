{
  "module_name": "vde.h",
  "hash_id": "cb08f6cd244c503317b7f421a4c6917b754e80f0144703de0132aef38f65e2ef",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/nvidia/tegra-vde/vde.h",
  "human_readable_source": " \n \n\n#ifndef TEGRA_VDE_H\n#define TEGRA_VDE_H\n\n#include <linux/completion.h>\n#include <linux/dma-direction.h>\n#include <linux/iova.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n\n#include <media/media-device.h>\n#include <media/videobuf2-dma-contig.h>\n#include <media/videobuf2-dma-sg.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-event.h>\n#include <media/v4l2-ioctl.h>\n#include <media/v4l2-mem2mem.h>\n\n#define ICMDQUE_WR\t\t0x00\n#define CMDQUE_CONTROL\t\t0x08\n#define INTR_STATUS\t\t0x18\n#define BSE_INT_ENB\t\t0x40\n#define BSE_CONFIG\t\t0x44\n\n#define BSE_ICMDQUE_EMPTY\tBIT(3)\n#define BSE_DMA_BUSY\t\tBIT(23)\n\n#define BSEV_ALIGN\t\tSZ_1\n#define FRAMEID_ALIGN\t\tSZ_256\n#define SXE_BUFFER\t\tSZ_32K\n#define VDE_ATOM\t\tSZ_16\n\nstruct clk;\nstruct dma_buf;\nstruct gen_pool;\nstruct tegra_ctx;\nstruct iommu_group;\nstruct iommu_domain;\nstruct reset_control;\nstruct dma_buf_attachment;\nstruct tegra_vde_h264_frame;\nstruct tegra_vde_h264_decoder_ctx;\n\nstruct tegra_video_frame {\n\tstruct dma_buf_attachment *y_dmabuf_attachment;\n\tstruct dma_buf_attachment *cb_dmabuf_attachment;\n\tstruct dma_buf_attachment *cr_dmabuf_attachment;\n\tstruct dma_buf_attachment *aux_dmabuf_attachment;\n\tdma_addr_t y_addr;\n\tdma_addr_t cb_addr;\n\tdma_addr_t cr_addr;\n\tdma_addr_t aux_addr;\n\tu32 frame_num;\n\tu32 flags;\n\tu32 luma_atoms_pitch;\n\tu32 chroma_atoms_pitch;\n};\n\nstruct tegra_coded_fmt_desc {\n\tu32 fourcc;\n\tstruct v4l2_frmsize_stepwise frmsize;\n\tunsigned int num_decoded_fmts;\n\tconst u32 *decoded_fmts;\n\tint (*decode_run)(struct tegra_ctx *ctx);\n\tint (*decode_wait)(struct tegra_ctx *ctx);\n};\n\nstruct tegra_vde_soc {\n\tbool supports_ref_pic_marking;\n\tconst struct tegra_coded_fmt_desc *coded_fmts;\n\tu32 num_coded_fmts;\n};\n\nstruct tegra_vde_bo {\n\tstruct iova *iova;\n\tstruct sg_table sgt;\n\tstruct tegra_vde *vde;\n\tenum dma_data_direction dma_dir;\n\tunsigned long dma_attrs;\n\tdma_addr_t dma_handle;\n\tdma_addr_t dma_addr;\n\tvoid *dma_cookie;\n\tsize_t size;\n};\n\nstruct tegra_vde {\n\tvoid __iomem *sxe;\n\tvoid __iomem *bsev;\n\tvoid __iomem *mbe;\n\tvoid __iomem *ppe;\n\tvoid __iomem *mce;\n\tvoid __iomem *tfe;\n\tvoid __iomem *ppb;\n\tvoid __iomem *vdma;\n\tvoid __iomem *frameid;\n\tstruct device *dev;\n\tstruct mutex lock;\n\tstruct mutex map_lock;\n\tstruct list_head map_list;\n\tstruct reset_control *rst;\n\tstruct reset_control *rst_mc;\n\tstruct gen_pool *iram_pool;\n\tstruct completion decode_completion;\n\tstruct clk *clk;\n\tstruct iommu_domain *domain;\n\tstruct iommu_group *group;\n\tstruct iova_domain iova;\n\tstruct iova *iova_resv_static_addresses;\n\tstruct iova *iova_resv_last_page;\n\tconst struct tegra_vde_soc *soc;\n\tstruct tegra_vde_bo *secure_bo;\n\tdma_addr_t bitstream_data_addr;\n\tdma_addr_t iram_lists_addr;\n\tu32 *iram;\n\tstruct v4l2_device v4l2_dev;\n\tstruct v4l2_m2m_dev *m2m;\n\tstruct media_device mdev;\n\tstruct video_device vdev;\n\tstruct mutex v4l2_lock;\n\tstruct workqueue_struct *wq;\n\tstruct tegra_video_frame frames[V4L2_H264_NUM_DPB_ENTRIES + 1];\n};\n\nint tegra_vde_alloc_bo(struct tegra_vde *vde,\n\t\t       struct tegra_vde_bo **ret_bo,\n\t\t       enum dma_data_direction dma_dir,\n\t\t       size_t size);\nvoid tegra_vde_free_bo(struct tegra_vde_bo *bo);\n\nstruct tegra_ctx_h264 {\n\tconst struct v4l2_ctrl_h264_decode_params *decode_params;\n\tconst struct v4l2_ctrl_h264_sps *sps;\n\tconst struct v4l2_ctrl_h264_pps *pps;\n};\n\nstruct tegra_ctx {\n\tstruct tegra_vde *vde;\n\tstruct tegra_ctx_h264 h264;\n\tstruct work_struct work;\n\tstruct v4l2_fh fh;\n\tstruct v4l2_ctrl_handler hdl;\n\tstruct v4l2_format coded_fmt;\n\tstruct v4l2_format decoded_fmt;\n\tconst struct tegra_coded_fmt_desc *coded_fmt_desc;\n\tstruct v4l2_ctrl *ctrls[];\n};\n\nstruct tegra_m2m_buffer {\n\tstruct v4l2_m2m_buffer m2m;\n\tstruct dma_buf_attachment *a[VB2_MAX_PLANES];\n\tdma_addr_t dma_base[VB2_MAX_PLANES];\n\tdma_addr_t dma_addr[VB2_MAX_PLANES];\n\tstruct iova *iova[VB2_MAX_PLANES];\n\tstruct tegra_vde_bo *aux;\n\tbool b_frame;\n};\n\nstatic inline struct tegra_m2m_buffer *\nvb_to_tegra_buf(struct vb2_buffer *vb)\n{\n\tstruct v4l2_m2m_buffer *m2m = container_of(vb, struct v4l2_m2m_buffer,\n\t\t\t\t\t\t   vb.vb2_buf);\n\n\treturn container_of(m2m, struct tegra_m2m_buffer, m2m);\n}\n\nvoid tegra_vde_prepare_control_data(struct tegra_ctx *ctx, u32 id);\n\nvoid tegra_vde_writel(struct tegra_vde *vde, u32 value, void __iomem *base,\n\t\t      u32 offset);\nu32 tegra_vde_readl(struct tegra_vde *vde, void __iomem *base, u32 offset);\nvoid tegra_vde_set_bits(struct tegra_vde *vde, u32 mask, void __iomem *base,\n\t\t\tu32 offset);\n\nint tegra_vde_h264_decode_run(struct tegra_ctx *ctx);\nint tegra_vde_h264_decode_wait(struct tegra_ctx *ctx);\n\nint tegra_vde_iommu_init(struct tegra_vde *vde);\nvoid tegra_vde_iommu_deinit(struct tegra_vde *vde);\nint tegra_vde_iommu_map(struct tegra_vde *vde,\n\t\t\tstruct sg_table *sgt,\n\t\t\tstruct iova **iovap,\n\t\t\tsize_t size);\nvoid tegra_vde_iommu_unmap(struct tegra_vde *vde, struct iova *iova);\n\nint tegra_vde_dmabuf_cache_map(struct tegra_vde *vde,\n\t\t\t       struct dma_buf *dmabuf,\n\t\t\t       enum dma_data_direction dma_dir,\n\t\t\t       struct dma_buf_attachment **ap,\n\t\t\t       dma_addr_t *addrp);\nvoid tegra_vde_dmabuf_cache_unmap(struct tegra_vde *vde,\n\t\t\t\t  struct dma_buf_attachment *a,\n\t\t\t\t  bool release);\nvoid tegra_vde_dmabuf_cache_unmap_sync(struct tegra_vde *vde);\nvoid tegra_vde_dmabuf_cache_unmap_all(struct tegra_vde *vde);\n\nstatic __maybe_unused char const *\ntegra_vde_reg_base_name(struct tegra_vde *vde, void __iomem *base)\n{\n\tif (vde->sxe == base)\n\t\treturn \"SXE\";\n\n\tif (vde->bsev == base)\n\t\treturn \"BSEV\";\n\n\tif (vde->mbe == base)\n\t\treturn \"MBE\";\n\n\tif (vde->ppe == base)\n\t\treturn \"PPE\";\n\n\tif (vde->mce == base)\n\t\treturn \"MCE\";\n\n\tif (vde->tfe == base)\n\t\treturn \"TFE\";\n\n\tif (vde->ppb == base)\n\t\treturn \"PPB\";\n\n\tif (vde->vdma == base)\n\t\treturn \"VDMA\";\n\n\tif (vde->frameid == base)\n\t\treturn \"FRAMEID\";\n\n\treturn \"???\";\n}\n\nint tegra_vde_v4l2_init(struct tegra_vde *vde);\nvoid tegra_vde_v4l2_deinit(struct tegra_vde *vde);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}