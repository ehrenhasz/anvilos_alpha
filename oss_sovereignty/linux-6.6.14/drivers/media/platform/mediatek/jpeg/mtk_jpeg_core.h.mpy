{
  "module_name": "mtk_jpeg_core.h",
  "hash_id": "2345213a1afa32c295498a7e2c35a843cc437777433fc13136309c73eff2debc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/mediatek/jpeg/mtk_jpeg_core.h",
  "human_readable_source": " \n \n\n#ifndef _MTK_JPEG_CORE_H\n#define _MTK_JPEG_CORE_H\n\n#include <linux/clk.h>\n#include <linux/interrupt.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-fh.h>\n#include <media/videobuf2-v4l2.h>\n\n#include \"mtk_jpeg_dec_hw.h\"\n\n#define MTK_JPEG_NAME\t\t\"mtk-jpeg\"\n\n#define MTK_JPEG_FMT_FLAG_OUTPUT\tBIT(0)\n#define MTK_JPEG_FMT_FLAG_CAPTURE\tBIT(1)\n\n#define MTK_JPEG_MIN_WIDTH\t32U\n#define MTK_JPEG_MIN_HEIGHT\t32U\n#define MTK_JPEG_MAX_WIDTH\t65535U\n#define MTK_JPEG_MAX_HEIGHT\t65535U\n\n#define MTK_JPEG_DEFAULT_SIZEIMAGE\t(1 * 1024 * 1024)\n\n#define MTK_JPEG_HW_TIMEOUT_MSEC 1000\n\n#define MTK_JPEG_MAX_EXIF_SIZE\t(64 * 1024)\n\n \nenum mtk_jpeg_ctx_state {\n\tMTK_JPEG_INIT = 0,\n\tMTK_JPEG_RUNNING,\n\tMTK_JPEG_SOURCE_CHANGE,\n};\n\n \nstruct mtk_jpeg_variant {\n\tstruct clk_bulk_data *clks;\n\tint num_clks;\n\tstruct mtk_jpeg_fmt *formats;\n\tint num_formats;\n\tconst struct vb2_ops *qops;\n\tirqreturn_t (*irq_handler)(int irq, void *priv);\n\tvoid (*hw_reset)(void __iomem *base);\n\tconst struct v4l2_m2m_ops *m2m_ops;\n\tconst char *dev_name;\n\tconst struct v4l2_ioctl_ops *ioctl_ops;\n\tu32 out_q_default_fourcc;\n\tu32 cap_q_default_fourcc;\n\tbool multi_core;\n\tvoid (*jpeg_worker)(struct work_struct *work);\n};\n\nstruct mtk_jpeg_src_buf {\n\tu32 frame_num;\n\tstruct vb2_v4l2_buffer b;\n\tstruct list_head list;\n\tu32 bs_size;\n\tstruct mtk_jpeg_dec_param dec_param;\n\n\tstruct mtk_jpeg_ctx *curr_ctx;\n};\n\nenum mtk_jpeg_hw_state {\n\tMTK_JPEG_HW_IDLE = 0,\n\tMTK_JPEG_HW_BUSY = 1,\n};\n\nstruct mtk_jpeg_hw_param {\n\tstruct vb2_v4l2_buffer *src_buffer;\n\tstruct vb2_v4l2_buffer *dst_buffer;\n\tstruct mtk_jpeg_ctx *curr_ctx;\n};\n\nenum mtk_jpegenc_hw_id {\n\tMTK_JPEGENC_HW0,\n\tMTK_JPEGENC_HW1,\n\tMTK_JPEGENC_HW_MAX,\n};\n\nenum mtk_jpegdec_hw_id {\n\tMTK_JPEGDEC_HW0,\n\tMTK_JPEGDEC_HW1,\n\tMTK_JPEGDEC_HW2,\n\tMTK_JPEGDEC_HW_MAX,\n};\n\n \nstruct mtk_jpegenc_clk {\n\tstruct clk_bulk_data *clks;\n\tint clk_num;\n};\n\n \nstruct mtk_jpegdec_clk {\n\tstruct clk_bulk_data *clks;\n\tint clk_num;\n};\n\n \nstruct mtk_jpegenc_comp_dev {\n\tstruct device *dev;\n\tstruct platform_device *plat_dev;\n\tvoid __iomem *reg_base;\n\tstruct mtk_jpeg_dev *master_dev;\n\tstruct mtk_jpegenc_clk venc_clk;\n\tint jpegenc_irq;\n\tstruct delayed_work job_timeout_work;\n\tstruct mtk_jpeg_hw_param hw_param;\n\tenum mtk_jpeg_hw_state hw_state;\n\t \n\tspinlock_t hw_lock;\n};\n\n \nstruct mtk_jpegdec_comp_dev {\n\tstruct device *dev;\n\tstruct platform_device *plat_dev;\n\tvoid __iomem *reg_base;\n\tstruct mtk_jpeg_dev *master_dev;\n\tstruct mtk_jpegdec_clk jdec_clk;\n\tint jpegdec_irq;\n\tstruct delayed_work job_timeout_work;\n\tstruct mtk_jpeg_hw_param hw_param;\n\tenum mtk_jpeg_hw_state hw_state;\n\t \n\tspinlock_t hw_lock;\n};\n\n \nstruct mtk_jpeg_dev {\n\tstruct mutex\t\tlock;\n\tspinlock_t\t\thw_lock;\n\tstruct workqueue_struct\t*workqueue;\n\tstruct device\t\t*dev;\n\tstruct v4l2_device\tv4l2_dev;\n\tstruct v4l2_m2m_dev\t*m2m_dev;\n\tvoid\t\t\t*alloc_ctx;\n\tstruct video_device\t*vdev;\n\tvoid __iomem\t\t*reg_base;\n\tstruct delayed_work job_timeout_work;\n\tconst struct mtk_jpeg_variant *variant;\n\n\tvoid __iomem *reg_encbase[MTK_JPEGENC_HW_MAX];\n\tstruct mtk_jpegenc_comp_dev *enc_hw_dev[MTK_JPEGENC_HW_MAX];\n\twait_queue_head_t hw_wq;\n\tatomic_t hw_rdy;\n\n\tvoid __iomem *reg_decbase[MTK_JPEGDEC_HW_MAX];\n\tstruct mtk_jpegdec_comp_dev *dec_hw_dev[MTK_JPEGDEC_HW_MAX];\n\tatomic_t hw_index;\n};\n\n \nstruct mtk_jpeg_fmt {\n\tu32\tfourcc;\n\tu32\thw_format;\n\tint\th_sample[VIDEO_MAX_PLANES];\n\tint\tv_sample[VIDEO_MAX_PLANES];\n\tint\tcolplanes;\n\tint\th_align;\n\tint\tv_align;\n\tu32\tflags;\n};\n\n \nstruct mtk_jpeg_q_data {\n\tstruct mtk_jpeg_fmt\t*fmt;\n\tstruct v4l2_pix_format_mplane pix_mp;\n\tstruct v4l2_rect enc_crop_rect;\n};\n\n \nstruct mtk_jpeg_ctx {\n\tstruct mtk_jpeg_dev\t\t*jpeg;\n\tstruct mtk_jpeg_q_data\t\tout_q;\n\tstruct mtk_jpeg_q_data\t\tcap_q;\n\tstruct v4l2_fh\t\t\tfh;\n\tenum mtk_jpeg_ctx_state\t\tstate;\n\tbool enable_exif;\n\tu8 enc_quality;\n\tu8 restart_interval;\n\tstruct v4l2_ctrl_handler ctrl_hdl;\n\n\tstruct work_struct jpeg_work;\n\tu32 total_frame_num;\n\tstruct list_head dst_done_queue;\n\t \n\tspinlock_t done_queue_lock;\n\tu32 last_done_frame_num;\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}