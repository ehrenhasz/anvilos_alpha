{
  "module_name": "mtk_mdp_core.h",
  "hash_id": "41bd3f4d261dfb84207d1cc2335863fd69d3a48ae5cfba6de6bca6316c1e4012",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/mediatek/mdp/mtk_mdp_core.h",
  "human_readable_source": " \n \n\n#ifndef __MTK_MDP_CORE_H__\n#define __MTK_MDP_CORE_H__\n\n#include <linux/videodev2.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-mem2mem.h>\n#include <media/videobuf2-core.h>\n#include <media/videobuf2-dma-contig.h>\n\n#include \"mtk_mdp_vpu.h\"\n#include \"mtk_mdp_comp.h\"\n\n\n#define MTK_MDP_MODULE_NAME\t\t\"mtk-mdp\"\n\n#define MTK_MDP_SHUTDOWN_TIMEOUT\t((100*HZ)/1000)  \n#define MTK_MDP_MAX_CTRL_NUM\t\t10\n\n#define MTK_MDP_FMT_FLAG_OUTPUT\t\tBIT(0)\n#define MTK_MDP_FMT_FLAG_CAPTURE\tBIT(1)\n\n#define MTK_MDP_VPU_INIT\t\tBIT(0)\n#define MTK_MDP_CTX_ERROR\t\tBIT(5)\n\n \nstruct mtk_mdp_pix_align {\n\tu16 org_w;\n\tu16 org_h;\n\tu16 target_w;\n\tu16 target_h;\n};\n\n \nstruct mtk_mdp_fmt {\n\tu32\tpixelformat;\n\tu16\tnum_planes;\n\tu16\tnum_comp;\n\tu8\tdepth[VIDEO_MAX_PLANES];\n\tu8\trow_depth[VIDEO_MAX_PLANES];\n\tu32\tflags;\n\tstruct mtk_mdp_pix_align *align;\n};\n\n \nstruct mtk_mdp_addr {\n\tdma_addr_t addr[MTK_MDP_MAX_NUM_PLANE];\n};\n\n \nstruct mtk_mdp_ctrls {\n\tstruct v4l2_ctrl *rotate;\n\tstruct v4l2_ctrl *hflip;\n\tstruct v4l2_ctrl *vflip;\n\tstruct v4l2_ctrl *global_alpha;\n};\n\n \nstruct mtk_mdp_frame {\n\tu32\t\t\t\twidth;\n\tu32\t\t\t\theight;\n\tstruct v4l2_rect\t\tcrop;\n\tunsigned long\t\t\tpayload[VIDEO_MAX_PLANES];\n\tunsigned int\t\t\tpitch[VIDEO_MAX_PLANES];\n\tstruct mtk_mdp_addr\t\taddr;\n\tconst struct mtk_mdp_fmt\t*fmt;\n\tu8\t\t\t\talpha;\n};\n\n \nstruct mtk_mdp_variant {\n\tstruct mtk_mdp_pix_limit\t*pix_max;\n\tstruct mtk_mdp_pix_limit\t*pix_min;\n\tstruct mtk_mdp_pix_align\t*pix_align;\n\tu16\t\t\t\th_scale_up_max;\n\tu16\t\t\t\tv_scale_up_max;\n\tu16\t\t\t\th_scale_down_max;\n\tu16\t\t\t\tv_scale_down_max;\n};\n\n \nstruct mtk_mdp_dev {\n\tstruct mutex\t\t\tlock;\n\tstruct mutex\t\t\tvpulock;\n\tstruct platform_device\t\t*pdev;\n\tstruct mtk_mdp_variant\t\t*variant;\n\tu16\t\t\t\tid;\n\tstruct list_head\t\tcomp_list;\n\tstruct v4l2_m2m_dev\t\t*m2m_dev;\n\tstruct list_head\t\tctx_list;\n\tstruct video_device\t\t*vdev;\n\tstruct v4l2_device\t\tv4l2_dev;\n\tstruct workqueue_struct\t\t*job_wq;\n\tstruct platform_device\t\t*vpu_dev;\n\tint\t\t\t\tctx_num;\n\tunsigned long\t\t\tid_counter;\n\tstruct workqueue_struct\t\t*wdt_wq;\n\tstruct work_struct\t\twdt_work;\n};\n\n \nstruct mtk_mdp_ctx {\n\tstruct list_head\t\tlist;\n\tstruct mtk_mdp_frame\t\ts_frame;\n\tstruct mtk_mdp_frame\t\td_frame;\n\tu32\t\t\t\tflags;\n\tu32\t\t\t\tstate;\n\tint\t\t\t\tid;\n\tint\t\t\t\trotation;\n\tu32\t\t\t\thflip:1;\n\tu32\t\t\t\tvflip:1;\n\tstruct mtk_mdp_dev\t\t*mdp_dev;\n\tstruct v4l2_m2m_ctx\t\t*m2m_ctx;\n\tstruct v4l2_fh\t\t\tfh;\n\tstruct v4l2_ctrl_handler\tctrl_handler;\n\tstruct mtk_mdp_ctrls\t\tctrls;\n\tbool\t\t\t\tctrls_rdy;\n\tenum v4l2_colorspace\t\tcolorspace;\n\tenum v4l2_ycbcr_encoding\tycbcr_enc;\n\tenum v4l2_xfer_func\t\txfer_func;\n\tenum v4l2_quantization\t\tquant;\n\n\tstruct mtk_mdp_vpu\t\tvpu;\n\tstruct mutex\t\t\tslock;\n\tstruct work_struct\t\twork;\n};\n\nextern int mtk_mdp_dbg_level;\n\nvoid mtk_mdp_register_component(struct mtk_mdp_dev *mdp,\n\t\t\t\tstruct mtk_mdp_comp *comp);\n\nvoid mtk_mdp_unregister_component(struct mtk_mdp_dev *mdp,\n\t\t\t\t  struct mtk_mdp_comp *comp);\n\n#if defined(DEBUG)\n\n#define mtk_mdp_dbg(level, fmt, args...)\t\t\t\t \\\n\tdo {\t\t\t\t\t\t\t\t \\\n\t\tif (mtk_mdp_dbg_level >= level)\t\t\t\t \\\n\t\t\tpr_info(\"[MTK_MDP] level=%d %s(),%d: \" fmt \"\\n\", \\\n\t\t\t\tlevel, __func__, __LINE__, ##args);\t \\\n\t} while (0)\n\n#define mtk_mdp_err(fmt, args...)\t\t\t\t\t\\\n\tpr_err(\"[MTK_MDP][ERROR] %s:%d: \" fmt \"\\n\", __func__, __LINE__, \\\n\t       ##args)\n\n\n#define mtk_mdp_dbg_enter()  mtk_mdp_dbg(3, \"+\")\n#define mtk_mdp_dbg_leave()  mtk_mdp_dbg(3, \"-\")\n\n#else\n\n#define mtk_mdp_dbg(level, fmt, args...) {}\n#define mtk_mdp_err(fmt, args...)\n#define mtk_mdp_dbg_enter()\n#define mtk_mdp_dbg_leave()\n\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}