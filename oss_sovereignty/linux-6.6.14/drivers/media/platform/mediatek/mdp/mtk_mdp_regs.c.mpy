{
  "module_name": "mtk_mdp_regs.c",
  "hash_id": "29bb428b1f28b405a9f8ea21591ce43401cbb1f4555795b865817e174b1f919f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/mediatek/mdp/mtk_mdp_regs.c",
  "human_readable_source": "\n \n\n#include <linux/platform_device.h>\n\n#include \"mtk_mdp_core.h\"\n#include \"mtk_mdp_regs.h\"\n\n\n#define MDP_COLORFMT_PACK(VIDEO, PLANE, COPLANE, HF, VF, BITS, GROUP, SWAP, ID)\\\n\t(((VIDEO) << 27) | ((PLANE) << 24) | ((COPLANE) << 22) |\\\n\t((HF) << 20) | ((VF) << 18) | ((BITS) << 8) | ((GROUP) << 6) |\\\n\t((SWAP) << 5) | ((ID) << 0))\n\nenum MDP_COLOR_ENUM {\n\tMDP_COLOR_UNKNOWN = 0,\n\tMDP_COLOR_NV12 = MDP_COLORFMT_PACK(0, 2, 1, 1, 1, 8, 1, 0, 12),\n\tMDP_COLOR_I420 = MDP_COLORFMT_PACK(0, 3, 0, 1, 1, 8, 1, 0, 8),\n\tMDP_COLOR_YV12 = MDP_COLORFMT_PACK(0, 3, 0, 1, 1, 8, 1, 1, 8),\n\t \n\tMDP_COLOR_420_MT21 = MDP_COLORFMT_PACK(5, 2, 1, 1, 1, 256, 1, 0, 12),\n};\n\nstatic int32_t mtk_mdp_map_color_format(int v4l2_format)\n{\n\tswitch (v4l2_format) {\n\tcase V4L2_PIX_FMT_NV12M:\n\tcase V4L2_PIX_FMT_NV12:\n\t\treturn MDP_COLOR_NV12;\n\tcase V4L2_PIX_FMT_MT21C:\n\t\treturn MDP_COLOR_420_MT21;\n\tcase V4L2_PIX_FMT_YUV420M:\n\tcase V4L2_PIX_FMT_YUV420:\n\t\treturn MDP_COLOR_I420;\n\tcase V4L2_PIX_FMT_YVU420:\n\t\treturn MDP_COLOR_YV12;\n\t}\n\n\tmtk_mdp_err(\"Unknown format 0x%x\", v4l2_format);\n\n\treturn MDP_COLOR_UNKNOWN;\n}\n\nvoid mtk_mdp_hw_set_input_addr(struct mtk_mdp_ctx *ctx,\n\t\t\t       struct mtk_mdp_addr *addr)\n{\n\tstruct mdp_buffer *src_buf = &ctx->vpu.vsi->src_buffer;\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(addr->addr); i++)\n\t\tsrc_buf->addr_mva[i] = (uint64_t)addr->addr[i];\n}\n\nvoid mtk_mdp_hw_set_output_addr(struct mtk_mdp_ctx *ctx,\n\t\t\t\tstruct mtk_mdp_addr *addr)\n{\n\tstruct mdp_buffer *dst_buf = &ctx->vpu.vsi->dst_buffer;\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(addr->addr); i++)\n\t\tdst_buf->addr_mva[i] = (uint64_t)addr->addr[i];\n}\n\nvoid mtk_mdp_hw_set_in_size(struct mtk_mdp_ctx *ctx)\n{\n\tstruct mtk_mdp_frame *frame = &ctx->s_frame;\n\tstruct mdp_config *config = &ctx->vpu.vsi->src_config;\n\n\t \n\tconfig->crop_x = frame->crop.left;\n\tconfig->crop_y = frame->crop.top;\n\n\t \n\tconfig->crop_w = frame->crop.width;\n\tconfig->crop_h = frame->crop.height;\n\n\t \n\tconfig->x = 0;\n\tconfig->y = 0;\n\tconfig->w = frame->width;\n\tconfig->h = frame->height;\n}\n\nvoid mtk_mdp_hw_set_in_image_format(struct mtk_mdp_ctx *ctx)\n{\n\tunsigned int i;\n\tstruct mtk_mdp_frame *frame = &ctx->s_frame;\n\tstruct mdp_config *config = &ctx->vpu.vsi->src_config;\n\tstruct mdp_buffer *src_buf = &ctx->vpu.vsi->src_buffer;\n\n\tsrc_buf->plane_num = frame->fmt->num_comp;\n\tconfig->format = mtk_mdp_map_color_format(frame->fmt->pixelformat);\n\tconfig->w_stride = 0;  \n\tconfig->h_stride = 0;  \n\n\tfor (i = 0; i < src_buf->plane_num; i++)\n\t\tsrc_buf->plane_size[i] = frame->payload[i];\n}\n\nvoid mtk_mdp_hw_set_out_size(struct mtk_mdp_ctx *ctx)\n{\n\tstruct mtk_mdp_frame *frame = &ctx->d_frame;\n\tstruct mdp_config *config = &ctx->vpu.vsi->dst_config;\n\n\tconfig->crop_x = frame->crop.left;\n\tconfig->crop_y = frame->crop.top;\n\tconfig->crop_w = frame->crop.width;\n\tconfig->crop_h = frame->crop.height;\n\tconfig->x = 0;\n\tconfig->y = 0;\n\tconfig->w = frame->width;\n\tconfig->h = frame->height;\n}\n\nvoid mtk_mdp_hw_set_out_image_format(struct mtk_mdp_ctx *ctx)\n{\n\tunsigned int i;\n\tstruct mtk_mdp_frame *frame = &ctx->d_frame;\n\tstruct mdp_config *config = &ctx->vpu.vsi->dst_config;\n\tstruct mdp_buffer *dst_buf = &ctx->vpu.vsi->dst_buffer;\n\n\tdst_buf->plane_num = frame->fmt->num_comp;\n\tconfig->format = mtk_mdp_map_color_format(frame->fmt->pixelformat);\n\tconfig->w_stride = 0;  \n\tconfig->h_stride = 0;  \n\tfor (i = 0; i < dst_buf->plane_num; i++)\n\t\tdst_buf->plane_size[i] = frame->payload[i];\n}\n\nvoid mtk_mdp_hw_set_rotation(struct mtk_mdp_ctx *ctx)\n{\n\tstruct mdp_config_misc *misc = &ctx->vpu.vsi->misc;\n\n\tmisc->orientation = ctx->ctrls.rotate->val;\n\tmisc->hflip = ctx->ctrls.hflip->val;\n\tmisc->vflip = ctx->ctrls.vflip->val;\n}\n\nvoid mtk_mdp_hw_set_global_alpha(struct mtk_mdp_ctx *ctx)\n{\n\tstruct mdp_config_misc *misc = &ctx->vpu.vsi->misc;\n\n\tmisc->alpha = ctx->ctrls.global_alpha->val;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}