{
  "module_name": "vdec_msg_queue.h",
  "hash_id": "34eaa19716e2a34cc467e545258c4517a94f8ea96c34367827a1e4e1895f71d6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/mediatek/vcodec/decoder/vdec_msg_queue.h",
  "human_readable_source": " \n \n\n#ifndef _VDEC_MSG_QUEUE_H_\n#define _VDEC_MSG_QUEUE_H_\n\n#include <linux/sched.h>\n#include <linux/semaphore.h>\n#include <linux/slab.h>\n#include <media/videobuf2-v4l2.h>\n\n#define NUM_BUFFER_COUNT 3\n\nstruct vdec_lat_buf;\nstruct mtk_vcodec_dec_ctx;\nstruct mtk_vcodec_dec_dev;\ntypedef int (*core_decode_cb_t)(struct vdec_lat_buf *lat_buf);\n\n \nenum core_ctx_status {\n\tCONTEXT_LIST_EMPTY = 0,\n\tCONTEXT_LIST_QUEUED,\n\tCONTEXT_LIST_DEC_DONE,\n};\n\n \nstruct vdec_msg_queue_ctx {\n\twait_queue_head_t ready_to_use;\n\tstruct list_head ready_queue;\n\t \n\tspinlock_t ready_lock;\n\tint ready_num;\n\tint hardware_index;\n};\n\n \nstruct vdec_lat_buf {\n\tstruct mtk_vcodec_mem wdma_err_addr;\n\tstruct mtk_vcodec_mem slice_bc_addr;\n\tstruct mtk_vcodec_mem rd_mv_addr;\n\tstruct mtk_vcodec_mem tile_addr;\n\tstruct vb2_v4l2_buffer ts_info;\n\tstruct media_request *src_buf_req;\n\n\tvoid *private_data;\n\tstruct mtk_vcodec_dec_ctx *ctx;\n\tcore_decode_cb_t core_decode;\n\tstruct list_head lat_list;\n\tstruct list_head core_list;\n\n\tbool is_last_frame;\n};\n\n \nstruct vdec_msg_queue {\n\tstruct vdec_lat_buf lat_buf[NUM_BUFFER_COUNT];\n\n\tstruct mtk_vcodec_mem wdma_addr;\n\tu64 wdma_rptr_addr;\n\tu64 wdma_wptr_addr;\n\n\tstruct work_struct core_work;\n\tstruct vdec_msg_queue_ctx lat_ctx;\n\tstruct vdec_msg_queue_ctx core_ctx;\n\n\tatomic_t lat_list_cnt;\n\tatomic_t core_list_cnt;\n\tbool flush_done;\n\tstruct vdec_lat_buf empty_lat_buf;\n\twait_queue_head_t core_dec_done;\n\tint status;\n\tstruct mtk_vcodec_dec_ctx *ctx;\n};\n\n \nint vdec_msg_queue_init(struct vdec_msg_queue *msg_queue,\n\t\t\tstruct mtk_vcodec_dec_ctx *ctx, core_decode_cb_t core_decode,\n\t\t\tint private_size);\n\n \nvoid vdec_msg_queue_init_ctx(struct vdec_msg_queue_ctx *ctx, int hardware_index);\n\n \nint vdec_msg_queue_qbuf(struct vdec_msg_queue_ctx *ctx, struct vdec_lat_buf *buf);\n\n \nstruct vdec_lat_buf *vdec_msg_queue_dqbuf(struct vdec_msg_queue_ctx *ctx);\n\n \nvoid vdec_msg_queue_update_ube_rptr(struct vdec_msg_queue *msg_queue, uint64_t ube_rptr);\n\n \nvoid vdec_msg_queue_update_ube_wptr(struct vdec_msg_queue *msg_queue, uint64_t ube_wptr);\n\n \nbool vdec_msg_queue_wait_lat_buf_full(struct vdec_msg_queue *msg_queue);\n\n \nvoid vdec_msg_queue_deinit(struct vdec_msg_queue *msg_queue,\n\t\t\t   struct mtk_vcodec_dec_ctx *ctx);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}