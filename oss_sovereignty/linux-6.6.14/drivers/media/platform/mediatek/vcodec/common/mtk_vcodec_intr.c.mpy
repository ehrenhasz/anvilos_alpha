{
  "module_name": "mtk_vcodec_intr.c",
  "hash_id": "5c03b03940752694b30ec70edc7bdf90ff3872ee0afe0c224246af69571ebef9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/mediatek/vcodec/common/mtk_vcodec_intr.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/wait.h>\n\n#include \"../decoder/mtk_vcodec_dec_drv.h\"\n#include \"../encoder/mtk_vcodec_enc_drv.h\"\n#include \"mtk_vcodec_intr.h\"\n\nint mtk_vcodec_wait_for_done_ctx(void *priv, int command, unsigned int timeout_ms,\n\t\t\t\t unsigned int hw_id)\n{\n\tint instance_type = *((int *)priv);\n\tlong timeout_jiff, ret;\n\tint ctx_id, ctx_type, status = 0;\n\tint *ctx_int_cond, *ctx_int_type;\n\twait_queue_head_t *ctx_queue;\n\tstruct platform_device *pdev;\n\n\tif (instance_type == DECODER) {\n\t\tstruct mtk_vcodec_dec_ctx *ctx;\n\n\t\tctx = priv;\n\t\tctx_id = ctx->id;\n\t\tctx_type = ctx->type;\n\t\tctx_int_cond = ctx->int_cond;\n\t\tctx_int_type = ctx->int_type;\n\t\tctx_queue = ctx->queue;\n\t\tpdev = ctx->dev->plat_dev;\n\t} else {\n\t\tstruct mtk_vcodec_enc_ctx *ctx;\n\n\t\tctx = priv;\n\t\tctx_id = ctx->id;\n\t\tctx_type = ctx->type;\n\t\tctx_int_cond = ctx->int_cond;\n\t\tctx_int_type = ctx->int_type;\n\t\tctx_queue = ctx->queue;\n\t\tpdev = ctx->dev->plat_dev;\n\t}\n\n\ttimeout_jiff = msecs_to_jiffies(timeout_ms);\n\tret = wait_event_interruptible_timeout(ctx_queue[hw_id],\n\t\t\t\t\t       ctx_int_cond[hw_id],\n\t\t\t\t\t       timeout_jiff);\n\n\tif (!ret) {\n\t\tstatus = -1;\t \n\t\tdev_err(&pdev->dev, \"[%d] cmd=%d, type=%d, dec timeout=%ums (%d %d)\",\n\t\t\tctx_id, command, ctx_type, timeout_ms,\n\t\t\tctx_int_cond[hw_id], ctx_int_type[hw_id]);\n\t} else if (-ERESTARTSYS == ret) {\n\t\tstatus = -1;\n\t\tdev_err(&pdev->dev, \"[%d] cmd=%d, type=%d, dec inter fail (%d %d)\",\n\t\t\tctx_id, command, ctx_type,\n\t\t\tctx_int_cond[hw_id], ctx_int_type[hw_id]);\n\t}\n\n\tctx_int_cond[hw_id] = 0;\n\tctx_int_type[hw_id] = 0;\n\n\treturn status;\n}\nEXPORT_SYMBOL(mtk_vcodec_wait_for_done_ctx);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}