{
  "module_name": "nal-hevc.h",
  "hash_id": "1a3c9f4f0c76fa688edc9752e21dbfc9ff16a3bd617888fed5ba4ad471d96425",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/allegro-dvt/nal-hevc.h",
  "human_readable_source": " \n \n\n#ifndef __NAL_HEVC_H__\n#define __NAL_HEVC_H__\n\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/v4l2-controls.h>\n#include <linux/videodev2.h>\n\nstruct nal_hevc_profile_tier_level {\n\tunsigned int general_profile_space;\n\tunsigned int general_tier_flag;\n\tunsigned int general_profile_idc;\n\tunsigned int general_profile_compatibility_flag[32];\n\tunsigned int general_progressive_source_flag;\n\tunsigned int general_interlaced_source_flag;\n\tunsigned int general_non_packed_constraint_flag;\n\tunsigned int general_frame_only_constraint_flag;\n\tunion {\n\t\tstruct {\n\t\t\tunsigned int general_max_12bit_constraint_flag;\n\t\t\tunsigned int general_max_10bit_constraint_flag;\n\t\t\tunsigned int general_max_8bit_constraint_flag;\n\t\t\tunsigned int general_max_422chroma_constraint_flag;\n\t\t\tunsigned int general_max_420chroma_constraint_flag;\n\t\t\tunsigned int general_max_monochrome_constraint_flag;\n\t\t\tunsigned int general_intra_constraint_flag;\n\t\t\tunsigned int general_one_picture_only_constraint_flag;\n\t\t\tunsigned int general_lower_bit_rate_constraint_flag;\n\t\t\tunion {\n\t\t\t\tstruct {\n\t\t\t\t\tunsigned int general_max_14bit_constraint_flag;\n\t\t\t\t\tunsigned int general_reserved_zero_33bits;\n\t\t\t\t};\n\t\t\t\tunsigned int general_reserved_zero_34bits;\n\t\t\t};\n\t\t};\n\t\tstruct {\n\t\t\tunsigned int general_reserved_zero_7bits;\n\t\t\t \n\t\t\tunsigned int general_reserved_zero_35bits;\n\t\t};\n\t\tunsigned int general_reserved_zero_43bits;\n\t};\n\tunion {\n\t\tunsigned int general_inbld_flag;\n\t\tunsigned int general_reserved_zero_bit;\n\t};\n\tunsigned int general_level_idc;\n};\n\n \nstruct nal_hevc_vps {\n\tunsigned int video_parameter_set_id;\n\tunsigned int base_layer_internal_flag;\n\tunsigned int base_layer_available_flag;\n\tunsigned int max_layers_minus1;\n\tunsigned int max_sub_layers_minus1;\n\tunsigned int temporal_id_nesting_flag;\n\tstruct nal_hevc_profile_tier_level profile_tier_level;\n\tunsigned int sub_layer_ordering_info_present_flag;\n\tstruct {\n\t\tunsigned int max_dec_pic_buffering_minus1[7];\n\t\tunsigned int max_num_reorder_pics[7];\n\t\tunsigned int max_latency_increase_plus1[7];\n\t};\n\tunsigned int max_layer_id;\n\tunsigned int num_layer_sets_minus1;\n\tunsigned int layer_id_included_flag[1024][64];\n\tunsigned int timing_info_present_flag;\n\tstruct {\n\t\tunsigned int num_units_in_tick;\n\t\tunsigned int time_scale;\n\t\tunsigned int poc_proportional_to_timing_flag;\n\t\tunsigned int num_ticks_poc_diff_one_minus1;\n\t\tunsigned int num_hrd_parameters;\n\t\tstruct {\n\t\t\tunsigned int hrd_layer_set_idx[0];\n\t\t\tunsigned int cprms_present_flag[0];\n\t\t};\n\t\t \n\t};\n\tunsigned int extension_flag;\n\tunsigned int extension_data_flag;\n};\n\nstruct nal_hevc_sub_layer_hrd_parameters {\n\tunsigned int bit_rate_value_minus1[1];\n\tunsigned int cpb_size_value_minus1[1];\n\tunsigned int cbr_flag[1];\n};\n\nstruct nal_hevc_hrd_parameters {\n\tunsigned int nal_hrd_parameters_present_flag;\n\tunsigned int vcl_hrd_parameters_present_flag;\n\tstruct {\n\t\tunsigned int sub_pic_hrd_params_present_flag;\n\t\tstruct {\n\t\t\tunsigned int tick_divisor_minus2;\n\t\t\tunsigned int du_cpb_removal_delay_increment_length_minus1;\n\t\t\tunsigned int sub_pic_cpb_params_in_pic_timing_sei_flag;\n\t\t\tunsigned int dpb_output_delay_du_length_minus1;\n\t\t};\n\t\tunsigned int bit_rate_scale;\n\t\tunsigned int cpb_size_scale;\n\t\tunsigned int cpb_size_du_scale;\n\t\tunsigned int initial_cpb_removal_delay_length_minus1;\n\t\tunsigned int au_cpb_removal_delay_length_minus1;\n\t\tunsigned int dpb_output_delay_length_minus1;\n\t};\n\tstruct {\n\t\tunsigned int fixed_pic_rate_general_flag[1];\n\t\tunsigned int fixed_pic_rate_within_cvs_flag[1];\n\t\tunsigned int elemental_duration_in_tc_minus1[1];\n\t\tunsigned int low_delay_hrd_flag[1];\n\t\tunsigned int cpb_cnt_minus1[1];\n\t\tstruct nal_hevc_sub_layer_hrd_parameters nal_hrd[1];\n\t\tstruct nal_hevc_sub_layer_hrd_parameters vcl_hrd[1];\n\t};\n};\n\n \nstruct nal_hevc_vui_parameters {\n\tunsigned int aspect_ratio_info_present_flag;\n\tstruct {\n\t\tunsigned int aspect_ratio_idc;\n\t\tunsigned int sar_width;\n\t\tunsigned int sar_height;\n\t};\n\tunsigned int overscan_info_present_flag;\n\tunsigned int overscan_appropriate_flag;\n\tunsigned int video_signal_type_present_flag;\n\tstruct {\n\t\tunsigned int video_format;\n\t\tunsigned int video_full_range_flag;\n\t\tunsigned int colour_description_present_flag;\n\t\tstruct {\n\t\t\tunsigned int colour_primaries;\n\t\t\tunsigned int transfer_characteristics;\n\t\t\tunsigned int matrix_coeffs;\n\t\t};\n\t};\n\tunsigned int chroma_loc_info_present_flag;\n\tstruct {\n\t\tunsigned int chroma_sample_loc_type_top_field;\n\t\tunsigned int chroma_sample_loc_type_bottom_field;\n\t};\n\tunsigned int neutral_chroma_indication_flag;\n\tunsigned int field_seq_flag;\n\tunsigned int frame_field_info_present_flag;\n\tunsigned int default_display_window_flag;\n\tstruct {\n\t\tunsigned int def_disp_win_left_offset;\n\t\tunsigned int def_disp_win_right_offset;\n\t\tunsigned int def_disp_win_top_offset;\n\t\tunsigned int def_disp_win_bottom_offset;\n\t};\n\tunsigned int vui_timing_info_present_flag;\n\tstruct {\n\t\tunsigned int vui_num_units_in_tick;\n\t\tunsigned int vui_time_scale;\n\t\tunsigned int vui_poc_proportional_to_timing_flag;\n\t\tunsigned int vui_num_ticks_poc_diff_one_minus1;\n\t\tunsigned int vui_hrd_parameters_present_flag;\n\t\tstruct nal_hevc_hrd_parameters nal_hrd_parameters;\n\t};\n\tunsigned int bitstream_restriction_flag;\n\tstruct {\n\t\tunsigned int tiles_fixed_structure_flag;\n\t\tunsigned int motion_vectors_over_pic_boundaries_flag;\n\t\tunsigned int restricted_ref_pic_lists_flag;\n\t\tunsigned int min_spatial_segmentation_idc;\n\t\tunsigned int max_bytes_per_pic_denom;\n\t\tunsigned int max_bits_per_min_cu_denom;\n\t\tunsigned int log2_max_mv_length_horizontal;\n\t\tunsigned int log2_max_mv_length_vertical;\n\t};\n};\n\n \nstruct nal_hevc_sps {\n\tunsigned int video_parameter_set_id;\n\tunsigned int max_sub_layers_minus1;\n\tunsigned int temporal_id_nesting_flag;\n\tstruct nal_hevc_profile_tier_level profile_tier_level;\n\tunsigned int seq_parameter_set_id;\n\tunsigned int chroma_format_idc;\n\tunsigned int separate_colour_plane_flag;\n\tunsigned int pic_width_in_luma_samples;\n\tunsigned int pic_height_in_luma_samples;\n\tunsigned int conformance_window_flag;\n\tstruct {\n\t\tunsigned int conf_win_left_offset;\n\t\tunsigned int conf_win_right_offset;\n\t\tunsigned int conf_win_top_offset;\n\t\tunsigned int conf_win_bottom_offset;\n\t};\n\n\tunsigned int bit_depth_luma_minus8;\n\tunsigned int bit_depth_chroma_minus8;\n\tunsigned int log2_max_pic_order_cnt_lsb_minus4;\n\tunsigned int sub_layer_ordering_info_present_flag;\n\tstruct {\n\t\tunsigned int max_dec_pic_buffering_minus1[7];\n\t\tunsigned int max_num_reorder_pics[7];\n\t\tunsigned int max_latency_increase_plus1[7];\n\t};\n\tunsigned int log2_min_luma_coding_block_size_minus3;\n\tunsigned int log2_diff_max_min_luma_coding_block_size;\n\tunsigned int log2_min_luma_transform_block_size_minus2;\n\tunsigned int log2_diff_max_min_luma_transform_block_size;\n\tunsigned int max_transform_hierarchy_depth_inter;\n\tunsigned int max_transform_hierarchy_depth_intra;\n\n\tunsigned int scaling_list_enabled_flag;\n\tunsigned int scaling_list_data_present_flag;\n\tunsigned int amp_enabled_flag;\n\tunsigned int sample_adaptive_offset_enabled_flag;\n\tunsigned int pcm_enabled_flag;\n\tstruct {\n\t\tunsigned int pcm_sample_bit_depth_luma_minus1;\n\t\tunsigned int pcm_sample_bit_depth_chroma_minus1;\n\t\tunsigned int log2_min_pcm_luma_coding_block_size_minus3;\n\t\tunsigned int log2_diff_max_min_pcm_luma_coding_block_size;\n\t\tunsigned int pcm_loop_filter_disabled_flag;\n\t};\n\n\tunsigned int num_short_term_ref_pic_sets;\n\tunsigned int long_term_ref_pics_present_flag;\n\tunsigned int sps_temporal_mvp_enabled_flag;\n\tunsigned int strong_intra_smoothing_enabled_flag;\n\tunsigned int vui_parameters_present_flag;\n\tstruct nal_hevc_vui_parameters vui;\n\tunsigned int extension_present_flag;\n\tstruct {\n\t\tunsigned int sps_range_extension_flag;\n\t\tunsigned int sps_multilayer_extension_flag;\n\t\tunsigned int sps_3d_extension_flag;\n\t\tunsigned int sps_scc_extension_flag;\n\t\tunsigned int sps_extension_4bits;\n\t};\n};\n\nstruct nal_hevc_pps {\n\tunsigned int pps_pic_parameter_set_id;\n\tunsigned int pps_seq_parameter_set_id;\n\tunsigned int dependent_slice_segments_enabled_flag;\n\tunsigned int output_flag_present_flag;\n\tunsigned int num_extra_slice_header_bits;\n\tunsigned int sign_data_hiding_enabled_flag;\n\tunsigned int cabac_init_present_flag;\n\tunsigned int num_ref_idx_l0_default_active_minus1;\n\tunsigned int num_ref_idx_l1_default_active_minus1;\n\tint init_qp_minus26;\n\tunsigned int constrained_intra_pred_flag;\n\tunsigned int transform_skip_enabled_flag;\n\tunsigned int cu_qp_delta_enabled_flag;\n\tunsigned int diff_cu_qp_delta_depth;\n\tint pps_cb_qp_offset;\n\tint pps_cr_qp_offset;\n\tunsigned int pps_slice_chroma_qp_offsets_present_flag;\n\tunsigned int weighted_pred_flag;\n\tunsigned int weighted_bipred_flag;\n\tunsigned int transquant_bypass_enabled_flag;\n\tunsigned int tiles_enabled_flag;\n\tunsigned int entropy_coding_sync_enabled_flag;\n\tstruct {\n\t\tunsigned int num_tile_columns_minus1;\n\t\tunsigned int num_tile_rows_minus1;\n\t\tunsigned int uniform_spacing_flag;\n\t\tstruct {\n\t\t\tunsigned int column_width_minus1[1];\n\t\t\tunsigned int row_height_minus1[1];\n\t\t};\n\t\tunsigned int loop_filter_across_tiles_enabled_flag;\n\t};\n\tunsigned int pps_loop_filter_across_slices_enabled_flag;\n\tunsigned int deblocking_filter_control_present_flag;\n\tstruct {\n\t\tunsigned int deblocking_filter_override_enabled_flag;\n\t\tunsigned int pps_deblocking_filter_disabled_flag;\n\t\tstruct {\n\t\t\tint pps_beta_offset_div2;\n\t\t\tint pps_tc_offset_div2;\n\t\t};\n\t};\n\tunsigned int pps_scaling_list_data_present_flag;\n\tunsigned int lists_modification_present_flag;\n\tunsigned int log2_parallel_merge_level_minus2;\n\tunsigned int slice_segment_header_extension_present_flag;\n\tunsigned int pps_extension_present_flag;\n\tstruct {\n\t\tunsigned int pps_range_extension_flag;\n\t\tunsigned int pps_multilayer_extension_flag;\n\t\tunsigned int pps_3d_extension_flag;\n\t\tunsigned int pps_scc_extension_flag;\n\t\tunsigned int pps_extension_4bits;\n\t};\n};\n\n \nstatic inline int nal_hevc_profile(enum v4l2_mpeg_video_hevc_profile profile)\n{\n\tswitch (profile) {\n\tcase V4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN:\n\t\treturn 1;\n\tcase V4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN_10:\n\t\treturn 2;\n\tcase V4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN_STILL_PICTURE:\n\t\treturn 3;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\n \nstatic inline int nal_hevc_tier(enum v4l2_mpeg_video_hevc_tier tier)\n{\n\tswitch (tier) {\n\tcase V4L2_MPEG_VIDEO_HEVC_TIER_MAIN:\n\t\treturn 0;\n\tcase V4L2_MPEG_VIDEO_HEVC_TIER_HIGH:\n\t\treturn 1;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\n \nstatic inline int nal_hevc_level(enum v4l2_mpeg_video_hevc_level level)\n{\n\t \n\tint factor = 30 / 10;\n\n\tswitch (level) {\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_1:\n\t\treturn factor * 10;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_2:\n\t\treturn factor * 20;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_2_1:\n\t\treturn factor * 21;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_3:\n\t\treturn factor * 30;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_3_1:\n\t\treturn factor * 31;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_4:\n\t\treturn factor * 40;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_4_1:\n\t\treturn factor * 41;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_5:\n\t\treturn factor * 50;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_5_1:\n\t\treturn factor * 51;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_5_2:\n\t\treturn factor * 52;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_6:\n\t\treturn factor * 60;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_6_1:\n\t\treturn factor * 61;\n\tcase V4L2_MPEG_VIDEO_HEVC_LEVEL_6_2:\n\t\treturn factor * 62;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic inline int nal_hevc_full_range(enum v4l2_quantization quantization)\n{\n\tswitch (quantization) {\n\tcase V4L2_QUANTIZATION_FULL_RANGE:\n\t\treturn 1;\n\tcase V4L2_QUANTIZATION_LIM_RANGE:\n\t\treturn 0;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic inline int nal_hevc_color_primaries(enum v4l2_colorspace colorspace)\n{\n\tswitch (colorspace) {\n\tcase V4L2_COLORSPACE_SMPTE170M:\n\t\treturn 6;\n\tcase V4L2_COLORSPACE_SMPTE240M:\n\t\treturn 7;\n\tcase V4L2_COLORSPACE_REC709:\n\t\treturn 1;\n\tcase V4L2_COLORSPACE_470_SYSTEM_M:\n\t\treturn 4;\n\tcase V4L2_COLORSPACE_JPEG:\n\tcase V4L2_COLORSPACE_SRGB:\n\tcase V4L2_COLORSPACE_470_SYSTEM_BG:\n\t\treturn 5;\n\tcase V4L2_COLORSPACE_BT2020:\n\t\treturn 9;\n\tcase V4L2_COLORSPACE_DEFAULT:\n\tcase V4L2_COLORSPACE_OPRGB:\n\tcase V4L2_COLORSPACE_RAW:\n\tcase V4L2_COLORSPACE_DCI_P3:\n\tdefault:\n\t\treturn 2;\n\t}\n}\n\nstatic inline int nal_hevc_transfer_characteristics(enum v4l2_colorspace colorspace,\n\t\t\t\t\t\t    enum v4l2_xfer_func xfer_func)\n{\n\tif (xfer_func == V4L2_XFER_FUNC_DEFAULT)\n\t\txfer_func = V4L2_MAP_XFER_FUNC_DEFAULT(colorspace);\n\n\tswitch (xfer_func) {\n\tcase V4L2_XFER_FUNC_709:\n\t\treturn 6;\n\tcase V4L2_XFER_FUNC_SMPTE2084:\n\t\treturn 16;\n\tcase V4L2_XFER_FUNC_SRGB:\n\tcase V4L2_XFER_FUNC_OPRGB:\n\tcase V4L2_XFER_FUNC_NONE:\n\tcase V4L2_XFER_FUNC_DCI_P3:\n\tcase V4L2_XFER_FUNC_SMPTE240M:\n\tdefault:\n\t\treturn 2;\n\t}\n}\n\nstatic inline int nal_hevc_matrix_coeffs(enum v4l2_colorspace colorspace,\n\t\t\t\t\t enum v4l2_ycbcr_encoding ycbcr_encoding)\n{\n\tif (ycbcr_encoding == V4L2_YCBCR_ENC_DEFAULT)\n\t\tycbcr_encoding = V4L2_MAP_YCBCR_ENC_DEFAULT(colorspace);\n\n\tswitch (ycbcr_encoding) {\n\tcase V4L2_YCBCR_ENC_601:\n\tcase V4L2_YCBCR_ENC_XV601:\n\t\treturn 5;\n\tcase V4L2_YCBCR_ENC_709:\n\tcase V4L2_YCBCR_ENC_XV709:\n\t\treturn 1;\n\tcase V4L2_YCBCR_ENC_BT2020:\n\t\treturn 9;\n\tcase V4L2_YCBCR_ENC_BT2020_CONST_LUM:\n\t\treturn 10;\n\tcase V4L2_YCBCR_ENC_SMPTE240M:\n\tdefault:\n\t\treturn 2;\n\t}\n}\n\nssize_t nal_hevc_write_vps(const struct device *dev,\n\t\t\t   void *dest, size_t n, struct nal_hevc_vps *vps);\nssize_t nal_hevc_read_vps(const struct device *dev,\n\t\t\t  struct nal_hevc_vps *vps, void *src, size_t n);\n\nssize_t nal_hevc_write_sps(const struct device *dev,\n\t\t\t   void *dest, size_t n, struct nal_hevc_sps *sps);\nssize_t nal_hevc_read_sps(const struct device *dev,\n\t\t\t  struct nal_hevc_sps *sps, void *src, size_t n);\n\nssize_t nal_hevc_write_pps(const struct device *dev,\n\t\t\t   void *dest, size_t n, struct nal_hevc_pps *pps);\nssize_t nal_hevc_read_pps(const struct device *dev,\n\t\t\t  struct nal_hevc_pps *pps, void *src, size_t n);\n\nssize_t nal_hevc_write_filler(const struct device *dev, void *dest, size_t n);\nssize_t nal_hevc_read_filler(const struct device *dev, void *src, size_t n);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}