{
  "module_name": "imx8-isi-gasket.c",
  "hash_id": "d2fdf2354122115ef3d9ceee6b5e0b88d677fd693de1e67373fc9e3e5316ef6f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/nxp/imx8-isi/imx8-isi-gasket.c",
  "human_readable_source": "\n \n\n#include <linux/regmap.h>\n\n#include <media/mipi-csi2.h>\n\n#include \"imx8-isi-core.h\"\n\n \n\n#define GASKET_BASE(n)\t\t\t\t(0x0060 + (n) * 0x30)\n\n#define GASKET_CTRL\t\t\t\t0x0000\n#define GASKET_CTRL_DATA_TYPE(dt)\t\t((dt) << 8)\n#define GASKET_CTRL_DATA_TYPE_MASK\t\t(0x3f << 8)\n#define GASKET_CTRL_DUAL_COMP_ENABLE\t\tBIT(1)\n#define GASKET_CTRL_ENABLE\t\t\tBIT(0)\n\n#define GASKET_HSIZE\t\t\t\t0x0004\n#define GASKET_VSIZE\t\t\t\t0x0008\n\nstatic void mxc_imx8_gasket_enable(struct mxc_isi_dev *isi,\n\t\t\t\t   const struct v4l2_mbus_frame_desc *fd,\n\t\t\t\t   const struct v4l2_mbus_framefmt *fmt,\n\t\t\t\t   const unsigned int port)\n{\n\tu32 val;\n\n\tregmap_write(isi->gasket, GASKET_BASE(port) + GASKET_HSIZE, fmt->width);\n\tregmap_write(isi->gasket, GASKET_BASE(port) + GASKET_VSIZE, fmt->height);\n\n\tval = GASKET_CTRL_DATA_TYPE(fd->entry[0].bus.csi2.dt);\n\tif (fd->entry[0].bus.csi2.dt == MIPI_CSI2_DT_YUV422_8B)\n\t\tval |= GASKET_CTRL_DUAL_COMP_ENABLE;\n\n\tval |= GASKET_CTRL_ENABLE;\n\tregmap_write(isi->gasket, GASKET_BASE(port) + GASKET_CTRL, val);\n}\n\nstatic void mxc_imx8_gasket_disable(struct mxc_isi_dev *isi,\n\t\t\t\t    const unsigned int port)\n{\n\tregmap_write(isi->gasket, GASKET_BASE(port) + GASKET_CTRL, 0);\n}\n\nconst struct mxc_gasket_ops mxc_imx8_gasket_ops = {\n\t.enable = mxc_imx8_gasket_enable,\n\t.disable = mxc_imx8_gasket_disable,\n};\n\n \n\n#define DISP_MIX_CAMERA_MUX                     0x30\n#define DISP_MIX_CAMERA_MUX_DATA_TYPE(x)        (((x) & 0x3f) << 3)\n#define DISP_MIX_CAMERA_MUX_GASKET_ENABLE       BIT(16)\n\nstatic void mxc_imx93_gasket_enable(struct mxc_isi_dev *isi,\n\t\t\t\t    const struct v4l2_mbus_frame_desc *fd,\n\t\t\t\t    const struct v4l2_mbus_framefmt *fmt,\n\t\t\t\t    const unsigned int port)\n{\n\tu32 val;\n\n\tval = DISP_MIX_CAMERA_MUX_DATA_TYPE(fd->entry[0].bus.csi2.dt);\n\tval |= DISP_MIX_CAMERA_MUX_GASKET_ENABLE;\n\tregmap_write(isi->gasket, DISP_MIX_CAMERA_MUX, val);\n}\n\nstatic void mxc_imx93_gasket_disable(struct mxc_isi_dev *isi,\n\t\t\t\t     unsigned int port)\n{\n\tregmap_write(isi->gasket, DISP_MIX_CAMERA_MUX, 0);\n}\n\nconst struct mxc_gasket_ops mxc_imx93_gasket_ops = {\n\t.enable = mxc_imx93_gasket_enable,\n\t.disable = mxc_imx93_gasket_disable,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}