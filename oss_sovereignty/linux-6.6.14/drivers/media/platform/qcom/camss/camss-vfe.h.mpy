{
  "module_name": "camss-vfe.h",
  "hash_id": "265ee160732ec89cf33e0bf79b329ec98b38756248657bd5c30e1f7534a0f4ad",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/qcom/camss/camss-vfe.h",
  "human_readable_source": " \n \n#ifndef QC_MSM_CAMSS_VFE_H\n#define QC_MSM_CAMSS_VFE_H\n\n#include <linux/clk.h>\n#include <linux/spinlock_types.h>\n#include <media/media-entity.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-subdev.h>\n\n#include \"camss-video.h\"\n#include \"camss-vfe-gen1.h\"\n\n#define MSM_VFE_PAD_SINK 0\n#define MSM_VFE_PAD_SRC 1\n#define MSM_VFE_PADS_NUM 2\n\n#define MSM_VFE_IMAGE_MASTERS_NUM 7\n#define MSM_VFE_COMPOSITE_IRQ_NUM 4\n\n \n#define VFE_HALT_TIMEOUT_MS 100\n \n#define VFE_FRAME_DROP_VAL 30\n\n#define vfe_line_array(ptr_line)\t\\\n\t((const struct vfe_line (*)[]) &(ptr_line)[-(ptr_line)->id])\n\n#define to_vfe(ptr_line)\t\\\n\tcontainer_of(vfe_line_array(ptr_line), struct vfe_device, line)\n\nenum vfe_output_state {\n\tVFE_OUTPUT_OFF,\n\tVFE_OUTPUT_RESERVED,\n\tVFE_OUTPUT_SINGLE,\n\tVFE_OUTPUT_CONTINUOUS,\n\tVFE_OUTPUT_IDLE,\n\tVFE_OUTPUT_STOPPING,\n\tVFE_OUTPUT_ON,\n};\n\nenum vfe_line_id {\n\tVFE_LINE_NONE = -1,\n\tVFE_LINE_RDI0 = 0,\n\tVFE_LINE_RDI1 = 1,\n\tVFE_LINE_RDI2 = 2,\n\tVFE_LINE_NUM_GEN2 = 3,\n\tVFE_LINE_PIX = 3,\n\tVFE_LINE_NUM_GEN1 = 4,\n\tVFE_LINE_NUM_MAX = 4\n};\n\nstruct vfe_output {\n\tu8 wm_num;\n\tu8 wm_idx[3];\n\n\tstruct camss_buffer *buf[2];\n\tstruct camss_buffer *last_buffer;\n\tstruct list_head pending_bufs;\n\n\tunsigned int drop_update_idx;\n\n\tunion {\n\t\tstruct {\n\t\t\tint active_buf;\n\t\t\tint wait_sof;\n\t\t} gen1;\n\t\tstruct {\n\t\t\tint active_num;\n\t\t} gen2;\n\t};\n\tenum vfe_output_state state;\n\tunsigned int sequence;\n\n\tint wait_reg_update;\n\tstruct completion sof;\n\tstruct completion reg_update;\n};\n\nstruct vfe_line {\n\tenum vfe_line_id id;\n\tstruct v4l2_subdev subdev;\n\tstruct media_pad pads[MSM_VFE_PADS_NUM];\n\tstruct v4l2_mbus_framefmt fmt[MSM_VFE_PADS_NUM];\n\tstruct v4l2_rect compose;\n\tstruct v4l2_rect crop;\n\tstruct camss_video video_out;\n\tstruct vfe_output output;\n\tconst struct vfe_format *formats;\n\tunsigned int nformats;\n};\n\nstruct vfe_device;\n\nstruct vfe_hw_ops {\n\tvoid (*enable_irq_common)(struct vfe_device *vfe);\n\tvoid (*global_reset)(struct vfe_device *vfe);\n\tu32 (*hw_version)(struct vfe_device *vfe);\n\tirqreturn_t (*isr)(int irq, void *dev);\n\tvoid (*isr_read)(struct vfe_device *vfe, u32 *value0, u32 *value1);\n\tvoid (*pm_domain_off)(struct vfe_device *vfe);\n\tint (*pm_domain_on)(struct vfe_device *vfe);\n\tvoid (*reg_update)(struct vfe_device *vfe, enum vfe_line_id line_id);\n\tvoid (*reg_update_clear)(struct vfe_device *vfe,\n\t\t\t\t enum vfe_line_id line_id);\n\tvoid (*subdev_init)(struct device *dev, struct vfe_device *vfe);\n\tint (*vfe_disable)(struct vfe_line *line);\n\tint (*vfe_enable)(struct vfe_line *line);\n\tint (*vfe_halt)(struct vfe_device *vfe);\n\tvoid (*violation_read)(struct vfe_device *vfe);\n};\n\nstruct vfe_isr_ops {\n\tvoid (*reset_ack)(struct vfe_device *vfe);\n\tvoid (*halt_ack)(struct vfe_device *vfe);\n\tvoid (*reg_update)(struct vfe_device *vfe, enum vfe_line_id line_id);\n\tvoid (*sof)(struct vfe_device *vfe, enum vfe_line_id line_id);\n\tvoid (*comp_done)(struct vfe_device *vfe, u8 comp);\n\tvoid (*wm_done)(struct vfe_device *vfe, u8 wm);\n};\n\nstruct vfe_device {\n\tstruct camss *camss;\n\tu8 id;\n\tvoid __iomem *base;\n\tu32 irq;\n\tchar irq_name[30];\n\tstruct camss_clock *clock;\n\tint nclocks;\n\tstruct completion reset_complete;\n\tstruct completion halt_complete;\n\tstruct mutex power_lock;\n\tint power_count;\n\tstruct mutex stream_lock;\n\tint stream_count;\n\tspinlock_t output_lock;\n\tenum vfe_line_id wm_output_map[MSM_VFE_IMAGE_MASTERS_NUM];\n\tstruct vfe_line line[VFE_LINE_NUM_MAX];\n\tu8 line_num;\n\tu32 reg_update;\n\tu8 was_streaming;\n\tconst struct vfe_hw_ops *ops;\n\tconst struct vfe_hw_ops_gen1 *ops_gen1;\n\tstruct vfe_isr_ops isr_ops;\n\tstruct camss_video_ops video_ops;\n};\n\nstruct resources;\n\nint msm_vfe_subdev_init(struct camss *camss, struct vfe_device *vfe,\n\t\t\tconst struct resources *res, u8 id);\n\nint msm_vfe_register_entities(struct vfe_device *vfe,\n\t\t\t      struct v4l2_device *v4l2_dev);\n\nvoid msm_vfe_unregister_entities(struct vfe_device *vfe);\n\n \nvoid vfe_buf_add_pending(struct vfe_output *output, struct camss_buffer *buffer);\n\nstruct camss_buffer *vfe_buf_get_pending(struct vfe_output *output);\n\nint vfe_flush_buffers(struct camss_video *vid, enum vb2_buffer_state state);\n\n \nvoid vfe_isr_comp_done(struct vfe_device *vfe, u8 comp);\n\nvoid vfe_isr_reset_ack(struct vfe_device *vfe);\nint vfe_put_output(struct vfe_line *line);\nint vfe_release_wm(struct vfe_device *vfe, u8 wm);\nint vfe_reserve_wm(struct vfe_device *vfe, enum vfe_line_id line_id);\n\n \nint vfe_reset(struct vfe_device *vfe);\n\nextern const struct vfe_hw_ops vfe_ops_4_1;\nextern const struct vfe_hw_ops vfe_ops_4_7;\nextern const struct vfe_hw_ops vfe_ops_4_8;\nextern const struct vfe_hw_ops vfe_ops_170;\nextern const struct vfe_hw_ops vfe_ops_480;\n\nint vfe_get(struct vfe_device *vfe);\nvoid vfe_put(struct vfe_device *vfe);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}