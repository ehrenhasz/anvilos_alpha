{
  "module_name": "venc_ctrls.c",
  "hash_id": "5c28e8fc1d301c7091aea8103de352251619e21cc448da6d9169b91d5f09ef8e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/qcom/venus/venc_ctrls.c",
  "human_readable_source": "\n \n#include <linux/types.h>\n#include <media/v4l2-ctrls.h>\n\n#include \"core.h\"\n#include \"venc.h\"\n#include \"helpers.h\"\n\n#define BITRATE_MIN\t\t32000\n#define BITRATE_MAX\t\t160000000\n#define BITRATE_DEFAULT\t\t1000000\n#define BITRATE_DEFAULT_PEAK\t(BITRATE_DEFAULT * 2)\n#define BITRATE_STEP\t\t100\n#define SLICE_BYTE_SIZE_MAX\t1024\n#define SLICE_BYTE_SIZE_MIN\t1024\n#define SLICE_MB_SIZE_MAX\t300\n#define AT_SLICE_BOUNDARY\t\\\n\tV4L2_MPEG_VIDEO_H264_LOOP_FILTER_MODE_DISABLED_AT_SLICE_BOUNDARY\n#define MAX_LTR_FRAME_COUNT 4\n\nstatic int venc_calc_bpframes(u32 gop_size, u32 conseq_b, u32 *bf, u32 *pf)\n{\n\tu32 half = (gop_size - 1) >> 1;\n\tu32 b, p, ratio;\n\tbool found = false;\n\n\tif (!gop_size)\n\t\treturn -EINVAL;\n\n\t*bf = *pf = 0;\n\n\tif (!conseq_b) {\n\t\t*pf = gop_size -  1;\n\t\treturn 0;\n\t}\n\n\tb = p = half;\n\n\tfor (; b <= gop_size - 1; b++, p--) {\n\t\tif (b % p)\n\t\t\tcontinue;\n\n\t\tratio = b / p;\n\n\t\tif (ratio == conseq_b) {\n\t\t\tfound = true;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (ratio > conseq_b)\n\t\t\tbreak;\n\t}\n\n\tif (!found)\n\t\treturn -EINVAL;\n\n\tif (b + p + 1 != gop_size)\n\t\treturn -EINVAL;\n\n\t*bf = b;\n\t*pf = p;\n\n\treturn 0;\n}\n\nstatic int venc_op_s_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct venus_inst *inst = ctrl_to_inst(ctrl);\n\tstruct venc_controls *ctr = &inst->controls.enc;\n\tstruct hfi_enable en = { .enable = 1 };\n\tstruct hfi_bitrate brate;\n\tstruct hfi_ltr_use ltr_use;\n\tstruct hfi_ltr_mark ltr_mark;\n\tu32 bframes;\n\tu32 ptype;\n\tint ret;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_MPEG_VIDEO_BITRATE_MODE:\n\t\tctr->bitrate_mode = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_BITRATE:\n\t\tctr->bitrate = ctrl->val;\n\t\tmutex_lock(&inst->lock);\n\t\tif (inst->streamon_out && inst->streamon_cap) {\n\t\t\tptype = HFI_PROPERTY_CONFIG_VENC_TARGET_BITRATE;\n\t\t\tbrate.bitrate = ctr->bitrate;\n\t\t\tbrate.layer_id = 0;\n\n\t\t\tret = hfi_session_set_property(inst, ptype, &brate);\n\t\t\tif (ret) {\n\t\t\t\tmutex_unlock(&inst->lock);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tmutex_unlock(&inst->lock);\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_BITRATE_PEAK:\n\t\tctr->bitrate_peak = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_ENTROPY_MODE:\n\t\tctr->h264_entropy_mode = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_MPEG4_PROFILE:\n\t\tctr->profile.mpeg4 = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_PROFILE:\n\t\tctr->profile.h264 = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_PROFILE:\n\t\tctr->profile.hevc = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_VP8_PROFILE:\n\t\tctr->profile.vp8 = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_MPEG4_LEVEL:\n\t\tctr->level.mpeg4 = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_LEVEL:\n\t\tctr->level.h264 = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_LEVEL:\n\t\tctr->level.hevc = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_I_FRAME_QP:\n\t\tctr->h264_i_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_P_FRAME_QP:\n\t\tctr->h264_p_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_B_FRAME_QP:\n\t\tctr->h264_b_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_MIN_QP:\n\t\tctr->h264_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_I_FRAME_MIN_QP:\n\t\tctr->h264_i_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_P_FRAME_MIN_QP:\n\t\tctr->h264_p_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_B_FRAME_MIN_QP:\n\t\tctr->h264_b_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_MAX_QP:\n\t\tctr->h264_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_I_FRAME_MAX_QP:\n\t\tctr->h264_i_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_P_FRAME_MAX_QP:\n\t\tctr->h264_p_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_B_FRAME_MAX_QP:\n\t\tctr->h264_b_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_I_FRAME_QP:\n\t\tctr->hevc_i_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_P_FRAME_QP:\n\t\tctr->hevc_p_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_B_FRAME_QP:\n\t\tctr->hevc_b_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_MIN_QP:\n\t\tctr->hevc_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_I_FRAME_MIN_QP:\n\t\tctr->hevc_i_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_P_FRAME_MIN_QP:\n\t\tctr->hevc_p_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_B_FRAME_MIN_QP:\n\t\tctr->hevc_b_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_MAX_QP:\n\t\tctr->hevc_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_I_FRAME_MAX_QP:\n\t\tctr->hevc_i_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_P_FRAME_MAX_QP:\n\t\tctr->hevc_p_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEVC_B_FRAME_MAX_QP:\n\t\tctr->hevc_b_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_MULTI_SLICE_MODE:\n\t\tctr->multi_slice_mode = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_MULTI_SLICE_MAX_BYTES:\n\t\tctr->multi_slice_max_bytes = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_MULTI_SLICE_MAX_MB:\n\t\tctr->multi_slice_max_mb = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_LOOP_FILTER_ALPHA:\n\t\tctr->h264_loop_filter_alpha = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_LOOP_FILTER_BETA:\n\t\tctr->h264_loop_filter_beta = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_LOOP_FILTER_MODE:\n\t\tctr->h264_loop_filter_mode = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_HEADER_MODE:\n\t\tctr->header_mode = ctrl->val;\n\t\tmutex_lock(&inst->lock);\n\t\tif (inst->streamon_out && inst->streamon_cap) {\n\t\t\tif (ctrl->val == V4L2_MPEG_VIDEO_HEADER_MODE_SEPARATE)\n\t\t\t\ten.enable = 0;\n\t\t\telse\n\t\t\t\ten.enable = 1;\n\t\t\tptype = HFI_PROPERTY_CONFIG_VENC_SYNC_FRAME_SEQUENCE_HEADER;\n\t\t\tret = hfi_session_set_property(inst, ptype, &en);\n\t\t\tif (ret) {\n\t\t\t\tmutex_unlock(&inst->lock);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tmutex_unlock(&inst->lock);\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_GOP_SIZE:\n\t\tret = venc_calc_bpframes(ctrl->val, ctr->num_b_frames, &bframes,\n\t\t\t\t\t &ctr->num_p_frames);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tctr->gop_size = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_I_PERIOD:\n\t\tctr->h264_i_period = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_VPX_MIN_QP:\n\t\tctr->vp8_min_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_VPX_MAX_QP:\n\t\tctr->vp8_max_qp = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_B_FRAMES:\n\t\tret = venc_calc_bpframes(ctr->gop_size, ctrl->val, &bframes,\n\t\t\t\t\t &ctr->num_p_frames);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tctr->num_b_frames = bframes;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_FORCE_KEY_FRAME:\n\t\tmutex_lock(&inst->lock);\n\t\tif (inst->streamon_out && inst->streamon_cap) {\n\t\t\tptype = HFI_PROPERTY_CONFIG_VENC_REQUEST_SYNC_FRAME;\n\t\t\tret = hfi_session_set_property(inst, ptype, &en);\n\n\t\t\tif (ret) {\n\t\t\t\tmutex_unlock(&inst->lock);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tmutex_unlock(&inst->lock);\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_FRAME_RC_ENABLE:\n\t\tctr->rc_enable = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_CONSTANT_QUALITY:\n\t\tctr->const_quality = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_FRAME_SKIP_MODE:\n\t\tctr->frame_skip_mode = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_BASELAYER_PRIORITY_ID:\n\t\tctr->base_priority_id = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_AU_DELIMITER:\n\t\tctr->aud_enable = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_LTR_COUNT:\n\t\tctr->ltr_count = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_FRAME_LTR_INDEX:\n\t\tmutex_lock(&inst->lock);\n\t\tif (inst->streamon_out && inst->streamon_cap) {\n\t\t\tptype = HFI_PROPERTY_CONFIG_VENC_MARKLTRFRAME;\n\t\t\tltr_mark.mark_frame = ctrl->val;\n\t\t\tret = hfi_session_set_property(inst, ptype, &ltr_mark);\n\t\t\tif (ret) {\n\t\t\t\tmutex_unlock(&inst->lock);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tmutex_unlock(&inst->lock);\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_USE_LTR_FRAMES:\n\t\tmutex_lock(&inst->lock);\n\t\tif (inst->streamon_out && inst->streamon_cap) {\n\t\t\tptype = HFI_PROPERTY_CONFIG_VENC_USELTRFRAME;\n\t\t\tltr_use.ref_ltr = ctrl->val;\n\t\t\tltr_use.use_constrnt = true;\n\t\t\tltr_use.frames = 0;\n\t\t\tret = hfi_session_set_property(inst, ptype, &ltr_use);\n\t\t\tif (ret) {\n\t\t\t\tmutex_unlock(&inst->lock);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t\tmutex_unlock(&inst->lock);\n\t\tbreak;\n\tcase V4L2_CID_COLORIMETRY_HDR10_CLL_INFO:\n\t\tctr->cll = *ctrl->p_new.p_hdr10_cll;\n\t\tbreak;\n\tcase V4L2_CID_COLORIMETRY_HDR10_MASTERING_DISPLAY:\n\t\tctr->mastering = *ctrl->p_new.p_hdr10_mastering;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_INTRA_REFRESH_PERIOD_TYPE:\n\t\tctr->intra_refresh_type = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_INTRA_REFRESH_PERIOD:\n\t\tctr->intra_refresh_period = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_8X8_TRANSFORM:\n\t\tif (ctr->profile.h264 != V4L2_MPEG_VIDEO_H264_PROFILE_HIGH &&\n\t\t    ctr->profile.h264 != V4L2_MPEG_VIDEO_H264_PROFILE_CONSTRAINED_HIGH)\n\t\t\treturn -EINVAL;\n\n\t\t \n\n\n\t\tctr->h264_8x8_transform = ctrl->val;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int venc_op_g_volatile_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct venus_inst *inst = ctrl_to_inst(ctrl);\n\tstruct hfi_buffer_requirements bufreq;\n\tenum hfi_version ver = inst->core->res->hfi_version;\n\tint ret;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_MIN_BUFFERS_FOR_OUTPUT:\n\t\tret = venus_helper_get_bufreq(inst, HFI_BUFFER_INPUT, &bufreq);\n\t\tif (!ret)\n\t\t\tctrl->val = hfi_bufreq_get_count_min(&bufreq, ver);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct v4l2_ctrl_ops venc_ctrl_ops = {\n\t.s_ctrl = venc_op_s_ctrl,\n\t.g_volatile_ctrl = venc_op_g_volatile_ctrl,\n};\n\nint venc_ctrl_init(struct venus_inst *inst)\n{\n\tint ret;\n\tstruct v4l2_ctrl_hdr10_mastering_display p_hdr10_mastering = {\n\t\t{ 34000, 13250, 7500 },\n\t\t{ 16000, 34500, 3000 }, 15635, 16450, 10000000, 500,\n\t};\n\tstruct v4l2_ctrl_hdr10_cll_info p_hdr10_cll = { 1000, 400 };\n\n\tret = v4l2_ctrl_handler_init(&inst->ctrl_handler, 59);\n\tif (ret)\n\t\treturn ret;\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_BITRATE_MODE,\n\t\tV4L2_MPEG_VIDEO_BITRATE_MODE_CBR,\n\t\t~((1 << V4L2_MPEG_VIDEO_BITRATE_MODE_VBR) |\n\t\t  (1 << V4L2_MPEG_VIDEO_BITRATE_MODE_CBR) |\n\t\t  (1 << V4L2_MPEG_VIDEO_BITRATE_MODE_CQ)),\n\t\tV4L2_MPEG_VIDEO_BITRATE_MODE_VBR);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_ENTROPY_MODE,\n\t\tV4L2_MPEG_VIDEO_H264_ENTROPY_MODE_CABAC,\n\t\t0, V4L2_MPEG_VIDEO_H264_ENTROPY_MODE_CAVLC);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_MPEG4_PROFILE,\n\t\tV4L2_MPEG_VIDEO_MPEG4_PROFILE_ADVANCED_CODING_EFFICIENCY,\n\t\t~((1 << V4L2_MPEG_VIDEO_MPEG4_PROFILE_SIMPLE) |\n\t\t  (1 << V4L2_MPEG_VIDEO_MPEG4_PROFILE_ADVANCED_SIMPLE)),\n\t\tV4L2_MPEG_VIDEO_MPEG4_PROFILE_SIMPLE);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_MPEG4_LEVEL,\n\t\tV4L2_MPEG_VIDEO_MPEG4_LEVEL_5,\n\t\t0, V4L2_MPEG_VIDEO_MPEG4_LEVEL_0);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_HEVC_PROFILE,\n\t\tV4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN_10,\n\t\t~((1 << V4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN) |\n\t\t  (1 << V4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN_STILL_PICTURE) |\n\t\t  (1 << V4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN_10)),\n\t\tV4L2_MPEG_VIDEO_HEVC_PROFILE_MAIN);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_HEVC_LEVEL,\n\t\tV4L2_MPEG_VIDEO_HEVC_LEVEL_6_2,\n\t\t0, V4L2_MPEG_VIDEO_HEVC_LEVEL_1);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_PROFILE,\n\t\tV4L2_MPEG_VIDEO_H264_PROFILE_MULTIVIEW_HIGH,\n\t\t~((1 << V4L2_MPEG_VIDEO_H264_PROFILE_BASELINE) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_CONSTRAINED_BASELINE) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_MAIN) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_HIGH) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_STEREO_HIGH) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_MULTIVIEW_HIGH)),\n\t\tV4L2_MPEG_VIDEO_H264_PROFILE_HIGH);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_LEVEL,\n\t\tV4L2_MPEG_VIDEO_H264_LEVEL_5_1,\n\t\t0, V4L2_MPEG_VIDEO_H264_LEVEL_1_0);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_LOOP_FILTER_MODE,\n\t\tAT_SLICE_BOUNDARY,\n\t\t0, V4L2_MPEG_VIDEO_H264_LOOP_FILTER_MODE_DISABLED);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_HEADER_MODE,\n\t\tV4L2_MPEG_VIDEO_HEADER_MODE_JOINED_WITH_1ST_FRAME,\n\t\t~((1 << V4L2_MPEG_VIDEO_HEADER_MODE_SEPARATE) |\n\t\t(1 << V4L2_MPEG_VIDEO_HEADER_MODE_JOINED_WITH_1ST_FRAME)),\n\t\tV4L2_MPEG_VIDEO_HEADER_MODE_JOINED_WITH_1ST_FRAME);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_MULTI_SLICE_MODE,\n\t\tV4L2_MPEG_VIDEO_MULTI_SLICE_MODE_MAX_BYTES,\n\t\t0, V4L2_MPEG_VIDEO_MULTI_SLICE_MODE_SINGLE);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_VP8_PROFILE,\n\t\tV4L2_MPEG_VIDEO_VP8_PROFILE_3,\n\t\t0, V4L2_MPEG_VIDEO_VP8_PROFILE_0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MIN_BUFFERS_FOR_OUTPUT, 4, 11, 1, 4);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_BITRATE, BITRATE_MIN, BITRATE_MAX,\n\t\tBITRATE_STEP, BITRATE_DEFAULT);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_BITRATE_PEAK, BITRATE_MIN, BITRATE_MAX,\n\t\tBITRATE_STEP, BITRATE_DEFAULT_PEAK);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_I_FRAME_QP, 1, 51, 1, 26);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_P_FRAME_QP, 1, 51, 1, 28);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_B_FRAME_QP, 1, 51, 1, 30);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_MIN_QP, 1, 51, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_I_FRAME_MIN_QP, 1, 51, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_8X8_TRANSFORM, 0, 1, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_P_FRAME_MIN_QP, 1, 51, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_B_FRAME_MIN_QP, 1, 51, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_MAX_QP, 1, 51, 1, 51);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_I_FRAME_MAX_QP, 1, 51, 1, 51);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_P_FRAME_MAX_QP, 1, 51, 1, 51);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_H264_B_FRAME_MAX_QP, 1, 51, 1, 51);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_I_FRAME_QP, 1, 63, 1, 26);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_P_FRAME_QP, 1, 63, 1, 28);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_B_FRAME_QP, 1, 63, 1, 30);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_MIN_QP, 1, 63, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_I_FRAME_MIN_QP, 1, 63, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_P_FRAME_MIN_QP, 1, 63, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_B_FRAME_MIN_QP, 1, 63, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_MAX_QP, 1, 63, 1, 63);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_I_FRAME_MAX_QP, 1, 63, 1, 63);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_P_FRAME_MAX_QP, 1, 63, 1, 63);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_HEVC_B_FRAME_MAX_QP, 1, 63, 1, 63);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_MULTI_SLICE_MAX_BYTES, SLICE_BYTE_SIZE_MIN,\n\t\tSLICE_BYTE_SIZE_MAX, 1, SLICE_BYTE_SIZE_MIN);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_MULTI_SLICE_MAX_MB, 1,\n\t\tSLICE_MB_SIZE_MAX, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_LOOP_FILTER_ALPHA, -6, 6, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_LOOP_FILTER_BETA, -6, 6, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_GOP_SIZE, 0, (1 << 16) - 1, 1, 30);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_VPX_MIN_QP, 1, 128, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_VPX_MAX_QP, 1, 128, 1, 128);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_B_FRAMES, 0, 4, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_I_PERIOD, 0, (1 << 16) - 1, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_FORCE_KEY_FRAME, 0, 0, 0, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_FRAME_RC_ENABLE, 0, 1, 1, 1);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_CONSTANT_QUALITY, 0, 100, 1, 0);\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t       V4L2_CID_MPEG_VIDEO_FRAME_SKIP_MODE,\n\t\t\t       V4L2_MPEG_VIDEO_FRAME_SKIP_MODE_BUF_LIMIT,\n\t\t\t       ~((1 << V4L2_MPEG_VIDEO_FRAME_SKIP_MODE_DISABLED) |\n\t\t\t       (1 << V4L2_MPEG_VIDEO_FRAME_SKIP_MODE_BUF_LIMIT)),\n\t\t\t       V4L2_MPEG_VIDEO_FRAME_SKIP_MODE_DISABLED);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_BASELAYER_PRIORITY_ID, 0,\n\t\t\t  6, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_AU_DELIMITER, 0, 1, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_USE_LTR_FRAMES, 0,\n\t\t\t  ((1 << MAX_LTR_FRAME_COUNT) - 1), 0, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_LTR_COUNT, 0,\n\t\t\t  MAX_LTR_FRAME_COUNT, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_FRAME_LTR_INDEX, 0,\n\t\t\t  (MAX_LTR_FRAME_COUNT - 1), 1, 0);\n\n\tv4l2_ctrl_new_std_compound(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t\t   V4L2_CID_COLORIMETRY_HDR10_CLL_INFO,\n\t\t\t\t   v4l2_ctrl_ptr_create(&p_hdr10_cll));\n\n\tv4l2_ctrl_new_std_compound(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t\t   V4L2_CID_COLORIMETRY_HDR10_MASTERING_DISPLAY,\n\t\t\t\t   v4l2_ctrl_ptr_create((void *)&p_hdr10_mastering));\n\n\tv4l2_ctrl_new_std_menu(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t       V4L2_CID_MPEG_VIDEO_INTRA_REFRESH_PERIOD_TYPE,\n\t\t\t       V4L2_CID_MPEG_VIDEO_INTRA_REFRESH_PERIOD_TYPE_CYCLIC,\n\t\t\t       0, V4L2_CID_MPEG_VIDEO_INTRA_REFRESH_PERIOD_TYPE_RANDOM);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &venc_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_INTRA_REFRESH_PERIOD, 0,\n\t\t\t  ((4096 * 2304) >> 8), 1, 0);\n\n\tret = inst->ctrl_handler.error;\n\tif (ret)\n\t\tgoto err;\n\n\tret = v4l2_ctrl_handler_setup(&inst->ctrl_handler);\n\tif (ret)\n\t\tgoto err;\n\n\treturn 0;\nerr:\n\tv4l2_ctrl_handler_free(&inst->ctrl_handler);\n\treturn ret;\n}\n\nvoid venc_ctrl_deinit(struct venus_inst *inst)\n{\n\tv4l2_ctrl_handler_free(&inst->ctrl_handler);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}