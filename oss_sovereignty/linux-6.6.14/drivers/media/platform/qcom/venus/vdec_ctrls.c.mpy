{
  "module_name": "vdec_ctrls.c",
  "hash_id": "44893adf05f7648baeb688f83d0d6b6485bee7e41742a06cfdfe56d2969e50bf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/qcom/venus/vdec_ctrls.c",
  "human_readable_source": "\n \n#include <linux/types.h>\n#include <media/v4l2-ctrls.h>\n\n#include \"core.h\"\n#include \"helpers.h\"\n#include \"vdec.h\"\n\nstatic int vdec_op_s_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct venus_inst *inst = ctrl_to_inst(ctrl);\n\tstruct vdec_controls *ctr = &inst->controls.dec;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_MPEG_VIDEO_DECODER_MPEG4_DEBLOCK_FILTER:\n\t\tctr->post_loop_deb_mode = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_PROFILE:\n\tcase V4L2_CID_MPEG_VIDEO_MPEG4_PROFILE:\n\tcase V4L2_CID_MPEG_VIDEO_VP8_PROFILE:\n\tcase V4L2_CID_MPEG_VIDEO_VP9_PROFILE:\n\t\tctr->profile = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_LEVEL:\n\tcase V4L2_CID_MPEG_VIDEO_MPEG4_LEVEL:\n\tcase V4L2_CID_MPEG_VIDEO_VP9_LEVEL:\n\t\tctr->level = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_DEC_DISPLAY_DELAY:\n\t\tctr->display_delay = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_DEC_DISPLAY_DELAY_ENABLE:\n\t\tctr->display_delay_enable = ctrl->val;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_DEC_CONCEAL_COLOR:\n\t\tctr->conceal_color = *ctrl->p_new.p_s64;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int vdec_op_g_volatile_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct venus_inst *inst = ctrl_to_inst(ctrl);\n\tstruct vdec_controls *ctr = &inst->controls.dec;\n\tstruct hfi_buffer_requirements bufreq;\n\tenum hfi_version ver = inst->core->res->hfi_version;\n\tu32 profile, level;\n\tint ret;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_MPEG_VIDEO_H264_PROFILE:\n\tcase V4L2_CID_MPEG_VIDEO_MPEG4_PROFILE:\n\tcase V4L2_CID_MPEG_VIDEO_VP8_PROFILE:\n\tcase V4L2_CID_MPEG_VIDEO_VP9_PROFILE:\n\t\tret = venus_helper_get_profile_level(inst, &profile, &level);\n\t\tif (!ret)\n\t\t\tctr->profile = profile;\n\t\tctrl->val = ctr->profile;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_H264_LEVEL:\n\tcase V4L2_CID_MPEG_VIDEO_MPEG4_LEVEL:\n\tcase V4L2_CID_MPEG_VIDEO_VP9_LEVEL:\n\t\tret = venus_helper_get_profile_level(inst, &profile, &level);\n\t\tif (!ret)\n\t\t\tctr->level = level;\n\t\tctrl->val = ctr->level;\n\t\tbreak;\n\tcase V4L2_CID_MPEG_VIDEO_DECODER_MPEG4_DEBLOCK_FILTER:\n\t\tctrl->val = ctr->post_loop_deb_mode;\n\t\tbreak;\n\tcase V4L2_CID_MIN_BUFFERS_FOR_CAPTURE:\n\t\tret = venus_helper_get_bufreq(inst, HFI_BUFFER_OUTPUT, &bufreq);\n\t\tif (!ret)\n\t\t\tctrl->val = hfi_bufreq_get_count_min(&bufreq, ver);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct v4l2_ctrl_ops vdec_ctrl_ops = {\n\t.s_ctrl = vdec_op_s_ctrl,\n\t.g_volatile_ctrl = vdec_op_g_volatile_ctrl,\n};\n\nint vdec_ctrl_init(struct venus_inst *inst)\n{\n\tstruct v4l2_ctrl *ctrl;\n\tint ret;\n\n\tret = v4l2_ctrl_handler_init(&inst->ctrl_handler, 12);\n\tif (ret)\n\t\treturn ret;\n\n\tctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_MPEG4_PROFILE,\n\t\tV4L2_MPEG_VIDEO_MPEG4_PROFILE_ADVANCED_CODING_EFFICIENCY,\n\t\t~((1 << V4L2_MPEG_VIDEO_MPEG4_PROFILE_SIMPLE) |\n\t\t  (1 << V4L2_MPEG_VIDEO_MPEG4_PROFILE_ADVANCED_SIMPLE)),\n\t\tV4L2_MPEG_VIDEO_MPEG4_PROFILE_SIMPLE);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t\t      V4L2_CID_MPEG_VIDEO_MPEG4_LEVEL,\n\t\t\t\t      V4L2_MPEG_VIDEO_MPEG4_LEVEL_5,\n\t\t\t\t      0, V4L2_MPEG_VIDEO_MPEG4_LEVEL_0);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_H264_PROFILE,\n\t\tV4L2_MPEG_VIDEO_H264_PROFILE_MULTIVIEW_HIGH,\n\t\t~((1 << V4L2_MPEG_VIDEO_H264_PROFILE_BASELINE) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_CONSTRAINED_BASELINE) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_MAIN) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_HIGH) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_STEREO_HIGH) |\n\t\t  (1 << V4L2_MPEG_VIDEO_H264_PROFILE_MULTIVIEW_HIGH)),\n\t\tV4L2_MPEG_VIDEO_H264_PROFILE_BASELINE);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t\t      V4L2_CID_MPEG_VIDEO_H264_LEVEL,\n\t\t\t\t      V4L2_MPEG_VIDEO_H264_LEVEL_5_1,\n\t\t\t\t      0, V4L2_MPEG_VIDEO_H264_LEVEL_1_0);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t\t      V4L2_CID_MPEG_VIDEO_VP8_PROFILE,\n\t\t\t\t      V4L2_MPEG_VIDEO_VP8_PROFILE_3,\n\t\t\t\t      0, V4L2_MPEG_VIDEO_VP8_PROFILE_0);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t\t      V4L2_CID_MPEG_VIDEO_VP9_PROFILE,\n\t\t\t\t      V4L2_MPEG_VIDEO_VP9_PROFILE_3,\n\t\t\t\t      0, V4L2_MPEG_VIDEO_VP9_PROFILE_0);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tctrl = v4l2_ctrl_new_std_menu(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t\t      V4L2_CID_MPEG_VIDEO_VP9_LEVEL,\n\t\t\t\t      V4L2_MPEG_VIDEO_VP9_LEVEL_6_2,\n\t\t\t\t      0, V4L2_MPEG_VIDEO_VP9_LEVEL_1_0);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\tV4L2_CID_MPEG_VIDEO_DECODER_MPEG4_DEBLOCK_FILTER, 0, 1, 1, 0);\n\n\tctrl = v4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\tV4L2_CID_MIN_BUFFERS_FOR_CAPTURE, 1, 32, 1, 1);\n\tif (ctrl)\n\t\tctrl->flags |= V4L2_CTRL_FLAG_VOLATILE;\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_DEC_DISPLAY_DELAY,\n\t\t\t  0, 16383, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_DEC_DISPLAY_DELAY_ENABLE,\n\t\t\t  0, 1, 1, 0);\n\n\tv4l2_ctrl_new_std(&inst->ctrl_handler, &vdec_ctrl_ops,\n\t\t\t  V4L2_CID_MPEG_VIDEO_DEC_CONCEAL_COLOR, 0,\n\t\t\t  0xffffffffffffLL, 1, 0x8000800010LL);\n\n\tret = inst->ctrl_handler.error;\n\tif (ret) {\n\t\tv4l2_ctrl_handler_free(&inst->ctrl_handler);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nvoid vdec_ctrl_deinit(struct venus_inst *inst)\n{\n\tv4l2_ctrl_handler_free(&inst->ctrl_handler);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}