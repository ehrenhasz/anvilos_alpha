{
  "module_name": "camif-regs.c",
  "hash_id": "24a454e18dd903d71c0a887f3886246e5c821de3fda878654273f6ad697c3c6f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/samsung/s3c-camif/camif-regs.c",
  "human_readable_source": "\n \n#define pr_fmt(fmt) \"%s:%d \" fmt, __func__, __LINE__\n\n#include <linux/delay.h>\n#include \"camif-regs.h\"\n\n#define camif_write(_camif, _off, _val)\twritel(_val, (_camif)->io_base + (_off))\n#define camif_read(_camif, _off)\treadl((_camif)->io_base + (_off))\n\nvoid camif_hw_reset(struct camif_dev *camif)\n{\n\tu32 cfg;\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CISRCFMT);\n\tcfg |= CISRCFMT_ITU601_8BIT;\n\tcamif_write(camif, S3C_CAMIF_REG_CISRCFMT, cfg);\n\n\t \n\tcfg = camif_read(camif, S3C_CAMIF_REG_CIGCTRL);\n\tcfg |= CIGCTRL_SWRST;\n\tif (camif->variant->ip_revision == S3C6410_CAMIF_IP_REV)\n\t\tcfg |= CIGCTRL_IRQ_LEVEL;\n\tcamif_write(camif, S3C_CAMIF_REG_CIGCTRL, cfg);\n\tudelay(10);\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CIGCTRL);\n\tcfg &= ~CIGCTRL_SWRST;\n\tcamif_write(camif, S3C_CAMIF_REG_CIGCTRL, cfg);\n\tudelay(10);\n}\n\nvoid camif_hw_clear_pending_irq(struct camif_vp *vp)\n{\n\tu32 cfg = camif_read(vp->camif, S3C_CAMIF_REG_CIGCTRL);\n\tcfg |= CIGCTRL_IRQ_CLR(vp->id);\n\tcamif_write(vp->camif, S3C_CAMIF_REG_CIGCTRL, cfg);\n}\n\n \nvoid camif_hw_set_test_pattern(struct camif_dev *camif, unsigned int pattern)\n{\n\tu32 cfg = camif_read(camif, S3C_CAMIF_REG_CIGCTRL);\n\tcfg &= ~CIGCTRL_TESTPATTERN_MASK;\n\tcfg |= (pattern << 27);\n\tcamif_write(camif, S3C_CAMIF_REG_CIGCTRL, cfg);\n}\n\nvoid camif_hw_set_effect(struct camif_dev *camif, unsigned int effect,\n\t\t\tunsigned int cr, unsigned int cb)\n{\n\tstatic const struct v4l2_control colorfx[] = {\n\t\t{ V4L2_COLORFX_NONE,\t\tCIIMGEFF_FIN_BYPASS },\n\t\t{ V4L2_COLORFX_BW,\t\tCIIMGEFF_FIN_ARBITRARY },\n\t\t{ V4L2_COLORFX_SEPIA,\t\tCIIMGEFF_FIN_ARBITRARY },\n\t\t{ V4L2_COLORFX_NEGATIVE,\tCIIMGEFF_FIN_NEGATIVE },\n\t\t{ V4L2_COLORFX_ART_FREEZE,\tCIIMGEFF_FIN_ARTFREEZE },\n\t\t{ V4L2_COLORFX_EMBOSS,\t\tCIIMGEFF_FIN_EMBOSSING },\n\t\t{ V4L2_COLORFX_SILHOUETTE,\tCIIMGEFF_FIN_SILHOUETTE },\n\t\t{ V4L2_COLORFX_SET_CBCR,\tCIIMGEFF_FIN_ARBITRARY },\n\t};\n\tunsigned int i, cfg;\n\n\tfor (i = 0; i < ARRAY_SIZE(colorfx); i++)\n\t\tif (colorfx[i].id == effect)\n\t\t\tbreak;\n\n\tif (i == ARRAY_SIZE(colorfx))\n\t\treturn;\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CIIMGEFF(camif->vp->offset));\n\t \n\tcfg &= ~CIIMGEFF_FIN_MASK;\n\tcfg |= colorfx[i].value;\n\t \n\tif (camif->variant->ip_revision >= S3C6400_CAMIF_IP_REV) {\n\t\tif (effect == V4L2_COLORFX_NONE)\n\t\t\tcfg &= ~CIIMGEFF_IE_ENABLE_MASK;\n\t\telse\n\t\t\tcfg |= CIIMGEFF_IE_ENABLE_MASK;\n\t}\n\tcfg &= ~CIIMGEFF_PAT_CBCR_MASK;\n\tcfg |= cr | (cb << 13);\n\tcamif_write(camif, S3C_CAMIF_REG_CIIMGEFF(camif->vp->offset), cfg);\n}\n\nstatic const u32 src_pixfmt_map[8][2] = {\n\t{ MEDIA_BUS_FMT_YUYV8_2X8, CISRCFMT_ORDER422_YCBYCR },\n\t{ MEDIA_BUS_FMT_YVYU8_2X8, CISRCFMT_ORDER422_YCRYCB },\n\t{ MEDIA_BUS_FMT_UYVY8_2X8, CISRCFMT_ORDER422_CBYCRY },\n\t{ MEDIA_BUS_FMT_VYUY8_2X8, CISRCFMT_ORDER422_CRYCBY },\n};\n\n \nvoid camif_hw_set_source_format(struct camif_dev *camif)\n{\n\tstruct v4l2_mbus_framefmt *mf = &camif->mbus_fmt;\n\tint i;\n\tu32 cfg;\n\n\tfor (i = ARRAY_SIZE(src_pixfmt_map) - 1; i >= 0; i--) {\n\t\tif (src_pixfmt_map[i][0] == mf->code)\n\t\t\tbreak;\n\t}\n\tif (i < 0) {\n\t\ti = 0;\n\t\tdev_err(camif->dev,\n\t\t\t\"Unsupported pixel code, falling back to %#08x\\n\",\n\t\t\tsrc_pixfmt_map[i][0]);\n\t}\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CISRCFMT);\n\tcfg &= ~(CISRCFMT_ORDER422_MASK | CISRCFMT_SIZE_CAM_MASK);\n\tcfg |= (mf->width << 16) | mf->height;\n\tcfg |= src_pixfmt_map[i][1];\n\tcamif_write(camif, S3C_CAMIF_REG_CISRCFMT, cfg);\n}\n\n \nvoid camif_hw_set_camera_crop(struct camif_dev *camif)\n{\n\tstruct v4l2_mbus_framefmt *mf = &camif->mbus_fmt;\n\tstruct v4l2_rect *crop = &camif->camif_crop;\n\tu32 hoff2, voff2;\n\tu32 cfg;\n\n\t \n\tcfg = camif_read(camif, S3C_CAMIF_REG_CIWDOFST);\n\tcfg &= ~(CIWDOFST_OFST_MASK | CIWDOFST_WINOFSEN);\n\tcfg |= (crop->left << 16) | crop->top;\n\tif (crop->left != 0 || crop->top != 0)\n\t\tcfg |= CIWDOFST_WINOFSEN;\n\tcamif_write(camif, S3C_CAMIF_REG_CIWDOFST, cfg);\n\n\tif (camif->variant->ip_revision == S3C6410_CAMIF_IP_REV) {\n\t\thoff2 = mf->width - crop->width - crop->left;\n\t\tvoff2 = mf->height - crop->height - crop->top;\n\t\tcfg = (hoff2 << 16) | voff2;\n\t\tcamif_write(camif, S3C_CAMIF_REG_CIWDOFST2, cfg);\n\t}\n}\n\nvoid camif_hw_clear_fifo_overflow(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tu32 cfg;\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CIWDOFST);\n\tif (vp->id == 0)\n\t\tcfg |= (CIWDOFST_CLROVCOFIY | CIWDOFST_CLROVCOFICB |\n\t\t\tCIWDOFST_CLROVCOFICR);\n\telse\n\t\tcfg |= (  CIWDOFST_CLROVPRFICB |\n\t\t\tCIWDOFST_CLROVPRFICR);\n\tcamif_write(camif, S3C_CAMIF_REG_CIWDOFST, cfg);\n}\n\n \nvoid camif_hw_set_camera_bus(struct camif_dev *camif)\n{\n\tunsigned int flags = camif->pdata.sensor.flags;\n\n\tu32 cfg = camif_read(camif, S3C_CAMIF_REG_CIGCTRL);\n\n\tcfg &= ~(CIGCTRL_INVPOLPCLK | CIGCTRL_INVPOLVSYNC |\n\t\t CIGCTRL_INVPOLHREF | CIGCTRL_INVPOLFIELD);\n\n\tif (flags & V4L2_MBUS_PCLK_SAMPLE_FALLING)\n\t\tcfg |= CIGCTRL_INVPOLPCLK;\n\n\tif (flags & V4L2_MBUS_VSYNC_ACTIVE_LOW)\n\t\tcfg |= CIGCTRL_INVPOLVSYNC;\n\t \n\tif (flags & V4L2_MBUS_HSYNC_ACTIVE_HIGH)\n\t\tcfg |= CIGCTRL_INVPOLHREF;  \n\n\tif (camif->variant->ip_revision == S3C6410_CAMIF_IP_REV) {\n\t\tif (flags & V4L2_MBUS_FIELD_EVEN_LOW)\n\t\t\tcfg |= CIGCTRL_INVPOLFIELD;\n\t\tcfg |= CIGCTRL_FIELDMODE;\n\t}\n\n\tpr_debug(\"Setting CIGCTRL to: %#x\\n\", cfg);\n\n\tcamif_write(camif, S3C_CAMIF_REG_CIGCTRL, cfg);\n}\n\nvoid camif_hw_set_output_addr(struct camif_vp *vp,\n\t\t\t      struct camif_addr *paddr, int i)\n{\n\tstruct camif_dev *camif = vp->camif;\n\n\tcamif_write(camif, S3C_CAMIF_REG_CIYSA(vp->id, i), paddr->y);\n\tif (camif->variant->ip_revision == S3C6410_CAMIF_IP_REV\n\t\t|| vp->id == VP_CODEC) {\n\t\tcamif_write(camif, S3C_CAMIF_REG_CICBSA(vp->id, i),\n\t\t\t\t\t\t\t\tpaddr->cb);\n\t\tcamif_write(camif, S3C_CAMIF_REG_CICRSA(vp->id, i),\n\t\t\t\t\t\t\t\tpaddr->cr);\n\t}\n\n\tpr_debug(\"dst_buf[%d]: %pad, cb: %pad, cr: %pad\\n\",\n\t\t i, &paddr->y, &paddr->cb, &paddr->cr);\n}\n\nstatic void camif_hw_set_out_dma_size(struct camif_vp *vp)\n{\n\tstruct camif_frame *frame = &vp->out_frame;\n\tu32 cfg;\n\n\tcfg = camif_read(vp->camif, S3C_CAMIF_REG_CITRGFMT(vp->id, vp->offset));\n\tcfg &= ~CITRGFMT_TARGETSIZE_MASK;\n\tcfg |= (frame->f_width << 16) | frame->f_height;\n\tcamif_write(vp->camif, S3C_CAMIF_REG_CITRGFMT(vp->id, vp->offset), cfg);\n}\n\nstatic void camif_get_dma_burst(u32 width, u32 ybpp, u32 *mburst, u32 *rburst)\n{\n\tunsigned int nwords = width * ybpp / 4;\n\tunsigned int div, rem;\n\n\tif (WARN_ON(width < 8 || (width * ybpp) & 7))\n\t\treturn;\n\n\tfor (div = 16; div >= 2; div /= 2) {\n\t\tif (nwords < div)\n\t\t\tcontinue;\n\n\t\trem = nwords & (div - 1);\n\t\tif (rem == 0) {\n\t\t\t*mburst = div;\n\t\t\t*rburst = div;\n\t\t\tbreak;\n\t\t}\n\t\tif (rem == div / 2 || rem == div / 4) {\n\t\t\t*mburst = div;\n\t\t\t*rburst = rem;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nvoid camif_hw_set_output_dma(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tstruct camif_frame *frame = &vp->out_frame;\n\tconst struct camif_fmt *fmt = vp->out_fmt;\n\tunsigned int ymburst = 0, yrburst = 0;\n\tu32 cfg;\n\n\tcamif_hw_set_out_dma_size(vp);\n\n\tif (camif->variant->ip_revision == S3C6410_CAMIF_IP_REV) {\n\t\tstruct camif_dma_offset *offset = &frame->dma_offset;\n\t\t \n\t\tcfg = S3C_CISS_OFFS_INITIAL(offset->initial);\n\t\tcfg |= S3C_CISS_OFFS_LINE(offset->line);\n\t\tcamif_write(camif, S3C_CAMIF_REG_CISSY(vp->id), cfg);\n\t\tcamif_write(camif, S3C_CAMIF_REG_CISSCB(vp->id), cfg);\n\t\tcamif_write(camif, S3C_CAMIF_REG_CISSCR(vp->id), cfg);\n\t}\n\n\t \n\tcamif_get_dma_burst(frame->rect.width, fmt->ybpp, &ymburst, &yrburst);\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CICTRL(vp->id, vp->offset));\n\tcfg &= ~CICTRL_BURST_MASK;\n\n\tcfg |= CICTRL_YBURST1(ymburst) | CICTRL_YBURST2(yrburst);\n\tcfg |= CICTRL_CBURST1(ymburst / 2) | CICTRL_CBURST2(yrburst / 2);\n\n\tcamif_write(camif, S3C_CAMIF_REG_CICTRL(vp->id, vp->offset), cfg);\n\n\tpr_debug(\"ymburst: %u, yrburst: %u\\n\", ymburst, yrburst);\n}\n\nvoid camif_hw_set_input_path(struct camif_vp *vp)\n{\n\tu32 cfg = camif_read(vp->camif, S3C_CAMIF_REG_MSCTRL(vp->id));\n\tcfg &= ~MSCTRL_SEL_DMA_CAM;\n\tcamif_write(vp->camif, S3C_CAMIF_REG_MSCTRL(vp->id), cfg);\n}\n\nvoid camif_hw_set_target_format(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tstruct camif_frame *frame = &vp->out_frame;\n\tu32 cfg;\n\n\tpr_debug(\"fw: %d, fh: %d color: %d\\n\", frame->f_width,\n\t\t frame->f_height, vp->out_fmt->color);\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CITRGFMT(vp->id, vp->offset));\n\tcfg &= ~CITRGFMT_TARGETSIZE_MASK;\n\n\tif (camif->variant->ip_revision == S3C244X_CAMIF_IP_REV) {\n\t\t \n\t\tcfg |= CITRGFMT_IN422;\n\t\tcfg &= ~CITRGFMT_OUT422;\n\t\tif (vp->out_fmt->color == IMG_FMT_YCBCR422P)\n\t\t\tcfg |= CITRGFMT_OUT422;\n\t} else {\n\t\tcfg &= ~CITRGFMT_OUTFORMAT_MASK;\n\t\tswitch (vp->out_fmt->color) {\n\t\tcase IMG_FMT_RGB565...IMG_FMT_XRGB8888:\n\t\t\tcfg |= CITRGFMT_OUTFORMAT_RGB;\n\t\t\tbreak;\n\t\tcase IMG_FMT_YCBCR420...IMG_FMT_YCRCB420:\n\t\t\tcfg |= CITRGFMT_OUTFORMAT_YCBCR420;\n\t\t\tbreak;\n\t\tcase IMG_FMT_YCBCR422P:\n\t\t\tcfg |= CITRGFMT_OUTFORMAT_YCBCR422;\n\t\t\tbreak;\n\t\tcase IMG_FMT_YCBYCR422...IMG_FMT_CRYCBY422:\n\t\t\tcfg |= CITRGFMT_OUTFORMAT_YCBCR422I;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\tif (vp->rotation == 90 || vp->rotation == 270)\n\t\tcfg |= (frame->f_height << 16) | frame->f_width;\n\telse\n\t\tcfg |= (frame->f_width << 16) | frame->f_height;\n\tcamif_write(camif, S3C_CAMIF_REG_CITRGFMT(vp->id, vp->offset), cfg);\n\n\t \n\tcfg = camif_read(camif, S3C_CAMIF_REG_CITAREA(vp->id, vp->offset));\n\tcfg &= ~CITAREA_MASK;\n\tcfg |= (frame->f_width * frame->f_height);\n\tcamif_write(camif, S3C_CAMIF_REG_CITAREA(vp->id, vp->offset), cfg);\n}\n\nvoid camif_hw_set_flip(struct camif_vp *vp)\n{\n\tu32 cfg = camif_read(vp->camif,\n\t\t\t\tS3C_CAMIF_REG_CITRGFMT(vp->id, vp->offset));\n\n\tcfg &= ~CITRGFMT_FLIP_MASK;\n\n\tif (vp->hflip)\n\t\tcfg |= CITRGFMT_FLIP_Y_MIRROR;\n\tif (vp->vflip)\n\t\tcfg |= CITRGFMT_FLIP_X_MIRROR;\n\n\tcamif_write(vp->camif, S3C_CAMIF_REG_CITRGFMT(vp->id, vp->offset), cfg);\n}\n\nstatic void camif_hw_set_prescaler(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tstruct camif_scaler *sc = &vp->scaler;\n\tu32 cfg, shfactor, addr;\n\n\taddr = S3C_CAMIF_REG_CISCPRERATIO(vp->id, vp->offset);\n\n\tshfactor = 10 - (sc->h_shift + sc->v_shift);\n\tcfg = shfactor << 28;\n\n\tcfg |= (sc->pre_h_ratio << 16) | sc->pre_v_ratio;\n\tcamif_write(camif, addr, cfg);\n\n\tcfg = (sc->pre_dst_width << 16) | sc->pre_dst_height;\n\tcamif_write(camif, S3C_CAMIF_REG_CISCPREDST(vp->id, vp->offset), cfg);\n}\n\nstatic void camif_s3c244x_hw_set_scaler(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tstruct camif_scaler *scaler = &vp->scaler;\n\tunsigned int color = vp->out_fmt->color;\n\tu32 cfg;\n\n\tcamif_hw_set_prescaler(vp);\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CISCCTRL(vp->id, vp->offset));\n\n\tcfg &= ~(CISCCTRL_SCALEUP_MASK | CISCCTRL_SCALERBYPASS |\n\t\t CISCCTRL_MAIN_RATIO_MASK | CIPRSCCTRL_RGB_FORMAT_24BIT);\n\n\tif (scaler->enable) {\n\t\tif (scaler->scaleup_h) {\n\t\t\tif (vp->id == VP_CODEC)\n\t\t\t\tcfg |= CISCCTRL_SCALEUP_H;\n\t\t\telse\n\t\t\t\tcfg |= CIPRSCCTRL_SCALEUP_H;\n\t\t}\n\t\tif (scaler->scaleup_v) {\n\t\t\tif (vp->id == VP_CODEC)\n\t\t\t\tcfg |= CISCCTRL_SCALEUP_V;\n\t\t\telse\n\t\t\t\tcfg |= CIPRSCCTRL_SCALEUP_V;\n\t\t}\n\t} else {\n\t\tif (vp->id == VP_CODEC)\n\t\t\tcfg |= CISCCTRL_SCALERBYPASS;\n\t}\n\n\tcfg |= ((scaler->main_h_ratio & 0x1ff) << 16);\n\tcfg |= scaler->main_v_ratio & 0x1ff;\n\n\tif (vp->id == VP_PREVIEW) {\n\t\tif (color == IMG_FMT_XRGB8888)\n\t\t\tcfg |= CIPRSCCTRL_RGB_FORMAT_24BIT;\n\t\tcfg |= CIPRSCCTRL_SAMPLE;\n\t}\n\n\tcamif_write(camif, S3C_CAMIF_REG_CISCCTRL(vp->id, vp->offset), cfg);\n\n\tpr_debug(\"main: h_ratio: %#x, v_ratio: %#x\",\n\t\t scaler->main_h_ratio, scaler->main_v_ratio);\n}\n\nstatic void camif_s3c64xx_hw_set_scaler(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tstruct camif_scaler *scaler = &vp->scaler;\n\tunsigned int color = vp->out_fmt->color;\n\tu32 cfg;\n\n\tcamif_hw_set_prescaler(vp);\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CISCCTRL(vp->id, vp->offset));\n\n\tcfg &= ~(CISCCTRL_CSCR2Y_WIDE | CISCCTRL_CSCY2R_WIDE\n\t\t| CISCCTRL_SCALEUP_H | CISCCTRL_SCALEUP_V\n\t\t| CISCCTRL_SCALERBYPASS | CISCCTRL_ONE2ONE\n\t\t| CISCCTRL_INRGB_FMT_MASK | CISCCTRL_OUTRGB_FMT_MASK\n\t\t| CISCCTRL_INTERLACE | CISCCTRL_EXTRGB_EXTENSION\n\t\t| CISCCTRL_MAIN_RATIO_MASK);\n\n\tcfg |= (CISCCTRL_CSCR2Y_WIDE | CISCCTRL_CSCY2R_WIDE);\n\n\tif (!scaler->enable) {\n\t\tcfg |= CISCCTRL_SCALERBYPASS;\n\t} else {\n\t\tif (scaler->scaleup_h)\n\t\t\tcfg |= CISCCTRL_SCALEUP_H;\n\t\tif (scaler->scaleup_v)\n\t\t\tcfg |= CISCCTRL_SCALEUP_V;\n\t\tif (scaler->copy)\n\t\t\tcfg |= CISCCTRL_ONE2ONE;\n\t}\n\n\tswitch (color) {\n\tcase IMG_FMT_RGB666:\n\t\tcfg |= CISCCTRL_OUTRGB_FMT_RGB666;\n\t\tbreak;\n\tcase IMG_FMT_XRGB8888:\n\t\tcfg |= CISCCTRL_OUTRGB_FMT_RGB888;\n\t\tbreak;\n\t}\n\n\tcfg |= (scaler->main_h_ratio & 0x1ff) << 16;\n\tcfg |= scaler->main_v_ratio & 0x1ff;\n\n\tcamif_write(camif, S3C_CAMIF_REG_CISCCTRL(vp->id, vp->offset), cfg);\n\n\tpr_debug(\"main: h_ratio: %#x, v_ratio: %#x\",\n\t\t scaler->main_h_ratio, scaler->main_v_ratio);\n}\n\nvoid camif_hw_set_scaler(struct camif_vp *vp)\n{\n\tunsigned int ip_rev = vp->camif->variant->ip_revision;\n\n\tif (ip_rev == S3C244X_CAMIF_IP_REV)\n\t\tcamif_s3c244x_hw_set_scaler(vp);\n\telse\n\t\tcamif_s3c64xx_hw_set_scaler(vp);\n}\n\nvoid camif_hw_enable_scaler(struct camif_vp *vp, bool on)\n{\n\tu32 addr = S3C_CAMIF_REG_CISCCTRL(vp->id, vp->offset);\n\tu32 cfg;\n\n\tcfg = camif_read(vp->camif, addr);\n\tif (on)\n\t\tcfg |= CISCCTRL_SCALERSTART;\n\telse\n\t\tcfg &= ~CISCCTRL_SCALERSTART;\n\tcamif_write(vp->camif, addr, cfg);\n}\n\nvoid camif_hw_set_lastirq(struct camif_vp *vp, int enable)\n{\n\tu32 addr = S3C_CAMIF_REG_CICTRL(vp->id, vp->offset);\n\tu32 cfg;\n\n\tcfg = camif_read(vp->camif, addr);\n\tif (enable)\n\t\tcfg |= CICTRL_LASTIRQ_ENABLE;\n\telse\n\t\tcfg &= ~CICTRL_LASTIRQ_ENABLE;\n\tcamif_write(vp->camif, addr, cfg);\n}\n\nvoid camif_hw_enable_capture(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tu32 cfg;\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CIIMGCPT(vp->offset));\n\tcamif->stream_count++;\n\n\tif (camif->variant->ip_revision == S3C6410_CAMIF_IP_REV)\n\t\tcfg |= CIIMGCPT_CPT_FREN_ENABLE(vp->id);\n\n\tif (vp->scaler.enable)\n\t\tcfg |= CIIMGCPT_IMGCPTEN_SC(vp->id);\n\n\tif (camif->stream_count == 1)\n\t\tcfg |= CIIMGCPT_IMGCPTEN;\n\n\tcamif_write(camif, S3C_CAMIF_REG_CIIMGCPT(vp->offset), cfg);\n\n\tpr_debug(\"CIIMGCPT: %#x, camif->stream_count: %d\\n\",\n\t\t cfg, camif->stream_count);\n}\n\nvoid camif_hw_disable_capture(struct camif_vp *vp)\n{\n\tstruct camif_dev *camif = vp->camif;\n\tu32 cfg;\n\n\tcfg = camif_read(camif, S3C_CAMIF_REG_CIIMGCPT(vp->offset));\n\tcfg &= ~CIIMGCPT_IMGCPTEN_SC(vp->id);\n\n\tif (WARN_ON(--(camif->stream_count) < 0))\n\t\tcamif->stream_count = 0;\n\n\tif (camif->stream_count == 0)\n\t\tcfg &= ~CIIMGCPT_IMGCPTEN;\n\n\tpr_debug(\"CIIMGCPT: %#x, camif->stream_count: %d\\n\",\n\t\t cfg, camif->stream_count);\n\n\tcamif_write(camif, S3C_CAMIF_REG_CIIMGCPT(vp->offset), cfg);\n}\n\nvoid camif_hw_dump_regs(struct camif_dev *camif, const char *label)\n{\n\tstatic const struct {\n\t\tu32 offset;\n\t\tconst char * const name;\n\t} registers[] = {\n\t\t{ S3C_CAMIF_REG_CISRCFMT,\t\t\"CISRCFMT\" },\n\t\t{ S3C_CAMIF_REG_CIWDOFST,\t\t\"CIWDOFST\" },\n\t\t{ S3C_CAMIF_REG_CIGCTRL,\t\t\"CIGCTRL\" },\n\t\t{ S3C_CAMIF_REG_CIWDOFST2,\t\t\"CIWDOFST2\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(0, 0),\t\t\"CICOYSA0\" },\n\t\t{ S3C_CAMIF_REG_CICBSA(0, 0),\t\t\"CICOCBSA0\" },\n\t\t{ S3C_CAMIF_REG_CICRSA(0, 0),\t\t\"CICOCRSA0\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(0, 1),\t\t\"CICOYSA1\" },\n\t\t{ S3C_CAMIF_REG_CICBSA(0, 1),\t\t\"CICOCBSA1\" },\n\t\t{ S3C_CAMIF_REG_CICRSA(0, 1),\t\t\"CICOCRSA1\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(0, 2),\t\t\"CICOYSA2\" },\n\t\t{ S3C_CAMIF_REG_CICBSA(0, 2),\t\t\"CICOCBSA2\" },\n\t\t{ S3C_CAMIF_REG_CICRSA(0, 2),\t\t\"CICOCRSA2\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(0, 3),\t\t\"CICOYSA3\" },\n\t\t{ S3C_CAMIF_REG_CICBSA(0, 3),\t\t\"CICOCBSA3\" },\n\t\t{ S3C_CAMIF_REG_CICRSA(0, 3),\t\t\"CICOCRSA3\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(1, 0),\t\t\"CIPRYSA0\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(1, 1),\t\t\"CIPRYSA1\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(1, 2),\t\t\"CIPRYSA2\" },\n\t\t{ S3C_CAMIF_REG_CIYSA(1, 3),\t\t\"CIPRYSA3\" },\n\t\t{ S3C_CAMIF_REG_CITRGFMT(0, 0),\t\t\"CICOTRGFMT\" },\n\t\t{ S3C_CAMIF_REG_CITRGFMT(1, 0),\t\t\"CIPRTRGFMT\" },\n\t\t{ S3C_CAMIF_REG_CICTRL(0, 0),\t\t\"CICOCTRL\" },\n\t\t{ S3C_CAMIF_REG_CICTRL(1, 0),\t\t\"CIPRCTRL\" },\n\t\t{ S3C_CAMIF_REG_CISCPREDST(0, 0),\t\"CICOSCPREDST\" },\n\t\t{ S3C_CAMIF_REG_CISCPREDST(1, 0),\t\"CIPRSCPREDST\" },\n\t\t{ S3C_CAMIF_REG_CISCPRERATIO(0, 0),\t\"CICOSCPRERATIO\" },\n\t\t{ S3C_CAMIF_REG_CISCPRERATIO(1, 0),\t\"CIPRSCPRERATIO\" },\n\t\t{ S3C_CAMIF_REG_CISCCTRL(0, 0),\t\t\"CICOSCCTRL\" },\n\t\t{ S3C_CAMIF_REG_CISCCTRL(1, 0),\t\t\"CIPRSCCTRL\" },\n\t\t{ S3C_CAMIF_REG_CITAREA(0, 0),\t\t\"CICOTAREA\" },\n\t\t{ S3C_CAMIF_REG_CITAREA(1, 0),\t\t\"CIPRTAREA\" },\n\t\t{ S3C_CAMIF_REG_CISTATUS(0, 0),\t\t\"CICOSTATUS\" },\n\t\t{ S3C_CAMIF_REG_CISTATUS(1, 0),\t\t\"CIPRSTATUS\" },\n\t\t{ S3C_CAMIF_REG_CIIMGCPT(0),\t\t\"CIIMGCPT\" },\n\t};\n\tu32 i;\n\n\tpr_info(\"--- %s ---\\n\", label);\n\tfor (i = 0; i < ARRAY_SIZE(registers); i++) {\n\t\tu32 cfg = readl(camif->io_base + registers[i].offset);\n\t\tdev_info(camif->dev, \"%s:\\t0x%08x\\n\", registers[i].name, cfg);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}