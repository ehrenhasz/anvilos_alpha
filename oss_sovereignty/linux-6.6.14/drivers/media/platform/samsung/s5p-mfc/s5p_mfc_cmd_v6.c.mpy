{
  "module_name": "s5p_mfc_cmd_v6.c",
  "hash_id": "70b50540d716c2477739b152705d0d5859253e292d201a31551d35597ee238ec",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/samsung/s5p-mfc/s5p_mfc_cmd_v6.c",
  "human_readable_source": "\n \n\n#include \"s5p_mfc_common.h\"\n\n#include \"s5p_mfc_cmd.h\"\n#include \"s5p_mfc_debug.h\"\n#include \"s5p_mfc_intr.h\"\n#include \"s5p_mfc_opr.h\"\n#include \"s5p_mfc_cmd_v6.h\"\n\nstatic int s5p_mfc_cmd_host2risc_v6(struct s5p_mfc_dev *dev, int cmd,\n\t\t\t\tstruct s5p_mfc_cmd_args *args)\n{\n\tmfc_debug(2, \"Issue the command: %d\\n\", cmd);\n\n\t \n\tmfc_write(dev, 0x0, S5P_FIMV_RISC2HOST_CMD_V6);\n\n\t \n\tmfc_write(dev, cmd, S5P_FIMV_HOST2RISC_CMD_V6);\n\tmfc_write(dev, 0x1, S5P_FIMV_HOST2RISC_INT_V6);\n\n\treturn 0;\n}\n\nstatic int s5p_mfc_sys_init_cmd_v6(struct s5p_mfc_dev *dev)\n{\n\tstruct s5p_mfc_cmd_args h2r_args;\n\tstruct s5p_mfc_buf_size_v6 *buf_size = dev->variant->buf_size->priv;\n\tint ret;\n\n\tret = s5p_mfc_hw_call(dev->mfc_ops, alloc_dev_context_buffer, dev);\n\tif (ret)\n\t\treturn ret;\n\n\tmfc_write(dev, dev->ctx_buf.dma, S5P_FIMV_CONTEXT_MEM_ADDR_V6);\n\tmfc_write(dev, buf_size->dev_ctx, S5P_FIMV_CONTEXT_MEM_SIZE_V6);\n\treturn s5p_mfc_cmd_host2risc_v6(dev, S5P_FIMV_H2R_CMD_SYS_INIT_V6,\n\t\t\t\t\t&h2r_args);\n}\n\nstatic int s5p_mfc_sleep_cmd_v6(struct s5p_mfc_dev *dev)\n{\n\tstruct s5p_mfc_cmd_args h2r_args;\n\n\tmemset(&h2r_args, 0, sizeof(struct s5p_mfc_cmd_args));\n\treturn s5p_mfc_cmd_host2risc_v6(dev, S5P_FIMV_H2R_CMD_SLEEP_V6,\n\t\t\t&h2r_args);\n}\n\nstatic int s5p_mfc_wakeup_cmd_v6(struct s5p_mfc_dev *dev)\n{\n\tstruct s5p_mfc_cmd_args h2r_args;\n\n\tmemset(&h2r_args, 0, sizeof(struct s5p_mfc_cmd_args));\n\treturn s5p_mfc_cmd_host2risc_v6(dev, S5P_FIMV_H2R_CMD_WAKEUP_V6,\n\t\t\t\t\t&h2r_args);\n}\n\n \nstatic int s5p_mfc_open_inst_cmd_v6(struct s5p_mfc_ctx *ctx)\n{\n\tstruct s5p_mfc_dev *dev = ctx->dev;\n\tstruct s5p_mfc_cmd_args h2r_args;\n\tint codec_type;\n\n\tmfc_debug(2, \"Requested codec mode: %d\\n\", ctx->codec_mode);\n\tdev->curr_ctx = ctx->num;\n\tswitch (ctx->codec_mode) {\n\tcase S5P_MFC_CODEC_H264_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_H264_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_H264_MVC_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_H264_MVC_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_VC1_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_VC1_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_MPEG4_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_MPEG4_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_MPEG2_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_MPEG2_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_H263_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_H263_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_VC1RCV_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_VC1RCV_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_VP8_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_VP8_DEC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_HEVC_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_HEVC_DEC;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_VP9_DEC:\n\t\tcodec_type = S5P_FIMV_CODEC_VP9_DEC;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_H264_ENC:\n\t\tcodec_type = S5P_FIMV_CODEC_H264_ENC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_H264_MVC_ENC:\n\t\tcodec_type = S5P_FIMV_CODEC_H264_MVC_ENC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_MPEG4_ENC:\n\t\tcodec_type = S5P_FIMV_CODEC_MPEG4_ENC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_H263_ENC:\n\t\tcodec_type = S5P_FIMV_CODEC_H263_ENC_V6;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_VP8_ENC:\n\t\tcodec_type = S5P_FIMV_CODEC_VP8_ENC_V7;\n\t\tbreak;\n\tcase S5P_MFC_CODEC_HEVC_ENC:\n\t\tcodec_type = S5P_FIMV_CODEC_HEVC_ENC;\n\t\tbreak;\n\tdefault:\n\t\tcodec_type = S5P_FIMV_CODEC_NONE_V6;\n\t}\n\tmfc_write(dev, codec_type, S5P_FIMV_CODEC_TYPE_V6);\n\tmfc_write(dev, ctx->ctx.dma, S5P_FIMV_CONTEXT_MEM_ADDR_V6);\n\tmfc_write(dev, ctx->ctx.size, S5P_FIMV_CONTEXT_MEM_SIZE_V6);\n\tmfc_write(dev, 0, S5P_FIMV_D_CRC_CTRL_V6);  \n\n\treturn s5p_mfc_cmd_host2risc_v6(dev, S5P_FIMV_H2R_CMD_OPEN_INSTANCE_V6,\n\t\t\t\t\t&h2r_args);\n}\n\n \nstatic int s5p_mfc_close_inst_cmd_v6(struct s5p_mfc_ctx *ctx)\n{\n\tstruct s5p_mfc_dev *dev = ctx->dev;\n\tstruct s5p_mfc_cmd_args h2r_args;\n\tint ret = 0;\n\n\tdev->curr_ctx = ctx->num;\n\tif (ctx->state != MFCINST_FREE) {\n\t\tmfc_write(dev, ctx->inst_no, S5P_FIMV_INSTANCE_ID_V6);\n\t\tret = s5p_mfc_cmd_host2risc_v6(dev,\n\t\t\t\t\tS5P_FIMV_H2R_CMD_CLOSE_INSTANCE_V6,\n\t\t\t\t\t&h2r_args);\n\t} else {\n\t\tret = -EINVAL;\n\t}\n\n\treturn ret;\n}\n\n \nstatic struct s5p_mfc_hw_cmds s5p_mfc_cmds_v6 = {\n\t.cmd_host2risc = s5p_mfc_cmd_host2risc_v6,\n\t.sys_init_cmd = s5p_mfc_sys_init_cmd_v6,\n\t.sleep_cmd = s5p_mfc_sleep_cmd_v6,\n\t.wakeup_cmd = s5p_mfc_wakeup_cmd_v6,\n\t.open_inst_cmd = s5p_mfc_open_inst_cmd_v6,\n\t.close_inst_cmd = s5p_mfc_close_inst_cmd_v6,\n};\n\nstruct s5p_mfc_hw_cmds *s5p_mfc_init_hw_cmds_v6(void)\n{\n\treturn &s5p_mfc_cmds_v6;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}