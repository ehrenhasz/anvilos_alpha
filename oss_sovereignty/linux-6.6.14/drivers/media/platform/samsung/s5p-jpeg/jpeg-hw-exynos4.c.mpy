{
  "module_name": "jpeg-hw-exynos4.c",
  "hash_id": "a1ed07899eae2485b25b75fdf86544e5bcb0710558b39c068ec0520d11d3744c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/samsung/s5p-jpeg/jpeg-hw-exynos4.c",
  "human_readable_source": "\n \n#include <linux/io.h>\n#include <linux/delay.h>\n\n#include \"jpeg-core.h\"\n#include \"jpeg-hw-exynos4.h\"\n#include \"jpeg-regs.h\"\n\nvoid exynos4_jpeg_sw_reset(void __iomem *base)\n{\n\tunsigned int reg;\n\n\treg = readl(base + EXYNOS4_JPEG_CNTL_REG);\n\twritel(reg & ~(EXYNOS4_DEC_MODE | EXYNOS4_ENC_MODE),\n\t\t\t\tbase + EXYNOS4_JPEG_CNTL_REG);\n\n\treg = readl(base + EXYNOS4_JPEG_CNTL_REG);\n\twritel(reg & ~EXYNOS4_SOFT_RESET_HI, base + EXYNOS4_JPEG_CNTL_REG);\n\n\tudelay(100);\n\n\twritel(reg | EXYNOS4_SOFT_RESET_HI, base + EXYNOS4_JPEG_CNTL_REG);\n}\n\nvoid exynos4_jpeg_set_enc_dec_mode(void __iomem *base, unsigned int mode)\n{\n\tunsigned int reg;\n\n\treg = readl(base + EXYNOS4_JPEG_CNTL_REG);\n\t \n\tif (mode == S5P_JPEG_DECODE) {\n\t\twritel((reg & EXYNOS4_ENC_DEC_MODE_MASK) |\n\t\t\t\t\tEXYNOS4_DEC_MODE,\n\t\t\tbase + EXYNOS4_JPEG_CNTL_REG);\n\t} else if (mode == S5P_JPEG_ENCODE) { \n\t\twritel((reg & EXYNOS4_ENC_DEC_MODE_MASK) |\n\t\t\t\t\tEXYNOS4_ENC_MODE,\n\t\t\tbase + EXYNOS4_JPEG_CNTL_REG);\n\t} else {  \n\t\twritel(reg & EXYNOS4_ENC_DEC_MODE_MASK,\n\t\t\tbase + EXYNOS4_JPEG_CNTL_REG);\n\t}\n}\n\nvoid __exynos4_jpeg_set_img_fmt(void __iomem *base, unsigned int img_fmt,\n\t\t\t\tunsigned int version)\n{\n\tunsigned int reg;\n\tunsigned int exynos4_swap_chroma_cbcr;\n\tunsigned int exynos4_swap_chroma_crcb;\n\n\tif (version == SJPEG_EXYNOS4) {\n\t\texynos4_swap_chroma_cbcr = EXYNOS4_SWAP_CHROMA_CBCR;\n\t\texynos4_swap_chroma_crcb = EXYNOS4_SWAP_CHROMA_CRCB;\n\t} else {\n\t\texynos4_swap_chroma_cbcr = EXYNOS5433_SWAP_CHROMA_CBCR;\n\t\texynos4_swap_chroma_crcb = EXYNOS5433_SWAP_CHROMA_CRCB;\n\t}\n\n\treg = readl(base + EXYNOS4_IMG_FMT_REG) &\n\t\t\tEXYNOS4_ENC_IN_FMT_MASK;  \n\n\tswitch (img_fmt) {\n\tcase V4L2_PIX_FMT_GREY:\n\t\treg = reg | EXYNOS4_ENC_GRAY_IMG | EXYNOS4_GRAY_IMG_IP;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_RGB32:\n\t\treg = reg | EXYNOS4_ENC_RGB_IMG |\n\t\t\t\tEXYNOS4_RGB_IP_RGB_32BIT_IMG;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_RGB565:\n\t\treg = reg | EXYNOS4_ENC_RGB_IMG |\n\t\t\t\tEXYNOS4_RGB_IP_RGB_16BIT_IMG;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_NV24:\n\t\treg = reg | EXYNOS4_ENC_YUV_444_IMG |\n\t\t\t\tEXYNOS4_YUV_444_IP_YUV_444_2P_IMG |\n\t\t\t\texynos4_swap_chroma_cbcr;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_NV42:\n\t\treg = reg | EXYNOS4_ENC_YUV_444_IMG |\n\t\t\t\tEXYNOS4_YUV_444_IP_YUV_444_2P_IMG |\n\t\t\t\texynos4_swap_chroma_crcb;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_YUYV:\n\t\treg = reg | EXYNOS4_DEC_YUV_422_IMG |\n\t\t\t\tEXYNOS4_YUV_422_IP_YUV_422_1P_IMG |\n\t\t\t\texynos4_swap_chroma_cbcr;\n\t\tbreak;\n\n\tcase V4L2_PIX_FMT_YVYU:\n\t\treg = reg | EXYNOS4_DEC_YUV_422_IMG |\n\t\t\t\tEXYNOS4_YUV_422_IP_YUV_422_1P_IMG |\n\t\t\t\texynos4_swap_chroma_crcb;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_NV16:\n\t\treg = reg | EXYNOS4_DEC_YUV_422_IMG |\n\t\t\t\tEXYNOS4_YUV_422_IP_YUV_422_2P_IMG |\n\t\t\t\texynos4_swap_chroma_cbcr;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_NV61:\n\t\treg = reg | EXYNOS4_DEC_YUV_422_IMG |\n\t\t\t\tEXYNOS4_YUV_422_IP_YUV_422_2P_IMG |\n\t\t\t\texynos4_swap_chroma_crcb;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_NV12:\n\t\treg = reg | EXYNOS4_DEC_YUV_420_IMG |\n\t\t\t\tEXYNOS4_YUV_420_IP_YUV_420_2P_IMG |\n\t\t\t\texynos4_swap_chroma_cbcr;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_NV21:\n\t\treg = reg | EXYNOS4_DEC_YUV_420_IMG |\n\t\t\t\tEXYNOS4_YUV_420_IP_YUV_420_2P_IMG |\n\t\t\t\texynos4_swap_chroma_crcb;\n\t\tbreak;\n\tcase V4L2_PIX_FMT_YUV420:\n\t\treg = reg | EXYNOS4_DEC_YUV_420_IMG |\n\t\t\t\tEXYNOS4_YUV_420_IP_YUV_420_3P_IMG |\n\t\t\t\texynos4_swap_chroma_cbcr;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\n\t}\n\n\twritel(reg, base + EXYNOS4_IMG_FMT_REG);\n}\n\nvoid __exynos4_jpeg_set_enc_out_fmt(void __iomem *base, unsigned int out_fmt,\n\t\t\t\t    unsigned int version)\n{\n\tunsigned int reg;\n\n\treg = readl(base + EXYNOS4_IMG_FMT_REG) &\n\t\t\t~(version == SJPEG_EXYNOS4 ? EXYNOS4_ENC_FMT_MASK :\n\t\t\t  EXYNOS5433_ENC_FMT_MASK);  \n\n\tswitch (out_fmt) {\n\tcase V4L2_JPEG_CHROMA_SUBSAMPLING_GRAY:\n\t\treg = reg | EXYNOS4_ENC_FMT_GRAY;\n\t\tbreak;\n\n\tcase V4L2_JPEG_CHROMA_SUBSAMPLING_444:\n\t\treg = reg | EXYNOS4_ENC_FMT_YUV_444;\n\t\tbreak;\n\n\tcase V4L2_JPEG_CHROMA_SUBSAMPLING_422:\n\t\treg = reg | EXYNOS4_ENC_FMT_YUV_422;\n\t\tbreak;\n\n\tcase V4L2_JPEG_CHROMA_SUBSAMPLING_420:\n\t\treg = reg | EXYNOS4_ENC_FMT_YUV_420;\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n\n\twritel(reg, base + EXYNOS4_IMG_FMT_REG);\n}\n\nvoid exynos4_jpeg_set_interrupt(void __iomem *base, unsigned int version)\n{\n\tunsigned int reg;\n\n\tif (version == SJPEG_EXYNOS4) {\n\t\treg = readl(base + EXYNOS4_INT_EN_REG) & ~EXYNOS4_INT_EN_MASK;\n\t\twritel(reg | EXYNOS4_INT_EN_ALL, base + EXYNOS4_INT_EN_REG);\n\t} else {\n\t\treg = readl(base + EXYNOS4_INT_EN_REG) &\n\t\t\t\t\t\t\t~EXYNOS5433_INT_EN_MASK;\n\t\twritel(reg | EXYNOS5433_INT_EN_ALL, base + EXYNOS4_INT_EN_REG);\n\t}\n}\n\nunsigned int exynos4_jpeg_get_int_status(void __iomem *base)\n{\n\treturn readl(base + EXYNOS4_INT_STATUS_REG);\n}\n\nunsigned int exynos4_jpeg_get_fifo_status(void __iomem *base)\n{\n\treturn readl(base + EXYNOS4_FIFO_STATUS_REG);\n}\n\nvoid exynos4_jpeg_set_huf_table_enable(void __iomem *base, int value)\n{\n\tunsigned int\treg;\n\n\treg = readl(base + EXYNOS4_JPEG_CNTL_REG) & ~EXYNOS4_HUF_TBL_EN;\n\n\tif (value == 1)\n\t\twritel(reg | EXYNOS4_HUF_TBL_EN,\n\t\t\t\t\tbase + EXYNOS4_JPEG_CNTL_REG);\n\telse\n\t\twritel(reg & ~EXYNOS4_HUF_TBL_EN,\n\t\t\t\t\tbase + EXYNOS4_JPEG_CNTL_REG);\n}\n\nvoid exynos4_jpeg_set_sys_int_enable(void __iomem *base, int value)\n{\n\tunsigned int\treg;\n\n\treg = readl(base + EXYNOS4_JPEG_CNTL_REG) & ~(EXYNOS4_SYS_INT_EN);\n\n\tif (value == 1)\n\t\twritel(reg | EXYNOS4_SYS_INT_EN, base + EXYNOS4_JPEG_CNTL_REG);\n\telse\n\t\twritel(reg & ~EXYNOS4_SYS_INT_EN, base + EXYNOS4_JPEG_CNTL_REG);\n}\n\nvoid exynos4_jpeg_set_stream_buf_address(void __iomem *base,\n\t\t\t\t\t unsigned int address)\n{\n\twritel(address, base + EXYNOS4_OUT_MEM_BASE_REG);\n}\n\nvoid exynos4_jpeg_set_stream_size(void __iomem *base,\n\t\tunsigned int x_value, unsigned int y_value)\n{\n\twritel(0x0, base + EXYNOS4_JPEG_IMG_SIZE_REG);  \n\twritel(EXYNOS4_X_SIZE(x_value) | EXYNOS4_Y_SIZE(y_value),\n\t\t\tbase + EXYNOS4_JPEG_IMG_SIZE_REG);\n}\n\nvoid exynos4_jpeg_set_frame_buf_address(void __iomem *base,\n\t\t\t\tstruct s5p_jpeg_addr *exynos4_jpeg_addr)\n{\n\twritel(exynos4_jpeg_addr->y, base + EXYNOS4_IMG_BA_PLANE_1_REG);\n\twritel(exynos4_jpeg_addr->cb, base + EXYNOS4_IMG_BA_PLANE_2_REG);\n\twritel(exynos4_jpeg_addr->cr, base + EXYNOS4_IMG_BA_PLANE_3_REG);\n}\n\nvoid exynos4_jpeg_set_encode_tbl_select(void __iomem *base,\n\t\tenum exynos4_jpeg_img_quality_level level)\n{\n\tunsigned int\treg;\n\n\treg = EXYNOS4_Q_TBL_COMP1_0 | EXYNOS4_Q_TBL_COMP2_1 |\n\t\tEXYNOS4_Q_TBL_COMP3_1 |\n\t\tEXYNOS4_HUFF_TBL_COMP1_AC_0_DC_1 |\n\t\tEXYNOS4_HUFF_TBL_COMP2_AC_0_DC_0 |\n\t\tEXYNOS4_HUFF_TBL_COMP3_AC_1_DC_1;\n\n\twritel(reg, base + EXYNOS4_TBL_SEL_REG);\n}\n\nvoid exynos4_jpeg_set_dec_components(void __iomem *base, int n)\n{\n\tunsigned int\treg;\n\n\treg = readl(base + EXYNOS4_TBL_SEL_REG);\n\n\treg |= EXYNOS4_NF(n);\n\twritel(reg, base + EXYNOS4_TBL_SEL_REG);\n}\n\nvoid exynos4_jpeg_select_dec_q_tbl(void __iomem *base, char c, char x)\n{\n\tunsigned int\treg;\n\n\treg = readl(base + EXYNOS4_TBL_SEL_REG);\n\n\treg |= EXYNOS4_Q_TBL_COMP(c, x);\n\twritel(reg, base + EXYNOS4_TBL_SEL_REG);\n}\n\nvoid exynos4_jpeg_select_dec_h_tbl(void __iomem *base, char c, char x)\n{\n\tunsigned int\treg;\n\n\treg = readl(base + EXYNOS4_TBL_SEL_REG);\n\n\treg |= EXYNOS4_HUFF_TBL_COMP(c, x);\n\twritel(reg, base + EXYNOS4_TBL_SEL_REG);\n}\n\nvoid exynos4_jpeg_set_encode_hoff_cnt(void __iomem *base, unsigned int fmt)\n{\n\tif (fmt == V4L2_PIX_FMT_GREY)\n\t\twritel(0xd2, base + EXYNOS4_HUFF_CNT_REG);\n\telse\n\t\twritel(0x1a2, base + EXYNOS4_HUFF_CNT_REG);\n}\n\nunsigned int exynos4_jpeg_get_stream_size(void __iomem *base)\n{\n\treturn readl(base + EXYNOS4_BITSTREAM_SIZE_REG);\n}\n\nvoid exynos4_jpeg_set_dec_bitstream_size(void __iomem *base, unsigned int size)\n{\n\twritel(size, base + EXYNOS4_BITSTREAM_SIZE_REG);\n}\n\nvoid exynos4_jpeg_get_frame_size(void __iomem *base,\n\t\t\tunsigned int *width, unsigned int *height)\n{\n\t*width = (readl(base + EXYNOS4_DECODE_XY_SIZE_REG) &\n\t\t\t\tEXYNOS4_DECODED_SIZE_MASK);\n\t*height = (readl(base + EXYNOS4_DECODE_XY_SIZE_REG) >> 16) &\n\t\t\t\tEXYNOS4_DECODED_SIZE_MASK;\n}\n\nunsigned int exynos4_jpeg_get_frame_fmt(void __iomem *base)\n{\n\treturn readl(base + EXYNOS4_DECODE_IMG_FMT_REG) &\n\t\t\t\tEXYNOS4_JPEG_DECODED_IMG_FMT_MASK;\n}\n\nvoid exynos4_jpeg_set_timer_count(void __iomem *base, unsigned int size)\n{\n\twritel(size, base + EXYNOS4_INT_TIMER_COUNT_REG);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}