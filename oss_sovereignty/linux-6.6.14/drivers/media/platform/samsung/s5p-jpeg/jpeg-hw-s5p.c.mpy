{
  "module_name": "jpeg-hw-s5p.c",
  "hash_id": "527b12d9c93e48ed92ee33f7a5a911896bb7d81ebe38d896a61a6f02f94516ad",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/platform/samsung/s5p-jpeg/jpeg-hw-s5p.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/videodev2.h>\n\n#include \"jpeg-core.h\"\n#include \"jpeg-regs.h\"\n#include \"jpeg-hw-s5p.h\"\n\nvoid s5p_jpeg_reset(void __iomem *regs)\n{\n\tunsigned long reg;\n\n\twritel(1, regs + S5P_JPG_SW_RESET);\n\treg = readl(regs + S5P_JPG_SW_RESET);\n\t \n\twhile (reg != 0) {\n\t\tcpu_relax();\n\t\treg = readl(regs + S5P_JPG_SW_RESET);\n\t}\n}\n\nvoid s5p_jpeg_poweron(void __iomem *regs)\n{\n\twritel(S5P_POWER_ON, regs + S5P_JPGCLKCON);\n}\n\nvoid s5p_jpeg_input_raw_mode(void __iomem *regs, unsigned long mode)\n{\n\tunsigned long reg, m;\n\n\tm = S5P_MOD_SEL_565;\n\tif (mode == S5P_JPEG_RAW_IN_565)\n\t\tm = S5P_MOD_SEL_565;\n\telse if (mode == S5P_JPEG_RAW_IN_422)\n\t\tm = S5P_MOD_SEL_422;\n\n\treg = readl(regs + S5P_JPGCMOD);\n\treg &= ~S5P_MOD_SEL_MASK;\n\treg |= m;\n\twritel(reg, regs + S5P_JPGCMOD);\n}\n\nvoid s5p_jpeg_proc_mode(void __iomem *regs, unsigned long mode)\n{\n\tunsigned long reg, m;\n\n\tif (mode == S5P_JPEG_ENCODE)\n\t\tm = S5P_PROC_MODE_COMPR;\n\telse\n\t\tm = S5P_PROC_MODE_DECOMPR;\n\treg = readl(regs + S5P_JPGMOD);\n\treg &= ~S5P_PROC_MODE_MASK;\n\treg |= m;\n\twritel(reg, regs + S5P_JPGMOD);\n}\n\nvoid s5p_jpeg_subsampling_mode(void __iomem *regs, unsigned int mode)\n{\n\tunsigned long reg, m;\n\n\tif (mode == V4L2_JPEG_CHROMA_SUBSAMPLING_420)\n\t\tm = S5P_SUBSAMPLING_MODE_420;\n\telse\n\t\tm = S5P_SUBSAMPLING_MODE_422;\n\n\treg = readl(regs + S5P_JPGMOD);\n\treg &= ~S5P_SUBSAMPLING_MODE_MASK;\n\treg |= m;\n\twritel(reg, regs + S5P_JPGMOD);\n}\n\nunsigned int s5p_jpeg_get_subsampling_mode(void __iomem *regs)\n{\n\treturn readl(regs + S5P_JPGMOD) & S5P_SUBSAMPLING_MODE_MASK;\n}\n\nvoid s5p_jpeg_dri(void __iomem *regs, unsigned int dri)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPGDRI_U);\n\treg &= ~0xff;\n\treg |= (dri >> 8) & 0xff;\n\twritel(reg, regs + S5P_JPGDRI_U);\n\n\treg = readl(regs + S5P_JPGDRI_L);\n\treg &= ~0xff;\n\treg |= dri & 0xff;\n\twritel(reg, regs + S5P_JPGDRI_L);\n}\n\nvoid s5p_jpeg_qtbl(void __iomem *regs, unsigned int t, unsigned int n)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPG_QTBL);\n\treg &= ~S5P_QT_NUMt_MASK(t);\n\treg |= (n << S5P_QT_NUMt_SHIFT(t)) & S5P_QT_NUMt_MASK(t);\n\twritel(reg, regs + S5P_JPG_QTBL);\n}\n\nvoid s5p_jpeg_htbl_ac(void __iomem *regs, unsigned int t)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPG_HTBL);\n\treg &= ~S5P_HT_NUMt_AC_MASK(t);\n\t \n\treg |= (0 << S5P_HT_NUMt_AC_SHIFT(t)) & S5P_HT_NUMt_AC_MASK(t);\n\twritel(reg, regs + S5P_JPG_HTBL);\n}\n\nvoid s5p_jpeg_htbl_dc(void __iomem *regs, unsigned int t)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPG_HTBL);\n\treg &= ~S5P_HT_NUMt_DC_MASK(t);\n\t \n\treg |= (0 << S5P_HT_NUMt_DC_SHIFT(t)) & S5P_HT_NUMt_DC_MASK(t);\n\twritel(reg, regs + S5P_JPG_HTBL);\n}\n\nvoid s5p_jpeg_y(void __iomem *regs, unsigned int y)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPGY_U);\n\treg &= ~0xff;\n\treg |= (y >> 8) & 0xff;\n\twritel(reg, regs + S5P_JPGY_U);\n\n\treg = readl(regs + S5P_JPGY_L);\n\treg &= ~0xff;\n\treg |= y & 0xff;\n\twritel(reg, regs + S5P_JPGY_L);\n}\n\nvoid s5p_jpeg_x(void __iomem *regs, unsigned int x)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPGX_U);\n\treg &= ~0xff;\n\treg |= (x >> 8) & 0xff;\n\twritel(reg, regs + S5P_JPGX_U);\n\n\treg = readl(regs + S5P_JPGX_L);\n\treg &= ~0xff;\n\treg |= x & 0xff;\n\twritel(reg, regs + S5P_JPGX_L);\n}\n\nvoid s5p_jpeg_rst_int_enable(void __iomem *regs, bool enable)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPGINTSE);\n\treg &= ~S5P_RSTm_INT_EN_MASK;\n\tif (enable)\n\t\treg |= S5P_RSTm_INT_EN;\n\twritel(reg, regs + S5P_JPGINTSE);\n}\n\nvoid s5p_jpeg_data_num_int_enable(void __iomem *regs, bool enable)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPGINTSE);\n\treg &= ~S5P_DATA_NUM_INT_EN_MASK;\n\tif (enable)\n\t\treg |= S5P_DATA_NUM_INT_EN;\n\twritel(reg, regs + S5P_JPGINTSE);\n}\n\nvoid s5p_jpeg_final_mcu_num_int_enable(void __iomem *regs, bool enbl)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPGINTSE);\n\treg &= ~S5P_FINAL_MCU_NUM_INT_EN_MASK;\n\tif (enbl)\n\t\treg |= S5P_FINAL_MCU_NUM_INT_EN;\n\twritel(reg, regs + S5P_JPGINTSE);\n}\n\nint s5p_jpeg_timer_stat(void __iomem *regs)\n{\n\treturn (int)((readl(regs + S5P_JPG_TIMER_ST) & S5P_TIMER_INT_STAT_MASK)\n\t\t     >> S5P_TIMER_INT_STAT_SHIFT);\n}\n\nvoid s5p_jpeg_clear_timer_stat(void __iomem *regs)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPG_TIMER_SE);\n\treg &= ~S5P_TIMER_INT_STAT_MASK;\n\twritel(reg, regs + S5P_JPG_TIMER_SE);\n}\n\nvoid s5p_jpeg_enc_stream_int(void __iomem *regs, unsigned long size)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPG_ENC_STREAM_INTSE);\n\treg &= ~S5P_ENC_STREAM_BOUND_MASK;\n\treg |= S5P_ENC_STREAM_INT_EN;\n\treg |= size & S5P_ENC_STREAM_BOUND_MASK;\n\twritel(reg, regs + S5P_JPG_ENC_STREAM_INTSE);\n}\n\nint s5p_jpeg_enc_stream_stat(void __iomem *regs)\n{\n\treturn (int)(readl(regs + S5P_JPG_ENC_STREAM_INTST) &\n\t\t     S5P_ENC_STREAM_INT_STAT_MASK);\n}\n\nvoid s5p_jpeg_clear_enc_stream_stat(void __iomem *regs)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPG_ENC_STREAM_INTSE);\n\treg &= ~S5P_ENC_STREAM_INT_MASK;\n\twritel(reg, regs + S5P_JPG_ENC_STREAM_INTSE);\n}\n\nvoid s5p_jpeg_outform_raw(void __iomem *regs, unsigned long format)\n{\n\tunsigned long reg, f;\n\n\tf = S5P_DEC_OUT_FORMAT_422;\n\tif (format == S5P_JPEG_RAW_OUT_422)\n\t\tf = S5P_DEC_OUT_FORMAT_422;\n\telse if (format == S5P_JPEG_RAW_OUT_420)\n\t\tf = S5P_DEC_OUT_FORMAT_420;\n\treg = readl(regs + S5P_JPG_OUTFORM);\n\treg &= ~S5P_DEC_OUT_FORMAT_MASK;\n\treg |= f;\n\twritel(reg, regs + S5P_JPG_OUTFORM);\n}\n\nvoid s5p_jpeg_jpgadr(void __iomem *regs, unsigned long addr)\n{\n\twritel(addr, regs + S5P_JPG_JPGADR);\n}\n\nvoid s5p_jpeg_imgadr(void __iomem *regs, unsigned long addr)\n{\n\twritel(addr, regs + S5P_JPG_IMGADR);\n}\n\nvoid s5p_jpeg_coef(void __iomem *regs, unsigned int i,\n\t\t\t     unsigned int j, unsigned int coef)\n{\n\tunsigned long reg;\n\n\treg = readl(regs + S5P_JPG_COEF(i));\n\treg &= ~S5P_COEFn_MASK(j);\n\treg |= (coef << S5P_COEFn_SHIFT(j)) & S5P_COEFn_MASK(j);\n\twritel(reg, regs + S5P_JPG_COEF(i));\n}\n\nvoid s5p_jpeg_start(void __iomem *regs)\n{\n\twritel(1, regs + S5P_JSTART);\n}\n\nint s5p_jpeg_result_stat_ok(void __iomem *regs)\n{\n\treturn (int)((readl(regs + S5P_JPGINTST) & S5P_RESULT_STAT_MASK)\n\t\t     >> S5P_RESULT_STAT_SHIFT);\n}\n\nint s5p_jpeg_stream_stat_ok(void __iomem *regs)\n{\n\treturn !(int)((readl(regs + S5P_JPGINTST) & S5P_STREAM_STAT_MASK)\n\t\t      >> S5P_STREAM_STAT_SHIFT);\n}\n\nvoid s5p_jpeg_clear_int(void __iomem *regs)\n{\n\treadl(regs + S5P_JPGINTST);\n\twritel(S5P_INT_RELEASE, regs + S5P_JPGCOM);\n\treadl(regs + S5P_JPGOPR);\n}\n\nunsigned int s5p_jpeg_compressed_size(void __iomem *regs)\n{\n\tunsigned long jpeg_size = 0;\n\n\tjpeg_size |= (readl(regs + S5P_JPGCNT_U) & 0xff) << 16;\n\tjpeg_size |= (readl(regs + S5P_JPGCNT_M) & 0xff) << 8;\n\tjpeg_size |= (readl(regs + S5P_JPGCNT_L) & 0xff);\n\n\treturn (unsigned int)jpeg_size;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}