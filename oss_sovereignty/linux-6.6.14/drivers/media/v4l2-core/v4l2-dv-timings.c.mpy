{
  "module_name": "v4l2-dv-timings.c",
  "hash_id": "13a22ec9f7242b9b36e37b01a2992b674d36ef5f30c6f594c31b4871f8a2840f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/v4l2-core/v4l2-dv-timings.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/rational.h>\n#include <linux/videodev2.h>\n#include <linux/v4l2-dv-timings.h>\n#include <media/v4l2-dv-timings.h>\n#include <linux/math64.h>\n#include <linux/hdmi.h>\n#include <media/cec.h>\n\nMODULE_AUTHOR(\"Hans Verkuil\");\nMODULE_DESCRIPTION(\"V4L2 DV Timings Helper Functions\");\nMODULE_LICENSE(\"GPL\");\n\nconst struct v4l2_dv_timings v4l2_dv_timings_presets[] = {\n\tV4L2_DV_BT_CEA_640X480P59_94,\n\tV4L2_DV_BT_CEA_720X480I59_94,\n\tV4L2_DV_BT_CEA_720X480P59_94,\n\tV4L2_DV_BT_CEA_720X576I50,\n\tV4L2_DV_BT_CEA_720X576P50,\n\tV4L2_DV_BT_CEA_1280X720P24,\n\tV4L2_DV_BT_CEA_1280X720P25,\n\tV4L2_DV_BT_CEA_1280X720P30,\n\tV4L2_DV_BT_CEA_1280X720P50,\n\tV4L2_DV_BT_CEA_1280X720P60,\n\tV4L2_DV_BT_CEA_1920X1080P24,\n\tV4L2_DV_BT_CEA_1920X1080P25,\n\tV4L2_DV_BT_CEA_1920X1080P30,\n\tV4L2_DV_BT_CEA_1920X1080I50,\n\tV4L2_DV_BT_CEA_1920X1080P50,\n\tV4L2_DV_BT_CEA_1920X1080I60,\n\tV4L2_DV_BT_CEA_1920X1080P60,\n\tV4L2_DV_BT_DMT_640X350P85,\n\tV4L2_DV_BT_DMT_640X400P85,\n\tV4L2_DV_BT_DMT_720X400P85,\n\tV4L2_DV_BT_DMT_640X480P72,\n\tV4L2_DV_BT_DMT_640X480P75,\n\tV4L2_DV_BT_DMT_640X480P85,\n\tV4L2_DV_BT_DMT_800X600P56,\n\tV4L2_DV_BT_DMT_800X600P60,\n\tV4L2_DV_BT_DMT_800X600P72,\n\tV4L2_DV_BT_DMT_800X600P75,\n\tV4L2_DV_BT_DMT_800X600P85,\n\tV4L2_DV_BT_DMT_800X600P120_RB,\n\tV4L2_DV_BT_DMT_848X480P60,\n\tV4L2_DV_BT_DMT_1024X768I43,\n\tV4L2_DV_BT_DMT_1024X768P60,\n\tV4L2_DV_BT_DMT_1024X768P70,\n\tV4L2_DV_BT_DMT_1024X768P75,\n\tV4L2_DV_BT_DMT_1024X768P85,\n\tV4L2_DV_BT_DMT_1024X768P120_RB,\n\tV4L2_DV_BT_DMT_1152X864P75,\n\tV4L2_DV_BT_DMT_1280X768P60_RB,\n\tV4L2_DV_BT_DMT_1280X768P60,\n\tV4L2_DV_BT_DMT_1280X768P75,\n\tV4L2_DV_BT_DMT_1280X768P85,\n\tV4L2_DV_BT_DMT_1280X768P120_RB,\n\tV4L2_DV_BT_DMT_1280X800P60_RB,\n\tV4L2_DV_BT_DMT_1280X800P60,\n\tV4L2_DV_BT_DMT_1280X800P75,\n\tV4L2_DV_BT_DMT_1280X800P85,\n\tV4L2_DV_BT_DMT_1280X800P120_RB,\n\tV4L2_DV_BT_DMT_1280X960P60,\n\tV4L2_DV_BT_DMT_1280X960P85,\n\tV4L2_DV_BT_DMT_1280X960P120_RB,\n\tV4L2_DV_BT_DMT_1280X1024P60,\n\tV4L2_DV_BT_DMT_1280X1024P75,\n\tV4L2_DV_BT_DMT_1280X1024P85,\n\tV4L2_DV_BT_DMT_1280X1024P120_RB,\n\tV4L2_DV_BT_DMT_1360X768P60,\n\tV4L2_DV_BT_DMT_1360X768P120_RB,\n\tV4L2_DV_BT_DMT_1366X768P60,\n\tV4L2_DV_BT_DMT_1366X768P60_RB,\n\tV4L2_DV_BT_DMT_1400X1050P60_RB,\n\tV4L2_DV_BT_DMT_1400X1050P60,\n\tV4L2_DV_BT_DMT_1400X1050P75,\n\tV4L2_DV_BT_DMT_1400X1050P85,\n\tV4L2_DV_BT_DMT_1400X1050P120_RB,\n\tV4L2_DV_BT_DMT_1440X900P60_RB,\n\tV4L2_DV_BT_DMT_1440X900P60,\n\tV4L2_DV_BT_DMT_1440X900P75,\n\tV4L2_DV_BT_DMT_1440X900P85,\n\tV4L2_DV_BT_DMT_1440X900P120_RB,\n\tV4L2_DV_BT_DMT_1600X900P60_RB,\n\tV4L2_DV_BT_DMT_1600X1200P60,\n\tV4L2_DV_BT_DMT_1600X1200P65,\n\tV4L2_DV_BT_DMT_1600X1200P70,\n\tV4L2_DV_BT_DMT_1600X1200P75,\n\tV4L2_DV_BT_DMT_1600X1200P85,\n\tV4L2_DV_BT_DMT_1600X1200P120_RB,\n\tV4L2_DV_BT_DMT_1680X1050P60_RB,\n\tV4L2_DV_BT_DMT_1680X1050P60,\n\tV4L2_DV_BT_DMT_1680X1050P75,\n\tV4L2_DV_BT_DMT_1680X1050P85,\n\tV4L2_DV_BT_DMT_1680X1050P120_RB,\n\tV4L2_DV_BT_DMT_1792X1344P60,\n\tV4L2_DV_BT_DMT_1792X1344P75,\n\tV4L2_DV_BT_DMT_1792X1344P120_RB,\n\tV4L2_DV_BT_DMT_1856X1392P60,\n\tV4L2_DV_BT_DMT_1856X1392P75,\n\tV4L2_DV_BT_DMT_1856X1392P120_RB,\n\tV4L2_DV_BT_DMT_1920X1200P60_RB,\n\tV4L2_DV_BT_DMT_1920X1200P60,\n\tV4L2_DV_BT_DMT_1920X1200P75,\n\tV4L2_DV_BT_DMT_1920X1200P85,\n\tV4L2_DV_BT_DMT_1920X1200P120_RB,\n\tV4L2_DV_BT_DMT_1920X1440P60,\n\tV4L2_DV_BT_DMT_1920X1440P75,\n\tV4L2_DV_BT_DMT_1920X1440P120_RB,\n\tV4L2_DV_BT_DMT_2048X1152P60_RB,\n\tV4L2_DV_BT_DMT_2560X1600P60_RB,\n\tV4L2_DV_BT_DMT_2560X1600P60,\n\tV4L2_DV_BT_DMT_2560X1600P75,\n\tV4L2_DV_BT_DMT_2560X1600P85,\n\tV4L2_DV_BT_DMT_2560X1600P120_RB,\n\tV4L2_DV_BT_CEA_3840X2160P24,\n\tV4L2_DV_BT_CEA_3840X2160P25,\n\tV4L2_DV_BT_CEA_3840X2160P30,\n\tV4L2_DV_BT_CEA_3840X2160P50,\n\tV4L2_DV_BT_CEA_3840X2160P60,\n\tV4L2_DV_BT_CEA_4096X2160P24,\n\tV4L2_DV_BT_CEA_4096X2160P25,\n\tV4L2_DV_BT_CEA_4096X2160P30,\n\tV4L2_DV_BT_CEA_4096X2160P50,\n\tV4L2_DV_BT_DMT_4096X2160P59_94_RB,\n\tV4L2_DV_BT_CEA_4096X2160P60,\n\t{ }\n};\nEXPORT_SYMBOL_GPL(v4l2_dv_timings_presets);\n\nbool v4l2_valid_dv_timings(const struct v4l2_dv_timings *t,\n\t\t\t   const struct v4l2_dv_timings_cap *dvcap,\n\t\t\t   v4l2_check_dv_timings_fnc fnc,\n\t\t\t   void *fnc_handle)\n{\n\tconst struct v4l2_bt_timings *bt = &t->bt;\n\tconst struct v4l2_bt_timings_cap *cap = &dvcap->bt;\n\tu32 caps = cap->capabilities;\n\tconst u32 max_vert = 10240;\n\tu32 max_hor = 3 * bt->width;\n\n\tif (t->type != V4L2_DV_BT_656_1120)\n\t\treturn false;\n\tif (t->type != dvcap->type ||\n\t    bt->height < cap->min_height ||\n\t    bt->height > cap->max_height ||\n\t    bt->width < cap->min_width ||\n\t    bt->width > cap->max_width ||\n\t    bt->pixelclock < cap->min_pixelclock ||\n\t    bt->pixelclock > cap->max_pixelclock ||\n\t    (!(caps & V4L2_DV_BT_CAP_CUSTOM) &&\n\t     cap->standards && bt->standards &&\n\t     !(bt->standards & cap->standards)) ||\n\t    (bt->interlaced && !(caps & V4L2_DV_BT_CAP_INTERLACED)) ||\n\t    (!bt->interlaced && !(caps & V4L2_DV_BT_CAP_PROGRESSIVE)))\n\t\treturn false;\n\n\t \n\tif (!bt->interlaced &&\n\t    (bt->il_vbackporch || bt->il_vsync || bt->il_vfrontporch))\n\t\treturn false;\n\t \n\tif (bt->hfrontporch > max_hor ||\n\t    bt->hsync > max_hor || bt->hbackporch > max_hor)\n\t\treturn false;\n\tif (bt->vfrontporch > max_vert ||\n\t    bt->vsync > max_vert || bt->vbackporch > max_vert)\n\t\treturn false;\n\tif (bt->interlaced && (bt->il_vfrontporch > max_vert ||\n\t    bt->il_vsync > max_vert || bt->il_vbackporch > max_vert))\n\t\treturn false;\n\treturn fnc == NULL || fnc(t, fnc_handle);\n}\nEXPORT_SYMBOL_GPL(v4l2_valid_dv_timings);\n\nint v4l2_enum_dv_timings_cap(struct v4l2_enum_dv_timings *t,\n\t\t\t     const struct v4l2_dv_timings_cap *cap,\n\t\t\t     v4l2_check_dv_timings_fnc fnc,\n\t\t\t     void *fnc_handle)\n{\n\tu32 i, idx;\n\n\tmemset(t->reserved, 0, sizeof(t->reserved));\n\tfor (i = idx = 0; v4l2_dv_timings_presets[i].bt.width; i++) {\n\t\tif (v4l2_valid_dv_timings(v4l2_dv_timings_presets + i, cap,\n\t\t\t\t\t  fnc, fnc_handle) &&\n\t\t    idx++ == t->index) {\n\t\t\tt->timings = v4l2_dv_timings_presets[i];\n\t\t\treturn 0;\n\t\t}\n\t}\n\treturn -EINVAL;\n}\nEXPORT_SYMBOL_GPL(v4l2_enum_dv_timings_cap);\n\nbool v4l2_find_dv_timings_cap(struct v4l2_dv_timings *t,\n\t\t\t      const struct v4l2_dv_timings_cap *cap,\n\t\t\t      unsigned pclock_delta,\n\t\t\t      v4l2_check_dv_timings_fnc fnc,\n\t\t\t      void *fnc_handle)\n{\n\tint i;\n\n\tif (!v4l2_valid_dv_timings(t, cap, fnc, fnc_handle))\n\t\treturn false;\n\n\tfor (i = 0; v4l2_dv_timings_presets[i].bt.width; i++) {\n\t\tif (v4l2_valid_dv_timings(v4l2_dv_timings_presets + i, cap,\n\t\t\t\t\t  fnc, fnc_handle) &&\n\t\t    v4l2_match_dv_timings(t, v4l2_dv_timings_presets + i,\n\t\t\t\t\t  pclock_delta, false)) {\n\t\t\tu32 flags = t->bt.flags & V4L2_DV_FL_REDUCED_FPS;\n\n\t\t\t*t = v4l2_dv_timings_presets[i];\n\t\t\tif (can_reduce_fps(&t->bt))\n\t\t\t\tt->bt.flags |= flags;\n\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\nEXPORT_SYMBOL_GPL(v4l2_find_dv_timings_cap);\n\nbool v4l2_find_dv_timings_cea861_vic(struct v4l2_dv_timings *t, u8 vic)\n{\n\tunsigned int i;\n\n\tfor (i = 0; v4l2_dv_timings_presets[i].bt.width; i++) {\n\t\tconst struct v4l2_bt_timings *bt =\n\t\t\t&v4l2_dv_timings_presets[i].bt;\n\n\t\tif ((bt->flags & V4L2_DV_FL_HAS_CEA861_VIC) &&\n\t\t    bt->cea861_vic == vic) {\n\t\t\t*t = v4l2_dv_timings_presets[i];\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\nEXPORT_SYMBOL_GPL(v4l2_find_dv_timings_cea861_vic);\n\n \nbool v4l2_match_dv_timings(const struct v4l2_dv_timings *t1,\n\t\t\t   const struct v4l2_dv_timings *t2,\n\t\t\t   unsigned pclock_delta, bool match_reduced_fps)\n{\n\tif (t1->type != t2->type || t1->type != V4L2_DV_BT_656_1120)\n\t\treturn false;\n\tif (t1->bt.width == t2->bt.width &&\n\t    t1->bt.height == t2->bt.height &&\n\t    t1->bt.interlaced == t2->bt.interlaced &&\n\t    t1->bt.polarities == t2->bt.polarities &&\n\t    t1->bt.pixelclock >= t2->bt.pixelclock - pclock_delta &&\n\t    t1->bt.pixelclock <= t2->bt.pixelclock + pclock_delta &&\n\t    t1->bt.hfrontporch == t2->bt.hfrontporch &&\n\t    t1->bt.hsync == t2->bt.hsync &&\n\t    t1->bt.hbackporch == t2->bt.hbackporch &&\n\t    t1->bt.vfrontporch == t2->bt.vfrontporch &&\n\t    t1->bt.vsync == t2->bt.vsync &&\n\t    t1->bt.vbackporch == t2->bt.vbackporch &&\n\t    (!match_reduced_fps ||\n\t     (t1->bt.flags & V4L2_DV_FL_REDUCED_FPS) ==\n\t\t(t2->bt.flags & V4L2_DV_FL_REDUCED_FPS)) &&\n\t    (!t1->bt.interlaced ||\n\t\t(t1->bt.il_vfrontporch == t2->bt.il_vfrontporch &&\n\t\t t1->bt.il_vsync == t2->bt.il_vsync &&\n\t\t t1->bt.il_vbackporch == t2->bt.il_vbackporch)))\n\t\treturn true;\n\treturn false;\n}\nEXPORT_SYMBOL_GPL(v4l2_match_dv_timings);\n\nvoid v4l2_print_dv_timings(const char *dev_prefix, const char *prefix,\n\t\t\t   const struct v4l2_dv_timings *t, bool detailed)\n{\n\tconst struct v4l2_bt_timings *bt = &t->bt;\n\tu32 htot, vtot;\n\tu32 fps;\n\n\tif (t->type != V4L2_DV_BT_656_1120)\n\t\treturn;\n\n\thtot = V4L2_DV_BT_FRAME_WIDTH(bt);\n\tvtot = V4L2_DV_BT_FRAME_HEIGHT(bt);\n\tif (bt->interlaced)\n\t\tvtot /= 2;\n\n\tfps = (htot * vtot) > 0 ? div_u64((100 * (u64)bt->pixelclock),\n\t\t\t\t  (htot * vtot)) : 0;\n\n\tif (prefix == NULL)\n\t\tprefix = \"\";\n\n\tpr_info(\"%s: %s%ux%u%s%u.%02u (%ux%u)\\n\", dev_prefix, prefix,\n\t\tbt->width, bt->height, bt->interlaced ? \"i\" : \"p\",\n\t\tfps / 100, fps % 100, htot, vtot);\n\n\tif (!detailed)\n\t\treturn;\n\n\tpr_info(\"%s: horizontal: fp = %u, %ssync = %u, bp = %u\\n\",\n\t\t\tdev_prefix, bt->hfrontporch,\n\t\t\t(bt->polarities & V4L2_DV_HSYNC_POS_POL) ? \"+\" : \"-\",\n\t\t\tbt->hsync, bt->hbackporch);\n\tpr_info(\"%s: vertical: fp = %u, %ssync = %u, bp = %u\\n\",\n\t\t\tdev_prefix, bt->vfrontporch,\n\t\t\t(bt->polarities & V4L2_DV_VSYNC_POS_POL) ? \"+\" : \"-\",\n\t\t\tbt->vsync, bt->vbackporch);\n\tif (bt->interlaced)\n\t\tpr_info(\"%s: vertical bottom field: fp = %u, %ssync = %u, bp = %u\\n\",\n\t\t\tdev_prefix, bt->il_vfrontporch,\n\t\t\t(bt->polarities & V4L2_DV_VSYNC_POS_POL) ? \"+\" : \"-\",\n\t\t\tbt->il_vsync, bt->il_vbackporch);\n\tpr_info(\"%s: pixelclock: %llu\\n\", dev_prefix, bt->pixelclock);\n\tpr_info(\"%s: flags (0x%x):%s%s%s%s%s%s%s%s%s%s\\n\",\n\t\t\tdev_prefix, bt->flags,\n\t\t\t(bt->flags & V4L2_DV_FL_REDUCED_BLANKING) ?\n\t\t\t\" REDUCED_BLANKING\" : \"\",\n\t\t\t((bt->flags & V4L2_DV_FL_REDUCED_BLANKING) &&\n\t\t\t bt->vsync == 8) ? \" (V2)\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_CAN_REDUCE_FPS) ?\n\t\t\t\" CAN_REDUCE_FPS\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_REDUCED_FPS) ?\n\t\t\t\" REDUCED_FPS\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_HALF_LINE) ?\n\t\t\t\" HALF_LINE\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_IS_CE_VIDEO) ?\n\t\t\t\" CE_VIDEO\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_FIRST_FIELD_EXTRA_LINE) ?\n\t\t\t\" FIRST_FIELD_EXTRA_LINE\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_HAS_PICTURE_ASPECT) ?\n\t\t\t\" HAS_PICTURE_ASPECT\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_HAS_CEA861_VIC) ?\n\t\t\t\" HAS_CEA861_VIC\" : \"\",\n\t\t\t(bt->flags & V4L2_DV_FL_HAS_HDMI_VIC) ?\n\t\t\t\" HAS_HDMI_VIC\" : \"\");\n\tpr_info(\"%s: standards (0x%x):%s%s%s%s%s\\n\", dev_prefix, bt->standards,\n\t\t\t(bt->standards & V4L2_DV_BT_STD_CEA861) ?  \" CEA\" : \"\",\n\t\t\t(bt->standards & V4L2_DV_BT_STD_DMT) ?  \" DMT\" : \"\",\n\t\t\t(bt->standards & V4L2_DV_BT_STD_CVT) ?  \" CVT\" : \"\",\n\t\t\t(bt->standards & V4L2_DV_BT_STD_GTF) ?  \" GTF\" : \"\",\n\t\t\t(bt->standards & V4L2_DV_BT_STD_SDI) ?  \" SDI\" : \"\");\n\tif (bt->flags & V4L2_DV_FL_HAS_PICTURE_ASPECT)\n\t\tpr_info(\"%s: picture aspect (hor:vert): %u:%u\\n\", dev_prefix,\n\t\t\tbt->picture_aspect.numerator,\n\t\t\tbt->picture_aspect.denominator);\n\tif (bt->flags & V4L2_DV_FL_HAS_CEA861_VIC)\n\t\tpr_info(\"%s: CEA-861 VIC: %u\\n\", dev_prefix, bt->cea861_vic);\n\tif (bt->flags & V4L2_DV_FL_HAS_HDMI_VIC)\n\t\tpr_info(\"%s: HDMI VIC: %u\\n\", dev_prefix, bt->hdmi_vic);\n}\nEXPORT_SYMBOL_GPL(v4l2_print_dv_timings);\n\nstruct v4l2_fract v4l2_dv_timings_aspect_ratio(const struct v4l2_dv_timings *t)\n{\n\tstruct v4l2_fract ratio = { 1, 1 };\n\tunsigned long n, d;\n\n\tif (t->type != V4L2_DV_BT_656_1120)\n\t\treturn ratio;\n\tif (!(t->bt.flags & V4L2_DV_FL_HAS_PICTURE_ASPECT))\n\t\treturn ratio;\n\n\tratio.numerator = t->bt.width * t->bt.picture_aspect.denominator;\n\tratio.denominator = t->bt.height * t->bt.picture_aspect.numerator;\n\n\trational_best_approximation(ratio.numerator, ratio.denominator,\n\t\t\t\t    ratio.numerator, ratio.denominator, &n, &d);\n\tratio.numerator = n;\n\tratio.denominator = d;\n\treturn ratio;\n}\nEXPORT_SYMBOL_GPL(v4l2_dv_timings_aspect_ratio);\n\n \nstruct v4l2_fract v4l2_calc_timeperframe(const struct v4l2_dv_timings *t)\n{\n\tconst struct v4l2_bt_timings *bt = &t->bt;\n\tstruct v4l2_fract fps_fract = { 1, 1 };\n\tunsigned long n, d;\n\tu32 htot, vtot, fps;\n\tu64 pclk;\n\n\tif (t->type != V4L2_DV_BT_656_1120)\n\t\treturn fps_fract;\n\n\thtot = V4L2_DV_BT_FRAME_WIDTH(bt);\n\tvtot = V4L2_DV_BT_FRAME_HEIGHT(bt);\n\tpclk = bt->pixelclock;\n\n\tif ((bt->flags & V4L2_DV_FL_CAN_DETECT_REDUCED_FPS) &&\n\t    (bt->flags & V4L2_DV_FL_REDUCED_FPS))\n\t\tpclk = div_u64(pclk * 1000ULL, 1001);\n\n\tfps = (htot * vtot) > 0 ? div_u64((100 * pclk), (htot * vtot)) : 0;\n\tif (!fps)\n\t\treturn fps_fract;\n\n\trational_best_approximation(fps, 100, fps, 100, &n, &d);\n\n\tfps_fract.numerator = d;\n\tfps_fract.denominator = n;\n\treturn fps_fract;\n}\nEXPORT_SYMBOL_GPL(v4l2_calc_timeperframe);\n\n \n\n#define CVT_PXL_CLK_GRAN\t250000\t \n#define CVT_PXL_CLK_GRAN_RB_V2 1000\t \n\n \n#define CVT_MIN_V_BPORCH\t7\t \n#define CVT_MIN_V_PORCH_RND\t3\t \n#define CVT_MIN_VSYNC_BP\t550\t \n#define CVT_HSYNC_PERCENT       8        \n\n \n#define CVT_CELL_GRAN\t\t8\t \n#define CVT_M\t\t\t600\t \n#define CVT_C\t\t\t40\t \n#define CVT_K\t\t\t128\t \n#define CVT_J\t\t\t20\t \n#define CVT_C_PRIME (((CVT_C - CVT_J) * CVT_K / 256) + CVT_J)\n#define CVT_M_PRIME (CVT_K * CVT_M / 256)\n\n \n#define CVT_RB_MIN_V_BPORCH    7        \n#define CVT_RB_V_FPORCH        3        \n#define CVT_RB_MIN_V_BLANK   460        \n#define CVT_RB_H_SYNC         32        \n#define CVT_RB_H_BLANK       160        \n \n#define CVT_RB_V2_H_BLANK     80        \n#define CVT_RB_MIN_V_FPORCH    3        \n#define CVT_RB_V2_MIN_V_FPORCH 1        \n#define CVT_RB_V_BPORCH        6        \n\n \nbool v4l2_detect_cvt(unsigned frame_height,\n\t\t     unsigned hfreq,\n\t\t     unsigned vsync,\n\t\t     unsigned active_width,\n\t\t     u32 polarities,\n\t\t     bool interlaced,\n\t\t     struct v4l2_dv_timings *fmt)\n{\n\tint  v_fp, v_bp, h_fp, h_bp, hsync;\n\tint  frame_width, image_height, image_width;\n\tbool reduced_blanking;\n\tbool rb_v2 = false;\n\tunsigned pix_clk;\n\n\tif (vsync < 4 || vsync > 8)\n\t\treturn false;\n\n\tif (polarities == V4L2_DV_VSYNC_POS_POL)\n\t\treduced_blanking = false;\n\telse if (polarities == V4L2_DV_HSYNC_POS_POL)\n\t\treduced_blanking = true;\n\telse\n\t\treturn false;\n\n\tif (reduced_blanking && vsync == 8)\n\t\trb_v2 = true;\n\n\tif (rb_v2 && active_width == 0)\n\t\treturn false;\n\n\tif (!rb_v2 && vsync > 7)\n\t\treturn false;\n\n\tif (hfreq == 0)\n\t\treturn false;\n\n\t \n\tif (reduced_blanking) {\n\t\tif (rb_v2) {\n\t\t\tv_bp = CVT_RB_V_BPORCH;\n\t\t\tv_fp = (CVT_RB_MIN_V_BLANK * hfreq) / 1000000 + 1;\n\t\t\tv_fp -= vsync + v_bp;\n\n\t\t\tif (v_fp < CVT_RB_V2_MIN_V_FPORCH)\n\t\t\t\tv_fp = CVT_RB_V2_MIN_V_FPORCH;\n\t\t} else {\n\t\t\tv_fp = CVT_RB_V_FPORCH;\n\t\t\tv_bp = (CVT_RB_MIN_V_BLANK * hfreq) / 1000000 + 1;\n\t\t\tv_bp -= vsync + v_fp;\n\n\t\t\tif (v_bp < CVT_RB_MIN_V_BPORCH)\n\t\t\t\tv_bp = CVT_RB_MIN_V_BPORCH;\n\t\t}\n\t} else {\n\t\tv_fp = CVT_MIN_V_PORCH_RND;\n\t\tv_bp = (CVT_MIN_VSYNC_BP * hfreq) / 1000000 + 1 - vsync;\n\n\t\tif (v_bp < CVT_MIN_V_BPORCH)\n\t\t\tv_bp = CVT_MIN_V_BPORCH;\n\t}\n\n\tif (interlaced)\n\t\timage_height = (frame_height - 2 * v_fp - 2 * vsync - 2 * v_bp) & ~0x1;\n\telse\n\t\timage_height = (frame_height - v_fp - vsync - v_bp + 1) & ~0x1;\n\n\tif (image_height < 0)\n\t\treturn false;\n\n\t \n\tswitch (vsync) {\n\tcase 4:\n\t\timage_width = (image_height * 4) / 3;\n\t\tbreak;\n\tcase 5:\n\t\timage_width = (image_height * 16) / 9;\n\t\tbreak;\n\tcase 6:\n\t\timage_width = (image_height * 16) / 10;\n\t\tbreak;\n\tcase 7:\n\t\t \n\t\tif (image_height == 1024)\n\t\t\timage_width = (image_height * 5) / 4;\n\t\telse if (image_height == 768)\n\t\t\timage_width = (image_height * 15) / 9;\n\t\telse\n\t\t\treturn false;\n\t\tbreak;\n\tcase 8:\n\t\timage_width = active_width;\n\t\tbreak;\n\tdefault:\n\t\treturn false;\n\t}\n\n\tif (!rb_v2)\n\t\timage_width = image_width & ~7;\n\n\t \n\tif (reduced_blanking) {\n\t\tint h_blank;\n\t\tint clk_gran;\n\n\t\th_blank = rb_v2 ? CVT_RB_V2_H_BLANK : CVT_RB_H_BLANK;\n\t\tclk_gran = rb_v2 ? CVT_PXL_CLK_GRAN_RB_V2 : CVT_PXL_CLK_GRAN;\n\n\t\tpix_clk = (image_width + h_blank) * hfreq;\n\t\tpix_clk = (pix_clk / clk_gran) * clk_gran;\n\n\t\th_bp  = h_blank / 2;\n\t\thsync = CVT_RB_H_SYNC;\n\t\th_fp  = h_blank - h_bp - hsync;\n\n\t\tframe_width = image_width + h_blank;\n\t} else {\n\t\tunsigned ideal_duty_cycle_per_myriad =\n\t\t\t100 * CVT_C_PRIME - (CVT_M_PRIME * 100000) / hfreq;\n\t\tint h_blank;\n\n\t\tif (ideal_duty_cycle_per_myriad < 2000)\n\t\t\tideal_duty_cycle_per_myriad = 2000;\n\n\t\th_blank = image_width * ideal_duty_cycle_per_myriad /\n\t\t\t\t\t(10000 - ideal_duty_cycle_per_myriad);\n\t\th_blank = (h_blank / (2 * CVT_CELL_GRAN)) * 2 * CVT_CELL_GRAN;\n\n\t\tpix_clk = (image_width + h_blank) * hfreq;\n\t\tpix_clk = (pix_clk / CVT_PXL_CLK_GRAN) * CVT_PXL_CLK_GRAN;\n\n\t\th_bp = h_blank / 2;\n\t\tframe_width = image_width + h_blank;\n\n\t\thsync = frame_width * CVT_HSYNC_PERCENT / 100;\n\t\thsync = (hsync / CVT_CELL_GRAN) * CVT_CELL_GRAN;\n\t\th_fp = h_blank - hsync - h_bp;\n\t}\n\n\tfmt->type = V4L2_DV_BT_656_1120;\n\tfmt->bt.polarities = polarities;\n\tfmt->bt.width = image_width;\n\tfmt->bt.height = image_height;\n\tfmt->bt.hfrontporch = h_fp;\n\tfmt->bt.vfrontporch = v_fp;\n\tfmt->bt.hsync = hsync;\n\tfmt->bt.vsync = vsync;\n\tfmt->bt.hbackporch = frame_width - image_width - h_fp - hsync;\n\n\tif (!interlaced) {\n\t\tfmt->bt.vbackporch = frame_height - image_height - v_fp - vsync;\n\t\tfmt->bt.interlaced = V4L2_DV_PROGRESSIVE;\n\t} else {\n\t\tfmt->bt.vbackporch = (frame_height - image_height - 2 * v_fp -\n\t\t\t\t      2 * vsync) / 2;\n\t\tfmt->bt.il_vbackporch = frame_height - image_height - 2 * v_fp -\n\t\t\t\t\t2 * vsync - fmt->bt.vbackporch;\n\t\tfmt->bt.il_vfrontporch = v_fp;\n\t\tfmt->bt.il_vsync = vsync;\n\t\tfmt->bt.flags |= V4L2_DV_FL_HALF_LINE;\n\t\tfmt->bt.interlaced = V4L2_DV_INTERLACED;\n\t}\n\n\tfmt->bt.pixelclock = pix_clk;\n\tfmt->bt.standards = V4L2_DV_BT_STD_CVT;\n\n\tif (reduced_blanking)\n\t\tfmt->bt.flags |= V4L2_DV_FL_REDUCED_BLANKING;\n\n\treturn true;\n}\nEXPORT_SYMBOL_GPL(v4l2_detect_cvt);\n\n \n\n#define GTF_PXL_CLK_GRAN\t250000\t \n\n#define GTF_MIN_VSYNC_BP\t550\t \n#define GTF_V_FP\t\t1\t \n#define GTF_CELL_GRAN\t\t8\t \n\n \n#define GTF_D_M\t\t\t600\t \n#define GTF_D_C\t\t\t40\t \n#define GTF_D_K\t\t\t128\t \n#define GTF_D_J\t\t\t20\t \n#define GTF_D_C_PRIME ((((GTF_D_C - GTF_D_J) * GTF_D_K) / 256) + GTF_D_J)\n#define GTF_D_M_PRIME ((GTF_D_K * GTF_D_M) / 256)\n\n \n#define GTF_S_M\t\t\t3600\t \n#define GTF_S_C\t\t\t40\t \n#define GTF_S_K\t\t\t128\t \n#define GTF_S_J\t\t\t35\t \n#define GTF_S_C_PRIME ((((GTF_S_C - GTF_S_J) * GTF_S_K) / 256) + GTF_S_J)\n#define GTF_S_M_PRIME ((GTF_S_K * GTF_S_M) / 256)\n\n \nbool v4l2_detect_gtf(unsigned frame_height,\n\t\tunsigned hfreq,\n\t\tunsigned vsync,\n\t\tu32 polarities,\n\t\tbool interlaced,\n\t\tstruct v4l2_fract aspect,\n\t\tstruct v4l2_dv_timings *fmt)\n{\n\tint pix_clk;\n\tint  v_fp, v_bp, h_fp, hsync;\n\tint frame_width, image_height, image_width;\n\tbool default_gtf;\n\tint h_blank;\n\n\tif (vsync != 3)\n\t\treturn false;\n\n\tif (polarities == V4L2_DV_VSYNC_POS_POL)\n\t\tdefault_gtf = true;\n\telse if (polarities == V4L2_DV_HSYNC_POS_POL)\n\t\tdefault_gtf = false;\n\telse\n\t\treturn false;\n\n\tif (hfreq == 0)\n\t\treturn false;\n\n\t \n\tv_fp = GTF_V_FP;\n\tv_bp = (GTF_MIN_VSYNC_BP * hfreq + 500000) / 1000000 - vsync;\n\tif (interlaced)\n\t\timage_height = (frame_height - 2 * v_fp - 2 * vsync - 2 * v_bp) & ~0x1;\n\telse\n\t\timage_height = (frame_height - v_fp - vsync - v_bp + 1) & ~0x1;\n\n\tif (image_height < 0)\n\t\treturn false;\n\n\tif (aspect.numerator == 0 || aspect.denominator == 0) {\n\t\taspect.numerator = 16;\n\t\taspect.denominator = 9;\n\t}\n\timage_width = ((image_height * aspect.numerator) / aspect.denominator);\n\timage_width = (image_width + GTF_CELL_GRAN/2) & ~(GTF_CELL_GRAN - 1);\n\n\t \n\tif (default_gtf) {\n\t\tu64 num;\n\t\tu32 den;\n\n\t\tnum = ((image_width * GTF_D_C_PRIME * (u64)hfreq) -\n\t\t      ((u64)image_width * GTF_D_M_PRIME * 1000));\n\t\tden = (hfreq * (100 - GTF_D_C_PRIME) + GTF_D_M_PRIME * 1000) *\n\t\t      (2 * GTF_CELL_GRAN);\n\t\th_blank = div_u64((num + (den >> 1)), den);\n\t\th_blank *= (2 * GTF_CELL_GRAN);\n\t} else {\n\t\tu64 num;\n\t\tu32 den;\n\n\t\tnum = ((image_width * GTF_S_C_PRIME * (u64)hfreq) -\n\t\t      ((u64)image_width * GTF_S_M_PRIME * 1000));\n\t\tden = (hfreq * (100 - GTF_S_C_PRIME) + GTF_S_M_PRIME * 1000) *\n\t\t      (2 * GTF_CELL_GRAN);\n\t\th_blank = div_u64((num + (den >> 1)), den);\n\t\th_blank *= (2 * GTF_CELL_GRAN);\n\t}\n\n\tframe_width = image_width + h_blank;\n\n\tpix_clk = (image_width + h_blank) * hfreq;\n\tpix_clk = pix_clk / GTF_PXL_CLK_GRAN * GTF_PXL_CLK_GRAN;\n\n\thsync = (frame_width * 8 + 50) / 100;\n\thsync = DIV_ROUND_CLOSEST(hsync, GTF_CELL_GRAN) * GTF_CELL_GRAN;\n\n\th_fp = h_blank / 2 - hsync;\n\n\tfmt->type = V4L2_DV_BT_656_1120;\n\tfmt->bt.polarities = polarities;\n\tfmt->bt.width = image_width;\n\tfmt->bt.height = image_height;\n\tfmt->bt.hfrontporch = h_fp;\n\tfmt->bt.vfrontporch = v_fp;\n\tfmt->bt.hsync = hsync;\n\tfmt->bt.vsync = vsync;\n\tfmt->bt.hbackporch = frame_width - image_width - h_fp - hsync;\n\n\tif (!interlaced) {\n\t\tfmt->bt.vbackporch = frame_height - image_height - v_fp - vsync;\n\t\tfmt->bt.interlaced = V4L2_DV_PROGRESSIVE;\n\t} else {\n\t\tfmt->bt.vbackporch = (frame_height - image_height - 2 * v_fp -\n\t\t\t\t      2 * vsync) / 2;\n\t\tfmt->bt.il_vbackporch = frame_height - image_height - 2 * v_fp -\n\t\t\t\t\t2 * vsync - fmt->bt.vbackporch;\n\t\tfmt->bt.il_vfrontporch = v_fp;\n\t\tfmt->bt.il_vsync = vsync;\n\t\tfmt->bt.flags |= V4L2_DV_FL_HALF_LINE;\n\t\tfmt->bt.interlaced = V4L2_DV_INTERLACED;\n\t}\n\n\tfmt->bt.pixelclock = pix_clk;\n\tfmt->bt.standards = V4L2_DV_BT_STD_GTF;\n\n\tif (!default_gtf)\n\t\tfmt->bt.flags |= V4L2_DV_FL_REDUCED_BLANKING;\n\n\treturn true;\n}\nEXPORT_SYMBOL_GPL(v4l2_detect_gtf);\n\n \nstruct v4l2_fract v4l2_calc_aspect_ratio(u8 hor_landscape, u8 vert_portrait)\n{\n\tstruct v4l2_fract aspect = { 16, 9 };\n\tu8 ratio;\n\n\t \n\tif (!hor_landscape && !vert_portrait)\n\t\treturn aspect;\n\t \n\tif (hor_landscape && vert_portrait) {\n\t\taspect.numerator = hor_landscape;\n\t\taspect.denominator = vert_portrait;\n\t\treturn aspect;\n\t}\n\t \n\tratio = hor_landscape | vert_portrait;\n\t \n\tif (ratio == 79) {\n\t\taspect.numerator = 16;\n\t\taspect.denominator = 9;\n\t} else if (ratio == 34) {\n\t\taspect.numerator = 4;\n\t\taspect.denominator = 3;\n\t} else if (ratio == 68) {\n\t\taspect.numerator = 15;\n\t\taspect.denominator = 9;\n\t} else {\n\t\taspect.numerator = hor_landscape + 99;\n\t\taspect.denominator = 100;\n\t}\n\tif (hor_landscape)\n\t\treturn aspect;\n\t \n\tswap(aspect.denominator, aspect.numerator);\n\treturn aspect;\n}\nEXPORT_SYMBOL_GPL(v4l2_calc_aspect_ratio);\n\n \nstruct v4l2_hdmi_colorimetry\nv4l2_hdmi_rx_colorimetry(const struct hdmi_avi_infoframe *avi,\n\t\t\t const struct hdmi_vendor_infoframe *hdmi,\n\t\t\t unsigned int height)\n{\n\tstruct v4l2_hdmi_colorimetry c = {\n\t\tV4L2_COLORSPACE_SRGB,\n\t\tV4L2_YCBCR_ENC_DEFAULT,\n\t\tV4L2_QUANTIZATION_FULL_RANGE,\n\t\tV4L2_XFER_FUNC_SRGB\n\t};\n\tbool is_ce = avi->video_code || (hdmi && hdmi->vic);\n\tbool is_sdtv = height <= 576;\n\tbool default_is_lim_range_rgb = avi->video_code > 1;\n\n\tswitch (avi->colorspace) {\n\tcase HDMI_COLORSPACE_RGB:\n\t\t \n\t\tswitch (avi->colorimetry) {\n\t\tcase HDMI_COLORIMETRY_EXTENDED:\n\t\t\tswitch (avi->extended_colorimetry) {\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_OPRGB:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_OPRGB;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_OPRGB;\n\t\t\t\tbreak;\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_BT2020:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_BT2020;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tswitch (avi->quantization_range) {\n\t\tcase HDMI_QUANTIZATION_RANGE_LIMITED:\n\t\t\tc.quantization = V4L2_QUANTIZATION_LIM_RANGE;\n\t\t\tbreak;\n\t\tcase HDMI_QUANTIZATION_RANGE_FULL:\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tif (default_is_lim_range_rgb)\n\t\t\t\tc.quantization = V4L2_QUANTIZATION_LIM_RANGE;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\t \n\t\tc.quantization = V4L2_QUANTIZATION_LIM_RANGE;\n\t\tswitch (avi->colorimetry) {\n\t\tcase HDMI_COLORIMETRY_NONE:\n\t\t\tif (!is_ce)\n\t\t\t\tbreak;\n\t\t\tif (is_sdtv) {\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_SMPTE170M;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_601;\n\t\t\t} else {\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_REC709;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_709;\n\t\t\t}\n\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\tbreak;\n\t\tcase HDMI_COLORIMETRY_ITU_601:\n\t\t\tc.colorspace = V4L2_COLORSPACE_SMPTE170M;\n\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_601;\n\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\tbreak;\n\t\tcase HDMI_COLORIMETRY_ITU_709:\n\t\t\tc.colorspace = V4L2_COLORSPACE_REC709;\n\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_709;\n\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\tbreak;\n\t\tcase HDMI_COLORIMETRY_EXTENDED:\n\t\t\tswitch (avi->extended_colorimetry) {\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_XV_YCC_601:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_REC709;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_XV709;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\t\tbreak;\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_XV_YCC_709:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_REC709;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_XV601;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\t\tbreak;\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_S_YCC_601:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_SRGB;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_601;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_SRGB;\n\t\t\t\tbreak;\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_OPYCC_601:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_OPRGB;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_601;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_OPRGB;\n\t\t\t\tbreak;\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_BT2020:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_BT2020;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_BT2020;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\t\tbreak;\n\t\t\tcase HDMI_EXTENDED_COLORIMETRY_BT2020_CONST_LUM:\n\t\t\t\tc.colorspace = V4L2_COLORSPACE_BT2020;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_BT2020_CONST_LUM;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\t\tbreak;\n\t\t\tdefault:  \n\t\t\t\tc.colorspace = V4L2_COLORSPACE_REC709;\n\t\t\t\tc.ycbcr_enc = V4L2_YCBCR_ENC_709;\n\t\t\t\tc.xfer_func = V4L2_XFER_FUNC_709;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\t \n\t\tbreak;\n\t}\n\treturn c;\n}\nEXPORT_SYMBOL_GPL(v4l2_hdmi_rx_colorimetry);\n\n \nu16 v4l2_get_edid_phys_addr(const u8 *edid, unsigned int size,\n\t\t\t    unsigned int *offset)\n{\n\tunsigned int loc = cec_get_edid_spa_location(edid, size);\n\n\tif (offset)\n\t\t*offset = loc;\n\tif (loc == 0)\n\t\treturn CEC_PHYS_ADDR_INVALID;\n\treturn (edid[loc] << 8) | edid[loc + 1];\n}\nEXPORT_SYMBOL_GPL(v4l2_get_edid_phys_addr);\n\n \nvoid v4l2_set_edid_phys_addr(u8 *edid, unsigned int size, u16 phys_addr)\n{\n\tunsigned int loc = cec_get_edid_spa_location(edid, size);\n\tu8 sum = 0;\n\tunsigned int i;\n\n\tif (loc == 0)\n\t\treturn;\n\tedid[loc] = phys_addr >> 8;\n\tedid[loc + 1] = phys_addr & 0xff;\n\tloc &= ~0x7f;\n\n\t \n\tfor (i = loc; i < loc + 127; i++)\n\t\tsum += edid[i];\n\tedid[i] = 256 - sum;\n}\nEXPORT_SYMBOL_GPL(v4l2_set_edid_phys_addr);\n\n \nu16 v4l2_phys_addr_for_input(u16 phys_addr, u8 input)\n{\n\t \n\tif (WARN_ON(input == 0 || input > 0xf))\n\t\treturn CEC_PHYS_ADDR_INVALID;\n\n\tif (phys_addr == 0)\n\t\treturn input << 12;\n\n\tif ((phys_addr & 0x0fff) == 0)\n\t\treturn phys_addr | (input << 8);\n\n\tif ((phys_addr & 0x00ff) == 0)\n\t\treturn phys_addr | (input << 4);\n\n\tif ((phys_addr & 0x000f) == 0)\n\t\treturn phys_addr | input;\n\n\t \n\treturn CEC_PHYS_ADDR_INVALID;\n}\nEXPORT_SYMBOL_GPL(v4l2_phys_addr_for_input);\n\n \nint v4l2_phys_addr_validate(u16 phys_addr, u16 *parent, u16 *port)\n{\n\tint i;\n\n\tif (parent)\n\t\t*parent = phys_addr;\n\tif (port)\n\t\t*port = 0;\n\tif (phys_addr == CEC_PHYS_ADDR_INVALID)\n\t\treturn 0;\n\tfor (i = 0; i < 16; i += 4)\n\t\tif (phys_addr & (0xf << i))\n\t\t\tbreak;\n\tif (i == 16)\n\t\treturn 0;\n\tif (parent)\n\t\t*parent = phys_addr & (0xfff0 << i);\n\tif (port)\n\t\t*port = (phys_addr >> i) & 0xf;\n\tfor (i += 4; i < 16; i += 4)\n\t\tif ((phys_addr & (0xf << i)) == 0)\n\t\t\treturn -EINVAL;\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(v4l2_phys_addr_validate);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}