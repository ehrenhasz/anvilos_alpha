{
  "module_name": "au0828-cards.c",
  "hash_id": "8eb2a8f7a5dbd095e781bdc956f45d3e793683c54e485669b147e1a1899fcef6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/au0828/au0828-cards.c",
  "human_readable_source": "\n \n\n#include \"au0828.h\"\n#include \"au0828-cards.h\"\n#include \"au8522.h\"\n#include \"media/tuner.h\"\n#include \"media/v4l2-common.h\"\n\nstatic void hvr950q_cs5340_audio(void *priv, int enable)\n{\n\t \n\tstruct au0828_dev *dev = priv;\n\tif (enable == 1)\n\t\tau0828_set(dev, REG_000, 0x10);\n\telse\n\t\tau0828_clear(dev, REG_000, 0x10);\n}\n\n \nstruct au0828_board au0828_boards[] = {\n\t[AU0828_BOARD_UNKNOWN] = {\n\t\t.name\t= \"Unknown board\",\n\t\t.tuner_type = -1U,\n\t\t.tuner_addr = ADDR_UNSET,\n\t},\n\t[AU0828_BOARD_HAUPPAUGE_HVR850] = {\n\t\t.name\t= \"Hauppauge HVR850\",\n\t\t.tuner_type = TUNER_XC5000,\n\t\t.tuner_addr = 0x61,\n\t\t.has_ir_i2c = 1,\n\t\t.has_analog = 1,\n\t\t.i2c_clk_divider = AU0828_I2C_CLK_250KHZ,\n\t\t.input = {\n\t\t\t{\n\t\t\t\t.type = AU0828_VMUX_TELEVISION,\n\t\t\t\t.vmux = AU8522_COMPOSITE_CH4_SIF,\n\t\t\t\t.amux = AU8522_AUDIO_SIF,\n\t\t\t},\n\t\t\t{\n\t\t\t\t.type = AU0828_VMUX_COMPOSITE,\n\t\t\t\t.vmux = AU8522_COMPOSITE_CH1,\n\t\t\t\t.amux = AU8522_AUDIO_NONE,\n\t\t\t\t.audio_setup = hvr950q_cs5340_audio,\n\t\t\t},\n\t\t\t{\n\t\t\t\t.type = AU0828_VMUX_SVIDEO,\n\t\t\t\t.vmux = AU8522_SVIDEO_CH13,\n\t\t\t\t.amux = AU8522_AUDIO_NONE,\n\t\t\t\t.audio_setup = hvr950q_cs5340_audio,\n\t\t\t},\n\t\t},\n\t},\n\t[AU0828_BOARD_HAUPPAUGE_HVR950Q] = {\n\t\t.name\t= \"Hauppauge HVR950Q\",\n\t\t.tuner_type = TUNER_XC5000,\n\t\t.tuner_addr = 0x61,\n\t\t.has_ir_i2c = 1,\n\t\t.has_analog = 1,\n\t\t.i2c_clk_divider = AU0828_I2C_CLK_250KHZ,\n\t\t.input = {\n\t\t\t{\n\t\t\t\t.type = AU0828_VMUX_TELEVISION,\n\t\t\t\t.vmux = AU8522_COMPOSITE_CH4_SIF,\n\t\t\t\t.amux = AU8522_AUDIO_SIF,\n\t\t\t},\n\t\t\t{\n\t\t\t\t.type = AU0828_VMUX_COMPOSITE,\n\t\t\t\t.vmux = AU8522_COMPOSITE_CH1,\n\t\t\t\t.amux = AU8522_AUDIO_NONE,\n\t\t\t\t.audio_setup = hvr950q_cs5340_audio,\n\t\t\t},\n\t\t\t{\n\t\t\t\t.type = AU0828_VMUX_SVIDEO,\n\t\t\t\t.vmux = AU8522_SVIDEO_CH13,\n\t\t\t\t.amux = AU8522_AUDIO_NONE,\n\t\t\t\t.audio_setup = hvr950q_cs5340_audio,\n\t\t\t},\n\t\t},\n\t},\n\t[AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL] = {\n\t\t.name\t= \"Hauppauge HVR950Q rev xxF8\",\n\t\t.tuner_type = TUNER_XC5000,\n\t\t.tuner_addr = 0x61,\n\t\t.i2c_clk_divider = AU0828_I2C_CLK_250KHZ,\n\t},\n\t[AU0828_BOARD_DVICO_FUSIONHDTV7] = {\n\t\t.name\t= \"DViCO FusionHDTV USB\",\n\t\t.tuner_type = TUNER_XC5000,\n\t\t.tuner_addr = 0x61,\n\t\t.i2c_clk_divider = AU0828_I2C_CLK_250KHZ,\n\t},\n\t[AU0828_BOARD_HAUPPAUGE_WOODBURY] = {\n\t\t.name = \"Hauppauge Woodbury\",\n\t\t.tuner_type = TUNER_NXP_TDA18271,\n\t\t.tuner_addr = 0x60,\n\t\t.i2c_clk_divider = AU0828_I2C_CLK_250KHZ,\n\t},\n};\n\n \nint au0828_tuner_callback(void *priv, int component, int command, int arg)\n{\n\tstruct au0828_dev *dev = priv;\n\n\tdprintk(1, \"%s()\\n\", __func__);\n\n\tswitch (dev->boardnr) {\n\tcase AU0828_BOARD_HAUPPAUGE_HVR850:\n\tcase AU0828_BOARD_HAUPPAUGE_HVR950Q:\n\tcase AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL:\n\tcase AU0828_BOARD_DVICO_FUSIONHDTV7:\n\t\tif (command == 0) {\n\t\t\t \n\t\t\t \n\t\t\tau0828_clear(dev, REG_001, 2);\n\t\t\tmdelay(10);\n\t\t\tau0828_set(dev, REG_001, 2);\n\t\t\tmdelay(10);\n\t\t\treturn 0;\n\t\t} else {\n\t\t\tpr_err(\"%s(): Unknown command.\\n\", __func__);\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn 0;  \n}\n\nstatic void hauppauge_eeprom(struct au0828_dev *dev, u8 *eeprom_data)\n{\n\tstruct tveeprom tv;\n\n\ttveeprom_hauppauge_analog(&tv, eeprom_data);\n\tdev->board.tuner_type = tv.tuner_type;\n\n\t \n\tswitch (tv.model) {\n\tcase 72000:  \n\tcase 72001:  \n\tcase 72101:  \n\tcase 72201:  \n\tcase 72211:  \n\tcase 72221:  \n\tcase 72231:  \n\tcase 72241:  \n\tcase 72251:  \n\tcase 72261:  \n\tcase 72271:  \n\tcase 72281:  \n\tcase 72301:  \n\tcase 72500:  \n\t\tbreak;\n\tdefault:\n\t\tpr_warn(\"%s: warning: unknown hauppauge model #%d\\n\",\n\t\t\t__func__, tv.model);\n\t\tbreak;\n\t}\n\n\tpr_info(\"%s: hauppauge eeprom: model=%d\\n\",\n\t       __func__, tv.model);\n}\n\nvoid au0828_card_analog_fe_setup(struct au0828_dev *dev);\n\nvoid au0828_card_setup(struct au0828_dev *dev)\n{\n\tstatic u8 eeprom[256];\n\n\tdprintk(1, \"%s()\\n\", __func__);\n\n\tif (dev->i2c_rc == 0) {\n\t\tdev->i2c_client.addr = 0xa0 >> 1;\n\t\ttveeprom_read(&dev->i2c_client, eeprom, sizeof(eeprom));\n\t}\n\n\tswitch (dev->boardnr) {\n\tcase AU0828_BOARD_HAUPPAUGE_HVR850:\n\tcase AU0828_BOARD_HAUPPAUGE_HVR950Q:\n\tcase AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL:\n\tcase AU0828_BOARD_HAUPPAUGE_WOODBURY:\n\t\tif (dev->i2c_rc == 0)\n\t\t\thauppauge_eeprom(dev, eeprom+0xa0);\n\t\tbreak;\n\t}\n\n\tau0828_card_analog_fe_setup(dev);\n}\n\nvoid au0828_card_analog_fe_setup(struct au0828_dev *dev)\n{\n#ifdef CONFIG_VIDEO_AU0828_V4L2\n\tstruct tuner_setup tun_setup;\n\tstruct v4l2_subdev *sd;\n\tunsigned int mode_mask = T_ANALOG_TV;\n\n\tif (AUVI_INPUT(0).type != AU0828_VMUX_UNDEFINED) {\n\t\t \n\t\tsd = v4l2_i2c_new_subdev(&dev->v4l2_dev, &dev->i2c_adap,\n\t\t\t\t\"au8522\", 0x8e >> 1, NULL);\n\t\tif (sd == NULL)\n\t\t\tpr_err(\"analog subdev registration failed\\n\");\n\t}\n\n\t \n\tif (dev->board.tuner_type != TUNER_ABSENT && dev->board.has_analog) {\n\t\t \n\t\tsd = v4l2_i2c_new_subdev(&dev->v4l2_dev, &dev->i2c_adap,\n\t\t\t\t\"tuner\", dev->board.tuner_addr, NULL);\n\t\tif (sd == NULL)\n\t\t\tpr_err(\"tuner subdev registration fail\\n\");\n\n\t\ttun_setup.mode_mask      = mode_mask;\n\t\ttun_setup.type           = dev->board.tuner_type;\n\t\ttun_setup.addr           = dev->board.tuner_addr;\n\t\ttun_setup.tuner_callback = au0828_tuner_callback;\n\t\tv4l2_device_call_all(&dev->v4l2_dev, 0, tuner, s_type_addr,\n\t\t\t\t     &tun_setup);\n\t}\n#endif\n}\n\n \nvoid au0828_gpio_setup(struct au0828_dev *dev)\n{\n\tdprintk(1, \"%s()\\n\", __func__);\n\n\tswitch (dev->boardnr) {\n\tcase AU0828_BOARD_HAUPPAUGE_HVR850:\n\tcase AU0828_BOARD_HAUPPAUGE_HVR950Q:\n\tcase AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL:\n\tcase AU0828_BOARD_HAUPPAUGE_WOODBURY:\n\t\t \n\n\t\t \n\t\tau0828_write(dev, REG_003, 0x02);\n\t\tau0828_write(dev, REG_002, 0x80 | 0x20 | 0x10);\n\n\t\t \n\t\tau0828_write(dev, REG_001, 0x0);\n\t\tau0828_write(dev, REG_000, 0x0);\n\t\tmsleep(50);\n\n\t\t \n\t\tau0828_write(dev, REG_000, 0x80);\n\t\tmsleep(50);\n\n\t\t \n\t\tau0828_write(dev, REG_001, 0x02);  \n\t\tau0828_write(dev, REG_000, 0x80 | 0x20);  \n\n\t\tmsleep(250);\n\t\tbreak;\n\tcase AU0828_BOARD_DVICO_FUSIONHDTV7:\n\t\t \n\n\t\t \n\t\tau0828_write(dev, REG_003, 0x02);\n\t\tau0828_write(dev, REG_002, 0xa0);\n\t\tau0828_write(dev, REG_001, 0x0);\n\t\tau0828_write(dev, REG_000, 0x0);\n\t\tmsleep(100);\n\n\t\t \n\t\tau0828_write(dev, REG_003, 0x02);\n\t\tau0828_write(dev, REG_002, 0xa0);\n\t\tau0828_write(dev, REG_001, 0x02);\n\t\tau0828_write(dev, REG_000, 0xa0);\n\t\tmsleep(250);\n\t\tbreak;\n\t}\n}\n\n \nstruct usb_device_id au0828_usb_id_table[] = {\n\t{ USB_DEVICE(0x2040, 0x7200),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x7240),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR850 },\n\t{ USB_DEVICE(0x0fe9, 0xd620),\n\t\t.driver_info = AU0828_BOARD_DVICO_FUSIONHDTV7 },\n\t{ USB_DEVICE(0x2040, 0x7210),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x7217),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x721b),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x721e),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x721f),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x7280),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x0fd9, 0x0008),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x7201),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL },\n\t{ USB_DEVICE(0x2040, 0x7211),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL },\n\t{ USB_DEVICE(0x2040, 0x7281),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q_MXL },\n\t{ USB_DEVICE(0x05e1, 0x0480),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_WOODBURY },\n\t{ USB_DEVICE(0x2040, 0x8200),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_WOODBURY },\n\t{ USB_DEVICE(0x2040, 0x7260),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x7213),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ USB_DEVICE(0x2040, 0x7270),\n\t\t.driver_info = AU0828_BOARD_HAUPPAUGE_HVR950Q },\n\t{ },\n};\n\nMODULE_DEVICE_TABLE(usb, au0828_usb_id_table);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}