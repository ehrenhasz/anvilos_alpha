{
  "module_name": "spca506.c",
  "hash_id": "d23bb0a5462b13f2ee912a14c90f03671e911af12f2bfea417868017c48ba572",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/gspca/spca506.c",
  "human_readable_source": "\n \n\n#define MODULE_NAME \"spca506\"\n\n#include \"gspca.h\"\n\nMODULE_AUTHOR(\"Michel Xhaard <mxhaard@users.sourceforge.net>\");\nMODULE_DESCRIPTION(\"GSPCA/SPCA506 USB Camera Driver\");\nMODULE_LICENSE(\"GPL\");\n\n \nstruct sd {\n\tstruct gspca_dev gspca_dev;\t \n\n\tchar norme;\n\tchar channel;\n};\n\nstatic const struct v4l2_pix_format vga_mode[] = {\n\t{160, 120, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 160,\n\t\t.sizeimage = 160 * 120 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 5},\n\t{176, 144, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 176,\n\t\t.sizeimage = 176 * 144 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 4},\n\t{320, 240, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 320,\n\t\t.sizeimage = 320 * 240 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 2},\n\t{352, 288, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 352,\n\t\t.sizeimage = 352 * 288 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 1},\n\t{640, 480, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 640,\n\t\t.sizeimage = 640 * 480 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 0},\n};\n\n#define SPCA50X_OFFSET_DATA 10\n\n#define SAA7113_bright 0x0a\t \n#define SAA7113_contrast 0x0b\t \n#define SAA7113_saturation 0x0c\t \n#define SAA7113_hue 0x0d\t \n#define SAA7113_I2C_BASE_WRITE 0x4a\n\n \nstatic void reg_r(struct gspca_dev *gspca_dev,\n\t\t  __u16 req,\n\t\t  __u16 index,\n\t\t  __u16 length)\n{\n\tusb_control_msg(gspca_dev->dev,\n\t\t\tusb_rcvctrlpipe(gspca_dev->dev, 0),\n\t\t\treq,\n\t\t\tUSB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_DEVICE,\n\t\t\t0,\t\t \n\t\t\tindex, gspca_dev->usb_buf, length,\n\t\t\t500);\n}\n\nstatic void reg_w(struct usb_device *dev,\n\t\t  __u16 req,\n\t\t  __u16 value,\n\t\t  __u16 index)\n{\n\tusb_control_msg(dev,\n\t\t\tusb_sndctrlpipe(dev, 0),\n\t\t\treq,\n\t\t\tUSB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_DEVICE,\n\t\t\tvalue, index,\n\t\t\tNULL, 0, 500);\n}\n\nstatic void spca506_Initi2c(struct gspca_dev *gspca_dev)\n{\n\treg_w(gspca_dev->dev, 0x07, SAA7113_I2C_BASE_WRITE, 0x0004);\n}\n\nstatic void spca506_WriteI2c(struct gspca_dev *gspca_dev, __u16 valeur,\n\t\t\t     __u16 reg)\n{\n\tint retry = 60;\n\n\treg_w(gspca_dev->dev, 0x07, reg, 0x0001);\n\treg_w(gspca_dev->dev, 0x07, valeur, 0x0000);\n\twhile (retry--) {\n\t\treg_r(gspca_dev, 0x07, 0x0003, 2);\n\t\tif ((gspca_dev->usb_buf[0] | gspca_dev->usb_buf[1]) == 0x00)\n\t\t\tbreak;\n\t}\n}\n\nstatic void spca506_SetNormeInput(struct gspca_dev *gspca_dev,\n\t\t\t\t __u16 norme,\n\t\t\t\t __u16 channel)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n \n\t__u8 setbit0 = 0x00;\n\t__u8 setbit1 = 0x00;\n\t__u8 videomask = 0x00;\n\n\tgspca_dbg(gspca_dev, D_STREAM, \"** Open Set Norme **\\n\");\n\tspca506_Initi2c(gspca_dev);\n\t \n\t \n\t \n\tif (norme & V4L2_STD_NTSC)\n\t\tsetbit0 = 0x01;\n\tif (channel == 4 || channel == 5 || channel > 9)\n\t\tchannel = 0;\n\tif (channel < 4)\n\t\tsetbit1 = 0x02;\n\tvideomask = (0x48 | setbit0 | setbit1);\n\treg_w(gspca_dev->dev, 0x08, videomask, 0x0000);\n\tspca506_WriteI2c(gspca_dev, (0xc0 | (channel & 0x0F)), 0x02);\n\n\tif (norme & V4L2_STD_NTSC)\n\t\tspca506_WriteI2c(gspca_dev, 0x33, 0x0e);\n\t\t\t\t\t \n\telse if (norme & V4L2_STD_SECAM)\n\t\tspca506_WriteI2c(gspca_dev, 0x53, 0x0e);\n\t\t\t\t\t \n\telse\n\t\tspca506_WriteI2c(gspca_dev, 0x03, 0x0e);\n\t\t\t\t\t \n\n\tsd->norme = norme;\n\tsd->channel = channel;\n\tgspca_dbg(gspca_dev, D_STREAM, \"Set Video Byte to 0x%2x\\n\", videomask);\n\tgspca_dbg(gspca_dev, D_STREAM, \"Set Norme: %08x Channel %d\",\n\t\t  norme, channel);\n}\n\nstatic void spca506_GetNormeInput(struct gspca_dev *gspca_dev,\n\t\t\t\t  __u16 *norme, __u16 *channel)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\n\t \n\t*norme = sd->norme;\n\t*channel = sd->channel;\n\tgspca_dbg(gspca_dev, D_STREAM, \"Get Norme: %d Channel %d\\n\",\n\t\t  *norme, *channel);\n}\n\nstatic void spca506_Setsize(struct gspca_dev *gspca_dev, __u16 code,\n\t\t\t    __u16 xmult, __u16 ymult)\n{\n\tstruct usb_device *dev = gspca_dev->dev;\n\n\tgspca_dbg(gspca_dev, D_STREAM, \"** SetSize **\\n\");\n\treg_w(dev, 0x04, (0x18 | (code & 0x07)), 0x0000);\n\t \n\treg_w(dev, 0x04, 0x41, 0x0001);\n\treg_w(dev, 0x04, 0x00, 0x0002);\n\t \n\treg_w(dev, 0x04, 0x00, 0x0003);\n\n\t \n\treg_w(dev, 0x04, 0x00, 0x0004);\n\t \n\treg_w(dev, 0x04, 0x01, 0x0005);\n\t \n\treg_w(dev, 0x04, xmult, 0x0006);\n\t \n\treg_w(dev, 0x04, ymult, 0x0007);\n\t \n\treg_w(dev, 0x04, 0x00, 0x0008);\n\t \n\treg_w(dev, 0x04, 0x00, 0x0009);\n\t \n\treg_w(dev, 0x04, 0x21, 0x000a);\n\t \n\treg_w(dev, 0x04, 0x00, 0x000b);\n}\n\n \nstatic int sd_config(struct gspca_dev *gspca_dev,\n\t\t\tconst struct usb_device_id *id)\n{\n\tstruct cam *cam;\n\n\tcam = &gspca_dev->cam;\n\tcam->cam_mode = vga_mode;\n\tcam->nmodes = ARRAY_SIZE(vga_mode);\n\treturn 0;\n}\n\n \nstatic int sd_init(struct gspca_dev *gspca_dev)\n{\n\tstruct usb_device *dev = gspca_dev->dev;\n\n\treg_w(dev, 0x03, 0x00, 0x0004);\n\treg_w(dev, 0x03, 0xFF, 0x0003);\n\treg_w(dev, 0x03, 0x00, 0x0000);\n\treg_w(dev, 0x03, 0x1c, 0x0001);\n\treg_w(dev, 0x03, 0x18, 0x0001);\n\t \n\tspca506_SetNormeInput(gspca_dev, 0, 0);\n\treg_w(dev, 0x03, 0x1c, 0x0001);\n\treg_w(dev, 0x03, 0x18, 0x0001);\n\treg_w(dev, 0x05, 0x00, 0x0000);\n\treg_w(dev, 0x05, 0xef, 0x0001);\n\treg_w(dev, 0x05, 0x00, 0x00c1);\n\treg_w(dev, 0x05, 0x00, 0x00c2);\n\treg_w(dev, 0x06, 0x18, 0x0002);\n\treg_w(dev, 0x06, 0xf5, 0x0011);\n\treg_w(dev, 0x06, 0x02, 0x0012);\n\treg_w(dev, 0x06, 0xfb, 0x0013);\n\treg_w(dev, 0x06, 0x00, 0x0014);\n\treg_w(dev, 0x06, 0xa4, 0x0051);\n\treg_w(dev, 0x06, 0x40, 0x0052);\n\treg_w(dev, 0x06, 0x71, 0x0053);\n\treg_w(dev, 0x06, 0x40, 0x0054);\n\t \n\treg_w(dev, 0x03, 0x00, 0x0004);\n\treg_w(dev, 0x03, 0x00, 0x0003);\n\treg_w(dev, 0x03, 0x00, 0x0004);\n\treg_w(dev, 0x03, 0xFF, 0x0003);\n\treg_w(dev, 0x02, 0x00, 0x0000);\n\treg_w(dev, 0x03, 0x60, 0x0000);\n\treg_w(dev, 0x03, 0x18, 0x0001);\n\t \n\t \n\tspca506_Initi2c(gspca_dev);\n\tspca506_WriteI2c(gspca_dev, 0x08, 0x01);\n\tspca506_WriteI2c(gspca_dev, 0xc0, 0x02);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x33, 0x03);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x04);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x05);\n\tspca506_WriteI2c(gspca_dev, 0x0d, 0x06);\n\tspca506_WriteI2c(gspca_dev, 0xf0, 0x07);\n\tspca506_WriteI2c(gspca_dev, 0x98, 0x08);\n\tspca506_WriteI2c(gspca_dev, 0x03, 0x09);\n\tspca506_WriteI2c(gspca_dev, 0x80, 0x0a);\n\tspca506_WriteI2c(gspca_dev, 0x47, 0x0b);\n\tspca506_WriteI2c(gspca_dev, 0x48, 0x0c);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x0d);\n\tspca506_WriteI2c(gspca_dev, 0x03, 0x0e);\t \n\tspca506_WriteI2c(gspca_dev, 0x2a, 0x0f);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x10);\n\tspca506_WriteI2c(gspca_dev, 0x0c, 0x11);\n\tspca506_WriteI2c(gspca_dev, 0xb8, 0x12);\n\tspca506_WriteI2c(gspca_dev, 0x01, 0x13);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x14);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x15);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x16);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x17);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x18);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x19);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1a);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1b);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1c);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1d);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1e);\n\tspca506_WriteI2c(gspca_dev, 0xa1, 0x1f);\n\tspca506_WriteI2c(gspca_dev, 0x02, 0x40);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x41);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x42);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x43);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x44);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x45);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x46);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x47);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x48);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x49);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4a);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4b);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4c);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4d);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4e);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4f);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x50);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x51);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x52);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x53);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x54);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x55);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x56);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x57);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x58);\n\tspca506_WriteI2c(gspca_dev, 0x54, 0x59);\n\tspca506_WriteI2c(gspca_dev, 0x07, 0x5a);\n\tspca506_WriteI2c(gspca_dev, 0x83, 0x5b);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5c);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5d);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5e);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5f);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x60);\n\tspca506_WriteI2c(gspca_dev, 0x05, 0x61);\n\tspca506_WriteI2c(gspca_dev, 0x9f, 0x62);\n\tgspca_dbg(gspca_dev, D_STREAM, \"** Close Init *\\n\");\n\treturn 0;\n}\n\nstatic int sd_start(struct gspca_dev *gspca_dev)\n{\n\tstruct usb_device *dev = gspca_dev->dev;\n\t__u16 norme;\n\t__u16 channel;\n\n\t \n\treg_w(dev, 0x03, 0x00, 0x0004);\n\treg_w(dev, 0x03, 0x00, 0x0003);\n\treg_w(dev, 0x03, 0x00, 0x0004);\n\treg_w(dev, 0x03, 0xFF, 0x0003);\n\treg_w(dev, 0x02, 0x00, 0x0000);\n\treg_w(dev, 0x03, 0x60, 0x0000);\n\treg_w(dev, 0x03, 0x18, 0x0001);\n\n\t \n\tspca506_Initi2c(gspca_dev);\n\tspca506_WriteI2c(gspca_dev, 0x08, 0x01);\t \n \n\tspca506_WriteI2c(gspca_dev, 0x33, 0x03);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x04);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x05);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x0d, 0x06);\n\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0xf0, 0x07);\n\t\t\t\t\t \n\n\tspca506_WriteI2c(gspca_dev, 0x98, 0x08);\t \n \n\tspca506_WriteI2c(gspca_dev, 0x03, 0x09);\t \n\tspca506_WriteI2c(gspca_dev, 0x80, 0x0a);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x47, 0x0b);\t \n\tspca506_WriteI2c(gspca_dev, 0x48, 0x0c);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x0d);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x2a, 0x0f);\n\t\t\t\t\t\t \n\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x10);\n\t\t\t\t\t\t \n\tspca506_WriteI2c(gspca_dev, 0x0c, 0x11);\t \n\tspca506_WriteI2c(gspca_dev, 0xb8, 0x12);\t \n\tspca506_WriteI2c(gspca_dev, 0x01, 0x13);\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x14);\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x15);\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x16);\t \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x17);     \n\tspca506_WriteI2c(gspca_dev, 0x00, 0x18);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x19);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1a);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1b);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1c);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1d);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x1e);\n\tspca506_WriteI2c(gspca_dev, 0xa1, 0x1f);\n\tspca506_WriteI2c(gspca_dev, 0x02, 0x40);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x41);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x42);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x43);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x44);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x45);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x46);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x47);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x48);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x49);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4a);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4b);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4c);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4d);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4e);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x4f);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x50);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x51);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x52);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x53);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x54);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x55);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x56);\n\tspca506_WriteI2c(gspca_dev, 0xff, 0x57);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x58);\n\tspca506_WriteI2c(gspca_dev, 0x54, 0x59);\n\tspca506_WriteI2c(gspca_dev, 0x07, 0x5a);\n\tspca506_WriteI2c(gspca_dev, 0x83, 0x5b);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5c);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5d);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5e);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x5f);\n\tspca506_WriteI2c(gspca_dev, 0x00, 0x60);\n\tspca506_WriteI2c(gspca_dev, 0x05, 0x61);\n\tspca506_WriteI2c(gspca_dev, 0x9f, 0x62);\n\t \n\treg_w(dev, 0x05, 0x00, 0x0003);\n\treg_w(dev, 0x05, 0x00, 0x0004);\n\treg_w(dev, 0x03, 0x10, 0x0001);\n\treg_w(dev, 0x03, 0x78, 0x0000);\n\tswitch (gspca_dev->cam.cam_mode[(int) gspca_dev->curr_mode].priv) {\n\tcase 0:\n\t\tspca506_Setsize(gspca_dev, 0, 0x10, 0x10);\n\t\tbreak;\n\tcase 1:\n\t\tspca506_Setsize(gspca_dev, 1, 0x1a, 0x1a);\n\t\tbreak;\n\tcase 2:\n\t\tspca506_Setsize(gspca_dev, 2, 0x1c, 0x1c);\n\t\tbreak;\n\tcase 4:\n\t\tspca506_Setsize(gspca_dev, 4, 0x34, 0x34);\n\t\tbreak;\n\tdefault:\n \n\t\tspca506_Setsize(gspca_dev, 5, 0x40, 0x40);\n\t\tbreak;\n\t}\n\n\t \n\t \n\treg_w(dev, 0x02, 0x01, 0x0000);\n\treg_w(dev, 0x03, 0x12, 0x0000);\n\treg_r(gspca_dev, 0x04, 0x0001, 2);\n\tgspca_dbg(gspca_dev, D_STREAM, \"webcam started\\n\");\n\tspca506_GetNormeInput(gspca_dev, &norme, &channel);\n\tspca506_SetNormeInput(gspca_dev, norme, channel);\n\treturn 0;\n}\n\nstatic void sd_stopN(struct gspca_dev *gspca_dev)\n{\n\tstruct usb_device *dev = gspca_dev->dev;\n\n\treg_w(dev, 0x02, 0x00, 0x0000);\n\treg_w(dev, 0x03, 0x00, 0x0004);\n\treg_w(dev, 0x03, 0x00, 0x0003);\n}\n\nstatic void sd_pkt_scan(struct gspca_dev *gspca_dev,\n\t\t\tu8 *data,\t\t\t \n\t\t\tint len)\t\t\t \n{\n\tswitch (data[0]) {\n\tcase 0:\t\t\t\t \n\t\tgspca_frame_add(gspca_dev, LAST_PACKET, NULL, 0);\n\t\tdata += SPCA50X_OFFSET_DATA;\n\t\tlen -= SPCA50X_OFFSET_DATA;\n\t\tgspca_frame_add(gspca_dev, FIRST_PACKET, data, len);\n\t\tbreak;\n\tcase 0xff:\t\t\t \n \n\t\tbreak;\n\tdefault:\n\t\tdata += 1;\n\t\tlen -= 1;\n\t\tgspca_frame_add(gspca_dev, INTER_PACKET, data, len);\n\t\tbreak;\n\t}\n}\n\nstatic void setbrightness(struct gspca_dev *gspca_dev, s32 val)\n{\n\tspca506_Initi2c(gspca_dev);\n\tspca506_WriteI2c(gspca_dev, val, SAA7113_bright);\n\tspca506_WriteI2c(gspca_dev, 0x01, 0x09);\n}\n\nstatic void setcontrast(struct gspca_dev *gspca_dev, s32 val)\n{\n\tspca506_Initi2c(gspca_dev);\n\tspca506_WriteI2c(gspca_dev, val, SAA7113_contrast);\n\tspca506_WriteI2c(gspca_dev, 0x01, 0x09);\n}\n\nstatic void setcolors(struct gspca_dev *gspca_dev, s32 val)\n{\n\tspca506_Initi2c(gspca_dev);\n\tspca506_WriteI2c(gspca_dev, val, SAA7113_saturation);\n\tspca506_WriteI2c(gspca_dev, 0x01, 0x09);\n}\n\nstatic void sethue(struct gspca_dev *gspca_dev, s32 val)\n{\n\tspca506_Initi2c(gspca_dev);\n\tspca506_WriteI2c(gspca_dev, val, SAA7113_hue);\n\tspca506_WriteI2c(gspca_dev, 0x01, 0x09);\n}\n\nstatic int sd_s_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct gspca_dev *gspca_dev =\n\t\tcontainer_of(ctrl->handler, struct gspca_dev, ctrl_handler);\n\n\tgspca_dev->usb_err = 0;\n\n\tif (!gspca_dev->streaming)\n\t\treturn 0;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_BRIGHTNESS:\n\t\tsetbrightness(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_CONTRAST:\n\t\tsetcontrast(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_SATURATION:\n\t\tsetcolors(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_HUE:\n\t\tsethue(gspca_dev, ctrl->val);\n\t\tbreak;\n\t}\n\treturn gspca_dev->usb_err;\n}\n\nstatic const struct v4l2_ctrl_ops sd_ctrl_ops = {\n\t.s_ctrl = sd_s_ctrl,\n};\n\nstatic int sd_init_controls(struct gspca_dev *gspca_dev)\n{\n\tstruct v4l2_ctrl_handler *hdl = &gspca_dev->ctrl_handler;\n\n\tgspca_dev->vdev.ctrl_handler = hdl;\n\tv4l2_ctrl_handler_init(hdl, 4);\n\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_BRIGHTNESS, 0, 255, 1, 128);\n\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_CONTRAST, 0, 255, 1, 0x47);\n\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_SATURATION, 0, 255, 1, 0x40);\n\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_HUE, 0, 255, 1, 0);\n\n\tif (hdl->error) {\n\t\tpr_err(\"Could not initialize controls\\n\");\n\t\treturn hdl->error;\n\t}\n\treturn 0;\n}\n\n \nstatic const struct sd_desc sd_desc = {\n\t.name = MODULE_NAME,\n\t.config = sd_config,\n\t.init = sd_init,\n\t.init_controls = sd_init_controls,\n\t.start = sd_start,\n\t.stopN = sd_stopN,\n\t.pkt_scan = sd_pkt_scan,\n};\n\n \nstatic const struct usb_device_id device_table[] = {\n\t{USB_DEVICE(0x06e1, 0xa190)},\n \n\t{USB_DEVICE(0x0734, 0x043b)},\n\t{USB_DEVICE(0x99fa, 0x8988)},\n\t{}\n};\nMODULE_DEVICE_TABLE(usb, device_table);\n\n \nstatic int sd_probe(struct usb_interface *intf, const struct usb_device_id *id)\n{\n\treturn gspca_dev_probe(intf, id, &sd_desc, sizeof(struct sd),\n\t\t\t\tTHIS_MODULE);\n}\n\nstatic struct usb_driver sd_driver = {\n\t.name = MODULE_NAME,\n\t.id_table = device_table,\n\t.probe = sd_probe,\n\t.disconnect = gspca_disconnect,\n#ifdef CONFIG_PM\n\t.suspend = gspca_suspend,\n\t.resume = gspca_resume,\n\t.reset_resume = gspca_resume,\n#endif\n};\n\nmodule_usb_driver(sd_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}