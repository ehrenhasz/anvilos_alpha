{
  "module_name": "sn9c2028.c",
  "hash_id": "e754a1fd80749e5834e7250c7a1b680ce960602c6ea5eb3fe6b33a338aacce93",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/gspca/sn9c2028.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#define MODULE_NAME \"sn9c2028\"\n\n#include \"gspca.h\"\n\nMODULE_AUTHOR(\"Theodore Kilgore\");\nMODULE_DESCRIPTION(\"Sonix SN9C2028 USB Camera Driver\");\nMODULE_LICENSE(\"GPL\");\n\n \nstruct sd {\n\tstruct gspca_dev gspca_dev;   \n\tu8 sof_read;\n\tu16 model;\n\n#define MIN_AVG_LUM 8500\n#define MAX_AVG_LUM 10000\n\tint avg_lum;\n\tu8 avg_lum_l;\n\n\tstruct {  \n\t\tstruct v4l2_ctrl *autogain;\n\t\tstruct v4l2_ctrl *gain;\n\t};\n};\n\nstruct init_command {\n\tunsigned char instruction[6];\n\tunsigned char to_read;  \n};\n\n \nstatic const struct v4l2_pix_format vga_mode[] = {\n\t{640, 480, V4L2_PIX_FMT_SN9C2028, V4L2_FIELD_NONE,\n\t\t.bytesperline = 640,\n\t\t.sizeimage = 640 * 480 * 3 / 4,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 0},\n};\n\n \nstatic const struct v4l2_pix_format cif_mode[] = {\n\t{352, 288, V4L2_PIX_FMT_SN9C2028, V4L2_FIELD_NONE,\n\t\t.bytesperline = 352,\n\t\t.sizeimage = 352 * 288 * 3 / 4,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 0},\n};\n\n \nstatic int sn9c2028_command(struct gspca_dev *gspca_dev, u8 *command)\n{\n\tint rc;\n\n\tgspca_dbg(gspca_dev, D_USBO, \"sending command %02x%02x%02x%02x%02x%02x\\n\",\n\t\t  command[0], command[1], command[2],\n\t\t  command[3], command[4], command[5]);\n\n\tmemcpy(gspca_dev->usb_buf, command, 6);\n\trc = usb_control_msg(gspca_dev->dev,\n\t\t\tusb_sndctrlpipe(gspca_dev->dev, 0),\n\t\t\tUSB_REQ_GET_CONFIGURATION,\n\t\t\tUSB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_INTERFACE,\n\t\t\t2, 0, gspca_dev->usb_buf, 6, 500);\n\tif (rc < 0) {\n\t\tpr_err(\"command write [%02x] error %d\\n\",\n\t\t       gspca_dev->usb_buf[0], rc);\n\t\treturn rc;\n\t}\n\n\treturn 0;\n}\n\nstatic int sn9c2028_read1(struct gspca_dev *gspca_dev)\n{\n\tint rc;\n\n\trc = usb_control_msg(gspca_dev->dev,\n\t\t\tusb_rcvctrlpipe(gspca_dev->dev, 0),\n\t\t\tUSB_REQ_GET_STATUS,\n\t\t\tUSB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_INTERFACE,\n\t\t\t1, 0, gspca_dev->usb_buf, 1, 500);\n\tif (rc != 1) {\n\t\tpr_err(\"read1 error %d\\n\", rc);\n\t\treturn (rc < 0) ? rc : -EIO;\n\t}\n\tgspca_dbg(gspca_dev, D_USBI, \"read1 response %02x\\n\",\n\t\t  gspca_dev->usb_buf[0]);\n\treturn gspca_dev->usb_buf[0];\n}\n\nstatic int sn9c2028_read4(struct gspca_dev *gspca_dev, u8 *reading)\n{\n\tint rc;\n\trc = usb_control_msg(gspca_dev->dev,\n\t\t\tusb_rcvctrlpipe(gspca_dev->dev, 0),\n\t\t\tUSB_REQ_GET_STATUS,\n\t\t\tUSB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_INTERFACE,\n\t\t\t4, 0, gspca_dev->usb_buf, 4, 500);\n\tif (rc != 4) {\n\t\tpr_err(\"read4 error %d\\n\", rc);\n\t\treturn (rc < 0) ? rc : -EIO;\n\t}\n\tmemcpy(reading, gspca_dev->usb_buf, 4);\n\tgspca_dbg(gspca_dev, D_USBI, \"read4 response %02x%02x%02x%02x\\n\",\n\t\t  reading[0], reading[1], reading[2], reading[3]);\n\treturn rc;\n}\n\nstatic int sn9c2028_long_command(struct gspca_dev *gspca_dev, u8 *command)\n{\n\tint i, status;\n\t__u8 reading[4];\n\n\tstatus = sn9c2028_command(gspca_dev, command);\n\tif (status < 0)\n\t\treturn status;\n\n\tstatus = -1;\n\tfor (i = 0; i < 256 && status < 2; i++)\n\t\tstatus = sn9c2028_read1(gspca_dev);\n\tif (status < 0) {\n\t\tpr_err(\"long command status read error %d\\n\", status);\n\t\treturn status;\n\t}\n\n\tmemset(reading, 0, 4);\n\tstatus = sn9c2028_read4(gspca_dev, reading);\n\tif (status < 0)\n\t\treturn status;\n\n\t \n\tstatus = sn9c2028_read1(gspca_dev);\n\tif (status < 0)\n\t\treturn status;\n\n\treturn 0;\n}\n\nstatic int sn9c2028_short_command(struct gspca_dev *gspca_dev, u8 *command)\n{\n\tint err_code;\n\n\terr_code = sn9c2028_command(gspca_dev, command);\n\tif (err_code < 0)\n\t\treturn err_code;\n\n\terr_code = sn9c2028_read1(gspca_dev);\n\tif (err_code < 0)\n\t\treturn err_code;\n\n\treturn 0;\n}\n\n \nstatic int sd_config(struct gspca_dev *gspca_dev,\n\t\t     const struct usb_device_id *id)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\tstruct cam *cam = &gspca_dev->cam;\n\n\tgspca_dbg(gspca_dev, D_PROBE, \"SN9C2028 camera detected (vid/pid 0x%04X:0x%04X)\\n\",\n\t\t  id->idVendor, id->idProduct);\n\n\tsd->model = id->idProduct;\n\n\tswitch (sd->model) {\n\tcase 0x7005:\n\t\tgspca_dbg(gspca_dev, D_PROBE, \"Genius Smart 300 camera\\n\");\n\t\tbreak;\n\tcase 0x7003:\n\t\tgspca_dbg(gspca_dev, D_PROBE, \"Genius Videocam Live v2\\n\");\n\t\tbreak;\n\tcase 0x8000:\n\t\tgspca_dbg(gspca_dev, D_PROBE, \"DC31VC\\n\");\n\t\tbreak;\n\tcase 0x8001:\n\t\tgspca_dbg(gspca_dev, D_PROBE, \"Spy camera\\n\");\n\t\tbreak;\n\tcase 0x8003:\n\t\tgspca_dbg(gspca_dev, D_PROBE, \"CIF camera\\n\");\n\t\tbreak;\n\tcase 0x8008:\n\t\tgspca_dbg(gspca_dev, D_PROBE, \"Mini-Shotz ms-350 camera\\n\");\n\t\tbreak;\n\tcase 0x800a:\n\t\tgspca_dbg(gspca_dev, D_PROBE, \"Vivitar 3350b type camera\\n\");\n\t\tcam->input_flags = V4L2_IN_ST_VFLIP | V4L2_IN_ST_HFLIP;\n\t\tbreak;\n\t}\n\n\tswitch (sd->model) {\n\tcase 0x8000:\n\tcase 0x8001:\n\tcase 0x8003:\n\t\tcam->cam_mode = cif_mode;\n\t\tcam->nmodes = ARRAY_SIZE(cif_mode);\n\t\tbreak;\n\tdefault:\n\t\tcam->cam_mode = vga_mode;\n\t\tcam->nmodes = ARRAY_SIZE(vga_mode);\n\t}\n\treturn 0;\n}\n\n \nstatic int sd_init(struct gspca_dev *gspca_dev)\n{\n\tint status;\n\n\tsn9c2028_read1(gspca_dev);\n\tsn9c2028_read1(gspca_dev);\n\tstatus = sn9c2028_read1(gspca_dev);\n\n\treturn (status < 0) ? status : 0;\n}\n\nstatic int run_start_commands(struct gspca_dev *gspca_dev,\n\t\t\t      struct init_command *cam_commands, int n)\n{\n\tint i, err_code = -1;\n\n\tfor (i = 0; i < n; i++) {\n\t\tswitch (cam_commands[i].to_read) {\n\t\tcase 4:\n\t\t\terr_code = sn9c2028_long_command(gspca_dev,\n\t\t\t\t\tcam_commands[i].instruction);\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\terr_code = sn9c2028_short_command(gspca_dev,\n\t\t\t\t\tcam_commands[i].instruction);\n\t\t\tbreak;\n\t\tcase 0:\n\t\t\terr_code = sn9c2028_command(gspca_dev,\n\t\t\t\t\tcam_commands[i].instruction);\n\t\t\tbreak;\n\t\t}\n\t\tif (err_code < 0)\n\t\t\treturn err_code;\n\t}\n\treturn 0;\n}\n\nstatic void set_gain(struct gspca_dev *gspca_dev, s32 g)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\n\tstruct init_command genius_vcam_live_gain_cmds[] = {\n\t\t{{0x1d, 0x25, 0x10  ,\n\t\t  0x20, 0xab, 0x00}, 0},\n\t};\n\tif (!gspca_dev->streaming)\n\t\treturn;\n\n\tswitch (sd->model) {\n\tcase 0x7003:\n\t\tgenius_vcam_live_gain_cmds[0].instruction[2] = g;\n\t\trun_start_commands(gspca_dev, genius_vcam_live_gain_cmds,\n\t\t\t\t   ARRAY_SIZE(genius_vcam_live_gain_cmds));\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic int sd_s_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct gspca_dev *gspca_dev =\n\t\tcontainer_of(ctrl->handler, struct gspca_dev, ctrl_handler);\n\tstruct sd *sd = (struct sd *)gspca_dev;\n\n\tgspca_dev->usb_err = 0;\n\n\tif (!gspca_dev->streaming)\n\t\treturn 0;\n\n\tswitch (ctrl->id) {\n\t \n\tcase V4L2_CID_GAIN:\n\t\tset_gain(gspca_dev, ctrl->val);\n\t\tbreak;\n\t \n\tcase V4L2_CID_AUTOGAIN:\n\t\tset_gain(gspca_dev, sd->gain->val);\n\t\tbreak;\n\t}\n\treturn gspca_dev->usb_err;\n}\n\nstatic const struct v4l2_ctrl_ops sd_ctrl_ops = {\n\t.s_ctrl = sd_s_ctrl,\n};\n\n\nstatic int sd_init_controls(struct gspca_dev *gspca_dev)\n{\n\tstruct v4l2_ctrl_handler *hdl = &gspca_dev->ctrl_handler;\n\tstruct sd *sd = (struct sd *)gspca_dev;\n\n\tgspca_dev->vdev.ctrl_handler = hdl;\n\tv4l2_ctrl_handler_init(hdl, 2);\n\n\tswitch (sd->model) {\n\tcase 0x7003:\n\t\tsd->gain = v4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_GAIN, 0, 20, 1, 0);\n\t\tsd->autogain = v4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_AUTOGAIN, 0, 1, 1, 1);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\nstatic int start_spy_cam(struct gspca_dev *gspca_dev)\n{\n\tstruct init_command spy_start_commands[] = {\n\t\t{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x20, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x21, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x22, 0x01, 0x04, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x23, 0x01, 0x03, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x24, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},  \n\t\t{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},  \n\t\t \n\t\t{{0x13, 0x27, 0x01, 0x68, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x28, 0x01, 0x09, 0x00, 0x00}, 4},  \n\t\t \n\t\t{{0x13, 0x29, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x13, 0x2a, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2b, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x13, 0x2e, 0x01, 0x09, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x07, 0x00, 0x00}, 4},\n\t\t{{0x12, 0x34, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x34, 0x01, 0xa1, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x35, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x02, 0x06, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x03, 0x13, 0x00, 0x00, 0x00}, 4},  \n\t\t \n\t\t{{0x11, 0x04, 0x00, 0x00, 0x00, 0x00}, 4},  \n\t\t \n\t\t{{0x11, 0x05, 0x00, 0x00, 0x00, 0x00}, 4},  \n\t\t{{0x11, 0x06, 0xb1, 0x00, 0x00, 0x00}, 4},  \n\t\t{{0x11, 0x07, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x11, 0x08, 0x0b, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x09, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0a, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0b, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0c, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0d, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0e, 0x04, 0x00, 0x00, 0x00}, 4},\n\t\t \n\t\t \n\t\t{{0x11, 0x0f, 0x04, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x10, 0x06, 0x00, 0x00, 0x00}, 4},  \n\t\t{{0x11, 0x11, 0x06, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x14, 0x02, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x13, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x1b, 0x02, 0x11, 0x00, 0x00, 0x00}, 1},  \n\t\t \n\t\t{{0x1b, 0x13, 0x11, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 1},  \n\t\t \n\t};\n\n\treturn run_start_commands(gspca_dev, spy_start_commands,\n\t\t\t\t  ARRAY_SIZE(spy_start_commands));\n}\n\nstatic int start_cif_cam(struct gspca_dev *gspca_dev)\n{\n\tstruct init_command cif_start_commands[] = {\n\t\t{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t \n\t\t \n\t\t{{0x1b, 0x21, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x17, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x19, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x02, 0x06, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x03, 0x5a, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x04, 0x27, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x05, 0x01, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x12, 0x14, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x13, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x14, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x15, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x16, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x77, 0xa2, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x06, 0x0f, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x07, 0x14, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x08, 0x0f, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x09, 0x10, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x0e, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x0f, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x12, 0x07, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x10, 0x1f, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 1},  \n\t\t{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 1},  \n\t\t \n\t\t \n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x01, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x08, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x06, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x28, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x1b, 0x04, 0x6d, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x05, 0x03, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x36, 0x06, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x0e, 0x01, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x12, 0x27, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x1b, 0x0f, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x36, 0x05, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x10, 0x0f, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x02, 0x06, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 1}, \n\t\t \n\t};\n\n\treturn run_start_commands(gspca_dev, cif_start_commands,\n\t\t\t\t  ARRAY_SIZE(cif_start_commands));\n}\n\nstatic int start_ms350_cam(struct gspca_dev *gspca_dev)\n{\n\tstruct init_command ms350_start_commands[] = {\n\t\t{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x16, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x20, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x21, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x22, 0x01, 0x04, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x23, 0x01, 0x03, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x24, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x27, 0x01, 0x28, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x28, 0x01, 0x09, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x29, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2a, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2b, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\n\t\t{{0x12, 0x34, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x34, 0x01, 0xa1, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x35, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x00, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x01, 0x70, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x02, 0x05, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x03, 0x5d, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x04, 0x07, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x05, 0x25, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x06, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x07, 0x09, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x08, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x09, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0a, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0b, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0c, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0d, 0x0c, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0e, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x0f, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x11, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x13, 0x63, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x15, 0x70, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x18, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x11, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x28, 0x00, 0x00}, 4},  \n\t\t{{0x13, 0x26, 0x01, 0x1e, 0x00, 0x00}, 4},  \n\t\t{{0x13, 0x28, 0x01, 0x09, 0x00, 0x00}, 4},  \n\t\t{{0x13, 0x27, 0x01, 0x28, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x29, 0x01, 0x40, 0x00, 0x00}, 4},  \n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\n\t\t{{0x1b, 0x02, 0x05, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x18, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x02, 0x0a, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x11, 0x01, 0x00, 0x00, 0x00}, 0},\n\t\t \n\t};\n\n\treturn run_start_commands(gspca_dev, ms350_start_commands,\n\t\t\t\t  ARRAY_SIZE(ms350_start_commands));\n}\n\nstatic int start_genius_cam(struct gspca_dev *gspca_dev)\n{\n\tstruct init_command genius_start_commands[] = {\n\t\t{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x16, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x10, 0x00, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x13, 0x28, 0x01, 0x0e, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x29, 0x01, 0x22, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x09, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x07, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x21, 0x2d, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x23, 0x03, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x11, 0x64, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x13, 0x91, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x14, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x15, 0x20, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x16, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x17, 0x60, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x21, 0x2d, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x23, 0x03, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x25, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x26, 0x02, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x27, 0x88, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x30, 0x38, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x31, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x32, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x33, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x34, 0x02, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x5b, 0x0a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x28, 0x00, 0x00}, 4},  \n\t\t{{0x13, 0x26, 0x01, 0x1e, 0x00, 0x00}, 4},  \n\t\t{{0x13, 0x28, 0x01, 0x0e, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x29, 0x01, 0x62, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x21, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x23, 0x28, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x11, 0x04, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x13, 0x03, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x14, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x15, 0xe0, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x16, 0x02, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x17, 0x80, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x1c, 0x20, 0x00, 0x2a, 0x00, 0x00}, 1},\n\t\t{{0x1c, 0x20, 0x00, 0x2a, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 0}\n\t\t \n\t};\n\n\treturn run_start_commands(gspca_dev, genius_start_commands,\n\t\t\t\t  ARRAY_SIZE(genius_start_commands));\n}\n\nstatic int start_genius_videocam_live(struct gspca_dev *gspca_dev)\n{\n\tint r;\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\tstruct init_command genius_vcam_live_start_commands[] = {\n\t\t{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 0},\n\t\t{{0x16, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x10, 0x00, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},\n\n\t\t{{0x13, 0x28, 0x01, 0x0e, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x29, 0x01, 0x22, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x09, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x07, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x21, 0x2d, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x23, 0x03, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x11, 0x64, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x13, 0x91, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x14, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x15, 0x20, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x16, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x17, 0x60, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x1c, 0x20, 0x00, 0x2d, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x20, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x21, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x22, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x23, 0x01, 0x01, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x24, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x16, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x26, 0x01, 0x12, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x28, 0x01, 0x0e, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x29, 0x01, 0x22, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2a, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2b, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x09, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x07, 0x00, 0x00}, 4},\n\t\t{{0x12, 0x34, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x34, 0x01, 0xa1, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x35, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x01, 0x04, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x02, 0x92, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x11, 0x64, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x13, 0x91, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x14, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x15, 0x20, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x16, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x17, 0x60, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x21, 0x2d, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x23, 0x03, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x25, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x26, 0x02, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x27, 0x88, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x30, 0x38, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x31, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x32, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x33, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x34, 0x02, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x5b, 0x0a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x28, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x26, 0x01, 0x1e, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x28, 0x01, 0x0e, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x29, 0x01, 0x62, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x20, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x21, 0x2a, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x22, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x23, 0x28, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x10, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x11, 0x04, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x12, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x13, 0x03, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x14, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x15, 0xe0, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x16, 0x02, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x11, 0x17, 0x80, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x1c, 0x20, 0x00, 0x2a, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 0},\n\t\t \n\t\t{{0x12, 0x27, 0x01, 0x00, 0x00, 0x00}, 0},\n\t\t{{0x1b, 0x32, 0x26, 0x00, 0x00, 0x00}, 0},\n\t\t{{0x1d, 0x25, 0x10, 0x20, 0xab, 0x00}, 0},\n\t};\n\n\tr = run_start_commands(gspca_dev, genius_vcam_live_start_commands,\n\t\t\t\t  ARRAY_SIZE(genius_vcam_live_start_commands));\n\tif (r < 0)\n\t\treturn r;\n\n\tif (sd->gain)\n\t\tset_gain(gspca_dev, v4l2_ctrl_g_ctrl(sd->gain));\n\n\treturn r;\n}\n\nstatic int start_vivitar_cam(struct gspca_dev *gspca_dev)\n{\n\tstruct init_command vivitar_start_commands[] = {\n\t\t{{0x0c, 0x01, 0x00, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x20, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x21, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x22, 0x01, 0x01, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x23, 0x01, 0x01, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x24, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x25, 0x01, 0x28, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x26, 0x01, 0x1e, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x27, 0x01, 0x20, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x28, 0x01, 0x0a, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x13, 0x29, 0x01, 0x20, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x13, 0x2a, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2b, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2c, 0x01, 0x02, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2d, 0x01, 0x03, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2e, 0x01, 0x0f, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x2f, 0x01, 0x0c, 0x00, 0x00}, 4},\n\t\t \n\t\t{{0x12, 0x34, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x34, 0x01, 0xa1, 0x00, 0x00}, 4},\n\t\t{{0x13, 0x35, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x1b, 0x12, 0x80, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x01, 0x77, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x02, 0x3a, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x12, 0x78, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x13, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x14, 0x80, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x15, 0x34, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x1b, 0x04, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x20, 0x44, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x23, 0xee, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x26, 0xa0, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x27, 0x9a, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x28, 0xa0, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x29, 0x30, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x2a, 0x80, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x2b, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x2f, 0x3d, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x30, 0x24, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x32, 0x86, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x60, 0xa9, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x61, 0x42, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x65, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x69, 0x38, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x6f, 0x88, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x70, 0x0b, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x71, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x74, 0x21, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x75, 0x86, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x76, 0x00, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x7d, 0xf3, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x17, 0x1c, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x18, 0xc0, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x19, 0x05, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x1a, 0xf6, 0x00, 0x00, 0x00}, 1},\n\t\t \n\t\t{{0x20, 0x36, 0x06, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x10, 0x26, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x12, 0x27, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x1b, 0x76, 0x03, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x36, 0x05, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x1b, 0x00, 0x3f, 0x00, 0x00, 0x00}, 1},\n\t\t \n\t\t{{0x12, 0x27, 0x01, 0x00, 0x00, 0x00}, 4},\n\t\t{{0x20, 0x29, 0x30, 0x00, 0x00, 0x00}, 1},\n\t\t{{0x20, 0x34, 0xa1, 0x00, 0x00, 0x00}, 1}\n\t};\n\n\treturn run_start_commands(gspca_dev, vivitar_start_commands,\n\t\t\t\t  ARRAY_SIZE(vivitar_start_commands));\n}\n\nstatic int sd_start(struct gspca_dev *gspca_dev)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\tint err_code;\n\n\tsd->sof_read = 0;\n\n\tswitch (sd->model) {\n\tcase 0x7005:\n\t\terr_code = start_genius_cam(gspca_dev);\n\t\tbreak;\n\tcase 0x7003:\n\t\terr_code = start_genius_videocam_live(gspca_dev);\n\t\tbreak;\n\tcase 0x8001:\n\t\terr_code = start_spy_cam(gspca_dev);\n\t\tbreak;\n\tcase 0x8003:\n\t\terr_code = start_cif_cam(gspca_dev);\n\t\tbreak;\n\tcase 0x8008:\n\t\terr_code = start_ms350_cam(gspca_dev);\n\t\tbreak;\n\tcase 0x800a:\n\t\terr_code = start_vivitar_cam(gspca_dev);\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"Starting unknown camera, please report this\\n\");\n\t\treturn -ENXIO;\n\t}\n\n\tsd->avg_lum = -1;\n\n\treturn err_code;\n}\n\nstatic void sd_stopN(struct gspca_dev *gspca_dev)\n{\n\tint result;\n\t__u8 data[6];\n\n\tresult = sn9c2028_read1(gspca_dev);\n\tif (result < 0)\n\t\tgspca_err(gspca_dev, \"Camera Stop read failed\\n\");\n\n\tmemset(data, 0, 6);\n\tdata[0] = 0x14;\n\tresult = sn9c2028_command(gspca_dev, data);\n\tif (result < 0)\n\t\tgspca_err(gspca_dev, \"Camera Stop command failed\\n\");\n}\n\nstatic void do_autogain(struct gspca_dev *gspca_dev, int avg_lum)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\ts32 cur_gain = v4l2_ctrl_g_ctrl(sd->gain);\n\n\tif (avg_lum == -1)\n\t\treturn;\n\n\tif (avg_lum < MIN_AVG_LUM) {\n\t\tif (cur_gain == sd->gain->maximum)\n\t\t\treturn;\n\t\tcur_gain++;\n\t\tv4l2_ctrl_s_ctrl(sd->gain, cur_gain);\n\t}\n\tif (avg_lum > MAX_AVG_LUM) {\n\t\tif (cur_gain == sd->gain->minimum)\n\t\t\treturn;\n\t\tcur_gain--;\n\t\tv4l2_ctrl_s_ctrl(sd->gain, cur_gain);\n\t}\n\n}\n\nstatic void sd_dqcallback(struct gspca_dev *gspca_dev)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\n\tif (sd->autogain == NULL || !v4l2_ctrl_g_ctrl(sd->autogain))\n\t\treturn;\n\n\tdo_autogain(gspca_dev, sd->avg_lum);\n}\n\n \n#include \"sn9c2028.h\"\n\nstatic void sd_pkt_scan(struct gspca_dev *gspca_dev,\n\t\t\t__u8 *data,\t\t\t \n\t\t\tint len)\t\t\t \n{\n\tunsigned char *sof;\n\n\tsof = sn9c2028_find_sof(gspca_dev, data, len);\n\tif (sof) {\n\t\tint n;\n\n\t\t \n\t\tn = sof - data;\n\t\tif (n > sizeof sn9c2028_sof_marker)\n\t\t\tn -= sizeof sn9c2028_sof_marker;\n\t\telse\n\t\t\tn = 0;\n\t\tgspca_frame_add(gspca_dev, LAST_PACKET, data, n);\n\t\t \n\t\tgspca_frame_add(gspca_dev, FIRST_PACKET,\n\t\t\tsn9c2028_sof_marker, sizeof sn9c2028_sof_marker);\n\t\tlen -= sof - data;\n\t\tdata = sof;\n\t}\n\tgspca_frame_add(gspca_dev, INTER_PACKET, data, len);\n}\n\n \nstatic const struct sd_desc sd_desc = {\n\t.name = MODULE_NAME,\n\t.config = sd_config,\n\t.init = sd_init,\n\t.init_controls = sd_init_controls,\n\t.start = sd_start,\n\t.stopN = sd_stopN,\n\t.dq_callback = sd_dqcallback,\n\t.pkt_scan = sd_pkt_scan,\n};\n\n \nstatic const struct usb_device_id device_table[] = {\n\t{USB_DEVICE(0x0458, 0x7005)},  \n\t{USB_DEVICE(0x0458, 0x7003)},  \n\t \n\t \n\t{USB_DEVICE(0x0c45, 0x8001)},  \n\t{USB_DEVICE(0x0c45, 0x8003)},  \n\t \n\t{USB_DEVICE(0x0c45, 0x8008)},  \n\t{USB_DEVICE(0x0c45, 0x800a)},  \n\t{}\n};\nMODULE_DEVICE_TABLE(usb, device_table);\n\n \nstatic int sd_probe(struct usb_interface *intf,\n\t\t\tconst struct usb_device_id *id)\n{\n\treturn gspca_dev_probe(intf, id, &sd_desc, sizeof(struct sd),\n\t\t\t       THIS_MODULE);\n}\n\nstatic struct usb_driver sd_driver = {\n\t.name = MODULE_NAME,\n\t.id_table = device_table,\n\t.probe = sd_probe,\n\t.disconnect = gspca_disconnect,\n#ifdef CONFIG_PM\n\t.suspend = gspca_suspend,\n\t.resume = gspca_resume,\n\t.reset_resume = gspca_resume,\n#endif\n};\n\nmodule_usb_driver(sd_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}