{
  "module_name": "spca505.c",
  "hash_id": "4d8de6260c4b7d95f7ddd0426cc9b7b9510f2463c3e409cbd2813b586c80d863",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/gspca/spca505.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#define MODULE_NAME \"spca505\"\n\n#include \"gspca.h\"\n\nMODULE_AUTHOR(\"Michel Xhaard <mxhaard@users.sourceforge.net>\");\nMODULE_DESCRIPTION(\"GSPCA/SPCA505 USB Camera Driver\");\nMODULE_LICENSE(\"GPL\");\n\n \nstruct sd {\n\tstruct gspca_dev gspca_dev;\t\t \n\n\tu8 subtype;\n#define IntelPCCameraPro 0\n#define Nxultra 1\n};\n\nstatic const struct v4l2_pix_format vga_mode[] = {\n\t{160, 120, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 160,\n\t\t.sizeimage = 160 * 120 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 4},\n\t{176, 144, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 176,\n\t\t.sizeimage = 176 * 144 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 3},\n\t{320, 240, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 320,\n\t\t.sizeimage = 320 * 240 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 2},\n\t{352, 288, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 352,\n\t\t.sizeimage = 352 * 288 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 1},\n\t{640, 480, V4L2_PIX_FMT_SPCA505, V4L2_FIELD_NONE,\n\t\t.bytesperline = 640,\n\t\t.sizeimage = 640 * 480 * 3 / 2,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB,\n\t\t.priv = 0},\n};\n\n#define SPCA50X_OFFSET_DATA 10\n\n#define SPCA50X_REG_USB 0x02\t \n\n#define SPCA50X_USB_CTRL 0x00\t \n#define SPCA50X_CUSB_ENABLE 0x01  \n\n#define SPCA50X_REG_GLOBAL 0x03\t \n#define SPCA50X_GMISC0_IDSEL 0x01  \n#define SPCA50X_GLOBAL_MISC0 0x00  \n\n#define SPCA50X_GLOBAL_MISC1 0x01  \n#define SPCA50X_GLOBAL_MISC3 0x03  \n#define SPCA50X_GMISC3_SAA7113RST 0x20\t \n\n \n#define SPCA50X_REG_COMPRESS 0x04\n\n \nstatic const u8 spca505_init_data[][3] = {\n\t \n\t{SPCA50X_REG_GLOBAL, SPCA50X_GMISC3_SAA7113RST, SPCA50X_GLOBAL_MISC3},\n\t \n\t{SPCA50X_REG_GLOBAL, 0x00, SPCA50X_GLOBAL_MISC3},\n\t{SPCA50X_REG_GLOBAL, 0x00, SPCA50X_GLOBAL_MISC1},\n\t \n\t{SPCA50X_REG_GLOBAL, SPCA50X_GMISC0_IDSEL, SPCA50X_GLOBAL_MISC0},\n\n\t{0x05, 0x01, 0x10},\n\t\t\t\t\t \n\t{0x05, 0x0f, 0x11},\n\n\t \n\t{0x06, 0x10, 0x08},\n\t{0x06, 0x00, 0x09},\n\t{0x06, 0x00, 0x0a},\n\t{0x06, 0x00, 0x0b},\n\t{0x06, 0x10, 0x0c},\n\t{0x06, 0x00, 0x0d},\n\t{0x06, 0x00, 0x0e},\n\t{0x06, 0x00, 0x0f},\n\t{0x06, 0x10, 0x10},\n\t{0x06, 0x02, 0x11},\n\t{0x06, 0x00, 0x12},\n\t{0x06, 0x04, 0x13},\n\t{0x06, 0x02, 0x14},\n\t{0x06, 0x8a, 0x51},\n\t{0x06, 0x40, 0x52},\n\t{0x06, 0xb6, 0x53},\n\t{0x06, 0x3d, 0x54},\n\t{}\n};\n\n \nstatic const u8 spca505_open_data_ccd[][3] = {\n\t \n\t \n\t{0x03, 0x04, 0x01},\n\t \n\t{0x03, 0x00, 0x01},\n\n\t \n\t\t{0x04, 0x10, 0x01},\n\t\t \n\t{0x04, 0x00, 0x04},\n\t{0x04, 0x00, 0x05},\n\t{0x04, 0x20, 0x06},\n\t{0x04, 0x20, 0x07},\n\n\t{0x08, 0x0a, 0x00},\n\t \n\n\t{0x05, 0x00, 0x10},\n\t{0x05, 0x00, 0x11},\n\t{0x05, 0x00, 0x00},\n\t \n\t{0x05, 0x00, 0x01},\n\t \n\t{0x05, 0x00, 0x02},\n\t \n\t{0x05, 0x00, 0x03},\n\t \n\t{0x05, 0x00, 0x04},\n\t \n\t\t{0x05, 0x80, 0x05},\n\t\t \n\t\t{0x05, 0xe0, 0x06},\n\t\t \n\t\t{0x05, 0x20, 0x07},\n\t\t \n\t\t{0x05, 0xa0, 0x08},\n\t\t \n\t\t{0x05, 0x0, 0x12},\n\t\t \n\t{0x05, 0x02, 0x0f},\n\t \n\t\t{0x05, 0x10, 0x46},\n\t\t \n\t\t{0x05, 0x8, 0x4a},\n\t\t \n\n\t{0x03, 0x08, 0x03},\n\t \n\t{0x03, 0x08, 0x01},\n\t{0x03, 0x0c, 0x03},\n\t \n\t\t{0x03, 0x21, 0x00},\n\t\t \n\n \n\t{0x06, 0x10, 0x08},\n\t{0x06, 0x00, 0x09},\n\t{0x06, 0x00, 0x0a},\n\t{0x06, 0x00, 0x0b},\n\t{0x06, 0x10, 0x0c},\n\t{0x06, 0x00, 0x0d},\n\t{0x06, 0x00, 0x0e},\n\t{0x06, 0x00, 0x0f},\n\t{0x06, 0x10, 0x10},\n\t{0x06, 0x02, 0x11},\n\t{0x06, 0x00, 0x12},\n\t{0x06, 0x04, 0x13},\n\t{0x06, 0x02, 0x14},\n\t{0x06, 0x8a, 0x51},\n\t{0x06, 0x40, 0x52},\n\t{0x06, 0xb6, 0x53},\n\t{0x06, 0x3d, 0x54},\n\t \n\n\t\t{0x06, 0x3f, 0x1},\n\t\t \n\t{0x06, 0x10, 0x02},\n\t{0x06, 0x64, 0x07},\n\t{0x06, 0x10, 0x08},\n\t{0x06, 0x00, 0x09},\n\t{0x06, 0x00, 0x0a},\n\t{0x06, 0x00, 0x0b},\n\t{0x06, 0x10, 0x0c},\n\t{0x06, 0x00, 0x0d},\n\t{0x06, 0x00, 0x0e},\n\t{0x06, 0x00, 0x0f},\n\t{0x06, 0x10, 0x10},\n\t{0x06, 0x02, 0x11},\n\t{0x06, 0x00, 0x12},\n\t{0x06, 0x04, 0x13},\n\t{0x06, 0x02, 0x14},\n\t{0x06, 0x8a, 0x51},\n\t{0x06, 0x40, 0x52},\n\t{0x06, 0xb6, 0x53},\n\t{0x06, 0x3d, 0x54},\n\t{0x06, 0x60, 0x57},\n\t{0x06, 0x20, 0x58},\n\t{0x06, 0x15, 0x59},\n\t{0x06, 0x05, 0x5a},\n\n\t{0x05, 0x01, 0xc0},\n\t{0x05, 0x10, 0xcb},\n\t\t{0x05, 0x80, 0xc1},\n\t\t \n\t\t{0x05, 0x0, 0xc2},\n\t\t \n\t{0x05, 0x00, 0xca},\n\t\t{0x05, 0x80, 0xc1},\n\t\t \n\t{0x05, 0x04, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t\t{0x05, 0x0, 0xc1},\n\t\t \n\t{0x05, 0x00, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t\t{0x05, 0x40, 0xc1},\n\t\t \n\t{0x05, 0x17, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t\t{0x05, 0x80, 0xc1},\n\t\t \n\t{0x05, 0x06, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t\t{0x05, 0x80, 0xc1},\n\t\t \n\t{0x05, 0x04, 0xc2},\n\t{0x05, 0x00, 0xca},\n\n\t{0x03, 0x4c, 0x3},\n\t{0x03, 0x18, 0x1},\n\n\t{0x06, 0x70, 0x51},\n\t{0x06, 0xbe, 0x53},\n\t{0x06, 0x71, 0x57},\n\t{0x06, 0x20, 0x58},\n\t{0x06, 0x05, 0x59},\n\t{0x06, 0x15, 0x5a},\n\n\t{0x04, 0x00, 0x08},\n\t \n\t{0x04, 0x12, 0x09},\n\t{0x04, 0x21, 0x0a},\n\t{0x04, 0x10, 0x0b},\n\t{0x04, 0x21, 0x0c},\n\t{0x04, 0x05, 0x00},\n\t \n\t{0x04, 0x00, 0x01},\n\n\t{0x06, 0x3f, 0x01},\n\n\t{0x04, 0x00, 0x04},\n\t{0x04, 0x00, 0x05},\n\t{0x04, 0x40, 0x06},\n\t{0x04, 0x40, 0x07},\n\n\t{0x06, 0x1c, 0x17},\n\t{0x06, 0xe2, 0x19},\n\t{0x06, 0x1c, 0x1b},\n\t{0x06, 0xe2, 0x1d},\n\t{0x06, 0xaa, 0x1f},\n\t{0x06, 0x70, 0x20},\n\n\t{0x05, 0x01, 0x10},\n\t{0x05, 0x00, 0x11},\n\t{0x05, 0x01, 0x00},\n\t{0x05, 0x05, 0x01},\n\t\t{0x05, 0x00, 0xc1},\n\t\t \n\t{0x05, 0x00, 0xc2},\n\t{0x05, 0x00, 0xca},\n\n\t{0x06, 0x70, 0x51},\n\t{0x06, 0xbe, 0x53},\n\t{}\n};\n\n \n \n#define initial_brightness 0x7f\t \n \nstatic const u8 spca505b_init_data[][3] = {\n \n\t{0x02, 0x00, 0x00},\t\t \n\t{0x02, 0x00, 0x01},\n\t{0x02, 0x00, 0x02},\n\t{0x02, 0x00, 0x03},\n\t{0x02, 0x00, 0x04},\n\t{0x02, 0x00, 0x05},\n\t{0x02, 0x00, 0x06},\n\t{0x02, 0x00, 0x07},\n\t{0x02, 0x00, 0x08},\n\t{0x02, 0x00, 0x09},\n\t{0x03, 0x00, 0x00},\n\t{0x03, 0x00, 0x01},\n\t{0x03, 0x00, 0x02},\n\t{0x03, 0x00, 0x03},\n\t{0x03, 0x00, 0x04},\n\t{0x03, 0x00, 0x05},\n\t{0x03, 0x00, 0x06},\n\t{0x04, 0x00, 0x00},\n\t{0x04, 0x00, 0x02},\n\t{0x04, 0x00, 0x04},\n\t{0x04, 0x00, 0x05},\n\t{0x04, 0x00, 0x06},\n\t{0x04, 0x00, 0x07},\n\t{0x04, 0x00, 0x08},\n\t{0x04, 0x00, 0x09},\n\t{0x04, 0x00, 0x0a},\n\t{0x04, 0x00, 0x0b},\n\t{0x04, 0x00, 0x0c},\n\t{0x07, 0x00, 0x00},\n\t{0x07, 0x00, 0x03},\n\t{0x08, 0x00, 0x00},\n\t{0x08, 0x00, 0x01},\n\t{0x08, 0x00, 0x02},\n\t{0x06, 0x18, 0x08},\n\t{0x06, 0xfc, 0x09},\n\t{0x06, 0xfc, 0x0a},\n\t{0x06, 0xfc, 0x0b},\n\t{0x06, 0x18, 0x0c},\n\t{0x06, 0xfc, 0x0d},\n\t{0x06, 0xfc, 0x0e},\n\t{0x06, 0xfc, 0x0f},\n\t{0x06, 0x18, 0x10},\n\t{0x06, 0xfe, 0x12},\n\t{0x06, 0x00, 0x11},\n\t{0x06, 0x00, 0x14},\n\t{0x06, 0x00, 0x13},\n\t{0x06, 0x28, 0x51},\n\t{0x06, 0xff, 0x53},\n\t{0x02, 0x00, 0x08},\n\n\t{0x03, 0x00, 0x03},\n\t{0x03, 0x10, 0x03},\n\t{}\n};\n\n \nstatic const u8 spca505b_open_data_ccd[][3] = {\n\n \n\t{0x03, 0x04, 0x01},\t\t \n\t{0x03, 0x00, 0x01},\n\t{0x03, 0x00, 0x00},\n\t{0x03, 0x21, 0x00},\n\t{0x03, 0x00, 0x04},\n\t{0x03, 0x00, 0x03},\n\t{0x03, 0x18, 0x03},\n\t{0x03, 0x08, 0x01},\n\t{0x03, 0x1c, 0x03},\n\t{0x03, 0x5c, 0x03},\n\t{0x03, 0x5c, 0x03},\n\t{0x03, 0x18, 0x01},\n\n \n\t{0x04, 0x10, 0x01},\n\t{0x04, 0x00, 0x04},\n\t{0x04, 0x00, 0x05},\n\t{0x04, 0x20, 0x06},\n\t{0x04, 0x20, 0x07},\n\n\t{0x08, 0x0a, 0x00},\n\n\t{0x05, 0x00, 0x10},\n\t{0x05, 0x00, 0x11},\n\t{0x05, 0x00, 0x12},\n\t{0x05, 0x6f, 0x00},\n\t{0x05, initial_brightness >> 6, 0x00},\n\t{0x05, (initial_brightness << 2) & 0xff, 0x01},\n\t{0x05, 0x00, 0x02},\n\t{0x05, 0x01, 0x03},\n\t{0x05, 0x00, 0x04},\n\t{0x05, 0x03, 0x05},\n\t{0x05, 0xe0, 0x06},\n\t{0x05, 0x20, 0x07},\n\t{0x05, 0xa0, 0x08},\n\t{0x05, 0x00, 0x12},\n\t{0x05, 0x02, 0x0f},\n\t{0x05, 0x80, 0x14},\t\t \n\t{0x05, 0x01, 0xb0},\n\t{0x05, 0x01, 0xbf},\n\t{0x03, 0x02, 0x06},\n\t{0x05, 0x10, 0x46},\n\t{0x05, 0x08, 0x4a},\n\n\t{0x06, 0x00, 0x01},\n\t{0x06, 0x10, 0x02},\n\t{0x06, 0x64, 0x07},\n\t{0x06, 0x18, 0x08},\n\t{0x06, 0xfc, 0x09},\n\t{0x06, 0xfc, 0x0a},\n\t{0x06, 0xfc, 0x0b},\n\t{0x04, 0x00, 0x01},\n\t{0x06, 0x18, 0x0c},\n\t{0x06, 0xfc, 0x0d},\n\t{0x06, 0xfc, 0x0e},\n\t{0x06, 0xfc, 0x0f},\n\t{0x06, 0x11, 0x10},\t\t \n\t{0x06, 0x00, 0x11},\n\t{0x06, 0xfe, 0x12},\n\t{0x06, 0x00, 0x13},\n\t{0x06, 0x00, 0x14},\n\t{0x06, 0x9d, 0x51},\n\t{0x06, 0x40, 0x52},\n\t{0x06, 0x7c, 0x53},\n\t{0x06, 0x40, 0x54},\n\t{0x06, 0x02, 0x57},\n\t{0x06, 0x03, 0x58},\n\t{0x06, 0x15, 0x59},\n\t{0x06, 0x05, 0x5a},\n\t{0x06, 0x03, 0x56},\n\t{0x06, 0x02, 0x3f},\n\t{0x06, 0x00, 0x40},\n\t{0x06, 0x39, 0x41},\n\t{0x06, 0x69, 0x42},\n\t{0x06, 0x87, 0x43},\n\t{0x06, 0x9e, 0x44},\n\t{0x06, 0xb1, 0x45},\n\t{0x06, 0xbf, 0x46},\n\t{0x06, 0xcc, 0x47},\n\t{0x06, 0xd5, 0x48},\n\t{0x06, 0xdd, 0x49},\n\t{0x06, 0xe3, 0x4a},\n\t{0x06, 0xe8, 0x4b},\n\t{0x06, 0xed, 0x4c},\n\t{0x06, 0xf2, 0x4d},\n\t{0x06, 0xf7, 0x4e},\n\t{0x06, 0xfc, 0x4f},\n\t{0x06, 0xff, 0x50},\n\n\t{0x05, 0x01, 0xc0},\n\t{0x05, 0x10, 0xcb},\n\t{0x05, 0x40, 0xc1},\n\t{0x05, 0x04, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t{0x05, 0x40, 0xc1},\n\t{0x05, 0x09, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t{0x05, 0xc0, 0xc1},\n\t{0x05, 0x09, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t{0x05, 0x40, 0xc1},\n\t{0x05, 0x59, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t{0x04, 0x00, 0x01},\n\t{0x05, 0x80, 0xc1},\n\t{0x05, 0xec, 0xc2},\n\t{0x05, 0x0, 0xca},\n\n\t{0x06, 0x02, 0x57},\n\t{0x06, 0x01, 0x58},\n\t{0x06, 0x15, 0x59},\n\t{0x06, 0x0a, 0x5a},\n\t{0x06, 0x01, 0x57},\n\t{0x06, 0x8a, 0x03},\n\t{0x06, 0x0a, 0x6c},\n\t{0x06, 0x30, 0x01},\n\t{0x06, 0x20, 0x02},\n\t{0x06, 0x00, 0x03},\n\n\t{0x05, 0x8c, 0x25},\n\n\t{0x06, 0x4d, 0x51},\t\t \n\t{0x06, 0x84, 0x53},\t\t \n\t{0x06, 0x00, 0x57},\t\t \n\t{0x06, 0x18, 0x08},\n\t{0x06, 0xfc, 0x09},\n\t{0x06, 0xfc, 0x0a},\n\t{0x06, 0xfc, 0x0b},\n\t{0x06, 0x18, 0x0c},\t\t \n\t{0x06, 0xfc, 0x0d},\n\t{0x06, 0xfc, 0x0e},\n\t{0x06, 0xfc, 0x0f},\n\t{0x06, 0x18, 0x10},\t\t \n\n\t{0x05, 0x01, 0x02},\n\n\t{0x04, 0x00, 0x08},\t\t \n\t{0x04, 0x12, 0x09},\n\t{0x04, 0x21, 0x0a},\n\t{0x04, 0x10, 0x0b},\n\t{0x04, 0x21, 0x0c},\n\t{0x04, 0x1d, 0x00},\t\t \n\t{0x04, 0x41, 0x01},\t\t \n\n\t{0x04, 0x00, 0x04},\n\t{0x04, 0x00, 0x05},\n\t{0x04, 0x10, 0x06},\n\t{0x04, 0x10, 0x07},\n\t{0x04, 0x40, 0x06},\n\t{0x04, 0x40, 0x07},\n\t{0x04, 0x00, 0x04},\n\t{0x04, 0x00, 0x05},\n\n\t{0x06, 0x1c, 0x17},\n\t{0x06, 0xe2, 0x19},\n\t{0x06, 0x1c, 0x1b},\n\t{0x06, 0xe2, 0x1d},\n\t{0x06, 0x5f, 0x1f},\n\t{0x06, 0x32, 0x20},\n\n\t{0x05, initial_brightness >> 6, 0x00},\n\t{0x05, (initial_brightness << 2) & 0xff, 0x01},\n\t{0x05, 0x06, 0xc1},\n\t{0x05, 0x58, 0xc2},\n\t{0x05, 0x00, 0xca},\n\t{0x05, 0x00, 0x11},\n\t{}\n};\n\nstatic int reg_write(struct gspca_dev *gspca_dev,\n\t\t     u16 req, u16 index, u16 value)\n{\n\tint ret;\n\tstruct usb_device *dev = gspca_dev->dev;\n\n\tret = usb_control_msg(dev,\n\t\t\tusb_sndctrlpipe(dev, 0),\n\t\t\treq,\n\t\t\tUSB_TYPE_VENDOR | USB_RECIP_DEVICE,\n\t\t\tvalue, index, NULL, 0, 500);\n\tgspca_dbg(gspca_dev, D_USBO, \"reg write: 0x%02x,0x%02x:0x%02x, %d\\n\",\n\t\t  req, index, value, ret);\n\tif (ret < 0)\n\t\tpr_err(\"reg write: error %d\\n\", ret);\n\treturn ret;\n}\n\n \nstatic int reg_read(struct gspca_dev *gspca_dev,\n\t\t\tu16 req,\t \n\t\t\tu16 index)\t \n{\n\tint ret;\n\n\tret = usb_control_msg(gspca_dev->dev,\n\t\t\tusb_rcvctrlpipe(gspca_dev->dev, 0),\n\t\t\treq,\n\t\t\tUSB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_DEVICE,\n\t\t\t0,\t\t\t \n\t\t\tindex,\n\t\t\tgspca_dev->usb_buf, 2,\n\t\t\t500);\t\t\t \n\tif (ret < 0)\n\t\treturn ret;\n\treturn (gspca_dev->usb_buf[1] << 8) + gspca_dev->usb_buf[0];\n}\n\nstatic int write_vector(struct gspca_dev *gspca_dev,\n\t\t\tconst u8 data[][3])\n{\n\tint ret, i = 0;\n\n\twhile (data[i][0] != 0) {\n\t\tret = reg_write(gspca_dev, data[i][0], data[i][2],\n\t\t\t\t\t\t\t\tdata[i][1]);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\ti++;\n\t}\n\treturn 0;\n}\n\n \nstatic int sd_config(struct gspca_dev *gspca_dev,\n\t\t\tconst struct usb_device_id *id)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\tstruct cam *cam;\n\n\tcam = &gspca_dev->cam;\n\tcam->cam_mode = vga_mode;\n\tsd->subtype = id->driver_info;\n\tif (sd->subtype != IntelPCCameraPro)\n\t\tcam->nmodes = ARRAY_SIZE(vga_mode);\n\telse\t\t\t \n\t\tcam->nmodes = ARRAY_SIZE(vga_mode) - 1;\n\n\treturn 0;\n}\n\n \nstatic int sd_init(struct gspca_dev *gspca_dev)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\n\tif (write_vector(gspca_dev,\n\t\t\t sd->subtype == Nxultra\n\t\t\t\t? spca505b_init_data\n\t\t\t\t: spca505_init_data))\n\t\treturn -EIO;\n\treturn 0;\n}\n\nstatic void setbrightness(struct gspca_dev *gspca_dev, s32 brightness)\n{\n\treg_write(gspca_dev, 0x05, 0x00, (255 - brightness) >> 6);\n\treg_write(gspca_dev, 0x05, 0x01, (255 - brightness) << 2);\n}\n\nstatic int sd_start(struct gspca_dev *gspca_dev)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\tint ret, mode;\n\tstatic u8 mode_tb[][3] = {\n\t \n\t\t{0x00, 0x10, 0x10},\t \n\t\t{0x01, 0x1a, 0x1a},\t \n\t\t{0x02, 0x1c, 0x1d},\t \n\t\t{0x04, 0x34, 0x34},\t \n\t\t{0x05, 0x40, 0x40}\t \n\t};\n\n\tif (sd->subtype == Nxultra)\n\t\twrite_vector(gspca_dev, spca505b_open_data_ccd);\n\telse\n\t\twrite_vector(gspca_dev, spca505_open_data_ccd);\n\tret = reg_read(gspca_dev, 0x06, 0x16);\n\n\tif (ret < 0) {\n\t\tgspca_err(gspca_dev, \"register read failed err: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\tif (ret != 0x0101) {\n\t\tpr_err(\"After vector read returns 0x%04x should be 0x0101\\n\",\n\t\t       ret);\n\t}\n\n\tret = reg_write(gspca_dev, 0x06, 0x16, 0x0a);\n\tif (ret < 0)\n\t\treturn ret;\n\treg_write(gspca_dev, 0x05, 0xc2, 0x12);\n\n\t \n\t \n\treg_write(gspca_dev, 0x02, 0x00, 0x00);\n\n\tmode = gspca_dev->cam.cam_mode[(int) gspca_dev->curr_mode].priv;\n\treg_write(gspca_dev, SPCA50X_REG_COMPRESS, 0x00, mode_tb[mode][0]);\n\treg_write(gspca_dev, SPCA50X_REG_COMPRESS, 0x06, mode_tb[mode][1]);\n\treg_write(gspca_dev, SPCA50X_REG_COMPRESS, 0x07, mode_tb[mode][2]);\n\n\treturn reg_write(gspca_dev, SPCA50X_REG_USB,\n\t\t\t SPCA50X_USB_CTRL,\n\t\t\t SPCA50X_CUSB_ENABLE);\n}\n\nstatic void sd_stopN(struct gspca_dev *gspca_dev)\n{\n\t \n\treg_write(gspca_dev, 0x02, 0x00, 0x00);\n}\n\n \nstatic void sd_stop0(struct gspca_dev *gspca_dev)\n{\n\tif (!gspca_dev->present)\n\t\treturn;\n\n\t \n\treg_write(gspca_dev, 0x03, 0x03, 0x20);\n\treg_write(gspca_dev, 0x03, 0x01, 0x00);\n\treg_write(gspca_dev, 0x03, 0x00, 0x01);\n\treg_write(gspca_dev, 0x05, 0x10, 0x01);\n\treg_write(gspca_dev, 0x05, 0x11, 0x0f);\n}\n\nstatic void sd_pkt_scan(struct gspca_dev *gspca_dev,\n\t\t\tu8 *data,\t\t\t \n\t\t\tint len)\t\t\t \n{\n\tswitch (data[0]) {\n\tcase 0:\t\t\t\t \n\t\tgspca_frame_add(gspca_dev, LAST_PACKET, NULL, 0);\n\t\tdata += SPCA50X_OFFSET_DATA;\n\t\tlen -= SPCA50X_OFFSET_DATA;\n\t\tgspca_frame_add(gspca_dev, FIRST_PACKET, data, len);\n\t\tbreak;\n\tcase 0xff:\t\t\t \n\t\tbreak;\n\tdefault:\n\t\tdata += 1;\n\t\tlen -= 1;\n\t\tgspca_frame_add(gspca_dev, INTER_PACKET, data, len);\n\t\tbreak;\n\t}\n}\n\nstatic int sd_s_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct gspca_dev *gspca_dev =\n\t\tcontainer_of(ctrl->handler, struct gspca_dev, ctrl_handler);\n\n\tgspca_dev->usb_err = 0;\n\n\tif (!gspca_dev->streaming)\n\t\treturn 0;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_BRIGHTNESS:\n\t\tsetbrightness(gspca_dev, ctrl->val);\n\t\tbreak;\n\t}\n\treturn gspca_dev->usb_err;\n}\n\nstatic const struct v4l2_ctrl_ops sd_ctrl_ops = {\n\t.s_ctrl = sd_s_ctrl,\n};\n\nstatic int sd_init_controls(struct gspca_dev *gspca_dev)\n{\n\tstruct v4l2_ctrl_handler *hdl = &gspca_dev->ctrl_handler;\n\n\tgspca_dev->vdev.ctrl_handler = hdl;\n\tv4l2_ctrl_handler_init(hdl, 5);\n\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_BRIGHTNESS, 0, 255, 1, 127);\n\n\tif (hdl->error) {\n\t\tpr_err(\"Could not initialize controls\\n\");\n\t\treturn hdl->error;\n\t}\n\treturn 0;\n}\n\n \nstatic const struct sd_desc sd_desc = {\n\t.name = MODULE_NAME,\n\t.config = sd_config,\n\t.init_controls = sd_init_controls,\n\t.init = sd_init,\n\t.start = sd_start,\n\t.stopN = sd_stopN,\n\t.stop0 = sd_stop0,\n\t.pkt_scan = sd_pkt_scan,\n};\n\n \nstatic const struct usb_device_id device_table[] = {\n\t{USB_DEVICE(0x041e, 0x401d), .driver_info = Nxultra},\n\t{USB_DEVICE(0x0733, 0x0430), .driver_info = IntelPCCameraPro},\n \n\t{}\n};\nMODULE_DEVICE_TABLE(usb, device_table);\n\n \nstatic int sd_probe(struct usb_interface *intf,\n\t\t\tconst struct usb_device_id *id)\n{\n\treturn gspca_dev_probe(intf, id, &sd_desc, sizeof(struct sd),\n\t\t\t\tTHIS_MODULE);\n}\n\nstatic struct usb_driver sd_driver = {\n\t.name = MODULE_NAME,\n\t.id_table = device_table,\n\t.probe = sd_probe,\n\t.disconnect = gspca_disconnect,\n#ifdef CONFIG_PM\n\t.suspend = gspca_suspend,\n\t.resume = gspca_resume,\n\t.reset_resume = gspca_resume,\n#endif\n};\n\nmodule_usb_driver(sd_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}