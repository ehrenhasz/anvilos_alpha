{
  "module_name": "ov534_9.c",
  "hash_id": "a7bdeeb13adb39ef96d684dc8edd9fbcda123223dcd9d99590165947a1114e65",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/gspca/ov534_9.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#define MODULE_NAME \"ov534_9\"\n\n#include \"gspca.h\"\n\n#define OV534_REG_ADDRESS\t0xf1\t \n#define OV534_REG_SUBADDR\t0xf2\n#define OV534_REG_WRITE\t\t0xf3\n#define OV534_REG_READ\t\t0xf4\n#define OV534_REG_OPERATION\t0xf5\n#define OV534_REG_STATUS\t0xf6\n\n#define OV534_OP_WRITE_3\t0x37\n#define OV534_OP_WRITE_2\t0x33\n#define OV534_OP_READ_2\t\t0xf9\n\n#define CTRL_TIMEOUT 500\n\nMODULE_AUTHOR(\"Jean-Francois Moine <moinejf@free.fr>\");\nMODULE_DESCRIPTION(\"GSPCA/OV534_9 USB Camera Driver\");\nMODULE_LICENSE(\"GPL\");\n\n \nstruct sd {\n\tstruct gspca_dev gspca_dev;\t \n\t__u32 last_pts;\n\tu8 last_fid;\n\n\tu8 sensor;\n};\nenum sensors {\n\tSENSOR_OV965x,\t\t \n\tSENSOR_OV971x,\t\t \n\tSENSOR_OV562x,\t\t \n\tSENSOR_OV361x,\t\t \n\tNSENSORS\n};\n\nstatic const struct v4l2_pix_format ov965x_mode[] = {\n#define QVGA_MODE 0\n\t{320, 240, V4L2_PIX_FMT_JPEG, V4L2_FIELD_NONE,\n\t\t.bytesperline = 320,\n\t\t.sizeimage = 320 * 240 * 3 / 8 + 590,\n\t\t.colorspace = V4L2_COLORSPACE_JPEG},\n#define VGA_MODE 1\n\t{640, 480, V4L2_PIX_FMT_JPEG, V4L2_FIELD_NONE,\n\t\t.bytesperline = 640,\n\t\t.sizeimage = 640 * 480 * 3 / 8 + 590,\n\t\t.colorspace = V4L2_COLORSPACE_JPEG},\n#define SVGA_MODE 2\n\t{800, 600, V4L2_PIX_FMT_JPEG, V4L2_FIELD_NONE,\n\t\t.bytesperline = 800,\n\t\t.sizeimage = 800 * 600 * 3 / 8 + 590,\n\t\t.colorspace = V4L2_COLORSPACE_JPEG},\n#define XGA_MODE 3\n\t{1024, 768, V4L2_PIX_FMT_JPEG, V4L2_FIELD_NONE,\n\t\t.bytesperline = 1024,\n\t\t.sizeimage = 1024 * 768 * 3 / 8 + 590,\n\t\t.colorspace = V4L2_COLORSPACE_JPEG},\n#define SXGA_MODE 4\n\t{1280, 1024, V4L2_PIX_FMT_JPEG, V4L2_FIELD_NONE,\n\t\t.bytesperline = 1280,\n\t\t.sizeimage = 1280 * 1024 * 3 / 8 + 590,\n\t\t.colorspace = V4L2_COLORSPACE_JPEG},\n};\n\nstatic const struct v4l2_pix_format ov971x_mode[] = {\n\t{640, 480, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 640,\n\t\t.sizeimage = 640 * 480,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB\n\t}\n};\n\nstatic const struct v4l2_pix_format ov562x_mode[] = {\n\t{2592, 1680, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 2592,\n\t\t.sizeimage = 2592 * 1680,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB\n\t}\n};\n\nenum ov361x {\n\tov361x_2048 = 0,\n\tov361x_1600,\n\tov361x_1024,\n\tov361x_640,\n\tov361x_320,\n\tov361x_160,\n\tov361x_last\n};\n\nstatic const struct v4l2_pix_format ov361x_mode[] = {\n\t{0x800, 0x600, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 0x800,\n\t\t.sizeimage = 0x800 * 0x600,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB},\n\t{1600, 1200, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 1600,\n\t\t.sizeimage = 1600 * 1200,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB},\n\t{1024, 768, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 768,\n\t\t.sizeimage = 1024 * 768,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB},\n\t{640, 480, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 640,\n\t\t.sizeimage = 640 * 480,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB},\n\t{320, 240, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 320,\n\t\t.sizeimage = 320 * 240,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB},\n\t{160, 120, V4L2_PIX_FMT_SBGGR8, V4L2_FIELD_NONE,\n\t\t.bytesperline = 160,\n\t\t.sizeimage = 160 * 120,\n\t\t.colorspace = V4L2_COLORSPACE_SRGB}\n};\n\nstatic const u8 ov361x_start_2048[][2] = {\n\t{0x12, 0x80},\n\t{0x13, 0xcf},\n\t{0x14, 0x40},\n\t{0x15, 0x00},\n\t{0x01, 0x80},\n\t{0x02, 0x80},\n\t{0x04, 0x70},\n\t{0x0d, 0x40},\n\t{0x0f, 0x47},\n\t{0x11, 0x81},\n\t{0x32, 0x36},\n\t{0x33, 0x0c},\n\t{0x34, 0x00},\n\t{0x35, 0x90},\n\t{0x12, 0x00},\n\t{0x17, 0x10},\n\t{0x18, 0x90},\n\t{0x19, 0x00},\n\t{0x1a, 0xc0},\n};\nstatic const u8 ov361x_bridge_start_2048[][2] = {\n\t{0xf1, 0x60},\n\t{0x88, 0x00},\n\t{0x89, 0x08},\n\t{0x8a, 0x00},\n\t{0x8b, 0x06},\n\t{0x8c, 0x01},\n\t{0x8d, 0x10},\n\t{0x1c, 0x00},\n\t{0x1d, 0x48},\n\t{0x1d, 0x00},\n\t{0x1d, 0xff},\n\t{0x1c, 0x0a},\n\t{0x1d, 0x2e},\n\t{0x1d, 0x1e},\n};\n\nstatic const u8 ov361x_start_1600[][2] = {\n\t{0x12, 0x80},\n\t{0x13, 0xcf},\n\t{0x14, 0x40},\n\t{0x15, 0x00},\n\t{0x01, 0x80},\n\t{0x02, 0x80},\n\t{0x04, 0x70},\n\t{0x0d, 0x40},\n\t{0x0f, 0x47},\n\t{0x11, 0x81},\n\t{0x32, 0x36},\n\t{0x33, 0x0C},\n\t{0x34, 0x00},\n\t{0x35, 0x90},\n\t{0x12, 0x00},\n\t{0x17, 0x10},\n\t{0x18, 0x90},\n\t{0x19, 0x00},\n\t{0x1a, 0xc0},\n};\nstatic const u8 ov361x_bridge_start_1600[][2] = {\n\t{0xf1, 0x60},   \n\t{0x88, 0x00},   \n\t{0x89, 0x08},   \n\t{0x8a, 0x00},   \n\t{0x8b, 0x06},   \n\t{0x8c, 0x01},   \n\t{0x8d, 0x10},\n\t{0x1c, 0x00},   \n\t{0x1d, 0x48},\n\t{0x1d, 0x00},\n\t{0x1d, 0xff},\n\t{0x1c, 0x0a},   \n\t{0x1d, 0x2e},   \n\t{0x1d, 0x1e},\n};\n\nstatic const u8 ov361x_start_1024[][2] = {\n\t{0x12, 0x80},\n\t{0x13, 0xcf},\n\t{0x14, 0x40},\n\t{0x15, 0x00},\n\t{0x01, 0x80},\n\t{0x02, 0x80},\n\t{0x04, 0x70},\n\t{0x0d, 0x40},\n\t{0x0f, 0x47},\n\t{0x11, 0x81},\n\t{0x32, 0x36},\n\t{0x33, 0x0C},\n\t{0x34, 0x00},\n\t{0x35, 0x90},\n\t{0x12, 0x40},\n\t{0x17, 0x1f},\n\t{0x18, 0x5f},\n\t{0x19, 0x00},\n\t{0x1a, 0x68},\n};\nstatic const u8 ov361x_bridge_start_1024[][2] = {\n\t{0xf1, 0x60},   \n\t{0x88, 0x00},   \n\t{0x89, 0x04},   \n\t{0x8a, 0x00},   \n\t{0x8b, 0x03},   \n\t{0x8c, 0x01},   \n\t{0x8d, 0x10},\n\t{0x1c, 0x00},   \n\t{0x1d, 0x48},\n\t{0x1d, 0x00},\n\t{0x1d, 0xff},\n\t{0x1c, 0x0a},   \n\t{0x1d, 0x2e},   \n\t{0x1d, 0x1e},\n};\n\nstatic const u8 ov361x_start_640[][2] = {\n\t{0x12, 0x80},\n\t{0x13, 0xcf},\n\t{0x14, 0x40},\n\t{0x15, 0x00},\n\t{0x01, 0x80},\n\t{0x02, 0x80},\n\t{0x04, 0x70},\n\t{0x0d, 0x40},\n\t{0x0f, 0x47},\n\t{0x11, 0x81},\n\t{0x32, 0x36},\n\t{0x33, 0x0C},\n\t{0x34, 0x00},\n\t{0x35, 0x90},\n\t{0x12, 0x40},\n\t{0x17, 0x1f},\n\t{0x18, 0x5f},\n\t{0x19, 0x00},\n\t{0x1a, 0x68},\n};\n\nstatic const u8 ov361x_bridge_start_640[][2] = {\n\t{0xf1, 0x60},   \n\t{0x88, 0x00},   \n\t{0x89, 0x04},   \n\t{0x8a, 0x00},   \n\t{0x8b, 0x03},   \n\t{0x8c, 0x01},   \n\t{0x8d, 0x10},\n\t{0x1c, 0x00},   \n\t{0x1d, 0x48},\n\t{0x1d, 0x00},\n\t{0x1d, 0xff},\n\t{0x1c, 0x0a},   \n\t{0x1d, 0x2e},   \n\t{0x1d, 0x1e},\n};\n\nstatic const u8 ov361x_start_320[][2] = {\n\t{0x12, 0x80},\n\t{0x13, 0xcf},\n\t{0x14, 0x40},\n\t{0x15, 0x00},\n\t{0x01, 0x80},\n\t{0x02, 0x80},\n\t{0x04, 0x70},\n\t{0x0d, 0x40},\n\t{0x0f, 0x47},\n\t{0x11, 0x81},\n\t{0x32, 0x36},\n\t{0x33, 0x0C},\n\t{0x34, 0x00},\n\t{0x35, 0x90},\n\t{0x12, 0x40},\n\t{0x17, 0x1f},\n\t{0x18, 0x5f},\n\t{0x19, 0x00},\n\t{0x1a, 0x68},\n};\n\nstatic const u8 ov361x_bridge_start_320[][2] = {\n\t{0xf1, 0x60},   \n\t{0x88, 0x00},   \n\t{0x89, 0x04},   \n\t{0x8a, 0x00},   \n\t{0x8b, 0x03},   \n\t{0x8c, 0x01},   \n\t{0x8d, 0x10},\n\t{0x1c, 0x00},   \n\t{0x1d, 0x48},\n\t{0x1d, 0x00},\n\t{0x1d, 0xff},\n\t{0x1c, 0x0a},   \n\t{0x1d, 0x2e},   \n\t{0x1d, 0x1e},\n};\n\nstatic const u8 ov361x_start_160[][2] = {\n\t{0x12, 0x80},\n\t{0x13, 0xcf},\n\t{0x14, 0x40},\n\t{0x15, 0x00},\n\t{0x01, 0x80},\n\t{0x02, 0x80},\n\t{0x04, 0x70},\n\t{0x0d, 0x40},\n\t{0x0f, 0x47},\n\t{0x11, 0x81},\n\t{0x32, 0x36},\n\t{0x33, 0x0C},\n\t{0x34, 0x00},\n\t{0x35, 0x90},\n\t{0x12, 0x40},\n\t{0x17, 0x1f},\n\t{0x18, 0x5f},\n\t{0x19, 0x00},\n\t{0x1a, 0x68},\n};\n\nstatic const u8 ov361x_bridge_start_160[][2] = {\n\t{0xf1, 0x60},   \n\t{0x88, 0x00},   \n\t{0x89, 0x04},   \n\t{0x8a, 0x00},   \n\t{0x8b, 0x03},   \n\t{0x8c, 0x01},   \n\t{0x8d, 0x10},\n\t{0x1c, 0x00},   \n\t{0x1d, 0x48},\n\t{0x1d, 0x00},\n\t{0x1d, 0xff},\n\t{0x1c, 0x0a},   \n\t{0x1d, 0x2e},   \n\t{0x1d, 0x1e},\n};\n\nstatic const u8 bridge_init[][2] = {\n\t{0x88, 0xf8},\n\t{0x89, 0xff},\n\t{0x76, 0x03},\n\t{0x92, 0x03},\n\t{0x95, 0x10},\n\t{0xe2, 0x00},\n\t{0xe7, 0x3e},\n\t{0x8d, 0x1c},\n\t{0x8e, 0x00},\n\t{0x8f, 0x00},\n\t{0x1f, 0x00},\n\t{0xc3, 0xf9},\n\t{0x89, 0xff},\n\t{0x88, 0xf8},\n\t{0x76, 0x03},\n\t{0x92, 0x01},\n\t{0x93, 0x18},\n\t{0x1c, 0x0a},\n\t{0x1d, 0x48},\n\t{0xc0, 0x50},\n\t{0xc1, 0x3c},\n\t{0x34, 0x05},\n\t{0xc2, 0x0c},\n\t{0xc3, 0xf9},\n\t{0x34, 0x05},\n\t{0xe7, 0x2e},\n\t{0x31, 0xf9},\n\t{0x35, 0x02},\n\t{0xd9, 0x10},\n\t{0x25, 0x42},\n\t{0x94, 0x11},\n};\n\nstatic const u8 ov965x_init[][2] = {\n\t{0x12, 0x80},\t \n\t{0x00, 0x00},\t \n\t{0x01, 0x80},\t \n\t{0x02, 0x80},\t \n\t{0x03, 0x1b},\t \n\t{0x04, 0x03},\t \n\t{0x0b, 0x57},\t \n\t{0x0e, 0x61},\t \n\t{0x0f, 0x42},\t \n\t{0x11, 0x00},\t \n\t{0x12, 0x02},\t \n\t{0x13, 0xe7},\t \n\t{0x14, 0x28},\t \n\t{0x16, 0x24},\t \n\t{0x17, 0x1d},\t \n\t{0x18, 0xbd},\t \n\t{0x19, 0x01},\t \n\t{0x1a, 0x81},\t \n\t{0x1e, 0x04},\t \n\t{0x24, 0x3c},\t \n\t{0x25, 0x36},\t \n\t{0x26, 0x71},\t \n\t{0x27, 0x08},\t \n\t{0x28, 0x08},\t \n\t{0x29, 0x15},\t \n\t{0x2a, 0x00},\t \n\t{0x2b, 0x00},\t \n\t{0x2c, 0x08},\t \n\t{0x32, 0xff},\t \n\t{0x33, 0x00},\t \n\t{0x34, 0x3f},\t \n\t{0x35, 0x00},\t \n\t{0x36, 0xf8},\t \n\t{0x38, 0x72},\t \n\t{0x39, 0x57},\t \n\t{0x3a, 0x80},\t \n\t{0x3b, 0xc4},\t \n\t{0x3d, 0x99},\t \n\t{0x3f, 0xc1},\t \n\t{0x40, 0xc0},\t \n\t{0x41, 0x40},\t \n\t{0x42, 0xc0},\t \n\t{0x43, 0x0a},\t \n\t{0x44, 0xf0},\n\t{0x45, 0x46},\n\t{0x46, 0x62},\n\t{0x47, 0x2a},\n\t{0x48, 0x3c},\n\t{0x4a, 0xfc},\n\t{0x4b, 0xfc},\n\t{0x4c, 0x7f},\n\t{0x4d, 0x7f},\n\t{0x4e, 0x7f},\n\t{0x4f, 0x98},\t \n\t{0x50, 0x98},\n\t{0x51, 0x00},\n\t{0x52, 0x28},\n\t{0x53, 0x70},\n\t{0x54, 0x98},\n\t{0x58, 0x1a},\t \n\t{0x59, 0x85},\t \n\t{0x5a, 0xa9},\n\t{0x5b, 0x64},\n\t{0x5c, 0x84},\n\t{0x5d, 0x53},\n\t{0x5e, 0x0e},\n\t{0x5f, 0xf0},\t \n\t{0x60, 0xf0},\t \n\t{0x61, 0xf0},\t \n\t{0x62, 0x00},\t \n\t{0x63, 0x00},\t \n\t{0x64, 0x02},\t \n\t{0x65, 0x16},\t \n\t{0x66, 0x01},\t \n\t{0x69, 0x02},\t \n\t{0x6b, 0x5a},\t \n\t{0x6c, 0x04},\n\t{0x6d, 0x55},\n\t{0x6e, 0x00},\n\t{0x6f, 0x9d},\n\t{0x70, 0x21},\t \n\t{0x71, 0x78},\n\t{0x72, 0x00},\t \n\t{0x73, 0x01},\t \n\t{0x74, 0x3a},\t \n\t{0x75, 0x35},\t \n\t{0x76, 0x01},\n\t{0x77, 0x02},\n\t{0x7a, 0x12},\t \n\t{0x7b, 0x08},\n\t{0x7c, 0x16},\n\t{0x7d, 0x30},\n\t{0x7e, 0x5e},\n\t{0x7f, 0x72},\n\t{0x80, 0x82},\n\t{0x81, 0x8e},\n\t{0x82, 0x9a},\n\t{0x83, 0xa4},\n\t{0x84, 0xac},\n\t{0x85, 0xb8},\n\t{0x86, 0xc3},\n\t{0x87, 0xd6},\n\t{0x88, 0xe6},\n\t{0x89, 0xf2},\n\t{0x8a, 0x03},\n\t{0x8c, 0x89},\t \n\t{0x14, 0x28},\t \n\t{0x90, 0x7d},\n\t{0x91, 0x7b},\n\t{0x9d, 0x03},\t \n\t{0x9e, 0x04},\t \n\t{0x9f, 0x7a},\n\t{0xa0, 0x79},\n\t{0xa1, 0x40},\t \n\t{0xa4, 0x50},\t \n\t{0xa5, 0x68},\t \n\t{0xa6, 0x4a},\t \n\t{0xa8, 0xc1},\t \n\t{0xa9, 0xef},\t \n\t{0xaa, 0x92},\n\t{0xab, 0x04},\n\t{0xac, 0x80},\t \n\t{0xad, 0x80},\n\t{0xae, 0x80},\n\t{0xaf, 0x80},\n\t{0xb2, 0xf2},\n\t{0xb3, 0x20},\n\t{0xb4, 0x20},\t \n\t{0xb5, 0x00},\n\t{0xb6, 0xaf},\n\t{0xbb, 0xae},\n\t{0xbc, 0x7f},\t \n\t{0xdb, 0x7f},\n\t{0xbe, 0x7f},\n\t{0xbf, 0x7f},\n\t{0xc0, 0xe2},\n\t{0xc1, 0xc0},\n\t{0xc2, 0x01},\n\t{0xc3, 0x4e},\n\t{0xc6, 0x85},\n\t{0xc7, 0x80},\t \n\t{0xc9, 0xe0},\n\t{0xca, 0xe8},\n\t{0xcb, 0xf0},\n\t{0xcc, 0xd8},\n\t{0xcd, 0xf1},\n\t{0x4f, 0x98},\t \n\t{0x50, 0x98},\n\t{0x51, 0x00},\n\t{0x52, 0x28},\n\t{0x53, 0x70},\n\t{0x54, 0x98},\n\t{0x58, 0x1a},\n\t{0xff, 0x41},\t \n\t{0x41, 0x40},\t \n\n\t{0xc5, 0x03},\t \n\t{0x6a, 0x02},\t \n\n\t{0x12, 0x62},\t \n\t{0x36, 0xfa},\t \n\t{0x69, 0x0a},\t \n\t{0x8c, 0x89},\t \n\t{0x14, 0x28},\t \n\t{0x3e, 0x0c},\n\t{0x41, 0x40},\t \n\t{0x72, 0x00},\n\t{0x73, 0x00},\n\t{0x74, 0x3a},\n\t{0x75, 0x35},\n\t{0x76, 0x01},\n\t{0xc7, 0x80},\n\t{0x03, 0x12},\t \n\t{0x17, 0x16},\t \n\t{0x18, 0x02},\t \n\t{0x19, 0x01},\t \n\t{0x1a, 0x3d},\t \n\t{0x32, 0xff},\t \n\t{0xc0, 0xaa},\n};\n\nstatic const u8 bridge_init_2[][2] = {\n\t{0x94, 0xaa},\n\t{0xf1, 0x60},\n\t{0xe5, 0x04},\n\t{0xc0, 0x50},\n\t{0xc1, 0x3c},\n\t{0x8c, 0x00},\n\t{0x8d, 0x1c},\n\t{0x34, 0x05},\n\n\t{0xc2, 0x0c},\n\t{0xc3, 0xf9},\n\t{0xda, 0x01},\n\t{0x50, 0x00},\n\t{0x51, 0xa0},\n\t{0x52, 0x3c},\n\t{0x53, 0x00},\n\t{0x54, 0x00},\n\t{0x55, 0x00},\n\t{0x57, 0x00},\n\t{0x5c, 0x00},\n\t{0x5a, 0xa0},\n\t{0x5b, 0x78},\n\t{0x35, 0x02},\n\t{0xd9, 0x10},\n\t{0x94, 0x11},\n};\n\nstatic const u8 ov965x_init_2[][2] = {\n\t{0x3b, 0xc4},\n\t{0x1e, 0x04},\t \n\t{0x13, 0xe0},\t \n\t{0x00, 0x00},\t \n\t{0x13, 0xe7},\t \n\t{0x11, 0x03},\t \n\t{0x6b, 0x5a},\t \n\t{0x6a, 0x05},\n\t{0xc5, 0x07},\n\t{0xa2, 0x4b},\n\t{0xa3, 0x3e},\n\t{0x2d, 0x00},\n\t{0xff, 0x42},\t \n\t{0x42, 0xc0},\t \n\t{0x2d, 0x00},\n\t{0xff, 0x42},\t \n\t{0x42, 0xc1},\t \n \n\t{0x3f, 0x01},\n\t{0xff, 0x42},\t \n\t{0x42, 0xc1},\t \n \n\t{0x4f, 0x98},\t \n\t{0x50, 0x98},\n\t{0x51, 0x00},\n\t{0x52, 0x28},\n\t{0x53, 0x70},\n\t{0x54, 0x98},\n\t{0x58, 0x1a},\n\t{0xff, 0x41},\t \n\t{0x41, 0x40},\t \n \n\t{0x56, 0x40},\n \n\t{0x55, 0x8f},\n \n\t{0x10, 0x25},\t \n\t{0xff, 0x13},\t \n\t{0x13, 0xe7},\t \n};\n\nstatic const u8 ov971x_init[][2] = {\n\t{0x12, 0x80},\n\t{0x09, 0x10},\n\t{0x1e, 0x07},\n\t{0x5f, 0x18},\n\t{0x69, 0x04},\n\t{0x65, 0x2a},\n\t{0x68, 0x0a},\n\t{0x39, 0x28},\n\t{0x4d, 0x90},\n\t{0xc1, 0x80},\n\t{0x0c, 0x30},\n\t{0x6d, 0x02},\n\t{0x96, 0xf1},\n\t{0xbc, 0x68},\n\t{0x12, 0x00},\n\t{0x3b, 0x00},\n\t{0x97, 0x80},\n\t{0x17, 0x25},\n\t{0x18, 0xa2},\n\t{0x19, 0x01},\n\t{0x1a, 0xca},\n\t{0x03, 0x0a},\n\t{0x32, 0x07},\n\t{0x98, 0x40},\t \n\t{0x99, 0xA0},\t \n\t{0x9a, 0x01},\t \n\t{0x57, 0x00},\n\t{0x58, 0x78},\t \n\t{0x59, 0x50},\t \n\t{0x4c, 0x13},\n\t{0x4b, 0x36},\n\t{0x3d, 0x3c},\n\t{0x3e, 0x03},\n\t{0xbd, 0x50},\t \n\t{0xbe, 0x78},\t \n\t{0x4e, 0x55},\n\t{0x4f, 0x55},\n\t{0x50, 0x55},\n\t{0x51, 0x55},\n\t{0x24, 0x55},\n\t{0x25, 0x40},\n\t{0x26, 0xa1},\n\t{0x5c, 0x59},\n\t{0x5d, 0x00},\n\t{0x11, 0x00},\n\t{0x2a, 0x98},\n\t{0x2b, 0x06},\n\t{0x2d, 0x00},\n\t{0x2e, 0x00},\n\t{0x13, 0xa5},\n\t{0x14, 0x40},\n\t{0x4a, 0x00},\n\t{0x49, 0xce},\n\t{0x22, 0x03},\n\t{0x09, 0x00}\n};\n\nstatic const u8 ov965x_start_1_vga[][2] = {\t \n\t{0x12, 0x62},\t \n\t{0x36, 0xfa},\t \n\t{0x69, 0x0a},\t \n\t{0x8c, 0x89},\t \n\t{0x14, 0x28},\t \n\t{0x3e, 0x0c},\t \n\t{0x41, 0x40},\t \n\t{0x72, 0x00},\n\t{0x73, 0x00},\n\t{0x74, 0x3a},\n\t{0x75, 0x35},\n\t{0x76, 0x01},\n\t{0xc7, 0x80},\t \n\t{0x03, 0x12},\t \n\t{0x17, 0x16},\t \n\t{0x18, 0x02},\t \n\t{0x19, 0x01},\t \n\t{0x1a, 0x3d},\t \n\t{0x32, 0xff},\t \n\t{0xc0, 0xaa},\n};\n\nstatic const u8 ov965x_start_1_svga[][2] = {\n\t{0x12, 0x02},\t \n\t{0x36, 0xf8},\t \n\t{0x69, 0x02},\t \n\t{0x8c, 0x0d},\t \n\t{0x3e, 0x0c},\t \n\t{0x41, 0x40},\t \n\t{0x72, 0x00},\n\t{0x73, 0x01},\n\t{0x74, 0x3a},\n\t{0x75, 0x35},\n\t{0x76, 0x01},\n\t{0xc7, 0x80},\t \n\t{0x03, 0x1b},\t \n\t{0x17, 0x1d},\t \n\t{0x18, 0xbd},\t \n\t{0x19, 0x01},\t \n\t{0x1a, 0x81},\t \n\t{0x32, 0xff},\t \n\t{0xc0, 0xe2},\n};\n\nstatic const u8 ov965x_start_1_xga[][2] = {\n\t{0x12, 0x02},\t \n\t{0x36, 0xf8},\t \n\t{0x69, 0x02},\t \n\t{0x8c, 0x89},\t \n\t{0x14, 0x28},\t \n\t{0x3e, 0x0c},\t \n\t{0x41, 0x40},\t \n\t{0x72, 0x00},\n\t{0x73, 0x01},\n\t{0x74, 0x3a},\n\t{0x75, 0x35},\n\t{0x76, 0x01},\n\t{0xc7, 0x80},\t \n\t{0x03, 0x1b},\t \n\t{0x17, 0x1d},\t \n\t{0x18, 0xbd},\t \n\t{0x19, 0x01},\t \n\t{0x1a, 0x81},\t \n\t{0x32, 0xff},\t \n\t{0xc0, 0xe2},\n};\n\nstatic const u8 ov965x_start_1_sxga[][2] = {\n\t{0x12, 0x02},\t \n\t{0x36, 0xf8},\t \n\t{0x69, 0x02},\t \n\t{0x8c, 0x89},\t \n\t{0x14, 0x28},\t \n\t{0x3e, 0x0c},\t \n\t{0x41, 0x40},\t \n\t{0x72, 0x00},\n\t{0x73, 0x01},\n\t{0x74, 0x3a},\n\t{0x75, 0x35},\n\t{0x76, 0x01},\n\t{0xc7, 0x80},\t \n\t{0x03, 0x1b},\t \n\t{0x17, 0x1d},\t \n\t{0x18, 0x02},\t \n\t{0x19, 0x01},\t \n\t{0x1a, 0x81},\t \n\t{0x32, 0xff},\t \n\t{0xc0, 0xe2},\n};\n\nstatic const u8 bridge_start_qvga[][2] = {\n\t{0x94, 0xaa},\n\t{0xf1, 0x60},\n\t{0xe5, 0x04},\n\t{0xc0, 0x50},\n\t{0xc1, 0x3c},\n\t{0x8c, 0x00},\n\t{0x8d, 0x1c},\n\t{0x34, 0x05},\n\n\t{0xc2, 0x4c},\n\t{0xc3, 0xf9},\n\t{0xda, 0x00},\n\t{0x50, 0x00},\n\t{0x51, 0xa0},\n\t{0x52, 0x78},\n\t{0x53, 0x00},\n\t{0x54, 0x00},\n\t{0x55, 0x00},\n\t{0x57, 0x00},\n\t{0x5c, 0x00},\n\t{0x5a, 0x50},\n\t{0x5b, 0x3c},\n\t{0x35, 0x02},\n\t{0xd9, 0x10},\n\t{0x94, 0x11},\n};\n\nstatic const u8 bridge_start_vga[][2] = {\n\t{0x94, 0xaa},\n\t{0xf1, 0x60},\n\t{0xe5, 0x04},\n\t{0xc0, 0x50},\n\t{0xc1, 0x3c},\n\t{0x8c, 0x00},\n\t{0x8d, 0x1c},\n\t{0x34, 0x05},\n\t{0xc2, 0x0c},\n\t{0xc3, 0xf9},\n\t{0xda, 0x01},\n\t{0x50, 0x00},\n\t{0x51, 0xa0},\n\t{0x52, 0x3c},\n\t{0x53, 0x00},\n\t{0x54, 0x00},\n\t{0x55, 0x00},\n\t{0x57, 0x00},\n\t{0x5c, 0x00},\n\t{0x5a, 0xa0},\n\t{0x5b, 0x78},\n\t{0x35, 0x02},\n\t{0xd9, 0x10},\n\t{0x94, 0x11},\n};\n\nstatic const u8 bridge_start_svga[][2] = {\n\t{0x94, 0xaa},\n\t{0xf1, 0x60},\n\t{0xe5, 0x04},\n\t{0xc0, 0xa0},\n\t{0xc1, 0x80},\n\t{0x8c, 0x00},\n\t{0x8d, 0x1c},\n\t{0x34, 0x05},\n\t{0xc2, 0x4c},\n\t{0xc3, 0xf9},\n\t{0x50, 0x00},\n\t{0x51, 0x40},\n\t{0x52, 0x00},\n\t{0x53, 0x00},\n\t{0x54, 0x00},\n\t{0x55, 0x88},\n\t{0x57, 0x00},\n\t{0x5c, 0x00},\n\t{0x5a, 0xc8},\n\t{0x5b, 0x96},\n\t{0x35, 0x02},\n\t{0xd9, 0x10},\n\t{0xda, 0x00},\n\t{0x94, 0x11},\n};\n\nstatic const u8 bridge_start_xga[][2] = {\n\t{0x94, 0xaa},\n\t{0xf1, 0x60},\n\t{0xe5, 0x04},\n\t{0xc0, 0xa0},\n\t{0xc1, 0x80},\n\t{0x8c, 0x00},\n\t{0x8d, 0x1c},\n\t{0x34, 0x05},\n\t{0xc2, 0x4c},\n\t{0xc3, 0xf9},\n\t{0x50, 0x00},\n\t{0x51, 0x40},\n\t{0x52, 0x00},\n\t{0x53, 0x00},\n\t{0x54, 0x00},\n\t{0x55, 0x88},\n\t{0x57, 0x00},\n\t{0x5c, 0x01},\n\t{0x5a, 0x00},\n\t{0x5b, 0xc0},\n\t{0x35, 0x02},\n\t{0xd9, 0x10},\n\t{0xda, 0x01},\n\t{0x94, 0x11},\n};\n\nstatic const u8 bridge_start_sxga[][2] = {\n\t{0x94, 0xaa},\n\t{0xf1, 0x60},\n\t{0xe5, 0x04},\n\t{0xc0, 0xa0},\n\t{0xc1, 0x80},\n\t{0x8c, 0x00},\n\t{0x8d, 0x1c},\n\t{0x34, 0x05},\n\t{0xc2, 0x0c},\n\t{0xc3, 0xf9},\n\t{0xda, 0x00},\n\t{0x35, 0x02},\n\t{0xd9, 0x10},\n\t{0x94, 0x11},\n};\n\nstatic const u8 ov965x_start_2_qvga[][2] = {\n\t{0x3b, 0xe4},\t \n\t{0x1e, 0x04},\t \n\t{0x13, 0xe0},\t \n\t{0x00, 0x00},\n\t{0x13, 0xe7},\t \n\t{0x11, 0x01},\t \n\t{0x6b, 0x5a},\t \n\t{0x6a, 0x02},\t \n\t{0xc5, 0x03},\t \n\t{0xa2, 0x96},\t \n\t{0xa3, 0x7d},\t \n\n\t{0xff, 0x13},\t \n\t{0x13, 0xe7},\n\t{0x3a, 0x80},\t \n};\n\nstatic const u8 ov965x_start_2_vga[][2] = {\n\t{0x3b, 0xc4},\t \n\t{0x1e, 0x04},\t \n\t{0x13, 0xe0},\t \n\t{0x00, 0x00},\n\t{0x13, 0xe7},\t \n\t{0x11, 0x03},\t \n\t{0x6b, 0x5a},\t \n\t{0x6a, 0x05},\t \n\t{0xc5, 0x07},\t \n\t{0xa2, 0x4b},\t \n\t{0xa3, 0x3e},\t \n\n\t{0x2d, 0x00},\t \n};\n\nstatic const u8 ov965x_start_2_svga[][2] = {\t \n\t{0x3b, 0xc4},\t \n\t{0x1e, 0x04},\t \n\t{0x13, 0xe0},\t \n\t{0x00, 0x00},\n\t{0x13, 0xe7},\t \n\t{0x11, 0x01},\t \n\t{0x6b, 0x5a},\t \n\t{0x6a, 0x0c},\t \n\t{0xc5, 0x0f},\t \n\t{0xa2, 0x4e},\t \n\t{0xa3, 0x41},\t \n};\n\nstatic const u8 ov965x_start_2_sxga[][2] = {\n\t{0x13, 0xe0},\t \n\t{0x00, 0x00},\n\t{0x13, 0xe7},\t \n\t{0x3b, 0xc4},\t \n\t{0x1e, 0x04},\t \n\t{0x11, 0x01},\t \n\t{0x6b, 0x5a},\t \n\t{0x6a, 0x0c},\t \n\t{0xc5, 0x0f},\t \n\t{0xa2, 0x4e},\t \n\t{0xa3, 0x41},\t \n};\n\nstatic const u8 ov562x_init[][2] = {\n\t{0x88, 0x20},\n\t{0x89, 0x0a},\n\t{0x8a, 0x90},\n\t{0x8b, 0x06},\n\t{0x8c, 0x01},\n\t{0x8d, 0x10},\n\t{0x1c, 0x00},\n\t{0x1d, 0x48},\n\t{0x1d, 0x00},\n\t{0x1d, 0xff},\n\t{0x1c, 0x0a},\n\t{0x1d, 0x2e},\n\t{0x1d, 0x1e},\n};\n\nstatic const u8 ov562x_init_2[][2] = {\n\t{0x12, 0x80},\n\t{0x11, 0x41},\n\t{0x13, 0x00},\n\t{0x10, 0x1e},\n\t{0x3b, 0x07},\n\t{0x5b, 0x40},\n\t{0x39, 0x07},\n\t{0x53, 0x02},\n\t{0x54, 0x60},\n\t{0x04, 0x20},\n\t{0x27, 0x04},\n\t{0x3d, 0x40},\n\t{0x36, 0x00},\n\t{0xc5, 0x04},\n\t{0x4e, 0x00},\n\t{0x4f, 0x93},\n\t{0x50, 0x7b},\n\t{0xca, 0x0c},\n\t{0xcb, 0x0f},\n\t{0x39, 0x07},\n\t{0x4a, 0x10},\n\t{0x3e, 0x0a},\n\t{0x3d, 0x00},\n\t{0x0c, 0x38},\n\t{0x38, 0x90},\n\t{0x46, 0x30},\n\t{0x4f, 0x93},\n\t{0x50, 0x7b},\n\t{0xab, 0x00},\n\t{0xca, 0x0c},\n\t{0xcb, 0x0f},\n\t{0x37, 0x02},\n\t{0x44, 0x48},\n\t{0x8d, 0x44},\n\t{0x2a, 0x00},\n\t{0x2b, 0x00},\n\t{0x32, 0x00},\n\t{0x38, 0x90},\n\t{0x53, 0x02},\n\t{0x54, 0x60},\n\t{0x12, 0x00},\n\t{0x17, 0x12},\n\t{0x18, 0xb4},\n\t{0x19, 0x0c},\n\t{0x1a, 0xf4},\n\t{0x03, 0x4a},\n\t{0x89, 0x20},\n\t{0x83, 0x80},\n\t{0xb7, 0x9d},\n\t{0xb6, 0x11},\n\t{0xb5, 0x55},\n\t{0xb4, 0x00},\n\t{0xa9, 0xf0},\n\t{0xa8, 0x0a},\n\t{0xb8, 0xf0},\n\t{0xb9, 0xf0},\n\t{0xba, 0xf0},\n\t{0x81, 0x07},\n\t{0x63, 0x44},\n\t{0x13, 0xc7},\n\t{0x14, 0x60},\n\t{0x33, 0x75},\n\t{0x2c, 0x00},\n\t{0x09, 0x00},\n\t{0x35, 0x30},\n\t{0x27, 0x04},\n\t{0x3c, 0x07},\n\t{0x3a, 0x0a},\n\t{0x3b, 0x07},\n\t{0x01, 0x40},\n\t{0x02, 0x40},\n\t{0x16, 0x40},\n\t{0x52, 0xb0},\n\t{0x51, 0x83},\n\t{0x21, 0xbb},\n\t{0x22, 0x10},\n\t{0x23, 0x03},\n\t{0x35, 0x38},\n\t{0x20, 0x90},\n\t{0x28, 0x30},\n\t{0x73, 0xe1},\n\t{0x6c, 0x00},\n\t{0x6d, 0x80},\n\t{0x6e, 0x00},\n\t{0x70, 0x04},\n\t{0x71, 0x00},\n\t{0x8d, 0x04},\n\t{0x64, 0x00},\n\t{0x65, 0x00},\n\t{0x66, 0x00},\n\t{0x67, 0x00},\n\t{0x68, 0x00},\n\t{0x69, 0x00},\n\t{0x6a, 0x00},\n\t{0x6b, 0x00},\n\t{0x71, 0x94},\n\t{0x74, 0x20},\n\t{0x80, 0x09},\n\t{0x85, 0xc0},\n};\n\nstatic void reg_w_i(struct gspca_dev *gspca_dev, u16 reg, u8 val)\n{\n\tstruct usb_device *udev = gspca_dev->dev;\n\tint ret;\n\n\tif (gspca_dev->usb_err < 0)\n\t\treturn;\n\tgspca_dev->usb_buf[0] = val;\n\tret = usb_control_msg(udev,\n\t\t\t      usb_sndctrlpipe(udev, 0),\n\t\t\t      0x01,\n\t\t\t      USB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_DEVICE,\n\t\t\t      0x00, reg, gspca_dev->usb_buf, 1, CTRL_TIMEOUT);\n\tif (ret < 0) {\n\t\tpr_err(\"reg_w failed %d\\n\", ret);\n\t\tgspca_dev->usb_err = ret;\n\t}\n}\n\nstatic void reg_w(struct gspca_dev *gspca_dev, u16 reg, u8 val)\n{\n\tgspca_dbg(gspca_dev, D_USBO, \"reg_w [%04x] = %02x\\n\", reg, val);\n\treg_w_i(gspca_dev, reg, val);\n}\n\nstatic u8 reg_r(struct gspca_dev *gspca_dev, u16 reg)\n{\n\tstruct usb_device *udev = gspca_dev->dev;\n\tint ret;\n\n\tif (gspca_dev->usb_err < 0)\n\t\treturn 0;\n\tret = usb_control_msg(udev,\n\t\t\t      usb_rcvctrlpipe(udev, 0),\n\t\t\t      0x01,\n\t\t\t      USB_DIR_IN | USB_TYPE_VENDOR | USB_RECIP_DEVICE,\n\t\t\t      0x00, reg, gspca_dev->usb_buf, 1, CTRL_TIMEOUT);\n\tgspca_dbg(gspca_dev, D_USBI, \"reg_r [%04x] -> %02x\\n\",\n\t\t  reg, gspca_dev->usb_buf[0]);\n\tif (ret < 0) {\n\t\tpr_err(\"reg_r err %d\\n\", ret);\n\t\tgspca_dev->usb_err = ret;\n\t\treturn 0;\n\t}\n\treturn gspca_dev->usb_buf[0];\n}\n\nstatic int sccb_check_status(struct gspca_dev *gspca_dev)\n{\n\tu8 data;\n\tint i;\n\n\tfor (i = 0; i < 5; i++) {\n\t\tmsleep(20);\n\t\tdata = reg_r(gspca_dev, OV534_REG_STATUS);\n\n\t\tswitch (data) {\n\t\tcase 0x00:\n\t\t\treturn 1;\n\t\tcase 0x04:\n\t\t\treturn 0;\n\t\tcase 0x03:\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tgspca_dbg(gspca_dev, D_USBI|D_USBO,\n\t\t\t\t  \"sccb status 0x%02x, attempt %d/5\\n\",\n\t\t\t\t  data, i + 1);\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic void sccb_write(struct gspca_dev *gspca_dev, u8 reg, u8 val)\n{\n\tgspca_dbg(gspca_dev, D_USBO, \"sccb_write [%02x] = %02x\\n\", reg, val);\n\treg_w_i(gspca_dev, OV534_REG_SUBADDR, reg);\n\treg_w_i(gspca_dev, OV534_REG_WRITE, val);\n\treg_w_i(gspca_dev, OV534_REG_OPERATION, OV534_OP_WRITE_3);\n\n\tif (!sccb_check_status(gspca_dev))\n\t\tpr_err(\"sccb_write failed\\n\");\n}\n\nstatic u8 sccb_read(struct gspca_dev *gspca_dev, u16 reg)\n{\n\treg_w(gspca_dev, OV534_REG_SUBADDR, reg);\n\treg_w(gspca_dev, OV534_REG_OPERATION, OV534_OP_WRITE_2);\n\tif (!sccb_check_status(gspca_dev))\n\t\tpr_err(\"sccb_read failed 1\\n\");\n\n\treg_w(gspca_dev, OV534_REG_OPERATION, OV534_OP_READ_2);\n\tif (!sccb_check_status(gspca_dev))\n\t\tpr_err(\"sccb_read failed 2\\n\");\n\n\treturn reg_r(gspca_dev, OV534_REG_READ);\n}\n\n \nstatic void reg_w_array(struct gspca_dev *gspca_dev,\n\t\t\tconst u8 (*data)[2], int len)\n{\n\twhile (--len >= 0) {\n\t\treg_w(gspca_dev, (*data)[0], (*data)[1]);\n\t\tdata++;\n\t}\n}\n\n \nstatic void sccb_w_array(struct gspca_dev *gspca_dev,\n\t\t\tconst u8 (*data)[2], int len)\n{\n\twhile (--len >= 0) {\n\t\tif ((*data)[0] != 0xff) {\n\t\t\tsccb_write(gspca_dev, (*data)[0], (*data)[1]);\n\t\t} else {\n\t\t\tsccb_read(gspca_dev, (*data)[1]);\n\t\t\tsccb_write(gspca_dev, 0xff, 0x00);\n\t\t}\n\t\tdata++;\n\t}\n}\n\n \nstatic void set_led(struct gspca_dev *gspca_dev, int status)\n{\n\tu8 data;\n\n\tgspca_dbg(gspca_dev, D_CONF, \"led status: %d\\n\", status);\n\n\tdata = reg_r(gspca_dev, 0x21);\n\tdata |= 0x80;\n\treg_w(gspca_dev, 0x21, data);\n\n\tdata = reg_r(gspca_dev, 0x23);\n\tif (status)\n\t\tdata |= 0x80;\n\telse\n\t\tdata &= ~0x80;\n\n\treg_w(gspca_dev, 0x23, data);\n\n\tif (!status) {\n\t\tdata = reg_r(gspca_dev, 0x21);\n\t\tdata &= ~0x80;\n\t\treg_w(gspca_dev, 0x21, data);\n\t}\n}\n\nstatic void setbrightness(struct gspca_dev *gspca_dev, s32 brightness)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\tu8 val;\n\ts8 sval;\n\n\tif (sd->sensor == SENSOR_OV562x) {\n\t\tsval = brightness;\n\t\tval = 0x76;\n\t\tval += sval;\n\t\tsccb_write(gspca_dev, 0x24, val);\n\t\tval = 0x6a;\n\t\tval += sval;\n\t\tsccb_write(gspca_dev, 0x25, val);\n\t\tif (sval < -40)\n\t\t\tval = 0x71;\n\t\telse if (sval < 20)\n\t\t\tval = 0x94;\n\t\telse\n\t\t\tval = 0xe6;\n\t\tsccb_write(gspca_dev, 0x26, val);\n\t} else {\n\t\tval = brightness;\n\t\tif (val < 8)\n\t\t\tval = 15 - val;\t\t \n\t\telse\n\t\t\tval = val - 8;\t\t \n\t\tsccb_write(gspca_dev, 0x55,\t \n\t\t\t\t0x0f | (val << 4));\n\t}\n}\n\nstatic void setcontrast(struct gspca_dev *gspca_dev, s32 val)\n{\n\tsccb_write(gspca_dev, 0x56,\t \n\t\t\tval << 4);\n}\n\nstatic void setautogain(struct gspca_dev *gspca_dev, s32 autogain)\n{\n\tu8 val;\n\n \n\tval = sccb_read(gspca_dev, 0x13);\t\t \n\tsccb_write(gspca_dev, 0xff, 0x00);\n\tif (autogain)\n\t\tval |= 0x05;\t\t \n\telse\n\t\tval &= 0xfa;\n\tsccb_write(gspca_dev, 0x13, val);\n}\n\nstatic void setexposure(struct gspca_dev *gspca_dev, s32 exposure)\n{\n\tstatic const u8 expo[4] = {0x00, 0x25, 0x38, 0x5e};\n\tu8 val;\n\n\tsccb_write(gspca_dev, 0x10, expo[exposure]);\t \n\n\tval = sccb_read(gspca_dev, 0x13);\t\t \n\tsccb_write(gspca_dev, 0xff, 0x00);\n\tsccb_write(gspca_dev, 0x13, val);\n\n\tval = sccb_read(gspca_dev, 0xa1);\t\t \n\tsccb_write(gspca_dev, 0xff, 0x00);\n\tsccb_write(gspca_dev, 0xa1, val & 0xe0);\t \n}\n\nstatic void setsharpness(struct gspca_dev *gspca_dev, s32 val)\n{\n\tif (val < 0) {\t\t\t\t \n\t\tval = sccb_read(gspca_dev, 0x42);\t \n\t\tsccb_write(gspca_dev, 0xff, 0x00);\n\t\tsccb_write(gspca_dev, 0x42, val | 0x40);\n\t\t\t\t \n\t\treturn;\n\t}\n\tif (val != 0)\n\t\tval = 1 << (val - 1);\n\tsccb_write(gspca_dev, 0x3f,\t \n\t\t\tval);\n\tval = sccb_read(gspca_dev, 0x42);\t\t \n\tsccb_write(gspca_dev, 0xff, 0x00);\n\tsccb_write(gspca_dev, 0x42, val & 0xbf);\n}\n\nstatic void setsatur(struct gspca_dev *gspca_dev, s32 val)\n{\n\tu8 val1, val2, val3;\n\tstatic const u8 matrix[5][2] = {\n\t\t{0x14, 0x38},\n\t\t{0x1e, 0x54},\n\t\t{0x28, 0x70},\n\t\t{0x32, 0x8c},\n\t\t{0x48, 0x90}\n\t};\n\n\tval1 = matrix[val][0];\n\tval2 = matrix[val][1];\n\tval3 = val1 + val2;\n\tsccb_write(gspca_dev, 0x4f, val3);\t \n\tsccb_write(gspca_dev, 0x50, val3);\n\tsccb_write(gspca_dev, 0x51, 0x00);\n\tsccb_write(gspca_dev, 0x52, val1);\n\tsccb_write(gspca_dev, 0x53, val2);\n\tsccb_write(gspca_dev, 0x54, val3);\n\tsccb_write(gspca_dev, 0x58, 0x1a);\t \n\n\tval1 = sccb_read(gspca_dev, 0x41);\t \n\tsccb_write(gspca_dev, 0xff, 0x00);\n\tsccb_write(gspca_dev, 0x41, val1);\n}\n\nstatic void setlightfreq(struct gspca_dev *gspca_dev, s32 freq)\n{\n\tu8 val;\n\n\tval = sccb_read(gspca_dev, 0x13);\t\t \n\tsccb_write(gspca_dev, 0xff, 0x00);\n\tif (freq == 0) {\n\t\tsccb_write(gspca_dev, 0x13, val & 0xdf);\n\t\treturn;\n\t}\n\tsccb_write(gspca_dev, 0x13, val | 0x20);\n\n\tval = sccb_read(gspca_dev, 0x42);\t\t \n\tsccb_write(gspca_dev, 0xff, 0x00);\n\tif (freq == 1)\n\t\tval |= 0x01;\n\telse\n\t\tval &= 0xfe;\n\tsccb_write(gspca_dev, 0x42, val);\n}\n\n \nstatic int sd_config(struct gspca_dev *gspca_dev,\n\t\t     const struct usb_device_id *id)\n{\n\treturn 0;\n}\n\n \nstatic int sd_init(struct gspca_dev *gspca_dev)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\tu16 sensor_id;\n\n\t \n\treg_w(gspca_dev, 0xe7, 0x3a);\n\treg_w(gspca_dev, 0xe0, 0x08);\n\tmsleep(100);\n\n\t \n\treg_w(gspca_dev, OV534_REG_ADDRESS, 0x60);\n\n\t \n\tsccb_write(gspca_dev, 0x12, 0x80);\n\tmsleep(10);\n\n\t \n\tsccb_read(gspca_dev, 0x0a);\n\tsensor_id = sccb_read(gspca_dev, 0x0a) << 8;\n\tsccb_read(gspca_dev, 0x0b);\n\tsensor_id |= sccb_read(gspca_dev, 0x0b);\n\tgspca_dbg(gspca_dev, D_PROBE, \"Sensor ID: %04x\\n\", sensor_id);\n\n\t \n\tif ((sensor_id & 0xfff0) == 0x9650) {\n\t\tsd->sensor = SENSOR_OV965x;\n\n\t\tgspca_dev->cam.cam_mode = ov965x_mode;\n\t\tgspca_dev->cam.nmodes = ARRAY_SIZE(ov965x_mode);\n\n\t\treg_w_array(gspca_dev, bridge_init,\n\t\t\t\tARRAY_SIZE(bridge_init));\n\t\tsccb_w_array(gspca_dev, ov965x_init,\n\t\t\t\tARRAY_SIZE(ov965x_init));\n\t\treg_w_array(gspca_dev, bridge_init_2,\n\t\t\t\tARRAY_SIZE(bridge_init_2));\n\t\tsccb_w_array(gspca_dev, ov965x_init_2,\n\t\t\t\tARRAY_SIZE(ov965x_init_2));\n\t\treg_w(gspca_dev, 0xe0, 0x00);\n\t\treg_w(gspca_dev, 0xe0, 0x01);\n\t\tset_led(gspca_dev, 0);\n\t\treg_w(gspca_dev, 0xe0, 0x00);\n\t} else if ((sensor_id & 0xfff0) == 0x9710) {\n\t\tconst char *p;\n\t\tint l;\n\n\t\tsd->sensor = SENSOR_OV971x;\n\n\t\tgspca_dev->cam.cam_mode = ov971x_mode;\n\t\tgspca_dev->cam.nmodes = ARRAY_SIZE(ov971x_mode);\n\n\t\tgspca_dev->cam.bulk = 1;\n\t\tgspca_dev->cam.bulk_size = 16384;\n\t\tgspca_dev->cam.bulk_nurbs = 2;\n\n\t\tsccb_w_array(gspca_dev, ov971x_init,\n\t\t\t\tARRAY_SIZE(ov971x_init));\n\n\t\t \n\t\t \n\t\treg_w(gspca_dev, 0x1c, 0x00);\n\t\t \n\t\treg_w(gspca_dev, 0x1d, 0x00);\n\n\t\t \n\t\tp = video_device_node_name(&gspca_dev->vdev);\n\t\tl = strlen(p) - 1;\n\t\tif (p[l] == '0')\n\t\t\treg_w(gspca_dev, 0x56, 0x1f);\n\t\telse\n\t\t\treg_w(gspca_dev, 0x56, 0x17);\n\t} else if ((sensor_id & 0xfff0) == 0x5620) {\n\t\tsd->sensor = SENSOR_OV562x;\n\t\tgspca_dev->cam.cam_mode = ov562x_mode;\n\t\tgspca_dev->cam.nmodes = ARRAY_SIZE(ov562x_mode);\n\n\t\treg_w_array(gspca_dev, ov562x_init,\n\t\t\t\tARRAY_SIZE(ov562x_init));\n\t\tsccb_w_array(gspca_dev, ov562x_init_2,\n\t\t\t\tARRAY_SIZE(ov562x_init_2));\n\t\treg_w(gspca_dev, 0xe0, 0x00);\n\t} else if ((sensor_id & 0xfff0) == 0x3610) {\n\t\tsd->sensor = SENSOR_OV361x;\n\t\tgspca_dev->cam.cam_mode = ov361x_mode;\n\t\tgspca_dev->cam.nmodes = ARRAY_SIZE(ov361x_mode);\n\t\treg_w(gspca_dev, 0xe7, 0x3a);\n\t\treg_w(gspca_dev, 0xf1, 0x60);\n\t\tsccb_write(gspca_dev, 0x12, 0x80);\n\t} else {\n\t\tpr_err(\"Unknown sensor %04x\", sensor_id);\n\t\treturn -EINVAL;\n\t}\n\n\treturn gspca_dev->usb_err;\n}\n\nstatic int sd_start_ov361x(struct gspca_dev *gspca_dev)\n{\n\tsccb_write(gspca_dev, 0x12, 0x80);\n\tmsleep(20);\n\tswitch (gspca_dev->curr_mode % (ov361x_last)) {\n\tcase ov361x_2048:\n\t\treg_w_array(gspca_dev, ov361x_bridge_start_2048,\n\t\t\t    ARRAY_SIZE(ov361x_bridge_start_2048));\n\t\tsccb_w_array(gspca_dev, ov361x_start_2048,\n\t\t\t     ARRAY_SIZE(ov361x_start_2048));\n\t\tbreak;\n\tcase ov361x_1600:\n\t\treg_w_array(gspca_dev, ov361x_bridge_start_1600,\n\t\t\t    ARRAY_SIZE(ov361x_bridge_start_1600));\n\t\tsccb_w_array(gspca_dev, ov361x_start_1600,\n\t\t\t     ARRAY_SIZE(ov361x_start_1600));\n\t\tbreak;\n\tcase ov361x_1024:\n\t\treg_w_array(gspca_dev, ov361x_bridge_start_1024,\n\t\t\t    ARRAY_SIZE(ov361x_bridge_start_1024));\n\t\tsccb_w_array(gspca_dev, ov361x_start_1024,\n\t\t\t     ARRAY_SIZE(ov361x_start_1024));\n\t\tbreak;\n\tcase ov361x_640:\n\t\treg_w_array(gspca_dev, ov361x_bridge_start_640,\n\t\t\t    ARRAY_SIZE(ov361x_bridge_start_640));\n\t\tsccb_w_array(gspca_dev, ov361x_start_640,\n\t\t\t     ARRAY_SIZE(ov361x_start_640));\n\t\tbreak;\n\tcase ov361x_320:\n\t\treg_w_array(gspca_dev, ov361x_bridge_start_320,\n\t\t\t    ARRAY_SIZE(ov361x_bridge_start_320));\n\t\tsccb_w_array(gspca_dev, ov361x_start_320,\n\t\t\t     ARRAY_SIZE(ov361x_start_320));\n\t\tbreak;\n\tcase ov361x_160:\n\t\treg_w_array(gspca_dev, ov361x_bridge_start_160,\n\t\t\t    ARRAY_SIZE(ov361x_bridge_start_160));\n\t\tsccb_w_array(gspca_dev, ov361x_start_160,\n\t\t\t     ARRAY_SIZE(ov361x_start_160));\n\t\tbreak;\n\t}\n\treg_w(gspca_dev, 0xe0, 0x00);  \n\n\treturn gspca_dev->usb_err;\n}\n\nstatic int sd_start(struct gspca_dev *gspca_dev)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\n\tif (sd->sensor == SENSOR_OV971x)\n\t\treturn gspca_dev->usb_err;\n\tif (sd->sensor == SENSOR_OV562x)\n\t\treturn gspca_dev->usb_err;\n\tif (sd->sensor == SENSOR_OV361x)\n\t\treturn sd_start_ov361x(gspca_dev);\n\n\tswitch (gspca_dev->curr_mode) {\n\tcase QVGA_MODE:\t\t\t \n\t\tsccb_w_array(gspca_dev, ov965x_start_1_vga,\n\t\t\t\tARRAY_SIZE(ov965x_start_1_vga));\n\t\treg_w_array(gspca_dev, bridge_start_qvga,\n\t\t\t\tARRAY_SIZE(bridge_start_qvga));\n\t\tsccb_w_array(gspca_dev, ov965x_start_2_qvga,\n\t\t\t\tARRAY_SIZE(ov965x_start_2_qvga));\n\t\tbreak;\n\tcase VGA_MODE:\t\t\t \n\t\tsccb_w_array(gspca_dev, ov965x_start_1_vga,\n\t\t\t\tARRAY_SIZE(ov965x_start_1_vga));\n\t\treg_w_array(gspca_dev, bridge_start_vga,\n\t\t\t\tARRAY_SIZE(bridge_start_vga));\n\t\tsccb_w_array(gspca_dev, ov965x_start_2_vga,\n\t\t\t\tARRAY_SIZE(ov965x_start_2_vga));\n\t\tbreak;\n\tcase SVGA_MODE:\t\t\t \n\t\tsccb_w_array(gspca_dev, ov965x_start_1_svga,\n\t\t\t\tARRAY_SIZE(ov965x_start_1_svga));\n\t\treg_w_array(gspca_dev, bridge_start_svga,\n\t\t\t\tARRAY_SIZE(bridge_start_svga));\n\t\tsccb_w_array(gspca_dev, ov965x_start_2_svga,\n\t\t\t\tARRAY_SIZE(ov965x_start_2_svga));\n\t\tbreak;\n\tcase XGA_MODE:\t\t\t \n\t\tsccb_w_array(gspca_dev, ov965x_start_1_xga,\n\t\t\t\tARRAY_SIZE(ov965x_start_1_xga));\n\t\treg_w_array(gspca_dev, bridge_start_xga,\n\t\t\t\tARRAY_SIZE(bridge_start_xga));\n\t\tsccb_w_array(gspca_dev, ov965x_start_2_svga,\n\t\t\t\tARRAY_SIZE(ov965x_start_2_svga));\n\t\tbreak;\n\tdefault:\n \n\t\tsccb_w_array(gspca_dev, ov965x_start_1_sxga,\n\t\t\t\tARRAY_SIZE(ov965x_start_1_sxga));\n\t\treg_w_array(gspca_dev, bridge_start_sxga,\n\t\t\t\tARRAY_SIZE(bridge_start_sxga));\n\t\tsccb_w_array(gspca_dev, ov965x_start_2_sxga,\n\t\t\t\tARRAY_SIZE(ov965x_start_2_sxga));\n\t\tbreak;\n\t}\n\n\treg_w(gspca_dev, 0xe0, 0x00);\n\treg_w(gspca_dev, 0xe0, 0x00);\n\tset_led(gspca_dev, 1);\n\treturn gspca_dev->usb_err;\n}\n\nstatic void sd_stopN(struct gspca_dev *gspca_dev)\n{\n\tif (((struct sd *)gspca_dev)->sensor == SENSOR_OV361x) {\n\t\treg_w(gspca_dev, 0xe0, 0x01);  \n\t\t \n\t\treturn;\n\t}\n\treg_w(gspca_dev, 0xe0, 0x01);\n\tset_led(gspca_dev, 0);\n\treg_w(gspca_dev, 0xe0, 0x00);\n}\n\n \n#define UVC_STREAM_EOH\t(1 << 7)\n#define UVC_STREAM_ERR\t(1 << 6)\n#define UVC_STREAM_STI\t(1 << 5)\n#define UVC_STREAM_RES\t(1 << 4)\n#define UVC_STREAM_SCR\t(1 << 3)\n#define UVC_STREAM_PTS\t(1 << 2)\n#define UVC_STREAM_EOF\t(1 << 1)\n#define UVC_STREAM_FID\t(1 << 0)\n\nstatic void sd_pkt_scan(struct gspca_dev *gspca_dev,\n\t\t\tu8 *data, int len)\n{\n\tstruct sd *sd = (struct sd *) gspca_dev;\n\t__u32 this_pts;\n\tu8 this_fid;\n\tint remaining_len = len;\n\tint payload_len;\n\n\tpayload_len = gspca_dev->cam.bulk ? 2048 : 2040;\n\tdo {\n\t\tlen = min(remaining_len, payload_len);\n\n\t\t \n\n\t\t \n\t\tif (data[0] != 12 || len < 12) {\n\t\t\tgspca_dbg(gspca_dev, D_PACK, \"bad header\\n\");\n\t\t\tgoto discard;\n\t\t}\n\n\t\t \n\t\tif (data[1] & UVC_STREAM_ERR) {\n\t\t\tgspca_dbg(gspca_dev, D_PACK, \"payload error\\n\");\n\t\t\tgoto discard;\n\t\t}\n\n\t\t \n\t\tif (!(data[1] & UVC_STREAM_PTS)) {\n\t\t\tgspca_dbg(gspca_dev, D_PACK, \"PTS not present\\n\");\n\t\t\tgoto discard;\n\t\t}\n\t\tthis_pts = (data[5] << 24) | (data[4] << 16)\n\t\t\t\t\t\t| (data[3] << 8) | data[2];\n\t\tthis_fid = data[1] & UVC_STREAM_FID;\n\n\t\t \n\t\tif (this_pts != sd->last_pts || this_fid != sd->last_fid) {\n\t\t\tif (gspca_dev->last_packet_type == INTER_PACKET)\n\t\t\t\tgspca_frame_add(gspca_dev, LAST_PACKET,\n\t\t\t\t\t\tNULL, 0);\n\t\t\tsd->last_pts = this_pts;\n\t\t\tsd->last_fid = this_fid;\n\t\t\tgspca_frame_add(gspca_dev, FIRST_PACKET,\n\t\t\t\t\tdata + 12, len - 12);\n\t\t \n\t\t} else if (data[1] & UVC_STREAM_EOF) {\n\t\t\tsd->last_pts = 0;\n\t\t\tgspca_frame_add(gspca_dev, LAST_PACKET,\n\t\t\t\t\tdata + 12, len - 12);\n\t\t} else {\n\n\t\t\t \n\t\t\tgspca_frame_add(gspca_dev, INTER_PACKET,\n\t\t\t\t\tdata + 12, len - 12);\n\t\t}\n\n\t\t \n\t\tgoto scan_next;\n\ndiscard:\n\t\t \n\t\tgspca_dev->last_packet_type = DISCARD_PACKET;\n\nscan_next:\n\t\tremaining_len -= len;\n\t\tdata += len;\n\t} while (remaining_len > 0);\n}\n\nstatic int sd_s_ctrl(struct v4l2_ctrl *ctrl)\n{\n\tstruct gspca_dev *gspca_dev =\n\t\tcontainer_of(ctrl->handler, struct gspca_dev, ctrl_handler);\n\n\tgspca_dev->usb_err = 0;\n\n\tif (!gspca_dev->streaming)\n\t\treturn 0;\n\n\tswitch (ctrl->id) {\n\tcase V4L2_CID_BRIGHTNESS:\n\t\tsetbrightness(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_CONTRAST:\n\t\tsetcontrast(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_SATURATION:\n\t\tsetsatur(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_POWER_LINE_FREQUENCY:\n\t\tsetlightfreq(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_SHARPNESS:\n\t\tsetsharpness(gspca_dev, ctrl->val);\n\t\tbreak;\n\tcase V4L2_CID_AUTOGAIN:\n\t\tif (ctrl->is_new)\n\t\t\tsetautogain(gspca_dev, ctrl->val);\n\t\tif (!ctrl->val && gspca_dev->exposure->is_new)\n\t\t\tsetexposure(gspca_dev, gspca_dev->exposure->val);\n\t\tbreak;\n\t}\n\treturn gspca_dev->usb_err;\n}\n\nstatic const struct v4l2_ctrl_ops sd_ctrl_ops = {\n\t.s_ctrl = sd_s_ctrl,\n};\n\nstatic int sd_init_controls(struct gspca_dev *gspca_dev)\n{\n\tstruct sd *sd = (struct sd *)gspca_dev;\n\tstruct v4l2_ctrl_handler *hdl = &gspca_dev->ctrl_handler;\n\n\tif (sd->sensor == SENSOR_OV971x)\n\t\treturn 0;\n\tif (sd->sensor == SENSOR_OV361x)\n\t\treturn 0;\n\tgspca_dev->vdev.ctrl_handler = hdl;\n\tv4l2_ctrl_handler_init(hdl, 7);\n\tif (sd->sensor == SENSOR_OV562x) {\n\t\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_BRIGHTNESS, -90, 90, 1, 0);\n\t} else {\n\t\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_BRIGHTNESS, 0, 15, 1, 7);\n\t\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_CONTRAST, 0, 15, 1, 3);\n\t\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_SATURATION, 0, 4, 1, 2);\n\t\t \n\t\tv4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_SHARPNESS, -1, 4, 1, -1);\n\t\tgspca_dev->autogain = v4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_AUTOGAIN, 0, 1, 1, 1);\n\t\tgspca_dev->exposure = v4l2_ctrl_new_std(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_EXPOSURE, 0, 3, 1, 0);\n\t\tv4l2_ctrl_new_std_menu(hdl, &sd_ctrl_ops,\n\t\t\tV4L2_CID_POWER_LINE_FREQUENCY,\n\t\t\tV4L2_CID_POWER_LINE_FREQUENCY_60HZ, 0, 0);\n\t\tv4l2_ctrl_auto_cluster(3, &gspca_dev->autogain, 0, false);\n\t}\n\n\tif (hdl->error) {\n\t\tpr_err(\"Could not initialize controls\\n\");\n\t\treturn hdl->error;\n\t}\n\treturn 0;\n}\n\n \nstatic const struct sd_desc sd_desc = {\n\t.name     = MODULE_NAME,\n\t.config   = sd_config,\n\t.init     = sd_init,\n\t.init_controls = sd_init_controls,\n\t.start    = sd_start,\n\t.stopN    = sd_stopN,\n\t.pkt_scan = sd_pkt_scan,\n};\n\n \nstatic const struct usb_device_id device_table[] = {\n\t{USB_DEVICE(0x05a9, 0x8065)},\n\t{USB_DEVICE(0x06f8, 0x3003)},\n\t{USB_DEVICE(0x05a9, 0x1550)},\n\t{}\n};\n\nMODULE_DEVICE_TABLE(usb, device_table);\n\n \nstatic int sd_probe(struct usb_interface *intf, const struct usb_device_id *id)\n{\n\treturn gspca_dev_probe(intf, id, &sd_desc, sizeof(struct sd),\n\t\t\t\tTHIS_MODULE);\n}\n\nstatic struct usb_driver sd_driver = {\n\t.name       = MODULE_NAME,\n\t.id_table   = device_table,\n\t.probe      = sd_probe,\n\t.disconnect = gspca_disconnect,\n#ifdef CONFIG_PM\n\t.suspend    = gspca_suspend,\n\t.resume     = gspca_resume,\n\t.reset_resume = gspca_resume,\n#endif\n};\n\nmodule_usb_driver(sd_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}