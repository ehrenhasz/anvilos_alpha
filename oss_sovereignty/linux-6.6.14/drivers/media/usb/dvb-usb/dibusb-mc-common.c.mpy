{
  "module_name": "dibusb-mc-common.c",
  "hash_id": "168f25af5b53ca04deac322865be0841c08798cb8d9069a69b5b2c22e2eb3a16",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/dvb-usb/dibusb-mc-common.c",
  "human_readable_source": "\n \n\n#include \"dibusb.h\"\n\nMODULE_LICENSE(\"GPL\");\n\n \n\nstatic struct dibx000_agc_config dib3000p_mt2060_agc_config = {\n\t.band_caps = BAND_VHF | BAND_UHF,\n\t.setup     = (1 << 8) | (5 << 5) | (1 << 4) | (1 << 3) | (0 << 2) | (2 << 0),\n\n\t.agc1_max = 48497,\n\t.agc1_min = 23593,\n\t.agc2_max = 46531,\n\t.agc2_min = 24904,\n\n\t.agc1_pt1 = 0x65,\n\t.agc1_pt2 = 0x69,\n\n\t.agc1_slope1 = 0x51,\n\t.agc1_slope2 = 0x27,\n\n\t.agc2_pt1 = 0,\n\t.agc2_pt2 = 0x33,\n\n\t.agc2_slope1 = 0x35,\n\t.agc2_slope2 = 0x37,\n};\n\nstatic struct dib3000mc_config stk3000p_dib3000p_config = {\n\t&dib3000p_mt2060_agc_config,\n\n\t.max_time     = 0x196,\n\t.ln_adc_level = 0x1cc7,\n\n\t.output_mpeg2_in_188_bytes = 1,\n\n\t.agc_command1 = 1,\n\t.agc_command2 = 1,\n};\n\nstatic struct dibx000_agc_config dib3000p_panasonic_agc_config = {\n\t.band_caps = BAND_VHF | BAND_UHF,\n\t.setup     = (1 << 8) | (5 << 5) | (1 << 4) | (1 << 3) | (0 << 2) | (2 << 0),\n\n\t.agc1_max = 56361,\n\t.agc1_min = 22282,\n\t.agc2_max = 47841,\n\t.agc2_min = 36045,\n\n\t.agc1_pt1 = 0x3b,\n\t.agc1_pt2 = 0x6b,\n\n\t.agc1_slope1 = 0x55,\n\t.agc1_slope2 = 0x1d,\n\n\t.agc2_pt1 = 0,\n\t.agc2_pt2 = 0x0a,\n\n\t.agc2_slope1 = 0x95,\n\t.agc2_slope2 = 0x1e,\n};\n\nstatic struct dib3000mc_config mod3000p_dib3000p_config = {\n\t&dib3000p_panasonic_agc_config,\n\n\t.max_time     = 0x51,\n\t.ln_adc_level = 0x1cc7,\n\n\t.output_mpeg2_in_188_bytes = 1,\n\n\t.agc_command1 = 1,\n\t.agc_command2 = 1,\n};\n\nint dibusb_dib3000mc_frontend_attach(struct dvb_usb_adapter *adap)\n{\n\tif (le16_to_cpu(adap->dev->udev->descriptor.idVendor) == USB_VID_LITEON &&\n\t    le16_to_cpu(adap->dev->udev->descriptor.idProduct) ==\n\t\t\tUSB_PID_LITEON_DVB_T_WARM) {\n\t\tmsleep(1000);\n\t}\n\n\tadap->fe_adap[0].fe = dvb_attach(dib3000mc_attach,\n\t\t\t\t\t &adap->dev->i2c_adap,\n\t\t\t\t\t DEFAULT_DIB3000P_I2C_ADDRESS,\n\t\t\t\t\t &mod3000p_dib3000p_config);\n\tif ((adap->fe_adap[0].fe) == NULL)\n\t\tadap->fe_adap[0].fe = dvb_attach(dib3000mc_attach,\n\t\t\t\t\t\t &adap->dev->i2c_adap,\n\t\t\t\t\t\t DEFAULT_DIB3000MC_I2C_ADDRESS,\n\t\t\t\t\t\t &mod3000p_dib3000p_config);\n\tif ((adap->fe_adap[0].fe) != NULL) {\n\t\tif (adap->priv != NULL) {\n\t\t\tstruct dibusb_state *st = adap->priv;\n\t\t\tst->ops.pid_parse = dib3000mc_pid_parse;\n\t\t\tst->ops.pid_ctrl  = dib3000mc_pid_control;\n\t\t}\n\t\treturn 0;\n\t}\n\treturn -ENODEV;\n}\nEXPORT_SYMBOL(dibusb_dib3000mc_frontend_attach);\n\nstatic struct mt2060_config stk3000p_mt2060_config = {\n\t0x60\n};\n\nint dibusb_dib3000mc_tuner_attach(struct dvb_usb_adapter *adap)\n{\n\tstruct dibusb_state *st = adap->priv;\n\tu8 a,b;\n\tu16 if1 = 1220;\n\tstruct i2c_adapter *tun_i2c;\n\n\t\n\tif (le16_to_cpu(adap->dev->udev->descriptor.idVendor) == USB_VID_LITEON &&\n\t    le16_to_cpu(adap->dev->udev->descriptor.idProduct) == USB_PID_LITEON_DVB_T_WARM) {\n\n\t\tdibusb_read_eeprom_byte(adap->dev,0x7E,&a);\n\t\tdibusb_read_eeprom_byte(adap->dev,0x7F,&b);\n\n\t\tif (a == 0x00)\n\t\t\tif1 += b;\n\t\telse if (a == 0x80)\n\t\t\tif1 -= b;\n\t\telse\n\t\t\twarn(\"LITE-ON DVB-T: Strange IF1 calibration :%2X %2X\\n\", a, b);\n\n\t} else if (le16_to_cpu(adap->dev->udev->descriptor.idVendor) == USB_VID_DIBCOM &&\n\t\t   le16_to_cpu(adap->dev->udev->descriptor.idProduct) == USB_PID_DIBCOM_MOD3001_WARM) {\n\t\tu8 desc;\n\t\tdibusb_read_eeprom_byte(adap->dev, 7, &desc);\n\t\tif (desc == 2) {\n\t\t\ta = 127;\n\t\t\tdo {\n\t\t\t\tdibusb_read_eeprom_byte(adap->dev, a, &desc);\n\t\t\t\ta--;\n\t\t\t} while (a > 7 && (desc == 0xff || desc == 0x00));\n\t\t\tif (desc & 0x80)\n\t\t\t\tif1 -= (0xff - desc);\n\t\t\telse\n\t\t\t\tif1 += desc;\n\t\t}\n\t}\n\n\ttun_i2c = dib3000mc_get_tuner_i2c_master(adap->fe_adap[0].fe, 1);\n\tif (dvb_attach(mt2060_attach, adap->fe_adap[0].fe, tun_i2c, &stk3000p_mt2060_config, if1) == NULL) {\n\t\t \n\t\tif (dvb_attach(dvb_pll_attach, adap->fe_adap[0].fe, 0x60, tun_i2c, DVB_PLL_ENV57H1XD5) == NULL)\n\t\t\treturn -ENOMEM;\n\t} else {\n\t\tst->mt2060_present = 1;\n\t\t \n\t\tdib3000mc_set_config(adap->fe_adap[0].fe, &stk3000p_dib3000p_config);\n\t}\n\treturn 0;\n}\nEXPORT_SYMBOL(dibusb_dib3000mc_tuner_attach);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}