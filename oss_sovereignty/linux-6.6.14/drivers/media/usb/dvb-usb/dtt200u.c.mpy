{
  "module_name": "dtt200u.c",
  "hash_id": "13aa5eff8f3e428681593cf54a891148e284c4cbaec3be289235d40765514eb3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/dvb-usb/dtt200u.c",
  "human_readable_source": "\n \n#include \"dtt200u.h\"\n\n \nint dvb_usb_dtt200u_debug;\nmodule_param_named(debug,dvb_usb_dtt200u_debug, int, 0644);\nMODULE_PARM_DESC(debug, \"set debugging level (1=info,xfer=2 (or-able)).\" DVB_USB_DEBUG_STATUS);\n\nDVB_DEFINE_MOD_OPT_ADAPTER_NR(adapter_nr);\n\nstruct dtt200u_state {\n\tunsigned char data[80];\n};\n\nstatic int dtt200u_power_ctrl(struct dvb_usb_device *d, int onoff)\n{\n\tstruct dtt200u_state *st = d->priv;\n\tint ret = 0;\n\n\tmutex_lock(&d->data_mutex);\n\n\tst->data[0] = SET_INIT;\n\n\tif (onoff)\n\t\tret = dvb_usb_generic_write(d, st->data, 2);\n\n\tmutex_unlock(&d->data_mutex);\n\treturn ret;\n}\n\nstatic int dtt200u_streaming_ctrl(struct dvb_usb_adapter *adap, int onoff)\n{\n\tstruct dvb_usb_device *d = adap->dev;\n\tstruct dtt200u_state *st = d->priv;\n\tint ret;\n\n\tmutex_lock(&d->data_mutex);\n\tst->data[0] = SET_STREAMING;\n\tst->data[1] = onoff;\n\n\tret = dvb_usb_generic_write(adap->dev, st->data, 2);\n\tif (ret < 0)\n\t\tgoto ret;\n\n\tif (onoff)\n\t\tgoto ret;\n\n\tst->data[0] = RESET_PID_FILTER;\n\tret = dvb_usb_generic_write(adap->dev, st->data, 1);\n\nret:\n\tmutex_unlock(&d->data_mutex);\n\n\treturn ret;\n}\n\nstatic int dtt200u_pid_filter(struct dvb_usb_adapter *adap, int index, u16 pid, int onoff)\n{\n\tstruct dvb_usb_device *d = adap->dev;\n\tstruct dtt200u_state *st = d->priv;\n\tint ret;\n\n\tpid = onoff ? pid : 0;\n\n\tmutex_lock(&d->data_mutex);\n\tst->data[0] = SET_PID_FILTER;\n\tst->data[1] = index;\n\tst->data[2] = pid & 0xff;\n\tst->data[3] = (pid >> 8) & 0x1f;\n\n\tret = dvb_usb_generic_write(adap->dev, st->data, 4);\n\tmutex_unlock(&d->data_mutex);\n\n\treturn ret;\n}\n\nstatic int dtt200u_rc_query(struct dvb_usb_device *d)\n{\n\tstruct dtt200u_state *st = d->priv;\n\tu32 scancode;\n\tint ret;\n\n\tmutex_lock(&d->data_mutex);\n\tst->data[0] = GET_RC_CODE;\n\n\tret = dvb_usb_generic_rw(d, st->data, 1, st->data, 5, 0);\n\tif (ret < 0)\n\t\tgoto ret;\n\n\tif (st->data[0] == 1) {\n\t\tenum rc_proto proto = RC_PROTO_NEC;\n\n\t\tscancode = st->data[1];\n\t\tif ((u8) ~st->data[1] != st->data[2]) {\n\t\t\t \n\t\t\tscancode = scancode << 8;\n\t\t\tscancode |= st->data[2];\n\t\t\tproto = RC_PROTO_NECX;\n\t\t}\n\t\tscancode = scancode << 8;\n\t\tscancode |= st->data[3];\n\n\t\t \n\t\tif ((u8) ~st->data[3] == st->data[4])\n\t\t\trc_keydown(d->rc_dev, proto, scancode, 0);\n\t\telse\n\t\t\trc_keyup(d->rc_dev);\n\t} else if (st->data[0] == 2) {\n\t\trc_repeat(d->rc_dev);\n\t} else {\n\t\trc_keyup(d->rc_dev);\n\t}\n\n\tif (st->data[0] != 0)\n\t\tdeb_info(\"st->data: %*ph\\n\", 5, st->data);\n\nret:\n\tmutex_unlock(&d->data_mutex);\n\treturn ret;\n}\n\nstatic int dtt200u_frontend_attach(struct dvb_usb_adapter *adap)\n{\n\tadap->fe_adap[0].fe = dtt200u_fe_attach(adap->dev);\n\treturn 0;\n}\n\nstatic struct dvb_usb_device_properties dtt200u_properties;\nstatic struct dvb_usb_device_properties wt220u_fc_properties;\nstatic struct dvb_usb_device_properties wt220u_properties;\nstatic struct dvb_usb_device_properties wt220u_zl0353_properties;\nstatic struct dvb_usb_device_properties wt220u_miglia_properties;\n\nstatic int dtt200u_usb_probe(struct usb_interface *intf,\n\t\tconst struct usb_device_id *id)\n{\n\tif (0 == dvb_usb_device_init(intf, &dtt200u_properties,\n\t\t\t\t     THIS_MODULE, NULL, adapter_nr) ||\n\t    0 == dvb_usb_device_init(intf, &wt220u_properties,\n\t\t\t\t     THIS_MODULE, NULL, adapter_nr) ||\n\t    0 == dvb_usb_device_init(intf, &wt220u_fc_properties,\n\t\t\t\t     THIS_MODULE, NULL, adapter_nr) ||\n\t    0 == dvb_usb_device_init(intf, &wt220u_zl0353_properties,\n\t\t\t\t     THIS_MODULE, NULL, adapter_nr) ||\n\t    0 == dvb_usb_device_init(intf, &wt220u_miglia_properties,\n\t\t\t\t     THIS_MODULE, NULL, adapter_nr))\n\t\treturn 0;\n\n\treturn -ENODEV;\n}\n\nenum {\n\tWIDEVIEW_DTT200U_COLD,\n\tWIDEVIEW_DTT200U_WARM,\n\tWIDEVIEW_WT220U_COLD,\n\tWIDEVIEW_WT220U_WARM,\n\tWIDEVIEW_WT220U_ZL0353_COLD,\n\tWIDEVIEW_WT220U_ZL0353_WARM,\n\tWIDEVIEW_WT220U_FC_COLD,\n\tWIDEVIEW_WT220U_FC_WARM,\n\tWIDEVIEW_WT220U_ZAP250_COLD,\n\tMIGLIA_WT220U_ZAP250_COLD,\n};\n\nstatic struct usb_device_id dtt200u_usb_table[] = {\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_DTT200U_COLD),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_DTT200U_WARM),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_WT220U_COLD),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_WT220U_WARM),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_WT220U_ZL0353_COLD),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_WT220U_ZL0353_WARM),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_WT220U_FC_COLD),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_WT220U_FC_WARM),\n\tDVB_USB_DEV(WIDEVIEW, WIDEVIEW_WT220U_ZAP250_COLD),\n\tDVB_USB_DEV(MIGLIA, MIGLIA_WT220U_ZAP250_COLD),\n\t{ }\n};\n\nMODULE_DEVICE_TABLE(usb, dtt200u_usb_table);\n\nstatic struct dvb_usb_device_properties dtt200u_properties = {\n\t.usb_ctrl = CYPRESS_FX2,\n\t.firmware = \"dvb-usb-dtt200u-01.fw\",\n\n\t.size_of_priv     = sizeof(struct dtt200u_state),\n\n\t.num_adapters = 1,\n\t.adapter = {\n\t\t{\n\t\t.num_frontends = 1,\n\t\t.fe = {{\n\t\t\t.caps = DVB_USB_ADAP_HAS_PID_FILTER | DVB_USB_ADAP_NEED_PID_FILTERING,\n\t\t\t.pid_filter_count = 15,\n\n\t.streaming_ctrl  = dtt200u_streaming_ctrl,\n\t.pid_filter      = dtt200u_pid_filter,\n\t.frontend_attach = dtt200u_frontend_attach,\n\t \n\t\t\t.stream = {\n\t\t\t\t.type = USB_BULK,\n\t\t.count = 7,\n\t\t.endpoint = 0x02,\n\t\t.u = {\n\t\t\t.bulk = {\n\t\t\t\t.buffersize = 4096,\n\t\t\t}\n\t\t}\n\t},\n\t\t}},\n\t\t}\n\t},\n\t.power_ctrl      = dtt200u_power_ctrl,\n\n\t.rc.core = {\n\t\t.rc_interval     = 300,\n\t\t.rc_codes        = RC_MAP_DTT200U,\n\t\t.rc_query        = dtt200u_rc_query,\n\t\t.allowed_protos  = RC_PROTO_BIT_NEC,\n\t},\n\n\t.generic_bulk_ctrl_endpoint = 0x01,\n\n\t.num_device_descs = 1,\n\t.devices = {\n\t\t{ .name = \"WideView/Yuan/Yakumo/Hama/Typhoon DVB-T USB2.0 (WT-200U)\",\n\t\t  .cold_ids = { &dtt200u_usb_table[WIDEVIEW_DTT200U_COLD], NULL },\n\t\t  .warm_ids = { &dtt200u_usb_table[WIDEVIEW_DTT200U_WARM], NULL },\n\t\t},\n\t\t{ NULL },\n\t}\n};\n\nstatic struct dvb_usb_device_properties wt220u_properties = {\n\t.usb_ctrl = CYPRESS_FX2,\n\t.firmware = \"dvb-usb-wt220u-02.fw\",\n\n\t.size_of_priv     = sizeof(struct dtt200u_state),\n\n\t.num_adapters = 1,\n\t.adapter = {\n\t\t{\n\t\t.num_frontends = 1,\n\t\t.fe = {{\n\t\t\t.caps = DVB_USB_ADAP_HAS_PID_FILTER | DVB_USB_ADAP_NEED_PID_FILTERING,\n\t\t\t.pid_filter_count = 15,\n\n\t.streaming_ctrl  = dtt200u_streaming_ctrl,\n\t.pid_filter      = dtt200u_pid_filter,\n\t.frontend_attach = dtt200u_frontend_attach,\n\t \n\t\t\t.stream = {\n\t\t\t\t.type = USB_BULK,\n\t\t.count = 7,\n\t\t.endpoint = 0x02,\n\t\t.u = {\n\t\t\t.bulk = {\n\t\t\t\t.buffersize = 4096,\n\t\t\t}\n\t\t}\n\t},\n\t\t}},\n\t\t}\n\t},\n\t.power_ctrl      = dtt200u_power_ctrl,\n\n\t.rc.core = {\n\t\t.rc_interval     = 300,\n\t\t.rc_codes        = RC_MAP_DTT200U,\n\t\t.rc_query        = dtt200u_rc_query,\n\t\t.allowed_protos  = RC_PROTO_BIT_NEC,\n\t},\n\n\t.generic_bulk_ctrl_endpoint = 0x01,\n\n\t.num_device_descs = 1,\n\t.devices = {\n\t\t{ .name = \"WideView WT-220U PenType Receiver (Typhoon/Freecom)\",\n\t\t  .cold_ids = { &dtt200u_usb_table[WIDEVIEW_WT220U_COLD], &dtt200u_usb_table[WIDEVIEW_WT220U_ZAP250_COLD], NULL },\n\t\t  .warm_ids = { &dtt200u_usb_table[WIDEVIEW_WT220U_WARM], NULL },\n\t\t},\n\t\t{ NULL },\n\t}\n};\n\nstatic struct dvb_usb_device_properties wt220u_fc_properties = {\n\t.usb_ctrl = CYPRESS_FX2,\n\t.firmware = \"dvb-usb-wt220u-fc03.fw\",\n\n\t.size_of_priv     = sizeof(struct dtt200u_state),\n\n\t.num_adapters = 1,\n\t.adapter = {\n\t\t{\n\t\t.num_frontends = 1,\n\t\t.fe = {{\n\t\t\t.caps = DVB_USB_ADAP_HAS_PID_FILTER | DVB_USB_ADAP_NEED_PID_FILTERING,\n\t\t\t.pid_filter_count = 15,\n\n\t.streaming_ctrl  = dtt200u_streaming_ctrl,\n\t.pid_filter      = dtt200u_pid_filter,\n\t.frontend_attach = dtt200u_frontend_attach,\n\t \n\t\t\t.stream = {\n\t\t\t\t.type = USB_BULK,\n\t\t.count = 7,\n\t\t\t\t.endpoint = 0x06,\n\t\t.u = {\n\t\t\t.bulk = {\n\t\t\t\t.buffersize = 4096,\n\t\t\t}\n\t\t}\n\t},\n\t\t}},\n\t\t}\n\t},\n\t.power_ctrl      = dtt200u_power_ctrl,\n\n\t.rc.core = {\n\t\t.rc_interval     = 300,\n\t\t.rc_codes        = RC_MAP_DTT200U,\n\t\t.rc_query        = dtt200u_rc_query,\n\t\t.allowed_protos  = RC_PROTO_BIT_NEC,\n\t},\n\n\t.generic_bulk_ctrl_endpoint = 0x01,\n\n\t.num_device_descs = 1,\n\t.devices = {\n\t\t{ .name = \"WideView WT-220U PenType Receiver (Typhoon/Freecom)\",\n\t\t  .cold_ids = { &dtt200u_usb_table[WIDEVIEW_WT220U_FC_COLD], NULL },\n\t\t  .warm_ids = { &dtt200u_usb_table[WIDEVIEW_WT220U_FC_WARM], NULL },\n\t\t},\n\t\t{ NULL },\n\t}\n};\n\nstatic struct dvb_usb_device_properties wt220u_zl0353_properties = {\n\t.usb_ctrl = CYPRESS_FX2,\n\t.firmware = \"dvb-usb-wt220u-zl0353-01.fw\",\n\n\t.size_of_priv     = sizeof(struct dtt200u_state),\n\n\t.num_adapters = 1,\n\t.adapter = {\n\t\t{\n\t\t.num_frontends = 1,\n\t\t.fe = {{\n\t\t\t.caps = DVB_USB_ADAP_HAS_PID_FILTER | DVB_USB_ADAP_NEED_PID_FILTERING,\n\t\t\t.pid_filter_count = 15,\n\n\t\t\t.streaming_ctrl  = dtt200u_streaming_ctrl,\n\t\t\t.pid_filter      = dtt200u_pid_filter,\n\t\t\t.frontend_attach = dtt200u_frontend_attach,\n\t\t\t \n\t\t\t.stream = {\n\t\t\t\t.type = USB_BULK,\n\t\t\t\t.count = 7,\n\t\t\t\t.endpoint = 0x02,\n\t\t\t\t.u = {\n\t\t\t\t\t.bulk = {\n\t\t\t\t\t\t.buffersize = 4096,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t}},\n\t\t}\n\t},\n\t.power_ctrl      = dtt200u_power_ctrl,\n\n\t.rc.core = {\n\t\t.rc_interval     = 300,\n\t\t.rc_codes        = RC_MAP_DTT200U,\n\t\t.rc_query        = dtt200u_rc_query,\n\t\t.allowed_protos  = RC_PROTO_BIT_NEC,\n\t},\n\n\t.generic_bulk_ctrl_endpoint = 0x01,\n\n\t.num_device_descs = 1,\n\t.devices = {\n\t\t{ .name = \"WideView WT-220U PenType Receiver (based on ZL353)\",\n\t\t  .cold_ids = { &dtt200u_usb_table[WIDEVIEW_WT220U_ZL0353_COLD], NULL },\n\t\t  .warm_ids = { &dtt200u_usb_table[WIDEVIEW_WT220U_ZL0353_WARM], NULL },\n\t\t},\n\t\t{ NULL },\n\t}\n};\n\nstatic struct dvb_usb_device_properties wt220u_miglia_properties = {\n\t.usb_ctrl = CYPRESS_FX2,\n\t.firmware = \"dvb-usb-wt220u-miglia-01.fw\",\n\n\t.size_of_priv     = sizeof(struct dtt200u_state),\n\n\t.num_adapters = 1,\n\t.generic_bulk_ctrl_endpoint = 0x01,\n\n\t.num_device_descs = 1,\n\t.devices = {\n\t\t{ .name = \"WideView WT-220U PenType Receiver (Miglia)\",\n\t\t  .cold_ids = { &dtt200u_usb_table[MIGLIA_WT220U_ZAP250_COLD], NULL },\n\t\t   \n\t\t  .warm_ids = { NULL },\n\t\t},\n\t\t{ NULL },\n\t}\n};\n\n \nstatic struct usb_driver dtt200u_usb_driver = {\n\t.name\t\t= \"dvb_usb_dtt200u\",\n\t.probe\t\t= dtt200u_usb_probe,\n\t.disconnect = dvb_usb_device_exit,\n\t.id_table\t= dtt200u_usb_table,\n};\n\nmodule_usb_driver(dtt200u_usb_driver);\n\nMODULE_AUTHOR(\"Patrick Boettcher <patrick.boettcher@posteo.de>\");\nMODULE_DESCRIPTION(\"Driver for the WideView/Yakumo/Hama/Typhoon/Club3D/Miglia DVB-T USB2.0 devices\");\nMODULE_VERSION(\"1.0\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}