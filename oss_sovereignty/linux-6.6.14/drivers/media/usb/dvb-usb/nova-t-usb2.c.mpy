{
  "module_name": "nova-t-usb2.c",
  "hash_id": "1b453c94c44fb13678f45da69e19de7930c3a1add83d69e6faeac97a492571c4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/dvb-usb/nova-t-usb2.c",
  "human_readable_source": "\n \n#include \"dibusb.h\"\n\nstatic int debug;\nmodule_param(debug, int, 0644);\nMODULE_PARM_DESC(debug, \"set debugging level (1=rc,2=eeprom (|-able)).\" DVB_USB_DEBUG_STATUS);\n\nDVB_DEFINE_MOD_OPT_ADAPTER_NR(adapter_nr);\n\n#define deb_rc(args...) dprintk(debug,0x01,args)\n#define deb_ee(args...) dprintk(debug,0x02,args)\n\n \nstatic struct rc_map_table rc_map_haupp_table[] = {\n\t{ 0x1e00, KEY_0 },\n\t{ 0x1e01, KEY_1 },\n\t{ 0x1e02, KEY_2 },\n\t{ 0x1e03, KEY_3 },\n\t{ 0x1e04, KEY_4 },\n\t{ 0x1e05, KEY_5 },\n\t{ 0x1e06, KEY_6 },\n\t{ 0x1e07, KEY_7 },\n\t{ 0x1e08, KEY_8 },\n\t{ 0x1e09, KEY_9 },\n\t{ 0x1e0a, KEY_KPASTERISK },\n\t{ 0x1e0b, KEY_RED },\n\t{ 0x1e0c, KEY_RADIO },\n\t{ 0x1e0d, KEY_MENU },\n\t{ 0x1e0e, KEY_GRAVE },  \n\t{ 0x1e0f, KEY_MUTE },\n\t{ 0x1e10, KEY_VOLUMEUP },\n\t{ 0x1e11, KEY_VOLUMEDOWN },\n\t{ 0x1e12, KEY_CHANNEL },\n\t{ 0x1e14, KEY_UP },\n\t{ 0x1e15, KEY_DOWN },\n\t{ 0x1e16, KEY_LEFT },\n\t{ 0x1e17, KEY_RIGHT },\n\t{ 0x1e18, KEY_VIDEO },\n\t{ 0x1e19, KEY_AUDIO },\n\t{ 0x1e1a, KEY_IMAGES },\n\t{ 0x1e1b, KEY_EPG },\n\t{ 0x1e1c, KEY_TV },\n\t{ 0x1e1e, KEY_NEXT },\n\t{ 0x1e1f, KEY_BACK },\n\t{ 0x1e20, KEY_CHANNELUP },\n\t{ 0x1e21, KEY_CHANNELDOWN },\n\t{ 0x1e24, KEY_LAST },  \n\t{ 0x1e25, KEY_OK },\n\t{ 0x1e29, KEY_BLUE},\n\t{ 0x1e2e, KEY_GREEN },\n\t{ 0x1e30, KEY_PAUSE },\n\t{ 0x1e32, KEY_REWIND },\n\t{ 0x1e34, KEY_FASTFORWARD },\n\t{ 0x1e35, KEY_PLAY },\n\t{ 0x1e36, KEY_STOP },\n\t{ 0x1e37, KEY_RECORD },\n\t{ 0x1e38, KEY_YELLOW },\n\t{ 0x1e3b, KEY_GOTO },\n\t{ 0x1e3d, KEY_POWER },\n};\n\n \nstatic int nova_t_rc_query(struct dvb_usb_device *d, u32 *event, int *state)\n{\n\tu8 *buf, data, toggle, custom;\n\tu16 raw;\n\tint i, ret;\n\tstruct dibusb_device_state *st = d->priv;\n\n\tbuf = kmalloc(5, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tbuf[0] = DIBUSB_REQ_POLL_REMOTE;\n\tbuf[1] = 0x35;\n\tret = dvb_usb_generic_rw(d, buf, 2, buf, 5, 0);\n\tif (ret < 0)\n\t\tgoto ret;\n\n\t*state = REMOTE_NO_KEY_PRESSED;\n\tswitch (buf[0]) {\n\t\tcase DIBUSB_RC_HAUPPAUGE_KEY_PRESSED:\n\t\t\traw = ((buf[1] << 8) | buf[2]) >> 3;\n\t\t\ttoggle = !!(raw & 0x800);\n\t\t\tdata = raw & 0x3f;\n\t\t\tcustom = (raw >> 6) & 0x1f;\n\n\t\t\tdeb_rc(\"raw key code 0x%02x, 0x%02x, 0x%02x to c: %02x d: %02x toggle: %d\\n\",\n\t\t\t       buf[1], buf[2], buf[3], custom, data, toggle);\n\n\t\t\tfor (i = 0; i < ARRAY_SIZE(rc_map_haupp_table); i++) {\n\t\t\t\tif (rc5_data(&rc_map_haupp_table[i]) == data &&\n\t\t\t\t\trc5_custom(&rc_map_haupp_table[i]) == custom) {\n\n\t\t\t\t\tdeb_rc(\"c: %x, d: %x\\n\", rc5_data(&rc_map_haupp_table[i]),\n\t\t\t\t\t\t\t\t rc5_custom(&rc_map_haupp_table[i]));\n\n\t\t\t\t\t*event = rc_map_haupp_table[i].keycode;\n\t\t\t\t\t*state = REMOTE_KEY_PRESSED;\n\t\t\t\t\tif (st->old_toggle == toggle) {\n\t\t\t\t\t\tif (st->last_repeat_count++ < 2)\n\t\t\t\t\t\t\t*state = REMOTE_NO_KEY_PRESSED;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tst->last_repeat_count = 0;\n\t\t\t\t\t\tst->old_toggle = toggle;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tbreak;\n\t\tcase DIBUSB_RC_HAUPPAUGE_KEY_EMPTY:\n\t\tdefault:\n\t\t\tbreak;\n\t}\n\nret:\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic int nova_t_read_mac_address (struct dvb_usb_device *d, u8 mac[6])\n{\n\tint i, ret;\n\tu8 b;\n\n\tmac[0] = 0x00;\n\tmac[1] = 0x0d;\n\tmac[2] = 0xfe;\n\n\t \n\tfor (i = 136; i < 139; i++) {\n\t\tret = dibusb_read_eeprom_byte(d, i, &b);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tmac[5 - (i - 136)] = b;\n\t}\n\n\treturn 0;\n}\n\n \nstatic struct dvb_usb_device_properties nova_t_properties;\n\nstatic int nova_t_probe(struct usb_interface *intf,\n\t\tconst struct usb_device_id *id)\n{\n\treturn dvb_usb_device_init(intf, &nova_t_properties,\n\t\t\t\t   THIS_MODULE, NULL, adapter_nr);\n}\n\n \nenum {\n\tHAUPPAUGE_WINTV_NOVA_T_USB2_COLD,\n\tHAUPPAUGE_WINTV_NOVA_T_USB2_WARM,\n};\n\nstatic struct usb_device_id nova_t_table[] = {\n\tDVB_USB_DEV(HAUPPAUGE, HAUPPAUGE_WINTV_NOVA_T_USB2_COLD),\n\tDVB_USB_DEV(HAUPPAUGE, HAUPPAUGE_WINTV_NOVA_T_USB2_WARM),\n\t{ }\n};\n\nMODULE_DEVICE_TABLE(usb, nova_t_table);\n\nstatic struct dvb_usb_device_properties nova_t_properties = {\n\t.caps = DVB_USB_IS_AN_I2C_ADAPTER,\n\n\t.usb_ctrl = CYPRESS_FX2,\n\t.firmware = \"dvb-usb-nova-t-usb2-02.fw\",\n\n\t.num_adapters     = 1,\n\t.adapter          = {\n\t\t{\n\t\t.num_frontends = 1,\n\t\t.fe = {{\n\t\t\t.caps = DVB_USB_ADAP_HAS_PID_FILTER | DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF,\n\t\t\t.pid_filter_count = 32,\n\n\t\t\t.streaming_ctrl   = dibusb2_0_streaming_ctrl,\n\t\t\t.pid_filter       = dibusb_pid_filter,\n\t\t\t.pid_filter_ctrl  = dibusb_pid_filter_ctrl,\n\t\t\t.frontend_attach  = dibusb_dib3000mc_frontend_attach,\n\t\t\t.tuner_attach     = dibusb_dib3000mc_tuner_attach,\n\n\t\t\t \n\t\t\t\t\t.stream = {\n\t\t\t\t\t\t.type = USB_BULK,\n\t\t\t\t.count = 7,\n\t\t\t\t.endpoint = 0x06,\n\t\t\t\t.u = {\n\t\t\t\t\t.bulk = {\n\t\t\t\t\t\t.buffersize = 4096,\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t}},\n\t\t\t.size_of_priv     = sizeof(struct dibusb_state),\n\t\t}\n\t},\n\t.size_of_priv     = sizeof(struct dibusb_device_state),\n\n\t.power_ctrl       = dibusb2_0_power_ctrl,\n\t.read_mac_address = nova_t_read_mac_address,\n\n\t.rc.legacy = {\n\t\t.rc_interval      = 100,\n\t\t.rc_map_table     = rc_map_haupp_table,\n\t\t.rc_map_size      = ARRAY_SIZE(rc_map_haupp_table),\n\t\t.rc_query         = nova_t_rc_query,\n\t},\n\n\t.i2c_algo         = &dibusb_i2c_algo,\n\n\t.generic_bulk_ctrl_endpoint = 0x01,\n\n\t.num_device_descs = 1,\n\t.devices = {\n\t\t{   \"Hauppauge WinTV-NOVA-T usb2\",\n\t\t\t{ &nova_t_table[HAUPPAUGE_WINTV_NOVA_T_USB2_COLD], NULL },\n\t\t\t{ &nova_t_table[HAUPPAUGE_WINTV_NOVA_T_USB2_WARM], NULL },\n\t\t},\n\t\t{ NULL },\n\t}\n};\n\nstatic struct usb_driver nova_t_driver = {\n\t.name\t\t= \"dvb_usb_nova_t_usb2\",\n\t.probe\t\t= nova_t_probe,\n\t.disconnect = dvb_usb_device_exit,\n\t.id_table\t= nova_t_table,\n};\n\nmodule_usb_driver(nova_t_driver);\n\nMODULE_AUTHOR(\"Patrick Boettcher <patrick.boettcher@posteo.de>\");\nMODULE_DESCRIPTION(\"Hauppauge WinTV-NOVA-T usb2\");\nMODULE_VERSION(\"1.0\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}