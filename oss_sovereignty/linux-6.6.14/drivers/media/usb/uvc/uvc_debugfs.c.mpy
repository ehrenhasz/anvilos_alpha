{
  "module_name": "uvc_debugfs.c",
  "hash_id": "a1bb4a9e8ab66649da02311a28230bd8ada97c4edd1f9dcbc6fb223caea46610",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/uvc/uvc_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/debugfs.h>\n#include <linux/slab.h>\n#include <linux/usb.h>\n\n#include \"uvcvideo.h\"\n\n \n\n#define UVC_DEBUGFS_BUF_SIZE\t1024\n\nstruct uvc_debugfs_buffer {\n\tsize_t count;\n\tchar data[UVC_DEBUGFS_BUF_SIZE];\n};\n\nstatic int uvc_debugfs_stats_open(struct inode *inode, struct file *file)\n{\n\tstruct uvc_streaming *stream = inode->i_private;\n\tstruct uvc_debugfs_buffer *buf;\n\n\tbuf = kmalloc(sizeof(*buf), GFP_KERNEL);\n\tif (buf == NULL)\n\t\treturn -ENOMEM;\n\n\tbuf->count = uvc_video_stats_dump(stream, buf->data, sizeof(buf->data));\n\n\tfile->private_data = buf;\n\treturn 0;\n}\n\nstatic ssize_t uvc_debugfs_stats_read(struct file *file, char __user *user_buf,\n\t\t\t\t      size_t nbytes, loff_t *ppos)\n{\n\tstruct uvc_debugfs_buffer *buf = file->private_data;\n\n\treturn simple_read_from_buffer(user_buf, nbytes, ppos, buf->data,\n\t\t\t\t       buf->count);\n}\n\nstatic int uvc_debugfs_stats_release(struct inode *inode, struct file *file)\n{\n\tkfree(file->private_data);\n\tfile->private_data = NULL;\n\n\treturn 0;\n}\n\nstatic const struct file_operations uvc_debugfs_stats_fops = {\n\t.owner = THIS_MODULE,\n\t.open = uvc_debugfs_stats_open,\n\t.llseek = no_llseek,\n\t.read = uvc_debugfs_stats_read,\n\t.release = uvc_debugfs_stats_release,\n};\n\n \n\nstatic struct dentry *uvc_debugfs_root_dir;\n\nvoid uvc_debugfs_init_stream(struct uvc_streaming *stream)\n{\n\tstruct usb_device *udev = stream->dev->udev;\n\tchar dir_name[33];\n\n\tif (uvc_debugfs_root_dir == NULL)\n\t\treturn;\n\n\tsnprintf(dir_name, sizeof(dir_name), \"%u-%u-%u\", udev->bus->busnum,\n\t\t udev->devnum, stream->intfnum);\n\n\tstream->debugfs_dir = debugfs_create_dir(dir_name,\n\t\t\t\t\t\t uvc_debugfs_root_dir);\n\n\tdebugfs_create_file(\"stats\", 0444, stream->debugfs_dir, stream,\n\t\t\t    &uvc_debugfs_stats_fops);\n}\n\nvoid uvc_debugfs_cleanup_stream(struct uvc_streaming *stream)\n{\n\tdebugfs_remove_recursive(stream->debugfs_dir);\n\tstream->debugfs_dir = NULL;\n}\n\nvoid uvc_debugfs_init(void)\n{\n\tuvc_debugfs_root_dir = debugfs_create_dir(\"uvcvideo\", usb_debug_root);\n}\n\nvoid uvc_debugfs_cleanup(void)\n{\n\tdebugfs_remove_recursive(uvc_debugfs_root_dir);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}