{
  "module_name": "go7007-priv.h",
  "hash_id": "e9d118a6a34e736625136413b94f0c9972e2d44f57a3b04f812598ef3b75fe4b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/go7007/go7007-priv.h",
  "human_readable_source": " \n \n\n \n\n#include <media/v4l2-device.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-fh.h>\n#include <media/videobuf2-v4l2.h>\n\nstruct go7007;\n\n \n#define GO7007_BOARDID_MATRIX_II\t0\n#define GO7007_BOARDID_MATRIX_RELOAD\t1\n#define GO7007_BOARDID_STAR_TREK\t2\n#define GO7007_BOARDID_PCI_VOYAGER\t3\n#define GO7007_BOARDID_XMEN\t\t4\n#define GO7007_BOARDID_XMEN_II\t\t5\n#define GO7007_BOARDID_XMEN_III\t\t6\n#define GO7007_BOARDID_MATRIX_REV\t7\n#define GO7007_BOARDID_PX_M402U\t\t8\n#define GO7007_BOARDID_PX_TV402U\t9\n#define GO7007_BOARDID_LIFEVIEW_LR192\t10  \n#define GO7007_BOARDID_ENDURA\t\t11\n#define GO7007_BOARDID_ADLINK_MPG24\t12\n#define GO7007_BOARDID_SENSORAY_2250\t13  \n#define GO7007_BOARDID_ADS_USBAV_709    14\n\n \n#define GO7007_BOARD_HAS_AUDIO\t\t(1<<0)\n#define GO7007_BOARD_USE_ONBOARD_I2C\t(1<<1)\n#define GO7007_BOARD_HAS_TUNER\t\t(1<<2)\n\n \n#define GO7007_SENSOR_VALID_POLAR\t(1<<0)\n#define GO7007_SENSOR_HREF_POLAR\t(1<<1)\n#define GO7007_SENSOR_VREF_POLAR\t(1<<2)\n#define GO7007_SENSOR_FIELD_ID_POLAR\t(1<<3)\n#define GO7007_SENSOR_BIT_WIDTH\t\t(1<<4)\n#define GO7007_SENSOR_VALID_ENABLE\t(1<<5)\n#define GO7007_SENSOR_656\t\t(1<<6)\n#define GO7007_SENSOR_CONFIG_MASK\t0x7f\n#define GO7007_SENSOR_TV\t\t(1<<7)\n#define GO7007_SENSOR_VBI\t\t(1<<8)\n#define GO7007_SENSOR_SCALING\t\t(1<<9)\n#define GO7007_SENSOR_SAA7115\t\t(1<<10)\n\n \n#define GO7007_AUDIO_I2S_MODE_1\t\t(1)\n#define GO7007_AUDIO_I2S_MODE_2\t\t(2)\n#define GO7007_AUDIO_I2S_MODE_3\t\t(3)\n#define GO7007_AUDIO_BCLK_POLAR\t\t(1<<2)\n#define GO7007_AUDIO_WORD_14\t\t(14<<4)\n#define GO7007_AUDIO_WORD_16\t\t(16<<4)\n#define GO7007_AUDIO_ONE_CHANNEL\t(1<<11)\n#define GO7007_AUDIO_I2S_MASTER\t\t(1<<16)\n#define GO7007_AUDIO_OKI_MODE\t\t(1<<17)\n\n#define GO7007_CID_CUSTOM_BASE\t\t(V4L2_CID_DETECT_CLASS_BASE + 0x1000)\n#define V4L2_CID_PIXEL_THRESHOLD0\t(GO7007_CID_CUSTOM_BASE+1)\n#define V4L2_CID_MOTION_THRESHOLD0\t(GO7007_CID_CUSTOM_BASE+2)\n#define V4L2_CID_MB_THRESHOLD0\t\t(GO7007_CID_CUSTOM_BASE+3)\n#define V4L2_CID_PIXEL_THRESHOLD1\t(GO7007_CID_CUSTOM_BASE+4)\n#define V4L2_CID_MOTION_THRESHOLD1\t(GO7007_CID_CUSTOM_BASE+5)\n#define V4L2_CID_MB_THRESHOLD1\t\t(GO7007_CID_CUSTOM_BASE+6)\n#define V4L2_CID_PIXEL_THRESHOLD2\t(GO7007_CID_CUSTOM_BASE+7)\n#define V4L2_CID_MOTION_THRESHOLD2\t(GO7007_CID_CUSTOM_BASE+8)\n#define V4L2_CID_MB_THRESHOLD2\t\t(GO7007_CID_CUSTOM_BASE+9)\n#define V4L2_CID_PIXEL_THRESHOLD3\t(GO7007_CID_CUSTOM_BASE+10)\n#define V4L2_CID_MOTION_THRESHOLD3\t(GO7007_CID_CUSTOM_BASE+11)\n#define V4L2_CID_MB_THRESHOLD3\t\t(GO7007_CID_CUSTOM_BASE+12)\n\nstruct go7007_board_info {\n\tunsigned int flags;\n\tint hpi_buffer_cap;\n\tunsigned int sensor_flags;\n\tint sensor_width;\n\tint sensor_height;\n\tint sensor_framerate;\n\tint sensor_h_offset;\n\tint sensor_v_offset;\n\tunsigned int audio_flags;\n\tint audio_rate;\n\tint audio_bclk_div;\n\tint audio_main_div;\n\tint num_i2c_devs;\n\tstruct go_i2c {\n\t\tconst char *type;\n\t\tunsigned int is_video:1;\n\t\tunsigned int is_audio:1;\n\t\tint addr;\n\t\tu32 flags;\n\t} i2c_devs[5];\n\tint num_inputs;\n\tstruct {\n\t\tint video_input;\n\t\tint audio_index;\n\t\tchar *name;\n\t} inputs[4];\n\tint video_config;\n\tint num_aud_inputs;\n\tstruct {\n\t\tint audio_input;\n\t\tchar *name;\n\t} aud_inputs[3];\n};\n\nstruct go7007_hpi_ops {\n\tint (*interface_reset)(struct go7007 *go);\n\tint (*write_interrupt)(struct go7007 *go, int addr, int data);\n\tint (*read_interrupt)(struct go7007 *go);\n\tint (*stream_start)(struct go7007 *go);\n\tint (*stream_stop)(struct go7007 *go);\n\tint (*send_firmware)(struct go7007 *go, u8 *data, int len);\n\tint (*send_command)(struct go7007 *go, unsigned int cmd, void *arg);\n\tvoid (*release)(struct go7007 *go);\n};\n\n \n#define\tGO7007_BUF_PAGES\t(128 * 1024 / PAGE_SIZE)\n#define\tGO7007_BUF_SIZE\t\t(GO7007_BUF_PAGES << PAGE_SHIFT)\n\nstruct go7007_buffer {\n\tstruct vb2_v4l2_buffer vb;\n\tstruct list_head list;\n\tunsigned int frame_offset;\n\tu32 modet_active;\n};\n\n#define GO7007_RATIO_1_1\t0\n#define GO7007_RATIO_4_3\t1\n#define GO7007_RATIO_16_9\t2\n\nenum go7007_parser_state {\n\tSTATE_DATA,\n\tSTATE_00,\n\tSTATE_00_00,\n\tSTATE_00_00_01,\n\tSTATE_FF,\n\tSTATE_VBI_LEN_A,\n\tSTATE_VBI_LEN_B,\n\tSTATE_MODET_MAP,\n\tSTATE_UNPARSED,\n};\n\nstruct go7007 {\n\tstruct device *dev;\n\tu8 bus_info[32];\n\tconst struct go7007_board_info *board_info;\n\tunsigned int board_id;\n\tint tuner_type;\n\tint channel_number;  \n\tchar name[64];\n\tstruct video_device vdev;\n\tvoid *boot_fw;\n\tunsigned boot_fw_len;\n\tstruct v4l2_device v4l2_dev;\n\tstruct v4l2_ctrl_handler hdl;\n\tstruct v4l2_ctrl *mpeg_video_encoding;\n\tstruct v4l2_ctrl *mpeg_video_gop_size;\n\tstruct v4l2_ctrl *mpeg_video_gop_closure;\n\tstruct v4l2_ctrl *mpeg_video_bitrate;\n\tstruct v4l2_ctrl *mpeg_video_aspect_ratio;\n\tstruct v4l2_ctrl *mpeg_video_b_frames;\n\tstruct v4l2_ctrl *mpeg_video_rep_seqheader;\n\tstruct v4l2_ctrl *modet_mode;\n\tenum { STATUS_INIT, STATUS_ONLINE, STATUS_SHUTDOWN } status;\n\tspinlock_t spinlock;\n\tstruct mutex hw_lock;\n\tstruct mutex serialize_lock;\n\tint audio_enabled;\n\tstruct v4l2_subdev *sd_video;\n\tstruct v4l2_subdev *sd_audio;\n\tu8 usb_buf[16];\n\n\t \n\tint input;\n\tint aud_input;\n\tenum { GO7007_STD_NTSC, GO7007_STD_PAL, GO7007_STD_OTHER } standard;\n\tv4l2_std_id std;\n\tint sensor_framerate;\n\tint width;\n\tint height;\n\tint encoder_h_offset;\n\tint encoder_v_offset;\n\tunsigned int encoder_h_halve:1;\n\tunsigned int encoder_v_halve:1;\n\tunsigned int encoder_subsample:1;\n\n\t \n\tu32 format;\n\tint bitrate;\n\tint fps_scale;\n\tint pali;\n\tint aspect_ratio;\n\tint gop_size;\n\tunsigned int ipb:1;\n\tunsigned int closed_gop:1;\n\tunsigned int repeat_seqhead:1;\n\tunsigned int seq_header_enable:1;\n\tunsigned int gop_header_enable:1;\n\tunsigned int dvd_mode:1;\n\tunsigned int interlace_coding:1;\n\n\t \n\tunsigned int modet_enable:1;\n\tstruct {\n\t\tunsigned int enable:1;\n\t\tint pixel_threshold;\n\t\tint motion_threshold;\n\t\tint mb_threshold;\n\t} modet[4];\n\tunsigned char modet_map[1624];\n\tunsigned char active_map[216];\n\tu32 modet_event_status;\n\n\t \n\tstruct mutex queue_lock;\n\tstruct vb2_queue vidq;\n\tenum go7007_parser_state state;\n\tint parse_length;\n\tu16 modet_word;\n\tint seen_frame;\n\tu32 next_seq;\n\tstruct list_head vidq_active;\n\twait_queue_head_t frame_waitq;\n\tstruct go7007_buffer *active_buf;\n\n\t \n\tvoid (*audio_deliver)(struct go7007 *go, u8 *buf, int length);\n\tvoid *snd_context;\n\n\t \n\tint i2c_adapter_online;\n\tstruct i2c_adapter i2c_adapter;\n\n\t \n\tconst struct go7007_hpi_ops *hpi_ops;\n\tvoid *hpi_context;\n\tint interrupt_available;\n\twait_queue_head_t interrupt_waitq;\n\tunsigned short interrupt_value;\n\tunsigned short interrupt_data;\n};\n\nstatic inline struct go7007 *to_go7007(struct v4l2_device *v4l2_dev)\n{\n\treturn container_of(v4l2_dev, struct go7007, v4l2_dev);\n}\n\n \n#define go7007_interface_reset(go) \\\n\t\t\t((go)->hpi_ops->interface_reset(go))\n#define\tgo7007_write_interrupt(go, x, y) \\\n\t\t\t((go)->hpi_ops->write_interrupt)((go), (x), (y))\n#define go7007_stream_start(go) \\\n\t\t\t((go)->hpi_ops->stream_start(go))\n#define go7007_stream_stop(go) \\\n\t\t\t((go)->hpi_ops->stream_stop(go))\n#define\tgo7007_send_firmware(go, x, y) \\\n\t\t\t((go)->hpi_ops->send_firmware)((go), (x), (y))\n#define go7007_write_addr(go, x, y) \\\n\t\t\t((go)->hpi_ops->write_interrupt)((go), (x)|0x8000, (y))\n\n \nint go7007_read_addr(struct go7007 *go, u16 addr, u16 *data);\nint go7007_read_interrupt(struct go7007 *go, u16 *value, u16 *data);\nint go7007_boot_encoder(struct go7007 *go, int init_i2c);\nint go7007_reset_encoder(struct go7007 *go);\nint go7007_register_encoder(struct go7007 *go, unsigned num_i2c_devs);\nint go7007_start_encoder(struct go7007 *go);\nvoid go7007_parse_video_stream(struct go7007 *go, u8 *buf, int length);\nstruct go7007 *go7007_alloc(const struct go7007_board_info *board,\n\t\t\t\t\tstruct device *dev);\nvoid go7007_update_board(struct go7007 *go);\n\n \nint go7007_construct_fw_image(struct go7007 *go, u8 **fw, int *fwlen);\n\n \nint go7007_i2c_init(struct go7007 *go);\nint go7007_i2c_remove(struct go7007 *go);\n\n \nint go7007_v4l2_init(struct go7007 *go);\nint go7007_v4l2_ctrl_init(struct go7007 *go);\nvoid go7007_v4l2_remove(struct go7007 *go);\n\n \nint go7007_snd_init(struct go7007 *go);\nint go7007_snd_remove(struct go7007 *go);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}