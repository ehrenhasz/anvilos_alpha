{
  "module_name": "pvrusb2-cx2584x-v4l.c",
  "hash_id": "c03185bfa0457d66e9d827ed07af806efd11a53c302e763631e3a77cc3a1ba5c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/pvrusb2/pvrusb2-cx2584x-v4l.c",
  "human_readable_source": "\n \n\n \n\n#include \"pvrusb2-cx2584x-v4l.h\"\n\n\n#include \"pvrusb2-hdw-internal.h\"\n#include \"pvrusb2-debug.h\"\n#include <media/drv-intf/cx25840.h>\n#include <linux/videodev2.h>\n#include <media/v4l2-common.h>\n#include <linux/errno.h>\n\n\nstruct routing_scheme_item {\n\tint vid;\n\tint aud;\n};\n\nstruct routing_scheme {\n\tconst struct routing_scheme_item *def;\n\tunsigned int cnt;\n};\n\nstatic const struct routing_scheme_item routing_scheme0[] = {\n\t[PVR2_CVAL_INPUT_TV] = {\n\t\t.vid = CX25840_COMPOSITE7,\n\t\t.aud = CX25840_AUDIO8,\n\t},\n\t[PVR2_CVAL_INPUT_RADIO] = {  \n\t\t.vid = CX25840_COMPOSITE3,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n\t[PVR2_CVAL_INPUT_COMPOSITE] = {\n\t\t.vid = CX25840_COMPOSITE3,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n\t[PVR2_CVAL_INPUT_SVIDEO] = {\n\t\t.vid = CX25840_SVIDEO1,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n};\n\nstatic const struct routing_scheme routing_def0 = {\n\t.def = routing_scheme0,\n\t.cnt = ARRAY_SIZE(routing_scheme0),\n};\n\n \nstatic const struct routing_scheme_item routing_schemegv[] = {\n\t[PVR2_CVAL_INPUT_TV] = {\n\t\t.vid = CX25840_COMPOSITE2,\n\t\t.aud = CX25840_AUDIO5,\n\t},\n\t[PVR2_CVAL_INPUT_RADIO] = {\n\t\t \n\t\t.vid = CX25840_COMPOSITE1,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n\t[PVR2_CVAL_INPUT_COMPOSITE] = {\n\t\t.vid = CX25840_COMPOSITE1,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n\t[PVR2_CVAL_INPUT_SVIDEO] = {\n\t\t.vid = (CX25840_SVIDEO_LUMA3|CX25840_SVIDEO_CHROMA4),\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n};\n\nstatic const struct routing_scheme routing_defgv = {\n\t.def = routing_schemegv,\n\t.cnt = ARRAY_SIZE(routing_schemegv),\n};\n\n \nstatic const struct routing_scheme_item routing_schemeav400[] = {\n\t[PVR2_CVAL_INPUT_COMPOSITE] = {\n\t\t.vid = CX25840_COMPOSITE1,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n\t[PVR2_CVAL_INPUT_SVIDEO] = {\n\t\t.vid = (CX25840_SVIDEO_LUMA2|CX25840_SVIDEO_CHROMA4),\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n};\n\nstatic const struct routing_scheme routing_defav400 = {\n\t.def = routing_schemeav400,\n\t.cnt = ARRAY_SIZE(routing_schemeav400),\n};\n\nstatic const struct routing_scheme_item routing_scheme160xxx[] = {\n\t[PVR2_CVAL_INPUT_TV] = {\n\t\t.vid = CX25840_COMPOSITE7,\n\t\t.aud = CX25840_AUDIO8,\n\t},\n\t[PVR2_CVAL_INPUT_RADIO] = {\n\t\t.vid = CX25840_COMPOSITE4,\n\t\t.aud = CX25840_AUDIO6,\n\t},\n\t[PVR2_CVAL_INPUT_COMPOSITE] = {\n\t\t.vid = CX25840_COMPOSITE3,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n\t[PVR2_CVAL_INPUT_SVIDEO] = {\n\t\t.vid = CX25840_SVIDEO1,\n\t\t.aud = CX25840_AUDIO_SERIAL,\n\t},\n};\n\nstatic const struct routing_scheme routing_def160xxx = {\n\t.def = routing_scheme160xxx,\n\t.cnt = ARRAY_SIZE(routing_scheme160xxx),\n};\n\nstatic const struct routing_scheme *routing_schemes[] = {\n\t[PVR2_ROUTING_SCHEME_HAUPPAUGE] = &routing_def0,\n\t[PVR2_ROUTING_SCHEME_GOTVIEW] = &routing_defgv,\n\t[PVR2_ROUTING_SCHEME_AV400] = &routing_defav400,\n\t[PVR2_ROUTING_SCHEME_HAUP160XXX] = &routing_def160xxx,\n};\n\nvoid pvr2_cx25840_subdev_update(struct pvr2_hdw *hdw, struct v4l2_subdev *sd)\n{\n\tpvr2_trace(PVR2_TRACE_CHIPS, \"subdev cx2584x update...\");\n\tif (hdw->input_dirty || hdw->force_dirty) {\n\t\tenum cx25840_video_input vid_input;\n\t\tenum cx25840_audio_input aud_input;\n\t\tconst struct routing_scheme *sp;\n\t\tunsigned int sid = hdw->hdw_desc->signal_routing_scheme;\n\n\t\tsp = (sid < ARRAY_SIZE(routing_schemes)) ?\n\t\t\trouting_schemes[sid] : NULL;\n\t\tif ((sp == NULL) ||\n\t\t    (hdw->input_val < 0) ||\n\t\t    (hdw->input_val >= sp->cnt)) {\n\t\t\tpvr2_trace(PVR2_TRACE_ERROR_LEGS,\n\t\t\t\t   \"*** WARNING *** subdev cx2584x set_input: Invalid routing scheme (%u) and/or input (%d)\",\n\t\t\t\t   sid, hdw->input_val);\n\t\t\treturn;\n\t\t}\n\t\tvid_input = sp->def[hdw->input_val].vid;\n\t\taud_input = sp->def[hdw->input_val].aud;\n\t\tpvr2_trace(PVR2_TRACE_CHIPS,\n\t\t\t   \"subdev cx2584x set_input vid=0x%x aud=0x%x\",\n\t\t\t   vid_input, aud_input);\n\t\tsd->ops->video->s_routing(sd, (u32)vid_input, 0, 0);\n\t\tsd->ops->audio->s_routing(sd, (u32)aud_input, 0, 0);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}