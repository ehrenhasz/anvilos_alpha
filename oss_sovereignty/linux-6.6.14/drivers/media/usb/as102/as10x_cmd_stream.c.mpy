{
  "module_name": "as10x_cmd_stream.c",
  "hash_id": "7cacdcef36cb83116014c9a52b099081ada3579ef6729b56be7144081c8eed56",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/as102/as10x_cmd_stream.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include \"as102_drv.h\"\n#include \"as10x_cmd.h\"\n\n \nint as10x_cmd_add_PID_filter(struct as10x_bus_adapter_t *adap,\n\t\t\t     struct as10x_ts_filter *filter)\n{\n\tint error;\n\tstruct as10x_cmd_t *pcmd, *prsp;\n\n\tpcmd = adap->cmd;\n\tprsp = adap->rsp;\n\n\t \n\tas10x_cmd_build(pcmd, (++adap->cmd_xid),\n\t\t\tsizeof(pcmd->body.add_pid_filter.req));\n\n\t \n\tpcmd->body.add_pid_filter.req.proc_id =\n\t\tcpu_to_le16(CONTROL_PROC_SETFILTER);\n\tpcmd->body.add_pid_filter.req.pid = cpu_to_le16(filter->pid);\n\tpcmd->body.add_pid_filter.req.stream_type = filter->type;\n\n\tif (filter->idx < 16)\n\t\tpcmd->body.add_pid_filter.req.idx = filter->idx;\n\telse\n\t\tpcmd->body.add_pid_filter.req.idx = 0xFF;\n\n\t \n\tif (adap->ops->xfer_cmd) {\n\t\terror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\n\t\t\t\tsizeof(pcmd->body.add_pid_filter.req)\n\t\t\t\t+ HEADER_SIZE, (uint8_t *) prsp,\n\t\t\t\tsizeof(prsp->body.add_pid_filter.rsp)\n\t\t\t\t+ HEADER_SIZE);\n\t} else {\n\t\terror = AS10X_CMD_ERROR;\n\t}\n\n\tif (error < 0)\n\t\tgoto out;\n\n\t \n\terror = as10x_rsp_parse(prsp, CONTROL_PROC_SETFILTER_RSP);\n\n\tif (error == 0) {\n\t\t \n\t\tfilter->idx = prsp->body.add_pid_filter.rsp.filter_id;\n\t}\n\nout:\n\treturn error;\n}\n\n \nint as10x_cmd_del_PID_filter(struct as10x_bus_adapter_t *adap,\n\t\t\t     uint16_t pid_value)\n{\n\tint error;\n\tstruct as10x_cmd_t *pcmd, *prsp;\n\n\tpcmd = adap->cmd;\n\tprsp = adap->rsp;\n\n\t \n\tas10x_cmd_build(pcmd, (++adap->cmd_xid),\n\t\t\tsizeof(pcmd->body.del_pid_filter.req));\n\n\t \n\tpcmd->body.del_pid_filter.req.proc_id =\n\t\tcpu_to_le16(CONTROL_PROC_REMOVEFILTER);\n\tpcmd->body.del_pid_filter.req.pid = cpu_to_le16(pid_value);\n\n\t \n\tif (adap->ops->xfer_cmd) {\n\t\terror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\n\t\t\t\tsizeof(pcmd->body.del_pid_filter.req)\n\t\t\t\t+ HEADER_SIZE, (uint8_t *) prsp,\n\t\t\t\tsizeof(prsp->body.del_pid_filter.rsp)\n\t\t\t\t+ HEADER_SIZE);\n\t} else {\n\t\terror = AS10X_CMD_ERROR;\n\t}\n\n\tif (error < 0)\n\t\tgoto out;\n\n\t \n\terror = as10x_rsp_parse(prsp, CONTROL_PROC_REMOVEFILTER_RSP);\n\nout:\n\treturn error;\n}\n\n \nint as10x_cmd_start_streaming(struct as10x_bus_adapter_t *adap)\n{\n\tint error;\n\tstruct as10x_cmd_t *pcmd, *prsp;\n\n\tpcmd = adap->cmd;\n\tprsp = adap->rsp;\n\n\t \n\tas10x_cmd_build(pcmd, (++adap->cmd_xid),\n\t\t\tsizeof(pcmd->body.start_streaming.req));\n\n\t \n\tpcmd->body.start_streaming.req.proc_id =\n\t\tcpu_to_le16(CONTROL_PROC_START_STREAMING);\n\n\t \n\tif (adap->ops->xfer_cmd) {\n\t\terror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\n\t\t\t\tsizeof(pcmd->body.start_streaming.req)\n\t\t\t\t+ HEADER_SIZE, (uint8_t *) prsp,\n\t\t\t\tsizeof(prsp->body.start_streaming.rsp)\n\t\t\t\t+ HEADER_SIZE);\n\t} else {\n\t\terror = AS10X_CMD_ERROR;\n\t}\n\n\tif (error < 0)\n\t\tgoto out;\n\n\t \n\terror = as10x_rsp_parse(prsp, CONTROL_PROC_START_STREAMING_RSP);\n\nout:\n\treturn error;\n}\n\n \nint as10x_cmd_stop_streaming(struct as10x_bus_adapter_t *adap)\n{\n\tint8_t error;\n\tstruct as10x_cmd_t *pcmd, *prsp;\n\n\tpcmd = adap->cmd;\n\tprsp = adap->rsp;\n\n\t \n\tas10x_cmd_build(pcmd, (++adap->cmd_xid),\n\t\t\tsizeof(pcmd->body.stop_streaming.req));\n\n\t \n\tpcmd->body.stop_streaming.req.proc_id =\n\t\tcpu_to_le16(CONTROL_PROC_STOP_STREAMING);\n\n\t \n\tif (adap->ops->xfer_cmd) {\n\t\terror = adap->ops->xfer_cmd(adap, (uint8_t *) pcmd,\n\t\t\t\tsizeof(pcmd->body.stop_streaming.req)\n\t\t\t\t+ HEADER_SIZE, (uint8_t *) prsp,\n\t\t\t\tsizeof(prsp->body.stop_streaming.rsp)\n\t\t\t\t+ HEADER_SIZE);\n\t} else {\n\t\terror = AS10X_CMD_ERROR;\n\t}\n\n\tif (error < 0)\n\t\tgoto out;\n\n\t \n\terror = as10x_rsp_parse(prsp, CONTROL_PROC_STOP_STREAMING_RSP);\n\nout:\n\treturn error;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}