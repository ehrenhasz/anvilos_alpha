{
  "module_name": "cx231xx-input.c",
  "hash_id": "5ef48731474b462ae6431dbf16655c93e7f9e5e87440906a19c56a50be503ef6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/cx231xx/cx231xx-input.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n#include \"cx231xx.h\"\n#include <linux/slab.h>\n#include <linux/bitrev.h>\n\n#define MODULE_NAME \"cx231xx-input\"\n\nstatic int get_key_isdbt(struct IR_i2c *ir, enum rc_proto *protocol,\n\t\t\t u32 *pscancode, u8 *toggle)\n{\n\tint\trc;\n\tu8\tcmd, scancode;\n\n\tdev_dbg(&ir->rc->dev, \"%s\\n\", __func__);\n\n\t\t \n\trc = i2c_master_recv(ir->c, &cmd, 1);\n\tif (rc < 0)\n\t\treturn rc;\n\tif (rc != 1)\n\t\treturn -EIO;\n\n\t \n\n\tif (cmd == 0xff)\n\t\treturn 0;\n\n\tscancode = bitrev8(cmd);\n\n\tdev_dbg(&ir->rc->dev, \"cmd %02x, scan = %02x\\n\", cmd, scancode);\n\n\t*protocol = RC_PROTO_OTHER;\n\t*pscancode = scancode;\n\t*toggle = 0;\n\treturn 1;\n}\n\nint cx231xx_ir_init(struct cx231xx *dev)\n{\n\tstruct i2c_board_info info;\n\tu8 ir_i2c_bus;\n\n\tdev_dbg(dev->dev, \"%s\\n\", __func__);\n\n\t \n\tif (!cx231xx_boards[dev->model].rc_map_name)\n\t\treturn -ENODEV;\n\n\trequest_module(\"ir-kbd-i2c\");\n\n\tmemset(&info, 0, sizeof(struct i2c_board_info));\n\tmemset(&dev->init_data, 0, sizeof(dev->init_data));\n\tdev->init_data.rc_dev = rc_allocate_device(RC_DRIVER_SCANCODE);\n\tif (!dev->init_data.rc_dev)\n\t\treturn -ENOMEM;\n\n\tdev->init_data.name = cx231xx_boards[dev->model].name;\n\n\tstrscpy(info.type, \"ir_video\", I2C_NAME_SIZE);\n\tinfo.platform_data = &dev->init_data;\n\n\t \n\tdev->init_data.get_key = get_key_isdbt;\n\tdev->init_data.ir_codes = cx231xx_boards[dev->model].rc_map_name;\n\t \n\tdev->init_data.rc_dev->scancode_mask = 0xff;\n\tdev->init_data.rc_dev->driver_name = \"cx231xx\";\n\tdev->init_data.type = RC_PROTO_BIT_NEC;\n\tinfo.addr = 0x30;\n\n\t \n\tir_i2c_bus = cx231xx_boards[dev->model].ir_i2c_master;\n\tdev_dbg(dev->dev, \"Trying to bind ir at bus %d, addr 0x%02x\\n\",\n\t\tir_i2c_bus, info.addr);\n\tdev->ir_i2c_client = i2c_new_client_device(\n\t\tcx231xx_get_i2c_adap(dev, ir_i2c_bus), &info);\n\n\treturn 0;\n}\n\nvoid cx231xx_ir_exit(struct cx231xx *dev)\n{\n\ti2c_unregister_device(dev->ir_i2c_client);\n\tdev->ir_i2c_client = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}