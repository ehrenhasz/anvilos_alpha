{
  "module_name": "usbtv-core.c",
  "hash_id": "d13fa6288d6bdaba15a612209528d093ca9bf670acb0c62e9ac71caf8592e0b1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/usb/usbtv/usbtv-core.c",
  "human_readable_source": " \n \n\n#include \"usbtv.h\"\n\nint usbtv_set_regs(struct usbtv *usbtv, const u16 regs[][2], int size)\n{\n\tint ret;\n\tint pipe = usb_sndctrlpipe(usbtv->udev, 0);\n\tint i;\n\n\tfor (i = 0; i < size; i++) {\n\t\tu16 index = regs[i][0];\n\t\tu16 value = regs[i][1];\n\n\t\tret = usb_control_msg(usbtv->udev, pipe, USBTV_REQUEST_REG,\n\t\t\tUSB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_DEVICE,\n\t\t\tvalue, index, NULL, 0, USB_CTRL_GET_TIMEOUT);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int usbtv_probe(struct usb_interface *intf,\n\tconst struct usb_device_id *id)\n{\n\tint ret;\n\tint size;\n\tstruct device *dev = &intf->dev;\n\tstruct usbtv *usbtv;\n\tstruct usb_host_endpoint *ep;\n\n\t \n\tif (intf->num_altsetting != 2)\n\t\treturn -ENODEV;\n\tif (intf->altsetting[1].desc.bNumEndpoints != 4)\n\t\treturn -ENODEV;\n\n\tep = &intf->altsetting[1].endpoint[0];\n\n\t \n\tsize = usb_endpoint_maxp(&ep->desc);\n\tsize = size * usb_endpoint_maxp_mult(&ep->desc);\n\n\t \n\tusbtv = kzalloc(sizeof(struct usbtv), GFP_KERNEL);\n\tif (usbtv == NULL)\n\t\treturn -ENOMEM;\n\tusbtv->dev = dev;\n\tusbtv->udev = usb_get_dev(interface_to_usbdev(intf));\n\n\tusbtv->iso_size = size;\n\n\tusb_set_intfdata(intf, usbtv);\n\n\tret = usbtv_video_init(usbtv);\n\tif (ret < 0)\n\t\tgoto usbtv_video_fail;\n\n\tret = usbtv_audio_init(usbtv);\n\tif (ret < 0)\n\t\tgoto usbtv_audio_fail;\n\n\t \n\tv4l2_device_get(&usbtv->v4l2_dev);\n\n\tdev_info(dev, \"Fushicai USBTV007 Audio-Video Grabber\\n\");\n\treturn 0;\n\nusbtv_audio_fail:\n\t \n\tv4l2_device_get(&usbtv->v4l2_dev);\n\t \n\tusbtv_video_free(usbtv);\n\nusbtv_video_fail:\n\tusb_set_intfdata(intf, NULL);\n\tusb_put_dev(usbtv->udev);\n\tkfree(usbtv);\n\n\treturn ret;\n}\n\nstatic void usbtv_disconnect(struct usb_interface *intf)\n{\n\tstruct usbtv *usbtv = usb_get_intfdata(intf);\n\n\tusb_set_intfdata(intf, NULL);\n\n\tif (!usbtv)\n\t\treturn;\n\n\tusbtv_audio_free(usbtv);\n\tusbtv_video_free(usbtv);\n\n\tusb_put_dev(usbtv->udev);\n\tusbtv->udev = NULL;\n\n\t \n\tv4l2_device_put(&usbtv->v4l2_dev);\n}\n\nstatic const struct usb_device_id usbtv_id_table[] = {\n\t{ USB_DEVICE(0x1b71, 0x3002) },\n\t{ USB_DEVICE(0x1f71, 0x3301) },\n\t{ USB_DEVICE(0x1f71, 0x3306) },\n\t{}\n};\nMODULE_DEVICE_TABLE(usb, usbtv_id_table);\n\nMODULE_AUTHOR(\"Lubomir Rintel, Federico Simoncelli\");\nMODULE_DESCRIPTION(\"Fushicai USBTV007 Audio-Video Grabber Driver\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n\nstatic struct usb_driver usbtv_usb_driver = {\n\t.name = \"usbtv\",\n\t.id_table = usbtv_id_table,\n\t.probe = usbtv_probe,\n\t.disconnect = usbtv_disconnect,\n};\n\nmodule_usb_driver(usbtv_usb_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}