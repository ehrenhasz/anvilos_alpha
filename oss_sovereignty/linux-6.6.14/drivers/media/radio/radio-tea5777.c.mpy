{
  "module_name": "radio-tea5777.c",
  "hash_id": "75e4b718ffb969a9df913e52d11588f3075ecea01632a0661f26d067a9bec90a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/radio/radio-tea5777.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-dev.h>\n#include <media/v4l2-fh.h>\n#include <media/v4l2-ioctl.h>\n#include <media/v4l2-event.h>\n#include \"radio-tea5777.h\"\n\nMODULE_AUTHOR(\"Hans de Goede <perex@perex.cz>\");\nMODULE_DESCRIPTION(\"Routines for control of TEA5777 Philips AM/FM radio tuner chips\");\nMODULE_LICENSE(\"GPL\");\n\n#define TEA5777_FM_IF\t\t\t150  \n#define TEA5777_FM_FREQ_STEP\t\t50   \n\n#define TEA5777_AM_IF\t\t\t21   \n#define TEA5777_AM_FREQ_STEP\t\t1    \n\n \n#define TEA5777_W_MUTE_MASK\t\t(1LL << 47)\n#define TEA5777_W_MUTE_SHIFT\t\t47\n#define TEA5777_W_AM_FM_MASK\t\t(1LL << 46)\n#define TEA5777_W_AM_FM_SHIFT\t\t46\n#define TEA5777_W_STB_MASK\t\t(1LL << 45)\n#define TEA5777_W_STB_SHIFT\t\t45\n\n#define TEA5777_W_IFCE_MASK\t\t(1LL << 29)\n#define TEA5777_W_IFCE_SHIFT\t\t29\n#define TEA5777_W_IFW_MASK\t\t(1LL << 28)\n#define TEA5777_W_IFW_SHIFT\t\t28\n#define TEA5777_W_HILO_MASK\t\t(1LL << 27)\n#define TEA5777_W_HILO_SHIFT\t\t27\n#define TEA5777_W_DBUS_MASK\t\t(1LL << 26)\n#define TEA5777_W_DBUS_SHIFT\t\t26\n\n#define TEA5777_W_INTEXT_MASK\t\t(1LL << 24)\n#define TEA5777_W_INTEXT_SHIFT\t\t24\n#define TEA5777_W_P1_MASK\t\t(1LL << 23)\n#define TEA5777_W_P1_SHIFT\t\t23\n#define TEA5777_W_P0_MASK\t\t(1LL << 22)\n#define TEA5777_W_P0_SHIFT\t\t22\n#define TEA5777_W_PEN1_MASK\t\t(1LL << 21)\n#define TEA5777_W_PEN1_SHIFT\t\t21\n#define TEA5777_W_PEN0_MASK\t\t(1LL << 20)\n#define TEA5777_W_PEN0_SHIFT\t\t20\n\n#define TEA5777_W_CHP0_MASK\t\t(1LL << 18)\n#define TEA5777_W_CHP0_SHIFT\t\t18\n#define TEA5777_W_DEEM_MASK\t\t(1LL << 17)\n#define TEA5777_W_DEEM_SHIFT\t\t17\n\n#define TEA5777_W_SEARCH_MASK\t\t(1LL << 7)\n#define TEA5777_W_SEARCH_SHIFT\t\t7\n#define TEA5777_W_PROGBLIM_MASK\t\t(1LL << 6)\n#define TEA5777_W_PROGBLIM_SHIFT\t6\n#define TEA5777_W_UPDWN_MASK\t\t(1LL << 5)\n#define TEA5777_W_UPDWN_SHIFT\t\t5\n#define TEA5777_W_SLEV_MASK\t\t(3LL << 3)\n#define TEA5777_W_SLEV_SHIFT\t\t3\n\n \n#define TEA5777_W_FM_PLL_MASK\t\t(0x1fffLL << 32)\n#define TEA5777_W_FM_PLL_SHIFT\t\t32\n#define TEA5777_W_FM_FREF_MASK\t\t(0x03LL << 30)\n#define TEA5777_W_FM_FREF_SHIFT\t\t30\n#define TEA5777_W_FM_FREF_VALUE\t\t0LL  \n\n#define TEA5777_W_FM_FORCEMONO_MASK\t(1LL << 15)\n#define TEA5777_W_FM_FORCEMONO_SHIFT\t15\n#define TEA5777_W_FM_SDSOFF_MASK\t(1LL << 14)\n#define TEA5777_W_FM_SDSOFF_SHIFT\t14\n#define TEA5777_W_FM_DOFF_MASK\t\t(1LL << 13)\n#define TEA5777_W_FM_DOFF_SHIFT\t\t13\n\n#define TEA5777_W_FM_STEP_MASK\t\t(3LL << 1)\n#define TEA5777_W_FM_STEP_SHIFT\t\t1\n\n \n#define TEA5777_W_AM_PLL_MASK\t\t(0x7ffLL << 34)\n#define TEA5777_W_AM_PLL_SHIFT\t\t34\n#define TEA5777_W_AM_AGCRF_MASK\t\t(1LL << 33)\n#define TEA5777_W_AM_AGCRF_SHIFT\t33\n#define TEA5777_W_AM_AGCIF_MASK\t\t(1LL << 32)\n#define TEA5777_W_AM_AGCIF_SHIFT\t32\n#define TEA5777_W_AM_MWLW_MASK\t\t(1LL << 31)\n#define TEA5777_W_AM_MWLW_SHIFT\t\t31\n#define TEA5777_W_AM_LW\t\t\t0LL\n#define TEA5777_W_AM_MW\t\t\t1LL\n#define TEA5777_W_AM_LNA_MASK\t\t(1LL << 30)\n#define TEA5777_W_AM_LNA_SHIFT\t\t30\n\n#define TEA5777_W_AM_PEAK_MASK\t\t(1LL << 25)\n#define TEA5777_W_AM_PEAK_SHIFT\t\t25\n\n#define TEA5777_W_AM_RFB_MASK\t\t(1LL << 16)\n#define TEA5777_W_AM_RFB_SHIFT\t\t16\n#define TEA5777_W_AM_CALLIGN_MASK\t(1LL << 15)\n#define TEA5777_W_AM_CALLIGN_SHIFT\t15\n#define TEA5777_W_AM_CBANK_MASK\t\t(0x7fLL << 8)\n#define TEA5777_W_AM_CBANK_SHIFT\t8\n\n#define TEA5777_W_AM_DELAY_MASK\t\t(1LL << 2)\n#define TEA5777_W_AM_DELAY_SHIFT\t2\n#define TEA5777_W_AM_STEP_MASK\t\t(1LL << 1)\n#define TEA5777_W_AM_STEP_SHIFT\t\t1\n\n \n#define TEA5777_R_LEVEL_MASK\t\t(0x0f << 17)\n#define TEA5777_R_LEVEL_SHIFT\t\t17\n#define TEA5777_R_SFOUND_MASK\t\t(0x01 << 16)\n#define TEA5777_R_SFOUND_SHIFT\t\t16\n#define TEA5777_R_BLIM_MASK\t\t(0x01 << 15)\n#define TEA5777_R_BLIM_SHIFT\t\t15\n\n \n#define TEA5777_R_FM_STEREO_MASK\t(0x01 << 21)\n#define TEA5777_R_FM_STEREO_SHIFT\t21\n#define TEA5777_R_FM_PLL_MASK\t\t0x1fff\n#define TEA5777_R_FM_PLL_SHIFT\t\t0\n\nenum { BAND_FM, BAND_AM };\n\nstatic const struct v4l2_frequency_band bands[] = {\n\t{\n\t\t.type = V4L2_TUNER_RADIO,\n\t\t.index = 0,\n\t\t.capability = V4L2_TUNER_CAP_LOW | V4L2_TUNER_CAP_STEREO |\n\t\t\t      V4L2_TUNER_CAP_FREQ_BANDS |\n\t\t\t      V4L2_TUNER_CAP_HWSEEK_BOUNDED |\n\t\t\t      V4L2_TUNER_CAP_HWSEEK_PROG_LIM,\n\t\t.rangelow   =  76000 * 16,\n\t\t.rangehigh  = 108000 * 16,\n\t\t.modulation = V4L2_BAND_MODULATION_FM,\n\t},\n\t{\n\t\t.type = V4L2_TUNER_RADIO,\n\t\t.index = 1,\n\t\t.capability = V4L2_TUNER_CAP_LOW | V4L2_TUNER_CAP_FREQ_BANDS |\n\t\t\t      V4L2_TUNER_CAP_HWSEEK_BOUNDED |\n\t\t\t      V4L2_TUNER_CAP_HWSEEK_PROG_LIM,\n\t\t.rangelow   =  530 * 16,\n\t\t.rangehigh  = 1710 * 16,\n\t\t.modulation = V4L2_BAND_MODULATION_AM,\n\t},\n};\n\nstatic u32 tea5777_freq_to_v4l2_freq(struct radio_tea5777 *tea, u32 freq)\n{\n\tswitch (tea->band) {\n\tcase BAND_FM:\n\t\treturn (freq * TEA5777_FM_FREQ_STEP + TEA5777_FM_IF) * 16;\n\tcase BAND_AM:\n\t\treturn (freq * TEA5777_AM_FREQ_STEP + TEA5777_AM_IF) * 16;\n\t}\n\treturn 0;  \n}\n\nint radio_tea5777_set_freq(struct radio_tea5777 *tea)\n{\n\tu32 freq;\n\tint res;\n\n\tfreq = clamp(tea->freq, bands[tea->band].rangelow,\n\t\t\t\tbands[tea->band].rangehigh);\n\tfreq = (freq + 8) / 16;  \n\n\tswitch (tea->band) {\n\tcase BAND_FM:\n\t\ttea->write_reg &= ~TEA5777_W_AM_FM_MASK;\n\t\tfreq = (freq - TEA5777_FM_IF) / TEA5777_FM_FREQ_STEP;\n\t\ttea->write_reg &= ~TEA5777_W_FM_PLL_MASK;\n\t\ttea->write_reg |= (u64)freq << TEA5777_W_FM_PLL_SHIFT;\n\t\ttea->write_reg &= ~TEA5777_W_FM_FREF_MASK;\n\t\ttea->write_reg |= TEA5777_W_FM_FREF_VALUE <<\n\t\t\t\t  TEA5777_W_FM_FREF_SHIFT;\n\t\ttea->write_reg &= ~TEA5777_W_FM_FORCEMONO_MASK;\n\t\tif (tea->audmode == V4L2_TUNER_MODE_MONO)\n\t\t\ttea->write_reg |= 1LL << TEA5777_W_FM_FORCEMONO_SHIFT;\n\t\tbreak;\n\tcase BAND_AM:\n\t\ttea->write_reg &= ~TEA5777_W_AM_FM_MASK;\n\t\ttea->write_reg |= (1LL << TEA5777_W_AM_FM_SHIFT);\n\t\tfreq = (freq - TEA5777_AM_IF) / TEA5777_AM_FREQ_STEP;\n\t\ttea->write_reg &= ~TEA5777_W_AM_PLL_MASK;\n\t\ttea->write_reg |= (u64)freq << TEA5777_W_AM_PLL_SHIFT;\n\t\ttea->write_reg &= ~TEA5777_W_AM_AGCRF_MASK;\n\t\ttea->write_reg &= ~TEA5777_W_AM_AGCRF_MASK;\n\t\ttea->write_reg &= ~TEA5777_W_AM_MWLW_MASK;\n\t\ttea->write_reg |= TEA5777_W_AM_MW << TEA5777_W_AM_MWLW_SHIFT;\n\t\ttea->write_reg &= ~TEA5777_W_AM_LNA_MASK;\n\t\ttea->write_reg |= 1LL << TEA5777_W_AM_LNA_SHIFT;\n\t\ttea->write_reg &= ~TEA5777_W_AM_PEAK_MASK;\n\t\ttea->write_reg |= 1LL << TEA5777_W_AM_PEAK_SHIFT;\n\t\ttea->write_reg &= ~TEA5777_W_AM_CALLIGN_MASK;\n\t\tbreak;\n\t}\n\n\tres = tea->ops->write_reg(tea, tea->write_reg);\n\tif (res)\n\t\treturn res;\n\n\ttea->needs_write = false;\n\ttea->read_reg = -1;\n\ttea->freq = tea5777_freq_to_v4l2_freq(tea, freq);\n\n\treturn 0;\n}\n\nstatic int radio_tea5777_update_read_reg(struct radio_tea5777 *tea, int wait)\n{\n\tint res;\n\n\tif (tea->read_reg != -1)\n\t\treturn 0;\n\n\tif (tea->write_before_read && tea->needs_write) {\n\t\tres = radio_tea5777_set_freq(tea);\n\t\tif (res)\n\t\t\treturn res;\n\t}\n\n\tif (wait) {\n\t\tif (schedule_timeout_interruptible(msecs_to_jiffies(wait)))\n\t\t\treturn -ERESTARTSYS;\n\t}\n\n\tres = tea->ops->read_reg(tea, &tea->read_reg);\n\tif (res)\n\t\treturn res;\n\n\ttea->needs_write = true;\n\treturn 0;\n}\n\n \n\nstatic int vidioc_querycap(struct file *file, void  *priv,\n\t\t\t\t\tstruct v4l2_capability *v)\n{\n\tstruct radio_tea5777 *tea = video_drvdata(file);\n\n\tstrscpy(v->driver, tea->v4l2_dev->name, sizeof(v->driver));\n\tstrscpy(v->card, tea->card, sizeof(v->card));\n\tstrlcat(v->card, \" TEA5777\", sizeof(v->card));\n\tstrscpy(v->bus_info, tea->bus_info, sizeof(v->bus_info));\n\treturn 0;\n}\n\nstatic int vidioc_enum_freq_bands(struct file *file, void *priv,\n\t\t\t\t\t struct v4l2_frequency_band *band)\n{\n\tstruct radio_tea5777 *tea = video_drvdata(file);\n\n\tif (band->tuner != 0 || band->index >= ARRAY_SIZE(bands) ||\n\t    (!tea->has_am && band->index == BAND_AM))\n\t\treturn -EINVAL;\n\n\t*band = bands[band->index];\n\treturn 0;\n}\n\nstatic int vidioc_g_tuner(struct file *file, void *priv,\n\t\t\t\t\tstruct v4l2_tuner *v)\n{\n\tstruct radio_tea5777 *tea = video_drvdata(file);\n\tint res;\n\n\tif (v->index > 0)\n\t\treturn -EINVAL;\n\n\tres = radio_tea5777_update_read_reg(tea, 0);\n\tif (res)\n\t\treturn res;\n\n\tmemset(v, 0, sizeof(*v));\n\tif (tea->has_am)\n\t\tstrscpy(v->name, \"AM/FM\", sizeof(v->name));\n\telse\n\t\tstrscpy(v->name, \"FM\", sizeof(v->name));\n\tv->type = V4L2_TUNER_RADIO;\n\tv->capability = V4L2_TUNER_CAP_LOW | V4L2_TUNER_CAP_STEREO |\n\t\t\tV4L2_TUNER_CAP_FREQ_BANDS |\n\t\t\tV4L2_TUNER_CAP_HWSEEK_BOUNDED |\n\t\t\tV4L2_TUNER_CAP_HWSEEK_PROG_LIM;\n\tv->rangelow   = tea->has_am ? bands[BAND_AM].rangelow :\n\t\t\t\t      bands[BAND_FM].rangelow;\n\tv->rangehigh  = bands[BAND_FM].rangehigh;\n\tif (tea->band == BAND_FM &&\n\t\t\t(tea->read_reg & TEA5777_R_FM_STEREO_MASK))\n\t\tv->rxsubchans = V4L2_TUNER_SUB_STEREO;\n\telse\n\t\tv->rxsubchans = V4L2_TUNER_SUB_MONO;\n\tv->audmode = tea->audmode;\n\t \n\tv->signal = (tea->read_reg & TEA5777_R_LEVEL_MASK) >>\n\t\t    (TEA5777_R_LEVEL_SHIFT - 12);\n\n\t \n\ttea->read_reg = -1;\n\n\treturn 0;\n}\n\nstatic int vidioc_s_tuner(struct file *file, void *priv,\n\t\t\t\t\tconst struct v4l2_tuner *v)\n{\n\tstruct radio_tea5777 *tea = video_drvdata(file);\n\tu32 orig_audmode = tea->audmode;\n\n\tif (v->index)\n\t\treturn -EINVAL;\n\n\ttea->audmode = v->audmode;\n\tif (tea->audmode > V4L2_TUNER_MODE_STEREO)\n\t\ttea->audmode = V4L2_TUNER_MODE_STEREO;\n\n\tif (tea->audmode != orig_audmode && tea->band == BAND_FM)\n\t\treturn radio_tea5777_set_freq(tea);\n\n\treturn 0;\n}\n\nstatic int vidioc_g_frequency(struct file *file, void *priv,\n\t\t\t\t\tstruct v4l2_frequency *f)\n{\n\tstruct radio_tea5777 *tea = video_drvdata(file);\n\n\tif (f->tuner != 0)\n\t\treturn -EINVAL;\n\tf->type = V4L2_TUNER_RADIO;\n\tf->frequency = tea->freq;\n\treturn 0;\n}\n\nstatic int vidioc_s_frequency(struct file *file, void *priv,\n\t\t\t\t\tconst struct v4l2_frequency *f)\n{\n\tstruct radio_tea5777 *tea = video_drvdata(file);\n\n\tif (f->tuner != 0 || f->type != V4L2_TUNER_RADIO)\n\t\treturn -EINVAL;\n\n\tif (tea->has_am && f->frequency < (20000 * 16))\n\t\ttea->band = BAND_AM;\n\telse\n\t\ttea->band = BAND_FM;\n\n\ttea->freq = f->frequency;\n\treturn radio_tea5777_set_freq(tea);\n}\n\nstatic int vidioc_s_hw_freq_seek(struct file *file, void *fh,\n\t\t\t\t\tconst struct v4l2_hw_freq_seek *a)\n{\n\tstruct radio_tea5777 *tea = video_drvdata(file);\n\tunsigned long timeout;\n\tu32 rangelow = a->rangelow;\n\tu32 rangehigh = a->rangehigh;\n\tint i, res, spacing;\n\tu32 orig_freq;\n\n\tif (a->tuner || a->wrap_around)\n\t\treturn -EINVAL;\n\n\tif (file->f_flags & O_NONBLOCK)\n\t\treturn -EWOULDBLOCK;\n\n\tif (rangelow || rangehigh) {\n\t\tfor (i = 0; i < ARRAY_SIZE(bands); i++) {\n\t\t\tif (i == BAND_AM && !tea->has_am)\n\t\t\t\tcontinue;\n\t\t\tif (bands[i].rangelow  >= rangelow &&\n\t\t\t    bands[i].rangehigh <= rangehigh)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (i == ARRAY_SIZE(bands))\n\t\t\treturn -EINVAL;  \n\n\t\ttea->band = i;\n\t\tif (tea->freq < rangelow || tea->freq > rangehigh) {\n\t\t\ttea->freq = clamp(tea->freq, rangelow,\n\t\t\t\t\t\t     rangehigh);\n\t\t\tres = radio_tea5777_set_freq(tea);\n\t\t\tif (res)\n\t\t\t\treturn res;\n\t\t}\n\t} else {\n\t\trangelow  = bands[tea->band].rangelow;\n\t\trangehigh = bands[tea->band].rangehigh;\n\t}\n\n\tspacing   = (tea->band == BAND_AM) ? (5 * 16) : (200 * 16);  \n\torig_freq = tea->freq;\n\n\ttea->write_reg |= TEA5777_W_PROGBLIM_MASK;\n\tif (tea->seek_rangelow != rangelow) {\n\t\ttea->write_reg &= ~TEA5777_W_UPDWN_MASK;\n\t\ttea->freq = rangelow;\n\t\tres = radio_tea5777_set_freq(tea);\n\t\tif (res)\n\t\t\tgoto leave;\n\t\ttea->seek_rangelow = rangelow;\n\t}\n\tif (tea->seek_rangehigh != rangehigh) {\n\t\ttea->write_reg |= TEA5777_W_UPDWN_MASK;\n\t\ttea->freq = rangehigh;\n\t\tres = radio_tea5777_set_freq(tea);\n\t\tif (res)\n\t\t\tgoto leave;\n\t\ttea->seek_rangehigh = rangehigh;\n\t}\n\ttea->write_reg &= ~TEA5777_W_PROGBLIM_MASK;\n\n\ttea->write_reg |= TEA5777_W_SEARCH_MASK;\n\tif (a->seek_upward) {\n\t\ttea->write_reg |= TEA5777_W_UPDWN_MASK;\n\t\ttea->freq = orig_freq + spacing;\n\t} else {\n\t\ttea->write_reg &= ~TEA5777_W_UPDWN_MASK;\n\t\ttea->freq = orig_freq - spacing;\n\t}\n\tres = radio_tea5777_set_freq(tea);\n\tif (res)\n\t\tgoto leave;\n\n\ttimeout = jiffies + msecs_to_jiffies(5000);\n\tfor (;;) {\n\t\tif (time_after(jiffies, timeout)) {\n\t\t\tres = -ENODATA;\n\t\t\tbreak;\n\t\t}\n\n\t\tres = radio_tea5777_update_read_reg(tea, 100);\n\t\tif (res)\n\t\t\tbreak;\n\n\t\t \n\t\ttea->freq = (tea->read_reg & TEA5777_R_FM_PLL_MASK);\n\t\ttea->freq = tea5777_freq_to_v4l2_freq(tea, tea->freq);\n\n\t\tif ((tea->read_reg & TEA5777_R_SFOUND_MASK)) {\n\t\t\ttea->write_reg &= ~TEA5777_W_SEARCH_MASK;\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (tea->read_reg & TEA5777_R_BLIM_MASK) {\n\t\t\tres = -ENODATA;\n\t\t\tbreak;\n\t\t}\n\n\t\t \n\t\ttea->read_reg = -1;\n\t}\nleave:\n\ttea->write_reg &= ~TEA5777_W_PROGBLIM_MASK;\n\ttea->write_reg &= ~TEA5777_W_SEARCH_MASK;\n\ttea->freq = orig_freq;\n\tradio_tea5777_set_freq(tea);\n\treturn res;\n}\n\nstatic int tea575x_s_ctrl(struct v4l2_ctrl *c)\n{\n\tstruct radio_tea5777 *tea =\n\t\tcontainer_of(c->handler, struct radio_tea5777, ctrl_handler);\n\n\tswitch (c->id) {\n\tcase V4L2_CID_AUDIO_MUTE:\n\t\tif (c->val)\n\t\t\ttea->write_reg |= TEA5777_W_MUTE_MASK;\n\t\telse\n\t\t\ttea->write_reg &= ~TEA5777_W_MUTE_MASK;\n\n\t\treturn radio_tea5777_set_freq(tea);\n\t}\n\n\treturn -EINVAL;\n}\n\nstatic const struct v4l2_file_operations tea575x_fops = {\n\t.unlocked_ioctl\t= video_ioctl2,\n\t.open\t\t= v4l2_fh_open,\n\t.release\t= v4l2_fh_release,\n\t.poll\t\t= v4l2_ctrl_poll,\n};\n\nstatic const struct v4l2_ioctl_ops tea575x_ioctl_ops = {\n\t.vidioc_querycap    = vidioc_querycap,\n\t.vidioc_g_tuner     = vidioc_g_tuner,\n\t.vidioc_s_tuner     = vidioc_s_tuner,\n\t.vidioc_g_frequency = vidioc_g_frequency,\n\t.vidioc_s_frequency = vidioc_s_frequency,\n\t.vidioc_s_hw_freq_seek = vidioc_s_hw_freq_seek,\n\t.vidioc_enum_freq_bands = vidioc_enum_freq_bands,\n\t.vidioc_log_status  = v4l2_ctrl_log_status,\n\t.vidioc_subscribe_event = v4l2_ctrl_subscribe_event,\n\t.vidioc_unsubscribe_event = v4l2_event_unsubscribe,\n};\n\nstatic const struct video_device tea575x_radio = {\n\t.ioctl_ops\t= &tea575x_ioctl_ops,\n\t.release\t= video_device_release_empty,\n};\n\nstatic const struct v4l2_ctrl_ops tea575x_ctrl_ops = {\n\t.s_ctrl = tea575x_s_ctrl,\n};\n\nint radio_tea5777_init(struct radio_tea5777 *tea, struct module *owner)\n{\n\tint res;\n\n\ttea->write_reg = (1LL << TEA5777_W_IFCE_SHIFT) |\n\t\t\t (1LL << TEA5777_W_IFW_SHIFT) |\n\t\t\t (1LL << TEA5777_W_INTEXT_SHIFT) |\n\t\t\t (1LL << TEA5777_W_CHP0_SHIFT) |\n\t\t\t (1LL << TEA5777_W_SLEV_SHIFT);\n\ttea->freq = 90500 * 16;\t \n\ttea->audmode = V4L2_TUNER_MODE_STEREO;\n\tres = radio_tea5777_set_freq(tea);\n\tif (res) {\n\t\tv4l2_err(tea->v4l2_dev, \"can't set initial freq (%d)\\n\", res);\n\t\treturn res;\n\t}\n\n\ttea->vd = tea575x_radio;\n\tvideo_set_drvdata(&tea->vd, tea);\n\tmutex_init(&tea->mutex);\n\tstrscpy(tea->vd.name, tea->v4l2_dev->name, sizeof(tea->vd.name));\n\ttea->vd.lock = &tea->mutex;\n\ttea->vd.v4l2_dev = tea->v4l2_dev;\n\ttea->vd.device_caps = V4L2_CAP_TUNER | V4L2_CAP_RADIO |\n\t\t\t      V4L2_CAP_HW_FREQ_SEEK;\n\ttea->fops = tea575x_fops;\n\ttea->fops.owner = owner;\n\ttea->vd.fops = &tea->fops;\n\n\ttea->vd.ctrl_handler = &tea->ctrl_handler;\n\tv4l2_ctrl_handler_init(&tea->ctrl_handler, 1);\n\tv4l2_ctrl_new_std(&tea->ctrl_handler, &tea575x_ctrl_ops,\n\t\t\t  V4L2_CID_AUDIO_MUTE, 0, 1, 1, 1);\n\tres = tea->ctrl_handler.error;\n\tif (res) {\n\t\tv4l2_err(tea->v4l2_dev, \"can't initialize controls\\n\");\n\t\tv4l2_ctrl_handler_free(&tea->ctrl_handler);\n\t\treturn res;\n\t}\n\tv4l2_ctrl_handler_setup(&tea->ctrl_handler);\n\n\tres = video_register_device(&tea->vd, VFL_TYPE_RADIO, -1);\n\tif (res) {\n\t\tv4l2_err(tea->v4l2_dev, \"can't register video device!\\n\");\n\t\tv4l2_ctrl_handler_free(tea->vd.ctrl_handler);\n\t\treturn res;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(radio_tea5777_init);\n\nvoid radio_tea5777_exit(struct radio_tea5777 *tea)\n{\n\tvideo_unregister_device(&tea->vd);\n\tv4l2_ctrl_handler_free(tea->vd.ctrl_handler);\n}\nEXPORT_SYMBOL_GPL(radio_tea5777_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}