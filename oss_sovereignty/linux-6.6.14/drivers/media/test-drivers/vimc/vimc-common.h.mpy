{
  "module_name": "vimc-common.h",
  "hash_id": "9368d319a8e4d692b26cce7afafc2bf3e8fa111227560031c75bc6ec730121d6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/test-drivers/vimc/vimc-common.h",
  "human_readable_source": " \n \n\n#ifndef _VIMC_COMMON_H_\n#define _VIMC_COMMON_H_\n\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <media/media-device.h>\n#include <media/v4l2-device.h>\n\n#define VIMC_PDEV_NAME \"vimc\"\n\n \n#define VIMC_CID_VIMC_BASE\t\t(0x00f00000 | 0xf000)\n#define VIMC_CID_VIMC_CLASS\t\t(0x00f00000 | 1)\n#define VIMC_CID_TEST_PATTERN\t\t(VIMC_CID_VIMC_BASE + 0)\n#define VIMC_CID_MEAN_WIN_SIZE\t\t(VIMC_CID_VIMC_BASE + 1)\n#define VIMC_CID_OSD_TEXT_MODE\t\t(VIMC_CID_VIMC_BASE + 2)\n\n#define VIMC_FRAME_MAX_WIDTH 4096\n#define VIMC_FRAME_MAX_HEIGHT 2160\n#define VIMC_FRAME_MIN_WIDTH 16\n#define VIMC_FRAME_MIN_HEIGHT 16\n\n#define VIMC_FRAME_INDEX(lin, col, width, bpp) ((lin * width + col) * bpp)\n\n \n#define VIMC_IS_SRC(pad)\t(pad)\n#define VIMC_IS_SINK(pad)\t(!(pad))\n\n#define VIMC_PIX_FMT_MAX_CODES 8\n\nextern unsigned int vimc_allocator;\n\nenum vimc_allocator_type {\n\tVIMC_ALLOCATOR_VMALLOC = 0,\n\tVIMC_ALLOCATOR_DMA_CONTIG = 1,\n};\n\n \n#define vimc_colorimetry_clamp(fmt)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif ((fmt)->colorspace == V4L2_COLORSPACE_DEFAULT\t\t\\\n\t    || (fmt)->colorspace > V4L2_COLORSPACE_DCI_P3) {\t\t\\\n\t\t(fmt)->colorspace = V4L2_COLORSPACE_DEFAULT;\t\t\\\n\t\t(fmt)->ycbcr_enc = V4L2_YCBCR_ENC_DEFAULT;\t\t\\\n\t\t(fmt)->quantization = V4L2_QUANTIZATION_DEFAULT;\t\\\n\t\t(fmt)->xfer_func = V4L2_XFER_FUNC_DEFAULT;\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tif ((fmt)->ycbcr_enc > V4L2_YCBCR_ENC_SMPTE240M)\t\t\\\n\t\t(fmt)->ycbcr_enc = V4L2_YCBCR_ENC_DEFAULT;\t\t\\\n\tif ((fmt)->quantization > V4L2_QUANTIZATION_LIM_RANGE)\t\t\\\n\t\t(fmt)->quantization = V4L2_QUANTIZATION_DEFAULT;\t\\\n\tif ((fmt)->xfer_func > V4L2_XFER_FUNC_SMPTE2084)\t\t\\\n\t\t(fmt)->xfer_func = V4L2_XFER_FUNC_DEFAULT;\t\t\\\n} while (0)\n\n \nstruct vimc_pix_map {\n\tunsigned int code[VIMC_PIX_FMT_MAX_CODES];\n\tunsigned int bpp;\n\tu32 pixelformat;\n\tbool bayer;\n};\n\n \nstruct vimc_ent_device {\n\tstruct device *dev;\n\tstruct media_entity *ent;\n\tvoid * (*process_frame)(struct vimc_ent_device *ved,\n\t\t\t\tconst void *frame);\n\tvoid (*vdev_get_format)(struct vimc_ent_device *ved,\n\t\t\t      struct v4l2_pix_format *fmt);\n};\n\n \nstruct vimc_device {\n\tconst struct vimc_pipeline_config *pipe_cfg;\n\tstruct vimc_ent_device **ent_devs;\n\tstruct media_device mdev;\n\tstruct v4l2_device v4l2_dev;\n};\n\n \nstruct vimc_ent_type {\n\tstruct vimc_ent_device *(*add)(struct vimc_device *vimc,\n\t\t\t\t       const char *vcfg_name);\n\tvoid (*unregister)(struct vimc_ent_device *ved);\n\tvoid (*release)(struct vimc_ent_device *ved);\n};\n\n \nstruct vimc_ent_config {\n\tconst char *name;\n\tstruct vimc_ent_type *type;\n};\n\n \nbool vimc_is_source(struct media_entity *ent);\n\nextern struct vimc_ent_type vimc_sensor_type;\nextern struct vimc_ent_type vimc_debayer_type;\nextern struct vimc_ent_type vimc_scaler_type;\nextern struct vimc_ent_type vimc_capture_type;\nextern struct vimc_ent_type vimc_lens_type;\n\n \nconst struct vimc_pix_map *vimc_pix_map_by_index(unsigned int i);\n\n \nu32 vimc_mbus_code_by_index(unsigned int index);\n\n \nconst struct vimc_pix_map *vimc_pix_map_by_code(u32 code);\n\n \nconst struct vimc_pix_map *vimc_pix_map_by_pixelformat(u32 pixelformat);\n\n \nint vimc_ent_sd_register(struct vimc_ent_device *ved,\n\t\t\t struct v4l2_subdev *sd,\n\t\t\t struct v4l2_device *v4l2_dev,\n\t\t\t const char *const name,\n\t\t\t u32 function,\n\t\t\t u16 num_pads,\n\t\t\t struct media_pad *pads,\n\t\t\t const struct v4l2_subdev_ops *sd_ops);\n\n \nint vimc_vdev_link_validate(struct media_link *link);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}