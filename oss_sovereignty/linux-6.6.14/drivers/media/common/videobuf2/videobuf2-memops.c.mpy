{
  "module_name": "videobuf2-memops.c",
  "hash_id": "2850d7ef62b2e94e17f39ab2e84d0011367a5da0bbddd5b08e5cb58365b3f75e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/common/videobuf2/videobuf2-memops.c",
  "human_readable_source": " \n\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/dma-mapping.h>\n#include <linux/vmalloc.h>\n#include <linux/mm.h>\n#include <linux/sched.h>\n#include <linux/file.h>\n\n#include <media/videobuf2-v4l2.h>\n#include <media/videobuf2-memops.h>\n\n \nstruct frame_vector *vb2_create_framevec(unsigned long start,\n\t\t\t\t\t unsigned long length,\n\t\t\t\t\t bool write)\n{\n\tint ret;\n\tunsigned long first, last;\n\tunsigned long nr;\n\tstruct frame_vector *vec;\n\n\tfirst = start >> PAGE_SHIFT;\n\tlast = (start + length - 1) >> PAGE_SHIFT;\n\tnr = last - first + 1;\n\tvec = frame_vector_create(nr);\n\tif (!vec)\n\t\treturn ERR_PTR(-ENOMEM);\n\tret = get_vaddr_frames(start & PAGE_MASK, nr, write, vec);\n\tif (ret < 0)\n\t\tgoto out_destroy;\n\t \n\tif (ret != nr) {\n\t\tret = -EFAULT;\n\t\tgoto out_release;\n\t}\n\treturn vec;\nout_release:\n\tput_vaddr_frames(vec);\nout_destroy:\n\tframe_vector_destroy(vec);\n\treturn ERR_PTR(ret);\n}\nEXPORT_SYMBOL(vb2_create_framevec);\n\n \nvoid vb2_destroy_framevec(struct frame_vector *vec)\n{\n\tput_vaddr_frames(vec);\n\tframe_vector_destroy(vec);\n}\nEXPORT_SYMBOL(vb2_destroy_framevec);\n\n \nstatic void vb2_common_vm_open(struct vm_area_struct *vma)\n{\n\tstruct vb2_vmarea_handler *h = vma->vm_private_data;\n\n\tpr_debug(\"%s: %p, refcount: %d, vma: %08lx-%08lx\\n\",\n\t       __func__, h, refcount_read(h->refcount), vma->vm_start,\n\t       vma->vm_end);\n\n\trefcount_inc(h->refcount);\n}\n\n \nstatic void vb2_common_vm_close(struct vm_area_struct *vma)\n{\n\tstruct vb2_vmarea_handler *h = vma->vm_private_data;\n\n\tpr_debug(\"%s: %p, refcount: %d, vma: %08lx-%08lx\\n\",\n\t       __func__, h, refcount_read(h->refcount), vma->vm_start,\n\t       vma->vm_end);\n\n\th->put(h->arg);\n}\n\n \nconst struct vm_operations_struct vb2_common_vm_ops = {\n\t.open = vb2_common_vm_open,\n\t.close = vb2_common_vm_close,\n};\nEXPORT_SYMBOL_GPL(vb2_common_vm_ops);\n\nMODULE_DESCRIPTION(\"common memory handling routines for videobuf2\");\nMODULE_AUTHOR(\"Pawel Osciak <pawel@osciak.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}