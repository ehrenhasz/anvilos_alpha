{
  "module_name": "smsir.c",
  "hash_id": "003d37024f5b935126c18f95bb34f6c74e302d6eb89c9700e309d5d6d812e013",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/common/siano/smsir.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n\n\n#include \"smscoreapi.h\"\n\n#include <linux/types.h>\n#include <linux/input.h>\n\n#include \"smsir.h\"\n#include \"sms-cards.h\"\n\n#define MODULE_NAME \"smsmdtv\"\n\nvoid sms_ir_event(struct smscore_device_t *coredev, const char *buf, int len)\n{\n\tint i;\n\tconst s32 *samples = (const void *)buf;\n\n\tfor (i = 0; i < len >> 2; i++) {\n\t\tstruct ir_raw_event ev = {\n\t\t\t.duration = abs(samples[i]),\n\t\t\t.pulse = (samples[i] > 0) ? false : true\n\t\t};\n\n\t\tir_raw_event_store(coredev->ir.dev, &ev);\n\t}\n\tir_raw_event_handle(coredev->ir.dev);\n}\n\nint sms_ir_init(struct smscore_device_t *coredev)\n{\n\tint err;\n\tint board_id = smscore_get_board_id(coredev);\n\tstruct rc_dev *dev;\n\n\tpr_debug(\"Allocating rc device\\n\");\n\tdev = rc_allocate_device(RC_DRIVER_IR_RAW);\n\tif (!dev)\n\t\treturn -ENOMEM;\n\n\tcoredev->ir.controller = 0;\t \n\tcoredev->ir.timeout = US_TO_NS(IR_DEFAULT_TIMEOUT);\n\tpr_debug(\"IR port %d, timeout %d ms\\n\",\n\t\t\tcoredev->ir.controller, coredev->ir.timeout);\n\n\tsnprintf(coredev->ir.name, sizeof(coredev->ir.name),\n\t\t \"SMS IR (%s)\", sms_get_board(board_id)->name);\n\n\tstrscpy(coredev->ir.phys, coredev->devpath, sizeof(coredev->ir.phys));\n\tstrlcat(coredev->ir.phys, \"/ir0\", sizeof(coredev->ir.phys));\n\n\tdev->device_name = coredev->ir.name;\n\tdev->input_phys = coredev->ir.phys;\n\tdev->dev.parent = coredev->device;\n\n#if 0\n\t \n\tdev->input_id.bustype = BUS_USB;\n\tdev->input_id.version = 1;\n\tdev->input_id.vendor = le16_to_cpu(dev->udev->descriptor.idVendor);\n\tdev->input_id.product = le16_to_cpu(dev->udev->descriptor.idProduct);\n#endif\n\n\tdev->priv = coredev;\n\tdev->allowed_protocols = RC_PROTO_BIT_ALL_IR_DECODER;\n\tdev->map_name = sms_get_board(board_id)->rc_codes;\n\tdev->driver_name = MODULE_NAME;\n\n\tpr_debug(\"Input device (IR) %s is set for key events\\n\",\n\t\t dev->device_name);\n\n\terr = rc_register_device(dev);\n\tif (err < 0) {\n\t\tpr_err(\"Failed to register device\\n\");\n\t\trc_free_device(dev);\n\t\treturn err;\n\t}\n\n\tcoredev->ir.dev = dev;\n\treturn 0;\n}\n\nvoid sms_ir_exit(struct smscore_device_t *coredev)\n{\n\trc_unregister_device(coredev->ir.dev);\n\n\tpr_debug(\"\\n\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}