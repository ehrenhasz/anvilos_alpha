{
  "module_name": "smscoreapi.c",
  "hash_id": "2f42b58fb313b7edeceb2f4c87c5d1ece813154950e9188554375f6881348756",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/common/siano/smscoreapi.c",
  "human_readable_source": "\n \n\n#include \"smscoreapi.h\"\n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/dma-mapping.h>\n#include <linux/delay.h>\n#include <linux/io.h>\n#include <linux/slab.h>\n\n#include <linux/firmware.h>\n#include <linux/wait.h>\n#include <asm/byteorder.h>\n\n#include \"sms-cards.h\"\n#include \"smsir.h\"\n\nstruct smscore_device_notifyee_t {\n\tstruct list_head entry;\n\thotplug_t hotplug;\n};\n\nstruct smscore_idlist_t {\n\tstruct list_head entry;\n\tint\t\tid;\n\tint\t\tdata_type;\n};\n\nstruct smscore_client_t {\n\tstruct list_head entry;\n\tstruct smscore_device_t *coredev;\n\tvoid\t\t\t*context;\n\tstruct list_head\tidlist;\n\tonresponse_t\t\tonresponse_handler;\n\tonremove_t\t\tonremove_handler;\n};\n\nstatic char *siano_msgs[] = {\n\t[MSG_TYPE_BASE_VAL                           - MSG_TYPE_BASE_VAL] = \"MSG_TYPE_BASE_VAL\",\n\t[MSG_SMS_GET_VERSION_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_VERSION_REQ\",\n\t[MSG_SMS_GET_VERSION_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_VERSION_RES\",\n\t[MSG_SMS_MULTI_BRIDGE_CFG                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MULTI_BRIDGE_CFG\",\n\t[MSG_SMS_GPIO_CONFIG_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_CONFIG_REQ\",\n\t[MSG_SMS_GPIO_CONFIG_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_CONFIG_RES\",\n\t[MSG_SMS_GPIO_SET_LEVEL_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_SET_LEVEL_REQ\",\n\t[MSG_SMS_GPIO_SET_LEVEL_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_SET_LEVEL_RES\",\n\t[MSG_SMS_GPIO_GET_LEVEL_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_GET_LEVEL_REQ\",\n\t[MSG_SMS_GPIO_GET_LEVEL_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_GET_LEVEL_RES\",\n\t[MSG_SMS_EEPROM_BURN_IND                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EEPROM_BURN_IND\",\n\t[MSG_SMS_LOG_ENABLE_CHANGE_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LOG_ENABLE_CHANGE_REQ\",\n\t[MSG_SMS_LOG_ENABLE_CHANGE_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LOG_ENABLE_CHANGE_RES\",\n\t[MSG_SMS_SET_MAX_TX_MSG_LEN_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_MAX_TX_MSG_LEN_REQ\",\n\t[MSG_SMS_SET_MAX_TX_MSG_LEN_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_MAX_TX_MSG_LEN_RES\",\n\t[MSG_SMS_SPI_HALFDUPLEX_TOKEN_HOST_TO_DEVICE - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SPI_HALFDUPLEX_TOKEN_HOST_TO_DEVICE\",\n\t[MSG_SMS_SPI_HALFDUPLEX_TOKEN_DEVICE_TO_HOST - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SPI_HALFDUPLEX_TOKEN_DEVICE_TO_HOST\",\n\t[MSG_SMS_BACKGROUND_SCAN_FLAG_CHANGE_REQ     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_BACKGROUND_SCAN_FLAG_CHANGE_REQ\",\n\t[MSG_SMS_BACKGROUND_SCAN_FLAG_CHANGE_RES     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_BACKGROUND_SCAN_FLAG_CHANGE_RES\",\n\t[MSG_SMS_BACKGROUND_SCAN_SIGNAL_DETECTED_IND - MSG_TYPE_BASE_VAL] = \"MSG_SMS_BACKGROUND_SCAN_SIGNAL_DETECTED_IND\",\n\t[MSG_SMS_BACKGROUND_SCAN_NO_SIGNAL_IND       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_BACKGROUND_SCAN_NO_SIGNAL_IND\",\n\t[MSG_SMS_CONFIGURE_RF_SWITCH_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CONFIGURE_RF_SWITCH_REQ\",\n\t[MSG_SMS_CONFIGURE_RF_SWITCH_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CONFIGURE_RF_SWITCH_RES\",\n\t[MSG_SMS_MRC_PATH_DISCONNECT_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MRC_PATH_DISCONNECT_REQ\",\n\t[MSG_SMS_MRC_PATH_DISCONNECT_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MRC_PATH_DISCONNECT_RES\",\n\t[MSG_SMS_RECEIVE_1SEG_THROUGH_FULLSEG_REQ    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RECEIVE_1SEG_THROUGH_FULLSEG_REQ\",\n\t[MSG_SMS_RECEIVE_1SEG_THROUGH_FULLSEG_RES    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RECEIVE_1SEG_THROUGH_FULLSEG_RES\",\n\t[MSG_SMS_RECEIVE_VHF_VIA_VHF_INPUT_REQ       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RECEIVE_VHF_VIA_VHF_INPUT_REQ\",\n\t[MSG_SMS_RECEIVE_VHF_VIA_VHF_INPUT_RES       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RECEIVE_VHF_VIA_VHF_INPUT_RES\",\n\t[MSG_WR_REG_RFT_REQ                          - MSG_TYPE_BASE_VAL] = \"MSG_WR_REG_RFT_REQ\",\n\t[MSG_WR_REG_RFT_RES                          - MSG_TYPE_BASE_VAL] = \"MSG_WR_REG_RFT_RES\",\n\t[MSG_RD_REG_RFT_REQ                          - MSG_TYPE_BASE_VAL] = \"MSG_RD_REG_RFT_REQ\",\n\t[MSG_RD_REG_RFT_RES                          - MSG_TYPE_BASE_VAL] = \"MSG_RD_REG_RFT_RES\",\n\t[MSG_RD_REG_ALL_RFT_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_RD_REG_ALL_RFT_REQ\",\n\t[MSG_RD_REG_ALL_RFT_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_RD_REG_ALL_RFT_RES\",\n\t[MSG_HELP_INT                                - MSG_TYPE_BASE_VAL] = \"MSG_HELP_INT\",\n\t[MSG_RUN_SCRIPT_INT                          - MSG_TYPE_BASE_VAL] = \"MSG_RUN_SCRIPT_INT\",\n\t[MSG_SMS_EWS_INBAND_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EWS_INBAND_REQ\",\n\t[MSG_SMS_EWS_INBAND_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EWS_INBAND_RES\",\n\t[MSG_SMS_RFS_SELECT_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RFS_SELECT_REQ\",\n\t[MSG_SMS_RFS_SELECT_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RFS_SELECT_RES\",\n\t[MSG_SMS_MB_GET_VER_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_GET_VER_REQ\",\n\t[MSG_SMS_MB_GET_VER_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_GET_VER_RES\",\n\t[MSG_SMS_MB_WRITE_CFGFILE_REQ                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_WRITE_CFGFILE_REQ\",\n\t[MSG_SMS_MB_WRITE_CFGFILE_RES                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_WRITE_CFGFILE_RES\",\n\t[MSG_SMS_MB_READ_CFGFILE_REQ                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_READ_CFGFILE_REQ\",\n\t[MSG_SMS_MB_READ_CFGFILE_RES                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_READ_CFGFILE_RES\",\n\t[MSG_SMS_RD_MEM_REQ                          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RD_MEM_REQ\",\n\t[MSG_SMS_RD_MEM_RES                          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RD_MEM_RES\",\n\t[MSG_SMS_WR_MEM_REQ                          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_WR_MEM_REQ\",\n\t[MSG_SMS_WR_MEM_RES                          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_WR_MEM_RES\",\n\t[MSG_SMS_UPDATE_MEM_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_UPDATE_MEM_REQ\",\n\t[MSG_SMS_UPDATE_MEM_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_UPDATE_MEM_RES\",\n\t[MSG_SMS_ISDBT_ENABLE_FULL_PARAMS_SET_REQ    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_ENABLE_FULL_PARAMS_SET_REQ\",\n\t[MSG_SMS_ISDBT_ENABLE_FULL_PARAMS_SET_RES    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_ENABLE_FULL_PARAMS_SET_RES\",\n\t[MSG_SMS_RF_TUNE_REQ                         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RF_TUNE_REQ\",\n\t[MSG_SMS_RF_TUNE_RES                         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RF_TUNE_RES\",\n\t[MSG_SMS_ISDBT_ENABLE_HIGH_MOBILITY_REQ      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_ENABLE_HIGH_MOBILITY_REQ\",\n\t[MSG_SMS_ISDBT_ENABLE_HIGH_MOBILITY_RES      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_ENABLE_HIGH_MOBILITY_RES\",\n\t[MSG_SMS_ISDBT_SB_RECEPTION_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_SB_RECEPTION_REQ\",\n\t[MSG_SMS_ISDBT_SB_RECEPTION_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_SB_RECEPTION_RES\",\n\t[MSG_SMS_GENERIC_EPROM_WRITE_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GENERIC_EPROM_WRITE_REQ\",\n\t[MSG_SMS_GENERIC_EPROM_WRITE_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GENERIC_EPROM_WRITE_RES\",\n\t[MSG_SMS_GENERIC_EPROM_READ_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GENERIC_EPROM_READ_REQ\",\n\t[MSG_SMS_GENERIC_EPROM_READ_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GENERIC_EPROM_READ_RES\",\n\t[MSG_SMS_EEPROM_WRITE_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EEPROM_WRITE_REQ\",\n\t[MSG_SMS_EEPROM_WRITE_RES                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EEPROM_WRITE_RES\",\n\t[MSG_SMS_CUSTOM_READ_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CUSTOM_READ_REQ\",\n\t[MSG_SMS_CUSTOM_READ_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CUSTOM_READ_RES\",\n\t[MSG_SMS_CUSTOM_WRITE_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CUSTOM_WRITE_REQ\",\n\t[MSG_SMS_CUSTOM_WRITE_RES                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CUSTOM_WRITE_RES\",\n\t[MSG_SMS_INIT_DEVICE_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_INIT_DEVICE_REQ\",\n\t[MSG_SMS_INIT_DEVICE_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_INIT_DEVICE_RES\",\n\t[MSG_SMS_ATSC_SET_ALL_IP_REQ                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_SET_ALL_IP_REQ\",\n\t[MSG_SMS_ATSC_SET_ALL_IP_RES                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_SET_ALL_IP_RES\",\n\t[MSG_SMS_ATSC_START_ENSEMBLE_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_START_ENSEMBLE_REQ\",\n\t[MSG_SMS_ATSC_START_ENSEMBLE_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_START_ENSEMBLE_RES\",\n\t[MSG_SMS_SET_OUTPUT_MODE_REQ                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_OUTPUT_MODE_REQ\",\n\t[MSG_SMS_SET_OUTPUT_MODE_RES                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_OUTPUT_MODE_RES\",\n\t[MSG_SMS_ATSC_IP_FILTER_GET_LIST_REQ         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_GET_LIST_REQ\",\n\t[MSG_SMS_ATSC_IP_FILTER_GET_LIST_RES         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_GET_LIST_RES\",\n\t[MSG_SMS_SUB_CHANNEL_START_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SUB_CHANNEL_START_REQ\",\n\t[MSG_SMS_SUB_CHANNEL_START_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SUB_CHANNEL_START_RES\",\n\t[MSG_SMS_SUB_CHANNEL_STOP_REQ                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SUB_CHANNEL_STOP_REQ\",\n\t[MSG_SMS_SUB_CHANNEL_STOP_RES                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SUB_CHANNEL_STOP_RES\",\n\t[MSG_SMS_ATSC_IP_FILTER_ADD_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_ADD_REQ\",\n\t[MSG_SMS_ATSC_IP_FILTER_ADD_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_ADD_RES\",\n\t[MSG_SMS_ATSC_IP_FILTER_REMOVE_REQ           - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_REMOVE_REQ\",\n\t[MSG_SMS_ATSC_IP_FILTER_REMOVE_RES           - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_REMOVE_RES\",\n\t[MSG_SMS_ATSC_IP_FILTER_REMOVE_ALL_REQ       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_REMOVE_ALL_REQ\",\n\t[MSG_SMS_ATSC_IP_FILTER_REMOVE_ALL_RES       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_IP_FILTER_REMOVE_ALL_RES\",\n\t[MSG_SMS_WAIT_CMD                            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_WAIT_CMD\",\n\t[MSG_SMS_ADD_PID_FILTER_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ADD_PID_FILTER_REQ\",\n\t[MSG_SMS_ADD_PID_FILTER_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ADD_PID_FILTER_RES\",\n\t[MSG_SMS_REMOVE_PID_FILTER_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_REMOVE_PID_FILTER_REQ\",\n\t[MSG_SMS_REMOVE_PID_FILTER_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_REMOVE_PID_FILTER_RES\",\n\t[MSG_SMS_FAST_INFORMATION_CHANNEL_REQ        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_FAST_INFORMATION_CHANNEL_REQ\",\n\t[MSG_SMS_FAST_INFORMATION_CHANNEL_RES        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_FAST_INFORMATION_CHANNEL_RES\",\n\t[MSG_SMS_DAB_CHANNEL                         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DAB_CHANNEL\",\n\t[MSG_SMS_GET_PID_FILTER_LIST_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_PID_FILTER_LIST_REQ\",\n\t[MSG_SMS_GET_PID_FILTER_LIST_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_PID_FILTER_LIST_RES\",\n\t[MSG_SMS_POWER_DOWN_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_DOWN_REQ\",\n\t[MSG_SMS_POWER_DOWN_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_DOWN_RES\",\n\t[MSG_SMS_ATSC_SLT_EXIST_IND                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_SLT_EXIST_IND\",\n\t[MSG_SMS_ATSC_NO_SLT_IND                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ATSC_NO_SLT_IND\",\n\t[MSG_SMS_GET_STATISTICS_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_STATISTICS_REQ\",\n\t[MSG_SMS_GET_STATISTICS_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_STATISTICS_RES\",\n\t[MSG_SMS_SEND_DUMP                           - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SEND_DUMP\",\n\t[MSG_SMS_SCAN_START_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SCAN_START_REQ\",\n\t[MSG_SMS_SCAN_START_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SCAN_START_RES\",\n\t[MSG_SMS_SCAN_STOP_REQ                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SCAN_STOP_REQ\",\n\t[MSG_SMS_SCAN_STOP_RES                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SCAN_STOP_RES\",\n\t[MSG_SMS_SCAN_PROGRESS_IND                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SCAN_PROGRESS_IND\",\n\t[MSG_SMS_SCAN_COMPLETE_IND                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SCAN_COMPLETE_IND\",\n\t[MSG_SMS_LOG_ITEM                            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LOG_ITEM\",\n\t[MSG_SMS_DAB_SUBCHANNEL_RECONFIG_REQ         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DAB_SUBCHANNEL_RECONFIG_REQ\",\n\t[MSG_SMS_DAB_SUBCHANNEL_RECONFIG_RES         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DAB_SUBCHANNEL_RECONFIG_RES\",\n\t[MSG_SMS_HO_PER_SLICES_IND                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_PER_SLICES_IND\",\n\t[MSG_SMS_HO_INBAND_POWER_IND                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_INBAND_POWER_IND\",\n\t[MSG_SMS_MANUAL_DEMOD_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MANUAL_DEMOD_REQ\",\n\t[MSG_SMS_HO_TUNE_ON_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_TUNE_ON_REQ\",\n\t[MSG_SMS_HO_TUNE_ON_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_TUNE_ON_RES\",\n\t[MSG_SMS_HO_TUNE_OFF_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_TUNE_OFF_REQ\",\n\t[MSG_SMS_HO_TUNE_OFF_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_TUNE_OFF_RES\",\n\t[MSG_SMS_HO_PEEK_FREQ_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_PEEK_FREQ_REQ\",\n\t[MSG_SMS_HO_PEEK_FREQ_RES                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_PEEK_FREQ_RES\",\n\t[MSG_SMS_HO_PEEK_FREQ_IND                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HO_PEEK_FREQ_IND\",\n\t[MSG_SMS_MB_ATTEN_SET_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_ATTEN_SET_REQ\",\n\t[MSG_SMS_MB_ATTEN_SET_RES                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MB_ATTEN_SET_RES\",\n\t[MSG_SMS_ENABLE_STAT_IN_I2C_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ENABLE_STAT_IN_I2C_REQ\",\n\t[MSG_SMS_ENABLE_STAT_IN_I2C_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ENABLE_STAT_IN_I2C_RES\",\n\t[MSG_SMS_SET_ANTENNA_CONFIG_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_ANTENNA_CONFIG_REQ\",\n\t[MSG_SMS_SET_ANTENNA_CONFIG_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_ANTENNA_CONFIG_RES\",\n\t[MSG_SMS_GET_STATISTICS_EX_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_STATISTICS_EX_REQ\",\n\t[MSG_SMS_GET_STATISTICS_EX_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_STATISTICS_EX_RES\",\n\t[MSG_SMS_SLEEP_RESUME_COMP_IND               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SLEEP_RESUME_COMP_IND\",\n\t[MSG_SMS_SWITCH_HOST_INTERFACE_REQ           - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SWITCH_HOST_INTERFACE_REQ\",\n\t[MSG_SMS_SWITCH_HOST_INTERFACE_RES           - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SWITCH_HOST_INTERFACE_RES\",\n\t[MSG_SMS_DATA_DOWNLOAD_REQ                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_DOWNLOAD_REQ\",\n\t[MSG_SMS_DATA_DOWNLOAD_RES                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_DOWNLOAD_RES\",\n\t[MSG_SMS_DATA_VALIDITY_REQ                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_VALIDITY_REQ\",\n\t[MSG_SMS_DATA_VALIDITY_RES                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_VALIDITY_RES\",\n\t[MSG_SMS_SWDOWNLOAD_TRIGGER_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SWDOWNLOAD_TRIGGER_REQ\",\n\t[MSG_SMS_SWDOWNLOAD_TRIGGER_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SWDOWNLOAD_TRIGGER_RES\",\n\t[MSG_SMS_SWDOWNLOAD_BACKDOOR_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SWDOWNLOAD_BACKDOOR_REQ\",\n\t[MSG_SMS_SWDOWNLOAD_BACKDOOR_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SWDOWNLOAD_BACKDOOR_RES\",\n\t[MSG_SMS_GET_VERSION_EX_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_VERSION_EX_REQ\",\n\t[MSG_SMS_GET_VERSION_EX_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_VERSION_EX_RES\",\n\t[MSG_SMS_CLOCK_OUTPUT_CONFIG_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CLOCK_OUTPUT_CONFIG_REQ\",\n\t[MSG_SMS_CLOCK_OUTPUT_CONFIG_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CLOCK_OUTPUT_CONFIG_RES\",\n\t[MSG_SMS_I2C_SET_FREQ_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_I2C_SET_FREQ_REQ\",\n\t[MSG_SMS_I2C_SET_FREQ_RES                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_I2C_SET_FREQ_RES\",\n\t[MSG_SMS_GENERIC_I2C_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GENERIC_I2C_REQ\",\n\t[MSG_SMS_GENERIC_I2C_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GENERIC_I2C_RES\",\n\t[MSG_SMS_DVBT_BDA_DATA                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DVBT_BDA_DATA\",\n\t[MSG_SW_RELOAD_REQ                           - MSG_TYPE_BASE_VAL] = \"MSG_SW_RELOAD_REQ\",\n\t[MSG_SMS_DATA_MSG                            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_MSG\",\n\t[MSG_TABLE_UPLOAD_REQ                        - MSG_TYPE_BASE_VAL] = \"MSG_TABLE_UPLOAD_REQ\",\n\t[MSG_TABLE_UPLOAD_RES                        - MSG_TYPE_BASE_VAL] = \"MSG_TABLE_UPLOAD_RES\",\n\t[MSG_SW_RELOAD_START_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SW_RELOAD_START_REQ\",\n\t[MSG_SW_RELOAD_START_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SW_RELOAD_START_RES\",\n\t[MSG_SW_RELOAD_EXEC_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SW_RELOAD_EXEC_REQ\",\n\t[MSG_SW_RELOAD_EXEC_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SW_RELOAD_EXEC_RES\",\n\t[MSG_SMS_SPI_INT_LINE_SET_REQ                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SPI_INT_LINE_SET_REQ\",\n\t[MSG_SMS_SPI_INT_LINE_SET_RES                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SPI_INT_LINE_SET_RES\",\n\t[MSG_SMS_GPIO_CONFIG_EX_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_CONFIG_EX_REQ\",\n\t[MSG_SMS_GPIO_CONFIG_EX_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GPIO_CONFIG_EX_RES\",\n\t[MSG_SMS_WATCHDOG_ACT_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_WATCHDOG_ACT_REQ\",\n\t[MSG_SMS_WATCHDOG_ACT_RES                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_WATCHDOG_ACT_RES\",\n\t[MSG_SMS_LOOPBACK_REQ                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LOOPBACK_REQ\",\n\t[MSG_SMS_LOOPBACK_RES                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LOOPBACK_RES\",\n\t[MSG_SMS_RAW_CAPTURE_START_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RAW_CAPTURE_START_REQ\",\n\t[MSG_SMS_RAW_CAPTURE_START_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RAW_CAPTURE_START_RES\",\n\t[MSG_SMS_RAW_CAPTURE_ABORT_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RAW_CAPTURE_ABORT_REQ\",\n\t[MSG_SMS_RAW_CAPTURE_ABORT_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RAW_CAPTURE_ABORT_RES\",\n\t[MSG_SMS_RAW_CAPTURE_COMPLETE_IND            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_RAW_CAPTURE_COMPLETE_IND\",\n\t[MSG_SMS_DATA_PUMP_IND                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_PUMP_IND\",\n\t[MSG_SMS_DATA_PUMP_REQ                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_PUMP_REQ\",\n\t[MSG_SMS_DATA_PUMP_RES                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DATA_PUMP_RES\",\n\t[MSG_SMS_FLASH_DL_REQ                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_FLASH_DL_REQ\",\n\t[MSG_SMS_EXEC_TEST_1_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EXEC_TEST_1_REQ\",\n\t[MSG_SMS_EXEC_TEST_1_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EXEC_TEST_1_RES\",\n\t[MSG_SMS_ENABLE_TS_INTERFACE_REQ             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ENABLE_TS_INTERFACE_REQ\",\n\t[MSG_SMS_ENABLE_TS_INTERFACE_RES             - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ENABLE_TS_INTERFACE_RES\",\n\t[MSG_SMS_SPI_SET_BUS_WIDTH_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SPI_SET_BUS_WIDTH_REQ\",\n\t[MSG_SMS_SPI_SET_BUS_WIDTH_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SPI_SET_BUS_WIDTH_RES\",\n\t[MSG_SMS_SEND_EMM_REQ                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SEND_EMM_REQ\",\n\t[MSG_SMS_SEND_EMM_RES                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SEND_EMM_RES\",\n\t[MSG_SMS_DISABLE_TS_INTERFACE_REQ            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DISABLE_TS_INTERFACE_REQ\",\n\t[MSG_SMS_DISABLE_TS_INTERFACE_RES            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DISABLE_TS_INTERFACE_RES\",\n\t[MSG_SMS_IS_BUF_FREE_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IS_BUF_FREE_REQ\",\n\t[MSG_SMS_IS_BUF_FREE_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IS_BUF_FREE_RES\",\n\t[MSG_SMS_EXT_ANTENNA_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EXT_ANTENNA_REQ\",\n\t[MSG_SMS_EXT_ANTENNA_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EXT_ANTENNA_RES\",\n\t[MSG_SMS_CMMB_GET_NET_OF_FREQ_REQ_OBSOLETE   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_NET_OF_FREQ_REQ_OBSOLETE\",\n\t[MSG_SMS_CMMB_GET_NET_OF_FREQ_RES_OBSOLETE   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_NET_OF_FREQ_RES_OBSOLETE\",\n\t[MSG_SMS_BATTERY_LEVEL_REQ                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_BATTERY_LEVEL_REQ\",\n\t[MSG_SMS_BATTERY_LEVEL_RES                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_BATTERY_LEVEL_RES\",\n\t[MSG_SMS_CMMB_INJECT_TABLE_REQ_OBSOLETE      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_INJECT_TABLE_REQ_OBSOLETE\",\n\t[MSG_SMS_CMMB_INJECT_TABLE_RES_OBSOLETE      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_INJECT_TABLE_RES_OBSOLETE\",\n\t[MSG_SMS_FM_RADIO_BLOCK_IND                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_FM_RADIO_BLOCK_IND\",\n\t[MSG_SMS_HOST_NOTIFICATION_IND               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_HOST_NOTIFICATION_IND\",\n\t[MSG_SMS_CMMB_GET_CONTROL_TABLE_REQ_OBSOLETE - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_CONTROL_TABLE_REQ_OBSOLETE\",\n\t[MSG_SMS_CMMB_GET_CONTROL_TABLE_RES_OBSOLETE - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_CONTROL_TABLE_RES_OBSOLETE\",\n\t[MSG_SMS_CMMB_GET_NETWORKS_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_NETWORKS_REQ\",\n\t[MSG_SMS_CMMB_GET_NETWORKS_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_NETWORKS_RES\",\n\t[MSG_SMS_CMMB_START_SERVICE_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_START_SERVICE_REQ\",\n\t[MSG_SMS_CMMB_START_SERVICE_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_START_SERVICE_RES\",\n\t[MSG_SMS_CMMB_STOP_SERVICE_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_STOP_SERVICE_REQ\",\n\t[MSG_SMS_CMMB_STOP_SERVICE_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_STOP_SERVICE_RES\",\n\t[MSG_SMS_CMMB_ADD_CHANNEL_FILTER_REQ         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_ADD_CHANNEL_FILTER_REQ\",\n\t[MSG_SMS_CMMB_ADD_CHANNEL_FILTER_RES         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_ADD_CHANNEL_FILTER_RES\",\n\t[MSG_SMS_CMMB_REMOVE_CHANNEL_FILTER_REQ      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_REMOVE_CHANNEL_FILTER_REQ\",\n\t[MSG_SMS_CMMB_REMOVE_CHANNEL_FILTER_RES      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_REMOVE_CHANNEL_FILTER_RES\",\n\t[MSG_SMS_CMMB_START_CONTROL_INFO_REQ         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_START_CONTROL_INFO_REQ\",\n\t[MSG_SMS_CMMB_START_CONTROL_INFO_RES         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_START_CONTROL_INFO_RES\",\n\t[MSG_SMS_CMMB_STOP_CONTROL_INFO_REQ          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_STOP_CONTROL_INFO_REQ\",\n\t[MSG_SMS_CMMB_STOP_CONTROL_INFO_RES          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_STOP_CONTROL_INFO_RES\",\n\t[MSG_SMS_ISDBT_TUNE_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_TUNE_REQ\",\n\t[MSG_SMS_ISDBT_TUNE_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ISDBT_TUNE_RES\",\n\t[MSG_SMS_TRANSMISSION_IND                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_TRANSMISSION_IND\",\n\t[MSG_SMS_PID_STATISTICS_IND                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_PID_STATISTICS_IND\",\n\t[MSG_SMS_POWER_DOWN_IND                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_DOWN_IND\",\n\t[MSG_SMS_POWER_DOWN_CONF                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_DOWN_CONF\",\n\t[MSG_SMS_POWER_UP_IND                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_UP_IND\",\n\t[MSG_SMS_POWER_UP_CONF                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_UP_CONF\",\n\t[MSG_SMS_POWER_MODE_SET_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_MODE_SET_REQ\",\n\t[MSG_SMS_POWER_MODE_SET_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_POWER_MODE_SET_RES\",\n\t[MSG_SMS_DEBUG_HOST_EVENT_REQ                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DEBUG_HOST_EVENT_REQ\",\n\t[MSG_SMS_DEBUG_HOST_EVENT_RES                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DEBUG_HOST_EVENT_RES\",\n\t[MSG_SMS_NEW_CRYSTAL_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NEW_CRYSTAL_REQ\",\n\t[MSG_SMS_NEW_CRYSTAL_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NEW_CRYSTAL_RES\",\n\t[MSG_SMS_CONFIG_SPI_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CONFIG_SPI_REQ\",\n\t[MSG_SMS_CONFIG_SPI_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CONFIG_SPI_RES\",\n\t[MSG_SMS_I2C_SHORT_STAT_IND                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_I2C_SHORT_STAT_IND\",\n\t[MSG_SMS_START_IR_REQ                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_START_IR_REQ\",\n\t[MSG_SMS_START_IR_RES                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_START_IR_RES\",\n\t[MSG_SMS_IR_SAMPLES_IND                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IR_SAMPLES_IND\",\n\t[MSG_SMS_CMMB_CA_SERVICE_IND                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_CA_SERVICE_IND\",\n\t[MSG_SMS_SLAVE_DEVICE_DETECTED               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SLAVE_DEVICE_DETECTED\",\n\t[MSG_SMS_INTERFACE_LOCK_IND                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_INTERFACE_LOCK_IND\",\n\t[MSG_SMS_INTERFACE_UNLOCK_IND                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_INTERFACE_UNLOCK_IND\",\n\t[MSG_SMS_SEND_ROSUM_BUFF_REQ                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SEND_ROSUM_BUFF_REQ\",\n\t[MSG_SMS_SEND_ROSUM_BUFF_RES                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SEND_ROSUM_BUFF_RES\",\n\t[MSG_SMS_ROSUM_BUFF                          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_ROSUM_BUFF\",\n\t[MSG_SMS_SET_AES128_KEY_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_AES128_KEY_REQ\",\n\t[MSG_SMS_SET_AES128_KEY_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_AES128_KEY_RES\",\n\t[MSG_SMS_MBBMS_WRITE_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MBBMS_WRITE_REQ\",\n\t[MSG_SMS_MBBMS_WRITE_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MBBMS_WRITE_RES\",\n\t[MSG_SMS_MBBMS_READ_IND                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MBBMS_READ_IND\",\n\t[MSG_SMS_IQ_STREAM_START_REQ                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IQ_STREAM_START_REQ\",\n\t[MSG_SMS_IQ_STREAM_START_RES                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IQ_STREAM_START_RES\",\n\t[MSG_SMS_IQ_STREAM_STOP_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IQ_STREAM_STOP_REQ\",\n\t[MSG_SMS_IQ_STREAM_STOP_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IQ_STREAM_STOP_RES\",\n\t[MSG_SMS_IQ_STREAM_DATA_BLOCK                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_IQ_STREAM_DATA_BLOCK\",\n\t[MSG_SMS_GET_EEPROM_VERSION_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_EEPROM_VERSION_REQ\",\n\t[MSG_SMS_GET_EEPROM_VERSION_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_GET_EEPROM_VERSION_RES\",\n\t[MSG_SMS_SIGNAL_DETECTED_IND                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SIGNAL_DETECTED_IND\",\n\t[MSG_SMS_NO_SIGNAL_IND                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NO_SIGNAL_IND\",\n\t[MSG_SMS_MRC_SHUTDOWN_SLAVE_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MRC_SHUTDOWN_SLAVE_REQ\",\n\t[MSG_SMS_MRC_SHUTDOWN_SLAVE_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MRC_SHUTDOWN_SLAVE_RES\",\n\t[MSG_SMS_MRC_BRINGUP_SLAVE_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MRC_BRINGUP_SLAVE_REQ\",\n\t[MSG_SMS_MRC_BRINGUP_SLAVE_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MRC_BRINGUP_SLAVE_RES\",\n\t[MSG_SMS_EXTERNAL_LNA_CTRL_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EXTERNAL_LNA_CTRL_REQ\",\n\t[MSG_SMS_EXTERNAL_LNA_CTRL_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_EXTERNAL_LNA_CTRL_RES\",\n\t[MSG_SMS_SET_PERIODIC_STATISTICS_REQ         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_PERIODIC_STATISTICS_REQ\",\n\t[MSG_SMS_SET_PERIODIC_STATISTICS_RES         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SET_PERIODIC_STATISTICS_RES\",\n\t[MSG_SMS_CMMB_SET_AUTO_OUTPUT_TS0_REQ        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SET_AUTO_OUTPUT_TS0_REQ\",\n\t[MSG_SMS_CMMB_SET_AUTO_OUTPUT_TS0_RES        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SET_AUTO_OUTPUT_TS0_RES\",\n\t[LOCAL_TUNE                                  - MSG_TYPE_BASE_VAL] = \"LOCAL_TUNE\",\n\t[LOCAL_IFFT_H_ICI                            - MSG_TYPE_BASE_VAL] = \"LOCAL_IFFT_H_ICI\",\n\t[MSG_RESYNC_REQ                              - MSG_TYPE_BASE_VAL] = \"MSG_RESYNC_REQ\",\n\t[MSG_SMS_CMMB_GET_MRC_STATISTICS_REQ         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_MRC_STATISTICS_REQ\",\n\t[MSG_SMS_CMMB_GET_MRC_STATISTICS_RES         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_MRC_STATISTICS_RES\",\n\t[MSG_SMS_LOG_EX_ITEM                         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LOG_EX_ITEM\",\n\t[MSG_SMS_DEVICE_DATA_LOSS_IND                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DEVICE_DATA_LOSS_IND\",\n\t[MSG_SMS_MRC_WATCHDOG_TRIGGERED_IND          - MSG_TYPE_BASE_VAL] = \"MSG_SMS_MRC_WATCHDOG_TRIGGERED_IND\",\n\t[MSG_SMS_USER_MSG_REQ                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_USER_MSG_REQ\",\n\t[MSG_SMS_USER_MSG_RES                        - MSG_TYPE_BASE_VAL] = \"MSG_SMS_USER_MSG_RES\",\n\t[MSG_SMS_SMART_CARD_INIT_REQ                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SMART_CARD_INIT_REQ\",\n\t[MSG_SMS_SMART_CARD_INIT_RES                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SMART_CARD_INIT_RES\",\n\t[MSG_SMS_SMART_CARD_WRITE_REQ                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SMART_CARD_WRITE_REQ\",\n\t[MSG_SMS_SMART_CARD_WRITE_RES                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SMART_CARD_WRITE_RES\",\n\t[MSG_SMS_SMART_CARD_READ_IND                 - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SMART_CARD_READ_IND\",\n\t[MSG_SMS_TSE_ENABLE_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_TSE_ENABLE_REQ\",\n\t[MSG_SMS_TSE_ENABLE_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_TSE_ENABLE_RES\",\n\t[MSG_SMS_CMMB_GET_SHORT_STATISTICS_REQ       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_SHORT_STATISTICS_REQ\",\n\t[MSG_SMS_CMMB_GET_SHORT_STATISTICS_RES       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_GET_SHORT_STATISTICS_RES\",\n\t[MSG_SMS_LED_CONFIG_REQ                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LED_CONFIG_REQ\",\n\t[MSG_SMS_LED_CONFIG_RES                      - MSG_TYPE_BASE_VAL] = \"MSG_SMS_LED_CONFIG_RES\",\n\t[MSG_PWM_ANTENNA_REQ                         - MSG_TYPE_BASE_VAL] = \"MSG_PWM_ANTENNA_REQ\",\n\t[MSG_PWM_ANTENNA_RES                         - MSG_TYPE_BASE_VAL] = \"MSG_PWM_ANTENNA_RES\",\n\t[MSG_SMS_CMMB_SMD_SN_REQ                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SMD_SN_REQ\",\n\t[MSG_SMS_CMMB_SMD_SN_RES                     - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SMD_SN_RES\",\n\t[MSG_SMS_CMMB_SET_CA_CW_REQ                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SET_CA_CW_REQ\",\n\t[MSG_SMS_CMMB_SET_CA_CW_RES                  - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SET_CA_CW_RES\",\n\t[MSG_SMS_CMMB_SET_CA_SALT_REQ                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SET_CA_SALT_REQ\",\n\t[MSG_SMS_CMMB_SET_CA_SALT_RES                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_CMMB_SET_CA_SALT_RES\",\n\t[MSG_SMS_NSCD_INIT_REQ                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NSCD_INIT_REQ\",\n\t[MSG_SMS_NSCD_INIT_RES                       - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NSCD_INIT_RES\",\n\t[MSG_SMS_NSCD_PROCESS_SECTION_REQ            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NSCD_PROCESS_SECTION_REQ\",\n\t[MSG_SMS_NSCD_PROCESS_SECTION_RES            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NSCD_PROCESS_SECTION_RES\",\n\t[MSG_SMS_DBD_CREATE_OBJECT_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_CREATE_OBJECT_REQ\",\n\t[MSG_SMS_DBD_CREATE_OBJECT_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_CREATE_OBJECT_RES\",\n\t[MSG_SMS_DBD_CONFIGURE_REQ                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_CONFIGURE_REQ\",\n\t[MSG_SMS_DBD_CONFIGURE_RES                   - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_CONFIGURE_RES\",\n\t[MSG_SMS_DBD_SET_KEYS_REQ                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_SET_KEYS_REQ\",\n\t[MSG_SMS_DBD_SET_KEYS_RES                    - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_SET_KEYS_RES\",\n\t[MSG_SMS_DBD_PROCESS_HEADER_REQ              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_PROCESS_HEADER_REQ\",\n\t[MSG_SMS_DBD_PROCESS_HEADER_RES              - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_PROCESS_HEADER_RES\",\n\t[MSG_SMS_DBD_PROCESS_DATA_REQ                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_PROCESS_DATA_REQ\",\n\t[MSG_SMS_DBD_PROCESS_DATA_RES                - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_PROCESS_DATA_RES\",\n\t[MSG_SMS_DBD_PROCESS_GET_DATA_REQ            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_PROCESS_GET_DATA_REQ\",\n\t[MSG_SMS_DBD_PROCESS_GET_DATA_RES            - MSG_TYPE_BASE_VAL] = \"MSG_SMS_DBD_PROCESS_GET_DATA_RES\",\n\t[MSG_SMS_NSCD_OPEN_SESSION_REQ               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NSCD_OPEN_SESSION_REQ\",\n\t[MSG_SMS_NSCD_OPEN_SESSION_RES               - MSG_TYPE_BASE_VAL] = \"MSG_SMS_NSCD_OPEN_SESSION_RES\",\n\t[MSG_SMS_SEND_HOST_DATA_TO_DEMUX_REQ         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SEND_HOST_DATA_TO_DEMUX_REQ\",\n\t[MSG_SMS_SEND_HOST_DATA_TO_DEMUX_RES         - MSG_TYPE_BASE_VAL] = \"MSG_SMS_SEND_HOST_DATA_TO_DEMUX_RES\",\n\t[MSG_LAST_MSG_TYPE                           - MSG_TYPE_BASE_VAL] = \"MSG_LAST_MSG_TYPE\",\n};\n\nchar *smscore_translate_msg(enum msg_types msgtype)\n{\n\tint i = msgtype - MSG_TYPE_BASE_VAL;\n\tchar *msg;\n\n\tif (i < 0 || i >= ARRAY_SIZE(siano_msgs))\n\t\treturn \"Unknown msg type\";\n\n\tmsg = siano_msgs[i];\n\n\tif (!*msg)\n\t\treturn \"Unknown msg type\";\n\n\treturn msg;\n}\nEXPORT_SYMBOL_GPL(smscore_translate_msg);\n\nvoid smscore_set_board_id(struct smscore_device_t *core, int id)\n{\n\tcore->board_id = id;\n}\n\nint smscore_led_state(struct smscore_device_t *core, int led)\n{\n\tif (led >= 0)\n\t\tcore->led_state = led;\n\treturn core->led_state;\n}\nEXPORT_SYMBOL_GPL(smscore_set_board_id);\n\nint smscore_get_board_id(struct smscore_device_t *core)\n{\n\treturn core->board_id;\n}\nEXPORT_SYMBOL_GPL(smscore_get_board_id);\n\nstruct smscore_registry_entry_t {\n\tstruct list_head entry;\n\tchar devpath[32];\n\tint mode;\n\tenum sms_device_type_st\ttype;\n};\n\nstatic struct list_head g_smscore_notifyees;\nstatic struct list_head g_smscore_devices;\nstatic DEFINE_MUTEX(g_smscore_deviceslock);\n\nstatic struct list_head g_smscore_registry;\nstatic DEFINE_MUTEX(g_smscore_registrylock);\n\nstatic int default_mode = DEVICE_MODE_NONE;\n\nmodule_param(default_mode, int, 0644);\nMODULE_PARM_DESC(default_mode, \"default firmware id (device mode)\");\n\nstatic struct smscore_registry_entry_t *smscore_find_registry(char *devpath)\n{\n\tstruct smscore_registry_entry_t *entry;\n\tstruct list_head *next;\n\n\tmutex_lock(&g_smscore_registrylock);\n\tfor (next = g_smscore_registry.next;\n\t     next != &g_smscore_registry;\n\t     next = next->next) {\n\t\tentry = (struct smscore_registry_entry_t *) next;\n\t\tif (!strncmp(entry->devpath, devpath, sizeof(entry->devpath))) {\n\t\t\tmutex_unlock(&g_smscore_registrylock);\n\t\t\treturn entry;\n\t\t}\n\t}\n\tentry = kmalloc(sizeof(*entry), GFP_KERNEL);\n\tif (entry) {\n\t\tentry->mode = default_mode;\n\t\tstrscpy(entry->devpath, devpath, sizeof(entry->devpath));\n\t\tlist_add(&entry->entry, &g_smscore_registry);\n\t} else\n\t\tpr_err(\"failed to create smscore_registry.\\n\");\n\tmutex_unlock(&g_smscore_registrylock);\n\treturn entry;\n}\n\nint smscore_registry_getmode(char *devpath)\n{\n\tstruct smscore_registry_entry_t *entry;\n\n\tentry = smscore_find_registry(devpath);\n\tif (entry)\n\t\treturn entry->mode;\n\telse\n\t\tpr_err(\"No registry found.\\n\");\n\n\treturn default_mode;\n}\nEXPORT_SYMBOL_GPL(smscore_registry_getmode);\n\nstatic enum sms_device_type_st smscore_registry_gettype(char *devpath)\n{\n\tstruct smscore_registry_entry_t *entry;\n\n\tentry = smscore_find_registry(devpath);\n\tif (entry)\n\t\treturn entry->type;\n\telse\n\t\tpr_err(\"No registry found.\\n\");\n\n\treturn -EINVAL;\n}\n\nstatic void smscore_registry_setmode(char *devpath, int mode)\n{\n\tstruct smscore_registry_entry_t *entry;\n\n\tentry = smscore_find_registry(devpath);\n\tif (entry)\n\t\tentry->mode = mode;\n\telse\n\t\tpr_err(\"No registry found.\\n\");\n}\n\nstatic void smscore_registry_settype(char *devpath,\n\t\t\t\t     enum sms_device_type_st type)\n{\n\tstruct smscore_registry_entry_t *entry;\n\n\tentry = smscore_find_registry(devpath);\n\tif (entry)\n\t\tentry->type = type;\n\telse\n\t\tpr_err(\"No registry found.\\n\");\n}\n\n\nstatic void list_add_locked(struct list_head *new, struct list_head *head,\n\t\t\t    spinlock_t *lock)\n{\n\tunsigned long flags;\n\n\tspin_lock_irqsave(lock, flags);\n\n\tlist_add(new, head);\n\n\tspin_unlock_irqrestore(lock, flags);\n}\n\n \nint smscore_register_hotplug(hotplug_t hotplug)\n{\n\tstruct smscore_device_notifyee_t *notifyee;\n\tstruct list_head *next, *first;\n\tint rc = 0;\n\n\tmutex_lock(&g_smscore_deviceslock);\n\tnotifyee = kmalloc(sizeof(*notifyee), GFP_KERNEL);\n\tif (notifyee) {\n\t\t \n\t\tfirst = &g_smscore_devices;\n\t\tfor (next = first->next;\n\t\t     next != first && !rc;\n\t\t     next = next->next) {\n\t\t\tstruct smscore_device_t *coredev =\n\t\t\t\t(struct smscore_device_t *) next;\n\t\t\trc = hotplug(coredev, coredev->device, 1);\n\t\t}\n\n\t\tif (rc >= 0) {\n\t\t\tnotifyee->hotplug = hotplug;\n\t\t\tlist_add(&notifyee->entry, &g_smscore_notifyees);\n\t\t} else\n\t\t\tkfree(notifyee);\n\t} else\n\t\trc = -ENOMEM;\n\n\tmutex_unlock(&g_smscore_deviceslock);\n\n\treturn rc;\n}\nEXPORT_SYMBOL_GPL(smscore_register_hotplug);\n\n \nvoid smscore_unregister_hotplug(hotplug_t hotplug)\n{\n\tstruct list_head *next, *first;\n\n\tmutex_lock(&g_smscore_deviceslock);\n\n\tfirst = &g_smscore_notifyees;\n\n\tfor (next = first->next; next != first;) {\n\t\tstruct smscore_device_notifyee_t *notifyee =\n\t\t\t(struct smscore_device_notifyee_t *) next;\n\t\tnext = next->next;\n\n\t\tif (notifyee->hotplug == hotplug) {\n\t\t\tlist_del(&notifyee->entry);\n\t\t\tkfree(notifyee);\n\t\t}\n\t}\n\n\tmutex_unlock(&g_smscore_deviceslock);\n}\nEXPORT_SYMBOL_GPL(smscore_unregister_hotplug);\n\nstatic void smscore_notify_clients(struct smscore_device_t *coredev)\n{\n\tstruct smscore_client_t *client;\n\n\t \n\twhile (!list_empty(&coredev->clients)) {\n\t\tclient = (struct smscore_client_t *) coredev->clients.next;\n\t\tclient->onremove_handler(client->context);\n\t}\n}\n\nstatic int smscore_notify_callbacks(struct smscore_device_t *coredev,\n\t\t\t\t    struct device *device, int arrival)\n{\n\tstruct smscore_device_notifyee_t *elem;\n\tint rc = 0;\n\n\t \n\n\tlist_for_each_entry(elem, &g_smscore_notifyees, entry) {\n\t\trc = elem->hotplug(coredev, device, arrival);\n\t\tif (rc < 0)\n\t\t\tbreak;\n\t}\n\n\treturn rc;\n}\n\nstatic struct\nsmscore_buffer_t *smscore_createbuffer(u8 *buffer, void *common_buffer,\n\t\t\t\t       dma_addr_t common_buffer_phys)\n{\n\tstruct smscore_buffer_t *cb;\n\n\tcb = kzalloc(sizeof(*cb), GFP_KERNEL);\n\tif (!cb)\n\t\treturn NULL;\n\n\tcb->p = buffer;\n\tcb->offset_in_common = buffer - (u8 *) common_buffer;\n\tif (common_buffer_phys)\n\t\tcb->phys = common_buffer_phys + cb->offset_in_common;\n\n\treturn cb;\n}\n\n \nint smscore_register_device(struct smsdevice_params_t *params,\n\t\t\t    struct smscore_device_t **coredev,\n\t\t\t    gfp_t gfp_buf_flags,\n\t\t\t    void *mdev)\n{\n\tstruct smscore_device_t *dev;\n\tu8 *buffer;\n\n\tdev = kzalloc(sizeof(*dev), GFP_KERNEL);\n\tif (!dev)\n\t\treturn -ENOMEM;\n\n#ifdef CONFIG_MEDIA_CONTROLLER_DVB\n\tdev->media_dev = mdev;\n#endif\n\tdev->gfp_buf_flags = gfp_buf_flags;\n\n\t \n\tINIT_LIST_HEAD(&dev->entry);\n\n\t \n\tINIT_LIST_HEAD(&dev->clients);\n\tINIT_LIST_HEAD(&dev->buffers);\n\n\t \n\tspin_lock_init(&dev->clientslock);\n\tspin_lock_init(&dev->bufferslock);\n\n\t \n\tinit_completion(&dev->version_ex_done);\n\tinit_completion(&dev->data_download_done);\n\tinit_completion(&dev->data_validity_done);\n\tinit_completion(&dev->trigger_done);\n\tinit_completion(&dev->init_device_done);\n\tinit_completion(&dev->reload_start_done);\n\tinit_completion(&dev->resume_done);\n\tinit_completion(&dev->gpio_configuration_done);\n\tinit_completion(&dev->gpio_set_level_done);\n\tinit_completion(&dev->gpio_get_level_done);\n\tinit_completion(&dev->ir_init_done);\n\n\t \n\tinit_waitqueue_head(&dev->buffer_mng_waitq);\n\n\t \n\tdev->common_buffer_size = params->buffer_size * params->num_buffers;\n\tif (params->usb_device)\n\t\tbuffer = kzalloc(dev->common_buffer_size, GFP_KERNEL);\n\telse\n\t\tbuffer = dma_alloc_coherent(params->device,\n\t\t\t\t\t    dev->common_buffer_size,\n\t\t\t\t\t    &dev->common_buffer_phys,\n\t\t\t\t\t    GFP_KERNEL | dev->gfp_buf_flags);\n\tif (!buffer) {\n\t\tsmscore_unregister_device(dev);\n\t\treturn -ENOMEM;\n\t}\n\tdev->common_buffer = buffer;\n\n\t \n\tfor (; dev->num_buffers < params->num_buffers;\n\t     dev->num_buffers++, buffer += params->buffer_size) {\n\t\tstruct smscore_buffer_t *cb;\n\n\t\tcb = smscore_createbuffer(buffer, dev->common_buffer,\n\t\t\t\t\t  dev->common_buffer_phys);\n\t\tif (!cb) {\n\t\t\tsmscore_unregister_device(dev);\n\t\t\treturn -ENOMEM;\n\t\t}\n\n\t\tsmscore_putbuffer(dev, cb);\n\t}\n\n\tpr_debug(\"allocated %d buffers\\n\", dev->num_buffers);\n\n\tdev->mode = DEVICE_MODE_NONE;\n\tdev->board_id = SMS_BOARD_UNKNOWN;\n\tdev->context = params->context;\n\tdev->device = params->device;\n\tdev->usb_device = params->usb_device;\n\tdev->setmode_handler = params->setmode_handler;\n\tdev->detectmode_handler = params->detectmode_handler;\n\tdev->sendrequest_handler = params->sendrequest_handler;\n\tdev->preload_handler = params->preload_handler;\n\tdev->postload_handler = params->postload_handler;\n\n\tdev->device_flags = params->flags;\n\tstrscpy(dev->devpath, params->devpath, sizeof(dev->devpath));\n\n\tsmscore_registry_settype(dev->devpath, params->device_type);\n\n\t \n\tmutex_lock(&g_smscore_deviceslock);\n\tlist_add(&dev->entry, &g_smscore_devices);\n\tmutex_unlock(&g_smscore_deviceslock);\n\n\t*coredev = dev;\n\n\tpr_debug(\"device %p created\\n\", dev);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(smscore_register_device);\n\n\nstatic int smscore_sendrequest_and_wait(struct smscore_device_t *coredev,\n\t\tvoid *buffer, size_t size, struct completion *completion) {\n\tint rc;\n\n\tif (!completion)\n\t\treturn -EINVAL;\n\tinit_completion(completion);\n\n\trc = coredev->sendrequest_handler(coredev->context, buffer, size);\n\tif (rc < 0) {\n\t\tpr_info(\"sendrequest returned error %d\\n\", rc);\n\t\treturn rc;\n\t}\n\n\treturn wait_for_completion_timeout(completion,\n\t\t\tmsecs_to_jiffies(SMS_PROTOCOL_MAX_RAOUNDTRIP_MS)) ?\n\t\t\t0 : -ETIME;\n}\n\n \nstatic int smscore_init_ir(struct smscore_device_t *coredev)\n{\n\tint ir_io;\n\tint rc;\n\tvoid *buffer;\n\n\tcoredev->ir.dev = NULL;\n\tir_io = sms_get_board(smscore_get_board_id(coredev))->board_cfg.ir;\n\tif (ir_io) { \n\t\tpr_debug(\"IR loading\\n\");\n\t\trc = sms_ir_init(coredev);\n\n\t\tif\t(rc != 0)\n\t\t\tpr_err(\"Error initialization DTV IR sub-module\\n\");\n\t\telse {\n\t\t\tbuffer = kmalloc(sizeof(struct sms_msg_data2) +\n\t\t\t\t\t\tSMS_DMA_ALIGNMENT,\n\t\t\t\t\t\tGFP_KERNEL | coredev->gfp_buf_flags);\n\t\t\tif (buffer) {\n\t\t\t\tstruct sms_msg_data2 *msg =\n\t\t\t\t(struct sms_msg_data2 *)\n\t\t\t\tSMS_ALIGN_ADDRESS(buffer);\n\n\t\t\t\tSMS_INIT_MSG(&msg->x_msg_header,\n\t\t\t\t\t\tMSG_SMS_START_IR_REQ,\n\t\t\t\t\t\tsizeof(struct sms_msg_data2));\n\t\t\t\tmsg->msg_data[0] = coredev->ir.controller;\n\t\t\t\tmsg->msg_data[1] = coredev->ir.timeout;\n\n\t\t\t\trc = smscore_sendrequest_and_wait(coredev, msg,\n\t\t\t\t\t\tmsg->x_msg_header. msg_length,\n\t\t\t\t\t\t&coredev->ir_init_done);\n\n\t\t\t\tkfree(buffer);\n\t\t\t} else\n\t\t\t\tpr_err(\"Sending IR initialization message failed\\n\");\n\t\t}\n\t} else\n\t\tpr_info(\"IR port has not been detected\\n\");\n\n\treturn 0;\n}\n\n \nstatic int smscore_configure_board(struct smscore_device_t *coredev)\n{\n\tstruct sms_board *board;\n\n\tboard = sms_get_board(coredev->board_id);\n\tif (!board) {\n\t\tpr_err(\"no board configuration exist.\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tif (board->mtu) {\n\t\tstruct sms_msg_data mtu_msg;\n\t\tpr_debug(\"set max transmit unit %d\\n\", board->mtu);\n\n\t\tmtu_msg.x_msg_header.msg_src_id = 0;\n\t\tmtu_msg.x_msg_header.msg_dst_id = HIF_TASK;\n\t\tmtu_msg.x_msg_header.msg_flags = 0;\n\t\tmtu_msg.x_msg_header.msg_type = MSG_SMS_SET_MAX_TX_MSG_LEN_REQ;\n\t\tmtu_msg.x_msg_header.msg_length = sizeof(mtu_msg);\n\t\tmtu_msg.msg_data[0] = board->mtu;\n\n\t\tcoredev->sendrequest_handler(coredev->context, &mtu_msg,\n\t\t\t\t\t     sizeof(mtu_msg));\n\t}\n\n\tif (board->crystal) {\n\t\tstruct sms_msg_data crys_msg;\n\t\tpr_debug(\"set crystal value %d\\n\", board->crystal);\n\n\t\tSMS_INIT_MSG(&crys_msg.x_msg_header,\n\t\t\t\tMSG_SMS_NEW_CRYSTAL_REQ,\n\t\t\t\tsizeof(crys_msg));\n\t\tcrys_msg.msg_data[0] = board->crystal;\n\n\t\tcoredev->sendrequest_handler(coredev->context, &crys_msg,\n\t\t\t\t\t     sizeof(crys_msg));\n\t}\n\n\treturn 0;\n}\n\n \nint smscore_start_device(struct smscore_device_t *coredev)\n{\n\tint rc;\n\tint board_id = smscore_get_board_id(coredev);\n\tint mode = smscore_registry_getmode(coredev->devpath);\n\n\t \n\tif (board_id != SMS_BOARD_UNKNOWN && mode == DEVICE_MODE_NONE)\n\t\tmode = sms_get_board(board_id)->default_mode;\n\n\trc = smscore_set_device_mode(coredev, mode);\n\tif (rc < 0) {\n\t\tpr_info(\"set device mode failed , rc %d\\n\", rc);\n\t\treturn rc;\n\t}\n\trc = smscore_configure_board(coredev);\n\tif (rc < 0) {\n\t\tpr_info(\"configure board failed , rc %d\\n\", rc);\n\t\treturn rc;\n\t}\n\n\tmutex_lock(&g_smscore_deviceslock);\n\n\trc = smscore_notify_callbacks(coredev, coredev->device, 1);\n\tsmscore_init_ir(coredev);\n\n\tpr_debug(\"device %p started, rc %d\\n\", coredev, rc);\n\n\tmutex_unlock(&g_smscore_deviceslock);\n\n\treturn rc;\n}\nEXPORT_SYMBOL_GPL(smscore_start_device);\n\n\nstatic int smscore_load_firmware_family2(struct smscore_device_t *coredev,\n\t\t\t\t\t void *buffer, size_t size)\n{\n\tstruct sms_firmware *firmware = (struct sms_firmware *) buffer;\n\tstruct sms_msg_data5 *msg;\n\tu32 mem_address,  calc_checksum = 0;\n\tu32 i, *ptr;\n\tu8 *payload = firmware->payload;\n\tint rc = 0;\n\tfirmware->start_address = le32_to_cpup((__le32 *)&firmware->start_address);\n\tfirmware->length = le32_to_cpup((__le32 *)&firmware->length);\n\n\tmem_address = firmware->start_address;\n\n\tpr_debug(\"loading FW to addr 0x%x size %d\\n\",\n\t\t mem_address, firmware->length);\n\tif (coredev->preload_handler) {\n\t\trc = coredev->preload_handler(coredev->context);\n\t\tif (rc < 0)\n\t\t\treturn rc;\n\t}\n\n\t \n\tmsg = kmalloc(PAGE_SIZE, GFP_KERNEL | coredev->gfp_buf_flags);\n\tif (!msg)\n\t\treturn -ENOMEM;\n\n\tif (coredev->mode != DEVICE_MODE_NONE) {\n\t\tpr_debug(\"sending reload command.\\n\");\n\t\tSMS_INIT_MSG(&msg->x_msg_header, MSG_SW_RELOAD_START_REQ,\n\t\t\t     sizeof(struct sms_msg_hdr));\n\t\trc = smscore_sendrequest_and_wait(coredev, msg,\n\t\t\t\t\t\t  msg->x_msg_header.msg_length,\n\t\t\t\t\t\t  &coredev->reload_start_done);\n\t\tif (rc < 0) {\n\t\t\tpr_err(\"device reload failed, rc %d\\n\", rc);\n\t\t\tgoto exit_fw_download;\n\t\t}\n\t\tmem_address = *(u32 *) &payload[20];\n\t}\n\n\tfor (i = 0, ptr = (u32 *)firmware->payload; i < firmware->length/4 ;\n\t     i++, ptr++)\n\t\tcalc_checksum += *ptr;\n\n\twhile (size && rc >= 0) {\n\t\tstruct sms_data_download *data_msg =\n\t\t\t(struct sms_data_download *) msg;\n\t\tint payload_size = min_t(int, size, SMS_MAX_PAYLOAD_SIZE);\n\n\t\tSMS_INIT_MSG(&msg->x_msg_header, MSG_SMS_DATA_DOWNLOAD_REQ,\n\t\t\t     (u16)(sizeof(struct sms_msg_hdr) +\n\t\t\t\t      sizeof(u32) + payload_size));\n\n\t\tdata_msg->mem_addr = mem_address;\n\t\tmemcpy(data_msg->payload, payload, payload_size);\n\n\t\trc = smscore_sendrequest_and_wait(coredev, data_msg,\n\t\t\t\tdata_msg->x_msg_header.msg_length,\n\t\t\t\t&coredev->data_download_done);\n\n\t\tpayload += payload_size;\n\t\tsize -= payload_size;\n\t\tmem_address += payload_size;\n\t}\n\n\tif (rc < 0)\n\t\tgoto exit_fw_download;\n\n\tpr_debug(\"sending MSG_SMS_DATA_VALIDITY_REQ expecting 0x%x\\n\",\n\t\tcalc_checksum);\n\tSMS_INIT_MSG(&msg->x_msg_header, MSG_SMS_DATA_VALIDITY_REQ,\n\t\t\tsizeof(msg->x_msg_header) +\n\t\t\tsizeof(u32) * 3);\n\tmsg->msg_data[0] = firmware->start_address;\n\t\t \n\tmsg->msg_data[1] = firmware->length;\n\tmsg->msg_data[2] = 0;  \n\trc = smscore_sendrequest_and_wait(coredev, msg,\n\t\t\t\t\t  msg->x_msg_header.msg_length,\n\t\t\t\t\t  &coredev->data_validity_done);\n\tif (rc < 0)\n\t\tgoto exit_fw_download;\n\n\tif (coredev->mode == DEVICE_MODE_NONE) {\n\t\tpr_debug(\"sending MSG_SMS_SWDOWNLOAD_TRIGGER_REQ\\n\");\n\t\tSMS_INIT_MSG(&msg->x_msg_header,\n\t\t\t\tMSG_SMS_SWDOWNLOAD_TRIGGER_REQ,\n\t\t\t\tsizeof(*msg));\n\n\t\tmsg->msg_data[0] = firmware->start_address;\n\t\t\t\t\t \n\t\tmsg->msg_data[1] = 6;  \n\t\tmsg->msg_data[2] = 0x200;  \n\t\tmsg->msg_data[3] = 0;  \n\t\tmsg->msg_data[4] = 4;  \n\n\t\trc = smscore_sendrequest_and_wait(coredev, msg,\n\t\t\t\t\tmsg->x_msg_header.msg_length,\n\t\t\t\t\t&coredev->trigger_done);\n\t} else {\n\t\tSMS_INIT_MSG(&msg->x_msg_header, MSG_SW_RELOAD_EXEC_REQ,\n\t\t\t\tsizeof(struct sms_msg_hdr));\n\t\trc = coredev->sendrequest_handler(coredev->context, msg,\n\t\t\t\tmsg->x_msg_header.msg_length);\n\t}\n\n\tif (rc < 0)\n\t\tgoto exit_fw_download;\n\n\t \n\tmsleep(400);\n\nexit_fw_download:\n\tkfree(msg);\n\n\tif (coredev->postload_handler) {\n\t\tpr_debug(\"rc=%d, postload=0x%p\\n\",\n\t\t\t rc, coredev->postload_handler);\n\t\tif (rc >= 0)\n\t\t\treturn coredev->postload_handler(coredev->context);\n\t}\n\n\tpr_debug(\"rc=%d\\n\", rc);\n\treturn rc;\n}\n\nstatic char *smscore_fw_lkup[][DEVICE_MODE_MAX] = {\n\t[SMS_NOVA_A0] = {\n\t\t[DEVICE_MODE_DVBT]\t\t= SMS_FW_DVB_NOVA_12MHZ,\n\t\t[DEVICE_MODE_DVBH]\t\t= SMS_FW_DVB_NOVA_12MHZ,\n\t\t[DEVICE_MODE_DAB_TDMB]\t\t= SMS_FW_TDMB_NOVA_12MHZ,\n\t\t[DEVICE_MODE_DVBT_BDA]\t\t= SMS_FW_DVB_NOVA_12MHZ,\n\t\t[DEVICE_MODE_ISDBT]\t\t= SMS_FW_ISDBT_NOVA_12MHZ,\n\t\t[DEVICE_MODE_ISDBT_BDA]\t\t= SMS_FW_ISDBT_NOVA_12MHZ,\n\t},\n\t[SMS_NOVA_B0] = {\n\t\t[DEVICE_MODE_DVBT]\t\t= SMS_FW_DVB_NOVA_12MHZ_B0,\n\t\t[DEVICE_MODE_DVBH]\t\t= SMS_FW_DVB_NOVA_12MHZ_B0,\n\t\t[DEVICE_MODE_DAB_TDMB]\t\t= SMS_FW_TDMB_NOVA_12MHZ_B0,\n\t\t[DEVICE_MODE_DVBT_BDA]\t\t= SMS_FW_DVB_NOVA_12MHZ_B0,\n\t\t[DEVICE_MODE_ISDBT]\t\t= SMS_FW_ISDBT_NOVA_12MHZ_B0,\n\t\t[DEVICE_MODE_ISDBT_BDA]\t\t= SMS_FW_ISDBT_NOVA_12MHZ_B0,\n\t\t[DEVICE_MODE_FM_RADIO]\t\t= SMS_FW_FM_RADIO,\n\t\t[DEVICE_MODE_FM_RADIO_BDA]\t= SMS_FW_FM_RADIO,\n\t},\n\t[SMS_VEGA] = {\n\t\t[DEVICE_MODE_CMMB]\t\t= SMS_FW_CMMB_VEGA_12MHZ,\n\t},\n\t[SMS_VENICE] = {\n\t\t[DEVICE_MODE_CMMB]\t\t= SMS_FW_CMMB_VENICE_12MHZ,\n\t},\n\t[SMS_MING] = {\n\t\t[DEVICE_MODE_CMMB]\t\t= SMS_FW_CMMB_MING_APP,\n\t},\n\t[SMS_PELE] = {\n\t\t[DEVICE_MODE_ISDBT]\t\t= SMS_FW_ISDBT_PELE,\n\t\t[DEVICE_MODE_ISDBT_BDA]\t\t= SMS_FW_ISDBT_PELE,\n\t},\n\t[SMS_RIO] = {\n\t\t[DEVICE_MODE_DVBT]\t\t= SMS_FW_DVB_RIO,\n\t\t[DEVICE_MODE_DVBH]\t\t= SMS_FW_DVBH_RIO,\n\t\t[DEVICE_MODE_DVBT_BDA]\t\t= SMS_FW_DVB_RIO,\n\t\t[DEVICE_MODE_ISDBT]\t\t= SMS_FW_ISDBT_RIO,\n\t\t[DEVICE_MODE_ISDBT_BDA]\t\t= SMS_FW_ISDBT_RIO,\n\t\t[DEVICE_MODE_FM_RADIO]\t\t= SMS_FW_FM_RADIO_RIO,\n\t\t[DEVICE_MODE_FM_RADIO_BDA]\t= SMS_FW_FM_RADIO_RIO,\n\t},\n\t[SMS_DENVER_1530] = {\n\t\t[DEVICE_MODE_ATSC]\t\t= SMS_FW_ATSC_DENVER,\n\t},\n\t[SMS_DENVER_2160] = {\n\t\t[DEVICE_MODE_DAB_TDMB]\t\t= SMS_FW_TDMB_DENVER,\n\t},\n};\n\n \nstatic char *smscore_get_fw_filename(struct smscore_device_t *coredev,\n\t\t\t      int mode)\n{\n\tchar **fw;\n\tint board_id = smscore_get_board_id(coredev);\n\tenum sms_device_type_st type;\n\n\ttype = smscore_registry_gettype(coredev->devpath);\n\n\t \n\tif (type <= SMS_UNKNOWN_TYPE || type >= SMS_NUM_OF_DEVICE_TYPES)\n\t\treturn NULL;\n\tif (mode <= DEVICE_MODE_NONE || mode >= DEVICE_MODE_MAX)\n\t\treturn NULL;\n\n\tpr_debug(\"trying to get fw name from sms_boards board_id %d mode %d\\n\",\n\t\t  board_id, mode);\n\tfw = sms_get_board(board_id)->fw;\n\tif (!fw || !fw[mode]) {\n\t\tpr_debug(\"cannot find fw name in sms_boards, getting from lookup table mode %d type %d\\n\",\n\t\t\t  mode, type);\n\t\treturn smscore_fw_lkup[type][mode];\n\t}\n\n\treturn fw[mode];\n}\n\n \nstatic int smscore_load_firmware_from_file(struct smscore_device_t *coredev,\n\t\t\t\t\t   int mode,\n\t\t\t\t\t   loadfirmware_t loadfirmware_handler)\n{\n\tint rc = -ENOENT;\n\tu8 *fw_buf;\n\tu32 fw_buf_size;\n\tconst struct firmware *fw;\n\n\tchar *fw_filename = smscore_get_fw_filename(coredev, mode);\n\tif (!fw_filename) {\n\t\tpr_err(\"mode %d not supported on this device\\n\", mode);\n\t\treturn -ENOENT;\n\t}\n\tpr_debug(\"Firmware name: %s\\n\", fw_filename);\n\n\tif (!loadfirmware_handler &&\n\t    !(coredev->device_flags & SMS_DEVICE_FAMILY2))\n\t\treturn -EINVAL;\n\n\trc = request_firmware(&fw, fw_filename, coredev->device);\n\tif (rc < 0) {\n\t\tpr_err(\"failed to open firmware file '%s'\\n\", fw_filename);\n\t\treturn rc;\n\t}\n\tpr_debug(\"read fw %s, buffer size=0x%zx\\n\", fw_filename, fw->size);\n\tfw_buf = kmalloc(ALIGN(fw->size + sizeof(struct sms_firmware),\n\t\t\t SMS_ALLOC_ALIGNMENT), GFP_KERNEL | coredev->gfp_buf_flags);\n\tif (!fw_buf) {\n\t\tpr_err(\"failed to allocate firmware buffer\\n\");\n\t\trc = -ENOMEM;\n\t} else {\n\t\tmemcpy(fw_buf, fw->data, fw->size);\n\t\tfw_buf_size = fw->size;\n\n\t\trc = (coredev->device_flags & SMS_DEVICE_FAMILY2) ?\n\t\t\tsmscore_load_firmware_family2(coredev, fw_buf, fw_buf_size)\n\t\t\t: loadfirmware_handler(coredev->context, fw_buf,\n\t\t\tfw_buf_size);\n\t}\n\n\tkfree(fw_buf);\n\trelease_firmware(fw);\n\n\treturn rc;\n}\n\n \nvoid smscore_unregister_device(struct smscore_device_t *coredev)\n{\n\tstruct smscore_buffer_t *cb;\n\tint num_buffers = 0;\n\tint retry = 0;\n\n\tmutex_lock(&g_smscore_deviceslock);\n\n\t \n\tsms_ir_exit(coredev);\n\n\tsmscore_notify_clients(coredev);\n\tsmscore_notify_callbacks(coredev, NULL, 0);\n\n\t \n\n\twhile (1) {\n\t\twhile (!list_empty(&coredev->buffers)) {\n\t\t\tcb = (struct smscore_buffer_t *) coredev->buffers.next;\n\t\t\tlist_del(&cb->entry);\n\t\t\tkfree(cb);\n\t\t\tnum_buffers++;\n\t\t}\n\t\tif (num_buffers == coredev->num_buffers)\n\t\t\tbreak;\n\t\tif (++retry > 10) {\n\t\t\tpr_info(\"exiting although not all buffers released.\\n\");\n\t\t\tbreak;\n\t\t}\n\n\t\tpr_debug(\"waiting for %d buffer(s)\\n\",\n\t\t\t coredev->num_buffers - num_buffers);\n\t\tmutex_unlock(&g_smscore_deviceslock);\n\t\tmsleep(100);\n\t\tmutex_lock(&g_smscore_deviceslock);\n\t}\n\n\tpr_debug(\"freed %d buffers\\n\", num_buffers);\n\n\tif (coredev->common_buffer) {\n\t\tif (coredev->usb_device)\n\t\t\tkfree(coredev->common_buffer);\n\t\telse\n\t\t\tdma_free_coherent(coredev->device,\n\t\t\t\t\t  coredev->common_buffer_size,\n\t\t\t\t\t  coredev->common_buffer,\n\t\t\t\t\t  coredev->common_buffer_phys);\n\t}\n\tkfree(coredev->fw_buf);\n\n\tlist_del(&coredev->entry);\n\tkfree(coredev);\n\n\tmutex_unlock(&g_smscore_deviceslock);\n\n\tpr_debug(\"device %p destroyed\\n\", coredev);\n}\nEXPORT_SYMBOL_GPL(smscore_unregister_device);\n\nstatic int smscore_detect_mode(struct smscore_device_t *coredev)\n{\n\tvoid *buffer = kmalloc(sizeof(struct sms_msg_hdr) + SMS_DMA_ALIGNMENT,\n\t\t\t       GFP_KERNEL | coredev->gfp_buf_flags);\n\tstruct sms_msg_hdr *msg =\n\t\t(struct sms_msg_hdr *) SMS_ALIGN_ADDRESS(buffer);\n\tint rc;\n\n\tif (!buffer)\n\t\treturn -ENOMEM;\n\n\tSMS_INIT_MSG(msg, MSG_SMS_GET_VERSION_EX_REQ,\n\t\t     sizeof(struct sms_msg_hdr));\n\n\trc = smscore_sendrequest_and_wait(coredev, msg, msg->msg_length,\n\t\t\t\t\t  &coredev->version_ex_done);\n\tif (rc == -ETIME) {\n\t\tpr_err(\"MSG_SMS_GET_VERSION_EX_REQ failed first try\\n\");\n\n\t\tif (wait_for_completion_timeout(&coredev->resume_done,\n\t\t\t\t\t\tmsecs_to_jiffies(5000))) {\n\t\t\trc = smscore_sendrequest_and_wait(\n\t\t\t\tcoredev, msg, msg->msg_length,\n\t\t\t\t&coredev->version_ex_done);\n\t\t\tif (rc < 0)\n\t\t\t\tpr_err(\"MSG_SMS_GET_VERSION_EX_REQ failed second try, rc %d\\n\",\n\t\t\t\t\trc);\n\t\t} else\n\t\t\trc = -ETIME;\n\t}\n\n\tkfree(buffer);\n\n\treturn rc;\n}\n\n \nstatic int smscore_init_device(struct smscore_device_t *coredev, int mode)\n{\n\tvoid *buffer;\n\tstruct sms_msg_data *msg;\n\tint rc = 0;\n\n\tbuffer = kmalloc(sizeof(struct sms_msg_data) +\n\t\t\tSMS_DMA_ALIGNMENT, GFP_KERNEL | coredev->gfp_buf_flags);\n\tif (!buffer)\n\t\treturn -ENOMEM;\n\n\tmsg = (struct sms_msg_data *)SMS_ALIGN_ADDRESS(buffer);\n\tSMS_INIT_MSG(&msg->x_msg_header, MSG_SMS_INIT_DEVICE_REQ,\n\t\t\tsizeof(struct sms_msg_data));\n\tmsg->msg_data[0] = mode;\n\n\trc = smscore_sendrequest_and_wait(coredev, msg,\n\t\t\tmsg->x_msg_header. msg_length,\n\t\t\t&coredev->init_device_done);\n\n\tkfree(buffer);\n\treturn rc;\n}\n\n \nint smscore_set_device_mode(struct smscore_device_t *coredev, int mode)\n{\n\tint rc = 0;\n\n\tpr_debug(\"set device mode to %d\\n\", mode);\n\tif (coredev->device_flags & SMS_DEVICE_FAMILY2) {\n\t\tif (mode <= DEVICE_MODE_NONE || mode >= DEVICE_MODE_MAX) {\n\t\t\tpr_err(\"invalid mode specified %d\\n\", mode);\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tsmscore_registry_setmode(coredev->devpath, mode);\n\n\t\tif (!(coredev->device_flags & SMS_DEVICE_NOT_READY)) {\n\t\t\trc = smscore_detect_mode(coredev);\n\t\t\tif (rc < 0) {\n\t\t\t\tpr_err(\"mode detect failed %d\\n\", rc);\n\t\t\t\treturn rc;\n\t\t\t}\n\t\t}\n\n\t\tif (coredev->mode == mode) {\n\t\t\tpr_debug(\"device mode %d already set\\n\", mode);\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (!(coredev->modes_supported & (1 << mode))) {\n\t\t\trc = smscore_load_firmware_from_file(coredev,\n\t\t\t\t\t\t\t     mode, NULL);\n\t\t\tif (rc >= 0)\n\t\t\t\tpr_debug(\"firmware download success\\n\");\n\t\t} else {\n\t\t\tpr_debug(\"mode %d is already supported by running firmware\\n\",\n\t\t\t\t mode);\n\t\t}\n\t\tif (coredev->fw_version >= 0x800) {\n\t\t\trc = smscore_init_device(coredev, mode);\n\t\t\tif (rc < 0)\n\t\t\t\tpr_err(\"device init failed, rc %d.\\n\", rc);\n\t\t}\n\t} else {\n\t\tif (mode <= DEVICE_MODE_NONE || mode >= DEVICE_MODE_MAX) {\n\t\t\tpr_err(\"invalid mode specified %d\\n\", mode);\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tsmscore_registry_setmode(coredev->devpath, mode);\n\n\t\tif (coredev->detectmode_handler)\n\t\t\tcoredev->detectmode_handler(coredev->context,\n\t\t\t\t\t\t    &coredev->mode);\n\n\t\tif (coredev->mode != mode && coredev->setmode_handler)\n\t\t\trc = coredev->setmode_handler(coredev->context, mode);\n\t}\n\n\tif (rc >= 0) {\n\t\tchar *buffer;\n\t\tcoredev->mode = mode;\n\t\tcoredev->device_flags &= ~SMS_DEVICE_NOT_READY;\n\n\t\tbuffer = kmalloc(sizeof(struct sms_msg_data) +\n\t\t\t\t SMS_DMA_ALIGNMENT, GFP_KERNEL | coredev->gfp_buf_flags);\n\t\tif (buffer) {\n\t\t\tstruct sms_msg_data *msg = (struct sms_msg_data *) SMS_ALIGN_ADDRESS(buffer);\n\n\t\t\tSMS_INIT_MSG(&msg->x_msg_header, MSG_SMS_INIT_DEVICE_REQ,\n\t\t\t\t     sizeof(struct sms_msg_data));\n\t\t\tmsg->msg_data[0] = mode;\n\n\t\t\trc = smscore_sendrequest_and_wait(\n\t\t\t\tcoredev, msg, msg->x_msg_header.msg_length,\n\t\t\t\t&coredev->init_device_done);\n\n\t\t\tkfree(buffer);\n\t\t}\n\t}\n\n\tif (rc < 0)\n\t\tpr_err(\"return error code %d.\\n\", rc);\n\telse\n\t\tpr_debug(\"Success setting device mode.\\n\");\n\n\treturn rc;\n}\n\n \nint smscore_get_device_mode(struct smscore_device_t *coredev)\n{\n\treturn coredev->mode;\n}\nEXPORT_SYMBOL_GPL(smscore_get_device_mode);\n\n \nstatic struct\nsmscore_client_t *smscore_find_client(struct smscore_device_t *coredev,\n\t\t\t\t      int data_type, int id)\n{\n\tstruct list_head *first;\n\tstruct smscore_client_t *client;\n\tunsigned long flags;\n\tstruct list_head *firstid;\n\tstruct smscore_idlist_t *client_id;\n\n\tspin_lock_irqsave(&coredev->clientslock, flags);\n\tfirst = &coredev->clients;\n\tlist_for_each_entry(client, first, entry) {\n\t\tfirstid = &client->idlist;\n\t\tlist_for_each_entry(client_id, firstid, entry) {\n\t\t\tif ((client_id->id == id) &&\n\t\t\t    (client_id->data_type == data_type ||\n\t\t\t    (client_id->data_type == 0)))\n\t\t\t\tgoto found;\n\t\t}\n\t}\n\tclient = NULL;\nfound:\n\tspin_unlock_irqrestore(&coredev->clientslock, flags);\n\treturn client;\n}\n\n \nvoid smscore_onresponse(struct smscore_device_t *coredev,\n\t\tstruct smscore_buffer_t *cb) {\n\tstruct sms_msg_hdr *phdr = (struct sms_msg_hdr *) ((u8 *) cb->p\n\t\t\t+ cb->offset);\n\tstruct smscore_client_t *client;\n\tint rc = -EBUSY;\n\tstatic unsigned long last_sample_time;  \n\tstatic int data_total;  \n\tunsigned long time_now = jiffies_to_msecs(jiffies);\n\n\tif (!last_sample_time)\n\t\tlast_sample_time = time_now;\n\n\tif (time_now - last_sample_time > 10000) {\n\t\tpr_debug(\"data rate %d bytes/secs\\n\",\n\t\t\t  (int)((data_total * 1000) /\n\t\t\t\t(time_now - last_sample_time)));\n\n\t\tlast_sample_time = time_now;\n\t\tdata_total = 0;\n\t}\n\n\tdata_total += cb->size;\n\t \n\tif ((phdr->msg_type == MSG_SMS_HO_PER_SLICES_IND) ||\n\t\t\t(phdr->msg_type == MSG_SMS_TRANSMISSION_IND)) {\n\t\tif (coredev->mode == DEVICE_MODE_DVBT_BDA)\n\t\t\tphdr->msg_dst_id = DVBT_BDA_CONTROL_MSG_ID;\n\t}\n\n\n\tclient = smscore_find_client(coredev, phdr->msg_type, phdr->msg_dst_id);\n\n\t \n\tif (client)\n\t\trc = client->onresponse_handler(client->context, cb);\n\n\tif (rc < 0) {\n\t\tswitch (phdr->msg_type) {\n\t\tcase MSG_SMS_ISDBT_TUNE_RES:\n\t\t\tbreak;\n\t\tcase MSG_SMS_RF_TUNE_RES:\n\t\t\tbreak;\n\t\tcase MSG_SMS_SIGNAL_DETECTED_IND:\n\t\t\tbreak;\n\t\tcase MSG_SMS_NO_SIGNAL_IND:\n\t\t\tbreak;\n\t\tcase MSG_SMS_SPI_INT_LINE_SET_RES:\n\t\t\tbreak;\n\t\tcase MSG_SMS_INTERFACE_LOCK_IND:\n\t\t\tbreak;\n\t\tcase MSG_SMS_INTERFACE_UNLOCK_IND:\n\t\t\tbreak;\n\t\tcase MSG_SMS_GET_VERSION_EX_RES:\n\t\t{\n\t\t\tstruct sms_version_res *ver =\n\t\t\t\t(struct sms_version_res *) phdr;\n\t\t\tpr_debug(\"Firmware id %d prots 0x%x ver %d.%d\\n\",\n\t\t\t\t  ver->firmware_id, ver->supported_protocols,\n\t\t\t\t  ver->rom_ver_major, ver->rom_ver_minor);\n\n\t\t\tcoredev->mode = ver->firmware_id == 255 ?\n\t\t\t\tDEVICE_MODE_NONE : ver->firmware_id;\n\t\t\tcoredev->modes_supported = ver->supported_protocols;\n\t\t\tcoredev->fw_version = ver->rom_ver_major << 8 |\n\t\t\t\t\t      ver->rom_ver_minor;\n\n\t\t\tcomplete(&coredev->version_ex_done);\n\t\t\tbreak;\n\t\t}\n\t\tcase MSG_SMS_INIT_DEVICE_RES:\n\t\t\tcomplete(&coredev->init_device_done);\n\t\t\tbreak;\n\t\tcase MSG_SW_RELOAD_START_RES:\n\t\t\tcomplete(&coredev->reload_start_done);\n\t\t\tbreak;\n\t\tcase MSG_SMS_DATA_VALIDITY_RES:\n\t\t{\n\t\t\tstruct sms_msg_data *validity = (struct sms_msg_data *) phdr;\n\n\t\t\tpr_debug(\"MSG_SMS_DATA_VALIDITY_RES, checksum = 0x%x\\n\",\n\t\t\t\tvalidity->msg_data[0]);\n\t\t\tcomplete(&coredev->data_validity_done);\n\t\t\tbreak;\n\t\t}\n\t\tcase MSG_SMS_DATA_DOWNLOAD_RES:\n\t\t\tcomplete(&coredev->data_download_done);\n\t\t\tbreak;\n\t\tcase MSG_SW_RELOAD_EXEC_RES:\n\t\t\tbreak;\n\t\tcase MSG_SMS_SWDOWNLOAD_TRIGGER_RES:\n\t\t\tcomplete(&coredev->trigger_done);\n\t\t\tbreak;\n\t\tcase MSG_SMS_SLEEP_RESUME_COMP_IND:\n\t\t\tcomplete(&coredev->resume_done);\n\t\t\tbreak;\n\t\tcase MSG_SMS_GPIO_CONFIG_EX_RES:\n\t\t\tcomplete(&coredev->gpio_configuration_done);\n\t\t\tbreak;\n\t\tcase MSG_SMS_GPIO_SET_LEVEL_RES:\n\t\t\tcomplete(&coredev->gpio_set_level_done);\n\t\t\tbreak;\n\t\tcase MSG_SMS_GPIO_GET_LEVEL_RES:\n\t\t{\n\t\t\tu32 *msgdata = (u32 *) phdr;\n\t\t\tcoredev->gpio_get_res = msgdata[1];\n\t\t\tpr_debug(\"gpio level %d\\n\",\n\t\t\t\t\tcoredev->gpio_get_res);\n\t\t\tcomplete(&coredev->gpio_get_level_done);\n\t\t\tbreak;\n\t\t}\n\t\tcase MSG_SMS_START_IR_RES:\n\t\t\tcomplete(&coredev->ir_init_done);\n\t\t\tbreak;\n\t\tcase MSG_SMS_IR_SAMPLES_IND:\n\t\t\tsms_ir_event(coredev,\n\t\t\t\t(const char *)\n\t\t\t\t((char *)phdr\n\t\t\t\t+ sizeof(struct sms_msg_hdr)),\n\t\t\t\t(int)phdr->msg_length\n\t\t\t\t- sizeof(struct sms_msg_hdr));\n\t\t\tbreak;\n\n\t\tcase MSG_SMS_DVBT_BDA_DATA:\n\t\t\t \n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tpr_debug(\"message %s(%d) not handled.\\n\",\n\t\t\t\t  smscore_translate_msg(phdr->msg_type),\n\t\t\t\t  phdr->msg_type);\n\t\t\tbreak;\n\t\t}\n\t\tsmscore_putbuffer(coredev, cb);\n\t}\n}\nEXPORT_SYMBOL_GPL(smscore_onresponse);\n\n \n\nstatic struct smscore_buffer_t *get_entry(struct smscore_device_t *coredev)\n{\n\tstruct smscore_buffer_t *cb = NULL;\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&coredev->bufferslock, flags);\n\tif (!list_empty(&coredev->buffers)) {\n\t\tcb = (struct smscore_buffer_t *) coredev->buffers.next;\n\t\tlist_del(&cb->entry);\n\t}\n\tspin_unlock_irqrestore(&coredev->bufferslock, flags);\n\treturn cb;\n}\n\nstruct smscore_buffer_t *smscore_getbuffer(struct smscore_device_t *coredev)\n{\n\tstruct smscore_buffer_t *cb = NULL;\n\n\twait_event(coredev->buffer_mng_waitq, (cb = get_entry(coredev)));\n\n\treturn cb;\n}\nEXPORT_SYMBOL_GPL(smscore_getbuffer);\n\n \nvoid smscore_putbuffer(struct smscore_device_t *coredev,\n\t\tstruct smscore_buffer_t *cb) {\n\twake_up_interruptible(&coredev->buffer_mng_waitq);\n\tlist_add_locked(&cb->entry, &coredev->buffers, &coredev->bufferslock);\n}\nEXPORT_SYMBOL_GPL(smscore_putbuffer);\n\nstatic int smscore_validate_client(struct smscore_device_t *coredev,\n\t\t\t\t   struct smscore_client_t *client,\n\t\t\t\t   int data_type, int id)\n{\n\tstruct smscore_idlist_t *listentry;\n\tstruct smscore_client_t *registered_client;\n\n\tif (!client) {\n\t\tpr_err(\"bad parameter.\\n\");\n\t\treturn -EINVAL;\n\t}\n\tregistered_client = smscore_find_client(coredev, data_type, id);\n\tif (registered_client == client)\n\t\treturn 0;\n\n\tif (registered_client) {\n\t\tpr_err(\"The msg ID already registered to another client.\\n\");\n\t\treturn -EEXIST;\n\t}\n\tlistentry = kzalloc(sizeof(*listentry), GFP_KERNEL);\n\tif (!listentry)\n\t\treturn -ENOMEM;\n\n\tlistentry->id = id;\n\tlistentry->data_type = data_type;\n\tlist_add_locked(&listentry->entry, &client->idlist,\n\t\t\t&coredev->clientslock);\n\treturn 0;\n}\n\n \nint smscore_register_client(struct smscore_device_t *coredev,\n\t\t\t    struct smsclient_params_t *params,\n\t\t\t    struct smscore_client_t **client)\n{\n\tstruct smscore_client_t *newclient;\n\t \n\tif (smscore_find_client(coredev, params->data_type,\n\t\t\t\tparams->initial_id)) {\n\t\tpr_err(\"Client already exist.\\n\");\n\t\treturn -EEXIST;\n\t}\n\n\tnewclient = kzalloc(sizeof(*newclient), GFP_KERNEL);\n\tif (!newclient)\n\t\treturn -ENOMEM;\n\n\tINIT_LIST_HEAD(&newclient->idlist);\n\tnewclient->coredev = coredev;\n\tnewclient->onresponse_handler = params->onresponse_handler;\n\tnewclient->onremove_handler = params->onremove_handler;\n\tnewclient->context = params->context;\n\tlist_add_locked(&newclient->entry, &coredev->clients,\n\t\t\t&coredev->clientslock);\n\tsmscore_validate_client(coredev, newclient, params->data_type,\n\t\t\t\tparams->initial_id);\n\t*client = newclient;\n\tpr_debug(\"%p %d %d\\n\", params->context, params->data_type,\n\t\t  params->initial_id);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(smscore_register_client);\n\n \nvoid smscore_unregister_client(struct smscore_client_t *client)\n{\n\tstruct smscore_device_t *coredev = client->coredev;\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&coredev->clientslock, flags);\n\n\n\twhile (!list_empty(&client->idlist)) {\n\t\tstruct smscore_idlist_t *identry =\n\t\t\t(struct smscore_idlist_t *) client->idlist.next;\n\t\tlist_del(&identry->entry);\n\t\tkfree(identry);\n\t}\n\n\tpr_debug(\"%p\\n\", client->context);\n\n\tlist_del(&client->entry);\n\tkfree(client);\n\n\tspin_unlock_irqrestore(&coredev->clientslock, flags);\n}\nEXPORT_SYMBOL_GPL(smscore_unregister_client);\n\n \nint smsclient_sendrequest(struct smscore_client_t *client,\n\t\t\t  void *buffer, size_t size)\n{\n\tstruct smscore_device_t *coredev;\n\tstruct sms_msg_hdr *phdr = (struct sms_msg_hdr *) buffer;\n\tint rc;\n\n\tif (!client) {\n\t\tpr_err(\"Got NULL client\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tcoredev = client->coredev;\n\n\t \n\tif (!coredev) {\n\t\tpr_err(\"Got NULL coredev\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\trc = smscore_validate_client(client->coredev, client, 0,\n\t\t\t\t     phdr->msg_src_id);\n\tif (rc < 0)\n\t\treturn rc;\n\n\treturn coredev->sendrequest_handler(coredev->context, buffer, size);\n}\nEXPORT_SYMBOL_GPL(smsclient_sendrequest);\n\n\n \nint smscore_configure_gpio(struct smscore_device_t *coredev, u32 pin,\n\t\t\t   struct smscore_config_gpio *pinconfig)\n{\n\tstruct {\n\t\tstruct sms_msg_hdr hdr;\n\t\tu32 data[6];\n\t} msg;\n\n\tif (coredev->device_flags & SMS_DEVICE_FAMILY2) {\n\t\tmsg.hdr.msg_src_id = DVBT_BDA_CONTROL_MSG_ID;\n\t\tmsg.hdr.msg_dst_id = HIF_TASK;\n\t\tmsg.hdr.msg_flags = 0;\n\t\tmsg.hdr.msg_type  = MSG_SMS_GPIO_CONFIG_EX_REQ;\n\t\tmsg.hdr.msg_length = sizeof(msg);\n\n\t\tmsg.data[0] = pin;\n\t\tmsg.data[1] = pinconfig->pullupdown;\n\n\t\t \n\t\tmsg.data[2] = pinconfig->outputslewrate == 0 ? 3 : 0;\n\n\t\tswitch (pinconfig->outputdriving) {\n\t\tcase SMS_GPIO_OUTPUTDRIVING_S_16mA:\n\t\t\tmsg.data[3] = 7;  \n\t\t\tbreak;\n\t\tcase SMS_GPIO_OUTPUTDRIVING_S_12mA:\n\t\t\tmsg.data[3] = 5;  \n\t\t\tbreak;\n\t\tcase SMS_GPIO_OUTPUTDRIVING_S_8mA:\n\t\t\tmsg.data[3] = 3;  \n\t\t\tbreak;\n\t\tcase SMS_GPIO_OUTPUTDRIVING_S_4mA:\n\t\tdefault:\n\t\t\tmsg.data[3] = 2;  \n\t\t\tbreak;\n\t\t}\n\n\t\tmsg.data[4] = pinconfig->direction;\n\t\tmsg.data[5] = 0;\n\t} else  \n\t\treturn -EINVAL;\n\n\treturn coredev->sendrequest_handler(coredev->context,\n\t\t\t\t\t    &msg, sizeof(msg));\n}\n\nint smscore_set_gpio(struct smscore_device_t *coredev, u32 pin, int level)\n{\n\tstruct {\n\t\tstruct sms_msg_hdr hdr;\n\t\tu32 data[3];\n\t} msg;\n\n\tif (pin > MAX_GPIO_PIN_NUMBER)\n\t\treturn -EINVAL;\n\n\tmsg.hdr.msg_src_id = DVBT_BDA_CONTROL_MSG_ID;\n\tmsg.hdr.msg_dst_id = HIF_TASK;\n\tmsg.hdr.msg_flags = 0;\n\tmsg.hdr.msg_type  = MSG_SMS_GPIO_SET_LEVEL_REQ;\n\tmsg.hdr.msg_length = sizeof(msg);\n\n\tmsg.data[0] = pin;\n\tmsg.data[1] = level ? 1 : 0;\n\tmsg.data[2] = 0;\n\n\treturn coredev->sendrequest_handler(coredev->context,\n\t\t\t\t\t    &msg, sizeof(msg));\n}\n\n \nstatic int get_gpio_pin_params(u32 pin_num, u32 *p_translatedpin_num,\n\t\tu32 *p_group_num, u32 *p_group_cfg) {\n\n\t*p_group_cfg = 1;\n\n\tif (pin_num <= 1)\t{\n\t\t*p_translatedpin_num = 0;\n\t\t*p_group_num = 9;\n\t\t*p_group_cfg = 2;\n\t} else if (pin_num >= 2 && pin_num <= 6) {\n\t\t*p_translatedpin_num = 2;\n\t\t*p_group_num = 0;\n\t\t*p_group_cfg = 2;\n\t} else if (pin_num >= 7 && pin_num <= 11) {\n\t\t*p_translatedpin_num = 7;\n\t\t*p_group_num = 1;\n\t} else if (pin_num >= 12 && pin_num <= 15) {\n\t\t*p_translatedpin_num = 12;\n\t\t*p_group_num = 2;\n\t\t*p_group_cfg = 3;\n\t} else if (pin_num == 16) {\n\t\t*p_translatedpin_num = 16;\n\t\t*p_group_num = 23;\n\t} else if (pin_num >= 17 && pin_num <= 24) {\n\t\t*p_translatedpin_num = 17;\n\t\t*p_group_num = 3;\n\t} else if (pin_num == 25) {\n\t\t*p_translatedpin_num = 25;\n\t\t*p_group_num = 6;\n\t} else if (pin_num >= 26 && pin_num <= 28) {\n\t\t*p_translatedpin_num = 26;\n\t\t*p_group_num = 4;\n\t} else if (pin_num == 29) {\n\t\t*p_translatedpin_num = 29;\n\t\t*p_group_num = 5;\n\t\t*p_group_cfg = 2;\n\t} else if (pin_num == 30) {\n\t\t*p_translatedpin_num = 30;\n\t\t*p_group_num = 8;\n\t} else if (pin_num == 31) {\n\t\t*p_translatedpin_num = 31;\n\t\t*p_group_num = 17;\n\t} else\n\t\treturn -1;\n\n\t*p_group_cfg <<= 24;\n\n\treturn 0;\n}\n\nint smscore_gpio_configure(struct smscore_device_t *coredev, u8 pin_num,\n\t\tstruct smscore_config_gpio *p_gpio_config) {\n\n\tu32 total_len;\n\tu32 translatedpin_num = 0;\n\tu32 group_num = 0;\n\tu32 electric_char;\n\tu32 group_cfg;\n\tvoid *buffer;\n\tint rc;\n\n\tstruct set_gpio_msg {\n\t\tstruct sms_msg_hdr x_msg_header;\n\t\tu32 msg_data[6];\n\t} *p_msg;\n\n\n\tif (pin_num > MAX_GPIO_PIN_NUMBER)\n\t\treturn -EINVAL;\n\n\tif (!p_gpio_config)\n\t\treturn -EINVAL;\n\n\ttotal_len = sizeof(struct sms_msg_hdr) + (sizeof(u32) * 6);\n\n\tbuffer = kmalloc(total_len + SMS_DMA_ALIGNMENT,\n\t\t\tGFP_KERNEL | coredev->gfp_buf_flags);\n\tif (!buffer)\n\t\treturn -ENOMEM;\n\n\tp_msg = (struct set_gpio_msg *) SMS_ALIGN_ADDRESS(buffer);\n\n\tp_msg->x_msg_header.msg_src_id = DVBT_BDA_CONTROL_MSG_ID;\n\tp_msg->x_msg_header.msg_dst_id = HIF_TASK;\n\tp_msg->x_msg_header.msg_flags = 0;\n\tp_msg->x_msg_header.msg_length = (u16) total_len;\n\tp_msg->msg_data[0] = pin_num;\n\n\tif (!(coredev->device_flags & SMS_DEVICE_FAMILY2)) {\n\t\tp_msg->x_msg_header.msg_type = MSG_SMS_GPIO_CONFIG_REQ;\n\t\tif (get_gpio_pin_params(pin_num, &translatedpin_num, &group_num,\n\t\t\t\t&group_cfg) != 0) {\n\t\t\trc = -EINVAL;\n\t\t\tgoto free;\n\t\t}\n\n\t\tp_msg->msg_data[1] = translatedpin_num;\n\t\tp_msg->msg_data[2] = group_num;\n\t\telectric_char = (p_gpio_config->pullupdown)\n\t\t\t\t| (p_gpio_config->inputcharacteristics << 2)\n\t\t\t\t| (p_gpio_config->outputslewrate << 3)\n\t\t\t\t| (p_gpio_config->outputdriving << 4);\n\t\tp_msg->msg_data[3] = electric_char;\n\t\tp_msg->msg_data[4] = p_gpio_config->direction;\n\t\tp_msg->msg_data[5] = group_cfg;\n\t} else {\n\t\tp_msg->x_msg_header.msg_type = MSG_SMS_GPIO_CONFIG_EX_REQ;\n\t\tp_msg->msg_data[1] = p_gpio_config->pullupdown;\n\t\tp_msg->msg_data[2] = p_gpio_config->outputslewrate;\n\t\tp_msg->msg_data[3] = p_gpio_config->outputdriving;\n\t\tp_msg->msg_data[4] = p_gpio_config->direction;\n\t\tp_msg->msg_data[5] = 0;\n\t}\n\n\trc = smscore_sendrequest_and_wait(coredev, p_msg, total_len,\n\t\t\t&coredev->gpio_configuration_done);\n\n\tif (rc != 0) {\n\t\tif (rc == -ETIME)\n\t\t\tpr_err(\"smscore_gpio_configure timeout\\n\");\n\t\telse\n\t\t\tpr_err(\"smscore_gpio_configure error\\n\");\n\t}\nfree:\n\tkfree(buffer);\n\n\treturn rc;\n}\n\nint smscore_gpio_set_level(struct smscore_device_t *coredev, u8 pin_num,\n\t\tu8 new_level) {\n\n\tu32 total_len;\n\tint rc;\n\tvoid *buffer;\n\n\tstruct set_gpio_msg {\n\t\tstruct sms_msg_hdr x_msg_header;\n\t\tu32 msg_data[3];  \n\t} *p_msg;\n\n\tif ((new_level > 1) || (pin_num > MAX_GPIO_PIN_NUMBER))\n\t\treturn -EINVAL;\n\n\ttotal_len = sizeof(struct sms_msg_hdr) +\n\t\t\t(3 * sizeof(u32));  \n\n\tbuffer = kmalloc(total_len + SMS_DMA_ALIGNMENT,\n\t\t\tGFP_KERNEL | coredev->gfp_buf_flags);\n\tif (!buffer)\n\t\treturn -ENOMEM;\n\n\tp_msg = (struct set_gpio_msg *) SMS_ALIGN_ADDRESS(buffer);\n\n\tp_msg->x_msg_header.msg_src_id = DVBT_BDA_CONTROL_MSG_ID;\n\tp_msg->x_msg_header.msg_dst_id = HIF_TASK;\n\tp_msg->x_msg_header.msg_flags = 0;\n\tp_msg->x_msg_header.msg_type = MSG_SMS_GPIO_SET_LEVEL_REQ;\n\tp_msg->x_msg_header.msg_length = (u16) total_len;\n\tp_msg->msg_data[0] = pin_num;\n\tp_msg->msg_data[1] = new_level;\n\n\t \n\trc = smscore_sendrequest_and_wait(coredev, p_msg, total_len,\n\t\t\t&coredev->gpio_set_level_done);\n\n\tif (rc != 0) {\n\t\tif (rc == -ETIME)\n\t\t\tpr_err(\"smscore_gpio_set_level timeout\\n\");\n\t\telse\n\t\t\tpr_err(\"smscore_gpio_set_level error\\n\");\n\t}\n\tkfree(buffer);\n\n\treturn rc;\n}\n\nint smscore_gpio_get_level(struct smscore_device_t *coredev, u8 pin_num,\n\t\tu8 *level) {\n\n\tu32 total_len;\n\tint rc;\n\tvoid *buffer;\n\n\tstruct set_gpio_msg {\n\t\tstruct sms_msg_hdr x_msg_header;\n\t\tu32 msg_data[2];\n\t} *p_msg;\n\n\n\tif (pin_num > MAX_GPIO_PIN_NUMBER)\n\t\treturn -EINVAL;\n\n\ttotal_len = sizeof(struct sms_msg_hdr) + (2 * sizeof(u32));\n\n\tbuffer = kmalloc(total_len + SMS_DMA_ALIGNMENT,\n\t\t\tGFP_KERNEL | coredev->gfp_buf_flags);\n\tif (!buffer)\n\t\treturn -ENOMEM;\n\n\tp_msg = (struct set_gpio_msg *) SMS_ALIGN_ADDRESS(buffer);\n\n\tp_msg->x_msg_header.msg_src_id = DVBT_BDA_CONTROL_MSG_ID;\n\tp_msg->x_msg_header.msg_dst_id = HIF_TASK;\n\tp_msg->x_msg_header.msg_flags = 0;\n\tp_msg->x_msg_header.msg_type = MSG_SMS_GPIO_GET_LEVEL_REQ;\n\tp_msg->x_msg_header.msg_length = (u16) total_len;\n\tp_msg->msg_data[0] = pin_num;\n\tp_msg->msg_data[1] = 0;\n\n\t \n\trc = smscore_sendrequest_and_wait(coredev, p_msg, total_len,\n\t\t\t&coredev->gpio_get_level_done);\n\n\tif (rc != 0) {\n\t\tif (rc == -ETIME)\n\t\t\tpr_err(\"smscore_gpio_get_level timeout\\n\");\n\t\telse\n\t\t\tpr_err(\"smscore_gpio_get_level error\\n\");\n\t}\n\tkfree(buffer);\n\n\t \n\t*level = coredev->gpio_get_res;\n\n\treturn rc;\n}\n\nstatic int __init smscore_module_init(void)\n{\n\tINIT_LIST_HEAD(&g_smscore_notifyees);\n\tINIT_LIST_HEAD(&g_smscore_devices);\n\tINIT_LIST_HEAD(&g_smscore_registry);\n\n\treturn 0;\n}\n\nstatic void __exit smscore_module_exit(void)\n{\n\tmutex_lock(&g_smscore_deviceslock);\n\twhile (!list_empty(&g_smscore_notifyees)) {\n\t\tstruct smscore_device_notifyee_t *notifyee =\n\t\t\t(struct smscore_device_notifyee_t *)\n\t\t\t\tg_smscore_notifyees.next;\n\n\t\tlist_del(&notifyee->entry);\n\t\tkfree(notifyee);\n\t}\n\tmutex_unlock(&g_smscore_deviceslock);\n\n\tmutex_lock(&g_smscore_registrylock);\n\twhile (!list_empty(&g_smscore_registry)) {\n\t\tstruct smscore_registry_entry_t *entry =\n\t\t\t(struct smscore_registry_entry_t *)\n\t\t\t\tg_smscore_registry.next;\n\n\t\tlist_del(&entry->entry);\n\t\tkfree(entry);\n\t}\n\tmutex_unlock(&g_smscore_registrylock);\n\n\tpr_debug(\"\\n\");\n}\n\nmodule_init(smscore_module_init);\nmodule_exit(smscore_module_exit);\n\nMODULE_DESCRIPTION(\"Siano MDTV Core module\");\nMODULE_AUTHOR(\"Siano Mobile Silicon, Inc. (uris@siano-ms.com)\");\nMODULE_LICENSE(\"GPL\");\n\n \nMODULE_FIRMWARE(SMS_FW_ATSC_DENVER);\nMODULE_FIRMWARE(SMS_FW_CMMB_MING_APP);\nMODULE_FIRMWARE(SMS_FW_CMMB_VEGA_12MHZ);\nMODULE_FIRMWARE(SMS_FW_CMMB_VENICE_12MHZ);\nMODULE_FIRMWARE(SMS_FW_DVBH_RIO);\nMODULE_FIRMWARE(SMS_FW_DVB_NOVA_12MHZ_B0);\nMODULE_FIRMWARE(SMS_FW_DVB_NOVA_12MHZ);\nMODULE_FIRMWARE(SMS_FW_DVB_RIO);\nMODULE_FIRMWARE(SMS_FW_FM_RADIO);\nMODULE_FIRMWARE(SMS_FW_FM_RADIO_RIO);\nMODULE_FIRMWARE(SMS_FW_DVBT_HCW_55XXX);\nMODULE_FIRMWARE(SMS_FW_ISDBT_HCW_55XXX);\nMODULE_FIRMWARE(SMS_FW_ISDBT_NOVA_12MHZ_B0);\nMODULE_FIRMWARE(SMS_FW_ISDBT_NOVA_12MHZ);\nMODULE_FIRMWARE(SMS_FW_ISDBT_PELE);\nMODULE_FIRMWARE(SMS_FW_ISDBT_RIO);\nMODULE_FIRMWARE(SMS_FW_DVBT_NOVA_A);\nMODULE_FIRMWARE(SMS_FW_DVBT_NOVA_B);\nMODULE_FIRMWARE(SMS_FW_DVBT_STELLAR);\nMODULE_FIRMWARE(SMS_FW_TDMB_DENVER);\nMODULE_FIRMWARE(SMS_FW_TDMB_NOVA_12MHZ_B0);\nMODULE_FIRMWARE(SMS_FW_TDMB_NOVA_12MHZ);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}