{
  "module_name": "cx23885-f300.c",
  "hash_id": "22e9aa531260dd92c84a3ba306e261003958ba5cf005095e5c6f024f30fb01b7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/cx23885/cx23885-f300.c",
  "human_readable_source": "\n \n\n#include \"cx23885.h\"\n#include \"cx23885-f300.h\"\n\n#define F300_DATA\tGPIO_0\n#define F300_RESET\tGPIO_1\n#define F300_CLK\tGPIO_2\n#define F300_BUSY\tGPIO_3\n\nstatic void f300_set_line(struct cx23885_dev *dev, u32 line, u8 lvl)\n{\n\tcx23885_gpio_enable(dev, line, 1);\n\tif (lvl == 1)\n\t\tcx23885_gpio_set(dev, line);\n\telse\n\t\tcx23885_gpio_clear(dev, line);\n}\n\nstatic u8 f300_get_line(struct cx23885_dev *dev, u32 line)\n{\n\tcx23885_gpio_enable(dev, line, 0);\n\n\treturn cx23885_gpio_get(dev, line);\n}\n\nstatic void f300_send_byte(struct cx23885_dev *dev, u8 dta)\n{\n\tu8 i;\n\n\tfor (i = 0; i < 8; i++) {\n\t\tf300_set_line(dev, F300_CLK, 0);\n\t\tudelay(30);\n\t\tf300_set_line(dev, F300_DATA, (dta & 0x80) >> 7); \n\t\tudelay(30);\n\t\tdta <<= 1;\n\t\tf300_set_line(dev, F300_CLK, 1);\n\t\tudelay(30);\n\t}\n}\n\nstatic u8 f300_get_byte(struct cx23885_dev *dev)\n{\n\tu8 i, dta = 0;\n\n\tfor (i = 0; i < 8; i++) {\n\t\tf300_set_line(dev, F300_CLK, 0);\n\t\tudelay(30);\n\t\tdta <<= 1;\n\t\tf300_set_line(dev, F300_CLK, 1);\n\t\tudelay(30);\n\t\tdta |= f300_get_line(dev, F300_DATA); \n\n\t}\n\n\treturn dta;\n}\n\nstatic u8 f300_xfer(struct dvb_frontend *fe, u8 *buf)\n{\n\tstruct cx23885_tsport *port = fe->dvb->priv;\n\tstruct cx23885_dev *dev = port->dev;\n\tu8 i, temp, ret = 0;\n\n\ttemp = buf[0];\n\tfor (i = 0; i < buf[0]; i++)\n\t\ttemp += buf[i + 1];\n\ttemp = (~temp + 1); \n\tbuf[1 + buf[0]] = temp;\n\n\tf300_set_line(dev, F300_RESET, 1);\n\tf300_set_line(dev, F300_CLK, 1);\n\tudelay(30);\n\tf300_set_line(dev, F300_DATA, 1);\n\tmsleep(1);\n\n\t \n\tf300_set_line(dev, F300_RESET, 0); \n\tmsleep(1);\n\n\tf300_send_byte(dev, 0xe0); \n\tmsleep(1);\n\n\ttemp = buf[0];\n\ttemp += 2;\n\tfor (i = 0; i < temp; i++)\n\t\tf300_send_byte(dev, buf[i]);\n\n\tf300_set_line(dev, F300_RESET, 1); \n\tf300_set_line(dev, F300_DATA, 1);\n\n\t \n\ttemp = 0;\n\tfor (i = 0; ((i < 8) & (temp == 0)); i++) {\n\t\tmsleep(1);\n\t\tif (f300_get_line(dev, F300_BUSY) == 0)\n\t\t\ttemp = 1;\n\t}\n\n\tif (i > 7) {\n\t\tpr_err(\"%s: timeout, the slave no response\\n\",\n\t\t\t\t\t\t\t\t__func__);\n\t\tret = 1;  \n\t} else {  \n\t\tf300_set_line(dev, F300_RESET, 0); \n\t\tmsleep(1);\n\t\tf300_send_byte(dev, 0xe1); \n\t\tmsleep(1);\n\t\ttemp = f300_get_byte(dev); \n\t\tif (temp > 14)\n\t\t\ttemp = 14;\n\n\t\tfor (i = 0; i < (temp + 1); i++)\n\t\t\tf300_get_byte(dev); \n\n\t\tf300_set_line(dev, F300_RESET, 1); \n\t\tf300_set_line(dev, F300_DATA, 1);\n\t}\n\n\treturn ret;\n}\n\nint f300_set_voltage(struct dvb_frontend *fe, enum fe_sec_voltage voltage)\n{\n\tu8 buf[16];\n\n\tbuf[0] = 0x05;\n\tbuf[1] = 0x38; \n\tbuf[2] = 0x01; \n\n\tswitch (voltage) {\n\tcase SEC_VOLTAGE_13:\n\t\tbuf[3] = 0x01; \n\t\tbuf[4] = 0x02; \n\t\tbuf[5] = 0x00; \n\t\tbreak;\n\tcase SEC_VOLTAGE_18:\n\t\tbuf[3] = 0x01;\n\t\tbuf[4] = 0x02;\n\t\tbuf[5] = 0x01; \n\t\tbreak;\n\tcase SEC_VOLTAGE_OFF:\n\t\tbuf[3] = 0x00; \n\t\tbuf[4] = 0x00;\n\t\tbuf[5] = 0x00;\n\t\tbreak;\n\t}\n\n\treturn f300_xfer(fe, buf);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}