{
  "module_name": "solo6x10.h",
  "hash_id": "1b28cda007b84b4d8155b4f934b4391fed7721c17daf9523785d18d9b57ae0cb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/solo6x10/solo6x10.h",
  "human_readable_source": " \n \n\n#ifndef __SOLO6X10_H\n#define __SOLO6X10_H\n\n#include <linux/pci.h>\n#include <linux/i2c.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n#include <linux/stringify.h>\n#include <linux/io.h>\n#include <linux/atomic.h>\n#include <linux/slab.h>\n#include <linux/videodev2.h>\n#include <linux/gpio/driver.h>\n\n#include <media/v4l2-dev.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-ctrls.h>\n#include <media/videobuf2-v4l2.h>\n\n#include \"solo6x10-regs.h\"\n\n#ifndef PCI_VENDOR_ID_SOFTLOGIC\n#define PCI_VENDOR_ID_SOFTLOGIC\t\t0x9413\n#define PCI_DEVICE_ID_SOLO6010\t\t0x6010\n#define PCI_DEVICE_ID_SOLO6110\t\t0x6110\n#endif\n\n#ifndef PCI_VENDOR_ID_BLUECHERRY\n#define PCI_VENDOR_ID_BLUECHERRY\t0x1BB3\n \n#define PCI_DEVICE_ID_NEUSOLO_4\t\t0x4304\n#define PCI_DEVICE_ID_NEUSOLO_9\t\t0x4309\n#define PCI_DEVICE_ID_NEUSOLO_16\t0x4310\n \n#define PCI_DEVICE_ID_BC_SOLO_4\t\t0x4E04\n#define PCI_DEVICE_ID_BC_SOLO_9\t\t0x4E09\n#define PCI_DEVICE_ID_BC_SOLO_16\t0x4E10\n \n#define PCI_DEVICE_ID_BC_6110_4\t\t0x5304\n#define PCI_DEVICE_ID_BC_6110_8\t\t0x5308\n#define PCI_DEVICE_ID_BC_6110_16\t0x5310\n#endif  \n\n \n#define SOLO_DEV_6010\t\t\t0\n#define SOLO_DEV_6110\t\t\t1\n\n#define SOLO6X10_NAME\t\t\t\"solo6x10\"\n\n#define SOLO_MAX_CHANNELS\t\t16\n\n#define SOLO6X10_VERSION\t\t\"3.0.0\"\n\n \n#define SOLO_I2C_ADAPTERS\t\t2\n#define SOLO_I2C_TW\t\t\t0\n#define SOLO_I2C_SAA\t\t\t1\n\n \n#define SOLO_NR_P2M\t\t\t4\n#define SOLO_NR_P2M_DESC\t\t256\n#define SOLO_P2M_DESC_SIZE\t\t(SOLO_NR_P2M_DESC * 16)\n\n \n#define SOLO_ENC_MODE_CIF\t\t2\n#define SOLO_ENC_MODE_HD1\t\t1\n#define SOLO_ENC_MODE_D1\t\t9\n\n#define SOLO_DEFAULT_QP\t\t\t3\n\n#define SOLO_CID_CUSTOM_BASE\t\t(V4L2_CID_USER_BASE | 0xf000)\n#define V4L2_CID_MOTION_TRACE\t\t(SOLO_CID_CUSTOM_BASE+2)\n#define V4L2_CID_OSD_TEXT\t\t(SOLO_CID_CUSTOM_BASE+3)\n\n \n#define SOLO_MOTION_SZ (45)\n\nenum SOLO_I2C_STATE {\n\tIIC_STATE_IDLE,\n\tIIC_STATE_START,\n\tIIC_STATE_READ,\n\tIIC_STATE_WRITE,\n\tIIC_STATE_STOP\n};\n\n \nstruct solo_p2m_desc {\n\tu32\tctrl;\n\tu32\tcfg;\n\tu32\tdma_addr;\n\tu32\text_addr;\n};\n\nstruct solo_p2m_dev {\n\tstruct mutex\t\tmutex;\n\tstruct completion\tcompletion;\n\tint\t\t\tdesc_count;\n\tint\t\t\tdesc_idx;\n\tstruct solo_p2m_desc\t*descs;\n\tint\t\t\terror;\n};\n\n#define OSD_TEXT_MAX\t\t44\n\nstruct solo_vb2_buf {\n\tstruct vb2_v4l2_buffer vb;\n\tstruct list_head list;\n};\n\nenum solo_enc_types {\n\tSOLO_ENC_TYPE_STD,\n\tSOLO_ENC_TYPE_EXT,\n};\n\nstruct solo_enc_dev {\n\tstruct solo_dev\t*solo_dev;\n\t \n\tstruct v4l2_ctrl_handler hdl;\n\tstruct v4l2_ctrl *md_thresholds;\n\tstruct video_device\t*vfd;\n\t \n\tstruct mutex\t\tlock;\n\tspinlock_t\t\tmotion_lock;\n\tu8\t\t\tch;\n\tu8\t\t\tmode, gop, qp, interlaced, interval;\n\tu8\t\t\tbw_weight;\n\tu16\t\t\tmotion_thresh;\n\tbool\t\t\tmotion_global;\n\tbool\t\t\tmotion_enabled;\n\tu16\t\t\twidth;\n\tu16\t\t\theight;\n\n\t \n\tchar\t\t\tosd_text[OSD_TEXT_MAX + 1];\n\tu8\t\t\tosd_buf[SOLO_EOSD_EXT_SIZE_MAX]\n\t\t\t\t\t__aligned(4);\n\n\t \n\tu8\t\t\tvop[64];\n\tint\t\t\tvop_len;\n\tu8\t\t\tjpeg_header[1024];\n\tint\t\t\tjpeg_len;\n\n\tu32\t\t\tfmt;\n\tenum solo_enc_types\ttype;\n\tu32\t\t\tsequence;\n\tstruct vb2_queue\tvidq;\n\tstruct list_head\tvidq_active;\n\tint\t\t\tdesc_count;\n\tint\t\t\tdesc_nelts;\n\tstruct solo_p2m_desc\t*desc_items;\n\tdma_addr_t\t\tdesc_dma;\n\tspinlock_t\t\tav_lock;\n};\n\n \nstruct solo_dev {\n\t \n\tstruct pci_dev\t\t*pdev;\n\tint\t\t\ttype;\n\tunsigned int\t\ttime_sync;\n\tunsigned int\t\tusec_lsb;\n\tunsigned int\t\tclock_mhz;\n\tu8 __iomem\t\t*reg_base;\n\tint\t\t\tnr_chans;\n\tint\t\t\tnr_ext;\n\tu32\t\t\tirq_mask;\n\tu32\t\t\tmotion_mask;\n\tstruct v4l2_device\tv4l2_dev;\n#ifdef CONFIG_GPIOLIB\n\t \n\tstruct gpio_chip\tgpio_dev;\n#endif\n\n\t \n\tu8\t\t\ttw2865, tw2864, tw2815;\n\tu8\t\t\ttw28_cnt;\n\n\t \n\tstruct i2c_adapter\ti2c_adap[SOLO_I2C_ADAPTERS];\n\tenum SOLO_I2C_STATE\ti2c_state;\n\tstruct mutex\t\ti2c_mutex;\n\tint\t\t\ti2c_id;\n\twait_queue_head_t\ti2c_wait;\n\tstruct i2c_msg\t\t*i2c_msg;\n\tunsigned int\t\ti2c_msg_num;\n\tunsigned int\t\ti2c_msg_ptr;\n\n\t \n\tstruct solo_p2m_dev\tp2m_dev[SOLO_NR_P2M];\n\tatomic_t\t\tp2m_count;\n\tint\t\t\tp2m_jiffies;\n\tunsigned int\t\tp2m_timeouts;\n\n\t \n\tstruct video_device\t*vfd;\n\tunsigned int\t\terasing;\n\tunsigned int\t\tframe_blank;\n\tu8\t\t\tcur_disp_ch;\n\twait_queue_head_t\tdisp_thread_wait;\n\tstruct v4l2_ctrl_handler disp_hdl;\n\n\t \n\tstruct solo_enc_dev\t*v4l2_enc[SOLO_MAX_CHANNELS];\n\tu16\t\t\tenc_bw_remain;\n\t \n\tu8\t\t\tenc_idx;\n\n\t \n\tu32\t\t\tvideo_type;\n\tu16\t\t\tvideo_hsize, video_vsize;\n\tu16\t\t\tvout_hstart, vout_vstart;\n\tu16\t\t\tvin_hstart, vin_vstart;\n\tu8\t\t\tfps;\n\n\t \n\tspinlock_t      jpeg_qp_lock;\n\tu32\t\tjpeg_qp[2];\n\n\t \n\tstruct snd_card\t\t*snd_card;\n\tstruct snd_pcm\t\t*snd_pcm;\n\tatomic_t\t\tsnd_users;\n\tint\t\t\tg723_hw_idx;\n\n\t \n\tstruct device\t\tdev;\n\tint\t\t\tsdram_size;\n\tstruct bin_attribute\tsdram_attr;\n\tunsigned int\t\tsys_config;\n\n\t \n\tstruct task_struct\t*ring_thread;\n\twait_queue_head_t\tring_thread_wait;\n\n\t \n\tvoid                    *vh_buf;\n\tdma_addr_t\t\tvh_dma;\n\tint\t\t\tvh_size;\n\n\t \n\tstruct vb2_queue\tvidq;\n\tu32\t\t\tsequence;\n\tstruct task_struct      *kthread;\n\tstruct mutex\t\tlock;\n\tspinlock_t\t\tslock;\n\tint\t\t\told_write;\n\tstruct list_head\tvidq_active;\n};\n\nstatic inline u32 solo_reg_read(struct solo_dev *solo_dev, int reg)\n{\n\treturn readl(solo_dev->reg_base + reg);\n}\n\nstatic inline void solo_reg_write(struct solo_dev *solo_dev, int reg,\n\t\t\t\t  u32 data)\n{\n\tu16 val;\n\n\twritel(data, solo_dev->reg_base + reg);\n\tpci_read_config_word(solo_dev->pdev, PCI_STATUS, &val);\n}\n\nstatic inline void solo_irq_on(struct solo_dev *dev, u32 mask)\n{\n\tdev->irq_mask |= mask;\n\tsolo_reg_write(dev, SOLO_IRQ_MASK, dev->irq_mask);\n}\n\nstatic inline void solo_irq_off(struct solo_dev *dev, u32 mask)\n{\n\tdev->irq_mask &= ~mask;\n\tsolo_reg_write(dev, SOLO_IRQ_MASK, dev->irq_mask);\n}\n\n \nint solo_disp_init(struct solo_dev *solo_dev);\nvoid solo_disp_exit(struct solo_dev *solo_dev);\n\nint solo_gpio_init(struct solo_dev *solo_dev);\nvoid solo_gpio_exit(struct solo_dev *solo_dev);\n\nint solo_i2c_init(struct solo_dev *solo_dev);\nvoid solo_i2c_exit(struct solo_dev *solo_dev);\n\nint solo_p2m_init(struct solo_dev *solo_dev);\nvoid solo_p2m_exit(struct solo_dev *solo_dev);\n\nint solo_v4l2_init(struct solo_dev *solo_dev, unsigned nr);\nvoid solo_v4l2_exit(struct solo_dev *solo_dev);\n\nint solo_enc_init(struct solo_dev *solo_dev);\nvoid solo_enc_exit(struct solo_dev *solo_dev);\n\nint solo_enc_v4l2_init(struct solo_dev *solo_dev, unsigned nr);\nvoid solo_enc_v4l2_exit(struct solo_dev *solo_dev);\n\nint solo_g723_init(struct solo_dev *solo_dev);\nvoid solo_g723_exit(struct solo_dev *solo_dev);\n\n \nint solo_i2c_isr(struct solo_dev *solo_dev);\nvoid solo_p2m_isr(struct solo_dev *solo_dev, int id);\nvoid solo_p2m_error_isr(struct solo_dev *solo_dev);\nvoid solo_enc_v4l2_isr(struct solo_dev *solo_dev);\nvoid solo_g723_isr(struct solo_dev *solo_dev);\nvoid solo_motion_isr(struct solo_dev *solo_dev);\nvoid solo_video_in_isr(struct solo_dev *solo_dev);\n\n \nu8 solo_i2c_readbyte(struct solo_dev *solo_dev, int id, u8 addr, u8 off);\nvoid solo_i2c_writebyte(struct solo_dev *solo_dev, int id, u8 addr, u8 off,\n\t\t\tu8 data);\n\n \nint solo_p2m_dma_t(struct solo_dev *solo_dev, int wr,\n\t\t   dma_addr_t dma_addr, u32 ext_addr, u32 size,\n\t\t   int repeat, u32 ext_size);\nint solo_p2m_dma(struct solo_dev *solo_dev, int wr,\n\t\t void *sys_addr, u32 ext_addr, u32 size,\n\t\t int repeat, u32 ext_size);\nvoid solo_p2m_fill_desc(struct solo_p2m_desc *desc, int wr,\n\t\t\tdma_addr_t dma_addr, u32 ext_addr, u32 size,\n\t\t\tint repeat, u32 ext_size);\nint solo_p2m_dma_desc(struct solo_dev *solo_dev,\n\t\t      struct solo_p2m_desc *desc, dma_addr_t desc_dma,\n\t\t      int desc_cnt);\n\n \nint solo_set_video_type(struct solo_dev *solo_dev, bool is_50hz);\nvoid solo_update_mode(struct solo_enc_dev *solo_enc);\n\n \nint solo_set_motion_threshold(struct solo_dev *solo_dev, u8 ch, u16 val);\nint solo_set_motion_block(struct solo_dev *solo_dev, u8 ch,\n\t\tconst u16 *thresholds);\n#define SOLO_DEF_MOT_THRESH\t\t0x0300\n\n \nint solo_osd_print(struct solo_enc_dev *solo_enc);\n\n \nunsigned int solo_eeprom_ewen(struct solo_dev *solo_dev, int w_en);\n__be16 solo_eeprom_read(struct solo_dev *solo_dev, int loc);\nint solo_eeprom_write(struct solo_dev *solo_dev, int loc,\n\t\t      __be16 data);\n\n \nvoid solo_s_jpeg_qp(struct solo_dev *solo_dev, unsigned int ch,\n\t\t    unsigned int qp);\nint solo_g_jpeg_qp(struct solo_dev *solo_dev, unsigned int ch);\n\n#define CHK_FLAGS(v, flags) (((v) & (flags)) == (flags))\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}