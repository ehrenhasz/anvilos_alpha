{
  "module_name": "solo6x10-tw28.c",
  "hash_id": "11750f30e2fff455a4dcccae5e7d77e9607bc29dd1ce585d4274dea06aafc7b7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/solo6x10/solo6x10-tw28.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/delay.h>\n\n#include \"solo6x10.h\"\n#include \"solo6x10-tw28.h\"\n\n#define DEFAULT_HDELAY_NTSC\t\t(32 - 8)\n#define DEFAULT_HACTIVE_NTSC\t\t(720 + 16)\n#define DEFAULT_VDELAY_NTSC\t\t(7 - 2)\n#define DEFAULT_VACTIVE_NTSC\t\t(240 + 4)\n\n#define DEFAULT_HDELAY_PAL\t\t(32 + 4)\n#define DEFAULT_HACTIVE_PAL\t\t(864-DEFAULT_HDELAY_PAL)\n#define DEFAULT_VDELAY_PAL\t\t(6)\n#define DEFAULT_VACTIVE_PAL\t\t(312-DEFAULT_VDELAY_PAL)\n\n\nstatic const u8 tbl_tw2864_ntsc_template[] = {\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA3, 0x00,\n\t0x00, 0x02, 0x00, 0xcc, 0x00, 0x80, 0x44, 0x50,  \n\t0x22, 0x01, 0xd8, 0xbc, 0xb8, 0x44, 0x38, 0x00,\n\t0x00, 0x78, 0x72, 0x3e, 0x14, 0xa5, 0xe4, 0x05,  \n\t0x00, 0x28, 0x44, 0x44, 0xa0, 0x88, 0x5a, 0x01,\n\t0x08, 0x08, 0x08, 0x08, 0x1a, 0x1a, 0x1a, 0x1a,  \n\t0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0x44,\n\t0x44, 0x0a, 0x00, 0xff, 0xef, 0xef, 0xef, 0xef,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x55, 0x00, 0xb1, 0xe4, 0x40, 0x00,\n\t0x77, 0x77, 0x01, 0x13, 0x57, 0x9b, 0xdf, 0x20,  \n\t0x64, 0xa8, 0xec, 0xc1, 0x0f, 0x11, 0x11, 0x81,\n\t0x00, 0xe0, 0xbb, 0xbb, 0x00, 0x11, 0x00, 0x00,  \n\t0x11, 0x00, 0x00, 0x11, 0x00, 0x00, 0x11, 0x00,\n\t0x83, 0xb5, 0x09, 0x78, 0x85, 0x00, 0x01, 0x20,  \n\t0x64, 0x11, 0x40, 0xaf, 0xff, 0x00, 0x00, 0x00,\n};\n\nstatic const u8 tbl_tw2864_pal_template[] = {\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x18, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x18, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x18, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x18, 0xf5, 0x0c, 0xd0, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xA3, 0x00,\n\t0x00, 0x02, 0x00, 0xcc, 0x00, 0x80, 0x44, 0x50,  \n\t0x22, 0x01, 0xd8, 0xbc, 0xb8, 0x44, 0x38, 0x00,\n\t0x00, 0x78, 0x72, 0x3e, 0x14, 0xa5, 0xe4, 0x05,  \n\t0x00, 0x28, 0x44, 0x44, 0xa0, 0x90, 0x5a, 0x01,\n\t0x0a, 0x0a, 0x0a, 0x0a, 0x1a, 0x1a, 0x1a, 0x1a,  \n\t0x00, 0x00, 0x00, 0xf0, 0xf0, 0xf0, 0xf0, 0x44,\n\t0x44, 0x0a, 0x00, 0xff, 0xef, 0xef, 0xef, 0xef,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x55, 0x00, 0xb1, 0xe4, 0x40, 0x00,\n\t0x77, 0x77, 0x01, 0x13, 0x57, 0x9b, 0xdf, 0x20,  \n\t0x64, 0xa8, 0xec, 0xc1, 0x0f, 0x11, 0x11, 0x81,\n\t0x00, 0xe0, 0xbb, 0xbb, 0x00, 0x11, 0x00, 0x00,  \n\t0x11, 0x00, 0x00, 0x11, 0x00, 0x00, 0x11, 0x00,\n\t0x83, 0xb5, 0x09, 0x00, 0xa0, 0x00, 0x01, 0x20,  \n\t0x64, 0x11, 0x40, 0xaf, 0xff, 0x00, 0x00, 0x00,\n};\n\nstatic const u8 tbl_tw2865_ntsc_template[] = {\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xff, 0x09, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xff, 0x09, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xff, 0x09, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0xf0, 0x70, 0x48, 0x80, 0x80, 0x00, 0x02,  \n\t0x12, 0xff, 0x09, 0xd0, 0x00, 0x00, 0x00, 0x7f,\n\t0x00, 0x00, 0x90, 0x68, 0x00, 0x38, 0x80, 0x80,  \n\t0x80, 0x80, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x45, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x21, 0x43,\n\t0x08, 0x00, 0x00, 0x01, 0xf1, 0x03, 0xEF, 0x03,  \n\t0xE9, 0x03, 0xD9, 0x15, 0x15, 0xE4, 0xA3, 0x80,\n\t0x00, 0x02, 0x00, 0xCC, 0x00, 0x80, 0x44, 0x50,  \n\t0x22, 0x01, 0xD8, 0xBC, 0xB8, 0x44, 0x38, 0x00,\n\t0x00, 0x78, 0x44, 0x3D, 0x14, 0xA5, 0xE0, 0x05,  \n\t0x00, 0x28, 0x44, 0x44, 0xA0, 0x90, 0x52, 0x13,\n\t0x08, 0x08, 0x08, 0x08, 0x1A, 0x1A, 0x1B, 0x1A,  \n\t0x00, 0x00, 0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0x44,\n\t0x44, 0x4A, 0x00, 0xFF, 0xEF, 0xEF, 0xEF, 0xEF,  \n\t0xFF, 0xE7, 0xE9, 0xE9, 0xEB, 0xFF, 0xD6, 0xD8,\n\t0xD8, 0xD7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x55, 0x00, 0xE4, 0x39, 0x00, 0x80,\n\t0x77, 0x77, 0x03, 0x20, 0x57, 0x9b, 0xdf, 0x31,  \n\t0x64, 0xa8, 0xec, 0xd1, 0x0f, 0x11, 0x11, 0x81,\n\t0x10, 0xC0, 0xAA, 0xAA, 0x00, 0x11, 0x00, 0x00,  \n\t0x11, 0x00, 0x00, 0x11, 0x00, 0x00, 0x11, 0x00,\n\t0x83, 0xB5, 0x09, 0x78, 0x85, 0x00, 0x01, 0x20,  \n\t0x64, 0x51, 0x40, 0xaf, 0xFF, 0xF0, 0x00, 0xC0,\n};\n\nstatic const u8 tbl_tw2865_pal_template[] = {\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x11, 0xff, 0x01, 0xc3, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x11, 0xff, 0x01, 0xc3, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x11, 0xff, 0x01, 0xc3, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0xf0, 0x70, 0x30, 0x80, 0x80, 0x00, 0x12,  \n\t0x11, 0xff, 0x01, 0xc3, 0x00, 0x00, 0x01, 0x7f,\n\t0x00, 0x94, 0x90, 0x48, 0x00, 0x38, 0x7F, 0x80,  \n\t0x80, 0x80, 0x77, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x45, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x21, 0x43,\n\t0x08, 0x00, 0x00, 0x01, 0xf1, 0x03, 0xEF, 0x03,  \n\t0xEA, 0x03, 0xD9, 0x15, 0x15, 0xE4, 0xA3, 0x80,\n\t0x00, 0x02, 0x00, 0xCC, 0x00, 0x80, 0x44, 0x50,  \n\t0x22, 0x01, 0xD8, 0xBC, 0xB8, 0x44, 0x38, 0x00,\n\t0x00, 0x78, 0x44, 0x3D, 0x14, 0xA5, 0xE0, 0x05,  \n\t0x00, 0x28, 0x44, 0x44, 0xA0, 0x90, 0x52, 0x13,\n\t0x08, 0x08, 0x08, 0x08, 0x1A, 0x1A, 0x1A, 0x1A,  \n\t0x00, 0x00, 0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0x44,\n\t0x44, 0x4A, 0x00, 0xFF, 0xEF, 0xEF, 0xEF, 0xEF,  \n\t0xFF, 0xE7, 0xE9, 0xE9, 0xE9, 0xFF, 0xD7, 0xD8,\n\t0xD9, 0xD8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x55, 0x00, 0xE4, 0x39, 0x00, 0x80,\n\t0x77, 0x77, 0x03, 0x20, 0x57, 0x9b, 0xdf, 0x31,  \n\t0x64, 0xa8, 0xec, 0xd1, 0x0f, 0x11, 0x11, 0x81,\n\t0x10, 0xC0, 0xAA, 0xAA, 0x00, 0x11, 0x00, 0x00,  \n\t0x11, 0x00, 0x00, 0x11, 0x00, 0x00, 0x11, 0x00,\n\t0x83, 0xB5, 0x09, 0x00, 0xA0, 0x00, 0x01, 0x20,  \n\t0x64, 0x51, 0x40, 0xaf, 0xFF, 0xF0, 0x00, 0xC0,\n};\n\n#define is_tw286x(__solo, __id) (!(__solo->tw2815 & (1 << __id)))\n\nstatic u8 tw_readbyte(struct solo_dev *solo_dev, int chip_id, u8 tw6x_off,\n\t\t      u8 tw_off)\n{\n\tif (is_tw286x(solo_dev, chip_id))\n\t\treturn solo_i2c_readbyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t TW_CHIP_OFFSET_ADDR(chip_id),\n\t\t\t\t\t tw6x_off);\n\telse\n\t\treturn solo_i2c_readbyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t TW_CHIP_OFFSET_ADDR(chip_id),\n\t\t\t\t\t tw_off);\n}\n\nstatic void tw_writebyte(struct solo_dev *solo_dev, int chip_id,\n\t\t\t u8 tw6x_off, u8 tw_off, u8 val)\n{\n\tif (is_tw286x(solo_dev, chip_id))\n\t\tsolo_i2c_writebyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t   TW_CHIP_OFFSET_ADDR(chip_id),\n\t\t\t\t   tw6x_off, val);\n\telse\n\t\tsolo_i2c_writebyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t   TW_CHIP_OFFSET_ADDR(chip_id),\n\t\t\t\t   tw_off, val);\n}\n\nstatic void tw_write_and_verify(struct solo_dev *solo_dev, u8 addr, u8 off,\n\t\t\t\tu8 val)\n{\n\tint i;\n\n\tfor (i = 0; i < 5; i++) {\n\t\tu8 rval = solo_i2c_readbyte(solo_dev, SOLO_I2C_TW, addr, off);\n\n\t\tif (rval == val)\n\t\t\treturn;\n\n\t\tsolo_i2c_writebyte(solo_dev, SOLO_I2C_TW, addr, off, val);\n\t\tmsleep_interruptible(1);\n\t}\n\n \n \n}\n\nstatic int tw2865_setup(struct solo_dev *solo_dev, u8 dev_addr)\n{\n\tu8 tbl_tw2865_common[256];\n\tint i;\n\n\tif (solo_dev->video_type == SOLO_VO_FMT_TYPE_PAL)\n\t\tmemcpy(tbl_tw2865_common, tbl_tw2865_pal_template,\n\t\t       sizeof(tbl_tw2865_common));\n\telse\n\t\tmemcpy(tbl_tw2865_common, tbl_tw2865_ntsc_template,\n\t\t       sizeof(tbl_tw2865_common));\n\n\t \n\tif (solo_dev->nr_chans == 4) {\n\t\ttbl_tw2865_common[0xd2] = 0x01;\n\t\ttbl_tw2865_common[0xcf] = 0x00;\n\t} else if (solo_dev->nr_chans == 8) {\n\t\ttbl_tw2865_common[0xd2] = 0x02;\n\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\ttbl_tw2865_common[0xcf] = 0x80;\n\t} else if (solo_dev->nr_chans == 16) {\n\t\ttbl_tw2865_common[0xd2] = 0x03;\n\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\ttbl_tw2865_common[0xcf] = 0x83;\n\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(2))\n\t\t\ttbl_tw2865_common[0xcf] = 0x83;\n\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(3))\n\t\t\ttbl_tw2865_common[0xcf] = 0x80;\n\t}\n\n\tfor (i = 0; i < 0xff; i++) {\n\t\t \n\t\tswitch (i) {\n\t\tcase 0xb8 ... 0xc1:\n\t\tcase 0xc4 ... 0xc7:\n\t\tcase 0xfd:\n\t\t\tcontinue;\n\t\t}\n\t\tswitch (i & ~0x30) {\n\t\tcase 0x00:\n\t\tcase 0x0c ... 0x0d:\n\t\t\tcontinue;\n\t\t}\n\n\t\ttw_write_and_verify(solo_dev, dev_addr, i,\n\t\t\t\t    tbl_tw2865_common[i]);\n\t}\n\n\treturn 0;\n}\n\nstatic int tw2864_setup(struct solo_dev *solo_dev, u8 dev_addr)\n{\n\tu8 tbl_tw2864_common[256];\n\tint i;\n\n\tif (solo_dev->video_type == SOLO_VO_FMT_TYPE_PAL)\n\t\tmemcpy(tbl_tw2864_common, tbl_tw2864_pal_template,\n\t\t       sizeof(tbl_tw2864_common));\n\telse\n\t\tmemcpy(tbl_tw2864_common, tbl_tw2864_ntsc_template,\n\t\t       sizeof(tbl_tw2864_common));\n\n\tif (solo_dev->tw2865 == 0) {\n\t\t \n\t\tif (solo_dev->nr_chans == 4) {\n\t\t\ttbl_tw2864_common[0xd2] = 0x01;\n\t\t\ttbl_tw2864_common[0xcf] = 0x00;\n\t\t} else if (solo_dev->nr_chans == 8) {\n\t\t\ttbl_tw2864_common[0xd2] = 0x02;\n\t\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(0))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x43;\n\t\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x40;\n\t\t} else if (solo_dev->nr_chans == 16) {\n\t\t\ttbl_tw2864_common[0xd2] = 0x03;\n\t\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(0))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x43;\n\t\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x43;\n\t\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(2))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x43;\n\t\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(3))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x40;\n\t\t}\n\t} else {\n\t\t \n\t\tfor (i = 0; i <= 4; i++)\n\t\t\ttbl_tw2864_common[0x08 | i << 4] = 0x12;\n\n\t\tif (solo_dev->nr_chans == 8) {\n\t\t\ttbl_tw2864_common[0xd2] = 0x02;\n\t\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x80;\n\t\t} else if (solo_dev->nr_chans == 16) {\n\t\t\ttbl_tw2864_common[0xd2] = 0x03;\n\t\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x83;\n\t\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(2))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x83;\n\t\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(3))\n\t\t\t\ttbl_tw2864_common[0xcf] = 0x80;\n\t\t}\n\t}\n\n\tfor (i = 0; i < 0xff; i++) {\n\t\t \n\t\tswitch (i) {\n\t\tcase 0xb8 ... 0xc1:\n\t\tcase 0xfd:\n\t\t\tcontinue;\n\t\t}\n\t\tswitch (i & ~0x30) {\n\t\tcase 0x00:\n\t\tcase 0x0c:\n\t\tcase 0x0d:\n\t\t\tcontinue;\n\t\t}\n\n\t\ttw_write_and_verify(solo_dev, dev_addr, i,\n\t\t\t\t    tbl_tw2864_common[i]);\n\t}\n\n\treturn 0;\n}\n\nstatic int tw2815_setup(struct solo_dev *solo_dev, u8 dev_addr)\n{\n\tu8 tbl_ntsc_tw2815_common[] = {\n\t\t0x00, 0xc8, 0x20, 0xd0, 0x06, 0xf0, 0x08, 0x80,\n\t\t0x80, 0x80, 0x80, 0x02, 0x06, 0x00, 0x11,\n\t};\n\n\tu8 tbl_pal_tw2815_common[] = {\n\t\t0x00, 0x88, 0x20, 0xd0, 0x05, 0x20, 0x28, 0x80,\n\t\t0x80, 0x80, 0x80, 0x82, 0x06, 0x00, 0x11,\n\t};\n\n\tu8 tbl_tw2815_sfr[] = {\n\t\t0x00, 0x00, 0x00, 0xc0, 0x45, 0xa0, 0xd0, 0x2f,  \n\t\t0x64, 0x80, 0x80, 0x82, 0x82, 0x00, 0x00, 0x00,\n\t\t0x00, 0x0f, 0x05, 0x00, 0x00, 0x80, 0x06, 0x00,  \n\t\t0x00, 0x00, 0x00, 0xff, 0x8f, 0x00, 0x00, 0x00,\n\t\t0x88, 0x88, 0xc0, 0x00, 0x20, 0x64, 0xa8, 0xec,  \n\t\t0x31, 0x75, 0xb9, 0xfd, 0x00, 0x00, 0x88, 0x88,\n\t\t0x88, 0x11, 0x00, 0x88, 0x88, 0x00,\t\t \n\t};\n\tu8 *tbl_tw2815_common;\n\tint i;\n\tint ch;\n\n\ttbl_ntsc_tw2815_common[0x06] = 0;\n\n\t \n\ttbl_ntsc_tw2815_common[0x02] = DEFAULT_HDELAY_NTSC & 0xff;\n\ttbl_ntsc_tw2815_common[0x06] |= 0x03 & (DEFAULT_HDELAY_NTSC >> 8);\n\n\t \n\ttbl_ntsc_tw2815_common[0x03] = DEFAULT_HACTIVE_NTSC & 0xff;\n\ttbl_ntsc_tw2815_common[0x06] |=\n\t\t((0x03 & (DEFAULT_HACTIVE_NTSC >> 8)) << 2);\n\n\t \n\ttbl_ntsc_tw2815_common[0x04] = DEFAULT_VDELAY_NTSC & 0xff;\n\ttbl_ntsc_tw2815_common[0x06] |=\n\t\t((0x01 & (DEFAULT_VDELAY_NTSC >> 8)) << 4);\n\n\t \n\ttbl_ntsc_tw2815_common[0x05] = DEFAULT_VACTIVE_NTSC & 0xff;\n\ttbl_ntsc_tw2815_common[0x06] |=\n\t\t((0x01 & (DEFAULT_VACTIVE_NTSC >> 8)) << 5);\n\n\ttbl_pal_tw2815_common[0x06] = 0;\n\n\t \n\ttbl_pal_tw2815_common[0x02] = DEFAULT_HDELAY_PAL & 0xff;\n\ttbl_pal_tw2815_common[0x06] |= 0x03 & (DEFAULT_HDELAY_PAL >> 8);\n\n\t \n\ttbl_pal_tw2815_common[0x03] = DEFAULT_HACTIVE_PAL & 0xff;\n\ttbl_pal_tw2815_common[0x06] |=\n\t\t((0x03 & (DEFAULT_HACTIVE_PAL >> 8)) << 2);\n\n\t \n\ttbl_pal_tw2815_common[0x04] = DEFAULT_VDELAY_PAL & 0xff;\n\ttbl_pal_tw2815_common[0x06] |=\n\t\t((0x01 & (DEFAULT_VDELAY_PAL >> 8)) << 4);\n\n\t \n\ttbl_pal_tw2815_common[0x05] = DEFAULT_VACTIVE_PAL & 0xff;\n\ttbl_pal_tw2815_common[0x06] |=\n\t\t((0x01 & (DEFAULT_VACTIVE_PAL >> 8)) << 5);\n\n\ttbl_tw2815_common =\n\t    (solo_dev->video_type == SOLO_VO_FMT_TYPE_NTSC) ?\n\t     tbl_ntsc_tw2815_common : tbl_pal_tw2815_common;\n\n\t \n\ttbl_tw2815_common[0x0d] |= 0x04;\n\n\t \n\ttbl_tw2815_sfr[0x62 - 0x40] &= ~(3 << 6);\n\n\tif (solo_dev->nr_chans == 4) {\n\t\ttbl_tw2815_sfr[0x63 - 0x40] |= 1;\n\t\ttbl_tw2815_sfr[0x62 - 0x40] |= 3 << 6;\n\t} else if (solo_dev->nr_chans == 8) {\n\t\ttbl_tw2815_sfr[0x63 - 0x40] |= 2;\n\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(0))\n\t\t\ttbl_tw2815_sfr[0x62 - 0x40] |= 1 << 6;\n\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\ttbl_tw2815_sfr[0x62 - 0x40] |= 2 << 6;\n\t} else if (solo_dev->nr_chans == 16) {\n\t\ttbl_tw2815_sfr[0x63 - 0x40] |= 3;\n\t\tif (dev_addr == TW_CHIP_OFFSET_ADDR(0))\n\t\t\ttbl_tw2815_sfr[0x62 - 0x40] |= 1 << 6;\n\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(1))\n\t\t\ttbl_tw2815_sfr[0x62 - 0x40] |= 0 << 6;\n\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(2))\n\t\t\ttbl_tw2815_sfr[0x62 - 0x40] |= 0 << 6;\n\t\telse if (dev_addr == TW_CHIP_OFFSET_ADDR(3))\n\t\t\ttbl_tw2815_sfr[0x62 - 0x40] |= 2 << 6;\n\t}\n\n\t \n\t \n\n\t \n\ttbl_tw2815_sfr[0x62 - 0x40] |= 0 << 2;\n\ttbl_tw2815_sfr[0x6c - 0x40] |= 0 << 2;\n\n\t \n\ttbl_tw2815_sfr[0x6c - 0x40] |= 1 << 5;\n\n\t \n\ttbl_tw2815_sfr[0x5c - 0x40] |= 1 << 5;\n\n\t \n\ttbl_tw2815_sfr[0x70 - 0x40] |= 0xff;\n\t \n\ttbl_tw2815_sfr[0x71 - 0x40] |= 0x10;\n\ttbl_tw2815_sfr[0x6d - 0x40] |= 0x0f;\n\n\t \n\n\tfor (ch = 0; ch < 4; ch++) {\n\t\ttbl_tw2815_common[0x0d] &= ~3;\n\t\tswitch (ch) {\n\t\tcase 0:\n\t\t\ttbl_tw2815_common[0x0d] |= 0x21;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\ttbl_tw2815_common[0x0d] |= 0x20;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\ttbl_tw2815_common[0x0d] |= 0x23;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\ttbl_tw2815_common[0x0d] |= 0x22;\n\t\t\tbreak;\n\t\t}\n\n\t\tfor (i = 0; i < 0x0f; i++) {\n\t\t\tif (i == 0x00)\n\t\t\t\tcontinue;\t \n\t\t\tsolo_i2c_writebyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t   dev_addr, (ch * 0x10) + i,\n\t\t\t\t\t   tbl_tw2815_common[i]);\n\t\t}\n\t}\n\n\tfor (i = 0x40; i < 0x76; i++) {\n\t\t \n\t\tif (i == 0x40 || i == 0x59 || i == 0x5a ||\n\t\t    i == 0x5d || i == 0x5e || i == 0x5f)\n\t\t\tcontinue;\n\n\t\tsolo_i2c_writebyte(solo_dev, SOLO_I2C_TW, dev_addr, i,\n\t\t\t\t       tbl_tw2815_sfr[i - 0x40]);\n\t}\n\n\treturn 0;\n}\n\n#define FIRST_ACTIVE_LINE\t0x0008\n#define LAST_ACTIVE_LINE\t0x0102\n\nstatic void saa712x_write_regs(struct solo_dev *dev, const u8 *vals,\n\t\tint start, int n)\n{\n\tfor (; start < n; start++, vals++) {\n\t\t \n\t\tswitch (start) {\n\t\t \n\t\tcase 0x2e ... 0x37:\n\t\tcase 0x60:\n\t\tcase 0x7d:\n\t\t\tcontinue;\n\t\t}\n\t\tsolo_i2c_writebyte(dev, SOLO_I2C_SAA, 0x46, start, *vals);\n\t}\n}\n\n#define SAA712x_reg7c (0x80 | ((LAST_ACTIVE_LINE & 0x100) >> 2) \\\n\t\t| ((FIRST_ACTIVE_LINE & 0x100) >> 4))\n\nstatic void saa712x_setup(struct solo_dev *dev)\n{\n\tconst int reg_start = 0x26;\n\tstatic const u8 saa7128_regs_ntsc[] = {\n\t \n\t\t0x0d, 0x00,\n\t \n\t\t0x59, 0x1d, 0x75, 0x3f, 0x06, 0x3f,\n\t \n\t\t0x00, 0x00,\n\t\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t \n\t\t0x1a, 0x1a, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t \n\t\t0x00, 0x00, 0x00, 0x68, 0x10, 0x97, 0x4c, 0x18,\n\t\t0x9b, 0x93, 0x9f, 0xff, 0x7c, 0x34, 0x3f, 0x3f,\n\t \n\t\t0x3f, 0x83, 0x83, 0x80, 0x0d, 0x0f, 0xc3, 0x06,\n\t\t0x02, 0x80, 0x71, 0x77, 0xa7, 0x67, 0x66, 0x2e,\n\t \n\t\t0x7b, 0x11, 0x4f, 0x1f, 0x7c, 0xf0, 0x21, 0x77,\n\t\t0x41, 0x88, 0x41, 0x52, 0xed, 0x10, 0x10, 0x00,\n\t \n\t\t0x41, 0xc3, 0x00, 0x3e, 0xb8, 0x02, 0x00, 0x00,\n\t\t0x00, 0x00, FIRST_ACTIVE_LINE, LAST_ACTIVE_LINE & 0xff,\n\t\tSAA712x_reg7c, 0x00, 0xff, 0xff,\n\t}, saa7128_regs_pal[] = {\n\t \n\t\t0x0d, 0x00,\n\t \n\t\t0xe1, 0x1d, 0x75, 0x3f, 0x06, 0x3f,\n\t \n\t\t0x00, 0x00,\n\t\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t \n\t\t0x1a, 0x1a, 0x13, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t \n\t\t0x00, 0x00, 0x00, 0x68, 0x10, 0x97, 0x4c, 0x18,\n\t\t0x9b, 0x93, 0x9f, 0xff, 0x7c, 0x34, 0x3f, 0x3f,\n\t \n\t\t0x3f, 0x83, 0x83, 0x80, 0x0d, 0x0f, 0xc3, 0x06,\n\t\t0x02, 0x80, 0x0f, 0x77, 0xa7, 0x67, 0x66, 0x2e,\n\t \n\t\t0x7b, 0x02, 0x35, 0xcb, 0x8a, 0x09, 0x2a, 0x77,\n\t\t0x41, 0x88, 0x41, 0x52, 0xf1, 0x10, 0x20, 0x00,\n\t \n\t\t0x41, 0xc3, 0x00, 0x3e, 0xb8, 0x02, 0x00, 0x00,\n\t\t0x00, 0x00, 0x12, 0x30,\n\t\tSAA712x_reg7c | 0x40, 0x00, 0xff, 0xff,\n\t};\n\n\tif (dev->video_type == SOLO_VO_FMT_TYPE_PAL)\n\t\tsaa712x_write_regs(dev, saa7128_regs_pal, reg_start,\n\t\t\t\tsizeof(saa7128_regs_pal));\n\telse\n\t\tsaa712x_write_regs(dev, saa7128_regs_ntsc, reg_start,\n\t\t\t\tsizeof(saa7128_regs_ntsc));\n}\n\nint solo_tw28_init(struct solo_dev *solo_dev)\n{\n\tint i;\n\tu8 value;\n\n\tsolo_dev->tw28_cnt = 0;\n\n\t \n\tfor (i = 0; i < solo_dev->nr_chans / 4; i++) {\n\t\tvalue = solo_i2c_readbyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t  TW_CHIP_OFFSET_ADDR(i), 0xFF);\n\n\t\tswitch (value >> 3) {\n\t\tcase 0x18:\n\t\t\tsolo_dev->tw2865 |= 1 << i;\n\t\t\tsolo_dev->tw28_cnt++;\n\t\t\tbreak;\n\t\tcase 0x0c:\n\t\tcase 0x0d:\n\t\t\tsolo_dev->tw2864 |= 1 << i;\n\t\t\tsolo_dev->tw28_cnt++;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tvalue = solo_i2c_readbyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t\t  TW_CHIP_OFFSET_ADDR(i),\n\t\t\t\t\t\t  0x59);\n\t\t\tif ((value >> 3) == 0x04) {\n\t\t\t\tsolo_dev->tw2815 |= 1 << i;\n\t\t\t\tsolo_dev->tw28_cnt++;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (solo_dev->tw28_cnt != (solo_dev->nr_chans >> 2)) {\n\t\tdev_err(&solo_dev->pdev->dev,\n\t\t\t\"Could not initialize any techwell chips\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tsaa712x_setup(solo_dev);\n\n\tfor (i = 0; i < solo_dev->tw28_cnt; i++) {\n\t\tif ((solo_dev->tw2865 & (1 << i)))\n\t\t\ttw2865_setup(solo_dev, TW_CHIP_OFFSET_ADDR(i));\n\t\telse if ((solo_dev->tw2864 & (1 << i)))\n\t\t\ttw2864_setup(solo_dev, TW_CHIP_OFFSET_ADDR(i));\n\t\telse\n\t\t\ttw2815_setup(solo_dev, TW_CHIP_OFFSET_ADDR(i));\n\t}\n\n\treturn 0;\n}\n\n \nint tw28_get_video_status(struct solo_dev *solo_dev, u8 ch)\n{\n\tu8 val, chip_num;\n\n\t \n\tchip_num = ch / 4;\n\tch %= 4;\n\n\tval = tw_readbyte(solo_dev, chip_num, TW286x_AV_STAT_ADDR,\n\t\t\t  TW_AV_STAT_ADDR) & 0x0f;\n\n\treturn val & (1 << ch) ? 1 : 0;\n}\n\n#if 0\n \nu16 tw28_get_audio_status(struct solo_dev *solo_dev)\n{\n\tu8 val;\n\tu16 status = 0;\n\tint i;\n\n\tfor (i = 0; i < solo_dev->tw28_cnt; i++) {\n\t\tval = (tw_readbyte(solo_dev, i, TW286x_AV_STAT_ADDR,\n\t\t\t\t   TW_AV_STAT_ADDR) & 0xf0) >> 4;\n\t\tstatus |= val << (i * 4);\n\t}\n\n\treturn status;\n}\n#endif\n\nbool tw28_has_sharpness(struct solo_dev *solo_dev, u8 ch)\n{\n\treturn is_tw286x(solo_dev, ch / 4);\n}\n\nint tw28_set_ctrl_val(struct solo_dev *solo_dev, u32 ctrl, u8 ch,\n\t\t      s32 val)\n{\n\tchar sval;\n\tu8 chip_num;\n\n\t \n\tchip_num = ch / 4;\n\tch %= 4;\n\n\tif (val > 255 || val < 0)\n\t\treturn -ERANGE;\n\n\tswitch (ctrl) {\n\tcase V4L2_CID_SHARPNESS:\n\t\t \n\t\tif (is_tw286x(solo_dev, chip_num)) {\n\t\t\tu8 v = solo_i2c_readbyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t\t TW_CHIP_OFFSET_ADDR(chip_num),\n\t\t\t\t\t\t TW286x_SHARPNESS(chip_num));\n\t\t\tv &= 0xf0;\n\t\t\tv |= val;\n\t\t\tsolo_i2c_writebyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t   TW_CHIP_OFFSET_ADDR(chip_num),\n\t\t\t\t\t   TW286x_SHARPNESS(chip_num), v);\n\t\t} else {\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tbreak;\n\n\tcase V4L2_CID_HUE:\n\t\tif (is_tw286x(solo_dev, chip_num))\n\t\t\tsval = val - 128;\n\t\telse\n\t\t\tsval = (char)val;\n\t\ttw_writebyte(solo_dev, chip_num, TW286x_HUE_ADDR(ch),\n\t\t\t     TW_HUE_ADDR(ch), sval);\n\n\t\tbreak;\n\n\tcase V4L2_CID_SATURATION:\n\t\t \n\t\tif (is_tw286x(solo_dev, chip_num)) {\n\t\t\tsolo_i2c_writebyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t   TW_CHIP_OFFSET_ADDR(chip_num),\n\t\t\t\t\t   TW286x_SATURATIONU_ADDR(ch), val);\n\t\t}\n\t\ttw_writebyte(solo_dev, chip_num, TW286x_SATURATIONV_ADDR(ch),\n\t\t\t     TW_SATURATION_ADDR(ch), val);\n\n\t\tbreak;\n\n\tcase V4L2_CID_CONTRAST:\n\t\ttw_writebyte(solo_dev, chip_num, TW286x_CONTRAST_ADDR(ch),\n\t\t\t     TW_CONTRAST_ADDR(ch), val);\n\t\tbreak;\n\n\tcase V4L2_CID_BRIGHTNESS:\n\t\tif (is_tw286x(solo_dev, chip_num))\n\t\t\tsval = val - 128;\n\t\telse\n\t\t\tsval = (char)val;\n\t\ttw_writebyte(solo_dev, chip_num, TW286x_BRIGHTNESS_ADDR(ch),\n\t\t\t     TW_BRIGHTNESS_ADDR(ch), sval);\n\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nint tw28_get_ctrl_val(struct solo_dev *solo_dev, u32 ctrl, u8 ch,\n\t\t      s32 *val)\n{\n\tu8 rval, chip_num;\n\n\t \n\tchip_num = ch / 4;\n\tch %= 4;\n\n\tswitch (ctrl) {\n\tcase V4L2_CID_SHARPNESS:\n\t\t \n\t\tif (is_tw286x(solo_dev, chip_num)) {\n\t\t\trval = solo_i2c_readbyte(solo_dev, SOLO_I2C_TW,\n\t\t\t\t\t\t TW_CHIP_OFFSET_ADDR(chip_num),\n\t\t\t\t\t\t TW286x_SHARPNESS(chip_num));\n\t\t\t*val = rval & 0x0f;\n\t\t} else\n\t\t\t*val = 0;\n\t\tbreak;\n\tcase V4L2_CID_HUE:\n\t\trval = tw_readbyte(solo_dev, chip_num, TW286x_HUE_ADDR(ch),\n\t\t\t\t   TW_HUE_ADDR(ch));\n\t\tif (is_tw286x(solo_dev, chip_num))\n\t\t\t*val = (s32)((char)rval) + 128;\n\t\telse\n\t\t\t*val = rval;\n\t\tbreak;\n\tcase V4L2_CID_SATURATION:\n\t\t*val = tw_readbyte(solo_dev, chip_num,\n\t\t\t\t   TW286x_SATURATIONU_ADDR(ch),\n\t\t\t\t   TW_SATURATION_ADDR(ch));\n\t\tbreak;\n\tcase V4L2_CID_CONTRAST:\n\t\t*val = tw_readbyte(solo_dev, chip_num,\n\t\t\t\t   TW286x_CONTRAST_ADDR(ch),\n\t\t\t\t   TW_CONTRAST_ADDR(ch));\n\t\tbreak;\n\tcase V4L2_CID_BRIGHTNESS:\n\t\trval = tw_readbyte(solo_dev, chip_num,\n\t\t\t\t   TW286x_BRIGHTNESS_ADDR(ch),\n\t\t\t\t   TW_BRIGHTNESS_ADDR(ch));\n\t\tif (is_tw286x(solo_dev, chip_num))\n\t\t\t*val = (s32)((char)rval) + 128;\n\t\telse\n\t\t\t*val = rval;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n#if 0\n \nvoid tw2815_Set_AudioOutVol(struct solo_dev *solo_dev, unsigned int u_val)\n{\n\tunsigned int val;\n\tunsigned int chip_num;\n\n\tchip_num = (solo_dev->nr_chans - 1) / 4;\n\n\tval = tw_readbyte(solo_dev, chip_num, TW286x_AUDIO_OUTPUT_VOL_ADDR,\n\t\t\t  TW_AUDIO_OUTPUT_VOL_ADDR);\n\n\tu_val = (val & 0x0f) | (u_val << 4);\n\n\ttw_writebyte(solo_dev, chip_num, TW286x_AUDIO_OUTPUT_VOL_ADDR,\n\t\t     TW_AUDIO_OUTPUT_VOL_ADDR, u_val);\n}\n#endif\n\nu8 tw28_get_audio_gain(struct solo_dev *solo_dev, u8 ch)\n{\n\tu8 val;\n\tu8 chip_num;\n\n\t \n\tchip_num = ch / 4;\n\tch %= 4;\n\n\tval = tw_readbyte(solo_dev, chip_num,\n\t\t\t  TW286x_AUDIO_INPUT_GAIN_ADDR(ch),\n\t\t\t  TW_AUDIO_INPUT_GAIN_ADDR(ch));\n\n\treturn (ch % 2) ? (val >> 4) : (val & 0x0f);\n}\n\nvoid tw28_set_audio_gain(struct solo_dev *solo_dev, u8 ch, u8 val)\n{\n\tu8 old_val;\n\tu8 chip_num;\n\n\t \n\tchip_num = ch / 4;\n\tch %= 4;\n\n\told_val = tw_readbyte(solo_dev, chip_num,\n\t\t\t      TW286x_AUDIO_INPUT_GAIN_ADDR(ch),\n\t\t\t      TW_AUDIO_INPUT_GAIN_ADDR(ch));\n\n\tval = (old_val & ((ch % 2) ? 0x0f : 0xf0)) |\n\t\t((ch % 2) ? (val << 4) : val);\n\n\ttw_writebyte(solo_dev, chip_num, TW286x_AUDIO_INPUT_GAIN_ADDR(ch),\n\t\t     TW_AUDIO_INPUT_GAIN_ADDR(ch), val);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}