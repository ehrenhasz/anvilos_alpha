{
  "module_name": "cobalt-driver.h",
  "hash_id": "7cb12f9bb8714ddf3b47dbd192cdac28cb5bde8ec8ae8917b4cafe7661680554",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/cobalt/cobalt-driver.h",
  "human_readable_source": " \n \n\n#ifndef COBALT_DRIVER_H\n#define COBALT_DRIVER_H\n\n#include <linux/bitops.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/spinlock.h>\n#include <linux/i2c.h>\n#include <linux/list.h>\n#include <linux/workqueue.h>\n#include <linux/mutex.h>\n\n#include <media/v4l2-common.h>\n#include <media/v4l2-ioctl.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-fh.h>\n#include <media/videobuf2-v4l2.h>\n#include <media/videobuf2-dma-sg.h>\n\n#include \"m00233_video_measure_memmap_package.h\"\n#include \"m00235_fdma_packer_memmap_package.h\"\n#include \"m00389_cvi_memmap_package.h\"\n#include \"m00460_evcnt_memmap_package.h\"\n#include \"m00473_freewheel_memmap_package.h\"\n#include \"m00479_clk_loss_detector_memmap_package.h\"\n#include \"m00514_syncgen_flow_evcnt_memmap_package.h\"\n\n \n#define PCI_DEVICE_ID_COBALT\t0x2732\n\n \n#define COBALT_NUM_INPUTS\t4\n#define COBALT_NUM_NODES\t6\n\n \n#define COBALT_NUM_STREAMS\t12\n\n#define COBALT_HSMA_IN_NODE\t4\n#define COBALT_HSMA_OUT_NODE\t5\n\n \n#define COBALT_AUDIO_IN_STREAM\t6\n#define COBALT_AUDIO_OUT_STREAM 11\n\n \n#define DMA_CHANNELS_MAX\t16\n\n \n#define I2C_CLIENTS_MAX\t\t16\n#define COBALT_NUM_ADAPTERS\t5\n\n#define COBALT_CLK\t\t50000000\n\n \n#define COBALT_SYSSTAT_DIP0_MSK\t\t\tBIT(0)\n#define COBALT_SYSSTAT_DIP1_MSK\t\t\tBIT(1)\n#define COBALT_SYSSTAT_HSMA_PRSNTN_MSK\t\tBIT(2)\n#define COBALT_SYSSTAT_FLASH_RDYBSYN_MSK\tBIT(3)\n#define COBALT_SYSSTAT_VI0_5V_MSK\t\tBIT(4)\n#define COBALT_SYSSTAT_VI0_INT1_MSK\t\tBIT(5)\n#define COBALT_SYSSTAT_VI0_INT2_MSK\t\tBIT(6)\n#define COBALT_SYSSTAT_VI0_LOST_DATA_MSK\tBIT(7)\n#define COBALT_SYSSTAT_VI1_5V_MSK\t\tBIT(8)\n#define COBALT_SYSSTAT_VI1_INT1_MSK\t\tBIT(9)\n#define COBALT_SYSSTAT_VI1_INT2_MSK\t\tBIT(10)\n#define COBALT_SYSSTAT_VI1_LOST_DATA_MSK\tBIT(11)\n#define COBALT_SYSSTAT_VI2_5V_MSK\t\tBIT(12)\n#define COBALT_SYSSTAT_VI2_INT1_MSK\t\tBIT(13)\n#define COBALT_SYSSTAT_VI2_INT2_MSK\t\tBIT(14)\n#define COBALT_SYSSTAT_VI2_LOST_DATA_MSK\tBIT(15)\n#define COBALT_SYSSTAT_VI3_5V_MSK\t\tBIT(16)\n#define COBALT_SYSSTAT_VI3_INT1_MSK\t\tBIT(17)\n#define COBALT_SYSSTAT_VI3_INT2_MSK\t\tBIT(18)\n#define COBALT_SYSSTAT_VI3_LOST_DATA_MSK\tBIT(19)\n#define COBALT_SYSSTAT_VIHSMA_5V_MSK\t\tBIT(20)\n#define COBALT_SYSSTAT_VIHSMA_INT1_MSK\t\tBIT(21)\n#define COBALT_SYSSTAT_VIHSMA_INT2_MSK\t\tBIT(22)\n#define COBALT_SYSSTAT_VIHSMA_LOST_DATA_MSK\tBIT(23)\n#define COBALT_SYSSTAT_VOHSMA_INT1_MSK\t\tBIT(24)\n#define COBALT_SYSSTAT_VOHSMA_PLL_LOCKED_MSK\tBIT(25)\n#define COBALT_SYSSTAT_VOHSMA_LOST_DATA_MSK\tBIT(26)\n#define COBALT_SYSSTAT_AUD_PLL_LOCKED_MSK\tBIT(28)\n#define COBALT_SYSSTAT_AUD_IN_LOST_DATA_MSK\tBIT(29)\n#define COBALT_SYSSTAT_AUD_OUT_LOST_DATA_MSK\tBIT(30)\n#define COBALT_SYSSTAT_PCIE_SMBCLK_MSK\t\tBIT(31)\n\n \n#define COBALT_I2C_0_BASE\t\t\t0x0\n#define COBALT_I2C_1_BASE\t\t\t0x080\n#define COBALT_I2C_2_BASE\t\t\t0x100\n#define COBALT_I2C_3_BASE\t\t\t0x180\n#define COBALT_I2C_HSMA_BASE\t\t\t0x200\n\n#define COBALT_SYS_CTRL_BASE\t\t\t0x400\n#define COBALT_SYS_CTRL_HSMA_TX_ENABLE_BIT\t1\n#define COBALT_SYS_CTRL_VIDEO_RX_RESETN_BIT(n)\t(4 + 4 * (n))\n#define COBALT_SYS_CTRL_NRESET_TO_HDMI_BIT(n)\t(5 + 4 * (n))\n#define COBALT_SYS_CTRL_HPD_TO_CONNECTOR_BIT(n)\t(6 + 4 * (n))\n#define COBALT_SYS_CTRL_AUDIO_IPP_RESETN_BIT(n)\t(7 + 4 * (n))\n#define COBALT_SYS_CTRL_PWRDN0_TO_HSMA_TX_BIT\t24\n#define COBALT_SYS_CTRL_VIDEO_TX_RESETN_BIT\t25\n#define COBALT_SYS_CTRL_AUDIO_OPP_RESETN_BIT\t27\n\n#define COBALT_SYS_STAT_BASE\t\t\t0x500\n#define COBALT_SYS_STAT_MASK\t\t\t(COBALT_SYS_STAT_BASE + 0x08)\n#define COBALT_SYS_STAT_EDGE\t\t\t(COBALT_SYS_STAT_BASE + 0x0c)\n\n#define COBALT_HDL_INFO_BASE\t\t\t0x4800\n#define COBALT_HDL_INFO_SIZE\t\t\t0x200\n\n#define COBALT_VID_BASE\t\t\t\t0x10000\n#define COBALT_VID_SIZE\t\t\t\t0x1000\n\n#define COBALT_CVI(cobalt, c) \\\n\t(cobalt->bar1 + COBALT_VID_BASE + (c) * COBALT_VID_SIZE)\n#define COBALT_CVI_VMR(cobalt, c) \\\n\t(cobalt->bar1 + COBALT_VID_BASE + (c) * COBALT_VID_SIZE + 0x100)\n#define COBALT_CVI_EVCNT(cobalt, c) \\\n\t(cobalt->bar1 + COBALT_VID_BASE + (c) * COBALT_VID_SIZE + 0x200)\n#define COBALT_CVI_FREEWHEEL(cobalt, c) \\\n\t(cobalt->bar1 + COBALT_VID_BASE + (c) * COBALT_VID_SIZE + 0x300)\n#define COBALT_CVI_CLK_LOSS(cobalt, c) \\\n\t(cobalt->bar1 + COBALT_VID_BASE + (c) * COBALT_VID_SIZE + 0x400)\n#define COBALT_CVI_PACKER(cobalt, c) \\\n\t(cobalt->bar1 + COBALT_VID_BASE + (c) * COBALT_VID_SIZE + 0x500)\n\n#define COBALT_TX_BASE(cobalt) (cobalt->bar1 + COBALT_VID_BASE + 0x5000)\n\n#define DMA_INTERRUPT_STATUS_REG\t\t0x08\n\n#define COBALT_HDL_SEARCH_STR\t\t\t\"** HDL version info **\"\n\n \n#define COBALT_BUS_BAR1_BASE\t\t\t0x600\n#define COBALT_BUS_SRAM_BASE\t\t\t0x0\n#define COBALT_BUS_CPLD_BASE\t\t\t0x00600000\n#define COBALT_BUS_FLASH_BASE\t\t\t0x08000000\n\n \n#define COBALT_BYTES_PER_PIXEL_YUYV\t\t2\n#define COBALT_BYTES_PER_PIXEL_RGB24\t\t3\n#define COBALT_BYTES_PER_PIXEL_RGB32\t\t4\n\n \nextern int cobalt_debug;\nextern int cobalt_ignore_err;\n\n#define cobalt_err(fmt, arg...)  v4l2_err(&cobalt->v4l2_dev, fmt, ## arg)\n#define cobalt_warn(fmt, arg...) v4l2_warn(&cobalt->v4l2_dev, fmt, ## arg)\n#define cobalt_info(fmt, arg...) v4l2_info(&cobalt->v4l2_dev, fmt, ## arg)\n#define cobalt_dbg(level, fmt, arg...) \\\n\tv4l2_dbg(level, cobalt_debug, &cobalt->v4l2_dev, fmt, ## arg)\n\nstruct cobalt;\nstruct cobalt_i2c_regs;\n\n \nstruct cobalt_i2c_data {\n\tstruct cobalt *cobalt;\n\tstruct cobalt_i2c_regs __iomem *regs;\n};\n\nstruct pci_consistent_buffer {\n\tvoid *virt;\n\tdma_addr_t bus;\n\tsize_t bytes;\n};\n\nstruct sg_dma_desc_info {\n\tvoid *virt;\n\tdma_addr_t bus;\n\tunsigned size;\n\tvoid *last_desc_virt;\n\tstruct device *dev;\n};\n\n#define COBALT_MAX_WIDTH\t\t\t1920\n#define COBALT_MAX_HEIGHT\t\t\t1200\n#define COBALT_MAX_BPP\t\t\t\t3\n#define COBALT_MAX_FRAMESZ \\\n\t(COBALT_MAX_WIDTH * COBALT_MAX_HEIGHT * COBALT_MAX_BPP)\n\n#define NR_BUFS\t\t\t\t\tVIDEO_MAX_FRAME\n\n#define COBALT_STREAM_FL_DMA_IRQ\t\t0\n#define COBALT_STREAM_FL_ADV_IRQ\t\t1\n\nstruct cobalt_buffer {\n\tstruct vb2_v4l2_buffer vb;\n\tstruct list_head list;\n};\n\nstatic inline\nstruct cobalt_buffer *to_cobalt_buffer(struct vb2_v4l2_buffer *vb2)\n{\n\treturn container_of(vb2, struct cobalt_buffer, vb);\n}\n\nstruct cobalt_stream {\n\tstruct video_device vdev;\n\tstruct vb2_queue q;\n\tstruct list_head bufs;\n\tstruct i2c_adapter *i2c_adap;\n\tstruct v4l2_subdev *sd;\n\tstruct mutex lock;\n\tspinlock_t irqlock;\n\tstruct v4l2_dv_timings timings;\n\tu32 input;\n\tu32 pad_source;\n\tu32 width, height, bpp;\n\tu32 stride;\n\tu32 pixfmt;\n\tu32 sequence;\n\tu32 colorspace;\n\tu32 xfer_func;\n\tu32 ycbcr_enc;\n\tu32 quantization;\n\n\tu8 dma_channel;\n\tint video_channel;\n\tunsigned dma_fifo_mask;\n\tunsigned adv_irq_mask;\n\tstruct sg_dma_desc_info dma_desc_info[NR_BUFS];\n\tunsigned long flags;\n\tbool unstable_frame;\n\tbool enable_cvi;\n\tbool enable_freewheel;\n\tunsigned skip_first_frames;\n\tbool is_output;\n\tbool is_audio;\n\tbool is_dummy;\n\n\tstruct cobalt *cobalt;\n\tstruct snd_cobalt_card *alsa;\n};\n\nstruct snd_cobalt_card;\n\n \nstruct cobalt {\n\tint instance;\n\tstruct pci_dev *pci_dev;\n\tstruct v4l2_device v4l2_dev;\n\t \n\tstruct mutex pci_lock;\n\n\tvoid __iomem *bar0, *bar1;\n\n\tu8 card_rev;\n\tu16 device_id;\n\n\t \n\tstruct cobalt_stream streams[DMA_CHANNELS_MAX];\n\tstruct i2c_adapter i2c_adap[COBALT_NUM_ADAPTERS];\n\tstruct cobalt_i2c_data i2c_data[COBALT_NUM_ADAPTERS];\n\tbool have_hsma_rx;\n\tbool have_hsma_tx;\n\n\t \n\tstruct workqueue_struct *irq_work_queues;\n\tstruct work_struct irq_work_queue;               \n\t \n\tu32 irq_adv1;\n\tu32 irq_adv2;\n\tu32 irq_advout;\n\tu32 irq_dma_tot;\n\tu32 irq_dma[COBALT_NUM_STREAMS];\n\tu32 irq_none;\n\tu32 irq_full_fifo;\n\n\t \n\tint dma_channels;\n\tint first_fifo_channel;\n\tbool pci_32_bit;\n\n\tchar hdl_info[COBALT_HDL_INFO_SIZE];\n\n\t \n\tstruct mtd_info *mtd;\n};\n\nstatic inline struct cobalt *to_cobalt(struct v4l2_device *v4l2_dev)\n{\n\treturn container_of(v4l2_dev, struct cobalt, v4l2_dev);\n}\n\nstatic inline void cobalt_write_bar0(struct cobalt *cobalt, u32 reg, u32 val)\n{\n\tiowrite32(val, cobalt->bar0 + reg);\n}\n\nstatic inline u32 cobalt_read_bar0(struct cobalt *cobalt, u32 reg)\n{\n\treturn ioread32(cobalt->bar0 + reg);\n}\n\nstatic inline void cobalt_write_bar1(struct cobalt *cobalt, u32 reg, u32 val)\n{\n\tiowrite32(val, cobalt->bar1 + reg);\n}\n\nstatic inline u32 cobalt_read_bar1(struct cobalt *cobalt, u32 reg)\n{\n\treturn ioread32(cobalt->bar1 + reg);\n}\n\nstatic inline u32 cobalt_g_sysctrl(struct cobalt *cobalt)\n{\n\treturn cobalt_read_bar1(cobalt, COBALT_SYS_CTRL_BASE);\n}\n\nstatic inline void cobalt_s_bit_sysctrl(struct cobalt *cobalt,\n\t\t\t\t\tint bit, int val)\n{\n\tu32 ctrl;\n\n\tmutex_lock(&cobalt->pci_lock);\n\tctrl = cobalt_read_bar1(cobalt, COBALT_SYS_CTRL_BASE);\n\tcobalt_write_bar1(cobalt, COBALT_SYS_CTRL_BASE,\n\t\t\t(ctrl & ~(1UL << bit)) | (val << bit));\n\tmutex_unlock(&cobalt->pci_lock);\n}\n\nstatic inline u32 cobalt_g_sysstat(struct cobalt *cobalt)\n{\n\treturn cobalt_read_bar1(cobalt, COBALT_SYS_STAT_BASE);\n}\n\n#define ADRS_REG (bar1 + COBALT_BUS_BAR1_BASE + 0)\n#define LOWER_DATA (bar1 + COBALT_BUS_BAR1_BASE + 4)\n#define UPPER_DATA (bar1 + COBALT_BUS_BAR1_BASE + 6)\n\nstatic inline u32 cobalt_bus_read32(void __iomem *bar1, u32 bus_adrs)\n{\n\tiowrite32(bus_adrs, ADRS_REG);\n\treturn ioread32(LOWER_DATA);\n}\n\nstatic inline void cobalt_bus_write16(void __iomem *bar1,\n\t\t\t\t      u32 bus_adrs, u16 data)\n{\n\tiowrite32(bus_adrs, ADRS_REG);\n\tif (bus_adrs & 2)\n\t\tiowrite16(data, UPPER_DATA);\n\telse\n\t\tiowrite16(data, LOWER_DATA);\n}\n\nstatic inline void cobalt_bus_write32(void __iomem *bar1,\n\t\t\t\t      u32 bus_adrs, u16 data)\n{\n\tiowrite32(bus_adrs, ADRS_REG);\n\tif (bus_adrs & 2)\n\t\tiowrite32(data, UPPER_DATA);\n\telse\n\t\tiowrite32(data, LOWER_DATA);\n}\n\n \n\nvoid cobalt_pcie_status_show(struct cobalt *cobalt);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}