{
  "module_name": "cobalt-alsa-main.c",
  "hash_id": "7908b32ceca751f7ff2ea857abb44c2743ef92eeb6fc945add9a0ac1e3567498",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/cobalt/cobalt-alsa-main.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/spinlock.h>\n\n#include <media/v4l2-device.h>\n\n#include <sound/core.h>\n#include <sound/initval.h>\n\n#include \"cobalt-driver.h\"\n#include \"cobalt-alsa.h\"\n#include \"cobalt-alsa-pcm.h\"\n\nstatic void snd_cobalt_card_free(struct snd_cobalt_card *cobsc)\n{\n\tif (cobsc == NULL)\n\t\treturn;\n\n\tcobsc->s->alsa = NULL;\n\n\tkfree(cobsc);\n}\n\nstatic void snd_cobalt_card_private_free(struct snd_card *sc)\n{\n\tif (sc == NULL)\n\t\treturn;\n\tsnd_cobalt_card_free(sc->private_data);\n\tsc->private_data = NULL;\n\tsc->private_free = NULL;\n}\n\nstatic int snd_cobalt_card_create(struct cobalt_stream *s,\n\t\t\t\t       struct snd_card *sc,\n\t\t\t\t       struct snd_cobalt_card **cobsc)\n{\n\t*cobsc = kzalloc(sizeof(struct snd_cobalt_card), GFP_KERNEL);\n\tif (*cobsc == NULL)\n\t\treturn -ENOMEM;\n\n\t(*cobsc)->s = s;\n\t(*cobsc)->sc = sc;\n\n\tsc->private_data = *cobsc;\n\tsc->private_free = snd_cobalt_card_private_free;\n\n\treturn 0;\n}\n\nstatic int snd_cobalt_card_set_names(struct snd_cobalt_card *cobsc)\n{\n\tstruct cobalt_stream *s = cobsc->s;\n\tstruct cobalt *cobalt = s->cobalt;\n\tstruct snd_card *sc = cobsc->sc;\n\n\t \n\tstrscpy(sc->driver, \"cobalt\", sizeof(sc->driver));\n\n\t \n\tsnprintf(sc->shortname,  sizeof(sc->shortname), \"cobalt-%d-%d\",\n\t\t cobalt->instance, s->video_channel);\n\n\t \n\tsnprintf(sc->longname, sizeof(sc->longname),\n\t\t \"Cobalt %d HDMI %d\",\n\t\t cobalt->instance, s->video_channel);\n\n\treturn 0;\n}\n\nint cobalt_alsa_init(struct cobalt_stream *s)\n{\n\tstruct cobalt *cobalt = s->cobalt;\n\tstruct snd_card *sc = NULL;\n\tstruct snd_cobalt_card *cobsc;\n\tint ret;\n\n\t \n\n\t \n\t \n\n\t \n\tret = snd_card_new(&cobalt->pci_dev->dev, SNDRV_DEFAULT_IDX1,\n\t\t\t   SNDRV_DEFAULT_STR1, THIS_MODULE, 0, &sc);\n\tif (ret) {\n\t\tcobalt_err(\"snd_card_new() failed with err %d\\n\", ret);\n\t\tgoto err_exit;\n\t}\n\n\t \n\tret = snd_cobalt_card_create(s, sc, &cobsc);\n\tif (ret) {\n\t\tcobalt_err(\"snd_cobalt_card_create() failed with err %d\\n\",\n\t\t\t   ret);\n\t\tgoto err_exit_free;\n\t}\n\n\t \n\tsnd_cobalt_card_set_names(cobsc);\n\n\tret = snd_cobalt_pcm_create(cobsc);\n\tif (ret) {\n\t\tcobalt_err(\"snd_cobalt_pcm_create() failed with err %d\\n\",\n\t\t\t   ret);\n\t\tgoto err_exit_free;\n\t}\n\t \n\n\t \n\t \n\ts->alsa = cobsc;\n\n\t \n\tret = snd_card_register(sc);\n\tif (ret) {\n\t\ts->alsa = NULL;\n\t\tcobalt_err(\"snd_card_register() failed with err %d\\n\", ret);\n\t\tgoto err_exit_free;\n\t}\n\n\treturn 0;\n\nerr_exit_free:\n\tif (sc != NULL)\n\t\tsnd_card_free(sc);\n\tkfree(cobsc);\nerr_exit:\n\treturn ret;\n}\n\nvoid cobalt_alsa_exit(struct cobalt_stream *s)\n{\n\tstruct snd_cobalt_card *cobsc = s->alsa;\n\n\tif (cobsc)\n\t\tsnd_card_free(cobsc->sc);\n\ts->alsa = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}