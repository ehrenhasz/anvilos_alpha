{
  "module_name": "mantis_evm.c",
  "hash_id": "51a0dc9a5a0af84f8864e1917e40a0f4efd801c4c3b091f970c74244a687b6fe",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/mantis/mantis_evm.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n\n#include <linux/signal.h>\n#include <linux/sched.h>\n#include <linux/interrupt.h>\n#include <asm/io.h>\n\n#include <media/dmxdev.h>\n#include <media/dvbdev.h>\n#include <media/dvb_demux.h>\n#include <media/dvb_frontend.h>\n#include <media/dvb_net.h>\n\n#include \"mantis_common.h\"\n#include \"mantis_link.h\"\n#include \"mantis_hif.h\"\n#include \"mantis_reg.h\"\n\nstatic void mantis_hifevm_work(struct work_struct *work)\n{\n\tstruct mantis_ca *ca = container_of(work, struct mantis_ca, hif_evm_work);\n\tstruct mantis_pci *mantis = ca->ca_priv;\n\n\tu32 gpif_stat;\n\n\tgpif_stat = mmread(MANTIS_GPIF_STATUS);\n\n\tif (gpif_stat & MANTIS_GPIF_DETSTAT) {\n\t\tif (gpif_stat & MANTIS_CARD_PLUGIN) {\n\t\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): CAM Plugin\", mantis->num);\n\t\t\tmmwrite(0xdada0000, MANTIS_CARD_RESET);\n\t\t\tmantis_event_cam_plugin(ca);\n\t\t\tdvb_ca_en50221_camchange_irq(&ca->en50221,\n\t\t\t\t\t\t     0,\n\t\t\t\t\t\t     DVB_CA_EN50221_CAMCHANGE_INSERTED);\n\t\t}\n\t} else {\n\t\tif (gpif_stat & MANTIS_CARD_PLUGOUT) {\n\t\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): CAM Unplug\", mantis->num);\n\t\t\tmmwrite(0xdada0000, MANTIS_CARD_RESET);\n\t\t\tmantis_event_cam_unplug(ca);\n\t\t\tdvb_ca_en50221_camchange_irq(&ca->en50221,\n\t\t\t\t\t\t     0,\n\t\t\t\t\t\t     DVB_CA_EN50221_CAMCHANGE_REMOVED);\n\t\t}\n\t}\n\n\tif (mantis->gpif_status & MANTIS_GPIF_EXTIRQ)\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): Ext IRQ\", mantis->num);\n\n\tif (mantis->gpif_status & MANTIS_SBUF_WSTO)\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): Smart Buffer Timeout\", mantis->num);\n\n\tif (mantis->gpif_status & MANTIS_GPIF_OTHERR)\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): Alignment Error\", mantis->num);\n\n\tif (gpif_stat & MANTIS_SBUF_OVFLW)\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): Smart Buffer Overflow\", mantis->num);\n\n\tif (gpif_stat & MANTIS_GPIF_BRRDY)\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): Smart Buffer Read Ready\", mantis->num);\n\n\tif (gpif_stat & MANTIS_GPIF_INTSTAT)\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): GPIF IRQ\", mantis->num);\n\n\tif (gpif_stat & MANTIS_SBUF_EMPTY)\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): Smart Buffer Empty\", mantis->num);\n\n\tif (gpif_stat & MANTIS_SBUF_OPDONE) {\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event Mgr: Adapter(%d) Slot(0): Smart Buffer operation complete\", mantis->num);\n\t\tca->sbuf_status = MANTIS_SBUF_DATA_AVAIL;\n\t\tca->hif_event = MANTIS_SBUF_OPDONE;\n\t\twake_up(&ca->hif_opdone_wq);\n\t}\n}\n\nint mantis_evmgr_init(struct mantis_ca *ca)\n{\n\tstruct mantis_pci *mantis = ca->ca_priv;\n\n\tdprintk(MANTIS_DEBUG, 1, \"Initializing Mantis Host I/F Event manager\");\n\tINIT_WORK(&ca->hif_evm_work, mantis_hifevm_work);\n\tmantis_pcmcia_init(ca);\n\tschedule_work(&ca->hif_evm_work);\n\tmantis_hif_init(ca);\n\treturn 0;\n}\n\nvoid mantis_evmgr_exit(struct mantis_ca *ca)\n{\n\tstruct mantis_pci *mantis = ca->ca_priv;\n\n\tdprintk(MANTIS_DEBUG, 1, \"Mantis Host I/F Event manager exiting\");\n\tflush_work(&ca->hif_evm_work);\n\tmantis_hif_exit(ca);\n\tmantis_pcmcia_exit(ca);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}