{
  "module_name": "mantis_ioc.c",
  "hash_id": "6faccb0f103aa0c7e76a30e6cd64db14230bff1afb89a7d76156a92b91c2770b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/mantis/mantis_ioc.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/i2c.h>\n\n#include <linux/signal.h>\n#include <linux/sched.h>\n#include <linux/interrupt.h>\n#include <asm/io.h>\n\n#include <media/dmxdev.h>\n#include <media/dvbdev.h>\n#include <media/dvb_demux.h>\n#include <media/dvb_frontend.h>\n#include <media/dvb_net.h>\n\n#include \"mantis_common.h\"\n#include \"mantis_reg.h\"\n#include \"mantis_ioc.h\"\n\nstatic int read_eeprom_bytes(struct mantis_pci *mantis, u8 reg, u8 *data, u8 length)\n{\n\tstruct i2c_adapter *adapter = &mantis->adapter;\n\tint err;\n\tu8 buf = reg;\n\n\tstruct i2c_msg msg[] = {\n\t\t{ .addr = 0x50, .flags = 0, .buf = &buf, .len = 1 },\n\t\t{ .addr = 0x50, .flags = I2C_M_RD, .buf = data, .len = length },\n\t};\n\n\terr = i2c_transfer(adapter, msg, 2);\n\tif (err < 0) {\n\t\tdprintk(MANTIS_ERROR, 1, \"ERROR: i2c read: < err=%i d0=0x%02x d1=0x%02x >\",\n\t\t\terr, data[0], data[1]);\n\n\t\treturn err;\n\t}\n\n\treturn 0;\n}\nint mantis_get_mac(struct mantis_pci *mantis)\n{\n\tint err;\n\tu8 mac_addr[6] = {0};\n\n\terr = read_eeprom_bytes(mantis, 0x08, mac_addr, 6);\n\tif (err < 0) {\n\t\tdprintk(MANTIS_ERROR, 1, \"ERROR: Mantis EEPROM read error <%d>\", err);\n\n\t\treturn err;\n\t}\n\n\tdprintk(MANTIS_ERROR, 0, \"    MAC Address=[%pM]\\n\", mac_addr);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(mantis_get_mac);\n\n \nvoid mantis_gpio_set_bits(struct mantis_pci *mantis, u32 bitpos, u8 value)\n{\n\tu32 cur;\n\n\tdprintk(MANTIS_DEBUG, 1, \"Set Bit <%d> to <%d>\", bitpos, value);\n\tcur = mmread(MANTIS_GPIF_ADDR);\n\tif (value)\n\t\tmantis->gpio_status = cur | (1 << bitpos);\n\telse\n\t\tmantis->gpio_status = cur & (~(1 << bitpos));\n\n\tdprintk(MANTIS_DEBUG, 1, \"GPIO Value <%02x>\", mantis->gpio_status);\n\tmmwrite(mantis->gpio_status, MANTIS_GPIF_ADDR);\n\tmmwrite(0x00, MANTIS_GPIF_DOUT);\n}\nEXPORT_SYMBOL_GPL(mantis_gpio_set_bits);\n\nint mantis_stream_control(struct mantis_pci *mantis, enum mantis_stream_control stream_ctl)\n{\n\tu32 reg;\n\n\treg = mmread(MANTIS_CONTROL);\n\tswitch (stream_ctl) {\n\tcase STREAM_TO_HIF:\n\t\tdprintk(MANTIS_DEBUG, 1, \"Set stream to HIF\");\n\t\treg &= 0xff - MANTIS_BYPASS;\n\t\tmmwrite(reg, MANTIS_CONTROL);\n\t\treg |= MANTIS_BYPASS;\n\t\tmmwrite(reg, MANTIS_CONTROL);\n\t\tbreak;\n\n\tcase STREAM_TO_CAM:\n\t\tdprintk(MANTIS_DEBUG, 1, \"Set stream to CAM\");\n\t\treg |= MANTIS_BYPASS;\n\t\tmmwrite(reg, MANTIS_CONTROL);\n\t\treg &= 0xff - MANTIS_BYPASS;\n\t\tmmwrite(reg, MANTIS_CONTROL);\n\t\tbreak;\n\tdefault:\n\t\tdprintk(MANTIS_ERROR, 1, \"Unknown MODE <%02x>\", stream_ctl);\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(mantis_stream_control);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}