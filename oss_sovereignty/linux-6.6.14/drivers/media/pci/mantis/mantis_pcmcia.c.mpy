{
  "module_name": "mantis_pcmcia.c",
  "hash_id": "d243b5105582a575ad1bf44e9e00bb834062a0d29f5f95370890d1b78485165a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/mantis/mantis_pcmcia.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n\n#include <linux/signal.h>\n#include <linux/sched.h>\n#include <linux/interrupt.h>\n#include <asm/io.h>\n\n#include <media/dmxdev.h>\n#include <media/dvbdev.h>\n#include <media/dvb_demux.h>\n#include <media/dvb_frontend.h>\n#include <media/dvb_net.h>\n\n#include \"mantis_common.h\"\n#include \"mantis_link.h\"  \n#include \"mantis_reg.h\"\n\n \nvoid mantis_event_cam_plugin(struct mantis_ca *ca)\n{\n\tstruct mantis_pci *mantis = ca->ca_priv;\n\n\tu32 gpif_irqcfg;\n\n\tif (ca->slot_state == MODULE_XTRACTED) {\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event: CAM Plugged IN: Adapter(%d) Slot(0)\", mantis->num);\n\t\tudelay(50);\n\t\tmmwrite(0xda000000, MANTIS_CARD_RESET);\n\t\tgpif_irqcfg  = mmread(MANTIS_GPIF_IRQCFG);\n\t\tgpif_irqcfg |= MANTIS_MASK_PLUGOUT;\n\t\tgpif_irqcfg &= ~MANTIS_MASK_PLUGIN;\n\t\tmmwrite(gpif_irqcfg, MANTIS_GPIF_IRQCFG);\n\t\tudelay(500);\n\t\tca->slot_state = MODULE_INSERTED;\n\t}\n\tudelay(100);\n}\n\n \nvoid mantis_event_cam_unplug(struct mantis_ca *ca)\n{\n\tstruct mantis_pci *mantis = ca->ca_priv;\n\n\tu32 gpif_irqcfg;\n\n\tif (ca->slot_state == MODULE_INSERTED) {\n\t\tdprintk(MANTIS_DEBUG, 1, \"Event: CAM Unplugged: Adapter(%d) Slot(0)\", mantis->num);\n\t\tudelay(50);\n\t\tmmwrite(0x00da0000, MANTIS_CARD_RESET);\n\t\tgpif_irqcfg  = mmread(MANTIS_GPIF_IRQCFG);\n\t\tgpif_irqcfg |= MANTIS_MASK_PLUGIN;\n\t\tgpif_irqcfg &= ~MANTIS_MASK_PLUGOUT;\n\t\tmmwrite(gpif_irqcfg, MANTIS_GPIF_IRQCFG);\n\t\tudelay(500);\n\t\tca->slot_state = MODULE_XTRACTED;\n\t}\n\tudelay(100);\n}\n\nint mantis_pcmcia_init(struct mantis_ca *ca)\n{\n\tstruct mantis_pci *mantis = ca->ca_priv;\n\n\tu32 gpif_stat, card_stat;\n\n\tmantis_unmask_ints(mantis, MANTIS_INT_IRQ0);\n\tgpif_stat = mmread(MANTIS_GPIF_STATUS);\n\tcard_stat = mmread(MANTIS_GPIF_IRQCFG);\n\n\tif (gpif_stat & MANTIS_GPIF_DETSTAT) {\n\t\tdprintk(MANTIS_DEBUG, 1, \"CAM found on Adapter(%d) Slot(0)\", mantis->num);\n\t\tmmwrite(card_stat | MANTIS_MASK_PLUGOUT, MANTIS_GPIF_IRQCFG);\n\t\tca->slot_state = MODULE_INSERTED;\n\t\tdvb_ca_en50221_camchange_irq(&ca->en50221,\n\t\t\t\t\t     0,\n\t\t\t\t\t     DVB_CA_EN50221_CAMCHANGE_INSERTED);\n\t} else {\n\t\tdprintk(MANTIS_DEBUG, 1, \"Empty Slot on Adapter(%d) Slot(0)\", mantis->num);\n\t\tmmwrite(card_stat | MANTIS_MASK_PLUGIN, MANTIS_GPIF_IRQCFG);\n\t\tca->slot_state = MODULE_XTRACTED;\n\t\tdvb_ca_en50221_camchange_irq(&ca->en50221,\n\t\t\t\t\t     0,\n\t\t\t\t\t     DVB_CA_EN50221_CAMCHANGE_REMOVED);\n\t}\n\n\treturn 0;\n}\n\nvoid mantis_pcmcia_exit(struct mantis_ca *ca)\n{\n\tstruct mantis_pci *mantis = ca->ca_priv;\n\n\tmmwrite(mmread(MANTIS_GPIF_STATUS) & (~MANTIS_CARD_PLUGOUT | ~MANTIS_CARD_PLUGIN), MANTIS_GPIF_STATUS);\n\tmantis_mask_ints(mantis, MANTIS_INT_IRQ0);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}