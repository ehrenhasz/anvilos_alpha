{
  "module_name": "mantis_vp1041.c",
  "hash_id": "647a927d4c2388325475d874ec4fff5a43a8fdc715a1a5dc4056621daf0c0d05",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/mantis/mantis_vp1041.c",
  "human_readable_source": "\n \n\n#include <linux/signal.h>\n#include <linux/sched.h>\n#include <linux/interrupt.h>\n\n#include <media/dmxdev.h>\n#include <media/dvbdev.h>\n#include <media/dvb_demux.h>\n#include <media/dvb_frontend.h>\n#include <media/dvb_net.h>\n\n#include \"mantis_common.h\"\n#include \"mantis_ioc.h\"\n#include \"mantis_dvb.h\"\n#include \"mantis_vp1041.h\"\n#include \"stb0899_reg.h\"\n#include \"stb0899_drv.h\"\n#include \"stb0899_cfg.h\"\n#include \"stb6100_cfg.h\"\n#include \"stb6100.h\"\n#include \"lnbp21.h\"\n\n#define MANTIS_MODEL_NAME\t\"VP-1041\"\n#define MANTIS_DEV_TYPE\t\t\"DSS/DVB-S/DVB-S2\"\n\nstatic const struct stb0899_s1_reg vp1041_stb0899_s1_init_1[] = {\n\n\t \n\t{ STB0899_ACRPRESC\t\t, 0x11 },\n\t{ STB0899_ACRDIV1\t\t, 0x0a },\n\t{ STB0899_ACRDIV2\t\t, 0x05 },\n\t{ STB0899_DACR1\t\t\t, 0x00 },\n\t{ STB0899_DACR2\t\t\t, 0x00 },\n\t{ STB0899_OUTCFG\t\t, 0x00 },\n\t{ STB0899_MODECFG\t\t, 0x00 },\n\t{ STB0899_IRQSTATUS_3\t\t, 0xfe },\n\t{ STB0899_IRQSTATUS_2\t\t, 0x03 },\n\t{ STB0899_IRQSTATUS_1\t\t, 0x7c },\n\t{ STB0899_IRQSTATUS_0\t\t, 0xf4 },\n\t{ STB0899_IRQMSK_3\t\t, 0xf3 },\n\t{ STB0899_IRQMSK_2\t\t, 0xfc },\n\t{ STB0899_IRQMSK_1\t\t, 0xff },\n\t{ STB0899_IRQMSK_0\t\t, 0xff },\n\t{ STB0899_IRQCFG\t\t, 0x00 },\n\t{ STB0899_I2CCFG\t\t, 0x88 },\n\t{ STB0899_I2CRPT\t\t, 0x58 },\n\t{ STB0899_IOPVALUE5\t\t, 0x00 },\n\t{ STB0899_IOPVALUE4\t\t, 0x33 },\n\t{ STB0899_IOPVALUE3\t\t, 0x6d },\n\t{ STB0899_IOPVALUE2\t\t, 0x90 },\n\t{ STB0899_IOPVALUE1\t\t, 0x60 },\n\t{ STB0899_IOPVALUE0\t\t, 0x00 },\n\t{ STB0899_GPIO00CFG\t\t, 0x82 },\n\t{ STB0899_GPIO01CFG\t\t, 0x82 },\n\t{ STB0899_GPIO02CFG\t\t, 0x82 },\n\t{ STB0899_GPIO03CFG\t\t, 0x82 },\n\t{ STB0899_GPIO04CFG\t\t, 0x82 },\n\t{ STB0899_GPIO05CFG\t\t, 0x82 },\n\t{ STB0899_GPIO06CFG\t\t, 0x82 },\n\t{ STB0899_GPIO07CFG\t\t, 0x82 },\n\t{ STB0899_GPIO08CFG\t\t, 0x82 },\n\t{ STB0899_GPIO09CFG\t\t, 0x82 },\n\t{ STB0899_GPIO10CFG\t\t, 0x82 },\n\t{ STB0899_GPIO11CFG\t\t, 0x82 },\n\t{ STB0899_GPIO12CFG\t\t, 0x82 },\n\t{ STB0899_GPIO13CFG\t\t, 0x82 },\n\t{ STB0899_GPIO14CFG\t\t, 0x82 },\n\t{ STB0899_GPIO15CFG\t\t, 0x82 },\n\t{ STB0899_GPIO16CFG\t\t, 0x82 },\n\t{ STB0899_GPIO17CFG\t\t, 0x82 },\n\t{ STB0899_GPIO18CFG\t\t, 0x82 },\n\t{ STB0899_GPIO19CFG\t\t, 0x82 },\n\t{ STB0899_GPIO20CFG\t\t, 0x82 },\n\t{ STB0899_SDATCFG\t\t, 0xb8 },\n\t{ STB0899_SCLTCFG\t\t, 0xba },\n\t{ STB0899_AGCRFCFG\t\t, 0x1c },  \n\t{ STB0899_GPIO22\t\t, 0x82 },  \n\t{ STB0899_GPIO21\t\t, 0x91 },  \n\t{ STB0899_DIRCLKCFG\t\t, 0x82 },\n\t{ STB0899_CLKOUT27CFG\t\t, 0x7e },\n\t{ STB0899_STDBYCFG\t\t, 0x82 },\n\t{ STB0899_CS0CFG\t\t, 0x82 },\n\t{ STB0899_CS1CFG\t\t, 0x82 },\n\t{ STB0899_DISEQCOCFG\t\t, 0x20 },\n\t{ STB0899_GPIO32CFG\t\t, 0x82 },\n\t{ STB0899_GPIO33CFG\t\t, 0x82 },\n\t{ STB0899_GPIO34CFG\t\t, 0x82 },\n\t{ STB0899_GPIO35CFG\t\t, 0x82 },\n\t{ STB0899_GPIO36CFG\t\t, 0x82 },\n\t{ STB0899_GPIO37CFG\t\t, 0x82 },\n\t{ STB0899_GPIO38CFG\t\t, 0x82 },\n\t{ STB0899_GPIO39CFG\t\t, 0x82 },\n\t{ STB0899_NCOARSE\t\t, 0x17 },  \n\t{ STB0899_SYNTCTRL\t\t, 0x02 },  \n\t{ STB0899_FILTCTRL\t\t, 0x00 },\n\t{ STB0899_SYSCTRL\t\t, 0x01 },\n\t{ STB0899_STOPCLK1\t\t, 0x20 },\n\t{ STB0899_STOPCLK2\t\t, 0x00 },\n\t{ STB0899_INTBUFSTATUS\t\t, 0x00 },\n\t{ STB0899_INTBUFCTRL\t\t, 0x0a },\n\t{ 0xffff\t\t\t, 0xff },\n};\n\nstatic const struct stb0899_s1_reg vp1041_stb0899_s1_init_3[] = {\n\t{ STB0899_DEMOD\t\t\t, 0x00 },\n\t{ STB0899_RCOMPC\t\t, 0xc9 },\n\t{ STB0899_AGC1CN\t\t, 0x01 },\n\t{ STB0899_AGC1REF\t\t, 0x10 },\n\t{ STB0899_RTC\t\t\t, 0x23 },\n\t{ STB0899_TMGCFG\t\t, 0x4e },\n\t{ STB0899_AGC2REF\t\t, 0x34 },\n\t{ STB0899_TLSR\t\t\t, 0x84 },\n\t{ STB0899_CFD\t\t\t, 0xf7 },\n\t{ STB0899_ACLC\t\t\t, 0x87 },\n\t{ STB0899_BCLC\t\t\t, 0x94 },\n\t{ STB0899_EQON\t\t\t, 0x41 },\n\t{ STB0899_LDT\t\t\t, 0xf1 },\n\t{ STB0899_LDT2\t\t\t, 0xe3 },\n\t{ STB0899_EQUALREF\t\t, 0xb4 },\n\t{ STB0899_TMGRAMP\t\t, 0x10 },\n\t{ STB0899_TMGTHD\t\t, 0x30 },\n\t{ STB0899_IDCCOMP\t\t, 0xfd },\n\t{ STB0899_QDCCOMP\t\t, 0xff },\n\t{ STB0899_POWERI\t\t, 0x0c },\n\t{ STB0899_POWERQ\t\t, 0x0f },\n\t{ STB0899_RCOMP\t\t\t, 0x6c },\n\t{ STB0899_AGCIQIN\t\t, 0x80 },\n\t{ STB0899_AGC2I1\t\t, 0x06 },\n\t{ STB0899_AGC2I2\t\t, 0x00 },\n\t{ STB0899_TLIR\t\t\t, 0x30 },\n\t{ STB0899_RTF\t\t\t, 0x7f },\n\t{ STB0899_DSTATUS\t\t, 0x00 },\n\t{ STB0899_LDI\t\t\t, 0xbc },\n\t{ STB0899_CFRM\t\t\t, 0xea },\n\t{ STB0899_CFRL\t\t\t, 0x31 },\n\t{ STB0899_NIRM\t\t\t, 0x2b },\n\t{ STB0899_NIRL\t\t\t, 0x80 },\n\t{ STB0899_ISYMB\t\t\t, 0x1d },\n\t{ STB0899_QSYMB\t\t\t, 0xa6 },\n\t{ STB0899_SFRH\t\t\t, 0x2f },\n\t{ STB0899_SFRM\t\t\t, 0x68 },\n\t{ STB0899_SFRL\t\t\t, 0x40 },\n\t{ STB0899_SFRUPH\t\t, 0x2f },\n\t{ STB0899_SFRUPM\t\t, 0x68 },\n\t{ STB0899_SFRUPL\t\t, 0x40 },\n\t{ STB0899_EQUAI1\t\t, 0x02 },\n\t{ STB0899_EQUAQ1\t\t, 0xff },\n\t{ STB0899_EQUAI2\t\t, 0x04 },\n\t{ STB0899_EQUAQ2\t\t, 0x05 },\n\t{ STB0899_EQUAI3\t\t, 0x02 },\n\t{ STB0899_EQUAQ3\t\t, 0xfd },\n\t{ STB0899_EQUAI4\t\t, 0x03 },\n\t{ STB0899_EQUAQ4\t\t, 0x07 },\n\t{ STB0899_EQUAI5\t\t, 0x08 },\n\t{ STB0899_EQUAQ5\t\t, 0xf5 },\n\t{ STB0899_DSTATUS2\t\t, 0x00 },\n\t{ STB0899_VSTATUS\t\t, 0x00 },\n\t{ STB0899_VERROR\t\t, 0x86 },\n\t{ STB0899_IQSWAP\t\t, 0x2a },\n\t{ STB0899_ECNT1M\t\t, 0x00 },\n\t{ STB0899_ECNT1L\t\t, 0x00 },\n\t{ STB0899_ECNT2M\t\t, 0x00 },\n\t{ STB0899_ECNT2L\t\t, 0x00 },\n\t{ STB0899_ECNT3M\t\t, 0x0a },\n\t{ STB0899_ECNT3L\t\t, 0xad },\n\t{ STB0899_FECAUTO1\t\t, 0x06 },\n\t{ STB0899_FECM\t\t\t, 0x01 },\n\t{ STB0899_VTH12\t\t\t, 0xb0 },\n\t{ STB0899_VTH23\t\t\t, 0x7a },\n\t{ STB0899_VTH34\t\t\t, 0x58 },\n\t{ STB0899_VTH56\t\t\t, 0x38 },\n\t{ STB0899_VTH67\t\t\t, 0x34 },\n\t{ STB0899_VTH78\t\t\t, 0x24 },\n\t{ STB0899_PRVIT\t\t\t, 0xff },\n\t{ STB0899_VITSYNC\t\t, 0x19 },\n\t{ STB0899_RSULC\t\t\t, 0xb1 },  \n\t{ STB0899_TSULC\t\t\t, 0x42 },\n\t{ STB0899_RSLLC\t\t\t, 0x41 },\n\t{ STB0899_TSLPL\t\t\t, 0x12 },\n\t{ STB0899_TSCFGH\t\t, 0x0c },\n\t{ STB0899_TSCFGM\t\t, 0x00 },\n\t{ STB0899_TSCFGL\t\t, 0x00 },\n\t{ STB0899_TSOUT\t\t\t, 0x69 },  \n\t{ STB0899_RSSYNCDEL\t\t, 0x00 },\n\t{ STB0899_TSINHDELH\t\t, 0x02 },\n\t{ STB0899_TSINHDELM\t\t, 0x00 },\n\t{ STB0899_TSINHDELL\t\t, 0x00 },\n\t{ STB0899_TSLLSTKM\t\t, 0x1b },\n\t{ STB0899_TSLLSTKL\t\t, 0xb3 },\n\t{ STB0899_TSULSTKM\t\t, 0x00 },\n\t{ STB0899_TSULSTKL\t\t, 0x00 },\n\t{ STB0899_PCKLENUL\t\t, 0xbc },\n\t{ STB0899_PCKLENLL\t\t, 0xcc },\n\t{ STB0899_RSPCKLEN\t\t, 0xbd },\n\t{ STB0899_TSSTATUS\t\t, 0x90 },\n\t{ STB0899_ERRCTRL1\t\t, 0xb6 },\n\t{ STB0899_ERRCTRL2\t\t, 0x95 },\n\t{ STB0899_ERRCTRL3\t\t, 0x8d },\n\t{ STB0899_DMONMSK1\t\t, 0x27 },\n\t{ STB0899_DMONMSK0\t\t, 0x03 },\n\t{ STB0899_DEMAPVIT\t\t, 0x5c },\n\t{ STB0899_PLPARM\t\t, 0x19 },\n\t{ STB0899_PDELCTRL\t\t, 0x48 },\n\t{ STB0899_PDELCTRL2\t\t, 0x00 },\n\t{ STB0899_BBHCTRL1\t\t, 0x00 },\n\t{ STB0899_BBHCTRL2\t\t, 0x00 },\n\t{ STB0899_HYSTTHRESH\t\t, 0x77 },\n\t{ STB0899_MATCSTM\t\t, 0x00 },\n\t{ STB0899_MATCSTL\t\t, 0x00 },\n\t{ STB0899_UPLCSTM\t\t, 0x00 },\n\t{ STB0899_UPLCSTL\t\t, 0x00 },\n\t{ STB0899_DFLCSTM\t\t, 0x00 },\n\t{ STB0899_DFLCSTL\t\t, 0x00 },\n\t{ STB0899_SYNCCST\t\t, 0x00 },\n\t{ STB0899_SYNCDCSTM\t\t, 0x00 },\n\t{ STB0899_SYNCDCSTL\t\t, 0x00 },\n\t{ STB0899_ISI_ENTRY\t\t, 0x00 },\n\t{ STB0899_ISI_BIT_EN\t\t, 0x00 },\n\t{ STB0899_MATSTRM\t\t, 0xf0 },\n\t{ STB0899_MATSTRL\t\t, 0x02 },\n\t{ STB0899_UPLSTRM\t\t, 0x45 },\n\t{ STB0899_UPLSTRL\t\t, 0x60 },\n\t{ STB0899_DFLSTRM\t\t, 0xe3 },\n\t{ STB0899_DFLSTRL\t\t, 0x00 },\n\t{ STB0899_SYNCSTR\t\t, 0x47 },\n\t{ STB0899_SYNCDSTRM\t\t, 0x05 },\n\t{ STB0899_SYNCDSTRL\t\t, 0x18 },\n\t{ STB0899_CFGPDELSTATUS1\t, 0x19 },\n\t{ STB0899_CFGPDELSTATUS2\t, 0x2b },\n\t{ STB0899_BBFERRORM\t\t, 0x00 },\n\t{ STB0899_BBFERRORL\t\t, 0x01 },\n\t{ STB0899_UPKTERRORM\t\t, 0x00 },\n\t{ STB0899_UPKTERRORL\t\t, 0x00 },\n\t{ 0xffff\t\t\t, 0xff },\n};\n\nstatic struct stb0899_config vp1041_stb0899_config = {\n\t.init_dev\t\t= vp1041_stb0899_s1_init_1,\n\t.init_s2_demod\t\t= stb0899_s2_init_2,\n\t.init_s1_demod\t\t= vp1041_stb0899_s1_init_3,\n\t.init_s2_fec\t\t= stb0899_s2_init_4,\n\t.init_tst\t\t= stb0899_s1_init_5,\n\n\t.demod_address\t\t= 0x68,  \n\n\t.xtal_freq\t\t= 27000000,\n\t.inversion\t\t= IQ_SWAP_ON,\n\n\t.lo_clk\t\t\t= 76500000,\n\t.hi_clk\t\t\t= 99000000,\n\n\t.esno_ave\t\t= STB0899_DVBS2_ESNO_AVE,\n\t.esno_quant\t\t= STB0899_DVBS2_ESNO_QUANT,\n\t.avframes_coarse\t= STB0899_DVBS2_AVFRAMES_COARSE,\n\t.avframes_fine\t\t= STB0899_DVBS2_AVFRAMES_FINE,\n\t.miss_threshold\t\t= STB0899_DVBS2_MISS_THRESHOLD,\n\t.uwp_threshold_acq\t= STB0899_DVBS2_UWP_THRESHOLD_ACQ,\n\t.uwp_threshold_track\t= STB0899_DVBS2_UWP_THRESHOLD_TRACK,\n\t.uwp_threshold_sof\t= STB0899_DVBS2_UWP_THRESHOLD_SOF,\n\t.sof_search_timeout\t= STB0899_DVBS2_SOF_SEARCH_TIMEOUT,\n\n\t.btr_nco_bits\t\t= STB0899_DVBS2_BTR_NCO_BITS,\n\t.btr_gain_shift_offset\t= STB0899_DVBS2_BTR_GAIN_SHIFT_OFFSET,\n\t.crl_nco_bits\t\t= STB0899_DVBS2_CRL_NCO_BITS,\n\t.ldpc_max_iter\t\t= STB0899_DVBS2_LDPC_MAX_ITER,\n\n\t.tuner_get_frequency\t= stb6100_get_frequency,\n\t.tuner_set_frequency\t= stb6100_set_frequency,\n\t.tuner_set_bandwidth\t= stb6100_set_bandwidth,\n\t.tuner_get_bandwidth\t= stb6100_get_bandwidth,\n\t.tuner_set_rfsiggain\t= NULL,\n};\n\nstatic struct stb6100_config vp1041_stb6100_config = {\n\t.tuner_address\t= 0x60,\n\t.refclock\t= 27000000,\n};\n\nstatic int vp1041_frontend_init(struct mantis_pci *mantis, struct dvb_frontend *fe)\n{\n\tstruct i2c_adapter *adapter\t= &mantis->adapter;\n\n\tint err = 0;\n\n\terr = mantis_frontend_power(mantis, POWER_ON);\n\tif (err == 0) {\n\t\tmantis_frontend_soft_reset(mantis);\n\t\tmsleep(250);\n\t\tmantis->fe = dvb_attach(stb0899_attach, &vp1041_stb0899_config, adapter);\n\t\tif (mantis->fe) {\n\t\t\tdprintk(MANTIS_ERROR, 1,\n\t\t\t\t\"found STB0899 DVB-S/DVB-S2 frontend @0x%02x\",\n\t\t\t\tvp1041_stb0899_config.demod_address);\n\n\t\t\tif (dvb_attach(stb6100_attach, mantis->fe, &vp1041_stb6100_config, adapter)) {\n\t\t\t\tif (!dvb_attach(lnbp21_attach, mantis->fe, adapter, 0, 0))\n\t\t\t\t\tdprintk(MANTIS_ERROR, 1, \"No LNBP21 found!\");\n\t\t\t}\n\t\t} else {\n\t\t\treturn -EREMOTEIO;\n\t\t}\n\t} else {\n\t\tdprintk(MANTIS_ERROR, 1, \"Frontend on <%s> POWER ON failed! <%d>\",\n\t\t\tadapter->name,\n\t\t\terr);\n\n\t\treturn -EIO;\n\t}\n\n\n\tdprintk(MANTIS_ERROR, 1, \"Done!\");\n\n\treturn 0;\n}\n\nstruct mantis_hwconfig vp1041_config = {\n\t.model_name\t= MANTIS_MODEL_NAME,\n\t.dev_type\t= MANTIS_DEV_TYPE,\n\t.ts_size\t= MANTIS_TS_188,\n\n\t.baud_rate\t= MANTIS_BAUD_9600,\n\t.parity\t\t= MANTIS_PARITY_NONE,\n\t.bytes\t\t= 0,\n\n\t.frontend_init\t= vp1041_frontend_init,\n\t.power\t\t= GPIF_A12,\n\t.reset\t\t= GPIF_A13,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}