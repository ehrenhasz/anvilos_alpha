{
  "module_name": "ddbridge.h",
  "hash_id": "1b15a38077aed60ce12df3c63ecce89f7ebafef7068cc72c51504b1896a054fa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/ddbridge/ddbridge.h",
  "human_readable_source": " \n \n\n#ifndef _DDBRIDGE_H_\n#define _DDBRIDGE_H_\n\n#include <linux/clk.h>\n#include <linux/completion.h>\n#include <linux/delay.h>\n#include <linux/device.h>\n#include <linux/dvb/ca.h>\n#include <linux/gpio.h>\n#include <linux/i2c.h>\n#include <linux/init.h>\n#include <linux/interrupt.h>\n#include <linux/io.h>\n#include <linux/kthread.h>\n#include <linux/module.h>\n#include <linux/mutex.h>\n#include <linux/pci.h>\n#include <linux/platform_device.h>\n#include <linux/poll.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/socket.h>\n#include <linux/spi/spi.h>\n#include <linux/swab.h>\n#include <linux/timer.h>\n#include <linux/types.h>\n#include <linux/uaccess.h>\n#include <linux/vmalloc.h>\n#include <linux/workqueue.h>\n\n#include <asm/dma.h>\n#include <asm/irq.h>\n\n#include <media/dmxdev.h>\n#include <media/dvb_ca_en50221.h>\n#include <media/dvb_demux.h>\n#include <media/dvbdev.h>\n#include <media/dvb_frontend.h>\n#include <media/dvb_net.h>\n#include <media/dvb_ringbuffer.h>\n\n#define DDBRIDGE_VERSION \"0.9.33-integrated\"\n\n#define DDB_MAX_I2C    32\n#define DDB_MAX_PORT   32\n#define DDB_MAX_INPUT  64\n#define DDB_MAX_OUTPUT 32\n#define DDB_MAX_LINK    4\n#define DDB_LINK_SHIFT 28\n\n#define DDB_LINK_TAG(_x) (_x << DDB_LINK_SHIFT)\n\nstruct ddb_regset {\n\tu32 base;\n\tu32 num;\n\tu32 size;\n};\n\nstruct ddb_regmap {\n\tu32 irq_base_i2c;\n\tu32 irq_base_idma;\n\tu32 irq_base_odma;\n\n\tconst struct ddb_regset *i2c;\n\tconst struct ddb_regset *i2c_buf;\n\tconst struct ddb_regset *idma;\n\tconst struct ddb_regset *idma_buf;\n\tconst struct ddb_regset *odma;\n\tconst struct ddb_regset *odma_buf;\n\n\tconst struct ddb_regset *input;\n\tconst struct ddb_regset *output;\n\n\tconst struct ddb_regset *channel;\n};\n\nstruct ddb_ids {\n\tu16 vendor;\n\tu16 device;\n\tu16 subvendor;\n\tu16 subdevice;\n\n\tu32 hwid;\n\tu32 regmapid;\n\tu32 devid;\n\tu32 mac;\n};\n\nstruct ddb_info {\n\tint   type;\n#define DDB_NONE            0\n#define DDB_OCTOPUS         1\n#define DDB_OCTOPUS_CI      2\n#define DDB_OCTOPUS_MAX     5\n#define DDB_OCTOPUS_MAX_CT  6\n#define DDB_OCTOPUS_MCI     9\n\tchar *name;\n\tu32   i2c_mask;\n\tu32   board_control;\n\tu32   board_control_2;\n\n\tu8    port_num;\n\tu8    led_num;\n\tu8    fan_num;\n\tu8    temp_num;\n\tu8    temp_bus;\n\tu8    con_clock;  \n\tu8    ts_quirks;\n#define TS_QUIRK_SERIAL   1\n#define TS_QUIRK_REVERSED 2\n#define TS_QUIRK_ALT_OSC  8\n\tu8    mci_ports;\n\tu8    mci_type;\n\n\tu32   tempmon_irq;\n\tconst struct ddb_regmap *regmap;\n};\n\n#define DMA_MAX_BUFS 32       \n\nstruct ddb;\nstruct ddb_port;\n\nstruct ddb_dma {\n\tvoid                  *io;\n\tu32                    regs;\n\tu32                    bufregs;\n\n\tdma_addr_t             pbuf[DMA_MAX_BUFS];\n\tu8                    *vbuf[DMA_MAX_BUFS];\n\tu32                    num;\n\tu32                    size;\n\tu32                    div;\n\tu32                    bufval;\n\n\tstruct work_struct     work;\n\tspinlock_t             lock;  \n\twait_queue_head_t      wq;\n\tint                    running;\n\tu32                    stat;\n\tu32                    ctrl;\n\tu32                    cbuf;\n\tu32                    coff;\n};\n\nstruct ddb_dvb {\n\tstruct dvb_adapter    *adap;\n\tint                    adap_registered;\n\tstruct dvb_device     *dev;\n\tstruct i2c_client     *i2c_client[1];\n\tstruct dvb_frontend   *fe;\n\tstruct dvb_frontend   *fe2;\n\tstruct dmxdev          dmxdev;\n\tstruct dvb_demux       demux;\n\tstruct dvb_net         dvbnet;\n\tstruct dmx_frontend    hw_frontend;\n\tstruct dmx_frontend    mem_frontend;\n\tint                    users;\n\tu32                    attached;\n\tu8                     input;\n\n\tenum fe_sec_tone_mode  tone;\n\tenum fe_sec_voltage    voltage;\n\n\tint (*i2c_gate_ctrl)(struct dvb_frontend *, int);\n\tint (*set_voltage)(struct dvb_frontend *fe,\n\t\t\t   enum fe_sec_voltage voltage);\n\tint (*set_input)(struct dvb_frontend *fe, int input);\n\tint (*diseqc_send_master_cmd)(struct dvb_frontend *fe,\n\t\t\t\t      struct dvb_diseqc_master_cmd *cmd);\n};\n\nstruct ddb_ci {\n\tstruct dvb_ca_en50221  en;\n\tstruct ddb_port       *port;\n\tu32                    nr;\n};\n\nstruct ddb_io {\n\tstruct ddb_port       *port;\n\tu32                    nr;\n\tu32                    regs;\n\tstruct ddb_dma        *dma;\n\tstruct ddb_io         *redo;\n\tstruct ddb_io         *redi;\n};\n\n#define ddb_output ddb_io\n#define ddb_input ddb_io\n\nstruct ddb_i2c {\n\tstruct ddb            *dev;\n\tu32                    nr;\n\tu32                    regs;\n\tu32                    link;\n\tstruct i2c_adapter     adap;\n\tu32                    rbuf;\n\tu32                    wbuf;\n\tu32                    bsize;\n\tstruct completion      completion;\n};\n\nstruct ddb_port {\n\tstruct ddb            *dev;\n\tu32                    nr;\n\tu32                    pnr;\n\tu32                    regs;\n\tu32                    lnr;\n\tstruct ddb_i2c        *i2c;\n\tstruct mutex           i2c_gate_lock;  \n\tu32                    class;\n#define DDB_PORT_NONE           0\n#define DDB_PORT_CI             1\n#define DDB_PORT_TUNER          2\n#define DDB_PORT_LOOP           3\n\tchar                   *name;\n\tchar                   *type_name;\n\tu32                     type;\n#define DDB_TUNER_DUMMY          0xffffffff\n#define DDB_TUNER_NONE           0\n#define DDB_TUNER_DVBS_ST        1\n#define DDB_TUNER_DVBS_ST_AA     2\n#define DDB_TUNER_DVBCT_TR       3\n#define DDB_TUNER_DVBCT_ST       4\n#define DDB_CI_INTERNAL          5\n#define DDB_CI_EXTERNAL_SONY     6\n#define DDB_TUNER_DVBCT2_SONY_P  7\n#define DDB_TUNER_DVBC2T2_SONY_P 8\n#define DDB_TUNER_ISDBT_SONY_P   9\n#define DDB_TUNER_DVBS_STV0910_P 10\n#define DDB_TUNER_MXL5XX         11\n#define DDB_CI_EXTERNAL_XO2      12\n#define DDB_CI_EXTERNAL_XO2_B    13\n#define DDB_TUNER_DVBS_STV0910_PR 14\n#define DDB_TUNER_DVBC2T2I_SONY_P 15\n\n#define DDB_TUNER_XO2            32\n#define DDB_TUNER_DVBS_STV0910   (DDB_TUNER_XO2 + 0)\n#define DDB_TUNER_DVBCT2_SONY    (DDB_TUNER_XO2 + 1)\n#define DDB_TUNER_ISDBT_SONY     (DDB_TUNER_XO2 + 2)\n#define DDB_TUNER_DVBC2T2_SONY   (DDB_TUNER_XO2 + 3)\n#define DDB_TUNER_ATSC_ST        (DDB_TUNER_XO2 + 4)\n#define DDB_TUNER_DVBC2T2I_SONY  (DDB_TUNER_XO2 + 5)\n\n#define DDB_TUNER_MCI            48\n#define DDB_TUNER_MCI_SX8        (DDB_TUNER_MCI + 0)\n\n\tstruct ddb_input      *input[2];\n\tstruct ddb_output     *output;\n\tstruct dvb_ca_en50221 *en;\n\tu8                     en_freedata;\n\tstruct ddb_dvb         dvb[2];\n\tu32                    gap;\n\tu32                    obr;\n\tu8                     creg;\n};\n\n#define CM_STARTUP_DELAY 2\n#define CM_AVERAGE  20\n#define CM_GAIN     10\n\n#define HW_LSB_SHIFT    12\n#define HW_LSB_MASK     0x1000\n\n#define CM_IDLE    0\n#define CM_STARTUP 1\n#define CM_ADJUST  2\n\n#define TS_CAPTURE_LEN  (4096)\n\nstruct ddb_lnb {\n\tstruct mutex           lock;  \n\tu32                    tone;\n\tenum fe_sec_voltage    oldvoltage[4];\n\tu32                    voltage[4];\n\tu32                    voltages;\n\tu32                    fmode;\n};\n\nstruct ddb_irq {\n\tvoid                   (*handler)(void *);\n\tvoid                  *data;\n};\n\nstruct ddb_link {\n\tstruct ddb            *dev;\n\tconst struct ddb_info *info;\n\tu32                    nr;\n\tu32                    regs;\n\tspinlock_t             lock;  \n\tstruct mutex           flash_mutex;  \n\tstruct ddb_lnb         lnb;\n\tstruct tasklet_struct  tasklet;\n\tstruct ddb_ids         ids;\n\n\tspinlock_t             temp_lock;  \n\tint                    overtemperature_error;\n\tu8                     temp_tab[11];\n\tstruct ddb_irq         irq[256];\n};\n\nstruct ddb {\n\tstruct pci_dev          *pdev;\n\tstruct platform_device  *pfdev;\n\tstruct device           *dev;\n\n\tint                      msi;\n\tstruct workqueue_struct *wq;\n\tu32                      has_dma;\n\n\tstruct ddb_link          link[DDB_MAX_LINK];\n\tunsigned char __iomem   *regs;\n\tu32                      regs_len;\n\tu32                      port_num;\n\tstruct ddb_port          port[DDB_MAX_PORT];\n\tu32                      i2c_num;\n\tstruct ddb_i2c           i2c[DDB_MAX_I2C];\n\tstruct ddb_input         input[DDB_MAX_INPUT];\n\tstruct ddb_output        output[DDB_MAX_OUTPUT];\n\tstruct dvb_adapter       adap[DDB_MAX_INPUT];\n\tstruct ddb_dma           idma[DDB_MAX_INPUT];\n\tstruct ddb_dma           odma[DDB_MAX_OUTPUT];\n\n\tstruct device           *ddb_dev;\n\tu32                      ddb_dev_users;\n\tu32                      nr;\n\tu8                       iobuf[1028];\n\n\tu8                       leds;\n\tu32                      ts_irq;\n\tu32                      i2c_irq;\n\n\tstruct mutex             mutex;  \n\n\tu8                       tsbuf[TS_CAPTURE_LEN];\n};\n\n \n \n \n\nint ddbridge_flashread(struct ddb *dev, u32 link, u8 *buf, u32 addr, u32 len);\n\n \n\n \nstruct ddb_irq *ddb_irq_set(struct ddb *dev, u32 link, u32 nr,\n\t\t\t    void (*handler)(void *), void *data);\nvoid ddb_ports_detach(struct ddb *dev);\nvoid ddb_ports_release(struct ddb *dev);\nvoid ddb_buffers_free(struct ddb *dev);\nvoid ddb_device_destroy(struct ddb *dev);\nirqreturn_t ddb_irq_handler0(int irq, void *dev_id);\nirqreturn_t ddb_irq_handler1(int irq, void *dev_id);\nirqreturn_t ddb_irq_handler(int irq, void *dev_id);\nvoid ddb_ports_init(struct ddb *dev);\nint ddb_buffers_alloc(struct ddb *dev);\nint ddb_ports_attach(struct ddb *dev);\nint ddb_device_create(struct ddb *dev);\nint ddb_init(struct ddb *dev);\nvoid ddb_unmap(struct ddb *dev);\nint ddb_exit_ddbridge(int stage, int error);\nint ddb_init_ddbridge(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}