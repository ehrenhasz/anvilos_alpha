{
  "module_name": "bttvp.h",
  "hash_id": "45f547341b23f8f0413123ed7d010c81fe31274ea6de6cef10dc16953aba850b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/bt8xx/bttvp.h",
  "human_readable_source": " \n \n\n#ifndef _BTTVP_H_\n#define _BTTVP_H_\n\n#include <linux/types.h>\n#include <linux/wait.h>\n#include <linux/i2c.h>\n#include <linux/i2c-algo-bit.h>\n#include <linux/pci.h>\n#include <linux/input.h>\n#include <linux/mutex.h>\n#include <linux/scatterlist.h>\n#include <linux/device.h>\n#include <asm/io.h>\n#include <media/v4l2-common.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-fh.h>\n#include <media/videobuf2-dma-sg.h>\n#include <media/tveeprom.h>\n#include <media/rc-core.h>\n#include <media/i2c/ir-kbd-i2c.h>\n#include <media/drv-intf/tea575x.h>\n\n#include \"bt848.h\"\n#include \"bttv.h\"\n#include \"btcx-risc.h\"\n\n#ifdef __KERNEL__\n\n#define FORMAT_FLAGS_DITHER       0x01\n#define FORMAT_FLAGS_PACKED       0x02\n#define FORMAT_FLAGS_PLANAR       0x04\n#define FORMAT_FLAGS_RAW          0x08\n#define FORMAT_FLAGS_CrCb         0x10\n\n#define RISC_SLOT_O_VBI        4\n#define RISC_SLOT_O_FIELD      6\n#define RISC_SLOT_E_VBI       10\n#define RISC_SLOT_E_FIELD     12\n#define RISC_SLOT_LOOP        14\n\n#define RESOURCE_VIDEO_STREAM  2\n#define RESOURCE_VBI           4\n#define RESOURCE_VIDEO_READ    8\n\n#define RAW_LINES            640\n#define RAW_BPL             1024\n\n#define UNSET (-1U)\n\n \n#define MIN_VDELAY 2\n \n#define MAX_HDELAY (0x3FF & -2)\n \n#define MAX_HACTIVE (0x3FF & -4)\n\n#define BTTV_NORMS    (\\\n\t\tV4L2_STD_PAL    | V4L2_STD_PAL_N | \\\n\t\tV4L2_STD_PAL_Nc | V4L2_STD_SECAM | \\\n\t\tV4L2_STD_NTSC   | V4L2_STD_PAL_M | \\\n\t\tV4L2_STD_PAL_60)\n \n\nstruct bttv_tvnorm {\n\tint   v4l2_id;\n\tchar  *name;\n\tu32   Fsc;\n\tu16   swidth, sheight;  \n\tu16   totalwidth;\n\tu8    adelay, bdelay, iform;\n\tu32   scaledtwidth;\n\tu16   hdelayx1, hactivex1;\n\tu16   vdelay;\n\tu8    vbipack;\n\tu16   vtotal;\n\tint   sram;\n\t \n\tu16   vbistart[2];\n\t \n\tstruct v4l2_cropcap cropcap;\n};\nextern const struct bttv_tvnorm bttv_tvnorms[];\n\nstruct bttv_format {\n\tint  fourcc;           \n\tint  btformat;         \n\tint  btswap;           \n\tint  depth;            \n\tint  flags;\n\tint  hshift,vshift;    \n};\n\nstruct bttv_ir {\n\tstruct rc_dev           *dev;\n\tstruct bttv\t\t*btv;\n\tstruct timer_list       timer;\n\n\tchar                    name[32];\n\tchar                    phys[32];\n\n\t \n\tu32                     mask_keycode;\n\tu32                     mask_keydown;\n\tu32                     mask_keyup;\n\tu32                     polling;\n\tu32                     last_gpio;\n\tint                     shift_by;\n\tint                     rc5_remote_gap;\n\n\t \n\tbool\t\t\trc5_gpio;    \n\tu32                     last_bit;    \n\tu32                     code;        \n\tktime_t\t\t\t\t\t\tbase_time;   \n\tbool                    active;      \n};\n\n\n \n\nstruct bttv_geometry {\n\tu8  vtc,crop,comb;\n\tu16 width,hscale,hdelay;\n\tu16 sheight,vscale,vdelay,vtotal;\n};\n\nstruct bttv_buffer {\n\t \n\tstruct vb2_v4l2_buffer vbuf;\n\tstruct list_head list;\n\n\t \n\tint                        btformat;\n\tint                        btswap;\n\tstruct bttv_geometry       geo;\n\tstruct btcx_riscmem        top;\n\tstruct btcx_riscmem        bottom;\n};\n\nstruct bttv_buffer_set {\n\tstruct bttv_buffer     *top;        \n\tstruct bttv_buffer     *bottom;     \n\tunsigned int           top_irq;\n\tunsigned int           frame_irq;\n};\n\nstruct bttv_vbi_fmt {\n\tstruct v4l2_vbi_format fmt;\n\n\t \n\tconst struct bttv_tvnorm *tvnorm;\n\n\t \n\t__s32                  end;\n};\n\n \nextern const struct vb2_ops bttv_vbi_qops;\n\nvoid bttv_vbi_fmt_reset(struct bttv_vbi_fmt *f, unsigned int norm);\n\nstruct bttv_crop {\n\t \n\tstruct v4l2_rect       rect;\n\n\t \n\t__s32                  min_scaled_width;\n\t__s32                  min_scaled_height;\n\t__s32                  max_scaled_width;\n\t__s32                  max_scaled_height;\n};\n\n \n \n\n \nint bttv_risc_packed(struct bttv *btv, struct btcx_riscmem *risc,\n\t\t     struct scatterlist *sglist,\n\t\t     unsigned int offset, unsigned int bpl,\n\t\t     unsigned int pitch, unsigned int skip_lines,\n\t\t     unsigned int store_lines);\n\n \nvoid bttv_set_dma(struct bttv *btv, int override);\nint bttv_risc_init_main(struct bttv *btv);\nint bttv_risc_hook(struct bttv *btv, int slot, struct btcx_riscmem *risc,\n\t\t   int irqflags);\n\n \nint bttv_buffer_risc(struct bttv *btv, struct bttv_buffer *buf);\nint bttv_buffer_activate_video(struct bttv *btv,\n\t\t\t       struct bttv_buffer_set *set);\nint bttv_buffer_risc_vbi(struct bttv *btv, struct bttv_buffer *buf);\nint bttv_buffer_activate_vbi(struct bttv *btv,\n\t\t\t     struct bttv_buffer *vbi);\n\n \n \n\n \n#define VBI_BPL 2048\n\n#define VBI_DEFLINES 16\n\nint bttv_try_fmt_vbi_cap(struct file *file, void *fh, struct v4l2_format *f);\nint bttv_g_fmt_vbi_cap(struct file *file, void *fh, struct v4l2_format *f);\nint bttv_s_fmt_vbi_cap(struct file *file, void *fh, struct v4l2_format *f);\n\n \n \n\nextern struct bus_type bttv_sub_bus_type;\nint bttv_sub_add_device(struct bttv_core *core, char *name);\nint bttv_sub_del_devices(struct bttv_core *core);\n\n \n \n\nextern void init_bttv_i2c_ir(struct bttv *btv);\n\n \n \nextern int init_bttv_i2c(struct bttv *btv);\nextern int fini_bttv_i2c(struct bttv *btv);\n\n \n \n\n \nextern unsigned int bttv_verbose;\nextern unsigned int bttv_debug;\nextern unsigned int bttv_gpio;\nint check_alloc_btres_lock(struct bttv *btv, int bit);\nvoid free_btres_lock(struct bttv *btv, int bits);\nextern void bttv_gpio_tracking(struct bttv *btv, char *comment);\n\n#define dprintk(fmt, ...)\t\t\t\\\ndo {\t\t\t\t\t\t\\\n\tif (bttv_debug >= 1)\t\t\t\\\n\t\tpr_debug(fmt, ##__VA_ARGS__);\t\\\n} while (0)\n#define dprintk_cont(fmt, ...)\t\t\t\\\ndo {\t\t\t\t\t\t\\\n\tif (bttv_debug >= 1)\t\t\t\\\n\t\tpr_cont(fmt, ##__VA_ARGS__);\t\\\n} while (0)\n#define d2printk(fmt, ...)\t\t\t\\\ndo {\t\t\t\t\t\t\\\n\tif (bttv_debug >= 2)\t\t\t\\\n\t\tprintk(fmt, ##__VA_ARGS__);\t\\\n} while (0)\n\n#define BTTV_MAX_FBUF   0x208000\n#define BTTV_TIMEOUT    msecs_to_jiffies(500)     \n#define BTTV_FREE_IDLE  msecs_to_jiffies(1000)    \n\n\nstruct bttv_pll_info {\n\tunsigned int pll_ifreq;     \n\tunsigned int pll_ofreq;     \n\tunsigned int pll_crystal;   \n\tunsigned int pll_current;   \n};\n\n \nstruct bttv_input {\n\tstruct input_dev      *dev;\n\tchar                  name[32];\n\tchar                  phys[32];\n\tu32                   mask_keycode;\n\tu32                   mask_keydown;\n};\n\nstruct bttv_suspend_state {\n\tu32  gpio_enable;\n\tu32  gpio_data;\n\tint  disabled;\n\tint  loop_irq;\n\tstruct bttv_buffer_set video;\n\tstruct bttv_buffer     *vbi;\n};\n\nstruct bttv_tea575x_gpio {\n\tu8 data, clk, wren, most;\n};\n\nstruct bttv {\n\tstruct bttv_core c;\n\n\t \n\tunsigned short id;\n\tunsigned char revision;\n\tunsigned char __iomem *bt848_mmio;    \n\n\t \n\tunsigned int cardid;    \n\tunsigned int tuner_type;   \n\tunsigned int tda9887_conf;\n\tunsigned int svhs, dig;\n\tunsigned int has_saa6588:1;\n\tstruct bttv_pll_info pll;\n\tint triton1;\n\tint gpioirq;\n\n\tint use_i2c_hw;\n\n\t \n\tint shutdown;\n\n\tvoid (*volume_gpio)(struct bttv *btv, __u16 volume);\n\tvoid (*audio_mode_gpio)(struct bttv *btv, struct v4l2_tuner *tuner, int set);\n\n\t \n\tspinlock_t gpio_lock;\n\n\t \n\tstruct i2c_algo_bit_data   i2c_algo;\n\tstruct i2c_client          i2c_client;\n\tint                        i2c_state, i2c_rc;\n\tint                        i2c_done;\n\twait_queue_head_t          i2c_queue;\n\tstruct v4l2_subdev\t  *sd_msp34xx;\n\tstruct v4l2_subdev\t  *sd_tvaudio;\n\tstruct v4l2_subdev\t  *sd_tda7432;\n\n\t \n\tstruct video_device video_dev;\n\tstruct video_device radio_dev;\n\tstruct video_device vbi_dev;\n\n\t \n\tstruct v4l2_ctrl_handler   ctrl_handler;\n\tstruct v4l2_ctrl_handler   radio_ctrl_handler;\n\n\t \n\tint has_remote;\n\tstruct bttv_ir *remote;\n\n\t \n\tstruct IR_i2c_init_data    init_data;\n\n\t \n\tspinlock_t s_lock;\n\tstruct mutex lock;\n\tint resources;\n\n\t \n\tunsigned int input;\n\tunsigned int audio_input;\n\tunsigned int mute;\n\tunsigned long tv_freq;\n\tunsigned int tvnorm;\n\tv4l2_std_id std;\n\tint hue, contrast, bright, saturation;\n\tstruct v4l2_framebuffer fbuf;\n\t__u32 field_count;\n\n\t \n\tint opt_combfilter;\n\tint opt_automute;\n\tint opt_vcr_hack;\n\tint opt_uv_ratio;\n\n\t \n\tint has_radio;\n\tint has_radio_tuner;\n\tint radio_user;\n\tint radio_uses_msp_demodulator;\n\tunsigned long radio_freq;\n\n\t \n\tint has_tea575x;\n\tstruct bttv_tea575x_gpio tea_gpio;\n\tstruct snd_tea575x tea;\n\n\t \n\tint mbox_ior;\n\tint mbox_iow;\n\tint mbox_csel;\n\n\t \n\tchar sw_status[4];\n\n\t \n\tstruct btcx_riscmem     main;\n\tstruct list_head        capture;     \n\tstruct list_head        vcapture;    \n\tstruct bttv_buffer_set  curr;        \n\tstruct bttv_buffer      *cvbi;       \n\tint                     loop_irq;\n\tint                     new_input;\n\n\tunsigned long dma_on;\n\tstruct timer_list timeout;\n\tstruct bttv_suspend_state state;\n\n\t \n\tunsigned int errors;\n\tunsigned int framedrop;\n\tunsigned int irq_total;\n\tunsigned int irq_me;\n\n\tunsigned int users;\n\tstruct v4l2_fh fh;\n\tenum v4l2_buf_type type;\n\n\tenum v4l2_field field;\n\tint field_last;\n\n\t \n\tstruct vb2_queue capq;\n\tconst struct bttv_format *fmt;\n\tint width;\n\tint height;\n\n\t \n\tstruct vb2_queue vbiq;\n\tstruct bttv_vbi_fmt vbi_fmt;\n\tunsigned int vbi_count[2];\n\n\t \n\tint do_crop;\n\n\t \n\tstruct work_struct request_module_wk;\n\n\t \n\tstruct bttv_crop crop[2];\n\n\t \n\t__s32\t\t\tvbi_end;\n\n\t \n\t__s32\t\t\tcrop_start;\n};\n\nstatic inline struct bttv *to_bttv(struct v4l2_device *v4l2_dev)\n{\n\treturn container_of(v4l2_dev, struct bttv, c.v4l2_dev);\n}\n\n \n#define BTTV_MAX 32\nextern unsigned int bttv_num;\nextern struct bttv *bttvs[BTTV_MAX];\n\nstatic inline unsigned int bttv_muxsel(const struct bttv *btv,\n\t\t\t\t       unsigned int input)\n{\n\treturn (bttv_tvcards[btv->c.type].muxsel >> (input * 2)) & 3;\n}\n\n#endif\n\nvoid init_irqreg(struct bttv *btv);\n\n#define btwrite(dat,adr)    writel((dat), btv->bt848_mmio+(adr))\n#define btread(adr)         readl(btv->bt848_mmio+(adr))\n\n#define btand(dat,adr)      btwrite((dat) & btread(adr), adr)\n#define btor(dat,adr)       btwrite((dat) | btread(adr), adr)\n#define btaor(dat,mask,adr) btwrite((dat) | ((mask) & btread(adr)), adr)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}