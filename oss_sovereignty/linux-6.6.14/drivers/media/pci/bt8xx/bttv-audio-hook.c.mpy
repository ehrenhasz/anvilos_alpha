{
  "module_name": "bttv-audio-hook.c",
  "hash_id": "638d1a5d7c99fdb8e4da46fd3b153acd2191e774680613e1ad5c01246e1d3c2a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/bt8xx/bttv-audio-hook.c",
  "human_readable_source": "\n \n\n#include \"bttv-audio-hook.h\"\n\n#include <linux/delay.h>\n\n \n \n\nvoid winview_volume(struct bttv *btv, __u16 volume)\n{\n\t \n\tint bits_out, loops, vol, data;\n\n\t \n\tvol = 32 - ((volume>>11));\n\t \n\tbits_out = (PT2254_DBS_IN_2>>(vol%5));\n\t \n\tbits_out |= (PT2254_DBS_IN_10>>(vol/5));\n\tbits_out |= PT2254_L_CHANNEL | PT2254_R_CHANNEL;\n\tdata = gpio_read();\n\tdata &= ~(WINVIEW_PT2254_CLK| WINVIEW_PT2254_DATA|\n\t\t  WINVIEW_PT2254_STROBE);\n\tfor (loops = 17; loops >= 0 ; loops--) {\n\t\tif (bits_out & (1<<loops))\n\t\t\tdata |=  WINVIEW_PT2254_DATA;\n\t\telse\n\t\t\tdata &= ~WINVIEW_PT2254_DATA;\n\t\tgpio_write(data);\n\t\tudelay(5);\n\t\tdata |= WINVIEW_PT2254_CLK;\n\t\tgpio_write(data);\n\t\tudelay(5);\n\t\tdata &= ~WINVIEW_PT2254_CLK;\n\t\tgpio_write(data);\n\t}\n\tdata |=  WINVIEW_PT2254_STROBE;\n\tdata &= ~WINVIEW_PT2254_DATA;\n\tgpio_write(data);\n\tudelay(10);\n\tdata &= ~WINVIEW_PT2254_STROBE;\n\tgpio_write(data);\n}\n\n \n \n \n\nvoid gvbctv3pci_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tunsigned int con;\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tgpio_inout(0x300, 0x300);\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_LANG1:\n\tdefault:\n\t\tcon = 0x000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_LANG2:\n\t\tcon = 0x300;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tcon = 0x200;\n\t\tbreak;\n\t}\n\tgpio_bits(0x300, con);\n}\n\nvoid gvbctv5pci_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tunsigned int val, con;\n\n\tif (btv->radio_user)\n\t\treturn;\n\n\tval = gpio_read();\n\tif (set) {\n\t\tswitch (t->audmode) {\n\t\tcase V4L2_TUNER_MODE_LANG2:\n\t\t\tcon = 0x300;\n\t\t\tbreak;\n\t\tcase V4L2_TUNER_MODE_LANG1_LANG2:\n\t\t\tcon = 0x100;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tcon = 0x000;\n\t\t\tbreak;\n\t\t}\n\t\tif (con != (val & 0x300)) {\n\t\t\tgpio_bits(0x300, con);\n\t\t\tif (bttv_gpio)\n\t\t\t\tbttv_gpio_tracking(btv, \"gvbctv5pci\");\n\t\t}\n\t} else {\n\t\tswitch (val & 0x70) {\n\t\t  case 0x10:\n\t\t\tt->rxsubchans = V4L2_TUNER_SUB_LANG1 |  V4L2_TUNER_SUB_LANG2;\n\t\t\tt->audmode = V4L2_TUNER_MODE_LANG1_LANG2;\n\t\t\tbreak;\n\t\t  case 0x30:\n\t\t\tt->rxsubchans = V4L2_TUNER_SUB_LANG2;\n\t\t\tt->audmode = V4L2_TUNER_MODE_LANG1_LANG2;\n\t\t\tbreak;\n\t\t  case 0x50:\n\t\t\tt->rxsubchans = V4L2_TUNER_SUB_LANG1;\n\t\t\tt->audmode = V4L2_TUNER_MODE_LANG1_LANG2;\n\t\t\tbreak;\n\t\t  case 0x60:\n\t\t\tt->rxsubchans = V4L2_TUNER_SUB_STEREO;\n\t\t\tt->audmode = V4L2_TUNER_MODE_STEREO;\n\t\t\tbreak;\n\t\t  case 0x70:\n\t\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO;\n\t\t\tt->audmode = V4L2_TUNER_MODE_MONO;\n\t\t\tbreak;\n\t\t  default:\n\t\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\t\t V4L2_TUNER_SUB_STEREO |\n\t\t\t\t\t V4L2_TUNER_SUB_LANG1 |\n\t\t\t\t\t V4L2_TUNER_SUB_LANG2;\n\t\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\t}\n\t}\n}\n\n \n\nvoid avermedia_tvphone_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tint val;\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_LANG2:    \n\t\tval = 0x02;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tval = 0x01;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tgpio_bits(0x03, val);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"avermedia\");\n}\n\n\nvoid avermedia_tv_stereo_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tint val = 0;\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_LANG2:    \n\t\tval = 0x01;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tval = 0x02;\n\t\tbreak;\n\tdefault:\n\t\tval = 0;\n\t\tbreak;\n\t}\n\tbtaor(val, ~0x03, BT848_GPIO_DATA);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"avermedia\");\n}\n\n \n\nvoid lt9415_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tint val = 0;\n\n\tif (gpio_read() & 0x4000) {\n\t\tt->audmode = V4L2_TUNER_MODE_MONO;\n\t\treturn;\n\t}\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_LANG2:\t \n\t\tval = 0x0080;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_STEREO:\t \n\t\tval = 0x0880;\n\t\tbreak;\n\tdefault:\n\t\tval = 0;\n\t\tbreak;\n\t}\n\n\tgpio_bits(0x0880, val);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"lt9415\");\n}\n\n \nvoid terratv_audio(struct bttv *btv,  struct v4l2_tuner *t, int set)\n{\n\tunsigned int con = 0;\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tgpio_inout(0x180000, 0x180000);\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_LANG2:\n\t\tcon = 0x080000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tcon = 0x180000;\n\t\tbreak;\n\tdefault:\n\t\tcon = 0;\n\t\tbreak;\n\t}\n\tgpio_bits(0x180000, con);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"terratv\");\n}\n\n\nvoid winfast2000_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tunsigned long val;\n\n\tif (!set)\n\t\treturn;\n\n\t \n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_MONO:\n\tcase V4L2_TUNER_MODE_LANG1:\n\t\tval = 0x420000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_LANG2:  \n\t\tval = 0x410000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tval = 0x020000;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\tgpio_bits(0x430000, val);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"winfast2000\");\n}\n\n \nvoid pvbt878p9b_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tunsigned int val = 0;\n\n\tif (btv->radio_user)\n\t\treturn;\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_MONO:\n\t\tval = 0x01;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_LANG1:\n\tcase V4L2_TUNER_MODE_LANG2:\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tval = 0x02;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\tgpio_bits(0x03, val);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"pvbt878p9b\");\n}\n\n \nvoid fv2000s_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tunsigned int val;\n\n\tif (btv->radio_user)\n\t\treturn;\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_MONO:\n\t\tval = 0x0000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_LANG1:\n\tcase V4L2_TUNER_MODE_LANG2:\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tval = 0x1080;  \n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tgpio_bits(0x1800, val);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"fv2000s\");\n}\n\n \nvoid windvr_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tunsigned long val;\n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_MONO:\n\t\tval = 0x040000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_LANG2:\n\t\tval = 0x100000;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\tgpio_bits(0x140000, val);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"windvr\");\n}\n\n \nvoid adtvk503_audio(struct bttv *btv, struct v4l2_tuner *t, int set)\n{\n\tunsigned int con = 0xffffff;\n\n\t \n\n\tif (!set) {\n\t\t \n\t\tt->audmode = V4L2_TUNER_MODE_LANG1;\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO |\n\t\t\t\tV4L2_TUNER_SUB_STEREO |\n\t\t\t\tV4L2_TUNER_SUB_LANG1 |\n\t\t\t\tV4L2_TUNER_SUB_LANG2;\n\n\t\treturn;\n\t}\n\n\t \n\tswitch (t->audmode) {\n\tcase V4L2_TUNER_MODE_LANG1:\n\t\tcon = 0x00000000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_LANG2:\n\t\tcon = 0x00180000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_STEREO:\n\t\tcon = 0x00000000;\n\t\tbreak;\n\tcase V4L2_TUNER_MODE_MONO:\n\t\tcon = 0x00060000;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\tgpio_bits(0x1e0000, con);\n\tif (bttv_gpio)\n\t\tbttv_gpio_tracking(btv, \"adtvk503\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}