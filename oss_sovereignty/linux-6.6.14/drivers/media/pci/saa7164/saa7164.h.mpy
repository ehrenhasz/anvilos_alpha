{
  "module_name": "saa7164.h",
  "hash_id": "61764d1c7f9ceabef5c0fe3b697d3204961c63aa2e5b339622230cf6b43ecad7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/saa7164/saa7164.h",
  "human_readable_source": " \n \n\n \n\n#include <linux/pci.h>\n#include <linux/i2c.h>\n#include <linux/kdev_t.h>\n#include <linux/mutex.h>\n#include <linux/crc32.h>\n#include <linux/kthread.h>\n#include <linux/freezer.h>\n\n#include <media/tuner.h>\n#include <media/tveeprom.h>\n#include <media/dvb_demux.h>\n#include <media/dvb_frontend.h>\n#include <media/dvb_net.h>\n#include <media/dvbdev.h>\n#include <media/dmxdev.h>\n#include <media/v4l2-common.h>\n#include <media/v4l2-ioctl.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-event.h>\n\n#include \"saa7164-reg.h\"\n#include \"saa7164-types.h\"\n\n#define SAA7164_MAXBOARDS 8\n\n#define UNSET (-1U)\n#define SAA7164_BOARD_NOAUTO\t\t\tUNSET\n#define SAA7164_BOARD_UNKNOWN\t\t\t0\n#define SAA7164_BOARD_UNKNOWN_REV2\t\t1\n#define SAA7164_BOARD_UNKNOWN_REV3\t\t2\n#define SAA7164_BOARD_HAUPPAUGE_HVR2250\t\t3\n#define SAA7164_BOARD_HAUPPAUGE_HVR2200\t\t4\n#define SAA7164_BOARD_HAUPPAUGE_HVR2200_2\t5\n#define SAA7164_BOARD_HAUPPAUGE_HVR2200_3\t6\n#define SAA7164_BOARD_HAUPPAUGE_HVR2250_2\t7\n#define SAA7164_BOARD_HAUPPAUGE_HVR2250_3\t8\n#define SAA7164_BOARD_HAUPPAUGE_HVR2200_4\t9\n#define SAA7164_BOARD_HAUPPAUGE_HVR2200_5\t10\n#define SAA7164_BOARD_HAUPPAUGE_HVR2255proto\t11\n#define SAA7164_BOARD_HAUPPAUGE_HVR2255\t\t12\n#define SAA7164_BOARD_HAUPPAUGE_HVR2205\t\t13\n\n#define SAA7164_MAX_UNITS\t\t8\n#define SAA7164_TS_NUMBER_OF_LINES\t312\n#define SAA7164_PS_NUMBER_OF_LINES\t256\n#define SAA7164_PT_ENTRIES\t\t16  \n#define SAA7164_MAX_ENCODER_BUFFERS\t64  \n#define SAA7164_MAX_VBI_BUFFERS\t\t64\n\n \n#define SAA7164_PORT_TS1\t(0)\n#define SAA7164_PORT_TS2\t(SAA7164_PORT_TS1 + 1)\n#define SAA7164_PORT_ENC1\t(SAA7164_PORT_TS2 + 1)\n#define SAA7164_PORT_ENC2\t(SAA7164_PORT_ENC1 + 1)\n#define SAA7164_PORT_VBI1\t(SAA7164_PORT_ENC2 + 1)\n#define SAA7164_PORT_VBI2\t(SAA7164_PORT_VBI1 + 1)\n#define SAA7164_MAX_PORTS\t(SAA7164_PORT_VBI2 + 1)\n\n#define DBGLVL_FW    4\n#define DBGLVL_DVB   8\n#define DBGLVL_I2C  16\n#define DBGLVL_API  32\n#define DBGLVL_CMD  64\n#define DBGLVL_BUS 128\n#define DBGLVL_IRQ 256\n#define DBGLVL_BUF 512\n#define DBGLVL_ENC 1024\n#define DBGLVL_VBI 2048\n#define DBGLVL_THR 4096\n#define DBGLVL_CPU 8192\n\n#define SAA7164_NORMS \\\n\t(V4L2_STD_NTSC_M | V4L2_STD_NTSC_M_JP)\n\n \n#define SAA7164_TV_MIN_FREQ (44U * 16U)\n#define SAA7164_TV_MAX_FREQ (958U * 16U)\n\nenum port_t {\n\tSAA7164_MPEG_UNDEFINED = 0,\n\tSAA7164_MPEG_DVB,\n\tSAA7164_MPEG_ENCODER,\n\tSAA7164_MPEG_VBI,\n};\n\nenum saa7164_i2c_bus_nr {\n\tSAA7164_I2C_BUS_0 = 0,\n\tSAA7164_I2C_BUS_1,\n\tSAA7164_I2C_BUS_2,\n};\n\nenum saa7164_buffer_flags {\n\tSAA7164_BUFFER_UNDEFINED = 0,\n\tSAA7164_BUFFER_FREE,\n\tSAA7164_BUFFER_BUSY,\n\tSAA7164_BUFFER_FULL\n};\n\nenum saa7164_unit_type {\n\tSAA7164_UNIT_UNDEFINED = 0,\n\tSAA7164_UNIT_DIGITAL_DEMODULATOR,\n\tSAA7164_UNIT_ANALOG_DEMODULATOR,\n\tSAA7164_UNIT_TUNER,\n\tSAA7164_UNIT_EEPROM,\n\tSAA7164_UNIT_ZILOG_IRBLASTER,\n\tSAA7164_UNIT_ENCODER,\n};\n\n \nstruct saa7164_unit {\n\tenum saa7164_unit_type type;\n\tu8\tid;\n\tchar\t*name;\n\tenum saa7164_i2c_bus_nr i2c_bus_nr;\n\tu8\ti2c_bus_addr;\n\tu8\ti2c_reg_len;\n};\n\nstruct saa7164_board {\n\tchar\t*name;\n\tenum port_t porta, portb, portc,\n\t\tportd, porte, portf;\n\tenum {\n\t\tSAA7164_CHIP_UNDEFINED = 0,\n\t\tSAA7164_CHIP_REV2,\n\t\tSAA7164_CHIP_REV3,\n\t} chiprev;\n\tstruct\tsaa7164_unit unit[SAA7164_MAX_UNITS];\n};\n\nstruct saa7164_subid {\n\tu16     subvendor;\n\tu16     subdevice;\n\tu32     card;\n};\n\nstruct saa7164_encoder_fh {\n\tstruct v4l2_fh fh;\n\tstruct saa7164_port *port;\n\tatomic_t v4l_reading;\n};\n\nstruct saa7164_vbi_fh {\n\tstruct v4l2_fh fh;\n\tstruct saa7164_port *port;\n\tatomic_t v4l_reading;\n};\n\nstruct saa7164_histogram_bucket {\n\tu32 val;\n\tu32 count;\n\tu64 update_time;\n};\n\nstruct saa7164_histogram {\n\tchar name[32];\n\tstruct saa7164_histogram_bucket counter1[64];\n};\n\nstruct saa7164_user_buffer {\n\tstruct list_head list;\n\n\t \n\tu8  *data;\n\tu32 pos;\n\tu32 actual_size;\n\n\tu32 crc;\n};\n\nstruct saa7164_fw_status {\n\n\t \n\tu32\tstatus;\n\tu32\tmode;\n\tu32\tspec;\n\tu32\tinst;\n\tu32\tcpuload;\n\tu32\tremainheap;\n\n\t \n\tu32\tversion;\n\tu32\tmajor;\n\tu32\tsub;\n\tu32\trel;\n\tu32\tbuildnr;\n};\n\nstruct saa7164_dvb {\n\tstruct mutex lock;\n\tstruct dvb_adapter adapter;\n\tstruct dvb_frontend *frontend;\n\tstruct dvb_demux demux;\n\tstruct dmxdev dmxdev;\n\tstruct dmx_frontend fe_hw;\n\tstruct dmx_frontend fe_mem;\n\tstruct dvb_net net;\n\tint feeding;\n};\n\nstruct saa7164_i2c {\n\tstruct saa7164_dev\t\t*dev;\n\n\tenum saa7164_i2c_bus_nr\t\tnr;\n\n\t \n\tstruct i2c_adapter\t\ti2c_adap;\n\tstruct i2c_client\t\ti2c_client;\n\tu32\t\t\t\ti2c_rc;\n};\n\nstruct saa7164_tvnorm {\n\tchar\t\t*name;\n\tv4l2_std_id\tid;\n};\n\nstruct saa7164_encoder_params {\n\tstruct saa7164_tvnorm encodernorm;\n\tu32 height;\n\tu32 width;\n\tu32 is_50hz;\n\tu32 bitrate;  \n\tu32 bitrate_peak;  \n\tu32 bitrate_mode;\n\tu32 stream_type;  \n\n\tu32 audio_sampling_freq;\n\tu32 ctl_mute;\n\tu32 ctl_aspect;\n\tu32 refdist;\n\tu32 gop_size;\n};\n\nstruct saa7164_vbi_params {\n\tstruct saa7164_tvnorm encodernorm;\n\tu32 height;\n\tu32 width;\n\tu32 is_50hz;\n\tu32 bitrate;  \n\tu32 bitrate_peak;  \n\tu32 bitrate_mode;\n\tu32 stream_type;  \n\n\tu32 audio_sampling_freq;\n\tu32 ctl_mute;\n\tu32 ctl_aspect;\n\tu32 refdist;\n\tu32 gop_size;\n};\n\nstruct saa7164_port;\n\nstruct saa7164_buffer {\n\tstruct list_head list;\n\n\t \n\tint idx;\n\n\tstruct saa7164_port *port;\n\n\t \n\t \n\tenum saa7164_buffer_flags flags;  \n\n\t \n\tu32 pci_size;\t \n\tu64 *cpu;\t \n\tdma_addr_t dma;\t \n\tu32 crc;\t \n\n\t \n\tu32 pt_size;\t\t \n\tu64 *pt_cpu;\t\t \n\tdma_addr_t pt_dma;\t \n\n\t \n\tu32 pos;\n\tu32 actual_size;\n};\n\nstruct saa7164_port {\n\n\tstruct saa7164_dev *dev;\n\tenum port_t type;\n\tint nr;\n\n\t \n\n\t \n\tstruct tmHWStreamParameters hw_streamingparams;\n\n\t \n\tstruct tmComResDMATermDescrHeader hwcfg;\n\n\t \n\tu32 bufcounter;\n\tu32 pitch;\n\tu32 bufsize;\n\tu32 bufoffset;\n\tu32 bufptr32l;\n\tu32 bufptr32h;\n\tu64 bufptr64;\n\n\tu32 numpte;\t \n\n\tstruct mutex dmaqueue_lock;\n\tstruct saa7164_buffer dmaqueue;\n\n\tu64 last_irq_msecs, last_svc_msecs;\n\tu64 last_irq_msecs_diff, last_svc_msecs_diff;\n\tu32 last_svc_wp;\n\tu32 last_svc_rp;\n\tu64 last_irq_svc_msecs_diff;\n\tu64 last_read_msecs, last_read_msecs_diff;\n\tu64 last_poll_msecs, last_poll_msecs_diff;\n\n\tstruct saa7164_histogram irq_interval;\n\tstruct saa7164_histogram svc_interval;\n\tstruct saa7164_histogram irq_svc_interval;\n\tstruct saa7164_histogram read_interval;\n\tstruct saa7164_histogram poll_interval;\n\n\t \n\tstruct saa7164_dvb dvb;\n\tstruct i2c_client *i2c_client_demod;\n\tstruct i2c_client *i2c_client_tuner;\n\n\t \n\t \n\t \n\tstruct saa7164_tvnorm encodernorm;\n\tstruct v4l2_ctrl_handler ctrl_handler;\n\tv4l2_std_id std;\n\tu32 height;\n\tu32 width;\n\tu32 freq;\n\tu8 mux_input;\n\tu8 encoder_profile;\n\tu8 video_format;\n\tu8 audio_format;\n\tu8 video_resolution;\n\tu16 ctl_brightness;\n\tu16 ctl_contrast;\n\tu16 ctl_hue;\n\tu16 ctl_saturation;\n\tu16 ctl_sharpness;\n\ts8 ctl_volume;\n\n\tstruct tmComResAFeatureDescrHeader audfeat;\n\tstruct tmComResEncoderDescrHeader encunit;\n\tstruct tmComResProcDescrHeader vidproc;\n\tstruct tmComResExtDevDescrHeader ifunit;\n\tstruct tmComResTunerDescrHeader tunerunit;\n\n\tstruct work_struct workenc;\n\n\t \n\tstruct saa7164_encoder_params encoder_params;\n\tstruct video_device *v4l_device;\n\tatomic_t v4l_reader_count;\n\n\tstruct saa7164_buffer list_buf_used;\n\tstruct saa7164_buffer list_buf_free;\n\twait_queue_head_t wait_read;\n\n\t \n\tstruct tmComResVBIFormatDescrHeader vbi_fmt_ntsc;\n\tstruct saa7164_vbi_params vbi_params;\n\tstruct saa7164_port *enc_port;\n\n\t \n\tu32 sync_errors;\n\tu32 v_cc_errors;\n\tu32 a_cc_errors;\n\tu8 last_v_cc;\n\tu8 last_a_cc;\n\tu32 done_first_interrupt;\n};\n\nstruct saa7164_dev {\n\tstruct list_head\tdevlist;\n\tatomic_t\t\trefcount;\n\n\tstruct v4l2_device v4l2_dev;\n\n\t \n\tstruct pci_dev\t*pci;\n\tunsigned char\tpci_rev, pci_lat;\n\tint\t\tpci_bus, pci_slot;\n\tu32\t\t__iomem *lmmio;\n\tu8\t\t__iomem *bmmio;\n\tu32\t\t__iomem *lmmio2;\n\tu8\t\t__iomem *bmmio2;\n\tint\t\tpci_irqmask;\n\n\t \n\tint\tnr;\n\tint\thwrevision;\n\tu32\tboard;\n\tchar\tname[16];\n\n\t \n\tstruct saa7164_fw_status\tfw_status;\n\tu32\t\t\t\tfirmwareloaded;\n\n\tstruct tmComResHWDescr\t\thwdesc;\n\tstruct tmComResInterfaceDescr\tintfdesc;\n\tstruct tmComResBusDescr\t\tbusdesc;\n\n\tstruct tmComResBusInfo\t\tbus;\n\n\t \n\tu32 int_status;\n\tu32 int_ack;\n\tbool msi;\n\n\tstruct cmd\t\t\tcmds[SAA_CMD_MAX_MSG_UNITS];\n\tstruct mutex\t\t\tlock;\n\n\t \n\tstruct saa7164_i2c i2c_bus[3];\n\n\t \n\tstruct saa7164_port ports[SAA7164_MAX_PORTS];\n\n\t \n\tstruct work_struct workcmd;\n\n\t \n\tstruct task_struct *kthread;\n\n};\n\nextern struct list_head saa7164_devlist;\nextern unsigned int waitsecs;\nextern unsigned int encoder_buffers;\nextern unsigned int vbi_buffers;\n\n \n \nvoid saa7164_dumpregs(struct saa7164_dev *dev, u32 addr);\nvoid saa7164_getfirmwarestatus(struct saa7164_dev *dev);\nu32 saa7164_getcurrentfirmwareversion(struct saa7164_dev *dev);\nvoid saa7164_histogram_update(struct saa7164_histogram *hg, u32 val);\n\n \n \nint saa7164_downloadfirmware(struct saa7164_dev *dev);\n\n \n \nextern int saa7164_i2c_register(struct saa7164_i2c *bus);\nextern int saa7164_i2c_unregister(struct saa7164_i2c *bus);\n\n \n \nint saa7164_bus_setup(struct saa7164_dev *dev);\nvoid saa7164_bus_dump(struct saa7164_dev *dev);\nint saa7164_bus_set(struct saa7164_dev *dev, struct tmComResInfo* msg,\n\tvoid *buf);\nint saa7164_bus_get(struct saa7164_dev *dev, struct tmComResInfo* msg,\n\tvoid *buf, int peekonly);\n\n \n \nint saa7164_cmd_send(struct saa7164_dev *dev,\n\tu8 id, enum tmComResCmd command, u16 controlselector,\n\tu16 size, void *buf);\nvoid saa7164_cmd_signal(struct saa7164_dev *dev, u8 seqno);\nint saa7164_irq_dequeue(struct saa7164_dev *dev);\n\n \n \nint saa7164_api_get_fw_version(struct saa7164_dev *dev, u32 *version);\nint saa7164_api_enum_subdevs(struct saa7164_dev *dev);\nint saa7164_api_i2c_read(struct saa7164_i2c *bus, u8 addr, u32 reglen, u8 *reg,\n\tu32 datalen, u8 *data);\nint saa7164_api_i2c_write(struct saa7164_i2c *bus, u8 addr,\n\tu32 datalen, u8 *data);\nint saa7164_api_dif_write(struct saa7164_i2c *bus, u8 addr,\n\tu32 datalen, u8 *data);\nint saa7164_api_read_eeprom(struct saa7164_dev *dev, u8 *buf, int buflen);\nint saa7164_api_set_gpiobit(struct saa7164_dev *dev, u8 unitid, u8 pin);\nint saa7164_api_clear_gpiobit(struct saa7164_dev *dev, u8 unitid, u8 pin);\nint saa7164_api_transition_port(struct saa7164_port *port, u8 mode);\nint saa7164_api_initialize_dif(struct saa7164_port *port);\nint saa7164_api_configure_dif(struct saa7164_port *port, u32 std);\nint saa7164_api_set_encoder(struct saa7164_port *port);\nint saa7164_api_get_encoder(struct saa7164_port *port);\nint saa7164_api_set_aspect_ratio(struct saa7164_port *port);\nint saa7164_api_set_usercontrol(struct saa7164_port *port, u8 ctl);\nint saa7164_api_get_usercontrol(struct saa7164_port *port, u8 ctl);\nint saa7164_api_set_videomux(struct saa7164_port *port);\nint saa7164_api_audio_mute(struct saa7164_port *port, int mute);\nint saa7164_api_set_audio_volume(struct saa7164_port *port, s8 level);\nint saa7164_api_set_audio_std(struct saa7164_port *port);\nint saa7164_api_set_audio_detection(struct saa7164_port *port, int autodetect);\nint saa7164_api_get_videomux(struct saa7164_port *port);\nint saa7164_api_set_vbi_format(struct saa7164_port *port);\nint saa7164_api_set_debug(struct saa7164_dev *dev, u8 level);\nint saa7164_api_collect_debug(struct saa7164_dev *dev);\nint saa7164_api_get_load_info(struct saa7164_dev *dev,\n\tstruct tmFwInfoStruct *i);\n\n \n \nextern struct saa7164_board saa7164_boards[];\nextern const unsigned int saa7164_bcount;\n\nextern struct saa7164_subid saa7164_subids[];\nextern const unsigned int saa7164_idcount;\n\nextern void saa7164_card_list(struct saa7164_dev *dev);\nextern void saa7164_gpio_setup(struct saa7164_dev *dev);\nextern void saa7164_card_setup(struct saa7164_dev *dev);\n\nextern int saa7164_i2caddr_to_reglen(struct saa7164_i2c *bus, int addr);\nextern int saa7164_i2caddr_to_unitid(struct saa7164_i2c *bus, int addr);\nextern char *saa7164_unitid_name(struct saa7164_dev *dev, u8 unitid);\n\n \n \nextern int saa7164_dvb_register(struct saa7164_port *port);\nextern int saa7164_dvb_unregister(struct saa7164_port *port);\n\n \n \nextern struct saa7164_buffer *saa7164_buffer_alloc(\n\tstruct saa7164_port *port, u32 len);\nextern int saa7164_buffer_dealloc(struct saa7164_buffer *buf);\nextern void saa7164_buffer_display(struct saa7164_buffer *buf);\nextern int saa7164_buffer_activate(struct saa7164_buffer *buf, int i);\nextern int saa7164_buffer_cfg_port(struct saa7164_port *port);\nextern struct saa7164_user_buffer *saa7164_buffer_alloc_user(\n\tstruct saa7164_dev *dev, u32 len);\nextern void saa7164_buffer_dealloc_user(struct saa7164_user_buffer *buf);\nextern int saa7164_buffer_zero_offsets(struct saa7164_port *port, int i);\n\n \n \nint saa7164_s_std(struct saa7164_port *port, v4l2_std_id id);\nint saa7164_g_std(struct saa7164_port *port, v4l2_std_id *id);\nint saa7164_enum_input(struct file *file, void *priv, struct v4l2_input *i);\nint saa7164_g_input(struct saa7164_port *port, unsigned int *i);\nint saa7164_s_input(struct saa7164_port *port, unsigned int i);\nint saa7164_g_tuner(struct file *file, void *priv, struct v4l2_tuner *t);\nint saa7164_s_tuner(struct file *file, void *priv, const struct v4l2_tuner *t);\nint saa7164_g_frequency(struct saa7164_port *port, struct v4l2_frequency *f);\nint saa7164_s_frequency(struct saa7164_port *port,\n\t\t\tconst struct v4l2_frequency *f);\nint saa7164_encoder_register(struct saa7164_port *port);\nvoid saa7164_encoder_unregister(struct saa7164_port *port);\n\n \n \nint saa7164_vbi_register(struct saa7164_port *port);\nvoid saa7164_vbi_unregister(struct saa7164_port *port);\n\n \n\nextern unsigned int crc_checking;\n\nextern unsigned int saa_debug;\n#define dprintk(level, fmt, arg...)\\\n\tdo { if (saa_debug & level)\\\n\t\tprintk(KERN_DEBUG \"%s: \" fmt, dev->name, ## arg);\\\n\t} while (0)\n\n#define log_warn(fmt, arg...)\\\n\tdo { \\\n\t\tprintk(KERN_WARNING \"%s: \" fmt, dev->name, ## arg);\\\n\t} while (0)\n\n#define saa7164_readl(reg) readl(dev->lmmio + ((reg) >> 2))\n#define saa7164_writel(reg, value) writel((value), dev->lmmio + ((reg) >> 2))\n\n#define saa7164_readb(reg)             readl(dev->bmmio + (reg))\n#define saa7164_writeb(reg, value)     writel((value), dev->bmmio + (reg))\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}