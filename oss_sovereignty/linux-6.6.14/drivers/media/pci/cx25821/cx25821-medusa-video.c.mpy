{
  "module_name": "cx25821-medusa-video.c",
  "hash_id": "4e4ef904d20c5d45b5974618a7947f008cf36b9b9e6596f63b985b7694f71439",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/cx25821/cx25821-medusa-video.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include \"cx25821.h\"\n#include \"cx25821-medusa-video.h\"\n#include \"cx25821-biffuncs.h\"\n\n \nstatic void medusa_enable_bluefield_output(struct cx25821_dev *dev, int channel,\n\t\t\t\t\t   int enable)\n{\n\tu32 value = 0;\n\tu32 tmp = 0;\n\tint out_ctrl = OUT_CTRL1;\n\tint out_ctrl_ns = OUT_CTRL_NS;\n\n\tswitch (channel) {\n\tdefault:\n\tcase VDEC_A:\n\t\tbreak;\n\tcase VDEC_B:\n\t\tout_ctrl = VDEC_B_OUT_CTRL1;\n\t\tout_ctrl_ns = VDEC_B_OUT_CTRL_NS;\n\t\tbreak;\n\tcase VDEC_C:\n\t\tout_ctrl = VDEC_C_OUT_CTRL1;\n\t\tout_ctrl_ns = VDEC_C_OUT_CTRL_NS;\n\t\tbreak;\n\tcase VDEC_D:\n\t\tout_ctrl = VDEC_D_OUT_CTRL1;\n\t\tout_ctrl_ns = VDEC_D_OUT_CTRL_NS;\n\t\tbreak;\n\tcase VDEC_E:\n\t\tout_ctrl = VDEC_E_OUT_CTRL1;\n\t\tout_ctrl_ns = VDEC_E_OUT_CTRL_NS;\n\t\treturn;\n\tcase VDEC_F:\n\t\tout_ctrl = VDEC_F_OUT_CTRL1;\n\t\tout_ctrl_ns = VDEC_F_OUT_CTRL_NS;\n\t\treturn;\n\tcase VDEC_G:\n\t\tout_ctrl = VDEC_G_OUT_CTRL1;\n\t\tout_ctrl_ns = VDEC_G_OUT_CTRL_NS;\n\t\treturn;\n\tcase VDEC_H:\n\t\tout_ctrl = VDEC_H_OUT_CTRL1;\n\t\tout_ctrl_ns = VDEC_H_OUT_CTRL_NS;\n\t\treturn;\n\t}\n\n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], out_ctrl, &tmp);\n\tvalue &= 0xFFFFFF7F;\t \n\tif (enable)\n\t\tvalue |= 0x00000080;\t \n\tcx25821_i2c_write(&dev->i2c_bus[0], out_ctrl, value);\n\n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], out_ctrl_ns, &tmp);\n\tvalue &= 0xFFFFFF7F;\n\tif (enable)\n\t\tvalue |= 0x00000080;\t \n\tcx25821_i2c_write(&dev->i2c_bus[0], out_ctrl_ns, value);\n}\n\nstatic int medusa_initialize_ntsc(struct cx25821_dev *dev)\n{\n\tint ret_val = 0;\n\tint i = 0;\n\tu32 value = 0;\n\tu32 tmp = 0;\n\n\tfor (i = 0; i < MAX_DECODERS; i++) {\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tMODE_CTRL + (0x200 * i), &tmp);\n\t\tvalue &= 0xFFFFFFF0;\n\t\t \n\t\tvalue |= 0x10001;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tMODE_CTRL + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tHORIZ_TIM_CTRL + (0x200 * i), &tmp);\n\t\tvalue &= 0x00C00C00;\n\t\tvalue |= 0x612D0074;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tHORIZ_TIM_CTRL + (0x200 * i), value);\n\n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tVERT_TIM_CTRL + (0x200 * i), &tmp);\n\t\tvalue &= 0x00C00C00;\n\t\tvalue |= 0x1C1E001A;\t \n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tVERT_TIM_CTRL + (0x200 * i), value);\n\n\t\t \n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tSC_STEP_SIZE + (0x200 * i), 0x43E00000);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL_NS + (0x200 * i), &tmp);\n\t\tvalue &= 0xFFFBFFFF;\n\t\tvalue |= 0x00040000;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL_NS + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL1 + (0x200 * i), &tmp);\n\t\tvalue &= 0xFFFBFFFF;\n\t\tvalue |= 0x00040000;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL1 + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tMISC_TIM_CTRL + (0x200 * i), &tmp);\n\t\t \n\t\tvalue = setBitAtPos(value, 14);\n\t\tvalue = clearBitAtPos(value, 15);\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tMISC_TIM_CTRL + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDFE_CTRL1 + (0x200 * i), &tmp);\n\t\tvalue = clearBitAtPos(value, 29);\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDFE_CTRL1 + (0x200 * i), value);\n\n\t\t \n\t\tmedusa_enable_bluefield_output(dev, i, 1);\n\t}\n\n\tfor (i = 0; i < MAX_ENCODERS; i++) {\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_1 + (0x100 * i), &tmp);\n\t\tvalue &= 0xF000FC00;\n\t\tvalue |= 0x06B402D0;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_1 + (0x100 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_2 + (0x100 * i), &tmp);\n\t\tvalue &= 0xFF000000;\n\t\tvalue |= 0x007E9054;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_2 + (0x100 * i), value);\n\n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_3 + (0x100 * i), &tmp);\n\t\tvalue &= 0xFC00FE00;\n\t\tvalue |= 0x00EC00F0;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_3 + (0x100 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_4 + (0x100 * i), &tmp);\n\t\tvalue &= 0x00FCFFFF;\n\t\tvalue |= 0x13020000;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_4 + (0x100 * i), value);\n\n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_5 + (0x100 * i), &tmp);\n\t\tvalue &= 0xFFFF0000;\n\t\tvalue |= 0x0000E575;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_5 + (0x100 * i), value);\n\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_6 + (0x100 * i), 0x009A89C1);\n\n\t\t \n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_7 + (0x100 * i), 0x21F07C1F);\n\t}\n\n\t \n\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], HSCALE_CTRL, 0x0);\n\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], VSCALE_CTRL, 0x0);\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], BYP_AB_CTRL, &tmp);\n\tvalue |= 0x00080200;\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], BYP_AB_CTRL, value);\n\n\treturn ret_val;\n}\n\nstatic int medusa_PALCombInit(struct cx25821_dev *dev, int dec)\n{\n\tint ret_val = -1;\n\tu32 value = 0, tmp = 0;\n\n\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tCOMB_2D_HFS_CFG + (0x200 * dec), 0x20002861);\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tCOMB_2D_HFD_CFG + (0x200 * dec), 0x20002861);\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tCOMB_2D_LF_CFG + (0x200 * dec), 0x200A1023);\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\tCOMB_FLAT_THRESH_CTRL + (0x200 * dec), &tmp);\n\tvalue &= 0x06230000;\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tCOMB_FLAT_THRESH_CTRL + (0x200 * dec), value);\n\n\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tCOMB_2D_BLEND + (0x200 * dec), 0x210F0F0F);\n\n\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tCOMB_MISC_CTRL + (0x200 * dec), 0x41120A7F);\n\n\treturn ret_val;\n}\n\nstatic int medusa_initialize_pal(struct cx25821_dev *dev)\n{\n\tint ret_val = 0;\n\tint i = 0;\n\tu32 value = 0;\n\tu32 tmp = 0;\n\n\tfor (i = 0; i < MAX_DECODERS; i++) {\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tMODE_CTRL + (0x200 * i), &tmp);\n\t\tvalue &= 0xFFFFFFF0;\n\t\t \n\t\tvalue |= 0x10004;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tMODE_CTRL + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tHORIZ_TIM_CTRL + (0x200 * i), &tmp);\n\t\tvalue &= 0x00C00C00;\n\t\tvalue |= 0x632D007D;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tHORIZ_TIM_CTRL + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tVERT_TIM_CTRL + (0x200 * i), &tmp);\n\t\tvalue &= 0x00C00C00;\n\t\tvalue |= 0x28240026;\t \n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tVERT_TIM_CTRL + (0x200 * i), value);\n\n\t\t \n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tSC_STEP_SIZE + (0x200 * i), 0x5411E2D0);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL_NS + (0x200 * i), &tmp);\n\t\tvalue &= 0xFFFBFFFF;\n\t\tvalue |= 0x00040000;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL_NS + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL1 + (0x200 * i), &tmp);\n\t\tvalue &= 0xFFFBFFFF;\n\t\tvalue |= 0x00040000;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tOUT_CTRL1 + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tMISC_TIM_CTRL + (0x200 * i), &tmp);\n\t\t \n\t\tvalue = setBitAtPos(value, 14);\n\t\tvalue = clearBitAtPos(value, 15);\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tMISC_TIM_CTRL + (0x200 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDFE_CTRL1 + (0x200 * i), &tmp);\n\t\tvalue = clearBitAtPos(value, 29);\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDFE_CTRL1 + (0x200 * i), value);\n\n\t\tmedusa_PALCombInit(dev, i);\n\n\t\t \n\t\tmedusa_enable_bluefield_output(dev, i, 1);\n\t}\n\n\tfor (i = 0; i < MAX_ENCODERS; i++) {\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_1 + (0x100 * i), &tmp);\n\t\tvalue &= 0xF000FC00;\n\t\tvalue |= 0x06C002D0;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_1 + (0x100 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_2 + (0x100 * i), &tmp);\n\t\tvalue &= 0xFF000000;\n\t\tvalue |= 0x007E9754;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_2 + (0x100 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_3 + (0x100 * i), &tmp);\n\t\tvalue &= 0xFC00FE00;\n\t\tvalue |= 0x00FC0120;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_3 + (0x100 * i), value);\n\n\t\t \n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_4 + (0x100 * i), &tmp);\n\t\tvalue &= 0x00FCFFFF;\n\t\tvalue |= 0x14010000;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_4 + (0x100 * i), value);\n\n\t\tvalue = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_5 + (0x100 * i), &tmp);\n\t\tvalue &= 0xFFFF0000;\n\t\tvalue |= 0x0000F078;\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_5 + (0x100 * i), value);\n\n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_6 + (0x100 * i), 0x00A493CF);\n\n\t\t \n\t\tret_val = cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tDENC_A_REG_7 + (0x100 * i), 0x2A098ACB);\n\t}\n\n\t \n\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], HSCALE_CTRL, 0x0);\n\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], VSCALE_CTRL, 0x0);\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], BYP_AB_CTRL, &tmp);\n\tvalue &= 0xFFF7FDFF;\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], BYP_AB_CTRL, value);\n\n\treturn ret_val;\n}\n\nint medusa_set_videostandard(struct cx25821_dev *dev)\n{\n\tint status = 0;\n\tu32 value = 0, tmp = 0;\n\n\tif (dev->tvnorm & V4L2_STD_PAL_BG || dev->tvnorm & V4L2_STD_PAL_DK)\n\t\tstatus = medusa_initialize_pal(dev);\n\telse\n\t\tstatus = medusa_initialize_ntsc(dev);\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], DENC_A_REG_4, &tmp);\n\tvalue = setBitAtPos(value, 4);\n\tstatus = cx25821_i2c_write(&dev->i2c_bus[0], DENC_A_REG_4, value);\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], DENC_B_REG_4, &tmp);\n\tvalue = setBitAtPos(value, 4);\n\tstatus = cx25821_i2c_write(&dev->i2c_bus[0], DENC_B_REG_4, value);\n\n\treturn status;\n}\n\nvoid medusa_set_resolution(struct cx25821_dev *dev, int width,\n\t\t\t   int decoder_select)\n{\n\tint decoder = 0;\n\tint decoder_count = 0;\n\tu32 hscale = 0x0;\n\tu32 vscale = 0x0;\n\tconst int MAX_WIDTH = 720;\n\n\t \n\tif (width > MAX_WIDTH) {\n\t\tpr_info(\"%s(): width %d > MAX_WIDTH %d ! resetting to MAX_WIDTH\\n\",\n\t\t\t__func__, width, MAX_WIDTH);\n\t\twidth = MAX_WIDTH;\n\t}\n\n\tif (decoder_select <= 7 && decoder_select >= 0) {\n\t\tdecoder = decoder_select;\n\t\tdecoder_count = decoder_select + 1;\n\t} else {\n\t\tdecoder = 0;\n\t\tdecoder_count = dev->_max_num_decoders;\n\t}\n\n\tswitch (width) {\n\tcase 320:\n\t\thscale = 0x13E34B;\n\t\tvscale = 0x0;\n\t\tbreak;\n\n\tcase 352:\n\t\thscale = 0x10A273;\n\t\tvscale = 0x0;\n\t\tbreak;\n\n\tcase 176:\n\t\thscale = 0x3115B2;\n\t\tvscale = 0x1E00;\n\t\tbreak;\n\n\tcase 160:\n\t\thscale = 0x378D84;\n\t\tvscale = 0x1E00;\n\t\tbreak;\n\n\tdefault:\t\t \n\t\thscale = 0x0;\n\t\tvscale = 0x0;\n\t\tbreak;\n\t}\n\n\tfor (; decoder < decoder_count; decoder++) {\n\t\t \n\t\tcx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tHSCALE_CTRL + (0x200 * decoder), hscale);\n\t\tcx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\t\tVSCALE_CTRL + (0x200 * decoder), vscale);\n\t}\n}\n\nstatic void medusa_set_decoderduration(struct cx25821_dev *dev, int decoder,\n\t\t\t\t       int duration)\n{\n\tu32 fld_cnt = 0;\n\tu32 tmp = 0;\n\tu32 disp_cnt_reg = DISP_AB_CNT;\n\n\t \n\tif (decoder < VDEC_A || decoder > VDEC_H) {\n\t\treturn;\n\t}\n\n\tswitch (decoder) {\n\tdefault:\n\t\tbreak;\n\tcase VDEC_C:\n\tcase VDEC_D:\n\t\tdisp_cnt_reg = DISP_CD_CNT;\n\t\tbreak;\n\tcase VDEC_E:\n\tcase VDEC_F:\n\t\tdisp_cnt_reg = DISP_EF_CNT;\n\t\tbreak;\n\tcase VDEC_G:\n\tcase VDEC_H:\n\t\tdisp_cnt_reg = DISP_GH_CNT;\n\t\tbreak;\n\t}\n\n\t \n\tfld_cnt = cx25821_i2c_read(&dev->i2c_bus[0], disp_cnt_reg, &tmp);\n\n\tif (!(decoder % 2)) {\t \n\t\tfld_cnt &= 0xFFFF0000;\n\t\tfld_cnt |= duration;\n\t} else {\n\t\tfld_cnt &= 0x0000FFFF;\n\t\tfld_cnt |= ((u32) duration) << 16;\n\t}\n\n\tcx25821_i2c_write(&dev->i2c_bus[0], disp_cnt_reg, fld_cnt);\n}\n\n \nstatic int mapM(int srcMin, int srcMax, int srcVal, int dstMin, int dstMax,\n\t\tint *dstVal)\n{\n\tint numerator;\n\tint denominator;\n\tint quotient;\n\n\tif ((srcMin == srcMax) || (srcVal < srcMin) || (srcVal > srcMax))\n\t\treturn -1;\n\t \n\tnumerator = (srcVal - srcMin) * (dstMax - dstMin);\n\tdenominator = srcMax - srcMin;\n\tquotient = numerator / denominator;\n\n\tif (2 * (numerator % denominator) >= denominator)\n\t\tquotient++;\n\n\t*dstVal = quotient + dstMin;\n\n\treturn 0;\n}\n\nstatic unsigned long convert_to_twos(long numeric, unsigned long bits_len)\n{\n\tunsigned char temp;\n\n\tif (numeric >= 0)\n\t\treturn numeric;\n\telse {\n\t\ttemp = ~(abs(numeric) & 0xFF);\n\t\ttemp += 1;\n\t\treturn temp;\n\t}\n}\n\nint medusa_set_brightness(struct cx25821_dev *dev, int brightness, int decoder)\n{\n\tint ret_val = 0;\n\tint value = 0;\n\tu32 val = 0, tmp = 0;\n\n\tif ((brightness > VIDEO_PROCAMP_MAX) ||\n\t    (brightness < VIDEO_PROCAMP_MIN)) {\n\t\treturn -1;\n\t}\n\tret_val = mapM(VIDEO_PROCAMP_MIN, VIDEO_PROCAMP_MAX, brightness,\n\t\t\tSIGNED_BYTE_MIN, SIGNED_BYTE_MAX, &value);\n\tvalue = convert_to_twos(value, 8);\n\tval = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\tVDEC_A_BRITE_CTRL + (0x200 * decoder), &tmp);\n\tval &= 0xFFFFFF00;\n\tret_val |= cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tVDEC_A_BRITE_CTRL + (0x200 * decoder), val | value);\n\treturn ret_val;\n}\n\nint medusa_set_contrast(struct cx25821_dev *dev, int contrast, int decoder)\n{\n\tint ret_val = 0;\n\tint value = 0;\n\tu32 val = 0, tmp = 0;\n\n\tif ((contrast > VIDEO_PROCAMP_MAX) || (contrast < VIDEO_PROCAMP_MIN)) {\n\t\treturn -1;\n\t}\n\n\tret_val = mapM(VIDEO_PROCAMP_MIN, VIDEO_PROCAMP_MAX, contrast,\n\t\t\tUNSIGNED_BYTE_MIN, UNSIGNED_BYTE_MAX, &value);\n\tval = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\tVDEC_A_CNTRST_CTRL + (0x200 * decoder), &tmp);\n\tval &= 0xFFFFFF00;\n\tret_val |= cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tVDEC_A_CNTRST_CTRL + (0x200 * decoder), val | value);\n\n\treturn ret_val;\n}\n\nint medusa_set_hue(struct cx25821_dev *dev, int hue, int decoder)\n{\n\tint ret_val = 0;\n\tint value = 0;\n\tu32 val = 0, tmp = 0;\n\n\tif ((hue > VIDEO_PROCAMP_MAX) || (hue < VIDEO_PROCAMP_MIN)) {\n\t\treturn -1;\n\t}\n\n\tret_val = mapM(VIDEO_PROCAMP_MIN, VIDEO_PROCAMP_MAX, hue,\n\t\t\tSIGNED_BYTE_MIN, SIGNED_BYTE_MAX, &value);\n\n\tvalue = convert_to_twos(value, 8);\n\tval = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\tVDEC_A_HUE_CTRL + (0x200 * decoder), &tmp);\n\tval &= 0xFFFFFF00;\n\n\tret_val |= cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tVDEC_A_HUE_CTRL + (0x200 * decoder), val | value);\n\n\treturn ret_val;\n}\n\nint medusa_set_saturation(struct cx25821_dev *dev, int saturation, int decoder)\n{\n\tint ret_val = 0;\n\tint value = 0;\n\tu32 val = 0, tmp = 0;\n\n\tif ((saturation > VIDEO_PROCAMP_MAX) ||\n\t    (saturation < VIDEO_PROCAMP_MIN)) {\n\t\treturn -1;\n\t}\n\n\tret_val = mapM(VIDEO_PROCAMP_MIN, VIDEO_PROCAMP_MAX, saturation,\n\t\t\tUNSIGNED_BYTE_MIN, UNSIGNED_BYTE_MAX, &value);\n\n\tval = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\tVDEC_A_USAT_CTRL + (0x200 * decoder), &tmp);\n\tval &= 0xFFFFFF00;\n\tret_val |= cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tVDEC_A_USAT_CTRL + (0x200 * decoder), val | value);\n\n\tval = cx25821_i2c_read(&dev->i2c_bus[0],\n\t\t\tVDEC_A_VSAT_CTRL + (0x200 * decoder), &tmp);\n\tval &= 0xFFFFFF00;\n\tret_val |= cx25821_i2c_write(&dev->i2c_bus[0],\n\t\t\tVDEC_A_VSAT_CTRL + (0x200 * decoder), val | value);\n\n\treturn ret_val;\n}\n\n \n\nint medusa_video_init(struct cx25821_dev *dev)\n{\n\tu32 value = 0, tmp = 0;\n\tint ret_val = 0;\n\tint i = 0;\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], MON_A_CTRL, &tmp);\n\tvalue &= 0xFFFFF0FF;\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], MON_A_CTRL, value);\n\n\tif (ret_val < 0)\n\t\tgoto error;\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], MON_A_CTRL, &tmp);\n\tvalue &= 0xFFFFFFDF;\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], MON_A_CTRL, value);\n\n\tif (ret_val < 0)\n\t\tgoto error;\n\n\t \n\tfor (i = 0; i < dev->_max_num_decoders; i++)\n\t\tmedusa_set_decoderduration(dev, i, 0);\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], DENC_AB_CTRL, &tmp);\n\tvalue &= 0xFF70FF70;\n\tvalue |= 0x00090008;\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], DENC_AB_CTRL, value);\n\n\tif (ret_val < 0)\n\t\tgoto error;\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], BYP_AB_CTRL, &tmp);\n\tvalue |= 0x00040100;\t \n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], BYP_AB_CTRL, value);\n\n\tif (ret_val < 0)\n\t\tgoto error;\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], AFE_AB_DIAG_CTRL, &tmp);\n\tvalue &= 0x83FFFFFF;\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], AFE_AB_DIAG_CTRL,\n\t\t\tvalue | 0x10000000);\n\n\tif (ret_val < 0)\n\t\tgoto error;\n\n\t \n\tvalue = cx25821_i2c_read(&dev->i2c_bus[0], PIN_OE_CTRL, &tmp);\n\tvalue &= 0xFEF0FE00;\n\tif (dev->_max_num_decoders == MAX_DECODERS) {\n\t\t \n\t\tvalue |= 0x010001F8;\n\t} else {\n\t\t \n\t\tvalue |= 0x010F0108;\n\t}\n\n\tvalue |= 7;\n\tret_val = cx25821_i2c_write(&dev->i2c_bus[0], PIN_OE_CTRL, value);\n\n\tif (ret_val < 0)\n\t\tgoto error;\n\n\tret_val = medusa_set_videostandard(dev);\n\nerror:\n\treturn ret_val;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}