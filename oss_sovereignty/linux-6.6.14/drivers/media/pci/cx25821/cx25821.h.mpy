{
  "module_name": "cx25821.h",
  "hash_id": "54d9f861732b14bdb6746a1013e40cad34500332ab169f7b9cf94feb4fdbc292",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/cx25821/cx25821.h",
  "human_readable_source": " \n \n\n#ifndef CX25821_H_\n#define CX25821_H_\n\n#include <linux/pci.h>\n#include <linux/i2c.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/sched.h>\n#include <linux/kdev_t.h>\n\n#include <media/v4l2-common.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-ctrls.h>\n#include <media/videobuf2-v4l2.h>\n#include <media/videobuf2-dma-sg.h>\n\n#include \"cx25821-reg.h\"\n#include \"cx25821-medusa-reg.h\"\n#include \"cx25821-sram.h\"\n#include \"cx25821-audio.h\"\n\n#include <linux/mutex.h>\n\n#define UNSET (-1U)\n#define NO_SYNC_LINE (-1U)\n\n#define CX25821_MAXBOARDS 2\n\n#define LINE_SIZE_D1    1440\n\n \n#define MAX_DECODERS            8\n#define MAX_ENCODERS            2\n#define QUAD_DECODERS           4\n#define MAX_CAMERAS             16\n\n \n#define MAX_CX25821_INPUT     8\n#define RESOURCE_VIDEO0       1\n#define RESOURCE_VIDEO1       2\n#define RESOURCE_VIDEO2       4\n#define RESOURCE_VIDEO3       8\n#define RESOURCE_VIDEO4       16\n#define RESOURCE_VIDEO5       32\n#define RESOURCE_VIDEO6       64\n#define RESOURCE_VIDEO7       128\n#define RESOURCE_VIDEO8       256\n#define RESOURCE_VIDEO9       512\n#define RESOURCE_VIDEO10      1024\n#define RESOURCE_VIDEO11      2048\n\n#define BUFFER_TIMEOUT     (HZ)\t \n\n#define UNKNOWN_BOARD        0\n#define CX25821_BOARD        1\n\n \n#define CX25821_NORMS (\\\n\tV4L2_STD_NTSC_M |  V4L2_STD_NTSC_M_JP | V4L2_STD_NTSC_M_KR | \\\n\tV4L2_STD_PAL_BG |  V4L2_STD_PAL_DK    |  V4L2_STD_PAL_I    | \\\n\tV4L2_STD_PAL_M  |  V4L2_STD_PAL_N     |  V4L2_STD_PAL_H    | \\\n\tV4L2_STD_PAL_Nc)\n\n#define CX25821_BOARD_CONEXANT_ATHENA10 1\n#define MAX_VID_CHANNEL_NUM     12\n\n \n#define MAX_VID_CAP_CHANNEL_NUM     10\n\n#define VID_CHANNEL_NUM 8\n\nstruct cx25821_fmt {\n\tu32 fourcc;\t\t \n\tint depth;\n\tint flags;\n\tu32 cxformat;\n};\n\nstruct cx25821_tvnorm {\n\tchar *name;\n\tv4l2_std_id id;\n\tu32 cxiformat;\n\tu32 cxoformat;\n};\n\nenum cx25821_src_sel_type {\n\tCX25821_SRC_SEL_EXT_656_VIDEO = 0,\n\tCX25821_SRC_SEL_PARALLEL_MPEG_VIDEO\n};\n\nstruct cx25821_riscmem {\n\tunsigned int   size;\n\t__le32         *cpu;\n\t__le32         *jmp;\n\tdma_addr_t     dma;\n};\n\n \nstruct cx25821_buffer {\n\t \n\tstruct vb2_v4l2_buffer vb;\n\tstruct list_head queue;\n\n\t \n\tunsigned int bpl;\n\tstruct cx25821_riscmem risc;\n\tconst struct cx25821_fmt *fmt;\n};\n\nenum port {\n\tCX25821_UNDEFINED = 0,\n\tCX25821_RAW,\n\tCX25821_264\n};\n\nstruct cx25821_board {\n\tconst char *name;\n\tenum port porta;\n\tenum port portb;\n\tenum port portc;\n\n\tu32 clk_freq;\n};\n\nstruct cx25821_i2c {\n\tstruct cx25821_dev *dev;\n\n\tint nr;\n\n\t \n\tstruct i2c_adapter i2c_adap;\n\tstruct i2c_client i2c_client;\n\tu32 i2c_rc;\n\n\t \n\tu32 i2c_period;\n\tu32 reg_ctrl;\n\tu32 reg_stat;\n\tu32 reg_addr;\n\tu32 reg_rdata;\n\tu32 reg_wdata;\n};\n\nstruct cx25821_dmaqueue {\n\tstruct list_head active;\n\tu32 count;\n};\n\nstruct cx25821_dev;\n\nstruct cx25821_channel;\n\nstruct cx25821_video_out_data {\n\tstruct cx25821_channel *chan;\n\tint _line_size;\n\tint _prog_cnt;\n\tint _pixel_format;\n\tint _is_first_frame;\n\tint _is_running;\n\tint _file_status;\n\tint _lines_count;\n\tint _frame_count;\n\tunsigned int _risc_size;\n\n\t__le32 *_dma_virt_start_addr;\n\t__le32 *_dma_virt_addr;\n\tdma_addr_t _dma_phys_addr;\n\tdma_addr_t _dma_phys_start_addr;\n\n\tunsigned int _data_buf_size;\n\t__le32 *_data_buf_virt_addr;\n\tdma_addr_t _data_buf_phys_addr;\n\n\tu32 upstream_riscbuf_size;\n\tu32 upstream_databuf_size;\n\tint is_60hz;\n\tint _frame_index;\n\tint cur_frame_index;\n\tint curpos;\n\twait_queue_head_t waitq;\n};\n\nstruct cx25821_channel {\n\tunsigned id;\n\tstruct cx25821_dev *dev;\n\n\tstruct v4l2_ctrl_handler hdl;\n\n\tstruct video_device vdev;\n\tstruct cx25821_dmaqueue dma_vidq;\n\tstruct vb2_queue vidq;\n\n\tconst struct sram_channel *sram_channels;\n\n\tconst struct cx25821_fmt *fmt;\n\tunsigned field;\n\tunsigned int width, height;\n\tint pixel_formats;\n\tint use_cif_resolution;\n\tint cif_width;\n\n\t \n\tstruct cx25821_video_out_data *out;\n};\n\nstruct snd_card;\n\nstruct cx25821_dev {\n\tstruct v4l2_device v4l2_dev;\n\n\t \n\tstruct pci_dev *pci;\n\tunsigned char pci_rev, pci_lat;\n\tint pci_bus, pci_slot;\n\tu32 base_io_addr;\n\tu32 __iomem *lmmio;\n\tu8 __iomem *bmmio;\n\tint pci_irqmask;\n\tint hwrevision;\n\t \n\tstruct snd_card *card;\n\n\tu32 clk_freq;\n\n\t \n\tstruct cx25821_i2c i2c_bus[3];\n\n\tint nr;\n\tstruct mutex lock;\n\n\tstruct cx25821_channel channels[MAX_VID_CHANNEL_NUM];\n\n\t \n\tunsigned int board;\n\tchar name[32];\n\n\t \n\tunsigned int input;\n\tv4l2_std_id tvnorm;\n\tunsigned short _max_num_decoders;\n\n\t \n\tint _audio_is_running;\n\tint _audiopixel_format;\n\tint _is_first_audio_frame;\n\tint _audiofile_status;\n\tint _audio_lines_count;\n\tint _audioframe_count;\n\tint _audio_upstream_channel;\n\tint _last_index_irq;     \n\n\t__le32 *_risc_audio_jmp_addr;\n\t__le32 *_risc_virt_start_addr;\n\t__le32 *_risc_virt_addr;\n\tdma_addr_t _risc_phys_addr;\n\tdma_addr_t _risc_phys_start_addr;\n\n\tunsigned int _audiorisc_size;\n\tunsigned int _audiodata_buf_size;\n\t__le32 *_audiodata_buf_virt_addr;\n\tdma_addr_t _audiodata_buf_phys_addr;\n\tchar *_audiofilename;\n\tu32 audio_upstream_riscbuf_size;\n\tu32 audio_upstream_databuf_size;\n\tint _audioframe_index;\n\tstruct work_struct _audio_work_entry;\n\tchar *input_audiofilename;\n\n\t \n\tspinlock_t slock;\n\n\t \n\tstruct cx25821_video_out_data vid_out_data[2];\n};\n\nstatic inline struct cx25821_dev *get_cx25821(struct v4l2_device *v4l2_dev)\n{\n\treturn container_of(v4l2_dev, struct cx25821_dev, v4l2_dev);\n}\n\nextern struct cx25821_board cx25821_boards[];\n\n#define SRAM_CH00  0\t\t \n#define SRAM_CH01  1\t\t \n#define SRAM_CH02  2\t\t \n#define SRAM_CH03  3\t\t \n#define SRAM_CH04  4\t\t \n#define SRAM_CH05  5\t\t \n#define SRAM_CH06  6\t\t \n#define SRAM_CH07  7\t\t \n\n#define SRAM_CH08  8\t\t \n#define SRAM_CH09  9\t\t \n#define SRAM_CH10  10\t\t \n#define SRAM_CH11  11\t\t \n\n#define VID_UPSTREAM_SRAM_CHANNEL_I     SRAM_CH09\n#define VID_UPSTREAM_SRAM_CHANNEL_J     SRAM_CH10\n#define AUDIO_UPSTREAM_SRAM_CHANNEL_B   SRAM_CH11\n\nstruct sram_channel {\n\tchar *name;\n\tu32 i;\n\tu32 cmds_start;\n\tu32 ctrl_start;\n\tu32 cdt;\n\tu32 fifo_start;\n\tu32 fifo_size;\n\tu32 ptr1_reg;\n\tu32 ptr2_reg;\n\tu32 cnt1_reg;\n\tu32 cnt2_reg;\n\tu32 int_msk;\n\tu32 int_stat;\n\tu32 int_mstat;\n\tu32 dma_ctl;\n\tu32 gpcnt_ctl;\n\tu32 gpcnt;\n\tu32 aud_length;\n\tu32 aud_cfg;\n\tu32 fld_aud_fifo_en;\n\tu32 fld_aud_risc_en;\n\n\t \n\tu32 vid_fmt_ctl;\n\tu32 vid_active_ctl1;\n\tu32 vid_active_ctl2;\n\tu32 vid_cdt_size;\n\n\tu32 vip_ctl;\n\tu32 pix_frmt;\n\tu32 jumponly;\n\tu32 irq_bit;\n};\n\nextern const struct sram_channel cx25821_sram_channels[];\n\n#define cx_read(reg)             readl(dev->lmmio + ((reg)>>2))\n#define cx_write(reg, value)     writel((value), dev->lmmio + ((reg)>>2))\n\n#define cx_andor(reg, mask, value) \\\n\twritel((readl(dev->lmmio+((reg)>>2)) & ~(mask)) |\\\n\t((value) & (mask)), dev->lmmio+((reg)>>2))\n\n#define cx_set(reg, bit)          cx_andor((reg), (bit), (bit))\n#define cx_clear(reg, bit)        cx_andor((reg), (bit), 0)\n\n#define Set_GPIO_Bit(Bit)                       (1 << Bit)\n#define Clear_GPIO_Bit(Bit)                     (~(1 << Bit))\n\n#define CX25821_ERR(fmt, args...)\t\t\t\\\n\tpr_err(\"(%d): \" fmt, dev->board, ##args)\n#define CX25821_WARN(fmt, args...)\t\t\t\\\n\tpr_warn(\"(%d): \" fmt, dev->board, ##args)\n#define CX25821_INFO(fmt, args...)\t\t\t\\\n\tpr_info(\"(%d): \" fmt, dev->board, ##args)\n\nextern int cx25821_i2c_register(struct cx25821_i2c *bus);\nextern int cx25821_i2c_read(struct cx25821_i2c *bus, u16 reg_addr, int *value);\nextern int cx25821_i2c_write(struct cx25821_i2c *bus, u16 reg_addr, int value);\nextern int cx25821_i2c_unregister(struct cx25821_i2c *bus);\nextern void cx25821_gpio_init(struct cx25821_dev *dev);\nextern void cx25821_set_gpiopin_direction(struct cx25821_dev *dev,\n\t\t\t\t\t  int pin_number, int pin_logic_value);\n\nextern int medusa_video_init(struct cx25821_dev *dev);\nextern int medusa_set_videostandard(struct cx25821_dev *dev);\nextern void medusa_set_resolution(struct cx25821_dev *dev, int width,\n\t\t\t\t  int decoder_select);\nextern int medusa_set_brightness(struct cx25821_dev *dev, int brightness,\n\t\t\t\t int decoder);\nextern int medusa_set_contrast(struct cx25821_dev *dev, int contrast,\n\t\t\t       int decoder);\nextern int medusa_set_hue(struct cx25821_dev *dev, int hue, int decoder);\nextern int medusa_set_saturation(struct cx25821_dev *dev, int saturation,\n\t\t\t\t int decoder);\n\nextern int cx25821_sram_channel_setup(struct cx25821_dev *dev,\n\t\t\t\t      const struct sram_channel *ch, unsigned int bpl,\n\t\t\t\t      u32 risc);\n\nextern int cx25821_riscmem_alloc(struct pci_dev *pci,\n\t\t\t\t struct cx25821_riscmem *risc,\n\t\t\t\t unsigned int size);\nextern int cx25821_risc_buffer(struct pci_dev *pci, struct cx25821_riscmem *risc,\n\t\t\t       struct scatterlist *sglist,\n\t\t\t       unsigned int top_offset,\n\t\t\t       unsigned int bottom_offset,\n\t\t\t       unsigned int bpl,\n\t\t\t       unsigned int padding, unsigned int lines);\nextern int cx25821_risc_databuffer_audio(struct pci_dev *pci,\n\t\t\t\t\t struct cx25821_riscmem *risc,\n\t\t\t\t\t struct scatterlist *sglist,\n\t\t\t\t\t unsigned int bpl,\n\t\t\t\t\t unsigned int lines, unsigned int lpi);\nextern void cx25821_free_buffer(struct cx25821_dev *dev,\n\t\t\t\tstruct cx25821_buffer *buf);\nextern void cx25821_sram_channel_dump(struct cx25821_dev *dev,\n\t\t\t\t      const struct sram_channel *ch);\nextern void cx25821_sram_channel_dump_audio(struct cx25821_dev *dev,\n\t\t\t\t\t    const struct sram_channel *ch);\n\nextern struct cx25821_dev *cx25821_dev_get(struct pci_dev *pci);\nextern void cx25821_print_irqbits(char *name, char *tag, char **strings,\n\t\t\t\t  int len, u32 bits, u32 mask);\nextern void cx25821_dev_unregister(struct cx25821_dev *dev);\nextern int cx25821_sram_channel_setup_audio(struct cx25821_dev *dev,\n\t\t\t\t\t    const struct sram_channel *ch,\n\t\t\t\t\t    unsigned int bpl, u32 risc);\n\nextern void cx25821_set_pixel_format(struct cx25821_dev *dev, int channel,\n\t\t\t\t     u32 format);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}