{
  "module_name": "cx88-tvaudio.c",
  "hash_id": "daab139692069b4d676020051c8ba96054d5e9ad93f662c47e28881de9657f7f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/cx88/cx88-tvaudio.c",
  "human_readable_source": "\n \n\n#include \"cx88.h\"\n\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/freezer.h>\n#include <linux/kernel.h>\n#include <linux/mm.h>\n#include <linux/poll.h>\n#include <linux/signal.h>\n#include <linux/ioport.h>\n#include <linux/types.h>\n#include <linux/interrupt.h>\n#include <linux/vmalloc.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/kthread.h>\n\nstatic unsigned int audio_debug;\nmodule_param(audio_debug, int, 0644);\nMODULE_PARM_DESC(audio_debug, \"enable debug messages [audio]\");\n\nstatic unsigned int always_analog;\nmodule_param(always_analog, int, 0644);\nMODULE_PARM_DESC(always_analog, \"force analog audio out\");\n\nstatic unsigned int radio_deemphasis;\nmodule_param(radio_deemphasis, int, 0644);\nMODULE_PARM_DESC(radio_deemphasis,\n\t\t \"Radio deemphasis time constant, 0=None, 1=50us (elsewhere), 2=75us (USA)\");\n\n#define dprintk(fmt, arg...) do {\t\t\t\t\\\n\tif (audio_debug)\t\t\t\t\t\t\\\n\t\tprintk(KERN_DEBUG pr_fmt(\"%s: tvaudio:\" fmt),\t\t\\\n\t\t\t__func__, ##arg);\t\t\t\t\\\n} while (0)\n \n\nstatic const char * const aud_ctl_names[64] = {\n\t[EN_BTSC_FORCE_MONO] = \"BTSC_FORCE_MONO\",\n\t[EN_BTSC_FORCE_STEREO] = \"BTSC_FORCE_STEREO\",\n\t[EN_BTSC_FORCE_SAP] = \"BTSC_FORCE_SAP\",\n\t[EN_BTSC_AUTO_STEREO] = \"BTSC_AUTO_STEREO\",\n\t[EN_BTSC_AUTO_SAP] = \"BTSC_AUTO_SAP\",\n\t[EN_A2_FORCE_MONO1] = \"A2_FORCE_MONO1\",\n\t[EN_A2_FORCE_MONO2] = \"A2_FORCE_MONO2\",\n\t[EN_A2_FORCE_STEREO] = \"A2_FORCE_STEREO\",\n\t[EN_A2_AUTO_MONO2] = \"A2_AUTO_MONO2\",\n\t[EN_A2_AUTO_STEREO] = \"A2_AUTO_STEREO\",\n\t[EN_EIAJ_FORCE_MONO1] = \"EIAJ_FORCE_MONO1\",\n\t[EN_EIAJ_FORCE_MONO2] = \"EIAJ_FORCE_MONO2\",\n\t[EN_EIAJ_FORCE_STEREO] = \"EIAJ_FORCE_STEREO\",\n\t[EN_EIAJ_AUTO_MONO2] = \"EIAJ_AUTO_MONO2\",\n\t[EN_EIAJ_AUTO_STEREO] = \"EIAJ_AUTO_STEREO\",\n\t[EN_NICAM_FORCE_MONO1] = \"NICAM_FORCE_MONO1\",\n\t[EN_NICAM_FORCE_MONO2] = \"NICAM_FORCE_MONO2\",\n\t[EN_NICAM_FORCE_STEREO] = \"NICAM_FORCE_STEREO\",\n\t[EN_NICAM_AUTO_MONO2] = \"NICAM_AUTO_MONO2\",\n\t[EN_NICAM_AUTO_STEREO] = \"NICAM_AUTO_STEREO\",\n\t[EN_FMRADIO_FORCE_MONO] = \"FMRADIO_FORCE_MONO\",\n\t[EN_FMRADIO_FORCE_STEREO] = \"FMRADIO_FORCE_STEREO\",\n\t[EN_FMRADIO_AUTO_STEREO] = \"FMRADIO_AUTO_STEREO\",\n};\n\nstruct rlist {\n\tu32 reg;\n\tu32 val;\n};\n\nstatic void set_audio_registers(struct cx88_core *core, const struct rlist *l)\n{\n\tint i;\n\n\tfor (i = 0; l[i].reg; i++) {\n\t\tswitch (l[i].reg) {\n\t\tcase AUD_PDF_DDS_CNST_BYTE2:\n\t\tcase AUD_PDF_DDS_CNST_BYTE1:\n\t\tcase AUD_PDF_DDS_CNST_BYTE0:\n\t\tcase AUD_QAM_MODE:\n\t\tcase AUD_PHACC_FREQ_8MSB:\n\t\tcase AUD_PHACC_FREQ_8LSB:\n\t\t\tcx_writeb(l[i].reg, l[i].val);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tcx_write(l[i].reg, l[i].val);\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic void set_audio_start(struct cx88_core *core, u32 mode)\n{\n\t \n\tcx_write(AUD_VOL_CTL, (1 << 6));\n\n\t \n\tcx_write(AUD_INIT, mode);\n\tcx_write(AUD_INIT_LD, 0x0001);\n\tcx_write(AUD_SOFT_RESET, 0x0001);\n}\n\nstatic void set_audio_finish(struct cx88_core *core, u32 ctl)\n{\n\tu32 volume;\n\n\t \n\tcx88_stop_audio_dma(core);\n\tcx_write(AUD_RATE_THRES_DMD, 0x000000C0);\n\tcx88_start_audio_dma(core);\n\n\tif (core->board.mpeg & CX88_MPEG_BLACKBIRD) {\n\t\tcx_write(AUD_I2SINPUTCNTL, 4);\n\t\tcx_write(AUD_BAUDRATE, 1);\n\t\t \n\t\tcx_set(AUD_CTL, EN_I2SOUT_ENABLE);\n\t\tcx_write(AUD_I2SOUTPUTCNTL, 1);\n\t\tcx_write(AUD_I2SCNTL, 0);\n\t\t \n\t}\n\tif ((always_analog) || (!(core->board.mpeg & CX88_MPEG_BLACKBIRD))) {\n\t\tctl |= EN_DAC_ENABLE;\n\t\tcx_write(AUD_CTL, ctl);\n\t}\n\n\t \n\tcx_write(AUD_SOFT_RESET, 0x0000);\n\n\t \n\tvolume = cx_sread(SHADOW_AUD_VOL_CTL);\n\tcx_swrite(SHADOW_AUD_VOL_CTL, AUD_VOL_CTL, volume);\n\n\tcore->last_change = jiffies;\n}\n\n \n\nstatic void set_audio_standard_BTSC(struct cx88_core *core, unsigned int sap,\n\t\t\t\t    u32 mode)\n{\n\tstatic const struct rlist btsc[] = {\n\t\t{AUD_AFE_12DB_EN, 0x00000001},\n\t\t{AUD_OUT1_SEL, 0x00000013},\n\t\t{AUD_OUT1_SHIFT, 0x00000000},\n\t\t{AUD_POLY0_DDS_CONSTANT, 0x0012010c},\n\t\t{AUD_DMD_RA_DDS, 0x00c3e7aa},\n\t\t{AUD_DBX_IN_GAIN, 0x00004734},\n\t\t{AUD_DBX_WBE_GAIN, 0x00004640},\n\t\t{AUD_DBX_SE_GAIN, 0x00008d31},\n\t\t{AUD_DCOC_0_SRC, 0x0000001a},\n\t\t{AUD_IIR1_4_SEL, 0x00000021},\n\t\t{AUD_DCOC_PASS_IN, 0x00000003},\n\t\t{AUD_DCOC_0_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_0_SHIFT_IN1, 0x00000008},\n\t\t{AUD_DCOC_1_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_1_SHIFT_IN1, 0x00000008},\n\t\t{AUD_DN0_FREQ, 0x0000283b},\n\t\t{AUD_DN2_SRC_SEL, 0x00000008},\n\t\t{AUD_DN2_FREQ, 0x00003000},\n\t\t{AUD_DN2_AFC, 0x00000002},\n\t\t{AUD_DN2_SHFT, 0x00000000},\n\t\t{AUD_IIR2_2_SEL, 0x00000020},\n\t\t{AUD_IIR2_2_SHIFT, 0x00000000},\n\t\t{AUD_IIR2_3_SEL, 0x0000001f},\n\t\t{AUD_IIR2_3_SHIFT, 0x00000000},\n\t\t{AUD_CRDC1_SRC_SEL, 0x000003ce},\n\t\t{AUD_CRDC1_SHIFT, 0x00000000},\n\t\t{AUD_CORDIC_SHIFT_1, 0x00000007},\n\t\t{AUD_DCOC_1_SRC, 0x0000001b},\n\t\t{AUD_DCOC1_SHIFT, 0x00000000},\n\t\t{AUD_RDSI_SEL, 0x00000008},\n\t\t{AUD_RDSQ_SEL, 0x00000008},\n\t\t{AUD_RDSI_SHIFT, 0x00000000},\n\t\t{AUD_RDSQ_SHIFT, 0x00000000},\n\t\t{AUD_POLYPH80SCALEFAC, 0x00000003},\n\t\t{   },\n\t};\n\tstatic const struct rlist btsc_sap[] = {\n\t\t{AUD_AFE_12DB_EN, 0x00000001},\n\t\t{AUD_DBX_IN_GAIN, 0x00007200},\n\t\t{AUD_DBX_WBE_GAIN, 0x00006200},\n\t\t{AUD_DBX_SE_GAIN, 0x00006200},\n\t\t{AUD_IIR1_1_SEL, 0x00000000},\n\t\t{AUD_IIR1_3_SEL, 0x00000001},\n\t\t{AUD_DN1_SRC_SEL, 0x00000007},\n\t\t{AUD_IIR1_4_SHIFT, 0x00000006},\n\t\t{AUD_IIR2_1_SHIFT, 0x00000000},\n\t\t{AUD_IIR2_2_SHIFT, 0x00000000},\n\t\t{AUD_IIR3_0_SHIFT, 0x00000000},\n\t\t{AUD_IIR3_1_SHIFT, 0x00000000},\n\t\t{AUD_IIR3_0_SEL, 0x0000000d},\n\t\t{AUD_IIR3_1_SEL, 0x0000000e},\n\t\t{AUD_DEEMPH1_SRC_SEL, 0x00000014},\n\t\t{AUD_DEEMPH1_SHIFT, 0x00000000},\n\t\t{AUD_DEEMPH1_G0, 0x00004000},\n\t\t{AUD_DEEMPH1_A0, 0x00000000},\n\t\t{AUD_DEEMPH1_B0, 0x00000000},\n\t\t{AUD_DEEMPH1_A1, 0x00000000},\n\t\t{AUD_DEEMPH1_B1, 0x00000000},\n\t\t{AUD_OUT0_SEL, 0x0000003f},\n\t\t{AUD_OUT1_SEL, 0x0000003f},\n\t\t{AUD_DN1_AFC, 0x00000002},\n\t\t{AUD_DCOC_0_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_0_SHIFT_IN1, 0x00000008},\n\t\t{AUD_DCOC_1_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_1_SHIFT_IN1, 0x00000008},\n\t\t{AUD_IIR1_0_SEL, 0x0000001d},\n\t\t{AUD_IIR1_2_SEL, 0x0000001e},\n\t\t{AUD_IIR2_1_SEL, 0x00000002},\n\t\t{AUD_IIR2_2_SEL, 0x00000004},\n\t\t{AUD_IIR3_2_SEL, 0x0000000f},\n\t\t{AUD_DCOC2_SHIFT, 0x00000001},\n\t\t{AUD_IIR3_2_SHIFT, 0x00000001},\n\t\t{AUD_DEEMPH0_SRC_SEL, 0x00000014},\n\t\t{AUD_CORDIC_SHIFT_1, 0x00000006},\n\t\t{AUD_POLY0_DDS_CONSTANT, 0x000e4db2},\n\t\t{AUD_DMD_RA_DDS, 0x00f696e6},\n\t\t{AUD_IIR2_3_SEL, 0x00000025},\n\t\t{AUD_IIR1_4_SEL, 0x00000021},\n\t\t{AUD_DN1_FREQ, 0x0000c965},\n\t\t{AUD_DCOC_PASS_IN, 0x00000003},\n\t\t{AUD_DCOC_0_SRC, 0x0000001a},\n\t\t{AUD_DCOC_1_SRC, 0x0000001b},\n\t\t{AUD_DCOC1_SHIFT, 0x00000000},\n\t\t{AUD_RDSI_SEL, 0x00000009},\n\t\t{AUD_RDSQ_SEL, 0x00000009},\n\t\t{AUD_RDSI_SHIFT, 0x00000000},\n\t\t{AUD_RDSQ_SHIFT, 0x00000000},\n\t\t{AUD_POLYPH80SCALEFAC, 0x00000003},\n\t\t{   },\n\t};\n\n\tmode |= EN_FMRADIO_EN_RDS;\n\n\tif (sap) {\n\t\tdprintk(\"%s SAP (status: unknown)\\n\", __func__);\n\t\tset_audio_start(core, SEL_SAP);\n\t\tset_audio_registers(core, btsc_sap);\n\t\tset_audio_finish(core, mode);\n\t} else {\n\t\tdprintk(\"%s (status: known-good)\\n\", __func__);\n\t\tset_audio_start(core, SEL_BTSC);\n\t\tset_audio_registers(core, btsc);\n\t\tset_audio_finish(core, mode);\n\t}\n}\n\nstatic void set_audio_standard_NICAM(struct cx88_core *core, u32 mode)\n{\n\tstatic const struct rlist nicam_l[] = {\n\t\t{AUD_AFE_12DB_EN, 0x00000001},\n\t\t{AUD_RATE_ADJ1, 0x00000060},\n\t\t{AUD_RATE_ADJ2, 0x000000F9},\n\t\t{AUD_RATE_ADJ3, 0x000001CC},\n\t\t{AUD_RATE_ADJ4, 0x000002B3},\n\t\t{AUD_RATE_ADJ5, 0x00000726},\n\t\t{AUD_DEEMPHDENOM1_R, 0x0000F3D0},\n\t\t{AUD_DEEMPHDENOM2_R, 0x00000000},\n\t\t{AUD_ERRLOGPERIOD_R, 0x00000064},\n\t\t{AUD_ERRINTRPTTHSHLD1_R, 0x00000FFF},\n\t\t{AUD_ERRINTRPTTHSHLD2_R, 0x0000001F},\n\t\t{AUD_ERRINTRPTTHSHLD3_R, 0x0000000F},\n\t\t{AUD_POLYPH80SCALEFAC, 0x00000003},\n\t\t{AUD_DMD_RA_DDS, 0x00C00000},\n\t\t{AUD_PLL_INT, 0x0000001E},\n\t\t{AUD_PLL_DDS, 0x00000000},\n\t\t{AUD_PLL_FRAC, 0x0000E542},\n\t\t{AUD_START_TIMER, 0x00000000},\n\t\t{AUD_DEEMPHNUMER1_R, 0x000353DE},\n\t\t{AUD_DEEMPHNUMER2_R, 0x000001B1},\n\t\t{AUD_PDF_DDS_CNST_BYTE2, 0x06},\n\t\t{AUD_PDF_DDS_CNST_BYTE1, 0x82},\n\t\t{AUD_PDF_DDS_CNST_BYTE0, 0x12},\n\t\t{AUD_QAM_MODE, 0x05},\n\t\t{AUD_PHACC_FREQ_8MSB, 0x34},\n\t\t{AUD_PHACC_FREQ_8LSB, 0x4C},\n\t\t{AUD_DEEMPHGAIN_R, 0x00006680},\n\t\t{AUD_RATE_THRES_DMD, 0x000000C0},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist nicam_bgdki_common[] = {\n\t\t{AUD_AFE_12DB_EN, 0x00000001},\n\t\t{AUD_RATE_ADJ1, 0x00000010},\n\t\t{AUD_RATE_ADJ2, 0x00000040},\n\t\t{AUD_RATE_ADJ3, 0x00000100},\n\t\t{AUD_RATE_ADJ4, 0x00000400},\n\t\t{AUD_RATE_ADJ5, 0x00001000},\n\t\t{AUD_ERRLOGPERIOD_R, 0x00000fff},\n\t\t{AUD_ERRINTRPTTHSHLD1_R, 0x000003ff},\n\t\t{AUD_ERRINTRPTTHSHLD2_R, 0x000000ff},\n\t\t{AUD_ERRINTRPTTHSHLD3_R, 0x0000003f},\n\t\t{AUD_POLYPH80SCALEFAC, 0x00000003},\n\t\t{AUD_DEEMPHGAIN_R, 0x000023c2},\n\t\t{AUD_DEEMPHNUMER1_R, 0x0002a7bc},\n\t\t{AUD_DEEMPHNUMER2_R, 0x0003023e},\n\t\t{AUD_DEEMPHDENOM1_R, 0x0000f3d0},\n\t\t{AUD_DEEMPHDENOM2_R, 0x00000000},\n\t\t{AUD_PDF_DDS_CNST_BYTE2, 0x06},\n\t\t{AUD_PDF_DDS_CNST_BYTE1, 0x82},\n\t\t{AUD_QAM_MODE, 0x05},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist nicam_i[] = {\n\t\t{AUD_PDF_DDS_CNST_BYTE0, 0x12},\n\t\t{AUD_PHACC_FREQ_8MSB, 0x3a},\n\t\t{AUD_PHACC_FREQ_8LSB, 0x93},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist nicam_default[] = {\n\t\t{AUD_PDF_DDS_CNST_BYTE0, 0x16},\n\t\t{AUD_PHACC_FREQ_8MSB, 0x34},\n\t\t{AUD_PHACC_FREQ_8LSB, 0x4c},\n\t\t{   },\n\t};\n\n\tset_audio_start(core, SEL_NICAM);\n\tswitch (core->tvaudio) {\n\tcase WW_L:\n\t\tdprintk(\"%s SECAM-L NICAM (status: devel)\\n\", __func__);\n\t\tset_audio_registers(core, nicam_l);\n\t\tbreak;\n\tcase WW_I:\n\t\tdprintk(\"%s PAL-I NICAM (status: known-good)\\n\", __func__);\n\t\tset_audio_registers(core, nicam_bgdki_common);\n\t\tset_audio_registers(core, nicam_i);\n\t\tbreak;\n\tcase WW_NONE:\n\tcase WW_BTSC:\n\tcase WW_BG:\n\tcase WW_DK:\n\tcase WW_EIAJ:\n\tcase WW_I2SPT:\n\tcase WW_FM:\n\tcase WW_I2SADC:\n\tcase WW_M:\n\t\tdprintk(\"%s PAL-BGDK NICAM (status: known-good)\\n\", __func__);\n\t\tset_audio_registers(core, nicam_bgdki_common);\n\t\tset_audio_registers(core, nicam_default);\n\t\tbreak;\n\t}\n\n\tmode |= EN_DMTRX_LR | EN_DMTRX_BYPASS;\n\tset_audio_finish(core, mode);\n}\n\nstatic void set_audio_standard_A2(struct cx88_core *core, u32 mode)\n{\n\tstatic const struct rlist a2_bgdk_common[] = {\n\t\t{AUD_ERRLOGPERIOD_R, 0x00000064},\n\t\t{AUD_ERRINTRPTTHSHLD1_R, 0x00000fff},\n\t\t{AUD_ERRINTRPTTHSHLD2_R, 0x0000001f},\n\t\t{AUD_ERRINTRPTTHSHLD3_R, 0x0000000f},\n\t\t{AUD_PDF_DDS_CNST_BYTE2, 0x06},\n\t\t{AUD_PDF_DDS_CNST_BYTE1, 0x82},\n\t\t{AUD_PDF_DDS_CNST_BYTE0, 0x12},\n\t\t{AUD_QAM_MODE, 0x05},\n\t\t{AUD_PHACC_FREQ_8MSB, 0x34},\n\t\t{AUD_PHACC_FREQ_8LSB, 0x4c},\n\t\t{AUD_RATE_ADJ1, 0x00000100},\n\t\t{AUD_RATE_ADJ2, 0x00000200},\n\t\t{AUD_RATE_ADJ3, 0x00000300},\n\t\t{AUD_RATE_ADJ4, 0x00000400},\n\t\t{AUD_RATE_ADJ5, 0x00000500},\n\t\t{AUD_THR_FR, 0x00000000},\n\t\t{AAGC_HYST, 0x0000001a},\n\t\t{AUD_PILOT_BQD_1_K0, 0x0000755b},\n\t\t{AUD_PILOT_BQD_1_K1, 0x00551340},\n\t\t{AUD_PILOT_BQD_1_K2, 0x006d30be},\n\t\t{AUD_PILOT_BQD_1_K3, 0xffd394af},\n\t\t{AUD_PILOT_BQD_1_K4, 0x00400000},\n\t\t{AUD_PILOT_BQD_2_K0, 0x00040000},\n\t\t{AUD_PILOT_BQD_2_K1, 0x002a4841},\n\t\t{AUD_PILOT_BQD_2_K2, 0x00400000},\n\t\t{AUD_PILOT_BQD_2_K3, 0x00000000},\n\t\t{AUD_PILOT_BQD_2_K4, 0x00000000},\n\t\t{AUD_MODE_CHG_TIMER, 0x00000040},\n\t\t{AUD_AFE_12DB_EN, 0x00000001},\n\t\t{AUD_CORDIC_SHIFT_0, 0x00000007},\n\t\t{AUD_CORDIC_SHIFT_1, 0x00000007},\n\t\t{AUD_DEEMPH0_G0, 0x00000380},\n\t\t{AUD_DEEMPH1_G0, 0x00000380},\n\t\t{AUD_DCOC_0_SRC, 0x0000001a},\n\t\t{AUD_DCOC0_SHIFT, 0x00000000},\n\t\t{AUD_DCOC_0_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_0_SHIFT_IN1, 0x00000008},\n\t\t{AUD_DCOC_PASS_IN, 0x00000003},\n\t\t{AUD_IIR3_0_SEL, 0x00000021},\n\t\t{AUD_DN2_AFC, 0x00000002},\n\t\t{AUD_DCOC_1_SRC, 0x0000001b},\n\t\t{AUD_DCOC1_SHIFT, 0x00000000},\n\t\t{AUD_DCOC_1_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_1_SHIFT_IN1, 0x00000008},\n\t\t{AUD_IIR3_1_SEL, 0x00000023},\n\t\t{AUD_RDSI_SEL, 0x00000017},\n\t\t{AUD_RDSI_SHIFT, 0x00000000},\n\t\t{AUD_RDSQ_SEL, 0x00000017},\n\t\t{AUD_RDSQ_SHIFT, 0x00000000},\n\t\t{AUD_PLL_INT, 0x0000001e},\n\t\t{AUD_PLL_DDS, 0x00000000},\n\t\t{AUD_PLL_FRAC, 0x0000e542},\n\t\t{AUD_POLYPH80SCALEFAC, 0x00000001},\n\t\t{AUD_START_TIMER, 0x00000000},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist a2_bg[] = {\n\t\t{AUD_DMD_RA_DDS, 0x002a4f2f},\n\t\t{AUD_C1_UP_THR, 0x00007000},\n\t\t{AUD_C1_LO_THR, 0x00005400},\n\t\t{AUD_C2_UP_THR, 0x00005400},\n\t\t{AUD_C2_LO_THR, 0x00003000},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist a2_dk[] = {\n\t\t{AUD_DMD_RA_DDS, 0x002a4f2f},\n\t\t{AUD_C1_UP_THR, 0x00007000},\n\t\t{AUD_C1_LO_THR, 0x00005400},\n\t\t{AUD_C2_UP_THR, 0x00005400},\n\t\t{AUD_C2_LO_THR, 0x00003000},\n\t\t{AUD_DN0_FREQ, 0x00003a1c},\n\t\t{AUD_DN2_FREQ, 0x0000d2e0},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist a1_i[] = {\n\t\t{AUD_ERRLOGPERIOD_R, 0x00000064},\n\t\t{AUD_ERRINTRPTTHSHLD1_R, 0x00000fff},\n\t\t{AUD_ERRINTRPTTHSHLD2_R, 0x0000001f},\n\t\t{AUD_ERRINTRPTTHSHLD3_R, 0x0000000f},\n\t\t{AUD_PDF_DDS_CNST_BYTE2, 0x06},\n\t\t{AUD_PDF_DDS_CNST_BYTE1, 0x82},\n\t\t{AUD_PDF_DDS_CNST_BYTE0, 0x12},\n\t\t{AUD_QAM_MODE, 0x05},\n\t\t{AUD_PHACC_FREQ_8MSB, 0x3a},\n\t\t{AUD_PHACC_FREQ_8LSB, 0x93},\n\t\t{AUD_DMD_RA_DDS, 0x002a4f2f},\n\t\t{AUD_PLL_INT, 0x0000001e},\n\t\t{AUD_PLL_DDS, 0x00000004},\n\t\t{AUD_PLL_FRAC, 0x0000e542},\n\t\t{AUD_RATE_ADJ1, 0x00000100},\n\t\t{AUD_RATE_ADJ2, 0x00000200},\n\t\t{AUD_RATE_ADJ3, 0x00000300},\n\t\t{AUD_RATE_ADJ4, 0x00000400},\n\t\t{AUD_RATE_ADJ5, 0x00000500},\n\t\t{AUD_THR_FR, 0x00000000},\n\t\t{AUD_PILOT_BQD_1_K0, 0x0000755b},\n\t\t{AUD_PILOT_BQD_1_K1, 0x00551340},\n\t\t{AUD_PILOT_BQD_1_K2, 0x006d30be},\n\t\t{AUD_PILOT_BQD_1_K3, 0xffd394af},\n\t\t{AUD_PILOT_BQD_1_K4, 0x00400000},\n\t\t{AUD_PILOT_BQD_2_K0, 0x00040000},\n\t\t{AUD_PILOT_BQD_2_K1, 0x002a4841},\n\t\t{AUD_PILOT_BQD_2_K2, 0x00400000},\n\t\t{AUD_PILOT_BQD_2_K3, 0x00000000},\n\t\t{AUD_PILOT_BQD_2_K4, 0x00000000},\n\t\t{AUD_MODE_CHG_TIMER, 0x00000060},\n\t\t{AUD_AFE_12DB_EN, 0x00000001},\n\t\t{AAGC_HYST, 0x0000000a},\n\t\t{AUD_CORDIC_SHIFT_0, 0x00000007},\n\t\t{AUD_CORDIC_SHIFT_1, 0x00000007},\n\t\t{AUD_C1_UP_THR, 0x00007000},\n\t\t{AUD_C1_LO_THR, 0x00005400},\n\t\t{AUD_C2_UP_THR, 0x00005400},\n\t\t{AUD_C2_LO_THR, 0x00003000},\n\t\t{AUD_DCOC_0_SRC, 0x0000001a},\n\t\t{AUD_DCOC0_SHIFT, 0x00000000},\n\t\t{AUD_DCOC_0_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_0_SHIFT_IN1, 0x00000008},\n\t\t{AUD_DCOC_PASS_IN, 0x00000003},\n\t\t{AUD_IIR3_0_SEL, 0x00000021},\n\t\t{AUD_DN2_AFC, 0x00000002},\n\t\t{AUD_DCOC_1_SRC, 0x0000001b},\n\t\t{AUD_DCOC1_SHIFT, 0x00000000},\n\t\t{AUD_DCOC_1_SHIFT_IN0, 0x0000000a},\n\t\t{AUD_DCOC_1_SHIFT_IN1, 0x00000008},\n\t\t{AUD_IIR3_1_SEL, 0x00000023},\n\t\t{AUD_DN0_FREQ, 0x000035a3},\n\t\t{AUD_DN2_FREQ, 0x000029c7},\n\t\t{AUD_CRDC0_SRC_SEL, 0x00000511},\n\t\t{AUD_IIR1_0_SEL, 0x00000001},\n\t\t{AUD_IIR1_1_SEL, 0x00000000},\n\t\t{AUD_IIR3_2_SEL, 0x00000003},\n\t\t{AUD_IIR3_2_SHIFT, 0x00000000},\n\t\t{AUD_IIR3_0_SEL, 0x00000002},\n\t\t{AUD_IIR2_0_SEL, 0x00000021},\n\t\t{AUD_IIR2_0_SHIFT, 0x00000002},\n\t\t{AUD_DEEMPH0_SRC_SEL, 0x0000000b},\n\t\t{AUD_DEEMPH1_SRC_SEL, 0x0000000b},\n\t\t{AUD_POLYPH80SCALEFAC, 0x00000001},\n\t\t{AUD_START_TIMER, 0x00000000},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist am_l[] = {\n\t\t{AUD_ERRLOGPERIOD_R, 0x00000064},\n\t\t{AUD_ERRINTRPTTHSHLD1_R, 0x00000FFF},\n\t\t{AUD_ERRINTRPTTHSHLD2_R, 0x0000001F},\n\t\t{AUD_ERRINTRPTTHSHLD3_R, 0x0000000F},\n\t\t{AUD_PDF_DDS_CNST_BYTE2, 0x48},\n\t\t{AUD_PDF_DDS_CNST_BYTE1, 0x3D},\n\t\t{AUD_QAM_MODE, 0x00},\n\t\t{AUD_PDF_DDS_CNST_BYTE0, 0xf5},\n\t\t{AUD_PHACC_FREQ_8MSB, 0x3a},\n\t\t{AUD_PHACC_FREQ_8LSB, 0x4a},\n\t\t{AUD_DEEMPHGAIN_R, 0x00006680},\n\t\t{AUD_DEEMPHNUMER1_R, 0x000353DE},\n\t\t{AUD_DEEMPHNUMER2_R, 0x000001B1},\n\t\t{AUD_DEEMPHDENOM1_R, 0x0000F3D0},\n\t\t{AUD_DEEMPHDENOM2_R, 0x00000000},\n\t\t{AUD_FM_MODE_ENABLE, 0x00000007},\n\t\t{AUD_POLYPH80SCALEFAC, 0x00000003},\n\t\t{AUD_AFE_12DB_EN, 0x00000001},\n\t\t{AAGC_GAIN, 0x00000000},\n\t\t{AAGC_HYST, 0x00000018},\n\t\t{AAGC_DEF, 0x00000020},\n\t\t{AUD_DN0_FREQ, 0x00000000},\n\t\t{AUD_POLY0_DDS_CONSTANT, 0x000E4DB2},\n\t\t{AUD_DCOC_0_SRC, 0x00000021},\n\t\t{AUD_IIR1_0_SEL, 0x00000000},\n\t\t{AUD_IIR1_0_SHIFT, 0x00000007},\n\t\t{AUD_IIR1_1_SEL, 0x00000002},\n\t\t{AUD_IIR1_1_SHIFT, 0x00000000},\n\t\t{AUD_DCOC_1_SRC, 0x00000003},\n\t\t{AUD_DCOC1_SHIFT, 0x00000000},\n\t\t{AUD_DCOC_PASS_IN, 0x00000000},\n\t\t{AUD_IIR1_2_SEL, 0x00000023},\n\t\t{AUD_IIR1_2_SHIFT, 0x00000000},\n\t\t{AUD_IIR1_3_SEL, 0x00000004},\n\t\t{AUD_IIR1_3_SHIFT, 0x00000007},\n\t\t{AUD_IIR1_4_SEL, 0x00000005},\n\t\t{AUD_IIR1_4_SHIFT, 0x00000007},\n\t\t{AUD_IIR3_0_SEL, 0x00000007},\n\t\t{AUD_IIR3_0_SHIFT, 0x00000000},\n\t\t{AUD_DEEMPH0_SRC_SEL, 0x00000011},\n\t\t{AUD_DEEMPH0_SHIFT, 0x00000000},\n\t\t{AUD_DEEMPH0_G0, 0x00007000},\n\t\t{AUD_DEEMPH0_A0, 0x00000000},\n\t\t{AUD_DEEMPH0_B0, 0x00000000},\n\t\t{AUD_DEEMPH0_A1, 0x00000000},\n\t\t{AUD_DEEMPH0_B1, 0x00000000},\n\t\t{AUD_DEEMPH1_SRC_SEL, 0x00000011},\n\t\t{AUD_DEEMPH1_SHIFT, 0x00000000},\n\t\t{AUD_DEEMPH1_G0, 0x00007000},\n\t\t{AUD_DEEMPH1_A0, 0x00000000},\n\t\t{AUD_DEEMPH1_B0, 0x00000000},\n\t\t{AUD_DEEMPH1_A1, 0x00000000},\n\t\t{AUD_DEEMPH1_B1, 0x00000000},\n\t\t{AUD_OUT0_SEL, 0x0000003F},\n\t\t{AUD_OUT1_SEL, 0x0000003F},\n\t\t{AUD_DMD_RA_DDS, 0x00F5C285},\n\t\t{AUD_PLL_INT, 0x0000001E},\n\t\t{AUD_PLL_DDS, 0x00000000},\n\t\t{AUD_PLL_FRAC, 0x0000E542},\n\t\t{AUD_RATE_ADJ1, 0x00000100},\n\t\t{AUD_RATE_ADJ2, 0x00000200},\n\t\t{AUD_RATE_ADJ3, 0x00000300},\n\t\t{AUD_RATE_ADJ4, 0x00000400},\n\t\t{AUD_RATE_ADJ5, 0x00000500},\n\t\t{AUD_RATE_THRES_DMD, 0x000000C0},\n\t\t{   },\n\t};\n\n\tstatic const struct rlist a2_deemph50[] = {\n\t\t{AUD_DEEMPH0_G0, 0x00000380},\n\t\t{AUD_DEEMPH1_G0, 0x00000380},\n\t\t{AUD_DEEMPHGAIN_R, 0x000011e1},\n\t\t{AUD_DEEMPHNUMER1_R, 0x0002a7bc},\n\t\t{AUD_DEEMPHNUMER2_R, 0x0003023c},\n\t\t{   },\n\t};\n\n\tset_audio_start(core, SEL_A2);\n\tswitch (core->tvaudio) {\n\tcase WW_BG:\n\t\tdprintk(\"%s PAL-BG A1/2 (status: known-good)\\n\", __func__);\n\t\tset_audio_registers(core, a2_bgdk_common);\n\t\tset_audio_registers(core, a2_bg);\n\t\tset_audio_registers(core, a2_deemph50);\n\t\tbreak;\n\tcase WW_DK:\n\t\tdprintk(\"%s PAL-DK A1/2 (status: known-good)\\n\", __func__);\n\t\tset_audio_registers(core, a2_bgdk_common);\n\t\tset_audio_registers(core, a2_dk);\n\t\tset_audio_registers(core, a2_deemph50);\n\t\tbreak;\n\tcase WW_I:\n\t\tdprintk(\"%s PAL-I A1 (status: known-good)\\n\", __func__);\n\t\tset_audio_registers(core, a1_i);\n\t\tset_audio_registers(core, a2_deemph50);\n\t\tbreak;\n\tcase WW_L:\n\t\tdprintk(\"%s AM-L (status: devel)\\n\", __func__);\n\t\tset_audio_registers(core, am_l);\n\t\tbreak;\n\tcase WW_NONE:\n\tcase WW_BTSC:\n\tcase WW_EIAJ:\n\tcase WW_I2SPT:\n\tcase WW_FM:\n\tcase WW_I2SADC:\n\tcase WW_M:\n\t\tdprintk(\"%s Warning: wrong value\\n\", __func__);\n\t\treturn;\n\t}\n\n\tmode |= EN_FMRADIO_EN_RDS | EN_DMTRX_SUMDIFF;\n\tset_audio_finish(core, mode);\n}\n\nstatic void set_audio_standard_EIAJ(struct cx88_core *core)\n{\n\tstatic const struct rlist eiaj[] = {\n\t\t \n\n\t\t{   },\n\t};\n\tdprintk(\"%s (status: unknown)\\n\", __func__);\n\n\tset_audio_start(core, SEL_EIAJ);\n\tset_audio_registers(core, eiaj);\n\tset_audio_finish(core, EN_EIAJ_AUTO_STEREO);\n}\n\nstatic void set_audio_standard_FM(struct cx88_core *core,\n\t\t\t\t  enum cx88_deemph_type deemph)\n{\n\tstatic const struct rlist fm_deemph_50[] = {\n\t\t{AUD_DEEMPH0_G0, 0x0C45},\n\t\t{AUD_DEEMPH0_A0, 0x6262},\n\t\t{AUD_DEEMPH0_B0, 0x1C29},\n\t\t{AUD_DEEMPH0_A1, 0x3FC66},\n\t\t{AUD_DEEMPH0_B1, 0x399A},\n\n\t\t{AUD_DEEMPH1_G0, 0x0D80},\n\t\t{AUD_DEEMPH1_A0, 0x6262},\n\t\t{AUD_DEEMPH1_B0, 0x1C29},\n\t\t{AUD_DEEMPH1_A1, 0x3FC66},\n\t\t{AUD_DEEMPH1_B1, 0x399A},\n\n\t\t{AUD_POLYPH80SCALEFAC, 0x0003},\n\t\t{   },\n\t};\n\tstatic const struct rlist fm_deemph_75[] = {\n\t\t{AUD_DEEMPH0_G0, 0x091B},\n\t\t{AUD_DEEMPH0_A0, 0x6B68},\n\t\t{AUD_DEEMPH0_B0, 0x11EC},\n\t\t{AUD_DEEMPH0_A1, 0x3FC66},\n\t\t{AUD_DEEMPH0_B1, 0x399A},\n\n\t\t{AUD_DEEMPH1_G0, 0x0AA0},\n\t\t{AUD_DEEMPH1_A0, 0x6B68},\n\t\t{AUD_DEEMPH1_B0, 0x11EC},\n\t\t{AUD_DEEMPH1_A1, 0x3FC66},\n\t\t{AUD_DEEMPH1_B1, 0x399A},\n\n\t\t{AUD_POLYPH80SCALEFAC, 0x0003},\n\t\t{   },\n\t};\n\n\t \n\tstatic const struct rlist fm_no_deemph[] = {\n\t\t{AUD_POLYPH80SCALEFAC, 0x0003},\n\t\t{   },\n\t};\n\n\tdprintk(\"%s (status: unknown)\\n\", __func__);\n\tset_audio_start(core, SEL_FMRADIO);\n\n\tswitch (deemph) {\n\tdefault:\n\tcase FM_NO_DEEMPH:\n\t\tset_audio_registers(core, fm_no_deemph);\n\t\tbreak;\n\n\tcase FM_DEEMPH_50:\n\t\tset_audio_registers(core, fm_deemph_50);\n\t\tbreak;\n\n\tcase FM_DEEMPH_75:\n\t\tset_audio_registers(core, fm_deemph_75);\n\t\tbreak;\n\t}\n\n\tset_audio_finish(core, EN_FMRADIO_AUTO_STEREO);\n}\n\n \n\nstatic int cx88_detect_nicam(struct cx88_core *core)\n{\n\tint i, j = 0;\n\n\tdprintk(\"start nicam autodetect.\\n\");\n\n\tfor (i = 0; i < 6; i++) {\n\t\t \n\t\tj += ((cx_read(AUD_NICAM_STATUS2) & 0x02) >> 1);\n\n\t\tif (j == 1) {\n\t\t\tdprintk(\"nicam is detected.\\n\");\n\t\t\treturn 1;\n\t\t}\n\n\t\t \n\t\tusleep_range(10000, 20000);\n\t}\n\n\tdprintk(\"nicam is not detected.\\n\");\n\treturn 0;\n}\n\nvoid cx88_set_tvaudio(struct cx88_core *core)\n{\n\tswitch (core->tvaudio) {\n\tcase WW_BTSC:\n\t\tset_audio_standard_BTSC(core, 0, EN_BTSC_AUTO_STEREO);\n\t\tbreak;\n\tcase WW_BG:\n\tcase WW_DK:\n\tcase WW_M:\n\tcase WW_I:\n\tcase WW_L:\n\t\t \n\t\tset_audio_standard_A2(core, EN_A2_FORCE_MONO1);\n\n\t\t \n\t\tset_audio_standard_NICAM(core, EN_NICAM_AUTO_STEREO);\n\t\tif (cx88_detect_nicam(core) == 0) {\n\t\t\t \n\t\t\tset_audio_standard_A2(core, EN_A2_FORCE_MONO1);\n\t\t\tcore->audiomode_current = V4L2_TUNER_MODE_MONO;\n\t\t\tcore->use_nicam = 0;\n\t\t} else {\n\t\t\tcore->use_nicam = 1;\n\t\t}\n\t\tbreak;\n\tcase WW_EIAJ:\n\t\tset_audio_standard_EIAJ(core);\n\t\tbreak;\n\tcase WW_FM:\n\t\tset_audio_standard_FM(core, radio_deemphasis);\n\t\tbreak;\n\tcase WW_I2SADC:\n\t\tset_audio_start(core, 0x01);\n\t\t \n\t\tcx_write(AUD_I2SINPUTCNTL, core->board.i2sinputcntl);\n\t\t \n\t\tcx_write(AUD_I2SCNTL, 0x1);\n\t\tset_audio_finish(core, EN_I2SIN_ENABLE);\n\t\tbreak;\n\tcase WW_NONE:\n\tcase WW_I2SPT:\n\t\tpr_info(\"unknown tv audio mode [%d]\\n\", core->tvaudio);\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL(cx88_set_tvaudio);\n\nvoid cx88_newstation(struct cx88_core *core)\n{\n\tcore->audiomode_manual = UNSET;\n\tcore->last_change = jiffies;\n}\nEXPORT_SYMBOL(cx88_newstation);\n\nvoid cx88_get_stereo(struct cx88_core *core, struct v4l2_tuner *t)\n{\n\tstatic const char * const m[] = { \"stereo\", \"dual mono\",\n\t\t\t\t\t  \"mono\",   \"sap\" };\n\tstatic const char * const p[] = { \"no pilot\", \"pilot c1\",\n\t\t\t\t\t  \"pilot c2\", \"?\" };\n\tu32 reg, mode, pilot;\n\n\treg = cx_read(AUD_STATUS);\n\tmode = reg & 0x03;\n\tpilot = (reg >> 2) & 0x03;\n\n\tif (core->astat != reg)\n\t\tdprintk(\"AUD_STATUS: 0x%x [%s/%s] ctl=%s\\n\",\n\t\t\treg, m[mode], p[pilot],\n\t\t\taud_ctl_names[cx_read(AUD_CTL) & 63]);\n\tcore->astat = reg;\n\n\tt->capability = V4L2_TUNER_CAP_STEREO | V4L2_TUNER_CAP_SAP |\n\t    V4L2_TUNER_CAP_LANG1 | V4L2_TUNER_CAP_LANG2;\n\tt->rxsubchans = UNSET;\n\tt->audmode = V4L2_TUNER_MODE_MONO;\n\n\tswitch (mode) {\n\tcase 0:\n\t\tt->audmode = V4L2_TUNER_MODE_STEREO;\n\t\tbreak;\n\tcase 1:\n\t\tt->audmode = V4L2_TUNER_MODE_LANG2;\n\t\tbreak;\n\tcase 2:\n\t\tt->audmode = V4L2_TUNER_MODE_MONO;\n\t\tbreak;\n\tcase 3:\n\t\tt->audmode = V4L2_TUNER_MODE_SAP;\n\t\tbreak;\n\t}\n\n\tswitch (core->tvaudio) {\n\tcase WW_BTSC:\n\tcase WW_BG:\n\tcase WW_DK:\n\tcase WW_M:\n\tcase WW_EIAJ:\n\t\tif (!core->use_nicam) {\n\t\t\tt->rxsubchans = cx88_dsp_detect_stereo_sap(core);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tcase WW_NONE:\n\tcase WW_I:\n\tcase WW_L:\n\tcase WW_I2SPT:\n\tcase WW_FM:\n\tcase WW_I2SADC:\n\t\t \n\t\tbreak;\n\t}\n\n\t \n\tif (t->rxsubchans == UNSET) {\n\t\tt->rxsubchans = V4L2_TUNER_SUB_MONO;\n\t\t \n\t\tif (t->audmode == V4L2_TUNER_MODE_STEREO)\n\t\t\tt->rxsubchans |= V4L2_TUNER_SUB_STEREO;\n\t}\n}\nEXPORT_SYMBOL(cx88_get_stereo);\n\n\nvoid cx88_set_stereo(struct cx88_core *core, u32 mode, int manual)\n{\n\tu32 ctl = UNSET;\n\tu32 mask = UNSET;\n\n\tif (manual) {\n\t\tcore->audiomode_manual = mode;\n\t} else {\n\t\tif (core->audiomode_manual != UNSET)\n\t\t\treturn;\n\t}\n\tcore->audiomode_current = mode;\n\n\tswitch (core->tvaudio) {\n\tcase WW_BTSC:\n\t\tswitch (mode) {\n\t\tcase V4L2_TUNER_MODE_MONO:\n\t\t\tset_audio_standard_BTSC(core, 0, EN_BTSC_FORCE_MONO);\n\t\t\tbreak;\n\t\tcase V4L2_TUNER_MODE_LANG1:\n\t\t\tset_audio_standard_BTSC(core, 0, EN_BTSC_AUTO_STEREO);\n\t\t\tbreak;\n\t\tcase V4L2_TUNER_MODE_LANG2:\n\t\t\tset_audio_standard_BTSC(core, 1, EN_BTSC_FORCE_SAP);\n\t\t\tbreak;\n\t\tcase V4L2_TUNER_MODE_STEREO:\n\t\tcase V4L2_TUNER_MODE_LANG1_LANG2:\n\t\t\tset_audio_standard_BTSC(core, 0, EN_BTSC_FORCE_STEREO);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tcase WW_BG:\n\tcase WW_DK:\n\tcase WW_M:\n\tcase WW_I:\n\tcase WW_L:\n\t\tif (core->use_nicam == 1) {\n\t\t\tswitch (mode) {\n\t\t\tcase V4L2_TUNER_MODE_MONO:\n\t\t\tcase V4L2_TUNER_MODE_LANG1:\n\t\t\t\tset_audio_standard_NICAM(core,\n\t\t\t\t\t\t\t EN_NICAM_FORCE_MONO1);\n\t\t\t\tbreak;\n\t\t\tcase V4L2_TUNER_MODE_LANG2:\n\t\t\t\tset_audio_standard_NICAM(core,\n\t\t\t\t\t\t\t EN_NICAM_FORCE_MONO2);\n\t\t\t\tbreak;\n\t\t\tcase V4L2_TUNER_MODE_STEREO:\n\t\t\tcase V4L2_TUNER_MODE_LANG1_LANG2:\n\t\t\t\tset_audio_standard_NICAM(core,\n\t\t\t\t\t\t\t EN_NICAM_FORCE_STEREO);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} else {\n\t\t\tif ((core->tvaudio == WW_I) ||\n\t\t\t    (core->tvaudio == WW_L)) {\n\t\t\t\t \n\t\t\t\tset_audio_standard_A2(core, EN_A2_FORCE_MONO1);\n\t\t\t} else {\n\t\t\t\t \n\t\t\t\tmask = 0x3f;\n\t\t\t\tswitch (mode) {\n\t\t\t\tcase V4L2_TUNER_MODE_MONO:\n\t\t\t\tcase V4L2_TUNER_MODE_LANG1:\n\t\t\t\t\tctl = EN_A2_FORCE_MONO1;\n\t\t\t\t\tbreak;\n\t\t\t\tcase V4L2_TUNER_MODE_LANG2:\n\t\t\t\t\tctl = EN_A2_FORCE_MONO2;\n\t\t\t\t\tbreak;\n\t\t\t\tcase V4L2_TUNER_MODE_STEREO:\n\t\t\t\tcase V4L2_TUNER_MODE_LANG1_LANG2:\n\t\t\t\t\tctl = EN_A2_FORCE_STEREO;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase WW_FM:\n\t\tswitch (mode) {\n\t\tcase V4L2_TUNER_MODE_MONO:\n\t\t\tctl = EN_FMRADIO_FORCE_MONO;\n\t\t\tmask = 0x3f;\n\t\t\tbreak;\n\t\tcase V4L2_TUNER_MODE_STEREO:\n\t\t\tctl = EN_FMRADIO_AUTO_STEREO;\n\t\t\tmask = 0x3f;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tcase WW_I2SADC:\n\tcase WW_NONE:\n\tcase WW_EIAJ:\n\tcase WW_I2SPT:\n\t\t \n\t\tbreak;\n\t}\n\n\tif (ctl != UNSET) {\n\t\tdprintk(\"cx88_set_stereo: mask 0x%x, ctl 0x%x [status=0x%x,ctl=0x%x,vol=0x%x]\\n\",\n\t\t\tmask, ctl, cx_read(AUD_STATUS),\n\t\t\tcx_read(AUD_CTL), cx_sread(SHADOW_AUD_VOL_CTL));\n\t\tcx_andor(AUD_CTL, mask, ctl);\n\t}\n}\nEXPORT_SYMBOL(cx88_set_stereo);\n\nint cx88_audio_thread(void *data)\n{\n\tstruct cx88_core *core = data;\n\tstruct v4l2_tuner t;\n\tu32 mode = 0;\n\n\tdprintk(\"cx88: tvaudio thread started\\n\");\n\tset_freezable();\n\tfor (;;) {\n\t\tmsleep_interruptible(1000);\n\t\tif (kthread_should_stop())\n\t\t\tbreak;\n\t\ttry_to_freeze();\n\n\t\tswitch (core->tvaudio) {\n\t\tcase WW_BG:\n\t\tcase WW_DK:\n\t\tcase WW_M:\n\t\tcase WW_I:\n\t\tcase WW_L:\n\t\t\tif (core->use_nicam)\n\t\t\t\tgoto hw_autodetect;\n\n\t\t\t \n\t\t\tmemset(&t, 0, sizeof(t));\n\t\t\tcx88_get_stereo(core, &t);\n\n\t\t\tif (core->audiomode_manual != UNSET)\n\t\t\t\t \n\t\t\t\tcontinue;\n\n\t\t\t \n\t\t\tif (t.rxsubchans & V4L2_TUNER_SUB_STEREO)\n\t\t\t\tmode = V4L2_TUNER_MODE_STEREO;\n\t\t\telse\n\t\t\t\tmode = V4L2_TUNER_MODE_MONO;\n\t\t\tif (mode == core->audiomode_current)\n\t\t\t\tcontinue;\n\t\t\t \n\t\t\tcx88_set_stereo(core, mode, 0);\n\t\t\tbreak;\n\t\tcase WW_NONE:\n\t\tcase WW_BTSC:\n\t\tcase WW_EIAJ:\n\t\tcase WW_I2SPT:\n\t\tcase WW_FM:\n\t\tcase WW_I2SADC:\nhw_autodetect:\n\t\t\t \n\t\t\tbreak;\n\t\t}\n\t}\n\n\tdprintk(\"cx88: tvaudio thread exiting\\n\");\n\treturn 0;\n}\nEXPORT_SYMBOL(cx88_audio_thread);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}