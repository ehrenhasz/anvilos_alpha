{
  "module_name": "cx88-dvb.c",
  "hash_id": "b8d95898f528c3b0b69d99731f2bcbb22264cc4fd9ca079a3820a9bb6e698016",
  "original_prompt": "Ingested from linux-6.6.14/drivers/media/pci/cx88/cx88-dvb.c",
  "human_readable_source": "\n \n\n#include \"cx88.h\"\n#include \"dvb-pll.h\"\n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/device.h>\n#include <linux/fs.h>\n#include <linux/kthread.h>\n#include <linux/file.h>\n#include <linux/suspend.h>\n\n#include <media/v4l2-common.h>\n\n#include \"mt352.h\"\n#include \"mt352_priv.h\"\n#include \"cx88-vp3054-i2c.h\"\n#include \"zl10353.h\"\n#include \"cx22702.h\"\n#include \"or51132.h\"\n#include \"lgdt330x.h\"\n#include \"s5h1409.h\"\n#include \"xc4000.h\"\n#include \"xc5000.h\"\n#include \"nxt200x.h\"\n#include \"cx24123.h\"\n#include \"isl6421.h\"\n#include \"tuner-simple.h\"\n#include \"tda9887.h\"\n#include \"s5h1411.h\"\n#include \"stv0299.h\"\n#include \"z0194a.h\"\n#include \"stv0288.h\"\n#include \"stb6000.h\"\n#include \"cx24116.h\"\n#include \"stv0900.h\"\n#include \"stb6100.h\"\n#include \"stb6100_proc.h\"\n#include \"mb86a16.h\"\n#include \"ts2020.h\"\n#include \"ds3000.h\"\n\nMODULE_DESCRIPTION(\"driver for cx2388x based DVB cards\");\nMODULE_AUTHOR(\"Chris Pascoe <c.pascoe@itee.uq.edu.au>\");\nMODULE_AUTHOR(\"Gerd Knorr <kraxel@bytesex.org> [SuSE Labs]\");\nMODULE_LICENSE(\"GPL\");\nMODULE_VERSION(CX88_VERSION);\n\nstatic unsigned int debug;\nmodule_param(debug, int, 0644);\nMODULE_PARM_DESC(debug, \"enable debug messages [dvb]\");\n\nstatic unsigned int dvb_buf_tscnt = 32;\nmodule_param(dvb_buf_tscnt, int, 0644);\nMODULE_PARM_DESC(dvb_buf_tscnt, \"DVB Buffer TS count [dvb]\");\n\nDVB_DEFINE_MOD_OPT_ADAPTER_NR(adapter_nr);\n\n#define dprintk(level, fmt, arg...) do {\t\t\t\t\\\n\tif (debug >= level)\t\t\t\t\t\t\\\n\t\tprintk(KERN_DEBUG pr_fmt(\"%s: dvb:\" fmt),\t\t\\\n\t\t\t__func__, ##arg);\t\t\t\t\\\n} while (0)\n\n \n\nstatic int queue_setup(struct vb2_queue *q,\n\t\t       unsigned int *num_buffers, unsigned int *num_planes,\n\t\t       unsigned int sizes[], struct device *alloc_devs[])\n{\n\tstruct cx8802_dev *dev = q->drv_priv;\n\n\t*num_planes = 1;\n\tdev->ts_packet_size  = 188 * 4;\n\tdev->ts_packet_count = dvb_buf_tscnt;\n\tsizes[0] = dev->ts_packet_size * dev->ts_packet_count;\n\t*num_buffers = dvb_buf_tscnt;\n\treturn 0;\n}\n\nstatic int buffer_prepare(struct vb2_buffer *vb)\n{\n\tstruct vb2_v4l2_buffer *vbuf = to_vb2_v4l2_buffer(vb);\n\tstruct cx8802_dev *dev = vb->vb2_queue->drv_priv;\n\tstruct cx88_buffer *buf = container_of(vbuf, struct cx88_buffer, vb);\n\n\treturn cx8802_buf_prepare(vb->vb2_queue, dev, buf);\n}\n\nstatic void buffer_finish(struct vb2_buffer *vb)\n{\n\tstruct vb2_v4l2_buffer *vbuf = to_vb2_v4l2_buffer(vb);\n\tstruct cx8802_dev *dev = vb->vb2_queue->drv_priv;\n\tstruct cx88_buffer *buf = container_of(vbuf, struct cx88_buffer, vb);\n\tstruct cx88_riscmem *risc = &buf->risc;\n\n\tif (risc->cpu)\n\t\tdma_free_coherent(&dev->pci->dev, risc->size, risc->cpu,\n\t\t\t\t  risc->dma);\n\tmemset(risc, 0, sizeof(*risc));\n}\n\nstatic void buffer_queue(struct vb2_buffer *vb)\n{\n\tstruct vb2_v4l2_buffer *vbuf = to_vb2_v4l2_buffer(vb);\n\tstruct cx8802_dev *dev = vb->vb2_queue->drv_priv;\n\tstruct cx88_buffer    *buf = container_of(vbuf, struct cx88_buffer, vb);\n\n\tcx8802_buf_queue(dev, buf);\n}\n\nstatic int start_streaming(struct vb2_queue *q, unsigned int count)\n{\n\tstruct cx8802_dev *dev = q->drv_priv;\n\tstruct cx88_dmaqueue *dmaq = &dev->mpegq;\n\tstruct cx88_buffer *buf;\n\n\tbuf = list_entry(dmaq->active.next, struct cx88_buffer, list);\n\tcx8802_start_dma(dev, dmaq, buf);\n\treturn 0;\n}\n\nstatic void stop_streaming(struct vb2_queue *q)\n{\n\tstruct cx8802_dev *dev = q->drv_priv;\n\tstruct cx88_dmaqueue *dmaq = &dev->mpegq;\n\tunsigned long flags;\n\n\tcx8802_cancel_buffers(dev);\n\n\tspin_lock_irqsave(&dev->slock, flags);\n\twhile (!list_empty(&dmaq->active)) {\n\t\tstruct cx88_buffer *buf = list_entry(dmaq->active.next,\n\t\t\tstruct cx88_buffer, list);\n\n\t\tlist_del(&buf->list);\n\t\tvb2_buffer_done(&buf->vb.vb2_buf, VB2_BUF_STATE_ERROR);\n\t}\n\tspin_unlock_irqrestore(&dev->slock, flags);\n}\n\nstatic const struct vb2_ops dvb_qops = {\n\t.queue_setup    = queue_setup,\n\t.buf_prepare  = buffer_prepare,\n\t.buf_finish = buffer_finish,\n\t.buf_queue    = buffer_queue,\n\t.wait_prepare = vb2_ops_wait_prepare,\n\t.wait_finish = vb2_ops_wait_finish,\n\t.start_streaming = start_streaming,\n\t.stop_streaming = stop_streaming,\n};\n\n \n\nstatic int cx88_dvb_bus_ctrl(struct dvb_frontend *fe, int acquire)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx8802_driver *drv = NULL;\n\tint ret = 0;\n\tint fe_id;\n\n\tfe_id = vb2_dvb_find_frontend(&dev->frontends, fe);\n\tif (!fe_id) {\n\t\tpr_err(\"%s() No frontend found\\n\", __func__);\n\t\treturn -EINVAL;\n\t}\n\n\tmutex_lock(&dev->core->lock);\n\tdrv = cx8802_get_driver(dev, CX88_MPEG_DVB);\n\tif (drv) {\n\t\tif (acquire) {\n\t\t\tdev->frontends.active_fe_id = fe_id;\n\t\t\tret = drv->request_acquire(drv);\n\t\t} else {\n\t\t\tret = drv->request_release(drv);\n\t\t\tdev->frontends.active_fe_id = 0;\n\t\t}\n\t}\n\tmutex_unlock(&dev->core->lock);\n\n\treturn ret;\n}\n\nstatic void cx88_dvb_gate_ctrl(struct cx88_core  *core, int open)\n{\n\tstruct vb2_dvb_frontends *f;\n\tstruct vb2_dvb_frontend *fe;\n\n\tif (!core->dvbdev)\n\t\treturn;\n\n\tf = &core->dvbdev->frontends;\n\n\tif (!f)\n\t\treturn;\n\n\tif (f->gate <= 1)  \n\t\tfe = vb2_dvb_get_frontend(f, 1);\n\telse\n\t\tfe = vb2_dvb_get_frontend(f, f->gate);\n\n\tif (fe && fe->dvb.frontend && fe->dvb.frontend->ops.i2c_gate_ctrl)\n\t\tfe->dvb.frontend->ops.i2c_gate_ctrl(fe->dvb.frontend, open);\n}\n\n \n\nstatic int dvico_fusionhdtv_demod_init(struct dvb_frontend *fe)\n{\n\tstatic const u8 clock_config[]  = { CLOCK_CTL,  0x38, 0x39 };\n\tstatic const u8 reset[]         = { RESET,      0x80 };\n\tstatic const u8 adc_ctl_1_cfg[] = { ADC_CTL_1,  0x40 };\n\tstatic const u8 agc_cfg[]       = { AGC_TARGET, 0x24, 0x20 };\n\tstatic const u8 gpp_ctl_cfg[]   = { GPP_CTL,    0x33 };\n\tstatic const u8 capt_range_cfg[] = { CAPT_RANGE, 0x32 };\n\n\tmt352_write(fe, clock_config,   sizeof(clock_config));\n\tudelay(200);\n\tmt352_write(fe, reset,          sizeof(reset));\n\tmt352_write(fe, adc_ctl_1_cfg,  sizeof(adc_ctl_1_cfg));\n\n\tmt352_write(fe, agc_cfg,        sizeof(agc_cfg));\n\tmt352_write(fe, gpp_ctl_cfg,    sizeof(gpp_ctl_cfg));\n\tmt352_write(fe, capt_range_cfg, sizeof(capt_range_cfg));\n\treturn 0;\n}\n\nstatic int dvico_dual_demod_init(struct dvb_frontend *fe)\n{\n\tstatic const u8 clock_config[]  = { CLOCK_CTL,  0x38, 0x38 };\n\tstatic const u8 reset[]         = { RESET,      0x80 };\n\tstatic const u8 adc_ctl_1_cfg[] = { ADC_CTL_1,  0x40 };\n\tstatic const u8 agc_cfg[]       = { AGC_TARGET, 0x28, 0x20 };\n\tstatic const u8 gpp_ctl_cfg[]   = { GPP_CTL,    0x33 };\n\tstatic const u8 capt_range_cfg[] = { CAPT_RANGE, 0x32 };\n\n\tmt352_write(fe, clock_config,   sizeof(clock_config));\n\tudelay(200);\n\tmt352_write(fe, reset,          sizeof(reset));\n\tmt352_write(fe, adc_ctl_1_cfg,  sizeof(adc_ctl_1_cfg));\n\n\tmt352_write(fe, agc_cfg,        sizeof(agc_cfg));\n\tmt352_write(fe, gpp_ctl_cfg,    sizeof(gpp_ctl_cfg));\n\tmt352_write(fe, capt_range_cfg, sizeof(capt_range_cfg));\n\n\treturn 0;\n}\n\nstatic int dntv_live_dvbt_demod_init(struct dvb_frontend *fe)\n{\n\tstatic const u8 clock_config[]  = { 0x89, 0x38, 0x39 };\n\tstatic const u8 reset[]         = { 0x50, 0x80 };\n\tstatic const u8 adc_ctl_1_cfg[] = { 0x8E, 0x40 };\n\tstatic const u8 agc_cfg[]       = { 0x67, 0x10, 0x23, 0x00, 0xFF, 0xFF,\n\t\t\t\t       0x00, 0xFF, 0x00, 0x40, 0x40 };\n\tstatic const u8 dntv_extra[]     = { 0xB5, 0x7A };\n\tstatic const u8 capt_range_cfg[] = { 0x75, 0x32 };\n\n\tmt352_write(fe, clock_config,   sizeof(clock_config));\n\tudelay(2000);\n\tmt352_write(fe, reset,          sizeof(reset));\n\tmt352_write(fe, adc_ctl_1_cfg,  sizeof(adc_ctl_1_cfg));\n\n\tmt352_write(fe, agc_cfg,        sizeof(agc_cfg));\n\tudelay(2000);\n\tmt352_write(fe, dntv_extra,     sizeof(dntv_extra));\n\tmt352_write(fe, capt_range_cfg, sizeof(capt_range_cfg));\n\n\treturn 0;\n}\n\nstatic const struct mt352_config dvico_fusionhdtv = {\n\t.demod_address = 0x0f,\n\t.demod_init    = dvico_fusionhdtv_demod_init,\n};\n\nstatic const struct mt352_config dntv_live_dvbt_config = {\n\t.demod_address = 0x0f,\n\t.demod_init    = dntv_live_dvbt_demod_init,\n};\n\nstatic const struct mt352_config dvico_fusionhdtv_dual = {\n\t.demod_address = 0x0f,\n\t.demod_init    = dvico_dual_demod_init,\n};\n\nstatic const struct zl10353_config cx88_terratec_cinergy_ht_pci_mkii_config = {\n\t.demod_address = (0x1e >> 1),\n\t.no_tuner      = 1,\n\t.if2           = 45600,\n};\n\nstatic const struct mb86a16_config twinhan_vp1027 = {\n\t.demod_address  = 0x08,\n};\n\n#if IS_ENABLED(CONFIG_VIDEO_CX88_VP3054)\nstatic int dntv_live_dvbt_pro_demod_init(struct dvb_frontend *fe)\n{\n\tstatic const u8 clock_config[]  = { 0x89, 0x38, 0x38 };\n\tstatic const u8 reset[]         = { 0x50, 0x80 };\n\tstatic const u8 adc_ctl_1_cfg[] = { 0x8E, 0x40 };\n\tstatic const u8 agc_cfg[]       = { 0x67, 0x10, 0x20, 0x00, 0xFF, 0xFF,\n\t\t\t\t       0x00, 0xFF, 0x00, 0x40, 0x40 };\n\tstatic const u8 dntv_extra[]     = { 0xB5, 0x7A };\n\tstatic const u8 capt_range_cfg[] = { 0x75, 0x32 };\n\n\tmt352_write(fe, clock_config,   sizeof(clock_config));\n\tudelay(2000);\n\tmt352_write(fe, reset,          sizeof(reset));\n\tmt352_write(fe, adc_ctl_1_cfg,  sizeof(adc_ctl_1_cfg));\n\n\tmt352_write(fe, agc_cfg,        sizeof(agc_cfg));\n\tudelay(2000);\n\tmt352_write(fe, dntv_extra,     sizeof(dntv_extra));\n\tmt352_write(fe, capt_range_cfg, sizeof(capt_range_cfg));\n\n\treturn 0;\n}\n\nstatic const struct mt352_config dntv_live_dvbt_pro_config = {\n\t.demod_address = 0x0f,\n\t.no_tuner      = 1,\n\t.demod_init    = dntv_live_dvbt_pro_demod_init,\n};\n#endif\n\nstatic const struct zl10353_config dvico_fusionhdtv_hybrid = {\n\t.demod_address = 0x0f,\n\t.no_tuner      = 1,\n};\n\nstatic const struct zl10353_config dvico_fusionhdtv_xc3028 = {\n\t.demod_address = 0x0f,\n\t.if2           = 45600,\n\t.no_tuner      = 1,\n};\n\nstatic const struct mt352_config dvico_fusionhdtv_mt352_xc3028 = {\n\t.demod_address = 0x0f,\n\t.if2 = 4560,\n\t.no_tuner = 1,\n\t.demod_init = dvico_fusionhdtv_demod_init,\n};\n\nstatic const struct zl10353_config dvico_fusionhdtv_plus_v1_1 = {\n\t.demod_address = 0x0f,\n};\n\nstatic const struct cx22702_config connexant_refboard_config = {\n\t.demod_address = 0x43,\n\t.output_mode   = CX22702_SERIAL_OUTPUT,\n};\n\nstatic const struct cx22702_config hauppauge_hvr_config = {\n\t.demod_address = 0x63,\n\t.output_mode   = CX22702_SERIAL_OUTPUT,\n};\n\nstatic int or51132_set_ts_param(struct dvb_frontend *fe, int is_punctured)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\n\tdev->ts_gen_cntrl = is_punctured ? 0x04 : 0x00;\n\treturn 0;\n}\n\nstatic const struct or51132_config pchdtv_hd3000 = {\n\t.demod_address = 0x15,\n\t.set_ts_params = or51132_set_ts_param,\n};\n\nstatic int lgdt330x_pll_rf_set(struct dvb_frontend *fe, int index)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\tdprintk(1, \"%s: index = %d\\n\", __func__, index);\n\tif (index == 0)\n\t\tcx_clear(MO_GP0_IO, 8);\n\telse\n\t\tcx_set(MO_GP0_IO, 8);\n\treturn 0;\n}\n\nstatic int lgdt330x_set_ts_param(struct dvb_frontend *fe, int is_punctured)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\n\tif (is_punctured)\n\t\tdev->ts_gen_cntrl |= 0x04;\n\telse\n\t\tdev->ts_gen_cntrl &= ~0x04;\n\treturn 0;\n}\n\nstatic struct lgdt330x_config fusionhdtv_3_gold = {\n\t.demod_chip    = LGDT3302,\n\t.serial_mpeg   = 0x04,  \n\t.set_ts_params = lgdt330x_set_ts_param,\n};\n\nstatic const struct lgdt330x_config fusionhdtv_5_gold = {\n\t.demod_chip    = LGDT3303,\n\t.serial_mpeg   = 0x40,  \n\t.set_ts_params = lgdt330x_set_ts_param,\n};\n\nstatic const struct lgdt330x_config pchdtv_hd5500 = {\n\t.demod_chip    = LGDT3303,\n\t.serial_mpeg   = 0x40,  \n\t.set_ts_params = lgdt330x_set_ts_param,\n};\n\nstatic int nxt200x_set_ts_param(struct dvb_frontend *fe, int is_punctured)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\n\tdev->ts_gen_cntrl = is_punctured ? 0x04 : 0x00;\n\treturn 0;\n}\n\nstatic const struct nxt200x_config ati_hdtvwonder = {\n\t.demod_address = 0x0a,\n\t.set_ts_params = nxt200x_set_ts_param,\n};\n\nstatic int cx24123_set_ts_param(struct dvb_frontend *fe,\n\t\t\t\tint is_punctured)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\n\tdev->ts_gen_cntrl = 0x02;\n\treturn 0;\n}\n\nstatic int kworld_dvbs_100_set_voltage(struct dvb_frontend *fe,\n\t\t\t\t       enum fe_sec_voltage voltage)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\tif (voltage == SEC_VOLTAGE_OFF)\n\t\tcx_write(MO_GP0_IO, 0x000006fb);\n\telse\n\t\tcx_write(MO_GP0_IO, 0x000006f9);\n\n\tif (core->prev_set_voltage)\n\t\treturn core->prev_set_voltage(fe, voltage);\n\treturn 0;\n}\n\nstatic int geniatech_dvbs_set_voltage(struct dvb_frontend *fe,\n\t\t\t\t      enum fe_sec_voltage voltage)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\tif (voltage == SEC_VOLTAGE_OFF) {\n\t\tdprintk(1, \"LNB Voltage OFF\\n\");\n\t\tcx_write(MO_GP0_IO, 0x0000efff);\n\t}\n\n\tif (core->prev_set_voltage)\n\t\treturn core->prev_set_voltage(fe, voltage);\n\treturn 0;\n}\n\nstatic int tevii_dvbs_set_voltage(struct dvb_frontend *fe,\n\t\t\t\t  enum fe_sec_voltage voltage)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\tcx_set(MO_GP0_IO, 0x6040);\n\tswitch (voltage) {\n\tcase SEC_VOLTAGE_13:\n\t\tcx_clear(MO_GP0_IO, 0x20);\n\t\tbreak;\n\tcase SEC_VOLTAGE_18:\n\t\tcx_set(MO_GP0_IO, 0x20);\n\t\tbreak;\n\tcase SEC_VOLTAGE_OFF:\n\t\tcx_clear(MO_GP0_IO, 0x20);\n\t\tbreak;\n\t}\n\n\tif (core->prev_set_voltage)\n\t\treturn core->prev_set_voltage(fe, voltage);\n\treturn 0;\n}\n\nstatic int vp1027_set_voltage(struct dvb_frontend *fe,\n\t\t\t      enum fe_sec_voltage voltage)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\tswitch (voltage) {\n\tcase SEC_VOLTAGE_13:\n\t\tdprintk(1, \"LNB SEC Voltage=13\\n\");\n\t\tcx_write(MO_GP0_IO, 0x00001220);\n\t\tbreak;\n\tcase SEC_VOLTAGE_18:\n\t\tdprintk(1, \"LNB SEC Voltage=18\\n\");\n\t\tcx_write(MO_GP0_IO, 0x00001222);\n\t\tbreak;\n\tcase SEC_VOLTAGE_OFF:\n\t\tdprintk(1, \"LNB Voltage OFF\\n\");\n\t\tcx_write(MO_GP0_IO, 0x00001230);\n\t\tbreak;\n\t}\n\n\tif (core->prev_set_voltage)\n\t\treturn core->prev_set_voltage(fe, voltage);\n\treturn 0;\n}\n\nstatic const struct cx24123_config geniatech_dvbs_config = {\n\t.demod_address = 0x55,\n\t.set_ts_params = cx24123_set_ts_param,\n};\n\nstatic const struct cx24123_config hauppauge_novas_config = {\n\t.demod_address = 0x55,\n\t.set_ts_params = cx24123_set_ts_param,\n};\n\nstatic const struct cx24123_config kworld_dvbs_100_config = {\n\t.demod_address = 0x15,\n\t.set_ts_params = cx24123_set_ts_param,\n\t.lnb_polarity  = 1,\n};\n\nstatic const struct s5h1409_config pinnacle_pctv_hd_800i_config = {\n\t.demod_address = 0x32 >> 1,\n\t.output_mode   = S5H1409_PARALLEL_OUTPUT,\n\t.gpio\t       = S5H1409_GPIO_ON,\n\t.qam_if\t       = 44000,\n\t.inversion     = S5H1409_INVERSION_OFF,\n\t.status_mode   = S5H1409_DEMODLOCKING,\n\t.mpeg_timing   = S5H1409_MPEGTIMING_NONCONTINUOUS_NONINVERTING_CLOCK,\n};\n\nstatic const struct s5h1409_config dvico_hdtv5_pci_nano_config = {\n\t.demod_address = 0x32 >> 1,\n\t.output_mode   = S5H1409_SERIAL_OUTPUT,\n\t.gpio          = S5H1409_GPIO_OFF,\n\t.inversion     = S5H1409_INVERSION_OFF,\n\t.status_mode   = S5H1409_DEMODLOCKING,\n\t.mpeg_timing   = S5H1409_MPEGTIMING_CONTINUOUS_NONINVERTING_CLOCK,\n};\n\nstatic const struct s5h1409_config kworld_atsc_120_config = {\n\t.demod_address = 0x32 >> 1,\n\t.output_mode   = S5H1409_SERIAL_OUTPUT,\n\t.gpio\t       = S5H1409_GPIO_OFF,\n\t.inversion     = S5H1409_INVERSION_OFF,\n\t.status_mode   = S5H1409_DEMODLOCKING,\n\t.mpeg_timing   = S5H1409_MPEGTIMING_CONTINUOUS_NONINVERTING_CLOCK,\n};\n\nstatic const struct xc5000_config pinnacle_pctv_hd_800i_tuner_config = {\n\t.i2c_address\t= 0x64,\n\t.if_khz\t\t= 5380,\n};\n\nstatic const struct zl10353_config cx88_pinnacle_hybrid_pctv = {\n\t.demod_address = (0x1e >> 1),\n\t.no_tuner      = 1,\n\t.if2           = 45600,\n};\n\nstatic const struct zl10353_config cx88_geniatech_x8000_mt = {\n\t.demod_address = (0x1e >> 1),\n\t.no_tuner = 1,\n\t.disable_i2c_gate_ctrl = 1,\n};\n\nstatic const struct s5h1411_config dvico_fusionhdtv7_config = {\n\t.output_mode   = S5H1411_SERIAL_OUTPUT,\n\t.gpio          = S5H1411_GPIO_ON,\n\t.mpeg_timing   = S5H1411_MPEGTIMING_CONTINUOUS_NONINVERTING_CLOCK,\n\t.qam_if        = S5H1411_IF_44000,\n\t.vsb_if        = S5H1411_IF_44000,\n\t.inversion     = S5H1411_INVERSION_OFF,\n\t.status_mode   = S5H1411_DEMODLOCKING\n};\n\nstatic const struct xc5000_config dvico_fusionhdtv7_tuner_config = {\n\t.i2c_address    = 0xc2 >> 1,\n\t.if_khz         = 5380,\n};\n\nstatic int attach_xc3028(u8 addr, struct cx8802_dev *dev)\n{\n\tstruct dvb_frontend *fe;\n\tstruct vb2_dvb_frontend *fe0 = NULL;\n\tstruct xc2028_ctrl ctl;\n\tstruct xc2028_config cfg = {\n\t\t.i2c_adap  = &dev->core->i2c_adap,\n\t\t.i2c_addr  = addr,\n\t\t.ctrl      = &ctl,\n\t};\n\n\t \n\tfe0 = vb2_dvb_get_frontend(&dev->frontends, 1);\n\tif (!fe0)\n\t\treturn -EINVAL;\n\n\tif (!fe0->dvb.frontend) {\n\t\tpr_err(\"dvb frontend not attached. Can't attach xc3028\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tcx88_setup_xc3028(dev->core, &ctl);\n\n\tfe = dvb_attach(xc2028_attach, fe0->dvb.frontend, &cfg);\n\tif (!fe) {\n\t\tpr_err(\"xc3028 attach failed\\n\");\n\t\tdvb_frontend_detach(fe0->dvb.frontend);\n\t\tdvb_unregister_frontend(fe0->dvb.frontend);\n\t\tfe0->dvb.frontend = NULL;\n\t\treturn -EINVAL;\n\t}\n\n\tpr_info(\"xc3028 attached\\n\");\n\n\treturn 0;\n}\n\nstatic int attach_xc4000(struct cx8802_dev *dev, struct xc4000_config *cfg)\n{\n\tstruct dvb_frontend *fe;\n\tstruct vb2_dvb_frontend *fe0 = NULL;\n\n\t \n\tfe0 = vb2_dvb_get_frontend(&dev->frontends, 1);\n\tif (!fe0)\n\t\treturn -EINVAL;\n\n\tif (!fe0->dvb.frontend) {\n\t\tpr_err(\"dvb frontend not attached. Can't attach xc4000\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tfe = dvb_attach(xc4000_attach, fe0->dvb.frontend, &dev->core->i2c_adap,\n\t\t\tcfg);\n\tif (!fe) {\n\t\tpr_err(\"xc4000 attach failed\\n\");\n\t\tdvb_frontend_detach(fe0->dvb.frontend);\n\t\tdvb_unregister_frontend(fe0->dvb.frontend);\n\t\tfe0->dvb.frontend = NULL;\n\t\treturn -EINVAL;\n\t}\n\n\tpr_info(\"xc4000 attached\\n\");\n\n\treturn 0;\n}\n\nstatic int cx24116_set_ts_param(struct dvb_frontend *fe,\n\t\t\t\tint is_punctured)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\n\tdev->ts_gen_cntrl = 0x2;\n\n\treturn 0;\n}\n\nstatic int stv0900_set_ts_param(struct dvb_frontend *fe,\n\t\t\t\tint is_punctured)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\n\tdev->ts_gen_cntrl = 0;\n\n\treturn 0;\n}\n\nstatic int cx24116_reset_device(struct dvb_frontend *fe)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\t \n\t \n\tcx_write(MO_SRST_IO, 0);\n\tusleep_range(10000, 20000);\n\t \n\tcx_write(MO_SRST_IO, 1);\n\tusleep_range(10000, 20000);\n\n\treturn 0;\n}\n\nstatic const struct cx24116_config hauppauge_hvr4000_config = {\n\t.demod_address          = 0x05,\n\t.set_ts_params          = cx24116_set_ts_param,\n\t.reset_device           = cx24116_reset_device,\n};\n\nstatic const struct cx24116_config tevii_s460_config = {\n\t.demod_address = 0x55,\n\t.set_ts_params = cx24116_set_ts_param,\n\t.reset_device  = cx24116_reset_device,\n};\n\nstatic int ds3000_set_ts_param(struct dvb_frontend *fe,\n\t\t\t       int is_punctured)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\n\tdev->ts_gen_cntrl = 4;\n\n\treturn 0;\n}\n\nstatic struct ds3000_config tevii_ds3000_config = {\n\t.demod_address = 0x68,\n\t.set_ts_params = ds3000_set_ts_param,\n};\n\nstatic struct ts2020_config tevii_ts2020_config  = {\n\t.tuner_address = 0x60,\n\t.clk_out_div = 1,\n};\n\nstatic const struct stv0900_config prof_7301_stv0900_config = {\n\t.demod_address = 0x6a,\n \n\t.xtal = 27000000,\n\t.clkmode = 3, \n\t.diseqc_mode = 2, \n\t.tun1_maddress = 0, \n\t.tun1_adc = 0, \n\t.path1_mode = 3,\n\t.set_ts_params = stv0900_set_ts_param,\n};\n\nstatic const struct stb6100_config prof_7301_stb6100_config = {\n\t.tuner_address = 0x60,\n\t.refclock = 27000000,\n};\n\nstatic const struct stv0299_config tevii_tuner_sharp_config = {\n\t.demod_address = 0x68,\n\t.inittab = sharp_z0194a_inittab,\n\t.mclk = 88000000UL,\n\t.invert = 1,\n\t.skip_reinit = 0,\n\t.lock_output = 1,\n\t.volt13_op0_op1 = STV0299_VOLT13_OP1,\n\t.min_delay_ms = 100,\n\t.set_symbol_rate = sharp_z0194a_set_symbol_rate,\n\t.set_ts_params = cx24116_set_ts_param,\n};\n\nstatic const struct stv0288_config tevii_tuner_earda_config = {\n\t.demod_address = 0x68,\n\t.min_delay_ms = 100,\n\t.set_ts_params = cx24116_set_ts_param,\n};\n\nstatic int cx8802_alloc_frontends(struct cx8802_dev *dev)\n{\n\tstruct cx88_core *core = dev->core;\n\tstruct vb2_dvb_frontend *fe = NULL;\n\tint i;\n\n\tmutex_init(&dev->frontends.lock);\n\tINIT_LIST_HEAD(&dev->frontends.felist);\n\n\tif (!core->board.num_frontends)\n\t\treturn -ENODEV;\n\n\tpr_info(\"%s: allocating %d frontend(s)\\n\", __func__,\n\t\tcore->board.num_frontends);\n\tfor (i = 1; i <= core->board.num_frontends; i++) {\n\t\tfe = vb2_dvb_alloc_frontend(&dev->frontends, i);\n\t\tif (!fe) {\n\t\t\tpr_err(\"%s() failed to alloc\\n\", __func__);\n\t\t\tvb2_dvb_dealloc_frontends(&dev->frontends);\n\t\t\treturn -ENOMEM;\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic const u8 samsung_smt_7020_inittab[] = {\n\t     0x01, 0x15,\n\t     0x02, 0x00,\n\t     0x03, 0x00,\n\t     0x04, 0x7D,\n\t     0x05, 0x0F,\n\t     0x06, 0x02,\n\t     0x07, 0x00,\n\t     0x08, 0x60,\n\n\t     0x0A, 0xC2,\n\t     0x0B, 0x00,\n\t     0x0C, 0x01,\n\t     0x0D, 0x81,\n\t     0x0E, 0x44,\n\t     0x0F, 0x09,\n\t     0x10, 0x3C,\n\t     0x11, 0x84,\n\t     0x12, 0xDA,\n\t     0x13, 0x99,\n\t     0x14, 0x8D,\n\t     0x15, 0xCE,\n\t     0x16, 0xE8,\n\t     0x17, 0x43,\n\t     0x18, 0x1C,\n\t     0x19, 0x1B,\n\t     0x1A, 0x1D,\n\n\t     0x1C, 0x12,\n\t     0x1D, 0x00,\n\t     0x1E, 0x00,\n\t     0x1F, 0x00,\n\t     0x20, 0x00,\n\t     0x21, 0x00,\n\t     0x22, 0x00,\n\t     0x23, 0x00,\n\n\t     0x28, 0x02,\n\t     0x29, 0x28,\n\t     0x2A, 0x14,\n\t     0x2B, 0x0F,\n\t     0x2C, 0x09,\n\t     0x2D, 0x05,\n\n\t     0x31, 0x1F,\n\t     0x32, 0x19,\n\t     0x33, 0xFC,\n\t     0x34, 0x13,\n\t     0xff, 0xff,\n};\n\nstatic int samsung_smt_7020_tuner_set_params(struct dvb_frontend *fe)\n{\n\tstruct dtv_frontend_properties *c = &fe->dtv_property_cache;\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tu8 buf[4];\n\tu32 div;\n\tstruct i2c_msg msg = {\n\t\t.addr = 0x61,\n\t\t.flags = 0,\n\t\t.buf = buf,\n\t\t.len = sizeof(buf) };\n\n\tdiv = c->frequency / 125;\n\n\tbuf[0] = (div >> 8) & 0x7f;\n\tbuf[1] = div & 0xff;\n\tbuf[2] = 0x84;   \n\tbuf[3] = 0x00;\n\n\tif (c->frequency < 1500000)\n\t\tbuf[3] |= 0x10;\n\n\tif (fe->ops.i2c_gate_ctrl)\n\t\tfe->ops.i2c_gate_ctrl(fe, 1);\n\n\tif (i2c_transfer(&dev->core->i2c_adap, &msg, 1) != 1)\n\t\treturn -EIO;\n\n\treturn 0;\n}\n\nstatic int samsung_smt_7020_set_tone(struct dvb_frontend *fe,\n\t\t\t\t     enum fe_sec_tone_mode tone)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\tcx_set(MO_GP0_IO, 0x0800);\n\n\tswitch (tone) {\n\tcase SEC_TONE_ON:\n\t\tcx_set(MO_GP0_IO, 0x08);\n\t\tbreak;\n\tcase SEC_TONE_OFF:\n\t\tcx_clear(MO_GP0_IO, 0x08);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int samsung_smt_7020_set_voltage(struct dvb_frontend *fe,\n\t\t\t\t\tenum fe_sec_voltage voltage)\n{\n\tstruct cx8802_dev *dev = fe->dvb->priv;\n\tstruct cx88_core *core = dev->core;\n\n\tu8 data;\n\tstruct i2c_msg msg = {\n\t\t.addr = 8,\n\t\t.flags = 0,\n\t\t.buf = &data,\n\t\t.len = sizeof(data) };\n\n\tcx_set(MO_GP0_IO, 0x8000);\n\n\tswitch (voltage) {\n\tcase SEC_VOLTAGE_OFF:\n\t\tbreak;\n\tcase SEC_VOLTAGE_13:\n\t\tdata = ISL6421_EN1 | ISL6421_LLC1;\n\t\tcx_clear(MO_GP0_IO, 0x80);\n\t\tbreak;\n\tcase SEC_VOLTAGE_18:\n\t\tdata = ISL6421_EN1 | ISL6421_LLC1 | ISL6421_VSEL1;\n\t\tcx_clear(MO_GP0_IO, 0x80);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn (i2c_transfer(&dev->core->i2c_adap, &msg, 1) == 1) ? 0 : -EIO;\n}\n\nstatic int samsung_smt_7020_stv0299_set_symbol_rate(struct dvb_frontend *fe,\n\t\t\t\t\t\t    u32 srate, u32 ratio)\n{\n\tu8 aclk = 0;\n\tu8 bclk = 0;\n\n\tif (srate < 1500000) {\n\t\taclk = 0xb7;\n\t\tbclk = 0x47;\n\t} else if (srate < 3000000) {\n\t\taclk = 0xb7;\n\t\tbclk = 0x4b;\n\t} else if (srate < 7000000) {\n\t\taclk = 0xb7;\n\t\tbclk = 0x4f;\n\t} else if (srate < 14000000) {\n\t\taclk = 0xb7;\n\t\tbclk = 0x53;\n\t} else if (srate < 30000000) {\n\t\taclk = 0xb6;\n\t\tbclk = 0x53;\n\t} else if (srate < 45000000) {\n\t\taclk = 0xb4;\n\t\tbclk = 0x51;\n\t}\n\n\tstv0299_writereg(fe, 0x13, aclk);\n\tstv0299_writereg(fe, 0x14, bclk);\n\tstv0299_writereg(fe, 0x1f, (ratio >> 16) & 0xff);\n\tstv0299_writereg(fe, 0x20, (ratio >>  8) & 0xff);\n\tstv0299_writereg(fe, 0x21, ratio & 0xf0);\n\n\treturn 0;\n}\n\nstatic const struct stv0299_config samsung_stv0299_config = {\n\t.demod_address = 0x68,\n\t.inittab = samsung_smt_7020_inittab,\n\t.mclk = 88000000UL,\n\t.invert = 0,\n\t.skip_reinit = 0,\n\t.lock_output = STV0299_LOCKOUTPUT_LK,\n\t.volt13_op0_op1 = STV0299_VOLT13_OP1,\n\t.min_delay_ms = 100,\n\t.set_symbol_rate = samsung_smt_7020_stv0299_set_symbol_rate,\n};\n\nstatic int dvb_register(struct cx8802_dev *dev)\n{\n\tstruct cx88_core *core = dev->core;\n\tstruct vb2_dvb_frontend *fe0, *fe1 = NULL;\n\tint mfe_shared = 0;  \n\tint res = -EINVAL;\n\n\tif (core->i2c_rc != 0) {\n\t\tpr_err(\"no i2c-bus available, cannot attach dvb drivers\\n\");\n\t\tgoto frontend_detach;\n\t}\n\n\t \n\tfe0 = vb2_dvb_get_frontend(&dev->frontends, 1);\n\tif (!fe0)\n\t\tgoto frontend_detach;\n\n\t \n\tdev->frontends.gate = 0;\n\n\t \n\tcore->gate_ctrl = cx88_dvb_gate_ctrl;\n\n\t \n\tswitch (core->boardnr) {\n\tcase CX88_BOARD_HAUPPAUGE_DVB_T1:\n\t\tfe0->dvb.frontend = dvb_attach(cx22702_attach,\n\t\t\t\t\t       &connexant_refboard_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x61, &core->i2c_adap,\n\t\t\t\t\tDVB_PLL_THOMSON_DTT759X))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1:\n\tcase CX88_BOARD_CONEXANT_DVB_T1:\n\tcase CX88_BOARD_KWORLD_DVB_T_CX22702:\n\tcase CX88_BOARD_WINFAST_DTV1000:\n\t\tfe0->dvb.frontend = dvb_attach(cx22702_attach,\n\t\t\t\t\t       &connexant_refboard_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x60, &core->i2c_adap,\n\t\t\t\t\tDVB_PLL_THOMSON_DTT7579))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_WINFAST_DTV2000H:\n\tcase CX88_BOARD_HAUPPAUGE_HVR1100:\n\tcase CX88_BOARD_HAUPPAUGE_HVR1100LP:\n\tcase CX88_BOARD_HAUPPAUGE_HVR1300:\n\t\tfe0->dvb.frontend = dvb_attach(cx22702_attach,\n\t\t\t\t\t       &hauppauge_hvr_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_PHILIPS_FMD1216ME_MK3))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_WINFAST_DTV2000H_J:\n\t\tfe0->dvb.frontend = dvb_attach(cx22702_attach,\n\t\t\t\t\t       &hauppauge_hvr_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_PHILIPS_FMD1216MEX_MK3))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_HAUPPAUGE_HVR3000:\n\t\t \n\t\tmfe_shared = 1;\n\t\tdev->frontends.gate = 2;\n\t\t \n\t\tfe0->dvb.frontend = dvb_attach(cx24123_attach,\n\t\t\t\t\t       &hauppauge_novas_config,\n\t\t\t\t\t       &dev->core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(isl6421_attach,\n\t\t\t\t\tfe0->dvb.frontend,\n\t\t\t\t\t&dev->core->i2c_adap,\n\t\t\t\t\t0x08, ISL6421_DCL, 0x00, false))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\t \n\t\tfe1 = vb2_dvb_get_frontend(&dev->frontends, 2);\n\t\tif (!fe1)\n\t\t\tgoto frontend_detach;\n\t\t \n\t\tfe1->dvb.frontend = dvb_attach(cx22702_attach,\n\t\t\t\t\t       &hauppauge_hvr_config,\n\t\t\t\t\t       &dev->core->i2c_adap);\n\t\tif (fe1->dvb.frontend) {\n\t\t\tfe1->dvb.frontend->id = 1;\n\t\t\tif (!dvb_attach(simple_tuner_attach,\n\t\t\t\t\tfe1->dvb.frontend,\n\t\t\t\t\t&dev->core->i2c_adap,\n\t\t\t\t\t0x61, TUNER_PHILIPS_FMD1216ME_MK3))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS:\n\t\tfe0->dvb.frontend = dvb_attach(mt352_attach,\n\t\t\t\t\t       &dvico_fusionhdtv,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x60, NULL, DVB_PLL_THOMSON_DTT7579))\n\t\t\t\tgoto frontend_detach;\n\t\t\tbreak;\n\t\t}\n\t\t \n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &dvico_fusionhdtv_plus_v1_1,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x60, NULL, DVB_PLL_THOMSON_DTT7579))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL:\n\t\t \n\t\tfe0->dvb.frontend = dvb_attach(mt352_attach,\n\t\t\t\t\t       &dvico_fusionhdtv_dual,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x61, NULL, DVB_PLL_THOMSON_DTT7579))\n\t\t\t\tgoto frontend_detach;\n\t\t\tbreak;\n\t\t}\n\t\t \n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &dvico_fusionhdtv_plus_v1_1,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x61, NULL, DVB_PLL_THOMSON_DTT7579))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1:\n\t\tfe0->dvb.frontend = dvb_attach(mt352_attach,\n\t\t\t\t\t       &dvico_fusionhdtv,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x61, NULL, DVB_PLL_LG_Z201))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_KWORLD_DVB_T:\n\tcase CX88_BOARD_DNTV_LIVE_DVB_T:\n\tcase CX88_BOARD_ADSTECH_DVB_T_PCI:\n\t\tfe0->dvb.frontend = dvb_attach(mt352_attach,\n\t\t\t\t\t       &dntv_live_dvbt_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend,\n\t\t\t\t\t0x61, NULL, DVB_PLL_UNKNOWN_1))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DNTV_LIVE_DVB_T_PRO:\n#if IS_ENABLED(CONFIG_VIDEO_CX88_VP3054)\n\t\t \n\t\tfe0->dvb.frontend = dvb_attach(mt352_attach,\n\t\t\t\t\t       &dntv_live_dvbt_pro_config,\n\t\t\t\t\t       &dev->vp3054->adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_PHILIPS_FMD1216ME_MK3))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n#else\n\t\tpr_err(\"built without vp3054 support\\n\");\n#endif\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID:\n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &dvico_fusionhdtv_hybrid,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_THOMSON_FE6600))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO:\n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &dvico_fusionhdtv_xc3028,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (!fe0->dvb.frontend)\n\t\t\tfe0->dvb.frontend = dvb_attach(mt352_attach,\n\t\t\t\t\t\t&dvico_fusionhdtv_mt352_xc3028,\n\t\t\t\t\t\t&core->i2c_adap);\n\t\t \n\t\tif (fe0->dvb.frontend)\n\t\t\tfe0->dvb.frontend->ops.i2c_gate_ctrl = NULL;\n\t\tif (attach_xc3028(0x61, dev) < 0)\n\t\t\tgoto frontend_detach;\n\t\tbreak;\n\tcase CX88_BOARD_PCHDTV_HD3000:\n\t\tfe0->dvb.frontend = dvb_attach(or51132_attach, &pchdtv_hd3000,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_THOMSON_DTT761X))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q:\n\t\tdev->ts_gen_cntrl = 0x08;\n\n\t\t \n\t\tcx_clear(MO_GP0_IO, 1);\n\t\tmsleep(100);\n\t\tcx_set(MO_GP0_IO, 1);\n\t\tmsleep(200);\n\n\t\t \n\t\tfusionhdtv_3_gold.pll_rf_set = lgdt330x_pll_rf_set;\n\t\tfe0->dvb.frontend = dvb_attach(lgdt330x_attach,\n\t\t\t\t\t       &fusionhdtv_3_gold,\n\t\t\t\t\t       0x0e,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_MICROTUNE_4042FI5))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T:\n\t\tdev->ts_gen_cntrl = 0x08;\n\n\t\t \n\t\tcx_clear(MO_GP0_IO, 1);\n\t\tmsleep(100);\n\t\tcx_set(MO_GP0_IO, 9);\n\t\tmsleep(200);\n\t\tfe0->dvb.frontend = dvb_attach(lgdt330x_attach,\n\t\t\t\t\t       &fusionhdtv_3_gold,\n\t\t\t\t\t       0x0e,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_THOMSON_DTT761X))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD:\n\t\tdev->ts_gen_cntrl = 0x08;\n\n\t\t \n\t\tcx_clear(MO_GP0_IO, 1);\n\t\tmsleep(100);\n\t\tcx_set(MO_GP0_IO, 1);\n\t\tmsleep(200);\n\t\tfe0->dvb.frontend = dvb_attach(lgdt330x_attach,\n\t\t\t\t\t       &fusionhdtv_5_gold,\n\t\t\t\t\t       0x0e,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_LG_TDVS_H06XF))\n\t\t\t\tgoto frontend_detach;\n\t\t\tif (!dvb_attach(tda9887_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x43))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_PCHDTV_HD5500:\n\t\tdev->ts_gen_cntrl = 0x08;\n\n\t\t \n\t\tcx_clear(MO_GP0_IO, 1);\n\t\tmsleep(100);\n\t\tcx_set(MO_GP0_IO, 1);\n\t\tmsleep(200);\n\t\tfe0->dvb.frontend = dvb_attach(lgdt330x_attach,\n\t\t\t\t\t       &pchdtv_hd5500,\n\t\t\t\t\t       0x59,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_LG_TDVS_H06XF))\n\t\t\t\tgoto frontend_detach;\n\t\t\tif (!dvb_attach(tda9887_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x43))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_ATI_HDTVWONDER:\n\t\tfe0->dvb.frontend = dvb_attach(nxt200x_attach,\n\t\t\t\t\t       &ati_hdtvwonder,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(simple_tuner_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x61,\n\t\t\t\t\tTUNER_PHILIPS_TUV1236D))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1:\n\tcase CX88_BOARD_HAUPPAUGE_NOVASE2_S1:\n\t\tfe0->dvb.frontend = dvb_attach(cx24123_attach,\n\t\t\t\t\t       &hauppauge_novas_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tbool override_tone;\n\n\t\t\tif (core->model == 92001)\n\t\t\t\toverride_tone = true;\n\t\t\telse\n\t\t\t\toverride_tone = false;\n\n\t\t\tif (!dvb_attach(isl6421_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap, 0x08, ISL6421_DCL,\n\t\t\t\t\t0x00, override_tone))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_KWORLD_DVBS_100:\n\t\tfe0->dvb.frontend = dvb_attach(cx24123_attach,\n\t\t\t\t\t       &kworld_dvbs_100_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tcore->prev_set_voltage = fe0->dvb.frontend->ops.set_voltage;\n\t\t\tfe0->dvb.frontend->ops.set_voltage = kworld_dvbs_100_set_voltage;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_GENIATECH_DVBS:\n\t\tfe0->dvb.frontend = dvb_attach(cx24123_attach,\n\t\t\t\t\t       &geniatech_dvbs_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tcore->prev_set_voltage = fe0->dvb.frontend->ops.set_voltage;\n\t\t\tfe0->dvb.frontend->ops.set_voltage = geniatech_dvbs_set_voltage;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_PINNACLE_PCTV_HD_800i:\n\t\tfe0->dvb.frontend = dvb_attach(s5h1409_attach,\n\t\t\t\t\t       &pinnacle_pctv_hd_800i_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(xc5000_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap,\n\t\t\t\t\t&pinnacle_pctv_hd_800i_tuner_config))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO:\n\t\tfe0->dvb.frontend = dvb_attach(s5h1409_attach,\n\t\t\t\t\t       &dvico_hdtv5_pci_nano_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tstruct dvb_frontend *fe;\n\t\t\tstruct xc2028_config cfg = {\n\t\t\t\t.i2c_adap  = &core->i2c_adap,\n\t\t\t\t.i2c_addr  = 0x61,\n\t\t\t};\n\t\t\tstatic struct xc2028_ctrl ctl = {\n\t\t\t\t.fname       = XC2028_DEFAULT_FIRMWARE,\n\t\t\t\t.max_len     = 64,\n\t\t\t\t.scode_table = XC3028_FE_OREN538,\n\t\t\t};\n\n\t\t\tfe = dvb_attach(xc2028_attach,\n\t\t\t\t\tfe0->dvb.frontend, &cfg);\n\t\t\tif (fe && fe->ops.tuner_ops.set_config)\n\t\t\t\tfe->ops.tuner_ops.set_config(fe, &ctl);\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_NOTONLYTV_LV3H:\n\tcase CX88_BOARD_PINNACLE_HYBRID_PCTV:\n\tcase CX88_BOARD_WINFAST_DTV1800H:\n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &cx88_pinnacle_hybrid_pctv,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tfe0->dvb.frontend->ops.i2c_gate_ctrl = NULL;\n\t\t\tif (attach_xc3028(0x61, dev) < 0)\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_WINFAST_DTV1800H_XC4000:\n\tcase CX88_BOARD_WINFAST_DTV2000H_PLUS:\n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &cx88_pinnacle_hybrid_pctv,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tstruct xc4000_config cfg = {\n\t\t\t\t.i2c_address\t  = 0x61,\n\t\t\t\t.default_pm\t  = 0,\n\t\t\t\t.dvb_amplitude\t  = 134,\n\t\t\t\t.set_smoothedcvbs = 1,\n\t\t\t\t.if_khz\t\t  = 4560\n\t\t\t};\n\t\t\tfe0->dvb.frontend->ops.i2c_gate_ctrl = NULL;\n\t\t\tif (attach_xc4000(dev, &cfg) < 0)\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_GENIATECH_X8000_MT:\n\t\tdev->ts_gen_cntrl = 0x00;\n\n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &cx88_geniatech_x8000_mt,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (attach_xc3028(0x61, dev) < 0)\n\t\t\tgoto frontend_detach;\n\t\tbreak;\n\tcase CX88_BOARD_KWORLD_ATSC_120:\n\t\tfe0->dvb.frontend = dvb_attach(s5h1409_attach,\n\t\t\t\t\t       &kworld_atsc_120_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (attach_xc3028(0x61, dev) < 0)\n\t\t\tgoto frontend_detach;\n\t\tbreak;\n\tcase CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD:\n\t\tfe0->dvb.frontend = dvb_attach(s5h1411_attach,\n\t\t\t\t\t       &dvico_fusionhdtv7_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(xc5000_attach, fe0->dvb.frontend,\n\t\t\t\t\t&core->i2c_adap,\n\t\t\t\t\t&dvico_fusionhdtv7_tuner_config))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_HAUPPAUGE_HVR4000:\n\t\t \n\t\tmfe_shared = 1;\n\t\tdev->frontends.gate = 2;\n\t\t \n\t\tfe0->dvb.frontend = dvb_attach(cx24116_attach,\n\t\t\t\t\t       &hauppauge_hvr4000_config,\n\t\t\t\t\t       &dev->core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(isl6421_attach,\n\t\t\t\t\tfe0->dvb.frontend,\n\t\t\t\t\t&dev->core->i2c_adap,\n\t\t\t\t\t0x08, ISL6421_DCL, 0x00, false))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\t \n\t\tfe1 = vb2_dvb_get_frontend(&dev->frontends, 2);\n\t\tif (!fe1)\n\t\t\tgoto frontend_detach;\n\t\t \n\t\tfe1->dvb.frontend = dvb_attach(cx22702_attach,\n\t\t\t\t\t       &hauppauge_hvr_config,\n\t\t\t\t\t       &dev->core->i2c_adap);\n\t\tif (fe1->dvb.frontend) {\n\t\t\tfe1->dvb.frontend->id = 1;\n\t\t\tif (!dvb_attach(simple_tuner_attach,\n\t\t\t\t\tfe1->dvb.frontend,\n\t\t\t\t\t&dev->core->i2c_adap,\n\t\t\t\t\t0x61, TUNER_PHILIPS_FMD1216ME_MK3))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_HAUPPAUGE_HVR4000LITE:\n\t\tfe0->dvb.frontend = dvb_attach(cx24116_attach,\n\t\t\t\t\t       &hauppauge_hvr4000_config,\n\t\t\t\t\t       &dev->core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(isl6421_attach,\n\t\t\t\t\tfe0->dvb.frontend,\n\t\t\t\t\t&dev->core->i2c_adap,\n\t\t\t\t\t0x08, ISL6421_DCL, 0x00, false))\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_PROF_6200:\n\tcase CX88_BOARD_TBS_8910:\n\tcase CX88_BOARD_TEVII_S420:\n\t\tfe0->dvb.frontend = dvb_attach(stv0299_attach,\n\t\t\t\t\t\t&tevii_tuner_sharp_config,\n\t\t\t\t\t\t&core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(dvb_pll_attach, fe0->dvb.frontend, 0x60,\n\t\t\t\t\t&core->i2c_adap, DVB_PLL_OPERA1))\n\t\t\t\tgoto frontend_detach;\n\t\t\tcore->prev_set_voltage = fe0->dvb.frontend->ops.set_voltage;\n\t\t\tfe0->dvb.frontend->ops.set_voltage = tevii_dvbs_set_voltage;\n\n\t\t} else {\n\t\t\tfe0->dvb.frontend = dvb_attach(stv0288_attach,\n\t\t\t\t\t\t\t    &tevii_tuner_earda_config,\n\t\t\t\t\t\t\t    &core->i2c_adap);\n\t\t\tif (fe0->dvb.frontend) {\n\t\t\t\tif (!dvb_attach(stb6000_attach,\n\t\t\t\t\t\tfe0->dvb.frontend, 0x61,\n\t\t\t\t\t\t&core->i2c_adap))\n\t\t\t\t\tgoto frontend_detach;\n\t\t\t\tcore->prev_set_voltage = fe0->dvb.frontend->ops.set_voltage;\n\t\t\t\tfe0->dvb.frontend->ops.set_voltage = tevii_dvbs_set_voltage;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_TEVII_S460:\n\t\tfe0->dvb.frontend = dvb_attach(cx24116_attach,\n\t\t\t\t\t       &tevii_s460_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend)\n\t\t\tfe0->dvb.frontend->ops.set_voltage = tevii_dvbs_set_voltage;\n\t\tbreak;\n\tcase CX88_BOARD_TEVII_S464:\n\t\tfe0->dvb.frontend = dvb_attach(ds3000_attach,\n\t\t\t\t\t\t&tevii_ds3000_config,\n\t\t\t\t\t\t&core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tdvb_attach(ts2020_attach, fe0->dvb.frontend,\n\t\t\t\t   &tevii_ts2020_config, &core->i2c_adap);\n\t\t\tfe0->dvb.frontend->ops.set_voltage =\n\t\t\t\t\t\t\ttevii_dvbs_set_voltage;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_OMICOM_SS4_PCI:\n\tcase CX88_BOARD_TBS_8920:\n\tcase CX88_BOARD_PROF_7300:\n\tcase CX88_BOARD_SATTRADE_ST4200:\n\t\tfe0->dvb.frontend = dvb_attach(cx24116_attach,\n\t\t\t\t\t       &hauppauge_hvr4000_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend)\n\t\t\tfe0->dvb.frontend->ops.set_voltage = tevii_dvbs_set_voltage;\n\t\tbreak;\n\tcase CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII:\n\t\tfe0->dvb.frontend = dvb_attach(zl10353_attach,\n\t\t\t\t\t       &cx88_terratec_cinergy_ht_pci_mkii_config,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tfe0->dvb.frontend->ops.i2c_gate_ctrl = NULL;\n\t\t\tif (attach_xc3028(0x61, dev) < 0)\n\t\t\t\tgoto frontend_detach;\n\t\t}\n\t\tbreak;\n\tcase CX88_BOARD_PROF_7301:{\n\t\tstruct dvb_tuner_ops *tuner_ops = NULL;\n\n\t\tfe0->dvb.frontend = dvb_attach(stv0900_attach,\n\t\t\t\t\t       &prof_7301_stv0900_config,\n\t\t\t\t\t       &core->i2c_adap, 0);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tif (!dvb_attach(stb6100_attach, fe0->dvb.frontend,\n\t\t\t\t\t&prof_7301_stb6100_config,\n\t\t\t\t\t&core->i2c_adap))\n\t\t\t\tgoto frontend_detach;\n\n\t\t\ttuner_ops = &fe0->dvb.frontend->ops.tuner_ops;\n\t\t\ttuner_ops->set_frequency = stb6100_set_freq;\n\t\t\ttuner_ops->get_frequency = stb6100_get_freq;\n\t\t\ttuner_ops->set_bandwidth = stb6100_set_bandw;\n\t\t\ttuner_ops->get_bandwidth = stb6100_get_bandw;\n\n\t\t\tcore->prev_set_voltage =\n\t\t\t\t\tfe0->dvb.frontend->ops.set_voltage;\n\t\t\tfe0->dvb.frontend->ops.set_voltage =\n\t\t\t\t\ttevii_dvbs_set_voltage;\n\t\t}\n\t\tbreak;\n\t\t}\n\tcase CX88_BOARD_SAMSUNG_SMT_7020:\n\t\tdev->ts_gen_cntrl = 0x08;\n\n\t\tcx_set(MO_GP0_IO, 0x0101);\n\n\t\tcx_clear(MO_GP0_IO, 0x01);\n\t\tmsleep(100);\n\t\tcx_set(MO_GP0_IO, 0x01);\n\t\tmsleep(200);\n\n\t\tfe0->dvb.frontend = dvb_attach(stv0299_attach,\n\t\t\t\t\t       &samsung_stv0299_config,\n\t\t\t\t\t       &dev->core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tfe0->dvb.frontend->ops.tuner_ops.set_params =\n\t\t\t\tsamsung_smt_7020_tuner_set_params;\n\t\t\tfe0->dvb.frontend->tuner_priv =\n\t\t\t\t&dev->core->i2c_adap;\n\t\t\tfe0->dvb.frontend->ops.set_voltage =\n\t\t\t\tsamsung_smt_7020_set_voltage;\n\t\t\tfe0->dvb.frontend->ops.set_tone =\n\t\t\t\tsamsung_smt_7020_set_tone;\n\t\t}\n\n\t\tbreak;\n\tcase CX88_BOARD_TWINHAN_VP1027_DVBS:\n\t\tdev->ts_gen_cntrl = 0x00;\n\t\tfe0->dvb.frontend = dvb_attach(mb86a16_attach,\n\t\t\t\t\t       &twinhan_vp1027,\n\t\t\t\t\t       &core->i2c_adap);\n\t\tif (fe0->dvb.frontend) {\n\t\t\tcore->prev_set_voltage =\n\t\t\t\t\tfe0->dvb.frontend->ops.set_voltage;\n\t\t\tfe0->dvb.frontend->ops.set_voltage =\n\t\t\t\t\tvp1027_set_voltage;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\tpr_err(\"The frontend of your DVB/ATSC card isn't supported yet\\n\");\n\t\tbreak;\n\t}\n\n\tif ((NULL == fe0->dvb.frontend) || (fe1 && NULL == fe1->dvb.frontend)) {\n\t\tpr_err(\"frontend initialization failed\\n\");\n\t\tgoto frontend_detach;\n\t}\n\t \n\tfe0->dvb.frontend->callback = cx88_tuner_callback;\n\n\t \n\tfe0->dvb.frontend->ops.ts_bus_ctrl = cx88_dvb_bus_ctrl;\n\tif (fe1)\n\t\tfe1->dvb.frontend->ops.ts_bus_ctrl = cx88_dvb_bus_ctrl;\n\n\t \n\tcall_all(core, tuner, standby);\n\n\t \n\tres = vb2_dvb_register_bus(&dev->frontends, THIS_MODULE, dev,\n\t\t\t\t   &dev->pci->dev, NULL, adapter_nr,\n\t\t\t\t   mfe_shared);\n\tif (res)\n\t\tgoto frontend_detach;\n\treturn res;\n\nfrontend_detach:\n\tcore->gate_ctrl = NULL;\n\tvb2_dvb_dealloc_frontends(&dev->frontends);\n\treturn res;\n}\n\n \n\n \nstatic int cx8802_dvb_advise_acquire(struct cx8802_driver *drv)\n{\n\tstruct cx88_core *core = drv->core;\n\tint err = 0;\n\n\tdprintk(1, \"%s\\n\", __func__);\n\n\tswitch (core->boardnr) {\n\tcase CX88_BOARD_HAUPPAUGE_HVR1300:\n\t\t \n\t\t \n\t\tcx_set(MO_GP0_IO, 0x00000080);\n\t\tudelay(1000);\n\t\tcx_clear(MO_GP0_IO, 0x00000080);\n\t\tudelay(50);\n\t\tcx_set(MO_GP0_IO, 0x00000080);\n\t\tudelay(1000);\n\t\t \n\t\tcx_clear(MO_GP0_IO, 0x00000004);\n\t\tudelay(1000);\n\t\tbreak;\n\n\tcase CX88_BOARD_HAUPPAUGE_HVR3000:\n\tcase CX88_BOARD_HAUPPAUGE_HVR4000:\n\t\t \n\t\tcx_set(MO_GP0_IO, 0x00000080);\n\t\tudelay(1000);\n\t\tcx_clear(MO_GP0_IO, 0x00000080);\n\t\tudelay(50);\n\t\tcx_set(MO_GP0_IO, 0x00000080);\n\t\tudelay(1000);\n\t\tswitch (core->dvbdev->frontends.active_fe_id) {\n\t\tcase 1:  \n\t\t\t \n\t\t\tcx_set(MO_GP0_IO, 0x00000004);\n\t\t\t \n\t\t\tcx_write(MO_SRST_IO, 1);\n\t\t\tcore->dvbdev->ts_gen_cntrl = 0x02;  \n\t\t\tbreak;\n\t\tcase 2:  \n\t\t\t \n\t\t\tcx_write(MO_SRST_IO, 0);\n\t\t\t \n\t\t\tcx_clear(MO_GP0_IO, 0x00000004);\n\t\t\tcore->dvbdev->ts_gen_cntrl = 0x0c;  \n\t\t\tbreak;\n\t\t}\n\t\tudelay(1000);\n\t\tbreak;\n\n\tcase CX88_BOARD_WINFAST_DTV2000H_PLUS:\n\t\t \n\t\tcx_write(MO_GP2_IO, 0x0101);\n\t\tbreak;\n\n\tdefault:\n\t\terr = -ENODEV;\n\t}\n\treturn err;\n}\n\n \nstatic int cx8802_dvb_advise_release(struct cx8802_driver *drv)\n{\n\tstruct cx88_core *core = drv->core;\n\tint err = 0;\n\n\tdprintk(1, \"%s\\n\", __func__);\n\n\tswitch (core->boardnr) {\n\tcase CX88_BOARD_HAUPPAUGE_HVR1300:\n\t\t \n\t\tbreak;\n\tcase CX88_BOARD_HAUPPAUGE_HVR3000:\n\tcase CX88_BOARD_HAUPPAUGE_HVR4000:\n\t\tbreak;\n\tdefault:\n\t\terr = -ENODEV;\n\t}\n\treturn err;\n}\n\nstatic int cx8802_dvb_probe(struct cx8802_driver *drv)\n{\n\tstruct cx88_core *core = drv->core;\n\tstruct cx8802_dev *dev = drv->core->dvbdev;\n\tint err;\n\tstruct vb2_dvb_frontend *fe;\n\tint i;\n\n\tdprintk(1, \"%s\\n\", __func__);\n\tdprintk(1, \" ->being probed by Card=%d Name=%s, PCI %02x:%02x\\n\",\n\t\tcore->boardnr,\n\t\tcore->name,\n\t\tcore->pci_bus,\n\t\tcore->pci_slot);\n\n\terr = -ENODEV;\n\tif (!(core->board.mpeg & CX88_MPEG_DVB))\n\t\tgoto fail_core;\n\n\t \n\terr = vp3054_i2c_probe(dev);\n\tif (err != 0)\n\t\tgoto fail_core;\n\n\t \n\tpr_info(\"cx2388x based DVB/ATSC card\\n\");\n\tdev->ts_gen_cntrl = 0x0c;\n\n\terr = cx8802_alloc_frontends(dev);\n\tif (err)\n\t\tgoto fail_core;\n\n\tfor (i = 1; i <= core->board.num_frontends; i++) {\n\t\tstruct vb2_queue *q;\n\n\t\tfe = vb2_dvb_get_frontend(&core->dvbdev->frontends, i);\n\t\tif (!fe) {\n\t\t\tpr_err(\"%s() failed to get frontend(%d)\\n\",\n\t\t\t       __func__, i);\n\t\t\terr = -ENODEV;\n\t\t\tgoto fail_probe;\n\t\t}\n\t\tq = &fe->dvb.dvbq;\n\t\tq->type = V4L2_BUF_TYPE_VIDEO_CAPTURE;\n\t\tq->io_modes = VB2_MMAP | VB2_USERPTR | VB2_DMABUF | VB2_READ;\n\t\tq->gfp_flags = GFP_DMA32;\n\t\tq->min_buffers_needed = 2;\n\t\tq->drv_priv = dev;\n\t\tq->buf_struct_size = sizeof(struct cx88_buffer);\n\t\tq->ops = &dvb_qops;\n\t\tq->mem_ops = &vb2_dma_sg_memops;\n\t\tq->timestamp_flags = V4L2_BUF_FLAG_TIMESTAMP_MONOTONIC;\n\t\tq->lock = &core->lock;\n\t\tq->dev = &dev->pci->dev;\n\n\t\terr = vb2_queue_init(q);\n\t\tif (err < 0)\n\t\t\tgoto fail_probe;\n\n\t\t \n\t\tfe->dvb.name = dev->core->name;\n\t}\n\n\terr = dvb_register(dev);\n\tif (err)\n\t\t \n\t\tpr_err(\"dvb_register failed (err = %d)\\n\", err);\n\treturn err;\nfail_probe:\n\tvb2_dvb_dealloc_frontends(&core->dvbdev->frontends);\nfail_core:\n\treturn err;\n}\n\nstatic int cx8802_dvb_remove(struct cx8802_driver *drv)\n{\n\tstruct cx88_core *core = drv->core;\n\tstruct cx8802_dev *dev = drv->core->dvbdev;\n\n\tdprintk(1, \"%s\\n\", __func__);\n\n\tvb2_dvb_unregister_bus(&dev->frontends);\n\n\tvp3054_i2c_remove(dev);\n\n\tcore->gate_ctrl = NULL;\n\n\treturn 0;\n}\n\nstatic struct cx8802_driver cx8802_dvb_driver = {\n\t.type_id        = CX88_MPEG_DVB,\n\t.hw_access      = CX8802_DRVCTL_SHARED,\n\t.probe          = cx8802_dvb_probe,\n\t.remove         = cx8802_dvb_remove,\n\t.advise_acquire = cx8802_dvb_advise_acquire,\n\t.advise_release = cx8802_dvb_advise_release,\n};\n\nstatic int __init dvb_init(void)\n{\n\tpr_info(\"cx2388x dvb driver version %s loaded\\n\", CX88_VERSION);\n\treturn cx8802_register_driver(&cx8802_dvb_driver);\n}\n\nstatic void __exit dvb_fini(void)\n{\n\tcx8802_unregister_driver(&cx8802_dvb_driver);\n}\n\nmodule_init(dvb_init);\nmodule_exit(dvb_fini);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}