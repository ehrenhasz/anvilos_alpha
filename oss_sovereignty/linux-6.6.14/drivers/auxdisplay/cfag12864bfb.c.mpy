{
  "module_name": "cfag12864bfb.c",
  "hash_id": "c42061c5ab06a0737e6edbb75481a3161e1ac9ed4615d4c451bc672fc6746482",
  "original_prompt": "Ingested from linux-6.6.14/drivers/auxdisplay/cfag12864bfb.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/fb.h>\n#include <linux/mm.h>\n#include <linux/platform_device.h>\n#include <linux/cfag12864b.h>\n\n#define CFAG12864BFB_NAME \"cfag12864bfb\"\n\nstatic const struct fb_fix_screeninfo cfag12864bfb_fix = {\n\t.id = \"cfag12864b\",\n\t.type = FB_TYPE_PACKED_PIXELS,\n\t.visual = FB_VISUAL_MONO10,\n\t.xpanstep = 0,\n\t.ypanstep = 0,\n\t.ywrapstep = 0,\n\t.line_length = CFAG12864B_WIDTH / 8,\n\t.accel = FB_ACCEL_NONE,\n};\n\nstatic const struct fb_var_screeninfo cfag12864bfb_var = {\n\t.xres = CFAG12864B_WIDTH,\n\t.yres = CFAG12864B_HEIGHT,\n\t.xres_virtual = CFAG12864B_WIDTH,\n\t.yres_virtual = CFAG12864B_HEIGHT,\n\t.bits_per_pixel = 1,\n\t.red = { 0, 1, 0 },\n\t.green = { 0, 1, 0 },\n\t.blue = { 0, 1, 0 },\n\t.left_margin = 0,\n\t.right_margin = 0,\n\t.upper_margin = 0,\n\t.lower_margin = 0,\n\t.vmode = FB_VMODE_NONINTERLACED,\n};\n\nstatic int cfag12864bfb_mmap(struct fb_info *info, struct vm_area_struct *vma)\n{\n\tstruct page *pages = virt_to_page(cfag12864b_buffer);\n\n\treturn vm_map_pages_zero(vma, &pages, 1);\n}\n\nstatic const struct fb_ops cfag12864bfb_ops = {\n\t.owner = THIS_MODULE,\n\t.fb_read = fb_sys_read,\n\t.fb_write = fb_sys_write,\n\t.fb_fillrect = sys_fillrect,\n\t.fb_copyarea = sys_copyarea,\n\t.fb_imageblit = sys_imageblit,\n\t.fb_mmap = cfag12864bfb_mmap,\n};\n\nstatic int cfag12864bfb_probe(struct platform_device *device)\n{\n\tint ret = -EINVAL;\n\tstruct fb_info *info = framebuffer_alloc(0, &device->dev);\n\n\tif (!info)\n\t\tgoto none;\n\n\tinfo->screen_buffer = cfag12864b_buffer;\n\tinfo->screen_size = CFAG12864B_SIZE;\n\tinfo->fbops = &cfag12864bfb_ops;\n\tinfo->fix = cfag12864bfb_fix;\n\tinfo->var = cfag12864bfb_var;\n\tinfo->pseudo_palette = NULL;\n\tinfo->par = NULL;\n\n\tif (register_framebuffer(info) < 0)\n\t\tgoto fballoced;\n\n\tplatform_set_drvdata(device, info);\n\n\tfb_info(info, \"%s frame buffer device\\n\", info->fix.id);\n\n\treturn 0;\n\nfballoced:\n\tframebuffer_release(info);\n\nnone:\n\treturn ret;\n}\n\nstatic int cfag12864bfb_remove(struct platform_device *device)\n{\n\tstruct fb_info *info = platform_get_drvdata(device);\n\n\tif (info) {\n\t\tunregister_framebuffer(info);\n\t\tframebuffer_release(info);\n\t}\n\n\treturn 0;\n}\n\nstatic struct platform_driver cfag12864bfb_driver = {\n\t.probe\t= cfag12864bfb_probe,\n\t.remove = cfag12864bfb_remove,\n\t.driver = {\n\t\t.name\t= CFAG12864BFB_NAME,\n\t},\n};\n\nstatic struct platform_device *cfag12864bfb_device;\n\nstatic int __init cfag12864bfb_init(void)\n{\n\tint ret = -EINVAL;\n\n\t \n\tif (!cfag12864b_isinited()) {\n\t\tprintk(KERN_ERR CFAG12864BFB_NAME \": ERROR: \"\n\t\t\t\"cfag12864b is not initialized\\n\");\n\t\tgoto none;\n\t}\n\n\tif (cfag12864b_enable()) {\n\t\tprintk(KERN_ERR CFAG12864BFB_NAME \": ERROR: \"\n\t\t\t\"can't enable cfag12864b refreshing (being used)\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tret = platform_driver_register(&cfag12864bfb_driver);\n\n\tif (!ret) {\n\t\tcfag12864bfb_device =\n\t\t\tplatform_device_alloc(CFAG12864BFB_NAME, 0);\n\n\t\tif (cfag12864bfb_device)\n\t\t\tret = platform_device_add(cfag12864bfb_device);\n\t\telse\n\t\t\tret = -ENOMEM;\n\n\t\tif (ret) {\n\t\t\tplatform_device_put(cfag12864bfb_device);\n\t\t\tplatform_driver_unregister(&cfag12864bfb_driver);\n\t\t}\n\t}\n\nnone:\n\treturn ret;\n}\n\nstatic void __exit cfag12864bfb_exit(void)\n{\n\tplatform_device_unregister(cfag12864bfb_device);\n\tplatform_driver_unregister(&cfag12864bfb_driver);\n\tcfag12864b_disable();\n}\n\nmodule_init(cfag12864bfb_init);\nmodule_exit(cfag12864bfb_exit);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_AUTHOR(\"Miguel Ojeda <ojeda@kernel.org>\");\nMODULE_DESCRIPTION(\"cfag12864b LCD framebuffer driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}