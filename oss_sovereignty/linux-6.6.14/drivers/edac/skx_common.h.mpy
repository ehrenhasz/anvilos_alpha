{
  "module_name": "skx_common.h",
  "hash_id": "b4567c5786a4c79c03e8bfc6d80864713dd13538683db1b4f6b3e0448eb02230",
  "original_prompt": "Ingested from linux-6.6.14/drivers/edac/skx_common.h",
  "human_readable_source": " \n \n\n#ifndef _SKX_COMM_EDAC_H\n#define _SKX_COMM_EDAC_H\n\n#include <linux/bits.h>\n#include <asm/mce.h>\n\n#define MSG_SIZE\t\t1024\n\n \n#define skx_printk(level, fmt, arg...)\t\t\t\\\n\tedac_printk(level, \"skx\", fmt, ##arg)\n\n#define skx_mc_printk(mci, level, fmt, arg...)\t\t\\\n\tedac_mc_chipset_printk(mci, level, \"skx\", fmt, ##arg)\n\n \n#define GET_BITFIELD(v, lo, hi) \\\n\t(((v) & GENMASK_ULL((hi), (lo))) >> (lo))\n\n#define SKX_NUM_IMC\t\t2\t \n#define SKX_NUM_CHANNELS\t3\t \n#define SKX_NUM_DIMMS\t\t2\t \n\n#define I10NM_NUM_DDR_IMC\t12\n#define I10NM_NUM_DDR_CHANNELS\t2\n#define I10NM_NUM_DDR_DIMMS\t2\n\n#define I10NM_NUM_HBM_IMC\t16\n#define I10NM_NUM_HBM_CHANNELS\t2\n#define I10NM_NUM_HBM_DIMMS\t1\n\n#define I10NM_NUM_IMC\t\t(I10NM_NUM_DDR_IMC + I10NM_NUM_HBM_IMC)\n#define I10NM_NUM_CHANNELS\tMAX(I10NM_NUM_DDR_CHANNELS, I10NM_NUM_HBM_CHANNELS)\n#define I10NM_NUM_DIMMS\t\tMAX(I10NM_NUM_DDR_DIMMS, I10NM_NUM_HBM_DIMMS)\n\n#define MAX(a, b)\t((a) > (b) ? (a) : (b))\n#define NUM_IMC\t\tMAX(SKX_NUM_IMC, I10NM_NUM_IMC)\n#define NUM_CHANNELS\tMAX(SKX_NUM_CHANNELS, I10NM_NUM_CHANNELS)\n#define NUM_DIMMS\tMAX(SKX_NUM_DIMMS, I10NM_NUM_DIMMS)\n\n#define IS_DIMM_PRESENT(r)\t\tGET_BITFIELD(r, 15, 15)\n#define IS_NVDIMM_PRESENT(r, i)\t\tGET_BITFIELD(r, i, i)\n\n#define MCI_MISC_ECC_MODE(m)\t(((m) >> 59) & 15)\n#define MCI_MISC_ECC_DDRT\t8\t \n\n \n#define MCACOD_MEM_ERR_MASK\t0xef80\n \n#define MCACOD_MEM_CTL_ERR\t0x80\n \n#define MCACOD_EXT_MEM_ERR\t0x280\n\n \nstruct skx_dev {\n\tstruct list_head list;\n\tu8 bus[4];\n\tint seg;\n\tstruct pci_dev *sad_all;\n\tstruct pci_dev *util_all;\n\tstruct pci_dev *uracu;  \n\tstruct pci_dev *pcu_cr3;  \n\tu32 mcroute;\n\tstruct skx_imc {\n\t\tstruct mem_ctl_info *mci;\n\t\tstruct pci_dev *mdev;  \n\t\tvoid __iomem *mbase;   \n\t\tint chan_mmio_sz;      \n\t\tint num_channels;  \n\t\tint num_dimms;  \n\t\tbool hbm_mc;\n\t\tu8 mc;\t \n\t\tu8 lmc;\t \n\t\tu8 src_id, node_id;\n\t\tstruct skx_channel {\n\t\t\tstruct pci_dev\t*cdev;\n\t\t\tstruct pci_dev\t*edev;\n\t\t\tu32 retry_rd_err_log_s;\n\t\t\tu32 retry_rd_err_log_d;\n\t\t\tu32 retry_rd_err_log_d2;\n\t\t\tstruct skx_dimm {\n\t\t\t\tu8 close_pg;\n\t\t\t\tu8 bank_xor_enable;\n\t\t\t\tu8 fine_grain_bank;\n\t\t\t\tu8 rowbits;\n\t\t\t\tu8 colbits;\n\t\t\t} dimms[NUM_DIMMS];\n\t\t} chan[NUM_CHANNELS];\n\t} imc[NUM_IMC];\n};\n\nstruct skx_pvt {\n\tstruct skx_imc\t*imc;\n};\n\nenum type {\n\tSKX,\n\tI10NM,\n\tSPR,\n\tGNR\n};\n\nenum {\n\tINDEX_SOCKET,\n\tINDEX_MEMCTRL,\n\tINDEX_CHANNEL,\n\tINDEX_DIMM,\n\tINDEX_CS,\n\tINDEX_NM_FIRST,\n\tINDEX_NM_MEMCTRL = INDEX_NM_FIRST,\n\tINDEX_NM_CHANNEL,\n\tINDEX_NM_DIMM,\n\tINDEX_NM_CS,\n\tINDEX_MAX\n};\n\n#define BIT_NM_MEMCTRL\tBIT_ULL(INDEX_NM_MEMCTRL)\n#define BIT_NM_CHANNEL\tBIT_ULL(INDEX_NM_CHANNEL)\n#define BIT_NM_DIMM\tBIT_ULL(INDEX_NM_DIMM)\n#define BIT_NM_CS\tBIT_ULL(INDEX_NM_CS)\n\nstruct decoded_addr {\n\tstruct mce *mce;\n\tstruct skx_dev *dev;\n\tu64\taddr;\n\tint\tsocket;\n\tint\timc;\n\tint\tchannel;\n\tu64\tchan_addr;\n\tint\tsktways;\n\tint\tchanways;\n\tint\tdimm;\n\tint\tcs;\n\tint\trank;\n\tint\tchannel_rank;\n\tu64\trank_address;\n\tint\trow;\n\tint\tcolumn;\n\tint\tbank_address;\n\tint\tbank_group;\n\tbool\tdecoded_by_adxl;\n};\n\nstruct pci_bdf {\n\tu32 bus : 8;\n\tu32 dev : 5;\n\tu32 fun : 3;\n};\n\nstruct res_config {\n\tenum type type;\n\t \n\tunsigned int decs_did;\n\t \n\tint busno_cfg_offset;\n\t \n\tint ddr_imc_num;\n\t \n\tint ddr_chan_num;\n\t \n\tint ddr_dimm_num;\n\t \n\tint ddr_chan_mmio_sz;\n\t \n\tint hbm_imc_num;\n\t \n\tint hbm_chan_num;\n\t \n\tint hbm_dimm_num;\n\t \n\tint hbm_chan_mmio_sz;\n\tbool support_ddr5;\n\t \n\tstruct pci_bdf sad_all_bdf;\n\t \n\tstruct pci_bdf pcu_cr3_bdf;\n\t \n\tstruct pci_bdf util_all_bdf;\n\t \n\tstruct pci_bdf uracu_bdf;\n\t \n\tstruct pci_bdf ddr_mdev_bdf;\n\t \n\tstruct pci_bdf hbm_mdev_bdf;\n\tint sad_all_offset;\n\t \n\tu32 *offsets_scrub;\n\tu32 *offsets_scrub_hbm0;\n\tu32 *offsets_scrub_hbm1;\n\tu32 *offsets_demand;\n\tu32 *offsets_demand2;\n\tu32 *offsets_demand_hbm0;\n\tu32 *offsets_demand_hbm1;\n};\n\ntypedef int (*get_dimm_config_f)(struct mem_ctl_info *mci,\n\t\t\t\t struct res_config *cfg);\ntypedef bool (*skx_decode_f)(struct decoded_addr *res);\ntypedef void (*skx_show_retry_log_f)(struct decoded_addr *res, char *msg, int len, bool scrub_err);\n\nint __init skx_adxl_get(void);\nvoid __exit skx_adxl_put(void);\nvoid skx_set_decode(skx_decode_f decode, skx_show_retry_log_f show_retry_log);\nvoid skx_set_mem_cfg(bool mem_cfg_2lm);\n\nint skx_get_src_id(struct skx_dev *d, int off, u8 *id);\nint skx_get_node_id(struct skx_dev *d, u8 *id);\n\nint skx_get_all_bus_mappings(struct res_config *cfg, struct list_head **list);\n\nint skx_get_hi_lo(unsigned int did, int off[], u64 *tolm, u64 *tohm);\n\nint skx_get_dimm_info(u32 mtr, u32 mcmtr, u32 amap, struct dimm_info *dimm,\n\t\t      struct skx_imc *imc, int chan, int dimmno,\n\t\t      struct res_config *cfg);\n\nint skx_get_nvdimm_info(struct dimm_info *dimm, struct skx_imc *imc,\n\t\t\tint chan, int dimmno, const char *mod_str);\n\nint skx_register_mci(struct skx_imc *imc, struct pci_dev *pdev,\n\t\t     const char *ctl_name, const char *mod_str,\n\t\t     get_dimm_config_f get_dimm_config,\n\t\t     struct res_config *cfg);\n\nint skx_mce_check_error(struct notifier_block *nb, unsigned long val,\n\t\t\tvoid *data);\n\nvoid skx_remove(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}