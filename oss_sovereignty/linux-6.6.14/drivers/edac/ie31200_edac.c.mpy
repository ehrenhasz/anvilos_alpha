{
  "module_name": "ie31200_edac.c",
  "hash_id": "af8869156ba5f0a39b658a32d12529ca0d14b85379d31ce19a3ea6e181805eae",
  "original_prompt": "Ingested from linux-6.6.14/drivers/edac/ie31200_edac.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/pci.h>\n#include <linux/pci_ids.h>\n#include <linux/edac.h>\n\n#include <linux/io-64-nonatomic-lo-hi.h>\n#include \"edac_module.h\"\n\n#define EDAC_MOD_STR \"ie31200_edac\"\n\n#define ie31200_printk(level, fmt, arg...) \\\n\tedac_printk(level, \"ie31200\", fmt, ##arg)\n\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_1  0x0108\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_2  0x010c\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_3  0x0150\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_4  0x0158\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_5  0x015c\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_6  0x0c04\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_7  0x0c08\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_8  0x190F\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_9  0x1918\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_10 0x191F\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_11 0x5918\n\n \n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_MASK 0x3e00\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_1    0x3e0f\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_2    0x3e18\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_3    0x3e1f\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_4    0x3e30\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_5    0x3e31\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_6    0x3e32\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_7    0x3e33\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_8    0x3ec2\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_9    0x3ec6\n#define PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_10   0x3eca\n\n \n#define DEVICE_ID_SKYLAKE_OR_LATER(did)                                        \\\n\t(((did) == PCI_DEVICE_ID_INTEL_IE31200_HB_8) ||                        \\\n\t ((did) == PCI_DEVICE_ID_INTEL_IE31200_HB_9) ||                        \\\n\t ((did) == PCI_DEVICE_ID_INTEL_IE31200_HB_10) ||                       \\\n\t ((did) == PCI_DEVICE_ID_INTEL_IE31200_HB_11) ||                       \\\n\t (((did) & PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_MASK) ==                 \\\n\t  PCI_DEVICE_ID_INTEL_IE31200_HB_CFL_MASK))\n\n#define IE31200_DIMMS\t\t\t4\n#define IE31200_RANKS\t\t\t8\n#define IE31200_RANKS_PER_CHANNEL\t4\n#define IE31200_DIMMS_PER_CHANNEL\t2\n#define IE31200_CHANNELS\t\t2\n\n \n#define IE31200_MCHBAR_LOW\t\t0x48\n#define IE31200_MCHBAR_HIGH\t\t0x4c\n#define IE31200_MCHBAR_MASK\t\tGENMASK_ULL(38, 15)\n#define IE31200_MMR_WINDOW_SIZE\t\tBIT(15)\n\n \n#define IE31200_ERRSTS\t\t\t0xc8\n#define IE31200_ERRSTS_UE\t\tBIT(1)\n#define IE31200_ERRSTS_CE\t\tBIT(0)\n#define IE31200_ERRSTS_BITS\t\t(IE31200_ERRSTS_UE | IE31200_ERRSTS_CE)\n\n \n\n#define IE31200_C0ECCERRLOG\t\t\t0x40c8\n#define IE31200_C1ECCERRLOG\t\t\t0x44c8\n#define IE31200_C0ECCERRLOG_SKL\t\t\t0x4048\n#define IE31200_C1ECCERRLOG_SKL\t\t\t0x4448\n#define IE31200_ECCERRLOG_CE\t\t\tBIT(0)\n#define IE31200_ECCERRLOG_UE\t\t\tBIT(1)\n#define IE31200_ECCERRLOG_RANK_BITS\t\tGENMASK_ULL(28, 27)\n#define IE31200_ECCERRLOG_RANK_SHIFT\t\t27\n#define IE31200_ECCERRLOG_SYNDROME_BITS\t\tGENMASK_ULL(23, 16)\n#define IE31200_ECCERRLOG_SYNDROME_SHIFT\t16\n\n#define IE31200_ECCERRLOG_SYNDROME(log)\t\t   \\\n\t((log & IE31200_ECCERRLOG_SYNDROME_BITS) >> \\\n\t IE31200_ECCERRLOG_SYNDROME_SHIFT)\n\n#define IE31200_CAPID0\t\t\t0xe4\n#define IE31200_CAPID0_PDCD\t\tBIT(4)\n#define IE31200_CAPID0_DDPCD\t\tBIT(6)\n#define IE31200_CAPID0_ECC\t\tBIT(1)\n\n#define IE31200_MAD_DIMM_0_OFFSET\t\t0x5004\n#define IE31200_MAD_DIMM_0_OFFSET_SKL\t\t0x500C\n#define IE31200_MAD_DIMM_SIZE\t\t\tGENMASK_ULL(7, 0)\n#define IE31200_MAD_DIMM_A_RANK\t\t\tBIT(17)\n#define IE31200_MAD_DIMM_A_RANK_SHIFT\t\t17\n#define IE31200_MAD_DIMM_A_RANK_SKL\t\tBIT(10)\n#define IE31200_MAD_DIMM_A_RANK_SKL_SHIFT\t10\n#define IE31200_MAD_DIMM_A_WIDTH\t\tBIT(19)\n#define IE31200_MAD_DIMM_A_WIDTH_SHIFT\t\t19\n#define IE31200_MAD_DIMM_A_WIDTH_SKL\t\tGENMASK_ULL(9, 8)\n#define IE31200_MAD_DIMM_A_WIDTH_SKL_SHIFT\t8\n\n \n#define IE31200_PAGES(n, skl)\t\\\n\t(n << (28 + (2 * skl) - PAGE_SHIFT))\n\nstatic int nr_channels;\nstatic struct pci_dev *mci_pdev;\nstatic int ie31200_registered = 1;\n\nstruct ie31200_priv {\n\tvoid __iomem *window;\n\tvoid __iomem *c0errlog;\n\tvoid __iomem *c1errlog;\n};\n\nenum ie31200_chips {\n\tIE31200 = 0,\n};\n\nstruct ie31200_dev_info {\n\tconst char *ctl_name;\n};\n\nstruct ie31200_error_info {\n\tu16 errsts;\n\tu16 errsts2;\n\tu64 eccerrlog[IE31200_CHANNELS];\n};\n\nstatic const struct ie31200_dev_info ie31200_devs[] = {\n\t[IE31200] = {\n\t\t.ctl_name = \"IE31200\"\n\t},\n};\n\nstruct dimm_data {\n\tu8 size;  \n\tu8 dual_rank : 1,\n\t   x16_width : 2;  \n};\n\nstatic int how_many_channels(struct pci_dev *pdev)\n{\n\tint n_channels;\n\tunsigned char capid0_2b;  \n\n\tpci_read_config_byte(pdev, IE31200_CAPID0 + 1, &capid0_2b);\n\n\t \n\tif (capid0_2b & IE31200_CAPID0_PDCD) {\n\t\tedac_dbg(0, \"In single channel mode\\n\");\n\t\tn_channels = 1;\n\t} else {\n\t\tedac_dbg(0, \"In dual channel mode\\n\");\n\t\tn_channels = 2;\n\t}\n\n\t \n\tif (capid0_2b & IE31200_CAPID0_DDPCD)\n\t\tedac_dbg(0, \"2 DIMMS per channel disabled\\n\");\n\telse\n\t\tedac_dbg(0, \"2 DIMMS per channel enabled\\n\");\n\n\treturn n_channels;\n}\n\nstatic bool ecc_capable(struct pci_dev *pdev)\n{\n\tunsigned char capid0_4b;  \n\n\tpci_read_config_byte(pdev, IE31200_CAPID0 + 3, &capid0_4b);\n\tif (capid0_4b & IE31200_CAPID0_ECC)\n\t\treturn false;\n\treturn true;\n}\n\nstatic int eccerrlog_row(u64 log)\n{\n\treturn ((log & IE31200_ECCERRLOG_RANK_BITS) >>\n\t\t\t\tIE31200_ECCERRLOG_RANK_SHIFT);\n}\n\nstatic void ie31200_clear_error_info(struct mem_ctl_info *mci)\n{\n\t \n\tpci_write_bits16(to_pci_dev(mci->pdev), IE31200_ERRSTS,\n\t\t\t IE31200_ERRSTS_BITS, IE31200_ERRSTS_BITS);\n}\n\nstatic void ie31200_get_and_clear_error_info(struct mem_ctl_info *mci,\n\t\t\t\t\t     struct ie31200_error_info *info)\n{\n\tstruct pci_dev *pdev;\n\tstruct ie31200_priv *priv = mci->pvt_info;\n\n\tpdev = to_pci_dev(mci->pdev);\n\n\t \n\tpci_read_config_word(pdev, IE31200_ERRSTS, &info->errsts);\n\tif (!(info->errsts & IE31200_ERRSTS_BITS))\n\t\treturn;\n\n\tinfo->eccerrlog[0] = lo_hi_readq(priv->c0errlog);\n\tif (nr_channels == 2)\n\t\tinfo->eccerrlog[1] = lo_hi_readq(priv->c1errlog);\n\n\tpci_read_config_word(pdev, IE31200_ERRSTS, &info->errsts2);\n\n\t \n\tif ((info->errsts ^ info->errsts2) & IE31200_ERRSTS_BITS) {\n\t\tinfo->eccerrlog[0] = lo_hi_readq(priv->c0errlog);\n\t\tif (nr_channels == 2)\n\t\t\tinfo->eccerrlog[1] =\n\t\t\t\tlo_hi_readq(priv->c1errlog);\n\t}\n\n\tie31200_clear_error_info(mci);\n}\n\nstatic void ie31200_process_error_info(struct mem_ctl_info *mci,\n\t\t\t\t       struct ie31200_error_info *info)\n{\n\tint channel;\n\tu64 log;\n\n\tif (!(info->errsts & IE31200_ERRSTS_BITS))\n\t\treturn;\n\n\tif ((info->errsts ^ info->errsts2) & IE31200_ERRSTS_BITS) {\n\t\tedac_mc_handle_error(HW_EVENT_ERR_UNCORRECTED, mci, 1, 0, 0, 0,\n\t\t\t\t     -1, -1, -1, \"UE overwrote CE\", \"\");\n\t\tinfo->errsts = info->errsts2;\n\t}\n\n\tfor (channel = 0; channel < nr_channels; channel++) {\n\t\tlog = info->eccerrlog[channel];\n\t\tif (log & IE31200_ECCERRLOG_UE) {\n\t\t\tedac_mc_handle_error(HW_EVENT_ERR_UNCORRECTED, mci, 1,\n\t\t\t\t\t     0, 0, 0,\n\t\t\t\t\t     eccerrlog_row(log),\n\t\t\t\t\t     channel, -1,\n\t\t\t\t\t     \"ie31200 UE\", \"\");\n\t\t} else if (log & IE31200_ECCERRLOG_CE) {\n\t\t\tedac_mc_handle_error(HW_EVENT_ERR_CORRECTED, mci, 1,\n\t\t\t\t\t     0, 0,\n\t\t\t\t\t     IE31200_ECCERRLOG_SYNDROME(log),\n\t\t\t\t\t     eccerrlog_row(log),\n\t\t\t\t\t     channel, -1,\n\t\t\t\t\t     \"ie31200 CE\", \"\");\n\t\t}\n\t}\n}\n\nstatic void ie31200_check(struct mem_ctl_info *mci)\n{\n\tstruct ie31200_error_info info;\n\n\tie31200_get_and_clear_error_info(mci, &info);\n\tie31200_process_error_info(mci, &info);\n}\n\nstatic void __iomem *ie31200_map_mchbar(struct pci_dev *pdev)\n{\n\tunion {\n\t\tu64 mchbar;\n\t\tstruct {\n\t\t\tu32 mchbar_low;\n\t\t\tu32 mchbar_high;\n\t\t};\n\t} u;\n\tvoid __iomem *window;\n\n\tpci_read_config_dword(pdev, IE31200_MCHBAR_LOW, &u.mchbar_low);\n\tpci_read_config_dword(pdev, IE31200_MCHBAR_HIGH, &u.mchbar_high);\n\tu.mchbar &= IE31200_MCHBAR_MASK;\n\n\tif (u.mchbar != (resource_size_t)u.mchbar) {\n\t\tie31200_printk(KERN_ERR, \"mmio space beyond accessible range (0x%llx)\\n\",\n\t\t\t       (unsigned long long)u.mchbar);\n\t\treturn NULL;\n\t}\n\n\twindow = ioremap(u.mchbar, IE31200_MMR_WINDOW_SIZE);\n\tif (!window)\n\t\tie31200_printk(KERN_ERR, \"Cannot map mmio space at 0x%llx\\n\",\n\t\t\t       (unsigned long long)u.mchbar);\n\n\treturn window;\n}\n\nstatic void __skl_populate_dimm_info(struct dimm_data *dd, u32 addr_decode,\n\t\t\t\t     int chan)\n{\n\tdd->size = (addr_decode >> (chan << 4)) & IE31200_MAD_DIMM_SIZE;\n\tdd->dual_rank = (addr_decode & (IE31200_MAD_DIMM_A_RANK_SKL << (chan << 4))) ? 1 : 0;\n\tdd->x16_width = ((addr_decode & (IE31200_MAD_DIMM_A_WIDTH_SKL << (chan << 4))) >>\n\t\t\t\t(IE31200_MAD_DIMM_A_WIDTH_SKL_SHIFT + (chan << 4)));\n}\n\nstatic void __populate_dimm_info(struct dimm_data *dd, u32 addr_decode,\n\t\t\t\t int chan)\n{\n\tdd->size = (addr_decode >> (chan << 3)) & IE31200_MAD_DIMM_SIZE;\n\tdd->dual_rank = (addr_decode & (IE31200_MAD_DIMM_A_RANK << chan)) ? 1 : 0;\n\tdd->x16_width = (addr_decode & (IE31200_MAD_DIMM_A_WIDTH << chan)) ? 1 : 0;\n}\n\nstatic void populate_dimm_info(struct dimm_data *dd, u32 addr_decode, int chan,\n\t\t\t       bool skl)\n{\n\tif (skl)\n\t\t__skl_populate_dimm_info(dd, addr_decode, chan);\n\telse\n\t\t__populate_dimm_info(dd, addr_decode, chan);\n}\n\n\nstatic int ie31200_probe1(struct pci_dev *pdev, int dev_idx)\n{\n\tint i, j, ret;\n\tstruct mem_ctl_info *mci = NULL;\n\tstruct edac_mc_layer layers[2];\n\tstruct dimm_data dimm_info[IE31200_CHANNELS][IE31200_DIMMS_PER_CHANNEL];\n\tvoid __iomem *window;\n\tstruct ie31200_priv *priv;\n\tu32 addr_decode, mad_offset;\n\n\t \n\tbool skl = DEVICE_ID_SKYLAKE_OR_LATER(pdev->device);\n\n\tedac_dbg(0, \"MC:\\n\");\n\n\tif (!ecc_capable(pdev)) {\n\t\tie31200_printk(KERN_INFO, \"No ECC support\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tnr_channels = how_many_channels(pdev);\n\tlayers[0].type = EDAC_MC_LAYER_CHIP_SELECT;\n\tlayers[0].size = IE31200_DIMMS;\n\tlayers[0].is_virt_csrow = true;\n\tlayers[1].type = EDAC_MC_LAYER_CHANNEL;\n\tlayers[1].size = nr_channels;\n\tlayers[1].is_virt_csrow = false;\n\tmci = edac_mc_alloc(0, ARRAY_SIZE(layers), layers,\n\t\t\t    sizeof(struct ie31200_priv));\n\tif (!mci)\n\t\treturn -ENOMEM;\n\n\twindow = ie31200_map_mchbar(pdev);\n\tif (!window) {\n\t\tret = -ENODEV;\n\t\tgoto fail_free;\n\t}\n\n\tedac_dbg(3, \"MC: init mci\\n\");\n\tmci->pdev = &pdev->dev;\n\tif (skl)\n\t\tmci->mtype_cap = MEM_FLAG_DDR4;\n\telse\n\t\tmci->mtype_cap = MEM_FLAG_DDR3;\n\tmci->edac_ctl_cap = EDAC_FLAG_SECDED;\n\tmci->edac_cap = EDAC_FLAG_SECDED;\n\tmci->mod_name = EDAC_MOD_STR;\n\tmci->ctl_name = ie31200_devs[dev_idx].ctl_name;\n\tmci->dev_name = pci_name(pdev);\n\tmci->edac_check = ie31200_check;\n\tmci->ctl_page_to_phys = NULL;\n\tpriv = mci->pvt_info;\n\tpriv->window = window;\n\tif (skl) {\n\t\tpriv->c0errlog = window + IE31200_C0ECCERRLOG_SKL;\n\t\tpriv->c1errlog = window + IE31200_C1ECCERRLOG_SKL;\n\t\tmad_offset = IE31200_MAD_DIMM_0_OFFSET_SKL;\n\t} else {\n\t\tpriv->c0errlog = window + IE31200_C0ECCERRLOG;\n\t\tpriv->c1errlog = window + IE31200_C1ECCERRLOG;\n\t\tmad_offset = IE31200_MAD_DIMM_0_OFFSET;\n\t}\n\n\t \n\tfor (i = 0; i < IE31200_CHANNELS; i++) {\n\t\taddr_decode = readl(window + mad_offset +\n\t\t\t\t\t(i * 4));\n\t\tedac_dbg(0, \"addr_decode: 0x%x\\n\", addr_decode);\n\t\tfor (j = 0; j < IE31200_DIMMS_PER_CHANNEL; j++) {\n\t\t\tpopulate_dimm_info(&dimm_info[i][j], addr_decode, j,\n\t\t\t\t\t   skl);\n\t\t\tedac_dbg(0, \"size: 0x%x, rank: %d, width: %d\\n\",\n\t\t\t\t dimm_info[i][j].size,\n\t\t\t\t dimm_info[i][j].dual_rank,\n\t\t\t\t dimm_info[i][j].x16_width);\n\t\t}\n\t}\n\n\t \n\tfor (i = 0; i < IE31200_DIMMS_PER_CHANNEL; i++) {\n\t\tfor (j = 0; j < IE31200_CHANNELS; j++) {\n\t\t\tstruct dimm_info *dimm;\n\t\t\tunsigned long nr_pages;\n\n\t\t\tnr_pages = IE31200_PAGES(dimm_info[j][i].size, skl);\n\t\t\tif (nr_pages == 0)\n\t\t\t\tcontinue;\n\n\t\t\tif (dimm_info[j][i].dual_rank) {\n\t\t\t\tnr_pages = nr_pages / 2;\n\t\t\t\tdimm = edac_get_dimm(mci, (i * 2) + 1, j, 0);\n\t\t\t\tdimm->nr_pages = nr_pages;\n\t\t\t\tedac_dbg(0, \"set nr pages: 0x%lx\\n\", nr_pages);\n\t\t\t\tdimm->grain = 8;  \n\t\t\t\tif (skl)\n\t\t\t\t\tdimm->mtype = MEM_DDR4;\n\t\t\t\telse\n\t\t\t\t\tdimm->mtype = MEM_DDR3;\n\t\t\t\tdimm->dtype = DEV_UNKNOWN;\n\t\t\t\tdimm->edac_mode = EDAC_UNKNOWN;\n\t\t\t}\n\t\t\tdimm = edac_get_dimm(mci, i * 2, j, 0);\n\t\t\tdimm->nr_pages = nr_pages;\n\t\t\tedac_dbg(0, \"set nr pages: 0x%lx\\n\", nr_pages);\n\t\t\tdimm->grain = 8;  \n\t\t\tif (skl)\n\t\t\t\tdimm->mtype = MEM_DDR4;\n\t\t\telse\n\t\t\t\tdimm->mtype = MEM_DDR3;\n\t\t\tdimm->dtype = DEV_UNKNOWN;\n\t\t\tdimm->edac_mode = EDAC_UNKNOWN;\n\t\t}\n\t}\n\n\tie31200_clear_error_info(mci);\n\n\tif (edac_mc_add_mc(mci)) {\n\t\tedac_dbg(3, \"MC: failed edac_mc_add_mc()\\n\");\n\t\tret = -ENODEV;\n\t\tgoto fail_unmap;\n\t}\n\n\t \n\tedac_dbg(3, \"MC: success\\n\");\n\treturn 0;\n\nfail_unmap:\n\tiounmap(window);\n\nfail_free:\n\tedac_mc_free(mci);\n\n\treturn ret;\n}\n\nstatic int ie31200_init_one(struct pci_dev *pdev,\n\t\t\t    const struct pci_device_id *ent)\n{\n\tint rc;\n\n\tedac_dbg(0, \"MC:\\n\");\n\tif (pci_enable_device(pdev) < 0)\n\t\treturn -EIO;\n\trc = ie31200_probe1(pdev, ent->driver_data);\n\tif (rc == 0 && !mci_pdev)\n\t\tmci_pdev = pci_dev_get(pdev);\n\n\treturn rc;\n}\n\nstatic void ie31200_remove_one(struct pci_dev *pdev)\n{\n\tstruct mem_ctl_info *mci;\n\tstruct ie31200_priv *priv;\n\n\tedac_dbg(0, \"\\n\");\n\tpci_dev_put(mci_pdev);\n\tmci_pdev = NULL;\n\tmci = edac_mc_del_mc(&pdev->dev);\n\tif (!mci)\n\t\treturn;\n\tpriv = mci->pvt_info;\n\tiounmap(priv->window);\n\tedac_mc_free(mci);\n}\n\nstatic const struct pci_device_id ie31200_pci_tbl[] = {\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_1),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_2),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_3),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_4),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_5),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_6),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_7),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_8),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_9),      PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_10),     PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_11),     PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_1),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_2),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_3),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_4),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_5),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_6),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_7),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_8),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_9),  PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ PCI_VEND_DEV(INTEL, IE31200_HB_CFL_10), PCI_ANY_ID, PCI_ANY_ID, 0, 0, IE31200 },\n\t{ 0, }  \n};\nMODULE_DEVICE_TABLE(pci, ie31200_pci_tbl);\n\nstatic struct pci_driver ie31200_driver = {\n\t.name = EDAC_MOD_STR,\n\t.probe = ie31200_init_one,\n\t.remove = ie31200_remove_one,\n\t.id_table = ie31200_pci_tbl,\n};\n\nstatic int __init ie31200_init(void)\n{\n\tint pci_rc, i;\n\n\tedac_dbg(3, \"MC:\\n\");\n\t \n\topstate_init();\n\n\tpci_rc = pci_register_driver(&ie31200_driver);\n\tif (pci_rc < 0)\n\t\tgoto fail0;\n\n\tif (!mci_pdev) {\n\t\tie31200_registered = 0;\n\t\tfor (i = 0; ie31200_pci_tbl[i].vendor != 0; i++) {\n\t\t\tmci_pdev = pci_get_device(ie31200_pci_tbl[i].vendor,\n\t\t\t\t\t\t  ie31200_pci_tbl[i].device,\n\t\t\t\t\t\t  NULL);\n\t\t\tif (mci_pdev)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (!mci_pdev) {\n\t\t\tedac_dbg(0, \"ie31200 pci_get_device fail\\n\");\n\t\t\tpci_rc = -ENODEV;\n\t\t\tgoto fail1;\n\t\t}\n\t\tpci_rc = ie31200_init_one(mci_pdev, &ie31200_pci_tbl[i]);\n\t\tif (pci_rc < 0) {\n\t\t\tedac_dbg(0, \"ie31200 init fail\\n\");\n\t\t\tpci_rc = -ENODEV;\n\t\t\tgoto fail1;\n\t\t}\n\t}\n\treturn 0;\n\nfail1:\n\tpci_unregister_driver(&ie31200_driver);\nfail0:\n\tpci_dev_put(mci_pdev);\n\n\treturn pci_rc;\n}\n\nstatic void __exit ie31200_exit(void)\n{\n\tedac_dbg(3, \"MC:\\n\");\n\tpci_unregister_driver(&ie31200_driver);\n\tif (!ie31200_registered)\n\t\tie31200_remove_one(mci_pdev);\n}\n\nmodule_init(ie31200_init);\nmodule_exit(ie31200_exit);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Jason Baron <jbaron@akamai.com>\");\nMODULE_DESCRIPTION(\"MC support for Intel Processor E31200 memory hub controllers\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}