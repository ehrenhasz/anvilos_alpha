{
  "module_name": "octeon_edac-l2c.c",
  "hash_id": "b857f86e2a74d4b9eaba4e15f6c96f2ab444a9d0567fc2532e6de4e85691900e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/edac/octeon_edac-l2c.c",
  "human_readable_source": " \n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n#include <linux/edac.h>\n\n#include <asm/octeon/cvmx.h>\n\n#include \"edac_module.h\"\n\n#define EDAC_MOD_STR \"octeon-l2c\"\n\nstatic void octeon_l2c_poll_oct1(struct edac_device_ctl_info *l2c)\n{\n\tunion cvmx_l2t_err l2t_err, l2t_err_reset;\n\tunion cvmx_l2d_err l2d_err, l2d_err_reset;\n\n\tl2t_err_reset.u64 = 0;\n\tl2t_err.u64 = cvmx_read_csr(CVMX_L2T_ERR);\n\tif (l2t_err.s.sec_err) {\n\t\tedac_device_handle_ce(l2c, 0, 0,\n\t\t\t\t      \"Tag Single bit error (corrected)\");\n\t\tl2t_err_reset.s.sec_err = 1;\n\t}\n\tif (l2t_err.s.ded_err) {\n\t\tedac_device_handle_ue(l2c, 0, 0,\n\t\t\t\t      \"Tag Double bit error (detected)\");\n\t\tl2t_err_reset.s.ded_err = 1;\n\t}\n\tif (l2t_err_reset.u64)\n\t\tcvmx_write_csr(CVMX_L2T_ERR, l2t_err_reset.u64);\n\n\tl2d_err_reset.u64 = 0;\n\tl2d_err.u64 = cvmx_read_csr(CVMX_L2D_ERR);\n\tif (l2d_err.s.sec_err) {\n\t\tedac_device_handle_ce(l2c, 0, 1,\n\t\t\t\t      \"Data Single bit error (corrected)\");\n\t\tl2d_err_reset.s.sec_err = 1;\n\t}\n\tif (l2d_err.s.ded_err) {\n\t\tedac_device_handle_ue(l2c, 0, 1,\n\t\t\t\t      \"Data Double bit error (detected)\");\n\t\tl2d_err_reset.s.ded_err = 1;\n\t}\n\tif (l2d_err_reset.u64)\n\t\tcvmx_write_csr(CVMX_L2D_ERR, l2d_err_reset.u64);\n\n}\n\nstatic void _octeon_l2c_poll_oct2(struct edac_device_ctl_info *l2c, int tad)\n{\n\tunion cvmx_l2c_err_tdtx err_tdtx, err_tdtx_reset;\n\tunion cvmx_l2c_err_ttgx err_ttgx, err_ttgx_reset;\n\tchar buf1[64];\n\tchar buf2[80];\n\n\terr_tdtx_reset.u64 = 0;\n\terr_tdtx.u64 = cvmx_read_csr(CVMX_L2C_ERR_TDTX(tad));\n\tif (err_tdtx.s.dbe || err_tdtx.s.sbe ||\n\t    err_tdtx.s.vdbe || err_tdtx.s.vsbe)\n\t\tsnprintf(buf1, sizeof(buf1),\n\t\t\t \"type:%d, syn:0x%x, way:%d\",\n\t\t\t err_tdtx.s.type, err_tdtx.s.syn, err_tdtx.s.wayidx);\n\n\tif (err_tdtx.s.dbe) {\n\t\tsnprintf(buf2, sizeof(buf2),\n\t\t\t \"L2D Double bit error (detected):%s\", buf1);\n\t\terr_tdtx_reset.s.dbe = 1;\n\t\tedac_device_handle_ue(l2c, tad, 1, buf2);\n\t}\n\tif (err_tdtx.s.sbe) {\n\t\tsnprintf(buf2, sizeof(buf2),\n\t\t\t \"L2D Single bit error (corrected):%s\", buf1);\n\t\terr_tdtx_reset.s.sbe = 1;\n\t\tedac_device_handle_ce(l2c, tad, 1, buf2);\n\t}\n\tif (err_tdtx.s.vdbe) {\n\t\tsnprintf(buf2, sizeof(buf2),\n\t\t\t \"VBF Double bit error (detected):%s\", buf1);\n\t\terr_tdtx_reset.s.vdbe = 1;\n\t\tedac_device_handle_ue(l2c, tad, 1, buf2);\n\t}\n\tif (err_tdtx.s.vsbe) {\n\t\tsnprintf(buf2, sizeof(buf2),\n\t\t\t \"VBF Single bit error (corrected):%s\", buf1);\n\t\terr_tdtx_reset.s.vsbe = 1;\n\t\tedac_device_handle_ce(l2c, tad, 1, buf2);\n\t}\n\tif (err_tdtx_reset.u64)\n\t\tcvmx_write_csr(CVMX_L2C_ERR_TDTX(tad), err_tdtx_reset.u64);\n\n\terr_ttgx_reset.u64 = 0;\n\terr_ttgx.u64 = cvmx_read_csr(CVMX_L2C_ERR_TTGX(tad));\n\n\tif (err_ttgx.s.dbe || err_ttgx.s.sbe)\n\t\tsnprintf(buf1, sizeof(buf1),\n\t\t\t \"type:%d, syn:0x%x, way:%d\",\n\t\t\t err_ttgx.s.type, err_ttgx.s.syn, err_ttgx.s.wayidx);\n\n\tif (err_ttgx.s.dbe) {\n\t\tsnprintf(buf2, sizeof(buf2),\n\t\t\t \"Tag Double bit error (detected):%s\", buf1);\n\t\terr_ttgx_reset.s.dbe = 1;\n\t\tedac_device_handle_ue(l2c, tad, 0, buf2);\n\t}\n\tif (err_ttgx.s.sbe) {\n\t\tsnprintf(buf2, sizeof(buf2),\n\t\t\t \"Tag Single bit error (corrected):%s\", buf1);\n\t\terr_ttgx_reset.s.sbe = 1;\n\t\tedac_device_handle_ce(l2c, tad, 0, buf2);\n\t}\n\tif (err_ttgx_reset.u64)\n\t\tcvmx_write_csr(CVMX_L2C_ERR_TTGX(tad), err_ttgx_reset.u64);\n}\n\nstatic void octeon_l2c_poll_oct2(struct edac_device_ctl_info *l2c)\n{\n\tint i;\n\tfor (i = 0; i < l2c->nr_instances; i++)\n\t\t_octeon_l2c_poll_oct2(l2c, i);\n}\n\nstatic int octeon_l2c_probe(struct platform_device *pdev)\n{\n\tstruct edac_device_ctl_info *l2c;\n\n\tint num_tads = OCTEON_IS_MODEL(OCTEON_CN68XX) ? 4 : 1;\n\n\t \n\tl2c = edac_device_alloc_ctl_info(0, \"l2c\", num_tads, \"l2c\", 2, 0,\n\t\t\t\t\t NULL, 0, edac_device_alloc_index());\n\tif (!l2c)\n\t\treturn -ENOMEM;\n\n\tl2c->dev = &pdev->dev;\n\tplatform_set_drvdata(pdev, l2c);\n\tl2c->dev_name = dev_name(&pdev->dev);\n\n\tl2c->mod_name = \"octeon-l2c\";\n\tl2c->ctl_name = \"octeon_l2c_err\";\n\n\n\tif (OCTEON_IS_OCTEON1PLUS()) {\n\t\tunion cvmx_l2t_err l2t_err;\n\t\tunion cvmx_l2d_err l2d_err;\n\n\t\tl2t_err.u64 = cvmx_read_csr(CVMX_L2T_ERR);\n\t\tl2t_err.s.sec_intena = 0;\t \n\t\tl2t_err.s.ded_intena = 0;\n\t\tcvmx_write_csr(CVMX_L2T_ERR, l2t_err.u64);\n\n\t\tl2d_err.u64 = cvmx_read_csr(CVMX_L2D_ERR);\n\t\tl2d_err.s.sec_intena = 0;\t \n\t\tl2d_err.s.ded_intena = 0;\n\t\tcvmx_write_csr(CVMX_L2T_ERR, l2d_err.u64);\n\n\t\tl2c->edac_check = octeon_l2c_poll_oct1;\n\t} else {\n\t\t \n\t\tl2c->edac_check = octeon_l2c_poll_oct2;\n\t}\n\n\tif (edac_device_add_device(l2c) > 0) {\n\t\tpr_err(\"%s: edac_device_add_device() failed\\n\", __func__);\n\t\tgoto err;\n\t}\n\n\n\treturn 0;\n\nerr:\n\tedac_device_free_ctl_info(l2c);\n\n\treturn -ENXIO;\n}\n\nstatic int octeon_l2c_remove(struct platform_device *pdev)\n{\n\tstruct edac_device_ctl_info *l2c = platform_get_drvdata(pdev);\n\n\tedac_device_del_device(&pdev->dev);\n\tedac_device_free_ctl_info(l2c);\n\n\treturn 0;\n}\n\nstatic struct platform_driver octeon_l2c_driver = {\n\t.probe = octeon_l2c_probe,\n\t.remove = octeon_l2c_remove,\n\t.driver = {\n\t\t   .name = \"octeon_l2c_edac\",\n\t}\n};\nmodule_platform_driver(octeon_l2c_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Ralf Baechle <ralf@linux-mips.org>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}