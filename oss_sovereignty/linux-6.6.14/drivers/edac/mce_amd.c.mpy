{
  "module_name": "mce_amd.c",
  "hash_id": "18e3cd3065464fca975a955d0fa198674f72ebb14f7ed38aa2b4638cec2aca68",
  "original_prompt": "Ingested from linux-6.6.14/drivers/edac/mce_amd.c",
  "human_readable_source": "\n#include <linux/module.h>\n#include <linux/slab.h>\n\n#include <asm/cpu.h>\n\n#include \"mce_amd.h\"\n\nstatic struct amd_decoder_ops fam_ops;\n\nstatic u8 xec_mask\t = 0xf;\n\nstatic void (*decode_dram_ecc)(int node_id, struct mce *m);\n\nvoid amd_register_ecc_decoder(void (*f)(int, struct mce *))\n{\n\tdecode_dram_ecc = f;\n}\nEXPORT_SYMBOL_GPL(amd_register_ecc_decoder);\n\nvoid amd_unregister_ecc_decoder(void (*f)(int, struct mce *))\n{\n\tif (decode_dram_ecc) {\n\t\tWARN_ON(decode_dram_ecc != f);\n\n\t\tdecode_dram_ecc = NULL;\n\t}\n}\nEXPORT_SYMBOL_GPL(amd_unregister_ecc_decoder);\n\n \n\n \nstatic const char * const tt_msgs[] = { \"INSN\", \"DATA\", \"GEN\", \"RESV\" };\n\n \nstatic const char * const ll_msgs[] = { \"RESV\", \"L1\", \"L2\", \"L3/GEN\" };\n\n \nstatic const char * const rrrr_msgs[] = {\n       \"GEN\", \"RD\", \"WR\", \"DRD\", \"DWR\", \"IRD\", \"PRF\", \"EV\", \"SNP\"\n};\n\n \nconst char * const pp_msgs[] = { \"SRC\", \"RES\", \"OBS\", \"GEN\" };\nEXPORT_SYMBOL_GPL(pp_msgs);\n\n \nstatic const char * const to_msgs[] = { \"no timeout\", \"timed out\" };\n\n \nstatic const char * const ii_msgs[] = { \"MEM\", \"RESV\", \"IO\", \"GEN\" };\n\n \nstatic const char * const uu_msgs[] = { \"RESV\", \"RESV\", \"HWA\", \"RESV\" };\n\nstatic const char * const f15h_mc1_mce_desc[] = {\n\t\"UC during a demand linefill from L2\",\n\t\"Parity error during data load from IC\",\n\t\"Parity error for IC valid bit\",\n\t\"Main tag parity error\",\n\t\"Parity error in prediction queue\",\n\t\"PFB data/address parity error\",\n\t\"Parity error in the branch status reg\",\n\t\"PFB promotion address error\",\n\t\"Tag error during probe/victimization\",\n\t\"Parity error for IC probe tag valid bit\",\n\t\"PFB non-cacheable bit parity error\",\n\t\"PFB valid bit parity error\",\t\t\t \n\t\"Microcode Patch Buffer\",\t\t\t \n\t\"uop queue\",\n\t\"insn buffer\",\n\t\"predecode buffer\",\n\t\"fetch address FIFO\",\n\t\"dispatch uop queue\"\n};\n\nstatic const char * const f15h_mc2_mce_desc[] = {\n\t\"Fill ECC error on data fills\",\t\t\t \n\t\"Fill parity error on insn fills\",\n\t\"Prefetcher request FIFO parity error\",\n\t\"PRQ address parity error\",\n\t\"PRQ data parity error\",\n\t\"WCC Tag ECC error\",\n\t\"WCC Data ECC error\",\n\t\"WCB Data parity error\",\n\t\"VB Data ECC or parity error\",\n\t\"L2 Tag ECC error\",\t\t\t\t \n\t\"Hard L2 Tag ECC error\",\n\t\"Multiple hits on L2 tag\",\n\t\"XAB parity error\",\n\t\"PRB address parity error\"\n};\n\nstatic const char * const mc4_mce_desc[] = {\n\t\"DRAM ECC error detected on the NB\",\n\t\"CRC error detected on HT link\",\n\t\"Link-defined sync error packets detected on HT link\",\n\t\"HT Master abort\",\n\t\"HT Target abort\",\n\t\"Invalid GART PTE entry during GART table walk\",\n\t\"Unsupported atomic RMW received from an IO link\",\n\t\"Watchdog timeout due to lack of progress\",\n\t\"DRAM ECC error detected on the NB\",\n\t\"SVM DMA Exclusion Vector error\",\n\t\"HT data error detected on link\",\n\t\"Protocol error (link, L3, probe filter)\",\n\t\"NB internal arrays parity error\",\n\t\"DRAM addr/ctl signals parity error\",\n\t\"IO link transmission error\",\n\t\"L3 data cache ECC error\",\t\t\t \n\t\"L3 cache tag error\",\n\t\"L3 LRU parity bits error\",\n\t\"ECC Error in the Probe Filter directory\"\n};\n\nstatic const char * const mc5_mce_desc[] = {\n\t\"CPU Watchdog timer expire\",\n\t\"Wakeup array dest tag\",\n\t\"AG payload array\",\n\t\"EX payload array\",\n\t\"IDRF array\",\n\t\"Retire dispatch queue\",\n\t\"Mapper checkpoint array\",\n\t\"Physical register file EX0 port\",\n\t\"Physical register file EX1 port\",\n\t\"Physical register file AG0 port\",\n\t\"Physical register file AG1 port\",\n\t\"Flag register file\",\n\t\"DE error occurred\",\n\t\"Retire status queue\"\n};\n\nstatic const char * const mc6_mce_desc[] = {\n\t\"Hardware Assertion\",\n\t\"Free List\",\n\t\"Physical Register File\",\n\t\"Retire Queue\",\n\t\"Scheduler table\",\n\t\"Status Register File\",\n};\n\n \nstatic const char * const smca_ls_mce_desc[] = {\n\t\"Load queue parity error\",\n\t\"Store queue parity error\",\n\t\"Miss address buffer payload parity error\",\n\t\"Level 1 TLB parity error\",\n\t\"DC Tag error type 5\",\n\t\"DC Tag error type 6\",\n\t\"DC Tag error type 1\",\n\t\"Internal error type 1\",\n\t\"Internal error type 2\",\n\t\"System Read Data Error Thread 0\",\n\t\"System Read Data Error Thread 1\",\n\t\"DC Tag error type 2\",\n\t\"DC Data error type 1 and poison consumption\",\n\t\"DC Data error type 2\",\n\t\"DC Data error type 3\",\n\t\"DC Tag error type 4\",\n\t\"Level 2 TLB parity error\",\n\t\"PDC parity error\",\n\t\"DC Tag error type 3\",\n\t\"DC Tag error type 5\",\n\t\"L2 Fill Data error\",\n};\n\nstatic const char * const smca_ls2_mce_desc[] = {\n\t\"An ECC error was detected on a data cache read by a probe or victimization\",\n\t\"An ECC error or L2 poison was detected on a data cache read by a load\",\n\t\"An ECC error was detected on a data cache read-modify-write by a store\",\n\t\"An ECC error or poison bit mismatch was detected on a tag read by a probe or victimization\",\n\t\"An ECC error or poison bit mismatch was detected on a tag read by a load\",\n\t\"An ECC error or poison bit mismatch was detected on a tag read by a store\",\n\t\"An ECC error was detected on an EMEM read by a load\",\n\t\"An ECC error was detected on an EMEM read-modify-write by a store\",\n\t\"A parity error was detected in an L1 TLB entry by any access\",\n\t\"A parity error was detected in an L2 TLB entry by any access\",\n\t\"A parity error was detected in a PWC entry by any access\",\n\t\"A parity error was detected in an STQ entry by any access\",\n\t\"A parity error was detected in an LDQ entry by any access\",\n\t\"A parity error was detected in a MAB entry by any access\",\n\t\"A parity error was detected in an SCB entry state field by any access\",\n\t\"A parity error was detected in an SCB entry address field by any access\",\n\t\"A parity error was detected in an SCB entry data field by any access\",\n\t\"A parity error was detected in a WCB entry by any access\",\n\t\"A poisoned line was detected in an SCB entry by any access\",\n\t\"A SystemReadDataError error was reported on read data returned from L2 for a load\",\n\t\"A SystemReadDataError error was reported on read data returned from L2 for an SCB store\",\n\t\"A SystemReadDataError error was reported on read data returned from L2 for a WCB store\",\n\t\"A hardware assertion error was reported\",\n\t\"A parity error was detected in an STLF, SCB EMEM entry or SRB store data by any access\",\n};\n\nstatic const char * const smca_if_mce_desc[] = {\n\t\"Op Cache Microtag Probe Port Parity Error\",\n\t\"IC Microtag or Full Tag Multi-hit Error\",\n\t\"IC Full Tag Parity Error\",\n\t\"IC Data Array Parity Error\",\n\t\"Decoupling Queue PhysAddr Parity Error\",\n\t\"L0 ITLB Parity Error\",\n\t\"L1 ITLB Parity Error\",\n\t\"L2 ITLB Parity Error\",\n\t\"BPQ Thread 0 Snoop Parity Error\",\n\t\"BPQ Thread 1 Snoop Parity Error\",\n\t\"L1 BTB Multi-Match Error\",\n\t\"L2 BTB Multi-Match Error\",\n\t\"L2 Cache Response Poison Error\",\n\t\"System Read Data Error\",\n\t\"Hardware Assertion Error\",\n\t\"L1-TLB Multi-Hit\",\n\t\"L2-TLB Multi-Hit\",\n\t\"BSR Parity Error\",\n\t\"CT MCE\",\n};\n\nstatic const char * const smca_l2_mce_desc[] = {\n\t\"L2M Tag Multiple-Way-Hit error\",\n\t\"L2M Tag or State Array ECC Error\",\n\t\"L2M Data Array ECC Error\",\n\t\"Hardware Assert Error\",\n};\n\nstatic const char * const smca_de_mce_desc[] = {\n\t\"Micro-op cache tag parity error\",\n\t\"Micro-op cache data parity error\",\n\t\"Instruction buffer parity error\",\n\t\"Micro-op queue parity error\",\n\t\"Instruction dispatch queue parity error\",\n\t\"Fetch address FIFO parity error\",\n\t\"Patch RAM data parity error\",\n\t\"Patch RAM sequencer parity error\",\n\t\"Micro-op buffer parity error\",\n\t\"Hardware Assertion MCA Error\",\n};\n\nstatic const char * const smca_ex_mce_desc[] = {\n\t\"Watchdog Timeout error\",\n\t\"Physical register file parity error\",\n\t\"Flag register file parity error\",\n\t\"Immediate displacement register file parity error\",\n\t\"Address generator payload parity error\",\n\t\"EX payload parity error\",\n\t\"Checkpoint queue parity error\",\n\t\"Retire dispatch queue parity error\",\n\t\"Retire status queue parity error\",\n\t\"Scheduling queue parity error\",\n\t\"Branch buffer queue parity error\",\n\t\"Hardware Assertion error\",\n\t\"Spec Map parity error\",\n\t\"Retire Map parity error\",\n};\n\nstatic const char * const smca_fp_mce_desc[] = {\n\t\"Physical register file (PRF) parity error\",\n\t\"Freelist (FL) parity error\",\n\t\"Schedule queue parity error\",\n\t\"NSQ parity error\",\n\t\"Retire queue (RQ) parity error\",\n\t\"Status register file (SRF) parity error\",\n\t\"Hardware assertion\",\n};\n\nstatic const char * const smca_l3_mce_desc[] = {\n\t\"Shadow Tag Macro ECC Error\",\n\t\"Shadow Tag Macro Multi-way-hit Error\",\n\t\"L3M Tag ECC Error\",\n\t\"L3M Tag Multi-way-hit Error\",\n\t\"L3M Data ECC Error\",\n\t\"SDP Parity Error or SystemReadDataError from XI\",\n\t\"L3 Victim Queue Parity Error\",\n\t\"L3 Hardware Assertion\",\n};\n\nstatic const char * const smca_cs_mce_desc[] = {\n\t\"Illegal Request\",\n\t\"Address Violation\",\n\t\"Security Violation\",\n\t\"Illegal Response\",\n\t\"Unexpected Response\",\n\t\"Request or Probe Parity Error\",\n\t\"Read Response Parity Error\",\n\t\"Atomic Request Parity Error\",\n\t\"Probe Filter ECC Error\",\n};\n\nstatic const char * const smca_cs2_mce_desc[] = {\n\t\"Illegal Request\",\n\t\"Address Violation\",\n\t\"Security Violation\",\n\t\"Illegal Response\",\n\t\"Unexpected Response\",\n\t\"Request or Probe Parity Error\",\n\t\"Read Response Parity Error\",\n\t\"Atomic Request Parity Error\",\n\t\"SDP read response had no match in the CS queue\",\n\t\"Probe Filter Protocol Error\",\n\t\"Probe Filter ECC Error\",\n\t\"SDP read response had an unexpected RETRY error\",\n\t\"Counter overflow error\",\n\t\"Counter underflow error\",\n};\n\nstatic const char * const smca_pie_mce_desc[] = {\n\t\"Hardware Assert\",\n\t\"Register security violation\",\n\t\"Link Error\",\n\t\"Poison data consumption\",\n\t\"A deferred error was detected in the DF\"\n};\n\nstatic const char * const smca_umc_mce_desc[] = {\n\t\"DRAM ECC error\",\n\t\"Data poison error\",\n\t\"SDP parity error\",\n\t\"Advanced peripheral bus error\",\n\t\"Address/Command parity error\",\n\t\"Write data CRC error\",\n\t\"DCQ SRAM ECC error\",\n\t\"AES SRAM ECC error\",\n};\n\nstatic const char * const smca_umc2_mce_desc[] = {\n\t\"DRAM ECC error\",\n\t\"Data poison error\",\n\t\"SDP parity error\",\n\t\"Reserved\",\n\t\"Address/Command parity error\",\n\t\"Write data parity error\",\n\t\"DCQ SRAM ECC error\",\n\t\"Reserved\",\n\t\"Read data parity error\",\n\t\"Rdb SRAM ECC error\",\n\t\"RdRsp SRAM ECC error\",\n\t\"LM32 MP errors\",\n};\n\nstatic const char * const smca_pb_mce_desc[] = {\n\t\"An ECC error in the Parameter Block RAM array\",\n};\n\nstatic const char * const smca_psp_mce_desc[] = {\n\t\"An ECC or parity error in a PSP RAM instance\",\n};\n\nstatic const char * const smca_psp2_mce_desc[] = {\n\t\"High SRAM ECC or parity error\",\n\t\"Low SRAM ECC or parity error\",\n\t\"Instruction Cache Bank 0 ECC or parity error\",\n\t\"Instruction Cache Bank 1 ECC or parity error\",\n\t\"Instruction Tag Ram 0 parity error\",\n\t\"Instruction Tag Ram 1 parity error\",\n\t\"Data Cache Bank 0 ECC or parity error\",\n\t\"Data Cache Bank 1 ECC or parity error\",\n\t\"Data Cache Bank 2 ECC or parity error\",\n\t\"Data Cache Bank 3 ECC or parity error\",\n\t\"Data Tag Bank 0 parity error\",\n\t\"Data Tag Bank 1 parity error\",\n\t\"Data Tag Bank 2 parity error\",\n\t\"Data Tag Bank 3 parity error\",\n\t\"Dirty Data Ram parity error\",\n\t\"TLB Bank 0 parity error\",\n\t\"TLB Bank 1 parity error\",\n\t\"System Hub Read Buffer ECC or parity error\",\n};\n\nstatic const char * const smca_smu_mce_desc[] = {\n\t\"An ECC or parity error in an SMU RAM instance\",\n};\n\nstatic const char * const smca_smu2_mce_desc[] = {\n\t\"High SRAM ECC or parity error\",\n\t\"Low SRAM ECC or parity error\",\n\t\"Data Cache Bank A ECC or parity error\",\n\t\"Data Cache Bank B ECC or parity error\",\n\t\"Data Tag Cache Bank A ECC or parity error\",\n\t\"Data Tag Cache Bank B ECC or parity error\",\n\t\"Instruction Cache Bank A ECC or parity error\",\n\t\"Instruction Cache Bank B ECC or parity error\",\n\t\"Instruction Tag Cache Bank A ECC or parity error\",\n\t\"Instruction Tag Cache Bank B ECC or parity error\",\n\t\"System Hub Read Buffer ECC or parity error\",\n\t\"PHY RAM ECC error\",\n};\n\nstatic const char * const smca_mp5_mce_desc[] = {\n\t\"High SRAM ECC or parity error\",\n\t\"Low SRAM ECC or parity error\",\n\t\"Data Cache Bank A ECC or parity error\",\n\t\"Data Cache Bank B ECC or parity error\",\n\t\"Data Tag Cache Bank A ECC or parity error\",\n\t\"Data Tag Cache Bank B ECC or parity error\",\n\t\"Instruction Cache Bank A ECC or parity error\",\n\t\"Instruction Cache Bank B ECC or parity error\",\n\t\"Instruction Tag Cache Bank A ECC or parity error\",\n\t\"Instruction Tag Cache Bank B ECC or parity error\",\n};\n\nstatic const char * const smca_mpdma_mce_desc[] = {\n\t\"Main SRAM [31:0] bank ECC or parity error\",\n\t\"Main SRAM [63:32] bank ECC or parity error\",\n\t\"Main SRAM [95:64] bank ECC or parity error\",\n\t\"Main SRAM [127:96] bank ECC or parity error\",\n\t\"Data Cache Bank A ECC or parity error\",\n\t\"Data Cache Bank B ECC or parity error\",\n\t\"Data Tag Cache Bank A ECC or parity error\",\n\t\"Data Tag Cache Bank B ECC or parity error\",\n\t\"Instruction Cache Bank A ECC or parity error\",\n\t\"Instruction Cache Bank B ECC or parity error\",\n\t\"Instruction Tag Cache Bank A ECC or parity error\",\n\t\"Instruction Tag Cache Bank B ECC or parity error\",\n\t\"Data Cache Bank A ECC or parity error\",\n\t\"Data Cache Bank B ECC or parity error\",\n\t\"Data Tag Cache Bank A ECC or parity error\",\n\t\"Data Tag Cache Bank B ECC or parity error\",\n\t\"Instruction Cache Bank A ECC or parity error\",\n\t\"Instruction Cache Bank B ECC or parity error\",\n\t\"Instruction Tag Cache Bank A ECC or parity error\",\n\t\"Instruction Tag Cache Bank B ECC or parity error\",\n\t\"Data Cache Bank A ECC or parity error\",\n\t\"Data Cache Bank B ECC or parity error\",\n\t\"Data Tag Cache Bank A ECC or parity error\",\n\t\"Data Tag Cache Bank B ECC or parity error\",\n\t\"Instruction Cache Bank A ECC or parity error\",\n\t\"Instruction Cache Bank B ECC or parity error\",\n\t\"Instruction Tag Cache Bank A ECC or parity error\",\n\t\"Instruction Tag Cache Bank B ECC or parity error\",\n\t\"System Hub Read Buffer ECC or parity error\",\n\t\"MPDMA TVF DVSEC Memory ECC or parity error\",\n\t\"MPDMA TVF MMIO Mailbox0 ECC or parity error\",\n\t\"MPDMA TVF MMIO Mailbox1 ECC or parity error\",\n\t\"MPDMA TVF Doorbell Memory ECC or parity error\",\n\t\"MPDMA TVF SDP Slave Memory 0 ECC or parity error\",\n\t\"MPDMA TVF SDP Slave Memory 1 ECC or parity error\",\n\t\"MPDMA TVF SDP Slave Memory 2 ECC or parity error\",\n\t\"MPDMA TVF SDP Master Memory 0 ECC or parity error\",\n\t\"MPDMA TVF SDP Master Memory 1 ECC or parity error\",\n\t\"MPDMA TVF SDP Master Memory 2 ECC or parity error\",\n\t\"MPDMA TVF SDP Master Memory 3 ECC or parity error\",\n\t\"MPDMA TVF SDP Master Memory 4 ECC or parity error\",\n\t\"MPDMA TVF SDP Master Memory 5 ECC or parity error\",\n\t\"MPDMA TVF SDP Master Memory 6 ECC or parity error\",\n\t\"MPDMA PTE Command FIFO ECC or parity error\",\n\t\"MPDMA PTE Hub Data FIFO ECC or parity error\",\n\t\"MPDMA PTE Internal Data FIFO ECC or parity error\",\n\t\"MPDMA PTE Command Memory DMA ECC or parity error\",\n\t\"MPDMA PTE Command Memory Internal ECC or parity error\",\n\t\"MPDMA PTE DMA Completion FIFO ECC or parity error\",\n\t\"MPDMA PTE Tablewalk Completion FIFO ECC or parity error\",\n\t\"MPDMA PTE Descriptor Completion FIFO ECC or parity error\",\n\t\"MPDMA PTE ReadOnly Completion FIFO ECC or parity error\",\n\t\"MPDMA PTE DirectWrite Completion FIFO ECC or parity error\",\n\t\"SDP Watchdog Timer expired\",\n};\n\nstatic const char * const smca_nbio_mce_desc[] = {\n\t\"ECC or Parity error\",\n\t\"PCIE error\",\n\t\"SDP ErrEvent error\",\n\t\"SDP Egress Poison Error\",\n\t\"IOHC Internal Poison Error\",\n};\n\nstatic const char * const smca_pcie_mce_desc[] = {\n\t\"CCIX PER Message logging\",\n\t\"CCIX Read Response with Status: Non-Data Error\",\n\t\"CCIX Write Response with Status: Non-Data Error\",\n\t\"CCIX Read Response with Status: Data Error\",\n\t\"CCIX Non-okay write response with data error\",\n};\n\nstatic const char * const smca_pcie2_mce_desc[] = {\n\t\"SDP Parity Error logging\",\n};\n\nstatic const char * const smca_xgmipcs_mce_desc[] = {\n\t\"Data Loss Error\",\n\t\"Training Error\",\n\t\"Flow Control Acknowledge Error\",\n\t\"Rx Fifo Underflow Error\",\n\t\"Rx Fifo Overflow Error\",\n\t\"CRC Error\",\n\t\"BER Exceeded Error\",\n\t\"Tx Vcid Data Error\",\n\t\"Replay Buffer Parity Error\",\n\t\"Data Parity Error\",\n\t\"Replay Fifo Overflow Error\",\n\t\"Replay Fifo Underflow Error\",\n\t\"Elastic Fifo Overflow Error\",\n\t\"Deskew Error\",\n\t\"Flow Control CRC Error\",\n\t\"Data Startup Limit Error\",\n\t\"FC Init Timeout Error\",\n\t\"Recovery Timeout Error\",\n\t\"Ready Serial Timeout Error\",\n\t\"Ready Serial Attempt Error\",\n\t\"Recovery Attempt Error\",\n\t\"Recovery Relock Attempt Error\",\n\t\"Replay Attempt Error\",\n\t\"Sync Header Error\",\n\t\"Tx Replay Timeout Error\",\n\t\"Rx Replay Timeout Error\",\n\t\"LinkSub Tx Timeout Error\",\n\t\"LinkSub Rx Timeout Error\",\n\t\"Rx CMD Packet Error\",\n};\n\nstatic const char * const smca_xgmiphy_mce_desc[] = {\n\t\"RAM ECC Error\",\n\t\"ARC instruction buffer parity error\",\n\t\"ARC data buffer parity error\",\n\t\"PHY APB error\",\n};\n\nstatic const char * const smca_nbif_mce_desc[] = {\n\t\"Timeout error from GMI\",\n\t\"SRAM ECC error\",\n\t\"NTB Error Event\",\n\t\"SDP Parity error\",\n};\n\nstatic const char * const smca_sata_mce_desc[] = {\n\t\"Parity error for port 0\",\n\t\"Parity error for port 1\",\n\t\"Parity error for port 2\",\n\t\"Parity error for port 3\",\n\t\"Parity error for port 4\",\n\t\"Parity error for port 5\",\n\t\"Parity error for port 6\",\n\t\"Parity error for port 7\",\n};\n\nstatic const char * const smca_usb_mce_desc[] = {\n\t\"Parity error or ECC error for S0 RAM0\",\n\t\"Parity error or ECC error for S0 RAM1\",\n\t\"Parity error or ECC error for S0 RAM2\",\n\t\"Parity error for PHY RAM0\",\n\t\"Parity error for PHY RAM1\",\n\t\"AXI Slave Response error\",\n};\n\nstatic const char * const smca_gmipcs_mce_desc[] = {\n\t\"Data Loss Error\",\n\t\"Training Error\",\n\t\"Replay Parity Error\",\n\t\"Rx Fifo Underflow Error\",\n\t\"Rx Fifo Overflow Error\",\n\t\"CRC Error\",\n\t\"BER Exceeded Error\",\n\t\"Tx Fifo Underflow Error\",\n\t\"Replay Buffer Parity Error\",\n\t\"Tx Overflow Error\",\n\t\"Replay Fifo Overflow Error\",\n\t\"Replay Fifo Underflow Error\",\n\t\"Elastic Fifo Overflow Error\",\n\t\"Deskew Error\",\n\t\"Offline Error\",\n\t\"Data Startup Limit Error\",\n\t\"FC Init Timeout Error\",\n\t\"Recovery Timeout Error\",\n\t\"Ready Serial Timeout Error\",\n\t\"Ready Serial Attempt Error\",\n\t\"Recovery Attempt Error\",\n\t\"Recovery Relock Attempt Error\",\n\t\"Deskew Abort Error\",\n\t\"Rx Buffer Error\",\n\t\"Rx LFDS Fifo Overflow Error\",\n\t\"Rx LFDS Fifo Underflow Error\",\n\t\"LinkSub Tx Timeout Error\",\n\t\"LinkSub Rx Timeout Error\",\n\t\"Rx CMD Packet Error\",\n\t\"LFDS Training Timeout Error\",\n\t\"LFDS FC Init Timeout Error\",\n\t\"Data Loss Error\",\n};\n\nstruct smca_mce_desc {\n\tconst char * const *descs;\n\tunsigned int num_descs;\n};\n\nstatic struct smca_mce_desc smca_mce_descs[] = {\n\t[SMCA_LS]\t= { smca_ls_mce_desc,\tARRAY_SIZE(smca_ls_mce_desc)\t},\n\t[SMCA_LS_V2]\t= { smca_ls2_mce_desc,\tARRAY_SIZE(smca_ls2_mce_desc)\t},\n\t[SMCA_IF]\t= { smca_if_mce_desc,\tARRAY_SIZE(smca_if_mce_desc)\t},\n\t[SMCA_L2_CACHE]\t= { smca_l2_mce_desc,\tARRAY_SIZE(smca_l2_mce_desc)\t},\n\t[SMCA_DE]\t= { smca_de_mce_desc,\tARRAY_SIZE(smca_de_mce_desc)\t},\n\t[SMCA_EX]\t= { smca_ex_mce_desc,\tARRAY_SIZE(smca_ex_mce_desc)\t},\n\t[SMCA_FP]\t= { smca_fp_mce_desc,\tARRAY_SIZE(smca_fp_mce_desc)\t},\n\t[SMCA_L3_CACHE]\t= { smca_l3_mce_desc,\tARRAY_SIZE(smca_l3_mce_desc)\t},\n\t[SMCA_CS]\t= { smca_cs_mce_desc,\tARRAY_SIZE(smca_cs_mce_desc)\t},\n\t[SMCA_CS_V2]\t= { smca_cs2_mce_desc,\tARRAY_SIZE(smca_cs2_mce_desc)\t},\n\t[SMCA_PIE]\t= { smca_pie_mce_desc,\tARRAY_SIZE(smca_pie_mce_desc)\t},\n\t[SMCA_UMC]\t= { smca_umc_mce_desc,\tARRAY_SIZE(smca_umc_mce_desc)\t},\n\t[SMCA_UMC_V2]\t= { smca_umc2_mce_desc,\tARRAY_SIZE(smca_umc2_mce_desc)\t},\n\t[SMCA_PB]\t= { smca_pb_mce_desc,\tARRAY_SIZE(smca_pb_mce_desc)\t},\n\t[SMCA_PSP]\t= { smca_psp_mce_desc,\tARRAY_SIZE(smca_psp_mce_desc)\t},\n\t[SMCA_PSP_V2]\t= { smca_psp2_mce_desc,\tARRAY_SIZE(smca_psp2_mce_desc)\t},\n\t[SMCA_SMU]\t= { smca_smu_mce_desc,\tARRAY_SIZE(smca_smu_mce_desc)\t},\n\t[SMCA_SMU_V2]\t= { smca_smu2_mce_desc,\tARRAY_SIZE(smca_smu2_mce_desc)\t},\n\t[SMCA_MP5]\t= { smca_mp5_mce_desc,\tARRAY_SIZE(smca_mp5_mce_desc)\t},\n\t[SMCA_MPDMA]\t= { smca_mpdma_mce_desc,\tARRAY_SIZE(smca_mpdma_mce_desc)\t},\n\t[SMCA_NBIO]\t= { smca_nbio_mce_desc,\tARRAY_SIZE(smca_nbio_mce_desc)\t},\n\t[SMCA_PCIE]\t= { smca_pcie_mce_desc,\tARRAY_SIZE(smca_pcie_mce_desc)\t},\n\t[SMCA_PCIE_V2]\t= { smca_pcie2_mce_desc,   ARRAY_SIZE(smca_pcie2_mce_desc)\t},\n\t[SMCA_XGMI_PCS]\t= { smca_xgmipcs_mce_desc, ARRAY_SIZE(smca_xgmipcs_mce_desc)\t},\n\t \n\t[SMCA_NBIF]\t= { smca_nbif_mce_desc, ARRAY_SIZE(smca_nbif_mce_desc)\t},\n\t[SMCA_SHUB]\t= { smca_nbif_mce_desc, ARRAY_SIZE(smca_nbif_mce_desc)\t},\n\t[SMCA_SATA]\t= { smca_sata_mce_desc, ARRAY_SIZE(smca_sata_mce_desc)\t},\n\t[SMCA_USB]\t= { smca_usb_mce_desc,\tARRAY_SIZE(smca_usb_mce_desc)\t},\n\t[SMCA_GMI_PCS]\t= { smca_gmipcs_mce_desc,  ARRAY_SIZE(smca_gmipcs_mce_desc)\t},\n\t \n\t[SMCA_XGMI_PHY]\t= { smca_xgmiphy_mce_desc, ARRAY_SIZE(smca_xgmiphy_mce_desc)\t},\n\t[SMCA_WAFL_PHY]\t= { smca_xgmiphy_mce_desc, ARRAY_SIZE(smca_xgmiphy_mce_desc)\t},\n\t[SMCA_GMI_PHY]\t= { smca_xgmiphy_mce_desc, ARRAY_SIZE(smca_xgmiphy_mce_desc)\t},\n};\n\nstatic bool f12h_mc0_mce(u16 ec, u8 xec)\n{\n\tbool ret = false;\n\n\tif (MEM_ERROR(ec)) {\n\t\tu8 ll = LL(ec);\n\t\tret = true;\n\n\t\tif (ll == LL_L2)\n\t\t\tpr_cont(\"during L1 linefill from L2.\\n\");\n\t\telse if (ll == LL_L1)\n\t\t\tpr_cont(\"Data/Tag %s error.\\n\", R4_MSG(ec));\n\t\telse\n\t\t\tret = false;\n\t}\n\treturn ret;\n}\n\nstatic bool f10h_mc0_mce(u16 ec, u8 xec)\n{\n\tif (R4(ec) == R4_GEN && LL(ec) == LL_L1) {\n\t\tpr_cont(\"during data scrub.\\n\");\n\t\treturn true;\n\t}\n\treturn f12h_mc0_mce(ec, xec);\n}\n\nstatic bool k8_mc0_mce(u16 ec, u8 xec)\n{\n\tif (BUS_ERROR(ec)) {\n\t\tpr_cont(\"during system linefill.\\n\");\n\t\treturn true;\n\t}\n\n\treturn f10h_mc0_mce(ec, xec);\n}\n\nstatic bool cat_mc0_mce(u16 ec, u8 xec)\n{\n\tu8 r4\t = R4(ec);\n\tbool ret = true;\n\n\tif (MEM_ERROR(ec)) {\n\n\t\tif (TT(ec) != TT_DATA || LL(ec) != LL_L1)\n\t\t\treturn false;\n\n\t\tswitch (r4) {\n\t\tcase R4_DRD:\n\t\tcase R4_DWR:\n\t\t\tpr_cont(\"Data/Tag parity error due to %s.\\n\",\n\t\t\t\t(r4 == R4_DRD ? \"load/hw prf\" : \"store\"));\n\t\t\tbreak;\n\t\tcase R4_EVICT:\n\t\t\tpr_cont(\"Copyback parity error on a tag miss.\\n\");\n\t\t\tbreak;\n\t\tcase R4_SNOOP:\n\t\t\tpr_cont(\"Tag parity error during snoop.\\n\");\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tret = false;\n\t\t}\n\t} else if (BUS_ERROR(ec)) {\n\n\t\tif ((II(ec) != II_MEM && II(ec) != II_IO) || LL(ec) != LL_LG)\n\t\t\treturn false;\n\n\t\tpr_cont(\"System read data error on a \");\n\n\t\tswitch (r4) {\n\t\tcase R4_RD:\n\t\t\tpr_cont(\"TLB reload.\\n\");\n\t\t\tbreak;\n\t\tcase R4_DWR:\n\t\t\tpr_cont(\"store.\\n\");\n\t\t\tbreak;\n\t\tcase R4_DRD:\n\t\t\tpr_cont(\"load.\\n\");\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tret = false;\n\t\t}\n\t} else {\n\t\tret = false;\n\t}\n\n\treturn ret;\n}\n\nstatic bool f15h_mc0_mce(u16 ec, u8 xec)\n{\n\tbool ret = true;\n\n\tif (MEM_ERROR(ec)) {\n\n\t\tswitch (xec) {\n\t\tcase 0x0:\n\t\t\tpr_cont(\"Data Array access error.\\n\");\n\t\t\tbreak;\n\n\t\tcase 0x1:\n\t\t\tpr_cont(\"UC error during a linefill from L2/NB.\\n\");\n\t\t\tbreak;\n\n\t\tcase 0x2:\n\t\tcase 0x11:\n\t\t\tpr_cont(\"STQ access error.\\n\");\n\t\t\tbreak;\n\n\t\tcase 0x3:\n\t\t\tpr_cont(\"SCB access error.\\n\");\n\t\t\tbreak;\n\n\t\tcase 0x10:\n\t\t\tpr_cont(\"Tag error.\\n\");\n\t\t\tbreak;\n\n\t\tcase 0x12:\n\t\t\tpr_cont(\"LDQ access error.\\n\");\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tret = false;\n\t\t}\n\t} else if (BUS_ERROR(ec)) {\n\n\t\tif (!xec)\n\t\t\tpr_cont(\"System Read Data Error.\\n\");\n\t\telse\n\t\t\tpr_cont(\" Internal error condition type %d.\\n\", xec);\n\t} else if (INT_ERROR(ec)) {\n\t\tif (xec <= 0x1f)\n\t\t\tpr_cont(\"Hardware Assert.\\n\");\n\t\telse\n\t\t\tret = false;\n\n\t} else\n\t\tret = false;\n\n\treturn ret;\n}\n\nstatic void decode_mc0_mce(struct mce *m)\n{\n\tu16 ec = EC(m->status);\n\tu8 xec = XEC(m->status, xec_mask);\n\n\tpr_emerg(HW_ERR \"MC0 Error: \");\n\n\t \n\tif (TLB_ERROR(ec)) {\n\t\tif (TT(ec) == TT_DATA) {\n\t\t\tpr_cont(\"%s TLB %s.\\n\", LL_MSG(ec),\n\t\t\t\t((xec == 2) ? \"locked miss\"\n\t\t\t\t\t    : (xec ? \"multimatch\" : \"parity\")));\n\t\t\treturn;\n\t\t}\n\t} else if (fam_ops.mc0_mce(ec, xec))\n\t\t;\n\telse\n\t\tpr_emerg(HW_ERR \"Corrupted MC0 MCE info?\\n\");\n}\n\nstatic bool k8_mc1_mce(u16 ec, u8 xec)\n{\n\tu8 ll\t = LL(ec);\n\tbool ret = true;\n\n\tif (!MEM_ERROR(ec))\n\t\treturn false;\n\n\tif (ll == 0x2)\n\t\tpr_cont(\"during a linefill from L2.\\n\");\n\telse if (ll == 0x1) {\n\t\tswitch (R4(ec)) {\n\t\tcase R4_IRD:\n\t\t\tpr_cont(\"Parity error during data load.\\n\");\n\t\t\tbreak;\n\n\t\tcase R4_EVICT:\n\t\t\tpr_cont(\"Copyback Parity/Victim error.\\n\");\n\t\t\tbreak;\n\n\t\tcase R4_SNOOP:\n\t\t\tpr_cont(\"Tag Snoop error.\\n\");\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tret = false;\n\t\t\tbreak;\n\t\t}\n\t} else\n\t\tret = false;\n\n\treturn ret;\n}\n\nstatic bool cat_mc1_mce(u16 ec, u8 xec)\n{\n\tu8 r4    = R4(ec);\n\tbool ret = true;\n\n\tif (!MEM_ERROR(ec))\n\t\treturn false;\n\n\tif (TT(ec) != TT_INSTR)\n\t\treturn false;\n\n\tif (r4 == R4_IRD)\n\t\tpr_cont(\"Data/tag array parity error for a tag hit.\\n\");\n\telse if (r4 == R4_SNOOP)\n\t\tpr_cont(\"Tag error during snoop/victimization.\\n\");\n\telse if (xec == 0x0)\n\t\tpr_cont(\"Tag parity error from victim castout.\\n\");\n\telse if (xec == 0x2)\n\t\tpr_cont(\"Microcode patch RAM parity error.\\n\");\n\telse\n\t\tret = false;\n\n\treturn ret;\n}\n\nstatic bool f15h_mc1_mce(u16 ec, u8 xec)\n{\n\tbool ret = true;\n\n\tif (!MEM_ERROR(ec))\n\t\treturn false;\n\n\tswitch (xec) {\n\tcase 0x0 ... 0xa:\n\t\tpr_cont(\"%s.\\n\", f15h_mc1_mce_desc[xec]);\n\t\tbreak;\n\n\tcase 0xd:\n\t\tpr_cont(\"%s.\\n\", f15h_mc1_mce_desc[xec-2]);\n\t\tbreak;\n\n\tcase 0x10:\n\t\tpr_cont(\"%s.\\n\", f15h_mc1_mce_desc[xec-4]);\n\t\tbreak;\n\n\tcase 0x11 ... 0x15:\n\t\tpr_cont(\"Decoder %s parity error.\\n\", f15h_mc1_mce_desc[xec-4]);\n\t\tbreak;\n\n\tdefault:\n\t\tret = false;\n\t}\n\treturn ret;\n}\n\nstatic void decode_mc1_mce(struct mce *m)\n{\n\tu16 ec = EC(m->status);\n\tu8 xec = XEC(m->status, xec_mask);\n\n\tpr_emerg(HW_ERR \"MC1 Error: \");\n\n\tif (TLB_ERROR(ec))\n\t\tpr_cont(\"%s TLB %s.\\n\", LL_MSG(ec),\n\t\t\t(xec ? \"multimatch\" : \"parity error\"));\n\telse if (BUS_ERROR(ec)) {\n\t\tbool k8 = (boot_cpu_data.x86 == 0xf && (m->status & BIT_64(58)));\n\n\t\tpr_cont(\"during %s.\\n\", (k8 ? \"system linefill\" : \"NB data read\"));\n\t} else if (INT_ERROR(ec)) {\n\t\tif (xec <= 0x3f)\n\t\t\tpr_cont(\"Hardware Assert.\\n\");\n\t\telse\n\t\t\tgoto wrong_mc1_mce;\n\t} else if (fam_ops.mc1_mce(ec, xec))\n\t\t;\n\telse\n\t\tgoto wrong_mc1_mce;\n\n\treturn;\n\nwrong_mc1_mce:\n\tpr_emerg(HW_ERR \"Corrupted MC1 MCE info?\\n\");\n}\n\nstatic bool k8_mc2_mce(u16 ec, u8 xec)\n{\n\tbool ret = true;\n\n\tif (xec == 0x1)\n\t\tpr_cont(\" in the write data buffers.\\n\");\n\telse if (xec == 0x3)\n\t\tpr_cont(\" in the victim data buffers.\\n\");\n\telse if (xec == 0x2 && MEM_ERROR(ec))\n\t\tpr_cont(\": %s error in the L2 cache tags.\\n\", R4_MSG(ec));\n\telse if (xec == 0x0) {\n\t\tif (TLB_ERROR(ec))\n\t\t\tpr_cont(\"%s error in a Page Descriptor Cache or Guest TLB.\\n\",\n\t\t\t\tTT_MSG(ec));\n\t\telse if (BUS_ERROR(ec))\n\t\t\tpr_cont(\": %s/ECC error in data read from NB: %s.\\n\",\n\t\t\t\tR4_MSG(ec), PP_MSG(ec));\n\t\telse if (MEM_ERROR(ec)) {\n\t\t\tu8 r4 = R4(ec);\n\n\t\t\tif (r4 >= 0x7)\n\t\t\t\tpr_cont(\": %s error during data copyback.\\n\",\n\t\t\t\t\tR4_MSG(ec));\n\t\t\telse if (r4 <= 0x1)\n\t\t\t\tpr_cont(\": %s parity/ECC error during data \"\n\t\t\t\t\t\"access from L2.\\n\", R4_MSG(ec));\n\t\t\telse\n\t\t\t\tret = false;\n\t\t} else\n\t\t\tret = false;\n\t} else\n\t\tret = false;\n\n\treturn ret;\n}\n\nstatic bool f15h_mc2_mce(u16 ec, u8 xec)\n{\n\tbool ret = true;\n\n\tif (TLB_ERROR(ec)) {\n\t\tif (xec == 0x0)\n\t\t\tpr_cont(\"Data parity TLB read error.\\n\");\n\t\telse if (xec == 0x1)\n\t\t\tpr_cont(\"Poison data provided for TLB fill.\\n\");\n\t\telse\n\t\t\tret = false;\n\t} else if (BUS_ERROR(ec)) {\n\t\tif (xec > 2)\n\t\t\tret = false;\n\n\t\tpr_cont(\"Error during attempted NB data read.\\n\");\n\t} else if (MEM_ERROR(ec)) {\n\t\tswitch (xec) {\n\t\tcase 0x4 ... 0xc:\n\t\t\tpr_cont(\"%s.\\n\", f15h_mc2_mce_desc[xec - 0x4]);\n\t\t\tbreak;\n\n\t\tcase 0x10 ... 0x14:\n\t\t\tpr_cont(\"%s.\\n\", f15h_mc2_mce_desc[xec - 0x7]);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tret = false;\n\t\t}\n\t} else if (INT_ERROR(ec)) {\n\t\tif (xec <= 0x3f)\n\t\t\tpr_cont(\"Hardware Assert.\\n\");\n\t\telse\n\t\t\tret = false;\n\t}\n\n\treturn ret;\n}\n\nstatic bool f16h_mc2_mce(u16 ec, u8 xec)\n{\n\tu8 r4 = R4(ec);\n\n\tif (!MEM_ERROR(ec))\n\t\treturn false;\n\n\tswitch (xec) {\n\tcase 0x04 ... 0x05:\n\t\tpr_cont(\"%cBUFF parity error.\\n\", (r4 == R4_RD) ? 'I' : 'O');\n\t\tbreak;\n\n\tcase 0x09 ... 0x0b:\n\tcase 0x0d ... 0x0f:\n\t\tpr_cont(\"ECC error in L2 tag (%s).\\n\",\n\t\t\t((r4 == R4_GEN)   ? \"BankReq\" :\n\t\t\t((r4 == R4_SNOOP) ? \"Prb\"     : \"Fill\")));\n\t\tbreak;\n\n\tcase 0x10 ... 0x19:\n\tcase 0x1b:\n\t\tpr_cont(\"ECC error in L2 data array (%s).\\n\",\n\t\t\t(((r4 == R4_RD) && !(xec & 0x3)) ? \"Hit\"  :\n\t\t\t((r4 == R4_GEN)   ? \"Attr\" :\n\t\t\t((r4 == R4_EVICT) ? \"Vict\" : \"Fill\"))));\n\t\tbreak;\n\n\tcase 0x1c ... 0x1d:\n\tcase 0x1f:\n\t\tpr_cont(\"Parity error in L2 attribute bits (%s).\\n\",\n\t\t\t((r4 == R4_RD)  ? \"Hit\"  :\n\t\t\t((r4 == R4_GEN) ? \"Attr\" : \"Fill\")));\n\t\tbreak;\n\n\tdefault:\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nstatic void decode_mc2_mce(struct mce *m)\n{\n\tu16 ec = EC(m->status);\n\tu8 xec = XEC(m->status, xec_mask);\n\n\tpr_emerg(HW_ERR \"MC2 Error: \");\n\n\tif (!fam_ops.mc2_mce(ec, xec))\n\t\tpr_cont(HW_ERR \"Corrupted MC2 MCE info?\\n\");\n}\n\nstatic void decode_mc3_mce(struct mce *m)\n{\n\tu16 ec = EC(m->status);\n\tu8 xec = XEC(m->status, xec_mask);\n\n\tif (boot_cpu_data.x86 >= 0x14) {\n\t\tpr_emerg(\"You shouldn't be seeing MC3 MCE on this cpu family,\"\n\t\t\t \" please report on LKML.\\n\");\n\t\treturn;\n\t}\n\n\tpr_emerg(HW_ERR \"MC3 Error\");\n\n\tif (xec == 0x0) {\n\t\tu8 r4 = R4(ec);\n\n\t\tif (!BUS_ERROR(ec) || (r4 != R4_DRD && r4 != R4_DWR))\n\t\t\tgoto wrong_mc3_mce;\n\n\t\tpr_cont(\" during %s.\\n\", R4_MSG(ec));\n\t} else\n\t\tgoto wrong_mc3_mce;\n\n\treturn;\n\n wrong_mc3_mce:\n\tpr_emerg(HW_ERR \"Corrupted MC3 MCE info?\\n\");\n}\n\nstatic void decode_mc4_mce(struct mce *m)\n{\n\tunsigned int fam = x86_family(m->cpuid);\n\tint node_id = topology_die_id(m->extcpu);\n\tu16 ec = EC(m->status);\n\tu8 xec = XEC(m->status, 0x1f);\n\tu8 offset = 0;\n\n\tpr_emerg(HW_ERR \"MC4 Error (node %d): \", node_id);\n\n\tswitch (xec) {\n\tcase 0x0 ... 0xe:\n\n\t\t \n\t\tif (xec == 0x0 || xec == 0x8) {\n\t\t\t \n\t\t\tif (fam == 0x11)\n\t\t\t\tgoto wrong_mc4_mce;\n\n\t\t\tpr_cont(\"%s.\\n\", mc4_mce_desc[xec]);\n\n\t\t\tif (decode_dram_ecc)\n\t\t\t\tdecode_dram_ecc(node_id, m);\n\t\t\treturn;\n\t\t}\n\t\tbreak;\n\n\tcase 0xf:\n\t\tif (TLB_ERROR(ec))\n\t\t\tpr_cont(\"GART Table Walk data error.\\n\");\n\t\telse if (BUS_ERROR(ec))\n\t\t\tpr_cont(\"DMA Exclusion Vector Table Walk error.\\n\");\n\t\telse\n\t\t\tgoto wrong_mc4_mce;\n\t\treturn;\n\n\tcase 0x19:\n\t\tif (fam == 0x15 || fam == 0x16)\n\t\t\tpr_cont(\"Compute Unit Data Error.\\n\");\n\t\telse\n\t\t\tgoto wrong_mc4_mce;\n\t\treturn;\n\n\tcase 0x1c ... 0x1f:\n\t\toffset = 13;\n\t\tbreak;\n\n\tdefault:\n\t\tgoto wrong_mc4_mce;\n\t}\n\n\tpr_cont(\"%s.\\n\", mc4_mce_desc[xec - offset]);\n\treturn;\n\n wrong_mc4_mce:\n\tpr_emerg(HW_ERR \"Corrupted MC4 MCE info?\\n\");\n}\n\nstatic void decode_mc5_mce(struct mce *m)\n{\n\tunsigned int fam = x86_family(m->cpuid);\n\tu16 ec = EC(m->status);\n\tu8 xec = XEC(m->status, xec_mask);\n\n\tif (fam == 0xf || fam == 0x11)\n\t\tgoto wrong_mc5_mce;\n\n\tpr_emerg(HW_ERR \"MC5 Error: \");\n\n\tif (INT_ERROR(ec)) {\n\t\tif (xec <= 0x1f) {\n\t\t\tpr_cont(\"Hardware Assert.\\n\");\n\t\t\treturn;\n\t\t} else\n\t\t\tgoto wrong_mc5_mce;\n\t}\n\n\tif (xec == 0x0 || xec == 0xc)\n\t\tpr_cont(\"%s.\\n\", mc5_mce_desc[xec]);\n\telse if (xec <= 0xd)\n\t\tpr_cont(\"%s parity error.\\n\", mc5_mce_desc[xec]);\n\telse\n\t\tgoto wrong_mc5_mce;\n\n\treturn;\n\n wrong_mc5_mce:\n\tpr_emerg(HW_ERR \"Corrupted MC5 MCE info?\\n\");\n}\n\nstatic void decode_mc6_mce(struct mce *m)\n{\n\tu8 xec = XEC(m->status, xec_mask);\n\n\tpr_emerg(HW_ERR \"MC6 Error: \");\n\n\tif (xec > 0x5)\n\t\tgoto wrong_mc6_mce;\n\n\tpr_cont(\"%s parity error.\\n\", mc6_mce_desc[xec]);\n\treturn;\n\n wrong_mc6_mce:\n\tpr_emerg(HW_ERR \"Corrupted MC6 MCE info?\\n\");\n}\n\n \nstatic void decode_smca_error(struct mce *m)\n{\n\tenum smca_bank_types bank_type = smca_get_bank_type(m->extcpu, m->bank);\n\tconst char *ip_name;\n\tu8 xec = XEC(m->status, xec_mask);\n\n\tif (bank_type >= N_SMCA_BANK_TYPES)\n\t\treturn;\n\n\tif (bank_type == SMCA_RESERVED) {\n\t\tpr_emerg(HW_ERR \"Bank %d is reserved.\\n\", m->bank);\n\t\treturn;\n\t}\n\n\tip_name = smca_get_long_name(bank_type);\n\n\tpr_emerg(HW_ERR \"%s Ext. Error Code: %d\", ip_name, xec);\n\n\t \n\tif (xec < smca_mce_descs[bank_type].num_descs)\n\t\tpr_cont(\", %s.\\n\", smca_mce_descs[bank_type].descs[xec]);\n\n\tif ((bank_type == SMCA_UMC || bank_type == SMCA_UMC_V2) &&\n\t    xec == 0 && decode_dram_ecc)\n\t\tdecode_dram_ecc(topology_die_id(m->extcpu), m);\n}\n\nstatic inline void amd_decode_err_code(u16 ec)\n{\n\tif (INT_ERROR(ec)) {\n\t\tpr_emerg(HW_ERR \"internal: %s\\n\", UU_MSG(ec));\n\t\treturn;\n\t}\n\n\tpr_emerg(HW_ERR \"cache level: %s\", LL_MSG(ec));\n\n\tif (BUS_ERROR(ec))\n\t\tpr_cont(\", mem/io: %s\", II_MSG(ec));\n\telse\n\t\tpr_cont(\", tx: %s\", TT_MSG(ec));\n\n\tif (MEM_ERROR(ec) || BUS_ERROR(ec)) {\n\t\tpr_cont(\", mem-tx: %s\", R4_MSG(ec));\n\n\t\tif (BUS_ERROR(ec))\n\t\t\tpr_cont(\", part-proc: %s (%s)\", PP_MSG(ec), TO_MSG(ec));\n\t}\n\n\tpr_cont(\"\\n\");\n}\n\nstatic const char *decode_error_status(struct mce *m)\n{\n\tif (m->status & MCI_STATUS_UC) {\n\t\tif (m->status & MCI_STATUS_PCC)\n\t\t\treturn \"System Fatal error.\";\n\t\tif (m->mcgstatus & MCG_STATUS_RIPV)\n\t\t\treturn \"Uncorrected, software restartable error.\";\n\t\treturn \"Uncorrected, software containable error.\";\n\t}\n\n\tif (m->status & MCI_STATUS_DEFERRED)\n\t\treturn \"Deferred error, no action required.\";\n\n\treturn \"Corrected error, no action required.\";\n}\n\nstatic int\namd_decode_mce(struct notifier_block *nb, unsigned long val, void *data)\n{\n\tstruct mce *m = (struct mce *)data;\n\tunsigned int fam = x86_family(m->cpuid);\n\tint ecc;\n\n\tif (m->kflags & MCE_HANDLED_CEC)\n\t\treturn NOTIFY_DONE;\n\n\tpr_emerg(HW_ERR \"%s\\n\", decode_error_status(m));\n\n\tpr_emerg(HW_ERR \"CPU:%d (%x:%x:%x) MC%d_STATUS[%s|%s|%s|%s|%s\",\n\t\tm->extcpu,\n\t\tfam, x86_model(m->cpuid), x86_stepping(m->cpuid),\n\t\tm->bank,\n\t\t((m->status & MCI_STATUS_OVER)\t? \"Over\"  : \"-\"),\n\t\t((m->status & MCI_STATUS_UC)\t? \"UE\"\t  :\n\t\t (m->status & MCI_STATUS_DEFERRED) ? \"-\"  : \"CE\"),\n\t\t((m->status & MCI_STATUS_MISCV)\t? \"MiscV\" : \"-\"),\n\t\t((m->status & MCI_STATUS_ADDRV)\t? \"AddrV\" : \"-\"),\n\t\t((m->status & MCI_STATUS_PCC)\t? \"PCC\"\t  : \"-\"));\n\n\tif (boot_cpu_has(X86_FEATURE_SMCA)) {\n\t\tu32 low, high;\n\t\tu32 addr = MSR_AMD64_SMCA_MCx_CONFIG(m->bank);\n\n\t\tif (!rdmsr_safe(addr, &low, &high) &&\n\t\t    (low & MCI_CONFIG_MCAX))\n\t\t\tpr_cont(\"|%s\", ((m->status & MCI_STATUS_TCC) ? \"TCC\" : \"-\"));\n\n\t\tpr_cont(\"|%s\", ((m->status & MCI_STATUS_SYNDV) ? \"SyndV\" : \"-\"));\n\t}\n\n\t \n\tecc = (m->status >> 45) & 0x3;\n\tif (ecc)\n\t\tpr_cont(\"|%sECC\", ((ecc == 2) ? \"C\" : \"U\"));\n\n\tif (fam >= 0x15) {\n\t\tpr_cont(\"|%s\", (m->status & MCI_STATUS_DEFERRED ? \"Deferred\" : \"-\"));\n\n\t\t \n\t\tif (fam != 0x15 || m->bank != 4)\n\t\t\tpr_cont(\"|%s\", (m->status & MCI_STATUS_POISON ? \"Poison\" : \"-\"));\n\t}\n\n\tif (fam >= 0x17)\n\t\tpr_cont(\"|%s\", (m->status & MCI_STATUS_SCRUB ? \"Scrub\" : \"-\"));\n\n\tpr_cont(\"]: 0x%016llx\\n\", m->status);\n\n\tif (m->status & MCI_STATUS_ADDRV)\n\t\tpr_emerg(HW_ERR \"Error Addr: 0x%016llx\\n\", m->addr);\n\n\tif (m->ppin)\n\t\tpr_emerg(HW_ERR \"PPIN: 0x%016llx\\n\", m->ppin);\n\n\tif (boot_cpu_has(X86_FEATURE_SMCA)) {\n\t\tpr_emerg(HW_ERR \"IPID: 0x%016llx\", m->ipid);\n\n\t\tif (m->status & MCI_STATUS_SYNDV)\n\t\t\tpr_cont(\", Syndrome: 0x%016llx\", m->synd);\n\n\t\tpr_cont(\"\\n\");\n\n\t\tdecode_smca_error(m);\n\t\tgoto err_code;\n\t}\n\n\tif (m->tsc)\n\t\tpr_emerg(HW_ERR \"TSC: %llu\\n\", m->tsc);\n\n\t \n\tif (!fam_ops.mc0_mce)\n\t\tgoto err_code;\n\n\tswitch (m->bank) {\n\tcase 0:\n\t\tdecode_mc0_mce(m);\n\t\tbreak;\n\n\tcase 1:\n\t\tdecode_mc1_mce(m);\n\t\tbreak;\n\n\tcase 2:\n\t\tdecode_mc2_mce(m);\n\t\tbreak;\n\n\tcase 3:\n\t\tdecode_mc3_mce(m);\n\t\tbreak;\n\n\tcase 4:\n\t\tdecode_mc4_mce(m);\n\t\tbreak;\n\n\tcase 5:\n\t\tdecode_mc5_mce(m);\n\t\tbreak;\n\n\tcase 6:\n\t\tdecode_mc6_mce(m);\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n\n err_code:\n\tamd_decode_err_code(m->status & 0xffff);\n\n\tm->kflags |= MCE_HANDLED_EDAC;\n\treturn NOTIFY_OK;\n}\n\nstatic struct notifier_block amd_mce_dec_nb = {\n\t.notifier_call\t= amd_decode_mce,\n\t.priority\t= MCE_PRIO_EDAC,\n};\n\nstatic int __init mce_amd_init(void)\n{\n\tstruct cpuinfo_x86 *c = &boot_cpu_data;\n\n\tif (c->x86_vendor != X86_VENDOR_AMD &&\n\t    c->x86_vendor != X86_VENDOR_HYGON)\n\t\treturn -ENODEV;\n\n\tif (cpu_feature_enabled(X86_FEATURE_HYPERVISOR))\n\t\treturn -ENODEV;\n\n\tif (boot_cpu_has(X86_FEATURE_SMCA)) {\n\t\txec_mask = 0x3f;\n\t\tgoto out;\n\t}\n\n\tswitch (c->x86) {\n\tcase 0xf:\n\t\tfam_ops.mc0_mce = k8_mc0_mce;\n\t\tfam_ops.mc1_mce = k8_mc1_mce;\n\t\tfam_ops.mc2_mce = k8_mc2_mce;\n\t\tbreak;\n\n\tcase 0x10:\n\t\tfam_ops.mc0_mce = f10h_mc0_mce;\n\t\tfam_ops.mc1_mce = k8_mc1_mce;\n\t\tfam_ops.mc2_mce = k8_mc2_mce;\n\t\tbreak;\n\n\tcase 0x11:\n\t\tfam_ops.mc0_mce = k8_mc0_mce;\n\t\tfam_ops.mc1_mce = k8_mc1_mce;\n\t\tfam_ops.mc2_mce = k8_mc2_mce;\n\t\tbreak;\n\n\tcase 0x12:\n\t\tfam_ops.mc0_mce = f12h_mc0_mce;\n\t\tfam_ops.mc1_mce = k8_mc1_mce;\n\t\tfam_ops.mc2_mce = k8_mc2_mce;\n\t\tbreak;\n\n\tcase 0x14:\n\t\tfam_ops.mc0_mce = cat_mc0_mce;\n\t\tfam_ops.mc1_mce = cat_mc1_mce;\n\t\tfam_ops.mc2_mce = k8_mc2_mce;\n\t\tbreak;\n\n\tcase 0x15:\n\t\txec_mask = c->x86_model == 0x60 ? 0x3f : 0x1f;\n\n\t\tfam_ops.mc0_mce = f15h_mc0_mce;\n\t\tfam_ops.mc1_mce = f15h_mc1_mce;\n\t\tfam_ops.mc2_mce = f15h_mc2_mce;\n\t\tbreak;\n\n\tcase 0x16:\n\t\txec_mask = 0x1f;\n\t\tfam_ops.mc0_mce = cat_mc0_mce;\n\t\tfam_ops.mc1_mce = cat_mc1_mce;\n\t\tfam_ops.mc2_mce = f16h_mc2_mce;\n\t\tbreak;\n\n\tcase 0x17:\n\tcase 0x18:\n\t\tpr_warn_once(\"Decoding supported only on Scalable MCA processors.\\n\");\n\t\treturn -EINVAL;\n\n\tdefault:\n\t\tprintk(KERN_WARNING \"Huh? What family is it: 0x%x?!\\n\", c->x86);\n\t\treturn -EINVAL;\n\t}\n\nout:\n\tpr_info(\"MCE: In-kernel MCE decoding enabled.\\n\");\n\n\tmce_register_decode_chain(&amd_mce_dec_nb);\n\n\treturn 0;\n}\nearly_initcall(mce_amd_init);\n\n#ifdef MODULE\nstatic void __exit mce_amd_exit(void)\n{\n\tmce_unregister_decode_chain(&amd_mce_dec_nb);\n}\n\nMODULE_DESCRIPTION(\"AMD MCE decoder\");\nMODULE_ALIAS(\"edac-mce-amd\");\nMODULE_LICENSE(\"GPL\");\nmodule_exit(mce_amd_exit);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}