{
  "module_name": "sifive_edac.c",
  "hash_id": "be35f4fab31d3e9a2f0f82ff005fd5445f4dea5dd5be477866811e4582b793a6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/edac/sifive_edac.c",
  "human_readable_source": "\n \n#include <linux/edac.h>\n#include <linux/platform_device.h>\n#include \"edac_module.h\"\n#include <soc/sifive/sifive_ccache.h>\n\n#define DRVNAME \"sifive_edac\"\n\nstruct sifive_edac_priv {\n\tstruct notifier_block notifier;\n\tstruct edac_device_ctl_info *dci;\n};\n\n \nstatic\nint ecc_err_event(struct notifier_block *this, unsigned long event, void *ptr)\n{\n\tconst char *msg = (char *)ptr;\n\tstruct sifive_edac_priv *p;\n\n\tp = container_of(this, struct sifive_edac_priv, notifier);\n\n\tif (event == SIFIVE_CCACHE_ERR_TYPE_UE)\n\t\tedac_device_handle_ue(p->dci, 0, 0, msg);\n\telse if (event == SIFIVE_CCACHE_ERR_TYPE_CE)\n\t\tedac_device_handle_ce(p->dci, 0, 0, msg);\n\n\treturn NOTIFY_OK;\n}\n\nstatic int ecc_register(struct platform_device *pdev)\n{\n\tstruct sifive_edac_priv *p;\n\n\tp = devm_kzalloc(&pdev->dev, sizeof(*p), GFP_KERNEL);\n\tif (!p)\n\t\treturn -ENOMEM;\n\n\tp->notifier.notifier_call = ecc_err_event;\n\tplatform_set_drvdata(pdev, p);\n\n\tp->dci = edac_device_alloc_ctl_info(0, \"sifive_ecc\", 1, \"sifive_ecc\",\n\t\t\t\t\t    1, 1, NULL, 0,\n\t\t\t\t\t    edac_device_alloc_index());\n\tif (!p->dci)\n\t\treturn -ENOMEM;\n\n\tp->dci->dev = &pdev->dev;\n\tp->dci->mod_name = \"Sifive ECC Manager\";\n\tp->dci->ctl_name = dev_name(&pdev->dev);\n\tp->dci->dev_name = dev_name(&pdev->dev);\n\n\tif (edac_device_add_device(p->dci)) {\n\t\tdev_err(p->dci->dev, \"failed to register with EDAC core\\n\");\n\t\tgoto err;\n\t}\n\n\tregister_sifive_ccache_error_notifier(&p->notifier);\n\n\treturn 0;\n\nerr:\n\tedac_device_free_ctl_info(p->dci);\n\n\treturn -ENXIO;\n}\n\nstatic int ecc_unregister(struct platform_device *pdev)\n{\n\tstruct sifive_edac_priv *p = platform_get_drvdata(pdev);\n\n\tunregister_sifive_ccache_error_notifier(&p->notifier);\n\tedac_device_del_device(&pdev->dev);\n\tedac_device_free_ctl_info(p->dci);\n\n\treturn 0;\n}\n\nstatic struct platform_device *sifive_pdev;\n\nstatic int __init sifive_edac_init(void)\n{\n\tint ret;\n\n\tsifive_pdev = platform_device_register_simple(DRVNAME, 0, NULL, 0);\n\tif (IS_ERR(sifive_pdev))\n\t\treturn PTR_ERR(sifive_pdev);\n\n\tret = ecc_register(sifive_pdev);\n\tif (ret)\n\t\tplatform_device_unregister(sifive_pdev);\n\n\treturn ret;\n}\n\nstatic void __exit sifive_edac_exit(void)\n{\n\tecc_unregister(sifive_pdev);\n\tplatform_device_unregister(sifive_pdev);\n}\n\nmodule_init(sifive_edac_init);\nmodule_exit(sifive_edac_exit);\n\nMODULE_AUTHOR(\"SiFive Inc.\");\nMODULE_DESCRIPTION(\"SiFive platform EDAC driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}