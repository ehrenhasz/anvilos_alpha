{
  "module_name": "regmap-ram.c",
  "hash_id": "fd1a10414ae9ab2234064437de95dd6e112b4f98b99bad3bf75297ec7c305742",
  "original_prompt": "Ingested from linux-6.6.14/drivers/base/regmap/regmap-ram.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n#include <linux/clk.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/swab.h>\n\n#include \"internal.h\"\n\nstatic int regmap_ram_write(void *context, unsigned int reg, unsigned int val)\n{\n\tstruct regmap_ram_data *data = context;\n\n\tdata->vals[reg] = val;\n\tdata->written[reg] = true;\n\n\treturn 0;\n}\n\nstatic int regmap_ram_read(void *context, unsigned int reg, unsigned int *val)\n{\n\tstruct regmap_ram_data *data = context;\n\n\t*val = data->vals[reg];\n\tdata->read[reg] = true;\n\n\treturn 0;\n}\n\nstatic void regmap_ram_free_context(void *context)\n{\n\tstruct regmap_ram_data *data = context;\n\n\tkfree(data->vals);\n\tkfree(data->read);\n\tkfree(data->written);\n\tkfree(data);\n}\n\nstatic const struct regmap_bus regmap_ram = {\n\t.fast_io = true,\n\t.reg_write = regmap_ram_write,\n\t.reg_read = regmap_ram_read,\n\t.free_context = regmap_ram_free_context,\n};\n\nstruct regmap *__regmap_init_ram(const struct regmap_config *config,\n\t\t\t\t struct regmap_ram_data *data,\n\t\t\t\t struct lock_class_key *lock_key,\n\t\t\t\t const char *lock_name)\n{\n\tstruct regmap *map;\n\n\tif (!config->max_register) {\n\t\tpr_crit(\"No max_register specified for RAM regmap\\n\");\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tdata->read = kcalloc(sizeof(bool), config->max_register + 1,\n\t\t\t     GFP_KERNEL);\n\tif (!data->read)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tdata->written = kcalloc(sizeof(bool), config->max_register + 1,\n\t\t\t\tGFP_KERNEL);\n\tif (!data->written)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tmap = __regmap_init(NULL, &regmap_ram, data, config,\n\t\t\t    lock_key, lock_name);\n\n\treturn map;\n}\nEXPORT_SYMBOL_GPL(__regmap_init_ram);\n\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}