{
  "module_name": "regmap-sdw.c",
  "hash_id": "b0655af70938fe72c9cf37d36719f7f4b77a3e1aea75ec79d9c8f3de44935ab1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/base/regmap/regmap-sdw.c",
  "human_readable_source": "\n\n\n#include <linux/device.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n#include <linux/soundwire/sdw.h>\n#include <linux/types.h>\n#include \"internal.h\"\n\nstatic int regmap_sdw_write(void *context, const void *val_buf, size_t val_size)\n{\n\tstruct device *dev = context;\n\tstruct sdw_slave *slave = dev_to_sdw_dev(dev);\n\t \n\tu32 addr = le32_to_cpu(*(const __le32 *)val_buf);\n\tconst u8 *val = val_buf;\n\n\treturn sdw_nwrite_no_pm(slave, addr, val_size - sizeof(addr), val + sizeof(addr));\n}\n\nstatic int regmap_sdw_gather_write(void *context,\n\t\t\t\t   const void *reg_buf, size_t reg_size,\n\t\t\t\t   const void *val_buf, size_t val_size)\n{\n\tstruct device *dev = context;\n\tstruct sdw_slave *slave = dev_to_sdw_dev(dev);\n\tu32 addr = le32_to_cpu(*(const __le32 *)reg_buf);\n\n\treturn sdw_nwrite_no_pm(slave, addr, val_size, val_buf);\n}\n\nstatic int regmap_sdw_read(void *context,\n\t\t\t   const void *reg_buf, size_t reg_size,\n\t\t\t   void *val_buf, size_t val_size)\n{\n\tstruct device *dev = context;\n\tstruct sdw_slave *slave = dev_to_sdw_dev(dev);\n\tu32 addr = le32_to_cpu(*(const __le32 *)reg_buf);\n\n\treturn sdw_nread_no_pm(slave, addr, val_size, val_buf);\n}\n\nstatic const struct regmap_bus regmap_sdw = {\n\t.write = regmap_sdw_write,\n\t.gather_write = regmap_sdw_gather_write,\n\t.read = regmap_sdw_read,\n\t.reg_format_endian_default = REGMAP_ENDIAN_LITTLE,\n\t.val_format_endian_default = REGMAP_ENDIAN_LITTLE,\n};\n\nstatic int regmap_sdw_config_check(const struct regmap_config *config)\n{\n\t \n\tif (config->reg_bits != 32)\n\t\treturn -ENOTSUPP;\n\n\tif (config->pad_bits != 0)\n\t\treturn -ENOTSUPP;\n\n\t \n\tif (config->can_multi_write)\n\t\treturn -ENOTSUPP;\n\n\treturn 0;\n}\n\nstruct regmap *__regmap_init_sdw(struct sdw_slave *sdw,\n\t\t\t\t const struct regmap_config *config,\n\t\t\t\t struct lock_class_key *lock_key,\n\t\t\t\t const char *lock_name)\n{\n\tint ret;\n\n\tret = regmap_sdw_config_check(config);\n\tif (ret)\n\t\treturn ERR_PTR(ret);\n\n\treturn __regmap_init(&sdw->dev, &regmap_sdw,\n\t\t\t&sdw->dev, config, lock_key, lock_name);\n}\nEXPORT_SYMBOL_GPL(__regmap_init_sdw);\n\nstruct regmap *__devm_regmap_init_sdw(struct sdw_slave *sdw,\n\t\t\t\t      const struct regmap_config *config,\n\t\t\t\t      struct lock_class_key *lock_key,\n\t\t\t\t      const char *lock_name)\n{\n\tint ret;\n\n\tret = regmap_sdw_config_check(config);\n\tif (ret)\n\t\treturn ERR_PTR(ret);\n\n\treturn __devm_regmap_init(&sdw->dev, &regmap_sdw,\n\t\t\t&sdw->dev, config, lock_key, lock_name);\n}\nEXPORT_SYMBOL_GPL(__devm_regmap_init_sdw);\n\nMODULE_DESCRIPTION(\"Regmap SoundWire Module\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}