{
  "module_name": "internal.h",
  "hash_id": "aa4864759e8a4dfd67a972797545e7c20854816b98afd2be58c1433bc47894b7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/base/regmap/internal.h",
  "human_readable_source": " \n \n\n#ifndef _REGMAP_INTERNAL_H\n#define _REGMAP_INTERNAL_H\n\n#include <linux/device.h>\n#include <linux/regmap.h>\n#include <linux/fs.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n\nstruct regmap;\nstruct regcache_ops;\n\nstruct regmap_debugfs_off_cache {\n\tstruct list_head list;\n\toff_t min;\n\toff_t max;\n\tunsigned int base_reg;\n\tunsigned int max_reg;\n};\n\nstruct regmap_format {\n\tsize_t buf_size;\n\tsize_t reg_bytes;\n\tsize_t pad_bytes;\n\tsize_t val_bytes;\n\ts8 reg_shift;\n\tvoid (*format_write)(struct regmap *map,\n\t\t\t     unsigned int reg, unsigned int val);\n\tvoid (*format_reg)(void *buf, unsigned int reg, unsigned int shift);\n\tvoid (*format_val)(void *buf, unsigned int val, unsigned int shift);\n\tunsigned int (*parse_val)(const void *buf);\n\tvoid (*parse_inplace)(void *buf);\n};\n\nstruct regmap_async {\n\tstruct list_head list;\n\tstruct regmap *map;\n\tvoid *work_buf;\n};\n\nstruct regmap {\n\tunion {\n\t\tstruct mutex mutex;\n\t\tstruct {\n\t\t\tspinlock_t spinlock;\n\t\t\tunsigned long spinlock_flags;\n\t\t};\n\t\tstruct {\n\t\t\traw_spinlock_t raw_spinlock;\n\t\t\tunsigned long raw_spinlock_flags;\n\t\t};\n\t};\n\tregmap_lock lock;\n\tregmap_unlock unlock;\n\tvoid *lock_arg;  \n\tgfp_t alloc_flags;\n\tunsigned int reg_base;\n\n\tstruct device *dev;  \n\tvoid *work_buf;      \n\tstruct regmap_format format;   \n\tconst struct regmap_bus *bus;\n\tvoid *bus_context;\n\tconst char *name;\n\n\tbool async;\n\tspinlock_t async_lock;\n\twait_queue_head_t async_waitq;\n\tstruct list_head async_list;\n\tstruct list_head async_free;\n\tint async_ret;\n\n#ifdef CONFIG_DEBUG_FS\n\tbool debugfs_disable;\n\tstruct dentry *debugfs;\n\tconst char *debugfs_name;\n\n\tunsigned int debugfs_reg_len;\n\tunsigned int debugfs_val_len;\n\tunsigned int debugfs_tot_len;\n\n\tstruct list_head debugfs_off_cache;\n\tstruct mutex cache_lock;\n#endif\n\n\tunsigned int max_register;\n\tbool (*writeable_reg)(struct device *dev, unsigned int reg);\n\tbool (*readable_reg)(struct device *dev, unsigned int reg);\n\tbool (*volatile_reg)(struct device *dev, unsigned int reg);\n\tbool (*precious_reg)(struct device *dev, unsigned int reg);\n\tbool (*writeable_noinc_reg)(struct device *dev, unsigned int reg);\n\tbool (*readable_noinc_reg)(struct device *dev, unsigned int reg);\n\tconst struct regmap_access_table *wr_table;\n\tconst struct regmap_access_table *rd_table;\n\tconst struct regmap_access_table *volatile_table;\n\tconst struct regmap_access_table *precious_table;\n\tconst struct regmap_access_table *wr_noinc_table;\n\tconst struct regmap_access_table *rd_noinc_table;\n\n\tint (*reg_read)(void *context, unsigned int reg, unsigned int *val);\n\tint (*reg_write)(void *context, unsigned int reg, unsigned int val);\n\tint (*reg_update_bits)(void *context, unsigned int reg,\n\t\t\t       unsigned int mask, unsigned int val);\n\t \n\tint (*read)(void *context, const void *reg_buf, size_t reg_size,\n\t\t    void *val_buf, size_t val_size);\n\tint (*write)(void *context, const void *data, size_t count);\n\n\tbool defer_caching;\n\n\tunsigned long read_flag_mask;\n\tunsigned long write_flag_mask;\n\n\t \n\tint reg_shift;\n\tint reg_stride;\n\tint reg_stride_order;\n\n\t \n\tbool force_write_field;\n\n\t \n\tconst struct regcache_ops *cache_ops;\n\tenum regcache_type cache_type;\n\n\t \n\tunsigned int cache_size_raw;\n\t \n\tunsigned int cache_word_size;\n\t \n\tunsigned int num_reg_defaults;\n\t \n\tunsigned int num_reg_defaults_raw;\n\n\t \n\tbool cache_only;\n\t \n\tbool cache_bypass;\n\t \n\tbool cache_free;\n\n\tstruct reg_default *reg_defaults;\n\tconst void *reg_defaults_raw;\n\tvoid *cache;\n\t \n\tbool cache_dirty;\n\t \n\tbool no_sync_defaults;\n\n\tstruct reg_sequence *patch;\n\tint patch_regs;\n\n\t \n\tbool use_single_read;\n\t \n\tbool use_single_write;\n\t \n\tbool can_multi_write;\n\n\t \n\tsize_t max_raw_read;\n\tsize_t max_raw_write;\n\n\tstruct rb_root range_tree;\n\tvoid *selector_work_buf;\t \n\n\tstruct hwspinlock *hwlock;\n\n\t \n\tbool can_sleep;\n};\n\nstruct regcache_ops {\n\tconst char *name;\n\tenum regcache_type type;\n\tint (*init)(struct regmap *map);\n\tint (*exit)(struct regmap *map);\n#ifdef CONFIG_DEBUG_FS\n\tvoid (*debugfs_init)(struct regmap *map);\n#endif\n\tint (*read)(struct regmap *map, unsigned int reg, unsigned int *value);\n\tint (*write)(struct regmap *map, unsigned int reg, unsigned int value);\n\tint (*sync)(struct regmap *map, unsigned int min, unsigned int max);\n\tint (*drop)(struct regmap *map, unsigned int min, unsigned int max);\n};\n\nbool regmap_cached(struct regmap *map, unsigned int reg);\nbool regmap_writeable(struct regmap *map, unsigned int reg);\nbool regmap_readable(struct regmap *map, unsigned int reg);\nbool regmap_volatile(struct regmap *map, unsigned int reg);\nbool regmap_precious(struct regmap *map, unsigned int reg);\nbool regmap_writeable_noinc(struct regmap *map, unsigned int reg);\nbool regmap_readable_noinc(struct regmap *map, unsigned int reg);\n\nint _regmap_write(struct regmap *map, unsigned int reg,\n\t\t  unsigned int val);\n\nstruct regmap_range_node {\n\tstruct rb_node node;\n\tconst char *name;\n\tstruct regmap *map;\n\n\tunsigned int range_min;\n\tunsigned int range_max;\n\n\tunsigned int selector_reg;\n\tunsigned int selector_mask;\n\tint selector_shift;\n\n\tunsigned int window_start;\n\tunsigned int window_len;\n};\n\nstruct regmap_field {\n\tstruct regmap *regmap;\n\tunsigned int mask;\n\t \n\tunsigned int shift;\n\tunsigned int reg;\n\n\tunsigned int id_size;\n\tunsigned int id_offset;\n};\n\n#ifdef CONFIG_DEBUG_FS\nextern void regmap_debugfs_initcall(void);\nextern void regmap_debugfs_init(struct regmap *map);\nextern void regmap_debugfs_exit(struct regmap *map);\n\nstatic inline void regmap_debugfs_disable(struct regmap *map)\n{\n\tmap->debugfs_disable = true;\n}\n\n#else\nstatic inline void regmap_debugfs_initcall(void) { }\nstatic inline void regmap_debugfs_init(struct regmap *map) { }\nstatic inline void regmap_debugfs_exit(struct regmap *map) { }\nstatic inline void regmap_debugfs_disable(struct regmap *map) { }\n#endif\n\n \nint regcache_init(struct regmap *map, const struct regmap_config *config);\nvoid regcache_exit(struct regmap *map);\nint regcache_read(struct regmap *map,\n\t\t       unsigned int reg, unsigned int *value);\nint regcache_write(struct regmap *map,\n\t\t\tunsigned int reg, unsigned int value);\nint regcache_sync(struct regmap *map);\nint regcache_sync_block(struct regmap *map, void *block,\n\t\t\tunsigned long *cache_present,\n\t\t\tunsigned int block_base, unsigned int start,\n\t\t\tunsigned int end);\nbool regcache_reg_needs_sync(struct regmap *map, unsigned int reg,\n\t\t\t     unsigned int val);\n\nstatic inline const void *regcache_get_val_addr(struct regmap *map,\n\t\t\t\t\t\tconst void *base,\n\t\t\t\t\t\tunsigned int idx)\n{\n\treturn base + (map->cache_word_size * idx);\n}\n\nunsigned int regcache_get_val(struct regmap *map, const void *base,\n\t\t\t      unsigned int idx);\nvoid regcache_set_val(struct regmap *map, void *base, unsigned int idx,\n\t\t      unsigned int val);\nint regcache_lookup_reg(struct regmap *map, unsigned int reg);\nint regcache_sync_val(struct regmap *map, unsigned int reg, unsigned int val);\n\nint _regmap_raw_write(struct regmap *map, unsigned int reg,\n\t\t      const void *val, size_t val_len, bool noinc);\n\nvoid regmap_async_complete_cb(struct regmap_async *async, int ret);\n\nenum regmap_endian regmap_get_val_endian(struct device *dev,\n\t\t\t\t\t const struct regmap_bus *bus,\n\t\t\t\t\t const struct regmap_config *config);\n\nextern struct regcache_ops regcache_rbtree_ops;\nextern struct regcache_ops regcache_maple_ops;\nextern struct regcache_ops regcache_flat_ops;\n\nstatic inline const char *regmap_name(const struct regmap *map)\n{\n\tif (map->dev)\n\t\treturn dev_name(map->dev);\n\n\treturn map->name;\n}\n\nstatic inline unsigned int regmap_get_offset(const struct regmap *map,\n\t\t\t\t\t     unsigned int index)\n{\n\tif (map->reg_stride_order >= 0)\n\t\treturn index << map->reg_stride_order;\n\telse\n\t\treturn index * map->reg_stride;\n}\n\nstatic inline unsigned int regcache_get_index_by_order(const struct regmap *map,\n\t\t\t\t\t\t       unsigned int reg)\n{\n\treturn reg >> map->reg_stride_order;\n}\n\nstruct regmap_ram_data {\n\tunsigned int *vals;   \n\tbool *read;\n\tbool *written;\n\tenum regmap_endian reg_endian;\n};\n\n \nstruct regmap *__regmap_init_ram(const struct regmap_config *config,\n\t\t\t\t struct regmap_ram_data *data,\n\t\t\t\t struct lock_class_key *lock_key,\n\t\t\t\t const char *lock_name);\n\n#define regmap_init_ram(config, data)\t\t\t\t\t\\\n\t__regmap_lockdep_wrapper(__regmap_init_ram, #config, config, data)\n\nstruct regmap *__regmap_init_raw_ram(const struct regmap_config *config,\n\t\t\t\t     struct regmap_ram_data *data,\n\t\t\t\t     struct lock_class_key *lock_key,\n\t\t\t\t     const char *lock_name);\n\n#define regmap_init_raw_ram(config, data)\t\t\t\t\\\n\t__regmap_lockdep_wrapper(__regmap_init_raw_ram, #config, config, data)\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}