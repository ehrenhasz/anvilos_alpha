{
  "module_name": "regmap-mdio.c",
  "hash_id": "63b7ee32a187f9d10eab43ab128e5cdba49df74fce754ae82027cf54fe3d4763",
  "original_prompt": "Ingested from linux-6.6.14/drivers/base/regmap/regmap-mdio.c",
  "human_readable_source": "\n\n#include <linux/errno.h>\n#include <linux/mdio.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n\n#define REGVAL_MASK\t\tGENMASK(15, 0)\n#define REGNUM_C22_MASK\t\tGENMASK(4, 0)\n \n#define REGNUM_C45_MASK\t\tGENMASK(20, 0)\n\nstatic int regmap_mdio_c22_read(void *context, unsigned int reg, unsigned int *val)\n{\n\tstruct mdio_device *mdio_dev = context;\n\tint ret;\n\n\tif (unlikely(reg & ~REGNUM_C22_MASK))\n\t\treturn -ENXIO;\n\n\tret = mdiodev_read(mdio_dev, reg);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t*val = ret & REGVAL_MASK;\n\n\treturn 0;\n}\n\nstatic int regmap_mdio_c22_write(void *context, unsigned int reg, unsigned int val)\n{\n\tstruct mdio_device *mdio_dev = context;\n\n\tif (unlikely(reg & ~REGNUM_C22_MASK))\n\t\treturn -ENXIO;\n\n\treturn mdiodev_write(mdio_dev, reg, val);\n}\n\nstatic const struct regmap_bus regmap_mdio_c22_bus = {\n\t.reg_write = regmap_mdio_c22_write,\n\t.reg_read = regmap_mdio_c22_read,\n};\n\nstatic int regmap_mdio_c45_read(void *context, unsigned int reg, unsigned int *val)\n{\n\tstruct mdio_device *mdio_dev = context;\n\tunsigned int devad;\n\tint ret;\n\n\tif (unlikely(reg & ~REGNUM_C45_MASK))\n\t\treturn -ENXIO;\n\n\tdevad = reg >> REGMAP_MDIO_C45_DEVAD_SHIFT;\n\treg = reg & REGMAP_MDIO_C45_REGNUM_MASK;\n\n\tret = mdiodev_c45_read(mdio_dev, devad, reg);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t*val = ret & REGVAL_MASK;\n\n\treturn 0;\n}\n\nstatic int regmap_mdio_c45_write(void *context, unsigned int reg, unsigned int val)\n{\n\tstruct mdio_device *mdio_dev = context;\n\tunsigned int devad;\n\n\tif (unlikely(reg & ~REGNUM_C45_MASK))\n\t\treturn -ENXIO;\n\n\tdevad = reg >> REGMAP_MDIO_C45_DEVAD_SHIFT;\n\treg = reg & REGMAP_MDIO_C45_REGNUM_MASK;\n\n\treturn mdiodev_c45_write(mdio_dev, devad, reg, val);\n}\n\nstatic const struct regmap_bus regmap_mdio_c45_bus = {\n\t.reg_write = regmap_mdio_c45_write,\n\t.reg_read = regmap_mdio_c45_read,\n};\n\nstruct regmap *__regmap_init_mdio(struct mdio_device *mdio_dev,\n\tconst struct regmap_config *config, struct lock_class_key *lock_key,\n\tconst char *lock_name)\n{\n\tconst struct regmap_bus *bus;\n\n\tif (config->reg_bits == 5 && config->val_bits == 16)\n\t\tbus = &regmap_mdio_c22_bus;\n\telse if (config->reg_bits == 21 && config->val_bits == 16)\n\t\tbus = &regmap_mdio_c45_bus;\n\telse\n\t\treturn ERR_PTR(-EOPNOTSUPP);\n\n\treturn __regmap_init(&mdio_dev->dev, bus, mdio_dev, config, lock_key, lock_name);\n}\nEXPORT_SYMBOL_GPL(__regmap_init_mdio);\n\nstruct regmap *__devm_regmap_init_mdio(struct mdio_device *mdio_dev,\n\tconst struct regmap_config *config, struct lock_class_key *lock_key,\n\tconst char *lock_name)\n{\n\tconst struct regmap_bus *bus;\n\n\tif (config->reg_bits == 5 && config->val_bits == 16)\n\t\tbus = &regmap_mdio_c22_bus;\n\telse if (config->reg_bits == 21 && config->val_bits == 16)\n\t\tbus = &regmap_mdio_c45_bus;\n\telse\n\t\treturn ERR_PTR(-EOPNOTSUPP);\n\n\treturn __devm_regmap_init(&mdio_dev->dev, bus, mdio_dev, config, lock_key, lock_name);\n}\nEXPORT_SYMBOL_GPL(__devm_regmap_init_mdio);\n\nMODULE_AUTHOR(\"Sander Vanheule <sander@svanheule.net>\");\nMODULE_DESCRIPTION(\"Regmap MDIO Module\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}