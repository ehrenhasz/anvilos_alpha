{
  "module_name": "regmap-sdw-mbq.c",
  "hash_id": "012b1bfa288ce5343b5f311c96639f100e3c787ef74af6c728088055926800d3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/base/regmap/regmap-sdw-mbq.c",
  "human_readable_source": "\n\n\n#include <linux/device.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n#include <linux/soundwire/sdw.h>\n#include <linux/soundwire/sdw_registers.h>\n#include \"internal.h\"\n\nstatic int regmap_sdw_mbq_write(void *context, unsigned int reg, unsigned int val)\n{\n\tstruct device *dev = context;\n\tstruct sdw_slave *slave = dev_to_sdw_dev(dev);\n\tint ret;\n\n\tret = sdw_write_no_pm(slave, SDW_SDCA_MBQ_CTL(reg), (val >> 8) & 0xff);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn sdw_write_no_pm(slave, reg, val & 0xff);\n}\n\nstatic int regmap_sdw_mbq_read(void *context, unsigned int reg, unsigned int *val)\n{\n\tstruct device *dev = context;\n\tstruct sdw_slave *slave = dev_to_sdw_dev(dev);\n\tint read0;\n\tint read1;\n\n\tread0 = sdw_read_no_pm(slave, reg);\n\tif (read0 < 0)\n\t\treturn read0;\n\n\tread1 = sdw_read_no_pm(slave, SDW_SDCA_MBQ_CTL(reg));\n\tif (read1 < 0)\n\t\treturn read1;\n\n\t*val = (read1 << 8) | read0;\n\n\treturn 0;\n}\n\nstatic const struct regmap_bus regmap_sdw_mbq = {\n\t.reg_read = regmap_sdw_mbq_read,\n\t.reg_write = regmap_sdw_mbq_write,\n\t.reg_format_endian_default = REGMAP_ENDIAN_LITTLE,\n\t.val_format_endian_default = REGMAP_ENDIAN_LITTLE,\n};\n\nstatic int regmap_sdw_mbq_config_check(const struct regmap_config *config)\n{\n\t \n\tif (config->val_bits != 16)\n\t\treturn -ENOTSUPP;\n\n\t \n\tif (config->reg_bits != 32)\n\t\treturn -ENOTSUPP;\n\n\tif (config->pad_bits != 0)\n\t\treturn -ENOTSUPP;\n\n\treturn 0;\n}\n\nstruct regmap *__regmap_init_sdw_mbq(struct sdw_slave *sdw,\n\t\t\t\t     const struct regmap_config *config,\n\t\t\t\t     struct lock_class_key *lock_key,\n\t\t\t\t     const char *lock_name)\n{\n\tint ret;\n\n\tret = regmap_sdw_mbq_config_check(config);\n\tif (ret)\n\t\treturn ERR_PTR(ret);\n\n\treturn __regmap_init(&sdw->dev, &regmap_sdw_mbq,\n\t\t\t&sdw->dev, config, lock_key, lock_name);\n}\nEXPORT_SYMBOL_GPL(__regmap_init_sdw_mbq);\n\nstruct regmap *__devm_regmap_init_sdw_mbq(struct sdw_slave *sdw,\n\t\t\t\t\t  const struct regmap_config *config,\n\t\t\t\t\t  struct lock_class_key *lock_key,\n\t\t\t\t\t  const char *lock_name)\n{\n\tint ret;\n\n\tret = regmap_sdw_mbq_config_check(config);\n\tif (ret)\n\t\treturn ERR_PTR(ret);\n\n\treturn __devm_regmap_init(&sdw->dev, &regmap_sdw_mbq,\n\t\t\t&sdw->dev, config, lock_key, lock_name);\n}\nEXPORT_SYMBOL_GPL(__devm_regmap_init_sdw_mbq);\n\nMODULE_DESCRIPTION(\"Regmap SoundWire MBQ Module\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}