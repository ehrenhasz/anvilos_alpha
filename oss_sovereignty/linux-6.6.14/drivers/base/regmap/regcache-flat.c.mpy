{
  "module_name": "regcache-flat.c",
  "hash_id": "5c066f44534ec84d7b141ec05a59d90b91a822f78a4aa779583639befdc3fba1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/base/regmap/regcache-flat.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n#include <linux/device.h>\n#include <linux/seq_file.h>\n#include <linux/slab.h>\n\n#include \"internal.h\"\n\nstatic inline unsigned int regcache_flat_get_index(const struct regmap *map,\n\t\t\t\t\t\t   unsigned int reg)\n{\n\treturn regcache_get_index_by_order(map, reg);\n}\n\nstatic int regcache_flat_init(struct regmap *map)\n{\n\tint i;\n\tunsigned int *cache;\n\n\tif (!map || map->reg_stride_order < 0 || !map->max_register)\n\t\treturn -EINVAL;\n\n\tmap->cache = kcalloc(regcache_flat_get_index(map, map->max_register)\n\t\t\t     + 1, sizeof(unsigned int), GFP_KERNEL);\n\tif (!map->cache)\n\t\treturn -ENOMEM;\n\n\tcache = map->cache;\n\n\tfor (i = 0; i < map->num_reg_defaults; i++) {\n\t\tunsigned int reg = map->reg_defaults[i].reg;\n\t\tunsigned int index = regcache_flat_get_index(map, reg);\n\n\t\tcache[index] = map->reg_defaults[i].def;\n\t}\n\n\treturn 0;\n}\n\nstatic int regcache_flat_exit(struct regmap *map)\n{\n\tkfree(map->cache);\n\tmap->cache = NULL;\n\n\treturn 0;\n}\n\nstatic int regcache_flat_read(struct regmap *map,\n\t\t\t      unsigned int reg, unsigned int *value)\n{\n\tunsigned int *cache = map->cache;\n\tunsigned int index = regcache_flat_get_index(map, reg);\n\n\t*value = cache[index];\n\n\treturn 0;\n}\n\nstatic int regcache_flat_write(struct regmap *map, unsigned int reg,\n\t\t\t       unsigned int value)\n{\n\tunsigned int *cache = map->cache;\n\tunsigned int index = regcache_flat_get_index(map, reg);\n\n\tcache[index] = value;\n\n\treturn 0;\n}\n\nstruct regcache_ops regcache_flat_ops = {\n\t.type = REGCACHE_FLAT,\n\t.name = \"flat\",\n\t.init = regcache_flat_init,\n\t.exit = regcache_flat_exit,\n\t.read = regcache_flat_read,\n\t.write = regcache_flat_write,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}