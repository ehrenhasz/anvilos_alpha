{
  "module_name": "module.c",
  "hash_id": "e4cffe1c9ea74b924fa3bf522c44aa435c0f0f49fc03b7bae7c0a2ff00c63793",
  "original_prompt": "Ingested from linux-6.6.14/drivers/base/module.c",
  "human_readable_source": "\n \n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include \"base.h\"\n\nstatic char *make_driver_name(struct device_driver *drv)\n{\n\tchar *driver_name;\n\n\tdriver_name = kasprintf(GFP_KERNEL, \"%s:%s\", drv->bus->name, drv->name);\n\tif (!driver_name)\n\t\treturn NULL;\n\n\treturn driver_name;\n}\n\nstatic void module_create_drivers_dir(struct module_kobject *mk)\n{\n\tstatic DEFINE_MUTEX(drivers_dir_mutex);\n\n\tmutex_lock(&drivers_dir_mutex);\n\tif (mk && !mk->drivers_dir)\n\t\tmk->drivers_dir = kobject_create_and_add(\"drivers\", &mk->kobj);\n\tmutex_unlock(&drivers_dir_mutex);\n}\n\nvoid module_add_driver(struct module *mod, struct device_driver *drv)\n{\n\tchar *driver_name;\n\tint no_warn;\n\tstruct module_kobject *mk = NULL;\n\n\tif (!drv)\n\t\treturn;\n\n\tif (mod)\n\t\tmk = &mod->mkobj;\n\telse if (drv->mod_name) {\n\t\tstruct kobject *mkobj;\n\n\t\t \n\t\tmkobj = kset_find_obj(module_kset, drv->mod_name);\n\t\tif (mkobj) {\n\t\t\tmk = container_of(mkobj, struct module_kobject, kobj);\n\t\t\t \n\t\t\tdrv->p->mkobj = mk;\n\t\t\t \n\t\t\tkobject_put(mkobj);\n\t\t}\n\t}\n\n\tif (!mk)\n\t\treturn;\n\n\t \n\tno_warn = sysfs_create_link(&drv->p->kobj, &mk->kobj, \"module\");\n\tdriver_name = make_driver_name(drv);\n\tif (driver_name) {\n\t\tmodule_create_drivers_dir(mk);\n\t\tno_warn = sysfs_create_link(mk->drivers_dir, &drv->p->kobj,\n\t\t\t\t\t    driver_name);\n\t\tkfree(driver_name);\n\t}\n}\n\nvoid module_remove_driver(struct device_driver *drv)\n{\n\tstruct module_kobject *mk = NULL;\n\tchar *driver_name;\n\n\tif (!drv)\n\t\treturn;\n\n\tsysfs_remove_link(&drv->p->kobj, \"module\");\n\n\tif (drv->owner)\n\t\tmk = &drv->owner->mkobj;\n\telse if (drv->p->mkobj)\n\t\tmk = drv->p->mkobj;\n\tif (mk && mk->drivers_dir) {\n\t\tdriver_name = make_driver_name(drv);\n\t\tif (driver_name) {\n\t\t\tsysfs_remove_link(mk->drivers_dir, driver_name);\n\t\t\tkfree(driver_name);\n\t\t}\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}