{
  "module_name": "digsy_mtc_eeprom.c",
  "hash_id": "be10b99a2610313a4a1aa7c088149e8567518de88bd7b65e1874505e7bc641ff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/eeprom/digsy_mtc_eeprom.c",
  "human_readable_source": "\n \n\n#include <linux/gpio.h>\n#include <linux/gpio/machine.h>\n#include <linux/init.h>\n#include <linux/platform_device.h>\n#include <linux/spi/spi.h>\n#include <linux/spi/spi_gpio.h>\n#include <linux/eeprom_93xx46.h>\n\n#define GPIO_EEPROM_CLK\t\t216\n#define GPIO_EEPROM_CS\t\t210\n#define GPIO_EEPROM_DI\t\t217\n#define GPIO_EEPROM_DO\t\t249\n#define GPIO_EEPROM_OE\t\t255\n#define EE_SPI_BUS_NUM\t1\n\nstatic void digsy_mtc_op_prepare(void *p)\n{\n\t \n\tgpio_set_value(GPIO_EEPROM_OE, 0);\n}\n\nstatic void digsy_mtc_op_finish(void *p)\n{\n\t \n\tgpio_set_value(GPIO_EEPROM_OE, 1);\n}\n\nstruct eeprom_93xx46_platform_data digsy_mtc_eeprom_data = {\n\t.flags\t\t= EE_ADDR8,\n\t.prepare\t= digsy_mtc_op_prepare,\n\t.finish\t\t= digsy_mtc_op_finish,\n};\n\nstatic struct spi_gpio_platform_data eeprom_spi_gpio_data = {\n\t.num_chipselect\t= 1,\n};\n\nstatic struct platform_device digsy_mtc_eeprom = {\n\t.name\t= \"spi_gpio\",\n\t.id\t= EE_SPI_BUS_NUM,\n\t.dev\t= {\n\t\t.platform_data\t= &eeprom_spi_gpio_data,\n\t},\n};\n\nstatic struct gpiod_lookup_table eeprom_spi_gpiod_table = {\n\t.dev_id         = \"spi_gpio\",\n\t.table          = {\n\t\tGPIO_LOOKUP(\"gpio@b00\", GPIO_EEPROM_CLK,\n\t\t\t    \"sck\", GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP(\"gpio@b00\", GPIO_EEPROM_DI,\n\t\t\t    \"mosi\", GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP(\"gpio@b00\", GPIO_EEPROM_DO,\n\t\t\t    \"miso\", GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP(\"gpio@b00\", GPIO_EEPROM_CS,\n\t\t\t    \"cs\", GPIO_ACTIVE_HIGH),\n\t\t{ },\n\t},\n};\n\nstatic struct spi_board_info digsy_mtc_eeprom_info[] __initdata = {\n\t{\n\t\t.modalias\t\t= \"93xx46\",\n\t\t.max_speed_hz\t\t= 1000000,\n\t\t.bus_num\t\t= EE_SPI_BUS_NUM,\n\t\t.chip_select\t\t= 0,\n\t\t.mode\t\t\t= SPI_MODE_0,\n\t\t.platform_data\t\t= &digsy_mtc_eeprom_data,\n\t},\n};\n\nstatic int __init digsy_mtc_eeprom_devices_init(void)\n{\n\tint ret;\n\n\tret = gpio_request_one(GPIO_EEPROM_OE, GPIOF_OUT_INIT_HIGH,\n\t\t\t\t\"93xx46 EEPROMs OE\");\n\tif (ret) {\n\t\tpr_err(\"can't request gpio %d\\n\", GPIO_EEPROM_OE);\n\t\treturn ret;\n\t}\n\tgpiod_add_lookup_table(&eeprom_spi_gpiod_table);\n\tspi_register_board_info(digsy_mtc_eeprom_info,\n\t\t\t\tARRAY_SIZE(digsy_mtc_eeprom_info));\n\treturn platform_device_register(&digsy_mtc_eeprom);\n}\ndevice_initcall(digsy_mtc_eeprom_devices_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}