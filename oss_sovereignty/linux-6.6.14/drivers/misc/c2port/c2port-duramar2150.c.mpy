{
  "module_name": "c2port-duramar2150.c",
  "hash_id": "6daea17edc2d577754e629979f0ab394117cba62b75485e84190674f0e1d34ad",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/c2port/c2port-duramar2150.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/delay.h>\n#include <linux/io.h>\n#include <linux/ioport.h>\n#include <linux/c2port.h>\n\n#define DATA_PORT\t0x325\n#define DIR_PORT\t0x326\n#define    C2D\t\t   (1 << 0)\n#define    C2CK\t\t   (1 << 1)\n\nstatic DEFINE_MUTEX(update_lock);\n\n \n\nstatic void duramar2150_c2port_access(struct c2port_device *dev, int status)\n{\n\tu8 v;\n\n\tmutex_lock(&update_lock);\n\n\tv = inb(DIR_PORT);\n\n\t \n\tif (status)\n\t\toutb(v | (C2D | C2CK), DIR_PORT);\n\telse\n\t\t \n\t\toutb(v & ~(C2D | C2CK), DIR_PORT);\n\n\tmutex_unlock(&update_lock);\n}\n\nstatic void duramar2150_c2port_c2d_dir(struct c2port_device *dev, int dir)\n{\n\tu8 v;\n\n\tmutex_lock(&update_lock);\n\n\tv = inb(DIR_PORT);\n\n\tif (dir)\n\t\toutb(v & ~C2D, DIR_PORT);\n\telse\n\t\toutb(v | C2D, DIR_PORT);\n\n\tmutex_unlock(&update_lock);\n}\n\nstatic int duramar2150_c2port_c2d_get(struct c2port_device *dev)\n{\n\treturn inb(DATA_PORT) & C2D;\n}\n\nstatic void duramar2150_c2port_c2d_set(struct c2port_device *dev, int status)\n{\n\tu8 v;\n\n\tmutex_lock(&update_lock);\n\n\tv = inb(DATA_PORT);\n\n\tif (status)\n\t\toutb(v | C2D, DATA_PORT);\n\telse\n\t\toutb(v & ~C2D, DATA_PORT);\n\n\tmutex_unlock(&update_lock);\n}\n\nstatic void duramar2150_c2port_c2ck_set(struct c2port_device *dev, int status)\n{\n\tu8 v;\n\n\tmutex_lock(&update_lock);\n\n\tv = inb(DATA_PORT);\n\n\tif (status)\n\t\toutb(v | C2CK, DATA_PORT);\n\telse\n\t\toutb(v & ~C2CK, DATA_PORT);\n\n\tmutex_unlock(&update_lock);\n}\n\nstatic struct c2port_ops duramar2150_c2port_ops = {\n\t.block_size\t= 512,\t \n\t.blocks_num\t= 30,\t \n\n\t.access\t\t= duramar2150_c2port_access,\n\t.c2d_dir\t= duramar2150_c2port_c2d_dir,\n\t.c2d_get\t= duramar2150_c2port_c2d_get,\n\t.c2d_set\t= duramar2150_c2port_c2d_set,\n\t.c2ck_set\t= duramar2150_c2port_c2ck_set,\n};\n\nstatic struct c2port_device *duramar2150_c2port_dev;\n\n \n\nstatic int __init duramar2150_c2port_init(void)\n{\n\tstruct resource *res;\n\tint ret = 0;\n\n\tres = request_region(0x325, 2, \"c2port\");\n\tif (!res)\n\t\treturn -EBUSY;\n\n\tduramar2150_c2port_dev = c2port_device_register(\"uc\",\n\t\t\t\t\t&duramar2150_c2port_ops, NULL);\n\tif (IS_ERR(duramar2150_c2port_dev)) {\n\t\tret = PTR_ERR(duramar2150_c2port_dev);\n\t\tgoto free_region;\n\t}\n\n\treturn 0;\n\nfree_region:\n\trelease_region(0x325, 2);\n\treturn ret;\n}\n\nstatic void __exit duramar2150_c2port_exit(void)\n{\n\t \n\tduramar2150_c2port_access(duramar2150_c2port_dev, 0);\n\n\tc2port_device_unregister(duramar2150_c2port_dev);\n\n\trelease_region(0x325, 2);\n}\n\nmodule_init(duramar2150_c2port_init);\nmodule_exit(duramar2150_c2port_exit);\n\nMODULE_AUTHOR(\"Rodolfo Giometti <giometti@linux.it>\");\nMODULE_DESCRIPTION(\"Silicon Labs C2 port Linux support for Duramar 2150\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}