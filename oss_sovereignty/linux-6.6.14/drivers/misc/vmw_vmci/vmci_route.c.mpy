{
  "module_name": "vmci_route.c",
  "hash_id": "65f084e79285abebc930db415ac8caac684cb546a947251803e1768a8f22fd7a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/vmw_vmci/vmci_route.c",
  "human_readable_source": "\n \n\n#include <linux/vmw_vmci_defs.h>\n#include <linux/vmw_vmci_api.h>\n\n#include \"vmci_context.h\"\n#include \"vmci_driver.h\"\n#include \"vmci_route.h\"\n\n \nint vmci_route(struct vmci_handle *src,\n\t       const struct vmci_handle *dst,\n\t       bool from_guest,\n\t       enum vmci_route *route)\n{\n\tbool has_host_device = vmci_host_code_active();\n\tbool has_guest_device = vmci_guest_code_active();\n\n\t*route = VMCI_ROUTE_NONE;\n\n\t \n\n\t \n\tif (VMCI_INVALID_ID == dst->context)\n\t\treturn VMCI_ERROR_INVALID_ARGS;\n\n\t \n\tif (VMCI_HYPERVISOR_CONTEXT_ID == dst->context) {\n\n\t\t \n\t\tif (from_guest)\n\t\t\treturn VMCI_ERROR_DST_UNREACHABLE;\n\n\t\t \n\t\tif (!has_guest_device)\n\t\t\treturn VMCI_ERROR_DEVICE_NOT_FOUND;\n\n\t\t \n\t\tif (VMCI_HOST_CONTEXT_ID == src->context)\n\t\t\treturn VMCI_ERROR_INVALID_ARGS;\n\n\t\t \n\t\tif (VMCI_INVALID_ID == src->context &&\n\t\t    VMCI_INVALID_ID != src->resource)\n\t\t\tsrc->context = vmci_get_context_id();\n\n\t\t \n\t\t*route = VMCI_ROUTE_AS_GUEST;\n\t\treturn VMCI_SUCCESS;\n\t}\n\n\t \n\tif (VMCI_HOST_CONTEXT_ID == dst->context) {\n\t\t \n\t\tif (src->context == VMCI_HYPERVISOR_CONTEXT_ID) {\n\t\t\t \n\n\t\t\tif (has_host_device) {\n\t\t\t\t*route = VMCI_ROUTE_AS_HOST;\n\t\t\t\treturn VMCI_SUCCESS;\n\t\t\t} else {\n\t\t\t\treturn VMCI_ERROR_DEVICE_NOT_FOUND;\n\t\t\t}\n\t\t}\n\n\t\tif (!from_guest && has_guest_device) {\n\t\t\t \n\t\t\tif (VMCI_INVALID_ID == src->context)\n\t\t\t\tsrc->context = vmci_get_context_id();\n\n\t\t\t \n\t\t\t*route = VMCI_ROUTE_AS_GUEST;\n\t\t\treturn VMCI_SUCCESS;\n\t\t}\n\n\t\t \n\t\tif (!has_host_device)\n\t\t\treturn VMCI_ERROR_DEVICE_NOT_FOUND;\n\n\t\tif (VMCI_INVALID_ID == src->context) {\n\t\t\t \n\t\t\tif (from_guest)\n\t\t\t\treturn VMCI_ERROR_INVALID_ARGS;\n\n\t\t\tsrc->context = VMCI_HOST_CONTEXT_ID;\n\t\t}\n\n\t\t \n\t\t*route = VMCI_ROUTE_AS_HOST;\n\t\treturn VMCI_SUCCESS;\n\t}\n\n\t \n\tif (has_host_device) {\n\t\t \n\t\tif (vmci_ctx_exists(dst->context)) {\n\t\t\tif (VMCI_INVALID_ID == src->context) {\n\t\t\t\t \n\n\t\t\t\tif (from_guest)\n\t\t\t\t\treturn VMCI_ERROR_INVALID_ARGS;\n\n\t\t\t\tsrc->context = VMCI_HOST_CONTEXT_ID;\n\t\t\t} else if (VMCI_CONTEXT_IS_VM(src->context) &&\n\t\t\t\t   src->context != dst->context) {\n\t\t\t\t \n\n\t\t\t\treturn VMCI_ERROR_DST_UNREACHABLE;\n\t\t\t}\n\n\t\t\t \n\t\t\t*route = VMCI_ROUTE_AS_HOST;\n\t\t\treturn VMCI_SUCCESS;\n\t\t} else if (!has_guest_device) {\n\t\t\t \n\n\t\t\treturn VMCI_ERROR_DST_UNREACHABLE;\n\t\t}\n\t}\n\n\t \n\tif (!has_guest_device) {\n\t\t \n\t\treturn VMCI_ERROR_DEVICE_NOT_FOUND;\n\t}\n\n\t \n\tif (VMCI_INVALID_ID == src->context)\n\t\tsrc->context = vmci_get_context_id();\n\n\t \n\t*route = VMCI_ROUTE_AS_GUEST;\n\treturn VMCI_SUCCESS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}