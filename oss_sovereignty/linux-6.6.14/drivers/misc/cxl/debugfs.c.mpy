{
  "module_name": "debugfs.c",
  "hash_id": "2dea56785a7ee8bb1276fd712bd916630aff1f0517a6b9cfdfe1cf4e997cfd86",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/cxl/debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n\n#include \"cxl.h\"\n\nstatic struct dentry *cxl_debugfs;\n\n \nstatic int debugfs_io_u64_get(void *data, u64 *val)\n{\n\t*val = in_be64((u64 __iomem *)data);\n\treturn 0;\n}\n\nstatic int debugfs_io_u64_set(void *data, u64 val)\n{\n\tout_be64((u64 __iomem *)data, val);\n\treturn 0;\n}\nDEFINE_DEBUGFS_ATTRIBUTE(fops_io_x64, debugfs_io_u64_get, debugfs_io_u64_set,\n\t\t\t \"0x%016llx\\n\");\n\nstatic void debugfs_create_io_x64(const char *name, umode_t mode,\n\t\t\t\t  struct dentry *parent, u64 __iomem *value)\n{\n\tdebugfs_create_file_unsafe(name, mode, parent, (void __force *)value,\n\t\t\t\t   &fops_io_x64);\n}\n\nvoid cxl_debugfs_add_adapter_regs_psl9(struct cxl *adapter, struct dentry *dir)\n{\n\tdebugfs_create_io_x64(\"fir1\", S_IRUSR, dir, _cxl_p1_addr(adapter, CXL_PSL9_FIR1));\n\tdebugfs_create_io_x64(\"fir_mask\", 0400, dir,\n\t\t\t      _cxl_p1_addr(adapter, CXL_PSL9_FIR_MASK));\n\tdebugfs_create_io_x64(\"fir_cntl\", S_IRUSR, dir, _cxl_p1_addr(adapter, CXL_PSL9_FIR_CNTL));\n\tdebugfs_create_io_x64(\"trace\", S_IRUSR | S_IWUSR, dir, _cxl_p1_addr(adapter, CXL_PSL9_TRACECFG));\n\tdebugfs_create_io_x64(\"debug\", 0600, dir,\n\t\t\t      _cxl_p1_addr(adapter, CXL_PSL9_DEBUG));\n\tdebugfs_create_io_x64(\"xsl-debug\", 0600, dir,\n\t\t\t      _cxl_p1_addr(adapter, CXL_XSL9_DBG));\n}\n\nvoid cxl_debugfs_add_adapter_regs_psl8(struct cxl *adapter, struct dentry *dir)\n{\n\tdebugfs_create_io_x64(\"fir1\", S_IRUSR, dir, _cxl_p1_addr(adapter, CXL_PSL_FIR1));\n\tdebugfs_create_io_x64(\"fir2\", S_IRUSR, dir, _cxl_p1_addr(adapter, CXL_PSL_FIR2));\n\tdebugfs_create_io_x64(\"fir_cntl\", S_IRUSR, dir, _cxl_p1_addr(adapter, CXL_PSL_FIR_CNTL));\n\tdebugfs_create_io_x64(\"trace\", S_IRUSR | S_IWUSR, dir, _cxl_p1_addr(adapter, CXL_PSL_TRACE));\n}\n\nvoid cxl_debugfs_adapter_add(struct cxl *adapter)\n{\n\tstruct dentry *dir;\n\tchar buf[32];\n\n\tif (!cxl_debugfs)\n\t\treturn;\n\n\tsnprintf(buf, 32, \"card%i\", adapter->adapter_num);\n\tdir = debugfs_create_dir(buf, cxl_debugfs);\n\tadapter->debugfs = dir;\n\n\tdebugfs_create_io_x64(\"err_ivte\", S_IRUSR, dir, _cxl_p1_addr(adapter, CXL_PSL_ErrIVTE));\n\n\tif (adapter->native->sl_ops->debugfs_add_adapter_regs)\n\t\tadapter->native->sl_ops->debugfs_add_adapter_regs(adapter, dir);\n}\n\nvoid cxl_debugfs_adapter_remove(struct cxl *adapter)\n{\n\tdebugfs_remove_recursive(adapter->debugfs);\n}\n\nvoid cxl_debugfs_add_afu_regs_psl9(struct cxl_afu *afu, struct dentry *dir)\n{\n\tdebugfs_create_io_x64(\"serr\", S_IRUSR, dir, _cxl_p1n_addr(afu, CXL_PSL_SERR_An));\n}\n\nvoid cxl_debugfs_add_afu_regs_psl8(struct cxl_afu *afu, struct dentry *dir)\n{\n\tdebugfs_create_io_x64(\"sstp0\", S_IRUSR, dir, _cxl_p2n_addr(afu, CXL_SSTP0_An));\n\tdebugfs_create_io_x64(\"sstp1\", S_IRUSR, dir, _cxl_p2n_addr(afu, CXL_SSTP1_An));\n\n\tdebugfs_create_io_x64(\"fir\", S_IRUSR, dir, _cxl_p1n_addr(afu, CXL_PSL_FIR_SLICE_An));\n\tdebugfs_create_io_x64(\"serr\", S_IRUSR, dir, _cxl_p1n_addr(afu, CXL_PSL_SERR_An));\n\tdebugfs_create_io_x64(\"afu_debug\", S_IRUSR, dir, _cxl_p1n_addr(afu, CXL_AFU_DEBUG_An));\n\tdebugfs_create_io_x64(\"trace\", S_IRUSR | S_IWUSR, dir, _cxl_p1n_addr(afu, CXL_PSL_SLICE_TRACE));\n}\n\nvoid cxl_debugfs_afu_add(struct cxl_afu *afu)\n{\n\tstruct dentry *dir;\n\tchar buf[32];\n\n\tif (!afu->adapter->debugfs)\n\t\treturn;\n\n\tsnprintf(buf, 32, \"psl%i.%i\", afu->adapter->adapter_num, afu->slice);\n\tdir = debugfs_create_dir(buf, afu->adapter->debugfs);\n\tafu->debugfs = dir;\n\n\tdebugfs_create_io_x64(\"sr\",         S_IRUSR, dir, _cxl_p1n_addr(afu, CXL_PSL_SR_An));\n\tdebugfs_create_io_x64(\"dsisr\",      S_IRUSR, dir, _cxl_p2n_addr(afu, CXL_PSL_DSISR_An));\n\tdebugfs_create_io_x64(\"dar\",        S_IRUSR, dir, _cxl_p2n_addr(afu, CXL_PSL_DAR_An));\n\n\tdebugfs_create_io_x64(\"err_status\", S_IRUSR, dir, _cxl_p2n_addr(afu, CXL_PSL_ErrStat_An));\n\n\tif (afu->adapter->native->sl_ops->debugfs_add_afu_regs)\n\t\tafu->adapter->native->sl_ops->debugfs_add_afu_regs(afu, dir);\n}\n\nvoid cxl_debugfs_afu_remove(struct cxl_afu *afu)\n{\n\tdebugfs_remove_recursive(afu->debugfs);\n}\n\nvoid __init cxl_debugfs_init(void)\n{\n\tif (!cpu_has_feature(CPU_FTR_HVMODE))\n\t\treturn;\n\n\tcxl_debugfs = debugfs_create_dir(\"cxl\", NULL);\n}\n\nvoid cxl_debugfs_exit(void)\n{\n\tdebugfs_remove_recursive(cxl_debugfs);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}