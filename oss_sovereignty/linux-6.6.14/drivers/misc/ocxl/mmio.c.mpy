{
  "module_name": "mmio.c",
  "hash_id": "81da66d14dacbe182eeb9ae83c1e61513a6ac09e1352fd94fe7f3b8d6fddf5fa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/ocxl/mmio.c",
  "human_readable_source": "\n\n#include <linux/sched/mm.h>\n#include \"trace.h\"\n#include \"ocxl_internal.h\"\n\nint ocxl_global_mmio_read32(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u32 *val)\n{\n\tif (offset > afu->config.global_mmio_size - 4)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\t*val = readl_be((char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\t*val = readl((char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_read32);\n\nint ocxl_global_mmio_read64(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u64 *val)\n{\n\tif (offset > afu->config.global_mmio_size - 8)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\t*val = readq_be((char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\t*val = readq((char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_read64);\n\nint ocxl_global_mmio_write32(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u32 val)\n{\n\tif (offset > afu->config.global_mmio_size - 4)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\twritel_be(val, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\twritel(val, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_write32);\n\nint ocxl_global_mmio_write64(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u64 val)\n{\n\tif (offset > afu->config.global_mmio_size - 8)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\twriteq_be(val, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\twriteq(val, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_write64);\n\nint ocxl_global_mmio_set32(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u32 mask)\n{\n\tu32 tmp;\n\n\tif (offset > afu->config.global_mmio_size - 4)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\ttmp = readl_be((char *)afu->global_mmio_ptr + offset);\n\t\ttmp |= mask;\n\t\twritel_be(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\ttmp = readl((char *)afu->global_mmio_ptr + offset);\n\t\ttmp |= mask;\n\t\twritel(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_set32);\n\nint ocxl_global_mmio_set64(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u64 mask)\n{\n\tu64 tmp;\n\n\tif (offset > afu->config.global_mmio_size - 8)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\ttmp = readq_be((char *)afu->global_mmio_ptr + offset);\n\t\ttmp |= mask;\n\t\twriteq_be(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\ttmp = readq((char *)afu->global_mmio_ptr + offset);\n\t\ttmp |= mask;\n\t\twriteq(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_set64);\n\nint ocxl_global_mmio_clear32(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u32 mask)\n{\n\tu32 tmp;\n\n\tif (offset > afu->config.global_mmio_size - 4)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\ttmp = readl_be((char *)afu->global_mmio_ptr + offset);\n\t\ttmp &= ~mask;\n\t\twritel_be(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\ttmp = readl((char *)afu->global_mmio_ptr + offset);\n\t\ttmp &= ~mask;\n\t\twritel(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_clear32);\n\nint ocxl_global_mmio_clear64(struct ocxl_afu *afu, size_t offset,\n\t\t\t\tenum ocxl_endian endian, u64 mask)\n{\n\tu64 tmp;\n\n\tif (offset > afu->config.global_mmio_size - 8)\n\t\treturn -EINVAL;\n\n#ifdef __BIG_ENDIAN__\n\tif (endian == OCXL_HOST_ENDIAN)\n\t\tendian = OCXL_BIG_ENDIAN;\n#endif\n\n\tswitch (endian) {\n\tcase OCXL_BIG_ENDIAN:\n\t\ttmp = readq_be((char *)afu->global_mmio_ptr + offset);\n\t\ttmp &= ~mask;\n\t\twriteq_be(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\n\tdefault:\n\t\ttmp = readq((char *)afu->global_mmio_ptr + offset);\n\t\ttmp &= ~mask;\n\t\twriteq(tmp, (char *)afu->global_mmio_ptr + offset);\n\t\tbreak;\n\t}\n\n\twriteq(tmp, (char *)afu->global_mmio_ptr + offset);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(ocxl_global_mmio_clear64);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}