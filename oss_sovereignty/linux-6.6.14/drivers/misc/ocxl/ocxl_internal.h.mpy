{
  "module_name": "ocxl_internal.h",
  "hash_id": "d0684bde7c7180f1bc25d6a74233584cfe8295987017261f575a69f8cb1130b8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/ocxl/ocxl_internal.h",
  "human_readable_source": " \n\n#ifndef _OCXL_INTERNAL_H_\n#define _OCXL_INTERNAL_H_\n\n#include <linux/pci.h>\n#include <linux/cdev.h>\n#include <linux/list.h>\n#include <misc/ocxl.h>\n\n#define MAX_IRQ_PER_LINK\t2000\n#define MAX_IRQ_PER_CONTEXT\tMAX_IRQ_PER_LINK\n\nextern struct pci_driver ocxl_pci_driver;\n\nstruct ocxl_fn {\n\tstruct device dev;\n\tint bar_used[3];\n\tstruct ocxl_fn_config config;\n\tstruct list_head afu_list;\n\tint pasid_base;\n\tint actag_base;\n\tint actag_enabled;\n\tint actag_supported;\n\tstruct list_head pasid_list;\n\tstruct list_head actag_list;\n\tvoid *link;\n};\n\nstruct ocxl_file_info {\n\tstruct ocxl_afu *afu;\n\tstruct device dev;\n\tstruct cdev cdev;\n\tstruct bin_attribute attr_global_mmio;\n};\n\nstruct ocxl_afu {\n\tstruct kref kref;\n\tstruct ocxl_fn *fn;\n\tstruct list_head list;\n\tstruct ocxl_afu_config config;\n\tint pasid_base;\n\tint pasid_count;  \n\tint pasid_max;  \n\tint actag_base;\n\tint actag_enabled;\n\tstruct mutex contexts_lock;\n\tstruct idr contexts_idr;\n\tstruct mutex afu_control_lock;\n\tu64 global_mmio_start;\n\tu64 irq_base_offset;\n\tvoid __iomem *global_mmio_ptr;\n\tu64 pp_mmio_start;\n\tvoid *private;\n};\n\nenum ocxl_context_status {\n\tCLOSED,\n\tOPENED,\n\tATTACHED,\n};\n\n\nstruct ocxl_xsl_error {\n\tu64 addr; \n\tu64 dsisr; \n\tu64 count; \n};\n\nstruct ocxl_context {\n\tstruct ocxl_afu *afu;\n\tint pasid;\n\tstruct mutex status_mutex;\n\tenum ocxl_context_status status;\n\tstruct address_space *mapping;\n\tstruct mutex mapping_lock;\n\twait_queue_head_t events_wq;\n\tstruct mutex xsl_error_lock;\n\tstruct ocxl_xsl_error xsl_error;\n\tstruct mutex irq_lock;\n\tstruct idr irq_idr;\n\tu16 tidr; \n};\n\nstruct ocxl_process_element {\n\t__be64 config_state;\n\t__be32 pasid;\n\t__be16 bdf;\n\t__be16 reserved1;\n\t__be32 reserved2[9];\n\t__be32 lpid;\n\t__be32 tid;\n\t__be32 pid;\n\t__be32 reserved3[10];\n\t__be64 amr;\n\t__be32 reserved4[3];\n\t__be32 software_state;\n};\n\nint ocxl_create_cdev(struct ocxl_afu *afu);\nvoid ocxl_destroy_cdev(struct ocxl_afu *afu);\nint ocxl_file_register_afu(struct ocxl_afu *afu);\nvoid ocxl_file_unregister_afu(struct ocxl_afu *afu);\n\nint ocxl_file_init(void);\nvoid ocxl_file_exit(void);\n\nint ocxl_pasid_afu_alloc(struct ocxl_fn *fn, u32 size);\nvoid ocxl_pasid_afu_free(struct ocxl_fn *fn, u32 start, u32 size);\nint ocxl_actag_afu_alloc(struct ocxl_fn *fn, u32 size);\nvoid ocxl_actag_afu_free(struct ocxl_fn *fn, u32 start, u32 size);\n\n \nint ocxl_config_get_pasid_info(struct pci_dev *dev, int *count);\n\n \nint ocxl_config_get_reset_reload(struct pci_dev *dev, int *val);\nint ocxl_config_set_reset_reload(struct pci_dev *dev, int val);\n\n \nint ocxl_config_check_afu_index(struct pci_dev *dev,\n\t\t\t\tstruct ocxl_fn_config *fn, int afu_idx);\n\n \nint ocxl_link_update_pe(void *link_handle, int pasid, __u16 tid);\n\nint ocxl_context_mmap(struct ocxl_context *ctx,\n\t\t\tstruct vm_area_struct *vma);\nvoid ocxl_context_detach_all(struct ocxl_afu *afu);\n\nint ocxl_sysfs_register_afu(struct ocxl_file_info *info);\nvoid ocxl_sysfs_unregister_afu(struct ocxl_file_info *info);\n\nint ocxl_irq_offset_to_id(struct ocxl_context *ctx, u64 offset);\nu64 ocxl_irq_id_to_offset(struct ocxl_context *ctx, int irq_id);\nvoid ocxl_afu_irq_free_all(struct ocxl_context *ctx);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}