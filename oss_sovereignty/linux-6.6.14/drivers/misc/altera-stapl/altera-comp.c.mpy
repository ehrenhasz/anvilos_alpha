{
  "module_name": "altera-comp.c",
  "hash_id": "e8463e4629f0b7efed4e694bc8d6009a69ec5157c10b03ea80aa0aa186fe7e56",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/altera-stapl/altera-comp.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include \"altera-exprt.h\"\n\n#define\tSHORT_BITS\t\t16\n#define\tCHAR_BITS\t\t8\n#define\tDATA_BLOB_LENGTH\t3\n#define\tMATCH_DATA_LENGTH\t8192\n#define ALTERA_REQUEST_SIZE\t1024\n#define ALTERA_BUFFER_SIZE\t(MATCH_DATA_LENGTH + ALTERA_REQUEST_SIZE)\n\nstatic u32 altera_bits_req(u32 n)\n{\n\tu32 result = SHORT_BITS;\n\n\tif (n == 0)\n\t\tresult = 1;\n\telse {\n\t\t \n\t\twhile ((n & (1 << (SHORT_BITS - 1))) == 0) {\n\t\t\tn <<= 1;\n\t\t\t--result;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nstatic u32 altera_read_packed(u8 *buffer, u32 bits, u32 *bits_avail,\n\t\t\t\t\t\t\tu32 *in_index)\n{\n\tu32 result = 0;\n\tu32 shift = 0;\n\tu32 databyte = 0;\n\n\twhile (bits > 0) {\n\t\tdatabyte = buffer[*in_index];\n\t\tresult |= (((databyte >> (CHAR_BITS - *bits_avail))\n\t\t\t& (0xff >> (CHAR_BITS - *bits_avail))) << shift);\n\n\t\tif (bits <= *bits_avail) {\n\t\t\tresult &= (0xffff >> (SHORT_BITS - (bits + shift)));\n\t\t\t*bits_avail -= bits;\n\t\t\tbits = 0;\n\t\t} else {\n\t\t\t++(*in_index);\n\t\t\tshift += *bits_avail;\n\t\t\tbits -= *bits_avail;\n\t\t\t*bits_avail = CHAR_BITS;\n\t\t}\n\t}\n\n\treturn result;\n}\n\nu32 altera_shrink(u8 *in, u32 in_length, u8 *out, u32 out_length, s32 version)\n{\n\tu32 i, j, data_length = 0L;\n\tu32 offset, length;\n\tu32 match_data_length = MATCH_DATA_LENGTH;\n\tu32 bits_avail = CHAR_BITS;\n\tu32 in_index = 0L;\n\n\tif (version > 0)\n\t\t--match_data_length;\n\n\tfor (i = 0; i < out_length; ++i)\n\t\tout[i] = 0;\n\n\t \n\tfor (i = 0; i < sizeof(in_length); ++i) {\n\t\tdata_length = data_length | (\n\t\t\taltera_read_packed(in,\n\t\t\t\t\tCHAR_BITS,\n\t\t\t\t\t&bits_avail,\n\t\t\t\t\t&in_index) << (i * CHAR_BITS));\n\t}\n\n\tif (data_length > out_length) {\n\t\tdata_length = 0L;\n\t\treturn data_length;\n\t}\n\n\ti = 0;\n\twhile (i < data_length) {\n\t\t \n\t\tif (altera_read_packed(in, 1, &bits_avail,\n\t\t\t\t\t\t&in_index) == 0) {\n\t\t\tfor (j = 0; j < DATA_BLOB_LENGTH; ++j) {\n\t\t\t\tif (i < data_length) {\n\t\t\t\t\tout[i] = (u8)altera_read_packed(in,\n\t\t\t\t\t\t\tCHAR_BITS,\n\t\t\t\t\t\t\t&bits_avail,\n\t\t\t\t\t\t\t&in_index);\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t \n\t\t\toffset = altera_read_packed(in, altera_bits_req((s16)\n\t\t\t\t\t(i > match_data_length ?\n\t\t\t\t\t\tmatch_data_length : i)),\n\t\t\t\t\t&bits_avail,\n\t\t\t\t\t&in_index);\n\t\t\tlength = altera_read_packed(in, CHAR_BITS,\n\t\t\t\t\t&bits_avail,\n\t\t\t\t\t&in_index);\n\t\t\tfor (j = 0; j < length; ++j) {\n\t\t\t\tif (i < data_length) {\n\t\t\t\t\tout[i] = out[i - offset];\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn data_length;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}