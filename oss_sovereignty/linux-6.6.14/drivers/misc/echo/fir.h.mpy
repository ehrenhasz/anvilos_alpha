{
  "module_name": "fir.h",
  "hash_id": "9d27acae438edcaf871390e84b38f6c7e732c79ca54da93f680d7fe96c4087c2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/misc/echo/fir.h",
  "human_readable_source": " \n \n\n#if !defined(_FIR_H_)\n#define _FIR_H_\n\n \n\n \nstruct fir16_state_t {\n\tint taps;\n\tint curr_pos;\n\tconst int16_t *coeffs;\n\tint16_t *history;\n};\n\n \nstruct fir32_state_t {\n\tint taps;\n\tint curr_pos;\n\tconst int32_t *coeffs;\n\tint16_t *history;\n};\n\n \nstruct fir_float_state_t {\n\tint taps;\n\tint curr_pos;\n\tconst float *coeffs;\n\tfloat *history;\n};\n\nstatic inline const int16_t *fir16_create(struct fir16_state_t *fir,\n\t\t\t\t\t      const int16_t *coeffs, int taps)\n{\n\tfir->taps = taps;\n\tfir->curr_pos = taps - 1;\n\tfir->coeffs = coeffs;\n\tfir->history = kcalloc(taps, sizeof(int16_t), GFP_KERNEL);\n\treturn fir->history;\n}\n\nstatic inline void fir16_flush(struct fir16_state_t *fir)\n{\n\tmemset(fir->history, 0, fir->taps * sizeof(int16_t));\n}\n\nstatic inline void fir16_free(struct fir16_state_t *fir)\n{\n\tkfree(fir->history);\n}\n\nstatic inline int16_t fir16(struct fir16_state_t *fir, int16_t sample)\n{\n\tint32_t y;\n\tint i;\n\tint offset1;\n\tint offset2;\n\n\tfir->history[fir->curr_pos] = sample;\n\n\toffset2 = fir->curr_pos;\n\toffset1 = fir->taps - offset2;\n\ty = 0;\n\tfor (i = fir->taps - 1; i >= offset1; i--)\n\t\ty += fir->coeffs[i] * fir->history[i - offset1];\n\tfor (; i >= 0; i--)\n\t\ty += fir->coeffs[i] * fir->history[i + offset2];\n\tif (fir->curr_pos <= 0)\n\t\tfir->curr_pos = fir->taps;\n\tfir->curr_pos--;\n\treturn (int16_t) (y >> 15);\n}\n\nstatic inline const int16_t *fir32_create(struct fir32_state_t *fir,\n\t\t\t\t\t      const int32_t *coeffs, int taps)\n{\n\tfir->taps = taps;\n\tfir->curr_pos = taps - 1;\n\tfir->coeffs = coeffs;\n\tfir->history = kcalloc(taps, sizeof(int16_t), GFP_KERNEL);\n\treturn fir->history;\n}\n\nstatic inline void fir32_flush(struct fir32_state_t *fir)\n{\n\tmemset(fir->history, 0, fir->taps * sizeof(int16_t));\n}\n\nstatic inline void fir32_free(struct fir32_state_t *fir)\n{\n\tkfree(fir->history);\n}\n\nstatic inline int16_t fir32(struct fir32_state_t *fir, int16_t sample)\n{\n\tint i;\n\tint32_t y;\n\tint offset1;\n\tint offset2;\n\n\tfir->history[fir->curr_pos] = sample;\n\toffset2 = fir->curr_pos;\n\toffset1 = fir->taps - offset2;\n\ty = 0;\n\tfor (i = fir->taps - 1; i >= offset1; i--)\n\t\ty += fir->coeffs[i] * fir->history[i - offset1];\n\tfor (; i >= 0; i--)\n\t\ty += fir->coeffs[i] * fir->history[i + offset2];\n\tif (fir->curr_pos <= 0)\n\t\tfir->curr_pos = fir->taps;\n\tfir->curr_pos--;\n\treturn (int16_t) (y >> 15);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}