{
  "module_name": "virtio_pci_common.h",
  "hash_id": "7aef2a673990a23758e4a0d4d732d76370e76bf995cb3e28988c938b301c9b19",
  "original_prompt": "Ingested from linux-6.6.14/drivers/virtio/virtio_pci_common.h",
  "human_readable_source": " \n#ifndef _DRIVERS_VIRTIO_VIRTIO_PCI_COMMON_H\n#define _DRIVERS_VIRTIO_VIRTIO_PCI_COMMON_H\n \n\n#include <linux/module.h>\n#include <linux/list.h>\n#include <linux/pci.h>\n#include <linux/slab.h>\n#include <linux/interrupt.h>\n#include <linux/virtio.h>\n#include <linux/virtio_config.h>\n#include <linux/virtio_ring.h>\n#include <linux/virtio_pci.h>\n#include <linux/virtio_pci_legacy.h>\n#include <linux/virtio_pci_modern.h>\n#include <linux/highmem.h>\n#include <linux/spinlock.h>\n\nstruct virtio_pci_vq_info {\n\t \n\tstruct virtqueue *vq;\n\n\t \n\tstruct list_head node;\n\n\t \n\tunsigned int msix_vector;\n};\n\n \nstruct virtio_pci_device {\n\tstruct virtio_device vdev;\n\tstruct pci_dev *pci_dev;\n\tunion {\n\t\tstruct virtio_pci_legacy_device ldev;\n\t\tstruct virtio_pci_modern_device mdev;\n\t};\n\tbool is_legacy;\n\n\t \n\tu8 __iomem *isr;\n\n\t \n\tspinlock_t lock;\n\tstruct list_head virtqueues;\n\n\t \n\tstruct virtio_pci_vq_info **vqs;\n\n\t \n\tint msix_enabled;\n\tint intx_enabled;\n\tcpumask_var_t *msix_affinity_masks;\n\t \n\tchar (*msix_names)[256];\n\t \n\tunsigned int msix_vectors;\n\t \n\tunsigned int msix_used_vectors;\n\n\t \n\tbool per_vq_vectors;\n\n\tstruct virtqueue *(*setup_vq)(struct virtio_pci_device *vp_dev,\n\t\t\t\t      struct virtio_pci_vq_info *info,\n\t\t\t\t      unsigned int idx,\n\t\t\t\t      void (*callback)(struct virtqueue *vq),\n\t\t\t\t      const char *name,\n\t\t\t\t      bool ctx,\n\t\t\t\t      u16 msix_vec);\n\tvoid (*del_vq)(struct virtio_pci_vq_info *info);\n\n\tu16 (*config_vector)(struct virtio_pci_device *vp_dev, u16 vector);\n};\n\n \n \nenum {\n\tVP_MSIX_CONFIG_VECTOR = 0,\n\tVP_MSIX_VQ_VECTOR = 1,\n};\n\n \nstatic struct virtio_pci_device *to_vp_device(struct virtio_device *vdev)\n{\n\treturn container_of(vdev, struct virtio_pci_device, vdev);\n}\n\n \nvoid vp_synchronize_vectors(struct virtio_device *vdev);\n \nbool vp_notify(struct virtqueue *vq);\n \nvoid vp_del_vqs(struct virtio_device *vdev);\n \nint vp_find_vqs(struct virtio_device *vdev, unsigned int nvqs,\n\t\tstruct virtqueue *vqs[], vq_callback_t *callbacks[],\n\t\tconst char * const names[], const bool *ctx,\n\t\tstruct irq_affinity *desc);\nconst char *vp_bus_name(struct virtio_device *vdev);\n\n \nint vp_set_vq_affinity(struct virtqueue *vq, const struct cpumask *cpu_mask);\n\nconst struct cpumask *vp_get_vq_affinity(struct virtio_device *vdev, int index);\n\n#if IS_ENABLED(CONFIG_VIRTIO_PCI_LEGACY)\nint virtio_pci_legacy_probe(struct virtio_pci_device *);\nvoid virtio_pci_legacy_remove(struct virtio_pci_device *);\n#else\nstatic inline int virtio_pci_legacy_probe(struct virtio_pci_device *vp_dev)\n{\n\treturn -ENODEV;\n}\nstatic inline void virtio_pci_legacy_remove(struct virtio_pci_device *vp_dev)\n{\n}\n#endif\nint virtio_pci_modern_probe(struct virtio_pci_device *);\nvoid virtio_pci_modern_remove(struct virtio_pci_device *);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}