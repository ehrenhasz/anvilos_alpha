{
  "module_name": "hisi_uncore_pmu.h",
  "hash_id": "f8d8ce71d16043a41f7715cd179e5bed76013f11f4ef1c89d1c4031b79792326",
  "original_prompt": "Ingested from linux-6.6.14/drivers/perf/hisilicon/hisi_uncore_pmu.h",
  "human_readable_source": " \n \n#ifndef __HISI_UNCORE_PMU_H__\n#define __HISI_UNCORE_PMU_H__\n\n#include <linux/bitfield.h>\n#include <linux/cpumask.h>\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/perf_event.h>\n#include <linux/platform_device.h>\n#include <linux/types.h>\n\n#undef pr_fmt\n#define pr_fmt(fmt)     \"hisi_pmu: \" fmt\n\n#define HISI_PMU_V2\t\t0x30\n#define HISI_MAX_COUNTERS 0x10\n#define to_hisi_pmu(p)\t(container_of(p, struct hisi_pmu, pmu))\n\n#define HISI_PMU_ATTR(_name, _func, _config)\t\t\t\t\\\n\t(&((struct dev_ext_attribute[]) {\t\t\t\t\\\n\t\t{ __ATTR(_name, 0444, _func, NULL), (void *)_config }   \\\n\t})[0].attr.attr)\n\n#define HISI_PMU_FORMAT_ATTR(_name, _config)\t\t\\\n\tHISI_PMU_ATTR(_name, hisi_format_sysfs_show, (void *)_config)\n#define HISI_PMU_EVENT_ATTR(_name, _config)\t\t\\\n\tHISI_PMU_ATTR(_name, hisi_event_sysfs_show, (unsigned long)_config)\n\n#define HISI_PMU_EVENT_ATTR_EXTRACTOR(name, config, hi, lo)        \\\n\tstatic inline u32 hisi_get_##name(struct perf_event *event)            \\\n\t{                                                                  \\\n\t\treturn FIELD_GET(GENMASK_ULL(hi, lo), event->attr.config);  \\\n\t}\n\n#define HISI_GET_EVENTID(ev) (ev->hw.config_base & 0xff)\n\n#define HISI_PMU_EVTYPE_BITS\t\t8\n#define HISI_PMU_EVTYPE_SHIFT(idx)\t((idx) % 4 * HISI_PMU_EVTYPE_BITS)\n\nstruct hisi_pmu;\n\nstruct hisi_uncore_ops {\n\tint (*check_filter)(struct perf_event *event);\n\tvoid (*write_evtype)(struct hisi_pmu *, int, u32);\n\tint (*get_event_idx)(struct perf_event *);\n\tu64 (*read_counter)(struct hisi_pmu *, struct hw_perf_event *);\n\tvoid (*write_counter)(struct hisi_pmu *, struct hw_perf_event *, u64);\n\tvoid (*enable_counter)(struct hisi_pmu *, struct hw_perf_event *);\n\tvoid (*disable_counter)(struct hisi_pmu *, struct hw_perf_event *);\n\tvoid (*enable_counter_int)(struct hisi_pmu *, struct hw_perf_event *);\n\tvoid (*disable_counter_int)(struct hisi_pmu *, struct hw_perf_event *);\n\tvoid (*start_counters)(struct hisi_pmu *);\n\tvoid (*stop_counters)(struct hisi_pmu *);\n\tu32 (*get_int_status)(struct hisi_pmu *hisi_pmu);\n\tvoid (*clear_int_status)(struct hisi_pmu *hisi_pmu, int idx);\n\tvoid (*enable_filter)(struct perf_event *event);\n\tvoid (*disable_filter)(struct perf_event *event);\n};\n\n \nstruct hisi_pmu_dev_info {\n\tconst char *name;\n\tconst struct attribute_group **attr_groups;\n\tvoid *private;\n};\n\nstruct hisi_pmu_hwevents {\n\tstruct perf_event *hw_events[HISI_MAX_COUNTERS];\n\tDECLARE_BITMAP(used_mask, HISI_MAX_COUNTERS);\n\tconst struct attribute_group **attr_groups;\n};\n\n \nstruct hisi_pmu {\n\tstruct pmu pmu;\n\tconst struct hisi_uncore_ops *ops;\n\tconst struct hisi_pmu_dev_info *dev_info;\n\tstruct hisi_pmu_hwevents pmu_events;\n\t \n\tcpumask_t associated_cpus;\n\t \n\tint on_cpu;\n\tint irq;\n\tstruct device *dev;\n\tstruct hlist_node node;\n\tint sccl_id;\n\tint sicl_id;\n\tint ccl_id;\n\tvoid __iomem *base;\n\t \n\tu32 index_id;\n\t \n\tu32 sub_id;\n\tint num_counters;\n\tint counter_bits;\n\t \n\tint check_event;\n\tu32 identifier;\n};\n\nint hisi_uncore_pmu_get_event_idx(struct perf_event *event);\nvoid hisi_uncore_pmu_read(struct perf_event *event);\nint hisi_uncore_pmu_add(struct perf_event *event, int flags);\nvoid hisi_uncore_pmu_del(struct perf_event *event, int flags);\nvoid hisi_uncore_pmu_start(struct perf_event *event, int flags);\nvoid hisi_uncore_pmu_stop(struct perf_event *event, int flags);\nvoid hisi_uncore_pmu_set_event_period(struct perf_event *event);\nvoid hisi_uncore_pmu_event_update(struct perf_event *event);\nint hisi_uncore_pmu_event_init(struct perf_event *event);\nvoid hisi_uncore_pmu_enable(struct pmu *pmu);\nvoid hisi_uncore_pmu_disable(struct pmu *pmu);\nssize_t hisi_event_sysfs_show(struct device *dev,\n\t\t\t      struct device_attribute *attr, char *buf);\nssize_t hisi_format_sysfs_show(struct device *dev,\n\t\t\t       struct device_attribute *attr, char *buf);\nssize_t hisi_cpumask_sysfs_show(struct device *dev,\n\t\t\t\tstruct device_attribute *attr, char *buf);\nint hisi_uncore_pmu_online_cpu(unsigned int cpu, struct hlist_node *node);\nint hisi_uncore_pmu_offline_cpu(unsigned int cpu, struct hlist_node *node);\n\nssize_t hisi_uncore_pmu_identifier_attr_show(struct device *dev,\n\t\t\t\t\t     struct device_attribute *attr,\n\t\t\t\t\t     char *page);\nint hisi_uncore_pmu_init_irq(struct hisi_pmu *hisi_pmu,\n\t\t\t     struct platform_device *pdev);\n\nvoid hisi_pmu_init(struct hisi_pmu *hisi_pmu, struct module *module);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}