{
  "module_name": "msm8974.c",
  "hash_id": "2ae46f7fb864a5e14356516495c791c9bcf97ec047e00c605d0926ff658b2f75",
  "original_prompt": "Ingested from linux-6.6.14/drivers/interconnect/qcom/msm8974.c",
  "human_readable_source": "\n \n\n#include <dt-bindings/interconnect/qcom,msm8974.h>\n#include <linux/clk.h>\n#include <linux/device.h>\n#include <linux/interconnect-provider.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n\n#include \"icc-rpm.h\"\n\nenum {\n\tMSM8974_BIMC_MAS_AMPSS_M0 = 1,\n\tMSM8974_BIMC_MAS_AMPSS_M1,\n\tMSM8974_BIMC_MAS_MSS_PROC,\n\tMSM8974_BIMC_TO_MNOC,\n\tMSM8974_BIMC_TO_SNOC,\n\tMSM8974_BIMC_SLV_EBI_CH0,\n\tMSM8974_BIMC_SLV_AMPSS_L2,\n\tMSM8974_CNOC_MAS_RPM_INST,\n\tMSM8974_CNOC_MAS_RPM_DATA,\n\tMSM8974_CNOC_MAS_RPM_SYS,\n\tMSM8974_CNOC_MAS_DEHR,\n\tMSM8974_CNOC_MAS_QDSS_DAP,\n\tMSM8974_CNOC_MAS_SPDM,\n\tMSM8974_CNOC_MAS_TIC,\n\tMSM8974_CNOC_SLV_CLK_CTL,\n\tMSM8974_CNOC_SLV_CNOC_MSS,\n\tMSM8974_CNOC_SLV_SECURITY,\n\tMSM8974_CNOC_SLV_TCSR,\n\tMSM8974_CNOC_SLV_TLMM,\n\tMSM8974_CNOC_SLV_CRYPTO_0_CFG,\n\tMSM8974_CNOC_SLV_CRYPTO_1_CFG,\n\tMSM8974_CNOC_SLV_IMEM_CFG,\n\tMSM8974_CNOC_SLV_MESSAGE_RAM,\n\tMSM8974_CNOC_SLV_BIMC_CFG,\n\tMSM8974_CNOC_SLV_BOOT_ROM,\n\tMSM8974_CNOC_SLV_PMIC_ARB,\n\tMSM8974_CNOC_SLV_SPDM_WRAPPER,\n\tMSM8974_CNOC_SLV_DEHR_CFG,\n\tMSM8974_CNOC_SLV_MPM,\n\tMSM8974_CNOC_SLV_QDSS_CFG,\n\tMSM8974_CNOC_SLV_RBCPR_CFG,\n\tMSM8974_CNOC_SLV_RBCPR_QDSS_APU_CFG,\n\tMSM8974_CNOC_TO_SNOC,\n\tMSM8974_CNOC_SLV_CNOC_ONOC_CFG,\n\tMSM8974_CNOC_SLV_CNOC_MNOC_MMSS_CFG,\n\tMSM8974_CNOC_SLV_CNOC_MNOC_CFG,\n\tMSM8974_CNOC_SLV_PNOC_CFG,\n\tMSM8974_CNOC_SLV_SNOC_MPU_CFG,\n\tMSM8974_CNOC_SLV_SNOC_CFG,\n\tMSM8974_CNOC_SLV_EBI1_DLL_CFG,\n\tMSM8974_CNOC_SLV_PHY_APU_CFG,\n\tMSM8974_CNOC_SLV_EBI1_PHY_CFG,\n\tMSM8974_CNOC_SLV_RPM,\n\tMSM8974_CNOC_SLV_SERVICE_CNOC,\n\tMSM8974_MNOC_MAS_GRAPHICS_3D,\n\tMSM8974_MNOC_MAS_JPEG,\n\tMSM8974_MNOC_MAS_MDP_PORT0,\n\tMSM8974_MNOC_MAS_VIDEO_P0,\n\tMSM8974_MNOC_MAS_VIDEO_P1,\n\tMSM8974_MNOC_MAS_VFE,\n\tMSM8974_MNOC_TO_CNOC,\n\tMSM8974_MNOC_TO_BIMC,\n\tMSM8974_MNOC_SLV_CAMERA_CFG,\n\tMSM8974_MNOC_SLV_DISPLAY_CFG,\n\tMSM8974_MNOC_SLV_OCMEM_CFG,\n\tMSM8974_MNOC_SLV_CPR_CFG,\n\tMSM8974_MNOC_SLV_CPR_XPU_CFG,\n\tMSM8974_MNOC_SLV_MISC_CFG,\n\tMSM8974_MNOC_SLV_MISC_XPU_CFG,\n\tMSM8974_MNOC_SLV_VENUS_CFG,\n\tMSM8974_MNOC_SLV_GRAPHICS_3D_CFG,\n\tMSM8974_MNOC_SLV_MMSS_CLK_CFG,\n\tMSM8974_MNOC_SLV_MMSS_CLK_XPU_CFG,\n\tMSM8974_MNOC_SLV_MNOC_MPU_CFG,\n\tMSM8974_MNOC_SLV_ONOC_MPU_CFG,\n\tMSM8974_MNOC_SLV_SERVICE_MNOC,\n\tMSM8974_OCMEM_NOC_TO_OCMEM_VNOC,\n\tMSM8974_OCMEM_MAS_JPEG_OCMEM,\n\tMSM8974_OCMEM_MAS_MDP_OCMEM,\n\tMSM8974_OCMEM_MAS_VIDEO_P0_OCMEM,\n\tMSM8974_OCMEM_MAS_VIDEO_P1_OCMEM,\n\tMSM8974_OCMEM_MAS_VFE_OCMEM,\n\tMSM8974_OCMEM_MAS_CNOC_ONOC_CFG,\n\tMSM8974_OCMEM_SLV_SERVICE_ONOC,\n\tMSM8974_OCMEM_VNOC_TO_SNOC,\n\tMSM8974_OCMEM_VNOC_TO_OCMEM_NOC,\n\tMSM8974_OCMEM_VNOC_MAS_GFX3D,\n\tMSM8974_OCMEM_SLV_OCMEM,\n\tMSM8974_PNOC_MAS_PNOC_CFG,\n\tMSM8974_PNOC_MAS_SDCC_1,\n\tMSM8974_PNOC_MAS_SDCC_3,\n\tMSM8974_PNOC_MAS_SDCC_4,\n\tMSM8974_PNOC_MAS_SDCC_2,\n\tMSM8974_PNOC_MAS_TSIF,\n\tMSM8974_PNOC_MAS_BAM_DMA,\n\tMSM8974_PNOC_MAS_BLSP_2,\n\tMSM8974_PNOC_MAS_USB_HSIC,\n\tMSM8974_PNOC_MAS_BLSP_1,\n\tMSM8974_PNOC_MAS_USB_HS,\n\tMSM8974_PNOC_TO_SNOC,\n\tMSM8974_PNOC_SLV_SDCC_1,\n\tMSM8974_PNOC_SLV_SDCC_3,\n\tMSM8974_PNOC_SLV_SDCC_2,\n\tMSM8974_PNOC_SLV_SDCC_4,\n\tMSM8974_PNOC_SLV_TSIF,\n\tMSM8974_PNOC_SLV_BAM_DMA,\n\tMSM8974_PNOC_SLV_BLSP_2,\n\tMSM8974_PNOC_SLV_USB_HSIC,\n\tMSM8974_PNOC_SLV_BLSP_1,\n\tMSM8974_PNOC_SLV_USB_HS,\n\tMSM8974_PNOC_SLV_PDM,\n\tMSM8974_PNOC_SLV_PERIPH_APU_CFG,\n\tMSM8974_PNOC_SLV_PNOC_MPU_CFG,\n\tMSM8974_PNOC_SLV_PRNG,\n\tMSM8974_PNOC_SLV_SERVICE_PNOC,\n\tMSM8974_SNOC_MAS_LPASS_AHB,\n\tMSM8974_SNOC_MAS_QDSS_BAM,\n\tMSM8974_SNOC_MAS_SNOC_CFG,\n\tMSM8974_SNOC_TO_BIMC,\n\tMSM8974_SNOC_TO_CNOC,\n\tMSM8974_SNOC_TO_PNOC,\n\tMSM8974_SNOC_TO_OCMEM_VNOC,\n\tMSM8974_SNOC_MAS_CRYPTO_CORE0,\n\tMSM8974_SNOC_MAS_CRYPTO_CORE1,\n\tMSM8974_SNOC_MAS_LPASS_PROC,\n\tMSM8974_SNOC_MAS_MSS,\n\tMSM8974_SNOC_MAS_MSS_NAV,\n\tMSM8974_SNOC_MAS_OCMEM_DMA,\n\tMSM8974_SNOC_MAS_WCSS,\n\tMSM8974_SNOC_MAS_QDSS_ETR,\n\tMSM8974_SNOC_MAS_USB3,\n\tMSM8974_SNOC_SLV_AMPSS,\n\tMSM8974_SNOC_SLV_LPASS,\n\tMSM8974_SNOC_SLV_USB3,\n\tMSM8974_SNOC_SLV_WCSS,\n\tMSM8974_SNOC_SLV_OCIMEM,\n\tMSM8974_SNOC_SLV_SNOC_OCMEM,\n\tMSM8974_SNOC_SLV_SERVICE_SNOC,\n\tMSM8974_SNOC_SLV_QDSS_STM,\n};\n\n#define RPM_BUS_MASTER_REQ\t0x73616d62\n#define RPM_BUS_SLAVE_REQ\t0x766c7362\n\n#define to_msm8974_icc_provider(_provider) \\\n\tcontainer_of(_provider, struct msm8974_icc_provider, provider)\n\nstatic const struct clk_bulk_data msm8974_icc_bus_clocks[] = {\n\t{ .id = \"bus\" },\n\t{ .id = \"bus_a\" },\n};\n\n \nstruct msm8974_icc_provider {\n\tstruct icc_provider provider;\n\tstruct clk_bulk_data *bus_clks;\n\tint num_clks;\n};\n\n#define MSM8974_ICC_MAX_LINKS\t3\n\n \nstruct msm8974_icc_node {\n\tunsigned char *name;\n\tu16 id;\n\tu16 links[MSM8974_ICC_MAX_LINKS];\n\tu16 num_links;\n\tu16 buswidth;\n\tint mas_rpm_id;\n\tint slv_rpm_id;\n\tu64 rate;\n};\n\nstruct msm8974_icc_desc {\n\tstruct msm8974_icc_node * const *nodes;\n\tsize_t num_nodes;\n};\n\n#define DEFINE_QNODE(_name, _id, _buswidth, _mas_rpm_id, _slv_rpm_id,\t\\\n\t\t     ...)\t\t\t\t\t\t\\\n\t\tstatic struct msm8974_icc_node _name = {\t\t\\\n\t\t.name = #_name,\t\t\t\t\t\t\\\n\t\t.id = _id,\t\t\t\t\t\t\\\n\t\t.buswidth = _buswidth,\t\t\t\t\t\\\n\t\t.mas_rpm_id = _mas_rpm_id,\t\t\t\t\\\n\t\t.slv_rpm_id = _slv_rpm_id,\t\t\t\t\\\n\t\t.num_links = ARRAY_SIZE(((int[]){ __VA_ARGS__ })),\t\\\n\t\t.links = { __VA_ARGS__ },\t\t\t\t\\\n\t}\n\nDEFINE_QNODE(mas_ampss_m0, MSM8974_BIMC_MAS_AMPSS_M0, 8, 0, -1);\nDEFINE_QNODE(mas_ampss_m1, MSM8974_BIMC_MAS_AMPSS_M1, 8, 0, -1);\nDEFINE_QNODE(mas_mss_proc, MSM8974_BIMC_MAS_MSS_PROC, 8, 1, -1);\nDEFINE_QNODE(bimc_to_mnoc, MSM8974_BIMC_TO_MNOC, 8, 2, -1, MSM8974_BIMC_SLV_EBI_CH0);\nDEFINE_QNODE(bimc_to_snoc, MSM8974_BIMC_TO_SNOC, 8, 3, 2, MSM8974_SNOC_TO_BIMC, MSM8974_BIMC_SLV_EBI_CH0, MSM8974_BIMC_MAS_AMPSS_M0);\nDEFINE_QNODE(slv_ebi_ch0, MSM8974_BIMC_SLV_EBI_CH0, 8, -1, 0);\nDEFINE_QNODE(slv_ampss_l2, MSM8974_BIMC_SLV_AMPSS_L2, 8, -1, 1);\n\nstatic struct msm8974_icc_node * const msm8974_bimc_nodes[] = {\n\t[BIMC_MAS_AMPSS_M0] = &mas_ampss_m0,\n\t[BIMC_MAS_AMPSS_M1] = &mas_ampss_m1,\n\t[BIMC_MAS_MSS_PROC] = &mas_mss_proc,\n\t[BIMC_TO_MNOC] = &bimc_to_mnoc,\n\t[BIMC_TO_SNOC] = &bimc_to_snoc,\n\t[BIMC_SLV_EBI_CH0] = &slv_ebi_ch0,\n\t[BIMC_SLV_AMPSS_L2] = &slv_ampss_l2,\n};\n\nstatic const struct msm8974_icc_desc msm8974_bimc = {\n\t.nodes = msm8974_bimc_nodes,\n\t.num_nodes = ARRAY_SIZE(msm8974_bimc_nodes),\n};\n\nDEFINE_QNODE(mas_rpm_inst, MSM8974_CNOC_MAS_RPM_INST, 8, 45, -1);\nDEFINE_QNODE(mas_rpm_data, MSM8974_CNOC_MAS_RPM_DATA, 8, 46, -1);\nDEFINE_QNODE(mas_rpm_sys, MSM8974_CNOC_MAS_RPM_SYS, 8, 47, -1);\nDEFINE_QNODE(mas_dehr, MSM8974_CNOC_MAS_DEHR, 8, 48, -1);\nDEFINE_QNODE(mas_qdss_dap, MSM8974_CNOC_MAS_QDSS_DAP, 8, 49, -1);\nDEFINE_QNODE(mas_spdm, MSM8974_CNOC_MAS_SPDM, 8, 50, -1);\nDEFINE_QNODE(mas_tic, MSM8974_CNOC_MAS_TIC, 8, 51, -1);\nDEFINE_QNODE(slv_clk_ctl, MSM8974_CNOC_SLV_CLK_CTL, 8, -1, 47);\nDEFINE_QNODE(slv_cnoc_mss, MSM8974_CNOC_SLV_CNOC_MSS, 8, -1, 48);\nDEFINE_QNODE(slv_security, MSM8974_CNOC_SLV_SECURITY, 8, -1, 49);\nDEFINE_QNODE(slv_tcsr, MSM8974_CNOC_SLV_TCSR, 8, -1, 50);\nDEFINE_QNODE(slv_tlmm, MSM8974_CNOC_SLV_TLMM, 8, -1, 51);\nDEFINE_QNODE(slv_crypto_0_cfg, MSM8974_CNOC_SLV_CRYPTO_0_CFG, 8, -1, 52);\nDEFINE_QNODE(slv_crypto_1_cfg, MSM8974_CNOC_SLV_CRYPTO_1_CFG, 8, -1, 53);\nDEFINE_QNODE(slv_imem_cfg, MSM8974_CNOC_SLV_IMEM_CFG, 8, -1, 54);\nDEFINE_QNODE(slv_message_ram, MSM8974_CNOC_SLV_MESSAGE_RAM, 8, -1, 55);\nDEFINE_QNODE(slv_bimc_cfg, MSM8974_CNOC_SLV_BIMC_CFG, 8, -1, 56);\nDEFINE_QNODE(slv_boot_rom, MSM8974_CNOC_SLV_BOOT_ROM, 8, -1, 57);\nDEFINE_QNODE(slv_pmic_arb, MSM8974_CNOC_SLV_PMIC_ARB, 8, -1, 59);\nDEFINE_QNODE(slv_spdm_wrapper, MSM8974_CNOC_SLV_SPDM_WRAPPER, 8, -1, 60);\nDEFINE_QNODE(slv_dehr_cfg, MSM8974_CNOC_SLV_DEHR_CFG, 8, -1, 61);\nDEFINE_QNODE(slv_mpm, MSM8974_CNOC_SLV_MPM, 8, -1, 62);\nDEFINE_QNODE(slv_qdss_cfg, MSM8974_CNOC_SLV_QDSS_CFG, 8, -1, 63);\nDEFINE_QNODE(slv_rbcpr_cfg, MSM8974_CNOC_SLV_RBCPR_CFG, 8, -1, 64);\nDEFINE_QNODE(slv_rbcpr_qdss_apu_cfg, MSM8974_CNOC_SLV_RBCPR_QDSS_APU_CFG, 8, -1, 65);\nDEFINE_QNODE(cnoc_to_snoc, MSM8974_CNOC_TO_SNOC, 8, 52, 75);\nDEFINE_QNODE(slv_cnoc_onoc_cfg, MSM8974_CNOC_SLV_CNOC_ONOC_CFG, 8, -1, 68);\nDEFINE_QNODE(slv_cnoc_mnoc_mmss_cfg, MSM8974_CNOC_SLV_CNOC_MNOC_MMSS_CFG, 8, -1, 58);\nDEFINE_QNODE(slv_cnoc_mnoc_cfg, MSM8974_CNOC_SLV_CNOC_MNOC_CFG, 8, -1, 66);\nDEFINE_QNODE(slv_pnoc_cfg, MSM8974_CNOC_SLV_PNOC_CFG, 8, -1, 69);\nDEFINE_QNODE(slv_snoc_mpu_cfg, MSM8974_CNOC_SLV_SNOC_MPU_CFG, 8, -1, 67);\nDEFINE_QNODE(slv_snoc_cfg, MSM8974_CNOC_SLV_SNOC_CFG, 8, -1, 70);\nDEFINE_QNODE(slv_ebi1_dll_cfg, MSM8974_CNOC_SLV_EBI1_DLL_CFG, 8, -1, 71);\nDEFINE_QNODE(slv_phy_apu_cfg, MSM8974_CNOC_SLV_PHY_APU_CFG, 8, -1, 72);\nDEFINE_QNODE(slv_ebi1_phy_cfg, MSM8974_CNOC_SLV_EBI1_PHY_CFG, 8, -1, 73);\nDEFINE_QNODE(slv_rpm, MSM8974_CNOC_SLV_RPM, 8, -1, 74);\nDEFINE_QNODE(slv_service_cnoc, MSM8974_CNOC_SLV_SERVICE_CNOC, 8, -1, 76);\n\nstatic struct msm8974_icc_node * const msm8974_cnoc_nodes[] = {\n\t[CNOC_MAS_RPM_INST] = &mas_rpm_inst,\n\t[CNOC_MAS_RPM_DATA] = &mas_rpm_data,\n\t[CNOC_MAS_RPM_SYS] = &mas_rpm_sys,\n\t[CNOC_MAS_DEHR] = &mas_dehr,\n\t[CNOC_MAS_QDSS_DAP] = &mas_qdss_dap,\n\t[CNOC_MAS_SPDM] = &mas_spdm,\n\t[CNOC_MAS_TIC] = &mas_tic,\n\t[CNOC_SLV_CLK_CTL] = &slv_clk_ctl,\n\t[CNOC_SLV_CNOC_MSS] = &slv_cnoc_mss,\n\t[CNOC_SLV_SECURITY] = &slv_security,\n\t[CNOC_SLV_TCSR] = &slv_tcsr,\n\t[CNOC_SLV_TLMM] = &slv_tlmm,\n\t[CNOC_SLV_CRYPTO_0_CFG] = &slv_crypto_0_cfg,\n\t[CNOC_SLV_CRYPTO_1_CFG] = &slv_crypto_1_cfg,\n\t[CNOC_SLV_IMEM_CFG] = &slv_imem_cfg,\n\t[CNOC_SLV_MESSAGE_RAM] = &slv_message_ram,\n\t[CNOC_SLV_BIMC_CFG] = &slv_bimc_cfg,\n\t[CNOC_SLV_BOOT_ROM] = &slv_boot_rom,\n\t[CNOC_SLV_PMIC_ARB] = &slv_pmic_arb,\n\t[CNOC_SLV_SPDM_WRAPPER] = &slv_spdm_wrapper,\n\t[CNOC_SLV_DEHR_CFG] = &slv_dehr_cfg,\n\t[CNOC_SLV_MPM] = &slv_mpm,\n\t[CNOC_SLV_QDSS_CFG] = &slv_qdss_cfg,\n\t[CNOC_SLV_RBCPR_CFG] = &slv_rbcpr_cfg,\n\t[CNOC_SLV_RBCPR_QDSS_APU_CFG] = &slv_rbcpr_qdss_apu_cfg,\n\t[CNOC_TO_SNOC] = &cnoc_to_snoc,\n\t[CNOC_SLV_CNOC_ONOC_CFG] = &slv_cnoc_onoc_cfg,\n\t[CNOC_SLV_CNOC_MNOC_MMSS_CFG] = &slv_cnoc_mnoc_mmss_cfg,\n\t[CNOC_SLV_CNOC_MNOC_CFG] = &slv_cnoc_mnoc_cfg,\n\t[CNOC_SLV_PNOC_CFG] = &slv_pnoc_cfg,\n\t[CNOC_SLV_SNOC_MPU_CFG] = &slv_snoc_mpu_cfg,\n\t[CNOC_SLV_SNOC_CFG] = &slv_snoc_cfg,\n\t[CNOC_SLV_EBI1_DLL_CFG] = &slv_ebi1_dll_cfg,\n\t[CNOC_SLV_PHY_APU_CFG] = &slv_phy_apu_cfg,\n\t[CNOC_SLV_EBI1_PHY_CFG] = &slv_ebi1_phy_cfg,\n\t[CNOC_SLV_RPM] = &slv_rpm,\n\t[CNOC_SLV_SERVICE_CNOC] = &slv_service_cnoc,\n};\n\nstatic const struct msm8974_icc_desc msm8974_cnoc = {\n\t.nodes = msm8974_cnoc_nodes,\n\t.num_nodes = ARRAY_SIZE(msm8974_cnoc_nodes),\n};\n\nDEFINE_QNODE(mas_graphics_3d, MSM8974_MNOC_MAS_GRAPHICS_3D, 16, 6, -1, MSM8974_MNOC_TO_BIMC);\nDEFINE_QNODE(mas_jpeg, MSM8974_MNOC_MAS_JPEG, 16, 7, -1, MSM8974_MNOC_TO_BIMC);\nDEFINE_QNODE(mas_mdp_port0, MSM8974_MNOC_MAS_MDP_PORT0, 16, 8, -1, MSM8974_MNOC_TO_BIMC);\nDEFINE_QNODE(mas_video_p0, MSM8974_MNOC_MAS_VIDEO_P0, 16, 9, -1);\nDEFINE_QNODE(mas_video_p1, MSM8974_MNOC_MAS_VIDEO_P1, 16, 10, -1);\nDEFINE_QNODE(mas_vfe, MSM8974_MNOC_MAS_VFE, 16, 11, -1, MSM8974_MNOC_TO_BIMC);\nDEFINE_QNODE(mnoc_to_cnoc, MSM8974_MNOC_TO_CNOC, 16, 4, -1);\nDEFINE_QNODE(mnoc_to_bimc, MSM8974_MNOC_TO_BIMC, 16, -1, 16, MSM8974_BIMC_TO_MNOC);\nDEFINE_QNODE(slv_camera_cfg, MSM8974_MNOC_SLV_CAMERA_CFG, 16, -1, 3);\nDEFINE_QNODE(slv_display_cfg, MSM8974_MNOC_SLV_DISPLAY_CFG, 16, -1, 4);\nDEFINE_QNODE(slv_ocmem_cfg, MSM8974_MNOC_SLV_OCMEM_CFG, 16, -1, 5);\nDEFINE_QNODE(slv_cpr_cfg, MSM8974_MNOC_SLV_CPR_CFG, 16, -1, 6);\nDEFINE_QNODE(slv_cpr_xpu_cfg, MSM8974_MNOC_SLV_CPR_XPU_CFG, 16, -1, 7);\nDEFINE_QNODE(slv_misc_cfg, MSM8974_MNOC_SLV_MISC_CFG, 16, -1, 8);\nDEFINE_QNODE(slv_misc_xpu_cfg, MSM8974_MNOC_SLV_MISC_XPU_CFG, 16, -1, 9);\nDEFINE_QNODE(slv_venus_cfg, MSM8974_MNOC_SLV_VENUS_CFG, 16, -1, 10);\nDEFINE_QNODE(slv_graphics_3d_cfg, MSM8974_MNOC_SLV_GRAPHICS_3D_CFG, 16, -1, 11);\nDEFINE_QNODE(slv_mmss_clk_cfg, MSM8974_MNOC_SLV_MMSS_CLK_CFG, 16, -1, 12);\nDEFINE_QNODE(slv_mmss_clk_xpu_cfg, MSM8974_MNOC_SLV_MMSS_CLK_XPU_CFG, 16, -1, 13);\nDEFINE_QNODE(slv_mnoc_mpu_cfg, MSM8974_MNOC_SLV_MNOC_MPU_CFG, 16, -1, 14);\nDEFINE_QNODE(slv_onoc_mpu_cfg, MSM8974_MNOC_SLV_ONOC_MPU_CFG, 16, -1, 15);\nDEFINE_QNODE(slv_service_mnoc, MSM8974_MNOC_SLV_SERVICE_MNOC, 16, -1, 17);\n\nstatic struct msm8974_icc_node * const msm8974_mnoc_nodes[] = {\n\t[MNOC_MAS_GRAPHICS_3D] = &mas_graphics_3d,\n\t[MNOC_MAS_JPEG] = &mas_jpeg,\n\t[MNOC_MAS_MDP_PORT0] = &mas_mdp_port0,\n\t[MNOC_MAS_VIDEO_P0] = &mas_video_p0,\n\t[MNOC_MAS_VIDEO_P1] = &mas_video_p1,\n\t[MNOC_MAS_VFE] = &mas_vfe,\n\t[MNOC_TO_CNOC] = &mnoc_to_cnoc,\n\t[MNOC_TO_BIMC] = &mnoc_to_bimc,\n\t[MNOC_SLV_CAMERA_CFG] = &slv_camera_cfg,\n\t[MNOC_SLV_DISPLAY_CFG] = &slv_display_cfg,\n\t[MNOC_SLV_OCMEM_CFG] = &slv_ocmem_cfg,\n\t[MNOC_SLV_CPR_CFG] = &slv_cpr_cfg,\n\t[MNOC_SLV_CPR_XPU_CFG] = &slv_cpr_xpu_cfg,\n\t[MNOC_SLV_MISC_CFG] = &slv_misc_cfg,\n\t[MNOC_SLV_MISC_XPU_CFG] = &slv_misc_xpu_cfg,\n\t[MNOC_SLV_VENUS_CFG] = &slv_venus_cfg,\n\t[MNOC_SLV_GRAPHICS_3D_CFG] = &slv_graphics_3d_cfg,\n\t[MNOC_SLV_MMSS_CLK_CFG] = &slv_mmss_clk_cfg,\n\t[MNOC_SLV_MMSS_CLK_XPU_CFG] = &slv_mmss_clk_xpu_cfg,\n\t[MNOC_SLV_MNOC_MPU_CFG] = &slv_mnoc_mpu_cfg,\n\t[MNOC_SLV_ONOC_MPU_CFG] = &slv_onoc_mpu_cfg,\n\t[MNOC_SLV_SERVICE_MNOC] = &slv_service_mnoc,\n};\n\nstatic const struct msm8974_icc_desc msm8974_mnoc = {\n\t.nodes = msm8974_mnoc_nodes,\n\t.num_nodes = ARRAY_SIZE(msm8974_mnoc_nodes),\n};\n\nDEFINE_QNODE(ocmem_noc_to_ocmem_vnoc, MSM8974_OCMEM_NOC_TO_OCMEM_VNOC, 16, 54, 78, MSM8974_OCMEM_SLV_OCMEM);\nDEFINE_QNODE(mas_jpeg_ocmem, MSM8974_OCMEM_MAS_JPEG_OCMEM, 16, 13, -1);\nDEFINE_QNODE(mas_mdp_ocmem, MSM8974_OCMEM_MAS_MDP_OCMEM, 16, 14, -1);\nDEFINE_QNODE(mas_video_p0_ocmem, MSM8974_OCMEM_MAS_VIDEO_P0_OCMEM, 16, 15, -1);\nDEFINE_QNODE(mas_video_p1_ocmem, MSM8974_OCMEM_MAS_VIDEO_P1_OCMEM, 16, 16, -1);\nDEFINE_QNODE(mas_vfe_ocmem, MSM8974_OCMEM_MAS_VFE_OCMEM, 16, 17, -1);\nDEFINE_QNODE(mas_cnoc_onoc_cfg, MSM8974_OCMEM_MAS_CNOC_ONOC_CFG, 16, 12, -1);\nDEFINE_QNODE(slv_service_onoc, MSM8974_OCMEM_SLV_SERVICE_ONOC, 16, -1, 19);\nDEFINE_QNODE(slv_ocmem, MSM8974_OCMEM_SLV_OCMEM, 16, -1, 18);\n\n \nDEFINE_QNODE(ocmem_vnoc_to_onoc, MSM8974_OCMEM_VNOC_TO_OCMEM_NOC, 16, 56, 79, MSM8974_OCMEM_NOC_TO_OCMEM_VNOC);\nDEFINE_QNODE(ocmem_vnoc_to_snoc, MSM8974_OCMEM_VNOC_TO_SNOC, 8, 57, 80);\nDEFINE_QNODE(mas_v_ocmem_gfx3d, MSM8974_OCMEM_VNOC_MAS_GFX3D, 8, 55, -1, MSM8974_OCMEM_VNOC_TO_OCMEM_NOC);\n\nstatic struct msm8974_icc_node * const msm8974_onoc_nodes[] = {\n\t[OCMEM_NOC_TO_OCMEM_VNOC] = &ocmem_noc_to_ocmem_vnoc,\n\t[OCMEM_MAS_JPEG_OCMEM] = &mas_jpeg_ocmem,\n\t[OCMEM_MAS_MDP_OCMEM] = &mas_mdp_ocmem,\n\t[OCMEM_MAS_VIDEO_P0_OCMEM] = &mas_video_p0_ocmem,\n\t[OCMEM_MAS_VIDEO_P1_OCMEM] = &mas_video_p1_ocmem,\n\t[OCMEM_MAS_VFE_OCMEM] = &mas_vfe_ocmem,\n\t[OCMEM_MAS_CNOC_ONOC_CFG] = &mas_cnoc_onoc_cfg,\n\t[OCMEM_SLV_SERVICE_ONOC] = &slv_service_onoc,\n\t[OCMEM_VNOC_TO_SNOC] = &ocmem_vnoc_to_snoc,\n\t[OCMEM_VNOC_TO_OCMEM_NOC] = &ocmem_vnoc_to_onoc,\n\t[OCMEM_VNOC_MAS_GFX3D] = &mas_v_ocmem_gfx3d,\n\t[OCMEM_SLV_OCMEM] = &slv_ocmem,\n};\n\nstatic const struct msm8974_icc_desc msm8974_onoc = {\n\t.nodes = msm8974_onoc_nodes,\n\t.num_nodes = ARRAY_SIZE(msm8974_onoc_nodes),\n};\n\nDEFINE_QNODE(mas_pnoc_cfg, MSM8974_PNOC_MAS_PNOC_CFG, 8, 43, -1);\nDEFINE_QNODE(mas_sdcc_1, MSM8974_PNOC_MAS_SDCC_1, 8, 33, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_sdcc_3, MSM8974_PNOC_MAS_SDCC_3, 8, 34, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_sdcc_4, MSM8974_PNOC_MAS_SDCC_4, 8, 36, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_sdcc_2, MSM8974_PNOC_MAS_SDCC_2, 8, 35, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_tsif, MSM8974_PNOC_MAS_TSIF, 8, 37, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_bam_dma, MSM8974_PNOC_MAS_BAM_DMA, 8, 38, -1);\nDEFINE_QNODE(mas_blsp_2, MSM8974_PNOC_MAS_BLSP_2, 8, 39, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_usb_hsic, MSM8974_PNOC_MAS_USB_HSIC, 8, 40, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_blsp_1, MSM8974_PNOC_MAS_BLSP_1, 8, 41, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(mas_usb_hs, MSM8974_PNOC_MAS_USB_HS, 8, 42, -1, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(pnoc_to_snoc, MSM8974_PNOC_TO_SNOC, 8, 44, 45, MSM8974_SNOC_TO_PNOC, MSM8974_PNOC_SLV_PRNG);\nDEFINE_QNODE(slv_sdcc_1, MSM8974_PNOC_SLV_SDCC_1, 8, -1, 31);\nDEFINE_QNODE(slv_sdcc_3, MSM8974_PNOC_SLV_SDCC_3, 8, -1, 32);\nDEFINE_QNODE(slv_sdcc_2, MSM8974_PNOC_SLV_SDCC_2, 8, -1, 33);\nDEFINE_QNODE(slv_sdcc_4, MSM8974_PNOC_SLV_SDCC_4, 8, -1, 34);\nDEFINE_QNODE(slv_tsif, MSM8974_PNOC_SLV_TSIF, 8, -1, 35);\nDEFINE_QNODE(slv_bam_dma, MSM8974_PNOC_SLV_BAM_DMA, 8, -1, 36);\nDEFINE_QNODE(slv_blsp_2, MSM8974_PNOC_SLV_BLSP_2, 8, -1, 37);\nDEFINE_QNODE(slv_usb_hsic, MSM8974_PNOC_SLV_USB_HSIC, 8, -1, 38);\nDEFINE_QNODE(slv_blsp_1, MSM8974_PNOC_SLV_BLSP_1, 8, -1, 39);\nDEFINE_QNODE(slv_usb_hs, MSM8974_PNOC_SLV_USB_HS, 8, -1, 40);\nDEFINE_QNODE(slv_pdm, MSM8974_PNOC_SLV_PDM, 8, -1, 41);\nDEFINE_QNODE(slv_periph_apu_cfg, MSM8974_PNOC_SLV_PERIPH_APU_CFG, 8, -1, 42);\nDEFINE_QNODE(slv_pnoc_mpu_cfg, MSM8974_PNOC_SLV_PNOC_MPU_CFG, 8, -1, 43);\nDEFINE_QNODE(slv_prng, MSM8974_PNOC_SLV_PRNG, 8, -1, 44, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(slv_service_pnoc, MSM8974_PNOC_SLV_SERVICE_PNOC, 8, -1, 46);\n\nstatic struct msm8974_icc_node * const msm8974_pnoc_nodes[] = {\n\t[PNOC_MAS_PNOC_CFG] = &mas_pnoc_cfg,\n\t[PNOC_MAS_SDCC_1] = &mas_sdcc_1,\n\t[PNOC_MAS_SDCC_3] = &mas_sdcc_3,\n\t[PNOC_MAS_SDCC_4] = &mas_sdcc_4,\n\t[PNOC_MAS_SDCC_2] = &mas_sdcc_2,\n\t[PNOC_MAS_TSIF] = &mas_tsif,\n\t[PNOC_MAS_BAM_DMA] = &mas_bam_dma,\n\t[PNOC_MAS_BLSP_2] = &mas_blsp_2,\n\t[PNOC_MAS_USB_HSIC] = &mas_usb_hsic,\n\t[PNOC_MAS_BLSP_1] = &mas_blsp_1,\n\t[PNOC_MAS_USB_HS] = &mas_usb_hs,\n\t[PNOC_TO_SNOC] = &pnoc_to_snoc,\n\t[PNOC_SLV_SDCC_1] = &slv_sdcc_1,\n\t[PNOC_SLV_SDCC_3] = &slv_sdcc_3,\n\t[PNOC_SLV_SDCC_2] = &slv_sdcc_2,\n\t[PNOC_SLV_SDCC_4] = &slv_sdcc_4,\n\t[PNOC_SLV_TSIF] = &slv_tsif,\n\t[PNOC_SLV_BAM_DMA] = &slv_bam_dma,\n\t[PNOC_SLV_BLSP_2] = &slv_blsp_2,\n\t[PNOC_SLV_USB_HSIC] = &slv_usb_hsic,\n\t[PNOC_SLV_BLSP_1] = &slv_blsp_1,\n\t[PNOC_SLV_USB_HS] = &slv_usb_hs,\n\t[PNOC_SLV_PDM] = &slv_pdm,\n\t[PNOC_SLV_PERIPH_APU_CFG] = &slv_periph_apu_cfg,\n\t[PNOC_SLV_PNOC_MPU_CFG] = &slv_pnoc_mpu_cfg,\n\t[PNOC_SLV_PRNG] = &slv_prng,\n\t[PNOC_SLV_SERVICE_PNOC] = &slv_service_pnoc,\n};\n\nstatic const struct msm8974_icc_desc msm8974_pnoc = {\n\t.nodes = msm8974_pnoc_nodes,\n\t.num_nodes = ARRAY_SIZE(msm8974_pnoc_nodes),\n};\n\nDEFINE_QNODE(mas_lpass_ahb, MSM8974_SNOC_MAS_LPASS_AHB, 8, 18, -1);\nDEFINE_QNODE(mas_qdss_bam, MSM8974_SNOC_MAS_QDSS_BAM, 8, 19, -1);\nDEFINE_QNODE(mas_snoc_cfg, MSM8974_SNOC_MAS_SNOC_CFG, 8, 20, -1);\nDEFINE_QNODE(snoc_to_bimc, MSM8974_SNOC_TO_BIMC, 8, 21, 24, MSM8974_BIMC_TO_SNOC);\nDEFINE_QNODE(snoc_to_cnoc, MSM8974_SNOC_TO_CNOC, 8, 22, 25);\nDEFINE_QNODE(snoc_to_pnoc, MSM8974_SNOC_TO_PNOC, 8, 29, 28, MSM8974_PNOC_TO_SNOC);\nDEFINE_QNODE(snoc_to_ocmem_vnoc, MSM8974_SNOC_TO_OCMEM_VNOC, 8, 53, 77, MSM8974_OCMEM_VNOC_TO_OCMEM_NOC);\nDEFINE_QNODE(mas_crypto_core0, MSM8974_SNOC_MAS_CRYPTO_CORE0, 8, 23, -1, MSM8974_SNOC_TO_BIMC);\nDEFINE_QNODE(mas_crypto_core1, MSM8974_SNOC_MAS_CRYPTO_CORE1, 8, 24, -1);\nDEFINE_QNODE(mas_lpass_proc, MSM8974_SNOC_MAS_LPASS_PROC, 8, 25, -1, MSM8974_SNOC_TO_OCMEM_VNOC);\nDEFINE_QNODE(mas_mss, MSM8974_SNOC_MAS_MSS, 8, 26, -1);\nDEFINE_QNODE(mas_mss_nav, MSM8974_SNOC_MAS_MSS_NAV, 8, 27, -1);\nDEFINE_QNODE(mas_ocmem_dma, MSM8974_SNOC_MAS_OCMEM_DMA, 8, 28, -1);\nDEFINE_QNODE(mas_wcss, MSM8974_SNOC_MAS_WCSS, 8, 30, -1);\nDEFINE_QNODE(mas_qdss_etr, MSM8974_SNOC_MAS_QDSS_ETR, 8, 31, -1);\nDEFINE_QNODE(mas_usb3, MSM8974_SNOC_MAS_USB3, 8, 32, -1, MSM8974_SNOC_TO_BIMC);\nDEFINE_QNODE(slv_ampss, MSM8974_SNOC_SLV_AMPSS, 8, -1, 20);\nDEFINE_QNODE(slv_lpass, MSM8974_SNOC_SLV_LPASS, 8, -1, 21);\nDEFINE_QNODE(slv_usb3, MSM8974_SNOC_SLV_USB3, 8, -1, 22);\nDEFINE_QNODE(slv_wcss, MSM8974_SNOC_SLV_WCSS, 8, -1, 23);\nDEFINE_QNODE(slv_ocimem, MSM8974_SNOC_SLV_OCIMEM, 8, -1, 26);\nDEFINE_QNODE(slv_snoc_ocmem, MSM8974_SNOC_SLV_SNOC_OCMEM, 8, -1, 27);\nDEFINE_QNODE(slv_service_snoc, MSM8974_SNOC_SLV_SERVICE_SNOC, 8, -1, 29);\nDEFINE_QNODE(slv_qdss_stm, MSM8974_SNOC_SLV_QDSS_STM, 8, -1, 30);\n\nstatic struct msm8974_icc_node * const msm8974_snoc_nodes[] = {\n\t[SNOC_MAS_LPASS_AHB] = &mas_lpass_ahb,\n\t[SNOC_MAS_QDSS_BAM] = &mas_qdss_bam,\n\t[SNOC_MAS_SNOC_CFG] = &mas_snoc_cfg,\n\t[SNOC_TO_BIMC] = &snoc_to_bimc,\n\t[SNOC_TO_CNOC] = &snoc_to_cnoc,\n\t[SNOC_TO_PNOC] = &snoc_to_pnoc,\n\t[SNOC_TO_OCMEM_VNOC] = &snoc_to_ocmem_vnoc,\n\t[SNOC_MAS_CRYPTO_CORE0] = &mas_crypto_core0,\n\t[SNOC_MAS_CRYPTO_CORE1] = &mas_crypto_core1,\n\t[SNOC_MAS_LPASS_PROC] = &mas_lpass_proc,\n\t[SNOC_MAS_MSS] = &mas_mss,\n\t[SNOC_MAS_MSS_NAV] = &mas_mss_nav,\n\t[SNOC_MAS_OCMEM_DMA] = &mas_ocmem_dma,\n\t[SNOC_MAS_WCSS] = &mas_wcss,\n\t[SNOC_MAS_QDSS_ETR] = &mas_qdss_etr,\n\t[SNOC_MAS_USB3] = &mas_usb3,\n\t[SNOC_SLV_AMPSS] = &slv_ampss,\n\t[SNOC_SLV_LPASS] = &slv_lpass,\n\t[SNOC_SLV_USB3] = &slv_usb3,\n\t[SNOC_SLV_WCSS] = &slv_wcss,\n\t[SNOC_SLV_OCIMEM] = &slv_ocimem,\n\t[SNOC_SLV_SNOC_OCMEM] = &slv_snoc_ocmem,\n\t[SNOC_SLV_SERVICE_SNOC] = &slv_service_snoc,\n\t[SNOC_SLV_QDSS_STM] = &slv_qdss_stm,\n};\n\nstatic const struct msm8974_icc_desc msm8974_snoc = {\n\t.nodes = msm8974_snoc_nodes,\n\t.num_nodes = ARRAY_SIZE(msm8974_snoc_nodes),\n};\n\nstatic void msm8974_icc_rpm_smd_send(struct device *dev, int rsc_type,\n\t\t\t\t     char *name, int id, u64 val)\n{\n\tint ret;\n\n\tif (id == -1)\n\t\treturn;\n\n\t \n\tret = qcom_icc_rpm_smd_send(QCOM_SMD_RPM_ACTIVE_STATE, rsc_type, id,\n\t\t\t\t    val);\n\tif (ret)\n\t\tdev_dbg(dev, \"Cannot set bandwidth for node %s (%d): %d\\n\",\n\t\t\tname, id, ret);\n}\n\nstatic int msm8974_icc_set(struct icc_node *src, struct icc_node *dst)\n{\n\tstruct msm8974_icc_node *src_qn, *dst_qn;\n\tstruct msm8974_icc_provider *qp;\n\tu64 sum_bw, max_peak_bw, rate;\n\tu32 agg_avg = 0, agg_peak = 0;\n\tstruct icc_provider *provider;\n\tstruct icc_node *n;\n\tint ret, i;\n\n\tsrc_qn = src->data;\n\tdst_qn = dst->data;\n\tprovider = src->provider;\n\tqp = to_msm8974_icc_provider(provider);\n\n\tlist_for_each_entry(n, &provider->nodes, node_list)\n\t\tprovider->aggregate(n, 0, n->avg_bw, n->peak_bw,\n\t\t\t\t    &agg_avg, &agg_peak);\n\n\tsum_bw = icc_units_to_bps(agg_avg);\n\tmax_peak_bw = icc_units_to_bps(agg_peak);\n\n\t \n\tmsm8974_icc_rpm_smd_send(provider->dev, RPM_BUS_MASTER_REQ,\n\t\t\t\t src_qn->name, src_qn->mas_rpm_id, sum_bw);\n\n\tmsm8974_icc_rpm_smd_send(provider->dev, RPM_BUS_SLAVE_REQ,\n\t\t\t\t src_qn->name, src_qn->slv_rpm_id, sum_bw);\n\n\t \n\tmsm8974_icc_rpm_smd_send(provider->dev, RPM_BUS_MASTER_REQ,\n\t\t\t\t dst_qn->name, dst_qn->mas_rpm_id, sum_bw);\n\n\tmsm8974_icc_rpm_smd_send(provider->dev, RPM_BUS_SLAVE_REQ,\n\t\t\t\t dst_qn->name, dst_qn->slv_rpm_id, sum_bw);\n\n\trate = max(sum_bw, max_peak_bw);\n\n\tdo_div(rate, src_qn->buswidth);\n\n\trate = min_t(u32, rate, INT_MAX);\n\n\tif (src_qn->rate == rate)\n\t\treturn 0;\n\n\tfor (i = 0; i < qp->num_clks; i++) {\n\t\tret = clk_set_rate(qp->bus_clks[i].clk, rate);\n\t\tif (ret) {\n\t\t\tdev_err(provider->dev, \"%s clk_set_rate error: %d\\n\",\n\t\t\t\tqp->bus_clks[i].id, ret);\n\t\t\tret = 0;\n\t\t}\n\t}\n\n\tsrc_qn->rate = rate;\n\n\treturn 0;\n}\n\nstatic int msm8974_get_bw(struct icc_node *node, u32 *avg, u32 *peak)\n{\n\t*avg = 0;\n\t*peak = 0;\n\n\treturn 0;\n}\n\nstatic int msm8974_icc_probe(struct platform_device *pdev)\n{\n\tconst struct msm8974_icc_desc *desc;\n\tstruct msm8974_icc_node * const *qnodes;\n\tstruct msm8974_icc_provider *qp;\n\tstruct device *dev = &pdev->dev;\n\tstruct icc_onecell_data *data;\n\tstruct icc_provider *provider;\n\tstruct icc_node *node;\n\tsize_t num_nodes, i;\n\tint ret;\n\n\t \n\tif (!qcom_icc_rpm_smd_available())\n\t\treturn -EPROBE_DEFER;\n\n\tdesc = of_device_get_match_data(dev);\n\tif (!desc)\n\t\treturn -EINVAL;\n\n\tqnodes = desc->nodes;\n\tnum_nodes = desc->num_nodes;\n\n\tqp = devm_kzalloc(dev, sizeof(*qp), GFP_KERNEL);\n\tif (!qp)\n\t\treturn -ENOMEM;\n\n\tdata = devm_kzalloc(dev, struct_size(data, nodes, num_nodes),\n\t\t\t    GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\tdata->num_nodes = num_nodes;\n\n\tqp->bus_clks = devm_kmemdup(dev, msm8974_icc_bus_clocks,\n\t\t\t\t    sizeof(msm8974_icc_bus_clocks), GFP_KERNEL);\n\tif (!qp->bus_clks)\n\t\treturn -ENOMEM;\n\n\tqp->num_clks = ARRAY_SIZE(msm8974_icc_bus_clocks);\n\tret = devm_clk_bulk_get(dev, qp->num_clks, qp->bus_clks);\n\tif (ret)\n\t\treturn ret;\n\n\tret = clk_bulk_prepare_enable(qp->num_clks, qp->bus_clks);\n\tif (ret)\n\t\treturn ret;\n\n\tprovider = &qp->provider;\n\tprovider->dev = dev;\n\tprovider->set = msm8974_icc_set;\n\tprovider->aggregate = icc_std_aggregate;\n\tprovider->xlate = of_icc_xlate_onecell;\n\tprovider->data = data;\n\tprovider->get_bw = msm8974_get_bw;\n\n\ticc_provider_init(provider);\n\n\tfor (i = 0; i < num_nodes; i++) {\n\t\tsize_t j;\n\n\t\tnode = icc_node_create(qnodes[i]->id);\n\t\tif (IS_ERR(node)) {\n\t\t\tret = PTR_ERR(node);\n\t\t\tgoto err_remove_nodes;\n\t\t}\n\n\t\tnode->name = qnodes[i]->name;\n\t\tnode->data = qnodes[i];\n\t\ticc_node_add(node, provider);\n\n\t\tdev_dbg(dev, \"registered node %s\\n\", node->name);\n\n\t\t \n\t\tfor (j = 0; j < qnodes[i]->num_links; j++)\n\t\t\ticc_link_create(node, qnodes[i]->links[j]);\n\n\t\tdata->nodes[i] = node;\n\t}\n\n\tret = icc_provider_register(provider);\n\tif (ret)\n\t\tgoto err_remove_nodes;\n\n\tplatform_set_drvdata(pdev, qp);\n\n\treturn 0;\n\nerr_remove_nodes:\n\ticc_nodes_remove(provider);\n\tclk_bulk_disable_unprepare(qp->num_clks, qp->bus_clks);\n\n\treturn ret;\n}\n\nstatic int msm8974_icc_remove(struct platform_device *pdev)\n{\n\tstruct msm8974_icc_provider *qp = platform_get_drvdata(pdev);\n\n\ticc_provider_deregister(&qp->provider);\n\ticc_nodes_remove(&qp->provider);\n\tclk_bulk_disable_unprepare(qp->num_clks, qp->bus_clks);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id msm8974_noc_of_match[] = {\n\t{ .compatible = \"qcom,msm8974-bimc\", .data = &msm8974_bimc},\n\t{ .compatible = \"qcom,msm8974-cnoc\", .data = &msm8974_cnoc},\n\t{ .compatible = \"qcom,msm8974-mmssnoc\", .data = &msm8974_mnoc},\n\t{ .compatible = \"qcom,msm8974-ocmemnoc\", .data = &msm8974_onoc},\n\t{ .compatible = \"qcom,msm8974-pnoc\", .data = &msm8974_pnoc},\n\t{ .compatible = \"qcom,msm8974-snoc\", .data = &msm8974_snoc},\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, msm8974_noc_of_match);\n\nstatic struct platform_driver msm8974_noc_driver = {\n\t.probe = msm8974_icc_probe,\n\t.remove = msm8974_icc_remove,\n\t.driver = {\n\t\t.name = \"qnoc-msm8974\",\n\t\t.of_match_table = msm8974_noc_of_match,\n\t\t.sync_state = icc_sync_state,\n\t},\n};\nmodule_platform_driver(msm8974_noc_driver);\nMODULE_DESCRIPTION(\"Qualcomm MSM8974 NoC driver\");\nMODULE_AUTHOR(\"Brian Masney <masneyb@onstation.org>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}