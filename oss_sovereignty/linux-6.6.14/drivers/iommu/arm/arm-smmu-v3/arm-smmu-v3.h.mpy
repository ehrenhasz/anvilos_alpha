{
  "module_name": "arm-smmu-v3.h",
  "hash_id": "ba6421493a53e189ad0523cb4157890ef806bbb52bab6ac549c4dfe97f639dd8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iommu/arm/arm-smmu-v3/arm-smmu-v3.h",
  "human_readable_source": " \n \n\n#ifndef _ARM_SMMU_V3_H\n#define _ARM_SMMU_V3_H\n\n#include <linux/bitfield.h>\n#include <linux/iommu.h>\n#include <linux/kernel.h>\n#include <linux/mmzone.h>\n#include <linux/sizes.h>\n\n \n#define ARM_SMMU_IDR0\t\t\t0x0\n#define IDR0_ST_LVL\t\t\tGENMASK(28, 27)\n#define IDR0_ST_LVL_2LVL\t\t1\n#define IDR0_STALL_MODEL\t\tGENMASK(25, 24)\n#define IDR0_STALL_MODEL_STALL\t\t0\n#define IDR0_STALL_MODEL_FORCE\t\t2\n#define IDR0_TTENDIAN\t\t\tGENMASK(22, 21)\n#define IDR0_TTENDIAN_MIXED\t\t0\n#define IDR0_TTENDIAN_LE\t\t2\n#define IDR0_TTENDIAN_BE\t\t3\n#define IDR0_CD2L\t\t\t(1 << 19)\n#define IDR0_VMID16\t\t\t(1 << 18)\n#define IDR0_PRI\t\t\t(1 << 16)\n#define IDR0_SEV\t\t\t(1 << 14)\n#define IDR0_MSI\t\t\t(1 << 13)\n#define IDR0_ASID16\t\t\t(1 << 12)\n#define IDR0_ATS\t\t\t(1 << 10)\n#define IDR0_HYP\t\t\t(1 << 9)\n#define IDR0_COHACC\t\t\t(1 << 4)\n#define IDR0_TTF\t\t\tGENMASK(3, 2)\n#define IDR0_TTF_AARCH64\t\t2\n#define IDR0_TTF_AARCH32_64\t\t3\n#define IDR0_S1P\t\t\t(1 << 1)\n#define IDR0_S2P\t\t\t(1 << 0)\n\n#define ARM_SMMU_IDR1\t\t\t0x4\n#define IDR1_TABLES_PRESET\t\t(1 << 30)\n#define IDR1_QUEUES_PRESET\t\t(1 << 29)\n#define IDR1_REL\t\t\t(1 << 28)\n#define IDR1_CMDQS\t\t\tGENMASK(25, 21)\n#define IDR1_EVTQS\t\t\tGENMASK(20, 16)\n#define IDR1_PRIQS\t\t\tGENMASK(15, 11)\n#define IDR1_SSIDSIZE\t\t\tGENMASK(10, 6)\n#define IDR1_SIDSIZE\t\t\tGENMASK(5, 0)\n\n#define ARM_SMMU_IDR3\t\t\t0xc\n#define IDR3_RIL\t\t\t(1 << 10)\n\n#define ARM_SMMU_IDR5\t\t\t0x14\n#define IDR5_STALL_MAX\t\t\tGENMASK(31, 16)\n#define IDR5_GRAN64K\t\t\t(1 << 6)\n#define IDR5_GRAN16K\t\t\t(1 << 5)\n#define IDR5_GRAN4K\t\t\t(1 << 4)\n#define IDR5_OAS\t\t\tGENMASK(2, 0)\n#define IDR5_OAS_32_BIT\t\t\t0\n#define IDR5_OAS_36_BIT\t\t\t1\n#define IDR5_OAS_40_BIT\t\t\t2\n#define IDR5_OAS_42_BIT\t\t\t3\n#define IDR5_OAS_44_BIT\t\t\t4\n#define IDR5_OAS_48_BIT\t\t\t5\n#define IDR5_OAS_52_BIT\t\t\t6\n#define IDR5_VAX\t\t\tGENMASK(11, 10)\n#define IDR5_VAX_52_BIT\t\t\t1\n\n#define ARM_SMMU_IIDR\t\t\t0x18\n#define IIDR_PRODUCTID\t\t\tGENMASK(31, 20)\n#define IIDR_VARIANT\t\t\tGENMASK(19, 16)\n#define IIDR_REVISION\t\t\tGENMASK(15, 12)\n#define IIDR_IMPLEMENTER\t\tGENMASK(11, 0)\n\n#define ARM_SMMU_CR0\t\t\t0x20\n#define CR0_ATSCHK\t\t\t(1 << 4)\n#define CR0_CMDQEN\t\t\t(1 << 3)\n#define CR0_EVTQEN\t\t\t(1 << 2)\n#define CR0_PRIQEN\t\t\t(1 << 1)\n#define CR0_SMMUEN\t\t\t(1 << 0)\n\n#define ARM_SMMU_CR0ACK\t\t\t0x24\n\n#define ARM_SMMU_CR1\t\t\t0x28\n#define CR1_TABLE_SH\t\t\tGENMASK(11, 10)\n#define CR1_TABLE_OC\t\t\tGENMASK(9, 8)\n#define CR1_TABLE_IC\t\t\tGENMASK(7, 6)\n#define CR1_QUEUE_SH\t\t\tGENMASK(5, 4)\n#define CR1_QUEUE_OC\t\t\tGENMASK(3, 2)\n#define CR1_QUEUE_IC\t\t\tGENMASK(1, 0)\n \n#define CR1_CACHE_NC\t\t\t0\n#define CR1_CACHE_WB\t\t\t1\n#define CR1_CACHE_WT\t\t\t2\n\n#define ARM_SMMU_CR2\t\t\t0x2c\n#define CR2_PTM\t\t\t\t(1 << 2)\n#define CR2_RECINVSID\t\t\t(1 << 1)\n#define CR2_E2H\t\t\t\t(1 << 0)\n\n#define ARM_SMMU_GBPA\t\t\t0x44\n#define GBPA_UPDATE\t\t\t(1 << 31)\n#define GBPA_ABORT\t\t\t(1 << 20)\n\n#define ARM_SMMU_IRQ_CTRL\t\t0x50\n#define IRQ_CTRL_EVTQ_IRQEN\t\t(1 << 2)\n#define IRQ_CTRL_PRIQ_IRQEN\t\t(1 << 1)\n#define IRQ_CTRL_GERROR_IRQEN\t\t(1 << 0)\n\n#define ARM_SMMU_IRQ_CTRLACK\t\t0x54\n\n#define ARM_SMMU_GERROR\t\t\t0x60\n#define GERROR_SFM_ERR\t\t\t(1 << 8)\n#define GERROR_MSI_GERROR_ABT_ERR\t(1 << 7)\n#define GERROR_MSI_PRIQ_ABT_ERR\t\t(1 << 6)\n#define GERROR_MSI_EVTQ_ABT_ERR\t\t(1 << 5)\n#define GERROR_MSI_CMDQ_ABT_ERR\t\t(1 << 4)\n#define GERROR_PRIQ_ABT_ERR\t\t(1 << 3)\n#define GERROR_EVTQ_ABT_ERR\t\t(1 << 2)\n#define GERROR_CMDQ_ERR\t\t\t(1 << 0)\n#define GERROR_ERR_MASK\t\t\t0x1fd\n\n#define ARM_SMMU_GERRORN\t\t0x64\n\n#define ARM_SMMU_GERROR_IRQ_CFG0\t0x68\n#define ARM_SMMU_GERROR_IRQ_CFG1\t0x70\n#define ARM_SMMU_GERROR_IRQ_CFG2\t0x74\n\n#define ARM_SMMU_STRTAB_BASE\t\t0x80\n#define STRTAB_BASE_RA\t\t\t(1UL << 62)\n#define STRTAB_BASE_ADDR_MASK\t\tGENMASK_ULL(51, 6)\n\n#define ARM_SMMU_STRTAB_BASE_CFG\t0x88\n#define STRTAB_BASE_CFG_FMT\t\tGENMASK(17, 16)\n#define STRTAB_BASE_CFG_FMT_LINEAR\t0\n#define STRTAB_BASE_CFG_FMT_2LVL\t1\n#define STRTAB_BASE_CFG_SPLIT\t\tGENMASK(10, 6)\n#define STRTAB_BASE_CFG_LOG2SIZE\tGENMASK(5, 0)\n\n#define ARM_SMMU_CMDQ_BASE\t\t0x90\n#define ARM_SMMU_CMDQ_PROD\t\t0x98\n#define ARM_SMMU_CMDQ_CONS\t\t0x9c\n\n#define ARM_SMMU_EVTQ_BASE\t\t0xa0\n#define ARM_SMMU_EVTQ_PROD\t\t0xa8\n#define ARM_SMMU_EVTQ_CONS\t\t0xac\n#define ARM_SMMU_EVTQ_IRQ_CFG0\t\t0xb0\n#define ARM_SMMU_EVTQ_IRQ_CFG1\t\t0xb8\n#define ARM_SMMU_EVTQ_IRQ_CFG2\t\t0xbc\n\n#define ARM_SMMU_PRIQ_BASE\t\t0xc0\n#define ARM_SMMU_PRIQ_PROD\t\t0xc8\n#define ARM_SMMU_PRIQ_CONS\t\t0xcc\n#define ARM_SMMU_PRIQ_IRQ_CFG0\t\t0xd0\n#define ARM_SMMU_PRIQ_IRQ_CFG1\t\t0xd8\n#define ARM_SMMU_PRIQ_IRQ_CFG2\t\t0xdc\n\n#define ARM_SMMU_REG_SZ\t\t\t0xe00\n\n \n#define MSI_CFG0_ADDR_MASK\t\tGENMASK_ULL(51, 2)\n#define MSI_CFG2_SH\t\t\tGENMASK(5, 4)\n#define MSI_CFG2_MEMATTR\t\tGENMASK(3, 0)\n\n \n#define ARM_SMMU_SH_NSH\t\t\t0\n#define ARM_SMMU_SH_OSH\t\t\t2\n#define ARM_SMMU_SH_ISH\t\t\t3\n#define ARM_SMMU_MEMATTR_DEVICE_nGnRE\t0x1\n#define ARM_SMMU_MEMATTR_OIWB\t\t0xf\n\n#define Q_IDX(llq, p)\t\t\t((p) & ((1 << (llq)->max_n_shift) - 1))\n#define Q_WRP(llq, p)\t\t\t((p) & (1 << (llq)->max_n_shift))\n#define Q_OVERFLOW_FLAG\t\t\t(1U << 31)\n#define Q_OVF(p)\t\t\t((p) & Q_OVERFLOW_FLAG)\n#define Q_ENT(q, p)\t\t\t((q)->base +\t\t\t\\\n\t\t\t\t\t Q_IDX(&((q)->llq), p) *\t\\\n\t\t\t\t\t (q)->ent_dwords)\n\n#define Q_BASE_RWA\t\t\t(1UL << 62)\n#define Q_BASE_ADDR_MASK\t\tGENMASK_ULL(51, 5)\n#define Q_BASE_LOG2SIZE\t\t\tGENMASK(4, 0)\n\n \n#ifdef CONFIG_CMA_ALIGNMENT\n#define Q_MAX_SZ_SHIFT\t\t\t(PAGE_SHIFT + CONFIG_CMA_ALIGNMENT)\n#else\n#define Q_MAX_SZ_SHIFT\t\t\t(PAGE_SHIFT + MAX_ORDER)\n#endif\n\n \n#define STRTAB_L1_SZ_SHIFT\t\t20\n#define STRTAB_SPLIT\t\t\t8\n\n#define STRTAB_L1_DESC_DWORDS\t\t1\n#define STRTAB_L1_DESC_SPAN\t\tGENMASK_ULL(4, 0)\n#define STRTAB_L1_DESC_L2PTR_MASK\tGENMASK_ULL(51, 6)\n\n#define STRTAB_STE_DWORDS\t\t8\n#define STRTAB_STE_0_V\t\t\t(1UL << 0)\n#define STRTAB_STE_0_CFG\t\tGENMASK_ULL(3, 1)\n#define STRTAB_STE_0_CFG_ABORT\t\t0\n#define STRTAB_STE_0_CFG_BYPASS\t\t4\n#define STRTAB_STE_0_CFG_S1_TRANS\t5\n#define STRTAB_STE_0_CFG_S2_TRANS\t6\n\n#define STRTAB_STE_0_S1FMT\t\tGENMASK_ULL(5, 4)\n#define STRTAB_STE_0_S1FMT_LINEAR\t0\n#define STRTAB_STE_0_S1FMT_64K_L2\t2\n#define STRTAB_STE_0_S1CTXPTR_MASK\tGENMASK_ULL(51, 6)\n#define STRTAB_STE_0_S1CDMAX\t\tGENMASK_ULL(63, 59)\n\n#define STRTAB_STE_1_S1DSS\t\tGENMASK_ULL(1, 0)\n#define STRTAB_STE_1_S1DSS_TERMINATE\t0x0\n#define STRTAB_STE_1_S1DSS_BYPASS\t0x1\n#define STRTAB_STE_1_S1DSS_SSID0\t0x2\n\n#define STRTAB_STE_1_S1C_CACHE_NC\t0UL\n#define STRTAB_STE_1_S1C_CACHE_WBRA\t1UL\n#define STRTAB_STE_1_S1C_CACHE_WT\t2UL\n#define STRTAB_STE_1_S1C_CACHE_WB\t3UL\n#define STRTAB_STE_1_S1CIR\t\tGENMASK_ULL(3, 2)\n#define STRTAB_STE_1_S1COR\t\tGENMASK_ULL(5, 4)\n#define STRTAB_STE_1_S1CSH\t\tGENMASK_ULL(7, 6)\n\n#define STRTAB_STE_1_S1STALLD\t\t(1UL << 27)\n\n#define STRTAB_STE_1_EATS\t\tGENMASK_ULL(29, 28)\n#define STRTAB_STE_1_EATS_ABT\t\t0UL\n#define STRTAB_STE_1_EATS_TRANS\t\t1UL\n#define STRTAB_STE_1_EATS_S1CHK\t\t2UL\n\n#define STRTAB_STE_1_STRW\t\tGENMASK_ULL(31, 30)\n#define STRTAB_STE_1_STRW_NSEL1\t\t0UL\n#define STRTAB_STE_1_STRW_EL2\t\t2UL\n\n#define STRTAB_STE_1_SHCFG\t\tGENMASK_ULL(45, 44)\n#define STRTAB_STE_1_SHCFG_INCOMING\t1UL\n\n#define STRTAB_STE_2_S2VMID\t\tGENMASK_ULL(15, 0)\n#define STRTAB_STE_2_VTCR\t\tGENMASK_ULL(50, 32)\n#define STRTAB_STE_2_VTCR_S2T0SZ\tGENMASK_ULL(5, 0)\n#define STRTAB_STE_2_VTCR_S2SL0\t\tGENMASK_ULL(7, 6)\n#define STRTAB_STE_2_VTCR_S2IR0\t\tGENMASK_ULL(9, 8)\n#define STRTAB_STE_2_VTCR_S2OR0\t\tGENMASK_ULL(11, 10)\n#define STRTAB_STE_2_VTCR_S2SH0\t\tGENMASK_ULL(13, 12)\n#define STRTAB_STE_2_VTCR_S2TG\t\tGENMASK_ULL(15, 14)\n#define STRTAB_STE_2_VTCR_S2PS\t\tGENMASK_ULL(18, 16)\n#define STRTAB_STE_2_S2AA64\t\t(1UL << 51)\n#define STRTAB_STE_2_S2ENDI\t\t(1UL << 52)\n#define STRTAB_STE_2_S2PTW\t\t(1UL << 54)\n#define STRTAB_STE_2_S2R\t\t(1UL << 58)\n\n#define STRTAB_STE_3_S2TTB_MASK\t\tGENMASK_ULL(51, 4)\n\n \n#define CTXDESC_SPLIT\t\t\t10\n#define CTXDESC_L2_ENTRIES\t\t(1 << CTXDESC_SPLIT)\n\n#define CTXDESC_L1_DESC_DWORDS\t\t1\n#define CTXDESC_L1_DESC_V\t\t(1UL << 0)\n#define CTXDESC_L1_DESC_L2PTR_MASK\tGENMASK_ULL(51, 12)\n\n#define CTXDESC_CD_DWORDS\t\t8\n#define CTXDESC_CD_0_TCR_T0SZ\t\tGENMASK_ULL(5, 0)\n#define CTXDESC_CD_0_TCR_TG0\t\tGENMASK_ULL(7, 6)\n#define CTXDESC_CD_0_TCR_IRGN0\t\tGENMASK_ULL(9, 8)\n#define CTXDESC_CD_0_TCR_ORGN0\t\tGENMASK_ULL(11, 10)\n#define CTXDESC_CD_0_TCR_SH0\t\tGENMASK_ULL(13, 12)\n#define CTXDESC_CD_0_TCR_EPD0\t\t(1ULL << 14)\n#define CTXDESC_CD_0_TCR_EPD1\t\t(1ULL << 30)\n\n#define CTXDESC_CD_0_ENDI\t\t(1UL << 15)\n#define CTXDESC_CD_0_V\t\t\t(1UL << 31)\n\n#define CTXDESC_CD_0_TCR_IPS\t\tGENMASK_ULL(34, 32)\n#define CTXDESC_CD_0_TCR_TBI0\t\t(1ULL << 38)\n\n#define CTXDESC_CD_0_AA64\t\t(1UL << 41)\n#define CTXDESC_CD_0_S\t\t\t(1UL << 44)\n#define CTXDESC_CD_0_R\t\t\t(1UL << 45)\n#define CTXDESC_CD_0_A\t\t\t(1UL << 46)\n#define CTXDESC_CD_0_ASET\t\t(1UL << 47)\n#define CTXDESC_CD_0_ASID\t\tGENMASK_ULL(63, 48)\n\n#define CTXDESC_CD_1_TTB0_MASK\t\tGENMASK_ULL(51, 4)\n\n \n#define CTXDESC_LINEAR_CDMAX\t\tilog2(SZ_64K / (CTXDESC_CD_DWORDS << 3))\n\n \n#define CMDQ_ENT_SZ_SHIFT\t\t4\n#define CMDQ_ENT_DWORDS\t\t\t((1 << CMDQ_ENT_SZ_SHIFT) >> 3)\n#define CMDQ_MAX_SZ_SHIFT\t\t(Q_MAX_SZ_SHIFT - CMDQ_ENT_SZ_SHIFT)\n\n#define CMDQ_CONS_ERR\t\t\tGENMASK(30, 24)\n#define CMDQ_ERR_CERROR_NONE_IDX\t0\n#define CMDQ_ERR_CERROR_ILL_IDX\t\t1\n#define CMDQ_ERR_CERROR_ABT_IDX\t\t2\n#define CMDQ_ERR_CERROR_ATC_INV_IDX\t3\n\n#define CMDQ_PROD_OWNED_FLAG\t\tQ_OVERFLOW_FLAG\n\n \n#define CMDQ_BATCH_ENTRIES\t\tBITS_PER_LONG\n\n#define CMDQ_0_OP\t\t\tGENMASK_ULL(7, 0)\n#define CMDQ_0_SSV\t\t\t(1UL << 11)\n\n#define CMDQ_PREFETCH_0_SID\t\tGENMASK_ULL(63, 32)\n#define CMDQ_PREFETCH_1_SIZE\t\tGENMASK_ULL(4, 0)\n#define CMDQ_PREFETCH_1_ADDR_MASK\tGENMASK_ULL(63, 12)\n\n#define CMDQ_CFGI_0_SSID\t\tGENMASK_ULL(31, 12)\n#define CMDQ_CFGI_0_SID\t\t\tGENMASK_ULL(63, 32)\n#define CMDQ_CFGI_1_LEAF\t\t(1UL << 0)\n#define CMDQ_CFGI_1_RANGE\t\tGENMASK_ULL(4, 0)\n\n#define CMDQ_TLBI_0_NUM\t\t\tGENMASK_ULL(16, 12)\n#define CMDQ_TLBI_RANGE_NUM_MAX\t\t31\n#define CMDQ_TLBI_0_SCALE\t\tGENMASK_ULL(24, 20)\n#define CMDQ_TLBI_0_VMID\t\tGENMASK_ULL(47, 32)\n#define CMDQ_TLBI_0_ASID\t\tGENMASK_ULL(63, 48)\n#define CMDQ_TLBI_1_LEAF\t\t(1UL << 0)\n#define CMDQ_TLBI_1_TTL\t\t\tGENMASK_ULL(9, 8)\n#define CMDQ_TLBI_1_TG\t\t\tGENMASK_ULL(11, 10)\n#define CMDQ_TLBI_1_VA_MASK\t\tGENMASK_ULL(63, 12)\n#define CMDQ_TLBI_1_IPA_MASK\t\tGENMASK_ULL(51, 12)\n\n#define CMDQ_ATC_0_SSID\t\t\tGENMASK_ULL(31, 12)\n#define CMDQ_ATC_0_SID\t\t\tGENMASK_ULL(63, 32)\n#define CMDQ_ATC_0_GLOBAL\t\t(1UL << 9)\n#define CMDQ_ATC_1_SIZE\t\t\tGENMASK_ULL(5, 0)\n#define CMDQ_ATC_1_ADDR_MASK\t\tGENMASK_ULL(63, 12)\n\n#define CMDQ_PRI_0_SSID\t\t\tGENMASK_ULL(31, 12)\n#define CMDQ_PRI_0_SID\t\t\tGENMASK_ULL(63, 32)\n#define CMDQ_PRI_1_GRPID\t\tGENMASK_ULL(8, 0)\n#define CMDQ_PRI_1_RESP\t\t\tGENMASK_ULL(13, 12)\n\n#define CMDQ_RESUME_0_RESP_TERM\t\t0UL\n#define CMDQ_RESUME_0_RESP_RETRY\t1UL\n#define CMDQ_RESUME_0_RESP_ABORT\t2UL\n#define CMDQ_RESUME_0_RESP\t\tGENMASK_ULL(13, 12)\n#define CMDQ_RESUME_0_SID\t\tGENMASK_ULL(63, 32)\n#define CMDQ_RESUME_1_STAG\t\tGENMASK_ULL(15, 0)\n\n#define CMDQ_SYNC_0_CS\t\t\tGENMASK_ULL(13, 12)\n#define CMDQ_SYNC_0_CS_NONE\t\t0\n#define CMDQ_SYNC_0_CS_IRQ\t\t1\n#define CMDQ_SYNC_0_CS_SEV\t\t2\n#define CMDQ_SYNC_0_MSH\t\t\tGENMASK_ULL(23, 22)\n#define CMDQ_SYNC_0_MSIATTR\t\tGENMASK_ULL(27, 24)\n#define CMDQ_SYNC_0_MSIDATA\t\tGENMASK_ULL(63, 32)\n#define CMDQ_SYNC_1_MSIADDR_MASK\tGENMASK_ULL(51, 2)\n\n \n#define EVTQ_ENT_SZ_SHIFT\t\t5\n#define EVTQ_ENT_DWORDS\t\t\t((1 << EVTQ_ENT_SZ_SHIFT) >> 3)\n#define EVTQ_MAX_SZ_SHIFT\t\t(Q_MAX_SZ_SHIFT - EVTQ_ENT_SZ_SHIFT)\n\n#define EVTQ_0_ID\t\t\tGENMASK_ULL(7, 0)\n\n#define EVT_ID_TRANSLATION_FAULT\t0x10\n#define EVT_ID_ADDR_SIZE_FAULT\t\t0x11\n#define EVT_ID_ACCESS_FAULT\t\t0x12\n#define EVT_ID_PERMISSION_FAULT\t\t0x13\n\n#define EVTQ_0_SSV\t\t\t(1UL << 11)\n#define EVTQ_0_SSID\t\t\tGENMASK_ULL(31, 12)\n#define EVTQ_0_SID\t\t\tGENMASK_ULL(63, 32)\n#define EVTQ_1_STAG\t\t\tGENMASK_ULL(15, 0)\n#define EVTQ_1_STALL\t\t\t(1UL << 31)\n#define EVTQ_1_PnU\t\t\t(1UL << 33)\n#define EVTQ_1_InD\t\t\t(1UL << 34)\n#define EVTQ_1_RnW\t\t\t(1UL << 35)\n#define EVTQ_1_S2\t\t\t(1UL << 39)\n#define EVTQ_1_CLASS\t\t\tGENMASK_ULL(41, 40)\n#define EVTQ_1_TT_READ\t\t\t(1UL << 44)\n#define EVTQ_2_ADDR\t\t\tGENMASK_ULL(63, 0)\n#define EVTQ_3_IPA\t\t\tGENMASK_ULL(51, 12)\n\n \n#define PRIQ_ENT_SZ_SHIFT\t\t4\n#define PRIQ_ENT_DWORDS\t\t\t((1 << PRIQ_ENT_SZ_SHIFT) >> 3)\n#define PRIQ_MAX_SZ_SHIFT\t\t(Q_MAX_SZ_SHIFT - PRIQ_ENT_SZ_SHIFT)\n\n#define PRIQ_0_SID\t\t\tGENMASK_ULL(31, 0)\n#define PRIQ_0_SSID\t\t\tGENMASK_ULL(51, 32)\n#define PRIQ_0_PERM_PRIV\t\t(1UL << 58)\n#define PRIQ_0_PERM_EXEC\t\t(1UL << 59)\n#define PRIQ_0_PERM_READ\t\t(1UL << 60)\n#define PRIQ_0_PERM_WRITE\t\t(1UL << 61)\n#define PRIQ_0_PRG_LAST\t\t\t(1UL << 62)\n#define PRIQ_0_SSID_V\t\t\t(1UL << 63)\n\n#define PRIQ_1_PRG_IDX\t\t\tGENMASK_ULL(8, 0)\n#define PRIQ_1_ADDR_MASK\t\tGENMASK_ULL(63, 12)\n\n \n#define ARM_SMMU_POLL_TIMEOUT_US\t1000000  \n#define ARM_SMMU_POLL_SPIN_COUNT\t10\n\n#define MSI_IOVA_BASE\t\t\t0x8000000\n#define MSI_IOVA_LENGTH\t\t\t0x100000\n\nenum pri_resp {\n\tPRI_RESP_DENY = 0,\n\tPRI_RESP_FAIL = 1,\n\tPRI_RESP_SUCC = 2,\n};\n\nstruct arm_smmu_cmdq_ent {\n\t \n\tu8\t\t\t\topcode;\n\tbool\t\t\t\tsubstream_valid;\n\n\t \n\tunion {\n\t\t#define CMDQ_OP_PREFETCH_CFG\t0x1\n\t\tstruct {\n\t\t\tu32\t\t\tsid;\n\t\t} prefetch;\n\n\t\t#define CMDQ_OP_CFGI_STE\t0x3\n\t\t#define CMDQ_OP_CFGI_ALL\t0x4\n\t\t#define CMDQ_OP_CFGI_CD\t\t0x5\n\t\t#define CMDQ_OP_CFGI_CD_ALL\t0x6\n\t\tstruct {\n\t\t\tu32\t\t\tsid;\n\t\t\tu32\t\t\tssid;\n\t\t\tunion {\n\t\t\t\tbool\t\tleaf;\n\t\t\t\tu8\t\tspan;\n\t\t\t};\n\t\t} cfgi;\n\n\t\t#define CMDQ_OP_TLBI_NH_ASID\t0x11\n\t\t#define CMDQ_OP_TLBI_NH_VA\t0x12\n\t\t#define CMDQ_OP_TLBI_EL2_ALL\t0x20\n\t\t#define CMDQ_OP_TLBI_EL2_ASID\t0x21\n\t\t#define CMDQ_OP_TLBI_EL2_VA\t0x22\n\t\t#define CMDQ_OP_TLBI_S12_VMALL\t0x28\n\t\t#define CMDQ_OP_TLBI_S2_IPA\t0x2a\n\t\t#define CMDQ_OP_TLBI_NSNH_ALL\t0x30\n\t\tstruct {\n\t\t\tu8\t\t\tnum;\n\t\t\tu8\t\t\tscale;\n\t\t\tu16\t\t\tasid;\n\t\t\tu16\t\t\tvmid;\n\t\t\tbool\t\t\tleaf;\n\t\t\tu8\t\t\tttl;\n\t\t\tu8\t\t\ttg;\n\t\t\tu64\t\t\taddr;\n\t\t} tlbi;\n\n\t\t#define CMDQ_OP_ATC_INV\t\t0x40\n\t\t#define ATC_INV_SIZE_ALL\t52\n\t\tstruct {\n\t\t\tu32\t\t\tsid;\n\t\t\tu32\t\t\tssid;\n\t\t\tu64\t\t\taddr;\n\t\t\tu8\t\t\tsize;\n\t\t\tbool\t\t\tglobal;\n\t\t} atc;\n\n\t\t#define CMDQ_OP_PRI_RESP\t0x41\n\t\tstruct {\n\t\t\tu32\t\t\tsid;\n\t\t\tu32\t\t\tssid;\n\t\t\tu16\t\t\tgrpid;\n\t\t\tenum pri_resp\t\tresp;\n\t\t} pri;\n\n\t\t#define CMDQ_OP_RESUME\t\t0x44\n\t\tstruct {\n\t\t\tu32\t\t\tsid;\n\t\t\tu16\t\t\tstag;\n\t\t\tu8\t\t\tresp;\n\t\t} resume;\n\n\t\t#define CMDQ_OP_CMD_SYNC\t0x46\n\t\tstruct {\n\t\t\tu64\t\t\tmsiaddr;\n\t\t} sync;\n\t};\n};\n\nstruct arm_smmu_ll_queue {\n\tunion {\n\t\tu64\t\t\tval;\n\t\tstruct {\n\t\t\tu32\t\tprod;\n\t\t\tu32\t\tcons;\n\t\t};\n\t\tstruct {\n\t\t\tatomic_t\tprod;\n\t\t\tatomic_t\tcons;\n\t\t} atomic;\n\t\tu8\t\t\t__pad[SMP_CACHE_BYTES];\n\t} ____cacheline_aligned_in_smp;\n\tu32\t\t\t\tmax_n_shift;\n};\n\nstruct arm_smmu_queue {\n\tstruct arm_smmu_ll_queue\tllq;\n\tint\t\t\t\tirq;  \n\n\t__le64\t\t\t\t*base;\n\tdma_addr_t\t\t\tbase_dma;\n\tu64\t\t\t\tq_base;\n\n\tsize_t\t\t\t\tent_dwords;\n\n\tu32 __iomem\t\t\t*prod_reg;\n\tu32 __iomem\t\t\t*cons_reg;\n};\n\nstruct arm_smmu_queue_poll {\n\tktime_t\t\t\t\ttimeout;\n\tunsigned int\t\t\tdelay;\n\tunsigned int\t\t\tspin_cnt;\n\tbool\t\t\t\twfe;\n};\n\nstruct arm_smmu_cmdq {\n\tstruct arm_smmu_queue\t\tq;\n\tatomic_long_t\t\t\t*valid_map;\n\tatomic_t\t\t\towner_prod;\n\tatomic_t\t\t\tlock;\n};\n\nstruct arm_smmu_cmdq_batch {\n\tu64\t\t\t\tcmds[CMDQ_BATCH_ENTRIES * CMDQ_ENT_DWORDS];\n\tint\t\t\t\tnum;\n};\n\nstruct arm_smmu_evtq {\n\tstruct arm_smmu_queue\t\tq;\n\tstruct iopf_queue\t\t*iopf;\n\tu32\t\t\t\tmax_stalls;\n};\n\nstruct arm_smmu_priq {\n\tstruct arm_smmu_queue\t\tq;\n};\n\n \nstruct arm_smmu_strtab_l1_desc {\n\tu8\t\t\t\tspan;\n\n\t__le64\t\t\t\t*l2ptr;\n\tdma_addr_t\t\t\tl2ptr_dma;\n};\n\nstruct arm_smmu_ctx_desc {\n\tu16\t\t\t\tasid;\n\tu64\t\t\t\tttbr;\n\tu64\t\t\t\ttcr;\n\tu64\t\t\t\tmair;\n\n\trefcount_t\t\t\trefs;\n\tstruct mm_struct\t\t*mm;\n};\n\nstruct arm_smmu_l1_ctx_desc {\n\t__le64\t\t\t\t*l2ptr;\n\tdma_addr_t\t\t\tl2ptr_dma;\n};\n\nstruct arm_smmu_ctx_desc_cfg {\n\t__le64\t\t\t\t*cdtab;\n\tdma_addr_t\t\t\tcdtab_dma;\n\tstruct arm_smmu_l1_ctx_desc\t*l1_desc;\n\tunsigned int\t\t\tnum_l1_ents;\n};\n\nstruct arm_smmu_s1_cfg {\n\tstruct arm_smmu_ctx_desc_cfg\tcdcfg;\n\tstruct arm_smmu_ctx_desc\tcd;\n\tu8\t\t\t\ts1fmt;\n\tu8\t\t\t\ts1cdmax;\n};\n\nstruct arm_smmu_s2_cfg {\n\tu16\t\t\t\tvmid;\n\tu64\t\t\t\tvttbr;\n\tu64\t\t\t\tvtcr;\n};\n\nstruct arm_smmu_strtab_cfg {\n\t__le64\t\t\t\t*strtab;\n\tdma_addr_t\t\t\tstrtab_dma;\n\tstruct arm_smmu_strtab_l1_desc\t*l1_desc;\n\tunsigned int\t\t\tnum_l1_ents;\n\n\tu64\t\t\t\tstrtab_base;\n\tu32\t\t\t\tstrtab_base_cfg;\n};\n\n \nstruct arm_smmu_device {\n\tstruct device\t\t\t*dev;\n\tvoid __iomem\t\t\t*base;\n\tvoid __iomem\t\t\t*page1;\n\n#define ARM_SMMU_FEAT_2_LVL_STRTAB\t(1 << 0)\n#define ARM_SMMU_FEAT_2_LVL_CDTAB\t(1 << 1)\n#define ARM_SMMU_FEAT_TT_LE\t\t(1 << 2)\n#define ARM_SMMU_FEAT_TT_BE\t\t(1 << 3)\n#define ARM_SMMU_FEAT_PRI\t\t(1 << 4)\n#define ARM_SMMU_FEAT_ATS\t\t(1 << 5)\n#define ARM_SMMU_FEAT_SEV\t\t(1 << 6)\n#define ARM_SMMU_FEAT_MSI\t\t(1 << 7)\n#define ARM_SMMU_FEAT_COHERENCY\t\t(1 << 8)\n#define ARM_SMMU_FEAT_TRANS_S1\t\t(1 << 9)\n#define ARM_SMMU_FEAT_TRANS_S2\t\t(1 << 10)\n#define ARM_SMMU_FEAT_STALLS\t\t(1 << 11)\n#define ARM_SMMU_FEAT_HYP\t\t(1 << 12)\n#define ARM_SMMU_FEAT_STALL_FORCE\t(1 << 13)\n#define ARM_SMMU_FEAT_VAX\t\t(1 << 14)\n#define ARM_SMMU_FEAT_RANGE_INV\t\t(1 << 15)\n#define ARM_SMMU_FEAT_BTM\t\t(1 << 16)\n#define ARM_SMMU_FEAT_SVA\t\t(1 << 17)\n#define ARM_SMMU_FEAT_E2H\t\t(1 << 18)\n#define ARM_SMMU_FEAT_NESTING\t\t(1 << 19)\n\tu32\t\t\t\tfeatures;\n\n#define ARM_SMMU_OPT_SKIP_PREFETCH\t(1 << 0)\n#define ARM_SMMU_OPT_PAGE0_REGS_ONLY\t(1 << 1)\n#define ARM_SMMU_OPT_MSIPOLL\t\t(1 << 2)\n#define ARM_SMMU_OPT_CMDQ_FORCE_SYNC\t(1 << 3)\n\tu32\t\t\t\toptions;\n\n\tstruct arm_smmu_cmdq\t\tcmdq;\n\tstruct arm_smmu_evtq\t\tevtq;\n\tstruct arm_smmu_priq\t\tpriq;\n\n\tint\t\t\t\tgerr_irq;\n\tint\t\t\t\tcombined_irq;\n\n\tunsigned long\t\t\tias;  \n\tunsigned long\t\t\toas;  \n\tunsigned long\t\t\tpgsize_bitmap;\n\n#define ARM_SMMU_MAX_ASIDS\t\t(1 << 16)\n\tunsigned int\t\t\tasid_bits;\n\n#define ARM_SMMU_MAX_VMIDS\t\t(1 << 16)\n\tunsigned int\t\t\tvmid_bits;\n\tstruct ida\t\t\tvmid_map;\n\n\tunsigned int\t\t\tssid_bits;\n\tunsigned int\t\t\tsid_bits;\n\n\tstruct arm_smmu_strtab_cfg\tstrtab_cfg;\n\n\t \n\tstruct iommu_device\t\tiommu;\n\n\tstruct rb_root\t\t\tstreams;\n\tstruct mutex\t\t\tstreams_mutex;\n};\n\nstruct arm_smmu_stream {\n\tu32\t\t\t\tid;\n\tstruct arm_smmu_master\t\t*master;\n\tstruct rb_node\t\t\tnode;\n};\n\n \nstruct arm_smmu_master {\n\tstruct arm_smmu_device\t\t*smmu;\n\tstruct device\t\t\t*dev;\n\tstruct arm_smmu_domain\t\t*domain;\n\tstruct list_head\t\tdomain_head;\n\tstruct arm_smmu_stream\t\t*streams;\n\tunsigned int\t\t\tnum_streams;\n\tbool\t\t\t\tats_enabled;\n\tbool\t\t\t\tstall_enabled;\n\tbool\t\t\t\tsva_enabled;\n\tbool\t\t\t\tiopf_enabled;\n\tstruct list_head\t\tbonds;\n\tunsigned int\t\t\tssid_bits;\n};\n\n \nenum arm_smmu_domain_stage {\n\tARM_SMMU_DOMAIN_S1 = 0,\n\tARM_SMMU_DOMAIN_S2,\n\tARM_SMMU_DOMAIN_NESTED,\n\tARM_SMMU_DOMAIN_BYPASS,\n};\n\nstruct arm_smmu_domain {\n\tstruct arm_smmu_device\t\t*smmu;\n\tstruct mutex\t\t\tinit_mutex;  \n\n\tstruct io_pgtable_ops\t\t*pgtbl_ops;\n\tbool\t\t\t\tstall_enabled;\n\tatomic_t\t\t\tnr_ats_masters;\n\n\tenum arm_smmu_domain_stage\tstage;\n\tunion {\n\t\tstruct arm_smmu_s1_cfg\ts1_cfg;\n\t\tstruct arm_smmu_s2_cfg\ts2_cfg;\n\t};\n\n\tstruct iommu_domain\t\tdomain;\n\n\tstruct list_head\t\tdevices;\n\tspinlock_t\t\t\tdevices_lock;\n\n\tstruct list_head\t\tmmu_notifiers;\n};\n\nstatic inline struct arm_smmu_domain *to_smmu_domain(struct iommu_domain *dom)\n{\n\treturn container_of(dom, struct arm_smmu_domain, domain);\n}\n\nextern struct xarray arm_smmu_asid_xa;\nextern struct mutex arm_smmu_asid_lock;\nextern struct arm_smmu_ctx_desc quiet_cd;\n\nint arm_smmu_write_ctx_desc(struct arm_smmu_domain *smmu_domain, int ssid,\n\t\t\t    struct arm_smmu_ctx_desc *cd);\nvoid arm_smmu_tlb_inv_asid(struct arm_smmu_device *smmu, u16 asid);\nvoid arm_smmu_tlb_inv_range_asid(unsigned long iova, size_t size, int asid,\n\t\t\t\t size_t granule, bool leaf,\n\t\t\t\t struct arm_smmu_domain *smmu_domain);\nbool arm_smmu_free_asid(struct arm_smmu_ctx_desc *cd);\nint arm_smmu_atc_inv_domain(struct arm_smmu_domain *smmu_domain, int ssid,\n\t\t\t    unsigned long iova, size_t size);\n\n#ifdef CONFIG_ARM_SMMU_V3_SVA\nbool arm_smmu_sva_supported(struct arm_smmu_device *smmu);\nbool arm_smmu_master_sva_supported(struct arm_smmu_master *master);\nbool arm_smmu_master_sva_enabled(struct arm_smmu_master *master);\nint arm_smmu_master_enable_sva(struct arm_smmu_master *master);\nint arm_smmu_master_disable_sva(struct arm_smmu_master *master);\nbool arm_smmu_master_iopf_supported(struct arm_smmu_master *master);\nvoid arm_smmu_sva_notifier_synchronize(void);\nstruct iommu_domain *arm_smmu_sva_domain_alloc(void);\nvoid arm_smmu_sva_remove_dev_pasid(struct iommu_domain *domain,\n\t\t\t\t   struct device *dev, ioasid_t id);\n#else  \nstatic inline bool arm_smmu_sva_supported(struct arm_smmu_device *smmu)\n{\n\treturn false;\n}\n\nstatic inline bool arm_smmu_master_sva_supported(struct arm_smmu_master *master)\n{\n\treturn false;\n}\n\nstatic inline bool arm_smmu_master_sva_enabled(struct arm_smmu_master *master)\n{\n\treturn false;\n}\n\nstatic inline int arm_smmu_master_enable_sva(struct arm_smmu_master *master)\n{\n\treturn -ENODEV;\n}\n\nstatic inline int arm_smmu_master_disable_sva(struct arm_smmu_master *master)\n{\n\treturn -ENODEV;\n}\n\nstatic inline bool arm_smmu_master_iopf_supported(struct arm_smmu_master *master)\n{\n\treturn false;\n}\n\nstatic inline void arm_smmu_sva_notifier_synchronize(void) {}\n\nstatic inline struct iommu_domain *arm_smmu_sva_domain_alloc(void)\n{\n\treturn NULL;\n}\n\nstatic inline void arm_smmu_sva_remove_dev_pasid(struct iommu_domain *domain,\n\t\t\t\t\t\t struct device *dev,\n\t\t\t\t\t\t ioasid_t id)\n{\n}\n#endif  \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}