{
  "module_name": "pasid.h",
  "hash_id": "99d240993ef4f80d7b3ccb4ba94f9465d8dcd0444952d8526fdf333e89c9be93",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iommu/intel/pasid.h",
  "human_readable_source": " \n \n\n#ifndef __INTEL_PASID_H\n#define __INTEL_PASID_H\n\n#define PASID_MAX\t\t\t0x100000\n#define PASID_PTE_MASK\t\t\t0x3F\n#define PASID_PTE_PRESENT\t\t1\n#define PASID_PTE_FPD\t\t\t2\n#define PDE_PFN_MASK\t\t\tPAGE_MASK\n#define PASID_PDE_SHIFT\t\t\t6\n#define MAX_NR_PASID_BITS\t\t20\n#define PASID_TBL_ENTRIES\t\tBIT(PASID_PDE_SHIFT)\n\n#define is_pasid_enabled(entry)\t\t(((entry)->lo >> 3) & 0x1)\n#define get_pasid_dir_size(entry)\t(1 << ((((entry)->lo >> 9) & 0x7) + 7))\n\n \n#define VCMD_CMD_ALLOC\t\t\t0x1\n#define VCMD_CMD_FREE\t\t\t0x2\n#define VCMD_VRSP_IP\t\t\t0x1\n#define VCMD_VRSP_SC(e)\t\t\t(((e) & 0xff) >> 1)\n#define VCMD_VRSP_SC_SUCCESS\t\t0\n#define VCMD_VRSP_SC_NO_PASID_AVAIL\t16\n#define VCMD_VRSP_SC_INVALID_PASID\t16\n#define VCMD_VRSP_RESULT_PASID(e)\t(((e) >> 16) & 0xfffff)\n#define VCMD_CMD_OPERAND(e)\t\t((e) << 16)\n \n#define FLPT_DEFAULT_DID\t\t1\n#define NUM_RESERVED_DID\t\t2\n\n#define PASID_FLAG_NESTED\t\tBIT(1)\n#define PASID_FLAG_PAGE_SNOOP\t\tBIT(2)\n\n \n#define PASID_FLAG_FL5LP\t\tBIT(1)\n\nstruct pasid_dir_entry {\n\tu64 val;\n};\n\nstruct pasid_entry {\n\tu64 val[8];\n};\n\n#define PASID_ENTRY_PGTT_FL_ONLY\t(1)\n#define PASID_ENTRY_PGTT_SL_ONLY\t(2)\n#define PASID_ENTRY_PGTT_NESTED\t\t(3)\n#define PASID_ENTRY_PGTT_PT\t\t(4)\n\n \nstruct pasid_table {\n\tvoid\t\t\t*table;\t\t \n\tint\t\t\torder;\t\t \n\tu32\t\t\tmax_pasid;\t \n};\n\n \nstatic inline bool pasid_pde_is_present(struct pasid_dir_entry *pde)\n{\n\treturn READ_ONCE(pde->val) & PASID_PTE_PRESENT;\n}\n\n \nstatic inline struct pasid_entry *\nget_pasid_table_from_pde(struct pasid_dir_entry *pde)\n{\n\tif (!pasid_pde_is_present(pde))\n\t\treturn NULL;\n\n\treturn phys_to_virt(READ_ONCE(pde->val) & PDE_PFN_MASK);\n}\n\n \nstatic inline bool pasid_pte_is_present(struct pasid_entry *pte)\n{\n\treturn READ_ONCE(pte->val[0]) & PASID_PTE_PRESENT;\n}\n\n \nstatic inline u16 pasid_pte_get_pgtt(struct pasid_entry *pte)\n{\n\treturn (u16)((READ_ONCE(pte->val[0]) >> 6) & 0x7);\n}\n\nextern unsigned int intel_pasid_max_id;\nint intel_pasid_alloc_table(struct device *dev);\nvoid intel_pasid_free_table(struct device *dev);\nstruct pasid_table *intel_pasid_get_table(struct device *dev);\nint intel_pasid_setup_first_level(struct intel_iommu *iommu,\n\t\t\t\t  struct device *dev, pgd_t *pgd,\n\t\t\t\t  u32 pasid, u16 did, int flags);\nint intel_pasid_setup_second_level(struct intel_iommu *iommu,\n\t\t\t\t   struct dmar_domain *domain,\n\t\t\t\t   struct device *dev, u32 pasid);\nint intel_pasid_setup_pass_through(struct intel_iommu *iommu,\n\t\t\t\t   struct dmar_domain *domain,\n\t\t\t\t   struct device *dev, u32 pasid);\nvoid intel_pasid_tear_down_entry(struct intel_iommu *iommu,\n\t\t\t\t struct device *dev, u32 pasid,\n\t\t\t\t bool fault_ignore);\nint vcmd_alloc_pasid(struct intel_iommu *iommu, u32 *pasid);\nvoid vcmd_free_pasid(struct intel_iommu *iommu, u32 pasid);\nvoid intel_pasid_setup_page_snoop_control(struct intel_iommu *iommu,\n\t\t\t\t\t  struct device *dev, u32 pasid);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}