{
  "module_name": "armv7m_systick.c",
  "hash_id": "45c32f4ac01ed907128a203e3938b19c18b396a643efee9225bed750836ed5b4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clocksource/armv7m_systick.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/clocksource.h>\n#include <linux/clockchips.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/clk.h>\n#include <linux/bitops.h>\n\n#define SYST_CSR\t0x00\n#define SYST_RVR\t0x04\n#define SYST_CVR\t0x08\n#define SYST_CALIB\t0x0c\n\n#define SYST_CSR_ENABLE BIT(0)\n\n#define SYSTICK_LOAD_RELOAD_MASK 0x00FFFFFF\n\nstatic int __init system_timer_of_register(struct device_node *np)\n{\n\tstruct clk *clk = NULL;\n\tvoid __iomem *base;\n\tu32 rate;\n\tint ret;\n\n\tbase = of_iomap(np, 0);\n\tif (!base) {\n\t\tpr_warn(\"system-timer: invalid base address\\n\");\n\t\treturn -ENXIO;\n\t}\n\n\tret = of_property_read_u32(np, \"clock-frequency\", &rate);\n\tif (ret) {\n\t\tclk = of_clk_get(np, 0);\n\t\tif (IS_ERR(clk)) {\n\t\t\tret = PTR_ERR(clk);\n\t\t\tgoto out_unmap;\n\t\t}\n\n\t\tret = clk_prepare_enable(clk);\n\t\tif (ret)\n\t\t\tgoto out_clk_put;\n\n\t\trate = clk_get_rate(clk);\n\t\tif (!rate) {\n\t\t\tret = -EINVAL;\n\t\t\tgoto out_clk_disable;\n\t\t}\n\t}\n\n\twritel_relaxed(SYSTICK_LOAD_RELOAD_MASK, base + SYST_RVR);\n\twritel_relaxed(SYST_CSR_ENABLE, base + SYST_CSR);\n\n\tret = clocksource_mmio_init(base + SYST_CVR, \"arm_system_timer\", rate,\n\t\t\t200, 24, clocksource_mmio_readl_down);\n\tif (ret) {\n\t\tpr_err(\"failed to init clocksource (%d)\\n\", ret);\n\t\tif (clk)\n\t\t\tgoto out_clk_disable;\n\t\telse\n\t\t\tgoto out_unmap;\n\t}\n\n\tpr_info(\"ARM System timer initialized as clocksource\\n\");\n\n\treturn 0;\n\nout_clk_disable:\n\tclk_disable_unprepare(clk);\nout_clk_put:\n\tclk_put(clk);\nout_unmap:\n\tiounmap(base);\n\tpr_warn(\"ARM System timer register failed (%d)\\n\", ret);\n\n\treturn ret;\n}\n\nTIMER_OF_DECLARE(arm_systick, \"arm,armv7m-systick\",\n\t\t\tsystem_timer_of_register);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}