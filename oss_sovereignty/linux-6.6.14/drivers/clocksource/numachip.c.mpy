{
  "module_name": "numachip.c",
  "hash_id": "cbd7d85ae81d804642670ca630fe9c82d46ed2ea10e4a0b24b5bc16bcc4f9c8d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clocksource/numachip.c",
  "human_readable_source": "\n \n\n#include <linux/clockchips.h>\n\n#include <asm/irq.h>\n#include <asm/numachip/numachip.h>\n#include <asm/numachip/numachip_csr.h>\n\nstatic DEFINE_PER_CPU(struct clock_event_device, numachip2_ced);\n\nstatic cycles_t numachip2_timer_read(struct clocksource *cs)\n{\n\treturn numachip2_read64_lcsr(NUMACHIP2_TIMER_NOW);\n}\n\nstatic struct clocksource numachip2_clocksource = {\n\t.name            = \"numachip2\",\n\t.rating          = 295,\n\t.read            = numachip2_timer_read,\n\t.mask            = CLOCKSOURCE_MASK(64),\n\t.flags           = CLOCK_SOURCE_IS_CONTINUOUS,\n\t.mult            = 1,\n\t.shift           = 0,\n};\n\nstatic int numachip2_set_next_event(unsigned long delta, struct clock_event_device *ced)\n{\n\tnumachip2_write64_lcsr(NUMACHIP2_TIMER_DEADLINE + numachip2_timer(),\n\t\tdelta);\n\treturn 0;\n}\n\nstatic const struct clock_event_device numachip2_clockevent __initconst = {\n\t.name            = \"numachip2\",\n\t.rating          = 400,\n\t.set_next_event  = numachip2_set_next_event,\n\t.features        = CLOCK_EVT_FEAT_ONESHOT,\n\t.mult            = 1,\n\t.shift           = 0,\n\t.min_delta_ns    = 1250,\n\t.min_delta_ticks = 1250,\n\t.max_delta_ns    = LONG_MAX,\n\t.max_delta_ticks = LONG_MAX,\n};\n\nstatic void numachip_timer_interrupt(void)\n{\n\tstruct clock_event_device *ced = this_cpu_ptr(&numachip2_ced);\n\n\tced->event_handler(ced);\n}\n\nstatic __init void numachip_timer_each(struct work_struct *work)\n{\n\tunsigned local_apicid = __this_cpu_read(x86_cpu_to_apicid) & 0xff;\n\tstruct clock_event_device *ced = this_cpu_ptr(&numachip2_ced);\n\n\t \n\tnumachip2_write64_lcsr(NUMACHIP2_TIMER_INT + numachip2_timer(),\n\t\t(3 << 22) | (X86_PLATFORM_IPI_VECTOR << 14) |\n\t\t(local_apicid << 6));\n\n\t*ced = numachip2_clockevent;\n\tced->cpumask = cpumask_of(smp_processor_id());\n\tclockevents_register_device(ced);\n}\n\nstatic int __init numachip_timer_init(void)\n{\n\tif (numachip_system != 2)\n\t\treturn -ENODEV;\n\n\t \n\tnumachip2_write64_lcsr(NUMACHIP2_TIMER_RESET, 0);\n\tclocksource_register_hz(&numachip2_clocksource, NSEC_PER_SEC);\n\n\t \n\tx86_platform_ipi_callback = numachip_timer_interrupt;\n\tschedule_on_each_cpu(&numachip_timer_each);\n\n\treturn 0;\n}\n\narch_initcall(numachip_timer_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}