{
  "module_name": "scx200_hrt.c",
  "hash_id": "c9d99025594ae5169e3700f131c18a0623012cfe6168cabd833e6deee1b3daed",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clocksource/scx200_hrt.c",
  "human_readable_source": "\n \n\n#include <linux/clocksource.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/ioport.h>\n#include <linux/scx200.h>\n\n#define NAME \"scx200_hrt\"\n\nstatic int mhz27;\nmodule_param(mhz27, int, 0);\t \nMODULE_PARM_DESC(mhz27, \"count at 27.0 MHz (default is 1.0 MHz)\");\n\nstatic int ppm;\nmodule_param(ppm, int, 0);\t \nMODULE_PARM_DESC(ppm, \"+-adjust to actual XO freq (ppm)\");\n\n \n#define SCx200_TMCNFG_OFFSET (SCx200_TIMER_OFFSET + 5)\n\n \n#define HR_TMEN (1 << 0)\t \n#define HR_TMCLKSEL (1 << 1)\t \n#define HR_TM27MPD (1 << 2)\t \n\n \n#define HRT_FREQ   1000000\n\nstatic u64 read_hrt(struct clocksource *cs)\n{\n\t \n\treturn (u64) inl(scx200_cb_base + SCx200_TIMER_OFFSET);\n}\n\nstatic struct clocksource cs_hrt = {\n\t.name\t\t= \"scx200_hrt\",\n\t.rating\t\t= 250,\n\t.read\t\t= read_hrt,\n\t.mask\t\t= CLOCKSOURCE_MASK(32),\n\t.flags\t\t= CLOCK_SOURCE_IS_CONTINUOUS,\n\t \n};\n\nstatic int __init init_hrt_clocksource(void)\n{\n\tu32 freq;\n\t \n\tif (!scx200_cb_present())\n\t\treturn -ENODEV;\n\n\t \n\tif (!request_region(scx200_cb_base + SCx200_TIMER_OFFSET,\n\t\t\t    SCx200_TIMER_SIZE,\n\t\t\t    \"NatSemi SCx200 High-Resolution Timer\")) {\n\t\tpr_warn(\"unable to lock timer region\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\t \n\toutb(HR_TMEN | (mhz27 ? HR_TMCLKSEL : 0),\n\t     scx200_cb_base + SCx200_TMCNFG_OFFSET);\n\n\tfreq = (HRT_FREQ + ppm);\n\tif (mhz27)\n\t\tfreq *= 27;\n\n\tpr_info(\"enabling scx200 high-res timer (%s MHz +%d ppm)\\n\", mhz27 ? \"27\":\"1\", ppm);\n\n\treturn clocksource_register_hz(&cs_hrt, freq);\n}\n\nmodule_init(init_hrt_clocksource);\n\nMODULE_AUTHOR(\"Jim Cromie <jim.cromie@gmail.com>\");\nMODULE_DESCRIPTION(\"clocksource on SCx200 HiRes Timer\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}