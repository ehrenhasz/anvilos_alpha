{
  "module_name": "btt.h",
  "hash_id": "9b5946faa2b0262d69cce188fc2fda4656281528dafa6965834e5cd2cdf74add",
  "original_prompt": "Ingested from linux-6.6.14/drivers/nvdimm/btt.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_BTT_H\n#define _LINUX_BTT_H\n\n#include <linux/types.h>\n\n#define BTT_SIG_LEN 16\n#define BTT_SIG \"BTT_ARENA_INFO\\0\"\n#define MAP_ENT_SIZE 4\n#define MAP_TRIM_SHIFT 31\n#define MAP_TRIM_MASK (1 << MAP_TRIM_SHIFT)\n#define MAP_ERR_SHIFT 30\n#define MAP_ERR_MASK (1 << MAP_ERR_SHIFT)\n#define MAP_LBA_MASK (~((1 << MAP_TRIM_SHIFT) | (1 << MAP_ERR_SHIFT)))\n#define MAP_ENT_NORMAL 0xC0000000\n#define LOG_GRP_SIZE sizeof(struct log_group)\n#define LOG_ENT_SIZE sizeof(struct log_entry)\n#define ARENA_MIN_SIZE (1UL << 24)\t \n#define ARENA_MAX_SIZE (1ULL << 39)\t \n#define RTT_VALID (1UL << 31)\n#define RTT_INVALID 0\n#define BTT_PG_SIZE 4096\n#define BTT_DEFAULT_NFREE ND_MAX_LANES\n#define LOG_SEQ_INIT 1\n\n#define IB_FLAG_ERROR 0x00000001\n#define IB_FLAG_ERROR_MASK 0x00000001\n\n#define ent_lba(ent) (ent & MAP_LBA_MASK)\n#define ent_e_flag(ent) (!!(ent & MAP_ERR_MASK))\n#define ent_z_flag(ent) (!!(ent & MAP_TRIM_MASK))\n#define set_e_flag(ent) (ent |= MAP_ERR_MASK)\n \n#define ent_normal(ent) (ent_e_flag(ent) && ent_z_flag(ent))\n\nenum btt_init_state {\n\tINIT_UNCHECKED = 0,\n\tINIT_NOTFOUND,\n\tINIT_READY\n};\n\n \n\nstruct log_entry {\n\t__le32 lba;\n\t__le32 old_map;\n\t__le32 new_map;\n\t__le32 seq;\n};\n\nstruct log_group {\n\tstruct log_entry ent[4];\n};\n\nstruct btt_sb {\n\tu8 signature[BTT_SIG_LEN];\n\tu8 uuid[16];\n\tu8 parent_uuid[16];\n\t__le32 flags;\n\t__le16 version_major;\n\t__le16 version_minor;\n\t__le32 external_lbasize;\n\t__le32 external_nlba;\n\t__le32 internal_lbasize;\n\t__le32 internal_nlba;\n\t__le32 nfree;\n\t__le32 infosize;\n\t__le64 nextoff;\n\t__le64 dataoff;\n\t__le64 mapoff;\n\t__le64 logoff;\n\t__le64 info2off;\n\tu8 padding[3968];\n\t__le64 checksum;\n};\n\nstruct free_entry {\n\tu32 block;\n\tu8 sub;\n\tu8 seq;\n\tu8 has_err;\n};\n\nstruct aligned_lock {\n\tunion {\n\t\tspinlock_t lock;\n\t\tu8 cacheline_padding[L1_CACHE_BYTES];\n\t};\n};\n\n \nstruct arena_info {\n\tu64 size;\t\t\t \n\tu64 external_lba_start;\n\tu32 internal_nlba;\n\tu32 internal_lbasize;\n\tu32 external_nlba;\n\tu32 external_lbasize;\n\tu32 nfree;\n\tu16 version_major;\n\tu16 version_minor;\n\tu32 sector_size;\n\t \n\tu64 nextoff;\n\tu64 infooff;\n\tu64 dataoff;\n\tu64 mapoff;\n\tu64 logoff;\n\tu64 info2off;\n\t \n\tstruct free_entry *freelist;\n\tu32 *rtt;\n\tstruct aligned_lock *map_locks;\n\tstruct nd_btt *nd_btt;\n\tstruct list_head list;\n\tstruct dentry *debugfs_dir;\n\t \n\tu32 flags;\n\tstruct mutex err_lock;\n\tint log_index[2];\n};\n\nstruct badblocks;\n\n \nstruct btt {\n\tstruct gendisk *btt_disk;\n\tstruct list_head arena_list;\n\tstruct dentry *debugfs_dir;\n\tstruct nd_btt *nd_btt;\n\tu64 nlba;\n\tunsigned long long rawsize;\n\tu32 lbasize;\n\tu32 sector_size;\n\tstruct nd_region *nd_region;\n\tstruct mutex init_lock;\n\tint init_state;\n\tint num_arenas;\n\tstruct badblocks *phys_bb;\n};\n\nbool nd_btt_arena_is_valid(struct nd_btt *nd_btt, struct btt_sb *super);\nint nd_btt_version(struct nd_btt *nd_btt, struct nd_namespace_common *ndns,\n\t\tstruct btt_sb *btt_sb);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}