{
  "module_name": "zorro-driver.c",
  "hash_id": "05ded6b6ed092f9195ef85fd012759af07a4369c1f5798367a5cf00909a829f1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/zorro/zorro-driver.c",
  "human_readable_source": " \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/zorro.h>\n\n#include \"zorro.h\"\n\n\n     \n\nstatic const struct zorro_device_id *\nzorro_match_device(const struct zorro_device_id *ids,\n\t\t   const struct zorro_dev *z)\n{\n\twhile (ids->id) {\n\t\tif (ids->id == ZORRO_WILDCARD || ids->id == z->id)\n\t\t\treturn ids;\n\t\tids++;\n\t}\n\treturn NULL;\n}\n\n\nstatic int zorro_device_probe(struct device *dev)\n{\n\tint error = 0;\n\tstruct zorro_driver *drv = to_zorro_driver(dev->driver);\n\tstruct zorro_dev *z = to_zorro_dev(dev);\n\n\tif (drv->probe) {\n\t\tconst struct zorro_device_id *id;\n\n\t\tid = zorro_match_device(drv->id_table, z);\n\t\tif (id)\n\t\t\terror = drv->probe(z, id);\n\t\tif (error >= 0)\n\t\t\terror = 0;\n\t}\n\treturn error;\n}\n\n\nstatic void zorro_device_remove(struct device *dev)\n{\n\tstruct zorro_dev *z = to_zorro_dev(dev);\n\tstruct zorro_driver *drv = to_zorro_driver(dev->driver);\n\n\tif (drv->remove)\n\t\tdrv->remove(z);\n}\n\n\n     \n\nint zorro_register_driver(struct zorro_driver *drv)\n{\n\t \n\tdrv->driver.name = drv->name;\n\tdrv->driver.bus = &zorro_bus_type;\n\n\t \n\treturn driver_register(&drv->driver);\n}\nEXPORT_SYMBOL(zorro_register_driver);\n\n\n     \n\nvoid zorro_unregister_driver(struct zorro_driver *drv)\n{\n\tdriver_unregister(&drv->driver);\n}\nEXPORT_SYMBOL(zorro_unregister_driver);\n\n\n     \n\nstatic int zorro_bus_match(struct device *dev, struct device_driver *drv)\n{\n\tstruct zorro_dev *z = to_zorro_dev(dev);\n\tstruct zorro_driver *zorro_drv = to_zorro_driver(drv);\n\tconst struct zorro_device_id *ids = zorro_drv->id_table;\n\n\tif (!ids)\n\t\treturn 0;\n\n\treturn !!zorro_match_device(ids, z);\n}\n\nstatic int zorro_uevent(const struct device *dev, struct kobj_uevent_env *env)\n{\n\tconst struct zorro_dev *z;\n\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tz = to_zorro_dev(dev);\n\tif (!z)\n\t\treturn -ENODEV;\n\n\tif (add_uevent_var(env, \"ZORRO_ID=%08X\", z->id) ||\n\t    add_uevent_var(env, \"ZORRO_SLOT_NAME=%s\", dev_name(dev)) ||\n\t    add_uevent_var(env, \"ZORRO_SLOT_ADDR=%04X\", z->slotaddr) ||\n\t    add_uevent_var(env, \"MODALIAS=\" ZORRO_DEVICE_MODALIAS_FMT, z->id))\n\t\treturn -ENOMEM;\n\n\treturn 0;\n}\n\nstruct bus_type zorro_bus_type = {\n\t.name\t\t= \"zorro\",\n\t.dev_name\t= \"zorro\",\n\t.dev_groups\t= zorro_device_attribute_groups,\n\t.match\t\t= zorro_bus_match,\n\t.uevent\t\t= zorro_uevent,\n\t.probe\t\t= zorro_device_probe,\n\t.remove\t\t= zorro_device_remove,\n};\nEXPORT_SYMBOL(zorro_bus_type);\n\n\nstatic int __init zorro_driver_init(void)\n{\n\treturn bus_register(&zorro_bus_type);\n}\n\npostcore_initcall(zorro_driver_init);\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}