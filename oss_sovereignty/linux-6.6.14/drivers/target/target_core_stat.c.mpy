{
  "module_name": "target_core_stat.c",
  "hash_id": "5c0d39cc8d2a35a42d7bdb06626b9272fe67764f5d816342f620e50bfff2ebf6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/target/target_core_stat.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/delay.h>\n#include <linux/timer.h>\n#include <linux/string.h>\n#include <linux/utsname.h>\n#include <linux/proc_fs.h>\n#include <linux/seq_file.h>\n#include <linux/configfs.h>\n\n#include <target/target_core_base.h>\n#include <target/target_core_backend.h>\n#include <target/target_core_fabric.h>\n\n#include \"target_core_internal.h\"\n\n#ifndef INITIAL_JIFFIES\n#define INITIAL_JIFFIES ((unsigned long)(unsigned int) (-300*HZ))\n#endif\n\n#define SCSI_LU_INDEX\t\t\t1\n#define LU_COUNT\t\t\t1\n\n \n\nstatic struct se_device *to_stat_dev(struct config_item *item)\n{\n\tstruct se_dev_stat_grps *sgrps = container_of(to_config_group(item),\n\t\t\tstruct se_dev_stat_grps, scsi_dev_group);\n\treturn container_of(sgrps, struct se_device, dev_stat_grps);\n}\n\nstatic ssize_t target_stat_inst_show(struct config_item *item, char *page)\n{\n\tstruct se_hba *hba = to_stat_dev(item)->se_hba;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", hba->hba_index);\n}\n\nstatic ssize_t target_stat_indx_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", to_stat_dev(item)->dev_index);\n}\n\nstatic ssize_t target_stat_role_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"Target\\n\");\n}\n\nstatic ssize_t target_stat_ports_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", to_stat_dev(item)->export_count);\n}\n\nCONFIGFS_ATTR_RO(target_stat_, inst);\nCONFIGFS_ATTR_RO(target_stat_, indx);\nCONFIGFS_ATTR_RO(target_stat_, role);\nCONFIGFS_ATTR_RO(target_stat_, ports);\n\nstatic struct configfs_attribute *target_stat_scsi_dev_attrs[] = {\n\t&target_stat_attr_inst,\n\t&target_stat_attr_indx,\n\t&target_stat_attr_role,\n\t&target_stat_attr_ports,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_dev_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_dev_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct se_device *to_stat_tgt_dev(struct config_item *item)\n{\n\tstruct se_dev_stat_grps *sgrps = container_of(to_config_group(item),\n\t\t\tstruct se_dev_stat_grps, scsi_tgt_dev_group);\n\treturn container_of(sgrps, struct se_device, dev_stat_grps);\n}\n\nstatic ssize_t target_stat_tgt_inst_show(struct config_item *item, char *page)\n{\n\tstruct se_hba *hba = to_stat_tgt_dev(item)->se_hba;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", hba->hba_index);\n}\n\nstatic ssize_t target_stat_tgt_indx_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", to_stat_tgt_dev(item)->dev_index);\n}\n\nstatic ssize_t target_stat_tgt_num_lus_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", LU_COUNT);\n}\n\nstatic ssize_t target_stat_tgt_status_show(struct config_item *item,\n\t\tchar *page)\n{\n\tif (to_stat_tgt_dev(item)->export_count)\n\t\treturn snprintf(page, PAGE_SIZE, \"activated\");\n\telse\n\t\treturn snprintf(page, PAGE_SIZE, \"deactivated\");\n}\n\nstatic ssize_t target_stat_tgt_non_access_lus_show(struct config_item *item,\n\t\tchar *page)\n{\n\tint non_accessible_lus;\n\n\tif (to_stat_tgt_dev(item)->export_count)\n\t\tnon_accessible_lus = 0;\n\telse\n\t\tnon_accessible_lus = 1;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", non_accessible_lus);\n}\n\nstatic ssize_t target_stat_tgt_resets_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\tatomic_long_read(&to_stat_tgt_dev(item)->num_resets));\n}\n\nstatic ssize_t target_stat_tgt_aborts_complete_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\tatomic_long_read(&to_stat_tgt_dev(item)->aborts_complete));\n}\n\nstatic ssize_t target_stat_tgt_aborts_no_task_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\tatomic_long_read(&to_stat_tgt_dev(item)->aborts_no_task));\n}\n\nCONFIGFS_ATTR_RO(target_stat_tgt_, inst);\nCONFIGFS_ATTR_RO(target_stat_tgt_, indx);\nCONFIGFS_ATTR_RO(target_stat_tgt_, num_lus);\nCONFIGFS_ATTR_RO(target_stat_tgt_, status);\nCONFIGFS_ATTR_RO(target_stat_tgt_, non_access_lus);\nCONFIGFS_ATTR_RO(target_stat_tgt_, resets);\nCONFIGFS_ATTR_RO(target_stat_tgt_, aborts_complete);\nCONFIGFS_ATTR_RO(target_stat_tgt_, aborts_no_task);\n\nstatic struct configfs_attribute *target_stat_scsi_tgt_dev_attrs[] = {\n\t&target_stat_tgt_attr_inst,\n\t&target_stat_tgt_attr_indx,\n\t&target_stat_tgt_attr_num_lus,\n\t&target_stat_tgt_attr_status,\n\t&target_stat_tgt_attr_non_access_lus,\n\t&target_stat_tgt_attr_resets,\n\t&target_stat_tgt_attr_aborts_complete,\n\t&target_stat_tgt_attr_aborts_no_task,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_tgt_dev_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_tgt_dev_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \n\nstatic struct se_device *to_stat_lu_dev(struct config_item *item)\n{\n\tstruct se_dev_stat_grps *sgrps = container_of(to_config_group(item),\n\t\t\tstruct se_dev_stat_grps, scsi_lu_group);\n\treturn container_of(sgrps, struct se_device, dev_stat_grps);\n}\n\nstatic ssize_t target_stat_lu_inst_show(struct config_item *item, char *page)\n{\n\tstruct se_hba *hba = to_stat_lu_dev(item)->se_hba;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", hba->hba_index);\n}\n\nstatic ssize_t target_stat_lu_dev_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\tto_stat_lu_dev(item)->dev_index);\n}\n\nstatic ssize_t target_stat_lu_indx_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", SCSI_LU_INDEX);\n}\n\nstatic ssize_t target_stat_lu_lun_show(struct config_item *item, char *page)\n{\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%llu\\n\", (unsigned long long)0);\n}\n\nstatic ssize_t target_stat_lu_lu_name_show(struct config_item *item, char *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%s\\n\",\n\t\t\t(strlen(dev->t10_wwn.unit_serial)) ?\n\t\t\tdev->t10_wwn.unit_serial : \"None\");\n}\n\nstatic ssize_t target_stat_lu_vend_show(struct config_item *item, char *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\treturn snprintf(page, PAGE_SIZE, \"%-\" __stringify(INQUIRY_VENDOR_LEN)\n\t\t\t\"s\\n\", dev->t10_wwn.vendor);\n}\n\nstatic ssize_t target_stat_lu_prod_show(struct config_item *item, char *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\treturn snprintf(page, PAGE_SIZE, \"%-\" __stringify(INQUIRY_MODEL_LEN)\n\t\t\t\"s\\n\", dev->t10_wwn.model);\n}\n\nstatic ssize_t target_stat_lu_rev_show(struct config_item *item, char *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\treturn snprintf(page, PAGE_SIZE, \"%-\" __stringify(INQUIRY_REVISION_LEN)\n\t\t\t\"s\\n\", dev->t10_wwn.revision);\n}\n\nstatic ssize_t target_stat_lu_dev_type_show(struct config_item *item, char *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\tdev->transport->get_device_type(dev));\n}\n\nstatic ssize_t target_stat_lu_status_show(struct config_item *item, char *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%s\\n\",\n\t\t(dev->export_count) ? \"available\" : \"notavailable\");\n}\n\nstatic ssize_t target_stat_lu_state_bit_show(struct config_item *item,\n\t\tchar *page)\n{\n\t \n\treturn snprintf(page, PAGE_SIZE, \"exposed\\n\");\n}\n\nstatic ssize_t target_stat_lu_num_cmds_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\tatomic_long_read(&dev->num_cmds));\n}\n\nstatic ssize_t target_stat_lu_read_mbytes_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\tatomic_long_read(&dev->read_bytes) >> 20);\n}\n\nstatic ssize_t target_stat_lu_write_mbytes_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\tatomic_long_read(&dev->write_bytes) >> 20);\n}\n\nstatic ssize_t target_stat_lu_resets_show(struct config_item *item, char *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\tatomic_long_read(&dev->num_resets));\n}\n\nstatic ssize_t target_stat_lu_full_stat_show(struct config_item *item,\n\t\tchar *page)\n{\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", 0);\n}\n\nstatic ssize_t target_stat_lu_hs_num_cmds_show(struct config_item *item,\n\t\tchar *page)\n{\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", 0);\n}\n\nstatic ssize_t target_stat_lu_creation_time_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_device *dev = to_stat_lu_dev(item);\n\n\t \n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", (u32)(((u32)dev->creation_time -\n\t\t\t\tINITIAL_JIFFIES) * 100 / HZ));\n}\n\nCONFIGFS_ATTR_RO(target_stat_lu_, inst);\nCONFIGFS_ATTR_RO(target_stat_lu_, dev);\nCONFIGFS_ATTR_RO(target_stat_lu_, indx);\nCONFIGFS_ATTR_RO(target_stat_lu_, lun);\nCONFIGFS_ATTR_RO(target_stat_lu_, lu_name);\nCONFIGFS_ATTR_RO(target_stat_lu_, vend);\nCONFIGFS_ATTR_RO(target_stat_lu_, prod);\nCONFIGFS_ATTR_RO(target_stat_lu_, rev);\nCONFIGFS_ATTR_RO(target_stat_lu_, dev_type);\nCONFIGFS_ATTR_RO(target_stat_lu_, status);\nCONFIGFS_ATTR_RO(target_stat_lu_, state_bit);\nCONFIGFS_ATTR_RO(target_stat_lu_, num_cmds);\nCONFIGFS_ATTR_RO(target_stat_lu_, read_mbytes);\nCONFIGFS_ATTR_RO(target_stat_lu_, write_mbytes);\nCONFIGFS_ATTR_RO(target_stat_lu_, resets);\nCONFIGFS_ATTR_RO(target_stat_lu_, full_stat);\nCONFIGFS_ATTR_RO(target_stat_lu_, hs_num_cmds);\nCONFIGFS_ATTR_RO(target_stat_lu_, creation_time);\n\nstatic struct configfs_attribute *target_stat_scsi_lu_attrs[] = {\n\t&target_stat_lu_attr_inst,\n\t&target_stat_lu_attr_dev,\n\t&target_stat_lu_attr_indx,\n\t&target_stat_lu_attr_lun,\n\t&target_stat_lu_attr_lu_name,\n\t&target_stat_lu_attr_vend,\n\t&target_stat_lu_attr_prod,\n\t&target_stat_lu_attr_rev,\n\t&target_stat_lu_attr_dev_type,\n\t&target_stat_lu_attr_status,\n\t&target_stat_lu_attr_state_bit,\n\t&target_stat_lu_attr_num_cmds,\n\t&target_stat_lu_attr_read_mbytes,\n\t&target_stat_lu_attr_write_mbytes,\n\t&target_stat_lu_attr_resets,\n\t&target_stat_lu_attr_full_stat,\n\t&target_stat_lu_attr_hs_num_cmds,\n\t&target_stat_lu_attr_creation_time,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_lu_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_lu_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nvoid target_stat_setup_dev_default_groups(struct se_device *dev)\n{\n\tconfig_group_init_type_name(&dev->dev_stat_grps.scsi_dev_group,\n\t\t\t\"scsi_dev\", &target_stat_scsi_dev_cit);\n\tconfigfs_add_default_group(&dev->dev_stat_grps.scsi_dev_group,\n\t\t\t&dev->dev_stat_grps.stat_group);\n\n\tconfig_group_init_type_name(&dev->dev_stat_grps.scsi_tgt_dev_group,\n\t\t\t\"scsi_tgt_dev\", &target_stat_scsi_tgt_dev_cit);\n\tconfigfs_add_default_group(&dev->dev_stat_grps.scsi_tgt_dev_group,\n\t\t\t&dev->dev_stat_grps.stat_group);\n\n\tconfig_group_init_type_name(&dev->dev_stat_grps.scsi_lu_group,\n\t\t\t\"scsi_lu\", &target_stat_scsi_lu_cit);\n\tconfigfs_add_default_group(&dev->dev_stat_grps.scsi_lu_group,\n\t\t\t&dev->dev_stat_grps.stat_group);\n}\n\n \n\nstatic struct se_lun *to_stat_port(struct config_item *item)\n{\n\tstruct se_port_stat_grps *pgrps = container_of(to_config_group(item),\n\t\t\tstruct se_port_stat_grps, scsi_port_group);\n\treturn container_of(pgrps, struct se_lun, port_stat_grps);\n}\n\nstatic ssize_t target_stat_port_inst_show(struct config_item *item, char *page)\n{\n\tstruct se_lun *lun = to_stat_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", dev->hba_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_port_dev_show(struct config_item *item, char *page)\n{\n\tstruct se_lun *lun = to_stat_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", dev->dev_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_port_indx_show(struct config_item *item, char *page)\n{\n\tstruct se_lun *lun = to_stat_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lun->lun_tpg->tpg_rtpi);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_port_role_show(struct config_item *item, char *page)\n{\n\tstruct se_lun *lun = to_stat_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%s%u\\n\", \"Device\", dev->dev_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_port_busy_count_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev) {\n\t\t \n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", 0);\n\t}\n\trcu_read_unlock();\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(target_stat_port_, inst);\nCONFIGFS_ATTR_RO(target_stat_port_, dev);\nCONFIGFS_ATTR_RO(target_stat_port_, indx);\nCONFIGFS_ATTR_RO(target_stat_port_, role);\nCONFIGFS_ATTR_RO(target_stat_port_, busy_count);\n\nstatic struct configfs_attribute *target_stat_scsi_port_attrs[] = {\n\t&target_stat_port_attr_inst,\n\t&target_stat_port_attr_dev,\n\t&target_stat_port_attr_indx,\n\t&target_stat_port_attr_role,\n\t&target_stat_port_attr_busy_count,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_port_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_port_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct se_lun *to_stat_tgt_port(struct config_item *item)\n{\n\tstruct se_port_stat_grps *pgrps = container_of(to_config_group(item),\n\t\t\tstruct se_port_stat_grps, scsi_tgt_port_group);\n\treturn container_of(pgrps, struct se_lun, port_stat_grps);\n}\n\nstatic ssize_t target_stat_tgt_port_inst_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", dev->hba_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_dev_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", dev->dev_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lun->lun_tpg->tpg_rtpi);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_name_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_portal_group *tpg = lun->lun_tpg;\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%sPort#%u\\n\",\n\t\t\ttpg->se_tpg_tfo->fabric_name,\n\t\t\tlun->lun_tpg->tpg_rtpi);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_port_index_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_portal_group *tpg = lun->lun_tpg;\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%s%s%d\\n\",\n\t\t\ttpg->se_tpg_tfo->tpg_get_wwn(tpg), \"+t+\",\n\t\t\ttpg->se_tpg_tfo->tpg_get_tag(tpg));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_in_cmds_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\t       atomic_long_read(&lun->lun_stats.cmd_pdus));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_write_mbytes_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\t(u32)(atomic_long_read(&lun->lun_stats.rx_data_octets) >> 20));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_read_mbytes_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\t\t(u32)(atomic_long_read(&lun->lun_stats.tx_data_octets) >> 20));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_tgt_port_hs_in_cmds_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_stat_tgt_port(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev) {\n\t\t \n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", 0);\n\t}\n\trcu_read_unlock();\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, inst);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, dev);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, indx);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, name);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, port_index);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, in_cmds);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, write_mbytes);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, read_mbytes);\nCONFIGFS_ATTR_RO(target_stat_tgt_port_, hs_in_cmds);\n\nstatic struct configfs_attribute *target_stat_scsi_tgt_port_attrs[] = {\n\t&target_stat_tgt_port_attr_inst,\n\t&target_stat_tgt_port_attr_dev,\n\t&target_stat_tgt_port_attr_indx,\n\t&target_stat_tgt_port_attr_name,\n\t&target_stat_tgt_port_attr_port_index,\n\t&target_stat_tgt_port_attr_in_cmds,\n\t&target_stat_tgt_port_attr_write_mbytes,\n\t&target_stat_tgt_port_attr_read_mbytes,\n\t&target_stat_tgt_port_attr_hs_in_cmds,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_tgt_port_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_tgt_port_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct se_lun *to_transport_stat(struct config_item *item)\n{\n\tstruct se_port_stat_grps *pgrps = container_of(to_config_group(item),\n\t\t\tstruct se_port_stat_grps, scsi_transport_group);\n\treturn container_of(pgrps, struct se_lun, port_stat_grps);\n}\n\nstatic ssize_t target_stat_transport_inst_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_transport_stat(item);\n\tstruct se_device *dev;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", dev->hba_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_transport_device_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_transport_stat(item);\n\tstruct se_device *dev;\n\tstruct se_portal_group *tpg = lun->lun_tpg;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev) {\n\t\t \n\t\tret = snprintf(page, PAGE_SIZE, \"scsiTransport%s\\n\",\n\t\t\t       tpg->se_tpg_tfo->fabric_name);\n\t}\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_transport_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_transport_stat(item);\n\tstruct se_device *dev;\n\tstruct se_portal_group *tpg = lun->lun_tpg;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\t       tpg->se_tpg_tfo->tpg_get_inst_index(tpg));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_transport_dev_name_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_transport_stat(item);\n\tstruct se_device *dev;\n\tstruct se_portal_group *tpg = lun->lun_tpg;\n\tstruct t10_wwn *wwn;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev) {\n\t\twwn = &dev->t10_wwn;\n\t\t \n\t\tret = snprintf(page, PAGE_SIZE, \"%s+%s\\n\",\n\t\t\t\ttpg->se_tpg_tfo->tpg_get_wwn(tpg),\n\t\t\t\t(strlen(wwn->unit_serial)) ? wwn->unit_serial :\n\t\t\t\twwn->vendor);\n\t}\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_transport_proto_id_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun *lun = to_transport_stat(item);\n\tstruct se_device *dev;\n\tstruct se_portal_group *tpg = lun->lun_tpg;\n\tssize_t ret = -ENODEV;\n\n\trcu_read_lock();\n\tdev = rcu_dereference(lun->lun_se_dev);\n\tif (dev)\n\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", tpg->proto_id);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(target_stat_transport_, inst);\nCONFIGFS_ATTR_RO(target_stat_transport_, device);\nCONFIGFS_ATTR_RO(target_stat_transport_, indx);\nCONFIGFS_ATTR_RO(target_stat_transport_, dev_name);\nCONFIGFS_ATTR_RO(target_stat_transport_, proto_id);\n\nstatic struct configfs_attribute *target_stat_scsi_transport_attrs[] = {\n\t&target_stat_transport_attr_inst,\n\t&target_stat_transport_attr_device,\n\t&target_stat_transport_attr_indx,\n\t&target_stat_transport_attr_dev_name,\n\t&target_stat_transport_attr_proto_id,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_transport_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_transport_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nvoid target_stat_setup_port_default_groups(struct se_lun *lun)\n{\n\tconfig_group_init_type_name(&lun->port_stat_grps.scsi_port_group,\n\t\t\t\"scsi_port\", &target_stat_scsi_port_cit);\n\tconfigfs_add_default_group(&lun->port_stat_grps.scsi_port_group,\n\t\t\t&lun->port_stat_grps.stat_group);\n\n\tconfig_group_init_type_name(&lun->port_stat_grps.scsi_tgt_port_group,\n\t\t\t\"scsi_tgt_port\", &target_stat_scsi_tgt_port_cit);\n\tconfigfs_add_default_group(&lun->port_stat_grps.scsi_tgt_port_group,\n\t\t\t&lun->port_stat_grps.stat_group);\n\n\tconfig_group_init_type_name(&lun->port_stat_grps.scsi_transport_group,\n\t\t\t\"scsi_transport\", &target_stat_scsi_transport_cit);\n\tconfigfs_add_default_group(&lun->port_stat_grps.scsi_transport_group,\n\t\t\t&lun->port_stat_grps.stat_group);\n}\n\n \n\nstatic struct se_lun_acl *auth_to_lacl(struct config_item *item)\n{\n\tstruct se_ml_stat_grps *lgrps = container_of(to_config_group(item),\n\t\t\tstruct se_ml_stat_grps, scsi_auth_intr_group);\n\treturn container_of(lgrps, struct se_lun_acl, ml_stat_grps);\n}\n\nstatic ssize_t target_stat_auth_inst_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tstruct se_portal_group *tpg;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\ttpg = nacl->se_tpg;\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\ttpg->se_tpg_tfo->tpg_get_inst_index(tpg));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_dev_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", deve->se_lun->lun_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_port_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tstruct se_portal_group *tpg;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\ttpg = nacl->se_tpg;\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", tpg->se_tpg_tfo->tpg_get_tag(tpg));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", nacl->acl_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_dev_or_port_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", 1);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_intr_name_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%s\\n\", nacl->initiatorname);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_map_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", 0);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_att_count_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", deve->attach_count);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_num_cmds_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t       atomic_long_read(&deve->total_cmds));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_read_mbytes_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t      (u32)(atomic_long_read(&deve->read_bytes) >> 20));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_write_mbytes_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t      (u32)(atomic_long_read(&deve->write_bytes) >> 20));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_hs_num_cmds_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", 0);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_creation_time_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", (u32)(((u32)deve->creation_time -\n\t\t\t\tINITIAL_JIFFIES) * 100 / HZ));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_auth_row_status_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = auth_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"Ready\\n\");\n\trcu_read_unlock();\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(target_stat_auth_, inst);\nCONFIGFS_ATTR_RO(target_stat_auth_, dev);\nCONFIGFS_ATTR_RO(target_stat_auth_, port);\nCONFIGFS_ATTR_RO(target_stat_auth_, indx);\nCONFIGFS_ATTR_RO(target_stat_auth_, dev_or_port);\nCONFIGFS_ATTR_RO(target_stat_auth_, intr_name);\nCONFIGFS_ATTR_RO(target_stat_auth_, map_indx);\nCONFIGFS_ATTR_RO(target_stat_auth_, att_count);\nCONFIGFS_ATTR_RO(target_stat_auth_, num_cmds);\nCONFIGFS_ATTR_RO(target_stat_auth_, read_mbytes);\nCONFIGFS_ATTR_RO(target_stat_auth_, write_mbytes);\nCONFIGFS_ATTR_RO(target_stat_auth_, hs_num_cmds);\nCONFIGFS_ATTR_RO(target_stat_auth_, creation_time);\nCONFIGFS_ATTR_RO(target_stat_auth_, row_status);\n\nstatic struct configfs_attribute *target_stat_scsi_auth_intr_attrs[] = {\n\t&target_stat_auth_attr_inst,\n\t&target_stat_auth_attr_dev,\n\t&target_stat_auth_attr_port,\n\t&target_stat_auth_attr_indx,\n\t&target_stat_auth_attr_dev_or_port,\n\t&target_stat_auth_attr_intr_name,\n\t&target_stat_auth_attr_map_indx,\n\t&target_stat_auth_attr_att_count,\n\t&target_stat_auth_attr_num_cmds,\n\t&target_stat_auth_attr_read_mbytes,\n\t&target_stat_auth_attr_write_mbytes,\n\t&target_stat_auth_attr_hs_num_cmds,\n\t&target_stat_auth_attr_creation_time,\n\t&target_stat_auth_attr_row_status,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_auth_intr_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_auth_intr_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \n\nstatic struct se_lun_acl *iport_to_lacl(struct config_item *item)\n{\n\tstruct se_ml_stat_grps *lgrps = container_of(to_config_group(item),\n\t\t\tstruct se_ml_stat_grps, scsi_att_intr_port_group);\n\treturn container_of(lgrps, struct se_lun_acl, ml_stat_grps);\n}\n\nstatic ssize_t target_stat_iport_inst_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = iport_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tstruct se_portal_group *tpg;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\ttpg = nacl->se_tpg;\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\ttpg->se_tpg_tfo->tpg_get_inst_index(tpg));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_iport_dev_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = iport_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", deve->se_lun->lun_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_iport_port_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = iport_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tstruct se_portal_group *tpg;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\ttpg = nacl->se_tpg;\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", tpg->se_tpg_tfo->tpg_get_tag(tpg));\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_iport_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = iport_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_session *se_sess;\n\tstruct se_portal_group *tpg;\n\tssize_t ret;\n\n\tspin_lock_irq(&nacl->nacl_sess_lock);\n\tse_sess = nacl->nacl_sess;\n\tif (!se_sess) {\n\t\tspin_unlock_irq(&nacl->nacl_sess_lock);\n\t\treturn -ENODEV;\n\t}\n\n\ttpg = nacl->se_tpg;\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\ttpg->se_tpg_tfo->sess_get_index(se_sess));\n\tspin_unlock_irq(&nacl->nacl_sess_lock);\n\treturn ret;\n}\n\nstatic ssize_t target_stat_iport_port_auth_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = iport_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_dev_entry *deve;\n\tssize_t ret;\n\n\trcu_read_lock();\n\tdeve = target_nacl_find_deve(nacl, lacl->mapped_lun);\n\tif (!deve) {\n\t\trcu_read_unlock();\n\t\treturn -ENODEV;\n\t}\n\t \n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", nacl->acl_index);\n\trcu_read_unlock();\n\treturn ret;\n}\n\nstatic ssize_t target_stat_iport_port_ident_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct se_lun_acl *lacl = iport_to_lacl(item);\n\tstruct se_node_acl *nacl = lacl->se_lun_nacl;\n\tstruct se_session *se_sess;\n\tstruct se_portal_group *tpg;\n\tssize_t ret;\n\tunsigned char buf[64];\n\n\tspin_lock_irq(&nacl->nacl_sess_lock);\n\tse_sess = nacl->nacl_sess;\n\tif (!se_sess) {\n\t\tspin_unlock_irq(&nacl->nacl_sess_lock);\n\t\treturn -ENODEV;\n\t}\n\n\ttpg = nacl->se_tpg;\n\t \n\tmemset(buf, 0, 64);\n\tif (tpg->se_tpg_tfo->sess_get_initiator_sid != NULL)\n\t\ttpg->se_tpg_tfo->sess_get_initiator_sid(se_sess, buf, 64);\n\n\tret = snprintf(page, PAGE_SIZE, \"%s+i+%s\\n\", nacl->initiatorname, buf);\n\tspin_unlock_irq(&nacl->nacl_sess_lock);\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(target_stat_iport_, inst);\nCONFIGFS_ATTR_RO(target_stat_iport_, dev);\nCONFIGFS_ATTR_RO(target_stat_iport_, port);\nCONFIGFS_ATTR_RO(target_stat_iport_, indx);\nCONFIGFS_ATTR_RO(target_stat_iport_, port_auth_indx);\nCONFIGFS_ATTR_RO(target_stat_iport_, port_ident);\n\nstatic struct configfs_attribute *target_stat_scsi_ath_intr_port_attrs[] = {\n\t&target_stat_iport_attr_inst,\n\t&target_stat_iport_attr_dev,\n\t&target_stat_iport_attr_port,\n\t&target_stat_iport_attr_indx,\n\t&target_stat_iport_attr_port_auth_indx,\n\t&target_stat_iport_attr_port_ident,\n\tNULL,\n};\n\nstatic const struct config_item_type target_stat_scsi_att_intr_port_cit = {\n\t.ct_attrs\t\t= target_stat_scsi_ath_intr_port_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nvoid target_stat_setup_mappedlun_default_groups(struct se_lun_acl *lacl)\n{\n\tconfig_group_init_type_name(&lacl->ml_stat_grps.scsi_auth_intr_group,\n\t\t\t\"scsi_auth_intr\", &target_stat_scsi_auth_intr_cit);\n\tconfigfs_add_default_group(&lacl->ml_stat_grps.scsi_auth_intr_group,\n\t\t\t&lacl->ml_stat_grps.stat_group);\n\n\tconfig_group_init_type_name(&lacl->ml_stat_grps.scsi_att_intr_port_group,\n\t\t\t\"scsi_att_intr_port\", &target_stat_scsi_att_intr_port_cit);\n\tconfigfs_add_default_group(&lacl->ml_stat_grps.scsi_att_intr_port_group,\n\t\t\t&lacl->ml_stat_grps.stat_group);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}