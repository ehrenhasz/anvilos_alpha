{
  "module_name": "iscsi_target_stat.c",
  "hash_id": "4018cf97a8886cabb70e6fbcd0eedeec252bdd9851ae093e39b68aa5c0acf90f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/target/iscsi/iscsi_target_stat.c",
  "human_readable_source": "\n \n\n#include <linux/configfs.h>\n#include <linux/export.h>\n#include <scsi/iscsi_proto.h>\n#include <target/target_core_base.h>\n\n#include <target/iscsi/iscsi_target_core.h>\n#include \"iscsi_target_parameters.h\"\n#include \"iscsi_target_device.h\"\n#include \"iscsi_target_tpg.h\"\n#include \"iscsi_target_util.h\"\n#include <target/iscsi/iscsi_target_stat.h>\n\n#ifndef INITIAL_JIFFIES\n#define INITIAL_JIFFIES ((unsigned long)(unsigned int) (-300*HZ))\n#endif\n\n \n#define ISCSI_INST_NUM_NODES\t\t1\n#define ISCSI_INST_DESCR\t\t\"Storage Engine Target\"\n#define ISCSI_DISCONTINUITY_TIME\t0\n\n#define ISCSI_NODE_INDEX\t\t1\n\n#define ISPRINT(a)   ((a >= ' ') && (a <= '~'))\n\n \n \nstatic struct iscsi_tiqn *iscsi_instance_tiqn(struct config_item *item)\n{\n\tstruct iscsi_wwn_stat_grps *igrps = container_of(to_config_group(item),\n\t\t\tstruct iscsi_wwn_stat_grps, iscsi_instance_group);\n\treturn container_of(igrps, struct iscsi_tiqn, tiqn_stat_grps);\n}\n\nstatic ssize_t iscsi_stat_instance_inst_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\tiscsi_instance_tiqn(item)->tiqn_index);\n}\n\nstatic ssize_t iscsi_stat_instance_min_ver_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", ISCSI_DRAFT20_VERSION);\n}\n\nstatic ssize_t iscsi_stat_instance_max_ver_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", ISCSI_DRAFT20_VERSION);\n}\n\nstatic ssize_t iscsi_stat_instance_portals_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\tiscsi_instance_tiqn(item)->tiqn_num_tpg_nps);\n}\n\nstatic ssize_t iscsi_stat_instance_nodes_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", ISCSI_INST_NUM_NODES);\n}\n\nstatic ssize_t iscsi_stat_instance_sessions_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\tiscsi_instance_tiqn(item)->tiqn_nsessions);\n}\n\nstatic ssize_t iscsi_stat_instance_fail_sess_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_instance_tiqn(item);\n\tstruct iscsi_sess_err_stats *sess_err = &tiqn->sess_err_stats;\n\tu32 sess_err_count;\n\n\tspin_lock_bh(&sess_err->lock);\n\tsess_err_count = (sess_err->digest_errors +\n\t\t\t  sess_err->cxn_timeout_errors +\n\t\t\t  sess_err->pdu_format_errors);\n\tspin_unlock_bh(&sess_err->lock);\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", sess_err_count);\n}\n\nstatic ssize_t iscsi_stat_instance_fail_type_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_instance_tiqn(item);\n\tstruct iscsi_sess_err_stats *sess_err = &tiqn->sess_err_stats;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\tsess_err->last_sess_failure_type);\n}\n\nstatic ssize_t iscsi_stat_instance_fail_rem_name_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_instance_tiqn(item);\n\tstruct iscsi_sess_err_stats *sess_err = &tiqn->sess_err_stats;\n\n\treturn snprintf(page, PAGE_SIZE, \"%s\\n\",\n\t\t\tsess_err->last_sess_fail_rem_name[0] ?\n\t\t\tsess_err->last_sess_fail_rem_name : NONE);\n}\n\nstatic ssize_t iscsi_stat_instance_disc_time_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", ISCSI_DISCONTINUITY_TIME);\n}\n\nstatic ssize_t iscsi_stat_instance_description_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%s\\n\", ISCSI_INST_DESCR);\n}\n\nstatic ssize_t iscsi_stat_instance_vendor_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"Datera, Inc. iSCSI-Target\\n\");\n}\n\nstatic ssize_t iscsi_stat_instance_version_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%s\\n\", ISCSIT_VERSION);\n}\n\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, inst);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, min_ver);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, max_ver);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, portals);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, nodes);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, sessions);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, fail_sess);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, fail_type);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, fail_rem_name);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, disc_time);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, description);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, vendor);\nCONFIGFS_ATTR_RO(iscsi_stat_instance_, version);\n\nstatic struct configfs_attribute *iscsi_stat_instance_attrs[] = {\n\t&iscsi_stat_instance_attr_inst,\n\t&iscsi_stat_instance_attr_min_ver,\n\t&iscsi_stat_instance_attr_max_ver,\n\t&iscsi_stat_instance_attr_portals,\n\t&iscsi_stat_instance_attr_nodes,\n\t&iscsi_stat_instance_attr_sessions,\n\t&iscsi_stat_instance_attr_fail_sess,\n\t&iscsi_stat_instance_attr_fail_type,\n\t&iscsi_stat_instance_attr_fail_rem_name,\n\t&iscsi_stat_instance_attr_disc_time,\n\t&iscsi_stat_instance_attr_description,\n\t&iscsi_stat_instance_attr_vendor,\n\t&iscsi_stat_instance_attr_version,\n\tNULL,\n};\n\nconst struct config_item_type iscsi_stat_instance_cit = {\n\t.ct_attrs\t\t= iscsi_stat_instance_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct iscsi_tiqn *iscsi_sess_err_tiqn(struct config_item *item)\n{\n\tstruct iscsi_wwn_stat_grps *igrps = container_of(to_config_group(item),\n\t\t\tstruct iscsi_wwn_stat_grps, iscsi_sess_err_group);\n\treturn container_of(igrps, struct iscsi_tiqn, tiqn_stat_grps);\n}\n\nstatic ssize_t iscsi_stat_sess_err_inst_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\tiscsi_sess_err_tiqn(item)->tiqn_index);\n}\n\nstatic ssize_t iscsi_stat_sess_err_digest_errors_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_sess_err_tiqn(item);\n\tstruct iscsi_sess_err_stats *sess_err = &tiqn->sess_err_stats;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", sess_err->digest_errors);\n}\n\nstatic ssize_t iscsi_stat_sess_err_cxn_errors_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_sess_err_tiqn(item);\n\tstruct iscsi_sess_err_stats *sess_err = &tiqn->sess_err_stats;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", sess_err->cxn_timeout_errors);\n}\n\nstatic ssize_t iscsi_stat_sess_err_format_errors_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_sess_err_tiqn(item);\n\tstruct iscsi_sess_err_stats *sess_err = &tiqn->sess_err_stats;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", sess_err->pdu_format_errors);\n}\n\nCONFIGFS_ATTR_RO(iscsi_stat_sess_err_, inst);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_err_, digest_errors);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_err_, cxn_errors);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_err_, format_errors);\n\nstatic struct configfs_attribute *iscsi_stat_sess_err_attrs[] = {\n\t&iscsi_stat_sess_err_attr_inst,\n\t&iscsi_stat_sess_err_attr_digest_errors,\n\t&iscsi_stat_sess_err_attr_cxn_errors,\n\t&iscsi_stat_sess_err_attr_format_errors,\n\tNULL,\n};\n\nconst struct config_item_type iscsi_stat_sess_err_cit = {\n\t.ct_attrs\t\t= iscsi_stat_sess_err_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct iscsi_tiqn *iscsi_tgt_attr_tiqn(struct config_item *item)\n{\n\tstruct iscsi_wwn_stat_grps *igrps = container_of(to_config_group(item),\n\t\t\tstruct iscsi_wwn_stat_grps, iscsi_tgt_attr_group);\n\treturn container_of(igrps, struct iscsi_tiqn, tiqn_stat_grps);\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_inst_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\tiscsi_tgt_attr_tiqn(item)->tiqn_index);\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", ISCSI_NODE_INDEX);\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_login_fails_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_tgt_attr_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tu32 fail_count;\n\n\tspin_lock(&lstat->lock);\n\tfail_count = (lstat->redirects + lstat->authorize_fails +\n\t\t\tlstat->authenticate_fails + lstat->negotiate_fails +\n\t\t\tlstat->other_fails);\n\tspin_unlock(&lstat->lock);\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", fail_count);\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_last_fail_time_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_tgt_attr_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tu32 last_fail_time;\n\n\tspin_lock(&lstat->lock);\n\tlast_fail_time = lstat->last_fail_time ?\n\t\t\t(u32)(((u32)lstat->last_fail_time -\n\t\t\t\tINITIAL_JIFFIES) * 100 / HZ) : 0;\n\tspin_unlock(&lstat->lock);\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", last_fail_time);\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_last_fail_type_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_tgt_attr_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tu32 last_fail_type;\n\n\tspin_lock(&lstat->lock);\n\tlast_fail_type = lstat->last_fail_type;\n\tspin_unlock(&lstat->lock);\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", last_fail_type);\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_fail_intr_name_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_tgt_attr_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tunsigned char buf[ISCSI_IQN_LEN];\n\n\tspin_lock(&lstat->lock);\n\tsnprintf(buf, ISCSI_IQN_LEN, \"%s\", lstat->last_intr_fail_name[0] ?\n\t\t\t\tlstat->last_intr_fail_name : NONE);\n\tspin_unlock(&lstat->lock);\n\n\treturn snprintf(page, PAGE_SIZE, \"%s\\n\", buf);\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_fail_intr_addr_type_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_tgt_attr_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tint ret;\n\n\tspin_lock(&lstat->lock);\n\tif (lstat->last_intr_fail_ip_family == AF_INET6)\n\t\tret = snprintf(page, PAGE_SIZE, \"ipv6\\n\");\n\telse\n\t\tret = snprintf(page, PAGE_SIZE, \"ipv4\\n\");\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_tgt_attr_fail_intr_addr_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_tgt_attr_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tint ret;\n\n\tspin_lock(&lstat->lock);\n\tret = snprintf(page, PAGE_SIZE, \"%pISc\\n\", &lstat->last_intr_fail_sockaddr);\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, inst);\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, indx);\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, login_fails);\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, last_fail_time);\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, last_fail_type);\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, fail_intr_name);\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, fail_intr_addr_type);\nCONFIGFS_ATTR_RO(iscsi_stat_tgt_attr_, fail_intr_addr);\n\nstatic struct configfs_attribute *iscsi_stat_tgt_attr_attrs[] = {\n\t&iscsi_stat_tgt_attr_attr_inst,\n\t&iscsi_stat_tgt_attr_attr_indx,\n\t&iscsi_stat_tgt_attr_attr_login_fails,\n\t&iscsi_stat_tgt_attr_attr_last_fail_time,\n\t&iscsi_stat_tgt_attr_attr_last_fail_type,\n\t&iscsi_stat_tgt_attr_attr_fail_intr_name,\n\t&iscsi_stat_tgt_attr_attr_fail_intr_addr_type,\n\t&iscsi_stat_tgt_attr_attr_fail_intr_addr,\n\tNULL,\n};\n\nconst struct config_item_type iscsi_stat_tgt_attr_cit = {\n\t.ct_attrs\t\t= iscsi_stat_tgt_attr_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct iscsi_tiqn *iscsi_login_stat_tiqn(struct config_item *item)\n{\n\tstruct iscsi_wwn_stat_grps *igrps = container_of(to_config_group(item),\n\t\t\tstruct iscsi_wwn_stat_grps, iscsi_login_stats_group);\n\treturn container_of(igrps, struct iscsi_tiqn, tiqn_stat_grps);\n}\n\nstatic ssize_t iscsi_stat_login_inst_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\tiscsi_login_stat_tiqn(item)->tiqn_index);\n}\n\nstatic ssize_t iscsi_stat_login_indx_show(struct config_item *item,\n\t\tchar *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", ISCSI_NODE_INDEX);\n}\n\nstatic ssize_t iscsi_stat_login_accepts_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_login_stat_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tssize_t ret;\n\n\tspin_lock(&lstat->lock);\n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lstat->accepts);\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_login_other_fails_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_login_stat_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tssize_t ret;\n\n\tspin_lock(&lstat->lock);\n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lstat->other_fails);\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_login_redirects_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_login_stat_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tssize_t ret;\n\n\tspin_lock(&lstat->lock);\n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lstat->redirects);\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_login_authorize_fails_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_login_stat_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tssize_t ret;\n\n\tspin_lock(&lstat->lock);\n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lstat->authorize_fails);\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_login_authenticate_fails_show(\n\t\tstruct config_item *item, char *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_login_stat_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tssize_t ret;\n\n\tspin_lock(&lstat->lock);\n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lstat->authenticate_fails);\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_login_negotiate_fails_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_login_stat_tiqn(item);\n\tstruct iscsi_login_stats *lstat = &tiqn->login_stats;\n\tssize_t ret;\n\n\tspin_lock(&lstat->lock);\n\tret = snprintf(page, PAGE_SIZE, \"%u\\n\", lstat->negotiate_fails);\n\tspin_unlock(&lstat->lock);\n\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(iscsi_stat_login_, inst);\nCONFIGFS_ATTR_RO(iscsi_stat_login_, indx);\nCONFIGFS_ATTR_RO(iscsi_stat_login_, accepts);\nCONFIGFS_ATTR_RO(iscsi_stat_login_, other_fails);\nCONFIGFS_ATTR_RO(iscsi_stat_login_, redirects);\nCONFIGFS_ATTR_RO(iscsi_stat_login_, authorize_fails);\nCONFIGFS_ATTR_RO(iscsi_stat_login_, authenticate_fails);\nCONFIGFS_ATTR_RO(iscsi_stat_login_, negotiate_fails);\n\nstatic struct configfs_attribute *iscsi_stat_login_stats_attrs[] = {\n\t&iscsi_stat_login_attr_inst,\n\t&iscsi_stat_login_attr_indx,\n\t&iscsi_stat_login_attr_accepts,\n\t&iscsi_stat_login_attr_other_fails,\n\t&iscsi_stat_login_attr_redirects,\n\t&iscsi_stat_login_attr_authorize_fails,\n\t&iscsi_stat_login_attr_authenticate_fails,\n\t&iscsi_stat_login_attr_negotiate_fails,\n\tNULL,\n};\n\nconst struct config_item_type iscsi_stat_login_cit = {\n\t.ct_attrs\t\t= iscsi_stat_login_stats_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct iscsi_tiqn *iscsi_logout_stat_tiqn(struct config_item *item)\n{\n\tstruct iscsi_wwn_stat_grps *igrps = container_of(to_config_group(item),\n\t\t\tstruct iscsi_wwn_stat_grps, iscsi_logout_stats_group);\n\treturn container_of(igrps, struct iscsi_tiqn, tiqn_stat_grps);\n}\n\nstatic ssize_t iscsi_stat_logout_inst_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\tiscsi_logout_stat_tiqn(item)->tiqn_index);\n}\n\nstatic ssize_t iscsi_stat_logout_indx_show(struct config_item *item, char *page)\n{\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", ISCSI_NODE_INDEX);\n}\n\nstatic ssize_t iscsi_stat_logout_normal_logouts_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_logout_stat_tiqn(item);\n\tstruct iscsi_logout_stats *lstats = &tiqn->logout_stats;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", lstats->normal_logouts);\n}\n\nstatic ssize_t iscsi_stat_logout_abnormal_logouts_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_tiqn *tiqn = iscsi_logout_stat_tiqn(item);\n\tstruct iscsi_logout_stats *lstats = &tiqn->logout_stats;\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", lstats->abnormal_logouts);\n}\n\nCONFIGFS_ATTR_RO(iscsi_stat_logout_, inst);\nCONFIGFS_ATTR_RO(iscsi_stat_logout_, indx);\nCONFIGFS_ATTR_RO(iscsi_stat_logout_, normal_logouts);\nCONFIGFS_ATTR_RO(iscsi_stat_logout_, abnormal_logouts);\n\nstatic struct configfs_attribute *iscsi_stat_logout_stats_attrs[] = {\n\t&iscsi_stat_logout_attr_inst,\n\t&iscsi_stat_logout_attr_indx,\n\t&iscsi_stat_logout_attr_normal_logouts,\n\t&iscsi_stat_logout_attr_abnormal_logouts,\n\tNULL,\n};\n\nconst struct config_item_type iscsi_stat_logout_cit = {\n\t.ct_attrs\t\t= iscsi_stat_logout_stats_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n\n \nstatic struct iscsi_node_acl *iscsi_stat_nacl(struct config_item *item)\n{\n\tstruct iscsi_node_stat_grps *igrps = container_of(to_config_group(item),\n\t\t\tstruct iscsi_node_stat_grps, iscsi_sess_stats_group);\n\treturn container_of(igrps, struct iscsi_node_acl, node_stat_grps);\n}\n\nstatic ssize_t iscsi_stat_sess_inst_show(struct config_item *item, char *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_wwn *wwn = acl->se_node_acl.se_tpg->se_tpg_wwn;\n\tstruct iscsi_tiqn *tiqn = container_of(wwn,\n\t\t\tstruct iscsi_tiqn, tiqn_wwn);\n\n\treturn snprintf(page, PAGE_SIZE, \"%u\\n\", tiqn->tiqn_index);\n}\n\nstatic ssize_t iscsi_stat_sess_node_show(struct config_item *item, char *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\t\tsess->sess_ops->SessionType ? 0 : ISCSI_NODE_INDEX);\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_sess_indx_show(struct config_item *item, char *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%u\\n\",\n\t\t\t\t\tsess->session_index);\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_sess_cmd_pdus_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\t\t       atomic_long_read(&sess->cmd_pdus));\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_sess_rsp_pdus_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\t\t       atomic_long_read(&sess->rsp_pdus));\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_sess_txdata_octs_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\t\t       atomic_long_read(&sess->tx_data_octets));\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_sess_rxdata_octs_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\t\t       atomic_long_read(&sess->rx_data_octets));\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_sess_conn_digest_errors_show(struct config_item *item,\n\t\tchar *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\t\t       atomic_long_read(&sess->conn_digest_errors));\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nstatic ssize_t iscsi_stat_sess_conn_timeout_errors_show(\n\t\tstruct config_item *item, char *page)\n{\n\tstruct iscsi_node_acl *acl = iscsi_stat_nacl(item);\n\tstruct se_node_acl *se_nacl = &acl->se_node_acl;\n\tstruct iscsit_session *sess;\n\tstruct se_session *se_sess;\n\tssize_t ret = 0;\n\n\tspin_lock_bh(&se_nacl->nacl_sess_lock);\n\tse_sess = se_nacl->nacl_sess;\n\tif (se_sess) {\n\t\tsess = se_sess->fabric_sess_ptr;\n\t\tif (sess)\n\t\t\tret = snprintf(page, PAGE_SIZE, \"%lu\\n\",\n\t\t\t\t       atomic_long_read(&sess->conn_timeout_errors));\n\t}\n\tspin_unlock_bh(&se_nacl->nacl_sess_lock);\n\n\treturn ret;\n}\n\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, inst);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, node);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, indx);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, cmd_pdus);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, rsp_pdus);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, txdata_octs);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, rxdata_octs);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, conn_digest_errors);\nCONFIGFS_ATTR_RO(iscsi_stat_sess_, conn_timeout_errors);\n\nstatic struct configfs_attribute *iscsi_stat_sess_stats_attrs[] = {\n\t&iscsi_stat_sess_attr_inst,\n\t&iscsi_stat_sess_attr_node,\n\t&iscsi_stat_sess_attr_indx,\n\t&iscsi_stat_sess_attr_cmd_pdus,\n\t&iscsi_stat_sess_attr_rsp_pdus,\n\t&iscsi_stat_sess_attr_txdata_octs,\n\t&iscsi_stat_sess_attr_rxdata_octs,\n\t&iscsi_stat_sess_attr_conn_digest_errors,\n\t&iscsi_stat_sess_attr_conn_timeout_errors,\n\tNULL,\n};\n\nconst struct config_item_type iscsi_stat_sess_cit = {\n\t.ct_attrs\t\t= iscsi_stat_sess_stats_attrs,\n\t.ct_owner\t\t= THIS_MODULE,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}