{
  "module_name": "sbp_target.h",
  "hash_id": "4112967cb154d3a951938dd41664ba08a2a9cde4d86766728b70055dab361e47",
  "original_prompt": "Ingested from linux-6.6.14/drivers/target/sbp/sbp_target.h",
  "human_readable_source": " \n#ifndef _SBP_BASE_H\n#define _SBP_BASE_H\n\n#include <linux/firewire.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n#include <target/target_core_base.h>\n\n#define SBP_VERSION  \"v0.1\"\n#define SBP_NAMELEN 32\n\n#define SBP_ORB_FETCH_SIZE\t8\n\n#define MANAGEMENT_AGENT_STATE_IDLE\t0\n#define MANAGEMENT_AGENT_STATE_BUSY\t1\n\n#define ORB_NOTIFY(v)\t\t\t(((v) >> 31) & 0x01)\n#define ORB_REQUEST_FORMAT(v)\t\t(((v) >> 29) & 0x03)\n\n#define MANAGEMENT_ORB_FUNCTION(v)\t(((v) >> 16) & 0x0f)\n\n#define MANAGEMENT_ORB_FUNCTION_LOGIN\t\t\t0x0\n#define MANAGEMENT_ORB_FUNCTION_QUERY_LOGINS\t\t0x1\n#define MANAGEMENT_ORB_FUNCTION_RECONNECT\t\t0x3\n#define MANAGEMENT_ORB_FUNCTION_SET_PASSWORD\t\t0x4\n#define MANAGEMENT_ORB_FUNCTION_LOGOUT\t\t\t0x7\n#define MANAGEMENT_ORB_FUNCTION_ABORT_TASK\t\t0xb\n#define MANAGEMENT_ORB_FUNCTION_ABORT_TASK_SET\t\t0xc\n#define MANAGEMENT_ORB_FUNCTION_LOGICAL_UNIT_RESET\t0xe\n#define MANAGEMENT_ORB_FUNCTION_TARGET_RESET\t\t0xf\n\n#define LOGIN_ORB_EXCLUSIVE(v)\t\t(((v) >> 28) &   0x01)\n#define LOGIN_ORB_RESERVED(v)\t\t(((v) >> 24) &   0x0f)\n#define LOGIN_ORB_RECONNECT(v)\t\t(((v) >> 20) &   0x0f)\n#define LOGIN_ORB_LUN(v)\t\t(((v) >>  0) & 0xffff)\n#define LOGIN_ORB_PASSWORD_LENGTH(v)\t(((v) >> 16) & 0xffff)\n#define LOGIN_ORB_RESPONSE_LENGTH(v)\t(((v) >>  0) & 0xffff)\n\n#define RECONNECT_ORB_LOGIN_ID(v)\t(((v) >>  0) & 0xffff)\n#define LOGOUT_ORB_LOGIN_ID(v)\t\t(((v) >>  0) & 0xffff)\n\n#define CMDBLK_ORB_DIRECTION(v)\t\t(((v) >> 27) &   0x01)\n#define CMDBLK_ORB_SPEED(v)\t\t(((v) >> 24) &   0x07)\n#define CMDBLK_ORB_MAX_PAYLOAD(v)\t(((v) >> 20) &   0x0f)\n#define CMDBLK_ORB_PG_TBL_PRESENT(v)\t(((v) >> 19) &   0x01)\n#define CMDBLK_ORB_PG_SIZE(v)\t\t(((v) >> 16) &   0x07)\n#define CMDBLK_ORB_DATA_SIZE(v)\t\t(((v) >>  0) & 0xffff)\n\n#define STATUS_BLOCK_SRC(v)\t\t(((v) &   0x03) << 30)\n#define STATUS_BLOCK_RESP(v)\t\t(((v) &   0x03) << 28)\n#define STATUS_BLOCK_DEAD(v)\t\t(((v) ? 1 : 0)  << 27)\n#define STATUS_BLOCK_LEN(v)\t\t(((v) &   0x07) << 24)\n#define STATUS_BLOCK_SBP_STATUS(v)\t(((v) &   0xff) << 16)\n#define STATUS_BLOCK_ORB_OFFSET_HIGH(v)\t(((v) & 0xffff) <<  0)\n\n#define STATUS_SRC_ORB_CONTINUING\t0\n#define STATUS_SRC_ORB_FINISHED\t\t1\n#define STATUS_SRC_UNSOLICITED\t\t2\n\n#define STATUS_RESP_REQUEST_COMPLETE\t0\n#define STATUS_RESP_TRANSPORT_FAILURE\t1\n#define STATUS_RESP_ILLEGAL_REQUEST\t2\n#define STATUS_RESP_VENDOR_DEPENDENT\t3\n\n#define SBP_STATUS_OK\t\t\t0\n#define SBP_STATUS_REQ_TYPE_NOTSUPP\t1\n#define SBP_STATUS_SPEED_NOTSUPP\t2\n#define SBP_STATUS_PAGE_SIZE_NOTSUPP\t3\n#define SBP_STATUS_ACCESS_DENIED\t4\n#define SBP_STATUS_LUN_NOTSUPP\t\t5\n#define SBP_STATUS_PAYLOAD_TOO_SMALL\t6\n \n#define SBP_STATUS_RESOURCES_UNAVAIL\t8\n#define SBP_STATUS_FUNCTION_REJECTED\t9\n#define SBP_STATUS_LOGIN_ID_UNKNOWN\t10\n#define SBP_STATUS_DUMMY_ORB_COMPLETE\t11\n#define SBP_STATUS_REQUEST_ABORTED\t12\n#define SBP_STATUS_UNSPECIFIED_ERROR\t0xff\n\n#define AGENT_STATE_RESET\t0\n#define AGENT_STATE_ACTIVE\t1\n#define AGENT_STATE_SUSPENDED\t2\n#define AGENT_STATE_DEAD\t3\n\nstruct sbp2_pointer {\n\t__be32 high;\n\t__be32 low;\n};\n\nstruct sbp_command_block_orb {\n\tstruct sbp2_pointer next_orb;\n\tstruct sbp2_pointer data_descriptor;\n\t__be32 misc;\n\tu8 command_block[12];\n};\n\nstruct sbp_page_table_entry {\n\t__be16 segment_length;\n\t__be16 segment_base_hi;\n\t__be32 segment_base_lo;\n};\n\nstruct sbp_management_orb {\n\tstruct sbp2_pointer ptr1;\n\tstruct sbp2_pointer ptr2;\n\t__be32 misc;\n\t__be32 length;\n\tstruct sbp2_pointer status_fifo;\n};\n\nstruct sbp_status_block {\n\t__be32 status;\n\t__be32 orb_low;\n\tu8 data[24];\n};\n\nstruct sbp_login_response_block {\n\t__be32 misc;\n\tstruct sbp2_pointer command_block_agent;\n\t__be32 reconnect_hold;\n};\n\nstruct sbp_login_descriptor {\n\tstruct sbp_session *sess;\n\tstruct list_head link;\n\n\tu32 login_lun;\n\n\tu64 status_fifo_addr;\n\tint exclusive;\n\tu16 login_id;\n\n\tstruct sbp_target_agent *tgt_agt;\n};\n\nstruct sbp_session {\n\tspinlock_t lock;\n\tstruct se_session *se_sess;\n\tstruct list_head login_list;\n\tstruct delayed_work maint_work;\n\n\tu64 guid;  \n\tint node_id;  \n\n\tstruct fw_card *card;\n\tint generation;\n\tint speed;\n\n\tint reconnect_hold;\n\tu64 reconnect_expires;\n};\n\nstruct sbp_tpg {\n\t \n\tu16 tport_tpgt;\n\t \n\tstruct sbp_tport *tport;\n\t \n\tstruct se_portal_group se_tpg;\n};\n\nstruct sbp_tport {\n\t \n\tu64 guid;\n\t \n\tchar tport_name[SBP_NAMELEN];\n\t \n\tstruct se_wwn tport_wwn;\n\n\tstruct sbp_tpg *tpg;\n\n\t \n\tstruct fw_descriptor unit_directory;\n\n\t \n\tstruct sbp_management_agent *mgt_agt;\n\n\t \n\tint enable;\n\ts32 directory_id;\n\tint mgt_orb_timeout;\n\tint max_reconnect_timeout;\n\tint max_logins_per_lun;\n};\n\nstatic inline u64 sbp2_pointer_to_addr(const struct sbp2_pointer *ptr)\n{\n\treturn (u64)(be32_to_cpu(ptr->high) & 0x0000ffff) << 32 |\n\t\t(be32_to_cpu(ptr->low) & 0xfffffffc);\n}\n\nstatic inline void addr_to_sbp2_pointer(u64 addr, struct sbp2_pointer *ptr)\n{\n\tptr->high = cpu_to_be32(addr >> 32);\n\tptr->low = cpu_to_be32(addr);\n}\n\nstruct sbp_target_agent {\n\tspinlock_t lock;\n\tstruct fw_address_handler handler;\n\tstruct sbp_login_descriptor *login;\n\tint state;\n\tstruct work_struct work;\n\tu64 orb_pointer;\n\tbool doorbell;\n};\n\nstruct sbp_target_request {\n\tstruct sbp_login_descriptor *login;\n\tu64 orb_pointer;\n\tstruct sbp_command_block_orb orb;\n\tstruct sbp_status_block status;\n\tstruct work_struct work;\n\n\tstruct se_cmd se_cmd;\n\tstruct sbp_page_table_entry *pg_tbl;\n\tvoid *cmd_buf;\n\n\tunsigned char sense_buf[TRANSPORT_SENSE_BUFFER];\n};\n\nstruct sbp_management_agent {\n\tspinlock_t lock;\n\tstruct sbp_tport *tport;\n\tstruct fw_address_handler handler;\n\tint state;\n\tstruct work_struct work;\n\tu64 orb_offset;\n\tstruct sbp_management_request *request;\n};\n\nstruct sbp_management_request {\n\tstruct sbp_management_orb orb;\n\tstruct sbp_status_block status;\n\tstruct fw_card *card;\n\tint generation;\n\tint node_addr;\n\tint speed;\n};\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}