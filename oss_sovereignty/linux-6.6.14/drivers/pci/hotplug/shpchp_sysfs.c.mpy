{
  "module_name": "shpchp_sysfs.c",
  "hash_id": "46380a1bf81cb9d22612ecd6a9bd2fff2b5c0312992adb4055d99761f13f0d2e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pci/hotplug/shpchp_sysfs.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/pci.h>\n#include \"shpchp.h\"\n\n\n \n\nstatic ssize_t show_ctrl(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\tstruct pci_dev *pdev;\n\tstruct resource *res;\n\tstruct pci_bus *bus;\n\tsize_t len = 0;\n\tint busnr;\n\n\tpdev = to_pci_dev(dev);\n\tbus = pdev->subordinate;\n\n\tlen += sysfs_emit_at(buf, len, \"Free resources: memory\\n\");\n\tpci_bus_for_each_resource(bus, res) {\n\t\tif (res && (res->flags & IORESOURCE_MEM) &&\n\t\t\t\t!(res->flags & IORESOURCE_PREFETCH)) {\n\t\t\tlen += sysfs_emit_at(buf, len,\n\t\t\t\t\t     \"start = %8.8llx, length = %8.8llx\\n\",\n\t\t\t\t\t     (unsigned long long)res->start,\n\t\t\t\t\t     (unsigned long long)resource_size(res));\n\t\t}\n\t}\n\tlen += sysfs_emit_at(buf, len, \"Free resources: prefetchable memory\\n\");\n\tpci_bus_for_each_resource(bus, res) {\n\t\tif (res && (res->flags & IORESOURCE_MEM) &&\n\t\t\t       (res->flags & IORESOURCE_PREFETCH)) {\n\t\t\tlen += sysfs_emit_at(buf, len,\n\t\t\t\t\t     \"start = %8.8llx, length = %8.8llx\\n\",\n\t\t\t\t\t     (unsigned long long)res->start,\n\t\t\t\t\t     (unsigned long long)resource_size(res));\n\t\t}\n\t}\n\tlen += sysfs_emit_at(buf, len, \"Free resources: IO\\n\");\n\tpci_bus_for_each_resource(bus, res) {\n\t\tif (res && (res->flags & IORESOURCE_IO)) {\n\t\t\tlen += sysfs_emit_at(buf, len,\n\t\t\t\t\t     \"start = %8.8llx, length = %8.8llx\\n\",\n\t\t\t\t\t     (unsigned long long)res->start,\n\t\t\t\t\t     (unsigned long long)resource_size(res));\n\t\t}\n\t}\n\tlen += sysfs_emit_at(buf, len, \"Free resources: bus numbers\\n\");\n\tfor (busnr = bus->busn_res.start; busnr <= bus->busn_res.end; busnr++) {\n\t\tif (!pci_find_bus(pci_domain_nr(bus), busnr))\n\t\t\tbreak;\n\t}\n\tif (busnr < bus->busn_res.end)\n\t\tlen += sysfs_emit_at(buf, len,\n\t\t\t\t     \"start = %8.8x, length = %8.8x\\n\",\n\t\t\t\t     busnr, (int)(bus->busn_res.end - busnr));\n\n\treturn len;\n}\nstatic DEVICE_ATTR(ctrl, S_IRUGO, show_ctrl, NULL);\n\nint shpchp_create_ctrl_files(struct controller *ctrl)\n{\n\treturn device_create_file(&ctrl->pci_dev->dev, &dev_attr_ctrl);\n}\n\nvoid shpchp_remove_ctrl_files(struct controller *ctrl)\n{\n\tdevice_remove_file(&ctrl->pci_dev->dev, &dev_attr_ctrl);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}