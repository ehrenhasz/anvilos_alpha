{
  "module_name": "rpadlpar_sysfs.c",
  "hash_id": "15c4dee78164bdc7b5f7ca45e0e17505a2cafdf4ad5e2701f9b9de91ed82edaf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pci/hotplug/rpadlpar_sysfs.c",
  "human_readable_source": "\n \n#include <linux/kobject.h>\n#include <linux/string.h>\n#include <linux/pci.h>\n#include <linux/pci_hotplug.h>\n#include \"rpaphp.h\"\n#include \"rpadlpar.h\"\n#include \"../pci.h\"\n\n#define DLPAR_KOBJ_NAME       \"control\"\n\n \n#define ADD_SLOT_ATTR_NAME    add_slot\n#define REMOVE_SLOT_ATTR_NAME remove_slot\n\nstatic ssize_t add_slot_store(struct kobject *kobj, struct kobj_attribute *attr,\n\t\t\t      const char *buf, size_t nbytes)\n{\n\tchar drc_name[MAX_DRC_NAME_LEN];\n\tchar *end;\n\tint rc;\n\n\tif (nbytes >= MAX_DRC_NAME_LEN)\n\t\treturn 0;\n\n\tstrscpy(drc_name, buf, nbytes + 1);\n\n\tend = strchr(drc_name, '\\n');\n\tif (end)\n\t\t*end = '\\0';\n\n\trc = dlpar_add_slot(drc_name);\n\tif (rc)\n\t\treturn rc;\n\n\treturn nbytes;\n}\n\nstatic ssize_t add_slot_show(struct kobject *kobj,\n\t\t\t     struct kobj_attribute *attr, char *buf)\n{\n\treturn sysfs_emit(buf, \"0\\n\");\n}\n\nstatic ssize_t remove_slot_store(struct kobject *kobj,\n\t\t\t\t struct kobj_attribute *attr,\n\t\t\t\t const char *buf, size_t nbytes)\n{\n\tchar drc_name[MAX_DRC_NAME_LEN];\n\tint rc;\n\tchar *end;\n\n\tif (nbytes >= MAX_DRC_NAME_LEN)\n\t\treturn 0;\n\n\tstrscpy(drc_name, buf, nbytes + 1);\n\n\tend = strchr(drc_name, '\\n');\n\tif (end)\n\t\t*end = '\\0';\n\n\trc = dlpar_remove_slot(drc_name);\n\tif (rc)\n\t\treturn rc;\n\n\treturn nbytes;\n}\n\nstatic ssize_t remove_slot_show(struct kobject *kobj,\n\t\t\t\tstruct kobj_attribute *attr, char *buf)\n{\n\treturn sysfs_emit(buf, \"0\\n\");\n}\n\nstatic struct kobj_attribute add_slot_attr =\n\t__ATTR(ADD_SLOT_ATTR_NAME, 0644, add_slot_show, add_slot_store);\n\nstatic struct kobj_attribute remove_slot_attr =\n\t__ATTR(REMOVE_SLOT_ATTR_NAME, 0644, remove_slot_show, remove_slot_store);\n\nstatic struct attribute *default_attrs[] = {\n\t&add_slot_attr.attr,\n\t&remove_slot_attr.attr,\n\tNULL,\n};\n\nstatic const struct attribute_group dlpar_attr_group = {\n\t.attrs = default_attrs,\n};\n\nstatic struct kobject *dlpar_kobj;\n\nint dlpar_sysfs_init(void)\n{\n\tint error;\n\n\tdlpar_kobj = kobject_create_and_add(DLPAR_KOBJ_NAME,\n\t\t\t\t\t    &pci_slots_kset->kobj);\n\tif (!dlpar_kobj)\n\t\treturn -EINVAL;\n\n\terror = sysfs_create_group(dlpar_kobj, &dlpar_attr_group);\n\tif (error)\n\t\tkobject_put(dlpar_kobj);\n\treturn error;\n}\n\nvoid dlpar_sysfs_exit(void)\n{\n\tsysfs_remove_group(dlpar_kobj, &dlpar_attr_group);\n\tkobject_put(dlpar_kobj);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}