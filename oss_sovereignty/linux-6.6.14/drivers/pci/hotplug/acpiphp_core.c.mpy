{
  "module_name": "acpiphp_core.c",
  "hash_id": "310d18e72cba9411c13bef12452db0d1091b7f6b2fd0c9e2eaddf0ab9f652baa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pci/hotplug/acpiphp_core.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"acpiphp: \" fmt\n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n\n#include <linux/kernel.h>\n#include <linux/pci.h>\n#include <linux/pci-acpi.h>\n#include <linux/pci_hotplug.h>\n#include <linux/slab.h>\n#include <linux/smp.h>\n#include \"acpiphp.h\"\n\n \n#define SLOT_NAME_SIZE  21               \n\nbool acpiphp_disabled;\n\n \nstatic struct acpiphp_attention_info *attention_info;\n\n#define DRIVER_VERSION\t\"0.5\"\n#define DRIVER_AUTHOR\t\"Greg Kroah-Hartman <gregkh@us.ibm.com>, Takayoshi Kochi <t-kochi@bq.jp.nec.com>, Matthew Wilcox <willy@infradead.org>\"\n#define DRIVER_DESC\t\"ACPI Hot Plug PCI Controller Driver\"\n\nMODULE_AUTHOR(DRIVER_AUTHOR);\nMODULE_DESCRIPTION(DRIVER_DESC);\nMODULE_PARM_DESC(disable, \"disable acpiphp driver\");\nmodule_param_named(disable, acpiphp_disabled, bool, 0444);\n\nstatic int enable_slot(struct hotplug_slot *slot);\nstatic int disable_slot(struct hotplug_slot *slot);\nstatic int set_attention_status(struct hotplug_slot *slot, u8 value);\nstatic int get_power_status(struct hotplug_slot *slot, u8 *value);\nstatic int get_attention_status(struct hotplug_slot *slot, u8 *value);\nstatic int get_latch_status(struct hotplug_slot *slot, u8 *value);\nstatic int get_adapter_status(struct hotplug_slot *slot, u8 *value);\n\nstatic const struct hotplug_slot_ops acpi_hotplug_slot_ops = {\n\t.enable_slot\t\t= enable_slot,\n\t.disable_slot\t\t= disable_slot,\n\t.set_attention_status\t= set_attention_status,\n\t.get_power_status\t= get_power_status,\n\t.get_attention_status\t= get_attention_status,\n\t.get_latch_status\t= get_latch_status,\n\t.get_adapter_status\t= get_adapter_status,\n};\n\n \nint acpiphp_register_attention(struct acpiphp_attention_info *info)\n{\n\tint retval = -EINVAL;\n\n\tif (info && info->owner && info->set_attn &&\n\t\t\tinfo->get_attn && !attention_info) {\n\t\tretval = 0;\n\t\tattention_info = info;\n\t}\n\treturn retval;\n}\nEXPORT_SYMBOL_GPL(acpiphp_register_attention);\n\n\n \nint acpiphp_unregister_attention(struct acpiphp_attention_info *info)\n{\n\tint retval = -EINVAL;\n\n\tif (info && attention_info == info) {\n\t\tattention_info = NULL;\n\t\tretval = 0;\n\t}\n\treturn retval;\n}\nEXPORT_SYMBOL_GPL(acpiphp_unregister_attention);\n\n\n \nstatic int enable_slot(struct hotplug_slot *hotplug_slot)\n{\n\tstruct slot *slot = to_slot(hotplug_slot);\n\n\tpr_debug(\"%s - physical_slot = %s\\n\", __func__, slot_name(slot));\n\n\t \n\treturn acpiphp_enable_slot(slot->acpi_slot);\n}\n\n\n \nstatic int disable_slot(struct hotplug_slot *hotplug_slot)\n{\n\tstruct slot *slot = to_slot(hotplug_slot);\n\n\tpr_debug(\"%s - physical_slot = %s\\n\", __func__, slot_name(slot));\n\n\t \n\treturn acpiphp_disable_slot(slot->acpi_slot);\n}\n\n\n \nstatic int set_attention_status(struct hotplug_slot *hotplug_slot, u8 status)\n{\n\tint retval = -ENODEV;\n\n\tpr_debug(\"%s - physical_slot = %s\\n\", __func__,\n\t\thotplug_slot_name(hotplug_slot));\n\n\tif (attention_info && try_module_get(attention_info->owner)) {\n\t\tretval = attention_info->set_attn(hotplug_slot, status);\n\t\tmodule_put(attention_info->owner);\n\t} else\n\t\tattention_info = NULL;\n\treturn retval;\n}\n\n\n \nstatic int get_power_status(struct hotplug_slot *hotplug_slot, u8 *value)\n{\n\tstruct slot *slot = to_slot(hotplug_slot);\n\n\tpr_debug(\"%s - physical_slot = %s\\n\", __func__, slot_name(slot));\n\n\t*value = acpiphp_get_power_status(slot->acpi_slot);\n\n\treturn 0;\n}\n\n\n \nstatic int get_attention_status(struct hotplug_slot *hotplug_slot, u8 *value)\n{\n\tint retval = -EINVAL;\n\n\tpr_debug(\"%s - physical_slot = %s\\n\", __func__,\n\t\thotplug_slot_name(hotplug_slot));\n\n\tif (attention_info && try_module_get(attention_info->owner)) {\n\t\tretval = attention_info->get_attn(hotplug_slot, value);\n\t\tmodule_put(attention_info->owner);\n\t} else\n\t\tattention_info = NULL;\n\treturn retval;\n}\n\n\n \nstatic int get_latch_status(struct hotplug_slot *hotplug_slot, u8 *value)\n{\n\tstruct slot *slot = to_slot(hotplug_slot);\n\n\tpr_debug(\"%s - physical_slot = %s\\n\", __func__, slot_name(slot));\n\n\t*value = acpiphp_get_latch_status(slot->acpi_slot);\n\n\treturn 0;\n}\n\n\n \nstatic int get_adapter_status(struct hotplug_slot *hotplug_slot, u8 *value)\n{\n\tstruct slot *slot = to_slot(hotplug_slot);\n\n\tpr_debug(\"%s - physical_slot = %s\\n\", __func__, slot_name(slot));\n\n\t*value = acpiphp_get_adapter_status(slot->acpi_slot);\n\n\treturn 0;\n}\n\n \nint acpiphp_register_hotplug_slot(struct acpiphp_slot *acpiphp_slot,\n\t\t\t\t  unsigned int sun)\n{\n\tstruct slot *slot;\n\tint retval = -ENOMEM;\n\tchar name[SLOT_NAME_SIZE];\n\n\tslot = kzalloc(sizeof(*slot), GFP_KERNEL);\n\tif (!slot)\n\t\tgoto error;\n\n\tslot->hotplug_slot.ops = &acpi_hotplug_slot_ops;\n\n\tslot->acpi_slot = acpiphp_slot;\n\n\tacpiphp_slot->slot = slot;\n\tslot->sun = sun;\n\tsnprintf(name, SLOT_NAME_SIZE, \"%u\", sun);\n\n\tretval = pci_hp_register(&slot->hotplug_slot, acpiphp_slot->bus,\n\t\t\t\t acpiphp_slot->device, name);\n\tif (retval == -EBUSY)\n\t\tgoto error_slot;\n\tif (retval) {\n\t\tpr_err(\"pci_hp_register failed with error %d\\n\", retval);\n\t\tgoto error_slot;\n\t}\n\n\tpr_info(\"Slot [%s] registered\\n\", slot_name(slot));\n\n\treturn 0;\nerror_slot:\n\tkfree(slot);\nerror:\n\treturn retval;\n}\n\n\nvoid acpiphp_unregister_hotplug_slot(struct acpiphp_slot *acpiphp_slot)\n{\n\tstruct slot *slot = acpiphp_slot->slot;\n\n\tpr_info(\"Slot [%s] unregistered\\n\", slot_name(slot));\n\n\tpci_hp_deregister(&slot->hotplug_slot);\n\tkfree(slot);\n}\n\n\nvoid __init acpiphp_init(void)\n{\n\tpr_info(DRIVER_DESC \" version: \" DRIVER_VERSION \"%s\\n\",\n\t\tacpiphp_disabled ? \", disabled by user; please report a bug\"\n\t\t\t\t : \"\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}