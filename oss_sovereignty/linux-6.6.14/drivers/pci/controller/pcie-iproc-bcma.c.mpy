{
  "module_name": "pcie-iproc-bcma.c",
  "hash_id": "584f8729470f45750965a90d2f884f959131c050de2eb159a37ee2ce3c1bfb61",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pci/controller/pcie-iproc-bcma.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/pci.h>\n#include <linux/module.h>\n#include <linux/slab.h>\n#include <linux/phy/phy.h>\n#include <linux/bcma/bcma.h>\n#include <linux/ioport.h>\n\n#include \"pcie-iproc.h\"\n\n\n \nstatic void bcma_pcie2_fixup_class(struct pci_dev *dev)\n{\n\tdev->class = PCI_CLASS_BRIDGE_PCI_NORMAL;\n}\nDECLARE_PCI_FIXUP_EARLY(PCI_VENDOR_ID_BROADCOM, 0x8011, bcma_pcie2_fixup_class);\nDECLARE_PCI_FIXUP_EARLY(PCI_VENDOR_ID_BROADCOM, 0x8012, bcma_pcie2_fixup_class);\n\nstatic int iproc_bcma_pcie_map_irq(const struct pci_dev *dev, u8 slot, u8 pin)\n{\n\tstruct iproc_pcie *pcie = dev->sysdata;\n\tstruct bcma_device *bdev = container_of(pcie->dev, struct bcma_device, dev);\n\n\treturn bcma_core_irq(bdev, 5);\n}\n\nstatic int iproc_bcma_pcie_probe(struct bcma_device *bdev)\n{\n\tstruct device *dev = &bdev->dev;\n\tstruct iproc_pcie *pcie;\n\tstruct pci_host_bridge *bridge;\n\tint ret;\n\n\tbridge = devm_pci_alloc_host_bridge(dev, sizeof(*pcie));\n\tif (!bridge)\n\t\treturn -ENOMEM;\n\n\tpcie = pci_host_bridge_priv(bridge);\n\n\tpcie->dev = dev;\n\n\tpcie->type = IPROC_PCIE_PAXB_BCMA;\n\tpcie->base = bdev->io_addr;\n\tif (!pcie->base) {\n\t\tdev_err(dev, \"no controller registers\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tpcie->base_addr = bdev->addr;\n\n\tpcie->mem.start = bdev->addr_s[0];\n\tpcie->mem.end = bdev->addr_s[0] + SZ_128M - 1;\n\tpcie->mem.name = \"PCIe MEM space\";\n\tpcie->mem.flags = IORESOURCE_MEM;\n\tpci_add_resource(&bridge->windows, &pcie->mem);\n\tret = devm_request_pci_bus_resources(dev, &bridge->windows);\n\tif (ret)\n\t\treturn ret;\n\n\tpcie->map_irq = iproc_bcma_pcie_map_irq;\n\n\tbcma_set_drvdata(bdev, pcie);\n\n\treturn iproc_pcie_setup(pcie, &bridge->windows);\n}\n\nstatic void iproc_bcma_pcie_remove(struct bcma_device *bdev)\n{\n\tstruct iproc_pcie *pcie = bcma_get_drvdata(bdev);\n\n\tiproc_pcie_remove(pcie);\n}\n\nstatic const struct bcma_device_id iproc_bcma_pcie_table[] = {\n\tBCMA_CORE(BCMA_MANUF_BCM, BCMA_CORE_NS_PCIEG2, BCMA_ANY_REV, BCMA_ANY_CLASS),\n\t{},\n};\nMODULE_DEVICE_TABLE(bcma, iproc_bcma_pcie_table);\n\nstatic struct bcma_driver iproc_bcma_pcie_driver = {\n\t.name\t\t= KBUILD_MODNAME,\n\t.id_table\t= iproc_bcma_pcie_table,\n\t.probe\t\t= iproc_bcma_pcie_probe,\n\t.remove\t\t= iproc_bcma_pcie_remove,\n};\nmodule_bcma_driver(iproc_bcma_pcie_driver);\n\nMODULE_AUTHOR(\"Hauke Mehrtens\");\nMODULE_DESCRIPTION(\"Broadcom iProc PCIe BCMA driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}