{
  "module_name": "pcie-mobiveil.h",
  "hash_id": "69c2777617c89e14958050ea476dcb4231fdb5e522f222e39b8b63df37a598be",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pci/controller/mobiveil/pcie-mobiveil.h",
  "human_readable_source": " \n \n\n#ifndef _PCIE_MOBIVEIL_H\n#define _PCIE_MOBIVEIL_H\n\n#include <linux/pci.h>\n#include <linux/irq.h>\n#include <linux/msi.h>\n#include \"../../pci.h\"\n\n \n\n \n#define PAB_REG_BLOCK_SIZE\t\t16\n#define PAB_EXT_REG_BLOCK_SIZE\t\t4\n\n#define PAB_REG_ADDR(offset, win)\t\\\n\t(offset + (win * PAB_REG_BLOCK_SIZE))\n#define PAB_EXT_REG_ADDR(offset, win)\t\\\n\t(offset + (win * PAB_EXT_REG_BLOCK_SIZE))\n\n#define LTSSM_STATUS\t\t\t0x0404\n#define  LTSSM_STATUS_L0_MASK\t\t0x3f\n#define  LTSSM_STATUS_L0\t\t0x2d\n\n#define PAB_CTRL\t\t\t0x0808\n#define  AMBA_PIO_ENABLE_SHIFT\t\t0\n#define  PEX_PIO_ENABLE_SHIFT\t\t1\n#define  PAGE_SEL_SHIFT\t\t\t13\n#define  PAGE_SEL_MASK\t\t\t0x3f\n#define  PAGE_LO_MASK\t\t\t0x3ff\n#define  PAGE_SEL_OFFSET_SHIFT\t\t10\n\n#define PAB_ACTIVITY_STAT\t\t0x81c\n\n#define PAB_AXI_PIO_CTRL\t\t0x0840\n#define  APIO_EN_MASK\t\t\t0xf\n\n#define PAB_PEX_PIO_CTRL\t\t0x08c0\n#define  PIO_ENABLE_SHIFT\t\t0\n\n#define PAB_INTP_AMBA_MISC_ENB\t\t0x0b0c\n#define PAB_INTP_AMBA_MISC_STAT\t\t0x0b1c\n#define  PAB_INTP_RESET\t\t\tBIT(1)\n#define  PAB_INTP_MSI\t\t\tBIT(3)\n#define  PAB_INTP_INTA\t\t\tBIT(5)\n#define  PAB_INTP_INTB\t\t\tBIT(6)\n#define  PAB_INTP_INTC\t\t\tBIT(7)\n#define  PAB_INTP_INTD\t\t\tBIT(8)\n#define  PAB_INTP_PCIE_UE\t\tBIT(9)\n#define  PAB_INTP_IE_PMREDI\t\tBIT(29)\n#define  PAB_INTP_IE_EC\t\t\tBIT(30)\n#define  PAB_INTP_MSI_MASK\t\tPAB_INTP_MSI\n#define  PAB_INTP_INTX_MASK\t\t(PAB_INTP_INTA | PAB_INTP_INTB |\\\n\t\t\t\t\tPAB_INTP_INTC | PAB_INTP_INTD)\n\n#define PAB_AXI_AMAP_CTRL(win)\t\tPAB_REG_ADDR(0x0ba0, win)\n#define  WIN_ENABLE_SHIFT\t\t0\n#define  WIN_TYPE_SHIFT\t\t\t1\n#define  WIN_TYPE_MASK\t\t\t0x3\n#define  WIN_SIZE_MASK\t\t\t0xfffffc00\n\n#define PAB_EXT_AXI_AMAP_SIZE(win)\tPAB_EXT_REG_ADDR(0xbaf0, win)\n\n#define PAB_EXT_AXI_AMAP_AXI_WIN(win)\tPAB_EXT_REG_ADDR(0x80a0, win)\n#define PAB_AXI_AMAP_AXI_WIN(win)\tPAB_REG_ADDR(0x0ba4, win)\n#define  AXI_WINDOW_ALIGN_MASK\t\t3\n\n#define PAB_AXI_AMAP_PEX_WIN_L(win)\tPAB_REG_ADDR(0x0ba8, win)\n#define  PAB_BUS_SHIFT\t\t\t24\n#define  PAB_DEVICE_SHIFT\t\t19\n#define  PAB_FUNCTION_SHIFT\t\t16\n\n#define PAB_AXI_AMAP_PEX_WIN_H(win)\tPAB_REG_ADDR(0x0bac, win)\n#define PAB_INTP_AXI_PIO_CLASS\t\t0x474\n\n#define PAB_PEX_AMAP_CTRL(win)\t\tPAB_REG_ADDR(0x4ba0, win)\n#define  AMAP_CTRL_EN_SHIFT\t\t0\n#define  AMAP_CTRL_TYPE_SHIFT\t\t1\n#define  AMAP_CTRL_TYPE_MASK\t\t3\n\n#define PAB_EXT_PEX_AMAP_SIZEN(win)\tPAB_EXT_REG_ADDR(0xbef0, win)\n#define PAB_EXT_PEX_AMAP_AXI_WIN(win)\tPAB_EXT_REG_ADDR(0xb4a0, win)\n#define PAB_PEX_AMAP_AXI_WIN(win)\tPAB_REG_ADDR(0x4ba4, win)\n#define PAB_PEX_AMAP_PEX_WIN_L(win)\tPAB_REG_ADDR(0x4ba8, win)\n#define PAB_PEX_AMAP_PEX_WIN_H(win)\tPAB_REG_ADDR(0x4bac, win)\n\n \n#define PAB_INTX_START\t\t\t5\n\n \n#define PCI_NUM_MSI\t\t\t16\n\n \n#define MSI_BASE_LO_OFFSET\t\t0x04\n#define MSI_BASE_HI_OFFSET\t\t0x08\n#define MSI_SIZE_OFFSET\t\t\t0x0c\n#define MSI_ENABLE_OFFSET\t\t0x14\n#define MSI_STATUS_OFFSET\t\t0x18\n#define MSI_DATA_OFFSET\t\t\t0x20\n#define MSI_ADDR_L_OFFSET\t\t0x24\n#define MSI_ADDR_H_OFFSET\t\t0x28\n\n \n#define WIN_NUM_0\t\t\t0\n#define WIN_NUM_1\t\t\t1\n#define CFG_WINDOW_TYPE\t\t\t0\n#define IO_WINDOW_TYPE\t\t\t1\n#define MEM_WINDOW_TYPE\t\t\t2\n#define IB_WIN_SIZE\t\t\t((u64)256 * 1024 * 1024 * 1024)\n#define MAX_PIO_WINDOWS\t\t\t8\n\n \n#define LINK_WAIT_MAX_RETRIES\t\t10\n#define LINK_WAIT_MIN\t\t\t90000\n#define LINK_WAIT_MAX\t\t\t100000\n\n#define PAGED_ADDR_BNDRY\t\t0xc00\n#define OFFSET_TO_PAGE_ADDR(off)\t\\\n\t((off & PAGE_LO_MASK) | PAGED_ADDR_BNDRY)\n#define OFFSET_TO_PAGE_IDX(off)\t\t\\\n\t((off >> PAGE_SEL_OFFSET_SHIFT) & PAGE_SEL_MASK)\n\nstruct mobiveil_msi {\t\t\t \n\tstruct mutex lock;\t\t \n\tstruct irq_domain *msi_domain;\n\tstruct irq_domain *dev_domain;\n\tphys_addr_t msi_pages_phys;\n\tint num_of_vectors;\n\tDECLARE_BITMAP(msi_irq_in_use, PCI_NUM_MSI);\n};\n\nstruct mobiveil_pcie;\n\nstruct mobiveil_rp_ops {\n\tint (*interrupt_init)(struct mobiveil_pcie *pcie);\n};\n\nstruct mobiveil_root_port {\n\tvoid __iomem *config_axi_slave_base;\t \n\tstruct resource *ob_io_res;\n\tstruct mobiveil_rp_ops *ops;\n\tint irq;\n\traw_spinlock_t intx_mask_lock;\n\tstruct irq_domain *intx_domain;\n\tstruct mobiveil_msi msi;\n\tstruct pci_host_bridge *bridge;\n};\n\nstruct mobiveil_pab_ops {\n\tint (*link_up)(struct mobiveil_pcie *pcie);\n};\n\nstruct mobiveil_pcie {\n\tstruct platform_device *pdev;\n\tvoid __iomem *csr_axi_slave_base;\t \n\tvoid __iomem *apb_csr_base;\t \n\tphys_addr_t pcie_reg_base;\t \n\tint apio_wins;\n\tint ppio_wins;\n\tint ob_wins_configured;\t\t \n\tint ib_wins_configured;\t\t \n\tconst struct mobiveil_pab_ops *ops;\n\tstruct mobiveil_root_port rp;\n};\n\nint mobiveil_pcie_host_probe(struct mobiveil_pcie *pcie);\nint mobiveil_host_init(struct mobiveil_pcie *pcie, bool reinit);\nbool mobiveil_pcie_link_up(struct mobiveil_pcie *pcie);\nint mobiveil_bringup_link(struct mobiveil_pcie *pcie);\nvoid program_ob_windows(struct mobiveil_pcie *pcie, int win_num, u64 cpu_addr,\n\t\t\tu64 pci_addr, u32 type, u64 size);\nvoid program_ib_windows(struct mobiveil_pcie *pcie, int win_num, u64 cpu_addr,\n\t\t\tu64 pci_addr, u32 type, u64 size);\nu32 mobiveil_csr_read(struct mobiveil_pcie *pcie, u32 off, size_t size);\nvoid mobiveil_csr_write(struct mobiveil_pcie *pcie, u32 val, u32 off,\n\t\t\tsize_t size);\n\nstatic inline u32 mobiveil_csr_readl(struct mobiveil_pcie *pcie, u32 off)\n{\n\treturn mobiveil_csr_read(pcie, off, 0x4);\n}\n\nstatic inline u16 mobiveil_csr_readw(struct mobiveil_pcie *pcie, u32 off)\n{\n\treturn mobiveil_csr_read(pcie, off, 0x2);\n}\n\nstatic inline u8 mobiveil_csr_readb(struct mobiveil_pcie *pcie, u32 off)\n{\n\treturn mobiveil_csr_read(pcie, off, 0x1);\n}\n\n\nstatic inline void mobiveil_csr_writel(struct mobiveil_pcie *pcie, u32 val,\n\t\t\t\t       u32 off)\n{\n\tmobiveil_csr_write(pcie, val, off, 0x4);\n}\n\nstatic inline void mobiveil_csr_writew(struct mobiveil_pcie *pcie, u16 val,\n\t\t\t\t       u32 off)\n{\n\tmobiveil_csr_write(pcie, val, off, 0x2);\n}\n\nstatic inline void mobiveil_csr_writeb(struct mobiveil_pcie *pcie, u8 val,\n\t\t\t\t       u32 off)\n{\n\tmobiveil_csr_write(pcie, val, off, 0x1);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}