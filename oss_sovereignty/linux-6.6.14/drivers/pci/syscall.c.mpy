{
  "module_name": "syscall.c",
  "hash_id": "abebddacedcaec34421149b2f6f739c8beb9c42095f6b83c902ec2a8195c4596",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pci/syscall.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/pci.h>\n#include <linux/security.h>\n#include <linux/syscalls.h>\n#include <linux/uaccess.h>\n#include \"pci.h\"\n\nSYSCALL_DEFINE5(pciconfig_read, unsigned long, bus, unsigned long, dfn,\n\t\tunsigned long, off, unsigned long, len, void __user *, buf)\n{\n\tstruct pci_dev *dev;\n\tu8 byte;\n\tu16 word;\n\tu32 dword;\n\tint err, cfg_ret;\n\n\terr = -EPERM;\n\tdev = NULL;\n\tif (!capable(CAP_SYS_ADMIN))\n\t\tgoto error;\n\n\terr = -ENODEV;\n\tdev = pci_get_domain_bus_and_slot(0, bus, dfn);\n\tif (!dev)\n\t\tgoto error;\n\n\tswitch (len) {\n\tcase 1:\n\t\tcfg_ret = pci_user_read_config_byte(dev, off, &byte);\n\t\tbreak;\n\tcase 2:\n\t\tcfg_ret = pci_user_read_config_word(dev, off, &word);\n\t\tbreak;\n\tcase 4:\n\t\tcfg_ret = pci_user_read_config_dword(dev, off, &dword);\n\t\tbreak;\n\tdefault:\n\t\terr = -EINVAL;\n\t\tgoto error;\n\t}\n\n\terr = -EIO;\n\tif (cfg_ret)\n\t\tgoto error;\n\n\tswitch (len) {\n\tcase 1:\n\t\terr = put_user(byte, (u8 __user *)buf);\n\t\tbreak;\n\tcase 2:\n\t\terr = put_user(word, (u16 __user *)buf);\n\t\tbreak;\n\tcase 4:\n\t\terr = put_user(dword, (u32 __user *)buf);\n\t\tbreak;\n\t}\n\tpci_dev_put(dev);\n\treturn err;\n\nerror:\n\t \n\tswitch (len) {\n\tcase 1:\n\t\tput_user(-1, (u8 __user *)buf);\n\t\tbreak;\n\tcase 2:\n\t\tput_user(-1, (u16 __user *)buf);\n\t\tbreak;\n\tcase 4:\n\t\tput_user(-1, (u32 __user *)buf);\n\t\tbreak;\n\t}\n\tpci_dev_put(dev);\n\treturn err;\n}\n\nSYSCALL_DEFINE5(pciconfig_write, unsigned long, bus, unsigned long, dfn,\n\t\tunsigned long, off, unsigned long, len, void __user *, buf)\n{\n\tstruct pci_dev *dev;\n\tu8 byte;\n\tu16 word;\n\tu32 dword;\n\tint err = 0;\n\n\tif (!capable(CAP_SYS_ADMIN) ||\n\t    security_locked_down(LOCKDOWN_PCI_ACCESS))\n\t\treturn -EPERM;\n\n\tdev = pci_get_domain_bus_and_slot(0, bus, dfn);\n\tif (!dev)\n\t\treturn -ENODEV;\n\n\tswitch (len) {\n\tcase 1:\n\t\terr = get_user(byte, (u8 __user *)buf);\n\t\tif (err)\n\t\t\tbreak;\n\t\terr = pci_user_write_config_byte(dev, off, byte);\n\t\tif (err)\n\t\t\terr = -EIO;\n\t\tbreak;\n\n\tcase 2:\n\t\terr = get_user(word, (u16 __user *)buf);\n\t\tif (err)\n\t\t\tbreak;\n\t\terr = pci_user_write_config_word(dev, off, word);\n\t\tif (err)\n\t\t\terr = -EIO;\n\t\tbreak;\n\n\tcase 4:\n\t\terr = get_user(dword, (u32 __user *)buf);\n\t\tif (err)\n\t\t\tbreak;\n\t\terr = pci_user_write_config_dword(dev, off, dword);\n\t\tif (err)\n\t\t\terr = -EIO;\n\t\tbreak;\n\n\tdefault:\n\t\terr = -EINVAL;\n\t\tbreak;\n\t}\n\tpci_dev_put(dev);\n\treturn err;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}