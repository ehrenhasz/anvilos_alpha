{
  "module_name": "nicstarmac.c",
  "hash_id": "bf33097377091f957958a93911568c99f0d02166ce97187875671fe7d1b9bc32",
  "original_prompt": "Ingested from linux-6.6.14/drivers/atm/nicstarmac.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/kernel.h>\n\ntypedef void __iomem *virt_addr_t;\n\n#define CYCLE_DELAY 5\n\n#define osp_MicroDelay(microsec) {unsigned long useconds = (microsec); \\\n                                  udelay((useconds));}\n \n\n \n \n\n#define CS_HIGH\t\t0x0002\t \n#define CS_LOW\t\t0x0000\t \n#define CLK_HIGH\t0x0004\t \n#define CLK_LOW\t\t0x0000\t \n#define SI_HIGH\t\t0x0001\t \n#define SI_LOW\t\t0x0000\t \n\n \n#if 0\nstatic u_int32_t rdsrtab[] = {\n\tCS_HIGH | CLK_HIGH,\n\tCS_LOW | CLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW | SI_HIGH,\n\tCLK_HIGH | SI_HIGH,\t \n\tCLK_LOW | SI_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW | SI_HIGH,\n\tCLK_HIGH | SI_HIGH\t \n};\n#endif  \n\n \nstatic u_int32_t readtab[] = {\n\t \n\tCS_LOW | CLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW,\n\tCLK_HIGH,\t\t \n\tCLK_LOW | SI_HIGH,\n\tCLK_HIGH | SI_HIGH,\t \n\tCLK_LOW | SI_HIGH,\n\tCLK_HIGH | SI_HIGH\t \n};\n\n \nstatic u_int32_t clocktab[] = {\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW,\n\tCLK_HIGH,\n\tCLK_LOW\n};\n\n#define NICSTAR_REG_WRITE(bs, reg, val) \\\n\twhile ( readl(bs + STAT) & 0x0200 ) ; \\\n\twritel((val),(base)+(reg))\n#define NICSTAR_REG_READ(bs, reg) \\\n\treadl((base)+(reg))\n#define NICSTAR_REG_GENERAL_PURPOSE GP\n\n \n#if 0\nu_int32_t nicstar_read_eprom_status(virt_addr_t base)\n{\n\tu_int32_t val;\n\tu_int32_t rbyte;\n\tint32_t i, j;\n\n\t \n\tval = NICSTAR_REG_READ(base, NICSTAR_REG_GENERAL_PURPOSE) & 0xFFFFFFF0;\n\n\tfor (i = 0; i < ARRAY_SIZE(rdsrtab); i++) {\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | rdsrtab[i]));\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t}\n\n\t \n\t \n\n\trbyte = 0;\n\tfor (i = 7, j = 0; i >= 0; i--) {\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | clocktab[j++]));\n\t\trbyte |= (((NICSTAR_REG_READ(base, NICSTAR_REG_GENERAL_PURPOSE)\n\t\t\t    & 0x00010000) >> 16) << i);\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | clocktab[j++]));\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t}\n\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE, 2);\n\tosp_MicroDelay(CYCLE_DELAY);\n\treturn rbyte;\n}\n#endif  \n\n \n\nstatic u_int8_t read_eprom_byte(virt_addr_t base, u_int8_t offset)\n{\n\tu_int32_t val = 0;\n\tint i, j = 0;\n\tu_int8_t tempread = 0;\n\n\tval = NICSTAR_REG_READ(base, NICSTAR_REG_GENERAL_PURPOSE) & 0xFFFFFFF0;\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(readtab); i++) {\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | readtab[i]));\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t}\n\n\t \n\tfor (i = 7; i >= 0; i--) {\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | clocktab[j++] | ((offset >> i) & 1)));\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | clocktab[j++] | ((offset >> i) & 1)));\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t}\n\n\tj = 0;\n\n\t \n\tfor (i = 7; i >= 0; i--) {\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | clocktab[j++]));\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t\ttempread |=\n\t\t    (((NICSTAR_REG_READ(base, NICSTAR_REG_GENERAL_PURPOSE)\n\t\t       & 0x00010000) >> 16) << i);\n\t\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t\t  (val | clocktab[j++]));\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t}\n\n\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE, 2);\n\tosp_MicroDelay(CYCLE_DELAY);\n\treturn tempread;\n}\n\nstatic void nicstar_init_eprom(virt_addr_t base)\n{\n\tu_int32_t val;\n\n\t \n\tval = NICSTAR_REG_READ(base, NICSTAR_REG_GENERAL_PURPOSE) & 0xFFFFFFF0;\n\n\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t  (val | CS_HIGH | CLK_HIGH));\n\tosp_MicroDelay(CYCLE_DELAY);\n\n\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t  (val | CS_HIGH | CLK_LOW));\n\tosp_MicroDelay(CYCLE_DELAY);\n\n\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t  (val | CS_HIGH | CLK_HIGH));\n\tosp_MicroDelay(CYCLE_DELAY);\n\n\tNICSTAR_REG_WRITE(base, NICSTAR_REG_GENERAL_PURPOSE,\n\t\t\t  (val | CS_HIGH | CLK_LOW));\n\tosp_MicroDelay(CYCLE_DELAY);\n}\n\n \n\nstatic void\nnicstar_read_eprom(virt_addr_t base,\n\t\t   u_int8_t prom_offset, u_int8_t * buffer, u_int32_t nbytes)\n{\n\tu_int i;\n\n\tfor (i = 0; i < nbytes; i++) {\n\t\tbuffer[i] = read_eprom_byte(base, prom_offset);\n\t\t++prom_offset;\n\t\tosp_MicroDelay(CYCLE_DELAY);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}