{
  "module_name": "pinctrl-meson8-pmx.c",
  "hash_id": "ef816a761ede616f82537c281e3fe09c06a41cb8f1ae67fc1a320c979cd890ed",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/meson/pinctrl-meson8-pmx.c",
  "human_readable_source": "\n \n\n \n#include <linux/device.h>\n#include <linux/regmap.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinmux.h>\n\n#include \"pinctrl-meson.h\"\n#include \"pinctrl-meson8-pmx.h\"\n\n \nstatic void meson8_pmx_disable_other_groups(struct meson_pinctrl *pc,\n\t\t\t\t\t    unsigned int pin, int sel_group)\n{\n\tstruct meson_pmx_group *group;\n\tstruct meson8_pmx_data *pmx_data;\n\tint i, j;\n\n\tfor (i = 0; i < pc->data->num_groups; i++) {\n\t\tgroup = &pc->data->groups[i];\n\t\tpmx_data = (struct meson8_pmx_data *)group->data;\n\t\tif (pmx_data->is_gpio || i == sel_group)\n\t\t\tcontinue;\n\n\t\tfor (j = 0; j < group->num_pins; j++) {\n\t\t\tif (group->pins[j] == pin) {\n\t\t\t\t \n\t\t\t\tregmap_update_bits(pc->reg_mux,\n\t\t\t\t\t\t   pmx_data->reg * 4,\n\t\t\t\t\t\t   BIT(pmx_data->bit), 0);\n\t\t\t}\n\t\t}\n\t}\n}\n\nstatic int meson8_pmx_set_mux(struct pinctrl_dev *pcdev, unsigned func_num,\n\t\t\t      unsigned group_num)\n{\n\tstruct meson_pinctrl *pc = pinctrl_dev_get_drvdata(pcdev);\n\tstruct meson_pmx_func *func = &pc->data->funcs[func_num];\n\tstruct meson_pmx_group *group = &pc->data->groups[group_num];\n\tstruct meson8_pmx_data *pmx_data =\n\t\t(struct meson8_pmx_data *)group->data;\n\tint i, ret = 0;\n\n\tdev_dbg(pc->dev, \"enable function %s, group %s\\n\", func->name,\n\t\tgroup->name);\n\n\t \n\tfor (i = 0; i < group->num_pins; i++)\n\t\tmeson8_pmx_disable_other_groups(pc, group->pins[i], group_num);\n\n\t \n\tif (func_num)\n\t\tret = regmap_update_bits(pc->reg_mux, pmx_data->reg * 4,\n\t\t\t\t\t BIT(pmx_data->bit),\n\t\t\t\t\t BIT(pmx_data->bit));\n\n\treturn ret;\n}\n\nstatic int meson8_pmx_request_gpio(struct pinctrl_dev *pcdev,\n\t\t\t\t   struct pinctrl_gpio_range *range,\n\t\t\t\t   unsigned offset)\n{\n\tstruct meson_pinctrl *pc = pinctrl_dev_get_drvdata(pcdev);\n\n\tmeson8_pmx_disable_other_groups(pc, offset, -1);\n\n\treturn 0;\n}\n\nconst struct pinmux_ops meson8_pmx_ops = {\n\t.set_mux = meson8_pmx_set_mux,\n\t.get_functions_count = meson_pmx_get_funcs_count,\n\t.get_function_name = meson_pmx_get_func_name,\n\t.get_function_groups = meson_pmx_get_groups,\n\t.gpio_request_enable = meson8_pmx_request_gpio,\n};\nEXPORT_SYMBOL_GPL(meson8_pmx_ops);\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}