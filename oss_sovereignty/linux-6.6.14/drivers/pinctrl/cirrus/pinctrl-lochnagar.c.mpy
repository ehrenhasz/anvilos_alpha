{
  "module_name": "pinctrl-lochnagar.c",
  "hash_id": "31e58c4143ddfa0b94953c372c86da4c61838ae5eca9cd657450d7de658d9841",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/cirrus/pinctrl-lochnagar.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/errno.h>\n#include <linux/gpio/driver.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\n#include <linux/pinctrl/consumer.h>\n#include <linux/pinctrl/pinconf-generic.h>\n#include <linux/pinctrl/pinconf.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinmux.h>\n\n#include <linux/mfd/lochnagar.h>\n#include <linux/mfd/lochnagar1_regs.h>\n#include <linux/mfd/lochnagar2_regs.h>\n\n#include <dt-bindings/pinctrl/lochnagar.h>\n\n#include \"../pinctrl-utils.h\"\n\n#define LN2_NUM_GPIO_CHANNELS\t16\n\n#define LN_CDC_AIF1_STR\t\t\"codec-aif1\"\n#define LN_CDC_AIF2_STR\t\t\"codec-aif2\"\n#define LN_CDC_AIF3_STR\t\t\"codec-aif3\"\n#define LN_DSP_AIF1_STR\t\t\"dsp-aif1\"\n#define LN_DSP_AIF2_STR\t\t\"dsp-aif2\"\n#define LN_PSIA1_STR\t\t\"psia1\"\n#define LN_PSIA2_STR\t\t\"psia2\"\n#define LN_GF_AIF1_STR\t\t\"gf-aif1\"\n#define LN_GF_AIF2_STR\t\t\"gf-aif2\"\n#define LN_GF_AIF3_STR\t\t\"gf-aif3\"\n#define LN_GF_AIF4_STR\t\t\"gf-aif4\"\n#define LN_SPDIF_AIF_STR\t\"spdif-aif\"\n#define LN_USB_AIF1_STR\t\t\"usb-aif1\"\n#define LN_USB_AIF2_STR\t\t\"usb-aif2\"\n#define LN_ADAT_AIF_STR\t\t\"adat-aif\"\n#define LN_SOUNDCARD_AIF_STR\t\"soundcard-aif\"\n\n#define LN_PIN_GPIO(REV, ID, NAME, REG, SHIFT, INVERT) \\\nstatic const struct lochnagar_pin lochnagar##REV##_##ID##_pin = { \\\n\t.name = NAME, .type = LN_PTYPE_GPIO, .reg = LOCHNAGAR##REV##_##REG, \\\n\t.shift = LOCHNAGAR##REV##_##SHIFT##_SHIFT, .invert = INVERT, \\\n}\n\n#define LN_PIN_SAIF(REV, ID, NAME) \\\nstatic const struct lochnagar_pin lochnagar##REV##_##ID##_pin = \\\n\t{ .name = NAME, .type = LN_PTYPE_AIF, }\n\n#define LN_PIN_AIF(REV, ID) \\\n\tLN_PIN_SAIF(REV, ID##_BCLK,  LN_##ID##_STR\"-bclk\"); \\\n\tLN_PIN_SAIF(REV, ID##_LRCLK, LN_##ID##_STR\"-lrclk\"); \\\n\tLN_PIN_SAIF(REV, ID##_RXDAT, LN_##ID##_STR\"-rxdat\"); \\\n\tLN_PIN_SAIF(REV, ID##_TXDAT, LN_##ID##_STR\"-txdat\")\n\n#define LN1_PIN_GPIO(ID, NAME, REG, SHIFT, INVERT) \\\n\tLN_PIN_GPIO(1, ID, NAME, REG, SHIFT, INVERT)\n\n#define LN1_PIN_MUX(ID, NAME) \\\nstatic const struct lochnagar_pin lochnagar1_##ID##_pin = \\\n\t{ .name = NAME, .type = LN_PTYPE_MUX, .reg = LOCHNAGAR1_##ID, }\n\n#define LN1_PIN_AIF(ID) LN_PIN_AIF(1, ID)\n\n#define LN2_PIN_GPIO(ID, NAME, REG, SHIFT, INVERT) \\\n\tLN_PIN_GPIO(2, ID, NAME, REG, SHIFT, INVERT)\n\n#define LN2_PIN_MUX(ID, NAME) \\\nstatic const struct lochnagar_pin lochnagar2_##ID##_pin = \\\n\t{ .name = NAME, .type = LN_PTYPE_MUX, .reg = LOCHNAGAR2_GPIO_##ID, }\n\n#define LN2_PIN_AIF(ID) LN_PIN_AIF(2, ID)\n\n#define LN2_PIN_GAI(ID) \\\n\tLN2_PIN_MUX(ID##_BCLK,  LN_##ID##_STR\"-bclk\"); \\\n\tLN2_PIN_MUX(ID##_LRCLK, LN_##ID##_STR\"-lrclk\"); \\\n\tLN2_PIN_MUX(ID##_RXDAT, LN_##ID##_STR\"-rxdat\"); \\\n\tLN2_PIN_MUX(ID##_TXDAT, LN_##ID##_STR\"-txdat\")\n\n#define LN_PIN(REV, ID) [LOCHNAGAR##REV##_PIN_##ID] = { \\\n\t.number = LOCHNAGAR##REV##_PIN_##ID, \\\n\t.name = lochnagar##REV##_##ID##_pin.name, \\\n\t.drv_data = (void *)&lochnagar##REV##_##ID##_pin, \\\n}\n\n#define LN1_PIN(ID) LN_PIN(1, ID)\n#define LN2_PIN(ID) LN_PIN(2, ID)\n\n#define LN_PINS(REV, ID) \\\n\tLN_PIN(REV, ID##_BCLK), LN_PIN(REV, ID##_LRCLK), \\\n\tLN_PIN(REV, ID##_RXDAT), LN_PIN(REV, ID##_TXDAT)\n\n#define LN1_PINS(ID) LN_PINS(1, ID)\n#define LN2_PINS(ID) LN_PINS(2, ID)\n\nenum {\n\tLOCHNAGAR1_PIN_GF_GPIO2 = LOCHNAGAR1_PIN_NUM_GPIOS,\n\tLOCHNAGAR1_PIN_GF_GPIO3,\n\tLOCHNAGAR1_PIN_GF_GPIO7,\n\tLOCHNAGAR1_PIN_LED1,\n\tLOCHNAGAR1_PIN_LED2,\n\tLOCHNAGAR1_PIN_CDC_AIF1_BCLK,\n\tLOCHNAGAR1_PIN_CDC_AIF1_LRCLK,\n\tLOCHNAGAR1_PIN_CDC_AIF1_RXDAT,\n\tLOCHNAGAR1_PIN_CDC_AIF1_TXDAT,\n\tLOCHNAGAR1_PIN_CDC_AIF2_BCLK,\n\tLOCHNAGAR1_PIN_CDC_AIF2_LRCLK,\n\tLOCHNAGAR1_PIN_CDC_AIF2_RXDAT,\n\tLOCHNAGAR1_PIN_CDC_AIF2_TXDAT,\n\tLOCHNAGAR1_PIN_CDC_AIF3_BCLK,\n\tLOCHNAGAR1_PIN_CDC_AIF3_LRCLK,\n\tLOCHNAGAR1_PIN_CDC_AIF3_RXDAT,\n\tLOCHNAGAR1_PIN_CDC_AIF3_TXDAT,\n\tLOCHNAGAR1_PIN_DSP_AIF1_BCLK,\n\tLOCHNAGAR1_PIN_DSP_AIF1_LRCLK,\n\tLOCHNAGAR1_PIN_DSP_AIF1_RXDAT,\n\tLOCHNAGAR1_PIN_DSP_AIF1_TXDAT,\n\tLOCHNAGAR1_PIN_DSP_AIF2_BCLK,\n\tLOCHNAGAR1_PIN_DSP_AIF2_LRCLK,\n\tLOCHNAGAR1_PIN_DSP_AIF2_RXDAT,\n\tLOCHNAGAR1_PIN_DSP_AIF2_TXDAT,\n\tLOCHNAGAR1_PIN_PSIA1_BCLK,\n\tLOCHNAGAR1_PIN_PSIA1_LRCLK,\n\tLOCHNAGAR1_PIN_PSIA1_RXDAT,\n\tLOCHNAGAR1_PIN_PSIA1_TXDAT,\n\tLOCHNAGAR1_PIN_PSIA2_BCLK,\n\tLOCHNAGAR1_PIN_PSIA2_LRCLK,\n\tLOCHNAGAR1_PIN_PSIA2_RXDAT,\n\tLOCHNAGAR1_PIN_PSIA2_TXDAT,\n\tLOCHNAGAR1_PIN_SPDIF_AIF_BCLK,\n\tLOCHNAGAR1_PIN_SPDIF_AIF_LRCLK,\n\tLOCHNAGAR1_PIN_SPDIF_AIF_RXDAT,\n\tLOCHNAGAR1_PIN_SPDIF_AIF_TXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF3_BCLK,\n\tLOCHNAGAR1_PIN_GF_AIF3_RXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF3_LRCLK,\n\tLOCHNAGAR1_PIN_GF_AIF3_TXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF4_BCLK,\n\tLOCHNAGAR1_PIN_GF_AIF4_RXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF4_LRCLK,\n\tLOCHNAGAR1_PIN_GF_AIF4_TXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF1_BCLK,\n\tLOCHNAGAR1_PIN_GF_AIF1_RXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF1_LRCLK,\n\tLOCHNAGAR1_PIN_GF_AIF1_TXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF2_BCLK,\n\tLOCHNAGAR1_PIN_GF_AIF2_RXDAT,\n\tLOCHNAGAR1_PIN_GF_AIF2_LRCLK,\n\tLOCHNAGAR1_PIN_GF_AIF2_TXDAT,\n\n\tLOCHNAGAR2_PIN_SPDIF_AIF_BCLK = LOCHNAGAR2_PIN_NUM_GPIOS,\n\tLOCHNAGAR2_PIN_SPDIF_AIF_LRCLK,\n\tLOCHNAGAR2_PIN_SPDIF_AIF_RXDAT,\n\tLOCHNAGAR2_PIN_SPDIF_AIF_TXDAT,\n\tLOCHNAGAR2_PIN_USB_AIF1_BCLK,\n\tLOCHNAGAR2_PIN_USB_AIF1_LRCLK,\n\tLOCHNAGAR2_PIN_USB_AIF1_RXDAT,\n\tLOCHNAGAR2_PIN_USB_AIF1_TXDAT,\n\tLOCHNAGAR2_PIN_USB_AIF2_BCLK,\n\tLOCHNAGAR2_PIN_USB_AIF2_LRCLK,\n\tLOCHNAGAR2_PIN_USB_AIF2_RXDAT,\n\tLOCHNAGAR2_PIN_USB_AIF2_TXDAT,\n\tLOCHNAGAR2_PIN_ADAT_AIF_BCLK,\n\tLOCHNAGAR2_PIN_ADAT_AIF_LRCLK,\n\tLOCHNAGAR2_PIN_ADAT_AIF_RXDAT,\n\tLOCHNAGAR2_PIN_ADAT_AIF_TXDAT,\n\tLOCHNAGAR2_PIN_SOUNDCARD_AIF_BCLK,\n\tLOCHNAGAR2_PIN_SOUNDCARD_AIF_LRCLK,\n\tLOCHNAGAR2_PIN_SOUNDCARD_AIF_RXDAT,\n\tLOCHNAGAR2_PIN_SOUNDCARD_AIF_TXDAT,\n};\n\nenum lochnagar_pin_type {\n\tLN_PTYPE_GPIO,\n\tLN_PTYPE_MUX,\n\tLN_PTYPE_AIF,\n\tLN_PTYPE_COUNT,\n};\n\nstruct lochnagar_pin {\n\tconst char name[20];\n\n\tenum lochnagar_pin_type type;\n\n\tunsigned int reg;\n\tint shift;\n\tbool invert;\n};\n\nLN1_PIN_GPIO(CDC_RESET,    \"codec-reset\",    RST,      CDC_RESET,    1);\nLN1_PIN_GPIO(DSP_RESET,    \"dsp-reset\",      RST,      DSP_RESET,    1);\nLN1_PIN_GPIO(CDC_CIF1MODE, \"codec-cif1mode\", I2C_CTRL, CDC_CIF_MODE, 0);\nLN1_PIN_MUX(GF_GPIO2,      \"gf-gpio2\");\nLN1_PIN_MUX(GF_GPIO3,      \"gf-gpio3\");\nLN1_PIN_MUX(GF_GPIO7,      \"gf-gpio7\");\nLN1_PIN_MUX(LED1,          \"led1\");\nLN1_PIN_MUX(LED2,          \"led2\");\nLN1_PIN_AIF(CDC_AIF1);\nLN1_PIN_AIF(CDC_AIF2);\nLN1_PIN_AIF(CDC_AIF3);\nLN1_PIN_AIF(DSP_AIF1);\nLN1_PIN_AIF(DSP_AIF2);\nLN1_PIN_AIF(PSIA1);\nLN1_PIN_AIF(PSIA2);\nLN1_PIN_AIF(SPDIF_AIF);\nLN1_PIN_AIF(GF_AIF1);\nLN1_PIN_AIF(GF_AIF2);\nLN1_PIN_AIF(GF_AIF3);\nLN1_PIN_AIF(GF_AIF4);\n\nLN2_PIN_GPIO(CDC_RESET,    \"codec-reset\",    MINICARD_RESETS, CDC_RESET,     1);\nLN2_PIN_GPIO(DSP_RESET,    \"dsp-reset\",      MINICARD_RESETS, DSP_RESET,     1);\nLN2_PIN_GPIO(CDC_CIF1MODE, \"codec-cif1mode\", COMMS_CTRL4,     CDC_CIF1MODE,  0);\nLN2_PIN_GPIO(CDC_LDOENA,   \"codec-ldoena\",   POWER_CTRL,      PWR_ENA,       0);\nLN2_PIN_GPIO(SPDIF_HWMODE, \"spdif-hwmode\",   SPDIF_CTRL,      SPDIF_HWMODE,  0);\nLN2_PIN_GPIO(SPDIF_RESET,  \"spdif-reset\",    SPDIF_CTRL,      SPDIF_RESET,   1);\nLN2_PIN_MUX(FPGA_GPIO1,    \"fpga-gpio1\");\nLN2_PIN_MUX(FPGA_GPIO2,    \"fpga-gpio2\");\nLN2_PIN_MUX(FPGA_GPIO3,    \"fpga-gpio3\");\nLN2_PIN_MUX(FPGA_GPIO4,    \"fpga-gpio4\");\nLN2_PIN_MUX(FPGA_GPIO5,    \"fpga-gpio5\");\nLN2_PIN_MUX(FPGA_GPIO6,    \"fpga-gpio6\");\nLN2_PIN_MUX(CDC_GPIO1,     \"codec-gpio1\");\nLN2_PIN_MUX(CDC_GPIO2,     \"codec-gpio2\");\nLN2_PIN_MUX(CDC_GPIO3,     \"codec-gpio3\");\nLN2_PIN_MUX(CDC_GPIO4,     \"codec-gpio4\");\nLN2_PIN_MUX(CDC_GPIO5,     \"codec-gpio5\");\nLN2_PIN_MUX(CDC_GPIO6,     \"codec-gpio6\");\nLN2_PIN_MUX(CDC_GPIO7,     \"codec-gpio7\");\nLN2_PIN_MUX(CDC_GPIO8,     \"codec-gpio8\");\nLN2_PIN_MUX(DSP_GPIO1,     \"dsp-gpio1\");\nLN2_PIN_MUX(DSP_GPIO2,     \"dsp-gpio2\");\nLN2_PIN_MUX(DSP_GPIO3,     \"dsp-gpio3\");\nLN2_PIN_MUX(DSP_GPIO4,     \"dsp-gpio4\");\nLN2_PIN_MUX(DSP_GPIO5,     \"dsp-gpio5\");\nLN2_PIN_MUX(DSP_GPIO6,     \"dsp-gpio6\");\nLN2_PIN_MUX(GF_GPIO2,      \"gf-gpio2\");\nLN2_PIN_MUX(GF_GPIO3,      \"gf-gpio3\");\nLN2_PIN_MUX(GF_GPIO7,      \"gf-gpio7\");\nLN2_PIN_MUX(DSP_UART1_RX,  \"dsp-uart1-rx\");\nLN2_PIN_MUX(DSP_UART1_TX,  \"dsp-uart1-tx\");\nLN2_PIN_MUX(DSP_UART2_RX,  \"dsp-uart2-rx\");\nLN2_PIN_MUX(DSP_UART2_TX,  \"dsp-uart2-tx\");\nLN2_PIN_MUX(GF_UART2_RX,   \"gf-uart2-rx\");\nLN2_PIN_MUX(GF_UART2_TX,   \"gf-uart2-tx\");\nLN2_PIN_MUX(USB_UART_RX,   \"usb-uart-rx\");\nLN2_PIN_MUX(CDC_PDMCLK1,   \"codec-pdmclk1\");\nLN2_PIN_MUX(CDC_PDMDAT1,   \"codec-pdmdat1\");\nLN2_PIN_MUX(CDC_PDMCLK2,   \"codec-pdmclk2\");\nLN2_PIN_MUX(CDC_PDMDAT2,   \"codec-pdmdat2\");\nLN2_PIN_MUX(CDC_DMICCLK1,  \"codec-dmicclk1\");\nLN2_PIN_MUX(CDC_DMICDAT1,  \"codec-dmicdat1\");\nLN2_PIN_MUX(CDC_DMICCLK2,  \"codec-dmicclk2\");\nLN2_PIN_MUX(CDC_DMICDAT2,  \"codec-dmicdat2\");\nLN2_PIN_MUX(CDC_DMICCLK3,  \"codec-dmicclk3\");\nLN2_PIN_MUX(CDC_DMICDAT3,  \"codec-dmicdat3\");\nLN2_PIN_MUX(CDC_DMICCLK4,  \"codec-dmicclk4\");\nLN2_PIN_MUX(CDC_DMICDAT4,  \"codec-dmicdat4\");\nLN2_PIN_MUX(DSP_DMICCLK1,  \"dsp-dmicclk1\");\nLN2_PIN_MUX(DSP_DMICDAT1,  \"dsp-dmicdat1\");\nLN2_PIN_MUX(DSP_DMICCLK2,  \"dsp-dmicclk2\");\nLN2_PIN_MUX(DSP_DMICDAT2,  \"dsp-dmicdat2\");\nLN2_PIN_MUX(I2C2_SCL,      \"i2c2-scl\");\nLN2_PIN_MUX(I2C2_SDA,      \"i2c2-sda\");\nLN2_PIN_MUX(I2C3_SCL,      \"i2c3-scl\");\nLN2_PIN_MUX(I2C3_SDA,      \"i2c3-sda\");\nLN2_PIN_MUX(I2C4_SCL,      \"i2c4-scl\");\nLN2_PIN_MUX(I2C4_SDA,      \"i2c4-sda\");\nLN2_PIN_MUX(DSP_STANDBY,   \"dsp-standby\");\nLN2_PIN_MUX(CDC_MCLK1,     \"codec-mclk1\");\nLN2_PIN_MUX(CDC_MCLK2,     \"codec-mclk2\");\nLN2_PIN_MUX(DSP_CLKIN,     \"dsp-clkin\");\nLN2_PIN_MUX(PSIA1_MCLK,    \"psia1-mclk\");\nLN2_PIN_MUX(PSIA2_MCLK,    \"psia2-mclk\");\nLN2_PIN_MUX(GF_GPIO1,      \"gf-gpio1\");\nLN2_PIN_MUX(GF_GPIO5,      \"gf-gpio5\");\nLN2_PIN_MUX(DSP_GPIO20,    \"dsp-gpio20\");\nLN2_PIN_GAI(CDC_AIF1);\nLN2_PIN_GAI(CDC_AIF2);\nLN2_PIN_GAI(CDC_AIF3);\nLN2_PIN_GAI(DSP_AIF1);\nLN2_PIN_GAI(DSP_AIF2);\nLN2_PIN_GAI(PSIA1);\nLN2_PIN_GAI(PSIA2);\nLN2_PIN_GAI(GF_AIF1);\nLN2_PIN_GAI(GF_AIF2);\nLN2_PIN_GAI(GF_AIF3);\nLN2_PIN_GAI(GF_AIF4);\nLN2_PIN_AIF(SPDIF_AIF);\nLN2_PIN_AIF(USB_AIF1);\nLN2_PIN_AIF(USB_AIF2);\nLN2_PIN_AIF(ADAT_AIF);\nLN2_PIN_AIF(SOUNDCARD_AIF);\n\nstatic const struct pinctrl_pin_desc lochnagar1_pins[] = {\n\tLN1_PIN(CDC_RESET),      LN1_PIN(DSP_RESET),    LN1_PIN(CDC_CIF1MODE),\n\tLN1_PIN(GF_GPIO2),       LN1_PIN(GF_GPIO3),     LN1_PIN(GF_GPIO7),\n\tLN1_PIN(LED1),           LN1_PIN(LED2),\n\tLN1_PINS(CDC_AIF1),      LN1_PINS(CDC_AIF2),    LN1_PINS(CDC_AIF3),\n\tLN1_PINS(DSP_AIF1),      LN1_PINS(DSP_AIF2),\n\tLN1_PINS(PSIA1),         LN1_PINS(PSIA2),\n\tLN1_PINS(SPDIF_AIF),\n\tLN1_PINS(GF_AIF1),       LN1_PINS(GF_AIF2),\n\tLN1_PINS(GF_AIF3),       LN1_PINS(GF_AIF4),\n};\n\nstatic const struct pinctrl_pin_desc lochnagar2_pins[] = {\n\tLN2_PIN(CDC_RESET),      LN2_PIN(DSP_RESET),    LN2_PIN(CDC_CIF1MODE),\n\tLN2_PIN(CDC_LDOENA),\n\tLN2_PIN(SPDIF_HWMODE),   LN2_PIN(SPDIF_RESET),\n\tLN2_PIN(FPGA_GPIO1),     LN2_PIN(FPGA_GPIO2),   LN2_PIN(FPGA_GPIO3),\n\tLN2_PIN(FPGA_GPIO4),     LN2_PIN(FPGA_GPIO5),   LN2_PIN(FPGA_GPIO6),\n\tLN2_PIN(CDC_GPIO1),      LN2_PIN(CDC_GPIO2),    LN2_PIN(CDC_GPIO3),\n\tLN2_PIN(CDC_GPIO4),      LN2_PIN(CDC_GPIO5),    LN2_PIN(CDC_GPIO6),\n\tLN2_PIN(CDC_GPIO7),      LN2_PIN(CDC_GPIO8),\n\tLN2_PIN(DSP_GPIO1),      LN2_PIN(DSP_GPIO2),    LN2_PIN(DSP_GPIO3),\n\tLN2_PIN(DSP_GPIO4),      LN2_PIN(DSP_GPIO5),    LN2_PIN(DSP_GPIO6),\n\tLN2_PIN(DSP_GPIO20),\n\tLN2_PIN(GF_GPIO1),       LN2_PIN(GF_GPIO2),     LN2_PIN(GF_GPIO3),\n\tLN2_PIN(GF_GPIO5),       LN2_PIN(GF_GPIO7),\n\tLN2_PINS(CDC_AIF1),      LN2_PINS(CDC_AIF2),    LN2_PINS(CDC_AIF3),\n\tLN2_PINS(DSP_AIF1),      LN2_PINS(DSP_AIF2),\n\tLN2_PINS(PSIA1),         LN2_PINS(PSIA2),\n\tLN2_PINS(GF_AIF1),       LN2_PINS(GF_AIF2),\n\tLN2_PINS(GF_AIF3),       LN2_PINS(GF_AIF4),\n\tLN2_PIN(DSP_UART1_RX),   LN2_PIN(DSP_UART1_TX),\n\tLN2_PIN(DSP_UART2_RX),   LN2_PIN(DSP_UART2_TX),\n\tLN2_PIN(GF_UART2_RX),    LN2_PIN(GF_UART2_TX),\n\tLN2_PIN(USB_UART_RX),\n\tLN2_PIN(CDC_PDMCLK1),    LN2_PIN(CDC_PDMDAT1),\n\tLN2_PIN(CDC_PDMCLK2),    LN2_PIN(CDC_PDMDAT2),\n\tLN2_PIN(CDC_DMICCLK1),   LN2_PIN(CDC_DMICDAT1),\n\tLN2_PIN(CDC_DMICCLK2),   LN2_PIN(CDC_DMICDAT2),\n\tLN2_PIN(CDC_DMICCLK3),   LN2_PIN(CDC_DMICDAT3),\n\tLN2_PIN(CDC_DMICCLK4),   LN2_PIN(CDC_DMICDAT4),\n\tLN2_PIN(DSP_DMICCLK1),   LN2_PIN(DSP_DMICDAT1),\n\tLN2_PIN(DSP_DMICCLK2),   LN2_PIN(DSP_DMICDAT2),\n\tLN2_PIN(I2C2_SCL),       LN2_PIN(I2C2_SDA),\n\tLN2_PIN(I2C3_SCL),       LN2_PIN(I2C3_SDA),\n\tLN2_PIN(I2C4_SCL),       LN2_PIN(I2C4_SDA),\n\tLN2_PIN(DSP_STANDBY),\n\tLN2_PIN(CDC_MCLK1),      LN2_PIN(CDC_MCLK2),\n\tLN2_PIN(DSP_CLKIN),\n\tLN2_PIN(PSIA1_MCLK),     LN2_PIN(PSIA2_MCLK),\n\tLN2_PINS(SPDIF_AIF),\n\tLN2_PINS(USB_AIF1),      LN2_PINS(USB_AIF2),\n\tLN2_PINS(ADAT_AIF),\n\tLN2_PINS(SOUNDCARD_AIF),\n};\n\n#define LN_AIF_PINS(REV, ID) \\\n\tLOCHNAGAR##REV##_PIN_##ID##_BCLK, \\\n\tLOCHNAGAR##REV##_PIN_##ID##_LRCLK, \\\n\tLOCHNAGAR##REV##_PIN_##ID##_TXDAT, \\\n\tLOCHNAGAR##REV##_PIN_##ID##_RXDAT,\n\n#define LN1_AIF(ID, CTRL) \\\nstatic const struct lochnagar_aif lochnagar1_##ID##_aif = { \\\n\t.name = LN_##ID##_STR, \\\n\t.pins = { LN_AIF_PINS(1, ID) }, \\\n\t.src_reg = LOCHNAGAR1_##ID##_SEL, \\\n\t.src_mask = LOCHNAGAR1_SRC_MASK, \\\n\t.ctrl_reg = LOCHNAGAR1_##CTRL, \\\n\t.ena_mask = LOCHNAGAR1_##ID##_ENA_MASK, \\\n\t.master_mask = LOCHNAGAR1_##ID##_LRCLK_DIR_MASK | \\\n\t\t       LOCHNAGAR1_##ID##_BCLK_DIR_MASK, \\\n}\n\n#define LN2_AIF(ID) \\\nstatic const struct lochnagar_aif lochnagar2_##ID##_aif = { \\\n\t.name = LN_##ID##_STR, \\\n\t.pins = { LN_AIF_PINS(2, ID) }, \\\n\t.src_reg = LOCHNAGAR2_##ID##_CTRL,  \\\n\t.src_mask = LOCHNAGAR2_AIF_SRC_MASK, \\\n\t.ctrl_reg = LOCHNAGAR2_##ID##_CTRL, \\\n\t.ena_mask = LOCHNAGAR2_AIF_ENA_MASK, \\\n\t.master_mask = LOCHNAGAR2_AIF_LRCLK_DIR_MASK | \\\n\t\t       LOCHNAGAR2_AIF_BCLK_DIR_MASK, \\\n}\n\nstruct lochnagar_aif {\n\tconst char name[16];\n\n\tunsigned int pins[4];\n\n\tu16 src_reg;\n\tu16 src_mask;\n\n\tu16 ctrl_reg;\n\tu16 ena_mask;\n\tu16 master_mask;\n};\n\nLN1_AIF(CDC_AIF1,      CDC_AIF_CTRL1);\nLN1_AIF(CDC_AIF2,      CDC_AIF_CTRL1);\nLN1_AIF(CDC_AIF3,      CDC_AIF_CTRL2);\nLN1_AIF(DSP_AIF1,      DSP_AIF);\nLN1_AIF(DSP_AIF2,      DSP_AIF);\nLN1_AIF(PSIA1,         PSIA_AIF);\nLN1_AIF(PSIA2,         PSIA_AIF);\nLN1_AIF(GF_AIF1,       GF_AIF1);\nLN1_AIF(GF_AIF2,       GF_AIF2);\nLN1_AIF(GF_AIF3,       GF_AIF1);\nLN1_AIF(GF_AIF4,       GF_AIF2);\nLN1_AIF(SPDIF_AIF,     EXT_AIF_CTRL);\n\nLN2_AIF(CDC_AIF1);\nLN2_AIF(CDC_AIF2);\nLN2_AIF(CDC_AIF3);\nLN2_AIF(DSP_AIF1);\nLN2_AIF(DSP_AIF2);\nLN2_AIF(PSIA1);\nLN2_AIF(PSIA2);\nLN2_AIF(GF_AIF1);\nLN2_AIF(GF_AIF2);\nLN2_AIF(GF_AIF3);\nLN2_AIF(GF_AIF4);\nLN2_AIF(SPDIF_AIF);\nLN2_AIF(USB_AIF1);\nLN2_AIF(USB_AIF2);\nLN2_AIF(ADAT_AIF);\nLN2_AIF(SOUNDCARD_AIF);\n\n#define LN2_OP_AIF\t0x00\n#define LN2_OP_GPIO\t0xFE\n\n#define LN_FUNC(NAME, TYPE, OP) \\\n\t{ .name = NAME, .type = LN_FTYPE_##TYPE, .op = OP }\n\n#define LN_FUNC_PIN(REV, ID, OP) \\\n\tLN_FUNC(lochnagar##REV##_##ID##_pin.name, PIN, OP)\n\n#define LN1_FUNC_PIN(ID, OP) LN_FUNC_PIN(1, ID, OP)\n#define LN2_FUNC_PIN(ID, OP) LN_FUNC_PIN(2, ID, OP)\n\n#define LN_FUNC_AIF(REV, ID, OP) \\\n\tLN_FUNC(lochnagar##REV##_##ID##_aif.name, AIF, OP)\n\n#define LN1_FUNC_AIF(ID, OP) LN_FUNC_AIF(1, ID, OP)\n#define LN2_FUNC_AIF(ID, OP) LN_FUNC_AIF(2, ID, OP)\n\n#define LN2_FUNC_GAI(ID, OP, BOP, LROP, RXOP, TXOP) \\\n\tLN2_FUNC_AIF(ID, OP), \\\n\tLN_FUNC(lochnagar2_##ID##_BCLK_pin.name, PIN, BOP), \\\n\tLN_FUNC(lochnagar2_##ID##_LRCLK_pin.name, PIN, LROP), \\\n\tLN_FUNC(lochnagar2_##ID##_RXDAT_pin.name, PIN, RXOP), \\\n\tLN_FUNC(lochnagar2_##ID##_TXDAT_pin.name, PIN, TXOP)\n\nenum lochnagar_func_type {\n\tLN_FTYPE_PIN,\n\tLN_FTYPE_AIF,\n\tLN_FTYPE_COUNT,\n};\n\nstruct lochnagar_func {\n\tconst char * const name;\n\n\tenum lochnagar_func_type type;\n\n\tu8 op;\n};\n\nstatic const struct lochnagar_func lochnagar1_funcs[] = {\n\tLN_FUNC(\"dsp-gpio1\",       PIN, 0x01),\n\tLN_FUNC(\"dsp-gpio2\",       PIN, 0x02),\n\tLN_FUNC(\"dsp-gpio3\",       PIN, 0x03),\n\tLN_FUNC(\"codec-gpio1\",     PIN, 0x04),\n\tLN_FUNC(\"codec-gpio2\",     PIN, 0x05),\n\tLN_FUNC(\"codec-gpio3\",     PIN, 0x06),\n\tLN_FUNC(\"codec-gpio4\",     PIN, 0x07),\n\tLN_FUNC(\"codec-gpio5\",     PIN, 0x08),\n\tLN_FUNC(\"codec-gpio6\",     PIN, 0x09),\n\tLN_FUNC(\"codec-gpio7\",     PIN, 0x0A),\n\tLN_FUNC(\"codec-gpio8\",     PIN, 0x0B),\n\tLN1_FUNC_PIN(GF_GPIO2,          0x0C),\n\tLN1_FUNC_PIN(GF_GPIO3,          0x0D),\n\tLN1_FUNC_PIN(GF_GPIO7,          0x0E),\n\n\tLN1_FUNC_AIF(SPDIF_AIF,         0x01),\n\tLN1_FUNC_AIF(PSIA1,             0x02),\n\tLN1_FUNC_AIF(PSIA2,             0x03),\n\tLN1_FUNC_AIF(CDC_AIF1,          0x04),\n\tLN1_FUNC_AIF(CDC_AIF2,          0x05),\n\tLN1_FUNC_AIF(CDC_AIF3,          0x06),\n\tLN1_FUNC_AIF(DSP_AIF1,          0x07),\n\tLN1_FUNC_AIF(DSP_AIF2,          0x08),\n\tLN1_FUNC_AIF(GF_AIF3,           0x09),\n\tLN1_FUNC_AIF(GF_AIF4,           0x0A),\n\tLN1_FUNC_AIF(GF_AIF1,           0x0B),\n\tLN1_FUNC_AIF(GF_AIF2,           0x0C),\n};\n\nstatic const struct lochnagar_func lochnagar2_funcs[] = {\n\tLN_FUNC(\"aif\",             PIN, LN2_OP_AIF),\n\tLN2_FUNC_PIN(FPGA_GPIO1,        0x01),\n\tLN2_FUNC_PIN(FPGA_GPIO2,        0x02),\n\tLN2_FUNC_PIN(FPGA_GPIO3,        0x03),\n\tLN2_FUNC_PIN(FPGA_GPIO4,        0x04),\n\tLN2_FUNC_PIN(FPGA_GPIO5,        0x05),\n\tLN2_FUNC_PIN(FPGA_GPIO6,        0x06),\n\tLN2_FUNC_PIN(CDC_GPIO1,         0x07),\n\tLN2_FUNC_PIN(CDC_GPIO2,         0x08),\n\tLN2_FUNC_PIN(CDC_GPIO3,         0x09),\n\tLN2_FUNC_PIN(CDC_GPIO4,         0x0A),\n\tLN2_FUNC_PIN(CDC_GPIO5,         0x0B),\n\tLN2_FUNC_PIN(CDC_GPIO6,         0x0C),\n\tLN2_FUNC_PIN(CDC_GPIO7,         0x0D),\n\tLN2_FUNC_PIN(CDC_GPIO8,         0x0E),\n\tLN2_FUNC_PIN(DSP_GPIO1,         0x0F),\n\tLN2_FUNC_PIN(DSP_GPIO2,         0x10),\n\tLN2_FUNC_PIN(DSP_GPIO3,         0x11),\n\tLN2_FUNC_PIN(DSP_GPIO4,         0x12),\n\tLN2_FUNC_PIN(DSP_GPIO5,         0x13),\n\tLN2_FUNC_PIN(DSP_GPIO6,         0x14),\n\tLN2_FUNC_PIN(GF_GPIO2,          0x15),\n\tLN2_FUNC_PIN(GF_GPIO3,          0x16),\n\tLN2_FUNC_PIN(GF_GPIO7,          0x17),\n\tLN2_FUNC_PIN(GF_GPIO1,          0x18),\n\tLN2_FUNC_PIN(GF_GPIO5,          0x19),\n\tLN2_FUNC_PIN(DSP_GPIO20,        0x1A),\n\tLN_FUNC(\"codec-clkout\",    PIN, 0x20),\n\tLN_FUNC(\"dsp-clkout\",      PIN, 0x21),\n\tLN_FUNC(\"pmic-32k\",        PIN, 0x22),\n\tLN_FUNC(\"spdif-clkout\",    PIN, 0x23),\n\tLN_FUNC(\"clk-12m288\",      PIN, 0x24),\n\tLN_FUNC(\"clk-11m2986\",     PIN, 0x25),\n\tLN_FUNC(\"clk-24m576\",      PIN, 0x26),\n\tLN_FUNC(\"clk-22m5792\",     PIN, 0x27),\n\tLN_FUNC(\"xmos-mclk\",       PIN, 0x29),\n\tLN_FUNC(\"gf-clkout1\",      PIN, 0x2A),\n\tLN_FUNC(\"gf-mclk1\",        PIN, 0x2B),\n\tLN_FUNC(\"gf-mclk3\",        PIN, 0x2C),\n\tLN_FUNC(\"gf-mclk2\",        PIN, 0x2D),\n\tLN_FUNC(\"gf-clkout2\",      PIN, 0x2E),\n\tLN2_FUNC_PIN(CDC_MCLK1,         0x2F),\n\tLN2_FUNC_PIN(CDC_MCLK2,         0x30),\n\tLN2_FUNC_PIN(DSP_CLKIN,         0x31),\n\tLN2_FUNC_PIN(PSIA1_MCLK,        0x32),\n\tLN2_FUNC_PIN(PSIA2_MCLK,        0x33),\n\tLN_FUNC(\"spdif-mclk\",      PIN, 0x34),\n\tLN_FUNC(\"codec-irq\",       PIN, 0x42),\n\tLN2_FUNC_PIN(CDC_RESET,         0x43),\n\tLN2_FUNC_PIN(DSP_RESET,         0x44),\n\tLN_FUNC(\"dsp-irq\",         PIN, 0x45),\n\tLN2_FUNC_PIN(DSP_STANDBY,       0x46),\n\tLN2_FUNC_PIN(CDC_PDMCLK1,       0x90),\n\tLN2_FUNC_PIN(CDC_PDMDAT1,       0x91),\n\tLN2_FUNC_PIN(CDC_PDMCLK2,       0x92),\n\tLN2_FUNC_PIN(CDC_PDMDAT2,       0x93),\n\tLN2_FUNC_PIN(CDC_DMICCLK1,      0xA0),\n\tLN2_FUNC_PIN(CDC_DMICDAT1,      0xA1),\n\tLN2_FUNC_PIN(CDC_DMICCLK2,      0xA2),\n\tLN2_FUNC_PIN(CDC_DMICDAT2,      0xA3),\n\tLN2_FUNC_PIN(CDC_DMICCLK3,      0xA4),\n\tLN2_FUNC_PIN(CDC_DMICDAT3,      0xA5),\n\tLN2_FUNC_PIN(CDC_DMICCLK4,      0xA6),\n\tLN2_FUNC_PIN(CDC_DMICDAT4,      0xA7),\n\tLN2_FUNC_PIN(DSP_DMICCLK1,      0xA8),\n\tLN2_FUNC_PIN(DSP_DMICDAT1,      0xA9),\n\tLN2_FUNC_PIN(DSP_DMICCLK2,      0xAA),\n\tLN2_FUNC_PIN(DSP_DMICDAT2,      0xAB),\n\tLN2_FUNC_PIN(DSP_UART1_RX,      0xC0),\n\tLN2_FUNC_PIN(DSP_UART1_TX,      0xC1),\n\tLN2_FUNC_PIN(DSP_UART2_RX,      0xC2),\n\tLN2_FUNC_PIN(DSP_UART2_TX,      0xC3),\n\tLN2_FUNC_PIN(GF_UART2_RX,       0xC4),\n\tLN2_FUNC_PIN(GF_UART2_TX,       0xC5),\n\tLN2_FUNC_PIN(USB_UART_RX,       0xC6),\n\tLN_FUNC(\"usb-uart-tx\",     PIN, 0xC7),\n\tLN2_FUNC_PIN(I2C2_SCL,          0xE0),\n\tLN2_FUNC_PIN(I2C2_SDA,          0xE1),\n\tLN2_FUNC_PIN(I2C3_SCL,          0xE2),\n\tLN2_FUNC_PIN(I2C3_SDA,          0xE3),\n\tLN2_FUNC_PIN(I2C4_SCL,          0xE4),\n\tLN2_FUNC_PIN(I2C4_SDA,          0xE5),\n\n\tLN2_FUNC_AIF(SPDIF_AIF,         0x01),\n\tLN2_FUNC_GAI(PSIA1,             0x02, 0x50, 0x51, 0x52, 0x53),\n\tLN2_FUNC_GAI(PSIA2,             0x03, 0x54, 0x55, 0x56, 0x57),\n\tLN2_FUNC_GAI(CDC_AIF1,          0x04, 0x59, 0x5B, 0x5A, 0x58),\n\tLN2_FUNC_GAI(CDC_AIF2,          0x05, 0x5D, 0x5F, 0x5E, 0x5C),\n\tLN2_FUNC_GAI(CDC_AIF3,          0x06, 0x61, 0x62, 0x63, 0x60),\n\tLN2_FUNC_GAI(DSP_AIF1,          0x07, 0x65, 0x67, 0x66, 0x64),\n\tLN2_FUNC_GAI(DSP_AIF2,          0x08, 0x69, 0x6B, 0x6A, 0x68),\n\tLN2_FUNC_GAI(GF_AIF3,           0x09, 0x6D, 0x6F, 0x6C, 0x6E),\n\tLN2_FUNC_GAI(GF_AIF4,           0x0A, 0x71, 0x73, 0x70, 0x72),\n\tLN2_FUNC_GAI(GF_AIF1,           0x0B, 0x75, 0x77, 0x74, 0x76),\n\tLN2_FUNC_GAI(GF_AIF2,           0x0C, 0x79, 0x7B, 0x78, 0x7A),\n\tLN2_FUNC_AIF(USB_AIF1,          0x0D),\n\tLN2_FUNC_AIF(USB_AIF2,          0x0E),\n\tLN2_FUNC_AIF(ADAT_AIF,          0x0F),\n\tLN2_FUNC_AIF(SOUNDCARD_AIF,     0x10),\n};\n\n#define LN_GROUP_PIN(REV, ID) { \\\n\t.name = lochnagar##REV##_##ID##_pin.name, \\\n\t.type = LN_FTYPE_PIN, \\\n\t.pins = &lochnagar##REV##_pins[LOCHNAGAR##REV##_PIN_##ID].number, \\\n\t.npins = 1, \\\n\t.priv = &lochnagar##REV##_pins[LOCHNAGAR##REV##_PIN_##ID], \\\n}\n\n#define LN_GROUP_AIF(REV, ID) { \\\n\t.name = lochnagar##REV##_##ID##_aif.name, \\\n\t.type = LN_FTYPE_AIF, \\\n\t.pins = lochnagar##REV##_##ID##_aif.pins, \\\n\t.npins = ARRAY_SIZE(lochnagar##REV##_##ID##_aif.pins), \\\n\t.priv = &lochnagar##REV##_##ID##_aif, \\\n}\n\n#define LN1_GROUP_PIN(ID) LN_GROUP_PIN(1, ID)\n#define LN2_GROUP_PIN(ID) LN_GROUP_PIN(2, ID)\n\n#define LN1_GROUP_AIF(ID) LN_GROUP_AIF(1, ID)\n#define LN2_GROUP_AIF(ID) LN_GROUP_AIF(2, ID)\n\n#define LN2_GROUP_GAI(ID) \\\n\tLN2_GROUP_AIF(ID), \\\n\tLN2_GROUP_PIN(ID##_BCLK), LN2_GROUP_PIN(ID##_LRCLK), \\\n\tLN2_GROUP_PIN(ID##_RXDAT), LN2_GROUP_PIN(ID##_TXDAT)\n\nstruct lochnagar_group {\n\tconst char * const name;\n\n\tenum lochnagar_func_type type;\n\n\tconst unsigned int *pins;\n\tunsigned int npins;\n\n\tconst void *priv;\n};\n\nstatic const struct lochnagar_group lochnagar1_groups[] = {\n\tLN1_GROUP_PIN(GF_GPIO2),       LN1_GROUP_PIN(GF_GPIO3),\n\tLN1_GROUP_PIN(GF_GPIO7),\n\tLN1_GROUP_PIN(LED1),           LN1_GROUP_PIN(LED2),\n\tLN1_GROUP_AIF(CDC_AIF1),       LN1_GROUP_AIF(CDC_AIF2),\n\tLN1_GROUP_AIF(CDC_AIF3),\n\tLN1_GROUP_AIF(DSP_AIF1),       LN1_GROUP_AIF(DSP_AIF2),\n\tLN1_GROUP_AIF(PSIA1),          LN1_GROUP_AIF(PSIA2),\n\tLN1_GROUP_AIF(GF_AIF1),        LN1_GROUP_AIF(GF_AIF2),\n\tLN1_GROUP_AIF(GF_AIF3),        LN1_GROUP_AIF(GF_AIF4),\n\tLN1_GROUP_AIF(SPDIF_AIF),\n};\n\nstatic const struct lochnagar_group lochnagar2_groups[] = {\n\tLN2_GROUP_PIN(FPGA_GPIO1),     LN2_GROUP_PIN(FPGA_GPIO2),\n\tLN2_GROUP_PIN(FPGA_GPIO3),     LN2_GROUP_PIN(FPGA_GPIO4),\n\tLN2_GROUP_PIN(FPGA_GPIO5),     LN2_GROUP_PIN(FPGA_GPIO6),\n\tLN2_GROUP_PIN(CDC_GPIO1),      LN2_GROUP_PIN(CDC_GPIO2),\n\tLN2_GROUP_PIN(CDC_GPIO3),      LN2_GROUP_PIN(CDC_GPIO4),\n\tLN2_GROUP_PIN(CDC_GPIO5),      LN2_GROUP_PIN(CDC_GPIO6),\n\tLN2_GROUP_PIN(CDC_GPIO7),      LN2_GROUP_PIN(CDC_GPIO8),\n\tLN2_GROUP_PIN(DSP_GPIO1),      LN2_GROUP_PIN(DSP_GPIO2),\n\tLN2_GROUP_PIN(DSP_GPIO3),      LN2_GROUP_PIN(DSP_GPIO4),\n\tLN2_GROUP_PIN(DSP_GPIO5),      LN2_GROUP_PIN(DSP_GPIO6),\n\tLN2_GROUP_PIN(DSP_GPIO20),\n\tLN2_GROUP_PIN(GF_GPIO1),\n\tLN2_GROUP_PIN(GF_GPIO2),       LN2_GROUP_PIN(GF_GPIO5),\n\tLN2_GROUP_PIN(GF_GPIO3),       LN2_GROUP_PIN(GF_GPIO7),\n\tLN2_GROUP_PIN(DSP_UART1_RX),   LN2_GROUP_PIN(DSP_UART1_TX),\n\tLN2_GROUP_PIN(DSP_UART2_RX),   LN2_GROUP_PIN(DSP_UART2_TX),\n\tLN2_GROUP_PIN(GF_UART2_RX),    LN2_GROUP_PIN(GF_UART2_TX),\n\tLN2_GROUP_PIN(USB_UART_RX),\n\tLN2_GROUP_PIN(CDC_PDMCLK1),    LN2_GROUP_PIN(CDC_PDMDAT1),\n\tLN2_GROUP_PIN(CDC_PDMCLK2),    LN2_GROUP_PIN(CDC_PDMDAT2),\n\tLN2_GROUP_PIN(CDC_DMICCLK1),   LN2_GROUP_PIN(CDC_DMICDAT1),\n\tLN2_GROUP_PIN(CDC_DMICCLK2),   LN2_GROUP_PIN(CDC_DMICDAT2),\n\tLN2_GROUP_PIN(CDC_DMICCLK3),   LN2_GROUP_PIN(CDC_DMICDAT3),\n\tLN2_GROUP_PIN(CDC_DMICCLK4),   LN2_GROUP_PIN(CDC_DMICDAT4),\n\tLN2_GROUP_PIN(DSP_DMICCLK1),   LN2_GROUP_PIN(DSP_DMICDAT1),\n\tLN2_GROUP_PIN(DSP_DMICCLK2),   LN2_GROUP_PIN(DSP_DMICDAT2),\n\tLN2_GROUP_PIN(I2C2_SCL),       LN2_GROUP_PIN(I2C2_SDA),\n\tLN2_GROUP_PIN(I2C3_SCL),       LN2_GROUP_PIN(I2C3_SDA),\n\tLN2_GROUP_PIN(I2C4_SCL),       LN2_GROUP_PIN(I2C4_SDA),\n\tLN2_GROUP_PIN(DSP_STANDBY),\n\tLN2_GROUP_PIN(CDC_MCLK1),      LN2_GROUP_PIN(CDC_MCLK2),\n\tLN2_GROUP_PIN(DSP_CLKIN),\n\tLN2_GROUP_PIN(PSIA1_MCLK),     LN2_GROUP_PIN(PSIA2_MCLK),\n\tLN2_GROUP_GAI(CDC_AIF1),       LN2_GROUP_GAI(CDC_AIF2),\n\tLN2_GROUP_GAI(CDC_AIF3),\n\tLN2_GROUP_GAI(DSP_AIF1),       LN2_GROUP_GAI(DSP_AIF2),\n\tLN2_GROUP_GAI(PSIA1),          LN2_GROUP_GAI(PSIA2),\n\tLN2_GROUP_GAI(GF_AIF1),        LN2_GROUP_GAI(GF_AIF2),\n\tLN2_GROUP_GAI(GF_AIF3),        LN2_GROUP_GAI(GF_AIF4),\n\tLN2_GROUP_AIF(SPDIF_AIF),\n\tLN2_GROUP_AIF(USB_AIF1),       LN2_GROUP_AIF(USB_AIF2),\n\tLN2_GROUP_AIF(ADAT_AIF),\n\tLN2_GROUP_AIF(SOUNDCARD_AIF),\n};\n\nstruct lochnagar_func_groups {\n\tconst char **groups;\n\tunsigned int ngroups;\n};\n\nstruct lochnagar_pin_priv {\n\tstruct lochnagar *lochnagar;\n\tstruct device *dev;\n\n\tconst struct lochnagar_func *funcs;\n\tunsigned int nfuncs;\n\n\tconst struct pinctrl_pin_desc *pins;\n\tunsigned int npins;\n\n\tconst struct lochnagar_group *groups;\n\tunsigned int ngroups;\n\n\tstruct lochnagar_func_groups func_groups[LN_FTYPE_COUNT];\n\n\tstruct gpio_chip gpio_chip;\n};\n\nstatic int lochnagar_get_groups_count(struct pinctrl_dev *pctldev)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn priv->ngroups;\n}\n\nstatic const char *lochnagar_get_group_name(struct pinctrl_dev *pctldev,\n\t\t\t\t\t    unsigned int group_idx)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn priv->groups[group_idx].name;\n}\n\nstatic int lochnagar_get_group_pins(struct pinctrl_dev *pctldev,\n\t\t\t\t    unsigned int group_idx,\n\t\t\t\t    const unsigned int **pins,\n\t\t\t\t    unsigned int *num_pins)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\n\t*pins = priv->groups[group_idx].pins;\n\t*num_pins = priv->groups[group_idx].npins;\n\n\treturn 0;\n}\n\nstatic const struct pinctrl_ops lochnagar_pin_group_ops = {\n\t.get_groups_count = lochnagar_get_groups_count,\n\t.get_group_name = lochnagar_get_group_name,\n\t.get_group_pins = lochnagar_get_group_pins,\n\t.dt_node_to_map = pinconf_generic_dt_node_to_map_all,\n\t.dt_free_map = pinctrl_utils_free_map,\n};\n\nstatic int lochnagar_get_funcs_count(struct pinctrl_dev *pctldev)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn priv->nfuncs;\n}\n\nstatic const char *lochnagar_get_func_name(struct pinctrl_dev *pctldev,\n\t\t\t\t\t   unsigned int func_idx)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn priv->funcs[func_idx].name;\n}\n\nstatic int lochnagar_get_func_groups(struct pinctrl_dev *pctldev,\n\t\t\t\t     unsigned int func_idx,\n\t\t\t\t     const char * const **groups,\n\t\t\t\t     unsigned int * const num_groups)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\tint func_type;\n\n\tfunc_type = priv->funcs[func_idx].type;\n\n\t*groups = priv->func_groups[func_type].groups;\n\t*num_groups = priv->func_groups[func_type].ngroups;\n\n\treturn 0;\n}\n\nstatic int lochnagar2_get_gpio_chan(struct lochnagar_pin_priv *priv,\n\t\t\t\t    unsigned int op)\n{\n\tstruct regmap *regmap = priv->lochnagar->regmap;\n\tunsigned int val;\n\tint free = -1;\n\tint i, ret;\n\n\tfor (i = 0; i < LN2_NUM_GPIO_CHANNELS; i++) {\n\t\tret = regmap_read(regmap, LOCHNAGAR2_GPIO_CHANNEL1 + i, &val);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tval &= LOCHNAGAR2_GPIO_CHANNEL_SRC_MASK;\n\n\t\tif (val == op)\n\t\t\treturn i + 1;\n\n\t\tif (free < 0 && !val)\n\t\t\tfree = i;\n\t}\n\n\tif (free >= 0) {\n\t\tret = regmap_update_bits(regmap,\n\t\t\t\t\t LOCHNAGAR2_GPIO_CHANNEL1 + free,\n\t\t\t\t\t LOCHNAGAR2_GPIO_CHANNEL_SRC_MASK, op);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tfree++;\n\n\t\tdev_dbg(priv->dev, \"Set channel %d to 0x%x\\n\", free, op);\n\n\t\treturn free;\n\t}\n\n\treturn -ENOSPC;\n}\n\nstatic int lochnagar_pin_set_mux(struct lochnagar_pin_priv *priv,\n\t\t\t\t const struct lochnagar_pin *pin,\n\t\t\t\t unsigned int op)\n{\n\tint ret;\n\n\tswitch (priv->lochnagar->type) {\n\tcase LOCHNAGAR1:\n\t\tbreak;\n\tdefault:\n\t\tret = lochnagar2_get_gpio_chan(priv, op);\n\t\tif (ret < 0) {\n\t\t\tdev_err(priv->dev, \"Failed to get channel for %s: %d\\n\",\n\t\t\t\tpin->name, ret);\n\t\t\treturn ret;\n\t\t}\n\n\t\top = ret;\n\t\tbreak;\n\t}\n\n\tdev_dbg(priv->dev, \"Set pin %s to 0x%x\\n\", pin->name, op);\n\n\tret = regmap_write(priv->lochnagar->regmap, pin->reg, op);\n\tif (ret)\n\t\tdev_err(priv->dev, \"Failed to set %s mux: %d\\n\",\n\t\t\tpin->name, ret);\n\n\treturn 0;\n}\n\nstatic int lochnagar_aif_set_mux(struct lochnagar_pin_priv *priv,\n\t\t\t\t const struct lochnagar_group *group,\n\t\t\t\t unsigned int op)\n{\n\tstruct regmap *regmap = priv->lochnagar->regmap;\n\tconst struct lochnagar_aif *aif = group->priv;\n\tconst struct lochnagar_pin *pin;\n\tint i, ret;\n\n\tret = regmap_update_bits(regmap, aif->src_reg, aif->src_mask, op);\n\tif (ret) {\n\t\tdev_err(priv->dev, \"Failed to set %s source: %d\\n\",\n\t\t\tgroup->name, ret);\n\t\treturn ret;\n\t}\n\n\tret = regmap_update_bits(regmap, aif->ctrl_reg,\n\t\t\t\t aif->ena_mask, aif->ena_mask);\n\tif (ret) {\n\t\tdev_err(priv->dev, \"Failed to set %s enable: %d\\n\",\n\t\t\tgroup->name, ret);\n\t\treturn ret;\n\t}\n\n\tfor (i = 0; i < group->npins; i++) {\n\t\tpin = priv->pins[group->pins[i]].drv_data;\n\n\t\tif (pin->type != LN_PTYPE_MUX)\n\t\t\tcontinue;\n\n\t\tdev_dbg(priv->dev, \"Set pin %s to AIF\\n\", pin->name);\n\n\t\tret = regmap_update_bits(regmap, pin->reg,\n\t\t\t\t\t LOCHNAGAR2_GPIO_SRC_MASK,\n\t\t\t\t\t LN2_OP_AIF);\n\t\tif (ret) {\n\t\t\tdev_err(priv->dev, \"Failed to set %s to AIF: %d\\n\",\n\t\t\t\tpin->name, ret);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int lochnagar_set_mux(struct pinctrl_dev *pctldev,\n\t\t\t     unsigned int func_idx, unsigned int group_idx)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\tconst struct lochnagar_func *func = &priv->funcs[func_idx];\n\tconst struct lochnagar_group *group = &priv->groups[group_idx];\n\tconst struct lochnagar_pin *pin;\n\n\tswitch (func->type) {\n\tcase LN_FTYPE_AIF:\n\t\tdev_dbg(priv->dev, \"Set group %s to %s\\n\",\n\t\t\tgroup->name, func->name);\n\n\t\treturn lochnagar_aif_set_mux(priv, group, func->op);\n\tcase LN_FTYPE_PIN:\n\t\tpin = priv->pins[*group->pins].drv_data;\n\n\t\tdev_dbg(priv->dev, \"Set pin %s to %s\\n\", pin->name, func->name);\n\n\t\treturn lochnagar_pin_set_mux(priv, pin, func->op);\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int lochnagar_gpio_request(struct pinctrl_dev *pctldev,\n\t\t\t\t  struct pinctrl_gpio_range *range,\n\t\t\t\t  unsigned int offset)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\tstruct lochnagar *lochnagar = priv->lochnagar;\n\tconst struct lochnagar_pin *pin = priv->pins[offset].drv_data;\n\tint ret;\n\n\tdev_dbg(priv->dev, \"Requesting GPIO %s\\n\", pin->name);\n\n\tif (lochnagar->type == LOCHNAGAR1 || pin->type != LN_PTYPE_MUX)\n\t\treturn 0;\n\n\tret = lochnagar2_get_gpio_chan(priv, LN2_OP_GPIO);\n\tif (ret < 0) {\n\t\tdev_err(priv->dev, \"Failed to get low channel: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = lochnagar2_get_gpio_chan(priv, LN2_OP_GPIO | 0x1);\n\tif (ret < 0) {\n\t\tdev_err(priv->dev, \"Failed to get high channel: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int lochnagar_gpio_set_direction(struct pinctrl_dev *pctldev,\n\t\t\t\t\tstruct pinctrl_gpio_range *range,\n\t\t\t\t\tunsigned int offset,\n\t\t\t\t\tbool input)\n{\n\t \n\tif (input)\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nstatic const struct pinmux_ops lochnagar_pin_mux_ops = {\n\t.get_functions_count = lochnagar_get_funcs_count,\n\t.get_function_name = lochnagar_get_func_name,\n\t.get_function_groups = lochnagar_get_func_groups,\n\t.set_mux = lochnagar_set_mux,\n\n\t.gpio_request_enable = lochnagar_gpio_request,\n\t.gpio_set_direction = lochnagar_gpio_set_direction,\n\n\t.strict = true,\n};\n\nstatic int lochnagar_aif_set_master(struct lochnagar_pin_priv *priv,\n\t\t\t\t    unsigned int group_idx, bool master)\n{\n\tstruct regmap *regmap = priv->lochnagar->regmap;\n\tconst struct lochnagar_group *group = &priv->groups[group_idx];\n\tconst struct lochnagar_aif *aif = group->priv;\n\tunsigned int val = 0;\n\tint ret;\n\n\tif (group->type != LN_FTYPE_AIF)\n\t\treturn -EINVAL;\n\n\tif (!master)\n\t\tval = aif->master_mask;\n\n\tdev_dbg(priv->dev, \"Set AIF %s to %s\\n\",\n\t\tgroup->name, master ? \"master\" : \"slave\");\n\n\tret = regmap_update_bits(regmap, aif->ctrl_reg, aif->master_mask, val);\n\tif (ret) {\n\t\tdev_err(priv->dev, \"Failed to set %s mode: %d\\n\",\n\t\t\tgroup->name, ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int lochnagar_conf_group_set(struct pinctrl_dev *pctldev,\n\t\t\t\t    unsigned int group_idx,\n\t\t\t\t    unsigned long *configs,\n\t\t\t\t    unsigned int num_configs)\n{\n\tstruct lochnagar_pin_priv *priv = pinctrl_dev_get_drvdata(pctldev);\n\tint i, ret;\n\n\tfor (i = 0; i < num_configs; i++) {\n\t\tunsigned int param = pinconf_to_config_param(*configs);\n\n\t\tswitch (param) {\n\t\tcase PIN_CONFIG_OUTPUT_ENABLE:\n\t\t\tret = lochnagar_aif_set_master(priv, group_idx, true);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t\tbreak;\n\t\tcase PIN_CONFIG_INPUT_ENABLE:\n\t\t\tret = lochnagar_aif_set_master(priv, group_idx, false);\n\t\t\tif (ret)\n\t\t\t\treturn ret;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -ENOTSUPP;\n\t\t}\n\n\t\tconfigs++;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct pinconf_ops lochnagar_pin_conf_ops = {\n\t.pin_config_group_set = lochnagar_conf_group_set,\n};\n\nstatic const struct pinctrl_desc lochnagar_pin_desc = {\n\t.name = \"lochnagar-pinctrl\",\n\t.owner = THIS_MODULE,\n\n\t.pctlops = &lochnagar_pin_group_ops,\n\t.pmxops = &lochnagar_pin_mux_ops,\n\t.confops = &lochnagar_pin_conf_ops,\n};\n\nstatic void lochnagar_gpio_set(struct gpio_chip *chip,\n\t\t\t       unsigned int offset, int value)\n{\n\tstruct lochnagar_pin_priv *priv = gpiochip_get_data(chip);\n\tstruct lochnagar *lochnagar = priv->lochnagar;\n\tconst struct lochnagar_pin *pin = priv->pins[offset].drv_data;\n\tint ret;\n\n\tvalue = !!value;\n\n\tdev_dbg(priv->dev, \"Set GPIO %s to %s\\n\",\n\t\tpin->name, value ? \"high\" : \"low\");\n\n\tswitch (pin->type) {\n\tcase LN_PTYPE_MUX:\n\t\tvalue |= LN2_OP_GPIO;\n\n\t\tret = lochnagar_pin_set_mux(priv, pin, value);\n\t\tbreak;\n\tcase LN_PTYPE_GPIO:\n\t\tif (pin->invert)\n\t\t\tvalue = !value;\n\n\t\tret = regmap_update_bits(lochnagar->regmap, pin->reg,\n\t\t\t\t\t BIT(pin->shift), value << pin->shift);\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tbreak;\n\t}\n\n\tif (ret < 0)\n\t\tdev_err(chip->parent, \"Failed to set %s value: %d\\n\",\n\t\t\tpin->name, ret);\n}\n\nstatic int lochnagar_gpio_direction_out(struct gpio_chip *chip,\n\t\t\t\t\tunsigned int offset, int value)\n{\n\tlochnagar_gpio_set(chip, offset, value);\n\n\treturn pinctrl_gpio_direction_output(chip->base + offset);\n}\n\nstatic int lochnagar_fill_func_groups(struct lochnagar_pin_priv *priv)\n{\n\tstruct lochnagar_func_groups *funcs;\n\tint i;\n\n\tfor (i = 0; i < priv->ngroups; i++)\n\t\tpriv->func_groups[priv->groups[i].type].ngroups++;\n\n\tfor (i = 0; i < LN_FTYPE_COUNT; i++) {\n\t\tfuncs = &priv->func_groups[i];\n\n\t\tif (!funcs->ngroups)\n\t\t\tcontinue;\n\n\t\tfuncs->groups = devm_kcalloc(priv->dev, funcs->ngroups,\n\t\t\t\t\t     sizeof(*funcs->groups),\n\t\t\t\t\t     GFP_KERNEL);\n\t\tif (!funcs->groups)\n\t\t\treturn -ENOMEM;\n\n\t\tfuncs->ngroups = 0;\n\t}\n\n\tfor (i = 0; i < priv->ngroups; i++) {\n\t\tfuncs = &priv->func_groups[priv->groups[i].type];\n\n\t\tfuncs->groups[funcs->ngroups++] = priv->groups[i].name;\n\t}\n\n\treturn 0;\n}\n\nstatic int lochnagar_pin_probe(struct platform_device *pdev)\n{\n\tstruct lochnagar *lochnagar = dev_get_drvdata(pdev->dev.parent);\n\tstruct lochnagar_pin_priv *priv;\n\tstruct pinctrl_desc *desc;\n\tstruct pinctrl_dev *pctl;\n\tstruct device *dev = &pdev->dev;\n\tint ret;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->dev = dev;\n\tpriv->lochnagar = lochnagar;\n\n\tdesc = devm_kzalloc(dev, sizeof(*desc), GFP_KERNEL);\n\tif (!desc)\n\t\treturn -ENOMEM;\n\n\t*desc = lochnagar_pin_desc;\n\n\tpriv->gpio_chip.label = dev_name(dev);\n\tpriv->gpio_chip.request = gpiochip_generic_request;\n\tpriv->gpio_chip.free = gpiochip_generic_free;\n\tpriv->gpio_chip.direction_output = lochnagar_gpio_direction_out;\n\tpriv->gpio_chip.set = lochnagar_gpio_set;\n\tpriv->gpio_chip.can_sleep = true;\n\tpriv->gpio_chip.parent = dev;\n\tpriv->gpio_chip.base = -1;\n\n\tswitch (lochnagar->type) {\n\tcase LOCHNAGAR1:\n\t\tpriv->funcs = lochnagar1_funcs;\n\t\tpriv->nfuncs = ARRAY_SIZE(lochnagar1_funcs);\n\t\tpriv->pins = lochnagar1_pins;\n\t\tpriv->npins = ARRAY_SIZE(lochnagar1_pins);\n\t\tpriv->groups = lochnagar1_groups;\n\t\tpriv->ngroups = ARRAY_SIZE(lochnagar1_groups);\n\n\t\tpriv->gpio_chip.ngpio = LOCHNAGAR1_PIN_NUM_GPIOS;\n\t\tbreak;\n\tcase LOCHNAGAR2:\n\t\tpriv->funcs = lochnagar2_funcs;\n\t\tpriv->nfuncs = ARRAY_SIZE(lochnagar2_funcs);\n\t\tpriv->pins = lochnagar2_pins;\n\t\tpriv->npins = ARRAY_SIZE(lochnagar2_pins);\n\t\tpriv->groups = lochnagar2_groups;\n\t\tpriv->ngroups = ARRAY_SIZE(lochnagar2_groups);\n\n\t\tpriv->gpio_chip.ngpio = LOCHNAGAR2_PIN_NUM_GPIOS;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dev, \"Unknown Lochnagar type: %d\\n\", lochnagar->type);\n\t\treturn -EINVAL;\n\t}\n\n\tret = lochnagar_fill_func_groups(priv);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tdesc->pins = priv->pins;\n\tdesc->npins = priv->npins;\n\n\tpctl = devm_pinctrl_register(dev, desc, priv);\n\tif (IS_ERR(pctl)) {\n\t\tret = PTR_ERR(pctl);\n\t\tdev_err(priv->dev, \"Failed to register pinctrl: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = devm_gpiochip_add_data(dev, &priv->gpio_chip, priv);\n\tif (ret < 0) {\n\t\tdev_err(&pdev->dev, \"Failed to register gpiochip: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct of_device_id lochnagar_of_match[] = {\n\t{ .compatible = \"cirrus,lochnagar-pinctrl\" },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, lochnagar_of_match);\n\nstatic struct platform_driver lochnagar_pin_driver = {\n\t.driver = {\n\t\t.name = \"lochnagar-pinctrl\",\n\t\t.of_match_table = of_match_ptr(lochnagar_of_match),\n\t},\n\n\t.probe = lochnagar_pin_probe,\n};\nmodule_platform_driver(lochnagar_pin_driver);\n\nMODULE_AUTHOR(\"Charles Keepax <ckeepax@opensource.cirrus.com>\");\nMODULE_DESCRIPTION(\"Pinctrl driver for Cirrus Logic Lochnagar Board\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}