{
  "module_name": "pinctrl-orion.c",
  "hash_id": "5c09172744b1daec3164094b3d9b2d2185dd9079c0102ebd77749b09483e666e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/mvebu/pinctrl-orion.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/platform_device.h>\n#include <linux/clk.h>\n#include <linux/of.h>\n#include <linux/of_device.h>\n#include <linux/pinctrl/pinctrl.h>\n\n#include \"pinctrl-mvebu.h\"\n\nstatic void __iomem *mpp_base;\nstatic void __iomem *high_mpp_base;\n\nstatic int orion_mpp_ctrl_get(struct mvebu_mpp_ctrl_data *data,\n\t\t\t      unsigned pid, unsigned long *config)\n{\n\tunsigned shift = (pid % MVEBU_MPPS_PER_REG) * MVEBU_MPP_BITS;\n\n\tif (pid < 16) {\n\t\tunsigned off = (pid / MVEBU_MPPS_PER_REG) * MVEBU_MPP_BITS;\n\t\t*config = (readl(mpp_base + off) >> shift) & MVEBU_MPP_MASK;\n\t}\n\telse {\n\t\t*config = (readl(high_mpp_base) >> shift) & MVEBU_MPP_MASK;\n\t}\n\n\treturn 0;\n}\n\nstatic int orion_mpp_ctrl_set(struct mvebu_mpp_ctrl_data *data,\n\t\t\t      unsigned pid, unsigned long config)\n{\n\tunsigned shift = (pid % MVEBU_MPPS_PER_REG) * MVEBU_MPP_BITS;\n\n\tif (pid < 16) {\n\t\tunsigned off = (pid / MVEBU_MPPS_PER_REG) * MVEBU_MPP_BITS;\n\t\tu32 reg = readl(mpp_base + off) & ~(MVEBU_MPP_MASK << shift);\n\t\twritel(reg | (config << shift), mpp_base + off);\n\t}\n\telse {\n\t\tu32 reg = readl(high_mpp_base) & ~(MVEBU_MPP_MASK << shift);\n\t\twritel(reg | (config << shift), high_mpp_base);\n\t}\n\n\treturn 0;\n}\n\n#define V(f5181, f5182, f5281) \\\n\t((f5181 << 0) | (f5182 << 1) | (f5281 << 2))\n\nenum orion_variant {\n\tV_5181  = V(1, 0, 0),\n\tV_5182  = V(0, 1, 0),\n\tV_5281  = V(0, 0, 1),\n\tV_ALL   = V(1, 1, 1),\n};\n\nstatic struct mvebu_mpp_mode orion_mpp_modes[] = {\n\tMPP_MODE(0,\n\t\t MPP_VAR_FUNCTION(0x0, \"pcie\", \"rstout\",    V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"req2\",       V_ALL),\n\t\t MPP_VAR_FUNCTION(0x3, \"gpio\", NULL,        V_ALL)),\n\tMPP_MODE(1,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"gnt2\",       V_ALL)),\n\tMPP_MODE(2,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"req3\",       V_ALL),\n\t\t MPP_VAR_FUNCTION(0x3, \"pci-1\", \"pme\",      V_ALL)),\n\tMPP_MODE(3,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"gnt3\",       V_ALL)),\n\tMPP_MODE(4,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"req4\",       V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"bootnand\", \"re\",    V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata0\", \"prsnt\",    V_5182)),\n\tMPP_MODE(5,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"gnt4\",       V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"bootnand\", \"we\",    V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata1\", \"prsnt\",    V_5182)),\n\tMPP_MODE(6,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"req5\",       V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"nand\", \"re0\",       V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"pci-1\", \"clk\",      V_5181),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata0\", \"act\",      V_5182)),\n\tMPP_MODE(7,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x2, \"pci\", \"gnt5\",       V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"nand\", \"we0\",       V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"pci-1\", \"clk\",      V_5181),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata1\", \"act\",      V_5182)),\n\tMPP_MODE(8,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"col\",         V_ALL)),\n\tMPP_MODE(9,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"rxerr\",       V_ALL)),\n\tMPP_MODE(10,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"crs\",         V_ALL)),\n\tMPP_MODE(11,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"txerr\",       V_ALL)),\n\tMPP_MODE(12,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"txd4\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"nand\", \"re1\",       V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata0\", \"ledprsnt\", V_5182)),\n\tMPP_MODE(13,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"txd5\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"nand\", \"we1\",       V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata1\", \"ledprsnt\", V_5182)),\n\tMPP_MODE(14,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"txd6\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"nand\", \"re2\",       V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata0\", \"ledact\",   V_5182)),\n\tMPP_MODE(15,\n\t\t MPP_VAR_FUNCTION(0x0, \"gpio\", NULL,        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"txd7\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x4, \"nand\", \"we2\",       V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x5, \"sata1\", \"ledact\",   V_5182)),\n\tMPP_MODE(16,\n\t\t MPP_VAR_FUNCTION(0x0, \"uart1\", \"rxd\",      V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"rxd4\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x5, \"gpio\", NULL,        V_5182)),\n\tMPP_MODE(17,\n\t\t MPP_VAR_FUNCTION(0x0, \"uart1\", \"txd\",      V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"rxd5\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x5, \"gpio\", NULL,        V_5182)),\n\tMPP_MODE(18,\n\t\t MPP_VAR_FUNCTION(0x0, \"uart1\", \"cts\",      V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"rxd6\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x5, \"gpio\", NULL,        V_5182)),\n\tMPP_MODE(19,\n\t\t MPP_VAR_FUNCTION(0x0, \"uart1\", \"rts\",      V_5182 | V_5281),\n\t\t MPP_VAR_FUNCTION(0x1, \"ge\", \"rxd7\",        V_ALL),\n\t\t MPP_VAR_FUNCTION(0x5, \"gpio\", NULL,        V_5182)),\n};\n\nstatic const struct mvebu_mpp_ctrl orion_mpp_controls[] = {\n\tMPP_FUNC_CTRL(0, 19, NULL, orion_mpp_ctrl),\n};\n\nstatic struct pinctrl_gpio_range mv88f5181_gpio_ranges[] = {\n\tMPP_GPIO_RANGE(0, 0, 0, 16),\n};\n\nstatic struct pinctrl_gpio_range mv88f5182_gpio_ranges[] = {\n\tMPP_GPIO_RANGE(0, 0, 0, 19),\n};\n\nstatic struct pinctrl_gpio_range mv88f5281_gpio_ranges[] = {\n\tMPP_GPIO_RANGE(0, 0, 0, 16),\n};\n\nstatic struct mvebu_pinctrl_soc_info mv88f5181_info = {\n\t.variant = V_5181,\n\t.controls = orion_mpp_controls,\n\t.ncontrols = ARRAY_SIZE(orion_mpp_controls),\n\t.modes = orion_mpp_modes,\n\t.nmodes = ARRAY_SIZE(orion_mpp_modes),\n\t.gpioranges = mv88f5181_gpio_ranges,\n\t.ngpioranges = ARRAY_SIZE(mv88f5181_gpio_ranges),\n};\n\nstatic struct mvebu_pinctrl_soc_info mv88f5182_info = {\n\t.variant = V_5182,\n\t.controls = orion_mpp_controls,\n\t.ncontrols = ARRAY_SIZE(orion_mpp_controls),\n\t.modes = orion_mpp_modes,\n\t.nmodes = ARRAY_SIZE(orion_mpp_modes),\n\t.gpioranges = mv88f5182_gpio_ranges,\n\t.ngpioranges = ARRAY_SIZE(mv88f5182_gpio_ranges),\n};\n\nstatic struct mvebu_pinctrl_soc_info mv88f5281_info = {\n\t.variant = V_5281,\n\t.controls = orion_mpp_controls,\n\t.ncontrols = ARRAY_SIZE(orion_mpp_controls),\n\t.modes = orion_mpp_modes,\n\t.nmodes = ARRAY_SIZE(orion_mpp_modes),\n\t.gpioranges = mv88f5281_gpio_ranges,\n\t.ngpioranges = ARRAY_SIZE(mv88f5281_gpio_ranges),\n};\n\n \nstatic const struct of_device_id orion_pinctrl_of_match[] = {\n\t{ .compatible = \"marvell,88f5181-pinctrl\", .data = &mv88f5181_info },\n\t{ .compatible = \"marvell,88f5181l-pinctrl\", .data = &mv88f5181_info },\n\t{ .compatible = \"marvell,88f5182-pinctrl\", .data = &mv88f5182_info },\n\t{ .compatible = \"marvell,88f5281-pinctrl\", .data = &mv88f5281_info },\n\t{ }\n};\n\nstatic int orion_pinctrl_probe(struct platform_device *pdev)\n{\n\tconst struct of_device_id *match =\n\t\tof_match_device(orion_pinctrl_of_match, &pdev->dev);\n\n\tpdev->dev.platform_data = (void*)match->data;\n\n\tmpp_base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(mpp_base))\n\t\treturn PTR_ERR(mpp_base);\n\n\thigh_mpp_base = devm_platform_ioremap_resource(pdev, 1);\n\tif (IS_ERR(high_mpp_base))\n\t\treturn PTR_ERR(high_mpp_base);\n\n\treturn mvebu_pinctrl_probe(pdev);\n}\n\nstatic struct platform_driver orion_pinctrl_driver = {\n\t.driver = {\n\t\t.name = \"orion-pinctrl\",\n\t\t.of_match_table = of_match_ptr(orion_pinctrl_of_match),\n\t},\n\t.probe = orion_pinctrl_probe,\n};\nbuiltin_platform_driver(orion_pinctrl_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}