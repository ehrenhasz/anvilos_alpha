{
  "module_name": "pinctrl-max77620.c",
  "hash_id": "d32be4ff7918b34058381e8d7c123bdce406a585548556d0026fbbac2fa744bc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/pinctrl-max77620.c",
  "human_readable_source": "\n \n\n#include <linux/mfd/max77620.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/property.h>\n#include <linux/regmap.h>\n\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinconf-generic.h>\n#include <linux/pinctrl/pinconf.h>\n#include <linux/pinctrl/pinmux.h>\n\n#include \"core.h\"\n#include \"pinconf.h\"\n#include \"pinctrl-utils.h\"\n\n#define MAX77620_PIN_NUM 8\n\nenum max77620_pin_ppdrv {\n\tMAX77620_PIN_UNCONFIG_DRV,\n\tMAX77620_PIN_OD_DRV,\n\tMAX77620_PIN_PP_DRV,\n};\n\n#define MAX77620_ACTIVE_FPS_SOURCE\t\t(PIN_CONFIG_END + 1)\n#define MAX77620_ACTIVE_FPS_POWER_ON_SLOTS\t(PIN_CONFIG_END + 2)\n#define MAX77620_ACTIVE_FPS_POWER_DOWN_SLOTS\t(PIN_CONFIG_END + 3)\n#define MAX77620_SUSPEND_FPS_SOURCE\t\t(PIN_CONFIG_END + 4)\n#define MAX77620_SUSPEND_FPS_POWER_ON_SLOTS\t(PIN_CONFIG_END + 5)\n#define MAX77620_SUSPEND_FPS_POWER_DOWN_SLOTS\t(PIN_CONFIG_END + 6)\n\nstruct max77620_pin_function {\n\tconst char *name;\n\tconst char * const *groups;\n\tunsigned int ngroups;\n\tint mux_option;\n};\n\nstatic const struct pinconf_generic_params max77620_cfg_params[] = {\n\t{\n\t\t.property = \"maxim,active-fps-source\",\n\t\t.param = MAX77620_ACTIVE_FPS_SOURCE,\n\t}, {\n\t\t.property = \"maxim,active-fps-power-up-slot\",\n\t\t.param = MAX77620_ACTIVE_FPS_POWER_ON_SLOTS,\n\t}, {\n\t\t.property = \"maxim,active-fps-power-down-slot\",\n\t\t.param = MAX77620_ACTIVE_FPS_POWER_DOWN_SLOTS,\n\t}, {\n\t\t.property = \"maxim,suspend-fps-source\",\n\t\t.param = MAX77620_SUSPEND_FPS_SOURCE,\n\t}, {\n\t\t.property = \"maxim,suspend-fps-power-up-slot\",\n\t\t.param = MAX77620_SUSPEND_FPS_POWER_ON_SLOTS,\n\t}, {\n\t\t.property = \"maxim,suspend-fps-power-down-slot\",\n\t\t.param = MAX77620_SUSPEND_FPS_POWER_DOWN_SLOTS,\n\t},\n};\n\nenum max77620_alternate_pinmux_option {\n\tMAX77620_PINMUX_GPIO\t\t\t\t= 0,\n\tMAX77620_PINMUX_LOW_POWER_MODE_CONTROL_IN\t= 1,\n\tMAX77620_PINMUX_FLEXIBLE_POWER_SEQUENCER_OUT\t= 2,\n\tMAX77620_PINMUX_32K_OUT1\t\t\t= 3,\n\tMAX77620_PINMUX_SD0_DYNAMIC_VOLTAGE_SCALING_IN\t= 4,\n\tMAX77620_PINMUX_SD1_DYNAMIC_VOLTAGE_SCALING_IN\t= 5,\n\tMAX77620_PINMUX_REFERENCE_OUT\t\t\t= 6,\n};\n\nstruct max77620_pingroup {\n\tconst char *name;\n\tconst unsigned int pins[1];\n\tunsigned int npins;\n\tenum max77620_alternate_pinmux_option alt_option;\n};\n\nstruct max77620_pin_info {\n\tenum max77620_pin_ppdrv drv_type;\n\tint pull_config;\n};\n\nstruct max77620_fps_config {\n\tint active_fps_src;\n\tint active_power_up_slots;\n\tint active_power_down_slots;\n\tint suspend_fps_src;\n\tint suspend_power_up_slots;\n\tint suspend_power_down_slots;\n};\n\nstruct max77620_pctrl_info {\n\tstruct device *dev;\n\tstruct pinctrl_dev *pctl;\n\tstruct regmap *rmap;\n\tint pins_current_opt[MAX77620_GPIO_NR];\n\tconst struct max77620_pin_function *functions;\n\tunsigned int num_functions;\n\tconst struct max77620_pingroup *pin_groups;\n\tint num_pin_groups;\n\tconst struct pinctrl_pin_desc *pins;\n\tunsigned int num_pins;\n\tstruct max77620_pin_info pin_info[MAX77620_PIN_NUM];\n\tstruct max77620_fps_config fps_config[MAX77620_PIN_NUM];\n};\n\nstatic const struct pinctrl_pin_desc max77620_pins_desc[] = {\n\tPINCTRL_PIN(MAX77620_GPIO0, \"gpio0\"),\n\tPINCTRL_PIN(MAX77620_GPIO1, \"gpio1\"),\n\tPINCTRL_PIN(MAX77620_GPIO2, \"gpio2\"),\n\tPINCTRL_PIN(MAX77620_GPIO3, \"gpio3\"),\n\tPINCTRL_PIN(MAX77620_GPIO4, \"gpio4\"),\n\tPINCTRL_PIN(MAX77620_GPIO5, \"gpio5\"),\n\tPINCTRL_PIN(MAX77620_GPIO6, \"gpio6\"),\n\tPINCTRL_PIN(MAX77620_GPIO7, \"gpio7\"),\n};\n\nstatic const char * const gpio_groups[] = {\n\t\"gpio0\",\n\t\"gpio1\",\n\t\"gpio2\",\n\t\"gpio3\",\n\t\"gpio4\",\n\t\"gpio5\",\n\t\"gpio6\",\n\t\"gpio7\",\n};\n\n#define FUNCTION_GROUP(fname, mux)\t\t\t\\\n\t{\t\t\t\t\t\t\\\n\t\t.name = fname,\t\t\t\t\\\n\t\t.groups = gpio_groups,\t\t\t\\\n\t\t.ngroups = ARRAY_SIZE(gpio_groups),\t\\\n\t\t.mux_option = MAX77620_PINMUX_##mux,\t\\\n\t}\n\nstatic const struct max77620_pin_function max77620_pin_function[] = {\n\tFUNCTION_GROUP(\"gpio\", GPIO),\n\tFUNCTION_GROUP(\"lpm-control-in\", LOW_POWER_MODE_CONTROL_IN),\n\tFUNCTION_GROUP(\"fps-out\", FLEXIBLE_POWER_SEQUENCER_OUT),\n\tFUNCTION_GROUP(\"32k-out1\", 32K_OUT1),\n\tFUNCTION_GROUP(\"sd0-dvs-in\", SD0_DYNAMIC_VOLTAGE_SCALING_IN),\n\tFUNCTION_GROUP(\"sd1-dvs-in\", SD1_DYNAMIC_VOLTAGE_SCALING_IN),\n\tFUNCTION_GROUP(\"reference-out\", REFERENCE_OUT),\n};\n\n#define MAX77620_PINGROUP(pg_name, pin_id, option) \\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.name = #pg_name,\t\t\t\t\t\\\n\t\t.pins = {MAX77620_##pin_id},\t\t\t\t\\\n\t\t.npins = 1,\t\t\t\t\t\t\\\n\t\t.alt_option = MAX77620_PINMUX_##option,\t\t\t\\\n\t}\n\nstatic const struct max77620_pingroup max77620_pingroups[] = {\n\tMAX77620_PINGROUP(gpio0, GPIO0, LOW_POWER_MODE_CONTROL_IN),\n\tMAX77620_PINGROUP(gpio1, GPIO1, FLEXIBLE_POWER_SEQUENCER_OUT),\n\tMAX77620_PINGROUP(gpio2, GPIO2, FLEXIBLE_POWER_SEQUENCER_OUT),\n\tMAX77620_PINGROUP(gpio3, GPIO3, FLEXIBLE_POWER_SEQUENCER_OUT),\n\tMAX77620_PINGROUP(gpio4, GPIO4, 32K_OUT1),\n\tMAX77620_PINGROUP(gpio5, GPIO5, SD0_DYNAMIC_VOLTAGE_SCALING_IN),\n\tMAX77620_PINGROUP(gpio6, GPIO6, SD1_DYNAMIC_VOLTAGE_SCALING_IN),\n\tMAX77620_PINGROUP(gpio7, GPIO7, REFERENCE_OUT),\n};\n\nstatic int max77620_pinctrl_get_groups_count(struct pinctrl_dev *pctldev)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn mpci->num_pin_groups;\n}\n\nstatic const char *max77620_pinctrl_get_group_name(\n\t\tstruct pinctrl_dev *pctldev, unsigned int group)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn mpci->pin_groups[group].name;\n}\n\nstatic int max77620_pinctrl_get_group_pins(\n\t\tstruct pinctrl_dev *pctldev, unsigned int group,\n\t\tconst unsigned int **pins, unsigned int *num_pins)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\n\t*pins = mpci->pin_groups[group].pins;\n\t*num_pins = mpci->pin_groups[group].npins;\n\n\treturn 0;\n}\n\nstatic const struct pinctrl_ops max77620_pinctrl_ops = {\n\t.get_groups_count = max77620_pinctrl_get_groups_count,\n\t.get_group_name = max77620_pinctrl_get_group_name,\n\t.get_group_pins = max77620_pinctrl_get_group_pins,\n\t.dt_node_to_map = pinconf_generic_dt_node_to_map_pin,\n\t.dt_free_map = pinctrl_utils_free_map,\n};\n\nstatic int max77620_pinctrl_get_funcs_count(struct pinctrl_dev *pctldev)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn mpci->num_functions;\n}\n\nstatic const char *max77620_pinctrl_get_func_name(struct pinctrl_dev *pctldev,\n\t\t\t\t\t\t  unsigned int function)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\n\treturn mpci->functions[function].name;\n}\n\nstatic int max77620_pinctrl_get_func_groups(struct pinctrl_dev *pctldev,\n\t\t\t\t\t    unsigned int function,\n\t\t\t\t\t    const char * const **groups,\n\t\t\t\t\t    unsigned int * const num_groups)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\n\t*groups = mpci->functions[function].groups;\n\t*num_groups = mpci->functions[function].ngroups;\n\n\treturn 0;\n}\n\nstatic int max77620_pinctrl_enable(struct pinctrl_dev *pctldev,\n\t\t\t\t   unsigned int function, unsigned int group)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\tu8 val;\n\tint ret;\n\n\tif (function == MAX77620_PINMUX_GPIO) {\n\t\tval = 0;\n\t} else if (function == mpci->pin_groups[group].alt_option) {\n\t\tval = 1 << group;\n\t} else {\n\t\tdev_err(mpci->dev, \"GPIO %u doesn't have function %u\\n\",\n\t\t\tgroup, function);\n\t\treturn -EINVAL;\n\t}\n\tret = regmap_update_bits(mpci->rmap, MAX77620_REG_AME_GPIO,\n\t\t\t\t BIT(group), val);\n\tif (ret < 0)\n\t\tdev_err(mpci->dev, \"REG AME GPIO update failed: %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic const struct pinmux_ops max77620_pinmux_ops = {\n\t.get_functions_count\t= max77620_pinctrl_get_funcs_count,\n\t.get_function_name\t= max77620_pinctrl_get_func_name,\n\t.get_function_groups\t= max77620_pinctrl_get_func_groups,\n\t.set_mux\t\t= max77620_pinctrl_enable,\n};\n\nstatic int max77620_pinconf_get(struct pinctrl_dev *pctldev,\n\t\t\t\tunsigned int pin, unsigned long *config)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\tstruct device *dev = mpci->dev;\n\tenum pin_config_param param = pinconf_to_config_param(*config);\n\tunsigned int val;\n\tint arg = 0;\n\tint ret;\n\n\tswitch (param) {\n\tcase PIN_CONFIG_DRIVE_OPEN_DRAIN:\n\t\tif (mpci->pin_info[pin].drv_type == MAX77620_PIN_OD_DRV)\n\t\t\targ = 1;\n\t\tbreak;\n\n\tcase PIN_CONFIG_DRIVE_PUSH_PULL:\n\t\tif (mpci->pin_info[pin].drv_type == MAX77620_PIN_PP_DRV)\n\t\t\targ = 1;\n\t\tbreak;\n\n\tcase PIN_CONFIG_BIAS_PULL_UP:\n\t\tret = regmap_read(mpci->rmap, MAX77620_REG_PUE_GPIO, &val);\n\t\tif (ret < 0) {\n\t\t\tdev_err(dev, \"Reg PUE_GPIO read failed: %d\\n\", ret);\n\t\t\treturn ret;\n\t\t}\n\t\tif (val & BIT(pin))\n\t\t\targ = 1;\n\t\tbreak;\n\n\tcase PIN_CONFIG_BIAS_PULL_DOWN:\n\t\tret = regmap_read(mpci->rmap, MAX77620_REG_PDE_GPIO, &val);\n\t\tif (ret < 0) {\n\t\t\tdev_err(dev, \"Reg PDE_GPIO read failed: %d\\n\", ret);\n\t\t\treturn ret;\n\t\t}\n\t\tif (val & BIT(pin))\n\t\t\targ = 1;\n\t\tbreak;\n\n\tdefault:\n\t\tdev_err(dev, \"Properties not supported\\n\");\n\t\treturn -ENOTSUPP;\n\t}\n\n\t*config = pinconf_to_config_packed(param, (u16)arg);\n\n\treturn 0;\n}\n\nstatic int max77620_get_default_fps(struct max77620_pctrl_info *mpci,\n\t\t\t\t    int addr, int *fps)\n{\n\tunsigned int val;\n\tint ret;\n\n\tret = regmap_read(mpci->rmap, addr, &val);\n\tif (ret < 0) {\n\t\tdev_err(mpci->dev, \"Reg PUE_GPIO read failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\t*fps = (val & MAX77620_FPS_SRC_MASK) >> MAX77620_FPS_SRC_SHIFT;\n\n\treturn 0;\n}\n\nstatic int max77620_set_fps_param(struct max77620_pctrl_info *mpci,\n\t\t\t\t  int pin, int param)\n{\n\tstruct max77620_fps_config *fps_config = &mpci->fps_config[pin];\n\tint addr, ret;\n\tint param_val;\n\tint mask, shift;\n\n\tif ((pin < MAX77620_GPIO1) || (pin > MAX77620_GPIO3))\n\t\treturn 0;\n\n\taddr = MAX77620_REG_FPS_GPIO1 + pin - 1;\n\tswitch (param) {\n\tcase MAX77620_ACTIVE_FPS_SOURCE:\n\tcase MAX77620_SUSPEND_FPS_SOURCE:\n\t\tmask = MAX77620_FPS_SRC_MASK;\n\t\tshift = MAX77620_FPS_SRC_SHIFT;\n\t\tparam_val = fps_config->active_fps_src;\n\t\tif (param == MAX77620_SUSPEND_FPS_SOURCE)\n\t\t\tparam_val = fps_config->suspend_fps_src;\n\t\tbreak;\n\n\tcase MAX77620_ACTIVE_FPS_POWER_ON_SLOTS:\n\tcase MAX77620_SUSPEND_FPS_POWER_ON_SLOTS:\n\t\tmask = MAX77620_FPS_PU_PERIOD_MASK;\n\t\tshift = MAX77620_FPS_PU_PERIOD_SHIFT;\n\t\tparam_val = fps_config->active_power_up_slots;\n\t\tif (param == MAX77620_SUSPEND_FPS_POWER_ON_SLOTS)\n\t\t\tparam_val = fps_config->suspend_power_up_slots;\n\t\tbreak;\n\n\tcase MAX77620_ACTIVE_FPS_POWER_DOWN_SLOTS:\n\tcase MAX77620_SUSPEND_FPS_POWER_DOWN_SLOTS:\n\t\tmask = MAX77620_FPS_PD_PERIOD_MASK;\n\t\tshift = MAX77620_FPS_PD_PERIOD_SHIFT;\n\t\tparam_val = fps_config->active_power_down_slots;\n\t\tif (param == MAX77620_SUSPEND_FPS_POWER_DOWN_SLOTS)\n\t\t\tparam_val = fps_config->suspend_power_down_slots;\n\t\tbreak;\n\n\tdefault:\n\t\tdev_err(mpci->dev, \"Invalid parameter %d for pin %d\\n\",\n\t\t\tparam, pin);\n\t\treturn -EINVAL;\n\t}\n\n\tif (param_val < 0)\n\t\treturn 0;\n\n\tret = regmap_update_bits(mpci->rmap, addr, mask, param_val << shift);\n\tif (ret < 0)\n\t\tdev_err(mpci->dev, \"Reg 0x%02x update failed %d\\n\", addr, ret);\n\n\treturn ret;\n}\n\nstatic int max77620_pinconf_set(struct pinctrl_dev *pctldev,\n\t\t\t\tunsigned int pin, unsigned long *configs,\n\t\t\t\tunsigned int num_configs)\n{\n\tstruct max77620_pctrl_info *mpci = pinctrl_dev_get_drvdata(pctldev);\n\tstruct device *dev = mpci->dev;\n\tstruct max77620_fps_config *fps_config;\n\tint param;\n\tu32 param_val;\n\tunsigned int val;\n\tunsigned int pu_val;\n\tunsigned int pd_val;\n\tint addr, ret;\n\tint i;\n\n\tfor (i = 0; i < num_configs; i++) {\n\t\tparam = pinconf_to_config_param(configs[i]);\n\t\tparam_val = pinconf_to_config_argument(configs[i]);\n\n\t\tswitch (param) {\n\t\tcase PIN_CONFIG_DRIVE_OPEN_DRAIN:\n\t\t\tval = param_val ? 0 : 1;\n\t\t\tret = regmap_update_bits(mpci->rmap,\n\t\t\t\t\t\t MAX77620_REG_GPIO0 + pin,\n\t\t\t\t\t\t MAX77620_CNFG_GPIO_DRV_MASK,\n\t\t\t\t\t\t val);\n\t\t\tif (ret)\n\t\t\t\tgoto report_update_failure;\n\n\t\t\tmpci->pin_info[pin].drv_type = val ?\n\t\t\t\tMAX77620_PIN_PP_DRV : MAX77620_PIN_OD_DRV;\n\t\t\tbreak;\n\n\t\tcase PIN_CONFIG_DRIVE_PUSH_PULL:\n\t\t\tval = param_val ? 1 : 0;\n\t\t\tret = regmap_update_bits(mpci->rmap,\n\t\t\t\t\t\t MAX77620_REG_GPIO0 + pin,\n\t\t\t\t\t\t MAX77620_CNFG_GPIO_DRV_MASK,\n\t\t\t\t\t\t val);\n\t\t\tif (ret)\n\t\t\t\tgoto report_update_failure;\n\n\t\t\tmpci->pin_info[pin].drv_type = val ?\n\t\t\t\tMAX77620_PIN_PP_DRV : MAX77620_PIN_OD_DRV;\n\t\t\tbreak;\n\n\t\tcase MAX77620_ACTIVE_FPS_SOURCE:\n\t\tcase MAX77620_ACTIVE_FPS_POWER_ON_SLOTS:\n\t\tcase MAX77620_ACTIVE_FPS_POWER_DOWN_SLOTS:\n\t\t\tif ((pin < MAX77620_GPIO1) || (pin > MAX77620_GPIO3))\n\t\t\t\treturn -EINVAL;\n\n\t\t\tfps_config = &mpci->fps_config[pin];\n\n\t\t\tif ((param == MAX77620_ACTIVE_FPS_SOURCE) &&\n\t\t\t    (param_val == MAX77620_FPS_SRC_DEF)) {\n\t\t\t\taddr = MAX77620_REG_FPS_GPIO1 + pin - 1;\n\t\t\t\tret = max77620_get_default_fps(\n\t\t\t\t\t\tmpci, addr,\n\t\t\t\t\t\t&fps_config->active_fps_src);\n\t\t\t\tif (ret < 0)\n\t\t\t\t\treturn ret;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (param == MAX77620_ACTIVE_FPS_SOURCE)\n\t\t\t\tfps_config->active_fps_src = param_val;\n\t\t\telse if (param == MAX77620_ACTIVE_FPS_POWER_ON_SLOTS)\n\t\t\t\tfps_config->active_power_up_slots = param_val;\n\t\t\telse\n\t\t\t\tfps_config->active_power_down_slots = param_val;\n\n\t\t\tret = max77620_set_fps_param(mpci, pin, param);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t\tbreak;\n\n\t\tcase MAX77620_SUSPEND_FPS_SOURCE:\n\t\tcase MAX77620_SUSPEND_FPS_POWER_ON_SLOTS:\n\t\tcase MAX77620_SUSPEND_FPS_POWER_DOWN_SLOTS:\n\t\t\tif ((pin < MAX77620_GPIO1) || (pin > MAX77620_GPIO3))\n\t\t\t\treturn -EINVAL;\n\n\t\t\tfps_config = &mpci->fps_config[pin];\n\n\t\t\tif ((param == MAX77620_SUSPEND_FPS_SOURCE) &&\n\t\t\t    (param_val == MAX77620_FPS_SRC_DEF)) {\n\t\t\t\taddr = MAX77620_REG_FPS_GPIO1 + pin - 1;\n\t\t\t\tret = max77620_get_default_fps(\n\t\t\t\t\t\tmpci, addr,\n\t\t\t\t\t\t&fps_config->suspend_fps_src);\n\t\t\t\tif (ret < 0)\n\t\t\t\t\treturn ret;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (param == MAX77620_SUSPEND_FPS_SOURCE)\n\t\t\t\tfps_config->suspend_fps_src = param_val;\n\t\t\telse if (param == MAX77620_SUSPEND_FPS_POWER_ON_SLOTS)\n\t\t\t\tfps_config->suspend_power_up_slots = param_val;\n\t\t\telse\n\t\t\t\tfps_config->suspend_power_down_slots =\n\t\t\t\t\t\t\t\tparam_val;\n\t\t\tbreak;\n\n\t\tcase PIN_CONFIG_BIAS_PULL_UP:\n\t\tcase PIN_CONFIG_BIAS_PULL_DOWN:\n\t\t\tpu_val = (param == PIN_CONFIG_BIAS_PULL_UP) ?\n\t\t\t\t\t\t\tBIT(pin) : 0;\n\t\t\tpd_val = (param == PIN_CONFIG_BIAS_PULL_DOWN) ?\n\t\t\t\t\t\t\tBIT(pin) : 0;\n\n\t\t\tret = regmap_update_bits(mpci->rmap,\n\t\t\t\t\t\t MAX77620_REG_PUE_GPIO,\n\t\t\t\t\t\t BIT(pin), pu_val);\n\t\t\tif (ret < 0) {\n\t\t\t\tdev_err(dev, \"PUE_GPIO update failed: %d\\n\",\n\t\t\t\t\tret);\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tret = regmap_update_bits(mpci->rmap,\n\t\t\t\t\t\t MAX77620_REG_PDE_GPIO,\n\t\t\t\t\t\t BIT(pin), pd_val);\n\t\t\tif (ret < 0) {\n\t\t\t\tdev_err(dev, \"PDE_GPIO update failed: %d\\n\",\n\t\t\t\t\tret);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tdev_err(dev, \"Properties not supported\\n\");\n\t\t\treturn -ENOTSUPP;\n\t\t}\n\t}\n\n\treturn 0;\n\nreport_update_failure:\n\tdev_err(dev, \"Reg 0x%02x update failed %d\\n\",\n\t\tMAX77620_REG_GPIO0 + pin, ret);\n\treturn ret;\n}\n\nstatic const struct pinconf_ops max77620_pinconf_ops = {\n\t.pin_config_get = max77620_pinconf_get,\n\t.pin_config_set = max77620_pinconf_set,\n};\n\nstatic struct pinctrl_desc max77620_pinctrl_desc = {\n\t.pctlops = &max77620_pinctrl_ops,\n\t.pmxops = &max77620_pinmux_ops,\n\t.confops = &max77620_pinconf_ops,\n};\n\nstatic int max77620_pinctrl_probe(struct platform_device *pdev)\n{\n\tstruct max77620_chip *max77620 = dev_get_drvdata(pdev->dev.parent);\n\tstruct max77620_pctrl_info *mpci;\n\tint i;\n\n\tdevice_set_node(&pdev->dev, dev_fwnode(pdev->dev.parent));\n\n\tmpci = devm_kzalloc(&pdev->dev, sizeof(*mpci), GFP_KERNEL);\n\tif (!mpci)\n\t\treturn -ENOMEM;\n\n\tmpci->dev = &pdev->dev;\n\tmpci->rmap = max77620->rmap;\n\n\tmpci->pins = max77620_pins_desc;\n\tmpci->num_pins = ARRAY_SIZE(max77620_pins_desc);\n\tmpci->functions = max77620_pin_function;\n\tmpci->num_functions = ARRAY_SIZE(max77620_pin_function);\n\tmpci->pin_groups = max77620_pingroups;\n\tmpci->num_pin_groups = ARRAY_SIZE(max77620_pingroups);\n\tplatform_set_drvdata(pdev, mpci);\n\n\tmax77620_pinctrl_desc.name = dev_name(&pdev->dev);\n\tmax77620_pinctrl_desc.pins = max77620_pins_desc;\n\tmax77620_pinctrl_desc.npins = ARRAY_SIZE(max77620_pins_desc);\n\tmax77620_pinctrl_desc.num_custom_params =\n\t\t\t\tARRAY_SIZE(max77620_cfg_params);\n\tmax77620_pinctrl_desc.custom_params = max77620_cfg_params;\n\n\tfor (i = 0; i < MAX77620_PIN_NUM; ++i) {\n\t\tmpci->fps_config[i].active_fps_src = -1;\n\t\tmpci->fps_config[i].active_power_up_slots = -1;\n\t\tmpci->fps_config[i].active_power_down_slots = -1;\n\t\tmpci->fps_config[i].suspend_fps_src = -1;\n\t\tmpci->fps_config[i].suspend_power_up_slots = -1;\n\t\tmpci->fps_config[i].suspend_power_down_slots = -1;\n\t}\n\n\tmpci->pctl = devm_pinctrl_register(&pdev->dev, &max77620_pinctrl_desc,\n\t\t\t\t\t   mpci);\n\tif (IS_ERR(mpci->pctl)) {\n\t\tdev_err(&pdev->dev, \"Couldn't register pinctrl driver\\n\");\n\t\treturn PTR_ERR(mpci->pctl);\n\t}\n\n\treturn 0;\n}\n\n#ifdef CONFIG_PM_SLEEP\nstatic int max77620_suspend_fps_param[] = {\n\tMAX77620_SUSPEND_FPS_SOURCE,\n\tMAX77620_SUSPEND_FPS_POWER_ON_SLOTS,\n\tMAX77620_SUSPEND_FPS_POWER_DOWN_SLOTS,\n};\n\nstatic int max77620_active_fps_param[] = {\n\tMAX77620_ACTIVE_FPS_SOURCE,\n\tMAX77620_ACTIVE_FPS_POWER_ON_SLOTS,\n\tMAX77620_ACTIVE_FPS_POWER_DOWN_SLOTS,\n};\n\nstatic int max77620_pinctrl_suspend(struct device *dev)\n{\n\tstruct max77620_pctrl_info *mpci = dev_get_drvdata(dev);\n\tint pin, p;\n\n\tfor (pin = 0; pin < MAX77620_PIN_NUM; ++pin) {\n\t\tif ((pin < MAX77620_GPIO1) || (pin > MAX77620_GPIO3))\n\t\t\tcontinue;\n\t\tfor (p = 0; p < 3; ++p)\n\t\t\tmax77620_set_fps_param(\n\t\t\t\tmpci, pin, max77620_suspend_fps_param[p]);\n\t}\n\n\treturn 0;\n};\n\nstatic int max77620_pinctrl_resume(struct device *dev)\n{\n\tstruct max77620_pctrl_info *mpci = dev_get_drvdata(dev);\n\tint pin, p;\n\n\tfor (pin = 0; pin < MAX77620_PIN_NUM; ++pin) {\n\t\tif ((pin < MAX77620_GPIO1) || (pin > MAX77620_GPIO3))\n\t\t\tcontinue;\n\t\tfor (p = 0; p < 3; ++p)\n\t\t\tmax77620_set_fps_param(\n\t\t\t\tmpci, pin, max77620_active_fps_param[p]);\n\t}\n\n\treturn 0;\n}\n#endif\n\nstatic const struct dev_pm_ops max77620_pinctrl_pm_ops = {\n\tSET_SYSTEM_SLEEP_PM_OPS(\n\t\tmax77620_pinctrl_suspend, max77620_pinctrl_resume)\n};\n\nstatic const struct platform_device_id max77620_pinctrl_devtype[] = {\n\t{ .name = \"max77620-pinctrl\", },\n\t{ .name = \"max20024-pinctrl\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(platform, max77620_pinctrl_devtype);\n\nstatic struct platform_driver max77620_pinctrl_driver = {\n\t.driver = {\n\t\t.name = \"max77620-pinctrl\",\n\t\t.pm = &max77620_pinctrl_pm_ops,\n\t},\n\t.probe = max77620_pinctrl_probe,\n\t.id_table = max77620_pinctrl_devtype,\n};\n\nmodule_platform_driver(max77620_pinctrl_driver);\n\nMODULE_DESCRIPTION(\"MAX77620/MAX20024 pin control driver\");\nMODULE_AUTHOR(\"Chaitanya Bandi<bandik@nvidia.com>\");\nMODULE_AUTHOR(\"Laxman Dewangan<ldewangan@nvidia.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}