{
  "module_name": "pinctrl-starfive-jh7110-aon.c",
  "hash_id": "1be5575c8da9f9e9251cc10bfb1742829b89aafb5b67f347cd8d9e9249ce3473",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/starfive/pinctrl-starfive-jh7110-aon.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/gpio/driver.h>\n#include <linux/init.h>\n#include <linux/interrupt.h>\n#include <linux/io.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/pinctrl/pinconf.h>\n#include <linux/pinctrl/pinconf-generic.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinmux.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n\n#include <dt-bindings/pinctrl/starfive,jh7110-pinctrl.h>\n\n#include \"../core.h\"\n#include \"../pinconf.h\"\n#include \"../pinmux.h\"\n#include \"pinctrl-starfive-jh7110.h\"\n\n#define JH7110_AON_NGPIO\t\t4\n#define JH7110_AON_GC_BASE\t\t64\n\n#define JH7110_AON_REGS_NUM\t\t37\n\n \n#define JH7110_AON_DOEN\t\t\t0x0\n#define JH7110_AON_DOUT\t\t\t0x4\n#define JH7110_AON_GPI\t\t\t0x8\n#define JH7110_AON_GPIOIN\t\t0x2c\n\n#define JH7110_AON_GPIOEN\t\t0xc\n#define JH7110_AON_GPIOIS\t\t0x10\n#define JH7110_AON_GPIOIC\t\t0x14\n#define JH7110_AON_GPIOIBE\t\t0x18\n#define JH7110_AON_GPIOIEV\t\t0x1c\n#define JH7110_AON_GPIOIE\t\t0x20\n#define JH7110_AON_GPIORIS\t\t0x28\n#define JH7110_AON_GPIOMIS\t\t0x28\n\n#define JH7110_AON_GPO_PDA_0_5_CFG\t0x30\n\nstatic const struct pinctrl_pin_desc jh7110_aon_pins[] = {\n\tPINCTRL_PIN(PAD_TESTEN,\t\t\"TESTEN\"),\n\tPINCTRL_PIN(PAD_RGPIO0,\t\t\"RGPIO0\"),\n\tPINCTRL_PIN(PAD_RGPIO1,\t\t\"RGPIO1\"),\n\tPINCTRL_PIN(PAD_RGPIO2,\t\t\"RGPIO2\"),\n\tPINCTRL_PIN(PAD_RGPIO3,\t\t\"RGPIO3\"),\n\tPINCTRL_PIN(PAD_RSTN,\t\t\"RSTN\"),\n\tPINCTRL_PIN(PAD_GMAC0_MDC,\t\"GMAC0_MDC\"),\n\tPINCTRL_PIN(PAD_GMAC0_MDIO,\t\"GMAC0_MDIO\"),\n\tPINCTRL_PIN(PAD_GMAC0_RXD0,\t\"GMAC0_RXD0\"),\n\tPINCTRL_PIN(PAD_GMAC0_RXD1,\t\"GMAC0_RXD1\"),\n\tPINCTRL_PIN(PAD_GMAC0_RXD2,\t\"GMAC0_RXD2\"),\n\tPINCTRL_PIN(PAD_GMAC0_RXD3,\t\"GMAC0_RXD3\"),\n\tPINCTRL_PIN(PAD_GMAC0_RXDV,\t\"GMAC0_RXDV\"),\n\tPINCTRL_PIN(PAD_GMAC0_RXC,\t\"GMAC0_RXC\"),\n\tPINCTRL_PIN(PAD_GMAC0_TXD0,\t\"GMAC0_TXD0\"),\n\tPINCTRL_PIN(PAD_GMAC0_TXD1,\t\"GMAC0_TXD1\"),\n\tPINCTRL_PIN(PAD_GMAC0_TXD2,\t\"GMAC0_TXD2\"),\n\tPINCTRL_PIN(PAD_GMAC0_TXD3,\t\"GMAC0_TXD3\"),\n\tPINCTRL_PIN(PAD_GMAC0_TXEN,\t\"GMAC0_TXEN\"),\n\tPINCTRL_PIN(PAD_GMAC0_TXC,\t\"GMAC0_TXC\"),\n};\n\nstatic int jh7110_aon_set_one_pin_mux(struct jh7110_pinctrl *sfp,\n\t\t\t\t      unsigned int pin,\n\t\t\t\t      unsigned int din, u32 dout,\n\t\t\t\t      u32 doen, u32 func)\n{\n\tif (pin < sfp->gc.ngpio && func == 0)\n\t\tjh7110_set_gpiomux(sfp, pin, din, dout, doen);\n\n\treturn 0;\n}\n\nstatic int jh7110_aon_get_padcfg_base(struct jh7110_pinctrl *sfp,\n\t\t\t\t      unsigned int pin)\n{\n\tif (pin < PAD_GMAC0_MDC)\n\t\treturn JH7110_AON_GPO_PDA_0_5_CFG;\n\n\treturn -1;\n}\n\nstatic void jh7110_aon_irq_handler(struct irq_desc *desc)\n{\n\tstruct jh7110_pinctrl *sfp = jh7110_from_irq_desc(desc);\n\tstruct irq_chip *chip = irq_desc_get_chip(desc);\n\tunsigned long mis;\n\tunsigned int pin;\n\n\tchained_irq_enter(chip, desc);\n\n\tmis = readl_relaxed(sfp->base + JH7110_AON_GPIOMIS);\n\tfor_each_set_bit(pin, &mis, JH7110_AON_NGPIO)\n\t\tgeneric_handle_domain_irq(sfp->gc.irq.domain, pin);\n\n\tchained_irq_exit(chip, desc);\n}\n\nstatic int jh7110_aon_init_hw(struct gpio_chip *gc)\n{\n\tstruct jh7110_pinctrl *sfp = container_of(gc,\n\t\t\tstruct jh7110_pinctrl, gc);\n\n\t \n\twritel_relaxed(0, sfp->base + JH7110_AON_GPIOIE);\n\t \n\twritel_relaxed(0, sfp->base + JH7110_AON_GPIOIC);\n\twritel_relaxed(0x0f, sfp->base + JH7110_AON_GPIOIC);\n\t \n\twritel_relaxed(1, sfp->base + JH7110_AON_GPIOEN);\n\treturn 0;\n}\n\nstatic const struct jh7110_gpio_irq_reg jh7110_aon_irq_reg = {\n\t.is_reg_base\t= JH7110_AON_GPIOIS,\n\t.ic_reg_base\t= JH7110_AON_GPIOIC,\n\t.ibe_reg_base\t= JH7110_AON_GPIOIBE,\n\t.iev_reg_base\t= JH7110_AON_GPIOIEV,\n\t.ie_reg_base\t= JH7110_AON_GPIOIE,\n\t.ris_reg_base\t= JH7110_AON_GPIORIS,\n\t.mis_reg_base\t= JH7110_AON_GPIOMIS,\n};\n\nstatic const struct jh7110_pinctrl_soc_info jh7110_aon_pinctrl_info = {\n\t.pins\t\t= jh7110_aon_pins,\n\t.npins\t\t= ARRAY_SIZE(jh7110_aon_pins),\n\t.ngpios\t\t= JH7110_AON_NGPIO,\n\t.gc_base\t= JH7110_AON_GC_BASE,\n\t.dout_reg_base\t= JH7110_AON_DOUT,\n\t.dout_mask\t= GENMASK(3, 0),\n\t.doen_reg_base\t= JH7110_AON_DOEN,\n\t.doen_mask\t= GENMASK(2, 0),\n\t.gpi_reg_base\t= JH7110_AON_GPI,\n\t.gpi_mask\t= GENMASK(3, 0),\n\t.gpioin_reg_base\t   = JH7110_AON_GPIOIN,\n\t.irq_reg\t\t   = &jh7110_aon_irq_reg,\n\t.nsaved_regs\t\t   = JH7110_AON_REGS_NUM,\n\t.jh7110_set_one_pin_mux  = jh7110_aon_set_one_pin_mux,\n\t.jh7110_get_padcfg_base  = jh7110_aon_get_padcfg_base,\n\t.jh7110_gpio_irq_handler = jh7110_aon_irq_handler,\n\t.jh7110_gpio_init_hw\t = jh7110_aon_init_hw,\n};\n\nstatic const struct of_device_id jh7110_aon_pinctrl_of_match[] = {\n\t{\n\t\t.compatible = \"starfive,jh7110-aon-pinctrl\",\n\t\t.data = &jh7110_aon_pinctrl_info,\n\t},\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, jh7110_aon_pinctrl_of_match);\n\nstatic struct platform_driver jh7110_aon_pinctrl_driver = {\n\t.probe = jh7110_pinctrl_probe,\n\t.driver = {\n\t\t.name = \"starfive-jh7110-aon-pinctrl\",\n\t\t.of_match_table = jh7110_aon_pinctrl_of_match,\n\t\t.pm = pm_sleep_ptr(&jh7110_pinctrl_pm_ops),\n\t},\n};\nmodule_platform_driver(jh7110_aon_pinctrl_driver);\n\nMODULE_DESCRIPTION(\"Pinctrl driver for the StarFive JH7110 SoC aon controller\");\nMODULE_AUTHOR(\"Jianlong Huang <jianlong.huang@starfivetech.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}