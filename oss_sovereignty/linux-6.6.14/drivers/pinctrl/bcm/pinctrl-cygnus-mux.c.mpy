{
  "module_name": "pinctrl-cygnus-mux.c",
  "hash_id": "8d284201e63c237d083cb158757fcb6cfb1e5e03f643ef9da4abf051cb23bec3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/bcm/pinctrl-cygnus-mux.c",
  "human_readable_source": "\n\n\n \n\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/seq_file.h>\n#include <linux/slab.h>\n\n#include <linux/pinctrl/pinconf-generic.h>\n#include <linux/pinctrl/pinconf.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinmux.h>\n\n#include \"../core.h\"\n#include \"../pinctrl-utils.h\"\n\n#define CYGNUS_NUM_IOMUX_REGS     8\n#define CYGNUS_NUM_MUX_PER_REG    8\n#define CYGNUS_NUM_IOMUX          (CYGNUS_NUM_IOMUX_REGS * \\\n\t\t\t\t   CYGNUS_NUM_MUX_PER_REG)\n\n \nstruct cygnus_mux {\n\tunsigned int offset;\n\tunsigned int shift;\n\tunsigned int alt;\n};\n\n \nstruct cygnus_mux_log {\n\tstruct cygnus_mux mux;\n\tbool is_configured;\n};\n\n \nstruct cygnus_pin_group {\n\tconst char *name;\n\tconst unsigned *pins;\n\tunsigned num_pins;\n\tstruct cygnus_mux mux;\n};\n\n \nstruct cygnus_pin_function {\n\tconst char *name;\n\tconst char * const *groups;\n\tunsigned num_groups;\n};\n\n \nstruct cygnus_pinctrl {\n\tstruct pinctrl_dev *pctl;\n\tstruct device *dev;\n\tvoid __iomem *base0;\n\tvoid __iomem *base1;\n\n\tconst struct cygnus_pin_group *groups;\n\tunsigned num_groups;\n\n\tconst struct cygnus_pin_function *functions;\n\tunsigned num_functions;\n\n\tstruct cygnus_mux_log *mux_log;\n\n\tspinlock_t lock;\n};\n\n \nstruct cygnus_gpio_mux {\n\tint is_supported;\n\tunsigned int offset;\n\tunsigned int shift;\n};\n\n \nstruct cygnus_pin {\n\tunsigned pin;\n\tchar *name;\n\tstruct cygnus_gpio_mux gpio_mux;\n};\n\n#define CYGNUS_PIN_DESC(p, n, i, o, s)\t\\\n{\t\t\t\t\t\\\n\t.pin = p,\t\t\t\\\n\t.name = n,\t\t\t\\\n\t.gpio_mux = {\t\t\t\\\n\t\t.is_supported = i,\t\\\n\t\t.offset = o,\t\t\\\n\t\t.shift = s,\t\t\\\n\t},\t\t\t\t\\\n}\n\n \nstatic struct cygnus_pin cygnus_pins[] = {\n\tCYGNUS_PIN_DESC(0, \"ext_device_reset_n\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(1, \"chip_mode0\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(2, \"chip_mode1\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(3, \"chip_mode2\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(4, \"chip_mode3\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(5, \"chip_mode4\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(6, \"bsc0_scl\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(7, \"bsc0_sda\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(8, \"bsc1_scl\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(9, \"bsc1_sda\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(10, \"d1w_dq\", 1, 0x28, 0),\n\tCYGNUS_PIN_DESC(11, \"d1wowstz_l\", 1, 0x4, 28),\n\tCYGNUS_PIN_DESC(12, \"gpio0\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(13, \"gpio1\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(14, \"gpio2\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(15, \"gpio3\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(16, \"gpio4\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(17, \"gpio5\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(18, \"gpio6\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(19, \"gpio7\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(20, \"gpio8\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(21, \"gpio9\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(22, \"gpio10\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(23, \"gpio11\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(24, \"gpio12\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(25, \"gpio13\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(26, \"gpio14\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(27, \"gpio15\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(28, \"gpio16\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(29, \"gpio17\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(30, \"gpio18\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(31, \"gpio19\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(32, \"gpio20\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(33, \"gpio21\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(34, \"gpio22\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(35, \"gpio23\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(36, \"mdc\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(37, \"mdio\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(38, \"pwm0\", 1, 0x10, 30),\n\tCYGNUS_PIN_DESC(39, \"pwm1\", 1, 0x10, 28),\n\tCYGNUS_PIN_DESC(40, \"pwm2\", 1, 0x10, 26),\n\tCYGNUS_PIN_DESC(41, \"pwm3\", 1, 0x10, 24),\n\tCYGNUS_PIN_DESC(42, \"sc0_clk\", 1, 0x10, 22),\n\tCYGNUS_PIN_DESC(43, \"sc0_cmdvcc_l\", 1, 0x10, 20),\n\tCYGNUS_PIN_DESC(44, \"sc0_detect\", 1, 0x10, 18),\n\tCYGNUS_PIN_DESC(45, \"sc0_fcb\", 1, 0x10, 16),\n\tCYGNUS_PIN_DESC(46, \"sc0_io\", 1, 0x10, 14),\n\tCYGNUS_PIN_DESC(47, \"sc0_rst_l\", 1, 0x10, 12),\n\tCYGNUS_PIN_DESC(48, \"sc1_clk\", 1, 0x10, 10),\n\tCYGNUS_PIN_DESC(49, \"sc1_cmdvcc_l\", 1, 0x10, 8),\n\tCYGNUS_PIN_DESC(50, \"sc1_detect\", 1, 0x10, 6),\n\tCYGNUS_PIN_DESC(51, \"sc1_fcb\", 1, 0x10, 4),\n\tCYGNUS_PIN_DESC(52, \"sc1_io\", 1, 0x10, 2),\n\tCYGNUS_PIN_DESC(53, \"sc1_rst_l\", 1, 0x10, 0),\n\tCYGNUS_PIN_DESC(54, \"spi0_clk\", 1, 0x18, 10),\n\tCYGNUS_PIN_DESC(55, \"spi0_mosi\", 1, 0x18, 6),\n\tCYGNUS_PIN_DESC(56, \"spi0_miso\", 1, 0x18, 8),\n\tCYGNUS_PIN_DESC(57, \"spi0_ss\", 1, 0x18, 4),\n\tCYGNUS_PIN_DESC(58, \"spi1_clk\", 1, 0x18, 2),\n\tCYGNUS_PIN_DESC(59, \"spi1_mosi\", 1, 0x1c, 30),\n\tCYGNUS_PIN_DESC(60, \"spi1_miso\", 1, 0x18, 0),\n\tCYGNUS_PIN_DESC(61, \"spi1_ss\", 1, 0x1c, 28),\n\tCYGNUS_PIN_DESC(62, \"spi2_clk\", 1, 0x1c, 26),\n\tCYGNUS_PIN_DESC(63, \"spi2_mosi\", 1, 0x1c, 22),\n\tCYGNUS_PIN_DESC(64, \"spi2_miso\", 1, 0x1c, 24),\n\tCYGNUS_PIN_DESC(65, \"spi2_ss\", 1, 0x1c, 20),\n\tCYGNUS_PIN_DESC(66, \"spi3_clk\", 1, 0x1c, 18),\n\tCYGNUS_PIN_DESC(67, \"spi3_mosi\", 1, 0x1c, 14),\n\tCYGNUS_PIN_DESC(68, \"spi3_miso\", 1, 0x1c, 16),\n\tCYGNUS_PIN_DESC(69, \"spi3_ss\", 1, 0x1c, 12),\n\tCYGNUS_PIN_DESC(70, \"uart0_cts\", 1, 0x1c, 10),\n\tCYGNUS_PIN_DESC(71, \"uart0_rts\", 1, 0x1c, 8),\n\tCYGNUS_PIN_DESC(72, \"uart0_rx\", 1, 0x1c, 6),\n\tCYGNUS_PIN_DESC(73, \"uart0_tx\", 1, 0x1c, 4),\n\tCYGNUS_PIN_DESC(74, \"uart1_cts\", 1, 0x1c, 2),\n\tCYGNUS_PIN_DESC(75, \"uart1_dcd\", 1, 0x1c, 0),\n\tCYGNUS_PIN_DESC(76, \"uart1_dsr\", 1, 0x20, 14),\n\tCYGNUS_PIN_DESC(77, \"uart1_dtr\", 1, 0x20, 12),\n\tCYGNUS_PIN_DESC(78, \"uart1_ri\", 1, 0x20, 10),\n\tCYGNUS_PIN_DESC(79, \"uart1_rts\", 1, 0x20, 8),\n\tCYGNUS_PIN_DESC(80, \"uart1_rx\", 1, 0x20, 6),\n\tCYGNUS_PIN_DESC(81, \"uart1_tx\", 1, 0x20, 4),\n\tCYGNUS_PIN_DESC(82, \"uart3_rx\", 1, 0x20, 2),\n\tCYGNUS_PIN_DESC(83, \"uart3_tx\", 1, 0x20, 0),\n\tCYGNUS_PIN_DESC(84, \"sdio1_clk_sdcard\", 1, 0x14, 6),\n\tCYGNUS_PIN_DESC(85, \"sdio1_cmd\", 1, 0x14, 4),\n\tCYGNUS_PIN_DESC(86, \"sdio1_data0\", 1, 0x14, 2),\n\tCYGNUS_PIN_DESC(87, \"sdio1_data1\", 1, 0x14, 0),\n\tCYGNUS_PIN_DESC(88, \"sdio1_data2\", 1, 0x18, 30),\n\tCYGNUS_PIN_DESC(89, \"sdio1_data3\", 1, 0x18, 28),\n\tCYGNUS_PIN_DESC(90, \"sdio1_wp_n\", 1, 0x18, 24),\n\tCYGNUS_PIN_DESC(91, \"sdio1_card_rst\", 1, 0x14, 10),\n\tCYGNUS_PIN_DESC(92, \"sdio1_led_on\", 1, 0x18, 26),\n\tCYGNUS_PIN_DESC(93, \"sdio1_cd\", 1, 0x14, 8),\n\tCYGNUS_PIN_DESC(94, \"sdio0_clk_sdcard\", 1, 0x14, 26),\n\tCYGNUS_PIN_DESC(95, \"sdio0_cmd\", 1, 0x14, 24),\n\tCYGNUS_PIN_DESC(96, \"sdio0_data0\", 1, 0x14, 22),\n\tCYGNUS_PIN_DESC(97, \"sdio0_data1\", 1, 0x14, 20),\n\tCYGNUS_PIN_DESC(98, \"sdio0_data2\", 1, 0x14, 18),\n\tCYGNUS_PIN_DESC(99, \"sdio0_data3\", 1, 0x14, 16),\n\tCYGNUS_PIN_DESC(100, \"sdio0_wp_n\", 1, 0x14, 12),\n\tCYGNUS_PIN_DESC(101, \"sdio0_card_rst\", 1, 0x14, 30),\n\tCYGNUS_PIN_DESC(102, \"sdio0_led_on\", 1, 0x14, 14),\n\tCYGNUS_PIN_DESC(103, \"sdio0_cd\", 1, 0x14, 28),\n\tCYGNUS_PIN_DESC(104, \"sflash_clk\", 1, 0x18, 22),\n\tCYGNUS_PIN_DESC(105, \"sflash_cs_l\", 1, 0x18, 20),\n\tCYGNUS_PIN_DESC(106, \"sflash_mosi\", 1, 0x18, 14),\n\tCYGNUS_PIN_DESC(107, \"sflash_miso\", 1, 0x18, 16),\n\tCYGNUS_PIN_DESC(108, \"sflash_wp_n\", 1, 0x18, 12),\n\tCYGNUS_PIN_DESC(109, \"sflash_hold_n\", 1, 0x18, 18),\n\tCYGNUS_PIN_DESC(110, \"nand_ale\", 1, 0xc, 30),\n\tCYGNUS_PIN_DESC(111, \"nand_ce0_l\", 1, 0xc, 28),\n\tCYGNUS_PIN_DESC(112, \"nand_ce1_l\", 1, 0xc, 26),\n\tCYGNUS_PIN_DESC(113, \"nand_cle\", 1, 0xc, 24),\n\tCYGNUS_PIN_DESC(114, \"nand_dq0\", 1, 0xc, 22),\n\tCYGNUS_PIN_DESC(115, \"nand_dq1\", 1, 0xc, 20),\n\tCYGNUS_PIN_DESC(116, \"nand_dq2\", 1, 0xc, 18),\n\tCYGNUS_PIN_DESC(117, \"nand_dq3\", 1, 0xc, 16),\n\tCYGNUS_PIN_DESC(118, \"nand_dq4\", 1, 0xc, 14),\n\tCYGNUS_PIN_DESC(119, \"nand_dq5\", 1, 0xc, 12),\n\tCYGNUS_PIN_DESC(120, \"nand_dq6\", 1, 0xc, 10),\n\tCYGNUS_PIN_DESC(121, \"nand_dq7\", 1, 0xc, 8),\n\tCYGNUS_PIN_DESC(122, \"nand_rb_l\", 1, 0xc, 6),\n\tCYGNUS_PIN_DESC(123, \"nand_re_l\", 1, 0xc, 4),\n\tCYGNUS_PIN_DESC(124, \"nand_we_l\", 1, 0xc, 2),\n\tCYGNUS_PIN_DESC(125, \"nand_wp_l\", 1, 0xc, 0),\n\tCYGNUS_PIN_DESC(126, \"lcd_clac\", 1, 0x4, 26),\n\tCYGNUS_PIN_DESC(127, \"lcd_clcp\", 1, 0x4, 24),\n\tCYGNUS_PIN_DESC(128, \"lcd_cld0\", 1, 0x4, 22),\n\tCYGNUS_PIN_DESC(129, \"lcd_cld1\", 1, 0x4, 0),\n\tCYGNUS_PIN_DESC(130, \"lcd_cld10\", 1, 0x4, 20),\n\tCYGNUS_PIN_DESC(131, \"lcd_cld11\", 1, 0x4, 18),\n\tCYGNUS_PIN_DESC(132, \"lcd_cld12\", 1, 0x4, 16),\n\tCYGNUS_PIN_DESC(133, \"lcd_cld13\", 1, 0x4, 14),\n\tCYGNUS_PIN_DESC(134, \"lcd_cld14\", 1, 0x4, 12),\n\tCYGNUS_PIN_DESC(135, \"lcd_cld15\", 1, 0x4, 10),\n\tCYGNUS_PIN_DESC(136, \"lcd_cld16\", 1, 0x4, 8),\n\tCYGNUS_PIN_DESC(137, \"lcd_cld17\", 1, 0x4, 6),\n\tCYGNUS_PIN_DESC(138, \"lcd_cld18\", 1, 0x4, 4),\n\tCYGNUS_PIN_DESC(139, \"lcd_cld19\", 1, 0x4, 2),\n\tCYGNUS_PIN_DESC(140, \"lcd_cld2\", 1, 0x8, 22),\n\tCYGNUS_PIN_DESC(141, \"lcd_cld20\", 1, 0x8, 30),\n\tCYGNUS_PIN_DESC(142, \"lcd_cld21\", 1, 0x8, 28),\n\tCYGNUS_PIN_DESC(143, \"lcd_cld22\", 1, 0x8, 26),\n\tCYGNUS_PIN_DESC(144, \"lcd_cld23\", 1, 0x8, 24),\n\tCYGNUS_PIN_DESC(145, \"lcd_cld3\", 1, 0x8, 20),\n\tCYGNUS_PIN_DESC(146, \"lcd_cld4\", 1, 0x8, 18),\n\tCYGNUS_PIN_DESC(147, \"lcd_cld5\", 1, 0x8, 16),\n\tCYGNUS_PIN_DESC(148, \"lcd_cld6\", 1, 0x8, 14),\n\tCYGNUS_PIN_DESC(149, \"lcd_cld7\", 1, 0x8, 12),\n\tCYGNUS_PIN_DESC(150, \"lcd_cld8\", 1, 0x8, 10),\n\tCYGNUS_PIN_DESC(151, \"lcd_cld9\", 1, 0x8, 8),\n\tCYGNUS_PIN_DESC(152, \"lcd_clfp\", 1, 0x8, 6),\n\tCYGNUS_PIN_DESC(153, \"lcd_clle\", 1, 0x8, 4),\n\tCYGNUS_PIN_DESC(154, \"lcd_cllp\", 1, 0x8, 2),\n\tCYGNUS_PIN_DESC(155, \"lcd_clpower\", 1, 0x8, 0),\n\tCYGNUS_PIN_DESC(156, \"camera_vsync\", 1, 0x4, 30),\n\tCYGNUS_PIN_DESC(157, \"camera_trigger\", 1, 0x0, 0),\n\tCYGNUS_PIN_DESC(158, \"camera_strobe\", 1, 0x0, 2),\n\tCYGNUS_PIN_DESC(159, \"camera_standby\", 1, 0x0, 4),\n\tCYGNUS_PIN_DESC(160, \"camera_reset_n\", 1, 0x0, 6),\n\tCYGNUS_PIN_DESC(161, \"camera_pixdata9\", 1, 0x0, 8),\n\tCYGNUS_PIN_DESC(162, \"camera_pixdata8\", 1, 0x0, 10),\n\tCYGNUS_PIN_DESC(163, \"camera_pixdata7\", 1, 0x0, 12),\n\tCYGNUS_PIN_DESC(164, \"camera_pixdata6\", 1, 0x0, 14),\n\tCYGNUS_PIN_DESC(165, \"camera_pixdata5\", 1, 0x0, 16),\n\tCYGNUS_PIN_DESC(166, \"camera_pixdata4\", 1, 0x0, 18),\n\tCYGNUS_PIN_DESC(167, \"camera_pixdata3\", 1, 0x0, 20),\n\tCYGNUS_PIN_DESC(168, \"camera_pixdata2\", 1, 0x0, 22),\n\tCYGNUS_PIN_DESC(169, \"camera_pixdata1\", 1, 0x0, 24),\n\tCYGNUS_PIN_DESC(170, \"camera_pixdata0\", 1, 0x0, 26),\n\tCYGNUS_PIN_DESC(171, \"camera_pixclk\", 1, 0x0, 28),\n\tCYGNUS_PIN_DESC(172, \"camera_hsync\", 1, 0x0, 30),\n\tCYGNUS_PIN_DESC(173, \"camera_pll_ref_clk\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(174, \"usb_id_indication\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(175, \"usb_vbus_indication\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(176, \"gpio0_3p3\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(177, \"gpio1_3p3\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(178, \"gpio2_3p3\", 0, 0, 0),\n\tCYGNUS_PIN_DESC(179, \"gpio3_3p3\", 0, 0, 0),\n};\n\n \nstatic const unsigned bsc1_pins[] = { 8, 9 };\nstatic const unsigned pcie_clkreq_pins[] = { 8, 9 };\n\nstatic const unsigned i2s2_0_pins[] = { 12 };\nstatic const unsigned i2s2_1_pins[] = { 13 };\nstatic const unsigned i2s2_2_pins[] = { 14 };\nstatic const unsigned i2s2_3_pins[] = { 15 };\nstatic const unsigned i2s2_4_pins[] = { 16 };\n\nstatic const unsigned pwm4_pins[] = { 17 };\nstatic const unsigned pwm5_pins[] = { 18 };\n\nstatic const unsigned key0_pins[] = { 20 };\nstatic const unsigned key1_pins[] = { 21 };\nstatic const unsigned key2_pins[] = { 22 };\nstatic const unsigned key3_pins[] = { 23 };\nstatic const unsigned key4_pins[] = { 24 };\nstatic const unsigned key5_pins[] = { 25 };\n\nstatic const unsigned key6_pins[] = { 26 };\nstatic const unsigned audio_dte0_pins[] = { 26 };\n\nstatic const unsigned key7_pins[] = { 27 };\nstatic const unsigned audio_dte1_pins[] = { 27 };\n\nstatic const unsigned key8_pins[] = { 28 };\nstatic const unsigned key9_pins[] = { 29 };\nstatic const unsigned key10_pins[] = { 30 };\nstatic const unsigned key11_pins[] = { 31 };\nstatic const unsigned key12_pins[] = { 32 };\nstatic const unsigned key13_pins[] = { 33 };\n\nstatic const unsigned key14_pins[] = { 34 };\nstatic const unsigned audio_dte2_pins[] = { 34 };\n\nstatic const unsigned key15_pins[] = { 35 };\nstatic const unsigned audio_dte3_pins[] = { 35 };\n\nstatic const unsigned pwm0_pins[] = { 38 };\nstatic const unsigned pwm1_pins[] = { 39 };\nstatic const unsigned pwm2_pins[] = { 40 };\nstatic const unsigned pwm3_pins[] = { 41 };\n\nstatic const unsigned sdio0_pins[] = { 94, 95, 96, 97, 98, 99 };\n\nstatic const unsigned smart_card0_pins[] = { 42, 43, 44, 46, 47 };\nstatic const unsigned i2s0_0_pins[] = { 42, 43, 44, 46 };\nstatic const unsigned spdif_pins[] = { 47 };\n\nstatic const unsigned smart_card1_pins[] = { 48, 49, 50, 52, 53 };\nstatic const unsigned i2s1_0_pins[] = { 48, 49, 50, 52 };\n\nstatic const unsigned spi0_pins[] = { 54, 55, 56, 57 };\n\nstatic const unsigned spi1_pins[] = { 58, 59, 60, 61 };\n\nstatic const unsigned spi2_pins[] = { 62, 63, 64, 65 };\n\nstatic const unsigned spi3_pins[] = { 66, 67, 68, 69 };\nstatic const unsigned sw_led0_0_pins[] = { 66, 67, 68, 69 };\n\nstatic const unsigned d1w_pins[] = { 10, 11 };\nstatic const unsigned uart4_pins[] = { 10, 11 };\nstatic const unsigned sw_led2_0_pins[] = { 10, 11 };\n\nstatic const unsigned lcd_pins[] = { 126, 127, 128, 129, 130, 131, 132, 133,\n\t134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147,\n\t148, 149, 150, 151, 152, 153, 154, 155 };\nstatic const unsigned sram_0_pins[] = { 126, 127, 128, 129, 130, 131, 132, 133,\n\t134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147,\n\t148, 149, 150, 151, 152, 153, 154, 155 };\nstatic const unsigned spi5_pins[] = { 141, 142, 143, 144 };\n\nstatic const unsigned uart0_pins[] = { 70, 71, 72, 73 };\nstatic const unsigned sw_led0_1_pins[] = { 70, 71, 72, 73 };\n\nstatic const unsigned uart1_dte_pins[] = { 75, 76, 77, 78 };\nstatic const unsigned uart2_pins[] = { 75, 76, 77, 78 };\n\nstatic const unsigned uart1_pins[] = { 74, 79, 80, 81 };\n\nstatic const unsigned uart3_pins[] = { 82, 83 };\n\nstatic const unsigned qspi_0_pins[] = { 104, 105, 106, 107 };\n\nstatic const unsigned nand_pins[] = { 110, 111, 112, 113, 114, 115, 116, 117,\n\t118, 119, 120, 121, 122, 123, 124, 125 };\n\nstatic const unsigned sdio0_cd_pins[] = { 103 };\n\nstatic const unsigned sdio0_mmc_pins[] = { 100, 101, 102 };\n\nstatic const unsigned sdio1_data_0_pins[] = { 86, 87 };\nstatic const unsigned can0_pins[] = { 86, 87 };\nstatic const unsigned spi4_0_pins[] = { 86, 87 };\n\nstatic const unsigned sdio1_data_1_pins[] = { 88, 89 };\nstatic const unsigned can1_pins[] = { 88, 89 };\nstatic const unsigned spi4_1_pins[] = { 88, 89 };\n\nstatic const unsigned sdio1_cd_pins[] = { 93 };\n\nstatic const unsigned sdio1_led_pins[] = { 84, 85 };\nstatic const unsigned sw_led2_1_pins[] = { 84, 85 };\n\nstatic const unsigned sdio1_mmc_pins[] = { 90, 91, 92 };\n\nstatic const unsigned cam_led_pins[] = { 156, 157, 158, 159, 160 };\nstatic const unsigned sw_led1_pins[] = { 156, 157, 158, 159 };\n\nstatic const unsigned cam_0_pins[] = { 169, 170, 171, 169, 170 };\n\nstatic const unsigned cam_1_pins[] = { 161, 162, 163, 164, 165, 166, 167,\n\t168 };\nstatic const unsigned sram_1_pins[] = { 161, 162, 163, 164, 165, 166, 167,\n\t168 };\n\nstatic const unsigned qspi_1_pins[] = { 108, 109 };\n\nstatic const unsigned smart_card0_fcb_pins[] = { 45 };\nstatic const unsigned i2s0_1_pins[] = { 45 };\n\nstatic const unsigned smart_card1_fcb_pins[] = { 51 };\nstatic const unsigned i2s1_1_pins[] = { 51 };\n\nstatic const unsigned gpio0_3p3_pins[] = { 176 };\nstatic const unsigned usb0_oc_pins[] = { 176 };\n\nstatic const unsigned gpio1_3p3_pins[] = { 177 };\nstatic const unsigned usb1_oc_pins[] = { 177 };\n\nstatic const unsigned gpio2_3p3_pins[] = { 178 };\nstatic const unsigned usb2_oc_pins[] = { 178 };\n\n#define CYGNUS_PIN_GROUP(group_name, off, sh, al)\t\\\n{\t\t\t\t\t\t\t\\\n\t.name = __stringify(group_name) \"_grp\",\t\t\\\n\t.pins = group_name ## _pins,\t\t\t\\\n\t.num_pins = ARRAY_SIZE(group_name ## _pins),\t\\\n\t.mux = {\t\t\t\t\t\\\n\t\t.offset = off,\t\t\t\t\\\n\t\t.shift = sh,\t\t\t\t\\\n\t\t.alt = al,\t\t\t\t\\\n\t}\t\t\t\t\t\t\\\n}\n\n \nstatic const struct cygnus_pin_group cygnus_pin_groups[] = {\n\tCYGNUS_PIN_GROUP(i2s2_0, 0x0, 0, 2),\n\tCYGNUS_PIN_GROUP(i2s2_1, 0x0, 4, 2),\n\tCYGNUS_PIN_GROUP(i2s2_2, 0x0, 8, 2),\n\tCYGNUS_PIN_GROUP(i2s2_3, 0x0, 12, 2),\n\tCYGNUS_PIN_GROUP(i2s2_4, 0x0, 16, 2),\n\tCYGNUS_PIN_GROUP(pwm4, 0x0, 20, 0),\n\tCYGNUS_PIN_GROUP(pwm5, 0x0, 24, 2),\n\tCYGNUS_PIN_GROUP(key0, 0x4, 0, 1),\n\tCYGNUS_PIN_GROUP(key1, 0x4, 4, 1),\n\tCYGNUS_PIN_GROUP(key2, 0x4, 8, 1),\n\tCYGNUS_PIN_GROUP(key3, 0x4, 12, 1),\n\tCYGNUS_PIN_GROUP(key4, 0x4, 16, 1),\n\tCYGNUS_PIN_GROUP(key5, 0x4, 20, 1),\n\tCYGNUS_PIN_GROUP(key6, 0x4, 24, 1),\n\tCYGNUS_PIN_GROUP(audio_dte0, 0x4, 24, 2),\n\tCYGNUS_PIN_GROUP(key7, 0x4, 28, 1),\n\tCYGNUS_PIN_GROUP(audio_dte1, 0x4, 28, 2),\n\tCYGNUS_PIN_GROUP(key8, 0x8, 0, 1),\n\tCYGNUS_PIN_GROUP(key9, 0x8, 4, 1),\n\tCYGNUS_PIN_GROUP(key10, 0x8, 8, 1),\n\tCYGNUS_PIN_GROUP(key11, 0x8, 12, 1),\n\tCYGNUS_PIN_GROUP(key12, 0x8, 16, 1),\n\tCYGNUS_PIN_GROUP(key13, 0x8, 20, 1),\n\tCYGNUS_PIN_GROUP(key14, 0x8, 24, 1),\n\tCYGNUS_PIN_GROUP(audio_dte2, 0x8, 24, 2),\n\tCYGNUS_PIN_GROUP(key15, 0x8, 28, 1),\n\tCYGNUS_PIN_GROUP(audio_dte3, 0x8, 28, 2),\n\tCYGNUS_PIN_GROUP(pwm0, 0xc, 0, 0),\n\tCYGNUS_PIN_GROUP(pwm1, 0xc, 4, 0),\n\tCYGNUS_PIN_GROUP(pwm2, 0xc, 8, 0),\n\tCYGNUS_PIN_GROUP(pwm3, 0xc, 12, 0),\n\tCYGNUS_PIN_GROUP(sdio0, 0xc, 16, 0),\n\tCYGNUS_PIN_GROUP(smart_card0, 0xc, 20, 0),\n\tCYGNUS_PIN_GROUP(i2s0_0, 0xc, 20, 1),\n\tCYGNUS_PIN_GROUP(spdif, 0xc, 20, 1),\n\tCYGNUS_PIN_GROUP(smart_card1, 0xc, 24, 0),\n\tCYGNUS_PIN_GROUP(i2s1_0, 0xc, 24, 1),\n\tCYGNUS_PIN_GROUP(spi0, 0x10, 0, 0),\n\tCYGNUS_PIN_GROUP(spi1, 0x10, 4, 0),\n\tCYGNUS_PIN_GROUP(spi2, 0x10, 8, 0),\n\tCYGNUS_PIN_GROUP(spi3, 0x10, 12, 0),\n\tCYGNUS_PIN_GROUP(sw_led0_0, 0x10, 12, 2),\n\tCYGNUS_PIN_GROUP(d1w, 0x10, 16, 0),\n\tCYGNUS_PIN_GROUP(uart4, 0x10, 16, 1),\n\tCYGNUS_PIN_GROUP(sw_led2_0, 0x10, 16, 2),\n\tCYGNUS_PIN_GROUP(lcd, 0x10, 20, 0),\n\tCYGNUS_PIN_GROUP(sram_0, 0x10, 20, 1),\n\tCYGNUS_PIN_GROUP(spi5, 0x10, 20, 2),\n\tCYGNUS_PIN_GROUP(uart0, 0x14, 0, 0),\n\tCYGNUS_PIN_GROUP(sw_led0_1, 0x14, 0, 2),\n\tCYGNUS_PIN_GROUP(uart1_dte, 0x14, 4, 0),\n\tCYGNUS_PIN_GROUP(uart2, 0x14, 4, 1),\n\tCYGNUS_PIN_GROUP(uart1, 0x14, 8, 0),\n\tCYGNUS_PIN_GROUP(uart3, 0x14, 12, 0),\n\tCYGNUS_PIN_GROUP(qspi_0, 0x14, 16, 0),\n\tCYGNUS_PIN_GROUP(nand, 0x14, 20, 0),\n\tCYGNUS_PIN_GROUP(sdio0_cd, 0x18, 0, 0),\n\tCYGNUS_PIN_GROUP(sdio0_mmc, 0x18, 4, 0),\n\tCYGNUS_PIN_GROUP(sdio1_data_0, 0x18, 8, 0),\n\tCYGNUS_PIN_GROUP(can0, 0x18, 8, 1),\n\tCYGNUS_PIN_GROUP(spi4_0, 0x18, 8, 2),\n\tCYGNUS_PIN_GROUP(sdio1_data_1, 0x18, 12, 0),\n\tCYGNUS_PIN_GROUP(can1, 0x18, 12, 1),\n\tCYGNUS_PIN_GROUP(spi4_1, 0x18, 12, 2),\n\tCYGNUS_PIN_GROUP(sdio1_cd, 0x18, 16, 0),\n\tCYGNUS_PIN_GROUP(sdio1_led, 0x18, 20, 0),\n\tCYGNUS_PIN_GROUP(sw_led2_1, 0x18, 20, 2),\n\tCYGNUS_PIN_GROUP(sdio1_mmc, 0x18, 24, 0),\n\tCYGNUS_PIN_GROUP(cam_led, 0x1c, 0, 0),\n\tCYGNUS_PIN_GROUP(sw_led1, 0x1c, 0, 1),\n\tCYGNUS_PIN_GROUP(cam_0, 0x1c, 4, 0),\n\tCYGNUS_PIN_GROUP(cam_1, 0x1c, 8, 0),\n\tCYGNUS_PIN_GROUP(sram_1, 0x1c, 8, 1),\n\tCYGNUS_PIN_GROUP(qspi_1, 0x1c, 12, 0),\n\tCYGNUS_PIN_GROUP(bsc1, 0x1c, 16, 0),\n\tCYGNUS_PIN_GROUP(pcie_clkreq, 0x1c, 16, 1),\n\tCYGNUS_PIN_GROUP(smart_card0_fcb, 0x20, 0, 0),\n\tCYGNUS_PIN_GROUP(i2s0_1, 0x20, 0, 1),\n\tCYGNUS_PIN_GROUP(smart_card1_fcb, 0x20, 4, 0),\n\tCYGNUS_PIN_GROUP(i2s1_1, 0x20, 4, 1),\n\tCYGNUS_PIN_GROUP(gpio0_3p3, 0x28, 0, 0),\n\tCYGNUS_PIN_GROUP(usb0_oc, 0x28, 0, 1),\n\tCYGNUS_PIN_GROUP(gpio1_3p3, 0x28, 4, 0),\n\tCYGNUS_PIN_GROUP(usb1_oc, 0x28, 4, 1),\n\tCYGNUS_PIN_GROUP(gpio2_3p3, 0x28, 8, 0),\n\tCYGNUS_PIN_GROUP(usb2_oc, 0x28, 8, 1),\n};\n\n \nstatic const char * const i2s0_grps[] = { \"i2s0_0_grp\", \"i2s0_1_grp\" };\nstatic const char * const i2s1_grps[] = { \"i2s1_0_grp\", \"i2s1_1_grp\" };\nstatic const char * const i2s2_grps[] = { \"i2s2_0_grp\", \"i2s2_1_grp\",\n\t\"i2s2_2_grp\", \"i2s2_3_grp\", \"i2s2_4_grp\" };\nstatic const char * const spdif_grps[] = { \"spdif_grp\" };\nstatic const char * const pwm0_grps[] = { \"pwm0_grp\" };\nstatic const char * const pwm1_grps[] = { \"pwm1_grp\" };\nstatic const char * const pwm2_grps[] = { \"pwm2_grp\" };\nstatic const char * const pwm3_grps[] = { \"pwm3_grp\" };\nstatic const char * const pwm4_grps[] = { \"pwm4_grp\" };\nstatic const char * const pwm5_grps[] = { \"pwm5_grp\" };\nstatic const char * const key_grps[] = { \"key0_grp\", \"key1_grp\", \"key2_grp\",\n\t\"key3_grp\", \"key4_grp\", \"key5_grp\", \"key6_grp\", \"key7_grp\", \"key8_grp\",\n\t\"key9_grp\", \"key10_grp\", \"key11_grp\", \"key12_grp\", \"key13_grp\",\n\t\"key14_grp\", \"key15_grp\" };\nstatic const char * const audio_dte_grps[] = { \"audio_dte0_grp\",\n\t\"audio_dte1_grp\", \"audio_dte2_grp\", \"audio_dte3_grp\" };\nstatic const char * const smart_card0_grps[] = { \"smart_card0_grp\",\n\t\"smart_card0_fcb_grp\" };\nstatic const char * const smart_card1_grps[] = { \"smart_card1_grp\",\n\t\"smart_card1_fcb_grp\" };\nstatic const char * const spi0_grps[] = { \"spi0_grp\" };\nstatic const char * const spi1_grps[] = { \"spi1_grp\" };\nstatic const char * const spi2_grps[] = { \"spi2_grp\" };\nstatic const char * const spi3_grps[] = { \"spi3_grp\" };\nstatic const char * const spi4_grps[] = { \"spi4_0_grp\", \"spi4_1_grp\" };\nstatic const char * const spi5_grps[] = { \"spi5_grp\" };\n\nstatic const char * const sw_led0_grps[] = { \"sw_led0_0_grp\",\n\t\"sw_led0_1_grp\" };\nstatic const char * const sw_led1_grps[] = { \"sw_led1_grp\" };\nstatic const char * const sw_led2_grps[] = { \"sw_led2_0_grp\",\n\t\"sw_led2_1_grp\" };\nstatic const char * const d1w_grps[] = { \"d1w_grp\" };\nstatic const char * const lcd_grps[] = { \"lcd_grp\" };\nstatic const char * const sram_grps[] = { \"sram_0_grp\", \"sram_1_grp\" };\n\nstatic const char * const uart0_grps[] = { \"uart0_grp\" };\nstatic const char * const uart1_grps[] = { \"uart1_grp\", \"uart1_dte_grp\" };\nstatic const char * const uart2_grps[] = { \"uart2_grp\" };\nstatic const char * const uart3_grps[] = { \"uart3_grp\" };\nstatic const char * const uart4_grps[] = { \"uart4_grp\" };\nstatic const char * const qspi_grps[] = { \"qspi_0_grp\", \"qspi_1_grp\" };\nstatic const char * const nand_grps[] = { \"nand_grp\" };\nstatic const char * const sdio0_grps[] = { \"sdio0_grp\", \"sdio0_cd_grp\",\n\t\"sdio0_mmc_grp\" };\nstatic const char * const sdio1_grps[] = { \"sdio1_data_0_grp\",\n\t\"sdio1_data_1_grp\", \"sdio1_cd_grp\", \"sdio1_led_grp\", \"sdio1_mmc_grp\" };\nstatic const char * const can0_grps[] = { \"can0_grp\" };\nstatic const char * const can1_grps[] = { \"can1_grp\" };\nstatic const char * const cam_grps[] = { \"cam_led_grp\", \"cam_0_grp\",\n\t\"cam_1_grp\" };\nstatic const char * const bsc1_grps[] = { \"bsc1_grp\" };\nstatic const char * const pcie_clkreq_grps[] = { \"pcie_clkreq_grp\" };\nstatic const char * const usb0_oc_grps[] = { \"usb0_oc_grp\" };\nstatic const char * const usb1_oc_grps[] = { \"usb1_oc_grp\" };\nstatic const char * const usb2_oc_grps[] = { \"usb2_oc_grp\" };\n\n#define CYGNUS_PIN_FUNCTION(func)\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\\\n\t.name = #func,\t\t\t\t\t\t\\\n\t.groups = func ## _grps,\t\t\t\t\\\n\t.num_groups = ARRAY_SIZE(func ## _grps),\t\t\\\n}\n\n \nstatic const struct cygnus_pin_function cygnus_pin_functions[] = {\n\tCYGNUS_PIN_FUNCTION(i2s0),\n\tCYGNUS_PIN_FUNCTION(i2s1),\n\tCYGNUS_PIN_FUNCTION(i2s2),\n\tCYGNUS_PIN_FUNCTION(spdif),\n\tCYGNUS_PIN_FUNCTION(pwm0),\n\tCYGNUS_PIN_FUNCTION(pwm1),\n\tCYGNUS_PIN_FUNCTION(pwm2),\n\tCYGNUS_PIN_FUNCTION(pwm3),\n\tCYGNUS_PIN_FUNCTION(pwm4),\n\tCYGNUS_PIN_FUNCTION(pwm5),\n\tCYGNUS_PIN_FUNCTION(key),\n\tCYGNUS_PIN_FUNCTION(audio_dte),\n\tCYGNUS_PIN_FUNCTION(smart_card0),\n\tCYGNUS_PIN_FUNCTION(smart_card1),\n\tCYGNUS_PIN_FUNCTION(spi0),\n\tCYGNUS_PIN_FUNCTION(spi1),\n\tCYGNUS_PIN_FUNCTION(spi2),\n\tCYGNUS_PIN_FUNCTION(spi3),\n\tCYGNUS_PIN_FUNCTION(spi4),\n\tCYGNUS_PIN_FUNCTION(spi5),\n\tCYGNUS_PIN_FUNCTION(sw_led0),\n\tCYGNUS_PIN_FUNCTION(sw_led1),\n\tCYGNUS_PIN_FUNCTION(sw_led2),\n\tCYGNUS_PIN_FUNCTION(d1w),\n\tCYGNUS_PIN_FUNCTION(lcd),\n\tCYGNUS_PIN_FUNCTION(sram),\n\tCYGNUS_PIN_FUNCTION(uart0),\n\tCYGNUS_PIN_FUNCTION(uart1),\n\tCYGNUS_PIN_FUNCTION(uart2),\n\tCYGNUS_PIN_FUNCTION(uart3),\n\tCYGNUS_PIN_FUNCTION(uart4),\n\tCYGNUS_PIN_FUNCTION(qspi),\n\tCYGNUS_PIN_FUNCTION(nand),\n\tCYGNUS_PIN_FUNCTION(sdio0),\n\tCYGNUS_PIN_FUNCTION(sdio1),\n\tCYGNUS_PIN_FUNCTION(can0),\n\tCYGNUS_PIN_FUNCTION(can1),\n\tCYGNUS_PIN_FUNCTION(cam),\n\tCYGNUS_PIN_FUNCTION(bsc1),\n\tCYGNUS_PIN_FUNCTION(pcie_clkreq),\n\tCYGNUS_PIN_FUNCTION(usb0_oc),\n\tCYGNUS_PIN_FUNCTION(usb1_oc),\n\tCYGNUS_PIN_FUNCTION(usb2_oc),\n};\n\nstatic int cygnus_get_groups_count(struct pinctrl_dev *pctrl_dev)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\n\treturn pinctrl->num_groups;\n}\n\nstatic const char *cygnus_get_group_name(struct pinctrl_dev *pctrl_dev,\n\t\t\t\t\t unsigned selector)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\n\treturn pinctrl->groups[selector].name;\n}\n\nstatic int cygnus_get_group_pins(struct pinctrl_dev *pctrl_dev,\n\t\t\t\t unsigned selector, const unsigned **pins,\n\t\t\t\t unsigned *num_pins)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\n\t*pins = pinctrl->groups[selector].pins;\n\t*num_pins = pinctrl->groups[selector].num_pins;\n\n\treturn 0;\n}\n\nstatic void cygnus_pin_dbg_show(struct pinctrl_dev *pctrl_dev,\n\t\t\t\tstruct seq_file *s, unsigned offset)\n{\n\tseq_printf(s, \" %s\", dev_name(pctrl_dev->dev));\n}\n\nstatic const struct pinctrl_ops cygnus_pinctrl_ops = {\n\t.get_groups_count = cygnus_get_groups_count,\n\t.get_group_name = cygnus_get_group_name,\n\t.get_group_pins = cygnus_get_group_pins,\n\t.pin_dbg_show = cygnus_pin_dbg_show,\n\t.dt_node_to_map = pinconf_generic_dt_node_to_map_group,\n\t.dt_free_map = pinctrl_utils_free_map,\n};\n\nstatic int cygnus_get_functions_count(struct pinctrl_dev *pctrl_dev)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\n\treturn pinctrl->num_functions;\n}\n\nstatic const char *cygnus_get_function_name(struct pinctrl_dev *pctrl_dev,\n\t\t\t\t\t    unsigned selector)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\n\treturn pinctrl->functions[selector].name;\n}\n\nstatic int cygnus_get_function_groups(struct pinctrl_dev *pctrl_dev,\n\t\t\t\t      unsigned selector,\n\t\t\t\t      const char * const **groups,\n\t\t\t\t      unsigned * const num_groups)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\n\t*groups = pinctrl->functions[selector].groups;\n\t*num_groups = pinctrl->functions[selector].num_groups;\n\n\treturn 0;\n}\n\nstatic int cygnus_pinmux_set(struct cygnus_pinctrl *pinctrl,\n\t\t\t     const struct cygnus_pin_function *func,\n\t\t\t     const struct cygnus_pin_group *grp,\n\t\t\t     struct cygnus_mux_log *mux_log)\n{\n\tconst struct cygnus_mux *mux = &grp->mux;\n\tint i;\n\tu32 val, mask = 0x7;\n\tunsigned long flags;\n\n\tfor (i = 0; i < CYGNUS_NUM_IOMUX; i++) {\n\t\tif (mux->offset != mux_log[i].mux.offset ||\n\t\t    mux->shift != mux_log[i].mux.shift)\n\t\t\tcontinue;\n\n\t\t \n\n\t\t \n\t\tif (!mux_log[i].is_configured)\n\t\t\tbreak;\n\n\t\t \n\t\tif (mux_log[i].mux.alt != mux->alt) {\n\t\t\tdev_err(pinctrl->dev,\n\t\t\t\t\"double configuration error detected!\\n\");\n\t\t\tdev_err(pinctrl->dev, \"func:%s grp:%s\\n\",\n\t\t\t\tfunc->name, grp->name);\n\t\t\treturn -EINVAL;\n\t\t} else {\n\t\t\t \n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tmux_log[i].mux.alt = mux->alt;\n\tmux_log[i].is_configured = true;\n\n\tspin_lock_irqsave(&pinctrl->lock, flags);\n\n\tval = readl(pinctrl->base0 + grp->mux.offset);\n\tval &= ~(mask << grp->mux.shift);\n\tval |= grp->mux.alt << grp->mux.shift;\n\twritel(val, pinctrl->base0 + grp->mux.offset);\n\n\tspin_unlock_irqrestore(&pinctrl->lock, flags);\n\n\treturn 0;\n}\n\nstatic int cygnus_pinmux_set_mux(struct pinctrl_dev *pctrl_dev,\n\t\t\t\t unsigned func_select, unsigned grp_select)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\tconst struct cygnus_pin_function *func =\n\t\t&pinctrl->functions[func_select];\n\tconst struct cygnus_pin_group *grp = &pinctrl->groups[grp_select];\n\n\tdev_dbg(pctrl_dev->dev, \"func:%u name:%s grp:%u name:%s\\n\",\n\t\tfunc_select, func->name, grp_select, grp->name);\n\n\tdev_dbg(pctrl_dev->dev, \"offset:0x%08x shift:%u alt:%u\\n\",\n\t\tgrp->mux.offset, grp->mux.shift, grp->mux.alt);\n\n\treturn cygnus_pinmux_set(pinctrl, func, grp, pinctrl->mux_log);\n}\n\nstatic int cygnus_gpio_request_enable(struct pinctrl_dev *pctrl_dev,\n\t\t\t\t      struct pinctrl_gpio_range *range,\n\t\t\t\t      unsigned pin)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\tconst struct cygnus_gpio_mux *mux = pctrl_dev->desc->pins[pin].drv_data;\n\tu32 val;\n\tunsigned long flags;\n\n\t \n\tif (!mux->is_supported)\n\t\treturn -ENOTSUPP;\n\n\tspin_lock_irqsave(&pinctrl->lock, flags);\n\n\tval = readl(pinctrl->base1 + mux->offset);\n\tval |= 0x3 << mux->shift;\n\twritel(val, pinctrl->base1 + mux->offset);\n\n\tspin_unlock_irqrestore(&pinctrl->lock, flags);\n\n\tdev_dbg(pctrl_dev->dev,\n\t\t\"gpio request enable pin=%u offset=0x%x shift=%u\\n\",\n\t\tpin, mux->offset, mux->shift);\n\n\treturn 0;\n}\n\nstatic void cygnus_gpio_disable_free(struct pinctrl_dev *pctrl_dev,\n\t\t\t\t     struct pinctrl_gpio_range *range,\n\t\t\t\t     unsigned pin)\n{\n\tstruct cygnus_pinctrl *pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\tstruct cygnus_gpio_mux *mux = pctrl_dev->desc->pins[pin].drv_data;\n\tu32 val;\n\tunsigned long flags;\n\n\tif (!mux->is_supported)\n\t\treturn;\n\n\tspin_lock_irqsave(&pinctrl->lock, flags);\n\n\tval = readl(pinctrl->base1 + mux->offset);\n\tval &= ~(0x3 << mux->shift);\n\twritel(val, pinctrl->base1 + mux->offset);\n\n\tspin_unlock_irqrestore(&pinctrl->lock, flags);\n\n\tdev_err(pctrl_dev->dev,\n\t\t\"gpio disable free pin=%u offset=0x%x shift=%u\\n\",\n\t\tpin, mux->offset, mux->shift);\n}\n\nstatic const struct pinmux_ops cygnus_pinmux_ops = {\n\t.get_functions_count = cygnus_get_functions_count,\n\t.get_function_name = cygnus_get_function_name,\n\t.get_function_groups = cygnus_get_function_groups,\n\t.set_mux = cygnus_pinmux_set_mux,\n\t.gpio_request_enable = cygnus_gpio_request_enable,\n\t.gpio_disable_free = cygnus_gpio_disable_free,\n};\n\nstatic struct pinctrl_desc cygnus_pinctrl_desc = {\n\t.name = \"cygnus-pinmux\",\n\t.pctlops = &cygnus_pinctrl_ops,\n\t.pmxops = &cygnus_pinmux_ops,\n};\n\nstatic int cygnus_mux_log_init(struct cygnus_pinctrl *pinctrl)\n{\n\tstruct cygnus_mux_log *log;\n\tunsigned int i, j;\n\n\tpinctrl->mux_log = devm_kcalloc(pinctrl->dev, CYGNUS_NUM_IOMUX,\n\t\t\t\t\tsizeof(struct cygnus_mux_log),\n\t\t\t\t\tGFP_KERNEL);\n\tif (!pinctrl->mux_log)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < CYGNUS_NUM_IOMUX_REGS; i++) {\n\t\tfor (j = 0; j < CYGNUS_NUM_MUX_PER_REG; j++) {\n\t\t\tlog = &pinctrl->mux_log[i * CYGNUS_NUM_MUX_PER_REG\n\t\t\t\t+ j];\n\t\t\tlog->mux.offset = i * 4;\n\t\t\tlog->mux.shift = j * 4;\n\t\t\tlog->mux.alt = 0;\n\t\t\tlog->is_configured = false;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int cygnus_pinmux_probe(struct platform_device *pdev)\n{\n\tstruct cygnus_pinctrl *pinctrl;\n\tint i, ret;\n\tstruct pinctrl_pin_desc *pins;\n\tunsigned num_pins = ARRAY_SIZE(cygnus_pins);\n\n\tpinctrl = devm_kzalloc(&pdev->dev, sizeof(*pinctrl), GFP_KERNEL);\n\tif (!pinctrl)\n\t\treturn -ENOMEM;\n\n\tpinctrl->dev = &pdev->dev;\n\tplatform_set_drvdata(pdev, pinctrl);\n\tspin_lock_init(&pinctrl->lock);\n\n\tpinctrl->base0 = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(pinctrl->base0)) {\n\t\tdev_err(&pdev->dev, \"unable to map I/O space\\n\");\n\t\treturn PTR_ERR(pinctrl->base0);\n\t}\n\n\tpinctrl->base1 = devm_platform_ioremap_resource(pdev, 1);\n\tif (IS_ERR(pinctrl->base1)) {\n\t\tdev_err(&pdev->dev, \"unable to map I/O space\\n\");\n\t\treturn PTR_ERR(pinctrl->base1);\n\t}\n\n\tret = cygnus_mux_log_init(pinctrl);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"unable to initialize IOMUX log\\n\");\n\t\treturn ret;\n\t}\n\n\tpins = devm_kcalloc(&pdev->dev, num_pins, sizeof(*pins), GFP_KERNEL);\n\tif (!pins)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < num_pins; i++) {\n\t\tpins[i].number = cygnus_pins[i].pin;\n\t\tpins[i].name = cygnus_pins[i].name;\n\t\tpins[i].drv_data = &cygnus_pins[i].gpio_mux;\n\t}\n\n\tpinctrl->groups = cygnus_pin_groups;\n\tpinctrl->num_groups = ARRAY_SIZE(cygnus_pin_groups);\n\tpinctrl->functions = cygnus_pin_functions;\n\tpinctrl->num_functions = ARRAY_SIZE(cygnus_pin_functions);\n\tcygnus_pinctrl_desc.pins = pins;\n\tcygnus_pinctrl_desc.npins = num_pins;\n\n\tpinctrl->pctl = devm_pinctrl_register(&pdev->dev, &cygnus_pinctrl_desc,\n\t\t\tpinctrl);\n\tif (IS_ERR(pinctrl->pctl)) {\n\t\tdev_err(&pdev->dev, \"unable to register Cygnus IOMUX pinctrl\\n\");\n\t\treturn PTR_ERR(pinctrl->pctl);\n\t}\n\n\treturn 0;\n}\n\nstatic const struct of_device_id cygnus_pinmux_of_match[] = {\n\t{ .compatible = \"brcm,cygnus-pinmux\" },\n\t{ }\n};\n\nstatic struct platform_driver cygnus_pinmux_driver = {\n\t.driver = {\n\t\t.name = \"cygnus-pinmux\",\n\t\t.of_match_table = cygnus_pinmux_of_match,\n\t\t.suppress_bind_attrs = true,\n\t},\n\t.probe = cygnus_pinmux_probe,\n};\n\nstatic int __init cygnus_pinmux_init(void)\n{\n\treturn platform_driver_register(&cygnus_pinmux_driver);\n}\narch_initcall(cygnus_pinmux_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}