{
  "module_name": "pinctrl-bcm4908.c",
  "hash_id": "5681ebc7ce3f88f1d4bc775612f8f908d5e94415e776205617042667adf7a5ea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/bcm/pinctrl-bcm4908.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/pinctrl/pinconf-generic.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinmux.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <linux/string_helpers.h>\n\n#include \"../core.h\"\n#include \"../pinmux.h\"\n\n#define BCM4908_NUM_PINS\t\t\t86\n\n#define BCM4908_TEST_PORT_BLOCK_EN_LSB\t\t\t0x00\n#define BCM4908_TEST_PORT_BLOCK_DATA_MSB\t\t0x04\n#define BCM4908_TEST_PORT_BLOCK_DATA_LSB\t\t0x08\n#define  BCM4908_TEST_PORT_LSB_PINMUX_DATA_SHIFT\t12\n#define BCM4908_TEST_PORT_COMMAND\t\t\t0x0c\n#define  BCM4908_TEST_PORT_CMD_LOAD_MUX_REG\t\t0x00000021\n\nstruct bcm4908_pinctrl {\n\tstruct device *dev;\n\tvoid __iomem *base;\n\tstruct mutex mutex;\n\tstruct pinctrl_dev *pctldev;\n\tstruct pinctrl_desc pctldesc;\n};\n\n \n\nstruct bcm4908_pinctrl_pin_setup {\n\tunsigned int number;\n\tunsigned int function;\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_0_pins_a[] = {\n\t{ 0, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_1_pins_a[] = {\n\t{ 1, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_2_pins_a[] = {\n\t{ 2, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_3_pins_a[] = {\n\t{ 3, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_4_pins_a[] = {\n\t{ 4, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_5_pins_a[] = {\n\t{ 5, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_6_pins_a[] = {\n\t{ 6, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_7_pins_a[] = {\n\t{ 7, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_8_pins_a[] = {\n\t{ 8, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_9_pins_a[] = {\n\t{ 9, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_10_pins_a[] = {\n\t{ 10, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_11_pins_a[] = {\n\t{ 11, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_12_pins_a[] = {\n\t{ 12, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_13_pins_a[] = {\n\t{ 13, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_14_pins_a[] = {\n\t{ 14, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_15_pins_a[] = {\n\t{ 15, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_16_pins_a[] = {\n\t{ 16, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_17_pins_a[] = {\n\t{ 17, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_18_pins_a[] = {\n\t{ 18, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_19_pins_a[] = {\n\t{ 19, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_20_pins_a[] = {\n\t{ 20, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_21_pins_a[] = {\n\t{ 21, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_22_pins_a[] = {\n\t{ 22, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_23_pins_a[] = {\n\t{ 23, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_24_pins_a[] = {\n\t{ 24, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_25_pins_a[] = {\n\t{ 25, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_26_pins_a[] = {\n\t{ 26, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_27_pins_a[] = {\n\t{ 27, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_28_pins_a[] = {\n\t{ 28, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_29_pins_a[] = {\n\t{ 29, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_30_pins_a[] = {\n\t{ 30, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_31_pins_a[] = {\n\t{ 31, 3 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_10_pins_b[] = {\n\t{ 8, 2 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_11_pins_b[] = {\n\t{ 9, 2 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_12_pins_b[] = {\n\t{ 0, 2 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_13_pins_b[] = {\n\t{ 1, 2 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup led_31_pins_b[] = {\n\t{ 30, 2 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup hs_uart_pins[] = {\n\t{ 10, 0 },\t \n\t{ 11, 0 },\t \n\t{ 12, 0 },\t \n\t{ 13, 0 },\t \n};\n\nstatic const struct bcm4908_pinctrl_pin_setup i2c_pins_a[] = {\n\t{ 18, 0 },\t \n\t{ 19, 0 },\t \n};\n\nstatic const struct bcm4908_pinctrl_pin_setup i2c_pins_b[] = {\n\t{ 22, 0 },\t \n\t{ 23, 0 },\t \n};\n\nstatic const struct bcm4908_pinctrl_pin_setup i2s_pins[] = {\n\t{ 27, 0 },\t \n\t{ 28, 0 },\t \n\t{ 29, 0 },\t \n\t{ 30, 0 },\t \n};\n\nstatic const struct bcm4908_pinctrl_pin_setup nand_ctrl_pins[] = {\n\t{ 32, 0 },\n\t{ 33, 0 },\n\t{ 34, 0 },\n\t{ 43, 0 },\n\t{ 44, 0 },\n\t{ 45, 0 },\n\t{ 56, 1 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup nand_data_pins[] = {\n\t{ 35, 0 },\n\t{ 36, 0 },\n\t{ 37, 0 },\n\t{ 38, 0 },\n\t{ 39, 0 },\n\t{ 40, 0 },\n\t{ 41, 0 },\n\t{ 42, 0 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup emmc_ctrl_pins[] = {\n\t{ 46, 0 },\n\t{ 47, 0 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup usb0_pwr_pins[] = {\n\t{ 63, 0 },\n\t{ 64, 0 },\n};\n\nstatic const struct bcm4908_pinctrl_pin_setup usb1_pwr_pins[] = {\n\t{ 66, 0 },\n\t{ 67, 0 },\n};\n\nstruct bcm4908_pinctrl_grp {\n\tconst char *name;\n\tconst struct bcm4908_pinctrl_pin_setup *pins;\n\tconst unsigned int num_pins;\n};\n\nstatic const struct bcm4908_pinctrl_grp bcm4908_pinctrl_grps[] = {\n\t{ \"led_0_grp_a\", led_0_pins_a, ARRAY_SIZE(led_0_pins_a) },\n\t{ \"led_1_grp_a\", led_1_pins_a, ARRAY_SIZE(led_1_pins_a) },\n\t{ \"led_2_grp_a\", led_2_pins_a, ARRAY_SIZE(led_2_pins_a) },\n\t{ \"led_3_grp_a\", led_3_pins_a, ARRAY_SIZE(led_3_pins_a) },\n\t{ \"led_4_grp_a\", led_4_pins_a, ARRAY_SIZE(led_4_pins_a) },\n\t{ \"led_5_grp_a\", led_5_pins_a, ARRAY_SIZE(led_5_pins_a) },\n\t{ \"led_6_grp_a\", led_6_pins_a, ARRAY_SIZE(led_6_pins_a) },\n\t{ \"led_7_grp_a\", led_7_pins_a, ARRAY_SIZE(led_7_pins_a) },\n\t{ \"led_8_grp_a\", led_8_pins_a, ARRAY_SIZE(led_8_pins_a) },\n\t{ \"led_9_grp_a\", led_9_pins_a, ARRAY_SIZE(led_9_pins_a) },\n\t{ \"led_10_grp_a\", led_10_pins_a, ARRAY_SIZE(led_10_pins_a) },\n\t{ \"led_11_grp_a\", led_11_pins_a, ARRAY_SIZE(led_11_pins_a) },\n\t{ \"led_12_grp_a\", led_12_pins_a, ARRAY_SIZE(led_12_pins_a) },\n\t{ \"led_13_grp_a\", led_13_pins_a, ARRAY_SIZE(led_13_pins_a) },\n\t{ \"led_14_grp_a\", led_14_pins_a, ARRAY_SIZE(led_14_pins_a) },\n\t{ \"led_15_grp_a\", led_15_pins_a, ARRAY_SIZE(led_15_pins_a) },\n\t{ \"led_16_grp_a\", led_16_pins_a, ARRAY_SIZE(led_16_pins_a) },\n\t{ \"led_17_grp_a\", led_17_pins_a, ARRAY_SIZE(led_17_pins_a) },\n\t{ \"led_18_grp_a\", led_18_pins_a, ARRAY_SIZE(led_18_pins_a) },\n\t{ \"led_19_grp_a\", led_19_pins_a, ARRAY_SIZE(led_19_pins_a) },\n\t{ \"led_20_grp_a\", led_20_pins_a, ARRAY_SIZE(led_20_pins_a) },\n\t{ \"led_21_grp_a\", led_21_pins_a, ARRAY_SIZE(led_21_pins_a) },\n\t{ \"led_22_grp_a\", led_22_pins_a, ARRAY_SIZE(led_22_pins_a) },\n\t{ \"led_23_grp_a\", led_23_pins_a, ARRAY_SIZE(led_23_pins_a) },\n\t{ \"led_24_grp_a\", led_24_pins_a, ARRAY_SIZE(led_24_pins_a) },\n\t{ \"led_25_grp_a\", led_25_pins_a, ARRAY_SIZE(led_25_pins_a) },\n\t{ \"led_26_grp_a\", led_26_pins_a, ARRAY_SIZE(led_26_pins_a) },\n\t{ \"led_27_grp_a\", led_27_pins_a, ARRAY_SIZE(led_27_pins_a) },\n\t{ \"led_28_grp_a\", led_28_pins_a, ARRAY_SIZE(led_28_pins_a) },\n\t{ \"led_29_grp_a\", led_29_pins_a, ARRAY_SIZE(led_29_pins_a) },\n\t{ \"led_30_grp_a\", led_30_pins_a, ARRAY_SIZE(led_30_pins_a) },\n\t{ \"led_31_grp_a\", led_31_pins_a, ARRAY_SIZE(led_31_pins_a) },\n\t{ \"led_10_grp_b\", led_10_pins_b, ARRAY_SIZE(led_10_pins_b) },\n\t{ \"led_11_grp_b\", led_11_pins_b, ARRAY_SIZE(led_11_pins_b) },\n\t{ \"led_12_grp_b\", led_12_pins_b, ARRAY_SIZE(led_12_pins_b) },\n\t{ \"led_13_grp_b\", led_13_pins_b, ARRAY_SIZE(led_13_pins_b) },\n\t{ \"led_31_grp_b\", led_31_pins_b, ARRAY_SIZE(led_31_pins_b) },\n\t{ \"hs_uart_grp\", hs_uart_pins, ARRAY_SIZE(hs_uart_pins) },\n\t{ \"i2c_grp_a\", i2c_pins_a, ARRAY_SIZE(i2c_pins_a) },\n\t{ \"i2c_grp_b\", i2c_pins_b, ARRAY_SIZE(i2c_pins_b) },\n\t{ \"i2s_grp\", i2s_pins, ARRAY_SIZE(i2s_pins) },\n\t{ \"nand_ctrl_grp\", nand_ctrl_pins, ARRAY_SIZE(nand_ctrl_pins) },\n\t{ \"nand_data_grp\", nand_data_pins, ARRAY_SIZE(nand_data_pins) },\n\t{ \"emmc_ctrl_grp\", emmc_ctrl_pins, ARRAY_SIZE(emmc_ctrl_pins) },\n\t{ \"usb0_pwr_grp\", usb0_pwr_pins, ARRAY_SIZE(usb0_pwr_pins) },\n\t{ \"usb1_pwr_grp\", usb1_pwr_pins, ARRAY_SIZE(usb1_pwr_pins) },\n};\n\n \n\nstruct bcm4908_pinctrl_function {\n\tconst char *name;\n\tconst char * const *groups;\n\tconst unsigned int num_groups;\n};\n\nstatic const char * const led_0_groups[] = { \"led_0_grp_a\" };\nstatic const char * const led_1_groups[] = { \"led_1_grp_a\" };\nstatic const char * const led_2_groups[] = { \"led_2_grp_a\" };\nstatic const char * const led_3_groups[] = { \"led_3_grp_a\" };\nstatic const char * const led_4_groups[] = { \"led_4_grp_a\" };\nstatic const char * const led_5_groups[] = { \"led_5_grp_a\" };\nstatic const char * const led_6_groups[] = { \"led_6_grp_a\" };\nstatic const char * const led_7_groups[] = { \"led_7_grp_a\" };\nstatic const char * const led_8_groups[] = { \"led_8_grp_a\" };\nstatic const char * const led_9_groups[] = { \"led_9_grp_a\" };\nstatic const char * const led_10_groups[] = { \"led_10_grp_a\", \"led_10_grp_b\" };\nstatic const char * const led_11_groups[] = { \"led_11_grp_a\", \"led_11_grp_b\" };\nstatic const char * const led_12_groups[] = { \"led_12_grp_a\", \"led_12_grp_b\" };\nstatic const char * const led_13_groups[] = { \"led_13_grp_a\", \"led_13_grp_b\" };\nstatic const char * const led_14_groups[] = { \"led_14_grp_a\" };\nstatic const char * const led_15_groups[] = { \"led_15_grp_a\" };\nstatic const char * const led_16_groups[] = { \"led_16_grp_a\" };\nstatic const char * const led_17_groups[] = { \"led_17_grp_a\" };\nstatic const char * const led_18_groups[] = { \"led_18_grp_a\" };\nstatic const char * const led_19_groups[] = { \"led_19_grp_a\" };\nstatic const char * const led_20_groups[] = { \"led_20_grp_a\" };\nstatic const char * const led_21_groups[] = { \"led_21_grp_a\" };\nstatic const char * const led_22_groups[] = { \"led_22_grp_a\" };\nstatic const char * const led_23_groups[] = { \"led_23_grp_a\" };\nstatic const char * const led_24_groups[] = { \"led_24_grp_a\" };\nstatic const char * const led_25_groups[] = { \"led_25_grp_a\" };\nstatic const char * const led_26_groups[] = { \"led_26_grp_a\" };\nstatic const char * const led_27_groups[] = { \"led_27_grp_a\" };\nstatic const char * const led_28_groups[] = { \"led_28_grp_a\" };\nstatic const char * const led_29_groups[] = { \"led_29_grp_a\" };\nstatic const char * const led_30_groups[] = { \"led_30_grp_a\" };\nstatic const char * const led_31_groups[] = { \"led_31_grp_a\", \"led_31_grp_b\" };\nstatic const char * const hs_uart_groups[] = { \"hs_uart_grp\" };\nstatic const char * const i2c_groups[] = { \"i2c_grp_a\", \"i2c_grp_b\" };\nstatic const char * const i2s_groups[] = { \"i2s_grp\" };\nstatic const char * const nand_ctrl_groups[] = { \"nand_ctrl_grp\" };\nstatic const char * const nand_data_groups[] = { \"nand_data_grp\" };\nstatic const char * const emmc_ctrl_groups[] = { \"emmc_ctrl_grp\" };\nstatic const char * const usb0_pwr_groups[] = { \"usb0_pwr_grp\" };\nstatic const char * const usb1_pwr_groups[] = { \"usb1_pwr_grp\" };\n\nstatic const struct bcm4908_pinctrl_function bcm4908_pinctrl_functions[] = {\n\t{ \"led_0\", led_0_groups, ARRAY_SIZE(led_0_groups) },\n\t{ \"led_1\", led_1_groups, ARRAY_SIZE(led_1_groups) },\n\t{ \"led_2\", led_2_groups, ARRAY_SIZE(led_2_groups) },\n\t{ \"led_3\", led_3_groups, ARRAY_SIZE(led_3_groups) },\n\t{ \"led_4\", led_4_groups, ARRAY_SIZE(led_4_groups) },\n\t{ \"led_5\", led_5_groups, ARRAY_SIZE(led_5_groups) },\n\t{ \"led_6\", led_6_groups, ARRAY_SIZE(led_6_groups) },\n\t{ \"led_7\", led_7_groups, ARRAY_SIZE(led_7_groups) },\n\t{ \"led_8\", led_8_groups, ARRAY_SIZE(led_8_groups) },\n\t{ \"led_9\", led_9_groups, ARRAY_SIZE(led_9_groups) },\n\t{ \"led_10\", led_10_groups, ARRAY_SIZE(led_10_groups) },\n\t{ \"led_11\", led_11_groups, ARRAY_SIZE(led_11_groups) },\n\t{ \"led_12\", led_12_groups, ARRAY_SIZE(led_12_groups) },\n\t{ \"led_13\", led_13_groups, ARRAY_SIZE(led_13_groups) },\n\t{ \"led_14\", led_14_groups, ARRAY_SIZE(led_14_groups) },\n\t{ \"led_15\", led_15_groups, ARRAY_SIZE(led_15_groups) },\n\t{ \"led_16\", led_16_groups, ARRAY_SIZE(led_16_groups) },\n\t{ \"led_17\", led_17_groups, ARRAY_SIZE(led_17_groups) },\n\t{ \"led_18\", led_18_groups, ARRAY_SIZE(led_18_groups) },\n\t{ \"led_19\", led_19_groups, ARRAY_SIZE(led_19_groups) },\n\t{ \"led_20\", led_20_groups, ARRAY_SIZE(led_20_groups) },\n\t{ \"led_21\", led_21_groups, ARRAY_SIZE(led_21_groups) },\n\t{ \"led_22\", led_22_groups, ARRAY_SIZE(led_22_groups) },\n\t{ \"led_23\", led_23_groups, ARRAY_SIZE(led_23_groups) },\n\t{ \"led_24\", led_24_groups, ARRAY_SIZE(led_24_groups) },\n\t{ \"led_25\", led_25_groups, ARRAY_SIZE(led_25_groups) },\n\t{ \"led_26\", led_26_groups, ARRAY_SIZE(led_26_groups) },\n\t{ \"led_27\", led_27_groups, ARRAY_SIZE(led_27_groups) },\n\t{ \"led_28\", led_28_groups, ARRAY_SIZE(led_28_groups) },\n\t{ \"led_29\", led_29_groups, ARRAY_SIZE(led_29_groups) },\n\t{ \"led_30\", led_30_groups, ARRAY_SIZE(led_30_groups) },\n\t{ \"led_31\", led_31_groups, ARRAY_SIZE(led_31_groups) },\n\t{ \"hs_uart\", hs_uart_groups, ARRAY_SIZE(hs_uart_groups) },\n\t{ \"i2c\", i2c_groups, ARRAY_SIZE(i2c_groups) },\n\t{ \"i2s\", i2s_groups, ARRAY_SIZE(i2s_groups) },\n\t{ \"nand_ctrl\", nand_ctrl_groups, ARRAY_SIZE(nand_ctrl_groups) },\n\t{ \"nand_data\", nand_data_groups, ARRAY_SIZE(nand_data_groups) },\n\t{ \"emmc_ctrl\", emmc_ctrl_groups, ARRAY_SIZE(emmc_ctrl_groups) },\n\t{ \"usb0_pwr\", usb0_pwr_groups, ARRAY_SIZE(usb0_pwr_groups) },\n\t{ \"usb1_pwr\", usb1_pwr_groups, ARRAY_SIZE(usb1_pwr_groups) },\n};\n\n \n\nstatic const struct pinctrl_ops bcm4908_pinctrl_ops = {\n\t.get_groups_count = pinctrl_generic_get_group_count,\n\t.get_group_name = pinctrl_generic_get_group_name,\n\t.get_group_pins = pinctrl_generic_get_group_pins,\n\t.dt_node_to_map = pinconf_generic_dt_node_to_map_group,\n\t.dt_free_map = pinconf_generic_dt_free_map,\n};\n\n \n\nstatic int bcm4908_pinctrl_set_mux(struct pinctrl_dev *pctrl_dev,\n\t\t\t      unsigned int func_selector,\n\t\t\t      unsigned int group_selector)\n{\n\tstruct bcm4908_pinctrl *bcm4908_pinctrl = pinctrl_dev_get_drvdata(pctrl_dev);\n\tconst struct bcm4908_pinctrl_grp *group;\n\tstruct group_desc *group_desc;\n\tint i;\n\n\tgroup_desc = pinctrl_generic_get_group(pctrl_dev, group_selector);\n\tif (!group_desc)\n\t\treturn -EINVAL;\n\tgroup = group_desc->data;\n\n\tmutex_lock(&bcm4908_pinctrl->mutex);\n\tfor (i = 0; i < group->num_pins; i++) {\n\t\tu32 lsb = 0;\n\n\t\tlsb |= group->pins[i].number;\n\t\tlsb |= group->pins[i].function << BCM4908_TEST_PORT_LSB_PINMUX_DATA_SHIFT;\n\n\t\twritel(0x0, bcm4908_pinctrl->base + BCM4908_TEST_PORT_BLOCK_DATA_MSB);\n\t\twritel(lsb, bcm4908_pinctrl->base + BCM4908_TEST_PORT_BLOCK_DATA_LSB);\n\t\twritel(BCM4908_TEST_PORT_CMD_LOAD_MUX_REG,\n\t\t       bcm4908_pinctrl->base + BCM4908_TEST_PORT_COMMAND);\n\t}\n\tmutex_unlock(&bcm4908_pinctrl->mutex);\n\n\treturn 0;\n}\n\nstatic const struct pinmux_ops bcm4908_pinctrl_pmxops = {\n\t.get_functions_count = pinmux_generic_get_function_count,\n\t.get_function_name = pinmux_generic_get_function_name,\n\t.get_function_groups = pinmux_generic_get_function_groups,\n\t.set_mux = bcm4908_pinctrl_set_mux,\n};\n\n \n\nstatic struct pinctrl_desc bcm4908_pinctrl_desc = {\n\t.name = \"bcm4908-pinctrl\",\n\t.pctlops = &bcm4908_pinctrl_ops,\n\t.pmxops = &bcm4908_pinctrl_pmxops,\n};\n\nstatic const struct of_device_id bcm4908_pinctrl_of_match_table[] = {\n\t{ .compatible = \"brcm,bcm4908-pinctrl\", },\n\t{ }\n};\n\nstatic int bcm4908_pinctrl_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct bcm4908_pinctrl *bcm4908_pinctrl;\n\tstruct pinctrl_desc *pctldesc;\n\tstruct pinctrl_pin_desc *pins;\n\tchar **pin_names;\n\tint i;\n\n\tbcm4908_pinctrl = devm_kzalloc(dev, sizeof(*bcm4908_pinctrl), GFP_KERNEL);\n\tif (!bcm4908_pinctrl)\n\t\treturn -ENOMEM;\n\tpctldesc = &bcm4908_pinctrl->pctldesc;\n\tplatform_set_drvdata(pdev, bcm4908_pinctrl);\n\n\t \n\n\tbcm4908_pinctrl->dev = dev;\n\n\tbcm4908_pinctrl->base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(bcm4908_pinctrl->base))\n\t\treturn PTR_ERR(bcm4908_pinctrl->base);\n\n\tmutex_init(&bcm4908_pinctrl->mutex);\n\n\tmemcpy(pctldesc, &bcm4908_pinctrl_desc, sizeof(*pctldesc));\n\n\t \n\n\tpin_names = devm_kasprintf_strarray(dev, \"pin\", BCM4908_NUM_PINS);\n\tif (IS_ERR(pin_names))\n\t\treturn PTR_ERR(pin_names);\n\n\tpins = devm_kcalloc(dev, BCM4908_NUM_PINS, sizeof(*pins), GFP_KERNEL);\n\tif (!pins)\n\t\treturn -ENOMEM;\n\tfor (i = 0; i < BCM4908_NUM_PINS; i++) {\n\t\tpins[i].number = i;\n\t\tpins[i].name = pin_names[i];\n\t}\n\tpctldesc->pins = pins;\n\tpctldesc->npins = BCM4908_NUM_PINS;\n\n\t \n\n\tbcm4908_pinctrl->pctldev = devm_pinctrl_register(dev, pctldesc, bcm4908_pinctrl);\n\tif (IS_ERR(bcm4908_pinctrl->pctldev))\n\t\treturn dev_err_probe(dev, PTR_ERR(bcm4908_pinctrl->pctldev),\n\t\t\t\t     \"Failed to register pinctrl\\n\");\n\n\t \n\n\tfor (i = 0; i < ARRAY_SIZE(bcm4908_pinctrl_grps); i++) {\n\t\tconst struct bcm4908_pinctrl_grp *group = &bcm4908_pinctrl_grps[i];\n\t\tint *pins;\n\t\tint j;\n\n\t\tpins = devm_kcalloc(dev, group->num_pins, sizeof(*pins), GFP_KERNEL);\n\t\tif (!pins)\n\t\t\treturn -ENOMEM;\n\t\tfor (j = 0; j < group->num_pins; j++)\n\t\t\tpins[j] = group->pins[j].number;\n\n\t\tpinctrl_generic_add_group(bcm4908_pinctrl->pctldev, group->name,\n\t\t\t\t\t  pins, group->num_pins, (void *)group);\n\t}\n\n\t \n\n\tfor (i = 0; i < ARRAY_SIZE(bcm4908_pinctrl_functions); i++) {\n\t\tconst struct bcm4908_pinctrl_function *function = &bcm4908_pinctrl_functions[i];\n\n\t\tpinmux_generic_add_function(bcm4908_pinctrl->pctldev,\n\t\t\t\t\t    function->name,\n\t\t\t\t\t    function->groups,\n\t\t\t\t\t    function->num_groups, NULL);\n\t}\n\n\treturn 0;\n}\n\nstatic struct platform_driver bcm4908_pinctrl_driver = {\n\t.probe = bcm4908_pinctrl_probe,\n\t.driver = {\n\t\t.name = \"bcm4908-pinctrl\",\n\t\t.of_match_table = bcm4908_pinctrl_of_match_table,\n\t},\n};\n\nmodule_platform_driver(bcm4908_pinctrl_driver);\n\nMODULE_AUTHOR(\"Rafa\u0142 Mi\u0142ecki\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DEVICE_TABLE(of, bcm4908_pinctrl_of_match_table);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}