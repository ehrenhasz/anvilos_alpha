{
  "module_name": "pinctrl-artpec6.c",
  "hash_id": "a05a1a47c401373c557d31bded8f5990e1318566ac2e884d4d71bbed2d304454",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/pinctrl-artpec6.c",
  "human_readable_source": " \n\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinconf-generic.h>\n#include <linux/pinctrl/pinconf.h>\n#include <linux/pinctrl/pinmux.h>\n#include <linux/slab.h>\n#include \"core.h\"\n#include \"pinconf.h\"\n#include \"pinctrl-utils.h\"\n\n#define ARTPEC6_LAST_PIN\t97\t \n#define ARTPEC6_MAX_MUXABLE\t35\t \n\n \n#define ARTPEC6_PINMUX_UDC0_MASK\t0x00000001\n#define ARTPEC6_PINMUX_UDC0_SHIFT\t0\n#define ARTPEC6_PINMUX_UDC1_MASK\t0x00000002\n#define ARTPEC6_PINMUX_UDC1_SHIFT\t1\n#define ARTPEC6_PINMUX_DRV_MASK\t\t0x00000060\n#define ARTPEC6_PINMUX_DRV_SHIFT\t5\n#define ARTPEC6_PINMUX_SEL_MASK\t\t0x00003000\n#define ARTPEC6_PINMUX_SEL_SHIFT\t12\n\n \n#define ARTPEC6_CONFIG_0\t\t0\n#define ARTPEC6_CONFIG_1\t\t1\n#define ARTPEC6_CONFIG_2\t\t2\n#define ARTPEC6_CONFIG_3\t\t3\n\n \n#define ARTPEC6_DRIVE_4mA\t\t4\n#define ARTPEC6_DRIVE_4mA_SET\t\t0\n#define ARTPEC6_DRIVE_6mA\t\t6\n#define ARTPEC6_DRIVE_6mA_SET\t\t1\n#define ARTPEC6_DRIVE_8mA\t\t8\n#define ARTPEC6_DRIVE_8mA_SET\t\t2\n#define ARTPEC6_DRIVE_9mA\t\t9\n#define ARTPEC6_DRIVE_9mA_SET\t\t3\n\nstruct artpec6_pmx {\n\tstruct device\t\t\t*dev;\n\tstruct pinctrl_dev\t\t*pctl;\n\tvoid __iomem\t\t\t*base;\n\tstruct pinctrl_pin_desc\t\t*pins;\n\tunsigned int\t\t\tnum_pins;\n\tconst struct artpec6_pin_group\t*pin_groups;\n\tunsigned int\t\t\tnum_pin_groups;\n\tconst struct artpec6_pmx_func\t*functions;\n\tunsigned int\t\t\tnum_functions;\n};\n\nstruct artpec6_pin_group {\n\tconst char\t   *name;\n\tconst unsigned int *pins;\n\tconst unsigned int num_pins;\n\tunsigned char\t   config;\n};\n\nstruct artpec6_pmx_func {\n\tconst char\t   *name;\n\tconst char * const *groups;\n\tconst unsigned int num_groups;\n};\n\n \nstatic struct pinctrl_pin_desc artpec6_pins[] = {\n\tPINCTRL_PIN(0, \"GPIO0\"),\n\tPINCTRL_PIN(1, \"GPIO1\"),\n\tPINCTRL_PIN(2, \"GPIO2\"),\n\tPINCTRL_PIN(3, \"GPIO3\"),\n\tPINCTRL_PIN(4, \"GPIO4\"),\n\tPINCTRL_PIN(5, \"GPIO5\"),\n\tPINCTRL_PIN(6, \"GPIO6\"),\n\tPINCTRL_PIN(7, \"GPIO7\"),\n\tPINCTRL_PIN(8, \"GPIO8\"),\n\tPINCTRL_PIN(9, \"GPIO9\"),\n\tPINCTRL_PIN(10, \"GPIO10\"),\n\tPINCTRL_PIN(11, \"GPIO11\"),\n\tPINCTRL_PIN(12, \"GPIO12\"),\n\tPINCTRL_PIN(13, \"GPIO13\"),\n\tPINCTRL_PIN(14, \"GPIO14\"),\n\tPINCTRL_PIN(15, \"GPIO15\"),\n\tPINCTRL_PIN(16, \"GPIO16\"),\n\tPINCTRL_PIN(17, \"GPIO17\"),\n\tPINCTRL_PIN(18, \"GPIO18\"),\n\tPINCTRL_PIN(19, \"GPIO19\"),\n\tPINCTRL_PIN(20, \"GPIO20\"),\n\tPINCTRL_PIN(21, \"GPIO21\"),\n\tPINCTRL_PIN(22, \"GPIO22\"),\n\tPINCTRL_PIN(23, \"GPIO23\"),\n\tPINCTRL_PIN(24, \"GPIO24\"),\n\tPINCTRL_PIN(25, \"GPIO25\"),\n\tPINCTRL_PIN(26, \"GPIO26\"),\n\tPINCTRL_PIN(27, \"GPIO27\"),\n\tPINCTRL_PIN(28, \"GPIO28\"),\n\tPINCTRL_PIN(29, \"GPIO29\"),\n\tPINCTRL_PIN(30, \"GPIO30\"),\n\tPINCTRL_PIN(31, \"GPIO31\"),\n\tPINCTRL_PIN(32, \"UART3_TXD\"),\n\tPINCTRL_PIN(33, \"UART3_RXD\"),\n\tPINCTRL_PIN(34, \"UART3_RTS\"),\n\tPINCTRL_PIN(35, \"UART3_CTS\"),\n\tPINCTRL_PIN(36, \"NF_ALE\"),\n\tPINCTRL_PIN(37, \"NF_CE0_N\"),\n\tPINCTRL_PIN(38, \"NF_CE1_N\"),\n\tPINCTRL_PIN(39, \"NF_CLE\"),\n\tPINCTRL_PIN(40, \"NF_RE_N\"),\n\tPINCTRL_PIN(41, \"NF_WE_N\"),\n\tPINCTRL_PIN(42, \"NF_WP0_N\"),\n\tPINCTRL_PIN(43, \"NF_WP1_N\"),\n\tPINCTRL_PIN(44, \"NF_IO0\"),\n\tPINCTRL_PIN(45, \"NF_IO1\"),\n\tPINCTRL_PIN(46, \"NF_IO2\"),\n\tPINCTRL_PIN(47, \"NF_IO3\"),\n\tPINCTRL_PIN(48, \"NF_IO4\"),\n\tPINCTRL_PIN(49, \"NF_IO5\"),\n\tPINCTRL_PIN(50, \"NF_IO6\"),\n\tPINCTRL_PIN(51, \"NF_IO7\"),\n\tPINCTRL_PIN(52, \"NF_RB0_N\"),\n\tPINCTRL_PIN(53, \"SDIO0_CLK\"),\n\tPINCTRL_PIN(54, \"SDIO0_CMD\"),\n\tPINCTRL_PIN(55, \"SDIO0_DAT0\"),\n\tPINCTRL_PIN(56, \"SDIO0_DAT1\"),\n\tPINCTRL_PIN(57, \"SDIO0_DAT2\"),\n\tPINCTRL_PIN(58, \"SDIO0_DAT3\"),\n\tPINCTRL_PIN(59, \"SDI0_CD\"),\n\tPINCTRL_PIN(60, \"SDI0_WP\"),\n\tPINCTRL_PIN(61, \"SDIO1_CLK\"),\n\tPINCTRL_PIN(62, \"SDIO1_CMD\"),\n\tPINCTRL_PIN(63, \"SDIO1_DAT0\"),\n\tPINCTRL_PIN(64, \"SDIO1_DAT1\"),\n\tPINCTRL_PIN(65, \"SDIO1_DAT2\"),\n\tPINCTRL_PIN(66, \"SDIO1_DAT3\"),\n\tPINCTRL_PIN(67, \"SDIO1_CD\"),\n\tPINCTRL_PIN(68, \"SDIO1_WP\"),\n\tPINCTRL_PIN(69, \"GBE_REFCLk\"),\n\tPINCTRL_PIN(70, \"GBE_GTX_CLK\"),\n\tPINCTRL_PIN(71, \"GBE_TX_CLK\"),\n\tPINCTRL_PIN(72, \"GBE_TX_EN\"),\n\tPINCTRL_PIN(73, \"GBE_TX_ER\"),\n\tPINCTRL_PIN(74, \"GBE_TXD0\"),\n\tPINCTRL_PIN(75, \"GBE_TXD1\"),\n\tPINCTRL_PIN(76, \"GBE_TXD2\"),\n\tPINCTRL_PIN(77, \"GBE_TXD3\"),\n\tPINCTRL_PIN(78, \"GBE_TXD4\"),\n\tPINCTRL_PIN(79, \"GBE_TXD5\"),\n\tPINCTRL_PIN(80, \"GBE_TXD6\"),\n\tPINCTRL_PIN(81, \"GBE_TXD7\"),\n\tPINCTRL_PIN(82, \"GBE_RX_CLK\"),\n\tPINCTRL_PIN(83, \"GBE_RX_DV\"),\n\tPINCTRL_PIN(84, \"GBE_RX_ER\"),\n\tPINCTRL_PIN(85, \"GBE_RXD0\"),\n\tPINCTRL_PIN(86, \"GBE_RXD1\"),\n\tPINCTRL_PIN(87, \"GBE_RXD2\"),\n\tPINCTRL_PIN(88, \"GBE_RXD3\"),\n\tPINCTRL_PIN(89, \"GBE_RXD4\"),\n\tPINCTRL_PIN(90, \"GBE_RXD5\"),\n\tPINCTRL_PIN(91, \"GBE_RXD6\"),\n\tPINCTRL_PIN(92, \"GBE_RXD7\"),\n\tPINCTRL_PIN(93, \"GBE_CRS\"),\n\tPINCTRL_PIN(94, \"GBE_COL\"),\n\tPINCTRL_PIN(95, \"GBE_MDC\"),\n\tPINCTRL_PIN(96, \"GBE_MDIO\"),\n};\n\nstatic const unsigned int cpuclkout_pins0[] = { 0 };\nstatic const unsigned int udlclkout_pins0[] = { 1 };\nstatic const unsigned int i2c1_pins0[] = { 2, 3 };\nstatic const unsigned int i2c2_pins0[] = { 4, 5 };\nstatic const unsigned int i2c3_pins0[] = { 6, 7 };\nstatic const unsigned int i2s0_pins0[] = { 8, 9, 10, 11 };\nstatic const unsigned int i2s1_pins0[] = { 12, 13, 14, 15 };\nstatic const unsigned int i2srefclk_pins0[] = { 19 };\nstatic const unsigned int spi0_pins0[] = { 12, 13, 14, 15 };\nstatic const unsigned int spi1_pins0[] = { 16, 17, 18, 19 };\nstatic const unsigned int pciedebug_pins0[] = { 12, 13, 14, 15 };\nstatic const unsigned int uart0_pins0[] = { 16, 17, 18, 19, 20,\n\t\t\t\t\t    21, 22, 23, 24, 25 };\nstatic const unsigned int uart0_pins1[] = { 20, 21, 22, 23 };\nstatic const unsigned int uart1_pins0[] = { 24, 25, 26, 27 };\nstatic const unsigned int uart2_pins0[] = { 26, 27, 28, 29, 30,\n\t\t\t\t\t    31, 32, 33, 34, 35 };\nstatic const unsigned int uart2_pins1[] = { 28, 29, 30, 31 };\nstatic const unsigned int uart3_pins0[] = { 32, 33, 34, 35 };\nstatic const unsigned int uart4_pins0[] = { 20, 21, 22, 23 };\nstatic const unsigned int uart5_pins0[] = { 28, 29, 30, 31 };\nstatic const unsigned int nand_pins0[]  = { 36, 37, 38, 39, 40, 41,\n\t\t\t\t\t    42, 43, 44, 45, 46, 47,\n\t\t\t\t\t    48, 49, 50, 51, 52 };\nstatic const unsigned int sdio0_pins0[] = { 53, 54, 55, 56, 57, 58, 59, 60 };\nstatic const unsigned int sdio1_pins0[] = { 61, 62, 63, 64, 65, 66, 67, 68 };\nstatic const unsigned int ethernet_pins0[]  = { 69, 70, 71, 72, 73, 74, 75,\n\t\t\t\t\t\t76, 77, 78, 79, 80, 81, 82,\n\t\t\t\t\t\t83, 84,\t85, 86, 87, 88, 89,\n\t\t\t\t\t\t90, 91, 92, 93, 94, 95, 96 };\n\nstatic const struct artpec6_pin_group artpec6_pin_groups[] = {\n\t{\n\t\t.name = \"cpuclkoutgrp0\",\n\t\t.pins = cpuclkout_pins0,\n\t\t.num_pins = ARRAY_SIZE(cpuclkout_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"udlclkoutgrp0\",\n\t\t.pins = udlclkout_pins0,\n\t\t.num_pins = ARRAY_SIZE(udlclkout_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"i2c1grp0\",\n\t\t.pins = i2c1_pins0,\n\t\t.num_pins = ARRAY_SIZE(i2c1_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"i2c2grp0\",\n\t\t.pins = i2c2_pins0,\n\t\t.num_pins = ARRAY_SIZE(i2c2_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"i2c3grp0\",\n\t\t.pins = i2c3_pins0,\n\t\t.num_pins = ARRAY_SIZE(i2c3_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"i2s0grp0\",\n\t\t.pins = i2s0_pins0,\n\t\t.num_pins = ARRAY_SIZE(i2s0_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"i2s1grp0\",\n\t\t.pins = i2s1_pins0,\n\t\t.num_pins = ARRAY_SIZE(i2s1_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"i2srefclkgrp0\",\n\t\t.pins = i2srefclk_pins0,\n\t\t.num_pins = ARRAY_SIZE(i2srefclk_pins0),\n\t\t.config = ARTPEC6_CONFIG_3,\n\t},\n\t{\n\t\t.name = \"spi0grp0\",\n\t\t.pins = spi0_pins0,\n\t\t.num_pins = ARRAY_SIZE(spi0_pins0),\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"spi1grp0\",\n\t\t.pins = spi1_pins0,\n\t\t.num_pins = ARRAY_SIZE(spi1_pins0),\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"pciedebuggrp0\",\n\t\t.pins = pciedebug_pins0,\n\t\t.num_pins = ARRAY_SIZE(pciedebug_pins0),\n\t\t.config = ARTPEC6_CONFIG_3,\n\t},\n\t{\n\t\t.name = \"uart0grp0\",\t \n\t\t.pins = uart0_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart0_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"uart0grp1\",\t \n\t\t.pins = uart0_pins1,\n\t\t.num_pins = ARRAY_SIZE(uart0_pins1),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"uart0grp2\",\t \n\t\t.pins = uart0_pins1,\n\t\t.num_pins = ARRAY_SIZE(uart0_pins1) - 2,\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"uart1grp0\",\t \n\t\t.pins = uart1_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart1_pins0),\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"uart1grp1\",\t \n\t\t.pins = uart1_pins0,\n\t\t.num_pins = 2,\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"uart2grp0\",\t \n\t\t.pins = uart2_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart2_pins0),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"uart2grp1\",\t \n\t\t.pins = uart2_pins1,\n\t\t.num_pins = ARRAY_SIZE(uart2_pins1),\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"uart2grp2\",\t \n\t\t.pins = uart2_pins1,\n\t\t.num_pins = 2,\n\t\t.config = ARTPEC6_CONFIG_1,\n\t},\n\t{\n\t\t.name = \"uart3grp0\",\t \n\t\t.pins = uart3_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart3_pins0),\n\t\t.config = ARTPEC6_CONFIG_0,\n\t},\n\t{\n\t\t.name = \"uart3grp1\",\t \n\t\t.pins = uart3_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart3_pins0),\n\t\t.config = ARTPEC6_CONFIG_0,\n\t},\n\t{\n\t\t.name = \"uart4grp0\",\n\t\t.pins = uart4_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart4_pins0),\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"uart5grp0\",\t \n\t\t.pins = uart5_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart5_pins0),\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"uart5grp1\",\t \n\t\t.pins = uart5_pins0,\n\t\t.num_pins = 2,\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"uart5nocts\",\t \n\t\t.pins = uart5_pins0,\n\t\t.num_pins = ARRAY_SIZE(uart5_pins0) - 1,\n\t\t.config = ARTPEC6_CONFIG_2,\n\t},\n\t{\n\t\t.name = \"nandgrp0\",\n\t\t.pins = nand_pins0,\n\t\t.num_pins = ARRAY_SIZE(nand_pins0),\n\t\t.config = ARTPEC6_CONFIG_0,\n\t},\n\t{\n\t\t.name = \"sdio0grp0\",\n\t\t.pins = sdio0_pins0,\n\t\t.num_pins = ARRAY_SIZE(sdio0_pins0),\n\t\t.config = ARTPEC6_CONFIG_0,\n\t},\n\t{\n\t\t.name = \"sdio1grp0\",\n\t\t.pins = sdio1_pins0,\n\t\t.num_pins = ARRAY_SIZE(sdio1_pins0),\n\t\t.config = ARTPEC6_CONFIG_0,\n\t},\n\t{\n\t\t.name = \"ethernetgrp0\",\n\t\t.pins = ethernet_pins0,\n\t\t.num_pins = ARRAY_SIZE(ethernet_pins0),\n\t\t.config = ARTPEC6_CONFIG_0,\n\t},\n};\n\nstruct pin_register {\n\tunsigned int start;\n\tunsigned int end;\n\tunsigned int reg_base;\n};\n\n \nstatic const struct pin_register pin_register[] = {\n\t{ 0, 35, 0x0 },\t\t \n\t{ 36, 52, 0x100 },\t \n\t{ 53, 96, 0x180 },\t \n};\n\nstatic unsigned int artpec6_pmx_reg_offset(unsigned int pin)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(pin_register); i++) {\n\t\tif (pin <= pin_register[i].end) {\n\t\t\treturn (pin - pin_register[i].start) * 4 +\n\t\t\t\tpin_register[i].reg_base;\n\t\t}\n\t}\n\t \n\tpr_err(\"%s: Impossible pin %d\\n\", __func__, pin);\n\treturn 0;\n}\n\nstatic int artpec6_get_groups_count(struct pinctrl_dev *pctldev)\n{\n\treturn ARRAY_SIZE(artpec6_pin_groups);\n}\n\nstatic const char *artpec6_get_group_name(struct pinctrl_dev *pctldev,\n\t\t\t\t\t  unsigned int group)\n{\n\treturn artpec6_pin_groups[group].name;\n}\n\nstatic int artpec6_get_group_pins(struct pinctrl_dev *pctldev,\n\t\t\t\t  unsigned int group,\n\t\t\t\t  const unsigned int **pins,\n\t\t\t\t  unsigned int *num_pins)\n{\n\t*pins = (unsigned int *)artpec6_pin_groups[group].pins;\n\t*num_pins = artpec6_pin_groups[group].num_pins;\n\treturn 0;\n}\n\nstatic int artpec6_pconf_drive_mA_to_field(unsigned int mA)\n{\n\tswitch (mA) {\n\tcase ARTPEC6_DRIVE_4mA:\n\t\treturn ARTPEC6_DRIVE_4mA_SET;\n\tcase ARTPEC6_DRIVE_6mA:\n\t\treturn ARTPEC6_DRIVE_6mA_SET;\n\tcase ARTPEC6_DRIVE_8mA:\n\t\treturn ARTPEC6_DRIVE_8mA_SET;\n\tcase ARTPEC6_DRIVE_9mA:\n\t\treturn ARTPEC6_DRIVE_9mA_SET;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic unsigned int artpec6_pconf_drive_field_to_mA(int field)\n{\n\tswitch (field) {\n\tcase ARTPEC6_DRIVE_4mA_SET:\n\t\treturn ARTPEC6_DRIVE_4mA;\n\tcase ARTPEC6_DRIVE_6mA_SET:\n\t\treturn ARTPEC6_DRIVE_6mA;\n\tcase ARTPEC6_DRIVE_8mA_SET:\n\t\treturn ARTPEC6_DRIVE_8mA;\n\tcase ARTPEC6_DRIVE_9mA_SET:\n\t\treturn ARTPEC6_DRIVE_9mA;\n\tdefault:\n\t\t \n\t\treturn 0;\n\t}\n}\n\nstatic const struct pinctrl_ops artpec6_pctrl_ops = {\n\t.get_group_pins\t\t= artpec6_get_group_pins,\n\t.get_groups_count\t= artpec6_get_groups_count,\n\t.get_group_name\t\t= artpec6_get_group_name,\n\t.dt_node_to_map\t\t= pinconf_generic_dt_node_to_map_all,\n\t.dt_free_map\t\t= pinctrl_utils_free_map,\n};\n\nstatic const char * const gpiogrps[] = {\n\t\"cpuclkoutgrp0\", \"udlclkoutgrp0\", \"i2c1grp0\", \"i2c2grp0\",\n\t\"i2c3grp0\", \"i2s0grp0\", \"i2s1grp0\", \"i2srefclkgrp0\",\n\t\"spi0grp0\", \"spi1grp0\", \"pciedebuggrp0\", \"uart0grp0\",\n\t\"uart0grp1\", \"uart0grp2\", \"uart1grp0\", \"uart1grp1\",\n\t\"uart2grp0\", \"uart2grp1\", \"uart2grp2\", \"uart4grp0\", \"uart5grp0\",\n\t\"uart5grp1\", \"uart5nocts\",\n};\nstatic const char * const cpuclkoutgrps[] = { \"cpuclkoutgrp0\" };\nstatic const char * const udlclkoutgrps[] = { \"udlclkoutgrp0\" };\nstatic const char * const i2c1grps[]\t  = { \"i2c1grp0\" };\nstatic const char * const i2c2grps[]\t  = { \"i2c2grp0\" };\nstatic const char * const i2c3grps[]\t  = { \"i2c3grp0\" };\nstatic const char * const i2s0grps[]\t  = { \"i2s0grp0\" };\nstatic const char * const i2s1grps[]\t  = { \"i2s1grp0\" };\nstatic const char * const i2srefclkgrps[] = { \"i2srefclkgrp0\" };\nstatic const char * const spi0grps[]\t  = { \"spi0grp0\" };\nstatic const char * const spi1grps[]\t  = { \"spi1grp0\" };\nstatic const char * const pciedebuggrps[] = { \"pciedebuggrp0\" };\nstatic const char * const uart0grps[]\t  = { \"uart0grp0\", \"uart0grp1\",\n\t\t\t\t\t      \"uart0grp2\" };\nstatic const char * const uart1grps[]\t  = { \"uart1grp0\", \"uart1grp1\" };\nstatic const char * const uart2grps[]\t  = { \"uart2grp0\", \"uart2grp1\",\n\t\t\t\t\t      \"uart2grp2\" };\nstatic const char * const uart3grps[]\t  = { \"uart3grp0\" };\nstatic const char * const uart4grps[]\t  = { \"uart4grp0\", \"uart4grp1\" };\nstatic const char * const uart5grps[]\t  = { \"uart5grp0\", \"uart5grp1\",\n\t\t\t\t\t      \"uart5nocts\" };\nstatic const char * const nandgrps[]\t  = { \"nandgrp0\" };\nstatic const char * const sdio0grps[]\t  = { \"sdio0grp0\" };\nstatic const char * const sdio1grps[]\t  = { \"sdio1grp0\" };\nstatic const char * const ethernetgrps[]  = { \"ethernetgrp0\" };\n\nstatic const struct artpec6_pmx_func artpec6_pmx_functions[] = {\n\t{\n\t\t.name = \"gpio\",\n\t\t.groups = gpiogrps,\n\t\t.num_groups = ARRAY_SIZE(gpiogrps),\n\t},\n\t{\n\t\t.name = \"cpuclkout\",\n\t\t.groups = cpuclkoutgrps,\n\t\t.num_groups = ARRAY_SIZE(cpuclkoutgrps),\n\t},\n\t{\n\t\t.name = \"udlclkout\",\n\t\t.groups = udlclkoutgrps,\n\t\t.num_groups = ARRAY_SIZE(udlclkoutgrps),\n\t},\n\t{\n\t\t.name = \"i2c1\",\n\t\t.groups = i2c1grps,\n\t\t.num_groups = ARRAY_SIZE(i2c1grps),\n\t},\n\t{\n\t\t.name = \"i2c2\",\n\t\t.groups = i2c2grps,\n\t\t.num_groups = ARRAY_SIZE(i2c2grps),\n\t},\n\t{\n\t\t.name = \"i2c3\",\n\t\t.groups = i2c3grps,\n\t\t.num_groups = ARRAY_SIZE(i2c3grps),\n\t},\n\t{\n\t\t.name = \"i2s0\",\n\t\t.groups = i2s0grps,\n\t\t.num_groups = ARRAY_SIZE(i2s0grps),\n\t},\n\t{\n\t\t.name = \"i2s1\",\n\t\t.groups = i2s1grps,\n\t\t.num_groups = ARRAY_SIZE(i2s1grps),\n\t},\n\t{\n\t\t.name = \"i2srefclk\",\n\t\t.groups = i2srefclkgrps,\n\t\t.num_groups = ARRAY_SIZE(i2srefclkgrps),\n\t},\n\t{\n\t\t.name = \"spi0\",\n\t\t.groups = spi0grps,\n\t\t.num_groups = ARRAY_SIZE(spi0grps),\n\t},\n\t{\n\t\t.name = \"spi1\",\n\t\t.groups = spi1grps,\n\t\t.num_groups = ARRAY_SIZE(spi1grps),\n\t},\n\t{\n\t\t.name = \"pciedebug\",\n\t\t.groups = pciedebuggrps,\n\t\t.num_groups = ARRAY_SIZE(pciedebuggrps),\n\t},\n\t{\n\t\t.name = \"uart0\",\n\t\t.groups = uart0grps,\n\t\t.num_groups = ARRAY_SIZE(uart0grps),\n\t},\n\t{\n\t\t.name = \"uart1\",\n\t\t.groups = uart1grps,\n\t\t.num_groups = ARRAY_SIZE(uart1grps),\n\t},\n\t{\n\t\t.name = \"uart2\",\n\t\t.groups = uart2grps,\n\t\t.num_groups = ARRAY_SIZE(uart2grps),\n\t},\n\t{\n\t\t.name = \"uart3\",\n\t\t.groups = uart3grps,\n\t\t.num_groups = ARRAY_SIZE(uart3grps),\n\t},\n\t{\n\t\t.name = \"uart4\",\n\t\t.groups = uart4grps,\n\t\t.num_groups = ARRAY_SIZE(uart4grps),\n\t},\n\t{\n\t\t.name = \"uart5\",\n\t\t.groups = uart5grps,\n\t\t.num_groups = ARRAY_SIZE(uart5grps),\n\t},\n\t{\n\t\t.name = \"nand\",\n\t\t.groups = nandgrps,\n\t\t.num_groups = ARRAY_SIZE(nandgrps),\n\t},\n\t{\n\t\t.name = \"sdio0\",\n\t\t.groups = sdio0grps,\n\t\t.num_groups = ARRAY_SIZE(sdio0grps),\n\t},\n\t{\n\t\t.name = \"sdio1\",\n\t\t.groups = sdio1grps,\n\t\t.num_groups = ARRAY_SIZE(sdio1grps),\n\t},\n\t{\n\t\t.name = \"ethernet\",\n\t\t.groups = ethernetgrps,\n\t\t.num_groups = ARRAY_SIZE(ethernetgrps),\n\t},\n};\n\nstatic int artpec6_pmx_get_functions_count(struct pinctrl_dev *pctldev)\n{\n\treturn ARRAY_SIZE(artpec6_pmx_functions);\n}\n\nstatic const char *artpec6_pmx_get_fname(struct pinctrl_dev *pctldev,\n\t\t\t\t\t unsigned int function)\n{\n\treturn artpec6_pmx_functions[function].name;\n}\n\nstatic int artpec6_pmx_get_fgroups(struct pinctrl_dev *pctldev,\n\t\t\t\t   unsigned int function,\n\t\t\t\t   const char * const **groups,\n\t\t\t\t   unsigned int * const num_groups)\n{\n\t*groups = artpec6_pmx_functions[function].groups;\n\t*num_groups = artpec6_pmx_functions[function].num_groups;\n\treturn 0;\n}\n\nstatic void artpec6_pmx_select_func(struct pinctrl_dev *pctldev,\n\t\t\t\t    unsigned int function, unsigned int group,\n\t\t\t\t    bool enable)\n{\n\tunsigned int regval, val;\n\tunsigned int reg;\n\tint i;\n\tstruct artpec6_pmx *pmx = pinctrl_dev_get_drvdata(pctldev);\n\n\tfor (i = 0; i < artpec6_pin_groups[group].num_pins; i++) {\n\t\t \n\t\tif (artpec6_pin_groups[group].pins[i] > ARTPEC6_MAX_MUXABLE)\n\t\t\tcontinue;\n\n\t\tif (!strcmp(artpec6_pmx_get_fname(pctldev, function), \"gpio\")) {\n\t\t\t \n\t\t\tval = ARTPEC6_CONFIG_0 << ARTPEC6_PINMUX_SEL_SHIFT;\n\t\t} else {\n\t\t\tif (enable)\n\t\t\t\tval = artpec6_pin_groups[group].config\n\t\t\t\t\t<< ARTPEC6_PINMUX_SEL_SHIFT;\n\t\t\telse\n\t\t\t\tval = ARTPEC6_CONFIG_0\n\t\t\t\t\t<< ARTPEC6_PINMUX_SEL_SHIFT;\n\t\t}\n\n\t\treg = artpec6_pmx_reg_offset(artpec6_pin_groups[group].pins[i]);\n\n\t\tregval = readl(pmx->base + reg);\n\t\tregval &= ~ARTPEC6_PINMUX_SEL_MASK;\n\t\tregval |= val;\n\t\twritel(regval, pmx->base + reg);\n\t}\n}\n\nstatic int artpec6_pmx_set(struct pinctrl_dev *pctldev,\n\t\t\t   unsigned int function,\n\t\t\t   unsigned int group)\n{\n\tstruct artpec6_pmx *pmx = pinctrl_dev_get_drvdata(pctldev);\n\n\tdev_dbg(pmx->dev, \"enabling %s function for pin group %s\\n\",\n\t\tartpec6_pmx_get_fname(pctldev, function),\n\t\tartpec6_get_group_name(pctldev, group));\n\n\tartpec6_pmx_select_func(pctldev, function, group, true);\n\n\treturn 0;\n}\n\nstatic int artpec6_pmx_request_gpio(struct pinctrl_dev *pctldev,\n\t\t\t\t    struct pinctrl_gpio_range *range,\n\t\t\t\t    unsigned int pin)\n{\n\tstruct artpec6_pmx *pmx = pinctrl_dev_get_drvdata(pctldev);\n\tunsigned int reg = artpec6_pmx_reg_offset(pin);\n\tu32 val;\n\n\tif (pin >= 32)\n\t\treturn -EINVAL;\n\n\tval = readl_relaxed(pmx->base + reg);\n\tval &= ~ARTPEC6_PINMUX_SEL_MASK;\n\tval |= ARTPEC6_CONFIG_0 << ARTPEC6_PINMUX_SEL_SHIFT;\n\twritel_relaxed(val, pmx->base + reg);\n\n\treturn 0;\n}\n\nstatic const struct pinmux_ops artpec6_pmx_ops = {\n\t.get_functions_count\t= artpec6_pmx_get_functions_count,\n\t.get_function_name\t= artpec6_pmx_get_fname,\n\t.get_function_groups\t= artpec6_pmx_get_fgroups,\n\t.set_mux\t\t= artpec6_pmx_set,\n\t.gpio_request_enable = artpec6_pmx_request_gpio,\n};\n\nstatic int artpec6_pconf_get(struct pinctrl_dev *pctldev, unsigned int pin,\n\t\t\t     unsigned long *config)\n{\n\tstruct artpec6_pmx *pmx = pinctrl_dev_get_drvdata(pctldev);\n\tenum pin_config_param param = pinconf_to_config_param(*config);\n\tunsigned int regval;\n\n\t \n\tif (pin >= pmx->num_pins) {\n\t\tdev_dbg(pmx->dev, \"pinconf is not supported for pin %s\\n\",\n\t\t\tpmx->pins[pin].name);\n\t\treturn -ENOTSUPP;\n\t}\n\n\tdev_dbg(pmx->dev, \"getting configuration for pin %s\\n\",\n\t\tpmx->pins[pin].name);\n\n\t \n\tregval = readl(pmx->base + artpec6_pmx_reg_offset(pin));\n\n\t \n\tswitch (param) {\n\tcase PIN_CONFIG_BIAS_DISABLE:\n\t\tif (!(regval & ARTPEC6_PINMUX_UDC1_MASK))\n\t\t\treturn -EINVAL;\n\t\tbreak;\n\n\tcase PIN_CONFIG_BIAS_PULL_UP:\n\tcase PIN_CONFIG_BIAS_PULL_DOWN:\n\t\tif (regval & ARTPEC6_PINMUX_UDC1_MASK)\n\t\t\treturn -EINVAL;\n\n\t\tregval = regval & ARTPEC6_PINMUX_UDC0_MASK;\n\t\tif ((param == PIN_CONFIG_BIAS_PULL_UP && !regval) ||\n\t\t    (param == PIN_CONFIG_BIAS_PULL_DOWN && regval))\n\t\t\treturn -EINVAL;\n\t\tbreak;\n\tcase PIN_CONFIG_DRIVE_STRENGTH:\n\t\tregval = (regval & ARTPEC6_PINMUX_DRV_MASK)\n\t\t\t>> ARTPEC6_PINMUX_DRV_SHIFT;\n\t\tregval = artpec6_pconf_drive_field_to_mA(regval);\n\t\t*config = pinconf_to_config_packed(param, regval);\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOTSUPP;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int artpec6_pconf_set(struct pinctrl_dev *pctldev, unsigned int pin,\n\t\t\t     unsigned long *configs, unsigned int num_configs)\n{\n\tstruct artpec6_pmx *pmx = pinctrl_dev_get_drvdata(pctldev);\n\tenum pin_config_param param;\n\tunsigned int arg;\n\tunsigned int regval;\n\tvoid __iomem *reg;\n\tint i;\n\n\t \n\tif (pin >= pmx->num_pins) {\n\t\tdev_dbg(pmx->dev, \"pinconf is not supported for pin %s\\n\",\n\t\t\tpmx->pins[pin].name);\n\t\treturn -ENOTSUPP;\n\t}\n\n\tdev_dbg(pmx->dev, \"setting configuration for pin %s\\n\",\n\t\tpmx->pins[pin].name);\n\n\treg = pmx->base + artpec6_pmx_reg_offset(pin);\n\n\t \n\tfor (i = 0; i < num_configs; i++) {\n\t\tint drive;\n\n\t\tparam = pinconf_to_config_param(configs[i]);\n\t\targ = pinconf_to_config_argument(configs[i]);\n\n\t\tswitch (param) {\n\t\tcase PIN_CONFIG_BIAS_DISABLE:\n\t\t\tregval = readl(reg);\n\t\t\tregval |= (1 << ARTPEC6_PINMUX_UDC1_SHIFT);\n\t\t\twritel(regval, reg);\n\t\t\tbreak;\n\n\t\tcase PIN_CONFIG_BIAS_PULL_UP:\n\t\t\tif (arg != 1) {\n\t\t\t\tdev_dbg(pctldev->dev, \"%s: arg %u out of range\\n\",\n\t\t\t\t\t__func__, arg);\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tregval = readl(reg);\n\t\t\tregval |= (arg << ARTPEC6_PINMUX_UDC0_SHIFT);\n\t\t\tregval &= ~ARTPEC6_PINMUX_UDC1_MASK;  \n\t\t\twritel(regval, reg);\n\t\t\tbreak;\n\n\t\tcase PIN_CONFIG_BIAS_PULL_DOWN:\n\t\t\tif (arg != 1) {\n\t\t\t\tdev_dbg(pctldev->dev, \"%s: arg %u out of range\\n\",\n\t\t\t\t\t__func__, arg);\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tregval = readl(reg);\n\t\t\tregval &= ~(arg << ARTPEC6_PINMUX_UDC0_SHIFT);\n\t\t\tregval &= ~ARTPEC6_PINMUX_UDC1_MASK;  \n\t\t\twritel(regval, reg);\n\t\t\tbreak;\n\n\t\tcase PIN_CONFIG_DRIVE_STRENGTH:\n\t\t\tdrive = artpec6_pconf_drive_mA_to_field(arg);\n\t\t\tif (drive < 0) {\n\t\t\t\tdev_dbg(pctldev->dev, \"%s: arg %u out of range\\n\",\n\t\t\t\t\t__func__, arg);\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tregval = readl(reg);\n\t\t\tregval &= ~ARTPEC6_PINMUX_DRV_MASK;\n\t\t\tregval |= (drive << ARTPEC6_PINMUX_DRV_SHIFT);\n\t\t\twritel(regval, reg);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tdev_dbg(pmx->dev, \"parameter not supported\\n\");\n\t\t\treturn -ENOTSUPP;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int artpec6_pconf_group_set(struct pinctrl_dev *pctldev,\n\t\t\t\t   unsigned int group, unsigned long *configs,\n\t\t\t\t   unsigned int num_configs)\n{\n\tunsigned int num_pins, current_pin;\n\tint ret;\n\n\tdev_dbg(pctldev->dev, \"setting group %s configuration\\n\",\n\t\tartpec6_get_group_name(pctldev, group));\n\n\tnum_pins = artpec6_pin_groups[group].num_pins;\n\n\tfor (current_pin = 0; current_pin < num_pins; current_pin++) {\n\t\tret = artpec6_pconf_set(pctldev,\n\t\t\t\tartpec6_pin_groups[group].pins[current_pin],\n\t\t\t\tconfigs, num_configs);\n\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct pinconf_ops artpec6_pconf_ops = {\n\t.is_generic\t\t= true,\n\t.pin_config_get\t\t= artpec6_pconf_get,\n\t.pin_config_set\t\t= artpec6_pconf_set,\n\t.pin_config_group_set\t= artpec6_pconf_group_set,\n};\n\nstatic struct pinctrl_desc artpec6_desc = {\n\t.name\t = \"artpec6-pinctrl\",\n\t.owner\t = THIS_MODULE,\n\t.pins\t = artpec6_pins,\n\t.npins\t = ARRAY_SIZE(artpec6_pins),\n\t.pctlops = &artpec6_pctrl_ops,\n\t.pmxops\t = &artpec6_pmx_ops,\n\t.confops = &artpec6_pconf_ops,\n};\n\n \nstatic void artpec6_pmx_reset(struct artpec6_pmx *pmx)\n{\n\tvoid __iomem *base = pmx->base;\n\tint i;\n\n\tfor (i = 0; i < ARTPEC6_LAST_PIN; i++) {\n\t\tu32 val;\n\n\t\tval = readl_relaxed(base + artpec6_pmx_reg_offset(i));\n\t\tval &= ~ARTPEC6_PINMUX_DRV_MASK;\n\t\tval |= ARTPEC6_DRIVE_8mA_SET << ARTPEC6_PINMUX_DRV_SHIFT;\n\t\twritel_relaxed(val, base + artpec6_pmx_reg_offset(i));\n\t}\n}\n\nstatic int artpec6_pmx_probe(struct platform_device *pdev)\n{\n\tstruct artpec6_pmx *pmx;\n\n\tpmx = devm_kzalloc(&pdev->dev, sizeof(*pmx), GFP_KERNEL);\n\tif (!pmx)\n\t\treturn -ENOMEM;\n\n\tpmx->dev = &pdev->dev;\n\n\tpmx->base = devm_platform_ioremap_resource(pdev, 0);\n\n\tif (IS_ERR(pmx->base))\n\t\treturn PTR_ERR(pmx->base);\n\n\tartpec6_pmx_reset(pmx);\n\n\tpmx->pins\t    = artpec6_pins;\n\tpmx->num_pins\t    = ARRAY_SIZE(artpec6_pins);\n\tpmx->functions\t    = artpec6_pmx_functions;\n\tpmx->num_functions  = ARRAY_SIZE(artpec6_pmx_functions);\n\tpmx->pin_groups\t    = artpec6_pin_groups;\n\tpmx->num_pin_groups = ARRAY_SIZE(artpec6_pin_groups);\n\tpmx->pctl\t    = pinctrl_register(&artpec6_desc, &pdev->dev, pmx);\n\n\tif (IS_ERR(pmx->pctl)) {\n\t\tdev_err(&pdev->dev, \"could not register pinctrl driver\\n\");\n\t\treturn PTR_ERR(pmx->pctl);\n\t}\n\n\tplatform_set_drvdata(pdev, pmx);\n\n\tdev_info(&pdev->dev, \"initialised Axis ARTPEC-6 pinctrl driver\\n\");\n\n\treturn 0;\n}\n\nstatic int artpec6_pmx_remove(struct platform_device *pdev)\n{\n\tstruct artpec6_pmx *pmx = platform_get_drvdata(pdev);\n\n\tpinctrl_unregister(pmx->pctl);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id artpec6_pinctrl_match[] = {\n\t{ .compatible = \"axis,artpec6-pinctrl\" },\n\t{},\n};\n\nstatic struct platform_driver artpec6_pmx_driver = {\n\t.driver = {\n\t\t.name = \"artpec6-pinctrl\",\n\t\t.of_match_table = artpec6_pinctrl_match,\n\t},\n\t.probe = artpec6_pmx_probe,\n\t.remove = artpec6_pmx_remove,\n};\n\nstatic int __init artpec6_pmx_init(void)\n{\n\treturn platform_driver_register(&artpec6_pmx_driver);\n}\narch_initcall(artpec6_pmx_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}