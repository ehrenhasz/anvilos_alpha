{
  "module_name": "pinctrl-tb10x.c",
  "hash_id": "6f6ee1a64a7bfe26972ada2990473c696ca4e9b65d3cff888670728ab83ed274",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/pinctrl-tb10x.c",
  "human_readable_source": "\n \n\n#include <linux/stringify.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/pinctrl/pinmux.h>\n#include <linux/pinctrl/machine.h>\n#include <linux/platform_device.h>\n#include <linux/module.h>\n#include <linux/mutex.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/slab.h>\n\n#include \"pinctrl-utils.h\"\n\n#define TB10X_PORT1 (0)\n#define TB10X_PORT2 (16)\n#define TB10X_PORT3 (32)\n#define TB10X_PORT4 (48)\n#define TB10X_PORT5 (128)\n#define TB10X_PORT6 (64)\n#define TB10X_PORT7 (80)\n#define TB10X_PORT8 (96)\n#define TB10X_PORT9 (112)\n#define TB10X_GPIOS (256)\n\n#define PCFG_PORT_BITWIDTH (2)\n#define PCFG_PORT_MASK(PORT) \\\n\t(((1 << PCFG_PORT_BITWIDTH) - 1) << (PCFG_PORT_BITWIDTH * (PORT)))\n\nstatic const struct pinctrl_pin_desc tb10x_pins[] = {\n\t \n\tPINCTRL_PIN(TB10X_PORT1 +  0, \"MICLK_S0\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  1, \"MISTRT_S0\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  2, \"MIVAL_S0\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  3, \"MDI_S0\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  4, \"GPIOA0\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  5, \"GPIOA1\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  6, \"GPIOA2\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  7, \"MDI_S1\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  8, \"MIVAL_S1\"),\n\tPINCTRL_PIN(TB10X_PORT1 +  9, \"MISTRT_S1\"),\n\tPINCTRL_PIN(TB10X_PORT1 + 10, \"MICLK_S1\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT2 +  0, \"MICLK_S2\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  1, \"MISTRT_S2\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  2, \"MIVAL_S2\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  3, \"MDI_S2\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  4, \"GPIOC0\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  5, \"GPIOC1\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  6, \"GPIOC2\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  7, \"MDI_S3\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  8, \"MIVAL_S3\"),\n\tPINCTRL_PIN(TB10X_PORT2 +  9, \"MISTRT_S3\"),\n\tPINCTRL_PIN(TB10X_PORT2 + 10, \"MICLK_S3\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT3 +  0, \"MICLK_S4\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  1, \"MISTRT_S4\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  2, \"MIVAL_S4\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  3, \"MDI_S4\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  4, \"GPIOE0\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  5, \"GPIOE1\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  6, \"GPIOE2\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  7, \"MDI_S5\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  8, \"MIVAL_S5\"),\n\tPINCTRL_PIN(TB10X_PORT3 +  9, \"MISTRT_S5\"),\n\tPINCTRL_PIN(TB10X_PORT3 + 10, \"MICLK_S5\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT4 +  0, \"MICLK_S6\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  1, \"MISTRT_S6\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  2, \"MIVAL_S6\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  3, \"MDI_S6\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  4, \"GPIOG0\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  5, \"GPIOG1\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  6, \"GPIOG2\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  7, \"MDI_S7\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  8, \"MIVAL_S7\"),\n\tPINCTRL_PIN(TB10X_PORT4 +  9, \"MISTRT_S7\"),\n\tPINCTRL_PIN(TB10X_PORT4 + 10, \"MICLK_S7\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT5 +  0, \"PC_CE1N\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  1, \"PC_CE2N\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  2, \"PC_REGN\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  3, \"PC_INPACKN\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  4, \"PC_OEN\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  5, \"PC_WEN\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  6, \"PC_IORDN\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  7, \"PC_IOWRN\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  8, \"PC_RDYIRQN\"),\n\tPINCTRL_PIN(TB10X_PORT5 +  9, \"PC_WAITN\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 10, \"PC_A0\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 11, \"PC_A1\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 12, \"PC_A2\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 13, \"PC_A3\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 14, \"PC_A4\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 15, \"PC_A5\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 16, \"PC_A6\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 17, \"PC_A7\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 18, \"PC_A8\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 19, \"PC_A9\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 20, \"PC_A10\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 21, \"PC_A11\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 22, \"PC_A12\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 23, \"PC_A13\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 24, \"PC_A14\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 25, \"PC_D0\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 26, \"PC_D1\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 27, \"PC_D2\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 28, \"PC_D3\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 29, \"PC_D4\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 30, \"PC_D5\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 31, \"PC_D6\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 32, \"PC_D7\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 33, \"PC_MOSTRT\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 34, \"PC_MOVAL\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 35, \"PC_MDO0\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 36, \"PC_MDO1\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 37, \"PC_MDO2\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 38, \"PC_MDO3\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 39, \"PC_MDO4\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 40, \"PC_MDO5\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 41, \"PC_MDO6\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 42, \"PC_MDO7\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 43, \"PC_MISTRT\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 44, \"PC_MIVAL\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 45, \"PC_MDI0\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 46, \"PC_MDI1\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 47, \"PC_MDI2\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 48, \"PC_MDI3\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 49, \"PC_MDI4\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 50, \"PC_MDI5\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 51, \"PC_MDI6\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 52, \"PC_MDI7\"),\n\tPINCTRL_PIN(TB10X_PORT5 + 53, \"PC_MICLK\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT6 + 0, \"T_MOSTRT_S0\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 1, \"T_MOVAL_S0\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 2, \"T_MDO_S0\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 3, \"T_MOSTRT_S1\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 4, \"T_MOVAL_S1\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 5, \"T_MDO_S1\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 6, \"T_MOSTRT_S2\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 7, \"T_MOVAL_S2\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 8, \"T_MDO_S2\"),\n\tPINCTRL_PIN(TB10X_PORT6 + 9, \"T_MOSTRT_S3\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT7 + 0, \"UART0_TXD\"),\n\tPINCTRL_PIN(TB10X_PORT7 + 1, \"UART0_RXD\"),\n\tPINCTRL_PIN(TB10X_PORT7 + 2, \"UART0_CTS\"),\n\tPINCTRL_PIN(TB10X_PORT7 + 3, \"UART0_RTS\"),\n\tPINCTRL_PIN(TB10X_PORT7 + 4, \"UART1_TXD\"),\n\tPINCTRL_PIN(TB10X_PORT7 + 5, \"UART1_RXD\"),\n\tPINCTRL_PIN(TB10X_PORT7 + 6, \"UART1_CTS\"),\n\tPINCTRL_PIN(TB10X_PORT7 + 7, \"UART1_RTS\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT8 + 0, \"SPI3_CLK\"),\n\tPINCTRL_PIN(TB10X_PORT8 + 1, \"SPI3_MISO\"),\n\tPINCTRL_PIN(TB10X_PORT8 + 2, \"SPI3_MOSI\"),\n\tPINCTRL_PIN(TB10X_PORT8 + 3, \"SPI3_SSN\"),\n\t \n\tPINCTRL_PIN(TB10X_PORT9 + 0, \"SPI1_CLK\"),\n\tPINCTRL_PIN(TB10X_PORT9 + 1, \"SPI1_MISO\"),\n\tPINCTRL_PIN(TB10X_PORT9 + 2, \"SPI1_MOSI\"),\n\tPINCTRL_PIN(TB10X_PORT9 + 3, \"SPI1_SSN0\"),\n\tPINCTRL_PIN(TB10X_PORT9 + 4, \"SPI1_SSN1\"),\n\t \n\tPINCTRL_PIN(TB10X_GPIOS +  0, \"GPIOB0\"),\n\tPINCTRL_PIN(TB10X_GPIOS +  1, \"GPIOB1\"),\n\n\tPINCTRL_PIN(TB10X_GPIOS +  2, \"GPIOD0\"),\n\tPINCTRL_PIN(TB10X_GPIOS +  3, \"GPIOD1\"),\n\n\tPINCTRL_PIN(TB10X_GPIOS +  4, \"GPIOF0\"),\n\tPINCTRL_PIN(TB10X_GPIOS +  5, \"GPIOF1\"),\n\n\tPINCTRL_PIN(TB10X_GPIOS +  6, \"GPIOH0\"),\n\tPINCTRL_PIN(TB10X_GPIOS +  7, \"GPIOH1\"),\n\n\tPINCTRL_PIN(TB10X_GPIOS +  8, \"GPIOI0\"),\n\tPINCTRL_PIN(TB10X_GPIOS +  9, \"GPIOI1\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 10, \"GPIOI2\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 11, \"GPIOI3\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 12, \"GPIOI4\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 13, \"GPIOI5\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 14, \"GPIOI6\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 15, \"GPIOI7\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 16, \"GPIOI8\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 17, \"GPIOI9\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 18, \"GPIOI10\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 19, \"GPIOI11\"),\n\n\tPINCTRL_PIN(TB10X_GPIOS + 20, \"GPION0\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 21, \"GPION1\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 22, \"GPION2\"),\n\tPINCTRL_PIN(TB10X_GPIOS + 23, \"GPION3\"),\n#define MAX_PIN (TB10X_GPIOS + 24)\n\tPINCTRL_PIN(MAX_PIN,  \"GPION4\"),\n};\n\n\n \nstatic const unsigned mis0_pins[]  = {\tTB10X_PORT1 + 0, TB10X_PORT1 + 1,\n\t\t\t\t\tTB10X_PORT1 + 2, TB10X_PORT1 + 3};\nstatic const unsigned gpioa_pins[] = {\tTB10X_PORT1 + 4, TB10X_PORT1 + 5,\n\t\t\t\t\tTB10X_PORT1 + 6};\nstatic const unsigned mis1_pins[]  = {\tTB10X_PORT1 + 7, TB10X_PORT1 + 8,\n\t\t\t\t\tTB10X_PORT1 + 9, TB10X_PORT1 + 10};\nstatic const unsigned mip1_pins[]  = {\tTB10X_PORT1 + 0, TB10X_PORT1 + 1,\n\t\t\t\t\tTB10X_PORT1 + 2, TB10X_PORT1 + 3,\n\t\t\t\t\tTB10X_PORT1 + 4, TB10X_PORT1 + 5,\n\t\t\t\t\tTB10X_PORT1 + 6, TB10X_PORT1 + 7,\n\t\t\t\t\tTB10X_PORT1 + 8, TB10X_PORT1 + 9,\n\t\t\t\t\tTB10X_PORT1 + 10};\n\n \nstatic const unsigned mis2_pins[]  = {\tTB10X_PORT2 + 0, TB10X_PORT2 + 1,\n\t\t\t\t\tTB10X_PORT2 + 2, TB10X_PORT2 + 3};\nstatic const unsigned gpioc_pins[] = {\tTB10X_PORT2 + 4, TB10X_PORT2 + 5,\n\t\t\t\t\tTB10X_PORT2 + 6};\nstatic const unsigned mis3_pins[]  = {\tTB10X_PORT2 + 7, TB10X_PORT2 + 8,\n\t\t\t\t\tTB10X_PORT2 + 9, TB10X_PORT2 + 10};\nstatic const unsigned mip3_pins[]  = {\tTB10X_PORT2 + 0, TB10X_PORT2 + 1,\n\t\t\t\t\tTB10X_PORT2 + 2, TB10X_PORT2 + 3,\n\t\t\t\t\tTB10X_PORT2 + 4, TB10X_PORT2 + 5,\n\t\t\t\t\tTB10X_PORT2 + 6, TB10X_PORT2 + 7,\n\t\t\t\t\tTB10X_PORT2 + 8, TB10X_PORT2 + 9,\n\t\t\t\t\tTB10X_PORT2 + 10};\n\n \nstatic const unsigned mis4_pins[]  = {\tTB10X_PORT3 + 0, TB10X_PORT3 + 1,\n\t\t\t\t\tTB10X_PORT3 + 2, TB10X_PORT3 + 3};\nstatic const unsigned gpioe_pins[] = {\tTB10X_PORT3 + 4, TB10X_PORT3 + 5,\n\t\t\t\t\tTB10X_PORT3 + 6};\nstatic const unsigned mis5_pins[]  = {\tTB10X_PORT3 + 7, TB10X_PORT3 + 8,\n\t\t\t\t\tTB10X_PORT3 + 9, TB10X_PORT3 + 10};\nstatic const unsigned mip5_pins[]  = {\tTB10X_PORT3 + 0, TB10X_PORT3 + 1,\n\t\t\t\t\tTB10X_PORT3 + 2, TB10X_PORT3 + 3,\n\t\t\t\t\tTB10X_PORT3 + 4, TB10X_PORT3 + 5,\n\t\t\t\t\tTB10X_PORT3 + 6, TB10X_PORT3 + 7,\n\t\t\t\t\tTB10X_PORT3 + 8, TB10X_PORT3 + 9,\n\t\t\t\t\tTB10X_PORT3 + 10};\n\n \nstatic const unsigned mis6_pins[]  = {\tTB10X_PORT4 + 0, TB10X_PORT4 + 1,\n\t\t\t\t\tTB10X_PORT4 + 2, TB10X_PORT4 + 3};\nstatic const unsigned gpiog_pins[] = {\tTB10X_PORT4 + 4, TB10X_PORT4 + 5,\n\t\t\t\t\tTB10X_PORT4 + 6};\nstatic const unsigned mis7_pins[]  = {\tTB10X_PORT4 + 7, TB10X_PORT4 + 8,\n\t\t\t\t\tTB10X_PORT4 + 9, TB10X_PORT4 + 10};\nstatic const unsigned mip7_pins[]  = {\tTB10X_PORT4 + 0, TB10X_PORT4 + 1,\n\t\t\t\t\tTB10X_PORT4 + 2, TB10X_PORT4 + 3,\n\t\t\t\t\tTB10X_PORT4 + 4, TB10X_PORT4 + 5,\n\t\t\t\t\tTB10X_PORT4 + 6, TB10X_PORT4 + 7,\n\t\t\t\t\tTB10X_PORT4 + 8, TB10X_PORT4 + 9,\n\t\t\t\t\tTB10X_PORT4 + 10};\n\n \nstatic const unsigned mop_pins[] = {\tTB10X_PORT6 + 0, TB10X_PORT6 + 1,\n\t\t\t\t\tTB10X_PORT6 + 2, TB10X_PORT6 + 3,\n\t\t\t\t\tTB10X_PORT6 + 4, TB10X_PORT6 + 5,\n\t\t\t\t\tTB10X_PORT6 + 6, TB10X_PORT6 + 7,\n\t\t\t\t\tTB10X_PORT6 + 8, TB10X_PORT6 + 9};\nstatic const unsigned mos0_pins[] = {\tTB10X_PORT6 + 0, TB10X_PORT6 + 1,\n\t\t\t\t\tTB10X_PORT6 + 2};\nstatic const unsigned mos1_pins[] = {\tTB10X_PORT6 + 3, TB10X_PORT6 + 4,\n\t\t\t\t\tTB10X_PORT6 + 5};\nstatic const unsigned mos2_pins[] = {\tTB10X_PORT6 + 6, TB10X_PORT6 + 7,\n\t\t\t\t\tTB10X_PORT6 + 8};\nstatic const unsigned mos3_pins[] = {\tTB10X_PORT6 + 9};\n\n \nstatic const unsigned uart0_pins[] = {\tTB10X_PORT7 + 0, TB10X_PORT7 + 1,\n\t\t\t\t\tTB10X_PORT7 + 2, TB10X_PORT7 + 3};\nstatic const unsigned uart1_pins[] = {\tTB10X_PORT7 + 4, TB10X_PORT7 + 5,\n\t\t\t\t\tTB10X_PORT7 + 6, TB10X_PORT7 + 7};\nstatic const unsigned gpiol_pins[] = {\tTB10X_PORT7 + 0, TB10X_PORT7 + 1,\n\t\t\t\t\tTB10X_PORT7 + 2, TB10X_PORT7 + 3};\nstatic const unsigned gpiom_pins[] = {\tTB10X_PORT7 + 4, TB10X_PORT7 + 5,\n\t\t\t\t\tTB10X_PORT7 + 6, TB10X_PORT7 + 7};\n\n \nstatic const unsigned spi3_pins[] = {\tTB10X_PORT8 + 0, TB10X_PORT8 + 1,\n\t\t\t\t\tTB10X_PORT8 + 2, TB10X_PORT8 + 3};\nstatic const unsigned jtag_pins[] = {\tTB10X_PORT8 + 0, TB10X_PORT8 + 1,\n\t\t\t\t\tTB10X_PORT8 + 2, TB10X_PORT8 + 3};\n\n \nstatic const unsigned spi1_pins[] = {\tTB10X_PORT9 + 0, TB10X_PORT9 + 1,\n\t\t\t\t\tTB10X_PORT9 + 2, TB10X_PORT9 + 3,\n\t\t\t\t\tTB10X_PORT9 + 4};\nstatic const unsigned gpion_pins[] = {\tTB10X_PORT9 + 0, TB10X_PORT9 + 1,\n\t\t\t\t\tTB10X_PORT9 + 2, TB10X_PORT9 + 3,\n\t\t\t\t\tTB10X_PORT9 + 4};\n\n \nstatic const unsigned gpioj_pins[] = {\tTB10X_PORT5 + 0, TB10X_PORT5 + 1,\n\t\t\t\t\tTB10X_PORT5 + 2, TB10X_PORT5 + 3,\n\t\t\t\t\tTB10X_PORT5 + 4, TB10X_PORT5 + 5,\n\t\t\t\t\tTB10X_PORT5 + 6, TB10X_PORT5 + 7,\n\t\t\t\t\tTB10X_PORT5 + 8, TB10X_PORT5 + 9,\n\t\t\t\t\tTB10X_PORT5 + 10, TB10X_PORT5 + 11,\n\t\t\t\t\tTB10X_PORT5 + 12, TB10X_PORT5 + 13,\n\t\t\t\t\tTB10X_PORT5 + 14, TB10X_PORT5 + 15,\n\t\t\t\t\tTB10X_PORT5 + 16, TB10X_PORT5 + 17,\n\t\t\t\t\tTB10X_PORT5 + 18, TB10X_PORT5 + 19,\n\t\t\t\t\tTB10X_PORT5 + 20, TB10X_PORT5 + 21,\n\t\t\t\t\tTB10X_PORT5 + 22, TB10X_PORT5 + 23,\n\t\t\t\t\tTB10X_PORT5 + 24, TB10X_PORT5 + 25,\n\t\t\t\t\tTB10X_PORT5 + 26, TB10X_PORT5 + 27,\n\t\t\t\t\tTB10X_PORT5 + 28, TB10X_PORT5 + 29,\n\t\t\t\t\tTB10X_PORT5 + 30, TB10X_PORT5 + 31};\nstatic const unsigned gpiok_pins[] = {\tTB10X_PORT5 + 32, TB10X_PORT5 + 33,\n\t\t\t\t\tTB10X_PORT5 + 34, TB10X_PORT5 + 35,\n\t\t\t\t\tTB10X_PORT5 + 36, TB10X_PORT5 + 37,\n\t\t\t\t\tTB10X_PORT5 + 38, TB10X_PORT5 + 39,\n\t\t\t\t\tTB10X_PORT5 + 40, TB10X_PORT5 + 41,\n\t\t\t\t\tTB10X_PORT5 + 42, TB10X_PORT5 + 43,\n\t\t\t\t\tTB10X_PORT5 + 44, TB10X_PORT5 + 45,\n\t\t\t\t\tTB10X_PORT5 + 46, TB10X_PORT5 + 47,\n\t\t\t\t\tTB10X_PORT5 + 48, TB10X_PORT5 + 49,\n\t\t\t\t\tTB10X_PORT5 + 50, TB10X_PORT5 + 51,\n\t\t\t\t\tTB10X_PORT5 + 52, TB10X_PORT5 + 53};\nstatic const unsigned ciplus_pins[] = {\tTB10X_PORT5 + 0, TB10X_PORT5 + 1,\n\t\t\t\t\tTB10X_PORT5 + 2, TB10X_PORT5 + 3,\n\t\t\t\t\tTB10X_PORT5 + 4, TB10X_PORT5 + 5,\n\t\t\t\t\tTB10X_PORT5 + 6, TB10X_PORT5 + 7,\n\t\t\t\t\tTB10X_PORT5 + 8, TB10X_PORT5 + 9,\n\t\t\t\t\tTB10X_PORT5 + 10, TB10X_PORT5 + 11,\n\t\t\t\t\tTB10X_PORT5 + 12, TB10X_PORT5 + 13,\n\t\t\t\t\tTB10X_PORT5 + 14, TB10X_PORT5 + 15,\n\t\t\t\t\tTB10X_PORT5 + 16, TB10X_PORT5 + 17,\n\t\t\t\t\tTB10X_PORT5 + 18, TB10X_PORT5 + 19,\n\t\t\t\t\tTB10X_PORT5 + 20, TB10X_PORT5 + 21,\n\t\t\t\t\tTB10X_PORT5 + 22, TB10X_PORT5 + 23,\n\t\t\t\t\tTB10X_PORT5 + 24, TB10X_PORT5 + 25,\n\t\t\t\t\tTB10X_PORT5 + 26, TB10X_PORT5 + 27,\n\t\t\t\t\tTB10X_PORT5 + 28, TB10X_PORT5 + 29,\n\t\t\t\t\tTB10X_PORT5 + 30, TB10X_PORT5 + 31,\n\t\t\t\t\tTB10X_PORT5 + 32, TB10X_PORT5 + 33,\n\t\t\t\t\tTB10X_PORT5 + 34, TB10X_PORT5 + 35,\n\t\t\t\t\tTB10X_PORT5 + 36, TB10X_PORT5 + 37,\n\t\t\t\t\tTB10X_PORT5 + 38, TB10X_PORT5 + 39,\n\t\t\t\t\tTB10X_PORT5 + 40, TB10X_PORT5 + 41,\n\t\t\t\t\tTB10X_PORT5 + 42, TB10X_PORT5 + 43,\n\t\t\t\t\tTB10X_PORT5 + 44, TB10X_PORT5 + 45,\n\t\t\t\t\tTB10X_PORT5 + 46, TB10X_PORT5 + 47,\n\t\t\t\t\tTB10X_PORT5 + 48, TB10X_PORT5 + 49,\n\t\t\t\t\tTB10X_PORT5 + 50, TB10X_PORT5 + 51,\n\t\t\t\t\tTB10X_PORT5 + 52, TB10X_PORT5 + 53};\nstatic const unsigned mcard_pins[] = {\tTB10X_PORT5 + 3, TB10X_PORT5 + 10,\n\t\t\t\t\tTB10X_PORT5 + 11, TB10X_PORT5 + 12,\n\t\t\t\t\tTB10X_PORT5 + 22, TB10X_PORT5 + 23,\n\t\t\t\t\tTB10X_PORT5 + 33, TB10X_PORT5 + 35,\n\t\t\t\t\tTB10X_PORT5 + 36, TB10X_PORT5 + 37,\n\t\t\t\t\tTB10X_PORT5 + 38, TB10X_PORT5 + 39,\n\t\t\t\t\tTB10X_PORT5 + 40, TB10X_PORT5 + 41,\n\t\t\t\t\tTB10X_PORT5 + 42, TB10X_PORT5 + 43,\n\t\t\t\t\tTB10X_PORT5 + 45, TB10X_PORT5 + 46,\n\t\t\t\t\tTB10X_PORT5 + 47, TB10X_PORT5 + 48,\n\t\t\t\t\tTB10X_PORT5 + 49, TB10X_PORT5 + 50,\n\t\t\t\t\tTB10X_PORT5 + 51, TB10X_PORT5 + 52,\n\t\t\t\t\tTB10X_PORT5 + 53};\nstatic const unsigned stc0_pins[] = {\tTB10X_PORT5 + 34, TB10X_PORT5 + 35,\n\t\t\t\t\tTB10X_PORT5 + 36, TB10X_PORT5 + 37,\n\t\t\t\t\tTB10X_PORT5 + 38, TB10X_PORT5 + 39,\n\t\t\t\t\tTB10X_PORT5 + 40};\nstatic const unsigned stc1_pins[] = {\tTB10X_PORT5 + 25, TB10X_PORT5 + 26,\n\t\t\t\t\tTB10X_PORT5 + 27, TB10X_PORT5 + 28,\n\t\t\t\t\tTB10X_PORT5 + 29, TB10X_PORT5 + 30,\n\t\t\t\t\tTB10X_PORT5 + 44};\n\n \nstatic const unsigned gpiob_pins[] = {\tTB10X_GPIOS + 0, TB10X_GPIOS + 1};\nstatic const unsigned gpiod_pins[] = {\tTB10X_GPIOS + 2, TB10X_GPIOS + 3};\nstatic const unsigned gpiof_pins[] = {\tTB10X_GPIOS + 4, TB10X_GPIOS + 5};\nstatic const unsigned gpioh_pins[] = {\tTB10X_GPIOS + 6, TB10X_GPIOS + 7};\nstatic const unsigned gpioi_pins[] = {\tTB10X_GPIOS + 8, TB10X_GPIOS + 9,\n\t\t\t\t\tTB10X_GPIOS + 10, TB10X_GPIOS + 11,\n\t\t\t\t\tTB10X_GPIOS + 12, TB10X_GPIOS + 13,\n\t\t\t\t\tTB10X_GPIOS + 14, TB10X_GPIOS + 15,\n\t\t\t\t\tTB10X_GPIOS + 16, TB10X_GPIOS + 17,\n\t\t\t\t\tTB10X_GPIOS + 18, TB10X_GPIOS + 19};\n\nstruct tb10x_pinfuncgrp {\n\tconst char *name;\n\tconst unsigned int *pins;\n\tconst unsigned int pincnt;\n\tconst int port;\n\tconst unsigned int mode;\n\tconst int isgpio;\n};\n#define DEFPINFUNCGRP(NAME, PORT, MODE, ISGPIO) { \\\n\t\t.name = __stringify(NAME), \\\n\t\t.pins = NAME##_pins, .pincnt = ARRAY_SIZE(NAME##_pins), \\\n\t\t.port = (PORT), .mode = (MODE), \\\n\t\t.isgpio = (ISGPIO), \\\n\t}\nstatic const struct tb10x_pinfuncgrp tb10x_pingroups[] = {\n\tDEFPINFUNCGRP(mis0,   0, 0, 0),\n\tDEFPINFUNCGRP(gpioa,  0, 0, 1),\n\tDEFPINFUNCGRP(mis1,   0, 0, 0),\n\tDEFPINFUNCGRP(mip1,   0, 1, 0),\n\tDEFPINFUNCGRP(mis2,   1, 0, 0),\n\tDEFPINFUNCGRP(gpioc,  1, 0, 1),\n\tDEFPINFUNCGRP(mis3,   1, 0, 0),\n\tDEFPINFUNCGRP(mip3,   1, 1, 0),\n\tDEFPINFUNCGRP(mis4,   2, 0, 0),\n\tDEFPINFUNCGRP(gpioe,  2, 0, 1),\n\tDEFPINFUNCGRP(mis5,   2, 0, 0),\n\tDEFPINFUNCGRP(mip5,   2, 1, 0),\n\tDEFPINFUNCGRP(mis6,   3, 0, 0),\n\tDEFPINFUNCGRP(gpiog,  3, 0, 1),\n\tDEFPINFUNCGRP(mis7,   3, 0, 0),\n\tDEFPINFUNCGRP(mip7,   3, 1, 0),\n\tDEFPINFUNCGRP(gpioj,  4, 0, 1),\n\tDEFPINFUNCGRP(gpiok,  4, 0, 1),\n\tDEFPINFUNCGRP(ciplus, 4, 1, 0),\n\tDEFPINFUNCGRP(mcard,  4, 2, 0),\n\tDEFPINFUNCGRP(stc0,   4, 3, 0),\n\tDEFPINFUNCGRP(stc1,   4, 3, 0),\n\tDEFPINFUNCGRP(mop,    5, 0, 0),\n\tDEFPINFUNCGRP(mos0,   5, 1, 0),\n\tDEFPINFUNCGRP(mos1,   5, 1, 0),\n\tDEFPINFUNCGRP(mos2,   5, 1, 0),\n\tDEFPINFUNCGRP(mos3,   5, 1, 0),\n\tDEFPINFUNCGRP(uart0,  6, 0, 0),\n\tDEFPINFUNCGRP(uart1,  6, 0, 0),\n\tDEFPINFUNCGRP(gpiol,  6, 1, 1),\n\tDEFPINFUNCGRP(gpiom,  6, 1, 1),\n\tDEFPINFUNCGRP(spi3,   7, 0, 0),\n\tDEFPINFUNCGRP(jtag,   7, 1, 0),\n\tDEFPINFUNCGRP(spi1,   8, 0, 0),\n\tDEFPINFUNCGRP(gpion,  8, 1, 1),\n\tDEFPINFUNCGRP(gpiob, -1, 0, 1),\n\tDEFPINFUNCGRP(gpiod, -1, 0, 1),\n\tDEFPINFUNCGRP(gpiof, -1, 0, 1),\n\tDEFPINFUNCGRP(gpioh, -1, 0, 1),\n\tDEFPINFUNCGRP(gpioi, -1, 0, 1),\n};\n#undef DEFPINFUNCGRP\n\nstruct tb10x_of_pinfunc {\n\tconst char *name;\n\tconst char *group;\n};\n\n#define TB10X_PORTS (9)\n\n \nstruct tb10x_port {\n\tunsigned int mode;\n\tunsigned int count;\n};\n\n \nstruct tb10x_pinctrl {\n\tstruct pinctrl_dev *pctl;\n\tvoid *base;\n\tconst struct tb10x_pinfuncgrp *pingroups;\n\tunsigned int pinfuncgrpcnt;\n\tunsigned int pinfuncnt;\n\tstruct mutex mutex;\n\tstruct tb10x_port ports[TB10X_PORTS];\n\tDECLARE_BITMAP(gpios, MAX_PIN + 1);\n\tstruct tb10x_of_pinfunc pinfuncs[];\n};\n\nstatic inline void tb10x_pinctrl_set_config(struct tb10x_pinctrl *state,\n\t\t\t\tunsigned int port, unsigned int mode)\n{\n\tu32 pcfg;\n\n\tif (state->ports[port].count)\n\t\treturn;\n\n\tstate->ports[port].mode = mode;\n\n\tpcfg = ioread32(state->base) & ~(PCFG_PORT_MASK(port));\n\tpcfg |= (mode << (PCFG_PORT_BITWIDTH * port)) & PCFG_PORT_MASK(port);\n\tiowrite32(pcfg, state->base);\n}\n\nstatic inline unsigned int tb10x_pinctrl_get_config(\n\t\t\t\tstruct tb10x_pinctrl *state,\n\t\t\t\tunsigned int port)\n{\n\treturn (ioread32(state->base) & PCFG_PORT_MASK(port))\n\t\t>> (PCFG_PORT_BITWIDTH * port);\n}\n\nstatic int tb10x_get_groups_count(struct pinctrl_dev *pctl)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\treturn state->pinfuncgrpcnt;\n}\n\nstatic const char *tb10x_get_group_name(struct pinctrl_dev *pctl, unsigned n)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\treturn state->pingroups[n].name;\n}\n\nstatic int tb10x_get_group_pins(struct pinctrl_dev *pctl, unsigned n,\n\t\t\t\tunsigned const **pins,\n\t\t\t\tunsigned * const num_pins)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\n\t*pins = state->pingroups[n].pins;\n\t*num_pins = state->pingroups[n].pincnt;\n\n\treturn 0;\n}\n\nstatic int tb10x_dt_node_to_map(struct pinctrl_dev *pctl,\n\t\t\t\tstruct device_node *np_config,\n\t\t\t\tstruct pinctrl_map **map, unsigned *num_maps)\n{\n\tconst char *string;\n\tunsigned reserved_maps = 0;\n\tint ret = 0;\n\n\tif (of_property_read_string(np_config, \"abilis,function\", &string)) {\n\t\tpr_err(\"%pOF: No abilis,function property in device tree.\\n\",\n\t\t\tnp_config);\n\t\treturn -EINVAL;\n\t}\n\n\t*map = NULL;\n\t*num_maps = 0;\n\n\tret = pinctrl_utils_reserve_map(pctl, map, &reserved_maps,\n\t\t\t\t\tnum_maps, 1);\n\tif (ret)\n\t\tgoto out;\n\n\tret = pinctrl_utils_add_map_mux(pctl, map, &reserved_maps,\n\t\t\t\t\tnum_maps, string, np_config->name);\n\nout:\n\treturn ret;\n}\n\nstatic const struct pinctrl_ops tb10x_pinctrl_ops = {\n\t.get_groups_count = tb10x_get_groups_count,\n\t.get_group_name   = tb10x_get_group_name,\n\t.get_group_pins   = tb10x_get_group_pins,\n\t.dt_node_to_map   = tb10x_dt_node_to_map,\n\t.dt_free_map      = pinctrl_utils_free_map,\n};\n\nstatic int tb10x_get_functions_count(struct pinctrl_dev *pctl)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\treturn state->pinfuncnt;\n}\n\nstatic const char *tb10x_get_function_name(struct pinctrl_dev *pctl,\n\t\t\t\t\tunsigned n)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\treturn state->pinfuncs[n].name;\n}\n\nstatic int tb10x_get_function_groups(struct pinctrl_dev *pctl,\n\t\t\t\tunsigned n, const char * const **groups,\n\t\t\t\tunsigned * const num_groups)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\n\t*groups = &state->pinfuncs[n].group;\n\t*num_groups = 1;\n\n\treturn 0;\n}\n\nstatic int tb10x_gpio_request_enable(struct pinctrl_dev *pctl,\n\t\t\t\t\tstruct pinctrl_gpio_range *range,\n\t\t\t\t\tunsigned pin)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\tint muxport = -1;\n\tint muxmode = -1;\n\tint i;\n\n\tmutex_lock(&state->mutex);\n\n\t \n\tfor (i = 0; i < state->pinfuncgrpcnt; i++) {\n\t\tconst struct tb10x_pinfuncgrp *pfg = &state->pingroups[i];\n\t\tunsigned int mode = pfg->mode;\n\t\tint j, port = pfg->port;\n\n\t\t \n\t\tif (port < 0)\n\t\t\tcontinue;\n\n\t\tfor (j = 0; j < pfg->pincnt; j++) {\n\t\t\tif (pin == pfg->pins[j]) {\n\t\t\t\tif (pfg->isgpio) {\n\t\t\t\t\t \n\t\t\t\t\tmuxport = port;\n\t\t\t\t\tmuxmode = mode;\n\t\t\t\t} else if (state->ports[port].count\n\t\t\t\t\t&& (state->ports[port].mode == mode)) {\n\t\t\t\t\t \n\t\t\t\t\tmutex_unlock(&state->mutex);\n\t\t\t\t\treturn -EBUSY;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t \n\tset_bit(pin, state->gpios);\n\n\t \n\tif (muxport >= 0)\n\t\ttb10x_pinctrl_set_config(state, muxport, muxmode);\n\n\tmutex_unlock(&state->mutex);\n\n\treturn 0;\n}\n\nstatic void tb10x_gpio_disable_free(struct pinctrl_dev *pctl,\n\t\t\t\t\tstruct pinctrl_gpio_range *range,\n\t\t\t\t\tunsigned pin)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\n\tmutex_lock(&state->mutex);\n\n\tclear_bit(pin, state->gpios);\n\n\tmutex_unlock(&state->mutex);\n}\n\nstatic int tb10x_pctl_set_mux(struct pinctrl_dev *pctl,\n\t\t\tunsigned func_selector, unsigned group_selector)\n{\n\tstruct tb10x_pinctrl *state = pinctrl_dev_get_drvdata(pctl);\n\tconst struct tb10x_pinfuncgrp *grp = &state->pingroups[group_selector];\n\tint i;\n\n\tif (grp->port < 0)\n\t\treturn 0;\n\n\tmutex_lock(&state->mutex);\n\n\t \n\tif (state->ports[grp->port].count\n\t\t\t&& (state->ports[grp->port].mode != grp->mode)) {\n\t\tmutex_unlock(&state->mutex);\n\t\treturn -EBUSY;\n\t}\n\n\t \n\tfor (i = 0; i < grp->pincnt; i++)\n\t\tif (test_bit(grp->pins[i], state->gpios)) {\n\t\t\tmutex_unlock(&state->mutex);\n\t\t\treturn -EBUSY;\n\t\t}\n\n\ttb10x_pinctrl_set_config(state, grp->port, grp->mode);\n\n\tstate->ports[grp->port].count++;\n\n\tmutex_unlock(&state->mutex);\n\n\treturn 0;\n}\n\nstatic const struct pinmux_ops tb10x_pinmux_ops = {\n\t.get_functions_count = tb10x_get_functions_count,\n\t.get_function_name = tb10x_get_function_name,\n\t.get_function_groups = tb10x_get_function_groups,\n\t.gpio_request_enable = tb10x_gpio_request_enable,\n\t.gpio_disable_free = tb10x_gpio_disable_free,\n\t.set_mux = tb10x_pctl_set_mux,\n};\n\nstatic struct pinctrl_desc tb10x_pindesc = {\n\t.name = \"TB10x\",\n\t.pins = tb10x_pins,\n\t.npins = ARRAY_SIZE(tb10x_pins),\n\t.owner = THIS_MODULE,\n\t.pctlops = &tb10x_pinctrl_ops,\n\t.pmxops  = &tb10x_pinmux_ops,\n};\n\nstatic int tb10x_pinctrl_probe(struct platform_device *pdev)\n{\n\tint ret = -EINVAL;\n\tstruct device *dev = &pdev->dev;\n\tstruct device_node *of_node = dev->of_node;\n\tstruct device_node *child;\n\tstruct tb10x_pinctrl *state;\n\tint i;\n\n\tif (!of_node) {\n\t\tdev_err(dev, \"No device tree node found.\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tstate = devm_kzalloc(dev, struct_size(state, pinfuncs,\n\t\t\t\t\t      of_get_child_count(of_node)),\n\t\t\t     GFP_KERNEL);\n\tif (!state)\n\t\treturn -ENOMEM;\n\n\tplatform_set_drvdata(pdev, state);\n\tmutex_init(&state->mutex);\n\n\tstate->base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(state->base)) {\n\t\tret = PTR_ERR(state->base);\n\t\tgoto fail;\n\t}\n\n\tstate->pingroups = tb10x_pingroups;\n\tstate->pinfuncgrpcnt = ARRAY_SIZE(tb10x_pingroups);\n\n\tfor (i = 0; i < TB10X_PORTS; i++)\n\t\tstate->ports[i].mode = tb10x_pinctrl_get_config(state, i);\n\n\tfor_each_child_of_node(of_node, child) {\n\t\tconst char *name;\n\n\t\tif (!of_property_read_string(child, \"abilis,function\",\n\t\t\t\t\t\t&name)) {\n\t\t\tstate->pinfuncs[state->pinfuncnt].name = child->name;\n\t\t\tstate->pinfuncs[state->pinfuncnt].group = name;\n\t\t\tstate->pinfuncnt++;\n\t\t}\n\t}\n\n\tstate->pctl = devm_pinctrl_register(dev, &tb10x_pindesc, state);\n\tif (IS_ERR(state->pctl)) {\n\t\tdev_err(dev, \"could not register TB10x pin driver\\n\");\n\t\tret = PTR_ERR(state->pctl);\n\t\tgoto fail;\n\t}\n\n\treturn 0;\n\nfail:\n\tmutex_destroy(&state->mutex);\n\treturn ret;\n}\n\nstatic int tb10x_pinctrl_remove(struct platform_device *pdev)\n{\n\tstruct tb10x_pinctrl *state = platform_get_drvdata(pdev);\n\n\tmutex_destroy(&state->mutex);\n\n\treturn 0;\n}\n\n\nstatic const struct of_device_id tb10x_pinctrl_dt_ids[] = {\n\t{ .compatible = \"abilis,tb10x-iomux\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, tb10x_pinctrl_dt_ids);\n\nstatic struct platform_driver tb10x_pinctrl_pdrv = {\n\t.probe   = tb10x_pinctrl_probe,\n\t.remove  = tb10x_pinctrl_remove,\n\t.driver  = {\n\t\t.name  = \"tb10x_pinctrl\",\n\t\t.of_match_table = of_match_ptr(tb10x_pinctrl_dt_ids),\n\t}\n};\n\nmodule_platform_driver(tb10x_pinctrl_pdrv);\n\nMODULE_AUTHOR(\"Christian Ruppert <christian.ruppert@abilis.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}