{
  "module_name": "pinctrl-mt8135.c",
  "hash_id": "77fb824b70dff429be236427a3d21bcfaf2327bc235da981a534b5e29863cd18",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pinctrl/mediatek/pinctrl-mt8135.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/platform_device.h>\n#include <linux/of.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/regmap.h>\n#include <dt-bindings/pinctrl/mt65xx.h>\n\n#include \"pinctrl-mtk-common.h\"\n#include \"pinctrl-mtk-mt8135.h\"\n\n#define DRV_BASE1\t\t\t\t0x500\n#define DRV_BASE2\t\t\t\t0x510\n#define PUPD_BASE1\t\t\t\t0x400\n#define PUPD_BASE2\t\t\t\t0x450\n#define R0_BASE1\t\t\t\t0x4d0\n#define R1_BASE1\t\t\t\t0x200\n#define R1_BASE2\t\t\t\t0x250\n\nstruct mtk_spec_pull_set {\n\tunsigned char pin;\n\tunsigned char pupd_bit;\n\tunsigned short pupd_offset;\n\tunsigned short r0_offset;\n\tunsigned short r1_offset;\n\tunsigned char r0_bit;\n\tunsigned char r1_bit;\n};\n\n#define SPEC_PULL(_pin, _pupd_offset, _pupd_bit, _r0_offset, \\\n\t_r0_bit, _r1_offset, _r1_bit)\t\\\n\t{\t\\\n\t\t.pin = _pin,\t\\\n\t\t.pupd_offset = _pupd_offset,\t\\\n\t\t.pupd_bit = _pupd_bit,\t\\\n\t\t.r0_offset = _r0_offset, \\\n\t\t.r0_bit = _r0_bit, \\\n\t\t.r1_offset = _r1_offset, \\\n\t\t.r1_bit = _r1_bit, \\\n\t}\n\nstatic const struct mtk_drv_group_desc mt8135_drv_grp[] =  {\n\t \n\tMTK_DRV_GRP(2, 16, 0, 2, 2),\n\t \n\tMTK_DRV_GRP(4, 16, 1, 2, 4),\n\t \n\tMTK_DRV_GRP(2, 8, 0, 1, 2),\n\t \n\tMTK_DRV_GRP(4, 32, 0, 2, 4)\n};\n\nstatic const struct mtk_pin_drv_grp mt8135_pin_drv[] = {\n\tMTK_PIN_DRV_GRP(0, DRV_BASE1, 0, 0),\n\tMTK_PIN_DRV_GRP(1, DRV_BASE1, 0, 0),\n\tMTK_PIN_DRV_GRP(2, DRV_BASE1, 0, 0),\n\tMTK_PIN_DRV_GRP(3, DRV_BASE1, 0, 0),\n\tMTK_PIN_DRV_GRP(4, DRV_BASE1, 4, 0),\n\tMTK_PIN_DRV_GRP(5, DRV_BASE1, 8, 0),\n\tMTK_PIN_DRV_GRP(6, DRV_BASE1, 0, 0),\n\tMTK_PIN_DRV_GRP(7, DRV_BASE1, 0, 0),\n\tMTK_PIN_DRV_GRP(8, DRV_BASE1, 0, 0),\n\tMTK_PIN_DRV_GRP(9, DRV_BASE1, 0, 0),\n\n\tMTK_PIN_DRV_GRP(10, DRV_BASE1, 12, 1),\n\tMTK_PIN_DRV_GRP(11, DRV_BASE1, 12, 1),\n\tMTK_PIN_DRV_GRP(12, DRV_BASE1, 12, 1),\n\tMTK_PIN_DRV_GRP(13, DRV_BASE1, 12, 1),\n\tMTK_PIN_DRV_GRP(14, DRV_BASE1, 12, 1),\n\tMTK_PIN_DRV_GRP(15, DRV_BASE1, 12, 1),\n\tMTK_PIN_DRV_GRP(16, DRV_BASE1, 12, 1),\n\tMTK_PIN_DRV_GRP(17, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(18, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(19, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(20, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(21, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(22, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(23, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(24, DRV_BASE1, 16, 1),\n\tMTK_PIN_DRV_GRP(33, DRV_BASE1, 24, 1),\n\tMTK_PIN_DRV_GRP(34, DRV_BASE2, 12, 2),\n\tMTK_PIN_DRV_GRP(37, DRV_BASE2, 20, 1),\n\tMTK_PIN_DRV_GRP(38, DRV_BASE2, 20, 1),\n\tMTK_PIN_DRV_GRP(39, DRV_BASE2, 20, 1),\n\tMTK_PIN_DRV_GRP(40, DRV_BASE2, 24, 1),\n\tMTK_PIN_DRV_GRP(41, DRV_BASE2, 24, 1),\n\tMTK_PIN_DRV_GRP(42, DRV_BASE2, 24, 1),\n\tMTK_PIN_DRV_GRP(43, DRV_BASE2, 28, 1),\n\tMTK_PIN_DRV_GRP(44, DRV_BASE2, 28, 1),\n\tMTK_PIN_DRV_GRP(45, DRV_BASE2, 28, 1),\n\tMTK_PIN_DRV_GRP(46, DRV_BASE2, 28, 1),\n\tMTK_PIN_DRV_GRP(47, DRV_BASE2, 28, 1),\n\n\tMTK_PIN_DRV_GRP(49, DRV_BASE2+0x10, 0, 1),\n\tMTK_PIN_DRV_GRP(50, DRV_BASE2+0x10, 4, 1),\n\tMTK_PIN_DRV_GRP(51, DRV_BASE2+0x10, 8, 1),\n\tMTK_PIN_DRV_GRP(52, DRV_BASE2+0x10, 12, 2),\n\tMTK_PIN_DRV_GRP(53, DRV_BASE2+0x10, 16, 1),\n\tMTK_PIN_DRV_GRP(54, DRV_BASE2+0x10, 20, 1),\n\tMTK_PIN_DRV_GRP(55, DRV_BASE2+0x10, 24, 1),\n\tMTK_PIN_DRV_GRP(56, DRV_BASE2+0x10, 28, 1),\n\n\tMTK_PIN_DRV_GRP(57, DRV_BASE2+0x20, 0, 1),\n\tMTK_PIN_DRV_GRP(58, DRV_BASE2+0x20, 0, 1),\n\tMTK_PIN_DRV_GRP(59, DRV_BASE2+0x20, 0, 1),\n\tMTK_PIN_DRV_GRP(60, DRV_BASE2+0x20, 0, 1),\n\tMTK_PIN_DRV_GRP(61, DRV_BASE2+0x20, 0, 1),\n\tMTK_PIN_DRV_GRP(62, DRV_BASE2+0x20, 0, 1),\n\tMTK_PIN_DRV_GRP(63, DRV_BASE2+0x20, 4, 1),\n\tMTK_PIN_DRV_GRP(64, DRV_BASE2+0x20, 8, 1),\n\tMTK_PIN_DRV_GRP(65, DRV_BASE2+0x20, 12, 1),\n\tMTK_PIN_DRV_GRP(66, DRV_BASE2+0x20, 16, 1),\n\tMTK_PIN_DRV_GRP(67, DRV_BASE2+0x20, 20, 1),\n\tMTK_PIN_DRV_GRP(68, DRV_BASE2+0x20, 24, 1),\n\tMTK_PIN_DRV_GRP(69, DRV_BASE2+0x20, 28, 1),\n\n\tMTK_PIN_DRV_GRP(70, DRV_BASE2+0x30, 0, 1),\n\tMTK_PIN_DRV_GRP(71, DRV_BASE2+0x30, 4, 1),\n\tMTK_PIN_DRV_GRP(72, DRV_BASE2+0x30, 8, 1),\n\tMTK_PIN_DRV_GRP(73, DRV_BASE2+0x30, 12, 1),\n\tMTK_PIN_DRV_GRP(74, DRV_BASE2+0x30, 16, 1),\n\tMTK_PIN_DRV_GRP(75, DRV_BASE2+0x30, 20, 1),\n\tMTK_PIN_DRV_GRP(76, DRV_BASE2+0x30, 24, 1),\n\tMTK_PIN_DRV_GRP(77, DRV_BASE2+0x30, 28, 3),\n\tMTK_PIN_DRV_GRP(78, DRV_BASE2+0x30, 28, 3),\n\n\tMTK_PIN_DRV_GRP(79, DRV_BASE2+0x40, 0, 3),\n\tMTK_PIN_DRV_GRP(80, DRV_BASE2+0x40, 4, 3),\n\n\tMTK_PIN_DRV_GRP(81, DRV_BASE2+0x30, 28, 3),\n\tMTK_PIN_DRV_GRP(82, DRV_BASE2+0x30, 28, 3),\n\n\tMTK_PIN_DRV_GRP(83, DRV_BASE2+0x40, 8, 3),\n\tMTK_PIN_DRV_GRP(84, DRV_BASE2+0x40, 8, 3),\n\tMTK_PIN_DRV_GRP(85, DRV_BASE2+0x40, 12, 3),\n\tMTK_PIN_DRV_GRP(86, DRV_BASE2+0x40, 16, 3),\n\tMTK_PIN_DRV_GRP(87, DRV_BASE2+0x40, 8, 3),\n\tMTK_PIN_DRV_GRP(88, DRV_BASE2+0x40, 8, 3),\n\n\tMTK_PIN_DRV_GRP(89, DRV_BASE2+0x50, 12, 0),\n\tMTK_PIN_DRV_GRP(90, DRV_BASE2+0x50, 12, 0),\n\tMTK_PIN_DRV_GRP(91, DRV_BASE2+0x50, 12, 0),\n\tMTK_PIN_DRV_GRP(92, DRV_BASE2+0x50, 12, 0),\n\tMTK_PIN_DRV_GRP(93, DRV_BASE2+0x50, 12, 0),\n\tMTK_PIN_DRV_GRP(94, DRV_BASE2+0x50, 12, 0),\n\tMTK_PIN_DRV_GRP(95, DRV_BASE2+0x50, 12, 0),\n\n\tMTK_PIN_DRV_GRP(96, DRV_BASE1+0xb0, 28, 0),\n\n\tMTK_PIN_DRV_GRP(97, DRV_BASE2+0x50, 12, 0),\n\tMTK_PIN_DRV_GRP(98, DRV_BASE2+0x50, 16, 0),\n\tMTK_PIN_DRV_GRP(99, DRV_BASE2+0x50, 20, 1),\n\tMTK_PIN_DRV_GRP(102, DRV_BASE2+0x50, 24, 1),\n\tMTK_PIN_DRV_GRP(103, DRV_BASE2+0x50, 28, 1),\n\n\n\tMTK_PIN_DRV_GRP(104, DRV_BASE2+0x60, 0, 1),\n\tMTK_PIN_DRV_GRP(105, DRV_BASE2+0x60, 4, 1),\n\tMTK_PIN_DRV_GRP(106, DRV_BASE2+0x60, 4, 1),\n\tMTK_PIN_DRV_GRP(107, DRV_BASE2+0x60, 4, 1),\n\tMTK_PIN_DRV_GRP(108, DRV_BASE2+0x60, 4, 1),\n\tMTK_PIN_DRV_GRP(109, DRV_BASE2+0x60, 8, 2),\n\tMTK_PIN_DRV_GRP(110, DRV_BASE2+0x60, 12, 2),\n\tMTK_PIN_DRV_GRP(111, DRV_BASE2+0x60, 16, 2),\n\tMTK_PIN_DRV_GRP(112, DRV_BASE2+0x60, 20, 2),\n\tMTK_PIN_DRV_GRP(113, DRV_BASE2+0x60, 24, 2),\n\tMTK_PIN_DRV_GRP(114, DRV_BASE2+0x60, 28, 2),\n\n\tMTK_PIN_DRV_GRP(115, DRV_BASE2+0x70, 0, 2),\n\tMTK_PIN_DRV_GRP(116, DRV_BASE2+0x70, 4, 2),\n\tMTK_PIN_DRV_GRP(117, DRV_BASE2+0x70, 8, 2),\n\tMTK_PIN_DRV_GRP(118, DRV_BASE2+0x70, 12, 2),\n\tMTK_PIN_DRV_GRP(119, DRV_BASE2+0x70, 16, 2),\n\tMTK_PIN_DRV_GRP(120, DRV_BASE2+0x70, 20, 2),\n\n\tMTK_PIN_DRV_GRP(181, DRV_BASE1+0xa0, 12, 1),\n\tMTK_PIN_DRV_GRP(182, DRV_BASE1+0xa0, 16, 1),\n\tMTK_PIN_DRV_GRP(183, DRV_BASE1+0xa0, 20, 1),\n\tMTK_PIN_DRV_GRP(184, DRV_BASE1+0xa0, 24, 1),\n\tMTK_PIN_DRV_GRP(185, DRV_BASE1+0xa0, 28, 1),\n\n\tMTK_PIN_DRV_GRP(186, DRV_BASE1+0xb0, 0, 2),\n\tMTK_PIN_DRV_GRP(187, DRV_BASE1+0xb0, 0, 2),\n\tMTK_PIN_DRV_GRP(188, DRV_BASE1+0xb0, 0, 2),\n\tMTK_PIN_DRV_GRP(189, DRV_BASE1+0xb0, 0, 2),\n\tMTK_PIN_DRV_GRP(190, DRV_BASE1+0xb0, 4, 1),\n\tMTK_PIN_DRV_GRP(191, DRV_BASE1+0xb0, 8, 1),\n\tMTK_PIN_DRV_GRP(192, DRV_BASE1+0xb0, 12, 1),\n\n\tMTK_PIN_DRV_GRP(197, DRV_BASE1+0xb0, 16, 0),\n\tMTK_PIN_DRV_GRP(198, DRV_BASE1+0xb0, 16, 0),\n\tMTK_PIN_DRV_GRP(199, DRV_BASE1+0xb0, 20, 0),\n\tMTK_PIN_DRV_GRP(200, DRV_BASE1+0xb0, 24, 0),\n\tMTK_PIN_DRV_GRP(201, DRV_BASE1+0xb0, 16, 0),\n\tMTK_PIN_DRV_GRP(202, DRV_BASE1+0xb0, 16, 0)\n};\n\nstatic const struct mtk_spec_pull_set spec_pupd[] = {\n\tSPEC_PULL(0, PUPD_BASE1, 0, R0_BASE1, 9, R1_BASE1, 0),\n\tSPEC_PULL(1, PUPD_BASE1, 1, R0_BASE1, 8, R1_BASE1, 1),\n\tSPEC_PULL(2, PUPD_BASE1, 2, R0_BASE1, 7, R1_BASE1, 2),\n\tSPEC_PULL(3, PUPD_BASE1, 3, R0_BASE1, 6, R1_BASE1, 3),\n\tSPEC_PULL(4, PUPD_BASE1, 4, R0_BASE1, 1, R1_BASE1, 4),\n\tSPEC_PULL(5, PUPD_BASE1, 5, R0_BASE1, 0, R1_BASE1, 5),\n\tSPEC_PULL(6, PUPD_BASE1, 6, R0_BASE1, 5, R1_BASE1, 6),\n\tSPEC_PULL(7, PUPD_BASE1, 7, R0_BASE1, 4, R1_BASE1, 7),\n\tSPEC_PULL(8, PUPD_BASE1, 8, R0_BASE1, 3, R1_BASE1, 8),\n\tSPEC_PULL(9, PUPD_BASE1, 9, R0_BASE1, 2, R1_BASE1, 9),\n\tSPEC_PULL(89, PUPD_BASE2, 9, R0_BASE1, 18, R1_BASE2, 9),\n\tSPEC_PULL(90, PUPD_BASE2, 10, R0_BASE1, 19, R1_BASE2, 10),\n\tSPEC_PULL(91, PUPD_BASE2, 11, R0_BASE1, 23, R1_BASE2, 11),\n\tSPEC_PULL(92, PUPD_BASE2, 12, R0_BASE1, 24, R1_BASE2, 12),\n\tSPEC_PULL(93, PUPD_BASE2, 13, R0_BASE1, 25, R1_BASE2, 13),\n\tSPEC_PULL(94, PUPD_BASE2, 14, R0_BASE1, 22, R1_BASE2, 14),\n\tSPEC_PULL(95, PUPD_BASE2, 15, R0_BASE1, 20, R1_BASE2, 15),\n\tSPEC_PULL(96, PUPD_BASE2+0x10, 0, R0_BASE1, 16, R1_BASE2+0x10, 0),\n\tSPEC_PULL(97, PUPD_BASE2+0x10, 1, R0_BASE1, 21, R1_BASE2+0x10, 1),\n\tSPEC_PULL(98, PUPD_BASE2+0x10, 2, R0_BASE1, 17, R1_BASE2+0x10, 2),\n\tSPEC_PULL(197, PUPD_BASE1+0xc0, 5, R0_BASE1, 13, R1_BASE2+0xc0, 5),\n\tSPEC_PULL(198, PUPD_BASE2+0xc0, 6, R0_BASE1, 14, R1_BASE2+0xc0, 6),\n\tSPEC_PULL(199, PUPD_BASE2+0xc0, 7, R0_BASE1, 11, R1_BASE2+0xc0, 7),\n\tSPEC_PULL(200, PUPD_BASE2+0xc0, 8, R0_BASE1, 10, R1_BASE2+0xc0, 8),\n\tSPEC_PULL(201, PUPD_BASE2+0xc0, 9, R0_BASE1, 13, R1_BASE2+0xc0, 9),\n\tSPEC_PULL(202, PUPD_BASE2+0xc0, 10, R0_BASE1, 12, R1_BASE2+0xc0, 10)\n};\n\nstatic int spec_pull_set(struct regmap *regmap,\n\t\tconst struct mtk_pinctrl_devdata *devdata,\n\t\tunsigned int pin, bool isup, unsigned int r1r0)\n{\n\tunsigned int i;\n\tunsigned int reg_pupd, reg_set_r0, reg_set_r1;\n\tunsigned int reg_rst_r0, reg_rst_r1;\n\tunsigned char align = devdata->port_align;\n\tbool find = false;\n\n\tfor (i = 0; i < ARRAY_SIZE(spec_pupd); i++) {\n\t\tif (pin == spec_pupd[i].pin) {\n\t\t\tfind = true;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!find)\n\t\treturn -EINVAL;\n\n\tif (isup)\n\t\treg_pupd = spec_pupd[i].pupd_offset + align;\n\telse\n\t\treg_pupd = spec_pupd[i].pupd_offset + (align << 1);\n\n\tregmap_write(regmap, reg_pupd, spec_pupd[i].pupd_bit);\n\n\treg_set_r0 = spec_pupd[i].r0_offset + align;\n\treg_rst_r0 = spec_pupd[i].r0_offset + (align << 1);\n\treg_set_r1 = spec_pupd[i].r1_offset + align;\n\treg_rst_r1 = spec_pupd[i].r1_offset + (align << 1);\n\n\tswitch (r1r0) {\n\tcase MTK_PUPD_SET_R1R0_00:\n\t\tregmap_write(regmap, reg_rst_r0, spec_pupd[i].r0_bit);\n\t\tregmap_write(regmap, reg_rst_r1, spec_pupd[i].r1_bit);\n\t\tbreak;\n\tcase MTK_PUPD_SET_R1R0_01:\n\t\tregmap_write(regmap, reg_set_r0, spec_pupd[i].r0_bit);\n\t\tregmap_write(regmap, reg_rst_r1, spec_pupd[i].r1_bit);\n\t\tbreak;\n\tcase MTK_PUPD_SET_R1R0_10:\n\t\tregmap_write(regmap, reg_rst_r0, spec_pupd[i].r0_bit);\n\t\tregmap_write(regmap, reg_set_r1, spec_pupd[i].r1_bit);\n\t\tbreak;\n\tcase MTK_PUPD_SET_R1R0_11:\n\t\tregmap_write(regmap, reg_set_r0, spec_pupd[i].r0_bit);\n\t\tregmap_write(regmap, reg_set_r1, spec_pupd[i].r1_bit);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct mtk_pinctrl_devdata mt8135_pinctrl_data = {\n\t.pins = mtk_pins_mt8135,\n\t.npins = ARRAY_SIZE(mtk_pins_mt8135),\n\t.grp_desc = mt8135_drv_grp,\n\t.n_grp_cls = ARRAY_SIZE(mt8135_drv_grp),\n\t.pin_drv_grp = mt8135_pin_drv,\n\t.n_pin_drv_grps = ARRAY_SIZE(mt8135_pin_drv),\n\t.spec_pull_set = spec_pull_set,\n\t.dir_offset = 0x0000,\n\t.ies_offset = 0x0100,\n\t.pullen_offset = 0x0200,\n\t.smt_offset = 0x0300,\n\t.pullsel_offset = 0x0400,\n\t.dout_offset = 0x0800,\n\t.din_offset = 0x0A00,\n\t.pinmux_offset = 0x0C00,\n\t.type1_start = 34,\n\t.type1_end = 149,\n\t.port_shf = 4,\n\t.port_mask = 0xf,\n\t.port_align = 4,\n\t.mode_mask = 0xf,\n\t.mode_per_reg = 5,\n\t.mode_shf = 4,\n\t.eint_hw = {\n\t\t.port_mask = 7,\n\t\t.ports     = 6,\n\t\t.ap_num    = 192,\n\t\t.db_cnt    = 16,\n\t\t.db_time = debounce_time_mt2701,\n\t},\n};\n\nstatic const struct of_device_id mt8135_pctrl_match[] = {\n\t{ .compatible = \"mediatek,mt8135-pinctrl\", .data = &mt8135_pinctrl_data },\n\t{ }\n};\n\nstatic struct platform_driver mtk_pinctrl_driver = {\n\t.probe = mtk_pctrl_common_probe,\n\t.driver = {\n\t\t.name = \"mediatek-mt8135-pinctrl\",\n\t\t.of_match_table = mt8135_pctrl_match,\n\t},\n};\n\nstatic int __init mtk_pinctrl_init(void)\n{\n\treturn platform_driver_register(&mtk_pinctrl_driver);\n}\narch_initcall(mtk_pinctrl_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}