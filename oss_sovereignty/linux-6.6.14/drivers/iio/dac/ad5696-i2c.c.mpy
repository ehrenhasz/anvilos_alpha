{
  "module_name": "ad5696-i2c.c",
  "hash_id": "e6f1d7f0219f17b7f1d7725fb1c3af145caa29beb023fcf1e178ac2d070c4dee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/dac/ad5696-i2c.c",
  "human_readable_source": "\n \n\n#include \"ad5686.h\"\n\n#include <linux/module.h>\n#include <linux/i2c.h>\n\nstatic int ad5686_i2c_read(struct ad5686_state *st, u8 addr)\n{\n\tstruct i2c_client *i2c = to_i2c_client(st->dev);\n\tstruct i2c_msg msg[2] = {\n\t\t{\n\t\t\t.addr = i2c->addr,\n\t\t\t.flags = i2c->flags,\n\t\t\t.len = 3,\n\t\t\t.buf = &st->data[0].d8[1],\n\t\t},\n\t\t{\n\t\t\t.addr = i2c->addr,\n\t\t\t.flags = i2c->flags | I2C_M_RD,\n\t\t\t.len = 2,\n\t\t\t.buf = (char *)&st->data[0].d16,\n\t\t},\n\t};\n\tint ret;\n\n\tst->data[0].d32 = cpu_to_be32(AD5686_CMD(AD5686_CMD_NOOP) |\n\t\t\t\t      AD5686_ADDR(addr) |\n\t\t\t\t      0x00);\n\n\tret = i2c_transfer(i2c->adapter, msg, 2);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn be16_to_cpu(st->data[0].d16);\n}\n\nstatic int ad5686_i2c_write(struct ad5686_state *st,\n\t\t\t    u8 cmd, u8 addr, u16 val)\n{\n\tstruct i2c_client *i2c = to_i2c_client(st->dev);\n\tint ret;\n\n\tst->data[0].d32 = cpu_to_be32(AD5686_CMD(cmd) | AD5686_ADDR(addr)\n\t\t\t\t      | val);\n\n\tret = i2c_master_send(i2c, &st->data[0].d8[1], 3);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn (ret != 3) ? -EIO : 0;\n}\n\nstatic int ad5686_i2c_probe(struct i2c_client *i2c)\n{\n\tconst struct i2c_device_id *id = i2c_client_get_device_id(i2c);\n\treturn ad5686_probe(&i2c->dev, id->driver_data, id->name,\n\t\t\t    ad5686_i2c_write, ad5686_i2c_read);\n}\n\nstatic void ad5686_i2c_remove(struct i2c_client *i2c)\n{\n\tad5686_remove(&i2c->dev);\n}\n\nstatic const struct i2c_device_id ad5686_i2c_id[] = {\n\t{\"ad5311r\", ID_AD5311R},\n\t{\"ad5337r\", ID_AD5337R},\n\t{\"ad5338r\", ID_AD5338R},\n\t{\"ad5671r\", ID_AD5671R},\n\t{\"ad5673r\", ID_AD5673R},\n\t{\"ad5675r\", ID_AD5675R},\n\t{\"ad5677r\", ID_AD5677R},\n\t{\"ad5691r\", ID_AD5691R},\n\t{\"ad5692r\", ID_AD5692R},\n\t{\"ad5693\", ID_AD5693},\n\t{\"ad5693r\", ID_AD5693R},\n\t{\"ad5694\", ID_AD5694},\n\t{\"ad5694r\", ID_AD5694R},\n\t{\"ad5695r\", ID_AD5695R},\n\t{\"ad5696\", ID_AD5696},\n\t{\"ad5696r\", ID_AD5696R},\n\t{}\n};\nMODULE_DEVICE_TABLE(i2c, ad5686_i2c_id);\n\nstatic const struct of_device_id ad5686_of_match[] = {\n\t{ .compatible = \"adi,ad5311r\" },\n\t{ .compatible = \"adi,ad5337r\" },\n\t{ .compatible = \"adi,ad5338r\" },\n\t{ .compatible = \"adi,ad5671r\" },\n\t{ .compatible = \"adi,ad5675r\" },\n\t{ .compatible = \"adi,ad5691r\" },\n\t{ .compatible = \"adi,ad5692r\" },\n\t{ .compatible = \"adi,ad5693\" },\n\t{ .compatible = \"adi,ad5693r\" },\n\t{ .compatible = \"adi,ad5694\" },\n\t{ .compatible = \"adi,ad5694r\" },\n\t{ .compatible = \"adi,ad5695r\" },\n\t{ .compatible = \"adi,ad5696\" },\n\t{ .compatible = \"adi,ad5696r\" },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, ad5686_of_match);\n\nstatic struct i2c_driver ad5686_i2c_driver = {\n\t.driver = {\n\t\t.name = \"ad5696\",\n\t\t.of_match_table = ad5686_of_match,\n\t},\n\t.probe = ad5686_i2c_probe,\n\t.remove = ad5686_i2c_remove,\n\t.id_table = ad5686_i2c_id,\n};\n\nmodule_i2c_driver(ad5686_i2c_driver);\n\nMODULE_AUTHOR(\"Stefan Popa <stefan.popa@analog.com>\");\nMODULE_DESCRIPTION(\"Analog Devices AD5686 and similar multi-channel DACs\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_IMPORT_NS(IIO_AD5686);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}