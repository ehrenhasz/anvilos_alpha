{
  "module_name": "iqs620at-temp.c",
  "hash_id": "0742ae6e4c9eec560c824a6e021ba4ecd55aeab48705ceca5eea2615b3c011a2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/temperature/iqs620at-temp.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/iio/iio.h>\n#include <linux/kernel.h>\n#include <linux/mfd/iqs62x.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\n#define IQS620_TEMP_UI_OUT\t\t\t0x1A\n\n#define IQS620_TEMP_SCALE\t\t\t1000\n#define IQS620_TEMP_OFFSET\t\t\t(-100)\n#define IQS620_TEMP_OFFSET_V3\t\t\t(-40)\n\nstatic int iqs620_temp_read_raw(struct iio_dev *indio_dev,\n\t\t\t\tstruct iio_chan_spec const *chan,\n\t\t\t\tint *val, int *val2, long mask)\n{\n\tstruct iqs62x_core *iqs62x = iio_device_get_drvdata(indio_dev);\n\tint ret;\n\t__le16 val_buf;\n\n\tswitch (mask) {\n\tcase IIO_CHAN_INFO_RAW:\n\t\tret = regmap_raw_read(iqs62x->regmap, IQS620_TEMP_UI_OUT,\n\t\t\t\t      &val_buf, sizeof(val_buf));\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\t*val = le16_to_cpu(val_buf);\n\t\treturn IIO_VAL_INT;\n\n\tcase IIO_CHAN_INFO_SCALE:\n\t\t*val = IQS620_TEMP_SCALE;\n\t\treturn IIO_VAL_INT;\n\n\tcase IIO_CHAN_INFO_OFFSET:\n\t\t*val = iqs62x->hw_num < IQS620_HW_NUM_V3 ? IQS620_TEMP_OFFSET\n\t\t\t\t\t\t\t : IQS620_TEMP_OFFSET_V3;\n\t\treturn IIO_VAL_INT;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic const struct iio_info iqs620_temp_info = {\n\t.read_raw = &iqs620_temp_read_raw,\n};\n\nstatic const struct iio_chan_spec iqs620_temp_channels[] = {\n\t{\n\t\t.type = IIO_TEMP,\n\t\t.info_mask_separate = BIT(IIO_CHAN_INFO_RAW) |\n\t\t\t\t      BIT(IIO_CHAN_INFO_SCALE) |\n\t\t\t\t      BIT(IIO_CHAN_INFO_OFFSET),\n\t},\n};\n\nstatic int iqs620_temp_probe(struct platform_device *pdev)\n{\n\tstruct iqs62x_core *iqs62x = dev_get_drvdata(pdev->dev.parent);\n\tstruct iio_dev *indio_dev;\n\n\tindio_dev = devm_iio_device_alloc(&pdev->dev, 0);\n\tif (!indio_dev)\n\t\treturn -ENOMEM;\n\n\tiio_device_set_drvdata(indio_dev, iqs62x);\n\n\tindio_dev->modes = INDIO_DIRECT_MODE;\n\tindio_dev->channels = iqs620_temp_channels;\n\tindio_dev->num_channels = ARRAY_SIZE(iqs620_temp_channels);\n\tindio_dev->name = iqs62x->dev_desc->dev_name;\n\tindio_dev->info = &iqs620_temp_info;\n\n\treturn devm_iio_device_register(&pdev->dev, indio_dev);\n}\n\nstatic struct platform_driver iqs620_temp_platform_driver = {\n\t.driver = {\n\t\t.name = \"iqs620at-temp\",\n\t},\n\t.probe = iqs620_temp_probe,\n};\nmodule_platform_driver(iqs620_temp_platform_driver);\n\nMODULE_AUTHOR(\"Jeff LaBundy <jeff@labundy.com>\");\nMODULE_DESCRIPTION(\"Azoteq IQS620AT Temperature Sensor\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:iqs620at-temp\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}