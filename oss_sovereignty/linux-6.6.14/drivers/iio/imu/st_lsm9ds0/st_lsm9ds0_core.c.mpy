{
  "module_name": "st_lsm9ds0_core.c",
  "hash_id": "ec7728bdfd6ba939da31c3ddee6c0160942bbf0ec81204d2b8b37beb511f3bdf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/imu/st_lsm9ds0/st_lsm9ds0_core.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n#include <linux/regulator/consumer.h>\n\n#include <linux/iio/common/st_sensors.h>\n#include <linux/iio/iio.h>\n\n#include \"st_lsm9ds0.h\"\n\nstatic int st_lsm9ds0_probe_accel(struct st_lsm9ds0 *lsm9ds0, struct regmap *regmap)\n{\n\tconst struct st_sensor_settings *settings;\n\tstruct device *dev = lsm9ds0->dev;\n\tstruct st_sensor_data *data;\n\n\tsettings = st_accel_get_settings(lsm9ds0->name);\n\tif (!settings) {\n\t\tdev_err(dev, \"device name %s not recognized.\\n\", lsm9ds0->name);\n\t\treturn -ENODEV;\n\t}\n\n\tlsm9ds0->accel = devm_iio_device_alloc(dev, sizeof(*data));\n\tif (!lsm9ds0->accel)\n\t\treturn -ENOMEM;\n\n\tlsm9ds0->accel->name = lsm9ds0->name;\n\n\tdata = iio_priv(lsm9ds0->accel);\n\tdata->sensor_settings = (struct st_sensor_settings *)settings;\n\tdata->irq = lsm9ds0->irq;\n\tdata->regmap = regmap;\n\n\treturn st_accel_common_probe(lsm9ds0->accel);\n}\n\nstatic int st_lsm9ds0_probe_magn(struct st_lsm9ds0 *lsm9ds0, struct regmap *regmap)\n{\n\tconst struct st_sensor_settings *settings;\n\tstruct device *dev = lsm9ds0->dev;\n\tstruct st_sensor_data *data;\n\n\tsettings = st_magn_get_settings(lsm9ds0->name);\n\tif (!settings) {\n\t\tdev_err(dev, \"device name %s not recognized.\\n\", lsm9ds0->name);\n\t\treturn -ENODEV;\n\t}\n\n\tlsm9ds0->magn = devm_iio_device_alloc(dev, sizeof(*data));\n\tif (!lsm9ds0->magn)\n\t\treturn -ENOMEM;\n\n\tlsm9ds0->magn->name = lsm9ds0->name;\n\n\tdata = iio_priv(lsm9ds0->magn);\n\tdata->sensor_settings = (struct st_sensor_settings *)settings;\n\tdata->irq = lsm9ds0->irq;\n\tdata->regmap = regmap;\n\n\treturn st_magn_common_probe(lsm9ds0->magn);\n}\n\nint st_lsm9ds0_probe(struct st_lsm9ds0 *lsm9ds0, struct regmap *regmap)\n{\n\tstruct device *dev = lsm9ds0->dev;\n\tstatic const char * const regulator_names[] = { \"vdd\", \"vddio\" };\n\tint ret;\n\n\t \n\tret = devm_regulator_bulk_get_enable(dev, ARRAY_SIZE(regulator_names),\n\t\t\t\t\t     regulator_names);\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret,\n\t\t\t\t     \"unable to enable Vdd supply\\n\");\n\n\t \n\tret = st_lsm9ds0_probe_accel(lsm9ds0, regmap);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\treturn st_lsm9ds0_probe_magn(lsm9ds0, regmap);\n}\nEXPORT_SYMBOL_NS_GPL(st_lsm9ds0_probe, IIO_ST_SENSORS);\n\nMODULE_AUTHOR(\"Andy Shevchenko <andriy.shevchenko@linux.intel.com>\");\nMODULE_DESCRIPTION(\"STMicroelectronics LSM9DS0 IMU core driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_IMPORT_NS(IIO_ST_SENSORS);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}