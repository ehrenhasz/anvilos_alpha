{
  "module_name": "st_lsm6dsx.h",
  "hash_id": "d30ec2cfc7c19d92e147af8fdc57aaf987d879040ce53c0ad0a3975d99576d2c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/imu/st_lsm6dsx/st_lsm6dsx.h",
  "human_readable_source": " \n \n\n#ifndef ST_LSM6DSX_H\n#define ST_LSM6DSX_H\n\n#include <linux/device.h>\n#include <linux/iio/iio.h>\n#include <linux/regulator/consumer.h>\n\n#define ST_LSM6DS3_DEV_NAME\t\"lsm6ds3\"\n#define ST_LSM6DS3H_DEV_NAME\t\"lsm6ds3h\"\n#define ST_LSM6DSL_DEV_NAME\t\"lsm6dsl\"\n#define ST_LSM6DSM_DEV_NAME\t\"lsm6dsm\"\n#define ST_ISM330DLC_DEV_NAME\t\"ism330dlc\"\n#define ST_LSM6DSO_DEV_NAME\t\"lsm6dso\"\n#define ST_ASM330LHH_DEV_NAME\t\"asm330lhh\"\n#define ST_LSM6DSOX_DEV_NAME\t\"lsm6dsox\"\n#define ST_LSM6DSR_DEV_NAME\t\"lsm6dsr\"\n#define ST_LSM6DS3TRC_DEV_NAME\t\"lsm6ds3tr-c\"\n#define ST_ISM330DHCX_DEV_NAME\t\"ism330dhcx\"\n#define ST_LSM9DS1_DEV_NAME\t\"lsm9ds1-imu\"\n#define ST_LSM6DS0_DEV_NAME\t\"lsm6ds0\"\n#define ST_LSM6DSRX_DEV_NAME\t\"lsm6dsrx\"\n#define ST_LSM6DST_DEV_NAME\t\"lsm6dst\"\n#define ST_LSM6DSOP_DEV_NAME\t\"lsm6dsop\"\n#define ST_ASM330LHHX_DEV_NAME\t\"asm330lhhx\"\n#define ST_LSM6DSTX_DEV_NAME\t\"lsm6dstx\"\n#define ST_LSM6DSV_DEV_NAME\t\"lsm6dsv\"\n#define ST_LSM6DSV16X_DEV_NAME\t\"lsm6dsv16x\"\n#define ST_LSM6DSO16IS_DEV_NAME\t\"lsm6dso16is\"\n#define ST_ISM330IS_DEV_NAME\t\"ism330is\"\n#define ST_ASM330LHB_DEV_NAME\t\"asm330lhb\"\n\nenum st_lsm6dsx_hw_id {\n\tST_LSM6DS3_ID = 1,\n\tST_LSM6DS3H_ID,\n\tST_LSM6DSL_ID,\n\tST_LSM6DSM_ID,\n\tST_ISM330DLC_ID,\n\tST_LSM6DSO_ID,\n\tST_ASM330LHH_ID,\n\tST_LSM6DSOX_ID,\n\tST_LSM6DSR_ID,\n\tST_LSM6DS3TRC_ID,\n\tST_ISM330DHCX_ID,\n\tST_LSM9DS1_ID,\n\tST_LSM6DS0_ID,\n\tST_LSM6DSRX_ID,\n\tST_LSM6DST_ID,\n\tST_LSM6DSOP_ID,\n\tST_ASM330LHHX_ID,\n\tST_LSM6DSTX_ID,\n\tST_LSM6DSV_ID,\n\tST_LSM6DSV16X_ID,\n\tST_LSM6DSO16IS_ID,\n\tST_ISM330IS_ID,\n\tST_ASM330LHB_ID,\n\tST_LSM6DSX_MAX_ID,\n};\n\n#define ST_LSM6DSX_BUFF_SIZE\t\t512\n#define ST_LSM6DSX_CHAN_SIZE\t\t2\n#define ST_LSM6DSX_SAMPLE_SIZE\t\t6\n#define ST_LSM6DSX_TAG_SIZE\t\t1\n#define ST_LSM6DSX_TAGGED_SAMPLE_SIZE\t(ST_LSM6DSX_SAMPLE_SIZE + \\\n\t\t\t\t\t ST_LSM6DSX_TAG_SIZE)\n#define ST_LSM6DSX_MAX_WORD_LEN\t\t((32 / ST_LSM6DSX_SAMPLE_SIZE) * \\\n\t\t\t\t\t ST_LSM6DSX_SAMPLE_SIZE)\n#define ST_LSM6DSX_MAX_TAGGED_WORD_LEN\t((32 / ST_LSM6DSX_TAGGED_SAMPLE_SIZE) \\\n\t\t\t\t\t * ST_LSM6DSX_TAGGED_SAMPLE_SIZE)\n#define ST_LSM6DSX_SHIFT_VAL(val, mask)\t(((val) << __ffs(mask)) & (mask))\n\n#define ST_LSM6DSX_CHANNEL_ACC(chan_type, addr, mod, scan_idx)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t.type = chan_type,\t\t\t\t\t\t\\\n\t.address = addr,\t\t\t\t\t\t\\\n\t.modified = 1,\t\t\t\t\t\t\t\\\n\t.channel2 = mod,\t\t\t\t\t\t\\\n\t.info_mask_separate = BIT(IIO_CHAN_INFO_RAW),\t\t\t\\\n\t.info_mask_shared_by_type = BIT(IIO_CHAN_INFO_SCALE),\t\t\\\n\t.info_mask_shared_by_all = BIT(IIO_CHAN_INFO_SAMP_FREQ),\t\\\n\t.scan_index = scan_idx,\t\t\t\t\t\t\\\n\t.scan_type = {\t\t\t\t\t\t\t\\\n\t\t.sign = 's',\t\t\t\t\t\t\\\n\t\t.realbits = 16,\t\t\t\t\t\t\\\n\t\t.storagebits = 16,\t\t\t\t\t\\\n\t\t.endianness = IIO_LE,\t\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\\\n\t.event_spec = &st_lsm6dsx_event,\t\t\t\t\\\n\t.ext_info = st_lsm6dsx_ext_info,\t\t\t\t\\\n\t.num_event_specs = 1,\t\t\t\t\t\t\\\n}\n\n#define ST_LSM6DSX_CHANNEL(chan_type, addr, mod, scan_idx)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t.type = chan_type,\t\t\t\t\t\t\\\n\t.address = addr,\t\t\t\t\t\t\\\n\t.modified = 1,\t\t\t\t\t\t\t\\\n\t.channel2 = mod,\t\t\t\t\t\t\\\n\t.info_mask_separate = BIT(IIO_CHAN_INFO_RAW),\t\t\t\\\n\t.info_mask_shared_by_type = BIT(IIO_CHAN_INFO_SCALE),\t\t\\\n\t.info_mask_shared_by_all = BIT(IIO_CHAN_INFO_SAMP_FREQ),\t\\\n\t.scan_index = scan_idx,\t\t\t\t\t\t\\\n\t.scan_type = {\t\t\t\t\t\t\t\\\n\t\t.sign = 's',\t\t\t\t\t\t\\\n\t\t.realbits = 16,\t\t\t\t\t\t\\\n\t\t.storagebits = 16,\t\t\t\t\t\\\n\t\t.endianness = IIO_LE,\t\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\\\n\t.ext_info = st_lsm6dsx_ext_info,\t\t\t\t\\\n}\n\nstruct st_lsm6dsx_reg {\n\tu8 addr;\n\tu8 mask;\n};\n\nstruct st_lsm6dsx_sensor;\nstruct st_lsm6dsx_hw;\n\nstruct st_lsm6dsx_odr {\n\tu32 milli_hz;\n\tu8 val;\n};\n\n#define ST_LSM6DSX_ODR_LIST_SIZE\t8\nstruct st_lsm6dsx_odr_table_entry {\n\tstruct st_lsm6dsx_reg reg;\n\n\tstruct st_lsm6dsx_odr odr_avl[ST_LSM6DSX_ODR_LIST_SIZE];\n\tint odr_len;\n};\n\nstruct st_lsm6dsx_samples_to_discard {\n\tstruct {\n\t\tu32 milli_hz;\n\t\tu16 samples;\n\t} val[ST_LSM6DSX_ODR_LIST_SIZE];\n};\n\nstruct st_lsm6dsx_fs {\n\tu32 gain;\n\tu8 val;\n};\n\n#define ST_LSM6DSX_FS_LIST_SIZE\t\t4\nstruct st_lsm6dsx_fs_table_entry {\n\tstruct st_lsm6dsx_reg reg;\n\n\tstruct st_lsm6dsx_fs fs_avl[ST_LSM6DSX_FS_LIST_SIZE];\n\tint fs_len;\n};\n\n \nstruct st_lsm6dsx_fifo_ops {\n\tint (*update_fifo)(struct st_lsm6dsx_sensor *sensor, bool enable);\n\tint (*read_fifo)(struct st_lsm6dsx_hw *hw);\n\tstruct {\n\t\tu8 addr;\n\t\tu16 mask;\n\t} fifo_th;\n\tstruct {\n\t\tu8 addr;\n\t\tu16 mask;\n\t} fifo_diff;\n\tu16 max_size;\n\tu8 th_wl;\n};\n\n \nstruct st_lsm6dsx_hw_ts_settings {\n\tstruct st_lsm6dsx_reg timer_en;\n\tstruct st_lsm6dsx_reg hr_timer;\n\tstruct st_lsm6dsx_reg fifo_en;\n\tstruct st_lsm6dsx_reg decimator;\n\tu8 freq_fine;\n};\n\n \nstruct st_lsm6dsx_shub_settings {\n\tstruct st_lsm6dsx_reg page_mux;\n\tstruct {\n\t\tbool sec_page;\n\t\tu8 addr;\n\t\tu8 mask;\n\t} master_en;\n\tstruct {\n\t\tbool sec_page;\n\t\tu8 addr;\n\t\tu8 mask;\n\t} pullup_en;\n\tstruct st_lsm6dsx_reg aux_sens;\n\tstruct st_lsm6dsx_reg wr_once;\n\tstruct st_lsm6dsx_reg emb_func;\n\tu8 num_ext_dev;\n\tstruct {\n\t\tbool sec_page;\n\t\tu8 addr;\n\t} shub_out;\n\tu8 slv0_addr;\n\tu8 dw_slv0_addr;\n\tu8 batch_en;\n\tu8 pause;\n};\n\nstruct st_lsm6dsx_event_settings {\n\tstruct st_lsm6dsx_reg enable_reg;\n\tstruct st_lsm6dsx_reg wakeup_reg;\n\tu8 wakeup_src_reg;\n\tu8 wakeup_src_status_mask;\n\tu8 wakeup_src_z_mask;\n\tu8 wakeup_src_y_mask;\n\tu8 wakeup_src_x_mask;\n};\n\nenum st_lsm6dsx_ext_sensor_id {\n\tST_LSM6DSX_ID_MAGN,\n};\n\n \nstruct st_lsm6dsx_ext_dev_settings {\n\tu8 i2c_addr[2];\n\tstruct {\n\t\tu8 addr;\n\t\tu8 val;\n\t} wai;\n\tenum st_lsm6dsx_ext_sensor_id id;\n\tstruct st_lsm6dsx_odr_table_entry odr_table;\n\tstruct st_lsm6dsx_fs_table_entry fs_table;\n\tstruct st_lsm6dsx_reg temp_comp;\n\tstruct {\n\t\tstruct st_lsm6dsx_reg reg;\n\t\tu8 off_val;\n\t\tu8 on_val;\n\t} pwr_table;\n\tstruct st_lsm6dsx_reg off_canc;\n\tstruct st_lsm6dsx_reg bdu;\n\tstruct {\n\t\tu8 addr;\n\t\tu8 len;\n\t} out;\n};\n\n \nstruct st_lsm6dsx_settings {\n\tstruct st_lsm6dsx_reg reset;\n\tstruct st_lsm6dsx_reg boot;\n\tstruct st_lsm6dsx_reg bdu;\n\tstruct {\n\t\tenum st_lsm6dsx_hw_id hw_id;\n\t\tconst char *name;\n\t\tu8 wai;\n\t} id[ST_LSM6DSX_MAX_ID];\n\tstruct {\n\t\tconst struct iio_chan_spec *chan;\n\t\tint len;\n\t} channels[2];\n\tstruct {\n\t\tstruct st_lsm6dsx_reg irq1;\n\t\tstruct st_lsm6dsx_reg irq2;\n\t\tstruct st_lsm6dsx_reg irq1_func;\n\t\tstruct st_lsm6dsx_reg irq2_func;\n\t\tstruct st_lsm6dsx_reg lir;\n\t\tstruct st_lsm6dsx_reg clear_on_read;\n\t\tstruct st_lsm6dsx_reg hla;\n\t\tstruct st_lsm6dsx_reg od;\n\t} irq_config;\n\tstruct st_lsm6dsx_reg drdy_mask;\n\tstruct st_lsm6dsx_odr_table_entry odr_table[2];\n\tstruct st_lsm6dsx_samples_to_discard samples_to_discard[2];\n\tstruct st_lsm6dsx_fs_table_entry fs_table[2];\n\tstruct st_lsm6dsx_reg decimator[ST_LSM6DSX_MAX_ID];\n\tstruct st_lsm6dsx_reg batch[ST_LSM6DSX_MAX_ID];\n\tstruct st_lsm6dsx_fifo_ops fifo_ops;\n\tstruct st_lsm6dsx_hw_ts_settings ts_settings;\n\tstruct st_lsm6dsx_shub_settings shub_settings;\n\tstruct st_lsm6dsx_event_settings event_settings;\n};\n\nenum st_lsm6dsx_sensor_id {\n\tST_LSM6DSX_ID_GYRO,\n\tST_LSM6DSX_ID_ACC,\n\tST_LSM6DSX_ID_EXT0,\n\tST_LSM6DSX_ID_EXT1,\n\tST_LSM6DSX_ID_EXT2,\n\tST_LSM6DSX_ID_MAX,\n};\n\nenum st_lsm6dsx_fifo_mode {\n\tST_LSM6DSX_FIFO_BYPASS = 0x0,\n\tST_LSM6DSX_FIFO_CONT = 0x6,\n};\n\n \nstruct st_lsm6dsx_sensor {\n\tchar name[32];\n\tenum st_lsm6dsx_sensor_id id;\n\tstruct st_lsm6dsx_hw *hw;\n\n\tu32 gain;\n\tu32 odr;\n\n\tu16 samples_to_discard;\n\tu16 watermark;\n\tu8 decimator;\n\tu8 sip;\n\ts64 ts_ref;\n\n\tstruct {\n\t\tconst struct st_lsm6dsx_ext_dev_settings *settings;\n\t\tu32 slv_odr;\n\t\tu8 addr;\n\t} ext_info;\n};\n\n \nstruct st_lsm6dsx_hw {\n\tstruct device *dev;\n\tstruct regmap *regmap;\n\tint irq;\n\n\tstruct mutex fifo_lock;\n\tstruct mutex conf_lock;\n\tstruct mutex page_lock;\n\n\tu8 suspend_mask;\n\tu8 enable_mask;\n\tu8 fifo_mask;\n\ts64 ts_gain;\n\tu8 ts_sip;\n\tu8 sip;\n\n\tconst struct st_lsm6dsx_reg *irq_routing;\n\tu8 event_threshold;\n\tu8 enable_event;\n\n\tu8 *buff;\n\n\tstruct iio_dev *iio_devs[ST_LSM6DSX_ID_MAX];\n\n\tconst struct st_lsm6dsx_settings *settings;\n\n\tstruct iio_mount_matrix orientation;\n\t \n\tstruct {\n\t\t__le16 channels[3];\n\t\ts64 ts __aligned(8);\n\t} scan[ST_LSM6DSX_ID_MAX];\n};\n\nstatic __maybe_unused const struct iio_event_spec st_lsm6dsx_event = {\n\t.type = IIO_EV_TYPE_THRESH,\n\t.dir = IIO_EV_DIR_EITHER,\n\t.mask_separate = BIT(IIO_EV_INFO_VALUE) |\n\t\t\t BIT(IIO_EV_INFO_ENABLE)\n};\n\nstatic __maybe_unused const unsigned long st_lsm6dsx_available_scan_masks[] = {\n\t0x7, 0x0,\n};\n\nextern const struct dev_pm_ops st_lsm6dsx_pm_ops;\n\nint st_lsm6dsx_probe(struct device *dev, int irq, int hw_id,\n\t\t     struct regmap *regmap);\nint st_lsm6dsx_sensor_set_enable(struct st_lsm6dsx_sensor *sensor,\n\t\t\t\t bool enable);\nint st_lsm6dsx_fifo_setup(struct st_lsm6dsx_hw *hw);\nint st_lsm6dsx_set_watermark(struct iio_dev *iio_dev, unsigned int val);\nint st_lsm6dsx_update_watermark(struct st_lsm6dsx_sensor *sensor,\n\t\t\t\tu16 watermark);\nint st_lsm6dsx_update_fifo(struct st_lsm6dsx_sensor *sensor, bool enable);\nint st_lsm6dsx_flush_fifo(struct st_lsm6dsx_hw *hw);\nint st_lsm6dsx_resume_fifo(struct st_lsm6dsx_hw *hw);\nint st_lsm6dsx_read_fifo(struct st_lsm6dsx_hw *hw);\nint st_lsm6dsx_read_tagged_fifo(struct st_lsm6dsx_hw *hw);\nint st_lsm6dsx_check_odr(struct st_lsm6dsx_sensor *sensor, u32 odr, u8 *val);\nint st_lsm6dsx_shub_probe(struct st_lsm6dsx_hw *hw, const char *name);\nint st_lsm6dsx_shub_set_enable(struct st_lsm6dsx_sensor *sensor, bool enable);\nint st_lsm6dsx_shub_read_output(struct st_lsm6dsx_hw *hw, u8 *data, int len);\nint st_lsm6dsx_set_page(struct st_lsm6dsx_hw *hw, bool enable);\n\nstatic inline int\nst_lsm6dsx_update_bits_locked(struct st_lsm6dsx_hw *hw, unsigned int addr,\n\t\t\t      unsigned int mask, unsigned int val)\n{\n\tint err;\n\n\tmutex_lock(&hw->page_lock);\n\terr = regmap_update_bits(hw->regmap, addr, mask, val);\n\tmutex_unlock(&hw->page_lock);\n\n\treturn err;\n}\n\nstatic inline int\nst_lsm6dsx_read_locked(struct st_lsm6dsx_hw *hw, unsigned int addr,\n\t\t       void *val, unsigned int len)\n{\n\tint err;\n\n\tmutex_lock(&hw->page_lock);\n\terr = regmap_bulk_read(hw->regmap, addr, val, len);\n\tmutex_unlock(&hw->page_lock);\n\n\treturn err;\n}\n\nstatic inline int\nst_lsm6dsx_write_locked(struct st_lsm6dsx_hw *hw, unsigned int addr,\n\t\t\tunsigned int val)\n{\n\tint err;\n\n\tmutex_lock(&hw->page_lock);\n\terr = regmap_write(hw->regmap, addr, val);\n\tmutex_unlock(&hw->page_lock);\n\n\treturn err;\n}\n\nstatic inline const struct iio_mount_matrix *\nst_lsm6dsx_get_mount_matrix(const struct iio_dev *iio_dev,\n\t\t\t    const struct iio_chan_spec *chan)\n{\n\tstruct st_lsm6dsx_sensor *sensor = iio_priv(iio_dev);\n\tstruct st_lsm6dsx_hw *hw = sensor->hw;\n\n\treturn &hw->orientation;\n}\n\nstatic inline int\nst_lsm6dsx_device_set_enable(struct st_lsm6dsx_sensor *sensor, bool enable)\n{\n\tif (sensor->id == ST_LSM6DSX_ID_EXT0 ||\n\t    sensor->id == ST_LSM6DSX_ID_EXT1 ||\n\t    sensor->id == ST_LSM6DSX_ID_EXT2)\n\t\treturn st_lsm6dsx_shub_set_enable(sensor, enable);\n\n\treturn st_lsm6dsx_sensor_set_enable(sensor, enable);\n}\n\nstatic const\nstruct iio_chan_spec_ext_info __maybe_unused st_lsm6dsx_ext_info[] = {\n\tIIO_MOUNT_MATRIX(IIO_SHARED_BY_ALL, st_lsm6dsx_get_mount_matrix),\n\t{ }\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}