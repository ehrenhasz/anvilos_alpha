{
  "module_name": "adis_trigger.c",
  "hash_id": "4c941cbd3674c1ea44bdd50d344fa6e288c2ca887b8876c8be7f27db691c1759",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/imu/adis_trigger.c",
  "human_readable_source": "\n \n\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/spi/spi.h>\n#include <linux/export.h>\n\n#include <linux/iio/iio.h>\n#include <linux/iio/trigger.h>\n#include <linux/iio/imu/adis.h>\n\nstatic int adis_data_rdy_trigger_set_state(struct iio_trigger *trig, bool state)\n{\n\tstruct adis *adis = iio_trigger_get_drvdata(trig);\n\n\treturn adis_enable_irq(adis, state);\n}\n\nstatic const struct iio_trigger_ops adis_trigger_ops = {\n\t.set_trigger_state = &adis_data_rdy_trigger_set_state,\n};\n\nstatic int adis_validate_irq_flag(struct adis *adis)\n{\n\tunsigned long direction = adis->irq_flag & IRQF_TRIGGER_MASK;\n\n\t \n\tif (adis->data->unmasked_drdy)\n\t\tadis->irq_flag |= IRQF_NO_AUTOEN;\n\t \n\tif (direction == IRQF_TRIGGER_NONE) {\n\t\tadis->irq_flag |= IRQF_TRIGGER_RISING;\n\t\treturn 0;\n\t} else if (direction != IRQF_TRIGGER_RISING &&\n\t\t   direction != IRQF_TRIGGER_FALLING) {\n\t\tdev_err(&adis->spi->dev, \"Invalid IRQ mask: %08lx\\n\",\n\t\t\tadis->irq_flag);\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n \nint devm_adis_probe_trigger(struct adis *adis, struct iio_dev *indio_dev)\n{\n\tint ret;\n\n\tadis->trig = devm_iio_trigger_alloc(&adis->spi->dev, \"%s-dev%d\",\n\t\t\t\t\t    indio_dev->name,\n\t\t\t\t\t    iio_device_id(indio_dev));\n\tif (!adis->trig)\n\t\treturn -ENOMEM;\n\n\tadis->trig->ops = &adis_trigger_ops;\n\tiio_trigger_set_drvdata(adis->trig, adis);\n\n\tret = adis_validate_irq_flag(adis);\n\tif (ret)\n\t\treturn ret;\n\n\tret = devm_request_irq(&adis->spi->dev, adis->spi->irq,\n\t\t\t       &iio_trigger_generic_data_rdy_poll,\n\t\t\t       adis->irq_flag,\n\t\t\t       indio_dev->name,\n\t\t\t       adis->trig);\n\tif (ret)\n\t\treturn ret;\n\n\treturn devm_iio_trigger_register(&adis->spi->dev, adis->trig);\n}\nEXPORT_SYMBOL_NS_GPL(devm_adis_probe_trigger, IIO_ADISLIB);\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}