{
  "module_name": "inv_icm42600_temp.c",
  "hash_id": "8aee58a89db4687923fd28bf1c1ce1b317489127c07318862d086297ae7eea8e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/imu/inv_icm42600/inv_icm42600_temp.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/mutex.h>\n#include <linux/pm_runtime.h>\n#include <linux/regmap.h>\n#include <linux/iio/iio.h>\n\n#include \"inv_icm42600.h\"\n#include \"inv_icm42600_temp.h\"\n\nstatic int inv_icm42600_temp_read(struct inv_icm42600_state *st, int16_t *temp)\n{\n\tstruct device *dev = regmap_get_device(st->map);\n\t__be16 *raw;\n\tint ret;\n\n\tpm_runtime_get_sync(dev);\n\tmutex_lock(&st->lock);\n\n\tret = inv_icm42600_set_temp_conf(st, true, NULL);\n\tif (ret)\n\t\tgoto exit;\n\n\traw = (__be16 *)&st->buffer[0];\n\tret = regmap_bulk_read(st->map, INV_ICM42600_REG_TEMP_DATA, raw, sizeof(*raw));\n\tif (ret)\n\t\tgoto exit;\n\n\t*temp = (int16_t)be16_to_cpup(raw);\n\tif (*temp == INV_ICM42600_DATA_INVALID)\n\t\tret = -EINVAL;\n\nexit:\n\tmutex_unlock(&st->lock);\n\tpm_runtime_mark_last_busy(dev);\n\tpm_runtime_put_autosuspend(dev);\n\n\treturn ret;\n}\n\nint inv_icm42600_temp_read_raw(struct iio_dev *indio_dev,\n\t\t\t       struct iio_chan_spec const *chan,\n\t\t\t       int *val, int *val2, long mask)\n{\n\tstruct inv_icm42600_state *st = iio_device_get_drvdata(indio_dev);\n\tint16_t temp;\n\tint ret;\n\n\tif (chan->type != IIO_TEMP)\n\t\treturn -EINVAL;\n\n\tswitch (mask) {\n\tcase IIO_CHAN_INFO_RAW:\n\t\tret = iio_device_claim_direct_mode(indio_dev);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret = inv_icm42600_temp_read(st, &temp);\n\t\tiio_device_release_direct_mode(indio_dev);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\t*val = temp;\n\t\treturn IIO_VAL_INT;\n\t \n\tcase IIO_CHAN_INFO_SCALE:\n\t\t*val = 7;\n\t\t*val2 = 548309;\n\t\treturn IIO_VAL_INT_PLUS_MICRO;\n\tcase IIO_CHAN_INFO_OFFSET:\n\t\t*val = 25000;\n\t\treturn IIO_VAL_INT;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}