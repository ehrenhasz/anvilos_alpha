{
  "module_name": "sx9310.c",
  "hash_id": "80a65d3e58103dc5e8e6eda482762450f05e16121ada3e2ee0c98807fc19a44e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/proximity/sx9310.c",
  "human_readable_source": "\n \n\n#include <linux/bitfield.h>\n#include <linux/delay.h>\n#include <linux/i2c.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/log2.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/pm.h>\n#include <linux/property.h>\n#include <linux/regmap.h>\n#include <linux/iio/iio.h>\n\n#include \"sx_common.h\"\n\n \n#define SX9310_REG_IRQ_SRC\t\t\t\tSX_COMMON_REG_IRQ_SRC\n#define SX9310_REG_STAT0\t\t\t\t0x01\n#define SX9310_REG_STAT1\t\t\t\t0x02\n#define SX9310_REG_STAT1_COMPSTAT_MASK\t\t\tGENMASK(3, 0)\n#define SX9310_REG_IRQ_MSK\t\t\t\t0x03\n#define   SX9310_CONVDONE_IRQ\t\t\t\tBIT(3)\n#define   SX9310_FAR_IRQ\t\t\t\tBIT(5)\n#define   SX9310_CLOSE_IRQ\t\t\t\tBIT(6)\n#define SX9310_REG_IRQ_FUNC\t\t\t\t0x04\n\n#define SX9310_REG_PROX_CTRL0\t\t\t\t0x10\n#define   SX9310_REG_PROX_CTRL0_SENSOREN_MASK\t\tGENMASK(3, 0)\n#define   SX9310_REG_PROX_CTRL0_SCANPERIOD_MASK\t\tGENMASK(7, 4)\n#define   SX9310_REG_PROX_CTRL0_SCANPERIOD_15MS\t\t0x01\n#define SX9310_REG_PROX_CTRL1\t\t\t\t0x11\n#define SX9310_REG_PROX_CTRL2\t\t\t\t0x12\n#define   SX9310_REG_PROX_CTRL2_COMBMODE_MASK\t\tGENMASK(7, 6)\n#define   SX9310_REG_PROX_CTRL2_COMBMODE_CS0_CS1_CS2_CS3 (0x03 << 6)\n#define   SX9310_REG_PROX_CTRL2_COMBMODE_CS1_CS2\t(0x02 << 6)\n#define   SX9310_REG_PROX_CTRL2_COMBMODE_CS0_CS1\t(0x01 << 6)\n#define   SX9310_REG_PROX_CTRL2_COMBMODE_CS3\t\t(0x00 << 6)\n#define   SX9310_REG_PROX_CTRL2_SHIELDEN_MASK\t\tGENMASK(3, 2)\n#define   SX9310_REG_PROX_CTRL2_SHIELDEN_DYNAMIC\t(0x01 << 2)\n#define   SX9310_REG_PROX_CTRL2_SHIELDEN_GROUND\t\t(0x02 << 2)\n#define SX9310_REG_PROX_CTRL3\t\t\t\t0x13\n#define   SX9310_REG_PROX_CTRL3_GAIN0_MASK\t\tGENMASK(3, 2)\n#define   SX9310_REG_PROX_CTRL3_GAIN0_X8\t\t(0x03 << 2)\n#define   SX9310_REG_PROX_CTRL3_GAIN12_MASK\t\tGENMASK(1, 0)\n#define   SX9310_REG_PROX_CTRL3_GAIN12_X4\t\t0x02\n#define SX9310_REG_PROX_CTRL4\t\t\t\t0x14\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_MASK\t\tGENMASK(2, 0)\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_FINEST\t0x07\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_VERY_FINE\t0x06\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_FINE\t\t0x05\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_MEDIUM\t0x04\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_MEDIUM_COARSE 0x03\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_COARSE\t0x02\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_VERY_COARSE\t0x01\n#define   SX9310_REG_PROX_CTRL4_RESOLUTION_COARSEST\t0x00\n#define SX9310_REG_PROX_CTRL5\t\t\t\t0x15\n#define   SX9310_REG_PROX_CTRL5_RANGE_SMALL\t\t(0x03 << 6)\n#define   SX9310_REG_PROX_CTRL5_STARTUPSENS_MASK\tGENMASK(3, 2)\n#define   SX9310_REG_PROX_CTRL5_STARTUPSENS_CS1\t\t(0x01 << 2)\n#define   SX9310_REG_PROX_CTRL5_RAWFILT_MASK\t\tGENMASK(1, 0)\n#define   SX9310_REG_PROX_CTRL5_RAWFILT_SHIFT\t\t0\n#define   SX9310_REG_PROX_CTRL5_RAWFILT_1P25\t\t0x02\n#define SX9310_REG_PROX_CTRL6\t\t\t\t0x16\n#define   SX9310_REG_PROX_CTRL6_AVGTHRESH_DEFAULT\t0x20\n#define SX9310_REG_PROX_CTRL7\t\t\t\t0x17\n#define   SX9310_REG_PROX_CTRL7_AVGNEGFILT_2\t\t(0x01 << 3)\n#define   SX9310_REG_PROX_CTRL7_AVGPOSFILT_MASK\t\tGENMASK(2, 0)\n#define   SX9310_REG_PROX_CTRL7_AVGPOSFILT_SHIFT\t0\n#define   SX9310_REG_PROX_CTRL7_AVGPOSFILT_512\t\t0x05\n#define SX9310_REG_PROX_CTRL8\t\t\t\t0x18\n#define   SX9310_REG_PROX_CTRL8_9_PTHRESH_MASK\t\tGENMASK(7, 3)\n#define SX9310_REG_PROX_CTRL9\t\t\t\t0x19\n#define   SX9310_REG_PROX_CTRL8_9_PTHRESH_28\t\t(0x08 << 3)\n#define   SX9310_REG_PROX_CTRL8_9_PTHRESH_96\t\t(0x11 << 3)\n#define   SX9310_REG_PROX_CTRL8_9_BODYTHRESH_900\t0x03\n#define   SX9310_REG_PROX_CTRL8_9_BODYTHRESH_1500\t0x05\n#define SX9310_REG_PROX_CTRL10\t\t\t\t0x1a\n#define   SX9310_REG_PROX_CTRL10_HYST_MASK\t\tGENMASK(5, 4)\n#define   SX9310_REG_PROX_CTRL10_HYST_6PCT\t\t(0x01 << 4)\n#define   SX9310_REG_PROX_CTRL10_CLOSE_DEBOUNCE_MASK\tGENMASK(3, 2)\n#define   SX9310_REG_PROX_CTRL10_FAR_DEBOUNCE_MASK\tGENMASK(1, 0)\n#define   SX9310_REG_PROX_CTRL10_FAR_DEBOUNCE_2\t\t0x01\n#define SX9310_REG_PROX_CTRL11\t\t\t\t0x1b\n#define SX9310_REG_PROX_CTRL12\t\t\t\t0x1c\n#define SX9310_REG_PROX_CTRL13\t\t\t\t0x1d\n#define SX9310_REG_PROX_CTRL14\t\t\t\t0x1e\n#define SX9310_REG_PROX_CTRL15\t\t\t\t0x1f\n#define SX9310_REG_PROX_CTRL16\t\t\t\t0x20\n#define SX9310_REG_PROX_CTRL17\t\t\t\t0x21\n#define SX9310_REG_PROX_CTRL18\t\t\t\t0x22\n#define SX9310_REG_PROX_CTRL19\t\t\t\t0x23\n#define SX9310_REG_SAR_CTRL0\t\t\t\t0x2a\n#define   SX9310_REG_SAR_CTRL0_SARDEB_4_SAMPLES\t\t(0x02 << 5)\n#define   SX9310_REG_SAR_CTRL0_SARHYST_8\t\t(0x02 << 3)\n#define SX9310_REG_SAR_CTRL1\t\t\t\t0x2b\n \n#define   SX9310_REG_SAR_CTRL1_SLOPE(_hnslope)\t\t(_hnslope / 78125)\n#define SX9310_REG_SAR_CTRL2\t\t\t\t0x2c\n#define   SX9310_REG_SAR_CTRL2_SAROFFSET_DEFAULT\t0x3c\n\n#define SX9310_REG_SENSOR_SEL\t\t\t\t0x30\n#define SX9310_REG_USE_MSB\t\t\t\t0x31\n#define SX9310_REG_USE_LSB\t\t\t\t0x32\n#define SX9310_REG_AVG_MSB\t\t\t\t0x33\n#define SX9310_REG_AVG_LSB\t\t\t\t0x34\n#define SX9310_REG_DIFF_MSB\t\t\t\t0x35\n#define SX9310_REG_DIFF_LSB\t\t\t\t0x36\n#define SX9310_REG_OFFSET_MSB\t\t\t\t0x37\n#define SX9310_REG_OFFSET_LSB\t\t\t\t0x38\n#define SX9310_REG_SAR_MSB\t\t\t\t0x39\n#define SX9310_REG_SAR_LSB\t\t\t\t0x3a\n#define SX9310_REG_I2C_ADDR\t\t\t\t0x40\n#define SX9310_REG_PAUSE\t\t\t\t0x41\n#define SX9310_REG_WHOAMI\t\t\t\t0x42\n#define   SX9310_WHOAMI_VALUE\t\t\t\t0x01\n#define   SX9311_WHOAMI_VALUE\t\t\t\t0x02\n#define SX9310_REG_RESET\t\t\t\t0x7f\n\n\n \n#define SX9310_NUM_CHANNELS\t\t\t\t4\nstatic_assert(SX9310_NUM_CHANNELS <= SX_COMMON_MAX_NUM_CHANNELS);\n\n#define SX9310_NAMED_CHANNEL(idx, name)\t\t\t\t \\\n{\t\t\t\t\t\t\t\t \\\n\t.type = IIO_PROXIMITY,\t\t\t\t\t \\\n\t.info_mask_separate = BIT(IIO_CHAN_INFO_RAW) |\t\t \\\n\t\t\t      BIT(IIO_CHAN_INFO_HARDWAREGAIN),   \\\n\t.info_mask_shared_by_all = BIT(IIO_CHAN_INFO_SAMP_FREQ), \\\n\t.info_mask_separate_available =\t\t\t\t \\\n\t\tBIT(IIO_CHAN_INFO_HARDWAREGAIN),\t\t \\\n\t.info_mask_shared_by_all_available =\t\t\t \\\n\t\tBIT(IIO_CHAN_INFO_SAMP_FREQ),\t\t\t \\\n\t.indexed = 1,\t\t\t\t\t\t \\\n\t.channel = idx,\t\t\t\t\t\t \\\n\t.extend_name = name,\t\t\t\t\t \\\n\t.address = SX9310_REG_DIFF_MSB,\t\t\t\t \\\n\t.event_spec = sx_common_events,\t\t\t\t \\\n\t.num_event_specs = ARRAY_SIZE(sx_common_events),\t \\\n\t.scan_index = idx,\t\t\t\t\t \\\n\t.scan_type = {\t\t\t\t\t\t \\\n\t\t.sign = 's',\t\t\t\t\t \\\n\t\t.realbits = 12,\t\t\t\t\t \\\n\t\t.storagebits = 16,\t\t\t\t \\\n\t\t.endianness = IIO_BE,\t\t\t\t \\\n\t},\t\t\t\t\t\t\t \\\n}\n#define SX9310_CHANNEL(idx) SX9310_NAMED_CHANNEL(idx, NULL)\n\nstatic const struct iio_chan_spec sx9310_channels[] = {\n\tSX9310_CHANNEL(0),\t\t\t \n\tSX9310_CHANNEL(1),\t\t\t \n\tSX9310_CHANNEL(2),\t\t\t \n\tSX9310_NAMED_CHANNEL(3, \"comb\"),\t \n\n\tIIO_CHAN_SOFT_TIMESTAMP(4),\n};\n\n \nstatic const struct {\n\tint val;\n\tint val2;\n} sx9310_samp_freq_table[] = {\n\t{ 500, 0 },  \n\t{ 66, 666666 },  \n\t{ 33, 333333 },  \n\t{ 22, 222222 },  \n\t{ 16, 666666 },  \n\t{ 11, 111111 },  \n\t{ 8, 333333 },  \n\t{ 5, 0 },  \n\t{ 2, 500000 },  \n\t{ 1, 666666 },  \n\t{ 1, 250000 },  \n\t{ 1, 0 },  \n\t{ 0, 500000 },  \n\t{ 0, 333333 },  \n\t{ 0, 250000 },  \n\t{ 0, 200000 },  \n};\nstatic const unsigned int sx9310_scan_period_table[] = {\n\t2,   15,  30,  45,   60,   90,\t 120,  200,\n\t400, 600, 800, 1000, 2000, 3000, 4000, 5000,\n};\n\nstatic const struct regmap_range sx9310_writable_reg_ranges[] = {\n\tregmap_reg_range(SX9310_REG_IRQ_MSK, SX9310_REG_IRQ_FUNC),\n\tregmap_reg_range(SX9310_REG_PROX_CTRL0, SX9310_REG_PROX_CTRL19),\n\tregmap_reg_range(SX9310_REG_SAR_CTRL0, SX9310_REG_SAR_CTRL2),\n\tregmap_reg_range(SX9310_REG_SENSOR_SEL, SX9310_REG_SENSOR_SEL),\n\tregmap_reg_range(SX9310_REG_OFFSET_MSB, SX9310_REG_OFFSET_LSB),\n\tregmap_reg_range(SX9310_REG_PAUSE, SX9310_REG_PAUSE),\n\tregmap_reg_range(SX9310_REG_RESET, SX9310_REG_RESET),\n};\n\nstatic const struct regmap_access_table sx9310_writeable_regs = {\n\t.yes_ranges = sx9310_writable_reg_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(sx9310_writable_reg_ranges),\n};\n\nstatic const struct regmap_range sx9310_readable_reg_ranges[] = {\n\tregmap_reg_range(SX9310_REG_IRQ_SRC, SX9310_REG_IRQ_FUNC),\n\tregmap_reg_range(SX9310_REG_PROX_CTRL0, SX9310_REG_PROX_CTRL19),\n\tregmap_reg_range(SX9310_REG_SAR_CTRL0, SX9310_REG_SAR_CTRL2),\n\tregmap_reg_range(SX9310_REG_SENSOR_SEL, SX9310_REG_SAR_LSB),\n\tregmap_reg_range(SX9310_REG_I2C_ADDR, SX9310_REG_WHOAMI),\n\tregmap_reg_range(SX9310_REG_RESET, SX9310_REG_RESET),\n};\n\nstatic const struct regmap_access_table sx9310_readable_regs = {\n\t.yes_ranges = sx9310_readable_reg_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(sx9310_readable_reg_ranges),\n};\n\nstatic const struct regmap_range sx9310_volatile_reg_ranges[] = {\n\tregmap_reg_range(SX9310_REG_IRQ_SRC, SX9310_REG_STAT1),\n\tregmap_reg_range(SX9310_REG_USE_MSB, SX9310_REG_DIFF_LSB),\n\tregmap_reg_range(SX9310_REG_SAR_MSB, SX9310_REG_SAR_LSB),\n\tregmap_reg_range(SX9310_REG_RESET, SX9310_REG_RESET),\n};\n\nstatic const struct regmap_access_table sx9310_volatile_regs = {\n\t.yes_ranges = sx9310_volatile_reg_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(sx9310_volatile_reg_ranges),\n};\n\nstatic const struct regmap_config sx9310_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.max_register = SX9310_REG_RESET,\n\t.cache_type = REGCACHE_RBTREE,\n\n\t.wr_table = &sx9310_writeable_regs,\n\t.rd_table = &sx9310_readable_regs,\n\t.volatile_table = &sx9310_volatile_regs,\n};\n\nstatic int sx9310_read_prox_data(struct sx_common_data *data,\n\t\t\t\t const struct iio_chan_spec *chan, __be16 *val)\n{\n\tint ret;\n\n\tret = regmap_write(data->regmap, SX9310_REG_SENSOR_SEL, chan->channel);\n\tif (ret)\n\t\treturn ret;\n\n\treturn regmap_bulk_read(data->regmap, chan->address, val, sizeof(*val));\n}\n\n \nstatic int sx9310_wait_for_sample(struct sx_common_data *data)\n{\n\tint ret;\n\tunsigned int val;\n\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL0, &val);\n\tif (ret)\n\t\treturn ret;\n\n\tval = FIELD_GET(SX9310_REG_PROX_CTRL0_SCANPERIOD_MASK, val);\n\n\tmsleep(sx9310_scan_period_table[val]);\n\n\treturn 0;\n}\n\nstatic int sx9310_read_gain(struct sx_common_data *data,\n\t\t\t    const struct iio_chan_spec *chan, int *val)\n{\n\tunsigned int regval, gain;\n\tint ret;\n\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL3, &regval);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (chan->channel) {\n\tcase 0:\n\tcase 3:\n\t\tgain = FIELD_GET(SX9310_REG_PROX_CTRL3_GAIN0_MASK, regval);\n\t\tbreak;\n\tcase 1:\n\tcase 2:\n\t\tgain = FIELD_GET(SX9310_REG_PROX_CTRL3_GAIN12_MASK, regval);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t*val = 1 << gain;\n\n\treturn IIO_VAL_INT;\n}\n\nstatic int sx9310_read_samp_freq(struct sx_common_data *data, int *val, int *val2)\n{\n\tunsigned int regval;\n\tint ret;\n\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL0, &regval);\n\tif (ret)\n\t\treturn ret;\n\n\tregval = FIELD_GET(SX9310_REG_PROX_CTRL0_SCANPERIOD_MASK, regval);\n\t*val = sx9310_samp_freq_table[regval].val;\n\t*val2 = sx9310_samp_freq_table[regval].val2;\n\n\treturn IIO_VAL_INT_PLUS_MICRO;\n}\n\nstatic int sx9310_read_raw(struct iio_dev *indio_dev,\n\t\t\t   const struct iio_chan_spec *chan, int *val,\n\t\t\t   int *val2, long mask)\n{\n\tstruct sx_common_data *data = iio_priv(indio_dev);\n\tint ret;\n\n\tif (chan->type != IIO_PROXIMITY)\n\t\treturn -EINVAL;\n\n\tswitch (mask) {\n\tcase IIO_CHAN_INFO_RAW:\n\t\tret = iio_device_claim_direct_mode(indio_dev);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = sx_common_read_proximity(data, chan, val);\n\t\tiio_device_release_direct_mode(indio_dev);\n\t\treturn ret;\n\tcase IIO_CHAN_INFO_HARDWAREGAIN:\n\t\tret = iio_device_claim_direct_mode(indio_dev);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = sx9310_read_gain(data, chan, val);\n\t\tiio_device_release_direct_mode(indio_dev);\n\t\treturn ret;\n\tcase IIO_CHAN_INFO_SAMP_FREQ:\n\t\treturn sx9310_read_samp_freq(data, val, val2);\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic const int sx9310_gain_vals[] = { 1, 2, 4, 8 };\n\nstatic int sx9310_read_avail(struct iio_dev *indio_dev,\n\t\t\t     struct iio_chan_spec const *chan,\n\t\t\t     const int **vals, int *type, int *length,\n\t\t\t     long mask)\n{\n\tif (chan->type != IIO_PROXIMITY)\n\t\treturn -EINVAL;\n\n\tswitch (mask) {\n\tcase IIO_CHAN_INFO_HARDWAREGAIN:\n\t\t*type = IIO_VAL_INT;\n\t\t*length = ARRAY_SIZE(sx9310_gain_vals);\n\t\t*vals = sx9310_gain_vals;\n\t\treturn IIO_AVAIL_LIST;\n\tcase IIO_CHAN_INFO_SAMP_FREQ:\n\t\t*type = IIO_VAL_INT_PLUS_MICRO;\n\t\t*length = ARRAY_SIZE(sx9310_samp_freq_table) * 2;\n\t\t*vals = (int *)sx9310_samp_freq_table;\n\t\treturn IIO_AVAIL_LIST;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic const unsigned int sx9310_pthresh_codes[] = {\n\t2, 4, 6, 8, 12, 16, 20, 24, 28, 32, 40, 48, 56, 64, 72, 80, 88, 96, 112,\n\t128, 144, 160, 192, 224, 256, 320, 384, 512, 640, 768, 1024, 1536\n};\n\nstatic int sx9310_get_thresh_reg(unsigned int channel)\n{\n\tswitch (channel) {\n\tcase 0:\n\tcase 3:\n\t\treturn SX9310_REG_PROX_CTRL8;\n\tcase 1:\n\tcase 2:\n\t\treturn SX9310_REG_PROX_CTRL9;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int sx9310_read_thresh(struct sx_common_data *data,\n\t\t\t      const struct iio_chan_spec *chan, int *val)\n{\n\tunsigned int reg;\n\tunsigned int regval;\n\tint ret;\n\n\treg = ret = sx9310_get_thresh_reg(chan->channel);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tret = regmap_read(data->regmap, reg, &regval);\n\tif (ret)\n\t\treturn ret;\n\n\tregval = FIELD_GET(SX9310_REG_PROX_CTRL8_9_PTHRESH_MASK, regval);\n\tif (regval >= ARRAY_SIZE(sx9310_pthresh_codes))\n\t\treturn -EINVAL;\n\n\t*val = sx9310_pthresh_codes[regval];\n\treturn IIO_VAL_INT;\n}\n\nstatic int sx9310_read_hysteresis(struct sx_common_data *data,\n\t\t\t\t  const struct iio_chan_spec *chan, int *val)\n{\n\tunsigned int regval, pthresh;\n\tint ret;\n\n\tret = sx9310_read_thresh(data, chan, &pthresh);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL10, &regval);\n\tif (ret)\n\t\treturn ret;\n\n\tregval = FIELD_GET(SX9310_REG_PROX_CTRL10_HYST_MASK, regval);\n\tif (!regval)\n\t\tregval = 5;\n\n\t \n\t*val = pthresh >> (5 - regval);\n\n\treturn IIO_VAL_INT;\n}\n\nstatic int sx9310_read_far_debounce(struct sx_common_data *data, int *val)\n{\n\tunsigned int regval;\n\tint ret;\n\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL10, &regval);\n\tif (ret)\n\t\treturn ret;\n\n\tregval = FIELD_GET(SX9310_REG_PROX_CTRL10_FAR_DEBOUNCE_MASK, regval);\n\tif (regval)\n\t\t*val = 1 << regval;\n\telse\n\t\t*val = 0;\n\n\treturn IIO_VAL_INT;\n}\n\nstatic int sx9310_read_close_debounce(struct sx_common_data *data, int *val)\n{\n\tunsigned int regval;\n\tint ret;\n\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL10, &regval);\n\tif (ret)\n\t\treturn ret;\n\n\tregval = FIELD_GET(SX9310_REG_PROX_CTRL10_CLOSE_DEBOUNCE_MASK, regval);\n\tif (regval)\n\t\t*val = 1 << regval;\n\telse\n\t\t*val = 0;\n\n\treturn IIO_VAL_INT;\n}\n\nstatic int sx9310_read_event_val(struct iio_dev *indio_dev,\n\t\t\t\t const struct iio_chan_spec *chan,\n\t\t\t\t enum iio_event_type type,\n\t\t\t\t enum iio_event_direction dir,\n\t\t\t\t enum iio_event_info info, int *val, int *val2)\n{\n\tstruct sx_common_data *data = iio_priv(indio_dev);\n\n\tif (chan->type != IIO_PROXIMITY)\n\t\treturn -EINVAL;\n\n\tswitch (info) {\n\tcase IIO_EV_INFO_VALUE:\n\t\treturn sx9310_read_thresh(data, chan, val);\n\tcase IIO_EV_INFO_PERIOD:\n\t\tswitch (dir) {\n\t\tcase IIO_EV_DIR_RISING:\n\t\t\treturn sx9310_read_far_debounce(data, val);\n\t\tcase IIO_EV_DIR_FALLING:\n\t\t\treturn sx9310_read_close_debounce(data, val);\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\tcase IIO_EV_INFO_HYSTERESIS:\n\t\treturn sx9310_read_hysteresis(data, chan, val);\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int sx9310_write_thresh(struct sx_common_data *data,\n\t\t\t       const struct iio_chan_spec *chan, int val)\n{\n\tunsigned int reg;\n\tunsigned int regval;\n\tint ret, i;\n\n\treg = ret = sx9310_get_thresh_reg(chan->channel);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tfor (i = 0; i < ARRAY_SIZE(sx9310_pthresh_codes); i++) {\n\t\tif (sx9310_pthresh_codes[i] == val) {\n\t\t\tregval = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (i == ARRAY_SIZE(sx9310_pthresh_codes))\n\t\treturn -EINVAL;\n\n\tregval = FIELD_PREP(SX9310_REG_PROX_CTRL8_9_PTHRESH_MASK, regval);\n\tmutex_lock(&data->mutex);\n\tret = regmap_update_bits(data->regmap, reg,\n\t\t\t\t SX9310_REG_PROX_CTRL8_9_PTHRESH_MASK, regval);\n\tmutex_unlock(&data->mutex);\n\n\treturn ret;\n}\n\nstatic int sx9310_write_hysteresis(struct sx_common_data *data,\n\t\t\t\t   const struct iio_chan_spec *chan, int _val)\n{\n\tunsigned int hyst, val = _val;\n\tint ret, pthresh;\n\n\tret = sx9310_read_thresh(data, chan, &pthresh);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (val == 0)\n\t\thyst = 0;\n\telse if (val == pthresh >> 2)\n\t\thyst = 3;\n\telse if (val == pthresh >> 3)\n\t\thyst = 2;\n\telse if (val == pthresh >> 4)\n\t\thyst = 1;\n\telse\n\t\treturn -EINVAL;\n\n\thyst = FIELD_PREP(SX9310_REG_PROX_CTRL10_HYST_MASK, hyst);\n\tmutex_lock(&data->mutex);\n\tret = regmap_update_bits(data->regmap, SX9310_REG_PROX_CTRL10,\n\t\t\t\t SX9310_REG_PROX_CTRL10_HYST_MASK, hyst);\n\tmutex_unlock(&data->mutex);\n\n\treturn ret;\n}\n\nstatic int sx9310_write_far_debounce(struct sx_common_data *data, int val)\n{\n\tint ret;\n\tunsigned int regval;\n\n\tif (val > 0)\n\t\tval = ilog2(val);\n\tif (!FIELD_FIT(SX9310_REG_PROX_CTRL10_FAR_DEBOUNCE_MASK, val))\n\t\treturn -EINVAL;\n\n\tregval = FIELD_PREP(SX9310_REG_PROX_CTRL10_FAR_DEBOUNCE_MASK, val);\n\n\tmutex_lock(&data->mutex);\n\tret = regmap_update_bits(data->regmap, SX9310_REG_PROX_CTRL10,\n\t\t\t\t SX9310_REG_PROX_CTRL10_FAR_DEBOUNCE_MASK,\n\t\t\t\t regval);\n\tmutex_unlock(&data->mutex);\n\n\treturn ret;\n}\n\nstatic int sx9310_write_close_debounce(struct sx_common_data *data, int val)\n{\n\tint ret;\n\tunsigned int regval;\n\n\tif (val > 0)\n\t\tval = ilog2(val);\n\tif (!FIELD_FIT(SX9310_REG_PROX_CTRL10_CLOSE_DEBOUNCE_MASK, val))\n\t\treturn -EINVAL;\n\n\tregval = FIELD_PREP(SX9310_REG_PROX_CTRL10_CLOSE_DEBOUNCE_MASK, val);\n\n\tmutex_lock(&data->mutex);\n\tret = regmap_update_bits(data->regmap, SX9310_REG_PROX_CTRL10,\n\t\t\t\t SX9310_REG_PROX_CTRL10_CLOSE_DEBOUNCE_MASK,\n\t\t\t\t regval);\n\tmutex_unlock(&data->mutex);\n\n\treturn ret;\n}\n\nstatic int sx9310_write_event_val(struct iio_dev *indio_dev,\n\t\t\t\t  const struct iio_chan_spec *chan,\n\t\t\t\t  enum iio_event_type type,\n\t\t\t\t  enum iio_event_direction dir,\n\t\t\t\t  enum iio_event_info info, int val, int val2)\n{\n\tstruct sx_common_data *data = iio_priv(indio_dev);\n\n\tif (chan->type != IIO_PROXIMITY)\n\t\treturn -EINVAL;\n\n\tswitch (info) {\n\tcase IIO_EV_INFO_VALUE:\n\t\treturn sx9310_write_thresh(data, chan, val);\n\tcase IIO_EV_INFO_PERIOD:\n\t\tswitch (dir) {\n\t\tcase IIO_EV_DIR_RISING:\n\t\t\treturn sx9310_write_far_debounce(data, val);\n\t\tcase IIO_EV_DIR_FALLING:\n\t\t\treturn sx9310_write_close_debounce(data, val);\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\tcase IIO_EV_INFO_HYSTERESIS:\n\t\treturn sx9310_write_hysteresis(data, chan, val);\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic int sx9310_set_samp_freq(struct sx_common_data *data, int val, int val2)\n{\n\tint i, ret;\n\n\tfor (i = 0; i < ARRAY_SIZE(sx9310_samp_freq_table); i++)\n\t\tif (val == sx9310_samp_freq_table[i].val &&\n\t\t    val2 == sx9310_samp_freq_table[i].val2)\n\t\t\tbreak;\n\n\tif (i == ARRAY_SIZE(sx9310_samp_freq_table))\n\t\treturn -EINVAL;\n\n\tmutex_lock(&data->mutex);\n\n\tret = regmap_update_bits(\n\t\tdata->regmap, SX9310_REG_PROX_CTRL0,\n\t\tSX9310_REG_PROX_CTRL0_SCANPERIOD_MASK,\n\t\tFIELD_PREP(SX9310_REG_PROX_CTRL0_SCANPERIOD_MASK, i));\n\n\tmutex_unlock(&data->mutex);\n\n\treturn ret;\n}\n\nstatic int sx9310_write_gain(struct sx_common_data *data,\n\t\t\t     const struct iio_chan_spec *chan, int val)\n{\n\tunsigned int gain, mask;\n\tint ret;\n\n\tgain = ilog2(val);\n\n\tswitch (chan->channel) {\n\tcase 0:\n\tcase 3:\n\t\tmask = SX9310_REG_PROX_CTRL3_GAIN0_MASK;\n\t\tgain = FIELD_PREP(SX9310_REG_PROX_CTRL3_GAIN0_MASK, gain);\n\t\tbreak;\n\tcase 1:\n\tcase 2:\n\t\tmask = SX9310_REG_PROX_CTRL3_GAIN12_MASK;\n\t\tgain = FIELD_PREP(SX9310_REG_PROX_CTRL3_GAIN12_MASK, gain);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tmutex_lock(&data->mutex);\n\tret = regmap_update_bits(data->regmap, SX9310_REG_PROX_CTRL3, mask,\n\t\t\t\t gain);\n\tmutex_unlock(&data->mutex);\n\n\treturn ret;\n}\n\nstatic int sx9310_write_raw(struct iio_dev *indio_dev,\n\t\t\t    const struct iio_chan_spec *chan, int val, int val2,\n\t\t\t    long mask)\n{\n\tstruct sx_common_data *data = iio_priv(indio_dev);\n\n\tif (chan->type != IIO_PROXIMITY)\n\t\treturn -EINVAL;\n\n\tswitch (mask) {\n\tcase IIO_CHAN_INFO_SAMP_FREQ:\n\t\treturn sx9310_set_samp_freq(data, val, val2);\n\tcase IIO_CHAN_INFO_HARDWAREGAIN:\n\t\treturn sx9310_write_gain(data, chan, val);\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic const struct sx_common_reg_default sx9310_default_regs[] = {\n\t{ SX9310_REG_IRQ_MSK, 0x00 },\n\t{ SX9310_REG_IRQ_FUNC, 0x00 },\n\t \n\t{ SX9310_REG_PROX_CTRL0, SX9310_REG_PROX_CTRL0_SCANPERIOD_15MS },\n\t{ SX9310_REG_PROX_CTRL1, 0x00 },\n\t{ SX9310_REG_PROX_CTRL2, SX9310_REG_PROX_CTRL2_COMBMODE_CS1_CS2 |\n\t\t\t\t SX9310_REG_PROX_CTRL2_SHIELDEN_DYNAMIC },\n\t{ SX9310_REG_PROX_CTRL3, SX9310_REG_PROX_CTRL3_GAIN0_X8 |\n\t\t\t\t SX9310_REG_PROX_CTRL3_GAIN12_X4 },\n\t{ SX9310_REG_PROX_CTRL4, SX9310_REG_PROX_CTRL4_RESOLUTION_FINEST },\n\t{ SX9310_REG_PROX_CTRL5, SX9310_REG_PROX_CTRL5_RANGE_SMALL |\n\t\t\t\t SX9310_REG_PROX_CTRL5_STARTUPSENS_CS1 |\n\t\t\t\t SX9310_REG_PROX_CTRL5_RAWFILT_1P25 },\n\t{ SX9310_REG_PROX_CTRL6, SX9310_REG_PROX_CTRL6_AVGTHRESH_DEFAULT },\n\t{ SX9310_REG_PROX_CTRL7, SX9310_REG_PROX_CTRL7_AVGNEGFILT_2 |\n\t\t\t\t SX9310_REG_PROX_CTRL7_AVGPOSFILT_512 },\n\t{ SX9310_REG_PROX_CTRL8, SX9310_REG_PROX_CTRL8_9_PTHRESH_96 |\n\t\t\t\t SX9310_REG_PROX_CTRL8_9_BODYTHRESH_1500 },\n\t{ SX9310_REG_PROX_CTRL9, SX9310_REG_PROX_CTRL8_9_PTHRESH_28 |\n\t\t\t\t SX9310_REG_PROX_CTRL8_9_BODYTHRESH_900 },\n\t{ SX9310_REG_PROX_CTRL10, SX9310_REG_PROX_CTRL10_HYST_6PCT |\n\t\t\t\t  SX9310_REG_PROX_CTRL10_FAR_DEBOUNCE_2 },\n\t{ SX9310_REG_PROX_CTRL11, 0x00 },\n\t{ SX9310_REG_PROX_CTRL12, 0x00 },\n\t{ SX9310_REG_PROX_CTRL13, 0x00 },\n\t{ SX9310_REG_PROX_CTRL14, 0x00 },\n\t{ SX9310_REG_PROX_CTRL15, 0x00 },\n\t{ SX9310_REG_PROX_CTRL16, 0x00 },\n\t{ SX9310_REG_PROX_CTRL17, 0x00 },\n\t{ SX9310_REG_PROX_CTRL18, 0x00 },\n\t{ SX9310_REG_PROX_CTRL19, 0x00 },\n\t{ SX9310_REG_SAR_CTRL0, SX9310_REG_SAR_CTRL0_SARDEB_4_SAMPLES |\n\t\t\t\tSX9310_REG_SAR_CTRL0_SARHYST_8 },\n\t{ SX9310_REG_SAR_CTRL1, SX9310_REG_SAR_CTRL1_SLOPE(10781250) },\n\t{ SX9310_REG_SAR_CTRL2, SX9310_REG_SAR_CTRL2_SAROFFSET_DEFAULT },\n};\n\n \nstatic int sx9310_init_compensation(struct iio_dev *indio_dev)\n{\n\tstruct sx_common_data *data = iio_priv(indio_dev);\n\tint ret;\n\tunsigned int val;\n\tunsigned int ctrl0;\n\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL0, &ctrl0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = regmap_write(data->regmap, SX9310_REG_PROX_CTRL0,\n\t\t\t   ctrl0 | SX9310_REG_PROX_CTRL0_SENSOREN_MASK);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_read_poll_timeout(data->regmap, SX9310_REG_STAT1, val,\n\t\t\t\t       !(val & SX9310_REG_STAT1_COMPSTAT_MASK),\n\t\t\t\t       20000, 2000000);\n\tif (ret)\n\t\treturn ret;\n\n\tregmap_write(data->regmap, SX9310_REG_PROX_CTRL0, ctrl0);\n\treturn ret;\n}\n\nstatic const struct sx_common_reg_default *\nsx9310_get_default_reg(struct device *dev, int idx,\n\t\t       struct sx_common_reg_default *reg_def)\n{\n\tu32 combined[SX9310_NUM_CHANNELS];\n\tu32 start = 0, raw = 0, pos = 0;\n\tunsigned long comb_mask = 0;\n\tint ret, i, count;\n\tconst char *res;\n\n\tmemcpy(reg_def, &sx9310_default_regs[idx], sizeof(*reg_def));\n\tswitch (reg_def->reg) {\n\tcase SX9310_REG_PROX_CTRL2:\n\t\tif (device_property_read_bool(dev, \"semtech,cs0-ground\")) {\n\t\t\treg_def->def &= ~SX9310_REG_PROX_CTRL2_SHIELDEN_MASK;\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL2_SHIELDEN_GROUND;\n\t\t}\n\n\t\tcount = device_property_count_u32(dev, \"semtech,combined-sensors\");\n\t\tif (count < 0 || count > ARRAY_SIZE(combined))\n\t\t\tbreak;\n\t\tret = device_property_read_u32_array(dev, \"semtech,combined-sensors\",\n\t\t\t\tcombined, count);\n\t\tif (ret)\n\t\t\tbreak;\n\n\t\tfor (i = 0; i < count; i++)\n\t\t\tcomb_mask |= BIT(combined[i]);\n\n\t\treg_def->def &= ~SX9310_REG_PROX_CTRL2_COMBMODE_MASK;\n\t\tif (comb_mask == (BIT(3) | BIT(2) | BIT(1) | BIT(0)))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL2_COMBMODE_CS0_CS1_CS2_CS3;\n\t\telse if (comb_mask == (BIT(1) | BIT(2)))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL2_COMBMODE_CS1_CS2;\n\t\telse if (comb_mask == (BIT(0) | BIT(1)))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL2_COMBMODE_CS0_CS1;\n\t\telse if (comb_mask == BIT(3))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL2_COMBMODE_CS3;\n\n\t\tbreak;\n\tcase SX9310_REG_PROX_CTRL4:\n\t\tret = device_property_read_string(dev, \"semtech,resolution\", &res);\n\t\tif (ret)\n\t\t\tbreak;\n\n\t\treg_def->def &= ~SX9310_REG_PROX_CTRL4_RESOLUTION_MASK;\n\t\tif (!strcmp(res, \"coarsest\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_COARSEST;\n\t\telse if (!strcmp(res, \"very-coarse\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_VERY_COARSE;\n\t\telse if (!strcmp(res, \"coarse\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_COARSE;\n\t\telse if (!strcmp(res, \"medium-coarse\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_MEDIUM_COARSE;\n\t\telse if (!strcmp(res, \"medium\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_MEDIUM;\n\t\telse if (!strcmp(res, \"fine\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_FINE;\n\t\telse if (!strcmp(res, \"very-fine\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_VERY_FINE;\n\t\telse if (!strcmp(res, \"finest\"))\n\t\t\treg_def->def |= SX9310_REG_PROX_CTRL4_RESOLUTION_FINEST;\n\n\t\tbreak;\n\tcase SX9310_REG_PROX_CTRL5:\n\t\tret = device_property_read_u32(dev, \"semtech,startup-sensor\", &start);\n\t\tif (ret) {\n\t\t\tstart = FIELD_GET(SX9310_REG_PROX_CTRL5_STARTUPSENS_MASK,\n\t\t\t\t\t  reg_def->def);\n\t\t}\n\n\t\treg_def->def &= ~SX9310_REG_PROX_CTRL5_STARTUPSENS_MASK;\n\t\treg_def->def |= FIELD_PREP(SX9310_REG_PROX_CTRL5_STARTUPSENS_MASK,\n\t\t\t\t\t   start);\n\n\t\tret = device_property_read_u32(dev, \"semtech,proxraw-strength\", &raw);\n\t\tif (ret) {\n\t\t\traw = FIELD_GET(SX9310_REG_PROX_CTRL5_RAWFILT_MASK,\n\t\t\t\t\treg_def->def);\n\t\t} else {\n\t\t\traw = ilog2(raw);\n\t\t}\n\n\t\treg_def->def &= ~SX9310_REG_PROX_CTRL5_RAWFILT_MASK;\n\t\treg_def->def |= FIELD_PREP(SX9310_REG_PROX_CTRL5_RAWFILT_MASK,\n\t\t\t\t\t   raw);\n\t\tbreak;\n\tcase SX9310_REG_PROX_CTRL7:\n\t\tret = device_property_read_u32(dev, \"semtech,avg-pos-strength\", &pos);\n\t\tif (ret)\n\t\t\tbreak;\n\n\t\t \n\t\tpos = clamp(ilog2(pos), 3, 11) - (pos >= 32 ? 4 : 3);\n\t\treg_def->def &= ~SX9310_REG_PROX_CTRL7_AVGPOSFILT_MASK;\n\t\treg_def->def |= FIELD_PREP(SX9310_REG_PROX_CTRL7_AVGPOSFILT_MASK,\n\t\t\t\t\t   pos);\n\t\tbreak;\n\t}\n\n\treturn reg_def;\n}\n\nstatic int sx9310_check_whoami(struct device *dev,\n\t\t\t       struct iio_dev *indio_dev)\n{\n\tstruct sx_common_data *data = iio_priv(indio_dev);\n\tunsigned int long ddata;\n\tunsigned int whoami;\n\tint ret;\n\n\tret = regmap_read(data->regmap, SX9310_REG_WHOAMI, &whoami);\n\tif (ret)\n\t\treturn ret;\n\n\tddata = (uintptr_t)device_get_match_data(dev);\n\tif (ddata != whoami)\n\t\treturn -EINVAL;\n\n\tswitch (whoami) {\n\tcase SX9310_WHOAMI_VALUE:\n\t\tindio_dev->name = \"sx9310\";\n\t\tbreak;\n\tcase SX9311_WHOAMI_VALUE:\n\t\tindio_dev->name = \"sx9311\";\n\t\tbreak;\n\tdefault:\n\t\treturn -ENODEV;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct sx_common_chip_info sx9310_chip_info = {\n\t.reg_stat = SX9310_REG_STAT0,\n\t.reg_irq_msk = SX9310_REG_IRQ_MSK,\n\t.reg_enable_chan = SX9310_REG_PROX_CTRL0,\n\t.reg_reset = SX9310_REG_RESET,\n\n\t.mask_enable_chan = SX9310_REG_STAT1_COMPSTAT_MASK,\n\t.irq_msk_offset = 3,\n\t.num_channels = SX9310_NUM_CHANNELS,\n\t.num_default_regs = ARRAY_SIZE(sx9310_default_regs),\n\n\t.ops = {\n\t\t.read_prox_data = sx9310_read_prox_data,\n\t\t.check_whoami = sx9310_check_whoami,\n\t\t.init_compensation = sx9310_init_compensation,\n\t\t.wait_for_sample = sx9310_wait_for_sample,\n\t\t.get_default_reg = sx9310_get_default_reg,\n\t},\n\n\t.iio_channels = sx9310_channels,\n\t.num_iio_channels = ARRAY_SIZE(sx9310_channels),\n\t.iio_info =  {\n\t\t.read_raw = sx9310_read_raw,\n\t\t.read_avail = sx9310_read_avail,\n\t\t.read_event_value = sx9310_read_event_val,\n\t\t.write_event_value = sx9310_write_event_val,\n\t\t.write_raw = sx9310_write_raw,\n\t\t.read_event_config = sx_common_read_event_config,\n\t\t.write_event_config = sx_common_write_event_config,\n\t},\n};\n\nstatic int sx9310_probe(struct i2c_client *client)\n{\n\treturn sx_common_probe(client, &sx9310_chip_info, &sx9310_regmap_config);\n}\n\nstatic int sx9310_suspend(struct device *dev)\n{\n\tstruct sx_common_data *data = iio_priv(dev_get_drvdata(dev));\n\tu8 ctrl0;\n\tint ret;\n\n\tdisable_irq_nosync(data->client->irq);\n\n\tmutex_lock(&data->mutex);\n\tret = regmap_read(data->regmap, SX9310_REG_PROX_CTRL0,\n\t\t\t  &data->suspend_ctrl);\n\tif (ret)\n\t\tgoto out;\n\n\tctrl0 = data->suspend_ctrl & ~SX9310_REG_PROX_CTRL0_SENSOREN_MASK;\n\tret = regmap_write(data->regmap, SX9310_REG_PROX_CTRL0, ctrl0);\n\tif (ret)\n\t\tgoto out;\n\n\tret = regmap_write(data->regmap, SX9310_REG_PAUSE, 0);\n\nout:\n\tmutex_unlock(&data->mutex);\n\treturn ret;\n}\n\nstatic int sx9310_resume(struct device *dev)\n{\n\tstruct sx_common_data *data = iio_priv(dev_get_drvdata(dev));\n\tint ret;\n\n\tmutex_lock(&data->mutex);\n\tret = regmap_write(data->regmap, SX9310_REG_PAUSE, 1);\n\tif (ret)\n\t\tgoto out;\n\n\tret = regmap_write(data->regmap, SX9310_REG_PROX_CTRL0,\n\t\t\t   data->suspend_ctrl);\n\nout:\n\tmutex_unlock(&data->mutex);\n\tif (ret)\n\t\treturn ret;\n\n\tenable_irq(data->client->irq);\n\treturn 0;\n}\n\nstatic DEFINE_SIMPLE_DEV_PM_OPS(sx9310_pm_ops, sx9310_suspend, sx9310_resume);\n\nstatic const struct acpi_device_id sx9310_acpi_match[] = {\n\t{ \"STH9310\", SX9310_WHOAMI_VALUE },\n\t{ \"STH9311\", SX9311_WHOAMI_VALUE },\n\t{}\n};\nMODULE_DEVICE_TABLE(acpi, sx9310_acpi_match);\n\nstatic const struct of_device_id sx9310_of_match[] = {\n\t{ .compatible = \"semtech,sx9310\", (void *)SX9310_WHOAMI_VALUE },\n\t{ .compatible = \"semtech,sx9311\", (void *)SX9311_WHOAMI_VALUE },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, sx9310_of_match);\n\nstatic const struct i2c_device_id sx9310_id[] = {\n\t{ \"sx9310\", SX9310_WHOAMI_VALUE },\n\t{ \"sx9311\", SX9311_WHOAMI_VALUE },\n\t{}\n};\nMODULE_DEVICE_TABLE(i2c, sx9310_id);\n\nstatic struct i2c_driver sx9310_driver = {\n\t.driver = {\n\t\t.name\t= \"sx9310\",\n\t\t.acpi_match_table = sx9310_acpi_match,\n\t\t.of_match_table = sx9310_of_match,\n\t\t.pm = pm_sleep_ptr(&sx9310_pm_ops),\n\n\t\t \n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe\t\t= sx9310_probe,\n\t.id_table\t= sx9310_id,\n};\nmodule_i2c_driver(sx9310_driver);\n\nMODULE_AUTHOR(\"Gwendal Grignou <gwendal@chromium.org>\");\nMODULE_AUTHOR(\"Daniel Campello <campello@chromium.org>\");\nMODULE_DESCRIPTION(\"Driver for Semtech SX9310/SX9311 proximity sensor\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_IMPORT_NS(SEMTECH_PROX);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}