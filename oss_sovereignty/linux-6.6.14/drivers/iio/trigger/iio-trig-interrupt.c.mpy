{
  "module_name": "iio-trig-interrupt.c",
  "hash_id": "a36342767c6d05b751c1f3a03cd21226a24cfd40b69493b25fb35050db6105ca",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/trigger/iio-trig-interrupt.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/interrupt.h>\n#include <linux/slab.h>\n\n#include <linux/iio/iio.h>\n#include <linux/iio/trigger.h>\n\n\nstruct iio_interrupt_trigger_info {\n\tunsigned int irq;\n};\n\nstatic irqreturn_t iio_interrupt_trigger_poll(int irq, void *private)\n{\n\tiio_trigger_poll(private);\n\treturn IRQ_HANDLED;\n}\n\nstatic int iio_interrupt_trigger_probe(struct platform_device *pdev)\n{\n\tstruct iio_interrupt_trigger_info *trig_info;\n\tstruct iio_trigger *trig;\n\tunsigned long irqflags;\n\tstruct resource *irq_res;\n\tint irq, ret = 0;\n\n\tirq_res = platform_get_resource(pdev, IORESOURCE_IRQ, 0);\n\n\tif (irq_res == NULL)\n\t\treturn -ENODEV;\n\n\tirqflags = (irq_res->flags & IRQF_TRIGGER_MASK) | IRQF_SHARED;\n\n\tirq = irq_res->start;\n\n\ttrig = iio_trigger_alloc(NULL, \"irqtrig%d\", irq);\n\tif (!trig) {\n\t\tret = -ENOMEM;\n\t\tgoto error_ret;\n\t}\n\n\ttrig_info = kzalloc(sizeof(*trig_info), GFP_KERNEL);\n\tif (!trig_info) {\n\t\tret = -ENOMEM;\n\t\tgoto error_free_trigger;\n\t}\n\tiio_trigger_set_drvdata(trig, trig_info);\n\ttrig_info->irq = irq;\n\tret = request_irq(irq, iio_interrupt_trigger_poll,\n\t\t\t  irqflags, trig->name, trig);\n\tif (ret) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"request IRQ-%d failed\", irq);\n\t\tgoto error_free_trig_info;\n\t}\n\n\tret = iio_trigger_register(trig);\n\tif (ret)\n\t\tgoto error_release_irq;\n\tplatform_set_drvdata(pdev, trig);\n\n\treturn 0;\n\n \nerror_release_irq:\n\tfree_irq(irq, trig);\nerror_free_trig_info:\n\tkfree(trig_info);\nerror_free_trigger:\n\tiio_trigger_free(trig);\nerror_ret:\n\treturn ret;\n}\n\nstatic int iio_interrupt_trigger_remove(struct platform_device *pdev)\n{\n\tstruct iio_trigger *trig;\n\tstruct iio_interrupt_trigger_info *trig_info;\n\n\ttrig = platform_get_drvdata(pdev);\n\ttrig_info = iio_trigger_get_drvdata(trig);\n\tiio_trigger_unregister(trig);\n\tfree_irq(trig_info->irq, trig);\n\tkfree(trig_info);\n\tiio_trigger_free(trig);\n\n\treturn 0;\n}\n\nstatic struct platform_driver iio_interrupt_trigger_driver = {\n\t.probe = iio_interrupt_trigger_probe,\n\t.remove = iio_interrupt_trigger_remove,\n\t.driver = {\n\t\t.name = \"iio_interrupt_trigger\",\n\t},\n};\n\nmodule_platform_driver(iio_interrupt_trigger_driver);\n\nMODULE_AUTHOR(\"Jonathan Cameron <jic23@kernel.org>\");\nMODULE_DESCRIPTION(\"Interrupt trigger for the iio subsystem\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}