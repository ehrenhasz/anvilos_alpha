{
  "module_name": "ssp.h",
  "hash_id": "d39d1146e6faa96cafbcd83c6ad1d39520287774001e4eefd776fab9dbd04e63",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/common/ssp_sensors/ssp.h",
  "human_readable_source": " \n \n\n#ifndef __SSP_SENSORHUB_H__\n#define __SSP_SENSORHUB_H__\n\n#include <linux/delay.h>\n#include <linux/gpio/consumer.h>\n#include <linux/iio/common/ssp_sensors.h>\n#include <linux/iio/iio.h>\n#include <linux/spi/spi.h>\n\n#define SSP_DEVICE_ID\t\t0x55\n\n#ifdef SSP_DBG\n#define ssp_dbg(format, ...) pr_info(\"[SSP] \"format, ##__VA_ARGS__)\n#else\n#define ssp_dbg(format, ...)\n#endif\n\n#define SSP_SW_RESET_TIME\t\t3000\n \n#define SSP_DEFAULT_POLLING_DELAY\t200\n#define SSP_DEFAULT_RETRIES\t\t3\n#define SSP_DATA_PACKET_SIZE\t\t960\n#define SSP_HEADER_BUFFER_SIZE\t\t4\n\nenum {\n\tSSP_KERNEL_BINARY = 0,\n\tSSP_KERNEL_CRASHED_BINARY,\n};\n\nenum {\n\tSSP_INITIALIZATION_STATE = 0,\n\tSSP_NO_SENSOR_STATE,\n\tSSP_ADD_SENSOR_STATE,\n\tSSP_RUNNING_SENSOR_STATE,\n};\n\n \nenum {\n\tSSP_FW_DL_STATE_FAIL = -1,\n\tSSP_FW_DL_STATE_NONE = 0,\n\tSSP_FW_DL_STATE_NEED_TO_SCHEDULE,\n\tSSP_FW_DL_STATE_SCHEDULED,\n\tSSP_FW_DL_STATE_DOWNLOADING,\n\tSSP_FW_DL_STATE_SYNC,\n\tSSP_FW_DL_STATE_DONE,\n};\n\n#define SSP_INVALID_REVISION\t\t\t99999\n#define SSP_INVALID_REVISION2\t\t\t0xffffff\n\n \n#define SSP_MSG2SSP_INST_BYPASS_SENSOR_ADD\t0xa1\n#define SSP_MSG2SSP_INST_BYPASS_SENSOR_RM\t0xa2\n#define SSP_MSG2SSP_INST_REMOVE_ALL\t\t0xa3\n#define SSP_MSG2SSP_INST_CHANGE_DELAY\t\t0xa4\n#define SSP_MSG2SSP_INST_LIBRARY_ADD\t\t0xb1\n#define SSP_MSG2SSP_INST_LIBRARY_REMOVE\t\t0xb2\n#define SSP_MSG2SSP_INST_LIB_NOTI\t\t0xb4\n#define SSP_MSG2SSP_INST_LIB_DATA\t\t0xc1\n\n#define SSP_MSG2SSP_AP_MCU_SET_GYRO_CAL\t\t0xcd\n#define SSP_MSG2SSP_AP_MCU_SET_ACCEL_CAL\t0xce\n#define SSP_MSG2SSP_AP_STATUS_SHUTDOWN\t\t0xd0\n#define SSP_MSG2SSP_AP_STATUS_WAKEUP\t\t0xd1\n#define SSP_MSG2SSP_AP_STATUS_SLEEP\t\t0xd2\n#define SSP_MSG2SSP_AP_STATUS_RESUME\t\t0xd3\n#define SSP_MSG2SSP_AP_STATUS_SUSPEND\t\t0xd4\n#define SSP_MSG2SSP_AP_STATUS_RESET\t\t0xd5\n#define SSP_MSG2SSP_AP_STATUS_POW_CONNECTED\t0xd6\n#define SSP_MSG2SSP_AP_STATUS_POW_DISCONNECTED\t0xd7\n#define SSP_MSG2SSP_AP_TEMPHUMIDITY_CAL_DONE\t0xda\n#define SSP_MSG2SSP_AP_MCU_SET_DUMPMODE\t\t0xdb\n#define SSP_MSG2SSP_AP_MCU_DUMP_CHECK\t\t0xdc\n#define SSP_MSG2SSP_AP_MCU_BATCH_FLUSH\t\t0xdd\n#define SSP_MSG2SSP_AP_MCU_BATCH_COUNT\t\t0xdf\n\n#define SSP_MSG2SSP_AP_WHOAMI\t\t\t\t0x0f\n#define SSP_MSG2SSP_AP_FIRMWARE_REV\t\t\t0xf0\n#define SSP_MSG2SSP_AP_SENSOR_FORMATION\t\t\t0xf1\n#define SSP_MSG2SSP_AP_SENSOR_PROXTHRESHOLD\t\t0xf2\n#define SSP_MSG2SSP_AP_SENSOR_BARCODE_EMUL\t\t0xf3\n#define SSP_MSG2SSP_AP_SENSOR_SCANNING\t\t\t0xf4\n#define SSP_MSG2SSP_AP_SET_MAGNETIC_HWOFFSET\t\t0xf5\n#define SSP_MSG2SSP_AP_GET_MAGNETIC_HWOFFSET\t\t0xf6\n#define SSP_MSG2SSP_AP_SENSOR_GESTURE_CURRENT\t\t0xf7\n#define SSP_MSG2SSP_AP_GET_THERM\t\t\t0xf8\n#define SSP_MSG2SSP_AP_GET_BIG_DATA\t\t\t0xf9\n#define SSP_MSG2SSP_AP_SET_BIG_DATA\t\t\t0xfa\n#define SSP_MSG2SSP_AP_START_BIG_DATA\t\t\t0xfb\n#define SSP_MSG2SSP_AP_SET_MAGNETIC_STATIC_MATRIX\t0xfd\n#define SSP_MSG2SSP_AP_SENSOR_TILT\t\t\t0xea\n#define SSP_MSG2SSP_AP_MCU_SET_TIME\t\t\t0xfe\n#define SSP_MSG2SSP_AP_MCU_GET_TIME\t\t\t0xff\n\n#define SSP_MSG2SSP_AP_FUSEROM\t\t\t\t0x01\n\n \n#define SSP_TYPE_WAKE_UP_VOICE_SERVICE\t\t\t0x01\n#define SSP_TYPE_WAKE_UP_VOICE_SOUND_SOURCE_AM\t\t0x01\n#define SSP_TYPE_WAKE_UP_VOICE_SOUND_SOURCE_GRAMMER\t0x02\n\n \n#define SSP_ACCELEROMETER_FACTORY\t\t\t0x80\n#define SSP_GYROSCOPE_FACTORY\t\t\t\t0x81\n#define SSP_GEOMAGNETIC_FACTORY\t\t\t\t0x82\n#define SSP_PRESSURE_FACTORY\t\t\t\t0x85\n#define SSP_GESTURE_FACTORY\t\t\t\t0x86\n#define SSP_TEMPHUMIDITY_CRC_FACTORY\t\t\t0x88\n#define SSP_GYROSCOPE_TEMP_FACTORY\t\t\t0x8a\n#define SSP_GYROSCOPE_DPS_FACTORY\t\t\t0x8b\n#define SSP_MCU_FACTORY\t\t\t\t\t0x8c\n#define SSP_MCU_SLEEP_FACTORY\t\t\t\t0x8d\n\n \n#define SSP_MSG_ACK\t\t0x80\t \n#define SSP_MSG_NAK\t\t0x70\t \n\nstruct ssp_sensorhub_info {\n\tchar *fw_name;\n\tchar *fw_crashed_name;\n\tunsigned int fw_rev;\n\tconst u8 * const mag_table;\n\tconst unsigned int mag_length;\n};\n\n \n#define SSP_RW\t\t0\n#define SSP_INDEX\t3\n\n#define SSP_AP2HUB_READ\t\t0\n#define SSP_AP2HUB_WRITE\t1\n#define SSP_HUB2AP_WRITE\t2\n#define SSP_AP2HUB_READY\t3\n#define SSP_AP2HUB_RETURN\t4\n\n \nstruct ssp_data {\n\tstruct spi_device *spi;\n\tconst struct ssp_sensorhub_info *sensorhub_info;\n\tstruct timer_list wdt_timer;\n\tstruct work_struct work_wdt;\n\tstruct delayed_work work_refresh;\n\n\tbool shut_down;\n\tbool mcu_dump_mode;\n\tbool time_syncing;\n\tint64_t timestamp;\n\n\tint check_status[SSP_SENSOR_MAX];\n\n\tunsigned int com_fail_cnt;\n\tunsigned int reset_cnt;\n\tunsigned int timeout_cnt;\n\n\tunsigned int available_sensors;\n\tunsigned int cur_firm_rev;\n\n\tchar last_resume_state;\n\tchar last_ap_state;\n\n\tunsigned int sensor_enable;\n\tu32 delay_buf[SSP_SENSOR_MAX];\n\ts32 batch_latency_buf[SSP_SENSOR_MAX];\n\ts8 batch_opt_buf[SSP_SENSOR_MAX];\n\n\tint accel_position;\n\tint mag_position;\n\tint fw_dl_state;\n\n\tstruct mutex comm_lock;\n\tstruct mutex pending_lock;\n\n\tstruct gpio_desc *mcu_reset_gpiod;\n\tstruct gpio_desc *ap_mcu_gpiod;\n\tstruct gpio_desc *mcu_ap_gpiod;\n\n\tstruct list_head pending_list;\n\n\tstruct iio_dev *sensor_devs[SSP_SENSOR_MAX];\n\tatomic_t enable_refcount;\n\n\t__le16 header_buffer[SSP_HEADER_BUFFER_SIZE / sizeof(__le16)] __aligned(IIO_DMA_MINALIGN);\n};\n\nvoid ssp_clean_pending_list(struct ssp_data *data);\n\nint ssp_command(struct ssp_data *data, char command, int arg);\n\nint ssp_send_instruction(struct ssp_data *data, u8 inst, u8 sensor_type,\n\t\t\t u8 *send_buf, u8 length);\n\nint ssp_irq_msg(struct ssp_data *data);\n\nint ssp_get_chipid(struct ssp_data *data);\n\nint ssp_set_magnetic_matrix(struct ssp_data *data);\n\nunsigned int ssp_get_sensor_scanning_info(struct ssp_data *data);\n\nunsigned int ssp_get_firmware_rev(struct ssp_data *data);\n\nint ssp_queue_ssp_refresh_task(struct ssp_data *data, unsigned int delay);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}