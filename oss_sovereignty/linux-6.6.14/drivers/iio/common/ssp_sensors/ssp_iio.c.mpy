{
  "module_name": "ssp_iio.c",
  "hash_id": "611a5235d495d9f2738e828ab4708884923d2f8f41a43614ad86fab5dc60f34f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/common/ssp_sensors/ssp_iio.c",
  "human_readable_source": "\n \n\n#include <linux/iio/common/ssp_sensors.h>\n#include <linux/iio/buffer.h>\n#include <linux/iio/kfifo_buf.h>\n#include <linux/module.h>\n#include <linux/slab.h>\n#include \"ssp_iio_sensor.h\"\n\n \nint ssp_common_buffer_postenable(struct iio_dev *indio_dev)\n{\n\tstruct ssp_sensor_data *spd = iio_priv(indio_dev);\n\tstruct ssp_data *data = dev_get_drvdata(indio_dev->dev.parent->parent);\n\n\t \n\tspd->buffer = kmalloc(indio_dev->scan_bytes, GFP_KERNEL | GFP_DMA);\n\tif (!spd->buffer)\n\t\treturn -ENOMEM;\n\n\treturn ssp_enable_sensor(data, spd->type,\n\t\t\t\t ssp_get_sensor_delay(data, spd->type));\n}\nEXPORT_SYMBOL_NS(ssp_common_buffer_postenable, IIO_SSP_SENSORS);\n\n \nint ssp_common_buffer_postdisable(struct iio_dev *indio_dev)\n{\n\tint ret;\n\tstruct ssp_sensor_data *spd = iio_priv(indio_dev);\n\tstruct ssp_data *data = dev_get_drvdata(indio_dev->dev.parent->parent);\n\n\tret = ssp_disable_sensor(data, spd->type);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tkfree(spd->buffer);\n\n\treturn ret;\n}\nEXPORT_SYMBOL_NS(ssp_common_buffer_postdisable, IIO_SSP_SENSORS);\n\n \nint ssp_common_process_data(struct iio_dev *indio_dev, void *buf,\n\t\t\t    unsigned int len, int64_t timestamp)\n{\n\t__le32 time;\n\tint64_t calculated_time = 0;\n\tstruct ssp_sensor_data *spd = iio_priv(indio_dev);\n\n\tif (indio_dev->scan_bytes == 0)\n\t\treturn 0;\n\n\t \n\tmemcpy(spd->buffer, buf, len);\n\n\tif (indio_dev->scan_timestamp) {\n\t\tmemcpy(&time, &((char *)buf)[len], SSP_TIME_SIZE);\n\t\tcalculated_time =\n\t\t\ttimestamp + (int64_t)le32_to_cpu(time) * 1000000;\n\t}\n\n\treturn iio_push_to_buffers_with_timestamp(indio_dev, spd->buffer,\n\t\t\t\t\t\t  calculated_time);\n}\nEXPORT_SYMBOL_NS(ssp_common_process_data, IIO_SSP_SENSORS);\n\nMODULE_AUTHOR(\"Karol Wrona <k.wrona@samsung.com>\");\nMODULE_DESCRIPTION(\"Samsung sensorhub commons\");\nMODULE_LICENSE(\"GPL\");\nMODULE_IMPORT_NS(IIO_SSP_SENSORS);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}