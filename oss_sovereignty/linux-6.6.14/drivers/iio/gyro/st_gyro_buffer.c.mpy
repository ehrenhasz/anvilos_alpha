{
  "module_name": "st_gyro_buffer.c",
  "hash_id": "22207ce7be0ef3fbae34af59cbb3efbf683bf789b8959bc1f0fc61119c35b184",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/gyro/st_gyro_buffer.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/iio/iio.h>\n#include <linux/iio/buffer.h>\n#include <linux/iio/trigger.h>\n#include <linux/iio/triggered_buffer.h>\n\n#include <linux/iio/common/st_sensors.h>\n#include \"st_gyro.h\"\n\nint st_gyro_trig_set_state(struct iio_trigger *trig, bool state)\n{\n\tstruct iio_dev *indio_dev = iio_trigger_get_drvdata(trig);\n\n\treturn st_sensors_set_dataready_irq(indio_dev, state);\n}\n\nstatic int st_gyro_buffer_postenable(struct iio_dev *indio_dev)\n{\n\tint err;\n\n\terr = st_sensors_set_axis_enable(indio_dev, indio_dev->active_scan_mask[0]);\n\tif (err < 0)\n\t\treturn err;\n\n\terr = st_sensors_set_enable(indio_dev, true);\n\tif (err < 0)\n\t\tgoto st_gyro_buffer_enable_all_axis;\n\n\treturn 0;\n\nst_gyro_buffer_enable_all_axis:\n\tst_sensors_set_axis_enable(indio_dev, ST_SENSORS_ENABLE_ALL_AXIS);\n\treturn err;\n}\n\nstatic int st_gyro_buffer_predisable(struct iio_dev *indio_dev)\n{\n\tint err;\n\n\terr = st_sensors_set_enable(indio_dev, false);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn st_sensors_set_axis_enable(indio_dev, ST_SENSORS_ENABLE_ALL_AXIS);\n}\n\nstatic const struct iio_buffer_setup_ops st_gyro_buffer_setup_ops = {\n\t.postenable = &st_gyro_buffer_postenable,\n\t.predisable = &st_gyro_buffer_predisable,\n};\n\nint st_gyro_allocate_ring(struct iio_dev *indio_dev)\n{\n\treturn devm_iio_triggered_buffer_setup(indio_dev->dev.parent, indio_dev,\n\t\tNULL, &st_sensors_trigger_handler, &st_gyro_buffer_setup_ops);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}