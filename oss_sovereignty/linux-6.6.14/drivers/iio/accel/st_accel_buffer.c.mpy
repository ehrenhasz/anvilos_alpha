{
  "module_name": "st_accel_buffer.c",
  "hash_id": "5cf1f8f2661c507cf5cda1db1808059245eb2ee9cb04d53cf0085588c5d65e0d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/accel/st_accel_buffer.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/iio/iio.h>\n#include <linux/iio/buffer.h>\n#include <linux/iio/trigger.h>\n#include <linux/iio/triggered_buffer.h>\n\n#include <linux/iio/common/st_sensors.h>\n#include \"st_accel.h\"\n\nint st_accel_trig_set_state(struct iio_trigger *trig, bool state)\n{\n\tstruct iio_dev *indio_dev = iio_trigger_get_drvdata(trig);\n\n\treturn st_sensors_set_dataready_irq(indio_dev, state);\n}\n\nstatic int st_accel_buffer_postenable(struct iio_dev *indio_dev)\n{\n\tint err;\n\n\terr = st_sensors_set_axis_enable(indio_dev, indio_dev->active_scan_mask[0]);\n\tif (err < 0)\n\t\treturn err;\n\n\terr = st_sensors_set_enable(indio_dev, true);\n\tif (err < 0)\n\t\tgoto st_accel_buffer_enable_all_axis;\n\n\treturn 0;\n\nst_accel_buffer_enable_all_axis:\n\tst_sensors_set_axis_enable(indio_dev, ST_SENSORS_ENABLE_ALL_AXIS);\n\treturn err;\n}\n\nstatic int st_accel_buffer_predisable(struct iio_dev *indio_dev)\n{\n\tint err;\n\n\terr = st_sensors_set_enable(indio_dev, false);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn st_sensors_set_axis_enable(indio_dev,\n\t\t\t\t\t  ST_SENSORS_ENABLE_ALL_AXIS);\n}\n\nstatic const struct iio_buffer_setup_ops st_accel_buffer_setup_ops = {\n\t.postenable = &st_accel_buffer_postenable,\n\t.predisable = &st_accel_buffer_predisable,\n};\n\nint st_accel_allocate_ring(struct iio_dev *indio_dev)\n{\n\treturn devm_iio_triggered_buffer_setup(indio_dev->dev.parent, indio_dev,\n\t\tNULL, &st_sensors_trigger_handler, &st_accel_buffer_setup_ops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}