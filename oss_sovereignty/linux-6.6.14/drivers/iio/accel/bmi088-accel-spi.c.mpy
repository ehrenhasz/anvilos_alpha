{
  "module_name": "bmi088-accel-spi.c",
  "hash_id": "8b5830fb200675ca8d7c60e19386ef3d22d6e16a633ea005e6ad0c96a4d74dfc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/iio/accel/bmi088-accel-spi.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/spi/spi.h>\n\n#include \"bmi088-accel.h\"\n\nstatic int bmi088_regmap_spi_write(void *context, const void *data, size_t count)\n{\n\tstruct spi_device *spi = context;\n\n\t \n\treturn spi_write(spi, data, count);\n}\n\nstatic int bmi088_regmap_spi_read(void *context, const void *reg,\n\t\t\t\tsize_t reg_size, void *val, size_t val_size)\n{\n\tstruct spi_device *spi = context;\n\tu8 addr[2];\n\n\taddr[0] = *(u8 *)reg;\n\taddr[0] |= BIT(7);  \n\taddr[1] = 0;  \n\n\treturn spi_write_then_read(spi, addr, sizeof(addr), val, val_size);\n}\n\nstatic struct regmap_bus bmi088_regmap_bus = {\n\t.write = bmi088_regmap_spi_write,\n\t.read = bmi088_regmap_spi_read,\n};\n\nstatic int bmi088_accel_probe(struct spi_device *spi)\n{\n\tstruct regmap *regmap;\n\tconst struct spi_device_id *id = spi_get_device_id(spi);\n\n\tregmap = devm_regmap_init(&spi->dev, &bmi088_regmap_bus,\n\t\t\tspi, &bmi088_regmap_conf);\n\n\tif (IS_ERR(regmap)) {\n\t\tdev_err(&spi->dev, \"Failed to initialize spi regmap\\n\");\n\t\treturn PTR_ERR(regmap);\n\t}\n\n\treturn bmi088_accel_core_probe(&spi->dev, regmap, spi->irq,\n\t\t\t\t\tid->driver_data);\n}\n\nstatic void bmi088_accel_remove(struct spi_device *spi)\n{\n\tbmi088_accel_core_remove(&spi->dev);\n}\n\nstatic const struct of_device_id bmi088_of_match[] = {\n\t{ .compatible = \"bosch,bmi085-accel\" },\n\t{ .compatible = \"bosch,bmi088-accel\" },\n\t{ .compatible = \"bosch,bmi090l-accel\" },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, bmi088_of_match);\n\nstatic const struct spi_device_id bmi088_accel_id[] = {\n\t{\"bmi085-accel\",  BOSCH_BMI085},\n\t{\"bmi088-accel\",  BOSCH_BMI088},\n\t{\"bmi090l-accel\", BOSCH_BMI090L},\n\t{}\n};\nMODULE_DEVICE_TABLE(spi, bmi088_accel_id);\n\nstatic struct spi_driver bmi088_accel_driver = {\n\t.driver = {\n\t\t.name\t= \"bmi088_accel_spi\",\n\t\t.pm\t= pm_ptr(&bmi088_accel_pm_ops),\n\t\t.of_match_table = bmi088_of_match,\n\t},\n\t.probe\t\t= bmi088_accel_probe,\n\t.remove\t\t= bmi088_accel_remove,\n\t.id_table\t= bmi088_accel_id,\n};\nmodule_spi_driver(bmi088_accel_driver);\n\nMODULE_AUTHOR(\"Niek van Agt <niek.van.agt@topicproducts.com>\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DESCRIPTION(\"BMI088 accelerometer driver (SPI)\");\nMODULE_IMPORT_NS(IIO_BMI088);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}