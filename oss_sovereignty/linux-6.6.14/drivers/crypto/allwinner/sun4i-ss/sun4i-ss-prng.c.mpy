{
  "module_name": "sun4i-ss-prng.c",
  "hash_id": "99defe410abe90b1f86d9a883a1c083f3b529ace2222850c4ff6cc891afe8d03",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/allwinner/sun4i-ss/sun4i-ss-prng.c",
  "human_readable_source": "\n#include \"sun4i-ss.h\"\n\nint sun4i_ss_prng_seed(struct crypto_rng *tfm, const u8 *seed,\n\t\t       unsigned int slen)\n{\n\tstruct sun4i_ss_alg_template *algt;\n\tstruct rng_alg *alg = crypto_rng_alg(tfm);\n\n\talgt = container_of(alg, struct sun4i_ss_alg_template, alg.rng);\n\tmemcpy(algt->ss->seed, seed, slen);\n\n\treturn 0;\n}\n\nint sun4i_ss_prng_generate(struct crypto_rng *tfm, const u8 *src,\n\t\t\t   unsigned int slen, u8 *dst, unsigned int dlen)\n{\n\tstruct sun4i_ss_alg_template *algt;\n\tstruct rng_alg *alg = crypto_rng_alg(tfm);\n\tint i, err;\n\tu32 v;\n\tu32 *data = (u32 *)dst;\n\tconst u32 mode = SS_OP_PRNG | SS_PRNG_CONTINUE | SS_ENABLED;\n\tsize_t len;\n\tstruct sun4i_ss_ctx *ss;\n\tunsigned int todo = (dlen / 4) * 4;\n\n\talgt = container_of(alg, struct sun4i_ss_alg_template, alg.rng);\n\tss = algt->ss;\n\n\terr = pm_runtime_resume_and_get(ss->dev);\n\tif (err < 0)\n\t\treturn err;\n\n\tif (IS_ENABLED(CONFIG_CRYPTO_DEV_SUN4I_SS_DEBUG)) {\n\t\talgt->stat_req++;\n\t\talgt->stat_bytes += todo;\n\t}\n\n\tspin_lock_bh(&ss->slock);\n\n\twritel(mode, ss->base + SS_CTL);\n\n\twhile (todo > 0) {\n\t\t \n\t\tfor (i = 0; i < SS_SEED_LEN / BITS_PER_LONG; i++)\n\t\t\twritel(ss->seed[i], ss->base + SS_KEY0 + i * 4);\n\n\t\t \n\t\tlen = min_t(size_t, SS_DATA_LEN / BITS_PER_BYTE, todo);\n\t\treadsl(ss->base + SS_TXFIFO, data, len / 4);\n\t\tdata += len / 4;\n\t\ttodo -= len;\n\n\t\t \n\t\tfor (i = 0; i < SS_SEED_LEN / BITS_PER_LONG; i++) {\n\t\t\tv = readl(ss->base + SS_KEY0 + i * 4);\n\t\t\tss->seed[i] = v;\n\t\t}\n\t}\n\n\twritel(0, ss->base + SS_CTL);\n\tspin_unlock_bh(&ss->slock);\n\n\tpm_runtime_put(ss->dev);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}