{
  "module_name": "cc_pm.c",
  "hash_id": "1f15022b2dcf91d8b101083b88af75d9773af0caf2247e52790ae0664176dfe4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/ccree/cc_pm.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/interrupt.h>\n#include <linux/pm_runtime.h>\n#include \"cc_driver.h\"\n#include \"cc_buffer_mgr.h\"\n#include \"cc_request_mgr.h\"\n#include \"cc_sram_mgr.h\"\n#include \"cc_hash.h\"\n#include \"cc_pm.h\"\n#include \"cc_fips.h\"\n\n#define POWER_DOWN_ENABLE 0x01\n#define POWER_DOWN_DISABLE 0x00\n\nstatic int cc_pm_suspend(struct device *dev)\n{\n\tstruct cc_drvdata *drvdata = dev_get_drvdata(dev);\n\n\tdev_dbg(dev, \"set HOST_POWER_DOWN_EN\\n\");\n\tfini_cc_regs(drvdata);\n\tcc_iowrite(drvdata, CC_REG(HOST_POWER_DOWN_EN), POWER_DOWN_ENABLE);\n\tclk_disable_unprepare(drvdata->clk);\n\treturn 0;\n}\n\nstatic int cc_pm_resume(struct device *dev)\n{\n\tint rc;\n\tstruct cc_drvdata *drvdata = dev_get_drvdata(dev);\n\n\tdev_dbg(dev, \"unset HOST_POWER_DOWN_EN\\n\");\n\t \n\trc = clk_prepare_enable(drvdata->clk);\n\tif (rc) {\n\t\tdev_err(dev, \"failed getting clock back on. We're toast.\\n\");\n\t\treturn rc;\n\t}\n\t \n\tif (!cc_wait_for_reset_completion(drvdata)) {\n\t\tdev_err(dev, \"Cryptocell reset not completed\");\n\t\tclk_disable_unprepare(drvdata->clk);\n\t\treturn -EBUSY;\n\t}\n\n\tcc_iowrite(drvdata, CC_REG(HOST_POWER_DOWN_EN), POWER_DOWN_DISABLE);\n\trc = init_cc_regs(drvdata);\n\tif (rc) {\n\t\tdev_err(dev, \"init_cc_regs (%x)\\n\", rc);\n\t\tclk_disable_unprepare(drvdata->clk);\n\t\treturn rc;\n\t}\n\t \n\tcc_tee_handle_fips_error(drvdata);\n\n\tcc_init_hash_sram(drvdata);\n\n\treturn 0;\n}\n\nconst struct dev_pm_ops ccree_pm = {\n\tSET_RUNTIME_PM_OPS(cc_pm_suspend, cc_pm_resume, NULL)\n};\n\nint cc_pm_get(struct device *dev)\n{\n\tint rc = pm_runtime_get_sync(dev);\n\tif (rc < 0) {\n\t\tpm_runtime_put_noidle(dev);\n\t\treturn rc;\n\t}\n\n\treturn 0;\n}\n\nvoid cc_pm_put_suspend(struct device *dev)\n{\n\tpm_runtime_mark_last_busy(dev);\n\tpm_runtime_put_autosuspend(dev);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}