{
  "module_name": "sec.h",
  "hash_id": "0d320b9a38d647ac5dee922d873a7e3a8241ee62ee052af1ec2ff2753bfc7bf9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/hisilicon/sec2/sec.h",
  "human_readable_source": " \n \n\n#ifndef __HISI_SEC_V2_H\n#define __HISI_SEC_V2_H\n\n#include <linux/hisi_acc_qm.h>\n#include \"sec_crypto.h\"\n\n \nstruct sec_alg_res {\n\tu8 *pbuf;\n\tdma_addr_t pbuf_dma;\n\tu8 *c_ivin;\n\tdma_addr_t c_ivin_dma;\n\tu8 *a_ivin;\n\tdma_addr_t a_ivin_dma;\n\tu8 *out_mac;\n\tdma_addr_t out_mac_dma;\n\tu16 depth;\n};\n\n \nstruct sec_cipher_req {\n\tstruct hisi_acc_hw_sgl *c_out;\n\tdma_addr_t c_out_dma;\n\tu8 *c_ivin;\n\tdma_addr_t c_ivin_dma;\n\tstruct skcipher_request *sk_req;\n\tu32 c_len;\n\tbool encrypt;\n};\n\nstruct sec_aead_req {\n\tu8 *out_mac;\n\tdma_addr_t out_mac_dma;\n\tu8 *a_ivin;\n\tdma_addr_t a_ivin_dma;\n\tstruct aead_request *aead_req;\n};\n\n \nstruct sec_req {\n\tunion {\n\t\tstruct sec_sqe sec_sqe;\n\t\tstruct sec_sqe3 sec_sqe3;\n\t};\n\tstruct sec_ctx *ctx;\n\tstruct sec_qp_ctx *qp_ctx;\n\n\t \n\tstruct hisi_acc_hw_sgl *in;\n\tdma_addr_t in_dma;\n\tstruct sec_cipher_req c_req;\n\tstruct sec_aead_req aead_req;\n\tstruct list_head backlog_head;\n\n\tint err_type;\n\tint req_id;\n\tu32 flag;\n\n\t \n\tbool fake_busy;\n\tbool use_pbuf;\n};\n\n \nstruct sec_req_op {\n\tint (*buf_map)(struct sec_ctx *ctx, struct sec_req *req);\n\tvoid (*buf_unmap)(struct sec_ctx *ctx, struct sec_req *req);\n\tvoid (*do_transfer)(struct sec_ctx *ctx, struct sec_req *req);\n\tint (*bd_fill)(struct sec_ctx *ctx, struct sec_req *req);\n\tint (*bd_send)(struct sec_ctx *ctx, struct sec_req *req);\n\tvoid (*callback)(struct sec_ctx *ctx, struct sec_req *req, int err);\n\tint (*process)(struct sec_ctx *ctx, struct sec_req *req);\n};\n\n \nstruct sec_auth_ctx {\n\tdma_addr_t a_key_dma;\n\tu8 *a_key;\n\tu8 a_key_len;\n\tu8 mac_len;\n\tu8 a_alg;\n\tbool fallback;\n\tstruct crypto_shash *hash_tfm;\n\tstruct crypto_aead *fallback_aead_tfm;\n};\n\n \nstruct sec_cipher_ctx {\n\tu8 *c_key;\n\tdma_addr_t c_key_dma;\n\tsector_t iv_offset;\n\tu32 c_gran_size;\n\tu32 ivsize;\n\tu8 c_mode;\n\tu8 c_alg;\n\tu8 c_key_len;\n\n\t \n\tbool fallback;\n\tstruct crypto_sync_skcipher *fbtfm;\n};\n\n \nstruct sec_qp_ctx {\n\tstruct hisi_qp *qp;\n\tstruct sec_req **req_list;\n\tstruct idr req_idr;\n\tstruct sec_alg_res *res;\n\tstruct sec_ctx *ctx;\n\tspinlock_t req_lock;\n\tstruct list_head backlog;\n\tstruct hisi_acc_sgl_pool *c_in_pool;\n\tstruct hisi_acc_sgl_pool *c_out_pool;\n};\n\nenum sec_alg_type {\n\tSEC_SKCIPHER,\n\tSEC_AEAD\n};\n\n \nstruct sec_ctx {\n\tstruct sec_qp_ctx *qp_ctx;\n\tstruct sec_dev *sec;\n\tconst struct sec_req_op *req_op;\n\tstruct hisi_qp **qps;\n\n\t \n\tu32 hlf_q_num;\n\n\t \n\tu32 fake_req_limit;\n\n\t \n\tatomic_t enc_qcyclic;\n\n\t  \n\tatomic_t dec_qcyclic;\n\n\tenum sec_alg_type alg_type;\n\tbool pbuf_supported;\n\tstruct sec_cipher_ctx c_ctx;\n\tstruct sec_auth_ctx a_ctx;\n\tu8 type_supported;\n\tstruct device *dev;\n};\n\n\nenum sec_debug_file_index {\n\tSEC_CLEAR_ENABLE,\n\tSEC_DEBUG_FILE_NUM,\n};\n\nstruct sec_debug_file {\n\tenum sec_debug_file_index index;\n\tspinlock_t lock;\n\tstruct hisi_qm *qm;\n};\n\nstruct sec_dfx {\n\tatomic64_t send_cnt;\n\tatomic64_t recv_cnt;\n\tatomic64_t send_busy_cnt;\n\tatomic64_t recv_busy_cnt;\n\tatomic64_t err_bd_cnt;\n\tatomic64_t invalid_req_cnt;\n\tatomic64_t done_flag_cnt;\n};\n\nstruct sec_debug {\n\tstruct sec_dfx dfx;\n\tstruct sec_debug_file files[SEC_DEBUG_FILE_NUM];\n};\n\nstruct sec_dev {\n\tstruct hisi_qm qm;\n\tstruct sec_debug debug;\n\tu32 ctx_q_num;\n\tbool iommu_used;\n};\n\nenum sec_cap_type {\n\tSEC_QM_NFE_MASK_CAP = 0x0,\n\tSEC_QM_RESET_MASK_CAP,\n\tSEC_QM_OOO_SHUTDOWN_MASK_CAP,\n\tSEC_QM_CE_MASK_CAP,\n\tSEC_NFE_MASK_CAP,\n\tSEC_RESET_MASK_CAP,\n\tSEC_OOO_SHUTDOWN_MASK_CAP,\n\tSEC_CE_MASK_CAP,\n\tSEC_CLUSTER_NUM_CAP,\n\tSEC_CORE_TYPE_NUM_CAP,\n\tSEC_CORE_NUM_CAP,\n\tSEC_CORES_PER_CLUSTER_NUM_CAP,\n\tSEC_CORE_ENABLE_BITMAP,\n\tSEC_DRV_ALG_BITMAP_LOW,\n\tSEC_DRV_ALG_BITMAP_HIGH,\n\tSEC_DEV_ALG_BITMAP_LOW,\n\tSEC_DEV_ALG_BITMAP_HIGH,\n\tSEC_CORE1_ALG_BITMAP_LOW,\n\tSEC_CORE1_ALG_BITMAP_HIGH,\n\tSEC_CORE2_ALG_BITMAP_LOW,\n\tSEC_CORE2_ALG_BITMAP_HIGH,\n\tSEC_CORE3_ALG_BITMAP_LOW,\n\tSEC_CORE3_ALG_BITMAP_HIGH,\n\tSEC_CORE4_ALG_BITMAP_LOW,\n\tSEC_CORE4_ALG_BITMAP_HIGH,\n};\n\nenum sec_cap_reg_record_idx {\n\tSEC_DRV_ALG_BITMAP_LOW_IDX = 0x0,\n\tSEC_DRV_ALG_BITMAP_HIGH_IDX,\n\tSEC_DEV_ALG_BITMAP_LOW_IDX,\n\tSEC_DEV_ALG_BITMAP_HIGH_IDX,\n};\n\nvoid sec_destroy_qps(struct hisi_qp **qps, int qp_num);\nstruct hisi_qp **sec_create_qps(void);\nint sec_register_to_crypto(struct hisi_qm *qm);\nvoid sec_unregister_from_crypto(struct hisi_qm *qm);\nu64 sec_get_alg_bitmap(struct hisi_qm *qm, u32 high, u32 low);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}