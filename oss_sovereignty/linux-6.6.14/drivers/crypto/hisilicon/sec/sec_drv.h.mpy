{
  "module_name": "sec_drv.h",
  "hash_id": "2e61e442ba5e9101ffd5e4d22f19ea34e5df61fdda50849fceced4f70fbedaef",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/hisilicon/sec/sec_drv.h",
  "human_readable_source": " \n \n\n#ifndef _SEC_DRV_H_\n#define _SEC_DRV_H_\n\n#include <crypto/algapi.h>\n#include <linux/kfifo.h>\n\n#define SEC_MAX_SGE_NUM\t\t\t64\n#define SEC_HW_RING_NUM\t\t\t3\n\n#define SEC_CMD_RING\t\t\t0\n#define SEC_OUTORDER_RING\t\t1\n#define SEC_DBG_RING\t\t\t2\n\n \n#define SEC_QUEUE_LEN\t\t\t512\n\n#define SEC_MAX_SGE_NUM   64\n\nstruct sec_bd_info {\n#define SEC_BD_W0_T_LEN_M\t\t\tGENMASK(4, 0)\n#define SEC_BD_W0_T_LEN_S\t\t\t0\n\n#define SEC_BD_W0_C_WIDTH_M\t\t\tGENMASK(6, 5)\n#define SEC_BD_W0_C_WIDTH_S\t\t\t5\n#define   SEC_C_WIDTH_AES_128BIT\t\t0\n#define   SEC_C_WIDTH_AES_8BIT\t\t1\n#define   SEC_C_WIDTH_AES_1BIT\t\t2\n#define   SEC_C_WIDTH_DES_64BIT\t\t0\n#define   SEC_C_WIDTH_DES_8BIT\t\t1\n#define   SEC_C_WIDTH_DES_1BIT\t\t2\n\n#define SEC_BD_W0_C_MODE_M\t\t\tGENMASK(9, 7)\n#define SEC_BD_W0_C_MODE_S\t\t\t7\n#define   SEC_C_MODE_ECB\t\t\t0\n#define   SEC_C_MODE_CBC\t\t\t1\n#define   SEC_C_MODE_CTR\t\t\t4\n#define   SEC_C_MODE_CCM\t\t\t5\n#define   SEC_C_MODE_GCM\t\t\t6\n#define   SEC_C_MODE_XTS\t\t\t7\n\n#define SEC_BD_W0_SEQ\t\t\t\tBIT(10)\n#define SEC_BD_W0_DE\t\t\t\tBIT(11)\n#define SEC_BD_W0_DAT_SKIP_M\t\t\tGENMASK(13, 12)\n#define SEC_BD_W0_DAT_SKIP_S\t\t\t12\n#define SEC_BD_W0_C_GRAN_SIZE_19_16_M\t\tGENMASK(17, 14)\n#define SEC_BD_W0_C_GRAN_SIZE_19_16_S\t\t14\n\n#define SEC_BD_W0_CIPHER_M\t\t\tGENMASK(19, 18)\n#define SEC_BD_W0_CIPHER_S\t\t\t18\n#define   SEC_CIPHER_NULL\t\t\t0\n#define   SEC_CIPHER_ENCRYPT\t\t\t1\n#define   SEC_CIPHER_DECRYPT\t\t\t2\n\n#define SEC_BD_W0_AUTH_M\t\t\tGENMASK(21, 20)\n#define SEC_BD_W0_AUTH_S\t\t\t20\n#define   SEC_AUTH_NULL\t\t\t\t0\n#define   SEC_AUTH_MAC\t\t\t\t1\n#define   SEC_AUTH_VERIF\t\t\t2\n\n#define SEC_BD_W0_AI_GEN\t\t\tBIT(22)\n#define SEC_BD_W0_CI_GEN\t\t\tBIT(23)\n#define SEC_BD_W0_NO_HPAD\t\t\tBIT(24)\n#define SEC_BD_W0_HM_M\t\t\t\tGENMASK(26, 25)\n#define SEC_BD_W0_HM_S\t\t\t\t25\n#define SEC_BD_W0_ICV_OR_SKEY_EN_M\t\tGENMASK(28, 27)\n#define SEC_BD_W0_ICV_OR_SKEY_EN_S\t\t27\n\n \n#define SEC_BD_W0_FLAG_M\t\t\tGENMASK(30, 29)\n#define SEC_BD_W0_C_GRAN_SIZE_21_20_M\t\tGENMASK(30, 29)\n#define SEC_BD_W0_FLAG_S\t\t\t29\n#define SEC_BD_W0_C_GRAN_SIZE_21_20_S\t\t29\n\n#define SEC_BD_W0_DONE\t\t\t\tBIT(31)\n\tu32 w0;\n\n#define SEC_BD_W1_AUTH_GRAN_SIZE_M\t\tGENMASK(21, 0)\n#define SEC_BD_W1_AUTH_GRAN_SIZE_S\t\t0\n#define SEC_BD_W1_M_KEY_EN\t\t\tBIT(22)\n#define SEC_BD_W1_BD_INVALID\t\t\tBIT(23)\n#define SEC_BD_W1_ADDR_TYPE\t\t\tBIT(24)\n\n#define SEC_BD_W1_A_ALG_M\t\t\tGENMASK(28, 25)\n#define SEC_BD_W1_A_ALG_S\t\t\t25\n#define   SEC_A_ALG_SHA1\t\t\t0\n#define   SEC_A_ALG_SHA256\t\t\t1\n#define   SEC_A_ALG_MD5\t\t\t\t2\n#define   SEC_A_ALG_SHA224\t\t\t3\n#define   SEC_A_ALG_HMAC_SHA1\t\t\t8\n#define   SEC_A_ALG_HMAC_SHA224\t\t\t10\n#define   SEC_A_ALG_HMAC_SHA256\t\t\t11\n#define   SEC_A_ALG_HMAC_MD5\t\t\t12\n#define   SEC_A_ALG_AES_XCBC\t\t\t13\n#define   SEC_A_ALG_AES_CMAC\t\t\t14\n\n#define SEC_BD_W1_C_ALG_M\t\t\tGENMASK(31, 29)\n#define SEC_BD_W1_C_ALG_S\t\t\t29\n#define   SEC_C_ALG_DES\t\t\t\t0\n#define   SEC_C_ALG_3DES\t\t\t1\n#define   SEC_C_ALG_AES\t\t\t\t2\n\n\tu32 w1;\n\n#define SEC_BD_W2_C_GRAN_SIZE_15_0_M\t\tGENMASK(15, 0)\n#define SEC_BD_W2_C_GRAN_SIZE_15_0_S\t\t0\n#define SEC_BD_W2_GRAN_NUM_M\t\t\tGENMASK(31, 16)\n#define SEC_BD_W2_GRAN_NUM_S\t\t\t16\n\tu32 w2;\n\n#define SEC_BD_W3_AUTH_LEN_OFFSET_M\t\tGENMASK(9, 0)\n#define SEC_BD_W3_AUTH_LEN_OFFSET_S\t\t0\n#define SEC_BD_W3_CIPHER_LEN_OFFSET_M\t\tGENMASK(19, 10)\n#define SEC_BD_W3_CIPHER_LEN_OFFSET_S\t\t10\n#define SEC_BD_W3_MAC_LEN_M\t\t\tGENMASK(24, 20)\n#define SEC_BD_W3_MAC_LEN_S\t\t\t20\n#define SEC_BD_W3_A_KEY_LEN_M\t\t\tGENMASK(29, 25)\n#define SEC_BD_W3_A_KEY_LEN_S\t\t\t25\n#define SEC_BD_W3_C_KEY_LEN_M\t\t\tGENMASK(31, 30)\n#define SEC_BD_W3_C_KEY_LEN_S\t\t\t30\n#define   SEC_KEY_LEN_AES_128\t\t\t0\n#define   SEC_KEY_LEN_AES_192\t\t\t1\n#define   SEC_KEY_LEN_AES_256\t\t\t2\n#define   SEC_KEY_LEN_DES\t\t\t1\n#define   SEC_KEY_LEN_3DES_3_KEY\t\t1\n#define   SEC_KEY_LEN_3DES_2_KEY\t\t3\n\tu32 w3;\n\n\t \n\tunion {\n\t\tu32 authkey_addr_lo;\n\t\tu32 authiv_addr_lo;\n\t};\n\tunion {\n\t\tu32 authkey_addr_hi;\n\t\tu32 authiv_addr_hi;\n\t};\n\n\t \n\tu32 cipher_key_addr_lo;\n\tu32 cipher_key_addr_hi;\n\n\t \n\tu32 cipher_iv_addr_lo;\n\tu32 cipher_iv_addr_hi;\n\n\t \n\tu32 data_addr_lo;\n\tu32 data_addr_hi;\n\n\t \n\tu32 mac_addr_lo;\n\tu32 mac_addr_hi;\n\n\t \n\tu32 cipher_destin_addr_lo;\n\tu32 cipher_destin_addr_hi;\n};\n\nenum sec_mem_region {\n\tSEC_COMMON = 0,\n\tSEC_SAA,\n\tSEC_NUM_ADDR_REGIONS\n};\n\n#define SEC_NAME_SIZE\t\t\t\t64\n#define SEC_Q_NUM\t\t\t\t16\n\n\n \nstruct sec_queue_ring_cmd {\n\tatomic_t used;\n\tstruct mutex lock;\n\tstruct sec_bd_info *vaddr;\n\tdma_addr_t paddr;\n\tvoid (*callback)(struct sec_bd_info *resp, void *ctx);\n};\n\nstruct sec_debug_bd_info;\nstruct sec_queue_ring_db {\n\tstruct sec_debug_bd_info *vaddr;\n\tdma_addr_t paddr;\n};\n\nstruct sec_out_bd_info;\nstruct sec_queue_ring_cq {\n\tstruct sec_out_bd_info *vaddr;\n\tdma_addr_t paddr;\n};\n\nstruct sec_dev_info;\n\nenum sec_cipher_alg {\n\tSEC_C_DES_ECB_64,\n\tSEC_C_DES_CBC_64,\n\n\tSEC_C_3DES_ECB_192_3KEY,\n\tSEC_C_3DES_ECB_192_2KEY,\n\n\tSEC_C_3DES_CBC_192_3KEY,\n\tSEC_C_3DES_CBC_192_2KEY,\n\n\tSEC_C_AES_ECB_128,\n\tSEC_C_AES_ECB_192,\n\tSEC_C_AES_ECB_256,\n\n\tSEC_C_AES_CBC_128,\n\tSEC_C_AES_CBC_192,\n\tSEC_C_AES_CBC_256,\n\n\tSEC_C_AES_CTR_128,\n\tSEC_C_AES_CTR_192,\n\tSEC_C_AES_CTR_256,\n\n\tSEC_C_AES_XTS_128,\n\tSEC_C_AES_XTS_256,\n\n\tSEC_C_NULL,\n};\n\n \nstruct sec_alg_tfm_ctx {\n\tenum sec_cipher_alg cipher_alg;\n\tu8 *key;\n\tdma_addr_t pkey;\n\tstruct sec_bd_info req_template;\n\tstruct sec_queue *queue;\n\tstruct mutex lock;\n\tu8 *auth_buf;\n\tstruct list_head backlog;\n};\n\n \nstruct sec_request {\n\tstruct list_head elements;\n\tint num_elements;\n\tstruct mutex lock;\n\tstruct sec_alg_tfm_ctx *tfm_ctx;\n\tint len_in;\n\tint len_out;\n\tdma_addr_t dma_iv;\n\tint err;\n\tstruct crypto_async_request *req_base;\n\tvoid (*cb)(struct sec_bd_info *resp, struct crypto_async_request *req);\n\tstruct list_head backlog_head;\n};\n\n \nstruct sec_request_el {\n\tstruct list_head head;\n\tstruct sec_bd_info req;\n\tstruct sec_hw_sgl *in;\n\tdma_addr_t dma_in;\n\tstruct scatterlist *sgl_in;\n\tstruct sec_hw_sgl *out;\n\tdma_addr_t dma_out;\n\tstruct scatterlist *sgl_out;\n\tstruct sec_request *sec_req;\n\tsize_t el_length;\n};\n\n \nstruct sec_queue {\n\tstruct sec_dev_info *dev_info;\n\tint task_irq;\n\tchar name[SEC_NAME_SIZE];\n\tstruct sec_queue_ring_cmd ring_cmd;\n\tstruct sec_queue_ring_cq ring_cq;\n\tstruct sec_queue_ring_db ring_db;\n\tvoid __iomem *regs;\n\tu32 queue_id;\n\tbool in_use;\n\tint expected;\n\n\tDECLARE_BITMAP(unprocessed, SEC_QUEUE_LEN);\n\tDECLARE_KFIFO_PTR(softqueue, typeof(struct sec_request_el *));\n\tbool havesoftqueue;\n\tspinlock_t queuelock;\n\tvoid *shadow[SEC_QUEUE_LEN];\n};\n\n \nstruct sec_hw_sge {\n\tdma_addr_t buf;\n\tunsigned int len;\n\tunsigned int pad;\n};\n\n \nstruct sec_hw_sgl {\n\tdma_addr_t next_sgl;\n\tu16 entry_sum_in_chain;\n\tu16 entry_sum_in_sgl;\n\tu32 flag;\n\tu64 serial_num;\n\tu32 cpuid;\n\tu32 data_bytes_in_sgl;\n\tstruct sec_hw_sgl *next;\n\tu64 reserved;\n\tstruct sec_hw_sge  sge_entries[SEC_MAX_SGE_NUM];\n\tu8 node[16];\n};\n\nstruct dma_pool;\n\n \nstruct sec_dev_info {\n\tint sec_id;\n\tint num_saas;\n\tvoid __iomem *regs[SEC_NUM_ADDR_REGIONS];\n\tstruct mutex dev_lock;\n\tint queues_in_use;\n\tstruct sec_queue queues[SEC_Q_NUM];\n\tstruct device *dev;\n\tstruct dma_pool *hw_sgl_pool;\n};\n\nint sec_queue_send(struct sec_queue *queue, struct sec_bd_info *msg, void *ctx);\nbool sec_queue_can_enqueue(struct sec_queue *queue, int num);\nint sec_queue_stop_release(struct sec_queue *queue);\nstruct sec_queue *sec_queue_alloc_start_safe(void);\nbool sec_queue_empty(struct sec_queue *queue);\n\n \nvoid sec_alg_callback(struct sec_bd_info *resp, void *ctx);\nint sec_algs_register(void);\nvoid sec_algs_unregister(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}