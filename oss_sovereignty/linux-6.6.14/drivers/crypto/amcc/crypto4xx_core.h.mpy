{
  "module_name": "crypto4xx_core.h",
  "hash_id": "dd793cd48f0ff967a5754239ae76cbc311febbd55a454e714c547229016a0237",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/amcc/crypto4xx_core.h",
  "human_readable_source": " \n \n\n#ifndef __CRYPTO4XX_CORE_H__\n#define __CRYPTO4XX_CORE_H__\n\n#include <linux/ratelimit.h>\n#include <linux/mutex.h>\n#include <linux/scatterlist.h>\n#include <crypto/internal/hash.h>\n#include <crypto/internal/aead.h>\n#include <crypto/internal/rng.h>\n#include <crypto/internal/skcipher.h>\n#include \"crypto4xx_reg_def.h\"\n#include \"crypto4xx_sa.h\"\n\n#define PPC460SX_SDR0_SRST                      0x201\n#define PPC405EX_SDR0_SRST                      0x200\n#define PPC460EX_SDR0_SRST                      0x201\n#define PPC460EX_CE_RESET                       0x08000000\n#define PPC460SX_CE_RESET                       0x20000000\n#define PPC405EX_CE_RESET                       0x00000008\n\n#define CRYPTO4XX_CRYPTO_PRIORITY\t\t300\n#define PPC4XX_NUM_PD\t\t\t\t256\n#define PPC4XX_LAST_PD\t\t\t\t(PPC4XX_NUM_PD - 1)\n#define PPC4XX_NUM_GD\t\t\t\t1024\n#define PPC4XX_LAST_GD\t\t\t\t(PPC4XX_NUM_GD - 1)\n#define PPC4XX_NUM_SD\t\t\t\t256\n#define PPC4XX_LAST_SD\t\t\t\t(PPC4XX_NUM_SD - 1)\n#define PPC4XX_SD_BUFFER_SIZE\t\t\t2048\n\n#define PD_ENTRY_BUSY\t\t\t\tBIT(1)\n#define PD_ENTRY_INUSE\t\t\t\tBIT(0)\n#define PD_ENTRY_FREE\t\t\t\t0\n#define ERING_WAS_FULL\t\t\t\t0xffffffff\n\nstruct crypto4xx_device;\n\nunion shadow_sa_buf {\n\tstruct dynamic_sa_ctl sa;\n\n\t \n\tu8 buf[256];\n} __packed;\n\nstruct pd_uinfo {\n\tstruct crypto4xx_device *dev;\n\tu32   state;\n\tu32 first_gd;\t\t \n\tu32 num_gd;              \n\tu32 first_sd;\t\t \n\tu32 num_sd;\t\t \n\tstruct dynamic_sa_ctl *sa_va;\t \n\tstruct sa_state_record *sr_va;\t \n\tu32 sr_pa;\n\tstruct scatterlist *dest_va;\n\tstruct crypto_async_request *async_req; \t \n};\n\nstruct crypto4xx_device {\n\tstruct crypto4xx_core_device *core_dev;\n\tvoid __iomem *ce_base;\n\tvoid __iomem *trng_base;\n\n\tstruct ce_pd *pdr;\t \n\tdma_addr_t pdr_pa;\t \n\tstruct ce_gd *gdr;\t \n\tdma_addr_t gdr_pa;\t \n\tstruct ce_sd *sdr;\t \n\tdma_addr_t sdr_pa;\t \n\tvoid *scatter_buffer_va;\n\tdma_addr_t scatter_buffer_pa;\n\n\tunion shadow_sa_buf *shadow_sa_pool;\n\tdma_addr_t shadow_sa_pool_pa;\n\tstruct sa_state_record *shadow_sr_pool;\n\tdma_addr_t shadow_sr_pool_pa;\n\tu32 pdr_tail;\n\tu32 pdr_head;\n\tu32 gdr_tail;\n\tu32 gdr_head;\n\tu32 sdr_tail;\n\tu32 sdr_head;\n\tstruct pd_uinfo *pdr_uinfo;\n\tstruct list_head alg_list;\t \n\tstruct ratelimit_state aead_ratelimit;\n\tbool is_revb;\n};\n\nstruct crypto4xx_core_device {\n\tstruct device *device;\n\tstruct platform_device *ofdev;\n\tstruct crypto4xx_device *dev;\n\tstruct hwrng *trng;\n\tu32 int_status;\n\tu32 irq;\n\tstruct tasklet_struct tasklet;\n\tspinlock_t lock;\n\tstruct mutex rng_lock;\n};\n\nstruct crypto4xx_ctx {\n\tstruct crypto4xx_device *dev;\n\tstruct dynamic_sa_ctl *sa_in;\n\tstruct dynamic_sa_ctl *sa_out;\n\t__le32 iv_nonce;\n\tu32 sa_len;\n\tunion {\n\t\tstruct crypto_sync_skcipher *cipher;\n\t\tstruct crypto_aead *aead;\n\t} sw_cipher;\n};\n\nstruct crypto4xx_aead_reqctx {\n\tstruct scatterlist dst[2];\n};\n\nstruct crypto4xx_alg_common {\n\tu32 type;\n\tunion {\n\t\tstruct skcipher_alg cipher;\n\t\tstruct ahash_alg hash;\n\t\tstruct aead_alg aead;\n\t\tstruct rng_alg rng;\n\t} u;\n};\n\nstruct crypto4xx_alg {\n\tstruct list_head  entry;\n\tstruct crypto4xx_alg_common alg;\n\tstruct crypto4xx_device *dev;\n};\n\nint crypto4xx_alloc_sa(struct crypto4xx_ctx *ctx, u32 size);\nvoid crypto4xx_free_sa(struct crypto4xx_ctx *ctx);\nvoid crypto4xx_free_ctx(struct crypto4xx_ctx *ctx);\nint crypto4xx_build_pd(struct crypto_async_request *req,\n\t\t       struct crypto4xx_ctx *ctx,\n\t\t       struct scatterlist *src,\n\t\t       struct scatterlist *dst,\n\t\t       const unsigned int datalen,\n\t\t       const __le32 *iv, const u32 iv_len,\n\t\t       const struct dynamic_sa_ctl *sa,\n\t\t       const unsigned int sa_len,\n\t\t       const unsigned int assoclen,\n\t\t       struct scatterlist *dst_tmp);\nint crypto4xx_setkey_aes_cbc(struct crypto_skcipher *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_setkey_aes_cfb(struct crypto_skcipher *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_setkey_aes_ctr(struct crypto_skcipher *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_setkey_aes_ecb(struct crypto_skcipher *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_setkey_aes_ofb(struct crypto_skcipher *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_setkey_rfc3686(struct crypto_skcipher *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_encrypt_ctr(struct skcipher_request *req);\nint crypto4xx_decrypt_ctr(struct skcipher_request *req);\nint crypto4xx_encrypt_iv_stream(struct skcipher_request *req);\nint crypto4xx_decrypt_iv_stream(struct skcipher_request *req);\nint crypto4xx_encrypt_iv_block(struct skcipher_request *req);\nint crypto4xx_decrypt_iv_block(struct skcipher_request *req);\nint crypto4xx_encrypt_noiv_block(struct skcipher_request *req);\nint crypto4xx_decrypt_noiv_block(struct skcipher_request *req);\nint crypto4xx_rfc3686_encrypt(struct skcipher_request *req);\nint crypto4xx_rfc3686_decrypt(struct skcipher_request *req);\nint crypto4xx_sha1_alg_init(struct crypto_tfm *tfm);\nint crypto4xx_hash_digest(struct ahash_request *req);\nint crypto4xx_hash_final(struct ahash_request *req);\nint crypto4xx_hash_update(struct ahash_request *req);\nint crypto4xx_hash_init(struct ahash_request *req);\n\n \nstatic inline void crypto4xx_memcpy_swab32(u32 *dst, const void *buf,\n\t\t\t\t\t   size_t len)\n{\n\tfor (; len >= 4; buf += 4, len -= 4)\n\t\t*dst++ = __swab32p((u32 *) buf);\n\n\tif (len) {\n\t\tconst u8 *tmp = (u8 *)buf;\n\n\t\tswitch (len) {\n\t\tcase 3:\n\t\t\t*dst = (tmp[2] << 16) |\n\t\t\t       (tmp[1] << 8) |\n\t\t\t       tmp[0];\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t*dst = (tmp[1] << 8) |\n\t\t\t       tmp[0];\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\t*dst = tmp[0];\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic inline void crypto4xx_memcpy_from_le32(u32 *dst, const void *buf,\n\t\t\t\t\t      size_t len)\n{\n\tcrypto4xx_memcpy_swab32(dst, buf, len);\n}\n\nstatic inline void crypto4xx_memcpy_to_le32(__le32 *dst, const void *buf,\n\t\t\t\t\t    size_t len)\n{\n\tcrypto4xx_memcpy_swab32((u32 *)dst, buf, len);\n}\n\nint crypto4xx_setauthsize_aead(struct crypto_aead *ciper,\n\t\t\t       unsigned int authsize);\nint crypto4xx_setkey_aes_ccm(struct crypto_aead *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_encrypt_aes_ccm(struct aead_request *req);\nint crypto4xx_decrypt_aes_ccm(struct aead_request *req);\nint crypto4xx_setkey_aes_gcm(struct crypto_aead *cipher,\n\t\t\t     const u8 *key, unsigned int keylen);\nint crypto4xx_encrypt_aes_gcm(struct aead_request *req);\nint crypto4xx_decrypt_aes_gcm(struct aead_request *req);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}