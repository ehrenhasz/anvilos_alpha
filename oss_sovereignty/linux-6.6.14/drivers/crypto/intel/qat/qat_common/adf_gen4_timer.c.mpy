{
  "module_name": "adf_gen4_timer.c",
  "hash_id": "0357e6c7acc157453fb66a133d99c4b763c5a684a2d630083e97d90a97ff004c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/intel/qat/qat_common/adf_gen4_timer.c",
  "human_readable_source": "\n \n\n#include <linux/container_of.h>\n#include <linux/dev_printk.h>\n#include <linux/export.h>\n#include <linux/jiffies.h>\n#include <linux/ktime.h>\n#include <linux/slab.h>\n#include <linux/workqueue.h>\n\n#include \"adf_accel_devices.h\"\n#include \"adf_common_drv.h\"\n#include \"adf_gen4_timer.h\"\n\n#define ADF_GEN4_TIMER_PERIOD_MS 200\n\n \nstatic void work_handler(struct work_struct *work)\n{\n\tstruct adf_accel_dev *accel_dev;\n\tstruct adf_timer *timer_ctx;\n\tu32 time_periods;\n\n\ttimer_ctx = container_of(to_delayed_work(work), struct adf_timer, work_ctx);\n\taccel_dev = timer_ctx->accel_dev;\n\n\tadf_misc_wq_queue_delayed_work(&timer_ctx->work_ctx,\n\t\t\t\t       msecs_to_jiffies(ADF_GEN4_TIMER_PERIOD_MS));\n\n\ttime_periods = div_u64(ktime_ms_delta(ktime_get_real(), timer_ctx->initial_ktime),\n\t\t\t       ADF_GEN4_TIMER_PERIOD_MS);\n\n\tif (adf_send_admin_tim_sync(accel_dev, time_periods))\n\t\tdev_err(&GET_DEV(accel_dev), \"Failed to synchronize qat timer\\n\");\n}\n\nint adf_gen4_timer_start(struct adf_accel_dev *accel_dev)\n{\n\tstruct adf_timer *timer_ctx;\n\n\ttimer_ctx = kzalloc(sizeof(*timer_ctx), GFP_KERNEL);\n\tif (!timer_ctx)\n\t\treturn -ENOMEM;\n\n\ttimer_ctx->accel_dev = accel_dev;\n\taccel_dev->timer = timer_ctx;\n\ttimer_ctx->initial_ktime = ktime_get_real();\n\n\tINIT_DELAYED_WORK(&timer_ctx->work_ctx, work_handler);\n\tadf_misc_wq_queue_delayed_work(&timer_ctx->work_ctx,\n\t\t\t\t       msecs_to_jiffies(ADF_GEN4_TIMER_PERIOD_MS));\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(adf_gen4_timer_start);\n\nvoid adf_gen4_timer_stop(struct adf_accel_dev *accel_dev)\n{\n\tstruct adf_timer *timer_ctx = accel_dev->timer;\n\n\tif (!timer_ctx)\n\t\treturn;\n\n\tcancel_delayed_work_sync(&timer_ctx->work_ctx);\n\n\tkfree(timer_ctx);\n\taccel_dev->timer = NULL;\n}\nEXPORT_SYMBOL_GPL(adf_gen4_timer_stop);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}