{
  "module_name": "qat_algs_send.c",
  "hash_id": "dab5c0e52cdcee0bdeb46139b967251e436eb20181af1307329313ea64f281d8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/intel/qat/qat_common/qat_algs_send.c",
  "human_readable_source": "\n \n#include <crypto/algapi.h>\n#include \"adf_transport.h\"\n#include \"qat_algs_send.h\"\n#include \"qat_crypto.h\"\n\n#define ADF_MAX_RETRIES\t\t20\n\nstatic int qat_alg_send_message_retry(struct qat_alg_req *req)\n{\n\tint ret = 0, ctr = 0;\n\n\tdo {\n\t\tret = adf_send_message(req->tx_ring, req->fw_req);\n\t} while (ret == -EAGAIN && ctr++ < ADF_MAX_RETRIES);\n\n\tif (ret == -EAGAIN)\n\t\treturn -ENOSPC;\n\n\treturn -EINPROGRESS;\n}\n\nvoid qat_alg_send_backlog(struct qat_instance_backlog *backlog)\n{\n\tstruct qat_alg_req *req, *tmp;\n\n\tspin_lock_bh(&backlog->lock);\n\tlist_for_each_entry_safe(req, tmp, &backlog->list, list) {\n\t\tif (adf_send_message(req->tx_ring, req->fw_req)) {\n\t\t\t \n\t\t\tbreak;\n\t\t}\n\t\tlist_del(&req->list);\n\t\tcrypto_request_complete(req->base, -EINPROGRESS);\n\t}\n\tspin_unlock_bh(&backlog->lock);\n}\n\nstatic bool qat_alg_try_enqueue(struct qat_alg_req *req)\n{\n\tstruct qat_instance_backlog *backlog = req->backlog;\n\tstruct adf_etr_ring_data *tx_ring = req->tx_ring;\n\tu32 *fw_req = req->fw_req;\n\n\t \n\tif (!list_empty(&backlog->list))\n\t\treturn false;\n\n\t \n\tif (adf_ring_nearly_full(tx_ring))\n\t\treturn false;\n\n\t \n\tif (adf_send_message(tx_ring, fw_req))\n\t\treturn false;\n\n\treturn true;\n}\n\n\nstatic int qat_alg_send_message_maybacklog(struct qat_alg_req *req)\n{\n\tstruct qat_instance_backlog *backlog = req->backlog;\n\tint ret = -EINPROGRESS;\n\n\tif (qat_alg_try_enqueue(req))\n\t\treturn ret;\n\n\tspin_lock_bh(&backlog->lock);\n\tif (!qat_alg_try_enqueue(req)) {\n\t\tlist_add_tail(&req->list, &backlog->list);\n\t\tret = -EBUSY;\n\t}\n\tspin_unlock_bh(&backlog->lock);\n\n\treturn ret;\n}\n\nint qat_alg_send_message(struct qat_alg_req *req)\n{\n\tu32 flags = req->base->flags;\n\n\tif (flags & CRYPTO_TFM_REQ_MAY_BACKLOG)\n\t\treturn qat_alg_send_message_maybacklog(req);\n\telse\n\t\treturn qat_alg_send_message_retry(req);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}