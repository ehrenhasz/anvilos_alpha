{
  "module_name": "adf_gen2_config.c",
  "hash_id": "0296499908842303b32a846978a08de342b83a4a4256641d3c1bec75098f73b4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/intel/qat/qat_common/adf_gen2_config.c",
  "human_readable_source": "\n \n#include \"adf_accel_devices.h\"\n#include \"adf_cfg.h\"\n#include \"adf_cfg_strings.h\"\n#include \"adf_gen2_config.h\"\n#include \"adf_common_drv.h\"\n#include \"qat_crypto.h\"\n#include \"qat_compression.h\"\n#include \"adf_heartbeat.h\"\n#include \"adf_transport_access_macros.h\"\n\nstatic int adf_gen2_crypto_dev_config(struct adf_accel_dev *accel_dev)\n{\n\tchar key[ADF_CFG_MAX_KEY_LEN_IN_BYTES];\n\tint banks = GET_MAX_BANKS(accel_dev);\n\tint cpus = num_online_cpus();\n\tunsigned long val;\n\tint instances;\n\tint ret;\n\tint i;\n\n\tif (adf_hw_dev_has_crypto(accel_dev))\n\t\tinstances = min(cpus, banks);\n\telse\n\t\tinstances = 0;\n\n\tfor (i = 0; i < instances; i++) {\n\t\tval = i;\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_ASYM_BANK_NUM, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_SYM_BANK_NUM, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_ETRMGR_CORE_AFFINITY,\n\t\t\t i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_ASYM_SIZE, i);\n\t\tval = 128;\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 512;\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_SYM_SIZE, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 0;\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_ASYM_TX, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 2;\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_SYM_TX, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 8;\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_ASYM_RX, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 10;\n\t\tsnprintf(key, sizeof(key), ADF_CY \"%d\" ADF_RING_SYM_RX, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = ADF_COALESCING_DEF_TIME;\n\t\tsnprintf(key, sizeof(key), ADF_ETRMGR_COALESCE_TIMER_FORMAT, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, \"Accelerator0\",\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\t}\n\n\tval = i;\n\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC, ADF_NUM_CY,\n\t\t\t\t\t  &val, ADF_DEC);\n\tif (ret)\n\t\tgoto err;\n\n\treturn ret;\n\nerr:\n\tdev_err(&GET_DEV(accel_dev), \"Failed to add configuration for crypto\\n\");\n\treturn ret;\n}\n\nstatic int adf_gen2_comp_dev_config(struct adf_accel_dev *accel_dev)\n{\n\tchar key[ADF_CFG_MAX_KEY_LEN_IN_BYTES];\n\tint banks = GET_MAX_BANKS(accel_dev);\n\tint cpus = num_online_cpus();\n\tunsigned long val;\n\tint instances;\n\tint ret;\n\tint i;\n\n\tif (adf_hw_dev_has_compression(accel_dev))\n\t\tinstances = min(cpus, banks);\n\telse\n\t\tinstances = 0;\n\n\tfor (i = 0; i < instances; i++) {\n\t\tval = i;\n\t\tsnprintf(key, sizeof(key), ADF_DC \"%d\" ADF_RING_DC_BANK_NUM, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 512;\n\t\tsnprintf(key, sizeof(key), ADF_DC \"%d\" ADF_RING_DC_SIZE, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 6;\n\t\tsnprintf(key, sizeof(key), ADF_DC \"%d\" ADF_RING_DC_TX, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\n\t\tval = 14;\n\t\tsnprintf(key, sizeof(key), ADF_DC \"%d\" ADF_RING_DC_RX, i);\n\t\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC,\n\t\t\t\t\t\t  key, &val, ADF_DEC);\n\t\tif (ret)\n\t\t\tgoto err;\n\t}\n\n\tval = i;\n\tret = adf_cfg_add_key_value_param(accel_dev, ADF_KERNEL_SEC, ADF_NUM_DC,\n\t\t\t\t\t  &val, ADF_DEC);\n\tif (ret)\n\t\treturn ret;\n\n\treturn ret;\n\nerr:\n\tdev_err(&GET_DEV(accel_dev), \"Failed to add configuration for compression\\n\");\n\treturn ret;\n}\n\n \nint adf_gen2_dev_config(struct adf_accel_dev *accel_dev)\n{\n\tint ret;\n\n\tret = adf_cfg_section_add(accel_dev, ADF_KERNEL_SEC);\n\tif (ret)\n\t\tgoto err;\n\n\tret = adf_cfg_section_add(accel_dev, \"Accelerator0\");\n\tif (ret)\n\t\tgoto err;\n\n\tret = adf_gen2_crypto_dev_config(accel_dev);\n\tif (ret)\n\t\tgoto err;\n\n\tret = adf_gen2_comp_dev_config(accel_dev);\n\tif (ret)\n\t\tgoto err;\n\n\tret = adf_cfg_section_add(accel_dev, ADF_GENERAL_SEC);\n\tif (ret)\n\t\tgoto err;\n\n\tadf_heartbeat_save_cfg_param(accel_dev, ADF_CFG_HB_TIMER_DEFAULT_MS);\n\n\tset_bit(ADF_STATUS_CONFIGURED, &accel_dev->status);\n\n\treturn ret;\n\nerr:\n\tdev_err(&GET_DEV(accel_dev), \"Failed to configure QAT driver\\n\");\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(adf_gen2_dev_config);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}