{
  "module_name": "adf_c3xxx_hw_data.c",
  "hash_id": "0c4b0646e09da571162ad2a4600b700bd1b70b09022739fb93d1422ab62489c0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/intel/qat/qat_c3xxx/adf_c3xxx_hw_data.c",
  "human_readable_source": "\n \n#include <adf_accel_devices.h>\n#include <adf_clock.h>\n#include <adf_common_drv.h>\n#include <adf_gen2_config.h>\n#include <adf_gen2_dc.h>\n#include <adf_gen2_hw_data.h>\n#include <adf_gen2_pfvf.h>\n#include \"adf_c3xxx_hw_data.h\"\n#include \"adf_heartbeat.h\"\n#include \"icp_qat_hw.h\"\n\n \nstatic const u32 thrd_to_arb_map[ADF_C3XXX_MAX_ACCELENGINES] = {\n\t0x12222AAA, 0x11222AAA, 0x12222AAA,\n\t0x11222AAA, 0x12222AAA, 0x11222AAA\n};\n\nstatic struct adf_hw_device_class c3xxx_class = {\n\t.name = ADF_C3XXX_DEVICE_NAME,\n\t.type = DEV_C3XXX,\n\t.instances = 0\n};\n\nstatic u32 get_accel_mask(struct adf_hw_device_data *self)\n{\n\tu32 straps = self->straps;\n\tu32 fuses = self->fuses;\n\tu32 accel;\n\n\taccel = ~(fuses | straps) >> ADF_C3XXX_ACCELERATORS_REG_OFFSET;\n\taccel &= ADF_C3XXX_ACCELERATORS_MASK;\n\n\treturn accel;\n}\n\nstatic u32 get_ae_mask(struct adf_hw_device_data *self)\n{\n\tu32 straps = self->straps;\n\tu32 fuses = self->fuses;\n\tunsigned long disabled;\n\tu32 ae_disable;\n\tint accel;\n\n\t \n\tdisabled = ~get_accel_mask(self) & ADF_C3XXX_ACCELERATORS_MASK;\n\tae_disable = BIT(1) | BIT(0);\n\tfor_each_set_bit(accel, &disabled, ADF_C3XXX_MAX_ACCELERATORS)\n\t\tstraps |= ae_disable << (accel << 1);\n\n\treturn ~(fuses | straps) & ADF_C3XXX_ACCELENGINES_MASK;\n}\n\nstatic u32 get_ts_clock(struct adf_hw_device_data *self)\n{\n\t \n\treturn self->clock_frequency / 16;\n}\n\nstatic int measure_clock(struct adf_accel_dev *accel_dev)\n{\n\tu32 frequency;\n\tint ret;\n\n\tret = adf_dev_measure_clock(accel_dev, &frequency, ADF_C3XXX_MIN_AE_FREQ,\n\t\t\t\t    ADF_C3XXX_MAX_AE_FREQ);\n\tif (ret)\n\t\treturn ret;\n\n\taccel_dev->hw_device->clock_frequency = frequency;\n\treturn 0;\n}\n\nstatic u32 get_misc_bar_id(struct adf_hw_device_data *self)\n{\n\treturn ADF_C3XXX_PMISC_BAR;\n}\n\nstatic u32 get_etr_bar_id(struct adf_hw_device_data *self)\n{\n\treturn ADF_C3XXX_ETR_BAR;\n}\n\nstatic u32 get_sram_bar_id(struct adf_hw_device_data *self)\n{\n\treturn ADF_C3XXX_SRAM_BAR;\n}\n\nstatic enum dev_sku_info get_sku(struct adf_hw_device_data *self)\n{\n\tint aes = self->get_num_aes(self);\n\n\tif (aes == 6)\n\t\treturn DEV_SKU_4;\n\n\treturn DEV_SKU_UNKNOWN;\n}\n\nstatic const u32 *adf_get_arbiter_mapping(struct adf_accel_dev *accel_dev)\n{\n\treturn thrd_to_arb_map;\n}\n\nstatic void configure_iov_threads(struct adf_accel_dev *accel_dev, bool enable)\n{\n\tadf_gen2_cfg_iov_thds(accel_dev, enable,\n\t\t\t      ADF_C3XXX_AE2FUNC_MAP_GRP_A_NUM_REGS,\n\t\t\t      ADF_C3XXX_AE2FUNC_MAP_GRP_B_NUM_REGS);\n}\n\nvoid adf_init_hw_data_c3xxx(struct adf_hw_device_data *hw_data)\n{\n\thw_data->dev_class = &c3xxx_class;\n\thw_data->instance_id = c3xxx_class.instances++;\n\thw_data->num_banks = ADF_C3XXX_ETR_MAX_BANKS;\n\thw_data->num_rings_per_bank = ADF_ETR_MAX_RINGS_PER_BANK;\n\thw_data->num_accel = ADF_C3XXX_MAX_ACCELERATORS;\n\thw_data->num_logical_accel = 1;\n\thw_data->num_engines = ADF_C3XXX_MAX_ACCELENGINES;\n\thw_data->tx_rx_gap = ADF_GEN2_RX_RINGS_OFFSET;\n\thw_data->tx_rings_mask = ADF_GEN2_TX_RINGS_MASK;\n\thw_data->ring_to_svc_map = ADF_GEN2_DEFAULT_RING_TO_SRV_MAP;\n\thw_data->alloc_irq = adf_isr_resource_alloc;\n\thw_data->free_irq = adf_isr_resource_free;\n\thw_data->enable_error_correction = adf_gen2_enable_error_correction;\n\thw_data->get_accel_mask = get_accel_mask;\n\thw_data->get_ae_mask = get_ae_mask;\n\thw_data->get_accel_cap = adf_gen2_get_accel_cap;\n\thw_data->get_num_accels = adf_gen2_get_num_accels;\n\thw_data->get_num_aes = adf_gen2_get_num_aes;\n\thw_data->get_sram_bar_id = get_sram_bar_id;\n\thw_data->get_etr_bar_id = get_etr_bar_id;\n\thw_data->get_misc_bar_id = get_misc_bar_id;\n\thw_data->get_admin_info = adf_gen2_get_admin_info;\n\thw_data->get_arb_info = adf_gen2_get_arb_info;\n\thw_data->get_sku = get_sku;\n\thw_data->fw_name = ADF_C3XXX_FW;\n\thw_data->fw_mmp_name = ADF_C3XXX_MMP;\n\thw_data->init_admin_comms = adf_init_admin_comms;\n\thw_data->exit_admin_comms = adf_exit_admin_comms;\n\thw_data->configure_iov_threads = configure_iov_threads;\n\thw_data->send_admin_init = adf_send_admin_init;\n\thw_data->init_arb = adf_init_arb;\n\thw_data->exit_arb = adf_exit_arb;\n\thw_data->get_arb_mapping = adf_get_arbiter_mapping;\n\thw_data->enable_ints = adf_gen2_enable_ints;\n\thw_data->reset_device = adf_reset_flr;\n\thw_data->set_ssm_wdtimer = adf_gen2_set_ssm_wdtimer;\n\thw_data->disable_iov = adf_disable_sriov;\n\thw_data->dev_config = adf_gen2_dev_config;\n\thw_data->measure_clock = measure_clock;\n\thw_data->get_hb_clock = get_ts_clock;\n\thw_data->num_hb_ctrs = ADF_NUM_HB_CNT_PER_AE;\n\thw_data->check_hb_ctrs = adf_heartbeat_check_ctrs;\n\n\tadf_gen2_init_pf_pfvf_ops(&hw_data->pfvf_ops);\n\tadf_gen2_init_hw_csr_ops(&hw_data->csr_ops);\n\tadf_gen2_init_dc_ops(&hw_data->dc_ops);\n}\n\nvoid adf_clean_hw_data_c3xxx(struct adf_hw_device_data *hw_data)\n{\n\thw_data->dev_class->instances--;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}