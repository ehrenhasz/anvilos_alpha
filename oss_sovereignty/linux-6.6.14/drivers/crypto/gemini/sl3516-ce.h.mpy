{
  "module_name": "sl3516-ce.h",
  "hash_id": "a32629553c4bff2251671b9bf30e3ab90b4662e66b099a8340aaec39e8ba93f5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/gemini/sl3516-ce.h",
  "human_readable_source": " \n \n#include <crypto/aes.h>\n#include <crypto/engine.h>\n#include <crypto/scatterwalk.h>\n#include <crypto/skcipher.h>\n#include <linux/debugfs.h>\n#include <linux/hw_random.h>\n\n#define TQ0_TYPE_DATA 0\n#define TQ0_TYPE_CTRL BIT(0)\n#define TQ1_CIPHER BIT(1)\n#define TQ2_AUTH BIT(2)\n#define TQ3_IV BIT(3)\n#define TQ4_KEY0 BIT(4)\n#define TQ5_KEY4 BIT(5)\n#define TQ6_KEY6 BIT(6)\n#define TQ7_AKEY0 BIT(7)\n#define TQ8_AKEY2 BIT(8)\n#define TQ9_AKEY2 BIT(9)\n\n#define ECB_AES       0x2\n\n#define DESC_LAST 0x01\n#define DESC_FIRST 0x02\n\n#define IPSEC_ID\t\t0x0000\n#define IPSEC_STATUS_REG\t0x00a8\n#define IPSEC_RAND_NUM_REG\t0x00ac\n#define IPSEC_DMA_DEVICE_ID\t0xff00\n#define IPSEC_DMA_STATUS\t0xff04\n#define IPSEC_TXDMA_CTRL\t0xff08\n#define IPSEC_TXDMA_FIRST_DESC\t0xff0c\n#define IPSEC_TXDMA_CURR_DESC\t0xff10\n#define IPSEC_RXDMA_CTRL\t0xff14\n#define IPSEC_RXDMA_FIRST_DESC\t0xff18\n#define IPSEC_RXDMA_CURR_DESC\t0xff1c\n#define IPSEC_TXDMA_BUF_ADDR\t0xff28\n#define IPSEC_RXDMA_BUF_ADDR\t0xff38\n#define IPSEC_RXDMA_BUF_SIZE\t0xff30\n\n#define CE_ENCRYPTION\t\t0x01\n#define CE_DECRYPTION\t\t0x03\n\n#define MAXDESC 6\n\n#define DMA_STATUS_RS_EOFI\tBIT(22)\n#define DMA_STATUS_RS_PERR\tBIT(24)\n#define DMA_STATUS_RS_DERR\tBIT(25)\n#define DMA_STATUS_TS_EOFI\tBIT(27)\n#define DMA_STATUS_TS_PERR\tBIT(29)\n#define DMA_STATUS_TS_DERR\tBIT(30)\n\n#define TXDMA_CTRL_START BIT(31)\n#define TXDMA_CTRL_CONTINUE BIT(30)\n#define TXDMA_CTRL_CHAIN_MODE BIT(29)\n \n#define TXDMA_CTRL_BURST_UNK BIT(22)\n#define TXDMA_CTRL_INT_FAIL BIT(17)\n#define TXDMA_CTRL_INT_PERR BIT(16)\n\n#define RXDMA_CTRL_START BIT(31)\n#define RXDMA_CTRL_CONTINUE BIT(30)\n#define RXDMA_CTRL_CHAIN_MODE BIT(29)\n \n#define RXDMA_CTRL_BURST_UNK BIT(22)\n#define RXDMA_CTRL_INT_FINISH BIT(18)\n#define RXDMA_CTRL_INT_FAIL BIT(17)\n#define RXDMA_CTRL_INT_PERR BIT(16)\n#define RXDMA_CTRL_INT_EOD BIT(15)\n#define RXDMA_CTRL_INT_EOF BIT(14)\n\n#define CE_CPU 0\n#define CE_DMA 1\n\n \nstruct descriptor {\n\tunion {\n\t\tu32 raw;\n\t\t \n\t\tstruct desc_frame_ctrl {\n\t\t\tu32 buffer_size\t:16;\n\t\t\tu32 desc_count\t:6;\n\t\t\tu32 checksum\t:6;\n\t\t\tu32 authcomp\t:1;\n\t\t\tu32 perr\t:1;\n\t\t\tu32 derr\t:1;\n\t\t\tu32 own\t\t:1;\n\t\t} bits;\n\t} frame_ctrl;\n\n\tunion {\n\t\tu32 raw;\n\t\t \n\t\tstruct desc_tx_flag_status {\n\t\t\tu32 tqflag\t:10;\n\t\t\tu32 unused\t:22;\n\t\t} tx_flag;\n\t} flag_status;\n\n\tu32 buf_adr;\n\n\tunion {\n\t\tu32 next_descriptor;\n\t\t \n\t\tstruct desc_next {\n\t\t\tu32 sof_eof\t:2;\n\t\t\tu32 dec\t\t:1;\n\t\t\tu32 eofie\t:1;\n\t\t\tu32 ndar\t:28;\n\t\t} bits;\n\t} next_desc;\n};\n\n \nstruct pkt_control_header {\n\tu32 process_id\t\t:8;\n\tu32 auth_check_len\t:3;\n\tu32 un1\t\t\t:1;\n\tu32 auth_algorithm\t:3;\n\tu32 auth_mode\t\t:1;\n\tu32 fcs_stream_copy\t:1;\n\tu32 un2\t\t\t:2;\n\tu32 mix_key_sel\t\t:1;\n\tu32 aesnk\t\t:4;\n\tu32 cipher_algorithm\t:3;\n\tu32 un3\t\t\t:1;\n\tu32 op_mode\t\t:4;\n};\n\nstruct pkt_control_cipher {\n\tu32 algorithm_len\t:16;\n\tu32 header_len\t\t:16;\n};\n\n \nstruct pkt_control_ecb {\n\tstruct pkt_control_header control;\n\tstruct pkt_control_cipher cipher;\n\tunsigned char key[AES_MAX_KEY_SIZE];\n};\n\n \nstruct sl3516_ce_dev {\n\tvoid __iomem *base;\n\tstruct clk *clks;\n\tstruct reset_control *reset;\n\tstruct device *dev;\n\tstruct crypto_engine *engine;\n\tstruct completion complete;\n\tint status;\n\tdma_addr_t dtx;\n\tstruct descriptor *tx;\n\tdma_addr_t drx;\n\tstruct descriptor *rx;\n\tint ctx;\n\tint crx;\n\tstruct hwrng trng;\n\tunsigned long hwrng_stat_req;\n\tunsigned long hwrng_stat_bytes;\n\tunsigned long stat_irq;\n\tunsigned long stat_irq_tx;\n\tunsigned long stat_irq_rx;\n\tunsigned long stat_req;\n\tunsigned long fallback_sg_count_tx;\n\tunsigned long fallback_sg_count_rx;\n\tunsigned long fallback_not_same_len;\n\tunsigned long fallback_mod16;\n\tunsigned long fallback_align16;\n#ifdef CONFIG_CRYPTO_DEV_SL3516_DEBUG\n\tstruct dentry *dbgfs_dir;\n\tstruct dentry *dbgfs_stats;\n#endif\n\tvoid *pctrl;\n\tdma_addr_t dctrl;\n};\n\nstruct sginfo {\n\tu32 addr;\n\tu32 len;\n};\n\n \nstruct sl3516_ce_cipher_req_ctx {\n\tstruct sginfo t_src[MAXDESC];\n\tstruct sginfo t_dst[MAXDESC];\n\tu32 op_dir;\n\tunsigned int pctrllen;\n\tu32 tqflag;\n\tstruct pkt_control_cipher *h;\n\tint nr_sgs;\n\tint nr_sgd;\n\tstruct skcipher_request fallback_req;   \n};\n\n \nstruct sl3516_ce_cipher_tfm_ctx {\n\tu32 *key;\n\tu32 keylen;\n\tstruct sl3516_ce_dev *ce;\n\tstruct crypto_skcipher *fallback_tfm;\n};\n\n \nstruct sl3516_ce_alg_template {\n\tu32 type;\n\tu32 mode;\n\tstruct sl3516_ce_dev *ce;\n\tunion {\n\t\tstruct skcipher_engine_alg skcipher;\n\t} alg;\n\tunsigned long stat_req;\n\tunsigned long stat_fb;\n\tunsigned long stat_bytes;\n};\n\nint sl3516_ce_enqueue(struct crypto_async_request *areq, u32 type);\n\nint sl3516_ce_aes_setkey(struct crypto_skcipher *tfm, const u8 *key,\n\t\t\t unsigned int keylen);\nint sl3516_ce_cipher_init(struct crypto_tfm *tfm);\nvoid sl3516_ce_cipher_exit(struct crypto_tfm *tfm);\nint sl3516_ce_skdecrypt(struct skcipher_request *areq);\nint sl3516_ce_skencrypt(struct skcipher_request *areq);\n\nint sl3516_ce_run_task(struct sl3516_ce_dev *ce,\n\t\t       struct sl3516_ce_cipher_req_ctx *rctx, const char *name);\n\nint sl3516_ce_rng_register(struct sl3516_ce_dev *ce);\nvoid sl3516_ce_rng_unregister(struct sl3516_ce_dev *ce);\nint sl3516_ce_handle_cipher_request(struct crypto_engine *engine, void *areq);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}