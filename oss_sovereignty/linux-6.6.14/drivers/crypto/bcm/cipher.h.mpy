{
  "module_name": "cipher.h",
  "hash_id": "295d68f05685e51b0106d3759b3308aee071b193592cbede90a2b7214018c681",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/bcm/cipher.h",
  "human_readable_source": "\n \n \n\n#ifndef _CIPHER_H\n#define _CIPHER_H\n\n#include <linux/atomic.h>\n#include <linux/mailbox/brcm-message.h>\n#include <linux/mailbox_client.h>\n#include <crypto/aes.h>\n#include <crypto/internal/hash.h>\n#include <crypto/internal/skcipher.h>\n#include <crypto/aead.h>\n#include <crypto/arc4.h>\n#include <crypto/gcm.h>\n#include <crypto/sha1.h>\n#include <crypto/sha2.h>\n#include <crypto/sha3.h>\n\n#include \"spu.h\"\n#include \"spum.h\"\n#include \"spu2.h\"\n\n \n#define MAX_SPUS 16\n\n#define ARC4_STATE_SIZE     4\n\n#define CCM_AES_IV_SIZE    16\n#define CCM_ESP_IV_SIZE     8\n#define RFC4543_ICV_SIZE   16\n\n#define MAX_KEY_SIZE\tARC4_MAX_KEY_SIZE\n#define MAX_IV_SIZE\tAES_BLOCK_SIZE\n#define MAX_DIGEST_SIZE\tSHA3_512_DIGEST_SIZE\n#define MAX_ASSOC_SIZE\t512\n\n \n#define GCM_ESP_SALT_SIZE   4\n#define CCM_ESP_SALT_SIZE   3\n#define MAX_SALT_SIZE       GCM_ESP_SALT_SIZE\n#define GCM_ESP_SALT_OFFSET 0\n#define CCM_ESP_SALT_OFFSET 1\n\n#define GCM_ESP_DIGESTSIZE 16\n\n#define MAX_HASH_BLOCK_SIZE SHA512_BLOCK_SIZE\n\n \n#define HASH_CARRY_MAX  MAX_HASH_BLOCK_SIZE\n\n \n#define SPU_MSG_ALIGN  4\n\n \n#define SPU_MB_RETRY_MAX  1000\n\n \nenum op_type {\n\tSPU_OP_CIPHER,\n\tSPU_OP_HASH,\n\tSPU_OP_HMAC,\n\tSPU_OP_AEAD,\n\tSPU_OP_NUM\n};\n\nenum spu_spu_type {\n\tSPU_TYPE_SPUM,\n\tSPU_TYPE_SPU2,\n};\n\n \nenum spu_spu_subtype {\n\tSPU_SUBTYPE_SPUM_NS2,\n\tSPU_SUBTYPE_SPUM_NSP,\n\tSPU_SUBTYPE_SPU2_V1,\n\tSPU_SUBTYPE_SPU2_V2\n};\n\nstruct spu_type_subtype {\n\tenum spu_spu_type type;\n\tenum spu_spu_subtype subtype;\n};\n\nstruct cipher_op {\n\tenum spu_cipher_alg alg;\n\tenum spu_cipher_mode mode;\n};\n\nstruct auth_op {\n\tenum hash_alg alg;\n\tenum hash_mode mode;\n};\n\nstruct iproc_alg_s {\n\tu32 type;\n\tunion {\n\t\tstruct skcipher_alg skcipher;\n\t\tstruct ahash_alg hash;\n\t\tstruct aead_alg aead;\n\t} alg;\n\tstruct cipher_op cipher_info;\n\tstruct auth_op auth_info;\n\tbool auth_first;\n\tbool registered;\n};\n\n \nstruct spu_msg_buf {\n\t \n\n\t \n\tu8 bcm_spu_req_hdr[ALIGN(SPU2_HEADER_ALLOC_LEN, SPU_MSG_ALIGN)];\n\n\t \n\tu8 iv_ctr[ALIGN(2 * AES_BLOCK_SIZE, SPU_MSG_ALIGN)];\n\n\t \n\tu8 digest[ALIGN(MAX_DIGEST_SIZE, SPU_MSG_ALIGN)];\n\n\t \n\tu8 spu_req_pad[ALIGN(SPU_PAD_LEN_MAX, SPU_MSG_ALIGN)];\n\n\t \n\tu8 tx_stat[ALIGN(SPU_TX_STATUS_LEN, SPU_MSG_ALIGN)];\n\n\t \n\n\t \n\tu8 spu_resp_hdr[ALIGN(SPU2_HEADER_ALLOC_LEN, SPU_MSG_ALIGN)];\n\n\t \n\tu8 rx_stat_pad[ALIGN(SPU_STAT_PAD_MAX, SPU_MSG_ALIGN)];\n\n\t \n\tu8 rx_stat[ALIGN(SPU_RX_STATUS_LEN, SPU_MSG_ALIGN)];\n\n\tunion {\n\t\t \n\t\tstruct {\n\t\t\t \n\t\t\tu8 supdt_tweak[ALIGN(SPU_SUPDT_LEN, SPU_MSG_ALIGN)];\n\t\t} c;\n\n\t\t \n\t\tstruct {\n\t\t\t \n\t\t\tu8 gcmpad[ALIGN(AES_BLOCK_SIZE, SPU_MSG_ALIGN)];\n\n\t\t\t \n\t\t\tu8 req_aad_pad[ALIGN(SPU_PAD_LEN_MAX, SPU_MSG_ALIGN)];\n\n\t\t\t \n\t\t\tu8 resp_aad[ALIGN(MAX_ASSOC_SIZE + MAX_IV_SIZE,\n\t\t\t\t\t  SPU_MSG_ALIGN)];\n\t\t} a;\n\t};\n};\n\nstruct iproc_ctx_s {\n\tu8 enckey[MAX_KEY_SIZE + ARC4_STATE_SIZE];\n\tunsigned int enckeylen;\n\n\tu8 authkey[MAX_KEY_SIZE + ARC4_STATE_SIZE];\n\tunsigned int authkeylen;\n\n\tu8 salt[MAX_SALT_SIZE];\n\tunsigned int salt_len;\n\tunsigned int salt_offset;\n\tu8 iv[MAX_IV_SIZE];\n\n\tunsigned int digestsize;\n\n\tstruct iproc_alg_s *alg;\n\tbool is_esp;\n\n\tstruct cipher_op cipher;\n\tenum spu_cipher_type cipher_type;\n\n\tstruct auth_op auth;\n\tbool auth_first;\n\n\t \n\tunsigned int max_payload;\n\n\tstruct crypto_aead *fallback_cipher;\n\n\t \n\n\tu8 ipad[MAX_HASH_BLOCK_SIZE];\n\tu8 opad[MAX_HASH_BLOCK_SIZE];\n\n\t \n\tu8 bcm_spu_req_hdr[ALIGN(SPU2_HEADER_ALLOC_LEN, SPU_MSG_ALIGN)];\n\n\t \n\tu16 spu_req_hdr_len;\n\n\t \n\tu16 spu_resp_hdr_len;\n\n\t \n\tstruct shash_desc *shash;\n\n\tbool is_rfc4543;\t \n};\n\n \nstruct spu_hash_export_s {\n\tunsigned int total_todo;\n\tunsigned int total_sent;\n\tu8 hash_carry[HASH_CARRY_MAX];\n\tunsigned int hash_carry_len;\n\tu8 incr_hash[MAX_DIGEST_SIZE];\n\tbool is_sw_hmac;\n};\n\nstruct iproc_reqctx_s {\n\t \n\tstruct crypto_async_request *parent;\n\n\t \n\tstruct iproc_ctx_s *ctx;\n\n\tu8 chan_idx;    \n\n\t \n\tunsigned int total_todo;\n\tunsigned int total_received;\t \n\tunsigned int total_sent;\n\n\t \n\tunsigned int src_sent;\n\n\t \n\tstruct scatterlist *assoc;\n\n\t \n\tstruct scatterlist *src_sg;\n\tint src_nents;\t\t \n\tu32 src_skip;\t\t \n\n\t \n\tstruct scatterlist *dst_sg;\n\tint dst_nents;\t\t \n\tu32 dst_skip;\t\t \n\n\t \n\tstruct brcm_message mb_mssg;\n\n\tbool bd_suppress;\t \n\n\t \n\tbool is_encrypt;\n\n\t \n\tu8 *iv_ctr;\n\t \n\tunsigned int iv_ctr_len;\n\n\t \n\tu8 hash_carry[HASH_CARRY_MAX];\n\tunsigned int hash_carry_len;\n\tunsigned int is_final;\t \n\n\t \n\tu8 incr_hash[MAX_DIGEST_SIZE];\n\n\t \n\tbool is_sw_hmac;\n\n\tgfp_t gfp;\n\n\t \n\tstruct spu_msg_buf msg_buf;\n\n\tstruct aead_request req;\n};\n\n \nstruct spu_hw {\n\tvoid (*spu_dump_msg_hdr)(u8 *buf, unsigned int buf_len);\n\tu32 (*spu_ctx_max_payload)(enum spu_cipher_alg cipher_alg,\n\t\t\t\t   enum spu_cipher_mode cipher_mode,\n\t\t\t\t   unsigned int blocksize);\n\tu32 (*spu_payload_length)(u8 *spu_hdr);\n\tu16 (*spu_response_hdr_len)(u16 auth_key_len, u16 enc_key_len,\n\t\t\t\t    bool is_hash);\n\tu16 (*spu_hash_pad_len)(enum hash_alg hash_alg,\n\t\t\t\tenum hash_mode hash_mode, u32 chunksize,\n\t\t\t\tu16 hash_block_size);\n\tu32 (*spu_gcm_ccm_pad_len)(enum spu_cipher_mode cipher_mode,\n\t\t\t\t   unsigned int data_size);\n\tu32 (*spu_assoc_resp_len)(enum spu_cipher_mode cipher_mode,\n\t\t\t\t  unsigned int assoc_len,\n\t\t\t\t  unsigned int iv_len, bool is_encrypt);\n\tu8 (*spu_aead_ivlen)(enum spu_cipher_mode cipher_mode,\n\t\t\t     u16 iv_len);\n\tenum hash_type (*spu_hash_type)(u32 src_sent);\n\tu32 (*spu_digest_size)(u32 digest_size, enum hash_alg alg,\n\t\t\t       enum hash_type);\n\tu32 (*spu_create_request)(u8 *spu_hdr,\n\t\t\t\t  struct spu_request_opts *req_opts,\n\t\t\t\t  struct spu_cipher_parms *cipher_parms,\n\t\t\t\t  struct spu_hash_parms *hash_parms,\n\t\t\t\t  struct spu_aead_parms *aead_parms,\n\t\t\t\t  unsigned int data_size);\n\tu16 (*spu_cipher_req_init)(u8 *spu_hdr,\n\t\t\t\t   struct spu_cipher_parms *cipher_parms);\n\tvoid (*spu_cipher_req_finish)(u8 *spu_hdr,\n\t\t\t\t      u16 spu_req_hdr_len,\n\t\t\t\t      unsigned int is_inbound,\n\t\t\t\t      struct spu_cipher_parms *cipher_parms,\n\t\t\t\t      unsigned int data_size);\n\tvoid (*spu_request_pad)(u8 *pad_start, u32 gcm_padding,\n\t\t\t\tu32 hash_pad_len, enum hash_alg auth_alg,\n\t\t\t\tenum hash_mode auth_mode,\n\t\t\t\tunsigned int total_sent, u32 status_padding);\n\tu8 (*spu_xts_tweak_in_payload)(void);\n\tu8 (*spu_tx_status_len)(void);\n\tu8 (*spu_rx_status_len)(void);\n\tint (*spu_status_process)(u8 *statp);\n\tvoid (*spu_ccm_update_iv)(unsigned int digestsize,\n\t\t\t\t  struct spu_cipher_parms *cipher_parms,\n\t\t\t\t  unsigned int assoclen, unsigned int chunksize,\n\t\t\t\t  bool is_encrypt, bool is_esp);\n\tu32 (*spu_wordalign_padlen)(u32 data_size);\n\n\t \n\tvoid __iomem *reg_vbase[MAX_SPUS];\n\n\t \n\tenum spu_spu_type spu_type;\n\n\t \n\tenum spu_spu_subtype spu_subtype;\n\n\t \n\tu32 num_spu;\n\n\t \n\tu32 num_chan;\n};\n\nstruct bcm_device_private {\n\tstruct platform_device *pdev;\n\n\tstruct spu_hw spu;\n\n\tatomic_t session_count;\t \n\tatomic_t stream_count;\t \n\n\t \n\tu8 bcm_hdr_len;\n\n\t \n\tatomic_t next_chan;\n\n\tstruct dentry *debugfs_dir;\n\tstruct dentry *debugfs_stats;\n\n\t \n\tatomic64_t bytes_in;\n\tatomic64_t bytes_out;\n\n\t \n\tatomic_t op_counts[SPU_OP_NUM];\n\n\tatomic_t cipher_cnt[CIPHER_ALG_LAST][CIPHER_MODE_LAST];\n\tatomic_t hash_cnt[HASH_ALG_LAST];\n\tatomic_t hmac_cnt[HASH_ALG_LAST];\n\tatomic_t aead_cnt[AEAD_TYPE_LAST];\n\n\t \n\tatomic_t setkey_cnt[SPU_OP_NUM];\n\n\t \n\tatomic_t mb_no_spc;\n\n\t \n\tatomic_t mb_send_fail;\n\n\t \n\tatomic_t bad_icv;\n\n\tstruct mbox_client mcl;\n\n\t \n\tstruct mbox_chan **mbox;\n};\n\nextern struct bcm_device_private iproc_priv;\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}