{
  "module_name": "ccp-dev.h",
  "hash_id": "01387206a7d792847b46261c15b4abc510f8f1eb20c553e0fb059c9e28737ee1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/ccp/ccp-dev.h",
  "human_readable_source": " \n \n\n#ifndef __CCP_DEV_H__\n#define __CCP_DEV_H__\n\n#include <linux/device.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n#include <linux/dma-direction.h>\n#include <linux/dmapool.h>\n#include <linux/hw_random.h>\n#include <linux/bitops.h>\n#include <linux/interrupt.h>\n#include <linux/irqreturn.h>\n#include <linux/dmaengine.h>\n\n#include \"sp-dev.h\"\n\n#define MAX_CCP_NAME_LEN\t\t16\n#define MAX_DMAPOOL_NAME_LEN\t\t32\n\n#define MAX_HW_QUEUES\t\t\t5\n#define MAX_CMD_QLEN\t\t\t100\n\n#define TRNG_RETRIES\t\t\t10\n\n#define CACHE_NONE\t\t\t0x00\n#define CACHE_WB_NO_ALLOC\t\t0xb7\n\n \n#define Q_MASK_REG\t\t\t0x000\n#define TRNG_OUT_REG\t\t\t0x00c\n#define IRQ_MASK_REG\t\t\t0x040\n#define IRQ_STATUS_REG\t\t\t0x200\n\n#define DEL_CMD_Q_JOB\t\t\t0x124\n#define DEL_Q_ACTIVE\t\t\t0x00000200\n#define DEL_Q_ID_SHIFT\t\t\t6\n\n#define CMD_REQ0\t\t\t0x180\n#define CMD_REQ_INCR\t\t\t0x04\n\n#define CMD_Q_STATUS_BASE\t\t0x210\n#define CMD_Q_INT_STATUS_BASE\t\t0x214\n#define CMD_Q_STATUS_INCR\t\t0x20\n\n#define CMD_Q_CACHE_BASE\t\t0x228\n#define CMD_Q_CACHE_INC\t\t\t0x20\n\n#define CMD_Q_ERROR(__qs)\t\t((__qs) & 0x0000003f)\n#define CMD_Q_DEPTH(__qs)\t\t(((__qs) >> 12) & 0x0000000f)\n\n \n#define CMD5_QUEUE_MASK_OFFSET\t\t0x00\n#define\tCMD5_QUEUE_PRIO_OFFSET\t\t0x04\n#define CMD5_REQID_CONFIG_OFFSET\t0x08\n#define\tCMD5_CMD_TIMEOUT_OFFSET\t\t0x10\n#define LSB_PUBLIC_MASK_LO_OFFSET\t0x18\n#define LSB_PUBLIC_MASK_HI_OFFSET\t0x1C\n#define LSB_PRIVATE_MASK_LO_OFFSET\t0x20\n#define LSB_PRIVATE_MASK_HI_OFFSET\t0x24\n#define CMD5_PSP_CCP_VERSION\t\t0x100\n\n#define CMD5_Q_CONTROL_BASE\t\t0x0000\n#define CMD5_Q_TAIL_LO_BASE\t\t0x0004\n#define CMD5_Q_HEAD_LO_BASE\t\t0x0008\n#define CMD5_Q_INT_ENABLE_BASE\t\t0x000C\n#define CMD5_Q_INTERRUPT_STATUS_BASE\t0x0010\n\n#define CMD5_Q_STATUS_BASE\t\t0x0100\n#define CMD5_Q_INT_STATUS_BASE\t\t0x0104\n#define CMD5_Q_DMA_STATUS_BASE\t\t0x0108\n#define CMD5_Q_DMA_READ_STATUS_BASE\t0x010C\n#define CMD5_Q_DMA_WRITE_STATUS_BASE\t0x0110\n#define CMD5_Q_ABORT_BASE\t\t0x0114\n#define CMD5_Q_AX_CACHE_BASE\t\t0x0118\n\n#define\tCMD5_CONFIG_0_OFFSET\t\t0x6000\n#define\tCMD5_TRNG_CTL_OFFSET\t\t0x6008\n#define\tCMD5_AES_MASK_OFFSET\t\t0x6010\n#define\tCMD5_CLK_GATE_CTL_OFFSET\t0x603C\n\n \n#define CMD5_Q_STATUS_INCR\t\t0x1000\n\n \n#define CMD5_Q_RUN\t\t\t0x1\n#define CMD5_Q_HALT\t\t\t0x2\n#define CMD5_Q_MEM_LOCATION\t\t0x4\n#define CMD5_Q_SIZE\t\t\t0x1F\n#define CMD5_Q_SHIFT\t\t\t3\n#define COMMANDS_PER_QUEUE\t\t16\n#define QUEUE_SIZE_VAL\t\t\t((ffs(COMMANDS_PER_QUEUE) - 2) & \\\n\t\t\t\t\t  CMD5_Q_SIZE)\n#define Q_PTR_MASK\t\t\t(2 << (QUEUE_SIZE_VAL + 5) - 1)\n#define Q_DESC_SIZE\t\t\tsizeof(struct ccp5_desc)\n#define Q_SIZE(n)\t\t\t(COMMANDS_PER_QUEUE*(n))\n\n#define INT_COMPLETION\t\t\t0x1\n#define INT_ERROR\t\t\t0x2\n#define INT_QUEUE_STOPPED\t\t0x4\n#define\tINT_EMPTY_QUEUE\t\t\t0x8\n#define SUPPORTED_INTERRUPTS\t\t(INT_COMPLETION | INT_ERROR)\n\n#define LSB_REGION_WIDTH\t\t5\n#define MAX_LSB_CNT\t\t\t8\n\n#define LSB_SIZE\t\t\t16\n#define LSB_ITEM_SIZE\t\t\t32\n#define PLSB_MAP_SIZE\t\t\t(LSB_SIZE)\n#define SLSB_MAP_SIZE\t\t\t(MAX_LSB_CNT * LSB_SIZE)\n\n#define LSB_ENTRY_NUMBER(LSB_ADDR)\t(LSB_ADDR / LSB_ITEM_SIZE)\n\n \n#define REQ0_WAIT_FOR_WRITE\t\t0x00000004\n#define REQ0_INT_ON_COMPLETE\t\t0x00000002\n#define REQ0_STOP_ON_COMPLETE\t\t0x00000001\n\n#define REQ0_CMD_Q_SHIFT\t\t9\n#define REQ0_JOBID_SHIFT\t\t3\n\n \n#define REQ1_PROTECT_SHIFT\t\t27\n#define REQ1_ENGINE_SHIFT\t\t23\n#define REQ1_KEY_KSB_SHIFT\t\t2\n\n#define REQ1_EOM\t\t\t0x00000002\n#define REQ1_INIT\t\t\t0x00000001\n\n \n#define REQ1_AES_TYPE_SHIFT\t\t21\n#define REQ1_AES_MODE_SHIFT\t\t18\n#define REQ1_AES_ACTION_SHIFT\t\t17\n#define REQ1_AES_CFB_SIZE_SHIFT\t\t10\n\n \n#define REQ1_XTS_AES_SIZE_SHIFT\t\t10\n\n \n#define REQ1_SHA_TYPE_SHIFT\t\t21\n\n \n#define REQ1_RSA_MOD_SIZE_SHIFT\t\t10\n\n \n#define REQ1_PT_BW_SHIFT\t\t12\n#define REQ1_PT_BS_SHIFT\t\t10\n\n \n#define REQ1_ECC_AFFINE_CONVERT\t\t0x00200000\n#define REQ1_ECC_FUNCTION_SHIFT\t\t18\n\n \n#define REQ4_KSB_SHIFT\t\t\t18\n#define REQ4_MEMTYPE_SHIFT\t\t16\n\n \n#define REQ6_MEMTYPE_SHIFT\t\t16\n\n \n#define KSB_START\t\t\t77\n#define KSB_END\t\t\t\t127\n#define KSB_COUNT\t\t\t(KSB_END - KSB_START + 1)\n#define CCP_SB_BITS\t\t\t256\n\n#define CCP_JOBID_MASK\t\t\t0x0000003f\n\n \n\n#define\tCCP_DMA_DFLT\t\t\t0x0\n#define\tCCP_DMA_PRIV\t\t\t0x1\n#define\tCCP_DMA_PUB\t\t\t0x2\n\n#define CCP_DMAPOOL_MAX_SIZE\t\t64\n#define CCP_DMAPOOL_ALIGN\t\tBIT(5)\n\n#define CCP_REVERSE_BUF_SIZE\t\t64\n\n#define CCP_AES_KEY_SB_COUNT\t\t1\n#define CCP_AES_CTX_SB_COUNT\t\t1\n\n#define CCP_XTS_AES_KEY_SB_COUNT\t1\n#define CCP5_XTS_AES_KEY_SB_COUNT\t2\n#define CCP_XTS_AES_CTX_SB_COUNT\t1\n\n#define CCP_DES3_KEY_SB_COUNT\t\t1\n#define CCP_DES3_CTX_SB_COUNT\t\t1\n\n#define CCP_SHA_SB_COUNT\t\t1\n\n#define CCP_RSA_MAX_WIDTH\t\t4096\n#define CCP5_RSA_MAX_WIDTH\t\t16384\n\n#define CCP_PASSTHRU_BLOCKSIZE\t\t256\n#define CCP_PASSTHRU_MASKSIZE\t\t32\n#define CCP_PASSTHRU_SB_COUNT\t\t1\n\n#define CCP_ECC_MODULUS_BYTES\t\t48       \n#define CCP_ECC_MAX_OPERANDS\t\t6\n#define CCP_ECC_MAX_OUTPUTS\t\t3\n#define CCP_ECC_SRC_BUF_SIZE\t\t448\n#define CCP_ECC_DST_BUF_SIZE\t\t192\n#define CCP_ECC_OPERAND_SIZE\t\t64\n#define CCP_ECC_OUTPUT_SIZE\t\t64\n#define CCP_ECC_RESULT_OFFSET\t\t60\n#define CCP_ECC_RESULT_SUCCESS\t\t0x0001\n\n#define CCP_SB_BYTES\t\t\t32\n\nstruct ccp_op;\nstruct ccp_device;\nstruct ccp_cmd;\nstruct ccp_fns;\n\nstruct ccp_dma_cmd {\n\tstruct list_head entry;\n\n\tstruct ccp_cmd ccp_cmd;\n};\n\nstruct ccp_dma_desc {\n\tstruct list_head entry;\n\n\tstruct ccp_device *ccp;\n\n\tstruct list_head pending;\n\tstruct list_head active;\n\n\tenum dma_status status;\n\tstruct dma_async_tx_descriptor tx_desc;\n\tsize_t len;\n};\n\nstruct ccp_dma_chan {\n\tstruct ccp_device *ccp;\n\n\tspinlock_t lock;\n\tstruct list_head created;\n\tstruct list_head pending;\n\tstruct list_head active;\n\tstruct list_head complete;\n\n\tstruct tasklet_struct cleanup_tasklet;\n\n\tenum dma_status status;\n\tstruct dma_chan dma_chan;\n};\n\nstruct ccp_cmd_queue {\n\tstruct ccp_device *ccp;\n\n\t \n\tu32 id;\n\n\t \n\tstruct dma_pool *dma_pool;\n\n\t \n\tstruct ccp5_desc *qbase;\n\n\t \n\tstruct mutex q_mutex ____cacheline_aligned;\n\tunsigned int qidx;\n\n\t \n\tunsigned int qsize;\n\tdma_addr_t qbase_dma;\n\tdma_addr_t qdma_tail;\n\n\t \n\tu32 sb_key;\n\tu32 sb_ctx;\n\n\t \n\tDECLARE_BITMAP(lsbmask, MAX_LSB_CNT);\n\t \n\tint lsb;\n\tDECLARE_BITMAP(lsbmap, PLSB_MAP_SIZE);\n\n\t \n\tstruct task_struct *kthread;\n\tunsigned int active;\n\tunsigned int suspended;\n\n\t \n\tunsigned int free_slots;\n\n\t \n\tu32 int_ok;\n\tu32 int_err;\n\n\t \n\tvoid __iomem *reg_control;\n\tvoid __iomem *reg_tail_lo;\n\tvoid __iomem *reg_head_lo;\n\tvoid __iomem *reg_int_enable;\n\tvoid __iomem *reg_interrupt_status;\n\tvoid __iomem *reg_status;\n\tvoid __iomem *reg_int_status;\n\tvoid __iomem *reg_dma_status;\n\tvoid __iomem *reg_dma_read_status;\n\tvoid __iomem *reg_dma_write_status;\n\tu32 qcontrol;  \n\n\t \n\tu32 int_status;\n\tu32 q_status;\n\tu32 q_int_status;\n\tu32 cmd_error;\n\n\t \n\twait_queue_head_t int_queue;\n\tunsigned int int_rcvd;\n\n\t \n\tunsigned long total_ops;\n\tunsigned long total_aes_ops;\n\tunsigned long total_xts_aes_ops;\n\tunsigned long total_3des_ops;\n\tunsigned long total_sha_ops;\n\tunsigned long total_rsa_ops;\n\tunsigned long total_pt_ops;\n\tunsigned long total_ecc_ops;\n} ____cacheline_aligned;\n\nstruct ccp_device {\n\tstruct list_head entry;\n\n\tstruct ccp_vdata *vdata;\n\tunsigned int ord;\n\tchar name[MAX_CCP_NAME_LEN];\n\tchar rngname[MAX_CCP_NAME_LEN];\n\n\tstruct device *dev;\n\tstruct sp_device *sp;\n\n\t \n\tvoid *dev_specific;\n\tunsigned int qim;\n\tunsigned int irq;\n\tbool use_tasklet;\n\tstruct tasklet_struct irq_tasklet;\n\n\t \n\tstruct mutex req_mutex ____cacheline_aligned;\n\tvoid __iomem *io_regs;\n\n\t \n\tspinlock_t cmd_lock ____cacheline_aligned;\n\tunsigned int cmd_count;\n\tstruct list_head cmd;\n\tstruct list_head backlog;\n\n\t \n\tstruct ccp_cmd_queue cmd_q[MAX_HW_QUEUES];\n\tunsigned int cmd_q_count;\n\tunsigned int max_q_count;\n\n\t \n\tstruct hwrng hwrng;\n\tunsigned int hwrng_retries;\n\n\t \n\tstruct dma_device dma_dev;\n\tstruct ccp_dma_chan *ccp_dma_chan;\n\tstruct kmem_cache *dma_cmd_cache;\n\tstruct kmem_cache *dma_desc_cache;\n\n\t \n\tatomic_t current_id ____cacheline_aligned;\n\n\t \n\tstruct mutex sb_mutex ____cacheline_aligned;\n\tDECLARE_BITMAP(sb, KSB_COUNT);\n\twait_queue_head_t sb_queue;\n\tunsigned int sb_avail;\n\tunsigned int sb_count;\n\tu32 sb_start;\n\n\t \n\tDECLARE_BITMAP(lsbmap, SLSB_MAP_SIZE);\n\n\t \n\tunsigned int suspending;\n\twait_queue_head_t suspend_queue;\n\n\t \n\tunsigned int axcache;\n\n\t \n\tunsigned long total_interrupts;\n\n\t \n\tstruct dentry *debugfs_instance;\n};\n\nenum ccp_memtype {\n\tCCP_MEMTYPE_SYSTEM = 0,\n\tCCP_MEMTYPE_SB,\n\tCCP_MEMTYPE_LOCAL,\n\tCCP_MEMTYPE__LAST,\n};\n#define\tCCP_MEMTYPE_LSB\tCCP_MEMTYPE_KSB\n\n\nstruct ccp_dma_info {\n\tdma_addr_t address;\n\tunsigned int offset;\n\tunsigned int length;\n\tenum dma_data_direction dir;\n} __packed __aligned(4);\n\nstruct ccp_dm_workarea {\n\tstruct device *dev;\n\tstruct dma_pool *dma_pool;\n\n\tu8 *address;\n\tstruct ccp_dma_info dma;\n\tunsigned int length;\n};\n\nstruct ccp_sg_workarea {\n\tstruct scatterlist *sg;\n\tint nents;\n\tunsigned int sg_used;\n\n\tstruct scatterlist *dma_sg;\n\tstruct scatterlist *dma_sg_head;\n\tstruct device *dma_dev;\n\tunsigned int dma_count;\n\tenum dma_data_direction dma_dir;\n\n\tu64 bytes_left;\n};\n\nstruct ccp_data {\n\tstruct ccp_sg_workarea sg_wa;\n\tstruct ccp_dm_workarea dm_wa;\n};\n\nstruct ccp_mem {\n\tenum ccp_memtype type;\n\tunion {\n\t\tstruct ccp_dma_info dma;\n\t\tu32 sb;\n\t} u;\n};\n\nstruct ccp_aes_op {\n\tenum ccp_aes_type type;\n\tenum ccp_aes_mode mode;\n\tenum ccp_aes_action action;\n\tunsigned int size;\n};\n\nstruct ccp_xts_aes_op {\n\tenum ccp_aes_type type;\n\tenum ccp_aes_action action;\n\tenum ccp_xts_aes_unit_size unit_size;\n};\n\nstruct ccp_des3_op {\n\tenum ccp_des3_type type;\n\tenum ccp_des3_mode mode;\n\tenum ccp_des3_action action;\n};\n\nstruct ccp_sha_op {\n\tenum ccp_sha_type type;\n\tu64 msg_bits;\n};\n\nstruct ccp_rsa_op {\n\tu32 mod_size;\n\tu32 input_len;\n};\n\nstruct ccp_passthru_op {\n\tenum ccp_passthru_bitwise bit_mod;\n\tenum ccp_passthru_byteswap byte_swap;\n};\n\nstruct ccp_ecc_op {\n\tenum ccp_ecc_function function;\n};\n\nstruct ccp_op {\n\tstruct ccp_cmd_queue *cmd_q;\n\n\tu32 jobid;\n\tu32 ioc;\n\tu32 soc;\n\tu32 sb_key;\n\tu32 sb_ctx;\n\tu32 init;\n\tu32 eom;\n\n\tstruct ccp_mem src;\n\tstruct ccp_mem dst;\n\tstruct ccp_mem exp;\n\n\tunion {\n\t\tstruct ccp_aes_op aes;\n\t\tstruct ccp_xts_aes_op xts;\n\t\tstruct ccp_des3_op des3;\n\t\tstruct ccp_sha_op sha;\n\t\tstruct ccp_rsa_op rsa;\n\t\tstruct ccp_passthru_op passthru;\n\t\tstruct ccp_ecc_op ecc;\n\t} u;\n};\n\nstatic inline u32 ccp_addr_lo(struct ccp_dma_info *info)\n{\n\treturn lower_32_bits(info->address + info->offset);\n}\n\nstatic inline u32 ccp_addr_hi(struct ccp_dma_info *info)\n{\n\treturn upper_32_bits(info->address + info->offset) & 0x0000ffff;\n}\n\n \nstruct dword0 {\n\tunsigned int soc:1;\n\tunsigned int ioc:1;\n\tunsigned int rsvd1:1;\n\tunsigned int init:1;\n\tunsigned int eom:1;\t\t \n\tunsigned int function:15;\n\tunsigned int engine:4;\n\tunsigned int prot:1;\n\tunsigned int rsvd2:7;\n};\n\nstruct dword3 {\n\tunsigned int  src_hi:16;\n\tunsigned int  src_mem:2;\n\tunsigned int  lsb_cxt_id:8;\n\tunsigned int  rsvd1:5;\n\tunsigned int  fixed:1;\n};\n\nunion dword4 {\n\tu32 dst_lo;\t\t \n\tu32 sha_len_lo;\t\t \n};\n\nunion dword5 {\n\tstruct {\n\t\tunsigned int  dst_hi:16;\n\t\tunsigned int  dst_mem:2;\n\t\tunsigned int  rsvd1:13;\n\t\tunsigned int  fixed:1;\n\t} fields;\n\tu32 sha_len_hi;\n};\n\nstruct dword7 {\n\tunsigned int  key_hi:16;\n\tunsigned int  key_mem:2;\n\tunsigned int  rsvd1:14;\n};\n\nstruct ccp5_desc {\n\tstruct dword0 dw0;\n\tu32 length;\n\tu32 src_lo;\n\tstruct dword3 dw3;\n\tunion dword4 dw4;\n\tunion dword5 dw5;\n\tu32 key_lo;\n\tstruct dword7 dw7;\n};\n\nvoid ccp_add_device(struct ccp_device *ccp);\nvoid ccp_del_device(struct ccp_device *ccp);\n\nextern void ccp_log_error(struct ccp_device *, unsigned int);\n\nstruct ccp_device *ccp_alloc_struct(struct sp_device *sp);\nbool ccp_queues_suspended(struct ccp_device *ccp);\nint ccp_cmd_queue_thread(void *data);\nint ccp_trng_read(struct hwrng *rng, void *data, size_t max, bool wait);\n\nint ccp_run_cmd(struct ccp_cmd_queue *cmd_q, struct ccp_cmd *cmd);\n\nint ccp_register_rng(struct ccp_device *ccp);\nvoid ccp_unregister_rng(struct ccp_device *ccp);\nint ccp_dmaengine_register(struct ccp_device *ccp);\nvoid ccp_dmaengine_unregister(struct ccp_device *ccp);\n\nvoid ccp5_debugfs_setup(struct ccp_device *ccp);\nvoid ccp5_debugfs_destroy(void);\n\n \nstruct ccp_actions {\n\tint (*aes)(struct ccp_op *);\n\tint (*xts_aes)(struct ccp_op *);\n\tint (*des3)(struct ccp_op *);\n\tint (*sha)(struct ccp_op *);\n\tint (*rsa)(struct ccp_op *);\n\tint (*passthru)(struct ccp_op *);\n\tint (*ecc)(struct ccp_op *);\n\tu32 (*sballoc)(struct ccp_cmd_queue *, unsigned int);\n\tvoid (*sbfree)(struct ccp_cmd_queue *, unsigned int, unsigned int);\n\tunsigned int (*get_free_slots)(struct ccp_cmd_queue *);\n\tint (*init)(struct ccp_device *);\n\tvoid (*destroy)(struct ccp_device *);\n\tirqreturn_t (*irqhandler)(int, void *);\n};\n\nextern const struct ccp_vdata ccpv3_platform;\nextern const struct ccp_vdata ccpv3;\nextern const struct ccp_vdata ccpv5a;\nextern const struct ccp_vdata ccpv5b;\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}