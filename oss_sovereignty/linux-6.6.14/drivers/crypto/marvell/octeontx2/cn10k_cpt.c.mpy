{
  "module_name": "cn10k_cpt.c",
  "hash_id": "6a9a162a1152439dc9ddf6341d94aa1fec21259d1cc4a5577015fb1437aa4da2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/marvell/octeontx2/cn10k_cpt.c",
  "human_readable_source": "\n \n\n#include <linux/soc/marvell/octeontx2/asm.h>\n#include \"otx2_cptpf.h\"\n#include \"otx2_cptvf.h\"\n#include \"otx2_cptlf.h\"\n#include \"cn10k_cpt.h\"\n\nstatic void cn10k_cpt_send_cmd(union otx2_cpt_inst_s *cptinst, u32 insts_num,\n\t\t\t       struct otx2_cptlf_info *lf);\n\nstatic struct cpt_hw_ops otx2_hw_ops = {\n\t.send_cmd = otx2_cpt_send_cmd,\n\t.cpt_get_compcode = otx2_cpt_get_compcode,\n\t.cpt_get_uc_compcode = otx2_cpt_get_uc_compcode,\n};\n\nstatic struct cpt_hw_ops cn10k_hw_ops = {\n\t.send_cmd = cn10k_cpt_send_cmd,\n\t.cpt_get_compcode = cn10k_cpt_get_compcode,\n\t.cpt_get_uc_compcode = cn10k_cpt_get_uc_compcode,\n};\n\nstatic void cn10k_cpt_send_cmd(union otx2_cpt_inst_s *cptinst, u32 insts_num,\n\t\t\t       struct otx2_cptlf_info *lf)\n{\n\tvoid __iomem *lmtline = lf->lmtline;\n\tu64 val = (lf->slot & 0x7FF);\n\tu64 tar_addr = 0;\n\n\t \n\ttar_addr |= (__force u64)lf->ioreg |\n\t\t    (((OTX2_CPT_INST_SIZE/16) - 1) & 0x7) << 4;\n\t \n\tdma_wmb();\n\n\t \n\tmemcpy_toio(lmtline, cptinst, insts_num * OTX2_CPT_INST_SIZE);\n\tcn10k_lmt_flush(val, tar_addr);\n}\n\nint cn10k_cptpf_lmtst_init(struct otx2_cptpf_dev *cptpf)\n{\n\tstruct pci_dev *pdev = cptpf->pdev;\n\tresource_size_t size;\n\tu64 lmt_base;\n\n\tif (!test_bit(CN10K_LMTST, &cptpf->cap_flag)) {\n\t\tcptpf->lfs.ops = &otx2_hw_ops;\n\t\treturn 0;\n\t}\n\n\tcptpf->lfs.ops = &cn10k_hw_ops;\n\tlmt_base = readq(cptpf->reg_base + RVU_PF_LMTLINE_ADDR);\n\tif (!lmt_base) {\n\t\tdev_err(&pdev->dev, \"PF LMTLINE address not configured\\n\");\n\t\treturn -ENOMEM;\n\t}\n\tsize = pci_resource_len(pdev, PCI_MBOX_BAR_NUM);\n\tsize -= ((1 + cptpf->max_vfs) * MBOX_SIZE);\n\tcptpf->lfs.lmt_base = devm_ioremap_wc(&pdev->dev, lmt_base, size);\n\tif (!cptpf->lfs.lmt_base) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"Mapping of PF LMTLINE address failed\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_NS_GPL(cn10k_cptpf_lmtst_init, CRYPTO_DEV_OCTEONTX2_CPT);\n\nint cn10k_cptvf_lmtst_init(struct otx2_cptvf_dev *cptvf)\n{\n\tstruct pci_dev *pdev = cptvf->pdev;\n\tresource_size_t offset, size;\n\n\tif (!test_bit(CN10K_LMTST, &cptvf->cap_flag)) {\n\t\tcptvf->lfs.ops = &otx2_hw_ops;\n\t\treturn 0;\n\t}\n\n\tcptvf->lfs.ops = &cn10k_hw_ops;\n\toffset = pci_resource_start(pdev, PCI_MBOX_BAR_NUM);\n\tsize = pci_resource_len(pdev, PCI_MBOX_BAR_NUM);\n\t \n\tcptvf->lfs.lmt_base = devm_ioremap_wc(&pdev->dev, offset, size);\n\tif (!cptvf->lfs.lmt_base) {\n\t\tdev_err(&pdev->dev, \"Unable to map BAR4\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_NS_GPL(cn10k_cptvf_lmtst_init, CRYPTO_DEV_OCTEONTX2_CPT);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}