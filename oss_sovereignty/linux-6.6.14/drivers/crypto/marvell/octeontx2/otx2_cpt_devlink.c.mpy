{
  "module_name": "otx2_cpt_devlink.c",
  "hash_id": "880d98cf6cefc2d1d8cbf7444d0f2bb3d3e57413e0458e2e583e47b9c0fe9ab7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/marvell/octeontx2/otx2_cpt_devlink.c",
  "human_readable_source": "\n \n\n#include \"otx2_cpt_devlink.h\"\n\nstatic int otx2_cpt_dl_egrp_create(struct devlink *dl, u32 id,\n\t\t\t\t   struct devlink_param_gset_ctx *ctx)\n{\n\tstruct otx2_cpt_devlink *cpt_dl = devlink_priv(dl);\n\tstruct otx2_cptpf_dev *cptpf = cpt_dl->cptpf;\n\n\treturn otx2_cpt_dl_custom_egrp_create(cptpf, ctx);\n}\n\nstatic int otx2_cpt_dl_egrp_delete(struct devlink *dl, u32 id,\n\t\t\t\t   struct devlink_param_gset_ctx *ctx)\n{\n\tstruct otx2_cpt_devlink *cpt_dl = devlink_priv(dl);\n\tstruct otx2_cptpf_dev *cptpf = cpt_dl->cptpf;\n\n\treturn otx2_cpt_dl_custom_egrp_delete(cptpf, ctx);\n}\n\nstatic int otx2_cpt_dl_uc_info(struct devlink *dl, u32 id,\n\t\t\t       struct devlink_param_gset_ctx *ctx)\n{\n\tstruct otx2_cpt_devlink *cpt_dl = devlink_priv(dl);\n\tstruct otx2_cptpf_dev *cptpf = cpt_dl->cptpf;\n\n\totx2_cpt_print_uc_dbg_info(cptpf);\n\n\treturn 0;\n}\n\nenum otx2_cpt_dl_param_id {\n\tOTX2_CPT_DEVLINK_PARAM_ID_BASE = DEVLINK_PARAM_GENERIC_ID_MAX,\n\tOTX2_CPT_DEVLINK_PARAM_ID_EGRP_CREATE,\n\tOTX2_CPT_DEVLINK_PARAM_ID_EGRP_DELETE,\n};\n\nstatic const struct devlink_param otx2_cpt_dl_params[] = {\n\tDEVLINK_PARAM_DRIVER(OTX2_CPT_DEVLINK_PARAM_ID_EGRP_CREATE,\n\t\t\t     \"egrp_create\", DEVLINK_PARAM_TYPE_STRING,\n\t\t\t     BIT(DEVLINK_PARAM_CMODE_RUNTIME),\n\t\t\t     otx2_cpt_dl_uc_info, otx2_cpt_dl_egrp_create,\n\t\t\t     NULL),\n\tDEVLINK_PARAM_DRIVER(OTX2_CPT_DEVLINK_PARAM_ID_EGRP_DELETE,\n\t\t\t     \"egrp_delete\", DEVLINK_PARAM_TYPE_STRING,\n\t\t\t     BIT(DEVLINK_PARAM_CMODE_RUNTIME),\n\t\t\t     otx2_cpt_dl_uc_info, otx2_cpt_dl_egrp_delete,\n\t\t\t     NULL),\n};\n\nstatic int otx2_cpt_dl_info_firmware_version_put(struct devlink_info_req *req,\n\t\t\t\t\t\t struct otx2_cpt_eng_grp_info grp[],\n\t\t\t\t\t\t const char *ver_name, int eng_type)\n{\n\tstruct otx2_cpt_engs_rsvd *eng;\n\tint i;\n\n\tfor (i = 0; i < OTX2_CPT_MAX_ENGINE_GROUPS; i++) {\n\t\teng = find_engines_by_type(&grp[i], eng_type);\n\t\tif (eng)\n\t\t\treturn devlink_info_version_running_put(req, ver_name,\n\t\t\t\t\t\t\t\teng->ucode->ver_str);\n\t}\n\n\treturn 0;\n}\n\nstatic int otx2_cpt_devlink_info_get(struct devlink *dl,\n\t\t\t\t     struct devlink_info_req *req,\n\t\t\t\t     struct netlink_ext_ack *extack)\n{\n\tstruct otx2_cpt_devlink *cpt_dl = devlink_priv(dl);\n\tstruct otx2_cptpf_dev *cptpf = cpt_dl->cptpf;\n\tint err;\n\n\terr = otx2_cpt_dl_info_firmware_version_put(req, cptpf->eng_grps.grp,\n\t\t\t\t\t\t    \"fw.ae\", OTX2_CPT_AE_TYPES);\n\tif (err)\n\t\treturn err;\n\n\terr = otx2_cpt_dl_info_firmware_version_put(req, cptpf->eng_grps.grp,\n\t\t\t\t\t\t    \"fw.se\", OTX2_CPT_SE_TYPES);\n\tif (err)\n\t\treturn err;\n\n\treturn otx2_cpt_dl_info_firmware_version_put(req, cptpf->eng_grps.grp,\n\t\t\t\t\t\t    \"fw.ie\", OTX2_CPT_IE_TYPES);\n}\n\nstatic const struct devlink_ops otx2_cpt_devlink_ops = {\n\t.info_get = otx2_cpt_devlink_info_get,\n};\n\nint otx2_cpt_register_dl(struct otx2_cptpf_dev *cptpf)\n{\n\tstruct device *dev = &cptpf->pdev->dev;\n\tstruct otx2_cpt_devlink *cpt_dl;\n\tstruct devlink *dl;\n\tint ret;\n\n\tdl = devlink_alloc(&otx2_cpt_devlink_ops,\n\t\t\t   sizeof(struct otx2_cpt_devlink), dev);\n\tif (!dl) {\n\t\tdev_warn(dev, \"devlink_alloc failed\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tcpt_dl = devlink_priv(dl);\n\tcpt_dl->dl = dl;\n\tcpt_dl->cptpf = cptpf;\n\tcptpf->dl = dl;\n\tret = devlink_params_register(dl, otx2_cpt_dl_params,\n\t\t\t\t      ARRAY_SIZE(otx2_cpt_dl_params));\n\tif (ret) {\n\t\tdev_err(dev, \"devlink params register failed with error %d\",\n\t\t\tret);\n\t\tdevlink_free(dl);\n\t\treturn ret;\n\t}\n\n\tdevlink_register(dl);\n\n\treturn 0;\n}\n\nvoid otx2_cpt_unregister_dl(struct otx2_cptpf_dev *cptpf)\n{\n\tstruct devlink *dl = cptpf->dl;\n\n\tif (!dl)\n\t\treturn;\n\n\tdevlink_unregister(dl);\n\tdevlink_params_unregister(dl, otx2_cpt_dl_params,\n\t\t\t\t  ARRAY_SIZE(otx2_cpt_dl_params));\n\tdevlink_free(dl);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}