{
  "module_name": "caamalg.c",
  "hash_id": "fa4950d094d5052a1cd3f8c3743c4ebea550d7846b3bf2ecf4cb103c0e7fcfe9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/caam/caamalg.c",
  "human_readable_source": "\n \n\n#include \"compat.h\"\n\n#include \"regs.h\"\n#include \"intern.h\"\n#include \"desc_constr.h\"\n#include \"jr.h\"\n#include \"error.h\"\n#include \"sg_sw_sec4.h\"\n#include \"key_gen.h\"\n#include \"caamalg_desc.h\"\n#include <asm/unaligned.h>\n#include <crypto/internal/aead.h>\n#include <crypto/internal/engine.h>\n#include <crypto/internal/skcipher.h>\n#include <crypto/xts.h>\n#include <linux/dma-mapping.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n\n \n#define CAAM_CRA_PRIORITY\t\t3000\n \n#define CAAM_MAX_KEY_SIZE\t\t(AES_MAX_KEY_SIZE + \\\n\t\t\t\t\t CTR_RFC3686_NONCE_SIZE + \\\n\t\t\t\t\t SHA512_DIGEST_SIZE * 2)\n\n#define AEAD_DESC_JOB_IO_LEN\t\t(DESC_JOB_IO_LEN + CAAM_CMD_SZ * 2)\n#define GCM_DESC_JOB_IO_LEN\t\t(AEAD_DESC_JOB_IO_LEN + \\\n\t\t\t\t\t CAAM_CMD_SZ * 4)\n#define AUTHENC_DESC_JOB_IO_LEN\t\t(AEAD_DESC_JOB_IO_LEN + \\\n\t\t\t\t\t CAAM_CMD_SZ * 5)\n\n#define CHACHAPOLY_DESC_JOB_IO_LEN\t(AEAD_DESC_JOB_IO_LEN + CAAM_CMD_SZ * 6)\n\n#define DESC_MAX_USED_BYTES\t\t(CAAM_DESC_BYTES_MAX - DESC_JOB_IO_LEN_MIN)\n#define DESC_MAX_USED_LEN\t\t(DESC_MAX_USED_BYTES / CAAM_CMD_SZ)\n\nstruct caam_alg_entry {\n\tint class1_alg_type;\n\tint class2_alg_type;\n\tbool rfc3686;\n\tbool geniv;\n\tbool nodkp;\n};\n\nstruct caam_aead_alg {\n\tstruct aead_engine_alg aead;\n\tstruct caam_alg_entry caam;\n\tbool registered;\n};\n\nstruct caam_skcipher_alg {\n\tstruct skcipher_engine_alg skcipher;\n\tstruct caam_alg_entry caam;\n\tbool registered;\n};\n\n \nstruct caam_ctx {\n\tu32 sh_desc_enc[DESC_MAX_USED_LEN];\n\tu32 sh_desc_dec[DESC_MAX_USED_LEN];\n\tu8 key[CAAM_MAX_KEY_SIZE];\n\tdma_addr_t sh_desc_enc_dma;\n\tdma_addr_t sh_desc_dec_dma;\n\tdma_addr_t key_dma;\n\tenum dma_data_direction dir;\n\tstruct device *jrdev;\n\tstruct alginfo adata;\n\tstruct alginfo cdata;\n\tunsigned int authsize;\n\tbool xts_key_fallback;\n\tstruct crypto_skcipher *fallback;\n};\n\nstruct caam_skcipher_req_ctx {\n\tstruct skcipher_edesc *edesc;\n\tstruct skcipher_request fallback_req;\n};\n\nstruct caam_aead_req_ctx {\n\tstruct aead_edesc *edesc;\n};\n\nstatic int aead_null_set_sh_desc(struct crypto_aead *aead)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tstruct caam_drv_private *ctrlpriv = dev_get_drvdata(jrdev->parent);\n\tu32 *desc;\n\tint rem_bytes = CAAM_DESC_BYTES_MAX - AEAD_DESC_JOB_IO_LEN -\n\t\t\tctx->adata.keylen_pad;\n\n\t \n\tif (rem_bytes >= DESC_AEAD_NULL_ENC_LEN) {\n\t\tctx->adata.key_inline = true;\n\t\tctx->adata.key_virt = ctx->key;\n\t} else {\n\t\tctx->adata.key_inline = false;\n\t\tctx->adata.key_dma = ctx->key_dma;\n\t}\n\n\t \n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_aead_null_encap(desc, &ctx->adata, ctx->authsize,\n\t\t\t\t    ctrlpriv->era);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\t \n\tif (rem_bytes >= DESC_AEAD_NULL_DEC_LEN) {\n\t\tctx->adata.key_inline = true;\n\t\tctx->adata.key_virt = ctx->key;\n\t} else {\n\t\tctx->adata.key_inline = false;\n\t\tctx->adata.key_dma = ctx->key_dma;\n\t}\n\n\t \n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_aead_null_decap(desc, &ctx->adata, ctx->authsize,\n\t\t\t\t    ctrlpriv->era);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\treturn 0;\n}\n\nstatic int aead_set_sh_desc(struct crypto_aead *aead)\n{\n\tstruct caam_aead_alg *alg = container_of(crypto_aead_alg(aead),\n\t\t\t\t\t\t struct caam_aead_alg,\n\t\t\t\t\t\t aead.base);\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tstruct caam_drv_private *ctrlpriv = dev_get_drvdata(jrdev->parent);\n\tu32 ctx1_iv_off = 0;\n\tu32 *desc, *nonce = NULL;\n\tu32 inl_mask;\n\tunsigned int data_len[2];\n\tconst bool ctr_mode = ((ctx->cdata.algtype & OP_ALG_AAI_MASK) ==\n\t\t\t       OP_ALG_AAI_CTR_MOD128);\n\tconst bool is_rfc3686 = alg->caam.rfc3686;\n\n\tif (!ctx->authsize)\n\t\treturn 0;\n\n\t \n\tif (!ctx->cdata.keylen)\n\t\treturn aead_null_set_sh_desc(aead);\n\n\t \n\tif (ctr_mode)\n\t\tctx1_iv_off = 16;\n\n\t \n\tif (is_rfc3686) {\n\t\tctx1_iv_off = 16 + CTR_RFC3686_NONCE_SIZE;\n\t\tnonce = (u32 *)((void *)ctx->key + ctx->adata.keylen_pad +\n\t\t\t\tctx->cdata.keylen - CTR_RFC3686_NONCE_SIZE);\n\t}\n\n\t \n\tctx->adata.key_virt = ctx->key;\n\tctx->adata.key_dma = ctx->key_dma;\n\n\tctx->cdata.key_virt = ctx->key + ctx->adata.keylen_pad;\n\tctx->cdata.key_dma = ctx->key_dma + ctx->adata.keylen_pad;\n\n\tdata_len[0] = ctx->adata.keylen_pad;\n\tdata_len[1] = ctx->cdata.keylen;\n\n\tif (alg->caam.geniv)\n\t\tgoto skip_enc;\n\n\t \n\tif (desc_inline_query(DESC_AEAD_ENC_LEN +\n\t\t\t      (is_rfc3686 ? DESC_AEAD_CTR_RFC3686_LEN : 0),\n\t\t\t      AUTHENC_DESC_JOB_IO_LEN, data_len, &inl_mask,\n\t\t\t      ARRAY_SIZE(data_len)) < 0)\n\t\treturn -EINVAL;\n\n\tctx->adata.key_inline = !!(inl_mask & 1);\n\tctx->cdata.key_inline = !!(inl_mask & 2);\n\n\t \n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_aead_encap(desc, &ctx->cdata, &ctx->adata, ivsize,\n\t\t\t       ctx->authsize, is_rfc3686, nonce, ctx1_iv_off,\n\t\t\t       false, ctrlpriv->era);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\nskip_enc:\n\t \n\tif (desc_inline_query(DESC_AEAD_DEC_LEN +\n\t\t\t      (is_rfc3686 ? DESC_AEAD_CTR_RFC3686_LEN : 0),\n\t\t\t      AUTHENC_DESC_JOB_IO_LEN, data_len, &inl_mask,\n\t\t\t      ARRAY_SIZE(data_len)) < 0)\n\t\treturn -EINVAL;\n\n\tctx->adata.key_inline = !!(inl_mask & 1);\n\tctx->cdata.key_inline = !!(inl_mask & 2);\n\n\t \n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_aead_decap(desc, &ctx->cdata, &ctx->adata, ivsize,\n\t\t\t       ctx->authsize, alg->caam.geniv, is_rfc3686,\n\t\t\t       nonce, ctx1_iv_off, false, ctrlpriv->era);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\tif (!alg->caam.geniv)\n\t\tgoto skip_givenc;\n\n\t \n\tif (desc_inline_query(DESC_AEAD_GIVENC_LEN +\n\t\t\t      (is_rfc3686 ? DESC_AEAD_CTR_RFC3686_LEN : 0),\n\t\t\t      AUTHENC_DESC_JOB_IO_LEN, data_len, &inl_mask,\n\t\t\t      ARRAY_SIZE(data_len)) < 0)\n\t\treturn -EINVAL;\n\n\tctx->adata.key_inline = !!(inl_mask & 1);\n\tctx->cdata.key_inline = !!(inl_mask & 2);\n\n\t \n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_aead_givencap(desc, &ctx->cdata, &ctx->adata, ivsize,\n\t\t\t\t  ctx->authsize, is_rfc3686, nonce,\n\t\t\t\t  ctx1_iv_off, false, ctrlpriv->era);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\nskip_givenc:\n\treturn 0;\n}\n\nstatic int aead_setauthsize(struct crypto_aead *authenc,\n\t\t\t\t    unsigned int authsize)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(authenc);\n\n\tctx->authsize = authsize;\n\taead_set_sh_desc(authenc);\n\n\treturn 0;\n}\n\nstatic int gcm_set_sh_desc(struct crypto_aead *aead)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tu32 *desc;\n\tint rem_bytes = CAAM_DESC_BYTES_MAX - GCM_DESC_JOB_IO_LEN -\n\t\t\tctx->cdata.keylen;\n\n\tif (!ctx->cdata.keylen || !ctx->authsize)\n\t\treturn 0;\n\n\t \n\tif (rem_bytes >= DESC_GCM_ENC_LEN) {\n\t\tctx->cdata.key_inline = true;\n\t\tctx->cdata.key_virt = ctx->key;\n\t} else {\n\t\tctx->cdata.key_inline = false;\n\t\tctx->cdata.key_dma = ctx->key_dma;\n\t}\n\n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_gcm_encap(desc, &ctx->cdata, ivsize, ctx->authsize, false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\t \n\tif (rem_bytes >= DESC_GCM_DEC_LEN) {\n\t\tctx->cdata.key_inline = true;\n\t\tctx->cdata.key_virt = ctx->key;\n\t} else {\n\t\tctx->cdata.key_inline = false;\n\t\tctx->cdata.key_dma = ctx->key_dma;\n\t}\n\n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_gcm_decap(desc, &ctx->cdata, ivsize, ctx->authsize, false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\treturn 0;\n}\n\nstatic int gcm_setauthsize(struct crypto_aead *authenc, unsigned int authsize)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(authenc);\n\tint err;\n\n\terr = crypto_gcm_check_authsize(authsize);\n\tif (err)\n\t\treturn err;\n\n\tctx->authsize = authsize;\n\tgcm_set_sh_desc(authenc);\n\n\treturn 0;\n}\n\nstatic int rfc4106_set_sh_desc(struct crypto_aead *aead)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tu32 *desc;\n\tint rem_bytes = CAAM_DESC_BYTES_MAX - GCM_DESC_JOB_IO_LEN -\n\t\t\tctx->cdata.keylen;\n\n\tif (!ctx->cdata.keylen || !ctx->authsize)\n\t\treturn 0;\n\n\t \n\tif (rem_bytes >= DESC_RFC4106_ENC_LEN) {\n\t\tctx->cdata.key_inline = true;\n\t\tctx->cdata.key_virt = ctx->key;\n\t} else {\n\t\tctx->cdata.key_inline = false;\n\t\tctx->cdata.key_dma = ctx->key_dma;\n\t}\n\n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_rfc4106_encap(desc, &ctx->cdata, ivsize, ctx->authsize,\n\t\t\t\t  false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\t \n\tif (rem_bytes >= DESC_RFC4106_DEC_LEN) {\n\t\tctx->cdata.key_inline = true;\n\t\tctx->cdata.key_virt = ctx->key;\n\t} else {\n\t\tctx->cdata.key_inline = false;\n\t\tctx->cdata.key_dma = ctx->key_dma;\n\t}\n\n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_rfc4106_decap(desc, &ctx->cdata, ivsize, ctx->authsize,\n\t\t\t\t  false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\treturn 0;\n}\n\nstatic int rfc4106_setauthsize(struct crypto_aead *authenc,\n\t\t\t       unsigned int authsize)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(authenc);\n\tint err;\n\n\terr = crypto_rfc4106_check_authsize(authsize);\n\tif (err)\n\t\treturn err;\n\n\tctx->authsize = authsize;\n\trfc4106_set_sh_desc(authenc);\n\n\treturn 0;\n}\n\nstatic int rfc4543_set_sh_desc(struct crypto_aead *aead)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tu32 *desc;\n\tint rem_bytes = CAAM_DESC_BYTES_MAX - GCM_DESC_JOB_IO_LEN -\n\t\t\tctx->cdata.keylen;\n\n\tif (!ctx->cdata.keylen || !ctx->authsize)\n\t\treturn 0;\n\n\t \n\tif (rem_bytes >= DESC_RFC4543_ENC_LEN) {\n\t\tctx->cdata.key_inline = true;\n\t\tctx->cdata.key_virt = ctx->key;\n\t} else {\n\t\tctx->cdata.key_inline = false;\n\t\tctx->cdata.key_dma = ctx->key_dma;\n\t}\n\n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_rfc4543_encap(desc, &ctx->cdata, ivsize, ctx->authsize,\n\t\t\t\t  false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\t \n\tif (rem_bytes >= DESC_RFC4543_DEC_LEN) {\n\t\tctx->cdata.key_inline = true;\n\t\tctx->cdata.key_virt = ctx->key;\n\t} else {\n\t\tctx->cdata.key_inline = false;\n\t\tctx->cdata.key_dma = ctx->key_dma;\n\t}\n\n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_rfc4543_decap(desc, &ctx->cdata, ivsize, ctx->authsize,\n\t\t\t\t  false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\treturn 0;\n}\n\nstatic int rfc4543_setauthsize(struct crypto_aead *authenc,\n\t\t\t       unsigned int authsize)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(authenc);\n\n\tif (authsize != 16)\n\t\treturn -EINVAL;\n\n\tctx->authsize = authsize;\n\trfc4543_set_sh_desc(authenc);\n\n\treturn 0;\n}\n\nstatic int chachapoly_set_sh_desc(struct crypto_aead *aead)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tu32 *desc;\n\n\tif (!ctx->cdata.keylen || !ctx->authsize)\n\t\treturn 0;\n\n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_chachapoly(desc, &ctx->cdata, &ctx->adata, ivsize,\n\t\t\t       ctx->authsize, true, false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_chachapoly(desc, &ctx->cdata, &ctx->adata, ivsize,\n\t\t\t       ctx->authsize, false, false);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\treturn 0;\n}\n\nstatic int chachapoly_setauthsize(struct crypto_aead *aead,\n\t\t\t\t  unsigned int authsize)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\n\tif (authsize != POLY1305_DIGEST_SIZE)\n\t\treturn -EINVAL;\n\n\tctx->authsize = authsize;\n\treturn chachapoly_set_sh_desc(aead);\n}\n\nstatic int chachapoly_setkey(struct crypto_aead *aead, const u8 *key,\n\t\t\t     unsigned int keylen)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tunsigned int saltlen = CHACHAPOLY_IV_SIZE - ivsize;\n\n\tif (keylen != CHACHA_KEY_SIZE + saltlen)\n\t\treturn -EINVAL;\n\n\tmemcpy(ctx->key, key, keylen);\n\tctx->cdata.key_virt = ctx->key;\n\tctx->cdata.keylen = keylen - saltlen;\n\n\treturn chachapoly_set_sh_desc(aead);\n}\n\nstatic int aead_setkey(struct crypto_aead *aead,\n\t\t\t       const u8 *key, unsigned int keylen)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tstruct caam_drv_private *ctrlpriv = dev_get_drvdata(jrdev->parent);\n\tstruct crypto_authenc_keys keys;\n\tint ret = 0;\n\n\tif (crypto_authenc_extractkeys(&keys, key, keylen) != 0)\n\t\tgoto badkey;\n\n\tdev_dbg(jrdev, \"keylen %d enckeylen %d authkeylen %d\\n\",\n\t       keys.authkeylen + keys.enckeylen, keys.enckeylen,\n\t       keys.authkeylen);\n\tprint_hex_dump_debug(\"key in @\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, key, keylen, 1);\n\n\t \n\tif (ctrlpriv->era >= 6) {\n\t\tctx->adata.keylen = keys.authkeylen;\n\t\tctx->adata.keylen_pad = split_key_len(ctx->adata.algtype &\n\t\t\t\t\t\t      OP_ALG_ALGSEL_MASK);\n\n\t\tif (ctx->adata.keylen_pad + keys.enckeylen > CAAM_MAX_KEY_SIZE)\n\t\t\tgoto badkey;\n\n\t\tmemcpy(ctx->key, keys.authkey, keys.authkeylen);\n\t\tmemcpy(ctx->key + ctx->adata.keylen_pad, keys.enckey,\n\t\t       keys.enckeylen);\n\t\tdma_sync_single_for_device(jrdev, ctx->key_dma,\n\t\t\t\t\t   ctx->adata.keylen_pad +\n\t\t\t\t\t   keys.enckeylen, ctx->dir);\n\t\tgoto skip_split_key;\n\t}\n\n\tret = gen_split_key(ctx->jrdev, ctx->key, &ctx->adata, keys.authkey,\n\t\t\t    keys.authkeylen, CAAM_MAX_KEY_SIZE -\n\t\t\t    keys.enckeylen);\n\tif (ret) {\n\t\tgoto badkey;\n\t}\n\n\t \n\tmemcpy(ctx->key + ctx->adata.keylen_pad, keys.enckey, keys.enckeylen);\n\tdma_sync_single_for_device(jrdev, ctx->key_dma, ctx->adata.keylen_pad +\n\t\t\t\t   keys.enckeylen, ctx->dir);\n\n\tprint_hex_dump_debug(\"ctx.key@\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, ctx->key,\n\t\t\t     ctx->adata.keylen_pad + keys.enckeylen, 1);\n\nskip_split_key:\n\tctx->cdata.keylen = keys.enckeylen;\n\tmemzero_explicit(&keys, sizeof(keys));\n\treturn aead_set_sh_desc(aead);\nbadkey:\n\tmemzero_explicit(&keys, sizeof(keys));\n\treturn -EINVAL;\n}\n\nstatic int des3_aead_setkey(struct crypto_aead *aead, const u8 *key,\n\t\t\t    unsigned int keylen)\n{\n\tstruct crypto_authenc_keys keys;\n\tint err;\n\n\terr = crypto_authenc_extractkeys(&keys, key, keylen);\n\tif (unlikely(err))\n\t\treturn err;\n\n\terr = verify_aead_des3_key(aead, keys.enckey, keys.enckeylen) ?:\n\t      aead_setkey(aead, key, keylen);\n\n\tmemzero_explicit(&keys, sizeof(keys));\n\treturn err;\n}\n\nstatic int gcm_setkey(struct crypto_aead *aead,\n\t\t      const u8 *key, unsigned int keylen)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tint err;\n\n\terr = aes_check_keylen(keylen);\n\tif (err)\n\t\treturn err;\n\n\tprint_hex_dump_debug(\"key in @\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, key, keylen, 1);\n\n\tmemcpy(ctx->key, key, keylen);\n\tdma_sync_single_for_device(jrdev, ctx->key_dma, keylen, ctx->dir);\n\tctx->cdata.keylen = keylen;\n\n\treturn gcm_set_sh_desc(aead);\n}\n\nstatic int rfc4106_setkey(struct crypto_aead *aead,\n\t\t\t  const u8 *key, unsigned int keylen)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tint err;\n\n\terr = aes_check_keylen(keylen - 4);\n\tif (err)\n\t\treturn err;\n\n\tprint_hex_dump_debug(\"key in @\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, key, keylen, 1);\n\n\tmemcpy(ctx->key, key, keylen);\n\n\t \n\tctx->cdata.keylen = keylen - 4;\n\tdma_sync_single_for_device(jrdev, ctx->key_dma, ctx->cdata.keylen,\n\t\t\t\t   ctx->dir);\n\treturn rfc4106_set_sh_desc(aead);\n}\n\nstatic int rfc4543_setkey(struct crypto_aead *aead,\n\t\t\t  const u8 *key, unsigned int keylen)\n{\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tint err;\n\n\terr = aes_check_keylen(keylen - 4);\n\tif (err)\n\t\treturn err;\n\n\tprint_hex_dump_debug(\"key in @\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, key, keylen, 1);\n\n\tmemcpy(ctx->key, key, keylen);\n\n\t \n\tctx->cdata.keylen = keylen - 4;\n\tdma_sync_single_for_device(jrdev, ctx->key_dma, ctx->cdata.keylen,\n\t\t\t\t   ctx->dir);\n\treturn rfc4543_set_sh_desc(aead);\n}\n\nstatic int skcipher_setkey(struct crypto_skcipher *skcipher, const u8 *key,\n\t\t\t   unsigned int keylen, const u32 ctx1_iv_off)\n{\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(skcipher);\n\tstruct caam_skcipher_alg *alg =\n\t\tcontainer_of(crypto_skcipher_alg(skcipher), typeof(*alg),\n\t\t\t     skcipher.base);\n\tstruct device *jrdev = ctx->jrdev;\n\tunsigned int ivsize = crypto_skcipher_ivsize(skcipher);\n\tu32 *desc;\n\tconst bool is_rfc3686 = alg->caam.rfc3686;\n\n\tprint_hex_dump_debug(\"key in @\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, key, keylen, 1);\n\n\tctx->cdata.keylen = keylen;\n\tctx->cdata.key_virt = key;\n\tctx->cdata.key_inline = true;\n\n\t \n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_skcipher_encap(desc, &ctx->cdata, ivsize, is_rfc3686,\n\t\t\t\t   ctx1_iv_off);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\t \n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_skcipher_decap(desc, &ctx->cdata, ivsize, is_rfc3686,\n\t\t\t\t   ctx1_iv_off);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\treturn 0;\n}\n\nstatic int aes_skcipher_setkey(struct crypto_skcipher *skcipher,\n\t\t\t       const u8 *key, unsigned int keylen)\n{\n\tint err;\n\n\terr = aes_check_keylen(keylen);\n\tif (err)\n\t\treturn err;\n\n\treturn skcipher_setkey(skcipher, key, keylen, 0);\n}\n\nstatic int rfc3686_skcipher_setkey(struct crypto_skcipher *skcipher,\n\t\t\t\t   const u8 *key, unsigned int keylen)\n{\n\tu32 ctx1_iv_off;\n\tint err;\n\n\t \n\tctx1_iv_off = 16 + CTR_RFC3686_NONCE_SIZE;\n\tkeylen -= CTR_RFC3686_NONCE_SIZE;\n\n\terr = aes_check_keylen(keylen);\n\tif (err)\n\t\treturn err;\n\n\treturn skcipher_setkey(skcipher, key, keylen, ctx1_iv_off);\n}\n\nstatic int ctr_skcipher_setkey(struct crypto_skcipher *skcipher,\n\t\t\t       const u8 *key, unsigned int keylen)\n{\n\tu32 ctx1_iv_off;\n\tint err;\n\n\t \n\tctx1_iv_off = 16;\n\n\terr = aes_check_keylen(keylen);\n\tif (err)\n\t\treturn err;\n\n\treturn skcipher_setkey(skcipher, key, keylen, ctx1_iv_off);\n}\n\nstatic int des_skcipher_setkey(struct crypto_skcipher *skcipher,\n\t\t\t       const u8 *key, unsigned int keylen)\n{\n\treturn verify_skcipher_des_key(skcipher, key) ?:\n\t       skcipher_setkey(skcipher, key, keylen, 0);\n}\n\nstatic int des3_skcipher_setkey(struct crypto_skcipher *skcipher,\n\t\t\t\tconst u8 *key, unsigned int keylen)\n{\n\treturn verify_skcipher_des3_key(skcipher, key) ?:\n\t       skcipher_setkey(skcipher, key, keylen, 0);\n}\n\nstatic int xts_skcipher_setkey(struct crypto_skcipher *skcipher, const u8 *key,\n\t\t\t       unsigned int keylen)\n{\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(skcipher);\n\tstruct device *jrdev = ctx->jrdev;\n\tstruct caam_drv_private *ctrlpriv = dev_get_drvdata(jrdev->parent);\n\tu32 *desc;\n\tint err;\n\n\terr = xts_verify_key(skcipher, key, keylen);\n\tif (err) {\n\t\tdev_dbg(jrdev, \"key size mismatch\\n\");\n\t\treturn err;\n\t}\n\n\tif (keylen != 2 * AES_KEYSIZE_128 && keylen != 2 * AES_KEYSIZE_256)\n\t\tctx->xts_key_fallback = true;\n\n\tif (ctrlpriv->era <= 8 || ctx->xts_key_fallback) {\n\t\terr = crypto_skcipher_setkey(ctx->fallback, key, keylen);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tctx->cdata.keylen = keylen;\n\tctx->cdata.key_virt = key;\n\tctx->cdata.key_inline = true;\n\n\t \n\tdesc = ctx->sh_desc_enc;\n\tcnstr_shdsc_xts_skcipher_encap(desc, &ctx->cdata);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_enc_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\t \n\tdesc = ctx->sh_desc_dec;\n\tcnstr_shdsc_xts_skcipher_decap(desc, &ctx->cdata);\n\tdma_sync_single_for_device(jrdev, ctx->sh_desc_dec_dma,\n\t\t\t\t   desc_bytes(desc), ctx->dir);\n\n\treturn 0;\n}\n\n \nstruct aead_edesc {\n\tint src_nents;\n\tint dst_nents;\n\tint mapped_src_nents;\n\tint mapped_dst_nents;\n\tint sec4_sg_bytes;\n\tbool bklog;\n\tdma_addr_t sec4_sg_dma;\n\tstruct sec4_sg_entry *sec4_sg;\n\tu32 hw_desc[];\n};\n\n \nstruct skcipher_edesc {\n\tint src_nents;\n\tint dst_nents;\n\tint mapped_src_nents;\n\tint mapped_dst_nents;\n\tdma_addr_t iv_dma;\n\tint sec4_sg_bytes;\n\tbool bklog;\n\tdma_addr_t sec4_sg_dma;\n\tstruct sec4_sg_entry *sec4_sg;\n\tu32 hw_desc[];\n};\n\nstatic void caam_unmap(struct device *dev, struct scatterlist *src,\n\t\t       struct scatterlist *dst, int src_nents,\n\t\t       int dst_nents,\n\t\t       dma_addr_t iv_dma, int ivsize, dma_addr_t sec4_sg_dma,\n\t\t       int sec4_sg_bytes)\n{\n\tif (dst != src) {\n\t\tif (src_nents)\n\t\t\tdma_unmap_sg(dev, src, src_nents, DMA_TO_DEVICE);\n\t\tif (dst_nents)\n\t\t\tdma_unmap_sg(dev, dst, dst_nents, DMA_FROM_DEVICE);\n\t} else {\n\t\tdma_unmap_sg(dev, src, src_nents, DMA_BIDIRECTIONAL);\n\t}\n\n\tif (iv_dma)\n\t\tdma_unmap_single(dev, iv_dma, ivsize, DMA_BIDIRECTIONAL);\n\tif (sec4_sg_bytes)\n\t\tdma_unmap_single(dev, sec4_sg_dma, sec4_sg_bytes,\n\t\t\t\t DMA_TO_DEVICE);\n}\n\nstatic void aead_unmap(struct device *dev,\n\t\t       struct aead_edesc *edesc,\n\t\t       struct aead_request *req)\n{\n\tcaam_unmap(dev, req->src, req->dst,\n\t\t   edesc->src_nents, edesc->dst_nents, 0, 0,\n\t\t   edesc->sec4_sg_dma, edesc->sec4_sg_bytes);\n}\n\nstatic void skcipher_unmap(struct device *dev, struct skcipher_edesc *edesc,\n\t\t\t   struct skcipher_request *req)\n{\n\tstruct crypto_skcipher *skcipher = crypto_skcipher_reqtfm(req);\n\tint ivsize = crypto_skcipher_ivsize(skcipher);\n\n\tcaam_unmap(dev, req->src, req->dst,\n\t\t   edesc->src_nents, edesc->dst_nents,\n\t\t   edesc->iv_dma, ivsize,\n\t\t   edesc->sec4_sg_dma, edesc->sec4_sg_bytes);\n}\n\nstatic void aead_crypt_done(struct device *jrdev, u32 *desc, u32 err,\n\t\t\t    void *context)\n{\n\tstruct aead_request *req = context;\n\tstruct caam_aead_req_ctx *rctx = aead_request_ctx(req);\n\tstruct caam_drv_private_jr *jrp = dev_get_drvdata(jrdev);\n\tstruct aead_edesc *edesc;\n\tint ecode = 0;\n\tbool has_bklog;\n\n\tdev_dbg(jrdev, \"%s %d: err 0x%x\\n\", __func__, __LINE__, err);\n\n\tedesc = rctx->edesc;\n\thas_bklog = edesc->bklog;\n\n\tif (err)\n\t\tecode = caam_jr_strstatus(jrdev, err);\n\n\taead_unmap(jrdev, edesc, req);\n\n\tkfree(edesc);\n\n\t \n\tif (!has_bklog)\n\t\taead_request_complete(req, ecode);\n\telse\n\t\tcrypto_finalize_aead_request(jrp->engine, req, ecode);\n}\n\nstatic inline u8 *skcipher_edesc_iv(struct skcipher_edesc *edesc)\n{\n\n\treturn PTR_ALIGN((u8 *)edesc->sec4_sg + edesc->sec4_sg_bytes,\n\t\t\t dma_get_cache_alignment());\n}\n\nstatic void skcipher_crypt_done(struct device *jrdev, u32 *desc, u32 err,\n\t\t\t\tvoid *context)\n{\n\tstruct skcipher_request *req = context;\n\tstruct skcipher_edesc *edesc;\n\tstruct caam_skcipher_req_ctx *rctx = skcipher_request_ctx(req);\n\tstruct crypto_skcipher *skcipher = crypto_skcipher_reqtfm(req);\n\tstruct caam_drv_private_jr *jrp = dev_get_drvdata(jrdev);\n\tint ivsize = crypto_skcipher_ivsize(skcipher);\n\tint ecode = 0;\n\tbool has_bklog;\n\n\tdev_dbg(jrdev, \"%s %d: err 0x%x\\n\", __func__, __LINE__, err);\n\n\tedesc = rctx->edesc;\n\thas_bklog = edesc->bklog;\n\tif (err)\n\t\tecode = caam_jr_strstatus(jrdev, err);\n\n\tskcipher_unmap(jrdev, edesc, req);\n\n\t \n\tif (ivsize && !ecode) {\n\t\tmemcpy(req->iv, skcipher_edesc_iv(edesc), ivsize);\n\n\t\tprint_hex_dump_debug(\"dstiv  @\" __stringify(__LINE__)\": \",\n\t\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, req->iv,\n\t\t\t\t     ivsize, 1);\n\t}\n\n\tcaam_dump_sg(\"dst    @\" __stringify(__LINE__)\": \",\n\t\t     DUMP_PREFIX_ADDRESS, 16, 4, req->dst,\n\t\t     edesc->dst_nents > 1 ? 100 : req->cryptlen, 1);\n\n\tkfree(edesc);\n\n\t \n\tif (!has_bklog)\n\t\tskcipher_request_complete(req, ecode);\n\telse\n\t\tcrypto_finalize_skcipher_request(jrp->engine, req, ecode);\n}\n\n \nstatic void init_aead_job(struct aead_request *req,\n\t\t\t  struct aead_edesc *edesc,\n\t\t\t  bool all_contig, bool encrypt)\n{\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tint authsize = ctx->authsize;\n\tu32 *desc = edesc->hw_desc;\n\tu32 out_options, in_options;\n\tdma_addr_t dst_dma, src_dma;\n\tint len, sec4_sg_index = 0;\n\tdma_addr_t ptr;\n\tu32 *sh_desc;\n\n\tsh_desc = encrypt ? ctx->sh_desc_enc : ctx->sh_desc_dec;\n\tptr = encrypt ? ctx->sh_desc_enc_dma : ctx->sh_desc_dec_dma;\n\n\tlen = desc_len(sh_desc);\n\tinit_job_desc_shared(desc, ptr, len, HDR_SHARE_DEFER | HDR_REVERSE);\n\n\tif (all_contig) {\n\t\tsrc_dma = edesc->mapped_src_nents ? sg_dma_address(req->src) :\n\t\t\t\t\t\t    0;\n\t\tin_options = 0;\n\t} else {\n\t\tsrc_dma = edesc->sec4_sg_dma;\n\t\tsec4_sg_index += edesc->mapped_src_nents;\n\t\tin_options = LDST_SGF;\n\t}\n\n\tappend_seq_in_ptr(desc, src_dma, req->assoclen + req->cryptlen,\n\t\t\t  in_options);\n\n\tdst_dma = src_dma;\n\tout_options = in_options;\n\n\tif (unlikely(req->src != req->dst)) {\n\t\tif (!edesc->mapped_dst_nents) {\n\t\t\tdst_dma = 0;\n\t\t\tout_options = 0;\n\t\t} else if (edesc->mapped_dst_nents == 1) {\n\t\t\tdst_dma = sg_dma_address(req->dst);\n\t\t\tout_options = 0;\n\t\t} else {\n\t\t\tdst_dma = edesc->sec4_sg_dma +\n\t\t\t\t  sec4_sg_index *\n\t\t\t\t  sizeof(struct sec4_sg_entry);\n\t\t\tout_options = LDST_SGF;\n\t\t}\n\t}\n\n\tif (encrypt)\n\t\tappend_seq_out_ptr(desc, dst_dma,\n\t\t\t\t   req->assoclen + req->cryptlen + authsize,\n\t\t\t\t   out_options);\n\telse\n\t\tappend_seq_out_ptr(desc, dst_dma,\n\t\t\t\t   req->assoclen + req->cryptlen - authsize,\n\t\t\t\t   out_options);\n}\n\nstatic void init_gcm_job(struct aead_request *req,\n\t\t\t struct aead_edesc *edesc,\n\t\t\t bool all_contig, bool encrypt)\n{\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tu32 *desc = edesc->hw_desc;\n\tbool generic_gcm = (ivsize == GCM_AES_IV_SIZE);\n\tunsigned int last;\n\n\tinit_aead_job(req, edesc, all_contig, encrypt);\n\tappend_math_add_imm_u32(desc, REG3, ZERO, IMM, req->assoclen);\n\n\t \n\tlast = 0;\n\tif (encrypt && generic_gcm && !(req->assoclen + req->cryptlen))\n\t\tlast = FIFOLD_TYPE_LAST1;\n\n\t \n\tappend_cmd(desc, CMD_FIFO_LOAD | FIFOLD_CLASS_CLASS1 | IMMEDIATE |\n\t\t\t FIFOLD_TYPE_IV | FIFOLD_TYPE_FLUSH1 | GCM_AES_IV_SIZE | last);\n\t \n\tif (!generic_gcm)\n\t\tappend_data(desc, ctx->key + ctx->cdata.keylen, 4);\n\t \n\tappend_data(desc, req->iv, ivsize);\n\t \n}\n\nstatic void init_chachapoly_job(struct aead_request *req,\n\t\t\t\tstruct aead_edesc *edesc, bool all_contig,\n\t\t\t\tbool encrypt)\n{\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tunsigned int assoclen = req->assoclen;\n\tu32 *desc = edesc->hw_desc;\n\tu32 ctx_iv_off = 4;\n\n\tinit_aead_job(req, edesc, all_contig, encrypt);\n\n\tif (ivsize != CHACHAPOLY_IV_SIZE) {\n\t\t \n\t\tctx_iv_off += 4;\n\n\t\t \n\t\tassoclen -= ivsize;\n\t}\n\n\tappend_math_add_imm_u32(desc, REG3, ZERO, IMM, assoclen);\n\n\t \n\tappend_load_as_imm(desc, req->iv, ivsize, LDST_CLASS_1_CCB |\n\t\t\t   LDST_SRCDST_BYTE_CONTEXT |\n\t\t\t   ctx_iv_off << LDST_OFFSET_SHIFT);\n}\n\nstatic void init_authenc_job(struct aead_request *req,\n\t\t\t     struct aead_edesc *edesc,\n\t\t\t     bool all_contig, bool encrypt)\n{\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tstruct caam_aead_alg *alg = container_of(crypto_aead_alg(aead),\n\t\t\t\t\t\t struct caam_aead_alg,\n\t\t\t\t\t\t aead.base);\n\tunsigned int ivsize = crypto_aead_ivsize(aead);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct caam_drv_private *ctrlpriv = dev_get_drvdata(ctx->jrdev->parent);\n\tconst bool ctr_mode = ((ctx->cdata.algtype & OP_ALG_AAI_MASK) ==\n\t\t\t       OP_ALG_AAI_CTR_MOD128);\n\tconst bool is_rfc3686 = alg->caam.rfc3686;\n\tu32 *desc = edesc->hw_desc;\n\tu32 ivoffset = 0;\n\n\t \n\tif (ctr_mode)\n\t\tivoffset = 16;\n\n\t \n\tif (is_rfc3686)\n\t\tivoffset = 16 + CTR_RFC3686_NONCE_SIZE;\n\n\tinit_aead_job(req, edesc, all_contig, encrypt);\n\n\t \n\tif (ctrlpriv->era < 3)\n\t\tappend_math_add_imm_u32(desc, REG3, ZERO, IMM, req->assoclen);\n\telse\n\t\tappend_math_add_imm_u32(desc, DPOVRD, ZERO, IMM, req->assoclen);\n\n\tif (ivsize && ((is_rfc3686 && encrypt) || !alg->caam.geniv))\n\t\tappend_load_as_imm(desc, req->iv, ivsize,\n\t\t\t\t   LDST_CLASS_1_CCB |\n\t\t\t\t   LDST_SRCDST_BYTE_CONTEXT |\n\t\t\t\t   (ivoffset << LDST_OFFSET_SHIFT));\n}\n\n \nstatic void init_skcipher_job(struct skcipher_request *req,\n\t\t\t      struct skcipher_edesc *edesc,\n\t\t\t      const bool encrypt)\n{\n\tstruct crypto_skcipher *skcipher = crypto_skcipher_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(skcipher);\n\tstruct device *jrdev = ctx->jrdev;\n\tint ivsize = crypto_skcipher_ivsize(skcipher);\n\tu32 *desc = edesc->hw_desc;\n\tu32 *sh_desc;\n\tu32 in_options = 0, out_options = 0;\n\tdma_addr_t src_dma, dst_dma, ptr;\n\tint len, sec4_sg_index = 0;\n\n\tprint_hex_dump_debug(\"presciv@\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, req->iv, ivsize, 1);\n\tdev_dbg(jrdev, \"asked=%d, cryptlen%d\\n\",\n\t       (int)edesc->src_nents > 1 ? 100 : req->cryptlen, req->cryptlen);\n\n\tcaam_dump_sg(\"src    @\" __stringify(__LINE__)\": \",\n\t\t     DUMP_PREFIX_ADDRESS, 16, 4, req->src,\n\t\t     edesc->src_nents > 1 ? 100 : req->cryptlen, 1);\n\n\tsh_desc = encrypt ? ctx->sh_desc_enc : ctx->sh_desc_dec;\n\tptr = encrypt ? ctx->sh_desc_enc_dma : ctx->sh_desc_dec_dma;\n\n\tlen = desc_len(sh_desc);\n\tinit_job_desc_shared(desc, ptr, len, HDR_SHARE_DEFER | HDR_REVERSE);\n\n\tif (ivsize || edesc->mapped_src_nents > 1) {\n\t\tsrc_dma = edesc->sec4_sg_dma;\n\t\tsec4_sg_index = edesc->mapped_src_nents + !!ivsize;\n\t\tin_options = LDST_SGF;\n\t} else {\n\t\tsrc_dma = sg_dma_address(req->src);\n\t}\n\n\tappend_seq_in_ptr(desc, src_dma, req->cryptlen + ivsize, in_options);\n\n\tif (likely(req->src == req->dst)) {\n\t\tdst_dma = src_dma + !!ivsize * sizeof(struct sec4_sg_entry);\n\t\tout_options = in_options;\n\t} else if (!ivsize && edesc->mapped_dst_nents == 1) {\n\t\tdst_dma = sg_dma_address(req->dst);\n\t} else {\n\t\tdst_dma = edesc->sec4_sg_dma + sec4_sg_index *\n\t\t\t  sizeof(struct sec4_sg_entry);\n\t\tout_options = LDST_SGF;\n\t}\n\n\tappend_seq_out_ptr(desc, dst_dma, req->cryptlen + ivsize, out_options);\n}\n\n \nstatic struct aead_edesc *aead_edesc_alloc(struct aead_request *req,\n\t\t\t\t\t   int desc_bytes, bool *all_contig_ptr,\n\t\t\t\t\t   bool encrypt)\n{\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tstruct caam_aead_req_ctx *rctx = aead_request_ctx(req);\n\tgfp_t flags = (req->base.flags & CRYPTO_TFM_REQ_MAY_SLEEP) ?\n\t\t       GFP_KERNEL : GFP_ATOMIC;\n\tint src_nents, mapped_src_nents, dst_nents = 0, mapped_dst_nents = 0;\n\tint src_len, dst_len = 0;\n\tstruct aead_edesc *edesc;\n\tint sec4_sg_index, sec4_sg_len, sec4_sg_bytes;\n\tunsigned int authsize = ctx->authsize;\n\n\tif (unlikely(req->dst != req->src)) {\n\t\tsrc_len = req->assoclen + req->cryptlen;\n\t\tdst_len = src_len + (encrypt ? authsize : (-authsize));\n\n\t\tsrc_nents = sg_nents_for_len(req->src, src_len);\n\t\tif (unlikely(src_nents < 0)) {\n\t\t\tdev_err(jrdev, \"Insufficient bytes (%d) in src S/G\\n\",\n\t\t\t\tsrc_len);\n\t\t\treturn ERR_PTR(src_nents);\n\t\t}\n\n\t\tdst_nents = sg_nents_for_len(req->dst, dst_len);\n\t\tif (unlikely(dst_nents < 0)) {\n\t\t\tdev_err(jrdev, \"Insufficient bytes (%d) in dst S/G\\n\",\n\t\t\t\tdst_len);\n\t\t\treturn ERR_PTR(dst_nents);\n\t\t}\n\t} else {\n\t\tsrc_len = req->assoclen + req->cryptlen +\n\t\t\t  (encrypt ? authsize : 0);\n\n\t\tsrc_nents = sg_nents_for_len(req->src, src_len);\n\t\tif (unlikely(src_nents < 0)) {\n\t\t\tdev_err(jrdev, \"Insufficient bytes (%d) in src S/G\\n\",\n\t\t\t\tsrc_len);\n\t\t\treturn ERR_PTR(src_nents);\n\t\t}\n\t}\n\n\tif (likely(req->src == req->dst)) {\n\t\tmapped_src_nents = dma_map_sg(jrdev, req->src, src_nents,\n\t\t\t\t\t      DMA_BIDIRECTIONAL);\n\t\tif (unlikely(!mapped_src_nents)) {\n\t\t\tdev_err(jrdev, \"unable to map source\\n\");\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t}\n\t} else {\n\t\t \n\t\tif (src_nents) {\n\t\t\tmapped_src_nents = dma_map_sg(jrdev, req->src,\n\t\t\t\t\t\t      src_nents, DMA_TO_DEVICE);\n\t\t\tif (unlikely(!mapped_src_nents)) {\n\t\t\t\tdev_err(jrdev, \"unable to map source\\n\");\n\t\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t\t}\n\t\t} else {\n\t\t\tmapped_src_nents = 0;\n\t\t}\n\n\t\t \n\t\tif (dst_nents) {\n\t\t\tmapped_dst_nents = dma_map_sg(jrdev, req->dst,\n\t\t\t\t\t\t      dst_nents,\n\t\t\t\t\t\t      DMA_FROM_DEVICE);\n\t\t\tif (unlikely(!mapped_dst_nents)) {\n\t\t\t\tdev_err(jrdev, \"unable to map destination\\n\");\n\t\t\t\tdma_unmap_sg(jrdev, req->src, src_nents,\n\t\t\t\t\t     DMA_TO_DEVICE);\n\t\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t\t}\n\t\t} else {\n\t\t\tmapped_dst_nents = 0;\n\t\t}\n\t}\n\n\t \n\tsec4_sg_len = mapped_src_nents > 1 ? mapped_src_nents : 0;\n\tif (mapped_dst_nents > 1)\n\t\tsec4_sg_len += pad_sg_nents(mapped_dst_nents);\n\telse\n\t\tsec4_sg_len = pad_sg_nents(sec4_sg_len);\n\n\tsec4_sg_bytes = sec4_sg_len * sizeof(struct sec4_sg_entry);\n\n\t \n\tedesc = kzalloc(sizeof(*edesc) + desc_bytes + sec4_sg_bytes, flags);\n\tif (!edesc) {\n\t\tcaam_unmap(jrdev, req->src, req->dst, src_nents, dst_nents, 0,\n\t\t\t   0, 0, 0);\n\t\treturn ERR_PTR(-ENOMEM);\n\t}\n\n\tedesc->src_nents = src_nents;\n\tedesc->dst_nents = dst_nents;\n\tedesc->mapped_src_nents = mapped_src_nents;\n\tedesc->mapped_dst_nents = mapped_dst_nents;\n\tedesc->sec4_sg = (void *)edesc + sizeof(struct aead_edesc) +\n\t\t\t desc_bytes;\n\n\trctx->edesc = edesc;\n\n\t*all_contig_ptr = !(mapped_src_nents > 1);\n\n\tsec4_sg_index = 0;\n\tif (mapped_src_nents > 1) {\n\t\tsg_to_sec4_sg_last(req->src, src_len,\n\t\t\t\t   edesc->sec4_sg + sec4_sg_index, 0);\n\t\tsec4_sg_index += mapped_src_nents;\n\t}\n\tif (mapped_dst_nents > 1) {\n\t\tsg_to_sec4_sg_last(req->dst, dst_len,\n\t\t\t\t   edesc->sec4_sg + sec4_sg_index, 0);\n\t}\n\n\tif (!sec4_sg_bytes)\n\t\treturn edesc;\n\n\tedesc->sec4_sg_dma = dma_map_single(jrdev, edesc->sec4_sg,\n\t\t\t\t\t    sec4_sg_bytes, DMA_TO_DEVICE);\n\tif (dma_mapping_error(jrdev, edesc->sec4_sg_dma)) {\n\t\tdev_err(jrdev, \"unable to map S/G table\\n\");\n\t\taead_unmap(jrdev, edesc, req);\n\t\tkfree(edesc);\n\t\treturn ERR_PTR(-ENOMEM);\n\t}\n\n\tedesc->sec4_sg_bytes = sec4_sg_bytes;\n\n\treturn edesc;\n}\n\nstatic int aead_enqueue_req(struct device *jrdev, struct aead_request *req)\n{\n\tstruct caam_drv_private_jr *jrpriv = dev_get_drvdata(jrdev);\n\tstruct caam_aead_req_ctx *rctx = aead_request_ctx(req);\n\tstruct aead_edesc *edesc = rctx->edesc;\n\tu32 *desc = edesc->hw_desc;\n\tint ret;\n\n\t \n\tif (req->base.flags & CRYPTO_TFM_REQ_MAY_BACKLOG)\n\t\tret = crypto_transfer_aead_request_to_engine(jrpriv->engine,\n\t\t\t\t\t\t\t     req);\n\telse\n\t\tret = caam_jr_enqueue(jrdev, desc, aead_crypt_done, req);\n\n\tif ((ret != -EINPROGRESS) && (ret != -EBUSY)) {\n\t\taead_unmap(jrdev, edesc, req);\n\t\tkfree(rctx->edesc);\n\t}\n\n\treturn ret;\n}\n\nstatic inline int chachapoly_crypt(struct aead_request *req, bool encrypt)\n{\n\tstruct aead_edesc *edesc;\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tbool all_contig;\n\tu32 *desc;\n\n\tedesc = aead_edesc_alloc(req, CHACHAPOLY_DESC_JOB_IO_LEN, &all_contig,\n\t\t\t\t encrypt);\n\tif (IS_ERR(edesc))\n\t\treturn PTR_ERR(edesc);\n\n\tdesc = edesc->hw_desc;\n\n\tinit_chachapoly_job(req, edesc, all_contig, encrypt);\n\tprint_hex_dump_debug(\"chachapoly jobdesc@\" __stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, desc, desc_bytes(desc),\n\t\t\t     1);\n\n\treturn aead_enqueue_req(jrdev, req);\n}\n\nstatic int chachapoly_encrypt(struct aead_request *req)\n{\n\treturn chachapoly_crypt(req, true);\n}\n\nstatic int chachapoly_decrypt(struct aead_request *req)\n{\n\treturn chachapoly_crypt(req, false);\n}\n\nstatic inline int aead_crypt(struct aead_request *req, bool encrypt)\n{\n\tstruct aead_edesc *edesc;\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tbool all_contig;\n\n\t \n\tedesc = aead_edesc_alloc(req, AUTHENC_DESC_JOB_IO_LEN,\n\t\t\t\t &all_contig, encrypt);\n\tif (IS_ERR(edesc))\n\t\treturn PTR_ERR(edesc);\n\n\t \n\tinit_authenc_job(req, edesc, all_contig, encrypt);\n\n\tprint_hex_dump_debug(\"aead jobdesc@\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, edesc->hw_desc,\n\t\t\t     desc_bytes(edesc->hw_desc), 1);\n\n\treturn aead_enqueue_req(jrdev, req);\n}\n\nstatic int aead_encrypt(struct aead_request *req)\n{\n\treturn aead_crypt(req, true);\n}\n\nstatic int aead_decrypt(struct aead_request *req)\n{\n\treturn aead_crypt(req, false);\n}\n\nstatic int aead_do_one_req(struct crypto_engine *engine, void *areq)\n{\n\tstruct aead_request *req = aead_request_cast(areq);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(crypto_aead_reqtfm(req));\n\tstruct caam_aead_req_ctx *rctx = aead_request_ctx(req);\n\tu32 *desc = rctx->edesc->hw_desc;\n\tint ret;\n\n\trctx->edesc->bklog = true;\n\n\tret = caam_jr_enqueue(ctx->jrdev, desc, aead_crypt_done, req);\n\n\tif (ret == -ENOSPC && engine->retry_support)\n\t\treturn ret;\n\n\tif (ret != -EINPROGRESS) {\n\t\taead_unmap(ctx->jrdev, rctx->edesc, req);\n\t\tkfree(rctx->edesc);\n\t} else {\n\t\tret = 0;\n\t}\n\n\treturn ret;\n}\n\nstatic inline int gcm_crypt(struct aead_request *req, bool encrypt)\n{\n\tstruct aead_edesc *edesc;\n\tstruct crypto_aead *aead = crypto_aead_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(aead);\n\tstruct device *jrdev = ctx->jrdev;\n\tbool all_contig;\n\n\t \n\tedesc = aead_edesc_alloc(req, GCM_DESC_JOB_IO_LEN, &all_contig,\n\t\t\t\t encrypt);\n\tif (IS_ERR(edesc))\n\t\treturn PTR_ERR(edesc);\n\n\t \n\tinit_gcm_job(req, edesc, all_contig, encrypt);\n\n\tprint_hex_dump_debug(\"aead jobdesc@\"__stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, edesc->hw_desc,\n\t\t\t     desc_bytes(edesc->hw_desc), 1);\n\n\treturn aead_enqueue_req(jrdev, req);\n}\n\nstatic int gcm_encrypt(struct aead_request *req)\n{\n\treturn gcm_crypt(req, true);\n}\n\nstatic int gcm_decrypt(struct aead_request *req)\n{\n\treturn gcm_crypt(req, false);\n}\n\nstatic int ipsec_gcm_encrypt(struct aead_request *req)\n{\n\treturn crypto_ipsec_check_assoclen(req->assoclen) ? : gcm_encrypt(req);\n}\n\nstatic int ipsec_gcm_decrypt(struct aead_request *req)\n{\n\treturn crypto_ipsec_check_assoclen(req->assoclen) ? : gcm_decrypt(req);\n}\n\n \nstatic struct skcipher_edesc *skcipher_edesc_alloc(struct skcipher_request *req,\n\t\t\t\t\t\t   int desc_bytes)\n{\n\tstruct crypto_skcipher *skcipher = crypto_skcipher_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(skcipher);\n\tstruct caam_skcipher_req_ctx *rctx = skcipher_request_ctx(req);\n\tstruct device *jrdev = ctx->jrdev;\n\tgfp_t flags = (req->base.flags & CRYPTO_TFM_REQ_MAY_SLEEP) ?\n\t\t       GFP_KERNEL : GFP_ATOMIC;\n\tint src_nents, mapped_src_nents, dst_nents = 0, mapped_dst_nents = 0;\n\tstruct skcipher_edesc *edesc;\n\tdma_addr_t iv_dma = 0;\n\tu8 *iv;\n\tint ivsize = crypto_skcipher_ivsize(skcipher);\n\tint dst_sg_idx, sec4_sg_ents, sec4_sg_bytes;\n\tunsigned int aligned_size;\n\n\tsrc_nents = sg_nents_for_len(req->src, req->cryptlen);\n\tif (unlikely(src_nents < 0)) {\n\t\tdev_err(jrdev, \"Insufficient bytes (%d) in src S/G\\n\",\n\t\t\treq->cryptlen);\n\t\treturn ERR_PTR(src_nents);\n\t}\n\n\tif (req->dst != req->src) {\n\t\tdst_nents = sg_nents_for_len(req->dst, req->cryptlen);\n\t\tif (unlikely(dst_nents < 0)) {\n\t\t\tdev_err(jrdev, \"Insufficient bytes (%d) in dst S/G\\n\",\n\t\t\t\treq->cryptlen);\n\t\t\treturn ERR_PTR(dst_nents);\n\t\t}\n\t}\n\n\tif (likely(req->src == req->dst)) {\n\t\tmapped_src_nents = dma_map_sg(jrdev, req->src, src_nents,\n\t\t\t\t\t      DMA_BIDIRECTIONAL);\n\t\tif (unlikely(!mapped_src_nents)) {\n\t\t\tdev_err(jrdev, \"unable to map source\\n\");\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t}\n\t} else {\n\t\tmapped_src_nents = dma_map_sg(jrdev, req->src, src_nents,\n\t\t\t\t\t      DMA_TO_DEVICE);\n\t\tif (unlikely(!mapped_src_nents)) {\n\t\t\tdev_err(jrdev, \"unable to map source\\n\");\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t}\n\t\tmapped_dst_nents = dma_map_sg(jrdev, req->dst, dst_nents,\n\t\t\t\t\t      DMA_FROM_DEVICE);\n\t\tif (unlikely(!mapped_dst_nents)) {\n\t\t\tdev_err(jrdev, \"unable to map destination\\n\");\n\t\t\tdma_unmap_sg(jrdev, req->src, src_nents, DMA_TO_DEVICE);\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t}\n\t}\n\n\tif (!ivsize && mapped_src_nents == 1)\n\t\tsec4_sg_ents = 0;  \n\telse\n\t\tsec4_sg_ents = mapped_src_nents + !!ivsize;\n\tdst_sg_idx = sec4_sg_ents;\n\n\t \n\tif (ivsize || mapped_dst_nents > 1) {\n\t\tif (req->src == req->dst)\n\t\t\tsec4_sg_ents = !!ivsize + pad_sg_nents(sec4_sg_ents);\n\t\telse\n\t\t\tsec4_sg_ents += pad_sg_nents(mapped_dst_nents +\n\t\t\t\t\t\t     !!ivsize);\n\t} else {\n\t\tsec4_sg_ents = pad_sg_nents(sec4_sg_ents);\n\t}\n\n\tsec4_sg_bytes = sec4_sg_ents * sizeof(struct sec4_sg_entry);\n\n\t \n\taligned_size = sizeof(*edesc) + desc_bytes + sec4_sg_bytes;\n\taligned_size = ALIGN(aligned_size, dma_get_cache_alignment());\n\taligned_size += ~(ARCH_KMALLOC_MINALIGN - 1) &\n\t\t\t(dma_get_cache_alignment() - 1);\n\taligned_size += ALIGN(ivsize, dma_get_cache_alignment());\n\tedesc = kzalloc(aligned_size, flags);\n\tif (!edesc) {\n\t\tdev_err(jrdev, \"could not allocate extended descriptor\\n\");\n\t\tcaam_unmap(jrdev, req->src, req->dst, src_nents, dst_nents, 0,\n\t\t\t   0, 0, 0);\n\t\treturn ERR_PTR(-ENOMEM);\n\t}\n\n\tedesc->src_nents = src_nents;\n\tedesc->dst_nents = dst_nents;\n\tedesc->mapped_src_nents = mapped_src_nents;\n\tedesc->mapped_dst_nents = mapped_dst_nents;\n\tedesc->sec4_sg_bytes = sec4_sg_bytes;\n\tedesc->sec4_sg = (struct sec4_sg_entry *)((u8 *)edesc->hw_desc +\n\t\t\t\t\t\t  desc_bytes);\n\trctx->edesc = edesc;\n\n\t \n\tif (ivsize) {\n\t\tiv = skcipher_edesc_iv(edesc);\n\t\tmemcpy(iv, req->iv, ivsize);\n\n\t\tiv_dma = dma_map_single(jrdev, iv, ivsize, DMA_BIDIRECTIONAL);\n\t\tif (dma_mapping_error(jrdev, iv_dma)) {\n\t\t\tdev_err(jrdev, \"unable to map IV\\n\");\n\t\t\tcaam_unmap(jrdev, req->src, req->dst, src_nents,\n\t\t\t\t   dst_nents, 0, 0, 0, 0);\n\t\t\tkfree(edesc);\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t}\n\n\t\tdma_to_sec4_sg_one(edesc->sec4_sg, iv_dma, ivsize, 0);\n\t}\n\tif (dst_sg_idx)\n\t\tsg_to_sec4_sg(req->src, req->cryptlen, edesc->sec4_sg +\n\t\t\t      !!ivsize, 0);\n\n\tif (req->src != req->dst && (ivsize || mapped_dst_nents > 1))\n\t\tsg_to_sec4_sg(req->dst, req->cryptlen, edesc->sec4_sg +\n\t\t\t      dst_sg_idx, 0);\n\n\tif (ivsize)\n\t\tdma_to_sec4_sg_one(edesc->sec4_sg + dst_sg_idx +\n\t\t\t\t   mapped_dst_nents, iv_dma, ivsize, 0);\n\n\tif (ivsize || mapped_dst_nents > 1)\n\t\tsg_to_sec4_set_last(edesc->sec4_sg + dst_sg_idx +\n\t\t\t\t    mapped_dst_nents - 1 + !!ivsize);\n\n\tif (sec4_sg_bytes) {\n\t\tedesc->sec4_sg_dma = dma_map_single(jrdev, edesc->sec4_sg,\n\t\t\t\t\t\t    sec4_sg_bytes,\n\t\t\t\t\t\t    DMA_TO_DEVICE);\n\t\tif (dma_mapping_error(jrdev, edesc->sec4_sg_dma)) {\n\t\t\tdev_err(jrdev, \"unable to map S/G table\\n\");\n\t\t\tcaam_unmap(jrdev, req->src, req->dst, src_nents,\n\t\t\t\t   dst_nents, iv_dma, ivsize, 0, 0);\n\t\t\tkfree(edesc);\n\t\t\treturn ERR_PTR(-ENOMEM);\n\t\t}\n\t}\n\n\tedesc->iv_dma = iv_dma;\n\n\tprint_hex_dump_debug(\"skcipher sec4_sg@\" __stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, edesc->sec4_sg,\n\t\t\t     sec4_sg_bytes, 1);\n\n\treturn edesc;\n}\n\nstatic int skcipher_do_one_req(struct crypto_engine *engine, void *areq)\n{\n\tstruct skcipher_request *req = skcipher_request_cast(areq);\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(crypto_skcipher_reqtfm(req));\n\tstruct caam_skcipher_req_ctx *rctx = skcipher_request_ctx(req);\n\tu32 *desc = rctx->edesc->hw_desc;\n\tint ret;\n\n\trctx->edesc->bklog = true;\n\n\tret = caam_jr_enqueue(ctx->jrdev, desc, skcipher_crypt_done, req);\n\n\tif (ret == -ENOSPC && engine->retry_support)\n\t\treturn ret;\n\n\tif (ret != -EINPROGRESS) {\n\t\tskcipher_unmap(ctx->jrdev, rctx->edesc, req);\n\t\tkfree(rctx->edesc);\n\t} else {\n\t\tret = 0;\n\t}\n\n\treturn ret;\n}\n\nstatic inline bool xts_skcipher_ivsize(struct skcipher_request *req)\n{\n\tstruct crypto_skcipher *skcipher = crypto_skcipher_reqtfm(req);\n\tunsigned int ivsize = crypto_skcipher_ivsize(skcipher);\n\n\treturn !!get_unaligned((u64 *)(req->iv + (ivsize / 2)));\n}\n\nstatic inline int skcipher_crypt(struct skcipher_request *req, bool encrypt)\n{\n\tstruct skcipher_edesc *edesc;\n\tstruct crypto_skcipher *skcipher = crypto_skcipher_reqtfm(req);\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(skcipher);\n\tstruct device *jrdev = ctx->jrdev;\n\tstruct caam_drv_private_jr *jrpriv = dev_get_drvdata(jrdev);\n\tstruct caam_drv_private *ctrlpriv = dev_get_drvdata(jrdev->parent);\n\tu32 *desc;\n\tint ret = 0;\n\n\t \n\tif (!req->cryptlen && !ctx->fallback)\n\t\treturn 0;\n\n\tif (ctx->fallback && ((ctrlpriv->era <= 8 && xts_skcipher_ivsize(req)) ||\n\t\t\t      ctx->xts_key_fallback)) {\n\t\tstruct caam_skcipher_req_ctx *rctx = skcipher_request_ctx(req);\n\n\t\tskcipher_request_set_tfm(&rctx->fallback_req, ctx->fallback);\n\t\tskcipher_request_set_callback(&rctx->fallback_req,\n\t\t\t\t\t      req->base.flags,\n\t\t\t\t\t      req->base.complete,\n\t\t\t\t\t      req->base.data);\n\t\tskcipher_request_set_crypt(&rctx->fallback_req, req->src,\n\t\t\t\t\t   req->dst, req->cryptlen, req->iv);\n\n\t\treturn encrypt ? crypto_skcipher_encrypt(&rctx->fallback_req) :\n\t\t\t\t crypto_skcipher_decrypt(&rctx->fallback_req);\n\t}\n\n\t \n\tedesc = skcipher_edesc_alloc(req, DESC_JOB_IO_LEN * CAAM_CMD_SZ);\n\tif (IS_ERR(edesc))\n\t\treturn PTR_ERR(edesc);\n\n\t \n\tinit_skcipher_job(req, edesc, encrypt);\n\n\tprint_hex_dump_debug(\"skcipher jobdesc@\" __stringify(__LINE__)\": \",\n\t\t\t     DUMP_PREFIX_ADDRESS, 16, 4, edesc->hw_desc,\n\t\t\t     desc_bytes(edesc->hw_desc), 1);\n\n\tdesc = edesc->hw_desc;\n\t \n\tif (req->base.flags & CRYPTO_TFM_REQ_MAY_BACKLOG)\n\t\tret = crypto_transfer_skcipher_request_to_engine(jrpriv->engine,\n\t\t\t\t\t\t\t\t req);\n\telse\n\t\tret = caam_jr_enqueue(jrdev, desc, skcipher_crypt_done, req);\n\n\tif ((ret != -EINPROGRESS) && (ret != -EBUSY)) {\n\t\tskcipher_unmap(jrdev, edesc, req);\n\t\tkfree(edesc);\n\t}\n\n\treturn ret;\n}\n\nstatic int skcipher_encrypt(struct skcipher_request *req)\n{\n\treturn skcipher_crypt(req, true);\n}\n\nstatic int skcipher_decrypt(struct skcipher_request *req)\n{\n\treturn skcipher_crypt(req, false);\n}\n\nstatic struct caam_skcipher_alg driver_algs[] = {\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"cbc(aes)\",\n\t\t\t\t.cra_driver_name = \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aes_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = AES_MIN_KEY_SIZE,\n\t\t\t.max_keysize = AES_MAX_KEY_SIZE,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"cbc(des3_ede)\",\n\t\t\t\t.cra_driver_name = \"cbc-3des-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = DES3_EDE_KEY_SIZE,\n\t\t\t.max_keysize = DES3_EDE_KEY_SIZE,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"cbc(des)\",\n\t\t\t\t.cra_driver_name = \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = DES_KEY_SIZE,\n\t\t\t.max_keysize = DES_KEY_SIZE,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"ctr(aes)\",\n\t\t\t\t.cra_driver_name = \"ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = ctr_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = AES_MIN_KEY_SIZE,\n\t\t\t.max_keysize = AES_MAX_KEY_SIZE,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.chunksize = AES_BLOCK_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\tOP_ALG_AAI_CTR_MOD128,\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"rfc3686(ctr(aes))\",\n\t\t\t\t.cra_driver_name = \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = rfc3686_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = AES_MIN_KEY_SIZE +\n\t\t\t\t       CTR_RFC3686_NONCE_SIZE,\n\t\t\t.max_keysize = AES_MAX_KEY_SIZE +\n\t\t\t\t       CTR_RFC3686_NONCE_SIZE,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.chunksize = AES_BLOCK_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.rfc3686 = true,\n\t\t},\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"xts(aes)\",\n\t\t\t\t.cra_driver_name = \"xts-aes-caam\",\n\t\t\t\t.cra_flags = CRYPTO_ALG_NEED_FALLBACK,\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = xts_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = 2 * AES_MIN_KEY_SIZE,\n\t\t\t.max_keysize = 2 * AES_MAX_KEY_SIZE,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_XTS,\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"ecb(des)\",\n\t\t\t\t.cra_driver_name = \"ecb-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = DES_KEY_SIZE,\n\t\t\t.max_keysize = DES_KEY_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_ECB,\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"ecb(aes)\",\n\t\t\t\t.cra_driver_name = \"ecb-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aes_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = AES_MIN_KEY_SIZE,\n\t\t\t.max_keysize = AES_MAX_KEY_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_ECB,\n\t},\n\t{\n\t\t.skcipher.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"ecb(des3_ede)\",\n\t\t\t\t.cra_driver_name = \"ecb-des3-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_skcipher_setkey,\n\t\t\t.encrypt = skcipher_encrypt,\n\t\t\t.decrypt = skcipher_decrypt,\n\t\t\t.min_keysize = DES3_EDE_KEY_SIZE,\n\t\t\t.max_keysize = DES3_EDE_KEY_SIZE,\n\t\t},\n\t\t.skcipher.op = {\n\t\t\t.do_one_request = skcipher_do_one_req,\n\t\t},\n\t\t.caam.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_ECB,\n\t},\n};\n\nstatic struct caam_aead_alg driver_aeads[] = {\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"rfc4106(gcm(aes))\",\n\t\t\t\t.cra_driver_name = \"rfc4106-gcm-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = rfc4106_setkey,\n\t\t\t.setauthsize = rfc4106_setauthsize,\n\t\t\t.encrypt = ipsec_gcm_encrypt,\n\t\t\t.decrypt = ipsec_gcm_decrypt,\n\t\t\t.ivsize = GCM_RFC4106_IV_SIZE,\n\t\t\t.maxauthsize = AES_BLOCK_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_GCM,\n\t\t\t.nodkp = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"rfc4543(gcm(aes))\",\n\t\t\t\t.cra_driver_name = \"rfc4543-gcm-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = rfc4543_setkey,\n\t\t\t.setauthsize = rfc4543_setauthsize,\n\t\t\t.encrypt = ipsec_gcm_encrypt,\n\t\t\t.decrypt = ipsec_gcm_decrypt,\n\t\t\t.ivsize = GCM_RFC4543_IV_SIZE,\n\t\t\t.maxauthsize = AES_BLOCK_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_GCM,\n\t\t\t.nodkp = true,\n\t\t},\n\t},\n\t \n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"gcm(aes)\",\n\t\t\t\t.cra_driver_name = \"gcm-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = gcm_setkey,\n\t\t\t.setauthsize = gcm_setauthsize,\n\t\t\t.encrypt = gcm_encrypt,\n\t\t\t.decrypt = gcm_decrypt,\n\t\t\t.ivsize = GCM_AES_IV_SIZE,\n\t\t\t.maxauthsize = AES_BLOCK_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_GCM,\n\t\t\t.nodkp = true,\n\t\t},\n\t},\n\t \n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(md5),\"\n\t\t\t\t\t    \"ecb(cipher_null))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"ecb-cipher_null-caam\",\n\t\t\t\t.cra_blocksize = NULL_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = NULL_IV_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha1),\"\n\t\t\t\t\t    \"ecb(cipher_null))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha1-\"\n\t\t\t\t\t\t   \"ecb-cipher_null-caam\",\n\t\t\t\t.cra_blocksize = NULL_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = NULL_IV_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha224),\"\n\t\t\t\t\t    \"ecb(cipher_null))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha224-\"\n\t\t\t\t\t\t   \"ecb-cipher_null-caam\",\n\t\t\t\t.cra_blocksize = NULL_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = NULL_IV_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha256),\"\n\t\t\t\t\t    \"ecb(cipher_null))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha256-\"\n\t\t\t\t\t\t   \"ecb-cipher_null-caam\",\n\t\t\t\t.cra_blocksize = NULL_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = NULL_IV_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha384),\"\n\t\t\t\t\t    \"ecb(cipher_null))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha384-\"\n\t\t\t\t\t\t   \"ecb-cipher_null-caam\",\n\t\t\t\t.cra_blocksize = NULL_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = NULL_IV_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha512),\"\n\t\t\t\t\t    \"ecb(cipher_null))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha512-\"\n\t\t\t\t\t\t   \"ecb-cipher_null-caam\",\n\t\t\t\t.cra_blocksize = NULL_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = NULL_IV_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(md5),cbc(aes))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(md5),\"\n\t\t\t\t\t    \"cbc(aes)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha1),cbc(aes))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha1-\"\n\t\t\t\t\t\t   \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha1),\"\n\t\t\t\t\t    \"cbc(aes)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha1-cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha224),cbc(aes))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha224-\"\n\t\t\t\t\t\t   \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha224),\"\n\t\t\t\t\t    \"cbc(aes)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha224-cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha256),cbc(aes))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha256-\"\n\t\t\t\t\t\t   \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha256),\"\n\t\t\t\t\t    \"cbc(aes)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha256-cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha384),cbc(aes))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha384-\"\n\t\t\t\t\t\t   \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha384),\"\n\t\t\t\t\t    \"cbc(aes)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha384-cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha512),cbc(aes))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha512-\"\n\t\t\t\t\t\t   \"cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha512),\"\n\t\t\t\t\t    \"cbc(aes)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha512-cbc-aes-caam\",\n\t\t\t\t.cra_blocksize = AES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = AES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(md5),cbc(des3_ede))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t}\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(md5),\"\n\t\t\t\t\t    \"cbc(des3_ede)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t}\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha1),\"\n\t\t\t\t\t    \"cbc(des3_ede))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha1-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha1),\"\n\t\t\t\t\t    \"cbc(des3_ede)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha1-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha224),\"\n\t\t\t\t\t    \"cbc(des3_ede))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha224-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha224),\"\n\t\t\t\t\t    \"cbc(des3_ede)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha224-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha256),\"\n\t\t\t\t\t    \"cbc(des3_ede))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha256-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha256),\"\n\t\t\t\t\t    \"cbc(des3_ede)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha256-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha384),\"\n\t\t\t\t\t    \"cbc(des3_ede))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha384-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha384),\"\n\t\t\t\t\t    \"cbc(des3_ede)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha384-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha512),\"\n\t\t\t\t\t    \"cbc(des3_ede))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha512-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha512),\"\n\t\t\t\t\t    \"cbc(des3_ede)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha512-\"\n\t\t\t\t\t\t   \"cbc-des3_ede-caam\",\n\t\t\t\t.cra_blocksize = DES3_EDE_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = des3_aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES3_EDE_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_3DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(md5),cbc(des))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(md5),\"\n\t\t\t\t\t    \"cbc(des)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha1),cbc(des))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha1-\"\n\t\t\t\t\t\t   \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha1),\"\n\t\t\t\t\t    \"cbc(des)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha1-cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha224),cbc(des))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha224-\"\n\t\t\t\t\t\t   \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha224),\"\n\t\t\t\t\t    \"cbc(des)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha224-cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha256),cbc(des))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha256-\"\n\t\t\t\t\t\t   \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha256),\"\n\t\t\t\t\t    \"cbc(des)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha256-cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha384),cbc(des))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha384-\"\n\t\t\t\t\t\t   \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha384),\"\n\t\t\t\t\t    \"cbc(des)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha384-cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha512),cbc(des))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha512-\"\n\t\t\t\t\t\t   \"cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"echainiv(authenc(hmac(sha512),\"\n\t\t\t\t\t    \"cbc(des)))\",\n\t\t\t\t.cra_driver_name = \"echainiv-authenc-\"\n\t\t\t\t\t\t   \"hmac-sha512-cbc-des-caam\",\n\t\t\t\t.cra_blocksize = DES_BLOCK_SIZE,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = DES_BLOCK_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_DES | OP_ALG_AAI_CBC,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(md5),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes)))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"seqiv(authenc(\"\n\t\t\t\t\t    \"hmac(md5),rfc3686(ctr(aes))))\",\n\t\t\t\t.cra_driver_name = \"seqiv-authenc-hmac-md5-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = MD5_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_MD5 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha1),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes)))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha1-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"seqiv(authenc(\"\n\t\t\t\t\t    \"hmac(sha1),rfc3686(ctr(aes))))\",\n\t\t\t\t.cra_driver_name = \"seqiv-authenc-hmac-sha1-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA1_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA1 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha224),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes)))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha224-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"seqiv(authenc(\"\n\t\t\t\t\t    \"hmac(sha224),rfc3686(ctr(aes))))\",\n\t\t\t\t.cra_driver_name = \"seqiv-authenc-hmac-sha224-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA224_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA224 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha256),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes)))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha256-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"seqiv(authenc(hmac(sha256),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes))))\",\n\t\t\t\t.cra_driver_name = \"seqiv-authenc-hmac-sha256-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA256_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA256 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha384),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes)))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha384-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"seqiv(authenc(hmac(sha384),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes))))\",\n\t\t\t\t.cra_driver_name = \"seqiv-authenc-hmac-sha384-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA384_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA384 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"authenc(hmac(sha512),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes)))\",\n\t\t\t\t.cra_driver_name = \"authenc-hmac-sha512-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"seqiv(authenc(hmac(sha512),\"\n\t\t\t\t\t    \"rfc3686(ctr(aes))))\",\n\t\t\t\t.cra_driver_name = \"seqiv-authenc-hmac-sha512-\"\n\t\t\t\t\t\t   \"rfc3686-ctr-aes-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = aead_setkey,\n\t\t\t.setauthsize = aead_setauthsize,\n\t\t\t.encrypt = aead_encrypt,\n\t\t\t.decrypt = aead_decrypt,\n\t\t\t.ivsize = CTR_RFC3686_IV_SIZE,\n\t\t\t.maxauthsize = SHA512_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_AES |\n\t\t\t\t\t   OP_ALG_AAI_CTR_MOD128,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_SHA512 |\n\t\t\t\t\t   OP_ALG_AAI_HMAC_PRECOMP,\n\t\t\t.rfc3686 = true,\n\t\t\t.geniv = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"rfc7539(chacha20,poly1305)\",\n\t\t\t\t.cra_driver_name = \"rfc7539-chacha20-poly1305-\"\n\t\t\t\t\t\t   \"caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = chachapoly_setkey,\n\t\t\t.setauthsize = chachapoly_setauthsize,\n\t\t\t.encrypt = chachapoly_encrypt,\n\t\t\t.decrypt = chachapoly_decrypt,\n\t\t\t.ivsize = CHACHAPOLY_IV_SIZE,\n\t\t\t.maxauthsize = POLY1305_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_CHACHA20 |\n\t\t\t\t\t   OP_ALG_AAI_AEAD,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_POLY1305 |\n\t\t\t\t\t   OP_ALG_AAI_AEAD,\n\t\t\t.nodkp = true,\n\t\t},\n\t},\n\t{\n\t\t.aead.base = {\n\t\t\t.base = {\n\t\t\t\t.cra_name = \"rfc7539esp(chacha20,poly1305)\",\n\t\t\t\t.cra_driver_name = \"rfc7539esp-chacha20-\"\n\t\t\t\t\t\t   \"poly1305-caam\",\n\t\t\t\t.cra_blocksize = 1,\n\t\t\t},\n\t\t\t.setkey = chachapoly_setkey,\n\t\t\t.setauthsize = chachapoly_setauthsize,\n\t\t\t.encrypt = chachapoly_encrypt,\n\t\t\t.decrypt = chachapoly_decrypt,\n\t\t\t.ivsize = 8,\n\t\t\t.maxauthsize = POLY1305_DIGEST_SIZE,\n\t\t},\n\t\t.aead.op = {\n\t\t\t.do_one_request = aead_do_one_req,\n\t\t},\n\t\t.caam = {\n\t\t\t.class1_alg_type = OP_ALG_ALGSEL_CHACHA20 |\n\t\t\t\t\t   OP_ALG_AAI_AEAD,\n\t\t\t.class2_alg_type = OP_ALG_ALGSEL_POLY1305 |\n\t\t\t\t\t   OP_ALG_AAI_AEAD,\n\t\t\t.nodkp = true,\n\t\t},\n\t},\n};\n\nstatic int caam_init_common(struct caam_ctx *ctx, struct caam_alg_entry *caam,\n\t\t\t    bool uses_dkp)\n{\n\tdma_addr_t dma_addr;\n\tstruct caam_drv_private *priv;\n\tconst size_t sh_desc_enc_offset = offsetof(struct caam_ctx,\n\t\t\t\t\t\t   sh_desc_enc);\n\n\tctx->jrdev = caam_jr_alloc();\n\tif (IS_ERR(ctx->jrdev)) {\n\t\tpr_err(\"Job Ring Device allocation for transform failed\\n\");\n\t\treturn PTR_ERR(ctx->jrdev);\n\t}\n\n\tpriv = dev_get_drvdata(ctx->jrdev->parent);\n\tif (priv->era >= 6 && uses_dkp)\n\t\tctx->dir = DMA_BIDIRECTIONAL;\n\telse\n\t\tctx->dir = DMA_TO_DEVICE;\n\n\tdma_addr = dma_map_single_attrs(ctx->jrdev, ctx->sh_desc_enc,\n\t\t\t\t\toffsetof(struct caam_ctx,\n\t\t\t\t\t\t sh_desc_enc_dma) -\n\t\t\t\t\tsh_desc_enc_offset,\n\t\t\t\t\tctx->dir, DMA_ATTR_SKIP_CPU_SYNC);\n\tif (dma_mapping_error(ctx->jrdev, dma_addr)) {\n\t\tdev_err(ctx->jrdev, \"unable to map key, shared descriptors\\n\");\n\t\tcaam_jr_free(ctx->jrdev);\n\t\treturn -ENOMEM;\n\t}\n\n\tctx->sh_desc_enc_dma = dma_addr;\n\tctx->sh_desc_dec_dma = dma_addr + offsetof(struct caam_ctx,\n\t\t\t\t\t\t   sh_desc_dec) -\n\t\t\t\t\tsh_desc_enc_offset;\n\tctx->key_dma = dma_addr + offsetof(struct caam_ctx, key) -\n\t\t\t\t\tsh_desc_enc_offset;\n\n\t \n\tctx->cdata.algtype = OP_TYPE_CLASS1_ALG | caam->class1_alg_type;\n\tctx->adata.algtype = OP_TYPE_CLASS2_ALG | caam->class2_alg_type;\n\n\treturn 0;\n}\n\nstatic int caam_cra_init(struct crypto_skcipher *tfm)\n{\n\tstruct skcipher_alg *alg = crypto_skcipher_alg(tfm);\n\tstruct caam_skcipher_alg *caam_alg =\n\t\tcontainer_of(alg, typeof(*caam_alg), skcipher.base);\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(tfm);\n\tu32 alg_aai = caam_alg->caam.class1_alg_type & OP_ALG_AAI_MASK;\n\tint ret = 0;\n\n\tif (alg_aai == OP_ALG_AAI_XTS) {\n\t\tconst char *tfm_name = crypto_tfm_alg_name(&tfm->base);\n\t\tstruct crypto_skcipher *fallback;\n\n\t\tfallback = crypto_alloc_skcipher(tfm_name, 0,\n\t\t\t\t\t\t CRYPTO_ALG_NEED_FALLBACK);\n\t\tif (IS_ERR(fallback)) {\n\t\t\tpr_err(\"Failed to allocate %s fallback: %ld\\n\",\n\t\t\t       tfm_name, PTR_ERR(fallback));\n\t\t\treturn PTR_ERR(fallback);\n\t\t}\n\n\t\tctx->fallback = fallback;\n\t\tcrypto_skcipher_set_reqsize(tfm, sizeof(struct caam_skcipher_req_ctx) +\n\t\t\t\t\t    crypto_skcipher_reqsize(fallback));\n\t} else {\n\t\tcrypto_skcipher_set_reqsize(tfm, sizeof(struct caam_skcipher_req_ctx));\n\t}\n\n\tret = caam_init_common(ctx, &caam_alg->caam, false);\n\tif (ret && ctx->fallback)\n\t\tcrypto_free_skcipher(ctx->fallback);\n\n\treturn ret;\n}\n\nstatic int caam_aead_init(struct crypto_aead *tfm)\n{\n\tstruct aead_alg *alg = crypto_aead_alg(tfm);\n\tstruct caam_aead_alg *caam_alg =\n\t\t container_of(alg, struct caam_aead_alg, aead.base);\n\tstruct caam_ctx *ctx = crypto_aead_ctx_dma(tfm);\n\n\tcrypto_aead_set_reqsize(tfm, sizeof(struct caam_aead_req_ctx));\n\n\treturn caam_init_common(ctx, &caam_alg->caam, !caam_alg->caam.nodkp);\n}\n\nstatic void caam_exit_common(struct caam_ctx *ctx)\n{\n\tdma_unmap_single_attrs(ctx->jrdev, ctx->sh_desc_enc_dma,\n\t\t\t       offsetof(struct caam_ctx, sh_desc_enc_dma) -\n\t\t\t       offsetof(struct caam_ctx, sh_desc_enc),\n\t\t\t       ctx->dir, DMA_ATTR_SKIP_CPU_SYNC);\n\tcaam_jr_free(ctx->jrdev);\n}\n\nstatic void caam_cra_exit(struct crypto_skcipher *tfm)\n{\n\tstruct caam_ctx *ctx = crypto_skcipher_ctx_dma(tfm);\n\n\tif (ctx->fallback)\n\t\tcrypto_free_skcipher(ctx->fallback);\n\tcaam_exit_common(ctx);\n}\n\nstatic void caam_aead_exit(struct crypto_aead *tfm)\n{\n\tcaam_exit_common(crypto_aead_ctx_dma(tfm));\n}\n\nvoid caam_algapi_exit(void)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(driver_aeads); i++) {\n\t\tstruct caam_aead_alg *t_alg = driver_aeads + i;\n\n\t\tif (t_alg->registered)\n\t\t\tcrypto_engine_unregister_aead(&t_alg->aead);\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(driver_algs); i++) {\n\t\tstruct caam_skcipher_alg *t_alg = driver_algs + i;\n\n\t\tif (t_alg->registered)\n\t\t\tcrypto_engine_unregister_skcipher(&t_alg->skcipher);\n\t}\n}\n\nstatic void caam_skcipher_alg_init(struct caam_skcipher_alg *t_alg)\n{\n\tstruct skcipher_alg *alg = &t_alg->skcipher.base;\n\n\talg->base.cra_module = THIS_MODULE;\n\talg->base.cra_priority = CAAM_CRA_PRIORITY;\n\talg->base.cra_ctxsize = sizeof(struct caam_ctx) + crypto_dma_padding();\n\talg->base.cra_flags |= (CRYPTO_ALG_ASYNC | CRYPTO_ALG_ALLOCATES_MEMORY |\n\t\t\t      CRYPTO_ALG_KERN_DRIVER_ONLY);\n\n\talg->init = caam_cra_init;\n\talg->exit = caam_cra_exit;\n}\n\nstatic void caam_aead_alg_init(struct caam_aead_alg *t_alg)\n{\n\tstruct aead_alg *alg = &t_alg->aead.base;\n\n\talg->base.cra_module = THIS_MODULE;\n\talg->base.cra_priority = CAAM_CRA_PRIORITY;\n\talg->base.cra_ctxsize = sizeof(struct caam_ctx) + crypto_dma_padding();\n\talg->base.cra_flags = CRYPTO_ALG_ASYNC | CRYPTO_ALG_ALLOCATES_MEMORY |\n\t\t\t      CRYPTO_ALG_KERN_DRIVER_ONLY;\n\n\talg->init = caam_aead_init;\n\talg->exit = caam_aead_exit;\n}\n\nint caam_algapi_init(struct device *ctrldev)\n{\n\tstruct caam_drv_private *priv = dev_get_drvdata(ctrldev);\n\tint i = 0, err = 0;\n\tu32 aes_vid, aes_inst, des_inst, md_vid, md_inst, ccha_inst, ptha_inst;\n\tunsigned int md_limit = SHA512_DIGEST_SIZE;\n\tbool registered = false, gcm_support;\n\n\t \n\tif (priv->era < 10) {\n\t\tstruct caam_perfmon __iomem *perfmon = &priv->jr[0]->perfmon;\n\t\tu32 cha_vid, cha_inst, aes_rn;\n\n\t\tcha_vid = rd_reg32(&perfmon->cha_id_ls);\n\t\taes_vid = cha_vid & CHA_ID_LS_AES_MASK;\n\t\tmd_vid = (cha_vid & CHA_ID_LS_MD_MASK) >> CHA_ID_LS_MD_SHIFT;\n\n\t\tcha_inst = rd_reg32(&perfmon->cha_num_ls);\n\t\tdes_inst = (cha_inst & CHA_ID_LS_DES_MASK) >>\n\t\t\t   CHA_ID_LS_DES_SHIFT;\n\t\taes_inst = cha_inst & CHA_ID_LS_AES_MASK;\n\t\tmd_inst = (cha_inst & CHA_ID_LS_MD_MASK) >> CHA_ID_LS_MD_SHIFT;\n\t\tccha_inst = 0;\n\t\tptha_inst = 0;\n\n\t\taes_rn = rd_reg32(&perfmon->cha_rev_ls) & CHA_ID_LS_AES_MASK;\n\t\tgcm_support = !(aes_vid == CHA_VER_VID_AES_LP && aes_rn < 8);\n\t} else {\n\t\tstruct version_regs __iomem *vreg = &priv->jr[0]->vreg;\n\t\tu32 aesa, mdha;\n\n\t\taesa = rd_reg32(&vreg->aesa);\n\t\tmdha = rd_reg32(&vreg->mdha);\n\n\t\taes_vid = (aesa & CHA_VER_VID_MASK) >> CHA_VER_VID_SHIFT;\n\t\tmd_vid = (mdha & CHA_VER_VID_MASK) >> CHA_VER_VID_SHIFT;\n\n\t\tdes_inst = rd_reg32(&vreg->desa) & CHA_VER_NUM_MASK;\n\t\taes_inst = aesa & CHA_VER_NUM_MASK;\n\t\tmd_inst = mdha & CHA_VER_NUM_MASK;\n\t\tccha_inst = rd_reg32(&vreg->ccha) & CHA_VER_NUM_MASK;\n\t\tptha_inst = rd_reg32(&vreg->ptha) & CHA_VER_NUM_MASK;\n\n\t\tgcm_support = aesa & CHA_VER_MISC_AES_GCM;\n\t}\n\n\t \n\tif (md_inst && md_vid  == CHA_VER_VID_MD_LP256)\n\t\tmd_limit = SHA256_DIGEST_SIZE;\n\n\tfor (i = 0; i < ARRAY_SIZE(driver_algs); i++) {\n\t\tstruct caam_skcipher_alg *t_alg = driver_algs + i;\n\t\tu32 alg_sel = t_alg->caam.class1_alg_type & OP_ALG_ALGSEL_MASK;\n\n\t\t \n\t\tif (!des_inst &&\n\t\t    ((alg_sel == OP_ALG_ALGSEL_3DES) ||\n\t\t     (alg_sel == OP_ALG_ALGSEL_DES)))\n\t\t\t\tcontinue;\n\n\t\t \n\t\tif (!aes_inst && (alg_sel == OP_ALG_ALGSEL_AES))\n\t\t\t\tcontinue;\n\n\t\t \n\t\tif (aes_vid == CHA_VER_VID_AES_LP &&\n\t\t    (t_alg->caam.class1_alg_type & OP_ALG_AAI_MASK) ==\n\t\t    OP_ALG_AAI_XTS)\n\t\t\tcontinue;\n\n\t\tcaam_skcipher_alg_init(t_alg);\n\n\t\terr = crypto_engine_register_skcipher(&t_alg->skcipher);\n\t\tif (err) {\n\t\t\tpr_warn(\"%s alg registration failed\\n\",\n\t\t\t\tt_alg->skcipher.base.base.cra_driver_name);\n\t\t\tcontinue;\n\t\t}\n\n\t\tt_alg->registered = true;\n\t\tregistered = true;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(driver_aeads); i++) {\n\t\tstruct caam_aead_alg *t_alg = driver_aeads + i;\n\t\tu32 c1_alg_sel = t_alg->caam.class1_alg_type &\n\t\t\t\t OP_ALG_ALGSEL_MASK;\n\t\tu32 c2_alg_sel = t_alg->caam.class2_alg_type &\n\t\t\t\t OP_ALG_ALGSEL_MASK;\n\t\tu32 alg_aai = t_alg->caam.class1_alg_type & OP_ALG_AAI_MASK;\n\n\t\t \n\t\tif (!des_inst &&\n\t\t    ((c1_alg_sel == OP_ALG_ALGSEL_3DES) ||\n\t\t     (c1_alg_sel == OP_ALG_ALGSEL_DES)))\n\t\t\t\tcontinue;\n\n\t\t \n\t\tif (!aes_inst && (c1_alg_sel == OP_ALG_ALGSEL_AES))\n\t\t\t\tcontinue;\n\n\t\t \n\t\tif (c1_alg_sel == OP_ALG_ALGSEL_CHACHA20 && !ccha_inst)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (c2_alg_sel == OP_ALG_ALGSEL_POLY1305 && !ptha_inst)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (c1_alg_sel == OP_ALG_ALGSEL_AES &&\n\t\t    alg_aai == OP_ALG_AAI_GCM && !gcm_support)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (is_mdha(c2_alg_sel) &&\n\t\t    (!md_inst || t_alg->aead.base.maxauthsize > md_limit))\n\t\t\tcontinue;\n\n\t\tcaam_aead_alg_init(t_alg);\n\n\t\terr = crypto_engine_register_aead(&t_alg->aead);\n\t\tif (err) {\n\t\t\tpr_warn(\"%s alg registration failed\\n\",\n\t\t\t\tt_alg->aead.base.base.cra_driver_name);\n\t\t\tcontinue;\n\t\t}\n\n\t\tt_alg->registered = true;\n\t\tregistered = true;\n\t}\n\n\tif (registered)\n\t\tpr_info(\"caam algorithms registered in /proc/crypto\\n\");\n\n\treturn err;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}