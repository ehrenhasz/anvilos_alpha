{
  "module_name": "dpseci.c",
  "hash_id": "201b06f6887c0b4b37faef35e8efc63cc7b6c746f1f2014bdf0dff69369b2750",
  "original_prompt": "Ingested from linux-6.6.14/drivers/crypto/caam/dpseci.c",
  "human_readable_source": "\n \n\n#include <linux/fsl/mc.h>\n#include \"dpseci.h\"\n#include \"dpseci_cmd.h\"\n\n \nint dpseci_open(struct fsl_mc_io *mc_io, u32 cmd_flags, int dpseci_id,\n\t\tu16 *token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_cmd_open *cmd_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_OPEN,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  0);\n\tcmd_params = (struct dpseci_cmd_open *)cmd.params;\n\tcmd_params->dpseci_id = cpu_to_le32(dpseci_id);\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t*token = mc_cmd_hdr_read_token(&cmd);\n\n\treturn 0;\n}\n\n \nint dpseci_close(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_CLOSE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpseci_enable(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_ENABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpseci_disable(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_DISABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpseci_reset(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_RESET,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpseci_is_enabled(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t      int *en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_rsp_is_enabled *rsp_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_IS_ENABLED,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpseci_rsp_is_enabled *)cmd.params;\n\t*en = dpseci_get_field(rsp_params->is_enabled, ENABLE);\n\n\treturn 0;\n}\n\n \nint dpseci_get_attributes(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\t  struct dpseci_attr *attr)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_rsp_get_attributes *rsp_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_GET_ATTR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpseci_rsp_get_attributes *)cmd.params;\n\tattr->id = le32_to_cpu(rsp_params->id);\n\tattr->num_tx_queues = rsp_params->num_tx_queues;\n\tattr->num_rx_queues = rsp_params->num_rx_queues;\n\tattr->options = le32_to_cpu(rsp_params->options);\n\n\treturn 0;\n}\n\n \nint dpseci_set_rx_queue(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\tu8 queue, const struct dpseci_rx_queue_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_cmd_queue *cmd_params;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_SET_RX_QUEUE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpseci_cmd_queue *)cmd.params;\n\tcmd_params->dest_id = cpu_to_le32(cfg->dest_cfg.dest_id);\n\tcmd_params->priority = cfg->dest_cfg.priority;\n\tcmd_params->queue = queue;\n\tdpseci_set_field(cmd_params->dest_type, DEST_TYPE,\n\t\t\t cfg->dest_cfg.dest_type);\n\tcmd_params->user_ctx = cpu_to_le64(cfg->user_ctx);\n\tcmd_params->options = cpu_to_le32(cfg->options);\n\tdpseci_set_field(cmd_params->order_preservation_en, ORDER_PRESERVATION,\n\t\t\t cfg->order_preservation_en);\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpseci_get_rx_queue(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\tu8 queue, struct dpseci_rx_queue_attr *attr)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_cmd_queue *cmd_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_GET_RX_QUEUE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpseci_cmd_queue *)cmd.params;\n\tcmd_params->queue = queue;\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\tattr->dest_cfg.dest_id = le32_to_cpu(cmd_params->dest_id);\n\tattr->dest_cfg.priority = cmd_params->priority;\n\tattr->dest_cfg.dest_type = dpseci_get_field(cmd_params->dest_type,\n\t\t\t\t\t\t    DEST_TYPE);\n\tattr->user_ctx = le64_to_cpu(cmd_params->user_ctx);\n\tattr->fqid = le32_to_cpu(cmd_params->fqid);\n\tattr->order_preservation_en =\n\t\tdpseci_get_field(cmd_params->order_preservation_en,\n\t\t\t\t ORDER_PRESERVATION);\n\n\treturn 0;\n}\n\n \nint dpseci_get_tx_queue(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\tu8 queue, struct dpseci_tx_queue_attr *attr)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_cmd_queue *cmd_params;\n\tstruct dpseci_rsp_get_tx_queue *rsp_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_GET_TX_QUEUE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpseci_cmd_queue *)cmd.params;\n\tcmd_params->queue = queue;\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpseci_rsp_get_tx_queue *)cmd.params;\n\tattr->fqid = le32_to_cpu(rsp_params->fqid);\n\tattr->priority = rsp_params->priority;\n\n\treturn 0;\n}\n\n \nint dpseci_get_sec_attr(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\tstruct dpseci_sec_attr *attr)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_rsp_get_sec_attr *rsp_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_GET_SEC_ATTR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpseci_rsp_get_sec_attr *)cmd.params;\n\tattr->ip_id = le16_to_cpu(rsp_params->ip_id);\n\tattr->major_rev = rsp_params->major_rev;\n\tattr->minor_rev = rsp_params->minor_rev;\n\tattr->era = rsp_params->era;\n\tattr->deco_num = rsp_params->deco_num;\n\tattr->zuc_auth_acc_num = rsp_params->zuc_auth_acc_num;\n\tattr->zuc_enc_acc_num = rsp_params->zuc_enc_acc_num;\n\tattr->snow_f8_acc_num = rsp_params->snow_f8_acc_num;\n\tattr->snow_f9_acc_num = rsp_params->snow_f9_acc_num;\n\tattr->crc_acc_num = rsp_params->crc_acc_num;\n\tattr->pk_acc_num = rsp_params->pk_acc_num;\n\tattr->kasumi_acc_num = rsp_params->kasumi_acc_num;\n\tattr->rng_acc_num = rsp_params->rng_acc_num;\n\tattr->md_acc_num = rsp_params->md_acc_num;\n\tattr->arc4_acc_num = rsp_params->arc4_acc_num;\n\tattr->des_acc_num = rsp_params->des_acc_num;\n\tattr->aes_acc_num = rsp_params->aes_acc_num;\n\tattr->ccha_acc_num = rsp_params->ccha_acc_num;\n\tattr->ptha_acc_num = rsp_params->ptha_acc_num;\n\n\treturn 0;\n}\n\n \nint dpseci_get_api_version(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\t\t\t   u16 *major_ver, u16 *minor_ver)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_rsp_get_api_version *rsp_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPSECI_CMDID_GET_API_VERSION,\n\t\t\t\t\t  cmd_flags, 0);\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpseci_rsp_get_api_version *)cmd.params;\n\t*major_ver = le16_to_cpu(rsp_params->major);\n\t*minor_ver = le16_to_cpu(rsp_params->minor);\n\n\treturn 0;\n}\n\n \nint dpseci_set_congestion_notification(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\tu16 token, const struct dpseci_congestion_notification_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_cmd_congestion_notification *cmd_params;\n\n\tcmd.header = mc_encode_cmd_header(\n\t\t\tDPSECI_CMDID_SET_CONGESTION_NOTIFICATION,\n\t\t\tcmd_flags,\n\t\t\ttoken);\n\tcmd_params = (struct dpseci_cmd_congestion_notification *)cmd.params;\n\tcmd_params->dest_id = cpu_to_le32(cfg->dest_cfg.dest_id);\n\tcmd_params->notification_mode = cpu_to_le16(cfg->notification_mode);\n\tcmd_params->priority = cfg->dest_cfg.priority;\n\tdpseci_set_field(cmd_params->options, CGN_DEST_TYPE,\n\t\t\t cfg->dest_cfg.dest_type);\n\tdpseci_set_field(cmd_params->options, CGN_UNITS, cfg->units);\n\tcmd_params->message_iova = cpu_to_le64(cfg->message_iova);\n\tcmd_params->message_ctx = cpu_to_le64(cfg->message_ctx);\n\tcmd_params->threshold_entry = cpu_to_le32(cfg->threshold_entry);\n\tcmd_params->threshold_exit = cpu_to_le32(cfg->threshold_exit);\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpseci_get_congestion_notification(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\tu16 token, struct dpseci_congestion_notification_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpseci_cmd_congestion_notification *rsp_params;\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(\n\t\t\tDPSECI_CMDID_GET_CONGESTION_NOTIFICATION,\n\t\t\tcmd_flags,\n\t\t\ttoken);\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpseci_cmd_congestion_notification *)cmd.params;\n\tcfg->dest_cfg.dest_id = le32_to_cpu(rsp_params->dest_id);\n\tcfg->notification_mode = le16_to_cpu(rsp_params->notification_mode);\n\tcfg->dest_cfg.priority = rsp_params->priority;\n\tcfg->dest_cfg.dest_type = dpseci_get_field(rsp_params->options,\n\t\t\t\t\t\t   CGN_DEST_TYPE);\n\tcfg->units = dpseci_get_field(rsp_params->options, CGN_UNITS);\n\tcfg->message_iova = le64_to_cpu(rsp_params->message_iova);\n\tcfg->message_ctx = le64_to_cpu(rsp_params->message_ctx);\n\tcfg->threshold_entry = le32_to_cpu(rsp_params->threshold_entry);\n\tcfg->threshold_exit = le32_to_cpu(rsp_params->threshold_exit);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}