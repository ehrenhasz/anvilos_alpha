{
  "module_name": "acrn_drv.h",
  "hash_id": "2ca86d987c38f741ba44f85c3e3502596a9041d5f50eb256bfa25734aa9de607",
  "original_prompt": "Ingested from linux-6.6.14/drivers/virt/acrn/acrn_drv.h",
  "human_readable_source": " \n\n#ifndef __ACRN_HSM_DRV_H\n#define __ACRN_HSM_DRV_H\n\n#include <linux/acrn.h>\n#include <linux/dev_printk.h>\n#include <linux/miscdevice.h>\n#include <linux/types.h>\n\n#include \"hypercall.h\"\n\nextern struct miscdevice acrn_dev;\n\n#define ACRN_NAME_LEN\t\t16\n#define ACRN_MEM_MAPPING_MAX\t256\n\n#define ACRN_MEM_REGION_ADD\t0\n#define ACRN_MEM_REGION_DEL\t2\n\nstruct acrn_vm;\nstruct acrn_ioreq_client;\n\n \nstruct vm_memory_region_op {\n\tu32\ttype;\n\tu32\tattr;\n\tu64\tuser_vm_pa;\n\tu64\tservice_vm_pa;\n\tu64\tsize;\n};\n\n \nstruct vm_memory_region_batch {\n\tu16\t\t\t   vmid;\n\tu16\t\t\t   reserved[3];\n\tu32\t\t\t   regions_num;\n\tu64\t\t\t   regions_gpa;\n\tstruct vm_memory_region_op regions_op[];\n};\n\n \nstruct vm_memory_mapping {\n\tstruct page\t**pages;\n\tint\t\tnpages;\n\tvoid\t\t*service_vm_va;\n\tu64\t\tuser_vm_pa;\n\tsize_t\t\tsize;\n};\n\n \nstruct acrn_ioreq_buffer {\n\tu64\tioreq_buf;\n};\n\nstruct acrn_ioreq_range {\n\tstruct list_head\tlist;\n\tu32\t\t\ttype;\n\tu64\t\t\tstart;\n\tu64\t\t\tend;\n};\n\n#define ACRN_IOREQ_CLIENT_DESTROYING\t0U\ntypedef\tint (*ioreq_handler_t)(struct acrn_ioreq_client *client,\n\t\t\t       struct acrn_io_request *req);\n \nstruct acrn_ioreq_client {\n\tchar\t\t\tname[ACRN_NAME_LEN];\n\tstruct acrn_vm\t\t*vm;\n\tstruct list_head\tlist;\n\tbool\t\t\tis_default;\n\tunsigned long\t\tflags;\n\tstruct list_head\trange_list;\n\trwlock_t\t\trange_lock;\n\tDECLARE_BITMAP(ioreqs_map, ACRN_IO_REQUEST_MAX);\n\tioreq_handler_t\t\thandler;\n\tstruct task_struct\t*thread;\n\twait_queue_head_t\twq;\n\tvoid\t\t\t*priv;\n};\n\n#define ACRN_INVALID_VMID (0xffffU)\n\n#define ACRN_VM_FLAG_DESTROYED\t\t0U\n#define ACRN_VM_FLAG_CLEARING_IOREQ\t1U\nextern struct list_head acrn_vm_list;\nextern rwlock_t acrn_vm_list_lock;\n \nstruct acrn_vm {\n\tstruct list_head\t\tlist;\n\tu16\t\t\t\tvmid;\n\tint\t\t\t\tvcpu_num;\n\tunsigned long\t\t\tflags;\n\tstruct mutex\t\t\tregions_mapping_lock;\n\tstruct vm_memory_mapping\tregions_mapping[ACRN_MEM_MAPPING_MAX];\n\tint\t\t\t\tregions_mapping_count;\n\tspinlock_t\t\t\tioreq_clients_lock;\n\tstruct list_head\t\tioreq_clients;\n\tstruct acrn_ioreq_client\t*default_client;\n\tstruct acrn_io_request_buffer\t*ioreq_buf;\n\tstruct page\t\t\t*ioreq_page;\n\tu32\t\t\t\tpci_conf_addr;\n\tstruct page\t\t\t*monitor_page;\n\tstruct mutex\t\t\tioeventfds_lock;\n\tstruct list_head\t\tioeventfds;\n\tstruct acrn_ioreq_client\t*ioeventfd_client;\n\tstruct mutex\t\t\tirqfds_lock;\n\tstruct list_head\t\tirqfds;\n\tstruct workqueue_struct\t\t*irqfd_wq;\n};\n\nstruct acrn_vm *acrn_vm_create(struct acrn_vm *vm,\n\t\t\t       struct acrn_vm_creation *vm_param);\nint acrn_vm_destroy(struct acrn_vm *vm);\nint acrn_mm_region_add(struct acrn_vm *vm, u64 user_gpa, u64 service_gpa,\n\t\t       u64 size, u32 mem_type, u32 mem_access_right);\nint acrn_mm_region_del(struct acrn_vm *vm, u64 user_gpa, u64 size);\nint acrn_vm_memseg_map(struct acrn_vm *vm, struct acrn_vm_memmap *memmap);\nint acrn_vm_memseg_unmap(struct acrn_vm *vm, struct acrn_vm_memmap *memmap);\nint acrn_vm_ram_map(struct acrn_vm *vm, struct acrn_vm_memmap *memmap);\nvoid acrn_vm_all_ram_unmap(struct acrn_vm *vm);\n\nint acrn_ioreq_init(struct acrn_vm *vm, u64 buf_vma);\nvoid acrn_ioreq_deinit(struct acrn_vm *vm);\nint acrn_ioreq_intr_setup(void);\nvoid acrn_ioreq_intr_remove(void);\nvoid acrn_ioreq_request_clear(struct acrn_vm *vm);\nint acrn_ioreq_client_wait(struct acrn_ioreq_client *client);\nint acrn_ioreq_request_default_complete(struct acrn_vm *vm, u16 vcpu);\nstruct acrn_ioreq_client *acrn_ioreq_client_create(struct acrn_vm *vm,\n\t\t\t\t\t\t   ioreq_handler_t handler,\n\t\t\t\t\t\t   void *data, bool is_default,\n\t\t\t\t\t\t   const char *name);\nvoid acrn_ioreq_client_destroy(struct acrn_ioreq_client *client);\nint acrn_ioreq_range_add(struct acrn_ioreq_client *client,\n\t\t\t u32 type, u64 start, u64 end);\nvoid acrn_ioreq_range_del(struct acrn_ioreq_client *client,\n\t\t\t  u32 type, u64 start, u64 end);\n\nint acrn_msi_inject(struct acrn_vm *vm, u64 msi_addr, u64 msi_data);\n\nint acrn_ioeventfd_init(struct acrn_vm *vm);\nint acrn_ioeventfd_config(struct acrn_vm *vm, struct acrn_ioeventfd *args);\nvoid acrn_ioeventfd_deinit(struct acrn_vm *vm);\n\nint acrn_irqfd_init(struct acrn_vm *vm);\nint acrn_irqfd_config(struct acrn_vm *vm, struct acrn_irqfd *args);\nvoid acrn_irqfd_deinit(struct acrn_vm *vm);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}