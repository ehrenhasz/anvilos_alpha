{
  "module_name": "ne_misc_dev_test.c",
  "hash_id": "092013f52dc15ed7a52dd236b019c03f678f1ecfe6d949a1cc3d495e454c08c9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/virt/nitro_enclaves/ne_misc_dev_test.c",
  "human_readable_source": "\n\n#include <kunit/test.h>\n\n#define MAX_PHYS_REGIONS\t16\n#define INVALID_VALUE\t\t(~0ull)\n\nstruct ne_phys_regions_test {\n\tu64           paddr;\n\tu64           size;\n\tint           expect_rc;\n\tunsigned long expect_num;\n\tu64           expect_last_paddr;\n\tu64           expect_last_size;\n} phys_regions_test_cases[] = {\n\t \n\t{0x1000, 0x200000, -EINVAL, 0, INVALID_VALUE, INVALID_VALUE},\n\n\t \n\t{0x200000, 0x1000, -EINVAL, 0, INVALID_VALUE, INVALID_VALUE},\n\n\t \n\t{0x200000, 0x200000, 0, 1, 0x200000, 0x200000},\n\n\t \n\t{0x0, 0x200000, 0, 2, 0x0, 0x200000},\n\n\t \n\t{0x600000, 0x400000, 0, 3, 0x600000, 0x400000},\n\n\t \n\t{0xa00000, 0x400000, 0, 3, 0x600000, 0x800000},\n\n\t \n\t{0x1000, 0x200000, -EINVAL, 3, 0x600000, 0x800000},\n};\n\nstatic void ne_misc_dev_test_merge_phys_contig_memory_regions(struct kunit *test)\n{\n\tstruct ne_phys_contig_mem_regions phys_contig_mem_regions = {};\n\tint rc = 0;\n\tint i = 0;\n\n\tphys_contig_mem_regions.regions = kunit_kcalloc(test, MAX_PHYS_REGIONS,\n\t\t\t\t\t\t\tsizeof(*phys_contig_mem_regions.regions),\n\t\t\t\t\t\t\tGFP_KERNEL);\n\tKUNIT_ASSERT_TRUE(test, phys_contig_mem_regions.regions);\n\n\tfor (i = 0; i < ARRAY_SIZE(phys_regions_test_cases); i++) {\n\t\tstruct ne_phys_regions_test *test_case = &phys_regions_test_cases[i];\n\t\tunsigned long num = 0;\n\n\t\trc = ne_merge_phys_contig_memory_regions(&phys_contig_mem_regions,\n\t\t\t\t\t\t\t test_case->paddr, test_case->size);\n\t\tKUNIT_EXPECT_EQ(test, rc, test_case->expect_rc);\n\t\tKUNIT_EXPECT_EQ(test, phys_contig_mem_regions.num, test_case->expect_num);\n\n\t\tif (test_case->expect_last_paddr == INVALID_VALUE)\n\t\t\tcontinue;\n\n\t\tnum = phys_contig_mem_regions.num;\n\t\tKUNIT_EXPECT_EQ(test, phys_contig_mem_regions.regions[num - 1].start,\n\t\t\t\ttest_case->expect_last_paddr);\n\t\tKUNIT_EXPECT_EQ(test, range_len(&phys_contig_mem_regions.regions[num - 1]),\n\t\t\t\ttest_case->expect_last_size);\n\t}\n\n\tkunit_kfree(test, phys_contig_mem_regions.regions);\n}\n\nstatic struct kunit_case ne_misc_dev_test_cases[] = {\n\tKUNIT_CASE(ne_misc_dev_test_merge_phys_contig_memory_regions),\n\t{}\n};\n\nstatic struct kunit_suite ne_misc_dev_test_suite = {\n\t.name = \"ne_misc_dev_test\",\n\t.test_cases = ne_misc_dev_test_cases,\n};\n\nkunit_test_suite(ne_misc_dev_test_suite);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}