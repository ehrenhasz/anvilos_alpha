{
  "module_name": "i2c-amd-mp2.h",
  "hash_id": "9729a8d90de826d0c33a4167271a1f72cd53c04e323c452e8e6d07d664d43f95",
  "original_prompt": "Ingested from linux-6.6.14/drivers/i2c/busses/i2c-amd-mp2.h",
  "human_readable_source": " \n \n\n#ifndef I2C_AMD_PCI_MP2_H\n#define I2C_AMD_PCI_MP2_H\n\n#include <linux/i2c.h>\n#include <linux/pci.h>\n#include <linux/pm_runtime.h>\n\n#define PCI_DEVICE_ID_AMD_MP2\t0x15E6\n\nstruct amd_i2c_common;\nstruct amd_mp2_dev;\n\nenum {\n\t \n\tAMD_C2P_MSG0 = 0x10500,\t\t\t \n\tAMD_C2P_MSG1 = 0x10504,\t\t\t \n\tAMD_C2P_MSG2 = 0x10508,\t\t\t \n\tAMD_C2P_MSG3 = 0x1050c,\t\t\t \n\tAMD_C2P_MSG4 = 0x10510,\t\t\t \n\tAMD_C2P_MSG5 = 0x10514,\t\t\t \n\tAMD_C2P_MSG6 = 0x10518,\t\t\t \n\tAMD_C2P_MSG7 = 0x1051c,\t\t\t \n\tAMD_C2P_MSG8 = 0x10520,\t\t\t \n\tAMD_C2P_MSG9 = 0x10524,\t\t\t \n\n\t \n\tAMD_P2C_MSG0 = 0x10680,\t\t\t \n\tAMD_P2C_MSG1 = 0x10684,\t\t\t \n\tAMD_P2C_MSG2 = 0x10688,\t\t\t \n\tAMD_P2C_MSG3 = 0x1068C,\t\t\t \n\tAMD_P2C_MSG_INTEN = 0x10690,\t\t \n\tAMD_P2C_MSG_INTSTS = 0x10694,\t\t \n};\n\n \n\n#define i2c_none (-1)\nenum i2c_cmd {\n\ti2c_read = 0,\n\ti2c_write,\n\ti2c_enable,\n\ti2c_disable,\n\tnumber_of_sensor_discovered,\n\tis_mp2_active,\n\tinvalid_cmd = 0xF,\n};\n\nenum speed_enum {\n\tspeed100k = 0,\n\tspeed400k = 1,\n\tspeed1000k = 2,\n\tspeed1400k = 3,\n\tspeed3400k = 4\n};\n\nenum mem_type {\n\tuse_dram = 0,\n\tuse_c2pmsg = 1,\n};\n\n \nunion i2c_cmd_base {\n\tu32 ul;\n\tstruct {\n\t\tenum i2c_cmd i2c_cmd : 4;\n\t\tu8 bus_id : 4;\n\t\tu32 slave_addr : 8;\n\t\tu32 length : 12;\n\t\tenum speed_enum i2c_speed : 3;\n\t\tenum mem_type mem_type : 1;\n\t} s;\n};\n\nenum response_type {\n\tinvalid_response = 0,\n\tcommand_success = 1,\n\tcommand_failed = 2,\n};\n\nenum status_type {\n\ti2c_readcomplete_event = 0,\n\ti2c_readfail_event = 1,\n\ti2c_writecomplete_event = 2,\n\ti2c_writefail_event = 3,\n\ti2c_busenable_complete = 4,\n\ti2c_busenable_failed = 5,\n\ti2c_busdisable_complete = 6,\n\ti2c_busdisable_failed = 7,\n\tinvalid_data_length = 8,\n\tinvalid_slave_address = 9,\n\tinvalid_i2cbus_id = 10,\n\tinvalid_dram_addr = 11,\n\tinvalid_command = 12,\n\tmp2_active = 13,\n\tnumberof_sensors_discovered_resp = 14,\n\ti2c_bus_notinitialized\n};\n\n \nunion i2c_event {\n\tu32 ul;\n\tstruct {\n\t\tenum response_type response : 2;\n\t\tenum status_type status : 5;\n\t\tenum mem_type mem_type : 1;\n\t\tu8 bus_id : 4;\n\t\tu32 length : 12;\n\t\tu32 slave_addr : 8;\n\t} r;\n};\n\n \nstruct amd_i2c_common {\n\tunion i2c_event eventval;\n\tstruct amd_mp2_dev *mp2_dev;\n\tstruct i2c_msg *msg;\n\tvoid (*cmd_completion)(struct amd_i2c_common *i2c_common);\n\tenum i2c_cmd reqcmd;\n\tu8 cmd_success;\n\tu8 bus_id;\n\tenum speed_enum i2c_speed;\n\tu8 *dma_buf;\n\tdma_addr_t dma_addr;\n#ifdef CONFIG_PM\n\tint (*suspend)(struct amd_i2c_common *i2c_common);\n\tint (*resume)(struct amd_i2c_common *i2c_common);\n#endif  \n};\n\n \nstruct amd_mp2_dev {\n\tstruct pci_dev *pci_dev;\n\tstruct amd_i2c_common *busses[2];\n\tvoid __iomem *mmio;\n\tstruct mutex c2p_lock;\n\tu8 c2p_lock_busid;\n\tunsigned int probed;\n\tint dev_irq;\n};\n\n \n\nint amd_mp2_rw(struct amd_i2c_common *i2c_common, enum i2c_cmd reqcmd);\nint amd_mp2_bus_enable_set(struct amd_i2c_common *i2c_common, bool enable);\n\nvoid amd_mp2_process_event(struct amd_i2c_common *i2c_common);\n\nvoid amd_mp2_rw_timeout(struct amd_i2c_common *i2c_common);\n\nint amd_mp2_register_cb(struct amd_i2c_common *i2c_common);\nint amd_mp2_unregister_cb(struct amd_i2c_common *i2c_common);\n\nstruct amd_mp2_dev *amd_mp2_find_device(void);\n\nstatic inline void amd_mp2_pm_runtime_get(struct amd_mp2_dev *mp2_dev)\n{\n\tpm_runtime_get_sync(&mp2_dev->pci_dev->dev);\n}\n\nstatic inline void amd_mp2_pm_runtime_put(struct amd_mp2_dev *mp2_dev)\n{\n\tpm_runtime_mark_last_busy(&mp2_dev->pci_dev->dev);\n\tpm_runtime_put_autosuspend(&mp2_dev->pci_dev->dev);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}