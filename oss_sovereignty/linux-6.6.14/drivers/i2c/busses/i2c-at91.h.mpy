{
  "module_name": "i2c-at91.h",
  "hash_id": "4d6f1a14bcab64399cb82a040bc2afc1008983d2e1415508fc7c38d2ca69d20c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/i2c/busses/i2c-at91.h",
  "human_readable_source": " \n \n\n#include <linux/clk.h>\n#include <linux/completion.h>\n#include <linux/dma-mapping.h>\n#include <linux/dmaengine.h>\n#include <linux/i2c.h>\n#include <linux/platform_device.h>\n\n#define AT91_I2C_TIMEOUT\tmsecs_to_jiffies(100)\t \n#define AT91_I2C_DMA_THRESHOLD\t8\t\t\t \n#define AUTOSUSPEND_TIMEOUT\t\t2000\n#define AT91_I2C_MAX_ALT_CMD_DATA_SIZE\t256\n\n \n#define\tAT91_TWI_CR\t\t0x0000\t \n#define\tAT91_TWI_START\t\tBIT(0)\t \n#define\tAT91_TWI_STOP\t\tBIT(1)\t \n#define\tAT91_TWI_MSEN\t\tBIT(2)\t \n#define\tAT91_TWI_MSDIS\t\tBIT(3)\t \n#define\tAT91_TWI_SVEN\t\tBIT(4)\t \n#define\tAT91_TWI_SVDIS\t\tBIT(5)\t \n#define\tAT91_TWI_QUICK\t\tBIT(6)\t \n#define\tAT91_TWI_SWRST\t\tBIT(7)\t \n#define\tAT91_TWI_CLEAR\t\tBIT(15)  \n#define\tAT91_TWI_ACMEN\t\tBIT(16)  \n#define\tAT91_TWI_ACMDIS\t\tBIT(17)  \n#define\tAT91_TWI_THRCLR\t\tBIT(24)  \n#define\tAT91_TWI_RHRCLR\t\tBIT(25)  \n#define\tAT91_TWI_LOCKCLR\tBIT(26)  \n#define\tAT91_TWI_FIFOEN\t\tBIT(28)  \n#define\tAT91_TWI_FIFODIS\tBIT(29)  \n\n#define\tAT91_TWI_MMR\t\t0x0004\t \n#define\tAT91_TWI_IADRSZ_1\t0x0100\t \n#define\tAT91_TWI_MREAD\t\tBIT(12)\t \n\n#define\tAT91_TWI_SMR\t\t0x0008\t \n#define\tAT91_TWI_SMR_SADR_MAX\t0x007f\n#define\tAT91_TWI_SMR_SADR(x)\t(((x) & AT91_TWI_SMR_SADR_MAX) << 16)\n\n#define\tAT91_TWI_IADR\t\t0x000c\t \n\n#define\tAT91_TWI_CWGR\t\t0x0010\t \n#define\tAT91_TWI_CWGR_HOLD_MAX\t0x1f\n#define\tAT91_TWI_CWGR_HOLD(x)\t(((x) & AT91_TWI_CWGR_HOLD_MAX) << 24)\n\n#define\tAT91_TWI_SR\t\t0x0020\t \n#define\tAT91_TWI_TXCOMP\t\tBIT(0)\t \n#define\tAT91_TWI_RXRDY\t\tBIT(1)\t \n#define\tAT91_TWI_TXRDY\t\tBIT(2)\t \n#define\tAT91_TWI_SVREAD\t\tBIT(3)\t \n#define\tAT91_TWI_SVACC\t\tBIT(4)\t \n#define\tAT91_TWI_OVRE\t\tBIT(6)\t \n#define\tAT91_TWI_UNRE\t\tBIT(7)\t \n#define\tAT91_TWI_NACK\t\tBIT(8)\t \n#define\tAT91_TWI_EOSACC\t\tBIT(11)\t \n#define\tAT91_TWI_LOCK\t\tBIT(23)  \n#define\tAT91_TWI_SCL\t\tBIT(24)  \n#define\tAT91_TWI_SDA\t\tBIT(25)  \n\n#define\tAT91_TWI_INT_MASK \\\n\t(AT91_TWI_TXCOMP | AT91_TWI_RXRDY | AT91_TWI_TXRDY | AT91_TWI_NACK \\\n\t| AT91_TWI_SVACC | AT91_TWI_EOSACC)\n\n#define\tAT91_TWI_IER\t\t0x0024\t \n#define\tAT91_TWI_IDR\t\t0x0028\t \n#define\tAT91_TWI_IMR\t\t0x002c\t \n#define\tAT91_TWI_RHR\t\t0x0030\t \n#define\tAT91_TWI_THR\t\t0x0034\t \n\n#define\tAT91_TWI_ACR\t\t0x0040\t \n#define\tAT91_TWI_ACR_DATAL_MASK\tGENMASK(15, 0)\n#define\tAT91_TWI_ACR_DATAL(len)\t((len) & AT91_TWI_ACR_DATAL_MASK)\n#define\tAT91_TWI_ACR_DIR\tBIT(8)\n\n#define AT91_TWI_FILTR\t\t0x0044\n#define AT91_TWI_FILTR_FILT\tBIT(0)\n#define AT91_TWI_FILTR_PADFEN\tBIT(1)\n#define AT91_TWI_FILTR_THRES(v)\t\t((v) << 8)\n#define AT91_TWI_FILTR_THRES_MAX\t7\n#define AT91_TWI_FILTR_THRES_MASK\tGENMASK(10, 8)\n\n#define\tAT91_TWI_FMR\t\t0x0050\t \n#define\tAT91_TWI_FMR_TXRDYM(mode)\t(((mode) & 0x3) << 0)\n#define\tAT91_TWI_FMR_TXRDYM_MASK\t(0x3 << 0)\n#define\tAT91_TWI_FMR_RXRDYM(mode)\t(((mode) & 0x3) << 4)\n#define\tAT91_TWI_FMR_RXRDYM_MASK\t(0x3 << 4)\n#define\tAT91_TWI_ONE_DATA\t0x0\n#define\tAT91_TWI_TWO_DATA\t0x1\n#define\tAT91_TWI_FOUR_DATA\t0x2\n\n#define\tAT91_TWI_FLR\t\t0x0054\t \n\n#define\tAT91_TWI_FSR\t\t0x0060\t \n#define\tAT91_TWI_FIER\t\t0x0064\t \n#define\tAT91_TWI_FIDR\t\t0x0068\t \n#define\tAT91_TWI_FIMR\t\t0x006c\t \n\n#define\tAT91_TWI_VER\t\t0x00fc\t \n\nstruct at91_twi_pdata {\n\tunsigned clk_max_div;\n\tunsigned clk_offset;\n\tbool has_unre_flag;\n\tbool has_alt_cmd;\n\tbool has_hold_field;\n\tbool has_dig_filtr;\n\tbool has_adv_dig_filtr;\n\tbool has_ana_filtr;\n\tbool has_clear_cmd;\n};\n\nstruct at91_twi_dma {\n\tstruct dma_chan *chan_rx;\n\tstruct dma_chan *chan_tx;\n\tstruct scatterlist sg[2];\n\tstruct dma_async_tx_descriptor *data_desc;\n\tenum dma_data_direction direction;\n\tbool buf_mapped;\n\tbool xfer_in_progress;\n};\n\nstruct at91_twi_dev {\n\tstruct device *dev;\n\tvoid __iomem *base;\n\tstruct completion cmd_complete;\n\tstruct clk *clk;\n\tu8 *buf;\n\tsize_t buf_len;\n\tstruct i2c_msg *msg;\n\tint irq;\n\tunsigned imr;\n\tunsigned transfer_status;\n\tstruct i2c_adapter adapter;\n\tunsigned twi_cwgr_reg;\n\tstruct at91_twi_pdata *pdata;\n\tbool use_dma;\n\tbool use_alt_cmd;\n\tbool recv_len_abort;\n\tu32 fifo_size;\n\tstruct at91_twi_dma dma;\n\tbool slave_detected;\n\tstruct i2c_bus_recovery_info rinfo;\n#ifdef CONFIG_I2C_AT91_SLAVE_EXPERIMENTAL\n\tunsigned smr;\n\tstruct i2c_client *slave;\n#endif\n\tbool enable_dig_filt;\n\tbool enable_ana_filt;\n\tu32 filter_width;\n};\n\nunsigned at91_twi_read(struct at91_twi_dev *dev, unsigned reg);\nvoid at91_twi_write(struct at91_twi_dev *dev, unsigned reg, unsigned val);\nvoid at91_disable_twi_interrupts(struct at91_twi_dev *dev);\nvoid at91_twi_irq_save(struct at91_twi_dev *dev);\nvoid at91_twi_irq_restore(struct at91_twi_dev *dev);\nvoid at91_init_twi_bus(struct at91_twi_dev *dev);\n\nvoid at91_init_twi_bus_master(struct at91_twi_dev *dev);\nint at91_twi_probe_master(struct platform_device *pdev, u32 phy_addr,\n\t\t\t  struct at91_twi_dev *dev);\n\n#ifdef CONFIG_I2C_AT91_SLAVE_EXPERIMENTAL\nvoid at91_init_twi_bus_slave(struct at91_twi_dev *dev);\nint at91_twi_probe_slave(struct platform_device *pdev, u32 phy_addr,\n\t\t\t struct at91_twi_dev *dev);\n\n#else\nstatic inline void at91_init_twi_bus_slave(struct at91_twi_dev *dev) {}\nstatic inline int at91_twi_probe_slave(struct platform_device *pdev,\n\t\t\t\t       u32 phy_addr, struct at91_twi_dev *dev)\n{\n\treturn -EINVAL;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}