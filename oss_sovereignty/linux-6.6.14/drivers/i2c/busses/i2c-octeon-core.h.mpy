{
  "module_name": "i2c-octeon-core.h",
  "hash_id": "e47a6dcaa53818b2327b1938a73d44ebcfcd8eb627b13880b1731afc68e9e34b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/i2c/busses/i2c-octeon-core.h",
  "human_readable_source": " \n#include <linux/atomic.h>\n#include <linux/clk.h>\n#include <linux/delay.h>\n#include <linux/device.h>\n#include <linux/i2c.h>\n#include <linux/i2c-smbus.h>\n#include <linux/io.h>\n#include <linux/kernel.h>\n\n \n#define SW_TWSI_V\t\tBIT_ULL(63)\t \n#define SW_TWSI_EIA\t\tBIT_ULL(61)\t \n#define SW_TWSI_R\t\tBIT_ULL(56)\t \n#define SW_TWSI_SOVR\t\tBIT_ULL(55)\t \n#define SW_TWSI_SIZE_SHIFT\t52\n#define SW_TWSI_ADDR_SHIFT\t40\n#define SW_TWSI_IA_SHIFT\t32\t\t \n\n \n#define SW_TWSI_OP_SHIFT\t57\n#define SW_TWSI_OP_7\t\t(0ULL << SW_TWSI_OP_SHIFT)\n#define SW_TWSI_OP_7_IA\t\t(1ULL << SW_TWSI_OP_SHIFT)\n#define SW_TWSI_OP_10\t\t(2ULL << SW_TWSI_OP_SHIFT)\n#define SW_TWSI_OP_10_IA\t(3ULL << SW_TWSI_OP_SHIFT)\n#define SW_TWSI_OP_TWSI_CLK\t(4ULL << SW_TWSI_OP_SHIFT)\n#define SW_TWSI_OP_EOP\t\t(6ULL << SW_TWSI_OP_SHIFT)  \n\n \n#define SW_TWSI_EOP_SHIFT\t32\n#define SW_TWSI_EOP_TWSI_DATA\t(SW_TWSI_OP_EOP | 1ULL << SW_TWSI_EOP_SHIFT)\n#define SW_TWSI_EOP_TWSI_CTL\t(SW_TWSI_OP_EOP | 2ULL << SW_TWSI_EOP_SHIFT)\n#define SW_TWSI_EOP_TWSI_CLKCTL\t(SW_TWSI_OP_EOP | 3ULL << SW_TWSI_EOP_SHIFT)\n#define SW_TWSI_EOP_TWSI_STAT\t(SW_TWSI_OP_EOP | 3ULL << SW_TWSI_EOP_SHIFT)\n#define SW_TWSI_EOP_TWSI_RST\t(SW_TWSI_OP_EOP | 7ULL << SW_TWSI_EOP_SHIFT)\n\n \n#define TWSI_CTL_CE\t\t0x80\t \n#define TWSI_CTL_ENAB\t\t0x40\t \n#define TWSI_CTL_STA\t\t0x20\t \n#define TWSI_CTL_STP\t\t0x10\t \n#define TWSI_CTL_IFLG\t\t0x08\t \n#define TWSI_CTL_AAK\t\t0x04\t \n\n \n#define STAT_BUS_ERROR\t\t0x00\n#define STAT_START\t\t0x08\n#define STAT_REP_START\t\t0x10\n#define STAT_TXADDR_ACK\t\t0x18\n#define STAT_TXADDR_NAK\t\t0x20\n#define STAT_TXDATA_ACK\t\t0x28\n#define STAT_TXDATA_NAK\t\t0x30\n#define STAT_LOST_ARB_38\t0x38\n#define STAT_RXADDR_ACK\t\t0x40\n#define STAT_RXADDR_NAK\t\t0x48\n#define STAT_RXDATA_ACK\t\t0x50\n#define STAT_RXDATA_NAK\t\t0x58\n#define STAT_SLAVE_60\t\t0x60\n#define STAT_LOST_ARB_68\t0x68\n#define STAT_SLAVE_70\t\t0x70\n#define STAT_LOST_ARB_78\t0x78\n#define STAT_SLAVE_80\t\t0x80\n#define STAT_SLAVE_88\t\t0x88\n#define STAT_GENDATA_ACK\t0x90\n#define STAT_GENDATA_NAK\t0x98\n#define STAT_SLAVE_A0\t\t0xA0\n#define STAT_SLAVE_A8\t\t0xA8\n#define STAT_LOST_ARB_B0\t0xB0\n#define STAT_SLAVE_LOST\t\t0xB8\n#define STAT_SLAVE_NAK\t\t0xC0\n#define STAT_SLAVE_ACK\t\t0xC8\n#define STAT_AD2W_ACK\t\t0xD0\n#define STAT_AD2W_NAK\t\t0xD8\n#define STAT_IDLE\t\t0xF8\n\n \n#define TWSI_INT_ST_INT\t\tBIT_ULL(0)\n#define TWSI_INT_TS_INT\t\tBIT_ULL(1)\n#define TWSI_INT_CORE_INT\tBIT_ULL(2)\n#define TWSI_INT_ST_EN\t\tBIT_ULL(4)\n#define TWSI_INT_TS_EN\t\tBIT_ULL(5)\n#define TWSI_INT_CORE_EN\tBIT_ULL(6)\n#define TWSI_INT_SDA_OVR\tBIT_ULL(8)\n#define TWSI_INT_SCL_OVR\tBIT_ULL(9)\n#define TWSI_INT_SDA\t\tBIT_ULL(10)\n#define TWSI_INT_SCL\t\tBIT_ULL(11)\n\n#define I2C_OCTEON_EVENT_WAIT 80  \n\n \nstruct octeon_i2c_reg_offset {\n\tunsigned int sw_twsi;\n\tunsigned int twsi_int;\n\tunsigned int sw_twsi_ext;\n};\n\n#define SW_TWSI(x)\t(x->roff.sw_twsi)\n#define TWSI_INT(x)\t(x->roff.twsi_int)\n#define SW_TWSI_EXT(x)\t(x->roff.sw_twsi_ext)\n\nstruct octeon_i2c {\n\twait_queue_head_t queue;\n\tstruct i2c_adapter adap;\n\tstruct octeon_i2c_reg_offset roff;\n\tstruct clk *clk;\n\tint irq;\n\tint hlc_irq;\t\t \n\tu32 twsi_freq;\n\tint sys_freq;\n\tvoid __iomem *twsi_base;\n\tstruct device *dev;\n\tbool hlc_enabled;\n\tbool broken_irq_mode;\n\tbool broken_irq_check;\n\tvoid (*int_enable)(struct octeon_i2c *);\n\tvoid (*int_disable)(struct octeon_i2c *);\n\tvoid (*hlc_int_enable)(struct octeon_i2c *);\n\tvoid (*hlc_int_disable)(struct octeon_i2c *);\n\tatomic_t int_enable_cnt;\n\tatomic_t hlc_int_enable_cnt;\n\tstruct i2c_smbus_alert_setup alert_data;\n\tstruct i2c_client *ara;\n};\n\nstatic inline void octeon_i2c_writeq_flush(u64 val, void __iomem *addr)\n{\n\t__raw_writeq(val, addr);\n\t__raw_readq(addr);\t \n}\n\n \nstatic inline void octeon_i2c_reg_write(struct octeon_i2c *i2c, u64 eop_reg, u8 data)\n{\n\tint tries = 1000;\n\tu64 tmp;\n\n\t__raw_writeq(SW_TWSI_V | eop_reg | data, i2c->twsi_base + SW_TWSI(i2c));\n\tdo {\n\t\ttmp = __raw_readq(i2c->twsi_base + SW_TWSI(i2c));\n\t\tif (--tries < 0)\n\t\t\treturn;\n\t} while ((tmp & SW_TWSI_V) != 0);\n}\n\n#define octeon_i2c_ctl_write(i2c, val)\t\t\t\t\t\\\n\tocteon_i2c_reg_write(i2c, SW_TWSI_EOP_TWSI_CTL, val)\n#define octeon_i2c_data_write(i2c, val)\t\t\t\t\t\\\n\tocteon_i2c_reg_write(i2c, SW_TWSI_EOP_TWSI_DATA, val)\n\n \nstatic inline int octeon_i2c_reg_read(struct octeon_i2c *i2c, u64 eop_reg,\n\t\t\t\t      int *error)\n{\n\tint tries = 1000;\n\tu64 tmp;\n\n\t__raw_writeq(SW_TWSI_V | eop_reg | SW_TWSI_R, i2c->twsi_base + SW_TWSI(i2c));\n\tdo {\n\t\ttmp = __raw_readq(i2c->twsi_base + SW_TWSI(i2c));\n\t\tif (--tries < 0) {\n\t\t\t \n\t\t\tif (error)\n\t\t\t\t*error = -EIO;\n\t\t\treturn 0;\n\t\t}\n\t} while ((tmp & SW_TWSI_V) != 0);\n\n\treturn tmp & 0xFF;\n}\n\n#define octeon_i2c_ctl_read(i2c)\t\t\t\t\t\\\n\tocteon_i2c_reg_read(i2c, SW_TWSI_EOP_TWSI_CTL, NULL)\n#define octeon_i2c_data_read(i2c, error)\t\t\t\t\\\n\tocteon_i2c_reg_read(i2c, SW_TWSI_EOP_TWSI_DATA, error)\n#define octeon_i2c_stat_read(i2c)\t\t\t\t\t\\\n\tocteon_i2c_reg_read(i2c, SW_TWSI_EOP_TWSI_STAT, NULL)\n\n \nstatic inline u64 octeon_i2c_read_int(struct octeon_i2c *i2c)\n{\n\treturn __raw_readq(i2c->twsi_base + TWSI_INT(i2c));\n}\n\n \nstatic inline void octeon_i2c_write_int(struct octeon_i2c *i2c, u64 data)\n{\n\tocteon_i2c_writeq_flush(data, i2c->twsi_base + TWSI_INT(i2c));\n}\n\n \nirqreturn_t octeon_i2c_isr(int irq, void *dev_id);\nint octeon_i2c_xfer(struct i2c_adapter *adap, struct i2c_msg *msgs, int num);\nint octeon_i2c_init_lowlevel(struct octeon_i2c *i2c);\nvoid octeon_i2c_set_clock(struct octeon_i2c *i2c);\nextern struct i2c_bus_recovery_info octeon_i2c_recovery_info;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}