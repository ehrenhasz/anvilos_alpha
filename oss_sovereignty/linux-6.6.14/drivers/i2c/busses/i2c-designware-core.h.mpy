{
  "module_name": "i2c-designware-core.h",
  "hash_id": "8624d7436ae659e538b7a3db9f0d4f5d1d75aaf535b3e4f7f056aef83af5e687",
  "original_prompt": "Ingested from linux-6.6.14/drivers/i2c/busses/i2c-designware-core.h",
  "human_readable_source": " \n \n\n#include <linux/bits.h>\n#include <linux/compiler_types.h>\n#include <linux/completion.h>\n#include <linux/dev_printk.h>\n#include <linux/errno.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/types.h>\n\n#define DW_IC_DEFAULT_FUNCTIONALITY\t\t(I2C_FUNC_I2C | \\\n\t\t\t\t\t\t I2C_FUNC_SMBUS_BYTE | \\\n\t\t\t\t\t\t I2C_FUNC_SMBUS_BYTE_DATA | \\\n\t\t\t\t\t\t I2C_FUNC_SMBUS_WORD_DATA | \\\n\t\t\t\t\t\t I2C_FUNC_SMBUS_BLOCK_DATA | \\\n\t\t\t\t\t\t I2C_FUNC_SMBUS_I2C_BLOCK)\n\n#define DW_IC_CON_MASTER\t\t\tBIT(0)\n#define DW_IC_CON_SPEED_STD\t\t\t(1 << 1)\n#define DW_IC_CON_SPEED_FAST\t\t\t(2 << 1)\n#define DW_IC_CON_SPEED_HIGH\t\t\t(3 << 1)\n#define DW_IC_CON_SPEED_MASK\t\t\tGENMASK(2, 1)\n#define DW_IC_CON_10BITADDR_SLAVE\t\tBIT(3)\n#define DW_IC_CON_10BITADDR_MASTER\t\tBIT(4)\n#define DW_IC_CON_RESTART_EN\t\t\tBIT(5)\n#define DW_IC_CON_SLAVE_DISABLE\t\t\tBIT(6)\n#define DW_IC_CON_STOP_DET_IFADDRESSED\t\tBIT(7)\n#define DW_IC_CON_TX_EMPTY_CTRL\t\t\tBIT(8)\n#define DW_IC_CON_RX_FIFO_FULL_HLD_CTRL\t\tBIT(9)\n#define DW_IC_CON_BUS_CLEAR_CTRL\t\tBIT(11)\n\n#define DW_IC_DATA_CMD_DAT\t\t\tGENMASK(7, 0)\n#define DW_IC_DATA_CMD_FIRST_DATA_BYTE\t\tBIT(11)\n\n \n#define DW_IC_CON\t\t\t\t0x00\n#define DW_IC_TAR\t\t\t\t0x04\n#define DW_IC_SAR\t\t\t\t0x08\n#define DW_IC_DATA_CMD\t\t\t\t0x10\n#define DW_IC_SS_SCL_HCNT\t\t\t0x14\n#define DW_IC_SS_SCL_LCNT\t\t\t0x18\n#define DW_IC_FS_SCL_HCNT\t\t\t0x1c\n#define DW_IC_FS_SCL_LCNT\t\t\t0x20\n#define DW_IC_HS_SCL_HCNT\t\t\t0x24\n#define DW_IC_HS_SCL_LCNT\t\t\t0x28\n#define DW_IC_INTR_STAT\t\t\t\t0x2c\n#define DW_IC_INTR_MASK\t\t\t\t0x30\n#define DW_IC_RAW_INTR_STAT\t\t\t0x34\n#define DW_IC_RX_TL\t\t\t\t0x38\n#define DW_IC_TX_TL\t\t\t\t0x3c\n#define DW_IC_CLR_INTR\t\t\t\t0x40\n#define DW_IC_CLR_RX_UNDER\t\t\t0x44\n#define DW_IC_CLR_RX_OVER\t\t\t0x48\n#define DW_IC_CLR_TX_OVER\t\t\t0x4c\n#define DW_IC_CLR_RD_REQ\t\t\t0x50\n#define DW_IC_CLR_TX_ABRT\t\t\t0x54\n#define DW_IC_CLR_RX_DONE\t\t\t0x58\n#define DW_IC_CLR_ACTIVITY\t\t\t0x5c\n#define DW_IC_CLR_STOP_DET\t\t\t0x60\n#define DW_IC_CLR_START_DET\t\t\t0x64\n#define DW_IC_CLR_GEN_CALL\t\t\t0x68\n#define DW_IC_ENABLE\t\t\t\t0x6c\n#define DW_IC_STATUS\t\t\t\t0x70\n#define DW_IC_TXFLR\t\t\t\t0x74\n#define DW_IC_RXFLR\t\t\t\t0x78\n#define DW_IC_SDA_HOLD\t\t\t\t0x7c\n#define DW_IC_TX_ABRT_SOURCE\t\t\t0x80\n#define DW_IC_ENABLE_STATUS\t\t\t0x9c\n#define DW_IC_CLR_RESTART_DET\t\t\t0xa8\n#define DW_IC_COMP_PARAM_1\t\t\t0xf4\n#define DW_IC_COMP_VERSION\t\t\t0xf8\n#define DW_IC_SDA_HOLD_MIN_VERS\t\t\t0x3131312A  \n#define DW_IC_COMP_TYPE\t\t\t\t0xfc\n#define DW_IC_COMP_TYPE_VALUE\t\t\t0x44570140  \n\n#define DW_IC_INTR_RX_UNDER\t\t\tBIT(0)\n#define DW_IC_INTR_RX_OVER\t\t\tBIT(1)\n#define DW_IC_INTR_RX_FULL\t\t\tBIT(2)\n#define DW_IC_INTR_TX_OVER\t\t\tBIT(3)\n#define DW_IC_INTR_TX_EMPTY\t\t\tBIT(4)\n#define DW_IC_INTR_RD_REQ\t\t\tBIT(5)\n#define DW_IC_INTR_TX_ABRT\t\t\tBIT(6)\n#define DW_IC_INTR_RX_DONE\t\t\tBIT(7)\n#define DW_IC_INTR_ACTIVITY\t\t\tBIT(8)\n#define DW_IC_INTR_STOP_DET\t\t\tBIT(9)\n#define DW_IC_INTR_START_DET\t\t\tBIT(10)\n#define DW_IC_INTR_GEN_CALL\t\t\tBIT(11)\n#define DW_IC_INTR_RESTART_DET\t\t\tBIT(12)\n#define DW_IC_INTR_MST_ON_HOLD\t\t\tBIT(13)\n\n#define DW_IC_INTR_DEFAULT_MASK\t\t\t(DW_IC_INTR_RX_FULL | \\\n\t\t\t\t\t\t DW_IC_INTR_TX_ABRT | \\\n\t\t\t\t\t\t DW_IC_INTR_STOP_DET)\n#define DW_IC_INTR_MASTER_MASK\t\t\t(DW_IC_INTR_DEFAULT_MASK | \\\n\t\t\t\t\t\t DW_IC_INTR_TX_EMPTY)\n#define DW_IC_INTR_SLAVE_MASK\t\t\t(DW_IC_INTR_DEFAULT_MASK | \\\n\t\t\t\t\t\t DW_IC_INTR_RX_UNDER | \\\n\t\t\t\t\t\t DW_IC_INTR_RD_REQ)\n\n#define DW_IC_ENABLE_ABORT\t\t\tBIT(1)\n\n#define DW_IC_STATUS_ACTIVITY\t\t\tBIT(0)\n#define DW_IC_STATUS_TFE\t\t\tBIT(2)\n#define DW_IC_STATUS_RFNE\t\t\tBIT(3)\n#define DW_IC_STATUS_MASTER_ACTIVITY\t\tBIT(5)\n#define DW_IC_STATUS_SLAVE_ACTIVITY\t\tBIT(6)\n\n#define DW_IC_SDA_HOLD_RX_SHIFT\t\t\t16\n#define DW_IC_SDA_HOLD_RX_MASK\t\t\tGENMASK(23, 16)\n\n#define DW_IC_ERR_TX_ABRT\t\t\t0x1\n\n#define DW_IC_TAR_10BITADDR_MASTER\t\tBIT(12)\n\n#define DW_IC_COMP_PARAM_1_SPEED_MODE_HIGH\t(BIT(2) | BIT(3))\n#define DW_IC_COMP_PARAM_1_SPEED_MODE_MASK\tGENMASK(3, 2)\n\n \n#define STATUS_ACTIVE\t\t\t\tBIT(0)\n#define STATUS_WRITE_IN_PROGRESS\t\tBIT(1)\n#define STATUS_READ_IN_PROGRESS\t\t\tBIT(2)\n#define STATUS_MASK\t\t\t\tGENMASK(2, 0)\n\n \n#define DW_IC_MASTER\t\t\t\t0\n#define DW_IC_SLAVE\t\t\t\t1\n\n \n#define ABRT_7B_ADDR_NOACK\t\t\t0\n#define ABRT_10ADDR1_NOACK\t\t\t1\n#define ABRT_10ADDR2_NOACK\t\t\t2\n#define ABRT_TXDATA_NOACK\t\t\t3\n#define ABRT_GCALL_NOACK\t\t\t4\n#define ABRT_GCALL_READ\t\t\t\t5\n#define ABRT_SBYTE_ACKDET\t\t\t7\n#define ABRT_SBYTE_NORSTRT\t\t\t9\n#define ABRT_10B_RD_NORSTRT\t\t\t10\n#define ABRT_MASTER_DIS\t\t\t\t11\n#define ARB_LOST\t\t\t\t12\n#define ABRT_SLAVE_FLUSH_TXFIFO\t\t\t13\n#define ABRT_SLAVE_ARBLOST\t\t\t14\n#define ABRT_SLAVE_RD_INTX\t\t\t15\n\n#define DW_IC_TX_ABRT_7B_ADDR_NOACK\t\tBIT(ABRT_7B_ADDR_NOACK)\n#define DW_IC_TX_ABRT_10ADDR1_NOACK\t\tBIT(ABRT_10ADDR1_NOACK)\n#define DW_IC_TX_ABRT_10ADDR2_NOACK\t\tBIT(ABRT_10ADDR2_NOACK)\n#define DW_IC_TX_ABRT_TXDATA_NOACK\t\tBIT(ABRT_TXDATA_NOACK)\n#define DW_IC_TX_ABRT_GCALL_NOACK\t\tBIT(ABRT_GCALL_NOACK)\n#define DW_IC_TX_ABRT_GCALL_READ\t\tBIT(ABRT_GCALL_READ)\n#define DW_IC_TX_ABRT_SBYTE_ACKDET\t\tBIT(ABRT_SBYTE_ACKDET)\n#define DW_IC_TX_ABRT_SBYTE_NORSTRT\t\tBIT(ABRT_SBYTE_NORSTRT)\n#define DW_IC_TX_ABRT_10B_RD_NORSTRT\t\tBIT(ABRT_10B_RD_NORSTRT)\n#define DW_IC_TX_ABRT_MASTER_DIS\t\tBIT(ABRT_MASTER_DIS)\n#define DW_IC_TX_ARB_LOST\t\t\tBIT(ARB_LOST)\n#define DW_IC_RX_ABRT_SLAVE_RD_INTX\t\tBIT(ABRT_SLAVE_RD_INTX)\n#define DW_IC_RX_ABRT_SLAVE_ARBLOST\t\tBIT(ABRT_SLAVE_ARBLOST)\n#define DW_IC_RX_ABRT_SLAVE_FLUSH_TXFIFO\tBIT(ABRT_SLAVE_FLUSH_TXFIFO)\n\n#define DW_IC_TX_ABRT_NOACK\t\t\t(DW_IC_TX_ABRT_7B_ADDR_NOACK | \\\n\t\t\t\t\t\t DW_IC_TX_ABRT_10ADDR1_NOACK | \\\n\t\t\t\t\t\t DW_IC_TX_ABRT_10ADDR2_NOACK | \\\n\t\t\t\t\t\t DW_IC_TX_ABRT_TXDATA_NOACK | \\\n\t\t\t\t\t\t DW_IC_TX_ABRT_GCALL_NOACK)\n\nstruct clk;\nstruct device;\nstruct reset_control;\n\n \nstruct dw_i2c_dev {\n\tstruct device\t\t*dev;\n\tstruct regmap\t\t*map;\n\tstruct regmap\t\t*sysmap;\n\tvoid __iomem\t\t*base;\n\tvoid __iomem\t\t*ext;\n\tstruct completion\tcmd_complete;\n\tstruct clk\t\t*clk;\n\tstruct clk\t\t*pclk;\n\tstruct reset_control\t*rst;\n\tstruct i2c_client\t*slave;\n\tu32\t\t\t(*get_clk_rate_khz) (struct dw_i2c_dev *dev);\n\tint\t\t\tcmd_err;\n\tstruct i2c_msg\t\t*msgs;\n\tint\t\t\tmsgs_num;\n\tint\t\t\tmsg_write_idx;\n\tu32\t\t\ttx_buf_len;\n\tu8\t\t\t*tx_buf;\n\tint\t\t\tmsg_read_idx;\n\tu32\t\t\trx_buf_len;\n\tu8\t\t\t*rx_buf;\n\tint\t\t\tmsg_err;\n\tunsigned int\t\tstatus;\n\tunsigned int\t\tabort_source;\n\tint\t\t\tirq;\n\tu32\t\t\tflags;\n\tstruct i2c_adapter\tadapter;\n\tu32\t\t\tfunctionality;\n\tu32\t\t\tmaster_cfg;\n\tu32\t\t\tslave_cfg;\n\tunsigned int\t\ttx_fifo_depth;\n\tunsigned int\t\trx_fifo_depth;\n\tint\t\t\trx_outstanding;\n\tstruct i2c_timings\ttimings;\n\tu32\t\t\tsda_hold_time;\n\tu16\t\t\tss_hcnt;\n\tu16\t\t\tss_lcnt;\n\tu16\t\t\tfs_hcnt;\n\tu16\t\t\tfs_lcnt;\n\tu16\t\t\tfp_hcnt;\n\tu16\t\t\tfp_lcnt;\n\tu16\t\t\ths_hcnt;\n\tu16\t\t\ths_lcnt;\n\tint\t\t\t(*acquire_lock)(void);\n\tvoid\t\t\t(*release_lock)(void);\n\tint\t\t\tsemaphore_idx;\n\tbool\t\t\tshared_with_punit;\n\tvoid\t\t\t(*disable)(struct dw_i2c_dev *dev);\n\tint\t\t\t(*init)(struct dw_i2c_dev *dev);\n\tint\t\t\t(*set_sda_hold_time)(struct dw_i2c_dev *dev);\n\tint\t\t\tmode;\n\tstruct i2c_bus_recovery_info rinfo;\n};\n\n#define ACCESS_INTR_MASK\t\t\tBIT(0)\n#define ACCESS_NO_IRQ_SUSPEND\t\t\tBIT(1)\n#define ARBITRATION_SEMAPHORE\t\t\tBIT(2)\n\n#define MODEL_MSCC_OCELOT\t\t\tBIT(8)\n#define MODEL_BAIKAL_BT1\t\t\tBIT(9)\n#define MODEL_AMD_NAVI_GPU\t\t\tBIT(10)\n#define MODEL_WANGXUN_SP\t\t\tBIT(11)\n#define MODEL_MASK\t\t\t\tGENMASK(11, 8)\n\n \n#define AMD_UCSI_INTR_REG\t\t\t0x474\n#define AMD_UCSI_INTR_EN\t\t\t0xd\n\n#define TXGBE_TX_FIFO_DEPTH\t\t\t4\n#define TXGBE_RX_FIFO_DEPTH\t\t\t0\n\nstruct i2c_dw_semaphore_callbacks {\n\tint\t(*probe)(struct dw_i2c_dev *dev);\n\tvoid\t(*remove)(struct dw_i2c_dev *dev);\n};\n\nint i2c_dw_init_regmap(struct dw_i2c_dev *dev);\nu32 i2c_dw_scl_hcnt(u32 ic_clk, u32 tSYMBOL, u32 tf, int cond, int offset);\nu32 i2c_dw_scl_lcnt(u32 ic_clk, u32 tLOW, u32 tf, int offset);\nint i2c_dw_set_sda_hold(struct dw_i2c_dev *dev);\nu32 i2c_dw_clk_rate(struct dw_i2c_dev *dev);\nint i2c_dw_prepare_clk(struct dw_i2c_dev *dev, bool prepare);\nint i2c_dw_acquire_lock(struct dw_i2c_dev *dev);\nvoid i2c_dw_release_lock(struct dw_i2c_dev *dev);\nint i2c_dw_wait_bus_not_busy(struct dw_i2c_dev *dev);\nint i2c_dw_handle_tx_abort(struct dw_i2c_dev *dev);\nint i2c_dw_set_fifo_size(struct dw_i2c_dev *dev);\nu32 i2c_dw_func(struct i2c_adapter *adap);\nvoid i2c_dw_disable(struct dw_i2c_dev *dev);\n\nstatic inline void __i2c_dw_enable(struct dw_i2c_dev *dev)\n{\n\tdev->status |= STATUS_ACTIVE;\n\tregmap_write(dev->map, DW_IC_ENABLE, 1);\n}\n\nstatic inline void __i2c_dw_disable_nowait(struct dw_i2c_dev *dev)\n{\n\tregmap_write(dev->map, DW_IC_ENABLE, 0);\n\tdev->status &= ~STATUS_ACTIVE;\n}\n\nvoid __i2c_dw_disable(struct dw_i2c_dev *dev);\n\nextern void i2c_dw_configure_master(struct dw_i2c_dev *dev);\nextern int i2c_dw_probe_master(struct dw_i2c_dev *dev);\n\n#if IS_ENABLED(CONFIG_I2C_DESIGNWARE_SLAVE)\nextern void i2c_dw_configure_slave(struct dw_i2c_dev *dev);\nextern int i2c_dw_probe_slave(struct dw_i2c_dev *dev);\n#else\nstatic inline void i2c_dw_configure_slave(struct dw_i2c_dev *dev) { }\nstatic inline int i2c_dw_probe_slave(struct dw_i2c_dev *dev) { return -EINVAL; }\n#endif\n\nstatic inline int i2c_dw_probe(struct dw_i2c_dev *dev)\n{\n\tswitch (dev->mode) {\n\tcase DW_IC_SLAVE:\n\t\treturn i2c_dw_probe_slave(dev);\n\tcase DW_IC_MASTER:\n\t\treturn i2c_dw_probe_master(dev);\n\tdefault:\n\t\tdev_err(dev->dev, \"Wrong operation mode: %d\\n\", dev->mode);\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic inline void i2c_dw_configure(struct dw_i2c_dev *dev)\n{\n\tif (i2c_detect_slave_mode(dev->dev))\n\t\ti2c_dw_configure_slave(dev);\n\telse\n\t\ti2c_dw_configure_master(dev);\n}\n\n#if IS_ENABLED(CONFIG_I2C_DESIGNWARE_BAYTRAIL)\nint i2c_dw_baytrail_probe_lock_support(struct dw_i2c_dev *dev);\n#endif\n\n#if IS_ENABLED(CONFIG_I2C_DESIGNWARE_AMDPSP)\nint i2c_dw_amdpsp_probe_lock_support(struct dw_i2c_dev *dev);\n#endif\n\nint i2c_dw_validate_speed(struct dw_i2c_dev *dev);\nvoid i2c_dw_adjust_bus_speed(struct dw_i2c_dev *dev);\n\n#if IS_ENABLED(CONFIG_ACPI)\nint i2c_dw_acpi_configure(struct device *device);\n#else\nstatic inline int i2c_dw_acpi_configure(struct device *device) { return -ENODEV; }\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}