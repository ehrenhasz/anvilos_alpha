{
  "module_name": "ftrace.c",
  "hash_id": "d67aab97e0c8d57d4f06fa6a176f04ca7fef79ca4c69dd611f1690228319d0a5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwtracing/stm/ftrace.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/stm.h>\n#include <linux/trace.h>\n\n#define STM_FTRACE_NR_CHANNELS 1\n#define STM_FTRACE_CHAN 0\n\nstatic int stm_ftrace_link(struct stm_source_data *data);\nstatic void stm_ftrace_unlink(struct stm_source_data *data);\n\nstatic struct stm_ftrace {\n\tstruct stm_source_data\tdata;\n\tstruct trace_export\tftrace;\n} stm_ftrace = {\n\t.data\t= {\n\t\t.name\t\t= \"ftrace\",\n\t\t.nr_chans\t= STM_FTRACE_NR_CHANNELS,\n\t\t.link\t\t= stm_ftrace_link,\n\t\t.unlink\t\t= stm_ftrace_unlink,\n\t},\n};\n\n \nstatic void notrace\nstm_ftrace_write(struct trace_export *export, const void *buf, unsigned int len)\n{\n\tstruct stm_ftrace *stm = container_of(export, struct stm_ftrace, ftrace);\n\t \n\tunsigned int cpu = smp_processor_id();\n\n\tstm_source_write(&stm->data, STM_FTRACE_CHAN + cpu, buf, len);\n}\n\nstatic int stm_ftrace_link(struct stm_source_data *data)\n{\n\tstruct stm_ftrace *sf = container_of(data, struct stm_ftrace, data);\n\n\tsf->ftrace.write = stm_ftrace_write;\n\tsf->ftrace.flags = TRACE_EXPORT_FUNCTION | TRACE_EXPORT_EVENT\n\t\t\t| TRACE_EXPORT_MARKER;\n\n\treturn register_ftrace_export(&sf->ftrace);\n}\n\nstatic void stm_ftrace_unlink(struct stm_source_data *data)\n{\n\tstruct stm_ftrace *sf = container_of(data, struct stm_ftrace, data);\n\n\tunregister_ftrace_export(&sf->ftrace);\n}\n\nstatic int __init stm_ftrace_init(void)\n{\n\tint ret;\n\n\tstm_ftrace.data.nr_chans = roundup_pow_of_two(num_possible_cpus());\n\tret = stm_source_register_device(NULL, &stm_ftrace.data);\n\tif (ret)\n\t\tpr_err(\"Failed to register stm_source - ftrace.\\n\");\n\n\treturn ret;\n}\n\nstatic void __exit stm_ftrace_exit(void)\n{\n\tstm_source_unregister_device(&stm_ftrace.data);\n}\n\nmodule_init(stm_ftrace_init);\nmodule_exit(stm_ftrace_exit);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DESCRIPTION(\"stm_ftrace driver\");\nMODULE_AUTHOR(\"Chunyan Zhang <zhang.chunyan@linaro.org>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}