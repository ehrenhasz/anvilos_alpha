{
  "module_name": "coresight-dummy.c",
  "hash_id": "bbca4ee9ba6f53c1ffc5b95ab432fc9ac62cb27eb7f2448a342f080047cac01c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwtracing/coresight/coresight-dummy.c",
  "human_readable_source": "\n \n\n#include <linux/coresight.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n\n#include \"coresight-priv.h\"\n\nstruct dummy_drvdata {\n\tstruct device\t\t\t*dev;\n\tstruct coresight_device\t\t*csdev;\n};\n\nDEFINE_CORESIGHT_DEVLIST(source_devs, \"dummy_source\");\nDEFINE_CORESIGHT_DEVLIST(sink_devs, \"dummy_sink\");\n\nstatic int dummy_source_enable(struct coresight_device *csdev,\n\t\t\t       struct perf_event *event, enum cs_mode mode)\n{\n\tdev_dbg(csdev->dev.parent, \"Dummy source enabled\\n\");\n\n\treturn 0;\n}\n\nstatic void dummy_source_disable(struct coresight_device *csdev,\n\t\t\t\t struct perf_event *event)\n{\n\tdev_dbg(csdev->dev.parent, \"Dummy source disabled\\n\");\n}\n\nstatic int dummy_sink_enable(struct coresight_device *csdev, enum cs_mode mode,\n\t\t\t\tvoid *data)\n{\n\tdev_dbg(csdev->dev.parent, \"Dummy sink enabled\\n\");\n\n\treturn 0;\n}\n\nstatic int dummy_sink_disable(struct coresight_device *csdev)\n{\n\tdev_dbg(csdev->dev.parent, \"Dummy sink disabled\\n\");\n\n\treturn 0;\n}\n\nstatic const struct coresight_ops_source dummy_source_ops = {\n\t.enable\t= dummy_source_enable,\n\t.disable = dummy_source_disable,\n};\n\nstatic const struct coresight_ops dummy_source_cs_ops = {\n\t.source_ops = &dummy_source_ops,\n};\n\nstatic const struct coresight_ops_sink dummy_sink_ops = {\n\t.enable\t= dummy_sink_enable,\n\t.disable = dummy_sink_disable,\n};\n\nstatic const struct coresight_ops dummy_sink_cs_ops = {\n\t.sink_ops = &dummy_sink_ops,\n};\n\nstatic int dummy_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct device_node *node = dev->of_node;\n\tstruct coresight_platform_data *pdata;\n\tstruct dummy_drvdata *drvdata;\n\tstruct coresight_desc desc = { 0 };\n\n\tif (of_device_is_compatible(node, \"arm,coresight-dummy-source\")) {\n\n\t\tdesc.name = coresight_alloc_device_name(&source_devs, dev);\n\t\tif (!desc.name)\n\t\t\treturn -ENOMEM;\n\n\t\tdesc.type = CORESIGHT_DEV_TYPE_SOURCE;\n\t\tdesc.subtype.source_subtype =\n\t\t\t\t\tCORESIGHT_DEV_SUBTYPE_SOURCE_OTHERS;\n\t\tdesc.ops = &dummy_source_cs_ops;\n\t} else if (of_device_is_compatible(node, \"arm,coresight-dummy-sink\")) {\n\t\tdesc.name = coresight_alloc_device_name(&sink_devs, dev);\n\t\tif (!desc.name)\n\t\t\treturn -ENOMEM;\n\n\t\tdesc.type = CORESIGHT_DEV_TYPE_SINK;\n\t\tdesc.subtype.sink_subtype = CORESIGHT_DEV_SUBTYPE_SINK_DUMMY;\n\t\tdesc.ops = &dummy_sink_cs_ops;\n\t} else {\n\t\tdev_err(dev, \"Device type not set\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tpdata = coresight_get_platform_data(dev);\n\tif (IS_ERR(pdata))\n\t\treturn PTR_ERR(pdata);\n\tpdev->dev.platform_data = pdata;\n\n\tdrvdata = devm_kzalloc(dev, sizeof(*drvdata), GFP_KERNEL);\n\tif (!drvdata)\n\t\treturn -ENOMEM;\n\n\tdrvdata->dev = &pdev->dev;\n\tplatform_set_drvdata(pdev, drvdata);\n\n\tdesc.pdata = pdev->dev.platform_data;\n\tdesc.dev = &pdev->dev;\n\tdrvdata->csdev = coresight_register(&desc);\n\tif (IS_ERR(drvdata->csdev))\n\t\treturn PTR_ERR(drvdata->csdev);\n\n\tpm_runtime_enable(dev);\n\tdev_dbg(dev, \"Dummy device initialized\\n\");\n\n\treturn 0;\n}\n\nstatic int dummy_remove(struct platform_device *pdev)\n{\n\tstruct dummy_drvdata *drvdata = platform_get_drvdata(pdev);\n\tstruct device *dev = &pdev->dev;\n\n\tpm_runtime_disable(dev);\n\tcoresight_unregister(drvdata->csdev);\n\treturn 0;\n}\n\nstatic const struct of_device_id dummy_match[] = {\n\t{.compatible = \"arm,coresight-dummy-source\"},\n\t{.compatible = \"arm,coresight-dummy-sink\"},\n\t{},\n};\n\nstatic struct platform_driver dummy_driver = {\n\t.probe\t= dummy_probe,\n\t.remove\t= dummy_remove,\n\t.driver\t= {\n\t\t.name   = \"coresight-dummy\",\n\t\t.of_match_table = dummy_match,\n\t},\n};\n\nmodule_platform_driver(dummy_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"CoreSight dummy driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}