{
  "module_name": "coresight-cfg-afdo.c",
  "hash_id": "1c32ec52159ae487ad5f19bf47cec37452e481507d970753972a923ca835cf5a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwtracing/coresight/coresight-cfg-afdo.c",
  "human_readable_source": "\n \n\n#include \"coresight-config.h\"\n\n \n#if IS_ENABLED(CONFIG_CORESIGHT_SOURCE_ETM4X)\n#include \"coresight-etm4x-cfg.h\"\n\n \n\n \n\n \nstatic struct cscfg_parameter_desc strobe_params[] = {\n\t{\n\t\t.name = \"window\",\n\t\t.value = 5000,\n\t},\n\t{\n\t\t.name = \"period\",\n\t\t.value = 10000,\n\t},\n};\n\nstatic struct cscfg_regval_desc strobe_regs[] = {\n\t \n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE,\n\t\t.offset = TRCRSCTLRn(2),\n\t\t.hw_info = ETM4_CFG_RES_SEL,\n\t\t.val32 = 0x20001,\n\t},\n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE,\n\t\t.offset = TRCRSCTLRn(3),\n\t\t.hw_info = ETM4_CFG_RES_SEQ,\n\t\t.val32 = 0x20002,\n\t},\n\t \n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE | CS_CFG_REG_TYPE_VAL_SAVE,\n\t\t.offset = TRCCNTVRn(0),\n\t\t.hw_info = ETM4_CFG_RES_CTR,\n\t},\n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE | CS_CFG_REG_TYPE_VAL_PARAM,\n\t\t.offset = TRCCNTRLDVRn(0),\n\t\t.hw_info = ETM4_CFG_RES_CTR,\n\t\t.val32 = 0,\n\t},\n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE,\n\t\t.offset = TRCCNTCTLRn(0),\n\t\t.hw_info = ETM4_CFG_RES_CTR,\n\t\t.val32 = 0x10001,\n\t},\n\t \n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE | CS_CFG_REG_TYPE_VAL_SAVE,\n\t\t.offset = TRCCNTVRn(1),\n\t\t.hw_info = ETM4_CFG_RES_CTR,\n\t},\n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE | CS_CFG_REG_TYPE_VAL_PARAM,\n\t\t.offset = TRCCNTRLDVRn(1),\n\t\t.hw_info = ETM4_CFG_RES_CTR,\n\t\t.val32 = 1,\n\t},\n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE,\n\t\t.offset = TRCCNTCTLRn(1),\n\t\t.hw_info = ETM4_CFG_RES_CTR,\n\t\t.val32 = 0x8102,\n\t},\n\t \n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE,\n\t\t.offset = TRCSEQEVRn(0),\n\t\t.hw_info = ETM4_CFG_RES_SEQ,\n\t\t.val32 = 0x0081,\n\t},\n\t{\n\t\t.type = CS_CFG_REG_TYPE_RESOURCE,\n\t\t.offset = TRCSEQEVRn(1),\n\t\t.hw_info = ETM4_CFG_RES_SEQ,\n\t\t.val32 = 0x0000,\n\t},\n\t \n\t{\n\t\t.type = CS_CFG_REG_TYPE_STD | CS_CFG_REG_TYPE_VAL_MASK,\n\t\t.offset = TRCVICTLR,\n\t\t.val32 = 0x0003,\n\t\t.mask32 = 0x0003,\n\t},\n\t \n};\n\nstruct cscfg_feature_desc strobe_etm4x = {\n\t.name = \"strobing\",\n\t.description = \"Generate periodic trace capture windows.\\n\"\n\t\t       \"parameter \\'window\\': a number of CPU cycles (W)\\n\"\n\t\t       \"parameter \\'period\\': trace enabled for W cycles every period x W cycles\\n\",\n\t.match_flags = CS_CFG_MATCH_CLASS_SRC_ETM4,\n\t.nr_params = ARRAY_SIZE(strobe_params),\n\t.params_desc = strobe_params,\n\t.nr_regs = ARRAY_SIZE(strobe_regs),\n\t.regs_desc = strobe_regs,\n};\n\n \n\n \n#define AFDO_NR_PRESETS\t9\n \n#define AFDO_NR_PARAMS\tARRAY_SIZE(strobe_params)\n\nstatic const char *afdo_ref_names[] = {\n\t\"strobing\",\n};\n\n \nstatic u64 afdo_presets[AFDO_NR_PRESETS][AFDO_NR_PARAMS] = {\n\t{ 5000, 2 },\n\t{ 5000, 4 },\n\t{ 5000, 8 },\n\t{ 5000, 16 },\n\t{ 5000, 64 },\n\t{ 5000, 128 },\n\t{ 5000, 512 },\n\t{ 5000, 1024 },\n\t{ 5000, 4096 },\n};\n\nstruct cscfg_config_desc afdo_etm4x = {\n\t.name = \"autofdo\",\n\t.description = \"Setup ETMs with strobing for autofdo\\n\"\n\t\"Supplied presets allow experimentation with mark-space ratio for various loads\\n\",\n\t.nr_feat_refs = ARRAY_SIZE(afdo_ref_names),\n\t.feat_ref_names = afdo_ref_names,\n\t.nr_presets = AFDO_NR_PRESETS,\n\t.nr_total_params = AFDO_NR_PARAMS,\n\t.presets = &afdo_presets[0][0],\n};\n\n \n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}