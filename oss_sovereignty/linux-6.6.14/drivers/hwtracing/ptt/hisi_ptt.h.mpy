{
  "module_name": "hisi_ptt.h",
  "hash_id": "a5a18b6c2dc80c19a6f82e7d6146ef1c4096629133301b55a7194fae44e24148",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwtracing/ptt/hisi_ptt.h",
  "human_readable_source": " \n \n\n#ifndef _HISI_PTT_H\n#define _HISI_PTT_H\n\n#include <linux/bits.h>\n#include <linux/cpumask.h>\n#include <linux/device.h>\n#include <linux/kfifo.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/notifier.h>\n#include <linux/pci.h>\n#include <linux/perf_event.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n\n#define DRV_NAME \"hisi_ptt\"\n\n \n#define HISI_PTT_TUNING_CTRL\t\t0x0000\n#define   HISI_PTT_TUNING_CTRL_CODE\tGENMASK(15, 0)\n#define   HISI_PTT_TUNING_CTRL_SUB\tGENMASK(23, 16)\n#define HISI_PTT_TUNING_DATA\t\t0x0004\n#define   HISI_PTT_TUNING_DATA_VAL_MASK\tGENMASK(15, 0)\n#define HISI_PTT_TRACE_ADDR_SIZE\t0x0800\n#define HISI_PTT_TRACE_ADDR_BASE_LO_0\t0x0810\n#define HISI_PTT_TRACE_ADDR_BASE_HI_0\t0x0814\n#define HISI_PTT_TRACE_ADDR_STRIDE\t0x8\n#define HISI_PTT_TRACE_CTRL\t\t0x0850\n#define   HISI_PTT_TRACE_CTRL_EN\tBIT(0)\n#define   HISI_PTT_TRACE_CTRL_RST\tBIT(1)\n#define   HISI_PTT_TRACE_CTRL_RXTX_SEL\tGENMASK(3, 2)\n#define   HISI_PTT_TRACE_CTRL_TYPE_SEL\tGENMASK(7, 4)\n#define   HISI_PTT_TRACE_CTRL_DATA_FORMAT\tBIT(14)\n#define   HISI_PTT_TRACE_CTRL_FILTER_MODE\tBIT(15)\n#define   HISI_PTT_TRACE_CTRL_TARGET_SEL\tGENMASK(31, 16)\n#define HISI_PTT_TRACE_INT_STAT\t\t0x0890\n#define   HISI_PTT_TRACE_INT_STAT_MASK\tGENMASK(3, 0)\n#define HISI_PTT_TRACE_INT_MASK\t\t0x0894\n#define HISI_PTT_TUNING_INT_STAT\t0x0898\n#define   HISI_PTT_TUNING_INT_STAT_MASK\tBIT(0)\n#define HISI_PTT_TRACE_WR_STS\t\t0x08a0\n#define   HISI_PTT_TRACE_WR_STS_WRITE\tGENMASK(27, 0)\n#define   HISI_PTT_TRACE_WR_STS_BUFFER\tGENMASK(29, 28)\n#define HISI_PTT_TRACE_STS\t\t0x08b0\n#define   HISI_PTT_TRACE_IDLE\t\tBIT(0)\n#define HISI_PTT_DEVICE_RANGE\t\t0x0fe0\n#define   HISI_PTT_DEVICE_RANGE_UPPER\tGENMASK(31, 16)\n#define   HISI_PTT_DEVICE_RANGE_LOWER\tGENMASK(15, 0)\n#define HISI_PTT_LOCATION\t\t0x0fe8\n#define   HISI_PTT_CORE_ID\t\tGENMASK(15, 0)\n#define   HISI_PTT_SICL_ID\t\tGENMASK(31, 16)\n\n \n#define HISI_PTT_TRACE_DMA_IRQ\t\t\t0\n#define HISI_PTT_TRACE_BUF_CNT\t\t\t4\n#define HISI_PTT_TRACE_BUF_SIZE\t\t\tSZ_4M\n#define HISI_PTT_TRACE_TOTAL_BUF_SIZE\t\t(HISI_PTT_TRACE_BUF_SIZE * \\\n\t\t\t\t\t\t HISI_PTT_TRACE_BUF_CNT)\n \n#define HISI_PTT_RESET_TIMEOUT_US\t10UL\n#define HISI_PTT_RESET_POLL_INTERVAL_US\t1UL\n \n#define HISI_PTT_WAIT_TUNE_TIMEOUT_US\t1000000UL\n#define HISI_PTT_WAIT_TRACE_TIMEOUT_US\t100UL\n#define HISI_PTT_WAIT_POLL_INTERVAL_US\t10UL\n\n \n#define HISI_PTT_FILTER_UPDATE_FIFO_SIZE\t16\n \n#define HISI_PTT_WORK_DELAY_MS\t\t\t100UL\n\n#define HISI_PCIE_CORE_PORT_ID(devfn)\t((PCI_SLOT(devfn) & 0x7) << 1)\n\n \n#define HISI_PTT_PMU_FILTER_IS_PORT\tBIT(19)\n#define HISI_PTT_PMU_FILTER_VAL_MASK\tGENMASK(15, 0)\n#define HISI_PTT_PMU_DIRECTION_MASK\tGENMASK(23, 20)\n#define HISI_PTT_PMU_TYPE_MASK\t\tGENMASK(31, 24)\n#define HISI_PTT_PMU_FORMAT_MASK\tGENMASK(35, 32)\n\n \nstruct hisi_ptt_tune_desc {\n\tstruct hisi_ptt *hisi_ptt;\n\tconst char *name;\n\tu32 event_code;\n};\n\n \nstruct hisi_ptt_dma_buffer {\n\tdma_addr_t dma;\n\tvoid *addr;\n};\n\n \nstruct hisi_ptt_trace_ctrl {\n\tstruct hisi_ptt_dma_buffer *trace_buf;\n\tstruct perf_output_handle handle;\n\tu32 buf_index;\n\tint on_cpu;\n\tbool started;\n\tbool is_port;\n\tu32 direction:2;\n\tu32 filter:16;\n\tu32 format:1;\n\tu32 type:4;\n};\n\n \n#define HISI_PTT_RP_FILTERS_GRP_NAME\t\"root_port_filters\"\n#define HISI_PTT_REQ_FILTERS_GRP_NAME\t\"requester_filters\"\n\n \nstruct hisi_ptt_filter_desc {\n\tstruct device_attribute attr;\n\tstruct list_head list;\n\tbool is_port;\n\tchar *name;\n\tu16 devid;\n};\n\n \nstruct hisi_ptt_filter_update_info {\n\tbool is_port;\n\tbool is_add;\n\tu16 devid;\n};\n\n \nstruct hisi_ptt_pmu_buf {\n\tsize_t length;\n\tint nr_pages;\n\tvoid *base;\n\tlong pos;\n};\n\n \nstruct hisi_ptt {\n\tstruct hisi_ptt_trace_ctrl trace_ctrl;\n\tstruct notifier_block hisi_ptt_nb;\n\tstruct hlist_node hotplug_node;\n\tstruct pmu hisi_ptt_pmu;\n\tvoid __iomem *iobase;\n\tstruct pci_dev *pdev;\n\tstruct mutex tune_lock;\n\tspinlock_t pmu_lock;\n\tint trace_irq;\n\tu32 upper_bdf;\n\tu32 lower_bdf;\n\n\t \n\tstruct list_head port_filters;\n\tstruct list_head req_filters;\n\tstruct mutex filter_lock;\n\tbool sysfs_inited;\n\tu16 port_mask;\n\n\t \n\tstruct delayed_work work;\n\tspinlock_t filter_update_lock;\n\tDECLARE_KFIFO(filter_update_kfifo, struct hisi_ptt_filter_update_info,\n\t\t      HISI_PTT_FILTER_UPDATE_FIFO_SIZE);\n};\n\n#define to_hisi_ptt(pmu) container_of(pmu, struct hisi_ptt, hisi_ptt_pmu)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}