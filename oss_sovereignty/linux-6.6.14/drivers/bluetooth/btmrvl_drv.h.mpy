{
  "module_name": "btmrvl_drv.h",
  "hash_id": "4841c2b0405c4e7eaa1d0580f504382cdf21e957684e6ef0dfddf043aa27ba6a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/bluetooth/btmrvl_drv.h",
  "human_readable_source": " \n \n\n#include <linux/kthread.h>\n#include <linux/bitops.h>\n#include <linux/slab.h>\n#include <net/bluetooth/bluetooth.h>\n#include <linux/err.h>\n#include <linux/gfp.h>\n#include <linux/interrupt.h>\n#include <linux/io.h>\n#include <linux/of_platform.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n#include <linux/of_irq.h>\n\n#define BTM_HEADER_LEN\t\t\t4\n#define BTM_UPLD_SIZE\t\t\t2312\n\n \n#define WAIT_UNTIL_HS_STATE_CHANGED\tmsecs_to_jiffies(5000)\n \n#define WAIT_UNTIL_CMD_RESP\t\tmsecs_to_jiffies(5000)\n\nenum rdwr_status {\n\tRDWR_STATUS_SUCCESS = 0,\n\tRDWR_STATUS_FAILURE = 1,\n\tRDWR_STATUS_DONE = 2\n};\n\n#define FW_DUMP_MAX_NAME_LEN    8\n#define FW_DUMP_HOST_READY      0xEE\n#define FW_DUMP_DONE            0xFF\n#define FW_DUMP_READ_DONE       0xFE\n\nstruct memory_type_mapping {\n\tu8 mem_name[FW_DUMP_MAX_NAME_LEN];\n\tu8 *mem_ptr;\n\tu32 mem_size;\n\tu8 done_flag;\n};\n\nstruct btmrvl_thread {\n\tstruct task_struct *task;\n\twait_queue_head_t wait_q;\n\tvoid *priv;\n};\n\nstruct btmrvl_device {\n\tvoid *card;\n\tstruct hci_dev *hcidev;\n\n\tu8 dev_type;\n\n\tu8 tx_dnld_rdy;\n\n\tu8 psmode;\n\tu8 pscmd;\n\tu8 hsmode;\n\tu8 hscmd;\n\n\t \n\tu16 gpio_gap;\n\n\tu8 hscfgcmd;\n\tu8 sendcmdflag;\n};\n\nstruct btmrvl_adapter {\n\tvoid *hw_regs_buf;\n\tu8 *hw_regs;\n\tu32 int_count;\n\tstruct sk_buff_head tx_queue;\n\tu8 psmode;\n\tu8 ps_state;\n\tu8 hs_state;\n\tu8 wakeup_tries;\n\twait_queue_head_t cmd_wait_q;\n\twait_queue_head_t event_hs_wait_q;\n\tu8 cmd_complete;\n\tbool is_suspended;\n\tbool is_suspending;\n};\n\nstruct btmrvl_private {\n\tstruct btmrvl_device btmrvl_dev;\n\tstruct btmrvl_adapter *adapter;\n\tstruct btmrvl_thread main_thread;\n\tint (*hw_host_to_card)(struct btmrvl_private *priv,\n\t\t\t\tu8 *payload, u16 nb);\n\tint (*hw_wakeup_firmware)(struct btmrvl_private *priv);\n\tint (*hw_process_int_status)(struct btmrvl_private *priv);\n\tspinlock_t driver_lock;\t\t \n#ifdef CONFIG_DEBUG_FS\n\tvoid *debugfs_data;\n#endif\n\tbool surprise_removed;\n};\n\n#define MRVL_VENDOR_PKT\t\t\t0xFE\n\n \n#define BT_CMD_PSCAN_WIN_REPORT_ENABLE\t0xFC03\n#define BT_CMD_ROUTE_SCO_TO_HOST\t0xFC1D\n#define BT_CMD_SET_BDADDR\t\t0xFC22\n#define BT_CMD_AUTO_SLEEP_MODE\t\t0xFC23\n#define BT_CMD_HOST_SLEEP_CONFIG\t0xFC59\n#define BT_CMD_HOST_SLEEP_ENABLE\t0xFC5A\n#define BT_CMD_MODULE_CFG_REQ\t\t0xFC5B\n#define BT_CMD_LOAD_CONFIG_DATA\t\t0xFC61\n\n \n#define MODULE_BRINGUP_REQ\t\t0xF1\n#define MODULE_BROUGHT_UP\t\t0x00\n#define MODULE_ALREADY_UP\t\t0x0C\n\n#define MODULE_SHUTDOWN_REQ\t\t0xF2\n\n \n#define BT_EVENT_AUTO_SLEEP_MODE\t0x23\n#define BT_EVENT_HOST_SLEEP_CONFIG\t0x59\n#define BT_EVENT_HOST_SLEEP_ENABLE\t0x5A\n#define BT_EVENT_MODULE_CFG_REQ\t\t0x5B\n#define BT_EVENT_POWER_STATE\t\t0x20\n\n \n#define BT_PS_ENABLE\t\t\t0x02\n#define BT_PS_DISABLE\t\t\t0x03\n#define BT_PS_SLEEP\t\t\t0x01\n\n \n#define HS_ACTIVATED\t\t\t0x01\n#define HS_DEACTIVATED\t\t\t0x00\n\n \n#define PS_SLEEP\t\t\t0x01\n#define PS_AWAKE\t\t\t0x00\n\n#define BT_CAL_HDR_LEN\t\t\t4\n#define BT_CAL_DATA_SIZE\t\t28\n\nstruct btmrvl_event {\n\tu8 ec;\t\t \n\tu8 length;\n\tu8 data[4];\n} __packed;\n\n \n\nint btmrvl_register_hdev(struct btmrvl_private *priv);\nstruct btmrvl_private *btmrvl_add_card(void *card);\nint btmrvl_remove_card(struct btmrvl_private *priv);\n\nvoid btmrvl_interrupt(struct btmrvl_private *priv);\n\nbool btmrvl_check_evtpkt(struct btmrvl_private *priv, struct sk_buff *skb);\nint btmrvl_process_event(struct btmrvl_private *priv, struct sk_buff *skb);\n\nint btmrvl_send_module_cfg_cmd(struct btmrvl_private *priv, u8 subcmd);\nint btmrvl_pscan_window_reporting(struct btmrvl_private *priv, u8 subcmd);\nint btmrvl_send_hscfg_cmd(struct btmrvl_private *priv);\nint btmrvl_enable_ps(struct btmrvl_private *priv);\nint btmrvl_prepare_command(struct btmrvl_private *priv);\nint btmrvl_enable_hs(struct btmrvl_private *priv);\n\n#ifdef CONFIG_DEBUG_FS\nvoid btmrvl_debugfs_init(struct hci_dev *hdev);\nvoid btmrvl_debugfs_remove(struct hci_dev *hdev);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}