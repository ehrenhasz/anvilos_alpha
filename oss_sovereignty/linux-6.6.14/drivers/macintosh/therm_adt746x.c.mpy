{
  "module_name": "therm_adt746x.c",
  "hash_id": "d154ad9523c55fda116c849a2a934048b554c63baea3bb61de18ecd54be10c3c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/macintosh/therm_adt746x.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/delay.h>\n#include <linux/sched.h>\n#include <linux/i2c.h>\n#include <linux/slab.h>\n#include <linux/init.h>\n#include <linux/spinlock.h>\n#include <linux/wait.h>\n#include <linux/suspend.h>\n#include <linux/kthread.h>\n#include <linux/moduleparam.h>\n#include <linux/freezer.h>\n#include <linux/of.h>\n#include <linux/of_platform.h>\n#include <linux/platform_device.h>\n\n#include <asm/machdep.h>\n#include <asm/io.h>\n#include <asm/sections.h>\n\n#undef DEBUG\n\n#define CONFIG_REG   0x40\n#define MANUAL_MASK  0xe0\n#define AUTO_MASK    0x20\n#define INVERT_MASK  0x10\n\nstatic u8 TEMP_REG[3]    = {0x26, 0x25, 0x27};  \nstatic u8 LIMIT_REG[3]   = {0x6b, 0x6a, 0x6c};  \nstatic u8 MANUAL_MODE[2] = {0x5c, 0x5d};       \nstatic u8 REM_CONTROL[2] = {0x00, 0x40};\nstatic u8 FAN_SPEED[2]   = {0x28, 0x2a};\nstatic u8 FAN_SPD_SET[2] = {0x30, 0x31};\n\nstatic u8 default_limits_local[3] = {70, 50, 70};     \nstatic u8 default_limits_chip[3] = {80, 65, 80};     \nstatic const char *sensor_location[3] = { \"?\", \"?\", \"?\" };\n\nstatic int limit_adjust;\nstatic int fan_speed = -1;\nstatic bool verbose;\n\nMODULE_AUTHOR(\"Colin Leroy <colin@colino.net>\");\nMODULE_DESCRIPTION(\"Driver for ADT746x thermostat in iBook G4 and \"\n\t\t   \"Powerbook G4 Alu\");\nMODULE_LICENSE(\"GPL\");\n\nmodule_param(limit_adjust, int, 0644);\nMODULE_PARM_DESC(limit_adjust,\"Adjust maximum temperatures (50 sensor1, 70 sensor2) \"\n\t\t \"by N degrees.\");\n\nmodule_param(fan_speed, int, 0644);\nMODULE_PARM_DESC(fan_speed,\"Specify starting fan speed (0-255) \"\n\t\t \"(default 64)\");\n\nmodule_param(verbose, bool, 0);\nMODULE_PARM_DESC(verbose,\"Verbose log operations \"\n\t\t \"(default 0)\");\n\nstruct thermostat {\n\tstruct i2c_client\t*clt;\n\tu8\t\t\ttemps[3];\n\tu8\t\t\tcached_temp[3];\n\tu8\t\t\tinitial_limits[3];\n\tu8\t\t\tlimits[3];\n\tint\t\t\tlast_speed[2];\n\tint\t\t\tlast_var[2];\n\tint\t\t\tpwm_inv[2];\n\tstruct task_struct\t*thread;\n\tstruct platform_device\t*pdev;\n\tenum {\n\t\tADT7460,\n\t\tADT7467\n\t}\t\t\ttype;\n};\n\nstatic void write_both_fan_speed(struct thermostat *th, int speed);\nstatic void write_fan_speed(struct thermostat *th, int speed, int fan);\n\nstatic int\nwrite_reg(struct thermostat* th, int reg, u8 data)\n{\n\tu8 tmp[2];\n\tint rc;\n\t\n\ttmp[0] = reg;\n\ttmp[1] = data;\n\trc = i2c_master_send(th->clt, (const char *)tmp, 2);\n\tif (rc < 0)\n\t\treturn rc;\n\tif (rc != 2)\n\t\treturn -ENODEV;\n\treturn 0;\n}\n\nstatic int\nread_reg(struct thermostat* th, int reg)\n{\n\tu8 reg_addr, data;\n\tint rc;\n\n\treg_addr = (u8)reg;\n\trc = i2c_master_send(th->clt, &reg_addr, 1);\n\tif (rc < 0)\n\t\treturn rc;\n\tif (rc != 1)\n\t\treturn -ENODEV;\n\trc = i2c_master_recv(th->clt, (char *)&data, 1);\n\tif (rc < 0)\n\t\treturn rc;\n\treturn data;\n}\n\nstatic int read_fan_speed(struct thermostat *th, u8 addr)\n{\n\tu8 tmp[2];\n\tu16 res;\n\t\n\t \n\ttmp[1] = read_reg(th, addr);\n\ttmp[0] = read_reg(th, addr + 1);\n\t\n\tres = tmp[1] + (tmp[0] << 8);\n\t \n\treturn (res == 0xffff ? 0 : (90000*60)/res);\n}\n\nstatic void write_both_fan_speed(struct thermostat *th, int speed)\n{\n\twrite_fan_speed(th, speed, 0);\n\tif (th->type == ADT7460)\n\t\twrite_fan_speed(th, speed, 1);\n}\n\nstatic void write_fan_speed(struct thermostat *th, int speed, int fan)\n{\n\tu8 manual;\n\t\n\tif (speed > 0xff) \n\t\tspeed = 0xff;\n\telse if (speed < -1) \n\t\tspeed = 0;\n\t\n\tif (th->type == ADT7467 && fan == 1)\n\t\treturn;\n\t\n\tif (th->last_speed[fan] != speed) {\n\t\tif (verbose) {\n\t\t\tif (speed == -1)\n\t\t\t\tprintk(KERN_DEBUG \"adt746x: Setting speed to automatic \"\n\t\t\t\t\t\"for %s fan.\\n\", sensor_location[fan+1]);\n\t\t\telse\n\t\t\t\tprintk(KERN_DEBUG \"adt746x: Setting speed to %d \"\n\t\t\t\t\t\"for %s fan.\\n\", speed, sensor_location[fan+1]);\n\t\t}\n\t} else\n\t\treturn;\n\t\n\tif (speed >= 0) {\n\t\tmanual = read_reg(th, MANUAL_MODE[fan]);\n\t\tmanual &= ~INVERT_MASK;\n\t\twrite_reg(th, MANUAL_MODE[fan],\n\t\t\tmanual | MANUAL_MASK | th->pwm_inv[fan]);\n\t\twrite_reg(th, FAN_SPD_SET[fan], speed);\n\t} else {\n\t\t \n\t\tif(th->type == ADT7460) {\n\t\t\tmanual = read_reg(th,\n\t\t\t\tMANUAL_MODE[fan]) & (~MANUAL_MASK);\n\t\t\tmanual &= ~INVERT_MASK;\n\t\t\tmanual |= th->pwm_inv[fan];\n\t\t\twrite_reg(th,\n\t\t\t\tMANUAL_MODE[fan], manual|REM_CONTROL[fan]);\n\t\t} else {\n\t\t\tmanual = read_reg(th, MANUAL_MODE[fan]);\n\t\t\tmanual &= ~INVERT_MASK;\n\t\t\tmanual |= th->pwm_inv[fan];\n\t\t\twrite_reg(th, MANUAL_MODE[fan], manual&(~AUTO_MASK));\n\t\t}\n\t}\n\t\n\tth->last_speed[fan] = speed;\t\t\t\n}\n\nstatic void read_sensors(struct thermostat *th)\n{\n\tint i = 0;\n\n\tfor (i = 0; i < 3; i++)\n\t\tth->temps[i]  = read_reg(th, TEMP_REG[i]);\n}\n\n#ifdef DEBUG\nstatic void display_stats(struct thermostat *th)\n{\n\tif (th->temps[0] != th->cached_temp[0]\n\t||  th->temps[1] != th->cached_temp[1]\n\t||  th->temps[2] != th->cached_temp[2]) {\n\t\tprintk(KERN_INFO \"adt746x: Temperature infos:\"\n\t\t\t\t \" thermostats: %d,%d,%d;\"\n\t\t\t\t \" limits: %d,%d,%d;\"\n\t\t\t\t \" fan speed: %d RPM\\n\",\n\t\t\t\t th->temps[0], th->temps[1], th->temps[2],\n\t\t\t\t th->limits[0],  th->limits[1],  th->limits[2],\n\t\t\t\t read_fan_speed(th, FAN_SPEED[0]));\n\t}\n\tth->cached_temp[0] = th->temps[0];\n\tth->cached_temp[1] = th->temps[1];\n\tth->cached_temp[2] = th->temps[2];\n}\n#endif\n\nstatic void update_fans_speed (struct thermostat *th)\n{\n\tint lastvar = 0;  \n\tint i = 0;\n\n\t \n\tfor (i = 1; i < 3; i++) {\n\t\tbool started = false;\n\t\tint fan_number = (th->type == ADT7460 && i == 2);\n\t\tint var = th->temps[i] - th->limits[i];\n\n\t\tif (var > -1) {\n\t\t\tint step = (255 - fan_speed) / 7;\n\t\t\tint new_speed = 0;\n\n\t\t\t \n\t\t\tif (abs(var - th->last_var[fan_number]) < 2)\n\t\t\t\tcontinue;\n\n\t\t\tstarted = true;\n\t\t\tnew_speed = fan_speed + ((var-1)*step);\n\n\t\t\tif (new_speed < fan_speed)\n\t\t\t\tnew_speed = fan_speed;\n\t\t\tif (new_speed > 255)\n\t\t\t\tnew_speed = 255;\n\n\t\t\tif (verbose)\n\t\t\t\tprintk(KERN_DEBUG \"adt746x: Setting fans speed to %d \"\n\t\t\t\t\t\t \"(limit exceeded by %d on %s)\\n\",\n\t\t\t\t\t\tnew_speed, var,\n\t\t\t\t\t\tsensor_location[fan_number+1]);\n\t\t\twrite_both_fan_speed(th, new_speed);\n\t\t\tth->last_var[fan_number] = var;\n\t\t} else if (var < -2) {\n\t\t\t \n\t\t\tif (i == 2 && lastvar < -1) {\n\t\t\t\tif (th->last_speed[fan_number] != 0)\n\t\t\t\t\tif (verbose)\n\t\t\t\t\t\tprintk(KERN_DEBUG \"adt746x: Stopping \"\n\t\t\t\t\t\t\t\"fans.\\n\");\n\t\t\t\twrite_both_fan_speed(th, 0);\n\t\t\t}\n\t\t}\n\n\t\tlastvar = var;\n\n\t\tif (started)\n\t\t\treturn;  \n\t}\n}\n\nstatic int monitor_task(void *arg)\n{\n\tstruct thermostat* th = arg;\n\n\tset_freezable();\n\twhile(!kthread_should_stop()) {\n\t\ttry_to_freeze();\n\t\tmsleep_interruptible(2000);\n\n#ifndef DEBUG\n\t\tif (fan_speed != -1)\n\t\t\tread_sensors(th);\n#else\n\t\tread_sensors(th);\n#endif\t\t\n\n\t\tif (fan_speed != -1)\n\t\t\tupdate_fans_speed(th);\n\n#ifdef DEBUG\n\t\tdisplay_stats(th);\n#endif\n\n\t}\n\n\treturn 0;\n}\n\nstatic void set_limit(struct thermostat *th, int i)\n{\n\t \n\tth->limits[i] = default_limits_chip[i] + limit_adjust;\n\twrite_reg(th, LIMIT_REG[i], th->limits[i]);\n\t\t\n\t \n\tth->limits[i] = default_limits_local[i] + limit_adjust;\n}\n\n#define BUILD_SHOW_FUNC_INT(name, data)\t\t\t\t\\\nstatic ssize_t show_##name(struct device *dev, struct device_attribute *attr, char *buf)\t\\\n{\t\t\t\t\t\t\t\t\\\n\tstruct thermostat *th = dev_get_drvdata(dev);\t\t\\\n\treturn sprintf(buf, \"%d\\n\", data);\t\t\t\\\n}\n\n#define BUILD_SHOW_FUNC_INT_LITE(name, data)\t\t\t\t\\\nstatic ssize_t show_##name(struct device *dev, struct device_attribute *attr, char *buf)\t\\\n{\t\t\t\t\t\t\t\t\\\n\treturn sprintf(buf, \"%d\\n\", data);\t\t\t\\\n}\n\n#define BUILD_SHOW_FUNC_STR(name, data)\t\t\t\t\\\nstatic ssize_t show_##name(struct device *dev, struct device_attribute *attr, char *buf)       \\\n{\t\t\t\t\t\t\t\t\\\n\treturn sprintf(buf, \"%s\\n\", data);\t\t\t\\\n}\n\n#define BUILD_SHOW_FUNC_FAN(name, data)\t\t\t\t\\\nstatic ssize_t show_##name(struct device *dev, struct device_attribute *attr, char *buf)       \\\n{\t\t\t\t\t\t\t\t\\\n\tstruct thermostat *th = dev_get_drvdata(dev);\t\t\\\n\treturn sprintf(buf, \"%d (%d rpm)\\n\", \t\t\t\\\n\t\tth->last_speed[data],\t\t\t\t\\\n\t\tread_fan_speed(th, FAN_SPEED[data])\t\t\\\n\t\t);\t\t\t\t\t\t\\\n}\n\n#define BUILD_STORE_FUNC_DEG(name, data)\t\t\t\\\nstatic ssize_t store_##name(struct device *dev, struct device_attribute *attr, const char *buf, size_t n) \\\n{\t\t\t\t\t\t\t\t\\\n\tstruct thermostat *th = dev_get_drvdata(dev);\t\t\\\n\tint val;\t\t\t\t\t\t\\\n\tint i;\t\t\t\t\t\t\t\\\n\tval = simple_strtol(buf, NULL, 10);\t\t\t\\\n\tprintk(KERN_INFO \"Adjusting limits by %d degrees\\n\", val);\t\\\n\tlimit_adjust = val;\t\t\t\t\t\\\n\tfor (i=0; i < 3; i++)\t\t\t\t\t\\\n\t\tset_limit(th, i);\t\t\t\t\\\n\treturn n;\t\t\t\t\t\t\\\n}\n\n#define BUILD_STORE_FUNC_INT(name, data)\t\t\t\\\nstatic ssize_t store_##name(struct device *dev, struct device_attribute *attr, const char *buf, size_t n) \\\n{\t\t\t\t\t\t\t\t\\\n\tint val;\t\t\t\t\t\t\\\n\tval = simple_strtol(buf, NULL, 10);\t\t\t\\\n\tif (val < 0 || val > 255)\t\t\t\t\\\n\t\treturn -EINVAL;\t\t\t\t\t\\\n\tprintk(KERN_INFO \"Setting specified fan speed to %d\\n\", val);\t\\\n\tdata = val;\t\t\t\t\t\t\\\n\treturn n;\t\t\t\t\t\t\\\n}\n\nBUILD_SHOW_FUNC_INT(sensor1_temperature,\t (read_reg(th, TEMP_REG[1])))\nBUILD_SHOW_FUNC_INT(sensor2_temperature,\t (read_reg(th, TEMP_REG[2])))\nBUILD_SHOW_FUNC_INT(sensor1_limit,\t\t th->limits[1])\nBUILD_SHOW_FUNC_INT(sensor2_limit,\t\t th->limits[2])\nBUILD_SHOW_FUNC_STR(sensor1_location,\t\t sensor_location[1])\nBUILD_SHOW_FUNC_STR(sensor2_location,\t\t sensor_location[2])\n\nBUILD_SHOW_FUNC_INT_LITE(specified_fan_speed, fan_speed)\nBUILD_STORE_FUNC_INT(specified_fan_speed,fan_speed)\n\nBUILD_SHOW_FUNC_FAN(sensor1_fan_speed,\t 0)\nBUILD_SHOW_FUNC_FAN(sensor2_fan_speed,\t 1)\n\nBUILD_SHOW_FUNC_INT_LITE(limit_adjust,\t limit_adjust)\nBUILD_STORE_FUNC_DEG(limit_adjust,\t th)\n\t\t\nstatic DEVICE_ATTR(sensor1_temperature,\tS_IRUGO,\n\t\t   show_sensor1_temperature,NULL);\nstatic DEVICE_ATTR(sensor2_temperature,\tS_IRUGO,\n\t\t   show_sensor2_temperature,NULL);\nstatic DEVICE_ATTR(sensor1_limit, S_IRUGO,\n\t\t   show_sensor1_limit,\tNULL);\nstatic DEVICE_ATTR(sensor2_limit, S_IRUGO,\n\t\t   show_sensor2_limit,\tNULL);\nstatic DEVICE_ATTR(sensor1_location, S_IRUGO,\n\t\t   show_sensor1_location, NULL);\nstatic DEVICE_ATTR(sensor2_location, S_IRUGO,\n\t\t   show_sensor2_location, NULL);\n\nstatic DEVICE_ATTR(specified_fan_speed,\tS_IRUSR|S_IWUSR|S_IRGRP|S_IROTH,\n\t\t   show_specified_fan_speed,store_specified_fan_speed);\n\nstatic DEVICE_ATTR(sensor1_fan_speed,\tS_IRUGO,\n\t\t   show_sensor1_fan_speed,\tNULL);\nstatic DEVICE_ATTR(sensor2_fan_speed,\tS_IRUGO,\n\t\t   show_sensor2_fan_speed,\tNULL);\n\nstatic DEVICE_ATTR(limit_adjust,\tS_IRUSR|S_IWUSR|S_IRGRP|S_IROTH,\n\t\t   show_limit_adjust,\tstore_limit_adjust);\n\nstatic void thermostat_create_files(struct thermostat *th)\n{\n\tstruct device_node *np = th->clt->dev.of_node;\n\tstruct device *dev;\n\tint err;\n\n\t \n\tth->pdev = of_platform_device_create(np, \"temperatures\", NULL);\n\tif (!th->pdev)\n\t\treturn;\n\tdev = &th->pdev->dev;\n\tdev_set_drvdata(dev, th);\n\terr = device_create_file(dev, &dev_attr_sensor1_temperature);\n\terr |= device_create_file(dev, &dev_attr_sensor2_temperature);\n\terr |= device_create_file(dev, &dev_attr_sensor1_limit);\n\terr |= device_create_file(dev, &dev_attr_sensor2_limit);\n\terr |= device_create_file(dev, &dev_attr_sensor1_location);\n\terr |= device_create_file(dev, &dev_attr_sensor2_location);\n\terr |= device_create_file(dev, &dev_attr_limit_adjust);\n\terr |= device_create_file(dev, &dev_attr_specified_fan_speed);\n\terr |= device_create_file(dev, &dev_attr_sensor1_fan_speed);\n\tif(th->type == ADT7460)\n\t\terr |= device_create_file(dev, &dev_attr_sensor2_fan_speed);\n\tif (err)\n\t\tprintk(KERN_WARNING\n\t\t\t\"Failed to create temperature attribute file(s).\\n\");\n}\n\nstatic void thermostat_remove_files(struct thermostat *th)\n{\n\tstruct device *dev;\n\n\tif (!th->pdev)\n\t\treturn;\n\tdev = &th->pdev->dev;\n\tdevice_remove_file(dev, &dev_attr_sensor1_temperature);\n\tdevice_remove_file(dev, &dev_attr_sensor2_temperature);\n\tdevice_remove_file(dev, &dev_attr_sensor1_limit);\n\tdevice_remove_file(dev, &dev_attr_sensor2_limit);\n\tdevice_remove_file(dev, &dev_attr_sensor1_location);\n\tdevice_remove_file(dev, &dev_attr_sensor2_location);\n\tdevice_remove_file(dev, &dev_attr_limit_adjust);\n\tdevice_remove_file(dev, &dev_attr_specified_fan_speed);\n\tdevice_remove_file(dev, &dev_attr_sensor1_fan_speed);\t\n\tif (th->type == ADT7460)\n\t\tdevice_remove_file(dev, &dev_attr_sensor2_fan_speed);\n\tof_device_unregister(th->pdev);\n\n}\n\nstatic int probe_thermostat(struct i2c_client *client)\n{\n\tconst struct i2c_device_id *id = i2c_client_get_device_id(client);\n\tstruct device_node *np = client->dev.of_node;\n\tstruct thermostat* th;\n\tconst __be32 *prop;\n\tint i, rc, vers, offset = 0;\n\n\tif (!np)\n\t\treturn -ENXIO;\n\tprop = of_get_property(np, \"hwsensor-params-version\", NULL);\n\tif (!prop)\n\t\treturn -ENXIO;\n\tvers = be32_to_cpup(prop);\n\tprintk(KERN_INFO \"adt746x: version %d (%ssupported)\\n\",\n\t       vers, vers == 1 ? \"\" : \"un\");\n\tif (vers != 1)\n\t\treturn -ENXIO;\n\n\tif (of_property_present(np, \"hwsensor-location\")) {\n\t\tfor (i = 0; i < 3; i++) {\n\t\t\tsensor_location[i] = of_get_property(np,\n\t\t\t\t\t\"hwsensor-location\", NULL) + offset;\n\n\t\t\tif (sensor_location[i] == NULL)\n\t\t\t\tsensor_location[i] = \"\";\n\n\t\t\tprintk(KERN_INFO \"sensor %d: %s\\n\", i, sensor_location[i]);\n\t\t\toffset += strlen(sensor_location[i]) + 1;\n\t\t}\n\t}\n\n\tth = kzalloc(sizeof(struct thermostat), GFP_KERNEL);\n\tif (!th)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(client, th);\n\tth->clt = client;\n\tth->type = id->driver_data;\n\n\trc = read_reg(th, CONFIG_REG);\n\tif (rc < 0) {\n\t\tdev_err(&client->dev, \"Thermostat failed to read config!\\n\");\n\t\tkfree(th);\n\t\treturn -ENODEV;\n\t}\n\n\t \n\tif (fan_speed == -1)\n\t\tfan_speed = 64;\n\t\n\tif (th->type == ADT7460) {\n\t\tprintk(KERN_INFO \"adt746x: ADT7460 initializing\\n\");\n\t\t \n\t\twrite_reg(th, CONFIG_REG, 1);\n\t} else\n\t\tprintk(KERN_INFO \"adt746x: ADT7467 initializing\\n\");\n\n\tfor (i = 0; i < 3; i++) {\n\t\tth->initial_limits[i] = read_reg(th, LIMIT_REG[i]);\n\t\tset_limit(th, i);\n\t}\n\n\tprintk(KERN_INFO \"adt746x: Lowering max temperatures from %d, %d, %d\"\n\t\t\t \" to %d, %d, %d\\n\",\n\t\t\t th->initial_limits[0], th->initial_limits[1],\n\t\t\t th->initial_limits[2], th->limits[0], th->limits[1],\n\t\t\t th->limits[2]);\n\n\t \n\tth->pwm_inv[0] = read_reg(th, MANUAL_MODE[0]) & INVERT_MASK;\n\tth->pwm_inv[1] = read_reg(th, MANUAL_MODE[1]) & INVERT_MASK;\n\n\t \n\tth->last_speed[0] = -2;\n\tth->last_speed[1] = -2;\n\tth->last_var[0] = -80;\n\tth->last_var[1] = -80;\n\n\tif (fan_speed != -1) {\n\t\t \n\t\twrite_both_fan_speed(th, 0);\n\t} else {\n\t\t \n\t\twrite_both_fan_speed(th, -1);\n\t}\n\t\n\tth->thread = kthread_run(monitor_task, th, \"kfand\");\n\tif (th->thread == ERR_PTR(-ENOMEM)) {\n\t\tprintk(KERN_INFO \"adt746x: Kthread creation failed\\n\");\n\t\tth->thread = NULL;\n\t\treturn -ENOMEM;\n\t}\n\n\tthermostat_create_files(th);\n\n\treturn 0;\n}\n\nstatic void remove_thermostat(struct i2c_client *client)\n{\n\tstruct thermostat *th = i2c_get_clientdata(client);\n\tint i;\n\t\n\tthermostat_remove_files(th);\n\n\tif (th->thread != NULL)\n\t\tkthread_stop(th->thread);\n\n\tprintk(KERN_INFO \"adt746x: Putting max temperatures back from \"\n\t\t\t \"%d, %d, %d to %d, %d, %d\\n\",\n\t\tth->limits[0], th->limits[1], th->limits[2],\n\t\tth->initial_limits[0], th->initial_limits[1],\n\t\tth->initial_limits[2]);\n\n\tfor (i = 0; i < 3; i++)\n\t\twrite_reg(th, LIMIT_REG[i], th->initial_limits[i]);\n\n\twrite_both_fan_speed(th, -1);\n\n\tkfree(th);\n}\n\nstatic const struct i2c_device_id therm_adt746x_id[] = {\n\t{ \"MAC,adt7460\", ADT7460 },\n\t{ \"MAC,adt7467\", ADT7467 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, therm_adt746x_id);\n\nstatic struct i2c_driver thermostat_driver = {\n\t.driver = {\n\t\t.name\t= \"therm_adt746x\",\n\t},\n\t.probe = probe_thermostat,\n\t.remove = remove_thermostat,\n\t.id_table = therm_adt746x_id,\n};\n\nstatic int __init thermostat_init(void)\n{\n#ifndef CONFIG_I2C_POWERMAC\n\trequest_module(\"i2c-powermac\");\n#endif\n\n\treturn i2c_add_driver(&thermostat_driver);\n}\n\nstatic void __exit thermostat_exit(void)\n{\n\ti2c_del_driver(&thermostat_driver);\n}\n\nmodule_init(thermostat_init);\nmodule_exit(thermostat_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}