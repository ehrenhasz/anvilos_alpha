{
  "module_name": "asp.c",
  "hash_id": "eb8fc4ae1dd0a585fb2c186ad90d06276676bb5f890e58c6d349fbb71589dfc4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/parisc/asp.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/init.h>\n#include <linux/interrupt.h>\n#include <linux/module.h>\n#include <linux/types.h>\n#include <asm/io.h>\n#include <asm/led.h>\n\n#include \"gsc.h\"\n\n#define ASP_GSC_IRQ\t3\t\t \n\n#define ASP_VER_OFFSET \t0x20\t\t \n\n#define ASP_LED_ADDR\t0xf0800020\n\n#define VIPER_INT_WORD  0xFFFBF088       \n\nstatic struct gsc_asic asp;\n\nstatic void asp_choose_irq(struct parisc_device *dev, void *ctrl)\n{\n\tint irq;\n\n\tswitch (dev->id.sversion) {\n\tcase 0x71:\tirq =  9; break;  \n\tcase 0x72:\tirq =  8; break;  \n\tcase 0x73:\tirq =  1; break;  \n\tcase 0x74:\tirq =  7; break;  \n\tcase 0x75:\tirq = (dev->hw_path == 4) ? 5 : 6; break;  \n\tcase 0x76:\tirq = 10; break;  \n\tcase 0x77:\tirq = 11; break;  \n\tcase 0x7a:\tirq = 13; break;  \n\tcase 0x7b:\tirq = 13; break;  \n\tcase 0x7c:\tirq =  3; break;  \n\tcase 0x7d:\tirq =  4; break;  \n\tcase 0x7f:\tirq = 13; break;  \n\tdefault:\treturn;\t\t  \n\t}\n\n\tgsc_asic_assign_irq(ctrl, irq, &dev->irq);\n\n\tswitch (dev->id.sversion) {\n\tcase 0x73:\tirq =  2; break;  \n\tcase 0x76:\tirq =  0; break;  \n\tdefault:\treturn;\t\t  \n\t}\n\n\tgsc_asic_assign_irq(ctrl, irq, &dev->aux_irq);\n}\n\n \n#define ASP_INTERRUPT_ADDR 0xf0800000\n\nstatic int __init asp_init_chip(struct parisc_device *dev)\n{\n\tstruct gsc_irq gsc_irq;\n\tint ret;\n\n\tasp.version = gsc_readb(dev->hpa.start + ASP_VER_OFFSET) & 0xf;\n\tasp.name = (asp.version == 1) ? \"Asp\" : \"Cutoff\";\n\tasp.hpa = ASP_INTERRUPT_ADDR;\n\n\tprintk(KERN_INFO \"%s version %d at 0x%lx found.\\n\", \n\t\tasp.name, asp.version, (unsigned long)dev->hpa.start);\n\n\t \n\tret = -EBUSY;\n\tdev->irq = gsc_claim_irq(&gsc_irq, ASP_GSC_IRQ);\n\tif (dev->irq < 0) {\n\t\tprintk(KERN_ERR \"%s(): cannot get GSC irq\\n\", __func__);\n\t\tgoto out;\n\t}\n\n\tasp.eim = ((u32) gsc_irq.txn_addr) | gsc_irq.txn_data;\n\n\tret = request_irq(gsc_irq.irq, gsc_asic_intr, 0, \"asp\", &asp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\t \n\tgsc_writel((1 << (31 - ASP_GSC_IRQ)),VIPER_INT_WORD);\n\n\t \n\tret = gsc_common_setup(dev, &asp);\n\tif (ret)\n\t\tgoto out;\n\n\tgsc_fixup_irqs(dev, &asp, asp_choose_irq);\n\t \n\tgsc_fixup_irqs(parisc_parent(dev), &asp, asp_choose_irq);\n\n\t  \n#ifdef CONFIG_CHASSIS_LCD_LED\t\n\tregister_led_driver(DISPLAY_MODEL_OLD_ASP, LED_CMD_REG_NONE, \n\t\t    ASP_LED_ADDR);\n#endif\n\n out:\n\treturn ret;\n}\n\nstatic const struct parisc_device_id asp_tbl[] __initconst = {\n\t{ HPHW_BA, HVERSION_REV_ANY_ID, HVERSION_ANY_ID, 0x00070 },\n\t{ 0, }\n};\nMODULE_DEVICE_TABLE(parisc, asp_tbl);\n\nstatic struct parisc_driver asp_driver __refdata = {\n\t.name =\t\t\"asp\",\n\t.id_table =\tasp_tbl,\n\t.probe =\tasp_init_chip,\n};\n\nstatic int __init asp_init(void)\n{\n\treturn register_parisc_driver(&asp_driver);\n}\narch_initcall(asp_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}