{
  "module_name": "ata.c",
  "hash_id": "5b17a222a610cdcbfd0bd52b67856e6502044043761d10ec2f3962af5b65bdaa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/bestcomm/ata.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/types.h>\n#include <asm/io.h>\n\n#include <linux/fsl/bestcomm/bestcomm.h>\n#include <linux/fsl/bestcomm/bestcomm_priv.h>\n#include <linux/fsl/bestcomm/ata.h>\n\n\n \n \n \n\n \nextern u32 bcom_ata_task[];\n\n \nstruct bcom_ata_var {\n\tu32 enable;\t\t \n\tu32 bd_base;\t\t \n\tu32 bd_last;\t\t \n\tu32 bd_start;\t\t \n\tu32 buffer_size;\t \n};\n\n \nstruct bcom_ata_inc {\n\tu16 pad0;\n\ts16 incr_bytes;\n\tu16 pad1;\n\ts16 incr_dst;\n\tu16 pad2;\n\ts16 incr_src;\n};\n\n\n \n \n \n\nstruct bcom_task *\nbcom_ata_init(int queue_len, int maxbufsize)\n{\n\tstruct bcom_task *tsk;\n\tstruct bcom_ata_var *var;\n\tstruct bcom_ata_inc *inc;\n\n\t \n\tbcom_disable_prefetch();\n\n\ttsk = bcom_task_alloc(queue_len, sizeof(struct bcom_ata_bd), 0);\n\tif (!tsk)\n\t\treturn NULL;\n\n\ttsk->flags = BCOM_FLAGS_NONE;\n\n\tbcom_ata_reset_bd(tsk);\n\n\tvar = (struct bcom_ata_var *) bcom_task_var(tsk->tasknum);\n\tinc = (struct bcom_ata_inc *) bcom_task_inc(tsk->tasknum);\n\n\tif (bcom_load_image(tsk->tasknum, bcom_ata_task)) {\n\t\tbcom_task_free(tsk);\n\t\treturn NULL;\n\t}\n\n\tvar->enable\t= bcom_eng->regs_base +\n\t\t\t\toffsetof(struct mpc52xx_sdma, tcr[tsk->tasknum]);\n\tvar->bd_base\t= tsk->bd_pa;\n\tvar->bd_last\t= tsk->bd_pa + ((tsk->num_bd-1) * tsk->bd_size);\n\tvar->bd_start\t= tsk->bd_pa;\n\tvar->buffer_size = maxbufsize;\n\n\t \n\tbcom_set_task_pragma(tsk->tasknum, BCOM_ATA_PRAGMA);\n\tbcom_set_task_auto_start(tsk->tasknum, tsk->tasknum);\n\n\tout_8(&bcom_eng->regs->ipr[BCOM_INITIATOR_ATA_RX], BCOM_IPR_ATA_RX);\n\tout_8(&bcom_eng->regs->ipr[BCOM_INITIATOR_ATA_TX], BCOM_IPR_ATA_TX);\n\n\tout_be32(&bcom_eng->regs->IntPend, 1<<tsk->tasknum);  \n\n\treturn tsk;\n}\nEXPORT_SYMBOL_GPL(bcom_ata_init);\n\nvoid bcom_ata_rx_prepare(struct bcom_task *tsk)\n{\n\tstruct bcom_ata_inc *inc;\n\n\tinc = (struct bcom_ata_inc *) bcom_task_inc(tsk->tasknum);\n\n\tinc->incr_bytes\t= -(s16)sizeof(u32);\n\tinc->incr_src\t= 0;\n\tinc->incr_dst\t= sizeof(u32);\n\n\tbcom_set_initiator(tsk->tasknum, BCOM_INITIATOR_ATA_RX);\n}\nEXPORT_SYMBOL_GPL(bcom_ata_rx_prepare);\n\nvoid bcom_ata_tx_prepare(struct bcom_task *tsk)\n{\n\tstruct bcom_ata_inc *inc;\n\n\tinc = (struct bcom_ata_inc *) bcom_task_inc(tsk->tasknum);\n\n\tinc->incr_bytes\t= -(s16)sizeof(u32);\n\tinc->incr_src\t= sizeof(u32);\n\tinc->incr_dst\t= 0;\n\n\tbcom_set_initiator(tsk->tasknum, BCOM_INITIATOR_ATA_TX);\n}\nEXPORT_SYMBOL_GPL(bcom_ata_tx_prepare);\n\nvoid bcom_ata_reset_bd(struct bcom_task *tsk)\n{\n\tstruct bcom_ata_var *var;\n\n\t \n\tmemset_io(tsk->bd, 0x00, tsk->num_bd * tsk->bd_size);\n\n\ttsk->index = 0;\n\ttsk->outdex = 0;\n\n\tvar = (struct bcom_ata_var *) bcom_task_var(tsk->tasknum);\n\tvar->bd_start = var->bd_base;\n}\nEXPORT_SYMBOL_GPL(bcom_ata_reset_bd);\n\nvoid bcom_ata_release(struct bcom_task *tsk)\n{\n\t \n\tbcom_task_free(tsk);\n}\nEXPORT_SYMBOL_GPL(bcom_ata_release);\n\n\nMODULE_DESCRIPTION(\"BestComm ATA task driver\");\nMODULE_AUTHOR(\"John Rigby\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}