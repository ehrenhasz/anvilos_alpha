{
  "module_name": "st_fdma.h",
  "hash_id": "7ee7ec54250931803efa3bec2b81b66d1c1c2ad90807adb81609563ce9950d3c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/st_fdma.h",
  "human_readable_source": " \n \n#ifndef __DMA_ST_FDMA_H\n#define __DMA_ST_FDMA_H\n\n#include <linux/dmaengine.h>\n#include <linux/dmapool.h>\n#include <linux/io.h>\n#include <linux/remoteproc/st_slim_rproc.h>\n#include \"virt-dma.h\"\n\n#define ST_FDMA_NR_DREQS 32\n#define FW_NAME_SIZE 30\n#define DRIVER_NAME \"st-fdma\"\n\n \nstruct st_fdma_generic_node {\n\tu32 length;\n\tu32 sstride;\n\tu32 dstride;\n};\n\n \nstruct st_fdma_hw_node {\n\tu32 next;\n\tu32 control;\n\tu32 nbytes;\n\tu32 saddr;\n\tu32 daddr;\n\tunion {\n\t\tstruct st_fdma_generic_node generic;\n\t};\n} __aligned(32);\n\n \n#define FDMA_NODE_CTRL_REQ_MAP_MASK\tGENMASK(4, 0)\n#define FDMA_NODE_CTRL_REQ_MAP_FREE_RUN\t0x0\n#define FDMA_NODE_CTRL_REQ_MAP_DREQ(n)\t((n)&FDMA_NODE_CTRL_REQ_MAP_MASK)\n#define FDMA_NODE_CTRL_REQ_MAP_EXT\t\tFDMA_NODE_CTRL_REQ_MAP_MASK\n#define FDMA_NODE_CTRL_SRC_MASK\t\tGENMASK(6, 5)\n#define FDMA_NODE_CTRL_SRC_STATIC\tBIT(5)\n#define FDMA_NODE_CTRL_SRC_INCR\t\tBIT(6)\n#define FDMA_NODE_CTRL_DST_MASK\t\tGENMASK(8, 7)\n#define FDMA_NODE_CTRL_DST_STATIC\tBIT(7)\n#define FDMA_NODE_CTRL_DST_INCR\t\tBIT(8)\n#define FDMA_NODE_CTRL_SECURE\t\tBIT(15)\n#define FDMA_NODE_CTRL_PAUSE_EON\tBIT(30)\n#define FDMA_NODE_CTRL_INT_EON\t\tBIT(31)\n\n \nstruct st_fdma_sw_node {\n\tdma_addr_t pdesc;\n\tstruct st_fdma_hw_node *desc;\n};\n\n#define NAME_SZ 10\n\nstruct st_fdma_driverdata {\n\tu32 id;\n\tchar name[NAME_SZ];\n};\n\nstruct st_fdma_desc {\n\tstruct virt_dma_desc vdesc;\n\tstruct st_fdma_chan *fchan;\n\tbool iscyclic;\n\tunsigned int n_nodes;\n\tstruct st_fdma_sw_node node[];\n};\n\nenum st_fdma_type {\n\tST_FDMA_TYPE_FREE_RUN,\n\tST_FDMA_TYPE_PACED,\n};\n\nstruct st_fdma_cfg {\n\tstruct device_node *of_node;\n\tenum st_fdma_type type;\n\tdma_addr_t dev_addr;\n\tenum dma_transfer_direction dir;\n\tint req_line;  \n\tlong req_ctrl;  \n};\n\nstruct st_fdma_chan {\n\tstruct st_fdma_dev *fdev;\n\tstruct dma_pool *node_pool;\n\tstruct dma_slave_config scfg;\n\tstruct st_fdma_cfg cfg;\n\n\tint dreq_line;\n\n\tstruct virt_dma_chan vchan;\n\tstruct st_fdma_desc *fdesc;\n\tenum dma_status\tstatus;\n};\n\nstruct st_fdma_dev {\n\tstruct device *dev;\n\tconst struct st_fdma_driverdata *drvdata;\n\tstruct dma_device dma_device;\n\n\tstruct st_slim_rproc *slim_rproc;\n\n\tint irq;\n\n\tstruct st_fdma_chan *chans;\n\n\tspinlock_t dreq_lock;\n\tunsigned long dreq_mask;\n\n\tu32 nr_channels;\n\tchar fw_name[FW_NAME_SIZE];\n};\n\n \n\n#define FDMA_CMD_STA_OFST\t0xFC0\n#define FDMA_CMD_SET_OFST\t0xFC4\n#define FDMA_CMD_CLR_OFST\t0xFC8\n#define FDMA_CMD_MASK_OFST\t0xFCC\n#define FDMA_CMD_START(ch)\t\t(0x1 << (ch << 1))\n#define FDMA_CMD_PAUSE(ch)\t\t(0x2 << (ch << 1))\n#define FDMA_CMD_FLUSH(ch)\t\t(0x3 << (ch << 1))\n\n#define FDMA_INT_STA_OFST\t0xFD0\n#define FDMA_INT_STA_CH\t\t\t0x1\n#define FDMA_INT_STA_ERR\t\t0x2\n\n#define FDMA_INT_SET_OFST\t0xFD4\n#define FDMA_INT_CLR_OFST\t0xFD8\n#define FDMA_INT_MASK_OFST\t0xFDC\n\n#define fdma_read(fdev, name) \\\n\treadl((fdev)->slim_rproc->peri + name)\n\n#define fdma_write(fdev, val, name) \\\n\twritel((val), (fdev)->slim_rproc->peri + name)\n\n \n#define FDMA_CH_CMD_OFST\t0x200\n#define FDMA_CH_CMD_STA_MASK\t\tGENMASK(1, 0)\n#define FDMA_CH_CMD_STA_IDLE\t\t(0x0)\n#define FDMA_CH_CMD_STA_START\t\t(0x1)\n#define FDMA_CH_CMD_STA_RUNNING\t\t(0x2)\n#define FDMA_CH_CMD_STA_PAUSED\t\t(0x3)\n#define FDMA_CH_CMD_ERR_MASK\t\tGENMASK(4, 2)\n#define FDMA_CH_CMD_ERR_INT\t\t(0x0 << 2)\n#define FDMA_CH_CMD_ERR_NAND\t\t(0x1 << 2)\n#define FDMA_CH_CMD_ERR_MCHI\t\t(0x2 << 2)\n#define FDMA_CH_CMD_DATA_MASK\t\tGENMASK(31, 5)\n#define fchan_read(fchan, name) \\\n\treadl((fchan)->fdev->slim_rproc->mem[ST_SLIM_DMEM].cpu_addr \\\n\t\t\t+ (fchan)->vchan.chan.chan_id * 0x4 \\\n\t\t\t+ name)\n\n#define fchan_write(fchan, val, name) \\\n\twritel((val), (fchan)->fdev->slim_rproc->mem[ST_SLIM_DMEM].cpu_addr \\\n\t\t\t+ (fchan)->vchan.chan.chan_id * 0x4 \\\n\t\t\t+ name)\n\n \n#define FDMA_REQ_CTRL_OFST\t0x240\n#define dreq_write(fchan, val, name) \\\n\twritel((val), (fchan)->fdev->slim_rproc->mem[ST_SLIM_DMEM].cpu_addr \\\n\t\t\t+ fchan->dreq_line * 0x04 \\\n\t\t\t+ name)\n \n#define FDMA_NODE_SZ 128\n#define FDMA_PTRN_OFST\t\t0x800\n#define FDMA_CNTN_OFST\t\t0x808\n#define FDMA_SADDRN_OFST\t0x80c\n#define FDMA_DADDRN_OFST\t0x810\n#define fnode_read(fchan, name) \\\n\treadl((fchan)->fdev->slim_rproc->mem[ST_SLIM_DMEM].cpu_addr \\\n\t\t\t+ (fchan)->vchan.chan.chan_id * FDMA_NODE_SZ \\\n\t\t\t+ name)\n\n#define fnode_write(fchan, val, name) \\\n\twritel((val), (fchan)->fdev->slim_rproc->mem[ST_SLIM_DMEM].cpu_addr \\\n\t\t\t+ (fchan)->vchan.chan.chan_id * FDMA_NODE_SZ \\\n\t\t\t+ name)\n\n \n#define FDMA_REQ_CTRL_NUM_OPS_MASK\tGENMASK(31, 24)\n#define FDMA_REQ_CTRL_NUM_OPS(n)\t(FDMA_REQ_CTRL_NUM_OPS_MASK & \\\n\t\t\t\t\t((n) << 24))\n#define FDMA_REQ_CTRL_INITIATOR_MASK\tBIT(22)\n#define FDMA_REQ_CTRL_INIT0\t\t(0x0 << 22)\n#define FDMA_REQ_CTRL_INIT1\t\t(0x1 << 22)\n#define FDMA_REQ_CTRL_INC_ADDR_ON\tBIT(21)\n#define FDMA_REQ_CTRL_DATA_SWAP_ON\tBIT(17)\n#define FDMA_REQ_CTRL_WNR\t\tBIT(14)\n#define FDMA_REQ_CTRL_OPCODE_MASK\tGENMASK(7, 4)\n#define FDMA_REQ_CTRL_OPCODE_LD_ST1\t(0x0 << 4)\n#define FDMA_REQ_CTRL_OPCODE_LD_ST2\t(0x1 << 4)\n#define FDMA_REQ_CTRL_OPCODE_LD_ST4\t(0x2 << 4)\n#define FDMA_REQ_CTRL_OPCODE_LD_ST8\t(0x3 << 4)\n#define FDMA_REQ_CTRL_OPCODE_LD_ST16\t(0x4 << 4)\n#define FDMA_REQ_CTRL_OPCODE_LD_ST32\t(0x5 << 4)\n#define FDMA_REQ_CTRL_OPCODE_LD_ST64\t(0x6 << 4)\n#define FDMA_REQ_CTRL_HOLDOFF_MASK\tGENMASK(2, 0)\n#define FDMA_REQ_CTRL_HOLDOFF(n)\t((n) & FDMA_REQ_CTRL_HOLDOFF_MASK)\n\n \n#define FDMA_REQ_CTRL_CFG_MASK (FDMA_REQ_CTRL_HOLDOFF_MASK | \\\n\t\t\t\tFDMA_REQ_CTRL_DATA_SWAP_ON | \\\n\t\t\t\tFDMA_REQ_CTRL_INC_ADDR_ON | \\\n\t\t\t\tFDMA_REQ_CTRL_INITIATOR_MASK)\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}