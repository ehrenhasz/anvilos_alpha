{
  "module_name": "ptdma-debugfs.c",
  "hash_id": "8bafe5bb2b8d8f76b605ae162cbe27bc08642e3865394bb2773a939840eb0d40",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/ptdma/ptdma-debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/seq_file.h>\n\n#include \"ptdma.h\"\n\n \n#define\tRI_VERSION_NUM\t0x0000003F\n\n#define\tRI_NUM_VQM\t0x00078000\n#define\tRI_NVQM_SHIFT\t15\n\nstatic int pt_debugfs_info_show(struct seq_file *s, void *p)\n{\n\tstruct pt_device *pt = s->private;\n\tunsigned int regval;\n\n\tseq_printf(s, \"Device name: %s\\n\", dev_name(pt->dev));\n\tseq_printf(s, \"   # Queues: %d\\n\", 1);\n\tseq_printf(s, \"     # Cmds: %d\\n\", pt->cmd_count);\n\n\tregval = ioread32(pt->io_regs + CMD_PT_VERSION);\n\n\tseq_printf(s, \"    Version: %d\\n\", regval & RI_VERSION_NUM);\n\tseq_puts(s, \"    Engines:\");\n\tseq_puts(s, \"\\n\");\n\tseq_printf(s, \"     Queues: %d\\n\", (regval & RI_NUM_VQM) >> RI_NVQM_SHIFT);\n\n\treturn 0;\n}\n\n \nstatic int pt_debugfs_stats_show(struct seq_file *s, void *p)\n{\n\tstruct pt_device *pt = s->private;\n\n\tseq_printf(s, \"Total Interrupts Handled: %ld\\n\", pt->total_interrupts);\n\n\treturn 0;\n}\n\nstatic int pt_debugfs_queue_show(struct seq_file *s, void *p)\n{\n\tstruct pt_cmd_queue *cmd_q = s->private;\n\tunsigned int regval;\n\n\tif (!cmd_q)\n\t\treturn 0;\n\n\tseq_printf(s, \"               Pass-Thru: %ld\\n\", cmd_q->total_pt_ops);\n\n\tregval = ioread32(cmd_q->reg_control + 0x000C);\n\n\tseq_puts(s, \"      Enabled Interrupts:\");\n\tif (regval & INT_EMPTY_QUEUE)\n\t\tseq_puts(s, \" EMPTY\");\n\tif (regval & INT_QUEUE_STOPPED)\n\t\tseq_puts(s, \" STOPPED\");\n\tif (regval & INT_ERROR)\n\t\tseq_puts(s, \" ERROR\");\n\tif (regval & INT_COMPLETION)\n\t\tseq_puts(s, \" COMPLETION\");\n\tseq_puts(s, \"\\n\");\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(pt_debugfs_info);\nDEFINE_SHOW_ATTRIBUTE(pt_debugfs_queue);\nDEFINE_SHOW_ATTRIBUTE(pt_debugfs_stats);\n\nvoid ptdma_debugfs_setup(struct pt_device *pt)\n{\n\tstruct pt_cmd_queue *cmd_q;\n\tstruct dentry *debugfs_q_instance;\n\n\tif (!debugfs_initialized())\n\t\treturn;\n\n\tdebugfs_create_file(\"info\", 0400, pt->dma_dev.dbg_dev_root, pt,\n\t\t\t    &pt_debugfs_info_fops);\n\n\tdebugfs_create_file(\"stats\", 0400, pt->dma_dev.dbg_dev_root, pt,\n\t\t\t    &pt_debugfs_stats_fops);\n\n\tcmd_q = &pt->cmd_q;\n\n\tdebugfs_q_instance =\n\t\tdebugfs_create_dir(\"q\", pt->dma_dev.dbg_dev_root);\n\n\tdebugfs_create_file(\"stats\", 0400, debugfs_q_instance, cmd_q,\n\t\t\t    &pt_debugfs_queue_fops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}