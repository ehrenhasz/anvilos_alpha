{
  "module_name": "hidma_dbg.c",
  "hash_id": "4f57375eba9f6dfd49506213cf6b39726b6caf0d4646f5a855d3eb76d1659330",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/qcom/hidma_dbg.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/device.h>\n#include <linux/list.h>\n#include <linux/pm_runtime.h>\n\n#include \"hidma.h\"\n\nstatic void hidma_ll_chstats(struct seq_file *s, void *llhndl, u32 tre_ch)\n{\n\tstruct hidma_lldev *lldev = llhndl;\n\tstruct hidma_tre *tre;\n\tu32 length;\n\tdma_addr_t src_start;\n\tdma_addr_t dest_start;\n\tu32 *tre_local;\n\n\tif (tre_ch >= lldev->nr_tres) {\n\t\tdev_err(lldev->dev, \"invalid TRE number in chstats:%d\", tre_ch);\n\t\treturn;\n\t}\n\ttre = &lldev->trepool[tre_ch];\n\tseq_printf(s, \"------Channel %d -----\\n\", tre_ch);\n\tseq_printf(s, \"allocated=%d\\n\", atomic_read(&tre->allocated));\n\tseq_printf(s, \"queued = 0x%x\\n\", tre->queued);\n\tseq_printf(s, \"err_info = 0x%x\\n\", tre->err_info);\n\tseq_printf(s, \"err_code = 0x%x\\n\", tre->err_code);\n\tseq_printf(s, \"status = 0x%x\\n\", tre->status);\n\tseq_printf(s, \"idx = 0x%x\\n\", tre->idx);\n\tseq_printf(s, \"dma_sig = 0x%x\\n\", tre->dma_sig);\n\tseq_printf(s, \"dev_name=%s\\n\", tre->dev_name);\n\tseq_printf(s, \"callback=%p\\n\", tre->callback);\n\tseq_printf(s, \"data=%p\\n\", tre->data);\n\tseq_printf(s, \"tre_index = 0x%x\\n\", tre->tre_index);\n\n\ttre_local = &tre->tre_local[0];\n\tsrc_start = tre_local[HIDMA_TRE_SRC_LOW_IDX];\n\tsrc_start = ((u64) (tre_local[HIDMA_TRE_SRC_HI_IDX]) << 32) + src_start;\n\tdest_start = tre_local[HIDMA_TRE_DEST_LOW_IDX];\n\tdest_start += ((u64) (tre_local[HIDMA_TRE_DEST_HI_IDX]) << 32);\n\tlength = tre_local[HIDMA_TRE_LEN_IDX];\n\n\tseq_printf(s, \"src=%pap\\n\", &src_start);\n\tseq_printf(s, \"dest=%pap\\n\", &dest_start);\n\tseq_printf(s, \"length = 0x%x\\n\", length);\n}\n\nstatic void hidma_ll_devstats(struct seq_file *s, void *llhndl)\n{\n\tstruct hidma_lldev *lldev = llhndl;\n\n\tseq_puts(s, \"------Device -----\\n\");\n\tseq_printf(s, \"lldev init = 0x%x\\n\", lldev->initialized);\n\tseq_printf(s, \"trch_state = 0x%x\\n\", lldev->trch_state);\n\tseq_printf(s, \"evch_state = 0x%x\\n\", lldev->evch_state);\n\tseq_printf(s, \"chidx = 0x%x\\n\", lldev->chidx);\n\tseq_printf(s, \"nr_tres = 0x%x\\n\", lldev->nr_tres);\n\tseq_printf(s, \"trca=%p\\n\", lldev->trca);\n\tseq_printf(s, \"tre_ring=%p\\n\", lldev->tre_ring);\n\tseq_printf(s, \"tre_ring_handle=%pap\\n\", &lldev->tre_dma);\n\tseq_printf(s, \"tre_ring_size = 0x%x\\n\", lldev->tre_ring_size);\n\tseq_printf(s, \"tre_processed_off = 0x%x\\n\", lldev->tre_processed_off);\n\tseq_printf(s, \"pending_tre_count=%d\\n\",\n\t\t\tatomic_read(&lldev->pending_tre_count));\n\tseq_printf(s, \"evca=%p\\n\", lldev->evca);\n\tseq_printf(s, \"evre_ring=%p\\n\", lldev->evre_ring);\n\tseq_printf(s, \"evre_ring_handle=%pap\\n\", &lldev->evre_dma);\n\tseq_printf(s, \"evre_ring_size = 0x%x\\n\", lldev->evre_ring_size);\n\tseq_printf(s, \"evre_processed_off = 0x%x\\n\", lldev->evre_processed_off);\n\tseq_printf(s, \"tre_write_offset = 0x%x\\n\", lldev->tre_write_offset);\n}\n\n \nstatic int hidma_chan_show(struct seq_file *s, void *unused)\n{\n\tstruct hidma_chan *mchan = s->private;\n\tstruct hidma_desc *mdesc;\n\tstruct hidma_dev *dmadev = mchan->dmadev;\n\n\tpm_runtime_get_sync(dmadev->ddev.dev);\n\tseq_printf(s, \"paused=%u\\n\", mchan->paused);\n\tseq_printf(s, \"dma_sig=%u\\n\", mchan->dma_sig);\n\tseq_puts(s, \"prepared\\n\");\n\tlist_for_each_entry(mdesc, &mchan->prepared, node)\n\t\thidma_ll_chstats(s, mchan->dmadev->lldev, mdesc->tre_ch);\n\n\tseq_puts(s, \"active\\n\");\n\tlist_for_each_entry(mdesc, &mchan->active, node)\n\t\thidma_ll_chstats(s, mchan->dmadev->lldev, mdesc->tre_ch);\n\n\tseq_puts(s, \"completed\\n\");\n\tlist_for_each_entry(mdesc, &mchan->completed, node)\n\t\thidma_ll_chstats(s, mchan->dmadev->lldev, mdesc->tre_ch);\n\n\thidma_ll_devstats(s, mchan->dmadev->lldev);\n\tpm_runtime_mark_last_busy(dmadev->ddev.dev);\n\tpm_runtime_put_autosuspend(dmadev->ddev.dev);\n\treturn 0;\n}\n\n \nstatic int hidma_dma_show(struct seq_file *s, void *unused)\n{\n\tstruct hidma_dev *dmadev = s->private;\n\tresource_size_t sz;\n\n\tseq_printf(s, \"nr_descriptors=%d\\n\", dmadev->nr_descriptors);\n\tseq_printf(s, \"dev_trca=%p\\n\", &dmadev->dev_trca);\n\tseq_printf(s, \"dev_trca_phys=%pa\\n\", &dmadev->trca_resource->start);\n\tsz = resource_size(dmadev->trca_resource);\n\tseq_printf(s, \"dev_trca_size=%pa\\n\", &sz);\n\tseq_printf(s, \"dev_evca=%p\\n\", &dmadev->dev_evca);\n\tseq_printf(s, \"dev_evca_phys=%pa\\n\", &dmadev->evca_resource->start);\n\tsz = resource_size(dmadev->evca_resource);\n\tseq_printf(s, \"dev_evca_size=%pa\\n\", &sz);\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(hidma_chan);\nDEFINE_SHOW_ATTRIBUTE(hidma_dma);\n\nvoid hidma_debug_uninit(struct hidma_dev *dmadev)\n{\n\tdebugfs_remove_recursive(dmadev->debugfs);\n}\n\nvoid hidma_debug_init(struct hidma_dev *dmadev)\n{\n\tint chidx = 0;\n\tstruct list_head *position = NULL;\n\tstruct dentry *dir;\n\n\tdmadev->debugfs = debugfs_create_dir(dev_name(dmadev->ddev.dev), NULL);\n\n\t \n\tlist_for_each(position, &dmadev->ddev.channels) {\n\t\tstruct hidma_chan *chan;\n\n\t\tchan = list_entry(position, struct hidma_chan,\n\t\t\t\t  chan.device_node);\n\t\tsprintf(chan->dbg_name, \"chan%d\", chidx);\n\t\tdir = debugfs_create_dir(chan->dbg_name,\n\t\t\t\t\t\t   dmadev->debugfs);\n\t\tdebugfs_create_file(\"stats\", S_IRUGO, dir, chan,\n\t\t\t\t    &hidma_chan_fops);\n\t\tchidx++;\n\t}\n\n\tdebugfs_create_file(\"stats\", S_IRUGO, dmadev->debugfs, dmadev,\n\t\t\t    &hidma_dma_fops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}