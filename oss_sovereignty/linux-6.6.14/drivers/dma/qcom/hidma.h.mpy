{
  "module_name": "hidma.h",
  "hash_id": "1100f86796610bf987a29fd892239c689b69fccac525523aaf8f1b094d35f913",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/qcom/hidma.h",
  "human_readable_source": " \n \n\n#ifndef QCOM_HIDMA_H\n#define QCOM_HIDMA_H\n\n#include <linux/kfifo.h>\n#include <linux/interrupt.h>\n#include <linux/dmaengine.h>\n\n#define HIDMA_TRE_SIZE\t\t\t32  \n#define HIDMA_TRE_CFG_IDX\t\t0\n#define HIDMA_TRE_LEN_IDX\t\t1\n#define HIDMA_TRE_SRC_LOW_IDX\t\t2\n#define HIDMA_TRE_SRC_HI_IDX\t\t3\n#define HIDMA_TRE_DEST_LOW_IDX\t\t4\n#define HIDMA_TRE_DEST_HI_IDX\t\t5\n\nenum tre_type {\n\tHIDMA_TRE_MEMCPY = 3,\n\tHIDMA_TRE_MEMSET = 4,\n};\n\nstruct hidma_tre {\n\tatomic_t allocated;\t\t \n\tbool queued;\t\t\t \n\tu16 status;\t\t\t \n\tu32 idx;\t\t\t \n\tu32 dma_sig;\t\t\t \n\tconst char *dev_name;\t\t \n\tvoid (*callback)(void *data);\t \n\tvoid *data;\t\t\t \n\tstruct hidma_lldev *lldev;\t \n\tu32 tre_local[HIDMA_TRE_SIZE / sizeof(u32) + 1];  \n\tu32 tre_index;\t\t\t \n\tu32 int_flags;\t\t\t \n\tu8 err_info;\t\t\t \n\tu8 err_code;\t\t\t \n};\n\nstruct hidma_lldev {\n\tbool msi_support;\t\t \n\tbool initialized;\t\t \n\tu8 trch_state;\t\t\t \n\tu8 evch_state;\t\t\t \n\tu8 chidx;\t\t\t \n\tu32 nr_tres;\t\t\t \n\tspinlock_t lock;\t\t \n\tstruct hidma_tre *trepool;\t \n\tstruct device *dev;\t\t \n\tvoid __iomem *trca;\t\t \n\tvoid __iomem *evca;\t\t \n\tstruct hidma_tre\n\t\t**pending_tre_list;\t \n\tatomic_t pending_tre_count;\t \n\n\tvoid *tre_ring;\t\t\t \n\tdma_addr_t tre_dma;\t\t \n\tu32 tre_ring_size;\t\t \n\tu32 tre_processed_off;\t\t \n\n\tvoid *evre_ring;\t\t \n\tdma_addr_t evre_dma;\t\t \n\tu32 evre_ring_size;\t\t \n\tu32 evre_processed_off;\t\t \n\n\tu32 tre_write_offset;            \n\tstruct tasklet_struct task;\t \n\tDECLARE_KFIFO_PTR(handoff_fifo,\n\t\tstruct hidma_tre *);     \n};\n\nstruct hidma_desc {\n\tstruct dma_async_tx_descriptor\tdesc;\n\t \n\tstruct list_head\t\tnode;\n\tu32\t\t\t\ttre_ch;\n};\n\nstruct hidma_chan {\n\tbool\t\t\t\tpaused;\n\tbool\t\t\t\tallocated;\n\tchar\t\t\t\tdbg_name[16];\n\tu32\t\t\t\tdma_sig;\n\tdma_cookie_t\t\t\tlast_success;\n\n\t \n\tstruct hidma_dev\t\t*dmadev;\n\tstruct hidma_desc\t\t*running;\n\n\tstruct dma_chan\t\t\tchan;\n\tstruct list_head\t\tfree;\n\tstruct list_head\t\tprepared;\n\tstruct list_head\t\tqueued;\n\tstruct list_head\t\tactive;\n\tstruct list_head\t\tcompleted;\n\n\t \n\tspinlock_t\t\t\tlock;\n};\n\nstruct hidma_dev {\n\tint\t\t\t\tirq;\n\tint\t\t\t\tchidx;\n\tu32\t\t\t\tnr_descriptors;\n\tint\t\t\t\tmsi_virqbase;\n\n\tstruct hidma_lldev\t\t*lldev;\n\tvoid\t\t\t\t__iomem *dev_trca;\n\tstruct resource\t\t\t*trca_resource;\n\tvoid\t\t\t\t__iomem *dev_evca;\n\tstruct resource\t\t\t*evca_resource;\n\n\t \n\tspinlock_t\t\t\tlock;\n\tstruct dma_device\t\tddev;\n\n\tstruct dentry\t\t\t*debugfs;\n\n\t \n\tstruct device_attribute\t\t*chid_attrs;\n\n\t \n\tstruct tasklet_struct\t\ttask;\n};\n\nint hidma_ll_request(struct hidma_lldev *llhndl, u32 dev_id,\n\t\t\tconst char *dev_name,\n\t\t\tvoid (*callback)(void *data), void *data, u32 *tre_ch);\n\nvoid hidma_ll_free(struct hidma_lldev *llhndl, u32 tre_ch);\nenum dma_status hidma_ll_status(struct hidma_lldev *llhndl, u32 tre_ch);\nbool hidma_ll_isenabled(struct hidma_lldev *llhndl);\nvoid hidma_ll_queue_request(struct hidma_lldev *llhndl, u32 tre_ch);\nvoid hidma_ll_start(struct hidma_lldev *llhndl);\nint hidma_ll_disable(struct hidma_lldev *lldev);\nint hidma_ll_enable(struct hidma_lldev *llhndl);\nvoid hidma_ll_set_transfer_params(struct hidma_lldev *llhndl, u32 tre_ch,\n\tdma_addr_t src, dma_addr_t dest, u32 len, u32 flags, u32 txntype);\nvoid hidma_ll_setup_irq(struct hidma_lldev *lldev, bool msi);\nint hidma_ll_setup(struct hidma_lldev *lldev);\nstruct hidma_lldev *hidma_ll_init(struct device *dev, u32 max_channels,\n\t\t\tvoid __iomem *trca, void __iomem *evca,\n\t\t\tu8 chidx);\nint hidma_ll_uninit(struct hidma_lldev *llhndl);\nirqreturn_t hidma_ll_inthandler(int irq, void *arg);\nirqreturn_t hidma_ll_inthandler_msi(int irq, void *arg, int cause);\nvoid hidma_cleanup_pending_tre(struct hidma_lldev *llhndl, u8 err_info,\n\t\t\t\tu8 err_code);\nvoid hidma_debug_init(struct hidma_dev *dmadev);\nvoid hidma_debug_uninit(struct hidma_dev *dmadev);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}