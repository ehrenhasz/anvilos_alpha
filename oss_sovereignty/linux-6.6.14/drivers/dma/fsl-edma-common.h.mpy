{
  "module_name": "fsl-edma-common.h",
  "hash_id": "4df29e91147e5a49d228682c6911d4fce49bdc994c62583f130cf8a5b0f6dc26",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/fsl-edma-common.h",
  "human_readable_source": " \n \n#ifndef _FSL_EDMA_COMMON_H_\n#define _FSL_EDMA_COMMON_H_\n\n#include <linux/dma-direction.h>\n#include <linux/platform_device.h>\n#include \"virt-dma.h\"\n\n#define EDMA_CR_EDBG\t\tBIT(1)\n#define EDMA_CR_ERCA\t\tBIT(2)\n#define EDMA_CR_ERGA\t\tBIT(3)\n#define EDMA_CR_HOE\t\tBIT(4)\n#define EDMA_CR_HALT\t\tBIT(5)\n#define EDMA_CR_CLM\t\tBIT(6)\n#define EDMA_CR_EMLM\t\tBIT(7)\n#define EDMA_CR_ECX\t\tBIT(16)\n#define EDMA_CR_CX\t\tBIT(17)\n\n#define EDMA_SEEI_SEEI(x)\t((x) & GENMASK(4, 0))\n#define EDMA_CEEI_CEEI(x)\t((x) & GENMASK(4, 0))\n#define EDMA_CINT_CINT(x)\t((x) & GENMASK(4, 0))\n#define EDMA_CERR_CERR(x)\t((x) & GENMASK(4, 0))\n\n#define EDMA_TCD_ATTR_DSIZE(x)\t\t(((x) & GENMASK(2, 0)))\n#define EDMA_TCD_ATTR_DMOD(x)\t\t(((x) & GENMASK(4, 0)) << 3)\n#define EDMA_TCD_ATTR_SSIZE(x)\t\t(((x) & GENMASK(2, 0)) << 8)\n#define EDMA_TCD_ATTR_SMOD(x)\t\t(((x) & GENMASK(4, 0)) << 11)\n\n#define EDMA_TCD_CITER_CITER(x)\t\t((x) & GENMASK(14, 0))\n#define EDMA_TCD_BITER_BITER(x)\t\t((x) & GENMASK(14, 0))\n\n#define EDMA_TCD_CSR_START\t\tBIT(0)\n#define EDMA_TCD_CSR_INT_MAJOR\t\tBIT(1)\n#define EDMA_TCD_CSR_INT_HALF\t\tBIT(2)\n#define EDMA_TCD_CSR_D_REQ\t\tBIT(3)\n#define EDMA_TCD_CSR_E_SG\t\tBIT(4)\n#define EDMA_TCD_CSR_E_LINK\t\tBIT(5)\n#define EDMA_TCD_CSR_ACTIVE\t\tBIT(6)\n#define EDMA_TCD_CSR_DONE\t\tBIT(7)\n\n#define EDMA_V3_TCD_NBYTES_MLOFF_NBYTES(x) ((x) & GENMASK(9, 0))\n#define EDMA_V3_TCD_NBYTES_MLOFF(x)        (x << 10)\n#define EDMA_V3_TCD_NBYTES_DMLOE           (1 << 30)\n#define EDMA_V3_TCD_NBYTES_SMLOE           (1 << 31)\n\n#define EDMAMUX_CHCFG_DIS\t\t0x0\n#define EDMAMUX_CHCFG_ENBL\t\t0x80\n#define EDMAMUX_CHCFG_SOURCE(n)\t\t((n) & 0x3F)\n\n#define DMAMUX_NR\t2\n\n#define EDMA_TCD                0x1000\n\n#define FSL_EDMA_BUSWIDTHS\t(BIT(DMA_SLAVE_BUSWIDTH_1_BYTE) | \\\n\t\t\t\t BIT(DMA_SLAVE_BUSWIDTH_2_BYTES) | \\\n\t\t\t\t BIT(DMA_SLAVE_BUSWIDTH_4_BYTES) | \\\n\t\t\t\t BIT(DMA_SLAVE_BUSWIDTH_8_BYTES))\n\n#define EDMA_V3_CH_SBR_RD          BIT(22)\n#define EDMA_V3_CH_SBR_WR          BIT(21)\n#define EDMA_V3_CH_CSR_ERQ         BIT(0)\n#define EDMA_V3_CH_CSR_EARQ        BIT(1)\n#define EDMA_V3_CH_CSR_EEI         BIT(2)\n#define EDMA_V3_CH_CSR_DONE        BIT(30)\n#define EDMA_V3_CH_CSR_ACTIVE      BIT(31)\n\nenum fsl_edma_pm_state {\n\tRUNNING = 0,\n\tSUSPENDED,\n};\n\nstruct fsl_edma_hw_tcd {\n\t__le32\tsaddr;\n\t__le16\tsoff;\n\t__le16\tattr;\n\t__le32\tnbytes;\n\t__le32\tslast;\n\t__le32\tdaddr;\n\t__le16\tdoff;\n\t__le16\tciter;\n\t__le32\tdlast_sga;\n\t__le16\tcsr;\n\t__le16\tbiter;\n};\n\nstruct fsl_edma3_ch_reg {\n\t__le32\tch_csr;\n\t__le32\tch_es;\n\t__le32\tch_int;\n\t__le32\tch_sbr;\n\t__le32\tch_pri;\n\t__le32\tch_mux;\n\t__le32  ch_mattr;  \n\t__le32  ch_reserved;\n\tstruct fsl_edma_hw_tcd tcd;\n} __packed;\n\n \nstruct edma_regs {\n\tvoid __iomem *cr;\n\tvoid __iomem *es;\n\tvoid __iomem *erqh;\n\tvoid __iomem *erql;\t \n\tvoid __iomem *eeih;\n\tvoid __iomem *eeil;\t \n\tvoid __iomem *seei;\n\tvoid __iomem *ceei;\n\tvoid __iomem *serq;\n\tvoid __iomem *cerq;\n\tvoid __iomem *cint;\n\tvoid __iomem *cerr;\n\tvoid __iomem *ssrt;\n\tvoid __iomem *cdne;\n\tvoid __iomem *inth;\n\tvoid __iomem *intl;\n\tvoid __iomem *errh;\n\tvoid __iomem *errl;\n};\n\nstruct fsl_edma_sw_tcd {\n\tdma_addr_t\t\t\tptcd;\n\tstruct fsl_edma_hw_tcd\t\t*vtcd;\n};\n\nstruct fsl_edma_chan {\n\tstruct virt_dma_chan\t\tvchan;\n\tenum dma_status\t\t\tstatus;\n\tenum fsl_edma_pm_state\t\tpm_state;\n\tbool\t\t\t\tidle;\n\tu32\t\t\t\tslave_id;\n\tstruct fsl_edma_engine\t\t*edma;\n\tstruct fsl_edma_desc\t\t*edesc;\n\tstruct dma_slave_config\t\tcfg;\n\tu32\t\t\t\tattr;\n\tbool                            is_sw;\n\tstruct dma_pool\t\t\t*tcd_pool;\n\tdma_addr_t\t\t\tdma_dev_addr;\n\tu32\t\t\t\tdma_dev_size;\n\tenum dma_data_direction\t\tdma_dir;\n\tchar\t\t\t\tchan_name[32];\n\tstruct fsl_edma_hw_tcd __iomem *tcd;\n\tu32\t\t\t\treal_count;\n\tstruct work_struct\t\tissue_worker;\n\tstruct platform_device\t\t*pdev;\n\tstruct device\t\t\t*pd_dev;\n\tu32\t\t\t\tsrcid;\n\tstruct clk\t\t\t*clk;\n\tint                             priority;\n\tint\t\t\t\thw_chanid;\n\tint\t\t\t\ttxirq;\n\tbool\t\t\t\tis_rxchan;\n\tbool\t\t\t\tis_remote;\n\tbool\t\t\t\tis_multi_fifo;\n};\n\nstruct fsl_edma_desc {\n\tstruct virt_dma_desc\t\tvdesc;\n\tstruct fsl_edma_chan\t\t*echan;\n\tbool\t\t\t\tiscyclic;\n\tenum dma_transfer_direction\tdirn;\n\tunsigned int\t\t\tn_tcds;\n\tstruct fsl_edma_sw_tcd\t\ttcd[];\n};\n\n#define FSL_EDMA_DRV_HAS_DMACLK\t\tBIT(0)\n#define FSL_EDMA_DRV_MUX_SWAP\t\tBIT(1)\n#define FSL_EDMA_DRV_CONFIG32\t\tBIT(2)\n#define FSL_EDMA_DRV_WRAP_IO\t\tBIT(3)\n#define FSL_EDMA_DRV_EDMA64\t\tBIT(4)\n#define FSL_EDMA_DRV_HAS_PD\t\tBIT(5)\n#define FSL_EDMA_DRV_HAS_CHCLK\t\tBIT(6)\n#define FSL_EDMA_DRV_HAS_CHMUX\t\tBIT(7)\n \n#define FSL_EDMA_DRV_QUIRK_SWAPPED\tBIT(8)\n \n#define FSL_EDMA_DRV_SPLIT_REG\t\tBIT(9)\n#define FSL_EDMA_DRV_BUS_8BYTE\t\tBIT(10)\n#define FSL_EDMA_DRV_DEV_TO_DEV\t\tBIT(11)\n#define FSL_EDMA_DRV_ALIGN_64BYTE\tBIT(12)\n \n#define FSL_EDMA_DRV_CLEAR_DONE_E_SG\tBIT(13)\n \n#define FSL_EDMA_DRV_CLEAR_DONE_E_LINK\tBIT(14)\n\n#define FSL_EDMA_DRV_EDMA3\t(FSL_EDMA_DRV_SPLIT_REG |\t\\\n\t\t\t\t FSL_EDMA_DRV_BUS_8BYTE |\t\\\n\t\t\t\t FSL_EDMA_DRV_DEV_TO_DEV |\t\\\n\t\t\t\t FSL_EDMA_DRV_ALIGN_64BYTE |\t\\\n\t\t\t\t FSL_EDMA_DRV_CLEAR_DONE_E_SG |\t\\\n\t\t\t\t FSL_EDMA_DRV_CLEAR_DONE_E_LINK)\n\n#define FSL_EDMA_DRV_EDMA4\t(FSL_EDMA_DRV_SPLIT_REG |\t\\\n\t\t\t\t FSL_EDMA_DRV_BUS_8BYTE |\t\\\n\t\t\t\t FSL_EDMA_DRV_DEV_TO_DEV |\t\\\n\t\t\t\t FSL_EDMA_DRV_ALIGN_64BYTE |\t\\\n\t\t\t\t FSL_EDMA_DRV_CLEAR_DONE_E_LINK)\n\nstruct fsl_edma_drvdata {\n\tu32\t\t\tdmamuxs;  \n\tu32\t\t\tchreg_off;\n\tu32\t\t\tchreg_space_sz;\n\tu32\t\t\tflags;\n\tint\t\t\t(*setup_irq)(struct platform_device *pdev,\n\t\t\t\t\t     struct fsl_edma_engine *fsl_edma);\n};\n\nstruct fsl_edma_engine {\n\tstruct dma_device\tdma_dev;\n\tvoid __iomem\t\t*membase;\n\tvoid __iomem\t\t*muxbase[DMAMUX_NR];\n\tstruct clk\t\t*muxclk[DMAMUX_NR];\n\tstruct clk\t\t*dmaclk;\n\tstruct clk\t\t*chclk;\n\tstruct mutex\t\tfsl_edma_mutex;\n\tconst struct fsl_edma_drvdata *drvdata;\n\tu32\t\t\tn_chans;\n\tint\t\t\ttxirq;\n\tint\t\t\terrirq;\n\tbool\t\t\tbig_endian;\n\tstruct edma_regs\tregs;\n\tu64\t\t\tchan_masked;\n\tstruct fsl_edma_chan\tchans[];\n};\n\n#define edma_read_tcdreg(chan, __name)\t\t\t\t\\\n(sizeof(chan->tcd->__name) == sizeof(u32) ?\t\t\t\\\n\tedma_readl(chan->edma, &chan->tcd->__name) :\t\t\\\n\tedma_readw(chan->edma, &chan->tcd->__name))\n\n#define edma_write_tcdreg(chan, val, __name)\t\t\t\\\n(sizeof(chan->tcd->__name) == sizeof(u32) ?\t\t\t\\\n\tedma_writel(chan->edma, (u32 __force)val, &chan->tcd->__name) :\t\\\n\tedma_writew(chan->edma, (u16 __force)val, &chan->tcd->__name))\n\n#define edma_readl_chreg(chan, __name)\t\t\t\t\\\n\tedma_readl(chan->edma,\t\t\t\t\t\\\n\t\t   (void __iomem *)&(container_of(chan->tcd, struct fsl_edma3_ch_reg, tcd)->__name))\n\n#define edma_writel_chreg(chan, val,  __name)\t\t\t\\\n\tedma_writel(chan->edma, val,\t\t\t\t\\\n\t\t   (void __iomem *)&(container_of(chan->tcd, struct fsl_edma3_ch_reg, tcd)->__name))\n\n \nstatic inline u32 edma_readl(struct fsl_edma_engine *edma, void __iomem *addr)\n{\n\tif (edma->big_endian)\n\t\treturn ioread32be(addr);\n\telse\n\t\treturn ioread32(addr);\n}\n\nstatic inline u16 edma_readw(struct fsl_edma_engine *edma, void __iomem *addr)\n{\n\tif (edma->big_endian)\n\t\treturn ioread16be(addr);\n\telse\n\t\treturn ioread16(addr);\n}\n\nstatic inline void edma_writeb(struct fsl_edma_engine *edma,\n\t\t\t       u8 val, void __iomem *addr)\n{\n\t \n\tif (edma->big_endian)\n\t\tiowrite8(val, (void __iomem *)((unsigned long)addr ^ 0x3));\n\telse\n\t\tiowrite8(val, addr);\n}\n\nstatic inline void edma_writew(struct fsl_edma_engine *edma,\n\t\t\t       u16 val, void __iomem *addr)\n{\n\t \n\tif (edma->big_endian)\n\t\tiowrite16be(val, (void __iomem *)((unsigned long)addr ^ 0x2));\n\telse\n\t\tiowrite16(val, addr);\n}\n\nstatic inline void edma_writel(struct fsl_edma_engine *edma,\n\t\t\t       u32 val, void __iomem *addr)\n{\n\tif (edma->big_endian)\n\t\tiowrite32be(val, addr);\n\telse\n\t\tiowrite32(val, addr);\n}\n\nstatic inline struct fsl_edma_chan *to_fsl_edma_chan(struct dma_chan *chan)\n{\n\treturn container_of(chan, struct fsl_edma_chan, vchan.chan);\n}\n\nstatic inline u32 fsl_edma_drvflags(struct fsl_edma_chan *fsl_chan)\n{\n\treturn fsl_chan->edma->drvdata->flags;\n}\n\nstatic inline struct fsl_edma_desc *to_fsl_edma_desc(struct virt_dma_desc *vd)\n{\n\treturn container_of(vd, struct fsl_edma_desc, vdesc);\n}\n\nstatic inline void fsl_edma_err_chan_handler(struct fsl_edma_chan *fsl_chan)\n{\n\tfsl_chan->status = DMA_ERROR;\n\tfsl_chan->idle = true;\n}\n\nvoid fsl_edma_tx_chan_handler(struct fsl_edma_chan *fsl_chan);\nvoid fsl_edma_disable_request(struct fsl_edma_chan *fsl_chan);\nvoid fsl_edma_chan_mux(struct fsl_edma_chan *fsl_chan,\n\t\t\tunsigned int slot, bool enable);\nvoid fsl_edma_free_desc(struct virt_dma_desc *vdesc);\nint fsl_edma_terminate_all(struct dma_chan *chan);\nint fsl_edma_pause(struct dma_chan *chan);\nint fsl_edma_resume(struct dma_chan *chan);\nint fsl_edma_slave_config(struct dma_chan *chan,\n\t\t\t\t struct dma_slave_config *cfg);\nenum dma_status fsl_edma_tx_status(struct dma_chan *chan,\n\t\tdma_cookie_t cookie, struct dma_tx_state *txstate);\nstruct dma_async_tx_descriptor *fsl_edma_prep_dma_cyclic(\n\t\tstruct dma_chan *chan, dma_addr_t dma_addr, size_t buf_len,\n\t\tsize_t period_len, enum dma_transfer_direction direction,\n\t\tunsigned long flags);\nstruct dma_async_tx_descriptor *fsl_edma_prep_slave_sg(\n\t\tstruct dma_chan *chan, struct scatterlist *sgl,\n\t\tunsigned int sg_len, enum dma_transfer_direction direction,\n\t\tunsigned long flags, void *context);\nstruct dma_async_tx_descriptor *fsl_edma_prep_memcpy(\n\t\tstruct dma_chan *chan, dma_addr_t dma_dst, dma_addr_t dma_src,\n\t\tsize_t len, unsigned long flags);\nvoid fsl_edma_xfer_desc(struct fsl_edma_chan *fsl_chan);\nvoid fsl_edma_issue_pending(struct dma_chan *chan);\nint fsl_edma_alloc_chan_resources(struct dma_chan *chan);\nvoid fsl_edma_free_chan_resources(struct dma_chan *chan);\nvoid fsl_edma_cleanup_vchan(struct dma_device *dmadev);\nvoid fsl_edma_setup_regs(struct fsl_edma_engine *edma);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}