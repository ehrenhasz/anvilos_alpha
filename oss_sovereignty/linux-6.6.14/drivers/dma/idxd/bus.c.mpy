{
  "module_name": "bus.c",
  "hash_id": "79e8284b838def999ad29276e62e41febe576d583948db45ac90eaf0038574da",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/idxd/bus.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/device.h>\n#include \"idxd.h\"\n\n\nint __idxd_driver_register(struct idxd_device_driver *idxd_drv, struct module *owner,\n\t\t\t   const char *mod_name)\n{\n\tstruct device_driver *drv = &idxd_drv->drv;\n\n\tif (!idxd_drv->type) {\n\t\tpr_debug(\"driver type not set (%ps)\\n\", __builtin_return_address(0));\n\t\treturn -EINVAL;\n\t}\n\n\tdrv->name = idxd_drv->name;\n\tdrv->bus = &dsa_bus_type;\n\tdrv->owner = owner;\n\tdrv->mod_name = mod_name;\n\n\treturn driver_register(drv);\n}\nEXPORT_SYMBOL_GPL(__idxd_driver_register);\n\nvoid idxd_driver_unregister(struct idxd_device_driver *idxd_drv)\n{\n\tdriver_unregister(&idxd_drv->drv);\n}\nEXPORT_SYMBOL_GPL(idxd_driver_unregister);\n\nstatic int idxd_config_bus_match(struct device *dev,\n\t\t\t\t struct device_driver *drv)\n{\n\tstruct idxd_device_driver *idxd_drv =\n\t\tcontainer_of(drv, struct idxd_device_driver, drv);\n\tstruct idxd_dev *idxd_dev = confdev_to_idxd_dev(dev);\n\tint i = 0;\n\n\twhile (idxd_drv->type[i] != IDXD_DEV_NONE) {\n\t\tif (idxd_dev->type == idxd_drv->type[i])\n\t\t\treturn 1;\n\t\ti++;\n\t}\n\n\treturn 0;\n}\n\nstatic int idxd_config_bus_probe(struct device *dev)\n{\n\tstruct idxd_device_driver *idxd_drv =\n\t\tcontainer_of(dev->driver, struct idxd_device_driver, drv);\n\tstruct idxd_dev *idxd_dev = confdev_to_idxd_dev(dev);\n\n\treturn idxd_drv->probe(idxd_dev);\n}\n\nstatic void idxd_config_bus_remove(struct device *dev)\n{\n\tstruct idxd_device_driver *idxd_drv =\n\t\tcontainer_of(dev->driver, struct idxd_device_driver, drv);\n\tstruct idxd_dev *idxd_dev = confdev_to_idxd_dev(dev);\n\n\tidxd_drv->remove(idxd_dev);\n}\n\nstruct bus_type dsa_bus_type = {\n\t.name = \"dsa\",\n\t.match = idxd_config_bus_match,\n\t.probe = idxd_config_bus_probe,\n\t.remove = idxd_config_bus_remove,\n};\nEXPORT_SYMBOL_GPL(dsa_bus_type);\n\nstatic int __init dsa_bus_init(void)\n{\n\treturn bus_register(&dsa_bus_type);\n}\nmodule_init(dsa_bus_init);\n\nstatic void __exit dsa_bus_exit(void)\n{\n\tbus_unregister(&dsa_bus_type);\n}\nmodule_exit(dsa_bus_exit);\n\nMODULE_DESCRIPTION(\"IDXD driver dsa_bus_type driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}