{
  "module_name": "compat.c",
  "hash_id": "0e5b3824252334a21615f9502b1372e76d3177d55e6e499500f4269bd2708c5a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/idxd/compat.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/device/bus.h>\n#include \"idxd.h\"\n\nextern int device_driver_attach(struct device_driver *drv, struct device *dev);\nextern void device_driver_detach(struct device *dev);\n\n#define DRIVER_ATTR_IGNORE_LOCKDEP(_name, _mode, _show, _store)\t\\\n\tstruct driver_attribute driver_attr_##_name =\t\t\\\n\t__ATTR_IGNORE_LOCKDEP(_name, _mode, _show, _store)\n\nstatic ssize_t unbind_store(struct device_driver *drv, const char *buf, size_t count)\n{\n\tconst struct bus_type *bus = drv->bus;\n\tstruct device *dev;\n\tint rc = -ENODEV;\n\n\tdev = bus_find_device_by_name(bus, NULL, buf);\n\tif (dev && dev->driver) {\n\t\tdevice_driver_detach(dev);\n\t\trc = count;\n\t}\n\n\treturn rc;\n}\nstatic DRIVER_ATTR_IGNORE_LOCKDEP(unbind, 0200, NULL, unbind_store);\n\nstatic ssize_t bind_store(struct device_driver *drv, const char *buf, size_t count)\n{\n\tconst struct bus_type *bus = drv->bus;\n\tstruct device *dev;\n\tstruct device_driver *alt_drv = NULL;\n\tint rc = -ENODEV;\n\tstruct idxd_dev *idxd_dev;\n\n\tdev = bus_find_device_by_name(bus, NULL, buf);\n\tif (!dev || dev->driver || drv != &dsa_drv.drv)\n\t\treturn -ENODEV;\n\n\tidxd_dev = confdev_to_idxd_dev(dev);\n\tif (is_idxd_dev(idxd_dev)) {\n\t\talt_drv = driver_find(\"idxd\", bus);\n\t} else if (is_idxd_wq_dev(idxd_dev)) {\n\t\tstruct idxd_wq *wq = confdev_to_wq(dev);\n\n\t\tif (is_idxd_wq_kernel(wq))\n\t\t\talt_drv = driver_find(\"dmaengine\", bus);\n\t\telse if (is_idxd_wq_user(wq))\n\t\t\talt_drv = driver_find(\"user\", bus);\n\t}\n\tif (!alt_drv)\n\t\treturn -ENODEV;\n\n\trc = device_driver_attach(alt_drv, dev);\n\tif (rc < 0)\n\t\treturn rc;\n\n\treturn count;\n}\nstatic DRIVER_ATTR_IGNORE_LOCKDEP(bind, 0200, NULL, bind_store);\n\nstatic struct attribute *dsa_drv_compat_attrs[] = {\n\t&driver_attr_bind.attr,\n\t&driver_attr_unbind.attr,\n\tNULL,\n};\n\nstatic const struct attribute_group dsa_drv_compat_attr_group = {\n\t.attrs = dsa_drv_compat_attrs,\n};\n\nstatic const struct attribute_group *dsa_drv_compat_groups[] = {\n\t&dsa_drv_compat_attr_group,\n\tNULL,\n};\n\nstatic int idxd_dsa_drv_probe(struct idxd_dev *idxd_dev)\n{\n\treturn -ENODEV;\n}\n\nstatic void idxd_dsa_drv_remove(struct idxd_dev *idxd_dev)\n{\n}\n\nstatic enum idxd_dev_type dev_types[] = {\n\tIDXD_DEV_NONE,\n};\n\nstruct idxd_device_driver dsa_drv = {\n\t.name = \"dsa\",\n\t.probe = idxd_dsa_drv_probe,\n\t.remove = idxd_dsa_drv_remove,\n\t.type = dev_types,\n\t.drv = {\n\t\t.suppress_bind_attrs = true,\n\t\t.groups = dsa_drv_compat_groups,\n\t},\n};\n\nmodule_idxd_driver(dsa_drv);\nMODULE_IMPORT_NS(IDXD);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}