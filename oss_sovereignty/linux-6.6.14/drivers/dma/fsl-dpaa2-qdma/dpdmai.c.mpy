{
  "module_name": "dpdmai.c",
  "hash_id": "2f0a0510c4c12366b26d1466801d647f1edfb939c16df0846426ed40385b2842",
  "original_prompt": "Ingested from linux-6.6.14/drivers/dma/fsl-dpaa2-qdma/dpdmai.c",
  "human_readable_source": "\n\n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/io.h>\n#include <linux/fsl/mc.h>\n#include \"dpdmai.h\"\n\nstruct dpdmai_rsp_get_attributes {\n\t__le32 id;\n\tu8 num_of_priorities;\n\tu8 pad0[3];\n\t__le16 major;\n\t__le16 minor;\n};\n\nstruct dpdmai_cmd_queue {\n\t__le32 dest_id;\n\tu8 priority;\n\tu8 queue;\n\tu8 dest_type;\n\tu8 pad;\n\t__le64 user_ctx;\n\tunion {\n\t\t__le32 options;\n\t\t__le32 fqid;\n\t};\n};\n\nstruct dpdmai_rsp_get_tx_queue {\n\t__le64 pad;\n\t__le32 fqid;\n};\n\n#define MC_CMD_OP(_cmd, _param, _offset, _width, _type, _arg) \\\n\t((_cmd).params[_param] |= mc_enc((_offset), (_width), _arg))\n\n \n#define DPDMAI_CMD_CREATE(cmd, cfg) \\\ndo { \\\n\tMC_CMD_OP(cmd, 0, 8,  8,  u8,  (cfg)->priorities[0]);\\\n\tMC_CMD_OP(cmd, 0, 16, 8,  u8,  (cfg)->priorities[1]);\\\n} while (0)\n\nstatic inline u64 mc_enc(int lsoffset, int width, u64 val)\n{\n\treturn (val & MAKE_UMASK64(width)) << lsoffset;\n}\n\n \nint dpdmai_open(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\t\tint dpdmai_id, u16 *token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\t__le64 *cmd_dpdmai_id;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_OPEN,\n\t\t\t\t\t  cmd_flags, 0);\n\n\tcmd_dpdmai_id = cmd.params;\n\t*cmd_dpdmai_id = cpu_to_le32(dpdmai_id);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\t*token = mc_cmd_hdr_read_token(&cmd);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(dpdmai_open);\n\n \nint dpdmai_close(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_CLOSE,\n\t\t\t\t\t  cmd_flags, token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\nEXPORT_SYMBOL_GPL(dpdmai_close);\n\n \nint dpdmai_create(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\t\t  const struct dpdmai_cfg *cfg, u16 *token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_CREATE,\n\t\t\t\t\t  cmd_flags, 0);\n\tDPDMAI_CMD_CREATE(cmd, cfg);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\t*token = mc_cmd_hdr_read_token(&cmd);\n\n\treturn 0;\n}\n\n \nint dpdmai_destroy(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_DESTROY,\n\t\t\t\t\t  cmd_flags, token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\nEXPORT_SYMBOL_GPL(dpdmai_destroy);\n\n \nint dpdmai_enable(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_ENABLE,\n\t\t\t\t\t  cmd_flags, token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\nEXPORT_SYMBOL_GPL(dpdmai_enable);\n\n \nint dpdmai_disable(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_DISABLE,\n\t\t\t\t\t  cmd_flags, token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\nEXPORT_SYMBOL_GPL(dpdmai_disable);\n\n \nint dpdmai_reset(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_RESET,\n\t\t\t\t\t  cmd_flags, token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\nEXPORT_SYMBOL_GPL(dpdmai_reset);\n\n \nint dpdmai_get_attributes(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\t\t\t  u16 token, struct dpdmai_attr *attr)\n{\n\tstruct dpdmai_rsp_get_attributes *rsp_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_GET_ATTR,\n\t\t\t\t\t  cmd_flags, token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpdmai_rsp_get_attributes *)cmd.params;\n\tattr->id = le32_to_cpu(rsp_params->id);\n\tattr->version.major = le16_to_cpu(rsp_params->major);\n\tattr->version.minor = le16_to_cpu(rsp_params->minor);\n\tattr->num_of_priorities = rsp_params->num_of_priorities;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(dpdmai_get_attributes);\n\n \nint dpdmai_set_rx_queue(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\tu8 priority, const struct dpdmai_rx_queue_cfg *cfg)\n{\n\tstruct dpdmai_cmd_queue *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_SET_RX_QUEUE,\n\t\t\t\t\t  cmd_flags, token);\n\n\tcmd_params = (struct dpdmai_cmd_queue *)cmd.params;\n\tcmd_params->dest_id = cpu_to_le32(cfg->dest_cfg.dest_id);\n\tcmd_params->priority = cfg->dest_cfg.priority;\n\tcmd_params->queue = priority;\n\tcmd_params->dest_type = cfg->dest_cfg.dest_type;\n\tcmd_params->user_ctx = cpu_to_le64(cfg->user_ctx);\n\tcmd_params->options = cpu_to_le32(cfg->options);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\nEXPORT_SYMBOL_GPL(dpdmai_set_rx_queue);\n\n \nint dpdmai_get_rx_queue(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\tu8 priority, struct dpdmai_rx_queue_attr *attr)\n{\n\tstruct dpdmai_cmd_queue *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_GET_RX_QUEUE,\n\t\t\t\t\t  cmd_flags, token);\n\n\tcmd_params = (struct dpdmai_cmd_queue *)cmd.params;\n\tcmd_params->queue = priority;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\tattr->dest_cfg.dest_id = le32_to_cpu(cmd_params->dest_id);\n\tattr->dest_cfg.priority = cmd_params->priority;\n\tattr->dest_cfg.dest_type = cmd_params->dest_type;\n\tattr->user_ctx = le64_to_cpu(cmd_params->user_ctx);\n\tattr->fqid = le32_to_cpu(cmd_params->fqid);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(dpdmai_get_rx_queue);\n\n \nint dpdmai_get_tx_queue(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\t\t\tu16 token, u8 priority, u32 *fqid)\n{\n\tstruct dpdmai_rsp_get_tx_queue *rsp_params;\n\tstruct dpdmai_cmd_queue *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPDMAI_CMDID_GET_TX_QUEUE,\n\t\t\t\t\t  cmd_flags, token);\n\n\tcmd_params = (struct dpdmai_cmd_queue *)cmd.params;\n\tcmd_params->queue = priority;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\n\trsp_params = (struct dpdmai_rsp_get_tx_queue *)cmd.params;\n\t*fqid = le32_to_cpu(rsp_params->fqid);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(dpdmai_get_tx_queue);\n\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}