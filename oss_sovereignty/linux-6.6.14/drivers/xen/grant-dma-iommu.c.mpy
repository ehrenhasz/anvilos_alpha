{
  "module_name": "grant-dma-iommu.c",
  "hash_id": "0cf15e52a48132e906faf23ae90e2f11989b06ef79ed3985266ef606415aea06",
  "original_prompt": "Ingested from linux-6.6.14/drivers/xen/grant-dma-iommu.c",
  "human_readable_source": "\n \n\n#include <linux/iommu.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n\nstruct grant_dma_iommu_device {\n\tstruct device *dev;\n\tstruct iommu_device iommu;\n};\n\nstatic struct iommu_device *grant_dma_iommu_probe_device(struct device *dev)\n{\n\treturn ERR_PTR(-ENODEV);\n}\n\n \nstatic const struct iommu_ops grant_dma_iommu_ops = {\n\t.probe_device = grant_dma_iommu_probe_device,\n};\n\nstatic const struct of_device_id grant_dma_iommu_of_match[] = {\n\t{ .compatible = \"xen,grant-dma\" },\n\t{ },\n};\n\nstatic int grant_dma_iommu_probe(struct platform_device *pdev)\n{\n\tstruct grant_dma_iommu_device *mmu;\n\tint ret;\n\n\tmmu = devm_kzalloc(&pdev->dev, sizeof(*mmu), GFP_KERNEL);\n\tif (!mmu)\n\t\treturn -ENOMEM;\n\n\tmmu->dev = &pdev->dev;\n\n\tret = iommu_device_register(&mmu->iommu, &grant_dma_iommu_ops, &pdev->dev);\n\tif (ret)\n\t\treturn ret;\n\n\tplatform_set_drvdata(pdev, mmu);\n\n\treturn 0;\n}\n\nstatic int grant_dma_iommu_remove(struct platform_device *pdev)\n{\n\tstruct grant_dma_iommu_device *mmu = platform_get_drvdata(pdev);\n\n\tplatform_set_drvdata(pdev, NULL);\n\tiommu_device_unregister(&mmu->iommu);\n\n\treturn 0;\n}\n\nstatic struct platform_driver grant_dma_iommu_driver = {\n\t.driver = {\n\t\t.name = \"grant-dma-iommu\",\n\t\t.of_match_table = grant_dma_iommu_of_match,\n\t},\n\t.probe = grant_dma_iommu_probe,\n\t.remove = grant_dma_iommu_remove,\n};\n\nstatic int __init grant_dma_iommu_init(void)\n{\n\tstruct device_node *iommu_np;\n\n\tiommu_np = of_find_matching_node(NULL, grant_dma_iommu_of_match);\n\tif (!iommu_np)\n\t\treturn 0;\n\n\tof_node_put(iommu_np);\n\n\treturn platform_driver_register(&grant_dma_iommu_driver);\n}\nsubsys_initcall(grant_dma_iommu_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}