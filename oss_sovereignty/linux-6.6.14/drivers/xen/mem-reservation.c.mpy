{
  "module_name": "mem-reservation.c",
  "hash_id": "d2af803c4bede16679ec0181f1259bf60def0ff331cc98835d7bdc1bb591bcd1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/xen/mem-reservation.c",
  "human_readable_source": "\n\n \n\n#include <asm/xen/hypercall.h>\n\n#include <xen/interface/memory.h>\n#include <xen/mem-reservation.h>\n#include <linux/moduleparam.h>\n\nbool __read_mostly xen_scrub_pages = IS_ENABLED(CONFIG_XEN_SCRUB_PAGES_DEFAULT);\ncore_param(xen_scrub_pages, xen_scrub_pages, bool, 0);\n\n \n#define EXTENT_ORDER (fls(XEN_PFN_PER_PAGE) - 1)\n\n#ifdef CONFIG_XEN_HAVE_PVMMU\nvoid __xenmem_reservation_va_mapping_update(unsigned long count,\n\t\t\t\t\t    struct page **pages,\n\t\t\t\t\t    xen_pfn_t *frames)\n{\n\tint i;\n\n\tfor (i = 0; i < count; i++) {\n\t\tstruct page *page = pages[i];\n\t\tunsigned long pfn = page_to_pfn(page);\n\t\tint ret;\n\n\t\tBUG_ON(!page);\n\n\t\t \n\t\tBUILD_BUG_ON(XEN_PAGE_SIZE != PAGE_SIZE);\n\n\t\tset_phys_to_machine(pfn, frames[i]);\n\n\t\tret = HYPERVISOR_update_va_mapping(\n\t\t\t\t(unsigned long)__va(pfn << PAGE_SHIFT),\n\t\t\t\tmfn_pte(frames[i], PAGE_KERNEL), 0);\n\t\tBUG_ON(ret);\n\t}\n}\nEXPORT_SYMBOL_GPL(__xenmem_reservation_va_mapping_update);\n\nvoid __xenmem_reservation_va_mapping_reset(unsigned long count,\n\t\t\t\t\t   struct page **pages)\n{\n\tint i;\n\n\tfor (i = 0; i < count; i++) {\n\t\tstruct page *page = pages[i];\n\t\tunsigned long pfn = page_to_pfn(page);\n\t\tint ret;\n\n\t\t \n\t\tBUILD_BUG_ON(XEN_PAGE_SIZE != PAGE_SIZE);\n\n\t\tret = HYPERVISOR_update_va_mapping(\n\t\t\t\t(unsigned long)__va(pfn << PAGE_SHIFT),\n\t\t\t\t__pte_ma(0), 0);\n\t\tBUG_ON(ret);\n\n\t\t__set_phys_to_machine(pfn, INVALID_P2M_ENTRY);\n\t}\n}\nEXPORT_SYMBOL_GPL(__xenmem_reservation_va_mapping_reset);\n#endif  \n\n \nint xenmem_reservation_increase(int count, xen_pfn_t *frames)\n{\n\tstruct xen_memory_reservation reservation = {\n\t\t.address_bits = 0,\n\t\t.extent_order = EXTENT_ORDER,\n\t\t.domid        = DOMID_SELF\n\t};\n\n\t \n\tset_xen_guest_handle(reservation.extent_start, frames);\n\treservation.nr_extents = count;\n\treturn HYPERVISOR_memory_op(XENMEM_populate_physmap, &reservation);\n}\nEXPORT_SYMBOL_GPL(xenmem_reservation_increase);\n\n \nint xenmem_reservation_decrease(int count, xen_pfn_t *frames)\n{\n\tstruct xen_memory_reservation reservation = {\n\t\t.address_bits = 0,\n\t\t.extent_order = EXTENT_ORDER,\n\t\t.domid        = DOMID_SELF\n\t};\n\n\t \n\tset_xen_guest_handle(reservation.extent_start, frames);\n\treservation.nr_extents = count;\n\treturn HYPERVISOR_memory_op(XENMEM_decrease_reservation, &reservation);\n}\nEXPORT_SYMBOL_GPL(xenmem_reservation_decrease);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}