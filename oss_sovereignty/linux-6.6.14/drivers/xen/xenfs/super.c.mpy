{
  "module_name": "super.c",
  "hash_id": "407f37fc77fea8b81687b1d7991cbb1e860436757e1d0bd5b61a9c3cd98d5172",
  "original_prompt": "Ingested from linux-6.6.14/drivers/xen/xenfs/super.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n#include <linux/fs.h>\n#include <linux/fs_context.h>\n#include <linux/magic.h>\n\n#include <xen/xen.h>\n#include <xen/xenbus.h>\n\n#include \"xenfs.h\"\n#include \"../privcmd.h\"\n\n#include <asm/xen/hypervisor.h>\n\nMODULE_DESCRIPTION(\"Xen filesystem\");\nMODULE_LICENSE(\"GPL\");\n\nstatic ssize_t capabilities_read(struct file *file, char __user *buf,\n\t\t\t\t size_t size, loff_t *off)\n{\n\tchar *tmp = \"\";\n\n\tif (xen_initial_domain())\n\t\ttmp = \"control_d\\n\";\n\n\treturn simple_read_from_buffer(buf, size, off, tmp, strlen(tmp));\n}\n\nstatic const struct file_operations capabilities_file_ops = {\n\t.read = capabilities_read,\n\t.llseek = default_llseek,\n};\n\nstatic int xenfs_fill_super(struct super_block *sb, struct fs_context *fc)\n{\n\tstatic const struct tree_descr xenfs_files[] = {\n\t\t[2] = { \"xenbus\", &xen_xenbus_fops, S_IRUSR|S_IWUSR },\n\t\t{ \"capabilities\", &capabilities_file_ops, S_IRUGO },\n\t\t{ \"privcmd\", &xen_privcmd_fops, S_IRUSR|S_IWUSR },\n\t\t{\"\"},\n\t};\n\n\tstatic const struct tree_descr xenfs_init_files[] = {\n\t\t[2] = { \"xenbus\", &xen_xenbus_fops, S_IRUSR|S_IWUSR },\n\t\t{ \"capabilities\", &capabilities_file_ops, S_IRUGO },\n\t\t{ \"privcmd\", &xen_privcmd_fops, S_IRUSR|S_IWUSR },\n\t\t{ \"xsd_kva\", &xsd_kva_file_ops, S_IRUSR|S_IWUSR},\n\t\t{ \"xsd_port\", &xsd_port_file_ops, S_IRUSR|S_IWUSR},\n#ifdef CONFIG_XEN_SYMS\n\t\t{ \"xensyms\", &xensyms_ops, S_IRUSR},\n#endif\n\t\t{\"\"},\n\t};\n\n\treturn simple_fill_super(sb, XENFS_SUPER_MAGIC,\n\t\t\txen_initial_domain() ? xenfs_init_files : xenfs_files);\n}\n\nstatic int xenfs_get_tree(struct fs_context *fc)\n{\n\treturn get_tree_single(fc, xenfs_fill_super);\n}\n\nstatic const struct fs_context_operations xenfs_context_ops = {\n\t.get_tree\t= xenfs_get_tree,\n};\n\nstatic int xenfs_init_fs_context(struct fs_context *fc)\n{\n\tfc->ops = &xenfs_context_ops;\n\treturn 0;\n}\n\nstatic struct file_system_type xenfs_type = {\n\t.owner =\tTHIS_MODULE,\n\t.name =\t\t\"xenfs\",\n\t.init_fs_context = xenfs_init_fs_context,\n\t.kill_sb =\tkill_litter_super,\n};\nMODULE_ALIAS_FS(\"xenfs\");\n\nstatic int __init xenfs_init(void)\n{\n\tif (xen_domain())\n\t\treturn register_filesystem(&xenfs_type);\n\n\treturn 0;\n}\n\nstatic void __exit xenfs_exit(void)\n{\n\tif (xen_domain())\n\t\tunregister_filesystem(&xenfs_type);\n}\n\nmodule_init(xenfs_init);\nmodule_exit(xenfs_exit);\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}