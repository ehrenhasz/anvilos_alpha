{
  "module_name": "sysfs.h",
  "hash_id": "7fdbed75265f12dc8fec695d9e6aa9cd82e5e108647bad08345244cf3d46ae1e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/md/bcache/sysfs.h",
  "human_readable_source": " \n#ifndef _BCACHE_SYSFS_H_\n#define _BCACHE_SYSFS_H_\n\n#define KTYPE(type)\t\t\t\t\t\t\t\\\nconst struct kobj_type type ## _ktype = {\t\t\t\t\t\\\n\t.release\t= type ## _release,\t\t\t\t\\\n\t.sysfs_ops\t= &((const struct sysfs_ops) {\t\t\t\\\n\t\t.show\t= type ## _show,\t\t\t\t\\\n\t\t.store\t= type ## _store\t\t\t\t\\\n\t}),\t\t\t\t\t\t\t\t\\\n\t.default_groups\t= type ## _groups\t\t\t\t\\\n}\n\n#define SHOW(fn)\t\t\t\t\t\t\t\\\nstatic ssize_t fn ## _show(struct kobject *kobj, struct attribute *attr,\\\n\t\t\t   char *buf)\t\t\t\t\t\\\n\n#define STORE(fn)\t\t\t\t\t\t\t\\\nstatic ssize_t fn ## _store(struct kobject *kobj, struct attribute *attr,\\\n\t\t\t    const char *buf, size_t size)\t\t\\\n\n#define SHOW_LOCKED(fn)\t\t\t\t\t\t\t\\\nSHOW(fn)\t\t\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tssize_t ret;\t\t\t\t\t\t\t\\\n\tmutex_lock(&bch_register_lock);\t\t\t\t\t\\\n\tret = __ ## fn ## _show(kobj, attr, buf);\t\t\t\\\n\tmutex_unlock(&bch_register_lock);\t\t\t\t\\\n\treturn ret;\t\t\t\t\t\t\t\\\n}\n\n#define STORE_LOCKED(fn)\t\t\t\t\t\t\\\nSTORE(fn)\t\t\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tssize_t ret;\t\t\t\t\t\t\t\\\n\tmutex_lock(&bch_register_lock);\t\t\t\t\t\\\n\tret = __ ## fn ## _store(kobj, attr, buf, size);\t\t\\\n\tmutex_unlock(&bch_register_lock);\t\t\t\t\\\n\treturn ret;\t\t\t\t\t\t\t\\\n}\n\n#define __sysfs_attribute(_name, _mode)\t\t\t\t\t\\\n\tstatic struct attribute sysfs_##_name =\t\t\t\t\\\n\t\t{ .name = #_name, .mode = _mode }\n\n#define write_attribute(n)\t__sysfs_attribute(n, 0200)\n#define read_attribute(n)\t__sysfs_attribute(n, 0444)\n#define rw_attribute(n)\t\t__sysfs_attribute(n, 0644)\n\n#define sysfs_printf(file, fmt, ...)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (attr == &sysfs_ ## file)\t\t\t\t\t\\\n\t\treturn sysfs_emit(buf, fmt \"\\n\", __VA_ARGS__);\t\\\n} while (0)\n\n#define sysfs_print(file, var)\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (attr == &sysfs_ ## file)\t\t\t\t\t\\\n\t\treturn sysfs_emit(buf,\t\t\t\t\t\t\\\n\t\t\t\t__builtin_types_compatible_p(typeof(var), int)\t\t\\\n\t\t\t\t\t ? \"%i\\n\" :\t\t\t\t\\\n\t\t\t\t__builtin_types_compatible_p(typeof(var), unsigned int)\t\\\n\t\t\t\t\t ? \"%u\\n\" :\t\t\t\t\\\n\t\t\t\t__builtin_types_compatible_p(typeof(var), long)\t\t\\\n\t\t\t\t\t ? \"%li\\n\" :\t\t\t\\\n\t\t\t\t__builtin_types_compatible_p(typeof(var), unsigned long)\\\n\t\t\t\t\t ? \"%lu\\n\" :\t\t\t\\\n\t\t\t\t__builtin_types_compatible_p(typeof(var), int64_t)\t\\\n\t\t\t\t\t ? \"%lli\\n\" :\t\t\t\\\n\t\t\t\t__builtin_types_compatible_p(typeof(var), uint64_t)\t\\\n\t\t\t\t\t ? \"%llu\\n\" :\t\t\t\\\n\t\t\t\t__builtin_types_compatible_p(typeof(var), const char *)\t\\\n\t\t\t\t\t ? \"%s\\n\" : \"%i\\n\", var);\t\\\n} while (0)\n\n#define sysfs_hprint(file, val)\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (attr == &sysfs_ ## file) {\t\t\t\t\t\\\n\t\tssize_t ret = bch_hprint(buf, val);\t\t\t\\\n\t\tstrcat(buf, \"\\n\");\t\t\t\t\t\\\n\t\treturn ret + 1;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#define var_printf(_var, fmt)\tsysfs_printf(_var, fmt, var(_var))\n#define var_print(_var)\t\tsysfs_print(_var, var(_var))\n#define var_hprint(_var)\tsysfs_hprint(_var, var(_var))\n\n#define sysfs_strtoul(file, var)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (attr == &sysfs_ ## file)\t\t\t\t\t\\\n\t\treturn strtoul_safe(buf, var) ?: (ssize_t) size;\t\\\n} while (0)\n\n#define sysfs_strtoul_bool(file, var)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (attr == &sysfs_ ## file) {\t\t\t\t\t\\\n\t\tunsigned long v = strtoul_or_return(buf);\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tvar = v ? 1 : 0;\t\t\t\t\t\\\n\t\treturn size;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#define sysfs_strtoul_clamp(file, var, min, max)\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (attr == &sysfs_ ## file) {\t\t\t\t\t\\\n\t\tunsigned long v = 0;\t\t\t\t\t\\\n\t\tssize_t ret;\t\t\t\t\t\t\\\n\t\tret = strtoul_safe_clamp(buf, v, min, max);\t\t\\\n\t\tif (!ret) {\t\t\t\t\t\t\\\n\t\t\tvar = v;\t\t\t\t\t\\\n\t\t\treturn size;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#define strtoul_or_return(cp)\t\t\t\t\t\t\\\n({\t\t\t\t\t\t\t\t\t\\\n\tunsigned long _v;\t\t\t\t\t\t\\\n\tint _r = kstrtoul(cp, 10, &_v);\t\t\t\t\t\\\n\tif (_r)\t\t\t\t\t\t\t\t\\\n\t\treturn _r;\t\t\t\t\t\t\\\n\t_v;\t\t\t\t\t\t\t\t\\\n})\n\n#define strtoi_h_or_return(cp, v)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tint _r = strtoi_h(cp, &v);\t\t\t\t\t\\\n\tif (_r)\t\t\t\t\t\t\t\t\\\n\t\treturn _r;\t\t\t\t\t\t\\\n} while (0)\n\n#define sysfs_hatoi(file, var)\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (attr == &sysfs_ ## file)\t\t\t\t\t\\\n\t\treturn strtoi_h(buf, &var) ?: (ssize_t) size;\t\t\\\n} while (0)\n\n#endif   \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}