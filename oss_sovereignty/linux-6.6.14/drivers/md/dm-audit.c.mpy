{
  "module_name": "dm-audit.c",
  "hash_id": "11be5ebb949f9b5a1fb30f4bf7c53a9bb9cae8c8c509fbf5bb0ce29aae3a44cd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/md/dm-audit.c",
  "human_readable_source": "\n \n\n#include <linux/audit.h>\n#include <linux/module.h>\n#include <linux/device-mapper.h>\n#include <linux/bio.h>\n#include <linux/blkdev.h>\n\n#include \"dm-audit.h\"\n#include \"dm-core.h\"\n\nstatic struct audit_buffer *dm_audit_log_start(int audit_type,\n\t\t\t\t\t       const char *dm_msg_prefix,\n\t\t\t\t\t       const char *op)\n{\n\tstruct audit_buffer *ab;\n\n\tif (audit_enabled == AUDIT_OFF)\n\t\treturn NULL;\n\n\tab = audit_log_start(audit_context(), GFP_KERNEL, audit_type);\n\tif (unlikely(!ab))\n\t\treturn NULL;\n\n\taudit_log_format(ab, \"module=%s op=%s\", dm_msg_prefix, op);\n\treturn ab;\n}\n\nvoid dm_audit_log_ti(int audit_type, const char *dm_msg_prefix, const char *op,\n\t\t     struct dm_target *ti, int result)\n{\n\tstruct audit_buffer *ab = NULL;\n\tstruct mapped_device *md = dm_table_get_md(ti->table);\n\tint dev_major = dm_disk(md)->major;\n\tint dev_minor = dm_disk(md)->first_minor;\n\n\tswitch (audit_type) {\n\tcase AUDIT_DM_CTRL:\n\t\tab = dm_audit_log_start(audit_type, dm_msg_prefix, op);\n\t\tif (unlikely(!ab))\n\t\t\treturn;\n\t\taudit_log_task_info(ab);\n\t\taudit_log_format(ab, \" dev=%d:%d error_msg='%s'\", dev_major,\n\t\t\t\t dev_minor, !result ? ti->error : \"success\");\n\t\tbreak;\n\tcase AUDIT_DM_EVENT:\n\t\tab = dm_audit_log_start(audit_type, dm_msg_prefix, op);\n\t\tif (unlikely(!ab))\n\t\t\treturn;\n\t\taudit_log_format(ab, \" dev=%d:%d sector=?\", dev_major,\n\t\t\t\t dev_minor);\n\t\tbreak;\n\tdefault:  \n\t\treturn;\n\t}\n\n\taudit_log_format(ab, \" res=%d\", result);\n\taudit_log_end(ab);\n}\nEXPORT_SYMBOL_GPL(dm_audit_log_ti);\n\nvoid dm_audit_log_bio(const char *dm_msg_prefix, const char *op,\n\t\t      struct bio *bio, sector_t sector, int result)\n{\n\tstruct audit_buffer *ab;\n\tint dev_major = MAJOR(bio->bi_bdev->bd_dev);\n\tint dev_minor = MINOR(bio->bi_bdev->bd_dev);\n\n\tab = dm_audit_log_start(AUDIT_DM_EVENT, dm_msg_prefix, op);\n\tif (unlikely(!ab))\n\t\treturn;\n\n\taudit_log_format(ab, \" dev=%d:%d sector=%llu res=%d\",\n\t\t\t dev_major, dev_minor, sector, result);\n\taudit_log_end(ab);\n}\nEXPORT_SYMBOL_GPL(dm_audit_log_bio);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}