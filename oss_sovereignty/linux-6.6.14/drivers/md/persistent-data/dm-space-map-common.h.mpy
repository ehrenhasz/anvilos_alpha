{
  "module_name": "dm-space-map-common.h",
  "hash_id": "fec9602fcc55ab1f87ab27a8e7cb5f7eece2d09a4bcdb5e99527389b5b893e0f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/md/persistent-data/dm-space-map-common.h",
  "human_readable_source": " \n \n\n#ifndef DM_SPACE_MAP_COMMON_H\n#define DM_SPACE_MAP_COMMON_H\n\n#include \"dm-btree.h\"\n\n \n\n \n\nstruct disk_index_entry {\n\t__le64 blocknr;\n\t__le32 nr_free;\n\t__le32 none_free_before;\n} __packed __aligned(8);\n\n\n#define MAX_METADATA_BITMAPS 255\nstruct disk_metadata_index {\n\t__le32 csum;\n\t__le32 padding;\n\t__le64 blocknr;\n\n\tstruct disk_index_entry index[MAX_METADATA_BITMAPS];\n} __packed __aligned(8);\n\nstruct ll_disk;\n\ntypedef int (*load_ie_fn)(struct ll_disk *ll, dm_block_t index, struct disk_index_entry *result);\ntypedef int (*save_ie_fn)(struct ll_disk *ll, dm_block_t index, struct disk_index_entry *ie);\ntypedef int (*init_index_fn)(struct ll_disk *ll);\ntypedef int (*open_index_fn)(struct ll_disk *ll);\ntypedef dm_block_t (*max_index_entries_fn)(struct ll_disk *ll);\ntypedef int (*commit_fn)(struct ll_disk *ll);\n\n \n#define IE_CACHE_SIZE 64\n#define IE_CACHE_MASK (IE_CACHE_SIZE - 1)\n\nstruct ie_cache {\n\tbool valid;\n\tbool dirty;\n\tdm_block_t index;\n\tstruct disk_index_entry ie;\n};\n\nstruct ll_disk {\n\tstruct dm_transaction_manager *tm;\n\tstruct dm_btree_info bitmap_info;\n\tstruct dm_btree_info ref_count_info;\n\n\tuint32_t block_size;\n\tuint32_t entries_per_block;\n\tdm_block_t nr_blocks;\n\tdm_block_t nr_allocated;\n\n\t \n\tdm_block_t bitmap_root;\n\n\tdm_block_t ref_count_root;\n\n\tstruct disk_metadata_index mi_le;\n\tload_ie_fn load_ie;\n\tsave_ie_fn save_ie;\n\tinit_index_fn init_index;\n\topen_index_fn open_index;\n\tmax_index_entries_fn max_entries;\n\tcommit_fn commit;\n\tbool bitmap_index_changed:1;\n\n\tstruct ie_cache ie_cache[IE_CACHE_SIZE];\n};\n\nstruct disk_sm_root {\n\t__le64 nr_blocks;\n\t__le64 nr_allocated;\n\t__le64 bitmap_root;\n\t__le64 ref_count_root;\n} __packed __aligned(8);\n\n#define ENTRIES_PER_BYTE 4\n\nstruct disk_bitmap_header {\n\t__le32 csum;\n\t__le32 not_used;\n\t__le64 blocknr;\n} __packed __aligned(8);\n\n \n\nint sm_ll_extend(struct ll_disk *ll, dm_block_t extra_blocks);\nint sm_ll_lookup_bitmap(struct ll_disk *ll, dm_block_t b, uint32_t *result);\nint sm_ll_lookup(struct ll_disk *ll, dm_block_t b, uint32_t *result);\nint sm_ll_find_free_block(struct ll_disk *ll, dm_block_t begin,\n\t\t\t  dm_block_t end, dm_block_t *result);\nint sm_ll_find_common_free_block(struct ll_disk *old_ll, struct ll_disk *new_ll,\n\t\t\t\t dm_block_t begin, dm_block_t end, dm_block_t *result);\n\n \nint sm_ll_insert(struct ll_disk *ll, dm_block_t b, uint32_t ref_count, int32_t *nr_allocations);\nint sm_ll_inc(struct ll_disk *ll, dm_block_t b, dm_block_t e, int32_t *nr_allocations);\nint sm_ll_dec(struct ll_disk *ll, dm_block_t b, dm_block_t e, int32_t *nr_allocations);\nint sm_ll_commit(struct ll_disk *ll);\n\nint sm_ll_new_metadata(struct ll_disk *ll, struct dm_transaction_manager *tm);\nint sm_ll_open_metadata(struct ll_disk *ll, struct dm_transaction_manager *tm,\n\t\t\tvoid *root_le, size_t len);\n\nint sm_ll_new_disk(struct ll_disk *ll, struct dm_transaction_manager *tm);\nint sm_ll_open_disk(struct ll_disk *ll, struct dm_transaction_manager *tm,\n\t\t    void *root_le, size_t len);\n\n \n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}