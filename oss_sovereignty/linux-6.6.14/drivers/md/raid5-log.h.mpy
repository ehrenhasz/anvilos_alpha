{
  "module_name": "raid5-log.h",
  "hash_id": "0aeff4f066758cdaa49e5c827b9e63dac08a9ba8c5259cd2430ce5a105809532",
  "original_prompt": "Ingested from linux-6.6.14/drivers/md/raid5-log.h",
  "human_readable_source": " \n#ifndef _RAID5_LOG_H\n#define _RAID5_LOG_H\n\nint r5l_init_log(struct r5conf *conf, struct md_rdev *rdev);\nvoid r5l_exit_log(struct r5conf *conf);\nint r5l_write_stripe(struct r5l_log *log, struct stripe_head *head_sh);\nvoid r5l_write_stripe_run(struct r5l_log *log);\nvoid r5l_flush_stripe_to_raid(struct r5l_log *log);\nvoid r5l_stripe_write_finished(struct stripe_head *sh);\nint r5l_handle_flush_request(struct r5l_log *log, struct bio *bio);\nvoid r5l_quiesce(struct r5l_log *log, int quiesce);\nbool r5l_log_disk_error(struct r5conf *conf);\nbool r5c_is_writeback(struct r5l_log *log);\nint r5c_try_caching_write(struct r5conf *conf, struct stripe_head *sh,\n\t\t\t  struct stripe_head_state *s, int disks);\nvoid r5c_finish_stripe_write_out(struct r5conf *conf, struct stripe_head *sh,\n\t\t\t\t struct stripe_head_state *s);\nvoid r5c_release_extra_page(struct stripe_head *sh);\nvoid r5c_use_extra_page(struct stripe_head *sh);\nvoid r5l_wake_reclaim(struct r5l_log *log, sector_t space);\nvoid r5c_handle_cached_data_endio(struct r5conf *conf,\n\t\t\t\t  struct stripe_head *sh, int disks);\nint r5c_cache_data(struct r5l_log *log, struct stripe_head *sh);\nvoid r5c_make_stripe_write_out(struct stripe_head *sh);\nvoid r5c_flush_cache(struct r5conf *conf, int num);\nvoid r5c_check_stripe_cache_usage(struct r5conf *conf);\nvoid r5c_check_cached_full_stripe(struct r5conf *conf);\nextern struct md_sysfs_entry r5c_journal_mode;\nvoid r5c_update_on_rdev_error(struct mddev *mddev, struct md_rdev *rdev);\nbool r5c_big_stripe_cached(struct r5conf *conf, sector_t sect);\nint r5l_start(struct r5l_log *log);\n\nstruct dma_async_tx_descriptor *\nops_run_partial_parity(struct stripe_head *sh, struct raid5_percpu *percpu,\n\t\t       struct dma_async_tx_descriptor *tx);\nint ppl_init_log(struct r5conf *conf);\nvoid ppl_exit_log(struct r5conf *conf);\nint ppl_write_stripe(struct r5conf *conf, struct stripe_head *sh);\nvoid ppl_write_stripe_run(struct r5conf *conf);\nvoid ppl_stripe_write_finished(struct stripe_head *sh);\nint ppl_modify_log(struct r5conf *conf, struct md_rdev *rdev, bool add);\nvoid ppl_quiesce(struct r5conf *conf, int quiesce);\nint ppl_handle_flush_request(struct bio *bio);\nextern struct md_sysfs_entry ppl_write_hint;\n\nstatic inline bool raid5_has_log(struct r5conf *conf)\n{\n\treturn test_bit(MD_HAS_JOURNAL, &conf->mddev->flags);\n}\n\nstatic inline bool raid5_has_ppl(struct r5conf *conf)\n{\n\treturn test_bit(MD_HAS_PPL, &conf->mddev->flags);\n}\n\nstatic inline int log_stripe(struct stripe_head *sh, struct stripe_head_state *s)\n{\n\tstruct r5conf *conf = sh->raid_conf;\n\n\tif (conf->log) {\n\t\tif (!test_bit(STRIPE_R5C_CACHING, &sh->state)) {\n\t\t\t \n\t\t\tif (s->waiting_extra_page)\n\t\t\t\treturn 0;\n\t\t\treturn r5l_write_stripe(conf->log, sh);\n\t\t} else if (test_bit(STRIPE_LOG_TRAPPED, &sh->state)) {\n\t\t\t \n\t\t\treturn r5c_cache_data(conf->log, sh);\n\t\t}\n\t} else if (raid5_has_ppl(conf)) {\n\t\treturn ppl_write_stripe(conf, sh);\n\t}\n\n\treturn -EAGAIN;\n}\n\nstatic inline void log_stripe_write_finished(struct stripe_head *sh)\n{\n\tstruct r5conf *conf = sh->raid_conf;\n\n\tif (conf->log)\n\t\tr5l_stripe_write_finished(sh);\n\telse if (raid5_has_ppl(conf))\n\t\tppl_stripe_write_finished(sh);\n}\n\nstatic inline void log_write_stripe_run(struct r5conf *conf)\n{\n\tif (conf->log)\n\t\tr5l_write_stripe_run(conf->log);\n\telse if (raid5_has_ppl(conf))\n\t\tppl_write_stripe_run(conf);\n}\n\nstatic inline void log_flush_stripe_to_raid(struct r5conf *conf)\n{\n\tif (conf->log)\n\t\tr5l_flush_stripe_to_raid(conf->log);\n\telse if (raid5_has_ppl(conf))\n\t\tppl_write_stripe_run(conf);\n}\n\nstatic inline int log_handle_flush_request(struct r5conf *conf, struct bio *bio)\n{\n\tint ret = -ENODEV;\n\n\tif (conf->log)\n\t\tret = r5l_handle_flush_request(conf->log, bio);\n\telse if (raid5_has_ppl(conf))\n\t\tret = ppl_handle_flush_request(bio);\n\n\treturn ret;\n}\n\nstatic inline void log_quiesce(struct r5conf *conf, int quiesce)\n{\n\tif (conf->log)\n\t\tr5l_quiesce(conf->log, quiesce);\n\telse if (raid5_has_ppl(conf))\n\t\tppl_quiesce(conf, quiesce);\n}\n\nstatic inline void log_exit(struct r5conf *conf)\n{\n\tif (conf->log)\n\t\tr5l_exit_log(conf);\n\telse if (raid5_has_ppl(conf))\n\t\tppl_exit_log(conf);\n}\n\nstatic inline int log_init(struct r5conf *conf, struct md_rdev *journal_dev,\n\t\t\t   bool ppl)\n{\n\tif (journal_dev)\n\t\treturn r5l_init_log(conf, journal_dev);\n\telse if (ppl)\n\t\treturn ppl_init_log(conf);\n\n\treturn 0;\n}\n\nstatic inline int log_modify(struct r5conf *conf, struct md_rdev *rdev, bool add)\n{\n\tif (raid5_has_ppl(conf))\n\t\treturn ppl_modify_log(conf, rdev, add);\n\n\treturn 0;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}