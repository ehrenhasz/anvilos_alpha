{
  "module_name": "dm-cache-policy-internal.h",
  "hash_id": "c7f87a54979c0abd292c95157bc446c959e49e34b84991ea443a73e2b8bf35e8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/md/dm-cache-policy-internal.h",
  "human_readable_source": " \n \n\n#ifndef DM_CACHE_POLICY_INTERNAL_H\n#define DM_CACHE_POLICY_INTERNAL_H\n\n#include <linux/vmalloc.h>\n#include \"dm-cache-policy.h\"\n\n \n\nstatic inline int policy_lookup(struct dm_cache_policy *p, dm_oblock_t oblock, dm_cblock_t *cblock,\n\t\t\t\tint data_dir, bool fast_copy, bool *background_queued)\n{\n\treturn p->lookup(p, oblock, cblock, data_dir, fast_copy, background_queued);\n}\n\nstatic inline int policy_lookup_with_work(struct dm_cache_policy *p,\n\t\t\t\t\t  dm_oblock_t oblock, dm_cblock_t *cblock,\n\t\t\t\t\t  int data_dir, bool fast_copy,\n\t\t\t\t\t  struct policy_work **work)\n{\n\tif (!p->lookup_with_work) {\n\t\t*work = NULL;\n\t\treturn p->lookup(p, oblock, cblock, data_dir, fast_copy, NULL);\n\t}\n\n\treturn p->lookup_with_work(p, oblock, cblock, data_dir, fast_copy, work);\n}\n\nstatic inline int policy_get_background_work(struct dm_cache_policy *p,\n\t\t\t\t\t     bool idle, struct policy_work **result)\n{\n\treturn p->get_background_work(p, idle, result);\n}\n\nstatic inline void policy_complete_background_work(struct dm_cache_policy *p,\n\t\t\t\t\t\t   struct policy_work *work,\n\t\t\t\t\t\t   bool success)\n{\n\treturn p->complete_background_work(p, work, success);\n}\n\nstatic inline void policy_set_dirty(struct dm_cache_policy *p, dm_cblock_t cblock)\n{\n\tp->set_dirty(p, cblock);\n}\n\nstatic inline void policy_clear_dirty(struct dm_cache_policy *p, dm_cblock_t cblock)\n{\n\tp->clear_dirty(p, cblock);\n}\n\nstatic inline int policy_load_mapping(struct dm_cache_policy *p,\n\t\t\t\t      dm_oblock_t oblock, dm_cblock_t cblock,\n\t\t\t\t      bool dirty, uint32_t hint, bool hint_valid)\n{\n\treturn p->load_mapping(p, oblock, cblock, dirty, hint, hint_valid);\n}\n\nstatic inline int policy_invalidate_mapping(struct dm_cache_policy *p,\n\t\t\t\t\t    dm_cblock_t cblock)\n{\n\treturn p->invalidate_mapping(p, cblock);\n}\n\nstatic inline uint32_t policy_get_hint(struct dm_cache_policy *p,\n\t\t\t\t       dm_cblock_t cblock)\n{\n\treturn p->get_hint ? p->get_hint(p, cblock) : 0;\n}\n\nstatic inline dm_cblock_t policy_residency(struct dm_cache_policy *p)\n{\n\treturn p->residency(p);\n}\n\nstatic inline void policy_tick(struct dm_cache_policy *p, bool can_block)\n{\n\tif (p->tick)\n\t\treturn p->tick(p, can_block);\n}\n\nstatic inline int policy_emit_config_values(struct dm_cache_policy *p, char *result,\n\t\t\t\t\t    unsigned int maxlen, ssize_t *sz_ptr)\n{\n\tssize_t sz = *sz_ptr;\n\n\tif (p->emit_config_values)\n\t\treturn p->emit_config_values(p, result, maxlen, sz_ptr);\n\n\tDMEMIT(\"0 \");\n\t*sz_ptr = sz;\n\treturn 0;\n}\n\nstatic inline int policy_set_config_value(struct dm_cache_policy *p,\n\t\t\t\t\t  const char *key, const char *value)\n{\n\treturn p->set_config_value ? p->set_config_value(p, key, value) : -EINVAL;\n}\n\nstatic inline void policy_allow_migrations(struct dm_cache_policy *p, bool allow)\n{\n\treturn p->allow_migrations(p, allow);\n}\n\n \n\n \nstatic inline size_t bitset_size_in_bytes(unsigned int nr_entries)\n{\n\treturn sizeof(unsigned long) * dm_div_up(nr_entries, BITS_PER_LONG);\n}\n\nstatic inline unsigned long *alloc_bitset(unsigned int nr_entries)\n{\n\tsize_t s = bitset_size_in_bytes(nr_entries);\n\n\treturn vzalloc(s);\n}\n\nstatic inline void clear_bitset(void *bitset, unsigned int nr_entries)\n{\n\tsize_t s = bitset_size_in_bytes(nr_entries);\n\n\tmemset(bitset, 0, s);\n}\n\nstatic inline void free_bitset(unsigned long *bits)\n{\n\tvfree(bits);\n}\n\n \n\n \nstruct dm_cache_policy *dm_cache_policy_create(const char *name, dm_cblock_t cache_size,\n\t\t\t\t\t       sector_t origin_size, sector_t block_size);\n\n \nvoid dm_cache_policy_destroy(struct dm_cache_policy *p);\n\n \nconst char *dm_cache_policy_get_name(struct dm_cache_policy *p);\n\nconst unsigned int *dm_cache_policy_get_version(struct dm_cache_policy *p);\n\nsize_t dm_cache_policy_get_hint_size(struct dm_cache_policy *p);\n\n \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}