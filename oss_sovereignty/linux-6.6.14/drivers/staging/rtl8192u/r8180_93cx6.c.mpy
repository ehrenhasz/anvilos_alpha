{
  "module_name": "r8180_93cx6.c",
  "hash_id": "a2fe7855d6d9d812fa8ac1c6d24a5a7bbd4cb7de7ef703f7f62e83fb80eea162",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8192u/r8180_93cx6.c",
  "human_readable_source": "\n \n\n#include \"r8180_93cx6.h\"\n\nstatic void eprom_cs(struct net_device *dev, short bit)\n{\n\tu8 cmdreg;\n\tint err;\n\n\terr = read_nic_byte_E(dev, EPROM_CMD, &cmdreg);\n\tif (err)\n\t\treturn;\n\tif (bit)\n\t\t \n\t\twrite_nic_byte_E(dev, EPROM_CMD, cmdreg | EPROM_CS_BIT);\n\telse\n\t\t \n\t\twrite_nic_byte_E(dev, EPROM_CMD, cmdreg & ~EPROM_CS_BIT);\n\n\tforce_pci_posting(dev);\n\tudelay(EPROM_DELAY);\n}\n\nstatic void eprom_ck_cycle(struct net_device *dev)\n{\n\tu8 cmdreg;\n\tint err;\n\n\terr = read_nic_byte_E(dev, EPROM_CMD, &cmdreg);\n\tif (err)\n\t\treturn;\n\twrite_nic_byte_E(dev, EPROM_CMD, cmdreg | EPROM_CK_BIT);\n\tforce_pci_posting(dev);\n\tudelay(EPROM_DELAY);\n\n\tread_nic_byte_E(dev, EPROM_CMD, &cmdreg);\n\twrite_nic_byte_E(dev, EPROM_CMD, cmdreg & ~EPROM_CK_BIT);\n\tforce_pci_posting(dev);\n\tudelay(EPROM_DELAY);\n}\n\nstatic void eprom_w(struct net_device *dev, short bit)\n{\n\tu8 cmdreg;\n\tint err;\n\n\terr = read_nic_byte_E(dev, EPROM_CMD, &cmdreg);\n\tif (err)\n\t\treturn;\n\tif (bit)\n\t\twrite_nic_byte_E(dev, EPROM_CMD, cmdreg | EPROM_W_BIT);\n\telse\n\t\twrite_nic_byte_E(dev, EPROM_CMD, cmdreg & ~EPROM_W_BIT);\n\n\tforce_pci_posting(dev);\n\tudelay(EPROM_DELAY);\n}\n\nstatic short eprom_r(struct net_device *dev)\n{\n\tu8 bit;\n\tint err;\n\n\terr = read_nic_byte_E(dev, EPROM_CMD, &bit);\n\tif (err)\n\t\treturn err;\n\n\tudelay(EPROM_DELAY);\n\n\tif (bit & EPROM_R_BIT)\n\t\treturn 1;\n\n\treturn 0;\n}\n\nstatic void eprom_send_bits_string(struct net_device *dev, short b[], int len)\n{\n\tint i;\n\n\tfor (i = 0; i < len; i++) {\n\t\teprom_w(dev, b[i]);\n\t\teprom_ck_cycle(dev);\n\t}\n}\n\nint eprom_read(struct net_device *dev, u32 addr)\n{\n\tstruct r8192_priv *priv = ieee80211_priv(dev);\n\tshort read_cmd[] = {1, 1, 0};\n\tshort addr_str[8];\n\tint i;\n\tint addr_len;\n\tu32 ret;\n\tint err;\n\n\tret = 0;\n\t \n\twrite_nic_byte_E(dev, EPROM_CMD,\n\t\t       (EPROM_CMD_PROGRAM << EPROM_CMD_OPERATING_MODE_SHIFT));\n\tforce_pci_posting(dev);\n\tudelay(EPROM_DELAY);\n\n\tif (priv->epromtype == EPROM_93c56) {\n\t\taddr_str[7] = addr & 1;\n\t\taddr_str[6] = addr & BIT(1);\n\t\taddr_str[5] = addr & BIT(2);\n\t\taddr_str[4] = addr & BIT(3);\n\t\taddr_str[3] = addr & BIT(4);\n\t\taddr_str[2] = addr & BIT(5);\n\t\taddr_str[1] = addr & BIT(6);\n\t\taddr_str[0] = addr & BIT(7);\n\t\taddr_len = 8;\n\t} else {\n\t\taddr_str[5] = addr & 1;\n\t\taddr_str[4] = addr & BIT(1);\n\t\taddr_str[3] = addr & BIT(2);\n\t\taddr_str[2] = addr & BIT(3);\n\t\taddr_str[1] = addr & BIT(4);\n\t\taddr_str[0] = addr & BIT(5);\n\t\taddr_len = 6;\n\t}\n\teprom_cs(dev, 1);\n\teprom_ck_cycle(dev);\n\teprom_send_bits_string(dev, read_cmd, 3);\n\teprom_send_bits_string(dev, addr_str, addr_len);\n\n\t \n\teprom_w(dev, 0);\n\n\tfor (i = 0; i < 16; i++) {\n\t\t \n\t\teprom_ck_cycle(dev);\n\t\terr = eprom_r(dev);\n\t\tif (err < 0)\n\t\t\treturn err;\n\n\t\tret |= err << (15 - i);\n\t}\n\n\teprom_cs(dev, 0);\n\teprom_ck_cycle(dev);\n\n\t \n\twrite_nic_byte_E(dev, EPROM_CMD,\n\t\t       (EPROM_CMD_NORMAL << EPROM_CMD_OPERATING_MODE_SHIFT));\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}