{
  "module_name": "dot11d.c",
  "hash_id": "ecc8a90f37a0e839972f142e765ff786f1888a86537fb08fb4f45328b1dfdbee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8192u/ieee80211/dot11d.c",
  "human_readable_source": "\n \n\n#include \"dot11d.h\"\n\nvoid rtl8192u_dot11d_init(struct ieee80211_device *ieee)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(ieee);\n\n\tdot11d_info->dot11d_enabled = false;\n\n\tdot11d_info->state = DOT11D_STATE_NONE;\n\tdot11d_info->country_ie_len = 0;\n\tmemset(dot11d_info->channel_map, 0, MAX_CHANNEL_NUMBER + 1);\n\tmemset(dot11d_info->max_tx_pwr_dbm_list, 0xFF, MAX_CHANNEL_NUMBER + 1);\n\tRESET_CIE_WATCHDOG(ieee);\n}\nEXPORT_SYMBOL(rtl8192u_dot11d_init);\n\n \nvoid dot11d_reset(struct ieee80211_device *ieee)\n{\n\tu32 i;\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(ieee);\n\t \n\tmemset(dot11d_info->channel_map, 0, MAX_CHANNEL_NUMBER + 1);\n\tmemset(dot11d_info->max_tx_pwr_dbm_list, 0xFF, MAX_CHANNEL_NUMBER + 1);\n\t \n\tfor (i = 1; i <= 11; i++)\n\t\t(dot11d_info->channel_map)[i] = 1;\n\n\tfor (i = 12; i <= 14; i++)\n\t\t(dot11d_info->channel_map)[i] = 2;\n\n\tdot11d_info->state = DOT11D_STATE_NONE;\n\tdot11d_info->country_ie_len = 0;\n\tRESET_CIE_WATCHDOG(ieee);\n}\nEXPORT_SYMBOL(dot11d_reset);\n\n \nvoid dot11d_update_country_ie(struct ieee80211_device *dev, u8 *pTaddr,\n\t\t\t    u16 CoutryIeLen, u8 *pCoutryIe)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(dev);\n\tu8 i, j, NumTriples, MaxChnlNum;\n\tstruct chnl_txpower_triple *pTriple;\n\n\tmemset(dot11d_info->channel_map, 0, MAX_CHANNEL_NUMBER + 1);\n\tmemset(dot11d_info->max_tx_pwr_dbm_list, 0xFF, MAX_CHANNEL_NUMBER + 1);\n\tMaxChnlNum = 0;\n\tNumTriples = (CoutryIeLen - 3) / 3;  \n\tpTriple = (struct chnl_txpower_triple *)(pCoutryIe + 3);\n\tfor (i = 0; i < NumTriples; i++) {\n\t\tif (MaxChnlNum >= pTriple->first_channel) {\n\t\t\t \n\t\t\tnetdev_err(dev->dev, \"%s: Invalid country IE, skip it 1\\n\", __func__);\n\t\t\treturn;\n\t\t}\n\t\tif (MAX_CHANNEL_NUMBER < (pTriple->first_channel + pTriple->num_channels)) {\n\t\t\t \n\t\t\tnetdev_err(dev->dev, \"%s: Invalid country IE, skip it 2\\n\", __func__);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (j = 0; j < pTriple->num_channels; j++) {\n\t\t\tdot11d_info->channel_map[pTriple->first_channel + j] = 1;\n\t\t\tdot11d_info->max_tx_pwr_dbm_list[pTriple->first_channel + j] = pTriple->max_tx_pwr_dbm;\n\t\t\tMaxChnlNum = pTriple->first_channel + j;\n\t\t}\n\n\t\tpTriple = (struct chnl_txpower_triple *)((u8 *)pTriple + 3);\n\t}\n\tnetdev_info(dev->dev, \"Channel List:\");\n\tfor (i = 1; i <= MAX_CHANNEL_NUMBER; i++)\n\t\tif (dot11d_info->channel_map[i] > 0)\n\t\t\tnetdev_info(dev->dev, \" %d\", i);\n\tnetdev_info(dev->dev, \"\\n\");\n\n\tUPDATE_CIE_SRC(dev, pTaddr);\n\n\tdot11d_info->country_ie_len = CoutryIeLen;\n\tmemcpy(dot11d_info->country_ie_buf, pCoutryIe, CoutryIeLen);\n\tdot11d_info->state = DOT11D_STATE_LEARNED;\n}\nEXPORT_SYMBOL(dot11d_update_country_ie);\n\nu8 dot11d_get_max_tx_pwr_in_dbm(struct ieee80211_device *dev, u8 Channel)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(dev);\n\tu8 MaxTxPwrInDbm = 255;\n\n\tif (Channel > MAX_CHANNEL_NUMBER) {\n\t\tnetdev_err(dev->dev, \"%s: Invalid Channel\\n\", __func__);\n\t\treturn MaxTxPwrInDbm;\n\t}\n\tif (dot11d_info->channel_map[Channel])\n\t\tMaxTxPwrInDbm = dot11d_info->max_tx_pwr_dbm_list[Channel];\n\n\treturn MaxTxPwrInDbm;\n}\nEXPORT_SYMBOL(dot11d_get_max_tx_pwr_in_dbm);\n\nvoid dot11d_scan_complete(struct ieee80211_device *dev)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(dev);\n\n\tswitch (dot11d_info->state) {\n\tcase DOT11D_STATE_LEARNED:\n\t\tdot11d_info->state = DOT11D_STATE_DONE;\n\t\tbreak;\n\n\tcase DOT11D_STATE_DONE:\n\t\tif (GET_CIE_WATCHDOG(dev) == 0) {\n\t\t\t \n\t\t\tdot11d_reset(dev);\n\t\t}\n\t\tbreak;\n\tcase DOT11D_STATE_NONE:\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL(dot11d_scan_complete);\n\nint is_legal_channel(struct ieee80211_device *dev, u8 channel)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(dev);\n\n\tif (channel > MAX_CHANNEL_NUMBER) {\n\t\tnetdev_err(dev->dev, \"%s: Invalid Channel\\n\", __func__);\n\t\treturn 0;\n\t}\n\tif (dot11d_info->channel_map[channel] > 0)\n\t\treturn 1;\n\treturn 0;\n}\nEXPORT_SYMBOL(is_legal_channel);\n\nint to_legal_channel(struct ieee80211_device *dev, u8 channel)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(dev);\n\tu8 default_chn = 0;\n\tu32 i = 0;\n\n\tfor (i = 1; i <= MAX_CHANNEL_NUMBER; i++) {\n\t\tif (dot11d_info->channel_map[i] > 0) {\n\t\t\tdefault_chn = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (channel > MAX_CHANNEL_NUMBER) {\n\t\tnetdev_err(dev->dev, \"%s: Invalid Channel\\n\", __func__);\n\t\treturn default_chn;\n\t}\n\n\tif (dot11d_info->channel_map[channel] > 0)\n\t\treturn channel;\n\n\treturn default_chn;\n}\nEXPORT_SYMBOL(to_legal_channel);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}