{
  "module_name": "authenticate.c",
  "hash_id": "1fad136966c4ed287ff46d6920013cbf96869f8d44ec67ba31a7b0b2387f921b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/greybus/Documentation/firmware/authenticate.c",
  "human_readable_source": "\n \n\n#include <stdio.h>\n#include <string.h>\n#include <unistd.h>\n#include <sys/ioctl.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n\n#include \"../../greybus_authentication.h\"\n\nstruct cap_ioc_get_endpoint_uid uid;\nstruct cap_ioc_get_ims_certificate cert = {\n\t.certificate_class = 0,\n\t.certificate_id = 0,\n};\n\nstruct cap_ioc_authenticate authenticate = {\n\t.auth_type = 0,\n\t.challenge = {0},\n};\n\nint main(int argc, char *argv[])\n{\n\tunsigned int timeout = 10000;\n\tchar *capdev;\n\tint fd, ret;\n\n\t \n\tif (argc != 2) {\n\t\tprintf(\"\\nUsage: ./firmware <Path of the gb-cap-X dev>\\n\");\n\t\treturn 0;\n\t}\n\n\tcapdev = argv[1];\n\n\tprintf(\"Opening %s authentication device\\n\", capdev);\n\n\tfd = open(capdev, O_RDWR);\n\tif (fd < 0) {\n\t\tprintf(\"Failed to open: %s\\n\", capdev);\n\t\treturn -1;\n\t}\n\n\t \n\tprintf(\"Get UID\\n\");\n\n\tret = ioctl(fd, CAP_IOC_GET_ENDPOINT_UID, &uid);\n\tif (ret < 0) {\n\t\tprintf(\"Failed to get UID: %s (%d)\\n\", capdev, ret);\n\t\tret = -1;\n\t\tgoto close_fd;\n\t}\n\n\tprintf(\"UID received: 0x%llx\\n\", *(unsigned long long int *)(uid.uid));\n\n\t \n\tprintf(\"Get IMS certificate\\n\");\n\n\tret = ioctl(fd, CAP_IOC_GET_IMS_CERTIFICATE, &cert);\n\tif (ret < 0) {\n\t\tprintf(\"Failed to get IMS certificate: %s (%d)\\n\", capdev, ret);\n\t\tret = -1;\n\t\tgoto close_fd;\n\t}\n\n\tprintf(\"IMS Certificate size: %d\\n\", cert.cert_size);\n\n\t \n\tprintf(\"Authenticate module\\n\");\n\n\tmemcpy(authenticate.uid, uid.uid, 8);\n\n\tret = ioctl(fd, CAP_IOC_AUTHENTICATE, &authenticate);\n\tif (ret < 0) {\n\t\tprintf(\"Failed to authenticate module: %s (%d)\\n\", capdev, ret);\n\t\tret = -1;\n\t\tgoto close_fd;\n\t}\n\n\tprintf(\"Authenticated, result (%02x), sig-size (%02x)\\n\",\n\t\tauthenticate.result_code, authenticate.signature_size);\n\nclose_fd:\n\tclose(fd);\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}