{
  "module_name": "audio_helper.c",
  "hash_id": "073590c1b2f700121d4bd9bb95376da142d5ec3903492adca28b9d73d05e673f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/greybus/audio_helper.c",
  "human_readable_source": "\n \n\n#include <sound/core.h>\n#include <sound/soc.h>\n#include <sound/soc-dapm.h>\n#include \"audio_helper.h\"\n\n#define gbaudio_dapm_for_each_direction(dir) \\\n\tfor ((dir) = SND_SOC_DAPM_DIR_IN; (dir) <= SND_SOC_DAPM_DIR_OUT; \\\n\t\t(dir)++)\n\nstatic void gbaudio_dapm_link_dai_widget(struct snd_soc_dapm_widget *dai_w,\n\t\t\t\t\t struct snd_soc_card *card)\n{\n\tstruct snd_soc_dapm_widget *w;\n\tstruct snd_soc_dapm_widget *src, *sink;\n\tstruct snd_soc_dai *dai = dai_w->priv;\n\n\t \n\tlist_for_each_entry(w, &card->widgets, list) {\n\t\tif (w->dapm != dai_w->dapm)\n\t\t\tcontinue;\n\n\t\tswitch (w->id) {\n\t\tcase snd_soc_dapm_dai_in:\n\t\tcase snd_soc_dapm_dai_out:\n\t\t\tcontinue;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\n\t\tif (!w->sname || !strstr(w->sname, dai_w->sname))\n\t\t\tcontinue;\n\n\t\t \n\n\t\tif (dai_w->id == snd_soc_dapm_dai_in) {\n\t\t\tsrc = dai_w;\n\t\t\tsink = w;\n\t\t} else {\n\t\t\tsrc = w;\n\t\t\tsink = dai_w;\n\t\t}\n\t\tdev_dbg(dai->dev, \"%s -> %s\\n\", src->name, sink->name);\n\t\t \n\t}\n}\n\nint gbaudio_dapm_link_component_dai_widgets(struct snd_soc_card *card,\n\t\t\t\t\t    struct snd_soc_dapm_context *dapm)\n{\n\tstruct snd_soc_dapm_widget *dai_w;\n\n\t \n\tlist_for_each_entry(dai_w, &card->widgets, list) {\n\t\tif (dai_w->dapm != dapm)\n\t\t\tcontinue;\n\t\tswitch (dai_w->id) {\n\t\tcase snd_soc_dapm_dai_in:\n\t\tcase snd_soc_dapm_dai_out:\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tcontinue;\n\t\t}\n\t\tgbaudio_dapm_link_dai_widget(dai_w, card);\n\t}\n\n\treturn 0;\n}\n\nstatic void gbaudio_dapm_free_path(struct snd_soc_dapm_path *path)\n{\n\tlist_del(&path->list_node[SND_SOC_DAPM_DIR_IN]);\n\tlist_del(&path->list_node[SND_SOC_DAPM_DIR_OUT]);\n\tlist_del(&path->list_kcontrol);\n\tlist_del(&path->list);\n\tkfree(path);\n}\n\nstatic void gbaudio_dapm_free_widget(struct snd_soc_dapm_widget *w)\n{\n\tstruct snd_soc_dapm_path *p, *next_p;\n\tenum snd_soc_dapm_direction dir;\n\n\tlist_del(&w->list);\n\t \n\tgbaudio_dapm_for_each_direction(dir) {\n\t\tsnd_soc_dapm_widget_for_each_path_safe(w, dir, p, next_p)\n\t\t\tgbaudio_dapm_free_path(p);\n\t}\n\n\tkfree(w->kcontrols);\n\tkfree_const(w->name);\n\tkfree_const(w->sname);\n\tkfree(w);\n}\n\nint gbaudio_dapm_free_controls(struct snd_soc_dapm_context *dapm,\n\t\t\t       const struct snd_soc_dapm_widget *widget,\n\t\t\t       int num)\n{\n\tint i;\n\tstruct snd_soc_dapm_widget *w, *tmp_w;\n\n\tmutex_lock(&dapm->card->dapm_mutex);\n\tfor (i = 0; i < num; i++) {\n\t\t \n\t\tw = NULL;\n\t\tlist_for_each_entry(tmp_w, &dapm->card->widgets, list) {\n\t\t\tif (tmp_w->dapm == dapm &&\n\t\t\t    !strcmp(tmp_w->name, widget->name)) {\n\t\t\t\tw = tmp_w;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!w) {\n\t\t\tdev_err(dapm->dev, \"%s: widget not found\\n\",\n\t\t\t\twidget->name);\n\t\t\twidget++;\n\t\t\tcontinue;\n\t\t}\n\t\twidget++;\n\t\tgbaudio_dapm_free_widget(w);\n\t}\n\tmutex_unlock(&dapm->card->dapm_mutex);\n\treturn 0;\n}\n\nstatic int gbaudio_remove_controls(struct snd_card *card, struct device *dev,\n\t\t\t\t   const struct snd_kcontrol_new *controls,\n\t\t\t\t   int num_controls, const char *prefix)\n{\n\tint i, err;\n\n\tfor (i = 0; i < num_controls; i++) {\n\t\tconst struct snd_kcontrol_new *control = &controls[i];\n\t\tstruct snd_ctl_elem_id id;\n\n\t\tif (prefix)\n\t\t\tsnprintf(id.name, sizeof(id.name), \"%s %s\", prefix,\n\t\t\t\t control->name);\n\t\telse\n\t\t\tstrscpy(id.name, control->name, sizeof(id.name));\n\t\tid.numid = 0;\n\t\tid.iface = control->iface;\n\t\tid.device = control->device;\n\t\tid.subdevice = control->subdevice;\n\t\tid.index = control->index;\n\t\terr = snd_ctl_remove_id(card, &id);\n\t\tif (err < 0)\n\t\t\tdev_err(dev, \"%d: Failed to remove %s\\n\", err,\n\t\t\t\tcontrol->name);\n\t}\n\treturn 0;\n}\n\nint gbaudio_remove_component_controls(struct snd_soc_component *component,\n\t\t\t\t      const struct snd_kcontrol_new *controls,\n\t\t\t\t      unsigned int num_controls)\n{\n\tstruct snd_card *card = component->card->snd_card;\n\n\treturn gbaudio_remove_controls(card, component->dev, controls,\n\t\t\t\t       num_controls, component->name_prefix);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}