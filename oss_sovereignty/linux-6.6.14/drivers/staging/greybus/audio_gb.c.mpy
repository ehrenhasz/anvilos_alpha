{
  "module_name": "audio_gb.c",
  "hash_id": "29fcdf8af1cfb291678a05bd370dd605453d094a102259678b966ea30e9f0234",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/greybus/audio_gb.c",
  "human_readable_source": "\n \n\n#include <linux/greybus.h>\n#include \"audio_codec.h\"\n\n \nint gb_audio_gb_get_topology(struct gb_connection *connection,\n\t\t\t     struct gb_audio_topology **topology)\n{\n\tstruct gb_audio_get_topology_size_response size_resp;\n\tstruct gb_audio_topology *topo;\n\tu16 size;\n\tint ret;\n\n\tret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_TOPOLOGY_SIZE,\n\t\t\t\tNULL, 0, &size_resp, sizeof(size_resp));\n\tif (ret)\n\t\treturn ret;\n\n\tsize = le16_to_cpu(size_resp.size);\n\tif (size < sizeof(*topo))\n\t\treturn -ENODATA;\n\n\ttopo = kzalloc(size, GFP_KERNEL);\n\tif (!topo)\n\t\treturn -ENOMEM;\n\n\tret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_TOPOLOGY, NULL, 0,\n\t\t\t\ttopo, size);\n\tif (ret) {\n\t\tkfree(topo);\n\t\treturn ret;\n\t}\n\n\t*topology = topo;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_get_topology);\n\nint gb_audio_gb_get_control(struct gb_connection *connection,\n\t\t\t    u8 control_id, u8 index,\n\t\t\t    struct gb_audio_ctl_elem_value *value)\n{\n\tstruct gb_audio_get_control_request req;\n\tstruct gb_audio_get_control_response resp;\n\tint ret;\n\n\treq.control_id = control_id;\n\treq.index = index;\n\n\tret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_CONTROL,\n\t\t\t\t&req, sizeof(req), &resp, sizeof(resp));\n\tif (ret)\n\t\treturn ret;\n\n\tmemcpy(value, &resp.value, sizeof(*value));\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_get_control);\n\nint gb_audio_gb_set_control(struct gb_connection *connection,\n\t\t\t    u8 control_id, u8 index,\n\t\t\t    struct gb_audio_ctl_elem_value *value)\n{\n\tstruct gb_audio_set_control_request req;\n\n\treq.control_id = control_id;\n\treq.index = index;\n\tmemcpy(&req.value, value, sizeof(req.value));\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_CONTROL,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_set_control);\n\nint gb_audio_gb_enable_widget(struct gb_connection *connection,\n\t\t\t      u8 widget_id)\n{\n\tstruct gb_audio_enable_widget_request req;\n\n\treq.widget_id = widget_id;\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_ENABLE_WIDGET,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_enable_widget);\n\nint gb_audio_gb_disable_widget(struct gb_connection *connection,\n\t\t\t       u8 widget_id)\n{\n\tstruct gb_audio_disable_widget_request req;\n\n\treq.widget_id = widget_id;\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_DISABLE_WIDGET,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_disable_widget);\n\nint gb_audio_gb_get_pcm(struct gb_connection *connection, u16 data_cport,\n\t\t\tu32 *format, u32 *rate, u8 *channels,\n\t\t\tu8 *sig_bits)\n{\n\tstruct gb_audio_get_pcm_request req;\n\tstruct gb_audio_get_pcm_response resp;\n\tint ret;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\n\tret = gb_operation_sync(connection, GB_AUDIO_TYPE_GET_PCM,\n\t\t\t\t&req, sizeof(req), &resp, sizeof(resp));\n\tif (ret)\n\t\treturn ret;\n\n\t*format = le32_to_cpu(resp.format);\n\t*rate = le32_to_cpu(resp.rate);\n\t*channels = resp.channels;\n\t*sig_bits = resp.sig_bits;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_get_pcm);\n\nint gb_audio_gb_set_pcm(struct gb_connection *connection, u16 data_cport,\n\t\t\tu32 format, u32 rate, u8 channels,\n\t\t\tu8 sig_bits)\n{\n\tstruct gb_audio_set_pcm_request req;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\treq.format = cpu_to_le32(format);\n\treq.rate = cpu_to_le32(rate);\n\treq.channels = channels;\n\treq.sig_bits = sig_bits;\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_PCM,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_set_pcm);\n\nint gb_audio_gb_set_tx_data_size(struct gb_connection *connection,\n\t\t\t\t u16 data_cport, u16 size)\n{\n\tstruct gb_audio_set_tx_data_size_request req;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\treq.size = cpu_to_le16(size);\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_TX_DATA_SIZE,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_set_tx_data_size);\n\nint gb_audio_gb_activate_tx(struct gb_connection *connection,\n\t\t\t    u16 data_cport)\n{\n\tstruct gb_audio_activate_tx_request req;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_ACTIVATE_TX,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_activate_tx);\n\nint gb_audio_gb_deactivate_tx(struct gb_connection *connection,\n\t\t\t      u16 data_cport)\n{\n\tstruct gb_audio_deactivate_tx_request req;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_DEACTIVATE_TX,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_deactivate_tx);\n\nint gb_audio_gb_set_rx_data_size(struct gb_connection *connection,\n\t\t\t\t u16 data_cport, u16 size)\n{\n\tstruct gb_audio_set_rx_data_size_request req;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\treq.size = cpu_to_le16(size);\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_SET_RX_DATA_SIZE,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_set_rx_data_size);\n\nint gb_audio_gb_activate_rx(struct gb_connection *connection,\n\t\t\t    u16 data_cport)\n{\n\tstruct gb_audio_activate_rx_request req;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_ACTIVATE_RX,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_activate_rx);\n\nint gb_audio_gb_deactivate_rx(struct gb_connection *connection,\n\t\t\t      u16 data_cport)\n{\n\tstruct gb_audio_deactivate_rx_request req;\n\n\treq.data_cport = cpu_to_le16(data_cport);\n\n\treturn gb_operation_sync(connection, GB_AUDIO_TYPE_DEACTIVATE_RX,\n\t\t\t\t &req, sizeof(req), NULL, 0);\n}\nEXPORT_SYMBOL_GPL(gb_audio_gb_deactivate_rx);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"greybus:audio-gb\");\nMODULE_DESCRIPTION(\"Greybus Audio Device Class Protocol library\");\nMODULE_AUTHOR(\"Mark Greer <mgreer@animalcreek.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}