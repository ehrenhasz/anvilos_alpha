{
  "module_name": "audio_apbridgea.c",
  "hash_id": "b1ec44e2187409c54a76065756c0613183a38068c5ed2c4dcec1d54d2fe1ec5a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/greybus/audio_apbridgea.c",
  "human_readable_source": "\n \n\n#include <linux/greybus.h>\n#include \"audio_apbridgea.h\"\n#include \"audio_codec.h\"\n\nint gb_audio_apbridgea_set_config(struct gb_connection *connection,\n\t\t\t\t  __u16 i2s_port, __u32 format, __u32 rate,\n\t\t\t\t  __u32 mclk_freq)\n{\n\tstruct audio_apbridgea_set_config_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_SET_CONFIG;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\treq.format = cpu_to_le32(format);\n\treq.rate = cpu_to_le32(rate);\n\treq.mclk_freq = cpu_to_le32(mclk_freq);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_set_config);\n\nint gb_audio_apbridgea_register_cport(struct gb_connection *connection,\n\t\t\t\t      __u16 i2s_port, __u16 cportid,\n\t\t\t\t      __u8 direction)\n{\n\tstruct audio_apbridgea_register_cport_request req;\n\tint ret;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_REGISTER_CPORT;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\treq.cport = cpu_to_le16(cportid);\n\treq.direction = direction;\n\n\tret = gb_pm_runtime_get_sync(connection->bundle);\n\tif (ret)\n\t\treturn ret;\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_register_cport);\n\nint gb_audio_apbridgea_unregister_cport(struct gb_connection *connection,\n\t\t\t\t\t__u16 i2s_port, __u16 cportid,\n\t\t\t\t\t__u8 direction)\n{\n\tstruct audio_apbridgea_unregister_cport_request req;\n\tint ret;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_UNREGISTER_CPORT;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\treq.cport = cpu_to_le16(cportid);\n\treq.direction = direction;\n\n\tret = gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t   GB_APB_REQUEST_AUDIO_CONTROL, true);\n\n\tgb_pm_runtime_put_autosuspend(connection->bundle);\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_unregister_cport);\n\nint gb_audio_apbridgea_set_tx_data_size(struct gb_connection *connection,\n\t\t\t\t\t__u16 i2s_port, __u16 size)\n{\n\tstruct audio_apbridgea_set_tx_data_size_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_SET_TX_DATA_SIZE;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\treq.size = cpu_to_le16(size);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_set_tx_data_size);\n\nint gb_audio_apbridgea_prepare_tx(struct gb_connection *connection,\n\t\t\t\t  __u16 i2s_port)\n{\n\tstruct audio_apbridgea_prepare_tx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_PREPARE_TX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_prepare_tx);\n\nint gb_audio_apbridgea_start_tx(struct gb_connection *connection,\n\t\t\t\t__u16 i2s_port, __u64 timestamp)\n{\n\tstruct audio_apbridgea_start_tx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_START_TX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\treq.timestamp = cpu_to_le64(timestamp);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_start_tx);\n\nint gb_audio_apbridgea_stop_tx(struct gb_connection *connection, __u16 i2s_port)\n{\n\tstruct audio_apbridgea_stop_tx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_STOP_TX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_stop_tx);\n\nint gb_audio_apbridgea_shutdown_tx(struct gb_connection *connection,\n\t\t\t\t   __u16 i2s_port)\n{\n\tstruct audio_apbridgea_shutdown_tx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_SHUTDOWN_TX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_shutdown_tx);\n\nint gb_audio_apbridgea_set_rx_data_size(struct gb_connection *connection,\n\t\t\t\t\t__u16 i2s_port, __u16 size)\n{\n\tstruct audio_apbridgea_set_rx_data_size_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_SET_RX_DATA_SIZE;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\treq.size = cpu_to_le16(size);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_set_rx_data_size);\n\nint gb_audio_apbridgea_prepare_rx(struct gb_connection *connection,\n\t\t\t\t  __u16 i2s_port)\n{\n\tstruct audio_apbridgea_prepare_rx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_PREPARE_RX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_prepare_rx);\n\nint gb_audio_apbridgea_start_rx(struct gb_connection *connection,\n\t\t\t\t__u16 i2s_port)\n{\n\tstruct audio_apbridgea_start_rx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_START_RX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_start_rx);\n\nint gb_audio_apbridgea_stop_rx(struct gb_connection *connection, __u16 i2s_port)\n{\n\tstruct audio_apbridgea_stop_rx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_STOP_RX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_stop_rx);\n\nint gb_audio_apbridgea_shutdown_rx(struct gb_connection *connection,\n\t\t\t\t   __u16 i2s_port)\n{\n\tstruct audio_apbridgea_shutdown_rx_request req;\n\n\treq.hdr.type = AUDIO_APBRIDGEA_TYPE_SHUTDOWN_RX;\n\treq.hdr.i2s_port = cpu_to_le16(i2s_port);\n\n\treturn gb_hd_output(connection->hd, &req, sizeof(req),\n\t\t\t    GB_APB_REQUEST_AUDIO_CONTROL, true);\n}\nEXPORT_SYMBOL_GPL(gb_audio_apbridgea_shutdown_rx);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"greybus:audio-apbridgea\");\nMODULE_DESCRIPTION(\"Greybus Special APBridgeA Audio Protocol library\");\nMODULE_AUTHOR(\"Mark Greer <mgreer@animalcreek.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}