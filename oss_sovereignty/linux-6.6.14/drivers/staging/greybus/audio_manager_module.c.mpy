{
  "module_name": "audio_manager_module.c",
  "hash_id": "6e818b82de9e444afd1a7da310aebcd144eaad4f8e22131a1f8d9d5ccafe4882",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/greybus/audio_manager_module.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n\n#include \"audio_manager.h\"\n#include \"audio_manager_private.h\"\n\n#define to_gb_audio_module_attr(x)\t\\\n\t\tcontainer_of(x, struct gb_audio_manager_module_attribute, attr)\n\nstatic inline struct gb_audio_manager_module *to_gb_audio_module(struct kobject *kobj)\n{\n\treturn container_of(kobj, struct gb_audio_manager_module, kobj);\n}\n\nstruct gb_audio_manager_module_attribute {\n\tstruct attribute attr;\n\tssize_t (*show)(struct gb_audio_manager_module *module,\n\t\t\tstruct gb_audio_manager_module_attribute *attr,\n\t\t\tchar *buf);\n\tssize_t (*store)(struct gb_audio_manager_module *module,\n\t\t\t struct gb_audio_manager_module_attribute *attr,\n\t\t\t const char *buf, size_t count);\n};\n\nstatic ssize_t gb_audio_module_attr_show(struct kobject *kobj,\n\t\t\t\t\t struct attribute *attr, char *buf)\n{\n\tstruct gb_audio_manager_module_attribute *attribute;\n\tstruct gb_audio_manager_module *module;\n\n\tattribute = to_gb_audio_module_attr(attr);\n\tmodule = to_gb_audio_module(kobj);\n\n\tif (!attribute->show)\n\t\treturn -EIO;\n\n\treturn attribute->show(module, attribute, buf);\n}\n\nstatic ssize_t gb_audio_module_attr_store(struct kobject *kobj,\n\t\t\t\t\t  struct attribute *attr,\n\t\t\t\t\t  const char *buf, size_t len)\n{\n\tstruct gb_audio_manager_module_attribute *attribute;\n\tstruct gb_audio_manager_module *module;\n\n\tattribute = to_gb_audio_module_attr(attr);\n\tmodule = to_gb_audio_module(kobj);\n\n\tif (!attribute->store)\n\t\treturn -EIO;\n\n\treturn attribute->store(module, attribute, buf, len);\n}\n\nstatic const struct sysfs_ops gb_audio_module_sysfs_ops = {\n\t.show = gb_audio_module_attr_show,\n\t.store = gb_audio_module_attr_store,\n};\n\nstatic void gb_audio_module_release(struct kobject *kobj)\n{\n\tstruct gb_audio_manager_module *module = to_gb_audio_module(kobj);\n\n\tpr_info(\"Destroying audio module #%d\\n\", module->id);\n\t \n\tkfree(module);\n}\n\nstatic ssize_t gb_audio_module_name_show(struct gb_audio_manager_module *module,\n\t\t\t\t\t struct gb_audio_manager_module_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%s\", module->desc.name);\n}\n\nstatic struct gb_audio_manager_module_attribute gb_audio_module_name_attribute =\n\t__ATTR(name, 0664, gb_audio_module_name_show, NULL);\n\nstatic ssize_t gb_audio_module_vid_show(struct gb_audio_manager_module *module,\n\t\t\t\t\tstruct gb_audio_manager_module_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%d\", module->desc.vid);\n}\n\nstatic struct gb_audio_manager_module_attribute gb_audio_module_vid_attribute =\n\t__ATTR(vid, 0664, gb_audio_module_vid_show, NULL);\n\nstatic ssize_t gb_audio_module_pid_show(struct gb_audio_manager_module *module,\n\t\t\t\t\tstruct gb_audio_manager_module_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%d\", module->desc.pid);\n}\n\nstatic struct gb_audio_manager_module_attribute gb_audio_module_pid_attribute =\n\t__ATTR(pid, 0664, gb_audio_module_pid_show, NULL);\n\nstatic ssize_t gb_audio_module_intf_id_show(struct gb_audio_manager_module *module,\n\t\t\t\t\t    struct gb_audio_manager_module_attribute *attr,\n\t\t\t\t\t    char *buf)\n{\n\treturn sprintf(buf, \"%d\", module->desc.intf_id);\n}\n\nstatic struct gb_audio_manager_module_attribute\n\t\t\t\t\tgb_audio_module_intf_id_attribute =\n\t__ATTR(intf_id, 0664, gb_audio_module_intf_id_show, NULL);\n\nstatic ssize_t gb_audio_module_ip_devices_show(struct gb_audio_manager_module *module,\n\t\t\t\t\t       struct gb_audio_manager_module_attribute *attr,\n\t\t\t\t\t       char *buf)\n{\n\treturn sprintf(buf, \"0x%X\", module->desc.ip_devices);\n}\n\nstatic struct gb_audio_manager_module_attribute\n\t\t\t\t\tgb_audio_module_ip_devices_attribute =\n\t__ATTR(ip_devices, 0664, gb_audio_module_ip_devices_show, NULL);\n\nstatic ssize_t gb_audio_module_op_devices_show(struct gb_audio_manager_module *module,\n\t\t\t\t\t       struct gb_audio_manager_module_attribute *attr,\n\t\t\t\t\t       char *buf)\n{\n\treturn sprintf(buf, \"0x%X\", module->desc.op_devices);\n}\n\nstatic struct gb_audio_manager_module_attribute\n\t\t\t\t\tgb_audio_module_op_devices_attribute =\n\t__ATTR(op_devices, 0664, gb_audio_module_op_devices_show, NULL);\n\nstatic struct attribute *gb_audio_module_default_attrs[] = {\n\t&gb_audio_module_name_attribute.attr,\n\t&gb_audio_module_vid_attribute.attr,\n\t&gb_audio_module_pid_attribute.attr,\n\t&gb_audio_module_intf_id_attribute.attr,\n\t&gb_audio_module_ip_devices_attribute.attr,\n\t&gb_audio_module_op_devices_attribute.attr,\n\tNULL,    \n};\nATTRIBUTE_GROUPS(gb_audio_module_default);\n\nstatic struct kobj_type gb_audio_module_type = {\n\t.sysfs_ops = &gb_audio_module_sysfs_ops,\n\t.release = gb_audio_module_release,\n\t.default_groups = gb_audio_module_default_groups,\n};\n\nstatic void send_add_uevent(struct gb_audio_manager_module *module)\n{\n\tchar name_string[128];\n\tchar vid_string[64];\n\tchar pid_string[64];\n\tchar intf_id_string[64];\n\tchar ip_devices_string[64];\n\tchar op_devices_string[64];\n\n\tchar *envp[] = {\n\t\tname_string,\n\t\tvid_string,\n\t\tpid_string,\n\t\tintf_id_string,\n\t\tip_devices_string,\n\t\top_devices_string,\n\t\tNULL\n\t};\n\n\tsnprintf(name_string, 128, \"NAME=%s\", module->desc.name);\n\tsnprintf(vid_string, 64, \"VID=%d\", module->desc.vid);\n\tsnprintf(pid_string, 64, \"PID=%d\", module->desc.pid);\n\tsnprintf(intf_id_string, 64, \"INTF_ID=%d\", module->desc.intf_id);\n\tsnprintf(ip_devices_string, 64, \"I/P DEVICES=0x%X\",\n\t\t module->desc.ip_devices);\n\tsnprintf(op_devices_string, 64, \"O/P DEVICES=0x%X\",\n\t\t module->desc.op_devices);\n\n\tkobject_uevent_env(&module->kobj, KOBJ_ADD, envp);\n}\n\nint gb_audio_manager_module_create(struct gb_audio_manager_module **module,\n\t\t\t\t   struct kset *manager_kset,\n\t\t\t\t   int id, struct gb_audio_manager_module_descriptor *desc)\n{\n\tint err;\n\tstruct gb_audio_manager_module *m;\n\n\tm = kzalloc(sizeof(*m), GFP_ATOMIC);\n\tif (!m)\n\t\treturn -ENOMEM;\n\n\t \n\tINIT_LIST_HEAD(&m->list);\n\n\t \n\tm->id = id;\n\n\t \n\tmemcpy(&m->desc, desc, sizeof(*desc));\n\n\t \n\tm->kobj.kset = manager_kset;\n\n\t \n\terr = kobject_init_and_add(&m->kobj, &gb_audio_module_type, NULL, \"%d\",\n\t\t\t\t   id);\n\tif (err) {\n\t\tpr_err(\"failed initializing kobject for audio module #%d\\n\", id);\n\t\tkobject_put(&m->kobj);\n\t\treturn err;\n\t}\n\n\t \n\tsend_add_uevent(m);\n\n\t*module = m;\n\tpr_info(\"Created audio module #%d\\n\", id);\n\treturn 0;\n}\n\nvoid gb_audio_manager_module_dump(struct gb_audio_manager_module *module)\n{\n\tpr_info(\"audio module #%d name=%s vid=%d pid=%d intf_id=%d i/p devices=0x%X o/p devices=0x%X\\n\",\n\t\tmodule->id,\n\t\tmodule->desc.name,\n\t\tmodule->desc.vid,\n\t\tmodule->desc.pid,\n\t\tmodule->desc.intf_id,\n\t\tmodule->desc.ip_devices,\n\t\tmodule->desc.op_devices);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}