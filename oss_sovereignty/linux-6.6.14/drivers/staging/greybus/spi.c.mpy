{
  "module_name": "spi.c",
  "hash_id": "2f3a5839f737a28f3cdf2d5acf01b17ac2182815e9b2a40cc87179e8a353b2bd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/greybus/spi.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/greybus.h>\n\n#include \"gbphy.h\"\n#include \"spilib.h\"\n\nstatic struct spilib_ops *spilib_ops;\n\nstatic int gb_spi_probe(struct gbphy_device *gbphy_dev,\n\t\t\tconst struct gbphy_device_id *id)\n{\n\tstruct gb_connection *connection;\n\tint ret;\n\n\tconnection = gb_connection_create(gbphy_dev->bundle,\n\t\t\t\t\t  le16_to_cpu(gbphy_dev->cport_desc->id),\n\t\t\t\t\t  NULL);\n\tif (IS_ERR(connection))\n\t\treturn PTR_ERR(connection);\n\n\tret = gb_connection_enable(connection);\n\tif (ret)\n\t\tgoto exit_connection_destroy;\n\n\tret = gb_spilib_master_init(connection, &gbphy_dev->dev, spilib_ops);\n\tif (ret)\n\t\tgoto exit_connection_disable;\n\n\tgb_gbphy_set_data(gbphy_dev, connection);\n\n\tgbphy_runtime_put_autosuspend(gbphy_dev);\n\treturn 0;\n\nexit_connection_disable:\n\tgb_connection_disable(connection);\nexit_connection_destroy:\n\tgb_connection_destroy(connection);\n\n\treturn ret;\n}\n\nstatic void gb_spi_remove(struct gbphy_device *gbphy_dev)\n{\n\tstruct gb_connection *connection = gb_gbphy_get_data(gbphy_dev);\n\tint ret;\n\n\tret = gbphy_runtime_get_sync(gbphy_dev);\n\tif (ret)\n\t\tgbphy_runtime_get_noresume(gbphy_dev);\n\n\tgb_spilib_master_exit(connection);\n\tgb_connection_disable(connection);\n\tgb_connection_destroy(connection);\n}\n\nstatic const struct gbphy_device_id gb_spi_id_table[] = {\n\t{ GBPHY_PROTOCOL(GREYBUS_PROTOCOL_SPI) },\n\t{ },\n};\nMODULE_DEVICE_TABLE(gbphy, gb_spi_id_table);\n\nstatic struct gbphy_driver spi_driver = {\n\t.name\t\t= \"spi\",\n\t.probe\t\t= gb_spi_probe,\n\t.remove\t\t= gb_spi_remove,\n\t.id_table\t= gb_spi_id_table,\n};\n\nmodule_gbphy_driver(spi_driver);\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}