{
  "module_name": "audio_manager_sysfs.c",
  "hash_id": "34444b9e71cbe0f709d2af6c0dfa63add43e58072f5e72e0fecf1ec88a8810c4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/greybus/audio_manager_sysfs.c",
  "human_readable_source": "\n \n\n#include <linux/string.h>\n#include <linux/sysfs.h>\n\n#include \"audio_manager.h\"\n#include \"audio_manager_private.h\"\n\nstatic ssize_t manager_sysfs_add_store(struct kobject *kobj,\n\t\t\t\t       struct kobj_attribute *attr,\n\t\t\t\t       const char *buf, size_t count)\n{\n\tstruct gb_audio_manager_module_descriptor desc = { {0} };\n\n\tint num = sscanf(buf,\n\t\t\t\"name=%\" GB_AUDIO_MANAGER_MODULE_NAME_LEN_SSCANF\n\t\t\t\"s vid=%d pid=%d intf_id=%d i/p devices=0x%X o/p devices=0x%X\",\n\t\t\tdesc.name, &desc.vid, &desc.pid, &desc.intf_id,\n\t\t\t&desc.ip_devices, &desc.op_devices);\n\n\tif (num != 7)\n\t\treturn -EINVAL;\n\n\tnum = gb_audio_manager_add(&desc);\n\tif (num < 0)\n\t\treturn -EINVAL;\n\n\treturn count;\n}\n\nstatic struct kobj_attribute manager_add_attribute =\n\t__ATTR(add, 0664, NULL, manager_sysfs_add_store);\n\nstatic ssize_t manager_sysfs_remove_store(struct kobject *kobj,\n\t\t\t\t\t  struct kobj_attribute *attr,\n\t\t\t\t\t  const char *buf, size_t count)\n{\n\tint id;\n\n\tint num = kstrtoint(buf, 10, &id);\n\n\tif (num != 1)\n\t\treturn -EINVAL;\n\n\tnum = gb_audio_manager_remove(id);\n\tif (num)\n\t\treturn num;\n\n\treturn count;\n}\n\nstatic struct kobj_attribute manager_remove_attribute =\n\t__ATTR(remove, 0664, NULL, manager_sysfs_remove_store);\n\nstatic ssize_t manager_sysfs_dump_store(struct kobject *kobj,\n\t\t\t\t\tstruct kobj_attribute *attr,\n\t\t\t\t\tconst char *buf, size_t count)\n{\n\tint id;\n\n\tint num = kstrtoint(buf, 10, &id);\n\n\tif (num == 1) {\n\t\tnum = gb_audio_manager_dump_module(id);\n\t\tif (num)\n\t\t\treturn num;\n\t} else if (!strncmp(\"all\", buf, 3)) {\n\t\tgb_audio_manager_dump_all();\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\treturn count;\n}\n\nstatic struct kobj_attribute manager_dump_attribute =\n\t__ATTR(dump, 0664, NULL, manager_sysfs_dump_store);\n\nstatic void manager_sysfs_init_attribute(struct kobject *kobj,\n\t\t\t\t\t struct kobj_attribute *kattr)\n{\n\tint err;\n\n\terr = sysfs_create_file(kobj, &kattr->attr);\n\tif (err) {\n\t\tpr_warn(\"creating the sysfs entry for %s failed: %d\\n\",\n\t\t\tkattr->attr.name, err);\n\t}\n}\n\nvoid gb_audio_manager_sysfs_init(struct kobject *kobj)\n{\n\tmanager_sysfs_init_attribute(kobj, &manager_add_attribute);\n\tmanager_sysfs_init_attribute(kobj, &manager_remove_attribute);\n\tmanager_sysfs_init_attribute(kobj, &manager_dump_attribute);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}