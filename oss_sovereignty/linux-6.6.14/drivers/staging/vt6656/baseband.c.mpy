{
  "module_name": "baseband.c",
  "hash_id": "4ce6d65ace26fd1f74793de3102b1c70e101ffb390812f88562f48f084469c42",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/vt6656/baseband.c",
  "human_readable_source": "\n \n\n#include <linux/bits.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include \"device.h\"\n#include \"mac.h\"\n#include \"baseband.h\"\n#include \"rf.h\"\n#include \"usbpipe.h\"\n\nstatic const u8 vnt_vt3184_agc[] = {\n\t0x00, 0x00, 0x02, 0x02, 0x04, 0x04, 0x06, 0x06,\n\t0x08, 0x08, 0x0a, 0x0a, 0x0c, 0x0c, 0x0e, 0x0e,  \n\t0x10, 0x10, 0x12, 0x12, 0x14, 0x14, 0x16, 0x16,\n\t0x18, 0x18, 0x1a, 0x1a, 0x1c, 0x1c, 0x1e, 0x1e,  \n\t0x20, 0x20, 0x22, 0x22, 0x24, 0x24, 0x26, 0x26,\n\t0x28, 0x28, 0x2a, 0x2a, 0x2c, 0x2c, 0x2e, 0x2e,  \n\t0x30, 0x30, 0x32, 0x32, 0x34, 0x34, 0x36, 0x36,\n\t0x38, 0x38, 0x3a, 0x3a, 0x3c, 0x3c, 0x3e, 0x3e   \n};\n\nstatic u8 vnt_vt3184_al2230[] = {\n\t0x31, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00,\n\t0x70, 0x45, 0x2a, 0x76, 0x00, 0x00, 0x80, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x8e, 0x0a, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x00, 0x0c,  \n\t0x26, 0x5b, 0x00, 0x00, 0x00, 0x00, 0xaa, 0xaa,\n\t0xff, 0xff, 0x79, 0x00, 0x00, 0x0b, 0x48, 0x04,  \n\t0x00, 0x08, 0x00, 0x08, 0x08, 0x14, 0x05, 0x09,\n\t0x00, 0x00, 0x00, 0x00, 0x09, 0x73, 0x00, 0xc5,  \n\t0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0xd0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0xe4, 0x80, 0x00, 0x00, 0x00, 0x00, 0x98, 0x0a,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x01, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x8c, 0x01, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x08, 0x00, 0x1f, 0xb7, 0x88, 0x47, 0xaa, 0x00,  \n\t0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xeb,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,\n\t0x18, 0x00, 0x00, 0x00, 0x00, 0x15, 0x00, 0x18,  \n\t0x38, 0x30, 0x00, 0x00, 0xff, 0x0f, 0xe4, 0xe2,\n\t0x00, 0x00, 0x00, 0x03, 0x01, 0x00, 0x00, 0x00,  \n\t0x18, 0x20, 0x07, 0x18, 0xff, 0xff, 0x0e, 0x0a,\n\t0x0e, 0x00, 0x82, 0xa7, 0x3c, 0x10, 0x30, 0x05,  \n\t0x40, 0x12, 0x00, 0x00, 0x10, 0x28, 0x80, 0x2a,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0xf3, 0x00, 0x00, 0x00, 0x10, 0x00, 0x12,\n\t0x00, 0xf4, 0x00, 0xff, 0x79, 0x20, 0x30, 0x05,  \n\t0x00, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00   \n};\n\n \nstatic const u8 vnt_vt3184_vt3226d0[] = {\n\t0x31, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00, 0x00,\n\t0x70, 0x45, 0x2a, 0x76, 0x00, 0x00, 0x80, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x8e, 0x0a, 0x00, 0x00, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x4a, 0x00, 0x0c,  \n\t0x26, 0x5b, 0x00, 0x00, 0x00, 0x00, 0xaa, 0xaa,\n\t0xff, 0xff, 0x79, 0x00, 0x00, 0x0b, 0x48, 0x04,  \n\t0x00, 0x08, 0x00, 0x08, 0x08, 0x14, 0x05, 0x09,\n\t0x00, 0x00, 0x00, 0x00, 0x09, 0x73, 0x00, 0xc5,  \n\t0x00, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0xd0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0xe4, 0x80, 0x00, 0x00, 0x00, 0x00, 0x98, 0x0a,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x01, 0x00,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x8c, 0x01, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x08, 0x00, 0x1f, 0xb7, 0x88, 0x47, 0xaa, 0x00,  \n\t0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xeb,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01,  \n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,\n\t0x18, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x18,  \n\t0x38, 0x30, 0x00, 0x00, 0xff, 0x0f, 0xe4, 0xe2,\n\t0x00, 0x00, 0x00, 0x03, 0x01, 0x00, 0x00, 0x00,  \n\t0x18, 0x20, 0x07, 0x18, 0xff, 0xff, 0x10, 0x0a,\n\t0x0e, 0x00, 0x84, 0xa7, 0x3c, 0x10, 0x24, 0x05,  \n\t0x40, 0x12, 0x00, 0x00, 0x10, 0x28, 0x80, 0x2a,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,  \n\t0x00, 0xf3, 0x00, 0x00, 0x00, 0x10, 0x00, 0x10,\n\t0x00, 0xf4, 0x00, 0xff, 0x79, 0x20, 0x30, 0x08,  \n\t0x00, 0x3e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00   \n};\n\nstruct vnt_threshold {\n\tu8 bb_pre_ed_rssi;\n\tu8 cr_201;\n\tu8 cr_206;\n};\n\nstatic const struct vnt_threshold al2230_vnt_threshold[] = {\n\t{0, 0x00, 0x30},\t \n\t{68, 0x00, 0x36},\n\t{67, 0x00, 0x43},\n\t{66, 0x00, 0x51},\n\t{65, 0x00, 0x62},\n\t{64, 0x00, 0x79},\n\t{63, 0x00, 0x93},\n\t{62, 0x00, 0xb9},\n\t{61, 0x00, 0xe3},\n\t{60, 0x01, 0x18},\n\t{59, 0x01, 0x54},\n\t{58, 0x01, 0xa0},\n\t{57, 0x02, 0x20},\n\t{56, 0x02, 0xa0},\n\t{55, 0x03, 0x00},\n\t{53, 0x06, 0x00},\n\t{51, 0x09, 0x00},\n\t{49, 0x0e, 0x00},\n\t{47, 0x15, 0x00},\n\t{46, 0x1a, 0x00},\n\t{45, 0xff, 0x00}\n};\n\nstatic const struct vnt_threshold vt3226_vnt_threshold[] = {\n\t{0, 0x00, 0x24},\t \n\t{68, 0x00, 0x2d},\n\t{67, 0x00, 0x36},\n\t{66, 0x00, 0x43},\n\t{65, 0x00, 0x52},\n\t{64, 0x00, 0x68},\n\t{63, 0x00, 0x80},\n\t{62, 0x00, 0x9c},\n\t{61, 0x00, 0xc0},\n\t{60, 0x00, 0xea},\n\t{59, 0x01, 0x30},\n\t{58, 0x01, 0x70},\n\t{57, 0x01, 0xb0},\n\t{56, 0x02, 0x30},\n\t{55, 0x02, 0xc0},\n\t{53, 0x04, 0x00},\n\t{51, 0x07, 0x00},\n\t{49, 0x0a, 0x00},\n\t{47, 0x11, 0x00},\n\t{45, 0x18, 0x00},\n\t{43, 0x26, 0x00},\n\t{42, 0x36, 0x00},\n\t{41, 0xff, 0x00}\n};\n\n \nint vnt_set_antenna_mode(struct vnt_private *priv, u8 antenna_mode)\n{\n\tswitch (antenna_mode) {\n\tcase ANT_TXA:\n\tcase ANT_TXB:\n\t\tbreak;\n\tcase ANT_RXA:\n\t\tpriv->bb_rx_conf &= 0xFC;\n\t\tbreak;\n\tcase ANT_RXB:\n\t\tpriv->bb_rx_conf &= 0xFE;\n\t\tpriv->bb_rx_conf |= 0x02;\n\t\tbreak;\n\t}\n\n\treturn vnt_control_out(priv, MESSAGE_TYPE_SET_ANTMD,\n\t\t\t       (u16)antenna_mode, 0, 0, NULL);\n}\n\n \n\nint vnt_vt3184_init(struct vnt_private *priv)\n{\n\tint ret;\n\tu16 length;\n\tu8 *addr = NULL;\n\tconst u8 *c_addr;\n\tu8 data;\n\n\tret = vnt_control_in(priv, MESSAGE_TYPE_READ, 0, MESSAGE_REQUEST_EEPROM,\n\t\t\t     EEP_MAX_CONTEXT_SIZE, priv->eeprom);\n\tif (ret)\n\t\tgoto end;\n\n\tpriv->rf_type = priv->eeprom[EEP_OFS_RFTYPE];\n\n\tdev_dbg(&priv->usb->dev, \"RF Type %d\\n\", priv->rf_type);\n\n\tif ((priv->rf_type == RF_AL2230) ||\n\t    (priv->rf_type == RF_AL2230S)) {\n\t\tpriv->bb_rx_conf = vnt_vt3184_al2230[10];\n\t\tlength = sizeof(vnt_vt3184_al2230);\n\t\taddr = vnt_vt3184_al2230;\n\n\t\tpriv->bb_vga[0] = 0x1c;\n\t\tpriv->bb_vga[1] = 0x10;\n\t\tpriv->bb_vga[2] = 0x0;\n\t\tpriv->bb_vga[3] = 0x0;\n\n\t} else if ((priv->rf_type == RF_VT3226) ||\n\t\t   (priv->rf_type == RF_VT3226D0)) {\n\t\tpriv->bb_rx_conf = vnt_vt3184_vt3226d0[10];\n\t\tlength = sizeof(vnt_vt3184_vt3226d0);\n\t\tc_addr = vnt_vt3184_vt3226d0;\n\n\t\tpriv->bb_vga[0] = 0x20;\n\t\tpriv->bb_vga[1] = 0x10;\n\t\tpriv->bb_vga[2] = 0x0;\n\t\tpriv->bb_vga[3] = 0x0;\n\n\t\t \n\t\tret = vnt_mac_reg_bits_on(priv, MAC_REG_SOFTPWRCTL2,\n\t\t\t\t\t  SOFTPWRCTL_RFLEOPT);\n\t\tif (ret)\n\t\t\tgoto end;\n\t} else {\n\t\tgoto end;\n\t}\n\n\tif (addr)\n\t\tc_addr = addr;\n\n\tret = vnt_control_out_blocks(priv, VNT_REG_BLOCK_SIZE,\n\t\t\t\t     MESSAGE_REQUEST_BBREG, length, c_addr);\n\tif (ret)\n\t\tgoto end;\n\n\tret = vnt_control_out(priv, MESSAGE_TYPE_WRITE, 0,\n\t\t\t      MESSAGE_REQUEST_BBAGC,\n\t\t\t      sizeof(vnt_vt3184_agc), vnt_vt3184_agc);\n\tif (ret)\n\t\tgoto end;\n\n\tif ((priv->rf_type == RF_VT3226) ||\n\t    (priv->rf_type == RF_VT3226D0)) {\n\t\tdata = (priv->rf_type == RF_VT3226D0) ? 0x11 : 0x23;\n\n\t\tret = vnt_control_out_u8(priv, MESSAGE_REQUEST_MACREG,\n\t\t\t\t\t MAC_REG_ITRTMSET, data);\n\t\tif (ret)\n\t\t\tgoto end;\n\n\t\tret = vnt_mac_reg_bits_on(priv, MAC_REG_PAPEDELAY, BIT(0));\n\t\tif (ret)\n\t\t\tgoto end;\n\t}\n\n\tret = vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x04, 0x7f);\n\tif (ret)\n\t\tgoto end;\n\n\tret = vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x0d, 0x01);\n\tif (ret)\n\t\tgoto end;\n\n\tret = vnt_rf_table_download(priv);\n\tif (ret)\n\t\tgoto end;\n\n\t \n\tret = vnt_control_in(priv, MESSAGE_TYPE_READ, USB_REG4,\n\t\t\t     MESSAGE_REQUEST_MEM, sizeof(data), &data);\n\tif (ret)\n\t\tgoto end;\n\n\tdata |= 0x2;\n\n\tret = vnt_control_out(priv, MESSAGE_TYPE_WRITE, USB_REG4,\n\t\t\t      MESSAGE_REQUEST_MEM, sizeof(data), &data);\n\nend:\n\treturn ret;\n}\n\n \nint vnt_set_short_slot_time(struct vnt_private *priv)\n{\n\tint ret = 0;\n\tu8 bb_vga = 0;\n\n\tif (priv->short_slot_time)\n\t\tpriv->bb_rx_conf &= 0xdf;\n\telse\n\t\tpriv->bb_rx_conf |= 0x20;\n\n\tret = vnt_control_in_u8(priv, MESSAGE_REQUEST_BBREG, 0xe7, &bb_vga);\n\tif (ret)\n\t\treturn ret;\n\n\tif (bb_vga == priv->bb_vga[0])\n\t\tpriv->bb_rx_conf |= 0x20;\n\n\treturn vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x0a,\n\t\t\t\t  priv->bb_rx_conf);\n}\n\nint vnt_set_vga_gain_offset(struct vnt_private *priv, u8 data)\n{\n\tint ret;\n\n\tret = vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0xE7, data);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tif (priv->short_slot_time)\n\t\tpriv->bb_rx_conf &= 0xdf;  \n\telse\n\t\tpriv->bb_rx_conf |= 0x20;  \n\n\treturn vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x0a,\n\t\t\t\t  priv->bb_rx_conf);\n}\n\n \nint vnt_set_deep_sleep(struct vnt_private *priv)\n{\n\tint ret = 0;\n\n\t \n\tret = vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x0c, 0x17);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\treturn vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x0d, 0xB9);\n}\n\nint vnt_exit_deep_sleep(struct vnt_private *priv)\n{\n\tint ret = 0;\n\n\t \n\tret = vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x0c, 0x00);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\treturn vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0x0d, 0x01);\n}\n\nint vnt_update_pre_ed_threshold(struct vnt_private *priv, int scanning)\n{\n\tconst struct vnt_threshold *threshold = NULL;\n\tu8 length;\n\tu8 cr_201, cr_206;\n\tu8 ed_inx;\n\tint ret;\n\n\tswitch (priv->rf_type) {\n\tcase RF_AL2230:\n\tcase RF_AL2230S:\n\t\tthreshold = al2230_vnt_threshold;\n\t\tlength = ARRAY_SIZE(al2230_vnt_threshold);\n\t\tbreak;\n\n\tcase RF_VT3226:\n\tcase RF_VT3226D0:\n\t\tthreshold = vt3226_vnt_threshold;\n\t\tlength = ARRAY_SIZE(vt3226_vnt_threshold);\n\t\tbreak;\n\t}\n\n\tif (!threshold)\n\t\treturn -EINVAL;\n\n\tfor (ed_inx = scanning ? 0 : length - 1; ed_inx > 0; ed_inx--) {\n\t\tif (priv->bb_pre_ed_rssi <= threshold[ed_inx].bb_pre_ed_rssi)\n\t\t\tbreak;\n\t}\n\n\tcr_201 = threshold[ed_inx].cr_201;\n\tcr_206 = threshold[ed_inx].cr_206;\n\n\tif (ed_inx == priv->bb_pre_ed_index && !scanning)\n\t\treturn 0;\n\n\tpriv->bb_pre_ed_index = ed_inx;\n\n\tdev_dbg(&priv->usb->dev, \"%s bb_pre_ed_rssi %d\\n\",\n\t\t__func__, priv->bb_pre_ed_rssi);\n\n\tret = vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0xc9, cr_201);\n\tif (ret)\n\t\treturn ret;\n\n\treturn vnt_control_out_u8(priv, MESSAGE_REQUEST_BBREG, 0xce, cr_206);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}