{
  "module_name": "ddk750_power.c",
  "hash_id": "f28ff73fe5a367ff6bf6016b3e7c0e36e9e7f37db4d5ec358d778c5bb0f8def4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/sm750fb/ddk750_power.c",
  "human_readable_source": "\n#include \"ddk750_chip.h\"\n#include \"ddk750_reg.h\"\n#include \"ddk750_power.h\"\n\nvoid ddk750_set_dpms(enum dpms state)\n{\n\tunsigned int value;\n\n\tif (sm750_get_chip_type() == SM750LE) {\n\t\tvalue = peek32(CRT_DISPLAY_CTRL) & ~CRT_DISPLAY_CTRL_DPMS_MASK;\n\t\tvalue |= (state << CRT_DISPLAY_CTRL_DPMS_SHIFT);\n\t\tpoke32(CRT_DISPLAY_CTRL, value);\n\t} else {\n\t\tvalue = peek32(SYSTEM_CTRL);\n\t\tvalue = (value & ~SYSTEM_CTRL_DPMS_MASK) | state;\n\t\tpoke32(SYSTEM_CTRL, value);\n\t}\n}\n\nstatic unsigned int get_power_mode(void)\n{\n\tif (sm750_get_chip_type() == SM750LE)\n\t\treturn 0;\n\treturn peek32(POWER_MODE_CTRL) & POWER_MODE_CTRL_MODE_MASK;\n}\n\n \nvoid sm750_set_power_mode(unsigned int mode)\n{\n\tunsigned int ctrl = 0;\n\n\tctrl = peek32(POWER_MODE_CTRL) & ~POWER_MODE_CTRL_MODE_MASK;\n\n\tif (sm750_get_chip_type() == SM750LE)\n\t\treturn;\n\n\tswitch (mode) {\n\tcase POWER_MODE_CTRL_MODE_MODE0:\n\t\tctrl |= POWER_MODE_CTRL_MODE_MODE0;\n\t\tbreak;\n\n\tcase POWER_MODE_CTRL_MODE_MODE1:\n\t\tctrl |= POWER_MODE_CTRL_MODE_MODE1;\n\t\tbreak;\n\n\tcase POWER_MODE_CTRL_MODE_SLEEP:\n\t\tctrl |= POWER_MODE_CTRL_MODE_SLEEP;\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n\n\t \n\tif (mode == POWER_MODE_CTRL_MODE_SLEEP) {\n\t\tctrl &= ~POWER_MODE_CTRL_OSC_INPUT;\n#ifdef VALIDATION_CHIP\n\t\tctrl &= ~POWER_MODE_CTRL_336CLK;\n#endif\n\t} else {\n\t\tctrl |= POWER_MODE_CTRL_OSC_INPUT;\n#ifdef VALIDATION_CHIP\n\t\tctrl |= POWER_MODE_CTRL_336CLK;\n#endif\n\t}\n\n\t \n\tpoke32(POWER_MODE_CTRL, ctrl);\n}\n\nvoid sm750_set_current_gate(unsigned int gate)\n{\n\tif (get_power_mode() == POWER_MODE_CTRL_MODE_MODE1)\n\t\tpoke32(MODE1_GATE, gate);\n\telse\n\t\tpoke32(MODE0_GATE, gate);\n}\n\n \nvoid sm750_enable_2d_engine(unsigned int enable)\n{\n\tu32 gate;\n\n\tgate = peek32(CURRENT_GATE);\n\tif (enable)\n\t\tgate |= (CURRENT_GATE_DE | CURRENT_GATE_CSC);\n\telse\n\t\tgate &= ~(CURRENT_GATE_DE | CURRENT_GATE_CSC);\n\n\tsm750_set_current_gate(gate);\n}\n\nvoid sm750_enable_dma(unsigned int enable)\n{\n\tu32 gate;\n\n\t \n\tgate = peek32(CURRENT_GATE);\n\tif (enable)\n\t\tgate |= CURRENT_GATE_DMA;\n\telse\n\t\tgate &= ~CURRENT_GATE_DMA;\n\n\tsm750_set_current_gate(gate);\n}\n\n \nvoid sm750_enable_gpio(unsigned int enable)\n{\n\tu32 gate;\n\n\t \n\tgate = peek32(CURRENT_GATE);\n\tif (enable)\n\t\tgate |= CURRENT_GATE_GPIO;\n\telse\n\t\tgate &= ~CURRENT_GATE_GPIO;\n\n\tsm750_set_current_gate(gate);\n}\n\n \nvoid sm750_enable_i2c(unsigned int enable)\n{\n\tu32 gate;\n\n\t \n\tgate = peek32(CURRENT_GATE);\n\tif (enable)\n\t\tgate |= CURRENT_GATE_I2C;\n\telse\n\t\tgate &= ~CURRENT_GATE_I2C;\n\n\tsm750_set_current_gate(gate);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}