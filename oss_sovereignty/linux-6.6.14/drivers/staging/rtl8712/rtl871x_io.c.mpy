{
  "module_name": "rtl871x_io.c",
  "hash_id": "ddd53349bba802c83e8fb064f9bf2554ae783f55487c15c4509e18b86fb87964",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8712/rtl871x_io.c",
  "human_readable_source": "\n \n \n\n#define _RTL871X_IO_C_\n\n#include \"osdep_service.h\"\n#include \"drv_types.h\"\n#include \"rtl871x_io.h\"\n#include \"osdep_intf.h\"\n#include \"usb_ops.h\"\n\nstatic uint _init_intf_hdl(struct _adapter *padapter,\n\t\t\t   struct intf_hdl *pintf_hdl)\n{\n\tstruct\tintf_priv\t*pintf_priv;\n\tvoid (*set_intf_option)(u32 *poption) = NULL;\n\tvoid (*set_intf_funs)(struct intf_hdl *pintf_hdl);\n\tvoid (*set_intf_ops)(struct _io_ops\t*pops);\n\tuint (*init_intf_priv)(struct intf_priv *pintfpriv);\n\n\tset_intf_option = &(r8712_usb_set_intf_option);\n\tset_intf_funs = &(r8712_usb_set_intf_funs);\n\tset_intf_ops = &r8712_usb_set_intf_ops;\n\tinit_intf_priv = &r8712_usb_init_intf_priv;\n\tpintf_priv = pintf_hdl->pintfpriv = kmalloc(sizeof(struct intf_priv),\n\t\t\t\t\t\t    GFP_ATOMIC);\n\tif (!pintf_priv)\n\t\tgoto _init_intf_hdl_fail;\n\tpintf_hdl->adapter = (u8 *)padapter;\n\tset_intf_option(&pintf_hdl->intf_option);\n\tset_intf_funs(pintf_hdl);\n\tset_intf_ops(&pintf_hdl->io_ops);\n\tpintf_priv->intf_dev = (u8 *)&padapter->dvobjpriv;\n\tif (init_intf_priv(pintf_priv) == _FAIL)\n\t\tgoto _init_intf_hdl_fail;\n\treturn _SUCCESS;\n_init_intf_hdl_fail:\n\tkfree(pintf_priv);\n\treturn _FAIL;\n}\n\nstatic void _unload_intf_hdl(struct intf_priv *pintfpriv)\n{\n\tvoid (*unload_intf_priv)(struct intf_priv *pintfpriv);\n\n\tunload_intf_priv = &r8712_usb_unload_intf_priv;\n\tunload_intf_priv(pintfpriv);\n\tkfree(pintfpriv);\n}\n\nstatic uint register_intf_hdl(u8 *dev, struct intf_hdl *pintfhdl)\n{\n\tstruct _adapter *adapter = (struct _adapter *)dev;\n\n\tpintfhdl->intf_option = 0;\n\tpintfhdl->adapter = dev;\n\tpintfhdl->intf_dev = (u8 *)&adapter->dvobjpriv;\n\tif (!_init_intf_hdl(adapter, pintfhdl))\n\t\tgoto register_intf_hdl_fail;\n\treturn _SUCCESS;\nregister_intf_hdl_fail:\n\treturn false;\n}\n\nstatic  void unregister_intf_hdl(struct intf_hdl *pintfhdl)\n{\n\t_unload_intf_hdl(pintfhdl->pintfpriv);\n\tmemset((u8 *)pintfhdl, 0, sizeof(struct intf_hdl));\n}\n\nuint r8712_alloc_io_queue(struct _adapter *adapter)\n{\n\tu32 i;\n\tstruct io_queue *pio_queue;\n\tstruct io_req *pio_req;\n\n\tpio_queue = kmalloc(sizeof(*pio_queue), GFP_ATOMIC);\n\tif (!pio_queue)\n\t\tgoto alloc_io_queue_fail;\n\tINIT_LIST_HEAD(&pio_queue->free_ioreqs);\n\tINIT_LIST_HEAD(&pio_queue->processing);\n\tINIT_LIST_HEAD(&pio_queue->pending);\n\tspin_lock_init(&pio_queue->lock);\n\tpio_queue->pallocated_free_ioreqs_buf = kzalloc(NUM_IOREQ *\n\t\t\t\t\t\t(sizeof(struct io_req)) + 4,\n\t\t\t\t\t\tGFP_ATOMIC);\n\tif ((pio_queue->pallocated_free_ioreqs_buf) == NULL)\n\t\tgoto alloc_io_queue_fail;\n\tpio_queue->free_ioreqs_buf = pio_queue->pallocated_free_ioreqs_buf + 4\n\t\t\t- ((addr_t)(pio_queue->pallocated_free_ioreqs_buf)\n\t\t\t& 3);\n\tpio_req = (struct io_req *)(pio_queue->free_ioreqs_buf);\n\tfor (i = 0; i < NUM_IOREQ; i++) {\n\t\tINIT_LIST_HEAD(&pio_req->list);\n\t\tlist_add_tail(&pio_req->list, &pio_queue->free_ioreqs);\n\t\tpio_req++;\n\t}\n\tif ((register_intf_hdl((u8 *)adapter, &pio_queue->intf)) == _FAIL)\n\t\tgoto alloc_io_queue_fail;\n\tadapter->pio_queue = pio_queue;\n\treturn _SUCCESS;\nalloc_io_queue_fail:\n\tif (pio_queue) {\n\t\tkfree(pio_queue->pallocated_free_ioreqs_buf);\n\t\tkfree(pio_queue);\n\t}\n\tadapter->pio_queue = NULL;\n\treturn _FAIL;\n}\n\nvoid r8712_free_io_queue(struct _adapter *adapter)\n{\n\tstruct io_queue *pio_queue = adapter->pio_queue;\n\n\tif (pio_queue) {\n\t\tkfree(pio_queue->pallocated_free_ioreqs_buf);\n\t\tadapter->pio_queue = NULL;\n\t\tunregister_intf_hdl(&pio_queue->intf);\n\t\tkfree(pio_queue);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}