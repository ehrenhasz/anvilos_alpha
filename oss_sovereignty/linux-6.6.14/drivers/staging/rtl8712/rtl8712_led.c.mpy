{
  "module_name": "rtl8712_led.c",
  "hash_id": "8f4034b62b5999a2b221be62bb066fbd4cdb9d74b0e0b3673e640e1b7fdad2aa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8712/rtl8712_led.c",
  "human_readable_source": "\n \n\n#include \"drv_types.h\"\n\n \n#define LED_BLINK_NORMAL_INTERVAL\t100\n#define LED_BLINK_SLOWLY_INTERVAL\t200\n#define LED_BLINK_LONG_INTERVAL\t400\n\n#define LED_BLINK_NO_LINK_INTERVAL_ALPHA\t1000\n#define LED_BLINK_LINK_INTERVAL_ALPHA\t\t500\n#define LED_BLINK_SCAN_INTERVAL_ALPHA\t\t180\n#define LED_BLINK_FASTER_INTERVAL_ALPHA\t\t50\n#define LED_BLINK_WPS_SUCCESS_INTERVAL_ALPHA\t5000\n\n \nenum _LED_STATE_871x {\n\tLED_UNKNOWN = 0,\n\tLED_STATE_ON = 1,\n\tLED_STATE_OFF = 2,\n\tLED_BLINK_NORMAL = 3,\n\tLED_BLINK_SLOWLY = 4,\n\tLED_POWER_ON_BLINK = 5,\n\tLED_SCAN_BLINK = 6,  \n\tLED_NO_LINK_BLINK = 7,  \n\tLED_BLINK_StartToBlink = 8, \n\tLED_BLINK_WPS = 9,\t \n\tLED_TXRX_BLINK = 10,\n\tLED_BLINK_WPS_STOP = 11,\t \n\tLED_BLINK_WPS_STOP_OVERLAP = 12,\t \n};\n\n \nstatic void BlinkTimerCallback(struct timer_list *t);\n\nstatic void BlinkWorkItemCallback(struct work_struct *work);\n \nstatic void InitLed871x(struct _adapter *padapter, struct LED_871x *pLed,\n\t\t\tenum LED_PIN_871x\tLedPin)\n{\n\tpLed->padapter = padapter;\n\tpLed->LedPin = LedPin;\n\tpLed->CurrLedState = LED_STATE_OFF;\n\tpLed->bLedOn = false;\n\tpLed->bLedBlinkInProgress = false;\n\tpLed->BlinkTimes = 0;\n\tpLed->BlinkingLedState = LED_UNKNOWN;\n\ttimer_setup(&pLed->BlinkTimer, BlinkTimerCallback, 0);\n\tINIT_WORK(&pLed->BlinkWorkItem, BlinkWorkItemCallback);\n}\n\n \nstatic void DeInitLed871x(struct LED_871x *pLed)\n{\n\tdel_timer_sync(&pLed->BlinkTimer);\n\t \n\tpLed->bLedBlinkInProgress = false;\n}\n\n \nstatic void SwLedOn(struct _adapter *padapter, struct LED_871x *pLed)\n{\n\tu8\tLedCfg;\n\n\tif (padapter->surprise_removed || padapter->driver_stopped)\n\t\treturn;\n\tLedCfg = r8712_read8(padapter, LEDCFG);\n\tswitch (pLed->LedPin) {\n\tcase LED_PIN_GPIO0:\n\t\tbreak;\n\tcase LED_PIN_LED0:\n\t\t \n\t\tr8712_write8(padapter, LEDCFG, LedCfg & 0xf0);\n\t\tbreak;\n\tcase LED_PIN_LED1:\n\t\t \n\t\tr8712_write8(padapter, LEDCFG, LedCfg & 0x0f);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\tpLed->bLedOn = true;\n}\n\n \nstatic void SwLedOff(struct _adapter *padapter, struct LED_871x *pLed)\n{\n\tu8\tLedCfg;\n\n\tif (padapter->surprise_removed || padapter->driver_stopped)\n\t\treturn;\n\tLedCfg = r8712_read8(padapter, LEDCFG);\n\tswitch (pLed->LedPin) {\n\tcase LED_PIN_GPIO0:\n\t\tbreak;\n\tcase LED_PIN_LED0:\n\t\tLedCfg &= 0xf0;  \n\t\tr8712_write8(padapter, LEDCFG, (LedCfg | BIT(3)));\n\t\tbreak;\n\tcase LED_PIN_LED1:\n\t\tLedCfg &= 0x0f;  \n\t\tr8712_write8(padapter, LEDCFG, (LedCfg | BIT(7)));\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\tpLed->bLedOn = false;\n}\n\n \nvoid r8712_InitSwLeds(struct _adapter *padapter)\n{\n\tstruct led_priv\t*pledpriv = &padapter->ledpriv;\n\n\tpledpriv->LedControlHandler = LedControl871x;\n\tInitLed871x(padapter, &pledpriv->SwLed0, LED_PIN_LED0);\n\tInitLed871x(padapter, &pledpriv->SwLed1, LED_PIN_LED1);\n}\n\n \nvoid r8712_DeInitSwLeds(struct _adapter *padapter)\n{\n\tstruct led_priv\t*ledpriv = &padapter->ledpriv;\n\n\tDeInitLed871x(&ledpriv->SwLed0);\n\tDeInitLed871x(&ledpriv->SwLed1);\n}\n\n \nstatic void SwLedBlink(struct LED_871x *pLed)\n{\n\tstruct _adapter *padapter = pLed->padapter;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tu8 bStopBlinking = false;\n\n\t \n\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\tSwLedOn(padapter, pLed);\n\telse\n\t\tSwLedOff(padapter, pLed);\n\t \n\tpLed->BlinkTimes--;\n\tswitch (pLed->CurrLedState) {\n\tcase LED_BLINK_NORMAL:\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tbreak;\n\tcase LED_BLINK_StartToBlink:\n\t\tif (check_fwstate(pmlmepriv, _FW_LINKED) &&\n\t\t    (pmlmepriv->fw_state & WIFI_STATION_STATE))\n\t\t\tbStopBlinking = true;\n\t\tif (check_fwstate(pmlmepriv, _FW_LINKED) &&\n\t\t    ((pmlmepriv->fw_state & WIFI_ADHOC_STATE) ||\n\t\t    (pmlmepriv->fw_state & WIFI_ADHOC_MASTER_STATE)))\n\t\t\tbStopBlinking = true;\n\t\telse if (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tbreak;\n\tcase LED_BLINK_WPS:\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tbreak;\n\tdefault:\n\t\tbStopBlinking = true;\n\t\tbreak;\n\t}\n\tif (bStopBlinking) {\n\t\tif (check_fwstate(pmlmepriv, _FW_LINKED) &&\n\t\t    !pLed->bLedOn)\n\t\t\tSwLedOn(padapter, pLed);\n\t\telse if (check_fwstate(pmlmepriv, _FW_LINKED) &&  pLed->bLedOn)\n\t\t\tSwLedOff(padapter, pLed);\n\t\tpLed->BlinkTimes = 0;\n\t\tpLed->bLedBlinkInProgress = false;\n\t} else {\n\t\t \n\t\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\n\t\t \n\t\tswitch (pLed->CurrLedState) {\n\t\tcase LED_BLINK_NORMAL:\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\t\tbreak;\n\t\tcase LED_BLINK_SLOWLY:\n\t\tcase LED_BLINK_StartToBlink:\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SLOWLY_INTERVAL));\n\t\t\tbreak;\n\t\tcase LED_BLINK_WPS:\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_LONG_INTERVAL));\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SLOWLY_INTERVAL));\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic void SwLedBlink1(struct LED_871x *pLed)\n{\n\tstruct _adapter *padapter = pLed->padapter;\n\tstruct led_priv *ledpriv = &padapter->ledpriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct eeprom_priv *peeprompriv = &padapter->eeprompriv;\n\tstruct LED_871x *pLed1 = &ledpriv->SwLed1;\n\tu8 bStopBlinking = false;\n\n\tif (peeprompriv->CustomerID == RT_CID_819x_CAMEO)\n\t\tpLed = &ledpriv->SwLed1;\n\t \n\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\tSwLedOn(padapter, pLed);\n\telse\n\t\tSwLedOff(padapter, pLed);\n\tif (peeprompriv->CustomerID == RT_CID_DEFAULT) {\n\t\tif (check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\tif (!pLed1->bSWLedCtrl) {\n\t\t\t\tSwLedOn(padapter, pLed1);\n\t\t\t\tpLed1->bSWLedCtrl = true;\n\t\t\t} else if (!pLed1->bLedOn) {\n\t\t\t\tSwLedOn(padapter, pLed1);\n\t\t\t}\n\t\t} else {\n\t\t\tif (!pLed1->bSWLedCtrl) {\n\t\t\t\tSwLedOff(padapter, pLed1);\n\t\t\t\tpLed1->bSWLedCtrl = true;\n\t\t\t} else if (pLed1->bLedOn) {\n\t\t\t\tSwLedOff(padapter, pLed1);\n\t\t\t}\n\t\t}\n\t}\n\tswitch (pLed->CurrLedState) {\n\tcase LED_BLINK_SLOWLY:\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\tbreak;\n\tcase LED_BLINK_NORMAL:\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_LINK_INTERVAL_ALPHA));\n\t\tbreak;\n\tcase LED_SCAN_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tif (check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->bLedLinkBlinkInProgress = true;\n\t\t\t\tpLed->CurrLedState = LED_BLINK_NORMAL;\n\t\t\t\tif (pLed->bLedOn)\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\telse\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_LINK_INTERVAL_ALPHA));\n\t\t\t} else if (!check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\t\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\t\t\tif (pLed->bLedOn)\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\telse\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_TXRX_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tif (check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->bLedLinkBlinkInProgress = true;\n\t\t\t\tpLed->CurrLedState = LED_BLINK_NORMAL;\n\t\t\t\tif (pLed->bLedOn)\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\telse\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_LINK_INTERVAL_ALPHA));\n\t\t\t} else if (!check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\t\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\t\t\tif (pLed->bLedOn)\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\telse\n\t\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t\t}\n\t\t\tpLed->BlinkTimes = 0;\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_BLINK_WPS:\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\tbreak;\n\tcase LED_BLINK_WPS_STOP:\t \n\t\tif (pLed->BlinkingLedState == LED_STATE_ON) {\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_WPS_SUCCESS_INTERVAL_ALPHA));\n\t\t\tbStopBlinking = false;\n\t\t} else {\n\t\t\tbStopBlinking = true;\n\t\t}\n\t\tif (bStopBlinking) {\n\t\t\tpLed->bLedLinkBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_NORMAL;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_LINK_INTERVAL_ALPHA));\n\t\t}\n\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedBlink2(struct LED_871x *pLed)\n{\n\tstruct _adapter *padapter = pLed->padapter;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tu8 bStopBlinking = false;\n\n\t \n\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\tSwLedOn(padapter, pLed);\n\telse\n\t\tSwLedOff(padapter, pLed);\n\tswitch (pLed->CurrLedState) {\n\tcase LED_SCAN_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tif (check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tSwLedOn(padapter, pLed);\n\t\t\t} else if (!check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\tSwLedOff(padapter, pLed);\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_TXRX_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tif (check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tSwLedOn(padapter, pLed);\n\t\t\t} else if (!check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\tSwLedOff(padapter, pLed);\n\t\t\t}\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedBlink3(struct LED_871x *pLed)\n{\n\tstruct _adapter *padapter = pLed->padapter;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tu8 bStopBlinking = false;\n\n\t \n\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\tSwLedOn(padapter, pLed);\n\telse\n\t\tif (pLed->CurrLedState != LED_BLINK_WPS_STOP)\n\t\t\tSwLedOff(padapter, pLed);\n\tswitch (pLed->CurrLedState) {\n\tcase LED_SCAN_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tif (check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tif (!pLed->bLedOn)\n\t\t\t\t\tSwLedOn(padapter, pLed);\n\t\t\t} else if (!check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\tif (pLed->bLedOn)\n\t\t\t\t\tSwLedOff(padapter, pLed);\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_TXRX_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tif (check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tif (!pLed->bLedOn)\n\t\t\t\t\tSwLedOn(padapter, pLed);\n\t\t\t} else if (!check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\tif (pLed->bLedOn)\n\t\t\t\t\tSwLedOff(padapter, pLed);\n\t\t\t}\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_BLINK_WPS:\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\tbreak;\n\tcase LED_BLINK_WPS_STOP:\t \n\t\tif (pLed->BlinkingLedState == LED_STATE_ON) {\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_WPS_SUCCESS_INTERVAL_ALPHA));\n\t\t\tbStopBlinking = false;\n\t\t} else {\n\t\t\tbStopBlinking = true;\n\t\t}\n\t\tif (bStopBlinking) {\n\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tSwLedOn(padapter, pLed);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedBlink4(struct LED_871x *pLed)\n{\n\tstruct _adapter *padapter = pLed->padapter;\n\tstruct led_priv\t*ledpriv = &padapter->ledpriv;\n\tstruct LED_871x *pLed1 = &ledpriv->SwLed1;\n\tu8 bStopBlinking = false;\n\n\t \n\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\tSwLedOn(padapter, pLed);\n\telse\n\t\tSwLedOff(padapter, pLed);\n\tif (!pLed1->bLedWPSBlinkInProgress &&\n\t    pLed1->BlinkingLedState == LED_UNKNOWN) {\n\t\tpLed1->BlinkingLedState = LED_STATE_OFF;\n\t\tpLed1->CurrLedState = LED_STATE_OFF;\n\t\tSwLedOff(padapter, pLed1);\n\t}\n\tswitch (pLed->CurrLedState) {\n\tcase LED_BLINK_SLOWLY:\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\tbreak;\n\tcase LED_BLINK_StartToBlink:\n\t\tif (pLed->bLedOn) {\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SLOWLY_INTERVAL));\n\t\t} else {\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\t}\n\t\tbreak;\n\tcase LED_SCAN_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_TXRX_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_BLINK_WPS:\n\t\tif (pLed->bLedOn) {\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SLOWLY_INTERVAL));\n\t\t} else {\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\t}\n\t\tbreak;\n\tcase LED_BLINK_WPS_STOP:\t \n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\tbreak;\n\tcase LED_BLINK_WPS_STOP_OVERLAP:\t \n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0) {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkTimes = 1;\n\t\t\telse\n\t\t\t\tbStopBlinking = true;\n\t\t}\n\t\tif (bStopBlinking) {\n\t\t\tpLed->BlinkTimes = 10;\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_LINK_INTERVAL_ALPHA));\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedBlink5(struct LED_871x *pLed)\n{\n\tstruct _adapter *padapter = pLed->padapter;\n\tu8 bStopBlinking = false;\n\n\t \n\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\tSwLedOn(padapter, pLed);\n\telse\n\t\tSwLedOff(padapter, pLed);\n\tswitch (pLed->CurrLedState) {\n\tcase LED_SCAN_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tif (!pLed->bLedOn)\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_TXRX_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tif (!pLed->bLedOn)\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedBlink6(struct LED_871x *pLed)\n{\n\tstruct _adapter *padapter = pLed->padapter;\n\tu8 bStopBlinking = false;\n\n\t \n\tif (pLed->BlinkingLedState == LED_STATE_ON)\n\t\tSwLedOn(padapter, pLed);\n\telse\n\t\tSwLedOff(padapter, pLed);\n\tswitch (pLed->CurrLedState) {\n\tcase LED_TXRX_BLINK:\n\t\tpLed->BlinkTimes--;\n\t\tif (pLed->BlinkTimes == 0)\n\t\t\tbStopBlinking = true;\n\t\tif (bStopBlinking) {\n\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tif (!pLed->bLedOn)\n\t\t\t\tSwLedOn(padapter, pLed);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t} else {\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_BLINK_WPS:\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n}\n\n \nstatic void BlinkTimerCallback(struct timer_list *t)\n{\n\tstruct LED_871x  *pLed = from_timer(pLed, t, BlinkTimer);\n\n\t \n\tif (pLed->padapter->surprise_removed || pLed->padapter->driver_stopped)\n\t\treturn;\n\tschedule_work(&pLed->BlinkWorkItem);\n}\n\n \nstatic void BlinkWorkItemCallback(struct work_struct *work)\n{\n\tstruct LED_871x *pLed = container_of(work, struct LED_871x,\n\t\t\t\tBlinkWorkItem);\n\tstruct led_priv\t*ledpriv = &pLed->padapter->ledpriv;\n\n\tswitch (ledpriv->LedStrategy) {\n\tcase SW_LED_MODE0:\n\t\tSwLedBlink(pLed);\n\t\tbreak;\n\tcase SW_LED_MODE1:\n\t\tSwLedBlink1(pLed);\n\t\tbreak;\n\tcase SW_LED_MODE2:\n\t\tSwLedBlink2(pLed);\n\t\tbreak;\n\tcase SW_LED_MODE3:\n\t\tSwLedBlink3(pLed);\n\t\tbreak;\n\tcase SW_LED_MODE4:\n\t\tSwLedBlink4(pLed);\n\t\tbreak;\n\tcase SW_LED_MODE5:\n\t\tSwLedBlink5(pLed);\n\t\tbreak;\n\tcase SW_LED_MODE6:\n\t\tSwLedBlink6(pLed);\n\t\tbreak;\n\tdefault:\n\t\tSwLedBlink(pLed);\n\t\tbreak;\n\t}\n}\n\n \n\nstatic void SwLedControlMode1(struct _adapter *padapter,\n\t\t\t      enum LED_CTL_MODE LedAction)\n{\n\tstruct led_priv *ledpriv = &padapter->ledpriv;\n\tstruct LED_871x *pLed = &ledpriv->SwLed0;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct sitesurvey_ctrl *psitesurveyctrl = &pmlmepriv->sitesurveyctrl;\n\n\tif (padapter->eeprompriv.CustomerID == RT_CID_819x_CAMEO)\n\t\tpLed = &ledpriv->SwLed1;\n\tswitch (LedAction) {\n\tcase LED_CTL_START_TO_LINK:\n\tcase LED_CTL_NO_LINK:\n\t\tif (!pLed->bLedNoLinkBlinkInProgress) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_LINK:\n\t\tif (!pLed->bLedLinkBlinkInProgress) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedLinkBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_NORMAL;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_LINK_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_SITE_SURVEY:\n\t\tif (psitesurveyctrl->traffic_busy &&\n\t\t    check_fwstate(pmlmepriv, _FW_LINKED))\n\t\t\t;  \n\t\telse if (!pLed->bLedScanBlinkInProgress) {\n\t\t\tif (IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_SCAN_BLINK;\n\t\t\tpLed->BlinkTimes = 24;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_TX:\n\tcase LED_CTL_RX:\n\t\tif (!pLed->bLedBlinkInProgress) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_TXRX_BLINK;\n\t\t\tpLed->BlinkTimes = 2;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\n\tcase LED_CTL_START_WPS:  \n\tcase LED_CTL_START_WPS_BOTTON:\n\t\tif (!pLed->bLedWPSBlinkInProgress) {\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedWPSBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_WPS;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS:\n\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedLinkBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedLinkBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedWPSBlinkInProgress)\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\telse\n\t\t\tpLed->bLedWPSBlinkInProgress = true;\n\t\tpLed->CurrLedState = LED_BLINK_WPS_STOP;\n\t\tif (pLed->bLedOn) {\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_WPS_SUCCESS_INTERVAL_ALPHA));\n\t\t} else {\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS_FAIL:\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\tbreak;\n\tcase LED_CTL_POWER_OFF:\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedLinkBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedLinkBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t}\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedControlMode2(struct _adapter *padapter,\n\t\t\t      enum LED_CTL_MODE LedAction)\n{\n\tstruct led_priv\t *ledpriv = &padapter->ledpriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct LED_871x *pLed = &ledpriv->SwLed0;\n\n\tswitch (LedAction) {\n\tcase LED_CTL_SITE_SURVEY:\n\t\tif (pmlmepriv->sitesurveyctrl.traffic_busy)\n\t\t\t;  \n\t\telse if (!pLed->bLedScanBlinkInProgress) {\n\t\t\tif (IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_SCAN_BLINK;\n\t\t\tpLed->BlinkTimes = 24;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\n\tcase LED_CTL_TX:\n\tcase LED_CTL_RX:\n\t\tif (!pLed->bLedBlinkInProgress &&\n\t\t    check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tpLed->bLedBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_TXRX_BLINK;\n\t\t\tpLed->BlinkTimes = 2;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\n\tcase LED_CTL_LINK:\n\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t}\n\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\n\tcase LED_CTL_START_WPS:  \n\tcase LED_CTL_START_WPS_BOTTON:\n\t\tif (!pLed->bLedWPSBlinkInProgress) {\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedWPSBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t}\n\t\tbreak;\n\n\tcase LED_CTL_STOP_WPS:\n\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\n\tcase LED_CTL_STOP_WPS_FAIL:\n\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\n\tcase LED_CTL_START_TO_LINK:\n\tcase LED_CTL_NO_LINK:\n\t\tif (!IS_LED_BLINKING(pLed)) {\n\t\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_POWER_OFF:\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedControlMode3(struct _adapter *padapter,\n\t\t\t      enum LED_CTL_MODE LedAction)\n{\n\tstruct led_priv\t*ledpriv = &padapter->ledpriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct LED_871x *pLed = &ledpriv->SwLed0;\n\n\tswitch (LedAction) {\n\tcase LED_CTL_SITE_SURVEY:\n\t\tif (pmlmepriv->sitesurveyctrl.traffic_busy)\n\t\t\t;  \n\t\telse if (!pLed->bLedScanBlinkInProgress) {\n\t\t\tif (IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_SCAN_BLINK;\n\t\t\tpLed->BlinkTimes = 24;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_TX:\n\tcase LED_CTL_RX:\n\t\tif (!pLed->bLedBlinkInProgress &&\n\t\t    check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tpLed->bLedBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_TXRX_BLINK;\n\t\t\tpLed->BlinkTimes = 2;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_LINK:\n\t\tif (IS_LED_WPS_BLINKING(pLed))\n\t\t\treturn;\n\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t}\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tcase LED_CTL_START_WPS:  \n\tcase LED_CTL_START_WPS_BOTTON:\n\t\tif (!pLed->bLedWPSBlinkInProgress) {\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedWPSBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_WPS;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS:\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t} else {\n\t\t\tpLed->bLedWPSBlinkInProgress = true;\n\t\t}\n\t\tpLed->CurrLedState = LED_BLINK_WPS_STOP;\n\t\tif (pLed->bLedOn) {\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_WPS_SUCCESS_INTERVAL_ALPHA));\n\t\t} else {\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS_FAIL:\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tcase LED_CTL_START_TO_LINK:\n\tcase LED_CTL_NO_LINK:\n\t\tif (!IS_LED_BLINKING(pLed)) {\n\t\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_POWER_OFF:\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedControlMode4(struct _adapter *padapter,\n\t\t\t      enum LED_CTL_MODE LedAction)\n{\n\tstruct led_priv\t*ledpriv = &padapter->ledpriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct LED_871x *pLed = &ledpriv->SwLed0;\n\tstruct LED_871x *pLed1 = &ledpriv->SwLed1;\n\n\tswitch (LedAction) {\n\tcase LED_CTL_START_TO_LINK:\n\t\tif (pLed1->bLedWPSBlinkInProgress) {\n\t\t\tpLed1->bLedWPSBlinkInProgress = false;\n\t\t\tdel_timer(&pLed1->BlinkTimer);\n\t\t\tpLed1->BlinkingLedState = LED_STATE_OFF;\n\t\t\tpLed1->CurrLedState = LED_STATE_OFF;\n\t\t\tif (pLed1->bLedOn)\n\t\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t}\n\t\tif (!pLed->bLedStartToLinkBlinkInProgress) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedStartToLinkBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_StartToBlink;\n\t\t\tif (pLed->bLedOn) {\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_SLOWLY_INTERVAL));\n\t\t\t} else {\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_LINK:\n\tcase LED_CTL_NO_LINK:\n\t\t \n\t\tif (LedAction == LED_CTL_LINK) {\n\t\t\tif (pLed1->bLedWPSBlinkInProgress) {\n\t\t\t\tpLed1->bLedWPSBlinkInProgress = false;\n\t\t\t\tdel_timer(&pLed1->BlinkTimer);\n\t\t\t\tpLed1->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\tpLed1->CurrLedState = LED_STATE_OFF;\n\t\t\t\tif (pLed1->bLedOn)\n\t\t\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t\t}\n\t\t}\n\t\tif (!pLed->bLedNoLinkBlinkInProgress) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_SITE_SURVEY:\n\t\tif (pmlmepriv->sitesurveyctrl.traffic_busy &&\n\t\t    check_fwstate(pmlmepriv, _FW_LINKED))\n\t\t\t;\n\t\telse if (!pLed->bLedScanBlinkInProgress) {\n\t\t\tif (IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_SCAN_BLINK;\n\t\t\tpLed->BlinkTimes = 24;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_TX:\n\tcase LED_CTL_RX:\n\t\tif (!pLed->bLedBlinkInProgress) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK ||\n\t\t\t    IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_TXRX_BLINK;\n\t\t\tpLed->BlinkTimes = 2;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_START_WPS:  \n\tcase LED_CTL_START_WPS_BOTTON:\n\t\tif (pLed1->bLedWPSBlinkInProgress) {\n\t\t\tpLed1->bLedWPSBlinkInProgress = false;\n\t\t\tdel_timer(&pLed1->BlinkTimer);\n\t\t\tpLed1->BlinkingLedState = LED_STATE_OFF;\n\t\t\tpLed1->CurrLedState = LED_STATE_OFF;\n\t\t\tif (pLed1->bLedOn)\n\t\t\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\t}\n\t\tif (!pLed->bLedWPSBlinkInProgress) {\n\t\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedWPSBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_WPS;\n\t\t\tif (pLed->bLedOn) {\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_SLOWLY_INTERVAL));\n\t\t\t} else {\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS:\t \n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS_FAIL:\t \n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t \n\t\tif (pLed1->bLedWPSBlinkInProgress)\n\t\t\tdel_timer(&pLed1->BlinkTimer);\n\t\telse\n\t\t\tpLed1->bLedWPSBlinkInProgress = true;\n\t\tpLed1->CurrLedState = LED_BLINK_WPS_STOP;\n\t\tif (pLed1->bLedOn)\n\t\t\tpLed1->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed1->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS_FAIL_OVERLAP:\t \n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tpLed->bLedNoLinkBlinkInProgress = true;\n\t\tpLed->CurrLedState = LED_BLINK_SLOWLY;\n\t\tif (pLed->bLedOn)\n\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NO_LINK_INTERVAL_ALPHA));\n\t\t \n\t\tif (pLed1->bLedWPSBlinkInProgress)\n\t\t\tdel_timer(&pLed1->BlinkTimer);\n\t\telse\n\t\t\tpLed1->bLedWPSBlinkInProgress = true;\n\t\tpLed1->CurrLedState = LED_BLINK_WPS_STOP_OVERLAP;\n\t\tpLed1->BlinkTimes = 10;\n\t\tif (pLed1->bLedOn)\n\t\t\tpLed1->BlinkingLedState = LED_STATE_OFF;\n\t\telse\n\t\t\tpLed1->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t  msecs_to_jiffies(LED_BLINK_NORMAL_INTERVAL));\n\t\tbreak;\n\tcase LED_CTL_POWER_OFF:\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tif (pLed->bLedNoLinkBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedNoLinkBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedLinkBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedLinkBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedScanBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedScanBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedStartToLinkBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedStartToLinkBlinkInProgress = false;\n\t\t}\n\t\tif (pLed1->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed1->BlinkTimer);\n\t\t\tpLed1->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tpLed1->BlinkingLedState = LED_UNKNOWN;\n\t\tSwLedOff(padapter, pLed);\n\t\tSwLedOff(padapter, pLed1);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedControlMode5(struct _adapter *padapter,\n\t\t\t      enum LED_CTL_MODE LedAction)\n{\n\tstruct led_priv\t*ledpriv = &padapter->ledpriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct LED_871x *pLed = &ledpriv->SwLed0;\n\n\tif (padapter->eeprompriv.CustomerID == RT_CID_819x_CAMEO)\n\t\tpLed = &ledpriv->SwLed1;\n\n\tswitch (LedAction) {\n\tcase LED_CTL_POWER_ON:\n\tcase LED_CTL_NO_LINK:\n\tcase LED_CTL_LINK:\t \n\t\tif (pLed->CurrLedState == LED_SCAN_BLINK)\n\t\t\treturn;\n\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tpLed->bLedBlinkInProgress = false;\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tcase LED_CTL_SITE_SURVEY:\n\t\tif (pmlmepriv->sitesurveyctrl.traffic_busy &&\n\t\t    check_fwstate(pmlmepriv, _FW_LINKED))\n\t\t\t;  \n\t\telse if (!pLed->bLedScanBlinkInProgress) {\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedScanBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_SCAN_BLINK;\n\t\t\tpLed->BlinkTimes = 24;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_TX:\n\tcase LED_CTL_RX:\n\t\tif (!pLed->bLedBlinkInProgress) {\n\t\t\tif (pLed->CurrLedState == LED_SCAN_BLINK)\n\t\t\t\treturn;\n\t\t\tpLed->bLedBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_TXRX_BLINK;\n\t\t\tpLed->BlinkTimes = 2;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_POWER_OFF:\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tSwLedOff(padapter, pLed);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void SwLedControlMode6(struct _adapter *padapter,\n\t\t\t      enum LED_CTL_MODE LedAction)\n{\n\tstruct led_priv\t*ledpriv = &padapter->ledpriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct LED_871x *pLed = &ledpriv->SwLed0;\n\n\tswitch (LedAction) {\n\tcase LED_CTL_POWER_ON:\n\tcase LED_CTL_NO_LINK:\n\tcase LED_CTL_LINK:\t \n\tcase LED_CTL_SITE_SURVEY:\n\t\tif (IS_LED_WPS_BLINKING(pLed))\n\t\t\treturn;\n\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tpLed->bLedBlinkInProgress = false;\n\t\tmod_timer(&pLed->BlinkTimer, jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tcase LED_CTL_TX:\n\tcase LED_CTL_RX:\n\t\tif (!pLed->bLedBlinkInProgress &&\n\t\t    check_fwstate(pmlmepriv, _FW_LINKED)) {\n\t\t\tif (IS_LED_WPS_BLINKING(pLed))\n\t\t\t\treturn;\n\t\t\tpLed->bLedBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_TXRX_BLINK;\n\t\t\tpLed->BlinkTimes = 2;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_FASTER_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_START_WPS:  \n\tcase LED_CTL_START_WPS_BOTTON:\n\t\tif (!pLed->bLedWPSBlinkInProgress) {\n\t\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t\t}\n\t\t\tpLed->bLedWPSBlinkInProgress = true;\n\t\t\tpLed->CurrLedState = LED_BLINK_WPS;\n\t\t\tif (pLed->bLedOn)\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\t\telse\n\t\t\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\t\tmod_timer(&pLed->BlinkTimer, jiffies +\n\t\t\t\t  msecs_to_jiffies(LED_BLINK_SCAN_INTERVAL_ALPHA));\n\t\t}\n\t\tbreak;\n\tcase LED_CTL_STOP_WPS_FAIL:\n\tcase LED_CTL_STOP_WPS:\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tpLed->CurrLedState = LED_STATE_ON;\n\t\tpLed->BlinkingLedState = LED_STATE_ON;\n\t\tmod_timer(&pLed->BlinkTimer,\n\t\t\t  jiffies + msecs_to_jiffies(0));\n\t\tbreak;\n\tcase LED_CTL_POWER_OFF:\n\t\tpLed->CurrLedState = LED_STATE_OFF;\n\t\tpLed->BlinkingLedState = LED_STATE_OFF;\n\t\tif (pLed->bLedBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedBlinkInProgress = false;\n\t\t}\n\t\tif (pLed->bLedWPSBlinkInProgress) {\n\t\t\tdel_timer(&pLed->BlinkTimer);\n\t\t\tpLed->bLedWPSBlinkInProgress = false;\n\t\t}\n\t\tSwLedOff(padapter, pLed);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\n \nvoid LedControl871x(struct _adapter *padapter, enum LED_CTL_MODE LedAction)\n{\n\tstruct led_priv\t*ledpriv = &padapter->ledpriv;\n\n\tif (!ledpriv->bRegUseLed)\n\t\treturn;\n\tswitch (ledpriv->LedStrategy) {\n\tcase SW_LED_MODE0:\n\t\tbreak;\n\tcase SW_LED_MODE1:\n\t\tSwLedControlMode1(padapter, LedAction);\n\t\tbreak;\n\tcase SW_LED_MODE2:\n\t\tSwLedControlMode2(padapter, LedAction);\n\t\tbreak;\n\tcase SW_LED_MODE3:\n\t\tSwLedControlMode3(padapter, LedAction);\n\t\tbreak;\n\tcase SW_LED_MODE4:\n\t\tSwLedControlMode4(padapter, LedAction);\n\t\tbreak;\n\tcase SW_LED_MODE5:\n\t\tSwLedControlMode5(padapter, LedAction);\n\t\tbreak;\n\tcase SW_LED_MODE6:\n\t\tSwLedControlMode6(padapter, LedAction);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nvoid r8712_flush_led_works(struct _adapter *padapter)\n{\n\tstruct led_priv *pledpriv = &padapter->ledpriv;\n\n\tflush_work(&pledpriv->SwLed0.BlinkWorkItem);\n\tflush_work(&pledpriv->SwLed1.BlinkWorkItem);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}