{
  "module_name": "rtl871x_ioctl_rtl.c",
  "hash_id": "c8227d5b036ad6ad71c288a685eeaaab6f5ac8802856efc40be782ef7400479c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8712/rtl871x_ioctl_rtl.c",
  "human_readable_source": "\n \n\n#define  _RTL871X_IOCTL_RTL_C_\n\n#include <linux/rndis.h>\n#include \"osdep_service.h\"\n#include \"drv_types.h\"\n#include \"wlan_bssdef.h\"\n#include \"wifi.h\"\n#include \"rtl871x_ioctl.h\"\n#include \"rtl871x_ioctl_set.h\"\n#include \"rtl871x_ioctl_rtl.h\"\n#include \"mp_custom_oid.h\"\n#include \"rtl871x_mp.h\"\n#include \"rtl871x_mp_ioctl.h\"\n\nuint oid_rt_get_signal_quality_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_small_packet_crc_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >=  sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\tpadapter->recvpriv.rx_smallpacket_crcerr;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_middle_packet_crc_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >=  sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\tpadapter->recvpriv.rx_middlepacket_crcerr;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_large_packet_crc_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >=  sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t padapter->recvpriv.rx_largepacket_crcerr;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_tx_retry_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_rx_retry_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_rx_total_packet_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >=  sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\t padapter->recvpriv.rx_pkts +\n\t\t\t\t\t padapter->recvpriv.rx_drop;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_tx_beacon_ok_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_tx_beacon_err_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_rx_icv_err_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >= sizeof(u32)) {\n\t\t*(uint *)poid_par_priv->information_buf =\n\t\t\t\t\t padapter->recvpriv.rx_icv_err;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_set_encryption_algorithm_hdl(struct oid_par_priv\n\t\t\t\t\t\t*poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_preamble_mode_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\tu32 preamblemode = 0;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >= sizeof(u32)) {\n\t\tif (padapter->registrypriv.preamble == PREAMBLE_LONG)\n\t\t\tpreamblemode = 0;\n\t\telse if (padapter->registrypriv.preamble == PREAMBLE_AUTO)\n\t\t\tpreamblemode = 1;\n\t\telse if (padapter->registrypriv.preamble == PREAMBLE_SHORT)\n\t\t\tpreamblemode = 2;\n\t\t*(u32 *)poid_par_priv->information_buf = preamblemode;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_ap_ip_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_channelplan_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\tstruct eeprom_priv *peeprompriv = &padapter->eeprompriv;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t*(u16 *)poid_par_priv->information_buf = peeprompriv->channel_plan;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_set_channelplan_hdl(struct oid_par_priv\n\t\t\t\t       *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\tstruct eeprom_priv *peeprompriv = &padapter->eeprompriv;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tpeeprompriv->channel_plan = *(u16 *)poid_par_priv->information_buf;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_set_preamble_mode_hdl(struct oid_par_priv\n\t\t\t\t\t *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\tu32 preamblemode = 0;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >= sizeof(u32)) {\n\t\tpreamblemode = *(u32 *)poid_par_priv->information_buf;\n\t\tif (preamblemode == 0)\n\t\t\tpadapter->registrypriv.preamble = PREAMBLE_LONG;\n\t\telse if (preamblemode == 1)\n\t\t\tpadapter->registrypriv.preamble = PREAMBLE_AUTO;\n\t\telse if (preamblemode == 2)\n\t\t\tpadapter->registrypriv.preamble = PREAMBLE_SHORT;\n\t\t*(u32 *)poid_par_priv->information_buf = preamblemode;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_set_bcn_intvl_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_dedicate_probe_hdl(struct oid_par_priv\n\t\t\t\t      *poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_total_tx_bytes_hdl(struct oid_par_priv\n\t\t\t\t\t  *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >= sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\t\t padapter->xmitpriv.tx_bytes;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_total_rx_bytes_hdl(struct oid_par_priv\n\t\t\t\t\t  *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >= sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\t   padapter->recvpriv.rx_bytes;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_current_tx_power_level_hdl(struct oid_par_priv\n\t\t\t\t\t      *poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_enc_key_mismatch_count_hdl(struct oid_par_priv\n\t\t\t\t\t\t  *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_enc_key_match_count_hdl(struct oid_par_priv\n\t\t\t\t\t       *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_channel_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\tstruct\tmlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct NDIS_802_11_CONFIGURATION *pnic_Config;\n\tu32   channelnum;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (check_fwstate(pmlmepriv, _FW_LINKED) ||\n\t    check_fwstate(pmlmepriv, WIFI_ADHOC_MASTER_STATE))\n\t\tpnic_Config = &pmlmepriv->cur_network.network.Configuration;\n\telse\n\t\tpnic_Config = &padapter->registrypriv.dev_network.Configuration;\n\tchannelnum = pnic_Config->DSConfig;\n\t*(u32 *)poid_par_priv->information_buf = channelnum;\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_hardware_radio_off_hdl(struct oid_par_priv\n\t\t\t *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_key_mismatch_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_supported_wireless_mode_hdl(struct oid_par_priv\n\t\t\t\t\t       *poid_par_priv)\n{\n\tu32 ulInfo = 0;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len >= sizeof(u32)) {\n\t\tulInfo |= 0x0100;  \n\t\tulInfo |= 0x0200;  \n\t\tulInfo |= 0x0400;  \n\t\t*(u32 *) poid_par_priv->information_buf = ulInfo;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_channel_list_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_scan_in_progress_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_forced_data_rate_hdl(struct oid_par_priv *poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_wireless_mode_for_scan_list_hdl(struct oid_par_priv\n\t\t\t\t\t\t   *poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_bss_wireless_mode_hdl(struct oid_par_priv\n\t\t\t\t\t     *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_scan_with_magic_packet_hdl(struct oid_par_priv\n\t\t\t\t\t      *poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_ap_get_associated_station_list_hdl(struct oid_par_priv\n\t\t\t\t\t\t      *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_ap_switch_into_ap_mode_hdl(struct oid_par_priv*\n\t\t\t\t\t      poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_ap_supported_hdl(struct oid_par_priv *poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_ap_set_passphrase_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_rf_write_registry_hdl(struct oid_par_priv*\n\t\t\t\t\t     poid_par_priv)\n{\n\tuint status = RNDIS_STATUS_SUCCESS;\n\tstruct _adapter *Adapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)  \n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len ==\n\t   (sizeof(unsigned long) * 3)) {\n\t\tif (r8712_setrfreg_cmd(Adapter,\n\t\t\t*(unsigned char *)poid_par_priv->information_buf,\n\t\t\t(unsigned long)(*((unsigned long *)\n\t\t\t\t\tpoid_par_priv->information_buf + 2))))\n\t\t\tstatus = RNDIS_STATUS_NOT_ACCEPTED;\n\t} else {\n\t\tstatus = RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn status;\n}\n\nuint oid_rt_pro_rf_read_registry_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tuint status = RNDIS_STATUS_SUCCESS;\n\tstruct _adapter *Adapter = poid_par_priv->adapter_context;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)  \n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len == (sizeof(unsigned long) *\n\t\t\t\t\t\t   3)) {\n\t\tif (Adapter->mppriv.act_in_progress) {\n\t\t\tstatus = RNDIS_STATUS_NOT_ACCEPTED;\n\t\t} else {\n\t\t\t \n\t\t\tAdapter->mppriv.act_in_progress = true;\n\t\t\tAdapter->mppriv.workparam.bcompleted = false;\n\t\t\tAdapter->mppriv.workparam.act_type = MPT_READ_RF;\n\t\t\tAdapter->mppriv.workparam.io_offset = *(unsigned long *)\n\t\t\t\t\t\tpoid_par_priv->information_buf;\n\t\t\tAdapter->mppriv.workparam.io_value = 0xcccccccc;\n\n\t\t \n\t\t\tif (r8712_getrfreg_cmd(Adapter,\n\t\t\t    *(unsigned char *)poid_par_priv->information_buf,\n\t\t\t    (unsigned char *)&Adapter->mppriv.workparam.io_value\n\t\t\t    ))\n\t\t\t\tstatus = RNDIS_STATUS_NOT_ACCEPTED;\n\t\t}\n\t} else {\n\t\tstatus = RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn status;\n}\n\nenum _CONNECT_STATE_ {\n\tCHECKINGSTATUS,\n\tASSOCIATED,\n\tADHOCMODE,\n\tNOTASSOCIATED\n};\n\nuint oid_rt_get_connect_state_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *padapter = poid_par_priv->adapter_context;\n\tstruct mlme_priv *pmlmepriv = &(padapter->mlmepriv);\n\tu32 ulInfo;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\t \n\tif (check_fwstate(pmlmepriv, _FW_UNDER_LINKING))\n\t\tulInfo = CHECKINGSTATUS;\n\telse if (check_fwstate(pmlmepriv, _FW_LINKED))\n\t\tulInfo = ASSOCIATED;\n\telse if (check_fwstate(pmlmepriv, WIFI_ADHOC_STATE))\n\t\tulInfo = ADHOCMODE;\n\telse\n\t\tulInfo = NOTASSOCIATED;\n\t*(u32 *)poid_par_priv->information_buf = ulInfo;\n\t*poid_par_priv->bytes_rw =  poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_set_default_key_id_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}