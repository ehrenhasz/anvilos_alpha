{
  "module_name": "rtl871x_mp_ioctl.c",
  "hash_id": "bbb3ac20fb405e416cd4df8f425b9a3819e614554b02ae14bb1065e19f4bd913",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8712/rtl871x_mp_ioctl.c",
  "human_readable_source": "\n \n\n#include <linux/rndis.h>\n#include \"osdep_service.h\"\n#include \"drv_types.h\"\n#include \"mlme_osdep.h\"\n#include \"rtl871x_mp.h\"\n#include \"rtl871x_mp_ioctl.h\"\n\nuint oid_null_function(struct oid_par_priv *poid_par_priv)\n{\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_wireless_mode_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tuint status = RNDIS_STATUS_SUCCESS;\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid == SET_OID) {\n\t\tif (poid_par_priv->information_buf_len >= sizeof(u8))\n\t\t\tAdapter->registrypriv.wireless_mode =\n\t\t\t\t\t*(u8 *)poid_par_priv->information_buf;\n\t\telse\n\t\t\tstatus = RNDIS_STATUS_INVALID_LENGTH;\n\t} else if (poid_par_priv->type_of_oid == QUERY_OID) {\n\t\tif (poid_par_priv->information_buf_len >= sizeof(u8)) {\n\t\t\t*(u8 *)poid_par_priv->information_buf =\n\t\t\t\t\t Adapter->registrypriv.wireless_mode;\n\t\t\t*poid_par_priv->bytes_rw =\n\t\t\t\t\tpoid_par_priv->information_buf_len;\n\t\t} else {\n\t\t\tstatus = RNDIS_STATUS_INVALID_LENGTH;\n\t\t}\n\t} else {\n\t\tstatus = RNDIS_STATUS_NOT_ACCEPTED;\n\t}\n\treturn status;\n}\n\nuint oid_rt_pro_write_bb_reg_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tstruct bb_reg_param *pbbreg;\n\tu16 offset;\n\tu32 value;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(struct bb_reg_param))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tpbbreg = (struct bb_reg_param *)(poid_par_priv->information_buf);\n\toffset = (u16)(pbbreg->offset) & 0xFFF;  \n\tif (offset < BB_REG_BASE_ADDR)\n\t\toffset |= BB_REG_BASE_ADDR;\n\tvalue = pbbreg->value;\n\tr8712_bb_reg_write(Adapter, offset, value);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_read_bb_reg_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tstruct bb_reg_param *pbbreg;\n\tu16 offset;\n\tu32 value;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(struct bb_reg_param))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tpbbreg = (struct bb_reg_param *)(poid_par_priv->information_buf);\n\toffset = (u16)(pbbreg->offset) & 0xFFF;  \n\tif (offset < BB_REG_BASE_ADDR)\n\t\toffset |= BB_REG_BASE_ADDR;\n\tvalue = r8712_bb_reg_read(Adapter, offset);\n\tpbbreg->value = value;\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_write_rf_reg_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tstruct rf_reg_param *pbbreg;\n\tu8 path;\n\tu8 offset;\n\tu32 value;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(struct rf_reg_param))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tpbbreg = (struct rf_reg_param *)(poid_par_priv->information_buf);\n\tpath = (u8)pbbreg->path;\n\tif (path > RF_PATH_B)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\toffset = (u8)pbbreg->offset;\n\tvalue = pbbreg->value;\n\tr8712_rf_reg_write(Adapter, path, offset, value);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_read_rf_reg_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tstruct rf_reg_param *pbbreg;\n\tu8 path;\n\tu8 offset;\n\tu32 value;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(struct rf_reg_param))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tpbbreg = (struct rf_reg_param *)(poid_par_priv->information_buf);\n\tpath = (u8)pbbreg->path;\n\tif (path > RF_PATH_B)  \n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\toffset = (u8)pbbreg->offset;\n\tvalue = r8712_rf_reg_read(Adapter, path, offset);\n\tpbbreg->value = value;\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\n \nstatic int mp_start_test(struct _adapter *padapter)\n{\n\tstruct mp_priv *pmppriv = &padapter->mppriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct wlan_network *tgt_network = &pmlmepriv->cur_network;\n\tstruct wlan_bssid_ex *bssid;\n\tstruct sta_info *psta;\n\tunsigned long length;\n\tunsigned long irqL;\n\tint res = 0;\n\n\tbssid = kzalloc(sizeof(*bssid), GFP_KERNEL);\n\tif (!bssid)\n\t\treturn -ENOMEM;\n\n\t \n\tmemcpy(bssid->MacAddress, pmppriv->network_macaddr, ETH_ALEN);\n\tbssid->Ssid.SsidLength = 16;\n\tmemcpy(bssid->Ssid.Ssid, (unsigned char *)\"mp_pseudo_adhoc\",\n\t\tbssid->Ssid.SsidLength);\n\tbssid->InfrastructureMode = Ndis802_11IBSS;\n\tbssid->NetworkTypeInUse = Ndis802_11DS;\n\tbssid->IELength = 0;\n\tlength = r8712_get_wlan_bssid_ex_sz(bssid);\n\tif (length % 4) {\n\t\t \n\t\tbssid->Length = ((length >> 2) + 1) << 2;\n\t} else {\n\t\tbssid->Length = length;\n\t}\n\tspin_lock_irqsave(&pmlmepriv->lock, irqL);\n\tif (check_fwstate(pmlmepriv, WIFI_MP_STATE))\n\t\tgoto end_of_mp_start_test;\n\t \n\tpmppriv->prev_fw_state = get_fwstate(pmlmepriv);\n\tpmlmepriv->fw_state = WIFI_MP_STATE;\n\tif (pmppriv->mode == _LOOPBOOK_MODE_)\n\t\tset_fwstate(pmlmepriv, WIFI_MP_LPBK_STATE);  \n\tset_fwstate(pmlmepriv, _FW_UNDER_LINKING);\n\t \n\t \n\tpsta = r8712_get_stainfo(&padapter->stapriv,\n\t\t\t\t tgt_network->network.MacAddress);\n\tif (psta)\n\t\tr8712_free_stainfo(padapter, psta);\n\tpsta = r8712_alloc_stainfo(&padapter->stapriv, bssid->MacAddress);\n\tif (!psta) {\n\t\tres = -ENOMEM;\n\t\tgoto end_of_mp_start_test;\n\t}\n\t \n\ttgt_network->join_res = 1;\n\ttgt_network->aid = psta->aid = 1;\n\tmemcpy(&tgt_network->network, bssid, length);\n\t_clr_fwstate_(pmlmepriv, _FW_UNDER_LINKING);\n\tr8712_os_indicate_connect(padapter);\n\t \n\tset_fwstate(pmlmepriv, _FW_LINKED);\nend_of_mp_start_test:\n\tspin_unlock_irqrestore(&pmlmepriv->lock, irqL);\n\tkfree(bssid);\n\treturn res;\n}\n\n \nstatic int mp_stop_test(struct _adapter *padapter)\n{\n\tstruct mp_priv *pmppriv = &padapter->mppriv;\n\tstruct mlme_priv *pmlmepriv = &padapter->mlmepriv;\n\tstruct wlan_network *tgt_network = &pmlmepriv->cur_network;\n\tstruct sta_info *psta;\n\tunsigned long irqL;\n\n\tspin_lock_irqsave(&pmlmepriv->lock, irqL);\n\tif (!check_fwstate(pmlmepriv, WIFI_MP_STATE))\n\t\tgoto end_of_mp_stop_test;\n\t \n\tr8712_os_indicate_disconnect(padapter);\n\t \n\tpsta = r8712_get_stainfo(&padapter->stapriv,\n\t\t\t\t tgt_network->network.MacAddress);\n\tif (psta)\n\t\tr8712_free_stainfo(padapter, psta);\n\t \n\tpmlmepriv->fw_state = pmppriv->prev_fw_state;  \n\t \n\tmemset(tgt_network, 0, sizeof(struct wlan_network));\nend_of_mp_stop_test:\n\tspin_unlock_irqrestore(&pmlmepriv->lock, irqL);\n\treturn _SUCCESS;\n}\n\nuint oid_rt_pro_set_data_rate_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32 ratevalue;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len != sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tratevalue = *((u32 *)poid_par_priv->information_buf);\n\tif (ratevalue >= MPT_RATE_LAST)\n\t\treturn RNDIS_STATUS_INVALID_DATA;\n\tAdapter->mppriv.curr_rateidx = ratevalue;\n\tr8712_SetDataRate(Adapter);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_start_test_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tuint status = RNDIS_STATUS_SUCCESS;\n\tu32 mode;\n\tu8 val8;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn  RNDIS_STATUS_NOT_ACCEPTED;\n\tmode = *((u32 *)poid_par_priv->information_buf);\n\tAdapter->mppriv.mode = mode; \n\tif (mp_start_test(Adapter))\n\t\tstatus = RNDIS_STATUS_NOT_ACCEPTED;\n\tr8712_write8(Adapter, MSR, 1);  \n\tr8712_write8(Adapter, RCR, 0);  \n\t \n\tr8712_write8(Adapter, RCR + 2, 0x57);\n\t \n\tr8712_write16(Adapter, RXFLTMAP0, 0x0);\n\tval8 = r8712_read8(Adapter, EE_9346CR);\n\tif (!(val8 & _9356SEL)) {  \n\t\tr8712_efuse_reg_init(Adapter);\n\t\tr8712_efuse_change_max_size(Adapter);\n\t\tr8712_efuse_reg_uninit(Adapter);\n\t}\n\treturn status;\n}\n\nuint oid_rt_pro_stop_test_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (mp_stop_test(Adapter) == _FAIL)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_channel_direct_call_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32\t\tChannel;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len != sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tChannel = *((u32 *)poid_par_priv->information_buf);\n\tif (Channel > 14)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tAdapter->mppriv.curr_ch = Channel;\n\tr8712_SetChannel(Adapter);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_antenna_bb_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32 antenna;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len != sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tantenna = *((u32 *)poid_par_priv->information_buf);\n\tAdapter->mppriv.antenna_tx = (u16)((antenna & 0xFFFF0000) >> 16);\n\tAdapter->mppriv.antenna_rx = (u16)(antenna & 0x0000FFFF);\n\tr8712_SwitchAntenna(Adapter);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_tx_power_control_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32 tx_pwr_idx;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len != sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\ttx_pwr_idx = *((u32 *)poid_par_priv->information_buf);\n\tif (tx_pwr_idx > MAX_TX_PWR_INDEX_N_MODE)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tAdapter->mppriv.curr_txpoweridx = (u8)tx_pwr_idx;\n\tr8712_SetTxPower(Adapter);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_query_tx_packet_sent_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\n\tif (poid_par_priv->information_buf_len == sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\tAdapter->mppriv.tx_pktcount;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_query_rx_packet_received_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\n\tif (poid_par_priv->information_buf_len == sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\tAdapter->mppriv.rx_pktcount;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_query_rx_packet_crc32_error_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\n\tif (poid_par_priv->information_buf_len == sizeof(u32)) {\n\t\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\tAdapter->mppriv.rx_crcerrpktcount;\n\t\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_reset_tx_packet_sent_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tAdapter->mppriv.tx_pktcount = 0;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_reset_rx_packet_received_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len == sizeof(u32)) {\n\t\tAdapter->mppriv.rx_pktcount = 0;\n\t\tAdapter->mppriv.rx_crcerrpktcount = 0;\n\t} else {\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t}\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_reset_phy_rx_packet_count_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tr8712_ResetPhyRxPktCount(Adapter);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_phy_rx_packet_received_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len != sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\t r8712_GetPhyRxPktReceived(Adapter);\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_phy_rx_packet_crc32_error_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len != sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t\t r8712_GetPhyRxPktCRC32Error(Adapter);\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_modulation_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\n\tAdapter->mppriv.curr_modem = *((u8 *)poid_par_priv->information_buf);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_continuous_tx_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32\t\tbStartTest;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tbStartTest = *((u32 *)poid_par_priv->information_buf);\n\tr8712_SetContinuousTx(Adapter, (u8)bStartTest);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_single_carrier_tx_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32\t\tbStartTest;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tbStartTest = *((u32 *)poid_par_priv->information_buf);\n\tr8712_SetSingleCarrierTx(Adapter, (u8)bStartTest);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_carrier_suppression_tx_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32\t\tbStartTest;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tbStartTest = *((u32 *)poid_par_priv->information_buf);\n\tr8712_SetCarrierSuppressionTx(Adapter, (u8)bStartTest);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_set_single_tone_tx_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32\t\tbStartTest;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tbStartTest = *((u32 *)poid_par_priv->information_buf);\n\tr8712_SetSingleToneTx(Adapter, (u8)bStartTest);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_read_register_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tuint status = RNDIS_STATUS_SUCCESS;\n\tstruct mp_rw_reg *RegRWStruct;\n\tu16\t\toffset;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tRegRWStruct = (struct mp_rw_reg *)poid_par_priv->information_buf;\n\tif ((RegRWStruct->offset >= 0x10250800) &&\n\t    (RegRWStruct->offset <= 0x10250FFF)) {\n\t\t \n\t\t \n\t\toffset = (u16)(RegRWStruct->offset) & 0xFFF;\n\t\tRegRWStruct->value = r8712_bb_reg_read(Adapter, offset);\n\t} else {\n\t\tswitch (RegRWStruct->width) {\n\t\tcase 1:\n\t\t\tRegRWStruct->value = r8712_read8(Adapter,\n\t\t\t\t\t\t   RegRWStruct->offset);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tRegRWStruct->value = r8712_read16(Adapter,\n\t\t\t\t\t\t    RegRWStruct->offset);\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tRegRWStruct->value = r8712_read32(Adapter,\n\t\t\t\t\t\t    RegRWStruct->offset);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tstatus = RNDIS_STATUS_NOT_ACCEPTED;\n\t\t\tbreak;\n\t\t}\n\t}\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn status;\n}\n\nuint oid_rt_pro_write_register_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tuint status = RNDIS_STATUS_SUCCESS;\n\tstruct mp_rw_reg *RegRWStruct;\n\tu16\t\toffset;\n\tu32\t\tvalue;\n\tu32 oldValue = 0;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tRegRWStruct = (struct mp_rw_reg *)poid_par_priv->information_buf;\n\tif ((RegRWStruct->offset >= 0x10250800) &&\n\t    (RegRWStruct->offset <= 0x10250FFF)) {\n\t\t \n\t\toffset = (u16)(RegRWStruct->offset) & 0xFFF;\n\t\tvalue = RegRWStruct->value;\n\t\tswitch (RegRWStruct->width) {\n\t\tcase 1:\n\t\t\toldValue = r8712_bb_reg_read(Adapter, offset);\n\t\t\toldValue &= 0xFFFFFF00;\n\t\t\tvalue &= 0x000000FF;\n\t\t\tvalue |= oldValue;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\toldValue = r8712_bb_reg_read(Adapter, offset);\n\t\t\toldValue &= 0xFFFF0000;\n\t\t\tvalue &= 0x0000FFFF;\n\t\t\tvalue |= oldValue;\n\t\t\tbreak;\n\t\t}\n\t\tr8712_bb_reg_write(Adapter, offset, value);\n\t} else {\n\t\tswitch (RegRWStruct->width) {\n\t\tcase 1:\n\t\t\tr8712_write8(Adapter, RegRWStruct->offset,\n\t\t\t       (unsigned char)RegRWStruct->value);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tr8712_write16(Adapter, RegRWStruct->offset,\n\t\t\t\t(unsigned short)RegRWStruct->value);\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tr8712_write32(Adapter, RegRWStruct->offset,\n\t\t\t\t(unsigned int)RegRWStruct->value);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tstatus = RNDIS_STATUS_NOT_ACCEPTED;\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn status;\n}\n\nuint oid_rt_get_thermal_meter_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\n\tif (Adapter->mppriv.act_in_progress)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\n\tif (poid_par_priv->information_buf_len < sizeof(u8))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t \n\tAdapter->mppriv.act_in_progress = true;\n\tAdapter->mppriv.workparam.bcompleted = false;\n\tAdapter->mppriv.workparam.act_type = MPT_GET_THERMAL_METER;\n\tAdapter->mppriv.workparam.io_offset = 0;\n\tAdapter->mppriv.workparam.io_value = 0xFFFFFFFF;\n\tr8712_GetThermalMeter(Adapter, &Adapter->mppriv.workparam.io_value);\n\tAdapter->mppriv.workparam.bcompleted = true;\n\tAdapter->mppriv.act_in_progress = false;\n\t*(u32 *)poid_par_priv->information_buf =\n\t\t\t\t Adapter->mppriv.workparam.io_value;\n\t*poid_par_priv->bytes_rw = sizeof(u32);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_read_efuse_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tuint status = RNDIS_STATUS_SUCCESS;\n\n\tstruct EFUSE_ACCESS_STRUCT *pefuse;\n\tu8 *data;\n\tu16 addr = 0, cnts = 0;\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len <\n\t    sizeof(struct EFUSE_ACCESS_STRUCT))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tpefuse = (struct EFUSE_ACCESS_STRUCT *)poid_par_priv->information_buf;\n\taddr = pefuse->start_addr;\n\tcnts = pefuse->cnts;\n\tdata = pefuse->data;\n\tmemset(data, 0xFF, cnts);\n\tif ((addr > 511) || (cnts < 1) || (cnts > 512) || (addr + cnts) >\n\t     EFUSE_MAX_SIZE)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (!r8712_efuse_access(Adapter, true, addr, cnts, data))\n\t\tstatus = RNDIS_STATUS_FAILURE;\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn status;\n}\n\n \nuint oid_rt_pro_write_efuse_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tuint status = RNDIS_STATUS_SUCCESS;\n\n\tstruct EFUSE_ACCESS_STRUCT *pefuse;\n\tu8 *data;\n\tu16 addr = 0, cnts = 0;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\n\tpefuse = (struct EFUSE_ACCESS_STRUCT *)poid_par_priv->information_buf;\n\taddr = pefuse->start_addr;\n\tcnts = pefuse->cnts;\n\tdata = pefuse->data;\n\n\tif ((addr > 511) || (cnts < 1) || (cnts > 512) ||\n\t    (addr + cnts) > r8712_efuse_get_max_size(Adapter))\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (!r8712_efuse_access(Adapter, false, addr, cnts, data))\n\t\tstatus = RNDIS_STATUS_FAILURE;\n\treturn status;\n}\n\n \n\nuint oid_rt_get_efuse_current_size_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(int))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tr8712_efuse_reg_init(Adapter);\n\t*(int *)poid_par_priv->information_buf =\n\t\t\t\t r8712_efuse_get_current_size(Adapter);\n\tr8712_efuse_reg_uninit(Adapter);\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_get_efuse_max_size_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t*(int *)poid_par_priv->information_buf =\n\t\t\t\t\t r8712_efuse_get_max_size(Adapter);\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_pro_efuse_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tuint status = RNDIS_STATUS_SUCCESS;\n\n\tif (poid_par_priv->type_of_oid == QUERY_OID)\n\t\tstatus = oid_rt_pro_read_efuse_hdl(poid_par_priv);\n\telse\n\t\tstatus = oid_rt_pro_write_efuse_hdl(poid_par_priv);\n\treturn status;\n}\n\nuint oid_rt_pro_efuse_map_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tuint status = RNDIS_STATUS_SUCCESS;\n\tu8\t\t*data;\n\n\t*poid_par_priv->bytes_rw = 0;\n\tif (poid_par_priv->information_buf_len < EFUSE_MAP_MAX_SIZE)\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tdata = (u8 *)poid_par_priv->information_buf;\n\tif (poid_par_priv->type_of_oid == QUERY_OID) {\n\t\tif (r8712_efuse_map_read(Adapter, 0, EFUSE_MAP_MAX_SIZE, data))\n\t\t\t*poid_par_priv->bytes_rw = EFUSE_MAP_MAX_SIZE;\n\t\telse\n\t\t\tstatus = RNDIS_STATUS_FAILURE;\n\t} else {\n\t\t \n\t\tif (r8712_efuse_reg_init(Adapter)) {\n\t\t\tif (r8712_efuse_map_write(Adapter, 0,\n\t\t\t    EFUSE_MAP_MAX_SIZE, data))\n\t\t\t\t*poid_par_priv->bytes_rw = EFUSE_MAP_MAX_SIZE;\n\t\t\telse\n\t\t\t\tstatus = RNDIS_STATUS_FAILURE;\n\t\t\tr8712_efuse_reg_uninit(Adapter);\n\t\t} else {\n\t\t\tstatus = RNDIS_STATUS_FAILURE;\n\t\t}\n\t}\n\treturn status;\n}\n\nuint oid_rt_set_bandwidth_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu32\t\tbandwidth;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\tbandwidth = *((u32 *)poid_par_priv->information_buf); \n\tif (bandwidth != HT_CHANNEL_WIDTH_20)\n\t\tbandwidth = HT_CHANNEL_WIDTH_40;\n\tAdapter->mppriv.curr_bandwidth = (u8)bandwidth;\n\tr8712_SwitchBandwidth(Adapter);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\nuint oid_rt_set_rx_packet_type_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\tu8\t\trx_pkt_type;\n\tu32\t\trcr_val32;\n\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(u8))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\trx_pkt_type = *((u8 *)poid_par_priv->information_buf); \n\trcr_val32 = r8712_read32(Adapter, RCR); \n\trcr_val32 &= ~(RCR_CBSSID | RCR_AB | RCR_AM | RCR_APM | RCR_AAP);\n\tswitch (rx_pkt_type) {\n\tcase RX_PKT_BROADCAST:\n\t\trcr_val32 |= (RCR_AB | RCR_AM | RCR_APM | RCR_AAP | RCR_ACRC32);\n\t\tbreak;\n\tcase RX_PKT_DEST_ADDR:\n\t\trcr_val32 |= (RCR_AB | RCR_AM | RCR_APM | RCR_AAP | RCR_ACRC32);\n\t\tbreak;\n\tcase RX_PKT_PHY_MATCH:\n\t\trcr_val32 |= (RCR_APM | RCR_ACRC32);\n\t\tbreak;\n\tdefault:\n\t\trcr_val32 &= ~(RCR_AAP |\n\t\t\t       RCR_APM |\n\t\t\t       RCR_AM |\n\t\t\t       RCR_AB |\n\t\t\t       RCR_ACRC32);\n\t\tbreak;\n\t}\n\tif (rx_pkt_type == RX_PKT_DEST_ADDR)\n\t\tAdapter->mppriv.check_mp_pkt = 1;\n\telse\n\t\tAdapter->mppriv.check_mp_pkt = 0;\n\tr8712_write32(Adapter, RCR, rcr_val32);\n\treturn RNDIS_STATUS_SUCCESS;\n}\n\n \n \nunsigned int mp_ioctl_xmit_packet_hdl(struct oid_par_priv *poid_par_priv)\n{\n\treturn _SUCCESS;\n}\n\n \nuint oid_rt_set_power_down_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tif (poid_par_priv->type_of_oid != SET_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\t \n\treturn RNDIS_STATUS_SUCCESS;\n}\n\n \nuint oid_rt_get_power_mode_hdl(struct oid_par_priv *poid_par_priv)\n{\n\tstruct _adapter *Adapter = (struct _adapter *)\n\t\t\t\t   (poid_par_priv->adapter_context);\n\n\tif (poid_par_priv->type_of_oid != QUERY_OID)\n\t\treturn RNDIS_STATUS_NOT_ACCEPTED;\n\tif (poid_par_priv->information_buf_len < sizeof(u32))\n\t\treturn RNDIS_STATUS_INVALID_LENGTH;\n\t*(int *)poid_par_priv->information_buf =\n\t\t Adapter->registrypriv.low_power ? POWER_LOW : POWER_NORMAL;\n\t*poid_par_priv->bytes_rw = poid_par_priv->information_buf_len;\n\treturn RNDIS_STATUS_SUCCESS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}