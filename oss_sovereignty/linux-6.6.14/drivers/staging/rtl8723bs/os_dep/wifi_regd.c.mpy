{
  "module_name": "wifi_regd.c",
  "hash_id": "051183e0f4d37a93672b88733d1208c81c038b80839831f1e59f2ae5a984589d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8723bs/os_dep/wifi_regd.c",
  "human_readable_source": "\n \n\n#include <drv_types.h>\n#include <rtw_debug.h>\n\n#include <rtw_wifi_regd.h>\n\n \n\n \n\n \n#define RTW_2GHZ_CH01_11\t\\\n\tREG_RULE(2412 - 10, 2462 + 10, 40, 0, 20, 0)\n\n \n\n \n#define RTW_2GHZ_CH12_13\t\\\n\tREG_RULE(2467 - 10, 2472 + 10, 40, 0, 20,\t\\\n\tNL80211_RRF_PASSIVE_SCAN)\n\nstatic const struct ieee80211_regdomain rtw_regdom_rd = {\n\t.n_reg_rules = 2,\n\t.alpha2 = \"99\",\n\t.reg_rules = {\n\t\tRTW_2GHZ_CH01_11,\n\t\tRTW_2GHZ_CH12_13,\n\t}\n};\n\nstatic int rtw_ieee80211_channel_to_frequency(int chan, int band)\n{\n\t \n\tif (chan == 14)\n\t\treturn 2484;\n\telse if (chan < 14)\n\t\treturn 2407 + chan * 5;\n\telse\n\t\treturn 0;\t \n}\n\nstatic void _rtw_reg_apply_flags(struct wiphy *wiphy)\n{\n\tstruct adapter *padapter = wiphy_to_adapter(wiphy);\n\tstruct mlme_ext_priv *pmlmeext = &padapter->mlmeextpriv;\n\tstruct rt_channel_info *channel_set = pmlmeext->channel_set;\n\tu8 max_chan_nums = pmlmeext->max_chan_nums;\n\n\tstruct ieee80211_supported_band *sband;\n\tstruct ieee80211_channel *ch;\n\tunsigned int i, j;\n\tu16 channel;\n\tu32 freq;\n\n\t \n\tfor (i = 0; i < NUM_NL80211_BANDS; i++) {\n\t\tsband = wiphy->bands[i];\n\n\t\tif (sband) {\n\t\t\tfor (j = 0; j < sband->n_channels; j++) {\n\t\t\t\tch = &sband->channels[j];\n\n\t\t\t\tif (ch)\n\t\t\t\t\tch->flags = IEEE80211_CHAN_DISABLED;\n\t\t\t}\n\t\t}\n\t}\n\n\t \n\tfor (i = 0; i < max_chan_nums; i++) {\n\t\tchannel = channel_set[i].ChannelNum;\n\t\tfreq =\n\t\t    rtw_ieee80211_channel_to_frequency(channel,\n\t\t\t\t\t\t       NL80211_BAND_2GHZ);\n\n\t\tch = ieee80211_get_channel(wiphy, freq);\n\t\tif (ch) {\n\t\t\tif (channel_set[i].ScanType == SCAN_PASSIVE)\n\t\t\t\tch->flags = IEEE80211_CHAN_NO_IR;\n\t\t\telse\n\t\t\t\tch->flags = 0;\n\t\t}\n\t}\n}\n\nstatic int _rtw_reg_notifier_apply(struct wiphy *wiphy,\n\t\t\t\t   struct regulatory_request *request,\n\t\t\t\t   struct rtw_regulatory *reg)\n{\n\t \n\t_rtw_reg_apply_flags(wiphy);\n\treturn 0;\n}\n\nstatic const struct ieee80211_regdomain *_rtw_regdomain_select(struct\n\t\t\t\t\t\t\t       rtw_regulatory\n\t\t\t\t\t\t\t       *reg)\n{\n\treturn &rtw_regdom_rd;\n}\n\nstatic void _rtw_regd_init_wiphy(struct rtw_regulatory *reg,\n\t\t\t\t struct wiphy *wiphy,\n\t\t\t\t void (*reg_notifier)(struct wiphy *wiphy,\n\t\t\t\t\t\t      struct\n\t\t\t\t\t\t      regulatory_request *\n\t\t\t\t\t\t      request))\n{\n\tconst struct ieee80211_regdomain *regd;\n\n\twiphy->reg_notifier = reg_notifier;\n\n\twiphy->regulatory_flags |= REGULATORY_CUSTOM_REG;\n\twiphy->regulatory_flags &= ~REGULATORY_STRICT_REG;\n\twiphy->regulatory_flags &= ~REGULATORY_DISABLE_BEACON_HINTS;\n\n\tregd = _rtw_regdomain_select(reg);\n\twiphy_apply_custom_regulatory(wiphy, regd);\n\n\t \n\t_rtw_reg_apply_flags(wiphy);\n}\n\nvoid rtw_regd_init(struct wiphy *wiphy,\n\t\t   void (*reg_notifier)(struct wiphy *wiphy,\n\t\t\t\t\tstruct regulatory_request *request))\n{\n\t_rtw_regd_init_wiphy(NULL, wiphy, reg_notifier);\n}\n\nvoid rtw_reg_notifier(struct wiphy *wiphy, struct regulatory_request *request)\n{\n\tstruct rtw_regulatory *reg = NULL;\n\n\t_rtw_reg_notifier_apply(wiphy, request, reg);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}