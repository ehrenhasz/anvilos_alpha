{
  "module_name": "odm_EdcaTurboCheck.c",
  "hash_id": "961787363e744de3d2929ba68694afe59f95c408e7edcb1d751d36af96832d41",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8723bs/hal/odm_EdcaTurboCheck.c",
  "human_readable_source": "\n \n\n#include \"odm_precomp.h\"\n\nstatic u32 edca_setting_DL_GMode[HT_IOT_PEER_MAX] = {\n \n\t0x4322, 0xa44f, 0x5e4322, 0xa42b, 0x5e4322, 0x4322,\n\t0xa42b, 0x5ea42b, 0xa44f, 0x5e4322, 0x5ea42b\n};\n\nstatic u32 edca_setting_UL[HT_IOT_PEER_MAX] = {\n \n\t0x5e4322, 0xa44f, 0x5e4322, 0x5ea32b, 0x5ea422,\t0x5ea322,\n\t0x3ea430, 0x5ea42b, 0x5ea44f, 0x5e4322, 0x5e4322};\n\nstatic u32 edca_setting_DL[HT_IOT_PEER_MAX] = {\n \n\t0xa44f, 0x5ea44f, 0x5e4322, 0x5ea42b, 0xa44f, 0xa630,\n\t0x5ea630, 0x5ea42b, 0xa44f, 0xa42b, 0xa42b};\n\nvoid ODM_EdcaTurboInit(void *pDM_VOID)\n{\n\tstruct dm_odm_t *pDM_Odm = (struct dm_odm_t *)pDM_VOID;\n\tstruct adapter *Adapter = pDM_Odm->Adapter;\n\n\tpDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA = false;\n\tpDM_Odm->DM_EDCA_Table.bIsCurRDLState = false;\n\tAdapter->recvpriv.bIsAnyNonBEPkts = false;\n}\t \n\nvoid odm_EdcaTurboCheck(void *pDM_VOID)\n{\n\t \n\tstruct dm_odm_t *pDM_Odm = (struct dm_odm_t *)pDM_VOID;\n\n\tif (!(pDM_Odm->SupportAbility & ODM_MAC_EDCA_TURBO))\n\t\treturn;\n\n\todm_EdcaTurboCheckCE(pDM_Odm);\n}\t \n\nvoid odm_EdcaTurboCheckCE(void *pDM_VOID)\n{\n\tstruct dm_odm_t *pDM_Odm = (struct dm_odm_t *)pDM_VOID;\n\tstruct adapter *Adapter = pDM_Odm->Adapter;\n\tstruct dvobj_priv *pdvobjpriv = adapter_to_dvobj(Adapter);\n\tstruct recv_priv *precvpriv = &(Adapter->recvpriv);\n\tstruct registry_priv *pregpriv = &Adapter->registrypriv;\n\tstruct mlme_ext_priv *pmlmeext = &(Adapter->mlmeextpriv);\n\tstruct mlme_ext_info *pmlmeinfo = &(pmlmeext->mlmext_info);\n\tu32 EDCA_BE_UL = 0x5ea42b;\n\tu32 EDCA_BE_DL = 0x5ea42b;\n\tu32 iot_peer = 0;\n\tu8 wirelessmode = 0xFF;\t\t \n\tu32 trafficIndex;\n\tu32 edca_param;\n\tu64\tcur_tx_bytes = 0;\n\tu64\tcur_rx_bytes = 0;\n\tu8 bbtchange = false;\n\tu8 biasonrx = false;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(Adapter);\n\n\tif (!pDM_Odm->bLinked) {\n\t\tprecvpriv->bIsAnyNonBEPkts = false;\n\t\treturn;\n\t}\n\n\tif (pregpriv->wifi_spec == 1) {\n\t\tprecvpriv->bIsAnyNonBEPkts = false;\n\t\treturn;\n\t}\n\n\tif (pDM_Odm->pwirelessmode)\n\t\twirelessmode = *(pDM_Odm->pwirelessmode);\n\n\tiot_peer = pmlmeinfo->assoc_AP_vendor;\n\n\tif (iot_peer >=  HT_IOT_PEER_MAX) {\n\t\tprecvpriv->bIsAnyNonBEPkts = false;\n\t\treturn;\n\t}\n\n\t \n\tif ((bbtchange) || (!precvpriv->bIsAnyNonBEPkts)) {\n\t\tcur_tx_bytes = pdvobjpriv->traffic_stat.cur_tx_bytes;\n\t\tcur_rx_bytes = pdvobjpriv->traffic_stat.cur_rx_bytes;\n\n\t\t \n\t\tif (biasonrx) {\n\t\t\tif (cur_tx_bytes > (cur_rx_bytes << 2)) {\n\t\t\t\t \n\t\t\t\ttrafficIndex = UP_LINK;\n\t\t\t} else {  \n\t\t\t\ttrafficIndex = DOWN_LINK;\n\t\t\t}\n\t\t} else {\n\t\t\tif (cur_rx_bytes > (cur_tx_bytes << 2)) {\n\t\t\t\t \n\t\t\t\ttrafficIndex = DOWN_LINK;\n\t\t\t} else {  \n\t\t\t\ttrafficIndex = UP_LINK;\n\t\t\t}\n\t\t}\n\n\t\t \n\t\tif ((iot_peer == HT_IOT_PEER_CISCO) &&\n\t\t    (wirelessmode == ODM_WM_N24G)) {\n\t\t\tEDCA_BE_DL = edca_setting_DL[iot_peer];\n\t\t\tEDCA_BE_UL = edca_setting_UL[iot_peer];\n\t\t} else if ((iot_peer == HT_IOT_PEER_CISCO) &&\n\t\t\t   ((wirelessmode == ODM_WM_G) ||\n\t\t\t    (wirelessmode == (ODM_WM_B | ODM_WM_G)) ||\n\t\t\t    (wirelessmode == ODM_WM_B))) {\n\t\t\tEDCA_BE_DL = edca_setting_DL_GMode[iot_peer];\n\t\t} else if ((iot_peer == HT_IOT_PEER_AIRGO) &&\n\t\t\t   (wirelessmode == ODM_WM_G)) {\n\t\t\tEDCA_BE_DL = 0xa630;\n\t\t} else if (iot_peer == HT_IOT_PEER_MARVELL) {\n\t\t\tEDCA_BE_DL = edca_setting_DL[iot_peer];\n\t\t\tEDCA_BE_UL = edca_setting_UL[iot_peer];\n\t\t} else if (iot_peer == HT_IOT_PEER_ATHEROS) {\n\t\t\t \n\t\t\tEDCA_BE_DL = edca_setting_DL[iot_peer];\n\t\t}\n\n\t\tif (trafficIndex == DOWN_LINK)\n\t\t\tedca_param = EDCA_BE_DL;\n\t\telse\n\t\t\tedca_param = EDCA_BE_UL;\n\n\t\trtw_write32(Adapter, REG_EDCA_BE_PARAM, edca_param);\n\n\t\tpDM_Odm->DM_EDCA_Table.prv_traffic_idx = trafficIndex;\n\n\t\tpDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA = true;\n\t} else {\n\t\t \n\t\t \n\t\t if (pDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA) {\n\t\t\trtw_write32(Adapter, REG_EDCA_BE_PARAM, pHalData->AcParam_BE);\n\t\t\tpDM_Odm->DM_EDCA_Table.bCurrentTurboEDCA = false;\n\t\t}\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}