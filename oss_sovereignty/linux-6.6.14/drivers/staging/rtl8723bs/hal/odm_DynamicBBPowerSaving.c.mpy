{
  "module_name": "odm_DynamicBBPowerSaving.c",
  "hash_id": "56129ceb92164c5465ab964ffdb0033f689df6210b5a747a9a1eb3c8318ac599",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8723bs/hal/odm_DynamicBBPowerSaving.c",
  "human_readable_source": "\n \n\n#include \"odm_precomp.h\"\n\nvoid odm_DynamicBBPowerSavingInit(void *pDM_VOID)\n{\n\tstruct dm_odm_t *pDM_Odm = (struct dm_odm_t *)pDM_VOID;\n\tstruct ps_t *pDM_PSTable = &pDM_Odm->DM_PSTable;\n\n\tpDM_PSTable->PreCCAState = CCA_MAX;\n\tpDM_PSTable->CurCCAState = CCA_MAX;\n\tpDM_PSTable->PreRFState = RF_MAX;\n\tpDM_PSTable->CurRFState = RF_MAX;\n\tpDM_PSTable->Rssi_val_min = 0;\n\tpDM_PSTable->initialize = 0;\n}\n\nvoid ODM_RF_Saving(void *pDM_VOID, u8 bForceInNormal)\n{\n\tstruct dm_odm_t *pDM_Odm = (struct dm_odm_t *)pDM_VOID;\n\tstruct ps_t *pDM_PSTable = &pDM_Odm->DM_PSTable;\n\tu8 Rssi_Up_bound = 30;\n\tu8 Rssi_Low_bound = 25;\n\n\tif (pDM_Odm->PatchID == 40) {  \n\t\tRssi_Up_bound = 50;\n\t\tRssi_Low_bound = 45;\n\t}\n\n\tif (pDM_PSTable->initialize == 0) {\n\n\t\tpDM_PSTable->Reg874 = (PHY_QueryBBReg(pDM_Odm->Adapter, 0x874, bMaskDWord)&0x1CC000)>>14;\n\t\tpDM_PSTable->RegC70 = (PHY_QueryBBReg(pDM_Odm->Adapter, 0xc70, bMaskDWord)&BIT3)>>3;\n\t\tpDM_PSTable->Reg85C = (PHY_QueryBBReg(pDM_Odm->Adapter, 0x85c, bMaskDWord)&0xFF000000)>>24;\n\t\tpDM_PSTable->RegA74 = (PHY_QueryBBReg(pDM_Odm->Adapter, 0xa74, bMaskDWord)&0xF000)>>12;\n\t\t \n\t\tpDM_PSTable->initialize = 1;\n\t}\n\n\tif (!bForceInNormal) {\n\t\tif (pDM_Odm->RSSI_Min != 0xFF) {\n\t\t\tif (pDM_PSTable->PreRFState == RF_Normal) {\n\t\t\t\tif (pDM_Odm->RSSI_Min >= Rssi_Up_bound)\n\t\t\t\t\tpDM_PSTable->CurRFState = RF_Save;\n\t\t\t\telse\n\t\t\t\t\tpDM_PSTable->CurRFState = RF_Normal;\n\t\t\t} else {\n\t\t\t\tif (pDM_Odm->RSSI_Min <= Rssi_Low_bound)\n\t\t\t\t\tpDM_PSTable->CurRFState = RF_Normal;\n\t\t\t\telse\n\t\t\t\t\tpDM_PSTable->CurRFState = RF_Save;\n\t\t\t}\n\t\t} else\n\t\t\tpDM_PSTable->CurRFState = RF_MAX;\n\t} else\n\t\tpDM_PSTable->CurRFState = RF_Normal;\n\n\tif (pDM_PSTable->PreRFState != pDM_PSTable->CurRFState) {\n\t\tif (pDM_PSTable->CurRFState == RF_Save) {\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x874, 0x1C0000, 0x2);  \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xc70, BIT3, 0);  \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x85c, 0xFF000000, 0x63);  \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x874, 0xC000, 0x2);  \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xa74, 0xF000, 0x3);  \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x818, BIT28, 0x0);  \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x818, BIT28, 0x1);  \n\t\t} else {\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x874, 0x1CC000, pDM_PSTable->Reg874);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xc70, BIT3, pDM_PSTable->RegC70);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x85c, 0xFF000000, pDM_PSTable->Reg85C);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xa74, 0xF000, pDM_PSTable->RegA74);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x818, BIT28, 0x0);\n\t\t}\n\t\tpDM_PSTable->PreRFState = pDM_PSTable->CurRFState;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}