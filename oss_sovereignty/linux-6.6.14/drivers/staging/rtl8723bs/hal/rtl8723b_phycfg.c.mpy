{
  "module_name": "rtl8723b_phycfg.c",
  "hash_id": "cb95b4f8cbac5e2b63edc5dc49f211f756debfbcfea0b9e97dd1fc197df21b04",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8723bs/hal/rtl8723b_phycfg.c",
  "human_readable_source": "\n \n\n#include <drv_types.h>\n#include <rtw_debug.h>\n#include <rtl8723b_hal.h>\n\n \nstatic\tu32 phy_CalculateBitShift(u32 BitMask)\n{\n\tu32 i;\n\n\tfor (i = 0; i <= 31; i++) {\n\t\tif (((BitMask>>i) &  0x1) == 1)\n\t\t\tbreak;\n\t}\n\treturn i;\n}\n\n\n \nu32 PHY_QueryBBReg_8723B(struct adapter *Adapter, u32 RegAddr, u32 BitMask)\n{\n\tu32 OriginalValue, BitShift;\n\n\tOriginalValue = rtw_read32(Adapter, RegAddr);\n\tBitShift = phy_CalculateBitShift(BitMask);\n\n\treturn (OriginalValue & BitMask) >> BitShift;\n\n}\n\n\n \n\nvoid PHY_SetBBReg_8723B(\n\tstruct adapter *Adapter,\n\tu32 RegAddr,\n\tu32 BitMask,\n\tu32 Data\n)\n{\n\t \n\tu32 OriginalValue, BitShift;\n\n\tif (BitMask != bMaskDWord) {  \n\t\tOriginalValue = rtw_read32(Adapter, RegAddr);\n\t\tBitShift = phy_CalculateBitShift(BitMask);\n\t\tData = ((OriginalValue & (~BitMask)) | ((Data << BitShift) & BitMask));\n\t}\n\n\trtw_write32(Adapter, RegAddr, Data);\n\n}\n\n\n \n \n \n\nstatic u32 phy_RFSerialRead_8723B(\n\tstruct adapter *Adapter, enum rf_path eRFPath, u32 Offset\n)\n{\n\tu32 retValue = 0;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\tstruct bb_register_def *pPhyReg = &pHalData->PHYRegDef[eRFPath];\n\tu32 NewOffset;\n\tu32 tmplong2;\n\tu8 RfPiEnable = 0;\n\tu32 MaskforPhySet = 0;\n\tint i = 0;\n\n\t \n\t \n\t \n\tOffset &= 0xff;\n\n\tNewOffset = Offset;\n\n\tif (eRFPath == RF_PATH_A) {\n\t\ttmplong2 = PHY_QueryBBReg(Adapter, rFPGA0_XA_HSSIParameter2|MaskforPhySet, bMaskDWord);\n\t\ttmplong2 = (tmplong2 & (~bLSSIReadAddress)) | (NewOffset<<23) | bLSSIReadEdge;\t \n\t\tPHY_SetBBReg(Adapter, rFPGA0_XA_HSSIParameter2|MaskforPhySet, bMaskDWord, tmplong2&(~bLSSIReadEdge));\n\t} else {\n\t\ttmplong2 = PHY_QueryBBReg(Adapter, rFPGA0_XB_HSSIParameter2|MaskforPhySet, bMaskDWord);\n\t\ttmplong2 = (tmplong2 & (~bLSSIReadAddress)) | (NewOffset<<23) | bLSSIReadEdge;\t \n\t\tPHY_SetBBReg(Adapter, rFPGA0_XB_HSSIParameter2|MaskforPhySet, bMaskDWord, tmplong2&(~bLSSIReadEdge));\n\t}\n\n\ttmplong2 = PHY_QueryBBReg(Adapter, rFPGA0_XA_HSSIParameter2|MaskforPhySet, bMaskDWord);\n\tPHY_SetBBReg(Adapter, rFPGA0_XA_HSSIParameter2|MaskforPhySet, bMaskDWord, tmplong2 & (~bLSSIReadEdge));\n\tPHY_SetBBReg(Adapter, rFPGA0_XA_HSSIParameter2|MaskforPhySet, bMaskDWord, tmplong2 | bLSSIReadEdge);\n\n\tudelay(10);\n\n\tfor (i = 0; i < 2; i++)\n\t\tudelay(MAX_STALL_TIME);\n\tudelay(10);\n\n\tif (eRFPath == RF_PATH_A)\n\t\tRfPiEnable = (u8)PHY_QueryBBReg(Adapter, rFPGA0_XA_HSSIParameter1|MaskforPhySet, BIT8);\n\telse if (eRFPath == RF_PATH_B)\n\t\tRfPiEnable = (u8)PHY_QueryBBReg(Adapter, rFPGA0_XB_HSSIParameter1|MaskforPhySet, BIT8);\n\n\tif (RfPiEnable) {\n\t\t \n\t\tretValue = PHY_QueryBBReg(Adapter, pPhyReg->rfLSSIReadBackPi|MaskforPhySet, bLSSIReadBackData);\n\t} else {\n\t\t \n\t\tretValue = PHY_QueryBBReg(Adapter, pPhyReg->rfLSSIReadBack|MaskforPhySet, bLSSIReadBackData);\n\t}\n\treturn retValue;\n\n}\n\n \nstatic void phy_RFSerialWrite_8723B(\n\tstruct adapter *Adapter,\n\tenum rf_path eRFPath,\n\tu32 Offset,\n\tu32 Data\n)\n{\n\tu32 DataAndAddr = 0;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\tstruct bb_register_def *pPhyReg = &pHalData->PHYRegDef[eRFPath];\n\tu32 NewOffset;\n\n\tOffset &= 0xff;\n\n\t \n\t \n\t \n\tNewOffset = Offset;\n\n\t \n\t \n\t \n\tDataAndAddr = ((NewOffset<<20) | (Data&0x000fffff)) & 0x0fffffff;\t \n\t \n\t \n\t \n\tPHY_SetBBReg(Adapter, pPhyReg->rf3wireOffset, bMaskDWord, DataAndAddr);\n}\n\n\n \nu32 PHY_QueryRFReg_8723B(\n\tstruct adapter *Adapter,\n\tu8 eRFPath,\n\tu32 RegAddr,\n\tu32 BitMask\n)\n{\n\tu32 Original_Value, BitShift;\n\n\tOriginal_Value = phy_RFSerialRead_8723B(Adapter, eRFPath, RegAddr);\n\tBitShift =  phy_CalculateBitShift(BitMask);\n\n\treturn (Original_Value & BitMask) >> BitShift;\n}\n\n \nvoid PHY_SetRFReg_8723B(\n\tstruct adapter *Adapter,\n\tu8 eRFPath,\n\tu32 RegAddr,\n\tu32 BitMask,\n\tu32 Data\n)\n{\n\tu32 Original_Value, BitShift;\n\n\t \n\tif (BitMask != bRFRegOffsetMask) {\n\t\tOriginal_Value = phy_RFSerialRead_8723B(Adapter, eRFPath, RegAddr);\n\t\tBitShift =  phy_CalculateBitShift(BitMask);\n\t\tData = ((Original_Value & (~BitMask)) | (Data<<BitShift));\n\t}\n\n\tphy_RFSerialWrite_8723B(Adapter, eRFPath, RegAddr, Data);\n}\n\n\n \n \n \n\n\n \ns32 PHY_MACConfig8723B(struct adapter *Adapter)\n{\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(Adapter);\n\n\tODM_ReadAndConfig_MP_8723B_MAC_REG(&pHalData->odmpriv);\n\treturn _SUCCESS;\n}\n\n \nstatic void phy_InitBBRFRegisterDefinition(struct adapter *Adapter)\n{\n\tstruct hal_com_data\t\t*pHalData = GET_HAL_DATA(Adapter);\n\n\t \n\tpHalData->PHYRegDef[RF_PATH_A].rfintfs = rFPGA0_XAB_RFInterfaceSW;  \n\tpHalData->PHYRegDef[RF_PATH_B].rfintfs = rFPGA0_XAB_RFInterfaceSW;  \n\n\t \n\tpHalData->PHYRegDef[RF_PATH_A].rfintfo = rFPGA0_XA_RFInterfaceOE;  \n\tpHalData->PHYRegDef[RF_PATH_B].rfintfo = rFPGA0_XB_RFInterfaceOE;  \n\n\t \n\tpHalData->PHYRegDef[RF_PATH_A].rfintfe = rFPGA0_XA_RFInterfaceOE;  \n\tpHalData->PHYRegDef[RF_PATH_B].rfintfe = rFPGA0_XB_RFInterfaceOE;  \n\n\tpHalData->PHYRegDef[RF_PATH_A].rf3wireOffset = rFPGA0_XA_LSSIParameter;  \n\tpHalData->PHYRegDef[RF_PATH_B].rf3wireOffset = rFPGA0_XB_LSSIParameter;\n\n\tpHalData->PHYRegDef[RF_PATH_A].rfHSSIPara2 = rFPGA0_XA_HSSIParameter2;   \n\tpHalData->PHYRegDef[RF_PATH_B].rfHSSIPara2 = rFPGA0_XB_HSSIParameter2;   \n\n\t \n\tpHalData->PHYRegDef[RF_PATH_A].rfLSSIReadBack = rFPGA0_XA_LSSIReadBack;\n\tpHalData->PHYRegDef[RF_PATH_B].rfLSSIReadBack = rFPGA0_XB_LSSIReadBack;\n\tpHalData->PHYRegDef[RF_PATH_A].rfLSSIReadBackPi = TransceiverA_HSPI_Readback;\n\tpHalData->PHYRegDef[RF_PATH_B].rfLSSIReadBackPi = TransceiverB_HSPI_Readback;\n\n}\n\nstatic int phy_BB8723b_Config_ParaFile(struct adapter *Adapter)\n{\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\n\t \n\tPHY_InitTxPowerLimit(Adapter);\n\tif (\n\t\tAdapter->registrypriv.RegEnableTxPowerLimit == 1 ||\n\t\t(Adapter->registrypriv.RegEnableTxPowerLimit == 2 && pHalData->EEPROMRegulatory == 1)\n\t) {\n\t\tODM_ConfigRFWithHeaderFile(&pHalData->odmpriv,\n\t\t\t\t\t   CONFIG_RF_TXPWR_LMT, 0);\n\t}\n\n\t \n\t \n\t \n\tODM_ConfigBBWithHeaderFile(&pHalData->odmpriv, CONFIG_BB_PHY_REG);\n\n\t \n\tPHY_InitTxPowerByRate(Adapter);\n\tif (\n\t\tAdapter->registrypriv.RegEnableTxPowerByRate == 1 ||\n\t\t(Adapter->registrypriv.RegEnableTxPowerByRate == 2 && pHalData->EEPROMRegulatory != 2)\n\t) {\n\t\tODM_ConfigBBWithHeaderFile(&pHalData->odmpriv,\n\t\t\t\t\t   CONFIG_BB_PHY_REG_PG);\n\n\t\tif (pHalData->odmpriv.PhyRegPgValueType == PHY_REG_PG_EXACT_VALUE)\n\t\t\tPHY_TxPowerByRateConfiguration(Adapter);\n\n\t\tif (\n\t\t\tAdapter->registrypriv.RegEnableTxPowerLimit == 1 ||\n\t\t\t(Adapter->registrypriv.RegEnableTxPowerLimit == 2 && pHalData->EEPROMRegulatory == 1)\n\t\t)\n\t\t\tPHY_ConvertTxPowerLimitToPowerIndex(Adapter);\n\t}\n\n\t \n\t \n\t \n\tODM_ConfigBBWithHeaderFile(&pHalData->odmpriv, CONFIG_BB_AGC_TAB);\n\n\treturn _SUCCESS;\n}\n\n\nint PHY_BBConfig8723B(struct adapter *Adapter)\n{\n\tint\trtStatus = _SUCCESS;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(Adapter);\n\tu32 RegVal;\n\tu8 CrystalCap;\n\n\tphy_InitBBRFRegisterDefinition(Adapter);\n\n\t \n\tRegVal = rtw_read16(Adapter, REG_SYS_FUNC_EN);\n\trtw_write16(Adapter, REG_SYS_FUNC_EN, (u16)(RegVal|BIT13|BIT0|BIT1));\n\n\trtw_write32(Adapter, 0x948, 0x280);\t \n\n\trtw_write8(Adapter, REG_RF_CTRL, RF_EN|RF_RSTB|RF_SDMRSTB);\n\n\tmsleep(1);\n\n\tPHY_SetRFReg(Adapter, RF_PATH_A, 0x1, 0xfffff, 0x780);\n\n\trtw_write8(Adapter, REG_SYS_FUNC_EN, FEN_PPLL|FEN_PCIEA|FEN_DIO_PCIE|FEN_BB_GLB_RSTn|FEN_BBRSTB);\n\n\trtw_write8(Adapter, REG_AFE_XTAL_CTRL+1, 0x80);\n\n\t \n\t \n\t \n\trtStatus = phy_BB8723b_Config_ParaFile(Adapter);\n\n\t \n\tCrystalCap = pHalData->CrystalCap & 0x3F;\n\tPHY_SetBBReg(Adapter, REG_MAC_PHY_CTRL, 0xFFF000, (CrystalCap | (CrystalCap << 6)));\n\n\treturn rtStatus;\n}\n\nstatic void phy_LCK_8723B(struct adapter *Adapter)\n{\n\tPHY_SetRFReg(Adapter, RF_PATH_A, 0xB0, bRFRegOffsetMask, 0xDFBE0);\n\tPHY_SetRFReg(Adapter, RF_PATH_A, RF_CHNLBW, bRFRegOffsetMask, 0x8C01);\n\tmdelay(200);\n\tPHY_SetRFReg(Adapter, RF_PATH_A, 0xB0, bRFRegOffsetMask, 0xDFFE0);\n}\n\nint PHY_RFConfig8723B(struct adapter *Adapter)\n{\n\tint rtStatus = _SUCCESS;\n\n\t \n\t \n\t \n\trtStatus = PHY_RF6052_Config8723B(Adapter);\n\n\tphy_LCK_8723B(Adapter);\n\n\treturn rtStatus;\n}\n\n \n\nvoid PHY_SetTxPowerIndex(\n\tstruct adapter *Adapter,\n\tu32 PowerIndex,\n\tu8 RFPath,\n\tu8 Rate\n)\n{\n\tif (RFPath == RF_PATH_A || RFPath == RF_PATH_B) {\n\t\tswitch (Rate) {\n\t\tcase MGN_1M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_CCK1_Mcs32, bMaskByte1, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_2M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_B_CCK11_A_CCK2_11, bMaskByte1, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_5_5M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_B_CCK11_A_CCK2_11, bMaskByte2, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_11M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_B_CCK11_A_CCK2_11, bMaskByte3, PowerIndex);\n\t\t\tbreak;\n\n\t\tcase MGN_6M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate18_06, bMaskByte0, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_9M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate18_06, bMaskByte1, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_12M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate18_06, bMaskByte2, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_18M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate18_06, bMaskByte3, PowerIndex);\n\t\t\tbreak;\n\n\t\tcase MGN_24M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate54_24, bMaskByte0, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_36M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate54_24, bMaskByte1, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_48M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate54_24, bMaskByte2, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_54M:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Rate54_24, bMaskByte3, PowerIndex);\n\t\t\tbreak;\n\n\t\tcase MGN_MCS0:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs03_Mcs00, bMaskByte0, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_MCS1:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs03_Mcs00, bMaskByte1, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_MCS2:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs03_Mcs00, bMaskByte2, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_MCS3:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs03_Mcs00, bMaskByte3, PowerIndex);\n\t\t\tbreak;\n\n\t\tcase MGN_MCS4:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs07_Mcs04, bMaskByte0, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_MCS5:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs07_Mcs04, bMaskByte1, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_MCS6:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs07_Mcs04, bMaskByte2, PowerIndex);\n\t\t\tbreak;\n\t\tcase MGN_MCS7:\n\t\t\tPHY_SetBBReg(Adapter, rTxAGC_A_Mcs07_Mcs04, bMaskByte3, PowerIndex);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nu8 PHY_GetTxPowerIndex(\n\tstruct adapter *padapter,\n\tu8 RFPath,\n\tu8 Rate,\n\tenum channel_width BandWidth,\n\tu8 Channel\n)\n{\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\n\ts8 txPower = 0, powerDiffByRate = 0, limit = 0;\n\n\ttxPower = (s8) PHY_GetTxPowerIndexBase(padapter, RFPath, Rate, BandWidth, Channel);\n\tpowerDiffByRate = PHY_GetTxPowerByRate(padapter, RF_PATH_A, Rate);\n\n\tlimit = phy_get_tx_pwr_lmt(\n\t\tpadapter,\n\t\tpadapter->registrypriv.RegPwrTblSel,\n\t\tpHalData->CurrentChannelBW,\n\t\tRFPath,\n\t\tRate,\n\t\tpHalData->CurrentChannel\n\t);\n\n\tpowerDiffByRate = powerDiffByRate > limit ? limit : powerDiffByRate;\n\ttxPower += powerDiffByRate;\n\n\ttxPower += PHY_GetTxPowerTrackingOffset(padapter, RFPath, Rate);\n\n\tif (txPower > MAX_POWER_INDEX)\n\t\ttxPower = MAX_POWER_INDEX;\n\n\treturn (u8) txPower;\n}\n\nvoid PHY_SetTxPowerLevel8723B(struct adapter *Adapter, u8 Channel)\n{\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\tstruct fat_t *pDM_FatTable = &pDM_Odm->DM_FatTable;\n\tu8 RFPath = RF_PATH_A;\n\n\tif (pHalData->AntDivCfg) { \n\t\tRFPath = ((pDM_FatTable->RxIdleAnt == MAIN_ANT) ? RF_PATH_A : RF_PATH_B);\n\t} else {  \n\t\tRFPath = pHalData->ant_path;\n\t}\n\n\tPHY_SetTxPowerLevelByPath(Adapter, Channel, RFPath);\n}\n\nvoid PHY_GetTxPowerLevel8723B(struct adapter *Adapter, s32 *powerlevel)\n{\n}\n\nstatic void phy_SetRegBW_8723B(\n\tstruct adapter *Adapter, enum channel_width CurrentBW\n)\n{\n\tu16 RegRfMod_BW, u2tmp = 0;\n\tRegRfMod_BW = rtw_read16(Adapter, REG_TRXPTCL_CTL_8723B);\n\n\tswitch (CurrentBW) {\n\tcase CHANNEL_WIDTH_20:\n\t\trtw_write16(Adapter, REG_TRXPTCL_CTL_8723B, (RegRfMod_BW & 0xFE7F));  \n\t\tbreak;\n\n\tcase CHANNEL_WIDTH_40:\n\t\tu2tmp = RegRfMod_BW | BIT7;\n\t\trtw_write16(Adapter, REG_TRXPTCL_CTL_8723B, (u2tmp & 0xFEFF));  \n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic u8 phy_GetSecondaryChnl_8723B(struct adapter *Adapter)\n{\n\tu8 SCSettingOf40 = 0, SCSettingOf20 = 0;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\n\tif (pHalData->CurrentChannelBW == CHANNEL_WIDTH_40) {\n\t\tif (pHalData->nCur40MhzPrimeSC == HAL_PRIME_CHNL_OFFSET_UPPER)\n\t\t\tSCSettingOf20 = HT_DATA_SC_20_UPPER_OF_40MHZ;\n\t\telse if (pHalData->nCur40MhzPrimeSC == HAL_PRIME_CHNL_OFFSET_LOWER)\n\t\t\tSCSettingOf20 = HT_DATA_SC_20_LOWER_OF_40MHZ;\n\t}\n\n\treturn  (SCSettingOf40 << 4) | SCSettingOf20;\n}\n\nstatic void phy_PostSetBwMode8723B(struct adapter *Adapter)\n{\n\tu8 SubChnlNum = 0;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\n\n\t \n\tphy_SetRegBW_8723B(Adapter, pHalData->CurrentChannelBW);\n\n\t \n\tSubChnlNum = phy_GetSecondaryChnl_8723B(Adapter);\n\trtw_write8(Adapter, REG_DATA_SC_8723B, SubChnlNum);\n\n\t \n\t \n\t \n\tswitch (pHalData->CurrentChannelBW) {\n\t \n\tcase CHANNEL_WIDTH_20:\n\t\tPHY_SetBBReg(Adapter, rFPGA0_RFMOD, bRFMOD, 0x0);\n\n\t\tPHY_SetBBReg(Adapter, rFPGA1_RFMOD, bRFMOD, 0x0);\n\n\t\tPHY_SetBBReg(Adapter, rOFDM0_TxPseudoNoiseWgt, (BIT31|BIT30), 0x0);\n\t\tbreak;\n\n\t \n\tcase CHANNEL_WIDTH_40:\n\t\tPHY_SetBBReg(Adapter, rFPGA0_RFMOD, bRFMOD, 0x1);\n\n\t\tPHY_SetBBReg(Adapter, rFPGA1_RFMOD, bRFMOD, 0x1);\n\n\t\t \n\t\tPHY_SetBBReg(Adapter, rCCK0_System, bCCKSideBand, (pHalData->nCur40MhzPrimeSC>>1));\n\n\t\tPHY_SetBBReg(Adapter, rOFDM1_LSTF, 0xC00, pHalData->nCur40MhzPrimeSC);\n\n\t\tPHY_SetBBReg(Adapter, 0x818, (BIT26|BIT27), (pHalData->nCur40MhzPrimeSC == HAL_PRIME_CHNL_OFFSET_LOWER) ? 2 : 1);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\t \n\tPHY_RF6052SetBandwidth8723B(Adapter, pHalData->CurrentChannelBW);\n}\n\nstatic void phy_SwChnl8723B(struct adapter *padapter)\n{\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\n\tu8 channelToSW = pHalData->CurrentChannel;\n\n\tif (pHalData->rf_chip == RF_PSEUDO_11N)\n\t\treturn;\n\tpHalData->RfRegChnlVal[0] = ((pHalData->RfRegChnlVal[0] & 0xfffff00) | channelToSW);\n\tPHY_SetRFReg(padapter, RF_PATH_A, RF_CHNLBW, 0x3FF, pHalData->RfRegChnlVal[0]);\n\tPHY_SetRFReg(padapter, RF_PATH_B, RF_CHNLBW, 0x3FF, pHalData->RfRegChnlVal[0]);\n}\n\nstatic void phy_SwChnlAndSetBwMode8723B(struct adapter *Adapter)\n{\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\n\tif (Adapter->bDriverStopped || Adapter->bSurpriseRemoved)\n\t\treturn;\n\n\tif (pHalData->bSwChnl) {\n\t\tphy_SwChnl8723B(Adapter);\n\t\tpHalData->bSwChnl = false;\n\t}\n\n\tif (pHalData->bSetChnlBW) {\n\t\tphy_PostSetBwMode8723B(Adapter);\n\t\tpHalData->bSetChnlBW = false;\n\t}\n\n\tPHY_SetTxPowerLevel8723B(Adapter, pHalData->CurrentChannel);\n}\n\nstatic void PHY_HandleSwChnlAndSetBW8723B(\n\tstruct adapter *Adapter,\n\tbool bSwitchChannel,\n\tbool bSetBandWidth,\n\tu8 ChannelNum,\n\tenum channel_width ChnlWidth,\n\tenum extchnl_offset ExtChnlOffsetOf40MHz,\n\tenum extchnl_offset ExtChnlOffsetOf80MHz,\n\tu8 CenterFrequencyIndex1\n)\n{\n\t \n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\tu8 tmpChannel = pHalData->CurrentChannel;\n\tenum channel_width tmpBW = pHalData->CurrentChannelBW;\n\tu8 tmpnCur40MhzPrimeSC = pHalData->nCur40MhzPrimeSC;\n\tu8 tmpnCur80MhzPrimeSC = pHalData->nCur80MhzPrimeSC;\n\tu8 tmpCenterFrequencyIndex1 = pHalData->CurrentCenterFrequencyIndex1;\n\n\t \n\tif (!bSwitchChannel && !bSetBandWidth)\n\t\treturn;\n\n\t \n\tif (bSwitchChannel) {\n\t\t{\n\t\t\tif (HAL_IsLegalChannel(Adapter, ChannelNum))\n\t\t\t\tpHalData->bSwChnl = true;\n\t\t}\n\t}\n\n\tif (bSetBandWidth)\n\t\tpHalData->bSetChnlBW = true;\n\n\tif (!pHalData->bSetChnlBW && !pHalData->bSwChnl)\n\t\treturn;\n\n\n\tif (pHalData->bSwChnl) {\n\t\tpHalData->CurrentChannel = ChannelNum;\n\t\tpHalData->CurrentCenterFrequencyIndex1 = ChannelNum;\n\t}\n\n\n\tif (pHalData->bSetChnlBW) {\n\t\tpHalData->CurrentChannelBW = ChnlWidth;\n\t\tpHalData->nCur40MhzPrimeSC = ExtChnlOffsetOf40MHz;\n\t\tpHalData->nCur80MhzPrimeSC = ExtChnlOffsetOf80MHz;\n\t\tpHalData->CurrentCenterFrequencyIndex1 = CenterFrequencyIndex1;\n\t}\n\n\t \n\tif ((!Adapter->bDriverStopped) && (!Adapter->bSurpriseRemoved)) {\n\t\tphy_SwChnlAndSetBwMode8723B(Adapter);\n\t} else {\n\t\tif (pHalData->bSwChnl) {\n\t\t\tpHalData->CurrentChannel = tmpChannel;\n\t\t\tpHalData->CurrentCenterFrequencyIndex1 = tmpChannel;\n\t\t}\n\n\t\tif (pHalData->bSetChnlBW) {\n\t\t\tpHalData->CurrentChannelBW = tmpBW;\n\t\t\tpHalData->nCur40MhzPrimeSC = tmpnCur40MhzPrimeSC;\n\t\t\tpHalData->nCur80MhzPrimeSC = tmpnCur80MhzPrimeSC;\n\t\t\tpHalData->CurrentCenterFrequencyIndex1 = tmpCenterFrequencyIndex1;\n\t\t}\n\t}\n}\n\nvoid PHY_SetBWMode8723B(\n\tstruct adapter *Adapter,\n\tenum channel_width Bandwidth,  \n\tunsigned char Offset  \n)\n{\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\n\tPHY_HandleSwChnlAndSetBW8723B(Adapter, false, true, pHalData->CurrentChannel, Bandwidth, Offset, Offset, pHalData->CurrentChannel);\n}\n\n \nvoid PHY_SwChnl8723B(struct adapter *Adapter, u8 channel)\n{\n\tPHY_HandleSwChnlAndSetBW8723B(Adapter, true, false, channel, 0, 0, 0, channel);\n}\n\nvoid PHY_SetSwChnlBWMode8723B(\n\tstruct adapter *Adapter,\n\tu8 channel,\n\tenum channel_width Bandwidth,\n\tu8 Offset40,\n\tu8 Offset80\n)\n{\n\tPHY_HandleSwChnlAndSetBW8723B(Adapter, true, true, channel, Bandwidth, Offset40, Offset80, channel);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}