{
  "module_name": "HalBtc8723b2Ant.c",
  "hash_id": "9776b70fd9bd21dbf6ad16155b42db0ef766f8840384383e171475cf2c5d8cd9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8723bs/hal/HalBtc8723b2Ant.c",
  "human_readable_source": "\n \n\n#include \"Mp_Precomp.h\"\n\n \n#define HAL_BTC8723B2ANT_DMA_DURATION_ADJUST(val)\t\t\t      \\\ndo {\t\t\t\t\t\t\t\t\t      \\\n\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, val);           \\\n\tpCoexDm->psTdmaDuAdjType = val;                                       \\\n} while (0)\n\n \nstatic struct coex_dm_8723b_2ant GLCoexDm8723b2Ant;\nstatic struct coex_dm_8723b_2ant *pCoexDm = &GLCoexDm8723b2Ant;\nstatic struct coex_sta_8723b_2ant GLCoexSta8723b2Ant;\nstatic struct coex_sta_8723b_2ant *pCoexSta = &GLCoexSta8723b2Ant;\n\n \nstatic u8 halbtc8723b2ant_BtRssiState(\n\tu8 levelNum, u8 rssiThresh, u8 rssiThresh1\n)\n{\n\ts32 btRssi = 0;\n\tu8 btRssiState = pCoexSta->preBtRssiState;\n\n\tbtRssi = pCoexSta->btRssi;\n\n\tif (levelNum == 2) {\n\t\tif (\n\t\t\t(pCoexSta->preBtRssiState == BTC_RSSI_STATE_LOW) ||\n\t\t\t(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_LOW)\n\t\t) {\n\t\t\tif (btRssi >= (rssiThresh + BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_HIGH;\n\t\t\t} else {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t}\n\t\t} else {\n\t\t\tif (btRssi < rssiThresh) {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_LOW;\n\t\t\t} else {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t}\n\t\t}\n\t} else if (levelNum == 3) {\n\t\tif (rssiThresh > rssiThresh1) {\n\t\t\treturn pCoexSta->preBtRssiState;\n\t\t}\n\n\t\tif (\n\t\t\t(pCoexSta->preBtRssiState == BTC_RSSI_STATE_LOW) ||\n\t\t\t(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_LOW)\n\t\t) {\n\t\t\tif (btRssi >= (rssiThresh + BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_MEDIUM;\n\t\t\t} else {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t}\n\t\t} else if (\n\t\t\t(pCoexSta->preBtRssiState == BTC_RSSI_STATE_MEDIUM) ||\n\t\t\t(pCoexSta->preBtRssiState == BTC_RSSI_STATE_STAY_MEDIUM)\n\t\t) {\n\t\t\tif (btRssi >= (rssiThresh1 + BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_HIGH;\n\t\t\t} else if (btRssi < rssiThresh) {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_LOW;\n\t\t\t} else {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_STAY_MEDIUM;\n\t\t\t}\n\t\t} else {\n\t\t\tif (btRssi < rssiThresh1) {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_MEDIUM;\n\t\t\t} else {\n\t\t\t\tbtRssiState = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t}\n\t\t}\n\t}\n\n\tpCoexSta->preBtRssiState = btRssiState;\n\n\treturn btRssiState;\n}\n\nstatic u8 halbtc8723b2ant_WifiRssiState(\n\tstruct btc_coexist *pBtCoexist,\n\tu8 index,\n\tu8 levelNum,\n\tu8 rssiThresh,\n\tu8 rssiThresh1\n)\n{\n\ts32 wifiRssi = 0;\n\tu8 wifiRssiState = pCoexSta->preWifiRssiState[index];\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_S4_WIFI_RSSI, &wifiRssi);\n\n\tif (levelNum == 2) {\n\t\tif (\n\t\t\t(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_LOW) ||\n\t\t\t(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_LOW)\n\t\t) {\n\t\t\tif (wifiRssi >= (rssiThresh + BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_HIGH;\n\t\t\t} else {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t}\n\t\t} else {\n\t\t\tif (wifiRssi < rssiThresh) {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_LOW;\n\t\t\t} else {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t}\n\t\t}\n\t} else if (levelNum == 3) {\n\t\tif (rssiThresh > rssiThresh1) {\n\t\t\treturn pCoexSta->preWifiRssiState[index];\n\t\t}\n\n\t\tif (\n\t\t\t(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_LOW) ||\n\t\t\t(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_LOW)\n\t\t) {\n\t\t\tif (wifiRssi >= (rssiThresh + BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_MEDIUM;\n\t\t\t} else {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t}\n\t\t} else if (\n\t\t\t(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_MEDIUM) ||\n\t\t\t(pCoexSta->preWifiRssiState[index] == BTC_RSSI_STATE_STAY_MEDIUM)\n\t\t) {\n\t\t\tif (wifiRssi >= (rssiThresh1 + BTC_RSSI_COEX_THRESH_TOL_8723B_2ANT)) {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_HIGH;\n\t\t\t} else if (wifiRssi < rssiThresh) {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_LOW;\n\t\t\t} else {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_STAY_MEDIUM;\n\t\t\t}\n\t\t} else {\n\t\t\tif (wifiRssi < rssiThresh1) {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_MEDIUM;\n\t\t\t} else {\n\t\t\t\twifiRssiState = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t}\n\t\t}\n\t}\n\n\tpCoexSta->preWifiRssiState[index] = wifiRssiState;\n\n\treturn wifiRssiState;\n}\n\nstatic void halbtc8723b2ant_LimitedRx(\n\tstruct btc_coexist *pBtCoexist,\n\tbool bForceExec,\n\tbool bRejApAggPkt,\n\tbool bBtCtrlAggBufSize,\n\tu8 aggBufSize\n)\n{\n\tbool bRejectRxAgg = bRejApAggPkt;\n\tbool bBtCtrlRxAggSize = bBtCtrlAggBufSize;\n\tu8 rxAggSize = aggBufSize;\n\n\t \n\t \n\t \n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_TO_REJ_AP_AGG_PKT, &bRejectRxAgg);\n\t \n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_CTRL_AGG_SIZE, &bBtCtrlRxAggSize);\n\t \n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_U1_AGG_BUF_SIZE, &rxAggSize);\n\t \n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_AGGREGATE_CTRL, NULL);\n}\n\nstatic void halbtc8723b2ant_QueryBtInfo(struct btc_coexist *pBtCoexist)\n{\n\tu8 \tH2C_Parameter[1] = {0};\n\n\tpCoexSta->bC2hBtInfoReqSent = true;\n\n\tH2C_Parameter[0] |= BIT0;\t \n\n\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x61, 1, H2C_Parameter);\n}\n\nstatic bool halbtc8723b2ant_IsWifiStatusChanged(struct btc_coexist *pBtCoexist)\n{\n\tstatic bool\tbPreWifiBusy, bPreUnder4way, bPreBtHsOn;\n\tbool bWifiBusy = false, bUnder4way = false, bBtHsOn = false;\n\tbool bWifiConnected = false;\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_BUSY, &bWifiBusy);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_4_WAY_PROGRESS, &bUnder4way);\n\n\tif (bWifiConnected) {\n\t\tif (bWifiBusy != bPreWifiBusy) {\n\t\t\tbPreWifiBusy = bWifiBusy;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (bUnder4way != bPreUnder4way) {\n\t\t\tbPreUnder4way = bUnder4way;\n\t\t\treturn true;\n\t\t}\n\n\t\tif (bBtHsOn != bPreBtHsOn) {\n\t\t\tbPreBtHsOn = bBtHsOn;\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n}\n\nstatic void halbtc8723b2ant_UpdateBtLinkInfo(struct btc_coexist *pBtCoexist)\n{\n\tstruct btc_bt_link_info *pBtLinkInfo = &pBtCoexist->btLinkInfo;\n\tbool bBtHsOn = false;\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\n\n\tpBtLinkInfo->bBtLinkExist = pCoexSta->bBtLinkExist;\n\tpBtLinkInfo->bScoExist = pCoexSta->bScoExist;\n\tpBtLinkInfo->bA2dpExist = pCoexSta->bA2dpExist;\n\tpBtLinkInfo->bPanExist = pCoexSta->bPanExist;\n\tpBtLinkInfo->bHidExist = pCoexSta->bHidExist;\n\n\t \n\tif (bBtHsOn) {\n\t\tpBtLinkInfo->bPanExist = true;\n\t\tpBtLinkInfo->bBtLinkExist = true;\n\t}\n\n\t \n\tif (\n\t\tpBtLinkInfo->bScoExist &&\n\t\t!pBtLinkInfo->bA2dpExist &&\n\t\t!pBtLinkInfo->bPanExist &&\n\t\t!pBtLinkInfo->bHidExist\n\t)\n\t\tpBtLinkInfo->bScoOnly = true;\n\telse\n\t\tpBtLinkInfo->bScoOnly = false;\n\n\t \n\tif (\n\t\t!pBtLinkInfo->bScoExist &&\n\t\tpBtLinkInfo->bA2dpExist &&\n\t\t!pBtLinkInfo->bPanExist &&\n\t\t!pBtLinkInfo->bHidExist\n\t)\n\t\tpBtLinkInfo->bA2dpOnly = true;\n\telse\n\t\tpBtLinkInfo->bA2dpOnly = false;\n\n\t \n\tif (\n\t\t!pBtLinkInfo->bScoExist &&\n\t\t!pBtLinkInfo->bA2dpExist &&\n\t\tpBtLinkInfo->bPanExist &&\n\t\t!pBtLinkInfo->bHidExist\n\t)\n\t\tpBtLinkInfo->bPanOnly = true;\n\telse\n\t\tpBtLinkInfo->bPanOnly = false;\n\n\t \n\tif (\n\t\t!pBtLinkInfo->bScoExist &&\n\t\t!pBtLinkInfo->bA2dpExist &&\n\t\t!pBtLinkInfo->bPanExist &&\n\t\tpBtLinkInfo->bHidExist\n\t)\n\t\tpBtLinkInfo->bHidOnly = true;\n\telse\n\t\tpBtLinkInfo->bHidOnly = false;\n}\n\nstatic u8 halbtc8723b2ant_ActionAlgorithm(struct btc_coexist *pBtCoexist)\n{\n\tstruct btc_bt_link_info *pBtLinkInfo = &pBtCoexist->btLinkInfo;\n\tbool bBtHsOn = false;\n\tu8 algorithm = BT_8723B_2ANT_COEX_ALGO_UNDEFINED;\n\tu8 numOfDiffProfile = 0;\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\n\n\tif (!pBtLinkInfo->bBtLinkExist) {\n\t\treturn algorithm;\n\t}\n\n\tif (pBtLinkInfo->bScoExist)\n\t\tnumOfDiffProfile++;\n\n\tif (pBtLinkInfo->bHidExist)\n\t\tnumOfDiffProfile++;\n\n\tif (pBtLinkInfo->bPanExist)\n\t\tnumOfDiffProfile++;\n\n\tif (pBtLinkInfo->bA2dpExist)\n\t\tnumOfDiffProfile++;\n\n\tif (numOfDiffProfile == 1) {\n\t\tif (pBtLinkInfo->bScoExist) {\n\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_SCO;\n\t\t} else {\n\t\t\tif (pBtLinkInfo->bHidExist) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_HID;\n\t\t\t} else if (pBtLinkInfo->bA2dpExist) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_A2DP;\n\t\t\t} else if (pBtLinkInfo->bPanExist) {\n\t\t\t\tif (bBtHsOn) {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANHS;\n\t\t\t\t} else {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (numOfDiffProfile == 2) {\n\t\tif (pBtLinkInfo->bScoExist) {\n\t\t\tif (pBtLinkInfo->bHidExist) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t} else if (pBtLinkInfo->bA2dpExist) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t} else if (pBtLinkInfo->bPanExist) {\n\t\t\t\tif (bBtHsOn) {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_SCO;\n\t\t\t\t} else {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (\n\t\t\t\tpBtLinkInfo->bHidExist &&\n\t\t\t\tpBtLinkInfo->bA2dpExist\n\t\t\t) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_HID_A2DP;\n\t\t\t} else if (\n\t\t\t\tpBtLinkInfo->bHidExist &&\n\t\t\t\tpBtLinkInfo->bPanExist\n\t\t\t) {\n\t\t\t\tif (bBtHsOn) {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_HID;\n\t\t\t\t} else {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t\t}\n\t\t\t} else if (\n\t\t\t\tpBtLinkInfo->bPanExist &&\n\t\t\t\tpBtLinkInfo->bA2dpExist\n\t\t\t) {\n\t\t\t\tif (bBtHsOn) {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_A2DP_PANHS;\n\t\t\t\t} else {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_A2DP;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (numOfDiffProfile == 3) {\n\t\tif (pBtLinkInfo->bScoExist) {\n\t\t\tif (\n\t\t\t\tpBtLinkInfo->bHidExist &&\n\t\t\t\tpBtLinkInfo->bA2dpExist\n\t\t\t) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t} else if (\n\t\t\t\tpBtLinkInfo->bHidExist &&\n\t\t\t\tpBtLinkInfo->bPanExist\n\t\t\t) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t} else if (\n\t\t\t\tpBtLinkInfo->bPanExist &&\n\t\t\t\tpBtLinkInfo->bA2dpExist\n\t\t\t) {\n\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t}\n\t\t} else {\n\t\t\tif (\n\t\t\t\tpBtLinkInfo->bHidExist &&\n\t\t\t\tpBtLinkInfo->bPanExist &&\n\t\t\t\tpBtLinkInfo->bA2dpExist\n\t\t\t) {\n\t\t\t\tif (bBtHsOn) {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_HID_A2DP;\n\t\t\t\t} else {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_HID_A2DP_PANEDR;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (numOfDiffProfile >= 3) {\n\t\tif (pBtLinkInfo->bScoExist) {\n\t\t\tif (\n\t\t\t\tpBtLinkInfo->bHidExist &&\n\t\t\t\tpBtLinkInfo->bPanExist &&\n\t\t\t\tpBtLinkInfo->bA2dpExist\n\t\t\t) {\n\t\t\t\tif (bBtHsOn) {\n\t\t\t\t} else {\n\t\t\t\t\talgorithm = BT_8723B_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn algorithm;\n}\n\nstatic void halbtc8723b2ant_SetFwDacSwingLevel(\n\tstruct btc_coexist *pBtCoexist, u8 dacSwingLvl\n)\n{\n\tu8 \tH2C_Parameter[1] = {0};\n\n\t \n\t \n\tH2C_Parameter[0] = dacSwingLvl;\n\n\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x64, 1, H2C_Parameter);\n}\n\nstatic void halbtc8723b2ant_SetFwDecBtPwr(\n\tstruct btc_coexist *pBtCoexist, u8 decBtPwrLvl\n)\n{\n\tu8 \tH2C_Parameter[1] = {0};\n\n\tH2C_Parameter[0] = decBtPwrLvl;\n\n\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x62, 1, H2C_Parameter);\n}\n\nstatic void halbtc8723b2ant_DecBtPwr(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, u8 decBtPwrLvl\n)\n{\n\tpCoexDm->curBtDecPwrLvl = decBtPwrLvl;\n\n\tif (!bForceExec) {\n\t\tif (pCoexDm->preBtDecPwrLvl == pCoexDm->curBtDecPwrLvl)\n\t\t\treturn;\n\t}\n\thalbtc8723b2ant_SetFwDecBtPwr(pBtCoexist, pCoexDm->curBtDecPwrLvl);\n\n\tpCoexDm->preBtDecPwrLvl = pCoexDm->curBtDecPwrLvl;\n}\n\nstatic void halbtc8723b2ant_FwDacSwingLvl(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, u8 fwDacSwingLvl\n)\n{\n\tpCoexDm->curFwDacSwingLvl = fwDacSwingLvl;\n\n\tif (!bForceExec) {\n\t\tif (pCoexDm->preFwDacSwingLvl == pCoexDm->curFwDacSwingLvl)\n\t\t\treturn;\n\t}\n\n\thalbtc8723b2ant_SetFwDacSwingLevel(pBtCoexist, pCoexDm->curFwDacSwingLvl);\n\n\tpCoexDm->preFwDacSwingLvl = pCoexDm->curFwDacSwingLvl;\n}\n\nstatic void halbtc8723b2ant_SetSwRfRxLpfCorner(\n\tstruct btc_coexist *pBtCoexist,\n\tbool bRxRfShrinkOn\n)\n{\n\tif (bRxRfShrinkOn) {\n\t\t \n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff, 0xffffc);\n\t} else {\n\t\t \n\t\t \n\t\tif (pBtCoexist->bInitilized) {\n\t\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff, pCoexDm->btRf0x1eBackup);\n\t\t}\n\t}\n}\n\nstatic void halbtc8723b2ant_RfShrink(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, bool bRxRfShrinkOn\n)\n{\n\tpCoexDm->bCurRfRxLpfShrink = bRxRfShrinkOn;\n\n\tif (!bForceExec) {\n\t\tif (pCoexDm->bPreRfRxLpfShrink == pCoexDm->bCurRfRxLpfShrink)\n\t\t\treturn;\n\t}\n\thalbtc8723b2ant_SetSwRfRxLpfCorner(pBtCoexist, pCoexDm->bCurRfRxLpfShrink);\n\n\tpCoexDm->bPreRfRxLpfShrink = pCoexDm->bCurRfRxLpfShrink;\n}\n\nstatic void halbtc8723b2ant_SetSwPenaltyTxRateAdaptive(\n\tstruct btc_coexist *pBtCoexist, bool bLowPenaltyRa\n)\n{\n\tu8 \tH2C_Parameter[6] = {0};\n\n\tH2C_Parameter[0] = 0x6;\t \n\n\tif (bLowPenaltyRa) {\n\t\tH2C_Parameter[1] |= BIT0;\n\t\tH2C_Parameter[2] = 0x00;   \n\t\tH2C_Parameter[3] = 0xf7;   \n\t\tH2C_Parameter[4] = 0xf8;   \n\t\tH2C_Parameter[5] = 0xf9;\t \n\t}\n\n\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x69, 6, H2C_Parameter);\n}\n\nstatic void halbtc8723b2ant_LowPenaltyRa(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, bool bLowPenaltyRa\n)\n{\n\t \n\tpCoexDm->bCurLowPenaltyRa = bLowPenaltyRa;\n\n\tif (!bForceExec) {\n\t\tif (pCoexDm->bPreLowPenaltyRa == pCoexDm->bCurLowPenaltyRa)\n\t\t\treturn;\n\t}\n\thalbtc8723b2ant_SetSwPenaltyTxRateAdaptive(pBtCoexist, pCoexDm->bCurLowPenaltyRa);\n\n\tpCoexDm->bPreLowPenaltyRa = pCoexDm->bCurLowPenaltyRa;\n}\n\nstatic void halbtc8723b2ant_SetDacSwingReg(struct btc_coexist *pBtCoexist, u32 level)\n{\n\tu8 val = (u8)level;\n\n\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x883, 0x3e, val);\n}\n\nstatic void halbtc8723b2ant_SetSwFullTimeDacSwing(\n\tstruct btc_coexist *pBtCoexist, bool bSwDacSwingOn, u32 swDacSwingLvl\n)\n{\n\tif (bSwDacSwingOn)\n\t\thalbtc8723b2ant_SetDacSwingReg(pBtCoexist, swDacSwingLvl);\n\telse\n\t\thalbtc8723b2ant_SetDacSwingReg(pBtCoexist, 0x18);\n}\n\n\nstatic void halbtc8723b2ant_DacSwing(\n\tstruct btc_coexist *pBtCoexist,\n\tbool bForceExec,\n\tbool bDacSwingOn,\n\tu32 dacSwingLvl\n)\n{\n\tpCoexDm->bCurDacSwingOn = bDacSwingOn;\n\tpCoexDm->curDacSwingLvl = dacSwingLvl;\n\n\tif (!bForceExec) {\n\t\tif ((pCoexDm->bPreDacSwingOn == pCoexDm->bCurDacSwingOn) &&\n\t\t\t(pCoexDm->preDacSwingLvl == pCoexDm->curDacSwingLvl))\n\t\t\treturn;\n\t}\n\tmdelay(30);\n\thalbtc8723b2ant_SetSwFullTimeDacSwing(pBtCoexist, bDacSwingOn, dacSwingLvl);\n\n\tpCoexDm->bPreDacSwingOn = pCoexDm->bCurDacSwingOn;\n\tpCoexDm->preDacSwingLvl = pCoexDm->curDacSwingLvl;\n}\n\nstatic void halbtc8723b2ant_SetAgcTable(\n\tstruct btc_coexist *pBtCoexist, bool bAgcTableEn\n)\n{\n\tu8 rssiAdjustVal = 0;\n\n\t \n\tif (bAgcTableEn) {\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6e1A0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6d1B0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6c1C0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6b1D0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x6a1E0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x691F0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0x68200001);\n\t} else {\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xaa1A0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa91B0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa81C0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa71D0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa61E0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa51F0001);\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0xc78, 0xa4200001);\n\t}\n\n\n\t \n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xef, 0xfffff, 0x02000);\n\tif (bAgcTableEn) {\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x38fff);\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x38ffe);\n\t} else {\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x380c3);\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x3b, 0xfffff, 0x28ce6);\n\t}\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xef, 0xfffff, 0x0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xed, 0xfffff, 0x1);\n\tif (bAgcTableEn) {\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x38fff);\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x38ffe);\n\t} else {\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x380c3);\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x40, 0xfffff, 0x28ce6);\n\t}\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0xed, 0xfffff, 0x0);\n\n\t \n\tif (bAgcTableEn)\n\t\trssiAdjustVal = 8;\n\n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_U1_RSSI_ADJ_VAL_FOR_AGC_TABLE_ON, &rssiAdjustVal);\n}\n\nstatic void halbtc8723b2ant_AgcTable(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, bool bAgcTableEn\n)\n{\n\tpCoexDm->bCurAgcTableEn = bAgcTableEn;\n\n\tif (!bForceExec) {\n\t\tif (pCoexDm->bPreAgcTableEn == pCoexDm->bCurAgcTableEn)\n\t\t\treturn;\n\t}\n\thalbtc8723b2ant_SetAgcTable(pBtCoexist, bAgcTableEn);\n\n\tpCoexDm->bPreAgcTableEn = pCoexDm->bCurAgcTableEn;\n}\n\nstatic void halbtc8723b2ant_SetCoexTable(\n\tstruct btc_coexist *pBtCoexist,\n\tu32 val0x6c0,\n\tu32 val0x6c4,\n\tu32 val0x6c8,\n\tu8 val0x6cc\n)\n{\n\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x6c0, val0x6c0);\n\n\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x6c4, val0x6c4);\n\n\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x6c8, val0x6c8);\n\n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x6cc, val0x6cc);\n}\n\nstatic void halbtc8723b2ant_CoexTable(\n\tstruct btc_coexist *pBtCoexist,\n\tbool bForceExec,\n\tu32 val0x6c0,\n\tu32 val0x6c4,\n\tu32 val0x6c8,\n\tu8 val0x6cc\n)\n{\n\tpCoexDm->curVal0x6c0 = val0x6c0;\n\tpCoexDm->curVal0x6c4 = val0x6c4;\n\tpCoexDm->curVal0x6c8 = val0x6c8;\n\tpCoexDm->curVal0x6cc = val0x6cc;\n\n\tif (!bForceExec) {\n\t\tif (\n\t\t\t(pCoexDm->preVal0x6c0 == pCoexDm->curVal0x6c0) &&\n\t\t\t(pCoexDm->preVal0x6c4 == pCoexDm->curVal0x6c4) &&\n\t\t\t(pCoexDm->preVal0x6c8 == pCoexDm->curVal0x6c8) &&\n\t\t\t(pCoexDm->preVal0x6cc == pCoexDm->curVal0x6cc)\n\t\t)\n\t\t\treturn;\n\t}\n\thalbtc8723b2ant_SetCoexTable(pBtCoexist, val0x6c0, val0x6c4, val0x6c8, val0x6cc);\n\n\tpCoexDm->preVal0x6c0 = pCoexDm->curVal0x6c0;\n\tpCoexDm->preVal0x6c4 = pCoexDm->curVal0x6c4;\n\tpCoexDm->preVal0x6c8 = pCoexDm->curVal0x6c8;\n\tpCoexDm->preVal0x6cc = pCoexDm->curVal0x6cc;\n}\n\nstatic void halbtc8723b2ant_CoexTableWithType(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, u8 type\n)\n{\n\tswitch (type) {\n\tcase 0:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55555555, 0x55555555, 0xffff, 0x3);\n\t\tbreak;\n\tcase 1:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55555555, 0x5afa5afa, 0xffff, 0x3);\n\t\tbreak;\n\tcase 2:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x5a5a5a5a, 0x5a5a5a5a, 0xffff, 0x3);\n\t\tbreak;\n\tcase 3:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0xaaaaaaaa, 0xaaaaaaaa, 0xffff, 0x3);\n\t\tbreak;\n\tcase 4:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0xffffffff, 0xffffffff, 0xffff, 0x3);\n\t\tbreak;\n\tcase 5:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x5fff5fff, 0x5fff5fff, 0xffff, 0x3);\n\t\tbreak;\n\tcase 6:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5a5a5a5a, 0xffff, 0x3);\n\t\tbreak;\n\tcase 7:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0xfafafafa, 0xffff, 0x3);\n\t\tbreak;\n\tcase 8:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x5aea5aea, 0x5aea5aea, 0xffff, 0x3);\n\t\tbreak;\n\tcase 9:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5aea5aea, 0xffff, 0x3);\n\t\tbreak;\n\tcase 10:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5aff5aff, 0xffff, 0x3);\n\t\tbreak;\n\tcase 11:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5a5f5a5f, 0xffff, 0x3);\n\t\tbreak;\n\tcase 12:\n\t\thalbtc8723b2ant_CoexTable(pBtCoexist, bForceExec, 0x55ff55ff, 0x5f5f5f5f, 0xffff, 0x3);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void halbtc8723b2ant_SetFwIgnoreWlanAct(\n\tstruct btc_coexist *pBtCoexist, bool bEnable\n)\n{\n\tu8 \tH2C_Parameter[1] = {0};\n\n\tif (bEnable)\n\t\tH2C_Parameter[0] |= BIT0;\t\t \n\n\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x63, 1, H2C_Parameter);\n}\n\nstatic void halbtc8723b2ant_IgnoreWlanAct(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, bool bEnable\n)\n{\n\tpCoexDm->bCurIgnoreWlanAct = bEnable;\n\n\tif (!bForceExec) {\n\t\tif (pCoexDm->bPreIgnoreWlanAct == pCoexDm->bCurIgnoreWlanAct)\n\t\t\treturn;\n\t}\n\thalbtc8723b2ant_SetFwIgnoreWlanAct(pBtCoexist, bEnable);\n\n\tpCoexDm->bPreIgnoreWlanAct = pCoexDm->bCurIgnoreWlanAct;\n}\n\nstatic void halbtc8723b2ant_SetFwPstdma(\n\tstruct btc_coexist *pBtCoexist,\n\tu8 byte1,\n\tu8 byte2,\n\tu8 byte3,\n\tu8 byte4,\n\tu8 byte5\n)\n{\n\tu8 \tH2C_Parameter[5] = {0};\n\n\tH2C_Parameter[0] = byte1;\n\tH2C_Parameter[1] = byte2;\n\tH2C_Parameter[2] = byte3;\n\tH2C_Parameter[3] = byte4;\n\tH2C_Parameter[4] = byte5;\n\n\tpCoexDm->psTdmaPara[0] = byte1;\n\tpCoexDm->psTdmaPara[1] = byte2;\n\tpCoexDm->psTdmaPara[2] = byte3;\n\tpCoexDm->psTdmaPara[3] = byte4;\n\tpCoexDm->psTdmaPara[4] = byte5;\n\n\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x60, 5, H2C_Parameter);\n}\n\nstatic void halbtc8723b2ant_SwMechanism1(\n\tstruct btc_coexist *pBtCoexist,\n\tbool bShrinkRxLPF,\n\tbool bLowPenaltyRA,\n\tbool bLimitedDIG,\n\tbool bBTLNAConstrain\n)\n{\n\thalbtc8723b2ant_RfShrink(pBtCoexist, NORMAL_EXEC, bShrinkRxLPF);\n\thalbtc8723b2ant_LowPenaltyRa(pBtCoexist, NORMAL_EXEC, bLowPenaltyRA);\n}\n\nstatic void halbtc8723b2ant_SwMechanism2(\n\tstruct btc_coexist *pBtCoexist,\n\tbool bAGCTableShift,\n\tbool bADCBackOff,\n\tbool bSWDACSwing,\n\tu32 dacSwingLvl\n)\n{\n\thalbtc8723b2ant_AgcTable(pBtCoexist, NORMAL_EXEC, bAGCTableShift);\n\thalbtc8723b2ant_DacSwing(pBtCoexist, NORMAL_EXEC, bSWDACSwing, dacSwingLvl);\n}\n\nstatic void halbtc8723b2ant_SetAntPath(\n\tstruct btc_coexist *pBtCoexist, u8 antPosType, bool bInitHwCfg, bool bWifiOff\n)\n{\n\tstruct btc_board_info *pBoardInfo = &pBtCoexist->boardInfo;\n\tu32 fwVer = 0, u4Tmp = 0;\n\tbool bPgExtSwitch = false;\n\tbool bUseExtSwitch = false;\n\tu8 \tH2C_Parameter[2] = {0};\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_EXT_SWITCH, &bPgExtSwitch);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_FW_VER, &fwVer);\t \n\n\tif ((fwVer > 0 && fwVer < 0xc0000) || bPgExtSwitch)\n\t\tbUseExtSwitch = true;\n\n\tif (bInitHwCfg) {\n\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x39, 0x8, 0x1);\n\t\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x974, 0xff);\n\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x944, 0x3, 0x3);\n\t\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x930, 0x77);\n\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x67, 0x20, 0x1);\n\n\t\tif (fwVer >= 0x180000) {\n\t\t\t \n\t\t\tH2C_Parameter[0] = 0;\n\t\t\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x6E, 1, H2C_Parameter);\n\t\t} else {\n\t\t\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x765, 0x0);\n\t\t}\n\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\n\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);  \n\t\tpBtCoexist->fBtcSetBtReg(pBtCoexist, BTC_BT_REG_RF, 0x3c, 0x01);  \n\n\t\tif (pBoardInfo->btdmAntPos == BTC_ANTENNA_AT_MAIN_PORT) {\n\t\t\t \n\t\t\tH2C_Parameter[0] = 0;\n\t\t} else {\n\t\t\t \n\t\t\tH2C_Parameter[0] = 1;\n\t\t}\n\n\t\tif (bUseExtSwitch) {\n\t\t\t \n\t\t\tH2C_Parameter[1] = 1;\n\t\t} else {\n\t\t\t \n\t\t\tH2C_Parameter[1] = 0;\n\t\t}\n\t\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x65, 2, H2C_Parameter);\n\t}\n\n\t \n\tif (bUseExtSwitch) {\n\t\tif (bInitHwCfg) {\n\t\t\t \n\t\t\tu4Tmp = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x4c);\n\t\t\tu4Tmp &= ~BIT23;\n\t\t\tu4Tmp |= BIT24;\n\t\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x4c, u4Tmp);\n\t\t}\n\n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);  \n\t\tswitch (antPosType) {\n\t\tcase BTC_ANT_WIFI_AT_MAIN:\n\t\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x92c, 0x3, 0x1);\t \n\t\t\tbreak;\n\t\tcase BTC_ANT_WIFI_AT_AUX:\n\t\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x92c, 0x3, 0x2);\t \n\t\t\tbreak;\n\t\t}\n\t} else {  \n\t\tif (bInitHwCfg) {\n\t\t\t \n\t\t\tu4Tmp = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x4c);\n\t\t\tu4Tmp |= BIT23;\n\t\t\tu4Tmp &= ~BIT24;\n\t\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x4c, u4Tmp);\n\t\t}\n\n\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x64, 0x1, 0x0);  \n\t\tswitch (antPosType) {\n\t\tcase BTC_ANT_WIFI_AT_MAIN:\n\t\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);  \n\t\t\tbreak;\n\t\tcase BTC_ANT_WIFI_AT_AUX:\n\t\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x280);  \n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic void halbtc8723b2ant_PsTdma(\n\tstruct btc_coexist *pBtCoexist, bool bForceExec, bool bTurnOn, u8 type\n)\n{\n\tpCoexDm->bCurPsTdmaOn = bTurnOn;\n\tpCoexDm->curPsTdma = type;\n\n\tif (!bForceExec) {\n\t\tif (\n\t\t\t(pCoexDm->bPrePsTdmaOn == pCoexDm->bCurPsTdmaOn) &&\n\t\t\t(pCoexDm->prePsTdma == pCoexDm->curPsTdma)\n\t\t)\n\t\t\treturn;\n\t}\n\n\tif (bTurnOn) {\n\t\tswitch (type) {\n\t\tcase 1:\n\t\tdefault:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1c, 0x3, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x10, 0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 5:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 6:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 7:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1c, 0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 8:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xa3, 0x10, 0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 9:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 10:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 11:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 12:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 13:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 14:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x12, 0x12, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 15:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0xa, 0xa, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 16:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 17:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xa3, 0x2f, 0x2f, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 18:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x5, 0x5, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 19:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x25, 0x25, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 20:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x25, 0x25, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 21:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x15, 0x03, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 71:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0xe3, 0x1a, 0x1a, 0xe1, 0x90);\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\t \n\t\tswitch (type) {\n\t\tcase 0:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x40, 0x0);\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x48, 0x0);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\thalbtc8723b2ant_SetFwPstdma(pBtCoexist, 0x0, 0x0, 0x0, 0x40, 0x0);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\tpCoexDm->bPrePsTdmaOn = pCoexDm->bCurPsTdmaOn;\n\tpCoexDm->prePsTdma = pCoexDm->curPsTdma;\n}\n\nstatic void halbtc8723b2ant_CoexAllOff(struct btc_coexist *pBtCoexist)\n{\n\t \n\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\t \n\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\n\t \n\t \n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\n}\n\nstatic void halbtc8723b2ant_InitCoexDm(struct btc_coexist *pBtCoexist)\n{\n\t \n\n\thalbtc8723b2ant_PsTdma(pBtCoexist, FORCE_EXEC, false, 1);\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, FORCE_EXEC, 6);\n\thalbtc8723b2ant_DecBtPwr(pBtCoexist, FORCE_EXEC, 0);\n\n\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n}\n\nstatic void halbtc8723b2ant_ActionBtInquiry(struct btc_coexist *pBtCoexist)\n{\n\tbool bWifiConnected = false;\n\tbool bLowPwrDisable = true;\n\n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\n\n\tif (bWifiConnected) {\n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 3);\n\t} else {\n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\n\t}\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, FORCE_EXEC, 6);\n\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\n\tpCoexDm->bNeedRecover0x948 = true;\n\tpCoexDm->backup0x948 = pBtCoexist->fBtcRead4Byte(pBtCoexist, 0x948);\n\n\thalbtc8723b2ant_SetAntPath(pBtCoexist, BTC_ANT_WIFI_AT_AUX, false, false);\n}\n\nstatic bool halbtc8723b2ant_IsCommonAction(struct btc_coexist *pBtCoexist)\n{\n\tu8 btRssiState = BTC_RSSI_STATE_HIGH;\n\tbool bCommon = false, bWifiConnected = false, bWifiBusy = false;\n\tbool bBtHsOn = false, bLowPwrDisable = false;\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_HS_OPERATION, &bBtHsOn);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_BUSY, &bWifiBusy);\n\n\tif (!bWifiConnected) {\n\t\tbLowPwrDisable = false;\n\t\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\n\t\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\n\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\n\t\tbCommon = true;\n\t} else {\n\t\tif (BT_8723B_2ANT_BT_STATUS_NON_CONNECTED_IDLE == pCoexDm->btStatus) {\n\t\t\tbLowPwrDisable = false;\n\t\t\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\n\t\t\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\t\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\t\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\n\t\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\n\t\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0xb);\n\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\n\t\t\tbCommon = true;\n\t\t} else if (BT_8723B_2ANT_BT_STATUS_CONNECTED_IDLE == pCoexDm->btStatus) {\n\t\t\tbLowPwrDisable = true;\n\t\t\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\n\n\t\t\tif (bBtHsOn)\n\t\t\t\treturn false;\n\n\t\t\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\t\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\t\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\n\t\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\n\t\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0xb);\n\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\n\t\t\tbCommon = true;\n\t\t} else {\n\t\t\tbLowPwrDisable = true;\n\t\t\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_ACT_DISABLE_LOW_POWER, &bLowPwrDisable);\n\n\t\t\tif (bWifiBusy) {\n\t\t\t\tbCommon = false;\n\t\t\t} else {\n\t\t\t\tif (bBtHsOn)\n\t\t\t\t\treturn false;\n\n\t\t\t\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\t\t\t\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\t\t\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\t\t\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\t\t\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 21);\n\t\t\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 0xb);\n\n\t\t\t\tif (BTC_RSSI_HIGH(btRssiState))\n\t\t\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\t\t\t\telse\n\t\t\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\t\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t\t\tbCommon = true;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn bCommon;\n}\n\nstatic void halbtc8723b2ant_TdmaDurationAdjust(\n\tstruct btc_coexist *pBtCoexist, bool bScoHid, bool bTxPause, u8 maxInterval\n)\n{\n\tstatic s32 up, dn, m, n, WaitCount;\n\ts32 result;    \n\tu8 retryCount = 0;\n\n\tif (!pCoexDm->bAutoTdmaAdjust) {\n\t\tpCoexDm->bAutoTdmaAdjust = true;\n\t\t{\n\t\t\tif (bScoHid) {\n\t\t\t\tif (bTxPause) {\n\t\t\t\t\tif (maxInterval == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(13);\n\t\t\t\t\telse if (maxInterval == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\t\telse\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t} else {\n\t\t\t\t\tif (maxInterval == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(9);\n\t\t\t\t\telse if (maxInterval == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\t\telse\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (bTxPause) {\n\t\t\t\t\tif (maxInterval == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(5);\n\t\t\t\t\telse if (maxInterval == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\t\telse\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t} else {\n\t\t\t\t\tif (maxInterval == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(1);\n\t\t\t\t\telse if (maxInterval == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\t\telse\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t \n\t\tup = 0;\n\t\tdn = 0;\n\t\tm = 1;\n\t\tn = 3;\n\t\tresult = 0;\n\t\tWaitCount = 0;\n\t} else {\n\t\t \n\t\tretryCount = pCoexSta->btRetryCnt;\n\t\tresult = 0;\n\t\tWaitCount++;\n\n\t\tif (retryCount == 0) {  \n\t\t\tup++;\n\t\t\tdn--;\n\n\t\t\tif (dn <= 0)\n\t\t\t\tdn = 0;\n\n\t\t\tif (up >= n) {  \n\t\t\t\tWaitCount = 0;\n\t\t\t\tn = 3;\n\t\t\t\tup = 0;\n\t\t\t\tdn = 0;\n\t\t\t\tresult = 1;\n\t\t\t}\n\t\t} else if (retryCount <= 3) {  \n\t\t\tup--;\n\t\t\tdn++;\n\n\t\t\tif (up <= 0)\n\t\t\t\tup = 0;\n\n\t\t\tif (dn == 2) {  \n\t\t\t\tif (WaitCount <= 2)\n\t\t\t\t\tm++;  \n\t\t\t\telse\n\t\t\t\t\tm = 1;\n\n\t\t\t\tif (m >= 20)  \n\t\t\t\t\tm = 20;\n\n\t\t\t\tn = 3 * m;\n\t\t\t\tup = 0;\n\t\t\t\tdn = 0;\n\t\t\t\tWaitCount = 0;\n\t\t\t\tresult = -1;\n\t\t\t}\n\t\t} else {  \n\t\t\tif (WaitCount == 1)\n\t\t\t\tm++;  \n\t\t\telse\n\t\t\t\tm = 1;\n\n\t\t\tif (m >= 20)  \n\t\t\t\tm = 20;\n\n\t\t\tn = 3 * m;\n\t\t\tup = 0;\n\t\t\tdn = 0;\n\t\t\tWaitCount = 0;\n\t\t\tresult = -1;\n\t\t}\n\n\t\tif (maxInterval == 1) {\n\t\t\tif (bTxPause) {\n\t\t\t\tif (pCoexDm->curPsTdma == 71)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(5);\n\t\t\t\telse if (pCoexDm->curPsTdma == 1)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(5);\n\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\telse if (pCoexDm->curPsTdma == 4)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(8);\n\n\t\t\t\tif (pCoexDm->curPsTdma == 9)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(13);\n\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\telse if (pCoexDm->curPsTdma == 12)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(16);\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 5)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(8);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 13)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(16);\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 8)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(5);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 16)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(13);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (pCoexDm->curPsTdma == 5)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(71);\n\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\telse if (pCoexDm->curPsTdma == 8)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(4);\n\n\t\t\t\tif (pCoexDm->curPsTdma == 13)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(9);\n\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\telse if (pCoexDm->curPsTdma == 16)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(12);\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 71)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(1);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(4);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 9)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(12);\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 4)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(1);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(71);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 12)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(9);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (maxInterval == 2) {\n\t\t\tif (bTxPause) {\n\t\t\t\tif (pCoexDm->curPsTdma == 1)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\telse if (pCoexDm->curPsTdma == 4)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(8);\n\n\t\t\t\tif (pCoexDm->curPsTdma == 9)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\telse if (pCoexDm->curPsTdma == 12)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(16);\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 5)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(8);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 13)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(16);\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 8)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(6);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 16)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(14);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (pCoexDm->curPsTdma == 5)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\telse if (pCoexDm->curPsTdma == 8)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(4);\n\n\t\t\t\tif (pCoexDm->curPsTdma == 13)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\telse if (pCoexDm->curPsTdma == 16)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(12);\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(4);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 9)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(12);\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 4)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(2);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 12)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(10);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (maxInterval == 3) {\n\t\t\tif (bTxPause) {\n\t\t\t\tif (pCoexDm->curPsTdma == 1)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\telse if (pCoexDm->curPsTdma == 4)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(8);\n\n\t\t\t\tif (pCoexDm->curPsTdma == 9)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\telse if (pCoexDm->curPsTdma == 12)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(16);\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 5)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(8);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 13)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(16);\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 8)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(7);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 16)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(15);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (pCoexDm->curPsTdma == 5)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\telse if (pCoexDm->curPsTdma == 6)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\telse if (pCoexDm->curPsTdma == 7)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\telse if (pCoexDm->curPsTdma == 8)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(4);\n\n\t\t\t\tif (pCoexDm->curPsTdma == 13)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\telse if (pCoexDm->curPsTdma == 14)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\telse if (pCoexDm->curPsTdma == 15)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\telse if (pCoexDm->curPsTdma == 16)\n\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(12);\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 1)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(4);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 9)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(12);\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (pCoexDm->curPsTdma == 4)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 3)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 2)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(3);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 12)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 11)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t\telse if (pCoexDm->curPsTdma == 10)\n\t\t\t\t\t\tHAL_BTC8723B2ANT_DMA_DURATION_ADJUST(11);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t \n\t \n\tif (pCoexDm->curPsTdma != pCoexDm->psTdmaDuAdjType) {\n\t\tbool bScan = false, bLink = false, bRoam = false;\n\n\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_SCAN, &bScan);\n\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_LINK, &bLink);\n\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_ROAM, &bRoam);\n\n\t\tif (!bScan && !bLink && !bRoam)\n\t\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, pCoexDm->psTdmaDuAdjType);\n\n\t}\n}\n\n \nstatic void halbtc8723b2ant_ActionSco(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 4);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\n\tif (BTC_WIFI_BW_LEGACY == wifiBw)  \n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 2);\n\telse   \n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 8);\n\n\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 0);  \n\n\t \n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x4);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, true, 0x4);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x4);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, true, 0x4);\n\t\t}\n\t}\n}\n\n\nstatic void halbtc8723b2ant_ActionHid(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\n\tif (BTC_WIFI_BW_LEGACY == wifiBw)  \n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\telse   \n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 9);\n\n\tif (\n\t\t(btRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t)\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 9);\n\telse\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 13);\n\n\t \n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\n \nstatic void halbtc8723b2ant_ActionA2dp(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, wifiRssiState1, btRssiState;\n\tu32 wifiBw;\n\tu8 apNum = 0;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\twifiRssiState1 = halbtc8723b2ant_WifiRssiState(pBtCoexist, 1, 2, 40, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_AP_NUM, &apNum);\n\n\t \n\tif (apNum >= 10 && BTC_RSSI_HIGH(wifiRssiState1)) {\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\t\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 0);\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\n\n\t\t \n\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\t\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, true, 0x18);\n\t\t}\n\t\treturn;\n\t}\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\n\tif (\n\t\t(btRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t)\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, false, 1);\n\telse\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 1);\n\n\t \n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void halbtc8723b2ant_ActionA2dpPanHs(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\n\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 2);\n\n\t \n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void halbtc8723b2ant_ActionPanEdr(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 10);\n\n\tif (\n\t\t(btRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t)\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 1);\n\telse\n\t\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, true, 5);\n\n\t \n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\n\n \nstatic void halbtc8723b2ant_ActionPanHs(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\n\thalbtc8723b2ant_PsTdma(pBtCoexist, NORMAL_EXEC, false, 1);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\n \nstatic void halbtc8723b2ant_ActionPanEdrA2dp(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\n\tif (\n\t\t(btRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t) {\n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 12);\n\t\tif (BTC_WIFI_BW_HT40 == wifiBw)\n\t\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 3);\n\t\telse\n\t\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, false, 3);\n\t} else {\n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, false, true, 3);\n\t}\n\n\t \n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, false, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void halbtc8723b2ant_ActionPanEdrHid(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\tif (\n\t\t(btRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t) {\n\t\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 3);\n\t\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 11);\n\t\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x780);\n\t\t} else {\n\t\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\t\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\t\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\t\t}\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, false, 2);\n\t} else {\n\t\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\t\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 11);\n\t\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 2);\n\t}\n\n\t \n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\n \nstatic void halbtc8723b2ant_ActionHidA2dpPanEdr(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\tbtRssiState = halbtc8723b2ant_BtRssiState(2, 29, 0);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, false, 0x8);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(btRssiState))\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\telse\n\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\n\tif (\n\t\t(btRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t) {\n\t\tif (BTC_WIFI_BW_HT40 == wifiBw)\n\t\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 2);\n\t\telse\n\t\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, false, 3);\n\t} else\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 3);\n\n\t \n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void halbtc8723b2ant_ActionHidA2dp(struct btc_coexist *pBtCoexist)\n{\n\tu8 wifiRssiState, btRssiState;\n\tu32 wifiBw;\n\tu8 apNum = 0;\n\n\twifiRssiState = halbtc8723b2ant_WifiRssiState(pBtCoexist, 0, 2, 15, 0);\n\t \n\tbtRssiState = halbtc8723b2ant_BtRssiState(3, 29, 37);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\thalbtc8723b2ant_LimitedRx(pBtCoexist, NORMAL_EXEC, false, true, 0x5);\n\n\thalbtc8723b2ant_FwDacSwingLvl(pBtCoexist, NORMAL_EXEC, 6);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\tif (BTC_WIFI_BW_LEGACY == wifiBw) {\n\t\tif (BTC_RSSI_HIGH(btRssiState))\n\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\t\telse if (BTC_RSSI_MEDIUM(btRssiState))\n\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\t\telse\n\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\t} else {\n\t\t \n\t\tif (BTC_RSSI_HIGH(btRssiState)) {\n\t\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_AP_NUM, &apNum);\n\t\t\t \n\t\t\tif (apNum < 10)\n\t\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 4);\n\t\t\telse\n\t\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\t\t} else if (BTC_RSSI_MEDIUM(btRssiState))\n\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 2);\n\t\telse\n\t\t\thalbtc8723b2ant_DecBtPwr(pBtCoexist, NORMAL_EXEC, 0);\n\t}\n\n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, NORMAL_EXEC, 7);\n\n\tif (\n\t\t(btRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t(btRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t)\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, false, 2);\n\telse\n\t\thalbtc8723b2ant_TdmaDurationAdjust(pBtCoexist, true, true, 2);\n\n\t \n\tif (BTC_WIFI_BW_HT40 == wifiBw) {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, true, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t} else {\n\t\tif (\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_HIGH) ||\n\t\t\t(wifiRssiState == BTC_RSSI_STATE_STAY_HIGH)\n\t\t) {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, true, false, false, 0x18);\n\t\t} else {\n\t\t\thalbtc8723b2ant_SwMechanism1(pBtCoexist, false, true, false, false);\n\t\t\thalbtc8723b2ant_SwMechanism2(pBtCoexist, false, false, false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void halbtc8723b2ant_RunCoexistMechanism(struct btc_coexist *pBtCoexist)\n{\n\tu8 algorithm = 0;\n\n\tif (pBtCoexist->bManualControl) {\n\t\treturn;\n\t}\n\n\tif (pCoexSta->bUnderIps) {\n\t\treturn;\n\t}\n\n\talgorithm = halbtc8723b2ant_ActionAlgorithm(pBtCoexist);\n\tif (pCoexSta->bC2hBtInquiryPage && (BT_8723B_2ANT_COEX_ALGO_PANHS != algorithm)) {\n\t\thalbtc8723b2ant_ActionBtInquiry(pBtCoexist);\n\t\treturn;\n\t} else {\n\t\tif (pCoexDm->bNeedRecover0x948) {\n\t\t\tpCoexDm->bNeedRecover0x948 = false;\n\t\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, pCoexDm->backup0x948);\n\t\t}\n\t}\n\n\tpCoexDm->curAlgorithm = algorithm;\n\n\tif (halbtc8723b2ant_IsCommonAction(pBtCoexist)) {\n\t\tpCoexDm->bAutoTdmaAdjust = false;\n\t} else {\n\t\tif (pCoexDm->curAlgorithm != pCoexDm->preAlgorithm) {\n\t\t\tpCoexDm->bAutoTdmaAdjust = false;\n\t\t}\n\n\n\t\tswitch (pCoexDm->curAlgorithm) {\n\t\tcase BT_8723B_2ANT_COEX_ALGO_SCO:\n\t\t\thalbtc8723b2ant_ActionSco(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_HID:\n\t\t\thalbtc8723b2ant_ActionHid(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_A2DP:\n\t\t\thalbtc8723b2ant_ActionA2dp(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_A2DP_PANHS:\n\t\t\thalbtc8723b2ant_ActionA2dpPanHs(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_PANEDR:\n\t\t\thalbtc8723b2ant_ActionPanEdr(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_PANHS:\n\t\t\thalbtc8723b2ant_ActionPanHs(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_PANEDR_A2DP:\n\t\t\thalbtc8723b2ant_ActionPanEdrA2dp(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_PANEDR_HID:\n\t\t\thalbtc8723b2ant_ActionPanEdrHid(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_HID_A2DP_PANEDR:\n\t\t\thalbtc8723b2ant_ActionHidA2dpPanEdr(pBtCoexist);\n\t\t\tbreak;\n\t\tcase BT_8723B_2ANT_COEX_ALGO_HID_A2DP:\n\t\t\thalbtc8723b2ant_ActionHidA2dp(pBtCoexist);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\thalbtc8723b2ant_CoexAllOff(pBtCoexist);\n\t\t\tbreak;\n\t\t}\n\t\tpCoexDm->preAlgorithm = pCoexDm->curAlgorithm;\n\t}\n}\n\nstatic void halbtc8723b2ant_WifiOffHwCfg(struct btc_coexist *pBtCoexist)\n{\n\tbool bIsInMpMode = false;\n\tu8 H2C_Parameter[2] = {0};\n\tu32 fwVer = 0;\n\n\t \n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x76e, 0x4);\n\n\tpBtCoexist->fBtcSetRfReg(pBtCoexist, BTC_RF_A, 0x1, 0xfffff, 0x780);  \n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_FW_VER, &fwVer);\n\tif (fwVer >= 0x180000) {\n\t\t \n\t\tH2C_Parameter[0] = 1;\n\t\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x6E, 1, H2C_Parameter);\n\t} else\n\t\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x765, 0x18);\n\n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_IS_IN_MP_MODE, &bIsInMpMode);\n\tif (!bIsInMpMode)\n\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x67, 0x20, 0x0);  \n\telse\n\t\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x67, 0x20, 0x1);  \n}\n\nstatic void halbtc8723b2ant_InitHwConfig(struct btc_coexist *pBtCoexist, bool bBackUp)\n{\n\tu8 u1Tmp = 0;\n\n\t \n\tpCoexDm->btRf0x1eBackup =\n\t\tpBtCoexist->fBtcGetRfReg(pBtCoexist, BTC_RF_A, 0x1e, 0xfffff);\n\n\t \n\tu1Tmp = pBtCoexist->fBtcRead1Byte(pBtCoexist, 0x790);\n\tu1Tmp &= 0xc0;\n\tu1Tmp |= 0x5;\n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x790, u1Tmp);\n\n\t \n\thalbtc8723b2ant_SetAntPath(pBtCoexist, BTC_ANT_WIFI_AT_MAIN, true, false);\n\n\t \n\thalbtc8723b2ant_CoexTableWithType(pBtCoexist, FORCE_EXEC, 0);\n\n\t \n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x76e, 0xc);  \n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x778, 0x3);\n\tpBtCoexist->fBtcWrite1ByteBitMask(pBtCoexist, 0x40, 0x20, 0x1);\n}\n\n \n \n \n \n \n \nvoid EXhalbtc8723b2ant_PowerOnSetting(struct btc_coexist *pBtCoexist)\n{\n\tstruct btc_board_info *pBoardInfo = &pBtCoexist->boardInfo;\n\tu8 u1Tmp = 0x4;  \n\tu16 u2Tmp = 0x0;\n\n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x67, 0x20);\n\n\t \n\tu2Tmp = pBtCoexist->fBtcRead2Byte(pBtCoexist, 0x2);\n\tpBtCoexist->fBtcWrite2Byte(pBtCoexist, 0x2, u2Tmp | BIT0 | BIT1);\n\n\t \n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x765, 0x18);\n\t \n\tpBtCoexist->fBtcWrite1Byte(pBtCoexist, 0x76e, 0x4);\n\n\t \n\t \n\t \n\t \n\t \n\t \n\t \n\tif (pBtCoexist->chipInterface == BTC_INTF_USB) {\n\t\t \n\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\n\n\t\tu1Tmp |= 0x1;\t \n\t\tpBtCoexist->fBtcWriteLocalReg1Byte(pBtCoexist, 0xfe08, u1Tmp);\n\n\t\tpBoardInfo->btdmAntPos = BTC_ANTENNA_AT_AUX_PORT;\n\t} else {\n\t\t \n\t\tif (pBoardInfo->singleAntPath == 0) {\n\t\t\t \n\t\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x280);\n\t\t\tpBoardInfo->btdmAntPos = BTC_ANTENNA_AT_MAIN_PORT;\n\t\t} else if (pBoardInfo->singleAntPath == 1) {\n\t\t\t \n\t\t\tpBtCoexist->fBtcWrite4Byte(pBtCoexist, 0x948, 0x0);\n\t\t\tu1Tmp |= 0x1;\t \n\t\t\tpBoardInfo->btdmAntPos = BTC_ANTENNA_AT_AUX_PORT;\n\t\t}\n\n\t\tif (pBtCoexist->chipInterface == BTC_INTF_PCI)\n\t\t\tpBtCoexist->fBtcWriteLocalReg1Byte(pBtCoexist, 0x384, u1Tmp);\n\t\telse if (pBtCoexist->chipInterface == BTC_INTF_SDIO)\n\t\t\tpBtCoexist->fBtcWriteLocalReg1Byte(pBtCoexist, 0x60, u1Tmp);\n\t}\n}\n\nvoid EXhalbtc8723b2ant_InitHwConfig(struct btc_coexist *pBtCoexist, bool bWifiOnly)\n{\n\thalbtc8723b2ant_InitHwConfig(pBtCoexist, true);\n}\n\nvoid EXhalbtc8723b2ant_InitCoexDm(struct btc_coexist *pBtCoexist)\n{\n\thalbtc8723b2ant_InitCoexDm(pBtCoexist);\n}\n\nvoid EXhalbtc8723b2ant_IpsNotify(struct btc_coexist *pBtCoexist, u8 type)\n{\n\tif (BTC_IPS_ENTER == type) {\n\t\tpCoexSta->bUnderIps = true;\n\t\thalbtc8723b2ant_WifiOffHwCfg(pBtCoexist);\n\t\thalbtc8723b2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, true);\n\t\thalbtc8723b2ant_CoexAllOff(pBtCoexist);\n\t} else if (BTC_IPS_LEAVE == type) {\n\t\tpCoexSta->bUnderIps = false;\n\t\thalbtc8723b2ant_InitHwConfig(pBtCoexist, false);\n\t\thalbtc8723b2ant_InitCoexDm(pBtCoexist);\n\t\thalbtc8723b2ant_QueryBtInfo(pBtCoexist);\n\t}\n}\n\nvoid EXhalbtc8723b2ant_LpsNotify(struct btc_coexist *pBtCoexist, u8 type)\n{\n\tif (BTC_LPS_ENABLE == type) {\n\t\tpCoexSta->bUnderLps = true;\n\t} else if (BTC_LPS_DISABLE == type) {\n\t\tpCoexSta->bUnderLps = false;\n\t}\n}\n\nvoid EXhalbtc8723b2ant_ScanNotify(struct btc_coexist *pBtCoexist, u8 type)\n{\n\tif (BTC_SCAN_START == type) {\n\t} else if (BTC_SCAN_FINISH == type) {\n\t}\n}\n\nvoid EXhalbtc8723b2ant_ConnectNotify(struct btc_coexist *pBtCoexist, u8 type)\n{\n\tif (BTC_ASSOCIATE_START == type) {\n\t} else if (BTC_ASSOCIATE_FINISH == type) {\n\t}\n}\n\nvoid EXhalbtc8723b2ant_MediaStatusNotify(struct btc_coexist *pBtCoexist, u8 type)\n{\n\tu8 H2C_Parameter[3] = {0};\n\tu32 wifiBw;\n\tu8 wifiCentralChnl;\n\tu8 apNum = 0;\n\n\t \n\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_WIFI_CENTRAL_CHNL, &wifiCentralChnl);\n\tif ((BTC_MEDIA_CONNECT == type) && (wifiCentralChnl <= 14)) {\n\t\tH2C_Parameter[0] = 0x1;\n\t\tH2C_Parameter[1] = wifiCentralChnl;\n\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_BW, &wifiBw);\n\t\tif (BTC_WIFI_BW_HT40 == wifiBw)\n\t\t\tH2C_Parameter[2] = 0x30;\n\t\telse {\n\t\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U1_AP_NUM, &apNum);\n\t\t\tif (apNum < 10)\n\t\t\t\tH2C_Parameter[2] = 0x30;\n\t\t\telse\n\t\t\t\tH2C_Parameter[2] = 0x20;\n\t\t}\n\t}\n\n\tpCoexDm->wifiChnlInfo[0] = H2C_Parameter[0];\n\tpCoexDm->wifiChnlInfo[1] = H2C_Parameter[1];\n\tpCoexDm->wifiChnlInfo[2] = H2C_Parameter[2];\n\n\tpBtCoexist->fBtcFillH2c(pBtCoexist, 0x66, 3, H2C_Parameter);\n}\n\nvoid EXhalbtc8723b2ant_SpecialPacketNotify(struct btc_coexist *pBtCoexist, u8 type)\n{\n}\n\nvoid EXhalbtc8723b2ant_BtInfoNotify(\n\tstruct btc_coexist *pBtCoexist, u8 *tmpBuf, u8 length\n)\n{\n\tu8 \tbtInfo = 0;\n\tu8 \ti, rspSource = 0;\n\tbool bBtBusy = false, bLimitedDig = false;\n\tbool bWifiConnected = false;\n\n\tpCoexSta->bC2hBtInfoReqSent = false;\n\n\trspSource = tmpBuf[0] & 0xf;\n\tif (rspSource >= BT_INFO_SRC_8723B_2ANT_MAX)\n\t\trspSource = BT_INFO_SRC_8723B_2ANT_WIFI_FW;\n\n\tpCoexSta->btInfoC2hCnt[rspSource]++;\n\n\tfor (i = 0; i < length; i++) {\n\t\tpCoexSta->btInfoC2h[rspSource][i] = tmpBuf[i];\n\t\tif (i == 1)\n\t\t\tbtInfo = tmpBuf[i];\n\n\t}\n\n\tif (pBtCoexist->bManualControl) {\n\t\treturn;\n\t}\n\n\tif (BT_INFO_SRC_8723B_2ANT_WIFI_FW != rspSource) {\n\t\tpCoexSta->btRetryCnt = pCoexSta->btInfoC2h[rspSource][2] & 0xf;  \n\n\t\tpCoexSta->btRssi = pCoexSta->btInfoC2h[rspSource][3] * 2 + 10;\n\n\t\tpCoexSta->btInfoExt = pCoexSta->btInfoC2h[rspSource][4];\n\n\t\tpCoexSta->bBtTxRxMask = (pCoexSta->btInfoC2h[rspSource][2] & 0x40);\n\t\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_TX_RX_MASK, &pCoexSta->bBtTxRxMask);\n\t\tif (pCoexSta->bBtTxRxMask) {\n\t\t\t \n\t\t\tpBtCoexist->fBtcSetBtReg(pBtCoexist, BTC_BT_REG_RF, 0x3c, 0x01);\n\t\t}\n\n\t\t \n\t\t \n\t\tif ((pCoexSta->btInfoExt & BIT1)) {\n\t\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_BL_WIFI_CONNECTED, &bWifiConnected);\n\n\t\t\tif (bWifiConnected)\n\t\t\t\tEXhalbtc8723b2ant_MediaStatusNotify(pBtCoexist, BTC_MEDIA_CONNECT);\n\t\t\telse\n\t\t\t\tEXhalbtc8723b2ant_MediaStatusNotify(pBtCoexist, BTC_MEDIA_DISCONNECT);\n\t\t}\n\n\t\tif ((pCoexSta->btInfoExt & BIT3)) {\n\t\t\thalbtc8723b2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, false);\n\t\t} else {\n\t\t\t \n\t\t}\n\t}\n\n\t \n\tif (btInfo & BT_INFO_8723B_2ANT_B_INQ_PAGE)\n\t\tpCoexSta->bC2hBtInquiryPage = true;\n\telse\n\t\tpCoexSta->bC2hBtInquiryPage = false;\n\n\t \n\tif (!(btInfo & BT_INFO_8723B_2ANT_B_CONNECTION)) {\n\t\tpCoexSta->bBtLinkExist = false;\n\t\tpCoexSta->bPanExist = false;\n\t\tpCoexSta->bA2dpExist = false;\n\t\tpCoexSta->bHidExist = false;\n\t\tpCoexSta->bScoExist = false;\n\t} else {  \n\t\tpCoexSta->bBtLinkExist = true;\n\t\tif (btInfo & BT_INFO_8723B_2ANT_B_FTP)\n\t\t\tpCoexSta->bPanExist = true;\n\t\telse\n\t\t\tpCoexSta->bPanExist = false;\n\t\tif (btInfo & BT_INFO_8723B_2ANT_B_A2DP)\n\t\t\tpCoexSta->bA2dpExist = true;\n\t\telse\n\t\t\tpCoexSta->bA2dpExist = false;\n\t\tif (btInfo & BT_INFO_8723B_2ANT_B_HID)\n\t\t\tpCoexSta->bHidExist = true;\n\t\telse\n\t\t\tpCoexSta->bHidExist = false;\n\t\tif (btInfo & BT_INFO_8723B_2ANT_B_SCO_ESCO)\n\t\t\tpCoexSta->bScoExist = true;\n\t\telse\n\t\t\tpCoexSta->bScoExist = false;\n\t}\n\n\thalbtc8723b2ant_UpdateBtLinkInfo(pBtCoexist);\n\n\tif (!(btInfo & BT_INFO_8723B_2ANT_B_CONNECTION)) {\n\t\tpCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_NON_CONNECTED_IDLE;\n\t} else if (btInfo == BT_INFO_8723B_2ANT_B_CONNECTION)\t{  \n\t\tpCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_CONNECTED_IDLE;\n\t} else if (\n\t\t(btInfo & BT_INFO_8723B_2ANT_B_SCO_ESCO) ||\n\t\t(btInfo & BT_INFO_8723B_2ANT_B_SCO_BUSY)\n\t) {\n\t\tpCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_SCO_BUSY;\n\t} else if (btInfo & BT_INFO_8723B_2ANT_B_ACL_BUSY) {\n\t\tpCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_ACL_BUSY;\n\t} else {\n\t\tpCoexDm->btStatus = BT_8723B_2ANT_BT_STATUS_MAX;\n\t}\n\n\tif (\n\t\t(BT_8723B_2ANT_BT_STATUS_ACL_BUSY == pCoexDm->btStatus) ||\n\t\t(BT_8723B_2ANT_BT_STATUS_SCO_BUSY == pCoexDm->btStatus) ||\n\t\t(BT_8723B_2ANT_BT_STATUS_ACL_SCO_BUSY == pCoexDm->btStatus)\n\t) {\n\t\tbBtBusy = true;\n\t\tbLimitedDig = true;\n\t} else {\n\t\tbBtBusy = false;\n\t\tbLimitedDig = false;\n\t}\n\n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_TRAFFIC_BUSY, &bBtBusy);\n\n\tpCoexDm->bLimitedDig = bLimitedDig;\n\tpBtCoexist->fBtcSet(pBtCoexist, BTC_SET_BL_BT_LIMITED_DIG, &bLimitedDig);\n\n\thalbtc8723b2ant_RunCoexistMechanism(pBtCoexist);\n}\n\nvoid EXhalbtc8723b2ant_HaltNotify(struct btc_coexist *pBtCoexist)\n{\n\thalbtc8723b2ant_WifiOffHwCfg(pBtCoexist);\n\tpBtCoexist->fBtcSetBtReg(pBtCoexist, BTC_BT_REG_RF, 0x3c, 0x15);  \n\thalbtc8723b2ant_IgnoreWlanAct(pBtCoexist, FORCE_EXEC, true);\n\n\tEXhalbtc8723b2ant_MediaStatusNotify(pBtCoexist, BTC_MEDIA_DISCONNECT);\n}\n\nvoid EXhalbtc8723b2ant_PnpNotify(struct btc_coexist *pBtCoexist, u8 pnpState)\n{\n\tif (BTC_WIFI_PNP_SLEEP == pnpState) {\n\t} else if (BTC_WIFI_PNP_WAKE_UP == pnpState) {\n\t\thalbtc8723b2ant_InitHwConfig(pBtCoexist, false);\n\t\thalbtc8723b2ant_InitCoexDm(pBtCoexist);\n\t\thalbtc8723b2ant_QueryBtInfo(pBtCoexist);\n\t}\n}\n\nvoid EXhalbtc8723b2ant_Periodical(struct btc_coexist *pBtCoexist)\n{\n\tstatic u8 disVerInfoCnt;\n\tu32 fwVer = 0, btPatchVer = 0;\n\n\tif (disVerInfoCnt <= 5) {\n\t\tdisVerInfoCnt += 1;\n\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_BT_PATCH_VER, &btPatchVer);\n\t\tpBtCoexist->fBtcGet(pBtCoexist, BTC_GET_U4_WIFI_FW_VER, &fwVer);\n\t}\n\n\tif (\n\t\thalbtc8723b2ant_IsWifiStatusChanged(pBtCoexist) ||\n\t\tpCoexDm->bAutoTdmaAdjust\n\t)\n\t\thalbtc8723b2ant_RunCoexistMechanism(pBtCoexist);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}