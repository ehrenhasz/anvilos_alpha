{
  "module_name": "HalPhyRf_8723B.c",
  "hash_id": "0f5797bc8a6064422ebb5032c1540b5126a53020ea8ee5c10660efda54e9c225",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8723bs/hal/HalPhyRf_8723B.c",
  "human_readable_source": "\n \n\n#include <drv_types.h>\n#include <rtw_debug.h>\n#include \"odm_precomp.h\"\n\n \n#define\t\tPATH_S0\t\t\t\t\t\t\t1  \n#define\t\tIDX_0xC94\t\t\t\t\t\t0\n#define\t\tIDX_0xC80\t\t\t\t\t\t1\n#define\t\tIDX_0xC14\t\t\t\t\t\t0\n#define\t\tIDX_0xCA0\t\t\t\t\t\t1\n#define\t\tKEY\t\t\t\t\t\t\t0\n#define\t\tVAL\t\t\t\t\t\t\t1\n\n \n#define\t\tPATH_S1\t\t\t\t\t\t\t0  \n#define\t\tIDX_0xC4C\t\t\t\t\t\t2\n\n \n\n \nstatic u8 DeltaSwingTableIdx_2GA_N_8188E[] = {\n\t0, 0, 0, 2, 2, 3, 3, 4,  4,  4,  4,  5,  5,  6,  6,\n\t7, 7, 7, 7, 8, 8, 9, 9, 10, 10, 10, 11, 11, 11, 11\n};\nstatic u8 DeltaSwingTableIdx_2GA_P_8188E[] = {\n\t0, 0, 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 4, 4, 4,\n\t4, 4, 4, 5, 5, 7, 7, 8, 8, 8, 9, 9, 9, 9, 9\n};\n\n \n \n \n\n\nstatic void setIqkMatrix_8723B(\n\tstruct dm_odm_t *pDM_Odm,\n\tu8 OFDM_index,\n\tu8 RFPath,\n\ts32 IqkResult_X,\n\ts32 IqkResult_Y\n)\n{\n\ts32 ele_A = 0, ele_D, ele_C = 0, value32;\n\n\tif (OFDM_index >= OFDM_TABLE_SIZE)\n\t\tOFDM_index = OFDM_TABLE_SIZE-1;\n\n\tele_D = (OFDMSwingTable_New[OFDM_index] & 0xFFC00000)>>22;\n\n\t \n\tif (IqkResult_X != 0) {\n\t\tif ((IqkResult_X & 0x00000200) != 0)\t \n\t\t\tIqkResult_X = IqkResult_X | 0xFFFFFC00;\n\t\tele_A = ((IqkResult_X * ele_D)>>8)&0x000003FF;\n\n\t\t \n\t\tif ((IqkResult_Y & 0x00000200) != 0)\n\t\t\tIqkResult_Y = IqkResult_Y | 0xFFFFFC00;\n\t\tele_C = ((IqkResult_Y * ele_D)>>8)&0x000003FF;\n\n\t\t \n\t\tswitch (RFPath) {\n\t\tcase RF_PATH_A:\n\t\t\t \n\t\t\tvalue32 = (ele_D<<22)|((ele_C&0x3F)<<16)|ele_A;\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XATxIQImbalance, bMaskDWord, value32);\n\n\t\t\tvalue32 = (ele_C&0x000003C0)>>6;\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XCTxAFE, bMaskH4Bits, value32);\n\n\t\t\tvalue32 = ((IqkResult_X * ele_D)>>7)&0x01;\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT24, value32);\n\t\t\tbreak;\n\t\tcase RF_PATH_B:\n\t\t\t \n\t\t\tvalue32 = (ele_D<<22)|((ele_C&0x3F)<<16)|ele_A;\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XBTxIQImbalance, bMaskDWord, value32);\n\n\t\t\tvalue32 = (ele_C&0x000003C0)>>6;\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XDTxAFE, bMaskH4Bits, value32);\n\n\t\t\tvalue32 = ((IqkResult_X * ele_D)>>7)&0x01;\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT28, value32);\n\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tswitch (RFPath) {\n\t\tcase RF_PATH_A:\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XATxIQImbalance, bMaskDWord, OFDMSwingTable_New[OFDM_index]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XCTxAFE, bMaskH4Bits, 0x00);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT24, 0x00);\n\t\t\tbreak;\n\n\t\tcase RF_PATH_B:\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XBTxIQImbalance, bMaskDWord, OFDMSwingTable_New[OFDM_index]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XDTxAFE, bMaskH4Bits, 0x00);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT28, 0x00);\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\n\nstatic void setCCKFilterCoefficient(struct dm_odm_t *pDM_Odm, u8 CCKSwingIndex)\n{\n\tif (!pDM_Odm->RFCalibrateInfo.bCCKinCH14) {\n\t\trtw_write8(pDM_Odm->Adapter, 0xa22, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][0]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa23, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][1]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa24, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][2]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa25, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][3]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa26, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][4]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa27, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][5]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa28, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][6]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa29, CCKSwingTable_Ch1_Ch13_New[CCKSwingIndex][7]);\n\t} else {\n\t\trtw_write8(pDM_Odm->Adapter, 0xa22, CCKSwingTable_Ch14_New[CCKSwingIndex][0]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa23, CCKSwingTable_Ch14_New[CCKSwingIndex][1]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa24, CCKSwingTable_Ch14_New[CCKSwingIndex][2]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa25, CCKSwingTable_Ch14_New[CCKSwingIndex][3]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa26, CCKSwingTable_Ch14_New[CCKSwingIndex][4]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa27, CCKSwingTable_Ch14_New[CCKSwingIndex][5]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa28, CCKSwingTable_Ch14_New[CCKSwingIndex][6]);\n\t\trtw_write8(pDM_Odm->Adapter, 0xa29, CCKSwingTable_Ch14_New[CCKSwingIndex][7]);\n\t}\n}\n\nvoid DoIQK_8723B(\n\tstruct dm_odm_t *pDM_Odm,\n\tu8 DeltaThermalIndex,\n\tu8 ThermalValue,\n\tu8 Threshold\n)\n{\n}\n\n \nvoid ODM_TxPwrTrackSetPwr_8723B(\n\tstruct dm_odm_t *pDM_Odm,\n\tenum pwrtrack_method Method,\n\tu8 RFPath,\n\tu8 ChannelMappedIndex\n)\n{\n\tstruct adapter *Adapter = pDM_Odm->Adapter;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\tu8 PwrTrackingLimit_OFDM = 34;  \n\tu8 PwrTrackingLimit_CCK = 28;  \n\tu8 TxRate = 0xFF;\n\tu8 Final_OFDM_Swing_Index = 0;\n\tu8 Final_CCK_Swing_Index = 0;\n\n\t{\n\t\tu16 rate = *(pDM_Odm->pForcedDataRate);\n\n\t\tif (!rate) {  \n\t\t\tif (pDM_Odm->TxRate != 0xFF)\n\t\t\t\tTxRate = HwRateToMRate(pDM_Odm->TxRate);\n\t\t} else  \n\t\t\tTxRate = (u8)rate;\n\n\t}\n\n\tif (TxRate != 0xFF) {\n\t\t \n\t\tif ((TxRate >= MGN_1M) && (TxRate <= MGN_11M))\n\t\t\tPwrTrackingLimit_CCK = 28;\t \n\t\t \n\t\telse if ((TxRate >= MGN_6M) && (TxRate <= MGN_48M))\n\t\t\tPwrTrackingLimit_OFDM = 36;  \n\t\telse if (TxRate == MGN_54M)\n\t\t\tPwrTrackingLimit_OFDM = 34;  \n\n\t\t \n\t\telse if ((TxRate >= MGN_MCS0) && (TxRate <= MGN_MCS2))  \n\t\t\tPwrTrackingLimit_OFDM = 38;  \n\t\telse if ((TxRate >= MGN_MCS3) && (TxRate <= MGN_MCS4))  \n\t\t\tPwrTrackingLimit_OFDM = 36;  \n\t\telse if ((TxRate >= MGN_MCS5) && (TxRate <= MGN_MCS7))  \n\t\t\tPwrTrackingLimit_OFDM = 34;  \n\n\t\telse\n\t\t\tPwrTrackingLimit_OFDM =  pDM_Odm->DefaultOfdmIndex;    \n\t}\n\n\tif (Method == TXAGC) {\n\t\tstruct adapter *Adapter = pDM_Odm->Adapter;\n\n\t\tpDM_Odm->Remnant_OFDMSwingIdx[RFPath] = pDM_Odm->Absolute_OFDMSwingIdx[RFPath];\n\n\t\tpDM_Odm->Modify_TxAGC_Flag_PathA = true;\n\t\tpDM_Odm->Modify_TxAGC_Flag_PathA_CCK = true;\n\n\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, CCK);\n\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, OFDM);\n\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, HT_MCS0_MCS7);\n\t} else if (Method == BBSWING) {\n\t\tFinal_OFDM_Swing_Index = pDM_Odm->DefaultOfdmIndex + pDM_Odm->Absolute_OFDMSwingIdx[RFPath];\n\t\tFinal_CCK_Swing_Index = pDM_Odm->DefaultCckIndex + pDM_Odm->Absolute_OFDMSwingIdx[RFPath];\n\n\t\t \n\t\tif (Final_OFDM_Swing_Index >= PwrTrackingLimit_OFDM)\n\t\t\tFinal_OFDM_Swing_Index = PwrTrackingLimit_OFDM;\n\t\telse if (Final_OFDM_Swing_Index <= 0)\n\t\t\tFinal_OFDM_Swing_Index = 0;\n\n\t\tif (Final_CCK_Swing_Index >= CCK_TABLE_SIZE)\n\t\t\tFinal_CCK_Swing_Index = CCK_TABLE_SIZE-1;\n\t\telse if (pDM_Odm->BbSwingIdxCck <= 0)\n\t\t\tFinal_CCK_Swing_Index = 0;\n\n\t\tsetIqkMatrix_8723B(pDM_Odm, Final_OFDM_Swing_Index, RFPath,\n\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][0],\n\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][1]);\n\n\t\tsetCCKFilterCoefficient(pDM_Odm, Final_CCK_Swing_Index);\n\n\t} else if (Method == MIX_MODE) {\n\t\tFinal_OFDM_Swing_Index = pDM_Odm->DefaultOfdmIndex + pDM_Odm->Absolute_OFDMSwingIdx[RFPath];\n\t\tFinal_CCK_Swing_Index = pDM_Odm->DefaultCckIndex + pDM_Odm->Absolute_OFDMSwingIdx[RFPath];\n\n\t\tif (Final_OFDM_Swing_Index > PwrTrackingLimit_OFDM) {  \n\t\t\tpDM_Odm->Remnant_OFDMSwingIdx[RFPath] = Final_OFDM_Swing_Index - PwrTrackingLimit_OFDM;\n\n\t\t\tsetIqkMatrix_8723B(pDM_Odm, PwrTrackingLimit_OFDM, RFPath,\n\t\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][0],\n\t\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][1]);\n\n\t\t\tpDM_Odm->Modify_TxAGC_Flag_PathA = true;\n\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, OFDM);\n\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, HT_MCS0_MCS7);\n\t\t} else if (Final_OFDM_Swing_Index <= 0) {\n\t\t\tpDM_Odm->Remnant_OFDMSwingIdx[RFPath] = Final_OFDM_Swing_Index;\n\n\t\t\tsetIqkMatrix_8723B(pDM_Odm, 0, RFPath,\n\t\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][0],\n\t\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][1]);\n\n\t\t\tpDM_Odm->Modify_TxAGC_Flag_PathA = true;\n\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, OFDM);\n\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, HT_MCS0_MCS7);\n\t\t} else {\n\t\t\tsetIqkMatrix_8723B(pDM_Odm, Final_OFDM_Swing_Index, RFPath,\n\t\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][0],\n\t\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[ChannelMappedIndex][1]);\n\n\t\t\tif (pDM_Odm->Modify_TxAGC_Flag_PathA) {  \n\t\t\t\tpDM_Odm->Remnant_OFDMSwingIdx[RFPath] = 0;\n\t\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, OFDM);\n\t\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, HT_MCS0_MCS7);\n\t\t\t\tpDM_Odm->Modify_TxAGC_Flag_PathA = false;\n\t\t\t}\n\t\t}\n\n\t\tif (Final_CCK_Swing_Index > PwrTrackingLimit_CCK) {\n\t\t\tpDM_Odm->Remnant_CCKSwingIdx = Final_CCK_Swing_Index - PwrTrackingLimit_CCK;\n\t\t\tsetCCKFilterCoefficient(pDM_Odm, PwrTrackingLimit_CCK);\n\t\t\tpDM_Odm->Modify_TxAGC_Flag_PathA_CCK = true;\n\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, CCK);\n\t\t} else if (Final_CCK_Swing_Index <= 0) {  \n\t\t\tpDM_Odm->Remnant_CCKSwingIdx = Final_CCK_Swing_Index;\n\t\t\tsetCCKFilterCoefficient(pDM_Odm, 0);\n\t\t\tpDM_Odm->Modify_TxAGC_Flag_PathA_CCK = true;\n\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, CCK);\n\t\t} else {\n\t\t\tsetCCKFilterCoefficient(pDM_Odm, Final_CCK_Swing_Index);\n\n\t\t\tif (pDM_Odm->Modify_TxAGC_Flag_PathA_CCK) {  \n\t\t\t\tpDM_Odm->Remnant_CCKSwingIdx = 0;\n\t\t\t\tPHY_SetTxPowerIndexByRateSection(Adapter, RFPath, pHalData->CurrentChannel, CCK);\n\t\t\t\tpDM_Odm->Modify_TxAGC_Flag_PathA_CCK = false;\n\t\t\t}\n\t\t}\n\t} else\n\t\treturn;  \n}\n\nstatic void GetDeltaSwingTable_8723B(\n\tstruct dm_odm_t *pDM_Odm,\n\tu8 **TemperatureUP_A,\n\tu8 **TemperatureDOWN_A,\n\tu8 **TemperatureUP_B,\n\tu8 **TemperatureDOWN_B\n)\n{\n\tstruct adapter *Adapter = pDM_Odm->Adapter;\n\tstruct odm_rf_cal_t *pRFCalibrateInfo = &pDM_Odm->RFCalibrateInfo;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(Adapter);\n\tu16 rate = *(pDM_Odm->pForcedDataRate);\n\tu8 channel = pHalData->CurrentChannel;\n\n\tif (1 <= channel && channel <= 14) {\n\t\tif (IS_CCK_RATE(rate)) {\n\t\t\t*TemperatureUP_A   = pRFCalibrateInfo->DeltaSwingTableIdx_2GCCKA_P;\n\t\t\t*TemperatureDOWN_A = pRFCalibrateInfo->DeltaSwingTableIdx_2GCCKA_N;\n\t\t\t*TemperatureUP_B   = pRFCalibrateInfo->DeltaSwingTableIdx_2GCCKB_P;\n\t\t\t*TemperatureDOWN_B = pRFCalibrateInfo->DeltaSwingTableIdx_2GCCKB_N;\n\t\t} else {\n\t\t\t*TemperatureUP_A   = pRFCalibrateInfo->DeltaSwingTableIdx_2GA_P;\n\t\t\t*TemperatureDOWN_A = pRFCalibrateInfo->DeltaSwingTableIdx_2GA_N;\n\t\t\t*TemperatureUP_B   = pRFCalibrateInfo->DeltaSwingTableIdx_2GB_P;\n\t\t\t*TemperatureDOWN_B = pRFCalibrateInfo->DeltaSwingTableIdx_2GB_N;\n\t\t}\n\t} else {\n\t\t*TemperatureUP_A   = (u8 *)DeltaSwingTableIdx_2GA_P_8188E;\n\t\t*TemperatureDOWN_A = (u8 *)DeltaSwingTableIdx_2GA_N_8188E;\n\t\t*TemperatureUP_B   = (u8 *)DeltaSwingTableIdx_2GA_P_8188E;\n\t\t*TemperatureDOWN_B = (u8 *)DeltaSwingTableIdx_2GA_N_8188E;\n\t}\n}\n\n\nvoid ConfigureTxpowerTrack_8723B(struct txpwrtrack_cfg *pConfig)\n{\n\tpConfig->SwingTableSize_CCK = CCK_TABLE_SIZE;\n\tpConfig->SwingTableSize_OFDM = OFDM_TABLE_SIZE;\n\tpConfig->Threshold_IQK = IQK_THRESHOLD;\n\tpConfig->AverageThermalNum = AVG_THERMAL_NUM_8723B;\n\tpConfig->RfPathCount = MAX_PATH_NUM_8723B;\n\tpConfig->ThermalRegAddr = RF_T_METER_8723B;\n\n\tpConfig->ODM_TxPwrTrackSetPwr = ODM_TxPwrTrackSetPwr_8723B;\n\tpConfig->DoIQK = DoIQK_8723B;\n\tpConfig->PHY_LCCalibrate = PHY_LCCalibrate_8723B;\n\tpConfig->GetDeltaSwingTable = GetDeltaSwingTable_8723B;\n}\n\n \n#define MAX_TOLERANCE\t\t5\n\n \nstatic u8 phy_PathA_IQK_8723B(\n\tstruct adapter *padapter, bool configPathB, u8 RF_Path\n)\n{\n\tu32 regEAC, regE94, regE9C, tmp, Path_SEL_BB  ;\n\tu8 result = 0x00;\n\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\t \n\tPath_SEL_BB = PHY_QueryBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_WE_LUT, 0x80000, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_RCK_OS, bRFRegOffsetMask, 0x18000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G1, bRFRegOffsetMask, 0x0003f);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G2, bRFRegOffsetMask, 0xc7f87);\n\t \n \n \n\n\t \n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK, bMaskDWord, 0x01007c00);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK, bMaskDWord, 0x01004800);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_A, bMaskDWord, 0x18008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_A, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_A, bMaskDWord, 0x821303ea);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_A, bMaskDWord, 0x28110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_B, bMaskDWord, 0x82110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_B, bMaskDWord, 0x28110000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Rsp, bMaskDWord, 0x00462911);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x808000);\n\n\t \n\tif (configPathB || (RF_Path == 0))\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000000);\n\telse\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000280);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00000800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf9000000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);\n\n\t \n\t \n\tmdelay(IQK_DELAY_TIME_8723B);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, Path_SEL_BB);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00001800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\n\t \n\tregEAC = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord);\n\tregE94 = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_Before_IQK_A, bMaskDWord);\n\tregE9C = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_After_IQK_A, bMaskDWord);\n\n\n\t \n\ttmp = (regE9C & 0x03FF0000)>>16;\n\tif ((tmp & 0x200) > 0)\n\t\ttmp = 0x400 - tmp;\n\n\tif (\n\t\t!(regEAC & BIT28) &&\n\t\t(((regE94 & 0x03FF0000)>>16) != 0x142) &&\n\t\t(((regE9C & 0x03FF0000)>>16) != 0x42) &&\n\t\t(((regE94 & 0x03FF0000)>>16) < 0x110) &&\n\t\t(((regE94 & 0x03FF0000)>>16) > 0xf0) &&\n\t\t(tmp < 0xf)\n\t)\n\t\tresult |= 0x01;\n\telse\t\t\t\t\t \n\t\treturn result;\n\n\treturn result;\n}\n\n \nstatic u8 phy_PathA_RxIQK8723B(\n\tstruct adapter *padapter, bool configPathB, u8 RF_Path\n)\n{\n\tu32 regEAC, regE94, regE9C, regEA4, u4tmp, tmp, Path_SEL_BB;\n\tu8 result = 0x00;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\t \n\tPath_SEL_BB = PHY_QueryBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\t \n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_WE_LUT, 0x80000, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_RCK_OS, bRFRegOffsetMask, 0x18000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G1, bRFRegOffsetMask, 0x0001f);\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G2, bRFRegOffsetMask, 0xf7fb7);\n \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x808000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK, bMaskDWord, 0x01007c00);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK, bMaskDWord, 0x01004800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_A, bMaskDWord, 0x18008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_A, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\n \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_A, bMaskDWord, 0x82130ff0);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_A, bMaskDWord, 0x28110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_B, bMaskDWord, 0x82110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_B, bMaskDWord, 0x28110000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Rsp, bMaskDWord, 0x0046a911);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x808000);\n\n\t \n\tif (configPathB || (RF_Path == 0))\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000000);\n\telse\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000280);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00000800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf9000000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);\n\n\t \n\t \n\tmdelay(IQK_DELAY_TIME_8723B);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, Path_SEL_BB);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00001800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n\tregEAC = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord);\n\tregE94 = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_Before_IQK_A, bMaskDWord);\n\tregE9C = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_After_IQK_A, bMaskDWord);\n\n\t \n\ttmp = (regE9C & 0x03FF0000)>>16;\n\tif ((tmp & 0x200) > 0)\n\t\ttmp = 0x400 - tmp;\n\n\tif (\n\t\t!(regEAC & BIT28) &&\n\t\t(((regE94 & 0x03FF0000)>>16) != 0x142) &&\n\t\t(((regE9C & 0x03FF0000)>>16) != 0x42) &&\n\t\t(((regE94 & 0x03FF0000)>>16) < 0x110) &&\n\t\t(((regE94 & 0x03FF0000)>>16) > 0xf0) &&\n\t\t(tmp < 0xf)\n\t)\n\t\tresult |= 0x01;\n\telse\t\t\t\t \n\t\treturn result;\n\n\tu4tmp = 0x80007C00 | (regE94&0x3FF0000) | ((regE9C&0x3FF0000) >> 16);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK, bMaskDWord, u4tmp);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_WE_LUT, 0x80000, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_RCK_OS, bRFRegOffsetMask, 0x18000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G1, bRFRegOffsetMask, 0x0001f);\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G2, bRFRegOffsetMask, 0xf7d77);\n \n\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xdf, bRFRegOffsetMask, 0xf80);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0x55, bRFRegOffsetMask, 0x4021f);\n\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK, bMaskDWord, 0x01004800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_A, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_A, bMaskDWord, 0x18008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_A, bMaskDWord, 0x82110000);\n \n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_A, bMaskDWord, 0x2813001f);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_B, bMaskDWord, 0x82110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_B, bMaskDWord, 0x28110000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Rsp, bMaskDWord, 0x0046a8d1);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x808000);\n\n\t \n\tif (configPathB || (RF_Path == 0))\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000000);\n\telse\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000280);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00000800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf9000000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);\n\n\t \n\t \n\tmdelay(IQK_DELAY_TIME_8723B);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, Path_SEL_BB);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00001800);\n\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n\tregEAC = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord);\n\tregEA4 = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_Before_IQK_A_2, bMaskDWord);\n\n\t \n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xdf, bRFRegOffsetMask, 0x780);\n\n\t \n\ttmp = (regEAC & 0x03FF0000)>>16;\n\tif ((tmp & 0x200) > 0)\n\t\ttmp = 0x400 - tmp;\n\n\tif (\n\t\t!(regEAC & BIT27) &&  \n\t\t(((regEA4 & 0x03FF0000)>>16) != 0x132) &&\n\t\t(((regEAC & 0x03FF0000)>>16) != 0x36) &&\n\t\t(((regEA4 & 0x03FF0000)>>16) < 0x110) &&\n\t\t(((regEA4 & 0x03FF0000)>>16) > 0xf0) &&\n\t\t(tmp < 0xf)\n\t)\n\t\tresult |= 0x02;\n\n\treturn result;\n}\n\n \nstatic u8 phy_PathB_IQK_8723B(struct adapter *padapter)\n{\n\tu32 regEAC, regE94, regE9C, tmp, Path_SEL_BB ;\n\tu8 result = 0x00;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\t \n\tPath_SEL_BB = PHY_QueryBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord);\n\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n \n \n \n \n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xed, 0x20, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0x43, bRFRegOffsetMask, 0x30fc1);\n\n\n\n\t \n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK, bMaskDWord, 0x01007c00);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK, bMaskDWord, 0x01004800);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_A, bMaskDWord, 0x18008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_A, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\n \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_A, bMaskDWord, 0x821303ea);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_A, bMaskDWord, 0x28110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_B, bMaskDWord, 0x82110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_B, bMaskDWord, 0x28110000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Rsp, bMaskDWord, 0x00462911);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x808000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000280);\n \n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00000800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf9000000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);\n\n\t \n\t \n\tmdelay(IQK_DELAY_TIME_8723B);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, Path_SEL_BB);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00001800);\n\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n\tregEAC = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord);\n\tregE94 = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_Before_IQK_A, bMaskDWord);\n\tregE9C = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_After_IQK_A, bMaskDWord);\n\n\t \n\ttmp = (regE9C & 0x03FF0000)>>16;\n\tif ((tmp & 0x200) > 0)\n\t\ttmp = 0x400 - tmp;\n\n\tif (\n\t\t!(regEAC & BIT28) &&\n\t\t(((regE94 & 0x03FF0000)>>16) != 0x142) &&\n\t\t(((regE9C & 0x03FF0000)>>16) != 0x42) &&\n\t\t(((regE94 & 0x03FF0000)>>16) < 0x110) &&\n\t\t(((regE94 & 0x03FF0000)>>16) > 0xf0) &&\n\t\t(tmp < 0xf)\n\t)\n\t\tresult |= 0x01;\n\n\treturn result;\n}\n\n \nstatic u8 phy_PathB_RxIQK8723B(struct adapter *padapter, bool configPathB)\n{\n\tu32 regE94, regE9C, regEA4, regEAC, u4tmp, tmp, Path_SEL_BB;\n\tu8 result = 0x00;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\t \n\tPath_SEL_BB = PHY_QueryBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord);\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000280);\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_WE_LUT, 0x80000, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_RCK_OS, bRFRegOffsetMask, 0x18000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G1, bRFRegOffsetMask, 0x0001f);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G2, bRFRegOffsetMask, 0xf7fb7);\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xed, 0x20, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0x43, bRFRegOffsetMask, 0x30fcd);\n\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK, bMaskDWord, 0x01007c00);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK, bMaskDWord, 0x01004800);\n\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_A, bMaskDWord, 0x18008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_A, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\n \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_A, bMaskDWord, 0x82130ff0);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_A, bMaskDWord, 0x28110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_B, bMaskDWord, 0x82110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_B, bMaskDWord, 0x28110000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Rsp, bMaskDWord, 0x0046a911);\n\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x808000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000280);\n \n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00000800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf9000000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);\n\n\n\t \n\t \n\tmdelay(IQK_DELAY_TIME_8723B);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, Path_SEL_BB);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00001800);\n\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n\tregEAC = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord);\n\tregE94 = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_Before_IQK_A, bMaskDWord);\n\tregE9C = PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_After_IQK_A, bMaskDWord);\n\n\t \n\ttmp = (regE9C & 0x03FF0000)>>16;\n\tif ((tmp & 0x200) > 0)\n\t\ttmp = 0x400 - tmp;\n\n\tif (\n\t\t!(regEAC & BIT28) &&\n\t\t(((regE94 & 0x03FF0000)>>16) != 0x142) &&\n\t\t(((regE9C & 0x03FF0000)>>16) != 0x42)  &&\n\t\t(((regE94 & 0x03FF0000)>>16) < 0x110) &&\n\t\t(((regE94 & 0x03FF0000)>>16) > 0xf0) &&\n\t\t(tmp < 0xf)\n\t)\n\t\t\tresult |= 0x01;\n\telse\t \n\t\treturn result;\n\n\tu4tmp = 0x80007C00 | (regE94&0x3FF0000)  | ((regE9C&0x3FF0000) >> 16);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK, bMaskDWord, u4tmp);\n\n\t \n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_WE_LUT, 0x80000, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_RCK_OS, bRFRegOffsetMask, 0x18000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G1, bRFRegOffsetMask, 0x0001f);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G2, bRFRegOffsetMask, 0xf7d77);\n \n\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xed, 0x20, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0x43, bRFRegOffsetMask, 0x30ebd);\n\n\t \n \n \n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK, bMaskDWord, 0x01004800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_A, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_A, bMaskDWord, 0x18008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_B, bMaskDWord, 0x38008c1c);\n\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_A, bMaskDWord, 0x82110000);\n \n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_A, bMaskDWord, 0x2813001f);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_PI_B, bMaskDWord, 0x82110000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_PI_B, bMaskDWord, 0x28110000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Rsp, bMaskDWord, 0x0046a8d1);\n\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x808000);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, 0x00000280);\n \n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00000800);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf9000000);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rIQK_AGC_Pts, bMaskDWord, 0xf8000000);\n\n\t \n\t \n\tmdelay(IQK_DELAY_TIME_8723B);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x948, bMaskDWord, Path_SEL_BB);\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, 0x00001800);\n\n     \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\n\t \n\tregEAC = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord);\n\tregEA4 = PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_Before_IQK_A_2, bMaskDWord);\n\n\t \n\t \n \n \n\n\n\n\t \n\ttmp = (regEAC & 0x03FF0000)>>16;\n\tif ((tmp & 0x200) > 0)\n\t\ttmp = 0x400 - tmp;\n\n\tif (\n\t\t!(regEAC & BIT27) &&  \n\t\t(((regEA4 & 0x03FF0000)>>16) != 0x132) &&\n\t\t(((regEAC & 0x03FF0000)>>16) != 0x36) &&\n\t\t(((regEA4 & 0x03FF0000)>>16) < 0x110) &&\n\t\t(((regEA4 & 0x03FF0000)>>16) > 0xf0) &&\n\t\t(tmp < 0xf)\n\t)\n\t\tresult |= 0x02;\n\n\treturn result;\n}\n\nstatic void _PHY_PathAFillIQKMatrix8723B(\n\tstruct adapter *padapter,\n\tbool bIQKOK,\n\ts32 result[][8],\n\tu8 final_candidate,\n\tbool bTxOnly\n)\n{\n\tu32 Oldval_0, X, TX0_A, reg;\n\ts32 Y, TX0_C;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\tstruct odm_rf_cal_t *pRFCalibrateInfo = &pDM_Odm->RFCalibrateInfo;\n\n\tif (final_candidate == 0xFF)\n\t\treturn;\n\n\telse if (bIQKOK) {\n\t\tOldval_0 = (PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XATxIQImbalance, bMaskDWord) >> 22) & 0x3FF;\n\n\t\tX = result[final_candidate][0];\n\t\tif ((X & 0x00000200) != 0)\n\t\t\tX = X | 0xFFFFFC00;\n\t\tTX0_A = (X * Oldval_0) >> 8;\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XATxIQImbalance, 0x3FF, TX0_A);\n\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT(31), ((X*Oldval_0>>7) & 0x1));\n\n\t\tY = result[final_candidate][1];\n\t\tif ((Y & 0x00000200) != 0)\n\t\t\tY = Y | 0xFFFFFC00;\n\n\t\t \n\t\tTX0_C = (Y * Oldval_0) >> 8;\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XCTxAFE, 0xF0000000, ((TX0_C&0x3C0)>>6));\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC94][KEY] = rOFDM0_XCTxAFE;\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC94][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XCTxAFE, bMaskDWord);\n\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XATxIQImbalance, 0x003F0000, (TX0_C&0x3F));\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC80][KEY] = rOFDM0_XATxIQImbalance;\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC80][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XATxIQImbalance, bMaskDWord);\n\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT(29), ((Y*Oldval_0>>7) & 0x1));\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC4C][KEY] = rOFDM0_ECCAThreshold;\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC4C][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, bMaskDWord);\n\n\t\tif (bTxOnly) {\n\t\t\t \n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xCA0][KEY] = rOFDM0_RxIQExtAnta;\n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xCA0][VAL] = 0xfffffff & PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_RxIQExtAnta, bMaskDWord);\n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xC14][KEY] = rOFDM0_XARxIQImbalance;\n \n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xC14][VAL] = 0x40000100;\n\t\t\treturn;\n\t\t}\n\n\t\treg = result[final_candidate][2];\n\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XARxIQImbalance, 0x3FF, reg);\n\t\treg = result[final_candidate][3] & 0x3F;\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XARxIQImbalance, 0xFC00, reg);\n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xC14][KEY] = rOFDM0_XARxIQImbalance;\n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xC14][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XARxIQImbalance, bMaskDWord);\n\n\t\treg = (result[final_candidate][3] >> 6) & 0xF;\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_RxIQExtAnta, 0xF0000000, reg);\n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xCA0][KEY] = rOFDM0_RxIQExtAnta;\n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xCA0][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_RxIQExtAnta, bMaskDWord);\n\n\t}\n}\n\nstatic void _PHY_PathBFillIQKMatrix8723B(\n\tstruct adapter *padapter,\n\tbool bIQKOK,\n\ts32 result[][8],\n\tu8 final_candidate,\n\tbool bTxOnly  \n)\n{\n\tu32 Oldval_1, X, TX1_A, reg;\n\ts32\tY, TX1_C;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\tstruct odm_rf_cal_t *pRFCalibrateInfo = &pDM_Odm->RFCalibrateInfo;\n\n\tif (final_candidate == 0xFF)\n\t\treturn;\n\n\telse if (bIQKOK) {\n\t\tOldval_1 = (PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XBTxIQImbalance, bMaskDWord) >> 22) & 0x3FF;\n\n\t\tX = result[final_candidate][4];\n\t\tif ((X & 0x00000200) != 0)\n\t\t\tX = X | 0xFFFFFC00;\n\t\tTX1_A = (X * Oldval_1) >> 8;\n\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XBTxIQImbalance, 0x3FF, TX1_A);\n\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT(27), ((X*Oldval_1>>7) & 0x1));\n\n\t\tY = result[final_candidate][5];\n\t\tif ((Y & 0x00000200) != 0)\n\t\t\tY = Y | 0xFFFFFC00;\n\n\t\tTX1_C = (Y * Oldval_1) >> 8;\n\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XDTxAFE, 0xF0000000, ((TX1_C&0x3C0)>>6));\n \n \n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC94][KEY] = rOFDM0_XCTxAFE;\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC94][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XDTxAFE, bMaskDWord);\n\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XBTxIQImbalance, 0x003F0000, (TX1_C&0x3F));\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC80][KEY] = rOFDM0_XATxIQImbalance;\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC80][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XBTxIQImbalance, bMaskDWord);\n\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, BIT(25), ((Y*Oldval_1>>7) & 0x1));\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC4C][KEY] = rOFDM0_ECCAThreshold;\n\t\tpRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC4C][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_ECCAThreshold, bMaskDWord);\n\n\t\tif (bTxOnly) {\n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xC14][KEY] = rOFDM0_XARxIQImbalance;\n \n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xC14][VAL] = 0x40000100;\n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xCA0][KEY] = rOFDM0_RxIQExtAnta;\n\t\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xCA0][VAL] = 0x0fffffff & PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_RxIQExtAnta, bMaskDWord);\n\t\t\treturn;\n\t\t}\n\n\t\t \n\t\treg = result[final_candidate][6];\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XBRxIQImbalance, 0x3FF, reg);\n\t\treg = result[final_candidate][7] & 0x3F;\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_XBRxIQImbalance, 0xFC00, reg);\n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xC14][KEY] = rOFDM0_XARxIQImbalance;\n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xC14][VAL] = PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_XBRxIQImbalance, bMaskDWord);\n\n\t\treg = (result[final_candidate][7] >> 6) & 0xF;\n \n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xCA0][KEY] = rOFDM0_RxIQExtAnta;\n\t\tpRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xCA0][VAL] = (reg << 28)|(PHY_QueryBBReg(pDM_Odm->Adapter, rOFDM0_RxIQExtAnta, bMaskDWord)&0x0fffffff);\n\t}\n}\n\n \n \n \n \n\nvoid ODM_SetIQCbyRFpath(struct dm_odm_t *pDM_Odm, u32 RFpath)\n{\n\n\tstruct odm_rf_cal_t *pRFCalibrateInfo = &pDM_Odm->RFCalibrateInfo;\n\n\tif (\n\t\t(pRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC80][VAL] != 0x0) &&\n\t\t(pRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xC14][VAL] != 0x0) &&\n\t\t(pRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC80][VAL] != 0x0) &&\n\t\t(pRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xC14][VAL] != 0x0)\n\t) {\n\t\tif (RFpath) {  \n\t\t\t \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC94][KEY], bMaskDWord, pRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC94][VAL]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC80][KEY], bMaskDWord, pRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC80][VAL]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC4C][KEY], bMaskDWord, pRFCalibrateInfo->TxIQC_8723B[PATH_S0][IDX_0xC4C][VAL]);\n\t\t\t \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xC14][KEY], bMaskDWord, pRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xC14][VAL]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xCA0][KEY], bMaskDWord, pRFCalibrateInfo->RxIQC_8723B[PATH_S0][IDX_0xCA0][VAL]);\n\t\t} else {\n\t\t\t \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC94][KEY], bMaskDWord, pRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC94][VAL]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC80][KEY], bMaskDWord, pRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC80][VAL]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC4C][KEY], bMaskDWord, pRFCalibrateInfo->TxIQC_8723B[PATH_S1][IDX_0xC4C][VAL]);\n\t\t\t \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xC14][KEY], bMaskDWord, pRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xC14][VAL]);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, pRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xCA0][KEY], bMaskDWord, pRFCalibrateInfo->RxIQC_8723B[PATH_S1][IDX_0xCA0][VAL]);\n\t\t}\n\t}\n}\n\nstatic bool ODM_CheckPowerStatus(struct adapter *Adapter)\n{\n\treturn true;\n}\n\nstatic void _PHY_SaveADDARegisters8723B(\n\tstruct adapter *padapter,\n\tu32 *ADDAReg,\n\tu32 *ADDABackup,\n\tu32 RegisterNum\n)\n{\n\tu32 i;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\tif (!ODM_CheckPowerStatus(padapter))\n\t\treturn;\n\n\tfor (i = 0 ; i < RegisterNum ; i++) {\n\t\tADDABackup[i] = PHY_QueryBBReg(pDM_Odm->Adapter, ADDAReg[i], bMaskDWord);\n\t}\n}\n\n\nstatic void _PHY_SaveMACRegisters8723B(\n\tstruct adapter *padapter, u32 *MACReg, u32 *MACBackup\n)\n{\n\tu32 i;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\tfor (i = 0 ; i < (IQK_MAC_REG_NUM - 1); i++) {\n\t\tMACBackup[i] = rtw_read8(pDM_Odm->Adapter, MACReg[i]);\n\t}\n\tMACBackup[i] = rtw_read32(pDM_Odm->Adapter, MACReg[i]);\n\n}\n\n\nstatic void _PHY_ReloadADDARegisters8723B(\n\tstruct adapter *padapter,\n\tu32 *ADDAReg,\n\tu32 *ADDABackup,\n\tu32 RegiesterNum\n)\n{\n\tu32 i;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\tfor (i = 0 ; i < RegiesterNum; i++) {\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, ADDAReg[i], bMaskDWord, ADDABackup[i]);\n\t}\n}\n\nstatic void _PHY_ReloadMACRegisters8723B(\n\tstruct adapter *padapter, u32 *MACReg, u32 *MACBackup\n)\n{\n\tu32 i;\n\n\tfor (i = 0 ; i < (IQK_MAC_REG_NUM - 1); i++) {\n\t\trtw_write8(padapter, MACReg[i], (u8)MACBackup[i]);\n\t}\n\trtw_write32(padapter, MACReg[i], MACBackup[i]);\n}\n\n\nstatic void _PHY_PathADDAOn8723B(\n\tstruct adapter *padapter,\n\tu32 *ADDAReg,\n\tbool is2T\n)\n{\n\tu32 pathOn;\n\tu32 i;\n\tstruct hal_com_data *pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\tpathOn = 0x01c00014;\n\tif (!is2T) {\n\t\tpathOn = 0x01c00014;\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, ADDAReg[0], bMaskDWord, 0x01c00014);\n\t} else {\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, ADDAReg[0], bMaskDWord, pathOn);\n\t}\n\n\tfor (i = 1 ; i < IQK_ADDA_REG_NUM ; i++) {\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, ADDAReg[i], bMaskDWord, pathOn);\n\t}\n\n}\n\nstatic void _PHY_MACSettingCalibration8723B(\n\tstruct adapter *padapter, u32 *MACReg, u32 *MACBackup\n)\n{\n\tu32 i = 0;\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\trtw_write8(pDM_Odm->Adapter, MACReg[i], 0x3F);\n\n\tfor (i = 1 ; i < (IQK_MAC_REG_NUM - 1); i++) {\n\t\trtw_write8(pDM_Odm->Adapter, MACReg[i], (u8)(MACBackup[i]&(~BIT3)));\n\t}\n\trtw_write8(pDM_Odm->Adapter, MACReg[i], (u8)(MACBackup[i]&(~BIT5)));\n\n}\n\nstatic bool phy_SimularityCompare_8723B(\n\tstruct adapter *padapter,\n\ts32 result[][8],\n\tu8  c1,\n\tu8  c2\n)\n{\n\tu32 i, j, diff, SimularityBitMap, bound = 0;\n\tu8 final_candidate[2] = {0xFF, 0xFF};  \n\tbool bResult = true;\n\ts32 tmp1 = 0, tmp2 = 0;\n\n\tbound = 8;\n\tSimularityBitMap = 0;\n\n\tfor (i = 0; i < bound; i++) {\n\n\t\tif ((i == 1) || (i == 3) || (i == 5) || (i == 7)) {\n\t\t\tif ((result[c1][i] & 0x00000200) != 0)\n\t\t\t\ttmp1 = result[c1][i] | 0xFFFFFC00;\n\t\t\telse\n\t\t\t\ttmp1 = result[c1][i];\n\n\t\t\tif ((result[c2][i] & 0x00000200) != 0)\n\t\t\t\ttmp2 = result[c2][i] | 0xFFFFFC00;\n\t\t\telse\n\t\t\t\ttmp2 = result[c2][i];\n\t\t} else {\n\t\t\ttmp1 = result[c1][i];\n\t\t\ttmp2 = result[c2][i];\n\t\t}\n\n\t\tdiff = (tmp1 > tmp2) ? (tmp1 - tmp2) : (tmp2 - tmp1);\n\n\t\tif (diff > MAX_TOLERANCE) {\n\t\t\tif ((i == 2 || i == 6) && !SimularityBitMap) {\n\t\t\t\tif (result[c1][i]+result[c1][i+1] == 0)\n\t\t\t\t\tfinal_candidate[(i/4)] = c2;\n\t\t\t\telse if (result[c2][i]+result[c2][i+1] == 0)\n\t\t\t\t\tfinal_candidate[(i/4)] = c1;\n\t\t\t\telse\n\t\t\t\t\tSimularityBitMap = SimularityBitMap|(1<<i);\n\t\t\t} else\n\t\t\t\tSimularityBitMap = SimularityBitMap|(1<<i);\n\t\t}\n\t}\n\n\tif (SimularityBitMap == 0) {\n\t\tfor (i = 0; i < (bound/4); i++) {\n\t\t\tif (final_candidate[i] != 0xFF) {\n\t\t\t\tfor (j = i*4; j < (i+1)*4-2; j++)\n\t\t\t\t\tresult[3][j] = result[final_candidate[i]][j];\n\t\t\t\tbResult = false;\n\t\t\t}\n\t\t}\n\t\treturn bResult;\n\t} else {\n\n\t\tif (!(SimularityBitMap & 0x03)) {  \n\t\t\tfor (i = 0; i < 2; i++)\n\t\t\t\tresult[3][i] = result[c1][i];\n\t\t}\n\n\t\tif (!(SimularityBitMap & 0x0c)) {  \n\t\t\tfor (i = 2; i < 4; i++)\n\t\t\t\tresult[3][i] = result[c1][i];\n\t\t}\n\n\t\tif (!(SimularityBitMap & 0x30)) {  \n\t\t\tfor (i = 4; i < 6; i++)\n\t\t\t\tresult[3][i] = result[c1][i];\n\t\t}\n\n\t\tif (!(SimularityBitMap & 0xc0)) {  \n\t\t\tfor (i = 6; i < 8; i++)\n\t\t\t\tresult[3][i] = result[c1][i];\n\t\t}\n\t\treturn false;\n\t}\n}\n\n\n\nstatic void phy_IQCalibrate_8723B(\n\tstruct adapter *padapter,\n\ts32 result[][8],\n\tu8 t,\n\tbool is2T,\n\tu8 RF_Path\n)\n{\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\tu32 i;\n\tu8 PathAOK, PathBOK;\n\tu8 tmp0xc50 = (u8)PHY_QueryBBReg(pDM_Odm->Adapter, 0xC50, bMaskByte0);\n\tu8 tmp0xc58 = (u8)PHY_QueryBBReg(pDM_Odm->Adapter, 0xC58, bMaskByte0);\n\tu32 ADDA_REG[IQK_ADDA_REG_NUM] = {\n\t\trFPGA0_XCD_SwitchControl,\n\t\trBlue_Tooth,\n\t\trRx_Wait_CCA,\n\t\trTx_CCK_RFON,\n\t\trTx_CCK_BBON,\n\t\trTx_OFDM_RFON,\n\t\trTx_OFDM_BBON,\n\t\trTx_To_Rx,\n\t\trTx_To_Tx,\n\t\trRx_CCK,\n\t\trRx_OFDM,\n\t\trRx_Wait_RIFS,\n\t\trRx_TO_Rx,\n\t\trStandby,\n\t\trSleep,\n\t\trPMPD_ANAEN\n\t};\n\tu32 IQK_MAC_REG[IQK_MAC_REG_NUM] = {\n\t\tREG_TXPAUSE,\n\t\tREG_BCN_CTRL,\n\t\tREG_BCN_CTRL_1,\n\t\tREG_GPIO_MUXCFG\n\t};\n\n\t \n\tu32 IQK_BB_REG_92C[IQK_BB_REG_NUM] = {\n\t\trOFDM0_TRxPathEnable,\n\t\trOFDM0_TRMuxPar,\n\t\trFPGA0_XCD_RFInterfaceSW,\n\t\trConfig_AntA,\n\t\trConfig_AntB,\n\t\trFPGA0_XAB_RFInterfaceSW,\n\t\trFPGA0_XA_RFInterfaceOE,\n\t\trFPGA0_XB_RFInterfaceOE,\n\t\trCCK0_AFESetting\n\t};\n\tconst u32 retryCount = 2;\n\n\t \n\t \n\n\t \n\n\tif (t == 0) {\n\n\t\t \n\t\t_PHY_SaveADDARegisters8723B(padapter, ADDA_REG, pDM_Odm->RFCalibrateInfo.ADDA_backup, IQK_ADDA_REG_NUM);\n\t\t_PHY_SaveMACRegisters8723B(padapter, IQK_MAC_REG, pDM_Odm->RFCalibrateInfo.IQK_MAC_backup);\n\t\t_PHY_SaveADDARegisters8723B(padapter, IQK_BB_REG_92C, pDM_Odm->RFCalibrateInfo.IQK_BB_backup, IQK_BB_REG_NUM);\n\t}\n\n\t_PHY_PathADDAOn8723B(padapter, ADDA_REG, is2T);\n\n \n\n\t \n \n \n\n\t \n\t_PHY_MACSettingCalibration8723B(padapter, IQK_MAC_REG, pDM_Odm->RFCalibrateInfo.IQK_MAC_backup);\n\n\t \n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rCCK0_AFESetting, 0x0f000000, 0xf);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_TRxPathEnable, bMaskDWord, 0x03a05600);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rOFDM0_TRMuxPar, bMaskDWord, 0x000800e4);\n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_XCD_RFInterfaceSW, bMaskDWord, 0x22204000);\n\n\n \n \n \n \n\n\n \n\n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_WE_LUT, 0x80000, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_RCK_OS, bRFRegOffsetMask, 0x30000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G1, bRFRegOffsetMask, 0x0001f);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G2, bRFRegOffsetMask, 0xf7fb7);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xed, 0x20, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0x43, bRFRegOffsetMask, 0x60fbd);\n\n \n\tfor (i = 0 ; i < retryCount ; i++) {\n\t\tPathAOK = phy_PathA_IQK_8723B(padapter, is2T, RF_Path);\n \n\t\tif (PathAOK == 0x01) {\n\t\t\t \n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\t\t\tpDM_Odm->RFCalibrateInfo.TxLOK[RF_PATH_A] = PHY_QueryRFReg(pDM_Odm->Adapter, RF_PATH_A, 0x8, bRFRegOffsetMask);\n\n\t\t\t\tresult[t][0] = (PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_Before_IQK_A, bMaskDWord)&0x3FF0000)>>16;\n\t\t\t\tresult[t][1] = (PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_After_IQK_A, bMaskDWord)&0x3FF0000)>>16;\n\t\t\tbreak;\n\t\t}\n\t}\n\n \n\tfor (i = 0 ; i < retryCount ; i++) {\n\t\tPathAOK = phy_PathA_RxIQK8723B(padapter, is2T, RF_Path);\n\t\tif (PathAOK == 0x03) {\n \n \n\t\t\t\tresult[t][2] = (PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_Before_IQK_A_2, bMaskDWord)&0x3FF0000)>>16;\n\t\t\t\tresult[t][3] = (PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord)&0x3FF0000)>>16;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (0x00 == PathAOK) {\n\t}\n\n \n\tif (is2T) {\n\n\t\t \n\t\tfor (i = 0 ; i < retryCount ; i++) {\n\t\t\tPathBOK = phy_PathB_IQK_8723B(padapter);\n\t\t\tif (PathBOK == 0x01) {\n\t\t\t\t \n\t\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0x000000);\n\t\t\t\tpDM_Odm->RFCalibrateInfo.TxLOK[RF_PATH_B] = PHY_QueryRFReg(pDM_Odm->Adapter, RF_PATH_B, 0x8, bRFRegOffsetMask);\n\n\t\t\t\tresult[t][4] = (PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_Before_IQK_A, bMaskDWord)&0x3FF0000)>>16;\n\t\t\t\tresult[t][5] = (PHY_QueryBBReg(pDM_Odm->Adapter, rTx_Power_After_IQK_A, bMaskDWord)&0x3FF0000)>>16;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n \n\t\tfor (i = 0 ; i < retryCount ; i++) {\n\t\t\tPathBOK = phy_PathB_RxIQK8723B(padapter, is2T);\n\t\t\tif (PathBOK == 0x03) {\n \n \n\t\t\t\tresult[t][6] = (PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_Before_IQK_A_2, bMaskDWord)&0x3FF0000)>>16;\n\t\t\t\tresult[t][7] = (PHY_QueryBBReg(pDM_Odm->Adapter, rRx_Power_After_IQK_A_2, bMaskDWord)&0x3FF0000)>>16;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n \n\t}\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, rFPGA0_IQK, bMaskH3Bytes, 0);\n\n\tif (t != 0) {\n\t\t \n\t\t_PHY_ReloadADDARegisters8723B(padapter, ADDA_REG, pDM_Odm->RFCalibrateInfo.ADDA_backup, IQK_ADDA_REG_NUM);\n\n\t\t \n\t\t_PHY_ReloadMACRegisters8723B(padapter, IQK_MAC_REG, pDM_Odm->RFCalibrateInfo.IQK_MAC_backup);\n\n\t\t_PHY_ReloadADDARegisters8723B(padapter, IQK_BB_REG_92C, pDM_Odm->RFCalibrateInfo.IQK_BB_backup, IQK_BB_REG_NUM);\n\n\t\t \n \n \n\n\t\t \n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xc50, bMaskByte0, 0x50);\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xc50, bMaskByte0, tmp0xc50);\n\t\tif (is2T) {\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xc58, bMaskByte0, 0x50);\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, 0xc58, bMaskByte0, tmp0xc58);\n\t\t}\n\n\t\t \n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rTx_IQK_Tone_A, bMaskDWord, 0x01008c00);\n\t\tPHY_SetBBReg(pDM_Odm->Adapter, rRx_IQK_Tone_A, bMaskDWord, 0x01008c00);\n\n\t}\n\n}\n\n\nstatic void phy_LCCalibrate_8723B(struct dm_odm_t *pDM_Odm, bool is2T)\n{\n\tu8 tmpReg;\n\tu32 RF_Amode = 0, RF_Bmode = 0, LC_Cal;\n\tstruct adapter *padapter = pDM_Odm->Adapter;\n\n\t \n\ttmpReg = rtw_read8(pDM_Odm->Adapter, 0xd03);\n\n\tif ((tmpReg&0x70) != 0)\t\t\t \n\t\trtw_write8(pDM_Odm->Adapter, 0xd03, tmpReg&0x8F);\t \n\telse\t\t\t\t\t\t\t \n\t\trtw_write8(pDM_Odm->Adapter, REG_TXPAUSE, 0xFF);\t\t \n\n\tif ((tmpReg&0x70) != 0) {\n\t\t \n\t\t \n\t\tRF_Amode = PHY_QueryRFReg(padapter, RF_PATH_A, RF_AC, bMask12Bits);\n\n\t\t \n\t\tif (is2T)\n\t\t\tRF_Bmode = PHY_QueryRFReg(padapter, RF_PATH_B, RF_AC, bMask12Bits);\n\n\t\t \n\t\t \n\t\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_AC, bMask12Bits, (RF_Amode&0x8FFFF)|0x10000);\n\n\t\t \n\t\tif (is2T)\n\t\t\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_B, RF_AC, bMask12Bits, (RF_Bmode&0x8FFFF)|0x10000);\n\t}\n\n\t \n\tLC_Cal = PHY_QueryRFReg(padapter, RF_PATH_A, RF_CHNLBW, bMask12Bits);\n\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xB0, bRFRegOffsetMask, 0xDFBE0);  \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_CHNLBW, bMask12Bits, LC_Cal|0x08000);\n\n\tmdelay(100);\n\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xB0, bRFRegOffsetMask, 0xDFFE0);  \n\n\t \n\tif (pDM_Odm->SupportInterface == ODM_ITRF_SDIO && pDM_Odm->PackageType >= 0x2) {\n\t\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_CHNLBW, bMask12Bits, LC_Cal);\n\t}\n\n\t \n\tif ((tmpReg&0x70) != 0) {  \n\t\t \n\t\trtw_write8(pDM_Odm->Adapter, 0xd03, tmpReg);\n\t\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_AC, bMask12Bits, RF_Amode);\n\n\t\t \n\t\tif (is2T)\n\t\t\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_B, RF_AC, bMask12Bits, RF_Bmode);\n\t} else  \n\t\trtw_write8(pDM_Odm->Adapter, REG_TXPAUSE, 0x00);\n}\n\n \n \nvoid PHY_IQCalibrate_8723B(\n\tstruct adapter *padapter,\n\tbool bReCovery,\n\tbool bRestore,\n\tbool Is2ant,\t \n\tu8 RF_Path\t \n)\n{\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\n\tstruct dm_odm_t *pDM_Odm = &pHalData->odmpriv;\n\n\ts32 result[4][8];\t \n\tu8 i, final_candidate;\n\tbool bPathAOK, bPathBOK;\n\ts32 RegE94, RegE9C, RegEA4, RegEB4, RegEBC, RegEC4, RegTmp = 0;\n\tbool is12simular, is13simular, is23simular;\n\tbool bSingleTone = false, bCarrierSuppression = false;\n\tu32 IQK_BB_REG_92C[IQK_BB_REG_NUM] = {\n\t\trOFDM0_XARxIQImbalance,\n\t\trOFDM0_XBRxIQImbalance,\n\t\trOFDM0_ECCAThreshold,\n\t\trOFDM0_AGCRSSITable,\n\t\trOFDM0_XATxIQImbalance,\n\t\trOFDM0_XBTxIQImbalance,\n\t\trOFDM0_XCTxAFE,\n\t\trOFDM0_XDTxAFE,\n\t\trOFDM0_RxIQExtAnta\n\t};\n \n\tu32 \t\tGNT_BT_default;\n\n\tif (!ODM_CheckPowerStatus(padapter))\n\t\treturn;\n\n\tif (!(pDM_Odm->SupportAbility & ODM_RF_CALIBRATION))\n\t\treturn;\n\n\t \n\tif (bSingleTone || bCarrierSuppression)\n\t\treturn;\n\n\tif (pDM_Odm->RFCalibrateInfo.bIQKInProgress)\n\t\treturn;\n\n\n\tpDM_Odm->RFCalibrateInfo.bIQKInProgress = true;\n\n\tif (bRestore) {\n\t\tu32 offset, data;\n\t\tu8 path, bResult = SUCCESS;\n\t\tstruct odm_rf_cal_t *pRFCalibrateInfo = &pDM_Odm->RFCalibrateInfo;\n\n\t\tpath = (PHY_QueryBBReg(pDM_Odm->Adapter, rS0S1_PathSwitch, bMaskByte0) == 0x00) ? RF_PATH_A : RF_PATH_B;\n\n\t\t \n\t\tfor (i = 0; i < 3; ++i) {\n\t\t\toffset = pRFCalibrateInfo->TxIQC_8723B[path][i][0];\n\t\t\tdata = pRFCalibrateInfo->TxIQC_8723B[path][i][1];\n\t\t\tif ((offset == 0) || (data == 0)) {\n\t\t\t\tbResult = FAIL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, offset, bMaskDWord, data);\n\t\t}\n\n\t\t \n\t\tfor (i = 0; i < 2; ++i) {\n\t\t\toffset = pRFCalibrateInfo->RxIQC_8723B[path][i][0];\n\t\t\tdata = pRFCalibrateInfo->RxIQC_8723B[path][i][1];\n\t\t\tif ((offset == 0) || (data == 0)) {\n\t\t\t\tbResult = FAIL;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tPHY_SetBBReg(pDM_Odm->Adapter, offset, bMaskDWord, data);\n\t\t}\n\n\t\tif (pDM_Odm->RFCalibrateInfo.TxLOK[RF_PATH_A] == 0) {\n\t\t\tbResult = FAIL;\n\t\t} else {\n\t\t\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXM_IDAC, bRFRegOffsetMask, pDM_Odm->RFCalibrateInfo.TxLOK[RF_PATH_A]);\n\t\t\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_B, RF_TXM_IDAC, bRFRegOffsetMask, pDM_Odm->RFCalibrateInfo.TxLOK[RF_PATH_B]);\n\t\t}\n\n\t\tif (bResult == SUCCESS)\n\t\t\treturn;\n\t}\n\n\tif (bReCovery) {\n\t\t_PHY_ReloadADDARegisters8723B(padapter, IQK_BB_REG_92C, pDM_Odm->RFCalibrateInfo.IQK_BB_backup_recover, 9);\n\t\treturn;\n\t}\n\n\t \n\tGNT_BT_default = PHY_QueryBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord);\n\t \n \n \n\n     \n \n \n\n\n\tfor (i = 0; i < 8; i++) {\n\t\tresult[0][i] = 0;\n\t\tresult[1][i] = 0;\n\t\tresult[2][i] = 0;\n\t\tresult[3][i] = 0;\n\t}\n\n\tfinal_candidate = 0xff;\n\tbPathAOK = false;\n\tbPathBOK = false;\n\tis12simular = false;\n\tis23simular = false;\n\tis13simular = false;\n\n\n\tfor (i = 0; i < 3; i++) {\n\t\tphy_IQCalibrate_8723B(padapter, result, i, Is2ant, RF_Path);\n\n\t\tif (i == 1) {\n\t\t\tis12simular = phy_SimularityCompare_8723B(padapter, result, 0, 1);\n\t\t\tif (is12simular) {\n\t\t\t\tfinal_candidate = 0;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (i == 2) {\n\t\t\tis13simular = phy_SimularityCompare_8723B(padapter, result, 0, 2);\n\t\t\tif (is13simular) {\n\t\t\t\tfinal_candidate = 0;\n\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tis23simular = phy_SimularityCompare_8723B(padapter, result, 1, 2);\n\t\t\tif (is23simular) {\n\t\t\t\tfinal_candidate = 1;\n\t\t\t} else {\n\t\t\t\tfor (i = 0; i < 8; i++)\n\t\t\t\t\tRegTmp += result[3][i];\n\n\t\t\t\tif (RegTmp != 0)\n\t\t\t\t\tfinal_candidate = 3;\n\t\t\t\telse\n\t\t\t\t\tfinal_candidate = 0xFF;\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (i = 0; i < 4; i++) {\n\t\tRegE94 = result[i][0];\n\t\tRegE9C = result[i][1];\n\t\tRegEA4 = result[i][2];\n\t\tRegEB4 = result[i][4];\n\t\tRegEBC = result[i][5];\n\t\tRegEC4 = result[i][6];\n\t}\n\n\tif (final_candidate != 0xff) {\n\t\tpDM_Odm->RFCalibrateInfo.RegE94 = RegE94 = result[final_candidate][0];\n\t\tpDM_Odm->RFCalibrateInfo.RegE9C = RegE9C = result[final_candidate][1];\n\t\tRegEA4 = result[final_candidate][2];\n\t\tpDM_Odm->RFCalibrateInfo.RegEB4 = RegEB4 = result[final_candidate][4];\n\t\tpDM_Odm->RFCalibrateInfo.RegEBC = RegEBC = result[final_candidate][5];\n\t\tRegEC4 = result[final_candidate][6];\n\t\tbPathAOK = bPathBOK = true;\n\t} else {\n\t\tpDM_Odm->RFCalibrateInfo.RegE94 = pDM_Odm->RFCalibrateInfo.RegEB4 = 0x100;\t \n\t\tpDM_Odm->RFCalibrateInfo.RegE9C = pDM_Odm->RFCalibrateInfo.RegEBC = 0x0;\t\t \n\t}\n\n\t{\n\t\tif (RegE94 != 0)\n\t\t\t_PHY_PathAFillIQKMatrix8723B(padapter, bPathAOK, result, final_candidate, (RegEA4 == 0));\n\t}\n\t{\n\t\tif (RegEB4 != 0)\n\t\t\t_PHY_PathBFillIQKMatrix8723B(padapter, bPathBOK, result, final_candidate, (RegEC4 == 0));\n\t}\n\n \n \n\tif (final_candidate < 4) {\n\t\tfor (i = 0; i < IQK_MATRIX_REG_NUM; i++)\n\t\t\tpDM_Odm->RFCalibrateInfo.iqk_matrix_regs_setting_value[0][i] = result[final_candidate][i];\n\t}\n\n\t_PHY_SaveADDARegisters8723B(padapter, IQK_BB_REG_92C, pDM_Odm->RFCalibrateInfo.IQK_BB_backup_recover, 9);\n\n\t \n\tPHY_SetBBReg(pDM_Odm->Adapter, 0x764, bMaskDWord, GNT_BT_default);\n\t \n \n \n\n\t \n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_WE_LUT, 0x80000, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_RCK_OS, bRFRegOffsetMask, 0x18000);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G1, bRFRegOffsetMask, 0x0001f);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, RF_TXPA_G2, bRFRegOffsetMask, 0xe6177);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0xed, 0x20, 0x1);\n\tPHY_SetRFReg(pDM_Odm->Adapter, RF_PATH_A, 0x43, bRFRegOffsetMask, 0x300bd);\n\n\t \n \n \n\n\tif (Is2ant) {\n\t\tif (RF_Path == 0x0)\t \n\t\t\tODM_SetIQCbyRFpath(pDM_Odm, 0);\n\t\telse\t \n\t\t\tODM_SetIQCbyRFpath(pDM_Odm, 1);\n\t}\n\n\tpDM_Odm->RFCalibrateInfo.bIQKInProgress = false;\n}\n\n\nvoid PHY_LCCalibrate_8723B(struct dm_odm_t *pDM_Odm)\n{\n\tbool\t\tbSingleTone = false, bCarrierSuppression = false;\n\tu32 \t\ttimeout = 2000, timecount = 0;\n\n\tif (!(pDM_Odm->SupportAbility & ODM_RF_CALIBRATION))\n\t\treturn;\n\n\t \n\tif (bSingleTone || bCarrierSuppression)\n\t\treturn;\n\n\twhile (*(pDM_Odm->pbScanInProcess) && timecount < timeout) {\n\t\tmdelay(50);\n\t\ttimecount += 50;\n\t}\n\n\tpDM_Odm->RFCalibrateInfo.bLCKInProgress = true;\n\n\n\tphy_LCCalibrate_8723B(pDM_Odm, false);\n\n\n\tpDM_Odm->RFCalibrateInfo.bLCKInProgress = false;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}