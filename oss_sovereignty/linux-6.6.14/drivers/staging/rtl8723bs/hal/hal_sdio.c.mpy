{
  "module_name": "hal_sdio.c",
  "hash_id": "823d23967a401080b265e27ab4cadf4429e065b8d141a97bfe0d04994797ab2c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8723bs/hal/hal_sdio.c",
  "human_readable_source": "\n \n\n#include <drv_types.h>\n#include <rtw_debug.h>\n#include <hal_data.h>\n\nu8 rtw_hal_sdio_max_txoqt_free_space(struct adapter *padapter)\n{\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\n\tif (pHalData->SdioTxOQTMaxFreeSpace < 8)\n\t\tpHalData->SdioTxOQTMaxFreeSpace = 8;\n\n\treturn pHalData->SdioTxOQTMaxFreeSpace;\n}\n\nu8 rtw_hal_sdio_query_tx_freepage(\n\tstruct adapter *padapter, u8 PageIdx, u8 RequiredPageNum\n)\n{\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\n\tif ((pHalData->SdioTxFIFOFreePage[PageIdx]+pHalData->SdioTxFIFOFreePage[PUBLIC_QUEUE_IDX]) >= (RequiredPageNum))\n\t\treturn true;\n\telse\n\t\treturn false;\n}\n\nvoid rtw_hal_sdio_update_tx_freepage(\n\tstruct adapter *padapter, u8 PageIdx, u8 RequiredPageNum\n)\n{\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tu8 DedicatedPgNum = 0;\n\tu8 RequiredPublicFreePgNum = 0;\n\t \n\n\t \n\n\tDedicatedPgNum = pHalData->SdioTxFIFOFreePage[PageIdx];\n\tif (RequiredPageNum <= DedicatedPgNum) {\n\t\tpHalData->SdioTxFIFOFreePage[PageIdx] -= RequiredPageNum;\n\t} else {\n\t\tpHalData->SdioTxFIFOFreePage[PageIdx] = 0;\n\t\tRequiredPublicFreePgNum = RequiredPageNum - DedicatedPgNum;\n\t\tpHalData->SdioTxFIFOFreePage[PUBLIC_QUEUE_IDX] -= RequiredPublicFreePgNum;\n\t}\n\n\t \n}\n\nvoid rtw_hal_set_sdio_tx_max_length(\n\tstruct adapter *padapter, u8 numHQ, u8 numNQ, u8 numLQ, u8 numPubQ\n)\n{\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tu32 page_size;\n\tu32 lenHQ, lenNQ, lenLQ;\n\n\trtw_hal_get_def_var(padapter, HAL_DEF_TX_PAGE_SIZE, &page_size);\n\n\tlenHQ = ((numHQ + numPubQ) >> 1) * page_size;\n\tlenNQ = ((numNQ + numPubQ) >> 1) * page_size;\n\tlenLQ = ((numLQ + numPubQ) >> 1) * page_size;\n\n\tpHalData->sdio_tx_max_len[HI_QUEUE_IDX] =\n\t\t(lenHQ > MAX_XMITBUF_SZ) ? MAX_XMITBUF_SZ : lenHQ;\n\tpHalData->sdio_tx_max_len[MID_QUEUE_IDX] =\n\t\t(lenNQ > MAX_XMITBUF_SZ) ? MAX_XMITBUF_SZ : lenNQ;\n\tpHalData->sdio_tx_max_len[LOW_QUEUE_IDX] =\n\t\t(lenLQ > MAX_XMITBUF_SZ) ? MAX_XMITBUF_SZ : lenLQ;\n}\n\nu32 rtw_hal_get_sdio_tx_max_length(struct adapter *padapter, u8 queue_idx)\n{\n\tstruct dvobj_priv *pdvobjpriv = adapter_to_dvobj(padapter);\n\tstruct hal_com_data\t*pHalData = GET_HAL_DATA(padapter);\n\tu32 deviceId, max_len;\n\n\n\tdeviceId = ffaddr2deviceId(pdvobjpriv, queue_idx);\n\tswitch (deviceId) {\n\tcase WLAN_TX_HIQ_DEVICE_ID:\n\t\tmax_len = pHalData->sdio_tx_max_len[HI_QUEUE_IDX];\n\t\tbreak;\n\n\tcase WLAN_TX_MIQ_DEVICE_ID:\n\t\tmax_len = pHalData->sdio_tx_max_len[MID_QUEUE_IDX];\n\t\tbreak;\n\n\tcase WLAN_TX_LOQ_DEVICE_ID:\n\t\tmax_len = pHalData->sdio_tx_max_len[LOW_QUEUE_IDX];\n\t\tbreak;\n\n\tdefault:\n\t\tmax_len = pHalData->sdio_tx_max_len[MID_QUEUE_IDX];\n\t\tbreak;\n\t}\n\n\treturn max_len;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}