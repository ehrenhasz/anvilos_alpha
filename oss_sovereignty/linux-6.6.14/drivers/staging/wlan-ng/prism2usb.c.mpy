{
  "module_name": "prism2usb.c",
  "hash_id": "6e6bc64af622de3dab46608714260465f66b0bd3691bf3acb7c0cc6e8579f9eb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/wlan-ng/prism2usb.c",
  "human_readable_source": "\n#include \"hfa384x_usb.c\"\n#include \"prism2mgmt.c\"\n#include \"prism2mib.c\"\n#include \"prism2sta.c\"\n#include \"prism2fw.c\"\n\n#define PRISM_DEV(vid, pid, name)\t\t\\\n\t{ USB_DEVICE(vid, pid),\t\t\t\\\n\t.driver_info = (unsigned long)name }\n\nstatic const struct usb_device_id usb_prism_tbl[] = {\n\tPRISM_DEV(0x04bb, 0x0922, \"IOData AirPort WN-B11/USBS\"),\n\tPRISM_DEV(0x07aa, 0x0012, \"Corega USB Wireless LAN Stick-11\"),\n\tPRISM_DEV(0x09aa, 0x3642, \"Prism2.x 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x1668, 0x0408, \"Actiontec Prism2.5 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x1668, 0x0421, \"Actiontec Prism2.5 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x1915, 0x2236, \"Linksys WUSB11v3.0 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x066b, 0x2212, \"Linksys WUSB11v2.5 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x066b, 0x2213, \"Linksys WUSB12v1.1 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x0411, 0x0016, \"Melco WLI-USB-S11 11Mbps WLAN Adapter\"),\n\tPRISM_DEV(0x08de, 0x7a01, \"PRISM25 USB IEEE 802.11 Mini Adapter\"),\n\tPRISM_DEV(0x8086, 0x1111, \"Intel PRO/Wireless 2011B USB LAN Adapter\"),\n\tPRISM_DEV(0x0d8e, 0x7a01, \"PRISM25 IEEE 802.11 Mini USB Adapter\"),\n\tPRISM_DEV(0x045e, 0x006e, \"Microsoft MN510 USB Wireless Adapter\"),\n\tPRISM_DEV(0x0967, 0x0204, \"Acer Warplink USB Adapter\"),\n\tPRISM_DEV(0x0cde, 0x0002, \"Z-Com 725/726 Prism2.5 USB/USB Integrated\"),\n\tPRISM_DEV(0x0cde, 0x0005, \"Z-Com Xl735 USB Wireless 802.11b Adapter\"),\n\tPRISM_DEV(0x413c, 0x8100, \"Dell TrueMobile 1180 USB Wireless Adapter\"),\n\tPRISM_DEV(0x0b3b, 0x1601, \"ALLNET 0193 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x0b3b, 0x1602, \"ZyXEL ZyAIR B200 USB Wireless Adapter\"),\n\tPRISM_DEV(0x0baf, 0x00eb, \"USRobotics USR1120 USB Wireless Adapter\"),\n\tPRISM_DEV(0x0411, 0x0027, \"Melco WLI-USB-KS11G 11Mbps WLAN Adapter\"),\n\tPRISM_DEV(0x04f1, 0x3009, \"JVC MP-XP7250 Builtin USB WLAN Adapter\"),\n\tPRISM_DEV(0x0846, 0x4110, \"NetGear MA111\"),\n\tPRISM_DEV(0x03f3, 0x0020, \"Adaptec AWN-8020 USB WLAN Adapter\"),\n\tPRISM_DEV(0x2821, 0x3300, \"ASUS-WL140 / Hawking HighDB USB Wireless Adapter\"),\n\tPRISM_DEV(0x2001, 0x3700, \"DWL-122 USB Wireless Adapter\"),\n\tPRISM_DEV(0x2001, 0x3702, \"DWL-120 Rev F USB Wireless Adapter\"),\n\tPRISM_DEV(0x50c2, 0x4013, \"Averatec USB WLAN Adapter\"),\n\tPRISM_DEV(0x2c02, 0x14ea, \"Planex GW-US11H USB WLAN Adapter\"),\n\tPRISM_DEV(0x124a, 0x168b, \"Airvast PRISM3 USB WLAN Adapter\"),\n\tPRISM_DEV(0x083a, 0x3503, \"T-Sinus 111 USB WLAN Adapter\"),\n\tPRISM_DEV(0x0411, 0x0044, \"Melco WLI-USB-KB11 11Mbps WLAN Adapter\"),\n\tPRISM_DEV(0x1668, 0x6106, \"ROPEX FreeLan USB 802.11b Adapter\"),\n\tPRISM_DEV(0x124a, 0x4017, \"Pheenet WL-503IA USB 802.11b Adapter\"),\n\tPRISM_DEV(0x0bb2, 0x0302, \"Ambit Microsystems Corp.\"),\n\tPRISM_DEV(0x9016, 0x182d, \"Sitecom WL-022 USB 802.11b Adapter\"),\n\tPRISM_DEV(0x0543, 0x0f01,\n\t\t  \"ViewSonic Airsync USB Adapter 11Mbps (Prism2.5)\"),\n\tPRISM_DEV(0x067c, 0x1022,\n\t\t  \"Siemens SpeedStream 1022 11Mbps USB WLAN Adapter\"),\n\tPRISM_DEV(0x049f, 0x0033,\n\t\t  \"Compaq/Intel W100 PRO/Wireless 11Mbps multiport WLAN Adapter\"),\n\t{ }  \n};\nMODULE_DEVICE_TABLE(usb, usb_prism_tbl);\n\nstatic int prism2sta_probe_usb(struct usb_interface *interface,\n\t\t\t       const struct usb_device_id *id)\n{\n\tstruct usb_device *dev;\n\tstruct usb_endpoint_descriptor *bulk_in, *bulk_out;\n\tstruct usb_host_interface *iface_desc = interface->cur_altsetting;\n\tstruct wlandevice *wlandev = NULL;\n\tstruct hfa384x *hw = NULL;\n\tint result = 0;\n\n\tresult = usb_find_common_endpoints(iface_desc, &bulk_in, &bulk_out, NULL, NULL);\n\tif (result)\n\t\tgoto failed;\n\n\tdev = interface_to_usbdev(interface);\n\twlandev = create_wlan();\n\tif (!wlandev) {\n\t\tdev_err(&interface->dev, \"Memory allocation failure.\\n\");\n\t\tresult = -EIO;\n\t\tgoto failed;\n\t}\n\thw = wlandev->priv;\n\n\tif (wlan_setup(wlandev, &interface->dev) != 0) {\n\t\tdev_err(&interface->dev, \"wlan_setup() failed.\\n\");\n\t\tresult = -EIO;\n\t\tgoto failed;\n\t}\n\n\t \n\thw->endp_in = usb_rcvbulkpipe(dev, bulk_in->bEndpointAddress);\n\thw->endp_out = usb_sndbulkpipe(dev, bulk_out->bEndpointAddress);\n\thfa384x_create(hw, dev);\n\thw->wlandev = wlandev;\n\n\t \n\tSET_NETDEV_DEV(wlandev->netdev, &interface->dev);\n\n\t \n\tif (prism2_doreset) {\n\t\tresult = hfa384x_corereset(hw,\n\t\t\t\t\t   prism2_reset_holdtime,\n\t\t\t\t\t   prism2_reset_settletime, 0);\n\t\tif (result != 0) {\n\t\t\tresult = -EIO;\n\t\t\tdev_err(&interface->dev,\n\t\t\t\t\"hfa384x_corereset() failed.\\n\");\n\t\t\tgoto failed_reset;\n\t\t}\n\t}\n\n\tusb_get_dev(dev);\n\n\twlandev->msdstate = WLAN_MSD_HWPRESENT;\n\n\t \n\tprism2_fwtry(dev, wlandev);\n\tprism2sta_ifstate(wlandev, P80211ENUM_ifstate_enable);\n\n\tif (register_wlandev(wlandev) != 0) {\n\t\tdev_err(&interface->dev, \"register_wlandev() failed.\\n\");\n\t\tresult = -EIO;\n\t\tgoto failed_register;\n\t}\n\n\tgoto done;\n\nfailed_register:\n\tusb_put_dev(dev);\nfailed_reset:\n\twlan_unsetup(wlandev);\nfailed:\n\tkfree(wlandev);\n\tkfree(hw);\n\twlandev = NULL;\n\ndone:\n\tusb_set_intfdata(interface, wlandev);\n\treturn result;\n}\n\nstatic void prism2sta_disconnect_usb(struct usb_interface *interface)\n{\n\tstruct wlandevice *wlandev;\n\n\twlandev = usb_get_intfdata(interface);\n\tif (wlandev) {\n\t\tLIST_HEAD(cleanlist);\n\t\tstruct hfa384x_usbctlx *ctlx, *temp;\n\t\tunsigned long flags;\n\n\t\tstruct hfa384x *hw = wlandev->priv;\n\n\t\tif (!hw)\n\t\t\tgoto exit;\n\n\t\tspin_lock_irqsave(&hw->ctlxq.lock, flags);\n\n\t\tp80211netdev_hwremoved(wlandev);\n\t\tlist_splice_init(&hw->ctlxq.reapable, &cleanlist);\n\t\tlist_splice_init(&hw->ctlxq.completing, &cleanlist);\n\t\tlist_splice_init(&hw->ctlxq.pending, &cleanlist);\n\t\tlist_splice_init(&hw->ctlxq.active, &cleanlist);\n\n\t\tspin_unlock_irqrestore(&hw->ctlxq.lock, flags);\n\n\t\t \n\t\tprism2sta_ifstate(wlandev, P80211ENUM_ifstate_disable);\n\n\t\ttimer_shutdown_sync(&hw->throttle);\n\t\ttimer_shutdown_sync(&hw->reqtimer);\n\t\ttimer_shutdown_sync(&hw->resptimer);\n\n\t\t \n\t\tusb_kill_urb(&hw->rx_urb);\n\t\tusb_kill_urb(&hw->tx_urb);\n\t\tusb_kill_urb(&hw->ctlx_urb);\n\n\t\tcancel_work_sync(&hw->completion_bh);\n\t\tcancel_work_sync(&hw->reaper_bh);\n\n\t\tcancel_work_sync(&hw->link_bh);\n\t\tcancel_work_sync(&hw->commsqual_bh);\n\t\tcancel_work_sync(&hw->usb_work);\n\n\t\t \n\t\tlist_for_each_entry(ctlx, &cleanlist, list)\n\t\t\tcomplete(&ctlx->done);\n\n\t\t \n\t\tmsleep(100);\n\n\t\t \n\t\tlist_for_each_entry_safe(ctlx, temp, &cleanlist, list)\n\t\t\tkfree(ctlx);\n\n\t\t \n\t\tunregister_wlandev(wlandev);\n\t\twlan_unsetup(wlandev);\n\n\t\tusb_put_dev(hw->usb);\n\n\t\thfa384x_destroy(hw);\n\t\tkfree(hw);\n\n\t\tkfree(wlandev);\n\t}\n\nexit:\n\tusb_set_intfdata(interface, NULL);\n}\n\n#ifdef CONFIG_PM\nstatic int prism2sta_suspend(struct usb_interface *interface,\n\t\t\t     pm_message_t message)\n{\n\tstruct hfa384x *hw = NULL;\n\tstruct wlandevice *wlandev;\n\n\twlandev = usb_get_intfdata(interface);\n\tif (!wlandev)\n\t\treturn -ENODEV;\n\n\thw = wlandev->priv;\n\tif (!hw)\n\t\treturn -ENODEV;\n\n\tprism2sta_ifstate(wlandev, P80211ENUM_ifstate_disable);\n\n\tusb_kill_urb(&hw->rx_urb);\n\tusb_kill_urb(&hw->tx_urb);\n\tusb_kill_urb(&hw->ctlx_urb);\n\n\treturn 0;\n}\n\nstatic int prism2sta_resume(struct usb_interface *interface)\n{\n\tint result = 0;\n\tstruct hfa384x *hw = NULL;\n\tstruct wlandevice *wlandev;\n\n\twlandev = usb_get_intfdata(interface);\n\tif (!wlandev)\n\t\treturn -ENODEV;\n\n\thw = wlandev->priv;\n\tif (!hw)\n\t\treturn -ENODEV;\n\n\t \n\tif (prism2_doreset) {\n\t\tresult = hfa384x_corereset(hw,\n\t\t\t\t\t   prism2_reset_holdtime,\n\t\t\t\t\t   prism2_reset_settletime, 0);\n\t\tif (result != 0) {\n\t\t\tunregister_wlandev(wlandev);\n\t\t\thfa384x_destroy(hw);\n\t\t\tdev_err(&interface->dev, \"hfa384x_corereset() failed.\\n\");\n\t\t\tkfree(wlandev);\n\t\t\tkfree(hw);\n\t\t\twlandev = NULL;\n\t\t\treturn -ENODEV;\n\t\t}\n\t}\n\n\tprism2sta_ifstate(wlandev, P80211ENUM_ifstate_enable);\n\n\treturn 0;\n}\n#else\n#define prism2sta_suspend NULL\n#define prism2sta_resume NULL\n#endif  \n\nstatic struct usb_driver prism2_usb_driver = {\n\t.name = \"prism2_usb\",\n\t.probe = prism2sta_probe_usb,\n\t.disconnect = prism2sta_disconnect_usb,\n\t.id_table = usb_prism_tbl,\n\t.suspend = prism2sta_suspend,\n\t.resume = prism2sta_resume,\n\t.reset_resume = prism2sta_resume,\n\t \n};\n\nmodule_usb_driver(prism2_usb_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}