{
  "module_name": "p80211req.c",
  "hash_id": "5ba425a685234333d6ff0b987627aa560794f6b3df444d84944ec9628f2bfc7a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/wlan-ng/p80211req.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/sched.h>\n#include <linux/types.h>\n#include <linux/skbuff.h>\n#include <linux/wireless.h>\n#include <linux/netdevice.h>\n#include <linux/etherdevice.h>\n#include <net/sock.h>\n#include <linux/netlink.h>\n\n#include \"p80211types.h\"\n#include \"p80211hdr.h\"\n#include \"p80211mgmt.h\"\n#include \"p80211conv.h\"\n#include \"p80211msg.h\"\n#include \"p80211netdev.h\"\n#include \"p80211ioctl.h\"\n#include \"p80211metadef.h\"\n#include \"p80211metastruct.h\"\n#include \"p80211req.h\"\n\nstatic void p80211req_handlemsg(struct wlandevice *wlandev,\n\t\t\t\tstruct p80211msg *msg);\nstatic void p80211req_mibset_mibget(struct wlandevice *wlandev,\n\t\t\t\t    struct p80211msg_dot11req_mibget *mib_msg,\n\t\t\t\t    int isget);\n\nstatic void p80211req_handle_action(struct wlandevice *wlandev, u32 *data,\n\t\t\t\t    int isget, u32 flag)\n{\n\tif (isget) {\n\t\tif (wlandev->hostwep & flag)\n\t\t\t*data = P80211ENUM_truth_true;\n\t\telse\n\t\t\t*data = P80211ENUM_truth_false;\n\t} else {\n\t\twlandev->hostwep &= ~flag;\n\t\tif (*data == P80211ENUM_truth_true)\n\t\t\twlandev->hostwep |= flag;\n\t}\n}\n\n \nint p80211req_dorequest(struct wlandevice *wlandev, u8 *msgbuf)\n{\n\tstruct p80211msg *msg = (struct p80211msg *)msgbuf;\n\n\t \n\tif (!((wlandev->msdstate == WLAN_MSD_HWPRESENT &&\n\t       msg->msgcode == DIDMSG_LNXREQ_IFSTATE) ||\n\t      wlandev->msdstate == WLAN_MSD_RUNNING ||\n\t      wlandev->msdstate == WLAN_MSD_FWLOAD)) {\n\t\treturn -ENODEV;\n\t}\n\n\t \n\tif (!capable(CAP_NET_ADMIN) &&\n\t    (msg->msgcode != DIDMSG_DOT11REQ_MIBGET)) {\n\t\tnetdev_err(wlandev->netdev,\n\t\t\t   \"%s: only dot11req_mibget allowed for non-root.\\n\",\n\t\t\t   wlandev->name);\n\t\treturn -EPERM;\n\t}\n\n\t \n\tif (test_and_set_bit(1, &wlandev->request_pending))\n\t\treturn -EBUSY;\n\n\t \n\t \n\t \n\tp80211req_handlemsg(wlandev, msg);\n\n\t \n\tif (wlandev->mlmerequest)\n\t\twlandev->mlmerequest(wlandev, msg);\n\n\tclear_bit(1, &wlandev->request_pending);\n\treturn 0;\t \n}\n\n \nstatic void p80211req_handlemsg(struct wlandevice *wlandev,\n\t\t\t\tstruct p80211msg *msg)\n{\n\tswitch (msg->msgcode) {\n\tcase DIDMSG_LNXREQ_HOSTWEP: {\n\t\tstruct p80211msg_lnxreq_hostwep *req =\n\t\t\t(struct p80211msg_lnxreq_hostwep *)msg;\n\t\twlandev->hostwep &=\n\t\t\t\t~(HOSTWEP_DECRYPT | HOSTWEP_ENCRYPT);\n\t\tif (req->decrypt.data == P80211ENUM_truth_true)\n\t\t\twlandev->hostwep |= HOSTWEP_DECRYPT;\n\t\tif (req->encrypt.data == P80211ENUM_truth_true)\n\t\t\twlandev->hostwep |= HOSTWEP_ENCRYPT;\n\n\t\tbreak;\n\t}\n\tcase DIDMSG_DOT11REQ_MIBGET:\n\tcase DIDMSG_DOT11REQ_MIBSET: {\n\t\tint isget = (msg->msgcode == DIDMSG_DOT11REQ_MIBGET);\n\t\tstruct p80211msg_dot11req_mibget *mib_msg =\n\t\t\t(struct p80211msg_dot11req_mibget *)msg;\n\t\tp80211req_mibset_mibget(wlandev, mib_msg, isget);\n\t\tbreak;\n\t}\n\t}\t\t\t \n}\n\nstatic void p80211req_mibset_mibget(struct wlandevice *wlandev,\n\t\t\t\t    struct p80211msg_dot11req_mibget *mib_msg,\n\t\t\t\t    int isget)\n{\n\tstruct p80211itemd *mibitem =\n\t\t(struct p80211itemd *)mib_msg->mibattribute.data;\n\tstruct p80211pstrd *pstr = (struct p80211pstrd *)mibitem->data;\n\tu8 *key = mibitem->data + sizeof(struct p80211pstrd);\n\n\tswitch (mibitem->did) {\n\tcase didmib_dot11smt_wepdefaultkeystable_key(1):\n\tcase didmib_dot11smt_wepdefaultkeystable_key(2):\n\tcase didmib_dot11smt_wepdefaultkeystable_key(3):\n\tcase didmib_dot11smt_wepdefaultkeystable_key(4):\n\t\tif (!isget)\n\t\t\twep_change_key(wlandev,\n\t\t\t\t       P80211DID_ITEM(mibitem->did) - 1,\n\t\t\t\t       key, pstr->len);\n\t\tbreak;\n\n\tcase DIDMIB_DOT11SMT_PRIVACYTABLE_WEPDEFAULTKEYID: {\n\t\tu32 *data = (u32 *)mibitem->data;\n\n\t\tif (isget) {\n\t\t\t*data = wlandev->hostwep & HOSTWEP_DEFAULTKEY_MASK;\n\t\t} else {\n\t\t\twlandev->hostwep &= ~(HOSTWEP_DEFAULTKEY_MASK);\n\t\t\twlandev->hostwep |= (*data & HOSTWEP_DEFAULTKEY_MASK);\n\t\t}\n\t\tbreak;\n\t}\n\tcase DIDMIB_DOT11SMT_PRIVACYTABLE_PRIVACYINVOKED: {\n\t\tu32 *data = (u32 *)mibitem->data;\n\n\t\tp80211req_handle_action(wlandev, data, isget,\n\t\t\t\t\tHOSTWEP_PRIVACYINVOKED);\n\t\tbreak;\n\t}\n\tcase DIDMIB_DOT11SMT_PRIVACYTABLE_EXCLUDEUNENCRYPTED: {\n\t\tu32 *data = (u32 *)mibitem->data;\n\n\t\tp80211req_handle_action(wlandev, data, isget,\n\t\t\t\t\tHOSTWEP_EXCLUDEUNENCRYPTED);\n\t\tbreak;\n\t}\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}