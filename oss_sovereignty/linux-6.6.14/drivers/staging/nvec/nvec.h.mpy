{
  "module_name": "nvec.h",
  "hash_id": "fed23637e5a49cda8060896ed4b400e88c6f20b24373022ed11bf613fddbd23f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/nvec/nvec.h",
  "human_readable_source": " \n \n\n#ifndef __LINUX_MFD_NVEC\n#define __LINUX_MFD_NVEC\n\n#include <linux/atomic.h>\n#include <linux/clk.h>\n#include <linux/completion.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/notifier.h>\n#include <linux/reset.h>\n#include <linux/spinlock.h>\n#include <linux/workqueue.h>\n\n \n#define NVEC_POOL_SIZE\t64\n\n \n#define NVEC_MSG_SIZE\t34\n\n \nenum nvec_event_size {\n\tNVEC_2BYTES,\n\tNVEC_3BYTES,\n\tNVEC_VAR_SIZE,\n};\n\n \nenum nvec_msg_type {\n\tNVEC_SYS = 1,\n\tNVEC_BAT,\n\tNVEC_GPIO,\n\tNVEC_SLEEP,\n\tNVEC_KBD,\n\tNVEC_PS2,\n\tNVEC_CNTL,\n\tNVEC_OEM0 = 0x0d,\n\tNVEC_KB_EVT = 0x80,\n\tNVEC_PS2_EVT,\n};\n\n \nstruct nvec_msg {\n\tstruct list_head node;\n\tunsigned char data[NVEC_MSG_SIZE];\n\tunsigned short size;\n\tunsigned short pos;\n\tatomic_t used;\n};\n\n \nstruct nvec_chip {\n\tstruct device *dev;\n\tstruct gpio_desc *gpiod;\n\tint irq;\n\tu32 i2c_addr;\n\tvoid __iomem *base;\n\tstruct clk *i2c_clk;\n\tstruct reset_control *rst;\n\tstruct atomic_notifier_head notifier_list;\n\tstruct list_head rx_data, tx_data;\n\tstruct notifier_block nvec_status_notifier;\n\tstruct work_struct rx_work, tx_work;\n\tstruct workqueue_struct *wq;\n\tstruct nvec_msg msg_pool[NVEC_POOL_SIZE];\n\tstruct nvec_msg *rx;\n\n\tstruct nvec_msg *tx;\n\tstruct nvec_msg tx_scratch;\n\tstruct completion ec_transfer;\n\n\tspinlock_t tx_lock, rx_lock;\n\n\t \n\tstruct mutex sync_write_mutex;\n\tstruct completion sync_write;\n\tu16 sync_write_pending;\n\tstruct nvec_msg *last_sync_msg;\n\n\tint state;\n};\n\nint nvec_write_async(struct nvec_chip *nvec, const unsigned char *data,\n\t\t     short size);\n\nint nvec_write_sync(struct nvec_chip *nvec,\n\t\t    const unsigned char *data, short size,\n\t\t    struct nvec_msg **msg);\n\nint nvec_register_notifier(struct nvec_chip *nvec,\n\t\t\t   struct notifier_block *nb,\n\t\t\t   unsigned int events);\n\nint nvec_unregister_notifier(struct nvec_chip *dev, struct notifier_block *nb);\n\nvoid nvec_msg_free(struct nvec_chip *nvec, struct nvec_msg *msg);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}