{
  "module_name": "nvec_paz00.c",
  "hash_id": "4c920b94abd5a4028d277da5f1be674de3a9d1f96c896c08fed8fee8fae56efd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/nvec/nvec_paz00.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/err.h>\n#include <linux/slab.h>\n#include <linux/leds.h>\n#include <linux/platform_device.h>\n#include \"nvec.h\"\n\n#define NVEC_LED_REQ {'\\x0d', '\\x10', '\\x45', '\\x10', '\\x00'}\n\n#define NVEC_LED_MAX 8\n\nstruct nvec_led {\n\tstruct led_classdev cdev;\n\tstruct nvec_chip *nvec;\n};\n\nstatic void nvec_led_brightness_set(struct led_classdev *led_cdev,\n\t\t\t\t    enum led_brightness value)\n{\n\tstruct nvec_led *led = container_of(led_cdev, struct nvec_led, cdev);\n\tunsigned char buf[] = NVEC_LED_REQ;\n\n\tbuf[4] = value;\n\n\tnvec_write_async(led->nvec, buf, sizeof(buf));\n\n\tled->cdev.brightness = value;\n}\n\nstatic int nvec_paz00_probe(struct platform_device *pdev)\n{\n\tstruct nvec_chip *nvec = dev_get_drvdata(pdev->dev.parent);\n\tstruct nvec_led *led;\n\tint ret = 0;\n\n\tled = devm_kzalloc(&pdev->dev, sizeof(*led), GFP_KERNEL);\n\tif (!led)\n\t\treturn -ENOMEM;\n\n\tled->cdev.max_brightness = NVEC_LED_MAX;\n\n\tled->cdev.brightness_set = nvec_led_brightness_set;\n\tled->cdev.name = \"paz00-led\";\n\tled->cdev.flags |= LED_CORE_SUSPENDRESUME;\n\tled->nvec = nvec;\n\n\tplatform_set_drvdata(pdev, led);\n\n\tret = devm_led_classdev_register(&pdev->dev, &led->cdev);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tled->cdev.brightness = 0;\n\n\treturn 0;\n}\n\nstatic struct platform_driver nvec_paz00_driver = {\n\t.probe  = nvec_paz00_probe,\n\t.driver = {\n\t\t.name  = \"nvec-paz00\",\n\t},\n};\n\nmodule_platform_driver(nvec_paz00_driver);\n\nMODULE_AUTHOR(\"Ilya Petrov <ilya.muromec@gmail.com>\");\nMODULE_DESCRIPTION(\"Tegra NVEC PAZ00 driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:nvec-paz00\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}