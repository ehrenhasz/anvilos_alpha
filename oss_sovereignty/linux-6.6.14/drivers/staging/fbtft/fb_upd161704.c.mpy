{
  "module_name": "fb_upd161704.c",
  "hash_id": "f8f7b6184eb3505632cfed50399f590b2310474355ab225125c37bc90339b0f7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_upd161704.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n\n#include \"fbtft.h\"\n\n#define DRVNAME\t\t\"fb_upd161704\"\n#define WIDTH\t\t240\n#define HEIGHT\t\t320\n#define BPP\t\t16\n\nstatic int init_display(struct fbtft_par *par)\n{\n\tpar->fbtftops.reset(par);\n\n\t \n\n\t \n\twrite_reg(par, 0x0003, 0x0001);\t \n\n\t \n\twrite_reg(par, 0x003A, 0x0001);\t \n\tudelay(100);\n\n\t \n\twrite_reg(par, 0x0024, 0x007B);\t \n\tudelay(10);\n\twrite_reg(par, 0x0025, 0x003B);\t \n\twrite_reg(par, 0x0026, 0x0034);\t \n\tudelay(10);\n\twrite_reg(par, 0x0027, 0x0004);\t \n\twrite_reg(par, 0x0052, 0x0025);\t \n\tudelay(10);\n\twrite_reg(par, 0x0053, 0x0033);\t \n\twrite_reg(par, 0x0061, 0x001C);\t \n\tudelay(10);\n\twrite_reg(par, 0x0062, 0x002C);\t \n\twrite_reg(par, 0x0063, 0x0022);\t \n\tudelay(10);\n\twrite_reg(par, 0x0064, 0x0027);\t \n\tudelay(10);\n\twrite_reg(par, 0x0065, 0x0014);\t \n\tudelay(10);\n\twrite_reg(par, 0x0066, 0x0010);\t \n\n\t \n\twrite_reg(par, 0x002E, 0x002D);\n\n\t \n\twrite_reg(par, 0x0019, 0x0000);\t \n\tudelay(200);\n\twrite_reg(par, 0x001A, 0x1000);\t \n\twrite_reg(par, 0x001B, 0x0023);\t \n\twrite_reg(par, 0x001C, 0x0C01);\t \n\twrite_reg(par, 0x001D, 0x0000);\t \n\twrite_reg(par, 0x001E, 0x0009);\t \n\twrite_reg(par, 0x001F, 0x0035);\t \n\twrite_reg(par, 0x0020, 0x0015);\t \n\twrite_reg(par, 0x0018, 0x1E7B);\t \n\n\t \n\twrite_reg(par, 0x0008, 0x0000);\t \n\twrite_reg(par, 0x0009, 0x00EF);\t \n\twrite_reg(par, 0x000a, 0x0000);\t \n\twrite_reg(par, 0x000b, 0x013F);\t \n\n\t \n\twrite_reg(par, 0x0029, 0x0000);\t \n\twrite_reg(par, 0x002A, 0x0000);\t \n\twrite_reg(par, 0x002B, 0x00EF);\t \n\twrite_reg(par, 0x002C, 0x013F);\t \n\n\t \n\twrite_reg(par, 0x0032, 0x0002);\n\n\t \n\twrite_reg(par, 0x0033, 0x0000);\n\n\t \n\twrite_reg(par, 0x0037, 0x0000);\n\n\t \n\twrite_reg(par, 0x003B, 0x0001);\n\n\t \n\t \n\twrite_reg(par, 0x0004, 0x0000);\n\n\t \n\twrite_reg(par, 0x0005, 0x0000);\t \n\n\t \n\twrite_reg(par, 0x0001, 0x0000);\n\n\t \n\twrite_reg(par, 0x0000, 0x0000);\t \n\n\treturn 0;\n}\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\tswitch (par->info->var.rotate) {\n\t \n\t \n\tcase 0:\n\t\twrite_reg(par, 0x0006, xs);\n\t\twrite_reg(par, 0x0007, ys);\n\t\tbreak;\n\tcase 180:\n\t\twrite_reg(par, 0x0006, WIDTH - 1 - xs);\n\t\twrite_reg(par, 0x0007, HEIGHT - 1 - ys);\n\t\tbreak;\n\tcase 270:\n\t\twrite_reg(par, 0x0006, WIDTH - 1 - ys);\n\t\twrite_reg(par, 0x0007, xs);\n\t\tbreak;\n\tcase 90:\n\t\twrite_reg(par, 0x0006, ys);\n\t\twrite_reg(par, 0x0007, HEIGHT - 1 - xs);\n\t\tbreak;\n\t}\n\n\twrite_reg(par, 0x0e);  \n}\n\nstatic int set_var(struct fbtft_par *par)\n{\n\tswitch (par->info->var.rotate) {\n\t \n\tcase 0:\n\t\twrite_reg(par, 0x01, 0x0000);\n\t\twrite_reg(par, 0x05, 0x0000);\n\t\tbreak;\n\tcase 180:\n\t\twrite_reg(par, 0x01, 0x00C0);\n\t\twrite_reg(par, 0x05, 0x0000);\n\t\tbreak;\n\tcase 270:\n\t\twrite_reg(par, 0x01, 0x0080);\n\t\twrite_reg(par, 0x05, 0x0001);\n\t\tbreak;\n\tcase 90:\n\t\twrite_reg(par, 0x01, 0x0040);\n\t\twrite_reg(par, 0x05, 0x0001);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic struct fbtft_display display = {\n\t.regwidth = 16,\n\t.width = WIDTH,\n\t.height = HEIGHT,\n\t.fbtftops = {\n\t\t.init_display = init_display,\n\t\t.set_addr_win = set_addr_win,\n\t\t.set_var = set_var,\n\t},\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"nec,upd161704\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"platform:\" DRVNAME);\nMODULE_ALIAS(\"spi:upd161704\");\nMODULE_ALIAS(\"platform:upd161704\");\n\nMODULE_DESCRIPTION(\"FB driver for the uPD161704 LCD Controller\");\nMODULE_AUTHOR(\"Seong-Woo Kim\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}