{
  "module_name": "fb_hx8357d.c",
  "hash_id": "705b06f7ce323247496e9158100df2d6856fb21caad9d28f5bff33ba1ca667b3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_hx8357d.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <video/mipi_display.h>\n\n#include \"fbtft.h\"\n#include \"fb_hx8357d.h\"\n\n#define DRVNAME\t\t\"fb_hx8357d\"\n#define WIDTH\t\t320\n#define HEIGHT\t\t480\n\nstatic int init_display(struct fbtft_par *par)\n{\n\tpar->fbtftops.reset(par);\n\n\t \n\twrite_reg(par, MIPI_DCS_SOFT_RESET);\n\tusleep_range(5000, 7000);\n\n\t \n\twrite_reg(par, HX8357D_SETC, 0xFF, 0x83, 0x57);\n\tmsleep(150);\n\n\t \n\twrite_reg(par, HX8357_SETRGB, 0x00, 0x00, 0x06, 0x06);\n\n\t \n\twrite_reg(par, HX8357D_SETCOM, 0x25);\n\n\t \n\twrite_reg(par, HX8357_SETOSC, 0x68);\n\n\t \n\twrite_reg(par, HX8357_SETPANEL, 0x05);\n\n\twrite_reg(par, HX8357_SETPWR1,\n\t\t  0x00,   \n\t\t  0x15,   \n\t\t  0x1C,   \n\t\t  0x1C,   \n\t\t  0x83,   \n\t\t  0xAA);   \n\n\twrite_reg(par, HX8357D_SETSTBA,\n\t\t  0x50,   \n\t\t  0x50,   \n\t\t  0x01,   \n\t\t  0x3C,   \n\t\t  0x1E,   \n\t\t  0x08);   \n\n\twrite_reg(par, HX8357D_SETCYC,\n\t\t  0x02,   \n\t\t  0x40,   \n\t\t  0x00,   \n\t\t  0x2A,   \n\t\t  0x2A,   \n\t\t  0x0D,   \n\t\t  0x78);   \n\n\twrite_reg(par, HX8357D_SETGAMMA,\n\t\t  0x02,\n\t\t  0x0A,\n\t\t  0x11,\n\t\t  0x1d,\n\t\t  0x23,\n\t\t  0x35,\n\t\t  0x41,\n\t\t  0x4b,\n\t\t  0x4b,\n\t\t  0x42,\n\t\t  0x3A,\n\t\t  0x27,\n\t\t  0x1B,\n\t\t  0x08,\n\t\t  0x09,\n\t\t  0x03,\n\t\t  0x02,\n\t\t  0x0A,\n\t\t  0x11,\n\t\t  0x1d,\n\t\t  0x23,\n\t\t  0x35,\n\t\t  0x41,\n\t\t  0x4b,\n\t\t  0x4b,\n\t\t  0x42,\n\t\t  0x3A,\n\t\t  0x27,\n\t\t  0x1B,\n\t\t  0x08,\n\t\t  0x09,\n\t\t  0x03,\n\t\t  0x00,\n\t\t  0x01);\n\n\t \n\twrite_reg(par, MIPI_DCS_SET_PIXEL_FORMAT, 0x55);\n\n\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, 0xC0);\n\n\t \n\twrite_reg(par, MIPI_DCS_SET_TEAR_ON, 0x00);\n\n\t \n\twrite_reg(par, MIPI_DCS_SET_TEAR_SCANLINE, 0x00, 0x02);\n\n\t \n\twrite_reg(par, MIPI_DCS_EXIT_SLEEP_MODE);\n\tmsleep(150);\n\n\t \n\twrite_reg(par, MIPI_DCS_SET_DISPLAY_ON);\n\tusleep_range(5000, 7000);\n\n\treturn 0;\n}\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\twrite_reg(par, MIPI_DCS_SET_COLUMN_ADDRESS,\n\t\t  xs >> 8, xs & 0xff,   \n\t\t  xe >> 8, xe & 0xff);  \n\n\twrite_reg(par, MIPI_DCS_SET_PAGE_ADDRESS,\n\t\t  ys >> 8, ys & 0xff,   \n\t\t  ye >> 8, ye & 0xff);  \n\n\twrite_reg(par, MIPI_DCS_WRITE_MEMORY_START);\n}\n\n#define HX8357D_MADCTL_MY  0x80\n#define HX8357D_MADCTL_MX  0x40\n#define HX8357D_MADCTL_MV  0x20\n#define HX8357D_MADCTL_ML  0x10\n#define HX8357D_MADCTL_RGB 0x00\n#define HX8357D_MADCTL_BGR 0x08\n#define HX8357D_MADCTL_MH  0x04\nstatic int set_var(struct fbtft_par *par)\n{\n\tu8 val;\n\n\tswitch (par->info->var.rotate) {\n\tcase 270:\n\t\tval = HX8357D_MADCTL_MV | HX8357D_MADCTL_MX;\n\t\tbreak;\n\tcase 180:\n\t\tval = 0;\n\t\tbreak;\n\tcase 90:\n\t\tval = HX8357D_MADCTL_MV | HX8357D_MADCTL_MY;\n\t\tbreak;\n\tdefault:\n\t\tval = HX8357D_MADCTL_MX | HX8357D_MADCTL_MY;\n\t\tbreak;\n\t}\n\n\tval |= (par->bgr ? HX8357D_MADCTL_RGB : HX8357D_MADCTL_BGR);\n\n\t \n\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, val);\n\n\treturn 0;\n}\n\nstatic struct fbtft_display display = {\n\t.regwidth = 8,\n\t.width = WIDTH,\n\t.height = HEIGHT,\n\t.gamma_num = 2,\n\t.gamma_len = 14,\n\t.fbtftops = {\n\t\t.init_display = init_display,\n\t\t.set_addr_win = set_addr_win,\n\t\t.set_var = set_var,\n\t},\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"himax,hx8357d\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"platform:\" DRVNAME);\nMODULE_ALIAS(\"spi:hx8357d\");\nMODULE_ALIAS(\"platform:hx8357d\");\n\nMODULE_DESCRIPTION(\"FB driver for the HX8357D LCD Controller\");\nMODULE_AUTHOR(\"Sean Cross <xobs@kosagi.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}