{
  "module_name": "fb_uc1701.c",
  "hash_id": "4663b3b06d24c49add17d2a03cec6f7dff787e041aa970cb0e59524ba786c61c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_uc1701.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/gpio/consumer.h>\n#include <linux/spi/spi.h>\n#include <linux/delay.h>\n\n#include \"fbtft.h\"\n\n#define DRVNAME\t\"fb_uc1701\"\n#define WIDTH\t  102\n#define HEIGHT\t 64\n#define PAGES\t  (HEIGHT / 8)\n\n \n#define LCD_DISPLAY_ENABLE    0xAE\n \n#define LCD_START_LINE\t0x40\n \n#define LCD_PAGE_ADDRESS      0xB0\n \n#define LCD_COL_ADDRESS       0x10\n \n#define LCD_BOTTOMVIEW\t0xA0\n \n#define LCD_DISPLAY_INVERT    0xA6\n \n#define LCD_ALL_PIXEL\t 0xA4\n \n#define LCD_BIAS\t      0xA2\n \n#define LCD_RESET_CMD\t 0xE2\n \n#define LCD_SCAN_DIR\t  0xC0\n \n#define LCD_POWER_CONTROL     0x28\n \n#define LCD_VOLTAGE\t   0x20\n \n#define LCD_VOLUME_MODE       0x81\n \n#define LCD_NO_OP\t     0xE3\n \n#define LCD_ADV_PROG_CTRL     0xFA\n \n#define LCD_ADV_PROG_CTRL2    0x10\n#define LCD_TEMPCOMP_HIGH     0x80\n \n#define SHIFT_ADDR_NORMAL     0\n \n#define SHIFT_ADDR_TOPVIEW    30\n\nstatic int init_display(struct fbtft_par *par)\n{\n\tpar->fbtftops.reset(par);\n\n\t \n\twrite_reg(par, LCD_RESET_CMD);\n\tmdelay(10);\n\n\t \n\twrite_reg(par, LCD_START_LINE);\n\n\t \n\twrite_reg(par, LCD_BOTTOMVIEW | 1);\n\n\t \n\twrite_reg(par, LCD_SCAN_DIR | 0x00);\n\n\t \n\twrite_reg(par, LCD_ALL_PIXEL | 0);\n\n\t \n\twrite_reg(par, LCD_DISPLAY_INVERT | 0);\n\n\t \n\twrite_reg(par, LCD_BIAS | 0);\n\n\t \n\twrite_reg(par, LCD_POWER_CONTROL | 0x07);\n\n\t \n\twrite_reg(par, LCD_VOLTAGE | 0x07);\n\n\t \n\twrite_reg(par, LCD_VOLUME_MODE);\n\twrite_reg(par, 0x09);\n\twrite_reg(par, LCD_NO_OP);\n\n\t \n\twrite_reg(par, LCD_ADV_PROG_CTRL);\n\twrite_reg(par, LCD_ADV_PROG_CTRL2 | LCD_TEMPCOMP_HIGH);\n\n\t \n\twrite_reg(par, LCD_DISPLAY_ENABLE | 1);\n\n\treturn 0;\n}\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\t \n\twrite_reg(par, LCD_PAGE_ADDRESS);\n\twrite_reg(par, 0x00);\n\twrite_reg(par, LCD_COL_ADDRESS);\n}\n\nstatic int write_vmem(struct fbtft_par *par, size_t offset, size_t len)\n{\n\tu16 *vmem16 = (u16 *)par->info->screen_buffer;\n\tu8 *buf;\n\tint x, y, i;\n\tint ret = 0;\n\n\tfor (y = 0; y < PAGES; y++) {\n\t\tbuf = par->txbuf.buf;\n\t\tfor (x = 0; x < WIDTH; x++) {\n\t\t\t*buf = 0x00;\n\t\t\tfor (i = 0; i < 8; i++)\n\t\t\t\t*buf |= (vmem16[((y * 8 * WIDTH) +\n\t\t\t\t\t\t (i * WIDTH)) + x] ?\n\t\t\t\t\t 1 : 0) << i;\n\t\t\tbuf++;\n\t\t}\n\n\t\twrite_reg(par, LCD_PAGE_ADDRESS | (u8)y);\n\t\twrite_reg(par, 0x00);\n\t\twrite_reg(par, LCD_COL_ADDRESS);\n\t\tgpiod_set_value(par->gpio.dc, 1);\n\t\tret = par->fbtftops.write(par, par->txbuf.buf, WIDTH);\n\t\tgpiod_set_value(par->gpio.dc, 0);\n\t}\n\n\tif (ret < 0)\n\t\tdev_err(par->info->device, \"write failed and returned: %d\\n\",\n\t\t\tret);\n\n\treturn ret;\n}\n\nstatic struct fbtft_display display = {\n\t.regwidth = 8,\n\t.width = WIDTH,\n\t.height = HEIGHT,\n\t.fbtftops = {\n\t\t.init_display = init_display,\n\t\t.set_addr_win = set_addr_win,\n\t\t.write_vmem = write_vmem,\n\t},\n\t.backlight = 1,\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"UltraChip,uc1701\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"spi:uc1701\");\n\nMODULE_DESCRIPTION(\"FB driver for the UC1701 LCD Controller\");\nMODULE_AUTHOR(\"Juergen Holzmann\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}