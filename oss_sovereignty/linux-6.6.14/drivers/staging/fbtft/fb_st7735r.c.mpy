{
  "module_name": "fb_st7735r.c",
  "hash_id": "50d9f629a1f2ba67d93f52078d6b8efdec437c4599f1fb98d2d070aad069170d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_st7735r.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <video/mipi_display.h>\n\n#include \"fbtft.h\"\n\n#define DRVNAME \"fb_st7735r\"\n#define DEFAULT_GAMMA   \"0F 1A 0F 18 2F 28 20 22 1F 1B 23 37 00 07 02 10\\n\" \\\n\t\t\t\"0F 1B 0F 17 33 2C 29 2E 30 30 39 3F 00 07 03 10\"\n\nstatic const s16 default_init_sequence[] = {\n\t-1, MIPI_DCS_SOFT_RESET,\n\t-2, 150,                                \n\n\t-1, MIPI_DCS_EXIT_SLEEP_MODE,\n\t-2, 500,                                \n\n\t \n\t-1, 0xB1, 0x01, 0x2C, 0x2D,\n\n\t \n\t-1, 0xB2, 0x01, 0x2C, 0x2D,\n\n\t \n\t-1, 0xB3, 0x01, 0x2C, 0x2D, 0x01, 0x2C, 0x2D,\n\n\t \n\t-1, 0xB4, 0x07,\n\n\t \n\t-1, 0xC0, 0xA2, 0x02, 0x84,\n\n\t \n\t-1, 0xC1, 0xC5,\n\n\t \n\t-1, 0xC2, 0x0A, 0x00,\n\n\t \n\t-1, 0xC3, 0x8A, 0x2A,\n\n\t \n\t-1, 0xC4, 0x8A, 0xEE,\n\n\t \n\t-1, 0xC5, 0x0E,\n\n\t-1, MIPI_DCS_EXIT_INVERT_MODE,\n\n\t-1, MIPI_DCS_SET_PIXEL_FORMAT, MIPI_DCS_PIXEL_FMT_16BIT,\n\n\t-1, MIPI_DCS_SET_DISPLAY_ON,\n\t-2, 100,                                \n\n\t-1, MIPI_DCS_ENTER_NORMAL_MODE,\n\t-2, 10,                                \n\n\t \n\t-3\n};\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\twrite_reg(par, MIPI_DCS_SET_COLUMN_ADDRESS,\n\t\t  xs >> 8, xs & 0xFF, xe >> 8, xe & 0xFF);\n\n\twrite_reg(par, MIPI_DCS_SET_PAGE_ADDRESS,\n\t\t  ys >> 8, ys & 0xFF, ye >> 8, ye & 0xFF);\n\n\twrite_reg(par, MIPI_DCS_WRITE_MEMORY_START);\n}\n\n#define MY BIT(7)\n#define MX BIT(6)\n#define MV BIT(5)\nstatic int set_var(struct fbtft_par *par)\n{\n\t \n\tswitch (par->info->var.rotate) {\n\tcase 0:\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE,\n\t\t\t  MX | MY | (par->bgr << 3));\n\t\tbreak;\n\tcase 270:\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE,\n\t\t\t  MY | MV | (par->bgr << 3));\n\t\tbreak;\n\tcase 180:\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE,\n\t\t\t  par->bgr << 3);\n\t\tbreak;\n\tcase 90:\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE,\n\t\t\t  MX | MV | (par->bgr << 3));\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \n#define CURVE(num, idx)  curves[(num) * par->gamma.num_values + (idx)]\nstatic int set_gamma(struct fbtft_par *par, u32 *curves)\n{\n\tint i, j;\n\n\t \n\tfor (i = 0; i < par->gamma.num_curves; i++)\n\t\tfor (j = 0; j < par->gamma.num_values; j++)\n\t\t\tCURVE(i, j) &= 0x3f;\n\n\tfor (i = 0; i < par->gamma.num_curves; i++)\n\t\twrite_reg(par, 0xE0 + i,\n\t\t\t  CURVE(i, 0),  CURVE(i, 1),\n\t\t\t  CURVE(i, 2),  CURVE(i, 3),\n\t\t\t  CURVE(i, 4),  CURVE(i, 5),\n\t\t\t  CURVE(i, 6),  CURVE(i, 7),\n\t\t\t  CURVE(i, 8),  CURVE(i, 9),\n\t\t\t  CURVE(i, 10), CURVE(i, 11),\n\t\t\t  CURVE(i, 12), CURVE(i, 13),\n\t\t\t  CURVE(i, 14), CURVE(i, 15));\n\n\treturn 0;\n}\n\n#undef CURVE\n\nstatic struct fbtft_display display = {\n\t.regwidth = 8,\n\t.width = 128,\n\t.height = 160,\n\t.init_sequence = default_init_sequence,\n\t.gamma_num = 2,\n\t.gamma_len = 16,\n\t.gamma = DEFAULT_GAMMA,\n\t.fbtftops = {\n\t\t.set_addr_win = set_addr_win,\n\t\t.set_var = set_var,\n\t\t.set_gamma = set_gamma,\n\t},\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"sitronix,st7735r\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"platform:\" DRVNAME);\nMODULE_ALIAS(\"spi:st7735r\");\nMODULE_ALIAS(\"platform:st7735r\");\n\nMODULE_DESCRIPTION(\"FB driver for the ST7735R LCD Controller\");\nMODULE_AUTHOR(\"Noralf Tronnes\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}