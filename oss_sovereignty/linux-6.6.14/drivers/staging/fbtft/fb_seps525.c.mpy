{
  "module_name": "fb_seps525.c",
  "hash_id": "5045879e754c68264e2d51baf0158aef11bcf710509c195c75944c696241ab72",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_seps525.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/gpio.h>\n#include <linux/delay.h>\n\n#include \"fbtft.h\"\n\n#define DRVNAME\t\t\"fb_seps525\"\n#define WIDTH\t\t160\n#define HEIGHT\t\t128\n\n#define SEPS525_INDEX 0x00\n#define SEPS525_STATUS_RD 0x01\n#define SEPS525_OSC_CTL 0x02\n#define SEPS525_IREF 0x80\n#define SEPS525_CLOCK_DIV 0x03\n#define SEPS525_REDUCE_CURRENT 0x04\n#define SEPS525_SOFT_RST 0x05\n#define SEPS525_DISP_ONOFF 0x06\n#define SEPS525_PRECHARGE_TIME_R 0x08\n#define SEPS525_PRECHARGE_TIME_G 0x09\n#define SEPS525_PRECHARGE_TIME_B 0x0A\n#define SEPS525_PRECHARGE_CURRENT_R 0x0B\n#define SEPS525_PRECHARGE_CURRENT_G 0x0C\n#define SEPS525_PRECHARGE_CURRENT_B 0x0D\n#define SEPS525_DRIVING_CURRENT_R 0x10\n#define SEPS525_DRIVING_CURRENT_G 0x11\n#define SEPS525_DRIVING_CURRENT_B 0x12\n#define SEPS525_DISPLAYMODE_SET 0x13\n#define SEPS525_RGBIF 0x14\n#define SEPS525_RGB_POL 0x15\n#define SEPS525_MEMORY_WRITEMODE 0x16\n#define SEPS525_MX1_ADDR 0x17\n#define SEPS525_MX2_ADDR 0x18\n#define SEPS525_MY1_ADDR 0x19\n#define SEPS525_MY2_ADDR 0x1A\n#define SEPS525_MEMORY_ACCESS_POINTER_X 0x20\n#define SEPS525_MEMORY_ACCESS_POINTER_Y 0x21\n#define SEPS525_DDRAM_DATA_ACCESS_PORT 0x22\n#define SEPS525_GRAY_SCALE_TABLE_INDEX 0x50\n#define SEPS525_GRAY_SCALE_TABLE_DATA 0x51\n#define SEPS525_DUTY 0x28\n#define SEPS525_DSL 0x29\n#define SEPS525_D1_DDRAM_FAC 0x2E\n#define SEPS525_D1_DDRAM_FAR 0x2F\n#define SEPS525_D2_DDRAM_SAC 0x31\n#define SEPS525_D2_DDRAM_SAR 0x32\n#define SEPS525_SCR1_FX1 0x33\n#define SEPS525_SCR1_FX2 0x34\n#define SEPS525_SCR1_FY1 0x35\n#define SEPS525_SCR1_FY2 0x36\n#define SEPS525_SCR2_SX1 0x37\n#define SEPS525_SCR2_SX2 0x38\n#define SEPS525_SCR2_SY1 0x39\n#define SEPS525_SCR2_SY2 0x3A\n#define SEPS525_SCREEN_SAVER_CONTEROL 0x3B\n#define SEPS525_SS_SLEEP_TIMER 0x3C\n#define SEPS525_SCREEN_SAVER_MODE 0x3D\n#define SEPS525_SS_SCR1_FU 0x3E\n#define SEPS525_SS_SCR1_MXY 0x3F\n#define SEPS525_SS_SCR2_FU 0x40\n#define SEPS525_SS_SCR2_MXY 0x41\n#define SEPS525_MOVING_DIRECTION 0x42\n#define SEPS525_SS_SCR2_SX1 0x47\n#define SEPS525_SS_SCR2_SX2 0x48\n#define SEPS525_SS_SCR2_SY1 0x49\n#define SEPS525_SS_SCR2_SY2 0x4A\n\n \n#define MODE_SWAP_BGR\tBIT(7)\n#define MODE_SM\t\tBIT(6)\n#define MODE_RD\t\tBIT(5)\n#define MODE_CD\t\tBIT(4)\n\n#define seps525_use_window\t0  \n\n \nstatic int init_display(struct fbtft_par *par)\n{\n\tpar->fbtftops.reset(par);\n\n\tusleep_range(1000, 5000);\n\n\t \n\twrite_reg(par, SEPS525_REDUCE_CURRENT, 0x03);\n\tusleep_range(1000, 5000);\n\t \n\twrite_reg(par, SEPS525_REDUCE_CURRENT, 0x00);\n\tusleep_range(1000, 5000);\n\n\twrite_reg(par, SEPS525_SCREEN_SAVER_CONTEROL, 0x00);\n\t \n\twrite_reg(par, SEPS525_OSC_CTL, 0x01);\n\t \n\twrite_reg(par, SEPS525_CLOCK_DIV, 0x90);\n\t \n\twrite_reg(par, SEPS525_IREF, 0x01);\n\n\t \n\twrite_reg(par, SEPS525_PRECHARGE_TIME_R, 0x04);\n\twrite_reg(par, SEPS525_PRECHARGE_TIME_G, 0x05);\n\twrite_reg(par, SEPS525_PRECHARGE_TIME_B, 0x05);\n\n\t \n\twrite_reg(par, SEPS525_PRECHARGE_CURRENT_R, 0x9D);\n\twrite_reg(par, SEPS525_PRECHARGE_CURRENT_G, 0x8C);\n\twrite_reg(par, SEPS525_PRECHARGE_CURRENT_B, 0x57);\n\n\t \n\twrite_reg(par, SEPS525_DRIVING_CURRENT_R, 0x56);\n\twrite_reg(par, SEPS525_DRIVING_CURRENT_G, 0x4D);\n\twrite_reg(par, SEPS525_DRIVING_CURRENT_B, 0x46);\n\t \n\twrite_reg(par, SEPS525_DISPLAYMODE_SET, 0xA0);\n\twrite_reg(par, SEPS525_RGBIF, 0x01);  \n\t \n\twrite_reg(par, SEPS525_MEMORY_WRITEMODE, 0x66);\n\twrite_reg(par, SEPS525_DUTY, 0x7F);  \n\t \n\twrite_reg(par, SEPS525_DSL, 0x00);\n\twrite_reg(par, SEPS525_DISP_ONOFF, 0x01);  \n\t \n\twrite_reg(par, SEPS525_SOFT_RST, 0x00);\n\t \n\twrite_reg(par, SEPS525_RGB_POL, 0x00);\n\n\twrite_reg(par, SEPS525_DDRAM_DATA_ACCESS_PORT);\n\n\treturn 0;\n}\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\tif (seps525_use_window) {\n\t\t \n\t\twrite_reg(par, SEPS525_MX1_ADDR, xs);\n\t\twrite_reg(par, SEPS525_MX2_ADDR, xe);\n\t\twrite_reg(par, SEPS525_MY1_ADDR, ys);\n\t\twrite_reg(par, SEPS525_MY2_ADDR, ye);\n\t}\n\t \n\twrite_reg(par, SEPS525_MEMORY_ACCESS_POINTER_X, xs);\n\twrite_reg(par, SEPS525_MEMORY_ACCESS_POINTER_Y, ys);\n\n\twrite_reg(par, SEPS525_DDRAM_DATA_ACCESS_PORT);\n}\n\nstatic int set_var(struct fbtft_par *par)\n{\n\tu8 val;\n\n\tswitch (par->info->var.rotate) {\n\tcase 0:\n\t\tval = 0;\n\t\tbreak;\n\tcase 180:\n\t\tval = MODE_RD | MODE_CD;\n\t\tbreak;\n\tcase 90:\n\tcase 270:\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\t \n\twrite_reg(par, SEPS525_DISPLAYMODE_SET, val |\n\t\t       (par->bgr ? MODE_SWAP_BGR : 0));\n\n\twrite_reg(par, SEPS525_DDRAM_DATA_ACCESS_PORT);\n\n\treturn 0;\n}\n\nstatic struct fbtft_display display = {\n\t.regwidth = 8,\n\t.width = WIDTH,\n\t.height = HEIGHT,\n\t.fbtftops = {\n\t\t.init_display = init_display,\n\t\t.set_addr_win = set_addr_win,\n\t\t.set_var = set_var,\n\t},\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"syncoam,seps525\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"platform:\" DRVNAME);\nMODULE_ALIAS(\"spi:seps525\");\nMODULE_ALIAS(\"platform:seps525\");\n\nMODULE_DESCRIPTION(\"FB driver for the SEPS525 LCD Controller\");\nMODULE_AUTHOR(\"Michael Hennerich <michael.hennerich@analog.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}