{
  "module_name": "fb_ssd1289.c",
  "hash_id": "537f49ff07d59e59d8de4ea742f556771e6d6b7bc8fee3b76cae107c180a88fa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_ssd1289.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n\n#include \"fbtft.h\"\n\n#define DRVNAME\t\t\"fb_ssd1289\"\n#define WIDTH\t\t240\n#define HEIGHT\t\t320\n#define DEFAULT_GAMMA\t\"02 03 2 5 7 7 4 2 4 2\\n\" \\\n\t\t\t\"02 03 2 5 7 5 4 2 4 2\"\n\nstatic unsigned int reg11 = 0x6040;\nmodule_param(reg11, uint, 0000);\nMODULE_PARM_DESC(reg11, \"Register 11h value\");\n\nstatic int init_display(struct fbtft_par *par)\n{\n\tpar->fbtftops.reset(par);\n\n\twrite_reg(par, 0x00, 0x0001);\n\twrite_reg(par, 0x03, 0xA8A4);\n\twrite_reg(par, 0x0C, 0x0000);\n\twrite_reg(par, 0x0D, 0x080C);\n\twrite_reg(par, 0x0E, 0x2B00);\n\twrite_reg(par, 0x1E, 0x00B7);\n\twrite_reg(par, 0x01,\n\t\t  BIT(13) | (par->bgr << 11) | BIT(9) | (HEIGHT - 1));\n\twrite_reg(par, 0x02, 0x0600);\n\twrite_reg(par, 0x10, 0x0000);\n\twrite_reg(par, 0x05, 0x0000);\n\twrite_reg(par, 0x06, 0x0000);\n\twrite_reg(par, 0x16, 0xEF1C);\n\twrite_reg(par, 0x17, 0x0003);\n\twrite_reg(par, 0x07, 0x0233);\n\twrite_reg(par, 0x0B, 0x0000);\n\twrite_reg(par, 0x0F, 0x0000);\n\twrite_reg(par, 0x41, 0x0000);\n\twrite_reg(par, 0x42, 0x0000);\n\twrite_reg(par, 0x48, 0x0000);\n\twrite_reg(par, 0x49, 0x013F);\n\twrite_reg(par, 0x4A, 0x0000);\n\twrite_reg(par, 0x4B, 0x0000);\n\twrite_reg(par, 0x44, 0xEF00);\n\twrite_reg(par, 0x45, 0x0000);\n\twrite_reg(par, 0x46, 0x013F);\n\twrite_reg(par, 0x23, 0x0000);\n\twrite_reg(par, 0x24, 0x0000);\n\twrite_reg(par, 0x25, 0x8000);\n\twrite_reg(par, 0x4f, 0x0000);\n\twrite_reg(par, 0x4e, 0x0000);\n\twrite_reg(par, 0x22);\n\treturn 0;\n}\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\tswitch (par->info->var.rotate) {\n\t \n\t \n\tcase 0:\n\t\twrite_reg(par, 0x4e, xs);\n\t\twrite_reg(par, 0x4f, ys);\n\t\tbreak;\n\tcase 180:\n\t\twrite_reg(par, 0x4e, par->info->var.xres - 1 - xs);\n\t\twrite_reg(par, 0x4f, par->info->var.yres - 1 - ys);\n\t\tbreak;\n\tcase 270:\n\t\twrite_reg(par, 0x4e, par->info->var.yres - 1 - ys);\n\t\twrite_reg(par, 0x4f, xs);\n\t\tbreak;\n\tcase 90:\n\t\twrite_reg(par, 0x4e, ys);\n\t\twrite_reg(par, 0x4f, par->info->var.xres - 1 - xs);\n\t\tbreak;\n\t}\n\n\t \n\twrite_reg(par, 0x22);\n}\n\nstatic int set_var(struct fbtft_par *par)\n{\n\tif (par->fbtftops.init_display != init_display) {\n\t\t \n\t\tfbtft_par_dbg(DEBUG_INIT_DISPLAY, par,\n\t\t\t      \"%s: skipping since custom init_display() is used\\n\",\n\t\t\t      __func__);\n\t\treturn 0;\n\t}\n\n\tswitch (par->info->var.rotate) {\n\tcase 0:\n\t\twrite_reg(par, 0x11, reg11 | 0x30);\n\t\tbreak;\n\tcase 270:\n\t\twrite_reg(par, 0x11, reg11 | 0x28);\n\t\tbreak;\n\tcase 180:\n\t\twrite_reg(par, 0x11, reg11 | 0x00);\n\t\tbreak;\n\tcase 90:\n\t\twrite_reg(par, 0x11, reg11 | 0x18);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n \n#define CURVE(num, idx)  curves[(num) * par->gamma.num_values + (idx)]\nstatic int set_gamma(struct fbtft_par *par, u32 *curves)\n{\n\tstatic const unsigned long mask[] = {\n\t\t0x1f, 0x1f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,\n\t\t0x1f, 0x1f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,\n\t};\n\tint i, j;\n\n\t \n\tfor (i = 0; i < 2; i++)\n\t\tfor (j = 0; j < 10; j++)\n\t\t\tCURVE(i, j) &= mask[i * par->gamma.num_values + j];\n\n\twrite_reg(par, 0x0030, CURVE(0, 5) << 8 | CURVE(0, 4));\n\twrite_reg(par, 0x0031, CURVE(0, 7) << 8 | CURVE(0, 6));\n\twrite_reg(par, 0x0032, CURVE(0, 9) << 8 | CURVE(0, 8));\n\twrite_reg(par, 0x0033, CURVE(0, 3) << 8 | CURVE(0, 2));\n\twrite_reg(par, 0x0034, CURVE(1, 5) << 8 | CURVE(1, 4));\n\twrite_reg(par, 0x0035, CURVE(1, 7) << 8 | CURVE(1, 6));\n\twrite_reg(par, 0x0036, CURVE(1, 9) << 8 | CURVE(1, 8));\n\twrite_reg(par, 0x0037, CURVE(1, 3) << 8 | CURVE(1, 2));\n\twrite_reg(par, 0x003A, CURVE(0, 1) << 8 | CURVE(0, 0));\n\twrite_reg(par, 0x003B, CURVE(1, 1) << 8 | CURVE(1, 0));\n\n\treturn 0;\n}\n\n#undef CURVE\n\nstatic struct fbtft_display display = {\n\t.regwidth = 16,\n\t.width = WIDTH,\n\t.height = HEIGHT,\n\t.gamma_num = 2,\n\t.gamma_len = 10,\n\t.gamma = DEFAULT_GAMMA,\n\t.fbtftops = {\n\t\t.init_display = init_display,\n\t\t.set_addr_win = set_addr_win,\n\t\t.set_var = set_var,\n\t\t.set_gamma = set_gamma,\n\t},\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"solomon,ssd1289\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"platform:\" DRVNAME);\nMODULE_ALIAS(\"spi:ssd1289\");\nMODULE_ALIAS(\"platform:ssd1289\");\n\nMODULE_DESCRIPTION(\"FB driver for the SSD1289 LCD Controller\");\nMODULE_AUTHOR(\"Noralf Tronnes\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}