{
  "module_name": "fb_tinylcd.c",
  "hash_id": "3a010b5edde831b5829b7081ebd0ef855060eac39cb904d2c816e6c6914670e2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_tinylcd.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <video/mipi_display.h>\n\n#include \"fbtft.h\"\n\n#define DRVNAME\t\t\"fb_tinylcd\"\n#define WIDTH\t\t320\n#define HEIGHT\t\t480\n\nstatic int init_display(struct fbtft_par *par)\n{\n\tpar->fbtftops.reset(par);\n\n\twrite_reg(par, 0xB0, 0x80);\n\twrite_reg(par, 0xC0, 0x0A, 0x0A);\n\twrite_reg(par, 0xC1, 0x45, 0x07);\n\twrite_reg(par, 0xC2, 0x33);\n\twrite_reg(par, 0xC5, 0x00, 0x42, 0x80);\n\twrite_reg(par, 0xB1, 0xD0, 0x11);\n\twrite_reg(par, 0xB4, 0x02);\n\twrite_reg(par, 0xB6, 0x00, 0x22, 0x3B);\n\twrite_reg(par, 0xB7, 0x07);\n\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, 0x58);\n\twrite_reg(par, 0xF0, 0x36, 0xA5, 0xD3);\n\twrite_reg(par, 0xE5, 0x80);\n\twrite_reg(par, 0xE5, 0x01);\n\twrite_reg(par, 0xB3, 0x00);\n\twrite_reg(par, 0xE5, 0x00);\n\twrite_reg(par, 0xF0, 0x36, 0xA5, 0x53);\n\twrite_reg(par, 0xE0, 0x00, 0x35, 0x33, 0x00, 0x00, 0x00,\n\t\t       0x00, 0x35, 0x33, 0x00, 0x00, 0x00);\n\twrite_reg(par, MIPI_DCS_SET_PIXEL_FORMAT, 0x55);\n\twrite_reg(par, MIPI_DCS_EXIT_SLEEP_MODE);\n\tudelay(250);\n\twrite_reg(par, MIPI_DCS_SET_DISPLAY_ON);\n\n\treturn 0;\n}\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\twrite_reg(par, MIPI_DCS_SET_COLUMN_ADDRESS,\n\t\t  xs >> 8, xs & 0xFF, xe >> 8, xe & 0xFF);\n\n\twrite_reg(par, MIPI_DCS_SET_PAGE_ADDRESS,\n\t\t  ys >> 8, ys & 0xFF, ye >> 8, ye & 0xFF);\n\n\twrite_reg(par, MIPI_DCS_WRITE_MEMORY_START);\n}\n\nstatic int set_var(struct fbtft_par *par)\n{\n\tswitch (par->info->var.rotate) {\n\tcase 270:\n\t\twrite_reg(par, 0xB6, 0x00, 0x02, 0x3B);\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, 0x28);\n\t\tbreak;\n\tcase 180:\n\t\twrite_reg(par, 0xB6, 0x00, 0x22, 0x3B);\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, 0x58);\n\t\tbreak;\n\tcase 90:\n\t\twrite_reg(par, 0xB6, 0x00, 0x22, 0x3B);\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, 0x38);\n\t\tbreak;\n\tdefault:\n\t\twrite_reg(par, 0xB6, 0x00, 0x22, 0x3B);\n\t\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, 0x08);\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic struct fbtft_display display = {\n\t.regwidth = 8,\n\t.width = WIDTH,\n\t.height = HEIGHT,\n\t.fbtftops = {\n\t\t.init_display = init_display,\n\t\t.set_addr_win = set_addr_win,\n\t\t.set_var = set_var,\n\t},\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"neosec,tinylcd\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"spi:tinylcd\");\n\nMODULE_DESCRIPTION(\"Custom FB driver for tinylcd.com display\");\nMODULE_AUTHOR(\"Noralf Tronnes\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}