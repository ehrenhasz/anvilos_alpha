{
  "module_name": "fbtft.h",
  "hash_id": "4ff9840b52374135d69aebcad5693c32857b06f2873149a74c2b920b7115d3ef",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fbtft.h",
  "human_readable_source": " \n \n\n#ifndef __LINUX_FBTFT_H\n#define __LINUX_FBTFT_H\n\n#include <linux/fb.h>\n#include <linux/spinlock.h>\n#include <linux/spi/spi.h>\n#include <linux/platform_device.h>\n\n#define FBTFT_ONBOARD_BACKLIGHT 2\n\n#define FBTFT_GPIO_NO_MATCH\t\t0xFFFF\n#define FBTFT_GPIO_NAME_SIZE\t32\n#define FBTFT_MAX_INIT_SEQUENCE      512\n#define FBTFT_GAMMA_MAX_VALUES_TOTAL 128\n\n#define FBTFT_OF_INIT_CMD\tBIT(24)\n#define FBTFT_OF_INIT_DELAY\tBIT(25)\n\n \nstruct fbtft_gpio {\n\tchar name[FBTFT_GPIO_NAME_SIZE];\n\tstruct gpio_desc *gpio;\n};\n\nstruct fbtft_par;\n\n \nstruct fbtft_ops {\n\tint (*write)(struct fbtft_par *par, void *buf, size_t len);\n\tint (*read)(struct fbtft_par *par, void *buf, size_t len);\n\tint (*write_vmem)(struct fbtft_par *par, size_t offset, size_t len);\n\tvoid (*write_register)(struct fbtft_par *par, int len, ...);\n\n\tvoid (*set_addr_win)(struct fbtft_par *par,\n\t\t\t     int xs, int ys, int xe, int ye);\n\tvoid (*reset)(struct fbtft_par *par);\n\tvoid (*mkdirty)(struct fb_info *info, int from, int to);\n\tvoid (*update_display)(struct fbtft_par *par,\n\t\t\t       unsigned int start_line, unsigned int end_line);\n\tint (*init_display)(struct fbtft_par *par);\n\tint (*blank)(struct fbtft_par *par, bool on);\n\n\tunsigned long (*request_gpios_match)(struct fbtft_par *par,\n\t\t\t\t\t     const struct fbtft_gpio *gpio);\n\tint (*request_gpios)(struct fbtft_par *par);\n\tint (*verify_gpios)(struct fbtft_par *par);\n\n\tvoid (*register_backlight)(struct fbtft_par *par);\n\tvoid (*unregister_backlight)(struct fbtft_par *par);\n\n\tint (*set_var)(struct fbtft_par *par);\n\tint (*set_gamma)(struct fbtft_par *par, u32 *curves);\n};\n\n \nstruct fbtft_display {\n\tunsigned int width;\n\tunsigned int height;\n\tunsigned int regwidth;\n\tunsigned int buswidth;\n\tunsigned int backlight;\n\tstruct fbtft_ops fbtftops;\n\tunsigned int bpp;\n\tunsigned int fps;\n\tint txbuflen;\n\tconst s16 *init_sequence;\n\tchar *gamma;\n\tint gamma_num;\n\tint gamma_len;\n\tunsigned long debug;\n};\n\n \nstruct fbtft_platform_data {\n\tstruct fbtft_display display;\n\tunsigned int rotate;\n\tbool bgr;\n\tunsigned int fps;\n\tint txbuflen;\n\tu8 startbyte;\n\tchar *gamma;\n\tvoid *extra;\n};\n\n \n \nstruct fbtft_par {\n\tstruct spi_device *spi;\n\tstruct platform_device *pdev;\n\tstruct fb_info *info;\n\tstruct fbtft_platform_data *pdata;\n\tu16 *ssbuf;\n\tu32 pseudo_palette[16];\n\tstruct {\n\t\tvoid *buf;\n\t\tsize_t len;\n\t} txbuf;\n\tu8 *buf;\n\tu8 startbyte;\n\tstruct fbtft_ops fbtftops;\n\tspinlock_t dirty_lock;\n\tunsigned int dirty_lines_start;\n\tunsigned int dirty_lines_end;\n\tstruct {\n\t\tstruct gpio_desc *reset;\n\t\tstruct gpio_desc *dc;\n\t\tstruct gpio_desc *rd;\n\t\tstruct gpio_desc *wr;\n\t\tstruct gpio_desc *latch;\n\t\tstruct gpio_desc *cs;\n\t\tstruct gpio_desc *db[16];\n\t\tstruct gpio_desc *led[16];\n\t\tstruct gpio_desc *aux[16];\n\t} gpio;\n\tconst s16 *init_sequence;\n\tstruct {\n\t\tstruct mutex lock;\n\t\tu32 *curves;\n\t\tint num_values;\n\t\tint num_curves;\n\t} gamma;\n\tunsigned long debug;\n\tbool first_update_done;\n\tktime_t update_time;\n\tbool bgr;\n\tvoid *extra;\n\tbool polarity;\n};\n\n#define NUMARGS(...)  (sizeof((int[]){__VA_ARGS__}) / sizeof(int))\n\n#define write_reg(par, ...)                                            \\\n\t((par)->fbtftops.write_register(par, NUMARGS(__VA_ARGS__), __VA_ARGS__))\n\n \nint fbtft_write_buf_dc(struct fbtft_par *par, void *buf, size_t len, int dc);\n__printf(5, 6)\nvoid fbtft_dbg_hex(const struct device *dev, int groupsize,\n\t\t   const void *buf, size_t len, const char *fmt, ...);\nstruct fb_info *fbtft_framebuffer_alloc(struct fbtft_display *display,\n\t\t\t\t\tstruct device *dev,\n\t\t\t\t\tstruct fbtft_platform_data *pdata);\nvoid fbtft_framebuffer_release(struct fb_info *info);\nint fbtft_register_framebuffer(struct fb_info *fb_info);\nint fbtft_unregister_framebuffer(struct fb_info *fb_info);\nvoid fbtft_register_backlight(struct fbtft_par *par);\nvoid fbtft_unregister_backlight(struct fbtft_par *par);\nint fbtft_init_display(struct fbtft_par *par);\nint fbtft_probe_common(struct fbtft_display *display, struct spi_device *sdev,\n\t\t       struct platform_device *pdev);\nvoid fbtft_remove_common(struct device *dev, struct fb_info *info);\n\n \nint fbtft_write_spi(struct fbtft_par *par, void *buf, size_t len);\nint fbtft_write_spi_emulate_9(struct fbtft_par *par, void *buf, size_t len);\nint fbtft_read_spi(struct fbtft_par *par, void *buf, size_t len);\nint fbtft_write_gpio8_wr(struct fbtft_par *par, void *buf, size_t len);\nint fbtft_write_gpio16_wr(struct fbtft_par *par, void *buf, size_t len);\nint fbtft_write_gpio16_wr_latched(struct fbtft_par *par, void *buf, size_t len);\n\n \nint fbtft_write_vmem8_bus8(struct fbtft_par *par, size_t offset, size_t len);\nint fbtft_write_vmem16_bus16(struct fbtft_par *par, size_t offset, size_t len);\nint fbtft_write_vmem16_bus8(struct fbtft_par *par, size_t offset, size_t len);\nint fbtft_write_vmem16_bus9(struct fbtft_par *par, size_t offset, size_t len);\nvoid fbtft_write_reg8_bus8(struct fbtft_par *par, int len, ...);\nvoid fbtft_write_reg8_bus9(struct fbtft_par *par, int len, ...);\nvoid fbtft_write_reg16_bus8(struct fbtft_par *par, int len, ...);\nvoid fbtft_write_reg16_bus16(struct fbtft_par *par, int len, ...);\n\n#define FBTFT_DT_TABLE(_compatible)\t\t\t\t\t\t\\\nstatic const struct of_device_id dt_ids[] = {\t\t\t\t\t\\\n\t{ .compatible = _compatible },\t\t\t\t\t\t\\\n\t{},\t\t\t\t\t\t\t\t\t\\\n};\t\t\t\t\t\t\t\t\t\t\\\nMODULE_DEVICE_TABLE(of, dt_ids);\n\n#define FBTFT_SPI_DRIVER(_name, _compatible, _display, _spi_ids)\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\nstatic int fbtft_driver_probe_spi(struct spi_device *spi)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\t\\\n\treturn fbtft_probe_common(_display, spi, NULL);\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\nstatic void fbtft_driver_remove_spi(struct spi_device *spi)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\t\\\n\tstruct fb_info *info = spi_get_drvdata(spi);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\tfbtft_remove_common(&spi->dev, info);\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\nstatic struct spi_driver fbtft_driver_spi_driver = {\t\t\t\t\\\n\t.driver = {\t\t\t\t\t\t\t\t\\\n\t\t.name = _name,\t\t\t\t\t\t\t\\\n\t\t.of_match_table = dt_ids,\t\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\t\\\n\t.id_table = _spi_ids,\t\t\t\t\t\t\t\\\n\t.probe = fbtft_driver_probe_spi,\t\t\t\t\t\\\n\t.remove = fbtft_driver_remove_spi,\t\t\t\t\t\\\n};\n\n#define FBTFT_REGISTER_DRIVER(_name, _compatible, _display)                \\\n\t\t\t\t\t\t\t\t\t   \\\nstatic int fbtft_driver_probe_pdev(struct platform_device *pdev)           \\\n{                                                                          \\\n\treturn fbtft_probe_common(_display, NULL, pdev);                   \\\n}                                                                          \\\n\t\t\t\t\t\t\t\t\t   \\\nstatic int fbtft_driver_remove_pdev(struct platform_device *pdev)          \\\n{                                                                          \\\n\tstruct fb_info *info = platform_get_drvdata(pdev);                 \\\n\t\t\t\t\t\t\t\t\t   \\\n\tfbtft_remove_common(&pdev->dev, info);                             \\\n\treturn 0;                                                          \\\n}                                                                          \\\n\t\t\t\t\t\t\t\t\t   \\\nFBTFT_DT_TABLE(_compatible)\t\t\t\t\t\t   \\\n\t\t\t\t\t\t\t\t\t   \\\nFBTFT_SPI_DRIVER(_name, _compatible, _display, NULL)\t\t\t   \\\n\t\t\t\t\t\t\t\t\t   \\\nstatic struct platform_driver fbtft_driver_platform_driver = {             \\\n\t.driver = {                                                        \\\n\t\t.name   = _name,                                           \\\n\t\t.owner  = THIS_MODULE,                                     \\\n\t\t.of_match_table = dt_ids,                                  \\\n\t},                                                                 \\\n\t.probe  = fbtft_driver_probe_pdev,                                 \\\n\t.remove = fbtft_driver_remove_pdev,                                \\\n};                                                                         \\\n\t\t\t\t\t\t\t\t\t   \\\nstatic int __init fbtft_driver_module_init(void)                           \\\n{                                                                          \\\n\tint ret;                                                           \\\n\t\t\t\t\t\t\t\t\t   \\\n\tret = spi_register_driver(&fbtft_driver_spi_driver);               \\\n\tif (ret < 0)                                                       \\\n\t\treturn ret;                                                \\\n\tret = platform_driver_register(&fbtft_driver_platform_driver);     \\\n\tif (ret < 0)                                                       \\\n\t\tspi_unregister_driver(&fbtft_driver_spi_driver);           \\\n\treturn ret;                                                        \\\n}                                                                          \\\n\t\t\t\t\t\t\t\t\t   \\\nstatic void __exit fbtft_driver_module_exit(void)                          \\\n{                                                                          \\\n\tspi_unregister_driver(&fbtft_driver_spi_driver);                   \\\n\tplatform_driver_unregister(&fbtft_driver_platform_driver);         \\\n}                                                                          \\\n\t\t\t\t\t\t\t\t\t   \\\nmodule_init(fbtft_driver_module_init);                                     \\\nmodule_exit(fbtft_driver_module_exit);\n\n#define FBTFT_REGISTER_SPI_DRIVER(_name, _comp_vend, _comp_dev, _display)\t\\\n\t\t\t\t\t\t\t\t\t\t\\\nFBTFT_DT_TABLE(_comp_vend \",\" _comp_dev)\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\nstatic const struct spi_device_id spi_ids[] = {\t\t\t\t\t\\\n\t{ .name = _comp_dev },\t\t\t\t\t\t\t\\\n\t{},\t\t\t\t\t\t\t\t\t\\\n};\t\t\t\t\t\t\t\t\t\t\\\nMODULE_DEVICE_TABLE(spi, spi_ids);\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\nFBTFT_SPI_DRIVER(_name, _comp_vend \",\" _comp_dev, _display, spi_ids)\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\nmodule_spi_driver(fbtft_driver_spi_driver);\n\n \n\n \n#define DEBUG_LEVEL_1\tDEBUG_REQUEST_GPIOS\n#define DEBUG_LEVEL_2\t(DEBUG_LEVEL_1 | DEBUG_DRIVER_INIT_FUNCTIONS        \\\n\t\t\t\t       | DEBUG_TIME_FIRST_UPDATE)\n#define DEBUG_LEVEL_3\t(DEBUG_LEVEL_2 | DEBUG_RESET | DEBUG_INIT_DISPLAY   \\\n\t\t\t\t       | DEBUG_BLANK | DEBUG_REQUEST_GPIOS  \\\n\t\t\t\t       | DEBUG_FREE_GPIOS                   \\\n\t\t\t\t       | DEBUG_VERIFY_GPIOS                 \\\n\t\t\t\t       | DEBUG_BACKLIGHT | DEBUG_SYSFS)\n#define DEBUG_LEVEL_4\t(DEBUG_LEVEL_2 | DEBUG_FB_READ | DEBUG_FB_WRITE     \\\n\t\t\t\t       | DEBUG_FB_FILLRECT                  \\\n\t\t\t\t       | DEBUG_FB_COPYAREA                  \\\n\t\t\t\t       | DEBUG_FB_IMAGEBLIT | DEBUG_FB_BLANK)\n#define DEBUG_LEVEL_5\t(DEBUG_LEVEL_3 | DEBUG_UPDATE_DISPLAY)\n#define DEBUG_LEVEL_6\t(DEBUG_LEVEL_4 | DEBUG_LEVEL_5)\n#define DEBUG_LEVEL_7\t0xFFFFFFFF\n\n#define DEBUG_DRIVER_INIT_FUNCTIONS BIT(3)\n#define DEBUG_TIME_FIRST_UPDATE     BIT(4)\n#define DEBUG_TIME_EACH_UPDATE      BIT(5)\n#define DEBUG_DEFERRED_IO           BIT(6)\n#define DEBUG_FBTFT_INIT_FUNCTIONS  BIT(7)\n\n \n#define DEBUG_FB_READ               BIT(8)\n#define DEBUG_FB_WRITE              BIT(9)\n#define DEBUG_FB_FILLRECT           BIT(10)\n#define DEBUG_FB_COPYAREA           BIT(11)\n#define DEBUG_FB_IMAGEBLIT          BIT(12)\n#define DEBUG_FB_SETCOLREG          BIT(13)\n#define DEBUG_FB_BLANK              BIT(14)\n\n#define DEBUG_SYSFS                 BIT(16)\n\n \n#define DEBUG_BACKLIGHT             BIT(17)\n#define DEBUG_READ                  BIT(18)\n#define DEBUG_WRITE                 BIT(19)\n#define DEBUG_WRITE_VMEM            BIT(20)\n#define DEBUG_WRITE_REGISTER        BIT(21)\n#define DEBUG_SET_ADDR_WIN          BIT(22)\n#define DEBUG_RESET                 BIT(23)\n#define DEBUG_MKDIRTY               BIT(24)\n#define DEBUG_UPDATE_DISPLAY        BIT(25)\n#define DEBUG_INIT_DISPLAY          BIT(26)\n#define DEBUG_BLANK                 BIT(27)\n#define DEBUG_REQUEST_GPIOS         BIT(28)\n#define DEBUG_FREE_GPIOS            BIT(29)\n#define DEBUG_REQUEST_GPIOS_MATCH   BIT(30)\n#define DEBUG_VERIFY_GPIOS          BIT(31)\n\n#define fbtft_init_dbg(dev, format, arg...)                  \\\ndo {                                                         \\\n\tif (unlikely((dev)->platform_data &&                 \\\n\t    (((struct fbtft_platform_data *)(dev)->platform_data)->display.debug & DEBUG_DRIVER_INIT_FUNCTIONS))) \\\n\t\tdev_info(dev, format, ##arg);                \\\n} while (0)\n\n#define fbtft_par_dbg(level, par, format, arg...)            \\\ndo {                                                         \\\n\tif (unlikely((par)->debug & (level)))                    \\\n\t\tdev_info((par)->info->device, format, ##arg);  \\\n} while (0)\n\n#define fbtft_par_dbg_hex(level, par, dev, type, buf, num, format, arg...) \\\ndo {                                                                       \\\n\tif (unlikely((par)->debug & (level)))                                  \\\n\t\tfbtft_dbg_hex(dev, sizeof(type), buf,\\\n\t\t\t      (num) * sizeof(type), format, ##arg); \\\n} while (0)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}