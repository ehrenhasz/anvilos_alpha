{
  "module_name": "fb_ili9340.c",
  "hash_id": "58fd455d84d22e180ca9de4f346cfabdb661d859ca12606ad6a6526828f9c77f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/fbtft/fb_ili9340.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <video/mipi_display.h>\n\n#include \"fbtft.h\"\n\n#define DRVNAME\t\t\"fb_ili9340\"\n#define WIDTH\t\t240\n#define HEIGHT\t\t320\n\n \nstatic int init_display(struct fbtft_par *par)\n{\n\tpar->fbtftops.reset(par);\n\n\twrite_reg(par, 0xEF, 0x03, 0x80, 0x02);\n\twrite_reg(par, 0xCF, 0x00, 0XC1, 0X30);\n\twrite_reg(par, 0xED, 0x64, 0x03, 0X12, 0X81);\n\twrite_reg(par, 0xE8, 0x85, 0x00, 0x78);\n\twrite_reg(par, 0xCB, 0x39, 0x2C, 0x00, 0x34, 0x02);\n\twrite_reg(par, 0xF7, 0x20);\n\twrite_reg(par, 0xEA, 0x00, 0x00);\n\n\t \n\twrite_reg(par, 0xC0, 0x23);\n\n\t \n\twrite_reg(par, 0xC1, 0x10);\n\n\t \n\twrite_reg(par, 0xC5, 0x3e, 0x28);\n\n\t \n\twrite_reg(par, 0xC7, 0x86);\n\n\t \n\t \n\twrite_reg(par, MIPI_DCS_SET_PIXEL_FORMAT, 0x55);\n\n\t \n\t \n\twrite_reg(par, 0xB1, 0x00, 0x18);\n\n\t \n\twrite_reg(par, 0xB6, 0x08, 0x82, 0x27);\n\n\t \n\twrite_reg(par, 0xF2, 0x00);\n\n\t \n\twrite_reg(par, MIPI_DCS_SET_GAMMA_CURVE, 0x01);\n\n\t \n\twrite_reg(par, 0xE0,\n\t\t  0x0F, 0x31, 0x2B, 0x0C, 0x0E, 0x08, 0x4E, 0xF1,\n\t\t  0x37, 0x07, 0x10, 0x03, 0x0E, 0x09, 0x00);\n\n\t \n\twrite_reg(par, 0xE1,\n\t\t  0x00, 0x0E, 0x14, 0x03, 0x11, 0x07, 0x31, 0xC1,\n\t\t  0x48, 0x08, 0x0F, 0x0C, 0x31, 0x36, 0x0F);\n\n\twrite_reg(par, MIPI_DCS_EXIT_SLEEP_MODE);\n\n\tmdelay(120);\n\n\twrite_reg(par, MIPI_DCS_SET_DISPLAY_ON);\n\n\treturn 0;\n}\n\nstatic void set_addr_win(struct fbtft_par *par, int xs, int ys, int xe, int ye)\n{\n\twrite_reg(par, MIPI_DCS_SET_COLUMN_ADDRESS,\n\t\t  xs >> 8, xs & 0xFF, xe >> 8, xe & 0xFF);\n\n\twrite_reg(par, MIPI_DCS_SET_PAGE_ADDRESS,\n\t\t  ys >> 8, ys & 0xFF, ye >> 8, ye & 0xFF);\n\n\twrite_reg(par, MIPI_DCS_WRITE_MEMORY_START);\n}\n\n#define ILI9340_MADCTL_MV  0x20\n#define ILI9340_MADCTL_MX  0x40\n#define ILI9340_MADCTL_MY  0x80\nstatic int set_var(struct fbtft_par *par)\n{\n\tu8 val;\n\n\tswitch (par->info->var.rotate) {\n\tcase 270:\n\t\tval = ILI9340_MADCTL_MV;\n\t\tbreak;\n\tcase 180:\n\t\tval = ILI9340_MADCTL_MY;\n\t\tbreak;\n\tcase 90:\n\t\tval = ILI9340_MADCTL_MV | ILI9340_MADCTL_MY | ILI9340_MADCTL_MX;\n\t\tbreak;\n\tdefault:\n\t\tval = ILI9340_MADCTL_MX;\n\t\tbreak;\n\t}\n\t \n\twrite_reg(par, MIPI_DCS_SET_ADDRESS_MODE, val | (par->bgr << 3));\n\n\treturn 0;\n}\n\nstatic struct fbtft_display display = {\n\t.regwidth = 8,\n\t.width = WIDTH,\n\t.height = HEIGHT,\n\t.fbtftops = {\n\t\t.init_display = init_display,\n\t\t.set_addr_win = set_addr_win,\n\t\t.set_var = set_var,\n\t},\n};\n\nFBTFT_REGISTER_DRIVER(DRVNAME, \"ilitek,ili9340\", &display);\n\nMODULE_ALIAS(\"spi:\" DRVNAME);\nMODULE_ALIAS(\"platform:\" DRVNAME);\nMODULE_ALIAS(\"spi:ili9340\");\nMODULE_ALIAS(\"platform:ili9340\");\n\nMODULE_DESCRIPTION(\"FB driver for the ILI9340 LCD Controller\");\nMODULE_AUTHOR(\"Noralf Tronnes\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}