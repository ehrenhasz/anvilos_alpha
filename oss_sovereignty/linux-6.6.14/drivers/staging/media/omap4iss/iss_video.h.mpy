{
  "module_name": "iss_video.h",
  "hash_id": "11549d06805b44353756c1c46c3eef101c150e13fa91b1ed010c29d2f938787b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/omap4iss/iss_video.h",
  "human_readable_source": " \n \n\n#ifndef OMAP4_ISS_VIDEO_H\n#define OMAP4_ISS_VIDEO_H\n\n#include <linux/v4l2-mediabus.h>\n#include <media/media-entity.h>\n#include <media/v4l2-dev.h>\n#include <media/v4l2-fh.h>\n#include <media/videobuf2-v4l2.h>\n#include <media/videobuf2-dma-contig.h>\n\n#define ISS_VIDEO_DRIVER_NAME\t\t\"issvideo\"\n\nstruct iss_device;\nstruct iss_video;\nstruct v4l2_mbus_framefmt;\nstruct v4l2_pix_format;\n\n \nstruct iss_format_info {\n\tu32 code;\n\tu32 truncated;\n\tu32 uncompressed;\n\tu32 flavor;\n\tu32 pixelformat;\n\tunsigned int bpp;\n};\n\nenum iss_pipeline_stream_state {\n\tISS_PIPELINE_STREAM_STOPPED = 0,\n\tISS_PIPELINE_STREAM_CONTINUOUS = 1,\n\tISS_PIPELINE_STREAM_SINGLESHOT = 2,\n};\n\nenum iss_pipeline_state {\n\t \n\tISS_PIPELINE_STREAM_INPUT = BIT(0),\n\t \n\tISS_PIPELINE_STREAM_OUTPUT = BIT(1),\n\t \n\tISS_PIPELINE_QUEUE_INPUT = BIT(2),\n\t \n\tISS_PIPELINE_QUEUE_OUTPUT = BIT(3),\n\t \n\tISS_PIPELINE_IDLE_INPUT = BIT(4),\n\t \n\tISS_PIPELINE_IDLE_OUTPUT = BIT(5),\n\t \n\tISS_PIPELINE_STREAM = BIT(6),\n};\n\n \nstruct iss_pipeline {\n\tstruct media_pipeline pipe;\n\tspinlock_t lock;\t\t \n\tunsigned int state;\n\tenum iss_pipeline_stream_state stream_state;\n\tstruct iss_video *input;\n\tstruct iss_video *output;\n\tstruct media_entity_enum ent_enum;\n\tatomic_t frame_number;\n\tbool do_propagation;  \n\tbool error;\n\tstruct v4l2_fract max_timeperframe;\n\tstruct v4l2_subdev *external;\n\tunsigned int external_rate;\n\tint external_bpp;\n};\n\nstatic inline struct iss_pipeline *to_iss_pipeline(struct media_entity *entity)\n{\n\tstruct media_pipeline *pipe = media_entity_pipeline(entity);\n\n\tif (!pipe)\n\t\treturn NULL;\n\n\treturn container_of(pipe, struct iss_pipeline, pipe);\n}\n\nstatic inline int iss_pipeline_ready(struct iss_pipeline *pipe)\n{\n\treturn pipe->state == (ISS_PIPELINE_STREAM_INPUT |\n\t\t\t       ISS_PIPELINE_STREAM_OUTPUT |\n\t\t\t       ISS_PIPELINE_QUEUE_INPUT |\n\t\t\t       ISS_PIPELINE_QUEUE_OUTPUT |\n\t\t\t       ISS_PIPELINE_IDLE_INPUT |\n\t\t\t       ISS_PIPELINE_IDLE_OUTPUT);\n}\n\n \nstruct iss_buffer {\n\t \n\tstruct vb2_v4l2_buffer\tvb;\n\tstruct list_head\tlist;\n\tdma_addr_t iss_addr;\n};\n\n#define to_iss_buffer(buf)\tcontainer_of(buf, struct iss_buffer, vb)\n\nenum iss_video_dmaqueue_flags {\n\t \n\tISS_VIDEO_DMAQUEUE_UNDERRUN = BIT(0),\n\t \n\tISS_VIDEO_DMAQUEUE_QUEUED = BIT(1),\n};\n\n#define iss_video_dmaqueue_flags_clr(video)\t\\\n\t\t\t({ (video)->dmaqueue_flags = 0; })\n\n \nstruct iss_video_operations {\n\tint (*queue)(struct iss_video *video, struct iss_buffer *buffer);\n};\n\nstruct iss_video {\n\tstruct video_device video;\n\tenum v4l2_buf_type type;\n\tstruct media_pad pad;\n\n\tstruct mutex mutex;\t\t \n\tatomic_t active;\n\n\tstruct iss_device *iss;\n\n\tunsigned int capture_mem;\n\tunsigned int bpl_alignment;\t \n\tunsigned int bpl_zero_padding;\t \n\tunsigned int bpl_max;\t\t \n\tunsigned int bpl_value;\t\t \n\tunsigned int bpl_padding;\t \n\n\t \n\tstruct iss_pipeline pipe;\n\tstruct mutex stream_lock;\t \n\tbool error;\n\n\t \n\tstruct vb2_queue *queue;\n\tspinlock_t qlock;\t\t \n\tstruct list_head dmaqueue;\n\tenum iss_video_dmaqueue_flags dmaqueue_flags;\n\n\tconst struct iss_video_operations *ops;\n};\n\n#define to_iss_video(vdev)\tcontainer_of(vdev, struct iss_video, video)\n\nstruct iss_video_fh {\n\tstruct v4l2_fh vfh;\n\tstruct iss_video *video;\n\tstruct vb2_queue queue;\n\tstruct v4l2_format format;\n\tstruct v4l2_fract timeperframe;\n};\n\n#define to_iss_video_fh(fh)\tcontainer_of(fh, struct iss_video_fh, vfh)\n#define iss_video_queue_to_iss_video_fh(q) \\\n\t\t\t\tcontainer_of(q, struct iss_video_fh, queue)\n\nint omap4iss_video_init(struct iss_video *video, const char *name);\nvoid omap4iss_video_cleanup(struct iss_video *video);\nint omap4iss_video_register(struct iss_video *video,\n\t\t\t    struct v4l2_device *vdev);\nvoid omap4iss_video_unregister(struct iss_video *video);\nstruct iss_buffer *omap4iss_video_buffer_next(struct iss_video *video);\nvoid omap4iss_video_cancel_stream(struct iss_video *video);\nstruct media_pad *omap4iss_video_remote_pad(struct iss_video *video);\n\nconst struct iss_format_info *\nomap4iss_video_format_info(u32 code);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}