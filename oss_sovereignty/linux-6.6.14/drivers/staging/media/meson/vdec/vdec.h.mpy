{
  "module_name": "vdec.h",
  "hash_id": "dbb77c04a763b038f4042e2b413605c1a2f69a98730858dabf071045078826cc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/meson/vdec/vdec.h",
  "human_readable_source": " \n \n\n#ifndef __MESON_VDEC_CORE_H_\n#define __MESON_VDEC_CORE_H_\n\n#include <linux/irqreturn.h>\n#include <linux/regmap.h>\n#include <linux/list.h>\n#include <media/videobuf2-v4l2.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <linux/soc/amlogic/meson-canvas.h>\n\n#include \"vdec_platform.h\"\n\n \n#define MAX_CANVAS (32 * 3)\n\nstruct amvdec_buffer {\n\tstruct list_head list;\n\tstruct vb2_buffer *vb;\n};\n\n \nstruct amvdec_timestamp {\n\tstruct list_head list;\n\tstruct v4l2_timecode tc;\n\tu64 ts;\n\tu32 offset;\n\tu32 flags;\n\tu32 used_count;\n};\n\nstruct amvdec_session;\n\n \nstruct amvdec_core {\n\tvoid __iomem *dos_base;\n\tvoid __iomem *esparser_base;\n\tstruct regmap *regmap_ao;\n\n\tstruct device *dev;\n\tstruct device *dev_dec;\n\tconst struct vdec_platform *platform;\n\n\tstruct meson_canvas *canvas;\n\n\tstruct clk *dos_parser_clk;\n\tstruct clk *dos_clk;\n\tstruct clk *vdec_1_clk;\n\tstruct clk *vdec_hevc_clk;\n\tstruct clk *vdec_hevcf_clk;\n\n\tstruct reset_control *esparser_reset;\n\n\tstruct video_device *vdev_dec;\n\tstruct v4l2_device v4l2_dev;\n\n\tstruct amvdec_session *cur_sess;\n\tstruct mutex lock;\n};\n\n \nstruct amvdec_ops {\n\tint (*start)(struct amvdec_session *sess);\n\tint (*stop)(struct amvdec_session *sess);\n\tvoid (*conf_esparser)(struct amvdec_session *sess);\n\tu32 (*vififo_level)(struct amvdec_session *sess);\n};\n\n \nstruct amvdec_codec_ops {\n\tint (*start)(struct amvdec_session *sess);\n\tint (*stop)(struct amvdec_session *sess);\n\tint (*load_extended_firmware)(struct amvdec_session *sess,\n\t\t\t\t      const u8 *data, u32 len);\n\tu32 (*num_pending_bufs)(struct amvdec_session *sess);\n\tint (*can_recycle)(struct amvdec_core *core);\n\tvoid (*recycle)(struct amvdec_core *core, u32 buf_idx);\n\tvoid (*drain)(struct amvdec_session *sess);\n\tvoid (*resume)(struct amvdec_session *sess);\n\tconst u8 * (*eos_sequence)(u32 *len);\n\tirqreturn_t (*isr)(struct amvdec_session *sess);\n\tirqreturn_t (*threaded_isr)(struct amvdec_session *sess);\n};\n\n \nstruct amvdec_format {\n\tu32 pixfmt;\n\tu32 min_buffers;\n\tu32 max_buffers;\n\tu32 max_width;\n\tu32 max_height;\n\tu32 flags;\n\n\tstruct amvdec_ops *vdec_ops;\n\tstruct amvdec_codec_ops *codec_ops;\n\n\tchar *firmware_path;\n\tu32 pixfmts_cap[4];\n};\n\nenum amvdec_status {\n\tSTATUS_STOPPED,\n\tSTATUS_INIT,\n\tSTATUS_RUNNING,\n\tSTATUS_NEEDS_RESUME,\n};\n\n \nstruct amvdec_session {\n\tstruct amvdec_core *core;\n\n\tstruct v4l2_fh fh;\n\tstruct v4l2_m2m_dev *m2m_dev;\n\tstruct v4l2_m2m_ctx *m2m_ctx;\n\tstruct v4l2_ctrl_handler ctrl_handler;\n\tstruct v4l2_ctrl *ctrl_min_buf_capture;\n\tstruct mutex lock;\n\n\tconst struct amvdec_format *fmt_out;\n\tu32 pixfmt_cap;\n\tu32 src_buffer_size;\n\n\tu32 width;\n\tu32 height;\n\tu32 colorspace;\n\tu8 ycbcr_enc;\n\tu8 quantization;\n\tu8 xfer_func;\n\n\tstruct v4l2_fract pixelaspect;\n\n\tatomic_t esparser_queued_bufs;\n\tstruct work_struct esparser_queue_work;\n\n\tunsigned int streamon_cap, streamon_out;\n\tunsigned int sequence_cap, sequence_out;\n\tunsigned int should_stop;\n\tunsigned int keyframe_found;\n\tunsigned int num_dst_bufs;\n\tunsigned int changed_format;\n\n\tu8 canvas_alloc[MAX_CANVAS];\n\tu32 canvas_num;\n\n\tvoid *vififo_vaddr;\n\tdma_addr_t vififo_paddr;\n\tu32 vififo_size;\n\n\tstruct list_head bufs_recycle;\n\tstruct mutex bufs_recycle_lock;  \n\tstruct task_struct *recycle_thread;\n\n\tstruct list_head timestamps;\n\tspinlock_t ts_spinlock;  \n\n\tu64 last_irq_jiffies;\n\tu32 last_offset;\n\tu32 wrap_count;\n\tu32 fw_idx_to_vb2_idx[32];\n\n\tenum amvdec_status status;\n\tvoid *priv;\n};\n\nu32 amvdec_get_output_size(struct amvdec_session *sess);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}