{
  "module_name": "vi.h",
  "hash_id": "9d67da93b274fbc92916669167c5fd717c8f23a682cf43616931ef342acb1740",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/tegra-video/vi.h",
  "human_readable_source": " \n \n\n#ifndef __TEGRA_VI_H__\n#define __TEGRA_VI_H__\n\n#include <linux/host1x.h>\n#include <linux/list.h>\n\n#include <linux/mutex.h>\n#include <linux/spinlock.h>\n#include <linux/wait.h>\n\n#include <media/media-entity.h>\n#include <media/v4l2-async.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-dev.h>\n#include <media/v4l2-subdev.h>\n#include <media/videobuf2-v4l2.h>\n\n#include \"csi.h\"\n\n#define V4L2_CID_TEGRA_SYNCPT_TIMEOUT_RETRY\t(V4L2_CTRL_CLASS_CAMERA | 0x1001)\n\n#define TEGRA_DEF_WIDTH\t\t1920\n#define TEGRA_DEF_HEIGHT\t1080\n#define TEGRA_IMAGE_FORMAT_DEF\t32\n\n#define MAX_FORMAT_NUM\t\t64\n\nenum tegra_vi_pg_mode {\n\tTEGRA_VI_PG_DISABLED = 0,\n\tTEGRA_VI_PG_DIRECT,\n\tTEGRA_VI_PG_PATCH,\n};\n\nstruct tegra_vi;\nstruct tegra_vi_channel;\n\n \nstruct tegra_vi_ops {\n\tint (*vi_enable)(struct tegra_vi *vi, bool on);\n\tint (*channel_host1x_syncpt_init)(struct tegra_vi_channel *chan);\n\tvoid (*channel_host1x_syncpt_free)(struct tegra_vi_channel *chan);\n\tvoid (*vi_fmt_align)(struct v4l2_pix_format *pix, unsigned int bpp);\n\tvoid (*channel_queue_setup)(struct tegra_vi_channel *chan);\n\tint (*vi_start_streaming)(struct vb2_queue *vq, u32 count);\n\tvoid (*vi_stop_streaming)(struct vb2_queue *vq);\n};\n\n \nstruct tegra_vi_soc {\n\tconst struct tegra_video_format *video_formats;\n\tconst unsigned int nformats;\n\tconst struct tegra_video_format *default_video_format;\n\tconst struct tegra_vi_ops *ops;\n\tu32 hw_revision;\n\tunsigned int vi_max_channels;\n\tunsigned int vi_max_clk_hz;\n\tbool has_h_v_flip:1;\n};\n\n \nstruct tegra_vi {\n\tstruct device *dev;\n\tstruct host1x_client client;\n\tvoid __iomem *iomem;\n\tstruct clk *clk;\n\tstruct regulator *vdd;\n\tconst struct tegra_vi_soc *soc;\n\tconst struct tegra_vi_ops *ops;\n\tstruct list_head vi_chans;\n};\n\n \nstruct tegra_vi_channel {\n\tstruct list_head list;\n\tstruct video_device video;\n\t \n\tstruct mutex video_lock;\n\tstruct media_pad pad;\n\n\tstruct tegra_vi *vi;\n\tstruct host1x_syncpt *frame_start_sp[GANG_PORTS_MAX];\n\tstruct host1x_syncpt *mw_ack_sp[GANG_PORTS_MAX];\n\t \n\tspinlock_t sp_incr_lock[GANG_PORTS_MAX];\n\tu32 next_out_sp_idx;\n\n\tstruct task_struct *kthread_start_capture;\n\twait_queue_head_t start_wait;\n\tstruct task_struct *kthread_finish_capture;\n\twait_queue_head_t done_wait;\n\n\tstruct v4l2_pix_format format;\n\tconst struct tegra_video_format *fmtinfo;\n\tstruct vb2_queue queue;\n\tu32 sequence;\n\n\tunsigned int addr_offset_u;\n\tunsigned int addr_offset_v;\n\tunsigned int start_offset;\n\tunsigned int start_offset_u;\n\tunsigned int start_offset_v;\n\n\tstruct list_head capture;\n\t \n\tspinlock_t start_lock;\n\tstruct list_head done;\n\t \n\tspinlock_t done_lock;\n\n\tunsigned char portnos[GANG_PORTS_MAX];\n\tu8 totalports;\n\tu8 numgangports;\n\tstruct device_node *of_node;\n\n\tstruct v4l2_ctrl_handler ctrl_handler;\n\tunsigned int syncpt_timeout_retry;\n\tDECLARE_BITMAP(fmts_bitmap, MAX_FORMAT_NUM);\n\tDECLARE_BITMAP(tpg_fmts_bitmap, MAX_FORMAT_NUM);\n\tenum tegra_vi_pg_mode pg_mode;\n\n\tstruct v4l2_async_notifier notifier;\n\n\tbool hflip:1;\n\tbool vflip:1;\n};\n\n \nstruct tegra_channel_buffer {\n\tstruct vb2_v4l2_buffer buf;\n\tstruct list_head queue;\n\tstruct tegra_vi_channel *chan;\n\tdma_addr_t addr;\n\tu32 mw_ack_sp_thresh[GANG_PORTS_MAX];\n};\n\n \nenum tegra_image_dt {\n\tTEGRA_IMAGE_DT_YUV420_8 = 24,\n\tTEGRA_IMAGE_DT_YUV420_10,\n\n\tTEGRA_IMAGE_DT_YUV420CSPS_8 = 28,\n\tTEGRA_IMAGE_DT_YUV420CSPS_10,\n\tTEGRA_IMAGE_DT_YUV422_8,\n\tTEGRA_IMAGE_DT_YUV422_10,\n\tTEGRA_IMAGE_DT_RGB444,\n\tTEGRA_IMAGE_DT_RGB555,\n\tTEGRA_IMAGE_DT_RGB565,\n\tTEGRA_IMAGE_DT_RGB666,\n\tTEGRA_IMAGE_DT_RGB888,\n\n\tTEGRA_IMAGE_DT_RAW6 = 40,\n\tTEGRA_IMAGE_DT_RAW7,\n\tTEGRA_IMAGE_DT_RAW8,\n\tTEGRA_IMAGE_DT_RAW10,\n\tTEGRA_IMAGE_DT_RAW12,\n\tTEGRA_IMAGE_DT_RAW14,\n};\n\n \nstruct tegra_video_format {\n\tenum tegra_image_dt img_dt;\n\tunsigned int bit_width;\n\tunsigned int code;\n\tunsigned int bpp;\n\tu32 img_fmt;\n\tu32 fourcc;\n};\n\n#if defined(CONFIG_ARCH_TEGRA_2x_SOC)\nextern const struct tegra_vi_soc tegra20_vi_soc;\n#endif\n#if defined(CONFIG_ARCH_TEGRA_210_SOC)\nextern const struct tegra_vi_soc tegra210_vi_soc;\n#endif\n\nstruct v4l2_subdev *\ntegra_channel_get_remote_csi_subdev(struct tegra_vi_channel *chan);\nstruct v4l2_subdev *\ntegra_channel_get_remote_source_subdev(struct tegra_vi_channel *chan);\nint tegra_channel_set_stream(struct tegra_vi_channel *chan, bool on);\nvoid tegra_channel_release_buffers(struct tegra_vi_channel *chan,\n\t\t\t\t   enum vb2_buffer_state state);\nvoid tegra_channels_cleanup(struct tegra_vi *vi);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}