{
  "module_name": "hmm_bo.h",
  "hash_id": "0f2a3a09a33f968ecf83717671c497ebbd98d57efc2e4f0f67b36f57ea426767",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/include/hmm/hmm_bo.h",
  "human_readable_source": " \n \n\n#ifndef\t__HMM_BO_H__\n#define\t__HMM_BO_H__\n\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include \"mmu/isp_mmu.h\"\n#include \"hmm/hmm_common.h\"\n#include \"ia_css_types.h\"\n\n#define\tcheck_bodev_null_return(bdev, exp)\t\\\n\t\tcheck_null_return(bdev, exp, \\\n\t\t\t\"NULL hmm_bo_device.\\n\")\n\n#define\tcheck_bodev_null_return_void(bdev)\t\\\n\t\tcheck_null_return_void(bdev, \\\n\t\t\t\"NULL hmm_bo_device.\\n\")\n\n#define\tcheck_bo_status_yes_goto(bo, _status, label) \\\n\tvar_not_equal_goto((bo->status & (_status)), (_status), \\\n\t\t\tlabel, \\\n\t\t\t\"HMM buffer status not contain %s.\\n\", \\\n\t\t\t#_status)\n\n#define\tcheck_bo_status_no_goto(bo, _status, label) \\\n\tvar_equal_goto((bo->status & (_status)), (_status), \\\n\t\t\tlabel, \\\n\t\t\t\"HMM buffer status contains %s.\\n\", \\\n\t\t\t#_status)\n\n#define rbtree_node_to_hmm_bo(root_node)\t\\\n\tcontainer_of((root_node), struct hmm_buffer_object, node)\n\n#define\tlist_to_hmm_bo(list_ptr)\t\\\n\tlist_entry((list_ptr), struct hmm_buffer_object, list)\n\n#define\tkref_to_hmm_bo(kref_ptr)\t\\\n\tlist_entry((kref_ptr), struct hmm_buffer_object, kref)\n\n#define\tcheck_bo_null_return(bo, exp)\t\\\n\tcheck_null_return(bo, exp, \"NULL hmm buffer object.\\n\")\n\n#define\tcheck_bo_null_return_void(bo)\t\\\n\tcheck_null_return_void(bo, \"NULL hmm buffer object.\\n\")\n\n#define\tISP_VM_START\t0x0\n#define\tISP_VM_SIZE\t(0x7FFFFFFF)\t \n#define\tISP_PTR_NULL\tNULL\n\n#define\tHMM_BO_DEVICE_INITED\t0x1\n\nenum hmm_bo_type {\n\tHMM_BO_PRIVATE,\n\tHMM_BO_VMALLOC,\n\tHMM_BO_LAST,\n};\n\n#define\tHMM_BO_MASK\t\t0x1\n#define\tHMM_BO_FREE\t\t0x0\n#define\tHMM_BO_ALLOCED\t0x1\n#define\tHMM_BO_PAGE_ALLOCED\t0x2\n#define\tHMM_BO_BINDED\t\t0x4\n#define\tHMM_BO_MMAPED\t\t0x8\n#define\tHMM_BO_VMAPED\t\t0x10\n#define\tHMM_BO_VMAPED_CACHED\t0x20\n#define\tHMM_BO_ACTIVE\t\t0x1000\n\nstruct hmm_bo_device {\n\tstruct isp_mmu\t\tmmu;\n\n\t \n\tunsigned int start;\n\tunsigned int pgnr;\n\tunsigned int size;\n\n\t \n\tspinlock_t\tlist_lock;\n\tint flag;\n\n\t \n\tstruct list_head entire_bo_list;\n\t \n\tstruct rb_root allocated_rbtree;\n\t \n\tstruct rb_root free_rbtree;\n\tstruct mutex rbtree_mutex;\n\tstruct kmem_cache *bo_cache;\n};\n\nstruct hmm_buffer_object {\n\tstruct hmm_bo_device\t*bdev;\n\tstruct list_head\tlist;\n\tstruct kref\tkref;\n\n\tstruct page **pages;\n\n\t \n\tstruct mutex\t\tmutex;\n\tenum hmm_bo_type\ttype;\n\tint\t\tmmap_count;\n\tint\t\tstatus;\n\tvoid\t\t*vmap_addr;  \n\n\tstruct rb_node\tnode;\n\tunsigned int\tstart;\n\tunsigned int\tend;\n\tunsigned int\tpgnr;\n\t \n\tstruct hmm_buffer_object\t*prev;\n\tstruct hmm_buffer_object\t*next;\n};\n\nstruct hmm_buffer_object *hmm_bo_alloc(struct hmm_bo_device *bdev,\n\t\t\t\t       unsigned int pgnr);\n\nvoid hmm_bo_release(struct hmm_buffer_object *bo);\n\nint hmm_bo_device_init(struct hmm_bo_device *bdev,\n\t\t       struct isp_mmu_client *mmu_driver,\n\t\t       unsigned int vaddr_start, unsigned int size);\n\n \nvoid hmm_bo_device_exit(struct hmm_bo_device *bdev);\n\n \nint hmm_bo_device_inited(struct hmm_bo_device *bdev);\n\n \nvoid hmm_bo_ref(struct hmm_buffer_object *bo);\n\n \nvoid hmm_bo_unref(struct hmm_buffer_object *bo);\n\nint hmm_bo_allocated(struct hmm_buffer_object *bo);\n\n \nint hmm_bo_alloc_pages(struct hmm_buffer_object *bo,\n\t\t       enum hmm_bo_type type,\n\t\t       void *vmalloc_addr);\nvoid hmm_bo_free_pages(struct hmm_buffer_object *bo);\nint hmm_bo_page_allocated(struct hmm_buffer_object *bo);\n\n \nint hmm_bo_bind(struct hmm_buffer_object *bo);\nvoid hmm_bo_unbind(struct hmm_buffer_object *bo);\nint hmm_bo_binded(struct hmm_buffer_object *bo);\n\n \nvoid *hmm_bo_vmap(struct hmm_buffer_object *bo, bool cached);\n\n \nvoid hmm_bo_flush_vmap(struct hmm_buffer_object *bo);\n\n \nvoid hmm_bo_vunmap(struct hmm_buffer_object *bo);\n\n \nint hmm_bo_mmap(struct vm_area_struct *vma,\n\t\tstruct hmm_buffer_object *bo);\n\n \nstruct hmm_buffer_object *hmm_bo_device_search_start(\n    struct hmm_bo_device *bdev, ia_css_ptr vaddr);\n\n \nstruct hmm_buffer_object *hmm_bo_device_search_in_range(\n    struct hmm_bo_device *bdev, ia_css_ptr vaddr);\n\n \nstruct hmm_buffer_object *hmm_bo_device_search_vmap_start(\n    struct hmm_bo_device *bdev, const void *vaddr);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}