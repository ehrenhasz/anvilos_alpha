{
  "module_name": "notes.txt",
  "hash_id": "f207061b096450f6ba11eb8d2267f24b376f8c4119e3d20aca1ea4f1e560db0b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/notes.txt",
  "human_readable_source": "Some notes about the working of the atomisp drivers (learned while working\non cleaning it up).\n\nThe atomisp seems to be a generic DSP(ISP) like processor without a fixed\npipeline. It does not have its own memory, but instead uses main memory.\nThe ISP has its own address-space and main memory needs to be mapped into\nits address space through the ISP's MMU.\n\nMemory is allocated by the hmm code. hmm_alloc() returns an ISP virtual\naddress. The hmm code keeps a list of all allocations and when necessary\nthe hmm code finds the backing hmm-buffer-object (hmm_bo) by looking\nup the hmm_bo based on the ISP virtual address.\n\nThe actual processing pipeline is made by loading one or more programs,\ncalled binaries. The shisp_240??0_v21.bin firmware file contains many\ndifferent binaries. Binaries are picked by filling a ia_css_binary_descr\nstruct with various input and output parameters and then calling\nia_css_binary_find(). Some binaries support creating multiple outputs\n(preview + video frame?) at the same time.\n\nFor example for the /dev/video0 preview node load_preview_binaries()\nfrom atomisp/pci/sh_css.c is called and then loads a preview and\noptionally a scalar binary. Note when digital zoom is disabled\n(it is enabled by default) only the preview binary is loaded.\nSo in this case a single binary handles the entire pipeline.\n\nSince getting a picture requires multiple processing steps,\nthis means that unlike in fixed pipelines the soft pipelines\non the ISP can do multiple processing steps in a single pipeline\nelement (in a single binary).\n\n###\n\nThe sensor drivers use of v4l2_get_subdev_hostdata(), which returns\na camera_mipi_info struct. This struct is allocated/managed by\nthe core atomisp code. The most important parts of the struct\nare filled by the atomisp core itself, like e.g. the port number.\n\nOther members of camera_mipi_info which are set by some drivers are:\n-metadata_width, metadata_height, metadata_effective_width, set by\n the ov5693 driver (and used by the atomisp core)\n-raw_bayer_order, adjusted by the ov2680 driver when flipping since\n flipping can change the bayer order\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}