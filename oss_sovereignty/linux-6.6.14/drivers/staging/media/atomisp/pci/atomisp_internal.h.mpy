{
  "module_name": "atomisp_internal.h",
  "hash_id": "268e3ffaf5e3b6b6f91514bc297c087d3a4be22f4f1f99414b2ae9bfd85e733f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/atomisp_internal.h",
  "human_readable_source": " \n \n#ifndef __ATOMISP_INTERNAL_H__\n#define __ATOMISP_INTERNAL_H__\n\n#include \"../../include/linux/atomisp_platform.h\"\n#include <linux/firmware.h>\n#include <linux/kernel.h>\n#include <linux/pm_qos.h>\n#include <linux/idr.h>\n\n#include <media/media-device.h>\n#include <media/v4l2-async.h>\n#include <media/v4l2-subdev.h>\n\n \n#include \"ia_css_types.h\"\n#include \"sh_css_legacy.h\"\n\n#include \"atomisp_csi2.h\"\n#include \"atomisp_subdev.h\"\n#include \"atomisp_tpg.h\"\n#include \"atomisp_compat.h\"\n\n#include \"gp_device.h\"\n#include \"irq.h\"\n#include <linux/vmalloc.h>\n\n#define V4L2_EVENT_FRAME_END          5\n\n#define IS_HWREVISION(isp, rev) \\\n\t(((isp)->media_dev.hw_revision & ATOMISP_HW_REVISION_MASK) == \\\n\t ((rev) << ATOMISP_HW_REVISION_SHIFT))\n\n#define ATOMISP_PCI_DEVICE_SOC_MASK\t0xfff8\n \n#define ATOMISP_PCI_DEVICE_SOC_MRFLD\t0x1178\n \n#define ATOMISP_PCI_DEVICE_SOC_MRFLD_1179\t0x1179\n \n#define ATOMISP_PCI_DEVICE_SOC_MRFLD_117A\t0x117a\n#define ATOMISP_PCI_DEVICE_SOC_BYT\t0x0f38\n#define ATOMISP_PCI_DEVICE_SOC_ANN\t0x1478\n#define ATOMISP_PCI_DEVICE_SOC_CHT\t0x22b8\n\n#define ATOMISP_PCI_REV_MRFLD_A0_MAX\t0\n#define ATOMISP_PCI_REV_BYT_A0_MAX\t4\n\n#define ATOM_ISP_STEP_WIDTH\t2\n#define ATOM_ISP_STEP_HEIGHT\t2\n\n#define ATOM_ISP_MIN_WIDTH\t4\n#define ATOM_ISP_MIN_HEIGHT\t4\n#define ATOM_ISP_MAX_WIDTH\tUINT_MAX\n#define ATOM_ISP_MAX_HEIGHT\tUINT_MAX\n\n \n#define ATOM_RESOLUTION_SUBQCIF_WIDTH\t128\n#define ATOM_RESOLUTION_SUBQCIF_HEIGHT\t96\n\n#define ATOM_ISP_I2C_BUS_1\t4\n#define ATOM_ISP_I2C_BUS_2\t5\n\n#define ATOM_ISP_POWER_DOWN\t0\n#define ATOM_ISP_POWER_UP\t1\n\n#define ATOM_ISP_MAX_INPUTS\t3\n\n#define ATOMISP_SC_TYPE_SIZE\t2\n\n#define ATOMISP_ISP_TIMEOUT_DURATION\t\t(2 * HZ)\n#define ATOMISP_EXT_ISP_TIMEOUT_DURATION        (6 * HZ)\n#define ATOMISP_WDT_KEEP_CURRENT_DELAY          0\n#define ATOMISP_ISP_MAX_TIMEOUT_COUNT\t2\n#define ATOMISP_CSS_STOP_TIMEOUT_US\t200000\n\n#define ATOMISP_CSS_Q_DEPTH\t3\n#define ATOMISP_CSS_EVENTS_MAX  16\n#define ATOMISP_CONT_RAW_FRAMES 15\n#define ATOMISP_METADATA_QUEUE_DEPTH_FOR_HAL\t8\n#define ATOMISP_S3A_BUF_QUEUE_DEPTH_FOR_HAL\t8\n\n \n#define ATOMISP_MAX_ISR_LATENCY\t1000\n\n \n#define ATOMISP_CSS_SUPPORT_YUVPP     1\n\n#define ATOMISP_CSS_OUTPUT_SECOND_INDEX     1\n#define ATOMISP_CSS_OUTPUT_DEFAULT_INDEX    0\n\n \n#define ATOMISP_ION_DEVICE_FD_OFFSET   16\n#define ATOMISP_ION_SHARED_FD_MASK     (0xFFFF)\n#define ATOMISP_ION_DEVICE_FD_MASK     (~ATOMISP_ION_SHARED_FD_MASK)\n#define ION_FD_UNSET (-1)\n\n#define DIV_NEAREST_STEP(n, d, step) \\\n\tround_down((2 * (n) + (d) * (step)) / (2 * (d)), (step))\n\nstruct atomisp_input_subdev {\n\tunsigned int type;\n\tenum atomisp_camera_port port;\n\tu32 code;  \n\tbool binning_support;\n\tbool crop_support;\n\tstruct v4l2_subdev *camera;\n\t \n\tstruct v4l2_rect native_rect;\n\tstruct v4l2_rect active_rect;\n\t \n\tstruct v4l2_subdev_pad_config pad_cfg;\n\n\tstruct v4l2_subdev *motor;\n\n\t \n\tstruct atomisp_sub_device *asd;\n};\n\nenum atomisp_dfs_mode {\n\tATOMISP_DFS_MODE_AUTO = 0,\n\tATOMISP_DFS_MODE_LOW,\n\tATOMISP_DFS_MODE_MAX,\n};\n\nstruct atomisp_regs {\n\t \n\tu16 pcicmdsts;\n\tu32 ispmmadr;\n\tu32 msicap;\n\tu32 msi_addr;\n\tu16 msi_data;\n\tu8 intr;\n\tu32 interrupt_control;\n\tu32 pmcs;\n\tu32 cg_dis;\n\tu32 i_control;\n\n\t \n\tu32 csi_rcomp_config;\n\tu32 csi_afe_dly;\n\tu32 csi_control;\n\n\t \n\tu32 csi_afe_rcomp_config;\n\tu32 csi_afe_hs_control;\n\tu32 csi_deadline_control;\n\tu32 csi_access_viol;\n};\n\n \nstruct atomisp_device {\n\tstruct device *dev;\n\tstruct v4l2_device v4l2_dev;\n\tstruct media_device media_dev;\n\tstruct atomisp_sub_device asd;\n\tstruct v4l2_async_notifier notifier;\n\tstruct atomisp_platform_data *pdata;\n\tvoid *mmu_l1_base;\n\tvoid __iomem *base;\n\tconst struct firmware *firmware;\n\n\tstruct dev_pm_domain pm_domain;\n\tstruct pm_qos_request pm_qos;\n\ts32 max_isr_latency;\n\n\tstruct atomisp_mipi_csi2_device csi2_port[ATOMISP_CAMERA_NR_PORTS];\n\tstruct atomisp_tpg_device tpg;\n\n\t \n\tstruct mutex mutex;\n\n\t \n\tint sensor_lanes[N_MIPI_PORT_ID];\n\tstruct v4l2_subdev *sensor_subdevs[ATOMISP_CAMERA_NR_PORTS];\n\tunsigned int input_cnt;\n\tstruct atomisp_input_subdev inputs[ATOM_ISP_MAX_INPUTS];\n\tstruct v4l2_subdev *flash;\n\tstruct v4l2_subdev *motor;\n\n\tstruct atomisp_regs saved_regs;\n\tstruct atomisp_css_env css_env;\n\n\tbool isp_fatal_error;\n\tstruct work_struct assert_recovery_work;\n\n\tspinlock_t lock;  \n\n\tconst struct atomisp_dfs_config *dfs;\n\tunsigned int hpll_freq;\n\tunsigned int running_freq;\n\n\tbool css_initialized;\n};\n\n#define v4l2_dev_to_atomisp_device(dev) \\\n\tcontainer_of(dev, struct atomisp_device, v4l2_dev)\n\nextern struct device *atomisp_dev;\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}