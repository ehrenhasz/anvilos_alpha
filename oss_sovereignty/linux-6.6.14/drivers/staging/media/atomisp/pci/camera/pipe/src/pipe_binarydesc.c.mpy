{
  "module_name": "pipe_binarydesc.c",
  "hash_id": "073c0f78e89cc51ccba77be2d3bab4c961ba2b3acb462030f8dac5f1940955a7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/camera/pipe/src/pipe_binarydesc.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/math.h>\n\n#include \"ia_css_pipe_binarydesc.h\"\n#include \"ia_css_frame_format.h\"\n#include \"ia_css_pipe.h\"\n#include \"ia_css_pipe_util.h\"\n#include \"ia_css_util.h\"\n#include \"ia_css_debug.h\"\n#include \"sh_css_params.h\"\n#include <assert_support.h>\n \n#include \"gdc_device.h\"\n\n \n\n \nstatic void pipe_binarydesc_get_offline(\n    struct ia_css_pipe const *const pipe,\n    const int mode,\n    struct ia_css_binary_descr *descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info[],\n    struct ia_css_frame_info *vf_info)\n{\n\tunsigned int i;\n\t \n\tassert(pipe);\n\tassert(descr);\n\tia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE,\n\t\t\t    \"pipe_binarydesc_get_offline() enter:\\n\");\n\n\tdescr->mode = mode;\n\tdescr->online = false;\n\tdescr->continuous = pipe->stream->config.continuous;\n\tdescr->striped = false;\n\tdescr->two_ppc = false;\n\tdescr->enable_yuv_ds = false;\n\tdescr->enable_high_speed = false;\n\tdescr->enable_dvs_6axis = false;\n\tdescr->enable_reduced_pipe = false;\n\tdescr->enable_dz = true;\n\tdescr->enable_xnr = false;\n\tdescr->enable_dpc = false;\n\tdescr->enable_tnr = false;\n\tdescr->enable_capture_pp_bli = false;\n\tdescr->enable_fractional_ds = false;\n\tdescr->dvs_env.width = 0;\n\tdescr->dvs_env.height = 0;\n\tdescr->stream_format = pipe->stream->config.input_config.format;\n\tdescr->in_info = in_info;\n\tdescr->bds_out_info = NULL;\n\tfor (i = 0; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tdescr->out_info[i] = out_info[i];\n\tdescr->vf_info = vf_info;\n\tdescr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tdescr->required_bds_factor = SH_CSS_BDS_FACTOR_1_00;\n\tdescr->stream_config_left_padding = -1;\n}\n\nvoid ia_css_pipe_get_copy_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *copy_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *vf_info)\n{\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\tunsigned int i;\n\t \n\tassert(pipe);\n\tassert(in_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_COPY,\n\t\t\t\t    copy_descr, in_info, out_infos, vf_info);\n\tcopy_descr->online = true;\n\tcopy_descr->continuous = false;\n\tcopy_descr->two_ppc = (pipe->stream->config.pixels_per_clock == 2);\n\tcopy_descr->enable_dz = false;\n\tcopy_descr->isp_pipe_version = IA_CSS_PIPE_VERSION_1;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_vfpp_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *vf_pp_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info)\n{\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\tunsigned int i;\n\t \n\tassert(pipe);\n\tassert(in_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\tin_info->raw_bit_depth = 0;\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_VF_PP,\n\t\t\t\t    vf_pp_descr, in_info, out_infos, NULL);\n\tvf_pp_descr->enable_fractional_ds = true;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nstatic struct u32_fract bds_factors_list[] = {\n\t[SH_CSS_BDS_FACTOR_1_00] = {1, 1},\n\t[SH_CSS_BDS_FACTOR_1_25] = {5, 4},\n\t[SH_CSS_BDS_FACTOR_1_50] = {3, 2},\n\t[SH_CSS_BDS_FACTOR_2_00] = {2, 1},\n\t[SH_CSS_BDS_FACTOR_2_25] = {9, 4},\n\t[SH_CSS_BDS_FACTOR_2_50] = {5, 2},\n\t[SH_CSS_BDS_FACTOR_3_00] = {3, 1},\n\t[SH_CSS_BDS_FACTOR_4_00] = {4, 1},\n\t[SH_CSS_BDS_FACTOR_4_50] = {9, 2},\n\t[SH_CSS_BDS_FACTOR_5_00] = {5, 1},\n\t[SH_CSS_BDS_FACTOR_6_00] = {6, 1},\n\t[SH_CSS_BDS_FACTOR_8_00] = {8, 1},\n};\n\nint sh_css_bds_factor_get_fract(unsigned int bds_factor, struct u32_fract *bds)\n{\n\t \n\tif (bds_factor >= ARRAY_SIZE(bds_factors_list))\n\t\treturn -EINVAL;\n\n\t*bds = bds_factors_list[bds_factor];\n\treturn 0;\n}\n\nint binarydesc_calculate_bds_factor(\n    struct ia_css_resolution input_res,\n    struct ia_css_resolution output_res,\n    unsigned int *bds_factor)\n{\n\tunsigned int i;\n\tunsigned int in_w = input_res.width,\n\t\t     in_h = input_res.height,\n\t\t     out_w = output_res.width, out_h = output_res.height;\n\n\tunsigned int max_bds_factor = 8;\n\tunsigned int max_rounding_margin = 2;\n\t \n\tunsigned int delta = max_bds_factor * max_rounding_margin;\n\n\t \n\tassert(in_w != 0 && in_h != 0);\n\tassert(out_w != 0 && out_h != 0);\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(bds_factors_list); i++) {\n\t\tunsigned int num = bds_factors_list[i].numerator;\n\t\tunsigned int den = bds_factors_list[i].denominator;\n\n\t\t \n\t\tbool cond = (out_w * num / den + delta > in_w) &&\n\t\t\t    (out_w * num / den <= in_w) &&\n\t\t\t    (out_h * num / den + delta > in_h) &&\n\t\t\t    (out_h * num / den <= in_h);\n\n\t\tif (cond) {\n\t\t\t*bds_factor = i;\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\t \n\treturn -EINVAL;\n}\n\nint ia_css_pipe_get_preview_binarydesc(\n    struct ia_css_pipe *const pipe,\n    struct ia_css_binary_descr *preview_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *bds_out_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *vf_info)\n{\n\tint err;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\tint mode = IA_CSS_BINARY_MODE_PREVIEW;\n\tunsigned int i;\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tassert(vf_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t \n\tin_info->res = pipe->config.input_effective_res;\n\tin_info->padded_width = in_info->res.width;\n\tin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\n\n\tif (ia_css_util_is_input_format_yuv(pipe->stream->config.input_config.format))\n\t\tmode = IA_CSS_BINARY_MODE_COPY;\n\telse\n\t\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, mode,\n\t\t\t\t    preview_descr, in_info, out_infos, vf_info);\n\tif (pipe->stream->config.online) {\n\t\tpreview_descr->online = pipe->stream->config.online;\n\t\tpreview_descr->two_ppc =\n\t\t    (pipe->stream->config.pixels_per_clock == 2);\n\t}\n\tpreview_descr->stream_format = pipe->stream->config.input_config.format;\n\n\t \n\t*bds_out_info = *in_info;\n\n\tif (pipe->extra_config.enable_raw_binning) {\n\t\tif (pipe->config.bayer_ds_out_res.width != 0 &&\n\t\t    pipe->config.bayer_ds_out_res.height != 0) {\n\t\t\tbds_out_info->res.width =\n\t\t\t    pipe->config.bayer_ds_out_res.width;\n\t\t\tbds_out_info->res.height =\n\t\t\t    pipe->config.bayer_ds_out_res.height;\n\t\t\tbds_out_info->padded_width =\n\t\t\t    pipe->config.bayer_ds_out_res.width;\n\t\t\terr =\n\t\t\t    binarydesc_calculate_bds_factor(in_info->res,\n\t\t\t\t\t\t\t    bds_out_info->res,\n\t\t\t\t\t\t\t    &preview_descr->required_bds_factor);\n\t\t\tif (err)\n\t\t\t\treturn err;\n\t\t} else {\n\t\t\tbds_out_info->res.width = in_info->res.width / 2;\n\t\t\tbds_out_info->res.height = in_info->res.height / 2;\n\t\t\tbds_out_info->padded_width = in_info->padded_width / 2;\n\t\t\tpreview_descr->required_bds_factor =\n\t\t\t    SH_CSS_BDS_FACTOR_2_00;\n\t\t}\n\t} else {\n\t\t \n\t\tbds_out_info->res.width = in_info->res.width;\n\t\tbds_out_info->res.height = in_info->res.height;\n\t\tbds_out_info->padded_width = in_info->padded_width;\n\t\tpreview_descr->required_bds_factor = SH_CSS_BDS_FACTOR_1_00;\n\t}\n\tpipe->required_bds_factor = preview_descr->required_bds_factor;\n\n\t \n\tif (!pipe->extra_config.enable_fractional_ds)\n\t\tpreview_descr->bds_out_info = bds_out_info;\n\telse\n\t\tpreview_descr->bds_out_info = NULL;\n\t \n\t*out_info = *vf_info;\n\n\t \n\tif (!pipe->extra_config.enable_fractional_ds) {\n\t\t \n\t\tout_info->res.width = bds_out_info->res.width;\n\t\tout_info->res.height = bds_out_info->res.height;\n\t\tout_info->padded_width = bds_out_info->padded_width;\n\t}\n\tpreview_descr->enable_fractional_ds =\n\t    pipe->extra_config.enable_fractional_ds;\n\n\tpreview_descr->enable_dpc = pipe->config.enable_dpc;\n\n\tpreview_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tIA_CSS_LEAVE_ERR_PRIVATE(0);\n\treturn 0;\n}\n\nint ia_css_pipe_get_video_binarydesc(\n    struct ia_css_pipe *const pipe,\n    struct ia_css_binary_descr *video_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *bds_out_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *vf_info,\n    int stream_config_left_padding)\n{\n\tint mode = IA_CSS_BINARY_MODE_VIDEO;\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\tint err = 0;\n\tbool stream_dz_config = false;\n\n\t \n\tassert(pipe);\n\tassert(in_info);\n\t \n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t \n\tif (ia_css_util_is_input_format_yuv(pipe->stream->config.input_config.format))\n\t\tmode = IA_CSS_BINARY_MODE_COPY;\n\n\tin_info->res = pipe->config.input_effective_res;\n\tin_info->padded_width = in_info->res.width;\n\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\tin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, mode,\n\t\t\t\t    video_descr, in_info, out_infos, vf_info);\n\n\tif (pipe->stream->config.online) {\n\t\tvideo_descr->online = pipe->stream->config.online;\n\t\tvideo_descr->two_ppc =\n\t\t    (pipe->stream->config.pixels_per_clock == 2);\n\t}\n\n\tif (mode == IA_CSS_BINARY_MODE_VIDEO) {\n\t\tstream_dz_config =\n\t\t    ((pipe->stream->isp_params_configs->dz_config.dx !=\n\t\t      HRT_GDC_N)\n\t\t     || (pipe->stream->isp_params_configs->dz_config.dy !=\n\t\t\t HRT_GDC_N));\n\n\t\tvideo_descr->enable_dz = pipe->config.enable_dz\n\t\t\t\t\t || stream_dz_config;\n\t\tvideo_descr->dvs_env = pipe->config.dvs_envelope;\n\t\tvideo_descr->enable_yuv_ds = pipe->extra_config.enable_yuv_ds;\n\t\tvideo_descr->enable_high_speed =\n\t\t    pipe->extra_config.enable_high_speed;\n\t\tvideo_descr->enable_dvs_6axis =\n\t\t    pipe->extra_config.enable_dvs_6axis;\n\t\tvideo_descr->enable_reduced_pipe =\n\t\t    pipe->extra_config.enable_reduced_pipe;\n\t\tvideo_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\t\tvideo_descr->enable_fractional_ds =\n\t\t    pipe->extra_config.enable_fractional_ds;\n\t\tvideo_descr->enable_dpc =\n\t\t    pipe->config.enable_dpc;\n\t\tvideo_descr->enable_tnr =\n\t\t    pipe->config.enable_tnr;\n\n\t\tif (pipe->extra_config.enable_raw_binning) {\n\t\t\tif (pipe->config.bayer_ds_out_res.width != 0 &&\n\t\t\t    pipe->config.bayer_ds_out_res.height != 0) {\n\t\t\t\tbds_out_info->res.width =\n\t\t\t\t    pipe->config.bayer_ds_out_res.width;\n\t\t\t\tbds_out_info->res.height =\n\t\t\t\t    pipe->config.bayer_ds_out_res.height;\n\t\t\t\tbds_out_info->padded_width =\n\t\t\t\t    pipe->config.bayer_ds_out_res.width;\n\t\t\t\terr =\n\t\t\t\t    binarydesc_calculate_bds_factor(\n\t\t\t\t\tin_info->res, bds_out_info->res,\n\t\t\t\t\t&video_descr->required_bds_factor);\n\t\t\t\tif (err)\n\t\t\t\t\treturn err;\n\t\t\t} else {\n\t\t\t\tbds_out_info->res.width =\n\t\t\t\t    in_info->res.width / 2;\n\t\t\t\tbds_out_info->res.height =\n\t\t\t\t    in_info->res.height / 2;\n\t\t\t\tbds_out_info->padded_width =\n\t\t\t\t    in_info->padded_width / 2;\n\t\t\t\tvideo_descr->required_bds_factor =\n\t\t\t\t    SH_CSS_BDS_FACTOR_2_00;\n\t\t\t}\n\t\t} else {\n\t\t\tbds_out_info->res.width = in_info->res.width;\n\t\t\tbds_out_info->res.height = in_info->res.height;\n\t\t\tbds_out_info->padded_width = in_info->padded_width;\n\t\t\tvideo_descr->required_bds_factor =\n\t\t\t    SH_CSS_BDS_FACTOR_1_00;\n\t\t}\n\n\t\tpipe->required_bds_factor = video_descr->required_bds_factor;\n\n\t\t \n\t\tif (!pipe->extra_config.enable_fractional_ds)\n\t\t\tvideo_descr->bds_out_info = bds_out_info;\n\t\telse\n\t\t\tvideo_descr->bds_out_info = NULL;\n\n\t\tvideo_descr->enable_fractional_ds =\n\t\t    pipe->extra_config.enable_fractional_ds;\n\t\tvideo_descr->stream_config_left_padding = stream_config_left_padding;\n\t}\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nvoid ia_css_pipe_get_yuvscaler_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *yuv_scaler_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *internal_out_info,\n    struct ia_css_frame_info *vf_info)\n{\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\tstruct ia_css_frame_info *this_vf_info = NULL;\n\n\tassert(pipe);\n\tassert(in_info);\n\t \n\tassert(IA_CSS_BINARY_MAX_OUTPUT_PORTS == 2);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\tin_info->padded_width = in_info->res.width;\n\tin_info->raw_bit_depth = 0;\n\tia_css_frame_info_set_width(in_info, in_info->res.width, 0);\n\tout_infos[0] = out_info;\n\tout_infos[1] = internal_out_info;\n\t \n\n\tif (vf_info) {\n\t\tthis_vf_info = (vf_info->res.width == 0 &&\n\t\t\t\tvf_info->res.height == 0) ? NULL : vf_info;\n\t}\n\n\tpipe_binarydesc_get_offline(pipe,\n\t\t\t\t    IA_CSS_BINARY_MODE_CAPTURE_PP,\n\t\t\t\t    yuv_scaler_descr,\n\t\t\t\t    in_info, out_infos, this_vf_info);\n\n\tyuv_scaler_descr->enable_fractional_ds = true;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_capturepp_binarydesc(\n    struct ia_css_pipe *const pipe,\n    struct ia_css_binary_descr *capture_pp_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *vf_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(vf_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t \n\tif (pipe->out_yuv_ds_input_info.res.width)\n\t\t*in_info = pipe->out_yuv_ds_input_info;\n\telse\n\t\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_YUV420;\n\tin_info->raw_bit_depth = 0;\n\tia_css_frame_info_set_width(in_info, in_info->res.width, 0);\n\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe,\n\t\t\t\t    IA_CSS_BINARY_MODE_CAPTURE_PP,\n\t\t\t\t    capture_pp_descr,\n\t\t\t\t    in_info, out_infos, vf_info);\n\n\tcapture_pp_descr->enable_capture_pp_bli =\n\t    pipe->config.default_capture_config.enable_capture_pp_bli;\n\tcapture_pp_descr->enable_fractional_ds = true;\n\tcapture_pp_descr->enable_xnr =\n\t    pipe->config.default_capture_config.enable_xnr != 0;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\n \nstatic unsigned int primary_hq_binary_modes[NUM_PRIMARY_HQ_STAGES] = {\n\tIA_CSS_BINARY_MODE_PRIMARY_HQ_STAGE0,\n\tIA_CSS_BINARY_MODE_PRIMARY_HQ_STAGE1,\n\tIA_CSS_BINARY_MODE_PRIMARY_HQ_STAGE2,\n\tIA_CSS_BINARY_MODE_PRIMARY_HQ_STAGE3,\n\tIA_CSS_BINARY_MODE_PRIMARY_HQ_STAGE4,\n\tIA_CSS_BINARY_MODE_PRIMARY_HQ_STAGE5\n};\n\nvoid ia_css_pipe_get_primary_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *prim_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *vf_info,\n    unsigned int stage_idx)\n{\n\tenum ia_css_pipe_version pipe_version = pipe->config.isp_pipe_version;\n\tint mode;\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tassert(stage_idx < NUM_PRIMARY_HQ_STAGES);\n\t \n\t \n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\tif (pipe_version == IA_CSS_PIPE_VERSION_2_6_1)\n\t\tmode = primary_hq_binary_modes[stage_idx];\n\telse\n\t\tmode = IA_CSS_BINARY_MODE_PRIMARY;\n\n\tif (ia_css_util_is_input_format_yuv(pipe->stream->config.input_config.format))\n\t\tmode = IA_CSS_BINARY_MODE_COPY;\n\n\tin_info->res = pipe->config.input_effective_res;\n\tin_info->padded_width = in_info->res.width;\n\n\tif (pipe->stream->config.pack_raw_pixels)\n\t\tin_info->format = IA_CSS_FRAME_FORMAT_RAW_PACKED;\n\telse\n\t\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\n\tin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, mode,\n\t\t\t\t    prim_descr, in_info, out_infos, vf_info);\n\n\tif (pipe->stream->config.online &&\n\t    pipe->stream->config.mode != IA_CSS_INPUT_MODE_MEMORY) {\n\t\tprim_descr->online = true;\n\t\tprim_descr->two_ppc =\n\t\t    (pipe->stream->config.pixels_per_clock == 2);\n\t\tprim_descr->stream_format = pipe->stream->config.input_config.format;\n\t}\n\tif (mode == IA_CSS_BINARY_MODE_PRIMARY) {\n\t\tprim_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\t\tprim_descr->enable_fractional_ds =\n\t\t    pipe->extra_config.enable_fractional_ds;\n\t\t \n\t\tif (pipe_version == IA_CSS_PIPE_VERSION_2_6_1)\n\t\t\tprim_descr->striped = false;\n\t\telse\n\t\t\tprim_descr->striped = prim_descr->continuous &&\n\t\t\t\t\t      (!pipe->stream->stop_copy_preview || !pipe->stream->disable_cont_vf);\n\t}\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_pre_gdc_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *pre_gdc_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\tin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_ISP,\n\t\t\t\t    pre_gdc_descr, in_info, out_infos, NULL);\n\tpre_gdc_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_gdc_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *gdc_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_QPLANE6;\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_GDC,\n\t\t\t\t    gdc_descr, in_info, out_infos, NULL);\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_post_gdc_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *post_gdc_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *vf_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tassert(vf_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_YUV420_16;\n\tin_info->raw_bit_depth = 16;\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_POST_ISP,\n\t\t\t\t    post_gdc_descr, in_info, out_infos, vf_info);\n\n\tpost_gdc_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_pre_de_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *pre_de_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\tin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tif (pipe->config.isp_pipe_version == IA_CSS_PIPE_VERSION_1)\n\t\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_ISP,\n\t\t\t\t\t    pre_de_descr, in_info, out_infos, NULL);\n\telse if (pipe->config.isp_pipe_version == IA_CSS_PIPE_VERSION_2_2) {\n\t\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_DE,\n\t\t\t\t\t    pre_de_descr, in_info, out_infos, NULL);\n\t}\n\n\tif (pipe->stream->config.online) {\n\t\tpre_de_descr->online = true;\n\t\tpre_de_descr->two_ppc =\n\t\t    (pipe->stream->config.pixels_per_clock == 2);\n\t\tpre_de_descr->stream_format = pipe->stream->config.input_config.format;\n\t}\n\tpre_de_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_pre_anr_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *pre_anr_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\tin_info->raw_bit_depth = ia_css_pipe_util_pipe_input_format_bpp(pipe);\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_PRE_ISP,\n\t\t\t\t    pre_anr_descr, in_info, out_infos, NULL);\n\n\tif (pipe->stream->config.online) {\n\t\tpre_anr_descr->online = true;\n\t\tpre_anr_descr->two_ppc =\n\t\t    (pipe->stream->config.pixels_per_clock == 2);\n\t\tpre_anr_descr->stream_format = pipe->stream->config.input_config.format;\n\t}\n\tpre_anr_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_anr_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *anr_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\tin_info->raw_bit_depth = ANR_ELEMENT_BITS;\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_ANR,\n\t\t\t\t    anr_descr, in_info, out_infos, NULL);\n\n\tanr_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_post_anr_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *post_anr_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info,\n    struct ia_css_frame_info *vf_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tassert(vf_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\tin_info->format = IA_CSS_FRAME_FORMAT_RAW;\n\tin_info->raw_bit_depth = ANR_ELEMENT_BITS;\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_POST_ISP,\n\t\t\t\t    post_anr_descr, in_info, out_infos, vf_info);\n\n\tpost_anr_descr->isp_pipe_version = pipe->config.isp_pipe_version;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n\nvoid ia_css_pipe_get_ldc_binarydesc(\n    struct ia_css_pipe const *const pipe,\n    struct ia_css_binary_descr *ldc_descr,\n    struct ia_css_frame_info *in_info,\n    struct ia_css_frame_info *out_info)\n{\n\tunsigned int i;\n\tstruct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS];\n\n\tassert(pipe);\n\tassert(in_info);\n\tassert(out_info);\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t*in_info = *out_info;\n\n\tin_info->format = IA_CSS_FRAME_FORMAT_YUV420;\n\tin_info->raw_bit_depth = 0;\n\tia_css_frame_info_set_width(in_info, in_info->res.width, 0);\n\n\tout_infos[0] = out_info;\n\tfor (i = 1; i < IA_CSS_BINARY_MAX_OUTPUT_PORTS; i++)\n\t\tout_infos[i] = NULL;\n\n\tpipe_binarydesc_get_offline(pipe, IA_CSS_BINARY_MODE_CAPTURE_PP,\n\t\t\t\t    ldc_descr, in_info, out_infos, NULL);\n\tldc_descr->enable_dvs_6axis =\n\t    pipe->extra_config.enable_dvs_6axis;\n\tIA_CSS_LEAVE_PRIVATE(\"\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}