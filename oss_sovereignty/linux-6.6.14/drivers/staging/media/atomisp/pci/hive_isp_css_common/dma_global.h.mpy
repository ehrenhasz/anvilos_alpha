{
  "module_name": "dma_global.h",
  "hash_id": "7fcb78df47b6e9d9ac20b536ace23bd805fc56601d459cf264522b45b00ab6a9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/hive_isp_css_common/dma_global.h",
  "human_readable_source": " \n \n\n#ifndef __DMA_GLOBAL_H_INCLUDED__\n#define __DMA_GLOBAL_H_INCLUDED__\n\n#include <type_support.h>\n\n#define IS_DMA_VERSION_2\n\n#define HIVE_ISP_NUM_DMA_CONNS\t\t3\n#define HIVE_ISP_NUM_DMA_CHANNELS\t32\n\n#define N_DMA_CHANNEL_ID\tHIVE_ISP_NUM_DMA_CHANNELS\n\n#include \"dma_v2_defs.h\"\n\n \n\n#define _DMA_PACKING_SETUP_PARAM\t_DMA_V2_PACKING_SETUP_PARAM\n#define _DMA_HEIGHT_PARAM\t\t\t_DMA_V2_HEIGHT_PARAM\n#define _DMA_STRIDE_A_PARAM\t\t\t_DMA_V2_STRIDE_A_PARAM\n#define _DMA_ELEM_CROPPING_A_PARAM\t_DMA_V2_ELEM_CROPPING_A_PARAM\n#define _DMA_WIDTH_A_PARAM\t\t\t_DMA_V2_WIDTH_A_PARAM\n#define _DMA_STRIDE_B_PARAM\t\t\t_DMA_V2_STRIDE_B_PARAM\n#define _DMA_ELEM_CROPPING_B_PARAM\t_DMA_V2_ELEM_CROPPING_B_PARAM\n#define _DMA_WIDTH_B_PARAM\t\t\t_DMA_V2_WIDTH_B_PARAM\n\n#define _DMA_ZERO_EXTEND     _DMA_V2_ZERO_EXTEND\n#define _DMA_SIGN_EXTEND     _DMA_V2_SIGN_EXTEND\n\ntypedef unsigned int dma_channel;\n\ntypedef enum {\n\tdma_isp_to_bus_connection = HIVE_DMA_ISP_BUS_CONN,\n\tdma_isp_to_ddr_connection = HIVE_DMA_ISP_DDR_CONN,\n\tdma_bus_to_ddr_connection = HIVE_DMA_BUS_DDR_CONN,\n} dma_connection;\n\ntypedef enum {\n\tdma_zero_extension = _DMA_ZERO_EXTEND,\n\tdma_sign_extension = _DMA_SIGN_EXTEND\n} dma_extension;\n\n#define DMA_PROP_SHIFT(val, param)       ((val) << _DMA_V2_ ## param ## _IDX)\n#define DMA_PROP_MASK(param)             ((1U << _DMA_V2_ ## param ## _BITS) - 1)\n#define DMA_PACK(val, param)             DMA_PROP_SHIFT((val) & DMA_PROP_MASK(param), param)\n\n#define DMA_PACK_COMMAND(cmd)            DMA_PACK(cmd, CMD)\n#define DMA_PACK_CHANNEL(ch)             DMA_PACK(ch,  CHANNEL)\n#define DMA_PACK_PARAM(par)              DMA_PACK(par, PARAM)\n#define DMA_PACK_EXTENSION(ext)          DMA_PACK(ext, EXTENSION)\n#define DMA_PACK_LEFT_CROPPING(lc)       DMA_PACK(lc,  LEFT_CROPPING)\n#define DMA_PACK_WIDTH_A(w)              DMA_PACK(w,   SPEC_DEV_A_XB)\n#define DMA_PACK_WIDTH_B(w)              DMA_PACK(w,   SPEC_DEV_B_XB)\n#define DMA_PACK_HEIGHT(h)               DMA_PACK(h,   SPEC_YB)\n\n#define DMA_PACK_CMD_CHANNEL(cmd, ch)\t (DMA_PACK_COMMAND(cmd) | DMA_PACK_CHANNEL(ch))\n#define DMA_PACK_SETUP(conn, ext)        ((conn) | DMA_PACK_EXTENSION(ext))\n#define DMA_PACK_CROP_ELEMS(elems, crop) ((elems) | DMA_PACK_LEFT_CROPPING(crop))\n\n#define hive_dma_snd(dma_id, token) OP_std_snd(dma_id, (unsigned int)(token))\n\n#define DMA_PACK_BLOCK_CMD(cmd, ch, width_a, width_b, height) \\\n  (DMA_PACK_COMMAND(cmd)     | \\\n   DMA_PACK_CHANNEL(ch)      | \\\n   DMA_PACK_WIDTH_A(width_a) | \\\n   DMA_PACK_WIDTH_B(width_b) | \\\n   DMA_PACK_HEIGHT(height))\n\n#define hive_dma_move_data(dma_id, read, channel, addr_a, addr_b, to_is_var, from_is_var) \\\n{ \\\n  hive_dma_snd(dma_id, DMA_PACK(_DMA_V2_SET_CRUN_COMMAND, CMD)); \\\n  hive_dma_snd(dma_id, DMA_PACK_CMD_CHANNEL(read ? _DMA_V2_MOVE_B2A_COMMAND : _DMA_V2_MOVE_A2B_COMMAND, channel)); \\\n  hive_dma_snd(dma_id, read ? (unsigned int)(addr_b) : (unsigned int)(addr_a)); \\\n  hive_dma_snd(dma_id, read ? (unsigned int)(addr_a) : (unsigned int)(addr_b)); \\\n  hive_dma_snd(dma_id, to_is_var); \\\n  hive_dma_snd(dma_id, from_is_var); \\\n}\n\n#define hive_dma_move_data_no_ack(dma_id, read, channel, addr_a, addr_b, to_is_var, from_is_var) \\\n{ \\\n  hive_dma_snd(dma_id, DMA_PACK(_DMA_V2_SET_CRUN_COMMAND, CMD)); \\\n  hive_dma_snd(dma_id, DMA_PACK_CMD_CHANNEL(read ? _DMA_V2_NO_ACK_MOVE_B2A_NO_SYNC_CHK_COMMAND : _DMA_V2_NO_ACK_MOVE_A2B_NO_SYNC_CHK_COMMAND, channel)); \\\n  hive_dma_snd(dma_id, read ? (unsigned int)(addr_b) : (unsigned int)(addr_a)); \\\n  hive_dma_snd(dma_id, read ? (unsigned int)(addr_a) : (unsigned int)(addr_b)); \\\n  hive_dma_snd(dma_id, to_is_var); \\\n  hive_dma_snd(dma_id, from_is_var); \\\n}\n\n#define hive_dma_move_b2a_data(dma_id, channel, to_addr, from_addr, to_is_var, from_is_var) \\\n{ \\\n  hive_dma_move_data(dma_id, true, channel, to_addr, from_addr, to_is_var, from_is_var) \\\n}\n\n#define hive_dma_move_a2b_data(dma_id, channel, from_addr, to_addr, from_is_var, to_is_var) \\\n{ \\\n  hive_dma_move_data(dma_id, false, channel, from_addr, to_addr, from_is_var, to_is_var) \\\n}\n\n#define hive_dma_set_data(dma_id, channel, address, value, is_var) \\\n{ \\\n  hive_dma_snd(dma_id, DMA_PACK(_DMA_V2_SET_CRUN_COMMAND, CMD)); \\\n  hive_dma_snd(dma_id, DMA_PACK_CMD_CHANNEL(_DMA_V2_INIT_A_COMMAND, channel)); \\\n  hive_dma_snd(dma_id, value); \\\n  hive_dma_snd(dma_id, address); \\\n  hive_dma_snd(dma_id, is_var); \\\n}\n\n#define hive_dma_clear_data(dma_id, channel, address, is_var) hive_dma_set_data(dma_id, channel, address, 0, is_var)\n\n#define hive_dma_configure(dma_id, channel, connection, extension, height, \\\n\tstride_A, elems_A, cropping_A, width_A, \\\n\tstride_B, elems_B, cropping_B, width_B) \\\n{ \\\n  hive_dma_snd(dma_id, DMA_PACK_CMD_CHANNEL(_DMA_V2_CONFIG_CHANNEL_COMMAND, channel)); \\\n  hive_dma_snd(dma_id, DMA_PACK_SETUP(connection, extension)); \\\n  hive_dma_snd(dma_id, stride_A); \\\n  hive_dma_snd(dma_id, DMA_PACK_CROP_ELEMS(elems_A, cropping_A)); \\\n  hive_dma_snd(dma_id, width_A); \\\n  hive_dma_snd(dma_id, stride_B); \\\n  hive_dma_snd(dma_id, DMA_PACK_CROP_ELEMS(elems_B, cropping_B)); \\\n  hive_dma_snd(dma_id, width_B); \\\n  hive_dma_snd(dma_id, height); \\\n}\n\n#define hive_dma_execute(dma_id, channel, cmd, to_addr, from_addr_value, to_is_var, from_is_var) \\\n{ \\\n  hive_dma_snd(dma_id, DMA_PACK(_DMA_V2_SET_CRUN_COMMAND, CMD)); \\\n  hive_dma_snd(dma_id, DMA_PACK_CMD_CHANNEL(cmd, channel)); \\\n  hive_dma_snd(dma_id, to_addr); \\\n  hive_dma_snd(dma_id, from_addr_value); \\\n  hive_dma_snd(dma_id, to_is_var); \\\n  if ((cmd & DMA_CLEAR_CMDBIT) == 0) { \\\n\thive_dma_snd(dma_id, from_is_var); \\\n  } \\\n}\n\n#define hive_dma_configure_fast(dma_id, channel, connection, extension, elems_A, elems_B) \\\n{ \\\n  hive_dma_snd(dma_id, DMA_PACK_CMD_CHANNEL(_DMA_V2_CONFIG_CHANNEL_COMMAND, channel)); \\\n  hive_dma_snd(dma_id, DMA_PACK_SETUP(connection, extension)); \\\n  hive_dma_snd(dma_id, 0); \\\n  hive_dma_snd(dma_id, DMA_PACK_CROP_ELEMS(elems_A, 0)); \\\n  hive_dma_snd(dma_id, 0); \\\n  hive_dma_snd(dma_id, 0); \\\n  hive_dma_snd(dma_id, DMA_PACK_CROP_ELEMS(elems_B, 0)); \\\n  hive_dma_snd(dma_id, 0); \\\n  hive_dma_snd(dma_id, 1); \\\n}\n\n#define hive_dma_set_parameter(dma_id, channel, param, value) \\\n{ \\\n  hive_dma_snd(dma_id, _DMA_V2_SET_CHANNEL_PARAM_COMMAND | DMA_PACK_CHANNEL(channel) | DMA_PACK_PARAM(param)); \\\n  hive_dma_snd(dma_id, value); \\\n}\n\n#define\tDMA_SPECIFIC_CMDBIT\t0x01\n#define\tDMA_CHECK_CMDBIT\t0x02\n#define\tDMA_RW_CMDBIT\t\t0x04\n#define\tDMA_CLEAR_CMDBIT\t0x08\n#define\tDMA_ACK_CMDBIT\t\t0x10\n#define\tDMA_CFG_CMDBIT\t\t0x20\n#define\tDMA_PARAM_CMDBIT\t0x01\n\n \n#define\tDMA_NOACK_CMD\t\t(DMA_ACK_CMDBIT | DMA_CHECK_CMDBIT)\n#define\tDMA_CFG_CMD\t\t\t(DMA_CFG_CMDBIT)\n#define\tDMA_CFGPARAM_CMD\t(DMA_CFG_CMDBIT | DMA_PARAM_CMDBIT)\n\n#define DMA_CMD_NEEDS_ACK(cmd) ((cmd & DMA_NOACK_CMD) == 0)\n#define DMA_CMD_IS_TRANSFER(cmd) ((cmd & DMA_CFG_CMDBIT) == 0)\n#define DMA_CMD_IS_WR(cmd) ((cmd & DMA_RW_CMDBIT) != 0)\n#define DMA_CMD_IS_RD(cmd) ((cmd & DMA_RW_CMDBIT) == 0)\n#define DMA_CMD_IS_CLR(cmd) ((cmd & DMA_CLEAR_CMDBIT) != 0)\n#define DMA_CMD_IS_CFG(cmd) ((cmd & DMA_CFG_CMDBIT) != 0)\n#define DMA_CMD_IS_PARAMCFG(cmd) ((cmd & DMA_CFGPARAM_CMD) == DMA_CFGPARAM_CMD)\n\n \n#define DMA_TRANSFER_READ\t\tDMA_TRANSFER_B2A\n#define DMA_TRANSFER_WRITE\t\tDMA_TRANSFER_A2B\n \n#define DMA_TRANSFER_STORE\t\tDMA_TRANSFER_B2A\n#define DMA_TRANSFER_LOAD\t\tDMA_TRANSFER_A2B\n#define DMA_TRANSFER_CLEAR\t\tDMA_TRANSFER_CLEAR_A\n\ntypedef enum {\n\tDMA_TRANSFER_CLEAR_A = DMA_CLEAR_CMDBIT,                                        \n\tDMA_TRANSFER_CLEAR_B = DMA_CLEAR_CMDBIT | DMA_RW_CMDBIT,                        \n\tDMA_TRANSFER_A2B = DMA_RW_CMDBIT,                                               \n\tDMA_TRANSFER_B2A = 0,                                                           \n\tDMA_TRANSFER_CLEAR_A_NOACK = DMA_CLEAR_CMDBIT | DMA_NOACK_CMD,                  \n\tDMA_TRANSFER_CLEAR_B_NOACK = DMA_CLEAR_CMDBIT | DMA_RW_CMDBIT | DMA_NOACK_CMD,  \n\tDMA_TRANSFER_A2B_NOACK = DMA_RW_CMDBIT | DMA_NOACK_CMD,                         \n\tDMA_TRANSFER_B2A_NOACK = DMA_NOACK_CMD,                                         \n\tDMA_FASTTRANSFER_CLEAR_A = DMA_CLEAR_CMDBIT | DMA_SPECIFIC_CMDBIT,\n\tDMA_FASTTRANSFER_CLEAR_B = DMA_CLEAR_CMDBIT | DMA_RW_CMDBIT | DMA_SPECIFIC_CMDBIT,\n\tDMA_FASTTRANSFER_A2B = DMA_RW_CMDBIT | DMA_SPECIFIC_CMDBIT,\n\tDMA_FASTTRANSFER_B2A = DMA_SPECIFIC_CMDBIT,\n\tDMA_FASTTRANSFER_CLEAR_A_NOACK = DMA_CLEAR_CMDBIT | DMA_NOACK_CMD | DMA_SPECIFIC_CMDBIT,\n\tDMA_FASTTRANSFER_CLEAR_B_NOACK = DMA_CLEAR_CMDBIT | DMA_RW_CMDBIT | DMA_NOACK_CMD | DMA_SPECIFIC_CMDBIT,\n\tDMA_FASTTRANSFER_A2B_NOACK = DMA_RW_CMDBIT | DMA_NOACK_CMD | DMA_SPECIFIC_CMDBIT,\n\tDMA_FASTTRANSFER_B2A_NOACK = DMA_NOACK_CMD | DMA_SPECIFIC_CMDBIT,\n} dma_transfer_type_t;\n\ntypedef enum {\n\tDMA_CONFIG_SETUP = _DMA_V2_PACKING_SETUP_PARAM,\n\tDMA_CONFIG_HEIGHT = _DMA_V2_HEIGHT_PARAM,\n\tDMA_CONFIG_STRIDE_A_ = _DMA_V2_STRIDE_A_PARAM,\n\tDMA_CONFIG_CROP_ELEM_A = _DMA_V2_ELEM_CROPPING_A_PARAM,\n\tDMA_CONFIG_WIDTH_A = _DMA_V2_WIDTH_A_PARAM,\n\tDMA_CONFIG_STRIDE_B_ = _DMA_V2_STRIDE_B_PARAM,\n\tDMA_CONFIG_CROP_ELEM_B = _DMA_V2_ELEM_CROPPING_B_PARAM,\n\tDMA_CONFIG_WIDTH_B = _DMA_V2_WIDTH_B_PARAM,\n} dma_config_type_t;\n\nstruct dma_port_config {\n\tu8  crop, elems;\n\tu16 width;\n\tu32 stride;\n};\n\n \nstruct dma_channel_config {\n\tu8  connection;\n\tu8  extension;\n\tu8  height;\n\tstruct dma_port_config a, b;\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}