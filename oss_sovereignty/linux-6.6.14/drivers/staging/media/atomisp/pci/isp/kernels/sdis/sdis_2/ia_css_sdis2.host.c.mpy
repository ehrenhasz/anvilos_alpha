{
  "module_name": "ia_css_sdis2.host.c",
  "hash_id": "163a5df1300f39fccada572d200b3c4d5c630b7744523be9007b7ba86a83fe02",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/isp/kernels/sdis/sdis_2/ia_css_sdis2.host.c",
  "human_readable_source": "\n \n\n#include \"hmm.h\"\n\n#include <assert_support.h>\n#include \"ia_css_debug.h\"\n#include \"ia_css_sdis2.host.h\"\n\nconst struct ia_css_dvs2_coefficients default_sdis2_config = {\n\t.grid = { 0, 0, 0, 0, 0, 0, 0, 0 },\n\t.hor_coefs = { NULL, NULL, NULL, NULL },\n\t.ver_coefs = { NULL, NULL, NULL, NULL },\n};\n\nstatic void\nfill_row(short *private, const short *public, unsigned int width,\n\t unsigned int padding)\n{\n\tmemcpy(private, public, width * sizeof(short));\n\tmemset(&private[width], 0, padding * sizeof(short));\n}\n\nvoid ia_css_sdis2_horicoef_vmem_encode(\n    struct sh_css_isp_sdis_hori_coef_tbl *to,\n    const struct ia_css_dvs2_coefficients *from,\n    unsigned int size)\n{\n\tunsigned int aligned_width = from->grid.aligned_width *\n\t\t\t\t     from->grid.bqs_per_grid_cell;\n\tunsigned int width         = from->grid.num_hor_coefs;\n\tint      padding       = aligned_width - width;\n\tunsigned int stride        = size / IA_CSS_DVS2_NUM_COEF_TYPES / sizeof(short);\n\tunsigned int total_bytes   = aligned_width * IA_CSS_DVS2_NUM_COEF_TYPES *\n\t\t\t\t     sizeof(short);\n\tshort   *private       = (short *)to;\n\n\t \n\tassert(padding >= 0);\n\tassert(total_bytes <= size);\n\tassert(size % (IA_CSS_DVS2_NUM_COEF_TYPES * ISP_VEC_NELEMS * sizeof(\n\t\t\t   short)) == 0);\n\tfill_row(&private[0 * stride], from->hor_coefs.odd_real,  width, padding);\n\tfill_row(&private[1 * stride], from->hor_coefs.odd_imag,  width, padding);\n\tfill_row(&private[2 * stride], from->hor_coefs.even_real, width, padding);\n\tfill_row(&private[3 * stride], from->hor_coefs.even_imag, width, padding);\n}\n\nvoid ia_css_sdis2_vertcoef_vmem_encode(\n    struct sh_css_isp_sdis_vert_coef_tbl *to,\n    const struct ia_css_dvs2_coefficients *from,\n    unsigned int size)\n{\n\tunsigned int aligned_height = from->grid.aligned_height *\n\t\t\t\t      from->grid.bqs_per_grid_cell;\n\tunsigned int height         = from->grid.num_ver_coefs;\n\tint      padding        = aligned_height - height;\n\tunsigned int stride         = size / IA_CSS_DVS2_NUM_COEF_TYPES / sizeof(short);\n\tunsigned int total_bytes    = aligned_height * IA_CSS_DVS2_NUM_COEF_TYPES *\n\t\t\t\t      sizeof(short);\n\tshort   *private        = (short *)to;\n\n\t \n\tassert(padding >= 0);\n\tassert(total_bytes <= size);\n\tassert(size % (IA_CSS_DVS2_NUM_COEF_TYPES * ISP_VEC_NELEMS * sizeof(\n\t\t\t   short)) == 0);\n\tfill_row(&private[0 * stride], from->ver_coefs.odd_real,  height, padding);\n\tfill_row(&private[1 * stride], from->ver_coefs.odd_imag,  height, padding);\n\tfill_row(&private[2 * stride], from->ver_coefs.even_real, height, padding);\n\tfill_row(&private[3 * stride], from->ver_coefs.even_imag, height, padding);\n}\n\nvoid ia_css_sdis2_horiproj_encode(\n    struct sh_css_isp_sdis_hori_proj_tbl *to,\n    const struct ia_css_dvs2_coefficients *from,\n    unsigned int size)\n{\n\t(void)to;\n\t(void)from;\n\t(void)size;\n}\n\nvoid ia_css_sdis2_vertproj_encode(\n    struct sh_css_isp_sdis_vert_proj_tbl *to,\n    const struct ia_css_dvs2_coefficients *from,\n    unsigned int size)\n{\n\t(void)to;\n\t(void)from;\n\t(void)size;\n}\n\nvoid ia_css_get_isp_dvs2_coefficients(\n    struct ia_css_stream *stream,\n    short *hor_coefs_odd_real,\n    short *hor_coefs_odd_imag,\n    short *hor_coefs_even_real,\n    short *hor_coefs_even_imag,\n    short *ver_coefs_odd_real,\n    short *ver_coefs_odd_imag,\n    short *ver_coefs_even_real,\n    short *ver_coefs_even_imag)\n{\n\tstruct ia_css_isp_parameters *params;\n\tunsigned int hor_num_3a, ver_num_3a;\n\tstruct ia_css_binary *dvs_binary;\n\n\tIA_CSS_ENTER(\"void\");\n\n\tassert(stream);\n\tassert(hor_coefs_odd_real);\n\tassert(hor_coefs_odd_imag);\n\tassert(hor_coefs_even_real);\n\tassert(hor_coefs_even_imag);\n\tassert(ver_coefs_odd_real);\n\tassert(ver_coefs_odd_imag);\n\tassert(ver_coefs_even_real);\n\tassert(ver_coefs_even_imag);\n\n\tparams = stream->isp_params_configs;\n\n\t \n\tdvs_binary = ia_css_stream_get_dvs_binary(stream);\n\tif (!dvs_binary)\n\t\treturn;\n\n\thor_num_3a  = dvs_binary->dis.coef.dim.width;\n\tver_num_3a  = dvs_binary->dis.coef.dim.height;\n\n\tmemcpy(hor_coefs_odd_real,  params->dvs2_coefs.hor_coefs.odd_real,\n\t       hor_num_3a * sizeof(short));\n\tmemcpy(hor_coefs_odd_imag,  params->dvs2_coefs.hor_coefs.odd_imag,\n\t       hor_num_3a * sizeof(short));\n\tmemcpy(hor_coefs_even_real, params->dvs2_coefs.hor_coefs.even_real,\n\t       hor_num_3a * sizeof(short));\n\tmemcpy(hor_coefs_even_imag, params->dvs2_coefs.hor_coefs.even_imag,\n\t       hor_num_3a * sizeof(short));\n\tmemcpy(ver_coefs_odd_real,  params->dvs2_coefs.ver_coefs.odd_real,\n\t       ver_num_3a * sizeof(short));\n\tmemcpy(ver_coefs_odd_imag,  params->dvs2_coefs.ver_coefs.odd_imag,\n\t       ver_num_3a * sizeof(short));\n\tmemcpy(ver_coefs_even_real, params->dvs2_coefs.ver_coefs.even_real,\n\t       ver_num_3a * sizeof(short));\n\tmemcpy(ver_coefs_even_imag, params->dvs2_coefs.ver_coefs.even_imag,\n\t       ver_num_3a * sizeof(short));\n\n\tIA_CSS_LEAVE(\"void\");\n}\n\nvoid ia_css_sdis2_clear_coefficients(\n    struct ia_css_dvs2_coefficients *dvs2_coefs)\n{\n\tdvs2_coefs->hor_coefs.odd_real  = NULL;\n\tdvs2_coefs->hor_coefs.odd_imag  = NULL;\n\tdvs2_coefs->hor_coefs.even_real = NULL;\n\tdvs2_coefs->hor_coefs.even_imag = NULL;\n\tdvs2_coefs->ver_coefs.odd_real  = NULL;\n\tdvs2_coefs->ver_coefs.odd_imag  = NULL;\n\tdvs2_coefs->ver_coefs.even_real = NULL;\n\tdvs2_coefs->ver_coefs.even_imag = NULL;\n}\n\nint\nia_css_get_dvs2_statistics(\n    struct ia_css_dvs2_statistics          *host_stats,\n    const struct ia_css_isp_dvs_statistics *isp_stats) {\n\tstruct ia_css_isp_dvs_statistics_map *map;\n\tint ret = 0;\n\n\tIA_CSS_ENTER(\"host_stats=%p, isp_stats=%p\", host_stats, isp_stats);\n\n\tassert(host_stats);\n\tassert(isp_stats);\n\n\tmap = ia_css_isp_dvs_statistics_map_allocate(isp_stats, NULL);\n\tif (map)\n\t{\n\t\thmm_load(isp_stats->data_ptr, map->data_ptr, isp_stats->size);\n\t\tia_css_translate_dvs2_statistics(host_stats, map);\n\t\tia_css_isp_dvs_statistics_map_free(map);\n\t} else\n\t{\n\t\tIA_CSS_ERROR(\"out of memory\");\n\t\tret = -ENOMEM;\n\t}\n\n\tIA_CSS_LEAVE_ERR(ret);\n\treturn ret;\n}\n\nvoid\nia_css_translate_dvs2_statistics(\n    struct ia_css_dvs2_statistics\t\t   *host_stats,\n    const struct ia_css_isp_dvs_statistics_map *isp_stats)\n{\n\tunsigned int size_bytes, table_width, table_size, height;\n\tunsigned int src_offset = 0, dst_offset = 0;\n\ts32 *htemp_ptr, *vtemp_ptr;\n\n\tassert(host_stats);\n\tassert(host_stats->hor_prod.odd_real);\n\tassert(host_stats->hor_prod.odd_imag);\n\tassert(host_stats->hor_prod.even_real);\n\tassert(host_stats->hor_prod.even_imag);\n\tassert(host_stats->ver_prod.odd_real);\n\tassert(host_stats->ver_prod.odd_imag);\n\tassert(host_stats->ver_prod.even_real);\n\tassert(host_stats->ver_prod.even_imag);\n\tassert(isp_stats);\n\tassert(isp_stats->hor_proj);\n\tassert(isp_stats->ver_proj);\n\n\tIA_CSS_ENTER(\"hor_coefs.odd_real=%p, hor_coefs.odd_imag=%p, hor_coefs.even_real=%p, hor_coefs.even_imag=%p, ver_coefs.odd_real=%p, ver_coefs.odd_imag=%p, ver_coefs.even_real=%p, ver_coefs.even_imag=%p, haddr=%p, vaddr=%p\",\n\t\t     host_stats->hor_prod.odd_real, host_stats->hor_prod.odd_imag,\n\t\t     host_stats->hor_prod.even_real, host_stats->hor_prod.even_imag,\n\t\t     host_stats->ver_prod.odd_real, host_stats->ver_prod.odd_imag,\n\t\t     host_stats->ver_prod.even_real, host_stats->ver_prod.even_imag,\n\t\t     isp_stats->hor_proj, isp_stats->ver_proj);\n\n\t \n\tsize_bytes = host_stats->grid.aligned_width * sizeof(*htemp_ptr);\n\n\t \n\t \n\ttable_width = CEIL_MUL(size_bytes,\n\t\t\t       HIVE_ISP_DDR_WORD_BYTES) / sizeof(*htemp_ptr);\n\ttable_size = table_width * host_stats->grid.aligned_height;\n\n\thtemp_ptr = isp_stats->hor_proj;  \n\tvtemp_ptr = isp_stats->ver_proj;  \n\tfor (height = 0; height < host_stats->grid.aligned_height; height++) {\n\t\t \n\t\tmemcpy(host_stats->hor_prod.odd_real + dst_offset,\n\t\t       &htemp_ptr[0 * table_size + src_offset], size_bytes);\n\t\tmemcpy(host_stats->hor_prod.odd_imag + dst_offset,\n\t\t       &htemp_ptr[1 * table_size + src_offset], size_bytes);\n\t\tmemcpy(host_stats->hor_prod.even_real + dst_offset,\n\t\t       &htemp_ptr[2 * table_size + src_offset], size_bytes);\n\t\tmemcpy(host_stats->hor_prod.even_imag + dst_offset,\n\t\t       &htemp_ptr[3 * table_size + src_offset], size_bytes);\n\n\t\t \n\t\tmemcpy(host_stats->ver_prod.odd_real + dst_offset,\n\t\t       &vtemp_ptr[0 * table_size + src_offset], size_bytes);\n\t\tmemcpy(host_stats->ver_prod.odd_imag + dst_offset,\n\t\t       &vtemp_ptr[1 * table_size + src_offset], size_bytes);\n\t\tmemcpy(host_stats->ver_prod.even_real + dst_offset,\n\t\t       &vtemp_ptr[2 * table_size + src_offset], size_bytes);\n\t\tmemcpy(host_stats->ver_prod.even_imag + dst_offset,\n\t\t       &vtemp_ptr[3 * table_size + src_offset], size_bytes);\n\n\t\tsrc_offset += table_width;  \n\t\tdst_offset += host_stats->grid.aligned_width;\n\t}\n\n\tIA_CSS_LEAVE(\"void\");\n}\n\nstruct ia_css_isp_dvs_statistics *\nia_css_isp_dvs2_statistics_allocate(\n    const struct ia_css_dvs_grid_info *grid)\n{\n\tstruct ia_css_isp_dvs_statistics *me;\n\tint size;\n\n\tassert(grid);\n\n\tIA_CSS_ENTER(\"grid=%p\", grid);\n\n\tif (!grid->enable)\n\t\treturn NULL;\n\n\tme = kvcalloc(1, sizeof(*me), GFP_KERNEL);\n\tif (!me)\n\t\tgoto err;\n\n\t \n\tsize = CEIL_MUL(sizeof(int) * grid->aligned_width, HIVE_ISP_DDR_WORD_BYTES)\n\t       * grid->aligned_height * IA_CSS_DVS2_NUM_COEF_TYPES;\n\n\tme->size = 2 * size;\n\tme->data_ptr = hmm_alloc(me->size);\n\tif (me->data_ptr == mmgr_NULL)\n\t\tgoto err;\n\tme->hor_proj = me->data_ptr;\n\tme->hor_size = size;\n\tme->ver_proj = me->data_ptr + size;\n\tme->ver_size = size;\n\n\tIA_CSS_LEAVE(\"return=%p\", me);\n\treturn me;\nerr:\n\tia_css_isp_dvs2_statistics_free(me);\n\tIA_CSS_LEAVE(\"return=%p\", NULL);\n\n\treturn NULL;\n}\n\nvoid\nia_css_isp_dvs2_statistics_free(struct ia_css_isp_dvs_statistics *me)\n{\n\tif (me) {\n\t\thmm_free(me->data_ptr);\n\t\tkvfree(me);\n\t}\n}\n\nvoid ia_css_sdis2_horicoef_debug_dtrace(\n    const struct ia_css_dvs2_coefficients *config, unsigned int level)\n{\n\t(void)config;\n\t(void)level;\n}\n\nvoid ia_css_sdis2_vertcoef_debug_dtrace(\n    const struct ia_css_dvs2_coefficients *config, unsigned int level)\n{\n\t(void)config;\n\t(void)level;\n}\n\nvoid ia_css_sdis2_horiproj_debug_dtrace(\n    const struct ia_css_dvs2_coefficients *config, unsigned int level)\n{\n\t(void)config;\n\t(void)level;\n}\n\nvoid ia_css_sdis2_vertproj_debug_dtrace(\n    const struct ia_css_dvs2_coefficients *config, unsigned int level)\n{\n\t(void)config;\n\t(void)level;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}