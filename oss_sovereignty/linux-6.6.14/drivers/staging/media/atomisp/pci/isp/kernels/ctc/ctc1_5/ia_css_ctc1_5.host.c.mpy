{
  "module_name": "ia_css_ctc1_5.host.c",
  "hash_id": "6f5d00747fb0a464602b5603356a643ad1ce9e090db646f135237c0d92d7d8b4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/isp/kernels/ctc/ctc1_5/ia_css_ctc1_5.host.c",
  "human_readable_source": "\n \n\n#include \"ia_css_types.h\"\n#include \"sh_css_defs.h\"\n#include \"ia_css_debug.h\"\n#include \"assert_support.h\"\n\n#include \"ctc/ctc_1.0/ia_css_ctc.host.h\"\n#include \"ia_css_ctc1_5.host.h\"\n\nstatic void ctc_gradient(\n    int *dydx, int *shift,\n    int y1, int y0, int x1, int x0)\n{\n\tint frc_bits = max(IA_CSS_CTC_COEF_SHIFT, 16);\n\tint dy = y1 - y0;\n\tint dx = x1 - x0;\n\tint dydx_int;\n\tint dydx_frc;\n\tint sft;\n\t \n\tint max_dydx = (1 << IA_CSS_CTC_COEF_SHIFT) - 1;\n\n\tif (dx == 0) {\n\t\tia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE,\n\t\t\t\t    \"ctc_gradient() error, illegal division operation\\n\");\n\t\treturn;\n\t} else {\n\t\tdydx_int = dy / dx;\n\t\tdydx_frc = ((dy - dydx_int * dx) << frc_bits) / dx;\n\t}\n\n\tassert(y0 >= 0 && y0 <= max_dydx);\n\tassert(y1 >= 0 && y1 <= max_dydx);\n\tassert(x0 < x1);\n\tassert(dydx);\n\tassert(shift);\n\n\tia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, \"ctc_gradient() enter:\\n\");\n\n\t \n\tfor (sft = 0; sft <= IA_CSS_CTC_COEF_SHIFT; sft++) {\n\t\tint tmp_dydx = (dydx_int << sft)\n\t\t\t       + (dydx_frc >> (frc_bits - sft));\n\t\tif (tmp_dydx <= max_dydx) {\n\t\t\t*dydx = tmp_dydx;\n\t\t\t*shift = sft;\n\t\t}\n\t\tif (tmp_dydx >= max_dydx)\n\t\t\tbreak;\n\t}\n\n\tia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, \"ctc_gradient() leave:\\n\");\n}\n\nvoid\nia_css_ctc_encode(\n    struct sh_css_isp_ctc_params *to,\n    const struct ia_css_ctc_config *from,\n    unsigned int size)\n{\n\t(void)size;\n\tto->y0 = from->y0;\n\tto->y1 = from->y1;\n\tto->y2 = from->y2;\n\tto->y3 = from->y3;\n\tto->y4 = from->y4;\n\tto->y5 = from->y5;\n\n\tto->ce_gain_exp = from->ce_gain_exp;\n\n\tto->x1 = from->x1;\n\tto->x2 = from->x2;\n\tto->x3 = from->x3;\n\tto->x4 = from->x4;\n\n\tctc_gradient(&to->dydx0,\n\t\t     &to->dydx0_shift,\n\t\t     from->y1, from->y0,\n\t\t     from->x1, 0);\n\n\tctc_gradient(&to->dydx1,\n\t\t     &to->dydx1_shift,\n\t\t     from->y2, from->y1,\n\t\t     from->x2, from->x1);\n\n\tctc_gradient(&to->dydx2,\n\t\t     &to->dydx2_shift,\n\t\t     from->y3, from->y2,\n\t\t     from->x3, from->x2);\n\n\tctc_gradient(&to->dydx3,\n\t\t     &to->dydx3_shift,\n\t\t     from->y4, from->y3,\n\t\t     from->x4, from->x3);\n\n\tctc_gradient(&to->dydx4,\n\t\t     &to->dydx4_shift,\n\t\t     from->y5, from->y4,\n\t\t     SH_CSS_BAYER_MAXVAL, from->x4);\n}\n\nvoid\nia_css_ctc_dump(\n    const struct sh_css_isp_ctc_params *ctc,\n    unsigned int level);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}