{
  "module_name": "ia_css_tnr.host.c",
  "hash_id": "0a4f0d0d47b1ef533271aed73d5b404678482a67c25d623ffb29b9c26b0ab916",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/isp/kernels/tnr/tnr_1.0/ia_css_tnr.host.c",
  "human_readable_source": "\n \n\n#include \"ia_css_types.h\"\n#include \"ia_css_frame.h\"\n#include \"sh_css_defs.h\"\n#include \"ia_css_debug.h\"\n#include \"sh_css_frac.h\"\n#include \"assert_support.h\"\n#define IA_CSS_INCLUDE_CONFIGURATIONS\n#include \"ia_css_isp_configs.h\"\n#include \"isp.h\"\n\n#include \"ia_css_tnr.host.h\"\nconst struct ia_css_tnr_config default_tnr_config = {\n\t32768,\n\t32,\n\t32,\n};\n\nvoid\nia_css_tnr_encode(\n    struct sh_css_isp_tnr_params *to,\n    const struct ia_css_tnr_config *from,\n    unsigned int size)\n{\n\t(void)size;\n\tto->coef =\n\t    uDIGIT_FITTING(from->gain, 16, SH_CSS_TNR_COEF_SHIFT);\n\tto->threshold_Y =\n\t    uDIGIT_FITTING(from->threshold_y, 16, SH_CSS_ISP_YUV_BITS);\n\tto->threshold_C =\n\t    uDIGIT_FITTING(from->threshold_uv, 16, SH_CSS_ISP_YUV_BITS);\n}\n\nvoid\nia_css_tnr_dump(\n    const struct sh_css_isp_tnr_params *tnr,\n    unsigned int level)\n{\n\tif (!tnr) return;\n\tia_css_debug_dtrace(level, \"Temporal Noise Reduction:\\n\");\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"tnr_coef\", tnr->coef);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"tnr_threshold_Y\", tnr->threshold_Y);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"tnr_threshold_C\", tnr->threshold_C);\n}\n\nvoid\nia_css_tnr_debug_dtrace(\n    const struct ia_css_tnr_config *config,\n    unsigned int level)\n{\n\tia_css_debug_dtrace(level,\n\t\t\t    \"config.gain=%d, config.threshold_y=%d, config.threshold_uv=%d\\n\",\n\t\t\t    config->gain,\n\t\t\t    config->threshold_y, config->threshold_uv);\n}\n\nint ia_css_tnr_config(struct sh_css_isp_tnr_isp_config *to,\n\t\t      const struct ia_css_tnr_configuration *from,\n\t\t      unsigned int size)\n{\n\tunsigned int elems_a = ISP_VEC_NELEMS;\n\tunsigned int i;\n\tint ret;\n\n\tret = ia_css_dma_configure_from_info(&to->port_b, &from->tnr_frames[0]->frame_info);\n\tif (ret)\n\t\treturn ret;\n\tto->width_a_over_b = elems_a / to->port_b.elems;\n\tto->frame_height = from->tnr_frames[0]->frame_info.res.height;\n\tfor (i = 0; i < NUM_VIDEO_TNR_FRAMES; i++) {\n\t\tto->tnr_frame_addr[i] = from->tnr_frames[i]->data +\n\t\t\t\t\tfrom->tnr_frames[i]->planes.yuyv.offset;\n\t}\n\n\t \n\tif (elems_a % to->port_b.elems != 0)\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nint ia_css_tnr_configure(const struct ia_css_binary     *binary,\n\t\t\t const struct ia_css_frame * const *frames)\n{\n\tstruct ia_css_tnr_configuration config;\n\tunsigned int i;\n\n\tfor (i = 0; i < NUM_VIDEO_TNR_FRAMES; i++)\n\t\tconfig.tnr_frames[i] = frames[i];\n\n\treturn ia_css_configure_tnr(binary, &config);\n}\n\nvoid\nia_css_init_tnr_state(\n    struct sh_css_isp_tnr_dmem_state *state,\n    size_t size)\n{\n\t(void)size;\n\n\tassert(NUM_VIDEO_TNR_FRAMES >= 2);\n\tassert(sizeof(*state) == size);\n\tstate->tnr_in_buf_idx = 0;\n\tstate->tnr_out_buf_idx = 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}