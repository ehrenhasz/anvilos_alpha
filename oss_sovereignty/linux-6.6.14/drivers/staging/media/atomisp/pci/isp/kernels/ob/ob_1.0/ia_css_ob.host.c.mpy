{
  "module_name": "ia_css_ob.host.c",
  "hash_id": "8820886fd9bc1693360db3d57a50e7b4a15b48c63fc750211a335cb63658ce8e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/isp/kernels/ob/ob_1.0/ia_css_ob.host.c",
  "human_readable_source": "\n \n\n#include \"ia_css_types.h\"\n#include \"sh_css_defs.h\"\n#include \"ia_css_debug.h\"\n#include \"isp.h\"\n\n#include \"ia_css_ob.host.h\"\n\nconst struct ia_css_ob_config default_ob_config = {\n\tIA_CSS_OB_MODE_NONE,\n\t0,\n\t0,\n\t0,\n\t0,\n\t0,\n\t0\n};\n\n \n\nvoid\nia_css_ob_configure(\n    struct sh_css_isp_ob_stream_config *config,\n    unsigned int isp_pipe_version,\n    unsigned int raw_bit_depth)\n{\n\tconfig->isp_pipe_version = isp_pipe_version;\n\tconfig->raw_bit_depth    = raw_bit_depth;\n}\n\nvoid\nia_css_ob_encode(\n    struct sh_css_isp_ob_params *to,\n    const struct ia_css_ob_config *from,\n    const struct sh_css_isp_ob_stream_config *config,\n    unsigned int size)\n{\n\tunsigned int ob_bit_depth\n\t    = config->isp_pipe_version == 2 ? SH_CSS_BAYER_BITS : config->raw_bit_depth;\n\tunsigned int scale = 16 - ob_bit_depth;\n\n\t(void)size;\n\tswitch (from->mode) {\n\tcase IA_CSS_OB_MODE_FIXED:\n\t\tto->blacklevel_gr = from->level_gr >> scale;\n\t\tto->blacklevel_r  = from->level_r  >> scale;\n\t\tto->blacklevel_b  = from->level_b  >> scale;\n\t\tto->blacklevel_gb = from->level_gb >> scale;\n\t\tto->area_start_bq = 0;\n\t\tto->area_length_bq = 0;\n\t\tto->area_length_bq_inverse = 0;\n\t\tbreak;\n\tcase IA_CSS_OB_MODE_RASTER:\n\t\tto->blacklevel_gr = 0;\n\t\tto->blacklevel_r = 0;\n\t\tto->blacklevel_b = 0;\n\t\tto->blacklevel_gb = 0;\n\t\tto->area_start_bq = from->start_position;\n\t\tto->area_length_bq =\n\t\t    (from->end_position - from->start_position) + 1;\n\t\tto->area_length_bq_inverse = AREA_LENGTH_UNIT / to->area_length_bq;\n\t\tbreak;\n\tdefault:\n\t\tto->blacklevel_gr = 0;\n\t\tto->blacklevel_r = 0;\n\t\tto->blacklevel_b = 0;\n\t\tto->blacklevel_gb = 0;\n\t\tto->area_start_bq = 0;\n\t\tto->area_length_bq = 0;\n\t\tto->area_length_bq_inverse = 0;\n\t\tbreak;\n\t}\n}\n\nvoid\nia_css_ob_vmem_encode(\n    struct sh_css_isp_ob_vmem_params *to,\n    const struct ia_css_ob_config *from,\n    const struct sh_css_isp_ob_stream_config *config,\n    unsigned int size)\n{\n\tstruct sh_css_isp_ob_params tmp;\n\tstruct sh_css_isp_ob_params *ob = &tmp;\n\n\t(void)size;\n\tia_css_ob_encode(&tmp, from, config, sizeof(tmp));\n\n\t{\n\t\tunsigned int i;\n\t\tunsigned int sp_obarea_start_bq  = ob->area_start_bq;\n\t\tunsigned int sp_obarea_length_bq = ob->area_length_bq;\n\t\tunsigned int low = sp_obarea_start_bq;\n\t\tunsigned int high = low + sp_obarea_length_bq;\n\t\tu16 all_ones = ~0;\n\n\t\tfor (i = 0; i < OBAREA_MASK_SIZE; i++) {\n\t\t\tif (i >= low && i < high)\n\t\t\t\tto->vmask[i / ISP_VEC_NELEMS][i % ISP_VEC_NELEMS] = all_ones;\n\t\t\telse\n\t\t\t\tto->vmask[i / ISP_VEC_NELEMS][i % ISP_VEC_NELEMS] = 0;\n\t\t}\n\t}\n}\n\nvoid\nia_css_ob_dump(\n    const struct sh_css_isp_ob_params *ob,\n    unsigned int level)\n{\n\tif (!ob) return;\n\tia_css_debug_dtrace(level, \"Optical Black:\\n\");\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"ob_blacklevel_gr\", ob->blacklevel_gr);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"ob_blacklevel_r\", ob->blacklevel_r);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"ob_blacklevel_b\", ob->blacklevel_b);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"ob_blacklevel_gb\", ob->blacklevel_gb);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"obarea_start_bq\", ob->area_start_bq);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"obarea_length_bq\", ob->area_length_bq);\n\tia_css_debug_dtrace(level, \"\\t%-32s = %d\\n\",\n\t\t\t    \"obarea_length_bq_inverse\",\n\t\t\t    ob->area_length_bq_inverse);\n}\n\nvoid\nia_css_ob_debug_dtrace(\n    const struct ia_css_ob_config *config,\n    unsigned int level)\n{\n\tia_css_debug_dtrace(level,\n\t\t\t    \"config.mode=%d, config.level_gr=%d, config.level_r=%d, config.level_b=%d,  config.level_gb=%d, config.start_position=%d, config.end_position=%d\\n\",\n\t\t\t    config->mode,\n\t\t\t    config->level_gr, config->level_r,\n\t\t\t    config->level_b, config->level_gb,\n\t\t\t    config->start_position, config->end_position);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}