{
  "module_name": "sh_css_hrt.c",
  "hash_id": "5553f9c29121282bab9d4d6db60b1c0a834c5e019b4764ded187c26a10fdc158",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/sh_css_hrt.c",
  "human_readable_source": "\n \n\n#include \"platform_support.h\"\n\n#include \"sh_css_hrt.h\"\n#include \"ia_css_debug.h\"\n\n#include \"device_access.h\"\n\n#define __INLINE_EVENT__\n#include \"event_fifo.h\"\n#define __INLINE_SP__\n#include \"sp.h\"\n#define __INLINE_ISP__\n#include \"isp.h\"\n#define __INLINE_IRQ__\n#include \"irq.h\"\n#define __INLINE_FIFO_MONITOR__\n#include \"fifo_monitor.h\"\n\n \n#include \"sh_css_internal.h\"\n\nbool sh_css_hrt_system_is_idle(void)\n{\n\tbool not_idle = false, idle;\n\tfifo_channel_t ch;\n\n\tidle = sp_ctrl_getbit(SP0_ID, SP_SC_REG, SP_IDLE_BIT);\n\tnot_idle |= !idle;\n\tif (!idle)\n\t\tIA_CSS_WARNING(\"SP not idle\");\n\n\tidle = isp_ctrl_getbit(ISP0_ID, ISP_SC_REG, ISP_IDLE_BIT);\n\tnot_idle |= !idle;\n\tif (!idle)\n\t\tIA_CSS_WARNING(\"ISP not idle\");\n\n\tfor (ch = 0; ch < N_FIFO_CHANNEL; ch++) {\n\t\tfifo_channel_state_t state;\n\n\t\tfifo_channel_get_state(FIFO_MONITOR0_ID, ch, &state);\n\t\tif (state.fifo_valid) {\n\t\t\tIA_CSS_WARNING(\"FIFO channel %d is not empty\", ch);\n\t\t\tnot_idle = true;\n\t\t}\n\t}\n\n\treturn !not_idle;\n}\n\nint sh_css_hrt_sp_wait(void)\n{\n\tirq_sw_channel_id_t\tirq_id = IRQ_SW_CHANNEL0_ID;\n\t \n\twhile (!sp_ctrl_getbit(SP0_ID, SP_SC_REG, SP_IDLE_BIT) &&\n\t       ((irq_reg_load(IRQ0_ID,\n\t\t\t      _HRT_IRQ_CONTROLLER_STATUS_REG_IDX) &\n\t\t (1U << (irq_id + IRQ_SW_CHANNEL_OFFSET))) == 0)) {\n\t\tudelay(1);\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}