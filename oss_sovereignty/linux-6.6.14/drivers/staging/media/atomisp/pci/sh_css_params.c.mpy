{
  "module_name": "sh_css_params.c",
  "hash_id": "57ee37139ab21ba70451acf07a4a7f64be525771cc3fab6483064604f1280f33",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/sh_css_params.c",
  "human_readable_source": "\n \n\n#include \"gdc_device.h\"\t\t \n#include \"isp.h\"\t\t\t \n#include \"vamem.h\"\n#ifndef __INLINE_HMEM__\n#define __INLINE_HMEM__\n#endif\n#include \"hmem.h\"\n#define IA_CSS_INCLUDE_PARAMETERS\n#define IA_CSS_INCLUDE_ACC_PARAMETERS\n\n#include \"hmm.h\"\n#include \"sh_css_params.h\"\n#include \"ia_css_queue.h\"\n#include \"sw_event_global.h\"\t\t \n\n#include \"platform_support.h\"\n#include \"assert_support.h\"\n#include \"misc_support.h\"\t \n#include \"math_support.h\"\t \n\n#include \"ia_css_stream.h\"\n#include \"sh_css_params_internal.h\"\n#include \"sh_css_param_shading.h\"\n#include \"sh_css_param_dvs.h\"\n#include \"ia_css_refcount.h\"\n#include \"sh_css_internal.h\"\n#include \"ia_css_control.h\"\n#include \"ia_css_shading.h\"\n#include \"sh_css_defs.h\"\n#include \"sh_css_sp.h\"\n#include \"ia_css_pipeline.h\"\n#include \"ia_css_debug.h\"\n\n#include \"ia_css_isp_param.h\"\n#include \"ia_css_isp_params.h\"\n#include \"ia_css_mipi.h\"\n#include \"ia_css_morph.h\"\n#include \"ia_css_host_data.h\"\n#include \"ia_css_pipe.h\"\n#include \"ia_css_pipe_binarydesc.h\"\n\n \n\n#include \"anr/anr_1.0/ia_css_anr.host.h\"\n#include \"cnr/cnr_1.0/ia_css_cnr.host.h\"\n#include \"csc/csc_1.0/ia_css_csc.host.h\"\n#include \"de/de_1.0/ia_css_de.host.h\"\n#include \"dp/dp_1.0/ia_css_dp.host.h\"\n#include \"bnr/bnr_1.0/ia_css_bnr.host.h\"\n#include \"dvs/dvs_1.0/ia_css_dvs.host.h\"\n#include \"fpn/fpn_1.0/ia_css_fpn.host.h\"\n#include \"gc/gc_1.0/ia_css_gc.host.h\"\n#include \"macc/macc_1.0/ia_css_macc.host.h\"\n#include \"ctc/ctc_1.0/ia_css_ctc.host.h\"\n#include \"ob/ob_1.0/ia_css_ob.host.h\"\n#include \"raw/raw_1.0/ia_css_raw.host.h\"\n#include \"fixedbds/fixedbds_1.0/ia_css_fixedbds_param.h\"\n#include \"s3a/s3a_1.0/ia_css_s3a.host.h\"\n#include \"sc/sc_1.0/ia_css_sc.host.h\"\n#include \"sdis/sdis_1.0/ia_css_sdis.host.h\"\n#include \"tnr/tnr_1.0/ia_css_tnr.host.h\"\n#include \"uds/uds_1.0/ia_css_uds_param.h\"\n#include \"wb/wb_1.0/ia_css_wb.host.h\"\n#include \"ynr/ynr_1.0/ia_css_ynr.host.h\"\n#include \"xnr/xnr_1.0/ia_css_xnr.host.h\"\n\n \n\n#include \"aa/aa_2/ia_css_aa2.host.h\"\n#include \"anr/anr_2/ia_css_anr2.host.h\"\n#include \"bh/bh_2/ia_css_bh.host.h\"\n#include \"cnr/cnr_2/ia_css_cnr2.host.h\"\n#include \"ctc/ctc1_5/ia_css_ctc1_5.host.h\"\n#include \"de/de_2/ia_css_de2.host.h\"\n#include \"gc/gc_2/ia_css_gc2.host.h\"\n#include \"sdis/sdis_2/ia_css_sdis2.host.h\"\n#include \"ynr/ynr_2/ia_css_ynr2.host.h\"\n#include \"fc/fc_1.0/ia_css_formats.host.h\"\n\n#include \"xnr/xnr_3.0/ia_css_xnr3.host.h\"\n\n\n#include \"sh_css_frac.h\"\n#include \"ia_css_bufq.h\"\n\nstatic size_t fpntbl_bytes(const struct ia_css_binary *binary)\n{\n\treturn array3_size(sizeof(char),\n\t\t\t   binary->in_frame_info.res.height,\n\t\t\t   binary->in_frame_info.padded_width);\n}\n\nstatic size_t sctbl_bytes(const struct ia_css_binary *binary)\n{\n\treturn size_mul(sizeof(unsigned short),\n\t\t\tarray3_size(binary->sctbl_height,\n\t\t\t\t    binary->sctbl_aligned_width_per_color,\n\t\t\t\t    IA_CSS_SC_NUM_COLORS));\n}\n\nstatic size_t morph_plane_bytes(const struct ia_css_binary *binary)\n{\n\treturn array3_size(SH_CSS_MORPH_TABLE_ELEM_BYTES,\n\t\t\t   binary->morph_tbl_aligned_width,\n\t\t\t   binary->morph_tbl_height);\n}\n\n \nstatic ia_css_ptr sp_ddr_ptrs;\n\n \nstatic ia_css_ptr xmem_sp_group_ptrs;\n\nstatic ia_css_ptr xmem_sp_stage_ptrs[IA_CSS_PIPE_ID_NUM]\n[SH_CSS_MAX_STAGES];\nstatic ia_css_ptr xmem_isp_stage_ptrs[IA_CSS_PIPE_ID_NUM]\n[SH_CSS_MAX_STAGES];\n\nstatic ia_css_ptr default_gdc_lut;\nstatic int interleaved_lut_temp[4][HRT_GDC_N];\n\n \n\n \nstatic const int zoom_table[4][HRT_GDC_N] = {\n\t{\n\t\t0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,\n\t\t  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,\n\t\t  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,\n\t\t  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4,\n\t\t  -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,\n\t\t  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,  -7 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4\n\t},\n\t{\n\t\t0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,\n\t\t  2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,\n\t\t  4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,\n\t\t  4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,\n\t\t  7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,\n\t\t  7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,\n\t\t  9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,\n\t\t  9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,\n\t\t  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,\n\t\t  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,\n\t\t  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,\n\t\t  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,\n\t\t  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,\n\t\t  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,\n\t\t  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,\n\t\t  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,\n\t\t  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,\n\t\t  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,\n\t\t  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,\n\t\t  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,\n\t\t  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,\n\t\t  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,\n\t\t  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,\n\t\t  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,\n\t\t  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,\n\t\t  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,\n\t\t  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,\n\t\t  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,\n\t\t  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,\n\t\t  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,\n\t\t  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,\n\t\t  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,\n\t\t  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,\n\t\t  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,\n\t\t  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,\n\t\t  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,\n\t\t  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,\n\t\t  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,\n\t\t  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,\n\t\t  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,\n\t\t  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,\n\t\t  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,\n\t\t  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,\n\t\t  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,\n\t\t  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,\n\t\t  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,\n\t\t  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,\n\t\t  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,\n\t\t  105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4,\n\t\t  105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4,\n\t\t  110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4,\n\t\t  110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4,\n\t\t  116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4,\n\t\t  116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4,\n\t\t  121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4,\n\t\t  121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4,\n\t\t  127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4,\n\t\t  127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4,\n\t\t  132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4,\n\t\t  132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4,\n\t\t  138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4,\n\t\t  138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4,\n\t\t  144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4,\n\t\t  144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4,\n\t\t  149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4,\n\t\t  149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4,\n\t\t  154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4,\n\t\t  154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4,\n\t\t  160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4,\n\t\t  160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4,\n\t\t  165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4,\n\t\t  165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4,\n\t\t  170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4,\n\t\t  170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4,\n\t\t  176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4,\n\t\t  176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4,\n\t\t  181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4,\n\t\t  181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4,\n\t\t  186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4,\n\t\t  186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4,\n\t\t  191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4,\n\t\t  191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4,\n\t\t  195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4,\n\t\t  195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4,\n\t\t  200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4,\n\t\t  200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4,\n\t\t  205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4,\n\t\t  205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4,\n\t\t  209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4,\n\t\t  209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4,\n\t\t  213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4,\n\t\t  213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4,\n\t\t  218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4,\n\t\t  218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4,\n\t\t  222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4,\n\t\t  222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4,\n\t\t  225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4,\n\t\t  225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4,\n\t\t  229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4,\n\t\t  229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4,\n\t\t  232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4,\n\t\t  232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4,\n\t\t  236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4,\n\t\t  236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4,\n\t\t  239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4,\n\t\t  239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4,\n\t\t  241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4,\n\t\t  241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4,\n\t\t  244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4,\n\t\t  244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4,\n\t\t  246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4,\n\t\t  246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4,\n\t\t  248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4,\n\t\t  248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4,\n\t\t  250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4,\n\t\t  250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4,\n\t\t  252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4,\n\t\t  252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4,\n\t\t  253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4,\n\t\t  253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4,\n\t\t  254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4,\n\t\t  254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4,\n\t\t  255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4,\n\t\t  255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4,\n\t\t  255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4,\n\t\t  255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4\n\t},\n\t{\n\t\t256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4,\n\t\t    256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4, 256 << 4,\n\t\t    255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4,\n\t\t    255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4,\n\t\t    255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4,\n\t\t    255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4, 255 << 4,\n\t\t    254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4,\n\t\t    254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4, 254 << 4,\n\t\t    253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4,\n\t\t    253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4, 253 << 4,\n\t\t    252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4,\n\t\t    252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4, 252 << 4,\n\t\t    250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4,\n\t\t    250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4, 250 << 4,\n\t\t    248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4,\n\t\t    248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4, 248 << 4,\n\t\t    246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4,\n\t\t    246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4, 246 << 4,\n\t\t    244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4,\n\t\t    244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4, 244 << 4,\n\t\t    241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4,\n\t\t    241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4, 241 << 4,\n\t\t    239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4,\n\t\t    239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4, 239 << 4,\n\t\t    236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4,\n\t\t    236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4, 236 << 4,\n\t\t    232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4,\n\t\t    232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4, 232 << 4,\n\t\t    229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4,\n\t\t    229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4, 229 << 4,\n\t\t    225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4,\n\t\t    225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4, 225 << 4,\n\t\t    222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4,\n\t\t    222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4, 222 << 4,\n\t\t    218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4,\n\t\t    218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4, 218 << 4,\n\t\t    213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4,\n\t\t    213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4, 213 << 4,\n\t\t    209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4,\n\t\t    209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4, 209 << 4,\n\t\t    205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4,\n\t\t    205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4, 205 << 4,\n\t\t    200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4,\n\t\t    200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4, 200 << 4,\n\t\t    195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4,\n\t\t    195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4, 195 << 4,\n\t\t    191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4,\n\t\t    191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4, 191 << 4,\n\t\t    186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4,\n\t\t    186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4, 186 << 4,\n\t\t    181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4,\n\t\t    181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4, 181 << 4,\n\t\t    176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4,\n\t\t    176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4, 176 << 4,\n\t\t    170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4,\n\t\t    170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4, 170 << 4,\n\t\t    165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4,\n\t\t    165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4, 165 << 4,\n\t\t    160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4,\n\t\t    160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4, 160 << 4,\n\t\t    154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4,\n\t\t    154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4, 154 << 4,\n\t\t    149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4,\n\t\t    149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4, 149 << 4,\n\t\t    144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4,\n\t\t    144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4, 144 << 4,\n\t\t    138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4,\n\t\t    138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4, 138 << 4,\n\t\t    132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4,\n\t\t    132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4, 132 << 4,\n\t\t    127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4,\n\t\t    127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4, 127 << 4,\n\t\t    121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4,\n\t\t    121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4, 121 << 4,\n\t\t    116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4,\n\t\t    116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4, 116 << 4,\n\t\t    110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4,\n\t\t    110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4, 110 << 4,\n\t\t    105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4,\n\t\t    105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4, 105 << 4,\n\t\t    99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,\n\t\t    99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,  99 << 4,\n\t\t    94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,\n\t\t    94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,  94 << 4,\n\t\t    88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,\n\t\t    88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,  88 << 4,\n\t\t    83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,\n\t\t    83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,  83 << 4,\n\t\t    78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,\n\t\t    78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,  78 << 4,\n\t\t    73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,\n\t\t    73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,  73 << 4,\n\t\t    67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,\n\t\t    67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,  67 << 4,\n\t\t    62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,\n\t\t    62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,  62 << 4,\n\t\t    58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,\n\t\t    58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,  58 << 4,\n\t\t    53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,\n\t\t    53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,  53 << 4,\n\t\t    48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,\n\t\t    48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,  48 << 4,\n\t\t    43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,\n\t\t    43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,  43 << 4,\n\t\t    39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,\n\t\t    39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,  39 << 4,\n\t\t    35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,\n\t\t    35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,  35 << 4,\n\t\t    31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,\n\t\t    31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,  31 << 4,\n\t\t    27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,\n\t\t    27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,  27 << 4,\n\t\t    23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,\n\t\t    23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,  23 << 4,\n\t\t    19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,\n\t\t    19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,  19 << 4,\n\t\t    16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,\n\t\t    16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,  16 << 4,\n\t\t    12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,\n\t\t    12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,  12 << 4,\n\t\t    9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,\n\t\t    9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,   9 << 4,\n\t\t    7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,\n\t\t    7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,   7 << 4,\n\t\t    4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,\n\t\t    4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,   4 << 4,\n\t\t    2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,\n\t\t    2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4,   2 << 4\n\t},\n\t{\n\t\t0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4,\n\t\t  -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4, -10 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4, -19 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4, -18 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4, -17 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4, -16 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4, -15 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4, -14 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4, -13 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4, -12 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4, -11 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,  -9 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,  -8 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,  -6 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,  -5 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,  -4 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,  -3 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,  -2 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,  -1 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,\n\t\t  1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,   1 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,\n\t\t  0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4,   0 << 4\n\t}\n};\n\nstatic const struct ia_css_dz_config default_dz_config = {\n\tHRT_GDC_N,\n\tHRT_GDC_N,\n\t{\n\t\t\\\n\t\t{0, 0}, \\\n\t\t{0, 0}, \\\n\t}\n};\n\nstatic const struct ia_css_vector default_motion_config = {\n\t0,\n\t0\n};\n\n \nstatic const struct ia_css_shading_settings default_shading_settings = {\n\t1\t \n};\n\n \n\nstruct ia_css_isp_skc_dvs_statistics {\n\tia_css_ptr p_data;\n};\n\nstatic int\nref_sh_css_ddr_address_map(\n    struct sh_css_ddr_address_map *map,\n    struct sh_css_ddr_address_map *out);\n\nstatic int\nwrite_ia_css_isp_parameter_set_info_to_ddr(\n    struct ia_css_isp_parameter_set_info *me,\n    ia_css_ptr *out);\n\nstatic int\nfree_ia_css_isp_parameter_set_info(ia_css_ptr ptr);\n\nstatic int\nsh_css_params_write_to_ddr_internal(\n    struct ia_css_pipe *pipe,\n    unsigned int pipe_id,\n    struct ia_css_isp_parameters *params,\n    const struct ia_css_pipeline_stage *stage,\n    struct sh_css_ddr_address_map *ddr_map,\n    struct sh_css_ddr_address_map_size *ddr_map_size);\n\nstatic int\nsh_css_create_isp_params(struct ia_css_stream *stream,\n\t\t\t struct ia_css_isp_parameters **isp_params_out);\n\nstatic bool\nsh_css_init_isp_params_from_global(struct ia_css_stream *stream,\n\t\t\t\t   struct ia_css_isp_parameters *params,\n\t\t\t\t   bool use_default_config,\n\t\t\t\t   struct ia_css_pipe *pipe_in);\n\nstatic int\nsh_css_init_isp_params_from_config(struct ia_css_pipe *pipe,\n\t\t\t\t   struct ia_css_isp_parameters *params,\n\t\t\t\t   const struct ia_css_isp_config *config,\n\t\t\t\t   struct ia_css_pipe *pipe_in);\n\nstatic int\nsh_css_set_global_isp_config_on_pipe(\n    struct ia_css_pipe *curr_pipe,\n    const struct ia_css_isp_config *config,\n    struct ia_css_pipe *pipe);\n\nstatic int\nsh_css_set_per_frame_isp_config_on_pipe(\n    struct ia_css_stream *stream,\n    const struct ia_css_isp_config *config,\n    struct ia_css_pipe *pipe);\n\nstatic int\nsh_css_update_uds_and_crop_info_based_on_zoom_region(\n    const struct ia_css_binary_info *info,\n    const struct ia_css_frame_info *in_frame_info,\n    const struct ia_css_frame_info *out_frame_info,\n    const struct ia_css_resolution *dvs_env,\n    const struct ia_css_dz_config *zoom,\n    const struct ia_css_vector *motion_vector,\n    struct sh_css_uds_info *uds,\t\t \n    struct sh_css_crop_pos *sp_out_crop_pos,\t \n    struct ia_css_resolution pipe_in_res,\n    bool enable_zoom);\n\nia_css_ptr\nsh_css_params_ddr_address_map(void)\n{\n\treturn sp_ddr_ptrs;\n}\n\n \nstatic struct ia_css_host_data *\nconvert_allocate_fpntbl(struct ia_css_isp_parameters *params)\n{\n\tunsigned int i, j;\n\tshort *data_ptr;\n\tstruct ia_css_host_data *me;\n\tunsigned int isp_format_data_size;\n\tu32 *isp_format_data_ptr;\n\n\tassert(params);\n\n\tdata_ptr = params->fpn_config.data;\n\tisp_format_data_size = params->fpn_config.height * params->fpn_config.width *\n\t\t\t       sizeof(uint32_t);\n\n\tme = ia_css_host_data_allocate(isp_format_data_size);\n\n\tif (!me)\n\t\treturn NULL;\n\n\tisp_format_data_ptr = (uint32_t *)me->address;\n\n\tfor (i = 0; i < params->fpn_config.height; i++) {\n\t\tfor (j = 0;\n\t\t     j < params->fpn_config.width;\n\t\t     j += 4, data_ptr += 4, isp_format_data_ptr++) {\n\t\t\tint data = data_ptr[0] << 0 |\n\t\t\t\t   data_ptr[1] << 7 |\n\t\t\t\t   data_ptr[2] << 16 |\n\t\t\t\t   data_ptr[3] << 23;\n\t\t\t*isp_format_data_ptr = data;\n\t\t}\n\t}\n\treturn me;\n}\n\nstatic int\nstore_fpntbl(struct ia_css_isp_parameters *params, ia_css_ptr ptr)\n{\n\tstruct ia_css_host_data *isp_data;\n\n\tassert(params);\n\tassert(ptr != mmgr_NULL);\n\n\tisp_data = convert_allocate_fpntbl(params);\n\tif (!isp_data) {\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\treturn -ENOMEM;\n\t}\n\tia_css_params_store_ia_css_host_data(ptr, isp_data);\n\n\tia_css_host_data_free(isp_data);\n\treturn 0;\n}\n\nstatic void\nconvert_raw_to_fpn(struct ia_css_isp_parameters *params)\n{\n\tint maxval = 0;\n\tunsigned int i;\n\n\tassert(params);\n\n\t \n\tfor (i = 0; i < params->fpn_config.height * params->fpn_config.width; i++) {\n\t\tint val = params->fpn_config.data[i];\n\t\t \n\t\tif (val < 0) {\n\t\t\t \n\t\t\tval = 0;\n\t\t} else if (val >= (1 << 13)) {\n\t\t\t \n\t\t\t \n\t\t\tval = (1 << 13) - 1;\n\t\t}\n\t\tmaxval = max(maxval, val);\n\t}\n\t \n\tparams->fpn_config.shift = 0;\n\twhile (maxval > 63) {\n\t\t \n\t\tmaxval >>= 1;\n\t\tparams->fpn_config.shift++;\n\t}\n\t \n\tfor (i = 0; i < params->fpn_config.height * params->fpn_config.width; i++)\n\t\t((unsigned short *)params->fpn_config.data)[i] >>= params->fpn_config.shift;\n}\n\nstatic void\nia_css_process_kernel(struct ia_css_stream *stream,\n\t\t      struct ia_css_isp_parameters *params,\n\t\t      void (*process)(unsigned int pipe_id,\n\t\t\t\t      const struct ia_css_pipeline_stage *stage,\n\t\t\t\t      struct ia_css_isp_parameters *params))\n{\n\tint i;\n\n\tfor (i = 0; i < stream->num_pipes; i++) {\n\t\tstruct ia_css_pipe *pipe = stream->pipes[i];\n\t\tstruct ia_css_pipeline *pipeline = ia_css_pipe_get_pipeline(pipe);\n\t\tstruct ia_css_pipeline_stage *stage;\n\n\t\t \n\t\tfor (stage = pipeline->stages; stage; stage = stage->next) {\n\t\t\tif (!stage || !stage->binary) continue;\n\t\t\tprocess(pipeline->pipe_id, stage, params);\n\t\t}\n\t}\n}\n\nstatic int\nsh_css_select_dp_10bpp_config(const struct ia_css_pipe *pipe,\n\t\t\t      bool *is_dp_10bpp)\n{\n\tint err = 0;\n\t \n\tif ((!pipe) || (!is_dp_10bpp)) {\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(-EINVAL);\n\t\terr = -EINVAL;\n\t} else {\n\t\t*is_dp_10bpp = false;\n\n\t\t \n\t\tif (pipe->config.enable_dpc) {\n\t\t\t \n\t\t\tunsigned int required_bds_factor = SH_CSS_BDS_FACTOR_1_00;\n\n\t\t\tif ((pipe->config.bayer_ds_out_res.width != 0) &&\n\t\t\t    (pipe->config.bayer_ds_out_res.height != 0)) {\n\t\t\t\tif (0 == binarydesc_calculate_bds_factor(\n\t\t\t\t\tpipe->config.input_effective_res,\n\t\t\t\t\tpipe->config.bayer_ds_out_res,\n\t\t\t\t\t&required_bds_factor)) {\n\t\t\t\t\tif (required_bds_factor != SH_CSS_BDS_FACTOR_1_00) {\n\t\t\t\t\t\t \n\t\t\t\t\t\t*is_dp_10bpp = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn err;\n}\n\nint\nsh_css_set_black_frame(struct ia_css_stream *stream,\n\t\t       const struct ia_css_frame *raw_black_frame)\n{\n\tstruct ia_css_isp_parameters *params;\n\t \n\tunsigned int height, width, y, x, k, data;\n\tia_css_ptr ptr;\n\n\tassert(stream);\n\tassert(raw_black_frame);\n\n\tparams = stream->isp_params_configs;\n\theight = raw_black_frame->frame_info.res.height;\n\twidth = raw_black_frame->frame_info.padded_width;\n\n\tptr = raw_black_frame->data\n\t+ raw_black_frame->planes.raw.offset;\n\n\tIA_CSS_ENTER_PRIVATE(\"black_frame=%p\", raw_black_frame);\n\n\tif (params->fpn_config.data &&\n\t    (params->fpn_config.width != width || params->fpn_config.height != height)) {\n\t\tkvfree(params->fpn_config.data);\n\t\tparams->fpn_config.data = NULL;\n\t}\n\tif (!params->fpn_config.data) {\n\t\tparams->fpn_config.data = kvmalloc(array3_size(height, width, sizeof(short)),\n\t\t\t\t\t\t   GFP_KERNEL);\n\t\tif (!params->fpn_config.data) {\n\t\t\tIA_CSS_ERROR(\"out of memory\");\n\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\t\treturn -ENOMEM;\n\t\t}\n\t\tparams->fpn_config.width = width;\n\t\tparams->fpn_config.height = height;\n\t\tparams->fpn_config.shift = 0;\n\t}\n\n\t \n\tfor (y = 0; y < height; y++) {\n\t\tfor (x = 0; x < width; x += (ISP_VEC_NELEMS * 2)) {\n\t\t\tint ofs = y * width + x;\n\n\t\t\tfor (k = 0; k < ISP_VEC_NELEMS; k += 2) {\n\t\t\t\thmm_load(ptr, (void *)(&data), sizeof(int));\n\t\t\t\tparams->fpn_config.data[ofs + 2 * k] =\n\t\t\t\t    (short)(data & 0xFFFF);\n\t\t\t\tparams->fpn_config.data[ofs + 2 * k + 2] =\n\t\t\t\t    (short)((data >> 16) & 0xFFFF);\n\t\t\t\tptr += sizeof(int);\t \n\t\t\t}\n\t\t\tfor (k = 0; k < ISP_VEC_NELEMS; k += 2) {\n\t\t\t\thmm_load(ptr, (void *)(&data), sizeof(int));\n\t\t\t\tparams->fpn_config.data[ofs + 2 * k + 1] =\n\t\t\t\t    (short)(data & 0xFFFF);\n\t\t\t\tparams->fpn_config.data[ofs + 2 * k + 3] =\n\t\t\t\t    (short)((data >> 16) & 0xFFFF);\n\t\t\t\tptr += sizeof(int);\t \n\t\t\t}\n\t\t}\n\t}\n\n\t \n\tconvert_raw_to_fpn(params);\n\n\t \n\tia_css_process_kernel(stream, params, ia_css_kernel_process_param[IA_CSS_FPN_ID]);\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(0);\n\n\treturn 0;\n}\n\nbool\nsh_css_params_set_binning_factor(struct ia_css_stream *stream,\n\t\t\t\t unsigned int binning_fact)\n{\n\tstruct ia_css_isp_parameters *params;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\tassert(stream);\n\n\tparams = stream->isp_params_configs;\n\n\tif (params->sensor_binning != binning_fact) {\n\t\tparams->sensor_binning = binning_fact;\n\t\tparams->sc_table_changed = true;\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\n\treturn params->sc_table_changed;\n}\n\nstatic void\nsh_css_set_shading_table(struct ia_css_stream *stream,\n\t\t\t struct ia_css_isp_parameters *params,\n\t\t\t const struct ia_css_shading_table *table)\n{\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\tif (!table)\n\t\treturn;\n\tassert(stream);\n\n\tif (!table->enable)\n\t\ttable = NULL;\n\n\tif (table != params->sc_table) {\n\t\tparams->sc_table = table;\n\t\tparams->sc_table_changed = true;\n\t\t \n\t\tif (!params->output_frame)\n\t\t\tsh_css_invalidate_shading_tables(stream);\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid\nia_css_params_store_ia_css_host_data(\n    ia_css_ptr ddr_addr,\n    struct ia_css_host_data *data)\n{\n\tassert(data);\n\tassert(data->address);\n\tassert(ddr_addr != mmgr_NULL);\n\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\thmm_store(ddr_addr,\n\t\t   (void *)(data->address),\n\t\t   (size_t)data->size);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstruct ia_css_host_data *\nia_css_params_alloc_convert_sctbl(\n    const struct ia_css_pipeline_stage *stage,\n    const struct ia_css_shading_table *shading_table)\n{\n\tconst struct ia_css_binary *binary = stage->binary;\n\tstruct ia_css_host_data    *sctbl;\n\tunsigned int i, j, aligned_width;\n\tunsigned int sctbl_size;\n\tshort int    *ptr;\n\n\tassert(binary);\n\tassert(shading_table);\n\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\tif (!shading_table) {\n\t\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\t\treturn NULL;\n\t}\n\n\taligned_width = binary->sctbl_aligned_width_per_color;\n\tsctbl_size = shading_table->height * IA_CSS_SC_NUM_COLORS * aligned_width *\n\t\t     sizeof(short);\n\n\tsctbl = ia_css_host_data_allocate((size_t)sctbl_size);\n\n\tif (!sctbl)\n\t\treturn NULL;\n\tptr = (short int *)sctbl->address;\n\tmemset(ptr,\n\t       0,\n\t       sctbl_size);\n\n\tfor (i = 0; i < shading_table->height; i++) {\n\t\tfor (j = 0; j < IA_CSS_SC_NUM_COLORS; j++) {\n\t\t\tmemcpy(ptr,\n\t\t\t       &shading_table->data[j]\n\t\t\t       [i * shading_table->width],\n\t\t\t       shading_table->width * sizeof(short));\n\t\t\tptr += aligned_width;\n\t\t}\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\treturn sctbl;\n}\n\nint ia_css_params_store_sctbl(\n    const struct ia_css_pipeline_stage *stage,\n    ia_css_ptr sc_tbl,\n    const struct ia_css_shading_table  *sc_config)\n{\n\tstruct ia_css_host_data *isp_sc_tbl;\n\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\tif (!sc_config) {\n\t\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\t\treturn 0;\n\t}\n\n\tisp_sc_tbl = ia_css_params_alloc_convert_sctbl(stage, sc_config);\n\tif (!isp_sc_tbl) {\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\treturn -ENOMEM;\n\t}\n\t \n\tia_css_params_store_ia_css_host_data(sc_tbl, isp_sc_tbl);\n\tia_css_host_data_free(isp_sc_tbl);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\n\treturn 0;\n}\n\nstatic void\nsh_css_enable_pipeline(const struct ia_css_binary *binary)\n{\n\tif (!binary)\n\t\treturn;\n\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\tia_css_isp_param_enable_pipeline(&binary->mem_params);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic int\nia_css_process_zoom_and_motion(\n    struct ia_css_isp_parameters *params,\n    const struct ia_css_pipeline_stage *first_stage)\n{\n\t \n\tconst struct ia_css_pipeline_stage *stage;\n\tint err = 0;\n\tstruct ia_css_resolution pipe_in_res;\n\n\tpipe_in_res.width = 0;\n\tpipe_in_res.height = 0;\n\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\t \n\tfor (stage = first_stage; stage; stage = stage->next) {\n\t\tstruct ia_css_binary *binary;\n\t\t \n\t\tstatic struct ia_css_binary tmp_binary;\n\n\t\tconst struct ia_css_binary_xinfo *info = NULL;\n\n\t\tbinary = stage->binary;\n\t\tif (binary) {\n\t\t\tinfo = binary->info;\n\t\t} else {\n\t\t\tconst struct sh_css_binary_args *args = &stage->args;\n\t\t\tconst struct ia_css_frame_info *out_infos[IA_CSS_BINARY_MAX_OUTPUT_PORTS] = {NULL};\n\n\t\t\tout_infos[0] = ia_css_frame_get_info(args->out_frame[0]);\n\n\t\t\tinfo = &stage->firmware->info.isp;\n\t\t\tia_css_binary_fill_info(info, false, false,\n\t\t\t\t\t\tATOMISP_INPUT_FORMAT_RAW_10,\n\t\t\t\t\t\tia_css_frame_get_info(args->in_frame),\n\t\t\t\t\t\tNULL,\n\t\t\t\t\t\tout_infos,\n\t\t\t\t\t\tia_css_frame_get_info(args->out_vf_frame),\n\t\t\t\t\t\t&tmp_binary,\n\t\t\t\t\t\tNULL,\n\t\t\t\t\t\t-1, true);\n\t\t\tbinary = &tmp_binary;\n\t\t\tbinary->info = info;\n\t\t}\n\n\t\tif (stage == first_stage) {\n\t\t\t \n\t\t\tpipe_in_res = binary->effective_in_frame_res;\n\t\t}\n\n\t\tassert(stage->stage_num < SH_CSS_MAX_STAGES);\n\t\tif (params->dz_config.zoom_region.resolution.width == 0 &&\n\t\t    params->dz_config.zoom_region.resolution.height == 0) {\n\t\t\tsh_css_update_uds_and_crop_info(\n\t\t\t    &info->sp,\n\t\t\t    &binary->in_frame_info,\n\t\t\t    &binary->out_frame_info[0],\n\t\t\t    &binary->dvs_envelope,\n\t\t\t    &params->dz_config,\n\t\t\t    &params->motion_config,\n\t\t\t    &params->uds[stage->stage_num].uds,\n\t\t\t    &params->uds[stage->stage_num].crop_pos,\n\t\t\t    stage->enable_zoom);\n\t\t} else {\n\t\t\terr = sh_css_update_uds_and_crop_info_based_on_zoom_region(\n\t\t\t\t  &info->sp,\n\t\t\t\t  &binary->in_frame_info,\n\t\t\t\t  &binary->out_frame_info[0],\n\t\t\t\t  &binary->dvs_envelope,\n\t\t\t\t  &params->dz_config,\n\t\t\t\t  &params->motion_config,\n\t\t\t\t  &params->uds[stage->stage_num].uds,\n\t\t\t\t  &params->uds[stage->stage_num].crop_pos,\n\t\t\t\t  pipe_in_res,\n\t\t\t\t  stage->enable_zoom);\n\t\t\tif (err)\n\t\t\t\treturn err;\n\t\t}\n\t}\n\tparams->isp_params_changed = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\treturn err;\n}\n\nstatic void\nsh_css_set_gamma_table(struct ia_css_isp_parameters *params,\n\t\t       const struct ia_css_gamma_table *table)\n{\n\tif (!table)\n\t\treturn;\n\tIA_CSS_ENTER_PRIVATE(\"table=%p\", table);\n\n\tassert(params);\n\tparams->gc_table = *table;\n\tparams->config_changed[IA_CSS_GC_ID] = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_gamma_table(const struct ia_css_isp_parameters *params,\n\t\t       struct ia_css_gamma_table *table)\n{\n\tif (!table)\n\t\treturn;\n\tIA_CSS_ENTER_PRIVATE(\"table=%p\", table);\n\n\tassert(params);\n\t*table = params->gc_table;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_set_ctc_table(struct ia_css_isp_parameters *params,\n\t\t     const struct ia_css_ctc_table *table)\n{\n\tif (!table)\n\t\treturn;\n\n\tIA_CSS_ENTER_PRIVATE(\"table=%p\", table);\n\n\tassert(params);\n\tparams->ctc_table = *table;\n\tparams->config_changed[IA_CSS_CTC_ID] = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_ctc_table(const struct ia_css_isp_parameters *params,\n\t\t     struct ia_css_ctc_table *table)\n{\n\tif (!table)\n\t\treturn;\n\n\tIA_CSS_ENTER_PRIVATE(\"table=%p\", table);\n\n\tassert(params);\n\t*table = params->ctc_table;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_set_macc_table(struct ia_css_isp_parameters *params,\n\t\t      const struct ia_css_macc_table *table)\n{\n\tif (!table)\n\t\treturn;\n\n\tIA_CSS_ENTER_PRIVATE(\"table=%p\", table);\n\n\tassert(params);\n\tparams->macc_table = *table;\n\tparams->config_changed[IA_CSS_MACC_ID] = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_macc_table(const struct ia_css_isp_parameters *params,\n\t\t      struct ia_css_macc_table *table)\n{\n\tif (!table)\n\t\treturn;\n\n\tIA_CSS_ENTER_PRIVATE(\"table=%p\", table);\n\n\tassert(params);\n\t*table = params->macc_table;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid ia_css_morph_table_free(\n    struct ia_css_morph_table *me)\n{\n\tunsigned int i;\n\n\tif (!me)\n\t\treturn;\n\n\tIA_CSS_ENTER(\"\");\n\n\tfor (i = 0; i < IA_CSS_MORPH_TABLE_NUM_PLANES; i++) {\n\t\tif (me->coordinates_x[i]) {\n\t\t\tkvfree(me->coordinates_x[i]);\n\t\t\tme->coordinates_x[i] = NULL;\n\t\t}\n\t\tif (me->coordinates_y[i]) {\n\t\t\tkvfree(me->coordinates_y[i]);\n\t\t\tme->coordinates_y[i] = NULL;\n\t\t}\n\t}\n\n\tkvfree(me);\n\tIA_CSS_LEAVE(\"void\");\n}\n\nstruct ia_css_morph_table *ia_css_morph_table_allocate(\n    unsigned int width,\n    unsigned int height)\n{\n\tunsigned int i;\n\tstruct ia_css_morph_table *me;\n\n\tIA_CSS_ENTER(\"\");\n\n\tme = kvmalloc(sizeof(*me), GFP_KERNEL);\n\tif (!me) {\n\t\tIA_CSS_ERROR(\"out of memory\");\n\t\treturn me;\n\t}\n\n\tfor (i = 0; i < IA_CSS_MORPH_TABLE_NUM_PLANES; i++) {\n\t\tme->coordinates_x[i] = NULL;\n\t\tme->coordinates_y[i] = NULL;\n\t}\n\n\tfor (i = 0; i < IA_CSS_MORPH_TABLE_NUM_PLANES; i++) {\n\t\tme->coordinates_x[i] = kvmalloc(height * width *\n\t\t\t\t\t\tsizeof(*me->coordinates_x[i]),\n\t\t\t\t\t\tGFP_KERNEL);\n\t\tme->coordinates_y[i] = kvmalloc(height * width *\n\t\t\t\t\t\tsizeof(*me->coordinates_y[i]),\n\t\t\t\t\t\tGFP_KERNEL);\n\n\t\tif ((!me->coordinates_x[i]) ||\n\t\t    (!me->coordinates_y[i])) {\n\t\t\tia_css_morph_table_free(me);\n\t\t\tme = NULL;\n\t\t\treturn me;\n\t\t}\n\t}\n\tme->width = width;\n\tme->height = height;\n\tIA_CSS_LEAVE(\"\");\n\treturn me;\n}\n\nstatic int sh_css_params_default_morph_table(\n    struct ia_css_morph_table **table,\n    const struct ia_css_binary *binary)\n{\n\t \n\tunsigned int i, j, k, step, width, height;\n\tshort start_x[IA_CSS_MORPH_TABLE_NUM_PLANES] = { -8, 0, -8, 0, 0, -8 },\n\t\tstart_y[IA_CSS_MORPH_TABLE_NUM_PLANES] = { 0, 0, -8, -8, -8, 0 };\n\tstruct ia_css_morph_table *tab;\n\n\tassert(table);\n\tassert(binary);\n\n\tIA_CSS_ENTER_PRIVATE(\"\");\n\n\tstep = (ISP_VEC_NELEMS / 16) * 128;\n\twidth = binary->morph_tbl_width;\n\theight = binary->morph_tbl_height;\n\n\ttab = ia_css_morph_table_allocate(width, height);\n\tif (!tab)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < IA_CSS_MORPH_TABLE_NUM_PLANES; i++) {\n\t\tshort val_y = start_y[i];\n\n\t\tfor (j = 0; j < height; j++) {\n\t\t\tshort val_x = start_x[i];\n\t\t\tunsigned short *x_ptr, *y_ptr;\n\n\t\t\tx_ptr = &tab->coordinates_x[i][j * width];\n\t\t\ty_ptr = &tab->coordinates_y[i][j * width];\n\t\t\tfor (k = 0; k < width;\n\t\t\t     k++, x_ptr++, y_ptr++, val_x += (short)step) {\n\t\t\t\tif (k == 0)\n\t\t\t\t\t*x_ptr = 0;\n\t\t\t\telse if (k == width - 1)\n\t\t\t\t\t*x_ptr = val_x + 2 * start_x[i];\n\t\t\t\telse\n\t\t\t\t\t*x_ptr = val_x;\n\t\t\t\tif (j == 0)\n\t\t\t\t\t*y_ptr = 0;\n\t\t\t\telse\n\t\t\t\t\t*y_ptr = val_y;\n\t\t\t}\n\t\t\tval_y += (short)step;\n\t\t}\n\t}\n\t*table = tab;\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(0);\n\n\treturn 0;\n}\n\nstatic void\nsh_css_set_morph_table(struct ia_css_isp_parameters *params,\n\t\t       const struct ia_css_morph_table *table)\n{\n\tif (!table)\n\t\treturn;\n\n\tIA_CSS_ENTER_PRIVATE(\"table=%p\", table);\n\n\tassert(params);\n\tif (table->enable == false)\n\t\ttable = NULL;\n\tparams->morph_table = table;\n\tparams->morph_table_changed = true;\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid\nia_css_translate_3a_statistics(\n    struct ia_css_3a_statistics               *host_stats,\n    const struct ia_css_isp_3a_statistics_map *isp_stats)\n{\n\tIA_CSS_ENTER(\"\");\n\tif (host_stats->grid.use_dmem) {\n\t\tIA_CSS_LOG(\"3A: DMEM\");\n\t\tia_css_s3a_dmem_decode(host_stats, isp_stats->dmem_stats);\n\t} else {\n\t\tIA_CSS_LOG(\"3A: VMEM\");\n\t\tia_css_s3a_vmem_decode(host_stats, isp_stats->vmem_stats_hi,\n\t\t\t\t       isp_stats->vmem_stats_lo);\n\t}\n\tIA_CSS_LOG(\"3A: HMEM\");\n\tia_css_s3a_hmem_decode(host_stats, isp_stats->hmem_stats);\n\n\tIA_CSS_LEAVE(\"void\");\n}\n\nvoid\nia_css_isp_3a_statistics_map_free(struct ia_css_isp_3a_statistics_map *me)\n{\n\tif (me) {\n\t\tif (me->data_allocated) {\n\t\t\tkvfree(me->data_ptr);\n\t\t\tme->data_ptr = NULL;\n\t\t\tme->data_allocated = false;\n\t\t}\n\t\tkvfree(me);\n\t}\n}\n\nstruct ia_css_isp_3a_statistics_map *\nia_css_isp_3a_statistics_map_allocate(\n    const struct ia_css_isp_3a_statistics *isp_stats,\n    void *data_ptr)\n{\n\tstruct ia_css_isp_3a_statistics_map *me;\n\t \n\tchar *base_ptr;\n\n\tme = kvmalloc(sizeof(*me), GFP_KERNEL);\n\tif (!me) {\n\t\tIA_CSS_LEAVE(\"cannot allocate memory\");\n\t\tgoto err;\n\t}\n\n\tme->data_ptr = data_ptr;\n\tme->data_allocated = !data_ptr;\n\tif (!data_ptr) {\n\t\tme->data_ptr = kvmalloc(isp_stats->size, GFP_KERNEL);\n\t\tif (!me->data_ptr) {\n\t\t\tIA_CSS_LEAVE(\"cannot allocate memory\");\n\t\t\tgoto err;\n\t\t}\n\t}\n\tbase_ptr = me->data_ptr;\n\n\tme->size = isp_stats->size;\n\t \n\tme->dmem_stats    = (void *)base_ptr;\n\tme->vmem_stats_hi = (void *)(base_ptr + isp_stats->dmem_size);\n\tme->vmem_stats_lo = (void *)(base_ptr + isp_stats->dmem_size +\n\t\t\t\t     isp_stats->vmem_size);\n\tme->hmem_stats    = (void *)(base_ptr + isp_stats->dmem_size +\n\t\t\t\t     2 * isp_stats->vmem_size);\n\n\tIA_CSS_LEAVE(\"map=%p\", me);\n\treturn me;\n\nerr:\n\tkvfree(me);\n\treturn NULL;\n}\n\nint\nia_css_get_3a_statistics(struct ia_css_3a_statistics           *host_stats,\n\t\t\t const struct ia_css_isp_3a_statistics *isp_stats)\n{\n\tstruct ia_css_isp_3a_statistics_map *map;\n\tint ret = 0;\n\n\tIA_CSS_ENTER(\"host_stats=%p, isp_stats=%p\", host_stats, isp_stats);\n\n\tassert(host_stats);\n\tassert(isp_stats);\n\n\tmap = ia_css_isp_3a_statistics_map_allocate(isp_stats, NULL);\n\tif (map) {\n\t\thmm_load(isp_stats->data_ptr, map->data_ptr, isp_stats->size);\n\t\tia_css_translate_3a_statistics(host_stats, map);\n\t\tia_css_isp_3a_statistics_map_free(map);\n\t} else {\n\t\tIA_CSS_ERROR(\"out of memory\");\n\t\tret = -ENOMEM;\n\t}\n\n\tIA_CSS_LEAVE_ERR(ret);\n\treturn ret;\n}\n\n \nstatic void\nia_css_set_param_exceptions(const struct ia_css_pipe *pipe,\n\t\t\t    struct ia_css_isp_parameters *params)\n{\n\tassert(params);\n\n\t \n\tparams->dp_config.gr = params->wb_config.gr;\n\tparams->dp_config.r  = params->wb_config.r;\n\tparams->dp_config.b  = params->wb_config.b;\n\tparams->dp_config.gb = params->wb_config.gb;\n}\n\nstatic void\nsh_css_set_nr_config(struct ia_css_isp_parameters *params,\n\t\t     const struct ia_css_nr_config *config)\n{\n\tif (!config)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"config=%p\", config);\n\n\tia_css_nr_debug_dtrace(config, IA_CSS_DEBUG_TRACE_PRIVATE);\n\tparams->nr_config = *config;\n\tparams->yee_config.nr = *config;\n\tparams->config_changed[IA_CSS_NR_ID]  = true;\n\tparams->config_changed[IA_CSS_YEE_ID] = true;\n\tparams->config_changed[IA_CSS_BNR_ID] = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_set_ee_config(struct ia_css_isp_parameters *params,\n\t\t     const struct ia_css_ee_config *config)\n{\n\tif (!config)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"config=%p\", config);\n\tia_css_ee_debug_dtrace(config, IA_CSS_DEBUG_TRACE_PRIVATE);\n\n\tparams->ee_config = *config;\n\tparams->yee_config.ee = *config;\n\tparams->config_changed[IA_CSS_YEE_ID] = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_ee_config(const struct ia_css_isp_parameters *params,\n\t\t     struct ia_css_ee_config *config)\n{\n\tif (!config)\n\t\treturn;\n\n\tIA_CSS_ENTER_PRIVATE(\"config=%p\", config);\n\n\tassert(params);\n\t*config = params->ee_config;\n\n\tia_css_ee_debug_dtrace(config, IA_CSS_DEBUG_TRACE_PRIVATE);\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_set_pipe_dvs_6axis_config(const struct ia_css_pipe *pipe,\n\t\t\t\t struct ia_css_isp_parameters *params,\n\t\t\t\t const struct ia_css_dvs_6axis_config  *dvs_config)\n{\n\tif (!dvs_config)\n\t\treturn;\n\tassert(params);\n\tassert(pipe);\n\tassert(dvs_config->height_y == dvs_config->height_uv);\n\tassert((dvs_config->width_y - 1) == 2 * (dvs_config->width_uv - 1));\n\tassert(pipe->mode < IA_CSS_PIPE_ID_NUM);\n\n\tIA_CSS_ENTER_PRIVATE(\"dvs_config=%p\", dvs_config);\n\n\tcopy_dvs_6axis_table(params->pipe_dvs_6axis_config[pipe->mode], dvs_config);\n\n\tparams->pipe_dvs_6axis_config_changed[pipe->mode] = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_pipe_dvs_6axis_config(const struct ia_css_pipe *pipe,\n\t\t\t\t const struct ia_css_isp_parameters *params,\n\t\t\t\t struct ia_css_dvs_6axis_config *dvs_config)\n{\n\tif (!dvs_config)\n\t\treturn;\n\tassert(params);\n\tassert(pipe);\n\tassert(dvs_config->height_y == dvs_config->height_uv);\n\tassert((dvs_config->width_y - 1) == 2 * dvs_config->width_uv - 1);\n\n\tIA_CSS_ENTER_PRIVATE(\"dvs_config=%p\", dvs_config);\n\n\tif ((pipe->mode < IA_CSS_PIPE_ID_NUM) &&\n\t    (dvs_config->width_y == params->pipe_dvs_6axis_config[pipe->mode]->width_y) &&\n\t    (dvs_config->height_y == params->pipe_dvs_6axis_config[pipe->mode]->height_y) &&\n\t    (dvs_config->width_uv == params->pipe_dvs_6axis_config[pipe->mode]->width_uv) &&\n\t    (dvs_config->height_uv == params->pipe_dvs_6axis_config[pipe->mode]->height_uv)\n\t    &&\n\t    dvs_config->xcoords_y &&\n\t    dvs_config->ycoords_y &&\n\t    dvs_config->xcoords_uv &&\n\t    dvs_config->ycoords_uv) {\n\t\tcopy_dvs_6axis_table(dvs_config, params->pipe_dvs_6axis_config[pipe->mode]);\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_set_baa_config(struct ia_css_isp_parameters *params,\n\t\t      const struct ia_css_aa_config *config)\n{\n\tif (!config)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"config=%p\", config);\n\n\tparams->bds_config = *config;\n\tparams->config_changed[IA_CSS_BDS_ID] = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_baa_config(const struct ia_css_isp_parameters *params,\n\t\t      struct ia_css_aa_config *config)\n{\n\tif (!config)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"config=%p\", config);\n\n\t*config = params->bds_config;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_set_dz_config(struct ia_css_isp_parameters *params,\n\t\t     const struct ia_css_dz_config *config)\n{\n\tif (!config)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"dx=%d, dy=%d\", config->dx, config->dy);\n\n\tassert(config->dx <= HRT_GDC_N);\n\tassert(config->dy <= HRT_GDC_N);\n\n\tparams->dz_config = *config;\n\tparams->dz_config_changed = true;\n\t \n\tparams->isp_params_changed = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_dz_config(const struct ia_css_isp_parameters *params,\n\t\t     struct ia_css_dz_config *config)\n{\n\tif (!config)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"config=%p\", config);\n\n\t*config = params->dz_config;\n\n\tIA_CSS_LEAVE_PRIVATE(\"dx=%d, dy=%d\", config->dx, config->dy);\n}\n\nstatic void\nsh_css_set_motion_vector(struct ia_css_isp_parameters *params,\n\t\t\t const struct ia_css_vector *motion)\n{\n\tif (!motion)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"x=%d, y=%d\", motion->x, motion->y);\n\n\tparams->motion_config = *motion;\n\t \n\tparams->motion_config_changed = true;\n\tparams->isp_params_changed = true;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nsh_css_get_motion_vector(const struct ia_css_isp_parameters *params,\n\t\t\t struct ia_css_vector *motion)\n{\n\tif (!motion)\n\t\treturn;\n\tassert(params);\n\n\tIA_CSS_ENTER_PRIVATE(\"motion=%p\", motion);\n\n\t*motion = params->motion_config;\n\n\tIA_CSS_LEAVE_PRIVATE(\"x=%d, y=%d\", motion->x, motion->y);\n}\n\nstruct ia_css_isp_config *\nsh_css_pipe_isp_config_get(struct ia_css_pipe *pipe)\n{\n\tif (!pipe) {\n\t\tIA_CSS_ERROR(\"pipe=%p\", NULL);\n\t\treturn NULL;\n\t}\n\treturn pipe->config.p_isp_config;\n}\n\nint\nia_css_stream_set_isp_config(\n    struct ia_css_stream *stream,\n    const struct ia_css_isp_config *config)\n{\n\treturn ia_css_stream_set_isp_config_on_pipe(stream, config, NULL);\n}\n\nint\nia_css_stream_set_isp_config_on_pipe(\n    struct ia_css_stream *stream,\n    const struct ia_css_isp_config *config,\n    struct ia_css_pipe *pipe)\n{\n\tint err = 0;\n\n\tif ((!stream) || (!config))\n\t\treturn -EINVAL;\n\n\tIA_CSS_ENTER(\"stream=%p, config=%p, pipe=%p\", stream, config, pipe);\n\n\tif (config->output_frame)\n\t\terr = sh_css_set_per_frame_isp_config_on_pipe(stream, config, pipe);\n\telse\n\t\terr = sh_css_set_global_isp_config_on_pipe(stream->pipes[0], config, pipe);\n\n\tIA_CSS_LEAVE_ERR(err);\n\treturn err;\n}\n\nint\nia_css_pipe_set_isp_config(struct ia_css_pipe *pipe,\n\t\t\t   struct ia_css_isp_config *config)\n{\n\tstruct ia_css_pipe *pipe_in = pipe;\n\tint err = 0;\n\n\tIA_CSS_ENTER(\"pipe=%p\", pipe);\n\n\tif ((!pipe) || (!pipe->stream))\n\t\treturn -EINVAL;\n\n\tia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, \"config=%p\\n\", config);\n\n\tif (config->output_frame)\n\t\terr = sh_css_set_per_frame_isp_config_on_pipe(pipe->stream, config, pipe);\n\telse\n\t\terr = sh_css_set_global_isp_config_on_pipe(pipe, config, pipe_in);\n\tIA_CSS_LEAVE_ERR(err);\n\treturn err;\n}\n\nstatic int\nsh_css_set_global_isp_config_on_pipe(\n    struct ia_css_pipe *curr_pipe,\n    const struct ia_css_isp_config *config,\n    struct ia_css_pipe *pipe)\n{\n\tint err = 0;\n\tint err1 = 0;\n\tint err2 = 0;\n\n\tIA_CSS_ENTER_PRIVATE(\"stream=%p, config=%p, pipe=%p\", curr_pipe, config, pipe);\n\n\terr1 = sh_css_init_isp_params_from_config(curr_pipe, curr_pipe->stream->isp_params_configs, config, pipe);\n\n\t \n\terr2 = sh_css_param_update_isp_params(curr_pipe, curr_pipe->stream->isp_params_configs, sh_css_sp_is_running(), pipe);\n\n\t \n\n\terr = (err1 != 0) ? err1 : ((err2 != 0) ? err2 : err);\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nstatic int\nsh_css_set_per_frame_isp_config_on_pipe(\n    struct ia_css_stream *stream,\n    const struct ia_css_isp_config *config,\n    struct ia_css_pipe *pipe)\n{\n\tunsigned int i;\n\tbool per_frame_config_created = false;\n\tint err = 0;\n\tint err1 = 0;\n\tint err2 = 0;\n\tint err3 = 0;\n\n\tstruct sh_css_ddr_address_map *ddr_ptrs;\n\tstruct sh_css_ddr_address_map_size *ddr_ptrs_size;\n\tstruct ia_css_isp_parameters *params;\n\n\tIA_CSS_ENTER_PRIVATE(\"stream=%p, config=%p, pipe=%p\", stream, config, pipe);\n\n\tif (!pipe) {\n\t\terr = -EINVAL;\n\t\tgoto exit;\n\t}\n\n\t \n\tif (!stream->per_frame_isp_params_configs) {\n\t\terr = sh_css_create_isp_params(stream,\n\t\t\t\t\t       &stream->per_frame_isp_params_configs);\n\t\tif (err)\n\t\t\tgoto exit;\n\t\tper_frame_config_created = true;\n\t}\n\n\tparams = stream->per_frame_isp_params_configs;\n\n\t \n\tif (!sh_css_init_isp_params_from_global(stream, params, false, pipe)) {\n\t\terr1 = -EINVAL;\n\t}\n\n\terr2 = sh_css_init_isp_params_from_config(stream->pipes[0], params, config, pipe);\n\n\tif (per_frame_config_created) {\n\t\tddr_ptrs = &params->ddr_ptrs;\n\t\tddr_ptrs_size = &params->ddr_ptrs_size;\n\t\t \n\t\tfor (i = 0; i < IA_CSS_PIPE_ID_NUM; i++) {\n\t\t\tref_sh_css_ddr_address_map(ddr_ptrs, &params->pipe_ddr_ptrs[i]);\n\t\t\tparams->pipe_ddr_ptrs_size[i] = *ddr_ptrs_size;\n\t\t}\n\t}\n\n\t \n\terr3 = sh_css_param_update_isp_params(stream->pipes[0], params, sh_css_sp_is_running(), pipe);\n\n\t \n\terr = (err1 != 0) ? err1 :\n\t      (err2 != 0) ? err2 :\n\t      (err3 != 0) ? err3 : err;\nexit:\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nstatic int\nsh_css_init_isp_params_from_config(struct ia_css_pipe *pipe,\n\t\t\t\t   struct ia_css_isp_parameters *params,\n\t\t\t\t   const struct ia_css_isp_config *config,\n\t\t\t\t   struct ia_css_pipe *pipe_in)\n{\n\tint err = 0;\n\tbool is_dp_10bpp = true;\n\n\tassert(pipe);\n\n\tIA_CSS_ENTER_PRIVATE(\"pipe=%p, config=%p, params=%p\", pipe, config, params);\n\n\tia_css_set_configs(params, config);\n\n\tsh_css_set_nr_config(params, config->nr_config);\n\tsh_css_set_ee_config(params, config->ee_config);\n\tsh_css_set_baa_config(params, config->baa_config);\n\tif ((pipe->mode < IA_CSS_PIPE_ID_NUM) &&\n\t    (params->pipe_dvs_6axis_config[pipe->mode]))\n\t\tsh_css_set_pipe_dvs_6axis_config(pipe, params, config->dvs_6axis_config);\n\tsh_css_set_dz_config(params, config->dz_config);\n\tsh_css_set_motion_vector(params, config->motion_vector);\n\tsh_css_set_shading_table(pipe->stream, params, config->shading_table);\n\tsh_css_set_morph_table(params, config->morph_table);\n\tsh_css_set_macc_table(params, config->macc_table);\n\tsh_css_set_gamma_table(params, config->gamma_table);\n\tsh_css_set_ctc_table(params, config->ctc_table);\n\t \n\tsh_css_set_shading_settings(params, config->shading_settings);\n\t \n\n\tparams->dis_coef_table_changed = (config->dvs_coefs);\n\tparams->dvs2_coef_table_changed = (config->dvs2_coefs);\n\n\tparams->output_frame = config->output_frame;\n\tparams->isp_parameters_id = config->isp_config_id;\n\n\tif (0 ==\n\t    sh_css_select_dp_10bpp_config(pipe, &is_dp_10bpp)) {\n\t\t \n\t\t \n\t\tif (is_dp_10bpp) {\n\t\t\terr = -EINVAL;\n\t\t}\n\t} else {\n\t\terr = -EINVAL;\n\t\tgoto exit;\n\t}\n\n\tia_css_set_param_exceptions(pipe, params);\n\nexit:\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nvoid\nia_css_stream_get_isp_config(\n    const struct ia_css_stream *stream,\n    struct ia_css_isp_config *config)\n{\n\tIA_CSS_ENTER(\"void\");\n\tia_css_pipe_get_isp_config(stream->pipes[0], config);\n\tIA_CSS_LEAVE(\"void\");\n}\n\nvoid\nia_css_pipe_get_isp_config(struct ia_css_pipe *pipe,\n\t\t\t   struct ia_css_isp_config *config)\n{\n\tstruct ia_css_isp_parameters *params = NULL;\n\n\tassert(config);\n\n\tIA_CSS_ENTER(\"config=%p\", config);\n\n\tparams = pipe->stream->isp_params_configs;\n\tassert(params);\n\n\tia_css_get_configs(params, config);\n\n\tsh_css_get_ee_config(params, config->ee_config);\n\tsh_css_get_baa_config(params, config->baa_config);\n\tsh_css_get_pipe_dvs_6axis_config(pipe, params, config->dvs_6axis_config);\n\tsh_css_get_macc_table(params, config->macc_table);\n\tsh_css_get_gamma_table(params, config->gamma_table);\n\tsh_css_get_ctc_table(params, config->ctc_table);\n\tsh_css_get_dz_config(params, config->dz_config);\n\tsh_css_get_motion_vector(params, config->motion_vector);\n\t \n\tsh_css_get_shading_settings(params, config->shading_settings);\n\t \n\n\tconfig->output_frame = params->output_frame;\n\tconfig->isp_config_id = params->isp_parameters_id;\n\n\tIA_CSS_LEAVE(\"void\");\n}\n\n \nstatic bool realloc_isp_css_mm_buf(\n    ia_css_ptr *curr_buf,\n    size_t *curr_size,\n    size_t needed_size,\n    bool force,\n    int *err)\n{\n\ts32 id;\n\n\t*err = 0;\n\t \n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tif (!force && *curr_size >= needed_size) {\n\t\tIA_CSS_LEAVE_PRIVATE(\"false\");\n\t\treturn false;\n\t}\n\t \n\tif (*curr_size == needed_size && ia_css_refcount_is_single(*curr_buf)) {\n\t\tIA_CSS_LEAVE_PRIVATE(\"false\");\n\t\treturn false;\n\t}\n\n\tid = IA_CSS_REFCOUNT_PARAM_BUFFER;\n\tia_css_refcount_decrement(id, *curr_buf);\n\t*curr_buf = ia_css_refcount_increment(id, hmm_alloc(needed_size));\n\tif (!*curr_buf) {\n\t\t*err = -ENOMEM;\n\t\t*curr_size = 0;\n\t} else {\n\t\t*curr_size = needed_size;\n\t}\n\tIA_CSS_LEAVE_PRIVATE(\"true\");\n\treturn true;\n}\n\nstatic bool reallocate_buffer(\n    ia_css_ptr *curr_buf,\n    size_t *curr_size,\n    size_t needed_size,\n    bool force,\n    int *err)\n{\n\tbool ret;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tret = realloc_isp_css_mm_buf(curr_buf,\n\t\t\t\t     curr_size, needed_size, force, err);\n\n\tIA_CSS_LEAVE_PRIVATE(\"ret=%d\", ret);\n\treturn ret;\n}\n\nstruct ia_css_isp_3a_statistics *\nia_css_isp_3a_statistics_allocate(const struct ia_css_3a_grid_info *grid)\n{\n\tstruct ia_css_isp_3a_statistics *me;\n\n\tIA_CSS_ENTER(\"grid=%p\", grid);\n\n\tassert(grid);\n\n\t \n\tif (!grid->enable)\n\t\treturn NULL;\n\n\tme = kvcalloc(1, sizeof(*me), GFP_KERNEL);\n\tif (!me)\n\t\tgoto err;\n\n\tif (grid->use_dmem) {\n\t\tme->dmem_size = sizeof(struct ia_css_3a_output) *\n\t\t\t\tgrid->aligned_width *\n\t\t\t\tgrid->aligned_height;\n\t} else {\n\t\tme->vmem_size = ISP_S3ATBL_HI_LO_STRIDE_BYTES *\n\t\t\t\tgrid->aligned_height;\n\t}\n\tme->hmem_size = sizeof_hmem(HMEM0_ID);\n\n\t \n\tme->dmem_size = CEIL_MUL(me->dmem_size, HIVE_ISP_DDR_WORD_BYTES);\n\tme->vmem_size = CEIL_MUL(me->vmem_size, HIVE_ISP_DDR_WORD_BYTES);\n\tme->hmem_size = CEIL_MUL(me->hmem_size, HIVE_ISP_DDR_WORD_BYTES);\n\n\tme->size = me->dmem_size + me->vmem_size * 2 + me->hmem_size;\n\tme->data_ptr = hmm_alloc(me->size);\n\tif (me->data_ptr == mmgr_NULL) {\n\t\tkvfree(me);\n\t\tme = NULL;\n\t\tgoto err;\n\t}\n\tif (me->dmem_size)\n\t\tme->data.dmem.s3a_tbl = me->data_ptr;\n\tif (me->vmem_size) {\n\t\tme->data.vmem.s3a_tbl_hi = me->data_ptr + me->dmem_size;\n\t\tme->data.vmem.s3a_tbl_lo = me->data_ptr + me->dmem_size + me->vmem_size;\n\t}\n\tif (me->hmem_size)\n\t\tme->data_hmem.rgby_tbl = me->data_ptr + me->dmem_size + 2 * me->vmem_size;\n\nerr:\n\tIA_CSS_LEAVE(\"return=%p\", me);\n\treturn me;\n}\n\nvoid\nia_css_isp_3a_statistics_free(struct ia_css_isp_3a_statistics *me)\n{\n\tif (me) {\n\t\thmm_free(me->data_ptr);\n\t\tkvfree(me);\n\t}\n}\n\nstruct ia_css_isp_skc_dvs_statistics *ia_css_skc_dvs_statistics_allocate(void)\n{\n\treturn NULL;\n}\n\nstruct ia_css_metadata *\nia_css_metadata_allocate(const struct ia_css_metadata_info *metadata_info)\n{\n\tstruct ia_css_metadata *md = NULL;\n\n\tIA_CSS_ENTER(\"\");\n\n\tif (metadata_info->size == 0)\n\t\treturn NULL;\n\n\tmd = kvmalloc(sizeof(*md), GFP_KERNEL);\n\tif (!md)\n\t\tgoto error;\n\n\tmd->info = *metadata_info;\n\tmd->exp_id = 0;\n\tmd->address = hmm_alloc(metadata_info->size);\n\tif (md->address == mmgr_NULL)\n\t\tgoto error;\n\n\tIA_CSS_LEAVE(\"return=%p\", md);\n\treturn md;\n\nerror:\n\tia_css_metadata_free(md);\n\tIA_CSS_LEAVE(\"return=%p\", NULL);\n\treturn NULL;\n}\n\nvoid\nia_css_metadata_free(struct ia_css_metadata *me)\n{\n\tif (me) {\n\t\t \n\t\tIA_CSS_ENTER(\"me=%p\", me);\n\t\thmm_free(me->address);\n\t\tkvfree(me);\n\t\tIA_CSS_LEAVE(\"void\");\n\t}\n}\n\nvoid\nia_css_metadata_free_multiple(unsigned int num_bufs,\n\t\t\t      struct ia_css_metadata **bufs)\n{\n\tunsigned int i;\n\n\tif (bufs) {\n\t\tfor (i = 0; i < num_bufs; i++)\n\t\t\tia_css_metadata_free(bufs[i]);\n\t}\n}\n\nstatic unsigned int g_param_buffer_dequeue_count;\nstatic unsigned int g_param_buffer_enqueue_count;\n\nint\nia_css_stream_isp_parameters_init(struct ia_css_stream *stream)\n{\n\tint err = 0;\n\tunsigned int i;\n\tstruct sh_css_ddr_address_map *ddr_ptrs;\n\tstruct sh_css_ddr_address_map_size *ddr_ptrs_size;\n\tstruct ia_css_isp_parameters *params;\n\n\tassert(stream);\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tif (!stream) {\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(-EINVAL);\n\t\treturn -EINVAL;\n\t}\n\t \n\tg_param_buffer_dequeue_count = 0;\n\tg_param_buffer_enqueue_count = 0;\n\n\tstream->per_frame_isp_params_configs = NULL;\n\terr = sh_css_create_isp_params(stream,\n\t\t\t\t       &stream->isp_params_configs);\n\tif (err)\n\t\tgoto ERR;\n\n\tparams = stream->isp_params_configs;\n\tif (!sh_css_init_isp_params_from_global(stream, params, true, NULL)) {\n\t\t \n\t\terr = -EINVAL;\n\t}\n\n\tddr_ptrs = &params->ddr_ptrs;\n\tddr_ptrs_size = &params->ddr_ptrs_size;\n\n\t \n\tfor (i = 0; i < IA_CSS_PIPE_ID_NUM; i++) {\n\t\tref_sh_css_ddr_address_map(ddr_ptrs, &params->pipe_ddr_ptrs[i]);\n\t\tparams->pipe_ddr_ptrs_size[i] = *ddr_ptrs_size;\n\t}\n\nERR:\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nstatic void\nia_css_set_sdis_config(\n    struct ia_css_isp_parameters *params,\n    const struct ia_css_dvs_coefficients *dvs_coefs)\n{\n\tia_css_set_sdis_horicoef_config(params, dvs_coefs);\n\tia_css_set_sdis_vertcoef_config(params, dvs_coefs);\n\tia_css_set_sdis_horiproj_config(params, dvs_coefs);\n\tia_css_set_sdis_vertproj_config(params, dvs_coefs);\n}\n\nstatic void\nia_css_set_sdis2_config(\n    struct ia_css_isp_parameters *params,\n    const struct ia_css_dvs2_coefficients *dvs2_coefs)\n{\n\tia_css_set_sdis2_horicoef_config(params, dvs2_coefs);\n\tia_css_set_sdis2_vertcoef_config(params, dvs2_coefs);\n\tia_css_set_sdis2_horiproj_config(params, dvs2_coefs);\n\tia_css_set_sdis2_vertproj_config(params, dvs2_coefs);\n}\n\nstatic int\nsh_css_create_isp_params(struct ia_css_stream *stream,\n\t\t\t struct ia_css_isp_parameters **isp_params_out)\n{\n\tbool succ = true;\n\tunsigned int i;\n\tstruct sh_css_ddr_address_map *ddr_ptrs;\n\tstruct sh_css_ddr_address_map_size *ddr_ptrs_size;\n\tint err;\n\tsize_t params_size;\n\tstruct ia_css_isp_parameters *params =\n\tkvmalloc(sizeof(struct ia_css_isp_parameters), GFP_KERNEL);\n\n\tif (!params) {\n\t\t*isp_params_out = NULL;\n\t\terr = -ENOMEM;\n\t\tIA_CSS_ERROR(\"%s:%d error: cannot allocate memory\", __FILE__, __LINE__);\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\treturn err;\n\t} else {\n\t\tmemset(params, 0, sizeof(struct ia_css_isp_parameters));\n\t}\n\n\tddr_ptrs = &params->ddr_ptrs;\n\tddr_ptrs_size = &params->ddr_ptrs_size;\n\n\tfor (i = 0; i < IA_CSS_PIPE_ID_NUM; i++) {\n\t\tmemset(&params->pipe_ddr_ptrs[i], 0,\n\t\t       sizeof(params->pipe_ddr_ptrs[i]));\n\t\tmemset(&params->pipe_ddr_ptrs_size[i], 0,\n\t\t       sizeof(params->pipe_ddr_ptrs_size[i]));\n\t}\n\n\tmemset(ddr_ptrs, 0, sizeof(*ddr_ptrs));\n\tmemset(ddr_ptrs_size, 0, sizeof(*ddr_ptrs_size));\n\n\tparams_size = sizeof(params->uds);\n\tddr_ptrs_size->isp_param = params_size;\n\tddr_ptrs->isp_param =\n\tia_css_refcount_increment(IA_CSS_REFCOUNT_PARAM_BUFFER,\n\t\t\t\t  hmm_alloc(params_size));\n\tsucc &= (ddr_ptrs->isp_param != mmgr_NULL);\n\n\tddr_ptrs_size->macc_tbl = sizeof(struct ia_css_macc_table);\n\tddr_ptrs->macc_tbl =\n\tia_css_refcount_increment(IA_CSS_REFCOUNT_PARAM_BUFFER,\n\t\t\t\t  hmm_alloc(sizeof(struct ia_css_macc_table)));\n\tsucc &= (ddr_ptrs->macc_tbl != mmgr_NULL);\n\n\t*isp_params_out = params;\n\n\tif (!succ)\n\t\treturn -ENOMEM;\n\n\treturn 0;\n}\n\nstatic bool\nsh_css_init_isp_params_from_global(struct ia_css_stream *stream,\n\t\t\t\t   struct ia_css_isp_parameters *params,\n\t\t\t\t   bool use_default_config,\n\t\t\t\t   struct ia_css_pipe *pipe_in)\n{\n\tbool retval = true;\n\tint i = 0;\n\tbool is_dp_10bpp = true;\n\tunsigned int isp_pipe_version = ia_css_pipe_get_isp_pipe_version(\n\t\t\t\t\t    stream->pipes[0]);\n\tstruct ia_css_isp_parameters *stream_params = stream->isp_params_configs;\n\n\tif (!use_default_config && !stream_params) {\n\t\tretval = false;\n\t\tgoto exit;\n\t}\n\n\tparams->output_frame = NULL;\n\tparams->isp_parameters_id = 0;\n\n\tif (use_default_config) {\n\t\tia_css_set_xnr3_config(params, &default_xnr3_config);\n\n\t\tsh_css_set_nr_config(params, &default_nr_config);\n\t\tsh_css_set_ee_config(params, &default_ee_config);\n\t\tif (isp_pipe_version == SH_CSS_ISP_PIPE_VERSION_1)\n\t\t\tsh_css_set_macc_table(params, &default_macc_table);\n\t\telse if (isp_pipe_version == SH_CSS_ISP_PIPE_VERSION_2_2)\n\t\t\tsh_css_set_macc_table(params, &default_macc2_table);\n\t\tsh_css_set_gamma_table(params, &default_gamma_table);\n\t\tsh_css_set_ctc_table(params, &default_ctc_table);\n\t\tsh_css_set_baa_config(params, &default_baa_config);\n\t\tsh_css_set_dz_config(params, &default_dz_config);\n\t\t \n\t\tsh_css_set_shading_settings(params, &default_shading_settings);\n\t\t \n\n\t\tia_css_set_s3a_config(params, &default_3a_config);\n\t\tia_css_set_wb_config(params, &default_wb_config);\n\t\tia_css_set_csc_config(params, &default_cc_config);\n\t\tia_css_set_tnr_config(params, &default_tnr_config);\n\t\tia_css_set_ob_config(params, &default_ob_config);\n\t\tia_css_set_dp_config(params, &default_dp_config);\n\n\t\tia_css_set_param_exceptions(pipe_in, params);\n\n\t\tia_css_set_de_config(params, &default_de_config);\n\t\tia_css_set_gc_config(params, &default_gc_config);\n\t\tia_css_set_anr_config(params, &default_anr_config);\n\t\tia_css_set_anr2_config(params, &default_anr_thres);\n\t\tia_css_set_ce_config(params, &default_ce_config);\n\t\tia_css_set_xnr_table_config(params, &default_xnr_table);\n\t\tia_css_set_ecd_config(params, &default_ecd_config);\n\t\tia_css_set_ynr_config(params, &default_ynr_config);\n\t\tia_css_set_fc_config(params, &default_fc_config);\n\t\tia_css_set_cnr_config(params, &default_cnr_config);\n\t\tia_css_set_macc_config(params, &default_macc_config);\n\t\tia_css_set_ctc_config(params, &default_ctc_config);\n\t\tia_css_set_aa_config(params, &default_aa_config);\n\t\tia_css_set_r_gamma_config(params, &default_r_gamma_table);\n\t\tia_css_set_g_gamma_config(params, &default_g_gamma_table);\n\t\tia_css_set_b_gamma_config(params, &default_b_gamma_table);\n\t\tia_css_set_yuv2rgb_config(params, &default_yuv2rgb_cc_config);\n\t\tia_css_set_rgb2yuv_config(params, &default_rgb2yuv_cc_config);\n\t\tia_css_set_xnr_config(params, &default_xnr_config);\n\t\tia_css_set_sdis_config(params, &default_sdis_config);\n\t\tia_css_set_sdis2_config(params, &default_sdis2_config);\n\t\tia_css_set_formats_config(params, &default_formats_config);\n\n\t\tparams->fpn_config.data = NULL;\n\t\tparams->config_changed[IA_CSS_FPN_ID] = true;\n\t\tparams->fpn_config.enabled = 0;\n\n\t\tparams->motion_config = default_motion_config;\n\t\tparams->motion_config_changed = true;\n\n\t\tparams->morph_table = NULL;\n\t\tparams->morph_table_changed = true;\n\n\t\tparams->sc_table = NULL;\n\t\tparams->sc_table_changed = true;\n\n\t\tia_css_sdis2_clear_coefficients(&params->dvs2_coefs);\n\t\tparams->dvs2_coef_table_changed = true;\n\n\t\tia_css_sdis_clear_coefficients(&params->dvs_coefs);\n\t\tparams->dis_coef_table_changed = true;\n\t} else {\n\t\tia_css_set_xnr3_config(params, &stream_params->xnr3_config);\n\n\t\tsh_css_set_nr_config(params, &stream_params->nr_config);\n\t\tsh_css_set_ee_config(params, &stream_params->ee_config);\n\t\tif (isp_pipe_version == SH_CSS_ISP_PIPE_VERSION_1)\n\t\t\tsh_css_set_macc_table(params, &stream_params->macc_table);\n\t\telse if (isp_pipe_version == SH_CSS_ISP_PIPE_VERSION_2_2)\n\t\t\tsh_css_set_macc_table(params, &stream_params->macc_table);\n\t\tsh_css_set_gamma_table(params, &stream_params->gc_table);\n\t\tsh_css_set_ctc_table(params, &stream_params->ctc_table);\n\t\tsh_css_set_baa_config(params, &stream_params->bds_config);\n\t\tsh_css_set_dz_config(params, &stream_params->dz_config);\n\t\t \n\t\tsh_css_set_shading_settings(params, &stream_params->shading_settings);\n\t\t \n\n\t\tia_css_set_s3a_config(params, &stream_params->s3a_config);\n\t\tia_css_set_wb_config(params, &stream_params->wb_config);\n\t\tia_css_set_csc_config(params, &stream_params->cc_config);\n\t\tia_css_set_tnr_config(params, &stream_params->tnr_config);\n\t\tia_css_set_ob_config(params, &stream_params->ob_config);\n\t\tia_css_set_dp_config(params, &stream_params->dp_config);\n\t\tia_css_set_de_config(params, &stream_params->de_config);\n\t\tia_css_set_gc_config(params, &stream_params->gc_config);\n\t\tia_css_set_anr_config(params, &stream_params->anr_config);\n\t\tia_css_set_anr2_config(params, &stream_params->anr_thres);\n\t\tia_css_set_ce_config(params, &stream_params->ce_config);\n\t\tia_css_set_xnr_table_config(params, &stream_params->xnr_table);\n\t\tia_css_set_ecd_config(params, &stream_params->ecd_config);\n\t\tia_css_set_ynr_config(params, &stream_params->ynr_config);\n\t\tia_css_set_fc_config(params, &stream_params->fc_config);\n\t\tia_css_set_cnr_config(params, &stream_params->cnr_config);\n\t\tia_css_set_macc_config(params, &stream_params->macc_config);\n\t\tia_css_set_ctc_config(params, &stream_params->ctc_config);\n\t\tia_css_set_aa_config(params, &stream_params->aa_config);\n\t\tia_css_set_r_gamma_config(params, &stream_params->r_gamma_table);\n\t\tia_css_set_g_gamma_config(params, &stream_params->g_gamma_table);\n\t\tia_css_set_b_gamma_config(params, &stream_params->b_gamma_table);\n\t\tia_css_set_yuv2rgb_config(params, &stream_params->yuv2rgb_cc_config);\n\t\tia_css_set_rgb2yuv_config(params, &stream_params->rgb2yuv_cc_config);\n\t\tia_css_set_xnr_config(params, &stream_params->xnr_config);\n\t\tia_css_set_formats_config(params, &stream_params->formats_config);\n\n\t\tfor (i = 0; i < stream->num_pipes; i++) {\n\t\t\tif (0 ==\n\t\t\t    sh_css_select_dp_10bpp_config(stream->pipes[i], &is_dp_10bpp)) {\n\t\t\t\t \n\t\t\t\tretval = !is_dp_10bpp;\n\t\t\t\t \n\t\t\t} else {\n\t\t\t\tretval = false;\n\t\t\t\tgoto exit;\n\t\t\t}\n\t\t}\n\n\t\tia_css_set_param_exceptions(pipe_in, params);\n\n\t\tparams->fpn_config.data = stream_params->fpn_config.data;\n\t\tparams->config_changed[IA_CSS_FPN_ID] =\n\t\t    stream_params->config_changed[IA_CSS_FPN_ID];\n\t\tparams->fpn_config.enabled = stream_params->fpn_config.enabled;\n\n\t\tsh_css_set_motion_vector(params, &stream_params->motion_config);\n\t\tsh_css_set_morph_table(params, stream_params->morph_table);\n\n\t\tif (stream_params->sc_table) {\n\t\t\tsh_css_set_shading_table(stream, params, stream_params->sc_table);\n\t\t} else {\n\t\t\tparams->sc_table = NULL;\n\t\t\tparams->sc_table_changed = true;\n\t\t}\n\n\t\t \n\t\tfor (i = 0; i < IA_CSS_PIPE_ID_NUM; i++) {\n\t\t\tif (stream_params->pipe_dvs_6axis_config[i]) {\n\t\t\t\tif (params->pipe_dvs_6axis_config[i]) {\n\t\t\t\t\tcopy_dvs_6axis_table(params->pipe_dvs_6axis_config[i],\n\t\t\t\t\t\t\t     stream_params->pipe_dvs_6axis_config[i]);\n\t\t\t\t} else {\n\t\t\t\t\tparams->pipe_dvs_6axis_config[i] =\n\t\t\t\t\t    generate_dvs_6axis_table_from_config(stream_params->pipe_dvs_6axis_config[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tia_css_set_sdis_config(params, &stream_params->dvs_coefs);\n\t\tparams->dis_coef_table_changed = stream_params->dis_coef_table_changed;\n\n\t\tia_css_set_sdis2_config(params, &stream_params->dvs2_coefs);\n\t\tparams->dvs2_coef_table_changed = stream_params->dvs2_coef_table_changed;\n\t\tparams->sensor_binning = stream_params->sensor_binning;\n\t}\n\nexit:\n\treturn retval;\n}\n\nint\nsh_css_params_init(void)\n{\n\tint i, p;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\t \n\tg_param_buffer_dequeue_count = 0;\n\tg_param_buffer_enqueue_count = 0;\n\n\tfor (p = 0; p < IA_CSS_PIPE_ID_NUM; p++) {\n\t\tfor (i = 0; i < SH_CSS_MAX_STAGES; i++) {\n\t\t\txmem_sp_stage_ptrs[p][i] =\n\t\t\tia_css_refcount_increment(-1,\n\t\t\t\t\t\t  hmm_alloc(sizeof(struct sh_css_sp_stage)));\n\t\t\txmem_isp_stage_ptrs[p][i] =\n\t\t\tia_css_refcount_increment(-1,\n\t\t\t\t\t\t  hmm_alloc(sizeof(struct sh_css_sp_stage)));\n\n\t\t\tif ((xmem_sp_stage_ptrs[p][i] == mmgr_NULL) ||\n\t\t\t    (xmem_isp_stage_ptrs[p][i] == mmgr_NULL)) {\n\t\t\t\tsh_css_params_uninit();\n\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\t\t\treturn -ENOMEM;\n\t\t\t}\n\n\t\t\thmm_set(xmem_sp_stage_ptrs[p][i], 0, sizeof(struct sh_css_sp_stage));\n\t\t\thmm_set(xmem_isp_stage_ptrs[p][i], 0, sizeof(struct sh_css_sp_stage));\n\t\t}\n\t}\n\n\tia_css_config_gamma_table();\n\tia_css_config_ctc_table();\n\tia_css_config_rgb_gamma_tables();\n\tia_css_config_xnr_table();\n\n\tsp_ddr_ptrs = ia_css_refcount_increment(-1,\n\t\t\t\t\t\thmm_alloc(CEIL_MUL(sizeof(struct sh_css_ddr_address_map),\n\t\t\t\t\t\t\t\t   HIVE_ISP_DDR_WORD_BYTES)));\n\txmem_sp_group_ptrs = ia_css_refcount_increment(-1,\n\t\t\t\t\t\t       hmm_alloc(sizeof(struct sh_css_sp_group)));\n\n\tif ((sp_ddr_ptrs == mmgr_NULL) ||\n\t    (xmem_sp_group_ptrs == mmgr_NULL)) {\n\t\tia_css_uninit();\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\treturn -ENOMEM;\n\t}\n\thmm_set(sp_ddr_ptrs, 0, CEIL_MUL(sizeof(struct sh_css_ddr_address_map),\n\t\t\t\t\t HIVE_ISP_DDR_WORD_BYTES));\n\thmm_set(xmem_sp_group_ptrs, 0, sizeof(struct sh_css_sp_group));\n\tIA_CSS_LEAVE_ERR_PRIVATE(0);\n\treturn 0;\n}\n\nstatic void host_lut_store(const void *lut)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < N_GDC_ID; i++)\n\t\tgdc_lut_store((gdc_ID_t)i, (const int (*)[HRT_GDC_N]) lut);\n}\n\nint ia_css_pipe_set_bci_scaler_lut(struct ia_css_pipe *pipe,\n\tconst void *lut)\n{\n\tint err = 0;\n\tbool stream_started = false;\n\n\tIA_CSS_ENTER(\"pipe=%p lut=%p\", pipe, lut);\n\n\tif (!lut || !pipe) {\n\t\terr = -EINVAL;\n\t\tIA_CSS_LEAVE(\"err=%d\", err);\n\t\treturn err;\n\t}\n\n\t \n\tif (pipe->stream && pipe->stream->started) {\n\t\tia_css_debug_dtrace(IA_CSS_DEBUG_ERROR,\n\t\t\t\t    \"unable to set scaler lut since stream has started\\n\");\n\t\tstream_started = true;\n\t\terr = -ENOTSUPP;\n\t}\n\n\t \n\tif (pipe->scaler_pp_lut != mmgr_NULL) {\n\t\thmm_free(pipe->scaler_pp_lut);\n\t\tpipe->scaler_pp_lut = mmgr_NULL;\n\t}\n\n\tif (!stream_started) {\n\t\tpipe->scaler_pp_lut = hmm_alloc(sizeof(zoom_table));\n\n\t\tif (pipe->scaler_pp_lut == mmgr_NULL) {\n\t\t\tia_css_debug_dtrace(IA_CSS_DEBUG_ERROR,\n\t\t\t\t\t    \"unable to allocate scaler_pp_lut\\n\");\n\t\t\terr = -ENOMEM;\n\t\t} else {\n\t\t\tgdc_lut_convert_to_isp_format((const int(*)[HRT_GDC_N])lut,\n\t\t\t\t\t\t      interleaved_lut_temp);\n\t\t\thmm_store(pipe->scaler_pp_lut,\n\t\t\t\t   (int *)interleaved_lut_temp,\n\t\t\t\t   sizeof(zoom_table));\n\t\t}\n\t}\n\n\tIA_CSS_LEAVE(\"lut(%u) err=%d\", pipe->scaler_pp_lut, err);\n\treturn err;\n}\n\n \nia_css_ptr sh_css_pipe_get_pp_gdc_lut(const struct ia_css_pipe *pipe)\n{\n\tassert(pipe);\n\n\tif (pipe->scaler_pp_lut != mmgr_NULL)\n\t\treturn pipe->scaler_pp_lut;\n\telse\n\t\treturn sh_css_params_get_default_gdc_lut();\n}\n\nint sh_css_params_map_and_store_default_gdc_lut(void)\n{\n\tint err = 0;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\t \n\tif (default_gdc_lut != mmgr_NULL)\n\t\treturn err;\n\n\thost_lut_store((void *)zoom_table);\n\n\tdefault_gdc_lut = hmm_alloc(sizeof(zoom_table));\n\n\tif (default_gdc_lut == mmgr_NULL)\n\t\treturn -ENOMEM;\n\n\tgdc_lut_convert_to_isp_format((const int(*)[HRT_GDC_N])zoom_table,\n\t\t\t\t      interleaved_lut_temp);\n\thmm_store(default_gdc_lut, (int *)interleaved_lut_temp,\n\t\t   sizeof(zoom_table));\n\n\tIA_CSS_LEAVE_PRIVATE(\"lut(%u) err=%d\", default_gdc_lut, err);\n\treturn err;\n}\n\nvoid sh_css_params_free_default_gdc_lut(void)\n{\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tif (default_gdc_lut != mmgr_NULL) {\n\t\thmm_free(default_gdc_lut);\n\t\tdefault_gdc_lut = mmgr_NULL;\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nia_css_ptr sh_css_params_get_default_gdc_lut(void)\n{\n\treturn default_gdc_lut;\n}\n\nstatic void free_param_set_callback(\n    ia_css_ptr ptr)\n{\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tfree_ia_css_isp_parameter_set_info(ptr);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void free_buffer_callback(\n    ia_css_ptr ptr)\n{\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\thmm_free(ptr);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid\nsh_css_param_clear_param_sets(void)\n{\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tia_css_refcount_clear(IA_CSS_REFCOUNT_PARAM_SET_POOL, &free_param_set_callback);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\n \n#define safe_free(id, x)      \\\n\tdo {                  \\\n\t\tia_css_refcount_decrement(id, x);     \\\n\t\t(x) = mmgr_NULL;  \\\n\t} while (0)\n\nstatic void free_map(struct sh_css_ddr_address_map *map)\n{\n\tunsigned int i;\n\n\tia_css_ptr *addrs = (ia_css_ptr *)map;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\t \n\tfor (i = 0; i < (sizeof(struct sh_css_ddr_address_map_size) /\n\t\t\t sizeof(size_t)); i++) {\n\t\tif (addrs[i] == mmgr_NULL)\n\t\t\tcontinue;\n\t\tsafe_free(IA_CSS_REFCOUNT_PARAM_BUFFER, addrs[i]);\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid\nia_css_stream_isp_parameters_uninit(struct ia_css_stream *stream)\n{\n\tint i;\n\tstruct ia_css_isp_parameters *params = stream->isp_params_configs;\n\tstruct ia_css_isp_parameters *per_frame_params =\n\t\t    stream->per_frame_isp_params_configs;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\tif (!params) {\n\t\tIA_CSS_LEAVE_PRIVATE(\"isp_param_configs is NULL\");\n\t\treturn;\n\t}\n\n\t \n\tfor (i = 0; i < IA_CSS_PIPE_ID_NUM; i++) {\n\t\tfree_map(&params->pipe_ddr_ptrs[i]);\n\t\tif (per_frame_params)\n\t\t\tfree_map(&per_frame_params->pipe_ddr_ptrs[i]);\n\t\t \n\t\tif (params->pipe_dvs_6axis_config[i])\n\t\t\tfree_dvs_6axis_table(&params->pipe_dvs_6axis_config[i]);\n\t\tif (per_frame_params && per_frame_params->pipe_dvs_6axis_config[i])\n\t\t\tfree_dvs_6axis_table(&per_frame_params->pipe_dvs_6axis_config[i]);\n\t}\n\tfree_map(&params->ddr_ptrs);\n\tif (per_frame_params)\n\t\tfree_map(&per_frame_params->ddr_ptrs);\n\n\tif (params->fpn_config.data) {\n\t\tkvfree(params->fpn_config.data);\n\t\tparams->fpn_config.data = NULL;\n\t}\n\n\t \n\tif (params->sc_config) {\n\t\tia_css_shading_table_free(params->sc_config);\n\t\tparams->sc_config = NULL;\n\t}\n\tif (per_frame_params) {\n\t\tif (per_frame_params->sc_config) {\n\t\t\tia_css_shading_table_free(per_frame_params->sc_config);\n\t\t\tper_frame_params->sc_config = NULL;\n\t\t}\n\t}\n\n\tkvfree(params);\n\tkvfree(per_frame_params);\n\tstream->isp_params_configs = NULL;\n\tstream->per_frame_isp_params_configs = NULL;\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid\nsh_css_params_uninit(void)\n{\n\tunsigned int p, i;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tia_css_refcount_decrement(-1, sp_ddr_ptrs);\n\tsp_ddr_ptrs = mmgr_NULL;\n\tia_css_refcount_decrement(-1, xmem_sp_group_ptrs);\n\txmem_sp_group_ptrs = mmgr_NULL;\n\n\tfor (p = 0; p < IA_CSS_PIPE_ID_NUM; p++)\n\t\tfor (i = 0; i < SH_CSS_MAX_STAGES; i++) {\n\t\t\tia_css_refcount_decrement(-1, xmem_sp_stage_ptrs[p][i]);\n\t\t\txmem_sp_stage_ptrs[p][i] = mmgr_NULL;\n\t\t\tia_css_refcount_decrement(-1, xmem_isp_stage_ptrs[p][i]);\n\t\t\txmem_isp_stage_ptrs[p][i] = mmgr_NULL;\n\t\t}\n\n\t \n\tia_css_refcount_clear(IA_CSS_REFCOUNT_PARAM_SET_POOL, &free_param_set_callback);\n\tia_css_refcount_clear(IA_CSS_REFCOUNT_PARAM_BUFFER, &free_buffer_callback);\n\tia_css_refcount_clear(-1, &free_buffer_callback);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic struct ia_css_host_data *\nconvert_allocate_morph_plane(\n    unsigned short *data,\n    unsigned int width,\n    unsigned int height,\n    unsigned int aligned_width)\n{\n\tunsigned int i, j, padding, w;\n\tstruct ia_css_host_data *me;\n\tunsigned int isp_data_size;\n\tu16 *isp_data_ptr;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\t \n\tif (width > aligned_width) {\n\t\tpadding = 0;\n\t\tw = aligned_width;\n\t} else {\n\t\tpadding = aligned_width - width;\n\t\tw = width;\n\t}\n\tisp_data_size = height * (w + padding) * sizeof(uint16_t);\n\n\tme = ia_css_host_data_allocate((size_t)isp_data_size);\n\n\tif (!me) {\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\treturn NULL;\n\t}\n\n\tisp_data_ptr = (uint16_t *)me->address;\n\n\tmemset(isp_data_ptr, 0, (size_t)isp_data_size);\n\n\tfor (i = 0; i < height; i++) {\n\t\tfor (j = 0; j < w; j++)\n\t\t\t*isp_data_ptr++ = (uint16_t)data[j];\n\t\tisp_data_ptr += padding;\n\t\tdata += width;\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\treturn me;\n}\n\nstatic int\nstore_morph_plane(\n    unsigned short *data,\n    unsigned int width,\n    unsigned int height,\n    ia_css_ptr dest,\n    unsigned int aligned_width)\n{\n\tstruct ia_css_host_data *isp_data;\n\n\tassert(dest != mmgr_NULL);\n\n\tisp_data = convert_allocate_morph_plane(data, width, height, aligned_width);\n\tif (!isp_data) {\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\treturn -ENOMEM;\n\t}\n\tia_css_params_store_ia_css_host_data(dest, isp_data);\n\n\tia_css_host_data_free(isp_data);\n\treturn 0;\n}\n\nstatic void sh_css_update_isp_params_to_ddr(\n    struct ia_css_isp_parameters *params,\n    ia_css_ptr ddr_ptr)\n{\n\tsize_t size = sizeof(params->uds);\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tassert(params);\n\n\thmm_store(ddr_ptr, &params->uds, size);\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void sh_css_update_isp_mem_params_to_ddr(\n    const struct ia_css_binary *binary,\n    ia_css_ptr ddr_mem_ptr,\n    size_t size,\n    enum ia_css_isp_memories mem)\n{\n\tconst struct ia_css_host_data *params;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tparams = ia_css_isp_param_get_mem_init(&binary->mem_params,\n\t\t\t\t\t       IA_CSS_PARAM_CLASS_PARAM, mem);\n\thmm_store(ddr_mem_ptr, params->address, size);\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid ia_css_dequeue_param_buffers(  void)\n{\n\tunsigned int i;\n\tia_css_ptr cpy;\n\tenum sh_css_queue_id param_queue_ids[3] = {\tIA_CSS_PARAMETER_SET_QUEUE_ID,\n\t\t\t\t\t\t    IA_CSS_PER_FRAME_PARAMETER_SET_QUEUE_ID,\n\t\t\t\t\t\t    SH_CSS_INVALID_QUEUE_ID\n\t\t\t\t\t\t  };\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tif (!sh_css_sp_is_running()) {\n\t\tIA_CSS_LEAVE_PRIVATE(\"sp is not running\");\n\t\t \n\t\treturn;\n\t}\n\n\tfor (i = 0; SH_CSS_INVALID_QUEUE_ID != param_queue_ids[i]; i++) {\n\t\tcpy = (ia_css_ptr)0;\n\t\t \n\t\twhile (ia_css_bufq_dequeue_buffer(param_queue_ids[i],\n\t\t\t\t\t\t  (uint32_t *)&cpy) == 0) {\n\t\t\t \n\t\t\tg_param_buffer_dequeue_count++;\n\t\t\tia_css_bufq_enqueue_psys_event(\n\t\t\t    IA_CSS_PSYS_SW_EVENT_BUFFER_DEQUEUED,\n\t\t\t    0,\n\t\t\t    param_queue_ids[i],\n\t\t\t    0);\n\n\t\t\tIA_CSS_LOG(\"dequeued param set %x from %d, release ref\", cpy, 0);\n\t\t\tfree_ia_css_isp_parameter_set_info(cpy);\n\t\t\tcpy = (ia_css_ptr)0;\n\t\t}\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic void\nprocess_kernel_parameters(unsigned int pipe_id,\n\t\t\t  struct ia_css_pipeline_stage *stage,\n\t\t\t  struct ia_css_isp_parameters *params,\n\t\t\t  unsigned int isp_pipe_version,\n\t\t\t  unsigned int raw_bit_depth)\n{\n\tunsigned int param_id;\n\n\t(void)isp_pipe_version;\n\t(void)raw_bit_depth;\n\n\tsh_css_enable_pipeline(stage->binary);\n\n\tif (params->config_changed[IA_CSS_OB_ID]) {\n\t\tia_css_ob_configure(&params->stream_configs.ob,\n\t\t\t\t    isp_pipe_version, raw_bit_depth);\n\t}\n\tif (params->config_changed[IA_CSS_S3A_ID]) {\n\t\tia_css_s3a_configure(raw_bit_depth);\n\t}\n\t \n\tparams->crop_config.crop_pos = params->uds[stage->stage_num].crop_pos;\n\tparams->uds_config.crop_pos  = params->uds[stage->stage_num].crop_pos;\n\tparams->uds_config.uds       = params->uds[stage->stage_num].uds;\n\t \n\t \n\tfor (param_id = 0; param_id < IA_CSS_NUM_PARAMETER_IDS; param_id++) {\n\t\tif (param_id == IA_CSS_SC_ID) continue;\n\t\tif (params->config_changed[param_id])\n\t\t\tia_css_kernel_process_param[param_id](pipe_id, stage, params);\n\t}\n}\n\nint\nsh_css_param_update_isp_params(struct ia_css_pipe *curr_pipe,\n\t\t\t       struct ia_css_isp_parameters *params,\n\t\t\t       bool commit,\n\t\t\t       struct ia_css_pipe *pipe_in)\n{\n\tint err = 0;\n\tia_css_ptr cpy;\n\tint i;\n\tunsigned int raw_bit_depth = 10;\n\tunsigned int isp_pipe_version = SH_CSS_ISP_PIPE_VERSION_1;\n\tbool acc_cluster_params_changed = false;\n\tunsigned int thread_id, pipe_num;\n\n\t(void)acc_cluster_params_changed;\n\n\tassert(curr_pipe);\n\n\tIA_CSS_ENTER_PRIVATE(\"pipe=%p, isp_parameters_id=%d\", pipe_in, params->isp_parameters_id);\n\traw_bit_depth = ia_css_stream_input_format_bits_per_pixel(curr_pipe->stream);\n\n\t \n\tif (!commit) {\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\treturn err;\n\t}\n\t \n\tfor (i = 0; i < curr_pipe->stream->num_pipes; i++) {\n\t\tstruct ia_css_pipe *pipe;\n\t\tstruct sh_css_ddr_address_map *cur_map;\n\t\tstruct sh_css_ddr_address_map_size *cur_map_size;\n\t\tstruct ia_css_isp_parameter_set_info isp_params_info;\n\t\tstruct ia_css_pipeline *pipeline;\n\t\tstruct ia_css_pipeline_stage *stage;\n\n\t\tenum sh_css_queue_id queue_id;\n\n\t\tpipe = curr_pipe->stream->pipes[i];\n\t\tpipeline = ia_css_pipe_get_pipeline(pipe);\n\t\tpipe_num = ia_css_pipe_get_pipe_num(pipe);\n\t\tisp_pipe_version = ia_css_pipe_get_isp_pipe_version(pipe);\n\t\tia_css_pipeline_get_sp_thread_id(pipe_num, &thread_id);\n\n\t\tia_css_query_internal_queue_id(params->output_frame\n\t\t\t\t\t       ? IA_CSS_BUFFER_TYPE_PER_FRAME_PARAMETER_SET\n\t\t\t\t\t       : IA_CSS_BUFFER_TYPE_PARAMETER_SET,\n\t\t\t\t\t       thread_id, &queue_id);\n\t\tif (!sh_css_sp_is_running()) {\n\t\t\t \n\t\t\terr = -EBUSY;\n\t\t\tbreak;\n\t\t}\n\t\tcur_map = &params->pipe_ddr_ptrs[pipeline->pipe_id];\n\t\tcur_map_size = &params->pipe_ddr_ptrs_size[pipeline->pipe_id];\n\n\t\t \n\t\t{\n\t\t\t \n\t\t\t \n\t\t\terr = ia_css_process_zoom_and_motion(params,\n\t\t\t\t\t\t\t     pipeline->stages);\n\t\t\tif (err)\n\t\t\t\treturn err;\n\t\t}\n\t\t \n\t\t \n\t\tif (pipe_in && (pipe != pipe_in)) {\n\t\t\tIA_CSS_LOG(\"skipping pipe %p\", pipe);\n\t\t\tcontinue;\n\t\t}\n\n\t\t \n\t\t \n\t\tfor (stage = pipeline->stages; stage; stage = stage->next) {\n\t\t\tunsigned int mem;\n\n\t\t\tif (!stage || !stage->binary)\n\t\t\t\tcontinue;\n\n\t\t\tprocess_kernel_parameters(pipeline->pipe_id,\n\t\t\t\t\t\t  stage, params,\n\t\t\t\t\t\t  isp_pipe_version, raw_bit_depth);\n\n\t\t\terr = sh_css_params_write_to_ddr_internal(\n\t\t\t\t  pipe,\n\t\t\t\t  pipeline->pipe_id,\n\t\t\t\t  params,\n\t\t\t\t  stage,\n\t\t\t\t  cur_map,\n\t\t\t\t  cur_map_size);\n\n\t\t\tif (err)\n\t\t\t\tbreak;\n\t\t\tfor (mem = 0; mem < IA_CSS_NUM_MEMORIES; mem++) {\n\t\t\t\tparams->isp_mem_params_changed\n\t\t\t\t[pipeline->pipe_id][stage->stage_num][mem] = false;\n\t\t\t}\n\t\t}  \n\t\tif (err)\n\t\t\tbreak;\n\t\t \n\t\tif (params->isp_params_changed) {\n\t\t\treallocate_buffer(&cur_map->isp_param,\n\t\t\t\t\t  &cur_map_size->isp_param,\n\t\t\t\t\t  cur_map_size->isp_param,\n\t\t\t\t\t  true,\n\t\t\t\t\t  &err);\n\t\t\tif (err)\n\t\t\t\tbreak;\n\t\t\tsh_css_update_isp_params_to_ddr(params, cur_map->isp_param);\n\t\t}\n\n\t\t \n\t\terr = ref_sh_css_ddr_address_map(\n\t\t\t  cur_map,\n\t\t\t  &isp_params_info.mem_map);\n\t\tif (err)\n\t\t\tbreak;\n\n\t\t \n\t\tisp_params_info.isp_parameters_id = params->isp_parameters_id;\n\n\t\t \n\t\tisp_params_info.output_frame_ptr =\n\t\t    (params->output_frame) ? params->output_frame->data : mmgr_NULL;\n\n\t\t \n\t\terr = write_ia_css_isp_parameter_set_info_to_ddr(&isp_params_info, &cpy);\n\t\tif (err)\n\t\t\tbreak;\n\n\t\t \n\t\tIA_CSS_LOG(\"queue param set %x to %d\", cpy, thread_id);\n\n\t\terr = ia_css_bufq_enqueue_buffer(thread_id, queue_id, (uint32_t)cpy);\n\t\tif (err) {\n\t\t\tfree_ia_css_isp_parameter_set_info(cpy);\n\t\t\tIA_CSS_LOG(\"pfp: FAILED to add config id %d for OF %d to q %d on thread %d\",\n\t\t\t\t   isp_params_info.isp_parameters_id,\n\t\t\t\t   isp_params_info.output_frame_ptr,\n\t\t\t\t   queue_id, thread_id);\n\t\t\tbreak;\n\t\t} else {\n\t\t\t \n\t\t\tg_param_buffer_enqueue_count++;\n\t\t\tassert(g_param_buffer_enqueue_count < g_param_buffer_dequeue_count + 50);\n\t\t\t \n\t\t\tif (!sh_css_sp_is_running()) {\n\t\t\t\t \n\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(-EBUSY);\n\t\t\t\treturn -EBUSY;\n\t\t\t}\n\t\t\tia_css_bufq_enqueue_psys_event(\n\t\t\t    IA_CSS_PSYS_SW_EVENT_BUFFER_ENQUEUED,\n\t\t\t    (uint8_t)thread_id,\n\t\t\t    (uint8_t)queue_id,\n\t\t\t    0);\n\t\t\tIA_CSS_LOG(\"pfp: added config id %d for OF %d to q %d on thread %d\",\n\t\t\t\t   isp_params_info.isp_parameters_id,\n\t\t\t\t   isp_params_info.output_frame_ptr,\n\t\t\t\t   queue_id, thread_id);\n\t\t}\n\t\t \n\t\tia_css_dequeue_param_buffers( );\n\t\tparams->pipe_dvs_6axis_config_changed[pipeline->pipe_id] = false;\n\t}  \n\t \n\tparams->isp_params_changed = false;\n\tparams->sc_table_changed = false;\n\tparams->dis_coef_table_changed = false;\n\tparams->dvs2_coef_table_changed = false;\n\tparams->morph_table_changed = false;\n\tparams->dz_config_changed = false;\n\tparams->motion_config_changed = false;\n\t \n\tparams->shading_settings_changed = false;\n\t \n\n\tmemset(&params->config_changed[0], 0, sizeof(params->config_changed));\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nstatic int\nsh_css_params_write_to_ddr_internal(\n    struct ia_css_pipe *pipe,\n    unsigned int pipe_id,\n    struct ia_css_isp_parameters *params,\n    const struct ia_css_pipeline_stage *stage,\n    struct sh_css_ddr_address_map *ddr_map,\n    struct sh_css_ddr_address_map_size *ddr_map_size)\n{\n\tint err;\n\tconst struct ia_css_binary *binary;\n\n\tunsigned int stage_num;\n\tunsigned int mem;\n\tbool buff_realloced;\n\n\t \n\tstatic struct ia_css_macc_table converted_macc_table;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\tassert(params);\n\tassert(ddr_map);\n\tassert(ddr_map_size);\n\tassert(stage);\n\n\tbinary = stage->binary;\n\tassert(binary);\n\n\tstage_num = stage->stage_num;\n\n\tif (binary->info->sp.enable.fpnr) {\n\t\tbuff_realloced = reallocate_buffer(&ddr_map->fpn_tbl,\n\t\t\t\t\t\t   &ddr_map_size->fpn_tbl,\n\t\t\t\t\t\t   fpntbl_bytes(binary),\n\t\t\t\t\t\t   params->config_changed[IA_CSS_FPN_ID],\n\t\t\t\t\t\t   &err);\n\t\tif (err) {\n\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\treturn err;\n\t\t}\n\t\tif (params->config_changed[IA_CSS_FPN_ID] || buff_realloced) {\n\t\t\tif (params->fpn_config.enabled) {\n\t\t\t\terr = store_fpntbl(params, ddr_map->fpn_tbl);\n\t\t\t\tif (err) {\n\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\t\t\treturn err;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (binary->info->sp.enable.sc) {\n\t\tu32 enable_conv;\n\n\t\tenable_conv = params->shading_settings.enable_shading_table_conversion;\n\n\t\tbuff_realloced = reallocate_buffer(&ddr_map->sc_tbl,\n\t\t\t\t\t\t   &ddr_map_size->sc_tbl,\n\t\t\t\t\t\t   sctbl_bytes(binary),\n\t\t\t\t\t\t   params->sc_table_changed,\n\t\t\t\t\t\t   &err);\n\t\tif (err) {\n\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\treturn err;\n\t\t}\n\n\t\tif (params->shading_settings_changed ||\n\t\t    params->sc_table_changed || buff_realloced) {\n\t\t\tif (enable_conv == 0) {\n\t\t\t\tif (params->sc_table) {\n\t\t\t\t\t \n\t\t\t\t\terr = ia_css_params_store_sctbl(stage, ddr_map->sc_tbl, params->sc_table);\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\t\t\t\treturn err;\n\t\t\t\t\t}\n\t\t\t\t\t \n\t\t\t\t\tparams->sc_config = (struct ia_css_shading_table *)params->sc_table;\n\t\t\t\t\tia_css_kernel_process_param[IA_CSS_SC_ID](pipe_id, stage, params);\n\t\t\t\t\tparams->sc_config = NULL;\n\t\t\t\t} else {\n\t\t\t\t\t \n\t\t\t\t\tif (params->sc_config) {\n\t\t\t\t\t\tia_css_shading_table_free(params->sc_config);\n\t\t\t\t\t\tparams->sc_config = NULL;\n\t\t\t\t\t}\n\t\t\t\t\tsh_css_params_shading_id_table_generate(&params->sc_config,\n\t\t\t\t\t\t\t\t\t\tbinary->sctbl_width_per_color,\n\t\t\t\t\t\t\t\t\t\tbinary->sctbl_height);\n\t\t\t\t\tif (!params->sc_config) {\n\t\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t\t}\n\n\t\t\t\t\t \n\t\t\t\t\terr = ia_css_params_store_sctbl(stage, ddr_map->sc_tbl, params->sc_config);\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\t\t\t\treturn err;\n\t\t\t\t\t}\n\n\t\t\t\t\t \n\t\t\t\t\tia_css_kernel_process_param[IA_CSS_SC_ID](pipe_id, stage, params);\n\n\t\t\t\t\t \n\t\t\t\t\tia_css_shading_table_free(params->sc_config);\n\t\t\t\t\tparams->sc_config = NULL;\n\t\t\t\t}\n\t\t\t} else {  \n\t\t\t\t \n\t\t\t\t \n\t\t\t\tif (params->sc_config) {\n\t\t\t\t\tia_css_shading_table_free(params->sc_config);\n\t\t\t\t\tparams->sc_config = NULL;\n\t\t\t\t}\n\t\t\t\tprepare_shading_table(\n\t\t\t\t    (const struct ia_css_shading_table *)params->sc_table,\n\t\t\t\t    params->sensor_binning,\n\t\t\t\t    &params->sc_config,\n\t\t\t\t    binary, pipe->required_bds_factor);\n\t\t\t\tif (!params->sc_config) {\n\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\n\t\t\t\t \n\t\t\t\terr = ia_css_params_store_sctbl(stage, ddr_map->sc_tbl, params->sc_config);\n\t\t\t\tif (err) {\n\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\t\t\treturn err;\n\t\t\t\t}\n\n\t\t\t\t \n\t\t\t\tia_css_kernel_process_param[IA_CSS_SC_ID](pipe_id, stage, params);\n\n\t\t\t\t \n\t\t\t\tia_css_shading_table_free(params->sc_config);\n\t\t\t\tparams->sc_config = NULL;\n\t\t\t\t \n\t\t\t}\n\t\t}\n\t}\n\n\tif (params->config_changed[IA_CSS_MACC_ID] && binary->info->sp.enable.macc) {\n\t\tunsigned int i, j, idx;\n\t\tstatic const unsigned int idx_map[] = {\n\t\t\t0, 1, 3, 2, 6, 7, 5, 4, 12, 13, 15, 14, 10, 11, 9, 8\n\t\t};\n\n\t\tfor (i = 0; i < IA_CSS_MACC_NUM_AXES; i++) {\n\t\t\tidx = 4 * idx_map[i];\n\t\t\tj   = 4 * i;\n\n\t\t\tif (binary->info->sp.pipeline.isp_pipe_version == SH_CSS_ISP_PIPE_VERSION_1) {\n\t\t\t\tconverted_macc_table.data[idx] =\n\t\t\t\t    (int16_t)sDIGIT_FITTING(params->macc_table.data[j],\n\t\t\t\t\t\t\t    13, SH_CSS_MACC_COEF_SHIFT);\n\t\t\t\tconverted_macc_table.data[idx + 1] =\n\t\t\t\t    (int16_t)sDIGIT_FITTING(params->macc_table.data[j + 1],\n\t\t\t\t\t\t\t    13, SH_CSS_MACC_COEF_SHIFT);\n\t\t\t\tconverted_macc_table.data[idx + 2] =\n\t\t\t\t    (int16_t)sDIGIT_FITTING(params->macc_table.data[j + 2],\n\t\t\t\t\t\t\t    13, SH_CSS_MACC_COEF_SHIFT);\n\t\t\t\tconverted_macc_table.data[idx + 3] =\n\t\t\t\t    (int16_t)sDIGIT_FITTING(params->macc_table.data[j + 3],\n\t\t\t\t\t\t\t    13, SH_CSS_MACC_COEF_SHIFT);\n\t\t\t} else if (binary->info->sp.pipeline.isp_pipe_version ==\n\t\t\t\t   SH_CSS_ISP_PIPE_VERSION_2_2) {\n\t\t\t\tconverted_macc_table.data[idx] =\n\t\t\t\t    params->macc_table.data[j];\n\t\t\t\tconverted_macc_table.data[idx + 1] =\n\t\t\t\t    params->macc_table.data[j + 1];\n\t\t\t\tconverted_macc_table.data[idx + 2] =\n\t\t\t\t    params->macc_table.data[j + 2];\n\t\t\t\tconverted_macc_table.data[idx + 3] =\n\t\t\t\t    params->macc_table.data[j + 3];\n\t\t\t}\n\t\t}\n\t\treallocate_buffer(&ddr_map->macc_tbl,\n\t\t\t\t  &ddr_map_size->macc_tbl,\n\t\t\t\t  ddr_map_size->macc_tbl,\n\t\t\t\t  true,\n\t\t\t\t  &err);\n\t\tif (err) {\n\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\treturn err;\n\t\t}\n\t\thmm_store(ddr_map->macc_tbl,\n\t\t\t   converted_macc_table.data,\n\t\t\t   sizeof(converted_macc_table.data));\n\t}\n\n\tif (binary->info->sp.enable.dvs_6axis) {\n\t\t \n\t\tbuff_realloced = reallocate_buffer(\n\t\t\t\t     &ddr_map->dvs_6axis_params_y,\n\t\t\t\t     &ddr_map_size->dvs_6axis_params_y,\n\t\t\t\t     (size_t)((DVS_6AXIS_BYTES(binary) / 2) * 3),\n\t\t\t\t     params->pipe_dvs_6axis_config_changed[pipe_id],\n\t\t\t\t     &err);\n\t\tif (err) {\n\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\treturn err;\n\t\t}\n\n\t\tif (params->pipe_dvs_6axis_config_changed[pipe_id] || buff_realloced) {\n\t\t\tconst struct ia_css_frame_info *dvs_in_frame_info;\n\n\t\t\tif (stage->args.delay_frames[0]) {\n\t\t\t\t \n\t\t\t\tdvs_in_frame_info = &stage->args.delay_frames[0]->frame_info;\n\t\t\t} else {\n\t\t\t\t \n\t\t\t\tdvs_in_frame_info = &stage->args.in_frame->frame_info;\n\t\t\t}\n\n\t\t\t \n\t\t\tif (!params->pipe_dvs_6axis_config[pipe_id]) {\n\t\t\t\tstruct ia_css_resolution dvs_offset = {0};\n\n\t\t\t\tdvs_offset.width = (PIX_SHIFT_FILTER_RUN_IN_X + binary->dvs_envelope.width) / 2;\n\t\t\t\tdvs_offset.height = (PIX_SHIFT_FILTER_RUN_IN_Y + binary->dvs_envelope.height) / 2;\n\n\t\t\t\tparams->pipe_dvs_6axis_config[pipe_id] =\n\t\t\t\t    generate_dvs_6axis_table(&binary->out_frame_info[0].res, &dvs_offset);\n\t\t\t\tif (!params->pipe_dvs_6axis_config[pipe_id]) {\n\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(-ENOMEM);\n\t\t\t\t\treturn -ENOMEM;\n\t\t\t\t}\n\t\t\t\tparams->pipe_dvs_6axis_config_changed[pipe_id] = true;\n\n\t\t\t\tstore_dvs_6axis_config(params->pipe_dvs_6axis_config[pipe_id],\n\t\t\t\t\t\t    binary,\n\t\t\t\t\t\t    dvs_in_frame_info,\n\t\t\t\t\t\t    ddr_map->dvs_6axis_params_y);\n\t\t\t\tparams->isp_params_changed = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (binary->info->sp.enable.ca_gdc) {\n\t\tunsigned int i;\n\t\tia_css_ptr *virt_addr_tetra_x[\n\n\t\tIA_CSS_MORPH_TABLE_NUM_PLANES];\n\t\tsize_t *virt_size_tetra_x[\n\n\t\tIA_CSS_MORPH_TABLE_NUM_PLANES];\n\t\tia_css_ptr *virt_addr_tetra_y[\n\n\t\tIA_CSS_MORPH_TABLE_NUM_PLANES];\n\t\tsize_t *virt_size_tetra_y[\n\n\t\tIA_CSS_MORPH_TABLE_NUM_PLANES];\n\n\t\tvirt_addr_tetra_x[0] = &ddr_map->tetra_r_x;\n\t\tvirt_addr_tetra_x[1] = &ddr_map->tetra_gr_x;\n\t\tvirt_addr_tetra_x[2] = &ddr_map->tetra_gb_x;\n\t\tvirt_addr_tetra_x[3] = &ddr_map->tetra_b_x;\n\t\tvirt_addr_tetra_x[4] = &ddr_map->tetra_ratb_x;\n\t\tvirt_addr_tetra_x[5] = &ddr_map->tetra_batr_x;\n\n\t\tvirt_size_tetra_x[0] = &ddr_map_size->tetra_r_x;\n\t\tvirt_size_tetra_x[1] = &ddr_map_size->tetra_gr_x;\n\t\tvirt_size_tetra_x[2] = &ddr_map_size->tetra_gb_x;\n\t\tvirt_size_tetra_x[3] = &ddr_map_size->tetra_b_x;\n\t\tvirt_size_tetra_x[4] = &ddr_map_size->tetra_ratb_x;\n\t\tvirt_size_tetra_x[5] = &ddr_map_size->tetra_batr_x;\n\n\t\tvirt_addr_tetra_y[0] = &ddr_map->tetra_r_y;\n\t\tvirt_addr_tetra_y[1] = &ddr_map->tetra_gr_y;\n\t\tvirt_addr_tetra_y[2] = &ddr_map->tetra_gb_y;\n\t\tvirt_addr_tetra_y[3] = &ddr_map->tetra_b_y;\n\t\tvirt_addr_tetra_y[4] = &ddr_map->tetra_ratb_y;\n\t\tvirt_addr_tetra_y[5] = &ddr_map->tetra_batr_y;\n\n\t\tvirt_size_tetra_y[0] = &ddr_map_size->tetra_r_y;\n\t\tvirt_size_tetra_y[1] = &ddr_map_size->tetra_gr_y;\n\t\tvirt_size_tetra_y[2] = &ddr_map_size->tetra_gb_y;\n\t\tvirt_size_tetra_y[3] = &ddr_map_size->tetra_b_y;\n\t\tvirt_size_tetra_y[4] = &ddr_map_size->tetra_ratb_y;\n\t\tvirt_size_tetra_y[5] = &ddr_map_size->tetra_batr_y;\n\n\t\tbuff_realloced = false;\n\t\tfor (i = 0; i < IA_CSS_MORPH_TABLE_NUM_PLANES; i++) {\n\t\t\tbuff_realloced |=\n\t\t\t    reallocate_buffer(virt_addr_tetra_x[i],\n\t\t\t\t\t    virt_size_tetra_x[i],\n\t\t\t\t\t    morph_plane_bytes(binary),\n\t\t\t\t\t    params->morph_table_changed,\n\t\t\t\t\t    &err);\n\t\t\tif (err) {\n\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\t\treturn err;\n\t\t\t}\n\t\t\tbuff_realloced |=\n\t\t\t    reallocate_buffer(virt_addr_tetra_y[i],\n\t\t\t\t\t    virt_size_tetra_y[i],\n\t\t\t\t\t    morph_plane_bytes(binary),\n\t\t\t\t\t    params->morph_table_changed,\n\t\t\t\t\t    &err);\n\t\t\tif (err) {\n\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\t\treturn err;\n\t\t\t}\n\t\t}\n\t\tif (params->morph_table_changed || buff_realloced) {\n\t\t\tconst struct ia_css_morph_table *table = params->morph_table;\n\t\t\tstruct ia_css_morph_table *id_table = NULL;\n\n\t\t\tif ((table) &&\n\t\t\t    (table->width < binary->morph_tbl_width ||\n\t\t\t    table->height < binary->morph_tbl_height)) {\n\t\t\t\ttable = NULL;\n\t\t\t}\n\t\t\tif (!table) {\n\t\t\t\terr = sh_css_params_default_morph_table(&id_table,\n\t\t\t\t\t\t\t\t\tbinary);\n\t\t\t\tif (err) {\n\t\t\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\t\t\treturn err;\n\t\t\t\t}\n\t\t\t\ttable = id_table;\n\t\t\t}\n\n\t\t\tfor (i = 0; i < IA_CSS_MORPH_TABLE_NUM_PLANES; i++) {\n\t\t\t\tstore_morph_plane(table->coordinates_x[i],\n\t\t\t\t\t\ttable->width,\n\t\t\t\t\t\ttable->height,\n\t\t\t\t\t\t*virt_addr_tetra_x[i],\n\t\t\t\t\t\tbinary->morph_tbl_aligned_width);\n\t\t\t\tstore_morph_plane(table->coordinates_y[i],\n\t\t\t\t\t\ttable->width,\n\t\t\t\t\t\ttable->height,\n\t\t\t\t\t\t*virt_addr_tetra_y[i],\n\t\t\t\t\t\tbinary->morph_tbl_aligned_width);\n\t\t\t}\n\t\t\tif (id_table)\n\t\t\t\tia_css_morph_table_free(id_table);\n\t\t}\n\t}\n\n\t \n\tfor (mem = 0; mem < N_IA_CSS_MEMORIES; mem++) {\n\t\tconst struct ia_css_isp_data *isp_data =\n\t\t    ia_css_isp_param_get_isp_mem_init(&binary->info->sp.mem_initializers,\n\t\t\t\t\t\t    IA_CSS_PARAM_CLASS_PARAM, mem);\n\t\tsize_t size = isp_data->size;\n\n\t\tif (!size) continue;\n\t\tbuff_realloced = reallocate_buffer(&ddr_map->isp_mem_param[stage_num][mem],\n\t\t\t\t\t\t&ddr_map_size->isp_mem_param[stage_num][mem],\n\t\t\t\t\t\tsize,\n\t\t\t\t\t\tparams->isp_mem_params_changed[pipe_id][stage_num][mem],\n\t\t\t\t\t\t&err);\n\t\tif (err) {\n\t\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\t\treturn err;\n\t\t}\n\t\tif (params->isp_mem_params_changed[pipe_id][stage_num][mem] || buff_realloced) {\n\t\t\tsh_css_update_isp_mem_params_to_ddr(binary,\n\t\t\t\t\t\t\t    ddr_map->isp_mem_param[stage_num][mem],\n\t\t\t\t\t\t\t    ddr_map_size->isp_mem_param[stage_num][mem], mem);\n\t\t}\n\t}\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(0);\n\treturn 0;\n}\n\nconst struct ia_css_fpn_table *ia_css_get_fpn_table(struct ia_css_stream\n\t*stream)\n{\n\tstruct ia_css_isp_parameters *params;\n\n\tIA_CSS_ENTER_LEAVE(\"void\");\n\tassert(stream);\n\n\tparams = stream->isp_params_configs;\n\n\treturn &params->fpn_config;\n}\n\nstruct ia_css_shading_table *ia_css_get_shading_table(struct ia_css_stream\n\t*stream)\n{\n\tstruct ia_css_shading_table *table = NULL;\n\tstruct ia_css_isp_parameters *params;\n\n\tIA_CSS_ENTER(\"void\");\n\n\tassert(stream);\n\n\tparams = stream->isp_params_configs;\n\tif (!params)\n\t\treturn NULL;\n\n\tif (params->shading_settings.enable_shading_table_conversion == 0) {\n\t\tif (params->sc_table) {\n\t\t\ttable = (struct ia_css_shading_table *)params->sc_table;\n\t\t} else {\n\t\t\tconst struct ia_css_binary *binary\n\t\t\t    = ia_css_stream_get_shading_correction_binary(stream);\n\t\t\tif (binary) {\n\t\t\t\t \n\t\t\t\tif (params->sc_config) {\n\t\t\t\t\tia_css_shading_table_free(params->sc_config);\n\t\t\t\t\tparams->sc_config = NULL;\n\t\t\t\t}\n\t\t\t\tsh_css_params_shading_id_table_generate(&params->sc_config,\n\t\t\t\t\t\t\t\t\tbinary->sctbl_width_per_color,\n\t\t\t\t\t\t\t\t\tbinary->sctbl_height);\n\t\t\t\ttable = params->sc_config;\n\t\t\t\t \n\t\t\t}\n\t\t}\n\t} else {\n\t\t \n\t\tconst struct ia_css_binary *binary\n\t\t    = ia_css_stream_get_shading_correction_binary(stream);\n\t\tstruct ia_css_pipe *pipe;\n\n\t\t \n\t\t \n\t\tpipe = stream->pipes[0];\n\n\t\tif (stream->num_pipes == 2) {\n\t\t\tassert(stream->pipes[1]);\n\t\t\tif (stream->pipes[1]->config.mode == IA_CSS_PIPE_MODE_VIDEO ||\n\t\t\t    stream->pipes[1]->config.mode == IA_CSS_PIPE_MODE_PREVIEW)\n\t\t\t\tpipe = stream->pipes[1];\n\t\t}\n\t\t \n\t\tif (binary) {\n\t\t\tif (params->sc_config) {\n\t\t\t\tia_css_shading_table_free(params->sc_config);\n\t\t\t\tparams->sc_config = NULL;\n\t\t\t}\n\t\t\tprepare_shading_table(\n\t\t\t    (const struct ia_css_shading_table *)params->sc_table,\n\t\t\t    params->sensor_binning,\n\t\t\t    &params->sc_config,\n\t\t\t    binary, pipe->required_bds_factor);\n\n\t\t\ttable = params->sc_config;\n\t\t\t \n\t\t}\n\t\t \n\t}\n\n\tIA_CSS_LEAVE(\"table=%p\", table);\n\n\treturn table;\n}\n\nia_css_ptr sh_css_store_sp_group_to_ddr(void)\n{\n\tIA_CSS_ENTER_LEAVE_PRIVATE(\"void\");\n\thmm_store(xmem_sp_group_ptrs,\n\t\t   &sh_css_sp_group,\n\t\t   sizeof(struct sh_css_sp_group));\n\treturn xmem_sp_group_ptrs;\n}\n\nia_css_ptr sh_css_store_sp_stage_to_ddr(\n    unsigned int pipe,\n    unsigned int stage)\n{\n\tIA_CSS_ENTER_LEAVE_PRIVATE(\"void\");\n\thmm_store(xmem_sp_stage_ptrs[pipe][stage],\n\t\t   &sh_css_sp_stage,\n\t\t   sizeof(struct sh_css_sp_stage));\n\treturn xmem_sp_stage_ptrs[pipe][stage];\n}\n\nia_css_ptr sh_css_store_isp_stage_to_ddr(\n    unsigned int pipe,\n    unsigned int stage)\n{\n\tIA_CSS_ENTER_LEAVE_PRIVATE(\"void\");\n\thmm_store(xmem_isp_stage_ptrs[pipe][stage],\n\t\t   &sh_css_isp_stage,\n\t\t   sizeof(struct sh_css_isp_stage));\n\treturn xmem_isp_stage_ptrs[pipe][stage];\n}\n\nstatic int ref_sh_css_ddr_address_map(\n    struct sh_css_ddr_address_map *map,\n    struct sh_css_ddr_address_map *out)\n{\n\tint err = 0;\n\tunsigned int i;\n\n\t \n\tunion {\n\t\tstruct sh_css_ddr_address_map *map;\n\t\tia_css_ptr *addrs;\n\t} in_addrs, to_addrs;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\tassert(map);\n\tassert(out);\n\n\tin_addrs.map = map;\n\tto_addrs.map = out;\n\n\tassert(sizeof(struct sh_css_ddr_address_map_size) / sizeof(size_t) ==\n\t       sizeof(struct sh_css_ddr_address_map) / sizeof(ia_css_ptr));\n\n\t \n\tfor (i = 0; i < (sizeof(struct sh_css_ddr_address_map_size) /\n\t\t\t sizeof(size_t)); i++) {\n\t\tif (in_addrs.addrs[i] == mmgr_NULL)\n\t\t\tto_addrs.addrs[i] = mmgr_NULL;\n\t\telse\n\t\t\tto_addrs.addrs[i] = ia_css_refcount_increment(IA_CSS_REFCOUNT_PARAM_BUFFER,\n\t\t\t\t\t    in_addrs.addrs[i]);\n\t}\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nstatic int write_ia_css_isp_parameter_set_info_to_ddr(\n    struct ia_css_isp_parameter_set_info *me,\n    ia_css_ptr *out)\n{\n\tint err = 0;\n\tbool succ;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tassert(me);\n\tassert(out);\n\n\t*out = ia_css_refcount_increment(IA_CSS_REFCOUNT_PARAM_SET_POOL,\n\t\t\t\t\t hmm_alloc(sizeof(struct ia_css_isp_parameter_set_info)));\n\tsucc = (*out != mmgr_NULL);\n\tif (succ)\n\t\thmm_store(*out,\n\t\t\t   me, sizeof(struct ia_css_isp_parameter_set_info));\n\telse\n\t\terr = -ENOMEM;\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\nstatic int\nfree_ia_css_isp_parameter_set_info(\n    ia_css_ptr ptr)\n{\n\tint err = 0;\n\tstruct ia_css_isp_parameter_set_info isp_params_info;\n\tunsigned int i;\n\tia_css_ptr *addrs = (ia_css_ptr *)&isp_params_info.mem_map;\n\n\tIA_CSS_ENTER_PRIVATE(\"ptr = %u\", ptr);\n\n\t \n\tif (!ia_css_refcount_is_valid(ptr)) {\n\t\tIA_CSS_ERROR(\"%s: IA_CSS_REFCOUNT_PARAM_SET_POOL(0x%x) invalid arg\", __func__,\n\t\t\t     ptr);\n\t\terr = -EINVAL;\n\t\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\t\treturn err;\n\t}\n\n\thmm_load(ptr, &isp_params_info.mem_map, sizeof(struct sh_css_ddr_address_map));\n\t \n\tfor (i = 0; i < (sizeof(struct sh_css_ddr_address_map_size) /\n\t\t\t sizeof(size_t)); i++) {\n\t\tif (addrs[i] == mmgr_NULL)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (!ia_css_refcount_is_valid(addrs[i])) {\n\t\t\tIA_CSS_ERROR(\"%s: IA_CSS_REFCOUNT_PARAM_BUFFER(0x%x) invalid arg\", __func__,\n\t\t\t\t     ptr);\n\t\t\terr = -EINVAL;\n\t\t\tcontinue;\n\t\t}\n\n\t\tia_css_refcount_decrement(IA_CSS_REFCOUNT_PARAM_BUFFER, addrs[i]);\n\t}\n\tia_css_refcount_decrement(IA_CSS_REFCOUNT_PARAM_SET_POOL, ptr);\n\n\tIA_CSS_LEAVE_ERR_PRIVATE(err);\n\treturn err;\n}\n\n \nvoid\nsh_css_invalidate_params(struct ia_css_stream *stream)\n{\n\tstruct\tia_css_isp_parameters *params;\n\tunsigned int i, j, mem;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\tassert(stream);\n\n\tparams = stream->isp_params_configs;\n\tparams->isp_params_changed = true;\n\tfor (i = 0; i < IA_CSS_PIPE_ID_NUM; i++) {\n\t\tfor (j = 0; j < SH_CSS_MAX_STAGES; j++) {\n\t\t\tfor (mem = 0; mem < N_IA_CSS_MEMORIES; mem++) {\n\t\t\t\tparams->isp_mem_params_changed[i][j][mem] = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tmemset(&params->config_changed[0], 1, sizeof(params->config_changed));\n\tparams->dis_coef_table_changed = true;\n\tparams->dvs2_coef_table_changed = true;\n\tparams->morph_table_changed = true;\n\tparams->sc_table_changed = true;\n\tparams->dz_config_changed = true;\n\tparams->motion_config_changed = true;\n\n\t \n\tfor (i = 0; i < IA_CSS_PIPE_ID_NUM; i++) {\n\t\tif (params->pipe_dvs_6axis_config[i]) {\n\t\t\tfree_dvs_6axis_table(&params->pipe_dvs_6axis_config[i]);\n\t\t\tparams->pipe_dvs_6axis_config_changed[i] = true;\n\t\t}\n\t}\n\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nvoid\nsh_css_update_uds_and_crop_info(\n    const struct ia_css_binary_info *info,\n    const struct ia_css_frame_info *in_frame_info,\n    const struct ia_css_frame_info *out_frame_info,\n    const struct ia_css_resolution *dvs_env,\n    const struct ia_css_dz_config *zoom,\n    const struct ia_css_vector *motion_vector,\n    struct sh_css_uds_info *uds,\t\t \n    struct sh_css_crop_pos *sp_out_crop_pos,\t \n\n    bool enable_zoom)\n{\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tassert(info);\n\tassert(in_frame_info);\n\tassert(out_frame_info);\n\tassert(dvs_env);\n\tassert(zoom);\n\tassert(motion_vector);\n\tassert(uds);\n\tassert(sp_out_crop_pos);\n\n\tuds->curr_dx   = enable_zoom ? (uint16_t)zoom->dx : HRT_GDC_N;\n\tuds->curr_dy   = enable_zoom ? (uint16_t)zoom->dy : HRT_GDC_N;\n\n\tif (info->enable.dvs_envelope) {\n\t\tunsigned int crop_x = 0,\n\t\t\t     crop_y = 0,\n\t\t\t     uds_xc = 0,\n\t\t\t     uds_yc = 0,\n\t\t\t     env_width, env_height;\n\t\tint half_env_x, half_env_y;\n\t\tint motion_x = motion_vector->x;\n\t\tint motion_y = motion_vector->y;\n\t\tbool upscale_x = in_frame_info->res.width < out_frame_info->res.width;\n\t\tbool upscale_y = in_frame_info->res.height < out_frame_info->res.height;\n\n\t\tif (info->enable.uds && !info->enable.ds) {\n\t\t\t \n\t\t\tenv_width  = dvs_env->width -\n\t\t\t\t     SH_CSS_MIN_DVS_ENVELOPE;\n\t\t\tenv_height = dvs_env->height -\n\t\t\t\t     SH_CSS_MIN_DVS_ENVELOPE;\n\t\t\thalf_env_x = env_width / 2;\n\t\t\thalf_env_y = env_height / 2;\n\t\t\t \n\t\t\tif (upscale_x) {\n\t\t\t\tuds_xc = (in_frame_info->res.width\n\t\t\t\t\t  + env_width\n\t\t\t\t\t  + SH_CSS_MIN_DVS_ENVELOPE) / 2;\n\t\t\t} else {\n\t\t\t\tuds_xc = (out_frame_info->res.width\n\t\t\t\t\t  + env_width) / 2\n\t\t\t\t\t + SH_CSS_MIN_DVS_ENVELOPE;\n\t\t\t}\n\t\t\tif (upscale_y) {\n\t\t\t\tuds_yc = (in_frame_info->res.height\n\t\t\t\t\t  + env_height\n\t\t\t\t\t  + SH_CSS_MIN_DVS_ENVELOPE) / 2;\n\t\t\t} else {\n\t\t\t\tuds_yc = (out_frame_info->res.height\n\t\t\t\t\t  + env_height) / 2\n\t\t\t\t\t + SH_CSS_MIN_DVS_ENVELOPE;\n\t\t\t}\n\t\t\t \n\t\t\tmotion_x = clamp(motion_x, -half_env_x, half_env_x);\n\t\t\tmotion_y = clamp(motion_y, -half_env_y, half_env_y);\n\t\t\tuds_xc += motion_x;\n\t\t\tuds_yc += motion_y;\n\t\t\t \n\t\t\tcrop_y = 2;\n\t\t} else if (info->enable.ds) {\n\t\t\tenv_width  = dvs_env->width;\n\t\t\tenv_height = dvs_env->height;\n\t\t\thalf_env_x = env_width / 2;\n\t\t\thalf_env_y = env_height / 2;\n\t\t\t \n\t\t\tmotion_x = clamp(motion_x, -half_env_x, half_env_x);\n\t\t\tmotion_y = clamp(motion_y, -half_env_y, half_env_y);\n\t\t\t \n\t\t\tuds_xc = in_frame_info->res.width / 2 + motion_x;\n\t\t\tuds_yc = in_frame_info->res.height / 2 + motion_y;\n\t\t\tcrop_x = info->pipeline.left_cropping;\n\t\t\t \n\t\t\tif (info->enable.ds & 1)\n\t\t\t\tcrop_y = info->pipeline.top_cropping;\n\t\t\telse\n\t\t\t\tcrop_y = 2;\n\t\t} else {\n\t\t\t \n\t\t\tenv_width  = dvs_env->width -\n\t\t\t\t     SH_CSS_MIN_DVS_ENVELOPE;\n\t\t\tenv_height = dvs_env->height -\n\t\t\t\t     SH_CSS_MIN_DVS_ENVELOPE;\n\t\t\thalf_env_x = env_width / 2;\n\t\t\thalf_env_y = env_height / 2;\n\t\t\tmotion_x = clamp(motion_x, -half_env_x, half_env_x);\n\t\t\tmotion_y = clamp(motion_y, -half_env_y, half_env_y);\n\t\t\tcrop_x = SH_CSS_MIN_DVS_ENVELOPE\n\t\t\t\t + half_env_x + motion_x;\n\t\t\tcrop_y = SH_CSS_MIN_DVS_ENVELOPE\n\t\t\t\t + half_env_y + motion_y;\n\t\t}\n\n\t\t \n\t\tcrop_x = EVEN_FLOOR(crop_x);\n\t\tcrop_y = EVEN_FLOOR(crop_y);\n\t\tuds_xc = EVEN_FLOOR(uds_xc);\n\t\tuds_yc = EVEN_FLOOR(uds_yc);\n\n\t\tuds->xc = (uint16_t)uds_xc;\n\t\tuds->yc = (uint16_t)uds_yc;\n\t\tsp_out_crop_pos->x = (uint16_t)crop_x;\n\t\tsp_out_crop_pos->y = (uint16_t)crop_y;\n\t} else {\n\t\t \n\t\tuds->xc = (uint16_t)in_frame_info->res.width / 2;\n\t\tuds->yc = (uint16_t)in_frame_info->res.height / 2;\n\t\tsp_out_crop_pos->x = (uint16_t)info->pipeline.left_cropping;\n\t\tsp_out_crop_pos->y = (uint16_t)info->pipeline.top_cropping;\n\t}\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n}\n\nstatic int\nsh_css_update_uds_and_crop_info_based_on_zoom_region(\n    const struct ia_css_binary_info *info,\n    const struct ia_css_frame_info *in_frame_info,\n    const struct ia_css_frame_info *out_frame_info,\n    const struct ia_css_resolution *dvs_env,\n    const struct ia_css_dz_config *zoom,\n    const struct ia_css_vector *motion_vector,\n    struct sh_css_uds_info *uds,\t\t \n    struct sh_css_crop_pos *sp_out_crop_pos,\t \n    struct ia_css_resolution pipe_in_res,\n    bool enable_zoom)\n{\n\tunsigned int x0 = 0, y0 = 0, x1 = 0, y1 = 0;\n\tint err = 0;\n\t \n\tunsigned int filter_envelope = 0;\n\n\tIA_CSS_ENTER_PRIVATE(\"void\");\n\n\tassert(info);\n\tassert(in_frame_info);\n\tassert(out_frame_info);\n\tassert(dvs_env);\n\tassert(zoom);\n\tassert(motion_vector);\n\tassert(uds);\n\tassert(sp_out_crop_pos);\n\tx0 = zoom->zoom_region.origin.x;\n\ty0 = zoom->zoom_region.origin.y;\n\tx1 = zoom->zoom_region.resolution.width + x0;\n\ty1 = zoom->zoom_region.resolution.height + y0;\n\n\tif ((x0 > x1) || (y0 > y1) || (x1 > pipe_in_res.width) || (y1 > pipe_in_res.height))\n\t\treturn -EINVAL;\n\n\tif (!enable_zoom) {\n\t\tuds->curr_dx = HRT_GDC_N;\n\t\tuds->curr_dy = HRT_GDC_N;\n\t}\n\n\tif (info->enable.dvs_envelope) {\n\t\t \n\t\treturn -EINVAL;\n\t} else {\n\t\tif (enable_zoom) {\n\t\t\t \n\t\t\tif (in_frame_info->res.width != pipe_in_res.width ||\n\t\t\t    in_frame_info->res.height != pipe_in_res.height) {\n\t\t\t\tx0 = (x0 * in_frame_info->res.width) / (pipe_in_res.width);\n\t\t\t\ty0 = (y0 * in_frame_info->res.height) / (pipe_in_res.height);\n\t\t\t\tx1 = (x1 * in_frame_info->res.width) / (pipe_in_res.width);\n\t\t\t\ty1 = (y1 * in_frame_info->res.height) / (pipe_in_res.height);\n\t\t\t}\n\t\t\tuds->curr_dx =\n\t\t\t    ((x1 - x0 - filter_envelope) * HRT_GDC_N) / in_frame_info->res.width;\n\t\t\tuds->curr_dy =\n\t\t\t    ((y1 - y0 - filter_envelope) * HRT_GDC_N) / in_frame_info->res.height;\n\n\t\t\t \n\t\t\tuds->xc = (uint16_t)x0 + (((x1) - (x0)) / 2);\n\t\t\tuds->yc = (uint16_t)y0 + (((y1) - (y0)) / 2);\n\t\t} else {\n\t\t\tuds->xc = (uint16_t)in_frame_info->res.width / 2;\n\t\t\tuds->yc = (uint16_t)in_frame_info->res.height / 2;\n\t\t}\n\n\t\tia_css_debug_dtrace(IA_CSS_DEBUG_TRACE,\n\t\t\t\t    \"uds->curr_dx=%d, uds->xc=%d, uds->yc=%d\\n\",\n\t\t\t\t    uds->curr_dx, uds->xc, uds->yc);\n\t\tia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, \"x0=%d, y0=%d, x1=%d, y1=%d\\n\",\n\t\t\t\t    x0, y0, x1, y1);\n\t\tsp_out_crop_pos->x = (uint16_t)info->pipeline.left_cropping;\n\t\tsp_out_crop_pos->y = (uint16_t)info->pipeline.top_cropping;\n\t}\n\tIA_CSS_LEAVE_PRIVATE(\"void\");\n\treturn err;\n}\n\nstruct ia_css_3a_statistics *\nia_css_3a_statistics_allocate(const struct ia_css_3a_grid_info *grid)\n{\n\tstruct ia_css_3a_statistics *me;\n\tint grid_size;\n\n\tIA_CSS_ENTER(\"grid=%p\", grid);\n\n\tassert(grid);\n\n\tme = kvcalloc(1, sizeof(*me), GFP_KERNEL);\n\tif (!me)\n\t\tgoto err;\n\n\tme->grid = *grid;\n\tgrid_size = grid->width * grid->height;\n\tme->data = kvmalloc(grid_size * sizeof(*me->data), GFP_KERNEL);\n\tif (!me->data)\n\t\tgoto err;\n\t \n\tme->rgby_data = kvmalloc(sizeof_hmem(HMEM0_ID), GFP_KERNEL);\n\n\tIA_CSS_LEAVE(\"return=%p\", me);\n\treturn me;\nerr:\n\tia_css_3a_statistics_free(me);\n\n\tIA_CSS_LEAVE(\"return=%p\", NULL);\n\treturn NULL;\n}\n\nvoid\nia_css_3a_statistics_free(struct ia_css_3a_statistics *me)\n{\n\tif (me) {\n\t\tkvfree(me->rgby_data);\n\t\tkvfree(me->data);\n\t\tkvfree(me);\n\t}\n}\n\nstruct ia_css_dvs_statistics *\nia_css_dvs_statistics_allocate(const struct ia_css_dvs_grid_info *grid)\n{\n\tstruct ia_css_dvs_statistics *me;\n\n\tassert(grid);\n\n\tme = kvcalloc(1, sizeof(*me), GFP_KERNEL);\n\tif (!me)\n\t\tgoto err;\n\n\tme->grid = *grid;\n\tme->hor_proj = kvmalloc(grid->height * IA_CSS_DVS_NUM_COEF_TYPES *\n\t\t\t\tsizeof(*me->hor_proj), GFP_KERNEL);\n\tif (!me->hor_proj)\n\t\tgoto err;\n\n\tme->ver_proj = kvmalloc(grid->width * IA_CSS_DVS_NUM_COEF_TYPES *\n\t\t\t\tsizeof(*me->ver_proj), GFP_KERNEL);\n\tif (!me->ver_proj)\n\t\tgoto err;\n\n\treturn me;\nerr:\n\tia_css_dvs_statistics_free(me);\n\treturn NULL;\n}\n\nvoid\nia_css_dvs_statistics_free(struct ia_css_dvs_statistics *me)\n{\n\tif (me) {\n\t\tkvfree(me->hor_proj);\n\t\tkvfree(me->ver_proj);\n\t\tkvfree(me);\n\t}\n}\n\nstruct ia_css_dvs_coefficients *\nia_css_dvs_coefficients_allocate(const struct ia_css_dvs_grid_info *grid)\n{\n\tstruct ia_css_dvs_coefficients *me;\n\n\tassert(grid);\n\n\tme = kvcalloc(1, sizeof(*me), GFP_KERNEL);\n\tif (!me)\n\t\tgoto err;\n\n\tme->grid = *grid;\n\n\tme->hor_coefs = kvmalloc(grid->num_hor_coefs *\n\t\t\t\t IA_CSS_DVS_NUM_COEF_TYPES *\n\t\t\t\t sizeof(*me->hor_coefs), GFP_KERNEL);\n\tif (!me->hor_coefs)\n\t\tgoto err;\n\n\tme->ver_coefs = kvmalloc(grid->num_ver_coefs *\n\t\t\t\t IA_CSS_DVS_NUM_COEF_TYPES *\n\t\t\t\t sizeof(*me->ver_coefs), GFP_KERNEL);\n\tif (!me->ver_coefs)\n\t\tgoto err;\n\n\treturn me;\nerr:\n\tia_css_dvs_coefficients_free(me);\n\treturn NULL;\n}\n\nvoid\nia_css_dvs_coefficients_free(struct ia_css_dvs_coefficients *me)\n{\n\tif (me) {\n\t\tkvfree(me->hor_coefs);\n\t\tkvfree(me->ver_coefs);\n\t\tkvfree(me);\n\t}\n}\n\nstruct ia_css_dvs2_statistics *\nia_css_dvs2_statistics_allocate(const struct ia_css_dvs_grid_info *grid)\n{\n\tstruct ia_css_dvs2_statistics *me;\n\n\tassert(grid);\n\n\tme = kvcalloc(1, sizeof(*me), GFP_KERNEL);\n\tif (!me)\n\t\tgoto err;\n\n\tme->grid = *grid;\n\n\tme->hor_prod.odd_real = kvmalloc(grid->aligned_width *\n\t\t\t\t\t grid->aligned_height *\n\t\t\t\t\t sizeof(*me->hor_prod.odd_real),\n\t\t\t\t\t GFP_KERNEL);\n\tif (!me->hor_prod.odd_real)\n\t\tgoto err;\n\n\tme->hor_prod.odd_imag = kvmalloc(grid->aligned_width *\n\t\t\t\t\t grid->aligned_height *\n\t\t\t\t\t sizeof(*me->hor_prod.odd_imag),\n\t\t\t\t\t GFP_KERNEL);\n\tif (!me->hor_prod.odd_imag)\n\t\tgoto err;\n\n\tme->hor_prod.even_real = kvmalloc(grid->aligned_width *\n\t\t\t\t\t  grid->aligned_height *\n\t\t\t\t\t  sizeof(*me->hor_prod.even_real),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->hor_prod.even_real)\n\t\tgoto err;\n\n\tme->hor_prod.even_imag = kvmalloc(grid->aligned_width *\n\t\t\t\t\t  grid->aligned_height *\n\t\t\t\t\t  sizeof(*me->hor_prod.even_imag),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->hor_prod.even_imag)\n\t\tgoto err;\n\n\tme->ver_prod.odd_real = kvmalloc(grid->aligned_width *\n\t\t\t\t\t grid->aligned_height *\n\t\t\t\t\t sizeof(*me->ver_prod.odd_real),\n\t\t\t\t\t GFP_KERNEL);\n\tif (!me->ver_prod.odd_real)\n\t\tgoto err;\n\n\tme->ver_prod.odd_imag = kvmalloc(grid->aligned_width *\n\t\t\t\t\t grid->aligned_height *\n\t\t\t\t\t sizeof(*me->ver_prod.odd_imag),\n\t\t\t\t\t GFP_KERNEL);\n\tif (!me->ver_prod.odd_imag)\n\t\tgoto err;\n\n\tme->ver_prod.even_real = kvmalloc(grid->aligned_width *\n\t\t\t\t\t  grid->aligned_height *\n\t\t\t\t\t  sizeof(*me->ver_prod.even_real),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->ver_prod.even_real)\n\t\tgoto err;\n\n\tme->ver_prod.even_imag = kvmalloc(grid->aligned_width *\n\t\t\t\t\t  grid->aligned_height *\n\t\t\t\t\t  sizeof(*me->ver_prod.even_imag),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->ver_prod.even_imag)\n\t\tgoto err;\n\n\treturn me;\nerr:\n\tia_css_dvs2_statistics_free(me);\n\treturn NULL;\n}\n\nvoid\nia_css_dvs2_statistics_free(struct ia_css_dvs2_statistics *me)\n{\n\tif (me) {\n\t\tkvfree(me->hor_prod.odd_real);\n\t\tkvfree(me->hor_prod.odd_imag);\n\t\tkvfree(me->hor_prod.even_real);\n\t\tkvfree(me->hor_prod.even_imag);\n\t\tkvfree(me->ver_prod.odd_real);\n\t\tkvfree(me->ver_prod.odd_imag);\n\t\tkvfree(me->ver_prod.even_real);\n\t\tkvfree(me->ver_prod.even_imag);\n\t\tkvfree(me);\n\t}\n}\n\nstruct ia_css_dvs2_coefficients *\nia_css_dvs2_coefficients_allocate(const struct ia_css_dvs_grid_info *grid)\n{\n\tstruct ia_css_dvs2_coefficients *me;\n\n\tassert(grid);\n\n\tme = kvcalloc(1, sizeof(*me), GFP_KERNEL);\n\tif (!me)\n\t\tgoto err;\n\n\tme->grid = *grid;\n\n\tme->hor_coefs.odd_real = kvmalloc(grid->num_hor_coefs *\n\t\t\t\t\t  sizeof(*me->hor_coefs.odd_real),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->hor_coefs.odd_real)\n\t\tgoto err;\n\n\tme->hor_coefs.odd_imag = kvmalloc(grid->num_hor_coefs *\n\t\t\t\t\t  sizeof(*me->hor_coefs.odd_imag),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->hor_coefs.odd_imag)\n\t\tgoto err;\n\n\tme->hor_coefs.even_real = kvmalloc(grid->num_hor_coefs *\n\t\t\t\t\t   sizeof(*me->hor_coefs.even_real),\n\t\t\t\t\t   GFP_KERNEL);\n\tif (!me->hor_coefs.even_real)\n\t\tgoto err;\n\n\tme->hor_coefs.even_imag = kvmalloc(grid->num_hor_coefs *\n\t\t\t\t\t   sizeof(*me->hor_coefs.even_imag),\n\t\t\t\t\t   GFP_KERNEL);\n\tif (!me->hor_coefs.even_imag)\n\t\tgoto err;\n\n\tme->ver_coefs.odd_real = kvmalloc(grid->num_ver_coefs *\n\t\t\t\t\t  sizeof(*me->ver_coefs.odd_real),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->ver_coefs.odd_real)\n\t\tgoto err;\n\n\tme->ver_coefs.odd_imag = kvmalloc(grid->num_ver_coefs *\n\t\t\t\t\t  sizeof(*me->ver_coefs.odd_imag),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!me->ver_coefs.odd_imag)\n\t\tgoto err;\n\n\tme->ver_coefs.even_real = kvmalloc(grid->num_ver_coefs *\n\t\t\t\t\t   sizeof(*me->ver_coefs.even_real),\n\t\t\t\t\t   GFP_KERNEL);\n\tif (!me->ver_coefs.even_real)\n\t\tgoto err;\n\n\tme->ver_coefs.even_imag = kvmalloc(grid->num_ver_coefs *\n\t\t\t\t\t   sizeof(*me->ver_coefs.even_imag),\n\t\t\t\t\t   GFP_KERNEL);\n\tif (!me->ver_coefs.even_imag)\n\t\tgoto err;\n\n\treturn me;\nerr:\n\tia_css_dvs2_coefficients_free(me);\n\treturn NULL;\n}\n\nvoid\nia_css_dvs2_coefficients_free(struct ia_css_dvs2_coefficients *me)\n{\n\tif (me) {\n\t\tkvfree(me->hor_coefs.odd_real);\n\t\tkvfree(me->hor_coefs.odd_imag);\n\t\tkvfree(me->hor_coefs.even_real);\n\t\tkvfree(me->hor_coefs.even_imag);\n\t\tkvfree(me->ver_coefs.odd_real);\n\t\tkvfree(me->ver_coefs.odd_imag);\n\t\tkvfree(me->ver_coefs.even_real);\n\t\tkvfree(me->ver_coefs.even_imag);\n\t\tkvfree(me);\n\t}\n}\n\nstruct ia_css_dvs_6axis_config *\nia_css_dvs2_6axis_config_allocate(const struct ia_css_stream *stream)\n{\n\tstruct ia_css_dvs_6axis_config *dvs_config = NULL;\n\tstruct ia_css_isp_parameters *params = NULL;\n\tunsigned int width_y;\n\tunsigned int height_y;\n\tunsigned int width_uv;\n\tunsigned int height_uv;\n\n\tassert(stream);\n\tparams = stream->isp_params_configs;\n\n\t \n\tif (!params || !params->pipe_dvs_6axis_config[IA_CSS_PIPE_ID_VIDEO])\n\t\tgoto err;\n\n\tdvs_config = kvcalloc(1, sizeof(struct ia_css_dvs_6axis_config),\n\t\t\t      GFP_KERNEL);\n\tif (!dvs_config)\n\t\tgoto err;\n\n\tdvs_config->width_y = width_y =\n\t\t\t\t  params->pipe_dvs_6axis_config[IA_CSS_PIPE_ID_VIDEO]->width_y;\n\tdvs_config->height_y = height_y =\n\t\t\t\t   params->pipe_dvs_6axis_config[IA_CSS_PIPE_ID_VIDEO]->height_y;\n\tdvs_config->width_uv = width_uv =\n\t\t\t\t   params->pipe_dvs_6axis_config[IA_CSS_PIPE_ID_VIDEO]->width_uv;\n\tdvs_config->height_uv = height_uv =\n\t\t\t\t    params->pipe_dvs_6axis_config[IA_CSS_PIPE_ID_VIDEO]->height_uv;\n\tIA_CSS_LOG(\"table Y: W %d H %d\", width_y, height_y);\n\tIA_CSS_LOG(\"table UV: W %d H %d\", width_uv, height_uv);\n\tdvs_config->xcoords_y = kvmalloc(width_y * height_y * sizeof(uint32_t),\n\t\t\t\t\t GFP_KERNEL);\n\tif (!dvs_config->xcoords_y)\n\t\tgoto err;\n\n\tdvs_config->ycoords_y = kvmalloc(width_y * height_y * sizeof(uint32_t),\n\t\t\t\t\t GFP_KERNEL);\n\tif (!dvs_config->ycoords_y)\n\t\tgoto err;\n\n\tdvs_config->xcoords_uv = kvmalloc(width_uv * height_uv *\n\t\t\t\t\t  sizeof(uint32_t),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!dvs_config->xcoords_uv)\n\t\tgoto err;\n\n\tdvs_config->ycoords_uv = kvmalloc(width_uv * height_uv *\n\t\t\t\t\t  sizeof(uint32_t),\n\t\t\t\t\t  GFP_KERNEL);\n\tif (!dvs_config->ycoords_uv)\n\t\tgoto err;\n\n\treturn dvs_config;\nerr:\n\tia_css_dvs2_6axis_config_free(dvs_config);\n\treturn NULL;\n}\n\nvoid\nia_css_dvs2_6axis_config_free(struct ia_css_dvs_6axis_config *dvs_6axis_config)\n{\n\tif (dvs_6axis_config) {\n\t\tkvfree(dvs_6axis_config->xcoords_y);\n\t\tkvfree(dvs_6axis_config->ycoords_y);\n\t\tkvfree(dvs_6axis_config->xcoords_uv);\n\t\tkvfree(dvs_6axis_config->ycoords_uv);\n\t\tkvfree(dvs_6axis_config);\n\t}\n}\n\nvoid\nia_css_en_dz_capt_pipe(struct ia_css_stream *stream, bool enable)\n{\n\tstruct ia_css_pipe *pipe;\n\tstruct ia_css_pipeline *pipeline;\n\tstruct ia_css_pipeline_stage *stage;\n\tenum ia_css_pipe_id pipe_id;\n\tint err;\n\tint i;\n\n\tif (!stream)\n\t\treturn;\n\n\tfor (i = 0; i < stream->num_pipes; i++) {\n\t\tpipe = stream->pipes[i];\n\t\tpipeline = ia_css_pipe_get_pipeline(pipe);\n\t\tpipe_id = pipeline->pipe_id;\n\n\t\tif (pipe_id == IA_CSS_PIPE_ID_CAPTURE) {\n\t\t\terr = ia_css_pipeline_get_stage(pipeline, IA_CSS_BINARY_MODE_CAPTURE_PP,\n\t\t\t\t\t\t\t&stage);\n\t\t\tif (!err)\n\t\t\t\tstage->enable_zoom = enable;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}