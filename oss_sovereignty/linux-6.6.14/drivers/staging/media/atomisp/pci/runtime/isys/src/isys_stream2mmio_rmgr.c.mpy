{
  "module_name": "isys_stream2mmio_rmgr.c",
  "hash_id": "10c4455de99f0af204865781a89600a3968f122faa1810957d00c2e17345b8c0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/runtime/isys/src/isys_stream2mmio_rmgr.c",
  "human_readable_source": "\n \n\n#include \"system_global.h\"\n\n#ifdef ISP2401\n\n#include \"assert_support.h\"\n#include \"platform_support.h\"\n#include \"ia_css_isys.h\"\n#include \"bitop_support.h\"\n#include \"isys_stream2mmio_rmgr.h\"\n\nstatic isys_stream2mmio_rsrc_t\tisys_stream2mmio_rsrc[N_STREAM2MMIO_ID];\n\nvoid ia_css_isys_stream2mmio_sid_rmgr_init(void)\n{\n\tmemset(isys_stream2mmio_rsrc, 0, sizeof(isys_stream2mmio_rsrc));\n}\n\nvoid ia_css_isys_stream2mmio_sid_rmgr_uninit(void)\n{\n\tmemset(isys_stream2mmio_rsrc, 0, sizeof(isys_stream2mmio_rsrc));\n}\n\nbool ia_css_isys_stream2mmio_sid_rmgr_acquire(\n    stream2mmio_ID_t\tstream2mmio,\n    stream2mmio_sid_ID_t\t*sid)\n{\n\tbool retval = false;\n\tstream2mmio_sid_ID_t max_sid;\n\tisys_stream2mmio_rsrc_t *cur_rsrc = NULL;\n\tstream2mmio_sid_ID_t\ti;\n\n\tassert(stream2mmio < N_STREAM2MMIO_ID);\n\tassert(sid);\n\n\tif ((stream2mmio < N_STREAM2MMIO_ID) && (sid)) {\n\t\tmax_sid = N_STREAM2MMIO_SID_PROCS[stream2mmio];\n\t\tcur_rsrc = &isys_stream2mmio_rsrc[stream2mmio];\n\n\t\tif (cur_rsrc->num_active < max_sid) {\n\t\t\tfor (i = STREAM2MMIO_SID0_ID; i < max_sid; i++) {\n\t\t\t\tif (bitop_getbit(cur_rsrc->active_table, i) == 0) {\n\t\t\t\t\tbitop_setbit(cur_rsrc->active_table, i);\n\t\t\t\t\t*sid = i;\n\t\t\t\t\tcur_rsrc->num_active++;\n\t\t\t\t\tretval = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn retval;\n}\n\nvoid ia_css_isys_stream2mmio_sid_rmgr_release(\n    stream2mmio_ID_t\tstream2mmio,\n    stream2mmio_sid_ID_t\t*sid)\n{\n\tstream2mmio_sid_ID_t max_sid;\n\tisys_stream2mmio_rsrc_t *cur_rsrc = NULL;\n\n\tassert(stream2mmio < N_STREAM2MMIO_ID);\n\tassert(sid);\n\n\tif ((stream2mmio < N_STREAM2MMIO_ID) && (sid)) {\n\t\tmax_sid = N_STREAM2MMIO_SID_PROCS[stream2mmio];\n\t\tcur_rsrc = &isys_stream2mmio_rsrc[stream2mmio];\n\t\tif ((*sid < max_sid) && (cur_rsrc->num_active > 0)) {\n\t\t\tif (bitop_getbit(cur_rsrc->active_table, *sid) == 1) {\n\t\t\t\tbitop_clearbit(cur_rsrc->active_table, *sid);\n\t\t\t\tcur_rsrc->num_active--;\n\t\t\t}\n\t\t}\n\t}\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}