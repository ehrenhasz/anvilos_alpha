{
  "module_name": "isys_dma_rmgr.c",
  "hash_id": "15ea03380a1deaad05d4025c4489521241ebbc5b4f7a35e158db284953226a7b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/runtime/isys/src/isys_dma_rmgr.c",
  "human_readable_source": "\n \n\n#include \"system_global.h\"\n\n#ifdef ISP2401\n\n#include \"assert_support.h\"\n#include \"platform_support.h\"\n#include \"ia_css_isys.h\"\n#include \"bitop_support.h\"\n#include \"isys_dma_rmgr.h\"\n\nstatic isys_dma_rsrc_t isys_dma_rsrc[N_ISYS2401_DMA_ID];\n\nvoid ia_css_isys_dma_channel_rmgr_init(void)\n{\n\tmemset(&isys_dma_rsrc, 0, sizeof(isys_dma_rsrc_t));\n}\n\nvoid ia_css_isys_dma_channel_rmgr_uninit(void)\n{\n\tmemset(&isys_dma_rsrc, 0, sizeof(isys_dma_rsrc_t));\n}\n\nbool ia_css_isys_dma_channel_rmgr_acquire(\n    isys2401_dma_ID_t\tdma_id,\n    isys2401_dma_channel\t*channel)\n{\n\tbool retval = false;\n\tisys2401_dma_channel\ti;\n\tisys2401_dma_channel\tmax_dma_channel;\n\tisys_dma_rsrc_t\t\t*cur_rsrc = NULL;\n\n\tassert(dma_id < N_ISYS2401_DMA_ID);\n\tassert(channel);\n\n\tmax_dma_channel = N_ISYS2401_DMA_CHANNEL_PROCS[dma_id];\n\tcur_rsrc = &isys_dma_rsrc[dma_id];\n\n\tif (cur_rsrc->num_active < max_dma_channel) {\n\t\tfor (i = ISYS2401_DMA_CHANNEL_0; i < N_ISYS2401_DMA_CHANNEL; i++) {\n\t\t\tif (bitop_getbit(cur_rsrc->active_table, i) == 0) {\n\t\t\t\tbitop_setbit(cur_rsrc->active_table, i);\n\t\t\t\t*channel = i;\n\t\t\t\tcur_rsrc->num_active++;\n\t\t\t\tretval = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn retval;\n}\n\nvoid ia_css_isys_dma_channel_rmgr_release(\n    isys2401_dma_ID_t\tdma_id,\n    isys2401_dma_channel\t*channel)\n{\n\tisys2401_dma_channel\tmax_dma_channel;\n\tisys_dma_rsrc_t\t\t*cur_rsrc = NULL;\n\n\tassert(dma_id < N_ISYS2401_DMA_ID);\n\tassert(channel);\n\n\tmax_dma_channel = N_ISYS2401_DMA_CHANNEL_PROCS[dma_id];\n\tcur_rsrc = &isys_dma_rsrc[dma_id];\n\n\tif ((*channel < max_dma_channel) && (cur_rsrc->num_active > 0)) {\n\t\tif (bitop_getbit(cur_rsrc->active_table, *channel) == 1) {\n\t\t\tbitop_clearbit(cur_rsrc->active_table, *channel);\n\t\t\tcur_rsrc->num_active--;\n\t\t}\n\t}\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}