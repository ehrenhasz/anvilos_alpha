{
  "module_name": "atomisp_subdev.h",
  "hash_id": "992a043b2088fc3bda8abec27fb214bb798f8b35887a1148fe94bce6a83ec507",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/atomisp/pci/atomisp_subdev.h",
  "human_readable_source": " \n \n#ifndef __ATOMISP_SUBDEV_H__\n#define __ATOMISP_SUBDEV_H__\n\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-subdev.h>\n#include <media/videobuf2-v4l2.h>\n#include \"atomisp_common.h\"\n#include \"atomisp_compat.h\"\n#include \"atomisp_v4l2.h\"\n\n#include \"ia_css.h\"\n\n \n#define ATOMISP_MAX_EXP_ID     (250)\n\n#define ATOMISP_SUBDEV_PAD_SINK\t\t\t0\n#define ATOMISP_SUBDEV_PAD_SOURCE\t\t1\n#define ATOMISP_SUBDEV_PADS_NUM\t\t\t2\n\nstruct atomisp_in_fmt_conv {\n\tu32     code;\n\tu8 bpp;  \n\tu8 depth;  \n\tenum atomisp_input_format atomisp_in_fmt;\n\tenum ia_css_bayer_order bayer_order;\n};\n\nstruct atomisp_sub_device;\n\nstruct atomisp_video_pipe {\n\tstruct video_device vdev;\n\tenum v4l2_buf_type type;\n\tstruct media_pad pad;\n\tstruct vb2_queue vb_queue;\n\t \n\tstruct mutex vb_queue_mutex;\n\t \n\tstruct list_head buffers_in_css;\n\t \n\tstruct list_head activeq;\n\t \n\tstruct list_head buffers_waiting_for_param;\n\t \n\tstruct list_head per_frame_params;\n\n\t \n\tstruct ia_css_frame_info frame_info;\n\n\t \n\tbool stopping;\n\n\t \n\tspinlock_t irq_lock;\n\tunsigned int users;\n\n\tstruct atomisp_device *isp;\n\tstruct v4l2_pix_format pix;\n\tu32 sh_fmt;\n\n\tstruct atomisp_sub_device *asd;\n\n\t \n\tunsigned int frame_config_id[VIDEO_MAX_FRAME];\n\t \n\tunsigned int frame_request_config_id[VIDEO_MAX_FRAME];\n\tstruct atomisp_css_params_with_list *frame_params[VIDEO_MAX_FRAME];\n};\n\n#define vq_to_pipe(queue) \\\n\tcontainer_of(queue, struct atomisp_video_pipe, vb_queue)\n\n#define vb_to_pipe(vb) vq_to_pipe((vb)->vb2_queue)\n\nstruct atomisp_pad_format {\n\tstruct v4l2_mbus_framefmt fmt;\n\tstruct v4l2_rect crop;\n\tstruct v4l2_rect compose;\n};\n\n \nenum atomisp_flash_state {\n\tATOMISP_FLASH_IDLE,\n\tATOMISP_FLASH_REQUESTED,\n\tATOMISP_FLASH_ONGOING,\n\tATOMISP_FLASH_DONE\n};\n\n \nstruct atomisp_css_params {\n\tstruct ia_css_wb_config   wb_config;\n\tstruct ia_css_cc_config   cc_config;\n\tstruct ia_css_tnr_config  tnr_config;\n\tstruct ia_css_ecd_config  ecd_config;\n\tstruct ia_css_ynr_config  ynr_config;\n\tstruct ia_css_fc_config   fc_config;\n\tstruct ia_css_formats_config formats_config;\n\tstruct ia_css_cnr_config  cnr_config;\n\tstruct ia_css_macc_config macc_config;\n\tstruct ia_css_ctc_config  ctc_config;\n\tstruct ia_css_aa_config   aa_config;\n\tstruct ia_css_aa_config   baa_config;\n\tstruct ia_css_ce_config   ce_config;\n\tstruct ia_css_ob_config   ob_config;\n\tstruct ia_css_dp_config   dp_config;\n\tstruct ia_css_de_config   de_config;\n\tstruct ia_css_gc_config   gc_config;\n\tstruct ia_css_nr_config   nr_config;\n\tstruct ia_css_ee_config   ee_config;\n\tstruct ia_css_anr_config  anr_config;\n\tstruct ia_css_3a_config   s3a_config;\n\tstruct ia_css_xnr_config  xnr_config;\n\tstruct ia_css_dz_config   dz_config;\n\tstruct ia_css_cc_config yuv2rgb_cc_config;\n\tstruct ia_css_cc_config rgb2yuv_cc_config;\n\tstruct ia_css_macc_table  macc_table;\n\tstruct ia_css_gamma_table gamma_table;\n\tstruct ia_css_ctc_table   ctc_table;\n\n\tstruct ia_css_xnr_table   xnr_table;\n\tstruct ia_css_rgb_gamma_table r_gamma_table;\n\tstruct ia_css_rgb_gamma_table g_gamma_table;\n\tstruct ia_css_rgb_gamma_table b_gamma_table;\n\n\tstruct ia_css_vector      motion_vector;\n\tstruct ia_css_anr_thres   anr_thres;\n\n\tstruct ia_css_dvs_6axis_config *dvs_6axis;\n\tstruct ia_css_dvs2_coefficients *dvs2_coeff;\n\tstruct ia_css_shading_table *shading_table;\n\tstruct ia_css_morph_table   *morph_table;\n\n\t \n\tvoid\t\t*output_frame;\n\tu32\tisp_config_id;\n\n\t \n\tstruct atomisp_parameters update_flag;\n};\n\nstruct atomisp_subdev_params {\n\tint yuv_ds_en;\n\tunsigned int color_effect;\n\tbool gdc_cac_en;\n\tbool macc_en;\n\tbool bad_pixel_en;\n\tbool video_dis_en;\n\tbool sc_en;\n\tbool fpn_en;\n\tbool xnr_en;\n\tbool low_light;\n\tint false_color;\n\tunsigned int histogram_elenum;\n\n\t \n\tstruct ia_css_grid_info curr_grid_info;\n\tenum ia_css_pipe_id s3a_enabled_pipe;\n\n\tint s3a_output_bytes;\n\n\tbool dis_proj_data_valid;\n\n\tstruct ia_css_dz_config   dz_config;   \n\tstruct ia_css_capture_config   capture_config;\n\n\tstruct ia_css_isp_config config;\n\n\t \n\tstruct atomisp_css_params css_param;\n\n\t \n\tstruct ia_css_3a_statistics *s3a_user_stat;\n\n\tvoid *metadata_user[ATOMISP_METADATA_TYPE_NUM];\n\tu32 metadata_width_size;\n\n\tstruct ia_css_dvs2_statistics *dvs_stat;\n\tstruct ia_css_dvs_6axis_config *dvs_6axis;\n\tu32 exp_id;\n\tint  dvs_hor_coef_bytes;\n\tint  dvs_ver_coef_bytes;\n\tint  dvs_ver_proj_bytes;\n\tint  dvs_hor_proj_bytes;\n\n\t \n\tint num_flash_frames;\n\tenum atomisp_flash_state flash_state;\n\tenum atomisp_frame_status last_frame_status;\n\n\t \n\tbool css_update_params_needed;\n};\n\nstruct atomisp_css_params_with_list {\n\t \n\tstruct atomisp_css_params params;\n\tstruct list_head list;\n};\n\nstruct atomisp_sub_device {\n\tstruct v4l2_subdev subdev;\n\tstruct media_pad pads[ATOMISP_SUBDEV_PADS_NUM];\n\tstruct atomisp_pad_format fmt[ATOMISP_SUBDEV_PADS_NUM];\n\t \n\tu32 sink_pad_padding_w;\n\tu32 sink_pad_padding_h;\n\n\tunsigned int output;\n\tstruct atomisp_video_pipe video_out;\n\tstruct atomisp_device *isp;\n\tstruct v4l2_ctrl_handler ctrl_handler;\n\tstruct v4l2_ctrl *run_mode;\n\tstruct v4l2_ctrl *vfpp;\n\tstruct v4l2_ctrl *continuous_raw_buffer_size;\n\tstruct v4l2_ctrl *continuous_viewfinder;\n\tstruct v4l2_ctrl *enable_raw_buffer_lock;\n\n\t \n\tstruct v4l2_ctrl *ion_dev_fd;\n\n\tstruct v4l2_ctrl *disable_dz;\n\n\tstruct atomisp_subdev_params params;\n\n\tstruct atomisp_stream_env stream_env[ATOMISP_INPUT_STREAM_NUM];\n\n\tstruct v4l2_pix_format dvs_envelop;\n\tunsigned int s3a_bufs_in_css[IA_CSS_PIPE_ID_NUM];\n\tunsigned int dis_bufs_in_css;\n\n\tunsigned int metadata_bufs_in_css\n\t[ATOMISP_INPUT_STREAM_NUM][IA_CSS_PIPE_ID_NUM];\n\t \n\tstruct list_head metadata[ATOMISP_METADATA_TYPE_NUM];\n\t \n\tstruct list_head metadata_in_css[ATOMISP_METADATA_TYPE_NUM];\n\t \n\tstruct list_head metadata_ready[ATOMISP_METADATA_TYPE_NUM];\n\n\t \n\tstruct list_head s3a_stats;\n\t \n\tstruct list_head s3a_stats_in_css;\n\t \n\tstruct list_head s3a_stats_ready;\n\n\tstruct list_head dis_stats;\n\tstruct list_head dis_stats_in_css;\n\tspinlock_t dis_stats_lock;\n\n\tstruct ia_css_frame *vf_frame;  \n\tenum atomisp_frame_status frame_status[VIDEO_MAX_FRAME];\n\n\t \n\tint input_curr;\n\n\tatomic_t sof_count;\n\tatomic_t sequence;       \n\tatomic_t sequence_temp;\n\n\t \n\tbool streaming;\n\tbool stream_prepared;  \n\tbool recreate_streams_on_resume;\n\n\tunsigned int latest_preview_exp_id;  \n\n\tbool copy_mode;  \n\n\tint raw_buffer_bitmap[ATOMISP_MAX_EXP_ID / 32 +\n\t\t\t\t\t\t 1];  \n\tint raw_buffer_locked_count;\n\tspinlock_t raw_buffer_bitmap_lock;\n\n\t \n\tbool re_trigger_capture;\n\n\tstruct atomisp_resolution sensor_array_res;\n\tbool high_speed_mode;  \n\n\tunsigned int preview_exp_id;\n\tunsigned int postview_exp_id;\n};\n\nextern const struct atomisp_in_fmt_conv atomisp_in_fmt_conv[];\n\nu32 atomisp_subdev_uncompressed_code(u32 code);\nbool atomisp_subdev_is_compressed(u32 code);\nconst struct atomisp_in_fmt_conv *atomisp_find_in_fmt_conv(u32 code);\n\n \nconst struct atomisp_in_fmt_conv *atomisp_find_in_fmt_conv_by_atomisp_in_fmt(\n    enum atomisp_input_format atomisp_in_fmt);\n\n \nconst struct atomisp_in_fmt_conv\n*atomisp_find_in_fmt_conv_by_atomisp_in_fmt(enum atomisp_input_format\n\tatomisp_in_fmt);\n\nconst struct atomisp_in_fmt_conv *atomisp_find_in_fmt_conv_compressed(u32 code);\nbool atomisp_subdev_format_conversion(struct atomisp_sub_device *asd);\n\n \nstruct v4l2_mbus_framefmt\n*atomisp_subdev_get_ffmt(struct v4l2_subdev *sd,\n\t\t\t struct v4l2_subdev_state *sd_state, uint32_t which,\n\t\t\t uint32_t pad);\nstruct v4l2_rect *atomisp_subdev_get_rect(struct v4l2_subdev *sd,\n\tstruct v4l2_subdev_state *sd_state,\n\tu32 which, uint32_t pad,\n\tuint32_t target);\nint atomisp_subdev_set_selection(struct v4l2_subdev *sd,\n\t\t\t\t struct v4l2_subdev_state *sd_state,\n\t\t\t\t u32 which, uint32_t pad, uint32_t target,\n\t\t\t\t u32 flags, struct v4l2_rect *r);\n \nvoid atomisp_subdev_set_ffmt(struct v4l2_subdev *sd,\n\t\t\t     struct v4l2_subdev_state *sd_state,\n\t\t\t     uint32_t which,\n\t\t\t     u32 pad, struct v4l2_mbus_framefmt *ffmt);\n\nint atomisp_update_run_mode(struct atomisp_sub_device *asd);\n\nvoid atomisp_subdev_cleanup_pending_events(struct atomisp_sub_device *asd);\n\nvoid atomisp_subdev_unregister_entities(struct atomisp_sub_device *asd);\nint atomisp_subdev_register_subdev(struct atomisp_sub_device *asd,\n\t\t\t\t   struct v4l2_device *vdev);\nint atomisp_subdev_init(struct atomisp_device *isp);\nvoid atomisp_subdev_cleanup(struct atomisp_device *isp);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}