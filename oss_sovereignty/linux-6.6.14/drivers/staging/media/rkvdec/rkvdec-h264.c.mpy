{
  "module_name": "rkvdec-h264.c",
  "hash_id": "bb1ebde89485bab5806c98857629344259eb95dbfeca3da2b91271c021194817",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/rkvdec/rkvdec-h264.c",
  "human_readable_source": "\n \n\n#include <media/v4l2-h264.h>\n#include <media/v4l2-mem2mem.h>\n\n#include \"rkvdec.h\"\n#include \"rkvdec-regs.h\"\n\n \n#define RKV_CABAC_INIT_BUFFER_SIZE\t(3680 + 128)\n#define RKV_RPS_SIZE\t\t\t((128 + 128) / 4)\n#define RKV_ERROR_INFO_SIZE\t\t(256 * 144 * 4)\n\n#define RKVDEC_NUM_REFLIST\t\t3\n\nstruct rkvdec_h264_scaling_list {\n\tu8 scaling_list_4x4[6][16];\n\tu8 scaling_list_8x8[6][64];\n\tu8 padding[128];\n};\n\nstruct rkvdec_sps_pps_packet {\n\tu32 info[8];\n};\n\nstruct rkvdec_ps_field {\n\tu16 offset;\n\tu8 len;\n};\n\n#define PS_FIELD(_offset, _len) \\\n\t((struct rkvdec_ps_field){ _offset, _len })\n\n#define SEQ_PARAMETER_SET_ID\t\t\t\tPS_FIELD(0, 4)\n#define PROFILE_IDC\t\t\t\t\tPS_FIELD(4, 8)\n#define CONSTRAINT_SET3_FLAG\t\t\t\tPS_FIELD(12, 1)\n#define CHROMA_FORMAT_IDC\t\t\t\tPS_FIELD(13, 2)\n#define BIT_DEPTH_LUMA\t\t\t\t\tPS_FIELD(15, 3)\n#define BIT_DEPTH_CHROMA\t\t\t\tPS_FIELD(18, 3)\n#define QPPRIME_Y_ZERO_TRANSFORM_BYPASS_FLAG\t\tPS_FIELD(21, 1)\n#define LOG2_MAX_FRAME_NUM_MINUS4\t\t\tPS_FIELD(22, 4)\n#define MAX_NUM_REF_FRAMES\t\t\t\tPS_FIELD(26, 5)\n#define PIC_ORDER_CNT_TYPE\t\t\t\tPS_FIELD(31, 2)\n#define LOG2_MAX_PIC_ORDER_CNT_LSB_MINUS4\t\tPS_FIELD(33, 4)\n#define DELTA_PIC_ORDER_ALWAYS_ZERO_FLAG\t\tPS_FIELD(37, 1)\n#define PIC_WIDTH_IN_MBS\t\t\t\tPS_FIELD(38, 9)\n#define PIC_HEIGHT_IN_MBS\t\t\t\tPS_FIELD(47, 9)\n#define FRAME_MBS_ONLY_FLAG\t\t\t\tPS_FIELD(56, 1)\n#define MB_ADAPTIVE_FRAME_FIELD_FLAG\t\t\tPS_FIELD(57, 1)\n#define DIRECT_8X8_INFERENCE_FLAG\t\t\tPS_FIELD(58, 1)\n#define MVC_EXTENSION_ENABLE\t\t\t\tPS_FIELD(59, 1)\n#define NUM_VIEWS\t\t\t\t\tPS_FIELD(60, 2)\n#define VIEW_ID(i)\t\t\t\t\tPS_FIELD(62 + ((i) * 10), 10)\n#define NUM_ANCHOR_REFS_L(i)\t\t\t\tPS_FIELD(82 + ((i) * 11), 1)\n#define ANCHOR_REF_L(i)\t\t\t\tPS_FIELD(83 + ((i) * 11), 10)\n#define NUM_NON_ANCHOR_REFS_L(i)\t\t\tPS_FIELD(104 + ((i) * 11), 1)\n#define NON_ANCHOR_REFS_L(i)\t\t\t\tPS_FIELD(105 + ((i) * 11), 10)\n#define PIC_PARAMETER_SET_ID\t\t\t\tPS_FIELD(128, 8)\n#define PPS_SEQ_PARAMETER_SET_ID\t\t\tPS_FIELD(136, 5)\n#define ENTROPY_CODING_MODE_FLAG\t\t\tPS_FIELD(141, 1)\n#define BOTTOM_FIELD_PIC_ORDER_IN_FRAME_PRESENT_FLAG\tPS_FIELD(142, 1)\n#define NUM_REF_IDX_L_DEFAULT_ACTIVE_MINUS1(i)\t\tPS_FIELD(143 + ((i) * 5), 5)\n#define WEIGHTED_PRED_FLAG\t\t\t\tPS_FIELD(153, 1)\n#define WEIGHTED_BIPRED_IDC\t\t\t\tPS_FIELD(154, 2)\n#define PIC_INIT_QP_MINUS26\t\t\t\tPS_FIELD(156, 7)\n#define PIC_INIT_QS_MINUS26\t\t\t\tPS_FIELD(163, 6)\n#define CHROMA_QP_INDEX_OFFSET\t\t\t\tPS_FIELD(169, 5)\n#define DEBLOCKING_FILTER_CONTROL_PRESENT_FLAG\t\tPS_FIELD(174, 1)\n#define CONSTRAINED_INTRA_PRED_FLAG\t\t\tPS_FIELD(175, 1)\n#define REDUNDANT_PIC_CNT_PRESENT\t\t\tPS_FIELD(176, 1)\n#define TRANSFORM_8X8_MODE_FLAG\t\t\tPS_FIELD(177, 1)\n#define SECOND_CHROMA_QP_INDEX_OFFSET\t\t\tPS_FIELD(178, 5)\n#define SCALING_LIST_ENABLE_FLAG\t\t\tPS_FIELD(183, 1)\n#define SCALING_LIST_ADDRESS\t\t\t\tPS_FIELD(184, 32)\n#define IS_LONG_TERM(i)\t\t\t\tPS_FIELD(216 + (i), 1)\n\n#define DPB_OFFS(i, j)\t\t\t\t\t(288 + ((j) * 32 * 7) + ((i) * 7))\n#define DPB_INFO(i, j)\t\t\t\t\tPS_FIELD(DPB_OFFS(i, j), 5)\n#define BOTTOM_FLAG(i, j)\t\t\t\tPS_FIELD(DPB_OFFS(i, j) + 5, 1)\n#define VIEW_INDEX_OFF(i, j)\t\t\t\tPS_FIELD(DPB_OFFS(i, j) + 6, 1)\n\n \nstruct rkvdec_h264_priv_tbl {\n\ts8 cabac_table[4][464][2];\n\tstruct rkvdec_h264_scaling_list scaling_list;\n\tu32 rps[RKV_RPS_SIZE];\n\tstruct rkvdec_sps_pps_packet param_set[256];\n\tu8 err_info[RKV_ERROR_INFO_SIZE];\n};\n\nstruct rkvdec_h264_reflists {\n\tstruct v4l2_h264_reference p[V4L2_H264_REF_LIST_LEN];\n\tstruct v4l2_h264_reference b0[V4L2_H264_REF_LIST_LEN];\n\tstruct v4l2_h264_reference b1[V4L2_H264_REF_LIST_LEN];\n};\n\nstruct rkvdec_h264_run {\n\tstruct rkvdec_run base;\n\tconst struct v4l2_ctrl_h264_decode_params *decode_params;\n\tconst struct v4l2_ctrl_h264_sps *sps;\n\tconst struct v4l2_ctrl_h264_pps *pps;\n\tconst struct v4l2_ctrl_h264_scaling_matrix *scaling_matrix;\n\tstruct vb2_buffer *ref_buf[V4L2_H264_NUM_DPB_ENTRIES];\n};\n\nstruct rkvdec_h264_ctx {\n\tstruct rkvdec_aux_buf priv_tbl;\n\tstruct rkvdec_h264_reflists reflists;\n};\n\n#define CABAC_ENTRY(ctxidx, idc0_m, idc0_n, idc1_m, idc1_n,\t\t\\\n\t    idc2_m, idc2_n, intra_m, intra_n)\t\t\t\\\n\t[0][(ctxidx)] = {idc0_m, idc0_n},\t\t\t\\\n\t[1][(ctxidx)] = {idc1_m, idc1_n},\t\t\t\\\n\t[2][(ctxidx)] = {idc2_m, idc2_n},\t\t\t\\\n\t[3][(ctxidx)] = {intra_m, intra_n}\n\n \nstatic const s8 rkvdec_h264_cabac_table[4][464][2] = {\n\t \n\tCABAC_ENTRY(0, 20, -15, 20, -15, 20, -15, 20, -15),\n\tCABAC_ENTRY(1, 2, 54, 2, 54, 2, 54, 2, 54),\n\tCABAC_ENTRY(2, 3, 74, 3, 74, 3, 74, 3, 74),\n\tCABAC_ENTRY(3, 20, -15, 20, -15, 20, -15, 20, -15),\n\tCABAC_ENTRY(4, 2, 54, 2, 54, 2, 54, 2, 54),\n\tCABAC_ENTRY(5, 3, 74, 3, 74, 3, 74, 3, 74),\n\tCABAC_ENTRY(6, -28, 127, -28, 127, -28, 127, -28, 127),\n\tCABAC_ENTRY(7, -23, 104, -23, 104, -23, 104, -23, 104),\n\tCABAC_ENTRY(8, -6, 53, -6, 53, -6, 53, -6, 53),\n\tCABAC_ENTRY(9, -1, 54, -1, 54, -1, 54, -1, 54),\n\tCABAC_ENTRY(10, 7, 51, 7, 51, 7, 51, 7, 51),\n\n\t \n\tCABAC_ENTRY(11, 23, 33, 22, 25, 29, 16, 0, 0),\n\tCABAC_ENTRY(12, 23, 2, 34, 0, 25, 0, 0, 0),\n\tCABAC_ENTRY(13, 21, 0, 16, 0, 14, 0, 0, 0),\n\tCABAC_ENTRY(14, 1, 9, -2, 9, -10, 51, 0, 0),\n\tCABAC_ENTRY(15, 0, 49, 4, 41, -3, 62, 0, 0),\n\tCABAC_ENTRY(16, -37, 118, -29, 118, -27, 99, 0, 0),\n\tCABAC_ENTRY(17, 5, 57, 2, 65, 26, 16, 0, 0),\n\tCABAC_ENTRY(18, -13, 78, -6, 71, -4, 85, 0, 0),\n\tCABAC_ENTRY(19, -11, 65, -13, 79, -24, 102, 0, 0),\n\tCABAC_ENTRY(20, 1, 62, 5, 52, 5, 57, 0, 0),\n\tCABAC_ENTRY(21, 12, 49, 9, 50, 6, 57, 0, 0),\n\tCABAC_ENTRY(22, -4, 73, -3, 70, -17, 73, 0, 0),\n\tCABAC_ENTRY(23, 17, 50, 10, 54, 14, 57, 0, 0),\n\n\t \n\tCABAC_ENTRY(24, 18, 64, 26, 34, 20, 40, 0, 0),\n\tCABAC_ENTRY(25, 9, 43, 19, 22, 20, 10, 0, 0),\n\tCABAC_ENTRY(26, 29, 0, 40, 0, 29, 0, 0, 0),\n\tCABAC_ENTRY(27, 26, 67, 57, 2, 54, 0, 0, 0),\n\tCABAC_ENTRY(28, 16, 90, 41, 36, 37, 42, 0, 0),\n\tCABAC_ENTRY(29, 9, 104, 26, 69, 12, 97, 0, 0),\n\tCABAC_ENTRY(30, -46, 127, -45, 127, -32, 127, 0, 0),\n\tCABAC_ENTRY(31, -20, 104, -15, 101, -22, 117, 0, 0),\n\tCABAC_ENTRY(32, 1, 67, -4, 76, -2, 74, 0, 0),\n\tCABAC_ENTRY(33, -13, 78, -6, 71, -4, 85, 0, 0),\n\tCABAC_ENTRY(34, -11, 65, -13, 79, -24, 102, 0, 0),\n\tCABAC_ENTRY(35, 1, 62, 5, 52, 5, 57, 0, 0),\n\tCABAC_ENTRY(36, -6, 86, 6, 69, -6, 93, 0, 0),\n\tCABAC_ENTRY(37, -17, 95, -13, 90, -14, 88, 0, 0),\n\tCABAC_ENTRY(38, -6, 61, 0, 52, -6, 44, 0, 0),\n\tCABAC_ENTRY(39, 9, 45, 8, 43, 4, 55, 0, 0),\n\n\t \n\tCABAC_ENTRY(40, -3, 69, -2, 69, -11, 89, 0, 0),\n\tCABAC_ENTRY(41, -6, 81, -5, 82, -15, 103, 0, 0),\n\tCABAC_ENTRY(42, -11, 96, -10, 96, -21, 116, 0, 0),\n\tCABAC_ENTRY(43, 6, 55, 2, 59, 19, 57, 0, 0),\n\tCABAC_ENTRY(44, 7, 67, 2, 75, 20, 58, 0, 0),\n\tCABAC_ENTRY(45, -5, 86, -3, 87, 4, 84, 0, 0),\n\tCABAC_ENTRY(46, 2, 88, -3, 100, 6, 96, 0, 0),\n\tCABAC_ENTRY(47, 0, 58, 1, 56, 1, 63, 0, 0),\n\tCABAC_ENTRY(48, -3, 76, -3, 74, -5, 85, 0, 0),\n\tCABAC_ENTRY(49, -10, 94, -6, 85, -13, 106, 0, 0),\n\tCABAC_ENTRY(50, 5, 54, 0, 59, 5, 63, 0, 0),\n\tCABAC_ENTRY(51, 4, 69, -3, 81, 6, 75, 0, 0),\n\tCABAC_ENTRY(52, -3, 81, -7, 86, -3, 90, 0, 0),\n\tCABAC_ENTRY(53, 0, 88, -5, 95, -1, 101, 0, 0),\n\n\t \n\tCABAC_ENTRY(54, -7, 67, -1, 66, 3, 55, 0, 0),\n\tCABAC_ENTRY(55, -5, 74, -1, 77, -4, 79, 0, 0),\n\tCABAC_ENTRY(56, -4, 74, 1, 70, -2, 75, 0, 0),\n\tCABAC_ENTRY(57, -5, 80, -2, 86, -12, 97, 0, 0),\n\tCABAC_ENTRY(58, -7, 72, -5, 72, -7, 50, 0, 0),\n\tCABAC_ENTRY(59, 1, 58, 0, 61, 1, 60, 0, 0),\n\n\t \n\tCABAC_ENTRY(60, 0, 41, 0, 41, 0, 41, 0, 41),\n\tCABAC_ENTRY(61, 0, 63, 0, 63, 0, 63, 0, 63),\n\tCABAC_ENTRY(62, 0, 63, 0, 63, 0, 63, 0, 63),\n\tCABAC_ENTRY(63, 0, 63, 0, 63, 0, 63, 0, 63),\n\tCABAC_ENTRY(64, -9, 83, -9, 83, -9, 83, -9, 83),\n\tCABAC_ENTRY(65, 4, 86, 4, 86, 4, 86, 4, 86),\n\tCABAC_ENTRY(66, 0, 97, 0, 97, 0, 97, 0, 97),\n\tCABAC_ENTRY(67, -7, 72, -7, 72, -7, 72, -7, 72),\n\tCABAC_ENTRY(68, 13, 41, 13, 41, 13, 41, 13, 41),\n\tCABAC_ENTRY(69, 3, 62, 3, 62, 3, 62, 3, 62),\n\n\t \n\tCABAC_ENTRY(70, 0, 45, 13, 15, 7, 34, 0, 11),\n\tCABAC_ENTRY(71, -4, 78, 7, 51, -9, 88, 1, 55),\n\tCABAC_ENTRY(72, -3, 96, 2, 80, -20, 127, 0, 69),\n\tCABAC_ENTRY(73, -27, 126, -39, 127, -36, 127, -17, 127),\n\tCABAC_ENTRY(74, -28, 98, -18, 91, -17, 91, -13, 102),\n\tCABAC_ENTRY(75, -25, 101, -17, 96, -14, 95, 0, 82),\n\tCABAC_ENTRY(76, -23, 67, -26, 81, -25, 84, -7, 74),\n\tCABAC_ENTRY(77, -28, 82, -35, 98, -25, 86, -21, 107),\n\tCABAC_ENTRY(78, -20, 94, -24, 102, -12, 89, -27, 127),\n\tCABAC_ENTRY(79, -16, 83, -23, 97, -17, 91, -31, 127),\n\tCABAC_ENTRY(80, -22, 110, -27, 119, -31, 127, -24, 127),\n\tCABAC_ENTRY(81, -21, 91, -24, 99, -14, 76, -18, 95),\n\tCABAC_ENTRY(82, -18, 102, -21, 110, -18, 103, -27, 127),\n\tCABAC_ENTRY(83, -13, 93, -18, 102, -13, 90, -21, 114),\n\tCABAC_ENTRY(84, -29, 127, -36, 127, -37, 127, -30, 127),\n\tCABAC_ENTRY(85, -7, 92, 0, 80, 11, 80, -17, 123),\n\tCABAC_ENTRY(86, -5, 89, -5, 89, 5, 76, -12, 115),\n\tCABAC_ENTRY(87, -7, 96, -7, 94, 2, 84, -16, 122),\n\tCABAC_ENTRY(88, -13, 108, -4, 92, 5, 78, -11, 115),\n\tCABAC_ENTRY(89, -3, 46, 0, 39, -6, 55, -12, 63),\n\tCABAC_ENTRY(90, -1, 65, 0, 65, 4, 61, -2, 68),\n\tCABAC_ENTRY(91, -1, 57, -15, 84, -14, 83, -15, 84),\n\tCABAC_ENTRY(92, -9, 93, -35, 127, -37, 127, -13, 104),\n\tCABAC_ENTRY(93, -3, 74, -2, 73, -5, 79, -3, 70),\n\tCABAC_ENTRY(94, -9, 92, -12, 104, -11, 104, -8, 93),\n\tCABAC_ENTRY(95, -8, 87, -9, 91, -11, 91, -10, 90),\n\tCABAC_ENTRY(96, -23, 126, -31, 127, -30, 127, -30, 127),\n\tCABAC_ENTRY(97, 5, 54, 3, 55, 0, 65, -1, 74),\n\tCABAC_ENTRY(98, 6, 60, 7, 56, -2, 79, -6, 97),\n\tCABAC_ENTRY(99, 6, 59, 7, 55, 0, 72, -7, 91),\n\tCABAC_ENTRY(100, 6, 69, 8, 61, -4, 92, -20, 127),\n\tCABAC_ENTRY(101, -1, 48, -3, 53, -6, 56, -4, 56),\n\tCABAC_ENTRY(102, 0, 68, 0, 68, 3, 68, -5, 82),\n\tCABAC_ENTRY(103, -4, 69, -7, 74, -8, 71, -7, 76),\n\tCABAC_ENTRY(104, -8, 88, -9, 88, -13, 98, -22, 125),\n\n\t \n\tCABAC_ENTRY(105, -2, 85, -13, 103, -4, 86, -7, 93),\n\tCABAC_ENTRY(106, -6, 78, -13, 91, -12, 88, -11, 87),\n\tCABAC_ENTRY(107, -1, 75, -9, 89, -5, 82, -3, 77),\n\tCABAC_ENTRY(108, -7, 77, -14, 92, -3, 72, -5, 71),\n\tCABAC_ENTRY(109, 2, 54, -8, 76, -4, 67, -4, 63),\n\tCABAC_ENTRY(110, 5, 50, -12, 87, -8, 72, -4, 68),\n\tCABAC_ENTRY(111, -3, 68, -23, 110, -16, 89, -12, 84),\n\tCABAC_ENTRY(112, 1, 50, -24, 105, -9, 69, -7, 62),\n\tCABAC_ENTRY(113, 6, 42, -10, 78, -1, 59, -7, 65),\n\tCABAC_ENTRY(114, -4, 81, -20, 112, 5, 66, 8, 61),\n\tCABAC_ENTRY(115, 1, 63, -17, 99, 4, 57, 5, 56),\n\tCABAC_ENTRY(116, -4, 70, -78, 127, -4, 71, -2, 66),\n\tCABAC_ENTRY(117, 0, 67, -70, 127, -2, 71, 1, 64),\n\tCABAC_ENTRY(118, 2, 57, -50, 127, 2, 58, 0, 61),\n\tCABAC_ENTRY(119, -2, 76, -46, 127, -1, 74, -2, 78),\n\tCABAC_ENTRY(120, 11, 35, -4, 66, -4, 44, 1, 50),\n\tCABAC_ENTRY(121, 4, 64, -5, 78, -1, 69, 7, 52),\n\tCABAC_ENTRY(122, 1, 61, -4, 71, 0, 62, 10, 35),\n\tCABAC_ENTRY(123, 11, 35, -8, 72, -7, 51, 0, 44),\n\tCABAC_ENTRY(124, 18, 25, 2, 59, -4, 47, 11, 38),\n\tCABAC_ENTRY(125, 12, 24, -1, 55, -6, 42, 1, 45),\n\tCABAC_ENTRY(126, 13, 29, -7, 70, -3, 41, 0, 46),\n\tCABAC_ENTRY(127, 13, 36, -6, 75, -6, 53, 5, 44),\n\tCABAC_ENTRY(128, -10, 93, -8, 89, 8, 76, 31, 17),\n\tCABAC_ENTRY(129, -7, 73, -34, 119, -9, 78, 1, 51),\n\tCABAC_ENTRY(130, -2, 73, -3, 75, -11, 83, 7, 50),\n\tCABAC_ENTRY(131, 13, 46, 32, 20, 9, 52, 28, 19),\n\tCABAC_ENTRY(132, 9, 49, 30, 22, 0, 67, 16, 33),\n\tCABAC_ENTRY(133, -7, 100, -44, 127, -5, 90, 14, 62),\n\tCABAC_ENTRY(134, 9, 53, 0, 54, 1, 67, -13, 108),\n\tCABAC_ENTRY(135, 2, 53, -5, 61, -15, 72, -15, 100),\n\tCABAC_ENTRY(136, 5, 53, 0, 58, -5, 75, -13, 101),\n\tCABAC_ENTRY(137, -2, 61, -1, 60, -8, 80, -13, 91),\n\tCABAC_ENTRY(138, 0, 56, -3, 61, -21, 83, -12, 94),\n\tCABAC_ENTRY(139, 0, 56, -8, 67, -21, 64, -10, 88),\n\tCABAC_ENTRY(140, -13, 63, -25, 84, -13, 31, -16, 84),\n\tCABAC_ENTRY(141, -5, 60, -14, 74, -25, 64, -10, 86),\n\tCABAC_ENTRY(142, -1, 62, -5, 65, -29, 94, -7, 83),\n\tCABAC_ENTRY(143, 4, 57, 5, 52, 9, 75, -13, 87),\n\tCABAC_ENTRY(144, -6, 69, 2, 57, 17, 63, -19, 94),\n\tCABAC_ENTRY(145, 4, 57, 0, 61, -8, 74, 1, 70),\n\tCABAC_ENTRY(146, 14, 39, -9, 69, -5, 35, 0, 72),\n\tCABAC_ENTRY(147, 4, 51, -11, 70, -2, 27, -5, 74),\n\tCABAC_ENTRY(148, 13, 68, 18, 55, 13, 91, 18, 59),\n\tCABAC_ENTRY(149, 3, 64, -4, 71, 3, 65, -8, 102),\n\tCABAC_ENTRY(150, 1, 61, 0, 58, -7, 69, -15, 100),\n\tCABAC_ENTRY(151, 9, 63, 7, 61, 8, 77, 0, 95),\n\tCABAC_ENTRY(152, 7, 50, 9, 41, -10, 66, -4, 75),\n\tCABAC_ENTRY(153, 16, 39, 18, 25, 3, 62, 2, 72),\n\tCABAC_ENTRY(154, 5, 44, 9, 32, -3, 68, -11, 75),\n\tCABAC_ENTRY(155, 4, 52, 5, 43, -20, 81, -3, 71),\n\tCABAC_ENTRY(156, 11, 48, 9, 47, 0, 30, 15, 46),\n\tCABAC_ENTRY(157, -5, 60, 0, 44, 1, 7, -13, 69),\n\tCABAC_ENTRY(158, -1, 59, 0, 51, -3, 23, 0, 62),\n\tCABAC_ENTRY(159, 0, 59, 2, 46, -21, 74, 0, 65),\n\tCABAC_ENTRY(160, 22, 33, 19, 38, 16, 66, 21, 37),\n\tCABAC_ENTRY(161, 5, 44, -4, 66, -23, 124, -15, 72),\n\tCABAC_ENTRY(162, 14, 43, 15, 38, 17, 37, 9, 57),\n\tCABAC_ENTRY(163, -1, 78, 12, 42, 44, -18, 16, 54),\n\tCABAC_ENTRY(164, 0, 60, 9, 34, 50, -34, 0, 62),\n\tCABAC_ENTRY(165, 9, 69, 0, 89, -22, 127, 12, 72),\n\n\t \n\tCABAC_ENTRY(166, 11, 28, 4, 45, 4, 39, 24, 0),\n\tCABAC_ENTRY(167, 2, 40, 10, 28, 0, 42, 15, 9),\n\tCABAC_ENTRY(168, 3, 44, 10, 31, 7, 34, 8, 25),\n\tCABAC_ENTRY(169, 0, 49, 33, -11, 11, 29, 13, 18),\n\tCABAC_ENTRY(170, 0, 46, 52, -43, 8, 31, 15, 9),\n\tCABAC_ENTRY(171, 2, 44, 18, 15, 6, 37, 13, 19),\n\tCABAC_ENTRY(172, 2, 51, 28, 0, 7, 42, 10, 37),\n\tCABAC_ENTRY(173, 0, 47, 35, -22, 3, 40, 12, 18),\n\tCABAC_ENTRY(174, 4, 39, 38, -25, 8, 33, 6, 29),\n\tCABAC_ENTRY(175, 2, 62, 34, 0, 13, 43, 20, 33),\n\tCABAC_ENTRY(176, 6, 46, 39, -18, 13, 36, 15, 30),\n\tCABAC_ENTRY(177, 0, 54, 32, -12, 4, 47, 4, 45),\n\tCABAC_ENTRY(178, 3, 54, 102, -94, 3, 55, 1, 58),\n\tCABAC_ENTRY(179, 2, 58, 0, 0, 2, 58, 0, 62),\n\tCABAC_ENTRY(180, 4, 63, 56, -15, 6, 60, 7, 61),\n\tCABAC_ENTRY(181, 6, 51, 33, -4, 8, 44, 12, 38),\n\tCABAC_ENTRY(182, 6, 57, 29, 10, 11, 44, 11, 45),\n\tCABAC_ENTRY(183, 7, 53, 37, -5, 14, 42, 15, 39),\n\tCABAC_ENTRY(184, 6, 52, 51, -29, 7, 48, 11, 42),\n\tCABAC_ENTRY(185, 6, 55, 39, -9, 4, 56, 13, 44),\n\tCABAC_ENTRY(186, 11, 45, 52, -34, 4, 52, 16, 45),\n\tCABAC_ENTRY(187, 14, 36, 69, -58, 13, 37, 12, 41),\n\tCABAC_ENTRY(188, 8, 53, 67, -63, 9, 49, 10, 49),\n\tCABAC_ENTRY(189, -1, 82, 44, -5, 19, 58, 30, 34),\n\tCABAC_ENTRY(190, 7, 55, 32, 7, 10, 48, 18, 42),\n\tCABAC_ENTRY(191, -3, 78, 55, -29, 12, 45, 10, 55),\n\tCABAC_ENTRY(192, 15, 46, 32, 1, 0, 69, 17, 51),\n\tCABAC_ENTRY(193, 22, 31, 0, 0, 20, 33, 17, 46),\n\tCABAC_ENTRY(194, -1, 84, 27, 36, 8, 63, 0, 89),\n\tCABAC_ENTRY(195, 25, 7, 33, -25, 35, -18, 26, -19),\n\tCABAC_ENTRY(196, 30, -7, 34, -30, 33, -25, 22, -17),\n\tCABAC_ENTRY(197, 28, 3, 36, -28, 28, -3, 26, -17),\n\tCABAC_ENTRY(198, 28, 4, 38, -28, 24, 10, 30, -25),\n\tCABAC_ENTRY(199, 32, 0, 38, -27, 27, 0, 28, -20),\n\tCABAC_ENTRY(200, 34, -1, 34, -18, 34, -14, 33, -23),\n\tCABAC_ENTRY(201, 30, 6, 35, -16, 52, -44, 37, -27),\n\tCABAC_ENTRY(202, 30, 6, 34, -14, 39, -24, 33, -23),\n\tCABAC_ENTRY(203, 32, 9, 32, -8, 19, 17, 40, -28),\n\tCABAC_ENTRY(204, 31, 19, 37, -6, 31, 25, 38, -17),\n\tCABAC_ENTRY(205, 26, 27, 35, 0, 36, 29, 33, -11),\n\tCABAC_ENTRY(206, 26, 30, 30, 10, 24, 33, 40, -15),\n\tCABAC_ENTRY(207, 37, 20, 28, 18, 34, 15, 41, -6),\n\tCABAC_ENTRY(208, 28, 34, 26, 25, 30, 20, 38, 1),\n\tCABAC_ENTRY(209, 17, 70, 29, 41, 22, 73, 41, 17),\n\tCABAC_ENTRY(210, 1, 67, 0, 75, 20, 34, 30, -6),\n\tCABAC_ENTRY(211, 5, 59, 2, 72, 19, 31, 27, 3),\n\tCABAC_ENTRY(212, 9, 67, 8, 77, 27, 44, 26, 22),\n\tCABAC_ENTRY(213, 16, 30, 14, 35, 19, 16, 37, -16),\n\tCABAC_ENTRY(214, 18, 32, 18, 31, 15, 36, 35, -4),\n\tCABAC_ENTRY(215, 18, 35, 17, 35, 15, 36, 38, -8),\n\tCABAC_ENTRY(216, 22, 29, 21, 30, 21, 28, 38, -3),\n\tCABAC_ENTRY(217, 24, 31, 17, 45, 25, 21, 37, 3),\n\tCABAC_ENTRY(218, 23, 38, 20, 42, 30, 20, 38, 5),\n\tCABAC_ENTRY(219, 18, 43, 18, 45, 31, 12, 42, 0),\n\tCABAC_ENTRY(220, 20, 41, 27, 26, 27, 16, 35, 16),\n\tCABAC_ENTRY(221, 11, 63, 16, 54, 24, 42, 39, 22),\n\tCABAC_ENTRY(222, 9, 59, 7, 66, 0, 93, 14, 48),\n\tCABAC_ENTRY(223, 9, 64, 16, 56, 14, 56, 27, 37),\n\tCABAC_ENTRY(224, -1, 94, 11, 73, 15, 57, 21, 60),\n\tCABAC_ENTRY(225, -2, 89, 10, 67, 26, 38, 12, 68),\n\tCABAC_ENTRY(226, -9, 108, -10, 116, -24, 127, 2, 97),\n\n\t \n\tCABAC_ENTRY(227, -6, 76, -23, 112, -24, 115, -3, 71),\n\tCABAC_ENTRY(228, -2, 44, -15, 71, -22, 82, -6, 42),\n\tCABAC_ENTRY(229, 0, 45, -7, 61, -9, 62, -5, 50),\n\tCABAC_ENTRY(230, 0, 52, 0, 53, 0, 53, -3, 54),\n\tCABAC_ENTRY(231, -3, 64, -5, 66, 0, 59, -2, 62),\n\tCABAC_ENTRY(232, -2, 59, -11, 77, -14, 85, 0, 58),\n\tCABAC_ENTRY(233, -4, 70, -9, 80, -13, 89, 1, 63),\n\tCABAC_ENTRY(234, -4, 75, -9, 84, -13, 94, -2, 72),\n\tCABAC_ENTRY(235, -8, 82, -10, 87, -11, 92, -1, 74),\n\tCABAC_ENTRY(236, -17, 102, -34, 127, -29, 127, -9, 91),\n\tCABAC_ENTRY(237, -9, 77, -21, 101, -21, 100, -5, 67),\n\tCABAC_ENTRY(238, 3, 24, -3, 39, -14, 57, -5, 27),\n\tCABAC_ENTRY(239, 0, 42, -5, 53, -12, 67, -3, 39),\n\tCABAC_ENTRY(240, 0, 48, -7, 61, -11, 71, -2, 44),\n\tCABAC_ENTRY(241, 0, 55, -11, 75, -10, 77, 0, 46),\n\tCABAC_ENTRY(242, -6, 59, -15, 77, -21, 85, -16, 64),\n\tCABAC_ENTRY(243, -7, 71, -17, 91, -16, 88, -8, 68),\n\tCABAC_ENTRY(244, -12, 83, -25, 107, -23, 104, -10, 78),\n\tCABAC_ENTRY(245, -11, 87, -25, 111, -15, 98, -6, 77),\n\tCABAC_ENTRY(246, -30, 119, -28, 122, -37, 127, -10, 86),\n\tCABAC_ENTRY(247, 1, 58, -11, 76, -10, 82, -12, 92),\n\tCABAC_ENTRY(248, -3, 29, -10, 44, -8, 48, -15, 55),\n\tCABAC_ENTRY(249, -1, 36, -10, 52, -8, 61, -10, 60),\n\tCABAC_ENTRY(250, 1, 38, -10, 57, -8, 66, -6, 62),\n\tCABAC_ENTRY(251, 2, 43, -9, 58, -7, 70, -4, 65),\n\tCABAC_ENTRY(252, -6, 55, -16, 72, -14, 75, -12, 73),\n\tCABAC_ENTRY(253, 0, 58, -7, 69, -10, 79, -8, 76),\n\tCABAC_ENTRY(254, 0, 64, -4, 69, -9, 83, -7, 80),\n\tCABAC_ENTRY(255, -3, 74, -5, 74, -12, 92, -9, 88),\n\tCABAC_ENTRY(256, -10, 90, -9, 86, -18, 108, -17, 110),\n\tCABAC_ENTRY(257, 0, 70, 2, 66, -4, 79, -11, 97),\n\tCABAC_ENTRY(258, -4, 29, -9, 34, -22, 69, -20, 84),\n\tCABAC_ENTRY(259, 5, 31, 1, 32, -16, 75, -11, 79),\n\tCABAC_ENTRY(260, 7, 42, 11, 31, -2, 58, -6, 73),\n\tCABAC_ENTRY(261, 1, 59, 5, 52, 1, 58, -4, 74),\n\tCABAC_ENTRY(262, -2, 58, -2, 55, -13, 78, -13, 86),\n\tCABAC_ENTRY(263, -3, 72, -2, 67, -9, 83, -13, 96),\n\tCABAC_ENTRY(264, -3, 81, 0, 73, -4, 81, -11, 97),\n\tCABAC_ENTRY(265, -11, 97, -8, 89, -13, 99, -19, 117),\n\tCABAC_ENTRY(266, 0, 58, 3, 52, -13, 81, -8, 78),\n\tCABAC_ENTRY(267, 8, 5, 7, 4, -6, 38, -5, 33),\n\tCABAC_ENTRY(268, 10, 14, 10, 8, -13, 62, -4, 48),\n\tCABAC_ENTRY(269, 14, 18, 17, 8, -6, 58, -2, 53),\n\tCABAC_ENTRY(270, 13, 27, 16, 19, -2, 59, -3, 62),\n\tCABAC_ENTRY(271, 2, 40, 3, 37, -16, 73, -13, 71),\n\tCABAC_ENTRY(272, 0, 58, -1, 61, -10, 76, -10, 79),\n\tCABAC_ENTRY(273, -3, 70, -5, 73, -13, 86, -12, 86),\n\tCABAC_ENTRY(274, -6, 79, -1, 70, -9, 83, -13, 90),\n\tCABAC_ENTRY(275, -8, 85, -4, 78, -10, 87, -14, 97),\n\n\t \n\tCABAC_ENTRY(277, -13, 106, -21, 126, -22, 127, -6, 93),\n\tCABAC_ENTRY(278, -16, 106, -23, 124, -25, 127, -6, 84),\n\tCABAC_ENTRY(279, -10, 87, -20, 110, -25, 120, -8, 79),\n\tCABAC_ENTRY(280, -21, 114, -26, 126, -27, 127, 0, 66),\n\tCABAC_ENTRY(281, -18, 110, -25, 124, -19, 114, -1, 71),\n\tCABAC_ENTRY(282, -14, 98, -17, 105, -23, 117, 0, 62),\n\tCABAC_ENTRY(283, -22, 110, -27, 121, -25, 118, -2, 60),\n\tCABAC_ENTRY(284, -21, 106, -27, 117, -26, 117, -2, 59),\n\tCABAC_ENTRY(285, -18, 103, -17, 102, -24, 113, -5, 75),\n\tCABAC_ENTRY(286, -21, 107, -26, 117, -28, 118, -3, 62),\n\tCABAC_ENTRY(287, -23, 108, -27, 116, -31, 120, -4, 58),\n\tCABAC_ENTRY(288, -26, 112, -33, 122, -37, 124, -9, 66),\n\tCABAC_ENTRY(289, -10, 96, -10, 95, -10, 94, -1, 79),\n\tCABAC_ENTRY(290, -12, 95, -14, 100, -15, 102, 0, 71),\n\tCABAC_ENTRY(291, -5, 91, -8, 95, -10, 99, 3, 68),\n\tCABAC_ENTRY(292, -9, 93, -17, 111, -13, 106, 10, 44),\n\tCABAC_ENTRY(293, -22, 94, -28, 114, -50, 127, -7, 62),\n\tCABAC_ENTRY(294, -5, 86, -6, 89, -5, 92, 15, 36),\n\tCABAC_ENTRY(295, 9, 67, -2, 80, 17, 57, 14, 40),\n\tCABAC_ENTRY(296, -4, 80, -4, 82, -5, 86, 16, 27),\n\tCABAC_ENTRY(297, -10, 85, -9, 85, -13, 94, 12, 29),\n\tCABAC_ENTRY(298, -1, 70, -8, 81, -12, 91, 1, 44),\n\tCABAC_ENTRY(299, 7, 60, -1, 72, -2, 77, 20, 36),\n\tCABAC_ENTRY(300, 9, 58, 5, 64, 0, 71, 18, 32),\n\tCABAC_ENTRY(301, 5, 61, 1, 67, -1, 73, 5, 42),\n\tCABAC_ENTRY(302, 12, 50, 9, 56, 4, 64, 1, 48),\n\tCABAC_ENTRY(303, 15, 50, 0, 69, -7, 81, 10, 62),\n\tCABAC_ENTRY(304, 18, 49, 1, 69, 5, 64, 17, 46),\n\tCABAC_ENTRY(305, 17, 54, 7, 69, 15, 57, 9, 64),\n\tCABAC_ENTRY(306, 10, 41, -7, 69, 1, 67, -12, 104),\n\tCABAC_ENTRY(307, 7, 46, -6, 67, 0, 68, -11, 97),\n\tCABAC_ENTRY(308, -1, 51, -16, 77, -10, 67, -16, 96),\n\tCABAC_ENTRY(309, 7, 49, -2, 64, 1, 68, -7, 88),\n\tCABAC_ENTRY(310, 8, 52, 2, 61, 0, 77, -8, 85),\n\tCABAC_ENTRY(311, 9, 41, -6, 67, 2, 64, -7, 85),\n\tCABAC_ENTRY(312, 6, 47, -3, 64, 0, 68, -9, 85),\n\tCABAC_ENTRY(313, 2, 55, 2, 57, -5, 78, -13, 88),\n\tCABAC_ENTRY(314, 13, 41, -3, 65, 7, 55, 4, 66),\n\tCABAC_ENTRY(315, 10, 44, -3, 66, 5, 59, -3, 77),\n\tCABAC_ENTRY(316, 6, 50, 0, 62, 2, 65, -3, 76),\n\tCABAC_ENTRY(317, 5, 53, 9, 51, 14, 54, -6, 76),\n\tCABAC_ENTRY(318, 13, 49, -1, 66, 15, 44, 10, 58),\n\tCABAC_ENTRY(319, 4, 63, -2, 71, 5, 60, -1, 76),\n\tCABAC_ENTRY(320, 6, 64, -2, 75, 2, 70, -1, 83),\n\tCABAC_ENTRY(321, -2, 69, -1, 70, -2, 76, -7, 99),\n\tCABAC_ENTRY(322, -2, 59, -9, 72, -18, 86, -14, 95),\n\tCABAC_ENTRY(323, 6, 70, 14, 60, 12, 70, 2, 95),\n\tCABAC_ENTRY(324, 10, 44, 16, 37, 5, 64, 0, 76),\n\tCABAC_ENTRY(325, 9, 31, 0, 47, -12, 70, -5, 74),\n\tCABAC_ENTRY(326, 12, 43, 18, 35, 11, 55, 0, 70),\n\tCABAC_ENTRY(327, 3, 53, 11, 37, 5, 56, -11, 75),\n\tCABAC_ENTRY(328, 14, 34, 12, 41, 0, 69, 1, 68),\n\tCABAC_ENTRY(329, 10, 38, 10, 41, 2, 65, 0, 65),\n\tCABAC_ENTRY(330, -3, 52, 2, 48, -6, 74, -14, 73),\n\tCABAC_ENTRY(331, 13, 40, 12, 41, 5, 54, 3, 62),\n\tCABAC_ENTRY(332, 17, 32, 13, 41, 7, 54, 4, 62),\n\tCABAC_ENTRY(333, 7, 44, 0, 59, -6, 76, -1, 68),\n\tCABAC_ENTRY(334, 7, 38, 3, 50, -11, 82, -13, 75),\n\tCABAC_ENTRY(335, 13, 50, 19, 40, -2, 77, 11, 55),\n\tCABAC_ENTRY(336, 10, 57, 3, 66, -2, 77, 5, 64),\n\tCABAC_ENTRY(337, 26, 43, 18, 50, 25, 42, 12, 70),\n\n\t \n\tCABAC_ENTRY(338, 14, 11, 19, -6, 17, -13, 15, 6),\n\tCABAC_ENTRY(339, 11, 14, 18, -6, 16, -9, 6, 19),\n\tCABAC_ENTRY(340, 9, 11, 14, 0, 17, -12, 7, 16),\n\tCABAC_ENTRY(341, 18, 11, 26, -12, 27, -21, 12, 14),\n\tCABAC_ENTRY(342, 21, 9, 31, -16, 37, -30, 18, 13),\n\tCABAC_ENTRY(343, 23, -2, 33, -25, 41, -40, 13, 11),\n\tCABAC_ENTRY(344, 32, -15, 33, -22, 42, -41, 13, 15),\n\tCABAC_ENTRY(345, 32, -15, 37, -28, 48, -47, 15, 16),\n\tCABAC_ENTRY(346, 34, -21, 39, -30, 39, -32, 12, 23),\n\tCABAC_ENTRY(347, 39, -23, 42, -30, 46, -40, 13, 23),\n\tCABAC_ENTRY(348, 42, -33, 47, -42, 52, -51, 15, 20),\n\tCABAC_ENTRY(349, 41, -31, 45, -36, 46, -41, 14, 26),\n\tCABAC_ENTRY(350, 46, -28, 49, -34, 52, -39, 14, 44),\n\tCABAC_ENTRY(351, 38, -12, 41, -17, 43, -19, 17, 40),\n\tCABAC_ENTRY(352, 21, 29, 32, 9, 32, 11, 17, 47),\n\tCABAC_ENTRY(353, 45, -24, 69, -71, 61, -55, 24, 17),\n\tCABAC_ENTRY(354, 53, -45, 63, -63, 56, -46, 21, 21),\n\tCABAC_ENTRY(355, 48, -26, 66, -64, 62, -50, 25, 22),\n\tCABAC_ENTRY(356, 65, -43, 77, -74, 81, -67, 31, 27),\n\tCABAC_ENTRY(357, 43, -19, 54, -39, 45, -20, 22, 29),\n\tCABAC_ENTRY(358, 39, -10, 52, -35, 35, -2, 19, 35),\n\tCABAC_ENTRY(359, 30, 9, 41, -10, 28, 15, 14, 50),\n\tCABAC_ENTRY(360, 18, 26, 36, 0, 34, 1, 10, 57),\n\tCABAC_ENTRY(361, 20, 27, 40, -1, 39, 1, 7, 63),\n\tCABAC_ENTRY(362, 0, 57, 30, 14, 30, 17, -2, 77),\n\tCABAC_ENTRY(363, -14, 82, 28, 26, 20, 38, -4, 82),\n\tCABAC_ENTRY(364, -5, 75, 23, 37, 18, 45, -3, 94),\n\tCABAC_ENTRY(365, -19, 97, 12, 55, 15, 54, 9, 69),\n\tCABAC_ENTRY(366, -35, 125, 11, 65, 0, 79, -12, 109),\n\tCABAC_ENTRY(367, 27, 0, 37, -33, 36, -16, 36, -35),\n\tCABAC_ENTRY(368, 28, 0, 39, -36, 37, -14, 36, -34),\n\tCABAC_ENTRY(369, 31, -4, 40, -37, 37, -17, 32, -26),\n\tCABAC_ENTRY(370, 27, 6, 38, -30, 32, 1, 37, -30),\n\tCABAC_ENTRY(371, 34, 8, 46, -33, 34, 15, 44, -32),\n\tCABAC_ENTRY(372, 30, 10, 42, -30, 29, 15, 34, -18),\n\tCABAC_ENTRY(373, 24, 22, 40, -24, 24, 25, 34, -15),\n\tCABAC_ENTRY(374, 33, 19, 49, -29, 34, 22, 40, -15),\n\tCABAC_ENTRY(375, 22, 32, 38, -12, 31, 16, 33, -7),\n\tCABAC_ENTRY(376, 26, 31, 40, -10, 35, 18, 35, -5),\n\tCABAC_ENTRY(377, 21, 41, 38, -3, 31, 28, 33, 0),\n\tCABAC_ENTRY(378, 26, 44, 46, -5, 33, 41, 38, 2),\n\tCABAC_ENTRY(379, 23, 47, 31, 20, 36, 28, 33, 13),\n\tCABAC_ENTRY(380, 16, 65, 29, 30, 27, 47, 23, 35),\n\tCABAC_ENTRY(381, 14, 71, 25, 44, 21, 62, 13, 58),\n\tCABAC_ENTRY(382, 8, 60, 12, 48, 18, 31, 29, -3),\n\tCABAC_ENTRY(383, 6, 63, 11, 49, 19, 26, 26, 0),\n\tCABAC_ENTRY(384, 17, 65, 26, 45, 36, 24, 22, 30),\n\tCABAC_ENTRY(385, 21, 24, 22, 22, 24, 23, 31, -7),\n\tCABAC_ENTRY(386, 23, 20, 23, 22, 27, 16, 35, -15),\n\tCABAC_ENTRY(387, 26, 23, 27, 21, 24, 30, 34, -3),\n\tCABAC_ENTRY(388, 27, 32, 33, 20, 31, 29, 34, 3),\n\tCABAC_ENTRY(389, 28, 23, 26, 28, 22, 41, 36, -1),\n\tCABAC_ENTRY(390, 28, 24, 30, 24, 22, 42, 34, 5),\n\tCABAC_ENTRY(391, 23, 40, 27, 34, 16, 60, 32, 11),\n\tCABAC_ENTRY(392, 24, 32, 18, 42, 15, 52, 35, 5),\n\tCABAC_ENTRY(393, 28, 29, 25, 39, 14, 60, 34, 12),\n\tCABAC_ENTRY(394, 23, 42, 18, 50, 3, 78, 39, 11),\n\tCABAC_ENTRY(395, 19, 57, 12, 70, -16, 123, 30, 29),\n\tCABAC_ENTRY(396, 22, 53, 21, 54, 21, 53, 34, 26),\n\tCABAC_ENTRY(397, 22, 61, 14, 71, 22, 56, 29, 39),\n\tCABAC_ENTRY(398, 11, 86, 11, 83, 25, 61, 19, 66),\n\n\t \n\tCABAC_ENTRY(399, 12, 40, 25, 32, 21, 33, 31, 21),\n\tCABAC_ENTRY(400, 11, 51, 21, 49, 19, 50, 31, 31),\n\tCABAC_ENTRY(401, 14, 59, 21, 54, 17, 61, 25, 50),\n\tCABAC_ENTRY(402, -4, 79, -5, 85, -3, 78, -17, 120),\n\tCABAC_ENTRY(403, -7, 71, -6, 81, -8, 74, -20, 112),\n\tCABAC_ENTRY(404, -5, 69, -10, 77, -9, 72, -18, 114),\n\tCABAC_ENTRY(405, -9, 70, -7, 81, -10, 72, -11, 85),\n\tCABAC_ENTRY(406, -8, 66, -17, 80, -18, 75, -15, 92),\n\tCABAC_ENTRY(407, -10, 68, -18, 73, -12, 71, -14, 89),\n\tCABAC_ENTRY(408, -19, 73, -4, 74, -11, 63, -26, 71),\n\tCABAC_ENTRY(409, -12, 69, -10, 83, -5, 70, -15, 81),\n\tCABAC_ENTRY(410, -16, 70, -9, 71, -17, 75, -14, 80),\n\tCABAC_ENTRY(411, -15, 67, -9, 67, -14, 72, 0, 68),\n\tCABAC_ENTRY(412, -20, 62, -1, 61, -16, 67, -14, 70),\n\tCABAC_ENTRY(413, -19, 70, -8, 66, -8, 53, -24, 56),\n\tCABAC_ENTRY(414, -16, 66, -14, 66, -14, 59, -23, 68),\n\tCABAC_ENTRY(415, -22, 65, 0, 59, -9, 52, -24, 50),\n\tCABAC_ENTRY(416, -20, 63, 2, 59, -11, 68, -11, 74),\n\tCABAC_ENTRY(417, 9, -2, 17, -10, 9, -2, 23, -13),\n\tCABAC_ENTRY(418, 26, -9, 32, -13, 30, -10, 26, -13),\n\tCABAC_ENTRY(419, 33, -9, 42, -9, 31, -4, 40, -15),\n\tCABAC_ENTRY(420, 39, -7, 49, -5, 33, -1, 49, -14),\n\tCABAC_ENTRY(421, 41, -2, 53, 0, 33, 7, 44, 3),\n\tCABAC_ENTRY(422, 45, 3, 64, 3, 31, 12, 45, 6),\n\tCABAC_ENTRY(423, 49, 9, 68, 10, 37, 23, 44, 34),\n\tCABAC_ENTRY(424, 45, 27, 66, 27, 31, 38, 33, 54),\n\tCABAC_ENTRY(425, 36, 59, 47, 57, 20, 64, 19, 82),\n\tCABAC_ENTRY(426, -6, 66, -5, 71, -9, 71, -3, 75),\n\tCABAC_ENTRY(427, -7, 35, 0, 24, -7, 37, -1, 23),\n\tCABAC_ENTRY(428, -7, 42, -1, 36, -8, 44, 1, 34),\n\tCABAC_ENTRY(429, -8, 45, -2, 42, -11, 49, 1, 43),\n\tCABAC_ENTRY(430, -5, 48, -2, 52, -10, 56, 0, 54),\n\tCABAC_ENTRY(431, -12, 56, -9, 57, -12, 59, -2, 55),\n\tCABAC_ENTRY(432, -6, 60, -6, 63, -8, 63, 0, 61),\n\tCABAC_ENTRY(433, -5, 62, -4, 65, -9, 67, 1, 64),\n\tCABAC_ENTRY(434, -8, 66, -4, 67, -6, 68, 0, 68),\n\tCABAC_ENTRY(435, -8, 76, -7, 82, -10, 79, -9, 92),\n\tCABAC_ENTRY(436, -5, 85, -3, 81, -3, 78, -14, 106),\n\tCABAC_ENTRY(437, -6, 81, -3, 76, -8, 74, -13, 97),\n\tCABAC_ENTRY(438, -10, 77, -7, 72, -9, 72, -15, 90),\n\tCABAC_ENTRY(439, -7, 81, -6, 78, -10, 72, -12, 90),\n\tCABAC_ENTRY(440, -17, 80, -12, 72, -18, 75, -18, 88),\n\tCABAC_ENTRY(441, -18, 73, -14, 68, -12, 71, -10, 73),\n\tCABAC_ENTRY(442, -4, 74, -3, 70, -11, 63, -9, 79),\n\tCABAC_ENTRY(443, -10, 83, -6, 76, -5, 70, -14, 86),\n\tCABAC_ENTRY(444, -9, 71, -5, 66, -17, 75, -10, 73),\n\tCABAC_ENTRY(445, -9, 67, -5, 62, -14, 72, -10, 70),\n\tCABAC_ENTRY(446, -1, 61, 0, 57, -16, 67, -10, 69),\n\tCABAC_ENTRY(447, -8, 66, -4, 61, -8, 53, -5, 66),\n\tCABAC_ENTRY(448, -14, 66, -9, 60, -14, 59, -9, 64),\n\tCABAC_ENTRY(449, 0, 59, 1, 54, -9, 52, -5, 58),\n\tCABAC_ENTRY(450, 2, 59, 2, 58, -11, 68, 2, 59),\n\tCABAC_ENTRY(451, 21, -13, 17, -10, 9, -2, 21, -10),\n\tCABAC_ENTRY(452, 33, -14, 32, -13, 30, -10, 24, -11),\n\tCABAC_ENTRY(453, 39, -7, 42, -9, 31, -4, 28, -8),\n\tCABAC_ENTRY(454, 46, -2, 49, -5, 33, -1, 28, -1),\n\tCABAC_ENTRY(455, 51, 2, 53, 0, 33, 7, 29, 3),\n\tCABAC_ENTRY(456, 60, 6, 64, 3, 31, 12, 29, 9),\n\tCABAC_ENTRY(457, 61, 17, 68, 10, 37, 23, 35, 20),\n\tCABAC_ENTRY(458, 55, 34, 66, 27, 31, 38, 29, 36),\n\tCABAC_ENTRY(459, 42, 62, 47, 57, 20, 64, 14, 67),\n};\n\nstatic void set_ps_field(u32 *buf, struct rkvdec_ps_field field, u32 value)\n{\n\tu8 bit = field.offset % 32, word = field.offset / 32;\n\tu64 mask = GENMASK_ULL(bit + field.len - 1, bit);\n\tu64 val = ((u64)value << bit) & mask;\n\n\tbuf[word] &= ~mask;\n\tbuf[word] |= val;\n\tif (bit + field.len > 32) {\n\t\tbuf[word + 1] &= ~(mask >> 32);\n\t\tbuf[word + 1] |= val >> 32;\n\t}\n}\n\nstatic void assemble_hw_pps(struct rkvdec_ctx *ctx,\n\t\t\t    struct rkvdec_h264_run *run)\n{\n\tstruct rkvdec_h264_ctx *h264_ctx = ctx->priv;\n\tconst struct v4l2_ctrl_h264_sps *sps = run->sps;\n\tconst struct v4l2_ctrl_h264_pps *pps = run->pps;\n\tconst struct v4l2_ctrl_h264_decode_params *dec_params = run->decode_params;\n\tconst struct v4l2_h264_dpb_entry *dpb = dec_params->dpb;\n\tstruct rkvdec_h264_priv_tbl *priv_tbl = h264_ctx->priv_tbl.cpu;\n\tstruct rkvdec_sps_pps_packet *hw_ps;\n\tdma_addr_t scaling_list_address;\n\tu32 scaling_distance;\n\tu32 i;\n\n\t \n\thw_ps = &priv_tbl->param_set[pps->pic_parameter_set_id];\n\tmemset(hw_ps, 0, sizeof(*hw_ps));\n\n#define WRITE_PPS(value, field) set_ps_field(hw_ps->info, field, value)\n\t \n\tWRITE_PPS(0xf, SEQ_PARAMETER_SET_ID);\n\tWRITE_PPS(0xff, PROFILE_IDC);\n\tWRITE_PPS(1, CONSTRAINT_SET3_FLAG);\n\tWRITE_PPS(sps->chroma_format_idc, CHROMA_FORMAT_IDC);\n\tWRITE_PPS(sps->bit_depth_luma_minus8, BIT_DEPTH_LUMA);\n\tWRITE_PPS(sps->bit_depth_chroma_minus8, BIT_DEPTH_CHROMA);\n\tWRITE_PPS(0, QPPRIME_Y_ZERO_TRANSFORM_BYPASS_FLAG);\n\tWRITE_PPS(sps->log2_max_frame_num_minus4, LOG2_MAX_FRAME_NUM_MINUS4);\n\tWRITE_PPS(sps->max_num_ref_frames, MAX_NUM_REF_FRAMES);\n\tWRITE_PPS(sps->pic_order_cnt_type, PIC_ORDER_CNT_TYPE);\n\tWRITE_PPS(sps->log2_max_pic_order_cnt_lsb_minus4,\n\t\t  LOG2_MAX_PIC_ORDER_CNT_LSB_MINUS4);\n\tWRITE_PPS(!!(sps->flags & V4L2_H264_SPS_FLAG_DELTA_PIC_ORDER_ALWAYS_ZERO),\n\t\t  DELTA_PIC_ORDER_ALWAYS_ZERO_FLAG);\n\n\t \n\tWRITE_PPS(sps->pic_width_in_mbs_minus1 + 1, PIC_WIDTH_IN_MBS);\n\tWRITE_PPS(sps->pic_height_in_map_units_minus1 + 1, PIC_HEIGHT_IN_MBS);\n\n\tWRITE_PPS(!!(sps->flags & V4L2_H264_SPS_FLAG_FRAME_MBS_ONLY),\n\t\t  FRAME_MBS_ONLY_FLAG);\n\tWRITE_PPS(!!(sps->flags & V4L2_H264_SPS_FLAG_MB_ADAPTIVE_FRAME_FIELD),\n\t\t  MB_ADAPTIVE_FRAME_FIELD_FLAG);\n\tWRITE_PPS(!!(sps->flags & V4L2_H264_SPS_FLAG_DIRECT_8X8_INFERENCE),\n\t\t  DIRECT_8X8_INFERENCE_FLAG);\n\n\t \n\tWRITE_PPS(0xff, PIC_PARAMETER_SET_ID);\n\tWRITE_PPS(0x1f, PPS_SEQ_PARAMETER_SET_ID);\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_ENTROPY_CODING_MODE),\n\t\t  ENTROPY_CODING_MODE_FLAG);\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_BOTTOM_FIELD_PIC_ORDER_IN_FRAME_PRESENT),\n\t\t  BOTTOM_FIELD_PIC_ORDER_IN_FRAME_PRESENT_FLAG);\n\tWRITE_PPS(pps->num_ref_idx_l0_default_active_minus1,\n\t\t  NUM_REF_IDX_L_DEFAULT_ACTIVE_MINUS1(0));\n\tWRITE_PPS(pps->num_ref_idx_l1_default_active_minus1,\n\t\t  NUM_REF_IDX_L_DEFAULT_ACTIVE_MINUS1(1));\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_WEIGHTED_PRED),\n\t\t  WEIGHTED_PRED_FLAG);\n\tWRITE_PPS(pps->weighted_bipred_idc, WEIGHTED_BIPRED_IDC);\n\tWRITE_PPS(pps->pic_init_qp_minus26, PIC_INIT_QP_MINUS26);\n\tWRITE_PPS(pps->pic_init_qs_minus26, PIC_INIT_QS_MINUS26);\n\tWRITE_PPS(pps->chroma_qp_index_offset, CHROMA_QP_INDEX_OFFSET);\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_DEBLOCKING_FILTER_CONTROL_PRESENT),\n\t\t  DEBLOCKING_FILTER_CONTROL_PRESENT_FLAG);\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_CONSTRAINED_INTRA_PRED),\n\t\t  CONSTRAINED_INTRA_PRED_FLAG);\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_REDUNDANT_PIC_CNT_PRESENT),\n\t\t  REDUNDANT_PIC_CNT_PRESENT);\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_TRANSFORM_8X8_MODE),\n\t\t  TRANSFORM_8X8_MODE_FLAG);\n\tWRITE_PPS(pps->second_chroma_qp_index_offset,\n\t\t  SECOND_CHROMA_QP_INDEX_OFFSET);\n\n\tWRITE_PPS(!!(pps->flags & V4L2_H264_PPS_FLAG_SCALING_MATRIX_PRESENT),\n\t\t  SCALING_LIST_ENABLE_FLAG);\n\t \n\tscaling_distance = offsetof(struct rkvdec_h264_priv_tbl, scaling_list);\n\tscaling_list_address = h264_ctx->priv_tbl.dma + scaling_distance;\n\tWRITE_PPS(scaling_list_address, SCALING_LIST_ADDRESS);\n\n\tfor (i = 0; i < ARRAY_SIZE(dec_params->dpb); i++) {\n\t\tu32 is_longterm = 0;\n\n\t\tif (dpb[i].flags & V4L2_H264_DPB_ENTRY_FLAG_LONG_TERM)\n\t\t\tis_longterm = 1;\n\n\t\tWRITE_PPS(is_longterm, IS_LONG_TERM(i));\n\t}\n}\n\nstatic void lookup_ref_buf_idx(struct rkvdec_ctx *ctx,\n\t\t\t       struct rkvdec_h264_run *run)\n{\n\tconst struct v4l2_ctrl_h264_decode_params *dec_params = run->decode_params;\n\tu32 i;\n\n\tfor (i = 0; i < ARRAY_SIZE(dec_params->dpb); i++) {\n\t\tstruct v4l2_m2m_ctx *m2m_ctx = ctx->fh.m2m_ctx;\n\t\tconst struct v4l2_h264_dpb_entry *dpb = run->decode_params->dpb;\n\t\tstruct vb2_queue *cap_q = &m2m_ctx->cap_q_ctx.q;\n\t\tstruct vb2_buffer *buf = NULL;\n\n\t\tif (dpb[i].flags & V4L2_H264_DPB_ENTRY_FLAG_ACTIVE) {\n\t\t\tbuf = vb2_find_buffer(cap_q, dpb[i].reference_ts);\n\t\t\tif (!buf)\n\t\t\t\tpr_debug(\"No buffer for reference_ts %llu\",\n\t\t\t\t\t dpb[i].reference_ts);\n\t\t}\n\n\t\trun->ref_buf[i] = buf;\n\t}\n}\n\nstatic void assemble_hw_rps(struct rkvdec_ctx *ctx,\n\t\t\t    struct v4l2_h264_reflist_builder *builder,\n\t\t\t    struct rkvdec_h264_run *run)\n{\n\tconst struct v4l2_ctrl_h264_decode_params *dec_params = run->decode_params;\n\tconst struct v4l2_h264_dpb_entry *dpb = dec_params->dpb;\n\tstruct rkvdec_h264_ctx *h264_ctx = ctx->priv;\n\tstruct rkvdec_h264_priv_tbl *priv_tbl = h264_ctx->priv_tbl.cpu;\n\n\tu32 *hw_rps = priv_tbl->rps;\n\tu32 i, j;\n\tu16 *p = (u16 *)hw_rps;\n\n\tmemset(hw_rps, 0, sizeof(priv_tbl->rps));\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(dec_params->dpb); i++) {\n\t\tif (!(dpb[i].flags & V4L2_H264_DPB_ENTRY_FLAG_ACTIVE))\n\t\t\tcontinue;\n\n\t\tp[i] = builder->refs[i].frame_num;\n\t}\n\n\tfor (j = 0; j < RKVDEC_NUM_REFLIST; j++) {\n\t\tfor (i = 0; i < builder->num_valid; i++) {\n\t\t\tstruct v4l2_h264_reference *ref;\n\t\t\tbool dpb_valid;\n\t\t\tbool bottom;\n\n\t\t\tswitch (j) {\n\t\t\tcase 0:\n\t\t\t\tref = &h264_ctx->reflists.p[i];\n\t\t\t\tbreak;\n\t\t\tcase 1:\n\t\t\t\tref = &h264_ctx->reflists.b0[i];\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tref = &h264_ctx->reflists.b1[i];\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (WARN_ON(ref->index >= ARRAY_SIZE(dec_params->dpb)))\n\t\t\t\tcontinue;\n\n\t\t\tdpb_valid = run->ref_buf[ref->index] != NULL;\n\t\t\tbottom = ref->fields == V4L2_H264_BOTTOM_FIELD_REF;\n\n\t\t\tset_ps_field(hw_rps, DPB_INFO(i, j),\n\t\t\t\t     ref->index | dpb_valid << 4);\n\t\t\tset_ps_field(hw_rps, BOTTOM_FLAG(i, j), bottom);\n\t\t}\n\t}\n}\n\nstatic void assemble_hw_scaling_list(struct rkvdec_ctx *ctx,\n\t\t\t\t     struct rkvdec_h264_run *run)\n{\n\tconst struct v4l2_ctrl_h264_scaling_matrix *scaling = run->scaling_matrix;\n\tconst struct v4l2_ctrl_h264_pps *pps = run->pps;\n\tstruct rkvdec_h264_ctx *h264_ctx = ctx->priv;\n\tstruct rkvdec_h264_priv_tbl *tbl = h264_ctx->priv_tbl.cpu;\n\n\tif (!(pps->flags & V4L2_H264_PPS_FLAG_SCALING_MATRIX_PRESENT))\n\t\treturn;\n\n\tBUILD_BUG_ON(sizeof(tbl->scaling_list.scaling_list_4x4) !=\n\t\t     sizeof(scaling->scaling_list_4x4));\n\tBUILD_BUG_ON(sizeof(tbl->scaling_list.scaling_list_8x8) !=\n\t\t     sizeof(scaling->scaling_list_8x8));\n\n\tmemcpy(tbl->scaling_list.scaling_list_4x4,\n\t       scaling->scaling_list_4x4,\n\t       sizeof(scaling->scaling_list_4x4));\n\n\tmemcpy(tbl->scaling_list.scaling_list_8x8,\n\t       scaling->scaling_list_8x8,\n\t       sizeof(scaling->scaling_list_8x8));\n}\n\n \nstatic const u32 poc_reg_tbl_top_field[16] = {\n\tRKVDEC_REG_H264_POC_REFER0(0),\n\tRKVDEC_REG_H264_POC_REFER0(2),\n\tRKVDEC_REG_H264_POC_REFER0(4),\n\tRKVDEC_REG_H264_POC_REFER0(6),\n\tRKVDEC_REG_H264_POC_REFER0(8),\n\tRKVDEC_REG_H264_POC_REFER0(10),\n\tRKVDEC_REG_H264_POC_REFER0(12),\n\tRKVDEC_REG_H264_POC_REFER0(14),\n\tRKVDEC_REG_H264_POC_REFER1(1),\n\tRKVDEC_REG_H264_POC_REFER1(3),\n\tRKVDEC_REG_H264_POC_REFER1(5),\n\tRKVDEC_REG_H264_POC_REFER1(7),\n\tRKVDEC_REG_H264_POC_REFER1(9),\n\tRKVDEC_REG_H264_POC_REFER1(11),\n\tRKVDEC_REG_H264_POC_REFER1(13),\n\tRKVDEC_REG_H264_POC_REFER2(0)\n};\n\nstatic const u32 poc_reg_tbl_bottom_field[16] = {\n\tRKVDEC_REG_H264_POC_REFER0(1),\n\tRKVDEC_REG_H264_POC_REFER0(3),\n\tRKVDEC_REG_H264_POC_REFER0(5),\n\tRKVDEC_REG_H264_POC_REFER0(7),\n\tRKVDEC_REG_H264_POC_REFER0(9),\n\tRKVDEC_REG_H264_POC_REFER0(11),\n\tRKVDEC_REG_H264_POC_REFER0(13),\n\tRKVDEC_REG_H264_POC_REFER1(0),\n\tRKVDEC_REG_H264_POC_REFER1(2),\n\tRKVDEC_REG_H264_POC_REFER1(4),\n\tRKVDEC_REG_H264_POC_REFER1(6),\n\tRKVDEC_REG_H264_POC_REFER1(8),\n\tRKVDEC_REG_H264_POC_REFER1(10),\n\tRKVDEC_REG_H264_POC_REFER1(12),\n\tRKVDEC_REG_H264_POC_REFER1(14),\n\tRKVDEC_REG_H264_POC_REFER2(1)\n};\n\nstatic void config_registers(struct rkvdec_ctx *ctx,\n\t\t\t     struct rkvdec_h264_run *run)\n{\n\tstruct rkvdec_dev *rkvdec = ctx->dev;\n\tconst struct v4l2_ctrl_h264_decode_params *dec_params = run->decode_params;\n\tconst struct v4l2_ctrl_h264_sps *sps = run->sps;\n\tconst struct v4l2_h264_dpb_entry *dpb = dec_params->dpb;\n\tstruct rkvdec_h264_ctx *h264_ctx = ctx->priv;\n\tdma_addr_t priv_start_addr = h264_ctx->priv_tbl.dma;\n\tconst struct v4l2_pix_format_mplane *dst_fmt;\n\tstruct vb2_v4l2_buffer *src_buf = run->base.bufs.src;\n\tstruct vb2_v4l2_buffer *dst_buf = run->base.bufs.dst;\n\tconst struct v4l2_format *f;\n\tdma_addr_t rlc_addr;\n\tdma_addr_t refer_addr;\n\tu32 rlc_len;\n\tu32 hor_virstride = 0;\n\tu32 ver_virstride = 0;\n\tu32 y_virstride = 0;\n\tu32 yuv_virstride = 0;\n\tu32 offset;\n\tdma_addr_t dst_addr;\n\tu32 reg, i;\n\n\treg = RKVDEC_MODE(RKVDEC_MODE_H264);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_SYSCTRL);\n\n\tf = &ctx->decoded_fmt;\n\tdst_fmt = &f->fmt.pix_mp;\n\thor_virstride = (sps->bit_depth_luma_minus8 + 8) * dst_fmt->width / 8;\n\tver_virstride = round_up(dst_fmt->height, 16);\n\ty_virstride = hor_virstride * ver_virstride;\n\n\tif (sps->chroma_format_idc == 0)\n\t\tyuv_virstride = y_virstride;\n\telse if (sps->chroma_format_idc == 1)\n\t\tyuv_virstride += y_virstride + y_virstride / 2;\n\telse if (sps->chroma_format_idc == 2)\n\t\tyuv_virstride += 2 * y_virstride;\n\n\treg = RKVDEC_Y_HOR_VIRSTRIDE(hor_virstride / 16) |\n\t      RKVDEC_UV_HOR_VIRSTRIDE(hor_virstride / 16) |\n\t      RKVDEC_SLICE_NUM_HIGHBIT |\n\t      RKVDEC_SLICE_NUM_LOWBITS(0x7ff);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_PICPAR);\n\n\t \n\trlc_addr = vb2_dma_contig_plane_dma_addr(&src_buf->vb2_buf, 0);\n\twritel_relaxed(rlc_addr, rkvdec->regs + RKVDEC_REG_STRM_RLC_BASE);\n\twritel_relaxed(rlc_addr, rkvdec->regs + RKVDEC_REG_RLCWRITE_BASE);\n\n\trlc_len = vb2_get_plane_payload(&src_buf->vb2_buf, 0);\n\treg = RKVDEC_STRM_LEN(rlc_len);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_STRM_LEN);\n\n\t \n\toffset = offsetof(struct rkvdec_h264_priv_tbl, cabac_table);\n\twritel_relaxed(priv_start_addr + offset,\n\t\t       rkvdec->regs + RKVDEC_REG_CABACTBL_PROB_BASE);\n\n\t \n\tdst_addr = vb2_dma_contig_plane_dma_addr(&dst_buf->vb2_buf, 0);\n\twritel_relaxed(dst_addr, rkvdec->regs + RKVDEC_REG_DECOUT_BASE);\n\n\treg = RKVDEC_Y_VIRSTRIDE(y_virstride / 16);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_Y_VIRSTRIDE);\n\n\treg = RKVDEC_YUV_VIRSTRIDE(yuv_virstride / 16);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_YUV_VIRSTRIDE);\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(dec_params->dpb); i++) {\n\t\tstruct vb2_buffer *vb_buf = run->ref_buf[i];\n\n\t\t \n\t\tif (!vb_buf)\n\t\t\tvb_buf = &dst_buf->vb2_buf;\n\t\trefer_addr = vb2_dma_contig_plane_dma_addr(vb_buf, 0);\n\n\t\tif (dpb[i].flags & V4L2_H264_DPB_ENTRY_FLAG_ACTIVE)\n\t\t\trefer_addr |= RKVDEC_COLMV_USED_FLAG_REF;\n\t\tif (dpb[i].flags & V4L2_H264_DPB_ENTRY_FLAG_FIELD)\n\t\t\trefer_addr |= RKVDEC_FIELD_REF;\n\n\t\tif (dpb[i].fields & V4L2_H264_TOP_FIELD_REF)\n\t\t\trefer_addr |= RKVDEC_TOPFIELD_USED_REF;\n\t\tif (dpb[i].fields & V4L2_H264_BOTTOM_FIELD_REF)\n\t\t\trefer_addr |= RKVDEC_BOTFIELD_USED_REF;\n\n\t\twritel_relaxed(dpb[i].top_field_order_cnt,\n\t\t\t       rkvdec->regs +  poc_reg_tbl_top_field[i]);\n\t\twritel_relaxed(dpb[i].bottom_field_order_cnt,\n\t\t\t       rkvdec->regs + poc_reg_tbl_bottom_field[i]);\n\n\t\tif (i < V4L2_H264_NUM_DPB_ENTRIES - 1)\n\t\t\twritel_relaxed(refer_addr,\n\t\t\t\t       rkvdec->regs + RKVDEC_REG_H264_BASE_REFER(i));\n\t\telse\n\t\t\twritel_relaxed(refer_addr,\n\t\t\t\t       rkvdec->regs + RKVDEC_REG_H264_BASE_REFER15);\n\t}\n\n\treg = RKVDEC_CUR_POC(dec_params->top_field_order_cnt);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_CUR_POC0);\n\n\treg = RKVDEC_CUR_POC(dec_params->bottom_field_order_cnt);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_CUR_POC1);\n\n\t \n\toffset = offsetof(struct rkvdec_h264_priv_tbl, param_set);\n\twritel_relaxed(priv_start_addr + offset,\n\t\t       rkvdec->regs + RKVDEC_REG_PPS_BASE);\n\n\t \n\toffset = offsetof(struct rkvdec_h264_priv_tbl, rps);\n\twritel_relaxed(priv_start_addr + offset,\n\t\t       rkvdec->regs + RKVDEC_REG_RPS_BASE);\n\n\treg = RKVDEC_AXI_DDR_RDATA(0);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_AXI_DDR_RDATA);\n\n\treg = RKVDEC_AXI_DDR_WDATA(0);\n\twritel_relaxed(reg, rkvdec->regs + RKVDEC_REG_AXI_DDR_WDATA);\n\n\toffset = offsetof(struct rkvdec_h264_priv_tbl, err_info);\n\twritel_relaxed(priv_start_addr + offset,\n\t\t       rkvdec->regs + RKVDEC_REG_H264_ERRINFO_BASE);\n}\n\n#define RKVDEC_H264_MAX_DEPTH_IN_BYTES\t\t2\n\nstatic int rkvdec_h264_adjust_fmt(struct rkvdec_ctx *ctx,\n\t\t\t\t  struct v4l2_format *f)\n{\n\tstruct v4l2_pix_format_mplane *fmt = &f->fmt.pix_mp;\n\n\tfmt->num_planes = 1;\n\tif (!fmt->plane_fmt[0].sizeimage)\n\t\tfmt->plane_fmt[0].sizeimage = fmt->width * fmt->height *\n\t\t\t\t\t      RKVDEC_H264_MAX_DEPTH_IN_BYTES;\n\treturn 0;\n}\n\nstatic int rkvdec_h264_validate_sps(struct rkvdec_ctx *ctx,\n\t\t\t\t    const struct v4l2_ctrl_h264_sps *sps)\n{\n\tunsigned int width, height;\n\n\t \n\tif (sps->chroma_format_idc > 1)\n\t\t \n\t\treturn -EINVAL;\n\tif (sps->bit_depth_luma_minus8 != sps->bit_depth_chroma_minus8)\n\t\t \n\t\treturn -EINVAL;\n\tif (sps->bit_depth_luma_minus8 != 0)\n\t\t \n\t\treturn -EINVAL;\n\n\twidth = (sps->pic_width_in_mbs_minus1 + 1) * 16;\n\theight = (sps->pic_height_in_map_units_minus1 + 1) * 16;\n\n\t \n\tif (!(sps->flags & V4L2_H264_SPS_FLAG_FRAME_MBS_ONLY))\n\t\theight *= 2;\n\n\tif (width > ctx->coded_fmt.fmt.pix_mp.width ||\n\t    height > ctx->coded_fmt.fmt.pix_mp.height)\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nstatic int rkvdec_h264_start(struct rkvdec_ctx *ctx)\n{\n\tstruct rkvdec_dev *rkvdec = ctx->dev;\n\tstruct rkvdec_h264_priv_tbl *priv_tbl;\n\tstruct rkvdec_h264_ctx *h264_ctx;\n\tstruct v4l2_ctrl *ctrl;\n\tint ret;\n\n\tctrl = v4l2_ctrl_find(&ctx->ctrl_hdl,\n\t\t\t      V4L2_CID_STATELESS_H264_SPS);\n\tif (!ctrl)\n\t\treturn -EINVAL;\n\n\tret = rkvdec_h264_validate_sps(ctx, ctrl->p_new.p_h264_sps);\n\tif (ret)\n\t\treturn ret;\n\n\th264_ctx = kzalloc(sizeof(*h264_ctx), GFP_KERNEL);\n\tif (!h264_ctx)\n\t\treturn -ENOMEM;\n\n\tpriv_tbl = dma_alloc_coherent(rkvdec->dev, sizeof(*priv_tbl),\n\t\t\t\t      &h264_ctx->priv_tbl.dma, GFP_KERNEL);\n\tif (!priv_tbl) {\n\t\tret = -ENOMEM;\n\t\tgoto err_free_ctx;\n\t}\n\n\th264_ctx->priv_tbl.size = sizeof(*priv_tbl);\n\th264_ctx->priv_tbl.cpu = priv_tbl;\n\tmemcpy(priv_tbl->cabac_table, rkvdec_h264_cabac_table,\n\t       sizeof(rkvdec_h264_cabac_table));\n\n\tctx->priv = h264_ctx;\n\treturn 0;\n\nerr_free_ctx:\n\tkfree(h264_ctx);\n\treturn ret;\n}\n\nstatic void rkvdec_h264_stop(struct rkvdec_ctx *ctx)\n{\n\tstruct rkvdec_h264_ctx *h264_ctx = ctx->priv;\n\tstruct rkvdec_dev *rkvdec = ctx->dev;\n\n\tdma_free_coherent(rkvdec->dev, h264_ctx->priv_tbl.size,\n\t\t\t  h264_ctx->priv_tbl.cpu, h264_ctx->priv_tbl.dma);\n\tkfree(h264_ctx);\n}\n\nstatic void rkvdec_h264_run_preamble(struct rkvdec_ctx *ctx,\n\t\t\t\t     struct rkvdec_h264_run *run)\n{\n\tstruct v4l2_ctrl *ctrl;\n\n\tctrl = v4l2_ctrl_find(&ctx->ctrl_hdl,\n\t\t\t      V4L2_CID_STATELESS_H264_DECODE_PARAMS);\n\trun->decode_params = ctrl ? ctrl->p_cur.p : NULL;\n\tctrl = v4l2_ctrl_find(&ctx->ctrl_hdl,\n\t\t\t      V4L2_CID_STATELESS_H264_SPS);\n\trun->sps = ctrl ? ctrl->p_cur.p : NULL;\n\tctrl = v4l2_ctrl_find(&ctx->ctrl_hdl,\n\t\t\t      V4L2_CID_STATELESS_H264_PPS);\n\trun->pps = ctrl ? ctrl->p_cur.p : NULL;\n\tctrl = v4l2_ctrl_find(&ctx->ctrl_hdl,\n\t\t\t      V4L2_CID_STATELESS_H264_SCALING_MATRIX);\n\trun->scaling_matrix = ctrl ? ctrl->p_cur.p : NULL;\n\n\trkvdec_run_preamble(ctx, &run->base);\n}\n\nstatic int rkvdec_h264_run(struct rkvdec_ctx *ctx)\n{\n\tstruct v4l2_h264_reflist_builder reflist_builder;\n\tstruct rkvdec_dev *rkvdec = ctx->dev;\n\tstruct rkvdec_h264_ctx *h264_ctx = ctx->priv;\n\tstruct rkvdec_h264_run run;\n\n\trkvdec_h264_run_preamble(ctx, &run);\n\n\t \n\tv4l2_h264_init_reflist_builder(&reflist_builder, run.decode_params,\n\t\t\t\t       run.sps, run.decode_params->dpb);\n\tv4l2_h264_build_p_ref_list(&reflist_builder, h264_ctx->reflists.p);\n\tv4l2_h264_build_b_ref_lists(&reflist_builder, h264_ctx->reflists.b0,\n\t\t\t\t    h264_ctx->reflists.b1);\n\n\tassemble_hw_scaling_list(ctx, &run);\n\tassemble_hw_pps(ctx, &run);\n\tlookup_ref_buf_idx(ctx, &run);\n\tassemble_hw_rps(ctx, &reflist_builder, &run);\n\tconfig_registers(ctx, &run);\n\n\trkvdec_run_postamble(ctx, &run.base);\n\n\tschedule_delayed_work(&rkvdec->watchdog_work, msecs_to_jiffies(2000));\n\n\twritel(0, rkvdec->regs + RKVDEC_REG_STRMD_ERR_EN);\n\twritel(0, rkvdec->regs + RKVDEC_REG_H264_ERR_E);\n\twritel(1, rkvdec->regs + RKVDEC_REG_PREF_LUMA_CACHE_COMMAND);\n\twritel(1, rkvdec->regs + RKVDEC_REG_PREF_CHR_CACHE_COMMAND);\n\n\t \n\twritel(RKVDEC_INTERRUPT_DEC_E | RKVDEC_CONFIG_DEC_CLK_GATE_E |\n\t       RKVDEC_TIMEOUT_E | RKVDEC_BUF_EMPTY_E,\n\t       rkvdec->regs + RKVDEC_REG_INTERRUPT);\n\n\treturn 0;\n}\n\nstatic int rkvdec_h264_try_ctrl(struct rkvdec_ctx *ctx, struct v4l2_ctrl *ctrl)\n{\n\tif (ctrl->id == V4L2_CID_STATELESS_H264_SPS)\n\t\treturn rkvdec_h264_validate_sps(ctx, ctrl->p_new.p_h264_sps);\n\n\treturn 0;\n}\n\nconst struct rkvdec_coded_fmt_ops rkvdec_h264_fmt_ops = {\n\t.adjust_fmt = rkvdec_h264_adjust_fmt,\n\t.start = rkvdec_h264_start,\n\t.stop = rkvdec_h264_stop,\n\t.run = rkvdec_h264_run,\n\t.try_ctrl = rkvdec_h264_try_ctrl,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}