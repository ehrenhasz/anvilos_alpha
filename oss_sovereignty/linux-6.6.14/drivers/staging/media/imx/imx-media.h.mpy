{
  "module_name": "imx-media.h",
  "hash_id": "fc038af65264859f2ff72140c882c5772523a2d9ac87535fa6a475060244e351",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/imx/imx-media.h",
  "human_readable_source": " \n \n#ifndef _IMX_MEDIA_H\n#define _IMX_MEDIA_H\n\n#include <linux/platform_device.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-fwnode.h>\n#include <media/v4l2-subdev.h>\n#include <media/videobuf2-dma-contig.h>\n#include <video/imx-ipu-v3.h>\n\n#define IMX_MEDIA_DEF_PIX_WIDTH\t\t640\n#define IMX_MEDIA_DEF_PIX_HEIGHT\t480\n\n \nenum {\n\tIPU_CSI0 = 0,\n\tIPU_CSI1,\n\tIPU_VDIC,\n\tIPU_IC_PRP,\n\tIPU_IC_PRPENC,\n\tIPU_IC_PRPVF,\n\tNUM_IPU_SUBDEVS,\n};\n\n \n\n \nenum {\n\tCSI_SINK_PAD = 0,\n\tCSI_SRC_PAD_DIRECT,\n\tCSI_SRC_PAD_IDMAC,\n\tCSI_NUM_PADS,\n};\n\n \nenum {\n\tVDIC_SINK_PAD_DIRECT = 0,\n\tVDIC_SINK_PAD_IDMAC,\n\tVDIC_SRC_PAD_DIRECT,\n\tVDIC_NUM_PADS,\n};\n\n \nenum {\n\tPRP_SINK_PAD = 0,\n\tPRP_SRC_PAD_PRPENC,\n\tPRP_SRC_PAD_PRPVF,\n\tPRP_NUM_PADS,\n};\n\n \nenum {\n\tPRPENCVF_SINK_PAD = 0,\n\tPRPENCVF_SRC_PAD,\n\tPRPENCVF_NUM_PADS,\n};\n\n \n#define IMX_MEDIA_EOF_TIMEOUT       2000\n\nstruct imx_media_pixfmt {\n\t \n\tu32     fourcc;\n\t \n\tconst u32 *codes;\n\tint     bpp;      \n\t \n\tint\tcycles;\n\tenum ipu_color_space cs;\n\tbool    planar;   \n\tbool    bayer;    \n\tbool    ipufmt;   \n};\n\nenum imx_pixfmt_sel {\n\tPIXFMT_SEL_YUV   = BIT(0),  \n\tPIXFMT_SEL_RGB   = BIT(1),  \n\tPIXFMT_SEL_BAYER = BIT(2),  \n\tPIXFMT_SEL_IPU   = BIT(3),  \n\tPIXFMT_SEL_YUV_RGB = PIXFMT_SEL_YUV | PIXFMT_SEL_RGB,\n\tPIXFMT_SEL_ANY = PIXFMT_SEL_YUV | PIXFMT_SEL_RGB | PIXFMT_SEL_BAYER,\n};\n\nstruct imx_media_buffer {\n\tstruct vb2_v4l2_buffer vbuf;  \n\tstruct list_head  list;\n};\n\nstruct imx_media_video_dev {\n\tstruct video_device *vfd;\n\n\t \n\tstruct v4l2_pix_format fmt;\n\t \n\tstruct v4l2_rect compose;\n\tconst struct imx_media_pixfmt *cc;\n\n\t \n\tstruct list_head list;\n};\n\nstatic inline struct imx_media_buffer *to_imx_media_vb(struct vb2_buffer *vb)\n{\n\tstruct vb2_v4l2_buffer *vbuf = to_vb2_v4l2_buffer(vb);\n\n\treturn container_of(vbuf, struct imx_media_buffer, vbuf);\n}\n\n \nstatic inline struct list_head *\nto_pad_vdev_list(struct v4l2_subdev *sd, int pad_index)\n{\n\tstruct list_head *vdev_list = sd->host_priv;\n\n\treturn vdev_list ? &vdev_list[pad_index] : NULL;\n}\n\n \nstruct imx_media_pad_vdev {\n\tstruct imx_media_video_dev *vdev;\n\tstruct list_head list;\n};\n\nstruct imx_media_dev {\n\tstruct media_device md;\n\tstruct v4l2_device  v4l2_dev;\n\n\t \n\tstruct media_pipeline pipe;\n\n\tstruct mutex mutex;  \n\n\t \n\tstruct list_head vdev_list;\n\n\t \n\tstruct ipu_soc *ipu[2];\n\n\t \n\tstruct v4l2_async_notifier notifier;\n\n\t \n\tstruct imx_media_video_dev *m2m_vdev;\n\n\t \n\tstruct v4l2_subdev *sync_sd[2][NUM_IPU_SUBDEVS];\n};\n\n \nconst struct imx_media_pixfmt *\nimx_media_find_pixel_format(u32 fourcc, enum imx_pixfmt_sel sel);\nint imx_media_enum_pixel_formats(u32 *fourcc, u32 index,\n\t\t\t\t enum imx_pixfmt_sel sel, u32 code);\nconst struct imx_media_pixfmt *\nimx_media_find_mbus_format(u32 code, enum imx_pixfmt_sel sel);\nint imx_media_enum_mbus_formats(u32 *code, u32 index,\n\t\t\t\tenum imx_pixfmt_sel sel);\n\nstatic inline const struct imx_media_pixfmt *\nimx_media_find_ipu_format(u32 code, enum imx_pixfmt_sel fmt_sel)\n{\n\treturn imx_media_find_mbus_format(code, fmt_sel | PIXFMT_SEL_IPU);\n}\n\nstatic inline int imx_media_enum_ipu_formats(u32 *code, u32 index,\n\t\t\t\t\t     enum imx_pixfmt_sel fmt_sel)\n{\n\treturn imx_media_enum_mbus_formats(code, index,\n\t\t\t\t\t  fmt_sel | PIXFMT_SEL_IPU);\n}\n\nint imx_media_init_mbus_fmt(struct v4l2_mbus_framefmt *mbus,\n\t\t\t    u32 width, u32 height, u32 code, u32 field,\n\t\t\t    const struct imx_media_pixfmt **cc);\nint imx_media_init_cfg(struct v4l2_subdev *sd,\n\t\t       struct v4l2_subdev_state *sd_state);\nvoid imx_media_try_colorimetry(struct v4l2_mbus_framefmt *tryfmt,\n\t\t\t       bool ic_route);\nint imx_media_mbus_fmt_to_pix_fmt(struct v4l2_pix_format *pix,\n\t\t\t\t  const struct v4l2_mbus_framefmt *mbus,\n\t\t\t\t  const struct imx_media_pixfmt *cc);\nvoid imx_media_grp_id_to_sd_name(char *sd_name, int sz,\n\t\t\t\t u32 grp_id, int ipu_id);\nvoid imx_media_add_video_device(struct imx_media_dev *imxmd,\n\t\t\t\tstruct imx_media_video_dev *vdev);\nstruct media_pad *\nimx_media_pipeline_pad(struct media_entity *start_entity, u32 grp_id,\n\t\t       enum v4l2_buf_type buftype, bool upstream);\nstruct v4l2_subdev *\nimx_media_pipeline_subdev(struct media_entity *start_entity, u32 grp_id,\n\t\t\t  bool upstream);\n\nstruct imx_media_dma_buf {\n\tvoid          *virt;\n\tdma_addr_t     phys;\n\tunsigned long  len;\n};\n\nvoid imx_media_free_dma_buf(struct device *dev,\n\t\t\t    struct imx_media_dma_buf *buf);\nint imx_media_alloc_dma_buf(struct device *dev,\n\t\t\t    struct imx_media_dma_buf *buf,\n\t\t\t    int size);\n\nint imx_media_pipeline_set_stream(struct imx_media_dev *imxmd,\n\t\t\t\t  struct media_entity *entity,\n\t\t\t\t  bool on);\n\n \nint imx_media_probe_complete(struct v4l2_async_notifier *notifier);\nstruct imx_media_dev *imx_media_dev_init(struct device *dev,\n\t\t\t\t\t const struct media_device_ops *ops);\nint imx_media_dev_notifier_register(struct imx_media_dev *imxmd,\n\t\t\t    const struct v4l2_async_notifier_operations *ops);\n\n \nstruct imx_media_fim;\nvoid imx_media_fim_eof_monitor(struct imx_media_fim *fim, ktime_t timestamp);\nvoid imx_media_fim_set_stream(struct imx_media_fim *fim,\n\t\t\t      const struct v4l2_fract *frame_interval,\n\t\t\t      bool on);\nint imx_media_fim_add_controls(struct imx_media_fim *fim);\nstruct imx_media_fim *imx_media_fim_init(struct v4l2_subdev *sd);\nvoid imx_media_fim_free(struct imx_media_fim *fim);\n\n \nint imx_media_register_ipu_internal_subdevs(struct imx_media_dev *imxmd,\n\t\t\t\t\t    struct v4l2_subdev *csi);\nvoid imx_media_unregister_ipu_internal_subdevs(struct imx_media_dev *imxmd);\n\n \nint imx_media_add_of_subdevs(struct imx_media_dev *dev,\n\t\t\t     struct device_node *np);\n\n \nstruct v4l2_subdev *imx_media_vdic_register(struct v4l2_device *v4l2_dev,\n\t\t\t\t\t    struct device *ipu_dev,\n\t\t\t\t\t    struct ipu_soc *ipu,\n\t\t\t\t\t    u32 grp_id);\nint imx_media_vdic_unregister(struct v4l2_subdev *sd);\n\n \nstruct v4l2_subdev *imx_media_ic_register(struct v4l2_device *v4l2_dev,\n\t\t\t\t\t  struct device *ipu_dev,\n\t\t\t\t\t  struct ipu_soc *ipu,\n\t\t\t\t\t  u32 grp_id);\nint imx_media_ic_unregister(struct v4l2_subdev *sd);\n\n \nstruct imx_media_video_dev *\nimx_media_capture_device_init(struct device *dev, struct v4l2_subdev *src_sd,\n\t\t\t      int pad, bool legacy_api);\nvoid imx_media_capture_device_remove(struct imx_media_video_dev *vdev);\nint imx_media_capture_device_register(struct imx_media_video_dev *vdev,\n\t\t\t\t      u32 link_flags);\nvoid imx_media_capture_device_unregister(struct imx_media_video_dev *vdev);\nstruct imx_media_buffer *\nimx_media_capture_device_next_buf(struct imx_media_video_dev *vdev);\nvoid imx_media_capture_device_error(struct imx_media_video_dev *vdev);\n\n \nstruct imx_media_video_dev *\nimx_media_csc_scaler_device_init(struct imx_media_dev *dev);\nint imx_media_csc_scaler_device_register(struct imx_media_video_dev *vdev);\nvoid imx_media_csc_scaler_device_unregister(struct imx_media_video_dev *vdev);\n\n \n#define IMX_MEDIA_GRP_ID_CSI2          BIT(8)\n#define IMX_MEDIA_GRP_ID_IPU_CSI_BIT   10\n#define IMX_MEDIA_GRP_ID_IPU_CSI       (0x3 << IMX_MEDIA_GRP_ID_IPU_CSI_BIT)\n#define IMX_MEDIA_GRP_ID_IPU_CSI0      BIT(IMX_MEDIA_GRP_ID_IPU_CSI_BIT)\n#define IMX_MEDIA_GRP_ID_IPU_CSI1      (2 << IMX_MEDIA_GRP_ID_IPU_CSI_BIT)\n#define IMX_MEDIA_GRP_ID_IPU_VDIC      BIT(12)\n#define IMX_MEDIA_GRP_ID_IPU_IC_PRP    BIT(13)\n#define IMX_MEDIA_GRP_ID_IPU_IC_PRPENC BIT(14)\n#define IMX_MEDIA_GRP_ID_IPU_IC_PRPVF  BIT(15)\n#define IMX_MEDIA_GRP_ID_CSI_MUX       BIT(16)\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}