{
  "module_name": "imx-media-of.c",
  "hash_id": "00a3f489fabbba7e59344e0f7853fc7c17b6ea116811dcec0a2e0efe1548eb87",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/imx/imx-media-of.c",
  "human_readable_source": "\n \n#include <linux/of_platform.h>\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/v4l2-fwnode.h>\n#include <media/v4l2-subdev.h>\n#include <media/videobuf2-dma-contig.h>\n#include <linux/of_graph.h>\n#include <video/imx-ipu-v3.h>\n#include \"imx-media.h\"\n\nstatic int imx_media_of_add_csi(struct imx_media_dev *imxmd,\n\t\t\t\tstruct device_node *csi_np)\n{\n\tstruct v4l2_async_connection *asd;\n\tint ret = 0;\n\n\tif (!of_device_is_available(csi_np)) {\n\t\tdev_dbg(imxmd->md.dev, \"%s: %pOFn not enabled\\n\", __func__,\n\t\t\tcsi_np);\n\t\treturn -ENODEV;\n\t}\n\n\t \n\tasd = v4l2_async_nf_add_fwnode(&imxmd->notifier,\n\t\t\t\t       of_fwnode_handle(csi_np),\n\t\t\t\t       struct v4l2_async_connection);\n\tif (IS_ERR(asd)) {\n\t\tret = PTR_ERR(asd);\n\t\tif (ret == -EEXIST)\n\t\t\tdev_dbg(imxmd->md.dev, \"%s: already added %pOFn\\n\",\n\t\t\t\t__func__, csi_np);\n\t}\n\n\treturn ret;\n}\n\nint imx_media_add_of_subdevs(struct imx_media_dev *imxmd,\n\t\t\t     struct device_node *np)\n{\n\tstruct device_node *csi_np;\n\tint i, ret;\n\n\tfor (i = 0; ; i++) {\n\t\tcsi_np = of_parse_phandle(np, \"ports\", i);\n\t\tif (!csi_np)\n\t\t\tbreak;\n\n\t\tret = imx_media_of_add_csi(imxmd, csi_np);\n\t\tif (ret) {\n\t\t\t \n\t\t\tif (ret == -ENODEV || ret == -EEXIST) {\n\t\t\t\tof_node_put(csi_np);\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t \n\t\t\tgoto err_out;\n\t\t}\n\t}\n\n\treturn 0;\n\nerr_out:\n\tof_node_put(csi_np);\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(imx_media_add_of_subdevs);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}