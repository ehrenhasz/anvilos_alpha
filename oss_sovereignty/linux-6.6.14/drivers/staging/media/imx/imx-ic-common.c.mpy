{
  "module_name": "imx-ic-common.c",
  "hash_id": "98c70ff7650587a6f879e49c8e1bd2d03e62ca0c8d1922700db39563052d4936",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/imx/imx-ic-common.c",
  "human_readable_source": "\n \n#include <media/v4l2-device.h>\n#include <media/v4l2-subdev.h>\n#include \"imx-media.h\"\n#include \"imx-ic.h\"\n\n#define IC_TASK_PRP IC_NUM_TASKS\n#define IC_NUM_OPS  (IC_NUM_TASKS + 1)\n\nstatic struct imx_ic_ops *ic_ops[IC_NUM_OPS] = {\n\t[IC_TASK_PRP]            = &imx_ic_prp_ops,\n\t[IC_TASK_ENCODER]        = &imx_ic_prpencvf_ops,\n\t[IC_TASK_VIEWFINDER]     = &imx_ic_prpencvf_ops,\n};\n\nstruct v4l2_subdev *imx_media_ic_register(struct v4l2_device *v4l2_dev,\n\t\t\t\t\t  struct device *ipu_dev,\n\t\t\t\t\t  struct ipu_soc *ipu,\n\t\t\t\t\t  u32 grp_id)\n{\n\tstruct imx_ic_priv *priv;\n\tint ret;\n\n\tpriv = devm_kzalloc(ipu_dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tpriv->ipu_dev = ipu_dev;\n\tpriv->ipu = ipu;\n\n\t \n\tswitch (grp_id) {\n\tcase IMX_MEDIA_GRP_ID_IPU_IC_PRP:\n\t\tpriv->task_id = IC_TASK_PRP;\n\t\tbreak;\n\tcase IMX_MEDIA_GRP_ID_IPU_IC_PRPENC:\n\t\tpriv->task_id = IC_TASK_ENCODER;\n\t\tbreak;\n\tcase IMX_MEDIA_GRP_ID_IPU_IC_PRPVF:\n\t\tpriv->task_id = IC_TASK_VIEWFINDER;\n\t\tbreak;\n\tdefault:\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n\n\tv4l2_subdev_init(&priv->sd, ic_ops[priv->task_id]->subdev_ops);\n\tv4l2_set_subdevdata(&priv->sd, priv);\n\tpriv->sd.internal_ops = ic_ops[priv->task_id]->internal_ops;\n\tpriv->sd.entity.ops = ic_ops[priv->task_id]->entity_ops;\n\tpriv->sd.entity.function = MEDIA_ENT_F_PROC_VIDEO_SCALER;\n\tpriv->sd.owner = ipu_dev->driver->owner;\n\tpriv->sd.flags = V4L2_SUBDEV_FL_HAS_DEVNODE | V4L2_SUBDEV_FL_HAS_EVENTS;\n\tpriv->sd.grp_id = grp_id;\n\timx_media_grp_id_to_sd_name(priv->sd.name, sizeof(priv->sd.name),\n\t\t\t\t    priv->sd.grp_id, ipu_get_num(ipu));\n\n\tret = ic_ops[priv->task_id]->init(priv);\n\tif (ret)\n\t\treturn ERR_PTR(ret);\n\n\tret = v4l2_device_register_subdev(v4l2_dev, &priv->sd);\n\tif (ret) {\n\t\tic_ops[priv->task_id]->remove(priv);\n\t\treturn ERR_PTR(ret);\n\t}\n\n\treturn &priv->sd;\n}\n\nint imx_media_ic_unregister(struct v4l2_subdev *sd)\n{\n\tstruct imx_ic_priv *priv = container_of(sd, struct imx_ic_priv, sd);\n\n\tv4l2_info(sd, \"Removing\\n\");\n\n\tic_ops[priv->task_id]->remove(priv);\n\n\tv4l2_device_unregister_subdev(sd);\n\tmedia_entity_cleanup(&sd->entity);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}