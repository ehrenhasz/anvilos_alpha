{
  "module_name": "ipu3.h",
  "hash_id": "e8efc4d5b884e820c6330acd4d32f2a3ea9df77ff923969c1ec5e30eb9888476",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/ipu3/ipu3.h",
  "human_readable_source": " \n \n\n#ifndef __IPU3_H\n#define __IPU3_H\n\n#include <linux/iova.h>\n#include <linux/pci.h>\n\n#include <media/v4l2-ctrls.h>\n#include <media/v4l2-device.h>\n#include <media/videobuf2-dma-sg.h>\n\n#include \"ipu3-css.h\"\n\n#define IMGU_NAME\t\t\t\"ipu3-imgu\"\n\n \n#define IMGU_QUEUE_MASTER\t\tIPU3_CSS_QUEUE_IN\n#define IMGU_QUEUE_FIRST_INPUT\t\tIPU3_CSS_QUEUE_OUT\n#define IMGU_MAX_QUEUE_DEPTH\t\t(2 + 2)\n\n#define IMGU_NODE_IN\t\t\t0  \n#define IMGU_NODE_PARAMS\t\t1  \n#define IMGU_NODE_OUT\t\t\t2  \n#define IMGU_NODE_VF\t\t\t3  \n#define IMGU_NODE_STAT_3A\t\t4  \n#define IMGU_NODE_NUM\t\t\t5\n\n#define file_to_intel_imgu_node(__file) \\\n\tcontainer_of(video_devdata(__file), struct imgu_video_device, vdev)\n\n#define IPU3_INPUT_MIN_WIDTH\t\t0U\n#define IPU3_INPUT_MIN_HEIGHT\t\t0U\n#define IPU3_INPUT_MAX_WIDTH\t\t5120U\n#define IPU3_INPUT_MAX_HEIGHT\t\t38404U\n#define IPU3_OUTPUT_MIN_WIDTH\t\t2U\n#define IPU3_OUTPUT_MIN_HEIGHT\t\t2U\n#define IPU3_OUTPUT_MAX_WIDTH\t\t4480U\n#define IPU3_OUTPUT_MAX_HEIGHT\t\t34004U\n\nstruct imgu_vb2_buffer {\n\t \n\tstruct vb2_v4l2_buffer vbb;\t \n\n\t \n\tstruct list_head list;\n};\n\nstruct imgu_buffer {\n\tstruct imgu_vb2_buffer vid_buf;\t \n\tstruct imgu_css_buffer css_buf;\n\tstruct imgu_css_map map;\n};\n\nstruct imgu_node_mapping {\n\tunsigned int css_queue;\n\tconst char *name;\n};\n\nstruct imgu_video_device {\n\tconst char *name;\n\tbool output;\n\tbool enabled;\n\tstruct v4l2_format vdev_fmt;\t \n\n\t \n\tstruct video_device vdev;\n\tstruct media_pad vdev_pad;\n\tstruct v4l2_mbus_framefmt pad_fmt;\n\tstruct vb2_queue vbq;\n\tstruct list_head buffers;\n\t \n\tstruct mutex lock;\n\tatomic_t sequence;\n\tunsigned int id;\n\tunsigned int pipe;\n};\n\nstruct imgu_v4l2_subdev {\n\tunsigned int pipe;\n\tstruct v4l2_subdev subdev;\n\tstruct media_pad subdev_pads[IMGU_NODE_NUM];\n\tstruct {\n\t\tstruct v4l2_rect eff;  \n\t\tstruct v4l2_rect bds;  \n\t\tstruct v4l2_rect gdc;  \n\t} rect;\n\tstruct v4l2_ctrl_handler ctrl_handler;\n\tstruct v4l2_ctrl *ctrl;\n\tatomic_t running_mode;\n\tbool active;\n};\n\nstruct imgu_media_pipe {\n\tunsigned int pipe;\n\n\t \n\tstruct {\n\t\tstruct imgu_css_map dmap;\n\t\tstruct imgu_css_buffer dummybufs[IMGU_MAX_QUEUE_DEPTH];\n\t} queues[IPU3_CSS_QUEUES];\n\tstruct imgu_video_device nodes[IMGU_NODE_NUM];\n\tbool queue_enabled[IMGU_NODE_NUM];\n\tstruct media_pipeline pipeline;\n\tstruct imgu_v4l2_subdev imgu_sd;\n};\n\n \nstruct imgu_device {\n\tstruct pci_dev *pci_dev;\n\tvoid __iomem *base;\n\n\t \n\tunsigned int buf_struct_size;\n\tbool streaming;\t\t \n\n\tstruct imgu_media_pipe imgu_pipe[IMGU_MAX_PIPE_NUM];\n\n\t \n\tstruct v4l2_device v4l2_dev;\n\tstruct media_device media_dev;\n\tstruct v4l2_file_operations v4l2_file_ops;\n\n\t \n\tstruct imgu_mmu_info *mmu;\n\tstruct iova_domain iova_domain;\n\n\t \n\tstruct imgu_css css;\n\n\t \n\tstruct mutex lock;\n\n\t \n\tstruct mutex streaming_lock;\n\n\t \n\tatomic_t qbuf_barrier;\n\t \n\tbool suspend_in_stream;\n\t \n\twait_queue_head_t buf_drain_wq;\n};\n\nunsigned int imgu_node_to_queue(unsigned int node);\nunsigned int imgu_map_node(struct imgu_device *imgu, unsigned int css_queue);\nint imgu_queue_buffers(struct imgu_device *imgu, bool initial,\n\t\t       unsigned int pipe);\n\nint imgu_v4l2_register(struct imgu_device *dev);\nint imgu_v4l2_unregister(struct imgu_device *dev);\nvoid imgu_v4l2_buffer_done(struct vb2_buffer *vb, enum vb2_buffer_state state);\n\nint imgu_s_stream(struct imgu_device *imgu, int enable);\n\nstatic inline u32 imgu_bytesperline(const unsigned int width,\n\t\t\t\t    enum imgu_abi_frame_format frame_format)\n{\n\tif (frame_format == IMGU_ABI_FRAME_FORMAT_NV12)\n\t\treturn ALIGN(width, IPU3_UAPI_ISP_VEC_ELEMS);\n\t \n\treturn DIV_ROUND_UP(width, 50) * 64;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}