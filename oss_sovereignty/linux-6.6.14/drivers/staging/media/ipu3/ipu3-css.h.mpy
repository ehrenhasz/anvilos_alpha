{
  "module_name": "ipu3-css.h",
  "hash_id": "8f998709c4fed7afdeae5801b7d4713be226eccf660f03933f67eaf70b2dfbb2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/media/ipu3/ipu3-css.h",
  "human_readable_source": " \n \n\n#ifndef __IPU3_CSS_H\n#define __IPU3_CSS_H\n\n#include <linux/videodev2.h>\n#include <linux/types.h>\n\n#include \"ipu3-abi.h\"\n#include \"ipu3-css-pool.h\"\n\n \n#define IMGU_NUM_SP\t\t\t2\n#define IMGU_MAX_PIPELINE_NUM\t\t20\n#define IMGU_MAX_PIPE_NUM\t\t2\n\n \n#define IPU3_CSS_AUX_FRAME_REF\t\t0\n \n#define IPU3_CSS_AUX_FRAME_TNR\t\t1\n#define IPU3_CSS_AUX_FRAME_TYPES\t2\t \n#define IPU3_CSS_AUX_FRAMES\t\t2\t \n\n#define IPU3_CSS_QUEUE_IN\t\t0\n#define IPU3_CSS_QUEUE_PARAMS\t\t1\n#define IPU3_CSS_QUEUE_OUT\t\t2\n#define IPU3_CSS_QUEUE_VF\t\t3\n#define IPU3_CSS_QUEUE_STAT_3A\t\t4\n#define IPU3_CSS_QUEUES\t\t\t5\n\n#define IPU3_CSS_RECT_EFFECTIVE\t\t0\t \n#define IPU3_CSS_RECT_BDS\t\t1\t \n#define IPU3_CSS_RECT_ENVELOPE\t\t2\t \n#define IPU3_CSS_RECT_GDC\t\t3\t \n#define IPU3_CSS_RECTS\t\t\t4\t \n\n#define IA_CSS_BINARY_MODE_PRIMARY\t2\n#define IA_CSS_BINARY_MODE_VIDEO\t3\n#define IPU3_CSS_DEFAULT_BINARY\t\t3\t \n\n \nenum imgu_css_pipe_id {\n\tIPU3_CSS_PIPE_ID_PREVIEW,\n\tIPU3_CSS_PIPE_ID_COPY,\n\tIPU3_CSS_PIPE_ID_VIDEO,\n\tIPU3_CSS_PIPE_ID_CAPTURE,\n\tIPU3_CSS_PIPE_ID_YUVPP,\n\tIPU3_CSS_PIPE_ID_ACC,\n\tIPU3_CSS_PIPE_ID_NUM\n};\n\nstruct imgu_css_resolution {\n\tu32 w;\n\tu32 h;\n};\n\nenum imgu_css_buffer_state {\n\tIPU3_CSS_BUFFER_NEW,\t \n\tIPU3_CSS_BUFFER_QUEUED,\t \n\tIPU3_CSS_BUFFER_DONE,\t \n\tIPU3_CSS_BUFFER_FAILED,\t \n};\n\nstruct imgu_css_buffer {\n\t \n\tdma_addr_t daddr;\n\tunsigned int queue;\n\tenum imgu_css_buffer_state state;\n\tstruct list_head list;\n\tu8 queue_pos;\n\tunsigned int pipe;\n};\n\nstruct imgu_css_format {\n\tu32 pixelformat;\n\tenum v4l2_colorspace colorspace;\n\tenum imgu_abi_frame_format frame_format;\n\tenum imgu_abi_bayer_order bayer_order;\n\tenum imgu_abi_osys_format osys_format;\n\tenum imgu_abi_osys_tiling osys_tiling;\n\tu8 bit_depth;\t\t \n\tu8 chroma_decim;\t \n\tu8 width_align;\t\t \n\tu8 flags;\n};\n\nstruct imgu_css_queue {\n\tunion {\n\t\tstruct v4l2_pix_format_mplane mpix;\n\t\tstruct v4l2_meta_format\tmeta;\n\n\t} fmt;\n\tconst struct imgu_css_format *css_fmt;\n\tunsigned int width_pad;\n\tstruct list_head bufs;\n};\n\nstruct imgu_css_pipe {\n\tenum imgu_css_pipe_id pipe_id;\n\tunsigned int bindex;\n\n\tstruct imgu_css_queue queue[IPU3_CSS_QUEUES];\n\tstruct v4l2_rect rect[IPU3_CSS_RECTS];\n\n\tbool vf_output_en;\n\t \n\tspinlock_t qlock;\n\n\t \n\tstruct imgu_css_map sp_ddr_ptrs;\n\tstruct imgu_css_map xmem_sp_stage_ptrs[IPU3_CSS_PIPE_ID_NUM]\n\t\t\t\t\t    [IMGU_ABI_MAX_STAGES];\n\tstruct imgu_css_map xmem_isp_stage_ptrs[IPU3_CSS_PIPE_ID_NUM]\n\t\t\t\t\t    [IMGU_ABI_MAX_STAGES];\n\n\t \n\tstruct imgu_css_map binary_params_cs[IMGU_ABI_PARAM_CLASS_NUM - 1]\n\t\t\t\t\t    [IMGU_ABI_NUM_MEMORIES];\n\n\tstruct {\n\t\tstruct imgu_css_map mem[IPU3_CSS_AUX_FRAMES];\n\t\tunsigned int width;\n\t\tunsigned int height;\n\t\tunsigned int bytesperline;\n\t\tunsigned int bytesperpixel;\n\t} aux_frames[IPU3_CSS_AUX_FRAME_TYPES];\n\n\tstruct {\n\t\tstruct imgu_css_pool parameter_set_info;\n\t\tstruct imgu_css_pool acc;\n\t\tstruct imgu_css_pool gdc;\n\t\tstruct imgu_css_pool obgrid;\n\t\t \n\t\tstruct imgu_css_pool binary_params_p[IMGU_ABI_NUM_MEMORIES];\n\t} pool;\n\n\tstruct imgu_css_map abi_buffers[IPU3_CSS_QUEUES]\n\t\t\t\t    [IMGU_ABI_HOST2SP_BUFQ_SIZE];\n};\n\n \nstruct imgu_css {\n\tstruct device *dev;\n\tvoid __iomem *base;\n\tconst struct firmware *fw;\n\tstruct imgu_fw_header *fwp;\n\tint iomem_length;\n\tint fw_bl, fw_sp[IMGU_NUM_SP];\t \n\tstruct imgu_css_map *binary;\t \n\tbool streaming;\t\t \n\n\tstruct imgu_css_pipe pipes[IMGU_MAX_PIPE_NUM];\n\tstruct imgu_css_map xmem_sp_group_ptrs;\n\n\t \n\tDECLARE_BITMAP(enabled_pipes, IMGU_MAX_PIPE_NUM);\n};\n\n \nint imgu_css_init(struct device *dev, struct imgu_css *css,\n\t\t  void __iomem *base, int length);\nvoid imgu_css_cleanup(struct imgu_css *css);\nint imgu_css_fmt_try(struct imgu_css *css,\n\t\t     struct v4l2_pix_format_mplane *fmts[IPU3_CSS_QUEUES],\n\t\t     struct v4l2_rect *rects[IPU3_CSS_RECTS],\n\t\t     unsigned int pipe);\nint imgu_css_fmt_set(struct imgu_css *css,\n\t\t     struct v4l2_pix_format_mplane *fmts[IPU3_CSS_QUEUES],\n\t\t     struct v4l2_rect *rects[IPU3_CSS_RECTS],\n\t\t     unsigned int pipe);\nint imgu_css_meta_fmt_set(struct v4l2_meta_format *fmt);\nint imgu_css_buf_queue(struct imgu_css *css, unsigned int pipe,\n\t\t       struct imgu_css_buffer *b);\nstruct imgu_css_buffer *imgu_css_buf_dequeue(struct imgu_css *css);\nint imgu_css_start_streaming(struct imgu_css *css);\nvoid imgu_css_stop_streaming(struct imgu_css *css);\nbool imgu_css_queue_empty(struct imgu_css *css);\nbool imgu_css_is_streaming(struct imgu_css *css);\nbool imgu_css_pipe_queue_empty(struct imgu_css *css, unsigned int pipe);\n\n \nint imgu_css_set_powerup(struct device *dev, void __iomem *base,\n\t\t\t unsigned int freq);\nvoid imgu_css_set_powerdown(struct device *dev, void __iomem *base);\nint imgu_css_irq_ack(struct imgu_css *css);\n\n \nint imgu_css_set_parameters(struct imgu_css *css, unsigned int pipe,\n\t\t\t    struct ipu3_uapi_params *set_params);\n\n \nstatic inline enum imgu_css_buffer_state\nimgu_css_buf_state(struct imgu_css_buffer *b)\n{\n\treturn b->state;\n}\n\n \nstatic inline void imgu_css_buf_init(struct imgu_css_buffer *b,\n\t\t\t\t     unsigned int queue, dma_addr_t daddr)\n{\n\tb->state = IPU3_CSS_BUFFER_NEW;\n\tb->queue = queue;\n\tb->daddr = daddr;\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}