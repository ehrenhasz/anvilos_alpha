{
  "module_name": "dot11d.c",
  "hash_id": "50bb9486b4152d6c4e8147fdb4a1df9bd9e466a660acb74b449e994d41bd8ae4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8192e/dot11d.c",
  "human_readable_source": "\n \n#include \"dot11d.h\"\n\nstruct channel_list {\n\tu8      channel[32];\n\tu8      len;\n};\n\nstatic struct channel_list channel_array[] = {\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 36, 40, 44, 48, 52, 56, 60, 64,\n\t  149, 153, 157, 161, 165}, 24},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11}, 11},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 36, 40, 44, 48, 52, 56,\n\t  60, 64}, 21},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}, 13},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}, 13},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 36, 40, 44, 48, 52,\n\t  56, 60, 64}, 22},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 36, 40, 44, 48, 52,\n\t  56, 60, 64}, 22},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}, 13},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 36, 40, 44, 48, 52,\n\t  56, 60, 64}, 22},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 36, 40, 44, 48, 52,\n\t 56, 60, 64}, 22},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14}, 14},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13}, 13},\n\t{{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 36, 40, 44, 48, 52,\n\t  56, 60, 64}, 21}\n};\n\nvoid dot11d_init(struct rtllib_device *ieee)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(ieee);\n\n\tdot11d_info->enabled = false;\n\n\tdot11d_info->state = DOT11D_STATE_NONE;\n\tdot11d_info->country_len = 0;\n\tmemset(dot11d_info->channel_map, 0, MAX_CHANNEL_NUMBER + 1);\n\tmemset(dot11d_info->max_tx_power_list, 0xFF, MAX_CHANNEL_NUMBER + 1);\n\tRESET_CIE_WATCHDOG(ieee);\n}\nEXPORT_SYMBOL(dot11d_init);\n\nvoid dot11d_channel_map(u8 channel_plan, struct rtllib_device *ieee)\n{\n\tint i, max_chan = 14, min_chan = 1;\n\n\tieee->global_domain = false;\n\n\tif (channel_array[channel_plan].len != 0) {\n\t\tmemset(GET_DOT11D_INFO(ieee)->channel_map, 0,\n\t\t       sizeof(GET_DOT11D_INFO(ieee)->channel_map));\n\t\tfor (i = 0; i < channel_array[channel_plan].len; i++) {\n\t\t\tif (channel_array[channel_plan].channel[i] < min_chan ||\n\t\t\t    channel_array[channel_plan].channel[i] > max_chan)\n\t\t\t\tbreak;\n\t\t\tGET_DOT11D_INFO(ieee)->channel_map[channel_array\n\t\t\t\t\t[channel_plan].channel[i]] = 1;\n\t\t}\n\t}\n\n\tswitch (channel_plan) {\n\tcase COUNTRY_CODE_GLOBAL_DOMAIN:\n\t\tieee->global_domain = true;\n\t\tfor (i = 12; i <= 14; i++)\n\t\t\tGET_DOT11D_INFO(ieee)->channel_map[i] = 2;\n\t\tieee->bss_start_channel = 10;\n\t\tieee->ibss_maxjoin_chal = 11;\n\t\tbreak;\n\n\tcase COUNTRY_CODE_WORLD_WIDE_13:\n\t\tfor (i = 12; i <= 13; i++)\n\t\t\tGET_DOT11D_INFO(ieee)->channel_map[i] = 2;\n\t\tieee->bss_start_channel = 10;\n\t\tieee->ibss_maxjoin_chal = 11;\n\t\tbreak;\n\n\tdefault:\n\t\tieee->bss_start_channel = 1;\n\t\tieee->ibss_maxjoin_chal = 14;\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL(dot11d_channel_map);\n\nvoid dot11d_reset(struct rtllib_device *ieee)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(ieee);\n\tu32 i;\n\n\tmemset(dot11d_info->channel_map, 0, MAX_CHANNEL_NUMBER + 1);\n\tmemset(dot11d_info->max_tx_power_list, 0xFF, MAX_CHANNEL_NUMBER + 1);\n\tfor (i = 1; i <= 11; i++)\n\t\t(dot11d_info->channel_map)[i] = 1;\n\tfor (i = 12; i <= 14; i++)\n\t\t(dot11d_info->channel_map)[i] = 2;\n\tdot11d_info->state = DOT11D_STATE_NONE;\n\tdot11d_info->country_len = 0;\n\tRESET_CIE_WATCHDOG(ieee);\n}\n\nvoid dot11d_update_country(struct rtllib_device *dev, u8 *address,\n\t\t\t   u16 country_len, u8 *country)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(dev);\n\tu8 i, j, number_of_triples, max_channel_number;\n\tstruct chnl_txpow_triple *triple;\n\n\tmemset(dot11d_info->channel_map, 0, MAX_CHANNEL_NUMBER + 1);\n\tmemset(dot11d_info->max_tx_power_list, 0xFF, MAX_CHANNEL_NUMBER + 1);\n\tmax_channel_number = 0;\n\tnumber_of_triples = (country_len - 3) / 3;\n\ttriple = (struct chnl_txpow_triple *)(country + 3);\n\tfor (i = 0; i < number_of_triples; i++) {\n\t\tif (max_channel_number >= triple->first_channel) {\n\t\t\tnetdev_info(dev->dev,\n\t\t\t\t    \"%s: Invalid country IE, skip it......1\\n\",\n\t\t\t\t    __func__);\n\t\t\treturn;\n\t\t}\n\t\tif (MAX_CHANNEL_NUMBER < (triple->first_channel +\n\t\t    triple->num_channels)) {\n\t\t\tnetdev_info(dev->dev,\n\t\t\t\t    \"%s: Invalid country IE, skip it......2\\n\",\n\t\t\t\t    __func__);\n\t\t\treturn;\n\t\t}\n\n\t\tfor (j = 0; j < triple->num_channels; j++) {\n\t\t\tdot11d_info->channel_map[triple->first_channel + j] = 1;\n\t\t\tdot11d_info->max_tx_power_list[triple->first_channel + j] =\n\t\t\t\t\t\t triple->max_tx_power;\n\t\t\tmax_channel_number = triple->first_channel + j;\n\t\t}\n\n\t\ttriple = (struct chnl_txpow_triple *)((u8 *)triple + 3);\n\t}\n\n\tUPDATE_CIE_SRC(dev, address);\n\n\tdot11d_info->country_len = country_len;\n\tmemcpy(dot11d_info->country_buffer, country, country_len);\n\tdot11d_info->state = DOT11D_STATE_LEARNED;\n}\n\nvoid dot11d_scan_complete(struct rtllib_device *dev)\n{\n\tstruct rt_dot11d_info *dot11d_info = GET_DOT11D_INFO(dev);\n\n\tswitch (dot11d_info->state) {\n\tcase DOT11D_STATE_LEARNED:\n\t\tdot11d_info->state = DOT11D_STATE_DONE;\n\t\tbreak;\n\tcase DOT11D_STATE_DONE:\n\t\tdot11d_reset(dev);\n\t\tbreak;\n\tcase DOT11D_STATE_NONE:\n\t\tbreak;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}