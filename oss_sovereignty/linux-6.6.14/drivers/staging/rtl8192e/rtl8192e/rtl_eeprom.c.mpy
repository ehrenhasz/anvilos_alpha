{
  "module_name": "rtl_eeprom.c",
  "hash_id": "805bcb4fe56252890779f04b0b80b51ffd5e5a168015a311d68bd7173f0b3ece",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8192e/rtl8192e/rtl_eeprom.c",
  "human_readable_source": "\n \n#include \"rtl_core.h\"\n#include \"rtl_eeprom.h\"\n\nstatic void _rtl92e_gpio_write_bit(struct net_device *dev, int no, bool val)\n{\n\tu8 reg = rtl92e_readb(dev, EPROM_CMD);\n\n\tif (val)\n\t\treg |= 1 << no;\n\telse\n\t\treg &= ~(1 << no);\n\n\trtl92e_writeb(dev, EPROM_CMD, reg);\n\tudelay(EPROM_DELAY);\n}\n\nstatic bool _rtl92e_gpio_get_bit(struct net_device *dev, int no)\n{\n\tu8 reg = rtl92e_readb(dev, EPROM_CMD);\n\n\treturn (reg >> no) & 0x1;\n}\n\nstatic void _rtl92e_eeprom_ck_cycle(struct net_device *dev)\n{\n\t_rtl92e_gpio_write_bit(dev, EPROM_CK_BIT, 1);\n\t_rtl92e_gpio_write_bit(dev, EPROM_CK_BIT, 0);\n}\n\nstatic u16 _rtl92e_eeprom_xfer(struct net_device *dev, u16 data, int tx_len)\n{\n\tu16 ret = 0;\n\tint rx_len = 16;\n\n\t_rtl92e_gpio_write_bit(dev, EPROM_CS_BIT, 1);\n\t_rtl92e_eeprom_ck_cycle(dev);\n\n\twhile (tx_len--) {\n\t\t_rtl92e_gpio_write_bit(dev, EPROM_W_BIT,\n\t\t\t\t       (data >> tx_len) & 0x1);\n\t\t_rtl92e_eeprom_ck_cycle(dev);\n\t}\n\n\t_rtl92e_gpio_write_bit(dev, EPROM_W_BIT, 0);\n\n\twhile (rx_len--) {\n\t\t_rtl92e_eeprom_ck_cycle(dev);\n\t\tret |= _rtl92e_gpio_get_bit(dev, EPROM_R_BIT) << rx_len;\n\t}\n\n\t_rtl92e_gpio_write_bit(dev, EPROM_CS_BIT, 0);\n\t_rtl92e_eeprom_ck_cycle(dev);\n\n\treturn ret;\n}\n\nu32 rtl92e_eeprom_read(struct net_device *dev, u32 addr)\n{\n\tstruct r8192_priv *priv = rtllib_priv(dev);\n\tu32 ret = 0;\n\n\trtl92e_writeb(dev, EPROM_CMD,\n\t\t      (EPROM_CMD_PROGRAM << EPROM_CMD_OPERATING_MODE_SHIFT));\n\tudelay(EPROM_DELAY);\n\n\t \n\tif (priv->epromtype == EEPROM_93C56)\n\t\tret = _rtl92e_eeprom_xfer(dev, (addr & 0xFF) | (0x6 << 8), 11);\n\telse\n\t\tret = _rtl92e_eeprom_xfer(dev, (addr & 0x3F) | (0x6 << 6), 9);\n\n\trtl92e_writeb(dev, EPROM_CMD,\n\t\t      (EPROM_CMD_NORMAL << EPROM_CMD_OPERATING_MODE_SHIFT));\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}