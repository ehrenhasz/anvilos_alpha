{
  "module_name": "r8192E_cmdpkt.c",
  "hash_id": "869236b5c1744397c592f1d3b21d3a1f6fe11dcb11adac913c7980ea479b6da3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/rtl8192e/rtl8192e/r8192E_cmdpkt.c",
  "human_readable_source": "\n \n#include \"rtl_core.h\"\n#include \"r8192E_hw.h\"\n#include \"r8192E_cmdpkt.h\"\n\nbool rtl92e_send_cmd_pkt(struct net_device *dev, u32 type, const void *data,\n\t\t\t u32 len)\n{\n\tbool\t\t\t\trt_status = true;\n\tstruct r8192_priv *priv = rtllib_priv(dev);\n\tu16\t\t\t\tfrag_length = 0, frag_offset = 0;\n\tstruct sk_buff\t\t*skb;\n\tunsigned char\t\t*seg_ptr;\n\tstruct cb_desc *tcb_desc;\n\tu8\t\t\t\tbLastIniPkt;\n\n\tstruct tx_fwinfo_8190pci *pTxFwInfo = NULL;\n\n\tdo {\n\t\tif ((len - frag_offset) > CMDPACKET_FRAG_SIZE) {\n\t\t\tfrag_length = CMDPACKET_FRAG_SIZE;\n\t\t\tbLastIniPkt = 0;\n\n\t\t} else {\n\t\t\tfrag_length = (u16)(len - frag_offset);\n\t\t\tbLastIniPkt = 1;\n\t\t}\n\n\t\tif (type == DESC_PACKET_TYPE_NORMAL)\n\t\t\tskb = dev_alloc_skb(frag_length +\n\t\t\t\t\t    priv->rtllib->tx_headroom + 4);\n\t\telse\n\t\t\tskb = dev_alloc_skb(frag_length + 4);\n\n\t\tif (!skb) {\n\t\t\trt_status = false;\n\t\t\tgoto Failed;\n\t\t}\n\n\t\tmemcpy((unsigned char *)(skb->cb), &dev, sizeof(dev));\n\t\ttcb_desc = (struct cb_desc *)(skb->cb + MAX_DEV_ADDR_SIZE);\n\t\ttcb_desc->queue_index = TXCMD_QUEUE;\n\t\ttcb_desc->bCmdOrInit = type;\n\t\ttcb_desc->bLastIniPkt = bLastIniPkt;\n\n\t\tif (type == DESC_PACKET_TYPE_NORMAL) {\n\t\t\ttcb_desc->pkt_size = frag_length;\n\n\t\t\tseg_ptr = skb_put(skb, priv->rtllib->tx_headroom);\n\t\t\tpTxFwInfo = (struct tx_fwinfo_8190pci *)seg_ptr;\n\t\t\tmemset(pTxFwInfo, 0, sizeof(struct tx_fwinfo_8190pci));\n\t\t\tmemset(pTxFwInfo, 0x12, 8);\n\t\t} else {\n\t\t\ttcb_desc->txbuf_size = frag_length;\n\t\t}\n\n\t\tskb_put_data(skb, data, frag_length);\n\n\t\tif (type == DESC_PACKET_TYPE_INIT &&\n\t\t    (!priv->rtllib->check_nic_enough_desc(dev, TXCMD_QUEUE) ||\n\t\t     (!skb_queue_empty(&priv->rtllib->skb_waitQ[TXCMD_QUEUE])) ||\n\t\t     (priv->rtllib->queue_stop))) {\n\t\t\tskb_queue_tail(&priv->rtllib->skb_waitQ[TXCMD_QUEUE],\n\t\t\t\t       skb);\n\t\t} else {\n\t\t\tpriv->rtllib->softmac_hard_start_xmit(skb, dev);\n\t\t}\n\n\t\tdata += frag_length;\n\t\tfrag_offset += frag_length;\n\n\t} while (frag_offset < len);\n\n\trtl92e_writeb(dev, TP_POLL, TP_POLL_CQ);\nFailed:\n\treturn rt_status;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}