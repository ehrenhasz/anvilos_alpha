{
  "module_name": "channel.c",
  "hash_id": "a0619ce26bc7e8a76b61924a7676b4a01a903465e225ee510cd18d6e22ebf01f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/vt6655/channel.c",
  "human_readable_source": "\n \n\n#include \"baseband.h\"\n#include \"channel.h\"\n#include \"device.h\"\n#include \"rf.h\"\n\nstatic struct ieee80211_rate vnt_rates_bg[] = {\n\t{ .bitrate = 10,  .hw_value = RATE_1M },\n\t{ .bitrate = 20,  .hw_value = RATE_2M },\n\t{ .bitrate = 55,  .hw_value = RATE_5M },\n\t{ .bitrate = 110, .hw_value = RATE_11M },\n\t{ .bitrate = 60,  .hw_value = RATE_6M },\n\t{ .bitrate = 90,  .hw_value = RATE_9M },\n\t{ .bitrate = 120, .hw_value = RATE_12M },\n\t{ .bitrate = 180, .hw_value = RATE_18M },\n\t{ .bitrate = 240, .hw_value = RATE_24M },\n\t{ .bitrate = 360, .hw_value = RATE_36M },\n\t{ .bitrate = 480, .hw_value = RATE_48M },\n\t{ .bitrate = 540, .hw_value = RATE_54M },\n};\n\nstatic struct ieee80211_channel vnt_channels_2ghz[] = {\n\t{ .center_freq = 2412, .hw_value = 1 },\n\t{ .center_freq = 2417, .hw_value = 2 },\n\t{ .center_freq = 2422, .hw_value = 3 },\n\t{ .center_freq = 2427, .hw_value = 4 },\n\t{ .center_freq = 2432, .hw_value = 5 },\n\t{ .center_freq = 2437, .hw_value = 6 },\n\t{ .center_freq = 2442, .hw_value = 7 },\n\t{ .center_freq = 2447, .hw_value = 8 },\n\t{ .center_freq = 2452, .hw_value = 9 },\n\t{ .center_freq = 2457, .hw_value = 10 },\n\t{ .center_freq = 2462, .hw_value = 11 },\n\t{ .center_freq = 2467, .hw_value = 12 },\n\t{ .center_freq = 2472, .hw_value = 13 },\n\t{ .center_freq = 2484, .hw_value = 14 }\n};\n\nstatic struct ieee80211_supported_band vnt_supported_2ghz_band = {\n\t.channels = vnt_channels_2ghz,\n\t.n_channels = ARRAY_SIZE(vnt_channels_2ghz),\n\t.bitrates = vnt_rates_bg,\n\t.n_bitrates = ARRAY_SIZE(vnt_rates_bg),\n};\n\nstatic void vnt_init_band(struct vnt_private *priv,\n\t\t\t  struct ieee80211_supported_band *supported_band,\n\t\t\t  enum nl80211_band band)\n{\n\tint i;\n\n\tfor (i = 0; i < supported_band->n_channels; i++) {\n\t\tsupported_band->channels[i].max_power = 0x3f;\n\t\tsupported_band->channels[i].flags =\n\t\t\tIEEE80211_CHAN_NO_HT40;\n\t}\n\n\tpriv->hw->wiphy->bands[band] = supported_band;\n}\n\nvoid vnt_init_bands(struct vnt_private *priv)\n{\n\tvnt_init_band(priv, &vnt_supported_2ghz_band, NL80211_BAND_2GHZ);\n}\n\n \nbool set_channel(struct vnt_private *priv, struct ieee80211_channel *ch)\n{\n\tbool ret = true;\n\n\tif (priv->byCurrentCh == ch->hw_value)\n\t\treturn ret;\n\n\t \n\tif (priv->bUpdateBBVGA &&\n\t    priv->byBBVGACurrent != priv->abyBBVGA[0]) {\n\t\tpriv->byBBVGACurrent = priv->abyBBVGA[0];\n\n\t\tbb_set_vga_gain_offset(priv, priv->byBBVGACurrent);\n\t}\n\n\t \n\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_MACCR, MACCR_CLRNAV);\n\n\t \n\n\tpriv->byCurrentCh = ch->hw_value;\n\tret &= RFbSelectChannel(priv, priv->byRFType,\n\t\t\t\tch->hw_value);\n\n\t \n\tif (priv->bEnablePSMode)\n\t\trf_write_wake_prog_syn(priv, priv->byRFType, ch->hw_value);\n\n\tbb_software_reset(priv);\n\n\tif (priv->local_id > REV_ID_VT3253_B1) {\n\t\tunsigned long flags;\n\n\t\tspin_lock_irqsave(&priv->lock, flags);\n\n\t\t \n\t\tVT6655_MAC_SELECT_PAGE1(priv->port_offset);\n\t\tRFbSetPower(priv, RATE_1M, priv->byCurrentCh);\n\t\tiowrite8(priv->byCurPwr, priv->port_offset + MAC_REG_PWRCCK);\n\t\tRFbSetPower(priv, RATE_6M, priv->byCurrentCh);\n\t\tiowrite8(priv->byCurPwr, priv->port_offset + MAC_REG_PWROFDM);\n\t\tVT6655_MAC_SELECT_PAGE0(priv->port_offset);\n\n\t\tspin_unlock_irqrestore(&priv->lock, flags);\n\t}\n\n\tif (priv->byBBType == BB_TYPE_11B)\n\t\tRFbSetPower(priv, RATE_1M, priv->byCurrentCh);\n\telse\n\t\tRFbSetPower(priv, RATE_6M, priv->byCurrentCh);\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}