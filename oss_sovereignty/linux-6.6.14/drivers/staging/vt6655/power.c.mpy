{
  "module_name": "power.c",
  "hash_id": "19ca765a27eae6a4eb6654c5309faf7c2e446005380fcff8efc15e6f6b566c3f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/vt6655/power.c",
  "human_readable_source": "\n \n\n#include \"mac.h\"\n#include \"device.h\"\n#include \"power.h\"\n#include \"card.h\"\n\n \n\n \n\n \n\n \n\n \n\n \n\nvoid PSvEnablePowerSaving(struct vnt_private *priv,\n\t\t\t  unsigned short wListenInterval)\n{\n\tu16 wAID = priv->current_aid | BIT(14) | BIT(15);\n\n\t \n\tiowrite16(C_PWBT, priv->port_offset + MAC_REG_PWBT);\n\tif (priv->op_mode != NL80211_IFTYPE_ADHOC) {\n\t\t \n\t\tiowrite16(wAID, priv->port_offset + MAC_REG_AIDATIM);\n\t}\n\n\t \n\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_PSCFG, PSCFG_AUTOSLEEP);\n\n\t \n\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_TFTCTL, TFTCTL_HWUTSF);\n\n\tif (wListenInterval >= 2) {\n\t\t \n\t\tvt6655_mac_reg_bits_off(priv->port_offset, MAC_REG_PSCTL, PSCTL_ALBCN);\n\t\t \n\t\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_PSCTL, PSCTL_LNBCN);\n\t} else {\n\t\t \n\t\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_PSCTL, PSCTL_ALBCN);\n\t}\n\n\t \n\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_PSCTL, PSCTL_PSEN);\n\tpriv->bEnablePSMode = true;\n\n\tpriv->bPWBitOn = true;\n\tpr_debug(\"PS:Power Saving Mode Enable...\\n\");\n}\n\n \n\nvoid PSvDisablePowerSaving(struct vnt_private *priv)\n{\n\t \n\tMACbPSWakeup(priv);\n\n\t \n\tvt6655_mac_reg_bits_off(priv->port_offset, MAC_REG_PSCFG, PSCFG_AUTOSLEEP);\n\n\t \n\tvt6655_mac_reg_bits_off(priv->port_offset, MAC_REG_TFTCTL, TFTCTL_HWUTSF);\n\n\t \n\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_PSCTL, PSCTL_ALBCN);\n\n\tpriv->bEnablePSMode = false;\n\n\tpriv->bPWBitOn = false;\n}\n\n \n\nbool PSbIsNextTBTTWakeUp(struct vnt_private *priv)\n{\n\tstruct ieee80211_hw *hw = priv->hw;\n\tstruct ieee80211_conf *conf = &hw->conf;\n\tbool wake_up = false;\n\n\tif (conf->listen_interval > 1) {\n\t\tif (!priv->wake_up_count)\n\t\t\tpriv->wake_up_count = conf->listen_interval;\n\n\t\t--priv->wake_up_count;\n\n\t\tif (priv->wake_up_count == 1) {\n\t\t\t \n\t\t\tvt6655_mac_reg_bits_on(priv->port_offset, MAC_REG_PSCTL, PSCTL_LNBCN);\n\t\t\twake_up = true;\n\t\t}\n\t}\n\n\treturn wake_up;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}