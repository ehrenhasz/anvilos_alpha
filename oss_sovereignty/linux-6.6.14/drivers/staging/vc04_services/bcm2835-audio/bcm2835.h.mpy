{
  "module_name": "bcm2835.h",
  "hash_id": "ecbfa9a2e778952c17a71fe470e1ad7e26fe1eff1021deed186df0865097d9fb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/staging/vc04_services/bcm2835-audio/bcm2835.h",
  "human_readable_source": " \n \n\n#ifndef __SOUND_ARM_BCM2835_H\n#define __SOUND_ARM_BCM2835_H\n\n#include <linux/device.h>\n#include <linux/wait.h>\n#include <sound/core.h>\n#include <sound/pcm.h>\n#include <sound/pcm-indirect.h>\n\n#include \"../include/linux/raspberrypi/vchiq.h\"\n\n#define MAX_SUBSTREAMS   (8)\n#define AVAIL_SUBSTREAMS_MASK  (0xff)\n\nenum {\n\tCTRL_VOL_MUTE,\n\tCTRL_VOL_UNMUTE\n};\n\n \n\n\n#define alsa2chip(vol) ((uint)(-(((vol) << 8) / 100)))\n\n\n#define chip2alsa(vol) -(((vol) * 100) >> 8)\n\n#define CHIP_MIN_VOLUME\t\t26214  \n\n \nenum snd_bcm2835_route {\n\tAUDIO_DEST_AUTO = 0,\n\tAUDIO_DEST_HEADPHONES = 1,\n\tAUDIO_DEST_HDMI = 2,\n\tAUDIO_DEST_MAX,\n};\n\nenum snd_bcm2835_ctrl {\n\tPCM_PLAYBACK_VOLUME,\n\tPCM_PLAYBACK_MUTE,\n\tPCM_PLAYBACK_DEVICE,\n};\n\nstruct bcm2835_vchi_ctx {\n\tstruct vchiq_instance *instance;\n};\n\n \nstruct bcm2835_chip {\n\tstruct snd_card *card;\n\tstruct snd_pcm *pcm;\n\tstruct snd_pcm *pcm_spdif;\n\tstruct device *dev;\n\tstruct bcm2835_alsa_stream *alsa_stream[MAX_SUBSTREAMS];\n\n\tint volume;\n\tint dest;\n\tint mute;\n\n\tunsigned int opened;\n\tunsigned int spdif_status;\n\tstruct mutex audio_mutex;  \n\n\tstruct bcm2835_vchi_ctx *vchi_ctx;\n};\n\nstruct bcm2835_alsa_stream {\n\tstruct bcm2835_chip *chip;\n\tstruct snd_pcm_substream *substream;\n\tstruct snd_pcm_indirect pcm_indirect;\n\n\tint draining;\n\n\tatomic_t pos;\n\tunsigned int period_offset;\n\tunsigned int buffer_size;\n\tunsigned int period_size;\n\tktime_t interpolate_start;\n\n\tstruct bcm2835_audio_instance *instance;\n\tint idx;\n};\n\nint snd_bcm2835_new_ctl(struct bcm2835_chip *chip);\nint snd_bcm2835_new_pcm(struct bcm2835_chip *chip, const char *name,\n\t\t\tint idx, enum snd_bcm2835_route route,\n\t\t\tu32 numchannels, bool spdif);\n\nint snd_bcm2835_new_hdmi_ctl(struct bcm2835_chip *chip);\nint snd_bcm2835_new_headphones_ctl(struct bcm2835_chip *chip);\n\nint bcm2835_new_vchi_ctx(struct device *dev, struct bcm2835_vchi_ctx *vchi_ctx);\nvoid bcm2835_free_vchi_ctx(struct bcm2835_vchi_ctx *vchi_ctx);\n\nint bcm2835_audio_open(struct bcm2835_alsa_stream *alsa_stream);\nint bcm2835_audio_close(struct bcm2835_alsa_stream *alsa_stream);\nint bcm2835_audio_set_params(struct bcm2835_alsa_stream *alsa_stream,\n\t\t\t     unsigned int channels, unsigned int samplerate,\n\t\t\t     unsigned int bps);\nint bcm2835_audio_start(struct bcm2835_alsa_stream *alsa_stream);\nint bcm2835_audio_stop(struct bcm2835_alsa_stream *alsa_stream);\nint bcm2835_audio_drain(struct bcm2835_alsa_stream *alsa_stream);\nint bcm2835_audio_set_ctls(struct bcm2835_alsa_stream *alsa_stream);\nint bcm2835_audio_write(struct bcm2835_alsa_stream *alsa_stream,\n\t\t\tunsigned int count,\n\t\t\tvoid *src);\nvoid bcm2835_playback_fifo(struct bcm2835_alsa_stream *alsa_stream,\n\t\t\t   unsigned int size);\nunsigned int bcm2835_audio_retrieve_buffers(struct bcm2835_alsa_stream *alsa_stream);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}