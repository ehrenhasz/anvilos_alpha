{
  "module_name": "vfio_platform_calxedaxgmac.c",
  "hash_id": "6f442dd3332b5806edc4843e58180e22bea8ce3cd66f4b2513dc74b2488ff282",
  "original_prompt": "Ingested from linux-6.6.14/drivers/vfio/platform/reset/vfio_platform_calxedaxgmac.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/io.h>\n\n#include \"../vfio_platform_private.h\"\n\n#define DRIVER_VERSION  \"0.1\"\n#define DRIVER_AUTHOR   \"Eric Auger <eric.auger@linaro.org>\"\n#define DRIVER_DESC     \"Reset support for Calxeda xgmac vfio platform device\"\n\n \n#define XGMAC_CONTROL           0x00000000       \n\n \n#define XGMAC_DMA_CONTROL       0x00000f18       \n#define XGMAC_DMA_INTR_ENA      0x00000f1c       \n\n \n#define DMA_CONTROL_ST          0x00002000       \n#define DMA_CONTROL_SR          0x00000002       \n\n \n#define MAC_ENABLE_TX           0x00000008       \n#define MAC_ENABLE_RX           0x00000004       \n\nstatic inline void xgmac_mac_disable(void __iomem *ioaddr)\n{\n\tu32 value = readl(ioaddr + XGMAC_DMA_CONTROL);\n\n\tvalue &= ~(DMA_CONTROL_ST | DMA_CONTROL_SR);\n\twritel(value, ioaddr + XGMAC_DMA_CONTROL);\n\n\tvalue = readl(ioaddr + XGMAC_CONTROL);\n\tvalue &= ~(MAC_ENABLE_TX | MAC_ENABLE_RX);\n\twritel(value, ioaddr + XGMAC_CONTROL);\n}\n\nstatic int vfio_platform_calxedaxgmac_reset(struct vfio_platform_device *vdev)\n{\n\tstruct vfio_platform_region *reg = &vdev->regions[0];\n\n\tif (!reg->ioaddr) {\n\t\treg->ioaddr =\n\t\t\tioremap(reg->addr, reg->size);\n\t\tif (!reg->ioaddr)\n\t\t\treturn -ENOMEM;\n\t}\n\n\t \n\twritel(0, reg->ioaddr + XGMAC_DMA_INTR_ENA);\n\n\t \n\txgmac_mac_disable(reg->ioaddr);\n\n\treturn 0;\n}\n\nmodule_vfio_reset_handler(\"calxeda,hb-xgmac\", vfio_platform_calxedaxgmac_reset);\n\nMODULE_VERSION(DRIVER_VERSION);\nMODULE_LICENSE(\"GPL v2\");\nMODULE_AUTHOR(DRIVER_AUTHOR);\nMODULE_DESCRIPTION(DRIVER_DESC);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}