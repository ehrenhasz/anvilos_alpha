{
  "module_name": "vfio_platform_private.h",
  "hash_id": "a9c74fd940549a909c33405733fde83e8c59f83fd59775271e5a5f3dab0075bf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/vfio/platform/vfio_platform_private.h",
  "human_readable_source": " \n \n\n#ifndef VFIO_PLATFORM_PRIVATE_H\n#define VFIO_PLATFORM_PRIVATE_H\n\n#include <linux/types.h>\n#include <linux/interrupt.h>\n#include <linux/vfio.h>\n\n#define VFIO_PLATFORM_OFFSET_SHIFT   40\n#define VFIO_PLATFORM_OFFSET_MASK (((u64)(1) << VFIO_PLATFORM_OFFSET_SHIFT) - 1)\n\n#define VFIO_PLATFORM_OFFSET_TO_INDEX(off)\t\\\n\t(off >> VFIO_PLATFORM_OFFSET_SHIFT)\n\n#define VFIO_PLATFORM_INDEX_TO_OFFSET(index)\t\\\n\t((u64)(index) << VFIO_PLATFORM_OFFSET_SHIFT)\n\nstruct vfio_platform_irq {\n\tu32\t\t\tflags;\n\tu32\t\t\tcount;\n\tint\t\t\thwirq;\n\tchar\t\t\t*name;\n\tstruct eventfd_ctx\t*trigger;\n\tbool\t\t\tmasked;\n\tspinlock_t\t\tlock;\n\tstruct virqfd\t\t*unmask;\n\tstruct virqfd\t\t*mask;\n};\n\nstruct vfio_platform_region {\n\tu64\t\t\taddr;\n\tresource_size_t\t\tsize;\n\tu32\t\t\tflags;\n\tu32\t\t\ttype;\n#define VFIO_PLATFORM_REGION_TYPE_MMIO\t1\n#define VFIO_PLATFORM_REGION_TYPE_PIO\t2\n\tvoid __iomem\t\t*ioaddr;\n};\n\nstruct vfio_platform_device {\n\tstruct vfio_device\t\tvdev;\n\tstruct vfio_platform_region\t*regions;\n\tu32\t\t\t\tnum_regions;\n\tstruct vfio_platform_irq\t*irqs;\n\tu32\t\t\t\tnum_irqs;\n\tstruct mutex\t\t\tigate;\n\tconst char\t\t\t*compat;\n\tconst char\t\t\t*acpihid;\n\tstruct module\t\t\t*reset_module;\n\tstruct device\t\t\t*device;\n\n\t \n\tvoid\t\t*opaque;\n\tconst char\t*name;\n\tuint32_t\tflags;\n\t \n\tstruct resource*\n\t\t(*get_resource)(struct vfio_platform_device *vdev, int i);\n\tint\t(*get_irq)(struct vfio_platform_device *vdev, int i);\n\tint\t(*of_reset)(struct vfio_platform_device *vdev);\n\n\tbool\t\t\t\treset_required;\n};\n\ntypedef int (*vfio_platform_reset_fn_t)(struct vfio_platform_device *vdev);\n\nstruct vfio_platform_reset_node {\n\tstruct list_head link;\n\tchar *compat;\n\tstruct module *owner;\n\tvfio_platform_reset_fn_t of_reset;\n};\n\nint vfio_platform_init_common(struct vfio_platform_device *vdev);\nvoid vfio_platform_release_common(struct vfio_platform_device *vdev);\n\nint vfio_platform_open_device(struct vfio_device *core_vdev);\nvoid vfio_platform_close_device(struct vfio_device *core_vdev);\nlong vfio_platform_ioctl(struct vfio_device *core_vdev,\n\t\t\t unsigned int cmd, unsigned long arg);\nssize_t vfio_platform_read(struct vfio_device *core_vdev,\n\t\t\t   char __user *buf, size_t count,\n\t\t\t   loff_t *ppos);\nssize_t vfio_platform_write(struct vfio_device *core_vdev,\n\t\t\t    const char __user *buf,\n\t\t\t    size_t count, loff_t *ppos);\nint vfio_platform_mmap(struct vfio_device *core_vdev,\n\t\t       struct vm_area_struct *vma);\n\nint vfio_platform_irq_init(struct vfio_platform_device *vdev);\nvoid vfio_platform_irq_cleanup(struct vfio_platform_device *vdev);\n\nint vfio_platform_set_irqs_ioctl(struct vfio_platform_device *vdev,\n\t\t\t\t uint32_t flags, unsigned index,\n\t\t\t\t unsigned start, unsigned count, void *data);\n\nvoid __vfio_platform_register_reset(struct vfio_platform_reset_node *n);\nvoid vfio_platform_unregister_reset(const char *compat,\n\t\t\t\t    vfio_platform_reset_fn_t fn);\n#define vfio_platform_register_reset(__compat, __reset)\t\t\\\nstatic struct vfio_platform_reset_node __reset ## _node = {\t\\\n\t.owner = THIS_MODULE,\t\t\t\t\t\\\n\t.compat = __compat,\t\t\t\t\t\\\n\t.of_reset = __reset,\t\t\t\t\t\\\n};\t\t\t\t\t\t\t\t\\\n__vfio_platform_register_reset(&__reset ## _node)\n\n#define module_vfio_reset_handler(compat, reset)\t\t\\\nMODULE_ALIAS(\"vfio-reset:\" compat);\t\t\t\t\\\nstatic int __init reset ## _module_init(void)\t\t\t\\\n{\t\t\t\t\t\t\t\t\\\n\tvfio_platform_register_reset(compat, reset);\t\t\\\n\treturn 0;\t\t\t\t\t\t\\\n};\t\t\t\t\t\t\t\t\\\nstatic void __exit reset ## _module_exit(void)\t\t\t\\\n{\t\t\t\t\t\t\t\t\\\n\tvfio_platform_unregister_reset(compat, reset);\t\t\\\n};\t\t\t\t\t\t\t\t\\\nmodule_init(reset ## _module_init);\t\t\t\t\\\nmodule_exit(reset ## _module_exit)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}