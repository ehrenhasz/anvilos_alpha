{
  "module_name": "hid-razer.c",
  "hash_id": "0d6f17563df32094eba1bdc3a4be246142ff79de0cb91c4107b6f052d7e4e18a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-razer.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/hid.h>\n#include <linux/module.h>\n#include <linux/random.h>\n#include <linux/sched.h>\n#include <linux/usb.h>\n#include <linux/wait.h>\n\n#include \"hid-ids.h\"\n\n#define map_key_clear(c) hid_map_usage_clear(hi, usage, bit, max, EV_KEY, (c))\n\n#define RAZER_BLACKWIDOW_TRANSFER_BUF_SIZE\t91\n\nstatic bool macro_key_remapping = 1;\nmodule_param(macro_key_remapping, bool, 0644);\nMODULE_PARM_DESC(macro_key_remapping, \" on (Y) off (N)\");\n\n\nstatic unsigned char blackwidow_init[RAZER_BLACKWIDOW_TRANSFER_BUF_SIZE] = {\n\t0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x04,\n\t0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,\n\t0x04, 0x00\n};\n\nstatic int razer_input_mapping(struct hid_device *hdev,\n\t\tstruct hid_input *hi, struct hid_field *field,\n\t\tstruct hid_usage *usage, unsigned long **bit, int *max)\n{\n\n\tif (!macro_key_remapping)\n\t\treturn 0;\n\n\tif ((usage->hid & HID_UP_KEYBOARD) != HID_UP_KEYBOARD)\n\t\treturn 0;\n\n\tswitch (usage->hid & ~HID_UP_KEYBOARD) {\n\tcase 0x68:\n\t\tmap_key_clear(KEY_MACRO1);\n\t\treturn 1;\n\tcase 0x69:\n\t\tmap_key_clear(KEY_MACRO2);\n\t\treturn 1;\n\tcase 0x6a:\n\t\tmap_key_clear(KEY_MACRO3);\n\t\treturn 1;\n\tcase 0x6b:\n\t\tmap_key_clear(KEY_MACRO4);\n\t\treturn 1;\n\tcase 0x6c:\n\t\tmap_key_clear(KEY_MACRO5);\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nstatic int razer_probe(struct hid_device *hdev, const struct hid_device_id *id)\n{\n\tchar *buf;\n\tint ret = 0;\n\n\tret = hid_parse(hdev);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tif (hdev->type == HID_TYPE_USBMOUSE) {\n\t\tbuf = kmemdup(blackwidow_init, RAZER_BLACKWIDOW_TRANSFER_BUF_SIZE, GFP_KERNEL);\n\t\tif (buf == NULL)\n\t\t\treturn -ENOMEM;\n\n\t\tret = hid_hw_raw_request(hdev, 0, buf, RAZER_BLACKWIDOW_TRANSFER_BUF_SIZE,\n\t\t\t\tHID_FEATURE_REPORT, HID_REQ_SET_REPORT);\n\t\tif (ret != RAZER_BLACKWIDOW_TRANSFER_BUF_SIZE)\n\t\t\thid_err(hdev, \"failed to enable macro keys: %d\\n\", ret);\n\n\t\tkfree(buf);\n\t}\n\n\treturn hid_hw_start(hdev, HID_CONNECT_DEFAULT);\n}\n\nstatic const struct hid_device_id razer_devices[] = {\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_RAZER,\n\t\tUSB_DEVICE_ID_RAZER_BLACKWIDOW) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_RAZER,\n\t\tUSB_DEVICE_ID_RAZER_BLACKWIDOW_CLASSIC) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_RAZER,\n\t\tUSB_DEVICE_ID_RAZER_BLACKWIDOW_ULTIMATE) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, razer_devices);\n\nstatic struct hid_driver razer_driver = {\n\t.name = \"razer\",\n\t.id_table = razer_devices,\n\t.input_mapping = razer_input_mapping,\n\t.probe = razer_probe,\n};\nmodule_hid_driver(razer_driver);\n\nMODULE_AUTHOR(\"Jelle van der Waa <jvanderwaa@redhat.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}