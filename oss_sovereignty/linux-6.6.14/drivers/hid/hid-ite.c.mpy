{
  "module_name": "hid-ite.c",
  "hash_id": "f0360647d81c941edfab8ea80ea7ea006c986322549a490038db37b773995937",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-ite.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/input.h>\n#include <linux/hid.h>\n#include <linux/module.h>\n\n#include \"hid-ids.h\"\n\n#define QUIRK_TOUCHPAD_ON_OFF_REPORT\t\tBIT(0)\n\nstatic __u8 *ite_report_fixup(struct hid_device *hdev, __u8 *rdesc, unsigned int *rsize)\n{\n\tunsigned long quirks = (unsigned long)hid_get_drvdata(hdev);\n\n\tif (quirks & QUIRK_TOUCHPAD_ON_OFF_REPORT) {\n\t\t \n\t\tif (*rsize == 188 && rdesc[162] == 0x81 && rdesc[163] == 0x02) {\n\t\t\thid_info(hdev, \"Fixing up Acer Sw5-012 ITE keyboard report descriptor\\n\");\n\t\t\trdesc[163] = HID_MAIN_ITEM_RELATIVE;\n\t\t}\n\t\t \n\t\tif (*rsize == 188 && rdesc[185] == 0x81 && rdesc[186] == 0x02) {\n\t\t\thid_info(hdev, \"Fixing up Acer S1002/S1003 ITE keyboard report descriptor\\n\");\n\t\t\trdesc[186] = HID_MAIN_ITEM_RELATIVE;\n\t\t}\n\t\t \n\t\tif (*rsize == 210 && rdesc[184] == 0x81 && rdesc[185] == 0x02) {\n\t\t\thid_info(hdev, \"Fixing up Acer Aspire Switch 10E (SW3-016) ITE keyboard report descriptor\\n\");\n\t\t\trdesc[185] = HID_MAIN_ITEM_RELATIVE;\n\t\t}\n\t}\n\n\treturn rdesc;\n}\n\nstatic int ite_input_mapping(struct hid_device *hdev,\n\t\tstruct hid_input *hi, struct hid_field *field,\n\t\tstruct hid_usage *usage, unsigned long **bit,\n\t\tint *max)\n{\n\n\tunsigned long quirks = (unsigned long)hid_get_drvdata(hdev);\n\n\tif ((quirks & QUIRK_TOUCHPAD_ON_OFF_REPORT) &&\n\t    (usage->hid & HID_USAGE_PAGE) == 0x00880000) {\n\t\tif (usage->hid == 0x00880078) {\n\t\t\t \n\t\t\thid_map_usage_clear(hi, usage, bit, max, EV_KEY, KEY_F22);\n\t\t\treturn 1;\n\t\t}\n\t\tif (usage->hid == 0x00880079) {\n\t\t\t \n\t\t\thid_map_usage_clear(hi, usage, bit, max, EV_KEY, KEY_F23);\n\t\t\treturn 1;\n\t\t}\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}\n\nstatic int ite_event(struct hid_device *hdev, struct hid_field *field,\n\t\t     struct hid_usage *usage, __s32 value)\n{\n\tstruct input_dev *input;\n\n\tif (!(hdev->claimed & HID_CLAIMED_INPUT) || !field->hidinput)\n\t\treturn 0;\n\n\tinput = field->hidinput->input;\n\n\t \n\tif (usage->hid == HID_GD_RFKILL_BTN) {\n\t\tinput_event(input, EV_KEY, KEY_RFKILL, 1);\n\t\tinput_sync(input);\n\t\tinput_event(input, EV_KEY, KEY_RFKILL, 0);\n\t\tinput_sync(input);\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nstatic int ite_probe(struct hid_device *hdev, const struct hid_device_id *id)\n{\n\tint ret;\n\n\thid_set_drvdata(hdev, (void *)id->driver_data);\n\n\tret = hid_open_report(hdev);\n\tif (ret)\n\t\treturn ret;\n\n\treturn hid_hw_start(hdev, HID_CONNECT_DEFAULT);\n}\n\nstatic const struct hid_device_id ite_devices[] = {\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ITE, USB_DEVICE_ID_ITE8595) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_258A, USB_DEVICE_ID_258A_6A88) },\n\t \n\t{ HID_DEVICE(BUS_USB, HID_GROUP_GENERIC,\n\t\t     USB_VENDOR_ID_SYNAPTICS,\n\t\t     USB_DEVICE_ID_SYNAPTICS_ACER_SWITCH5_012),\n\t  .driver_data = QUIRK_TOUCHPAD_ON_OFF_REPORT },\n\t \n\t{ HID_DEVICE(BUS_USB, HID_GROUP_GENERIC,\n\t\t     USB_VENDOR_ID_SYNAPTICS,\n\t\t     USB_DEVICE_ID_SYNAPTICS_ACER_ONE_S1002),\n\t  .driver_data = QUIRK_TOUCHPAD_ON_OFF_REPORT },\n\t \n\t{ HID_DEVICE(BUS_USB, HID_GROUP_GENERIC,\n\t\t     USB_VENDOR_ID_SYNAPTICS,\n\t\t     USB_DEVICE_ID_SYNAPTICS_ACER_ONE_S1003),\n\t  .driver_data = QUIRK_TOUCHPAD_ON_OFF_REPORT },\n\t \n\t{ HID_DEVICE(BUS_USB, HID_GROUP_GENERIC,\n\t\t     USB_VENDOR_ID_SYNAPTICS,\n\t\t     USB_DEVICE_ID_SYNAPTICS_ACER_SWITCH5_017),\n\t  .driver_data = QUIRK_TOUCHPAD_ON_OFF_REPORT },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, ite_devices);\n\nstatic struct hid_driver ite_driver = {\n\t.name = \"itetech\",\n\t.id_table = ite_devices,\n\t.probe = ite_probe,\n\t.report_fixup = ite_report_fixup,\n\t.input_mapping = ite_input_mapping,\n\t.event = ite_event,\n};\nmodule_hid_driver(ite_driver);\n\nMODULE_AUTHOR(\"Hans de Goede <hdegoede@redhat.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}