{
  "module_name": "amd_sfh_interface.c",
  "hash_id": "e5efb753fd4547a517dbd7ad9aa120ea79a96d85033587f04c3d4ab49f564e63",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/amd-sfh-hid/sfh1_1/amd_sfh_interface.c",
  "human_readable_source": "\n \n#include <linux/io-64-nonatomic-lo-hi.h>\n#include <linux/iopoll.h>\n\n#include \"amd_sfh_interface.h\"\n\nstatic int amd_sfh_wait_response(struct amd_mp2_dev *mp2, u8 sid, u32 cmd_id)\n{\n\tstruct sfh_cmd_response cmd_resp;\n\n\t \n\tif (!readl_poll_timeout(mp2->mmio + AMD_P2C_MSG(0), cmd_resp.resp,\n\t\t\t\t(cmd_resp.response.response == 0 &&\n\t\t\t\tcmd_resp.response.cmd_id == cmd_id && (sid == 0xff ||\n\t\t\t\tcmd_resp.response.sensor_id == sid)), 500, 10000000))\n\t\treturn cmd_resp.response.response;\n\n\treturn -1;\n}\n\nstatic void amd_start_sensor(struct amd_mp2_dev *privdata, struct amd_mp2_sensor_info info)\n{\n\tstruct sfh_cmd_base cmd_base;\n\n\tcmd_base.ul = 0;\n\tcmd_base.cmd.cmd_id = ENABLE_SENSOR;\n\tcmd_base.cmd.intr_disable = 0;\n\tcmd_base.cmd.sub_cmd_value = 1;\n\tcmd_base.cmd.sensor_id = info.sensor_idx;\n\n\twritel(cmd_base.ul, privdata->mmio + AMD_C2P_MSG(0));\n}\n\nstatic void amd_stop_sensor(struct amd_mp2_dev *privdata, u16 sensor_idx)\n{\n\tstruct sfh_cmd_base cmd_base;\n\n\tcmd_base.ul = 0;\n\tcmd_base.cmd.cmd_id = DISABLE_SENSOR;\n\tcmd_base.cmd.intr_disable = 0;\n\tcmd_base.cmd.sub_cmd_value = 1;\n\tcmd_base.cmd.sensor_id = sensor_idx;\n\n\twriteq(0x0, privdata->mmio + AMD_C2P_MSG(1));\n\twritel(cmd_base.ul, privdata->mmio + AMD_C2P_MSG(0));\n}\n\nstatic void amd_stop_all_sensor(struct amd_mp2_dev *privdata)\n{\n\tstruct sfh_cmd_base cmd_base;\n\n\tcmd_base.ul = 0;\n\tcmd_base.cmd.cmd_id = DISABLE_SENSOR;\n\tcmd_base.cmd.intr_disable = 0;\n\t \n\tcmd_base.cmd.sensor_id = 0xf;\n\n\twritel(cmd_base.ul, privdata->mmio + AMD_C2P_MSG(0));\n}\n\nstatic struct amd_mp2_ops amd_sfh_ops = {\n\t.start = amd_start_sensor,\n\t.stop = amd_stop_sensor,\n\t.stop_all = amd_stop_all_sensor,\n\t.response = amd_sfh_wait_response,\n};\n\nvoid sfh_interface_init(struct amd_mp2_dev *mp2)\n{\n\tmp2->mp2_ops = &amd_sfh_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}