{
  "module_name": "hid-chicony.c",
  "hash_id": "ab1ddc69e37cebd9f33a6f40e3615def0855d9d921927a3c94a6ea4ca26aa6f8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-chicony.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/device.h>\n#include <linux/input.h>\n#include <linux/hid.h>\n#include <linux/module.h>\n#include <linux/usb.h>\n\n#include \"hid-ids.h\"\n\n#define CH_WIRELESS_CTL_REPORT_ID\t0x11\n\nstatic int ch_report_wireless(struct hid_report *report, u8 *data, int size)\n{\n\tstruct hid_device *hdev = report->device;\n\tstruct input_dev *input;\n\n\tif (report->id != CH_WIRELESS_CTL_REPORT_ID || report->maxfield != 1)\n\t\treturn 0;\n\n\tinput = report->field[0]->hidinput->input;\n\tif (!input) {\n\t\thid_warn(hdev, \"can't find wireless radio control's input\");\n\t\treturn 0;\n\t}\n\n\tinput_report_key(input, KEY_RFKILL, 1);\n\tinput_sync(input);\n\tinput_report_key(input, KEY_RFKILL, 0);\n\tinput_sync(input);\n\n\treturn 1;\n}\n\nstatic int ch_raw_event(struct hid_device *hdev,\n\t\tstruct hid_report *report, u8 *data, int size)\n{\n\tif (report->application == HID_GD_WIRELESS_RADIO_CTLS)\n\t\treturn ch_report_wireless(report, data, size);\n\n\treturn 0;\n}\n\n#define ch_map_key_clear(c)\thid_map_usage_clear(hi, usage, bit, max, \\\n\t\t\t\t\tEV_KEY, (c))\nstatic int ch_input_mapping(struct hid_device *hdev, struct hid_input *hi,\n\t\tstruct hid_field *field, struct hid_usage *usage,\n\t\tunsigned long **bit, int *max)\n{\n\tif ((usage->hid & HID_USAGE_PAGE) != HID_UP_MSVENDOR)\n\t\treturn 0;\n\n\tset_bit(EV_REP, hi->input->evbit);\n\tswitch (usage->hid & HID_USAGE) {\n\tcase 0xff01: ch_map_key_clear(BTN_1);\tbreak;\n\tcase 0xff02: ch_map_key_clear(BTN_2);\tbreak;\n\tcase 0xff03: ch_map_key_clear(BTN_3);\tbreak;\n\tcase 0xff04: ch_map_key_clear(BTN_4);\tbreak;\n\tcase 0xff05: ch_map_key_clear(BTN_5);\tbreak;\n\tcase 0xff06: ch_map_key_clear(BTN_6);\tbreak;\n\tcase 0xff07: ch_map_key_clear(BTN_7);\tbreak;\n\tcase 0xff08: ch_map_key_clear(BTN_8);\tbreak;\n\tcase 0xff09: ch_map_key_clear(BTN_9);\tbreak;\n\tcase 0xff0a: ch_map_key_clear(BTN_A);\tbreak;\n\tcase 0xff0b: ch_map_key_clear(BTN_B);\tbreak;\n\tcase 0x00f1: ch_map_key_clear(KEY_WLAN);\tbreak;\n\tcase 0x00f2: ch_map_key_clear(KEY_BRIGHTNESSDOWN);\tbreak;\n\tcase 0x00f3: ch_map_key_clear(KEY_BRIGHTNESSUP);\tbreak;\n\tcase 0x00f4: ch_map_key_clear(KEY_DISPLAY_OFF);\tbreak;\n\tcase 0x00f7: ch_map_key_clear(KEY_CAMERA);\tbreak;\n\tcase 0x00f8: ch_map_key_clear(KEY_PROG1);\tbreak;\n\tdefault:\n\t\treturn 0;\n\t}\n\treturn 1;\n}\n\nstatic __u8 *ch_switch12_report_fixup(struct hid_device *hdev, __u8 *rdesc,\n\t\tunsigned int *rsize)\n{\n\tstruct usb_interface *intf = to_usb_interface(hdev->dev.parent);\n\t\n\tif (intf->cur_altsetting->desc.bInterfaceNumber == 1) {\n\t\t \n\t\tswitch (hdev->product) {\n\t\tcase USB_DEVICE_ID_CHICONY_ACER_SWITCH12:\n\t\t\tif (*rsize >= 128 && rdesc[64] == 0xff && rdesc[65] == 0x7f\n\t\t\t\t\t&& rdesc[69] == 0xff && rdesc[70] == 0x7f) {\n\t\t\t\thid_info(hdev, \"Fixing up report descriptor\\n\");\n\t\t\t\trdesc[65] = rdesc[70] = 0x2f;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\t}\n\treturn rdesc;\n}\n\nstatic int ch_probe(struct hid_device *hdev, const struct hid_device_id *id)\n{\n\tint ret;\n\n\tif (!hid_is_usb(hdev))\n\t\treturn -EINVAL;\n\n\thdev->quirks |= HID_QUIRK_INPUT_PER_APP;\n\tret = hid_parse(hdev);\n\tif (ret) {\n\t\thid_err(hdev, \"Chicony hid parse failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = hid_hw_start(hdev, HID_CONNECT_DEFAULT);\n\tif (ret) {\n\t\thid_err(hdev, \"Chicony hw start failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct hid_device_id ch_devices[] = {\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_CHICONY, USB_DEVICE_ID_CHICONY_TACTICAL_PAD) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_CHICONY, USB_DEVICE_ID_CHICONY_WIRELESS2) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_CHICONY, USB_DEVICE_ID_CHICONY_WIRELESS3) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_CHICONY, USB_DEVICE_ID_CHICONY_ACER_SWITCH12) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, ch_devices);\n\nstatic struct hid_driver ch_driver = {\n\t.name = \"chicony\",\n\t.id_table = ch_devices,\n\t.report_fixup = ch_switch12_report_fixup,\n\t.input_mapping = ch_input_mapping,\n\t.probe = ch_probe,\n\t.raw_event = ch_raw_event,\n};\nmodule_hid_driver(ch_driver);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}