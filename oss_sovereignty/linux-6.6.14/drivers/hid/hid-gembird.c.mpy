{
  "module_name": "hid-gembird.c",
  "hash_id": "5ad5d5445be4be4cbc725ce66a80103af275124f114771b3051bd67fa6890408",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-gembird.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/device.h>\n#include <linux/hid.h>\n#include <linux/module.h>\n\n#include \"hid-ids.h\"\n\n#define GEMBIRD_START_FAULTY_RDESC\t8\n\nstatic const __u8 gembird_jpd_faulty_rdesc[] = {\n\t0x75, 0x08,\t\t\t \n\t0x95, 0x05,\t\t\t \n\t0x15, 0x00,\t\t\t \n\t0x26, 0xff, 0x00,\t\t \n\t0x35, 0x00,\t\t\t \n\t0x46, 0xff, 0x00,\t\t \n\t0x09, 0x30,\t\t\t \n\t0x09, 0x31,\t\t\t \n\t0x09, 0x32,\t\t\t \n\t0x09, 0x32,\t\t\t \n\t0x09, 0x35,\t\t\t \n\t0x81, 0x02,\t\t\t \n};\n\n \nstatic const __u8 gembird_jpd_fixed_rdesc[] = {\n\t0x75, 0x08,\t\t\t \n\t0x95, 0x02,\t\t\t \n\t0x15, 0x00,\t\t\t \n\t0x26, 0xff, 0x00,\t\t \n\t0x35, 0x00,\t\t\t \n\t0x46, 0xff, 0x00,\t\t \n\t0x09, 0x30,\t\t\t \n\t0x09, 0x31,\t\t\t \n\t0x81, 0x02,\t\t\t \n\t0x95, 0x01,\t\t\t \n\t0x09, 0x32,\t\t\t \n\t0x81, 0x01,\t\t\t \n\t0x95, 0x02,\t\t\t \n\t0x09, 0x33,\t\t\t \n\t0x09, 0x34,\t\t\t \n\t0x81, 0x02,\t\t\t \n};\n\nstatic __u8 *gembird_report_fixup(struct hid_device *hdev, __u8 *rdesc,\n\t\tunsigned int *rsize)\n{\n\t__u8 *new_rdesc;\n\t \n\tsize_t delta_size = sizeof(gembird_jpd_fixed_rdesc) -\n\t\t\t    sizeof(gembird_jpd_faulty_rdesc);\n\tsize_t new_size = *rsize + delta_size;\n\n\tif (*rsize >= 31 && !memcmp(&rdesc[GEMBIRD_START_FAULTY_RDESC],\n\t\t\t\t    gembird_jpd_faulty_rdesc,\n\t\t\t\t    sizeof(gembird_jpd_faulty_rdesc))) {\n\t\tnew_rdesc = devm_kzalloc(&hdev->dev, new_size, GFP_KERNEL);\n\t\tif (new_rdesc == NULL)\n\t\t\treturn rdesc;\n\n\t\tdev_info(&hdev->dev,\n\t\t\t \"fixing Gembird JPD-DualForce 2 report descriptor.\\n\");\n\n\t\t \n\t\tmemcpy(new_rdesc + delta_size, rdesc, *rsize);\n\n\t\t \n\t\tmemcpy(new_rdesc, rdesc, GEMBIRD_START_FAULTY_RDESC);\n\n\t\t \n\t\tmemcpy(new_rdesc + GEMBIRD_START_FAULTY_RDESC,\n\t\t       gembird_jpd_fixed_rdesc,\n\t\t       sizeof(gembird_jpd_fixed_rdesc));\n\n\t\t*rsize = new_size;\n\t\trdesc = new_rdesc;\n\t}\n\n\treturn rdesc;\n}\n\nstatic const struct hid_device_id gembird_devices[] = {\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_GEMBIRD,\n\t\t\t USB_DEVICE_ID_GEMBIRD_JPD_DUALFORCE2) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, gembird_devices);\n\nstatic struct hid_driver gembird_driver = {\n\t.name = \"gembird\",\n\t.id_table = gembird_devices,\n\t.report_fixup = gembird_report_fixup,\n};\nmodule_hid_driver(gembird_driver);\n\nMODULE_AUTHOR(\"Benjamin Tissoires <benjamin.tissoires@gmail.com>\");\nMODULE_DESCRIPTION(\"HID Gembird joypad driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}