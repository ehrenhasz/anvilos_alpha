{
  "module_name": "init.c",
  "hash_id": "50edcb5d638138c860c39384596f2bca8a1f2cda4d580c2d9dc3978675089575",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/intel-ish-hid/ishtp/init.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n#include <linux/slab.h>\n#include <linux/sched.h>\n#include \"ishtp-dev.h\"\n#include \"hbm.h\"\n#include \"client.h\"\n\n \nconst char *ishtp_dev_state_str(int state)\n{\n\tswitch (state) {\n\tcase ISHTP_DEV_INITIALIZING:\n\t\treturn\t\"INITIALIZING\";\n\tcase ISHTP_DEV_INIT_CLIENTS:\n\t\treturn\t\"INIT_CLIENTS\";\n\tcase ISHTP_DEV_ENABLED:\n\t\treturn\t\"ENABLED\";\n\tcase ISHTP_DEV_RESETTING:\n\t\treturn\t\"RESETTING\";\n\tcase ISHTP_DEV_DISABLED:\n\t\treturn\t\"DISABLED\";\n\tcase ISHTP_DEV_POWER_DOWN:\n\t\treturn\t\"POWER_DOWN\";\n\tcase ISHTP_DEV_POWER_UP:\n\t\treturn\t\"POWER_UP\";\n\tdefault:\n\t\treturn \"unknown\";\n\t}\n}\n\n \nvoid ishtp_device_init(struct ishtp_device *dev)\n{\n\tdev->dev_state = ISHTP_DEV_INITIALIZING;\n\tINIT_LIST_HEAD(&dev->cl_list);\n\tINIT_LIST_HEAD(&dev->device_list);\n\tdev->rd_msg_fifo_head = 0;\n\tdev->rd_msg_fifo_tail = 0;\n\tspin_lock_init(&dev->rd_msg_spinlock);\n\n\tinit_waitqueue_head(&dev->wait_hbm_recvd_msg);\n\tspin_lock_init(&dev->read_list_spinlock);\n\tspin_lock_init(&dev->device_lock);\n\tspin_lock_init(&dev->device_list_lock);\n\tspin_lock_init(&dev->cl_list_lock);\n\tspin_lock_init(&dev->fw_clients_lock);\n\tINIT_WORK(&dev->bh_hbm_work, bh_hbm_work_fn);\n\n\tbitmap_zero(dev->host_clients_map, ISHTP_CLIENTS_MAX);\n\tdev->open_handle_count = 0;\n\n\t \n\tbitmap_set(dev->host_clients_map, 0, 1);\n\n\tINIT_LIST_HEAD(&dev->read_list.list);\n\n}\nEXPORT_SYMBOL(ishtp_device_init);\n\n \nint ishtp_start(struct ishtp_device *dev)\n{\n\tif (ishtp_hbm_start_wait(dev)) {\n\t\tdev_err(dev->devc, \"HBM haven't started\");\n\t\tgoto err;\n\t}\n\n\t \n\tishtp_query_subscribers(dev);\n\n\treturn 0;\nerr:\n\tdev_err(dev->devc, \"link layer initialization failed.\\n\");\n\tdev->dev_state = ISHTP_DEV_DISABLED;\n\treturn -ENODEV;\n}\nEXPORT_SYMBOL(ishtp_start);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}