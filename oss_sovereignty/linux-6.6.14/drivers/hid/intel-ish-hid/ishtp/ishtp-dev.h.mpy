{
  "module_name": "ishtp-dev.h",
  "hash_id": "080a898373cfff348a9775f2072ac54b677bba4abe34e518d35aa70daeec3f31",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/intel-ish-hid/ishtp/ishtp-dev.h",
  "human_readable_source": " \n \n\n#ifndef _ISHTP_DEV_H_\n#define _ISHTP_DEV_H_\n\n#include <linux/types.h>\n#include <linux/spinlock.h>\n#include <linux/intel-ish-client-if.h>\n#include \"bus.h\"\n#include \"hbm.h\"\n\n#define\tIPC_PAYLOAD_SIZE\t128\n#define ISHTP_RD_MSG_BUF_SIZE\tIPC_PAYLOAD_SIZE\n#define\tIPC_FULL_MSG_SIZE\t132\n\n \n#define\tRD_INT_FIFO_SIZE\t64\n\n \n#define\tIPC_TX_FIFO_SIZE\t512\n\n \n#define ISHTP_CLIENTS_MAX 256\n\n \n#define ISHTP_MAX_OPEN_HANDLE_COUNT (ISHTP_CLIENTS_MAX - 1)\n\n \n#define ISHTP_HOST_CLIENT_ID_ANY\t\t(-1)\n#define ISHTP_HBM_HOST_CLIENT_ID\t\t0\n\n#define\tMAX_DMA_DELAY\t20\n\n \nenum ishtp_dev_state {\n\tISHTP_DEV_INITIALIZING = 0,\n\tISHTP_DEV_INIT_CLIENTS,\n\tISHTP_DEV_ENABLED,\n\tISHTP_DEV_RESETTING,\n\tISHTP_DEV_DISABLED,\n\tISHTP_DEV_POWER_DOWN,\n\tISHTP_DEV_POWER_UP\n};\nconst char *ishtp_dev_state_str(int state);\n\nstruct ishtp_cl;\n\n \nstruct ishtp_fw_client {\n\tstruct ishtp_client_properties props;\n\tuint8_t client_id;\n};\n\n \nstruct wr_msg_ctl_info {\n\t \n\tvoid (*ipc_send_compl)(void *);\n\n\tvoid *ipc_send_compl_prm;\n\tsize_t length;\n\tstruct list_head\tlink;\n\tunsigned char\tinline_data[IPC_FULL_MSG_SIZE];\n};\n\n \nstruct ishtp_hw_ops {\n\tint\t(*hw_reset)(struct ishtp_device *dev);\n\tint\t(*ipc_reset)(struct ishtp_device *dev);\n\tuint32_t (*ipc_get_header)(struct ishtp_device *dev, int length,\n\t\t\t\t   int busy);\n\tint\t(*write)(struct ishtp_device *dev,\n\t\tvoid (*ipc_send_compl)(void *), void *ipc_send_compl_prm,\n\t\tunsigned char *msg, int length);\n\tuint32_t\t(*ishtp_read_hdr)(const struct ishtp_device *dev);\n\tint\t(*ishtp_read)(struct ishtp_device *dev, unsigned char *buffer,\n\t\t\tunsigned long buffer_length);\n\tuint32_t\t(*get_fw_status)(struct ishtp_device *dev);\n\tvoid\t(*sync_fw_clock)(struct ishtp_device *dev);\n\tbool\t(*dma_no_cache_snooping)(struct ishtp_device *dev);\n};\n\n \nstruct ishtp_device {\n\tstruct device *devc;\t \n\tstruct pci_dev *pdev;\t \n\n\t \n\twait_queue_head_t suspend_wait;\n\tbool suspend_flag;\t \n\n\t \n\twait_queue_head_t resume_wait;\n\tbool resume_flag;\t \n\n\t \n\tspinlock_t device_lock;\n\n\tbool recvd_hw_ready;\n\tstruct hbm_version version;\n\tint transfer_path;  \n\n\t \n\tenum ishtp_dev_state dev_state;\n\tenum ishtp_hbm_state hbm_state;\n\n\t \n\tstruct ishtp_cl_rb read_list;\n\tspinlock_t read_list_spinlock;\n\n\t \n\tstruct list_head cl_list;\n\tspinlock_t cl_list_lock;\n\tlong open_handle_count;\n\n\t \n\tstruct list_head device_list;\n\tspinlock_t device_list_lock;\n\n\t \n\twait_queue_head_t wait_hw_ready;\n\twait_queue_head_t wait_hbm_recvd_msg;\n\n\t \n\tunsigned char rd_msg_fifo[RD_INT_FIFO_SIZE * IPC_PAYLOAD_SIZE];\n\tunsigned int rd_msg_fifo_head, rd_msg_fifo_tail;\n\tspinlock_t rd_msg_spinlock;\n\tstruct work_struct bh_hbm_work;\n\n\t \n\tstruct list_head wr_processing_list, wr_free_list;\n\t \n\tspinlock_t wr_processing_spinlock;\n\n\tstruct ishtp_fw_client *fw_clients;  \n\tDECLARE_BITMAP(fw_clients_map, ISHTP_CLIENTS_MAX);\n\tDECLARE_BITMAP(host_clients_map, ISHTP_CLIENTS_MAX);\n\tuint8_t fw_clients_num;\n\tuint8_t fw_client_presentation_num;\n\tuint8_t fw_client_index;\n\tspinlock_t fw_clients_lock;\n\n\t \n\tint ishtp_host_dma_enabled;\n\tvoid *ishtp_host_dma_tx_buf;\n\tunsigned int ishtp_host_dma_tx_buf_size;\n\tuint64_t ishtp_host_dma_tx_buf_phys;\n\tint ishtp_dma_num_slots;\n\n\t \n\tuint8_t *ishtp_dma_tx_map;\n\tspinlock_t ishtp_dma_tx_lock;\n\n\t \n\tvoid *ishtp_host_dma_rx_buf;\n\tunsigned int ishtp_host_dma_rx_buf_size;\n\tuint64_t ishtp_host_dma_rx_buf_phys;\n\n\t \n\tishtp_print_log print_log;\n\n\t \n\tunsigned int\tipc_rx_cnt;\n\tunsigned long long\tipc_rx_bytes_cnt;\n\tunsigned int\tipc_tx_cnt;\n\tunsigned long long\tipc_tx_bytes_cnt;\n\n\tconst struct ishtp_hw_ops *ops;\n\tsize_t\tmtu;\n\tuint32_t\tishtp_msg_hdr;\n\tchar hw[] __aligned(sizeof(void *));\n};\n\nstatic inline unsigned long ishtp_secs_to_jiffies(unsigned long sec)\n{\n\treturn msecs_to_jiffies(sec * MSEC_PER_SEC);\n}\n\n \nstatic inline int ish_ipc_reset(struct ishtp_device *dev)\n{\n\treturn dev->ops->ipc_reset(dev);\n}\n\n \nvoid\tishtp_device_init(struct ishtp_device *dev);\nint\tishtp_start(struct ishtp_device *dev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}