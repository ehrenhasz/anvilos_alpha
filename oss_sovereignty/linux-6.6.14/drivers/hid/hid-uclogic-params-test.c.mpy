{
  "module_name": "hid-uclogic-params-test.c",
  "hash_id": "5fe22f9fc8e261d18a489040b522d7993f8f471abbba33a074afaf892cb2ea7a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-uclogic-params-test.c",
  "human_readable_source": "\n\n \n\n#include <kunit/test.h>\n#include \"./hid-uclogic-params.h\"\n#include \"./hid-uclogic-rdesc.h\"\n\n#define MAX_STR_DESC_SIZE 14\n\nstruct uclogic_parse_ugee_v2_desc_case {\n\tconst char *name;\n\tint res;\n\tconst __u8 str_desc[MAX_STR_DESC_SIZE];\n\tsize_t str_desc_size;\n\tconst s32 desc_params[UCLOGIC_RDESC_PH_ID_NUM];\n\tenum uclogic_params_frame_type frame_type;\n};\n\nstatic struct uclogic_parse_ugee_v2_desc_case uclogic_parse_ugee_v2_desc_cases[] = {\n\t{\n\t\t.name = \"invalid_str_desc\",\n\t\t.res = -EINVAL,\n\t\t.str_desc = {},\n\t\t.str_desc_size = 0,\n\t\t.desc_params = {},\n\t\t.frame_type = UCLOGIC_PARAMS_FRAME_BUTTONS,\n\t},\n\t{\n\t\t.name = \"resolution_with_value_0\",\n\t\t.res = 0,\n\t\t.str_desc = {\n\t\t\t0x0E, 0x03,\n\t\t\t0x70, 0xB2,\n\t\t\t0x10, 0x77,\n\t\t\t0x08,\n\t\t\t0x00,\n\t\t\t0xFF, 0x1F,\n\t\t\t0x00, 0x00,\n\t\t},\n\t\t.str_desc_size = 12,\n\t\t.desc_params = {\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_LM] = 0xB270,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_PM] = 0,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_LM] = 0x7710,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_PM] = 0,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_PRESSURE_LM] = 0x1FFF,\n\t\t\t[UCLOGIC_RDESC_FRAME_PH_ID_UM] = 0x08,\n\t\t},\n\t\t.frame_type = UCLOGIC_PARAMS_FRAME_BUTTONS,\n\t},\n\t \n\t{\n\t\t.name = \"frame_type_buttons\",\n\t\t.res = 0,\n\t\t.str_desc = {\n\t\t\t0x0E, 0x03,\n\t\t\t0x70, 0xB2,\n\t\t\t0x10, 0x77,\n\t\t\t0x08,\n\t\t\t0x00,\n\t\t\t0xFF, 0x1F,\n\t\t\t0xD8, 0x13,\n\t\t},\n\t\t.str_desc_size = 12,\n\t\t.desc_params = {\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_LM] = 0xB270,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_PM] = 0x2320,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_LM] = 0x7710,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_PM] = 0x1770,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_PRESSURE_LM] = 0x1FFF,\n\t\t\t[UCLOGIC_RDESC_FRAME_PH_ID_UM] = 0x08,\n\t\t},\n\t\t.frame_type = UCLOGIC_PARAMS_FRAME_BUTTONS,\n\t},\n\t \n\t{\n\t\t.name = \"frame_type_dial\",\n\t\t.res = 0,\n\t\t.str_desc = {\n\t\t\t0x0E, 0x03,\n\t\t\t0x96, 0xC7,\n\t\t\t0xF9, 0x7C,\n\t\t\t0x09,\n\t\t\t0x01,\n\t\t\t0xFF, 0x1F,\n\t\t\t0xD8, 0x13,\n\t\t},\n\t\t.str_desc_size = 12,\n\t\t.desc_params = {\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_LM] = 0xC796,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_PM] = 0x2749,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_LM] = 0x7CF9,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_PM] = 0x1899,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_PRESSURE_LM] = 0x1FFF,\n\t\t\t[UCLOGIC_RDESC_FRAME_PH_ID_UM] = 0x09,\n\t\t},\n\t\t.frame_type = UCLOGIC_PARAMS_FRAME_DIAL,\n\t},\n\t \n\t{\n\t\t.name = \"frame_type_mouse\",\n\t\t.res = 0,\n\t\t.str_desc = {\n\t\t\t0x0E, 0x03,\n\t\t\t0xC8, 0xB3,\n\t\t\t0x34, 0x65,\n\t\t\t0x08,\n\t\t\t0x02,\n\t\t\t0xFF, 0x1F,\n\t\t\t0xD8, 0x13,\n\t\t},\n\t\t.str_desc_size = 12,\n\t\t.desc_params = {\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_LM] = 0xB3C8,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_X_PM] = 0x2363,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_LM] = 0x6534,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_Y_PM] = 0x13EC,\n\t\t\t[UCLOGIC_RDESC_PEN_PH_ID_PRESSURE_LM] = 0x1FFF,\n\t\t\t[UCLOGIC_RDESC_FRAME_PH_ID_UM] = 0x08,\n\t\t},\n\t\t.frame_type = UCLOGIC_PARAMS_FRAME_MOUSE,\n\t},\n};\n\nstatic void uclogic_parse_ugee_v2_desc_case_desc(struct uclogic_parse_ugee_v2_desc_case *t,\n\t\t\t\t\t\t char *desc)\n{\n\tstrscpy(desc, t->name, KUNIT_PARAM_DESC_SIZE);\n}\n\nKUNIT_ARRAY_PARAM(uclogic_parse_ugee_v2_desc, uclogic_parse_ugee_v2_desc_cases,\n\t\t  uclogic_parse_ugee_v2_desc_case_desc);\n\nstatic void hid_test_uclogic_parse_ugee_v2_desc(struct kunit *test)\n{\n\tint res;\n\ts32 desc_params[UCLOGIC_RDESC_PH_ID_NUM];\n\tenum uclogic_params_frame_type frame_type;\n\tconst struct uclogic_parse_ugee_v2_desc_case *params = test->param_value;\n\n\tres = uclogic_params_parse_ugee_v2_desc(params->str_desc,\n\t\t\t\t\t\tparams->str_desc_size,\n\t\t\t\t\t\tdesc_params,\n\t\t\t\t\t\tARRAY_SIZE(desc_params),\n\t\t\t\t\t\t&frame_type);\n\tKUNIT_ASSERT_EQ(test, res, params->res);\n\n\tif (res)\n\t\treturn;\n\n\tKUNIT_EXPECT_EQ(test,\n\t\t\tparams->desc_params[UCLOGIC_RDESC_PEN_PH_ID_X_LM],\n\t\t\tdesc_params[UCLOGIC_RDESC_PEN_PH_ID_X_LM]);\n\tKUNIT_EXPECT_EQ(test,\n\t\t\tparams->desc_params[UCLOGIC_RDESC_PEN_PH_ID_X_PM],\n\t\t\tdesc_params[UCLOGIC_RDESC_PEN_PH_ID_X_PM]);\n\tKUNIT_EXPECT_EQ(test,\n\t\t\tparams->desc_params[UCLOGIC_RDESC_PEN_PH_ID_Y_LM],\n\t\t\tdesc_params[UCLOGIC_RDESC_PEN_PH_ID_Y_LM]);\n\tKUNIT_EXPECT_EQ(test,\n\t\t\tparams->desc_params[UCLOGIC_RDESC_PEN_PH_ID_Y_PM],\n\t\t\tdesc_params[UCLOGIC_RDESC_PEN_PH_ID_Y_PM]);\n\tKUNIT_EXPECT_EQ(test,\n\t\t\tparams->desc_params[UCLOGIC_RDESC_PEN_PH_ID_PRESSURE_LM],\n\t\t\tdesc_params[UCLOGIC_RDESC_PEN_PH_ID_PRESSURE_LM]);\n\tKUNIT_EXPECT_EQ(test,\n\t\t\tparams->desc_params[UCLOGIC_RDESC_FRAME_PH_ID_UM],\n\t\t\tdesc_params[UCLOGIC_RDESC_FRAME_PH_ID_UM]);\n\tKUNIT_EXPECT_EQ(test, params->frame_type, frame_type);\n}\n\nstruct fake_device {\n\tunsigned long quirks;\n};\n\nstatic void hid_test_uclogic_params_cleanup_event_hooks(struct kunit *test)\n{\n\tint res, n;\n\tstruct hid_device *hdev;\n\tstruct fake_device *fake_dev;\n\tstruct uclogic_params p = {0, };\n\n\thdev = kunit_kzalloc(test, sizeof(struct hid_device), GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, hdev);\n\n\tfake_dev = kunit_kzalloc(test, sizeof(struct fake_device), GFP_KERNEL);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, fake_dev);\n\n\thid_set_drvdata(hdev, fake_dev);\n\n\tres = uclogic_params_ugee_v2_init_event_hooks(hdev, &p);\n\tKUNIT_ASSERT_EQ(test, res, 0);\n\n\t \n\tfor (n = 0; n < 4; n++) {\n\t\tuclogic_params_cleanup_event_hooks(&p);\n\t\tKUNIT_EXPECT_PTR_EQ(test, p.event_hooks, NULL);\n\t}\n}\n\nstatic struct kunit_case hid_uclogic_params_test_cases[] = {\n\tKUNIT_CASE_PARAM(hid_test_uclogic_parse_ugee_v2_desc,\n\t\t\t uclogic_parse_ugee_v2_desc_gen_params),\n\tKUNIT_CASE(hid_test_uclogic_params_cleanup_event_hooks),\n\t{}\n};\n\nstatic struct kunit_suite hid_uclogic_params_test_suite = {\n\t.name = \"hid_uclogic_params_test\",\n\t.test_cases = hid_uclogic_params_test_cases,\n};\n\nkunit_test_suite(hid_uclogic_params_test_suite);\n\nMODULE_DESCRIPTION(\"KUnit tests for the UC-Logic driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Jos\u00e9 Exp\u00f3sito <jose.exposito89@gmail.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}