{
  "module_name": "hid-lg2ff.c",
  "hash_id": "b452109ac084d78c8250cc8cf51b9d6da4d3ed7b1b4a41f98edf7a734893f41b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-lg2ff.c",
  "human_readable_source": "\n \n\n \n\n\n#include <linux/input.h>\n#include <linux/slab.h>\n#include <linux/hid.h>\n\n#include \"hid-lg.h\"\n\nstruct lg2ff_device {\n\tstruct hid_report *report;\n};\n\nstatic int play_effect(struct input_dev *dev, void *data,\n\t\t\t struct ff_effect *effect)\n{\n\tstruct hid_device *hid = input_get_drvdata(dev);\n\tstruct lg2ff_device *lg2ff = data;\n\tint weak, strong;\n\n\tstrong = effect->u.rumble.strong_magnitude;\n\tweak = effect->u.rumble.weak_magnitude;\n\n\tif (weak || strong) {\n\t\tweak = weak * 0xff / 0xffff;\n\t\tstrong = strong * 0xff / 0xffff;\n\n\t\tlg2ff->report->field[0]->value[0] = 0x51;\n\t\tlg2ff->report->field[0]->value[2] = weak;\n\t\tlg2ff->report->field[0]->value[4] = strong;\n\t} else {\n\t\tlg2ff->report->field[0]->value[0] = 0xf3;\n\t\tlg2ff->report->field[0]->value[2] = 0x00;\n\t\tlg2ff->report->field[0]->value[4] = 0x00;\n\t}\n\n\thid_hw_request(hid, lg2ff->report, HID_REQ_SET_REPORT);\n\treturn 0;\n}\n\nint lg2ff_init(struct hid_device *hid)\n{\n\tstruct lg2ff_device *lg2ff;\n\tstruct hid_report *report;\n\tstruct hid_input *hidinput;\n\tstruct input_dev *dev;\n\tint error;\n\n\tif (list_empty(&hid->inputs)) {\n\t\thid_err(hid, \"no inputs found\\n\");\n\t\treturn -ENODEV;\n\t}\n\thidinput = list_entry(hid->inputs.next, struct hid_input, list);\n\tdev = hidinput->input;\n\n\t \n\treport = hid_validate_values(hid, HID_OUTPUT_REPORT, 0, 0, 7);\n\tif (!report)\n\t\treturn -ENODEV;\n\n\tlg2ff = kmalloc(sizeof(struct lg2ff_device), GFP_KERNEL);\n\tif (!lg2ff)\n\t\treturn -ENOMEM;\n\n\tset_bit(FF_RUMBLE, dev->ffbit);\n\n\terror = input_ff_create_memless(dev, lg2ff, play_effect);\n\tif (error) {\n\t\tkfree(lg2ff);\n\t\treturn error;\n\t}\n\n\tlg2ff->report = report;\n\treport->field[0]->value[0] = 0xf3;\n\treport->field[0]->value[1] = 0x00;\n\treport->field[0]->value[2] = 0x00;\n\treport->field[0]->value[3] = 0x00;\n\treport->field[0]->value[4] = 0x00;\n\treport->field[0]->value[5] = 0x00;\n\treport->field[0]->value[6] = 0x00;\n\n\thid_hw_request(hid, report, HID_REQ_SET_REPORT);\n\n\thid_info(hid, \"Force feedback for Logitech variant 2 rumble devices by Anssi Hannula <anssi.hannula@gmail.com>\\n\");\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}