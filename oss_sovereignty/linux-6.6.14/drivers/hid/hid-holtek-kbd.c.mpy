{
  "module_name": "hid-holtek-kbd.c",
  "hash_id": "8e4776998f696839b5f69dcfad591a5dd70a266a197e36c32c06fecf44d0355b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-holtek-kbd.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/device.h>\n#include <linux/hid.h>\n#include <linux/module.h>\n#include <linux/usb.h>\n\n#include \"hid-ids.h\"\n#include \"usbhid/usbhid.h\"\n\n \n\nstatic __u8 holtek_kbd_rdesc_fixed[] = {\n\t \n\t0x05, 0x01,          \n\t0x09, 0x80,          \n\t0xA1, 0x01,          \n\t0x85, 0x01,          \n\t0x19, 0x81,          \n\t0x29, 0x83,          \n\t0x15, 0x00,          \n\t0x25, 0x01,          \n\t0x95, 0x03,          \n\t0x75, 0x01,          \n\t0x81, 0x02,          \n\t0x95, 0x01,          \n\t0x75, 0x05,          \n\t0x81, 0x01,          \n\t0xC0,                \n\t0x05, 0x0C,          \n\t0x09, 0x01,          \n\t0xA1, 0x01,          \n\t0x85, 0x02,          \n\t0x19, 0x00,          \n\t0x2A, 0xFF, 0x2F,    \n\t0x15, 0x00,          \n\t0x26, 0xFF, 0x2F,    \n\t0x95, 0x01,          \n\t0x75, 0x10,          \n\t0x81, 0x00,          \n\t0xC0,                \n\t0x05, 0x01,          \n\t0x09, 0x06,          \n\t0xA1, 0x01,          \n\t0x85, 0x03,          \n\t0x95, 0x38,          \n\t0x75, 0x01,          \n\t0x15, 0x00,          \n\t0x25, 0x01,          \n\t0x05, 0x07,          \n\t0x19, 0xE0,          \n\t0x29, 0xE7,          \n\t0x19, 0x00,          \n\t0x29, 0x2F,          \n\t0x81, 0x02,          \n\t0xC0,                \n\t0x05, 0x01,          \n\t0x09, 0x06,          \n\t0xA1, 0x01,          \n\t0x85, 0x04,          \n\t0x95, 0x38,          \n\t0x75, 0x01,          \n\t0x15, 0x00,          \n\t0x25, 0x01,          \n\t0x05, 0x07,          \n\t0x19, 0x30,          \n\t0x29, 0x67,          \n\t0x81, 0x02,          \n\t0xC0,                \n\n\t \n\t0x05, 0x01,          \n\t0x09, 0x06,          \n\t0xA1, 0x01,          \n\t0x05, 0x08,          \n\t0x19, 0x01,          \n\t0x29, 0x03,          \n\t0x15, 0x00,          \n\t0x25, 0x01,          \n\t0x75, 0x01,          \n\t0x95, 0x03,          \n\t0x91, 0x02,          \n\t0x95, 0x05,          \n\t0x91, 0x01,          \n\t0xC0,                \n};\n\nstatic __u8 *holtek_kbd_report_fixup(struct hid_device *hdev, __u8 *rdesc,\n\t\tunsigned int *rsize)\n{\n\tstruct usb_interface *intf = to_usb_interface(hdev->dev.parent);\n\n\tif (intf->cur_altsetting->desc.bInterfaceNumber == 1) {\n\t\trdesc = holtek_kbd_rdesc_fixed;\n\t\t*rsize = sizeof(holtek_kbd_rdesc_fixed);\n\t}\n\treturn rdesc;\n}\n\nstatic int holtek_kbd_input_event(struct input_dev *dev, unsigned int type,\n\t\tunsigned int code,\n\t\tint value)\n{\n\tstruct hid_device *hid = input_get_drvdata(dev);\n\tstruct usb_device *usb_dev = hid_to_usb_dev(hid);\n\n\t \n\tstruct usb_interface *boot_interface = usb_ifnum_to_if(usb_dev, 0);\n\tstruct hid_device *boot_hid;\n\tstruct hid_input *boot_hid_input;\n\n\tif (unlikely(boot_interface == NULL))\n\t\treturn -ENODEV;\n\n\tboot_hid = usb_get_intfdata(boot_interface);\n\tif (list_empty(&boot_hid->inputs)) {\n\t\thid_err(hid, \"no inputs found\\n\");\n\t\treturn -ENODEV;\n\t}\n\tboot_hid_input = list_first_entry(&boot_hid->inputs,\n\t\tstruct hid_input, list);\n\n\treturn boot_hid_input->input->event(boot_hid_input->input, type, code,\n\t\t\tvalue);\n}\n\nstatic int holtek_kbd_probe(struct hid_device *hdev,\n\t\tconst struct hid_device_id *id)\n{\n\tstruct usb_interface *intf;\n\tint ret;\n\n\tif (!hid_is_usb(hdev))\n\t\treturn -EINVAL;\n\n\tret = hid_parse(hdev);\n\tif (!ret)\n\t\tret = hid_hw_start(hdev, HID_CONNECT_DEFAULT);\n\n\tintf = to_usb_interface(hdev->dev.parent);\n\tif (!ret && intf->cur_altsetting->desc.bInterfaceNumber == 1) {\n\t\tstruct hid_input *hidinput;\n\t\tlist_for_each_entry(hidinput, &hdev->inputs, list) {\n\t\t\thidinput->input->event = holtek_kbd_input_event;\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nstatic const struct hid_device_id holtek_kbd_devices[] = {\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_HOLTEK_ALT,\n\t\t\tUSB_DEVICE_ID_HOLTEK_ALT_KEYBOARD) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, holtek_kbd_devices);\n\nstatic struct hid_driver holtek_kbd_driver = {\n\t.name = \"holtek_kbd\",\n\t.id_table = holtek_kbd_devices,\n\t.report_fixup = holtek_kbd_report_fixup,\n\t.probe = holtek_kbd_probe\n};\nmodule_hid_driver(holtek_kbd_driver);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}