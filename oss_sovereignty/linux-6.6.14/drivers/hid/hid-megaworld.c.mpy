{
  "module_name": "hid-megaworld.c",
  "hash_id": "6c53f14ab0a07130a8104233cf1636ba241ab479b5a400b96d086b9ca7e032d0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-megaworld.c",
  "human_readable_source": "\n \n\n#include <linux/hid.h>\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/slab.h>\n\n#include \"hid-ids.h\"\n\nstruct mwctrl_device {\n\tstruct hid_report *report;\n\ts32 *weak;\n\ts32 *strong;\n};\n\nstatic int mwctrl_play(struct input_dev *dev, void *data,\n\t\t       struct ff_effect *effect)\n{\n\tstruct hid_device *hid = input_get_drvdata(dev);\n\tstruct mwctrl_device *mwctrl = data;\n\n\t*mwctrl->strong = effect->u.rumble.strong_magnitude >> 8;\n\t*mwctrl->weak = effect->u.rumble.weak_magnitude >> 8;\n\n\thid_hw_request(hid, mwctrl->report, HID_REQ_SET_REPORT);\n\n\treturn 0;\n}\n\nstatic int mwctrl_init(struct hid_device *hid)\n{\n\tstruct mwctrl_device *mwctrl;\n\tstruct hid_report *report;\n\tstruct hid_input *hidinput;\n\tstruct input_dev *dev;\n\tint error;\n\tint i;\n\n\tif (list_empty(&hid->inputs)) {\n\t\thid_err(hid, \"no inputs found\\n\");\n\t\treturn -ENODEV;\n\t}\n\thidinput = list_entry(hid->inputs.next, struct hid_input, list);\n\tdev = hidinput->input;\n\n\tfor (i = 0; i < 4; i++) {\n\t\treport = hid_validate_values(hid, HID_OUTPUT_REPORT, 0, i, 1);\n\t\tif (!report)\n\t\t\treturn -ENODEV;\n\t}\n\n\tmwctrl = kzalloc(sizeof(struct mwctrl_device), GFP_KERNEL);\n\tif (!mwctrl)\n\t\treturn -ENOMEM;\n\n\tset_bit(FF_RUMBLE, dev->ffbit);\n\n\terror = input_ff_create_memless(dev, mwctrl, mwctrl_play);\n\tif (error) {\n\t\tkfree(mwctrl);\n\t\treturn error;\n\t}\n\n\tmwctrl->report = report;\n\n\t \n\treport->field[0]->value[0] = 0x02;\n\n\tmwctrl->strong = &report->field[2]->value[0];\n\tmwctrl->weak = &report->field[3]->value[0];\n\n\treturn 0;\n}\n\nstatic int mwctrl_probe(struct hid_device *hdev, const struct hid_device_id *id)\n{\n\tint ret;\n\n\tret = hid_parse(hdev);\n\tif (ret) {\n\t\thid_err(hdev, \"parse failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = hid_hw_start(hdev, HID_CONNECT_DEFAULT & ~HID_CONNECT_FF);\n\tif (ret) {\n\t\thid_err(hdev, \"hw start failed\\n\");\n\t\treturn ret;\n\t}\n\n\tret = mwctrl_init(hdev);\n\tif (ret)\n\t\thid_hw_stop(hdev);\n\n\treturn ret;\n}\n\nstatic const struct hid_device_id mwctrl_devices[] = {\n\t{ HID_USB_DEVICE(USB_VENDOR_MEGAWORLD,\n\t\t\t USB_DEVICE_ID_MEGAWORLD_GAMEPAD) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, mwctrl_devices);\n\nstatic struct hid_driver mwctrl_driver = {\n\t.name = \"megaworld\",\n\t.id_table = mwctrl_devices,\n\t.probe = mwctrl_probe,\n};\nmodule_hid_driver(mwctrl_driver);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}