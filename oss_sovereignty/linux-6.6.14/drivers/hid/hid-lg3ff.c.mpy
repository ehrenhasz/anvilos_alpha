{
  "module_name": "hid-lg3ff.c",
  "hash_id": "5a9981a7c3d08cdccf6caba9ee3c98d08211e73a1b75304f528abf3981129573",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-lg3ff.c",
  "human_readable_source": "\n \n\n \n\n\n#include <linux/input.h>\n#include <linux/hid.h>\n\n#include \"hid-lg.h\"\n\n \n\nstruct lg3ff_device {\n\tstruct hid_report *report;\n};\n\nstatic int hid_lg3ff_play(struct input_dev *dev, void *data,\n\t\t\t struct ff_effect *effect)\n{\n\tstruct hid_device *hid = input_get_drvdata(dev);\n\tstruct list_head *report_list = &hid->report_enum[HID_OUTPUT_REPORT].report_list;\n\tstruct hid_report *report = list_entry(report_list->next, struct hid_report, list);\n\tint x, y;\n\n \n\tmemset(report->field[0]->value, 0,\n\t       sizeof(__s32) * report->field[0]->report_count);\n\n\tswitch (effect->type) {\n\tcase FF_CONSTANT:\n \n\t\tx = effect->u.ramp.start_level;\n\t\ty = effect->u.ramp.end_level;\n\n\t\t \n\t\treport->field[0]->value[0] = 0x51;\n\n \n\t\treport->field[0]->value[1] = (unsigned char)(-x);\n\t\treport->field[0]->value[31] = (unsigned char)(-y);\n\n\t\thid_hw_request(hid, report, HID_REQ_SET_REPORT);\n\t\tbreak;\n\t}\n\treturn 0;\n}\nstatic void hid_lg3ff_set_autocenter(struct input_dev *dev, u16 magnitude)\n{\n\tstruct hid_device *hid = input_get_drvdata(dev);\n\tstruct list_head *report_list = &hid->report_enum[HID_OUTPUT_REPORT].report_list;\n\tstruct hid_report *report = list_entry(report_list->next, struct hid_report, list);\n\n \n\treport->field[0]->value[0] = 0x51;\n\treport->field[0]->value[1] = 0x00;\n\treport->field[0]->value[2] = 0x00;\n\treport->field[0]->value[3] = 0x7F;\n\treport->field[0]->value[4] = 0x7F;\n\treport->field[0]->value[31] = 0x00;\n\treport->field[0]->value[32] = 0x00;\n\treport->field[0]->value[33] = 0x7F;\n\treport->field[0]->value[34] = 0x7F;\n\n\thid_hw_request(hid, report, HID_REQ_SET_REPORT);\n}\n\n\nstatic const signed short ff3_joystick_ac[] = {\n\tFF_CONSTANT,\n\tFF_AUTOCENTER,\n\t-1\n};\n\nint lg3ff_init(struct hid_device *hid)\n{\n\tstruct hid_input *hidinput;\n\tstruct input_dev *dev;\n\tconst signed short *ff_bits = ff3_joystick_ac;\n\tint error;\n\tint i;\n\n\tif (list_empty(&hid->inputs)) {\n\t\thid_err(hid, \"no inputs found\\n\");\n\t\treturn -ENODEV;\n\t}\n\thidinput = list_entry(hid->inputs.next, struct hid_input, list);\n\tdev = hidinput->input;\n\n\t \n\tif (!hid_validate_values(hid, HID_OUTPUT_REPORT, 0, 0, 35))\n\t\treturn -ENODEV;\n\n\t \n\tfor (i = 0; ff_bits[i] >= 0; i++)\n\t\tset_bit(ff_bits[i], dev->ffbit);\n\n\terror = input_ff_create_memless(dev, NULL, hid_lg3ff_play);\n\tif (error)\n\t\treturn error;\n\n\tif (test_bit(FF_AUTOCENTER, dev->ffbit))\n\t\tdev->ff->set_autocenter = hid_lg3ff_set_autocenter;\n\n\thid_info(hid, \"Force feedback for Logitech Flight System G940 by Gary Stein <LordCnidarian@gmail.com>\\n\");\n\treturn 0;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}