{
  "module_name": "hid-picolcd_lcd.c",
  "hash_id": "5408f9ced77da225f94b0cae3d1e98285d664b542259f92ac5f039d491a6ff5a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-picolcd_lcd.c",
  "human_readable_source": "\n \n\n#include <linux/hid.h>\n\n#include <linux/fb.h>\n#include <linux/lcd.h>\n\n#include \"hid-picolcd.h\"\n\n \nstatic int picolcd_get_contrast(struct lcd_device *ldev)\n{\n\tstruct picolcd_data *data = lcd_get_data(ldev);\n\treturn data->lcd_contrast;\n}\n\nstatic int picolcd_set_contrast(struct lcd_device *ldev, int contrast)\n{\n\tstruct picolcd_data *data = lcd_get_data(ldev);\n\tstruct hid_report *report = picolcd_out_report(REPORT_CONTRAST, data->hdev);\n\tunsigned long flags;\n\n\tif (!report || report->maxfield != 1 || report->field[0]->report_count != 1)\n\t\treturn -ENODEV;\n\n\tdata->lcd_contrast = contrast & 0x0ff;\n\tspin_lock_irqsave(&data->lock, flags);\n\thid_set_field(report->field[0], 0, data->lcd_contrast);\n\tif (!(data->status & PICOLCD_FAILED))\n\t\thid_hw_request(data->hdev, report, HID_REQ_SET_REPORT);\n\tspin_unlock_irqrestore(&data->lock, flags);\n\treturn 0;\n}\n\nstatic int picolcd_check_lcd_fb(struct lcd_device *ldev, struct fb_info *fb)\n{\n\treturn fb && fb == picolcd_fbinfo((struct picolcd_data *)lcd_get_data(ldev));\n}\n\nstatic struct lcd_ops picolcd_lcdops = {\n\t.get_contrast   = picolcd_get_contrast,\n\t.set_contrast   = picolcd_set_contrast,\n\t.check_fb       = picolcd_check_lcd_fb,\n};\n\nint picolcd_init_lcd(struct picolcd_data *data, struct hid_report *report)\n{\n\tstruct device *dev = &data->hdev->dev;\n\tstruct lcd_device *ldev;\n\n\tif (!report)\n\t\treturn -ENODEV;\n\tif (report->maxfield != 1 || report->field[0]->report_count != 1 ||\n\t\t\treport->field[0]->report_size != 8) {\n\t\tdev_err(dev, \"unsupported CONTRAST report\");\n\t\treturn -EINVAL;\n\t}\n\n\tldev = lcd_device_register(dev_name(dev), dev, data, &picolcd_lcdops);\n\tif (IS_ERR(ldev)) {\n\t\tdev_err(dev, \"failed to register LCD\\n\");\n\t\treturn PTR_ERR(ldev);\n\t}\n\tldev->props.max_contrast = 0x0ff;\n\tdata->lcd_contrast = 0xe5;\n\tdata->lcd = ldev;\n\tpicolcd_set_contrast(ldev, 0xe5);\n\treturn 0;\n}\n\nvoid picolcd_exit_lcd(struct picolcd_data *data)\n{\n\tstruct lcd_device *ldev = data->lcd;\n\n\tdata->lcd = NULL;\n\tlcd_device_unregister(ldev);\n}\n\nint picolcd_resume_lcd(struct picolcd_data *data)\n{\n\tif (!data->lcd)\n\t\treturn 0;\n\treturn picolcd_set_contrast(data->lcd, data->lcd_contrast);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}