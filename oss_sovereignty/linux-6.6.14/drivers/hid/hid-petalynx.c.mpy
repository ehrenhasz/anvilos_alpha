{
  "module_name": "hid-petalynx.c",
  "hash_id": "dc6a3e9ecaf4c53a19e769623d3f9d8c741b25f15189c6df363abafd3c6fa03f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-petalynx.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/device.h>\n#include <linux/hid.h>\n#include <linux/module.h>\n\n#include \"hid-ids.h\"\n\n \nstatic __u8 *pl_report_fixup(struct hid_device *hdev, __u8 *rdesc,\n\t\tunsigned int *rsize)\n{\n\tif (*rsize >= 62 && rdesc[39] == 0x2a && rdesc[40] == 0xf5 &&\n\t\t\trdesc[41] == 0x00 && rdesc[59] == 0x26 &&\n\t\t\trdesc[60] == 0xf9 && rdesc[61] == 0x00) {\n\t\thid_info(hdev, \"fixing up Petalynx Maxter Remote report descriptor\\n\");\n\t\trdesc[60] = 0xfa;\n\t\trdesc[40] = 0xfa;\n\t}\n\treturn rdesc;\n}\n\n#define pl_map_key_clear(c)\thid_map_usage_clear(hi, usage, bit, max, \\\n\t\t\t\t\tEV_KEY, (c))\nstatic int pl_input_mapping(struct hid_device *hdev, struct hid_input *hi,\n\t\tstruct hid_field *field, struct hid_usage *usage,\n\t\tunsigned long **bit, int *max)\n{\n\tif ((usage->hid & HID_USAGE_PAGE) == HID_UP_LOGIVENDOR) {\n\t\tswitch (usage->hid & HID_USAGE) {\n\t\tcase 0x05a: pl_map_key_clear(KEY_TEXT);\t\tbreak;\n\t\tcase 0x05b: pl_map_key_clear(KEY_RED);\t\tbreak;\n\t\tcase 0x05c: pl_map_key_clear(KEY_GREEN);\tbreak;\n\t\tcase 0x05d: pl_map_key_clear(KEY_YELLOW);\tbreak;\n\t\tcase 0x05e: pl_map_key_clear(KEY_BLUE);\t\tbreak;\n\t\tdefault:\n\t\t\treturn 0;\n\t\t}\n\t\treturn 1;\n\t}\n\n\tif ((usage->hid & HID_USAGE_PAGE) == HID_UP_CONSUMER) {\n\t\tswitch (usage->hid & HID_USAGE) {\n\t\tcase 0x0f6: pl_map_key_clear(KEY_NEXT);\t\tbreak;\n\t\tcase 0x0fa: pl_map_key_clear(KEY_BACK);\t\tbreak;\n\t\tdefault:\n\t\t\treturn 0;\n\t\t}\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nstatic int pl_probe(struct hid_device *hdev, const struct hid_device_id *id)\n{\n\tint ret;\n\n\thdev->quirks |= HID_QUIRK_NOGET;\n\n\tret = hid_parse(hdev);\n\tif (ret) {\n\t\thid_err(hdev, \"parse failed\\n\");\n\t\tgoto err_free;\n\t}\n\n\tret = hid_hw_start(hdev, HID_CONNECT_DEFAULT);\n\tif (ret) {\n\t\thid_err(hdev, \"hw start failed\\n\");\n\t\tgoto err_free;\n\t}\n\n\treturn 0;\nerr_free:\n\treturn ret;\n}\n\nstatic const struct hid_device_id pl_devices[] = {\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_PETALYNX, USB_DEVICE_ID_PETALYNX_MAXTER_REMOTE) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, pl_devices);\n\nstatic struct hid_driver pl_driver = {\n\t.name = \"petalynx\",\n\t.id_table = pl_devices,\n\t.report_fixup = pl_report_fixup,\n\t.input_mapping = pl_input_mapping,\n\t.probe = pl_probe,\n};\nmodule_hid_driver(pl_driver);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}