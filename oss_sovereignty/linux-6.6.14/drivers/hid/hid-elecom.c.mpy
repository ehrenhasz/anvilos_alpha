{
  "module_name": "hid-elecom.c",
  "hash_id": "96845b890a4805df97536e93e52d762d844f73a4ec9e8d3937bde5a4a975f1d9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-elecom.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/device.h>\n#include <linux/hid.h>\n#include <linux/module.h>\n\n#include \"hid-ids.h\"\n\n \n#define MOUSE_BUTTONS_MAX 8\nstatic void mouse_button_fixup(struct hid_device *hdev,\n\t\t\t       __u8 *rdesc, unsigned int rsize,\n\t\t\t       unsigned int button_bit_count,\n\t\t\t       unsigned int padding_bit,\n\t\t\t       unsigned int button_report_size,\n\t\t\t       unsigned int button_usage_maximum,\n\t\t\t       int nbuttons)\n{\n\tif (rsize < 32 || rdesc[button_bit_count] != 0x95 ||\n\t    rdesc[button_report_size] != 0x75 ||\n\t    rdesc[button_report_size + 1] != 0x01 ||\n\t    rdesc[button_usage_maximum] != 0x29 || rdesc[padding_bit] != 0x75)\n\t\treturn;\n\thid_info(hdev, \"Fixing up Elecom mouse button count\\n\");\n\tnbuttons = clamp(nbuttons, 0, MOUSE_BUTTONS_MAX);\n\trdesc[button_bit_count + 1] = nbuttons;\n\trdesc[button_usage_maximum + 1] = nbuttons;\n\trdesc[padding_bit + 1] = MOUSE_BUTTONS_MAX - nbuttons;\n}\n\nstatic __u8 *elecom_report_fixup(struct hid_device *hdev, __u8 *rdesc,\n\t\tunsigned int *rsize)\n{\n\tswitch (hdev->product) {\n\tcase USB_DEVICE_ID_ELECOM_BM084:\n\t\t \n\t\tif (*rsize >= 48 && rdesc[46] == 0x05 && rdesc[47] == 0x0c) {\n\t\t\thid_info(hdev, \"Fixing up Elecom BM084 report descriptor\\n\");\n\t\t\trdesc[47] = 0x00;\n\t\t}\n\t\tbreak;\n\tcase USB_DEVICE_ID_ELECOM_M_XGL20DLBK:\n\t\t \n\t\tmouse_button_fixup(hdev, rdesc, *rsize, 20, 28, 22, 14, 8);\n\t\tbreak;\n\tcase USB_DEVICE_ID_ELECOM_M_XT3URBK:\n\tcase USB_DEVICE_ID_ELECOM_M_XT3DRBK:\n\tcase USB_DEVICE_ID_ELECOM_M_XT4DRBK:\n\t\t \n\t\tmouse_button_fixup(hdev, rdesc, *rsize, 12, 30, 14, 20, 6);\n\t\tbreak;\n\tcase USB_DEVICE_ID_ELECOM_M_DT1URBK:\n\tcase USB_DEVICE_ID_ELECOM_M_DT1DRBK:\n\tcase USB_DEVICE_ID_ELECOM_M_HT1URBK:\n\tcase USB_DEVICE_ID_ELECOM_M_HT1DRBK_010D:\n\t\t \n\t\tmouse_button_fixup(hdev, rdesc, *rsize, 12, 30, 14, 20, 8);\n\t\tbreak;\n\tcase USB_DEVICE_ID_ELECOM_M_HT1DRBK_011C:\n\t\t \n\t\tmouse_button_fixup(hdev, rdesc, *rsize, 22, 30, 24, 16, 8);\n\t\tbreak;\n\t}\n\treturn rdesc;\n}\n\nstatic const struct hid_device_id elecom_devices[] = {\n\t{ HID_BLUETOOTH_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_BM084) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_XGL20DLBK) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_XT3URBK) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_XT3DRBK) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_XT4DRBK) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_DT1URBK) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_DT1DRBK) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_HT1URBK) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_HT1DRBK_010D) },\n\t{ HID_USB_DEVICE(USB_VENDOR_ID_ELECOM, USB_DEVICE_ID_ELECOM_M_HT1DRBK_011C) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(hid, elecom_devices);\n\nstatic struct hid_driver elecom_driver = {\n\t.name = \"elecom\",\n\t.id_table = elecom_devices,\n\t.report_fixup = elecom_report_fixup\n};\nmodule_hid_driver(elecom_driver);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}