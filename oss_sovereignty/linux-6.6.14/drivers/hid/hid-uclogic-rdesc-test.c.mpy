{
  "module_name": "hid-uclogic-rdesc-test.c",
  "hash_id": "2a2b3b35f15396acf78079cb0cc08e4ae9cd785bb20040e4c9bba9a0d1b2af96",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hid/hid-uclogic-rdesc-test.c",
  "human_readable_source": "\n\n \n\n#include <kunit/test.h>\n#include \"./hid-uclogic-rdesc.h\"\n\nstruct uclogic_template_case {\n\tconst char *name;\n\tconst __u8 *template;\n\tsize_t template_size;\n\tconst s32 *param_list;\n\tsize_t param_num;\n\tconst __u8 *expected;\n};\n\nstatic const s32 params_pen_all[UCLOGIC_RDESC_PH_ID_NUM] = {\n\t[UCLOGIC_RDESC_PEN_PH_ID_X_LM] = 0xAA,\n\t[UCLOGIC_RDESC_PEN_PH_ID_X_PM] = 0xBB,\n\t[UCLOGIC_RDESC_PEN_PH_ID_Y_LM] = 0xCC,\n\t[UCLOGIC_RDESC_PEN_PH_ID_Y_PM] = 0xDD,\n\t[UCLOGIC_RDESC_PEN_PH_ID_PRESSURE_LM] = 0xEE,\n};\n\nstatic const s32 params_pen_some[] = {\n\t[UCLOGIC_RDESC_PEN_PH_ID_X_LM] = 0xAA,\n\t[UCLOGIC_RDESC_PEN_PH_ID_X_PM] = 0xBB,\n};\n\nstatic const s32 params_frame_all[UCLOGIC_RDESC_PH_ID_NUM] = {\n\t[UCLOGIC_RDESC_FRAME_PH_ID_UM] = 0xFF,\n};\n\nstatic const __u8 template_empty[] = { };\nstatic const __u8 template_small[] = { 0x00 };\nstatic const __u8 template_no_ph[] = { 0xAA, 0xFE, 0xAA, 0xED, 0x1D };\n\nstatic const __u8 template_pen_ph_end[] = {\n\t0xAA, 0xBB, UCLOGIC_RDESC_PEN_PH_HEAD\n};\n\nstatic const __u8 template_btn_ph_end[] = {\n\t0xAA, 0xBB, UCLOGIC_RDESC_FRAME_PH_BTN_HEAD\n};\n\nstatic const __u8 template_pen_all_params[] = {\n\tUCLOGIC_RDESC_PEN_PH(X_LM),\n\t0x47, UCLOGIC_RDESC_PEN_PH(X_PM),\n\t0x27, UCLOGIC_RDESC_PEN_PH(Y_LM),\n\tUCLOGIC_RDESC_PEN_PH(Y_PM),\n\t0x00, UCLOGIC_RDESC_PEN_PH(PRESSURE_LM),\n};\n\nstatic const __u8 expected_pen_all_params[] = {\n\t0xAA, 0x00, 0x00, 0x00,\n\t0x47, 0xBB, 0x00, 0x00, 0x00,\n\t0x27, 0xCC, 0x00, 0x00, 0x00,\n\t0xDD, 0x00, 0x00, 0x00,\n\t0x00, 0xEE, 0x00, 0x00, 0x00,\n};\n\nstatic const __u8 template_frame_all_params[] = {\n\t0x01, 0x02,\n\tUCLOGIC_RDESC_FRAME_PH_BTN,\n\t0x99,\n};\n\nstatic const __u8 expected_frame_all_params[] = {\n\t0x01, 0x02,\n\t0x2A, 0xFF, 0x00,\n\t0x99,\n};\n\nstatic const __u8 template_pen_some_params[] = {\n\t0x01, 0x02,\n\tUCLOGIC_RDESC_PEN_PH(X_LM),\n\t0x03, UCLOGIC_RDESC_PEN_PH(X_PM),\n\t0x04, 0x05,\n};\n\nstatic const __u8 expected_pen_some_params[] = {\n\t0x01, 0x02,\n\t0xAA, 0x00, 0x00, 0x00,\n\t0x03, 0xBB, 0x00, 0x00, 0x00,\n\t0x04, 0x05,\n};\n\nstatic const __u8 template_params_none[] = {\n\t0x27, UCLOGIC_RDESC_PEN_PH(Y_LM),\n\tUCLOGIC_RDESC_PEN_PH(Y_PM),\n\t0x00, UCLOGIC_RDESC_PEN_PH(PRESSURE_LM),\n};\n\nstatic struct uclogic_template_case uclogic_template_cases[] = {\n\t{\n\t\t.name = \"empty_template\",\n\t\t.template = template_empty,\n\t\t.template_size = sizeof(template_empty),\n\t\t.param_list = params_pen_all,\n\t\t.param_num = ARRAY_SIZE(params_pen_all),\n\t\t.expected = template_empty,\n\t},\n\t{\n\t\t.name = \"template_smaller_than_the_placeholder\",\n\t\t.template = template_small,\n\t\t.template_size = sizeof(template_small),\n\t\t.param_list = params_pen_all,\n\t\t.param_num = ARRAY_SIZE(params_pen_all),\n\t\t.expected = template_small,\n\t},\n\t{\n\t\t.name = \"no_placeholder\",\n\t\t.template = template_no_ph,\n\t\t.template_size = sizeof(template_no_ph),\n\t\t.param_list = params_pen_all,\n\t\t.param_num = ARRAY_SIZE(params_pen_all),\n\t\t.expected = template_no_ph,\n\t},\n\t{\n\t\t.name = \"pen_placeholder_at_the_end_without_id\",\n\t\t.template = template_pen_ph_end,\n\t\t.template_size = sizeof(template_pen_ph_end),\n\t\t.param_list = params_pen_all,\n\t\t.param_num = ARRAY_SIZE(params_pen_all),\n\t\t.expected = template_pen_ph_end,\n\t},\n\t{\n\t\t.name = \"frame_button_placeholder_at_the_end_without_id\",\n\t\t.template = template_btn_ph_end,\n\t\t.template_size = sizeof(template_btn_ph_end),\n\t\t.param_list = params_frame_all,\n\t\t.param_num = ARRAY_SIZE(params_frame_all),\n\t\t.expected = template_btn_ph_end,\n\t},\n\t{\n\t\t.name = \"all_params_present_in_the_pen_template\",\n\t\t.template = template_pen_all_params,\n\t\t.template_size = sizeof(template_pen_all_params),\n\t\t.param_list = params_pen_all,\n\t\t.param_num = ARRAY_SIZE(params_pen_all),\n\t\t.expected = expected_pen_all_params,\n\t},\n\t{\n\t\t.name = \"all_params_present_in_the_frame_template\",\n\t\t.template = template_frame_all_params,\n\t\t.template_size = sizeof(template_frame_all_params),\n\t\t.param_list = params_frame_all,\n\t\t.param_num = ARRAY_SIZE(params_frame_all),\n\t\t.expected = expected_frame_all_params,\n\t},\n\t{\n\t\t.name = \"some_params_present_in_the_pen_template_with_complete_param_list\",\n\t\t.template = template_pen_some_params,\n\t\t.template_size = sizeof(template_pen_some_params),\n\t\t.param_list = params_pen_all,\n\t\t.param_num = ARRAY_SIZE(params_pen_all),\n\t\t.expected = expected_pen_some_params,\n\t},\n\t{\n\t\t.name = \"some_params_present_in_the_pen_template_with_incomplete_param_list\",\n\t\t.template = template_pen_some_params,\n\t\t.template_size = sizeof(template_pen_some_params),\n\t\t.param_list = params_pen_some,\n\t\t.param_num = ARRAY_SIZE(params_pen_some),\n\t\t.expected = expected_pen_some_params,\n\t},\n\t{\n\t\t.name = \"no_params_present_in_the_template\",\n\t\t.template = template_params_none,\n\t\t.template_size = sizeof(template_params_none),\n\t\t.param_list = params_pen_some,\n\t\t.param_num = ARRAY_SIZE(params_pen_some),\n\t\t.expected = template_params_none,\n\t},\n};\n\nstatic void uclogic_template_case_desc(struct uclogic_template_case *t,\n\t\t\t\t       char *desc)\n{\n\tstrscpy(desc, t->name, KUNIT_PARAM_DESC_SIZE);\n}\n\nKUNIT_ARRAY_PARAM(uclogic_template, uclogic_template_cases,\n\t\t  uclogic_template_case_desc);\n\nstatic void hid_test_uclogic_template(struct kunit *test)\n{\n\t__u8 *res;\n\tconst struct uclogic_template_case *params = test->param_value;\n\n\tres = uclogic_rdesc_template_apply(params->template,\n\t\t\t\t\t   params->template_size,\n\t\t\t\t\t   params->param_list,\n\t\t\t\t\t   params->param_num);\n\tKUNIT_ASSERT_NOT_ERR_OR_NULL(test, res);\n\tKUNIT_EXPECT_MEMEQ(test, res, params->expected, params->template_size);\n\tkfree(res);\n}\n\nstatic struct kunit_case hid_uclogic_rdesc_test_cases[] = {\n\tKUNIT_CASE_PARAM(hid_test_uclogic_template, uclogic_template_gen_params),\n\t{}\n};\n\nstatic struct kunit_suite hid_uclogic_rdesc_test_suite = {\n\t.name = \"hid_uclogic_rdesc_test\",\n\t.test_cases = hid_uclogic_rdesc_test_cases,\n};\n\nkunit_test_suite(hid_uclogic_rdesc_test_suite);\n\nMODULE_DESCRIPTION(\"KUnit tests for the UC-Logic driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Jos\u00e9 Exp\u00f3sito <jose.exposito89@gmail.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}