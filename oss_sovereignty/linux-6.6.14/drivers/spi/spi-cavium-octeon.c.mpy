{
  "module_name": "spi-cavium-octeon.c",
  "hash_id": "c46c5f524d4a372b9dff9ba1ec6ab171fa2242928a0a0accce92ee7a324d08eb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/spi/spi-cavium-octeon.c",
  "human_readable_source": " \n\n#include <linux/platform_device.h>\n#include <linux/spi/spi.h>\n#include <linux/module.h>\n#include <linux/io.h>\n#include <linux/of.h>\n\n#include <asm/octeon/octeon.h>\n\n#include \"spi-cavium.h\"\n\nstatic int octeon_spi_probe(struct platform_device *pdev)\n{\n\tvoid __iomem *reg_base;\n\tstruct spi_controller *host;\n\tstruct octeon_spi *p;\n\tint err = -ENOENT;\n\n\thost = spi_alloc_host(&pdev->dev, sizeof(struct octeon_spi));\n\tif (!host)\n\t\treturn -ENOMEM;\n\tp = spi_controller_get_devdata(host);\n\tplatform_set_drvdata(pdev, host);\n\n\treg_base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg_base)) {\n\t\terr = PTR_ERR(reg_base);\n\t\tgoto fail;\n\t}\n\n\tp->register_base = reg_base;\n\tp->sys_freq = octeon_get_io_clock_rate();\n\n\tp->regs.config = 0;\n\tp->regs.status = 0x08;\n\tp->regs.tx = 0x10;\n\tp->regs.data = 0x80;\n\n\thost->num_chipselect = 4;\n\thost->mode_bits = SPI_CPHA |\n\t\t\t    SPI_CPOL |\n\t\t\t    SPI_CS_HIGH |\n\t\t\t    SPI_LSB_FIRST |\n\t\t\t    SPI_3WIRE;\n\n\thost->transfer_one_message = octeon_spi_transfer_one_message;\n\thost->bits_per_word_mask = SPI_BPW_MASK(8);\n\thost->max_speed_hz = OCTEON_SPI_MAX_CLOCK_HZ;\n\n\thost->dev.of_node = pdev->dev.of_node;\n\terr = devm_spi_register_controller(&pdev->dev, host);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"register host failed: %d\\n\", err);\n\t\tgoto fail;\n\t}\n\n\tdev_info(&pdev->dev, \"OCTEON SPI bus driver\\n\");\n\n\treturn 0;\nfail:\n\tspi_controller_put(host);\n\treturn err;\n}\n\nstatic void octeon_spi_remove(struct platform_device *pdev)\n{\n\tstruct spi_controller *host = platform_get_drvdata(pdev);\n\tstruct octeon_spi *p = spi_controller_get_devdata(host);\n\n\t \n\twriteq(0, p->register_base + OCTEON_SPI_CFG(p));\n}\n\nstatic const struct of_device_id octeon_spi_match[] = {\n\t{ .compatible = \"cavium,octeon-3010-spi\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, octeon_spi_match);\n\nstatic struct platform_driver octeon_spi_driver = {\n\t.driver = {\n\t\t.name\t\t= \"spi-octeon\",\n\t\t.of_match_table = octeon_spi_match,\n\t},\n\t.probe\t\t= octeon_spi_probe,\n\t.remove_new\t= octeon_spi_remove,\n};\n\nmodule_platform_driver(octeon_spi_driver);\n\nMODULE_DESCRIPTION(\"Cavium, Inc. OCTEON SPI bus driver\");\nMODULE_AUTHOR(\"David Daney\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}