{
  "module_name": "spi-dw.h",
  "hash_id": "2ca70f4f652be3f940dbfb1f6ed8ffe5565b75c9fd9e9a0d3709b854642abe82",
  "original_prompt": "Ingested from linux-6.6.14/drivers/spi/spi-dw.h",
  "human_readable_source": " \n#ifndef __SPI_DW_H__\n#define __SPI_DW_H__\n\n#include <linux/bits.h>\n#include <linux/completion.h>\n#include <linux/debugfs.h>\n#include <linux/irqreturn.h>\n#include <linux/io.h>\n#include <linux/scatterlist.h>\n#include <linux/spi/spi-mem.h>\n#include <linux/bitfield.h>\n\n \n#define DW_PSSI_ID\t\t\t0\n#define DW_HSSI_ID\t\t\t1\n\n \n#define DW_HSSI_102A\t\t\t0x3130322a\n\n \n#define dw_spi_ip_is(_dws, _ip) \\\n\t((_dws)->ip == DW_ ## _ip ## _ID)\n\n#define __dw_spi_ver_cmp(_dws, _ip, _ver, _op) \\\n\t(dw_spi_ip_is(_dws, _ip) && (_dws)->ver _op DW_ ## _ip ## _ ## _ver)\n\n#define dw_spi_ver_is(_dws, _ip, _ver) __dw_spi_ver_cmp(_dws, _ip, _ver, ==)\n\n#define dw_spi_ver_is_ge(_dws, _ip, _ver) __dw_spi_ver_cmp(_dws, _ip, _ver, >=)\n\n \n#define DW_SPI_CAP_CS_OVERRIDE\t\tBIT(0)\n#define DW_SPI_CAP_DFS32\t\tBIT(1)\n\n \n#define DW_SPI_CTRLR0\t\t\t0x00\n#define DW_SPI_CTRLR1\t\t\t0x04\n#define DW_SPI_SSIENR\t\t\t0x08\n#define DW_SPI_MWCR\t\t\t0x0c\n#define DW_SPI_SER\t\t\t0x10\n#define DW_SPI_BAUDR\t\t\t0x14\n#define DW_SPI_TXFTLR\t\t\t0x18\n#define DW_SPI_RXFTLR\t\t\t0x1c\n#define DW_SPI_TXFLR\t\t\t0x20\n#define DW_SPI_RXFLR\t\t\t0x24\n#define DW_SPI_SR\t\t\t0x28\n#define DW_SPI_IMR\t\t\t0x2c\n#define DW_SPI_ISR\t\t\t0x30\n#define DW_SPI_RISR\t\t\t0x34\n#define DW_SPI_TXOICR\t\t\t0x38\n#define DW_SPI_RXOICR\t\t\t0x3c\n#define DW_SPI_RXUICR\t\t\t0x40\n#define DW_SPI_MSTICR\t\t\t0x44\n#define DW_SPI_ICR\t\t\t0x48\n#define DW_SPI_DMACR\t\t\t0x4c\n#define DW_SPI_DMATDLR\t\t\t0x50\n#define DW_SPI_DMARDLR\t\t\t0x54\n#define DW_SPI_IDR\t\t\t0x58\n#define DW_SPI_VERSION\t\t\t0x5c\n#define DW_SPI_DR\t\t\t0x60\n#define DW_SPI_RX_SAMPLE_DLY\t\t0xf0\n#define DW_SPI_CS_OVERRIDE\t\t0xf4\n\n \n#define DW_PSSI_CTRLR0_DFS_MASK\t\t\tGENMASK(3, 0)\n#define DW_PSSI_CTRLR0_DFS32_MASK\t\tGENMASK(20, 16)\n\n#define DW_PSSI_CTRLR0_FRF_MASK\t\t\tGENMASK(5, 4)\n#define DW_SPI_CTRLR0_FRF_MOTO_SPI\t\t0x0\n#define DW_SPI_CTRLR0_FRF_TI_SSP\t\t0x1\n#define DW_SPI_CTRLR0_FRF_NS_MICROWIRE\t\t0x2\n#define DW_SPI_CTRLR0_FRF_RESV\t\t\t0x3\n\n#define DW_PSSI_CTRLR0_MODE_MASK\t\tGENMASK(7, 6)\n#define DW_PSSI_CTRLR0_SCPHA\t\t\tBIT(6)\n#define DW_PSSI_CTRLR0_SCPOL\t\t\tBIT(7)\n\n#define DW_PSSI_CTRLR0_TMOD_MASK\t\tGENMASK(9, 8)\n#define DW_SPI_CTRLR0_TMOD_TR\t\t\t0x0\t \n#define DW_SPI_CTRLR0_TMOD_TO\t\t\t0x1\t \n#define DW_SPI_CTRLR0_TMOD_RO\t\t\t0x2\t \n#define DW_SPI_CTRLR0_TMOD_EPROMREAD\t\t0x3\t \n\n#define DW_PSSI_CTRLR0_SLV_OE\t\t\tBIT(10)\n#define DW_PSSI_CTRLR0_SRL\t\t\tBIT(11)\n#define DW_PSSI_CTRLR0_CFS\t\t\tBIT(12)\n\n \n#define DW_HSSI_CTRLR0_DFS_MASK\t\t\tGENMASK(4, 0)\n#define DW_HSSI_CTRLR0_FRF_MASK\t\t\tGENMASK(7, 6)\n#define DW_HSSI_CTRLR0_SCPHA\t\t\tBIT(8)\n#define DW_HSSI_CTRLR0_SCPOL\t\t\tBIT(9)\n#define DW_HSSI_CTRLR0_TMOD_MASK\t\tGENMASK(11, 10)\n#define DW_HSSI_CTRLR0_SRL\t\t\tBIT(13)\n#define DW_HSSI_CTRLR0_MST\t\t\tBIT(31)\n\n \n#define DW_SPI_NDF_MASK\t\t\t\tGENMASK(15, 0)\n\n \n#define DW_SPI_SR_MASK\t\t\t\tGENMASK(6, 0)\n#define DW_SPI_SR_BUSY\t\t\t\tBIT(0)\n#define DW_SPI_SR_TF_NOT_FULL\t\t\tBIT(1)\n#define DW_SPI_SR_TF_EMPT\t\t\tBIT(2)\n#define DW_SPI_SR_RF_NOT_EMPT\t\t\tBIT(3)\n#define DW_SPI_SR_RF_FULL\t\t\tBIT(4)\n#define DW_SPI_SR_TX_ERR\t\t\tBIT(5)\n#define DW_SPI_SR_DCOL\t\t\t\tBIT(6)\n\n \n#define DW_SPI_INT_MASK\t\t\t\tGENMASK(5, 0)\n#define DW_SPI_INT_TXEI\t\t\t\tBIT(0)\n#define DW_SPI_INT_TXOI\t\t\t\tBIT(1)\n#define DW_SPI_INT_RXUI\t\t\t\tBIT(2)\n#define DW_SPI_INT_RXOI\t\t\t\tBIT(3)\n#define DW_SPI_INT_RXFI\t\t\t\tBIT(4)\n#define DW_SPI_INT_MSTI\t\t\t\tBIT(5)\n\n \n#define DW_SPI_DMACR_RDMAE\t\t\tBIT(0)\n#define DW_SPI_DMACR_TDMAE\t\t\tBIT(1)\n\n \n#define DW_SPI_WAIT_RETRIES\t\t\t5\n#define DW_SPI_BUF_SIZE \\\n\t(sizeof_field(struct spi_mem_op, cmd.opcode) + \\\n\t sizeof_field(struct spi_mem_op, addr.val) + 256)\n#define DW_SPI_GET_BYTE(_val, _idx) \\\n\t((_val) >> (BITS_PER_BYTE * (_idx)) & 0xff)\n\n \nstruct dw_spi_cfg {\n\tu8 tmode;\n\tu8 dfs;\n\tu32 ndf;\n\tu32 freq;\n};\n\nstruct dw_spi;\nstruct dw_spi_dma_ops {\n\tint (*dma_init)(struct device *dev, struct dw_spi *dws);\n\tvoid (*dma_exit)(struct dw_spi *dws);\n\tint (*dma_setup)(struct dw_spi *dws, struct spi_transfer *xfer);\n\tbool (*can_dma)(struct spi_controller *host, struct spi_device *spi,\n\t\t\tstruct spi_transfer *xfer);\n\tint (*dma_transfer)(struct dw_spi *dws, struct spi_transfer *xfer);\n\tvoid (*dma_stop)(struct dw_spi *dws);\n};\n\nstruct dw_spi {\n\tstruct spi_controller\t*host;\n\n\tu32\t\t\tip;\t\t \n\tu32\t\t\tver;\t\t \n\tu32\t\t\tcaps;\t\t \n\n\tvoid __iomem\t\t*regs;\n\tunsigned long\t\tpaddr;\n\tint\t\t\tirq;\n\tu32\t\t\tfifo_len;\t \n\tunsigned int\t\tdfs_offset;      \n\tu32\t\t\tmax_mem_freq;\t \n\tu32\t\t\tmax_freq;\t \n\n\tu32\t\t\treg_io_width;\t \n\tu16\t\t\tbus_num;\n\tu16\t\t\tnum_cs;\t\t \n\tvoid (*set_cs)(struct spi_device *spi, bool enable);\n\n\t \n\tvoid\t\t\t*tx;\n\tunsigned int\t\ttx_len;\n\tvoid\t\t\t*rx;\n\tunsigned int\t\trx_len;\n\tu8\t\t\tbuf[DW_SPI_BUF_SIZE];\n\tint\t\t\tdma_mapped;\n\tu8\t\t\tn_bytes;\t \n\tirqreturn_t\t\t(*transfer_handler)(struct dw_spi *dws);\n\tu32\t\t\tcurrent_freq;\t \n\tu32\t\t\tcur_rx_sample_dly;\n\tu32\t\t\tdef_rx_sample_dly_ns;\n\n\t \n\tstruct spi_controller_mem_ops mem_ops;\n\n\t \n\tstruct dma_chan\t\t*txchan;\n\tu32\t\t\ttxburst;\n\tstruct dma_chan\t\t*rxchan;\n\tu32\t\t\trxburst;\n\tu32\t\t\tdma_sg_burst;\n\tu32\t\t\tdma_addr_widths;\n\tunsigned long\t\tdma_chan_busy;\n\tdma_addr_t\t\tdma_addr;  \n\tconst struct dw_spi_dma_ops *dma_ops;\n\tstruct completion\tdma_completion;\n\n#ifdef CONFIG_DEBUG_FS\n\tstruct dentry *debugfs;\n\tstruct debugfs_regset32 regset;\n#endif\n};\n\nstatic inline u32 dw_readl(struct dw_spi *dws, u32 offset)\n{\n\treturn __raw_readl(dws->regs + offset);\n}\n\nstatic inline void dw_writel(struct dw_spi *dws, u32 offset, u32 val)\n{\n\t__raw_writel(val, dws->regs + offset);\n}\n\nstatic inline u32 dw_read_io_reg(struct dw_spi *dws, u32 offset)\n{\n\tswitch (dws->reg_io_width) {\n\tcase 2:\n\t\treturn readw_relaxed(dws->regs + offset);\n\tcase 4:\n\tdefault:\n\t\treturn readl_relaxed(dws->regs + offset);\n\t}\n}\n\nstatic inline void dw_write_io_reg(struct dw_spi *dws, u32 offset, u32 val)\n{\n\tswitch (dws->reg_io_width) {\n\tcase 2:\n\t\twritew_relaxed(val, dws->regs + offset);\n\t\tbreak;\n\tcase 4:\n\tdefault:\n\t\twritel_relaxed(val, dws->regs + offset);\n\t\tbreak;\n\t}\n}\n\nstatic inline void dw_spi_enable_chip(struct dw_spi *dws, int enable)\n{\n\tdw_writel(dws, DW_SPI_SSIENR, (enable ? 1 : 0));\n}\n\nstatic inline void dw_spi_set_clk(struct dw_spi *dws, u16 div)\n{\n\tdw_writel(dws, DW_SPI_BAUDR, div);\n}\n\n \nstatic inline void dw_spi_mask_intr(struct dw_spi *dws, u32 mask)\n{\n\tu32 new_mask;\n\n\tnew_mask = dw_readl(dws, DW_SPI_IMR) & ~mask;\n\tdw_writel(dws, DW_SPI_IMR, new_mask);\n}\n\n \nstatic inline void dw_spi_umask_intr(struct dw_spi *dws, u32 mask)\n{\n\tu32 new_mask;\n\n\tnew_mask = dw_readl(dws, DW_SPI_IMR) | mask;\n\tdw_writel(dws, DW_SPI_IMR, new_mask);\n}\n\n \nstatic inline void dw_spi_reset_chip(struct dw_spi *dws)\n{\n\tdw_spi_enable_chip(dws, 0);\n\tdw_spi_mask_intr(dws, 0xff);\n\tdw_readl(dws, DW_SPI_ICR);\n\tdw_writel(dws, DW_SPI_SER, 0);\n\tdw_spi_enable_chip(dws, 1);\n}\n\nstatic inline void dw_spi_shutdown_chip(struct dw_spi *dws)\n{\n\tdw_spi_enable_chip(dws, 0);\n\tdw_spi_set_clk(dws, 0);\n}\n\nextern void dw_spi_set_cs(struct spi_device *spi, bool enable);\nextern void dw_spi_update_config(struct dw_spi *dws, struct spi_device *spi,\n\t\t\t\t struct dw_spi_cfg *cfg);\nextern int dw_spi_check_status(struct dw_spi *dws, bool raw);\nextern int dw_spi_add_host(struct device *dev, struct dw_spi *dws);\nextern void dw_spi_remove_host(struct dw_spi *dws);\nextern int dw_spi_suspend_host(struct dw_spi *dws);\nextern int dw_spi_resume_host(struct dw_spi *dws);\n\n#ifdef CONFIG_SPI_DW_DMA\n\nextern void dw_spi_dma_setup_mfld(struct dw_spi *dws);\nextern void dw_spi_dma_setup_generic(struct dw_spi *dws);\n\n#else\n\nstatic inline void dw_spi_dma_setup_mfld(struct dw_spi *dws) {}\nstatic inline void dw_spi_dma_setup_generic(struct dw_spi *dws) {}\n\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}