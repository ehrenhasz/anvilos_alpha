{
  "module_name": "spi-pxa2xx.h",
  "hash_id": "9fe46ca29b1243963febc152304b0bbfdd674ca605bb6c5d383074a378f63bff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/spi/spi-pxa2xx.h",
  "human_readable_source": " \n \n\n#ifndef SPI_PXA2XX_H\n#define SPI_PXA2XX_H\n\n#include <linux/interrupt.h>\n#include <linux/io.h>\n#include <linux/types.h>\n#include <linux/sizes.h>\n\n#include <linux/pxa2xx_ssp.h>\n\nstruct gpio_desc;\nstruct pxa2xx_spi_controller;\nstruct spi_controller;\nstruct spi_device;\nstruct spi_transfer;\n\nstruct driver_data {\n\t \n\tstruct ssp_device *ssp;\n\n\t \n\tenum pxa_ssp_type ssp_type;\n\tstruct spi_controller *controller;\n\n\t \n\tstruct pxa2xx_spi_controller *controller_info;\n\n\t \n\tu32 dma_cr1;\n\tu32 int_cr1;\n\tu32 clear_sr;\n\tu32 mask_sr;\n\n\t \n\tatomic_t dma_running;\n\n\t \n\tvoid *tx;\n\tvoid *tx_end;\n\tvoid *rx;\n\tvoid *rx_end;\n\tu8 n_bytes;\n\tint (*write)(struct driver_data *drv_data);\n\tint (*read)(struct driver_data *drv_data);\n\tirqreturn_t (*transfer_handler)(struct driver_data *drv_data);\n\n\tvoid __iomem *lpss_base;\n\n\t \n\tstruct gpio_desc *gpiod_ready;\n};\n\nstruct chip_data {\n\tu32 cr1;\n\tu32 dds_rate;\n\tu32 timeout;\n\tu8 enable_dma;\n\tu32 dma_burst_size;\n\tu32 dma_threshold;\n\tu32 threshold;\n\tu16 lpss_rx_threshold;\n\tu16 lpss_tx_threshold;\n};\n\nstatic inline u32 pxa2xx_spi_read(const struct driver_data *drv_data, u32 reg)\n{\n\treturn pxa_ssp_read_reg(drv_data->ssp, reg);\n}\n\nstatic inline void pxa2xx_spi_write(const struct driver_data *drv_data, u32 reg, u32 val)\n{\n\tpxa_ssp_write_reg(drv_data->ssp, reg, val);\n}\n\n#define DMA_ALIGNMENT\t\t8\n\nstatic inline int pxa25x_ssp_comp(const struct driver_data *drv_data)\n{\n\tswitch (drv_data->ssp_type) {\n\tcase PXA25x_SSP:\n\tcase CE4100_SSP:\n\tcase QUARK_X1000_SSP:\n\t\treturn 1;\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nstatic inline void clear_SSCR1_bits(const struct driver_data *drv_data, u32 bits)\n{\n\tpxa2xx_spi_write(drv_data, SSCR1, pxa2xx_spi_read(drv_data, SSCR1) & ~bits);\n}\n\nstatic inline u32 read_SSSR_bits(const struct driver_data *drv_data, u32 bits)\n{\n\treturn pxa2xx_spi_read(drv_data, SSSR) & bits;\n}\n\nstatic inline void write_SSSR_CS(const struct driver_data *drv_data, u32 val)\n{\n\tif (drv_data->ssp_type == CE4100_SSP ||\n\t    drv_data->ssp_type == QUARK_X1000_SSP)\n\t\tval |= read_SSSR_bits(drv_data, SSSR_ALT_FRM_MASK);\n\n\tpxa2xx_spi_write(drv_data, SSSR, val);\n}\n\nextern int pxa2xx_spi_flush(struct driver_data *drv_data);\n\n#define MAX_DMA_LEN\t\tSZ_64K\n#define DEFAULT_DMA_CR1\t\t(SSCR1_TSRE | SSCR1_RSRE | SSCR1_TRAIL)\n\nextern irqreturn_t pxa2xx_spi_dma_transfer(struct driver_data *drv_data);\nextern int pxa2xx_spi_dma_prepare(struct driver_data *drv_data,\n\t\t\t\t  struct spi_transfer *xfer);\nextern void pxa2xx_spi_dma_start(struct driver_data *drv_data);\nextern void pxa2xx_spi_dma_stop(struct driver_data *drv_data);\nextern int pxa2xx_spi_dma_setup(struct driver_data *drv_data);\nextern void pxa2xx_spi_dma_release(struct driver_data *drv_data);\nextern int pxa2xx_spi_set_dma_burst_and_threshold(struct chip_data *chip,\n\t\t\t\t\t\t  struct spi_device *spi,\n\t\t\t\t\t\t  u8 bits_per_word,\n\t\t\t\t\t\t  u32 *burst_code,\n\t\t\t\t\t\t  u32 *threshold);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}