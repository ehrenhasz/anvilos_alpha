{
  "module_name": "spi-intel-pci.c",
  "hash_id": "f1667c66d681a2e3489e7f1d47286b93bb4361c15061cbbe99efc0f9e645dc72",
  "original_prompt": "Ingested from linux-6.6.14/drivers/spi/spi-intel-pci.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/pci.h>\n\n#include \"spi-intel.h\"\n\n#define BCR\t\t0xdc\n#define BCR_WPD\t\tBIT(0)\n\nstatic bool intel_spi_pci_set_writeable(void __iomem *base, void *data)\n{\n\tstruct pci_dev *pdev = data;\n\tu32 bcr;\n\n\t \n\tpci_read_config_dword(pdev, BCR, &bcr);\n\tif (!(bcr & BCR_WPD)) {\n\t\tbcr |= BCR_WPD;\n\t\tpci_write_config_dword(pdev, BCR, bcr);\n\t\tpci_read_config_dword(pdev, BCR, &bcr);\n\t}\n\n\treturn bcr & BCR_WPD;\n}\n\nstatic const struct intel_spi_boardinfo bxt_info = {\n\t.type = INTEL_SPI_BXT,\n\t.set_writeable = intel_spi_pci_set_writeable,\n};\n\nstatic const struct intel_spi_boardinfo cnl_info = {\n\t.type = INTEL_SPI_CNL,\n\t.set_writeable = intel_spi_pci_set_writeable,\n};\n\nstatic int intel_spi_pci_probe(struct pci_dev *pdev,\n\t\t\t       const struct pci_device_id *id)\n{\n\tstruct intel_spi_boardinfo *info;\n\tint ret;\n\n\tret = pcim_enable_device(pdev);\n\tif (ret)\n\t\treturn ret;\n\n\tinfo = devm_kmemdup(&pdev->dev, (void *)id->driver_data, sizeof(*info),\n\t\t\t    GFP_KERNEL);\n\tif (!info)\n\t\treturn -ENOMEM;\n\n\tinfo->data = pdev;\n\treturn intel_spi_probe(&pdev->dev, &pdev->resource[0], info);\n}\n\nstatic const struct pci_device_id intel_spi_pci_ids[] = {\n\t{ PCI_VDEVICE(INTEL, 0x02a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x06a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x18e0), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0x19e0), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0x1bca), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0x34a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x38a4), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0x43a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x4b24), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0x4da4), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0x51a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x54a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x5794), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x7a24), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x7aa4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x7e23), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x9d24), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0x9da4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0xa0a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0xa1a4), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0xa224), (unsigned long)&bxt_info },\n\t{ PCI_VDEVICE(INTEL, 0xa2a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0xa324), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0xa3a4), (unsigned long)&cnl_info },\n\t{ PCI_VDEVICE(INTEL, 0xae23), (unsigned long)&cnl_info },\n\t{ },\n};\nMODULE_DEVICE_TABLE(pci, intel_spi_pci_ids);\n\nstatic struct pci_driver intel_spi_pci_driver = {\n\t.name = \"intel-spi\",\n\t.id_table = intel_spi_pci_ids,\n\t.probe = intel_spi_pci_probe,\n};\n\nmodule_pci_driver(intel_spi_pci_driver);\n\nMODULE_DESCRIPTION(\"Intel PCH/PCU SPI flash PCI driver\");\nMODULE_AUTHOR(\"Mika Westerberg <mika.westerberg@linux.intel.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}