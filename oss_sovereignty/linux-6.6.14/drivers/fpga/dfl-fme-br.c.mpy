{
  "module_name": "dfl-fme-br.c",
  "hash_id": "4f82b4c962f5361283456a0006b35617eb1abe0593464323eaf85b44e73314ff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/fpga/dfl-fme-br.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/fpga/fpga-bridge.h>\n\n#include \"dfl.h\"\n#include \"dfl-fme-pr.h\"\n\nstruct fme_br_priv {\n\tstruct dfl_fme_br_pdata *pdata;\n\tstruct dfl_fpga_port_ops *port_ops;\n\tstruct platform_device *port_pdev;\n};\n\nstatic int fme_bridge_enable_set(struct fpga_bridge *bridge, bool enable)\n{\n\tstruct fme_br_priv *priv = bridge->priv;\n\tstruct platform_device *port_pdev;\n\tstruct dfl_fpga_port_ops *ops;\n\n\tif (!priv->port_pdev) {\n\t\tport_pdev = dfl_fpga_cdev_find_port(priv->pdata->cdev,\n\t\t\t\t\t\t    &priv->pdata->port_id,\n\t\t\t\t\t\t    dfl_fpga_check_port_id);\n\t\tif (!port_pdev)\n\t\t\treturn -ENODEV;\n\n\t\tpriv->port_pdev = port_pdev;\n\t}\n\n\tif (priv->port_pdev && !priv->port_ops) {\n\t\tops = dfl_fpga_port_ops_get(priv->port_pdev);\n\t\tif (!ops || !ops->enable_set)\n\t\t\treturn -ENOENT;\n\n\t\tpriv->port_ops = ops;\n\t}\n\n\treturn priv->port_ops->enable_set(priv->port_pdev, enable);\n}\n\nstatic const struct fpga_bridge_ops fme_bridge_ops = {\n\t.enable_set = fme_bridge_enable_set,\n};\n\nstatic int fme_br_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct fme_br_priv *priv;\n\tstruct fpga_bridge *br;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->pdata = dev_get_platdata(dev);\n\n\tbr = fpga_bridge_register(dev, \"DFL FPGA FME Bridge\",\n\t\t\t\t  &fme_bridge_ops, priv);\n\tif (IS_ERR(br))\n\t\treturn PTR_ERR(br);\n\n\tplatform_set_drvdata(pdev, br);\n\n\treturn 0;\n}\n\nstatic int fme_br_remove(struct platform_device *pdev)\n{\n\tstruct fpga_bridge *br = platform_get_drvdata(pdev);\n\tstruct fme_br_priv *priv = br->priv;\n\n\tfpga_bridge_unregister(br);\n\n\tif (priv->port_pdev)\n\t\tput_device(&priv->port_pdev->dev);\n\tif (priv->port_ops)\n\t\tdfl_fpga_port_ops_put(priv->port_ops);\n\n\treturn 0;\n}\n\nstatic struct platform_driver fme_br_driver = {\n\t.driver\t= {\n\t\t.name    = DFL_FPGA_FME_BRIDGE,\n\t},\n\t.probe   = fme_br_probe,\n\t.remove  = fme_br_remove,\n};\n\nmodule_platform_driver(fme_br_driver);\n\nMODULE_DESCRIPTION(\"FPGA Bridge for DFL FPGA Management Engine\");\nMODULE_AUTHOR(\"Intel Corporation\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"platform:dfl-fme-bridge\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}