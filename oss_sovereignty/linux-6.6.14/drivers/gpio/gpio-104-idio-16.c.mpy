{
  "module_name": "gpio-104-idio-16.c",
  "hash_id": "8e73b2cccf719e93bcf1ffdfd5a30f7519986be199bbc4e8399e976373648052",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-104-idio-16.c",
  "human_readable_source": "\n \n#include <linux/bits.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/ioport.h>\n#include <linux/irq.h>\n#include <linux/isa.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/regmap.h>\n#include <linux/types.h>\n\n#include \"gpio-idio-16.h\"\n\n#define IDIO_16_EXTENT 8\n#define MAX_NUM_IDIO_16 max_num_isa_dev(IDIO_16_EXTENT)\n\nstatic unsigned int base[MAX_NUM_IDIO_16];\nstatic unsigned int num_idio_16;\nmodule_param_hw_array(base, uint, ioport, &num_idio_16, 0);\nMODULE_PARM_DESC(base, \"ACCES 104-IDIO-16 base addresses\");\n\nstatic unsigned int irq[MAX_NUM_IDIO_16];\nstatic unsigned int num_irq;\nmodule_param_hw_array(irq, uint, irq, &num_irq, 0);\nMODULE_PARM_DESC(irq, \"ACCES 104-IDIO-16 interrupt line numbers\");\n\nstatic const struct regmap_range idio_16_wr_ranges[] = {\n\tregmap_reg_range(0x0, 0x2), regmap_reg_range(0x4, 0x4),\n};\nstatic const struct regmap_range idio_16_rd_ranges[] = {\n\tregmap_reg_range(0x1, 0x2), regmap_reg_range(0x5, 0x5),\n};\nstatic const struct regmap_range idio_16_precious_ranges[] = {\n\tregmap_reg_range(0x2, 0x2),\n};\nstatic const struct regmap_access_table idio_16_wr_table = {\n\t.yes_ranges = idio_16_wr_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(idio_16_wr_ranges),\n};\nstatic const struct regmap_access_table idio_16_rd_table = {\n\t.yes_ranges = idio_16_rd_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(idio_16_rd_ranges),\n};\nstatic const struct regmap_access_table idio_16_precious_table = {\n\t.yes_ranges = idio_16_precious_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(idio_16_precious_ranges),\n};\nstatic const struct regmap_config idio_16_regmap_config = {\n\t.reg_bits = 8,\n\t.reg_stride = 1,\n\t.val_bits = 8,\n\t.io_port = true,\n\t.wr_table = &idio_16_wr_table,\n\t.rd_table = &idio_16_rd_table,\n\t.volatile_table = &idio_16_rd_table,\n\t.precious_table = &idio_16_precious_table,\n\t.cache_type = REGCACHE_FLAT,\n\t.use_raw_spinlock = true,\n};\n\n \n#define IDIO_16_REGMAP_IRQ(_id)\t\t\t\t\t\t\\\n\t[16 + _id] = {\t\t\t\t\t\t\t\\\n\t\t.mask = BIT(_id),\t\t\t\t\t\\\n\t\t.type = { .types_supported = IRQ_TYPE_EDGE_BOTH },\t\\\n\t}\n\nstatic const struct regmap_irq idio_16_regmap_irqs[] = {\n\tIDIO_16_REGMAP_IRQ(0), IDIO_16_REGMAP_IRQ(1), IDIO_16_REGMAP_IRQ(2),  \n\tIDIO_16_REGMAP_IRQ(3), IDIO_16_REGMAP_IRQ(4), IDIO_16_REGMAP_IRQ(5),  \n\tIDIO_16_REGMAP_IRQ(6), IDIO_16_REGMAP_IRQ(7), IDIO_16_REGMAP_IRQ(8),  \n\tIDIO_16_REGMAP_IRQ(9), IDIO_16_REGMAP_IRQ(10), IDIO_16_REGMAP_IRQ(11),  \n\tIDIO_16_REGMAP_IRQ(12), IDIO_16_REGMAP_IRQ(13), IDIO_16_REGMAP_IRQ(14),  \n\tIDIO_16_REGMAP_IRQ(15),  \n};\n\nstatic int idio_16_probe(struct device *dev, unsigned int id)\n{\n\tconst char *const name = dev_name(dev);\n\tstruct idio_16_regmap_config config = {};\n\tvoid __iomem *regs;\n\tstruct regmap *map;\n\n\tif (!devm_request_region(dev, base[id], IDIO_16_EXTENT, name)) {\n\t\tdev_err(dev, \"Unable to lock port addresses (0x%X-0x%X)\\n\",\n\t\t\tbase[id], base[id] + IDIO_16_EXTENT);\n\t\treturn -EBUSY;\n\t}\n\n\tregs = devm_ioport_map(dev, base[id], IDIO_16_EXTENT);\n\tif (!regs)\n\t\treturn -ENOMEM;\n\n\tmap = devm_regmap_init_mmio(dev, regs, &idio_16_regmap_config);\n\tif (IS_ERR(map))\n\t\treturn dev_err_probe(dev, PTR_ERR(map), \"Unable to initialize register map\\n\");\n\n\tconfig.parent = dev;\n\tconfig.map = map;\n\tconfig.regmap_irqs = idio_16_regmap_irqs;\n\tconfig.num_regmap_irqs = ARRAY_SIZE(idio_16_regmap_irqs);\n\tconfig.irq = irq[id];\n\tconfig.no_status = true;\n\n\treturn devm_idio_16_regmap_register(dev, &config);\n}\n\nstatic struct isa_driver idio_16_driver = {\n\t.probe = idio_16_probe,\n\t.driver = {\n\t\t.name = \"104-idio-16\"\n\t},\n};\n\nmodule_isa_driver_with_irq(idio_16_driver, num_idio_16, num_irq);\n\nMODULE_AUTHOR(\"William Breathitt Gray <vilhelm.gray@gmail.com>\");\nMODULE_DESCRIPTION(\"ACCES 104-IDIO-16 GPIO driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_IMPORT_NS(GPIO_IDIO_16);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}