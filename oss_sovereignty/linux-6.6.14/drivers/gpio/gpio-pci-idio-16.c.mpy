{
  "module_name": "gpio-pci-idio-16.c",
  "hash_id": "e7a882054db4d28f5bd47f459f6a7c5acf345e36796cb4f6c148ab9d191f67f4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-pci-idio-16.c",
  "human_readable_source": "\n \n#include <linux/bits.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/irq.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/regmap.h>\n#include <linux/types.h>\n\n#include \"gpio-idio-16.h\"\n\nstatic const struct regmap_range idio_16_wr_ranges[] = {\n\tregmap_reg_range(0x0, 0x2), regmap_reg_range(0x3, 0x4),\n};\nstatic const struct regmap_range idio_16_rd_ranges[] = {\n\tregmap_reg_range(0x1, 0x2), regmap_reg_range(0x5, 0x6),\n};\nstatic const struct regmap_range idio_16_precious_ranges[] = {\n\tregmap_reg_range(0x2, 0x2),\n};\nstatic const struct regmap_access_table idio_16_wr_table = {\n\t.yes_ranges = idio_16_wr_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(idio_16_wr_ranges),\n};\nstatic const struct regmap_access_table idio_16_rd_table = {\n\t.yes_ranges = idio_16_rd_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(idio_16_rd_ranges),\n};\nstatic const struct regmap_access_table idio_16_precious_table = {\n\t.yes_ranges = idio_16_precious_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(idio_16_precious_ranges),\n};\nstatic const struct regmap_config idio_16_regmap_config = {\n\t.reg_bits = 8,\n\t.reg_stride = 1,\n\t.val_bits = 8,\n\t.io_port = true,\n\t.wr_table = &idio_16_wr_table,\n\t.rd_table = &idio_16_rd_table,\n\t.volatile_table = &idio_16_rd_table,\n\t.precious_table = &idio_16_precious_table,\n\t.cache_type = REGCACHE_FLAT,\n\t.use_raw_spinlock = true,\n};\n\n \n#define IDIO_16_REGMAP_IRQ(_id)\t\t\t\t\t\t\\\n\t[16 + _id] = {\t\t\t\t\t\t\t\\\n\t\t.mask = BIT(2),\t\t\t\t\t\t\\\n\t\t.type = { .types_supported = IRQ_TYPE_EDGE_BOTH },\t\\\n\t}\n\nstatic const struct regmap_irq idio_16_regmap_irqs[] = {\n\tIDIO_16_REGMAP_IRQ(0), IDIO_16_REGMAP_IRQ(1), IDIO_16_REGMAP_IRQ(2),  \n\tIDIO_16_REGMAP_IRQ(3), IDIO_16_REGMAP_IRQ(4), IDIO_16_REGMAP_IRQ(5),  \n\tIDIO_16_REGMAP_IRQ(6), IDIO_16_REGMAP_IRQ(7), IDIO_16_REGMAP_IRQ(8),  \n\tIDIO_16_REGMAP_IRQ(9), IDIO_16_REGMAP_IRQ(10), IDIO_16_REGMAP_IRQ(11),  \n\tIDIO_16_REGMAP_IRQ(12), IDIO_16_REGMAP_IRQ(13), IDIO_16_REGMAP_IRQ(14),  \n\tIDIO_16_REGMAP_IRQ(15),  \n};\n\nstatic int idio_16_probe(struct pci_dev *pdev, const struct pci_device_id *id)\n{\n\tstruct device *const dev = &pdev->dev;\n\tint err;\n\tconst size_t pci_bar_index = 2;\n\tconst char *const name = pci_name(pdev);\n\tstruct idio_16_regmap_config config = {};\n\tvoid __iomem *regs;\n\tstruct regmap *map;\n\n\terr = pcim_enable_device(pdev);\n\tif (err) {\n\t\tdev_err(dev, \"Failed to enable PCI device (%d)\\n\", err);\n\t\treturn err;\n\t}\n\n\terr = pcim_iomap_regions(pdev, BIT(pci_bar_index), name);\n\tif (err) {\n\t\tdev_err(dev, \"Unable to map PCI I/O addresses (%d)\\n\", err);\n\t\treturn err;\n\t}\n\n\tregs = pcim_iomap_table(pdev)[pci_bar_index];\n\n\tmap = devm_regmap_init_mmio(dev, regs, &idio_16_regmap_config);\n\tif (IS_ERR(map))\n\t\treturn dev_err_probe(dev, PTR_ERR(map), \"Unable to initialize register map\\n\");\n\n\tconfig.parent = dev;\n\tconfig.map = map;\n\tconfig.regmap_irqs = idio_16_regmap_irqs;\n\tconfig.num_regmap_irqs = ARRAY_SIZE(idio_16_regmap_irqs);\n\tconfig.irq = pdev->irq;\n\tconfig.filters = true;\n\n\treturn devm_idio_16_regmap_register(dev, &config);\n}\n\nstatic const struct pci_device_id idio_16_pci_dev_id[] = {\n\t{ PCI_DEVICE(0x494F, 0x0DC8) }, { 0 }\n};\nMODULE_DEVICE_TABLE(pci, idio_16_pci_dev_id);\n\nstatic struct pci_driver idio_16_driver = {\n\t.name = \"pci-idio-16\",\n\t.id_table = idio_16_pci_dev_id,\n\t.probe = idio_16_probe\n};\n\nmodule_pci_driver(idio_16_driver);\n\nMODULE_AUTHOR(\"William Breathitt Gray <vilhelm.gray@gmail.com>\");\nMODULE_DESCRIPTION(\"ACCES PCI-IDIO-16 GPIO driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_IMPORT_NS(GPIO_IDIO_16);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}