{
  "module_name": "gpio-ds4520.c",
  "hash_id": "26fa5c362845b0d110a82ec7229298f4a629f2ca1182b2f8e303ae6f4d073491",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-ds4520.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/gpio/driver.h>\n#include <linux/gpio/regmap.h>\n#include <linux/i2c.h>\n#include <linux/property.h>\n#include <linux/regmap.h>\n\n#define DS4520_PULLUP0\t\t0xF0\n#define DS4520_IO_CONTROL0\t0xF2\n#define DS4520_IO_STATUS0\t0xF8\n\nstatic const struct regmap_config ds4520_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n};\n\nstatic int ds4520_gpio_probe(struct i2c_client *client)\n{\n\tstruct gpio_regmap_config config = { };\n\tstruct device *dev = &client->dev;\n\tstruct regmap *regmap;\n\tu32 ngpio;\n\tu32 base;\n\tint ret;\n\n\tret = device_property_read_u32(dev, \"reg\", &base);\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret, \"Missing 'reg' property.\\n\");\n\n\tret = device_property_read_u32(dev, \"ngpios\", &ngpio);\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret, \"Missing 'ngpios' property.\\n\");\n\n\tregmap = devm_regmap_init_i2c(client, &ds4520_regmap_config);\n\tif (IS_ERR(regmap))\n\t\treturn dev_err_probe(dev, PTR_ERR(regmap),\n\t\t\t\t     \"Failed to allocate register map\\n\");\n\n\tconfig.regmap = regmap;\n\tconfig.parent = dev;\n\tconfig.ngpio = ngpio;\n\n\tconfig.reg_dat_base = base + DS4520_IO_STATUS0;\n\tconfig.reg_set_base = base + DS4520_PULLUP0;\n\tconfig.reg_dir_out_base = base + DS4520_IO_CONTROL0;\n\n\treturn PTR_ERR_OR_ZERO(devm_gpio_regmap_register(dev, &config));\n}\n\nstatic const struct of_device_id ds4520_gpio_of_match_table[] = {\n\t{ .compatible = \"adi,ds4520-gpio\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, ds4520_gpio_of_match_table);\n\nstatic const struct i2c_device_id ds4520_gpio_id_table[] = {\n\t{ \"ds4520-gpio\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, ds4520_gpio_id_table);\n\nstatic struct i2c_driver ds4520_gpio_driver = {\n\t.driver = {\n\t\t.name = \"ds4520-gpio\",\n\t\t.of_match_table = ds4520_gpio_of_match_table,\n\t},\n\t.probe = ds4520_gpio_probe,\n\t.id_table = ds4520_gpio_id_table,\n};\nmodule_i2c_driver(ds4520_gpio_driver);\n\nMODULE_DESCRIPTION(\"DS4520 I/O Expander\");\nMODULE_AUTHOR(\"Okan Sahin <okan.sahin@analog.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}