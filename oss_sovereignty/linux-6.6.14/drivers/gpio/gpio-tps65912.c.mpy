{
  "module_name": "gpio-tps65912.c",
  "hash_id": "8d8d5239f11e1a10eccfa05d2c72e60ef44407b88a98e2f6556d60e6bcfe2d37",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-tps65912.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/driver.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <linux/mfd/tps65912.h>\n\nstruct tps65912_gpio {\n\tstruct gpio_chip gpio_chip;\n\tstruct tps65912 *tps;\n};\n\nstatic int tps65912_gpio_get_direction(struct gpio_chip *gc,\n\t\t\t\t       unsigned offset)\n{\n\tstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\n\n\tint ret, val;\n\n\tret = regmap_read(gpio->tps->regmap, TPS65912_GPIO1 + offset, &val);\n\tif (ret)\n\t\treturn ret;\n\n\tif (val & GPIO_CFG_MASK)\n\t\treturn GPIO_LINE_DIRECTION_OUT;\n\telse\n\t\treturn GPIO_LINE_DIRECTION_IN;\n}\n\nstatic int tps65912_gpio_direction_input(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\n\n\treturn regmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\n\t\t\t\t  GPIO_CFG_MASK, 0);\n}\n\nstatic int tps65912_gpio_direction_output(struct gpio_chip *gc,\n\t\t\t\t\t  unsigned offset, int value)\n{\n\tstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\n\n\t \n\tregmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\n\t\t\t   GPIO_SET_MASK, value ? GPIO_SET_MASK : 0);\n\n\treturn regmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\n\t\t\t\t  GPIO_CFG_MASK, GPIO_CFG_MASK);\n}\n\nstatic int tps65912_gpio_get(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\n\tint ret, val;\n\n\tret = regmap_read(gpio->tps->regmap, TPS65912_GPIO1 + offset, &val);\n\tif (ret)\n\t\treturn ret;\n\n\tif (val & GPIO_STS_MASK)\n\t\treturn 1;\n\n\treturn 0;\n}\n\nstatic void tps65912_gpio_set(struct gpio_chip *gc, unsigned offset,\n\t\t\t      int value)\n{\n\tstruct tps65912_gpio *gpio = gpiochip_get_data(gc);\n\n\tregmap_update_bits(gpio->tps->regmap, TPS65912_GPIO1 + offset,\n\t\t\t   GPIO_SET_MASK, value ? GPIO_SET_MASK : 0);\n}\n\nstatic const struct gpio_chip template_chip = {\n\t.label\t\t\t= \"tps65912-gpio\",\n\t.owner\t\t\t= THIS_MODULE,\n\t.get_direction\t\t= tps65912_gpio_get_direction,\n\t.direction_input\t= tps65912_gpio_direction_input,\n\t.direction_output\t= tps65912_gpio_direction_output,\n\t.get\t\t\t= tps65912_gpio_get,\n\t.set\t\t\t= tps65912_gpio_set,\n\t.base\t\t\t= -1,\n\t.ngpio\t\t\t= 5,\n\t.can_sleep\t\t= true,\n};\n\nstatic int tps65912_gpio_probe(struct platform_device *pdev)\n{\n\tstruct tps65912 *tps = dev_get_drvdata(pdev->dev.parent);\n\tstruct tps65912_gpio *gpio;\n\n\tgpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\n\tif (!gpio)\n\t\treturn -ENOMEM;\n\n\tgpio->tps = dev_get_drvdata(pdev->dev.parent);\n\tgpio->gpio_chip = template_chip;\n\tgpio->gpio_chip.parent = tps->dev;\n\n\treturn devm_gpiochip_add_data(&pdev->dev, &gpio->gpio_chip, gpio);\n}\n\nstatic const struct platform_device_id tps65912_gpio_id_table[] = {\n\t{ \"tps65912-gpio\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(platform, tps65912_gpio_id_table);\n\nstatic struct platform_driver tps65912_gpio_driver = {\n\t.driver = {\n\t\t.name = \"tps65912-gpio\",\n\t},\n\t.probe = tps65912_gpio_probe,\n\t.id_table = tps65912_gpio_id_table,\n};\nmodule_platform_driver(tps65912_gpio_driver);\n\nMODULE_AUTHOR(\"Andrew F. Davis <afd@ti.com>\");\nMODULE_DESCRIPTION(\"TPS65912 GPIO driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}