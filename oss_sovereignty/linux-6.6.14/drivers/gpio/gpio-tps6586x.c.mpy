{
  "module_name": "gpio-tps6586x.c",
  "hash_id": "fbaf27961907159fdb71ccf552ec2f4735c0a0b3d297ce1881e16211158998fa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-tps6586x.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/gpio/driver.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/mfd/tps6586x.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n\n \n#define TPS6586X_GPIOSET1\t0x5d\n#define TPS6586X_GPIOSET2\t0x5e\n\nstruct tps6586x_gpio {\n\tstruct gpio_chip gpio_chip;\n\tstruct device *parent;\n};\n\nstatic int tps6586x_gpio_get(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct tps6586x_gpio *tps6586x_gpio = gpiochip_get_data(gc);\n\tuint8_t val;\n\tint ret;\n\n\tret = tps6586x_read(tps6586x_gpio->parent, TPS6586X_GPIOSET2, &val);\n\tif (ret)\n\t\treturn ret;\n\n\treturn !!(val & (1 << offset));\n}\n\nstatic void tps6586x_gpio_set(struct gpio_chip *gc, unsigned offset,\n\t\t\t      int value)\n{\n\tstruct tps6586x_gpio *tps6586x_gpio = gpiochip_get_data(gc);\n\n\ttps6586x_update(tps6586x_gpio->parent, TPS6586X_GPIOSET2,\n\t\t\tvalue << offset, 1 << offset);\n}\n\nstatic int tps6586x_gpio_output(struct gpio_chip *gc, unsigned offset,\n\t\t\t\tint value)\n{\n\tstruct tps6586x_gpio *tps6586x_gpio = gpiochip_get_data(gc);\n\tuint8_t val, mask;\n\n\ttps6586x_gpio_set(gc, offset, value);\n\n\tval = 0x1 << (offset * 2);\n\tmask = 0x3 << (offset * 2);\n\n\treturn tps6586x_update(tps6586x_gpio->parent, TPS6586X_GPIOSET1,\n\t\t\t\tval, mask);\n}\n\nstatic int tps6586x_gpio_to_irq(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct tps6586x_gpio *tps6586x_gpio = gpiochip_get_data(gc);\n\n\treturn tps6586x_irq_get_virq(tps6586x_gpio->parent,\n\t\t\t\tTPS6586X_INT_PLDO_0 + offset);\n}\n\nstatic int tps6586x_gpio_probe(struct platform_device *pdev)\n{\n\tstruct tps6586x_platform_data *pdata;\n\tstruct tps6586x_gpio *tps6586x_gpio;\n\n\tdevice_set_node(&pdev->dev, dev_fwnode(pdev->dev.parent));\n\n\tpdata = dev_get_platdata(pdev->dev.parent);\n\ttps6586x_gpio = devm_kzalloc(&pdev->dev,\n\t\t\t\tsizeof(*tps6586x_gpio), GFP_KERNEL);\n\tif (!tps6586x_gpio)\n\t\treturn -ENOMEM;\n\n\ttps6586x_gpio->parent = pdev->dev.parent;\n\n\ttps6586x_gpio->gpio_chip.owner = THIS_MODULE;\n\ttps6586x_gpio->gpio_chip.label = pdev->name;\n\ttps6586x_gpio->gpio_chip.parent = &pdev->dev;\n\ttps6586x_gpio->gpio_chip.ngpio = 4;\n\ttps6586x_gpio->gpio_chip.can_sleep = true;\n\n\t \n\ttps6586x_gpio->gpio_chip.direction_output = tps6586x_gpio_output;\n\ttps6586x_gpio->gpio_chip.set\t= tps6586x_gpio_set;\n\ttps6586x_gpio->gpio_chip.get\t= tps6586x_gpio_get;\n\ttps6586x_gpio->gpio_chip.to_irq\t= tps6586x_gpio_to_irq;\n\n\tif (pdata && pdata->gpio_base)\n\t\ttps6586x_gpio->gpio_chip.base = pdata->gpio_base;\n\telse\n\t\ttps6586x_gpio->gpio_chip.base = -1;\n\n\treturn devm_gpiochip_add_data(&pdev->dev, &tps6586x_gpio->gpio_chip,\n\t\t\t\t      tps6586x_gpio);\n}\n\nstatic struct platform_driver tps6586x_gpio_driver = {\n\t.driver.name\t= \"tps6586x-gpio\",\n\t.probe\t\t= tps6586x_gpio_probe,\n};\n\nstatic int __init tps6586x_gpio_init(void)\n{\n\treturn platform_driver_register(&tps6586x_gpio_driver);\n}\nsubsys_initcall(tps6586x_gpio_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}