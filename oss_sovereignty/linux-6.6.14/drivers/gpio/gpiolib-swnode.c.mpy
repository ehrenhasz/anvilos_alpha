{
  "module_name": "gpiolib-swnode.c",
  "hash_id": "aa0f833418a54dd6ee4d3802d9a8707c5d1bf212863e19c87e6b1dfaaac3687f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpiolib-swnode.c",
  "human_readable_source": "\n \n#include <linux/err.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/printk.h>\n#include <linux/property.h>\n#include <linux/string.h>\n\n#include <linux/gpio/consumer.h>\n#include <linux/gpio/driver.h>\n\n#include \"gpiolib.h\"\n#include \"gpiolib-swnode.h\"\n\nstatic void swnode_format_propname(const char *con_id, char *propname,\n\t\t\t\t   size_t max_size)\n{\n\t \n\tif (con_id)\n\t\tsnprintf(propname, max_size, \"%s-gpios\", con_id);\n\telse\n\t\tstrscpy(propname, \"gpios\", max_size);\n}\n\nstatic int swnode_gpiochip_match_name(struct gpio_chip *chip, void *data)\n{\n\treturn !strcmp(chip->label, data);\n}\n\nstatic struct gpio_chip *swnode_get_chip(struct fwnode_handle *fwnode)\n{\n\tconst struct software_node *chip_node;\n\tstruct gpio_chip *chip;\n\n\tchip_node = to_software_node(fwnode);\n\tif (!chip_node || !chip_node->name)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tchip = gpiochip_find((void *)chip_node->name, swnode_gpiochip_match_name);\n\treturn chip ?: ERR_PTR(-EPROBE_DEFER);\n}\n\nstruct gpio_desc *swnode_find_gpio(struct fwnode_handle *fwnode,\n\t\t\t\t   const char *con_id, unsigned int idx,\n\t\t\t\t   unsigned long *flags)\n{\n\tconst struct software_node *swnode;\n\tstruct fwnode_reference_args args;\n\tstruct gpio_chip *chip;\n\tstruct gpio_desc *desc;\n\tchar propname[32];  \n\tint error;\n\n\tswnode = to_software_node(fwnode);\n\tif (!swnode)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tswnode_format_propname(con_id, propname, sizeof(propname));\n\n\t \n\terror = fwnode_property_get_reference_args(fwnode, propname, NULL, 2, idx, &args);\n\tif (error) {\n\t\tpr_debug(\"%s: can't parse '%s' property of node '%pfwP[%d]'\\n\",\n\t\t\t__func__, propname, fwnode, idx);\n\t\treturn ERR_PTR(error);\n\t}\n\n\tchip = swnode_get_chip(args.fwnode);\n\tfwnode_handle_put(args.fwnode);\n\tif (IS_ERR(chip))\n\t\treturn ERR_CAST(chip);\n\n\tdesc = gpiochip_get_desc(chip, args.args[0]);\n\t*flags = args.args[1];  \n\n\tpr_debug(\"%s: parsed '%s' property of node '%pfwP[%d]' - status (%d)\\n\",\n\t\t __func__, propname, fwnode, idx, PTR_ERR_OR_ZERO(desc));\n\n\treturn desc;\n}\n\n \nint swnode_gpio_count(const struct fwnode_handle *fwnode, const char *con_id)\n{\n\tstruct fwnode_reference_args args;\n\tchar propname[32];\n\tint count;\n\n\tswnode_format_propname(con_id, propname, sizeof(propname));\n\n\t \n\tcount = 0;\n\twhile (fwnode_property_get_reference_args(fwnode, propname, NULL, 0,\n\t\t\t\t\t\t  count, &args) == 0) {\n\t\tfwnode_handle_put(args.fwnode);\n\t\tcount++;\n\t}\n\n\treturn count ?: -ENOENT;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}