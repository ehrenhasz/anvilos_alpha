{
  "module_name": "gpio-gw-pld.c",
  "hash_id": "9ceb9aa5945a5047465c75eb88bd4b0128b610894425b8758678234d3458e340",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-gw-pld.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n#include <linux/bits.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/gpio/driver.h>\n#include <linux/i2c.h>\n#include <linux/module.h>\n\n \nstruct gw_pld {\n\tstruct gpio_chip chip;\n\tstruct i2c_client *client;\n\tu8 out;\n};\n\n \nstatic int gw_pld_input8(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct gw_pld *gw = gpiochip_get_data(gc);\n\n\tgw->out |= BIT(offset);\n\treturn i2c_smbus_write_byte(gw->client, gw->out);\n}\n\nstatic int gw_pld_get8(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct gw_pld *gw = gpiochip_get_data(gc);\n\ts32 val;\n\n\tval = i2c_smbus_read_byte(gw->client);\n\n\treturn (val < 0) ? 0 : !!(val & BIT(offset));\n}\n\nstatic int gw_pld_output8(struct gpio_chip *gc, unsigned offset, int value)\n{\n\tstruct gw_pld *gw = gpiochip_get_data(gc);\n\n\tif (value)\n\t\tgw->out |= BIT(offset);\n\telse\n\t\tgw->out &= ~BIT(offset);\n\n\treturn i2c_smbus_write_byte(gw->client, gw->out);\n}\n\nstatic void gw_pld_set8(struct gpio_chip *gc, unsigned offset, int value)\n{\n\tgw_pld_output8(gc, offset, value);\n}\n\nstatic int gw_pld_probe(struct i2c_client *client)\n{\n\tstruct device *dev = &client->dev;\n\tstruct gw_pld *gw;\n\tint ret;\n\n\tgw = devm_kzalloc(dev, sizeof(*gw), GFP_KERNEL);\n\tif (!gw)\n\t\treturn -ENOMEM;\n\n\tgw->chip.base = -1;\n\tgw->chip.can_sleep = true;\n\tgw->chip.parent = dev;\n\tgw->chip.owner = THIS_MODULE;\n\tgw->chip.label = dev_name(dev);\n\tgw->chip.ngpio = 8;\n\tgw->chip.direction_input = gw_pld_input8;\n\tgw->chip.get = gw_pld_get8;\n\tgw->chip.direction_output = gw_pld_output8;\n\tgw->chip.set = gw_pld_set8;\n\tgw->client = client;\n\n\t \n\tclient->flags |= I2C_M_IGNORE_NAK;\n\tgw->out = 0xFF;\n\n\ti2c_set_clientdata(client, gw);\n\n\tret = devm_gpiochip_add_data(dev, &gw->chip, gw);\n\tif (ret)\n\t\treturn ret;\n\n\tdev_info(dev, \"registered Gateworks PLD GPIO device\\n\");\n\n\treturn 0;\n}\n\nstatic const struct i2c_device_id gw_pld_id[] = {\n\t{ \"gw-pld\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, gw_pld_id);\n\nstatic const struct of_device_id gw_pld_dt_ids[] = {\n\t{ .compatible = \"gateworks,pld-gpio\", },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, gw_pld_dt_ids);\n\nstatic struct i2c_driver gw_pld_driver = {\n\t.driver = {\n\t\t.name = \"gw_pld\",\n\t\t.of_match_table = gw_pld_dt_ids,\n\t},\n\t.probe = gw_pld_probe,\n\t.id_table = gw_pld_id,\n};\nmodule_i2c_driver(gw_pld_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Linus Walleij <linus.walleij@linaro.org>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}