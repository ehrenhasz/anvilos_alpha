{
  "module_name": "gpio-merrifield.c",
  "hash_id": "4c2283d91e7942c950d56b9e4806a919c18eebf9d61d64608bdffcdd4df44c96",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-merrifield.c",
  "human_readable_source": "\n \n\n#include <linux/acpi.h>\n#include <linux/bitops.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/types.h>\n\n#include \"gpio-tangier.h\"\n\n \n#define MRFLD_NGPIO\t192\n\nstatic const struct tng_gpio_pinrange mrfld_gpio_ranges[] = {\n\tGPIO_PINRANGE(0, 11, 146),\n\tGPIO_PINRANGE(12, 13, 144),\n\tGPIO_PINRANGE(14, 15, 35),\n\tGPIO_PINRANGE(16, 16, 164),\n\tGPIO_PINRANGE(17, 18, 105),\n\tGPIO_PINRANGE(19, 22, 101),\n\tGPIO_PINRANGE(23, 30, 107),\n\tGPIO_PINRANGE(32, 43, 67),\n\tGPIO_PINRANGE(44, 63, 195),\n\tGPIO_PINRANGE(64, 67, 140),\n\tGPIO_PINRANGE(68, 69, 165),\n\tGPIO_PINRANGE(70, 71, 65),\n\tGPIO_PINRANGE(72, 76, 228),\n\tGPIO_PINRANGE(77, 86, 37),\n\tGPIO_PINRANGE(87, 87, 48),\n\tGPIO_PINRANGE(88, 88, 47),\n\tGPIO_PINRANGE(89, 96, 49),\n\tGPIO_PINRANGE(97, 97, 34),\n\tGPIO_PINRANGE(102, 119, 83),\n\tGPIO_PINRANGE(120, 123, 79),\n\tGPIO_PINRANGE(124, 135, 115),\n\tGPIO_PINRANGE(137, 142, 158),\n\tGPIO_PINRANGE(154, 163, 24),\n\tGPIO_PINRANGE(164, 176, 215),\n\tGPIO_PINRANGE(177, 189, 127),\n\tGPIO_PINRANGE(190, 191, 178),\n};\n\nstatic const char *mrfld_gpio_get_pinctrl_dev_name(struct tng_gpio *priv)\n{\n\tstruct device *dev = priv->dev;\n\tstruct acpi_device *adev;\n\tconst char *name;\n\n\tadev = acpi_dev_get_first_match_dev(\"INTC1002\", NULL, -1);\n\tif (adev) {\n\t\tname = devm_kstrdup(dev, acpi_dev_name(adev), GFP_KERNEL);\n\t\tacpi_dev_put(adev);\n\t} else {\n\t\tname = \"pinctrl-merrifield\";\n\t}\n\n\treturn name;\n}\n\nstatic int mrfld_gpio_probe(struct pci_dev *pdev, const struct pci_device_id *id)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct tng_gpio *priv;\n\tu32 gpio_base, irq_base;\n\tvoid __iomem *base;\n\tint retval;\n\n\tretval = pcim_enable_device(pdev);\n\tif (retval)\n\t\treturn retval;\n\n\tretval = pcim_iomap_regions(pdev, BIT(1) | BIT(0), pci_name(pdev));\n\tif (retval)\n\t\treturn dev_err_probe(dev, retval, \"I/O memory mapping error\\n\");\n\n\tbase = pcim_iomap_table(pdev)[1];\n\n\tirq_base = readl(base + 0 * sizeof(u32));\n\tgpio_base = readl(base + 1 * sizeof(u32));\n\n\t \n\tpcim_iounmap_regions(pdev, BIT(1));\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->dev = dev;\n\tpriv->reg_base = pcim_iomap_table(pdev)[0];\n\n\tpriv->pin_info.pin_ranges = mrfld_gpio_ranges;\n\tpriv->pin_info.nranges = ARRAY_SIZE(mrfld_gpio_ranges);\n\tpriv->pin_info.name = mrfld_gpio_get_pinctrl_dev_name(priv);\n\tif (!priv->pin_info.name)\n\t\treturn -ENOMEM;\n\n\tpriv->info.base = gpio_base;\n\tpriv->info.ngpio = MRFLD_NGPIO;\n\tpriv->info.first = irq_base;\n\n\tretval = pci_alloc_irq_vectors(pdev, 1, 1, PCI_IRQ_ALL_TYPES);\n\tif (retval < 0)\n\t\treturn retval;\n\n\tpriv->irq = pci_irq_vector(pdev, 0);\n\n\tpriv->wake_regs.gwmr = GWMR_MRFLD;\n\tpriv->wake_regs.gwsr = GWSR_MRFLD;\n\tpriv->wake_regs.gsir = GSIR_MRFLD;\n\n\tretval = devm_tng_gpio_probe(dev, priv);\n\tif (retval)\n\t\treturn dev_err_probe(dev, retval, \"tng_gpio_probe error\\n\");\n\n\tpci_set_drvdata(pdev, priv);\n\treturn 0;\n}\n\nstatic const struct pci_device_id mrfld_gpio_ids[] = {\n\t{ PCI_VDEVICE(INTEL, 0x1199) },\n\t{ }\n};\nMODULE_DEVICE_TABLE(pci, mrfld_gpio_ids);\n\nstatic struct pci_driver mrfld_gpio_driver = {\n\t.name\t\t= \"gpio-merrifield\",\n\t.id_table\t= mrfld_gpio_ids,\n\t.probe\t\t= mrfld_gpio_probe,\n};\nmodule_pci_driver(mrfld_gpio_driver);\n\nMODULE_AUTHOR(\"Andy Shevchenko <andriy.shevchenko@linux.intel.com>\");\nMODULE_DESCRIPTION(\"Intel Merrifield SoC GPIO driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_IMPORT_NS(GPIO_TANGIER);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}