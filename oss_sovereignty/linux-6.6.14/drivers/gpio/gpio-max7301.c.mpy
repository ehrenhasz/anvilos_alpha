{
  "module_name": "gpio-max7301.c",
  "hash_id": "6b6303aea8d88d71510eb533a20886ed4375872fdd2beea65510727bd2987176",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-max7301.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/platform_device.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n#include <linux/spi/spi.h>\n#include <linux/spi/max7301.h>\n\n \nstatic int max7301_spi_write(struct device *dev, unsigned int reg,\n\t\t\t\tunsigned int val)\n{\n\tstruct spi_device *spi = to_spi_device(dev);\n\tu16 word = ((reg & 0x7F) << 8) | (val & 0xFF);\n\n\treturn spi_write_then_read(spi, &word, sizeof(word), NULL, 0);\n}\n\n \n\nstatic int max7301_spi_read(struct device *dev, unsigned int reg)\n{\n\tint ret;\n\tu16 word;\n\tstruct spi_device *spi = to_spi_device(dev);\n\n\tword = 0x8000 | (reg << 8);\n\tret = spi_write_then_read(spi, &word, sizeof(word), &word,\n\t\t\t\t  sizeof(word));\n\tif (ret)\n\t\treturn ret;\n\treturn word & 0xff;\n}\n\nstatic int max7301_probe(struct spi_device *spi)\n{\n\tstruct max7301 *ts;\n\tint ret;\n\n\t \n\tspi->bits_per_word = 16;\n\tret = spi_setup(spi);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tts = devm_kzalloc(&spi->dev, sizeof(struct max7301), GFP_KERNEL);\n\tif (!ts)\n\t\treturn -ENOMEM;\n\n\tts->read = max7301_spi_read;\n\tts->write = max7301_spi_write;\n\tts->dev = &spi->dev;\n\n\tret = __max730x_probe(ts);\n\treturn ret;\n}\n\nstatic void max7301_remove(struct spi_device *spi)\n{\n\t__max730x_remove(&spi->dev);\n}\n\nstatic const struct spi_device_id max7301_id[] = {\n\t{ \"max7301\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(spi, max7301_id);\n\nstatic struct spi_driver max7301_driver = {\n\t.driver = {\n\t\t.name = \"max7301\",\n\t},\n\t.probe = max7301_probe,\n\t.remove = max7301_remove,\n\t.id_table = max7301_id,\n};\n\nstatic int __init max7301_init(void)\n{\n\treturn spi_register_driver(&max7301_driver);\n}\n \nsubsys_initcall(max7301_init);\n\nstatic void __exit max7301_exit(void)\n{\n\tspi_unregister_driver(&max7301_driver);\n}\nmodule_exit(max7301_exit);\n\nMODULE_AUTHOR(\"Juergen Beisert, Wolfram Sang\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DESCRIPTION(\"MAX7301 GPIO-Expander\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}