{
  "module_name": "gpio-lp873x.c",
  "hash_id": "45d4ea3e3c39d408911e2d29c9cceee707d19174df2f85725fdd840e303743e8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-lp873x.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/driver.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\n#include <linux/mfd/lp873x.h>\n\n#define BITS_PER_GPO\t\t0x4\n#define LP873X_GPO_CTRL_OD\t0x2\n\nstruct lp873x_gpio {\n\tstruct gpio_chip chip;\n\tstruct lp873x *lp873;\n};\n\nstatic int lp873x_gpio_get_direction(struct gpio_chip *chip,\n\t\t\t\t     unsigned int offset)\n{\n\t \n\treturn GPIO_LINE_DIRECTION_OUT;\n}\n\nstatic int lp873x_gpio_direction_input(struct gpio_chip *chip,\n\t\t\t\t       unsigned int offset)\n{\n\t \n\treturn -EINVAL;\n}\n\nstatic int lp873x_gpio_direction_output(struct gpio_chip *chip,\n\t\t\t\t\tunsigned int offset, int value)\n{\n\tstruct lp873x_gpio *gpio = gpiochip_get_data(chip);\n\n\t \n\treturn regmap_update_bits(gpio->lp873->regmap, LP873X_REG_GPO_CTRL,\n\t\t\t\t  BIT(offset * BITS_PER_GPO),\n\t\t\t\t  value ? BIT(offset * BITS_PER_GPO) : 0);\n}\n\nstatic int lp873x_gpio_get(struct gpio_chip *chip, unsigned int offset)\n{\n\tstruct lp873x_gpio *gpio = gpiochip_get_data(chip);\n\tint ret, val;\n\n\tret = regmap_read(gpio->lp873->regmap, LP873X_REG_GPO_CTRL, &val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn val & BIT(offset * BITS_PER_GPO);\n}\n\nstatic void lp873x_gpio_set(struct gpio_chip *chip, unsigned int offset,\n\t\t\t    int value)\n{\n\tstruct lp873x_gpio *gpio = gpiochip_get_data(chip);\n\n\tregmap_update_bits(gpio->lp873->regmap, LP873X_REG_GPO_CTRL,\n\t\t\t   BIT(offset * BITS_PER_GPO),\n\t\t\t   value ? BIT(offset * BITS_PER_GPO) : 0);\n}\n\nstatic int lp873x_gpio_request(struct gpio_chip *gc, unsigned int offset)\n{\n\tstruct lp873x_gpio *gpio = gpiochip_get_data(gc);\n\tint ret;\n\n\tswitch (offset) {\n\tcase 0:\n\t\t \n\t\tbreak;\n\tcase 1:\n\t\t \n\t\tret = regmap_update_bits(gpio->lp873->regmap, LP873X_REG_CONFIG,\n\t\t\t\t\t LP873X_CONFIG_CLKIN_PIN_SEL, 0);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int lp873x_gpio_set_config(struct gpio_chip *gc, unsigned offset,\n\t\t\t\t  unsigned long config)\n{\n\tstruct lp873x_gpio *gpio = gpiochip_get_data(gc);\n\n\tswitch (pinconf_to_config_param(config)) {\n\tcase PIN_CONFIG_DRIVE_OPEN_DRAIN:\n\t\treturn regmap_update_bits(gpio->lp873->regmap,\n\t\t\t\t\t  LP873X_REG_GPO_CTRL,\n\t\t\t\t\t  BIT(offset * BITS_PER_GPO +\n\t\t\t\t\t  LP873X_GPO_CTRL_OD),\n\t\t\t\t\t  BIT(offset * BITS_PER_GPO +\n\t\t\t\t\t  LP873X_GPO_CTRL_OD));\n\n\tcase PIN_CONFIG_DRIVE_PUSH_PULL:\n\t\treturn regmap_update_bits(gpio->lp873->regmap,\n\t\t\t\t\t  LP873X_REG_GPO_CTRL,\n\t\t\t\t\t  BIT(offset * BITS_PER_GPO +\n\t\t\t\t\t  LP873X_GPO_CTRL_OD), 0);\n\tdefault:\n\t\treturn -ENOTSUPP;\n\t}\n}\n\nstatic const struct gpio_chip template_chip = {\n\t.label\t\t\t= \"lp873x-gpio\",\n\t.owner\t\t\t= THIS_MODULE,\n\t.request\t\t= lp873x_gpio_request,\n\t.get_direction\t\t= lp873x_gpio_get_direction,\n\t.direction_input\t= lp873x_gpio_direction_input,\n\t.direction_output\t= lp873x_gpio_direction_output,\n\t.get\t\t\t= lp873x_gpio_get,\n\t.set\t\t\t= lp873x_gpio_set,\n\t.set_config\t\t= lp873x_gpio_set_config,\n\t.base\t\t\t= -1,\n\t.ngpio\t\t\t= 2,\n\t.can_sleep\t\t= true,\n};\n\nstatic int lp873x_gpio_probe(struct platform_device *pdev)\n{\n\tstruct lp873x_gpio *gpio;\n\tint ret;\n\n\tgpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\n\tif (!gpio)\n\t\treturn -ENOMEM;\n\n\tplatform_set_drvdata(pdev, gpio);\n\n\tgpio->lp873 = dev_get_drvdata(pdev->dev.parent);\n\tgpio->chip = template_chip;\n\tgpio->chip.parent = gpio->lp873->dev;\n\n\tret = devm_gpiochip_add_data(&pdev->dev, &gpio->chip, gpio);\n\tif (ret < 0) {\n\t\tdev_err(&pdev->dev, \"Could not register gpiochip, %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id lp873x_gpio_id_table[] = {\n\t{ \"lp873x-gpio\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(platform, lp873x_gpio_id_table);\n\nstatic struct platform_driver lp873x_gpio_driver = {\n\t.driver = {\n\t\t.name = \"lp873x-gpio\",\n\t},\n\t.probe = lp873x_gpio_probe,\n\t.id_table = lp873x_gpio_id_table,\n};\nmodule_platform_driver(lp873x_gpio_driver);\n\nMODULE_AUTHOR(\"Keerthy <j-keerthy@ti.com>\");\nMODULE_DESCRIPTION(\"LP873X GPIO driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}