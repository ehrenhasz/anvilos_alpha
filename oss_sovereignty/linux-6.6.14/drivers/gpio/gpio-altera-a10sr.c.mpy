{
  "module_name": "gpio-altera-a10sr.c",
  "hash_id": "59f8747220c2d4443b01b8d9c75e0484e608b4fb7ecc5fb6a075e79d139c2ad8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-altera-a10sr.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/driver.h>\n#include <linux/mfd/altera-a10sr.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/property.h>\n\n \nstruct altr_a10sr_gpio {\n\tstruct gpio_chip gp;\n\tstruct regmap *regmap;\n};\n\nstatic int altr_a10sr_gpio_get(struct gpio_chip *chip, unsigned int offset)\n{\n\tstruct altr_a10sr_gpio *gpio = gpiochip_get_data(chip);\n\tint ret, val;\n\n\tret = regmap_read(gpio->regmap, ALTR_A10SR_PBDSW_REG, &val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn !!(val & BIT(offset - ALTR_A10SR_LED_VALID_SHIFT));\n}\n\nstatic void altr_a10sr_gpio_set(struct gpio_chip *chip, unsigned int offset,\n\t\t\t\tint value)\n{\n\tstruct altr_a10sr_gpio *gpio = gpiochip_get_data(chip);\n\n\tregmap_update_bits(gpio->regmap, ALTR_A10SR_LED_REG,\n\t\t\t   BIT(ALTR_A10SR_LED_VALID_SHIFT + offset),\n\t\t\t   value ? BIT(ALTR_A10SR_LED_VALID_SHIFT + offset)\n\t\t\t   : 0);\n}\n\nstatic int altr_a10sr_gpio_direction_input(struct gpio_chip *gc,\n\t\t\t\t\t   unsigned int nr)\n{\n\tif (nr < (ALTR_A10SR_IN_VALID_RANGE_LO - ALTR_A10SR_LED_VALID_SHIFT))\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nstatic int altr_a10sr_gpio_direction_output(struct gpio_chip *gc,\n\t\t\t\t\t    unsigned int nr, int value)\n{\n\tif (nr > (ALTR_A10SR_OUT_VALID_RANGE_HI - ALTR_A10SR_LED_VALID_SHIFT))\n\t\treturn -EINVAL;\n\n\taltr_a10sr_gpio_set(gc, nr, value);\n\treturn 0;\n}\n\nstatic const struct gpio_chip altr_a10sr_gc = {\n\t.label = \"altr_a10sr_gpio\",\n\t.owner = THIS_MODULE,\n\t.get = altr_a10sr_gpio_get,\n\t.set = altr_a10sr_gpio_set,\n\t.direction_input = altr_a10sr_gpio_direction_input,\n\t.direction_output = altr_a10sr_gpio_direction_output,\n\t.can_sleep = true,\n\t.ngpio = 12,\n\t.base = -1,\n};\n\nstatic int altr_a10sr_gpio_probe(struct platform_device *pdev)\n{\n\tstruct altr_a10sr_gpio *gpio;\n\tstruct altr_a10sr *a10sr = dev_get_drvdata(pdev->dev.parent);\n\n\tgpio = devm_kzalloc(&pdev->dev, sizeof(*gpio), GFP_KERNEL);\n\tif (!gpio)\n\t\treturn -ENOMEM;\n\n\tgpio->regmap = a10sr->regmap;\n\n\tgpio->gp = altr_a10sr_gc;\n\tgpio->gp.parent = pdev->dev.parent;\n\tgpio->gp.fwnode = dev_fwnode(&pdev->dev);\n\n\treturn devm_gpiochip_add_data(&pdev->dev, &gpio->gp, gpio);\n}\n\nstatic const struct of_device_id altr_a10sr_gpio_of_match[] = {\n\t{ .compatible = \"altr,a10sr-gpio\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, altr_a10sr_gpio_of_match);\n\nstatic struct platform_driver altr_a10sr_gpio_driver = {\n\t.probe = altr_a10sr_gpio_probe,\n\t.driver = {\n\t\t.name\t= \"altr_a10sr_gpio\",\n\t\t.of_match_table = altr_a10sr_gpio_of_match,\n\t},\n};\nmodule_platform_driver(altr_a10sr_gpio_driver);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_AUTHOR(\"Thor Thayer <tthayer@opensource.altera.com>\");\nMODULE_DESCRIPTION(\"Altera Arria10 System Resource Chip GPIO\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}