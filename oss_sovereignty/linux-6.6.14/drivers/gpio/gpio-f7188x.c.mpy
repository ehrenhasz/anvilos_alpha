{
  "module_name": "gpio-f7188x.c",
  "hash_id": "cb01e42c9050e2f6c8f25d82ffd1c2847955bebf6ee482283a667f945025fe99",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-f7188x.c",
  "human_readable_source": "\n \n\n#define DRVNAME \"gpio-f7188x\"\n#define pr_fmt(fmt) DRVNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/platform_device.h>\n#include <linux/io.h>\n#include <linux/gpio/driver.h>\n#include <linux/bitops.h>\n\n \n#define SIO_LDSEL\t\t0x07\t \n#define SIO_DEVID\t\t0x20\t \n\n#define SIO_UNLOCK_KEY\t\t0x87\t \n#define SIO_LOCK_KEY\t\t0xAA\t \n\n \n#define SIO_FINTEK_DEVREV\t0x22\t \n#define SIO_FINTEK_MANID\t0x23     \n\n#define SIO_FINTEK_ID\t\t0x1934   \n\n#define SIO_F71869_ID\t\t0x0814\t \n#define SIO_F71869A_ID\t\t0x1007\t \n#define SIO_F71882_ID\t\t0x0541\t \n#define SIO_F71889_ID\t\t0x0909\t \n#define SIO_F71889A_ID\t\t0x1005\t \n#define SIO_F81866_ID\t\t0x1010\t \n#define SIO_F81804_ID\t\t0x1502   \n#define SIO_F81865_ID\t\t0x0704\t \n\n#define SIO_LD_GPIO_FINTEK\t0x06\t \n\n \n#define SIO_NCT6126D_ID\t\t0xD283   \n\n#define SIO_LD_GPIO_NUVOTON\t0x07\t \n\n\nenum chips {\n\tf71869,\n\tf71869a,\n\tf71882fg,\n\tf71889a,\n\tf71889f,\n\tf81866,\n\tf81804,\n\tf81865,\n\tnct6126d,\n};\n\nstatic const char * const f7188x_names[] = {\n\t\"f71869\",\n\t\"f71869a\",\n\t\"f71882fg\",\n\t\"f71889a\",\n\t\"f71889f\",\n\t\"f81866\",\n\t\"f81804\",\n\t\"f81865\",\n\t\"nct6126d\",\n};\n\nstruct f7188x_sio {\n\tint addr;\n\tint device;\n\tenum chips type;\n};\n\nstruct f7188x_gpio_bank {\n\tstruct gpio_chip chip;\n\tunsigned int regbase;\n\tstruct f7188x_gpio_data *data;\n};\n\nstruct f7188x_gpio_data {\n\tstruct f7188x_sio *sio;\n\tint nr_bank;\n\tstruct f7188x_gpio_bank *bank;\n};\n\n \n\nstatic inline int superio_inb(int base, int reg)\n{\n\toutb(reg, base);\n\treturn inb(base + 1);\n}\n\nstatic int superio_inw(int base, int reg)\n{\n\tint val;\n\n\toutb(reg++, base);\n\tval = inb(base + 1) << 8;\n\toutb(reg, base);\n\tval |= inb(base + 1);\n\n\treturn val;\n}\n\nstatic inline void superio_outb(int base, int reg, int val)\n{\n\toutb(reg, base);\n\toutb(val, base + 1);\n}\n\nstatic inline int superio_enter(int base)\n{\n\t \n\tif (!request_muxed_region(base, 2, DRVNAME)) {\n\t\tpr_err(\"I/O address 0x%04x already in use\\n\", base);\n\t\treturn -EBUSY;\n\t}\n\n\t \n\toutb(SIO_UNLOCK_KEY, base);\n\toutb(SIO_UNLOCK_KEY, base);\n\n\treturn 0;\n}\n\nstatic inline void superio_select(int base, int ld)\n{\n\toutb(SIO_LDSEL, base);\n\toutb(ld, base + 1);\n}\n\nstatic inline void superio_exit(int base)\n{\n\toutb(SIO_LOCK_KEY, base);\n\trelease_region(base, 2);\n}\n\n \n\nstatic int f7188x_gpio_get_direction(struct gpio_chip *chip, unsigned offset);\nstatic int f7188x_gpio_direction_in(struct gpio_chip *chip, unsigned offset);\nstatic int f7188x_gpio_get(struct gpio_chip *chip, unsigned offset);\nstatic int f7188x_gpio_direction_out(struct gpio_chip *chip,\n\t\t\t\t     unsigned offset, int value);\nstatic void f7188x_gpio_set(struct gpio_chip *chip, unsigned offset, int value);\nstatic int f7188x_gpio_set_config(struct gpio_chip *chip, unsigned offset,\n\t\t\t\t  unsigned long config);\n\n#define F7188X_GPIO_BANK(_base, _ngpio, _regbase, _label)\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.chip = {\t\t\t\t\t\t\\\n\t\t\t.label            = _label,\t\t\t\\\n\t\t\t.owner            = THIS_MODULE,\t\t\\\n\t\t\t.get_direction    = f7188x_gpio_get_direction,\t\\\n\t\t\t.direction_input  = f7188x_gpio_direction_in,\t\\\n\t\t\t.get              = f7188x_gpio_get,\t\t\\\n\t\t\t.direction_output = f7188x_gpio_direction_out,\t\\\n\t\t\t.set              = f7188x_gpio_set,\t\t\\\n\t\t\t.set_config\t  = f7188x_gpio_set_config,\t\\\n\t\t\t.base             = _base,\t\t\t\\\n\t\t\t.ngpio            = _ngpio,\t\t\t\\\n\t\t\t.can_sleep        = true,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.regbase = _regbase,\t\t\t\t\t\\\n\t}\n\n#define f7188x_gpio_dir(base) ((base) + 0)\n#define f7188x_gpio_data_out(base) ((base) + 1)\n#define f7188x_gpio_data_in(base) ((base) + 2)\n \n#define f7188x_gpio_out_mode(base) ((base) + 3)\n\n#define f7188x_gpio_dir_invert(type)\t((type) == nct6126d)\n#define f7188x_gpio_data_single(type)\t((type) == nct6126d)\n\nstatic struct f7188x_gpio_bank f71869_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 6, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 8, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 8, 0xC0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 8, 0xB0, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(50, 5, 0xA0, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(60, 6, 0x90, DRVNAME \"-6\"),\n};\n\nstatic struct f7188x_gpio_bank f71869a_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 6, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 8, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 8, 0xC0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 8, 0xB0, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(50, 5, 0xA0, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(60, 8, 0x90, DRVNAME \"-6\"),\n\tF7188X_GPIO_BANK(70, 8, 0x80, DRVNAME \"-7\"),\n};\n\nstatic struct f7188x_gpio_bank f71882_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 8, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 8, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 4, 0xC0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 4, 0xB0, DRVNAME \"-4\"),\n};\n\nstatic struct f7188x_gpio_bank f71889a_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 7, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 7, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 8, 0xC0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 8, 0xB0, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(50, 5, 0xA0, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(60, 8, 0x90, DRVNAME \"-6\"),\n\tF7188X_GPIO_BANK(70, 8, 0x80, DRVNAME \"-7\"),\n};\n\nstatic struct f7188x_gpio_bank f71889_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 7, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 7, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 8, 0xC0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 8, 0xB0, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(50, 5, 0xA0, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(60, 8, 0x90, DRVNAME \"-6\"),\n\tF7188X_GPIO_BANK(70, 8, 0x80, DRVNAME \"-7\"),\n};\n\nstatic struct f7188x_gpio_bank f81866_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 8, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 8, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 8, 0xC0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 8, 0xB0, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(50, 8, 0xA0, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(60, 8, 0x90, DRVNAME \"-6\"),\n\tF7188X_GPIO_BANK(70, 8, 0x80, DRVNAME \"-7\"),\n\tF7188X_GPIO_BANK(80, 8, 0x88, DRVNAME \"-8\"),\n};\n\n\nstatic struct f7188x_gpio_bank f81804_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 8, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 8, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(50, 8, 0xA0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(60, 8, 0x90, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(70, 8, 0x80, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(90, 8, 0x98, DRVNAME \"-6\"),\n};\n\nstatic struct f7188x_gpio_bank f81865_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 8, 0xF0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 8, 0xE0, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xD0, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 8, 0xC0, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 8, 0xB0, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(50, 8, 0xA0, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(60, 5, 0x90, DRVNAME \"-6\"),\n};\n\nstatic struct f7188x_gpio_bank nct6126d_gpio_bank[] = {\n\tF7188X_GPIO_BANK(0, 8, 0xE0, DRVNAME \"-0\"),\n\tF7188X_GPIO_BANK(10, 8, 0xE4, DRVNAME \"-1\"),\n\tF7188X_GPIO_BANK(20, 8, 0xE8, DRVNAME \"-2\"),\n\tF7188X_GPIO_BANK(30, 8, 0xEC, DRVNAME \"-3\"),\n\tF7188X_GPIO_BANK(40, 8, 0xF0, DRVNAME \"-4\"),\n\tF7188X_GPIO_BANK(50, 8, 0xF4, DRVNAME \"-5\"),\n\tF7188X_GPIO_BANK(60, 8, 0xF8, DRVNAME \"-6\"),\n\tF7188X_GPIO_BANK(70, 8, 0xFC, DRVNAME \"-7\"),\n};\n\nstatic int f7188x_gpio_get_direction(struct gpio_chip *chip, unsigned offset)\n{\n\tint err;\n\tstruct f7188x_gpio_bank *bank = gpiochip_get_data(chip);\n\tstruct f7188x_sio *sio = bank->data->sio;\n\tu8 dir;\n\n\terr = superio_enter(sio->addr);\n\tif (err)\n\t\treturn err;\n\tsuperio_select(sio->addr, sio->device);\n\n\tdir = superio_inb(sio->addr, f7188x_gpio_dir(bank->regbase));\n\n\tsuperio_exit(sio->addr);\n\n\tif (f7188x_gpio_dir_invert(sio->type))\n\t\tdir = ~dir;\n\n\tif (dir & BIT(offset))\n\t\treturn GPIO_LINE_DIRECTION_OUT;\n\n\treturn GPIO_LINE_DIRECTION_IN;\n}\n\nstatic int f7188x_gpio_direction_in(struct gpio_chip *chip, unsigned offset)\n{\n\tint err;\n\tstruct f7188x_gpio_bank *bank = gpiochip_get_data(chip);\n\tstruct f7188x_sio *sio = bank->data->sio;\n\tu8 dir;\n\n\terr = superio_enter(sio->addr);\n\tif (err)\n\t\treturn err;\n\tsuperio_select(sio->addr, sio->device);\n\n\tdir = superio_inb(sio->addr, f7188x_gpio_dir(bank->regbase));\n\n\tif (f7188x_gpio_dir_invert(sio->type))\n\t\tdir |= BIT(offset);\n\telse\n\t\tdir &= ~BIT(offset);\n\tsuperio_outb(sio->addr, f7188x_gpio_dir(bank->regbase), dir);\n\n\tsuperio_exit(sio->addr);\n\n\treturn 0;\n}\n\nstatic int f7188x_gpio_get(struct gpio_chip *chip, unsigned offset)\n{\n\tint err;\n\tstruct f7188x_gpio_bank *bank = gpiochip_get_data(chip);\n\tstruct f7188x_sio *sio = bank->data->sio;\n\tu8 dir, data;\n\n\terr = superio_enter(sio->addr);\n\tif (err)\n\t\treturn err;\n\tsuperio_select(sio->addr, sio->device);\n\n\tdir = superio_inb(sio->addr, f7188x_gpio_dir(bank->regbase));\n\tdir = !!(dir & BIT(offset));\n\tif (f7188x_gpio_data_single(sio->type) || dir)\n\t\tdata = superio_inb(sio->addr, f7188x_gpio_data_out(bank->regbase));\n\telse\n\t\tdata = superio_inb(sio->addr, f7188x_gpio_data_in(bank->regbase));\n\n\tsuperio_exit(sio->addr);\n\n\treturn !!(data & BIT(offset));\n}\n\nstatic int f7188x_gpio_direction_out(struct gpio_chip *chip,\n\t\t\t\t     unsigned offset, int value)\n{\n\tint err;\n\tstruct f7188x_gpio_bank *bank = gpiochip_get_data(chip);\n\tstruct f7188x_sio *sio = bank->data->sio;\n\tu8 dir, data_out;\n\n\terr = superio_enter(sio->addr);\n\tif (err)\n\t\treturn err;\n\tsuperio_select(sio->addr, sio->device);\n\n\tdata_out = superio_inb(sio->addr, f7188x_gpio_data_out(bank->regbase));\n\tif (value)\n\t\tdata_out |= BIT(offset);\n\telse\n\t\tdata_out &= ~BIT(offset);\n\tsuperio_outb(sio->addr, f7188x_gpio_data_out(bank->regbase), data_out);\n\n\tdir = superio_inb(sio->addr, f7188x_gpio_dir(bank->regbase));\n\tif (f7188x_gpio_dir_invert(sio->type))\n\t\tdir &= ~BIT(offset);\n\telse\n\t\tdir |= BIT(offset);\n\tsuperio_outb(sio->addr, f7188x_gpio_dir(bank->regbase), dir);\n\n\tsuperio_exit(sio->addr);\n\n\treturn 0;\n}\n\nstatic void f7188x_gpio_set(struct gpio_chip *chip, unsigned offset, int value)\n{\n\tint err;\n\tstruct f7188x_gpio_bank *bank = gpiochip_get_data(chip);\n\tstruct f7188x_sio *sio = bank->data->sio;\n\tu8 data_out;\n\n\terr = superio_enter(sio->addr);\n\tif (err)\n\t\treturn;\n\tsuperio_select(sio->addr, sio->device);\n\n\tdata_out = superio_inb(sio->addr, f7188x_gpio_data_out(bank->regbase));\n\tif (value)\n\t\tdata_out |= BIT(offset);\n\telse\n\t\tdata_out &= ~BIT(offset);\n\tsuperio_outb(sio->addr, f7188x_gpio_data_out(bank->regbase), data_out);\n\n\tsuperio_exit(sio->addr);\n}\n\nstatic int f7188x_gpio_set_config(struct gpio_chip *chip, unsigned offset,\n\t\t\t\t  unsigned long config)\n{\n\tint err;\n\tenum pin_config_param param = pinconf_to_config_param(config);\n\tstruct f7188x_gpio_bank *bank = gpiochip_get_data(chip);\n\tstruct f7188x_sio *sio = bank->data->sio;\n\tu8 data;\n\n\tif (param != PIN_CONFIG_DRIVE_OPEN_DRAIN &&\n\t    param != PIN_CONFIG_DRIVE_PUSH_PULL)\n\t\treturn -ENOTSUPP;\n\n\terr = superio_enter(sio->addr);\n\tif (err)\n\t\treturn err;\n\tsuperio_select(sio->addr, sio->device);\n\n\tdata = superio_inb(sio->addr, f7188x_gpio_out_mode(bank->regbase));\n\tif (param == PIN_CONFIG_DRIVE_OPEN_DRAIN)\n\t\tdata &= ~BIT(offset);\n\telse\n\t\tdata |= BIT(offset);\n\tsuperio_outb(sio->addr, f7188x_gpio_out_mode(bank->regbase), data);\n\n\tsuperio_exit(sio->addr);\n\treturn 0;\n}\n\n \n\nstatic int f7188x_gpio_probe(struct platform_device *pdev)\n{\n\tint err;\n\tint i;\n\tstruct f7188x_sio *sio = dev_get_platdata(&pdev->dev);\n\tstruct f7188x_gpio_data *data;\n\n\tdata = devm_kzalloc(&pdev->dev, sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tswitch (sio->type) {\n\tcase f71869:\n\t\tdata->nr_bank = ARRAY_SIZE(f71869_gpio_bank);\n\t\tdata->bank = f71869_gpio_bank;\n\t\tbreak;\n\tcase f71869a:\n\t\tdata->nr_bank = ARRAY_SIZE(f71869a_gpio_bank);\n\t\tdata->bank = f71869a_gpio_bank;\n\t\tbreak;\n\tcase f71882fg:\n\t\tdata->nr_bank = ARRAY_SIZE(f71882_gpio_bank);\n\t\tdata->bank = f71882_gpio_bank;\n\t\tbreak;\n\tcase f71889a:\n\t\tdata->nr_bank = ARRAY_SIZE(f71889a_gpio_bank);\n\t\tdata->bank = f71889a_gpio_bank;\n\t\tbreak;\n\tcase f71889f:\n\t\tdata->nr_bank = ARRAY_SIZE(f71889_gpio_bank);\n\t\tdata->bank = f71889_gpio_bank;\n\t\tbreak;\n\tcase f81866:\n\t\tdata->nr_bank = ARRAY_SIZE(f81866_gpio_bank);\n\t\tdata->bank = f81866_gpio_bank;\n\t\tbreak;\n\tcase  f81804:\n\t\tdata->nr_bank = ARRAY_SIZE(f81804_gpio_bank);\n\t\tdata->bank = f81804_gpio_bank;\n\t\tbreak;\n\tcase f81865:\n\t\tdata->nr_bank = ARRAY_SIZE(f81865_gpio_bank);\n\t\tdata->bank = f81865_gpio_bank;\n\t\tbreak;\n\tcase nct6126d:\n\t\tdata->nr_bank = ARRAY_SIZE(nct6126d_gpio_bank);\n\t\tdata->bank = nct6126d_gpio_bank;\n\t\tbreak;\n\tdefault:\n\t\treturn -ENODEV;\n\t}\n\tdata->sio = sio;\n\n\tplatform_set_drvdata(pdev, data);\n\n\t \n\tfor (i = 0; i < data->nr_bank; i++) {\n\t\tstruct f7188x_gpio_bank *bank = &data->bank[i];\n\n\t\tbank->chip.parent = &pdev->dev;\n\t\tbank->data = data;\n\n\t\terr = devm_gpiochip_add_data(&pdev->dev, &bank->chip, bank);\n\t\tif (err) {\n\t\t\tdev_err(&pdev->dev,\n\t\t\t\t\"Failed to register gpiochip %d: %d\\n\",\n\t\t\t\ti, err);\n\t\t\treturn err;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int __init f7188x_find(int addr, struct f7188x_sio *sio)\n{\n\tint err;\n\tu16 devid;\n\tu16 manid;\n\n\terr = superio_enter(addr);\n\tif (err)\n\t\treturn err;\n\n\terr = -ENODEV;\n\n\tsio->device = SIO_LD_GPIO_FINTEK;\n\tdevid = superio_inw(addr, SIO_DEVID);\n\tswitch (devid) {\n\tcase SIO_F71869_ID:\n\t\tsio->type = f71869;\n\t\tbreak;\n\tcase SIO_F71869A_ID:\n\t\tsio->type = f71869a;\n\t\tbreak;\n\tcase SIO_F71882_ID:\n\t\tsio->type = f71882fg;\n\t\tbreak;\n\tcase SIO_F71889A_ID:\n\t\tsio->type = f71889a;\n\t\tbreak;\n\tcase SIO_F71889_ID:\n\t\tsio->type = f71889f;\n\t\tbreak;\n\tcase SIO_F81866_ID:\n\t\tsio->type = f81866;\n\t\tbreak;\n\tcase SIO_F81804_ID:\n\t\tsio->type = f81804;\n\t\tbreak;\n\tcase SIO_F81865_ID:\n\t\tsio->type = f81865;\n\t\tbreak;\n\tcase SIO_NCT6126D_ID:\n\t\tsio->device = SIO_LD_GPIO_NUVOTON;\n\t\tsio->type = nct6126d;\n\t\tbreak;\n\tdefault:\n\t\tpr_info(\"Unsupported Fintek device 0x%04x\\n\", devid);\n\t\tgoto err;\n\t}\n\n\t \n\tif (sio->type != nct6126d) {\n\t\tmanid = superio_inw(addr, SIO_FINTEK_MANID);\n\t\tif (manid != SIO_FINTEK_ID) {\n\t\t\tpr_debug(\"Not a Fintek device at 0x%08x\\n\", addr);\n\t\t\tgoto err;\n\t\t}\n\t}\n\n\tsio->addr = addr;\n\terr = 0;\n\n\tpr_info(\"Found %s at %#x\\n\", f7188x_names[sio->type], (unsigned int)addr);\n\tif (sio->type != nct6126d)\n\t\tpr_info(\"   revision %d\\n\", superio_inb(addr, SIO_FINTEK_DEVREV));\n\nerr:\n\tsuperio_exit(addr);\n\treturn err;\n}\n\nstatic struct platform_device *f7188x_gpio_pdev;\n\nstatic int __init\nf7188x_gpio_device_add(const struct f7188x_sio *sio)\n{\n\tint err;\n\n\tf7188x_gpio_pdev = platform_device_alloc(DRVNAME, -1);\n\tif (!f7188x_gpio_pdev)\n\t\treturn -ENOMEM;\n\n\terr = platform_device_add_data(f7188x_gpio_pdev,\n\t\t\t\t       sio, sizeof(*sio));\n\tif (err) {\n\t\tpr_err(\"Platform data allocation failed\\n\");\n\t\tgoto err;\n\t}\n\n\terr = platform_device_add(f7188x_gpio_pdev);\n\tif (err) {\n\t\tpr_err(\"Device addition failed\\n\");\n\t\tgoto err;\n\t}\n\n\treturn 0;\n\nerr:\n\tplatform_device_put(f7188x_gpio_pdev);\n\n\treturn err;\n}\n\n \n\nstatic struct platform_driver f7188x_gpio_driver = {\n\t.driver = {\n\t\t.name\t= DRVNAME,\n\t},\n\t.probe\t\t= f7188x_gpio_probe,\n};\n\nstatic int __init f7188x_gpio_init(void)\n{\n\tint err;\n\tstruct f7188x_sio sio;\n\n\tif (f7188x_find(0x2e, &sio) &&\n\t    f7188x_find(0x4e, &sio))\n\t\treturn -ENODEV;\n\n\terr = platform_driver_register(&f7188x_gpio_driver);\n\tif (!err) {\n\t\terr = f7188x_gpio_device_add(&sio);\n\t\tif (err)\n\t\t\tplatform_driver_unregister(&f7188x_gpio_driver);\n\t}\n\n\treturn err;\n}\nsubsys_initcall(f7188x_gpio_init);\n\nstatic void __exit f7188x_gpio_exit(void)\n{\n\tplatform_device_unregister(f7188x_gpio_pdev);\n\tplatform_driver_unregister(&f7188x_gpio_driver);\n}\nmodule_exit(f7188x_gpio_exit);\n\nMODULE_DESCRIPTION(\"GPIO driver for Super-I/O chips F71869, F71869A, F71882FG, F71889A, F71889F and F81866\");\nMODULE_AUTHOR(\"Simon Guinot <simon.guinot@sequanux.org>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}