{
  "module_name": "gpio-tpic2810.c",
  "hash_id": "d8e591a549bd389c4a5d274105292184d51829a3436cd6dabe38cdec3ff310e5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-tpic2810.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/driver.h>\n#include <linux/i2c.h>\n#include <linux/module.h>\n#include <linux/mutex.h>\n\n#define TPIC2810_WS_COMMAND 0x44\n\n \nstruct tpic2810 {\n\tstruct gpio_chip chip;\n\tstruct i2c_client *client;\n\tu8 buffer;\n\tstruct mutex lock;\n};\n\nstatic void tpic2810_set(struct gpio_chip *chip, unsigned offset, int value);\n\nstatic int tpic2810_get_direction(struct gpio_chip *chip,\n\t\t\t\t  unsigned offset)\n{\n\t \n\treturn GPIO_LINE_DIRECTION_OUT;\n}\n\nstatic int tpic2810_direction_input(struct gpio_chip *chip,\n\t\t\t\t    unsigned offset)\n{\n\t \n\treturn -EINVAL;\n}\n\nstatic int tpic2810_direction_output(struct gpio_chip *chip,\n\t\t\t\t     unsigned offset, int value)\n{\n\t \n\ttpic2810_set(chip, offset, value);\n\treturn 0;\n}\n\nstatic void tpic2810_set_mask_bits(struct gpio_chip *chip, u8 mask, u8 bits)\n{\n\tstruct tpic2810 *gpio = gpiochip_get_data(chip);\n\tu8 buffer;\n\tint err;\n\n\tmutex_lock(&gpio->lock);\n\n\tbuffer = gpio->buffer & ~mask;\n\tbuffer |= (mask & bits);\n\n\terr = i2c_smbus_write_byte_data(gpio->client, TPIC2810_WS_COMMAND,\n\t\t\t\t\tbuffer);\n\tif (!err)\n\t\tgpio->buffer = buffer;\n\n\tmutex_unlock(&gpio->lock);\n}\n\nstatic void tpic2810_set(struct gpio_chip *chip, unsigned offset, int value)\n{\n\ttpic2810_set_mask_bits(chip, BIT(offset), value ? BIT(offset) : 0);\n}\n\nstatic void tpic2810_set_multiple(struct gpio_chip *chip, unsigned long *mask,\n\t\t\t\t  unsigned long *bits)\n{\n\ttpic2810_set_mask_bits(chip, *mask, *bits);\n}\n\nstatic const struct gpio_chip template_chip = {\n\t.label\t\t\t= \"tpic2810\",\n\t.owner\t\t\t= THIS_MODULE,\n\t.get_direction\t\t= tpic2810_get_direction,\n\t.direction_input\t= tpic2810_direction_input,\n\t.direction_output\t= tpic2810_direction_output,\n\t.set\t\t\t= tpic2810_set,\n\t.set_multiple\t\t= tpic2810_set_multiple,\n\t.base\t\t\t= -1,\n\t.ngpio\t\t\t= 8,\n\t.can_sleep\t\t= true,\n};\n\nstatic const struct of_device_id tpic2810_of_match_table[] = {\n\t{ .compatible = \"ti,tpic2810\" },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, tpic2810_of_match_table);\n\nstatic int tpic2810_probe(struct i2c_client *client)\n{\n\tstruct tpic2810 *gpio;\n\n\tgpio = devm_kzalloc(&client->dev, sizeof(*gpio), GFP_KERNEL);\n\tif (!gpio)\n\t\treturn -ENOMEM;\n\n\tgpio->chip = template_chip;\n\tgpio->chip.parent = &client->dev;\n\n\tgpio->client = client;\n\n\tmutex_init(&gpio->lock);\n\n\treturn devm_gpiochip_add_data(&client->dev, &gpio->chip, gpio);\n}\n\nstatic const struct i2c_device_id tpic2810_id_table[] = {\n\t{ \"tpic2810\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(i2c, tpic2810_id_table);\n\nstatic struct i2c_driver tpic2810_driver = {\n\t.driver = {\n\t\t.name = \"tpic2810\",\n\t\t.of_match_table = tpic2810_of_match_table,\n\t},\n\t.probe = tpic2810_probe,\n\t.id_table = tpic2810_id_table,\n};\nmodule_i2c_driver(tpic2810_driver);\n\nMODULE_AUTHOR(\"Andrew Davis <afd@ti.com>\");\nMODULE_DESCRIPTION(\"TPIC2810 8-Bit LED Driver GPIO Driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}