{
  "module_name": "gpio-msc313.c",
  "hash_id": "3a8441e6cf146daf1d0b9a0364427848ff03fcafcf40acde9b30f82ffcc7ce6f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-msc313.c",
  "human_readable_source": "\n \n\n#include <linux/bitops.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_irq.h>\n#include <linux/gpio/driver.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <dt-bindings/gpio/msc313-gpio.h>\n#include <dt-bindings/interrupt-controller/arm-gic.h>\n\n#define DRIVER_NAME \"gpio-msc313\"\n\n#define MSC313_GPIO_IN  BIT(0)\n#define MSC313_GPIO_OUT BIT(4)\n#define MSC313_GPIO_OEN BIT(5)\n\n \n#define MSC313_GPIO_BITSTOSAVE (MSC313_GPIO_OUT | MSC313_GPIO_OEN)\n\n \n#define MSC313_PINNAME_FUART_RX\t\t\"fuart_rx\"\n#define MSC313_PINNAME_FUART_TX\t\t\"fuart_tx\"\n#define MSC313_PINNAME_FUART_CTS\t\"fuart_cts\"\n#define MSC313_PINNAME_FUART_RTS\t\"fuart_rts\"\n\n \n#define MSC313_PINNAME_SR_IO2\t\t\"sr_io2\"\n#define MSC313_PINNAME_SR_IO3\t\t\"sr_io3\"\n#define MSC313_PINNAME_SR_IO4\t\t\"sr_io4\"\n#define MSC313_PINNAME_SR_IO5\t\t\"sr_io5\"\n#define MSC313_PINNAME_SR_IO6\t\t\"sr_io6\"\n#define MSC313_PINNAME_SR_IO7\t\t\"sr_io7\"\n#define MSC313_PINNAME_SR_IO8\t\t\"sr_io8\"\n#define MSC313_PINNAME_SR_IO9\t\t\"sr_io9\"\n#define MSC313_PINNAME_SR_IO10\t\t\"sr_io10\"\n#define MSC313_PINNAME_SR_IO11\t\t\"sr_io11\"\n#define MSC313_PINNAME_SR_IO12\t\t\"sr_io12\"\n#define MSC313_PINNAME_SR_IO13\t\t\"sr_io13\"\n#define MSC313_PINNAME_SR_IO14\t\t\"sr_io14\"\n#define MSC313_PINNAME_SR_IO15\t\t\"sr_io15\"\n#define MSC313_PINNAME_SR_IO16\t\t\"sr_io16\"\n#define MSC313_PINNAME_SR_IO17\t\t\"sr_io17\"\n\n \n#define MSC313_PINNAME_SD_CLK\t\t\"sd_clk\"\n#define MSC313_PINNAME_SD_CMD\t\t\"sd_cmd\"\n#define MSC313_PINNAME_SD_D0\t\t\"sd_d0\"\n#define MSC313_PINNAME_SD_D1\t\t\"sd_d1\"\n#define MSC313_PINNAME_SD_D2\t\t\"sd_d2\"\n#define MSC313_PINNAME_SD_D3\t\t\"sd_d3\"\n\n \n#define MSC313_PINNAME_I2C1_SCL\t\t\"i2c1_scl\"\n#define MSC313_PINNAME_I2C1_SCA\t\t\"i2c1_sda\"\n\n \n#define MSC313_PINNAME_SPI0_CZ\t\t\"spi0_cz\"\n#define MSC313_PINNAME_SPI0_CK\t\t\"spi0_ck\"\n#define MSC313_PINNAME_SPI0_DI\t\t\"spi0_di\"\n#define MSC313_PINNAME_SPI0_DO\t\t\"spi0_do\"\n\n#define FUART_NAMES\t\t\t\\\n\tMSC313_PINNAME_FUART_RX,\t\\\n\tMSC313_PINNAME_FUART_TX,\t\\\n\tMSC313_PINNAME_FUART_CTS,\t\\\n\tMSC313_PINNAME_FUART_RTS\n\n#define OFF_FUART_RX\t0x50\n#define OFF_FUART_TX\t0x54\n#define OFF_FUART_CTS\t0x58\n#define OFF_FUART_RTS\t0x5c\n\n#define FUART_OFFSETS\t\\\n\tOFF_FUART_RX,\t\\\n\tOFF_FUART_TX,\t\\\n\tOFF_FUART_CTS,\t\\\n\tOFF_FUART_RTS\n\n#define SR_NAMES\t\t\\\n\tMSC313_PINNAME_SR_IO2,\t\\\n\tMSC313_PINNAME_SR_IO3,\t\\\n\tMSC313_PINNAME_SR_IO4,\t\\\n\tMSC313_PINNAME_SR_IO5,\t\\\n\tMSC313_PINNAME_SR_IO6,\t\\\n\tMSC313_PINNAME_SR_IO7,\t\\\n\tMSC313_PINNAME_SR_IO8,\t\\\n\tMSC313_PINNAME_SR_IO9,\t\\\n\tMSC313_PINNAME_SR_IO10,\t\\\n\tMSC313_PINNAME_SR_IO11,\t\\\n\tMSC313_PINNAME_SR_IO12,\t\\\n\tMSC313_PINNAME_SR_IO13,\t\\\n\tMSC313_PINNAME_SR_IO14,\t\\\n\tMSC313_PINNAME_SR_IO15,\t\\\n\tMSC313_PINNAME_SR_IO16,\t\\\n\tMSC313_PINNAME_SR_IO17\n\n#define OFF_SR_IO2\t0x88\n#define OFF_SR_IO3\t0x8c\n#define OFF_SR_IO4\t0x90\n#define OFF_SR_IO5\t0x94\n#define OFF_SR_IO6\t0x98\n#define OFF_SR_IO7\t0x9c\n#define OFF_SR_IO8\t0xa0\n#define OFF_SR_IO9\t0xa4\n#define OFF_SR_IO10\t0xa8\n#define OFF_SR_IO11\t0xac\n#define OFF_SR_IO12\t0xb0\n#define OFF_SR_IO13\t0xb4\n#define OFF_SR_IO14\t0xb8\n#define OFF_SR_IO15\t0xbc\n#define OFF_SR_IO16\t0xc0\n#define OFF_SR_IO17\t0xc4\n\n#define SR_OFFSETS\t\\\n\tOFF_SR_IO2,\t\\\n\tOFF_SR_IO3,\t\\\n\tOFF_SR_IO4,\t\\\n\tOFF_SR_IO5,\t\\\n\tOFF_SR_IO6,\t\\\n\tOFF_SR_IO7,\t\\\n\tOFF_SR_IO8,\t\\\n\tOFF_SR_IO9,\t\\\n\tOFF_SR_IO10,\t\\\n\tOFF_SR_IO11,\t\\\n\tOFF_SR_IO12,\t\\\n\tOFF_SR_IO13,\t\\\n\tOFF_SR_IO14,\t\\\n\tOFF_SR_IO15,\t\\\n\tOFF_SR_IO16,\t\\\n\tOFF_SR_IO17\n\n#define SD_NAMES\t\t\\\n\tMSC313_PINNAME_SD_CLK,\t\\\n\tMSC313_PINNAME_SD_CMD,\t\\\n\tMSC313_PINNAME_SD_D0,\t\\\n\tMSC313_PINNAME_SD_D1,\t\\\n\tMSC313_PINNAME_SD_D2,\t\\\n\tMSC313_PINNAME_SD_D3\n\n#define OFF_SD_CLK\t0x140\n#define OFF_SD_CMD\t0x144\n#define OFF_SD_D0\t0x148\n#define OFF_SD_D1\t0x14c\n#define OFF_SD_D2\t0x150\n#define OFF_SD_D3\t0x154\n\n#define SD_OFFSETS\t\\\n\tOFF_SD_CLK,\t\\\n\tOFF_SD_CMD,\t\\\n\tOFF_SD_D0,\t\\\n\tOFF_SD_D1,\t\\\n\tOFF_SD_D2,\t\\\n\tOFF_SD_D3\n\n#define I2C1_NAMES\t\t\t\\\n\tMSC313_PINNAME_I2C1_SCL,\t\\\n\tMSC313_PINNAME_I2C1_SCA\n\n#define OFF_I2C1_SCL\t0x188\n#define OFF_I2C1_SCA\t0x18c\n\n#define I2C1_OFFSETS\t\\\n\tOFF_I2C1_SCL,\t\\\n\tOFF_I2C1_SCA\n\n#define SPI0_NAMES\t\t\\\n\tMSC313_PINNAME_SPI0_CZ,\t\\\n\tMSC313_PINNAME_SPI0_CK,\t\\\n\tMSC313_PINNAME_SPI0_DI,\t\\\n\tMSC313_PINNAME_SPI0_DO\n\n#define OFF_SPI0_CZ\t0x1c0\n#define OFF_SPI0_CK\t0x1c4\n#define OFF_SPI0_DI\t0x1c8\n#define OFF_SPI0_DO\t0x1cc\n\n#define SPI0_OFFSETS\t\\\n\tOFF_SPI0_CZ,\t\\\n\tOFF_SPI0_CK,\t\\\n\tOFF_SPI0_DI,\t\\\n\tOFF_SPI0_DO\n\nstruct msc313_gpio_data {\n\tconst char * const *names;\n\tconst unsigned int *offsets;\n\tconst unsigned int num;\n};\n\n#define MSC313_GPIO_CHIPDATA(_chip) \\\nstatic const struct msc313_gpio_data _chip##_data = { \\\n\t.names = _chip##_names, \\\n\t.offsets = _chip##_offsets, \\\n\t.num = ARRAY_SIZE(_chip##_offsets), \\\n}\n\n#ifdef CONFIG_MACH_INFINITY\nstatic const char * const msc313_names[] = {\n\tFUART_NAMES,\n\tSR_NAMES,\n\tSD_NAMES,\n\tI2C1_NAMES,\n\tSPI0_NAMES,\n};\n\nstatic const unsigned int msc313_offsets[] = {\n\tFUART_OFFSETS,\n\tSR_OFFSETS,\n\tSD_OFFSETS,\n\tI2C1_OFFSETS,\n\tSPI0_OFFSETS,\n};\n\nMSC313_GPIO_CHIPDATA(msc313);\n\n \n#define SSD20XD_PINNAME_GPIO0\t\t\"gpio0\"\n#define SSD20XD_PINNAME_GPIO1\t\t\"gpio1\"\n#define SSD20XD_PINNAME_GPIO2\t\t\"gpio2\"\n#define SSD20XD_PINNAME_GPIO3\t\t\"gpio3\"\n#define SSD20XD_PINNAME_GPIO4\t\t\"gpio4\"\n#define SSD20XD_PINNAME_GPIO5\t\t\"gpio5\"\n#define SSD20XD_PINNAME_GPIO6\t\t\"gpio6\"\n#define SSD20XD_PINNAME_GPIO7\t\t\"gpio7\"\n#define SSD20XD_PINNAME_GPIO10\t\t\"gpio10\"\n#define SSD20XD_PINNAME_GPIO11\t\t\"gpio11\"\n#define SSD20XD_PINNAME_GPIO12\t\t\"gpio12\"\n#define SSD20XD_PINNAME_GPIO13\t\t\"gpio13\"\n#define SSD20XD_PINNAME_GPIO14\t\t\"gpio14\"\n#define SSD20XD_PINNAME_GPIO85\t\t\"gpio85\"\n#define SSD20XD_PINNAME_GPIO86\t\t\"gpio86\"\n#define SSD20XD_PINNAME_GPIO90\t\t\"gpio90\"\n\n#define SSD20XD_GPIO_NAMES SSD20XD_PINNAME_GPIO0,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO1,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO2,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO3,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO4,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO5,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO6,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO7,  \\\n\t\t\t   SSD20XD_PINNAME_GPIO10, \\\n\t\t\t   SSD20XD_PINNAME_GPIO11, \\\n\t\t\t   SSD20XD_PINNAME_GPIO12, \\\n\t\t\t   SSD20XD_PINNAME_GPIO13, \\\n\t\t\t   SSD20XD_PINNAME_GPIO14, \\\n\t\t\t   SSD20XD_PINNAME_GPIO85, \\\n\t\t\t   SSD20XD_PINNAME_GPIO86, \\\n\t\t\t   SSD20XD_PINNAME_GPIO90\n\n#define SSD20XD_GPIO_OFF_GPIO0 0x0\n#define SSD20XD_GPIO_OFF_GPIO1 0x4\n#define SSD20XD_GPIO_OFF_GPIO2 0x8\n#define SSD20XD_GPIO_OFF_GPIO3 0xc\n#define SSD20XD_GPIO_OFF_GPIO4 0x10\n#define SSD20XD_GPIO_OFF_GPIO5 0x14\n#define SSD20XD_GPIO_OFF_GPIO6 0x18\n#define SSD20XD_GPIO_OFF_GPIO7 0x1c\n#define SSD20XD_GPIO_OFF_GPIO10 0x28\n#define SSD20XD_GPIO_OFF_GPIO11 0x2c\n#define SSD20XD_GPIO_OFF_GPIO12 0x30\n#define SSD20XD_GPIO_OFF_GPIO13 0x34\n#define SSD20XD_GPIO_OFF_GPIO14 0x38\n#define SSD20XD_GPIO_OFF_GPIO85 0x100\n#define SSD20XD_GPIO_OFF_GPIO86 0x104\n#define SSD20XD_GPIO_OFF_GPIO90 0x114\n\n#define SSD20XD_GPIO_OFFSETS SSD20XD_GPIO_OFF_GPIO0,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO1,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO2,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO3,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO4,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO5,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO6,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO7,  \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO10, \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO11, \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO12, \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO13, \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO14, \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO85, \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO86, \\\n\t\t\t     SSD20XD_GPIO_OFF_GPIO90\n\n \n#define SSD20XD_PINNAME_TTL0\t\"ttl0\"\n#define SSD20XD_PINNAME_TTL1\t\"ttl1\"\n#define SSD20XD_PINNAME_TTL2\t\"ttl2\"\n#define SSD20XD_PINNAME_TTL3\t\"ttl3\"\n#define SSD20XD_PINNAME_TTL4\t\"ttl4\"\n#define SSD20XD_PINNAME_TTL5\t\"ttl5\"\n#define SSD20XD_PINNAME_TTL6\t\"ttl6\"\n#define SSD20XD_PINNAME_TTL7\t\"ttl7\"\n#define SSD20XD_PINNAME_TTL8\t\"ttl8\"\n#define SSD20XD_PINNAME_TTL9\t\"ttl9\"\n#define SSD20XD_PINNAME_TTL10\t\"ttl10\"\n#define SSD20XD_PINNAME_TTL11\t\"ttl11\"\n#define SSD20XD_PINNAME_TTL12\t\"ttl12\"\n#define SSD20XD_PINNAME_TTL13\t\"ttl13\"\n#define SSD20XD_PINNAME_TTL14\t\"ttl14\"\n#define SSD20XD_PINNAME_TTL15\t\"ttl15\"\n#define SSD20XD_PINNAME_TTL16\t\"ttl16\"\n#define SSD20XD_PINNAME_TTL17\t\"ttl17\"\n#define SSD20XD_PINNAME_TTL18\t\"ttl18\"\n#define SSD20XD_PINNAME_TTL19\t\"ttl19\"\n#define SSD20XD_PINNAME_TTL20\t\"ttl20\"\n#define SSD20XD_PINNAME_TTL21\t\"ttl21\"\n#define SSD20XD_PINNAME_TTL22\t\"ttl22\"\n#define SSD20XD_PINNAME_TTL23\t\"ttl23\"\n#define SSD20XD_PINNAME_TTL24\t\"ttl24\"\n#define SSD20XD_PINNAME_TTL25\t\"ttl25\"\n#define SSD20XD_PINNAME_TTL26\t\"ttl26\"\n#define SSD20XD_PINNAME_TTL27\t\"ttl27\"\n\n#define SSD20XD_TTL_PINNAMES SSD20XD_PINNAME_TTL0,  \\\n\t\t\t     SSD20XD_PINNAME_TTL1,  \\\n\t\t\t     SSD20XD_PINNAME_TTL2,  \\\n\t\t\t     SSD20XD_PINNAME_TTL3,  \\\n\t\t\t     SSD20XD_PINNAME_TTL4,  \\\n\t\t\t     SSD20XD_PINNAME_TTL5,  \\\n\t\t\t     SSD20XD_PINNAME_TTL6,  \\\n\t\t\t     SSD20XD_PINNAME_TTL7,  \\\n\t\t\t     SSD20XD_PINNAME_TTL8,  \\\n\t\t\t     SSD20XD_PINNAME_TTL9,  \\\n\t\t\t     SSD20XD_PINNAME_TTL10, \\\n\t\t\t     SSD20XD_PINNAME_TTL11, \\\n\t\t\t     SSD20XD_PINNAME_TTL12, \\\n\t\t\t     SSD20XD_PINNAME_TTL13, \\\n\t\t\t     SSD20XD_PINNAME_TTL14, \\\n\t\t\t     SSD20XD_PINNAME_TTL15, \\\n\t\t\t     SSD20XD_PINNAME_TTL16, \\\n\t\t\t     SSD20XD_PINNAME_TTL17, \\\n\t\t\t     SSD20XD_PINNAME_TTL18, \\\n\t\t\t     SSD20XD_PINNAME_TTL19, \\\n\t\t\t     SSD20XD_PINNAME_TTL20, \\\n\t\t\t     SSD20XD_PINNAME_TTL21, \\\n\t\t\t     SSD20XD_PINNAME_TTL22, \\\n\t\t\t     SSD20XD_PINNAME_TTL23, \\\n\t\t\t     SSD20XD_PINNAME_TTL24, \\\n\t\t\t     SSD20XD_PINNAME_TTL25, \\\n\t\t\t     SSD20XD_PINNAME_TTL26, \\\n\t\t\t     SSD20XD_PINNAME_TTL27\n\n#define SSD20XD_TTL_OFFSET_TTL0\t\t0x80\n#define SSD20XD_TTL_OFFSET_TTL1\t\t0x84\n#define SSD20XD_TTL_OFFSET_TTL2\t\t0x88\n#define SSD20XD_TTL_OFFSET_TTL3\t\t0x8c\n#define SSD20XD_TTL_OFFSET_TTL4\t\t0x90\n#define SSD20XD_TTL_OFFSET_TTL5\t\t0x94\n#define SSD20XD_TTL_OFFSET_TTL6\t\t0x98\n#define SSD20XD_TTL_OFFSET_TTL7\t\t0x9c\n#define SSD20XD_TTL_OFFSET_TTL8\t\t0xa0\n#define SSD20XD_TTL_OFFSET_TTL9\t\t0xa4\n#define SSD20XD_TTL_OFFSET_TTL10\t0xa8\n#define SSD20XD_TTL_OFFSET_TTL11\t0xac\n#define SSD20XD_TTL_OFFSET_TTL12\t0xb0\n#define SSD20XD_TTL_OFFSET_TTL13\t0xb4\n#define SSD20XD_TTL_OFFSET_TTL14\t0xb8\n#define SSD20XD_TTL_OFFSET_TTL15\t0xbc\n#define SSD20XD_TTL_OFFSET_TTL16\t0xc0\n#define SSD20XD_TTL_OFFSET_TTL17\t0xc4\n#define SSD20XD_TTL_OFFSET_TTL18\t0xc8\n#define SSD20XD_TTL_OFFSET_TTL19\t0xcc\n#define SSD20XD_TTL_OFFSET_TTL20\t0xd0\n#define SSD20XD_TTL_OFFSET_TTL21\t0xd4\n#define SSD20XD_TTL_OFFSET_TTL22\t0xd8\n#define SSD20XD_TTL_OFFSET_TTL23\t0xdc\n#define SSD20XD_TTL_OFFSET_TTL24\t0xe0\n#define SSD20XD_TTL_OFFSET_TTL25\t0xe4\n#define SSD20XD_TTL_OFFSET_TTL26\t0xe8\n#define SSD20XD_TTL_OFFSET_TTL27\t0xec\n\n#define SSD20XD_TTL_OFFSETS SSD20XD_TTL_OFFSET_TTL0,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL1,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL2,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL3,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL4,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL5,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL6,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL7,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL8,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL9,  \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL10, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL11, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL12, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL13, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL14, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL15, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL16, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL17, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL18, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL19, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL20, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL21, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL22, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL23, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL24, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL25, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL26, \\\n\t\t\t    SSD20XD_TTL_OFFSET_TTL27\n\n \n#define SSD20XD_PINNAME_UART0_RX\t\"uart0_rx\"\n#define SSD20XD_PINNAME_UART0_TX\t\"uart0_tx\"\n\n#define SSD20XD_UART0_NAMES\t  \\\n\tSSD20XD_PINNAME_UART0_RX, \\\n\tSSD20XD_PINNAME_UART0_TX\n\n#define SSD20XD_PINNAME_UART1_RX\t\"uart1_rx\"\n#define SSD20XD_PINNAME_UART1_TX\t\"uart1_tx\"\n\n#define SSD20XD_UART1_NAMES\t  \\\n\tSSD20XD_PINNAME_UART1_RX, \\\n\tSSD20XD_PINNAME_UART1_TX\n\n#define SSD20XD_OFF_UART0_RX\t0x60\n#define SSD20XD_OFF_UART0_TX\t0x64\n\n#define SSD20XD_UART0_OFFSETS \\\n\tSSD20XD_OFF_UART0_RX, \\\n\tSSD20XD_OFF_UART0_TX\n\n#define SSD20XD_OFF_UART1_RX\t0x68\n#define SSD20XD_OFF_UART1_TX\t0x6c\n\n#define SSD20XD_UART1_OFFSETS \\\n\tSSD20XD_OFF_UART1_RX, \\\n\tSSD20XD_OFF_UART1_TX\n\n \n#define SSD20XD_OFF_SD_D0\t0x140\n#define SSD20XD_OFF_SD_D1\t0x144\n#define SSD20XD_OFF_SD_D2\t0x148\n#define SSD20XD_OFF_SD_D3\t0x14c\n#define SSD20XD_OFF_SD_CMD\t0x150\n#define SSD20XD_OFF_SD_CLK\t0x154\n\n#define SSD20XD_SD_OFFSETS\tSSD20XD_OFF_SD_CLK, \\\n\t\t\t\tSSD20XD_OFF_SD_CMD, \\\n\t\t\t\tSSD20XD_OFF_SD_D0,  \\\n\t\t\t\tSSD20XD_OFF_SD_D1,  \\\n\t\t\t\tSSD20XD_OFF_SD_D2,  \\\n\t\t\t\tSSD20XD_OFF_SD_D3\n\nstatic const char * const ssd20xd_names[] = {\n\tFUART_NAMES,\n\tSD_NAMES,\n\tSSD20XD_UART0_NAMES,\n\tSSD20XD_UART1_NAMES,\n\tSSD20XD_TTL_PINNAMES,\n\tSSD20XD_GPIO_NAMES,\n};\n\nstatic const unsigned int ssd20xd_offsets[] = {\n\tFUART_OFFSETS,\n\tSSD20XD_SD_OFFSETS,\n\tSSD20XD_UART0_OFFSETS,\n\tSSD20XD_UART1_OFFSETS,\n\tSSD20XD_TTL_OFFSETS,\n\tSSD20XD_GPIO_OFFSETS,\n};\n\nMSC313_GPIO_CHIPDATA(ssd20xd);\n#endif\n\nstruct msc313_gpio {\n\tvoid __iomem *base;\n\tconst struct msc313_gpio_data *gpio_data;\n\tu8 *saved;\n};\n\nstatic void msc313_gpio_set(struct gpio_chip *chip, unsigned int offset, int value)\n{\n\tstruct msc313_gpio *gpio = gpiochip_get_data(chip);\n\tu8 gpioreg = readb_relaxed(gpio->base + gpio->gpio_data->offsets[offset]);\n\n\tif (value)\n\t\tgpioreg |= MSC313_GPIO_OUT;\n\telse\n\t\tgpioreg &= ~MSC313_GPIO_OUT;\n\n\twriteb_relaxed(gpioreg, gpio->base + gpio->gpio_data->offsets[offset]);\n}\n\nstatic int msc313_gpio_get(struct gpio_chip *chip, unsigned int offset)\n{\n\tstruct msc313_gpio *gpio = gpiochip_get_data(chip);\n\n\treturn readb_relaxed(gpio->base + gpio->gpio_data->offsets[offset]) & MSC313_GPIO_IN;\n}\n\nstatic int msc313_gpio_direction_input(struct gpio_chip *chip, unsigned int offset)\n{\n\tstruct msc313_gpio *gpio = gpiochip_get_data(chip);\n\tu8 gpioreg = readb_relaxed(gpio->base + gpio->gpio_data->offsets[offset]);\n\n\tgpioreg |= MSC313_GPIO_OEN;\n\twriteb_relaxed(gpioreg, gpio->base + gpio->gpio_data->offsets[offset]);\n\n\treturn 0;\n}\n\nstatic int msc313_gpio_direction_output(struct gpio_chip *chip, unsigned int offset, int value)\n{\n\tstruct msc313_gpio *gpio = gpiochip_get_data(chip);\n\tu8 gpioreg = readb_relaxed(gpio->base + gpio->gpio_data->offsets[offset]);\n\n\tgpioreg &= ~MSC313_GPIO_OEN;\n\tif (value)\n\t\tgpioreg |= MSC313_GPIO_OUT;\n\telse\n\t\tgpioreg &= ~MSC313_GPIO_OUT;\n\twriteb_relaxed(gpioreg, gpio->base + gpio->gpio_data->offsets[offset]);\n\n\treturn 0;\n}\n\nstatic void msc313_gpio_irq_mask(struct irq_data *d)\n{\n\tstruct gpio_chip *gc = irq_data_get_irq_chip_data(d);\n\n\tirq_chip_mask_parent(d);\n\tgpiochip_disable_irq(gc, d->hwirq);\n}\n\nstatic void msc313_gpio_irq_unmask(struct irq_data *d)\n{\n\tstruct gpio_chip *gc = irq_data_get_irq_chip_data(d);\n\n\tgpiochip_enable_irq(gc, d->hwirq);\n\tirq_chip_unmask_parent(d);\n}\n\n \nstatic const struct irq_chip msc313_gpio_irqchip = {\n\t.name = \"GPIO\",\n\t.irq_eoi = irq_chip_eoi_parent,\n\t.irq_mask = msc313_gpio_irq_mask,\n\t.irq_unmask = msc313_gpio_irq_unmask,\n\t.irq_set_type = irq_chip_set_type_parent,\n\t.irq_set_affinity = irq_chip_set_affinity_parent,\n\t.flags = IRQCHIP_IMMUTABLE,\n\tGPIOCHIP_IRQ_RESOURCE_HELPERS,\n};\n\n \nstatic int msc313_gpio_populate_parent_fwspec(struct gpio_chip *gc,\n\t\t\t\t\t      union gpio_irq_fwspec *gfwspec,\n\t\t\t\t\t      unsigned int parent_hwirq,\n\t\t\t\t\t      unsigned int parent_type)\n{\n\tstruct irq_fwspec *fwspec = &gfwspec->fwspec;\n\n\tfwspec->fwnode = gc->irq.parent_domain->fwnode;\n\tfwspec->param_count = 3;\n\tfwspec->param[0] = GIC_SPI;\n\tfwspec->param[1] = parent_hwirq;\n\tfwspec->param[2] = parent_type;\n\n\treturn 0;\n}\n\nstatic int msc313e_gpio_child_to_parent_hwirq(struct gpio_chip *chip,\n\t\t\t\t\t     unsigned int child,\n\t\t\t\t\t     unsigned int child_type,\n\t\t\t\t\t     unsigned int *parent,\n\t\t\t\t\t     unsigned int *parent_type)\n{\n\tstruct msc313_gpio *priv = gpiochip_get_data(chip);\n\tunsigned int offset = priv->gpio_data->offsets[child];\n\n\t \n\tif (offset >= OFF_SPI0_CZ && offset <= OFF_SPI0_DO) {\n\t\t*parent_type = child_type;\n\t\t*parent = ((offset - OFF_SPI0_CZ) >> 2) + 28;\n\t\treturn 0;\n\t}\n\n\treturn -EINVAL;\n}\n\nstatic int msc313_gpio_probe(struct platform_device *pdev)\n{\n\tconst struct msc313_gpio_data *match_data;\n\tstruct msc313_gpio *gpio;\n\tstruct gpio_chip *gpiochip;\n\tstruct gpio_irq_chip *gpioirqchip;\n\tstruct irq_domain *parent_domain;\n\tstruct device_node *parent_node;\n\tstruct device *dev = &pdev->dev;\n\n\tmatch_data = of_device_get_match_data(dev);\n\tif (!match_data)\n\t\treturn -EINVAL;\n\n\tparent_node = of_irq_find_parent(dev->of_node);\n\tif (!parent_node)\n\t\treturn -ENODEV;\n\n\tparent_domain = irq_find_host(parent_node);\n\tif (!parent_domain)\n\t\treturn -ENODEV;\n\n\tgpio = devm_kzalloc(dev, sizeof(*gpio), GFP_KERNEL);\n\tif (!gpio)\n\t\treturn -ENOMEM;\n\n\tgpio->gpio_data = match_data;\n\n\tgpio->saved = devm_kcalloc(dev, gpio->gpio_data->num, sizeof(*gpio->saved), GFP_KERNEL);\n\tif (!gpio->saved)\n\t\treturn -ENOMEM;\n\n\tgpio->base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(gpio->base))\n\t\treturn PTR_ERR(gpio->base);\n\n\tplatform_set_drvdata(pdev, gpio);\n\n\tgpiochip = devm_kzalloc(dev, sizeof(*gpiochip), GFP_KERNEL);\n\tif (!gpiochip)\n\t\treturn -ENOMEM;\n\n\tgpiochip->label = DRIVER_NAME;\n\tgpiochip->parent = dev;\n\tgpiochip->request = gpiochip_generic_request;\n\tgpiochip->free = gpiochip_generic_free;\n\tgpiochip->direction_input = msc313_gpio_direction_input;\n\tgpiochip->direction_output = msc313_gpio_direction_output;\n\tgpiochip->get = msc313_gpio_get;\n\tgpiochip->set = msc313_gpio_set;\n\tgpiochip->base = -1;\n\tgpiochip->ngpio = gpio->gpio_data->num;\n\tgpiochip->names = gpio->gpio_data->names;\n\n\tgpioirqchip = &gpiochip->irq;\n\tgpio_irq_chip_set_chip(gpioirqchip, &msc313_gpio_irqchip);\n\tgpioirqchip->fwnode = of_node_to_fwnode(dev->of_node);\n\tgpioirqchip->parent_domain = parent_domain;\n\tgpioirqchip->child_to_parent_hwirq = msc313e_gpio_child_to_parent_hwirq;\n\tgpioirqchip->populate_parent_alloc_arg = msc313_gpio_populate_parent_fwspec;\n\tgpioirqchip->handler = handle_bad_irq;\n\tgpioirqchip->default_type = IRQ_TYPE_NONE;\n\n\treturn devm_gpiochip_add_data(dev, gpiochip, gpio);\n}\n\nstatic const struct of_device_id msc313_gpio_of_match[] = {\n#ifdef CONFIG_MACH_INFINITY\n\t{\n\t\t.compatible = \"mstar,msc313-gpio\",\n\t\t.data = &msc313_data,\n\t},\n\t{\n\t\t.compatible = \"sstar,ssd20xd-gpio\",\n\t\t.data = &ssd20xd_data,\n\t},\n#endif\n\t{ }\n};\n\n \nstatic int __maybe_unused msc313_gpio_suspend(struct device *dev)\n{\n\tstruct msc313_gpio *gpio = dev_get_drvdata(dev);\n\tint i;\n\n\tfor (i = 0; i < gpio->gpio_data->num; i++)\n\t\tgpio->saved[i] = readb_relaxed(gpio->base + gpio->gpio_data->offsets[i]) & MSC313_GPIO_BITSTOSAVE;\n\n\treturn 0;\n}\n\nstatic int __maybe_unused msc313_gpio_resume(struct device *dev)\n{\n\tstruct msc313_gpio *gpio = dev_get_drvdata(dev);\n\tint i;\n\n\tfor (i = 0; i < gpio->gpio_data->num; i++)\n\t\twriteb_relaxed(gpio->saved[i], gpio->base + gpio->gpio_data->offsets[i]);\n\n\treturn 0;\n}\n\nstatic SIMPLE_DEV_PM_OPS(msc313_gpio_ops, msc313_gpio_suspend, msc313_gpio_resume);\n\nstatic struct platform_driver msc313_gpio_driver = {\n\t.driver = {\n\t\t.name = DRIVER_NAME,\n\t\t.of_match_table = msc313_gpio_of_match,\n\t\t.pm = &msc313_gpio_ops,\n\t},\n\t.probe = msc313_gpio_probe,\n};\nbuiltin_platform_driver(msc313_gpio_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}