{
  "module_name": "gpio-rc5t583.c",
  "hash_id": "06dabfa3411f89111e8518eb92b164f379bd1c71334ce593fa8ae8a7f0f4407e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-rc5t583.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/platform_device.h>\n#include <linux/device.h>\n#include <linux/gpio/driver.h>\n#include <linux/mfd/rc5t583.h>\n\nstruct rc5t583_gpio {\n\tstruct gpio_chip gpio_chip;\n\tstruct rc5t583 *rc5t583;\n};\n\nstatic int rc5t583_gpio_get(struct gpio_chip *gc, unsigned int offset)\n{\n\tstruct rc5t583_gpio *rc5t583_gpio = gpiochip_get_data(gc);\n\tstruct device *parent = rc5t583_gpio->rc5t583->dev;\n\tuint8_t val = 0;\n\tint ret;\n\n\tret = rc5t583_read(parent, RC5T583_GPIO_MON_IOIN, &val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn !!(val & BIT(offset));\n}\n\nstatic void rc5t583_gpio_set(struct gpio_chip *gc, unsigned int offset, int val)\n{\n\tstruct rc5t583_gpio *rc5t583_gpio = gpiochip_get_data(gc);\n\tstruct device *parent = rc5t583_gpio->rc5t583->dev;\n\tif (val)\n\t\trc5t583_set_bits(parent, RC5T583_GPIO_IOOUT, BIT(offset));\n\telse\n\t\trc5t583_clear_bits(parent, RC5T583_GPIO_IOOUT, BIT(offset));\n}\n\nstatic int rc5t583_gpio_dir_input(struct gpio_chip *gc, unsigned int offset)\n{\n\tstruct rc5t583_gpio *rc5t583_gpio = gpiochip_get_data(gc);\n\tstruct device *parent = rc5t583_gpio->rc5t583->dev;\n\tint ret;\n\n\tret = rc5t583_clear_bits(parent, RC5T583_GPIO_IOSEL, BIT(offset));\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\treturn rc5t583_clear_bits(parent, RC5T583_GPIO_PGSEL, BIT(offset));\n}\n\nstatic int rc5t583_gpio_dir_output(struct gpio_chip *gc, unsigned offset,\n\t\t\tint value)\n{\n\tstruct rc5t583_gpio *rc5t583_gpio = gpiochip_get_data(gc);\n\tstruct device *parent = rc5t583_gpio->rc5t583->dev;\n\tint ret;\n\n\trc5t583_gpio_set(gc, offset, value);\n\tret = rc5t583_set_bits(parent, RC5T583_GPIO_IOSEL, BIT(offset));\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\treturn rc5t583_clear_bits(parent, RC5T583_GPIO_PGSEL, BIT(offset));\n}\n\nstatic int rc5t583_gpio_to_irq(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct rc5t583_gpio *rc5t583_gpio = gpiochip_get_data(gc);\n\n\tif (offset < RC5T583_MAX_GPIO)\n\t\treturn rc5t583_gpio->rc5t583->irq_base +\n\t\t\t\tRC5T583_IRQ_GPIO0 + offset;\n\treturn -EINVAL;\n}\n\nstatic void rc5t583_gpio_free(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct rc5t583_gpio *rc5t583_gpio = gpiochip_get_data(gc);\n\tstruct device *parent = rc5t583_gpio->rc5t583->dev;\n\n\trc5t583_set_bits(parent, RC5T583_GPIO_PGSEL, BIT(offset));\n}\n\nstatic int rc5t583_gpio_probe(struct platform_device *pdev)\n{\n\tstruct rc5t583 *rc5t583 = dev_get_drvdata(pdev->dev.parent);\n\tstruct rc5t583_platform_data *pdata = dev_get_platdata(rc5t583->dev);\n\tstruct rc5t583_gpio *rc5t583_gpio;\n\n\trc5t583_gpio = devm_kzalloc(&pdev->dev, sizeof(*rc5t583_gpio),\n\t\t\t\t\tGFP_KERNEL);\n\tif (!rc5t583_gpio)\n\t\treturn -ENOMEM;\n\n\trc5t583_gpio->gpio_chip.label = \"gpio-rc5t583\",\n\trc5t583_gpio->gpio_chip.owner = THIS_MODULE,\n\trc5t583_gpio->gpio_chip.free = rc5t583_gpio_free,\n\trc5t583_gpio->gpio_chip.direction_input = rc5t583_gpio_dir_input,\n\trc5t583_gpio->gpio_chip.direction_output = rc5t583_gpio_dir_output,\n\trc5t583_gpio->gpio_chip.set = rc5t583_gpio_set,\n\trc5t583_gpio->gpio_chip.get = rc5t583_gpio_get,\n\trc5t583_gpio->gpio_chip.to_irq = rc5t583_gpio_to_irq,\n\trc5t583_gpio->gpio_chip.ngpio = RC5T583_MAX_GPIO,\n\trc5t583_gpio->gpio_chip.can_sleep = true,\n\trc5t583_gpio->gpio_chip.parent = &pdev->dev;\n\trc5t583_gpio->gpio_chip.base = -1;\n\trc5t583_gpio->rc5t583 = rc5t583;\n\n\tif (pdata && pdata->gpio_base)\n\t\trc5t583_gpio->gpio_chip.base = pdata->gpio_base;\n\n\treturn devm_gpiochip_add_data(&pdev->dev, &rc5t583_gpio->gpio_chip,\n\t\t\t\t      rc5t583_gpio);\n}\n\nstatic struct platform_driver rc5t583_gpio_driver = {\n\t.driver = {\n\t\t.name    = \"rc5t583-gpio\",\n\t},\n\t.probe\t\t= rc5t583_gpio_probe,\n};\n\nstatic int __init rc5t583_gpio_init(void)\n{\n\treturn platform_driver_register(&rc5t583_gpio_driver);\n}\nsubsys_initcall(rc5t583_gpio_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}