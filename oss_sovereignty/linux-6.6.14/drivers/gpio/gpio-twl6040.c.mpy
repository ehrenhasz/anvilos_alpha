{
  "module_name": "gpio-twl6040.c",
  "hash_id": "4ad394af237bca056febedd5bf73c9be6a9973fed0e12e1914bc724e02b31350",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-twl6040.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/kthread.h>\n#include <linux/irq.h>\n#include <linux/gpio/driver.h>\n#include <linux/platform_device.h>\n#include <linux/bitops.h>\n#include <linux/of.h>\n\n#include <linux/mfd/twl6040.h>\n\nstatic int twl6040gpo_get(struct gpio_chip *chip, unsigned offset)\n{\n\tstruct twl6040 *twl6040 = dev_get_drvdata(chip->parent->parent);\n\tint ret = 0;\n\n\tret = twl6040_reg_read(twl6040, TWL6040_REG_GPOCTL);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn !!(ret & BIT(offset));\n}\n\nstatic int twl6040gpo_get_direction(struct gpio_chip *chip, unsigned offset)\n{\n\treturn GPIO_LINE_DIRECTION_OUT;\n}\n\nstatic int twl6040gpo_direction_out(struct gpio_chip *chip, unsigned offset,\n\t\t\t\t    int value)\n{\n\t \n\treturn 0;\n}\n\nstatic void twl6040gpo_set(struct gpio_chip *chip, unsigned offset, int value)\n{\n\tstruct twl6040 *twl6040 = dev_get_drvdata(chip->parent->parent);\n\tint ret;\n\tu8 gpoctl;\n\n\tret = twl6040_reg_read(twl6040, TWL6040_REG_GPOCTL);\n\tif (ret < 0)\n\t\treturn;\n\n\tif (value)\n\t\tgpoctl = ret | BIT(offset);\n\telse\n\t\tgpoctl = ret & ~BIT(offset);\n\n\ttwl6040_reg_write(twl6040, TWL6040_REG_GPOCTL, gpoctl);\n}\n\nstatic struct gpio_chip twl6040gpo_chip = {\n\t.label\t\t\t= \"twl6040\",\n\t.owner\t\t\t= THIS_MODULE,\n\t.get\t\t\t= twl6040gpo_get,\n\t.direction_output\t= twl6040gpo_direction_out,\n\t.get_direction\t\t= twl6040gpo_get_direction,\n\t.set\t\t\t= twl6040gpo_set,\n\t.can_sleep\t\t= true,\n};\n\n \n\nstatic int gpo_twl6040_probe(struct platform_device *pdev)\n{\n\tstruct device *twl6040_core_dev = pdev->dev.parent;\n\tstruct twl6040 *twl6040 = dev_get_drvdata(twl6040_core_dev);\n\tint ret;\n\n\tdevice_set_node(&pdev->dev, dev_fwnode(pdev->dev.parent));\n\n\ttwl6040gpo_chip.base = -1;\n\n\tif (twl6040_get_revid(twl6040) < TWL6041_REV_ES2_0)\n\t\ttwl6040gpo_chip.ngpio = 3;  \n\telse\n\t\ttwl6040gpo_chip.ngpio = 1;  \n\n\ttwl6040gpo_chip.parent = &pdev->dev;\n\n\tret = devm_gpiochip_add_data(&pdev->dev, &twl6040gpo_chip, NULL);\n\tif (ret < 0) {\n\t\tdev_err(&pdev->dev, \"could not register gpiochip, %d\\n\", ret);\n\t\ttwl6040gpo_chip.ngpio = 0;\n\t}\n\n\treturn ret;\n}\n\n \nMODULE_ALIAS(\"platform:twl6040-gpo\");\n\nstatic struct platform_driver gpo_twl6040_driver = {\n\t.driver = {\n\t\t.name\t= \"twl6040-gpo\",\n\t},\n\t.probe\t\t= gpo_twl6040_probe,\n};\n\nmodule_platform_driver(gpo_twl6040_driver);\n\nMODULE_AUTHOR(\"Texas Instruments, Inc.\");\nMODULE_DESCRIPTION(\"GPO interface for TWL6040\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}