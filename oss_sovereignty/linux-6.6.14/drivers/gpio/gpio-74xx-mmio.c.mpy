{
  "module_name": "gpio-74xx-mmio.c",
  "hash_id": "22b42eade054ef7c48580c2c48d4aa3389da2908d91a856c45ebb47b89b16999",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpio/gpio-74xx-mmio.c",
  "human_readable_source": "\n \n\n#include <linux/bits.h>\n#include <linux/err.h>\n#include <linux/gpio/driver.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/property.h>\n\n#define MMIO_74XX_DIR_IN\tBIT(8)\n#define MMIO_74XX_DIR_OUT\tBIT(9)\n#define MMIO_74XX_BIT_CNT(x)\t((x) & GENMASK(7, 0))\n\nstruct mmio_74xx_gpio_priv {\n\tstruct gpio_chip\tgc;\n\tunsigned\t\tflags;\n};\n\nstatic const struct of_device_id mmio_74xx_gpio_ids[] = {\n\t{\n\t\t.compatible\t= \"ti,741g125\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_IN | 1),\n\t},\n\t{\n\t\t.compatible\t= \"ti,742g125\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_IN | 2),\n\t},\n\t{\n\t\t.compatible\t= \"ti,74125\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_IN | 4),\n\t},\n\t{\n\t\t.compatible\t= \"ti,74365\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_IN | 6),\n\t},\n\t{\n\t\t.compatible\t= \"ti,74244\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_IN | 8),\n\t},\n\t{\n\t\t.compatible\t= \"ti,741624\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_IN | 16),\n\t},\n\t{\n\t\t.compatible\t= \"ti,741g74\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_OUT | 1),\n\t},\n\t{\n\t\t.compatible\t= \"ti,7474\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_OUT | 2),\n\t},\n\t{\n\t\t.compatible\t= \"ti,74175\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_OUT | 4),\n\t},\n\t{\n\t\t.compatible\t= \"ti,74174\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_OUT | 6),\n\t},\n\t{\n\t\t.compatible\t= \"ti,74273\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_OUT | 8),\n\t},\n\t{\n\t\t.compatible\t= \"ti,7416374\",\n\t\t.data\t\t= (const void *)(MMIO_74XX_DIR_OUT | 16),\n\t},\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, mmio_74xx_gpio_ids);\n\nstatic int mmio_74xx_get_direction(struct gpio_chip *gc, unsigned offset)\n{\n\tstruct mmio_74xx_gpio_priv *priv = gpiochip_get_data(gc);\n\n\tif (priv->flags & MMIO_74XX_DIR_OUT)\n\t\treturn GPIO_LINE_DIRECTION_OUT;\n\n\treturn  GPIO_LINE_DIRECTION_IN;\n}\n\nstatic int mmio_74xx_dir_in(struct gpio_chip *gc, unsigned int gpio)\n{\n\tstruct mmio_74xx_gpio_priv *priv = gpiochip_get_data(gc);\n\n\tif (priv->flags & MMIO_74XX_DIR_IN)\n\t\treturn 0;\n\n\treturn -ENOTSUPP;\n}\n\nstatic int mmio_74xx_dir_out(struct gpio_chip *gc, unsigned int gpio, int val)\n{\n\tstruct mmio_74xx_gpio_priv *priv = gpiochip_get_data(gc);\n\n\tif (priv->flags & MMIO_74XX_DIR_OUT) {\n\t\tgc->set(gc, gpio, val);\n\t\treturn 0;\n\t}\n\n\treturn -ENOTSUPP;\n}\n\nstatic int mmio_74xx_gpio_probe(struct platform_device *pdev)\n{\n\tstruct mmio_74xx_gpio_priv *priv;\n\tvoid __iomem *dat;\n\tint err;\n\n\tpriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->flags = (uintptr_t)device_get_match_data(&pdev->dev);\n\n\tdat = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(dat))\n\t\treturn PTR_ERR(dat);\n\n\terr = bgpio_init(&priv->gc, &pdev->dev,\n\t\t\t DIV_ROUND_UP(MMIO_74XX_BIT_CNT(priv->flags), 8),\n\t\t\t dat, NULL, NULL, NULL, NULL, 0);\n\tif (err)\n\t\treturn err;\n\n\tpriv->gc.direction_input = mmio_74xx_dir_in;\n\tpriv->gc.direction_output = mmio_74xx_dir_out;\n\tpriv->gc.get_direction = mmio_74xx_get_direction;\n\tpriv->gc.ngpio = MMIO_74XX_BIT_CNT(priv->flags);\n\tpriv->gc.owner = THIS_MODULE;\n\n\treturn devm_gpiochip_add_data(&pdev->dev, &priv->gc, priv);\n}\n\nstatic struct platform_driver mmio_74xx_gpio_driver = {\n\t.driver\t= {\n\t\t.name\t\t= \"74xx-mmio-gpio\",\n\t\t.of_match_table\t= mmio_74xx_gpio_ids,\n\t},\n\t.probe\t= mmio_74xx_gpio_probe,\n};\nmodule_platform_driver(mmio_74xx_gpio_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Alexander Shiyan <shc_work@mail.ru>\");\nMODULE_DESCRIPTION(\"74xx MMIO GPIO driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}