{
  "module_name": "debugfs.c",
  "hash_id": "00dab84f6a77868ede0e32564622da416707ae5010f7e70dec5389a32689479b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/typec/ucsi/debugfs.c",
  "human_readable_source": "\n \n#include <linux/debugfs.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <linux/usb.h>\n\n#include <asm/errno.h>\n\n#include \"ucsi.h\"\n\nstatic struct dentry *ucsi_debugfs_root;\n\nstatic int ucsi_cmd(void *data, u64 val)\n{\n\tstruct ucsi *ucsi = data;\n\tint ret;\n\n\tmemset(&ucsi->debugfs->response, 0, sizeof(ucsi->debugfs->response));\n\tucsi->debugfs->status = 0;\n\n\tswitch (UCSI_COMMAND(val)) {\n\tcase UCSI_SET_UOM:\n\tcase UCSI_SET_UOR:\n\tcase UCSI_SET_PDR:\n\tcase UCSI_CONNECTOR_RESET:\n\t\tret = ucsi_send_command(ucsi, val, NULL, 0);\n\t\tbreak;\n\tcase UCSI_GET_CAPABILITY:\n\tcase UCSI_GET_CONNECTOR_CAPABILITY:\n\tcase UCSI_GET_ALTERNATE_MODES:\n\tcase UCSI_GET_CURRENT_CAM:\n\tcase UCSI_GET_PDOS:\n\tcase UCSI_GET_CABLE_PROPERTY:\n\tcase UCSI_GET_CONNECTOR_STATUS:\n\t\tret = ucsi_send_command(ucsi, val,\n\t\t\t\t\t&ucsi->debugfs->response,\n\t\t\t\t\tsizeof(ucsi->debugfs->response));\n\t\tbreak;\n\tdefault:\n\t\tret = -EOPNOTSUPP;\n\t}\n\n\tif (ret < 0) {\n\t\tucsi->debugfs->status = ret;\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\nDEFINE_DEBUGFS_ATTRIBUTE(ucsi_cmd_fops, NULL, ucsi_cmd, \"0x%llx\\n\");\n\nstatic int ucsi_resp_show(struct seq_file *s, void *not_used)\n{\n\tstruct ucsi *ucsi = s->private;\n\n\tif (ucsi->debugfs->status)\n\t\treturn ucsi->debugfs->status;\n\n\tseq_printf(s, \"0x%016llx%016llx\\n\", ucsi->debugfs->response.high,\n\t\t   ucsi->debugfs->response.low);\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(ucsi_resp);\n\nvoid ucsi_debugfs_register(struct ucsi *ucsi)\n{\n\tucsi->debugfs = kzalloc(sizeof(*ucsi->debugfs), GFP_KERNEL);\n\tif (!ucsi->debugfs)\n\t\treturn;\n\n\tucsi->debugfs->dentry = debugfs_create_dir(dev_name(ucsi->dev), ucsi_debugfs_root);\n\tdebugfs_create_file(\"command\", 0200, ucsi->debugfs->dentry, ucsi, &ucsi_cmd_fops);\n\tdebugfs_create_file(\"response\", 0400, ucsi->debugfs->dentry, ucsi, &ucsi_resp_fops);\n}\n\nvoid ucsi_debugfs_unregister(struct ucsi *ucsi)\n{\n\tif (IS_ERR_OR_NULL(ucsi) || !ucsi->debugfs)\n\t\treturn;\n\n\tdebugfs_remove_recursive(ucsi->debugfs->dentry);\n\tkfree(ucsi->debugfs);\n}\n\nvoid ucsi_debugfs_init(void)\n{\n\tucsi_debugfs_root = debugfs_create_dir(\"ucsi\", usb_debug_root);\n}\n\nvoid ucsi_debugfs_exit(void)\n{\n\tdebugfs_remove(ucsi_debugfs_root);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}