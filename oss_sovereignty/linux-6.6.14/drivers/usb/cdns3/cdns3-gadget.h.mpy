{
  "module_name": "cdns3-gadget.h",
  "hash_id": "1ad30bbca5a6458c196949b9a424940f7aab5ab8b1275f474490771094a25680",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/cdns3/cdns3-gadget.h",
  "human_readable_source": " \n \n#ifndef __LINUX_CDNS3_GADGET\n#define __LINUX_CDNS3_GADGET\n#include <linux/usb/gadget.h>\n#include <linux/dma-direction.h>\n\n \n\n \nstruct cdns3_usb_regs {\n\t__le32 usb_conf;\n\t__le32 usb_sts;\n\t__le32 usb_cmd;\n\t__le32 usb_itpn;\n\t__le32 usb_lpm;\n\t__le32 usb_ien;\n\t__le32 usb_ists;\n\t__le32 ep_sel;\n\t__le32 ep_traddr;\n\t__le32 ep_cfg;\n\t__le32 ep_cmd;\n\t__le32 ep_sts;\n\t__le32 ep_sts_sid;\n\t__le32 ep_sts_en;\n\t__le32 drbl;\n\t__le32 ep_ien;\n\t__le32 ep_ists;\n\t__le32 usb_pwr;\n\t__le32 usb_conf2;\n\t__le32 usb_cap1;\n\t__le32 usb_cap2;\n\t__le32 usb_cap3;\n\t__le32 usb_cap4;\n\t__le32 usb_cap5;\n\t__le32 usb_cap6;\n\t__le32 usb_cpkt1;\n\t__le32 usb_cpkt2;\n\t__le32 usb_cpkt3;\n\t__le32 ep_dma_ext_addr;\n\t__le32 buf_addr;\n\t__le32 buf_data;\n\t__le32 buf_ctrl;\n\t__le32 dtrans;\n\t__le32 tdl_from_trb;\n\t__le32 tdl_beh;\n\t__le32 ep_tdl;\n\t__le32 tdl_beh2;\n\t__le32 dma_adv_td;\n\t__le32 reserved1[26];\n\t__le32 cfg_reg1;\n\t__le32 dbg_link1;\n\t__le32 dbg_link2;\n\t__le32 cfg_regs[74];\n\t__le32 reserved2[51];\n\t__le32 dma_axi_ctrl;\n\t__le32 dma_axi_id;\n\t__le32 dma_axi_cap;\n\t__le32 dma_axi_ctrl0;\n\t__le32 dma_axi_ctrl1;\n};\n\n \n \n#define USB_CONF_CFGRST\t\tBIT(0)\n \n#define USB_CONF_CFGSET\t\tBIT(1)\n \n#define USB_CONF_USB3DIS\tBIT(3)\n \n#define USB_CONF_USB2DIS\tBIT(4)\n \n#define USB_CONF_LENDIAN\tBIT(5)\n \n#define USB_CONF_BENDIAN\tBIT(6)\n \n#define USB_CONF_SWRST\t\tBIT(7)\n \n#define USB_CONF_DSING\t\tBIT(8)\n \n#define USB_CONF_DMULT\t\tBIT(9)\n \n#define USB_CONF_DMAOFFEN\tBIT(10)\n \n#define USB_CONF_DMAOFFDS\tBIT(11)\n \n#define USB_CONF_CFORCE_FS\tBIT(12)\n \n#define USB_CONF_SFORCE_FS\tBIT(13)\n \n#define USB_CONF_DEVEN\t\tBIT(14)\n \n#define USB_CONF_DEVDS\t\tBIT(15)\n \n#define USB_CONF_L1EN\t\tBIT(16)\n \n#define USB_CONF_L1DS\t\tBIT(17)\n \n#define USB_CONF_CLK2OFFEN\tBIT(18)\n \n#define USB_CONF_CLK2OFFDS\tBIT(19)\n \n#define USB_CONF_LGO_L0\t\tBIT(20)\n \n#define USB_CONF_CLK3OFFEN\tBIT(21)\n \n#define USB_CONF_CLK3OFFDS\tBIT(22)\n \n \n#define USB_CONF_U1EN\t\tBIT(24)\n \n#define USB_CONF_U1DS\t\tBIT(25)\n \n#define USB_CONF_U2EN\t\tBIT(26)\n \n#define USB_CONF_U2DS\t\tBIT(27)\n \n#define USB_CONF_LGO_U0\t\tBIT(28)\n \n#define USB_CONF_LGO_U1\t\tBIT(29)\n \n#define USB_CONF_LGO_U2\t\tBIT(30)\n \n#define USB_CONF_LGO_SSINACT\tBIT(31)\n\n \n \n#define USB_STS_CFGSTS_MASK\tBIT(0)\n#define USB_STS_CFGSTS(p)\t((p) & USB_STS_CFGSTS_MASK)\n \n#define USB_STS_OV_MASK\t\tBIT(1)\n#define USB_STS_OV(p)\t\t((p) & USB_STS_OV_MASK)\n \n#define USB_STS_USB3CONS_MASK\tBIT(2)\n#define USB_STS_USB3CONS(p)\t((p) & USB_STS_USB3CONS_MASK)\n \n#define USB_STS_DTRANS_MASK\tBIT(3)\n#define USB_STS_DTRANS(p)\t((p) & USB_STS_DTRANS_MASK)\n \n#define USB_STS_USBSPEED_MASK\tGENMASK(6, 4)\n#define USB_STS_USBSPEED(p)\t(((p) & USB_STS_USBSPEED_MASK) >> 4)\n#define USB_STS_LS\t\t(0x1 << 4)\n#define USB_STS_FS\t\t(0x2 << 4)\n#define USB_STS_HS\t\t(0x3 << 4)\n#define USB_STS_SS\t\t(0x4 << 4)\n#define DEV_UNDEFSPEED(p)\t(((p) & USB_STS_USBSPEED_MASK) == (0x0 << 4))\n#define DEV_LOWSPEED(p)\t\t(((p) & USB_STS_USBSPEED_MASK) == USB_STS_LS)\n#define DEV_FULLSPEED(p)\t(((p) & USB_STS_USBSPEED_MASK) == USB_STS_FS)\n#define DEV_HIGHSPEED(p)\t(((p) & USB_STS_USBSPEED_MASK) == USB_STS_HS)\n#define DEV_SUPERSPEED(p)\t(((p) & USB_STS_USBSPEED_MASK) == USB_STS_SS)\n \n#define USB_STS_ENDIAN_MASK\tBIT(7)\n#define USB_STS_ENDIAN(p)\t((p) & USB_STS_ENDIAN_MASK)\n \n#define USB_STS_CLK2OFF_MASK\tBIT(8)\n#define USB_STS_CLK2OFF(p)\t((p) & USB_STS_CLK2OFF_MASK)\n \n#define USB_STS_CLK3OFF_MASK\tBIT(9)\n#define USB_STS_CLK3OFF(p)\t((p) & USB_STS_CLK3OFF_MASK)\n \n#define USB_STS_IN_RST_MASK\tBIT(10)\n#define USB_STS_IN_RST(p)\t((p) & USB_STS_IN_RST_MASK)\n \n#define USB_STS_TDL_TRB_ENABLED\tBIT(11)\n \n#define USB_STS_DEVS_MASK\tBIT(14)\n#define USB_STS_DEVS(p)\t\t((p) & USB_STS_DEVS_MASK)\n \n#define USB_STS_ADDRESSED_MASK\tBIT(15)\n#define USB_STS_ADDRESSED(p)\t((p) & USB_STS_ADDRESSED_MASK)\n \n#define USB_STS_L1ENS_MASK\tBIT(16)\n#define USB_STS_L1ENS(p)\t((p) & USB_STS_L1ENS_MASK)\n \n#define USB_STS_VBUSS_MASK\tBIT(17)\n#define USB_STS_VBUSS(p)\t((p) & USB_STS_VBUSS_MASK)\n \n#define USB_STS_LPMST_MASK\tGENMASK(19, 18)\n#define DEV_L0_STATE(p)\t\t(((p) & USB_STS_LPMST_MASK) == (0x0 << 18))\n#define DEV_L1_STATE(p)\t\t(((p) & USB_STS_LPMST_MASK) == (0x1 << 18))\n#define DEV_L2_STATE(p)\t\t(((p) & USB_STS_LPMST_MASK) == (0x2 << 18))\n#define DEV_L3_STATE(p)\t\t(((p) & USB_STS_LPMST_MASK) == (0x3 << 18))\n \n#define USB_STS_USB2CONS_MASK\tBIT(20)\n#define USB_STS_USB2CONS(p)\t((p) & USB_STS_USB2CONS_MASK)\n \n#define USB_STS_DISABLE_HS_MASK\tBIT(21)\n#define USB_STS_DISABLE_HS(p)\t((p) & USB_STS_DISABLE_HS_MASK)\n \n#define USB_STS_U1ENS_MASK\tBIT(24)\n#define USB_STS_U1ENS(p)\t((p) & USB_STS_U1ENS_MASK)\n \n#define USB_STS_U2ENS_MASK\tBIT(25)\n#define USB_STS_U2ENS(p)\t((p) & USB_STS_U2ENS_MASK)\n \n#define USB_STS_LST_MASK\tGENMASK(29, 26)\n#define DEV_LST_U0\t\t(((p) & USB_STS_LST_MASK) == (0x0 << 26))\n#define DEV_LST_U1\t\t(((p) & USB_STS_LST_MASK) == (0x1 << 26))\n#define DEV_LST_U2\t\t(((p) & USB_STS_LST_MASK) == (0x2 << 26))\n#define DEV_LST_U3\t\t(((p) & USB_STS_LST_MASK) == (0x3 << 26))\n#define DEV_LST_DISABLED\t(((p) & USB_STS_LST_MASK) == (0x4 << 26))\n#define DEV_LST_RXDETECT\t(((p) & USB_STS_LST_MASK) == (0x5 << 26))\n#define DEV_LST_INACTIVE\t(((p) & USB_STS_LST_MASK) == (0x6 << 26))\n#define DEV_LST_POLLING\t\t(((p) & USB_STS_LST_MASK) == (0x7 << 26))\n#define DEV_LST_RECOVERY\t(((p) & USB_STS_LST_MASK) == (0x8 << 26))\n#define DEV_LST_HOT_RESET\t(((p) & USB_STS_LST_MASK) == (0x9 << 26))\n#define DEV_LST_COMP_MODE\t(((p) & USB_STS_LST_MASK) == (0xa << 26))\n#define DEV_LST_LB_STATE\t(((p) & USB_STS_LST_MASK) == (0xb << 26))\n \n#define USB_STS_DMAOFF_MASK\tBIT(30)\n#define USB_STS_DMAOFF(p)\t((p) & USB_STS_DMAOFF_MASK)\n \n#define USB_STS_ENDIAN2_MASK\tBIT(31)\n#define USB_STS_ENDIAN2(p)\t((p) & USB_STS_ENDIAN2_MASK)\n\n \n \n#define USB_CMD_SET_ADDR\tBIT(0)\n \n#define USB_CMD_FADDR_MASK\tGENMASK(7, 1)\n#define USB_CMD_FADDR(p)\t(((p) << 1) & USB_CMD_FADDR_MASK)\n \n#define USB_CMD_SDNFW\t\tBIT(8)\n \n#define USB_CMD_STMODE\t\tBIT(9)\n \n#define USB_STS_TMODE_SEL_MASK\tGENMASK(11, 10)\n#define USB_STS_TMODE_SEL(p)\t(((p) << 10) & USB_STS_TMODE_SEL_MASK)\n \n#define USB_CMD_SDNLTM\t\tBIT(12)\n \n#define USB_CMD_SPKT\t\tBIT(13)\n \n#define USB_CMD_DNFW_INT_MASK\tGENMASK(23, 16)\n#define USB_STS_DNFW_INT(p)\t(((p) << 16) & USB_CMD_DNFW_INT_MASK)\n \n#define USB_CMD_DNLTM_BELT_MASK\tGENMASK(27, 16)\n#define USB_STS_DNLTM_BELT(p)\t(((p) << 16) & USB_CMD_DNLTM_BELT_MASK)\n\n \n \n#define USB_ITPN_MASK\t\tGENMASK(13, 0)\n#define USB_ITPN(p)\t\t((p) & USB_ITPN_MASK)\n\n \n \n#define USB_LPM_HIRD_MASK\tGENMASK(3, 0)\n#define USB_LPM_HIRD(p)\t\t((p) & USB_LPM_HIRD_MASK)\n \n#define USB_LPM_BRW\t\tBIT(4)\n\n \n \n#define USB_IEN_CONIEN\t\tBIT(0)\n \n#define USB_IEN_DISIEN\t\tBIT(1)\n \n#define USB_IEN_UWRESIEN\tBIT(2)\n \n#define USB_IEN_UHRESIEN\tBIT(3)\n \n#define USB_IEN_U3ENTIEN\tBIT(4)\n \n#define USB_IEN_U3EXTIEN\tBIT(5)\n \n#define USB_IEN_U2ENTIEN\tBIT(6)\n \n#define USB_IEN_U2EXTIEN\tBIT(7)\n \n#define USB_IEN_U1ENTIEN\tBIT(8)\n \n#define USB_IEN_U1EXTIEN\tBIT(9)\n \n#define USB_IEN_ITPIEN\t\tBIT(10)\n \n#define USB_IEN_WAKEIEN\t\tBIT(11)\n \n#define USB_IEN_SPKTIEN\t\tBIT(12)\n \n#define USB_IEN_CON2IEN\t\tBIT(16)\n \n#define USB_IEN_DIS2IEN\t\tBIT(17)\n \n#define USB_IEN_U2RESIEN\tBIT(18)\n \n#define USB_IEN_L2ENTIEN\tBIT(20)\n \n#define USB_IEN_L2EXTIEN\tBIT(21)\n \n#define USB_IEN_L1ENTIEN\tBIT(24)\n \n#define USB_IEN_L1EXTIEN\tBIT(25)\n \n#define USB_IEN_CFGRESIEN\tBIT(26)\n \n#define USB_IEN_UWRESSIEN\tBIT(28)\n \n#define USB_IEN_UWRESEIEN\tBIT(29)\n\n#define USB_IEN_INIT  (USB_IEN_U2RESIEN | USB_ISTS_DIS2I | USB_IEN_CON2IEN \\\n\t\t       | USB_IEN_UHRESIEN | USB_IEN_UWRESIEN | USB_IEN_DISIEN \\\n\t\t       | USB_IEN_CONIEN | USB_IEN_U3EXTIEN | USB_IEN_L2ENTIEN \\\n\t\t       | USB_IEN_L2EXTIEN | USB_IEN_L1ENTIEN | USB_IEN_U3ENTIEN)\n\n \n \n#define USB_ISTS_CONI\t\tBIT(0)\n \n#define USB_ISTS_DISI\t\tBIT(1)\n \n#define USB_ISTS_UWRESI\t\tBIT(2)\n \n#define USB_ISTS_UHRESI\t\tBIT(3)\n \n#define USB_ISTS_U3ENTI\t\tBIT(4)\n \n#define USB_ISTS_U3EXTI\t\tBIT(5)\n \n#define USB_ISTS_U2ENTI\t\tBIT(6)\n \n#define USB_ISTS_U2EXTI\t\tBIT(7)\n \n#define USB_ISTS_U1ENTI\t\tBIT(8)\n \n#define USB_ISTS_U1EXTI\t\tBIT(9)\n \n#define USB_ISTS_ITPI\t\tBIT(10)\n \n#define USB_ISTS_WAKEI\t\tBIT(11)\n \n#define USB_ISTS_SPKTI\t\tBIT(12)\n \n#define USB_ISTS_CON2I\t\tBIT(16)\n \n#define USB_ISTS_DIS2I\t\tBIT(17)\n \n#define USB_ISTS_U2RESI\t\tBIT(18)\n \n#define USB_ISTS_L2ENTI\t\tBIT(20)\n \n#define USB_ISTS_L2EXTI\t\tBIT(21)\n \n#define USB_ISTS_L1ENTI\t\tBIT(24)\n \n#define USB_ISTS_L1EXTI\t\tBIT(25)\n \n#define USB_ISTS_CFGRESI\tBIT(26)\n \n#define USB_ISTS_UWRESSI\tBIT(28)\n \n#define USB_ISTS_UWRESEI\tBIT(29)\n\n \n#define EP_SEL_EPNO_MASK\tGENMASK(3, 0)\n \n#define EP_SEL_EPNO(p)\t\t((p) & EP_SEL_EPNO_MASK)\n \n#define EP_SEL_DIR\t\tBIT(7)\n\n#define select_ep_in(nr)\t(EP_SEL_EPNO(p) | EP_SEL_DIR)\n#define select_ep_out\t\t(EP_SEL_EPNO(p))\n\n \n \n#define EP_TRADDR_TRADDR(p)\t((p))\n\n \n \n#define EP_CFG_ENABLE\t\tBIT(0)\n \n#define EP_CFG_EPTYPE_MASK\tGENMASK(2, 1)\n#define EP_CFG_EPTYPE(p)\t(((p) << 1)  & EP_CFG_EPTYPE_MASK)\n \n#define EP_CFG_STREAM_EN\tBIT(3)\n \n#define EP_CFG_TDL_CHK\t\tBIT(4)\n \n#define EP_CFG_SID_CHK\t\tBIT(5)\n \n#define EP_CFG_EPENDIAN\t\tBIT(7)\n \n#define EP_CFG_MAXBURST_MASK\tGENMASK(11, 8)\n#define EP_CFG_MAXBURST(p)\t(((p) << 8) & EP_CFG_MAXBURST_MASK)\n#define EP_CFG_MAXBURST_MAX\t15\n \n#define EP_CFG_MULT_MASK\tGENMASK(15, 14)\n#define EP_CFG_MULT(p)\t\t(((p) << 14) & EP_CFG_MULT_MASK)\n#define EP_CFG_MULT_MAX\t\t2\n \n#define EP_CFG_MAXPKTSIZE_MASK\tGENMASK(26, 16)\n#define EP_CFG_MAXPKTSIZE(p)\t(((p) << 16) & EP_CFG_MAXPKTSIZE_MASK)\n \n#define EP_CFG_BUFFERING_MASK\tGENMASK(31, 27)\n#define EP_CFG_BUFFERING(p)\t(((p) << 27) & EP_CFG_BUFFERING_MASK)\n#define EP_CFG_BUFFERING_MAX\t15\n\n \n \n#define EP_CMD_EPRST\t\tBIT(0)\n \n#define EP_CMD_SSTALL\t\tBIT(1)\n \n#define EP_CMD_CSTALL\t\tBIT(2)\n \n#define EP_CMD_ERDY\t\tBIT(3)\n \n#define EP_CMD_REQ_CMPL\t\tBIT(5)\n \n#define EP_CMD_DRDY\t\tBIT(6)\n \n#define EP_CMD_DFLUSH\t\tBIT(7)\n \n#define EP_CMD_STDL\t\tBIT(8)\n \n#define EP_CMD_TDL_MASK\t\tGENMASK(15, 9)\n#define EP_CMD_TDL_SET(p)\t(((p) << 9) & EP_CMD_TDL_MASK)\n#define EP_CMD_TDL_GET(p)\t(((p) & EP_CMD_TDL_MASK) >> 9)\n#define EP_CMD_TDL_MAX\t\t(EP_CMD_TDL_MASK >> 9)\n\n \n#define EP_CMD_ERDY_SID_MASK\tGENMASK(31, 16)\n#define EP_CMD_ERDY_SID(p)\t(((p) << 16) & EP_CMD_ERDY_SID_MASK)\n\n \n \n#define EP_STS_SETUP\t\tBIT(0)\n \n#define EP_STS_STALL(p)\t\t((p) & BIT(1))\n \n#define EP_STS_IOC\t\tBIT(2)\n \n#define EP_STS_ISP\t\tBIT(3)\n \n#define EP_STS_DESCMIS\t\tBIT(4)\n \n#define EP_STS_STREAMR\t\tBIT(5)\n \n#define EP_STS_MD_EXIT\t\tBIT(6)\n \n#define EP_STS_TRBERR\t\tBIT(7)\n \n#define EP_STS_NRDY\t\tBIT(8)\n \n#define EP_STS_DBUSY\t\tBIT(9)\n \n#define EP_STS_BUFFEMPTY(p)\t((p) & BIT(10))\n \n#define EP_STS_CCS(p)\t\t((p) & BIT(11))\n \n#define EP_STS_PRIME\t\tBIT(12)\n \n#define EP_STS_SIDERR\t\tBIT(13)\n \n#define EP_STS_OUTSMM\t\tBIT(14)\n \n#define EP_STS_ISOERR\t\tBIT(15)\n \n#define EP_STS_HOSTPP(p)\t((p) & BIT(16))\n \n#define EP_STS_SPSMST_MASK\t\tGENMASK(18, 17)\n#define EP_STS_SPSMST_DISABLED(p)\t(((p) & EP_STS_SPSMST_MASK) >> 17)\n#define EP_STS_SPSMST_IDLE(p)\t\t(((p) & EP_STS_SPSMST_MASK) >> 17)\n#define EP_STS_SPSMST_START_STREAM(p)\t(((p) & EP_STS_SPSMST_MASK) >> 17)\n#define EP_STS_SPSMST_MOVE_DATA(p)\t(((p) & EP_STS_SPSMST_MASK) >> 17)\n \n#define EP_STS_IOT\t\tBIT(19)\n \n#define EP_STS_OUTQ_NO_MASK\tGENMASK(27, 24)\n#define EP_STS_OUTQ_NO(p)\t(((p) & EP_STS_OUTQ_NO_MASK) >> 24)\n \n#define EP_STS_OUTQ_VAL_MASK\tBIT(28)\n#define EP_STS_OUTQ_VAL(p)\t((p) & EP_STS_OUTQ_VAL_MASK)\n \n#define EP_STS_STPWAIT\t\tBIT(31)\n\n \n \n#define EP_STS_SID_MASK\t\tGENMASK(15, 0)\n#define EP_STS_SID(p)\t\t((p) & EP_STS_SID_MASK)\n\n \n \n#define EP_STS_EN_SETUPEN\tBIT(0)\n \n#define EP_STS_EN_DESCMISEN\tBIT(4)\n \n#define EP_STS_EN_STREAMREN\tBIT(5)\n \n#define EP_STS_EN_MD_EXITEN\tBIT(6)\n \n#define EP_STS_EN_TRBERREN\tBIT(7)\n \n#define EP_STS_EN_NRDYEN\tBIT(8)\n \n#define EP_STS_EN_PRIMEEEN\tBIT(12)\n \n#define EP_STS_EN_SIDERREN\tBIT(13)\n \n#define EP_STS_EN_OUTSMMEN\tBIT(14)\n \n#define EP_STS_EN_ISOERREN\tBIT(15)\n \n#define EP_STS_EN_IOTEN\t\tBIT(19)\n \n#define EP_STS_EN_STPWAITEN\tBIT(31)\n\n \n#define DB_VALUE_BY_INDEX(index) (1 << (index))\n#define DB_VALUE_EP0_OUT\tBIT(0)\n#define DB_VALUE_EP0_IN\t\tBIT(16)\n\n \n#define EP_IEN(index)\t\t(1 << (index))\n#define EP_IEN_EP_OUT0\t\tBIT(0)\n#define EP_IEN_EP_IN0\t\tBIT(16)\n\n \n#define EP_ISTS(index)\t\t(1 << (index))\n#define EP_ISTS_EP_OUT0\t\tBIT(0)\n#define EP_ISTS_EP_IN0\t\tBIT(16)\n\n \n \n#define PUSB_PWR_PSO_EN\t\tBIT(0)\n \n#define PUSB_PWR_PSO_DS\t\tBIT(1)\n \n#define PUSB_PWR_STB_CLK_SWITCH_EN\tBIT(8)\n \n#define PUSB_PWR_STB_CLK_SWITCH_DONE\tBIT(9)\n \n#define PUSB_PWR_FST_REG_ACCESS_STAT\tBIT(30)\n \n#define PUSB_PWR_FST_REG_ACCESS\t\tBIT(31)\n\n \n \n#define USB_CONF2_DIS_TDL_TRB\t\tBIT(1)\n \n#define USB_CONF2_EN_TDL_TRB\t\tBIT(2)\n\n \n \n#define USB_CAP1_SFR_TYPE_MASK\tGENMASK(3, 0)\n#define DEV_SFR_TYPE_OCP(p)\t(((p) & USB_CAP1_SFR_TYPE_MASK) == 0x0)\n#define DEV_SFR_TYPE_AHB(p)\t(((p) & USB_CAP1_SFR_TYPE_MASK) == 0x1)\n#define DEV_SFR_TYPE_PLB(p)\t(((p) & USB_CAP1_SFR_TYPE_MASK) == 0x2)\n#define DEV_SFR_TYPE_AXI(p)\t(((p) & USB_CAP1_SFR_TYPE_MASK) == 0x3)\n \n#define USB_CAP1_SFR_WIDTH_MASK\tGENMASK(7, 4)\n#define DEV_SFR_WIDTH_8(p)\t(((p) & USB_CAP1_SFR_WIDTH_MASK) == (0x0 << 4))\n#define DEV_SFR_WIDTH_16(p)\t(((p) & USB_CAP1_SFR_WIDTH_MASK) == (0x1 << 4))\n#define DEV_SFR_WIDTH_32(p)\t(((p) & USB_CAP1_SFR_WIDTH_MASK) == (0x2 << 4))\n#define DEV_SFR_WIDTH_64(p)\t(((p) & USB_CAP1_SFR_WIDTH_MASK) == (0x3 << 4))\n \n#define USB_CAP1_DMA_TYPE_MASK\tGENMASK(11, 8)\n#define DEV_DMA_TYPE_OCP(p)\t(((p) & USB_CAP1_DMA_TYPE_MASK) == (0x0 << 8))\n#define DEV_DMA_TYPE_AHB(p)\t(((p) & USB_CAP1_DMA_TYPE_MASK) == (0x1 << 8))\n#define DEV_DMA_TYPE_PLB(p)\t(((p) & USB_CAP1_DMA_TYPE_MASK) == (0x2 << 8))\n#define DEV_DMA_TYPE_AXI(p)\t(((p) & USB_CAP1_DMA_TYPE_MASK) == (0x3 << 8))\n \n#define USB_CAP1_DMA_WIDTH_MASK\tGENMASK(15, 12)\n#define DEV_DMA_WIDTH_32(p)\t(((p) & USB_CAP1_DMA_WIDTH_MASK) == (0x2 << 12))\n#define DEV_DMA_WIDTH_64(p)\t(((p) & USB_CAP1_DMA_WIDTH_MASK) == (0x3 << 12))\n \n#define USB_CAP1_U3PHY_TYPE_MASK GENMASK(19, 16)\n#define DEV_U3PHY_PIPE(p) (((p) & USB_CAP1_U3PHY_TYPE_MASK) == (0x0 << 16))\n#define DEV_U3PHY_RMMI(p) (((p) & USB_CAP1_U3PHY_TYPE_MASK) == (0x1 << 16))\n \n#define USB_CAP1_U3PHY_WIDTH_MASK GENMASK(23, 20)\n#define DEV_U3PHY_WIDTH_8(p) \\\n\t(((p) & USB_CAP1_U3PHY_WIDTH_MASK) == (0x0 << 20))\n#define DEV_U3PHY_WIDTH_16(p) \\\n\t(((p) & USB_CAP1_U3PHY_WIDTH_MASK) == (0x1 << 16))\n#define DEV_U3PHY_WIDTH_32(p) \\\n\t(((p) & USB_CAP1_U3PHY_WIDTH_MASK) == (0x2 << 20))\n#define DEV_U3PHY_WIDTH_64(p) \\\n\t(((p) & USB_CAP1_U3PHY_WIDTH_MASK) == (0x3 << 16))\n\n \n#define USB_CAP1_U2PHY_EN(p)\t((p) & BIT(24))\n \n#define DEV_U2PHY_ULPI(p)\t((p) & BIT(25))\n \n#define DEV_U2PHY_WIDTH_16(p)\t((p) & BIT(26))\n \n#define USB_CAP1_OTG_READY(p)\t((p) & BIT(27))\n\n \n#define USB_CAP1_TDL_FROM_TRB(p)\t((p) & BIT(28))\n\n \n \n#define USB_CAP2_ACTUAL_MEM_SIZE(p) ((p) & GENMASK(7, 0))\n \n#define USB_CAP2_MAX_MEM_SIZE(p) ((p) & GENMASK(11, 8))\n\n \n#define EP_IS_IMPLEMENTED(reg, index) ((reg) & (1 << (index)))\n\n \n#define EP_SUPPORT_ISO(reg, index) ((reg) & (1 << (index)))\n\n \n#define EP_SUPPORT_STREAM(reg, index) ((reg) & (1 << (index)))\n\n \n \n#define GET_DEV_BASE_VERSION(p) ((p) & GENMASK(23, 0))\n \n#define GET_DEV_CUSTOM_VERSION(p) ((p) & GENMASK(31, 24))\n\n#define DEV_VER_NXP_V1\t\t0x00024502\n#define DEV_VER_TI_V1\t\t0x00024509\n#define DEV_VER_V2\t\t0x0002450C\n#define DEV_VER_V3\t\t0x0002450d\n\n \n \n#define DBG_LINK1_LFPS_MIN_DET_U1_EXIT(p)\t((p) & GENMASK(7, 0))\n \n#define DBG_LINK1_LFPS_MIN_GEN_U1_EXIT_MASK\tGENMASK(15, 8)\n#define DBG_LINK1_LFPS_MIN_GEN_U1_EXIT(p)\t(((p) << 8) & GENMASK(15, 8))\n \n#define DBG_LINK1_RXDET_BREAK_DIS\t\tBIT(16)\n \n#define DBG_LINK1_LFPS_GEN_PING(p)\t\t(((p) << 17) & GENMASK(21, 17))\n \n#define DBG_LINK1_LFPS_MIN_DET_U1_EXIT_SET\tBIT(24)\n \n#define DBG_LINK1_LFPS_MIN_GEN_U1_EXIT_SET\tBIT(25)\n \n#define DBG_LINK1_RXDET_BREAK_DIS_SET\t\tBIT(26)\n \n#define DBG_LINK1_LFPS_GEN_PING_SET\t\tBIT(27)\n\n \n \n#define DMA_AXI_CTRL_MARPROT(p) ((p) & GENMASK(2, 0))\n \n#define DMA_AXI_CTRL_MAWPROT(p) (((p) & GENMASK(2, 0)) << 16)\n#define DMA_AXI_CTRL_NON_SECURE 0x02\n\n#define gadget_to_cdns3_device(g) (container_of(g, struct cdns3_device, gadget))\n\n#define ep_to_cdns3_ep(ep) (container_of(ep, struct cdns3_endpoint, endpoint))\n\n \n \n#define TRBS_PER_SEGMENT\t600\n\n#define ISO_MAX_INTERVAL\t10\n\n#define MAX_TRB_LENGTH          BIT(16)\n\n#if TRBS_PER_SEGMENT < 2\n#error \"Incorrect TRBS_PER_SEGMENT. Minimal Transfer Ring size is 2.\"\n#endif\n\n#define TRBS_PER_STREAM_SEGMENT 2\n\n#if TRBS_PER_STREAM_SEGMENT < 2\n#error \"Incorrect TRBS_PER_STREAMS_SEGMENT. Minimal Transfer Ring size is 2.\"\n#endif\n\n \n#define TRBS_PER_ISOC_SEGMENT\t(ISO_MAX_INTERVAL * 8)\n\n#define GET_TRBS_PER_SEGMENT(ep_type) ((ep_type) == USB_ENDPOINT_XFER_ISOC ? \\\n\t\t\t\t      TRBS_PER_ISOC_SEGMENT : TRBS_PER_SEGMENT)\n \nstruct cdns3_trb {\n\t__le32 buffer;\n\t__le32 length;\n\t__le32 control;\n};\n\n#define TRB_SIZE\t\t(sizeof(struct cdns3_trb))\n#define TRB_RING_SIZE\t\t(TRB_SIZE * TRBS_PER_SEGMENT)\n#define TRB_STREAM_RING_SIZE\t(TRB_SIZE * TRBS_PER_STREAM_SEGMENT)\n#define TRB_ISO_RING_SIZE\t(TRB_SIZE * TRBS_PER_ISOC_SEGMENT)\n#define TRB_CTRL_RING_SIZE\t(TRB_SIZE * 2)\n\n \n#define TRB_TYPE_BITMASK\tGENMASK(15, 10)\n#define TRB_TYPE(p)\t\t((p) << 10)\n#define TRB_FIELD_TO_TYPE(p)\t(((p) & TRB_TYPE_BITMASK) >> 10)\n\n \n \n#define TRB_NORMAL\t\t1\n \n#define TRB_LINK\t\t6\n\n \n#define TRB_CYCLE\t\tBIT(0)\n \n#define TRB_TOGGLE\t\tBIT(1)\n \n#define TRB_SMM\t\t\tBIT(1)\n\n \n#define TRB_SP\t\t\tBIT(1)\n\n \n#define TRB_ISP\t\t\tBIT(2)\n \n#define TRB_FIFO_MODE\t\tBIT(3)\n \n#define TRB_CHAIN\t\tBIT(4)\n \n#define TRB_IOC\t\t\tBIT(5)\n\n \n#define TRB_STREAM_ID_BITMASK\t\tGENMASK(31, 16)\n#define TRB_STREAM_ID(p)\t\t((p) << 16)\n#define TRB_FIELD_TO_STREAMID(p)\t(((p) & TRB_STREAM_ID_BITMASK) >> 16)\n\n \n#define TRB_TDL_HS_SIZE(p)\t(((p) << 16) & GENMASK(31, 16))\n#define TRB_TDL_HS_SIZE_GET(p)\t(((p) & GENMASK(31, 16)) >> 16)\n\n \n#define TRB_LEN(p)\t\t((p) & GENMASK(16, 0))\n\n \n#define TRB_TDL_SS_SIZE(p)\t(((p) << 17) & GENMASK(23, 17))\n#define TRB_TDL_SS_SIZE_GET(p)\t(((p) & GENMASK(23, 17)) >> 17)\n\n \n#define TRB_BURST_LEN(p)\t((unsigned int)((p) << 24) & GENMASK(31, 24))\n#define TRB_BURST_LEN_GET(p)\t(((p) & GENMASK(31, 24)) >> 24)\n\n \n#define TRB_BUFFER(p)\t\t((p) & GENMASK(31, 0))\n\n \n \n\n \n#define USB_DEVICE_MAX_ADDRESS\t\t127\n\n \n#define CDNS3_EP_MAX_PACKET_LIMIT\t1024\n#define CDNS3_EP_MAX_STREAMS\t\t15\n#define CDNS3_EP0_MAX_PACKET_LIMIT\t512\n\n \n#define CDNS3_ENDPOINTS_MAX_COUNT\t32\n#define CDNS3_EP_ZLP_BUF_SIZE\t\t1024\n\n#define CDNS3_MAX_NUM_DESCMISS_BUF\t32\n#define CDNS3_DESCMIS_BUF_SIZE\t\t2048\t \n#define CDNS3_WA2_NUM_BUFFERS\t\t128\n \n \n\nstruct cdns3_device;\n\n \nstruct cdns3_endpoint {\n\tstruct usb_ep\t\tendpoint;\n\tstruct list_head\tpending_req_list;\n\tstruct list_head\tdeferred_req_list;\n\tstruct list_head\twa2_descmiss_req_list;\n\tint\t\t\twa2_counter;\n\n\tstruct cdns3_trb\t*trb_pool;\n\tdma_addr_t\t\ttrb_pool_dma;\n\n\tstruct cdns3_device\t*cdns3_dev;\n\tchar\t\t\tname[20];\n\n#define EP_ENABLED\t\tBIT(0)\n#define EP_STALLED\t\tBIT(1)\n#define EP_STALL_PENDING\tBIT(2)\n#define EP_WEDGE\t\tBIT(3)\n#define EP_TRANSFER_STARTED\tBIT(4)\n#define EP_UPDATE_EP_TRBADDR\tBIT(5)\n#define EP_PENDING_REQUEST\tBIT(6)\n#define EP_RING_FULL\t\tBIT(7)\n#define EP_CLAIMED\t\tBIT(8)\n#define EP_DEFERRED_DRDY\tBIT(9)\n#define EP_QUIRK_ISO_OUT_EN\tBIT(10)\n#define EP_QUIRK_END_TRANSFER\tBIT(11)\n#define EP_QUIRK_EXTRA_BUF_DET\tBIT(12)\n#define EP_QUIRK_EXTRA_BUF_EN\tBIT(13)\n#define EP_TDLCHK_EN\t\tBIT(15)\n#define EP_CONFIGURED\t\tBIT(16)\n\tu32\t\t\tflags;\n\n\tstruct cdns3_request\t*descmis_req;\n\n\tu8\t\t\tdir;\n\tu8\t\t\tnum;\n\tu8\t\t\ttype;\n\tu8\t\t\tmult;\n\tu8\t\t\tbMaxBurst;\n\tu16\t\t\twMaxPacketSize;\n\tint\t\t\tinterval;\n\n\tint\t\t\tfree_trbs;\n\tint\t\t\tnum_trbs;\n\tint\t\t\talloc_ring_size;\n\tu8\t\t\tpcs;\n\tu8\t\t\tccs;\n\tint\t\t\tenqueue;\n\tint\t\t\tdequeue;\n\tu8\t\t\ttrb_burst_size;\n\n\tunsigned int\t\twa1_set:1;\n\tstruct cdns3_trb\t*wa1_trb;\n\tunsigned int\t\twa1_trb_index;\n\tunsigned int\t\twa1_cycle_bit:1;\n\n\t \n\tunsigned int\t\tuse_streams:1;\n\tunsigned int\t\tprime_flag:1;\n\tu32\t\t\tep_sts_pending;\n\tu16\t\t\tlast_stream_id;\n\tu16\t\t\tpending_tdl;\n\tunsigned int\t\tstream_sg_idx;\n};\n\n \nstruct cdns3_aligned_buf {\n\tvoid\t\t\t*buf;\n\tdma_addr_t\t\tdma;\n\tu32\t\t\tsize;\n\tenum dma_data_direction dir;\n\tunsigned\t\tin_use:1;\n\tstruct list_head\tlist;\n};\n\n \nstruct cdns3_request {\n\tstruct usb_request\t\trequest;\n\tstruct cdns3_endpoint\t\t*priv_ep;\n\tstruct cdns3_trb\t\t*trb;\n\tint\t\t\t\tstart_trb;\n\tint\t\t\t\tend_trb;\n\tstruct cdns3_aligned_buf\t*aligned_buf;\n#define REQUEST_PENDING\t\t\tBIT(0)\n#define REQUEST_INTERNAL\t\tBIT(1)\n#define REQUEST_INTERNAL_CH\t\tBIT(2)\n#define REQUEST_ZLP\t\t\tBIT(3)\n#define REQUEST_UNALIGNED\t\tBIT(4)\n\tu32\t\t\t\tflags;\n\tstruct list_head\t\tlist;\n\tint\t\t\t\tfinished_trb;\n\tint\t\t\t\tnum_of_trb;\n};\n\n#define to_cdns3_request(r) (container_of(r, struct cdns3_request, request))\n\n \n#define CDNS3_SETUP_STAGE\t\t0x0\n#define CDNS3_DATA_STAGE\t\t0x1\n#define CDNS3_STATUS_STAGE\t\t0x2\n\n \nstruct cdns3_device {\n\tstruct device\t\t\t*dev;\n\tstruct device\t\t\t*sysdev;\n\n\tstruct usb_gadget\t\tgadget;\n\tstruct usb_gadget_driver\t*gadget_driver;\n\n#define CDNS_REVISION_V0\t\t0x00024501\n#define CDNS_REVISION_V1\t\t0x00024509\n\tu32\t\t\t\tdev_ver;\n\n\t \n\tspinlock_t\t\t\tlock;\n\n\tstruct cdns3_usb_regs\t\t__iomem *regs;\n\n\tstruct dma_pool\t\t\t*eps_dma_pool;\n\tstruct usb_ctrlrequest\t\t*setup_buf;\n\tdma_addr_t\t\t\tsetup_dma;\n\tvoid\t\t\t\t*zlp_buf;\n\n\tu8\t\t\t\tep0_stage;\n\tint\t\t\t\tep0_data_dir;\n\n\tstruct cdns3_endpoint\t\t*eps[CDNS3_ENDPOINTS_MAX_COUNT];\n\n\tstruct list_head\t\taligned_buf_list;\n\tstruct work_struct\t\taligned_buf_wq;\n\n\tu32\t\t\t\tselected_ep;\n\tu16\t\t\t\tisoch_delay;\n\n\tunsigned\t\t\twait_for_setup:1;\n\tunsigned\t\t\tu1_allowed:1;\n\tunsigned\t\t\tu2_allowed:1;\n\tunsigned\t\t\tis_selfpowered:1;\n\tunsigned\t\t\tsetup_pending:1;\n\tunsigned\t\t\thw_configured_flag:1;\n\tunsigned\t\t\twake_up_flag:1;\n\tunsigned\t\t\tstatus_completion_no_call:1;\n\tunsigned\t\t\tusing_streams:1;\n\tint\t\t\t\tout_mem_is_allocated;\n\n\tstruct work_struct\t\tpending_status_wq;\n\tstruct usb_request\t\t*pending_status_request;\n\n\t \n\tu16\t\t\t\tonchip_buffers;\n\tu16\t\t\t\tonchip_used_size;\n\n\tu16\t\t\t\tep_buf_size;\n\tu16\t\t\t\tep_iso_burst;\n};\n\nvoid cdns3_set_register_bit(void __iomem *ptr, u32 mask);\ndma_addr_t cdns3_trb_virt_to_dma(struct cdns3_endpoint *priv_ep,\n\t\t\t\t struct cdns3_trb *trb);\nenum usb_device_speed cdns3_get_speed(struct cdns3_device *priv_dev);\nvoid cdns3_pending_setup_status_handler(struct work_struct *work);\nvoid cdns3_hw_reset_eps_config(struct cdns3_device *priv_dev);\nvoid cdns3_set_hw_configuration(struct cdns3_device *priv_dev);\nvoid cdns3_select_ep(struct cdns3_device *priv_dev, u32 ep);\nvoid cdns3_allow_enable_l1(struct cdns3_device *priv_dev, int enable);\nstruct usb_request *cdns3_next_request(struct list_head *list);\nvoid cdns3_rearm_transfer(struct cdns3_endpoint *priv_ep, u8 rearm);\nint cdns3_allocate_trb_pool(struct cdns3_endpoint *priv_ep);\nu8 cdns3_ep_addr_to_index(u8 ep_addr);\nint cdns3_gadget_ep_set_wedge(struct usb_ep *ep);\nint cdns3_gadget_ep_set_halt(struct usb_ep *ep, int value);\nvoid __cdns3_gadget_ep_set_halt(struct cdns3_endpoint *priv_ep);\nint __cdns3_gadget_ep_clear_halt(struct cdns3_endpoint *priv_ep);\nstruct usb_request *cdns3_gadget_ep_alloc_request(struct usb_ep *ep,\n\t\t\t\t\t\t  gfp_t gfp_flags);\nvoid cdns3_gadget_ep_free_request(struct usb_ep *ep,\n\t\t\t\t  struct usb_request *request);\nint cdns3_gadget_ep_dequeue(struct usb_ep *ep, struct usb_request *request);\nvoid cdns3_gadget_giveback(struct cdns3_endpoint *priv_ep,\n\t\t\t   struct cdns3_request *priv_req,\n\t\t\t   int status);\n\nint cdns3_init_ep0(struct cdns3_device *priv_dev,\n\t\t   struct cdns3_endpoint *priv_ep);\nvoid cdns3_ep0_config(struct cdns3_device *priv_dev);\nint cdns3_ep_config(struct cdns3_endpoint *priv_ep, bool enable);\nvoid cdns3_check_ep0_interrupt_proceed(struct cdns3_device *priv_dev, int dir);\nint __cdns3_gadget_wakeup(struct cdns3_device *priv_dev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}