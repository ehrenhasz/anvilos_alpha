{
  "module_name": "core.h",
  "hash_id": "92ad05187968fa7986d986fc4d1bd12fd8b7e87f5c13824e3b9986de5d5b83f0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/dwc3/core.h",
  "human_readable_source": " \n \n\n#ifndef __DRIVERS_USB_DWC3_CORE_H\n#define __DRIVERS_USB_DWC3_CORE_H\n\n#include <linux/device.h>\n#include <linux/spinlock.h>\n#include <linux/mutex.h>\n#include <linux/ioport.h>\n#include <linux/list.h>\n#include <linux/bitops.h>\n#include <linux/dma-mapping.h>\n#include <linux/mm.h>\n#include <linux/debugfs.h>\n#include <linux/wait.h>\n#include <linux/workqueue.h>\n\n#include <linux/usb/ch9.h>\n#include <linux/usb/gadget.h>\n#include <linux/usb/otg.h>\n#include <linux/usb/role.h>\n#include <linux/ulpi/interface.h>\n\n#include <linux/phy/phy.h>\n\n#include <linux/power_supply.h>\n\n#define DWC3_MSG_MAX\t500\n\n \n#define DWC3_PULL_UP_TIMEOUT\t500\t \n#define DWC3_BOUNCE_SIZE\t1024\t \n#define DWC3_EP0_SETUP_SIZE\t512\n#define DWC3_ENDPOINTS_NUM\t32\n#define DWC3_XHCI_RESOURCES_NUM\t2\n#define DWC3_ISOC_MAX_RETRIES\t5\n\n#define DWC3_SCRATCHBUF_SIZE\t4096\t \n#define DWC3_EVENT_BUFFERS_SIZE\t4096\n#define DWC3_EVENT_TYPE_MASK\t0xfe\n\n#define DWC3_EVENT_TYPE_DEV\t0\n#define DWC3_EVENT_TYPE_CARKIT\t3\n#define DWC3_EVENT_TYPE_I2C\t4\n\n#define DWC3_DEVICE_EVENT_DISCONNECT\t\t0\n#define DWC3_DEVICE_EVENT_RESET\t\t\t1\n#define DWC3_DEVICE_EVENT_CONNECT_DONE\t\t2\n#define DWC3_DEVICE_EVENT_LINK_STATUS_CHANGE\t3\n#define DWC3_DEVICE_EVENT_WAKEUP\t\t4\n#define DWC3_DEVICE_EVENT_HIBER_REQ\t\t5\n#define DWC3_DEVICE_EVENT_SUSPEND\t\t6\n#define DWC3_DEVICE_EVENT_SOF\t\t\t7\n#define DWC3_DEVICE_EVENT_ERRATIC_ERROR\t\t9\n#define DWC3_DEVICE_EVENT_CMD_CMPL\t\t10\n#define DWC3_DEVICE_EVENT_OVERFLOW\t\t11\n\n \n#define DWC3_OTG_ROLE_IDLE\t0\n#define DWC3_OTG_ROLE_HOST\t1\n#define DWC3_OTG_ROLE_DEVICE\t2\n\n#define DWC3_GEVNTCOUNT_MASK\t0xfffc\n#define DWC3_GEVNTCOUNT_EHB\tBIT(31)\n#define DWC3_GSNPSID_MASK\t0xffff0000\n#define DWC3_GSNPSREV_MASK\t0xffff\n#define DWC3_GSNPS_ID(p)\t(((p) & DWC3_GSNPSID_MASK) >> 16)\n\n \n#define DWC3_XHCI_REGS_START\t\t0x0\n#define DWC3_XHCI_REGS_END\t\t0x7fff\n#define DWC3_GLOBALS_REGS_START\t\t0xc100\n#define DWC3_GLOBALS_REGS_END\t\t0xc6ff\n#define DWC3_DEVICE_REGS_START\t\t0xc700\n#define DWC3_DEVICE_REGS_END\t\t0xcbff\n#define DWC3_OTG_REGS_START\t\t0xcc00\n#define DWC3_OTG_REGS_END\t\t0xccff\n\n#define DWC3_RTK_RTD_GLOBALS_REGS_START\t0x8100\n\n \n#define DWC3_GSBUSCFG0\t\t0xc100\n#define DWC3_GSBUSCFG1\t\t0xc104\n#define DWC3_GTXTHRCFG\t\t0xc108\n#define DWC3_GRXTHRCFG\t\t0xc10c\n#define DWC3_GCTL\t\t0xc110\n#define DWC3_GEVTEN\t\t0xc114\n#define DWC3_GSTS\t\t0xc118\n#define DWC3_GUCTL1\t\t0xc11c\n#define DWC3_GSNPSID\t\t0xc120\n#define DWC3_GGPIO\t\t0xc124\n#define DWC3_GUID\t\t0xc128\n#define DWC3_GUCTL\t\t0xc12c\n#define DWC3_GBUSERRADDR0\t0xc130\n#define DWC3_GBUSERRADDR1\t0xc134\n#define DWC3_GPRTBIMAP0\t\t0xc138\n#define DWC3_GPRTBIMAP1\t\t0xc13c\n#define DWC3_GHWPARAMS0\t\t0xc140\n#define DWC3_GHWPARAMS1\t\t0xc144\n#define DWC3_GHWPARAMS2\t\t0xc148\n#define DWC3_GHWPARAMS3\t\t0xc14c\n#define DWC3_GHWPARAMS4\t\t0xc150\n#define DWC3_GHWPARAMS5\t\t0xc154\n#define DWC3_GHWPARAMS6\t\t0xc158\n#define DWC3_GHWPARAMS7\t\t0xc15c\n#define DWC3_GDBGFIFOSPACE\t0xc160\n#define DWC3_GDBGLTSSM\t\t0xc164\n#define DWC3_GDBGBMU\t\t0xc16c\n#define DWC3_GDBGLSPMUX\t\t0xc170\n#define DWC3_GDBGLSP\t\t0xc174\n#define DWC3_GDBGEPINFO0\t0xc178\n#define DWC3_GDBGEPINFO1\t0xc17c\n#define DWC3_GPRTBIMAP_HS0\t0xc180\n#define DWC3_GPRTBIMAP_HS1\t0xc184\n#define DWC3_GPRTBIMAP_FS0\t0xc188\n#define DWC3_GPRTBIMAP_FS1\t0xc18c\n#define DWC3_GUCTL2\t\t0xc19c\n\n#define DWC3_VER_NUMBER\t\t0xc1a0\n#define DWC3_VER_TYPE\t\t0xc1a4\n\n#define DWC3_GUSB2PHYCFG(n)\t(0xc200 + ((n) * 0x04))\n#define DWC3_GUSB2I2CCTL(n)\t(0xc240 + ((n) * 0x04))\n\n#define DWC3_GUSB2PHYACC(n)\t(0xc280 + ((n) * 0x04))\n\n#define DWC3_GUSB3PIPECTL(n)\t(0xc2c0 + ((n) * 0x04))\n\n#define DWC3_GTXFIFOSIZ(n)\t(0xc300 + ((n) * 0x04))\n#define DWC3_GRXFIFOSIZ(n)\t(0xc380 + ((n) * 0x04))\n\n#define DWC3_GEVNTADRLO(n)\t(0xc400 + ((n) * 0x10))\n#define DWC3_GEVNTADRHI(n)\t(0xc404 + ((n) * 0x10))\n#define DWC3_GEVNTSIZ(n)\t(0xc408 + ((n) * 0x10))\n#define DWC3_GEVNTCOUNT(n)\t(0xc40c + ((n) * 0x10))\n\n#define DWC3_GHWPARAMS8\t\t0xc600\n#define DWC3_GUCTL3\t\t0xc60c\n#define DWC3_GFLADJ\t\t0xc630\n#define DWC3_GHWPARAMS9\t\t0xc6e0\n\n \n#define DWC3_DCFG\t\t0xc700\n#define DWC3_DCTL\t\t0xc704\n#define DWC3_DEVTEN\t\t0xc708\n#define DWC3_DSTS\t\t0xc70c\n#define DWC3_DGCMDPAR\t\t0xc710\n#define DWC3_DGCMD\t\t0xc714\n#define DWC3_DALEPENA\t\t0xc720\n#define DWC3_DCFG1\t\t0xc740  \n\n#define DWC3_DEP_BASE(n)\t(0xc800 + ((n) * 0x10))\n#define DWC3_DEPCMDPAR2\t\t0x00\n#define DWC3_DEPCMDPAR1\t\t0x04\n#define DWC3_DEPCMDPAR0\t\t0x08\n#define DWC3_DEPCMD\t\t0x0c\n\n#define DWC3_DEV_IMOD(n)\t(0xca00 + ((n) * 0x4))\n\n \n#define DWC3_OCFG\t\t0xcc00\n#define DWC3_OCTL\t\t0xcc04\n#define DWC3_OEVT\t\t0xcc08\n#define DWC3_OEVTEN\t\t0xcc0C\n#define DWC3_OSTS\t\t0xcc10\n\n \n\n \n#define DWC3_GSBUSCFG0_INCR256BRSTENA\t(1 << 7)  \n#define DWC3_GSBUSCFG0_INCR128BRSTENA\t(1 << 6)  \n#define DWC3_GSBUSCFG0_INCR64BRSTENA\t(1 << 5)  \n#define DWC3_GSBUSCFG0_INCR32BRSTENA\t(1 << 4)  \n#define DWC3_GSBUSCFG0_INCR16BRSTENA\t(1 << 3)  \n#define DWC3_GSBUSCFG0_INCR8BRSTENA\t(1 << 2)  \n#define DWC3_GSBUSCFG0_INCR4BRSTENA\t(1 << 1)  \n#define DWC3_GSBUSCFG0_INCRBRSTENA\t(1 << 0)  \n#define DWC3_GSBUSCFG0_INCRBRST_MASK\t0xff\n\n \n#define DWC3_GDBGLSPMUX_ENDBC\t\tBIT(15)\t \n#define DWC3_GDBGLSPMUX_HOSTSELECT(n)\t((n) & 0x3fff)\n#define DWC3_GDBGLSPMUX_DEVSELECT(n)\t(((n) & 0xf) << 4)\n#define DWC3_GDBGLSPMUX_EPSELECT(n)\t((n) & 0xf)\n\n \n#define DWC3_GDBGFIFOSPACE_NUM(n)\t((n) & 0x1f)\n#define DWC3_GDBGFIFOSPACE_TYPE(n)\t(((n) << 5) & 0x1e0)\n#define DWC3_GDBGFIFOSPACE_SPACE_AVAILABLE(n) (((n) >> 16) & 0xffff)\n\n#define DWC3_TXFIFO\t\t0\n#define DWC3_RXFIFO\t\t1\n#define DWC3_TXREQQ\t\t2\n#define DWC3_RXREQQ\t\t3\n#define DWC3_RXINFOQ\t\t4\n#define DWC3_PSTATQ\t\t5\n#define DWC3_DESCFETCHQ\t\t6\n#define DWC3_EVENTQ\t\t7\n#define DWC3_AUXEVENTQ\t\t8\n\n \n#define DWC3_GRXTHRCFG_MAXRXBURSTSIZE(n) (((n) & 0x1f) << 19)\n#define DWC3_GRXTHRCFG_RXPKTCNT(n) (((n) & 0xf) << 24)\n#define DWC3_GRXTHRCFG_PKTCNTSEL BIT(29)\n\n \n#define DWC3_GTXTHRCFG_MAXTXBURSTSIZE(n) (((n) & 0xff) << 16)\n#define DWC3_GTXTHRCFG_TXPKTCNT(n) (((n) & 0xf) << 24)\n#define DWC3_GTXTHRCFG_PKTCNTSEL BIT(29)\n\n \n#define DWC31_GRXTHRCFG_MAXRXBURSTSIZE(n)\t(((n) & 0x1f) << 16)\n#define DWC31_GRXTHRCFG_RXPKTCNT(n)\t\t(((n) & 0x1f) << 21)\n#define DWC31_GRXTHRCFG_PKTCNTSEL\t\tBIT(26)\n#define DWC31_RXTHRNUMPKTSEL_HS_PRD\t\tBIT(15)\n#define DWC31_RXTHRNUMPKT_HS_PRD(n)\t\t(((n) & 0x3) << 13)\n#define DWC31_RXTHRNUMPKTSEL_PRD\t\tBIT(10)\n#define DWC31_RXTHRNUMPKT_PRD(n)\t\t(((n) & 0x1f) << 5)\n#define DWC31_MAXRXBURSTSIZE_PRD(n)\t\t((n) & 0x1f)\n\n \n#define DWC31_GTXTHRCFG_MAXTXBURSTSIZE(n)\t(((n) & 0x1f) << 16)\n#define DWC31_GTXTHRCFG_TXPKTCNT(n)\t\t(((n) & 0x1f) << 21)\n#define DWC31_GTXTHRCFG_PKTCNTSEL\t\tBIT(26)\n#define DWC31_TXTHRNUMPKTSEL_HS_PRD\t\tBIT(15)\n#define DWC31_TXTHRNUMPKT_HS_PRD(n)\t\t(((n) & 0x3) << 13)\n#define DWC31_TXTHRNUMPKTSEL_PRD\t\tBIT(10)\n#define DWC31_TXTHRNUMPKT_PRD(n)\t\t(((n) & 0x1f) << 5)\n#define DWC31_MAXTXBURSTSIZE_PRD(n)\t\t((n) & 0x1f)\n\n \n#define DWC3_GCTL_PWRDNSCALE(n)\t((n) << 19)\n#define DWC3_GCTL_PWRDNSCALE_MASK\tGENMASK(31, 19)\n#define DWC3_GCTL_U2RSTECN\tBIT(16)\n#define DWC3_GCTL_RAMCLKSEL(x)\t(((x) & DWC3_GCTL_CLK_MASK) << 6)\n#define DWC3_GCTL_CLK_BUS\t(0)\n#define DWC3_GCTL_CLK_PIPE\t(1)\n#define DWC3_GCTL_CLK_PIPEHALF\t(2)\n#define DWC3_GCTL_CLK_MASK\t(3)\n\n#define DWC3_GCTL_PRTCAP(n)\t(((n) & (3 << 12)) >> 12)\n#define DWC3_GCTL_PRTCAPDIR(n)\t((n) << 12)\n#define DWC3_GCTL_PRTCAP_HOST\t1\n#define DWC3_GCTL_PRTCAP_DEVICE\t2\n#define DWC3_GCTL_PRTCAP_OTG\t3\n\n#define DWC3_GCTL_CORESOFTRESET\t\tBIT(11)\n#define DWC3_GCTL_SOFITPSYNC\t\tBIT(10)\n#define DWC3_GCTL_SCALEDOWN(n)\t\t((n) << 4)\n#define DWC3_GCTL_SCALEDOWN_MASK\tDWC3_GCTL_SCALEDOWN(3)\n#define DWC3_GCTL_DISSCRAMBLE\t\tBIT(3)\n#define DWC3_GCTL_U2EXIT_LFPS\t\tBIT(2)\n#define DWC3_GCTL_GBLHIBERNATIONEN\tBIT(1)\n#define DWC3_GCTL_DSBLCLKGTNG\t\tBIT(0)\n\n \n#define DWC3_GUCTL1_DEV_DECOUPLE_L1L2_EVT\tBIT(31)\n#define DWC3_GUCTL1_TX_IPGAP_LINECHECK_DIS\tBIT(28)\n#define DWC3_GUCTL1_DEV_FORCE_20_CLK_FOR_30_CLK\tBIT(26)\n#define DWC3_GUCTL1_DEV_L1_EXIT_BY_HW\t\tBIT(24)\n#define DWC3_GUCTL1_PARKMODE_DISABLE_SS\t\tBIT(17)\n#define DWC3_GUCTL1_PARKMODE_DISABLE_HS\t\tBIT(16)\n#define DWC3_GUCTL1_RESUME_OPMODE_HS_HOST\tBIT(10)\n\n \n#define DWC3_GSTS_OTG_IP\tBIT(10)\n#define DWC3_GSTS_BC_IP\t\tBIT(9)\n#define DWC3_GSTS_ADP_IP\tBIT(8)\n#define DWC3_GSTS_HOST_IP\tBIT(7)\n#define DWC3_GSTS_DEVICE_IP\tBIT(6)\n#define DWC3_GSTS_CSR_TIMEOUT\tBIT(5)\n#define DWC3_GSTS_BUS_ERR_ADDR_VLD\tBIT(4)\n#define DWC3_GSTS_CURMOD(n)\t((n) & 0x3)\n#define DWC3_GSTS_CURMOD_DEVICE\t0\n#define DWC3_GSTS_CURMOD_HOST\t1\n\n \n#define DWC3_GUSB2PHYCFG_PHYSOFTRST\tBIT(31)\n#define DWC3_GUSB2PHYCFG_U2_FREECLK_EXISTS\tBIT(30)\n#define DWC3_GUSB2PHYCFG_ULPIEXTVBUSDRV\tBIT(17)\n#define DWC3_GUSB2PHYCFG_SUSPHY\t\tBIT(6)\n#define DWC3_GUSB2PHYCFG_ULPI_UTMI\tBIT(4)\n#define DWC3_GUSB2PHYCFG_ENBLSLPM\tBIT(8)\n#define DWC3_GUSB2PHYCFG_PHYIF(n)\t(n << 3)\n#define DWC3_GUSB2PHYCFG_PHYIF_MASK\tDWC3_GUSB2PHYCFG_PHYIF(1)\n#define DWC3_GUSB2PHYCFG_USBTRDTIM(n)\t(n << 10)\n#define DWC3_GUSB2PHYCFG_USBTRDTIM_MASK\tDWC3_GUSB2PHYCFG_USBTRDTIM(0xf)\n#define USBTRDTIM_UTMI_8_BIT\t\t9\n#define USBTRDTIM_UTMI_16_BIT\t\t5\n#define UTMI_PHYIF_16_BIT\t\t1\n#define UTMI_PHYIF_8_BIT\t\t0\n\n \n#define DWC3_GUSB2PHYACC_NEWREGREQ\tBIT(25)\n#define DWC3_GUSB2PHYACC_DONE\t\tBIT(24)\n#define DWC3_GUSB2PHYACC_BUSY\t\tBIT(23)\n#define DWC3_GUSB2PHYACC_WRITE\t\tBIT(22)\n#define DWC3_GUSB2PHYACC_ADDR(n)\t(n << 16)\n#define DWC3_GUSB2PHYACC_EXTEND_ADDR(n)\t(n << 8)\n#define DWC3_GUSB2PHYACC_DATA(n)\t(n & 0xff)\n\n \n#define DWC3_GUSB3PIPECTL_PHYSOFTRST\tBIT(31)\n#define DWC3_GUSB3PIPECTL_U2SSINP3OK\tBIT(29)\n#define DWC3_GUSB3PIPECTL_DISRXDETINP3\tBIT(28)\n#define DWC3_GUSB3PIPECTL_UX_EXIT_PX\tBIT(27)\n#define DWC3_GUSB3PIPECTL_REQP1P2P3\tBIT(24)\n#define DWC3_GUSB3PIPECTL_DEP1P2P3(n)\t((n) << 19)\n#define DWC3_GUSB3PIPECTL_DEP1P2P3_MASK\tDWC3_GUSB3PIPECTL_DEP1P2P3(7)\n#define DWC3_GUSB3PIPECTL_DEP1P2P3_EN\tDWC3_GUSB3PIPECTL_DEP1P2P3(1)\n#define DWC3_GUSB3PIPECTL_DEPOCHANGE\tBIT(18)\n#define DWC3_GUSB3PIPECTL_SUSPHY\tBIT(17)\n#define DWC3_GUSB3PIPECTL_LFPSFILT\tBIT(9)\n#define DWC3_GUSB3PIPECTL_RX_DETOPOLL\tBIT(8)\n#define DWC3_GUSB3PIPECTL_TX_DEEPH_MASK\tDWC3_GUSB3PIPECTL_TX_DEEPH(3)\n#define DWC3_GUSB3PIPECTL_TX_DEEPH(n)\t((n) << 1)\n\n \n#define DWC31_GTXFIFOSIZ_TXFRAMNUM\tBIT(15)\t\t \n#define DWC31_GTXFIFOSIZ_TXFDEP(n)\t((n) & 0x7fff)\t \n#define DWC3_GTXFIFOSIZ_TXFDEP(n)\t((n) & 0xffff)\n#define DWC3_GTXFIFOSIZ_TXFSTADDR(n)\t((n) & 0xffff0000)\n\n \n#define DWC31_GRXFIFOSIZ_RXFDEP(n)\t((n) & 0x7fff)\t \n#define DWC3_GRXFIFOSIZ_RXFDEP(n)\t((n) & 0xffff)\n\n \n#define DWC3_GEVNTSIZ_INTMASK\t\tBIT(31)\n#define DWC3_GEVNTSIZ_SIZE(n)\t\t((n) & 0xffff)\n\n \n#define DWC3_GHWPARAMS0_MODE(n)\t\t((n) & 0x3)\n#define DWC3_GHWPARAMS0_MODE_GADGET\t0\n#define DWC3_GHWPARAMS0_MODE_HOST\t1\n#define DWC3_GHWPARAMS0_MODE_DRD\t2\n#define DWC3_GHWPARAMS0_MBUS_TYPE(n)\t(((n) >> 3) & 0x7)\n#define DWC3_GHWPARAMS0_SBUS_TYPE(n)\t(((n) >> 6) & 0x3)\n#define DWC3_GHWPARAMS0_MDWIDTH(n)\t(((n) >> 8) & 0xff)\n#define DWC3_GHWPARAMS0_SDWIDTH(n)\t(((n) >> 16) & 0xff)\n#define DWC3_GHWPARAMS0_AWIDTH(n)\t(((n) >> 24) & 0xff)\n\n \n#define DWC3_GHWPARAMS1_EN_PWROPT(n)\t(((n) & (3 << 24)) >> 24)\n#define DWC3_GHWPARAMS1_EN_PWROPT_NO\t0\n#define DWC3_GHWPARAMS1_EN_PWROPT_CLK\t1\n#define DWC3_GHWPARAMS1_EN_PWROPT_HIB\t2\n#define DWC3_GHWPARAMS1_PWROPT(n)\t((n) << 24)\n#define DWC3_GHWPARAMS1_PWROPT_MASK\tDWC3_GHWPARAMS1_PWROPT(3)\n#define DWC3_GHWPARAMS1_ENDBC\t\tBIT(31)\n\n \n#define DWC3_GHWPARAMS3_SSPHY_IFC(n)\t\t((n) & 3)\n#define DWC3_GHWPARAMS3_SSPHY_IFC_DIS\t\t0\n#define DWC3_GHWPARAMS3_SSPHY_IFC_GEN1\t\t1\n#define DWC3_GHWPARAMS3_SSPHY_IFC_GEN2\t\t2  \n#define DWC3_GHWPARAMS3_HSPHY_IFC(n)\t\t(((n) & (3 << 2)) >> 2)\n#define DWC3_GHWPARAMS3_HSPHY_IFC_DIS\t\t0\n#define DWC3_GHWPARAMS3_HSPHY_IFC_UTMI\t\t1\n#define DWC3_GHWPARAMS3_HSPHY_IFC_ULPI\t\t2\n#define DWC3_GHWPARAMS3_HSPHY_IFC_UTMI_ULPI\t3\n#define DWC3_GHWPARAMS3_FSPHY_IFC(n)\t\t(((n) & (3 << 4)) >> 4)\n#define DWC3_GHWPARAMS3_FSPHY_IFC_DIS\t\t0\n#define DWC3_GHWPARAMS3_FSPHY_IFC_ENA\t\t1\n\n \n#define DWC3_GHWPARAMS4_HIBER_SCRATCHBUFS(n)\t(((n) & (0x0f << 13)) >> 13)\n#define DWC3_MAX_HIBER_SCRATCHBUFS\t\t15\n\n \n#define DWC3_GHWPARAMS6_BCSUPPORT\t\tBIT(14)\n#define DWC3_GHWPARAMS6_OTG3SUPPORT\t\tBIT(13)\n#define DWC3_GHWPARAMS6_ADPSUPPORT\t\tBIT(12)\n#define DWC3_GHWPARAMS6_HNPSUPPORT\t\tBIT(11)\n#define DWC3_GHWPARAMS6_SRPSUPPORT\t\tBIT(10)\n#define DWC3_GHWPARAMS6_EN_FPGA\t\t\tBIT(7)\n\n \n#define DWC3_GHWPARAMS6_MDWIDTH(n)\t\t((n) & (0x3 << 8))\n\n \n#define DWC3_GHWPARAMS7_RAM1_DEPTH(n)\t((n) & 0xffff)\n#define DWC3_GHWPARAMS7_RAM2_DEPTH(n)\t(((n) >> 16) & 0xffff)\n\n \n#define DWC3_GHWPARAMS9_DEV_TXF_FLUSH_BYPASS\tBIT(0)\n#define DWC3_GHWPARAMS9_DEV_MST\t\t\tBIT(1)\n\n \n#define DWC3_GFLADJ_30MHZ_SDBND_SEL\t\tBIT(7)\n#define DWC3_GFLADJ_30MHZ_MASK\t\t\t0x3f\n#define DWC3_GFLADJ_REFCLK_FLADJ_MASK\t\tGENMASK(21, 8)\n#define DWC3_GFLADJ_REFCLK_LPM_SEL\t\tBIT(23)\n#define DWC3_GFLADJ_240MHZDECR\t\t\tGENMASK(30, 24)\n#define DWC3_GFLADJ_240MHZDECR_PLS1\t\tBIT(31)\n\n \n#define DWC3_GUCTL_REFCLKPER_MASK\t\t0xffc00000\n#define DWC3_GUCTL_REFCLKPER_SEL\t\t22\n\n \n#define DWC3_GUCTL2_RST_ACTBITLATER\t\tBIT(14)\n\n \n#define DWC3_GUCTL3_SPLITDISABLE\t\tBIT(14)\n\n \n#define DWC3_DCFG_NUMLANES(n)\t(((n) & 0x3) << 30)  \n\n#define DWC3_DCFG_DEVADDR(addr)\t((addr) << 3)\n#define DWC3_DCFG_DEVADDR_MASK\tDWC3_DCFG_DEVADDR(0x7f)\n\n#define DWC3_DCFG_SPEED_MASK\t(7 << 0)\n#define DWC3_DCFG_SUPERSPEED_PLUS (5 << 0)   \n#define DWC3_DCFG_SUPERSPEED\t(4 << 0)\n#define DWC3_DCFG_HIGHSPEED\t(0 << 0)\n#define DWC3_DCFG_FULLSPEED\tBIT(0)\n\n#define DWC3_DCFG_NUMP_SHIFT\t17\n#define DWC3_DCFG_NUMP(n)\t(((n) >> DWC3_DCFG_NUMP_SHIFT) & 0x1f)\n#define DWC3_DCFG_NUMP_MASK\t(0x1f << DWC3_DCFG_NUMP_SHIFT)\n#define DWC3_DCFG_LPM_CAP\tBIT(22)\n#define DWC3_DCFG_IGNSTRMPP\tBIT(23)\n\n \n#define DWC3_DCTL_RUN_STOP\tBIT(31)\n#define DWC3_DCTL_CSFTRST\tBIT(30)\n#define DWC3_DCTL_LSFTRST\tBIT(29)\n\n#define DWC3_DCTL_HIRD_THRES_MASK\t(0x1f << 24)\n#define DWC3_DCTL_HIRD_THRES(n)\t((n) << 24)\n\n#define DWC3_DCTL_APPL1RES\tBIT(23)\n\n \n#define DWC3_DCTL_TRGTULST_MASK\t\t(0x0f << 17)\n#define DWC3_DCTL_TRGTULST(n)\t\t((n) << 17)\n#define DWC3_DCTL_TRGTULST_U2\t\t(DWC3_DCTL_TRGTULST(2))\n#define DWC3_DCTL_TRGTULST_U3\t\t(DWC3_DCTL_TRGTULST(3))\n#define DWC3_DCTL_TRGTULST_SS_DIS\t(DWC3_DCTL_TRGTULST(4))\n#define DWC3_DCTL_TRGTULST_RX_DET\t(DWC3_DCTL_TRGTULST(5))\n#define DWC3_DCTL_TRGTULST_SS_INACT\t(DWC3_DCTL_TRGTULST(6))\n\n \n#define DWC3_DCTL_NYET_THRES(n)\t\t(((n) & 0xf) << 20)\n\n#define DWC3_DCTL_KEEP_CONNECT\t\tBIT(19)\n#define DWC3_DCTL_L1_HIBER_EN\t\tBIT(18)\n#define DWC3_DCTL_CRS\t\t\tBIT(17)\n#define DWC3_DCTL_CSS\t\t\tBIT(16)\n\n#define DWC3_DCTL_INITU2ENA\t\tBIT(12)\n#define DWC3_DCTL_ACCEPTU2ENA\t\tBIT(11)\n#define DWC3_DCTL_INITU1ENA\t\tBIT(10)\n#define DWC3_DCTL_ACCEPTU1ENA\t\tBIT(9)\n#define DWC3_DCTL_TSTCTRL_MASK\t\t(0xf << 1)\n\n#define DWC3_DCTL_ULSTCHNGREQ_MASK\t(0x0f << 5)\n#define DWC3_DCTL_ULSTCHNGREQ(n) (((n) << 5) & DWC3_DCTL_ULSTCHNGREQ_MASK)\n\n#define DWC3_DCTL_ULSTCHNG_NO_ACTION\t(DWC3_DCTL_ULSTCHNGREQ(0))\n#define DWC3_DCTL_ULSTCHNG_SS_DISABLED\t(DWC3_DCTL_ULSTCHNGREQ(4))\n#define DWC3_DCTL_ULSTCHNG_RX_DETECT\t(DWC3_DCTL_ULSTCHNGREQ(5))\n#define DWC3_DCTL_ULSTCHNG_SS_INACTIVE\t(DWC3_DCTL_ULSTCHNGREQ(6))\n#define DWC3_DCTL_ULSTCHNG_RECOVERY\t(DWC3_DCTL_ULSTCHNGREQ(8))\n#define DWC3_DCTL_ULSTCHNG_COMPLIANCE\t(DWC3_DCTL_ULSTCHNGREQ(10))\n#define DWC3_DCTL_ULSTCHNG_LOOPBACK\t(DWC3_DCTL_ULSTCHNGREQ(11))\n\n \n#define DWC3_DEVTEN_VNDRDEVTSTRCVEDEN\tBIT(12)\n#define DWC3_DEVTEN_EVNTOVERFLOWEN\tBIT(11)\n#define DWC3_DEVTEN_CMDCMPLTEN\t\tBIT(10)\n#define DWC3_DEVTEN_ERRTICERREN\t\tBIT(9)\n#define DWC3_DEVTEN_SOFEN\t\tBIT(7)\n#define DWC3_DEVTEN_U3L2L1SUSPEN\tBIT(6)\n#define DWC3_DEVTEN_HIBERNATIONREQEVTEN\tBIT(5)\n#define DWC3_DEVTEN_WKUPEVTEN\t\tBIT(4)\n#define DWC3_DEVTEN_ULSTCNGEN\t\tBIT(3)\n#define DWC3_DEVTEN_CONNECTDONEEN\tBIT(2)\n#define DWC3_DEVTEN_USBRSTEN\t\tBIT(1)\n#define DWC3_DEVTEN_DISCONNEVTEN\tBIT(0)\n\n#define DWC3_DSTS_CONNLANES(n)\t\t(((n) >> 30) & 0x3)  \n\n \n#define DWC3_DSTS_DCNRD\t\t\tBIT(29)\n\n \n#define DWC3_DSTS_PWRUPREQ\t\tBIT(24)\n\n \n#define DWC3_DSTS_RSS\t\t\tBIT(25)\n#define DWC3_DSTS_SSS\t\t\tBIT(24)\n\n#define DWC3_DSTS_COREIDLE\t\tBIT(23)\n#define DWC3_DSTS_DEVCTRLHLT\t\tBIT(22)\n\n#define DWC3_DSTS_USBLNKST_MASK\t\t(0x0f << 18)\n#define DWC3_DSTS_USBLNKST(n)\t\t(((n) & DWC3_DSTS_USBLNKST_MASK) >> 18)\n\n#define DWC3_DSTS_RXFIFOEMPTY\t\tBIT(17)\n\n#define DWC3_DSTS_SOFFN_MASK\t\t(0x3fff << 3)\n#define DWC3_DSTS_SOFFN(n)\t\t(((n) & DWC3_DSTS_SOFFN_MASK) >> 3)\n\n#define DWC3_DSTS_CONNECTSPD\t\t(7 << 0)\n\n#define DWC3_DSTS_SUPERSPEED_PLUS\t(5 << 0)  \n#define DWC3_DSTS_SUPERSPEED\t\t(4 << 0)\n#define DWC3_DSTS_HIGHSPEED\t\t(0 << 0)\n#define DWC3_DSTS_FULLSPEED\t\tBIT(0)\n\n \n#define DWC3_DGCMD_SET_LMP\t\t0x01\n#define DWC3_DGCMD_SET_PERIODIC_PAR\t0x02\n#define DWC3_DGCMD_XMIT_FUNCTION\t0x03\n\n \n#define DWC3_DGCMD_SET_SCRATCHPAD_ADDR_LO\t0x04\n#define DWC3_DGCMD_SET_SCRATCHPAD_ADDR_HI\t0x05\n\n#define DWC3_DGCMD_SELECTED_FIFO_FLUSH\t0x09\n#define DWC3_DGCMD_ALL_FIFO_FLUSH\t0x0a\n#define DWC3_DGCMD_SET_ENDPOINT_NRDY\t0x0c\n#define DWC3_DGCMD_SET_ENDPOINT_PRIME\t0x0d\n#define DWC3_DGCMD_RUN_SOC_BUS_LOOPBACK\t0x10\n#define DWC3_DGCMD_DEV_NOTIFICATION\t0x07\n\n#define DWC3_DGCMD_STATUS(n)\t\t(((n) >> 12) & 0x0F)\n#define DWC3_DGCMD_CMDACT\t\tBIT(10)\n#define DWC3_DGCMD_CMDIOC\t\tBIT(8)\n\n \n#define DWC3_DGCMDPAR_FORCE_LINKPM_ACCEPT\tBIT(0)\n#define DWC3_DGCMDPAR_FIFO_NUM(n)\t\t((n) << 0)\n#define DWC3_DGCMDPAR_RX_FIFO\t\t\t(0 << 5)\n#define DWC3_DGCMDPAR_TX_FIFO\t\t\tBIT(5)\n#define DWC3_DGCMDPAR_LOOPBACK_DIS\t\t(0 << 0)\n#define DWC3_DGCMDPAR_LOOPBACK_ENA\t\tBIT(0)\n#define DWC3_DGCMDPAR_DN_FUNC_WAKE\t\tBIT(0)\n#define DWC3_DGCMDPAR_INTF_SEL(n)\t\t((n) << 4)\n\n \n#define DWC3_DEPCMD_PARAM_SHIFT\t\t16\n#define DWC3_DEPCMD_PARAM(x)\t\t((x) << DWC3_DEPCMD_PARAM_SHIFT)\n#define DWC3_DEPCMD_GET_RSC_IDX(x)\t(((x) >> DWC3_DEPCMD_PARAM_SHIFT) & 0x7f)\n#define DWC3_DEPCMD_STATUS(x)\t\t(((x) >> 12) & 0x0F)\n#define DWC3_DEPCMD_HIPRI_FORCERM\tBIT(11)\n#define DWC3_DEPCMD_CLEARPENDIN\t\tBIT(11)\n#define DWC3_DEPCMD_CMDACT\t\tBIT(10)\n#define DWC3_DEPCMD_CMDIOC\t\tBIT(8)\n\n#define DWC3_DEPCMD_DEPSTARTCFG\t\t(0x09 << 0)\n#define DWC3_DEPCMD_ENDTRANSFER\t\t(0x08 << 0)\n#define DWC3_DEPCMD_UPDATETRANSFER\t(0x07 << 0)\n#define DWC3_DEPCMD_STARTTRANSFER\t(0x06 << 0)\n#define DWC3_DEPCMD_CLEARSTALL\t\t(0x05 << 0)\n#define DWC3_DEPCMD_SETSTALL\t\t(0x04 << 0)\n \n#define DWC3_DEPCMD_GETSEQNUMBER\t(0x03 << 0)\n \n#define DWC3_DEPCMD_GETEPSTATE\t\t(0x03 << 0)\n#define DWC3_DEPCMD_SETTRANSFRESOURCE\t(0x02 << 0)\n#define DWC3_DEPCMD_SETEPCONFIG\t\t(0x01 << 0)\n\n#define DWC3_DEPCMD_CMD(x)\t\t((x) & 0xf)\n\n \n#define DWC3_DALEPENA_EP(n)\t\tBIT(n)\n\n \n#define DWC3_DCFG1_DIS_MST_ENH\t\tBIT(1)\n\n#define DWC3_DEPCMD_TYPE_CONTROL\t0\n#define DWC3_DEPCMD_TYPE_ISOC\t\t1\n#define DWC3_DEPCMD_TYPE_BULK\t\t2\n#define DWC3_DEPCMD_TYPE_INTR\t\t3\n\n#define DWC3_DEV_IMOD_COUNT_SHIFT\t16\n#define DWC3_DEV_IMOD_COUNT_MASK\t(0xffff << 16)\n#define DWC3_DEV_IMOD_INTERVAL_SHIFT\t0\n#define DWC3_DEV_IMOD_INTERVAL_MASK\t(0xffff << 0)\n\n \n#define DWC3_OCFG_DISPWRCUTTOFF\t\tBIT(5)\n#define DWC3_OCFG_HIBDISMASK\t\tBIT(4)\n#define DWC3_OCFG_SFTRSTMASK\t\tBIT(3)\n#define DWC3_OCFG_OTGVERSION\t\tBIT(2)\n#define DWC3_OCFG_HNPCAP\t\tBIT(1)\n#define DWC3_OCFG_SRPCAP\t\tBIT(0)\n\n \n#define DWC3_OCTL_OTG3GOERR\t\tBIT(7)\n#define DWC3_OCTL_PERIMODE\t\tBIT(6)\n#define DWC3_OCTL_PRTPWRCTL\t\tBIT(5)\n#define DWC3_OCTL_HNPREQ\t\tBIT(4)\n#define DWC3_OCTL_SESREQ\t\tBIT(3)\n#define DWC3_OCTL_TERMSELIDPULSE\tBIT(2)\n#define DWC3_OCTL_DEVSETHNPEN\t\tBIT(1)\n#define DWC3_OCTL_HSTSETHNPEN\t\tBIT(0)\n\n \n#define DWC3_OEVT_DEVICEMODE\t\tBIT(31)\n#define DWC3_OEVT_XHCIRUNSTPSET\t\tBIT(27)\n#define DWC3_OEVT_DEVRUNSTPSET\t\tBIT(26)\n#define DWC3_OEVT_HIBENTRY\t\tBIT(25)\n#define DWC3_OEVT_CONIDSTSCHNG\t\tBIT(24)\n#define DWC3_OEVT_HRRCONFNOTIF\t\tBIT(23)\n#define DWC3_OEVT_HRRINITNOTIF\t\tBIT(22)\n#define DWC3_OEVT_ADEVIDLE\t\tBIT(21)\n#define DWC3_OEVT_ADEVBHOSTEND\t\tBIT(20)\n#define DWC3_OEVT_ADEVHOST\t\tBIT(19)\n#define DWC3_OEVT_ADEVHNPCHNG\t\tBIT(18)\n#define DWC3_OEVT_ADEVSRPDET\t\tBIT(17)\n#define DWC3_OEVT_ADEVSESSENDDET\tBIT(16)\n#define DWC3_OEVT_BDEVBHOSTEND\t\tBIT(11)\n#define DWC3_OEVT_BDEVHNPCHNG\t\tBIT(10)\n#define DWC3_OEVT_BDEVSESSVLDDET\tBIT(9)\n#define DWC3_OEVT_BDEVVBUSCHNG\t\tBIT(8)\n#define DWC3_OEVT_BSESSVLD\t\tBIT(3)\n#define DWC3_OEVT_HSTNEGSTS\t\tBIT(2)\n#define DWC3_OEVT_SESREQSTS\t\tBIT(1)\n#define DWC3_OEVT_ERROR\t\t\tBIT(0)\n\n \n#define DWC3_OEVTEN_XHCIRUNSTPSETEN\tBIT(27)\n#define DWC3_OEVTEN_DEVRUNSTPSETEN\tBIT(26)\n#define DWC3_OEVTEN_HIBENTRYEN\t\tBIT(25)\n#define DWC3_OEVTEN_CONIDSTSCHNGEN\tBIT(24)\n#define DWC3_OEVTEN_HRRCONFNOTIFEN\tBIT(23)\n#define DWC3_OEVTEN_HRRINITNOTIFEN\tBIT(22)\n#define DWC3_OEVTEN_ADEVIDLEEN\t\tBIT(21)\n#define DWC3_OEVTEN_ADEVBHOSTENDEN\tBIT(20)\n#define DWC3_OEVTEN_ADEVHOSTEN\t\tBIT(19)\n#define DWC3_OEVTEN_ADEVHNPCHNGEN\tBIT(18)\n#define DWC3_OEVTEN_ADEVSRPDETEN\tBIT(17)\n#define DWC3_OEVTEN_ADEVSESSENDDETEN\tBIT(16)\n#define DWC3_OEVTEN_BDEVBHOSTENDEN\tBIT(11)\n#define DWC3_OEVTEN_BDEVHNPCHNGEN\tBIT(10)\n#define DWC3_OEVTEN_BDEVSESSVLDDETEN\tBIT(9)\n#define DWC3_OEVTEN_BDEVVBUSCHNGEN\tBIT(8)\n\n \n#define DWC3_OSTS_DEVRUNSTP\t\tBIT(13)\n#define DWC3_OSTS_XHCIRUNSTP\t\tBIT(12)\n#define DWC3_OSTS_PERIPHERALSTATE\tBIT(4)\n#define DWC3_OSTS_XHCIPRTPOWER\t\tBIT(3)\n#define DWC3_OSTS_BSESVLD\t\tBIT(2)\n#define DWC3_OSTS_VBUSVLD\t\tBIT(1)\n#define DWC3_OSTS_CONIDSTS\t\tBIT(0)\n\n \n\nstruct dwc3_trb;\n\n \nstruct dwc3_event_buffer {\n\tvoid\t\t\t*buf;\n\tvoid\t\t\t*cache;\n\tunsigned int\t\tlength;\n\tunsigned int\t\tlpos;\n\tunsigned int\t\tcount;\n\tunsigned int\t\tflags;\n\n#define DWC3_EVENT_PENDING\tBIT(0)\n\n\tdma_addr_t\t\tdma;\n\n\tstruct dwc3\t\t*dwc;\n};\n\n#define DWC3_EP_FLAG_STALLED\tBIT(0)\n#define DWC3_EP_FLAG_WEDGED\tBIT(1)\n\n#define DWC3_EP_DIRECTION_TX\ttrue\n#define DWC3_EP_DIRECTION_RX\tfalse\n\n#define DWC3_TRB_NUM\t\t256\n\n \nstruct dwc3_ep {\n\tstruct usb_ep\t\tendpoint;\n\tstruct list_head\tcancelled_list;\n\tstruct list_head\tpending_list;\n\tstruct list_head\tstarted_list;\n\n\tvoid __iomem\t\t*regs;\n\n\tstruct dwc3_trb\t\t*trb_pool;\n\tdma_addr_t\t\ttrb_pool_dma;\n\tstruct dwc3\t\t*dwc;\n\n\tu32\t\t\tsaved_state;\n\tunsigned int\t\tflags;\n#define DWC3_EP_ENABLED\t\t\tBIT(0)\n#define DWC3_EP_STALL\t\t\tBIT(1)\n#define DWC3_EP_WEDGE\t\t\tBIT(2)\n#define DWC3_EP_TRANSFER_STARTED\tBIT(3)\n#define DWC3_EP_END_TRANSFER_PENDING\tBIT(4)\n#define DWC3_EP_PENDING_REQUEST\t\tBIT(5)\n#define DWC3_EP_DELAY_START\t\tBIT(6)\n#define DWC3_EP_WAIT_TRANSFER_COMPLETE\tBIT(7)\n#define DWC3_EP_IGNORE_NEXT_NOSTREAM\tBIT(8)\n#define DWC3_EP_FORCE_RESTART_STREAM\tBIT(9)\n#define DWC3_EP_FIRST_STREAM_PRIMED\tBIT(10)\n#define DWC3_EP_PENDING_CLEAR_STALL\tBIT(11)\n#define DWC3_EP_TXFIFO_RESIZED\t\tBIT(12)\n#define DWC3_EP_DELAY_STOP             BIT(13)\n\n\t \n#define DWC3_EP0_DIR_IN\t\t\tBIT(31)\n\n\t \n\tu8\t\t\ttrb_enqueue;\n\tu8\t\t\ttrb_dequeue;\n\n\tu8\t\t\tnumber;\n\tu8\t\t\ttype;\n\tu8\t\t\tresource_index;\n\tu32\t\t\tframe_number;\n\tu32\t\t\tinterval;\n\n\tchar\t\t\tname[20];\n\n\tunsigned\t\tdirection:1;\n\tunsigned\t\tstream_capable:1;\n\n\t \n\tu8\t\t\tcombo_num;\n\tint\t\t\tstart_cmd_status;\n};\n\nenum dwc3_phy {\n\tDWC3_PHY_UNKNOWN = 0,\n\tDWC3_PHY_USB3,\n\tDWC3_PHY_USB2,\n};\n\nenum dwc3_ep0_next {\n\tDWC3_EP0_UNKNOWN = 0,\n\tDWC3_EP0_COMPLETE,\n\tDWC3_EP0_NRDY_DATA,\n\tDWC3_EP0_NRDY_STATUS,\n};\n\nenum dwc3_ep0_state {\n\tEP0_UNCONNECTED\t\t= 0,\n\tEP0_SETUP_PHASE,\n\tEP0_DATA_PHASE,\n\tEP0_STATUS_PHASE,\n};\n\nenum dwc3_link_state {\n\t \n\tDWC3_LINK_STATE_U0\t\t= 0x00,  \n\tDWC3_LINK_STATE_U1\t\t= 0x01,\n\tDWC3_LINK_STATE_U2\t\t= 0x02,  \n\tDWC3_LINK_STATE_U3\t\t= 0x03,  \n\tDWC3_LINK_STATE_SS_DIS\t\t= 0x04,\n\tDWC3_LINK_STATE_RX_DET\t\t= 0x05,  \n\tDWC3_LINK_STATE_SS_INACT\t= 0x06,\n\tDWC3_LINK_STATE_POLL\t\t= 0x07,\n\tDWC3_LINK_STATE_RECOV\t\t= 0x08,\n\tDWC3_LINK_STATE_HRESET\t\t= 0x09,\n\tDWC3_LINK_STATE_CMPLY\t\t= 0x0a,\n\tDWC3_LINK_STATE_LPBK\t\t= 0x0b,\n\tDWC3_LINK_STATE_RESET\t\t= 0x0e,\n\tDWC3_LINK_STATE_RESUME\t\t= 0x0f,\n\tDWC3_LINK_STATE_MASK\t\t= 0x0f,\n};\n\n \n#define DWC3_TRB_SIZE_MASK\t(0x00ffffff)\n#define DWC3_TRB_SIZE_LENGTH(n)\t((n) & DWC3_TRB_SIZE_MASK)\n#define DWC3_TRB_SIZE_PCM1(n)\t(((n) & 0x03) << 24)\n#define DWC3_TRB_SIZE_TRBSTS(n)\t(((n) & (0x0f << 28)) >> 28)\n\n#define DWC3_TRBSTS_OK\t\t\t0\n#define DWC3_TRBSTS_MISSED_ISOC\t\t1\n#define DWC3_TRBSTS_SETUP_PENDING\t2\n#define DWC3_TRB_STS_XFER_IN_PROG\t4\n\n \n#define DWC3_TRB_CTRL_HWO\t\tBIT(0)\n#define DWC3_TRB_CTRL_LST\t\tBIT(1)\n#define DWC3_TRB_CTRL_CHN\t\tBIT(2)\n#define DWC3_TRB_CTRL_CSP\t\tBIT(3)\n#define DWC3_TRB_CTRL_TRBCTL(n)\t\t(((n) & 0x3f) << 4)\n#define DWC3_TRB_CTRL_ISP_IMI\t\tBIT(10)\n#define DWC3_TRB_CTRL_IOC\t\tBIT(11)\n#define DWC3_TRB_CTRL_SID_SOFN(n)\t(((n) & 0xffff) << 14)\n#define DWC3_TRB_CTRL_GET_SID_SOFN(n)\t(((n) & (0xffff << 14)) >> 14)\n\n#define DWC3_TRBCTL_TYPE(n)\t\t((n) & (0x3f << 4))\n#define DWC3_TRBCTL_NORMAL\t\tDWC3_TRB_CTRL_TRBCTL(1)\n#define DWC3_TRBCTL_CONTROL_SETUP\tDWC3_TRB_CTRL_TRBCTL(2)\n#define DWC3_TRBCTL_CONTROL_STATUS2\tDWC3_TRB_CTRL_TRBCTL(3)\n#define DWC3_TRBCTL_CONTROL_STATUS3\tDWC3_TRB_CTRL_TRBCTL(4)\n#define DWC3_TRBCTL_CONTROL_DATA\tDWC3_TRB_CTRL_TRBCTL(5)\n#define DWC3_TRBCTL_ISOCHRONOUS_FIRST\tDWC3_TRB_CTRL_TRBCTL(6)\n#define DWC3_TRBCTL_ISOCHRONOUS\t\tDWC3_TRB_CTRL_TRBCTL(7)\n#define DWC3_TRBCTL_LINK_TRB\t\tDWC3_TRB_CTRL_TRBCTL(8)\n\n \nstruct dwc3_trb {\n\tu32\t\tbpl;\n\tu32\t\tbph;\n\tu32\t\tsize;\n\tu32\t\tctrl;\n} __packed;\n\n \nstruct dwc3_hwparams {\n\tu32\thwparams0;\n\tu32\thwparams1;\n\tu32\thwparams2;\n\tu32\thwparams3;\n\tu32\thwparams4;\n\tu32\thwparams5;\n\tu32\thwparams6;\n\tu32\thwparams7;\n\tu32\thwparams8;\n\tu32\thwparams9;\n};\n\n \n#define DWC3_MODE(n)\t\t((n) & 0x7)\n\n \n#define DWC3_NUM_INT(n)\t\t(((n) & (0x3f << 15)) >> 15)\n\n \n#define DWC3_NUM_IN_EPS_MASK\t(0x1f << 18)\n#define DWC3_NUM_EPS_MASK\t(0x3f << 12)\n#define DWC3_NUM_EPS(p)\t\t(((p)->hwparams3 &\t\t\\\n\t\t\t(DWC3_NUM_EPS_MASK)) >> 12)\n#define DWC3_NUM_IN_EPS(p)\t(((p)->hwparams3 &\t\t\\\n\t\t\t(DWC3_NUM_IN_EPS_MASK)) >> 18)\n\n \n#define DWC3_RAM1_DEPTH(n)\t((n) & 0xffff)\n\n \n#define DWC3_MST_CAPABLE(p)\t(!!((p)->hwparams9 &\t\t\\\n\t\t\tDWC3_GHWPARAMS9_DEV_MST))\n\n \nstruct dwc3_request {\n\tstruct usb_request\trequest;\n\tstruct list_head\tlist;\n\tstruct dwc3_ep\t\t*dep;\n\tstruct scatterlist\t*sg;\n\tstruct scatterlist\t*start_sg;\n\n\tunsigned int\t\tnum_pending_sgs;\n\tunsigned int\t\tnum_queued_sgs;\n\tunsigned int\t\tremaining;\n\n\tunsigned int\t\tstatus;\n#define DWC3_REQUEST_STATUS_QUEUED\t\t0\n#define DWC3_REQUEST_STATUS_STARTED\t\t1\n#define DWC3_REQUEST_STATUS_DISCONNECTED\t2\n#define DWC3_REQUEST_STATUS_DEQUEUED\t\t3\n#define DWC3_REQUEST_STATUS_STALLED\t\t4\n#define DWC3_REQUEST_STATUS_COMPLETED\t\t5\n#define DWC3_REQUEST_STATUS_UNKNOWN\t\t-1\n\n\tu8\t\t\tepnum;\n\tstruct dwc3_trb\t\t*trb;\n\tdma_addr_t\t\ttrb_dma;\n\n\tunsigned int\t\tnum_trbs;\n\n\tunsigned int\t\tneeds_extra_trb:1;\n\tunsigned int\t\tdirection:1;\n\tunsigned int\t\tmapped:1;\n};\n\n \nstruct dwc3_scratchpad_array {\n\t__le64\tdma_adr[DWC3_MAX_HIBER_SCRATCHBUFS];\n};\n\n \nstruct dwc3 {\n\tstruct work_struct\tdrd_work;\n\tstruct dwc3_trb\t\t*ep0_trb;\n\tvoid\t\t\t*bounce;\n\tu8\t\t\t*setup_buf;\n\tdma_addr_t\t\tep0_trb_addr;\n\tdma_addr_t\t\tbounce_addr;\n\tstruct dwc3_request\tep0_usb_req;\n\tstruct completion\tep0_in_setup;\n\n\t \n\tspinlock_t\t\tlock;\n\n\t \n\tstruct mutex\t\tmutex;\n\n\tstruct device\t\t*dev;\n\tstruct device\t\t*sysdev;\n\n\tstruct platform_device\t*xhci;\n\tstruct resource\t\txhci_resources[DWC3_XHCI_RESOURCES_NUM];\n\n\tstruct dwc3_event_buffer *ev_buf;\n\tstruct dwc3_ep\t\t*eps[DWC3_ENDPOINTS_NUM];\n\n\tstruct usb_gadget\t*gadget;\n\tstruct usb_gadget_driver *gadget_driver;\n\n\tstruct clk\t\t*bus_clk;\n\tstruct clk\t\t*ref_clk;\n\tstruct clk\t\t*susp_clk;\n\n\tstruct reset_control\t*reset;\n\n\tstruct usb_phy\t\t*usb2_phy;\n\tstruct usb_phy\t\t*usb3_phy;\n\n\tstruct phy\t\t*usb2_generic_phy;\n\tstruct phy\t\t*usb3_generic_phy;\n\n\tbool\t\t\tphys_ready;\n\n\tstruct ulpi\t\t*ulpi;\n\tbool\t\t\tulpi_ready;\n\n\tvoid __iomem\t\t*regs;\n\tsize_t\t\t\tregs_size;\n\n\tenum usb_dr_mode\tdr_mode;\n\tu32\t\t\tcurrent_dr_role;\n\tu32\t\t\tdesired_dr_role;\n\tstruct extcon_dev\t*edev;\n\tstruct notifier_block\tedev_nb;\n\tenum usb_phy_interface\thsphy_mode;\n\tstruct usb_role_switch\t*role_sw;\n\tenum usb_dr_mode\trole_switch_default_mode;\n\n\tstruct power_supply\t*usb_psy;\n\n\tu32\t\t\tfladj;\n\tu32\t\t\tref_clk_per;\n\tu32\t\t\tirq_gadget;\n\tu32\t\t\totg_irq;\n\tu32\t\t\tcurrent_otg_role;\n\tu32\t\t\tdesired_otg_role;\n\tbool\t\t\totg_restart_host;\n\tu32\t\t\tu1u2;\n\tu32\t\t\tmaximum_speed;\n\tu32\t\t\tgadget_max_speed;\n\tenum usb_ssp_rate\tmax_ssp_rate;\n\tenum usb_ssp_rate\tgadget_ssp_rate;\n\n\tu32\t\t\tip;\n\n#define DWC3_IP\t\t\t0x5533\n#define DWC31_IP\t\t0x3331\n#define DWC32_IP\t\t0x3332\n\n\tu32\t\t\trevision;\n\n#define DWC3_REVISION_ANY\t0x0\n#define DWC3_REVISION_173A\t0x5533173a\n#define DWC3_REVISION_175A\t0x5533175a\n#define DWC3_REVISION_180A\t0x5533180a\n#define DWC3_REVISION_183A\t0x5533183a\n#define DWC3_REVISION_185A\t0x5533185a\n#define DWC3_REVISION_187A\t0x5533187a\n#define DWC3_REVISION_188A\t0x5533188a\n#define DWC3_REVISION_190A\t0x5533190a\n#define DWC3_REVISION_194A\t0x5533194a\n#define DWC3_REVISION_200A\t0x5533200a\n#define DWC3_REVISION_202A\t0x5533202a\n#define DWC3_REVISION_210A\t0x5533210a\n#define DWC3_REVISION_220A\t0x5533220a\n#define DWC3_REVISION_230A\t0x5533230a\n#define DWC3_REVISION_240A\t0x5533240a\n#define DWC3_REVISION_250A\t0x5533250a\n#define DWC3_REVISION_260A\t0x5533260a\n#define DWC3_REVISION_270A\t0x5533270a\n#define DWC3_REVISION_280A\t0x5533280a\n#define DWC3_REVISION_290A\t0x5533290a\n#define DWC3_REVISION_300A\t0x5533300a\n#define DWC3_REVISION_310A\t0x5533310a\n#define DWC3_REVISION_330A\t0x5533330a\n\n#define DWC31_REVISION_ANY\t0x0\n#define DWC31_REVISION_110A\t0x3131302a\n#define DWC31_REVISION_120A\t0x3132302a\n#define DWC31_REVISION_160A\t0x3136302a\n#define DWC31_REVISION_170A\t0x3137302a\n#define DWC31_REVISION_180A\t0x3138302a\n#define DWC31_REVISION_190A\t0x3139302a\n\n#define DWC32_REVISION_ANY\t0x0\n#define DWC32_REVISION_100A\t0x3130302a\n\n\tu32\t\t\tversion_type;\n\n#define DWC31_VERSIONTYPE_ANY\t\t0x0\n#define DWC31_VERSIONTYPE_EA01\t\t0x65613031\n#define DWC31_VERSIONTYPE_EA02\t\t0x65613032\n#define DWC31_VERSIONTYPE_EA03\t\t0x65613033\n#define DWC31_VERSIONTYPE_EA04\t\t0x65613034\n#define DWC31_VERSIONTYPE_EA05\t\t0x65613035\n#define DWC31_VERSIONTYPE_EA06\t\t0x65613036\n\n\tenum dwc3_ep0_next\tep0_next_event;\n\tenum dwc3_ep0_state\tep0state;\n\tenum dwc3_link_state\tlink_state;\n\n\tu16\t\t\tu2sel;\n\tu16\t\t\tu2pel;\n\tu8\t\t\tu1sel;\n\tu8\t\t\tu1pel;\n\n\tu8\t\t\tspeed;\n\n\tu8\t\t\tnum_eps;\n\n\tstruct dwc3_hwparams\thwparams;\n\tstruct debugfs_regset32\t*regset;\n\n\tu32\t\t\tdbg_lsp_select;\n\n\tu8\t\t\ttest_mode;\n\tu8\t\t\ttest_mode_nr;\n\tu8\t\t\tlpm_nyet_threshold;\n\tu8\t\t\third_threshold;\n\tu8\t\t\trx_thr_num_pkt;\n\tu8\t\t\trx_max_burst;\n\tu8\t\t\ttx_thr_num_pkt;\n\tu8\t\t\ttx_max_burst;\n\tu8\t\t\trx_thr_num_pkt_prd;\n\tu8\t\t\trx_max_burst_prd;\n\tu8\t\t\ttx_thr_num_pkt_prd;\n\tu8\t\t\ttx_max_burst_prd;\n\tu8\t\t\ttx_fifo_resize_max_num;\n\tu8\t\t\tclear_stall_protocol;\n\n\tconst char\t\t*hsphy_interface;\n\n\tunsigned\t\tconnected:1;\n\tunsigned\t\tsoftconnect:1;\n\tunsigned\t\tdelayed_status:1;\n\tunsigned\t\tep0_bounced:1;\n\tunsigned\t\tep0_expect_in:1;\n\tunsigned\t\tsysdev_is_parent:1;\n\tunsigned\t\thas_lpm_erratum:1;\n\tunsigned\t\tis_utmi_l1_suspend:1;\n\tunsigned\t\tis_fpga:1;\n\tunsigned\t\tpending_events:1;\n\tunsigned\t\tdo_fifo_resize:1;\n\tunsigned\t\tpullups_connected:1;\n\tunsigned\t\tsetup_packet_pending:1;\n\tunsigned\t\tthree_stage_setup:1;\n\tunsigned\t\tdis_start_transfer_quirk:1;\n\tunsigned\t\tusb3_lpm_capable:1;\n\tunsigned\t\tusb2_lpm_disable:1;\n\tunsigned\t\tusb2_gadget_lpm_disable:1;\n\n\tunsigned\t\tdisable_scramble_quirk:1;\n\tunsigned\t\tu2exit_lfps_quirk:1;\n\tunsigned\t\tu2ss_inp3_quirk:1;\n\tunsigned\t\treq_p1p2p3_quirk:1;\n\tunsigned                del_p1p2p3_quirk:1;\n\tunsigned\t\tdel_phy_power_chg_quirk:1;\n\tunsigned\t\tlfps_filter_quirk:1;\n\tunsigned\t\trx_detect_poll_quirk:1;\n\tunsigned\t\tdis_u3_susphy_quirk:1;\n\tunsigned\t\tdis_u2_susphy_quirk:1;\n\tunsigned\t\tdis_enblslpm_quirk:1;\n\tunsigned\t\tdis_u1_entry_quirk:1;\n\tunsigned\t\tdis_u2_entry_quirk:1;\n\tunsigned\t\tdis_rxdet_inp3_quirk:1;\n\tunsigned\t\tdis_u2_freeclk_exists_quirk:1;\n\tunsigned\t\tdis_del_phy_power_chg_quirk:1;\n\tunsigned\t\tdis_tx_ipgap_linecheck_quirk:1;\n\tunsigned\t\tresume_hs_terminations:1;\n\tunsigned\t\tulpi_ext_vbus_drv:1;\n\tunsigned\t\tparkmode_disable_ss_quirk:1;\n\tunsigned\t\tparkmode_disable_hs_quirk:1;\n\tunsigned\t\tgfladj_refclk_lpm_sel:1;\n\n\tunsigned\t\ttx_de_emphasis_quirk:1;\n\tunsigned\t\ttx_de_emphasis:2;\n\n\tunsigned\t\tdis_metastability_quirk:1;\n\n\tunsigned\t\tdis_split_quirk:1;\n\tunsigned\t\tasync_callbacks:1;\n\tunsigned\t\twakeup_configured:1;\n\tunsigned\t\tsuspended:1;\n\n\tu16\t\t\timod_interval;\n\n\tint\t\t\tmax_cfg_eps;\n\tint\t\t\tlast_fifo_depth;\n\tint\t\t\tnum_ep_resized;\n\tstruct dentry\t\t*debug_root;\n};\n\n#define INCRX_BURST_MODE 0\n#define INCRX_UNDEF_LENGTH_BURST_MODE 1\n\n#define work_to_dwc(w)\t\t(container_of((w), struct dwc3, drd_work))\n\n \n\nstruct dwc3_event_type {\n\tu32\tis_devspec:1;\n\tu32\ttype:7;\n\tu32\treserved8_31:24;\n} __packed;\n\n#define DWC3_DEPEVT_XFERCOMPLETE\t0x01\n#define DWC3_DEPEVT_XFERINPROGRESS\t0x02\n#define DWC3_DEPEVT_XFERNOTREADY\t0x03\n#define DWC3_DEPEVT_RXTXFIFOEVT\t\t0x04\n#define DWC3_DEPEVT_STREAMEVT\t\t0x06\n#define DWC3_DEPEVT_EPCMDCMPLT\t\t0x07\n\n \nstruct dwc3_event_depevt {\n\tu32\tone_bit:1;\n\tu32\tendpoint_number:5;\n\tu32\tendpoint_event:4;\n\tu32\treserved11_10:2;\n\tu32\tstatus:4;\n\n \n#define DEPEVT_STATUS_TRANSFER_ACTIVE\tBIT(3)\n\n \n#define DEPEVT_STATUS_BUSERR\tBIT(0)\n#define DEPEVT_STATUS_SHORT\tBIT(1)\n#define DEPEVT_STATUS_IOC\tBIT(2)\n#define DEPEVT_STATUS_LST\tBIT(3)  \n#define DEPEVT_STATUS_MISSED_ISOC BIT(3)  \n\n \n#define DEPEVT_STREAMEVT_FOUND\t\t1\n#define DEPEVT_STREAMEVT_NOTFOUND\t2\n\n \n#define DEPEVT_STREAM_PRIME\t\t0xfffe\n#define DEPEVT_STREAM_NOSTREAM\t\t0x0\n\n \n#define DEPEVT_STATUS_CONTROL_DATA\t1\n#define DEPEVT_STATUS_CONTROL_STATUS\t2\n#define DEPEVT_STATUS_CONTROL_PHASE(n)\t((n) & 3)\n\n \n#define DEPEVT_TRANSFER_NO_RESOURCE\t1\n#define DEPEVT_TRANSFER_BUS_EXPIRY\t2\n\n\tu32\tparameters:16;\n\n \n#define DEPEVT_PARAMETER_CMD(n)\t(((n) & (0xf << 8)) >> 8)\n} __packed;\n\n \nstruct dwc3_event_devt {\n\tu32\tone_bit:1;\n\tu32\tdevice_event:7;\n\tu32\ttype:4;\n\tu32\treserved15_12:4;\n\tu32\tevent_info:9;\n\tu32\treserved31_25:7;\n} __packed;\n\n \nstruct dwc3_event_gevt {\n\tu32\tone_bit:1;\n\tu32\tdevice_event:7;\n\tu32\tphy_port_number:4;\n\tu32\treserved31_12:20;\n} __packed;\n\n \nunion dwc3_event {\n\tu32\t\t\t\traw;\n\tstruct dwc3_event_type\t\ttype;\n\tstruct dwc3_event_depevt\tdepevt;\n\tstruct dwc3_event_devt\t\tdevt;\n\tstruct dwc3_event_gevt\t\tgevt;\n};\n\n \nstruct dwc3_gadget_ep_cmd_params {\n\tu32\tparam2;\n\tu32\tparam1;\n\tu32\tparam0;\n};\n\n \n\n#define DWC3_HAS_PERIPHERAL\t\tBIT(0)\n#define DWC3_HAS_XHCI\t\t\tBIT(1)\n#define DWC3_HAS_OTG\t\t\tBIT(3)\n\n \nvoid dwc3_set_prtcap(struct dwc3 *dwc, u32 mode);\nvoid dwc3_set_mode(struct dwc3 *dwc, u32 mode);\nu32 dwc3_core_fifo_space(struct dwc3_ep *dep, u8 type);\n\n#define DWC3_IP_IS(_ip)\t\t\t\t\t\t\t\\\n\t(dwc->ip == _ip##_IP)\n\n#define DWC3_VER_IS(_ip, _ver)\t\t\t\t\t\t\\\n\t(DWC3_IP_IS(_ip) && dwc->revision == _ip##_REVISION_##_ver)\n\n#define DWC3_VER_IS_PRIOR(_ip, _ver)\t\t\t\t\t\\\n\t(DWC3_IP_IS(_ip) && dwc->revision < _ip##_REVISION_##_ver)\n\n#define DWC3_VER_IS_WITHIN(_ip, _from, _to)\t\t\t\t\\\n\t(DWC3_IP_IS(_ip) &&\t\t\t\t\t\t\\\n\t dwc->revision >= _ip##_REVISION_##_from &&\t\t\t\\\n\t (!(_ip##_REVISION_##_to) ||\t\t\t\t\t\\\n\t  dwc->revision <= _ip##_REVISION_##_to))\n\n#define DWC3_VER_TYPE_IS_WITHIN(_ip, _ver, _from, _to)\t\t\t\\\n\t(DWC3_VER_IS(_ip, _ver) &&\t\t\t\t\t\\\n\t dwc->version_type >= _ip##_VERSIONTYPE_##_from &&\t\t\\\n\t (!(_ip##_VERSIONTYPE_##_to) ||\t\t\t\t\t\\\n\t  dwc->version_type <= _ip##_VERSIONTYPE_##_to))\n\n \nstatic inline u32 dwc3_mdwidth(struct dwc3 *dwc)\n{\n\tu32 mdwidth;\n\n\tmdwidth = DWC3_GHWPARAMS0_MDWIDTH(dwc->hwparams.hwparams0);\n\tif (DWC3_IP_IS(DWC32))\n\t\tmdwidth += DWC3_GHWPARAMS6_MDWIDTH(dwc->hwparams.hwparams6);\n\n\treturn mdwidth;\n}\n\nbool dwc3_has_imod(struct dwc3 *dwc);\n\nint dwc3_event_buffers_setup(struct dwc3 *dwc);\nvoid dwc3_event_buffers_cleanup(struct dwc3 *dwc);\n\nint dwc3_core_soft_reset(struct dwc3 *dwc);\n\n#if IS_ENABLED(CONFIG_USB_DWC3_HOST) || IS_ENABLED(CONFIG_USB_DWC3_DUAL_ROLE)\nint dwc3_host_init(struct dwc3 *dwc);\nvoid dwc3_host_exit(struct dwc3 *dwc);\n#else\nstatic inline int dwc3_host_init(struct dwc3 *dwc)\n{ return 0; }\nstatic inline void dwc3_host_exit(struct dwc3 *dwc)\n{ }\n#endif\n\n#if IS_ENABLED(CONFIG_USB_DWC3_GADGET) || IS_ENABLED(CONFIG_USB_DWC3_DUAL_ROLE)\nint dwc3_gadget_init(struct dwc3 *dwc);\nvoid dwc3_gadget_exit(struct dwc3 *dwc);\nint dwc3_gadget_set_test_mode(struct dwc3 *dwc, int mode);\nint dwc3_gadget_get_link_state(struct dwc3 *dwc);\nint dwc3_gadget_set_link_state(struct dwc3 *dwc, enum dwc3_link_state state);\nint dwc3_send_gadget_ep_cmd(struct dwc3_ep *dep, unsigned int cmd,\n\t\tstruct dwc3_gadget_ep_cmd_params *params);\nint dwc3_send_gadget_generic_command(struct dwc3 *dwc, unsigned int cmd,\n\t\tu32 param);\nvoid dwc3_gadget_clear_tx_fifos(struct dwc3 *dwc);\nvoid dwc3_remove_requests(struct dwc3 *dwc, struct dwc3_ep *dep, int status);\n#else\nstatic inline int dwc3_gadget_init(struct dwc3 *dwc)\n{ return 0; }\nstatic inline void dwc3_gadget_exit(struct dwc3 *dwc)\n{ }\nstatic inline int dwc3_gadget_set_test_mode(struct dwc3 *dwc, int mode)\n{ return 0; }\nstatic inline int dwc3_gadget_get_link_state(struct dwc3 *dwc)\n{ return 0; }\nstatic inline int dwc3_gadget_set_link_state(struct dwc3 *dwc,\n\t\tenum dwc3_link_state state)\n{ return 0; }\n\nstatic inline int dwc3_send_gadget_ep_cmd(struct dwc3_ep *dep, unsigned int cmd,\n\t\tstruct dwc3_gadget_ep_cmd_params *params)\n{ return 0; }\nstatic inline int dwc3_send_gadget_generic_command(struct dwc3 *dwc,\n\t\tint cmd, u32 param)\n{ return 0; }\nstatic inline void dwc3_gadget_clear_tx_fifos(struct dwc3 *dwc)\n{ }\n#endif\n\n#if IS_ENABLED(CONFIG_USB_DWC3_DUAL_ROLE)\nint dwc3_drd_init(struct dwc3 *dwc);\nvoid dwc3_drd_exit(struct dwc3 *dwc);\nvoid dwc3_otg_init(struct dwc3 *dwc);\nvoid dwc3_otg_exit(struct dwc3 *dwc);\nvoid dwc3_otg_update(struct dwc3 *dwc, bool ignore_idstatus);\nvoid dwc3_otg_host_init(struct dwc3 *dwc);\n#else\nstatic inline int dwc3_drd_init(struct dwc3 *dwc)\n{ return 0; }\nstatic inline void dwc3_drd_exit(struct dwc3 *dwc)\n{ }\nstatic inline void dwc3_otg_init(struct dwc3 *dwc)\n{ }\nstatic inline void dwc3_otg_exit(struct dwc3 *dwc)\n{ }\nstatic inline void dwc3_otg_update(struct dwc3 *dwc, bool ignore_idstatus)\n{ }\nstatic inline void dwc3_otg_host_init(struct dwc3 *dwc)\n{ }\n#endif\n\n \n#if !IS_ENABLED(CONFIG_USB_DWC3_HOST)\nint dwc3_gadget_suspend(struct dwc3 *dwc);\nint dwc3_gadget_resume(struct dwc3 *dwc);\nvoid dwc3_gadget_process_pending_events(struct dwc3 *dwc);\n#else\nstatic inline int dwc3_gadget_suspend(struct dwc3 *dwc)\n{\n\treturn 0;\n}\n\nstatic inline int dwc3_gadget_resume(struct dwc3 *dwc)\n{\n\treturn 0;\n}\n\nstatic inline void dwc3_gadget_process_pending_events(struct dwc3 *dwc)\n{\n}\n#endif  \n\n#if IS_ENABLED(CONFIG_USB_DWC3_ULPI)\nint dwc3_ulpi_init(struct dwc3 *dwc);\nvoid dwc3_ulpi_exit(struct dwc3 *dwc);\n#else\nstatic inline int dwc3_ulpi_init(struct dwc3 *dwc)\n{ return 0; }\nstatic inline void dwc3_ulpi_exit(struct dwc3 *dwc)\n{ }\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}