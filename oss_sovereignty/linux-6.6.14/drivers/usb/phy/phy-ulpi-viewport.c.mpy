{
  "module_name": "phy-ulpi-viewport.c",
  "hash_id": "83a218cd9810d925fabda965fe9ce090431338407e735ad7f8930a507a79758f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/phy/phy-ulpi-viewport.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n#include <linux/kernel.h>\n#include <linux/usb.h>\n#include <linux/io.h>\n#include <linux/iopoll.h>\n#include <linux/usb/otg.h>\n#include <linux/usb/ulpi.h>\n\n#define ULPI_VIEW_WAKEUP\t(1 << 31)\n#define ULPI_VIEW_RUN\t\t(1 << 30)\n#define ULPI_VIEW_WRITE\t\t(1 << 29)\n#define ULPI_VIEW_READ\t\t(0 << 29)\n#define ULPI_VIEW_ADDR(x)\t(((x) & 0xff) << 16)\n#define ULPI_VIEW_DATA_READ(x)\t(((x) >> 8) & 0xff)\n#define ULPI_VIEW_DATA_WRITE(x)\t((x) & 0xff)\n\nstatic int ulpi_viewport_wait(void __iomem *view, u32 mask)\n{\n\tu32 val;\n\n\treturn readl_poll_timeout_atomic(view, val, !(val & mask), 1, 2000);\n}\n\nstatic int ulpi_viewport_read(struct usb_phy *otg, u32 reg)\n{\n\tint ret;\n\tvoid __iomem *view = otg->io_priv;\n\n\twritel(ULPI_VIEW_WAKEUP | ULPI_VIEW_WRITE, view);\n\tret = ulpi_viewport_wait(view, ULPI_VIEW_WAKEUP);\n\tif (ret)\n\t\treturn ret;\n\n\twritel(ULPI_VIEW_RUN | ULPI_VIEW_READ | ULPI_VIEW_ADDR(reg), view);\n\tret = ulpi_viewport_wait(view, ULPI_VIEW_RUN);\n\tif (ret)\n\t\treturn ret;\n\n\treturn ULPI_VIEW_DATA_READ(readl(view));\n}\n\nstatic int ulpi_viewport_write(struct usb_phy *otg, u32 val, u32 reg)\n{\n\tint ret;\n\tvoid __iomem *view = otg->io_priv;\n\n\twritel(ULPI_VIEW_WAKEUP | ULPI_VIEW_WRITE, view);\n\tret = ulpi_viewport_wait(view, ULPI_VIEW_WAKEUP);\n\tif (ret)\n\t\treturn ret;\n\n\twritel(ULPI_VIEW_RUN | ULPI_VIEW_WRITE | ULPI_VIEW_DATA_WRITE(val) |\n\t\t\t\t\t\t ULPI_VIEW_ADDR(reg), view);\n\n\treturn ulpi_viewport_wait(view, ULPI_VIEW_RUN);\n}\n\nstruct usb_phy_io_ops ulpi_viewport_access_ops = {\n\t.read\t= ulpi_viewport_read,\n\t.write\t= ulpi_viewport_write,\n};\nEXPORT_SYMBOL_GPL(ulpi_viewport_access_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}