{
  "module_name": "phy-fsl-usb.h",
  "hash_id": "a8957aea5534c444cedd544df867878306e572ce19d54acb4bddd76f62ccf4fb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/phy/phy-fsl-usb.h",
  "human_readable_source": " \n \n\n#include <linux/usb/otg-fsm.h>\n#include <linux/usb/otg.h>\n#include <linux/ioctl.h>\n\n \n#define USB_CMD_RUN_STOP\t\t(0x1<<0)\n#define USB_CMD_CTRL_RESET\t\t(0x1<<1)\n#define USB_CMD_PERIODIC_SCHEDULE_EN\t(0x1<<4)\n#define USB_CMD_ASYNC_SCHEDULE_EN\t(0x1<<5)\n#define USB_CMD_INT_AA_DOORBELL\t\t(0x1<<6)\n#define USB_CMD_ASP\t\t\t(0x3<<8)\n#define USB_CMD_ASYNC_SCH_PARK_EN\t(0x1<<11)\n#define USB_CMD_SUTW\t\t\t(0x1<<13)\n#define USB_CMD_ATDTW\t\t\t(0x1<<14)\n#define USB_CMD_ITC\t\t\t(0xFF<<16)\n\n \n#define USB_CMD_FRAME_SIZE_1024\t\t(0x0<<15 | 0x0<<2)\n#define USB_CMD_FRAME_SIZE_512\t\t(0x0<<15 | 0x1<<2)\n#define USB_CMD_FRAME_SIZE_256\t\t(0x0<<15 | 0x2<<2)\n#define USB_CMD_FRAME_SIZE_128\t\t(0x0<<15 | 0x3<<2)\n#define USB_CMD_FRAME_SIZE_64\t\t(0x1<<15 | 0x0<<2)\n#define USB_CMD_FRAME_SIZE_32\t\t(0x1<<15 | 0x1<<2)\n#define USB_CMD_FRAME_SIZE_16\t\t(0x1<<15 | 0x2<<2)\n#define USB_CMD_FRAME_SIZE_8\t\t(0x1<<15 | 0x3<<2)\n\n \n#define USB_CMD_ASP_00\t\t\t(0x0<<8)\n#define USB_CMD_ASP_01\t\t\t(0x1<<8)\n#define USB_CMD_ASP_10\t\t\t(0x2<<8)\n#define USB_CMD_ASP_11\t\t\t(0x3<<8)\n#define USB_CMD_ASP_BIT_POS\t\t(8)\n\n \n#define USB_CMD_ITC_NO_THRESHOLD\t(0x00<<16)\n#define USB_CMD_ITC_1_MICRO_FRM\t\t(0x01<<16)\n#define USB_CMD_ITC_2_MICRO_FRM\t\t(0x02<<16)\n#define USB_CMD_ITC_4_MICRO_FRM\t\t(0x04<<16)\n#define USB_CMD_ITC_8_MICRO_FRM\t\t(0x08<<16)\n#define USB_CMD_ITC_16_MICRO_FRM\t(0x10<<16)\n#define USB_CMD_ITC_32_MICRO_FRM\t(0x20<<16)\n#define USB_CMD_ITC_64_MICRO_FRM\t(0x40<<16)\n#define USB_CMD_ITC_BIT_POS\t\t(16)\n\n \n#define USB_STS_INT\t\t\t(0x1<<0)\n#define USB_STS_ERR\t\t\t(0x1<<1)\n#define USB_STS_PORT_CHANGE\t\t(0x1<<2)\n#define USB_STS_FRM_LST_ROLL\t\t(0x1<<3)\n#define USB_STS_SYS_ERR\t\t\t(0x1<<4)\n#define USB_STS_IAA\t\t\t(0x1<<5)\n#define USB_STS_RESET_RECEIVED\t\t(0x1<<6)\n#define USB_STS_SOF\t\t\t(0x1<<7)\n#define USB_STS_DCSUSPEND\t\t(0x1<<8)\n#define USB_STS_HC_HALTED\t\t(0x1<<12)\n#define USB_STS_RCL\t\t\t(0x1<<13)\n#define USB_STS_PERIODIC_SCHEDULE\t(0x1<<14)\n#define USB_STS_ASYNC_SCHEDULE\t\t(0x1<<15)\n\n \n#define USB_INTR_INT_EN\t\t\t(0x1<<0)\n#define USB_INTR_ERR_INT_EN\t\t(0x1<<1)\n#define USB_INTR_PC_DETECT_EN\t\t(0x1<<2)\n#define USB_INTR_FRM_LST_ROLL_EN\t(0x1<<3)\n#define USB_INTR_SYS_ERR_EN\t\t(0x1<<4)\n#define USB_INTR_ASYN_ADV_EN\t\t(0x1<<5)\n#define USB_INTR_RESET_EN\t\t(0x1<<6)\n#define USB_INTR_SOF_EN\t\t\t(0x1<<7)\n#define USB_INTR_DEVICE_SUSPEND\t\t(0x1<<8)\n\n \n#define USB_DEVICE_ADDRESS_MASK\t\t(0x7F<<25)\n#define USB_DEVICE_ADDRESS_BIT_POS\t(25)\n \n#define PORTSC_CURRENT_CONNECT_STATUS\t(0x1<<0)\n#define PORTSC_CONNECT_STATUS_CHANGE\t(0x1<<1)\n#define PORTSC_PORT_ENABLE\t\t(0x1<<2)\n#define PORTSC_PORT_EN_DIS_CHANGE\t(0x1<<3)\n#define PORTSC_OVER_CURRENT_ACT\t\t(0x1<<4)\n#define PORTSC_OVER_CUURENT_CHG\t\t(0x1<<5)\n#define PORTSC_PORT_FORCE_RESUME\t(0x1<<6)\n#define PORTSC_PORT_SUSPEND\t\t(0x1<<7)\n#define PORTSC_PORT_RESET\t\t(0x1<<8)\n#define PORTSC_LINE_STATUS_BITS\t\t(0x3<<10)\n#define PORTSC_PORT_POWER\t\t(0x1<<12)\n#define PORTSC_PORT_INDICTOR_CTRL\t(0x3<<14)\n#define PORTSC_PORT_TEST_CTRL\t\t(0xF<<16)\n#define PORTSC_WAKE_ON_CONNECT_EN\t(0x1<<20)\n#define PORTSC_WAKE_ON_CONNECT_DIS\t(0x1<<21)\n#define PORTSC_WAKE_ON_OVER_CURRENT\t(0x1<<22)\n#define PORTSC_PHY_LOW_POWER_SPD\t(0x1<<23)\n#define PORTSC_PORT_FORCE_FULL_SPEED\t(0x1<<24)\n#define PORTSC_PORT_SPEED_MASK\t\t(0x3<<26)\n#define PORTSC_TRANSCEIVER_WIDTH\t(0x1<<28)\n#define PORTSC_PHY_TYPE_SEL\t\t(0x3<<30)\n \n#define PORTSC_LINE_STATUS_SE0\t\t(0x0<<10)\n#define PORTSC_LINE_STATUS_JSTATE\t(0x1<<10)\n#define PORTSC_LINE_STATUS_KSTATE\t(0x2<<10)\n#define PORTSC_LINE_STATUS_UNDEF\t(0x3<<10)\n#define PORTSC_LINE_STATUS_BIT_POS\t(10)\n\n \n#define PORTSC_PIC_OFF\t\t\t(0x0<<14)\n#define PORTSC_PIC_AMBER\t\t(0x1<<14)\n#define PORTSC_PIC_GREEN\t\t(0x2<<14)\n#define PORTSC_PIC_UNDEF\t\t(0x3<<14)\n#define PORTSC_PIC_BIT_POS\t\t(14)\n\n \n#define PORTSC_PTC_DISABLE\t\t(0x0<<16)\n#define PORTSC_PTC_JSTATE\t\t(0x1<<16)\n#define PORTSC_PTC_KSTATE\t\t(0x2<<16)\n#define PORTSC_PTC_SEQNAK\t\t(0x3<<16)\n#define PORTSC_PTC_PACKET\t\t(0x4<<16)\n#define PORTSC_PTC_FORCE_EN\t\t(0x5<<16)\n#define PORTSC_PTC_BIT_POS\t\t(16)\n\n \n#define PORTSC_PORT_SPEED_FULL\t\t(0x0<<26)\n#define PORTSC_PORT_SPEED_LOW\t\t(0x1<<26)\n#define PORTSC_PORT_SPEED_HIGH\t\t(0x2<<26)\n#define PORTSC_PORT_SPEED_UNDEF\t\t(0x3<<26)\n#define PORTSC_SPEED_BIT_POS\t\t(26)\n\n \n#define PORTSC_PTW\t\t\t(0x1<<28)\n#define PORTSC_PTW_8BIT\t\t\t(0x0<<28)\n#define PORTSC_PTW_16BIT\t\t(0x1<<28)\n\n \n#define PORTSC_PTS_UTMI\t\t\t(0x0<<30)\n#define PORTSC_PTS_ULPI\t\t\t(0x2<<30)\n#define PORTSC_PTS_FSLS_SERIAL\t\t(0x3<<30)\n#define PORTSC_PTS_BIT_POS\t\t(30)\n\n#define PORTSC_W1C_BITS\t\t\t\\\n\t(PORTSC_CONNECT_STATUS_CHANGE |\t\\\n\t PORTSC_PORT_EN_DIS_CHANGE    |\t\\\n\t PORTSC_OVER_CUURENT_CHG)\n\n \n#define OTGSC_CTRL_VBUS_DISCHARGE\t(0x1<<0)\n#define OTGSC_CTRL_VBUS_CHARGE\t\t(0x1<<1)\n#define OTGSC_CTRL_OTG_TERMINATION\t(0x1<<3)\n#define OTGSC_CTRL_DATA_PULSING\t\t(0x1<<4)\n#define OTGSC_CTRL_ID_PULL_EN\t\t(0x1<<5)\n#define OTGSC_HA_DATA_PULSE\t\t(0x1<<6)\n#define OTGSC_HA_BA\t\t\t(0x1<<7)\n#define OTGSC_STS_USB_ID\t\t(0x1<<8)\n#define OTGSC_STS_A_VBUS_VALID\t\t(0x1<<9)\n#define OTGSC_STS_A_SESSION_VALID\t(0x1<<10)\n#define OTGSC_STS_B_SESSION_VALID\t(0x1<<11)\n#define OTGSC_STS_B_SESSION_END\t\t(0x1<<12)\n#define OTGSC_STS_1MS_TOGGLE\t\t(0x1<<13)\n#define OTGSC_STS_DATA_PULSING\t\t(0x1<<14)\n#define OTGSC_INTSTS_USB_ID\t\t(0x1<<16)\n#define OTGSC_INTSTS_A_VBUS_VALID\t(0x1<<17)\n#define OTGSC_INTSTS_A_SESSION_VALID\t(0x1<<18)\n#define OTGSC_INTSTS_B_SESSION_VALID\t(0x1<<19)\n#define OTGSC_INTSTS_B_SESSION_END\t(0x1<<20)\n#define OTGSC_INTSTS_1MS\t\t(0x1<<21)\n#define OTGSC_INTSTS_DATA_PULSING\t(0x1<<22)\n#define OTGSC_INTR_USB_ID_EN\t\t(0x1<<24)\n#define OTGSC_INTR_A_VBUS_VALID_EN\t(0x1<<25)\n#define OTGSC_INTR_A_SESSION_VALID_EN\t(0x1<<26)\n#define OTGSC_INTR_B_SESSION_VALID_EN\t(0x1<<27)\n#define OTGSC_INTR_B_SESSION_END_EN\t(0x1<<28)\n#define OTGSC_INTR_1MS_TIMER_EN\t\t(0x1<<29)\n#define OTGSC_INTR_DATA_PULSING_EN\t(0x1<<30)\n#define OTGSC_INTSTS_MASK\t\t(0x00ff0000)\n\n \n#define  USB_MODE_CTRL_MODE_IDLE\t(0x0<<0)\n#define  USB_MODE_CTRL_MODE_DEVICE\t(0x2<<0)\n#define  USB_MODE_CTRL_MODE_HOST\t(0x3<<0)\n#define  USB_MODE_CTRL_MODE_RSV\t\t(0x1<<0)\n#define  USB_MODE_SETUP_LOCK_OFF\t(0x1<<3)\n#define  USB_MODE_STREAM_DISABLE\t(0x1<<4)\n#define  USB_MODE_ES\t\t\t(0x1<<2)  \n\n \n#define  USB_CTRL_IOENB\t\t\t(0x1<<2)\n#define  USB_CTRL_ULPI_INT0EN\t\t(0x1<<0)\n\n \n#define BCSR5_INT_USB\t\t\t(0x02)\n\n \n#define SCCR_OFFS\t\t\t(0xA08)\n#define SCCR_USB_CLK_DISABLE\t\t(0x00000000)\t \n#define SCCR_USB_MPHCM_11\t\t(0x00c00000)\n#define SCCR_USB_MPHCM_01\t\t(0x00400000)\n#define SCCR_USB_MPHCM_10\t\t(0x00800000)\n#define SCCR_USB_DRCM_11\t\t(0x00300000)\n#define SCCR_USB_DRCM_01\t\t(0x00100000)\n#define SCCR_USB_DRCM_10\t\t(0x00200000)\n\n#define SICRL_OFFS\t\t\t(0x114)\n#define SICRL_USB0\t\t\t(0x40000000)\n#define SICRL_USB1\t\t\t(0x20000000)\n\n#define SICRH_OFFS\t\t\t(0x118)\n#define SICRH_USB_UTMI\t\t\t(0x00020000)\n\n \n#define  OTGSC_INTERRUPT_ENABLE_BITS_MASK  \\\n\t(OTGSC_INTR_USB_ID_EN            | \\\n\tOTGSC_INTR_1MS_TIMER_EN\t\t | \\\n\tOTGSC_INTR_A_VBUS_VALID_EN       | \\\n\tOTGSC_INTR_A_SESSION_VALID_EN    | \\\n\tOTGSC_INTR_B_SESSION_VALID_EN    | \\\n\tOTGSC_INTR_B_SESSION_END_EN      | \\\n\tOTGSC_INTR_DATA_PULSING_EN)\n\n \n#define  OTGSC_INTERRUPT_STATUS_BITS_MASK  \\\n\t(OTGSC_INTSTS_USB_ID          |    \\\n\tOTGSC_INTR_1MS_TIMER_EN       |    \\\n\tOTGSC_INTSTS_A_VBUS_VALID     |    \\\n\tOTGSC_INTSTS_A_SESSION_VALID  |    \\\n\tOTGSC_INTSTS_B_SESSION_VALID  |    \\\n\tOTGSC_INTSTS_B_SESSION_END    |    \\\n\tOTGSC_INTSTS_DATA_PULSING)\n\n \n\n \n#define TA_WAIT_VRISE\t(100)\t \n\n \n#define TA_WAIT_BCON\t(10000)   \n\n \n \n#define TA_AIDL_BDIS\t(5000)\t \n\n \n#define TA_BIDL_ADIS\t(12)\t \n\n \n\n\n \n#define TB_DATA_PLS\t(10)\t \n#define TB_DATA_PLS_MIN\t(5)\t \n#define TB_DATA_PLS_MAX\t(10)\t \n\n \n#define TB_SRP_INIT\t(100)\t \n\n \n#define TB_SRP_FAIL\t(7000)\t \n\n \n#define TB_SRP_WAIT\t(60)\n\n \n#define TB_VBUS_PLS\t(30)\t \n\n \n \n#define TB_VBUS_DSCHRG\t(8)\n\n \n#define TB_ASE0_BRST\t(20)\t \n\n \n#define TB_A_SUSPEND\t(7)\n#define TB_BUS_RESUME\t(12)\n\n \n#define TB_SE0_SRP\t(2)\t \n\n#define SET_OTG_STATE(phy, newstate)\t((phy)->otg->state = newstate)\n\nstruct usb_dr_mmap {\n\t \n\tu8 res1[256];\n\tu16 caplength;\t\t \n\tu16 hciversion;\t\t \n\tu32 hcsparams;\t\t \n\tu32 hccparams;\t\t \n\tu8 res2[20];\n\tu32 dciversion;\t\t \n\tu32 dccparams;\t\t \n\tu8 res3[24];\n\t \n\tu32 usbcmd;\t\t \n\tu32 usbsts;\t\t \n\tu32 usbintr;\t\t \n\tu32 frindex;\t\t \n\tu8 res4[4];\n\tu32 deviceaddr;\t\t \n\tu32 endpointlistaddr;\t \n\tu8 res5[4];\n\tu32 burstsize;\t\t \n\tu32 txttfilltuning;\t \n\tu8 res6[8];\n\tu32 ulpiview;\t\t \n\tu8 res7[12];\n\tu32 configflag;\t\t \n\tu32 portsc;\t\t \n\tu8 res8[28];\n\tu32 otgsc;\t\t \n\tu32 usbmode;\t\t \n\tu32 endptsetupstat;\t \n\tu32 endpointprime;\t \n\tu32 endptflush;\t\t \n\tu32 endptstatus;\t \n\tu32 endptcomplete;\t \n\tu32 endptctrl[6];\t \n\tu8 res9[552];\n\tu32 snoop1;\n\tu32 snoop2;\n\tu32 age_cnt_thresh;\t \n\tu32 pri_ctrl;\t\t \n\tu32 si_ctrl;\t\t \n\tu8 res10[236];\n\tu32 control;\t\t \n};\n\nstruct fsl_otg_timer {\n\tunsigned long expires;\t \n\tunsigned long count;\t \n\tvoid (*function)(unsigned long);\t \n\tunsigned long data;\t \n\tstruct list_head list;\n};\n\ninline struct fsl_otg_timer *otg_timer_initializer\n(void (*function)(unsigned long), unsigned long expires, unsigned long data)\n{\n\tstruct fsl_otg_timer *timer;\n\n\ttimer = kmalloc(sizeof(struct fsl_otg_timer), GFP_KERNEL);\n\tif (!timer)\n\t\treturn NULL;\n\ttimer->function = function;\n\ttimer->expires = expires;\n\ttimer->data = data;\n\treturn timer;\n}\n\nstruct fsl_otg {\n\tstruct usb_phy phy;\n\tstruct otg_fsm fsm;\n\tstruct usb_dr_mmap *dr_mem_map;\n\tstruct delayed_work otg_event;\n\n\t \n\tstruct work_struct work_wq;\n\tu8\thost_working;\n\n\tint irq;\n};\n\nstruct fsl_otg_config {\n\tu8 otg_port;\n};\n\n#define FSL_OTG_NAME\t\t\"fsl-usb2-otg\"\n\nvoid fsl_otg_add_timer(struct otg_fsm *fsm, void *timer);\nvoid fsl_otg_del_timer(struct otg_fsm *fsm, void *timer);\nvoid fsl_otg_pulse_vbus(void);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}