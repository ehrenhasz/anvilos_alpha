{
  "module_name": "trancevibrator.c",
  "hash_id": "46bbd9ceea2563eba281a1ac8d26569e8f4b7baa67ef9b32a540dd560fe3d02f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/misc/trancevibrator.c",
  "human_readable_source": "\n \n\n \n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/usb.h>\n\n#define DRIVER_AUTHOR \"Sam Hocevar, sam@zoy.org\"\n#define DRIVER_DESC \"PlayStation 2 Trance Vibrator driver\"\n\n#define TRANCEVIBRATOR_VENDOR_ID\t0x0b49\t \n#define TRANCEVIBRATOR_PRODUCT_ID\t0x064f\t \n\nstatic const struct usb_device_id id_table[] = {\n\t{ USB_DEVICE(TRANCEVIBRATOR_VENDOR_ID, TRANCEVIBRATOR_PRODUCT_ID) },\n\t{ },\n};\nMODULE_DEVICE_TABLE (usb, id_table);\n\n \nstruct trancevibrator {\n\tstruct usb_device *udev;\n\tunsigned int speed;\n};\n\nstatic ssize_t speed_show(struct device *dev, struct device_attribute *attr,\n\t\t\t  char *buf)\n{\n\tstruct usb_interface *intf = to_usb_interface(dev);\n\tstruct trancevibrator *tv = usb_get_intfdata(intf);\n\n\treturn sprintf(buf, \"%d\\n\", tv->speed);\n}\n\nstatic ssize_t speed_store(struct device *dev, struct device_attribute *attr,\n\t\t\t const char *buf, size_t count)\n{\n\tstruct usb_interface *intf = to_usb_interface(dev);\n\tstruct trancevibrator *tv = usb_get_intfdata(intf);\n\tint temp, retval, old;\n\n\tretval = kstrtoint(buf, 10, &temp);\n\tif (retval)\n\t\treturn retval;\n\tif (temp > 255)\n\t\ttemp = 255;\n\telse if (temp < 0)\n\t\ttemp = 0;\n\told = tv->speed;\n\ttv->speed = temp;\n\n\tdev_dbg(&tv->udev->dev, \"speed = %d\\n\", tv->speed);\n\n\t \n\tretval = usb_control_msg(tv->udev, usb_sndctrlpipe(tv->udev, 0),\n\t\t\t\t 0x01,  \n\t\t\t\t USB_DIR_OUT | USB_TYPE_VENDOR | USB_RECIP_OTHER,\n\t\t\t\t tv->speed,  \n\t\t\t\t 0, NULL, 0, USB_CTRL_SET_TIMEOUT);\n\tif (retval) {\n\t\ttv->speed = old;\n\t\tdev_dbg(&tv->udev->dev, \"retval = %d\\n\", retval);\n\t\treturn retval;\n\t}\n\treturn count;\n}\nstatic DEVICE_ATTR_RW(speed);\n\nstatic struct attribute *tv_attrs[] = {\n\t&dev_attr_speed.attr,\n\tNULL,\n};\nATTRIBUTE_GROUPS(tv);\n\nstatic int tv_probe(struct usb_interface *interface,\n\t\t    const struct usb_device_id *id)\n{\n\tstruct usb_device *udev = interface_to_usbdev(interface);\n\tstruct trancevibrator *dev;\n\tint retval;\n\n\tdev = kzalloc(sizeof(struct trancevibrator), GFP_KERNEL);\n\tif (!dev) {\n\t\tretval = -ENOMEM;\n\t\tgoto error;\n\t}\n\n\tdev->udev = usb_get_dev(udev);\n\tusb_set_intfdata(interface, dev);\n\n\treturn 0;\n\nerror:\n\tkfree(dev);\n\treturn retval;\n}\n\nstatic void tv_disconnect(struct usb_interface *interface)\n{\n\tstruct trancevibrator *dev;\n\n\tdev = usb_get_intfdata (interface);\n\tusb_set_intfdata(interface, NULL);\n\tusb_put_dev(dev->udev);\n\tkfree(dev);\n}\n\n \nstatic struct usb_driver tv_driver = {\n\t.name =\t\t\"trancevibrator\",\n\t.probe =\ttv_probe,\n\t.disconnect =\ttv_disconnect,\n\t.id_table =\tid_table,\n\t.dev_groups =\ttv_groups,\n};\n\nmodule_usb_driver(tv_driver);\n\nMODULE_AUTHOR(DRIVER_AUTHOR);\nMODULE_DESCRIPTION(DRIVER_DESC);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}