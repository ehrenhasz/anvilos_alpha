{
  "module_name": "isight_firmware.c",
  "hash_id": "8de92661708023e4faa96e50461abe5b60b278a028318cb5ecca08472fabc43f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/misc/isight_firmware.c",
  "human_readable_source": "\n \n\n#include <linux/usb.h>\n#include <linux/firmware.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n#include <linux/slab.h>\n\nstatic const struct usb_device_id id_table[] = {\n\t{USB_DEVICE(0x05ac, 0x8300)},\n\t{},\n};\n\nMODULE_DEVICE_TABLE(usb, id_table);\n\nstatic int isight_firmware_load(struct usb_interface *intf,\n\t\t\t\tconst struct usb_device_id *id)\n{\n\tstruct usb_device *dev = interface_to_usbdev(intf);\n\tint llen, len, req, ret = 0;\n\tconst struct firmware *firmware;\n\tunsigned char *buf = kmalloc(50, GFP_KERNEL);\n\tunsigned char data[4];\n\tconst u8 *ptr;\n\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tif (request_firmware(&firmware, \"isight.fw\", &dev->dev) != 0) {\n\t\tprintk(KERN_ERR \"Unable to load isight firmware\\n\");\n\t\tret = -ENODEV;\n\t\tgoto out;\n\t}\n\n\tptr = firmware->data;\n\n\tbuf[0] = 0x01;\n\tif (usb_control_msg\n\t    (dev, usb_sndctrlpipe(dev, 0), 0xa0, 0x40, 0xe600, 0, buf, 1,\n\t     300) != 1) {\n\t\tprintk(KERN_ERR\n\t\t       \"Failed to initialise isight firmware loader\\n\");\n\t\tret = -ENODEV;\n\t\tgoto out;\n\t}\n\n\twhile (ptr+4 <= firmware->data+firmware->size) {\n\t\tmemcpy(data, ptr, 4);\n\t\tlen = (data[0] << 8 | data[1]);\n\t\treq = (data[2] << 8 | data[3]);\n\t\tptr += 4;\n\n\t\tif (len == 0x8001)\n\t\t\tbreak;\t \n\t\telse if (len == 0)\n\t\t\tcontinue;\n\n\t\tfor (; len > 0; req += 50) {\n\t\t\tllen = min(len, 50);\n\t\t\tlen -= llen;\n\t\t\tif (ptr+llen > firmware->data+firmware->size) {\n\t\t\t\tprintk(KERN_ERR\n\t\t\t\t       \"Malformed isight firmware\");\n\t\t\t\tret = -ENODEV;\n\t\t\t\tgoto out;\n\t\t\t}\n\t\t\tmemcpy(buf, ptr, llen);\n\n\t\t\tptr += llen;\n\n\t\t\tif (usb_control_msg\n\t\t\t    (dev, usb_sndctrlpipe(dev, 0), 0xa0, 0x40, req, 0,\n\t\t\t     buf, llen, 300) != llen) {\n\t\t\t\tprintk(KERN_ERR\n\t\t\t\t       \"Failed to load isight firmware\\n\");\n\t\t\t\tret = -ENODEV;\n\t\t\t\tgoto out;\n\t\t\t}\n\n\t\t}\n\t}\n\n\tbuf[0] = 0x00;\n\tif (usb_control_msg\n\t    (dev, usb_sndctrlpipe(dev, 0), 0xa0, 0x40, 0xe600, 0, buf, 1,\n\t     300) != 1) {\n\t\tprintk(KERN_ERR \"isight firmware loading completion failed\\n\");\n\t\tret = -ENODEV;\n\t}\n\nout:\n\tkfree(buf);\n\trelease_firmware(firmware);\n\treturn ret;\n}\n\nMODULE_FIRMWARE(\"isight.fw\");\n\nstatic void isight_firmware_disconnect(struct usb_interface *intf)\n{\n}\n\nstatic struct usb_driver isight_firmware_driver = {\n\t.name = \"isight_firmware\",\n\t.probe = isight_firmware_load,\n\t.disconnect = isight_firmware_disconnect,\n\t.id_table = id_table,\n};\n\nmodule_usb_driver(isight_firmware_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Matthew Garrett <mjg@redhat.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}