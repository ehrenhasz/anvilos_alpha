{
  "module_name": "rcar2.c",
  "hash_id": "fcf59a299e9cb53514a00298860b4398b52738c1d48bbcbe11970e596412ab07",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/renesas_usbhs/rcar2.c",
  "human_readable_source": "\n \n\n#include <linux/phy/phy.h>\n#include \"common.h\"\n#include \"rcar2.h\"\n\nstatic int usbhs_rcar2_hardware_init(struct platform_device *pdev)\n{\n\tstruct usbhs_priv *priv = usbhs_pdev_to_priv(pdev);\n\n\tif (IS_ENABLED(CONFIG_GENERIC_PHY)) {\n\t\tstruct phy *phy = phy_get(&pdev->dev, \"usb\");\n\n\t\tif (IS_ERR(phy))\n\t\t\treturn PTR_ERR(phy);\n\n\t\tpriv->phy = phy;\n\t\treturn 0;\n\t}\n\n\treturn -ENXIO;\n}\n\nstatic int usbhs_rcar2_hardware_exit(struct platform_device *pdev)\n{\n\tstruct usbhs_priv *priv = usbhs_pdev_to_priv(pdev);\n\n\tif (priv->phy) {\n\t\tphy_put(&pdev->dev, priv->phy);\n\t\tpriv->phy = NULL;\n\t}\n\n\treturn 0;\n}\n\nstatic int usbhs_rcar2_power_ctrl(struct platform_device *pdev,\n\t\t\t\tvoid __iomem *base, int enable)\n{\n\tstruct usbhs_priv *priv = usbhs_pdev_to_priv(pdev);\n\tint retval = -ENODEV;\n\n\tif (priv->phy) {\n\t\tif (enable) {\n\t\t\tretval = phy_init(priv->phy);\n\n\t\t\tif (!retval)\n\t\t\t\tretval = phy_power_on(priv->phy);\n\t\t} else {\n\t\t\tphy_power_off(priv->phy);\n\t\t\tphy_exit(priv->phy);\n\t\t\tretval = 0;\n\t\t}\n\t}\n\n\treturn retval;\n}\n\nconst struct renesas_usbhs_platform_info usbhs_rcar_gen2_plat_info = {\n\t.platform_callback = {\n\t\t.hardware_init = usbhs_rcar2_hardware_init,\n\t\t.hardware_exit = usbhs_rcar2_hardware_exit,\n\t\t.power_ctrl = usbhs_rcar2_power_ctrl,\n\t\t.get_id = usbhs_get_id_as_gadget,\n\t},\n\t.driver_param = {\n\t\t.has_usb_dmac = 1,\n\t\t.has_new_pipe_configs = 1,\n\t},\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}