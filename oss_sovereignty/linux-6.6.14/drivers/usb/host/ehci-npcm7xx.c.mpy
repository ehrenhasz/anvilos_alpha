{
  "module_name": "ehci-npcm7xx.c",
  "hash_id": "ebe683a4cd464bba61ededfb4f49fd66700f7e436ffd22180b46774362a50e7b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/host/ehci-npcm7xx.c",
  "human_readable_source": "\n \n\n\n#include <linux/dma-mapping.h>\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm.h>\n#include <linux/usb.h>\n#include <linux/usb/hcd.h>\n\n#include \"ehci.h\"\n\n#define DRIVER_DESC \"EHCI npcm7xx driver\"\n\nstatic struct hc_driver __read_mostly ehci_npcm7xx_hc_driver;\n\nstatic int __maybe_unused ehci_npcm7xx_drv_suspend(struct device *dev)\n{\n\tstruct usb_hcd *hcd = dev_get_drvdata(dev);\n\tbool do_wakeup = device_may_wakeup(dev);\n\n\treturn ehci_suspend(hcd, do_wakeup);\n}\n\nstatic int __maybe_unused ehci_npcm7xx_drv_resume(struct device *dev)\n{\n\tstruct usb_hcd *hcd = dev_get_drvdata(dev);\n\n\tehci_resume(hcd, false);\n\treturn 0;\n}\n\nstatic SIMPLE_DEV_PM_OPS(ehci_npcm7xx_pm_ops, ehci_npcm7xx_drv_suspend,\n\t\tehci_npcm7xx_drv_resume);\n\nstatic int npcm7xx_ehci_hcd_drv_probe(struct platform_device *pdev)\n{\n\tstruct usb_hcd *hcd;\n\tstruct resource *res;\n\tconst struct hc_driver *driver = &ehci_npcm7xx_hc_driver;\n\tint irq;\n\tint retval;\n\n\tdev_dbg(&pdev->dev, \"initializing npcm7xx ehci USB Controller\\n\");\n\n\tif (usb_disabled())\n\t\treturn -ENODEV;\n\n\tirq = platform_get_irq(pdev, 0);\n\tif (irq < 0) {\n\t\tretval = irq;\n\t\tgoto fail;\n\t}\n\n\t \n\tretval = dma_coerce_mask_and_coherent(&pdev->dev, DMA_BIT_MASK(32));\n\tif (retval)\n\t\tgoto fail;\n\n\thcd = usb_create_hcd(driver, &pdev->dev, dev_name(&pdev->dev));\n\tif (!hcd) {\n\t\tretval = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\thcd->regs = devm_platform_get_and_ioremap_resource(pdev, 0, &res);\n\tif (IS_ERR(hcd->regs)) {\n\t\tretval = PTR_ERR(hcd->regs);\n\t\tgoto err_put_hcd;\n\t}\n\thcd->rsrc_start = res->start;\n\thcd->rsrc_len = resource_size(res);\n\n\t \n\thcd_to_ehci(hcd)->caps = hcd->regs;\n\n\tretval = usb_add_hcd(hcd, irq, IRQF_SHARED);\n\tif (retval)\n\t\tgoto err_put_hcd;\n\n\tdevice_wakeup_enable(hcd->self.controller);\n\treturn retval;\n\nerr_put_hcd:\n\tusb_put_hcd(hcd);\nfail:\n\tdev_err(&pdev->dev, \"init fail, %d\\n\", retval);\n\n\treturn retval;\n}\n\nstatic void npcm7xx_ehci_hcd_drv_remove(struct platform_device *pdev)\n{\n\tstruct usb_hcd *hcd = platform_get_drvdata(pdev);\n\n\tusb_remove_hcd(hcd);\n\n\tusb_put_hcd(hcd);\n}\n\nstatic const struct of_device_id npcm7xx_ehci_id_table[] = {\n\t{ .compatible = \"nuvoton,npcm750-ehci\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, npcm7xx_ehci_id_table);\n\nstatic struct platform_driver npcm7xx_ehci_hcd_driver = {\n\t.probe\t\t= npcm7xx_ehci_hcd_drv_probe,\n\t.remove_new\t= npcm7xx_ehci_hcd_drv_remove,\n\t.shutdown\t= usb_hcd_platform_shutdown,\n\t.driver\t\t= {\n\t\t.name = \"npcm7xx-ehci\",\n\t\t.bus = &platform_bus_type,\n\t\t.pm = pm_ptr(&ehci_npcm7xx_pm_ops),\n\t\t.of_match_table = npcm7xx_ehci_id_table,\n\t}\n};\n\nstatic int __init ehci_npcm7xx_init(void)\n{\n\tif (usb_disabled())\n\t\treturn -ENODEV;\n\n\tehci_init_driver(&ehci_npcm7xx_hc_driver, NULL);\n\treturn platform_driver_register(&npcm7xx_ehci_hcd_driver);\n}\nmodule_init(ehci_npcm7xx_init);\n\nstatic void __exit ehci_npcm7xx_cleanup(void)\n{\n\tplatform_driver_unregister(&npcm7xx_ehci_hcd_driver);\n}\nmodule_exit(ehci_npcm7xx_cleanup);\n\nMODULE_DESCRIPTION(DRIVER_DESC);\nMODULE_ALIAS(\"platform:npcm7xx-ehci\");\nMODULE_AUTHOR(\"Avi Fishman\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}