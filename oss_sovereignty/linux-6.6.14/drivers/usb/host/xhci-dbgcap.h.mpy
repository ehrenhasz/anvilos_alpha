{
  "module_name": "xhci-dbgcap.h",
  "hash_id": "a4b0c9cd7dd372454024f1f1ccb75802575ca9d3061f2ebdfbcf6e155431e6c3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/host/xhci-dbgcap.h",
  "human_readable_source": " \n \n#ifndef __LINUX_XHCI_DBGCAP_H\n#define __LINUX_XHCI_DBGCAP_H\n\n#include <linux/tty.h>\n#include <linux/kfifo.h>\n\nstruct dbc_regs {\n\t__le32\tcapability;\n\t__le32\tdoorbell;\n\t__le32\tersts;\t\t \n\t__le32\t__reserved_0;\t \n\t__le64\terstba;\t\t \n\t__le64\terdp;\t\t \n\t__le32\tcontrol;\n\t__le32\tstatus;\n\t__le32\tportsc;\t\t \n\t__le32\t__reserved_1;\t \n\t__le64\tdccp;\t\t \n\t__le32\tdevinfo1;\t \n\t__le32\tdevinfo2;\t \n};\n\nstruct dbc_info_context {\n\t__le64\tstring0;\n\t__le64\tmanufacturer;\n\t__le64\tproduct;\n\t__le64\tserial;\n\t__le32\tlength;\n\t__le32\t__reserved_0[7];\n};\n\n#define DBC_CTRL_DBC_RUN\t\tBIT(0)\n#define DBC_CTRL_PORT_ENABLE\t\tBIT(1)\n#define DBC_CTRL_HALT_OUT_TR\t\tBIT(2)\n#define DBC_CTRL_HALT_IN_TR\t\tBIT(3)\n#define DBC_CTRL_DBC_RUN_CHANGE\t\tBIT(4)\n#define DBC_CTRL_DBC_ENABLE\t\tBIT(31)\n#define DBC_CTRL_MAXBURST(p)\t\t(((p) >> 16) & 0xff)\n#define DBC_DOOR_BELL_TARGET(p)\t\t(((p) & 0xff) << 8)\n\n#define DBC_MAX_PACKET\t\t\t1024\n#define DBC_MAX_STRING_LENGTH\t\t64\n#define DBC_STRING_MANUFACTURER\t\t\"Linux Foundation\"\n#define DBC_STRING_PRODUCT\t\t\"Linux USB Debug Target\"\n#define DBC_STRING_SERIAL\t\t\"0001\"\n#define\tDBC_CONTEXT_SIZE\t\t64\n\n \n#define DBC_PORTSC_CONN_STATUS\t\tBIT(0)\n#define DBC_PORTSC_PORT_ENABLED\t\tBIT(1)\n#define DBC_PORTSC_CONN_CHANGE\t\tBIT(17)\n#define DBC_PORTSC_RESET_CHANGE\t\tBIT(21)\n#define DBC_PORTSC_LINK_CHANGE\t\tBIT(22)\n#define DBC_PORTSC_CONFIG_CHANGE\tBIT(23)\n\nstruct dbc_str_descs {\n\tchar\tstring0[DBC_MAX_STRING_LENGTH];\n\tchar\tmanufacturer[DBC_MAX_STRING_LENGTH];\n\tchar\tproduct[DBC_MAX_STRING_LENGTH];\n\tchar\tserial[DBC_MAX_STRING_LENGTH];\n};\n\n#define DBC_PROTOCOL\t\t\t1\t \n#define DBC_VENDOR_ID\t\t\t0x1d6b\t \n#define DBC_PRODUCT_ID\t\t\t0x0010\t \n#define DBC_DEVICE_REV\t\t\t0x0010\t \n\nenum dbc_state {\n\tDS_DISABLED = 0,\n\tDS_INITIALIZED,\n\tDS_ENABLED,\n\tDS_CONNECTED,\n\tDS_CONFIGURED,\n\tDS_STALLED,\n};\n\nstruct dbc_ep {\n\tstruct xhci_dbc\t\t\t*dbc;\n\tstruct list_head\t\tlist_pending;\n\tstruct xhci_ring\t\t*ring;\n\tunsigned int\t\t\tdirection:1;\n};\n\n#define DBC_QUEUE_SIZE\t\t\t16\n#define DBC_WRITE_BUF_SIZE\t\t8192\n\n \nstruct dbc_port {\n\tstruct tty_port\t\t\tport;\n\tspinlock_t\t\t\tport_lock;\t \n\tint\t\t\t\tminor;\n\n\tstruct list_head\t\tread_pool;\n\tstruct list_head\t\tread_queue;\n\tunsigned int\t\t\tn_read;\n\tstruct tasklet_struct\t\tpush;\n\n\tstruct list_head\t\twrite_pool;\n\tstruct kfifo\t\t\twrite_fifo;\n\n\tbool\t\t\t\tregistered;\n};\n\nstruct dbc_driver {\n\tint (*configure)(struct xhci_dbc *dbc);\n\tvoid (*disconnect)(struct xhci_dbc *dbc);\n};\n\nstruct xhci_dbc {\n\tspinlock_t\t\t\tlock;\t\t \n\tstruct device\t\t\t*dev;\n\tstruct xhci_hcd\t\t\t*xhci;\n\tstruct dbc_regs __iomem\t\t*regs;\n\tstruct xhci_ring\t\t*ring_evt;\n\tstruct xhci_ring\t\t*ring_in;\n\tstruct xhci_ring\t\t*ring_out;\n\tstruct xhci_erst\t\terst;\n\tstruct xhci_container_ctx\t*ctx;\n\n\tstruct dbc_str_descs\t\t*string;\n\tdma_addr_t\t\t\tstring_dma;\n\tsize_t\t\t\t\tstring_size;\n\tu16\t\t\t\tidVendor;\n\tu16\t\t\t\tidProduct;\n\tu16\t\t\t\tbcdDevice;\n\tu8\t\t\t\tbInterfaceProtocol;\n\n\tenum dbc_state\t\t\tstate;\n\tstruct delayed_work\t\tevent_work;\n\tunsigned\t\t\tresume_required:1;\n\tstruct dbc_ep\t\t\teps[2];\n\n\tconst struct dbc_driver\t\t*driver;\n\tvoid\t\t\t\t*priv;\n};\n\nstruct dbc_request {\n\tvoid\t\t\t\t*buf;\n\tunsigned int\t\t\tlength;\n\tdma_addr_t\t\t\tdma;\n\tvoid\t\t\t\t(*complete)(struct xhci_dbc *dbc,\n\t\t\t\t\t\t    struct dbc_request *req);\n\tstruct list_head\t\tlist_pool;\n\tint\t\t\t\tstatus;\n\tunsigned int\t\t\tactual;\n\n\tstruct xhci_dbc\t\t\t*dbc;\n\tstruct list_head\t\tlist_pending;\n\tdma_addr_t\t\t\ttrb_dma;\n\tunion xhci_trb\t\t\t*trb;\n\tunsigned\t\t\tdirection:1;\n};\n\n#define dbc_bulkout_ctx(d)\t\t\\\n\t((struct xhci_ep_ctx *)((d)->ctx->bytes + DBC_CONTEXT_SIZE))\n#define dbc_bulkin_ctx(d)\t\t\\\n\t((struct xhci_ep_ctx *)((d)->ctx->bytes + DBC_CONTEXT_SIZE * 2))\n#define dbc_bulkout_enq(d)\t\t\\\n\txhci_trb_virt_to_dma((d)->ring_out->enq_seg, (d)->ring_out->enqueue)\n#define dbc_bulkin_enq(d)\t\t\\\n\txhci_trb_virt_to_dma((d)->ring_in->enq_seg, (d)->ring_in->enqueue)\n#define dbc_epctx_info2(t, p, b)\t\\\n\tcpu_to_le32(EP_TYPE(t) | MAX_PACKET(p) | MAX_BURST(b))\n#define dbc_ep_dma_direction(d)\t\t\\\n\t((d)->direction ? DMA_FROM_DEVICE : DMA_TO_DEVICE)\n\n#define BULK_OUT\t\t\t0\n#define BULK_IN\t\t\t\t1\n#define EPID_OUT\t\t\t2\n#define EPID_IN\t\t\t\t3\n\nenum evtreturn {\n\tEVT_ERR\t= -1,\n\tEVT_DONE,\n\tEVT_GSER,\n\tEVT_DISC,\n};\n\nstatic inline struct dbc_ep *get_in_ep(struct xhci_dbc *dbc)\n{\n\treturn &dbc->eps[BULK_IN];\n}\n\nstatic inline struct dbc_ep *get_out_ep(struct xhci_dbc *dbc)\n{\n\treturn &dbc->eps[BULK_OUT];\n}\n\n#ifdef CONFIG_USB_XHCI_DBGCAP\nint xhci_create_dbc_dev(struct xhci_hcd *xhci);\nvoid xhci_remove_dbc_dev(struct xhci_hcd *xhci);\nint xhci_dbc_init(void);\nvoid xhci_dbc_exit(void);\nint dbc_tty_init(void);\nvoid dbc_tty_exit(void);\nint xhci_dbc_tty_probe(struct device *dev, void __iomem *res, struct xhci_hcd *xhci);\nvoid xhci_dbc_tty_remove(struct xhci_dbc *dbc);\nstruct xhci_dbc *xhci_alloc_dbc(struct device *dev, void __iomem *res,\n\t\t\t\t const struct dbc_driver *driver);\nvoid xhci_dbc_remove(struct xhci_dbc *dbc);\nstruct dbc_request *dbc_alloc_request(struct xhci_dbc *dbc,\n\t\t\t\t      unsigned int direction,\n\t\t\t\t      gfp_t flags);\nvoid dbc_free_request(struct dbc_request *req);\nint dbc_ep_queue(struct dbc_request *req);\n#ifdef CONFIG_PM\nint xhci_dbc_suspend(struct xhci_hcd *xhci);\nint xhci_dbc_resume(struct xhci_hcd *xhci);\n#endif  \n#else\nstatic inline int xhci_create_dbc_dev(struct xhci_hcd *xhci)\n{\n\treturn 0;\n}\n\nstatic inline void xhci_remove_dbc_dev(struct xhci_hcd *xhci)\n{\n}\nstatic inline int xhci_dbc_init(void)\n{\n\treturn 0;\n}\nstatic inline void xhci_dbc_exit(void)\n{\n}\nstatic inline int xhci_dbc_suspend(struct xhci_hcd *xhci)\n{\n\treturn 0;\n}\n\nstatic inline int xhci_dbc_resume(struct xhci_hcd *xhci)\n{\n\treturn 0;\n}\n#endif  \n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}