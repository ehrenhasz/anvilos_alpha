{
  "module_name": "fhci-mem.c",
  "hash_id": "c0703041a9408654b93cf7f2e02173e3569eff935f2b4c59e3565a5b08f88427",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/host/fhci-mem.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/delay.h>\n#include <linux/slab.h>\n#include <linux/list.h>\n#include <linux/usb.h>\n#include <linux/usb/hcd.h>\n#include \"fhci.h\"\n\nstatic void init_td(struct td *td)\n{\n\tmemset(td, 0, sizeof(*td));\n\tINIT_LIST_HEAD(&td->node);\n\tINIT_LIST_HEAD(&td->frame_lh);\n}\n\nstatic void init_ed(struct ed *ed)\n{\n\tmemset(ed, 0, sizeof(*ed));\n\tINIT_LIST_HEAD(&ed->td_list);\n\tINIT_LIST_HEAD(&ed->node);\n}\n\nstatic struct td *get_empty_td(struct fhci_hcd *fhci)\n{\n\tstruct td *td;\n\n\tif (!list_empty(&fhci->empty_tds)) {\n\t\ttd = list_entry(fhci->empty_tds.next, struct td, node);\n\t\tlist_del(fhci->empty_tds.next);\n\t} else {\n\t\ttd = kmalloc(sizeof(*td), GFP_ATOMIC);\n\t\tif (!td)\n\t\t\tfhci_err(fhci, \"No memory to allocate to TD\\n\");\n\t\telse\n\t\t\tinit_td(td);\n\t}\n\n\treturn td;\n}\n\nvoid fhci_recycle_empty_td(struct fhci_hcd *fhci, struct td *td)\n{\n\tinit_td(td);\n\tlist_add(&td->node, &fhci->empty_tds);\n}\n\nstruct ed *fhci_get_empty_ed(struct fhci_hcd *fhci)\n{\n\tstruct ed *ed;\n\n\tif (!list_empty(&fhci->empty_eds)) {\n\t\ted = list_entry(fhci->empty_eds.next, struct ed, node);\n\t\tlist_del(fhci->empty_eds.next);\n\t} else {\n\t\ted = kmalloc(sizeof(*ed), GFP_ATOMIC);\n\t\tif (!ed)\n\t\t\tfhci_err(fhci, \"No memory to allocate to ED\\n\");\n\t\telse\n\t\t\tinit_ed(ed);\n\t}\n\n\treturn ed;\n}\n\nvoid fhci_recycle_empty_ed(struct fhci_hcd *fhci, struct ed *ed)\n{\n\tinit_ed(ed);\n\tlist_add(&ed->node, &fhci->empty_eds);\n}\n\nstruct td *fhci_td_fill(struct fhci_hcd *fhci, struct urb *urb,\n\t\t\tstruct urb_priv *urb_priv, struct ed *ed, u16 index,\n\t\t\tenum fhci_ta_type type, int toggle, u8 *data, u32 len,\n\t\t\tu16 interval, u16 start_frame, bool ioc)\n{\n\tstruct td *td = get_empty_td(fhci);\n\n\tif (!td)\n\t\treturn NULL;\n\n\ttd->urb = urb;\n\ttd->ed = ed;\n\ttd->type = type;\n\ttd->toggle = toggle;\n\ttd->data = data;\n\ttd->len = len;\n\ttd->iso_index = index;\n\ttd->interval = interval;\n\ttd->start_frame = start_frame;\n\ttd->ioc = ioc;\n\ttd->status = USB_TD_OK;\n\n\turb_priv->tds[index] = td;\n\n\treturn td;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}