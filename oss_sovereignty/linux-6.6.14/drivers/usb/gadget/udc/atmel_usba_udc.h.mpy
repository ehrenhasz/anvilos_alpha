{
  "module_name": "atmel_usba_udc.h",
  "hash_id": "cadfd2fac656c74a27770a0312fdb46e01a05e2aa3ec42c9aa9d2acb3d248faa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/udc/atmel_usba_udc.h",
  "human_readable_source": "\n \n#ifndef __LINUX_USB_GADGET_USBA_UDC_H__\n#define __LINUX_USB_GADGET_USBA_UDC_H__\n\n#include <linux/gpio/consumer.h>\n\n \n#define USBA_CTRL\t\t\t\t0x0000\n#define USBA_FNUM\t\t\t\t0x0004\n#define USBA_INT_ENB\t\t\t\t0x0010\n#define USBA_INT_STA\t\t\t\t0x0014\n#define USBA_INT_CLR\t\t\t\t0x0018\n#define USBA_EPT_RST\t\t\t\t0x001c\n#define USBA_TST\t\t\t\t0x00e0\n\n \n#define USBA_EPT_CFG\t\t\t\t0x0000\n#define USBA_EPT_CTL_ENB\t\t\t0x0004\n#define USBA_EPT_CTL_DIS\t\t\t0x0008\n#define USBA_EPT_CTL\t\t\t\t0x000c\n#define USBA_EPT_SET_STA\t\t\t0x0014\n#define USBA_EPT_CLR_STA\t\t\t0x0018\n#define USBA_EPT_STA\t\t\t\t0x001c\n\n \n#define USBA_DMA_NXT_DSC\t\t\t0x0000\n#define USBA_DMA_ADDRESS\t\t\t0x0004\n#define USBA_DMA_CONTROL\t\t\t0x0008\n#define USBA_DMA_STATUS\t\t\t\t0x000c\n\n \n#define USBA_DEV_ADDR_OFFSET\t\t\t0\n#define USBA_DEV_ADDR_SIZE\t\t\t7\n#define USBA_FADDR_EN\t\t\t\t(1 <<  7)\n#define USBA_EN_USBA\t\t\t\t(1 <<  8)\n#define USBA_DETACH\t\t\t\t(1 <<  9)\n#define USBA_REMOTE_WAKE_UP\t\t\t(1 << 10)\n#define USBA_PULLD_DIS\t\t\t\t(1 << 11)\n\n#define USBA_ENABLE_MASK\t\t\t(USBA_EN_USBA | USBA_PULLD_DIS)\n#define USBA_DISABLE_MASK\t\t\tUSBA_DETACH\n\n \n#define USBA_MICRO_FRAME_NUM_OFFSET\t\t0\n#define USBA_MICRO_FRAME_NUM_SIZE\t\t3\n#define USBA_FRAME_NUMBER_OFFSET\t\t3\n#define USBA_FRAME_NUMBER_SIZE\t\t\t11\n#define USBA_FRAME_NUM_ERROR\t\t\t(1 << 31)\n\n \n#define USBA_HIGH_SPEED\t\t\t\t(1 <<  0)\n#define USBA_DET_SUSPEND\t\t\t(1 <<  1)\n#define USBA_MICRO_SOF\t\t\t\t(1 <<  2)\n#define USBA_SOF\t\t\t\t(1 <<  3)\n#define USBA_END_OF_RESET\t\t\t(1 <<  4)\n#define USBA_WAKE_UP\t\t\t\t(1 <<  5)\n#define USBA_END_OF_RESUME\t\t\t(1 <<  6)\n#define USBA_UPSTREAM_RESUME\t\t\t(1 <<  7)\n#define USBA_EPT_INT_OFFSET\t\t\t8\n#define USBA_EPT_INT_SIZE\t\t\t16\n#define USBA_DMA_INT_OFFSET\t\t\t24\n#define USBA_DMA_INT_SIZE\t\t\t8\n\n \n#define USBA_RST_OFFSET\t\t\t\t0\n#define USBA_RST_SIZE\t\t\t\t16\n\n \n#define USBA_SPEED_CFG_OFFSET\t\t\t0\n#define USBA_SPEED_CFG_SIZE\t\t\t2\n#define USBA_TST_J_MODE\t\t\t\t(1 <<  2)\n#define USBA_TST_K_MODE\t\t\t\t(1 <<  3)\n#define USBA_TST_PKT_MODE\t\t\t(1 <<  4)\n#define USBA_OPMODE2\t\t\t\t(1 <<  5)\n\n \n#define USBA_EPT_SIZE_OFFSET\t\t\t0\n#define USBA_EPT_SIZE_SIZE\t\t\t3\n#define USBA_EPT_DIR_IN\t\t\t\t(1 <<  3)\n#define USBA_EPT_TYPE_OFFSET\t\t\t4\n#define USBA_EPT_TYPE_SIZE\t\t\t2\n#define USBA_BK_NUMBER_OFFSET\t\t\t6\n#define USBA_BK_NUMBER_SIZE\t\t\t2\n#define USBA_NB_TRANS_OFFSET\t\t\t8\n#define USBA_NB_TRANS_SIZE\t\t\t2\n#define USBA_EPT_MAPPED\t\t\t\t(1 << 31)\n\n \n#define USBA_EPT_ENABLE\t\t\t\t(1 <<  0)\n#define USBA_AUTO_VALID\t\t\t\t(1 <<  1)\n#define USBA_INTDIS_DMA\t\t\t\t(1 <<  3)\n#define USBA_NYET_DIS\t\t\t\t(1 <<  4)\n#define USBA_DATAX_RX\t\t\t\t(1 <<  6)\n#define USBA_MDATA_RX\t\t\t\t(1 <<  7)\n \n#define USBA_BUSY_BANK_IE\t\t\t(1 << 18)\n\n \n#define USBA_FORCE_STALL\t\t\t(1 <<  5)\n#define USBA_TOGGLE_CLR\t\t\t\t(1 <<  6)\n#define USBA_TOGGLE_SEQ_OFFSET\t\t\t6\n#define USBA_TOGGLE_SEQ_SIZE\t\t\t2\n#define USBA_ERR_OVFLW\t\t\t\t(1 <<  8)\n#define USBA_RX_BK_RDY\t\t\t\t(1 <<  9)\n#define USBA_KILL_BANK\t\t\t\t(1 <<  9)\n#define USBA_TX_COMPLETE\t\t\t(1 << 10)\n#define USBA_TX_PK_RDY\t\t\t\t(1 << 11)\n#define USBA_ISO_ERR_TRANS\t\t\t(1 << 11)\n#define USBA_RX_SETUP\t\t\t\t(1 << 12)\n#define USBA_ISO_ERR_FLOW\t\t\t(1 << 12)\n#define USBA_STALL_SENT\t\t\t\t(1 << 13)\n#define USBA_ISO_ERR_CRC\t\t\t(1 << 13)\n#define USBA_ISO_ERR_NBTRANS\t\t\t(1 << 13)\n#define USBA_NAK_IN\t\t\t\t(1 << 14)\n#define USBA_ISO_ERR_FLUSH\t\t\t(1 << 14)\n#define USBA_NAK_OUT\t\t\t\t(1 << 15)\n#define USBA_CURRENT_BANK_OFFSET\t\t16\n#define USBA_CURRENT_BANK_SIZE\t\t\t2\n#define USBA_BUSY_BANKS_OFFSET\t\t\t18\n#define USBA_BUSY_BANKS_SIZE\t\t\t2\n#define USBA_BYTE_COUNT_OFFSET\t\t\t20\n#define USBA_BYTE_COUNT_SIZE\t\t\t11\n#define USBA_SHORT_PACKET\t\t\t(1 << 31)\n\n \n#define USBA_DMA_CH_EN\t\t\t\t(1 <<  0)\n#define USBA_DMA_LINK\t\t\t\t(1 <<  1)\n#define USBA_DMA_END_TR_EN\t\t\t(1 <<  2)\n#define USBA_DMA_END_BUF_EN\t\t\t(1 <<  3)\n#define USBA_DMA_END_TR_IE\t\t\t(1 <<  4)\n#define USBA_DMA_END_BUF_IE\t\t\t(1 <<  5)\n#define USBA_DMA_DESC_LOAD_IE\t\t\t(1 <<  6)\n#define USBA_DMA_BURST_LOCK\t\t\t(1 <<  7)\n#define USBA_DMA_BUF_LEN_OFFSET\t\t\t16\n#define USBA_DMA_BUF_LEN_SIZE\t\t\t16\n\n \n#define USBA_DMA_CH_ACTIVE\t\t\t(1 <<  1)\n#define USBA_DMA_END_TR_ST\t\t\t(1 <<  4)\n#define USBA_DMA_END_BUF_ST\t\t\t(1 <<  5)\n#define USBA_DMA_DESC_LOAD_ST\t\t\t(1 <<  6)\n\n \n#define USBA_SPEED_CFG_NORMAL\t\t\t0\n#define USBA_SPEED_CFG_FORCE_HIGH\t\t2\n#define USBA_SPEED_CFG_FORCE_FULL\t\t3\n\n \n#define USBA_EPT_SIZE_8\t\t\t\t0\n#define USBA_EPT_SIZE_16\t\t\t1\n#define USBA_EPT_SIZE_32\t\t\t2\n#define USBA_EPT_SIZE_64\t\t\t3\n#define USBA_EPT_SIZE_128\t\t\t4\n#define USBA_EPT_SIZE_256\t\t\t5\n#define USBA_EPT_SIZE_512\t\t\t6\n#define USBA_EPT_SIZE_1024\t\t\t7\n\n \n#define USBA_EPT_TYPE_CONTROL\t\t\t0\n#define USBA_EPT_TYPE_ISO\t\t\t1\n#define USBA_EPT_TYPE_BULK\t\t\t2\n#define USBA_EPT_TYPE_INT\t\t\t3\n\n \n#define USBA_BK_NUMBER_ZERO\t\t\t0\n#define USBA_BK_NUMBER_ONE\t\t\t1\n#define USBA_BK_NUMBER_DOUBLE\t\t\t2\n#define USBA_BK_NUMBER_TRIPLE\t\t\t3\n\n \n#define USBA_BF(name, value)\t\t\t\t\t\\\n\t(((value) & ((1 << USBA_##name##_SIZE) - 1))\t\t\\\n\t << USBA_##name##_OFFSET)\n#define USBA_BFEXT(name, value)\t\t\t\t\t\\\n\t(((value) >> USBA_##name##_OFFSET)\t\t\t\\\n\t & ((1 << USBA_##name##_SIZE) - 1))\n#define USBA_BFINS(name, value, old)\t\t\t\t\\\n\t(((old) & ~(((1 << USBA_##name##_SIZE) - 1)\t\t\\\n\t\t    << USBA_##name##_OFFSET))\t\t\t\\\n\t | USBA_BF(name, value))\n\n \n#define usba_readl(udc, reg)\t\t\t\t\t\\\n\treadl_relaxed((udc)->regs + USBA_##reg)\n#define usba_writel(udc, reg, value)\t\t\t\t\\\n\twritel_relaxed((value), (udc)->regs + USBA_##reg)\n#define usba_ep_readl(ep, reg)\t\t\t\t\t\\\n\treadl_relaxed((ep)->ep_regs + USBA_EPT_##reg)\n#define usba_ep_writel(ep, reg, value)\t\t\t\t\\\n\twritel_relaxed((value), (ep)->ep_regs + USBA_EPT_##reg)\n#define usba_dma_readl(ep, reg)\t\t\t\t\t\\\n\treadl_relaxed((ep)->dma_regs + USBA_DMA_##reg)\n#define usba_dma_writel(ep, reg, value)\t\t\t\t\\\n\twritel_relaxed((value), (ep)->dma_regs + USBA_DMA_##reg)\n\n \n#define USBA_EPT_BASE(x)\t(0x100 + (x) * 0x20)\n#define USBA_DMA_BASE(x)\t(0x300 + (x) * 0x10)\n#define USBA_FIFO_BASE(x)\t((x) << 16)\n\n \n#define USBA_NR_DMAS\t\t7\n\n#define EP0_FIFO_SIZE\t\t64\n#define EP0_EPT_SIZE\t\tUSBA_EPT_SIZE_64\n#define EP0_NR_BANKS\t\t1\n\n#define FIFO_IOMEM_ID\t0\n#define CTRL_IOMEM_ID\t1\n\n#define DBG_ERR\t\t0x0001\t \n#define DBG_HW\t\t0x0002\t \n#define DBG_GADGET\t0x0004\t \n#define DBG_INT\t\t0x0008\t \n#define DBG_BUS\t\t0x0010\t \n#define DBG_QUEUE\t0x0020   \n#define DBG_FIFO\t0x0040   \n#define DBG_DMA\t\t0x0080   \n#define DBG_REQ\t\t0x0100\t \n#define DBG_ALL\t\t0xffff\n#define DBG_NONE\t0x0000\n\n#define DEBUG_LEVEL\t(DBG_ERR)\n\n#define DBG(level, fmt, ...)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tif ((level) & DEBUG_LEVEL)\t\t\t\\\n\t\t\tpr_debug(\"udc: \" fmt, ## __VA_ARGS__);\t\\\n\t} while (0)\n\nenum usba_ctrl_state {\n\tWAIT_FOR_SETUP,\n\tDATA_STAGE_IN,\n\tDATA_STAGE_OUT,\n\tSTATUS_STAGE_IN,\n\tSTATUS_STAGE_OUT,\n\tSTATUS_STAGE_ADDR,\n\tSTATUS_STAGE_TEST,\n};\n \n\nstruct usba_dma_desc {\n\tdma_addr_t next;\n\tdma_addr_t addr;\n\tu32 ctrl;\n};\n\nstruct usba_fifo_cfg {\n\tu8\t\t\thw_ep_num;\n\tu16\t\t\tfifo_size;\n\tu8\t\t\tnr_banks;\n};\n\nstruct usba_ep {\n\tint\t\t\t\t\tstate;\n\tvoid __iomem\t\t\t\t*ep_regs;\n\tvoid __iomem\t\t\t\t*dma_regs;\n\tvoid __iomem\t\t\t\t*fifo;\n\tchar\t\t\t\t\tname[8];\n\tstruct usb_ep\t\t\t\tep;\n\tstruct usba_udc\t\t\t\t*udc;\n\n\tstruct list_head\t\t\tqueue;\n\n\tu16\t\t\t\t\tfifo_size;\n\tu8\t\t\t\t\tnr_banks;\n\tu8\t\t\t\t\tindex;\n\tunsigned int\t\t\t\tcan_dma:1;\n\tunsigned int\t\t\t\tcan_isoc:1;\n\tunsigned int\t\t\t\tis_isoc:1;\n\tunsigned int\t\t\t\tis_in:1;\n\tunsigned long\t\t\t\tept_cfg;\n#ifdef CONFIG_USB_GADGET_DEBUG_FS\n\tu32\t\t\t\t\tlast_dma_status;\n\tstruct dentry\t\t\t\t*debugfs_dir;\n#endif\n};\n\nstruct usba_ep_config {\n\tu8\t\t\t\t\tnr_banks;\n\tunsigned int\t\t\t\tcan_dma:1;\n\tunsigned int\t\t\t\tcan_isoc:1;\n};\n\nstruct usba_request {\n\tstruct usb_request\t\t\treq;\n\tstruct list_head\t\t\tqueue;\n\n\tu32\t\t\t\t\tctrl;\n\n\tunsigned int\t\t\t\tsubmitted:1;\n\tunsigned int\t\t\t\tlast_transaction:1;\n\tunsigned int\t\t\t\tusing_dma:1;\n\tunsigned int\t\t\t\tmapped:1;\n};\n\nstruct usba_udc_errata {\n\tvoid (*toggle_bias)(struct usba_udc *udc, int is_on);\n\tvoid (*pulse_bias)(struct usba_udc *udc);\n};\n\nstruct usba_udc_config {\n\tconst struct usba_udc_errata *errata;\n\tconst struct usba_ep_config *config;\n\tconst int num_ep;\n\tconst bool ep_prealloc;\n};\n\nstruct usba_udc {\n\t \n\tspinlock_t lock;\n\n\t \n\tstruct mutex vbus_mutex;\n\n\tvoid __iomem *regs;\n\tvoid __iomem *fifo;\n\n\tstruct usb_gadget gadget;\n\tstruct usb_gadget_driver *driver;\n\tstruct platform_device *pdev;\n\tconst struct usba_udc_errata *errata;\n\tint irq;\n\tstruct gpio_desc *vbus_pin;\n\tint num_ep;\n\tstruct usba_fifo_cfg *fifo_cfg;\n\tstruct clk *pclk;\n\tstruct clk *hclk;\n\tstruct usba_ep *usba_ep;\n\tbool bias_pulse_needed;\n\tbool clocked;\n\tbool suspended;\n\tbool ep_prealloc;\n\n\tu16 devstatus;\n\n\tu16 test_mode;\n\tint vbus_prev;\n\n\tu32 int_enb_cache;\n\n#ifdef CONFIG_USB_GADGET_DEBUG_FS\n\tstruct dentry *debugfs_root;\n#endif\n\n\tstruct regmap *pmc;\n};\n\nstatic inline struct usba_ep *to_usba_ep(struct usb_ep *ep)\n{\n\treturn container_of(ep, struct usba_ep, ep);\n}\n\nstatic inline struct usba_request *to_usba_req(struct usb_request *req)\n{\n\treturn container_of(req, struct usba_request, req);\n}\n\nstatic inline struct usba_udc *to_usba_udc(struct usb_gadget *gadget)\n{\n\treturn container_of(gadget, struct usba_udc, gadget);\n}\n\n#define ep_is_control(ep)\t((ep)->index == 0)\n#define ep_is_idle(ep)\t\t((ep)->state == EP_STATE_IDLE)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}