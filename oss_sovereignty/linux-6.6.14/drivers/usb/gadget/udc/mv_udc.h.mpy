{
  "module_name": "mv_udc.h",
  "hash_id": "93d260b127ec42afe26179d54dce6a187eff08785540d683ba20ee8c90f16895",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/udc/mv_udc.h",
  "human_readable_source": "\n \n\n#ifndef __MV_UDC_H\n#define __MV_UDC_H\n\n#define VUSBHS_MAX_PORTS\t8\n\n#define DQH_ALIGNMENT\t\t2048\n#define DTD_ALIGNMENT\t\t64\n#define DMA_BOUNDARY\t\t4096\n\n#define EP_DIR_IN\t1\n#define EP_DIR_OUT\t0\n\n#define DMA_ADDR_INVALID\t(~(dma_addr_t)0)\n\n#define EP0_MAX_PKT_SIZE\t64\n \n#define WAIT_FOR_SETUP\t\t0\n#define DATA_STATE_XMIT\t\t1\n#define DATA_STATE_NEED_ZLP\t2\n#define WAIT_FOR_OUT_STATUS\t3\n#define DATA_STATE_RECV\t\t4\n\n#define CAPLENGTH_MASK\t\t(0xff)\n#define DCCPARAMS_DEN_MASK\t(0x1f)\n\n#define HCSPARAMS_PPC\t\t(0x10)\n\n \n#define USB_FRINDEX_MASKS\t0x3fff\n\n \n#define USBCMD_RUN_STOP\t\t\t\t(0x00000001)\n#define USBCMD_CTRL_RESET\t\t\t(0x00000002)\n#define USBCMD_SETUP_TRIPWIRE_SET\t\t(0x00002000)\n#define USBCMD_SETUP_TRIPWIRE_CLEAR\t\t(~USBCMD_SETUP_TRIPWIRE_SET)\n\n#define USBCMD_ATDTW_TRIPWIRE_SET\t\t(0x00004000)\n#define USBCMD_ATDTW_TRIPWIRE_CLEAR\t\t(~USBCMD_ATDTW_TRIPWIRE_SET)\n\n \n#define USBCMD_FRAME_SIZE_1024\t\t\t(0x00000000)  \n#define USBCMD_FRAME_SIZE_512\t\t\t(0x00000004)  \n#define USBCMD_FRAME_SIZE_256\t\t\t(0x00000008)  \n#define USBCMD_FRAME_SIZE_128\t\t\t(0x0000000C)  \n#define USBCMD_FRAME_SIZE_64\t\t\t(0x00008000)  \n#define USBCMD_FRAME_SIZE_32\t\t\t(0x00008004)  \n#define USBCMD_FRAME_SIZE_16\t\t\t(0x00008008)  \n#define USBCMD_FRAME_SIZE_8\t\t\t(0x0000800C)  \n\n#define EPCTRL_TX_ALL_MASK\t\t\t(0xFFFF0000)\n#define EPCTRL_RX_ALL_MASK\t\t\t(0x0000FFFF)\n\n#define EPCTRL_TX_DATA_TOGGLE_RST\t\t(0x00400000)\n#define EPCTRL_TX_EP_STALL\t\t\t(0x00010000)\n#define EPCTRL_RX_EP_STALL\t\t\t(0x00000001)\n#define EPCTRL_RX_DATA_TOGGLE_RST\t\t(0x00000040)\n#define EPCTRL_RX_ENABLE\t\t\t(0x00000080)\n#define EPCTRL_TX_ENABLE\t\t\t(0x00800000)\n#define EPCTRL_CONTROL\t\t\t\t(0x00000000)\n#define EPCTRL_ISOCHRONOUS\t\t\t(0x00040000)\n#define EPCTRL_BULK\t\t\t\t(0x00080000)\n#define EPCTRL_INT\t\t\t\t(0x000C0000)\n#define EPCTRL_TX_TYPE\t\t\t\t(0x000C0000)\n#define EPCTRL_RX_TYPE\t\t\t\t(0x0000000C)\n#define EPCTRL_DATA_TOGGLE_INHIBIT\t\t(0x00000020)\n#define EPCTRL_TX_EP_TYPE_SHIFT\t\t\t(18)\n#define EPCTRL_RX_EP_TYPE_SHIFT\t\t\t(2)\n\n#define EPCOMPLETE_MAX_ENDPOINTS\t\t(16)\n\n \n#define USB_EP_LIST_ADDRESS_MASK              0xfffff800\n\n#define PORTSCX_W1C_BITS\t\t\t0x2a\n#define PORTSCX_PORT_RESET\t\t\t0x00000100\n#define PORTSCX_PORT_POWER\t\t\t0x00001000\n#define PORTSCX_FORCE_FULL_SPEED_CONNECT\t0x01000000\n#define PORTSCX_PAR_XCVR_SELECT\t\t\t0xC0000000\n#define PORTSCX_PORT_FORCE_RESUME\t\t0x00000040\n#define PORTSCX_PORT_SUSPEND\t\t\t0x00000080\n#define PORTSCX_PORT_SPEED_FULL\t\t\t0x00000000\n#define PORTSCX_PORT_SPEED_LOW\t\t\t0x04000000\n#define PORTSCX_PORT_SPEED_HIGH\t\t\t0x08000000\n#define PORTSCX_PORT_SPEED_MASK\t\t\t0x0C000000\n\n \n#define USBMODE_CTRL_MODE_IDLE\t\t\t0x00000000\n#define USBMODE_CTRL_MODE_DEVICE\t\t0x00000002\n#define USBMODE_CTRL_MODE_HOST\t\t\t0x00000003\n#define USBMODE_CTRL_MODE_RSV\t\t\t0x00000001\n#define USBMODE_SETUP_LOCK_OFF\t\t\t0x00000008\n#define USBMODE_STREAM_DISABLE\t\t\t0x00000010\n\n \n#define USBSTS_INT\t\t\t0x00000001\n#define USBSTS_ERR\t\t\t0x00000002\n#define USBSTS_PORT_CHANGE\t\t0x00000004\n#define USBSTS_FRM_LST_ROLL\t\t0x00000008\n#define USBSTS_SYS_ERR\t\t\t0x00000010\n#define USBSTS_IAA\t\t\t0x00000020\n#define USBSTS_RESET\t\t\t0x00000040\n#define USBSTS_SOF\t\t\t0x00000080\n#define USBSTS_SUSPEND\t\t\t0x00000100\n#define USBSTS_HC_HALTED\t\t0x00001000\n#define USBSTS_RCL\t\t\t0x00002000\n#define USBSTS_PERIODIC_SCHEDULE\t0x00004000\n#define USBSTS_ASYNC_SCHEDULE\t\t0x00008000\n\n\n \n#define USBINTR_INT_EN                          (0x00000001)\n#define USBINTR_ERR_INT_EN                      (0x00000002)\n#define USBINTR_PORT_CHANGE_DETECT_EN           (0x00000004)\n\n#define USBINTR_ASYNC_ADV_AAE                   (0x00000020)\n#define USBINTR_ASYNC_ADV_AAE_ENABLE            (0x00000020)\n#define USBINTR_ASYNC_ADV_AAE_DISABLE           (0xFFFFFFDF)\n\n#define USBINTR_RESET_EN                        (0x00000040)\n#define USBINTR_SOF_UFRAME_EN                   (0x00000080)\n#define USBINTR_DEVICE_SUSPEND                  (0x00000100)\n\n#define USB_DEVICE_ADDRESS_MASK\t\t\t(0xfe000000)\n#define USB_DEVICE_ADDRESS_BIT_SHIFT\t\t(25)\n\nstruct mv_cap_regs {\n\tu32\tcaplength_hciversion;\n\tu32\thcsparams;\t \n\tu32\thccparams;\t \n\tu32\treserved[5];\n\tu32\tdciversion;\t \n\tu32\tdccparams;\t \n};\n\nstruct mv_op_regs {\n\tu32\tusbcmd;\t\t \n\tu32\tusbsts;\t\t \n\tu32\tusbintr;\t \n\tu32\tfrindex;\t \n\tu32\treserved1[1];\n\tu32\tdeviceaddr;\t \n\tu32\teplistaddr;\t \n\tu32\tttctrl;\t\t \n\tu32\tburstsize;\t \n\tu32\ttxfilltuning;\t \n\tu32\treserved[4];\n\tu32\tepnak;\t\t \n\tu32\tepnaken;\t \n\tu32\tconfigflag;\t \n\tu32\tportsc[VUSBHS_MAX_PORTS];  \n\tu32\totgsc;\n\tu32\tusbmode;\t \n\tu32\tepsetupstat;\t \n\tu32\tepprime;\t \n\tu32\tepflush;\t \n\tu32\tepstatus;\t \n\tu32\tepcomplete;\t \n\tu32\tepctrlx[16];\t \n\tu32\tmcr;\t\t \n\tu32\tisr;\t\t \n\tu32\tier;\t\t \n};\n\nstruct mv_udc {\n\tstruct usb_gadget\t\tgadget;\n\tstruct usb_gadget_driver\t*driver;\n\tspinlock_t\t\t\tlock;\n\tstruct completion\t\t*done;\n\tstruct platform_device\t\t*dev;\n\tint\t\t\t\tirq;\n\n\tstruct mv_cap_regs __iomem\t*cap_regs;\n\tstruct mv_op_regs __iomem\t*op_regs;\n\tvoid __iomem                    *phy_regs;\n\tunsigned int\t\t\tmax_eps;\n\tstruct mv_dqh\t\t\t*ep_dqh;\n\tsize_t\t\t\t\tep_dqh_size;\n\tdma_addr_t\t\t\tep_dqh_dma;\n\n\tstruct dma_pool\t\t\t*dtd_pool;\n\tstruct mv_ep\t\t\t*eps;\n\n\tstruct mv_dtd\t\t\t*dtd_head;\n\tstruct mv_dtd\t\t\t*dtd_tail;\n\tunsigned int\t\t\tdtd_entries;\n\n\tstruct mv_req\t\t\t*status_req;\n\tstruct usb_ctrlrequest\t\tlocal_setup_buff;\n\n\tunsigned int\t\tresume_state;\t \n\tunsigned int\t\tusb_state;\t \n\tunsigned int\t\tep0_state;\t \n\tunsigned int\t\tep0_dir;\n\n\tunsigned int\t\tdev_addr;\n\tunsigned int\t\ttest_mode;\n\n\tint\t\t\terrors;\n\tunsigned\t\tsoftconnect:1,\n\t\t\t\tvbus_active:1,\n\t\t\t\tremote_wakeup:1,\n\t\t\t\tsoftconnected:1,\n\t\t\t\tforce_fs:1,\n\t\t\t\tclock_gating:1,\n\t\t\t\tactive:1,\n\t\t\t\tstopped:1;       \n\n\tstruct work_struct\tvbus_work;\n\tstruct workqueue_struct *qwork;\n\n\tstruct usb_phy\t\t*transceiver;\n\n\tstruct mv_usb_platform_data     *pdata;\n\n\t \n\tstruct clk      *clk;\n};\n\n \nstruct mv_ep {\n\tstruct usb_ep\t\tep;\n\tstruct mv_udc\t\t*udc;\n\tstruct list_head\tqueue;\n\tstruct mv_dqh\t\t*dqh;\n\tu32\t\t\tdirection;\n\tchar\t\t\tname[14];\n\tunsigned\t\tstopped:1,\n\t\t\t\twedge:1,\n\t\t\t\tep_type:2,\n\t\t\t\tep_num:8;\n};\n\n \nstruct mv_req {\n\tstruct usb_request\treq;\n\tstruct mv_dtd\t\t*dtd, *head, *tail;\n\tstruct mv_ep\t\t*ep;\n\tstruct list_head\tqueue;\n\tunsigned int            test_mode;\n\tunsigned\t\tdtd_count;\n\tunsigned\t\tmapped:1;\n};\n\n#define EP_QUEUE_HEAD_MULT_POS\t\t\t30\n#define EP_QUEUE_HEAD_ZLT_SEL\t\t\t0x20000000\n#define EP_QUEUE_HEAD_MAX_PKT_LEN_POS\t\t16\n#define EP_QUEUE_HEAD_MAX_PKT_LEN(ep_info)\t(((ep_info)>>16)&0x07ff)\n#define EP_QUEUE_HEAD_IOS\t\t\t0x00008000\n#define EP_QUEUE_HEAD_NEXT_TERMINATE\t\t0x00000001\n#define EP_QUEUE_HEAD_IOC\t\t\t0x00008000\n#define EP_QUEUE_HEAD_MULTO\t\t\t0x00000C00\n#define EP_QUEUE_HEAD_STATUS_HALT\t\t0x00000040\n#define EP_QUEUE_HEAD_STATUS_ACTIVE\t\t0x00000080\n#define EP_QUEUE_CURRENT_OFFSET_MASK\t\t0x00000FFF\n#define EP_QUEUE_HEAD_NEXT_POINTER_MASK\t\t0xFFFFFFE0\n#define EP_QUEUE_FRINDEX_MASK\t\t\t0x000007FF\n#define EP_MAX_LENGTH_TRANSFER\t\t\t0x4000\n\nstruct mv_dqh {\n\t \n\tu32\tmax_packet_length;\n\tu32\tcurr_dtd_ptr;\t\t \n\tu32\tnext_dtd_ptr;\t\t \n\t \n\tu32\tsize_ioc_int_sts;\n\tu32\tbuff_ptr0;\t\t \n\tu32\tbuff_ptr1;\t\t \n\tu32\tbuff_ptr2;\t\t \n\tu32\tbuff_ptr3;\t\t \n\tu32\tbuff_ptr4;\t\t \n\tu32\treserved1;\n\t \n\tu8\tsetup_buffer[8];\n\tu32\treserved2[4];\n};\n\n\n#define DTD_NEXT_TERMINATE\t\t(0x00000001)\n#define DTD_IOC\t\t\t\t(0x00008000)\n#define DTD_STATUS_ACTIVE\t\t(0x00000080)\n#define DTD_STATUS_HALTED\t\t(0x00000040)\n#define DTD_STATUS_DATA_BUFF_ERR\t(0x00000020)\n#define DTD_STATUS_TRANSACTION_ERR\t(0x00000008)\n#define DTD_RESERVED_FIELDS\t\t(0x00007F00)\n#define DTD_ERROR_MASK\t\t\t(0x68)\n#define DTD_ADDR_MASK\t\t\t(0xFFFFFFE0)\n#define DTD_PACKET_SIZE\t\t\t0x7FFF0000\n#define DTD_LENGTH_BIT_POS\t\t(16)\n\nstruct mv_dtd {\n\tu32\tdtd_next;\n\tu32\tsize_ioc_sts;\n\tu32\tbuff_ptr0;\t\t \n\tu32\tbuff_ptr1;\t\t \n\tu32\tbuff_ptr2;\t\t \n\tu32\tbuff_ptr3;\t\t \n\tu32\tbuff_ptr4;\t\t \n\tu32\tscratch_ptr;\n\t \n\tdma_addr_t td_dma;\t\t \n\tstruct mv_dtd *next_dtd_virt;\n};\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}