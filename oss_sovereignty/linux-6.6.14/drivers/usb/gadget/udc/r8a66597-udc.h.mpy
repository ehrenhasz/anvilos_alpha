{
  "module_name": "r8a66597-udc.h",
  "hash_id": "39b36ae358d183dbdf6b32cd03a16cd08fb5beb6d2b54783e3304d6e0e9e6155",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/udc/r8a66597-udc.h",
  "human_readable_source": "\n \n\n#ifndef __R8A66597_H__\n#define __R8A66597_H__\n\n#include <linux/clk.h>\n#include <linux/usb/r8a66597.h>\n\n#define R8A66597_MAX_SAMPLING\t10\n\n#define R8A66597_MAX_NUM_PIPE\t8\n#define R8A66597_MAX_NUM_BULK\t3\n#define R8A66597_MAX_NUM_ISOC\t2\n#define R8A66597_MAX_NUM_INT\t2\n\n#define R8A66597_BASE_PIPENUM_BULK\t3\n#define R8A66597_BASE_PIPENUM_ISOC\t1\n#define R8A66597_BASE_PIPENUM_INT\t6\n\n#define R8A66597_BASE_BUFNUM\t6\n#define R8A66597_MAX_BUFNUM\t0x4F\n\n#define is_bulk_pipe(pipenum)\t\\\n\t((pipenum >= R8A66597_BASE_PIPENUM_BULK) && \\\n\t (pipenum < (R8A66597_BASE_PIPENUM_BULK + R8A66597_MAX_NUM_BULK)))\n#define is_interrupt_pipe(pipenum)\t\\\n\t((pipenum >= R8A66597_BASE_PIPENUM_INT) && \\\n\t (pipenum < (R8A66597_BASE_PIPENUM_INT + R8A66597_MAX_NUM_INT)))\n#define is_isoc_pipe(pipenum)\t\\\n\t((pipenum >= R8A66597_BASE_PIPENUM_ISOC) && \\\n\t (pipenum < (R8A66597_BASE_PIPENUM_ISOC + R8A66597_MAX_NUM_ISOC)))\n\n#define r8a66597_is_sudmac(r8a66597)\t(r8a66597->pdata->sudmac)\nstruct r8a66597_pipe_info {\n\tu16\tpipe;\n\tu16\tepnum;\n\tu16\tmaxpacket;\n\tu16\ttype;\n\tu16\tinterval;\n\tu16\tdir_in;\n};\n\nstruct r8a66597_request {\n\tstruct usb_request\treq;\n\tstruct list_head\tqueue;\n};\n\nstruct r8a66597_ep {\n\tstruct usb_ep\t\tep;\n\tstruct r8a66597\t\t*r8a66597;\n\tstruct r8a66597_dma\t*dma;\n\n\tstruct list_head\tqueue;\n\tunsigned\t\tbusy:1;\n\tunsigned\t\twedge:1;\n\tunsigned\t\tinternal_ccpl:1;\t \n\n\t \n\tunsigned\t\tuse_dma:1;\n\tu16\t\t\tpipenum;\n\tu16\t\t\ttype;\n\n\t \n\tunsigned char\t\tfifoaddr;\n\tunsigned char\t\tfifosel;\n\tunsigned char\t\tfifoctr;\n\tunsigned char\t\tpipectr;\n\tunsigned char\t\tpipetre;\n\tunsigned char\t\tpipetrn;\n};\n\nstruct r8a66597_dma {\n\tunsigned\t\tused:1;\n\tunsigned\t\tdir:1;\t \n};\n\nstruct r8a66597 {\n\tspinlock_t\t\tlock;\n\tvoid __iomem\t\t*reg;\n\tvoid __iomem\t\t*sudmac_reg;\n\n\tstruct clk *clk;\n\tstruct r8a66597_platdata\t*pdata;\n\n\tstruct usb_gadget\t\tgadget;\n\tstruct usb_gadget_driver\t*driver;\n\n\tstruct r8a66597_ep\tep[R8A66597_MAX_NUM_PIPE];\n\tstruct r8a66597_ep\t*pipenum2ep[R8A66597_MAX_NUM_PIPE];\n\tstruct r8a66597_ep\t*epaddr2ep[16];\n\tstruct r8a66597_dma\tdma;\n\n\tstruct timer_list\ttimer;\n\tstruct usb_request\t*ep0_req;\t \n\tu16\t\t\tep0_data;\t \n\tu16\t\t\told_vbus;\n\tu16\t\t\tscount;\n\tu16\t\t\told_dvsq;\n\tu16\t\t\tdevice_status;\t \n\n\t \n\tunsigned char bulk;\n\tunsigned char interrupt;\n\tunsigned char isochronous;\n\tunsigned char num_dma;\n\n\tunsigned irq_sense_low:1;\n};\n\n#define gadget_to_r8a66597(_gadget)\t\\\n\t\tcontainer_of(_gadget, struct r8a66597, gadget)\n#define r8a66597_to_gadget(r8a66597) (&r8a66597->gadget)\n#define r8a66597_to_dev(r8a66597)\t(r8a66597->gadget.dev.parent)\n\nstatic inline u16 r8a66597_read(struct r8a66597 *r8a66597, unsigned long offset)\n{\n\treturn ioread16(r8a66597->reg + offset);\n}\n\nstatic inline void r8a66597_read_fifo(struct r8a66597 *r8a66597,\n\t\t\t\t      unsigned long offset,\n\t\t\t\t      unsigned char *buf,\n\t\t\t\t      int len)\n{\n\tvoid __iomem *fifoaddr = r8a66597->reg + offset;\n\tunsigned int data = 0;\n\tint i;\n\n\tif (r8a66597->pdata->on_chip) {\n\t\t \n\n\t\t \n\t\tif (len >= 4 && !((unsigned long)buf & 0x03)) {\n\t\t\tioread32_rep(fifoaddr, buf, len / 4);\n\t\t\tbuf += len & ~0x03;\n\t\t\tlen &= 0x03;\n\t\t}\n\n\t\t \n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!(i & 0x03))\n\t\t\t\tdata = ioread32(fifoaddr);\n\n\t\t\tbuf[i] = (data >> ((i & 0x03) * 8)) & 0xff;\n\t\t}\n\t} else {\n\t\t \n\n\t\t \n\t\tif (len >= 2 && !((unsigned long)buf & 0x01)) {\n\t\t\tioread16_rep(fifoaddr, buf, len / 2);\n\t\t\tbuf += len & ~0x01;\n\t\t\tlen &= 0x01;\n\t\t}\n\n\t\t \n\t\tfor (i = 0; i < len; i++) {\n\t\t\tif (!(i & 0x01))\n\t\t\t\tdata = ioread16(fifoaddr);\n\n\t\t\tbuf[i] = (data >> ((i & 0x01) * 8)) & 0xff;\n\t\t}\n\t}\n}\n\nstatic inline void r8a66597_write(struct r8a66597 *r8a66597, u16 val,\n\t\t\t\t  unsigned long offset)\n{\n\tiowrite16(val, r8a66597->reg + offset);\n}\n\nstatic inline void r8a66597_mdfy(struct r8a66597 *r8a66597,\n\t\t\t\t u16 val, u16 pat, unsigned long offset)\n{\n\tu16 tmp;\n\ttmp = r8a66597_read(r8a66597, offset);\n\ttmp = tmp & (~pat);\n\ttmp = tmp | val;\n\tr8a66597_write(r8a66597, tmp, offset);\n}\n\n#define r8a66597_bclr(r8a66597, val, offset)\t\\\n\t\t\tr8a66597_mdfy(r8a66597, 0, val, offset)\n#define r8a66597_bset(r8a66597, val, offset)\t\\\n\t\t\tr8a66597_mdfy(r8a66597, val, 0, offset)\n\nstatic inline void r8a66597_write_fifo(struct r8a66597 *r8a66597,\n\t\t\t\t       struct r8a66597_ep *ep,\n\t\t\t\t       unsigned char *buf,\n\t\t\t\t       int len)\n{\n\tvoid __iomem *fifoaddr = r8a66597->reg + ep->fifoaddr;\n\tint adj = 0;\n\tint i;\n\n\tif (r8a66597->pdata->on_chip) {\n\t\t \n\t\tif (len >= 4 && !((unsigned long)buf & 0x03)) {\n\t\t\tiowrite32_rep(fifoaddr, buf, len / 4);\n\t\t\tbuf += len & ~0x03;\n\t\t\tlen &= 0x03;\n\t\t}\n\t} else {\n\t\t \n\t\tif (len >= 2 && !((unsigned long)buf & 0x01)) {\n\t\t\tiowrite16_rep(fifoaddr, buf, len / 2);\n\t\t\tbuf += len & ~0x01;\n\t\t\tlen &= 0x01;\n\t\t}\n\t}\n\n\t \n\tif (!(r8a66597_read(r8a66597, CFIFOSEL) & BIGEND)) {\n\t\tif (r8a66597->pdata->on_chip)\n\t\t\tadj = 0x03;  \n\t\telse\n\t\t\tadj = 0x01;  \n\t}\n\n\tif (r8a66597->pdata->wr0_shorted_to_wr1)\n\t\tr8a66597_bclr(r8a66597, MBW_16, ep->fifosel);\n\tfor (i = 0; i < len; i++)\n\t\tiowrite8(buf[i], fifoaddr + adj - (i & adj));\n\tif (r8a66597->pdata->wr0_shorted_to_wr1)\n\t\tr8a66597_bclr(r8a66597, MBW_16, ep->fifosel);\n}\n\nstatic inline u16 get_xtal_from_pdata(struct r8a66597_platdata *pdata)\n{\n\tu16 clock = 0;\n\n\tswitch (pdata->xtal) {\n\tcase R8A66597_PLATDATA_XTAL_12MHZ:\n\t\tclock = XTAL12;\n\t\tbreak;\n\tcase R8A66597_PLATDATA_XTAL_24MHZ:\n\t\tclock = XTAL24;\n\t\tbreak;\n\tcase R8A66597_PLATDATA_XTAL_48MHZ:\n\t\tclock = XTAL48;\n\t\tbreak;\n\tdefault:\n\t\tprintk(KERN_ERR \"r8a66597: platdata clock is wrong.\\n\");\n\t\tbreak;\n\t}\n\n\treturn clock;\n}\n\nstatic inline u32 r8a66597_sudmac_read(struct r8a66597 *r8a66597,\n\t\t\t\t       unsigned long offset)\n{\n\treturn ioread32(r8a66597->sudmac_reg + offset);\n}\n\nstatic inline void r8a66597_sudmac_write(struct r8a66597 *r8a66597, u32 val,\n\t\t\t\t\t unsigned long offset)\n{\n\tiowrite32(val, r8a66597->sudmac_reg + offset);\n}\n\n#define get_pipectr_addr(pipenum)\t(PIPE1CTR + (pipenum - 1) * 2)\n#define get_pipetre_addr(pipenum)\t(PIPE1TRE + (pipenum - 1) * 4)\n#define get_pipetrn_addr(pipenum)\t(PIPE1TRN + (pipenum - 1) * 4)\n\n#define enable_irq_ready(r8a66597, pipenum)\t\\\n\tenable_pipe_irq(r8a66597, pipenum, BRDYENB)\n#define disable_irq_ready(r8a66597, pipenum)\t\\\n\tdisable_pipe_irq(r8a66597, pipenum, BRDYENB)\n#define enable_irq_empty(r8a66597, pipenum)\t\\\n\tenable_pipe_irq(r8a66597, pipenum, BEMPENB)\n#define disable_irq_empty(r8a66597, pipenum)\t\\\n\tdisable_pipe_irq(r8a66597, pipenum, BEMPENB)\n#define enable_irq_nrdy(r8a66597, pipenum)\t\\\n\tenable_pipe_irq(r8a66597, pipenum, NRDYENB)\n#define disable_irq_nrdy(r8a66597, pipenum)\t\\\n\tdisable_pipe_irq(r8a66597, pipenum, NRDYENB)\n\n#endif\t \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}