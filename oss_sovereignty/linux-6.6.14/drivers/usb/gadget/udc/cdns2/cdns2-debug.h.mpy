{
  "module_name": "cdns2-debug.h",
  "hash_id": "ba8aa638a159c8e22b6dd27d2e1fbaa9519135d5fa0ecf7a996abdddc506b7ae",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/udc/cdns2/cdns2-debug.h",
  "human_readable_source": " \n \n\n#ifndef __LINUX_CDNS2_DEBUG\n#define __LINUX_CDNS2_DEBUG\n\nstatic inline const char *cdns2_decode_usb_irq(char *str, size_t size,\n\t\t\t\t\t       u8 usb_irq, u8 ext_irq)\n{\n\tint ret;\n\n\tret = snprintf(str, size, \"usbirq: 0x%02x - \", usb_irq);\n\n\tif (usb_irq & USBIRQ_SOF)\n\t\tret += snprintf(str + ret, size - ret, \"SOF \");\n\tif (usb_irq & USBIRQ_SUTOK)\n\t\tret += snprintf(str + ret, size - ret, \"SUTOK \");\n\tif (usb_irq & USBIRQ_SUDAV)\n\t\tret += snprintf(str + ret, size - ret, \"SETUP \");\n\tif (usb_irq & USBIRQ_SUSPEND)\n\t\tret += snprintf(str + ret, size - ret, \"Suspend \");\n\tif (usb_irq & USBIRQ_URESET)\n\t\tret += snprintf(str + ret, size - ret, \"Reset \");\n\tif (usb_irq & USBIRQ_HSPEED)\n\t\tret += snprintf(str + ret, size - ret, \"HS \");\n\tif (usb_irq & USBIRQ_LPM)\n\t\tret += snprintf(str + ret, size - ret, \"LPM \");\n\n\tret += snprintf(str + ret, size - ret, \", EXT: 0x%02x - \", ext_irq);\n\n\tif (ext_irq & EXTIRQ_WAKEUP)\n\t\tret += snprintf(str + ret, size - ret, \"Wakeup \");\n\tif (ext_irq & EXTIRQ_VBUSFAULT_FALL)\n\t\tret += snprintf(str + ret, size - ret, \"VBUS_FALL \");\n\tif (ext_irq & EXTIRQ_VBUSFAULT_RISE)\n\t\tret += snprintf(str + ret, size - ret, \"VBUS_RISE \");\n\n\tif (ret >= size)\n\t\tpr_info(\"CDNS2: buffer overflowed.\\n\");\n\n\treturn str;\n}\n\nstatic inline const char *cdns2_decode_dma_irq(char *str, size_t size,\n\t\t\t\t\t       u32 ep_ists, u32 ep_sts,\n\t\t\t\t\t       const char *ep_name)\n{\n\tint ret;\n\n\tret = snprintf(str, size, \"ISTS: %08x, %s: %08x \",\n\t\t       ep_ists, ep_name, ep_sts);\n\n\tif (ep_sts & DMA_EP_STS_IOC)\n\t\tret += snprintf(str + ret, size - ret, \"IOC \");\n\tif (ep_sts & DMA_EP_STS_ISP)\n\t\tret += snprintf(str + ret, size - ret, \"ISP \");\n\tif (ep_sts & DMA_EP_STS_DESCMIS)\n\t\tret += snprintf(str + ret, size - ret, \"DESCMIS \");\n\tif (ep_sts & DMA_EP_STS_TRBERR)\n\t\tret += snprintf(str + ret, size - ret, \"TRBERR \");\n\tif (ep_sts & DMA_EP_STS_OUTSMM)\n\t\tret += snprintf(str + ret, size - ret, \"OUTSMM \");\n\tif (ep_sts & DMA_EP_STS_ISOERR)\n\t\tret += snprintf(str + ret, size - ret, \"ISOERR \");\n\tif (ep_sts & DMA_EP_STS_DBUSY)\n\t\tret += snprintf(str + ret, size - ret, \"DBUSY \");\n\tif (DMA_EP_STS_CCS(ep_sts))\n\t\tret += snprintf(str + ret, size - ret, \"CCS \");\n\n\tif (ret >= size)\n\t\tpr_info(\"CDNS2: buffer overflowed.\\n\");\n\n\treturn str;\n}\n\nstatic inline const char *cdns2_decode_epx_irq(char *str, size_t size,\n\t\t\t\t\t       char *ep_name, u32 ep_ists,\n\t\t\t\t\t       u32 ep_sts)\n{\n\treturn cdns2_decode_dma_irq(str, size, ep_ists, ep_sts, ep_name);\n}\n\nstatic inline const char *cdns2_decode_ep0_irq(char *str, size_t size,\n\t\t\t\t\t       u32 ep_ists, u32 ep_sts,\n\t\t\t\t\t       int dir)\n{\n\treturn cdns2_decode_dma_irq(str, size, ep_ists, ep_sts,\n\t\t\t\t    dir ? \"ep0IN\" : \"ep0OUT\");\n}\n\nstatic inline const char *cdns2_raw_ring(struct cdns2_endpoint *pep,\n\t\t\t\t\t struct cdns2_trb *trbs,\n\t\t\t\t\t char *str, size_t size)\n{\n\tstruct cdns2_ring *ring = &pep->ring;\n\tstruct cdns2_trb *trb;\n\tdma_addr_t dma;\n\tint ret;\n\tint i;\n\n\tret = snprintf(str, size, \"\\n\\t\\tTR for %s:\", pep->name);\n\n\ttrb = &trbs[ring->dequeue];\n\tdma = cdns2_trb_virt_to_dma(pep, trb);\n\tret += snprintf(str + ret, size - ret,\n\t\t\t\"\\n\\t\\tRing deq index: %d, trb: V=%p, P=0x%pad\\n\",\n\t\t\tring->dequeue, trb, &dma);\n\n\ttrb = &trbs[ring->enqueue];\n\tdma = cdns2_trb_virt_to_dma(pep, trb);\n\tret += snprintf(str + ret, size - ret,\n\t\t\t\"\\t\\tRing enq index: %d, trb: V=%p, P=0x%pad\\n\",\n\t\t\tring->enqueue, trb, &dma);\n\n\tret += snprintf(str + ret, size - ret,\n\t\t\t\"\\t\\tfree trbs: %d, CCS=%d, PCS=%d\\n\",\n\t\t\tring->free_trbs, ring->ccs, ring->pcs);\n\n\tif (TRBS_PER_SEGMENT > 40) {\n\t\tret += snprintf(str + ret, size - ret,\n\t\t\t\t\"\\t\\tTransfer ring %d too big\\n\", TRBS_PER_SEGMENT);\n\t\treturn str;\n\t}\n\n\tdma = ring->dma;\n\tfor (i = 0; i < TRBS_PER_SEGMENT; ++i) {\n\t\ttrb = &trbs[i];\n\t\tret += snprintf(str + ret, size - ret,\n\t\t\t\t\"\\t\\t@%pad %08x %08x %08x\\n\", &dma,\n\t\t\t\tle32_to_cpu(trb->buffer),\n\t\t\t\tle32_to_cpu(trb->length),\n\t\t\t\tle32_to_cpu(trb->control));\n\t\tdma += sizeof(*trb);\n\t}\n\n\tif (ret >= size)\n\t\tpr_info(\"CDNS2: buffer overflowed.\\n\");\n\n\treturn str;\n}\n\nstatic inline const char *cdns2_trb_type_string(u8 type)\n{\n\tswitch (type) {\n\tcase TRB_NORMAL:\n\t\treturn \"Normal\";\n\tcase TRB_LINK:\n\t\treturn \"Link\";\n\tdefault:\n\t\treturn \"UNKNOWN\";\n\t}\n}\n\nstatic inline const char *cdns2_decode_trb(char *str, size_t size, u32 flags,\n\t\t\t\t\t   u32 length, u32 buffer)\n{\n\tint type = TRB_FIELD_TO_TYPE(flags);\n\tint ret;\n\n\tswitch (type) {\n\tcase TRB_LINK:\n\t\tret = snprintf(str, size,\n\t\t\t       \"LINK %08x type '%s' flags %c:%c:%c%c:%c\",\n\t\t\t       buffer, cdns2_trb_type_string(type),\n\t\t\t       flags & TRB_CYCLE ? 'C' : 'c',\n\t\t\t       flags & TRB_TOGGLE ? 'T' : 't',\n\t\t\t       flags & TRB_CHAIN ? 'C' : 'c',\n\t\t\t       flags & TRB_CHAIN ? 'H' : 'h',\n\t\t\t       flags & TRB_IOC ? 'I' : 'i');\n\t\tbreak;\n\tcase TRB_NORMAL:\n\t\tret = snprintf(str, size,\n\t\t\t       \"type: '%s', Buffer: %08x, length: %ld, burst len: %ld, \"\n\t\t\t       \"flags %c:%c:%c%c:%c\",\n\t\t\t       cdns2_trb_type_string(type),\n\t\t\t       buffer, TRB_LEN(length),\n\t\t\t       TRB_FIELD_TO_BURST(length),\n\t\t\t       flags & TRB_CYCLE ? 'C' : 'c',\n\t\t\t       flags & TRB_ISP ? 'I' : 'i',\n\t\t\t       flags & TRB_CHAIN ? 'C' : 'c',\n\t\t\t       flags & TRB_CHAIN ? 'H' : 'h',\n\t\t\t       flags & TRB_IOC ? 'I' : 'i');\n\t\tbreak;\n\tdefault:\n\t\tret = snprintf(str, size, \"type '%s' -> raw %08x %08x %08x\",\n\t\t\t       cdns2_trb_type_string(type),\n\t\t\t       buffer, length, flags);\n\t}\n\n\tif (ret >= size)\n\t\tpr_info(\"CDNS2: buffer overflowed.\\n\");\n\n\treturn str;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}