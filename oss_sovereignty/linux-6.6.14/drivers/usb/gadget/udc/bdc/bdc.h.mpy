{
  "module_name": "bdc.h",
  "hash_id": "d7d7188754a54be5bfb8fe1b4a259a37a1dc7622e400728d6a4adbcf7a05e224",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/udc/bdc/bdc.h",
  "human_readable_source": " \n \n\n#ifndef\t__LINUX_BDC_H__\n#define\t__LINUX_BDC_H__\n\n#include <linux/kernel.h>\n#include <linux/usb.h>\n#include <linux/device.h>\n#include <linux/spinlock.h>\n#include <linux/list.h>\n#include <linux/dma-mapping.h>\n#include <linux/mm.h>\n#include <linux/debugfs.h>\n#include <linux/usb/ch9.h>\n#include <linux/usb/gadget.h>\n#include <asm/unaligned.h>\n\n#define BRCM_BDC_NAME \"bdc\"\n#define BRCM_BDC_DESC \"Broadcom USB Device Controller driver\"\n\n#define DMA_ADDR_INVALID        (~(dma_addr_t)0)\n\n \n#define BDC_CMD_TIMEOUT\t1000\n \n#define BDC_COP_TIMEOUT\t500\n\n \n#define EP0_RESPONSE_BUFF  6\n \n#define EP0_MAX_PKT_SIZE 512\n\n \n#define NUM_SR_ENTRIES\t64\n\n \n#define NUM_BDS_PER_TABLE\t64\n\n \n#define NUM_TABLES\t2\n\n \n#define NUM_TABLES_ISOCH\t6\n\n \n#define U1_TIMEOUT\t0xf8\n\n \n#define\tINT_CLS\t500\n\n \n \n#define BDC_BDCCFG0\t0x00\n#define BDC_BDCCFG1\t0x04\n#define BDC_BDCCAP0\t0x08\n#define BDC_BDCCAP1\t0x0c\n#define BDC_CMDPAR0\t0x10\n#define BDC_CMDPAR1\t0x14\n#define BDC_CMDPAR2\t0x18\n#define BDC_CMDSC\t0x1c\n#define BDC_USPC\t0x20\n#define BDC_USPPMS\t0x28\n#define BDC_USPPM2\t0x2c\n#define BDC_SPBBAL\t0x38\n#define BDC_SPBBAH\t0x3c\n#define BDC_BDCSC\t0x40\n#define BDC_XSFNTF\t0x4c\n\n#define BDC_DVCSA\t0x50\n#define BDC_DVCSB\t0x54\n#define BDC_EPSTS0\t0x60\n#define BDC_EPSTS1\t0x64\n#define BDC_EPSTS2\t0x68\n#define BDC_EPSTS3\t0x6c\n#define BDC_EPSTS4\t0x70\n#define BDC_EPSTS5\t0x74\n#define BDC_EPSTS6\t0x78\n#define BDC_EPSTS7\t0x7c\n#define BDC_SRRBAL(n)\t(0x200 + ((n) * 0x10))\n#define BDC_SRRBAH(n)\t(0x204 + ((n) * 0x10))\n#define BDC_SRRINT(n)\t(0x208 + ((n) * 0x10))\n#define BDC_INTCTLS(n)\t(0x20c + ((n) * 0x10))\n\n \n#define BDC_FSCNOC\t0xcd4\n#define BDC_FSCNIC\t0xce4\n#define NUM_NCS(p)\t((p) >> 28)\n\n \n \n#define BDC_PGS(p)\t(((p) & (0x7 << 8)) >> 8)\n#define BDC_SPB(p)\t((p) & 0x7)\n\n \n#define BDC_P64\t\tBIT(0)\n\n \n#define BDC_CMD_FH\t0xe\n#define BDC_CMD_DNC\t0x6\n#define BDC_CMD_EPO\t0x4\n#define BDC_CMD_BLA\t0x3\n#define BDC_CMD_EPC\t0x2\n#define BDC_CMD_DVC\t0x1\n#define BDC_CMD_CWS\t\tBIT(5)\n#define BDC_CMD_CST(p)\t\t(((p) & (0xf << 6))>>6)\n#define BDC_CMD_EPN(p)\t\t(((p) & 0x1f) << 10)\n#define BDC_SUB_CMD_ADD\t\t(0x1 << 17)\n#define BDC_SUB_CMD_FWK\t\t(0x4 << 17)\n \n#define BDC_CMD_EPO_RST_SN\t(0x1 << 16)\n#define BDC_CMD_EP0_XSD\t\t(0x1 << 16)\n#define BDC_SUB_CMD_ADD_EP\t(0x1 << 17)\n#define BDC_SUB_CMD_DRP_EP\t(0x2 << 17)\n#define BDC_SUB_CMD_EP_STP\t(0x2 << 17)\n#define BDC_SUB_CMD_EP_STL\t(0x4 << 17)\n#define BDC_SUB_CMD_EP_RST\t(0x1 << 17)\n#define BDC_CMD_SRD\t\tBIT(27)\n\n \n#define BDC_CMDS_SUCC\t0x1\n#define BDC_CMDS_PARA\t0x3\n#define BDC_CMDS_STAT\t0x4\n#define BDC_CMDS_FAIL\t0x5\n#define BDC_CMDS_INTL\t0x6\n#define BDC_CMDS_BUSY\t0xf\n\n \n#define EPT_SHIFT\t22\n#define MP_SHIFT\t10\n#define MB_SHIFT\t6\n#define EPM_SHIFT\t4\n\n \n#define BDC_VBC\t\tBIT(31)\n#define BDC_PRC\t\tBIT(30)\n#define BDC_PCE\t\tBIT(29)\n#define BDC_CFC\t\tBIT(28)\n#define BDC_PCC\t\tBIT(27)\n#define BDC_PSC\t\tBIT(26)\n#define BDC_VBS\t\tBIT(25)\n#define BDC_PRS\t\tBIT(24)\n#define BDC_PCS\t\tBIT(23)\n#define BDC_PSP(p)\t(((p) & (0x7 << 20))>>20)\n#define BDC_SCN\t\tBIT(8)\n#define BDC_SDC\t\tBIT(7)\n#define BDC_SWS\t\tBIT(4)\n\n#define BDC_USPSC_RW\t(BDC_SCN|BDC_SDC|BDC_SWS|0xf)\n#define BDC_PSP(p)\t(((p) & (0x7 << 20))>>20)\n\n#define BDC_SPEED_FS\t0x1\n#define BDC_SPEED_LS\t0x2\n#define BDC_SPEED_HS\t0x3\n#define BDC_SPEED_SS\t0x4\n\n#define BDC_PST(p)\t((p) & 0xf)\n#define BDC_PST_MASK\t0xf\n\n \n#define BDC_U2E\t\tBIT(31)\n#define BDC_U1E\t\tBIT(30)\n#define BDC_U2A\t\tBIT(29)\n#define BDC_PORT_W1S\tBIT(17)\n#define BDC_U1T(p)\t((p) & 0xff)\n#define BDC_U2T(p)\t(((p) & 0xff) << 8)\n#define BDC_U1T_MASK\t0xff\n\n \n \n#define BDC_HLE\t\tBIT(16)\n\n \n#define BDC_COP_RST\t(1 << 29)\n#define BDC_COP_RUN\t(2 << 29)\n#define BDC_COP_STP\t(4 << 29)\n\n#define BDC_COP_MASK (BDC_COP_RST|BDC_COP_RUN|BDC_COP_STP)\n\n#define BDC_COS\t\tBIT(28)\n#define BDC_CSTS(p)\t(((p) & (0x7 << 20)) >> 20)\n#define BDC_MASK_MCW\tBIT(7)\n#define BDC_GIE\t\tBIT(1)\n#define BDC_GIP\t\tBIT(0)\n\n#define BDC_HLT\t1\n#define BDC_NOR\t2\n#define BDC_OIP\t7\n\n \n#define BD_TYPE_BITMASK\t(0xf)\n#define BD_CHAIN\t0xf\n\n#define BD_TFS_SHIFT\t4\n#define BD_SOT\t\tBIT(26)\n#define BD_EOT\t\tBIT(27)\n#define BD_ISP\t\tBIT(29)\n#define BD_IOC\t\tBIT(30)\n#define BD_SBF\t\tBIT(31)\n\n#define BD_INTR_TARGET(p)\t(((p) & 0x1f) << 27)\n\n#define BDC_SRR_RWS\t\tBIT(4)\n#define BDC_SRR_RST\t\tBIT(3)\n#define BDC_SRR_ISR\t\tBIT(2)\n#define BDC_SRR_IE\t\tBIT(1)\n#define BDC_SRR_IP\t\tBIT(0)\n#define BDC_SRR_EPI(p)\t(((p) & (0xff << 24)) >> 24)\n#define BDC_SRR_DPI(p) (((p) & (0xff << 16)) >> 16)\n#define BDC_SRR_DPI_MASK\t0x00ff0000\n\n#define MARK_CHAIN_BD\t(BD_CHAIN|BD_EOT|BD_SOT)\n\n \n#define BD_DIR_IN\t\tBIT(25)\n\n#define BDC_PTC_MASK\t0xf0000000\n\n \n#define SR_XSF\t\t0\n#define SR_USPC\t\t4\n#define SR_BD_LEN(p)    ((p) & 0xffffff)\n\n#define XSF_SUCC\t0x1\n#define XSF_SHORT\t0x3\n#define XSF_BABB\t0x4\n#define XSF_SETUP_RECV\t0x6\n#define XSF_DATA_START\t0x7\n#define XSF_STATUS_START 0x8\n\n#define XSF_STS(p) (((p) >> 28) & 0xf)\n\n \n#define BD_LEN(p) ((p) & 0x1ffff)\n#define BD_LTF\t\tBIT(25)\n#define BD_TYPE_DS\t0x1\n#define BD_TYPE_SS\t0x2\n\n#define BDC_EP_ENABLED     BIT(0)\n#define BDC_EP_STALL       BIT(1)\n#define BDC_EP_STOP        BIT(2)\n\n \n#define BD_MAX_BUFF_SIZE\t(1 << 16)\n \n#define MAX_XFR_LEN\t\t16777215\n\n \n#define DEV_NOTF_TYPE 6\n#define FWK_SUBTYPE  1\n#define TRA_PACKET   4\n\n#define to_bdc_ep(e)\t\tcontainer_of(e, struct bdc_ep, usb_ep)\n#define to_bdc_req(r)\t\tcontainer_of(r, struct bdc_req, usb_req)\n#define gadget_to_bdc(g)\tcontainer_of(g, struct bdc, gadget)\n\n \n#define BDC_TNOTIFY 2500  \n \n#define REMOTE_WAKEUP_ISSUED\tBIT(16)\n#define DEVICE_SUSPENDED\tBIT(17)\n#define FUNC_WAKE_ISSUED\tBIT(18)\n#define REMOTE_WAKE_ENABLE\t(1 << USB_DEVICE_REMOTE_WAKEUP)\n\n \n#define DEVSTATUS_CLEAR\t\t(1 << USB_DEVICE_SELF_POWERED)\n \n\n \nstruct bdc_bd {\n\t__le32 offset[4];\n};\n\n \nstruct bdc_sr {\n\t__le32 offset[4];\n};\n\n \nstruct bd_table {\n\tstruct bdc_bd *start_bd;\n\t \n\tdma_addr_t dma;\n};\n\n \nstruct bd_list {\n\t \n\tstruct bd_table **bd_table_array;\n\t \n\tint num_tabs;\n\t \n\tint max_bdi;\n\t \n\tint eqp_bdi;\n\t \n\tint hwd_bdi;\n\t \n\tint num_bds_table;\n};\n\nstruct bdc_req;\n\n \nstruct bd_transfer {\n\tstruct bdc_req *req;\n\t \n\tint start_bdi;\n\t \n\tint next_hwd_bdi;\n\t \n\tint num_bds;\n};\n\n \nstruct bdc_req {\n\tstruct usb_request\tusb_req;\n\tstruct list_head\tqueue;\n\tstruct bdc_ep\t\t*ep;\n\t \n\tstruct bd_transfer bd_xfr;\n\tint\tepnum;\n};\n\n \nstruct bdc_scratchpad {\n\tdma_addr_t sp_dma;\n\tvoid *buff;\n\tu32 size;\n};\n\n \nstruct bdc_ep {\n\tstruct usb_ep\tusb_ep;\n\tstruct list_head queue;\n\tstruct bdc *bdc;\n\tu8  ep_type;\n\tu8  dir;\n\tu8  ep_num;\n\tconst struct usb_ss_ep_comp_descriptor\t*comp_desc;\n\tconst struct usb_endpoint_descriptor\t*desc;\n\tunsigned int flags;\n\tchar name[20];\n\t \n\tstruct bd_list bd_list;\n\t \n\tbool ignore_next_sr;\n};\n\n \nstruct bdc_cmd_params {\n\tu32\tparam2;\n\tu32\tparam1;\n\tu32\tparam0;\n};\n\n \nstruct srr {\n\tstruct bdc_sr *sr_bds;\n\tu16\teqp_index;\n\tu16\tdqp_index;\n\tdma_addr_t\tdma_addr;\n};\n\n \nenum bdc_ep0_state {\n\tWAIT_FOR_SETUP = 0,\n\tWAIT_FOR_DATA_START,\n\tWAIT_FOR_DATA_XMIT,\n\tWAIT_FOR_STATUS_START,\n\tWAIT_FOR_STATUS_XMIT,\n\tSTATUS_PENDING\n};\n\n \nenum bdc_link_state {\n\tBDC_LINK_STATE_U0\t= 0x00,\n\tBDC_LINK_STATE_U3\t= 0x03,\n\tBDC_LINK_STATE_RX_DET\t= 0x05,\n\tBDC_LINK_STATE_RESUME\t= 0x0f\n};\n\n \nstruct bdc {\n\tstruct usb_gadget\tgadget;\n\tstruct usb_gadget_driver\t*gadget_driver;\n\tstruct device\t*dev;\n\t \n\tspinlock_t\tlock;\n\n\t \n\tstruct phy      **phys;\n\tint num_phys;\n\t \n\tunsigned int num_eps;\n\t \n\tstruct bdc_ep\t\t**bdc_ep_array;\n\tvoid __iomem\t\t*regs;\n\tstruct bdc_scratchpad\tscratchpad;\n\tu32\tsp_buff_size;\n\t \n\tstruct srr\tsrr;\n\t \n\tstruct\tusb_ctrlrequest setup_pkt;\n\tstruct\tbdc_req ep0_req;\n\tstruct\tbdc_req status_req;\n\tenum\tbdc_ep0_state ep0_state;\n\tbool\tdelayed_status;\n\tbool\tzlp_needed;\n\tbool\treinit;\n\tbool\tpullup;\n\t \n\tu32\tdevstatus;\n\tint\tirq;\n\tvoid\t*mem;\n\tu32\tdev_addr;\n\t \n\tstruct dma_pool\t*bd_table_pool;\n\tu8\t\ttest_mode;\n\t \n\tvoid (*sr_handler[2])(struct bdc *, struct bdc_sr *);\n\t \n\tvoid (*sr_xsf_ep0[3])(struct bdc *, struct bdc_sr *);\n\t \n\tunsigned char\t\tep0_response_buff[EP0_RESPONSE_BUFF];\n\t \n\tstruct delayed_work\tfunc_wake_notify;\n\tstruct clk\t\t*clk;\n};\n\nstatic inline u32 bdc_readl(void __iomem *base, u32 offset)\n{\n\treturn readl(base + offset);\n}\n\nstatic inline void bdc_writel(void __iomem *base, u32 offset, u32 value)\n{\n\twritel(value, base + offset);\n}\n\n \nvoid bdc_notify_xfr(struct bdc *bdc, u32 epnum);\nvoid bdc_softconn(struct bdc *bdc);\nvoid bdc_softdisconn(struct bdc *bdc);\nint bdc_run(struct bdc *bdc);\nint bdc_stop(struct bdc *bdc);\nint bdc_reset(struct bdc *bdc);\nint bdc_udc_init(struct bdc *bdc);\nvoid bdc_udc_exit(struct bdc *bdc);\nint bdc_reinit(struct bdc *bdc);\n\n \n \nvoid bdc_sr_uspc(struct bdc *bdc, struct bdc_sr *sreport);\n \nvoid bdc_sr_xsf(struct bdc *bdc, struct bdc_sr *sreport);\n \nvoid bdc_xsf_ep0_setup_recv(struct bdc *bdc, struct bdc_sr *sreport);\nvoid bdc_xsf_ep0_data_start(struct bdc *bdc, struct bdc_sr *sreport);\nvoid bdc_xsf_ep0_status_start(struct bdc *bdc, struct bdc_sr *sreport);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}