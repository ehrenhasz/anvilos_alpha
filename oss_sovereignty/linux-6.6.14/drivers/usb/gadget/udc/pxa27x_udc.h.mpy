{
  "module_name": "pxa27x_udc.h",
  "hash_id": "f011311a4631e211750a873c87b877873e93ad0187de87ec25be6e477b1c0ae4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/udc/pxa27x_udc.h",
  "human_readable_source": "\n \n\n#ifndef __LINUX_USB_GADGET_PXA27X_H\n#define __LINUX_USB_GADGET_PXA27X_H\n\n#include <linux/types.h>\n#include <linux/spinlock.h>\n#include <linux/io.h>\n#include <linux/usb/otg.h>\n\n \n \n#define UDCCR\t\t0x0000\t\t \n#define UDCICR0\t\t0x0004\t\t \n#define UDCICR1\t\t0x0008\t\t \n#define UDCISR0\t\t0x000C\t\t \n#define UDCISR1\t\t0x0010\t\t \n#define UDCFNR\t\t0x0014\t\t \n#define UDCOTGICR\t0x0018\t\t \n#define UP2OCR\t\t0x0020\t\t \n#define UP3OCR\t\t0x0024\t\t \n#define UDCCSRn(x)\t(0x0100 + ((x)<<2))  \n#define UDCBCRn(x)\t(0x0200 + ((x)<<2))  \n#define UDCDRn(x)\t(0x0300 + ((x)<<2))  \n#define UDCCRn(x)\t(0x0400 + ((x)<<2))  \n\n#define UDCCR_OEN\t(1 << 31)\t \n#define UDCCR_AALTHNP\t(1 << 30)\t \n#define UDCCR_AHNP\t(1 << 29)\t \n#define UDCCR_BHNP\t(1 << 28)\t \n#define UDCCR_DWRE\t(1 << 16)\t \n#define UDCCR_ACN\t(0x03 << 11)\t \n#define UDCCR_ACN_S\t11\n#define UDCCR_AIN\t(0x07 << 8)\t \n#define UDCCR_AIN_S\t8\n#define UDCCR_AAISN\t(0x07 << 5)\t \n#define UDCCR_AAISN_S\t5\n#define UDCCR_SMAC\t(1 << 4)\t \n#define UDCCR_EMCE\t(1 << 3)\t \n#define UDCCR_UDR\t(1 << 2)\t \n#define UDCCR_UDA\t(1 << 1)\t \n#define UDCCR_UDE\t(1 << 0)\t \n\n#define UDCICR_INT(n, intr) (((intr) & 0x03) << (((n) & 0x0F) * 2))\n#define UDCICR1_IECC\t(1 << 31)\t \n#define UDCICR1_IESOF\t(1 << 30)\t \n#define UDCICR1_IERU\t(1 << 29)\t \n#define UDCICR1_IESU\t(1 << 28)\t \n#define UDCICR1_IERS\t(1 << 27)\t \n#define UDCICR_FIFOERR\t(1 << 1)\t \n#define UDCICR_PKTCOMPL\t(1 << 0)\t \n#define UDCICR_INT_MASK\t(UDCICR_FIFOERR | UDCICR_PKTCOMPL)\n\n#define UDCISR_INT(n, intr) (((intr) & 0x03) << (((n) & 0x0F) * 2))\n#define UDCISR1_IRCC\t(1 << 31)\t \n#define UDCISR1_IRSOF\t(1 << 30)\t \n#define UDCISR1_IRRU\t(1 << 29)\t \n#define UDCISR1_IRSU\t(1 << 28)\t \n#define UDCISR1_IRRS\t(1 << 27)\t \n#define UDCISR_INT_MASK\t(UDCICR_FIFOERR | UDCICR_PKTCOMPL)\n\n#define UDCOTGICR_IESF\t(1 << 24)\t \n#define UDCOTGICR_IEXR\t(1 << 17)\t \n#define UDCOTGICR_IEXF\t(1 << 16)\t \n#define UDCOTGICR_IEVV40R (1 << 9)\t \n#define UDCOTGICR_IEVV40F (1 << 8)\t \n#define UDCOTGICR_IEVV44R (1 << 7)\t \n#define UDCOTGICR_IEVV44F (1 << 6)\t \n#define UDCOTGICR_IESVR\t(1 << 5)\t \n#define UDCOTGICR_IESVF\t(1 << 4)\t \n#define UDCOTGICR_IESDR\t(1 << 3)\t \n#define UDCOTGICR_IESDF\t(1 << 2)\t \n#define UDCOTGICR_IEIDR\t(1 << 1)\t \n#define UDCOTGICR_IEIDF\t(1 << 0)\t \n\n \n#define UP2OCR_CPVEN\t(1 << 0)\t \n#define UP2OCR_CPVPE\t(1 << 1)\t \n\t\t\t\t\t \n#define UP2OCR_DPPDE\t(1 << 2)\t \n#define UP2OCR_DMPDE\t(1 << 3)\t \n#define UP2OCR_DPPUE\t(1 << 4)\t \n#define UP2OCR_DMPUE\t(1 << 5)\t \n#define UP2OCR_DPPUBE\t(1 << 6)\t \n#define UP2OCR_DMPUBE\t(1 << 7)\t \n#define UP2OCR_EXSP\t(1 << 8)\t \n#define UP2OCR_EXSUS\t(1 << 9)\t \n#define UP2OCR_IDON\t(1 << 10)\t \n#define UP2OCR_HXS\t(1 << 16)\t \n#define UP2OCR_HXOE\t(1 << 17)\t \n#define UP2OCR_SEOS\t(1 << 24)\t \n\n#define UDCCSR0_ACM\t(1 << 9)\t \n#define UDCCSR0_AREN\t(1 << 8)\t \n#define UDCCSR0_SA\t(1 << 7)\t \n#define UDCCSR0_RNE\t(1 << 6)\t \n#define UDCCSR0_FST\t(1 << 5)\t \n#define UDCCSR0_SST\t(1 << 4)\t \n#define UDCCSR0_DME\t(1 << 3)\t \n#define UDCCSR0_FTF\t(1 << 2)\t \n#define UDCCSR0_IPR\t(1 << 1)\t \n#define UDCCSR0_OPC\t(1 << 0)\t \n\n#define UDCCSR_DPE\t(1 << 9)\t \n#define UDCCSR_FEF\t(1 << 8)\t \n#define UDCCSR_SP\t(1 << 7)\t \n#define UDCCSR_BNE\t(1 << 6)\t \n#define UDCCSR_BNF\t(1 << 6)\t \n#define UDCCSR_FST\t(1 << 5)\t \n#define UDCCSR_SST\t(1 << 4)\t \n#define UDCCSR_DME\t(1 << 3)\t \n#define UDCCSR_TRN\t(1 << 2)\t \n#define UDCCSR_PC\t(1 << 1)\t \n#define UDCCSR_FS\t(1 << 0)\t \n\n#define UDCCONR_CN\t(0x03 << 25)\t \n#define UDCCONR_CN_S\t25\n#define UDCCONR_IN\t(0x07 << 22)\t \n#define UDCCONR_IN_S\t22\n#define UDCCONR_AISN\t(0x07 << 19)\t \n#define UDCCONR_AISN_S\t19\n#define UDCCONR_EN\t(0x0f << 15)\t \n#define UDCCONR_EN_S\t15\n#define UDCCONR_ET\t(0x03 << 13)\t \n#define UDCCONR_ET_S\t13\n#define UDCCONR_ET_INT\t(0x03 << 13)\t \n#define UDCCONR_ET_BULK\t(0x02 << 13)\t \n#define UDCCONR_ET_ISO\t(0x01 << 13)\t \n#define UDCCONR_ET_NU\t(0x00 << 13)\t \n#define UDCCONR_ED\t(1 << 12)\t \n#define UDCCONR_MPS\t(0x3ff << 2)\t \n#define UDCCONR_MPS_S\t2\n#define UDCCONR_DE\t(1 << 1)\t \n#define UDCCONR_EE\t(1 << 0)\t \n\n#define UDCCR_MASK_BITS (UDCCR_OEN | UDCCR_SMAC | UDCCR_UDR | UDCCR_UDE)\n#define UDCCSR_WR_MASK\t(UDCCSR_DME | UDCCSR_FST)\n#define UDC_FNR_MASK\t(0x7ff)\n#define UDC_BCR_MASK\t(0x3ff)\n\n \n#define ofs_UDCCR(ep)\t(UDCCRn(ep->idx))\n#define ofs_UDCCSR(ep)\t(UDCCSRn(ep->idx))\n#define ofs_UDCBCR(ep)\t(UDCBCRn(ep->idx))\n#define ofs_UDCDR(ep)\t(UDCDRn(ep->idx))\n\n \n#define udc_ep_readl(ep, reg)\t\\\n\t__raw_readl((ep)->dev->regs + ofs_##reg(ep))\n#define udc_ep_writel(ep, reg, value)\t\\\n\t__raw_writel((value), ep->dev->regs + ofs_##reg(ep))\n#define udc_ep_readb(ep, reg)\t\\\n\t__raw_readb((ep)->dev->regs + ofs_##reg(ep))\n#define udc_ep_writeb(ep, reg, value)\t\\\n\t__raw_writeb((value), ep->dev->regs + ofs_##reg(ep))\n#define udc_readl(dev, reg)\t\\\n\t__raw_readl((dev)->regs + (reg))\n#define udc_writel(udc, reg, value)\t\\\n\t__raw_writel((value), (udc)->regs + (reg))\n\n#define UDCCSR_MASK\t\t(UDCCSR_FST | UDCCSR_DME)\n#define UDCCISR0_EP_MASK\t~0\n#define UDCCISR1_EP_MASK\t0xffff\n#define UDCCSR0_CTRL_REQ_MASK\t(UDCCSR0_OPC | UDCCSR0_SA | UDCCSR0_RNE)\n\n#define EPIDX(ep)\t(ep->idx)\n#define EPADDR(ep)\t(ep->addr)\n#define EPXFERTYPE(ep)\t(ep->type)\n#define EPNAME(ep)\t(ep->name)\n#define is_ep0(ep)\t(!ep->idx)\n#define EPXFERTYPE_is_ISO(ep) (EPXFERTYPE(ep) == USB_ENDPOINT_XFER_ISOC)\n\n \n\n \n#define USB_EP_DEF(addr, bname, dir, type, maxpkt, ctype, cdir) \\\n{ .usb_ep = {\t.name = bname, .ops = &pxa_ep_ops, .maxpacket = maxpkt, \\\n\t\t.caps = USB_EP_CAPS(ctype, cdir), }, \\\n  .desc = {\t.bEndpointAddress = addr | (dir ? USB_DIR_IN : 0), \\\n\t\t.bmAttributes = USB_ENDPOINT_XFER_ ## type, \\\n\t\t.wMaxPacketSize = maxpkt, }, \\\n  .dev = &memory \\\n}\n#define USB_EP_BULK(addr, bname, dir, cdir) \\\n\tUSB_EP_DEF(addr, bname, dir, BULK, BULK_FIFO_SIZE, \\\n\t\tUSB_EP_CAPS_TYPE_BULK, cdir)\n#define USB_EP_ISO(addr, bname, dir, cdir) \\\n\tUSB_EP_DEF(addr, bname, dir, ISOC, ISO_FIFO_SIZE, \\\n\t\tUSB_EP_CAPS_TYPE_ISO, cdir)\n#define USB_EP_INT(addr, bname, dir, cdir) \\\n\tUSB_EP_DEF(addr, bname, dir, INT, INT_FIFO_SIZE, \\\n\t\tUSB_EP_CAPS_TYPE_INT, cdir)\n#define USB_EP_IN_BULK(n)\tUSB_EP_BULK(n, \"ep\" #n \"in-bulk\", 1, \\\n\t\t\t\t\tUSB_EP_CAPS_DIR_IN)\n#define USB_EP_OUT_BULK(n)\tUSB_EP_BULK(n, \"ep\" #n \"out-bulk\", 0, \\\n\t\t\t\t\tUSB_EP_CAPS_DIR_OUT)\n#define USB_EP_IN_ISO(n)\tUSB_EP_ISO(n,  \"ep\" #n \"in-iso\", 1, \\\n\t\t\t\t\tUSB_EP_CAPS_DIR_IN)\n#define USB_EP_OUT_ISO(n)\tUSB_EP_ISO(n,  \"ep\" #n \"out-iso\", 0, \\\n\t\t\t\t\tUSB_EP_CAPS_DIR_OUT)\n#define USB_EP_IN_INT(n)\tUSB_EP_INT(n,  \"ep\" #n \"in-int\", 1, \\\n\t\t\t\t\tUSB_EP_CAPS_DIR_IN)\n#define USB_EP_CTRL\tUSB_EP_DEF(0,  \"ep0\", 0, CONTROL, EP0_FIFO_SIZE, \\\n\t\t\t\tUSB_EP_CAPS_TYPE_CONTROL, USB_EP_CAPS_DIR_ALL)\n\n#define PXA_EP_DEF(_idx, _addr, dir, _type, maxpkt, _config, iface, altset) \\\n{ \\\n\t.dev = &memory, \\\n\t.name = \"ep\" #_idx, \\\n\t.idx = _idx, .enabled = 0, \\\n\t.dir_in = dir, .addr = _addr, \\\n\t.config = _config, .interface = iface, .alternate = altset, \\\n\t.type = _type, .fifo_size = maxpkt, \\\n}\n#define PXA_EP_BULK(_idx, addr, dir, config, iface, alt) \\\n  PXA_EP_DEF(_idx, addr, dir, USB_ENDPOINT_XFER_BULK, BULK_FIFO_SIZE, \\\n\t\tconfig, iface, alt)\n#define PXA_EP_ISO(_idx, addr, dir, config, iface, alt) \\\n  PXA_EP_DEF(_idx, addr, dir, USB_ENDPOINT_XFER_ISOC, ISO_FIFO_SIZE, \\\n\t\tconfig, iface, alt)\n#define PXA_EP_INT(_idx, addr, dir, config, iface, alt) \\\n  PXA_EP_DEF(_idx, addr, dir, USB_ENDPOINT_XFER_INT, INT_FIFO_SIZE, \\\n\t\tconfig, iface, alt)\n#define PXA_EP_IN_BULK(i, adr, c, f, a)\t\tPXA_EP_BULK(i, adr, 1, c, f, a)\n#define PXA_EP_OUT_BULK(i, adr, c, f, a)\tPXA_EP_BULK(i, adr, 0, c, f, a)\n#define PXA_EP_IN_ISO(i, adr, c, f, a)\t\tPXA_EP_ISO(i, adr, 1, c, f, a)\n#define PXA_EP_OUT_ISO(i, adr, c, f, a)\t\tPXA_EP_ISO(i, adr, 0, c, f, a)\n#define PXA_EP_IN_INT(i, adr, c, f, a)\t\tPXA_EP_INT(i, adr, 1, c, f, a)\n#define PXA_EP_CTRL\tPXA_EP_DEF(0, 0, 0, 0, EP0_FIFO_SIZE, 0, 0, 0)\n\nstruct pxa27x_udc;\n\nstruct stats {\n\tunsigned long in_ops;\n\tunsigned long out_ops;\n\tunsigned long in_bytes;\n\tunsigned long out_bytes;\n\tunsigned long irqs;\n};\n\n \nstruct udc_usb_ep {\n\tstruct usb_ep usb_ep;\n\tstruct usb_endpoint_descriptor desc;\n\tstruct pxa_udc *dev;\n\tstruct pxa_ep *pxa_ep;\n};\n\n \nstruct pxa_ep {\n\tstruct pxa_udc\t\t*dev;\n\n\tstruct list_head\tqueue;\n\tspinlock_t\t\tlock;\t\t \n\t\t\t\t\t\t \n\tunsigned\t\tenabled:1;\n\tunsigned\t\tin_handle_ep:1;\n\n\tunsigned\t\tidx:5;\n\tchar\t\t\t*name;\n\n\t \n\tunsigned\t\tdir_in:1;\n\tunsigned\t\taddr:4;\n\tunsigned\t\tconfig:2;\n\tunsigned\t\tinterface:3;\n\tunsigned\t\talternate:3;\n\tunsigned\t\tfifo_size;\n\tunsigned\t\ttype;\n\n#ifdef CONFIG_PM\n\tu32\t\t\tudccsr_value;\n\tu32\t\t\tudccr_value;\n#endif\n\tstruct stats\t\tstats;\n};\n\n \nstruct pxa27x_request {\n\tstruct usb_request\t\t\treq;\n\tstruct udc_usb_ep\t\t\t*udc_usb_ep;\n\tunsigned\t\t\t\tin_use:1;\n\tstruct list_head\t\t\tqueue;\n};\n\nenum ep0_state {\n\tWAIT_FOR_SETUP,\n\tSETUP_STAGE,\n\tIN_DATA_STAGE,\n\tOUT_DATA_STAGE,\n\tIN_STATUS_STAGE,\n\tOUT_STATUS_STAGE,\n\tSTALL,\n\tWAIT_ACK_SET_CONF_INTERF\n};\n\nstatic char *ep0_state_name[] = {\n\t\"WAIT_FOR_SETUP\", \"SETUP_STAGE\", \"IN_DATA_STAGE\", \"OUT_DATA_STAGE\",\n\t\"IN_STATUS_STAGE\", \"OUT_STATUS_STAGE\", \"STALL\",\n\t\"WAIT_ACK_SET_CONF_INTERF\"\n};\n#define EP0_STNAME(udc) ep0_state_name[(udc)->ep0state]\n\n#define EP0_FIFO_SIZE\t16U\n#define BULK_FIFO_SIZE\t64U\n#define ISO_FIFO_SIZE\t256U\n#define INT_FIFO_SIZE\t16U\n\nstruct udc_stats {\n\tunsigned long\tirqs_reset;\n\tunsigned long\tirqs_suspend;\n\tunsigned long\tirqs_resume;\n\tunsigned long\tirqs_reconfig;\n};\n\n#define NR_USB_ENDPOINTS (1 + 5)\t \n#define NR_PXA_ENDPOINTS (1 + 14)\t \n\n \nstruct pxa_udc {\n\tvoid __iomem\t\t\t\t*regs;\n\tint\t\t\t\t\tirq;\n\tstruct clk\t\t\t\t*clk;\n\n\tstruct usb_gadget\t\t\tgadget;\n\tstruct usb_gadget_driver\t\t*driver;\n\tstruct device\t\t\t\t*dev;\n\tvoid\t\t\t\t\t(*udc_command)(int);\n\tstruct gpio_desc\t\t\t*gpiod;\n\tstruct usb_phy\t\t\t\t*transceiver;\n\n\tenum ep0_state\t\t\t\tep0state;\n\tstruct udc_stats\t\t\tstats;\n\n\tstruct udc_usb_ep\t\t\tudc_usb_ep[NR_USB_ENDPOINTS];\n\tstruct pxa_ep\t\t\t\tpxa_ep[NR_PXA_ENDPOINTS];\n\n\tunsigned\t\t\t\tenabled:1;\n\tunsigned\t\t\t\tpullup_on:1;\n\tunsigned\t\t\t\tpullup_resume:1;\n\tunsigned\t\t\t\tvbus_sensed:1;\n\tunsigned\t\t\t\tconfig:2;\n\tunsigned\t\t\t\tlast_interface:3;\n\tunsigned\t\t\t\tlast_alternate:3;\n\n#ifdef CONFIG_PM\n\tunsigned\t\t\t\tudccsr0;\n#endif\n};\n#define to_pxa(g)\t(container_of((g), struct pxa_udc, gadget))\n\nstatic inline struct pxa_udc *to_gadget_udc(struct usb_gadget *gadget)\n{\n\treturn container_of(gadget, struct pxa_udc, gadget);\n}\n\n \n#define ep_dbg(ep, fmt, arg...) \\\n\tdev_dbg(ep->dev->dev, \"%s:%s: \" fmt, EPNAME(ep), __func__, ## arg)\n#define ep_vdbg(ep, fmt, arg...) \\\n\tdev_vdbg(ep->dev->dev, \"%s:%s: \" fmt, EPNAME(ep), __func__, ## arg)\n#define ep_err(ep, fmt, arg...) \\\n\tdev_err(ep->dev->dev, \"%s:%s: \" fmt, EPNAME(ep), __func__, ## arg)\n#define ep_info(ep, fmt, arg...) \\\n\tdev_info(ep->dev->dev, \"%s:%s: \" fmt, EPNAME(ep), __func__, ## arg)\n#define ep_warn(ep, fmt, arg...) \\\n\tdev_warn(ep->dev->dev, \"%s:%s:\" fmt, EPNAME(ep), __func__, ## arg)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}