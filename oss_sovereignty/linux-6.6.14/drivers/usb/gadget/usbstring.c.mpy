{
  "module_name": "usbstring.c",
  "hash_id": "f367bc93287aee71079361c306c78a4957cb3342b93ff952cef7098e9a552094",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/usbstring.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/list.h>\n#include <linux/string.h>\n#include <linux/device.h>\n#include <linux/nls.h>\n\n#include <linux/usb/ch9.h>\n#include <linux/usb/gadget.h>\n\n\n \nint\nusb_gadget_get_string (const struct usb_gadget_strings *table, int id, u8 *buf)\n{\n\tstruct usb_string\t*s;\n\tint\t\t\tlen;\n\n\t \n\tif (id == 0) {\n\t\tbuf [0] = 4;\n\t\tbuf [1] = USB_DT_STRING;\n\t\tbuf [2] = (u8) table->language;\n\t\tbuf [3] = (u8) (table->language >> 8);\n\t\treturn 4;\n\t}\n\tfor (s = table->strings; s && s->s; s++)\n\t\tif (s->id == id)\n\t\t\tbreak;\n\n\t \n\tif (!s || !s->s)\n\t\treturn -EINVAL;\n\n\t \n\tlen = min((size_t)USB_MAX_STRING_LEN, strlen(s->s));\n\tlen = utf8s_to_utf16s(s->s, len, UTF16_LITTLE_ENDIAN,\n\t\t\t(wchar_t *) &buf[2], USB_MAX_STRING_LEN);\n\tif (len < 0)\n\t\treturn -EINVAL;\n\tbuf [0] = (len + 1) * 2;\n\tbuf [1] = USB_DT_STRING;\n\treturn buf [0];\n}\nEXPORT_SYMBOL_GPL(usb_gadget_get_string);\n\n \nbool usb_validate_langid(u16 langid)\n{\n\tu16 primary_lang = langid & 0x3ff;\t \n\tu16 sub_lang = langid >> 10;\t\t \n\n\tswitch (primary_lang) {\n\tcase 0:\n\tcase 0x62 ... 0xfe:\n\tcase 0x100 ... 0x3ff:\n\t\treturn false;\n\t}\n\tif (!sub_lang)\n\t\treturn false;\n\n\treturn true;\n}\nEXPORT_SYMBOL_GPL(usb_validate_langid);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}