{
  "module_name": "epautoconf.c",
  "hash_id": "cbde324d51cfa70dca343cf0ae2ed6cb59b8b53c2d3477f9bdc19b145d62b387",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/epautoconf.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/device.h>\n\n#include <linux/ctype.h>\n#include <linux/string.h>\n\n#include <linux/usb/ch9.h>\n#include <linux/usb/gadget.h>\n\n \nstruct usb_ep *usb_ep_autoconfig_ss(\n\tstruct usb_gadget\t\t*gadget,\n\tstruct usb_endpoint_descriptor\t*desc,\n\tstruct usb_ss_ep_comp_descriptor *ep_comp\n)\n{\n\tstruct usb_ep\t*ep;\n\n\tif (gadget->ops->match_ep) {\n\t\tep = gadget->ops->match_ep(gadget, desc, ep_comp);\n\t\tif (ep)\n\t\t\tgoto found_ep;\n\t}\n\n\t \n\tlist_for_each_entry (ep, &gadget->ep_list, ep_list) {\n\t\tif (usb_gadget_ep_match_desc(gadget, ep, desc, ep_comp))\n\t\t\tgoto found_ep;\n\t}\n\n\t \n\treturn NULL;\nfound_ep:\n\n\t \n\tif (desc->wMaxPacketSize == 0)\n\t\tdesc->wMaxPacketSize = cpu_to_le16(ep->maxpacket_limit);\n\n\t \n\tdesc->bEndpointAddress &= USB_DIR_IN;\n\tif (isdigit(ep->name[2])) {\n\t\tu8 num = simple_strtoul(&ep->name[2], NULL, 10);\n\t\tdesc->bEndpointAddress |= num;\n\t} else if (desc->bEndpointAddress & USB_DIR_IN) {\n\t\tif (++gadget->in_epnum > 15)\n\t\t\treturn NULL;\n\t\tdesc->bEndpointAddress = USB_DIR_IN | gadget->in_epnum;\n\t} else {\n\t\tif (++gadget->out_epnum > 15)\n\t\t\treturn NULL;\n\t\tdesc->bEndpointAddress |= gadget->out_epnum;\n\t}\n\n\tep->address = desc->bEndpointAddress;\n\tep->desc = NULL;\n\tep->comp_desc = NULL;\n\tep->claimed = true;\n\treturn ep;\n}\nEXPORT_SYMBOL_GPL(usb_ep_autoconfig_ss);\n\n \nstruct usb_ep *usb_ep_autoconfig(\n\tstruct usb_gadget\t\t*gadget,\n\tstruct usb_endpoint_descriptor\t*desc\n)\n{\n\tstruct usb_ep\t*ep;\n\tu8\t\ttype;\n\n\tep = usb_ep_autoconfig_ss(gadget, desc, NULL);\n\tif (!ep)\n\t\treturn NULL;\n\n\ttype = desc->bmAttributes & USB_ENDPOINT_XFERTYPE_MASK;\n\n\t \n\tif (type == USB_ENDPOINT_XFER_BULK) {\n\t\tint size = ep->maxpacket_limit;\n\n\t\t \n\t\tif (size > 64)\n\t\t\tsize = 64;\n\t\tdesc->wMaxPacketSize = cpu_to_le16(size);\n\t}\n\n\treturn ep;\n}\nEXPORT_SYMBOL_GPL(usb_ep_autoconfig);\n\n \nvoid usb_ep_autoconfig_release(struct usb_ep *ep)\n{\n\tep->claimed = false;\n\tep->driver_data = NULL;\n}\nEXPORT_SYMBOL_GPL(usb_ep_autoconfig_release);\n\n \nvoid usb_ep_autoconfig_reset (struct usb_gadget *gadget)\n{\n\tstruct usb_ep\t*ep;\n\n\tlist_for_each_entry (ep, &gadget->ep_list, ep_list) {\n\t\tep->claimed = false;\n\t\tep->driver_data = NULL;\n\t}\n\tgadget->in_epnum = 0;\n\tgadget->out_epnum = 0;\n}\nEXPORT_SYMBOL_GPL(usb_ep_autoconfig_reset);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}