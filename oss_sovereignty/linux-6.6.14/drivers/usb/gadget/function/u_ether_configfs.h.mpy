{
  "module_name": "u_ether_configfs.h",
  "hash_id": "7a5614fd4e1de383e12b3ef2a3dd092ef23dd4038668d21d6bf03976ba2c1887",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/function/u_ether_configfs.h",
  "human_readable_source": " \n \n\n#ifndef __U_ETHER_CONFIGFS_H\n#define __U_ETHER_CONFIGFS_H\n\n#define USB_ETHERNET_CONFIGFS_ITEM(_f_)\t\t\t\t\t\\\n\tstatic void _f_##_attr_release(struct config_item *item)\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tusb_put_function_instance(&opts->func_inst);\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tstatic struct configfs_item_operations _f_##_item_ops = {\t\\\n\t\t.release\t= _f_##_attr_release,\t\t\t\\\n\t}\n\n#define USB_ETHERNET_CONFIGFS_ITEM_ATTR_DEV_ADDR(_f_)\t\t\t\\\n\tstatic ssize_t _f_##_opts_dev_addr_show(struct config_item *item, \\\n\t\t\t\t\t\tchar *page)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint result;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tresult = gether_get_dev_addr(opts->net, page, PAGE_SIZE); \\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\treturn result;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tstatic ssize_t _f_##_opts_dev_addr_store(struct config_item *item, \\\n\t\t\t\t\t\t const char *page, size_t len)\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint ret;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tif (opts->refcnt) {\t\t\t\t\t\\\n\t\t\tmutex_unlock(&opts->lock);\t\t\t\\\n\t\t\treturn -EBUSY;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tret = gether_set_dev_addr(opts->net, page);\t\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\tif (!ret)\t\t\t\t\t\t\\\n\t\t\tret = len;\t\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tCONFIGFS_ATTR(_f_##_opts_, dev_addr)\n\n#define USB_ETHERNET_CONFIGFS_ITEM_ATTR_HOST_ADDR(_f_)\t\t\t\\\n\tstatic ssize_t _f_##_opts_host_addr_show(struct config_item *item, \\\n\t\t\t\t\t\t char *page)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint result;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tresult = gether_get_host_addr(opts->net, page, PAGE_SIZE); \\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\treturn result;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tstatic ssize_t _f_##_opts_host_addr_store(struct config_item *item, \\\n\t\t\t\t\t\t  const char *page, size_t len)\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint ret;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tif (opts->refcnt) {\t\t\t\t\t\\\n\t\t\tmutex_unlock(&opts->lock);\t\t\t\\\n\t\t\treturn -EBUSY;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tret = gether_set_host_addr(opts->net, page);\t\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\tif (!ret)\t\t\t\t\t\t\\\n\t\t\tret = len;\t\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tCONFIGFS_ATTR(_f_##_opts_, host_addr)\n\n#define USB_ETHERNET_CONFIGFS_ITEM_ATTR_QMULT(_f_)\t\t\t\\\n\tstatic ssize_t _f_##_opts_qmult_show(struct config_item *item,\t\\\n\t\t\t\t\t     char *page)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tunsigned qmult;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tqmult = gether_get_qmult(opts->net);\t\t\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\treturn sprintf(page, \"%d\\n\", qmult);\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tstatic ssize_t _f_##_opts_qmult_store(struct config_item *item, \\\n\t\t\t\t\t      const char *page, size_t len)\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tu8 val;\t\t\t\t\t\t\t\\\n\t\tint ret;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tif (opts->refcnt) {\t\t\t\t\t\\\n\t\t\tret = -EBUSY;\t\t\t\t\t\\\n\t\t\tgoto out;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tret = kstrtou8(page, 0, &val);\t\t\t\t\\\n\t\tif (ret)\t\t\t\t\t\t\\\n\t\t\tgoto out;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tgether_set_qmult(opts->net, val);\t\t\t\\\n\t\tret = len;\t\t\t\t\t\t\\\nout:\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tCONFIGFS_ATTR(_f_##_opts_, qmult)\n\n#define USB_ETHERNET_CONFIGFS_ITEM_ATTR_IFNAME(_f_)\t\t\t\\\n\tstatic ssize_t _f_##_opts_ifname_show(struct config_item *item, \\\n\t\t\t\t\t      char *page)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint ret;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tret = gether_get_ifname(opts->net, page, PAGE_SIZE);\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tstatic ssize_t _f_##_opts_ifname_store(struct config_item *item, \\\n\t\t\t\t\t       const char *page, size_t len)\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint ret = -EBUSY;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tif (!opts->refcnt)\t\t\t\t\t\\\n\t\t\tret = gether_set_ifname(opts->net, page, len);\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\treturn ret ?: len;\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tCONFIGFS_ATTR(_f_##_opts_, ifname)\n\n#define USB_ETHER_CONFIGFS_ITEM_ATTR_U8_RW(_f_, _n_)\t\t\t\\\n\tstatic ssize_t _f_##_opts_##_n_##_show(struct config_item *item,\\\n\t\t\t\t\t       char *page)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint ret;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tret = sprintf(page, \"%02x\\n\", opts->_n_);\t\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tstatic ssize_t _f_##_opts_##_n_##_store(struct config_item *item,\\\n\t\t\t\t\t\tconst char *page,\t\\\n\t\t\t\t\t\tsize_t len)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tstruct f_##_f_##_opts *opts = to_f_##_f_##_opts(item);\t\\\n\t\tint ret = -EINVAL;\t\t\t\t\t\\\n\t\tu8 val;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tmutex_lock(&opts->lock);\t\t\t\t\\\n\t\tif (sscanf(page, \"%02hhx\", &val) > 0) {\t\t\t\\\n\t\t\topts->_n_ = val;\t\t\t\t\\\n\t\t\tret = len;\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\tmutex_unlock(&opts->lock);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\treturn ret;\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tCONFIGFS_ATTR(_f_##_opts_, _n_)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}