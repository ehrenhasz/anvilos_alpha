{
  "module_name": "storage_common.h",
  "hash_id": "9feb615545a0d4addffabdc75d60ed1784a883cf0aca11e1a9d18f4a57f0e4fd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/gadget/function/storage_common.h",
  "human_readable_source": " \n#ifndef USB_STORAGE_COMMON_H\n#define USB_STORAGE_COMMON_H\n\n#include <linux/device.h>\n#include <linux/usb/storage.h>\n#include <scsi/scsi.h>\n#include <asm/unaligned.h>\n\n#ifndef DEBUG\n#undef VERBOSE_DEBUG\n#undef DUMP_MSGS\n#endif  \n\n#ifdef VERBOSE_DEBUG\n#define VLDBG\tLDBG\n#else\n#define VLDBG(lun, fmt, args...) do { } while (0)\n#endif  \n\n#define _LMSG(func, lun, fmt, args...)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tif ((lun)->name_pfx && *(lun)->name_pfx)\t\t\\\n\t\t\tfunc(\"%s/%s: \" fmt, *(lun)->name_pfx,\t\t\\\n\t\t\t\t (lun)->name, ## args);\t\t\t\\\n\t\telse\t\t\t\t\t\t\t\\\n\t\t\tfunc(\"%s: \" fmt, (lun)->name, ## args);\t\t\\\n\t} while (0)\n\n#define LDBG(lun, fmt, args...)\t\t_LMSG(pr_debug, lun, fmt, ## args)\n#define LERROR(lun, fmt, args...)\t_LMSG(pr_err, lun, fmt, ## args)\n#define LWARN(lun, fmt, args...)\t_LMSG(pr_warn, lun, fmt, ## args)\n#define LINFO(lun, fmt, args...)\t_LMSG(pr_info, lun, fmt, ## args)\n\n\n#ifdef DUMP_MSGS\n\n#  define dump_msg(fsg,   label,\t\t\t\\\n\t\t     buf,   length)\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (length < 512) {\t\t\t\t\t\t\\\n\t\tDBG(fsg, \"%s, length %u:\\n\", label, length);\t\t\\\n\t\tprint_hex_dump(KERN_DEBUG, \"\", DUMP_PREFIX_OFFSET,\t\\\n\t\t\t       16, 1, buf, length, 0);\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#  define dump_cdb(fsg) do { } while (0)\n\n#else\n\n#  define dump_msg(fsg,   label, \\\n\t\t     buf,   length) do { } while (0)\n\n#  ifdef VERBOSE_DEBUG\n\n#    define dump_cdb(fsg)\t\t\t\t\t\t\\\n\tprint_hex_dump(KERN_DEBUG, \"SCSI CDB: \", DUMP_PREFIX_NONE,\t\\\n\t\t       16, 1, (fsg)->cmnd, (fsg)->cmnd_size, 0)\t\t\\\n\n#  else\n\n#    define dump_cdb(fsg) do { } while (0)\n\n#  endif  \n\n#endif  \n\n \n#define MAX_COMMAND_SIZE\t16\n\n \n#define SS_NO_SENSE\t\t\t\t0\n#define SS_COMMUNICATION_FAILURE\t\t0x040800\n#define SS_INVALID_COMMAND\t\t\t0x052000\n#define SS_INVALID_FIELD_IN_CDB\t\t\t0x052400\n#define SS_LOGICAL_BLOCK_ADDRESS_OUT_OF_RANGE\t0x052100\n#define SS_LOGICAL_UNIT_NOT_SUPPORTED\t\t0x052500\n#define SS_MEDIUM_NOT_PRESENT\t\t\t0x023a00\n#define SS_MEDIUM_REMOVAL_PREVENTED\t\t0x055302\n#define SS_NOT_READY_TO_READY_TRANSITION\t0x062800\n#define SS_RESET_OCCURRED\t\t\t0x062900\n#define SS_SAVING_PARAMETERS_NOT_SUPPORTED\t0x053900\n#define SS_UNRECOVERED_READ_ERROR\t\t0x031100\n#define SS_WRITE_ERROR\t\t\t\t0x030c02\n#define SS_WRITE_PROTECTED\t\t\t0x072700\n\n#define SK(x)\t\t((u8) ((x) >> 16))\t \n#define ASC(x)\t\t((u8) ((x) >> 8))\n#define ASCQ(x)\t\t((u8) (x))\n\n \n#define INQUIRY_STRING_LEN ((size_t) (8 + 16 + 4 + 1))\n\nstruct fsg_lun {\n\tstruct file\t*filp;\n\tloff_t\t\tfile_length;\n\tloff_t\t\tnum_sectors;\n\n\tunsigned int\tinitially_ro:1;\n\tunsigned int\tro:1;\n\tunsigned int\tremovable:1;\n\tunsigned int\tcdrom:1;\n\tunsigned int\tprevent_medium_removal:1;\n\tunsigned int\tregistered:1;\n\tunsigned int\tinfo_valid:1;\n\tunsigned int\tnofua:1;\n\n\tu32\t\tsense_data;\n\tu32\t\tsense_data_info;\n\tu32\t\tunit_attention_data;\n\n\tunsigned int\tblkbits;  \n\tunsigned int\tblksize;  \n\tstruct device\tdev;\n\tconst char\t*name;\t\t \n\tconst char\t**name_pfx;\t \n\tchar\t\tinquiry_string[INQUIRY_STRING_LEN];\n};\n\nstatic inline bool fsg_lun_is_open(struct fsg_lun *curlun)\n{\n\treturn curlun->filp != NULL;\n}\n\n \n#define FSG_BUFLEN\t((u32)16384)\n\n \n#define FSG_MAX_LUNS\t16\n\nenum fsg_buffer_state {\n\tBUF_STATE_SENDING = -2,\n\tBUF_STATE_RECEIVING,\n\tBUF_STATE_EMPTY = 0,\n\tBUF_STATE_FULL\n};\n\nstruct fsg_buffhd {\n\tvoid\t\t\t\t*buf;\n\tenum fsg_buffer_state\t\tstate;\n\tstruct fsg_buffhd\t\t*next;\n\n\t \n\tunsigned int\t\t\tbulk_out_intended_length;\n\n\tstruct usb_request\t\t*inreq;\n\tstruct usb_request\t\t*outreq;\n};\n\nenum fsg_state {\n\tFSG_STATE_NORMAL,\n\tFSG_STATE_ABORT_BULK_OUT,\n\tFSG_STATE_PROTOCOL_RESET,\n\tFSG_STATE_CONFIG_CHANGE,\n\tFSG_STATE_EXIT,\n\tFSG_STATE_TERMINATED\n};\n\nenum data_direction {\n\tDATA_DIR_UNKNOWN = 0,\n\tDATA_DIR_FROM_HOST,\n\tDATA_DIR_TO_HOST,\n\tDATA_DIR_NONE\n};\n\nstatic inline struct fsg_lun *fsg_lun_from_dev(struct device *dev)\n{\n\treturn container_of(dev, struct fsg_lun, dev);\n}\n\nenum {\n\tFSG_STRING_INTERFACE\n};\n\nextern struct usb_interface_descriptor fsg_intf_desc;\n\nextern struct usb_endpoint_descriptor fsg_fs_bulk_in_desc;\nextern struct usb_endpoint_descriptor fsg_fs_bulk_out_desc;\nextern struct usb_descriptor_header *fsg_fs_function[];\n\nextern struct usb_endpoint_descriptor fsg_hs_bulk_in_desc;\nextern struct usb_endpoint_descriptor fsg_hs_bulk_out_desc;\nextern struct usb_descriptor_header *fsg_hs_function[];\n\nextern struct usb_endpoint_descriptor fsg_ss_bulk_in_desc;\nextern struct usb_ss_ep_comp_descriptor fsg_ss_bulk_in_comp_desc;\nextern struct usb_endpoint_descriptor fsg_ss_bulk_out_desc;\nextern struct usb_ss_ep_comp_descriptor fsg_ss_bulk_out_comp_desc;\nextern struct usb_descriptor_header *fsg_ss_function[];\n\nvoid fsg_lun_close(struct fsg_lun *curlun);\nint fsg_lun_open(struct fsg_lun *curlun, const char *filename);\nint fsg_lun_fsync_sub(struct fsg_lun *curlun);\nvoid store_cdrom_address(u8 *dest, int msf, u32 addr);\nssize_t fsg_show_ro(struct fsg_lun *curlun, char *buf);\nssize_t fsg_show_nofua(struct fsg_lun *curlun, char *buf);\nssize_t fsg_show_file(struct fsg_lun *curlun, struct rw_semaphore *filesem,\n\t\t      char *buf);\nssize_t fsg_show_inquiry_string(struct fsg_lun *curlun, char *buf);\nssize_t fsg_show_cdrom(struct fsg_lun *curlun, char *buf);\nssize_t fsg_show_removable(struct fsg_lun *curlun, char *buf);\nssize_t fsg_store_ro(struct fsg_lun *curlun, struct rw_semaphore *filesem,\n\t\t     const char *buf, size_t count);\nssize_t fsg_store_nofua(struct fsg_lun *curlun, const char *buf, size_t count);\nssize_t fsg_store_file(struct fsg_lun *curlun, struct rw_semaphore *filesem,\n\t\t       const char *buf, size_t count);\nssize_t fsg_store_cdrom(struct fsg_lun *curlun, struct rw_semaphore *filesem,\n\t\t\tconst char *buf, size_t count);\nssize_t fsg_store_removable(struct fsg_lun *curlun, const char *buf,\n\t\t\t    size_t count);\nssize_t fsg_store_inquiry_string(struct fsg_lun *curlun, const char *buf,\n\t\t\t\t size_t count);\nssize_t fsg_store_forced_eject(struct fsg_lun *curlun, struct rw_semaphore *filesem,\n\t\t\t       const char *buf, size_t count);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}