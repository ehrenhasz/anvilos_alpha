{
  "module_name": "debugfs.c",
  "hash_id": "ed6887fe05c9b59414db301b6d2c02188ab3f4302f2a472693c4d85878017e86",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/dwc2/debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/spinlock.h>\n#include <linux/debugfs.h>\n#include <linux/seq_file.h>\n#include <linux/uaccess.h>\n\n#include \"core.h\"\n#include \"debug.h\"\n\n#if IS_ENABLED(CONFIG_USB_DWC2_PERIPHERAL) || \\\n\tIS_ENABLED(CONFIG_USB_DWC2_DUAL_ROLE)\n\n \nstatic ssize_t testmode_write(struct file *file, const char __user *ubuf, size_t\n\t\tcount, loff_t *ppos)\n{\n\tstruct seq_file\t\t*s = file->private_data;\n\tstruct dwc2_hsotg\t*hsotg = s->private;\n\tunsigned long\t\tflags;\n\tu32\t\t\ttestmode = 0;\n\tchar\t\t\tbuf[32];\n\n\tif (copy_from_user(&buf, ubuf, min_t(size_t, sizeof(buf) - 1, count)))\n\t\treturn -EFAULT;\n\n\tif (!strncmp(buf, \"test_j\", 6))\n\t\ttestmode = USB_TEST_J;\n\telse if (!strncmp(buf, \"test_k\", 6))\n\t\ttestmode = USB_TEST_K;\n\telse if (!strncmp(buf, \"test_se0_nak\", 12))\n\t\ttestmode = USB_TEST_SE0_NAK;\n\telse if (!strncmp(buf, \"test_packet\", 11))\n\t\ttestmode = USB_TEST_PACKET;\n\telse if (!strncmp(buf, \"test_force_enable\", 17))\n\t\ttestmode = USB_TEST_FORCE_ENABLE;\n\telse\n\t\ttestmode = 0;\n\n\tspin_lock_irqsave(&hsotg->lock, flags);\n\tdwc2_hsotg_set_test_mode(hsotg, testmode);\n\tspin_unlock_irqrestore(&hsotg->lock, flags);\n\treturn count;\n}\n\n \nstatic int testmode_show(struct seq_file *s, void *unused)\n{\n\tstruct dwc2_hsotg *hsotg = s->private;\n\tunsigned long flags;\n\tint dctl;\n\n\tspin_lock_irqsave(&hsotg->lock, flags);\n\tdctl = dwc2_readl(hsotg, DCTL);\n\tdctl &= DCTL_TSTCTL_MASK;\n\tdctl >>= DCTL_TSTCTL_SHIFT;\n\tspin_unlock_irqrestore(&hsotg->lock, flags);\n\n\tswitch (dctl) {\n\tcase 0:\n\t\tseq_puts(s, \"no test\\n\");\n\t\tbreak;\n\tcase USB_TEST_J:\n\t\tseq_puts(s, \"test_j\\n\");\n\t\tbreak;\n\tcase USB_TEST_K:\n\t\tseq_puts(s, \"test_k\\n\");\n\t\tbreak;\n\tcase USB_TEST_SE0_NAK:\n\t\tseq_puts(s, \"test_se0_nak\\n\");\n\t\tbreak;\n\tcase USB_TEST_PACKET:\n\t\tseq_puts(s, \"test_packet\\n\");\n\t\tbreak;\n\tcase USB_TEST_FORCE_ENABLE:\n\t\tseq_puts(s, \"test_force_enable\\n\");\n\t\tbreak;\n\tdefault:\n\t\tseq_printf(s, \"UNKNOWN %d\\n\", dctl);\n\t}\n\n\treturn 0;\n}\n\nstatic int testmode_open(struct inode *inode, struct file *file)\n{\n\treturn single_open(file, testmode_show, inode->i_private);\n}\n\nstatic const struct file_operations testmode_fops = {\n\t.owner\t\t= THIS_MODULE,\n\t.open\t\t= testmode_open,\n\t.write\t\t= testmode_write,\n\t.read\t\t= seq_read,\n\t.llseek\t\t= seq_lseek,\n\t.release\t= single_release,\n};\n\n \nstatic int state_show(struct seq_file *seq, void *v)\n{\n\tstruct dwc2_hsotg *hsotg = seq->private;\n\tint idx;\n\n\tseq_printf(seq, \"DCFG=0x%08x, DCTL=0x%08x, DSTS=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, DCFG),\n\t\t dwc2_readl(hsotg, DCTL),\n\t\t dwc2_readl(hsotg, DSTS));\n\n\tseq_printf(seq, \"DIEPMSK=0x%08x, DOEPMASK=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, DIEPMSK), dwc2_readl(hsotg, DOEPMSK));\n\n\tseq_printf(seq, \"GINTMSK=0x%08x, GINTSTS=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, GINTMSK),\n\t\t   dwc2_readl(hsotg, GINTSTS));\n\n\tseq_printf(seq, \"DAINTMSK=0x%08x, DAINT=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, DAINTMSK),\n\t\t   dwc2_readl(hsotg, DAINT));\n\n\tseq_printf(seq, \"GNPTXSTS=0x%08x, GRXSTSR=%08x\\n\",\n\t\t   dwc2_readl(hsotg, GNPTXSTS),\n\t\t   dwc2_readl(hsotg, GRXSTSR));\n\n\tseq_puts(seq, \"\\nEndpoint status:\\n\");\n\n\tfor (idx = 0; idx < hsotg->num_of_eps; idx++) {\n\t\tu32 in, out;\n\n\t\tin = dwc2_readl(hsotg, DIEPCTL(idx));\n\t\tout = dwc2_readl(hsotg, DOEPCTL(idx));\n\n\t\tseq_printf(seq, \"ep%d: DIEPCTL=0x%08x, DOEPCTL=0x%08x\",\n\t\t\t   idx, in, out);\n\n\t\tin = dwc2_readl(hsotg, DIEPTSIZ(idx));\n\t\tout = dwc2_readl(hsotg, DOEPTSIZ(idx));\n\n\t\tseq_printf(seq, \", DIEPTSIZ=0x%08x, DOEPTSIZ=0x%08x\",\n\t\t\t   in, out);\n\n\t\tseq_puts(seq, \"\\n\");\n\t}\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(state);\n\n \nstatic int fifo_show(struct seq_file *seq, void *v)\n{\n\tstruct dwc2_hsotg *hsotg = seq->private;\n\tint fifo_count = dwc2_hsotg_tx_fifo_count(hsotg);\n\tu32 val;\n\tint idx;\n\n\tseq_puts(seq, \"Non-periodic FIFOs:\\n\");\n\tseq_printf(seq, \"RXFIFO: Size %d\\n\", dwc2_readl(hsotg, GRXFSIZ));\n\n\tval = dwc2_readl(hsotg, GNPTXFSIZ);\n\tseq_printf(seq, \"NPTXFIFO: Size %d, Start 0x%08x\\n\",\n\t\t   val >> FIFOSIZE_DEPTH_SHIFT,\n\t\t   val & FIFOSIZE_STARTADDR_MASK);\n\n\tseq_puts(seq, \"\\nPeriodic TXFIFOs:\\n\");\n\n\tfor (idx = 1; idx <= fifo_count; idx++) {\n\t\tval = dwc2_readl(hsotg, DPTXFSIZN(idx));\n\n\t\tseq_printf(seq, \"\\tDPTXFIFO%2d: Size %d, Start 0x%08x\\n\", idx,\n\t\t\t   val >> FIFOSIZE_DEPTH_SHIFT,\n\t\t\t   val & FIFOSIZE_STARTADDR_MASK);\n\t}\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(fifo);\n\nstatic const char *decode_direction(int is_in)\n{\n\treturn is_in ? \"in\" : \"out\";\n}\n\n \nstatic int ep_show(struct seq_file *seq, void *v)\n{\n\tstruct dwc2_hsotg_ep *ep = seq->private;\n\tstruct dwc2_hsotg *hsotg = ep->parent;\n\tstruct dwc2_hsotg_req *req;\n\tint index = ep->index;\n\tint show_limit = 15;\n\tunsigned long flags;\n\n\tseq_printf(seq, \"Endpoint index %d, named %s,  dir %s:\\n\",\n\t\t   ep->index, ep->ep.name, decode_direction(ep->dir_in));\n\n\t \n\n\tseq_printf(seq, \"\\tDIEPCTL=0x%08x, DOEPCTL=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, DIEPCTL(index)),\n\t\t   dwc2_readl(hsotg, DOEPCTL(index)));\n\n\tseq_printf(seq, \"\\tDIEPDMA=0x%08x, DOEPDMA=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, DIEPDMA(index)),\n\t\t   dwc2_readl(hsotg, DOEPDMA(index)));\n\n\tseq_printf(seq, \"\\tDIEPINT=0x%08x, DOEPINT=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, DIEPINT(index)),\n\t\t   dwc2_readl(hsotg, DOEPINT(index)));\n\n\tseq_printf(seq, \"\\tDIEPTSIZ=0x%08x, DOEPTSIZ=0x%08x\\n\",\n\t\t   dwc2_readl(hsotg, DIEPTSIZ(index)),\n\t\t   dwc2_readl(hsotg, DOEPTSIZ(index)));\n\n\tseq_puts(seq, \"\\n\");\n\tseq_printf(seq, \"mps %d\\n\", ep->ep.maxpacket);\n\tseq_printf(seq, \"total_data=%ld\\n\", ep->total_data);\n\n\tseq_printf(seq, \"request list (%p,%p):\\n\",\n\t\t   ep->queue.next, ep->queue.prev);\n\n\tspin_lock_irqsave(&hsotg->lock, flags);\n\n\tlist_for_each_entry(req, &ep->queue, queue) {\n\t\tif (--show_limit < 0) {\n\t\t\tseq_puts(seq, \"not showing more requests...\\n\");\n\t\t\tbreak;\n\t\t}\n\n\t\tseq_printf(seq, \"%c req %p: %d bytes @%p, \",\n\t\t\t   req == ep->req ? '*' : ' ',\n\t\t\t   req, req->req.length, req->req.buf);\n\t\tseq_printf(seq, \"%d done, res %d\\n\",\n\t\t\t   req->req.actual, req->req.status);\n\t}\n\n\tspin_unlock_irqrestore(&hsotg->lock, flags);\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(ep);\n\n \nstatic void dwc2_hsotg_create_debug(struct dwc2_hsotg *hsotg)\n{\n\tstruct dentry *root;\n\tunsigned int epidx;\n\n\troot = hsotg->debug_root;\n\n\t \n\tdebugfs_create_file(\"state\", 0444, root, hsotg, &state_fops);\n\tdebugfs_create_file(\"testmode\", 0644, root, hsotg, &testmode_fops);\n\tdebugfs_create_file(\"fifo\", 0444, root, hsotg, &fifo_fops);\n\n\t \n\tfor (epidx = 0; epidx < hsotg->num_of_eps; epidx++) {\n\t\tstruct dwc2_hsotg_ep *ep;\n\n\t\tep = hsotg->eps_out[epidx];\n\t\tif (ep)\n\t\t\tdebugfs_create_file(ep->name, 0444, root, ep, &ep_fops);\n\t}\n\t \n\tfor (epidx = 1; epidx < hsotg->num_of_eps; epidx++) {\n\t\tstruct dwc2_hsotg_ep *ep;\n\n\t\tep = hsotg->eps_in[epidx];\n\t\tif (ep)\n\t\t\tdebugfs_create_file(ep->name, 0444, root, ep, &ep_fops);\n\t}\n}\n#else\nstatic inline void dwc2_hsotg_create_debug(struct dwc2_hsotg *hsotg) {}\n#endif\n\n \n\n#define dump_register(nm)\t\\\n{\t\t\t\t\\\n\t.name\t= #nm,\t\t\\\n\t.offset\t= nm,\t\t\\\n}\n\nstatic const struct debugfs_reg32 dwc2_regs[] = {\n\t \n\tdump_register(GOTGCTL),\n\tdump_register(GOTGINT),\n\tdump_register(GAHBCFG),\n\tdump_register(GUSBCFG),\n\tdump_register(GRSTCTL),\n\tdump_register(GINTSTS),\n\tdump_register(GINTMSK),\n\tdump_register(GRXSTSR),\n\t \n\tdump_register(GRXFSIZ),\n\tdump_register(GNPTXFSIZ),\n\tdump_register(GNPTXSTS),\n\tdump_register(GI2CCTL),\n\tdump_register(GPVNDCTL),\n\tdump_register(GGPIO),\n\tdump_register(GUID),\n\tdump_register(GSNPSID),\n\tdump_register(GHWCFG1),\n\tdump_register(GHWCFG2),\n\tdump_register(GHWCFG3),\n\tdump_register(GHWCFG4),\n\tdump_register(GLPMCFG),\n\tdump_register(GPWRDN),\n\tdump_register(GDFIFOCFG),\n\tdump_register(ADPCTL),\n\tdump_register(HPTXFSIZ),\n\tdump_register(DPTXFSIZN(1)),\n\tdump_register(DPTXFSIZN(2)),\n\tdump_register(DPTXFSIZN(3)),\n\tdump_register(DPTXFSIZN(4)),\n\tdump_register(DPTXFSIZN(5)),\n\tdump_register(DPTXFSIZN(6)),\n\tdump_register(DPTXFSIZN(7)),\n\tdump_register(DPTXFSIZN(8)),\n\tdump_register(DPTXFSIZN(9)),\n\tdump_register(DPTXFSIZN(10)),\n\tdump_register(DPTXFSIZN(11)),\n\tdump_register(DPTXFSIZN(12)),\n\tdump_register(DPTXFSIZN(13)),\n\tdump_register(DPTXFSIZN(14)),\n\tdump_register(DPTXFSIZN(15)),\n\tdump_register(DCFG),\n\tdump_register(DCTL),\n\tdump_register(DSTS),\n\tdump_register(DIEPMSK),\n\tdump_register(DOEPMSK),\n\tdump_register(DAINT),\n\tdump_register(DAINTMSK),\n\tdump_register(DTKNQR1),\n\tdump_register(DTKNQR2),\n\tdump_register(DTKNQR3),\n\tdump_register(DTKNQR4),\n\tdump_register(DVBUSDIS),\n\tdump_register(DVBUSPULSE),\n\tdump_register(DIEPCTL(0)),\n\tdump_register(DIEPCTL(1)),\n\tdump_register(DIEPCTL(2)),\n\tdump_register(DIEPCTL(3)),\n\tdump_register(DIEPCTL(4)),\n\tdump_register(DIEPCTL(5)),\n\tdump_register(DIEPCTL(6)),\n\tdump_register(DIEPCTL(7)),\n\tdump_register(DIEPCTL(8)),\n\tdump_register(DIEPCTL(9)),\n\tdump_register(DIEPCTL(10)),\n\tdump_register(DIEPCTL(11)),\n\tdump_register(DIEPCTL(12)),\n\tdump_register(DIEPCTL(13)),\n\tdump_register(DIEPCTL(14)),\n\tdump_register(DIEPCTL(15)),\n\tdump_register(DOEPCTL(0)),\n\tdump_register(DOEPCTL(1)),\n\tdump_register(DOEPCTL(2)),\n\tdump_register(DOEPCTL(3)),\n\tdump_register(DOEPCTL(4)),\n\tdump_register(DOEPCTL(5)),\n\tdump_register(DOEPCTL(6)),\n\tdump_register(DOEPCTL(7)),\n\tdump_register(DOEPCTL(8)),\n\tdump_register(DOEPCTL(9)),\n\tdump_register(DOEPCTL(10)),\n\tdump_register(DOEPCTL(11)),\n\tdump_register(DOEPCTL(12)),\n\tdump_register(DOEPCTL(13)),\n\tdump_register(DOEPCTL(14)),\n\tdump_register(DOEPCTL(15)),\n\tdump_register(DIEPINT(0)),\n\tdump_register(DIEPINT(1)),\n\tdump_register(DIEPINT(2)),\n\tdump_register(DIEPINT(3)),\n\tdump_register(DIEPINT(4)),\n\tdump_register(DIEPINT(5)),\n\tdump_register(DIEPINT(6)),\n\tdump_register(DIEPINT(7)),\n\tdump_register(DIEPINT(8)),\n\tdump_register(DIEPINT(9)),\n\tdump_register(DIEPINT(10)),\n\tdump_register(DIEPINT(11)),\n\tdump_register(DIEPINT(12)),\n\tdump_register(DIEPINT(13)),\n\tdump_register(DIEPINT(14)),\n\tdump_register(DIEPINT(15)),\n\tdump_register(DOEPINT(0)),\n\tdump_register(DOEPINT(1)),\n\tdump_register(DOEPINT(2)),\n\tdump_register(DOEPINT(3)),\n\tdump_register(DOEPINT(4)),\n\tdump_register(DOEPINT(5)),\n\tdump_register(DOEPINT(6)),\n\tdump_register(DOEPINT(7)),\n\tdump_register(DOEPINT(8)),\n\tdump_register(DOEPINT(9)),\n\tdump_register(DOEPINT(10)),\n\tdump_register(DOEPINT(11)),\n\tdump_register(DOEPINT(12)),\n\tdump_register(DOEPINT(13)),\n\tdump_register(DOEPINT(14)),\n\tdump_register(DOEPINT(15)),\n\tdump_register(DIEPTSIZ(0)),\n\tdump_register(DIEPTSIZ(1)),\n\tdump_register(DIEPTSIZ(2)),\n\tdump_register(DIEPTSIZ(3)),\n\tdump_register(DIEPTSIZ(4)),\n\tdump_register(DIEPTSIZ(5)),\n\tdump_register(DIEPTSIZ(6)),\n\tdump_register(DIEPTSIZ(7)),\n\tdump_register(DIEPTSIZ(8)),\n\tdump_register(DIEPTSIZ(9)),\n\tdump_register(DIEPTSIZ(10)),\n\tdump_register(DIEPTSIZ(11)),\n\tdump_register(DIEPTSIZ(12)),\n\tdump_register(DIEPTSIZ(13)),\n\tdump_register(DIEPTSIZ(14)),\n\tdump_register(DIEPTSIZ(15)),\n\tdump_register(DOEPTSIZ(0)),\n\tdump_register(DOEPTSIZ(1)),\n\tdump_register(DOEPTSIZ(2)),\n\tdump_register(DOEPTSIZ(3)),\n\tdump_register(DOEPTSIZ(4)),\n\tdump_register(DOEPTSIZ(5)),\n\tdump_register(DOEPTSIZ(6)),\n\tdump_register(DOEPTSIZ(7)),\n\tdump_register(DOEPTSIZ(8)),\n\tdump_register(DOEPTSIZ(9)),\n\tdump_register(DOEPTSIZ(10)),\n\tdump_register(DOEPTSIZ(11)),\n\tdump_register(DOEPTSIZ(12)),\n\tdump_register(DOEPTSIZ(13)),\n\tdump_register(DOEPTSIZ(14)),\n\tdump_register(DOEPTSIZ(15)),\n\tdump_register(DIEPDMA(0)),\n\tdump_register(DIEPDMA(1)),\n\tdump_register(DIEPDMA(2)),\n\tdump_register(DIEPDMA(3)),\n\tdump_register(DIEPDMA(4)),\n\tdump_register(DIEPDMA(5)),\n\tdump_register(DIEPDMA(6)),\n\tdump_register(DIEPDMA(7)),\n\tdump_register(DIEPDMA(8)),\n\tdump_register(DIEPDMA(9)),\n\tdump_register(DIEPDMA(10)),\n\tdump_register(DIEPDMA(11)),\n\tdump_register(DIEPDMA(12)),\n\tdump_register(DIEPDMA(13)),\n\tdump_register(DIEPDMA(14)),\n\tdump_register(DIEPDMA(15)),\n\tdump_register(DOEPDMA(0)),\n\tdump_register(DOEPDMA(1)),\n\tdump_register(DOEPDMA(2)),\n\tdump_register(DOEPDMA(3)),\n\tdump_register(DOEPDMA(4)),\n\tdump_register(DOEPDMA(5)),\n\tdump_register(DOEPDMA(6)),\n\tdump_register(DOEPDMA(7)),\n\tdump_register(DOEPDMA(8)),\n\tdump_register(DOEPDMA(9)),\n\tdump_register(DOEPDMA(10)),\n\tdump_register(DOEPDMA(11)),\n\tdump_register(DOEPDMA(12)),\n\tdump_register(DOEPDMA(13)),\n\tdump_register(DOEPDMA(14)),\n\tdump_register(DOEPDMA(15)),\n\tdump_register(DTXFSTS(0)),\n\tdump_register(DTXFSTS(1)),\n\tdump_register(DTXFSTS(2)),\n\tdump_register(DTXFSTS(3)),\n\tdump_register(DTXFSTS(4)),\n\tdump_register(DTXFSTS(5)),\n\tdump_register(DTXFSTS(6)),\n\tdump_register(DTXFSTS(7)),\n\tdump_register(DTXFSTS(8)),\n\tdump_register(DTXFSTS(9)),\n\tdump_register(DTXFSTS(10)),\n\tdump_register(DTXFSTS(11)),\n\tdump_register(DTXFSTS(12)),\n\tdump_register(DTXFSTS(13)),\n\tdump_register(DTXFSTS(14)),\n\tdump_register(DTXFSTS(15)),\n\tdump_register(PCGCTL),\n\tdump_register(HCFG),\n\tdump_register(HFIR),\n\tdump_register(HFNUM),\n\tdump_register(HPTXSTS),\n\tdump_register(HAINT),\n\tdump_register(HAINTMSK),\n\tdump_register(HFLBADDR),\n\tdump_register(HPRT0),\n\tdump_register(HCCHAR(0)),\n\tdump_register(HCCHAR(1)),\n\tdump_register(HCCHAR(2)),\n\tdump_register(HCCHAR(3)),\n\tdump_register(HCCHAR(4)),\n\tdump_register(HCCHAR(5)),\n\tdump_register(HCCHAR(6)),\n\tdump_register(HCCHAR(7)),\n\tdump_register(HCCHAR(8)),\n\tdump_register(HCCHAR(9)),\n\tdump_register(HCCHAR(10)),\n\tdump_register(HCCHAR(11)),\n\tdump_register(HCCHAR(12)),\n\tdump_register(HCCHAR(13)),\n\tdump_register(HCCHAR(14)),\n\tdump_register(HCCHAR(15)),\n\tdump_register(HCSPLT(0)),\n\tdump_register(HCSPLT(1)),\n\tdump_register(HCSPLT(2)),\n\tdump_register(HCSPLT(3)),\n\tdump_register(HCSPLT(4)),\n\tdump_register(HCSPLT(5)),\n\tdump_register(HCSPLT(6)),\n\tdump_register(HCSPLT(7)),\n\tdump_register(HCSPLT(8)),\n\tdump_register(HCSPLT(9)),\n\tdump_register(HCSPLT(10)),\n\tdump_register(HCSPLT(11)),\n\tdump_register(HCSPLT(12)),\n\tdump_register(HCSPLT(13)),\n\tdump_register(HCSPLT(14)),\n\tdump_register(HCSPLT(15)),\n\tdump_register(HCINT(0)),\n\tdump_register(HCINT(1)),\n\tdump_register(HCINT(2)),\n\tdump_register(HCINT(3)),\n\tdump_register(HCINT(4)),\n\tdump_register(HCINT(5)),\n\tdump_register(HCINT(6)),\n\tdump_register(HCINT(7)),\n\tdump_register(HCINT(8)),\n\tdump_register(HCINT(9)),\n\tdump_register(HCINT(10)),\n\tdump_register(HCINT(11)),\n\tdump_register(HCINT(12)),\n\tdump_register(HCINT(13)),\n\tdump_register(HCINT(14)),\n\tdump_register(HCINT(15)),\n\tdump_register(HCINTMSK(0)),\n\tdump_register(HCINTMSK(1)),\n\tdump_register(HCINTMSK(2)),\n\tdump_register(HCINTMSK(3)),\n\tdump_register(HCINTMSK(4)),\n\tdump_register(HCINTMSK(5)),\n\tdump_register(HCINTMSK(6)),\n\tdump_register(HCINTMSK(7)),\n\tdump_register(HCINTMSK(8)),\n\tdump_register(HCINTMSK(9)),\n\tdump_register(HCINTMSK(10)),\n\tdump_register(HCINTMSK(11)),\n\tdump_register(HCINTMSK(12)),\n\tdump_register(HCINTMSK(13)),\n\tdump_register(HCINTMSK(14)),\n\tdump_register(HCINTMSK(15)),\n\tdump_register(HCTSIZ(0)),\n\tdump_register(HCTSIZ(1)),\n\tdump_register(HCTSIZ(2)),\n\tdump_register(HCTSIZ(3)),\n\tdump_register(HCTSIZ(4)),\n\tdump_register(HCTSIZ(5)),\n\tdump_register(HCTSIZ(6)),\n\tdump_register(HCTSIZ(7)),\n\tdump_register(HCTSIZ(8)),\n\tdump_register(HCTSIZ(9)),\n\tdump_register(HCTSIZ(10)),\n\tdump_register(HCTSIZ(11)),\n\tdump_register(HCTSIZ(12)),\n\tdump_register(HCTSIZ(13)),\n\tdump_register(HCTSIZ(14)),\n\tdump_register(HCTSIZ(15)),\n\tdump_register(HCDMA(0)),\n\tdump_register(HCDMA(1)),\n\tdump_register(HCDMA(2)),\n\tdump_register(HCDMA(3)),\n\tdump_register(HCDMA(4)),\n\tdump_register(HCDMA(5)),\n\tdump_register(HCDMA(6)),\n\tdump_register(HCDMA(7)),\n\tdump_register(HCDMA(8)),\n\tdump_register(HCDMA(9)),\n\tdump_register(HCDMA(10)),\n\tdump_register(HCDMA(11)),\n\tdump_register(HCDMA(12)),\n\tdump_register(HCDMA(13)),\n\tdump_register(HCDMA(14)),\n\tdump_register(HCDMA(15)),\n\tdump_register(HCDMAB(0)),\n\tdump_register(HCDMAB(1)),\n\tdump_register(HCDMAB(2)),\n\tdump_register(HCDMAB(3)),\n\tdump_register(HCDMAB(4)),\n\tdump_register(HCDMAB(5)),\n\tdump_register(HCDMAB(6)),\n\tdump_register(HCDMAB(7)),\n\tdump_register(HCDMAB(8)),\n\tdump_register(HCDMAB(9)),\n\tdump_register(HCDMAB(10)),\n\tdump_register(HCDMAB(11)),\n\tdump_register(HCDMAB(12)),\n\tdump_register(HCDMAB(13)),\n\tdump_register(HCDMAB(14)),\n\tdump_register(HCDMAB(15)),\n};\n\n#define print_param(_seq, _ptr, _param) \\\nseq_printf((_seq), \"%-30s: %d\\n\", #_param, (_ptr)->_param)\n\n#define print_param_hex(_seq, _ptr, _param) \\\nseq_printf((_seq), \"%-30s: 0x%x\\n\", #_param, (_ptr)->_param)\n\nstatic int params_show(struct seq_file *seq, void *v)\n{\n\tstruct dwc2_hsotg *hsotg = seq->private;\n\tstruct dwc2_core_params *p = &hsotg->params;\n\tint i;\n\n\tprint_param(seq, p, otg_caps.hnp_support);\n\tprint_param(seq, p, otg_caps.srp_support);\n\tprint_param(seq, p, otg_caps.otg_rev);\n\tprint_param(seq, p, dma_desc_enable);\n\tprint_param(seq, p, dma_desc_fs_enable);\n\tprint_param(seq, p, speed);\n\tprint_param(seq, p, enable_dynamic_fifo);\n\tprint_param(seq, p, en_multiple_tx_fifo);\n\tprint_param(seq, p, host_rx_fifo_size);\n\tprint_param(seq, p, host_nperio_tx_fifo_size);\n\tprint_param(seq, p, host_perio_tx_fifo_size);\n\tprint_param(seq, p, max_transfer_size);\n\tprint_param(seq, p, max_packet_count);\n\tprint_param(seq, p, host_channels);\n\tprint_param(seq, p, phy_type);\n\tprint_param(seq, p, phy_utmi_width);\n\tprint_param(seq, p, phy_ulpi_ddr);\n\tprint_param(seq, p, phy_ulpi_ext_vbus);\n\tprint_param(seq, p, i2c_enable);\n\tprint_param(seq, p, ipg_isoc_en);\n\tprint_param(seq, p, ulpi_fs_ls);\n\tprint_param(seq, p, host_support_fs_ls_low_power);\n\tprint_param(seq, p, host_ls_low_power_phy_clk);\n\tprint_param(seq, p, activate_stm_fs_transceiver);\n\tprint_param(seq, p, activate_stm_id_vb_detection);\n\tprint_param(seq, p, ts_dline);\n\tprint_param(seq, p, reload_ctl);\n\tprint_param_hex(seq, p, ahbcfg);\n\tprint_param(seq, p, uframe_sched);\n\tprint_param(seq, p, external_id_pin_ctl);\n\tprint_param(seq, p, power_down);\n\tprint_param(seq, p, lpm);\n\tprint_param(seq, p, lpm_clock_gating);\n\tprint_param(seq, p, besl);\n\tprint_param(seq, p, hird_threshold_en);\n\tprint_param(seq, p, hird_threshold);\n\tprint_param(seq, p, service_interval);\n\tprint_param(seq, p, host_dma);\n\tprint_param(seq, p, g_dma);\n\tprint_param(seq, p, g_dma_desc);\n\tprint_param(seq, p, g_rx_fifo_size);\n\tprint_param(seq, p, g_np_tx_fifo_size);\n\n\tfor (i = 0; i < MAX_EPS_CHANNELS; i++) {\n\t\tchar str[32];\n\n\t\tsnprintf(str, 32, \"g_tx_fifo_size[%d]\", i);\n\t\tseq_printf(seq, \"%-30s: %d\\n\", str, p->g_tx_fifo_size[i]);\n\t}\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(params);\n\nstatic int hw_params_show(struct seq_file *seq, void *v)\n{\n\tstruct dwc2_hsotg *hsotg = seq->private;\n\tstruct dwc2_hw_params *hw = &hsotg->hw_params;\n\n\tprint_param(seq, hw, op_mode);\n\tprint_param(seq, hw, arch);\n\tprint_param(seq, hw, dma_desc_enable);\n\tprint_param(seq, hw, enable_dynamic_fifo);\n\tprint_param(seq, hw, en_multiple_tx_fifo);\n\tprint_param(seq, hw, rx_fifo_size);\n\tprint_param(seq, hw, host_nperio_tx_fifo_size);\n\tprint_param(seq, hw, dev_nperio_tx_fifo_size);\n\tprint_param(seq, hw, host_perio_tx_fifo_size);\n\tprint_param(seq, hw, nperio_tx_q_depth);\n\tprint_param(seq, hw, host_perio_tx_q_depth);\n\tprint_param(seq, hw, dev_token_q_depth);\n\tprint_param(seq, hw, max_transfer_size);\n\tprint_param(seq, hw, max_packet_count);\n\tprint_param(seq, hw, host_channels);\n\tprint_param(seq, hw, hs_phy_type);\n\tprint_param(seq, hw, fs_phy_type);\n\tprint_param(seq, hw, i2c_enable);\n\tprint_param(seq, hw, num_dev_ep);\n\tprint_param(seq, hw, num_dev_perio_in_ep);\n\tprint_param(seq, hw, total_fifo_size);\n\tprint_param(seq, hw, power_optimized);\n\tprint_param(seq, hw, utmi_phy_data_width);\n\tprint_param_hex(seq, hw, snpsid);\n\tprint_param_hex(seq, hw, dev_ep_dirs);\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(hw_params);\n\nstatic int dr_mode_show(struct seq_file *seq, void *v)\n{\n\tstruct dwc2_hsotg *hsotg = seq->private;\n\tconst char *dr_mode = \"\";\n\n\tdevice_property_read_string(hsotg->dev, \"dr_mode\", &dr_mode);\n\tseq_printf(seq, \"%s\\n\", dr_mode);\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(dr_mode);\n\nint dwc2_debugfs_init(struct dwc2_hsotg *hsotg)\n{\n\tint\t\t\tret;\n\tstruct dentry\t\t*root;\n\n\troot = debugfs_create_dir(dev_name(hsotg->dev), usb_debug_root);\n\thsotg->debug_root = root;\n\n\tdebugfs_create_file(\"params\", 0444, root, hsotg, &params_fops);\n\tdebugfs_create_file(\"hw_params\", 0444, root, hsotg, &hw_params_fops);\n\tdebugfs_create_file(\"dr_mode\", 0444, root, hsotg, &dr_mode_fops);\n\n\t \n\tdwc2_hsotg_create_debug(hsotg);\n\n\thsotg->regset = devm_kzalloc(hsotg->dev, sizeof(*hsotg->regset),\n\t\t\t\t\t\t\t\tGFP_KERNEL);\n\tif (!hsotg->regset) {\n\t\tret = -ENOMEM;\n\t\tgoto err;\n\t}\n\n\thsotg->regset->regs = dwc2_regs;\n\thsotg->regset->nregs = ARRAY_SIZE(dwc2_regs);\n\thsotg->regset->base = hsotg->regs;\n\n\tdebugfs_create_regset32(\"regdump\", 0444, root, hsotg->regset);\n\n\treturn 0;\nerr:\n\tdebugfs_remove_recursive(hsotg->debug_root);\n\treturn ret;\n}\n\nvoid dwc2_debugfs_exit(struct dwc2_hsotg *hsotg)\n{\n\tdebugfs_remove_recursive(hsotg->debug_root);\n\thsotg->debug_root = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}