{
  "module_name": "pci.c",
  "hash_id": "f09e2970c45928338776b62a260f4b91049be4c13eeb5779cde88172151cb25f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/dwc2/pci.c",
  "human_readable_source": "\n \n\n \n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/spinlock.h>\n#include <linux/interrupt.h>\n#include <linux/io.h>\n#include <linux/slab.h>\n#include <linux/pci.h>\n#include <linux/usb.h>\n\n#include <linux/usb/hcd.h>\n#include <linux/usb/ch11.h>\n#include <linux/platform_device.h>\n#include <linux/usb/usb_phy_generic.h>\n\n#include \"core.h\"\n\nstatic const char dwc2_driver_name[] = \"dwc2-pci\";\n\nstruct dwc2_pci_glue {\n\tstruct platform_device *dwc2;\n\tstruct platform_device *phy;\n};\n\n \nstatic void dwc2_pci_remove(struct pci_dev *pci)\n{\n\tstruct dwc2_pci_glue *glue = pci_get_drvdata(pci);\n\n\tplatform_device_unregister(glue->dwc2);\n\tusb_phy_generic_unregister(glue->phy);\n\tpci_set_drvdata(pci, NULL);\n}\n\nstatic int dwc2_pci_probe(struct pci_dev *pci,\n\t\t\t  const struct pci_device_id *id)\n{\n\tstruct resource\t\tres[2];\n\tstruct platform_device\t*dwc2;\n\tstruct platform_device\t*phy;\n\tint\t\t\tret;\n\tstruct device\t\t*dev = &pci->dev;\n\tstruct dwc2_pci_glue\t*glue;\n\n\tret = pcim_enable_device(pci);\n\tif (ret) {\n\t\tdev_err(dev, \"failed to enable pci device\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tpci_set_master(pci);\n\n\tphy = usb_phy_generic_register();\n\tif (IS_ERR(phy)) {\n\t\tdev_err(dev, \"error registering generic PHY (%ld)\\n\",\n\t\t\tPTR_ERR(phy));\n\t\treturn PTR_ERR(phy);\n\t}\n\n\tdwc2 = platform_device_alloc(\"dwc2\", PLATFORM_DEVID_AUTO);\n\tif (!dwc2) {\n\t\tdev_err(dev, \"couldn't allocate dwc2 device\\n\");\n\t\tret = -ENOMEM;\n\t\tgoto err;\n\t}\n\n\tmemset(res, 0x00, sizeof(struct resource) * ARRAY_SIZE(res));\n\n\tres[0].start\t= pci_resource_start(pci, 0);\n\tres[0].end\t= pci_resource_end(pci, 0);\n\tres[0].name\t= \"dwc2\";\n\tres[0].flags\t= IORESOURCE_MEM;\n\n\tres[1].start\t= pci->irq;\n\tres[1].name\t= \"dwc2\";\n\tres[1].flags\t= IORESOURCE_IRQ;\n\n\tret = platform_device_add_resources(dwc2, res, ARRAY_SIZE(res));\n\tif (ret) {\n\t\tdev_err(dev, \"couldn't add resources to dwc2 device\\n\");\n\t\tgoto err;\n\t}\n\n\tdwc2->dev.parent = dev;\n\n\tglue = devm_kzalloc(dev, sizeof(*glue), GFP_KERNEL);\n\tif (!glue) {\n\t\tret = -ENOMEM;\n\t\tgoto err;\n\t}\n\n\tret = platform_device_add(dwc2);\n\tif (ret) {\n\t\tdev_err(dev, \"failed to register dwc2 device\\n\");\n\t\tgoto err;\n\t}\n\n\tglue->phy = phy;\n\tglue->dwc2 = dwc2;\n\tpci_set_drvdata(pci, glue);\n\n\treturn 0;\nerr:\n\tusb_phy_generic_unregister(phy);\n\tplatform_device_put(dwc2);\n\treturn ret;\n}\n\nstatic struct pci_driver dwc2_pci_driver = {\n\t.name = dwc2_driver_name,\n\t.id_table = dwc2_pci_ids,\n\t.probe = dwc2_pci_probe,\n\t.remove = dwc2_pci_remove,\n};\n\nmodule_pci_driver(dwc2_pci_driver);\n\nMODULE_DESCRIPTION(\"DESIGNWARE HS OTG PCI Bus Glue\");\nMODULE_AUTHOR(\"Synopsys, Inc.\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}