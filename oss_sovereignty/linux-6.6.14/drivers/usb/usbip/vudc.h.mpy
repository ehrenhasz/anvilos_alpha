{
  "module_name": "vudc.h",
  "hash_id": "0073ee9688370ab9e6c82442acd6e9159d5331230499268c7142ef99bb411ebd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/usbip/vudc.h",
  "human_readable_source": "\n \n\n#ifndef __USBIP_VUDC_H\n#define __USBIP_VUDC_H\n\n#include <linux/platform_device.h>\n#include <linux/usb.h>\n#include <linux/usb/gadget.h>\n#include <linux/usb/ch9.h>\n#include <linux/list.h>\n#include <linux/timer.h>\n#include <linux/time.h>\n#include <linux/sysfs.h>\n\n#include \"usbip_common.h\"\n\n#define GADGET_NAME \"usbip-vudc\"\n\nstruct vep {\n\tstruct usb_ep ep;\n\tunsigned type:2;  \n\tchar name[8];\t \n\n\tconst struct usb_endpoint_descriptor *desc;\n\tstruct usb_gadget *gadget;\n\tstruct list_head req_queue;  \n\tunsigned halted:1;\n\tunsigned wedged:1;\n\tunsigned already_seen:1;\n\tunsigned setup_stage:1;\n};\n\nstruct vrequest {\n\tstruct usb_request req;\n\tstruct vudc *udc;\n\tstruct list_head req_entry;  \n};\n\nstruct urbp {\n\tstruct urb *urb;\n\tstruct vep *ep;\n\tstruct list_head urb_entry;  \n\tunsigned long seqnum;\n\tunsigned type:2;  \n\tunsigned new:1;\n};\n\nstruct v_unlink {\n\tunsigned long seqnum;\n\t__u32 status;\n};\n\nenum tx_type {\n\tTX_UNLINK,\n\tTX_SUBMIT,\n};\n\nstruct tx_item {\n\tstruct list_head tx_entry;\n\tenum tx_type type;\n\tunion {\n\t\tstruct urbp *s;\n\t\tstruct v_unlink *u;\n\t};\n};\n\nenum tr_state {\n\tVUDC_TR_RUNNING,\n\tVUDC_TR_IDLE,\n\tVUDC_TR_STOPPED,\n};\n\nstruct transfer_timer {\n\tstruct timer_list timer;\n\tenum tr_state state;\n\tunsigned long frame_start;\n\tint frame_limit;\n};\n\nstruct vudc {\n\tstruct usb_gadget gadget;\n\tstruct usb_gadget_driver *driver;\n\tstruct platform_device *pdev;\n\n\tstruct usb_device_descriptor dev_desc;\n\n\tstruct usbip_device ud;\n\tstruct transfer_timer tr_timer;\n\tstruct timespec64 start_time;\n\n\tstruct list_head urb_queue;\n\n\tspinlock_t lock_tx;\n\tstruct list_head tx_queue;\n\twait_queue_head_t tx_waitq;\n\n\tspinlock_t lock;\n\tstruct vep *ep;\n\tint address;\n\tu16 devstatus;\n\n\tunsigned pullup:1;\n\tunsigned connected:1;\n\tunsigned desc_cached:1;\n};\n\nstruct vudc_device {\n\tstruct platform_device *pdev;\n\tstruct list_head dev_entry;\n};\n\nextern const struct attribute_group *vudc_groups[];\n\n \n\nstatic inline struct vep *to_vep(struct usb_ep *_ep)\n{\n\treturn container_of(_ep, struct vep, ep);\n}\n\nstatic inline struct vrequest *to_vrequest(\n\tstruct usb_request *_req)\n{\n\treturn container_of(_req, struct vrequest, req);\n}\n\nstatic inline struct vudc *usb_gadget_to_vudc(\n\tstruct usb_gadget *_gadget)\n{\n\treturn container_of(_gadget, struct vudc, gadget);\n}\n\nstatic inline struct vudc *ep_to_vudc(struct vep *ep)\n{\n\treturn container_of(ep->gadget, struct vudc, gadget);\n}\n\n \n\nint get_gadget_descs(struct vudc *udc);\n\n \n\nint v_tx_loop(void *data);\nvoid v_enqueue_ret_unlink(struct vudc *udc, __u32 seqnum, __u32 status);\nvoid v_enqueue_ret_submit(struct vudc *udc, struct urbp *urb_p);\n\n \n\nint v_rx_loop(void *data);\n\n \n\nvoid v_init_timer(struct vudc *udc);\nvoid v_start_timer(struct vudc *udc);\nvoid v_kick_timer(struct vudc *udc, unsigned long time);\nvoid v_stop_timer(struct vudc *udc);\n\n \n\nstruct urbp *alloc_urbp(void);\nvoid free_urbp_and_urb(struct urbp *urb_p);\n\nstruct vep *vudc_find_endpoint(struct vudc *udc, u8 address);\n\nstruct vudc_device *alloc_vudc_device(int devid);\nvoid put_vudc_device(struct vudc_device *udc_dev);\n\nint vudc_probe(struct platform_device *pdev);\nint vudc_remove(struct platform_device *pdev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}