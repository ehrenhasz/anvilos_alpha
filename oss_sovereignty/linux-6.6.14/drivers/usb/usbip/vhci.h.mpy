{
  "module_name": "vhci.h",
  "hash_id": "c70aae32465f08097bef6d0caa9ac29716affe7373df9739c95aa2e7a7a5cffe",
  "original_prompt": "Ingested from linux-6.6.14/drivers/usb/usbip/vhci.h",
  "human_readable_source": "\n \n\n#ifndef __USBIP_VHCI_H\n#define __USBIP_VHCI_H\n\n#include <linux/device.h>\n#include <linux/list.h>\n#include <linux/spinlock.h>\n#include <linux/sysfs.h>\n#include <linux/types.h>\n#include <linux/usb.h>\n#include <linux/usb/hcd.h>\n#include <linux/wait.h>\n\nstruct vhci_device {\n\tstruct usb_device *udev;\n\n\t \n\t__u32 devid;\n\n\t \n\tenum usb_device_speed speed;\n\n\t \n\t__u32 rhport;\n\n\tstruct usbip_device ud;\n\n\t \n\tspinlock_t priv_lock;\n\n\t \n\tstruct list_head priv_tx;\n\tstruct list_head priv_rx;\n\n\t \n\tstruct list_head unlink_tx;\n\tstruct list_head unlink_rx;\n\n\t \n\twait_queue_head_t waitq_tx;\n};\n\n \nstruct vhci_priv {\n\tunsigned long seqnum;\n\tstruct list_head list;\n\n\tstruct vhci_device *vdev;\n\tstruct urb *urb;\n};\n\nstruct vhci_unlink {\n\t \n\tunsigned long seqnum;\n\n\tstruct list_head list;\n\n\t \n\tunsigned long unlink_seqnum;\n};\n\nenum hub_speed {\n\tHUB_SPEED_HIGH = 0,\n\tHUB_SPEED_SUPER,\n};\n\n \n#ifdef CONFIG_USBIP_VHCI_HC_PORTS\n#define VHCI_HC_PORTS CONFIG_USBIP_VHCI_HC_PORTS\n#else\n#define VHCI_HC_PORTS 8\n#endif\n\n \n#define VHCI_PORTS\t(VHCI_HC_PORTS*2)\n\n#ifdef CONFIG_USBIP_VHCI_NR_HCS\n#define VHCI_NR_HCS CONFIG_USBIP_VHCI_NR_HCS\n#else\n#define VHCI_NR_HCS 1\n#endif\n\n#define MAX_STATUS_NAME 16\n\nstruct vhci {\n\tspinlock_t lock;\n\n\tstruct platform_device *pdev;\n\n\tstruct vhci_hcd *vhci_hcd_hs;\n\tstruct vhci_hcd *vhci_hcd_ss;\n};\n\n \nstruct vhci_hcd {\n\tstruct vhci *vhci;\n\n\tu32 port_status[VHCI_HC_PORTS];\n\n\tunsigned resuming:1;\n\tunsigned long re_timeout;\n\n\tatomic_t seqnum;\n\n\t \n\tstruct vhci_device vdev[VHCI_HC_PORTS];\n};\n\nextern int vhci_num_controllers;\nextern struct vhci *vhcis;\nextern struct attribute_group vhci_attr_group;\n\n \nvoid rh_port_connect(struct vhci_device *vdev, enum usb_device_speed speed);\n\n \nint vhci_init_attr_group(void);\nvoid vhci_finish_attr_group(void);\n\n \nstruct urb *pickup_urb_and_free_priv(struct vhci_device *vdev, __u32 seqnum);\nint vhci_rx_loop(void *data);\n\n \nint vhci_tx_loop(void *data);\n\nstatic inline __u32 port_to_rhport(__u32 port)\n{\n\treturn port % VHCI_HC_PORTS;\n}\n\nstatic inline int port_to_pdev_nr(__u32 port)\n{\n\treturn port / VHCI_PORTS;\n}\n\nstatic inline struct vhci_hcd *hcd_to_vhci_hcd(struct usb_hcd *hcd)\n{\n\treturn (struct vhci_hcd *) (hcd->hcd_priv);\n}\n\nstatic inline struct device *hcd_dev(struct usb_hcd *hcd)\n{\n\treturn (hcd)->self.controller;\n}\n\nstatic inline const char *hcd_name(struct usb_hcd *hcd)\n{\n\treturn (hcd)->self.bus_name;\n}\n\nstatic inline struct usb_hcd *vhci_hcd_to_hcd(struct vhci_hcd *vhci_hcd)\n{\n\treturn container_of((void *) vhci_hcd, struct usb_hcd, hcd_priv);\n}\n\nstatic inline struct vhci_hcd *vdev_to_vhci_hcd(struct vhci_device *vdev)\n{\n\treturn container_of((void *)(vdev - vdev->rhport), struct vhci_hcd, vdev);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}