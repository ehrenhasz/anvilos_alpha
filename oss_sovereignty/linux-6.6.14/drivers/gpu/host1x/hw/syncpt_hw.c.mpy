{
  "module_name": "syncpt_hw.c",
  "hash_id": "474a56ea87cea044e229db008550700cc8e960fee50eecfd80e9f593746f2341",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/host1x/hw/syncpt_hw.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n\n#include \"../dev.h\"\n#include \"../syncpt.h\"\n\n \nstatic void syncpt_restore(struct host1x_syncpt *sp)\n{\n\tu32 min = host1x_syncpt_read_min(sp);\n\tstruct host1x *host = sp->host;\n\n\thost1x_sync_writel(host, min, HOST1X_SYNC_SYNCPT(sp->id));\n}\n\n \nstatic void syncpt_restore_wait_base(struct host1x_syncpt *sp)\n{\n#if HOST1X_HW < 7\n\tstruct host1x *host = sp->host;\n\n\thost1x_sync_writel(host, sp->base_val,\n\t\t\t   HOST1X_SYNC_SYNCPT_BASE(sp->id));\n#endif\n}\n\n \nstatic void syncpt_read_wait_base(struct host1x_syncpt *sp)\n{\n#if HOST1X_HW < 7\n\tstruct host1x *host = sp->host;\n\n\tsp->base_val =\n\t\thost1x_sync_readl(host, HOST1X_SYNC_SYNCPT_BASE(sp->id));\n#endif\n}\n\n \nstatic u32 syncpt_load(struct host1x_syncpt *sp)\n{\n\tstruct host1x *host = sp->host;\n\tu32 old, live;\n\n\t \n\tdo {\n\t\told = host1x_syncpt_read_min(sp);\n\t\tlive = host1x_sync_readl(host, HOST1X_SYNC_SYNCPT(sp->id));\n\t} while ((u32)atomic_cmpxchg(&sp->min_val, old, live) != old);\n\n\tif (!host1x_syncpt_check_max(sp, live))\n\t\tdev_err(host->dev, \"%s failed: id=%u, min=%d, max=%d\\n\",\n\t\t\t__func__, sp->id, host1x_syncpt_read_min(sp),\n\t\t\thost1x_syncpt_read_max(sp));\n\n\treturn live;\n}\n\n \nstatic int syncpt_cpu_incr(struct host1x_syncpt *sp)\n{\n\tstruct host1x *host = sp->host;\n\tu32 reg_offset = sp->id / 32;\n\n\tif (!host1x_syncpt_client_managed(sp) &&\n\t    host1x_syncpt_idle(sp))\n\t\treturn -EINVAL;\n\n\thost1x_sync_writel(host, BIT(sp->id % 32),\n\t\t\t   HOST1X_SYNC_SYNCPT_CPU_INCR(reg_offset));\n\twmb();\n\n\treturn 0;\n}\n\n \nstatic void syncpt_assign_to_channel(struct host1x_syncpt *sp,\n\t\t\t\t  struct host1x_channel *ch)\n{\n#if HOST1X_HW >= 6\n\tstruct host1x *host = sp->host;\n\n\thost1x_sync_writel(host,\n\t\t\t   HOST1X_SYNC_SYNCPT_CH_APP_CH(ch ? ch->id : 0xff),\n\t\t\t   HOST1X_SYNC_SYNCPT_CH_APP(sp->id));\n#endif\n}\n\n \nstatic void syncpt_enable_protection(struct host1x *host)\n{\n#if HOST1X_HW >= 6\n\tif (!host->hv_regs)\n\t\treturn;\n\n\thost1x_hypervisor_writel(host, HOST1X_HV_SYNCPT_PROT_EN_CH_EN,\n\t\t\t\t HOST1X_HV_SYNCPT_PROT_EN);\n#endif\n}\n\nstatic const struct host1x_syncpt_ops host1x_syncpt_ops = {\n\t.restore = syncpt_restore,\n\t.restore_wait_base = syncpt_restore_wait_base,\n\t.load_wait_base = syncpt_read_wait_base,\n\t.load = syncpt_load,\n\t.cpu_incr = syncpt_cpu_incr,\n\t.assign_to_channel = syncpt_assign_to_channel,\n\t.enable_protection = syncpt_enable_protection,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}