{
  "module_name": "ipu-ic-csc.c",
  "hash_id": "b8f0b912628b531ba7f093131c85b77aa5c7325897e53881c677ffa1b62628ba",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/ipu-v3/ipu-ic-csc.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/init.h>\n#include <linux/errno.h>\n#include <linux/err.h>\n#include <linux/sizes.h>\n#include \"ipu-prv.h\"\n\n#define QUANT_MAP(q)\t\t\t\t\t\\\n\t((q) == V4L2_QUANTIZATION_FULL_RANGE ||\t\t\\\n\t (q) == V4L2_QUANTIZATION_DEFAULT ? 0 : 1)\n\n \nstatic const struct ipu_ic_csc_params identity = {\n\t.coeff = {\n\t\t{  128,    0,    0, },\n\t\t{    0,  128,    0, },\n\t\t{    0,    0,  128, },\n\t},\n\t.offset = { 0, 0, 0, },\n\t.scale = 2,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbf2rgbl = {\n\t.coeff = {\n\t\t{  220,    0,    0, },\n\t\t{    0,  220,    0, },\n\t\t{    0,    0,  220, },\n\t},\n\t.offset = { 64, 64, 64, },\n\t.scale = 1,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbl2rgbf = {\n\t.coeff = {\n\t\t{  149,    0,    0, },\n\t\t{    0,  149,    0, },\n\t\t{    0,    0,  149, },\n\t},\n\t.offset = { -37, -37, -37, },\n\t.scale = 2,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvf2yuvl = {\n\t.coeff = {\n\t\t{  220,    0,    0, },\n\t\t{    0,  225,    0, },\n\t\t{    0,    0,  225, },\n\t},\n\t.offset = { 64, 62, 62, },\n\t.scale = 1,\n\t.sat = true,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvl2yuvf = {\n\t.coeff = {\n\t\t{  149,    0,    0, },\n\t\t{    0,  146,    0, },\n\t\t{    0,    0,  146, },\n\t},\n\t.offset = { -37, -35, -35, },\n\t.scale = 2,\n};\n\nstatic const struct ipu_ic_csc_params *rgb2rgb[] = {\n\t&identity,\n\t&rgbf2rgbl,\n\t&rgbl2rgbf,\n\t&identity,\n};\n\nstatic const struct ipu_ic_csc_params *yuv2yuv[] = {\n\t&identity,\n\t&yuvf2yuvl,\n\t&yuvl2yuvf,\n\t&identity,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbf2yuvf_601 = {\n\t.coeff = {\n\t\t{   77,  150,   29, },\n\t\t{  -43,  -85,  128, },\n\t\t{  128, -107,  -21, },\n\t},\n\t.offset = { 0, 512, 512, },\n\t.scale = 1,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbf2yuvl_601 = {\n\t.coeff = {\n\t\t{   66,  129,   25, },\n\t\t{  -38,  -74,  112, },\n\t\t{  112,  -94,  -18, },\n\t},\n\t.offset = { 64, 512, 512, },\n\t.scale = 1,\n\t.sat = true,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbl2yuvf_601 = {\n\t.coeff = {\n\t\t{   89,  175,   34, },\n\t\t{  -50,  -99,  149, },\n\t\t{  149, -125,  -24, },\n\t},\n\t.offset = { -75, 512, 512, },\n\t.scale = 1,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbl2yuvl_601 = {\n\t.coeff = {\n\t\t{   77,  150,   29, },\n\t\t{  -44,  -87,  131, },\n\t\t{  131, -110,  -21, },\n\t},\n\t.offset = { 0, 512, 512, },\n\t.scale = 1,\n\t.sat = true,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvf2rgbf_601 = {\n\t.coeff = {\n\t\t{  128,    0,  179, },\n\t\t{  128,  -44,  -91, },\n\t\t{  128,  227,    0, },\n\t},\n\t.offset = { -359, 271, -454, },\n\t.scale = 2,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvf2rgbl_601 = {\n\t.coeff = {\n\t\t{  110,    0,  154, },\n\t\t{  110,  -38,  -78, },\n\t\t{  110,  195,    0, },\n\t},\n\t.offset = { -276, 265, -358, },\n\t.scale = 2,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvl2rgbf_601 = {\n\t.coeff = {\n\t\t{   75,    0,  102, },\n\t\t{   75,  -25,  -52, },\n\t\t{   75,  129,    0, },\n\t},\n\t.offset = { -223, 136, -277, },\n\t.scale = 3,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvl2rgbl_601 = {\n\t.coeff = {\n\t\t{  128,    0,  175, },\n\t\t{  128,  -43,  -89, },\n\t\t{  128,  222,    0, },\n\t},\n\t.offset = { -351, 265, -443, },\n\t.scale = 2,\n};\n\nstatic const struct ipu_ic_csc_params *rgb2yuv_601[] = {\n\t&rgbf2yuvf_601,\n\t&rgbf2yuvl_601,\n\t&rgbl2yuvf_601,\n\t&rgbl2yuvl_601,\n};\n\nstatic const struct ipu_ic_csc_params *yuv2rgb_601[] = {\n\t&yuvf2rgbf_601,\n\t&yuvf2rgbl_601,\n\t&yuvl2rgbf_601,\n\t&yuvl2rgbl_601,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbf2yuvf_709 = {\n\t.coeff = {\n\t\t{  54,  183,  19 },\n\t\t{ -29,  -99, 128 },\n\t\t{ 128, -116, -12 },\n\t},\n\t.offset = { 0, 512, 512 },\n\t.scale = 1,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbf2yuvl_709 = {\n\t.coeff = {\n\t\t{   47,  157,   16, },\n\t\t{  -26,  -87,  112, },\n\t\t{  112, -102,  -10, },\n\t},\n\t.offset = { 64, 512, 512, },\n\t.scale = 1,\n\t.sat = true,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbl2yuvf_709 = {\n\t.coeff = {\n\t\t{   63,  213,   22, },\n\t\t{  -34, -115,  149, },\n\t\t{  149, -135,  -14, },\n\t},\n\t.offset = { -75, 512, 512, },\n\t.scale = 1,\n};\n\n \nstatic const struct ipu_ic_csc_params rgbl2yuvl_709 = {\n\t.coeff = {\n\t\t{   54,  183,   18, },\n\t\t{  -30, -101,  131, },\n\t\t{  131, -119,  -12, },\n\t},\n\t.offset = { 0, 512, 512, },\n\t.scale = 1,\n\t.sat = true,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvf2rgbf_709 = {\n\t.coeff = {\n\t\t{  128,   0, 202 },\n\t\t{  128, -24, -60 },\n\t\t{  128, 238,   0 },\n\t},\n\t.offset = { -403, 168, -475 },\n\t.scale = 2,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvf2rgbl_709 = {\n\t.coeff = {\n\t\t{  110,    0,  173, },\n\t\t{  110,  -21,  -51, },\n\t\t{  110,  204,    0, },\n\t},\n\t.offset = { -314, 176, -376, },\n\t.scale = 2,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvl2rgbf_709 = {\n\t.coeff = {\n\t\t{   75,    0,  115, },\n\t\t{   75,  -14,  -34, },\n\t\t{   75,  135,    0, },\n\t},\n\t.offset = { -248, 77, -289, },\n\t.scale = 3,\n};\n\n \nstatic const struct ipu_ic_csc_params yuvl2rgbl_709 = {\n\t.coeff = {\n\t\t{  128,    0,  197, },\n\t\t{  128,  -23,  -59, },\n\t\t{  128,  232,    0, },\n\t},\n\t.offset = { -394, 164, -464, },\n\t.scale = 2,\n};\n\nstatic const struct ipu_ic_csc_params *rgb2yuv_709[] = {\n\t&rgbf2yuvf_709,\n\t&rgbf2yuvl_709,\n\t&rgbl2yuvf_709,\n\t&rgbl2yuvl_709,\n};\n\nstatic const struct ipu_ic_csc_params *yuv2rgb_709[] = {\n\t&yuvf2rgbf_709,\n\t&yuvf2rgbl_709,\n\t&yuvl2rgbf_709,\n\t&yuvl2rgbl_709,\n};\n\nstatic int calc_csc_coeffs(struct ipu_ic_csc *csc)\n{\n\tconst struct ipu_ic_csc_params **params_tbl;\n\tint tbl_idx;\n\n\ttbl_idx = (QUANT_MAP(csc->in_cs.quant) << 1) |\n\t\tQUANT_MAP(csc->out_cs.quant);\n\n\tif (csc->in_cs.cs == csc->out_cs.cs) {\n\t\tcsc->params = (csc->in_cs.cs == IPUV3_COLORSPACE_YUV) ?\n\t\t\t*yuv2yuv[tbl_idx] : *rgb2rgb[tbl_idx];\n\n\t\treturn 0;\n\t}\n\n\t \n\n\tswitch (csc->out_cs.enc) {\n\tcase V4L2_YCBCR_ENC_601:\n\t\tparams_tbl = (csc->in_cs.cs == IPUV3_COLORSPACE_YUV) ?\n\t\t\tyuv2rgb_601 : rgb2yuv_601;\n\t\tbreak;\n\tcase V4L2_YCBCR_ENC_709:\n\t\tparams_tbl = (csc->in_cs.cs == IPUV3_COLORSPACE_YUV) ?\n\t\t\tyuv2rgb_709 : rgb2yuv_709;\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOTSUPP;\n\t}\n\n\tcsc->params = *params_tbl[tbl_idx];\n\n\treturn 0;\n}\n\nint __ipu_ic_calc_csc(struct ipu_ic_csc *csc)\n{\n\treturn calc_csc_coeffs(csc);\n}\nEXPORT_SYMBOL_GPL(__ipu_ic_calc_csc);\n\nint ipu_ic_calc_csc(struct ipu_ic_csc *csc,\n\t\t    enum v4l2_ycbcr_encoding in_enc,\n\t\t    enum v4l2_quantization in_quant,\n\t\t    enum ipu_color_space in_cs,\n\t\t    enum v4l2_ycbcr_encoding out_enc,\n\t\t    enum v4l2_quantization out_quant,\n\t\t    enum ipu_color_space out_cs)\n{\n\tipu_ic_fill_colorspace(&csc->in_cs, in_enc, in_quant, in_cs);\n\tipu_ic_fill_colorspace(&csc->out_cs, out_enc, out_quant, out_cs);\n\n\treturn __ipu_ic_calc_csc(csc);\n}\nEXPORT_SYMBOL_GPL(ipu_ic_calc_csc);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}