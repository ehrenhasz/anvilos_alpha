{
  "module_name": "timer.h",
  "hash_id": "ccbed061b002310155a0b4f93b9fb70dc6c55dcd8fe9c4877cde305724e52113",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/include/nvkm/subdev/timer.h",
  "human_readable_source": " \n#ifndef __NVKM_TIMER_H__\n#define __NVKM_TIMER_H__\n#include <core/subdev.h>\n\nstruct nvkm_alarm {\n\tstruct list_head head;\n\tstruct list_head exec;\n\tu64 timestamp;\n\tvoid (*func)(struct nvkm_alarm *);\n};\n\nstatic inline void\nnvkm_alarm_init(struct nvkm_alarm *alarm, void (*func)(struct nvkm_alarm *))\n{\n\tINIT_LIST_HEAD(&alarm->head);\n\talarm->func = func;\n}\n\nstruct nvkm_timer {\n\tconst struct nvkm_timer_func *func;\n\tstruct nvkm_subdev subdev;\n\n\tstruct list_head alarms;\n\tspinlock_t lock;\n};\n\nu64 nvkm_timer_read(struct nvkm_timer *);\nvoid nvkm_timer_alarm(struct nvkm_timer *, u32 nsec, struct nvkm_alarm *);\n\nstruct nvkm_timer_wait {\n\tstruct nvkm_timer *tmr;\n\tu64 limit;\n\tu64 time0;\n\tu64 time1;\n\tint reads;\n};\n\nvoid nvkm_timer_wait_init(struct nvkm_device *, u64 nsec,\n\t\t\t  struct nvkm_timer_wait *);\ns64 nvkm_timer_wait_test(struct nvkm_timer_wait *);\n\n \n#define NVKM_DELAY _warn = false;\n#define nvkm_nsec(d,n,cond...) ({                                              \\\n\tstruct nvkm_timer_wait _wait;                                          \\\n\tbool _warn = true;                                                     \\\n\ts64 _taken = 0;                                                        \\\n                                                                               \\\n\tnvkm_timer_wait_init((d), (n), &_wait);                                \\\n\tdo {                                                                   \\\n\t\tcond                                                           \\\n\t} while ((_taken = nvkm_timer_wait_test(&_wait)) >= 0);                \\\n                                                                               \\\n\tif (_warn && _taken < 0)                                               \\\n\t\tdev_WARN(_wait.tmr->subdev.device->dev, \"timeout\\n\");          \\\n\t_taken;                                                                \\\n})\n#define nvkm_usec(d, u, cond...) nvkm_nsec((d), (u) * 1000ULL, ##cond)\n#define nvkm_msec(d, m, cond...) nvkm_usec((d), (m) * 1000ULL, ##cond)\n\n#define nvkm_wait_nsec(d,n,addr,mask,data)                                     \\\n\tnvkm_nsec(d, n,                                                        \\\n\t\tif ((nvkm_rd32(d, (addr)) & (mask)) == (data))                 \\\n\t\t\tbreak;                                                 \\\n\t\t)\n#define nvkm_wait_usec(d,u,addr,mask,data)                                     \\\n\tnvkm_wait_nsec((d), (u) * 1000, (addr), (mask), (data))\n#define nvkm_wait_msec(d,m,addr,mask,data)                                     \\\n\tnvkm_wait_usec((d), (m) * 1000, (addr), (mask), (data))\n\nint nv04_timer_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_timer **);\nint nv40_timer_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_timer **);\nint nv41_timer_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_timer **);\nint gk20a_timer_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_timer **);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}