{
  "module_name": "mmu.h",
  "hash_id": "8c550832e76768edfc2e72a5cba1ade6b17d47a9f2f6e78465f9bd9915b8a07f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/include/nvkm/subdev/mmu.h",
  "human_readable_source": " \n#ifndef __NVKM_MMU_H__\n#define __NVKM_MMU_H__\n#include <core/subdev.h>\n\nstruct nvkm_vma {\n\tstruct list_head head;\n\tstruct rb_node tree;\n\tu64 addr;\n\tu64 size:50;\n\tbool mapref:1;  \n\tbool sparse:1;  \n#define NVKM_VMA_PAGE_NONE 7\n\tu8   page:3;  \n\tu8   refd:3;  \n\tbool used:1;  \n\tbool part:1;  \n\tbool busy:1;  \n\tbool mapped:1;  \n\tbool no_comp:1;  \n\tstruct nvkm_memory *memory;  \n\tstruct nvkm_tags *tags;  \n};\n\nstruct nvkm_vmm {\n\tconst struct nvkm_vmm_func *func;\n\tstruct nvkm_mmu *mmu;\n\tconst char *name;\n\tu32 debug;\n\tstruct kref kref;\n\n\tstruct {\n\t\tstruct mutex vmm;\n\t\tstruct mutex ref;\n\t\tstruct mutex map;\n\t} mutex;\n\n\tu64 start;\n\tu64 limit;\n\tstruct {\n\t\tstruct {\n\t\t\tu64 addr;\n\t\t\tu64 size;\n\t\t} p;\n\t\tstruct {\n\t\t\tu64 addr;\n\t\t\tu64 size;\n\t\t} n;\n\t\tbool raw;\n\t} managed;\n\n\tstruct nvkm_vmm_pt *pd;\n\tstruct list_head join;\n\n\tstruct list_head list;\n\tstruct rb_root free;\n\tstruct rb_root root;\n\n\tbool bootstrapped;\n\tatomic_t engref[NVKM_SUBDEV_NR];\n\n\tdma_addr_t null;\n\tvoid *nullp;\n\n\tbool replay;\n};\n\nint nvkm_vmm_new(struct nvkm_device *, u64 addr, u64 size, void *argv, u32 argc,\n\t\t struct lock_class_key *, const char *name, struct nvkm_vmm **);\nstruct nvkm_vmm *nvkm_vmm_ref(struct nvkm_vmm *);\nvoid nvkm_vmm_unref(struct nvkm_vmm **);\nint nvkm_vmm_boot(struct nvkm_vmm *);\nint nvkm_vmm_join(struct nvkm_vmm *, struct nvkm_memory *inst);\nvoid nvkm_vmm_part(struct nvkm_vmm *, struct nvkm_memory *inst);\nint nvkm_vmm_get(struct nvkm_vmm *, u8 page, u64 size, struct nvkm_vma **);\nvoid nvkm_vmm_put(struct nvkm_vmm *, struct nvkm_vma **);\n\nstruct nvkm_vmm_map {\n\tstruct nvkm_memory *memory;\n\tu64 offset;\n\n\tstruct nvkm_mm_node *mem;\n\tstruct scatterlist *sgl;\n\tdma_addr_t *dma;\n\tu64 *pfn;\n\tu64 off;\n\n\tconst struct nvkm_vmm_page *page;\n\n\tbool no_comp;\n\tstruct nvkm_tags *tags;\n\tu64 next;\n\tu64 type;\n\tu64 ctag;\n};\n\nint nvkm_vmm_map(struct nvkm_vmm *, struct nvkm_vma *, void *argv, u32 argc,\n\t\t struct nvkm_vmm_map *);\nvoid nvkm_vmm_unmap(struct nvkm_vmm *, struct nvkm_vma *);\n\nstruct nvkm_memory *nvkm_umem_search(struct nvkm_client *, u64);\nstruct nvkm_vmm *nvkm_uvmm_search(struct nvkm_client *, u64 handle);\n\nstruct nvkm_mmu {\n\tconst struct nvkm_mmu_func *func;\n\tstruct nvkm_subdev subdev;\n\n\tu8  dma_bits;\n\n\tint heap_nr;\n\tstruct {\n#define NVKM_MEM_VRAM                                                      0x01\n#define NVKM_MEM_HOST                                                      0x02\n#define NVKM_MEM_COMP                                                      0x04\n#define NVKM_MEM_DISP                                                      0x08\n\t\tu8  type;\n\t\tu64 size;\n\t} heap[4];\n\n\tint type_nr;\n\tstruct {\n#define NVKM_MEM_KIND                                                      0x10\n#define NVKM_MEM_MAPPABLE                                                  0x20\n#define NVKM_MEM_COHERENT                                                  0x40\n#define NVKM_MEM_UNCACHED                                                  0x80\n\t\tu8 type;\n\t\tu8 heap;\n\t} type[16];\n\n\tstruct nvkm_vmm *vmm;\n\n\tstruct {\n\t\tstruct mutex mutex;\n\t\tstruct list_head list;\n\t} ptc, ptp;\n\n\tstruct mutex mutex;  \n\n\tstruct nvkm_device_oclass user;\n};\n\nint nv04_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint nv41_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint nv44_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint nv50_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint g84_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint mcp77_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gf100_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gk104_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gk20a_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gm200_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gm20b_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gp100_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gp10b_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint gv100_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\nint tu102_mmu_new(struct nvkm_device *, enum nvkm_subdev_type, int inst, struct nvkm_mmu **);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}