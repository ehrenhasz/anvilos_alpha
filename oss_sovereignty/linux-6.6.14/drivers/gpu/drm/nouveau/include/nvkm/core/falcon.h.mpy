{
  "module_name": "falcon.h",
  "hash_id": "0c09b73cb0dcb00bf01959af68f8a4e726cdaad829f8aa44846a5b78f4ef69ac",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/include/nvkm/core/falcon.h",
  "human_readable_source": "#ifndef __NVKM_FALCON_H__\n#define __NVKM_FALCON_H__\n#include <core/firmware.h>\n#include <engine/falcon.h>\n\nenum nvkm_falcon_mem {\n\tIMEM,\n\tDMEM,\n\tEMEM,\n};\n\nstatic inline const char *\nnvkm_falcon_mem(enum nvkm_falcon_mem mem)\n{\n\tswitch (mem) {\n\tcase IMEM: return \"imem\";\n\tcase DMEM: return \"dmem\";\n\tcase EMEM: return \"emem\";\n\tdefault:\n\t\tWARN_ON(1);\n\t\treturn \"?mem\";\n\t}\n}\n\nstruct nvkm_falcon_func_pio {\n\tint min;\n\tint max;\n\tvoid (*wr_init)(struct nvkm_falcon *, u8 port, bool sec, u32 mem_base);\n\tvoid (*wr)(struct nvkm_falcon *, u8 port, const u8 *img, int len, u16 tag);\n\tvoid (*rd_init)(struct nvkm_falcon *, u8 port, u32 mem_base);\n\tvoid (*rd)(struct nvkm_falcon *, u8 port, const u8 *img, int len);\n};\n\nstruct nvkm_falcon_func_dma {\n\tint (*init)(struct nvkm_falcon *, u64 dma_addr, int xfer_len,\n\t\t    enum nvkm_falcon_mem, bool sec, u32 *cmd);\n\tvoid (*xfer)(struct nvkm_falcon *, u32 mem_base, u32 dma_base, u32 cmd);\n\tbool (*done)(struct nvkm_falcon *);\n};\n\nint nvkm_falcon_ctor(const struct nvkm_falcon_func *, struct nvkm_subdev *owner,\n\t\t     const char *name, u32 addr, struct nvkm_falcon *);\nvoid nvkm_falcon_dtor(struct nvkm_falcon *);\nint nvkm_falcon_reset(struct nvkm_falcon *);\nint nvkm_falcon_pio_wr(struct nvkm_falcon *, const u8 *img, u32 img_base, u8 port,\n\t\t       enum nvkm_falcon_mem mem_type, u32 mem_base, int len, u16 tag, bool sec);\nint nvkm_falcon_pio_rd(struct nvkm_falcon *, u8 port, enum nvkm_falcon_mem type, u32 mem_base,\n\t\t       const u8 *img, u32 img_base, int len);\nint nvkm_falcon_dma_wr(struct nvkm_falcon *, const u8 *img, u64 dma_addr, u32 dma_base,\n\t\t       enum nvkm_falcon_mem mem_type, u32 mem_base, int len, bool sec);\n\nint gm200_flcn_reset_wait_mem_scrubbing(struct nvkm_falcon *);\nint gm200_flcn_disable(struct nvkm_falcon *);\nint gm200_flcn_enable(struct nvkm_falcon *);\nvoid gm200_flcn_bind_inst(struct nvkm_falcon *, int, u64);\nint gm200_flcn_bind_stat(struct nvkm_falcon *, bool);\nextern const struct nvkm_falcon_func_pio gm200_flcn_imem_pio;\nextern const struct nvkm_falcon_func_pio gm200_flcn_dmem_pio;\nvoid gm200_flcn_tracepc(struct nvkm_falcon *);\n\nint gp102_flcn_reset_eng(struct nvkm_falcon *);\nextern const struct nvkm_falcon_func_pio gp102_flcn_emem_pio;\n\nint ga102_flcn_select(struct nvkm_falcon *);\nint ga102_flcn_reset_prep(struct nvkm_falcon *);\nint ga102_flcn_reset_wait_mem_scrubbing(struct nvkm_falcon *);\nextern const struct nvkm_falcon_func_dma ga102_flcn_dma;\n\nvoid nvkm_falcon_v1_load_imem(struct nvkm_falcon *,\n\t\t\t      void *, u32, u32, u16, u8, bool);\nvoid nvkm_falcon_v1_load_dmem(struct nvkm_falcon *, void *, u32, u32, u8);\nvoid nvkm_falcon_v1_start(struct nvkm_falcon *);\n\n#define FLCN_PRINTK(f,l,p,fmt,a...) ({                                                          \\\n\tif ((f)->owner->name != (f)->name)                                                      \\\n\t\tnvkm_printk___((f)->owner, (f)->user, NV_DBG_##l, p, \"%s:\"fmt, (f)->name, ##a); \\\n\telse                                                                                    \\\n\t\tnvkm_printk___((f)->owner, (f)->user, NV_DBG_##l, p, fmt, ##a);                 \\\n})\n#define FLCN_DBG(f,fmt,a...) FLCN_PRINTK((f), DEBUG, info, \" \"fmt\"\\n\", ##a)\n#define FLCN_ERR(f,fmt,a...) FLCN_PRINTK((f), ERROR, err, \" \"fmt\"\\n\", ##a)\n#define FLCN_ERRON(f,c,fmt,a...) \\\n\t({ bool _cond = (c); _cond ? FLCN_ERR(f, fmt, ##a) : FLCN_DBG(f, fmt, ##a); _cond; })\n\n\nstruct nvkm_falcon_fw {\n\tconst struct nvkm_falcon_fw_func {\n\t\tint (*signature)(struct nvkm_falcon_fw *, u32 *sig_base_src);\n\t\tint (*reset)(struct nvkm_falcon_fw *);\n\t\tint (*setup)(struct nvkm_falcon_fw *);\n\t\tint (*load)(struct nvkm_falcon_fw *);\n\t\tint (*load_bld)(struct nvkm_falcon_fw *);\n\t\tint (*boot)(struct nvkm_falcon_fw *,\n\t\t\t    u32 *mbox0, u32 *mbox1, u32 mbox0_ok, u32 irqsclr);\n\t} *func;\n\tstruct nvkm_firmware fw;\n\n\tu32 sig_base_prd;\n\tu32 sig_base_dbg;\n\tu32 sig_base_img;\n\tu32 sig_size;\n\tint sig_nr;\n\tu8 *sigs;\n\tu32 fuse_ver;\n\tu32 engine_id;\n\tu32 ucode_id;\n\n\tu32 nmem_base_img;\n\tu32 nmem_base;\n\tu32 nmem_size;\n\n\tu32 imem_base_img;\n\tu32 imem_base;\n\tu32 imem_size;\n\n\tu32 dmem_base_img;\n\tu32 dmem_base;\n\tu32 dmem_size;\n\tu32 dmem_sign;\n\n\tu8 *boot;\n\tu32 boot_size;\n\tu32 boot_addr;\n\n\tstruct nvkm_falcon *falcon;\n\tstruct nvkm_memory *inst;\n\tstruct nvkm_vmm *vmm;\n\tstruct nvkm_vma *vma;\n};\n\nint nvkm_falcon_fw_ctor(const struct nvkm_falcon_fw_func *, const char *name, struct nvkm_device *,\n\t\t        bool bl, const void *src, u32 len, struct nvkm_falcon *,\n\t\t\tstruct nvkm_falcon_fw *);\nint nvkm_falcon_fw_ctor_hs(const struct nvkm_falcon_fw_func *, const char *name,\n\t\t\t   struct nvkm_subdev *, const char *bl, const char *img, int ver,\n\t\t\t   struct nvkm_falcon *falcon, struct nvkm_falcon_fw *fw);\nint nvkm_falcon_fw_ctor_hs_v2(const struct nvkm_falcon_fw_func *, const char *name,\n\t\t\t      struct nvkm_subdev *, const char *img, int ver, struct nvkm_falcon *,\n\t\t\t      struct nvkm_falcon_fw *);\nint nvkm_falcon_fw_sign(struct nvkm_falcon_fw *, u32 sig_base_img, u32 sig_size, const u8 *sigs,\n\t\t\tint sig_nr_prd, u32 sig_base_prd, int sig_nr_dbg, u32 sig_base_dbg);\nint nvkm_falcon_fw_patch(struct nvkm_falcon_fw *);\nvoid nvkm_falcon_fw_dtor(struct nvkm_falcon_fw *);\nint nvkm_falcon_fw_oneinit(struct nvkm_falcon_fw *, struct nvkm_falcon *, struct nvkm_vmm *,\n\t\t\t   struct nvkm_memory *inst);\nint nvkm_falcon_fw_boot(struct nvkm_falcon_fw *, struct nvkm_subdev *user,\n\t\t\tbool release, u32 *pmbox0, u32 *pmbox1, u32 mbox0_ok, u32 irqsclr);\n\nextern const struct nvkm_falcon_fw_func gm200_flcn_fw;\nint gm200_flcn_fw_signature(struct nvkm_falcon_fw *, u32 *);\nint gm200_flcn_fw_reset(struct nvkm_falcon_fw *);\nint gm200_flcn_fw_load(struct nvkm_falcon_fw *);\nint gm200_flcn_fw_boot(struct nvkm_falcon_fw *, u32 *, u32 *, u32, u32);\n\nint ga100_flcn_fw_signature(struct nvkm_falcon_fw *, u32 *);\n\nextern const struct nvkm_falcon_fw_func ga102_flcn_fw;\nint ga102_flcn_fw_load(struct nvkm_falcon_fw *);\nint ga102_flcn_fw_boot(struct nvkm_falcon_fw *, u32 *, u32 *, u32, u32);\n\n#define FLCNFW_PRINTK(f,l,p,fmt,a...) FLCN_PRINTK((f)->falcon, l, p, \"%s: \"fmt, (f)->fw.name, ##a)\n#define FLCNFW_DBG(f,fmt,a...) FLCNFW_PRINTK((f), DEBUG, info, fmt\"\\n\", ##a)\n#define FLCNFW_ERR(f,fmt,a...) FLCNFW_PRINTK((f), ERROR, err, fmt\"\\n\", ##a)\n\n \nstruct nvfw_falcon_msg {\n\tu8 unit_id;\n\tu8 size;\n\tu8 ctrl_flags;\n\tu8 seq_id;\n};\n\n#define nvfw_falcon_cmd nvfw_falcon_msg\n#define NV_FALCON_CMD_UNIT_ID_REWIND                                       0x00\n\nstruct nvkm_falcon_qmgr;\nint nvkm_falcon_qmgr_new(struct nvkm_falcon *, struct nvkm_falcon_qmgr **);\nvoid nvkm_falcon_qmgr_del(struct nvkm_falcon_qmgr **);\n\ntypedef int\n(*nvkm_falcon_qmgr_callback)(void *priv, struct nvfw_falcon_msg *);\n\nstruct nvkm_falcon_cmdq;\nint nvkm_falcon_cmdq_new(struct nvkm_falcon_qmgr *, const char *name,\n\t\t\t struct nvkm_falcon_cmdq **);\nvoid nvkm_falcon_cmdq_del(struct nvkm_falcon_cmdq **);\nvoid nvkm_falcon_cmdq_init(struct nvkm_falcon_cmdq *,\n\t\t\t   u32 index, u32 offset, u32 size);\nvoid nvkm_falcon_cmdq_fini(struct nvkm_falcon_cmdq *);\nint nvkm_falcon_cmdq_send(struct nvkm_falcon_cmdq *, struct nvfw_falcon_cmd *,\n\t\t\t  nvkm_falcon_qmgr_callback, void *priv,\n\t\t\t  unsigned long timeout_jiffies);\n\nstruct nvkm_falcon_msgq;\nint nvkm_falcon_msgq_new(struct nvkm_falcon_qmgr *, const char *name,\n\t\t\t struct nvkm_falcon_msgq **);\nvoid nvkm_falcon_msgq_del(struct nvkm_falcon_msgq **);\nvoid nvkm_falcon_msgq_init(struct nvkm_falcon_msgq *,\n\t\t\t   u32 index, u32 offset, u32 size);\nbool nvkm_falcon_msgq_empty(struct nvkm_falcon_msgq *);\nint nvkm_falcon_msgq_recv_initmsg(struct nvkm_falcon_msgq *, void *, u32 size);\nvoid nvkm_falcon_msgq_recv(struct nvkm_falcon_msgq *);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}