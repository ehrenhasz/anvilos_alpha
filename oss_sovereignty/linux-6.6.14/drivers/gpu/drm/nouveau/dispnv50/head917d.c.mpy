{
  "module_name": "head917d.c",
  "hash_id": "53f6c3de5e6b096cba5c0bac4184b300089fa1f733d51ad8b815b8a6be58ba93",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/dispnv50/head917d.c",
  "human_readable_source": " \n#include \"head.h\"\n#include \"core.h\"\n\n#include \"nvif/push.h\"\n#include <nvif/push507c.h>\n\n#include <nvhw/class/cl917d.h>\n\nstatic int\nhead917d_dither(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 2)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NV917D, HEAD_SET_DITHER_CONTROL(i),\n\t\t  NVVAL(NV917D, HEAD_SET_DITHER_CONTROL, ENABLE, asyh->dither.enable) |\n\t\t  NVVAL(NV917D, HEAD_SET_DITHER_CONTROL, BITS, asyh->dither.bits) |\n\t\t  NVVAL(NV917D, HEAD_SET_DITHER_CONTROL, MODE, asyh->dither.mode) |\n\t\t  NVVAL(NV917D, HEAD_SET_DITHER_CONTROL, PHASE, 0));\n\treturn 0;\n}\n\nstatic int\nhead917d_base(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tu32 bounds = 0;\n\tint ret;\n\n\tif (asyh->base.cpp) {\n\t\tswitch (asyh->base.cpp) {\n\t\tcase 8: bounds |= NVDEF(NV917D, HEAD_SET_BASE_CHANNEL_USAGE_BOUNDS, PIXEL_DEPTH, BPP_64); break;\n\t\tcase 4: bounds |= NVDEF(NV917D, HEAD_SET_BASE_CHANNEL_USAGE_BOUNDS, PIXEL_DEPTH, BPP_32); break;\n\t\tcase 2: bounds |= NVDEF(NV917D, HEAD_SET_BASE_CHANNEL_USAGE_BOUNDS, PIXEL_DEPTH, BPP_16); break;\n\t\tcase 1: bounds |= NVDEF(NV917D, HEAD_SET_BASE_CHANNEL_USAGE_BOUNDS, PIXEL_DEPTH, BPP_8); break;\n\t\tdefault:\n\t\t\tWARN_ON(1);\n\t\t\tbreak;\n\t\t}\n\t\tbounds |= NVDEF(NV917D, HEAD_SET_BASE_CHANNEL_USAGE_BOUNDS, USABLE, TRUE);\n\t\tbounds |= NVDEF(NV917D, HEAD_SET_BASE_CHANNEL_USAGE_BOUNDS, BASE_LUT, USAGE_1025);\n\t}\n\n\tif ((ret = PUSH_WAIT(push, 2)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NV917D, HEAD_SET_BASE_CHANNEL_USAGE_BOUNDS(i), bounds);\n\treturn 0;\n}\n\nstatic int\nhead917d_curs_set(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tret = PUSH_WAIT(push, 5);\n\tif (ret)\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NV917D, HEAD_SET_CONTROL_CURSOR(i),\n\t\t  NVDEF(NV917D, HEAD_SET_CONTROL_CURSOR, ENABLE, ENABLE) |\n\t\t  NVVAL(NV917D, HEAD_SET_CONTROL_CURSOR, FORMAT, asyh->curs.format) |\n\t\t  NVVAL(NV917D, HEAD_SET_CONTROL_CURSOR, SIZE, asyh->curs.layout) |\n\t\t  NVVAL(NV917D, HEAD_SET_CONTROL_CURSOR, HOT_SPOT_X, 0) |\n\t\t  NVVAL(NV917D, HEAD_SET_CONTROL_CURSOR, HOT_SPOT_Y, 0) |\n\t\t  NVDEF(NV917D, HEAD_SET_CONTROL_CURSOR, COMPOSITION, ALPHA_BLEND),\n\n\t\t\t\tHEAD_SET_OFFSET_CURSOR(i), asyh->curs.offset >> 8);\n\n\tPUSH_MTHD(push, NV917D, HEAD_SET_CONTEXT_DMA_CURSOR(i), asyh->curs.handle);\n\treturn 0;\n}\n\nint\nhead917d_curs_layout(struct nv50_head *head, struct nv50_wndw_atom *asyw,\n\t\t     struct nv50_head_atom *asyh)\n{\n\tswitch (asyw->state.fb->width) {\n\tcase  32: asyh->curs.layout = NV917D_HEAD_SET_CONTROL_CURSOR_SIZE_W32_H32; break;\n\tcase  64: asyh->curs.layout = NV917D_HEAD_SET_CONTROL_CURSOR_SIZE_W64_H64; break;\n\tcase 128: asyh->curs.layout = NV917D_HEAD_SET_CONTROL_CURSOR_SIZE_W128_H128; break;\n\tcase 256: asyh->curs.layout = NV917D_HEAD_SET_CONTROL_CURSOR_SIZE_W256_H256; break;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\nconst struct nv50_head_func\nhead917d = {\n\t.view = head907d_view,\n\t.mode = head907d_mode,\n\t.olut = head907d_olut,\n\t.ilut_check = head907d_ilut_check,\n\t.olut_size = 1024,\n\t.olut_set = head907d_olut_set,\n\t.olut_clr = head907d_olut_clr,\n\t.core_calc = head507d_core_calc,\n\t.core_set = head907d_core_set,\n\t.core_clr = head907d_core_clr,\n\t.curs_layout = head917d_curs_layout,\n\t.curs_format = head507d_curs_format,\n\t.curs_set = head917d_curs_set,\n\t.curs_clr = head907d_curs_clr,\n\t.base = head917d_base,\n\t.ovly = head907d_ovly,\n\t.dither = head917d_dither,\n\t.procamp = head907d_procamp,\n\t.or = head907d_or,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}