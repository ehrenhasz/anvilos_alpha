{
  "module_name": "headc37d.c",
  "hash_id": "5e35a66bf30dd3fd0c4b2558c97e1180aaa8b077b85325bf8f030f0b1d99d757",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/dispnv50/headc37d.c",
  "human_readable_source": " \n#include \"head.h\"\n#include \"atom.h\"\n#include \"core.h\"\n\n#include <nvif/pushc37b.h>\n\n#include <nvhw/class/clc37d.h>\n\nstatic int\nheadc37d_or(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tu8 depth;\n\tint ret;\n\n\t \n\tswitch (asyh->or.depth) {\n\tcase 6: depth = 5; break;\n\tcase 5: depth = 4; break;\n\tcase 2: depth = 1; break;\n\tcase 0:\tdepth = 4; break;\n\tdefault:\n\t\tdepth = asyh->or.depth;\n\t\tWARN_ON(1);\n\t\tbreak;\n\t}\n\n\tif ((ret = PUSH_WAIT(push, 2)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_CONTROL_OUTPUT_RESOURCE(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_OUTPUT_RESOURCE, CRC_MODE, asyh->or.crc_raster) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_OUTPUT_RESOURCE, HSYNC_POLARITY, asyh->or.nhsync) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_OUTPUT_RESOURCE, VSYNC_POLARITY, asyh->or.nvsync) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_OUTPUT_RESOURCE, PIXEL_DEPTH, depth) |\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_OUTPUT_RESOURCE, COLOR_SPACE_OVERRIDE, DISABLE));\n\treturn 0;\n}\n\nstatic int\nheadc37d_procamp(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 2)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_PROCAMP(i),\n\t\t  NVDEF(NVC37D, HEAD_SET_PROCAMP, COLOR_SPACE, RGB) |\n\t\t  NVDEF(NVC37D, HEAD_SET_PROCAMP, CHROMA_LPF, DISABLE) |\n\t\t  NVVAL(NVC37D, HEAD_SET_PROCAMP, SAT_COS, asyh->procamp.sat.cos) |\n\t\t  NVVAL(NVC37D, HEAD_SET_PROCAMP, SAT_SINE, asyh->procamp.sat.sin) |\n\t\t  NVDEF(NVC37D, HEAD_SET_PROCAMP, DYNAMIC_RANGE, VESA) |\n\t\t  NVDEF(NVC37D, HEAD_SET_PROCAMP, RANGE_COMPRESSION, DISABLE) |\n\t\t  NVDEF(NVC37D, HEAD_SET_PROCAMP, BLACK_LEVEL, GRAPHICS));\n\treturn 0;\n}\n\nint\nheadc37d_dither(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 2)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_DITHER_CONTROL(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_DITHER_CONTROL, ENABLE, asyh->dither.enable) |\n\t\t  NVVAL(NVC37D, HEAD_SET_DITHER_CONTROL, BITS, asyh->dither.bits) |\n\t\t  NVDEF(NVC37D, HEAD_SET_DITHER_CONTROL, OFFSET_ENABLE, DISABLE) |\n\t\t  NVVAL(NVC37D, HEAD_SET_DITHER_CONTROL, MODE, asyh->dither.mode) |\n\t\t  NVVAL(NVC37D, HEAD_SET_DITHER_CONTROL, PHASE, 0));\n\treturn 0;\n}\n\nint\nheadc37d_curs_clr(struct nv50_head *head)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 4)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_CONTROL_CURSOR(i),\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_CURSOR, ENABLE, DISABLE) |\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_CURSOR, FORMAT, A8R8G8B8));\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_CONTEXT_DMA_CURSOR(i, 0), 0x00000000);\n\treturn 0;\n}\n\nint\nheadc37d_curs_set(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 7)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_CONTROL_CURSOR(i),\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_CURSOR, ENABLE, ENABLE) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_CURSOR, FORMAT, asyh->curs.format) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_CURSOR, SIZE, asyh->curs.layout) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_CURSOR, HOT_SPOT_X, 0) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_CURSOR, HOT_SPOT_Y, 0) |\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_CURSOR, DE_GAMMA, NONE),\n\n\t\t\t\tHEAD_SET_CONTROL_CURSOR_COMPOSITION(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_CURSOR_COMPOSITION, K1, 0xff) |\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_CURSOR_COMPOSITION, CURSOR_COLOR_FACTOR_SELECT,\n\t\t\t\t\t\t\t\t     K1) |\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_CURSOR_COMPOSITION, VIEWPORT_COLOR_FACTOR_SELECT,\n\t\t\t\t\t\t\t\t     NEG_K1_TIMES_SRC) |\n\t\t  NVDEF(NVC37D, HEAD_SET_CONTROL_CURSOR_COMPOSITION, MODE, BLEND));\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_CONTEXT_DMA_CURSOR(i, 0), asyh->curs.handle);\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_OFFSET_CURSOR(i, 0), asyh->curs.offset >> 8);\n\treturn 0;\n}\n\nint\nheadc37d_curs_format(struct nv50_head *head, struct nv50_wndw_atom *asyw,\n\t\t     struct nv50_head_atom *asyh)\n{\n\tasyh->curs.format = asyw->image.format;\n\treturn 0;\n}\n\nstatic int\nheadc37d_olut_clr(struct nv50_head *head)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 2)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_CONTEXT_DMA_OUTPUT_LUT(i), 0x00000000);\n\treturn 0;\n}\n\nstatic int\nheadc37d_olut_set(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 4)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_CONTROL_OUTPUT_LUT(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_OUTPUT_LUT, SIZE, asyh->olut.size) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_OUTPUT_LUT, RANGE, asyh->olut.range) |\n\t\t  NVVAL(NVC37D, HEAD_SET_CONTROL_OUTPUT_LUT, OUTPUT_MODE, asyh->olut.output_mode),\n\n\t\t\t\tHEAD_SET_OFFSET_OUTPUT_LUT(i), asyh->olut.offset >> 8,\n\t\t\t\tHEAD_SET_CONTEXT_DMA_OUTPUT_LUT(i), asyh->olut.handle);\n\treturn 0;\n}\n\nstatic bool\nheadc37d_olut(struct nv50_head *head, struct nv50_head_atom *asyh, int size)\n{\n\tif (size != 256 && size != 1024)\n\t\treturn false;\n\n\tasyh->olut.size = size == 1024 ? NVC37D_HEAD_SET_CONTROL_OUTPUT_LUT_SIZE_SIZE_1025 :\n\t\t\t\t\t NVC37D_HEAD_SET_CONTROL_OUTPUT_LUT_SIZE_SIZE_257;\n\tasyh->olut.range = NVC37D_HEAD_SET_CONTROL_OUTPUT_LUT_RANGE_UNITY;\n\tasyh->olut.output_mode = NVC37D_HEAD_SET_CONTROL_OUTPUT_LUT_OUTPUT_MODE_INTERPOLATE;\n\tasyh->olut.load = head907d_olut_load;\n\treturn true;\n}\n\nstatic int\nheadc37d_mode(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tstruct nv50_head_mode *m = &asyh->mode;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 15)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_RASTER_SIZE(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_SIZE, WIDTH, m->h.active) |\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_SIZE, HEIGHT, m->v.active),\n\n\t\t\t\tHEAD_SET_RASTER_SYNC_END(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_SYNC_END, X, m->h.synce) |\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_SYNC_END, Y, m->v.synce),\n\n\t\t\t\tHEAD_SET_RASTER_BLANK_END(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_BLANK_END, X, m->h.blanke) |\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_BLANK_END, Y, m->v.blanke),\n\n\t\t\t\tHEAD_SET_RASTER_BLANK_START(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_BLANK_START, X, m->h.blanks) |\n\t\t  NVVAL(NVC37D, HEAD_SET_RASTER_BLANK_START, Y, m->v.blanks));\n\n\t\n\tPUSH_NVSQ(push, NVC37D, 0x2074 + (i * 0x400), m->v.blank2e << 16 | m->v.blank2s);\n\tPUSH_NVSQ(push, NVC37D, 0x2008 + (i * 0x400), m->interlace);\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_PIXEL_CLOCK_FREQUENCY(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_PIXEL_CLOCK_FREQUENCY, HERTZ, m->clock * 1000));\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_PIXEL_CLOCK_FREQUENCY_MAX(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_PIXEL_CLOCK_FREQUENCY_MAX, HERTZ, m->clock * 1000));\n\n\t \n\tPUSH_MTHD(push, NVC37D, HEAD_SET_HEAD_USAGE_BOUNDS(i),\n\t\t  NVDEF(NVC37D, HEAD_SET_HEAD_USAGE_BOUNDS, CURSOR, USAGE_W256_H256) |\n\t\t  NVDEF(NVC37D, HEAD_SET_HEAD_USAGE_BOUNDS, OUTPUT_LUT, USAGE_1025) |\n\t\t  NVDEF(NVC37D, HEAD_SET_HEAD_USAGE_BOUNDS, UPSCALING_ALLOWED, TRUE));\n\treturn 0;\n}\n\nint\nheadc37d_view(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tstruct nvif_push *push = nv50_disp(head->base.base.dev)->core->chan.push;\n\tconst int i = head->base.index;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 4)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_VIEWPORT_SIZE_IN(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_VIEWPORT_SIZE_IN, WIDTH, asyh->view.iW) |\n\t\t  NVVAL(NVC37D, HEAD_SET_VIEWPORT_SIZE_IN, HEIGHT, asyh->view.iH));\n\n\tPUSH_MTHD(push, NVC37D, HEAD_SET_VIEWPORT_SIZE_OUT(i),\n\t\t  NVVAL(NVC37D, HEAD_SET_VIEWPORT_SIZE_OUT, WIDTH, asyh->view.oW) |\n\t\t  NVVAL(NVC37D, HEAD_SET_VIEWPORT_SIZE_OUT, HEIGHT, asyh->view.oH));\n\treturn 0;\n}\n\nvoid\nheadc37d_static_wndw_map(struct nv50_head *head, struct nv50_head_atom *asyh)\n{\n\tint i, end;\n\n\tfor (i = head->base.index * 2, end = i + 2; i < end; i++)\n\t\tasyh->wndw.owned |= BIT(i);\n}\n\nconst struct nv50_head_func\nheadc37d = {\n\t.view = headc37d_view,\n\t.mode = headc37d_mode,\n\t.olut = headc37d_olut,\n\t.ilut_check = head907d_ilut_check,\n\t.olut_size = 1024,\n\t.olut_set = headc37d_olut_set,\n\t.olut_clr = headc37d_olut_clr,\n\t.curs_layout = head917d_curs_layout,\n\t.curs_format = headc37d_curs_format,\n\t.curs_set = headc37d_curs_set,\n\t.curs_clr = headc37d_curs_clr,\n\t.dither = headc37d_dither,\n\t.procamp = headc37d_procamp,\n\t.or = headc37d_or,\n\t.static_wndw_map = headc37d_static_wndw_map,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}