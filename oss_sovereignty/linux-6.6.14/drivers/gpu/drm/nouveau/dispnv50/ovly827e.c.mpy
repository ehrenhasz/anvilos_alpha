{
  "module_name": "ovly827e.c",
  "hash_id": "dbe1613a9f6a64aa26ed74b3c5cc44f09f329f9634a1ad3cab81ba97a74c9b6d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/dispnv50/ovly827e.c",
  "human_readable_source": " \n#include \"ovly.h\"\n#include \"atom.h\"\n\n#include <nouveau_bo.h>\n\n#include <nvif/push507c.h>\n#include <nvif/timer.h>\n\n#include <nvhw/class/cl827e.h>\n\nstatic int\novly827e_image_set(struct nv50_wndw *wndw, struct nv50_wndw_atom *asyw)\n{\n\tstruct nvif_push *push = wndw->wndw.push;\n\tint ret;\n\n\tif ((ret = PUSH_WAIT(push, 12)))\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NV827E, SET_PRESENT_CONTROL,\n\t\t  NVDEF(NV827E, SET_PRESENT_CONTROL, BEGIN_MODE, ASAP) |\n\t\t  NVVAL(NV827E, SET_PRESENT_CONTROL, MIN_PRESENT_INTERVAL, asyw->image.interval));\n\n\tPUSH_MTHD(push, NV827E, SET_CONTEXT_DMA_ISO, asyw->image.handle[0]);\n\n\tPUSH_MTHD(push, NV827E, SET_COMPOSITION_CONTROL,\n\t\t  NVDEF(NV827E, SET_COMPOSITION_CONTROL, MODE, OPAQUE_SUSPEND_BASE));\n\n\tPUSH_MTHD(push, NV827E, SURFACE_SET_OFFSET, asyw->image.offset[0] >> 8);\n\n\tPUSH_MTHD(push, NV827E, SURFACE_SET_SIZE,\n\t\t  NVVAL(NV827E, SURFACE_SET_SIZE, WIDTH, asyw->image.w) |\n\t\t  NVVAL(NV827E, SURFACE_SET_SIZE, HEIGHT, asyw->image.h),\n\n\t\t\t\tSURFACE_SET_STORAGE,\n\t\t  NVVAL(NV827E, SURFACE_SET_STORAGE, BLOCK_HEIGHT, asyw->image.blockh) |\n\t\t  NVVAL(NV827E, SURFACE_SET_STORAGE, PITCH, (asyw->image.pitch[0] >> 8)) |\n\t\t  NVVAL(NV827E, SURFACE_SET_STORAGE, PITCH, asyw->image.blocks[0]) |\n\t\t  NVVAL(NV827E, SURFACE_SET_STORAGE, MEMORY_LAYOUT, asyw->image.layout),\n\n\t\t\t\tSURFACE_SET_PARAMS,\n\t\t  NVVAL(NV827E, SURFACE_SET_PARAMS, FORMAT, asyw->image.format) |\n\t\t  NVVAL(NV827E, SURFACE_SET_PARAMS, COLOR_SPACE, asyw->image.colorspace));\n\treturn 0;\n}\n\nint\novly827e_ntfy_wait_begun(struct nouveau_bo *bo, u32 offset,\n\t\t\t struct nvif_device *device)\n{\n\ts64 time = nvif_msec(device, 2000ULL,\n\t\tif (NVBO_TD32(bo, offset, NV_DISP_NOTIFICATION_1, _3, STATUS, ==, BEGUN))\n\t\t\tbreak;\n\t\tusleep_range(1, 2);\n\t);\n\treturn time < 0 ? time : 0;\n}\n\nvoid\novly827e_ntfy_reset(struct nouveau_bo *bo, u32 offset)\n{\n\tNVBO_WR32(bo, offset, NV_DISP_NOTIFICATION_1, TIME_STAMP_0, 0);\n\tNVBO_WR32(bo, offset, NV_DISP_NOTIFICATION_1, TIME_STAMP_1, 0);\n\tNVBO_WR32(bo, offset, NV_DISP_NOTIFICATION_1, _2, 0);\n\tNVBO_WR32(bo, offset, NV_DISP_NOTIFICATION_1, _3,\n\t\t\tNVDEF(NV_DISP_NOTIFICATION_1, _3, STATUS, NOT_BEGUN));\n}\n\nstatic const struct nv50_wndw_func\novly827e = {\n\t.acquire = ovly507e_acquire,\n\t.release = ovly507e_release,\n\t.ntfy_set = base507c_ntfy_set,\n\t.ntfy_clr = base507c_ntfy_clr,\n\t.ntfy_reset = ovly827e_ntfy_reset,\n\t.ntfy_wait_begun = ovly827e_ntfy_wait_begun,\n\t.image_set = ovly827e_image_set,\n\t.image_clr = base507c_image_clr,\n\t.scale_set = ovly507e_scale_set,\n\t.update = base507c_update,\n};\n\nconst u32\novly827e_format[] = {\n\tDRM_FORMAT_YUYV,\n\tDRM_FORMAT_UYVY,\n\tDRM_FORMAT_XRGB8888,\n\tDRM_FORMAT_XRGB1555,\n\tDRM_FORMAT_XBGR2101010,\n\t0\n};\n\nint\novly827e_new(struct nouveau_drm *drm, int head, s32 oclass,\n\t     struct nv50_wndw **pwndw)\n{\n\treturn ovly507e_new_(&ovly827e, ovly827e_format, drm, head, oclass,\n\t\t\t     0x00000004 << (head * 8), pwndw);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}