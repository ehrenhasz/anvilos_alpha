{
  "module_name": "fifo.c",
  "hash_id": "81fbceac659e8e53467860e0c80f07d52e397cbfbf2f9c9682de9be64010b852",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvif/fifo.c",
  "human_readable_source": " \n#include <nvif/fifo.h>\n\nstatic int\nnvif_fifo_runlists(struct nvif_device *device)\n{\n\tstruct nvif_object *object = &device->object;\n\tstruct {\n\t\tstruct nv_device_info_v1 m;\n\t\tstruct {\n\t\t\tstruct nv_device_info_v1_data runlists;\n\t\t\tstruct nv_device_info_v1_data runlist[64];\n\t\t} v;\n\t} *a;\n\tint ret, i;\n\n\tif (device->runlist)\n\t\treturn 0;\n\n\tif (!(a = kmalloc(sizeof(*a), GFP_KERNEL)))\n\t\treturn -ENOMEM;\n\ta->m.version = 1;\n\ta->m.count = sizeof(a->v) / sizeof(a->v.runlists);\n\ta->v.runlists.mthd = NV_DEVICE_HOST_RUNLISTS;\n\tfor (i = 0; i < ARRAY_SIZE(a->v.runlist); i++) {\n\t\ta->v.runlist[i].mthd = NV_DEVICE_HOST_RUNLIST_ENGINES;\n\t\ta->v.runlist[i].data = i;\n\t}\n\n\tret = nvif_object_mthd(object, NV_DEVICE_V0_INFO, a, sizeof(*a));\n\tif (ret)\n\t\tgoto done;\n\n\tdevice->runlists = fls64(a->v.runlists.data);\n\tdevice->runlist = kcalloc(device->runlists, sizeof(*device->runlist),\n\t\t\t\t  GFP_KERNEL);\n\tif (!device->runlist) {\n\t\tret = -ENOMEM;\n\t\tgoto done;\n\t}\n\n\tfor (i = 0; i < device->runlists; i++) {\n\t\tif (a->v.runlist[i].mthd != NV_DEVICE_INFO_INVALID)\n\t\t\tdevice->runlist[i].engines = a->v.runlist[i].data;\n\t}\n\ndone:\n\tkfree(a);\n\treturn ret;\n}\n\nu64\nnvif_fifo_runlist(struct nvif_device *device, u64 engine)\n{\n\tu64 runm = 0;\n\tint ret, i;\n\n\tif ((ret = nvif_fifo_runlists(device)))\n\t\treturn runm;\n\n\tfor (i = 0; i < device->runlists; i++) {\n\t\tif (device->runlist[i].engines & engine)\n\t\t\trunm |= BIT_ULL(i);\n\t}\n\n\treturn runm;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}