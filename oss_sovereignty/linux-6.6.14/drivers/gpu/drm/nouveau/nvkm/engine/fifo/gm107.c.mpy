{
  "module_name": "gm107.c",
  "hash_id": "7736b268a04c0020443c0bd03941533bc7884814d3782f8c890f651f4322d82d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/engine/fifo/gm107.c",
  "human_readable_source": " \n#include \"priv.h\"\n#include \"chan.h\"\n#include \"runl.h\"\n\n#include <core/gpuobj.h>\n#include <subdev/fault.h>\n\n#include <nvif/class.h>\n\nconst struct nvkm_chan_func\ngm107_chan = {\n\t.inst = &gf100_chan_inst,\n\t.userd = &gk104_chan_userd,\n\t.ramfc = &gk104_chan_ramfc,\n\t.bind = gk104_chan_bind_inst,\n\t.unbind = gk104_chan_unbind,\n\t.start = gk104_chan_start,\n\t.stop = gk104_chan_stop,\n\t.preempt = gk110_chan_preempt,\n};\n\nstatic void\ngm107_runl_insert_chan(struct nvkm_chan *chan, struct nvkm_memory *memory, u64 offset)\n{\n\tnvkm_wo32(memory, offset + 0, chan->id);\n\tnvkm_wo32(memory, offset + 4, chan->inst->addr >> 12);\n}\n\nconst struct nvkm_runl_func\ngm107_runl = {\n\t.size = 8,\n\t.update = nv50_runl_update,\n\t.insert_cgrp = gk110_runl_insert_cgrp,\n\t.insert_chan = gm107_runl_insert_chan,\n\t.commit = gk104_runl_commit,\n\t.wait = nv50_runl_wait,\n\t.pending = gk104_runl_pending,\n\t.block = gk104_runl_block,\n\t.allow = gk104_runl_allow,\n\t.fault_clear = gk104_runl_fault_clear,\n\t.preempt_pending = gf100_runl_preempt_pending,\n};\n\nstatic const struct nvkm_enum\ngm107_fifo_mmu_fault_engine[] = {\n\t{ 0x01, \"DISPLAY\" },\n\t{ 0x02, \"CAPTURE\" },\n\t{ 0x03, \"IFB\", NULL, NVKM_ENGINE_IFB },\n\t{ 0x04, \"BAR1\", NULL, NVKM_SUBDEV_BAR },\n\t{ 0x05, \"BAR2\", NULL, NVKM_SUBDEV_INSTMEM },\n\t{ 0x06, \"SCHED\" },\n\t{ 0x07, \"HOST0\" },\n\t{ 0x08, \"HOST1\" },\n\t{ 0x09, \"HOST2\" },\n\t{ 0x0a, \"HOST3\" },\n\t{ 0x0b, \"HOST4\" },\n\t{ 0x0c, \"HOST5\" },\n\t{ 0x0d, \"HOST6\" },\n\t{ 0x0e, \"HOST7\" },\n\t{ 0x0f, \"HOSTSR\" },\n\t{ 0x13, \"PERF\" },\n\t{ 0x17, \"PMU\" },\n\t{ 0x18, \"PTP\" },\n\t{}\n};\n\nconst struct nvkm_fifo_func_mmu_fault\ngm107_fifo_mmu_fault = {\n\t.recover = gf100_fifo_mmu_fault_recover,\n\t.access = gf100_fifo_mmu_fault_access,\n\t.engine = gm107_fifo_mmu_fault_engine,\n\t.reason = gk104_fifo_mmu_fault_reason,\n\t.hubclient = gk104_fifo_mmu_fault_hubclient,\n\t.gpcclient = gk104_fifo_mmu_fault_gpcclient,\n};\n\nvoid\ngm107_fifo_intr_mmu_fault_unit(struct nvkm_fifo *fifo, int unit)\n{\n\tstruct nvkm_device *device = fifo->engine.subdev.device;\n\tu32 inst = nvkm_rd32(device, 0x002800 + (unit * 0x10));\n\tu32 valo = nvkm_rd32(device, 0x002804 + (unit * 0x10));\n\tu32 vahi = nvkm_rd32(device, 0x002808 + (unit * 0x10));\n\tu32 type = nvkm_rd32(device, 0x00280c + (unit * 0x10));\n\tstruct nvkm_fault_data info;\n\n\tinfo.inst   =  (u64)inst << 12;\n\tinfo.addr   = ((u64)vahi << 32) | valo;\n\tinfo.time   = 0;\n\tinfo.engine = unit;\n\tinfo.valid  = 1;\n\tinfo.gpc    = (type & 0x1f000000) >> 24;\n\tinfo.client = (type & 0x00003f00) >> 8;\n\tinfo.access = (type & 0x00000080) >> 7;\n\tinfo.hub    = (type & 0x00000040) >> 6;\n\tinfo.reason = (type & 0x0000000f);\n\n\tnvkm_fifo_fault(fifo, &info);\n}\n\nstatic int\ngm107_fifo_chid_nr(struct nvkm_fifo *fifo)\n{\n\treturn 2048;\n}\n\nstatic const struct nvkm_fifo_func\ngm107_fifo = {\n\t.chid_nr = gm107_fifo_chid_nr,\n\t.chid_ctor = gk110_fifo_chid_ctor,\n\t.runq_nr = gf100_fifo_runq_nr,\n\t.runl_ctor = gk104_fifo_runl_ctor,\n\t.init = gk104_fifo_init,\n\t.init_pbdmas = gk104_fifo_init_pbdmas,\n\t.intr = gk104_fifo_intr,\n\t.intr_mmu_fault_unit = gm107_fifo_intr_mmu_fault_unit,\n\t.intr_ctxsw_timeout = gf100_fifo_intr_ctxsw_timeout,\n\t.mmu_fault = &gm107_fifo_mmu_fault,\n\t.nonstall = &gf100_fifo_nonstall,\n\t.runl = &gm107_runl,\n\t.runq = &gk208_runq,\n\t.engn = &gk104_engn,\n\t.engn_ce = &gk104_engn_ce,\n\t.cgrp = {{ 0, 0, KEPLER_CHANNEL_GROUP_A  }, &gk110_cgrp },\n\t.chan = {{ 0, 0, KEPLER_CHANNEL_GPFIFO_B }, &gm107_chan },\n};\n\nint\ngm107_fifo_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t       struct nvkm_fifo **pfifo)\n{\n\treturn nvkm_fifo_new_(&gm107_fifo, device, type, inst, pfifo);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}