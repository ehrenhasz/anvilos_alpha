{
  "module_name": "base.c",
  "hash_id": "6b485bb14f44859de9a8993ccae8ab2004d7c8e3c4744878108a9a768af6e69d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/engine/dma/base.c",
  "human_readable_source": " \n#include \"priv.h\"\n\n#include <core/client.h>\n#include <engine/fifo.h>\n\n#include <nvif/class.h>\n\nstatic int\nnvkm_dma_oclass_new(struct nvkm_device *device,\n\t\t    const struct nvkm_oclass *oclass, void *data, u32 size,\n\t\t    struct nvkm_object **pobject)\n{\n\tstruct nvkm_dma *dma = nvkm_dma(oclass->engine);\n\tstruct nvkm_dmaobj *dmaobj = NULL;\n\tint ret;\n\n\tret = dma->func->class_new(dma, oclass, data, size, &dmaobj);\n\tif (dmaobj)\n\t\t*pobject = &dmaobj->object;\n\treturn ret;\n}\n\nstatic const struct nvkm_device_oclass\nnvkm_dma_oclass_base = {\n\t.ctor = nvkm_dma_oclass_new,\n};\n\nstatic int\nnvkm_dma_oclass_fifo_new(const struct nvkm_oclass *oclass, void *data, u32 size,\n\t\t\t struct nvkm_object **pobject)\n{\n\treturn nvkm_dma_oclass_new(oclass->engine->subdev.device,\n\t\t\t\t   oclass, data, size, pobject);\n}\n\nstatic const struct nvkm_sclass\nnvkm_dma_sclass[] = {\n\t{ 0, 0, NV_DMA_FROM_MEMORY, NULL, nvkm_dma_oclass_fifo_new },\n\t{ 0, 0, NV_DMA_TO_MEMORY, NULL, nvkm_dma_oclass_fifo_new },\n\t{ 0, 0, NV_DMA_IN_MEMORY, NULL, nvkm_dma_oclass_fifo_new },\n};\n\nstatic int\nnvkm_dma_oclass_base_get(struct nvkm_oclass *sclass, int index,\n\t\t\t const struct nvkm_device_oclass **class)\n{\n\tconst int count = ARRAY_SIZE(nvkm_dma_sclass);\n\tif (index < count) {\n\t\tconst struct nvkm_sclass *oclass = &nvkm_dma_sclass[index];\n\t\tsclass->base = oclass[0];\n\t\tsclass->engn = oclass;\n\t\t*class = &nvkm_dma_oclass_base;\n\t\treturn index;\n\t}\n\treturn count;\n}\n\nstatic int\nnvkm_dma_oclass_fifo_get(struct nvkm_oclass *oclass, int index)\n{\n\tconst int count = ARRAY_SIZE(nvkm_dma_sclass);\n\tif (index < count) {\n\t\toclass->base = nvkm_dma_sclass[index];\n\t\treturn index;\n\t}\n\treturn count;\n}\n\nstatic void *\nnvkm_dma_dtor(struct nvkm_engine *engine)\n{\n\treturn nvkm_dma(engine);\n}\n\nstatic const struct nvkm_engine_func\nnvkm_dma = {\n\t.dtor = nvkm_dma_dtor,\n\t.base.sclass = nvkm_dma_oclass_base_get,\n\t.fifo.sclass = nvkm_dma_oclass_fifo_get,\n};\n\nint\nnvkm_dma_new_(const struct nvkm_dma_func *func, struct nvkm_device *device,\n\t      enum nvkm_subdev_type type, int inst, struct nvkm_dma **pdma)\n{\n\tstruct nvkm_dma *dma;\n\n\tif (!(dma = *pdma = kzalloc(sizeof(*dma), GFP_KERNEL)))\n\t\treturn -ENOMEM;\n\tdma->func = func;\n\n\treturn nvkm_engine_ctor(&nvkm_dma, device, type, inst, true, &dma->engine);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}