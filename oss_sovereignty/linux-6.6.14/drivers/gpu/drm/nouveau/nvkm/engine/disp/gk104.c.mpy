{
  "module_name": "gk104.c",
  "hash_id": "93bd99a0b03ec80a23ea13f3ed0d5899df4bb704b7aa2751ad2fe535ba927727",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/engine/disp/gk104.c",
  "human_readable_source": " \n#include \"priv.h\"\n#include \"chan.h\"\n#include \"hdmi.h\"\n#include \"head.h\"\n#include \"ior.h\"\n\n#include <nvif/class.h>\n\nvoid\ngk104_sor_hdmi_infoframe_vsi(struct nvkm_ior *ior, int head, void *data, u32 size)\n{\n\tstruct nvkm_device *device = ior->disp->engine.subdev.device;\n\tstruct packed_hdmi_infoframe vsi;\n\tconst u32 hoff = head * 0x400;\n\n\tpack_hdmi_infoframe(&vsi, data, size);\n\n\t \n\tnvkm_mask(device, 0x690100 + hoff, 0x00010001, 0x00000000);\n\tif (!size)\n\t\treturn;\n\n\tnvkm_wr32(device, 0x690108 + hoff, vsi.header);\n\tnvkm_wr32(device, 0x69010c + hoff, vsi.subpack0_low);\n\tnvkm_wr32(device, 0x690110 + hoff, vsi.subpack0_high);\n\t \n\tnvkm_mask(device, 0x690100 + hoff, 0x00000001, 0x00000001);\n}\n\nvoid\ngk104_sor_hdmi_infoframe_avi(struct nvkm_ior *ior, int head, void *data, u32 size)\n{\n\tstruct nvkm_device *device = ior->disp->engine.subdev.device;\n\tstruct packed_hdmi_infoframe avi;\n\tconst u32 hoff = head * 0x400;\n\n\tpack_hdmi_infoframe(&avi, data, size);\n\n\t \n\tnvkm_mask(device, 0x690000 + hoff, 0x00000001, 0x00000000);\n\tif (!size)\n\t\treturn;\n\n\tnvkm_wr32(device, 0x690008 + hoff, avi.header);\n\tnvkm_wr32(device, 0x69000c + hoff, avi.subpack0_low);\n\tnvkm_wr32(device, 0x690010 + hoff, avi.subpack0_high);\n\tnvkm_wr32(device, 0x690014 + hoff, avi.subpack1_low);\n\tnvkm_wr32(device, 0x690018 + hoff, avi.subpack1_high);\n\n\tnvkm_mask(device, 0x690000 + hoff, 0x00000001, 0x00000001);\n}\n\nvoid\ngk104_sor_hdmi_ctrl(struct nvkm_ior *ior, int head, bool enable, u8 max_ac_packet, u8 rekey)\n{\n\tstruct nvkm_device *device = ior->disp->engine.subdev.device;\n\tconst u32 ctrl = 0x40000000 * enable |\n\t\t\t max_ac_packet << 16 |\n\t\t\t rekey;\n\tconst u32 hoff = head * 0x800;\n\tconst u32 hdmi = head * 0x400;\n\n\tif (!(ctrl & 0x40000000)) {\n\t\tnvkm_mask(device, 0x616798 + hoff, 0x40000000, 0x00000000);\n\t\tnvkm_mask(device, 0x690100 + hdmi, 0x00000001, 0x00000000);\n\t\tnvkm_mask(device, 0x6900c0 + hdmi, 0x00000001, 0x00000000);\n\t\tnvkm_mask(device, 0x690000 + hdmi, 0x00000001, 0x00000000);\n\t\treturn;\n\t}\n\n\t \n\tnvkm_mask(device, 0x6900c0 + hdmi, 0x00000001, 0x00000000);\n\tnvkm_wr32(device, 0x6900cc + hdmi, 0x00000010);\n\tnvkm_mask(device, 0x6900c0 + hdmi, 0x00000001, 0x00000001);\n\n\t \n\tnvkm_wr32(device, 0x690080 + hdmi, 0x82000000);\n\n\t \n\tnvkm_mask(device, 0x616798 + hoff, 0x401f007f, ctrl);\n}\n\nconst struct nvkm_ior_func_hdmi\ngk104_sor_hdmi = {\n\t.ctrl = gk104_sor_hdmi_ctrl,\n\t.infoframe_avi = gk104_sor_hdmi_infoframe_avi,\n\t.infoframe_vsi = gk104_sor_hdmi_infoframe_vsi,\n};\n\nstatic const struct nvkm_ior_func\ngk104_sor = {\n\t.state = gf119_sor_state,\n\t.power = nv50_sor_power,\n\t.clock = gf119_sor_clock,\n\t.hdmi = &gk104_sor_hdmi,\n\t.dp = &gf119_sor_dp,\n\t.hda = &gf119_sor_hda,\n};\n\nint\ngk104_sor_new(struct nvkm_disp *disp, int id)\n{\n\treturn nvkm_ior_new_(&gk104_sor, disp, SOR, id, true);\n}\n\nstatic const struct nvkm_disp_mthd_list\ngk104_disp_ovly_mthd_base = {\n\t.mthd = 0x0000,\n\t.data = {\n\t\t{ 0x0080, 0x665080 },\n\t\t{ 0x0084, 0x665084 },\n\t\t{ 0x0088, 0x665088 },\n\t\t{ 0x008c, 0x66508c },\n\t\t{ 0x0090, 0x665090 },\n\t\t{ 0x0094, 0x665094 },\n\t\t{ 0x00a0, 0x6650a0 },\n\t\t{ 0x00a4, 0x6650a4 },\n\t\t{ 0x00b0, 0x6650b0 },\n\t\t{ 0x00b4, 0x6650b4 },\n\t\t{ 0x00b8, 0x6650b8 },\n\t\t{ 0x00c0, 0x6650c0 },\n\t\t{ 0x00c4, 0x6650c4 },\n\t\t{ 0x00e0, 0x6650e0 },\n\t\t{ 0x00e4, 0x6650e4 },\n\t\t{ 0x00e8, 0x6650e8 },\n\t\t{ 0x0100, 0x665100 },\n\t\t{ 0x0104, 0x665104 },\n\t\t{ 0x0108, 0x665108 },\n\t\t{ 0x010c, 0x66510c },\n\t\t{ 0x0110, 0x665110 },\n\t\t{ 0x0118, 0x665118 },\n\t\t{ 0x011c, 0x66511c },\n\t\t{ 0x0120, 0x665120 },\n\t\t{ 0x0124, 0x665124 },\n\t\t{ 0x0130, 0x665130 },\n\t\t{ 0x0134, 0x665134 },\n\t\t{ 0x0138, 0x665138 },\n\t\t{ 0x013c, 0x66513c },\n\t\t{ 0x0140, 0x665140 },\n\t\t{ 0x0144, 0x665144 },\n\t\t{ 0x0148, 0x665148 },\n\t\t{ 0x014c, 0x66514c },\n\t\t{ 0x0150, 0x665150 },\n\t\t{ 0x0154, 0x665154 },\n\t\t{ 0x0158, 0x665158 },\n\t\t{ 0x015c, 0x66515c },\n\t\t{ 0x0160, 0x665160 },\n\t\t{ 0x0164, 0x665164 },\n\t\t{ 0x0168, 0x665168 },\n\t\t{ 0x016c, 0x66516c },\n\t\t{ 0x0400, 0x665400 },\n\t\t{ 0x0404, 0x665404 },\n\t\t{ 0x0408, 0x665408 },\n\t\t{ 0x040c, 0x66540c },\n\t\t{ 0x0410, 0x665410 },\n\t\t{}\n\t}\n};\n\nconst struct nvkm_disp_chan_mthd\ngk104_disp_ovly_mthd = {\n\t.name = \"Overlay\",\n\t.addr = 0x001000,\n\t.prev = -0x020000,\n\t.data = {\n\t\t{ \"Global\", 1, &gk104_disp_ovly_mthd_base },\n\t\t{}\n\t}\n};\n\nconst struct nvkm_disp_chan_user\ngk104_disp_ovly = {\n\t.func = &gf119_disp_dmac_func,\n\t.ctrl = 5,\n\t.user = 5,\n\t.mthd = &gk104_disp_ovly_mthd,\n};\n\nstatic const struct nvkm_disp_mthd_list\ngk104_disp_core_mthd_head = {\n\t.mthd = 0x0300,\n\t.addr = 0x000300,\n\t.data = {\n\t\t{ 0x0400, 0x660400 },\n\t\t{ 0x0404, 0x660404 },\n\t\t{ 0x0408, 0x660408 },\n\t\t{ 0x040c, 0x66040c },\n\t\t{ 0x0410, 0x660410 },\n\t\t{ 0x0414, 0x660414 },\n\t\t{ 0x0418, 0x660418 },\n\t\t{ 0x041c, 0x66041c },\n\t\t{ 0x0420, 0x660420 },\n\t\t{ 0x0424, 0x660424 },\n\t\t{ 0x0428, 0x660428 },\n\t\t{ 0x042c, 0x66042c },\n\t\t{ 0x0430, 0x660430 },\n\t\t{ 0x0434, 0x660434 },\n\t\t{ 0x0438, 0x660438 },\n\t\t{ 0x0440, 0x660440 },\n\t\t{ 0x0444, 0x660444 },\n\t\t{ 0x0448, 0x660448 },\n\t\t{ 0x044c, 0x66044c },\n\t\t{ 0x0450, 0x660450 },\n\t\t{ 0x0454, 0x660454 },\n\t\t{ 0x0458, 0x660458 },\n\t\t{ 0x045c, 0x66045c },\n\t\t{ 0x0460, 0x660460 },\n\t\t{ 0x0468, 0x660468 },\n\t\t{ 0x046c, 0x66046c },\n\t\t{ 0x0470, 0x660470 },\n\t\t{ 0x0474, 0x660474 },\n\t\t{ 0x047c, 0x66047c },\n\t\t{ 0x0480, 0x660480 },\n\t\t{ 0x0484, 0x660484 },\n\t\t{ 0x0488, 0x660488 },\n\t\t{ 0x048c, 0x66048c },\n\t\t{ 0x0490, 0x660490 },\n\t\t{ 0x0494, 0x660494 },\n\t\t{ 0x0498, 0x660498 },\n\t\t{ 0x04a0, 0x6604a0 },\n\t\t{ 0x04b0, 0x6604b0 },\n\t\t{ 0x04b8, 0x6604b8 },\n\t\t{ 0x04bc, 0x6604bc },\n\t\t{ 0x04c0, 0x6604c0 },\n\t\t{ 0x04c4, 0x6604c4 },\n\t\t{ 0x04c8, 0x6604c8 },\n\t\t{ 0x04d0, 0x6604d0 },\n\t\t{ 0x04d4, 0x6604d4 },\n\t\t{ 0x04e0, 0x6604e0 },\n\t\t{ 0x04e4, 0x6604e4 },\n\t\t{ 0x04e8, 0x6604e8 },\n\t\t{ 0x04ec, 0x6604ec },\n\t\t{ 0x04f0, 0x6604f0 },\n\t\t{ 0x04f4, 0x6604f4 },\n\t\t{ 0x04f8, 0x6604f8 },\n\t\t{ 0x04fc, 0x6604fc },\n\t\t{ 0x0500, 0x660500 },\n\t\t{ 0x0504, 0x660504 },\n\t\t{ 0x0508, 0x660508 },\n\t\t{ 0x050c, 0x66050c },\n\t\t{ 0x0510, 0x660510 },\n\t\t{ 0x0514, 0x660514 },\n\t\t{ 0x0518, 0x660518 },\n\t\t{ 0x051c, 0x66051c },\n\t\t{ 0x0520, 0x660520 },\n\t\t{ 0x0524, 0x660524 },\n\t\t{ 0x052c, 0x66052c },\n\t\t{ 0x0530, 0x660530 },\n\t\t{ 0x054c, 0x66054c },\n\t\t{ 0x0550, 0x660550 },\n\t\t{ 0x0554, 0x660554 },\n\t\t{ 0x0558, 0x660558 },\n\t\t{ 0x055c, 0x66055c },\n\t\t{}\n\t}\n};\n\nconst struct nvkm_disp_chan_mthd\ngk104_disp_core_mthd = {\n\t.name = \"Core\",\n\t.addr = 0x000000,\n\t.prev = -0x020000,\n\t.data = {\n\t\t{ \"Global\", 1, &gf119_disp_core_mthd_base },\n\t\t{    \"DAC\", 3, &gf119_disp_core_mthd_dac  },\n\t\t{    \"SOR\", 8, &gf119_disp_core_mthd_sor  },\n\t\t{   \"PIOR\", 4, &gf119_disp_core_mthd_pior },\n\t\t{   \"HEAD\", 4, &gk104_disp_core_mthd_head },\n\t\t{}\n\t}\n};\n\nconst struct nvkm_disp_chan_user\ngk104_disp_core = {\n\t.func = &gf119_disp_core_func,\n\t.ctrl = 0,\n\t.user = 0,\n\t.mthd = &gk104_disp_core_mthd,\n};\n\nstatic const struct nvkm_disp_func\ngk104_disp = {\n\t.oneinit = nv50_disp_oneinit,\n\t.init = gf119_disp_init,\n\t.fini = gf119_disp_fini,\n\t.intr = gf119_disp_intr,\n\t.intr_error = gf119_disp_intr_error,\n\t.super = gf119_disp_super,\n\t.uevent = &gf119_disp_chan_uevent,\n\t.head = { .cnt = gf119_head_cnt, .new = gf119_head_new },\n\t.dac = { .cnt = gf119_dac_cnt, .new = gf119_dac_new },\n\t.sor = { .cnt = gf119_sor_cnt, .new = gk104_sor_new },\n\t.root = { 0,0,GK104_DISP },\n\t.user = {\n\t\t{{0,0,GK104_DISP_CURSOR             }, nvkm_disp_chan_new, &gf119_disp_curs },\n\t\t{{0,0,GK104_DISP_OVERLAY            }, nvkm_disp_chan_new, &gf119_disp_oimm },\n\t\t{{0,0,GK104_DISP_BASE_CHANNEL_DMA   }, nvkm_disp_chan_new, &gf119_disp_base },\n\t\t{{0,0,GK104_DISP_CORE_CHANNEL_DMA   }, nvkm_disp_core_new, &gk104_disp_core },\n\t\t{{0,0,GK104_DISP_OVERLAY_CONTROL_DMA}, nvkm_disp_chan_new, &gk104_disp_ovly },\n\t\t{}\n\t},\n};\n\nint\ngk104_disp_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t       struct nvkm_disp **pdisp)\n{\n\treturn nvkm_disp_new_(&gk104_disp, device, type, inst, pdisp);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}