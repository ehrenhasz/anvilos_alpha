{
  "module_name": "uhead.c",
  "hash_id": "5c3c9cfc8b5928a612f206cd20d9acd68866641eb3c12e8df4a031cc18fc5dc2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/engine/disp/uhead.c",
  "human_readable_source": " \n#define nvkm_uhead(p) container_of((p), struct nvkm_head, object)\n#include \"head.h\"\n#include <core/event.h>\n\n#include <nvif/if0013.h>\n\n#include <nvif/event.h>\n\nstatic int\nnvkm_uhead_uevent(struct nvkm_object *object, void *argv, u32 argc, struct nvkm_uevent *uevent)\n{\n\tstruct nvkm_head *head = nvkm_uhead(object);\n\tunion nvif_head_event_args *args = argv;\n\n\tif (!uevent)\n\t\treturn 0;\n\tif (argc != sizeof(args->vn))\n\t\treturn -ENOSYS;\n\n\treturn nvkm_uevent_add(uevent, &head->disp->vblank, head->id,\n\t\t\t       NVKM_DISP_HEAD_EVENT_VBLANK, NULL);\n}\n\nstatic int\nnvkm_uhead_mthd_scanoutpos(struct nvkm_head *head, void *argv, u32 argc)\n{\n\tunion nvif_head_scanoutpos_args *args = argv;\n\n\tif (argc != sizeof(args->v0) || args->v0.version != 0)\n\t\treturn -ENOSYS;\n\n\thead->func->state(head, &head->arm);\n\targs->v0.vtotal  = head->arm.vtotal;\n\targs->v0.vblanks = head->arm.vblanks;\n\targs->v0.vblanke = head->arm.vblanke;\n\targs->v0.htotal  = head->arm.htotal;\n\targs->v0.hblanks = head->arm.hblanks;\n\targs->v0.hblanke = head->arm.hblanke;\n\n\t \n\tif (!args->v0.vtotal || !args->v0.htotal)\n\t\treturn -ENOTSUPP;\n\n\targs->v0.time[0] = ktime_to_ns(ktime_get());\n\thead->func->rgpos(head, &args->v0.hline, &args->v0.vline);\n\targs->v0.time[1] = ktime_to_ns(ktime_get());\n\treturn 0;\n}\n\nstatic int\nnvkm_uhead_mthd(struct nvkm_object *object, u32 mthd, void *argv, u32 argc)\n{\n\tstruct nvkm_head *head = nvkm_uhead(object);\n\n\tswitch (mthd) {\n\tcase NVIF_HEAD_V0_SCANOUTPOS: return nvkm_uhead_mthd_scanoutpos(head, argv, argc);\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic void *\nnvkm_uhead_dtor(struct nvkm_object *object)\n{\n\tstruct nvkm_head *head = nvkm_uhead(object);\n\tstruct nvkm_disp *disp = head->disp;\n\n\tspin_lock(&disp->client.lock);\n\thead->object.func = NULL;\n\tspin_unlock(&disp->client.lock);\n\treturn NULL;\n}\n\nstatic const struct nvkm_object_func\nnvkm_uhead = {\n\t.dtor = nvkm_uhead_dtor,\n\t.mthd = nvkm_uhead_mthd,\n\t.uevent = nvkm_uhead_uevent,\n};\n\nint\nnvkm_uhead_new(const struct nvkm_oclass *oclass, void *argv, u32 argc, struct nvkm_object **pobject)\n{\n\tstruct nvkm_disp *disp = nvkm_udisp(oclass->parent);\n\tstruct nvkm_head *head;\n\tunion nvif_head_args *args = argv;\n\tint ret;\n\n\tif (argc != sizeof(args->v0) || args->v0.version != 0)\n\t\treturn -ENOSYS;\n\tif (!(head = nvkm_head_find(disp, args->v0.id)))\n\t\treturn -EINVAL;\n\n\tret = -EBUSY;\n\tspin_lock(&disp->client.lock);\n\tif (!head->object.func) {\n\t\tnvkm_object_ctor(&nvkm_uhead, oclass, &head->object);\n\t\t*pobject = &head->object;\n\t\tret = 0;\n\t}\n\tspin_unlock(&disp->client.lock);\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}