{
  "module_name": "vga.c",
  "hash_id": "ae06a7abaecac3f36e064454dbb2fa60aa9bab2e0ce85cd9063cb028bec3a825",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/engine/disp/vga.c",
  "human_readable_source": " \n#include <subdev/vga.h>\n\nu8\nnvkm_rdport(struct nvkm_device *device, int head, u16 port)\n{\n\tif (device->card_type >= NV_50)\n\t\treturn nvkm_rd08(device, 0x601000 + port);\n\n\tif (port == 0x03c0 || port == 0x03c1 ||\t \n\t    port == 0x03c2 || port == 0x03da ||\t \n\t    port == 0x03d4 || port == 0x03d5)\t \n\t\treturn nvkm_rd08(device, 0x601000 + (head * 0x2000) + port);\n\n\tif (port == 0x03c2 || port == 0x03cc ||\t \n\t    port == 0x03c4 || port == 0x03c5 ||\t \n\t    port == 0x03ce || port == 0x03cf) {\t \n\t\tif (device->card_type < NV_40)\n\t\t\thead = 0;  \n\t\treturn nvkm_rd08(device, 0x0c0000 + (head * 0x2000) + port);\n\t}\n\n\treturn 0x00;\n}\n\nvoid\nnvkm_wrport(struct nvkm_device *device, int head, u16 port, u8 data)\n{\n\tif (device->card_type >= NV_50)\n\t\tnvkm_wr08(device, 0x601000 + port, data);\n\telse\n\tif (port == 0x03c0 || port == 0x03c1 ||\t \n\t    port == 0x03c2 || port == 0x03da ||\t \n\t    port == 0x03d4 || port == 0x03d5)\t \n\t\tnvkm_wr08(device, 0x601000 + (head * 0x2000) + port, data);\n\telse\n\tif (port == 0x03c2 || port == 0x03cc ||\t \n\t    port == 0x03c4 || port == 0x03c5 ||\t \n\t    port == 0x03ce || port == 0x03cf) {\t \n\t\tif (device->card_type < NV_40)\n\t\t\thead = 0;  \n\t\tnvkm_wr08(device, 0x0c0000 + (head * 0x2000) + port, data);\n\t}\n}\n\nu8\nnvkm_rdvgas(struct nvkm_device *device, int head, u8 index)\n{\n\tnvkm_wrport(device, head, 0x03c4, index);\n\treturn nvkm_rdport(device, head, 0x03c5);\n}\n\nvoid\nnvkm_wrvgas(struct nvkm_device *device, int head, u8 index, u8 value)\n{\n\tnvkm_wrport(device, head, 0x03c4, index);\n\tnvkm_wrport(device, head, 0x03c5, value);\n}\n\nu8\nnvkm_rdvgag(struct nvkm_device *device, int head, u8 index)\n{\n\tnvkm_wrport(device, head, 0x03ce, index);\n\treturn nvkm_rdport(device, head, 0x03cf);\n}\n\nvoid\nnvkm_wrvgag(struct nvkm_device *device, int head, u8 index, u8 value)\n{\n\tnvkm_wrport(device, head, 0x03ce, index);\n\tnvkm_wrport(device, head, 0x03cf, value);\n}\n\nu8\nnvkm_rdvgac(struct nvkm_device *device, int head, u8 index)\n{\n\tnvkm_wrport(device, head, 0x03d4, index);\n\treturn nvkm_rdport(device, head, 0x03d5);\n}\n\nvoid\nnvkm_wrvgac(struct nvkm_device *device, int head, u8 index, u8 value)\n{\n\tnvkm_wrport(device, head, 0x03d4, index);\n\tnvkm_wrport(device, head, 0x03d5, value);\n}\n\nu8\nnvkm_rdvgai(struct nvkm_device *device, int head, u16 port, u8 index)\n{\n\tif (port == 0x03c4) return nvkm_rdvgas(device, head, index);\n\tif (port == 0x03ce) return nvkm_rdvgag(device, head, index);\n\tif (port == 0x03d4) return nvkm_rdvgac(device, head, index);\n\treturn 0x00;\n}\n\nvoid\nnvkm_wrvgai(struct nvkm_device *device, int head, u16 port, u8 index, u8 value)\n{\n\tif      (port == 0x03c4) nvkm_wrvgas(device, head, index, value);\n\telse if (port == 0x03ce) nvkm_wrvgag(device, head, index, value);\n\telse if (port == 0x03d4) nvkm_wrvgac(device, head, index, value);\n}\n\nbool\nnvkm_lockvgac(struct nvkm_device *device, bool lock)\n{\n\tbool locked = !nvkm_rdvgac(device, 0, 0x1f);\n\tu8 data = lock ? 0x99 : 0x57;\n\tif (device->card_type < NV_50)\n\t\tnvkm_wrvgac(device, 0, 0x1f, data);\n\telse\n\t\tnvkm_wrvgac(device, 0, 0x3f, data);\n\tif (device->chipset == 0x11) {\n\t\tif (!(nvkm_rd32(device, 0x001084) & 0x10000000))\n\t\t\tnvkm_wrvgac(device, 1, 0x1f, data);\n\t}\n\treturn locked;\n}\n\n \nu8\nnvkm_rdvgaowner(struct nvkm_device *device)\n{\n\tif (device->card_type < NV_50) {\n\t\tif (device->chipset == 0x11) {\n\t\t\tu32 tied = nvkm_rd32(device, 0x001084) & 0x10000000;\n\t\t\tif (tied == 0) {\n\t\t\t\tu8 slA = nvkm_rdvgac(device, 0, 0x28) & 0x80;\n\t\t\t\tu8 tvA = nvkm_rdvgac(device, 0, 0x33) & 0x01;\n\t\t\t\tu8 slB = nvkm_rdvgac(device, 1, 0x28) & 0x80;\n\t\t\t\tu8 tvB = nvkm_rdvgac(device, 1, 0x33) & 0x01;\n\t\t\t\tif (slA && !tvA) return 0x00;\n\t\t\t\tif (slB && !tvB) return 0x03;\n\t\t\t\tif (slA) return 0x00;\n\t\t\t\tif (slB) return 0x03;\n\t\t\t\treturn 0x00;\n\t\t\t}\n\t\t\treturn 0x04;\n\t\t}\n\n\t\treturn nvkm_rdvgac(device, 0, 0x44);\n\t}\n\n\treturn 0x00;\n}\n\nvoid\nnvkm_wrvgaowner(struct nvkm_device *device, u8 select)\n{\n\tif (device->card_type < NV_50) {\n\t\tu8 owner = (select == 1) ? 3 : select;\n\t\tif (device->chipset == 0x11) {\n\t\t\t \n\t\t\tnvkm_rdvgac(device, 0, 0x1f);\n\t\t\tnvkm_rdvgac(device, 1, 0x1f);\n\t\t}\n\n\t\tnvkm_wrvgac(device, 0, 0x44, owner);\n\n\t\tif (device->chipset == 0x11) {\n\t\t\tnvkm_wrvgac(device, 0, 0x2e, owner);\n\t\t\tnvkm_wrvgac(device, 0, 0x2e, owner);\n\t\t}\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}