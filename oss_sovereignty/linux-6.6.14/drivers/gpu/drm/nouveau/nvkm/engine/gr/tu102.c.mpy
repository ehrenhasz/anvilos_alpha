{
  "module_name": "tu102.c",
  "hash_id": "0366b8ce4a17c72a51cd8d724d08d5f82180e3fa77547cef7e3ccd9a786f1c1c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/engine/gr/tu102.c",
  "human_readable_source": " \n#include \"gf100.h\"\n#include \"ctxgf100.h\"\n\n#include <nvif/class.h>\n\nvoid\ntu102_gr_init_fecs_exceptions(struct gf100_gr *gr)\n{\n\tnvkm_wr32(gr->base.engine.subdev.device, 0x409c24, 0x006e0003);\n}\n\nvoid\ntu102_gr_init_fs(struct gf100_gr *gr)\n{\n\tstruct nvkm_device *device = gr->base.engine.subdev.device;\n\tint sm;\n\n\tgp100_grctx_generate_smid_config(gr);\n\tgk104_grctx_generate_gpc_tpc_nr(gr);\n\n\tfor (sm = 0; sm < gr->sm_nr; sm++) {\n\t\tint tpc = gv100_gr_nonpes_aware_tpc(gr, gr->sm[sm].gpc, gr->sm[sm].tpc);\n\n\t\tnvkm_wr32(device, GPC_UNIT(gr->sm[sm].gpc, 0x0c10 + tpc * 4), sm);\n\t}\n\n\tgm200_grctx_generate_dist_skip_table(gr);\n\tgf100_gr_init_num_tpc_per_gpc(gr, true, true);\n}\n\nvoid\ntu102_gr_init_zcull(struct gf100_gr *gr)\n{\n\tstruct nvkm_device *device = gr->base.engine.subdev.device;\n\tconst u32 magicgpc918 = DIV_ROUND_UP(0x00800000, gr->tpc_total);\n\tconst u8 tile_nr = gr->func->gpc_nr * gr->func->tpc_nr;\n\tu8 bank[GPC_MAX] = {}, gpc, i, j;\n\tu32 data;\n\n\tfor (i = 0; i < tile_nr; i += 8) {\n\t\tfor (data = 0, j = 0; j < 8 && i + j < gr->tpc_total; j++) {\n\t\t\tdata |= bank[gr->tile[i + j]] << (j * 4);\n\t\t\tbank[gr->tile[i + j]]++;\n\t\t}\n\t\tnvkm_wr32(device, GPC_BCAST(0x0980 + ((i / 8) * 4)), data);\n\t}\n\n\tfor (gpc = 0; gpc < gr->gpc_nr; gpc++) {\n\t\tnvkm_wr32(device, GPC_UNIT(gpc, 0x0914),\n\t\t\t  gr->screen_tile_row_offset << 8 | gr->tpc_nr[gpc]);\n\t\tnvkm_wr32(device, GPC_UNIT(gpc, 0x0910), 0x00040000 |\n\t\t\t\t\t\t\t gr->tpc_total);\n\t\tnvkm_wr32(device, GPC_UNIT(gpc, 0x0918), magicgpc918);\n\t}\n\n\tnvkm_wr32(device, GPC_BCAST(0x3fd4), magicgpc918);\n}\n\nstatic void\ntu102_gr_init_gpc_mmu(struct gf100_gr *gr)\n{\n\tstruct nvkm_device *device = gr->base.engine.subdev.device;\n\n\tnvkm_wr32(device, 0x418880, nvkm_rd32(device, 0x100c80) & 0xf8001fff);\n\tnvkm_wr32(device, 0x418890, 0x00000000);\n\tnvkm_wr32(device, 0x418894, 0x00000000);\n\n\tnvkm_wr32(device, 0x4188b4, nvkm_rd32(device, 0x100cc8));\n\tnvkm_wr32(device, 0x4188b8, nvkm_rd32(device, 0x100ccc));\n\tnvkm_wr32(device, 0x4188b0, nvkm_rd32(device, 0x100cc4));\n}\n\nstatic const struct gf100_gr_func\ntu102_gr = {\n\t.oneinit_tiles = gm200_gr_oneinit_tiles,\n\t.oneinit_sm_id = gv100_gr_oneinit_sm_id,\n\t.init = gf100_gr_init,\n\t.init_419bd8 = gv100_gr_init_419bd8,\n\t.init_gpc_mmu = tu102_gr_init_gpc_mmu,\n\t.init_vsc_stream_master = gk104_gr_init_vsc_stream_master,\n\t.init_zcull = tu102_gr_init_zcull,\n\t.init_num_active_ltcs = gf100_gr_init_num_active_ltcs,\n\t.init_rop_active_fbps = gp100_gr_init_rop_active_fbps,\n\t.init_swdx_pes_mask = gp102_gr_init_swdx_pes_mask,\n\t.init_fs = tu102_gr_init_fs,\n\t.init_fecs_exceptions = tu102_gr_init_fecs_exceptions,\n\t.init_ds_hww_esr_2 = gm200_gr_init_ds_hww_esr_2,\n\t.init_sked_hww_esr = gk104_gr_init_sked_hww_esr,\n\t.init_ppc_exceptions = gk104_gr_init_ppc_exceptions,\n\t.init_504430 = gv100_gr_init_504430,\n\t.init_shader_exceptions = gv100_gr_init_shader_exceptions,\n\t.init_rop_exceptions = gf100_gr_init_rop_exceptions,\n\t.init_exception2 = gf100_gr_init_exception2,\n\t.init_4188a4 = gv100_gr_init_4188a4,\n\t.trap_mp = gv100_gr_trap_mp,\n\t.fecs.reset = gf100_gr_fecs_reset,\n\t.rops = gm200_gr_rops,\n\t.gpc_nr = 6,\n\t.tpc_nr = 6,\n\t.ppc_nr = 3,\n\t.grctx = &tu102_grctx,\n\t.zbc = &gp102_gr_zbc,\n\t.sclass = {\n\t\t{ -1, -1, FERMI_TWOD_A },\n\t\t{ -1, -1, KEPLER_INLINE_TO_MEMORY_B },\n\t\t{ -1, -1, TURING_A, &gf100_fermi },\n\t\t{ -1, -1, TURING_COMPUTE_A },\n\t\t{}\n\t}\n};\n\nMODULE_FIRMWARE(\"nvidia/tu102/gr/fecs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/fecs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/fecs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/fecs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/gpccs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/gpccs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/gpccs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/gpccs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/sw_ctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/sw_nonctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/sw_bundle_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/sw_method_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/gr/sw_veid_bundle_init.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu104/gr/fecs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/fecs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/fecs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/fecs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/gpccs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/gpccs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/gpccs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/gpccs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/sw_ctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/sw_nonctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/sw_bundle_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/sw_method_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/gr/sw_veid_bundle_init.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu106/gr/fecs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/fecs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/fecs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/fecs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/gpccs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/gpccs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/gpccs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/gpccs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/sw_ctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/sw_nonctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/sw_bundle_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/sw_method_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/gr/sw_veid_bundle_init.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu117/gr/fecs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/fecs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/fecs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/fecs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/gpccs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/gpccs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/gpccs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/gpccs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/sw_ctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/sw_nonctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/sw_bundle_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/sw_method_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/gr/sw_veid_bundle_init.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu116/gr/fecs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/fecs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/fecs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/fecs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/gpccs_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/gpccs_inst.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/gpccs_data.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/gpccs_sig.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/sw_ctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/sw_nonctx.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/sw_bundle_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/sw_method_init.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/gr/sw_veid_bundle_init.bin\");\n\nint\ntu102_gr_av_to_init_veid(struct nvkm_blob *blob, struct gf100_gr_pack **ppack)\n{\n\treturn gk20a_gr_av_to_init_(blob, 64, 0x00100000, ppack);\n}\n\nstatic const struct gf100_gr_fwif\ntu102_gr_fwif[] = {\n\t{  0, gm200_gr_load, &tu102_gr, &gp108_gr_fecs_acr, &gp108_gr_gpccs_acr },\n\t{ -1, gm200_gr_nofw },\n\t{}\n};\n\nint\ntu102_gr_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst, struct nvkm_gr **pgr)\n{\n\treturn gf100_gr_new_(tu102_gr_fwif, device, type, inst, pgr);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}