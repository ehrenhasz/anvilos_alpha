{
  "module_name": "ctxgp102.c",
  "hash_id": "ef1c13cca27ac69dffb2d4d318fd12f85281daac2ff5b6208de6cc5131470bb3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/engine/gr/ctxgp102.c",
  "human_readable_source": " \n#include \"ctxgf100.h\"\n\n#include <subdev/fb.h>\n\n \n\nstatic void\ngp102_grctx_generate_r408840(struct gf100_gr *gr)\n{\n\tstruct nvkm_device *device = gr->base.engine.subdev.device;\n\tnvkm_mask(device, 0x408840, 0x00000003, 0x00000000);\n}\n\nvoid\ngp102_grctx_generate_attrib(struct gf100_gr_chan *chan)\n{\n\tstruct gf100_gr *gr = chan->gr;\n\tconst struct gf100_grctx_func *grctx = gr->func->grctx;\n\tconst u32  alpha = grctx->alpha_nr;\n\tconst u32 attrib = grctx->attrib_nr;\n\tconst u32   gfxp = grctx->gfxp_nr;\n\tconst int max_batches = 0xffff;\n\tu32 size = grctx->alpha_nr_max * gr->tpc_total;\n\tu32 ao = 0;\n\tu32 bo = ao + size;\n\tint gpc, ppc, n = 0;\n\n\tgf100_grctx_patch_wr32(chan, 0x405830, attrib);\n\tgf100_grctx_patch_wr32(chan, 0x40585c, alpha);\n\tgf100_grctx_patch_wr32(chan, 0x4064c4, ((alpha / 4) << 16) | max_batches);\n\n\tfor (gpc = 0; gpc < gr->gpc_nr; gpc++) {\n\t\tfor (ppc = 0; ppc < gr->func->ppc_nr; ppc++, n++) {\n\t\t\tconst u32 as =  alpha * gr->ppc_tpc_nr[gpc][ppc];\n\t\t\tconst u32 bs = attrib * gr->ppc_tpc_max;\n\t\t\tconst u32 gs =   gfxp * gr->ppc_tpc_max;\n\t\t\tconst u32 u = 0x418ea0 + (n * 0x04);\n\t\t\tconst u32 o = PPC_UNIT(gpc, ppc, 0);\n\t\t\tconst u32 p = GPC_UNIT(gpc, 0xc44 + (ppc * 4));\n\n\t\t\tif (!(gr->ppc_mask[gpc] & (1 << ppc)))\n\t\t\t\tcontinue;\n\n\t\t\tgf100_grctx_patch_wr32(chan, o + 0xc0, gs);\n\t\t\tgf100_grctx_patch_wr32(chan, p, bs);\n\t\t\tgf100_grctx_patch_wr32(chan, o + 0xf4, bo);\n\t\t\tgf100_grctx_patch_wr32(chan, o + 0xf0, bs);\n\t\t\tbo += gs;\n\t\t\tgf100_grctx_patch_wr32(chan, o + 0xe4, as);\n\t\t\tgf100_grctx_patch_wr32(chan, o + 0xf8, ao);\n\t\t\tao += grctx->alpha_nr_max * gr->ppc_tpc_nr[gpc][ppc];\n\t\t\tgf100_grctx_patch_wr32(chan, u, bs);\n\t\t}\n\t}\n\n\tgf100_grctx_patch_wr32(chan, 0x4181e4, 0x00000100);\n\tgf100_grctx_patch_wr32(chan, 0x41befc, 0x00000100);\n}\n\nu32\ngp102_grctx_generate_attrib_cb_size(struct gf100_gr *gr)\n{\n\tconst struct gf100_grctx_func *grctx = gr->func->grctx;\n\tu32 size = grctx->alpha_nr_max * gr->tpc_total;\n\tint gpc;\n\n\tfor (gpc = 0; gpc < gr->gpc_nr; gpc++)\n\t\tsize += grctx->gfxp_nr * gr->func->ppc_nr * gr->ppc_tpc_max;\n\n\treturn ((size * 0x20) + 127) & ~127;\n}\n\nconst struct gf100_grctx_func\ngp102_grctx = {\n\t.main = gf100_grctx_generate_main,\n\t.unkn = gk104_grctx_generate_unkn,\n\t.bundle = gm107_grctx_generate_bundle,\n\t.bundle_size = 0x3000,\n\t.bundle_min_gpm_fifo_depth = 0x180,\n\t.bundle_token_limit = 0x900,\n\t.pagepool = gp100_grctx_generate_pagepool,\n\t.pagepool_size = 0x20000,\n\t.attrib_cb_size = gp102_grctx_generate_attrib_cb_size,\n\t.attrib_cb = gp100_grctx_generate_attrib_cb,\n\t.attrib = gp102_grctx_generate_attrib,\n\t.attrib_nr_max = 0x4b0,\n\t.attrib_nr = 0x320,\n\t.alpha_nr_max = 0xc00,\n\t.alpha_nr = 0x800,\n\t.gfxp_nr = 0xba8,\n\t.sm_id = gm107_grctx_generate_sm_id,\n\t.rop_mapping = gf117_grctx_generate_rop_mapping,\n\t.dist_skip_table = gm200_grctx_generate_dist_skip_table,\n\t.r406500 = gm200_grctx_generate_r406500,\n\t.gpc_tpc_nr = gk104_grctx_generate_gpc_tpc_nr,\n\t.tpc_mask = gm200_grctx_generate_tpc_mask,\n\t.smid_config = gp100_grctx_generate_smid_config,\n\t.r419a3c = gm200_grctx_generate_r419a3c,\n\t.r408840 = gp102_grctx_generate_r408840,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}