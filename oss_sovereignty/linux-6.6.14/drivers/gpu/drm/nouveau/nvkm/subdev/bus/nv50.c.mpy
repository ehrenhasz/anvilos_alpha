{
  "module_name": "nv50.c",
  "hash_id": "a3556a119bfae8d9fcd86a82d7888d1a7f8b24be6d1f799c835b7e9683df70f4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bus/nv50.c",
  "human_readable_source": " \n#include \"priv.h\"\n\n#include <subdev/therm.h>\n#include <subdev/timer.h>\n\nstatic int\nnv50_bus_hwsq_exec(struct nvkm_bus *bus, u32 *data, u32 size)\n{\n\tstruct nvkm_device *device = bus->subdev.device;\n\tint i;\n\n\tnvkm_mask(device, 0x001098, 0x00000008, 0x00000000);\n\tnvkm_wr32(device, 0x001304, 0x00000000);\n\tfor (i = 0; i < size; i++)\n\t\tnvkm_wr32(device, 0x001400 + (i * 4), data[i]);\n\tnvkm_mask(device, 0x001098, 0x00000018, 0x00000018);\n\tnvkm_wr32(device, 0x00130c, 0x00000003);\n\n\tif (nvkm_msec(device, 2000,\n\t\tif (!(nvkm_rd32(device, 0x001308) & 0x00000100))\n\t\t\tbreak;\n\t) < 0)\n\t\treturn -ETIMEDOUT;\n\n\treturn 0;\n}\n\nvoid\nnv50_bus_intr(struct nvkm_bus *bus)\n{\n\tstruct nvkm_subdev *subdev = &bus->subdev;\n\tstruct nvkm_device *device = subdev->device;\n\tu32 stat = nvkm_rd32(device, 0x001100) & nvkm_rd32(device, 0x001140);\n\n\tif (stat & 0x00000008) {\n\t\tu32 addr = nvkm_rd32(device, 0x009084);\n\t\tu32 data = nvkm_rd32(device, 0x009088);\n\n\t\tnvkm_error_ratelimited(subdev, \"MMIO %s of %08x FAULT at %06x\\n\",\n\t\t\t\t       (addr & 0x00000002) ? \"write\" : \"read\", data,\n\t\t\t\t       (addr & 0x00fffffc));\n\n\t\tstat &= ~0x00000008;\n\t\tnvkm_wr32(device, 0x001100, 0x00000008);\n\t}\n\n\tif (stat & 0x00010000) {\n\t\tstruct nvkm_therm *therm = device->therm;\n\t\tif (therm)\n\t\t\tnvkm_subdev_intr(&therm->subdev);\n\t\tstat &= ~0x00010000;\n\t\tnvkm_wr32(device, 0x001100, 0x00010000);\n\t}\n\n\tif (stat) {\n\t\tnvkm_error(subdev, \"intr %08x\\n\", stat);\n\t\tnvkm_mask(device, 0x001140, stat, 0);\n\t}\n}\n\nvoid\nnv50_bus_init(struct nvkm_bus *bus)\n{\n\tstruct nvkm_device *device = bus->subdev.device;\n\tnvkm_wr32(device, 0x001100, 0xffffffff);\n\tnvkm_wr32(device, 0x001140, 0x00010008);\n}\n\nstatic const struct nvkm_bus_func\nnv50_bus = {\n\t.init = nv50_bus_init,\n\t.intr = nv50_bus_intr,\n\t.hwsq_exec = nv50_bus_hwsq_exec,\n\t.hwsq_size = 64,\n};\n\nint\nnv50_bus_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t     struct nvkm_bus **pbus)\n{\n\treturn nvkm_bus_new_(&nv50_bus, device, type, inst, pbus);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}