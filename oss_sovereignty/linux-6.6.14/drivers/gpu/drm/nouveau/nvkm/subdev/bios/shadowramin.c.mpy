{
  "module_name": "shadowramin.c",
  "hash_id": "b16d7db8e169120d318ca89a648fef82ef1384c08687acba68420b1014f5c6ab",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bios/shadowramin.c",
  "human_readable_source": " \n#include \"priv.h\"\n\nstruct priv {\n\tstruct nvkm_bios *bios;\n\tu32 bar0;\n};\n\nstatic u32\npramin_read(void *data, u32 offset, u32 length, struct nvkm_bios *bios)\n{\n\tstruct nvkm_device *device = bios->subdev.device;\n\tu32 i;\n\tif (offset + length <= 0x00100000) {\n\t\tfor (i = offset; i < offset + length; i += 4)\n\t\t\t*(u32 *)&bios->data[i] = nvkm_rd32(device, 0x700000 + i);\n\t\treturn length;\n\t}\n\treturn 0;\n}\n\nstatic void\npramin_fini(void *data)\n{\n\tstruct priv *priv = data;\n\tif (priv) {\n\t\tstruct nvkm_device *device = priv->bios->subdev.device;\n\t\tnvkm_wr32(device, 0x001700, priv->bar0);\n\t\tkfree(priv);\n\t}\n}\n\nstatic void *\npramin_init(struct nvkm_bios *bios, const char *name)\n{\n\tstruct nvkm_subdev *subdev = &bios->subdev;\n\tstruct nvkm_device *device = subdev->device;\n\tstruct priv *priv = NULL;\n\tu64 addr = 0;\n\n\t \n\tif (device->card_type < NV_50)\n\t\treturn NULL;\n\n\t \n\tif (device->card_type >= GA100)\n\t\taddr = device->chipset == 0x170;  \n\telse\n\tif (device->card_type >= GM100)\n\t\taddr = nvkm_rd32(device, 0x021c04);\n\telse\n\tif (device->card_type >= NV_C0)\n\t\taddr = nvkm_rd32(device, 0x022500);\n\tif (addr & 0x00000001) {\n\t\tnvkm_debug(subdev, \"... display disabled\\n\");\n\t\treturn ERR_PTR(-ENODEV);\n\t}\n\n\t \n\tif (device->card_type >= GV100)\n\t\taddr = nvkm_rd32(device, 0x625f04);\n\telse\n\t\taddr = nvkm_rd32(device, 0x619f04);\n\tif (!(addr & 0x00000008)) {\n\t\tnvkm_debug(subdev, \"... not enabled\\n\");\n\t\treturn ERR_PTR(-ENODEV);\n\t}\n\tif ( (addr & 0x00000003) != 1) {\n\t\tnvkm_debug(subdev, \"... not in vram\\n\");\n\t\treturn ERR_PTR(-ENODEV);\n\t}\n\n\t \n\taddr = (addr & 0xffffff00) << 8;\n\tif (!addr) {\n\t\taddr  = (u64)nvkm_rd32(device, 0x001700) << 16;\n\t\taddr += 0xf0000;\n\t}\n\n\t \n\tif (!(priv = kmalloc(sizeof(*priv), GFP_KERNEL))) {\n\t\tnvkm_error(subdev, \"... out of memory\\n\");\n\t\treturn ERR_PTR(-ENOMEM);\n\t}\n\n\tpriv->bios = bios;\n\tpriv->bar0 = nvkm_rd32(device, 0x001700);\n\tnvkm_wr32(device, 0x001700, addr >> 16);\n\treturn priv;\n}\n\nconst struct nvbios_source\nnvbios_ramin = {\n\t.name = \"PRAMIN\",\n\t.init = pramin_init,\n\t.fini = pramin_fini,\n\t.read = pramin_read,\n\t.rw = true,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}