{
  "module_name": "busnv04.c",
  "hash_id": "14151d4b71dcc8238e2bd1c4dc9ce0bed4f9a2c3c70aa5f63dba1d2dfc69f0b3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/i2c/busnv04.c",
  "human_readable_source": " \n#define nv04_i2c_bus(p) container_of((p), struct nv04_i2c_bus, base)\n#include \"bus.h\"\n\n#include <subdev/vga.h>\n\nstruct nv04_i2c_bus {\n\tstruct nvkm_i2c_bus base;\n\tu8 drive;\n\tu8 sense;\n};\n\nstatic void\nnv04_i2c_bus_drive_scl(struct nvkm_i2c_bus *base, int state)\n{\n\tstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\n\tstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\n\tu8 val = nvkm_rdvgac(device, 0, bus->drive);\n\tif (state) val |= 0x20;\n\telse\t   val &= 0xdf;\n\tnvkm_wrvgac(device, 0, bus->drive, val | 0x01);\n}\n\nstatic void\nnv04_i2c_bus_drive_sda(struct nvkm_i2c_bus *base, int state)\n{\n\tstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\n\tstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\n\tu8 val = nvkm_rdvgac(device, 0, bus->drive);\n\tif (state) val |= 0x10;\n\telse\t   val &= 0xef;\n\tnvkm_wrvgac(device, 0, bus->drive, val | 0x01);\n}\n\nstatic int\nnv04_i2c_bus_sense_scl(struct nvkm_i2c_bus *base)\n{\n\tstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\n\tstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\n\treturn !!(nvkm_rdvgac(device, 0, bus->sense) & 0x04);\n}\n\nstatic int\nnv04_i2c_bus_sense_sda(struct nvkm_i2c_bus *base)\n{\n\tstruct nv04_i2c_bus *bus = nv04_i2c_bus(base);\n\tstruct nvkm_device *device = bus->base.pad->i2c->subdev.device;\n\treturn !!(nvkm_rdvgac(device, 0, bus->sense) & 0x08);\n}\n\nstatic const struct nvkm_i2c_bus_func\nnv04_i2c_bus_func = {\n\t.drive_scl = nv04_i2c_bus_drive_scl,\n\t.drive_sda = nv04_i2c_bus_drive_sda,\n\t.sense_scl = nv04_i2c_bus_sense_scl,\n\t.sense_sda = nv04_i2c_bus_sense_sda,\n\t.xfer = nvkm_i2c_bit_xfer,\n};\n\nint\nnv04_i2c_bus_new(struct nvkm_i2c_pad *pad, int id, u8 drive, u8 sense,\n\t\t struct nvkm_i2c_bus **pbus)\n{\n\tstruct nv04_i2c_bus *bus;\n\n\tif (!(bus = kzalloc(sizeof(*bus), GFP_KERNEL)))\n\t\treturn -ENOMEM;\n\t*pbus = &bus->base;\n\n\tnvkm_i2c_bus_ctor(&nv04_i2c_bus_func, pad, id, &bus->base);\n\tbus->drive = drive;\n\tbus->sense = sense;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}