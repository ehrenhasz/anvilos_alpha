{
  "module_name": "tu102.c",
  "hash_id": "a60c34e867192827bd452d92de33dac23b1164f25c655383b172842a9a096a5d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/acr/tu102.c",
  "human_readable_source": " \n#include \"priv.h\"\n\n#include <core/firmware.h>\n#include <core/memory.h>\n#include <subdev/gsp.h>\n#include <subdev/pmu.h>\n#include <engine/sec2.h>\n\n#include <nvfw/acr.h>\n\nint\ntu102_acr_init(struct nvkm_acr *acr)\n{\n\tint ret = nvkm_acr_hsfw_boot(acr, \"AHESASC\");\n\tif (ret)\n\t\treturn ret;\n\n\treturn nvkm_acr_hsfw_boot(acr, \"ASB\");\n}\n\nstatic int\ntu102_acr_wpr_build(struct nvkm_acr *acr, struct nvkm_acr_lsf *rtos)\n{\n\tstruct nvkm_acr_lsfw *lsfw;\n\tu32 offset = 0;\n\tint ret;\n\n\t \n\tnvkm_wo32(acr->wpr, 0x200, 0xffffffff);\n\n\t \n\tlist_for_each_entry(lsfw, &acr->lsfw, head) {\n\t\tstruct lsf_signature_v1 *sig = (void *)lsfw->sig->data;\n\t\tstruct wpr_header_v1 hdr = {\n\t\t\t.falcon_id = lsfw->id,\n\t\t\t.lsb_offset = lsfw->offset.lsb,\n\t\t\t.bootstrap_owner = NVKM_ACR_LSF_GSPLITE,\n\t\t\t.lazy_bootstrap = 1,\n\t\t\t.bin_version = sig->version,\n\t\t\t.status = WPR_HEADER_V1_STATUS_COPY,\n\t\t};\n\n\t\t \n\t\tnvkm_wobj(acr->wpr, offset, &hdr, sizeof(hdr));\n\t\toffset += sizeof(hdr);\n\n\t\t \n\t\tret = gp102_acr_wpr_build_lsb(acr, lsfw);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\t \n\t\tnvkm_wobj(acr->wpr, lsfw->offset.img,\n\t\t\t\t    lsfw->img.data,\n\t\t\t\t    lsfw->img.size);\n\n\t\t \n\t\tlsfw->func->bld_write(acr, lsfw->offset.bld, lsfw);\n\t}\n\n\t \n\tnvkm_wo32(acr->wpr, offset, WPR_HEADER_V1_FALCON_ID_INVALID);\n\treturn 0;\n}\n\nstatic int\ntu102_acr_hsfw_nofw(struct nvkm_acr *acr, const char *bl, const char *fw,\n\t\t    const char *name, int version,\n\t\t    const struct nvkm_acr_hsf_fwif *fwif)\n{\n\treturn 0;\n}\n\nMODULE_FIRMWARE(\"nvidia/tu102/acr/unload_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/acr/ucode_unload.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu104/acr/unload_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/acr/ucode_unload.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu106/acr/unload_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/acr/ucode_unload.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu116/acr/unload_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/acr/ucode_unload.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu117/acr/unload_bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/acr/ucode_unload.bin\");\n\nstatic const struct nvkm_acr_hsf_fwif\ntu102_acr_unload_fwif[] = {\n\t{  0, gm200_acr_hsfw_ctor, &gp108_acr_hsfw_0, NVKM_ACR_HSF_PMU, 0, 0x00000000 },\n\t{ -1, tu102_acr_hsfw_nofw },\n\t{}\n};\n\nMODULE_FIRMWARE(\"nvidia/tu102/acr/ucode_asb.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/acr/ucode_asb.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/acr/ucode_asb.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/acr/ucode_asb.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/acr/ucode_asb.bin\");\n\nstatic const struct nvkm_acr_hsf_fwif\ntu102_acr_asb_fwif[] = {\n\t{  0, gm200_acr_hsfw_ctor, &gp108_acr_hsfw_0, NVKM_ACR_HSF_GSP, 0, 0x00000000 },\n\t{ -1, tu102_acr_hsfw_nofw },\n\t{}\n};\n\nMODULE_FIRMWARE(\"nvidia/tu102/acr/bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu102/acr/ucode_ahesasc.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu104/acr/bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu104/acr/ucode_ahesasc.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu106/acr/bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu106/acr/ucode_ahesasc.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu116/acr/bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu116/acr/ucode_ahesasc.bin\");\n\nMODULE_FIRMWARE(\"nvidia/tu117/acr/bl.bin\");\nMODULE_FIRMWARE(\"nvidia/tu117/acr/ucode_ahesasc.bin\");\n\nstatic const struct nvkm_acr_hsf_fwif\ntu102_acr_ahesasc_fwif[] = {\n\t{  0, gm200_acr_hsfw_ctor, &gp108_acr_load_0, NVKM_ACR_HSF_SEC2, 0, 0x00000000 },\n\t{ -1, tu102_acr_hsfw_nofw },\n\t{}\n};\n\nstatic const struct nvkm_acr_func\ntu102_acr = {\n\t.ahesasc = tu102_acr_ahesasc_fwif,\n\t.asb = tu102_acr_asb_fwif,\n\t.unload = tu102_acr_unload_fwif,\n\t.wpr_parse = gp102_acr_wpr_parse,\n\t.wpr_layout = gp102_acr_wpr_layout,\n\t.wpr_alloc = gp102_acr_wpr_alloc,\n\t.wpr_patch = gp102_acr_wpr_patch,\n\t.wpr_build = tu102_acr_wpr_build,\n\t.wpr_check = gm200_acr_wpr_check,\n\t.init = tu102_acr_init,\n};\n\nstatic int\ntu102_acr_load(struct nvkm_acr *acr, int version,\n\t       const struct nvkm_acr_fwif *fwif)\n{\n\tstruct nvkm_subdev *subdev = &acr->subdev;\n\tconst struct nvkm_acr_hsf_fwif *hsfwif;\n\n\thsfwif = nvkm_firmware_load(subdev, fwif->func->ahesasc, \"AcrAHESASC\",\n\t\t\t\t    acr, \"acr/bl\", \"acr/ucode_ahesasc\",\n\t\t\t\t    \"AHESASC\");\n\tif (IS_ERR(hsfwif))\n\t\treturn PTR_ERR(hsfwif);\n\n\thsfwif = nvkm_firmware_load(subdev, fwif->func->asb, \"AcrASB\",\n\t\t\t\t    acr, \"acr/bl\", \"acr/ucode_asb\", \"ASB\");\n\tif (IS_ERR(hsfwif))\n\t\treturn PTR_ERR(hsfwif);\n\n\thsfwif = nvkm_firmware_load(subdev, fwif->func->unload, \"AcrUnload\",\n\t\t\t\t    acr, \"acr/unload_bl\", \"acr/ucode_unload\",\n\t\t\t\t    \"unload\");\n\tif (IS_ERR(hsfwif))\n\t\treturn PTR_ERR(hsfwif);\n\n\treturn 0;\n}\n\nstatic const struct nvkm_acr_fwif\ntu102_acr_fwif[] = {\n\t{  0, tu102_acr_load, &tu102_acr },\n\t{ -1, gm200_acr_nofw, &gm200_acr },\n\t{}\n};\n\nint\ntu102_acr_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t      struct nvkm_acr **pacr)\n{\n\treturn nvkm_acr_new_(tu102_acr_fwif, device, type, inst, pacr);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}