{
  "module_name": "gddr3.c",
  "hash_id": "00e747e6bc9a289304bcfa290b0f9ed16e7d1a13518102c1543b619c556ad84a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/fb/gddr3.c",
  "human_readable_source": " \n#include \"ram.h\"\n\nstruct ramxlat {\n\tint id;\n\tu8 enc;\n};\n\nstatic inline int\nramxlat(const struct ramxlat *xlat, int id)\n{\n\twhile (xlat->id >= 0) {\n\t\tif (xlat->id == id)\n\t\t\treturn xlat->enc;\n\t\txlat++;\n\t}\n\treturn -EINVAL;\n}\n\nstatic const struct ramxlat\nramgddr3_cl_lo[] = {\n\t{ 5, 5 }, { 7, 7 }, { 8, 0 }, { 9, 1 }, { 10, 2 }, { 11, 3 }, { 12, 8 },\n\t \n\t{ 13, 9 }, { 14, 6 },\n\t \n\t \n\t{ -1 }\n};\n\nstatic const struct ramxlat\nramgddr3_cl_hi[] = {\n\t{ 10, 2 }, { 11, 3 }, { 12, 4 }, { 13, 5 }, { 14, 6 }, { 15, 7 },\n\t{ 16, 0 }, { 17, 1 },\n\t{ -1 }\n};\n\nstatic const struct ramxlat\nramgddr3_wr_lo[] = {\n\t{ 5, 2 }, { 7, 4 }, { 8, 5 }, { 9, 6 }, { 10, 7 },\n\t{ 11, 0 }, { 13 , 1 },\n\t \n\t{ 4, 0 }, { 6, 3 }, { 12, 1 },\n\t{ -1 }\n};\n\nint\nnvkm_gddr3_calc(struct nvkm_ram *ram)\n{\n\tint CL, WR, CWL, DLL = 0, ODT = 0, RON, hi;\n\n\tswitch (ram->next->bios.timing_ver) {\n\tcase 0x10:\n\t\tCWL = ram->next->bios.timing_10_CWL;\n\t\tCL  = ram->next->bios.timing_10_CL;\n\t\tWR  = ram->next->bios.timing_10_WR;\n\t\tDLL = !ram->next->bios.ramcfg_DLLoff;\n\t\tODT = ram->next->bios.timing_10_ODT;\n\t\tRON = ram->next->bios.ramcfg_RON;\n\t\tbreak;\n\tcase 0x20:\n\t\tCWL = (ram->next->bios.timing[1] & 0x00000f80) >> 7;\n\t\tCL  = (ram->next->bios.timing[1] & 0x0000001f) >> 0;\n\t\tWR  = (ram->next->bios.timing[2] & 0x007f0000) >> 16;\n\t\t \n\t\tDLL = !(ram->mr[1] & 0x1);\n\t\tRON = !((ram->mr[1] & 0x300) >> 8);\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOSYS;\n\t}\n\n\tif (ram->next->bios.timing_ver == 0x20 ||\n\t    ram->next->bios.ramcfg_timing == 0xff) {\n\t\tODT =  (ram->mr[1] & 0xc) >> 2;\n\t}\n\n\thi = ram->mr[2] & 0x1;\n\tCL  = ramxlat(hi ? ramgddr3_cl_hi : ramgddr3_cl_lo, CL);\n\tWR  = ramxlat(ramgddr3_wr_lo, WR);\n\tif (CL < 0 || CWL < 1 || CWL > 7 || WR < 0)\n\t\treturn -EINVAL;\n\n\tram->mr[0] &= ~0xf74;\n\tram->mr[0] |= (CWL & 0x07) << 9;\n\tram->mr[0] |= (CL & 0x07) << 4;\n\tram->mr[0] |= (CL & 0x08) >> 1;\n\n\tram->mr[1] &= ~0x3fc;\n\tram->mr[1] |= (ODT & 0x03) << 2;\n\tram->mr[1] |= (RON & 0x03) << 8;\n\tram->mr[1] |= (WR  & 0x03) << 4;\n\tram->mr[1] |= (WR  & 0x04) << 5;\n\tram->mr[1] |= !DLL << 6;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}