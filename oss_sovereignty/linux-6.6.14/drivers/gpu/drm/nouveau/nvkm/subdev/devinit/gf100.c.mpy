{
  "module_name": "gf100.c",
  "hash_id": "f434081d2f08b06baf15fd9160c470e14c7dd42bae98c998d932121c244e7d40",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/devinit/gf100.c",
  "human_readable_source": " \n#include \"nv50.h\"\n\n#include <subdev/bios.h>\n#include <subdev/bios/init.h>\n#include <subdev/bios/pll.h>\n#include <subdev/clk/pll.h>\n\nint\ngf100_devinit_pll_set(struct nvkm_devinit *init, u32 type, u32 freq)\n{\n\tstruct nvkm_subdev *subdev = &init->subdev;\n\tstruct nvkm_device *device = subdev->device;\n\tstruct nvbios_pll info;\n\tint N, fN, M, P;\n\tint ret;\n\n\tret = nvbios_pll_parse(device->bios, type, &info);\n\tif (ret)\n\t\treturn ret;\n\n\tret = gt215_pll_calc(subdev, &info, freq, &N, &fN, &M, &P);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tswitch (info.type) {\n\tcase PLL_VPLL0:\n\tcase PLL_VPLL1:\n\tcase PLL_VPLL2:\n\tcase PLL_VPLL3:\n\t\tnvkm_mask(device, info.reg + 0x0c, 0x00000000, 0x00000100);\n\t\tnvkm_wr32(device, info.reg + 0x04, (P << 16) | (N << 8) | M);\n\t\tnvkm_wr32(device, info.reg + 0x10, fN << 16);\n\t\tbreak;\n\tdefault:\n\t\tnvkm_warn(subdev, \"%08x/%dKhz unimplemented\\n\", type, freq);\n\t\tret = -EINVAL;\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nstatic void\ngf100_devinit_disable(struct nvkm_devinit *init)\n{\n\tstruct nvkm_device *device = init->subdev.device;\n\tu32 r022500 = nvkm_rd32(device, 0x022500);\n\n\tif (r022500 & 0x00000001)\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_DISP, 0);\n\n\tif (r022500 & 0x00000002) {\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_MSPDEC, 0);\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_MSPPP, 0);\n\t}\n\n\tif (r022500 & 0x00000004)\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_MSVLD, 0);\n\tif (r022500 & 0x00000008)\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_MSENC, 0);\n\tif (r022500 & 0x00000100)\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_CE, 0);\n\tif (r022500 & 0x00000200)\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_CE, 1);\n}\n\nvoid\ngf100_devinit_preinit(struct nvkm_devinit *base)\n{\n\tstruct nv50_devinit *init = nv50_devinit(base);\n\tstruct nvkm_subdev *subdev = &init->base.subdev;\n\tstruct nvkm_device *device = subdev->device;\n\n\t \n\tbase->post = ((nvkm_rd32(device, 0x2240c) & BIT(1)) == 0);\n}\n\nstatic const struct nvkm_devinit_func\ngf100_devinit = {\n\t.preinit = gf100_devinit_preinit,\n\t.init = nv50_devinit_init,\n\t.post = nv04_devinit_post,\n\t.pll_set = gf100_devinit_pll_set,\n\t.disable = gf100_devinit_disable,\n};\n\nint\ngf100_devinit_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t\t  struct nvkm_devinit **pinit)\n{\n\treturn nv50_devinit_new_(&gf100_devinit, device, type, inst, pinit);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}