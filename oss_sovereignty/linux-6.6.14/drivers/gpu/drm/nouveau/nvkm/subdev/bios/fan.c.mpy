{
  "module_name": "fan.c",
  "hash_id": "8980bbbb8bfc62a16d810f07ff35854716e97aa6afc8a28e086c5b506b7b4fc7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bios/fan.c",
  "human_readable_source": " \n#include <subdev/bios.h>\n#include <subdev/bios/bit.h>\n#include <subdev/bios/fan.h>\n\nstatic u32\nnvbios_fan_table(struct nvkm_bios *bios, u8 *ver, u8 *hdr, u8 *cnt, u8 *len)\n{\n\tstruct bit_entry bit_P;\n\tu32 fan = 0;\n\n\tif (!bit_entry(bios, 'P', &bit_P)) {\n\t\tif (bit_P.version == 2 && bit_P.length >= 0x5c)\n\t\t\tfan = nvbios_rd32(bios, bit_P.offset + 0x58);\n\n\t\tif (fan) {\n\t\t\t*ver = nvbios_rd08(bios, fan + 0);\n\t\t\tswitch (*ver) {\n\t\t\tcase 0x10:\n\t\t\t\t*hdr = nvbios_rd08(bios, fan + 1);\n\t\t\t\t*len = nvbios_rd08(bios, fan + 2);\n\t\t\t\t*cnt = nvbios_rd08(bios, fan + 3);\n\t\t\t\treturn fan;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic u32\nnvbios_fan_entry(struct nvkm_bios *bios, int idx, u8 *ver, u8 *hdr,\n\t\t u8 *cnt, u8 *len)\n{\n\tu32 data = nvbios_fan_table(bios, ver, hdr, cnt, len);\n\tif (data && idx < *cnt)\n\t\treturn data + *hdr + (idx * (*len));\n\treturn 0;\n}\n\nu32\nnvbios_fan_parse(struct nvkm_bios *bios, struct nvbios_therm_fan *fan)\n{\n\tu8 ver, hdr, cnt, len;\n\n\tu32 data = nvbios_fan_entry(bios, 0, &ver, &hdr, &cnt, &len);\n\tif (data) {\n\t\tu8 type = nvbios_rd08(bios, data + 0x00);\n\t\tswitch (type) {\n\t\tcase 0:\n\t\t\tfan->type = NVBIOS_THERM_FAN_TOGGLE;\n\t\t\tbreak;\n\t\tcase 1:\n\t\tcase 2:\n\t\t\t \n\t\t\tfan->type = NVBIOS_THERM_FAN_PWM;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tfan->type = NVBIOS_THERM_FAN_UNK;\n\t\t}\n\n\t\tfan->fan_mode = NVBIOS_THERM_FAN_LINEAR;\n\t\tfan->min_duty = nvbios_rd08(bios, data + 0x02);\n\t\tfan->max_duty = nvbios_rd08(bios, data + 0x03);\n\n\t\tfan->pwm_freq = nvbios_rd32(bios, data + 0x0b) & 0xffffff;\n\t}\n\n\treturn data;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}