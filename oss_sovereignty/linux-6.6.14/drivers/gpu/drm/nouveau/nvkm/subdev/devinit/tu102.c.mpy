{
  "module_name": "tu102.c",
  "hash_id": "27acfaaf2f2397334f037879b83a8f82eabd274e87f5ab59c10940575ef74b68",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/devinit/tu102.c",
  "human_readable_source": " \n#include \"nv50.h\"\n\n#include <subdev/bios.h>\n#include <subdev/bios/pll.h>\n#include <subdev/clk/pll.h>\n\nstatic int\ntu102_devinit_pll_set(struct nvkm_devinit *init, u32 type, u32 freq)\n{\n\tstruct nvkm_subdev *subdev = &init->subdev;\n\tstruct nvkm_device *device = subdev->device;\n\tstruct nvbios_pll info;\n\tint head = type - PLL_VPLL0;\n\tint N, fN, M, P;\n\tint ret;\n\n\tret = nvbios_pll_parse(device->bios, type, &info);\n\tif (ret)\n\t\treturn ret;\n\n\tret = gt215_pll_calc(subdev, &info, freq, &N, &fN, &M, &P);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tswitch (info.type) {\n\tcase PLL_VPLL0:\n\tcase PLL_VPLL1:\n\tcase PLL_VPLL2:\n\tcase PLL_VPLL3:\n\t\tnvkm_wr32(device, 0x00ef10 + (head * 0x40), fN << 16);\n\t\tnvkm_wr32(device, 0x00ef04 + (head * 0x40), (P << 16) |\n\t\t\t\t\t\t\t    (N <<  8) |\n\t\t\t\t\t\t\t    (M <<  0));\n\t\t \n\t\tnvkm_wr32(device, 0x00ef0c + (head * 0x40), 0x00000900);\n\t\tnvkm_wr32(device, 0x00ef00 + (head * 0x40), 0x02000014);\n\t\tbreak;\n\tdefault:\n\t\tnvkm_warn(subdev, \"%08x/%dKhz unimplemented\\n\", type, freq);\n\t\tret = -EINVAL;\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nstatic int\ntu102_devinit_wait(struct nvkm_device *device)\n{\n\tunsigned timeout = 50 + 2000;\n\n\tdo {\n\t\tif (nvkm_rd32(device, 0x118128) & 0x00000001) {\n\t\t\tif ((nvkm_rd32(device, 0x118234) & 0x000000ff) == 0xff)\n\t\t\t\treturn 0;\n\t\t}\n\n\t\tusleep_range(1000, 2000);\n\t} while (timeout--);\n\n\treturn -ETIMEDOUT;\n}\n\nint\ntu102_devinit_post(struct nvkm_devinit *base, bool post)\n{\n\tstruct nv50_devinit *init = nv50_devinit(base);\n\tint ret;\n\n\tret = tu102_devinit_wait(init->base.subdev.device);\n\tif (ret)\n\t\treturn ret;\n\n\tgm200_devinit_preos(init, post);\n\treturn 0;\n}\n\nstatic const struct nvkm_devinit_func\ntu102_devinit = {\n\t.init = nv50_devinit_init,\n\t.post = tu102_devinit_post,\n\t.pll_set = tu102_devinit_pll_set,\n\t.disable = gm107_devinit_disable,\n};\n\nint\ntu102_devinit_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t\t  struct nvkm_devinit **pinit)\n{\n\treturn nv50_devinit_new_(&tu102_devinit, device, type, inst, pinit);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}