{
  "module_name": "memnv50.c",
  "hash_id": "c6b2b9796b9611daaeb67c240d461eff324c222b300332aa5574926a0ba3f6d4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/mmu/memnv50.c",
  "human_readable_source": " \n#include \"mem.h\"\n\n#include <core/memory.h>\n#include <subdev/bar.h>\n#include <subdev/fb.h>\n\n#include <nvif/class.h>\n#include <nvif/if500b.h>\n#include <nvif/if500d.h>\n#include <nvif/unpack.h>\n\nint\nnv50_mem_map(struct nvkm_mmu *mmu, struct nvkm_memory *memory, void *argv,\n\t     u32 argc, u64 *paddr, u64 *psize, struct nvkm_vma **pvma)\n{\n\tstruct nv50_vmm_map_v0 uvmm = {};\n\tunion {\n\t\tstruct nv50_mem_map_vn vn;\n\t\tstruct nv50_mem_map_v0 v0;\n\t} *args = argv;\n\tstruct nvkm_device *device = mmu->subdev.device;\n\tstruct nvkm_vmm *bar = nvkm_bar_bar1_vmm(device);\n\tu64 size = nvkm_memory_size(memory);\n\tint ret = -ENOSYS;\n\n\tif (!(ret = nvif_unpack(ret, &argv, &argc, args->v0, 0, 0, false))) {\n\t\tuvmm.ro   = args->v0.ro;\n\t\tuvmm.kind = args->v0.kind;\n\t\tuvmm.comp = args->v0.comp;\n\t} else\n\tif (!(ret = nvif_unvers(ret, &argv, &argc, args->vn))) {\n\t} else\n\t\treturn ret;\n\n\tret = nvkm_vmm_get(bar, 12, size, pvma);\n\tif (ret)\n\t\treturn ret;\n\n\t*paddr = device->func->resource_addr(device, 1) + (*pvma)->addr;\n\t*psize = (*pvma)->size;\n\treturn nvkm_memory_map(memory, 0, bar, *pvma, &uvmm, sizeof(uvmm));\n}\n\nint\nnv50_mem_new(struct nvkm_mmu *mmu, int type, u8 page, u64 size,\n\t     void *argv, u32 argc, struct nvkm_memory **pmemory)\n{\n\tunion {\n\t\tstruct nv50_mem_vn vn;\n\t\tstruct nv50_mem_v0 v0;\n\t} *args = argv;\n\tint ret = -ENOSYS;\n\tbool contig;\n\n\tif (!(ret = nvif_unpack(ret, &argv, &argc, args->v0, 0, 0, false))) {\n\t\ttype   = args->v0.bankswz ? 0x02 : 0x01;\n\t\tcontig = args->v0.contig;\n\t} else\n\tif (!(ret = nvif_unvers(ret, &argv, &argc, args->vn))) {\n\t\ttype   = 0x01;\n\t\tcontig = false;\n\t} else\n\t\treturn -ENOSYS;\n\n\treturn nvkm_ram_get(mmu->subdev.device, NVKM_RAM_MM_NORMAL, type,\n\t\t\t    page, size, contig, false, pmemory);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}