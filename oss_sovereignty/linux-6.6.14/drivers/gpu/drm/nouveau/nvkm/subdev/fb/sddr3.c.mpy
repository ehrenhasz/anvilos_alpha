{
  "module_name": "sddr3.c",
  "hash_id": "70e8d052279a25d157e6f2e7856e9b288ddbb97ea671659c107362e43db60e4f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/fb/sddr3.c",
  "human_readable_source": " \n#include \"priv.h\"\n#include \"ram.h\"\n\nstruct ramxlat {\n\tint id;\n\tu8 enc;\n};\n\nstatic inline int\nramxlat(const struct ramxlat *xlat, int id)\n{\n\twhile (xlat->id >= 0) {\n\t\tif (xlat->id == id)\n\t\t\treturn xlat->enc;\n\t\txlat++;\n\t}\n\treturn -EINVAL;\n}\n\nstatic const struct ramxlat\nramddr3_cl[] = {\n\t{ 5, 2 }, { 6, 4 }, { 7, 6 }, { 8, 8 }, { 9, 10 }, { 10, 12 },\n\t{ 11, 14 },\n\t \n\t{ 12, 1 }, { 13, 3 }, { 14, 5 },\n\t{ -1 }\n};\n\nstatic const struct ramxlat\nramddr3_wr[] = {\n\t{ 5, 1 }, { 6, 2 }, { 7, 3 }, { 8, 4 }, { 10, 5 }, { 12, 6 },\n\t \n\t{ 14, 7 }, { 15, 7 }, { 16, 0 },\n\t{ -1 }\n};\n\nstatic const struct ramxlat\nramddr3_cwl[] = {\n\t{ 5, 0 }, { 6, 1 }, { 7, 2 }, { 8, 3 },\n\t \n\t{ 9, 4 }, { 10, 5 },\n\t{ -1 }\n};\n\nint\nnvkm_sddr3_calc(struct nvkm_ram *ram)\n{\n\tint CWL, CL, WR, DLL = 0, ODT = 0;\n\n\tDLL = !ram->next->bios.ramcfg_DLLoff;\n\n\tswitch (ram->next->bios.timing_ver) {\n\tcase 0x10:\n\t\tif (ram->next->bios.timing_hdr < 0x17) {\n\t\t\t \n\t\t\treturn -ENOSYS;\n\t\t}\n\t\tCWL = ram->next->bios.timing_10_CWL;\n\t\tCL  = ram->next->bios.timing_10_CL;\n\t\tWR  = ram->next->bios.timing_10_WR;\n\t\tODT = ram->next->bios.timing_10_ODT;\n\t\tbreak;\n\tcase 0x20:\n\t\tCWL = (ram->next->bios.timing[1] & 0x00000f80) >> 7;\n\t\tCL  = (ram->next->bios.timing[1] & 0x0000001f) >> 0;\n\t\tWR  = (ram->next->bios.timing[2] & 0x007f0000) >> 16;\n\t\t \n\t\tODT =   (ram->mr[1] & 0x004) >> 2 |\n\t\t\t(ram->mr[1] & 0x040) >> 5 |\n\t\t        (ram->mr[1] & 0x200) >> 7;\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOSYS;\n\t}\n\n\tCWL = ramxlat(ramddr3_cwl, CWL);\n\tCL  = ramxlat(ramddr3_cl, CL);\n\tWR  = ramxlat(ramddr3_wr, WR);\n\tif (CL < 0 || CWL < 0 || WR < 0)\n\t\treturn -EINVAL;\n\n\tram->mr[0] &= ~0xf74;\n\tram->mr[0] |= (WR & 0x07) << 9;\n\tram->mr[0] |= (CL & 0x0e) << 3;\n\tram->mr[0] |= (CL & 0x01) << 2;\n\n\tram->mr[1] &= ~0x245;\n\tram->mr[1] |= (ODT & 0x1) << 2;\n\tram->mr[1] |= (ODT & 0x2) << 5;\n\tram->mr[1] |= (ODT & 0x4) << 7;\n\tram->mr[1] |= !DLL;\n\n\tram->mr[2] &= ~0x038;\n\tram->mr[2] |= (CWL & 0x07) << 3;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}