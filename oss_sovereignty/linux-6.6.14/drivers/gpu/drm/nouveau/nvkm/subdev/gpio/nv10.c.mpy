{
  "module_name": "nv10.c",
  "hash_id": "3ec7c8d13608273fb3d110ae6de0ae5e9a514386c53cfd5aa7f63ec47307542c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/gpio/nv10.c",
  "human_readable_source": " \n#include \"priv.h\"\n\nstatic int\nnv10_gpio_sense(struct nvkm_gpio *gpio, int line)\n{\n\tstruct nvkm_device *device = gpio->subdev.device;\n\tif (line < 2) {\n\t\tline = line * 16;\n\t\tline = nvkm_rd32(device, 0x600818) >> line;\n\t\treturn !!(line & 0x0100);\n\t} else\n\tif (line < 10) {\n\t\tline = (line - 2) * 4;\n\t\tline = nvkm_rd32(device, 0x60081c) >> line;\n\t\treturn !!(line & 0x04);\n\t} else\n\tif (line < 14) {\n\t\tline = (line - 10) * 4;\n\t\tline = nvkm_rd32(device, 0x600850) >> line;\n\t\treturn !!(line & 0x04);\n\t}\n\n\treturn -EINVAL;\n}\n\nstatic int\nnv10_gpio_drive(struct nvkm_gpio *gpio, int line, int dir, int out)\n{\n\tstruct nvkm_device *device = gpio->subdev.device;\n\tu32 reg, mask, data;\n\n\tif (line < 2) {\n\t\tline = line * 16;\n\t\treg  = 0x600818;\n\t\tmask = 0x00000011;\n\t\tdata = (dir << 4) | out;\n\t} else\n\tif (line < 10) {\n\t\tline = (line - 2) * 4;\n\t\treg  = 0x60081c;\n\t\tmask = 0x00000003;\n\t\tdata = (dir << 1) | out;\n\t} else\n\tif (line < 14) {\n\t\tline = (line - 10) * 4;\n\t\treg  = 0x600850;\n\t\tmask = 0x00000003;\n\t\tdata = (dir << 1) | out;\n\t} else {\n\t\treturn -EINVAL;\n\t}\n\n\tnvkm_mask(device, reg, mask << line, data << line);\n\treturn 0;\n}\n\nstatic void\nnv10_gpio_intr_stat(struct nvkm_gpio *gpio, u32 *hi, u32 *lo)\n{\n\tstruct nvkm_device *device = gpio->subdev.device;\n\tu32 intr = nvkm_rd32(device, 0x001104);\n\tu32 stat = nvkm_rd32(device, 0x001144) & intr;\n\t*lo = (stat & 0xffff0000) >> 16;\n\t*hi = (stat & 0x0000ffff);\n\tnvkm_wr32(device, 0x001104, intr);\n}\n\nstatic void\nnv10_gpio_intr_mask(struct nvkm_gpio *gpio, u32 type, u32 mask, u32 data)\n{\n\tstruct nvkm_device *device = gpio->subdev.device;\n\tu32 inte = nvkm_rd32(device, 0x001144);\n\tif (type & NVKM_GPIO_LO)\n\t\tinte = (inte & ~(mask << 16)) | (data << 16);\n\tif (type & NVKM_GPIO_HI)\n\t\tinte = (inte & ~mask) | data;\n\tnvkm_wr32(device, 0x001144, inte);\n}\n\nstatic const struct nvkm_gpio_func\nnv10_gpio = {\n\t.lines = 16,\n\t.intr_stat = nv10_gpio_intr_stat,\n\t.intr_mask = nv10_gpio_intr_mask,\n\t.drive = nv10_gpio_drive,\n\t.sense = nv10_gpio_sense,\n};\n\nint\nnv10_gpio_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t      struct nvkm_gpio **pgpio)\n{\n\treturn nvkm_gpio_new_(&nv10_gpio, device, type, inst, pgpio);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}