{
  "module_name": "mxm.c",
  "hash_id": "281bcff73b0342458d6a5d42f597693fb0601cbf3f1fc2a41df70709f796f89f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bios/mxm.c",
  "human_readable_source": " \n#include <subdev/bios.h>\n#include <subdev/bios/bit.h>\n#include <subdev/bios/mxm.h>\n\nu16\nmxm_table(struct nvkm_bios *bios, u8 *ver, u8 *hdr)\n{\n\tstruct nvkm_subdev *subdev = &bios->subdev;\n\tstruct bit_entry x;\n\n\tif (bit_entry(bios, 'x', &x)) {\n\t\tnvkm_debug(subdev, \"BIT 'x' table not present\\n\");\n\t\treturn 0x0000;\n\t}\n\n\t*ver = x.version;\n\t*hdr = x.length;\n\tif (*ver != 1 || *hdr < 3) {\n\t\tnvkm_warn(subdev, \"BIT 'x' table %d/%d unknown\\n\", *ver, *hdr);\n\t\treturn 0x0000;\n\t}\n\n\treturn x.offset;\n}\n\n \nstatic u8 g84_sor_map[16] = {\n\t0x00, 0x12, 0x22, 0x11, 0x32, 0x31, 0x11, 0x31,\n\t0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00\n};\n\nstatic u8 g92_sor_map[16] = {\n\t0x00, 0x12, 0x22, 0x11, 0x32, 0x31, 0x11, 0x31,\n\t0x11, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00\n};\n\nstatic u8 g94_sor_map[16] = {\n\t0x00, 0x14, 0x24, 0x11, 0x34, 0x31, 0x11, 0x31,\n\t0x11, 0x31, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00\n};\n\nstatic u8 g98_sor_map[16] = {\n\t0x00, 0x14, 0x12, 0x11, 0x00, 0x31, 0x11, 0x31,\n\t0x11, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00\n};\n\nu8\nmxm_sor_map(struct nvkm_bios *bios, u8 conn)\n{\n\tstruct nvkm_subdev *subdev = &bios->subdev;\n\tu8  ver, hdr;\n\tu16 mxm = mxm_table(bios, &ver, &hdr);\n\tif (mxm && hdr >= 6) {\n\t\tu16 map = nvbios_rd16(bios, mxm + 4);\n\t\tif (map) {\n\t\t\tver = nvbios_rd08(bios, map);\n\t\t\tif (ver == 0x10 || ver == 0x11) {\n\t\t\t\tif (conn < nvbios_rd08(bios, map + 3)) {\n\t\t\t\t\tmap += nvbios_rd08(bios, map + 1);\n\t\t\t\t\tmap += conn;\n\t\t\t\t\treturn nvbios_rd08(bios, map);\n\t\t\t\t}\n\n\t\t\t\treturn 0x00;\n\t\t\t}\n\n\t\t\tnvkm_warn(subdev, \"unknown sor map v%02x\\n\", ver);\n\t\t}\n\t}\n\n\tif (bios->version.chip == 0x84 || bios->version.chip == 0x86)\n\t\treturn g84_sor_map[conn];\n\tif (bios->version.chip == 0x92)\n\t\treturn g92_sor_map[conn];\n\tif (bios->version.chip == 0x94 || bios->version.chip == 0x96)\n\t\treturn g94_sor_map[conn];\n\tif (bios->version.chip == 0x98)\n\t\treturn g98_sor_map[conn];\n\n\tnvkm_warn(subdev, \"missing sor map\\n\");\n\treturn 0x00;\n}\n\nu8\nmxm_ddc_map(struct nvkm_bios *bios, u8 port)\n{\n\tstruct nvkm_subdev *subdev = &bios->subdev;\n\tu8  ver, hdr;\n\tu16 mxm = mxm_table(bios, &ver, &hdr);\n\tif (mxm && hdr >= 8) {\n\t\tu16 map = nvbios_rd16(bios, mxm + 6);\n\t\tif (map) {\n\t\t\tver = nvbios_rd08(bios, map);\n\t\t\tif (ver == 0x10) {\n\t\t\t\tif (port < nvbios_rd08(bios, map + 3)) {\n\t\t\t\t\tmap += nvbios_rd08(bios, map + 1);\n\t\t\t\t\tmap += port;\n\t\t\t\t\treturn nvbios_rd08(bios, map);\n\t\t\t\t}\n\n\t\t\t\treturn 0x00;\n\t\t\t}\n\n\t\t\tnvkm_warn(subdev, \"unknown ddc map v%02x\\n\", ver);\n\t\t}\n\t}\n\n\t \n\treturn (port << 4) | port;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}