{
  "module_name": "nv10.c",
  "hash_id": "79f4a87da759b9ed6c37017dafe2028d4f65fe10ac1298ae567291b4695f7b90",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/devinit/nv10.c",
  "human_readable_source": " \n#include \"nv04.h\"\n#include \"fbmem.h\"\n\n#include <subdev/bios.h>\n#include <subdev/bios/init.h>\n\nstatic void\nnv10_devinit_meminit(struct nvkm_devinit *init)\n{\n\tstruct nvkm_subdev *subdev = &init->subdev;\n\tstruct nvkm_device *device = subdev->device;\n\tstatic const int mem_width[] = { 0x10, 0x00, 0x20 };\n\tint mem_width_count;\n\tuint32_t patt = 0xdeadbeef;\n\tstruct io_mapping *fb;\n\tint i, j, k;\n\n\tif (device->card_type >= NV_11 && device->chipset >= 0x17)\n\t\tmem_width_count = 3;\n\telse\n\t\tmem_width_count = 2;\n\n\t \n\tfb = fbmem_init(device);\n\tif (!fb) {\n\t\tnvkm_error(subdev, \"failed to map fb\\n\");\n\t\treturn;\n\t}\n\n\tnvkm_wr32(device, NV10_PFB_REFCTRL, NV10_PFB_REFCTRL_VALID_1);\n\n\t \n\tfor (i = 0; i < mem_width_count; i++) {\n\t\tnvkm_mask(device, NV04_PFB_CFG0, 0x30, mem_width[i]);\n\n\t\tfor (j = 0; j < 4; j++) {\n\t\t\tfor (k = 0; k < 4; k++)\n\t\t\t\tfbmem_poke(fb, 0x1c, 0);\n\n\t\t\tfbmem_poke(fb, 0x1c, patt);\n\t\t\tfbmem_poke(fb, 0x3c, 0);\n\n\t\t\tif (fbmem_peek(fb, 0x1c) == patt)\n\t\t\t\tgoto mem_width_found;\n\t\t}\n\t}\n\nmem_width_found:\n\tpatt <<= 1;\n\n\t \n\tfor (i = 0; i < 4; i++) {\n\t\tint off = nvkm_rd32(device, 0x10020c) - 0x100000;\n\n\t\tfbmem_poke(fb, off, patt);\n\t\tfbmem_poke(fb, 0, 0);\n\n\t\tfbmem_peek(fb, 0);\n\t\tfbmem_peek(fb, 0);\n\t\tfbmem_peek(fb, 0);\n\t\tfbmem_peek(fb, 0);\n\n\t\tif (fbmem_peek(fb, off) == patt)\n\t\t\tgoto amount_found;\n\t}\n\n\t \n\tnvkm_mask(device, NV04_PFB_CFG0, 0x1000, 0);\n\namount_found:\n\tfbmem_fini(fb);\n}\n\nstatic const struct nvkm_devinit_func\nnv10_devinit = {\n\t.dtor = nv04_devinit_dtor,\n\t.preinit = nv04_devinit_preinit,\n\t.post = nv04_devinit_post,\n\t.meminit = nv10_devinit_meminit,\n\t.pll_set = nv04_devinit_pll_set,\n};\n\nint\nnv10_devinit_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t\t struct nvkm_devinit **pinit)\n{\n\treturn nv04_devinit_new_(&nv10_devinit, device, type, inst, pinit);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}