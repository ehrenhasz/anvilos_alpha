{
  "module_name": "extdev.c",
  "hash_id": "bfa5b38b148c288687740e08c6937a23a1d22537c0bc5fd1eb7ad194ba47f046",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bios/extdev.c",
  "human_readable_source": " \n#include <subdev/bios.h>\n#include <subdev/bios/dcb.h>\n#include <subdev/bios/extdev.h>\n\nstatic u16\nextdev_table(struct nvkm_bios *bios, u8 *ver, u8 *hdr, u8 *len, u8 *cnt)\n{\n\tu8  dcb_ver, dcb_hdr, dcb_cnt, dcb_len;\n\tu16 dcb, extdev = 0;\n\n\tdcb = dcb_table(bios, &dcb_ver, &dcb_hdr, &dcb_cnt, &dcb_len);\n\tif (!dcb || (dcb_ver != 0x30 && dcb_ver != 0x40 && dcb_ver != 0x41))\n\t\treturn 0x0000;\n\n\textdev = nvbios_rd16(bios, dcb + 18);\n\tif (!extdev)\n\t\treturn 0x0000;\n\n\t*ver = nvbios_rd08(bios, extdev + 0);\n\t*hdr = nvbios_rd08(bios, extdev + 1);\n\t*cnt = nvbios_rd08(bios, extdev + 2);\n\t*len = nvbios_rd08(bios, extdev + 3);\n\treturn extdev + *hdr;\n}\n\nbool\nnvbios_extdev_skip_probe(struct nvkm_bios *bios)\n{\n\tu8  ver, hdr, len, cnt;\n\tu16 data = extdev_table(bios, &ver, &hdr, &len, &cnt);\n\tif (data && ver == 0x40 && hdr >= 5) {\n\t\tu8 flags = nvbios_rd08(bios, data - hdr + 4);\n\t\tif (flags & 1)\n\t\t\treturn true;\n\t}\n\treturn false;\n}\n\nstatic u16\nnvbios_extdev_entry(struct nvkm_bios *bios, int idx, u8 *ver, u8 *len)\n{\n\tu8 hdr, cnt;\n\tu16 extdev = extdev_table(bios, ver, &hdr, len, &cnt);\n\tif (extdev && idx < cnt)\n\t\treturn extdev + idx * *len;\n\treturn 0x0000;\n}\n\nstatic void\nextdev_parse_entry(struct nvkm_bios *bios, u16 offset,\n\t\t   struct nvbios_extdev_func *entry)\n{\n\tentry->type = nvbios_rd08(bios, offset + 0);\n\tentry->addr = nvbios_rd08(bios, offset + 1);\n\tentry->bus = (nvbios_rd08(bios, offset + 2) >> 4) & 1;\n}\n\nint\nnvbios_extdev_parse(struct nvkm_bios *bios, int idx,\n\t\t    struct nvbios_extdev_func *func)\n{\n\tu8 ver, len;\n\tu16 entry;\n\n\tif (!(entry = nvbios_extdev_entry(bios, idx, &ver, &len)))\n\t\treturn -EINVAL;\n\n\textdev_parse_entry(bios, entry, func);\n\treturn 0;\n}\n\nint\nnvbios_extdev_find(struct nvkm_bios *bios, enum nvbios_extdev_type type,\n\t\t   struct nvbios_extdev_func *func)\n{\n\tu8 ver, len, i;\n\tu16 entry;\n\n\ti = 0;\n\twhile ((entry = nvbios_extdev_entry(bios, i++, &ver, &len))) {\n\t\textdev_parse_entry(bios, entry, func);\n\t\tif (func->type == type)\n\t\t\treturn 0;\n\t}\n\n\treturn -EINVAL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}