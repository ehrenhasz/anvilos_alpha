{
  "module_name": "rammcp77.c",
  "hash_id": "c17ce6533f5bc536ba28a14620062d2280e4658c16c97a6a2f490ff2754ed2a4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/fb/rammcp77.c",
  "human_readable_source": " \n#define mcp77_ram(p) container_of((p), struct mcp77_ram, base)\n#include \"ram.h\"\n\nstruct mcp77_ram {\n\tstruct nvkm_ram base;\n\tu64 poller_base;\n};\n\nstatic int\nmcp77_ram_init(struct nvkm_ram *base)\n{\n\tstruct mcp77_ram *ram = mcp77_ram(base);\n\tstruct nvkm_device *device = ram->base.fb->subdev.device;\n\tu32 dniso  = ((ram->base.size - (ram->poller_base + 0x00)) >> 5) - 1;\n\tu32 hostnb = ((ram->base.size - (ram->poller_base + 0x20)) >> 5) - 1;\n\tu32 flush  = ((ram->base.size - (ram->poller_base + 0x40)) >> 5) - 1;\n\n\t \n\tnvkm_wr32(device, 0x100c18, dniso);\n\tnvkm_mask(device, 0x100c14, 0x00000000, 0x00000001);\n\tnvkm_wr32(device, 0x100c1c, hostnb);\n\tnvkm_mask(device, 0x100c14, 0x00000000, 0x00000002);\n\tnvkm_wr32(device, 0x100c24, flush);\n\tnvkm_mask(device, 0x100c14, 0x00000000, 0x00010000);\n\treturn 0;\n}\n\nstatic const struct nvkm_ram_func\nmcp77_ram_func = {\n\t.init = mcp77_ram_init,\n};\n\nint\nmcp77_ram_new(struct nvkm_fb *fb, struct nvkm_ram **pram)\n{\n\tstruct nvkm_device *device = fb->subdev.device;\n\tu32 rsvd_head = ( 256 * 1024);  \n\tu32 rsvd_tail = (1024 * 1024) + 0x1000;  \n\tu64 base = (u64)nvkm_rd32(device, 0x100e10) << 12;\n\tu64 size = (u64)nvkm_rd32(device, 0x100e14) << 12;\n\tstruct mcp77_ram *ram;\n\tint ret;\n\n\tif (!(ram = kzalloc(sizeof(*ram), GFP_KERNEL)))\n\t\treturn -ENOMEM;\n\t*pram = &ram->base;\n\n\tret = nvkm_ram_ctor(&mcp77_ram_func, fb, NVKM_RAM_TYPE_STOLEN,\n\t\t\t    size, &ram->base);\n\tif (ret)\n\t\treturn ret;\n\n\tram->poller_base = size - rsvd_tail;\n\tram->base.stolen = base;\n\tnvkm_mm_fini(&ram->base.vram);\n\n\treturn nvkm_mm_init(&ram->base.vram, NVKM_RAM_MM_NORMAL,\n\t\t\t    rsvd_head >> NVKM_RAM_MM_SHIFT,\n\t\t\t    (size - rsvd_head - rsvd_tail) >>\n\t\t\t    NVKM_RAM_MM_SHIFT, 1);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}