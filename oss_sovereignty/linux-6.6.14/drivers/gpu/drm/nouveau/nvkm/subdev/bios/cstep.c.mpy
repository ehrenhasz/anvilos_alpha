{
  "module_name": "cstep.c",
  "hash_id": "5a5a1349f118203d14d99514f99ba9ca21e99e466f63eb1051bc3b180b9ecdca",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bios/cstep.c",
  "human_readable_source": " \n#include <subdev/bios.h>\n#include <subdev/bios/bit.h>\n#include <subdev/bios/cstep.h>\n\nu32\nnvbios_cstepTe(struct nvkm_bios *bios,\n\t       u8 *ver, u8 *hdr, u8 *cnt, u8 *len, u8 *xnr, u8 *xsz)\n{\n\tstruct bit_entry bit_P;\n\tu32 cstep = 0;\n\n\tif (!bit_entry(bios, 'P', &bit_P)) {\n\t\tif (bit_P.version == 2 && bit_P.length >= 0x38)\n\t\t\tcstep = nvbios_rd32(bios, bit_P.offset + 0x34);\n\n\t\tif (cstep) {\n\t\t\t*ver = nvbios_rd08(bios, cstep + 0);\n\t\t\tswitch (*ver) {\n\t\t\tcase 0x10:\n\t\t\t\t*hdr = nvbios_rd08(bios, cstep + 1);\n\t\t\t\t*cnt = nvbios_rd08(bios, cstep + 3);\n\t\t\t\t*len = nvbios_rd08(bios, cstep + 2);\n\t\t\t\t*xnr = nvbios_rd08(bios, cstep + 5);\n\t\t\t\t*xsz = nvbios_rd08(bios, cstep + 4);\n\t\t\t\treturn cstep;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nu32\nnvbios_cstepEe(struct nvkm_bios *bios, int idx, u8 *ver, u8 *hdr)\n{\n\tu8  cnt, len, xnr, xsz;\n\tu32 data = nvbios_cstepTe(bios, ver, hdr, &cnt, &len, &xnr, &xsz);\n\tif (data && idx < cnt) {\n\t\tdata = data + *hdr + (idx * len);\n\t\t*hdr = len;\n\t\treturn data;\n\t}\n\treturn 0;\n}\n\nu32\nnvbios_cstepEp(struct nvkm_bios *bios, int idx, u8 *ver, u8 *hdr,\n\t       struct nvbios_cstepE *info)\n{\n\tu32 data = nvbios_cstepEe(bios, idx, ver, hdr);\n\tmemset(info, 0x00, sizeof(*info));\n\tif (data) {\n\t\tinfo->pstate = (nvbios_rd16(bios, data + 0x00) & 0x01e0) >> 5;\n\t\tinfo->index   = nvbios_rd08(bios, data + 0x03);\n\t}\n\treturn data;\n}\n\nu32\nnvbios_cstepEm(struct nvkm_bios *bios, u8 pstate, u8 *ver, u8 *hdr,\n\t       struct nvbios_cstepE *info)\n{\n\tu32 data, idx = 0;\n\twhile ((data = nvbios_cstepEp(bios, idx++, ver, hdr, info))) {\n\t\tif (info->pstate == pstate)\n\t\t\tbreak;\n\t}\n\treturn data;\n}\n\nu32\nnvbios_cstepXe(struct nvkm_bios *bios, int idx, u8 *ver, u8 *hdr)\n{\n\tu8  cnt, len, xnr, xsz;\n\tu32 data = nvbios_cstepTe(bios, ver, hdr, &cnt, &len, &xnr, &xsz);\n\tif (data && idx < xnr) {\n\t\tdata = data + *hdr + (cnt * len) + (idx * xsz);\n\t\t*hdr = xsz;\n\t\treturn data;\n\t}\n\treturn 0;\n}\n\nu32\nnvbios_cstepXp(struct nvkm_bios *bios, int idx, u8 *ver, u8 *hdr,\n\t       struct nvbios_cstepX *info)\n{\n\tu32 data = nvbios_cstepXe(bios, idx, ver, hdr);\n\tmemset(info, 0x00, sizeof(*info));\n\tif (data) {\n\t\tinfo->freq    = nvbios_rd16(bios, data + 0x00) * 1000;\n\t\tinfo->unkn[0] = nvbios_rd08(bios, data + 0x02);\n\t\tinfo->unkn[1] = nvbios_rd08(bios, data + 0x03);\n\t\tinfo->voltage = nvbios_rd08(bios, data + 0x04);\n\t}\n\treturn data;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}