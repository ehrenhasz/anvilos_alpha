{
  "module_name": "user.c",
  "hash_id": "6fddab739fc33d3a6593367853b2ebd2aa8bf1c59b9e3e1736009322de4438a8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/fault/user.c",
  "human_readable_source": " \n#include \"priv.h\"\n\n#include <core/memory.h>\n#include <core/event.h>\n#include <subdev/mmu.h>\n\n#include <nvif/clb069.h>\n#include <nvif/unpack.h>\n\nstatic int\nnvkm_ufault_uevent(struct nvkm_object *object, void *argv, u32 argc, struct nvkm_uevent *uevent)\n{\n\tstruct nvkm_fault_buffer *buffer = nvkm_fault_buffer(object);\n\tunion nvif_clb069_event_args *args = argv;\n\n\tif (!uevent)\n\t\treturn 0;\n\tif (argc != sizeof(args->vn))\n\t\treturn -ENOSYS;\n\n\treturn nvkm_uevent_add(uevent, &buffer->fault->event, buffer->id,\n\t\t\t       NVKM_FAULT_BUFFER_EVENT_PENDING, NULL);\n}\n\nstatic int\nnvkm_ufault_map(struct nvkm_object *object, void *argv, u32 argc,\n\t\tenum nvkm_object_map *type, u64 *addr, u64 *size)\n{\n\tstruct nvkm_fault_buffer *buffer = nvkm_fault_buffer(object);\n\tstruct nvkm_device *device = buffer->fault->subdev.device;\n\t*type = NVKM_OBJECT_MAP_IO;\n\t*addr = device->func->resource_addr(device, 3) + buffer->addr;\n\t*size = nvkm_memory_size(buffer->mem);\n\treturn 0;\n}\n\nstatic int\nnvkm_ufault_fini(struct nvkm_object *object, bool suspend)\n{\n\tstruct nvkm_fault_buffer *buffer = nvkm_fault_buffer(object);\n\tbuffer->fault->func->buffer.fini(buffer);\n\treturn 0;\n}\n\nstatic int\nnvkm_ufault_init(struct nvkm_object *object)\n{\n\tstruct nvkm_fault_buffer *buffer = nvkm_fault_buffer(object);\n\tbuffer->fault->func->buffer.init(buffer);\n\treturn 0;\n}\n\nstatic void *\nnvkm_ufault_dtor(struct nvkm_object *object)\n{\n\treturn NULL;\n}\n\nstatic const struct nvkm_object_func\nnvkm_ufault = {\n\t.dtor = nvkm_ufault_dtor,\n\t.init = nvkm_ufault_init,\n\t.fini = nvkm_ufault_fini,\n\t.map = nvkm_ufault_map,\n\t.uevent = nvkm_ufault_uevent,\n};\n\nint\nnvkm_ufault_new(struct nvkm_device *device, const struct nvkm_oclass *oclass,\n\t\tvoid *argv, u32 argc, struct nvkm_object **pobject)\n{\n\tunion {\n\t\tstruct nvif_clb069_v0 v0;\n\t} *args = argv;\n\tstruct nvkm_fault *fault = device->fault;\n\tstruct nvkm_fault_buffer *buffer = fault->buffer[fault->func->user.rp];\n\tint ret = -ENOSYS;\n\n\tif (!(ret = nvif_unpack(ret, &argv, &argc, args->v0, 0, 0, false))) {\n\t\targs->v0.entries = buffer->entries;\n\t\targs->v0.get = buffer->get;\n\t\targs->v0.put = buffer->put;\n\t} else\n\t\treturn ret;\n\n\tnvkm_object_ctor(&nvkm_ufault, oclass, &buffer->object);\n\t*pobject = &buffer->object;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}