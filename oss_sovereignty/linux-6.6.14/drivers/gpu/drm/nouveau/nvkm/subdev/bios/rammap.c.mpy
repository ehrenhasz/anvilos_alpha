{
  "module_name": "rammap.c",
  "hash_id": "3310e473d2cb76833fc81900f92cc441ecfca246c4da0410bf81907ddc811dc9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bios/rammap.c",
  "human_readable_source": " \n#include <subdev/bios.h>\n#include <subdev/bios/bit.h>\n#include <subdev/bios/rammap.h>\n\nu32\nnvbios_rammapTe(struct nvkm_bios *bios, u8 *ver, u8 *hdr,\n\t\tu8 *cnt, u8 *len, u8 *snr, u8 *ssz)\n{\n\tstruct bit_entry bit_P;\n\tu32 rammap = 0x0000;\n\n\tif (!bit_entry(bios, 'P', &bit_P)) {\n\t\tif (bit_P.version == 2)\n\t\t\trammap = nvbios_rd32(bios, bit_P.offset + 4);\n\n\t\tif (rammap) {\n\t\t\t*ver = nvbios_rd08(bios, rammap + 0);\n\t\t\tswitch (*ver) {\n\t\t\tcase 0x10:\n\t\t\tcase 0x11:\n\t\t\t\t*hdr = nvbios_rd08(bios, rammap + 1);\n\t\t\t\t*cnt = nvbios_rd08(bios, rammap + 5);\n\t\t\t\t*len = nvbios_rd08(bios, rammap + 2);\n\t\t\t\t*snr = nvbios_rd08(bios, rammap + 4);\n\t\t\t\t*ssz = nvbios_rd08(bios, rammap + 3);\n\t\t\t\treturn rammap;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn 0x0000;\n}\n\nu32\nnvbios_rammapEe(struct nvkm_bios *bios, int idx,\n\t\tu8 *ver, u8 *hdr, u8 *cnt, u8 *len)\n{\n\tu8  snr, ssz;\n\tu32 rammap = nvbios_rammapTe(bios, ver, hdr, cnt, len, &snr, &ssz);\n\tif (rammap && idx < *cnt) {\n\t\trammap = rammap + *hdr + (idx * (*len + (snr * ssz)));\n\t\t*hdr = *len;\n\t\t*cnt = snr;\n\t\t*len = ssz;\n\t\treturn rammap;\n\t}\n\treturn 0x0000;\n}\n\n \nu32\nnvbios_rammapEp_from_perf(struct nvkm_bios *bios, u32 data, u8 size,\n\t\tstruct nvbios_ramcfg *p)\n{\n\tmemset(p, 0x00, sizeof(*p));\n\n\tp->rammap_00_16_20 = (nvbios_rd08(bios, data + 0x16) & 0x20) >> 5;\n\tp->rammap_00_16_40 = (nvbios_rd08(bios, data + 0x16) & 0x40) >> 6;\n\tp->rammap_00_17_02 = (nvbios_rd08(bios, data + 0x17) & 0x02) >> 1;\n\n\treturn data;\n}\n\nu32\nnvbios_rammapEp(struct nvkm_bios *bios, int idx,\n\t\tu8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_ramcfg *p)\n{\n\tu32 data = nvbios_rammapEe(bios, idx, ver, hdr, cnt, len), temp;\n\tmemset(p, 0x00, sizeof(*p));\n\tp->rammap_ver = *ver;\n\tp->rammap_hdr = *hdr;\n\tswitch (!!data * *ver) {\n\tcase 0x10:\n\t\tp->rammap_min      =  nvbios_rd16(bios, data + 0x00);\n\t\tp->rammap_max      =  nvbios_rd16(bios, data + 0x02);\n\t\tp->rammap_10_04_02 = (nvbios_rd08(bios, data + 0x04) & 0x02) >> 1;\n\t\tp->rammap_10_04_08 = (nvbios_rd08(bios, data + 0x04) & 0x08) >> 3;\n\t\tbreak;\n\tcase 0x11:\n\t\tp->rammap_min      =  nvbios_rd16(bios, data + 0x00);\n\t\tp->rammap_max      =  nvbios_rd16(bios, data + 0x02);\n\t\tp->rammap_11_08_01 = (nvbios_rd08(bios, data + 0x08) & 0x01) >> 0;\n\t\tp->rammap_11_08_0c = (nvbios_rd08(bios, data + 0x08) & 0x0c) >> 2;\n\t\tp->rammap_11_08_10 = (nvbios_rd08(bios, data + 0x08) & 0x10) >> 4;\n\t\ttemp = nvbios_rd32(bios, data + 0x09);\n\t\tp->rammap_11_09_01ff = (temp & 0x000001ff) >> 0;\n\t\tp->rammap_11_0a_03fe = (temp & 0x0003fe00) >> 9;\n\t\tp->rammap_11_0a_0400 = (temp & 0x00040000) >> 18;\n\t\tp->rammap_11_0a_0800 = (temp & 0x00080000) >> 19;\n\t\tp->rammap_11_0b_01f0 = (temp & 0x01f00000) >> 20;\n\t\tp->rammap_11_0b_0200 = (temp & 0x02000000) >> 25;\n\t\tp->rammap_11_0b_0400 = (temp & 0x04000000) >> 26;\n\t\tp->rammap_11_0b_0800 = (temp & 0x08000000) >> 27;\n\t\tp->rammap_11_0d    =  nvbios_rd08(bios, data + 0x0d);\n\t\tp->rammap_11_0e    =  nvbios_rd08(bios, data + 0x0e);\n\t\tp->rammap_11_0f    =  nvbios_rd08(bios, data + 0x0f);\n\t\tp->rammap_11_11_0c = (nvbios_rd08(bios, data + 0x11) & 0x0c) >> 2;\n\t\tbreak;\n\tdefault:\n\t\tdata = 0;\n\t\tbreak;\n\t}\n\treturn data;\n}\n\nu32\nnvbios_rammapEm(struct nvkm_bios *bios, u16 mhz,\n\t\tu8 *ver, u8 *hdr, u8 *cnt, u8 *len, struct nvbios_ramcfg *info)\n{\n\tint idx = 0;\n\tu32 data;\n\twhile ((data = nvbios_rammapEp(bios, idx++, ver, hdr, cnt, len, info))) {\n\t\tif (mhz >= info->rammap_min && mhz <= info->rammap_max)\n\t\t\tbreak;\n\t}\n\treturn data;\n}\n\nu32\nnvbios_rammapSe(struct nvkm_bios *bios, u32 data,\n\t\tu8 ever, u8 ehdr, u8 ecnt, u8 elen, int idx, u8 *ver, u8 *hdr)\n{\n\tif (idx < ecnt) {\n\t\tdata = data + ehdr + (idx * elen);\n\t\t*ver = ever;\n\t\t*hdr = elen;\n\t\treturn data;\n\t}\n\treturn 0;\n}\n\nu32\nnvbios_rammapSp_from_perf(struct nvkm_bios *bios, u32 data, u8 size, int idx,\n\t\tstruct nvbios_ramcfg *p)\n{\n\tdata += (idx * size);\n\n\tif (size < 11)\n\t\treturn 0x00000000;\n\n\tp->ramcfg_ver = 0;\n\tp->ramcfg_timing   =  nvbios_rd08(bios, data + 0x01);\n\tp->ramcfg_00_03_01 = (nvbios_rd08(bios, data + 0x03) & 0x01) >> 0;\n\tp->ramcfg_00_03_02 = (nvbios_rd08(bios, data + 0x03) & 0x02) >> 1;\n\tp->ramcfg_DLLoff   = (nvbios_rd08(bios, data + 0x03) & 0x04) >> 2;\n\tp->ramcfg_00_03_08 = (nvbios_rd08(bios, data + 0x03) & 0x08) >> 3;\n\tp->ramcfg_RON      = (nvbios_rd08(bios, data + 0x03) & 0x10) >> 3;\n\tp->ramcfg_FBVDDQ   = (nvbios_rd08(bios, data + 0x03) & 0x80) >> 7;\n\tp->ramcfg_00_04_02 = (nvbios_rd08(bios, data + 0x04) & 0x02) >> 1;\n\tp->ramcfg_00_04_04 = (nvbios_rd08(bios, data + 0x04) & 0x04) >> 2;\n\tp->ramcfg_00_04_20 = (nvbios_rd08(bios, data + 0x04) & 0x20) >> 5;\n\tp->ramcfg_00_05    = (nvbios_rd08(bios, data + 0x05) & 0xff) >> 0;\n\tp->ramcfg_00_06    = (nvbios_rd08(bios, data + 0x06) & 0xff) >> 0;\n\tp->ramcfg_00_07    = (nvbios_rd08(bios, data + 0x07) & 0xff) >> 0;\n\tp->ramcfg_00_08    = (nvbios_rd08(bios, data + 0x08) & 0xff) >> 0;\n\tp->ramcfg_00_09    = (nvbios_rd08(bios, data + 0x09) & 0xff) >> 0;\n\tp->ramcfg_00_0a_0f = (nvbios_rd08(bios, data + 0x0a) & 0x0f) >> 0;\n\tp->ramcfg_00_0a_f0 = (nvbios_rd08(bios, data + 0x0a) & 0xf0) >> 4;\n\n\treturn data;\n}\n\nu32\nnvbios_rammapSp(struct nvkm_bios *bios, u32 data,\n\t\tu8 ever, u8 ehdr, u8 ecnt, u8 elen, int idx,\n\t\tu8 *ver, u8 *hdr, struct nvbios_ramcfg *p)\n{\n\tdata = nvbios_rammapSe(bios, data, ever, ehdr, ecnt, elen, idx, ver, hdr);\n\tp->ramcfg_ver = *ver;\n\tp->ramcfg_hdr = *hdr;\n\tswitch (!!data * *ver) {\n\tcase 0x10:\n\t\tp->ramcfg_timing   =  nvbios_rd08(bios, data + 0x01);\n\t\tp->ramcfg_10_02_01 = (nvbios_rd08(bios, data + 0x02) & 0x01) >> 0;\n\t\tp->ramcfg_10_02_02 = (nvbios_rd08(bios, data + 0x02) & 0x02) >> 1;\n\t\tp->ramcfg_10_02_04 = (nvbios_rd08(bios, data + 0x02) & 0x04) >> 2;\n\t\tp->ramcfg_10_02_08 = (nvbios_rd08(bios, data + 0x02) & 0x08) >> 3;\n\t\tp->ramcfg_10_02_10 = (nvbios_rd08(bios, data + 0x02) & 0x10) >> 4;\n\t\tp->ramcfg_10_02_20 = (nvbios_rd08(bios, data + 0x02) & 0x20) >> 5;\n\t\tp->ramcfg_DLLoff   = (nvbios_rd08(bios, data + 0x02) & 0x40) >> 6;\n\t\tp->ramcfg_10_03_0f = (nvbios_rd08(bios, data + 0x03) & 0x0f) >> 0;\n\t\tp->ramcfg_10_04_01 = (nvbios_rd08(bios, data + 0x04) & 0x01) >> 0;\n\t\tp->ramcfg_FBVDDQ   = (nvbios_rd08(bios, data + 0x04) & 0x08) >> 3;\n\t\tp->ramcfg_10_05    = (nvbios_rd08(bios, data + 0x05) & 0xff) >> 0;\n\t\tp->ramcfg_10_06    = (nvbios_rd08(bios, data + 0x06) & 0xff) >> 0;\n\t\tp->ramcfg_10_07    = (nvbios_rd08(bios, data + 0x07) & 0xff) >> 0;\n\t\tp->ramcfg_10_08    = (nvbios_rd08(bios, data + 0x08) & 0xff) >> 0;\n\t\tp->ramcfg_10_09_0f = (nvbios_rd08(bios, data + 0x09) & 0x0f) >> 0;\n\t\tp->ramcfg_10_09_f0 = (nvbios_rd08(bios, data + 0x09) & 0xf0) >> 4;\n\t\tbreak;\n\tcase 0x11:\n\t\tp->ramcfg_timing   =  nvbios_rd08(bios, data + 0x00);\n\t\tp->ramcfg_11_01_01 = (nvbios_rd08(bios, data + 0x01) & 0x01) >> 0;\n\t\tp->ramcfg_11_01_02 = (nvbios_rd08(bios, data + 0x01) & 0x02) >> 1;\n\t\tp->ramcfg_11_01_04 = (nvbios_rd08(bios, data + 0x01) & 0x04) >> 2;\n\t\tp->ramcfg_11_01_08 = (nvbios_rd08(bios, data + 0x01) & 0x08) >> 3;\n\t\tp->ramcfg_11_01_10 = (nvbios_rd08(bios, data + 0x01) & 0x10) >> 4;\n\t\tp->ramcfg_DLLoff =   (nvbios_rd08(bios, data + 0x01) & 0x20) >> 5;\n\t\tp->ramcfg_11_01_40 = (nvbios_rd08(bios, data + 0x01) & 0x40) >> 6;\n\t\tp->ramcfg_11_01_80 = (nvbios_rd08(bios, data + 0x01) & 0x80) >> 7;\n\t\tp->ramcfg_11_02_03 = (nvbios_rd08(bios, data + 0x02) & 0x03) >> 0;\n\t\tp->ramcfg_11_02_04 = (nvbios_rd08(bios, data + 0x02) & 0x04) >> 2;\n\t\tp->ramcfg_11_02_08 = (nvbios_rd08(bios, data + 0x02) & 0x08) >> 3;\n\t\tp->ramcfg_11_02_10 = (nvbios_rd08(bios, data + 0x02) & 0x10) >> 4;\n\t\tp->ramcfg_11_02_40 = (nvbios_rd08(bios, data + 0x02) & 0x40) >> 6;\n\t\tp->ramcfg_11_02_80 = (nvbios_rd08(bios, data + 0x02) & 0x80) >> 7;\n\t\tp->ramcfg_11_03_0f = (nvbios_rd08(bios, data + 0x03) & 0x0f) >> 0;\n\t\tp->ramcfg_11_03_30 = (nvbios_rd08(bios, data + 0x03) & 0x30) >> 4;\n\t\tp->ramcfg_11_03_c0 = (nvbios_rd08(bios, data + 0x03) & 0xc0) >> 6;\n\t\tp->ramcfg_11_03_f0 = (nvbios_rd08(bios, data + 0x03) & 0xf0) >> 4;\n\t\tp->ramcfg_11_04    = (nvbios_rd08(bios, data + 0x04) & 0xff) >> 0;\n\t\tp->ramcfg_11_06    = (nvbios_rd08(bios, data + 0x06) & 0xff) >> 0;\n\t\tp->ramcfg_11_07_02 = (nvbios_rd08(bios, data + 0x07) & 0x02) >> 1;\n\t\tp->ramcfg_11_07_04 = (nvbios_rd08(bios, data + 0x07) & 0x04) >> 2;\n\t\tp->ramcfg_11_07_08 = (nvbios_rd08(bios, data + 0x07) & 0x08) >> 3;\n\t\tp->ramcfg_11_07_10 = (nvbios_rd08(bios, data + 0x07) & 0x10) >> 4;\n\t\tp->ramcfg_11_07_40 = (nvbios_rd08(bios, data + 0x07) & 0x40) >> 6;\n\t\tp->ramcfg_11_07_80 = (nvbios_rd08(bios, data + 0x07) & 0x80) >> 7;\n\t\tp->ramcfg_11_08_01 = (nvbios_rd08(bios, data + 0x08) & 0x01) >> 0;\n\t\tp->ramcfg_11_08_02 = (nvbios_rd08(bios, data + 0x08) & 0x02) >> 1;\n\t\tp->ramcfg_11_08_04 = (nvbios_rd08(bios, data + 0x08) & 0x04) >> 2;\n\t\tp->ramcfg_11_08_08 = (nvbios_rd08(bios, data + 0x08) & 0x08) >> 3;\n\t\tp->ramcfg_11_08_10 = (nvbios_rd08(bios, data + 0x08) & 0x10) >> 4;\n\t\tp->ramcfg_11_08_20 = (nvbios_rd08(bios, data + 0x08) & 0x20) >> 5;\n\t\tp->ramcfg_11_09    = (nvbios_rd08(bios, data + 0x09) & 0xff) >> 0;\n\t\tbreak;\n\tdefault:\n\t\tdata = 0;\n\t\tbreak;\n\t}\n\treturn data;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}