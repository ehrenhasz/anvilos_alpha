{
  "module_name": "volt.c",
  "hash_id": "fc71fec7cc83b87be15deb7db770e29f021db0db547e221f56e5a3215a8f3383",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/bios/volt.c",
  "human_readable_source": " \n#include <subdev/bios.h>\n#include <subdev/bios/bit.h>\n#include <subdev/bios/volt.h>\n\nu32\nnvbios_volt_table(struct nvkm_bios *bios, u8 *ver, u8 *hdr, u8 *cnt, u8 *len)\n{\n\tstruct bit_entry bit_P;\n\tu32 volt = 0;\n\n\tif (!bit_entry(bios, 'P', &bit_P)) {\n\t\tif (bit_P.version == 2)\n\t\t\tvolt = nvbios_rd32(bios, bit_P.offset + 0x0c);\n\t\telse\n\t\tif (bit_P.version == 1)\n\t\t\tvolt = nvbios_rd32(bios, bit_P.offset + 0x10);\n\n\t\tif (volt) {\n\t\t\t*ver = nvbios_rd08(bios, volt + 0);\n\t\t\tswitch (*ver) {\n\t\t\tcase 0x12:\n\t\t\t\t*hdr = 5;\n\t\t\t\t*cnt = nvbios_rd08(bios, volt + 2);\n\t\t\t\t*len = nvbios_rd08(bios, volt + 1);\n\t\t\t\treturn volt;\n\t\t\tcase 0x20:\n\t\t\t\t*hdr = nvbios_rd08(bios, volt + 1);\n\t\t\t\t*cnt = nvbios_rd08(bios, volt + 2);\n\t\t\t\t*len = nvbios_rd08(bios, volt + 3);\n\t\t\t\treturn volt;\n\t\t\tcase 0x30:\n\t\t\tcase 0x40:\n\t\t\tcase 0x50:\n\t\t\t\t*hdr = nvbios_rd08(bios, volt + 1);\n\t\t\t\t*cnt = nvbios_rd08(bios, volt + 3);\n\t\t\t\t*len = nvbios_rd08(bios, volt + 2);\n\t\t\t\treturn volt;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nu32\nnvbios_volt_parse(struct nvkm_bios *bios, u8 *ver, u8 *hdr, u8 *cnt, u8 *len,\n\t\t  struct nvbios_volt *info)\n{\n\tu32 volt = nvbios_volt_table(bios, ver, hdr, cnt, len);\n\tmemset(info, 0x00, sizeof(*info));\n\tswitch (!!volt * *ver) {\n\tcase 0x12:\n\t\tinfo->type    = NVBIOS_VOLT_GPIO;\n\t\tinfo->vidmask = nvbios_rd08(bios, volt + 0x04);\n\t\tinfo->ranged  = false;\n\t\tbreak;\n\tcase 0x20:\n\t\tinfo->type    = NVBIOS_VOLT_GPIO;\n\t\tinfo->vidmask = nvbios_rd08(bios, volt + 0x05);\n\t\tinfo->ranged  = false;\n\t\tbreak;\n\tcase 0x30:\n\t\tinfo->type    = NVBIOS_VOLT_GPIO;\n\t\tinfo->vidmask = nvbios_rd08(bios, volt + 0x04);\n\t\tinfo->ranged  = false;\n\t\tbreak;\n\tcase 0x40:\n\t\tinfo->type    = NVBIOS_VOLT_GPIO;\n\t\tinfo->base    = nvbios_rd32(bios, volt + 0x04);\n\t\tinfo->step    = nvbios_rd16(bios, volt + 0x08);\n\t\tinfo->vidmask = nvbios_rd08(bios, volt + 0x0b);\n\t\tinfo->ranged  = true;  \n\t\tinfo->min     = min(info->base,\n\t\t\t\t    info->base + info->step * info->vidmask);\n\t\tinfo->max     = nvbios_rd32(bios, volt + 0x0e);\n\t\tif (!info->max)\n\t\t\tinfo->max = max(info->base, info->base + info->step * info->vidmask);\n\t\tbreak;\n\tcase 0x50:\n\t\tinfo->min     = nvbios_rd32(bios, volt + 0x0a);\n\t\tinfo->max     = nvbios_rd32(bios, volt + 0x0e);\n\t\tinfo->base    = nvbios_rd32(bios, volt + 0x12) & 0x00ffffff;\n\n\t\t \n\t\tif (nvbios_rd32(bios, volt + 0x4) & 1) {\n\t\t\tinfo->type      = NVBIOS_VOLT_PWM;\n\t\t\tinfo->pwm_freq  = nvbios_rd32(bios, volt + 0x5) / 1000;\n\t\t\tinfo->pwm_range = nvbios_rd32(bios, volt + 0x16);\n\t\t} else {\n\t\t\tinfo->type    = NVBIOS_VOLT_GPIO;\n\t\t\tinfo->vidmask = nvbios_rd08(bios, volt + 0x06);\n\t\t\tinfo->step    = nvbios_rd16(bios, volt + 0x16);\n\t\t\tinfo->ranged  =\n\t\t\t\t!!(nvbios_rd08(bios, volt + 0x4) & 0x2);\n\t\t}\n\t\tbreak;\n\t}\n\treturn volt;\n}\n\nu32\nnvbios_volt_entry(struct nvkm_bios *bios, int idx, u8 *ver, u8 *len)\n{\n\tu8  hdr, cnt;\n\tu32 volt = nvbios_volt_table(bios, ver, &hdr, &cnt, len);\n\tif (volt && idx < cnt) {\n\t\tvolt = volt + hdr + (idx * *len);\n\t\treturn volt;\n\t}\n\treturn 0;\n}\n\nu32\nnvbios_volt_entry_parse(struct nvkm_bios *bios, int idx, u8 *ver, u8 *len,\n\t\t\tstruct nvbios_volt_entry *info)\n{\n\tu32 volt = nvbios_volt_entry(bios, idx, ver, len);\n\tmemset(info, 0x00, sizeof(*info));\n\tswitch (!!volt * *ver) {\n\tcase 0x12:\n\tcase 0x20:\n\t\tinfo->voltage = nvbios_rd08(bios, volt + 0x00) * 10000;\n\t\tinfo->vid     = nvbios_rd08(bios, volt + 0x01);\n\t\tbreak;\n\tcase 0x30:\n\t\tinfo->voltage = nvbios_rd08(bios, volt + 0x00) * 10000;\n\t\tinfo->vid     = nvbios_rd08(bios, volt + 0x01) >> 2;\n\t\tbreak;\n\tcase 0x40:\n\t\tbreak;\n\tcase 0x50:\n\t\tinfo->voltage = nvbios_rd32(bios, volt) & 0x001fffff;\n\t\tinfo->vid     = (nvbios_rd32(bios, volt) >> 23) & 0xff;\n\t\tbreak;\n\t}\n\treturn volt;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}