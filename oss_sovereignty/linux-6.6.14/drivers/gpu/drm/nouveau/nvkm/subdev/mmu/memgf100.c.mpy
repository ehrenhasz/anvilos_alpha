{
  "module_name": "memgf100.c",
  "hash_id": "b85f29f2fb4705c20428d776acede876800b2f4bc679afaa65fdc7f94151fe3b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/mmu/memgf100.c",
  "human_readable_source": " \n#include \"mem.h\"\n\n#include <core/memory.h>\n#include <subdev/bar.h>\n#include <subdev/fb.h>\n\n#include <nvif/class.h>\n#include <nvif/if900b.h>\n#include <nvif/if900d.h>\n#include <nvif/unpack.h>\n\nint\ngf100_mem_map(struct nvkm_mmu *mmu, struct nvkm_memory *memory, void *argv,\n\t      u32 argc, u64 *paddr, u64 *psize, struct nvkm_vma **pvma)\n{\n\tstruct gf100_vmm_map_v0 uvmm = {};\n\tunion {\n\t\tstruct gf100_mem_map_vn vn;\n\t\tstruct gf100_mem_map_v0 v0;\n\t} *args = argv;\n\tstruct nvkm_device *device = mmu->subdev.device;\n\tstruct nvkm_vmm *bar = nvkm_bar_bar1_vmm(device);\n\tint ret = -ENOSYS;\n\n\tif (!(ret = nvif_unpack(ret, &argv, &argc, args->v0, 0, 0, false))) {\n\t\tuvmm.ro   = args->v0.ro;\n\t\tuvmm.kind = args->v0.kind;\n\t} else\n\tif (!(ret = nvif_unvers(ret, &argv, &argc, args->vn))) {\n\t} else\n\t\treturn ret;\n\n\tret = nvkm_vmm_get(bar, nvkm_memory_page(memory),\n\t\t\t\tnvkm_memory_size(memory), pvma);\n\tif (ret)\n\t\treturn ret;\n\n\tret = nvkm_memory_map(memory, 0, bar, *pvma, &uvmm, sizeof(uvmm));\n\tif (ret)\n\t\treturn ret;\n\n\t*paddr = device->func->resource_addr(device, 1) + (*pvma)->addr;\n\t*psize = (*pvma)->size;\n\treturn 0;\n}\n\nint\ngf100_mem_new(struct nvkm_mmu *mmu, int type, u8 page, u64 size,\n\t      void *argv, u32 argc, struct nvkm_memory **pmemory)\n{\n\tunion {\n\t\tstruct gf100_mem_vn vn;\n\t\tstruct gf100_mem_v0 v0;\n\t} *args = argv;\n\tint ret = -ENOSYS;\n\tbool contig;\n\n\tif (!(ret = nvif_unpack(ret, &argv, &argc, args->v0, 0, 0, false))) {\n\t\tcontig = args->v0.contig;\n\t} else\n\tif (!(ret = nvif_unvers(ret, &argv, &argc, args->vn))) {\n\t\tcontig = false;\n\t} else\n\t\treturn ret;\n\n\tif (mmu->type[type].type & (NVKM_MEM_DISP | NVKM_MEM_COMP))\n\t\ttype = NVKM_RAM_MM_NORMAL;\n\telse\n\t\ttype = NVKM_RAM_MM_MIXED;\n\n\treturn nvkm_ram_get(mmu->subdev.device, type, 0x01, page,\n\t\t\t    size, contig, false, pmemory);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}