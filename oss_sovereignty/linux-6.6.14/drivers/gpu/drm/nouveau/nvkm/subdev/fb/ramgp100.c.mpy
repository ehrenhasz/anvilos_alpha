{
  "module_name": "ramgp100.c",
  "hash_id": "94ea9148f1c62d58f921de1338b20c04c1eb550cbc3fe381e8919bbf9e4b0ff1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/fb/ramgp100.c",
  "human_readable_source": " \n#include \"ram.h\"\n\n#include <subdev/bios.h>\n#include <subdev/bios/init.h>\n#include <subdev/bios/rammap.h>\n\nstatic int\ngp100_ram_init(struct nvkm_ram *ram)\n{\n\tstruct nvkm_subdev *subdev = &ram->fb->subdev;\n\tstruct nvkm_device *device = subdev->device;\n\tstruct nvkm_bios *bios = device->bios;\n\tu8  ver, hdr, cnt, len, snr, ssz;\n\tu32 data;\n\tint i;\n\n\t \n\tdata = nvbios_rammapTe(bios, &ver, &hdr, &cnt, &len, &snr, &ssz);\n\tif (!data || hdr < 0x15)\n\t\treturn -EINVAL;\n\n\tcnt  = nvbios_rd08(bios, data + 0x14);  \n\tdata = nvbios_rd32(bios, data + 0x10);  \n\tif (cnt) {\n\t\tu32 save = nvkm_rd32(device, 0x9a065c) & 0x000000f0;\n\t\tfor (i = 0; i < cnt; i++, data += 4) {\n\t\t\tif (i != save >> 4) {\n\t\t\t\tnvkm_mask(device, 0x9a065c, 0x000000f0, i << 4);\n\t\t\t\tnvbios_init(subdev, nvbios_rd32(bios, data));\n\t\t\t}\n\t\t}\n\t\tnvkm_mask(device, 0x9a065c, 0x000000f0, save);\n\t}\n\n\tnvkm_mask(device, 0x9a0584, 0x11000000, 0x00000000);\n\tnvkm_wr32(device, 0x10ecc0, 0xffffffff);\n\tnvkm_mask(device, 0x9a0160, 0x00000010, 0x00000010);\n\treturn 0;\n}\n\nstatic u32\ngp100_ram_probe_fbpa(struct nvkm_device *device, int fbpa)\n{\n\treturn nvkm_rd32(device, 0x90020c + (fbpa * 0x4000));\n}\n\nstatic const struct nvkm_ram_func\ngp100_ram = {\n\t.upper = 0x1000000000ULL,\n\t.probe_fbp = gm107_ram_probe_fbp,\n\t.probe_fbp_amount = gm200_ram_probe_fbp_amount,\n\t.probe_fbpa_amount = gp100_ram_probe_fbpa,\n\t.init = gp100_ram_init,\n};\n\nint\ngp100_ram_new(struct nvkm_fb *fb, struct nvkm_ram **pram)\n{\n\tstruct nvkm_ram *ram;\n\n\tif (!(ram = *pram = kzalloc(sizeof(*ram), GFP_KERNEL)))\n\t\treturn -ENOMEM;\n\n\treturn gf100_ram_ctor(&gp100_ram, fb, ram);\n\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}