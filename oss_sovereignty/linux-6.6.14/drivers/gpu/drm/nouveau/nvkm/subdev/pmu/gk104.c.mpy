{
  "module_name": "gk104.c",
  "hash_id": "30cfdda723d7aa28b5fdeb405e5e11b65cd5a78e0d13e5e7d9cd7c618b72806b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/pmu/gk104.c",
  "human_readable_source": " \n#define gf119_pmu_code gk104_pmu_code\n#define gf119_pmu_data gk104_pmu_data\n#include \"priv.h\"\n#include \"fuc/gf119.fuc4.h\"\n\n#include <core/option.h>\n#include <subdev/fuse.h>\n#include <subdev/timer.h>\n\nstatic void\nmagic_(struct nvkm_device *device, u32 ctrl, int size)\n{\n\tnvkm_wr32(device, 0x00c800, 0x00000000);\n\tnvkm_wr32(device, 0x00c808, 0x00000000);\n\tnvkm_wr32(device, 0x00c800, ctrl);\n\tnvkm_msec(device, 2000,\n\t\tif (nvkm_rd32(device, 0x00c800) & 0x40000000) {\n\t\t\twhile (size--)\n\t\t\t\tnvkm_wr32(device, 0x00c804, 0x00000000);\n\t\t\tbreak;\n\t\t}\n\t);\n\tnvkm_wr32(device, 0x00c800, 0x00000000);\n}\n\nstatic void\nmagic(struct nvkm_device *device, u32 ctrl)\n{\n\tmagic_(device, 0x8000a41f | ctrl, 6);\n\tmagic_(device, 0x80000421 | ctrl, 1);\n}\n\nstatic void\ngk104_pmu_pgob(struct nvkm_pmu *pmu, bool enable)\n{\n\tstruct nvkm_device *device = pmu->subdev.device;\n\n\tif (!(nvkm_fuse_read(device->fuse, 0x31c) & 0x00000001))\n\t\treturn;\n\n\tnvkm_mask(device, 0x000200, 0x00001000, 0x00000000);\n\tnvkm_rd32(device, 0x000200);\n\tnvkm_mask(device, 0x000200, 0x08000000, 0x08000000);\n\tmsleep(50);\n\n\tnvkm_mask(device, 0x10a78c, 0x00000002, 0x00000002);\n\tnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000001);\n\tnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000000);\n\n\tnvkm_mask(device, 0x020004, 0xc0000000, enable ? 0xc0000000 : 0x40000000);\n\tmsleep(50);\n\n\tnvkm_mask(device, 0x10a78c, 0x00000002, 0x00000000);\n\tnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000001);\n\tnvkm_mask(device, 0x10a78c, 0x00000001, 0x00000000);\n\n\tnvkm_mask(device, 0x000200, 0x08000000, 0x00000000);\n\tnvkm_mask(device, 0x000200, 0x00001000, 0x00001000);\n\tnvkm_rd32(device, 0x000200);\n\n\tif (nvkm_boolopt(device->cfgopt, \"War00C800_0\", true)) {\n\t\tswitch (device->chipset) {\n\t\tcase 0xe4:\n\t\t\tmagic(device, 0x04000000);\n\t\t\tmagic(device, 0x06000000);\n\t\t\tmagic(device, 0x0c000000);\n\t\t\tmagic(device, 0x0e000000);\n\t\t\tbreak;\n\t\tcase 0xe6:\n\t\t\tmagic(device, 0x02000000);\n\t\t\tmagic(device, 0x04000000);\n\t\t\tmagic(device, 0x0a000000);\n\t\t\tbreak;\n\t\tcase 0xe7:\n\t\t\tmagic(device, 0x02000000);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic const struct nvkm_pmu_func\ngk104_pmu = {\n\t.flcn = &gt215_pmu_flcn,\n\t.code.data = gk104_pmu_code,\n\t.code.size = sizeof(gk104_pmu_code),\n\t.data.data = gk104_pmu_data,\n\t.data.size = sizeof(gk104_pmu_data),\n\t.enabled = gf100_pmu_enabled,\n\t.reset = gf100_pmu_reset,\n\t.init = gt215_pmu_init,\n\t.fini = gt215_pmu_fini,\n\t.intr = gt215_pmu_intr,\n\t.send = gt215_pmu_send,\n\t.recv = gt215_pmu_recv,\n\t.pgob = gk104_pmu_pgob,\n};\n\nstatic const struct nvkm_pmu_fwif\ngk104_pmu_fwif[] = {\n\t{ -1, gf100_pmu_nofw, &gk104_pmu },\n\t{}\n};\n\nint\ngk104_pmu_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t      struct nvkm_pmu **ppmu)\n{\n\treturn nvkm_pmu_new_(gk104_pmu_fwif, device, type, inst, ppmu);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}