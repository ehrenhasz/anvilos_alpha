{
  "module_name": "gt215.c",
  "hash_id": "2b5bed0f079a14962b10d76d991170d89477ae4771489947c3bc8e89ec735e0f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nvkm/subdev/devinit/gt215.c",
  "human_readable_source": " \n#include \"nv50.h\"\n\n#include <subdev/bios.h>\n#include <subdev/bios/init.h>\n#include <subdev/bios/pll.h>\n#include <subdev/clk/pll.h>\n\nint\ngt215_devinit_pll_set(struct nvkm_devinit *init, u32 type, u32 freq)\n{\n\tstruct nvkm_subdev *subdev = &init->subdev;\n\tstruct nvkm_device *device = subdev->device;\n\tstruct nvbios_pll info;\n\tint N, fN, M, P;\n\tint ret;\n\n\tret = nvbios_pll_parse(device->bios, type, &info);\n\tif (ret)\n\t\treturn ret;\n\n\tret = gt215_pll_calc(subdev, &info, freq, &N, &fN, &M, &P);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tswitch (info.type) {\n\tcase PLL_VPLL0:\n\tcase PLL_VPLL1:\n\t\tnvkm_wr32(device, info.reg + 0, 0x50000610);\n\t\tnvkm_mask(device, info.reg + 4, 0x003fffff,\n\t\t\t\t\t\t(P << 16) | (M << 8) | N);\n\t\tnvkm_wr32(device, info.reg + 8, fN);\n\t\tbreak;\n\tdefault:\n\t\tnvkm_warn(subdev, \"%08x/%dKhz unimplemented\\n\", type, freq);\n\t\tret = -EINVAL;\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nstatic void\ngt215_devinit_disable(struct nvkm_devinit *init)\n{\n\tstruct nvkm_device *device = init->subdev.device;\n\tu32 r001540 = nvkm_rd32(device, 0x001540);\n\tu32 r00154c = nvkm_rd32(device, 0x00154c);\n\n\tif (!(r001540 & 0x40000000)) {\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_MSPDEC, 0);\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_MSPPP, 0);\n\t}\n\n\tif (!(r00154c & 0x00000004))\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_DISP, 0);\n\tif (!(r00154c & 0x00000020))\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_MSVLD, 0);\n\tif (!(r00154c & 0x00000200))\n\t\tnvkm_subdev_disable(device, NVKM_ENGINE_CE, 0);\n}\n\nstatic u32\ngt215_devinit_mmio_part[] = {\n\t0x100720, 0x1008bc, 4,\n\t0x100a20, 0x100adc, 4,\n\t0x100d80, 0x100ddc, 4,\n\t0x110000, 0x110f9c, 4,\n\t0x111000, 0x11103c, 8,\n\t0x111080, 0x1110fc, 4,\n\t0x111120, 0x1111fc, 4,\n\t0x111300, 0x1114bc, 4,\n\t0,\n};\n\nstatic u32\ngt215_devinit_mmio(struct nvkm_devinit *base, u32 addr)\n{\n\tstruct nv50_devinit *init = nv50_devinit(base);\n\tstruct nvkm_device *device = init->base.subdev.device;\n\tu32 *mmio = gt215_devinit_mmio_part;\n\n\t \n\twhile (mmio[0]) {\n\t\tif (addr >= mmio[0] && addr <= mmio[1]) {\n\t\t\tu32 part = (addr / mmio[2]) & 7;\n\t\t\tif (!init->r001540)\n\t\t\t\tinit->r001540 = nvkm_rd32(device, 0x001540);\n\t\t\tif (part >= hweight8((init->r001540 >> 16) & 0xff))\n\t\t\t\treturn ~0;\n\t\t\treturn addr;\n\t\t}\n\t\tmmio += 3;\n\t}\n\n\treturn addr;\n}\n\nstatic const struct nvkm_devinit_func\ngt215_devinit = {\n\t.preinit = nv50_devinit_preinit,\n\t.init = nv50_devinit_init,\n\t.post = nv04_devinit_post,\n\t.mmio = gt215_devinit_mmio,\n\t.pll_set = gt215_devinit_pll_set,\n\t.disable = gt215_devinit_disable,\n};\n\nint\ngt215_devinit_new(struct nvkm_device *device, enum nvkm_subdev_type type, int inst,\n\t\t  struct nvkm_devinit **pinit)\n{\n\treturn nv50_devinit_new_(&gt215_devinit, device, type, inst, pinit);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}