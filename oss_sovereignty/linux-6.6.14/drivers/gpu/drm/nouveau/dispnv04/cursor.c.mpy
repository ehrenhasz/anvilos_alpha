{
  "module_name": "cursor.c",
  "hash_id": "1fe620799b4c41dc3db73f87251beda88156876d1920e83fdd7cef7e3ab8c1ee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/dispnv04/cursor.c",
  "human_readable_source": "\n#include <drm/drm_mode.h>\n#include \"nouveau_drv.h\"\n#include \"nouveau_reg.h\"\n#include \"nouveau_crtc.h\"\n#include \"hw.h\"\n\nstatic void\nnv04_cursor_show(struct nouveau_crtc *nv_crtc, bool update)\n{\n\tnv_show_cursor(nv_crtc->base.dev, nv_crtc->index, true);\n}\n\nstatic void\nnv04_cursor_hide(struct nouveau_crtc *nv_crtc, bool update)\n{\n\tnv_show_cursor(nv_crtc->base.dev, nv_crtc->index, false);\n}\n\nstatic void\nnv04_cursor_set_pos(struct nouveau_crtc *nv_crtc, int x, int y)\n{\n\tnv_crtc->cursor_saved_x = x; nv_crtc->cursor_saved_y = y;\n\tNVWriteRAMDAC(nv_crtc->base.dev, nv_crtc->index,\n\t\t      NV_PRAMDAC_CU_START_POS,\n\t\t      XLATE(y, 0, NV_PRAMDAC_CU_START_POS_Y) |\n\t\t      XLATE(x, 0, NV_PRAMDAC_CU_START_POS_X));\n}\n\nstatic void\ncrtc_wr_cio_state(struct drm_crtc *crtc, struct nv04_crtc_reg *crtcstate, int index)\n{\n\tNVWriteVgaCrtc(crtc->dev, nouveau_crtc(crtc)->index, index,\n\t\t       crtcstate->CRTC[index]);\n}\n\nstatic void\nnv04_cursor_set_offset(struct nouveau_crtc *nv_crtc, uint32_t offset)\n{\n\tstruct drm_device *dev = nv_crtc->base.dev;\n\tstruct nouveau_drm *drm = nouveau_drm(dev);\n\tstruct nv04_crtc_reg *regp = &nv04_display(dev)->mode_reg.crtc_reg[nv_crtc->index];\n\tstruct drm_crtc *crtc = &nv_crtc->base;\n\n\tregp->CRTC[NV_CIO_CRE_HCUR_ADDR0_INDEX] =\n\t\tMASK(NV_CIO_CRE_HCUR_ASI) |\n\t\tXLATE(offset, 17, NV_CIO_CRE_HCUR_ADDR0_ADR);\n\tregp->CRTC[NV_CIO_CRE_HCUR_ADDR1_INDEX] =\n\t\tXLATE(offset, 11, NV_CIO_CRE_HCUR_ADDR1_ADR);\n\tif (crtc->mode.flags & DRM_MODE_FLAG_DBLSCAN)\n\t\tregp->CRTC[NV_CIO_CRE_HCUR_ADDR1_INDEX] |=\n\t\t\tMASK(NV_CIO_CRE_HCUR_ADDR1_CUR_DBL);\n\tregp->CRTC[NV_CIO_CRE_HCUR_ADDR2_INDEX] = offset >> 24;\n\n\tcrtc_wr_cio_state(crtc, regp, NV_CIO_CRE_HCUR_ADDR0_INDEX);\n\tcrtc_wr_cio_state(crtc, regp, NV_CIO_CRE_HCUR_ADDR1_INDEX);\n\tcrtc_wr_cio_state(crtc, regp, NV_CIO_CRE_HCUR_ADDR2_INDEX);\n\tif (drm->client.device.info.family == NV_DEVICE_INFO_V0_CURIE)\n\t\tnv_fix_nv40_hw_cursor(dev, nv_crtc->index);\n}\n\nint\nnv04_cursor_init(struct nouveau_crtc *crtc)\n{\n\tcrtc->cursor.set_offset = nv04_cursor_set_offset;\n\tcrtc->cursor.set_pos = nv04_cursor_set_pos;\n\tcrtc->cursor.hide = nv04_cursor_hide;\n\tcrtc->cursor.show = nv04_cursor_show;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}