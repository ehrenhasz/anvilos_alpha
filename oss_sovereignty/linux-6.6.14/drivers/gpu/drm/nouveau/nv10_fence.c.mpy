{
  "module_name": "nv10_fence.c",
  "hash_id": "a33d1e764b1682ecf122e4f55a88c81e8125b32322b659cc08dbf27988896221",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nv10_fence.c",
  "human_readable_source": " \n#include \"nouveau_drv.h\"\n#include \"nouveau_dma.h\"\n#include \"nv10_fence.h\"\n\n#include <nvif/push006c.h>\n\n#include <nvhw/class/cl006e.h>\n\nint\nnv10_fence_emit(struct nouveau_fence *fence)\n{\n\tstruct nvif_push *push = fence->channel->chan.push;\n\tint ret = PUSH_WAIT(push, 2);\n\tif (ret == 0) {\n\t\tPUSH_MTHD(push, NV06E, SET_REFERENCE, fence->base.seqno);\n\t\tPUSH_KICK(push);\n\t}\n\treturn ret;\n}\n\n\nstatic int\nnv10_fence_sync(struct nouveau_fence *fence,\n\t\tstruct nouveau_channel *prev, struct nouveau_channel *chan)\n{\n\treturn -ENODEV;\n}\n\nu32\nnv10_fence_read(struct nouveau_channel *chan)\n{\n\treturn NVIF_RD32(&chan->user, NV06E, REFERENCE);\n}\n\nvoid\nnv10_fence_context_del(struct nouveau_channel *chan)\n{\n\tstruct nv10_fence_chan *fctx = chan->fence;\n\tnouveau_fence_context_del(&fctx->base);\n\tnvif_object_dtor(&fctx->sema);\n\tchan->fence = NULL;\n\tnouveau_fence_context_free(&fctx->base);\n}\n\nstatic int\nnv10_fence_context_new(struct nouveau_channel *chan)\n{\n\tstruct nv10_fence_chan *fctx;\n\n\tfctx = chan->fence = kzalloc(sizeof(*fctx), GFP_KERNEL);\n\tif (!fctx)\n\t\treturn -ENOMEM;\n\n\tnouveau_fence_context_new(chan, &fctx->base);\n\tfctx->base.emit = nv10_fence_emit;\n\tfctx->base.read = nv10_fence_read;\n\tfctx->base.sync = nv10_fence_sync;\n\treturn 0;\n}\n\nvoid\nnv10_fence_destroy(struct nouveau_drm *drm)\n{\n\tstruct nv10_fence_priv *priv = drm->fence;\n\tnouveau_bo_unmap(priv->bo);\n\tif (priv->bo)\n\t\tnouveau_bo_unpin(priv->bo);\n\tnouveau_bo_ref(NULL, &priv->bo);\n\tdrm->fence = NULL;\n\tkfree(priv);\n}\n\nint\nnv10_fence_create(struct nouveau_drm *drm)\n{\n\tstruct nv10_fence_priv *priv;\n\n\tpriv = drm->fence = kzalloc(sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->base.dtor = nv10_fence_destroy;\n\tpriv->base.context_new = nv10_fence_context_new;\n\tpriv->base.context_del = nv10_fence_context_del;\n\tspin_lock_init(&priv->lock);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}