{
  "module_name": "nv04_fence.c",
  "hash_id": "b468dfeeaa784b3b87c38b727387ee4efaca84ef26879b6a1ebb48bf6d13a816",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nv04_fence.c",
  "human_readable_source": " \n#include \"nouveau_drv.h\"\n#include \"nouveau_dma.h\"\n#include \"nouveau_fence.h\"\n\n#include <nvif/if0004.h>\n#include <nvif/push006c.h>\n\nstruct nv04_fence_chan {\n\tstruct nouveau_fence_chan base;\n};\n\nstruct nv04_fence_priv {\n\tstruct nouveau_fence_priv base;\n};\n\nstatic int\nnv04_fence_emit(struct nouveau_fence *fence)\n{\n\tstruct nvif_push *push = unrcu_pointer(fence->channel)->chan.push;\n\tint ret = PUSH_WAIT(push, 2);\n\tif (ret == 0) {\n\t\tPUSH_NVSQ(push, NV_SW, 0x0150, fence->base.seqno);\n\t\tPUSH_KICK(push);\n\t}\n\treturn ret;\n}\n\nstatic int\nnv04_fence_sync(struct nouveau_fence *fence,\n\t\tstruct nouveau_channel *prev, struct nouveau_channel *chan)\n{\n\treturn -ENODEV;\n}\n\nstatic u32\nnv04_fence_read(struct nouveau_channel *chan)\n{\n\tstruct nv04_nvsw_get_ref_v0 args = {};\n\tWARN_ON(nvif_object_mthd(&chan->nvsw, NV04_NVSW_GET_REF,\n\t\t\t\t &args, sizeof(args)));\n\treturn args.ref;\n}\n\nstatic void\nnv04_fence_context_del(struct nouveau_channel *chan)\n{\n\tstruct nv04_fence_chan *fctx = chan->fence;\n\tnouveau_fence_context_del(&fctx->base);\n\tchan->fence = NULL;\n\tnouveau_fence_context_free(&fctx->base);\n}\n\nstatic int\nnv04_fence_context_new(struct nouveau_channel *chan)\n{\n\tstruct nv04_fence_chan *fctx = kzalloc(sizeof(*fctx), GFP_KERNEL);\n\tif (fctx) {\n\t\tnouveau_fence_context_new(chan, &fctx->base);\n\t\tfctx->base.emit = nv04_fence_emit;\n\t\tfctx->base.sync = nv04_fence_sync;\n\t\tfctx->base.read = nv04_fence_read;\n\t\tchan->fence = fctx;\n\t\treturn 0;\n\t}\n\treturn -ENOMEM;\n}\n\nstatic void\nnv04_fence_destroy(struct nouveau_drm *drm)\n{\n\tstruct nv04_fence_priv *priv = drm->fence;\n\tdrm->fence = NULL;\n\tkfree(priv);\n}\n\nint\nnv04_fence_create(struct nouveau_drm *drm)\n{\n\tstruct nv04_fence_priv *priv;\n\n\tpriv = drm->fence = kzalloc(sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->base.dtor = nv04_fence_destroy;\n\tpriv->base.context_new = nv04_fence_context_new;\n\tpriv->base.context_del = nv04_fence_context_del;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}