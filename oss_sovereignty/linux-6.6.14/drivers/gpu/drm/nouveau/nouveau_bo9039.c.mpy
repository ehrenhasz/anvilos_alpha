{
  "module_name": "nouveau_bo9039.c",
  "hash_id": "7880520a65fce0a3bac5ef1d28d8b20a14f451c4967211d2fe69ad3fe86b5a5c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nouveau_bo9039.c",
  "human_readable_source": " \n \n#include \"nouveau_bo.h\"\n#include \"nouveau_dma.h\"\n#include \"nouveau_mem.h\"\n\n#include <nvif/push906f.h>\n\n#include <nvhw/class/cl9039.h>\n\nint\nnvc0_bo_move_m2mf(struct nouveau_channel *chan, struct ttm_buffer_object *bo,\n\t\t  struct ttm_resource *old_reg, struct ttm_resource *new_reg)\n{\n\tstruct nvif_push *push = chan->chan.push;\n\tstruct nouveau_mem *mem = nouveau_mem(old_reg);\n\tu64 src_offset = mem->vma[0].addr;\n\tu64 dst_offset = mem->vma[1].addr;\n\tu32 page_count = PFN_UP(new_reg->size);\n\tint ret;\n\n\tpage_count = PFN_UP(new_reg->size);\n\twhile (page_count) {\n\t\tint line_count = (page_count > 2047) ? 2047 : page_count;\n\n\t\tret = PUSH_WAIT(push, 12);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tPUSH_MTHD(push, NV9039, OFFSET_OUT_UPPER,\n\t\t\t  NVVAL(NV9039, OFFSET_OUT_UPPER, VALUE, upper_32_bits(dst_offset)),\n\n\t\t\t\t\tOFFSET_OUT, lower_32_bits(dst_offset));\n\n\t\tPUSH_MTHD(push, NV9039, OFFSET_IN_UPPER,\n\t\t\t  NVVAL(NV9039, OFFSET_IN_UPPER, VALUE, upper_32_bits(src_offset)),\n\n\t\t\t\t\tOFFSET_IN, lower_32_bits(src_offset),\n\t\t\t\t\tPITCH_IN, PAGE_SIZE,\n\t\t\t\t\tPITCH_OUT, PAGE_SIZE,\n\t\t\t\t\tLINE_LENGTH_IN, PAGE_SIZE,\n\t\t\t\t\tLINE_COUNT, line_count);\n\n\t\tPUSH_MTHD(push, NV9039, LAUNCH_DMA,\n\t\t\t  NVDEF(NV9039, LAUNCH_DMA, SRC_INLINE, FALSE) |\n\t\t\t  NVDEF(NV9039, LAUNCH_DMA, SRC_MEMORY_LAYOUT, PITCH) |\n\t\t\t  NVDEF(NV9039, LAUNCH_DMA, DST_MEMORY_LAYOUT, PITCH) |\n\t\t\t  NVDEF(NV9039, LAUNCH_DMA, COMPLETION_TYPE, FLUSH_DISABLE) |\n\t\t\t  NVDEF(NV9039, LAUNCH_DMA, INTERRUPT_TYPE, NONE) |\n\t\t\t  NVDEF(NV9039, LAUNCH_DMA, SEMAPHORE_STRUCT_SIZE, ONE_WORD));\n\n\t\tpage_count -= line_count;\n\t\tsrc_offset += (PAGE_SIZE * line_count);\n\t\tdst_offset += (PAGE_SIZE * line_count);\n\t}\n\n\treturn 0;\n}\n\nint\nnvc0_bo_move_init(struct nouveau_channel *chan, u32 handle)\n{\n\tstruct nvif_push *push = chan->chan.push;\n\tint ret;\n\n\tret = PUSH_WAIT(push, 2);\n\tif (ret)\n\t\treturn ret;\n\n\tPUSH_MTHD(push, NV9039, SET_OBJECT, handle);\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}