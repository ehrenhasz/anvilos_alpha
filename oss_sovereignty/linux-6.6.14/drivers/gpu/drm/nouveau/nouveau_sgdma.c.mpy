{
  "module_name": "nouveau_sgdma.c",
  "hash_id": "4f13759a956b63cbdf3302ac4b3fb3c80f1d99754821901e5b3a33c72443fefd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/nouveau/nouveau_sgdma.c",
  "human_readable_source": "\n#include <linux/pagemap.h>\n#include <linux/slab.h>\n#include <drm/ttm/ttm_tt.h>\n\n#include \"nouveau_drv.h\"\n#include \"nouveau_mem.h\"\n#include \"nouveau_ttm.h\"\n#include \"nouveau_bo.h\"\n\nstruct nouveau_sgdma_be {\n\t \n\tstruct ttm_tt ttm;\n\tstruct nouveau_mem *mem;\n};\n\nvoid\nnouveau_sgdma_destroy(struct ttm_device *bdev, struct ttm_tt *ttm)\n{\n\tstruct nouveau_sgdma_be *nvbe = (struct nouveau_sgdma_be *)ttm;\n\n\tif (ttm) {\n\t\tttm_tt_fini(&nvbe->ttm);\n\t\tkfree(nvbe);\n\t}\n}\n\nint\nnouveau_sgdma_bind(struct ttm_device *bdev, struct ttm_tt *ttm, struct ttm_resource *reg)\n{\n\tstruct nouveau_sgdma_be *nvbe = (struct nouveau_sgdma_be *)ttm;\n\tstruct nouveau_drm *drm = nouveau_bdev(bdev);\n\tstruct nouveau_mem *mem = nouveau_mem(reg);\n\tint ret;\n\n\tif (nvbe->mem)\n\t\treturn 0;\n\n\tret = nouveau_mem_host(reg, &nvbe->ttm);\n\tif (ret)\n\t\treturn ret;\n\n\tif (drm->client.device.info.family < NV_DEVICE_INFO_V0_TESLA) {\n\t\tret = nouveau_mem_map(mem, &mem->cli->vmm.vmm, &mem->vma[0]);\n\t\tif (ret) {\n\t\t\tnouveau_mem_fini(mem);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\tnvbe->mem = mem;\n\treturn 0;\n}\n\nvoid\nnouveau_sgdma_unbind(struct ttm_device *bdev, struct ttm_tt *ttm)\n{\n\tstruct nouveau_sgdma_be *nvbe = (struct nouveau_sgdma_be *)ttm;\n\tif (nvbe->mem) {\n\t\tnouveau_mem_fini(nvbe->mem);\n\t\tnvbe->mem = NULL;\n\t}\n}\n\nstruct ttm_tt *\nnouveau_sgdma_create_ttm(struct ttm_buffer_object *bo, uint32_t page_flags)\n{\n\tstruct nouveau_drm *drm = nouveau_bdev(bo->bdev);\n\tstruct nouveau_bo *nvbo = nouveau_bo(bo);\n\tstruct nouveau_sgdma_be *nvbe;\n\tenum ttm_caching caching;\n\n\tif (nvbo->force_coherent)\n\t\tcaching = ttm_uncached;\n\telse if (drm->agp.bridge)\n\t\tcaching = ttm_write_combined;\n\telse\n\t\tcaching = ttm_cached;\n\n\tnvbe = kzalloc(sizeof(*nvbe), GFP_KERNEL);\n\tif (!nvbe)\n\t\treturn NULL;\n\n\tif (ttm_sg_tt_init(&nvbe->ttm, bo, page_flags, caching)) {\n\t\tkfree(nvbe);\n\t\treturn NULL;\n\t}\n\treturn &nvbe->ttm;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}