{
  "module_name": "panfrost_device.h",
  "hash_id": "363a6d72f9da1505da15246164848cb819a61c10bf01cc16b15b62ceea3fa17e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/panfrost/panfrost_device.h",
  "human_readable_source": " \n \n \n\n#ifndef __PANFROST_DEVICE_H__\n#define __PANFROST_DEVICE_H__\n\n#include <linux/atomic.h>\n#include <linux/io-pgtable.h>\n#include <linux/pm.h>\n#include <linux/regulator/consumer.h>\n#include <linux/spinlock.h>\n#include <drm/drm_device.h>\n#include <drm/drm_mm.h>\n#include <drm/gpu_scheduler.h>\n\n#include \"panfrost_devfreq.h\"\n\nstruct panfrost_device;\nstruct panfrost_mmu;\nstruct panfrost_job_slot;\nstruct panfrost_job;\nstruct panfrost_perfcnt;\n\n#define NUM_JOB_SLOTS 3\n#define MAX_PM_DOMAINS 5\n\nstruct panfrost_features {\n\tu16 id;\n\tu16 revision;\n\n\tu64 shader_present;\n\tu64 tiler_present;\n\tu64 l2_present;\n\tu64 stack_present;\n\tu32 as_present;\n\tu32 js_present;\n\n\tu32 l2_features;\n\tu32 core_features;\n\tu32 tiler_features;\n\tu32 mem_features;\n\tu32 mmu_features;\n\tu32 thread_features;\n\tu32 max_threads;\n\tu32 thread_max_workgroup_sz;\n\tu32 thread_max_barrier_sz;\n\tu32 coherency_features;\n\tu32 afbc_features;\n\tu32 texture_features[4];\n\tu32 js_features[16];\n\n\tu32 nr_core_groups;\n\tu32 thread_tls_alloc;\n\n\tunsigned long hw_features[64 / BITS_PER_LONG];\n\tunsigned long hw_issues[64 / BITS_PER_LONG];\n};\n\n \nstruct panfrost_compatible {\n\t \n\tint num_supplies;\n\tconst char * const *supply_names;\n\t \n\tint num_pm_domains;\n\t \n\tconst char * const *pm_domain_names;\n\n\t \n\tvoid (*vendor_quirk)(struct panfrost_device *pfdev);\n};\n\nstruct panfrost_device {\n\tstruct device *dev;\n\tstruct drm_device *ddev;\n\tstruct platform_device *pdev;\n\n\tvoid __iomem *iomem;\n\tstruct clk *clock;\n\tstruct clk *bus_clock;\n\tstruct regulator_bulk_data *regulators;\n\tstruct reset_control *rstc;\n\t \n\tstruct device *pm_domain_devs[MAX_PM_DOMAINS];\n\tstruct device_link *pm_domain_links[MAX_PM_DOMAINS];\n\tbool coherent;\n\n\tstruct panfrost_features features;\n\tconst struct panfrost_compatible *comp;\n\n\tspinlock_t as_lock;\n\tunsigned long as_in_use_mask;\n\tunsigned long as_alloc_mask;\n\tunsigned long as_faulty_mask;\n\tstruct list_head as_lru_list;\n\n\tstruct panfrost_job_slot *js;\n\n\tstruct panfrost_job *jobs[NUM_JOB_SLOTS][2];\n\tstruct list_head scheduled_jobs;\n\n\tstruct panfrost_perfcnt *perfcnt;\n\n\tstruct mutex sched_lock;\n\n\tstruct {\n\t\tstruct workqueue_struct *wq;\n\t\tstruct work_struct work;\n\t\tatomic_t pending;\n\t} reset;\n\n\tstruct mutex shrinker_lock;\n\tstruct list_head shrinker_list;\n\tstruct shrinker shrinker;\n\n\tstruct panfrost_devfreq pfdevfreq;\n};\n\nstruct panfrost_mmu {\n\tstruct panfrost_device *pfdev;\n\tstruct kref refcount;\n\tstruct io_pgtable_cfg pgtbl_cfg;\n\tstruct io_pgtable_ops *pgtbl_ops;\n\tstruct drm_mm mm;\n\tspinlock_t mm_lock;\n\tint as;\n\tatomic_t as_count;\n\tstruct list_head list;\n};\n\nstruct panfrost_file_priv {\n\tstruct panfrost_device *pfdev;\n\n\tstruct drm_sched_entity sched_entity[NUM_JOB_SLOTS];\n\n\tstruct panfrost_mmu *mmu;\n};\n\nstatic inline struct panfrost_device *to_panfrost_device(struct drm_device *ddev)\n{\n\treturn ddev->dev_private;\n}\n\nstatic inline int panfrost_model_cmp(struct panfrost_device *pfdev, s32 id)\n{\n\ts32 match_id = pfdev->features.id;\n\n\tif (match_id & 0xf000)\n\t\tmatch_id &= 0xf00f;\n\treturn match_id - id;\n}\n\nstatic inline bool panfrost_model_is_bifrost(struct panfrost_device *pfdev)\n{\n\treturn panfrost_model_cmp(pfdev, 0x1000) >= 0;\n}\n\nstatic inline bool panfrost_model_eq(struct panfrost_device *pfdev, s32 id)\n{\n\treturn !panfrost_model_cmp(pfdev, id);\n}\n\nint panfrost_unstable_ioctl_check(void);\n\nint panfrost_device_init(struct panfrost_device *pfdev);\nvoid panfrost_device_fini(struct panfrost_device *pfdev);\nvoid panfrost_device_reset(struct panfrost_device *pfdev);\n\nextern const struct dev_pm_ops panfrost_pm_ops;\n\nenum drm_panfrost_exception_type {\n\tDRM_PANFROST_EXCEPTION_OK = 0x00,\n\tDRM_PANFROST_EXCEPTION_DONE = 0x01,\n\tDRM_PANFROST_EXCEPTION_INTERRUPTED = 0x02,\n\tDRM_PANFROST_EXCEPTION_STOPPED = 0x03,\n\tDRM_PANFROST_EXCEPTION_TERMINATED = 0x04,\n\tDRM_PANFROST_EXCEPTION_KABOOM = 0x05,\n\tDRM_PANFROST_EXCEPTION_EUREKA = 0x06,\n\tDRM_PANFROST_EXCEPTION_ACTIVE = 0x08,\n\tDRM_PANFROST_EXCEPTION_MAX_NON_FAULT = 0x3f,\n\tDRM_PANFROST_EXCEPTION_JOB_CONFIG_FAULT = 0x40,\n\tDRM_PANFROST_EXCEPTION_JOB_POWER_FAULT = 0x41,\n\tDRM_PANFROST_EXCEPTION_JOB_READ_FAULT = 0x42,\n\tDRM_PANFROST_EXCEPTION_JOB_WRITE_FAULT = 0x43,\n\tDRM_PANFROST_EXCEPTION_JOB_AFFINITY_FAULT = 0x44,\n\tDRM_PANFROST_EXCEPTION_JOB_BUS_FAULT = 0x48,\n\tDRM_PANFROST_EXCEPTION_INSTR_INVALID_PC = 0x50,\n\tDRM_PANFROST_EXCEPTION_INSTR_INVALID_ENC = 0x51,\n\tDRM_PANFROST_EXCEPTION_INSTR_TYPE_MISMATCH = 0x52,\n\tDRM_PANFROST_EXCEPTION_INSTR_OPERAND_FAULT = 0x53,\n\tDRM_PANFROST_EXCEPTION_INSTR_TLS_FAULT = 0x54,\n\tDRM_PANFROST_EXCEPTION_INSTR_BARRIER_FAULT = 0x55,\n\tDRM_PANFROST_EXCEPTION_INSTR_ALIGN_FAULT = 0x56,\n\tDRM_PANFROST_EXCEPTION_DATA_INVALID_FAULT = 0x58,\n\tDRM_PANFROST_EXCEPTION_TILE_RANGE_FAULT = 0x59,\n\tDRM_PANFROST_EXCEPTION_ADDR_RANGE_FAULT = 0x5a,\n\tDRM_PANFROST_EXCEPTION_IMPRECISE_FAULT = 0x5b,\n\tDRM_PANFROST_EXCEPTION_OOM = 0x60,\n\tDRM_PANFROST_EXCEPTION_OOM_AFBC = 0x61,\n\tDRM_PANFROST_EXCEPTION_UNKNOWN = 0x7f,\n\tDRM_PANFROST_EXCEPTION_DELAYED_BUS_FAULT = 0x80,\n\tDRM_PANFROST_EXCEPTION_GPU_SHAREABILITY_FAULT = 0x88,\n\tDRM_PANFROST_EXCEPTION_SYS_SHAREABILITY_FAULT = 0x89,\n\tDRM_PANFROST_EXCEPTION_GPU_CACHEABILITY_FAULT = 0x8a,\n\tDRM_PANFROST_EXCEPTION_TRANSLATION_FAULT_0 = 0xc0,\n\tDRM_PANFROST_EXCEPTION_TRANSLATION_FAULT_1 = 0xc1,\n\tDRM_PANFROST_EXCEPTION_TRANSLATION_FAULT_2 = 0xc2,\n\tDRM_PANFROST_EXCEPTION_TRANSLATION_FAULT_3 = 0xc3,\n\tDRM_PANFROST_EXCEPTION_TRANSLATION_FAULT_4 = 0xc4,\n\tDRM_PANFROST_EXCEPTION_TRANSLATION_FAULT_IDENTITY = 0xc7,\n\tDRM_PANFROST_EXCEPTION_PERM_FAULT_0 = 0xc8,\n\tDRM_PANFROST_EXCEPTION_PERM_FAULT_1 = 0xc9,\n\tDRM_PANFROST_EXCEPTION_PERM_FAULT_2 = 0xca,\n\tDRM_PANFROST_EXCEPTION_PERM_FAULT_3 = 0xcb,\n\tDRM_PANFROST_EXCEPTION_TRANSTAB_BUS_FAULT_0 = 0xd0,\n\tDRM_PANFROST_EXCEPTION_TRANSTAB_BUS_FAULT_1 = 0xd1,\n\tDRM_PANFROST_EXCEPTION_TRANSTAB_BUS_FAULT_2 = 0xd2,\n\tDRM_PANFROST_EXCEPTION_TRANSTAB_BUS_FAULT_3 = 0xd3,\n\tDRM_PANFROST_EXCEPTION_ACCESS_FLAG_0 = 0xd8,\n\tDRM_PANFROST_EXCEPTION_ACCESS_FLAG_1 = 0xd9,\n\tDRM_PANFROST_EXCEPTION_ACCESS_FLAG_2 = 0xda,\n\tDRM_PANFROST_EXCEPTION_ACCESS_FLAG_3 = 0xdb,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_IN0 = 0xe0,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_IN1 = 0xe1,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_IN2 = 0xe2,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_IN3 = 0xe3,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_OUT0 = 0xe4,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_OUT1 = 0xe5,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_OUT2 = 0xe6,\n\tDRM_PANFROST_EXCEPTION_ADDR_SIZE_FAULT_OUT3 = 0xe7,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_FAULT_0 = 0xe8,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_FAULT_1 = 0xe9,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_FAULT_2 = 0xea,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_FAULT_3 = 0xeb,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_NONCACHE_0 = 0xec,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_NONCACHE_1 = 0xed,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_NONCACHE_2 = 0xee,\n\tDRM_PANFROST_EXCEPTION_MEM_ATTR_NONCACHE_3 = 0xef,\n};\n\nstatic inline bool\npanfrost_exception_is_fault(u32 exception_code)\n{\n\treturn exception_code > DRM_PANFROST_EXCEPTION_MAX_NON_FAULT;\n}\n\nconst char *panfrost_exception_name(u32 exception_code);\nbool panfrost_exception_needs_reset(const struct panfrost_device *pfdev,\n\t\t\t\t    u32 exception_code);\n\nstatic inline void\npanfrost_device_schedule_reset(struct panfrost_device *pfdev)\n{\n\tatomic_set(&pfdev->reset.pending, 1);\n\tqueue_work(pfdev->reset.wq, &pfdev->reset.work);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}