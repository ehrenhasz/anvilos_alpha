{
  "module_name": "meson_viu.c",
  "hash_id": "abedc6a540da93f7637f4a633f9af22cf649d62d7a256cbf66fe4b6ee8e93294",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/meson/meson_viu.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n#include <linux/bitfield.h>\n\n#include <drm/drm_fourcc.h>\n\n#include \"meson_drv.h\"\n#include \"meson_viu.h\"\n#include \"meson_registers.h\"\n\n \n\n \n\nenum viu_matrix_sel_e {\n\tVIU_MATRIX_OSD_EOTF = 0,\n\tVIU_MATRIX_OSD,\n};\n\nenum viu_lut_sel_e {\n\tVIU_LUT_OSD_EOTF = 0,\n\tVIU_LUT_OSD_OETF,\n};\n\n#define COEFF_NORM(a) ((int)((((a) * 2048.0) + 1) / 2))\n#define MATRIX_5X3_COEF_SIZE 24\n\n#define EOTF_COEFF_NORM(a) ((int)((((a) * 4096.0) + 1) / 2))\n#define EOTF_COEFF_SIZE 10\n#define EOTF_COEFF_RIGHTSHIFT 1\n\nstatic int RGB709_to_YUV709l_coeff[MATRIX_5X3_COEF_SIZE] = {\n\t0, 0, 0,  \n\tCOEFF_NORM(0.181873),\tCOEFF_NORM(0.611831),\tCOEFF_NORM(0.061765),\n\tCOEFF_NORM(-0.100251),\tCOEFF_NORM(-0.337249),\tCOEFF_NORM(0.437500),\n\tCOEFF_NORM(0.437500),\tCOEFF_NORM(-0.397384),\tCOEFF_NORM(-0.040116),\n\t0, 0, 0,  \n\t0, 0, 0,  \n\t64, 512, 512,  \n\t0, 0, 0  \n};\n\n \nstatic int eotf_bypass_coeff[EOTF_COEFF_SIZE] = {\n\tEOTF_COEFF_NORM(1.0),\tEOTF_COEFF_NORM(0.0),\tEOTF_COEFF_NORM(0.0),\n\tEOTF_COEFF_NORM(0.0),\tEOTF_COEFF_NORM(1.0),\tEOTF_COEFF_NORM(0.0),\n\tEOTF_COEFF_NORM(0.0),\tEOTF_COEFF_NORM(0.0),\tEOTF_COEFF_NORM(1.0),\n\tEOTF_COEFF_RIGHTSHIFT  \n};\n\nstatic void meson_viu_set_g12a_osd1_matrix(struct meson_drm *priv,\n\t\t\t\t\t   int *m, bool csc_on)\n{\n\t \n\twritel(((m[0] & 0xfff) << 16) | (m[1] & 0xfff),\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_PRE_OFFSET0_1));\n\twritel(m[2] & 0xfff,\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_PRE_OFFSET2));\n\twritel(((m[3] & 0x1fff) << 16) | (m[4] & 0x1fff),\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_COEF00_01));\n\twritel(((m[5] & 0x1fff) << 16) | (m[6] & 0x1fff),\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_COEF02_10));\n\twritel(((m[7] & 0x1fff) << 16) | (m[8] & 0x1fff),\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_COEF11_12));\n\twritel(((m[9] & 0x1fff) << 16) | (m[10] & 0x1fff),\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_COEF20_21));\n\twritel((m[11] & 0x1fff),\n\t\tpriv->io_base +\t_REG(VPP_WRAP_OSD1_MATRIX_COEF22));\n\n\twritel(((m[18] & 0xfff) << 16) | (m[19] & 0xfff),\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_OFFSET0_1));\n\twritel(m[20] & 0xfff,\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_OFFSET2));\n\n\twritel_bits_relaxed(BIT(0), csc_on ? BIT(0) : 0,\n\t\tpriv->io_base + _REG(VPP_WRAP_OSD1_MATRIX_EN_CTRL));\n}\n\nstatic void meson_viu_set_osd_matrix(struct meson_drm *priv,\n\t\t\t\t     enum viu_matrix_sel_e m_select,\n\t\t\t      int *m, bool csc_on)\n{\n\tif (m_select == VIU_MATRIX_OSD) {\n\t\t \n\t\twritel(((m[0] & 0xfff) << 16) | (m[1] & 0xfff),\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_PRE_OFFSET0_1));\n\t\twritel(m[2] & 0xfff,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_PRE_OFFSET2));\n\t\twritel(((m[3] & 0x1fff) << 16) | (m[4] & 0x1fff),\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_COEF00_01));\n\t\twritel(((m[5] & 0x1fff) << 16) | (m[6] & 0x1fff),\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_COEF02_10));\n\t\twritel(((m[7] & 0x1fff) << 16) | (m[8] & 0x1fff),\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_COEF11_12));\n\t\twritel(((m[9] & 0x1fff) << 16) | (m[10] & 0x1fff),\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_COEF20_21));\n\n\t\tif (m[21]) {\n\t\t\twritel(((m[11] & 0x1fff) << 16) | (m[12] & 0x1fff),\n\t\t\t\tpriv->io_base +\n\t\t\t\t\t_REG(VIU_OSD1_MATRIX_COEF22_30));\n\t\t\twritel(((m[13] & 0x1fff) << 16) | (m[14] & 0x1fff),\n\t\t\t\tpriv->io_base +\n\t\t\t\t\t_REG(VIU_OSD1_MATRIX_COEF31_32));\n\t\t\twritel(((m[15] & 0x1fff) << 16) | (m[16] & 0x1fff),\n\t\t\t\tpriv->io_base +\n\t\t\t\t\t_REG(VIU_OSD1_MATRIX_COEF40_41));\n\t\t\twritel(m[17] & 0x1fff, priv->io_base +\n\t\t\t\t_REG(VIU_OSD1_MATRIX_COLMOD_COEF42));\n\t\t} else\n\t\t\twritel((m[11] & 0x1fff) << 16, priv->io_base +\n\t\t\t\t_REG(VIU_OSD1_MATRIX_COEF22_30));\n\n\t\twritel(((m[18] & 0xfff) << 16) | (m[19] & 0xfff),\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_OFFSET0_1));\n\t\twritel(m[20] & 0xfff,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_OFFSET2));\n\n\t\twritel_bits_relaxed(3 << 30, m[21] << 30,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_COLMOD_COEF42));\n\t\twritel_bits_relaxed(7 << 16, m[22] << 16,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_COLMOD_COEF42));\n\n\t\t \n\t\twritel_bits_relaxed(BIT(0), csc_on ? BIT(0) : 0,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_CTRL));\n\t\twritel_bits_relaxed(BIT(1), 0,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_MATRIX_CTRL));\n\t} else if (m_select == VIU_MATRIX_OSD_EOTF) {\n\t\tint i;\n\n\t\t \n\t\tfor (i = 0; i < 5; i++)\n\t\t\twritel(((m[i * 2] & 0x1fff) << 16) |\n\t\t\t\t(m[i * 2 + 1] & 0x1fff), priv->io_base +\n\t\t\t\t_REG(VIU_OSD1_EOTF_CTL + i + 1));\n\n\t\twritel_bits_relaxed(BIT(30), csc_on ? BIT(30) : 0,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_EOTF_CTL));\n\t\twritel_bits_relaxed(BIT(31), csc_on ? BIT(31) : 0,\n\t\t\tpriv->io_base + _REG(VIU_OSD1_EOTF_CTL));\n\t}\n}\n\n#define OSD_EOTF_LUT_SIZE 33\n#define OSD_OETF_LUT_SIZE 41\n\nstatic void\nmeson_viu_set_osd_lut(struct meson_drm *priv, enum viu_lut_sel_e lut_sel,\n\t\t      unsigned int *r_map, unsigned int *g_map,\n\t\t      unsigned int *b_map, bool csc_on)\n{\n\tunsigned int addr_port;\n\tunsigned int data_port;\n\tunsigned int ctrl_port;\n\tint i;\n\n\tif (lut_sel == VIU_LUT_OSD_EOTF) {\n\t\taddr_port = VIU_OSD1_EOTF_LUT_ADDR_PORT;\n\t\tdata_port = VIU_OSD1_EOTF_LUT_DATA_PORT;\n\t\tctrl_port = VIU_OSD1_EOTF_CTL;\n\t} else if (lut_sel == VIU_LUT_OSD_OETF) {\n\t\taddr_port = VIU_OSD1_OETF_LUT_ADDR_PORT;\n\t\tdata_port = VIU_OSD1_OETF_LUT_DATA_PORT;\n\t\tctrl_port = VIU_OSD1_OETF_CTL;\n\t} else\n\t\treturn;\n\n\tif (lut_sel == VIU_LUT_OSD_OETF) {\n\t\twritel(0, priv->io_base + _REG(addr_port));\n\n\t\tfor (i = 0; i < (OSD_OETF_LUT_SIZE / 2); i++)\n\t\t\twritel(r_map[i * 2] | (r_map[i * 2 + 1] << 16),\n\t\t\t\tpriv->io_base + _REG(data_port));\n\n\t\twritel(r_map[OSD_OETF_LUT_SIZE - 1] | (g_map[0] << 16),\n\t\t\tpriv->io_base + _REG(data_port));\n\n\t\tfor (i = 0; i < (OSD_OETF_LUT_SIZE / 2); i++)\n\t\t\twritel(g_map[i * 2 + 1] | (g_map[i * 2 + 2] << 16),\n\t\t\t\tpriv->io_base + _REG(data_port));\n\n\t\tfor (i = 0; i < (OSD_OETF_LUT_SIZE / 2); i++)\n\t\t\twritel(b_map[i * 2] | (b_map[i * 2 + 1] << 16),\n\t\t\t\tpriv->io_base + _REG(data_port));\n\n\t\twritel(b_map[OSD_OETF_LUT_SIZE - 1],\n\t\t\tpriv->io_base + _REG(data_port));\n\n\t\tif (csc_on)\n\t\t\twritel_bits_relaxed(0x7 << 29, 7 << 29,\n\t\t\t\t\t    priv->io_base + _REG(ctrl_port));\n\t\telse\n\t\t\twritel_bits_relaxed(0x7 << 29, 0,\n\t\t\t\t\t    priv->io_base + _REG(ctrl_port));\n\t} else if (lut_sel == VIU_LUT_OSD_EOTF) {\n\t\twritel(0, priv->io_base + _REG(addr_port));\n\n\t\tfor (i = 0; i < (OSD_EOTF_LUT_SIZE / 2); i++)\n\t\t\twritel(r_map[i * 2] | (r_map[i * 2 + 1] << 16),\n\t\t\t\tpriv->io_base + _REG(data_port));\n\n\t\twritel(r_map[OSD_EOTF_LUT_SIZE - 1] | (g_map[0] << 16),\n\t\t\tpriv->io_base + _REG(data_port));\n\n\t\tfor (i = 0; i < (OSD_EOTF_LUT_SIZE / 2); i++)\n\t\t\twritel(g_map[i * 2 + 1] | (g_map[i * 2 + 2] << 16),\n\t\t\t\tpriv->io_base + _REG(data_port));\n\n\t\tfor (i = 0; i < (OSD_EOTF_LUT_SIZE / 2); i++)\n\t\t\twritel(b_map[i * 2] | (b_map[i * 2 + 1] << 16),\n\t\t\t\tpriv->io_base + _REG(data_port));\n\n\t\twritel(b_map[OSD_EOTF_LUT_SIZE - 1],\n\t\t\tpriv->io_base + _REG(data_port));\n\n\t\tif (csc_on)\n\t\t\twritel_bits_relaxed(7 << 27, 7 << 27,\n\t\t\t\t\t    priv->io_base + _REG(ctrl_port));\n\t\telse\n\t\t\twritel_bits_relaxed(7 << 27, 0,\n\t\t\t\t\t    priv->io_base + _REG(ctrl_port));\n\n\t\twritel_bits_relaxed(BIT(31), BIT(31),\n\t\t\t\t    priv->io_base + _REG(ctrl_port));\n\t}\n}\n\n \nstatic unsigned int eotf_33_linear_mapping[OSD_EOTF_LUT_SIZE] = {\n\t0x0000,\t0x0200,\t0x0400, 0x0600,\n\t0x0800, 0x0a00, 0x0c00, 0x0e00,\n\t0x1000, 0x1200, 0x1400, 0x1600,\n\t0x1800, 0x1a00, 0x1c00, 0x1e00,\n\t0x2000, 0x2200, 0x2400, 0x2600,\n\t0x2800, 0x2a00, 0x2c00, 0x2e00,\n\t0x3000, 0x3200, 0x3400, 0x3600,\n\t0x3800, 0x3a00, 0x3c00, 0x3e00,\n\t0x4000\n};\n\n \nstatic unsigned int oetf_41_linear_mapping[OSD_OETF_LUT_SIZE] = {\n\t0, 0, 0, 0,\n\t0, 32, 64, 96,\n\t128, 160, 196, 224,\n\t256, 288, 320, 352,\n\t384, 416, 448, 480,\n\t512, 544, 576, 608,\n\t640, 672, 704, 736,\n\t768, 800, 832, 864,\n\t896, 928, 960, 992,\n\t1023, 1023, 1023, 1023,\n\t1023\n};\n\nstatic void meson_viu_load_matrix(struct meson_drm *priv)\n{\n\t \n\tmeson_viu_set_osd_lut(priv, VIU_LUT_OSD_EOTF,\n\t\t\t      eotf_33_linear_mapping,  \n\t\t\t      eotf_33_linear_mapping,  \n\t\t\t      eotf_33_linear_mapping,  \n\t\t\t      false);\n\n\t \n\tmeson_viu_set_osd_matrix(priv, VIU_MATRIX_OSD_EOTF,\n\t\t\t\t eotf_bypass_coeff,\n\t\t\t\t false);\n\n\t \n\tmeson_viu_set_osd_lut(priv, VIU_LUT_OSD_OETF,\n\t\t\t      oetf_41_linear_mapping,  \n\t\t\t      oetf_41_linear_mapping,  \n\t\t\t      oetf_41_linear_mapping,  \n\t\t\t      false);\n\n\t \n\tmeson_viu_set_osd_matrix(priv, VIU_MATRIX_OSD,\n\t\t\t\t RGB709_to_YUV709l_coeff,\n\t\t\t\t true);\n}\n\n \nvoid meson_viu_osd1_reset(struct meson_drm *priv)\n{\n\tuint32_t osd1_fifo_ctrl_stat, osd1_ctrl_stat2;\n\n\t \n\tosd1_fifo_ctrl_stat = readl_relaxed(\n\t\t\t\tpriv->io_base + _REG(VIU_OSD1_FIFO_CTRL_STAT));\n\tosd1_ctrl_stat2 = readl_relaxed(\n\t\t\t\tpriv->io_base + _REG(VIU_OSD1_CTRL_STAT2));\n\n\t \n\twritel_bits_relaxed(VIU_SW_RESET_OSD1, VIU_SW_RESET_OSD1,\n\t\t\t    priv->io_base + _REG(VIU_SW_RESET));\n\twritel_bits_relaxed(VIU_SW_RESET_OSD1, 0,\n\t\t\t    priv->io_base + _REG(VIU_SW_RESET));\n\n\t \n\twritel_relaxed(osd1_fifo_ctrl_stat,\n\t\t       priv->io_base + _REG(VIU_OSD1_FIFO_CTRL_STAT));\n\twritel_relaxed(osd1_ctrl_stat2,\n\t\t       priv->io_base + _REG(VIU_OSD1_CTRL_STAT2));\n\n\t \n\tmeson_viu_load_matrix(priv);\n}\n\n#define OSD1_MALI_ORDER_ABGR\t\t\t\t\\\n\t(FIELD_PREP(VIU_OSD1_MALI_AFBCD_A_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_A) |\t\t\\\n\t FIELD_PREP(VIU_OSD1_MALI_AFBCD_B_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_B) |\t\t\\\n\t FIELD_PREP(VIU_OSD1_MALI_AFBCD_G_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_G) |\t\t\\\n\t FIELD_PREP(VIU_OSD1_MALI_AFBCD_R_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_R))\n\n#define OSD1_MALI_ORDER_ARGB\t\t\t\t\\\n\t(FIELD_PREP(VIU_OSD1_MALI_AFBCD_A_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_A) |\t\t\\\n\t FIELD_PREP(VIU_OSD1_MALI_AFBCD_B_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_R) |\t\t\\\n\t FIELD_PREP(VIU_OSD1_MALI_AFBCD_G_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_G) |\t\t\\\n\t FIELD_PREP(VIU_OSD1_MALI_AFBCD_R_REORDER,\t\\\n\t\t    VIU_OSD1_MALI_REORDER_B))\n\nvoid meson_viu_g12a_enable_osd1_afbc(struct meson_drm *priv)\n{\n\tu32 afbc_order = OSD1_MALI_ORDER_ARGB;\n\n\t \n\twritel_bits_relaxed(VIU_OSD1_MALI_UNPACK_EN,\n\t\t\t    VIU_OSD1_MALI_UNPACK_EN,\n\t\t\t    priv->io_base + _REG(VIU_OSD1_MALI_UNPACK_CTRL));\n\n\tswitch (priv->afbcd.format) {\n\tcase DRM_FORMAT_XBGR8888:\n\tcase DRM_FORMAT_ABGR8888:\n\t\tafbc_order = OSD1_MALI_ORDER_ABGR;\n\t\tbreak;\n\t}\n\n\t \n\twritel_bits_relaxed(VIU_OSD1_MALI_AFBCD_A_REORDER |\n\t\t\t    VIU_OSD1_MALI_AFBCD_B_REORDER |\n\t\t\t    VIU_OSD1_MALI_AFBCD_G_REORDER |\n\t\t\t    VIU_OSD1_MALI_AFBCD_R_REORDER,\n\t\t\t    afbc_order,\n\t\t\t    priv->io_base + _REG(VIU_OSD1_MALI_UNPACK_CTRL));\n\n\t \n\twritel_bits_relaxed(OSD_PATH_OSD_AXI_SEL_OSD1_AFBCD,\n\t\t\t    OSD_PATH_OSD_AXI_SEL_OSD1_AFBCD,\n\t\t\t    priv->io_base + _REG(OSD_PATH_MISC_CTRL));\n}\n\nvoid meson_viu_g12a_disable_osd1_afbc(struct meson_drm *priv)\n{\n\t \n\twritel_bits_relaxed(OSD_PATH_OSD_AXI_SEL_OSD1_AFBCD, 0,\n\t\t\t    priv->io_base + _REG(OSD_PATH_MISC_CTRL));\n\n\t \n\twritel_bits_relaxed(VIU_OSD1_MALI_UNPACK_EN, 0,\n\t\t\t    priv->io_base + _REG(VIU_OSD1_MALI_UNPACK_CTRL));\n}\n\nvoid meson_viu_gxm_enable_osd1_afbc(struct meson_drm *priv)\n{\n\twritel_bits_relaxed(MALI_AFBC_MISC, FIELD_PREP(MALI_AFBC_MISC, 0x90),\n\t\t\t    priv->io_base + _REG(VIU_MISC_CTRL1));\n}\n\nvoid meson_viu_gxm_disable_osd1_afbc(struct meson_drm *priv)\n{\n\twritel_bits_relaxed(MALI_AFBC_MISC, FIELD_PREP(MALI_AFBC_MISC, 0x00),\n\t\t\t    priv->io_base + _REG(VIU_MISC_CTRL1));\n}\n\nvoid meson_viu_init(struct meson_drm *priv)\n{\n\tuint32_t reg;\n\n\t \n\twritel_bits_relaxed(VIU_OSD1_OSD_BLK_ENABLE | VIU_OSD1_OSD_ENABLE, 0,\n\t\t\t    priv->io_base + _REG(VIU_OSD1_CTRL_STAT));\n\twritel_bits_relaxed(VIU_OSD1_OSD_BLK_ENABLE | VIU_OSD1_OSD_ENABLE, 0,\n\t\t\t    priv->io_base + _REG(VIU_OSD2_CTRL_STAT));\n\n\t \n\tif (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_GXM) ||\n\t    meson_vpu_is_compatible(priv, VPU_COMPATIBLE_GXL))\n\t\tmeson_viu_load_matrix(priv);\n\telse if (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_G12A)) {\n\t\tmeson_viu_set_g12a_osd1_matrix(priv, RGB709_to_YUV709l_coeff,\n\t\t\t\t\t       true);\n\t\t \n\t\twritel_bits_relaxed(OSD1_HDR2_CTRL_REG_ONLY_MAT |\n\t\t\t\tOSD1_HDR2_CTRL_VDIN0_HDR2_TOP_EN, 0,\n\t\t\t\tpriv->io_base + _REG(OSD1_HDR2_CTRL));\n\t}\n\n\t \n\treg = VIU_OSD_DDR_PRIORITY_URGENT |\n\t\tVIU_OSD_FIFO_DEPTH_VAL(32) |  \n\t\tVIU_OSD_WORDS_PER_BURST(4) |  \n\t\tVIU_OSD_FIFO_LIMITS(2);       \n\n\tif (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_G12A))\n\t\treg |= (VIU_OSD_BURST_LENGTH_32 | VIU_OSD_HOLD_FIFO_LINES(31));\n\telse\n\t\treg |= (VIU_OSD_BURST_LENGTH_64 | VIU_OSD_HOLD_FIFO_LINES(4));\n\n\twritel_relaxed(reg, priv->io_base + _REG(VIU_OSD1_FIFO_CTRL_STAT));\n\twritel_relaxed(reg, priv->io_base + _REG(VIU_OSD2_FIFO_CTRL_STAT));\n\n\t \n\twritel_bits_relaxed(0xff << OSD_REPLACE_SHIFT,\n\t\t\t    0xff << OSD_REPLACE_SHIFT,\n\t\t\t    priv->io_base + _REG(VIU_OSD1_CTRL_STAT2));\n\twritel_bits_relaxed(0xff << OSD_REPLACE_SHIFT,\n\t\t\t    0xff << OSD_REPLACE_SHIFT,\n\t\t\t    priv->io_base + _REG(VIU_OSD2_CTRL_STAT2));\n\n\t \n\t \n\twritel_bits_relaxed(VIU_CTRL0_VD1_AFBC_MASK, 0,\n\t\t\t    priv->io_base + _REG(VIU_MISC_CTRL0));\n\twritel_relaxed(0, priv->io_base + _REG(AFBC_ENABLE));\n\n\twritel_relaxed(0x00FF00C0,\n\t\t\tpriv->io_base + _REG(VD1_IF0_LUMA_FIFO_SIZE));\n\twritel_relaxed(0x00FF00C0,\n\t\t\tpriv->io_base + _REG(VD2_IF0_LUMA_FIFO_SIZE));\n\n\tif (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_G12A)) {\n\t\tu32 val = (u32)VIU_OSD_BLEND_REORDER(0, 1) |\n\t\t\t  (u32)VIU_OSD_BLEND_REORDER(1, 0) |\n\t\t\t  (u32)VIU_OSD_BLEND_REORDER(2, 0) |\n\t\t\t  (u32)VIU_OSD_BLEND_REORDER(3, 0) |\n\t\t\t  (u32)VIU_OSD_BLEND_DIN_EN(1) |\n\t\t\t  (u32)VIU_OSD_BLEND1_DIN3_BYPASS_TO_DOUT1 |\n\t\t\t  (u32)VIU_OSD_BLEND1_DOUT_BYPASS_TO_BLEND2 |\n\t\t\t  (u32)VIU_OSD_BLEND_DIN0_BYPASS_TO_DOUT0 |\n\t\t\t  (u32)VIU_OSD_BLEND_BLEN2_PREMULT_EN(1) |\n\t\t\t  (u32)VIU_OSD_BLEND_HOLD_LINES(4);\n\t\twritel_relaxed(val, priv->io_base + _REG(VIU_OSD_BLEND_CTRL));\n\n\t\twritel_relaxed(OSD_BLEND_PATH_SEL_ENABLE,\n\t\t\t       priv->io_base + _REG(OSD1_BLEND_SRC_CTRL));\n\t\twritel_relaxed(OSD_BLEND_PATH_SEL_ENABLE,\n\t\t\t       priv->io_base + _REG(OSD2_BLEND_SRC_CTRL));\n\t\twritel_relaxed(0, priv->io_base + _REG(VD1_BLEND_SRC_CTRL));\n\t\twritel_relaxed(0, priv->io_base + _REG(VD2_BLEND_SRC_CTRL));\n\t\twritel_relaxed(0,\n\t\t\t\tpriv->io_base + _REG(VIU_OSD_BLEND_DUMMY_DATA0));\n\t\twritel_relaxed(0,\n\t\t\t\tpriv->io_base + _REG(VIU_OSD_BLEND_DUMMY_ALPHA));\n\n\t\twritel_bits_relaxed(DOLBY_BYPASS_EN(0xc), DOLBY_BYPASS_EN(0xc),\n\t\t\t\t    priv->io_base + _REG(DOLBY_PATH_CTRL));\n\n\t\tmeson_viu_g12a_disable_osd1_afbc(priv);\n\t}\n\n\tif (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_GXM))\n\t\tmeson_viu_gxm_disable_osd1_afbc(priv);\n\n\tpriv->viu.osd1_enabled = false;\n\tpriv->viu.osd1_commit = false;\n\tpriv->viu.osd1_interlace = false;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}