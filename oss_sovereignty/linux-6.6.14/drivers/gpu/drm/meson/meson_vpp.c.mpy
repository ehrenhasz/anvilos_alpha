{
  "module_name": "meson_vpp.c",
  "hash_id": "919b64713ba169534b4d56015303bd2af05f4c7328f8efb390a5ae21b3d7f1f7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/meson/meson_vpp.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n\n#include \"meson_drv.h\"\n#include \"meson_registers.h\"\n#include \"meson_vpp.h\"\n\n \n\nvoid meson_vpp_setup_mux(struct meson_drm *priv, unsigned int mux)\n{\n\twritel(mux, priv->io_base + _REG(VPU_VIU_VENC_MUX_CTRL));\n}\n\nstatic unsigned int vpp_filter_coefs_4point_bspline[] = {\n\t0x15561500, 0x14561600, 0x13561700, 0x12561800,\n\t0x11551a00, 0x11541b00, 0x10541c00, 0x0f541d00,\n\t0x0f531e00, 0x0e531f00, 0x0d522100, 0x0c522200,\n\t0x0b522300, 0x0b512400, 0x0a502600, 0x0a4f2700,\n\t0x094e2900, 0x084e2a00, 0x084d2b00, 0x074c2c01,\n\t0x074b2d01, 0x064a2f01, 0x06493001, 0x05483201,\n\t0x05473301, 0x05463401, 0x04453601, 0x04433702,\n\t0x04423802, 0x03413a02, 0x03403b02, 0x033f3c02,\n\t0x033d3d03\n};\n\nstatic void meson_vpp_write_scaling_filter_coefs(struct meson_drm *priv,\n\t\t\t\t\t\t const unsigned int *coefs,\n\t\t\t\t\t\t bool is_horizontal)\n{\n\tint i;\n\n\twritel_relaxed(is_horizontal ? VPP_SCALE_HORIZONTAL_COEF : 0,\n\t\t\tpriv->io_base + _REG(VPP_OSD_SCALE_COEF_IDX));\n\tfor (i = 0; i < 33; i++)\n\t\twritel_relaxed(coefs[i],\n\t\t\t\tpriv->io_base + _REG(VPP_OSD_SCALE_COEF));\n}\n\nstatic const uint32_t vpp_filter_coefs_bicubic[] = {\n\t0x00800000, 0x007f0100, 0xff7f0200, 0xfe7f0300,\n\t0xfd7e0500, 0xfc7e0600, 0xfb7d0800, 0xfb7c0900,\n\t0xfa7b0b00, 0xfa7a0dff, 0xf9790fff, 0xf97711ff,\n\t0xf87613ff, 0xf87416fe, 0xf87218fe, 0xf8701afe,\n\t0xf76f1dfd, 0xf76d1ffd, 0xf76b21fd, 0xf76824fd,\n\t0xf76627fc, 0xf76429fc, 0xf7612cfc, 0xf75f2ffb,\n\t0xf75d31fb, 0xf75a34fb, 0xf75837fa, 0xf7553afa,\n\t0xf8523cfa, 0xf8503ff9, 0xf84d42f9, 0xf84a45f9,\n\t0xf84848f8\n};\n\nstatic void meson_vpp_write_vd_scaling_filter_coefs(struct meson_drm *priv,\n\t\t\t\t\t\t    const unsigned int *coefs,\n\t\t\t\t\t\t    bool is_horizontal)\n{\n\tint i;\n\n\twritel_relaxed(is_horizontal ? VPP_SCALE_HORIZONTAL_COEF : 0,\n\t\t\tpriv->io_base + _REG(VPP_SCALE_COEF_IDX));\n\tfor (i = 0; i < 33; i++)\n\t\twritel_relaxed(coefs[i],\n\t\t\t\tpriv->io_base + _REG(VPP_SCALE_COEF));\n}\n\nvoid meson_vpp_init(struct meson_drm *priv)\n{\n\t \n\tif (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_GXL))\n\t\twritel_relaxed(0x108080, priv->io_base + _REG(VPP_DUMMY_DATA1));\n\telse if (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_GXM)) {\n\t\twritel_bits_relaxed(0xff << 16, 0xff << 16,\n\t\t\t\t    priv->io_base + _REG(VIU_MISC_CTRL1));\n\t\twritel_relaxed(VPP_PPS_DUMMY_DATA_MODE,\n\t\t\t       priv->io_base + _REG(VPP_DOLBY_CTRL));\n\t\twritel_relaxed(0x1020080,\n\t\t\t\tpriv->io_base + _REG(VPP_DUMMY_DATA1));\n\t\twritel_relaxed(0x42020,\n\t\t\t\tpriv->io_base + _REG(VPP_DUMMY_DATA));\n\t} else if (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_G12A))\n\t\twritel_relaxed(0xf, priv->io_base + _REG(DOLBY_PATH_CTRL));\n\n\t \n\tif (meson_vpu_is_compatible(priv, VPU_COMPATIBLE_G12A))\n\t\twritel_relaxed(VPP_OFIFO_SIZE_DEFAULT,\n\t\t\t       priv->io_base + _REG(VPP_OFIFO_SIZE));\n\telse\n\t\twritel_bits_relaxed(VPP_OFIFO_SIZE_MASK, 0x77f,\n\t\t\t\t    priv->io_base + _REG(VPP_OFIFO_SIZE));\n\twritel_relaxed(VPP_POSTBLEND_HOLD_LINES(4) | VPP_PREBLEND_HOLD_LINES(4),\n\t\t       priv->io_base + _REG(VPP_HOLD_LINES));\n\n\tif (!meson_vpu_is_compatible(priv, VPU_COMPATIBLE_G12A)) {\n\t\t \n\t\twritel_bits_relaxed(VPP_PREBLEND_ENABLE, 0,\n\t\t\t\t    priv->io_base + _REG(VPP_MISC));\n\n\t\t \n\t\twritel_bits_relaxed(VPP_POSTBLEND_ENABLE, 0,\n\t\t\t\t    priv->io_base + _REG(VPP_MISC));\n\n\t\t \n\t\twritel_bits_relaxed(VPP_OSD1_POSTBLEND | VPP_OSD2_POSTBLEND |\n\t\t\t\t    VPP_VD1_POSTBLEND | VPP_VD2_POSTBLEND |\n\t\t\t\t    VPP_VD1_PREBLEND | VPP_VD2_PREBLEND, 0,\n\t\t\t\t    priv->io_base + _REG(VPP_MISC));\n\n\t\t \n\t\twritel_relaxed(4096,\n\t\t\t\tpriv->io_base + _REG(VPP_PREBLEND_VD1_H_START_END));\n\t\twritel_relaxed(4096,\n\t\t\t\tpriv->io_base + _REG(VPP_BLEND_VD2_H_START_END));\n\t}\n\n\t \n\twritel_relaxed(0, priv->io_base + _REG(VPP_OSD_SC_CTRL0));\n\twritel_relaxed(0, priv->io_base + _REG(VPP_OSD_VSC_CTRL0));\n\twritel_relaxed(0, priv->io_base + _REG(VPP_OSD_HSC_CTRL0));\n\n\t \n\twritel_relaxed(VPP_VSC_BANK_LENGTH(4) | VPP_HSC_BANK_LENGTH(4) |\n\t\t       VPP_SC_VD_EN_ENABLE,\n\t\t       priv->io_base + _REG(VPP_SC_MISC));\n\n\t \n\twritel_relaxed(VPP_MINUS_BLACK_LVL_VADJ1_ENABLE,\n\t\t       priv->io_base + _REG(VPP_VADJ_CTRL));\n\n\t \n\tmeson_vpp_write_scaling_filter_coefs(priv,\n\t\t\t\tvpp_filter_coefs_4point_bspline, false);\n\tmeson_vpp_write_scaling_filter_coefs(priv,\n\t\t\t\tvpp_filter_coefs_4point_bspline, true);\n\n\t \n\tmeson_vpp_write_vd_scaling_filter_coefs(priv, vpp_filter_coefs_bicubic,\n\t\t\t\t\t\tfalse);\n\tmeson_vpp_write_vd_scaling_filter_coefs(priv, vpp_filter_coefs_bicubic,\n\t\t\t\t\t\ttrue);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}