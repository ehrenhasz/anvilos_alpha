{
  "module_name": "vmwgfx_kms.h",
  "hash_id": "805a44ed5fd2ed42285be68622b17ea340be293a220a144683fbe5c1aceffb8b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/vmwgfx/vmwgfx_kms.h",
  "human_readable_source": " \n \n\n#ifndef VMWGFX_KMS_H_\n#define VMWGFX_KMS_H_\n\n#include <drm/drm_encoder.h>\n#include <drm/drm_framebuffer.h>\n#include <drm/drm_probe_helper.h>\n\n#include \"vmwgfx_drv.h\"\n\n \nstruct vmw_du_update_plane {\n\t \n\tuint32_t (*calc_fifo_size)(struct vmw_du_update_plane *update,\n\t\t\t\t   uint32_t num_hits);\n\n\t \n\tuint32_t (*post_prepare)(struct vmw_du_update_plane *update, void *cmd);\n\n\t \n\tuint32_t (*pre_clip)(struct vmw_du_update_plane *update, void *cmd,\n\t\t\t     uint32_t num_hits);\n\n\t \n\tuint32_t (*clip)(struct vmw_du_update_plane *update, void *cmd,\n\t\t\t struct drm_rect *clip, uint32_t src_x, uint32_t src_y);\n\n\t \n\tuint32_t (*post_clip)(struct vmw_du_update_plane *update, void *cmd,\n\t\t\t\t    struct drm_rect *bb);\n\n\tstruct drm_plane *plane;\n\tstruct drm_plane_state *old_state;\n\tstruct vmw_private *dev_priv;\n\tstruct vmw_display_unit *du;\n\tstruct vmw_framebuffer *vfb;\n\tstruct vmw_fence_obj **out_fence;\n\tstruct mutex *mutex;\n\tbool intr;\n};\n\n \nstruct vmw_du_update_plane_surface {\n\tstruct vmw_du_update_plane base;\n\t \n\tvoid *cmd_start;\n};\n\n \nstruct vmw_du_update_plane_buffer {\n\tstruct vmw_du_update_plane base;\n\tint fb_left, fb_top;\n};\n\n \nstruct vmw_kms_dirty {\n\tvoid (*fifo_commit)(struct vmw_kms_dirty *);\n\tvoid (*clip)(struct vmw_kms_dirty *);\n\tsize_t fifo_reserve_size;\n\tstruct vmw_private *dev_priv;\n\tstruct vmw_display_unit *unit;\n\tvoid *cmd;\n\tstruct drm_crtc *crtc;\n\tu32 num_hits;\n\ts32 fb_x;\n\ts32 fb_y;\n\ts32 unit_x1;\n\ts32 unit_y1;\n\ts32 unit_x2;\n\ts32 unit_y2;\n};\n\n#define VMWGFX_NUM_DISPLAY_UNITS 8\n\n\n#define vmw_framebuffer_to_vfb(x) \\\n\tcontainer_of(x, struct vmw_framebuffer, base)\n#define vmw_framebuffer_to_vfbs(x) \\\n\tcontainer_of(x, struct vmw_framebuffer_surface, base.base)\n#define vmw_framebuffer_to_vfbd(x) \\\n\tcontainer_of(x, struct vmw_framebuffer_bo, base.base)\n\n \nstruct vmw_framebuffer {\n\tstruct drm_framebuffer base;\n\tbool bo;\n\tuint32_t user_handle;\n};\n\n \nstruct vmw_clip_rect {\n\tint x1, x2, y1, y2;\n};\n\nstruct vmw_framebuffer_surface {\n\tstruct vmw_framebuffer base;\n\tstruct vmw_surface *surface;\n\tstruct vmw_bo *buffer;\n\tstruct list_head head;\n\tbool is_bo_proxy;   \n};\n\n\nstruct vmw_framebuffer_bo {\n\tstruct vmw_framebuffer base;\n\tstruct vmw_bo *buffer;\n};\n\n\nstatic const uint32_t __maybe_unused vmw_primary_plane_formats[] = {\n\tDRM_FORMAT_XRGB1555,\n\tDRM_FORMAT_RGB565,\n\tDRM_FORMAT_XRGB8888,\n\tDRM_FORMAT_ARGB8888,\n};\n\nstatic const uint32_t __maybe_unused vmw_cursor_plane_formats[] = {\n\tDRM_FORMAT_ARGB8888,\n};\n\n\n#define vmw_crtc_state_to_vcs(x) container_of(x, struct vmw_crtc_state, base)\n#define vmw_plane_state_to_vps(x) container_of(x, struct vmw_plane_state, base)\n#define vmw_connector_state_to_vcs(x) \\\n\t\tcontainer_of(x, struct vmw_connector_state, base)\n#define vmw_plane_to_vcp(x) container_of(x, struct vmw_cursor_plane, base)\n\n \nstruct vmw_crtc_state {\n\tstruct drm_crtc_state base;\n};\n\nstruct vmw_cursor_plane_state {\n\tstruct vmw_bo *bo;\n\ts32 hotspot_x;\n\ts32 hotspot_y;\n};\n\n \nstruct vmw_plane_state {\n\tstruct drm_plane_state base;\n\tstruct vmw_surface *surf;\n\tstruct vmw_bo *bo;\n\n\tint content_fb_type;\n\tunsigned long bo_size;\n\n\tint pinned;\n\n\t \n\tunsigned int cpp;\n\n\tbool surf_mapped;\n\tstruct vmw_cursor_plane_state cursor;\n};\n\n\n \nstruct vmw_connector_state {\n\tstruct drm_connector_state base;\n\n\t \n\tint gui_x;\n\n\t \n\tint gui_y;\n};\n\n \nstruct vmw_cursor_plane {\n\tstruct drm_plane base;\n\n\tstruct vmw_bo *cursor_mobs[3];\n};\n\n \nstruct vmw_display_unit {\n\tstruct drm_crtc crtc;\n\tstruct drm_encoder encoder;\n\tstruct drm_connector connector;\n\tstruct drm_plane primary;\n\tstruct vmw_cursor_plane cursor;\n\n\tstruct vmw_surface *cursor_surface;\n\tstruct vmw_bo *cursor_bo;\n\tsize_t cursor_age;\n\n\tint cursor_x;\n\tint cursor_y;\n\n\tint hotspot_x;\n\tint hotspot_y;\n\ts32 core_hotspot_x;\n\ts32 core_hotspot_y;\n\n\tunsigned unit;\n\n\t \n\tunsigned pref_width;\n\tunsigned pref_height;\n\tbool pref_active;\n\tstruct drm_display_mode *pref_mode;\n\n\t \n\tint gui_x;\n\tint gui_y;\n\tbool is_implicit;\n\tint set_gui_x;\n\tint set_gui_y;\n};\n\nstruct vmw_validation_ctx {\n\tstruct vmw_resource *res;\n\tstruct vmw_bo *buf;\n};\n\n#define vmw_crtc_to_du(x) \\\n\tcontainer_of(x, struct vmw_display_unit, crtc)\n#define vmw_connector_to_du(x) \\\n\tcontainer_of(x, struct vmw_display_unit, connector)\n\n\n \nvoid vmw_du_cleanup(struct vmw_display_unit *du);\nvoid vmw_du_crtc_save(struct drm_crtc *crtc);\nvoid vmw_du_crtc_restore(struct drm_crtc *crtc);\nint vmw_du_crtc_gamma_set(struct drm_crtc *crtc,\n\t\t\t   u16 *r, u16 *g, u16 *b,\n\t\t\t   uint32_t size,\n\t\t\t   struct drm_modeset_acquire_ctx *ctx);\nint vmw_du_connector_set_property(struct drm_connector *connector,\n\t\t\t\t  struct drm_property *property,\n\t\t\t\t  uint64_t val);\nint vmw_du_connector_atomic_set_property(struct drm_connector *connector,\n\t\t\t\t\t struct drm_connector_state *state,\n\t\t\t\t\t struct drm_property *property,\n\t\t\t\t\t uint64_t val);\nint\nvmw_du_connector_atomic_get_property(struct drm_connector *connector,\n\t\t\t\t     const struct drm_connector_state *state,\n\t\t\t\t     struct drm_property *property,\n\t\t\t\t     uint64_t *val);\nint vmw_du_connector_dpms(struct drm_connector *connector, int mode);\nvoid vmw_du_connector_save(struct drm_connector *connector);\nvoid vmw_du_connector_restore(struct drm_connector *connector);\nenum drm_connector_status\nvmw_du_connector_detect(struct drm_connector *connector, bool force);\nint vmw_du_connector_fill_modes(struct drm_connector *connector,\n\t\t\t\tuint32_t max_width, uint32_t max_height);\nint vmw_kms_helper_dirty(struct vmw_private *dev_priv,\n\t\t\t struct vmw_framebuffer *framebuffer,\n\t\t\t const struct drm_clip_rect *clips,\n\t\t\t const struct drm_vmw_rect *vclips,\n\t\t\t s32 dest_x, s32 dest_y,\n\t\t\t int num_clips,\n\t\t\t int increment,\n\t\t\t struct vmw_kms_dirty *dirty);\n\nvoid vmw_kms_helper_validation_finish(struct vmw_private *dev_priv,\n\t\t\t\t      struct drm_file *file_priv,\n\t\t\t\t      struct vmw_validation_context *ctx,\n\t\t\t\t      struct vmw_fence_obj **out_fence,\n\t\t\t\t      struct drm_vmw_fence_rep __user *\n\t\t\t\t      user_fence_rep);\nint vmw_kms_readback(struct vmw_private *dev_priv,\n\t\t     struct drm_file *file_priv,\n\t\t     struct vmw_framebuffer *vfb,\n\t\t     struct drm_vmw_fence_rep __user *user_fence_rep,\n\t\t     struct drm_vmw_rect *vclips,\n\t\t     uint32_t num_clips);\nstruct vmw_framebuffer *\nvmw_kms_new_framebuffer(struct vmw_private *dev_priv,\n\t\t\tstruct vmw_bo *bo,\n\t\t\tstruct vmw_surface *surface,\n\t\t\tbool only_2d,\n\t\t\tconst struct drm_mode_fb_cmd2 *mode_cmd);\nvoid vmw_guess_mode_timing(struct drm_display_mode *mode);\nvoid vmw_kms_update_implicit_fb(struct vmw_private *dev_priv);\nvoid vmw_kms_create_implicit_placement_property(struct vmw_private *dev_priv);\n\n \nvoid vmw_du_primary_plane_destroy(struct drm_plane *plane);\nvoid vmw_du_cursor_plane_destroy(struct drm_plane *plane);\n\n \nint vmw_du_primary_plane_atomic_check(struct drm_plane *plane,\n\t\t\t\t      struct drm_atomic_state *state);\nint vmw_du_cursor_plane_atomic_check(struct drm_plane *plane,\n\t\t\t\t     struct drm_atomic_state *state);\nvoid vmw_du_cursor_plane_atomic_update(struct drm_plane *plane,\n\t\t\t\t       struct drm_atomic_state *state);\nint vmw_du_cursor_plane_prepare_fb(struct drm_plane *plane,\n\t\t\t\t   struct drm_plane_state *new_state);\nvoid vmw_du_cursor_plane_cleanup_fb(struct drm_plane *plane,\n\t\t\t     struct drm_plane_state *old_state);\nvoid vmw_du_plane_cleanup_fb(struct drm_plane *plane,\n\t\t\t     struct drm_plane_state *old_state);\nvoid vmw_du_plane_reset(struct drm_plane *plane);\nstruct drm_plane_state *vmw_du_plane_duplicate_state(struct drm_plane *plane);\nvoid vmw_du_plane_destroy_state(struct drm_plane *plane,\n\t\t\t\tstruct drm_plane_state *state);\nvoid vmw_du_plane_unpin_surf(struct vmw_plane_state *vps,\n\t\t\t     bool unreference);\n\nint vmw_du_crtc_atomic_check(struct drm_crtc *crtc,\n\t\t\t     struct drm_atomic_state *state);\nvoid vmw_du_crtc_atomic_begin(struct drm_crtc *crtc,\n\t\t\t      struct drm_atomic_state *state);\nvoid vmw_du_crtc_atomic_flush(struct drm_crtc *crtc,\n\t\t\t      struct drm_atomic_state *state);\nvoid vmw_du_crtc_reset(struct drm_crtc *crtc);\nstruct drm_crtc_state *vmw_du_crtc_duplicate_state(struct drm_crtc *crtc);\nvoid vmw_du_crtc_destroy_state(struct drm_crtc *crtc,\n\t\t\t\tstruct drm_crtc_state *state);\nvoid vmw_du_connector_reset(struct drm_connector *connector);\nstruct drm_connector_state *\nvmw_du_connector_duplicate_state(struct drm_connector *connector);\n\nvoid vmw_du_connector_destroy_state(struct drm_connector *connector,\n\t\t\t\t    struct drm_connector_state *state);\n\n \nint vmw_kms_ldu_init_display(struct vmw_private *dev_priv);\nint vmw_kms_ldu_close_display(struct vmw_private *dev_priv);\nint vmw_kms_update_proxy(struct vmw_resource *res,\n\t\t\t const struct drm_clip_rect *clips,\n\t\t\t unsigned num_clips,\n\t\t\t int increment);\n\n \nint vmw_kms_sou_init_display(struct vmw_private *dev_priv);\nint vmw_kms_sou_do_surface_dirty(struct vmw_private *dev_priv,\n\t\t\t\t struct vmw_framebuffer *framebuffer,\n\t\t\t\t struct drm_clip_rect *clips,\n\t\t\t\t struct drm_vmw_rect *vclips,\n\t\t\t\t struct vmw_resource *srf,\n\t\t\t\t s32 dest_x,\n\t\t\t\t s32 dest_y,\n\t\t\t\t unsigned num_clips, int inc,\n\t\t\t\t struct vmw_fence_obj **out_fence,\n\t\t\t\t struct drm_crtc *crtc);\nint vmw_kms_sou_do_bo_dirty(struct vmw_private *dev_priv,\n\t\t\t    struct vmw_framebuffer *framebuffer,\n\t\t\t    struct drm_clip_rect *clips,\n\t\t\t    struct drm_vmw_rect *vclips,\n\t\t\t    unsigned int num_clips, int increment,\n\t\t\t    bool interruptible,\n\t\t\t    struct vmw_fence_obj **out_fence,\n\t\t\t    struct drm_crtc *crtc);\nint vmw_kms_sou_readback(struct vmw_private *dev_priv,\n\t\t\t struct drm_file *file_priv,\n\t\t\t struct vmw_framebuffer *vfb,\n\t\t\t struct drm_vmw_fence_rep __user *user_fence_rep,\n\t\t\t struct drm_vmw_rect *vclips,\n\t\t\t uint32_t num_clips,\n\t\t\t struct drm_crtc *crtc);\n\n \nint vmw_kms_stdu_init_display(struct vmw_private *dev_priv);\nint vmw_kms_stdu_surface_dirty(struct vmw_private *dev_priv,\n\t\t\t       struct vmw_framebuffer *framebuffer,\n\t\t\t       struct drm_clip_rect *clips,\n\t\t\t       struct drm_vmw_rect *vclips,\n\t\t\t       struct vmw_resource *srf,\n\t\t\t       s32 dest_x,\n\t\t\t       s32 dest_y,\n\t\t\t       unsigned num_clips, int inc,\n\t\t\t       struct vmw_fence_obj **out_fence,\n\t\t\t       struct drm_crtc *crtc);\nint vmw_kms_stdu_readback(struct vmw_private *dev_priv,\n\t\t\t  struct drm_file *file_priv,\n\t\t\t  struct vmw_framebuffer *vfb,\n\t\t\t  struct drm_vmw_fence_rep __user *user_fence_rep,\n\t\t\t  struct drm_clip_rect *clips,\n\t\t\t  struct drm_vmw_rect *vclips,\n\t\t\t  uint32_t num_clips,\n\t\t\t  int increment,\n\t\t\t  struct drm_crtc *crtc);\n\nint vmw_du_helper_plane_update(struct vmw_du_update_plane *update);\n\n \nstatic inline void vmw_du_translate_to_crtc(struct drm_plane_state *state,\n\t\t\t\t\t    struct drm_rect *r)\n{\n\tint translate_crtc_x = -((state->src_x >> 16) - state->crtc_x);\n\tint translate_crtc_y = -((state->src_y >> 16) - state->crtc_y);\n\n\tdrm_rect_translate(r, translate_crtc_x, translate_crtc_y);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}