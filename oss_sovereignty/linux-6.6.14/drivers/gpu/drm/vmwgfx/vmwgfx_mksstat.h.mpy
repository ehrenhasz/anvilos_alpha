{
  "module_name": "vmwgfx_mksstat.h",
  "hash_id": "6d34c2d05b916cebbfd4ddd3219466a318ddf1d5e8dc664ec5bc79c21ca07e36",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/vmwgfx/vmwgfx_mksstat.h",
  "human_readable_source": " \n \n\n#ifndef _VMWGFX_MKSSTAT_H_\n#define _VMWGFX_MKSSTAT_H_\n\n#include <asm/page.h>\n#include <linux/kconfig.h>\n\n \n#define MKSSTAT_PID_RESERVED -1\n\n#if IS_ENABLED(CONFIG_DRM_VMWGFX_MKSSTATS)\n \n\ntypedef enum {\n\tMKSSTAT_KERN_EXECBUF,  \n\tMKSSTAT_KERN_COTABLE_RESIZE,\n\n\tMKSSTAT_KERN_COUNT  \n} mksstat_kern_stats_t;\n\n \n\nstatic inline void *vmw_mksstat_get_kern_pstat(void *page_addr)\n{\n\treturn page_addr + PAGE_SIZE * 1;\n}\n\n \n\nstatic inline void *vmw_mksstat_get_kern_pinfo(void *page_addr)\n{\n\treturn page_addr + PAGE_SIZE * 2;\n}\n\n \n\nstatic inline void *vmw_mksstat_get_kern_pstrs(void *page_addr)\n{\n\treturn page_addr + PAGE_SIZE * 3;\n}\n\n \n\nstruct mksstat_timer_t {\n  mksstat_kern_stats_t old_top;\n\tconst u64 t0;\n\tconst int slot;\n};\n\n#define MKS_STAT_TIME_DECL(kern_cntr)                                     \\\n\tstruct mksstat_timer_t _##kern_cntr = {                           \\\n\t\t.t0 = rdtsc(),                                            \\\n\t\t.slot = vmw_mksstat_get_kern_slot(current->pid, dev_priv) \\\n\t}\n\n#define MKS_STAT_TIME_PUSH(kern_cntr)                                                               \\\n\tdo {                                                                                        \\\n\t\tif (_##kern_cntr.slot >= 0) {                                                       \\\n\t\t\t_##kern_cntr.old_top = dev_priv->mksstat_kern_top_timer[_##kern_cntr.slot]; \\\n\t\t\tdev_priv->mksstat_kern_top_timer[_##kern_cntr.slot] = kern_cntr;            \\\n\t\t}                                                                                   \\\n\t} while (0)\n\n#define MKS_STAT_TIME_POP(kern_cntr)                                                                                                           \\\n\tdo {                                                                                                                                   \\\n\t\tif (_##kern_cntr.slot >= 0) {                                                                                                  \\\n\t\t\tconst pid_t pid = atomic_cmpxchg(&dev_priv->mksstat_kern_pids[_##kern_cntr.slot], current->pid, MKSSTAT_PID_RESERVED); \\\n\t\t\tdev_priv->mksstat_kern_top_timer[_##kern_cntr.slot] = _##kern_cntr.old_top;                                            \\\n\t\t\t                                                                                                                       \\\n\t\t\tif (pid == current->pid) {                                                                                             \\\n\t\t\t\tconst u64 dt = rdtsc() - _##kern_cntr.t0;                                                                      \\\n\t\t\t\tMKSGuestStatCounterTime *pstat;                                                                                \\\n\t\t\t\t                                                                                                               \\\n\t\t\t\tBUG_ON(!dev_priv->mksstat_kern_pages[_##kern_cntr.slot]);                                                      \\\n\t\t\t\t                                                                                                               \\\n\t\t\t\tpstat = vmw_mksstat_get_kern_pstat(page_address(dev_priv->mksstat_kern_pages[_##kern_cntr.slot]));             \\\n\t\t\t\t                                                                                                               \\\n\t\t\t\tatomic64_inc(&pstat[kern_cntr].counter.count);                                                                 \\\n\t\t\t\tatomic64_add(dt, &pstat[kern_cntr].selfCycles);                                                                \\\n\t\t\t\tatomic64_add(dt, &pstat[kern_cntr].totalCycles);                                                               \\\n\t\t\t\t                                                                                                               \\\n\t\t\t\tif (_##kern_cntr.old_top != MKSSTAT_KERN_COUNT)                                                                \\\n\t\t\t\t\tatomic64_sub(dt, &pstat[_##kern_cntr.old_top].selfCycles);                                             \\\n\t\t\t\t\t                                                                                                       \\\n\t\t\t\tatomic_set(&dev_priv->mksstat_kern_pids[_##kern_cntr.slot], current->pid);                                     \\\n\t\t\t}                                                                                                                      \\\n\t\t}                                                                                                                              \\\n\t} while (0)\n\n#else\n#define MKS_STAT_TIME_DECL(kern_cntr)\n#define MKS_STAT_TIME_PUSH(kern_cntr)\n#define MKS_STAT_TIME_POP(kern_cntr)\n\n#endif  \n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}