{
  "module_name": "xen_drm_front_cfg.c",
  "hash_id": "c1b60ff763ac3312a93d7311e77d831d139bb5294db718a81c7bdfa9ea6fc94d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/xen/xen_drm_front_cfg.c",
  "human_readable_source": "\n\n \n\n#include <linux/device.h>\n\n#include <drm/drm_print.h>\n\n#include <xen/interface/io/displif.h>\n#include <xen/xenbus.h>\n\n#include \"xen_drm_front.h\"\n#include \"xen_drm_front_cfg.h\"\n\nstatic int cfg_connector(struct xen_drm_front_info *front_info,\n\t\t\t struct xen_drm_front_cfg_connector *connector,\n\t\t\t const char *path, int index)\n{\n\tchar *connector_path;\n\n\tconnector_path = devm_kasprintf(&front_info->xb_dev->dev,\n\t\t\t\t\tGFP_KERNEL, \"%s/%d\", path, index);\n\tif (!connector_path)\n\t\treturn -ENOMEM;\n\n\tif (xenbus_scanf(XBT_NIL, connector_path, XENDISPL_FIELD_RESOLUTION,\n\t\t\t \"%d\" XENDISPL_RESOLUTION_SEPARATOR \"%d\",\n\t\t\t &connector->width, &connector->height) < 0) {\n\t\t \n\t\tconnector->width = 0;\n\t\tconnector->height = 0;\n\t\treturn -EINVAL;\n\t}\n\n\tconnector->xenstore_path = connector_path;\n\n\tDRM_INFO(\"Connector %s: resolution %dx%d\\n\",\n\t\t connector_path, connector->width, connector->height);\n\treturn 0;\n}\n\nint xen_drm_front_cfg_card(struct xen_drm_front_info *front_info,\n\t\t\t   struct xen_drm_front_cfg *cfg)\n{\n\tstruct xenbus_device *xb_dev = front_info->xb_dev;\n\tint ret, i;\n\n\tif (xenbus_read_unsigned(front_info->xb_dev->nodename,\n\t\t\t\t XENDISPL_FIELD_BE_ALLOC, 0)) {\n\t\tDRM_INFO(\"Backend can provide display buffers\\n\");\n\t\tcfg->be_alloc = true;\n\t}\n\n\tcfg->num_connectors = 0;\n\tfor (i = 0; i < ARRAY_SIZE(cfg->connectors); i++) {\n\t\tret = cfg_connector(front_info, &cfg->connectors[i],\n\t\t\t\t    xb_dev->nodename, i);\n\t\tif (ret < 0)\n\t\t\tbreak;\n\t\tcfg->num_connectors++;\n\t}\n\n\tif (!cfg->num_connectors) {\n\t\tDRM_ERROR(\"No connector(s) configured at %s\\n\",\n\t\t\t  xb_dev->nodename);\n\t\treturn -ENODEV;\n\t}\n\n\treturn 0;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}