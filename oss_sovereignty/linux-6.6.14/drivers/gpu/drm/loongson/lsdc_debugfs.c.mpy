{
  "module_name": "lsdc_debugfs.c",
  "hash_id": "65353a2b6dd5d9b6540fed6f05d01558a90993d119e84dfa08523da28cf36479",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/loongson/lsdc_debugfs.c",
  "human_readable_source": "\n \n\n#include <drm/drm_debugfs.h>\n\n#include \"lsdc_benchmark.h\"\n#include \"lsdc_drv.h\"\n#include \"lsdc_gem.h\"\n#include \"lsdc_probe.h\"\n#include \"lsdc_ttm.h\"\n\n \n\nstatic int lsdc_identify(struct seq_file *m, void *arg)\n{\n\tstruct drm_info_node *node = (struct drm_info_node *)m->private;\n\tstruct lsdc_device *ldev = (struct lsdc_device *)node->info_ent->data;\n\tconst struct loongson_gfx_desc *gfx = to_loongson_gfx(ldev->descp);\n\tu8 impl, rev;\n\n\tloongson_cpu_get_prid(&impl, &rev);\n\n\tseq_printf(m, \"Running on cpu 0x%x, cpu revision: 0x%x\\n\",\n\t\t   impl, rev);\n\n\tseq_printf(m, \"Contained in: %s\\n\", gfx->model);\n\n\treturn 0;\n}\n\nstatic int lsdc_show_mm(struct seq_file *m, void *arg)\n{\n\tstruct drm_info_node *node = (struct drm_info_node *)m->private;\n\tstruct drm_device *ddev = node->minor->dev;\n\tstruct drm_printer p = drm_seq_file_printer(m);\n\n\tdrm_mm_print(&ddev->vma_offset_manager->vm_addr_space_mm, &p);\n\n\treturn 0;\n}\n\nstatic int lsdc_show_gfxpll_clock(struct seq_file *m, void *arg)\n{\n\tstruct drm_info_node *node = (struct drm_info_node *)m->private;\n\tstruct lsdc_device *ldev = (struct lsdc_device *)node->info_ent->data;\n\tstruct drm_printer printer = drm_seq_file_printer(m);\n\tstruct loongson_gfxpll *gfxpll = ldev->gfxpll;\n\n\tgfxpll->funcs->print(gfxpll, &printer, true);\n\n\treturn 0;\n}\n\nstatic int lsdc_show_benchmark(struct seq_file *m, void *arg)\n{\n\tstruct drm_info_node *node = (struct drm_info_node *)m->private;\n\tstruct lsdc_device *ldev = (struct lsdc_device *)node->info_ent->data;\n\tstruct drm_printer printer = drm_seq_file_printer(m);\n\n\tlsdc_show_benchmark_copy(ldev, &printer);\n\n\treturn 0;\n}\n\nstatic int lsdc_pdev_enable_io_mem(struct seq_file *m, void *arg)\n{\n\tstruct drm_info_node *node = (struct drm_info_node *)m->private;\n\tstruct lsdc_device *ldev = (struct lsdc_device *)node->info_ent->data;\n\tu16 cmd;\n\n\tpci_read_config_word(ldev->dc, PCI_COMMAND, &cmd);\n\n\tseq_printf(m, \"PCI_COMMAND: 0x%x\\n\", cmd);\n\n\tcmd |= PCI_COMMAND_MEMORY | PCI_COMMAND_IO;\n\n\tpci_write_config_word(ldev->dc, PCI_COMMAND, cmd);\n\n\tpci_read_config_word(ldev->dc, PCI_COMMAND, &cmd);\n\n\tseq_printf(m, \"PCI_COMMAND: 0x%x\\n\", cmd);\n\n\treturn 0;\n}\n\nstatic struct drm_info_list lsdc_debugfs_list[] = {\n\t{ \"benchmark\",   lsdc_show_benchmark, 0, NULL },\n\t{ \"bos\",         lsdc_show_buffer_object, 0, NULL },\n\t{ \"chips\",       lsdc_identify, 0, NULL },\n\t{ \"clocks\",      lsdc_show_gfxpll_clock, 0, NULL },\n\t{ \"dc_enable\",   lsdc_pdev_enable_io_mem, 0, NULL },\n\t{ \"mm\",          lsdc_show_mm, 0, NULL },\n};\n\nvoid lsdc_debugfs_init(struct drm_minor *minor)\n{\n\tstruct drm_device *ddev = minor->dev;\n\tstruct lsdc_device *ldev = to_lsdc(ddev);\n\tunsigned int n = ARRAY_SIZE(lsdc_debugfs_list);\n\tunsigned int i;\n\n\tfor (i = 0; i < n; ++i)\n\t\tlsdc_debugfs_list[i].data = ldev;\n\n\tdrm_debugfs_create_files(lsdc_debugfs_list, n, minor->debugfs_root, minor);\n\n\tlsdc_ttm_debugfs_init(ldev);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}