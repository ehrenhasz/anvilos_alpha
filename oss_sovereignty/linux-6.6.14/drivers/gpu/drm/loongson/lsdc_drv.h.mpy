{
  "module_name": "lsdc_drv.h",
  "hash_id": "19645a338828426c68f6a59e89cdd80433efa193b92a6ba92ee889fa39dca42d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/loongson/lsdc_drv.h",
  "human_readable_source": " \n \n\n#ifndef __LSDC_DRV_H__\n#define __LSDC_DRV_H__\n\n#include <linux/pci.h>\n\n#include <drm/drm_connector.h>\n#include <drm/drm_crtc.h>\n#include <drm/drm_device.h>\n#include <drm/drm_encoder.h>\n#include <drm/drm_file.h>\n#include <drm/drm_plane.h>\n#include <drm/ttm/ttm_device.h>\n\n#include \"lsdc_i2c.h\"\n#include \"lsdc_irq.h\"\n#include \"lsdc_gfxpll.h\"\n#include \"lsdc_output.h\"\n#include \"lsdc_pixpll.h\"\n#include \"lsdc_regs.h\"\n\n \n#define LSDC_NUM_CRTC           2\n\n \n\nenum loongson_chip_id {\n\tCHIP_LS7A1000 = 0,\n\tCHIP_LS7A2000 = 1,\n\tCHIP_LS_LAST,\n};\n\nconst struct lsdc_desc *\nlsdc_device_probe(struct pci_dev *pdev, enum loongson_chip_id chip);\n\nstruct lsdc_kms_funcs;\n\n \n\nstruct lsdc_desc {\n\tu32 num_of_crtc;\n\tu32 max_pixel_clk;\n\tu32 max_width;\n\tu32 max_height;\n\tu32 num_of_hw_cursor;\n\tu32 hw_cursor_w;\n\tu32 hw_cursor_h;\n\tu32 pitch_align;          \n\tbool has_vblank_counter;  \n\n\t \n\tconst struct lsdc_kms_funcs *funcs;\n};\n\n \n\nstruct loongson_gfx_desc {\n\tstruct lsdc_desc dc;\n\n\tu32 conf_reg_base;\n\n\t \n\tstruct {\n\t\tu32 reg_offset;\n\t\tu32 reg_size;\n\t} gfxpll;\n\n\t \n\tstruct {\n\t\tu32 reg_offset;\n\t\tu32 reg_size;\n\t} pixpll[LSDC_NUM_CRTC];\n\n\tenum loongson_chip_id chip_id;\n\tchar model[64];\n};\n\nstatic inline const struct loongson_gfx_desc *\nto_loongson_gfx(const struct lsdc_desc *dcp)\n{\n\treturn container_of_const(dcp, struct loongson_gfx_desc, dc);\n};\n\nstruct lsdc_reg32 {\n\tchar *name;\n\tu32 offset;\n};\n\n \n\nstruct lsdc_crtc;\n\nstruct lsdc_crtc_hw_ops {\n\tvoid (*enable)(struct lsdc_crtc *lcrtc);\n\tvoid (*disable)(struct lsdc_crtc *lcrtc);\n\tvoid (*enable_vblank)(struct lsdc_crtc *lcrtc);\n\tvoid (*disable_vblank)(struct lsdc_crtc *lcrtc);\n\tvoid (*flip)(struct lsdc_crtc *lcrtc);\n\tvoid (*clone)(struct lsdc_crtc *lcrtc);\n\tvoid (*get_scan_pos)(struct lsdc_crtc *lcrtc, int *hpos, int *vpos);\n\tvoid (*set_mode)(struct lsdc_crtc *lcrtc, const struct drm_display_mode *mode);\n\tvoid (*soft_reset)(struct lsdc_crtc *lcrtc);\n\tvoid (*reset)(struct lsdc_crtc *lcrtc);\n\n\tu32  (*get_vblank_counter)(struct lsdc_crtc *lcrtc);\n\tvoid (*set_dma_step)(struct lsdc_crtc *lcrtc, enum lsdc_dma_steps step);\n};\n\nstruct lsdc_crtc {\n\tstruct drm_crtc base;\n\tstruct lsdc_pixpll pixpll;\n\tstruct lsdc_device *ldev;\n\tconst struct lsdc_crtc_hw_ops *hw_ops;\n\tconst struct lsdc_reg32 *preg;\n\tunsigned int nreg;\n\tstruct drm_info_list *p_info_list;\n\tunsigned int n_info_list;\n\tbool has_vblank;\n};\n\n \n\nstruct lsdc_primary;\n\nstruct lsdc_primary_plane_ops {\n\tvoid (*update_fb_addr)(struct lsdc_primary *plane, u64 addr);\n\tvoid (*update_fb_stride)(struct lsdc_primary *plane, u32 stride);\n\tvoid (*update_fb_format)(struct lsdc_primary *plane,\n\t\t\t\t const struct drm_format_info *format);\n};\n\nstruct lsdc_primary {\n\tstruct drm_plane base;\n\tconst struct lsdc_primary_plane_ops *ops;\n\tstruct lsdc_device *ldev;\n};\n\n \n\nstruct lsdc_cursor;\n\nstruct lsdc_cursor_plane_ops {\n\tvoid (*update_bo_addr)(struct lsdc_cursor *plane, u64 addr);\n\tvoid (*update_cfg)(struct lsdc_cursor *plane,\n\t\t\t   enum lsdc_cursor_size cursor_size,\n\t\t\t   enum lsdc_cursor_format);\n\tvoid (*update_position)(struct lsdc_cursor *plane, int x, int y);\n};\n\nstruct lsdc_cursor {\n\tstruct drm_plane base;\n\tconst struct lsdc_cursor_plane_ops *ops;\n\tstruct lsdc_device *ldev;\n};\n\nstruct lsdc_output {\n\tstruct drm_encoder encoder;\n\tstruct drm_connector connector;\n};\n\nstatic inline struct lsdc_output *\nconnector_to_lsdc_output(struct drm_connector *connector)\n{\n\treturn container_of(connector, struct lsdc_output, connector);\n}\n\nstatic inline struct lsdc_output *\nencoder_to_lsdc_output(struct drm_encoder *encoder)\n{\n\treturn container_of(encoder, struct lsdc_output, encoder);\n}\n\nstruct lsdc_display_pipe {\n\tstruct lsdc_crtc crtc;\n\tstruct lsdc_primary primary;\n\tstruct lsdc_cursor cursor;\n\tstruct lsdc_output output;\n\tstruct lsdc_i2c *li2c;\n\tunsigned int index;\n};\n\nstatic inline struct lsdc_display_pipe *\noutput_to_display_pipe(struct lsdc_output *output)\n{\n\treturn container_of(output, struct lsdc_display_pipe, output);\n}\n\nstruct lsdc_kms_funcs {\n\tirqreturn_t (*irq_handler)(int irq, void *arg);\n\n\tint (*create_i2c)(struct drm_device *ddev,\n\t\t\t  struct lsdc_display_pipe *dispipe,\n\t\t\t  unsigned int index);\n\n\tint (*output_init)(struct drm_device *ddev,\n\t\t\t   struct lsdc_display_pipe *dispipe,\n\t\t\t   struct i2c_adapter *ddc,\n\t\t\t   unsigned int index);\n\n\tint (*cursor_plane_init)(struct drm_device *ddev,\n\t\t\t\t struct drm_plane *plane,\n\t\t\t\t unsigned int index);\n\n\tint (*primary_plane_init)(struct drm_device *ddev,\n\t\t\t\t  struct drm_plane *plane,\n\t\t\t\t  unsigned int index);\n\n\tint (*crtc_init)(struct drm_device *ddev,\n\t\t\t struct drm_crtc *crtc,\n\t\t\t struct drm_plane *primary,\n\t\t\t struct drm_plane *cursor,\n\t\t\t unsigned int index,\n\t\t\t bool has_vblank);\n};\n\nstatic inline struct lsdc_crtc *\nto_lsdc_crtc(struct drm_crtc *crtc)\n{\n\treturn container_of(crtc, struct lsdc_crtc, base);\n}\n\nstatic inline struct lsdc_display_pipe *\ncrtc_to_display_pipe(struct drm_crtc *crtc)\n{\n\treturn container_of(crtc, struct lsdc_display_pipe, crtc.base);\n}\n\nstatic inline struct lsdc_primary *\nto_lsdc_primary(struct drm_plane *plane)\n{\n\treturn container_of(plane, struct lsdc_primary, base);\n}\n\nstatic inline struct lsdc_cursor *\nto_lsdc_cursor(struct drm_plane *plane)\n{\n\treturn container_of(plane, struct lsdc_cursor, base);\n}\n\nstruct lsdc_crtc_state {\n\tstruct drm_crtc_state base;\n\tstruct lsdc_pixpll_parms pparms;\n};\n\nstruct lsdc_gem {\n\t \n\tstruct mutex mutex;\n\tstruct list_head objects;\n};\n\nstruct lsdc_device {\n\tstruct drm_device base;\n\tstruct ttm_device bdev;\n\n\t \n\tconst struct lsdc_desc *descp;\n\tstruct pci_dev *dc;\n\tstruct pci_dev *gpu;\n\n\tstruct loongson_gfxpll *gfxpll;\n\n\t \n\tspinlock_t reglock;\n\n\tvoid __iomem *reg_base;\n\tresource_size_t vram_base;\n\tresource_size_t vram_size;\n\n\tresource_size_t gtt_base;\n\tresource_size_t gtt_size;\n\n\tstruct lsdc_display_pipe dispipe[LSDC_NUM_CRTC];\n\n\tstruct lsdc_gem gem;\n\n\tu32 irq_status;\n\n\t \n\tsize_t vram_pinned_size;\n\tsize_t gtt_pinned_size;\n\n\t \n\tunsigned int num_output;\n};\n\nstatic inline struct lsdc_device *tdev_to_ldev(struct ttm_device *bdev)\n{\n\treturn container_of(bdev, struct lsdc_device, bdev);\n}\n\nstatic inline struct lsdc_device *to_lsdc(struct drm_device *ddev)\n{\n\treturn container_of(ddev, struct lsdc_device, base);\n}\n\nstatic inline struct lsdc_crtc_state *\nto_lsdc_crtc_state(struct drm_crtc_state *base)\n{\n\treturn container_of(base, struct lsdc_crtc_state, base);\n}\n\nvoid lsdc_debugfs_init(struct drm_minor *minor);\n\nint ls7a1000_crtc_init(struct drm_device *ddev,\n\t\t       struct drm_crtc *crtc,\n\t\t       struct drm_plane *primary,\n\t\t       struct drm_plane *cursor,\n\t\t       unsigned int index,\n\t\t       bool no_vblank);\n\nint ls7a2000_crtc_init(struct drm_device *ddev,\n\t\t       struct drm_crtc *crtc,\n\t\t       struct drm_plane *primary,\n\t\t       struct drm_plane *cursor,\n\t\t       unsigned int index,\n\t\t       bool no_vblank);\n\nint lsdc_primary_plane_init(struct drm_device *ddev,\n\t\t\t    struct drm_plane *plane,\n\t\t\t    unsigned int index);\n\nint ls7a1000_cursor_plane_init(struct drm_device *ddev,\n\t\t\t       struct drm_plane *plane,\n\t\t\t       unsigned int index);\n\nint ls7a2000_cursor_plane_init(struct drm_device *ddev,\n\t\t\t       struct drm_plane *plane,\n\t\t\t       unsigned int index);\n\n \n\nstatic inline u32 lsdc_rreg32(struct lsdc_device *ldev, u32 offset)\n{\n\treturn readl(ldev->reg_base + offset);\n}\n\nstatic inline void lsdc_wreg32(struct lsdc_device *ldev, u32 offset, u32 val)\n{\n\twritel(val, ldev->reg_base + offset);\n}\n\nstatic inline void lsdc_ureg32_set(struct lsdc_device *ldev,\n\t\t\t\t   u32 offset,\n\t\t\t\t   u32 mask)\n{\n\tvoid __iomem *addr = ldev->reg_base + offset;\n\tu32 val = readl(addr);\n\n\twritel(val | mask, addr);\n}\n\nstatic inline void lsdc_ureg32_clr(struct lsdc_device *ldev,\n\t\t\t\t   u32 offset,\n\t\t\t\t   u32 mask)\n{\n\tvoid __iomem *addr = ldev->reg_base + offset;\n\tu32 val = readl(addr);\n\n\twritel(val & ~mask, addr);\n}\n\nstatic inline u32 lsdc_pipe_rreg32(struct lsdc_device *ldev,\n\t\t\t\t   u32 offset, u32 pipe)\n{\n\treturn readl(ldev->reg_base + offset + pipe * CRTC_PIPE_OFFSET);\n}\n\nstatic inline void lsdc_pipe_wreg32(struct lsdc_device *ldev,\n\t\t\t\t    u32 offset, u32 pipe, u32 val)\n{\n\twritel(val, ldev->reg_base + offset + pipe * CRTC_PIPE_OFFSET);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}