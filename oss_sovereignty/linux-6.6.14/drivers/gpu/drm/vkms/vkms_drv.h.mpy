{
  "module_name": "vkms_drv.h",
  "hash_id": "99525f3cdf5a114b20d582770bf3db287915c1ad2f676c935857742fbec92474",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/vkms/vkms_drv.h",
  "human_readable_source": " \n\n#ifndef _VKMS_DRV_H_\n#define _VKMS_DRV_H_\n\n#include <linux/hrtimer.h>\n\n#include <drm/drm.h>\n#include <drm/drm_framebuffer.h>\n#include <drm/drm_gem.h>\n#include <drm/drm_gem_atomic_helper.h>\n#include <drm/drm_encoder.h>\n#include <drm/drm_writeback.h>\n\n#define XRES_MIN    10\n#define YRES_MIN    10\n\n#define XRES_DEF  1024\n#define YRES_DEF   768\n\n#define XRES_MAX  8192\n#define YRES_MAX  8192\n\n#define NUM_OVERLAY_PLANES 8\n\n#define VKMS_LUT_SIZE 256\n\nstruct vkms_frame_info {\n\tstruct drm_framebuffer *fb;\n\tstruct drm_rect src, dst;\n\tstruct drm_rect rotated;\n\tstruct iosys_map map[DRM_FORMAT_MAX_PLANES];\n\tunsigned int rotation;\n\tunsigned int offset;\n\tunsigned int pitch;\n\tunsigned int cpp;\n};\n\nstruct pixel_argb_u16 {\n\tu16 a, r, g, b;\n};\n\nstruct line_buffer {\n\tsize_t n_pixels;\n\tstruct pixel_argb_u16 *pixels;\n};\n\nstruct vkms_writeback_job {\n\tstruct iosys_map data[DRM_FORMAT_MAX_PLANES];\n\tstruct vkms_frame_info wb_frame_info;\n\tvoid (*pixel_write)(u8 *dst_pixels, struct pixel_argb_u16 *in_pixel);\n};\n\n \nstruct vkms_plane_state {\n\tstruct drm_shadow_plane_state base;\n\tstruct vkms_frame_info *frame_info;\n\tvoid (*pixel_read)(u8 *src_buffer, struct pixel_argb_u16 *out_pixel);\n};\n\nstruct vkms_plane {\n\tstruct drm_plane base;\n};\n\nstruct vkms_color_lut {\n\tstruct drm_color_lut *base;\n\tsize_t lut_length;\n\ts64 channel_value2index_ratio;\n};\n\n \nstruct vkms_crtc_state {\n\tstruct drm_crtc_state base;\n\tstruct work_struct composer_work;\n\n\tint num_active_planes;\n\t \n\tstruct vkms_plane_state **active_planes;\n\tstruct vkms_writeback_job *active_writeback;\n\tstruct vkms_color_lut gamma_lut;\n\n\t \n\tbool crc_pending;\n\tbool wb_pending;\n\tu64 frame_start;\n\tu64 frame_end;\n};\n\nstruct vkms_output {\n\tstruct drm_crtc crtc;\n\tstruct drm_encoder encoder;\n\tstruct drm_connector connector;\n\tstruct drm_writeback_connector wb_connector;\n\tstruct hrtimer vblank_hrtimer;\n\tktime_t period_ns;\n\tstruct drm_pending_vblank_event *event;\n\t \n\tstruct workqueue_struct *composer_workq;\n\t \n\tspinlock_t lock;\n\n\t \n\tbool composer_enabled;\n\tstruct vkms_crtc_state *composer_state;\n\n\tspinlock_t composer_lock;\n};\n\nstruct vkms_device;\n\nstruct vkms_config {\n\tbool writeback;\n\tbool cursor;\n\tbool overlay;\n\t \n\tstruct vkms_device *dev;\n};\n\nstruct vkms_device {\n\tstruct drm_device drm;\n\tstruct platform_device *platform;\n\tstruct vkms_output output;\n\tconst struct vkms_config *config;\n};\n\n#define drm_crtc_to_vkms_output(target) \\\n\tcontainer_of(target, struct vkms_output, crtc)\n\n#define drm_device_to_vkms_device(target) \\\n\tcontainer_of(target, struct vkms_device, drm)\n\n#define to_vkms_crtc_state(target)\\\n\tcontainer_of(target, struct vkms_crtc_state, base)\n\n#define to_vkms_plane_state(target)\\\n\tcontainer_of(target, struct vkms_plane_state, base.base)\n\n \nint vkms_crtc_init(struct drm_device *dev, struct drm_crtc *crtc,\n\t\t   struct drm_plane *primary, struct drm_plane *cursor);\n\nint vkms_output_init(struct vkms_device *vkmsdev, int index);\n\nstruct vkms_plane *vkms_plane_init(struct vkms_device *vkmsdev,\n\t\t\t\t   enum drm_plane_type type, int index);\n\n \nconst char *const *vkms_get_crc_sources(struct drm_crtc *crtc,\n\t\t\t\t\tsize_t *count);\nint vkms_set_crc_source(struct drm_crtc *crtc, const char *src_name);\nint vkms_verify_crc_source(struct drm_crtc *crtc, const char *source_name,\n\t\t\t   size_t *values_cnt);\n\n \nvoid vkms_composer_worker(struct work_struct *work);\nvoid vkms_set_composer(struct vkms_output *out, bool enabled);\nvoid vkms_compose_row(struct line_buffer *stage_buffer, struct vkms_plane_state *plane, int y);\nvoid vkms_writeback_row(struct vkms_writeback_job *wb, const struct line_buffer *src_buffer, int y);\n\n \nint vkms_enable_writeback_connector(struct vkms_device *vkmsdev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}