{
  "module_name": "rockchip_vop2_reg.c",
  "hash_id": "64d4e6f5bb2bc895d39bcb4b3959f0ba55887c4e9fb6f3abbd1c3b77cb4f2e3c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/rockchip/rockchip_vop2_reg.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/component.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n#include <linux/of.h>\n#include <drm/drm_fourcc.h>\n#include <drm/drm_plane.h>\n#include <drm/drm_print.h>\n\n#include \"rockchip_drm_vop2.h\"\n\nstatic const uint32_t formats_win_full_10bit[] = {\n\tDRM_FORMAT_XRGB8888,\n\tDRM_FORMAT_ARGB8888,\n\tDRM_FORMAT_XBGR8888,\n\tDRM_FORMAT_ABGR8888,\n\tDRM_FORMAT_RGB888,\n\tDRM_FORMAT_BGR888,\n\tDRM_FORMAT_RGB565,\n\tDRM_FORMAT_BGR565,\n\tDRM_FORMAT_NV12,\n\tDRM_FORMAT_NV16,\n\tDRM_FORMAT_NV24,\n};\n\nstatic const uint32_t formats_win_full_10bit_yuyv[] = {\n\tDRM_FORMAT_XRGB8888,\n\tDRM_FORMAT_ARGB8888,\n\tDRM_FORMAT_XBGR8888,\n\tDRM_FORMAT_ABGR8888,\n\tDRM_FORMAT_RGB888,\n\tDRM_FORMAT_BGR888,\n\tDRM_FORMAT_RGB565,\n\tDRM_FORMAT_BGR565,\n\tDRM_FORMAT_NV12,\n\tDRM_FORMAT_NV16,\n\tDRM_FORMAT_NV24,\n\tDRM_FORMAT_YVYU,\n\tDRM_FORMAT_VYUY,\n};\n\nstatic const uint32_t formats_win_lite[] = {\n\tDRM_FORMAT_XRGB8888,\n\tDRM_FORMAT_ARGB8888,\n\tDRM_FORMAT_XBGR8888,\n\tDRM_FORMAT_ABGR8888,\n\tDRM_FORMAT_RGB888,\n\tDRM_FORMAT_BGR888,\n\tDRM_FORMAT_RGB565,\n\tDRM_FORMAT_BGR565,\n};\n\nstatic const uint64_t format_modifiers[] = {\n\tDRM_FORMAT_MOD_LINEAR,\n\tDRM_FORMAT_MOD_INVALID,\n};\n\nstatic const uint64_t format_modifiers_afbc[] = {\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16),\n\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_SPARSE),\n\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_YTR),\n\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_CBR),\n\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_YTR |\n\t\t\t\tAFBC_FORMAT_MOD_SPARSE),\n\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_CBR |\n\t\t\t\tAFBC_FORMAT_MOD_SPARSE),\n\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_YTR |\n\t\t\t\tAFBC_FORMAT_MOD_CBR),\n\n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_YTR |\n\t\t\t\tAFBC_FORMAT_MOD_CBR |\n\t\t\t\tAFBC_FORMAT_MOD_SPARSE),\n\n\t \n\tDRM_FORMAT_MOD_ARM_AFBC(AFBC_FORMAT_MOD_BLOCK_SIZE_16x16 |\n\t\t\t\tAFBC_FORMAT_MOD_YTR |\n\t\t\t\tAFBC_FORMAT_MOD_SPARSE |\n\t\t\t\tAFBC_FORMAT_MOD_SPLIT),\n\tDRM_FORMAT_MOD_INVALID,\n};\n\nstatic const struct vop2_video_port_data rk3568_vop_video_ports[] = {\n\t{\n\t\t.id = 0,\n\t\t.feature = VOP_FEATURE_OUTPUT_10BIT,\n\t\t.gamma_lut_len = 1024,\n\t\t.cubic_lut_len = 9 * 9 * 9,\n\t\t.max_output = { 4096, 2304 },\n\t\t.pre_scan_max_dly = { 69, 53, 53, 42 },\n\t\t.offset = 0xc00,\n\t}, {\n\t\t.id = 1,\n\t\t.gamma_lut_len = 1024,\n\t\t.max_output = { 2048, 1536 },\n\t\t.pre_scan_max_dly = { 40, 40, 40, 40 },\n\t\t.offset = 0xd00,\n\t}, {\n\t\t.id = 2,\n\t\t.gamma_lut_len = 1024,\n\t\t.max_output = { 1920, 1080 },\n\t\t.pre_scan_max_dly = { 40, 40, 40, 40 },\n\t\t.offset = 0xe00,\n\t},\n};\n\n \nstatic const struct vop2_win_data rk3568_vop_win_data[] = {\n\t{\n\t\t.name = \"Smart0-win0\",\n\t\t.phys_id = ROCKCHIP_VOP2_SMART0,\n\t\t.base = 0x1c00,\n\t\t.formats = formats_win_lite,\n\t\t.nformats = ARRAY_SIZE(formats_win_lite),\n\t\t.format_modifiers = format_modifiers,\n\t\t.layer_sel_id = 3,\n\t\t.supported_rotations = DRM_MODE_REFLECT_Y,\n\t\t.type = DRM_PLANE_TYPE_PRIMARY,\n\t\t.max_upscale_factor = 8,\n\t\t.max_downscale_factor = 8,\n\t\t.dly = { 20, 47, 41 },\n\t}, {\n\t\t.name = \"Smart1-win0\",\n\t\t.phys_id = ROCKCHIP_VOP2_SMART1,\n\t\t.formats = formats_win_lite,\n\t\t.nformats = ARRAY_SIZE(formats_win_lite),\n\t\t.format_modifiers = format_modifiers,\n\t\t.base = 0x1e00,\n\t\t.layer_sel_id = 7,\n\t\t.supported_rotations = DRM_MODE_REFLECT_Y,\n\t\t.type = DRM_PLANE_TYPE_PRIMARY,\n\t\t.max_upscale_factor = 8,\n\t\t.max_downscale_factor = 8,\n\t\t.dly = { 20, 47, 41 },\n\t}, {\n\t\t.name = \"Esmart1-win0\",\n\t\t.phys_id = ROCKCHIP_VOP2_ESMART1,\n\t\t.formats = formats_win_full_10bit_yuyv,\n\t\t.nformats = ARRAY_SIZE(formats_win_full_10bit_yuyv),\n\t\t.format_modifiers = format_modifiers,\n\t\t.base = 0x1a00,\n\t\t.layer_sel_id = 6,\n\t\t.supported_rotations = DRM_MODE_REFLECT_Y,\n\t\t.type = DRM_PLANE_TYPE_PRIMARY,\n\t\t.max_upscale_factor = 8,\n\t\t.max_downscale_factor = 8,\n\t\t.dly = { 20, 47, 41 },\n\t}, {\n\t\t.name = \"Esmart0-win0\",\n\t\t.phys_id = ROCKCHIP_VOP2_ESMART0,\n\t\t.formats = formats_win_full_10bit_yuyv,\n\t\t.nformats = ARRAY_SIZE(formats_win_full_10bit_yuyv),\n\t\t.format_modifiers = format_modifiers,\n\t\t.base = 0x1800,\n\t\t.layer_sel_id = 2,\n\t\t.supported_rotations = DRM_MODE_REFLECT_Y,\n\t\t.type = DRM_PLANE_TYPE_PRIMARY,\n\t\t.max_upscale_factor = 8,\n\t\t.max_downscale_factor = 8,\n\t\t.dly = { 20, 47, 41 },\n\t}, {\n\t\t.name = \"Cluster0-win0\",\n\t\t.phys_id = ROCKCHIP_VOP2_CLUSTER0,\n\t\t.base = 0x1000,\n\t\t.formats = formats_win_full_10bit,\n\t\t.nformats = ARRAY_SIZE(formats_win_full_10bit),\n\t\t.format_modifiers = format_modifiers_afbc,\n\t\t.layer_sel_id = 0,\n\t\t.supported_rotations = DRM_MODE_ROTATE_90 | DRM_MODE_ROTATE_270 |\n\t\t\t\t\tDRM_MODE_REFLECT_X | DRM_MODE_REFLECT_Y,\n\t\t.max_upscale_factor = 4,\n\t\t.max_downscale_factor = 4,\n\t\t.dly = { 0, 27, 21 },\n\t\t.type = DRM_PLANE_TYPE_OVERLAY,\n\t\t.feature = WIN_FEATURE_AFBDC | WIN_FEATURE_CLUSTER,\n\t}, {\n\t\t.name = \"Cluster1-win0\",\n\t\t.phys_id = ROCKCHIP_VOP2_CLUSTER1,\n\t\t.base = 0x1200,\n\t\t.formats = formats_win_full_10bit,\n\t\t.nformats = ARRAY_SIZE(formats_win_full_10bit),\n\t\t.format_modifiers = format_modifiers_afbc,\n\t\t.layer_sel_id = 1,\n\t\t.supported_rotations = DRM_MODE_ROTATE_90 | DRM_MODE_ROTATE_270 |\n\t\t\t\t\tDRM_MODE_REFLECT_X | DRM_MODE_REFLECT_Y,\n\t\t.type = DRM_PLANE_TYPE_OVERLAY,\n\t\t.max_upscale_factor = 4,\n\t\t.max_downscale_factor = 4,\n\t\t.dly = { 0, 27, 21 },\n\t\t.feature = WIN_FEATURE_AFBDC | WIN_FEATURE_CLUSTER,\n\t},\n};\n\nstatic const struct vop2_data rk3566_vop = {\n\t.nr_vps = 3,\n\t.max_input = { 4096, 2304 },\n\t.max_output = { 4096, 2304 },\n\t.vp = rk3568_vop_video_ports,\n\t.win = rk3568_vop_win_data,\n\t.win_size = ARRAY_SIZE(rk3568_vop_win_data),\n\t.soc_id = 3566,\n};\n\nstatic const struct vop2_data rk3568_vop = {\n\t.nr_vps = 3,\n\t.max_input = { 4096, 2304 },\n\t.max_output = { 4096, 2304 },\n\t.vp = rk3568_vop_video_ports,\n\t.win = rk3568_vop_win_data,\n\t.win_size = ARRAY_SIZE(rk3568_vop_win_data),\n\t.soc_id = 3568,\n};\n\nstatic const struct of_device_id vop2_dt_match[] = {\n\t{\n\t\t.compatible = \"rockchip,rk3566-vop\",\n\t\t.data = &rk3566_vop,\n\t}, {\n\t\t.compatible = \"rockchip,rk3568-vop\",\n\t\t.data = &rk3568_vop,\n\t}, {\n\t},\n};\nMODULE_DEVICE_TABLE(of, vop2_dt_match);\n\nstatic int vop2_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\n\treturn component_add(dev, &vop2_component_ops);\n}\n\nstatic void vop2_remove(struct platform_device *pdev)\n{\n\tcomponent_del(&pdev->dev, &vop2_component_ops);\n}\n\nstruct platform_driver vop2_platform_driver = {\n\t.probe = vop2_probe,\n\t.remove_new = vop2_remove,\n\t.driver = {\n\t\t.name = \"rockchip-vop2\",\n\t\t.of_match_table = of_match_ptr(vop2_dt_match),\n\t},\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}