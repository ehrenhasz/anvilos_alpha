{
  "module_name": "atmel_hlcdc_dc.h",
  "hash_id": "fb556cd007dd61374ebb722ec6e9ac1f69d0031e5239dac873ca52eef1148e38",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/atmel-hlcdc/atmel_hlcdc_dc.h",
  "human_readable_source": " \n \n\n#ifndef DRM_ATMEL_HLCDC_H\n#define DRM_ATMEL_HLCDC_H\n\n#include <linux/regmap.h>\n\n#include <drm/drm_plane.h>\n\n#define ATMEL_HLCDC_LAYER_CHER\t\t\t0x0\n#define ATMEL_HLCDC_LAYER_CHDR\t\t\t0x4\n#define ATMEL_HLCDC_LAYER_CHSR\t\t\t0x8\n#define ATMEL_HLCDC_LAYER_EN\t\t\tBIT(0)\n#define ATMEL_HLCDC_LAYER_UPDATE\t\tBIT(1)\n#define ATMEL_HLCDC_LAYER_A2Q\t\t\tBIT(2)\n#define ATMEL_HLCDC_LAYER_RST\t\t\tBIT(8)\n\n#define ATMEL_HLCDC_LAYER_IER\t\t\t0xc\n#define ATMEL_HLCDC_LAYER_IDR\t\t\t0x10\n#define ATMEL_HLCDC_LAYER_IMR\t\t\t0x14\n#define ATMEL_HLCDC_LAYER_ISR\t\t\t0x18\n#define ATMEL_HLCDC_LAYER_DFETCH\t\tBIT(0)\n#define ATMEL_HLCDC_LAYER_LFETCH\t\tBIT(1)\n#define ATMEL_HLCDC_LAYER_DMA_IRQ(p)\t\tBIT(2 + (8 * (p)))\n#define ATMEL_HLCDC_LAYER_DSCR_IRQ(p)\t\tBIT(3 + (8 * (p)))\n#define ATMEL_HLCDC_LAYER_ADD_IRQ(p)\t\tBIT(4 + (8 * (p)))\n#define ATMEL_HLCDC_LAYER_DONE_IRQ(p)\t\tBIT(5 + (8 * (p)))\n#define ATMEL_HLCDC_LAYER_OVR_IRQ(p)\t\tBIT(6 + (8 * (p)))\n\n#define ATMEL_HLCDC_LAYER_PLANE_HEAD(p)\t\t(((p) * 0x10) + 0x1c)\n#define ATMEL_HLCDC_LAYER_PLANE_ADDR(p)\t\t(((p) * 0x10) + 0x20)\n#define ATMEL_HLCDC_LAYER_PLANE_CTRL(p)\t\t(((p) * 0x10) + 0x24)\n#define ATMEL_HLCDC_LAYER_PLANE_NEXT(p)\t\t(((p) * 0x10) + 0x28)\n\n#define ATMEL_HLCDC_LAYER_DMA_CFG\t\t0\n#define ATMEL_HLCDC_LAYER_DMA_SIF\t\tBIT(0)\n#define ATMEL_HLCDC_LAYER_DMA_BLEN_MASK\t\tGENMASK(5, 4)\n#define ATMEL_HLCDC_LAYER_DMA_BLEN_SINGLE\t(0 << 4)\n#define ATMEL_HLCDC_LAYER_DMA_BLEN_INCR4\t(1 << 4)\n#define ATMEL_HLCDC_LAYER_DMA_BLEN_INCR8\t(2 << 4)\n#define ATMEL_HLCDC_LAYER_DMA_BLEN_INCR16\t(3 << 4)\n#define ATMEL_HLCDC_LAYER_DMA_DLBO\t\tBIT(8)\n#define ATMEL_HLCDC_LAYER_DMA_ROTDIS\t\tBIT(12)\n#define ATMEL_HLCDC_LAYER_DMA_LOCKDIS\t\tBIT(13)\n\n#define ATMEL_HLCDC_LAYER_FORMAT_CFG\t\t1\n#define ATMEL_HLCDC_LAYER_RGB\t\t\t(0 << 0)\n#define ATMEL_HLCDC_LAYER_CLUT\t\t\t(1 << 0)\n#define ATMEL_HLCDC_LAYER_YUV\t\t\t(2 << 0)\n#define ATMEL_HLCDC_RGB_MODE(m)\t\t\t\\\n\t(ATMEL_HLCDC_LAYER_RGB | (((m) & 0xf) << 4))\n#define ATMEL_HLCDC_CLUT_MODE(m)\t\t\\\n\t(ATMEL_HLCDC_LAYER_CLUT | (((m) & 0x3) << 8))\n#define ATMEL_HLCDC_YUV_MODE(m)\t\t\t\\\n\t(ATMEL_HLCDC_LAYER_YUV | (((m) & 0xf) << 12))\n#define ATMEL_HLCDC_YUV422ROT\t\t\tBIT(16)\n#define ATMEL_HLCDC_YUV422SWP\t\t\tBIT(17)\n#define ATMEL_HLCDC_DSCALEOPT\t\t\tBIT(20)\n\n#define ATMEL_HLCDC_C1_MODE\t\t\tATMEL_HLCDC_CLUT_MODE(0)\n#define ATMEL_HLCDC_C2_MODE\t\t\tATMEL_HLCDC_CLUT_MODE(1)\n#define ATMEL_HLCDC_C4_MODE\t\t\tATMEL_HLCDC_CLUT_MODE(2)\n#define ATMEL_HLCDC_C8_MODE\t\t\tATMEL_HLCDC_CLUT_MODE(3)\n\n#define ATMEL_HLCDC_XRGB4444_MODE\t\tATMEL_HLCDC_RGB_MODE(0)\n#define ATMEL_HLCDC_ARGB4444_MODE\t\tATMEL_HLCDC_RGB_MODE(1)\n#define ATMEL_HLCDC_RGBA4444_MODE\t\tATMEL_HLCDC_RGB_MODE(2)\n#define ATMEL_HLCDC_RGB565_MODE\t\t\tATMEL_HLCDC_RGB_MODE(3)\n#define ATMEL_HLCDC_ARGB1555_MODE\t\tATMEL_HLCDC_RGB_MODE(4)\n#define ATMEL_HLCDC_XRGB8888_MODE\t\tATMEL_HLCDC_RGB_MODE(9)\n#define ATMEL_HLCDC_RGB888_MODE\t\t\tATMEL_HLCDC_RGB_MODE(10)\n#define ATMEL_HLCDC_ARGB8888_MODE\t\tATMEL_HLCDC_RGB_MODE(12)\n#define ATMEL_HLCDC_RGBA8888_MODE\t\tATMEL_HLCDC_RGB_MODE(13)\n\n#define ATMEL_HLCDC_AYUV_MODE\t\t\tATMEL_HLCDC_YUV_MODE(0)\n#define ATMEL_HLCDC_YUYV_MODE\t\t\tATMEL_HLCDC_YUV_MODE(1)\n#define ATMEL_HLCDC_UYVY_MODE\t\t\tATMEL_HLCDC_YUV_MODE(2)\n#define ATMEL_HLCDC_YVYU_MODE\t\t\tATMEL_HLCDC_YUV_MODE(3)\n#define ATMEL_HLCDC_VYUY_MODE\t\t\tATMEL_HLCDC_YUV_MODE(4)\n#define ATMEL_HLCDC_NV61_MODE\t\t\tATMEL_HLCDC_YUV_MODE(5)\n#define ATMEL_HLCDC_YUV422_MODE\t\t\tATMEL_HLCDC_YUV_MODE(6)\n#define ATMEL_HLCDC_NV21_MODE\t\t\tATMEL_HLCDC_YUV_MODE(7)\n#define ATMEL_HLCDC_YUV420_MODE\t\t\tATMEL_HLCDC_YUV_MODE(8)\n\n#define ATMEL_HLCDC_LAYER_POS(x, y)\t\t((x) | ((y) << 16))\n#define ATMEL_HLCDC_LAYER_SIZE(w, h)\t\t(((w) - 1) | (((h) - 1) << 16))\n\n#define ATMEL_HLCDC_LAYER_CRKEY\t\t\tBIT(0)\n#define ATMEL_HLCDC_LAYER_INV\t\t\tBIT(1)\n#define ATMEL_HLCDC_LAYER_ITER2BL\t\tBIT(2)\n#define ATMEL_HLCDC_LAYER_ITER\t\t\tBIT(3)\n#define ATMEL_HLCDC_LAYER_REVALPHA\t\tBIT(4)\n#define ATMEL_HLCDC_LAYER_GAEN\t\t\tBIT(5)\n#define ATMEL_HLCDC_LAYER_LAEN\t\t\tBIT(6)\n#define ATMEL_HLCDC_LAYER_OVR\t\t\tBIT(7)\n#define ATMEL_HLCDC_LAYER_DMA\t\t\tBIT(8)\n#define ATMEL_HLCDC_LAYER_REP\t\t\tBIT(9)\n#define ATMEL_HLCDC_LAYER_DSTKEY\t\tBIT(10)\n#define ATMEL_HLCDC_LAYER_DISCEN\t\tBIT(11)\n#define ATMEL_HLCDC_LAYER_GA_SHIFT\t\t16\n#define ATMEL_HLCDC_LAYER_GA_MASK\t\t\\\n\tGENMASK(23, ATMEL_HLCDC_LAYER_GA_SHIFT)\n#define ATMEL_HLCDC_LAYER_GA(x)\t\t\t\\\n\t((x) << ATMEL_HLCDC_LAYER_GA_SHIFT)\n\n#define ATMEL_HLCDC_LAYER_DISC_POS(x, y)\t((x) | ((y) << 16))\n#define ATMEL_HLCDC_LAYER_DISC_SIZE(w, h)\t(((w) - 1) | (((h) - 1) << 16))\n\n#define ATMEL_HLCDC_LAYER_SCALER_FACTORS(x, y)\t((x) | ((y) << 16))\n#define ATMEL_HLCDC_LAYER_SCALER_ENABLE\t\tBIT(31)\n\n#define ATMEL_HLCDC_LAYER_MAX_PLANES\t\t3\n\n#define ATMEL_HLCDC_DMA_CHANNEL_DSCR_RESERVED\tBIT(0)\n#define ATMEL_HLCDC_DMA_CHANNEL_DSCR_LOADED\tBIT(1)\n#define ATMEL_HLCDC_DMA_CHANNEL_DSCR_DONE\tBIT(2)\n#define ATMEL_HLCDC_DMA_CHANNEL_DSCR_OVERRUN\tBIT(3)\n\n#define ATMEL_HLCDC_CLUT_SIZE\t\t\t256\n\n#define ATMEL_HLCDC_MAX_LAYERS\t\t\t6\n\n \nstruct atmel_hlcdc_layer_cfg_layout {\n\tint xstride[ATMEL_HLCDC_LAYER_MAX_PLANES];\n\tint pstride[ATMEL_HLCDC_LAYER_MAX_PLANES];\n\tint pos;\n\tint size;\n\tint memsize;\n\tint default_color;\n\tint chroma_key;\n\tint chroma_key_mask;\n\tint general_config;\n\tint scaler_config;\n\tstruct {\n\t\tint x;\n\t\tint y;\n\t} phicoeffs;\n\tint disc_pos;\n\tint disc_size;\n\tint csc;\n};\n\n \nstruct atmel_hlcdc_dma_channel_dscr {\n\tdma_addr_t addr;\n\tu32 ctrl;\n\tdma_addr_t next;\n\tdma_addr_t self;\n} __aligned(sizeof(u64));\n\n \nenum atmel_hlcdc_layer_type {\n\tATMEL_HLCDC_NO_LAYER,\n\tATMEL_HLCDC_BASE_LAYER,\n\tATMEL_HLCDC_OVERLAY_LAYER,\n\tATMEL_HLCDC_CURSOR_LAYER,\n\tATMEL_HLCDC_PP_LAYER,\n};\n\n \nstruct atmel_hlcdc_formats {\n\tint nformats;\n\tu32 *formats;\n};\n\n \nstruct atmel_hlcdc_layer_desc {\n\tconst char *name;\n\tenum atmel_hlcdc_layer_type type;\n\tint id;\n\tint regs_offset;\n\tint cfgs_offset;\n\tint clut_offset;\n\tstruct atmel_hlcdc_formats *formats;\n\tstruct atmel_hlcdc_layer_cfg_layout layout;\n\tint max_width;\n\tint max_height;\n};\n\n \nstruct atmel_hlcdc_layer {\n\tconst struct atmel_hlcdc_layer_desc *desc;\n\tstruct regmap *regmap;\n};\n\n \nstruct atmel_hlcdc_plane {\n\tstruct drm_plane base;\n\tstruct atmel_hlcdc_layer layer;\n};\n\nstatic inline struct atmel_hlcdc_plane *\ndrm_plane_to_atmel_hlcdc_plane(struct drm_plane *p)\n{\n\treturn container_of(p, struct atmel_hlcdc_plane, base);\n}\n\nstatic inline struct atmel_hlcdc_plane *\natmel_hlcdc_layer_to_plane(struct atmel_hlcdc_layer *layer)\n{\n\treturn container_of(layer, struct atmel_hlcdc_plane, layer);\n}\n\n \nstruct atmel_hlcdc_dc_desc {\n\tint min_width;\n\tint min_height;\n\tint max_width;\n\tint max_height;\n\tint max_spw;\n\tint max_vpw;\n\tint max_hpw;\n\tbool conflicting_output_formats;\n\tbool fixed_clksrc;\n\tconst struct atmel_hlcdc_layer_desc *layers;\n\tint nlayers;\n};\n\n \nstruct atmel_hlcdc_dc {\n\tconst struct atmel_hlcdc_dc_desc *desc;\n\tstruct dma_pool *dscrpool;\n\tstruct atmel_hlcdc *hlcdc;\n\tstruct drm_crtc *crtc;\n\tstruct atmel_hlcdc_layer *layers[ATMEL_HLCDC_MAX_LAYERS];\n\tstruct {\n\t\tu32 imr;\n\t\tstruct drm_atomic_state *state;\n\t} suspend;\n};\n\nextern struct atmel_hlcdc_formats atmel_hlcdc_plane_rgb_formats;\nextern struct atmel_hlcdc_formats atmel_hlcdc_plane_rgb_and_yuv_formats;\n\nstatic inline void atmel_hlcdc_layer_write_reg(struct atmel_hlcdc_layer *layer,\n\t\t\t\t\t       unsigned int reg, u32 val)\n{\n\tregmap_write(layer->regmap, layer->desc->regs_offset + reg, val);\n}\n\nstatic inline u32 atmel_hlcdc_layer_read_reg(struct atmel_hlcdc_layer *layer,\n\t\t\t\t\t     unsigned int reg)\n{\n\tu32 val;\n\n\tregmap_read(layer->regmap, layer->desc->regs_offset + reg, &val);\n\n\treturn val;\n}\n\nstatic inline void atmel_hlcdc_layer_write_cfg(struct atmel_hlcdc_layer *layer,\n\t\t\t\t\t       unsigned int cfgid, u32 val)\n{\n\tatmel_hlcdc_layer_write_reg(layer,\n\t\t\t\t    layer->desc->cfgs_offset +\n\t\t\t\t    (cfgid * sizeof(u32)), val);\n}\n\nstatic inline u32 atmel_hlcdc_layer_read_cfg(struct atmel_hlcdc_layer *layer,\n\t\t\t\t\t     unsigned int cfgid)\n{\n\treturn atmel_hlcdc_layer_read_reg(layer,\n\t\t\t\t\t  layer->desc->cfgs_offset +\n\t\t\t\t\t  (cfgid * sizeof(u32)));\n}\n\nstatic inline void atmel_hlcdc_layer_write_clut(struct atmel_hlcdc_layer *layer,\n\t\t\t\t\t\tunsigned int c, u32 val)\n{\n\tregmap_write(layer->regmap,\n\t\t     layer->desc->clut_offset + c * sizeof(u32),\n\t\t     val);\n}\n\nstatic inline void atmel_hlcdc_layer_init(struct atmel_hlcdc_layer *layer,\n\t\t\t\tconst struct atmel_hlcdc_layer_desc *desc,\n\t\t\t\tstruct regmap *regmap)\n{\n\tlayer->desc = desc;\n\tlayer->regmap = regmap;\n}\n\nenum drm_mode_status\natmel_hlcdc_dc_mode_valid(struct atmel_hlcdc_dc *dc,\n\t\t\t  const struct drm_display_mode *mode);\n\nint atmel_hlcdc_create_planes(struct drm_device *dev);\nvoid atmel_hlcdc_plane_irq(struct atmel_hlcdc_plane *plane);\n\nint atmel_hlcdc_plane_prepare_disc_area(struct drm_crtc_state *c_state);\nint atmel_hlcdc_plane_prepare_ahb_routing(struct drm_crtc_state *c_state);\n\nvoid atmel_hlcdc_crtc_irq(struct drm_crtc *c);\n\nint atmel_hlcdc_crtc_create(struct drm_device *dev);\n\nint atmel_hlcdc_create_outputs(struct drm_device *dev);\nint atmel_hlcdc_encoder_get_bus_fmt(struct drm_encoder *encoder);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}