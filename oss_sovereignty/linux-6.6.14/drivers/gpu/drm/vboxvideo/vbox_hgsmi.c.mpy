{
  "module_name": "vbox_hgsmi.c",
  "hash_id": "3dbc6691c32e97056c1912adfed06819cb4839b26ba7519bf9ad9c30b053b75a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/vboxvideo/vbox_hgsmi.c",
  "human_readable_source": "\n \n\n#include \"vbox_drv.h\"\n#include \"vboxvideo_vbe.h\"\n#include \"hgsmi_defs.h\"\n\n \nstatic u32 hgsmi_checksum(u32 offset,\n\t\t\t  const struct hgsmi_buffer_header *header,\n\t\t\t  const struct hgsmi_buffer_tail *tail)\n{\n\tu32 checksum;\n\n\tchecksum = hgsmi_hash_process(0, (u8 *)&offset, sizeof(offset));\n\tchecksum = hgsmi_hash_process(checksum, (u8 *)header, sizeof(*header));\n\t \n\tchecksum = hgsmi_hash_process(checksum, (u8 *)tail, 4);\n\n\treturn hgsmi_hash_end(checksum);\n}\n\nvoid *hgsmi_buffer_alloc(struct gen_pool *guest_pool, size_t size,\n\t\t\t u8 channel, u16 channel_info)\n{\n\tstruct hgsmi_buffer_header *h;\n\tstruct hgsmi_buffer_tail *t;\n\tsize_t total_size;\n\tdma_addr_t offset;\n\n\ttotal_size = size + sizeof(*h) + sizeof(*t);\n\th = gen_pool_dma_alloc(guest_pool, total_size, &offset);\n\tif (!h)\n\t\treturn NULL;\n\n\tt = (struct hgsmi_buffer_tail *)((u8 *)h + sizeof(*h) + size);\n\n\th->flags = HGSMI_BUFFER_HEADER_F_SEQ_SINGLE;\n\th->data_size = size;\n\th->channel = channel;\n\th->channel_info = channel_info;\n\tmemset(&h->u.header_data, 0, sizeof(h->u.header_data));\n\n\tt->reserved = 0;\n\tt->checksum = hgsmi_checksum(offset, h, t);\n\n\treturn (u8 *)h + sizeof(*h);\n}\n\nvoid hgsmi_buffer_free(struct gen_pool *guest_pool, void *buf)\n{\n\tstruct hgsmi_buffer_header *h =\n\t\t(struct hgsmi_buffer_header *)((u8 *)buf - sizeof(*h));\n\tsize_t total_size = h->data_size + sizeof(*h) +\n\t\t\t\t\t     sizeof(struct hgsmi_buffer_tail);\n\n\tgen_pool_free(guest_pool, (unsigned long)h, total_size);\n}\n\nint hgsmi_buffer_submit(struct gen_pool *guest_pool, void *buf)\n{\n\tphys_addr_t offset;\n\n\toffset = gen_pool_virt_to_phys(guest_pool, (unsigned long)buf -\n\t\t\t\t       sizeof(struct hgsmi_buffer_header));\n\toutl(offset, VGA_PORT_HGSMI_GUEST);\n\t \n\tmb();\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}