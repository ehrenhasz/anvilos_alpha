{
  "module_name": "etnaviv_mmu.h",
  "hash_id": "c3cfc872795e0afbeca7b5fa5fecded2f4c13f8b8e016675dc2a34b804e3f3f8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/etnaviv/etnaviv_mmu.h",
  "human_readable_source": " \n \n\n#ifndef __ETNAVIV_MMU_H__\n#define __ETNAVIV_MMU_H__\n\n#define ETNAVIV_PROT_READ\t(1 << 0)\n#define ETNAVIV_PROT_WRITE\t(1 << 1)\n\nenum etnaviv_iommu_version {\n\tETNAVIV_IOMMU_V1 = 0,\n\tETNAVIV_IOMMU_V2,\n};\n\nstruct etnaviv_gpu;\nstruct etnaviv_vram_mapping;\nstruct etnaviv_iommu_global;\nstruct etnaviv_iommu_context;\n\nstruct etnaviv_iommu_ops {\n\tstruct etnaviv_iommu_context *(*init)(struct etnaviv_iommu_global *);\n\tvoid (*free)(struct etnaviv_iommu_context *);\n\tint (*map)(struct etnaviv_iommu_context *context, unsigned long iova,\n\t\t   phys_addr_t paddr, size_t size, int prot);\n\tsize_t (*unmap)(struct etnaviv_iommu_context *context, unsigned long iova,\n\t\t\tsize_t size);\n\tsize_t (*dump_size)(struct etnaviv_iommu_context *);\n\tvoid (*dump)(struct etnaviv_iommu_context *, void *);\n\tvoid (*restore)(struct etnaviv_gpu *, struct etnaviv_iommu_context *);\n};\n\nextern const struct etnaviv_iommu_ops etnaviv_iommuv1_ops;\nextern const struct etnaviv_iommu_ops etnaviv_iommuv2_ops;\n\n#define ETNAVIV_PTA_SIZE\tSZ_4K\n#define ETNAVIV_PTA_ENTRIES\t(ETNAVIV_PTA_SIZE / sizeof(u64))\n\nstruct etnaviv_iommu_global {\n\tstruct device *dev;\n\tenum etnaviv_iommu_version version;\n\tconst struct etnaviv_iommu_ops *ops;\n\tunsigned int use;\n\tstruct mutex lock;\n\n\tvoid *bad_page_cpu;\n\tdma_addr_t bad_page_dma;\n\n\tu32 memory_base;\n\n\t \n\tunion {\n\t\tstruct {\n\t\t\tstruct etnaviv_iommu_context *shared_context;\n\t\t} v1;\n\t\tstruct {\n\t\t\t \n\t\t\tu64 *pta_cpu;\n\t\t\tdma_addr_t pta_dma;\n\t\t\tstruct spinlock pta_lock;\n\t\t\tDECLARE_BITMAP(pta_alloc, ETNAVIV_PTA_ENTRIES);\n\t\t} v2;\n\t};\n};\n\nstruct etnaviv_iommu_context {\n\tstruct kref refcount;\n\tstruct etnaviv_iommu_global *global;\n\n\t \n\tstruct mutex lock;\n\tstruct list_head mappings;\n\tstruct drm_mm mm;\n\tunsigned int flush_seq;\n\n\t \n\tstruct etnaviv_vram_mapping cmdbuf_mapping;\n};\n\nint etnaviv_iommu_global_init(struct etnaviv_gpu *gpu);\nvoid etnaviv_iommu_global_fini(struct etnaviv_gpu *gpu);\n\nstruct etnaviv_gem_object;\n\nint etnaviv_iommu_map_gem(struct etnaviv_iommu_context *context,\n\tstruct etnaviv_gem_object *etnaviv_obj, u32 memory_base,\n\tstruct etnaviv_vram_mapping *mapping, u64 va);\nvoid etnaviv_iommu_unmap_gem(struct etnaviv_iommu_context *context,\n\tstruct etnaviv_vram_mapping *mapping);\nvoid etnaviv_iommu_reap_mapping(struct etnaviv_vram_mapping *mapping);\n\nint etnaviv_iommu_get_suballoc_va(struct etnaviv_iommu_context *ctx,\n\t\t\t\t  struct etnaviv_vram_mapping *mapping,\n\t\t\t\t  u32 memory_base, dma_addr_t paddr,\n\t\t\t\t  size_t size);\nvoid etnaviv_iommu_put_suballoc_va(struct etnaviv_iommu_context *ctx,\n\t\t\t\t   struct etnaviv_vram_mapping *mapping);\n\nsize_t etnaviv_iommu_dump_size(struct etnaviv_iommu_context *ctx);\nvoid etnaviv_iommu_dump(struct etnaviv_iommu_context *ctx, void *buf);\n\nstruct etnaviv_iommu_context *\netnaviv_iommu_context_init(struct etnaviv_iommu_global *global,\n\t\t\t   struct etnaviv_cmdbuf_suballoc *suballoc);\nstatic inline struct etnaviv_iommu_context *\netnaviv_iommu_context_get(struct etnaviv_iommu_context *ctx)\n{\n\tkref_get(&ctx->refcount);\n\treturn ctx;\n}\nvoid etnaviv_iommu_context_put(struct etnaviv_iommu_context *ctx);\nvoid etnaviv_iommu_restore(struct etnaviv_gpu *gpu,\n\t\t\t   struct etnaviv_iommu_context *ctx);\n\nstruct etnaviv_iommu_context *\netnaviv_iommuv1_context_alloc(struct etnaviv_iommu_global *global);\nstruct etnaviv_iommu_context *\netnaviv_iommuv2_context_alloc(struct etnaviv_iommu_global *global);\n\nu32 etnaviv_iommuv2_get_mtlb_addr(struct etnaviv_iommu_context *context);\nunsigned short etnaviv_iommuv2_get_pta_id(struct etnaviv_iommu_context *context);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}