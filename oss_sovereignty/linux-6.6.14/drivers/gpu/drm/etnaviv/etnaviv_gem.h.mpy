{
  "module_name": "etnaviv_gem.h",
  "hash_id": "4d73d9222d218c324ba0adec16eb6629a628e7f48a342e9db096f54f67eb03ec",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/etnaviv/etnaviv_gem.h",
  "human_readable_source": " \n \n\n#ifndef __ETNAVIV_GEM_H__\n#define __ETNAVIV_GEM_H__\n\n#include <linux/dma-resv.h>\n#include \"etnaviv_cmdbuf.h\"\n#include \"etnaviv_drv.h\"\n\nstruct dma_fence;\nstruct etnaviv_gem_ops;\nstruct etnaviv_gem_object;\n\nstruct etnaviv_gem_userptr {\n\tuintptr_t ptr;\n\tstruct mm_struct *mm;\n\tbool ro;\n};\n\nstruct etnaviv_vram_mapping {\n\tstruct list_head obj_node;\n\tstruct list_head scan_node;\n\tstruct list_head mmu_node;\n\tstruct etnaviv_gem_object *object;\n\tstruct etnaviv_iommu_context *context;\n\tstruct drm_mm_node vram_node;\n\tunsigned int use;\n\tu32 iova;\n};\n\nstruct etnaviv_gem_object {\n\tstruct drm_gem_object base;\n\tconst struct etnaviv_gem_ops *ops;\n\tstruct mutex lock;\n\n\tu32 flags;\n\n\tstruct list_head gem_node;\n\tstruct etnaviv_gpu *gpu;      \n\tatomic_t gpu_active;\n\tu32 access;\n\n\tstruct page **pages;\n\tstruct sg_table *sgt;\n\tvoid *vaddr;\n\n\tstruct list_head vram_list;\n\n\t \n\tu32 last_cpu_prep_op;\n\n\tstruct etnaviv_gem_userptr userptr;\n};\n\nstatic inline\nstruct etnaviv_gem_object *to_etnaviv_bo(struct drm_gem_object *obj)\n{\n\treturn container_of(obj, struct etnaviv_gem_object, base);\n}\n\nstruct etnaviv_gem_ops {\n\tint (*get_pages)(struct etnaviv_gem_object *);\n\tvoid (*release)(struct etnaviv_gem_object *);\n\tvoid *(*vmap)(struct etnaviv_gem_object *);\n\tint (*mmap)(struct etnaviv_gem_object *, struct vm_area_struct *);\n};\n\nstatic inline bool is_active(struct etnaviv_gem_object *etnaviv_obj)\n{\n\treturn atomic_read(&etnaviv_obj->gpu_active) != 0;\n}\n\n#define MAX_CMDS 4\n\nstruct etnaviv_gem_submit_bo {\n\tu32 flags;\n\tu64 va;\n\tstruct etnaviv_gem_object *obj;\n\tstruct etnaviv_vram_mapping *mapping;\n};\n\n \nstruct etnaviv_gem_submit {\n\tstruct drm_sched_job sched_job;\n\tstruct kref refcount;\n\tstruct etnaviv_file_private *ctx;\n\tstruct etnaviv_gpu *gpu;\n\tstruct etnaviv_iommu_context *mmu_context, *prev_mmu_context;\n\tstruct dma_fence *out_fence;\n\tint out_fence_id;\n\tstruct list_head node;  \n\tstruct etnaviv_cmdbuf cmdbuf;\n\tstruct pid *pid;        \n\tu32 exec_state;\n\tu32 flags;\n\tunsigned int nr_pmrs;\n\tstruct etnaviv_perfmon_request *pmrs;\n\tunsigned int nr_bos;\n\tstruct etnaviv_gem_submit_bo bos[];\n\t \n};\n\nvoid etnaviv_submit_put(struct etnaviv_gem_submit * submit);\n\nint etnaviv_gem_wait_bo(struct etnaviv_gpu *gpu, struct drm_gem_object *obj,\n\tstruct drm_etnaviv_timespec *timeout);\nint etnaviv_gem_new_private(struct drm_device *dev, size_t size, u32 flags,\n\tconst struct etnaviv_gem_ops *ops, struct etnaviv_gem_object **res);\nvoid etnaviv_gem_obj_add(struct drm_device *dev, struct drm_gem_object *obj);\nstruct page **etnaviv_gem_get_pages(struct etnaviv_gem_object *obj);\nvoid etnaviv_gem_put_pages(struct etnaviv_gem_object *obj);\n\nstruct etnaviv_vram_mapping *etnaviv_gem_mapping_get(\n\tstruct drm_gem_object *obj, struct etnaviv_iommu_context *mmu_context,\n\tu64 va);\nvoid etnaviv_gem_mapping_unreference(struct etnaviv_vram_mapping *mapping);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}