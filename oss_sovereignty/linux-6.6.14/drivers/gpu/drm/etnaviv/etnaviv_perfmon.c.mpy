{
  "module_name": "etnaviv_perfmon.c",
  "hash_id": "180e198121cd5864901f55447470edff710a6e3f2f25b45f76c32fdfcd4ecf82",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/etnaviv/etnaviv_perfmon.c",
  "human_readable_source": "\n \n\n#include \"common.xml.h\"\n#include \"etnaviv_gpu.h\"\n#include \"etnaviv_perfmon.h\"\n#include \"state_hi.xml.h\"\n\nstruct etnaviv_pm_domain;\n\nstruct etnaviv_pm_signal {\n\tchar name[64];\n\tu32 data;\n\n\tu32 (*sample)(struct etnaviv_gpu *gpu,\n\t\t      const struct etnaviv_pm_domain *domain,\n\t\t      const struct etnaviv_pm_signal *signal);\n};\n\nstruct etnaviv_pm_domain {\n\tchar name[64];\n\n\t \n\tu32 profile_read;\n\tu32 profile_config;\n\n\tu8 nr_signals;\n\tconst struct etnaviv_pm_signal *signal;\n};\n\nstruct etnaviv_pm_domain_meta {\n\tunsigned int feature;\n\tconst struct etnaviv_pm_domain *domains;\n\tu32 nr_domains;\n};\n\nstatic u32 perf_reg_read(struct etnaviv_gpu *gpu,\n\tconst struct etnaviv_pm_domain *domain,\n\tconst struct etnaviv_pm_signal *signal)\n{\n\tgpu_write(gpu, domain->profile_config, signal->data);\n\n\treturn gpu_read(gpu, domain->profile_read);\n}\n\nstatic inline void pipe_select(struct etnaviv_gpu *gpu, u32 clock, unsigned pipe)\n{\n\tclock &= ~(VIVS_HI_CLOCK_CONTROL_DEBUG_PIXEL_PIPE__MASK);\n\tclock |= VIVS_HI_CLOCK_CONTROL_DEBUG_PIXEL_PIPE(pipe);\n\n\tgpu_write(gpu, VIVS_HI_CLOCK_CONTROL, clock);\n}\n\nstatic u32 pipe_perf_reg_read(struct etnaviv_gpu *gpu,\n\tconst struct etnaviv_pm_domain *domain,\n\tconst struct etnaviv_pm_signal *signal)\n{\n\tu32 clock = gpu_read(gpu, VIVS_HI_CLOCK_CONTROL);\n\tu32 value = 0;\n\tunsigned i;\n\n\tfor (i = 0; i < gpu->identity.pixel_pipes; i++) {\n\t\tpipe_select(gpu, clock, i);\n\t\tvalue += perf_reg_read(gpu, domain, signal);\n\t}\n\n\t \n\tpipe_select(gpu, clock, 0);\n\n\treturn value;\n}\n\nstatic u32 pipe_reg_read(struct etnaviv_gpu *gpu,\n\tconst struct etnaviv_pm_domain *domain,\n\tconst struct etnaviv_pm_signal *signal)\n{\n\tu32 clock = gpu_read(gpu, VIVS_HI_CLOCK_CONTROL);\n\tu32 value = 0;\n\tunsigned i;\n\n\tfor (i = 0; i < gpu->identity.pixel_pipes; i++) {\n\t\tpipe_select(gpu, clock, i);\n\t\tvalue += gpu_read(gpu, signal->data);\n\t}\n\n\t \n\tpipe_select(gpu, clock, 0);\n\n\treturn value;\n}\n\nstatic u32 hi_total_cycle_read(struct etnaviv_gpu *gpu,\n\tconst struct etnaviv_pm_domain *domain,\n\tconst struct etnaviv_pm_signal *signal)\n{\n\tu32 reg = VIVS_HI_PROFILE_TOTAL_CYCLES;\n\n\tif (gpu->identity.model == chipModel_GC880 ||\n\t\tgpu->identity.model == chipModel_GC2000 ||\n\t\tgpu->identity.model == chipModel_GC2100)\n\t\treg = VIVS_MC_PROFILE_CYCLE_COUNTER;\n\n\treturn gpu_read(gpu, reg);\n}\n\nstatic u32 hi_total_idle_cycle_read(struct etnaviv_gpu *gpu,\n\tconst struct etnaviv_pm_domain *domain,\n\tconst struct etnaviv_pm_signal *signal)\n{\n\tu32 reg = VIVS_HI_PROFILE_IDLE_CYCLES;\n\n\tif (gpu->identity.model == chipModel_GC880 ||\n\t\tgpu->identity.model == chipModel_GC2000 ||\n\t\tgpu->identity.model == chipModel_GC2100)\n\t\treg = VIVS_HI_PROFILE_TOTAL_CYCLES;\n\n\treturn gpu_read(gpu, reg);\n}\n\nstatic const struct etnaviv_pm_domain doms_3d[] = {\n\t{\n\t\t.name = \"HI\",\n\t\t.profile_read = VIVS_MC_PROFILE_HI_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG2,\n\t\t.nr_signals = 7,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"TOTAL_READ_BYTES8\",\n\t\t\t\tVIVS_HI_PROFILE_READ_BYTES8,\n\t\t\t\t&pipe_reg_read,\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_WRITE_BYTES8\",\n\t\t\t\tVIVS_HI_PROFILE_WRITE_BYTES8,\n\t\t\t\t&pipe_reg_read,\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_CYCLES\",\n\t\t\t\t0,\n\t\t\t\t&hi_total_cycle_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"IDLE_CYCLES\",\n\t\t\t\t0,\n\t\t\t\t&hi_total_idle_cycle_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"AXI_CYCLES_READ_REQUEST_STALLED\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG2_HI_AXI_CYCLES_READ_REQUEST_STALLED,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"AXI_CYCLES_WRITE_REQUEST_STALLED\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG2_HI_AXI_CYCLES_WRITE_REQUEST_STALLED,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"AXI_CYCLES_WRITE_DATA_STALLED\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG2_HI_AXI_CYCLES_WRITE_DATA_STALLED,\n\t\t\t\t&perf_reg_read\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\t.name = \"PE\",\n\t\t.profile_read = VIVS_MC_PROFILE_PE_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG0,\n\t\t.nr_signals = 4,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"PIXEL_COUNT_KILLED_BY_COLOR_PIPE\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_PE_PIXEL_COUNT_KILLED_BY_COLOR_PIPE,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PIXEL_COUNT_KILLED_BY_DEPTH_PIPE\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_PE_PIXEL_COUNT_KILLED_BY_DEPTH_PIPE,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PIXEL_COUNT_DRAWN_BY_COLOR_PIPE\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_PE_PIXEL_COUNT_DRAWN_BY_COLOR_PIPE,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PIXEL_COUNT_DRAWN_BY_DEPTH_PIPE\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_PE_PIXEL_COUNT_DRAWN_BY_DEPTH_PIPE,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\t.name = \"SH\",\n\t\t.profile_read = VIVS_MC_PROFILE_SH_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG0,\n\t\t.nr_signals = 9,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"SHADER_CYCLES\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_SHADER_CYCLES,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PS_INST_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_PS_INST_COUNTER,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"RENDERED_PIXEL_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_RENDERED_PIXEL_COUNTER,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"VS_INST_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_VS_INST_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"RENDERED_VERTICE_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_RENDERED_VERTICE_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"VTX_BRANCH_INST_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_VTX_BRANCH_INST_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"VTX_TEXLD_INST_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_VTX_TEXLD_INST_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PXL_BRANCH_INST_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_PXL_BRANCH_INST_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PXL_TEXLD_INST_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_SH_PXL_TEXLD_INST_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\t.name = \"PA\",\n\t\t.profile_read = VIVS_MC_PROFILE_PA_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG1,\n\t\t.nr_signals = 6,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"INPUT_VTX_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_PA_INPUT_VTX_COUNTER,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"INPUT_PRIM_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_PA_INPUT_PRIM_COUNTER,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"OUTPUT_PRIM_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_PA_OUTPUT_PRIM_COUNTER,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"DEPTH_CLIPPED_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_PA_DEPTH_CLIPPED_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TRIVIAL_REJECTED_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_PA_TRIVIAL_REJECTED_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"CULLED_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_PA_CULLED_COUNTER,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\t.name = \"SE\",\n\t\t.profile_read = VIVS_MC_PROFILE_SE_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG1,\n\t\t.nr_signals = 2,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"CULLED_TRIANGLE_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_SE_CULLED_TRIANGLE_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"CULLED_LINES_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_SE_CULLED_LINES_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\t.name = \"RA\",\n\t\t.profile_read = VIVS_MC_PROFILE_RA_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG1,\n\t\t.nr_signals = 7,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"VALID_PIXEL_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_RA_VALID_PIXEL_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_QUAD_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_RA_TOTAL_QUAD_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"VALID_QUAD_COUNT_AFTER_EARLY_Z\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_RA_VALID_QUAD_COUNT_AFTER_EARLY_Z,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_PRIMITIVE_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_RA_TOTAL_PRIMITIVE_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PIPE_CACHE_MISS_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_RA_PIPE_CACHE_MISS_COUNTER,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"PREFETCH_CACHE_MISS_COUNTER\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_RA_PREFETCH_CACHE_MISS_COUNTER,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"CULLED_QUAD_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_RA_CULLED_QUAD_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\t.name = \"TX\",\n\t\t.profile_read = VIVS_MC_PROFILE_TX_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG1,\n\t\t.nr_signals = 9,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"TOTAL_BILINEAR_REQUESTS\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_TOTAL_BILINEAR_REQUESTS,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_TRILINEAR_REQUESTS\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_TOTAL_TRILINEAR_REQUESTS,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_DISCARDED_TEXTURE_REQUESTS\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_TOTAL_DISCARDED_TEXTURE_REQUESTS,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_TEXTURE_REQUESTS\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_TOTAL_TEXTURE_REQUESTS,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"MEM_READ_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_MEM_READ_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"MEM_READ_IN_8B_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_MEM_READ_IN_8B_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"CACHE_MISS_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_CACHE_MISS_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"CACHE_HIT_TEXEL_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_CACHE_HIT_TEXEL_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"CACHE_MISS_TEXEL_COUNT\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG1_TX_CACHE_MISS_TEXEL_COUNT,\n\t\t\t\t&perf_reg_read\n\t\t\t}\n\t\t}\n\t},\n\t{\n\t\t.name = \"MC\",\n\t\t.profile_read = VIVS_MC_PROFILE_MC_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG2,\n\t\t.nr_signals = 3,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"TOTAL_READ_REQ_8B_FROM_PIPELINE\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG2_MC_TOTAL_READ_REQ_8B_FROM_PIPELINE,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_READ_REQ_8B_FROM_IP\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG2_MC_TOTAL_READ_REQ_8B_FROM_IP,\n\t\t\t\t&perf_reg_read\n\t\t\t},\n\t\t\t{\n\t\t\t\t\"TOTAL_WRITE_REQ_8B_FROM_PIPELINE\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG2_MC_TOTAL_WRITE_REQ_8B_FROM_PIPELINE,\n\t\t\t\t&perf_reg_read\n\t\t\t}\n\t\t}\n\t}\n};\n\nstatic const struct etnaviv_pm_domain doms_2d[] = {\n\t{\n\t\t.name = \"PE\",\n\t\t.profile_read = VIVS_MC_PROFILE_PE_READ,\n\t\t.profile_config = VIVS_MC_PROFILE_CONFIG0,\n\t\t.nr_signals = 1,\n\t\t.signal = (const struct etnaviv_pm_signal[]) {\n\t\t\t{\n\t\t\t\t\"PIXELS_RENDERED_2D\",\n\t\t\t\tVIVS_MC_PROFILE_CONFIG0_PE_PIXELS_RENDERED_2D,\n\t\t\t\t&pipe_perf_reg_read\n\t\t\t}\n\t\t}\n\t}\n};\n\nstatic const struct etnaviv_pm_domain doms_vg[] = {\n};\n\nstatic const struct etnaviv_pm_domain_meta doms_meta[] = {\n\t{\n\t\t.feature = chipFeatures_PIPE_3D,\n\t\t.nr_domains = ARRAY_SIZE(doms_3d),\n\t\t.domains = &doms_3d[0]\n\t},\n\t{\n\t\t.feature = chipFeatures_PIPE_2D,\n\t\t.nr_domains = ARRAY_SIZE(doms_2d),\n\t\t.domains = &doms_2d[0]\n\t},\n\t{\n\t\t.feature = chipFeatures_PIPE_VG,\n\t\t.nr_domains = ARRAY_SIZE(doms_vg),\n\t\t.domains = &doms_vg[0]\n\t}\n};\n\nstatic unsigned int num_pm_domains(const struct etnaviv_gpu *gpu)\n{\n\tunsigned int num = 0, i;\n\n\tfor (i = 0; i < ARRAY_SIZE(doms_meta); i++) {\n\t\tconst struct etnaviv_pm_domain_meta *meta = &doms_meta[i];\n\n\t\tif (gpu->identity.features & meta->feature)\n\t\t\tnum += meta->nr_domains;\n\t}\n\n\treturn num;\n}\n\nstatic const struct etnaviv_pm_domain *pm_domain(const struct etnaviv_gpu *gpu,\n\tunsigned int index)\n{\n\tconst struct etnaviv_pm_domain *domain = NULL;\n\tunsigned int offset = 0, i;\n\n\tfor (i = 0; i < ARRAY_SIZE(doms_meta); i++) {\n\t\tconst struct etnaviv_pm_domain_meta *meta = &doms_meta[i];\n\n\t\tif (!(gpu->identity.features & meta->feature))\n\t\t\tcontinue;\n\n\t\tif (index - offset >= meta->nr_domains) {\n\t\t\toffset += meta->nr_domains;\n\t\t\tcontinue;\n\t\t}\n\n\t\tdomain = meta->domains + (index - offset);\n\t}\n\n\treturn domain;\n}\n\nint etnaviv_pm_query_dom(struct etnaviv_gpu *gpu,\n\tstruct drm_etnaviv_pm_domain *domain)\n{\n\tconst unsigned int nr_domains = num_pm_domains(gpu);\n\tconst struct etnaviv_pm_domain *dom;\n\n\tif (domain->iter >= nr_domains)\n\t\treturn -EINVAL;\n\n\tdom = pm_domain(gpu, domain->iter);\n\tif (!dom)\n\t\treturn -EINVAL;\n\n\tdomain->id = domain->iter;\n\tdomain->nr_signals = dom->nr_signals;\n\tstrncpy(domain->name, dom->name, sizeof(domain->name));\n\n\tdomain->iter++;\n\tif (domain->iter == nr_domains)\n\t\tdomain->iter = 0xff;\n\n\treturn 0;\n}\n\nint etnaviv_pm_query_sig(struct etnaviv_gpu *gpu,\n\tstruct drm_etnaviv_pm_signal *signal)\n{\n\tconst unsigned int nr_domains = num_pm_domains(gpu);\n\tconst struct etnaviv_pm_domain *dom;\n\tconst struct etnaviv_pm_signal *sig;\n\n\tif (signal->domain >= nr_domains)\n\t\treturn -EINVAL;\n\n\tdom = pm_domain(gpu, signal->domain);\n\tif (!dom)\n\t\treturn -EINVAL;\n\n\tif (signal->iter >= dom->nr_signals)\n\t\treturn -EINVAL;\n\n\tsig = &dom->signal[signal->iter];\n\n\tsignal->id = signal->iter;\n\tstrncpy(signal->name, sig->name, sizeof(signal->name));\n\n\tsignal->iter++;\n\tif (signal->iter == dom->nr_signals)\n\t\tsignal->iter = 0xffff;\n\n\treturn 0;\n}\n\nint etnaviv_pm_req_validate(const struct drm_etnaviv_gem_submit_pmr *r,\n\tu32 exec_state)\n{\n\tconst struct etnaviv_pm_domain_meta *meta = &doms_meta[exec_state];\n\tconst struct etnaviv_pm_domain *dom;\n\n\tif (r->domain >= meta->nr_domains)\n\t\treturn -EINVAL;\n\n\tdom = meta->domains + r->domain;\n\n\tif (r->signal >= dom->nr_signals)\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nvoid etnaviv_perfmon_process(struct etnaviv_gpu *gpu,\n\tconst struct etnaviv_perfmon_request *pmr, u32 exec_state)\n{\n\tconst struct etnaviv_pm_domain_meta *meta = &doms_meta[exec_state];\n\tconst struct etnaviv_pm_domain *dom;\n\tconst struct etnaviv_pm_signal *sig;\n\tu32 *bo = pmr->bo_vma;\n\tu32 val;\n\n\tdom = meta->domains + pmr->domain;\n\tsig = &dom->signal[pmr->signal];\n\tval = sig->sample(gpu, dom, sig);\n\n\t*(bo + pmr->offset) = val;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}