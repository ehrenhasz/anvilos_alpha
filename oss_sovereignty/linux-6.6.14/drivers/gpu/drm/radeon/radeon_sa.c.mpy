{
  "module_name": "radeon_sa.c",
  "hash_id": "52c1fe53299f50f9cdc7b9fc46493d3495da9b970cad4b9f85c6ce57c7ae04f9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/radeon/radeon_sa.c",
  "human_readable_source": " \n \n \n\n#include \"radeon.h\"\n\nint radeon_sa_bo_manager_init(struct radeon_device *rdev,\n\t\t\t      struct radeon_sa_manager *sa_manager,\n\t\t\t      unsigned int size, u32 sa_align, u32 domain,\n\t\t\t      u32 flags)\n{\n\tint r;\n\n\tr = radeon_bo_create(rdev, size, RADEON_GPU_PAGE_SIZE, true,\n\t\t\t     domain, flags, NULL, NULL, &sa_manager->bo);\n\tif (r) {\n\t\tdev_err(rdev->dev, \"(%d) failed to allocate bo for manager\\n\", r);\n\t\treturn r;\n\t}\n\n\tsa_manager->domain = domain;\n\n\tdrm_suballoc_manager_init(&sa_manager->base, size, sa_align);\n\n\treturn r;\n}\n\nvoid radeon_sa_bo_manager_fini(struct radeon_device *rdev,\n\t\t\t       struct radeon_sa_manager *sa_manager)\n{\n\tdrm_suballoc_manager_fini(&sa_manager->base);\n\tradeon_bo_unref(&sa_manager->bo);\n}\n\nint radeon_sa_bo_manager_start(struct radeon_device *rdev,\n\t\t\t       struct radeon_sa_manager *sa_manager)\n{\n\tint r;\n\n\tif (sa_manager->bo == NULL) {\n\t\tdev_err(rdev->dev, \"no bo for sa manager\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tr = radeon_bo_reserve(sa_manager->bo, false);\n\tif (r) {\n\t\tdev_err(rdev->dev, \"(%d) failed to reserve manager bo\\n\", r);\n\t\treturn r;\n\t}\n\tr = radeon_bo_pin(sa_manager->bo, sa_manager->domain, &sa_manager->gpu_addr);\n\tif (r) {\n\t\tradeon_bo_unreserve(sa_manager->bo);\n\t\tdev_err(rdev->dev, \"(%d) failed to pin manager bo\\n\", r);\n\t\treturn r;\n\t}\n\tr = radeon_bo_kmap(sa_manager->bo, &sa_manager->cpu_ptr);\n\tradeon_bo_unreserve(sa_manager->bo);\n\treturn r;\n}\n\nint radeon_sa_bo_manager_suspend(struct radeon_device *rdev,\n\t\t\t\t struct radeon_sa_manager *sa_manager)\n{\n\tint r;\n\n\tif (sa_manager->bo == NULL) {\n\t\tdev_err(rdev->dev, \"no bo for sa manager\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tr = radeon_bo_reserve(sa_manager->bo, false);\n\tif (!r) {\n\t\tradeon_bo_kunmap(sa_manager->bo);\n\t\tradeon_bo_unpin(sa_manager->bo);\n\t\tradeon_bo_unreserve(sa_manager->bo);\n\t}\n\treturn r;\n}\n\nint radeon_sa_bo_new(struct radeon_sa_manager *sa_manager,\n\t\t     struct drm_suballoc **sa_bo,\n\t\t     unsigned int size, unsigned int align)\n{\n\tstruct drm_suballoc *sa = drm_suballoc_new(&sa_manager->base, size,\n\t\t\t\t\t\t   GFP_KERNEL, false, align);\n\n\tif (IS_ERR(sa)) {\n\t\t*sa_bo = NULL;\n\t\treturn PTR_ERR(sa);\n\t}\n\n\t*sa_bo = sa;\n\treturn 0;\n}\n\nvoid radeon_sa_bo_free(struct drm_suballoc **sa_bo,\n\t\t       struct radeon_fence *fence)\n{\n\tif (sa_bo == NULL || *sa_bo == NULL) {\n\t\treturn;\n\t}\n\n\tif (fence)\n\t\tdrm_suballoc_free(*sa_bo, &fence->base);\n\telse\n\t\tdrm_suballoc_free(*sa_bo, NULL);\n\n\t*sa_bo = NULL;\n}\n\n#if defined(CONFIG_DEBUG_FS)\nvoid radeon_sa_bo_dump_debug_info(struct radeon_sa_manager *sa_manager,\n\t\t\t\t  struct seq_file *m)\n{\n\tstruct drm_printer p = drm_seq_file_printer(m);\n\n\tdrm_suballoc_dump_debug_info(&sa_manager->base, &p, sa_manager->gpu_addr);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}