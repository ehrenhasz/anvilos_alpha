{
  "module_name": "ci_dpm.h",
  "hash_id": "e970fc04750fcb62bf23bd956fb28da12bf0e80b4255840c7c219f7a07141cda",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/radeon/ci_dpm.h",
  "human_readable_source": " \n#ifndef __CI_DPM_H__\n#define __CI_DPM_H__\n\n#include \"ppsmc.h\"\n#include \"radeon.h\"\n\n#define SMU__NUM_SCLK_DPM_STATE  8\n#define SMU__NUM_MCLK_DPM_LEVELS 6\n#define SMU__NUM_LCLK_DPM_LEVELS 8\n#define SMU__NUM_PCIE_DPM_LEVELS 8\n#include \"smu7_discrete.h\"\n\n#define CISLANDS_MAX_HARDWARE_POWERLEVELS 2\n\n#define CISLANDS_UNUSED_GPIO_PIN 0x7F\n\nstruct ci_pl {\n\tu32 mclk;\n\tu32 sclk;\n\tenum radeon_pcie_gen pcie_gen;\n\tu16 pcie_lane;\n};\n\nstruct ci_ps {\n\tu16 performance_level_count;\n\tbool dc_compatible;\n\tu32 sclk_t;\n\tstruct ci_pl performance_levels[CISLANDS_MAX_HARDWARE_POWERLEVELS];\n};\n\nstruct ci_dpm_level {\n\tbool enabled;\n\tu32 value;\n\tu32 param1;\n};\n\n#define CISLAND_MAX_DEEPSLEEP_DIVIDER_ID 5\n#define MAX_REGULAR_DPM_NUMBER 8\n#define CISLAND_MINIMUM_ENGINE_CLOCK 800\n\nstruct ci_single_dpm_table {\n\tu32 count;\n\tstruct ci_dpm_level dpm_levels[MAX_REGULAR_DPM_NUMBER];\n};\n\nstruct ci_dpm_table {\n\tstruct ci_single_dpm_table sclk_table;\n\tstruct ci_single_dpm_table mclk_table;\n\tstruct ci_single_dpm_table pcie_speed_table;\n\tstruct ci_single_dpm_table vddc_table;\n\tstruct ci_single_dpm_table vddci_table;\n\tstruct ci_single_dpm_table mvdd_table;\n};\n\nstruct ci_mc_reg_entry {\n\tu32 mclk_max;\n\tu32 mc_data[SMU7_DISCRETE_MC_REGISTER_ARRAY_SIZE];\n};\n\nstruct ci_mc_reg_table {\n\tu8 last;\n\tu8 num_entries;\n\tu16 valid_flag;\n\tstruct ci_mc_reg_entry mc_reg_table_entry[MAX_AC_TIMING_ENTRIES];\n\tSMU7_Discrete_MCRegisterAddress mc_reg_address[SMU7_DISCRETE_MC_REGISTER_ARRAY_SIZE];\n};\n\nstruct ci_ulv_parm\n{\n\tbool supported;\n\tu32 cg_ulv_parameter;\n\tu32 volt_change_delay;\n\tstruct ci_pl pl;\n};\n\n#define CISLANDS_MAX_LEAKAGE_COUNT  8\n\nstruct ci_leakage_voltage {\n\tu16 count;\n\tu16 leakage_id[CISLANDS_MAX_LEAKAGE_COUNT];\n\tu16 actual_voltage[CISLANDS_MAX_LEAKAGE_COUNT];\n};\n\nstruct ci_dpm_level_enable_mask {\n\tu32 uvd_dpm_enable_mask;\n\tu32 vce_dpm_enable_mask;\n\tu32 acp_dpm_enable_mask;\n\tu32 samu_dpm_enable_mask;\n\tu32 sclk_dpm_enable_mask;\n\tu32 mclk_dpm_enable_mask;\n\tu32 pcie_dpm_enable_mask;\n};\n\nstruct ci_vbios_boot_state\n{\n\tu16 mvdd_bootup_value;\n\tu16 vddc_bootup_value;\n\tu16 vddci_bootup_value;\n\tu32 sclk_bootup_value;\n\tu32 mclk_bootup_value;\n\tu16 pcie_gen_bootup_value;\n\tu16 pcie_lane_bootup_value;\n};\n\nstruct ci_clock_registers {\n\tu32 cg_spll_func_cntl;\n\tu32 cg_spll_func_cntl_2;\n\tu32 cg_spll_func_cntl_3;\n\tu32 cg_spll_func_cntl_4;\n\tu32 cg_spll_spread_spectrum;\n\tu32 cg_spll_spread_spectrum_2;\n\tu32 dll_cntl;\n\tu32 mclk_pwrmgt_cntl;\n\tu32 mpll_ad_func_cntl;\n\tu32 mpll_dq_func_cntl;\n\tu32 mpll_func_cntl;\n\tu32 mpll_func_cntl_1;\n\tu32 mpll_func_cntl_2;\n\tu32 mpll_ss1;\n\tu32 mpll_ss2;\n};\n\nstruct ci_thermal_temperature_setting {\n\ts32 temperature_low;\n\ts32 temperature_high;\n\ts32 temperature_shutdown;\n};\n\nstruct ci_pcie_perf_range {\n\tu16 max;\n\tu16 min;\n};\n\nenum ci_pt_config_reg_type {\n\tCISLANDS_CONFIGREG_MMR = 0,\n\tCISLANDS_CONFIGREG_SMC_IND,\n\tCISLANDS_CONFIGREG_DIDT_IND,\n\tCISLANDS_CONFIGREG_CACHE,\n\tCISLANDS_CONFIGREG_MAX\n};\n\n#define POWERCONTAINMENT_FEATURE_BAPM            0x00000001\n#define POWERCONTAINMENT_FEATURE_TDCLimit        0x00000002\n#define POWERCONTAINMENT_FEATURE_PkgPwrLimit     0x00000004\n\nstruct ci_pt_config_reg {\n\tu32 offset;\n\tu32 mask;\n\tu32 shift;\n\tu32 value;\n\tenum ci_pt_config_reg_type type;\n};\n\nstruct ci_pt_defaults {\n\tu8 svi_load_line_en;\n\tu8 svi_load_line_vddc;\n\tu8 tdc_vddc_throttle_release_limit_perc;\n\tu8 tdc_mawt;\n\tu8 tdc_waterfall_ctl;\n\tu8 dte_ambient_temp_base;\n\tu32 display_cac;\n\tu32 bapm_temp_gradient;\n\tu16 bapmti_r[SMU7_DTE_ITERATIONS * SMU7_DTE_SOURCES * SMU7_DTE_SINKS];\n\tu16 bapmti_rc[SMU7_DTE_ITERATIONS * SMU7_DTE_SOURCES * SMU7_DTE_SINKS];\n};\n\n#define DPMTABLE_OD_UPDATE_SCLK     0x00000001\n#define DPMTABLE_OD_UPDATE_MCLK     0x00000002\n#define DPMTABLE_UPDATE_SCLK        0x00000004\n#define DPMTABLE_UPDATE_MCLK        0x00000008\n\nstruct ci_power_info {\n\tstruct ci_dpm_table dpm_table;\n\tu32 voltage_control;\n\tu32 mvdd_control;\n\tu32 vddci_control;\n\tu32 active_auto_throttle_sources;\n\tstruct ci_clock_registers clock_registers;\n\tu16 acpi_vddc;\n\tu16 acpi_vddci;\n\tenum radeon_pcie_gen force_pcie_gen;\n\tenum radeon_pcie_gen acpi_pcie_gen;\n\tstruct ci_leakage_voltage vddc_leakage;\n\tstruct ci_leakage_voltage vddci_leakage;\n\tu16 max_vddc_in_pp_table;\n\tu16 min_vddc_in_pp_table;\n\tu16 max_vddci_in_pp_table;\n\tu16 min_vddci_in_pp_table;\n\tu32 mclk_strobe_mode_threshold;\n\tu32 mclk_stutter_mode_threshold;\n\tu32 mclk_edc_enable_threshold;\n\tu32 mclk_edc_wr_enable_threshold;\n\tstruct ci_vbios_boot_state vbios_boot_state;\n\t \n\tu32 sram_end;\n\tu32 dpm_table_start;\n\tu32 soft_regs_start;\n\tu32 mc_reg_table_start;\n\tu32 fan_table_start;\n\tu32 arb_table_start;\n\t \n\tSMU7_Discrete_DpmTable smc_state_table;\n\tSMU7_Discrete_MCRegisters smc_mc_reg_table;\n\tSMU7_Discrete_PmFuses smc_powertune_table;\n\t \n\tstruct ci_mc_reg_table mc_reg_table;\n\tstruct atom_voltage_table vddc_voltage_table;\n\tstruct atom_voltage_table vddci_voltage_table;\n\tstruct atom_voltage_table mvdd_voltage_table;\n\tstruct ci_ulv_parm ulv;\n\tu32 power_containment_features;\n\tconst struct ci_pt_defaults *powertune_defaults;\n\tu32 dte_tj_offset;\n\tbool vddc_phase_shed_control;\n\tstruct ci_thermal_temperature_setting thermal_temp_setting;\n\tstruct ci_dpm_level_enable_mask dpm_level_enable_mask;\n\tu32 need_update_smu7_dpm_table;\n\tu32 sclk_dpm_key_disabled;\n\tu32 mclk_dpm_key_disabled;\n\tu32 pcie_dpm_key_disabled;\n\tu32 thermal_sclk_dpm_enabled;\n\tstruct ci_pcie_perf_range pcie_gen_performance;\n\tstruct ci_pcie_perf_range pcie_lane_performance;\n\tstruct ci_pcie_perf_range pcie_gen_powersaving;\n\tstruct ci_pcie_perf_range pcie_lane_powersaving;\n\tu32 activity_target[SMU7_MAX_LEVELS_GRAPHICS];\n\tu32 mclk_activity_target;\n\tu32 low_sclk_interrupt_t;\n\tu32 last_mclk_dpm_enable_mask;\n\tu32 sys_pcie_mask;\n\t \n\tbool caps_power_containment;\n\tbool caps_cac;\n\tbool caps_sq_ramping;\n\tbool caps_db_ramping;\n\tbool caps_td_ramping;\n\tbool caps_tcp_ramping;\n\tbool caps_fps;\n\tbool caps_sclk_ds;\n\tbool caps_sclk_ss_support;\n\tbool caps_mclk_ss_support;\n\tbool caps_uvd_dpm;\n\tbool caps_vce_dpm;\n\tbool caps_samu_dpm;\n\tbool caps_acp_dpm;\n\tbool caps_automatic_dc_transition;\n\tbool caps_sclk_throttle_low_notification;\n\tbool caps_dynamic_ac_timing;\n\tbool caps_od_fuzzy_fan_control_support;\n\t \n\tbool thermal_protection;\n\tbool pcie_performance_request;\n\tbool dynamic_ss;\n\tbool dll_default_on;\n\tbool cac_enabled;\n\tbool uvd_enabled;\n\tbool battery_state;\n\tbool pspp_notify_required;\n\tbool mem_gddr5;\n\tbool enable_bapm_feature;\n\tbool enable_tdc_limit_feature;\n\tbool enable_pkg_pwr_tracking_feature;\n\tbool use_pcie_performance_levels;\n\tbool use_pcie_powersaving_levels;\n\tbool uvd_power_gated;\n\t \n\tstruct radeon_ps current_rps;\n\tstruct ci_ps current_ps;\n\tstruct radeon_ps requested_rps;\n\tstruct ci_ps requested_ps;\n\t \n\tbool fan_ctrl_is_in_default_mode;\n\tbool fan_is_controlled_by_smc;\n\tu32 t_min;\n\tu32 fan_ctrl_default_mode;\n};\n\n#define CISLANDS_VOLTAGE_CONTROL_NONE                   0x0\n#define CISLANDS_VOLTAGE_CONTROL_BY_GPIO                0x1\n#define CISLANDS_VOLTAGE_CONTROL_BY_SVID2               0x2\n\n#define CISLANDS_Q88_FORMAT_CONVERSION_UNIT             256\n\n#define CISLANDS_VRC_DFLT0                              0x3FFFC000\n#define CISLANDS_VRC_DFLT1                              0x000400\n#define CISLANDS_VRC_DFLT2                              0xC00080\n#define CISLANDS_VRC_DFLT3                              0xC00200\n#define CISLANDS_VRC_DFLT4                              0xC01680\n#define CISLANDS_VRC_DFLT5                              0xC00033\n#define CISLANDS_VRC_DFLT6                              0xC00033\n#define CISLANDS_VRC_DFLT7                              0x3FFFC000\n\n#define CISLANDS_CGULVPARAMETER_DFLT                    0x00040035\n#define CISLAND_TARGETACTIVITY_DFLT                     30\n#define CISLAND_MCLK_TARGETACTIVITY_DFLT                10\n\n#define PCIE_PERF_REQ_REMOVE_REGISTRY   0\n#define PCIE_PERF_REQ_FORCE_LOWPOWER    1\n#define PCIE_PERF_REQ_PECI_GEN1         2\n#define PCIE_PERF_REQ_PECI_GEN2         3\n#define PCIE_PERF_REQ_PECI_GEN3         4\n\nint ci_copy_bytes_to_smc(struct radeon_device *rdev,\n\t\t\t u32 smc_start_address,\n\t\t\t const u8 *src, u32 byte_count, u32 limit);\nvoid ci_start_smc(struct radeon_device *rdev);\nvoid ci_reset_smc(struct radeon_device *rdev);\nint ci_program_jump_on_start(struct radeon_device *rdev);\nvoid ci_stop_smc_clock(struct radeon_device *rdev);\nvoid ci_start_smc_clock(struct radeon_device *rdev);\nbool ci_is_smc_running(struct radeon_device *rdev);\nPPSMC_Result ci_wait_for_smc_inactive(struct radeon_device *rdev);\nint ci_load_smc_ucode(struct radeon_device *rdev, u32 limit);\nint ci_read_smc_sram_dword(struct radeon_device *rdev,\n\t\t\t   u32 smc_address, u32 *value, u32 limit);\nint ci_write_smc_sram_dword(struct radeon_device *rdev,\n\t\t\t    u32 smc_address, u32 value, u32 limit);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}