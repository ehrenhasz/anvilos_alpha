{
  "module_name": "radeon_semaphore.c",
  "hash_id": "083f998db9b45b18b3a0d47741b954728f816e99155085f2fa56b555997d8afc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/radeon/radeon_semaphore.c",
  "human_readable_source": " \n \n\n#include \"radeon.h\"\n#include \"radeon_trace.h\"\n\nint radeon_semaphore_create(struct radeon_device *rdev,\n\t\t\t    struct radeon_semaphore **semaphore)\n{\n\tint r;\n\n\t*semaphore = kmalloc(sizeof(struct radeon_semaphore), GFP_KERNEL);\n\tif (*semaphore == NULL) {\n\t\treturn -ENOMEM;\n\t}\n\tr = radeon_sa_bo_new(&rdev->ring_tmp_bo,\n\t\t\t     &(*semaphore)->sa_bo, 8, 8);\n\tif (r) {\n\t\tkfree(*semaphore);\n\t\t*semaphore = NULL;\n\t\treturn r;\n\t}\n\t(*semaphore)->waiters = 0;\n\t(*semaphore)->gpu_addr = radeon_sa_bo_gpu_addr((*semaphore)->sa_bo);\n\n\t*((uint64_t *)radeon_sa_bo_cpu_addr((*semaphore)->sa_bo)) = 0;\n\n\treturn 0;\n}\n\nbool radeon_semaphore_emit_signal(struct radeon_device *rdev, int ridx,\n\t\t\t\t  struct radeon_semaphore *semaphore)\n{\n\tstruct radeon_ring *ring = &rdev->ring[ridx];\n\n\ttrace_radeon_semaphore_signale(ridx, semaphore);\n\n\tif (radeon_semaphore_ring_emit(rdev, ridx, ring, semaphore, false)) {\n\t\t--semaphore->waiters;\n\n\t\t \n\t\tring->last_semaphore_signal_addr = semaphore->gpu_addr;\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nbool radeon_semaphore_emit_wait(struct radeon_device *rdev, int ridx,\n\t\t\t\tstruct radeon_semaphore *semaphore)\n{\n\tstruct radeon_ring *ring = &rdev->ring[ridx];\n\n\ttrace_radeon_semaphore_wait(ridx, semaphore);\n\n\tif (radeon_semaphore_ring_emit(rdev, ridx, ring, semaphore, true)) {\n\t\t++semaphore->waiters;\n\n\t\t \n\t\tring->last_semaphore_wait_addr = semaphore->gpu_addr;\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nvoid radeon_semaphore_free(struct radeon_device *rdev,\n\t\t\t   struct radeon_semaphore **semaphore,\n\t\t\t   struct radeon_fence *fence)\n{\n\tif (semaphore == NULL || *semaphore == NULL) {\n\t\treturn;\n\t}\n\tif ((*semaphore)->waiters > 0) {\n\t\tdev_err(rdev->dev, \"semaphore %p has more waiters than signalers,\"\n\t\t\t\" hardware lockup imminent!\\n\", *semaphore);\n\t}\n\tradeon_sa_bo_free(&(*semaphore)->sa_bo, fence);\n\tkfree(*semaphore);\n\t*semaphore = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}