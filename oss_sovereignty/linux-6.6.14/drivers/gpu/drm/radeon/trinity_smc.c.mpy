{
  "module_name": "trinity_smc.c",
  "hash_id": "6aff05a449a958d5f1df6fb022f0ecceaa1481c23d52ee5ccae6988a0eaad95b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/radeon/trinity_smc.c",
  "human_readable_source": " \n\n#include \"radeon.h\"\n#include \"trinityd.h\"\n#include \"trinity_dpm.h\"\n#include \"ppsmc.h\"\n\nstatic int trinity_notify_message_to_smu(struct radeon_device *rdev, u32 id)\n{\n\tint i;\n\tu32 v = 0;\n\n\tWREG32(SMC_MESSAGE_0, id);\n\tfor (i = 0; i < rdev->usec_timeout; i++) {\n\t\tif (RREG32(SMC_RESP_0) != 0)\n\t\t\tbreak;\n\t\tudelay(1);\n\t}\n\tv = RREG32(SMC_RESP_0);\n\n\tif (v != 1) {\n\t\tif (v == 0xFF) {\n\t\t\tDRM_ERROR(\"SMC failed to handle the message!\\n\");\n\t\t\treturn -EINVAL;\n\t\t} else if (v == 0xFE) {\n\t\t\tDRM_ERROR(\"Unknown SMC message!\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nint trinity_dpm_bapm_enable(struct radeon_device *rdev, bool enable)\n{\n\tif (enable)\n\t\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_EnableBAPM);\n\telse\n\t\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DisableBAPM);\n}\n\nint trinity_dpm_config(struct radeon_device *rdev, bool enable)\n{\n\tif (enable)\n\t\tWREG32_SMC(SMU_SCRATCH0, 1);\n\telse\n\t\tWREG32_SMC(SMU_SCRATCH0, 0);\n\n\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DPM_Config);\n}\n\nint trinity_dpm_force_state(struct radeon_device *rdev, u32 n)\n{\n\tWREG32_SMC(SMU_SCRATCH0, n);\n\n\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DPM_ForceState);\n}\n\nint trinity_dpm_n_levels_disabled(struct radeon_device *rdev, u32 n)\n{\n\tWREG32_SMC(SMU_SCRATCH0, n);\n\n\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DPM_N_LevelsDisabled);\n}\n\nint trinity_uvd_dpm_config(struct radeon_device *rdev)\n{\n\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_UVD_DPM_Config);\n}\n\nint trinity_dpm_no_forced_level(struct radeon_device *rdev)\n{\n\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_NoForcedLevel);\n}\n\nint trinity_dce_enable_voltage_adjustment(struct radeon_device *rdev,\n\t\t\t\t\t  bool enable)\n{\n\tif (enable)\n\t\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DCE_AllowVoltageAdjustment);\n\telse\n\t\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_DCE_RemoveVoltageAdjustment);\n}\n\nint trinity_gfx_dynamic_mgpg_config(struct radeon_device *rdev)\n{\n\treturn trinity_notify_message_to_smu(rdev, PPSMC_MSG_PG_SIMD_Config);\n}\n\nvoid trinity_acquire_mutex(struct radeon_device *rdev)\n{\n\tint i;\n\n\tWREG32(SMC_INT_REQ, 1);\n\tfor (i = 0; i < rdev->usec_timeout; i++) {\n\t\tif ((RREG32(SMC_INT_REQ) & 0xffff) == 1)\n\t\t\tbreak;\n\t\tudelay(1);\n\t}\n}\n\nvoid trinity_release_mutex(struct radeon_device *rdev)\n{\n\tWREG32(SMC_INT_REQ, 0);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}