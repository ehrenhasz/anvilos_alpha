{
  "module_name": "rv730_dpm.c",
  "hash_id": "fc9f93cfc060c26ea52c9dd34b2396265be29f69ff8a6c95ef97c7ccd505d907",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/radeon/rv730_dpm.c",
  "human_readable_source": " \n\n#include \"radeon.h\"\n#include \"rv730d.h\"\n#include \"r600_dpm.h\"\n#include \"rv770.h\"\n#include \"rv770_dpm.h\"\n#include \"atom.h\"\n\n#define MC_CG_ARB_FREQ_F0           0x0a\n#define MC_CG_ARB_FREQ_F1           0x0b\n#define MC_CG_ARB_FREQ_F2           0x0c\n#define MC_CG_ARB_FREQ_F3           0x0d\n\nint rv730_populate_sclk_value(struct radeon_device *rdev,\n\t\t\t      u32 engine_clock,\n\t\t\t      RV770_SMC_SCLK_VALUE *sclk)\n{\n\tstruct rv7xx_power_info *pi = rv770_get_pi(rdev);\n\tstruct atom_clock_dividers dividers;\n\tu32 spll_func_cntl = pi->clk_regs.rv730.cg_spll_func_cntl;\n\tu32 spll_func_cntl_2 = pi->clk_regs.rv730.cg_spll_func_cntl_2;\n\tu32 spll_func_cntl_3 = pi->clk_regs.rv730.cg_spll_func_cntl_3;\n\tu32 cg_spll_spread_spectrum = pi->clk_regs.rv730.cg_spll_spread_spectrum;\n\tu32 cg_spll_spread_spectrum_2 = pi->clk_regs.rv730.cg_spll_spread_spectrum_2;\n\tu64 tmp;\n\tu32 reference_clock = rdev->clock.spll.reference_freq;\n\tu32 reference_divider, post_divider;\n\tu32 fbdiv;\n\tint ret;\n\n\tret = radeon_atom_get_clock_dividers(rdev, COMPUTE_ENGINE_PLL_PARAM,\n\t\t\t\t\t     engine_clock, false, &dividers);\n\tif (ret)\n\t\treturn ret;\n\n\treference_divider = 1 + dividers.ref_div;\n\n\tif (dividers.enable_post_div)\n\t\tpost_divider = ((dividers.post_div >> 4) & 0xf) +\n\t\t\t(dividers.post_div & 0xf) + 2;\n\telse\n\t\tpost_divider = 1;\n\n\ttmp = (u64) engine_clock * reference_divider * post_divider * 16384;\n\tdo_div(tmp, reference_clock);\n\tfbdiv = (u32) tmp;\n\n\t \n\tif (dividers.enable_post_div)\n\t\tspll_func_cntl |= SPLL_DIVEN;\n\telse\n\t\tspll_func_cntl &= ~SPLL_DIVEN;\n\tspll_func_cntl &= ~(SPLL_HILEN_MASK | SPLL_LOLEN_MASK | SPLL_REF_DIV_MASK);\n\tspll_func_cntl |= SPLL_REF_DIV(dividers.ref_div);\n\tspll_func_cntl |= SPLL_HILEN((dividers.post_div >> 4) & 0xf);\n\tspll_func_cntl |= SPLL_LOLEN(dividers.post_div & 0xf);\n\n\tspll_func_cntl_2 &= ~SCLK_MUX_SEL_MASK;\n\tspll_func_cntl_2 |= SCLK_MUX_SEL(2);\n\n\tspll_func_cntl_3 &= ~SPLL_FB_DIV_MASK;\n\tspll_func_cntl_3 |= SPLL_FB_DIV(fbdiv);\n\tspll_func_cntl_3 |= SPLL_DITHEN;\n\n\tif (pi->sclk_ss) {\n\t\tstruct radeon_atom_ss ss;\n\t\tu32 vco_freq = engine_clock * post_divider;\n\n\t\tif (radeon_atombios_get_asic_ss_info(rdev, &ss,\n\t\t\t\t\t\t     ASIC_INTERNAL_ENGINE_SS, vco_freq)) {\n\t\t\tu32 clk_s = reference_clock * 5 / (reference_divider * ss.rate);\n\t\t\tu32 clk_v = ss.percentage * fbdiv / (clk_s * 10000);\n\n\t\t\tcg_spll_spread_spectrum &= ~CLK_S_MASK;\n\t\t\tcg_spll_spread_spectrum |= CLK_S(clk_s);\n\t\t\tcg_spll_spread_spectrum |= SSEN;\n\n\t\t\tcg_spll_spread_spectrum_2 &= ~CLK_V_MASK;\n\t\t\tcg_spll_spread_spectrum_2 |= CLK_V(clk_v);\n\t\t}\n\t}\n\n\tsclk->sclk_value = cpu_to_be32(engine_clock);\n\tsclk->vCG_SPLL_FUNC_CNTL = cpu_to_be32(spll_func_cntl);\n\tsclk->vCG_SPLL_FUNC_CNTL_2 = cpu_to_be32(spll_func_cntl_2);\n\tsclk->vCG_SPLL_FUNC_CNTL_3 = cpu_to_be32(spll_func_cntl_3);\n\tsclk->vCG_SPLL_SPREAD_SPECTRUM = cpu_to_be32(cg_spll_spread_spectrum);\n\tsclk->vCG_SPLL_SPREAD_SPECTRUM_2 = cpu_to_be32(cg_spll_spread_spectrum_2);\n\n\treturn 0;\n}\n\nint rv730_populate_mclk_value(struct radeon_device *rdev,\n\t\t\t      u32 engine_clock, u32 memory_clock,\n\t\t\t      LPRV7XX_SMC_MCLK_VALUE mclk)\n{\n\tstruct rv7xx_power_info *pi = rv770_get_pi(rdev);\n\tu32 mclk_pwrmgt_cntl = pi->clk_regs.rv730.mclk_pwrmgt_cntl;\n\tu32 dll_cntl = pi->clk_regs.rv730.dll_cntl;\n\tu32 mpll_func_cntl = pi->clk_regs.rv730.mpll_func_cntl;\n\tu32 mpll_func_cntl_2 = pi->clk_regs.rv730.mpll_func_cntl2;\n\tu32 mpll_func_cntl_3 = pi->clk_regs.rv730.mpll_func_cntl3;\n\tu32 mpll_ss = pi->clk_regs.rv730.mpll_ss;\n\tu32 mpll_ss2 = pi->clk_regs.rv730.mpll_ss2;\n\tstruct atom_clock_dividers dividers;\n\tu32 post_divider, reference_divider;\n\tint ret;\n\n\tret = radeon_atom_get_clock_dividers(rdev, COMPUTE_MEMORY_PLL_PARAM,\n\t\t\t\t\t     memory_clock, false, &dividers);\n\tif (ret)\n\t\treturn ret;\n\n\treference_divider = dividers.ref_div + 1;\n\n\tif (dividers.enable_post_div)\n\t\tpost_divider = ((dividers.post_div >> 4) & 0xf) +\n\t\t\t(dividers.post_div & 0xf) + 2;\n\telse\n\t\tpost_divider = 1;\n\n\t \n\tif (dividers.enable_post_div)\n\t\tmpll_func_cntl |= MPLL_DIVEN;\n\telse\n\t\tmpll_func_cntl &= ~MPLL_DIVEN;\n\n\tmpll_func_cntl &= ~(MPLL_REF_DIV_MASK | MPLL_HILEN_MASK | MPLL_LOLEN_MASK);\n\tmpll_func_cntl |= MPLL_REF_DIV(dividers.ref_div);\n\tmpll_func_cntl |= MPLL_HILEN((dividers.post_div >> 4) & 0xf);\n\tmpll_func_cntl |= MPLL_LOLEN(dividers.post_div & 0xf);\n\n\tmpll_func_cntl_3 &= ~MPLL_FB_DIV_MASK;\n\tmpll_func_cntl_3 |= MPLL_FB_DIV(dividers.fb_div);\n\tif (dividers.enable_dithen)\n\t\tmpll_func_cntl_3 |= MPLL_DITHEN;\n\telse\n\t\tmpll_func_cntl_3 &= ~MPLL_DITHEN;\n\n\tif (pi->mclk_ss) {\n\t\tstruct radeon_atom_ss ss;\n\t\tu32 vco_freq = memory_clock * post_divider;\n\n\t\tif (radeon_atombios_get_asic_ss_info(rdev, &ss,\n\t\t\t\t\t\t     ASIC_INTERNAL_MEMORY_SS, vco_freq)) {\n\t\t\tu32 reference_clock = rdev->clock.mpll.reference_freq;\n\t\t\tu32 clk_s = reference_clock * 5 / (reference_divider * ss.rate);\n\t\t\tu32 clk_v = ss.percentage * dividers.fb_div / (clk_s * 10000);\n\n\t\t\tmpll_ss &= ~CLK_S_MASK;\n\t\t\tmpll_ss |= CLK_S(clk_s);\n\t\t\tmpll_ss |= SSEN;\n\n\t\t\tmpll_ss2 &= ~CLK_V_MASK;\n\t\t\tmpll_ss |= CLK_V(clk_v);\n\t\t}\n\t}\n\n\n\tmclk->mclk730.vMCLK_PWRMGT_CNTL = cpu_to_be32(mclk_pwrmgt_cntl);\n\tmclk->mclk730.vDLL_CNTL = cpu_to_be32(dll_cntl);\n\tmclk->mclk730.mclk_value = cpu_to_be32(memory_clock);\n\tmclk->mclk730.vMPLL_FUNC_CNTL = cpu_to_be32(mpll_func_cntl);\n\tmclk->mclk730.vMPLL_FUNC_CNTL2 = cpu_to_be32(mpll_func_cntl_2);\n\tmclk->mclk730.vMPLL_FUNC_CNTL3 = cpu_to_be32(mpll_func_cntl_3);\n\tmclk->mclk730.vMPLL_SS = cpu_to_be32(mpll_ss);\n\tmclk->mclk730.vMPLL_SS2 = cpu_to_be32(mpll_ss2);\n\n\treturn 0;\n}\n\nvoid rv730_read_clock_registers(struct radeon_device *rdev)\n{\n\tstruct rv7xx_power_info *pi = rv770_get_pi(rdev);\n\n\tpi->clk_regs.rv730.cg_spll_func_cntl =\n\t\tRREG32(CG_SPLL_FUNC_CNTL);\n\tpi->clk_regs.rv730.cg_spll_func_cntl_2 =\n\t\tRREG32(CG_SPLL_FUNC_CNTL_2);\n\tpi->clk_regs.rv730.cg_spll_func_cntl_3 =\n\t\tRREG32(CG_SPLL_FUNC_CNTL_3);\n\tpi->clk_regs.rv730.cg_spll_spread_spectrum =\n\t\tRREG32(CG_SPLL_SPREAD_SPECTRUM);\n\tpi->clk_regs.rv730.cg_spll_spread_spectrum_2 =\n\t\tRREG32(CG_SPLL_SPREAD_SPECTRUM_2);\n\n\tpi->clk_regs.rv730.mclk_pwrmgt_cntl =\n\t\tRREG32(TCI_MCLK_PWRMGT_CNTL);\n\tpi->clk_regs.rv730.dll_cntl =\n\t\tRREG32(TCI_DLL_CNTL);\n\tpi->clk_regs.rv730.mpll_func_cntl =\n\t\tRREG32(CG_MPLL_FUNC_CNTL);\n\tpi->clk_regs.rv730.mpll_func_cntl2 =\n\t\tRREG32(CG_MPLL_FUNC_CNTL_2);\n\tpi->clk_regs.rv730.mpll_func_cntl3 =\n\t\tRREG32(CG_MPLL_FUNC_CNTL_3);\n\tpi->clk_regs.rv730.mpll_ss =\n\t\tRREG32(CG_TCI_MPLL_SPREAD_SPECTRUM);\n\tpi->clk_regs.rv730.mpll_ss2 =\n\t\tRREG32(CG_TCI_MPLL_SPREAD_SPECTRUM_2);\n}\n\nint rv730_populate_smc_acpi_state(struct radeon_device *rdev,\n\t\t\t\t  RV770_SMC_STATETABLE *table)\n{\n\tstruct rv7xx_power_info *pi = rv770_get_pi(rdev);\n\tu32 mpll_func_cntl = 0;\n\tu32 mpll_func_cntl_2 = 0 ;\n\tu32 mpll_func_cntl_3 = 0;\n\tu32 mclk_pwrmgt_cntl;\n\tu32 dll_cntl;\n\tu32 spll_func_cntl;\n\tu32 spll_func_cntl_2;\n\tu32 spll_func_cntl_3;\n\n\ttable->ACPIState = table->initialState;\n\ttable->ACPIState.flags &= ~PPSMC_SWSTATE_FLAG_DC;\n\n\tif (pi->acpi_vddc) {\n\t\trv770_populate_vddc_value(rdev, pi->acpi_vddc,\n\t\t\t\t\t  &table->ACPIState.levels[0].vddc);\n\t\ttable->ACPIState.levels[0].gen2PCIE = pi->pcie_gen2 ?\n\t\t\tpi->acpi_pcie_gen2 : 0;\n\t\ttable->ACPIState.levels[0].gen2XSP =\n\t\t\tpi->acpi_pcie_gen2;\n\t} else {\n\t\trv770_populate_vddc_value(rdev, pi->min_vddc_in_table,\n\t\t\t\t\t  &table->ACPIState.levels[0].vddc);\n\t\ttable->ACPIState.levels[0].gen2PCIE = 0;\n\t}\n\n\tmpll_func_cntl = pi->clk_regs.rv730.mpll_func_cntl;\n\tmpll_func_cntl_2 = pi->clk_regs.rv730.mpll_func_cntl2;\n\tmpll_func_cntl_3 = pi->clk_regs.rv730.mpll_func_cntl3;\n\n\tmpll_func_cntl |= MPLL_RESET | MPLL_BYPASS_EN;\n\tmpll_func_cntl &= ~MPLL_SLEEP;\n\n\tmpll_func_cntl_2 &= ~MCLK_MUX_SEL_MASK;\n\tmpll_func_cntl_2 |= MCLK_MUX_SEL(1);\n\n\tmclk_pwrmgt_cntl = (MRDCKA_RESET |\n\t\t\t    MRDCKB_RESET |\n\t\t\t    MRDCKC_RESET |\n\t\t\t    MRDCKD_RESET |\n\t\t\t    MRDCKE_RESET |\n\t\t\t    MRDCKF_RESET |\n\t\t\t    MRDCKG_RESET |\n\t\t\t    MRDCKH_RESET |\n\t\t\t    MRDCKA_SLEEP |\n\t\t\t    MRDCKB_SLEEP |\n\t\t\t    MRDCKC_SLEEP |\n\t\t\t    MRDCKD_SLEEP |\n\t\t\t    MRDCKE_SLEEP |\n\t\t\t    MRDCKF_SLEEP |\n\t\t\t    MRDCKG_SLEEP |\n\t\t\t    MRDCKH_SLEEP);\n\n\tdll_cntl = 0xff000000;\n\n\tspll_func_cntl = pi->clk_regs.rv730.cg_spll_func_cntl;\n\tspll_func_cntl_2 = pi->clk_regs.rv730.cg_spll_func_cntl_2;\n\tspll_func_cntl_3 = pi->clk_regs.rv730.cg_spll_func_cntl_3;\n\n\tspll_func_cntl |= SPLL_RESET | SPLL_BYPASS_EN;\n\tspll_func_cntl &= ~SPLL_SLEEP;\n\n\tspll_func_cntl_2 &= ~SCLK_MUX_SEL_MASK;\n\tspll_func_cntl_2 |= SCLK_MUX_SEL(4);\n\n\ttable->ACPIState.levels[0].mclk.mclk730.vMPLL_FUNC_CNTL = cpu_to_be32(mpll_func_cntl);\n\ttable->ACPIState.levels[0].mclk.mclk730.vMPLL_FUNC_CNTL2 = cpu_to_be32(mpll_func_cntl_2);\n\ttable->ACPIState.levels[0].mclk.mclk730.vMPLL_FUNC_CNTL3 = cpu_to_be32(mpll_func_cntl_3);\n\ttable->ACPIState.levels[0].mclk.mclk730.vMCLK_PWRMGT_CNTL = cpu_to_be32(mclk_pwrmgt_cntl);\n\ttable->ACPIState.levels[0].mclk.mclk730.vDLL_CNTL = cpu_to_be32(dll_cntl);\n\n\ttable->ACPIState.levels[0].mclk.mclk730.mclk_value = 0;\n\n\ttable->ACPIState.levels[0].sclk.vCG_SPLL_FUNC_CNTL = cpu_to_be32(spll_func_cntl);\n\ttable->ACPIState.levels[0].sclk.vCG_SPLL_FUNC_CNTL_2 = cpu_to_be32(spll_func_cntl_2);\n\ttable->ACPIState.levels[0].sclk.vCG_SPLL_FUNC_CNTL_3 = cpu_to_be32(spll_func_cntl_3);\n\n\ttable->ACPIState.levels[0].sclk.sclk_value = 0;\n\n\trv770_populate_mvdd_value(rdev, 0, &table->ACPIState.levels[0].mvdd);\n\n\ttable->ACPIState.levels[1] = table->ACPIState.levels[0];\n\ttable->ACPIState.levels[2] = table->ACPIState.levels[0];\n\n\treturn 0;\n}\n\nint rv730_populate_smc_initial_state(struct radeon_device *rdev,\n\t\t\t\t     struct radeon_ps *radeon_state,\n\t\t\t\t     RV770_SMC_STATETABLE *table)\n{\n\tstruct rv7xx_ps *initial_state = rv770_get_ps(radeon_state);\n\tstruct rv7xx_power_info *pi = rv770_get_pi(rdev);\n\tu32 a_t;\n\n\ttable->initialState.levels[0].mclk.mclk730.vMPLL_FUNC_CNTL =\n\t\tcpu_to_be32(pi->clk_regs.rv730.mpll_func_cntl);\n\ttable->initialState.levels[0].mclk.mclk730.vMPLL_FUNC_CNTL2 =\n\t\tcpu_to_be32(pi->clk_regs.rv730.mpll_func_cntl2);\n\ttable->initialState.levels[0].mclk.mclk730.vMPLL_FUNC_CNTL3 =\n\t\tcpu_to_be32(pi->clk_regs.rv730.mpll_func_cntl3);\n\ttable->initialState.levels[0].mclk.mclk730.vMCLK_PWRMGT_CNTL =\n\t\tcpu_to_be32(pi->clk_regs.rv730.mclk_pwrmgt_cntl);\n\ttable->initialState.levels[0].mclk.mclk730.vDLL_CNTL =\n\t\tcpu_to_be32(pi->clk_regs.rv730.dll_cntl);\n\ttable->initialState.levels[0].mclk.mclk730.vMPLL_SS =\n\t\tcpu_to_be32(pi->clk_regs.rv730.mpll_ss);\n\ttable->initialState.levels[0].mclk.mclk730.vMPLL_SS2 =\n\t\tcpu_to_be32(pi->clk_regs.rv730.mpll_ss2);\n\n\ttable->initialState.levels[0].mclk.mclk730.mclk_value =\n\t\tcpu_to_be32(initial_state->low.mclk);\n\n\ttable->initialState.levels[0].sclk.vCG_SPLL_FUNC_CNTL =\n\t\tcpu_to_be32(pi->clk_regs.rv730.cg_spll_func_cntl);\n\ttable->initialState.levels[0].sclk.vCG_SPLL_FUNC_CNTL_2 =\n\t\tcpu_to_be32(pi->clk_regs.rv730.cg_spll_func_cntl_2);\n\ttable->initialState.levels[0].sclk.vCG_SPLL_FUNC_CNTL_3 =\n\t\tcpu_to_be32(pi->clk_regs.rv730.cg_spll_func_cntl_3);\n\ttable->initialState.levels[0].sclk.vCG_SPLL_SPREAD_SPECTRUM =\n\t\tcpu_to_be32(pi->clk_regs.rv730.cg_spll_spread_spectrum);\n\ttable->initialState.levels[0].sclk.vCG_SPLL_SPREAD_SPECTRUM_2 =\n\t\tcpu_to_be32(pi->clk_regs.rv730.cg_spll_spread_spectrum_2);\n\n\ttable->initialState.levels[0].sclk.sclk_value =\n\t\tcpu_to_be32(initial_state->low.sclk);\n\n\ttable->initialState.levels[0].arbValue = MC_CG_ARB_FREQ_F0;\n\n\ttable->initialState.levels[0].seqValue =\n\t\trv770_get_seq_value(rdev, &initial_state->low);\n\n\trv770_populate_vddc_value(rdev,\n\t\t\t\t  initial_state->low.vddc,\n\t\t\t\t  &table->initialState.levels[0].vddc);\n\trv770_populate_initial_mvdd_value(rdev,\n\t\t\t\t\t  &table->initialState.levels[0].mvdd);\n\n\ta_t = CG_R(0xffff) | CG_L(0);\n\n\ttable->initialState.levels[0].aT = cpu_to_be32(a_t);\n\n\ttable->initialState.levels[0].bSP = cpu_to_be32(pi->dsp);\n\n\tif (pi->boot_in_gen2)\n\t\ttable->initialState.levels[0].gen2PCIE = 1;\n\telse\n\t\ttable->initialState.levels[0].gen2PCIE = 0;\n\tif (initial_state->low.flags & ATOM_PPLIB_R600_FLAGS_PCIEGEN2)\n\t\ttable->initialState.levels[0].gen2XSP = 1;\n\telse\n\t\ttable->initialState.levels[0].gen2XSP = 0;\n\n\ttable->initialState.levels[1] = table->initialState.levels[0];\n\ttable->initialState.levels[2] = table->initialState.levels[0];\n\n\ttable->initialState.flags |= PPSMC_SWSTATE_FLAG_DC;\n\n\treturn 0;\n}\n\nvoid rv730_program_memory_timing_parameters(struct radeon_device *rdev,\n\t\t\t\t\t    struct radeon_ps *radeon_state)\n{\n\tstruct rv7xx_ps *state = rv770_get_ps(radeon_state);\n\tu32 arb_refresh_rate = 0;\n\tu32 dram_timing = 0;\n\tu32 dram_timing2 = 0;\n\tu32 old_dram_timing = 0;\n\tu32 old_dram_timing2 = 0;\n\n\tarb_refresh_rate = RREG32(MC_ARB_RFSH_RATE) &\n\t\t~(POWERMODE1_MASK | POWERMODE2_MASK | POWERMODE3_MASK);\n\tarb_refresh_rate |=\n\t\t(POWERMODE1(rv770_calculate_memory_refresh_rate(rdev, state->low.sclk)) |\n\t\t POWERMODE2(rv770_calculate_memory_refresh_rate(rdev, state->medium.sclk)) |\n\t\t POWERMODE3(rv770_calculate_memory_refresh_rate(rdev, state->high.sclk)));\n\tWREG32(MC_ARB_RFSH_RATE, arb_refresh_rate);\n\n\t \n\told_dram_timing = RREG32(MC_ARB_DRAM_TIMING);\n\told_dram_timing2 = RREG32(MC_ARB_DRAM_TIMING2);\n\n\tradeon_atom_set_engine_dram_timings(rdev,\n\t\t\t\t\t    state->high.sclk,\n\t\t\t\t\t    state->high.mclk);\n\n\tdram_timing = RREG32(MC_ARB_DRAM_TIMING);\n\tdram_timing2 = RREG32(MC_ARB_DRAM_TIMING2);\n\n\tWREG32(MC_ARB_DRAM_TIMING_3, dram_timing);\n\tWREG32(MC_ARB_DRAM_TIMING2_3, dram_timing2);\n\n\tradeon_atom_set_engine_dram_timings(rdev,\n\t\t\t\t\t    state->medium.sclk,\n\t\t\t\t\t    state->medium.mclk);\n\n\tdram_timing = RREG32(MC_ARB_DRAM_TIMING);\n\tdram_timing2 = RREG32(MC_ARB_DRAM_TIMING2);\n\n\tWREG32(MC_ARB_DRAM_TIMING_2, dram_timing);\n\tWREG32(MC_ARB_DRAM_TIMING2_2, dram_timing2);\n\n\tradeon_atom_set_engine_dram_timings(rdev,\n\t\t\t\t\t    state->low.sclk,\n\t\t\t\t\t    state->low.mclk);\n\n\tdram_timing = RREG32(MC_ARB_DRAM_TIMING);\n\tdram_timing2 = RREG32(MC_ARB_DRAM_TIMING2);\n\n\tWREG32(MC_ARB_DRAM_TIMING_1, dram_timing);\n\tWREG32(MC_ARB_DRAM_TIMING2_1, dram_timing2);\n\n\t \n\tWREG32(MC_ARB_DRAM_TIMING, old_dram_timing);\n\tWREG32(MC_ARB_DRAM_TIMING2, old_dram_timing2);\n\n}\n\nvoid rv730_start_dpm(struct radeon_device *rdev)\n{\n\tWREG32_P(SCLK_PWRMGT_CNTL, 0, ~SCLK_PWRMGT_OFF);\n\n\tWREG32_P(TCI_MCLK_PWRMGT_CNTL, 0, ~MPLL_PWRMGT_OFF);\n\n\tWREG32_P(GENERAL_PWRMGT, GLOBAL_PWRMGT_EN, ~GLOBAL_PWRMGT_EN);\n}\n\nvoid rv730_stop_dpm(struct radeon_device *rdev)\n{\n\tPPSMC_Result result;\n\n\tresult = rv770_send_msg_to_smc(rdev, PPSMC_MSG_TwoLevelsDisabled);\n\n\tif (result != PPSMC_Result_OK)\n\t\tDRM_DEBUG(\"Could not force DPM to low\\n\");\n\n\tWREG32_P(GENERAL_PWRMGT, 0, ~GLOBAL_PWRMGT_EN);\n\n\tWREG32_P(SCLK_PWRMGT_CNTL, SCLK_PWRMGT_OFF, ~SCLK_PWRMGT_OFF);\n\n\tWREG32_P(TCI_MCLK_PWRMGT_CNTL, MPLL_PWRMGT_OFF, ~MPLL_PWRMGT_OFF);\n}\n\nvoid rv730_program_dcodt(struct radeon_device *rdev, bool use_dcodt)\n{\n\tstruct rv7xx_power_info *pi = rv770_get_pi(rdev);\n\tu32 i = use_dcodt ? 0 : 1;\n\tu32 mc4_io_pad_cntl;\n\n\tmc4_io_pad_cntl = RREG32(MC4_IO_DQ_PAD_CNTL_D0_I0);\n\tmc4_io_pad_cntl &= 0xFFFFFF00;\n\tmc4_io_pad_cntl |= pi->odt_value_0[i];\n\tWREG32(MC4_IO_DQ_PAD_CNTL_D0_I0, mc4_io_pad_cntl);\n\tWREG32(MC4_IO_DQ_PAD_CNTL_D0_I1, mc4_io_pad_cntl);\n\n\tmc4_io_pad_cntl = RREG32(MC4_IO_QS_PAD_CNTL_D0_I0);\n\tmc4_io_pad_cntl &= 0xFFFFFF00;\n\tmc4_io_pad_cntl |= pi->odt_value_1[i];\n\tWREG32(MC4_IO_QS_PAD_CNTL_D0_I0, mc4_io_pad_cntl);\n\tWREG32(MC4_IO_QS_PAD_CNTL_D0_I1, mc4_io_pad_cntl);\n}\n\nvoid rv730_get_odt_values(struct radeon_device *rdev)\n{\n\tstruct rv7xx_power_info *pi = rv770_get_pi(rdev);\n\tu32 mc4_io_pad_cntl;\n\n\tpi->odt_value_0[0] = (u8)0;\n\tpi->odt_value_1[0] = (u8)0x80;\n\n\tmc4_io_pad_cntl = RREG32(MC4_IO_DQ_PAD_CNTL_D0_I0);\n\tpi->odt_value_0[1] = (u8)(mc4_io_pad_cntl & 0xff);\n\n\tmc4_io_pad_cntl = RREG32(MC4_IO_QS_PAD_CNTL_D0_I0);\n\tpi->odt_value_1[1] = (u8)(mc4_io_pad_cntl & 0xff);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}