{
  "module_name": "radeon_mn.c",
  "hash_id": "03e7a4610ad0741a13a30563effe45bd01365c14fee02ed6470633dfe8203e39",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/radeon/radeon_mn.c",
  "human_readable_source": " \n \n\n#include <linux/firmware.h>\n#include <linux/module.h>\n#include <linux/mmu_notifier.h>\n\n#include <drm/drm.h>\n\n#include \"radeon.h\"\n\n \nstatic bool radeon_mn_invalidate(struct mmu_interval_notifier *mn,\n\t\t\t\t const struct mmu_notifier_range *range,\n\t\t\t\t unsigned long cur_seq)\n{\n\tstruct radeon_bo *bo = container_of(mn, struct radeon_bo, notifier);\n\tstruct ttm_operation_ctx ctx = { false, false };\n\tlong r;\n\n\tif (!bo->tbo.ttm || !radeon_ttm_tt_is_bound(bo->tbo.bdev, bo->tbo.ttm))\n\t\treturn true;\n\n\tif (!mmu_notifier_range_blockable(range))\n\t\treturn false;\n\n\tr = radeon_bo_reserve(bo, true);\n\tif (r) {\n\t\tDRM_ERROR(\"(%ld) failed to reserve user bo\\n\", r);\n\t\treturn true;\n\t}\n\n\tr = dma_resv_wait_timeout(bo->tbo.base.resv, DMA_RESV_USAGE_BOOKKEEP,\n\t\t\t\t  false, MAX_SCHEDULE_TIMEOUT);\n\tif (r <= 0)\n\t\tDRM_ERROR(\"(%ld) failed to wait for user bo\\n\", r);\n\n\tradeon_ttm_placement_from_domain(bo, RADEON_GEM_DOMAIN_CPU);\n\tr = ttm_bo_validate(&bo->tbo, &bo->placement, &ctx);\n\tif (r)\n\t\tDRM_ERROR(\"(%ld) failed to validate user bo\\n\", r);\n\n\tradeon_bo_unreserve(bo);\n\treturn true;\n}\n\nstatic const struct mmu_interval_notifier_ops radeon_mn_ops = {\n\t.invalidate = radeon_mn_invalidate,\n};\n\n \nint radeon_mn_register(struct radeon_bo *bo, unsigned long addr)\n{\n\tint ret;\n\n\tret = mmu_interval_notifier_insert(&bo->notifier, current->mm, addr,\n\t\t\t\t\t   radeon_bo_size(bo), &radeon_mn_ops);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tmmu_interval_read_begin(&bo->notifier);\n\treturn 0;\n}\n\n \nvoid radeon_mn_unregister(struct radeon_bo *bo)\n{\n\tif (!bo->notifier.mm)\n\t\treturn;\n\tmmu_interval_notifier_remove(&bo->notifier);\n\tbo->notifier.mm = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}