{
  "module_name": "drm_modeset_helper.c",
  "hash_id": "77b9c4e614677c2cdf816e587f92f9376fad52814b68e3951b65bcde00aac2a2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/drm_modeset_helper.c",
  "human_readable_source": " \n\n#include <drm/drm_atomic_helper.h>\n#include <drm/drm_fb_helper.h>\n#include <drm/drm_fourcc.h>\n#include <drm/drm_framebuffer.h>\n#include <drm/drm_modeset_helper.h>\n#include <drm/drm_plane_helper.h>\n#include <drm/drm_print.h>\n#include <drm/drm_probe_helper.h>\n\n \n\n \nvoid drm_helper_move_panel_connectors_to_head(struct drm_device *dev)\n{\n\tstruct drm_connector *connector, *tmp;\n\tstruct list_head panel_list;\n\n\tINIT_LIST_HEAD(&panel_list);\n\n\tspin_lock_irq(&dev->mode_config.connector_list_lock);\n\tlist_for_each_entry_safe(connector, tmp,\n\t\t\t\t &dev->mode_config.connector_list, head) {\n\t\tif (connector->connector_type == DRM_MODE_CONNECTOR_LVDS ||\n\t\t    connector->connector_type == DRM_MODE_CONNECTOR_eDP ||\n\t\t    connector->connector_type == DRM_MODE_CONNECTOR_DSI)\n\t\t\tlist_move_tail(&connector->head, &panel_list);\n\t}\n\n\tlist_splice(&panel_list, &dev->mode_config.connector_list);\n\tspin_unlock_irq(&dev->mode_config.connector_list_lock);\n}\nEXPORT_SYMBOL(drm_helper_move_panel_connectors_to_head);\n\n \nvoid drm_helper_mode_fill_fb_struct(struct drm_device *dev,\n\t\t\t\t    struct drm_framebuffer *fb,\n\t\t\t\t    const struct drm_mode_fb_cmd2 *mode_cmd)\n{\n\tint i;\n\n\tfb->dev = dev;\n\tfb->format = drm_get_format_info(dev, mode_cmd);\n\tfb->width = mode_cmd->width;\n\tfb->height = mode_cmd->height;\n\tfor (i = 0; i < 4; i++) {\n\t\tfb->pitches[i] = mode_cmd->pitches[i];\n\t\tfb->offsets[i] = mode_cmd->offsets[i];\n\t}\n\tfb->modifier = mode_cmd->modifier[0];\n\tfb->flags = mode_cmd->flags;\n}\nEXPORT_SYMBOL(drm_helper_mode_fill_fb_struct);\n\n \nstatic const uint32_t safe_modeset_formats[] = {\n\tDRM_FORMAT_XRGB8888,\n\tDRM_FORMAT_ARGB8888,\n};\n\nstatic const struct drm_plane_funcs primary_plane_funcs = {\n\tDRM_PLANE_NON_ATOMIC_FUNCS,\n};\n\n \nint drm_crtc_init(struct drm_device *dev, struct drm_crtc *crtc,\n\t\t  const struct drm_crtc_funcs *funcs)\n{\n\tstruct drm_plane *primary;\n\tint ret;\n\n\t \n\tprimary = __drm_universal_plane_alloc(dev, sizeof(*primary), 0, 0,\n\t\t\t\t\t      &primary_plane_funcs,\n\t\t\t\t\t      safe_modeset_formats,\n\t\t\t\t\t      ARRAY_SIZE(safe_modeset_formats),\n\t\t\t\t\t      NULL, DRM_PLANE_TYPE_PRIMARY, NULL);\n\tif (IS_ERR(primary))\n\t\treturn PTR_ERR(primary);\n\n\t \n\tprimary->format_default = true;\n\n\tret = drm_crtc_init_with_planes(dev, crtc, primary, NULL, funcs, NULL);\n\tif (ret)\n\t\tgoto err_drm_plane_cleanup;\n\n\treturn 0;\n\nerr_drm_plane_cleanup:\n\tdrm_plane_cleanup(primary);\n\tkfree(primary);\n\treturn ret;\n}\nEXPORT_SYMBOL(drm_crtc_init);\n\n \nint drm_mode_config_helper_suspend(struct drm_device *dev)\n{\n\tstruct drm_atomic_state *state;\n\n\tif (!dev)\n\t\treturn 0;\n\n\tdrm_kms_helper_poll_disable(dev);\n\tdrm_fb_helper_set_suspend_unlocked(dev->fb_helper, 1);\n\tstate = drm_atomic_helper_suspend(dev);\n\tif (IS_ERR(state)) {\n\t\tdrm_fb_helper_set_suspend_unlocked(dev->fb_helper, 0);\n\t\tdrm_kms_helper_poll_enable(dev);\n\t\treturn PTR_ERR(state);\n\t}\n\n\tdev->mode_config.suspend_state = state;\n\n\treturn 0;\n}\nEXPORT_SYMBOL(drm_mode_config_helper_suspend);\n\n \nint drm_mode_config_helper_resume(struct drm_device *dev)\n{\n\tint ret;\n\n\tif (!dev)\n\t\treturn 0;\n\n\tif (WARN_ON(!dev->mode_config.suspend_state))\n\t\treturn -EINVAL;\n\n\tret = drm_atomic_helper_resume(dev, dev->mode_config.suspend_state);\n\tif (ret)\n\t\tDRM_ERROR(\"Failed to resume (%d)\\n\", ret);\n\tdev->mode_config.suspend_state = NULL;\n\n\tdrm_fb_helper_set_suspend_unlocked(dev->fb_helper, 0);\n\tdrm_kms_helper_poll_enable(dev);\n\n\treturn ret;\n}\nEXPORT_SYMBOL(drm_mode_config_helper_resume);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}