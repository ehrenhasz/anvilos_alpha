{
  "module_name": "sun8i_mixer.c",
  "hash_id": "8b3a29d2c47c66424d7e6d5f2599e23110a670d29d64a40e0eac63e330052bb3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/sun4i/sun8i_mixer.c",
  "human_readable_source": "\n \n\n#include <linux/component.h>\n#include <linux/dma-mapping.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_device.h>\n#include <linux/of_graph.h>\n#include <linux/platform_device.h>\n#include <linux/reset.h>\n\n#include <drm/drm_atomic_helper.h>\n#include <drm/drm_crtc.h>\n#include <drm/drm_framebuffer.h>\n#include <drm/drm_gem_dma_helper.h>\n#include <drm/drm_probe_helper.h>\n\n#include \"sun4i_drv.h\"\n#include \"sun8i_mixer.h\"\n#include \"sun8i_ui_layer.h\"\n#include \"sun8i_vi_layer.h\"\n#include \"sunxi_engine.h\"\n\nstruct de2_fmt_info {\n\tu32\tdrm_fmt;\n\tu32\tde2_fmt;\n};\n\nstatic const struct de2_fmt_info de2_formats[] = {\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ARGB8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ARGB8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ABGR8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ABGR8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_RGBA8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGBA8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_BGRA8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGRA8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_XRGB8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_XRGB8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_XBGR8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_XBGR8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_RGBX8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGBX8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_BGRX8888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGRX8888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_RGB888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGB888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_BGR888,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGR888,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_RGB565,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGB565,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_BGR565,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGR565,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ARGB4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ARGB4444,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_XRGB4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ARGB4444,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ABGR4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ABGR4444,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_XBGR4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ABGR4444,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_RGBA4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGBA4444,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_RGBX4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGBA4444,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_BGRA4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGRA4444,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_BGRX4444,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGRA4444,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ARGB1555,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ARGB1555,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_XRGB1555,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ARGB1555,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ABGR1555,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ABGR1555,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_XBGR1555,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ABGR1555,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_RGBA5551,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGBA5551,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_RGBX5551,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGBA5551,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_BGRA5551,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGRA5551,\n\t},\n\t{\n\t\t \n\t\t.drm_fmt = DRM_FORMAT_BGRX5551,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGRA5551,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ARGB2101010,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ARGB2101010,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_ABGR2101010,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_ABGR2101010,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_RGBA1010102,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_RGBA1010102,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_BGRA1010102,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_BGRA1010102,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_UYVY,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_UYVY,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_VYUY,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_VYUY,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YUYV,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YUYV,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YVYU,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YVYU,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_NV16,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_NV16,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_NV61,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_NV61,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_NV12,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_NV12,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_NV21,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_NV21,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YUV422,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YUV422,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YUV420,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YUV420,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YUV411,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YUV411,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YVU422,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YUV422,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YVU420,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YUV420,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_YVU411,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_YUV411,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_P010,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_P010_YUV,\n\t},\n\t{\n\t\t.drm_fmt = DRM_FORMAT_P210,\n\t\t.de2_fmt = SUN8I_MIXER_FBFMT_P210_YUV,\n\t},\n};\n\nint sun8i_mixer_drm_format_to_hw(u32 format, u32 *hw_format)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < ARRAY_SIZE(de2_formats); ++i)\n\t\tif (de2_formats[i].drm_fmt == format) {\n\t\t\t*hw_format = de2_formats[i].de2_fmt;\n\t\t\treturn 0;\n\t\t}\n\n\treturn -EINVAL;\n}\n\nstatic void sun8i_mixer_commit(struct sunxi_engine *engine)\n{\n\tDRM_DEBUG_DRIVER(\"Committing changes\\n\");\n\n\tregmap_write(engine->regs, SUN8I_MIXER_GLOBAL_DBUFF,\n\t\t     SUN8I_MIXER_GLOBAL_DBUFF_ENABLE);\n}\n\nstatic struct drm_plane **sun8i_layers_init(struct drm_device *drm,\n\t\t\t\t\t    struct sunxi_engine *engine)\n{\n\tstruct drm_plane **planes;\n\tstruct sun8i_mixer *mixer = engine_to_sun8i_mixer(engine);\n\tint i;\n\n\tplanes = devm_kcalloc(drm->dev,\n\t\t\t      mixer->cfg->vi_num + mixer->cfg->ui_num + 1,\n\t\t\t      sizeof(*planes), GFP_KERNEL);\n\tif (!planes)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tfor (i = 0; i < mixer->cfg->vi_num; i++) {\n\t\tstruct sun8i_vi_layer *layer;\n\n\t\tlayer = sun8i_vi_layer_init_one(drm, mixer, i);\n\t\tif (IS_ERR(layer)) {\n\t\t\tdev_err(drm->dev,\n\t\t\t\t\"Couldn't initialize overlay plane\\n\");\n\t\t\treturn ERR_CAST(layer);\n\t\t}\n\n\t\tplanes[i] = &layer->plane;\n\t}\n\n\tfor (i = 0; i < mixer->cfg->ui_num; i++) {\n\t\tstruct sun8i_ui_layer *layer;\n\n\t\tlayer = sun8i_ui_layer_init_one(drm, mixer, i);\n\t\tif (IS_ERR(layer)) {\n\t\t\tdev_err(drm->dev, \"Couldn't initialize %s plane\\n\",\n\t\t\t\ti ? \"overlay\" : \"primary\");\n\t\t\treturn ERR_CAST(layer);\n\t\t}\n\n\t\tplanes[mixer->cfg->vi_num + i] = &layer->plane;\n\t}\n\n\treturn planes;\n}\n\nstatic void sun8i_mixer_mode_set(struct sunxi_engine *engine,\n\t\t\t\t const struct drm_display_mode *mode)\n{\n\tstruct sun8i_mixer *mixer = engine_to_sun8i_mixer(engine);\n\tu32 bld_base, size, val;\n\tbool interlaced;\n\n\tbld_base = sun8i_blender_base(mixer);\n\tinterlaced = !!(mode->flags & DRM_MODE_FLAG_INTERLACE);\n\tsize = SUN8I_MIXER_SIZE(mode->hdisplay, mode->vdisplay);\n\n\tDRM_DEBUG_DRIVER(\"Updating global size W: %u H: %u\\n\",\n\t\t\t mode->hdisplay, mode->vdisplay);\n\n\tregmap_write(engine->regs, SUN8I_MIXER_GLOBAL_SIZE, size);\n\tregmap_write(engine->regs, SUN8I_MIXER_BLEND_OUTSIZE(bld_base), size);\n\n\tif (interlaced)\n\t\tval = SUN8I_MIXER_BLEND_OUTCTL_INTERLACED;\n\telse\n\t\tval = 0;\n\n\tregmap_update_bits(engine->regs, SUN8I_MIXER_BLEND_OUTCTL(bld_base),\n\t\t\t   SUN8I_MIXER_BLEND_OUTCTL_INTERLACED, val);\n\n\tDRM_DEBUG_DRIVER(\"Switching display mixer interlaced mode %s\\n\",\n\t\t\t interlaced ? \"on\" : \"off\");\n}\n\nstatic const struct sunxi_engine_ops sun8i_engine_ops = {\n\t.commit\t\t= sun8i_mixer_commit,\n\t.layers_init\t= sun8i_layers_init,\n\t.mode_set\t= sun8i_mixer_mode_set,\n};\n\nstatic const struct regmap_config sun8i_mixer_regmap_config = {\n\t.reg_bits\t= 32,\n\t.val_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.max_register\t= 0xffffc,  \n};\n\nstatic int sun8i_mixer_of_get_id(struct device_node *node)\n{\n\tstruct device_node *ep, *remote;\n\tstruct of_endpoint of_ep;\n\n\t \n\tep = of_graph_get_endpoint_by_regs(node, 1, -1);\n\tif (!ep)\n\t\treturn -EINVAL;\n\n\tremote = of_graph_get_remote_endpoint(ep);\n\tof_node_put(ep);\n\tif (!remote)\n\t\treturn -EINVAL;\n\n\tof_graph_parse_endpoint(remote, &of_ep);\n\tof_node_put(remote);\n\treturn of_ep.id;\n}\n\nstatic int sun8i_mixer_bind(struct device *dev, struct device *master,\n\t\t\t      void *data)\n{\n\tstruct platform_device *pdev = to_platform_device(dev);\n\tstruct drm_device *drm = data;\n\tstruct sun4i_drv *drv = drm->dev_private;\n\tstruct sun8i_mixer *mixer;\n\tvoid __iomem *regs;\n\tunsigned int base;\n\tint plane_cnt;\n\tint i, ret;\n\n\t \n\tret = dma_set_mask(dev, DMA_BIT_MASK(32));\n\tif (ret) {\n\t\tdev_err(dev, \"Cannot do 32-bit DMA.\\n\");\n\t\treturn ret;\n\t}\n\n\tmixer = devm_kzalloc(dev, sizeof(*mixer), GFP_KERNEL);\n\tif (!mixer)\n\t\treturn -ENOMEM;\n\tdev_set_drvdata(dev, mixer);\n\tmixer->engine.ops = &sun8i_engine_ops;\n\tmixer->engine.node = dev->of_node;\n\n\tif (of_property_present(dev->of_node, \"iommus\")) {\n\t\t \n\t\tret = of_dma_configure(drm->dev, dev->of_node, true);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\t \n\tmixer->engine.id = sun8i_mixer_of_get_id(dev->of_node);\n\n\tmixer->cfg = of_device_get_match_data(dev);\n\tif (!mixer->cfg)\n\t\treturn -EINVAL;\n\n\tregs = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(regs))\n\t\treturn PTR_ERR(regs);\n\n\tmixer->engine.regs = devm_regmap_init_mmio(dev, regs,\n\t\t\t\t\t\t   &sun8i_mixer_regmap_config);\n\tif (IS_ERR(mixer->engine.regs)) {\n\t\tdev_err(dev, \"Couldn't create the mixer regmap\\n\");\n\t\treturn PTR_ERR(mixer->engine.regs);\n\t}\n\n\tmixer->reset = devm_reset_control_get(dev, NULL);\n\tif (IS_ERR(mixer->reset)) {\n\t\tdev_err(dev, \"Couldn't get our reset line\\n\");\n\t\treturn PTR_ERR(mixer->reset);\n\t}\n\n\tret = reset_control_deassert(mixer->reset);\n\tif (ret) {\n\t\tdev_err(dev, \"Couldn't deassert our reset line\\n\");\n\t\treturn ret;\n\t}\n\n\tmixer->bus_clk = devm_clk_get(dev, \"bus\");\n\tif (IS_ERR(mixer->bus_clk)) {\n\t\tdev_err(dev, \"Couldn't get the mixer bus clock\\n\");\n\t\tret = PTR_ERR(mixer->bus_clk);\n\t\tgoto err_assert_reset;\n\t}\n\tclk_prepare_enable(mixer->bus_clk);\n\n\tmixer->mod_clk = devm_clk_get(dev, \"mod\");\n\tif (IS_ERR(mixer->mod_clk)) {\n\t\tdev_err(dev, \"Couldn't get the mixer module clock\\n\");\n\t\tret = PTR_ERR(mixer->mod_clk);\n\t\tgoto err_disable_bus_clk;\n\t}\n\n\t \n\tif (mixer->cfg->mod_rate)\n\t\tclk_set_rate(mixer->mod_clk, mixer->cfg->mod_rate);\n\n\tclk_prepare_enable(mixer->mod_clk);\n\n\tlist_add_tail(&mixer->engine.list, &drv->engine_list);\n\n\tbase = sun8i_blender_base(mixer);\n\n\t \n\tif (mixer->cfg->is_de3) {\n\t\tfor (i = 0; i < DE3_MIXER_UNIT_SIZE; i += 4)\n\t\t\tregmap_write(mixer->engine.regs, i, 0);\n\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_FCE_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_PEAK_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_LCTI_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_BLS_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_FCC_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_DNS_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_DRC_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_FMT_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_CDC0_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN50I_MIXER_CDC1_EN, 0);\n\t} else {\n\t\tfor (i = 0; i < DE2_MIXER_UNIT_SIZE; i += 4)\n\t\t\tregmap_write(mixer->engine.regs, i, 0);\n\n\t\tregmap_write(mixer->engine.regs, SUN8I_MIXER_FCE_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN8I_MIXER_BWS_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN8I_MIXER_LTI_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN8I_MIXER_PEAK_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN8I_MIXER_ASE_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN8I_MIXER_FCC_EN, 0);\n\t\tregmap_write(mixer->engine.regs, SUN8I_MIXER_DCSC_EN, 0);\n\t}\n\n\t \n\tregmap_write(mixer->engine.regs, SUN8I_MIXER_GLOBAL_CTL,\n\t\t     SUN8I_MIXER_GLOBAL_CTL_RT_EN);\n\n\t \n\tregmap_write(mixer->engine.regs, SUN8I_MIXER_BLEND_BKCOLOR(base),\n\t\t     SUN8I_MIXER_BLEND_COLOR_BLACK);\n\n\t \n\tregmap_write(mixer->engine.regs, SUN8I_MIXER_BLEND_PIPE_CTL(base),\n\t\t     SUN8I_MIXER_BLEND_PIPE_CTL_FC_EN(0));\n\tregmap_write(mixer->engine.regs, SUN8I_MIXER_BLEND_ATTR_FCOLOR(base, 0),\n\t\t     SUN8I_MIXER_BLEND_COLOR_BLACK);\n\n\tplane_cnt = mixer->cfg->vi_num + mixer->cfg->ui_num;\n\tfor (i = 0; i < plane_cnt; i++)\n\t\tregmap_write(mixer->engine.regs,\n\t\t\t     SUN8I_MIXER_BLEND_MODE(base, i),\n\t\t\t     SUN8I_MIXER_BLEND_MODE_DEF);\n\n\tregmap_update_bits(mixer->engine.regs, SUN8I_MIXER_BLEND_PIPE_CTL(base),\n\t\t\t   SUN8I_MIXER_BLEND_PIPE_CTL_EN_MSK, 0);\n\n\treturn 0;\n\nerr_disable_bus_clk:\n\tclk_disable_unprepare(mixer->bus_clk);\nerr_assert_reset:\n\treset_control_assert(mixer->reset);\n\treturn ret;\n}\n\nstatic void sun8i_mixer_unbind(struct device *dev, struct device *master,\n\t\t\t\t void *data)\n{\n\tstruct sun8i_mixer *mixer = dev_get_drvdata(dev);\n\n\tlist_del(&mixer->engine.list);\n\n\tclk_disable_unprepare(mixer->mod_clk);\n\tclk_disable_unprepare(mixer->bus_clk);\n\treset_control_assert(mixer->reset);\n}\n\nstatic const struct component_ops sun8i_mixer_ops = {\n\t.bind\t= sun8i_mixer_bind,\n\t.unbind\t= sun8i_mixer_unbind,\n};\n\nstatic int sun8i_mixer_probe(struct platform_device *pdev)\n{\n\treturn component_add(&pdev->dev, &sun8i_mixer_ops);\n}\n\nstatic void sun8i_mixer_remove(struct platform_device *pdev)\n{\n\tcomponent_del(&pdev->dev, &sun8i_mixer_ops);\n}\n\nstatic const struct sun8i_mixer_cfg sun8i_a83t_mixer0_cfg = {\n\t.ccsc\t\t= CCSC_MIXER0_LAYOUT,\n\t.scaler_mask\t= 0xf,\n\t.scanline_yuv\t= 2048,\n\t.ui_num\t\t= 3,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun8i_a83t_mixer1_cfg = {\n\t.ccsc\t\t= CCSC_MIXER1_LAYOUT,\n\t.scaler_mask\t= 0x3,\n\t.scanline_yuv\t= 2048,\n\t.ui_num\t\t= 1,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun8i_h3_mixer0_cfg = {\n\t.ccsc\t\t= CCSC_MIXER0_LAYOUT,\n\t.mod_rate\t= 432000000,\n\t.scaler_mask\t= 0xf,\n\t.scanline_yuv\t= 2048,\n\t.ui_num\t\t= 3,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun8i_r40_mixer0_cfg = {\n\t.ccsc\t\t= CCSC_MIXER0_LAYOUT,\n\t.mod_rate\t= 297000000,\n\t.scaler_mask\t= 0xf,\n\t.scanline_yuv\t= 2048,\n\t.ui_num\t\t= 3,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun8i_r40_mixer1_cfg = {\n\t.ccsc\t\t= CCSC_MIXER1_LAYOUT,\n\t.mod_rate\t= 297000000,\n\t.scaler_mask\t= 0x3,\n\t.scanline_yuv\t= 2048,\n\t.ui_num\t\t= 1,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun8i_v3s_mixer_cfg = {\n\t.vi_num = 2,\n\t.ui_num = 1,\n\t.scaler_mask = 0x3,\n\t.scanline_yuv = 2048,\n\t.ccsc = CCSC_MIXER0_LAYOUT,\n\t.mod_rate = 150000000,\n};\n\nstatic const struct sun8i_mixer_cfg sun20i_d1_mixer0_cfg = {\n\t.ccsc\t\t= CCSC_D1_MIXER0_LAYOUT,\n\t.mod_rate\t= 297000000,\n\t.scaler_mask\t= 0x3,\n\t.scanline_yuv\t= 2048,\n\t.ui_num\t\t= 1,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun20i_d1_mixer1_cfg = {\n\t.ccsc\t\t= CCSC_MIXER1_LAYOUT,\n\t.mod_rate\t= 297000000,\n\t.scaler_mask\t= 0x1,\n\t.scanline_yuv\t= 1024,\n\t.ui_num\t\t= 0,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun50i_a64_mixer0_cfg = {\n\t.ccsc\t\t= CCSC_MIXER0_LAYOUT,\n\t.mod_rate\t= 297000000,\n\t.scaler_mask\t= 0xf,\n\t.scanline_yuv\t= 4096,\n\t.ui_num\t\t= 3,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun50i_a64_mixer1_cfg = {\n\t.ccsc\t\t= CCSC_MIXER1_LAYOUT,\n\t.mod_rate\t= 297000000,\n\t.scaler_mask\t= 0x3,\n\t.scanline_yuv\t= 2048,\n\t.ui_num\t\t= 1,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct sun8i_mixer_cfg sun50i_h6_mixer0_cfg = {\n\t.ccsc\t\t= CCSC_MIXER0_LAYOUT,\n\t.is_de3\t\t= true,\n\t.mod_rate\t= 600000000,\n\t.scaler_mask\t= 0xf,\n\t.scanline_yuv\t= 4096,\n\t.ui_num\t\t= 3,\n\t.vi_num\t\t= 1,\n};\n\nstatic const struct of_device_id sun8i_mixer_of_table[] = {\n\t{\n\t\t.compatible = \"allwinner,sun8i-a83t-de2-mixer-0\",\n\t\t.data = &sun8i_a83t_mixer0_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-a83t-de2-mixer-1\",\n\t\t.data = &sun8i_a83t_mixer1_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-h3-de2-mixer-0\",\n\t\t.data = &sun8i_h3_mixer0_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-r40-de2-mixer-0\",\n\t\t.data = &sun8i_r40_mixer0_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-r40-de2-mixer-1\",\n\t\t.data = &sun8i_r40_mixer1_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-v3s-de2-mixer\",\n\t\t.data = &sun8i_v3s_mixer_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun20i-d1-de2-mixer-0\",\n\t\t.data = &sun20i_d1_mixer0_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun20i-d1-de2-mixer-1\",\n\t\t.data = &sun20i_d1_mixer1_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun50i-a64-de2-mixer-0\",\n\t\t.data = &sun50i_a64_mixer0_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun50i-a64-de2-mixer-1\",\n\t\t.data = &sun50i_a64_mixer1_cfg,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun50i-h6-de3-mixer-0\",\n\t\t.data = &sun50i_h6_mixer0_cfg,\n\t},\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, sun8i_mixer_of_table);\n\nstatic struct platform_driver sun8i_mixer_platform_driver = {\n\t.probe\t\t= sun8i_mixer_probe,\n\t.remove_new\t= sun8i_mixer_remove,\n\t.driver\t\t= {\n\t\t.name\t\t= \"sun8i-mixer\",\n\t\t.of_match_table\t= sun8i_mixer_of_table,\n\t},\n};\nmodule_platform_driver(sun8i_mixer_platform_driver);\n\nMODULE_AUTHOR(\"Icenowy Zheng <icenowy@aosc.io>\");\nMODULE_DESCRIPTION(\"Allwinner DE2 Mixer driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}