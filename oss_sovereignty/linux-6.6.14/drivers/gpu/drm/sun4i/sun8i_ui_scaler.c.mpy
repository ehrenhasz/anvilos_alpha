{
  "module_name": "sun8i_ui_scaler.c",
  "hash_id": "f51e6a2dddd79b2d7883576aeca444372c2dac88229b76cfa60e5a1aa3161bc2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/sun4i/sun8i_ui_scaler.c",
  "human_readable_source": " \n\n#include \"sun8i_ui_scaler.h\"\n#include \"sun8i_vi_scaler.h\"\n\nstatic const u32 lan2coefftab16[240] = {\n\t0x00004000, 0x00033ffe, 0x00063efc, 0x000a3bfb,\n\t0xff0f37fb, 0xfe1433fb, 0xfd192ffb, 0xfd1f29fb,\n\t0xfc2424fc, 0xfb291ffd, 0xfb2f19fd, 0xfb3314fe,\n\t0xfb370fff, 0xfb3b0a00, 0xfc3e0600, 0xfe3f0300,\n\n\t0xff053804, 0xff083801, 0xff0a3700, 0xff0e34ff,\n\t0xff1232fd, 0xfe162ffd, 0xfd1b2cfc, 0xfd1f28fc,\n\t0xfd2323fd, 0xfc281ffd, 0xfc2c1bfd, 0xfd2f16fe,\n\t0xfd3212ff, 0xff340eff, 0x00360a00, 0x02370700,\n\n\t0xff083207, 0xff0a3205, 0xff0d3103, 0xfe113001,\n\t0xfe142e00, 0xfe182bff, 0xfe1b29fe, 0xfe1f25fe,\n\t0xfe2222fe, 0xfe251ffe, 0xfe291bfe, 0xff2b18fe,\n\t0x002e14fe, 0x013010ff, 0x03310dff, 0x05310a00,\n\n\t0xff0a2e09, 0xff0c2e07, 0xff0f2d05, 0xff122c03,\n\t0xfe152b02, 0xfe182901, 0xfe1b2700, 0xff1e24ff,\n\t0xff2121ff, 0xff241eff, 0x00261bff, 0x012818ff,\n\t0x022a15ff, 0x032c12ff, 0x052d0fff, 0x072d0c00,\n\n\t0xff0c2a0b, 0xff0e2a09, 0xff102a07, 0xff132905,\n\t0xff162803, 0xff182702, 0xff1b2501, 0xff1e2300,\n\t0x00202000, 0x01221d00, 0x01251bff, 0x032618ff,\n\t0x042815ff, 0x052913ff, 0x072a10ff, 0x092a0d00,\n\n\t0xff0d280c, 0xff0f280a, 0xff112808, 0xff142706,\n\t0xff162605, 0xff192503, 0x001b2302, 0x001d2201,\n\t0x011f1f01, 0x01221d00, 0x02231b00, 0x04241800,\n\t0x052616ff, 0x072713ff, 0x08271100, 0x0a280e00,\n\n\t0xff0e260d, 0xff10260b, 0xff122609, 0xff142508,\n\t0x00152506, 0x00182305, 0x001b2203, 0x011d2002,\n\t0x011f1f01, 0x02201d01, 0x03221b00, 0x04231801,\n\t0x06241600, 0x08251300, 0x09261100, 0x0b260f00,\n\n\t0xff0e250e, 0xff10250c, 0x0011250a, 0x00142408,\n\t0x00162307, 0x00182206, 0x011a2104, 0x011c2003,\n\t0x021e1e02, 0x03201c01, 0x04211a01, 0x05221801,\n\t0x07231600, 0x08241400, 0x0a241200, 0x0c241000,\n\n\t0x000e240e, 0x0010240c, 0x0013230a, 0x00142309,\n\t0x00162208, 0x01182106, 0x011a2005, 0x021b1f04,\n\t0x031d1d03, 0x041e1c02, 0x05201a01, 0x06211801,\n\t0x07221601, 0x09231400, 0x0a231300, 0x0c231100,\n\n\t0x000f220f, 0x0011220d, 0x0013220b, 0x0015210a,\n\t0x01162108, 0x01182007, 0x02191f06, 0x031a1e05,\n\t0x041c1c04, 0x051d1b03, 0x061f1902, 0x07201801,\n\t0x08211601, 0x0a211500, 0x0b221300, 0x0d221100,\n\n\t0x0010210f, 0x0011210e, 0x0013210c, 0x0114200b,\n\t0x01161f0a, 0x02171f08, 0x03181e07, 0x031a1d06,\n\t0x041c1c04, 0x051d1a04, 0x071d1903, 0x081e1802,\n\t0x091f1602, 0x0b1f1501, 0x0c211300, 0x0e201200,\n\n\t0x00102010, 0x0012200e, 0x0013200d, 0x01151f0b,\n\t0x01161f0a, 0x02171e09, 0x03191d07, 0x041a1c06,\n\t0x051b1b05, 0x061c1a04, 0x071d1903, 0x081e1703,\n\t0x0a1f1601, 0x0b1f1501, 0x0d201300, 0x0e201200,\n\n\t0x00102010, 0x00121f0f, 0x00141f0d, 0x01141f0c,\n\t0x02161e0a, 0x03171d09, 0x03181d08, 0x041a1c06,\n\t0x051b1b05, 0x061c1a04, 0x081c1903, 0x091d1703,\n\t0x0a1e1602, 0x0c1e1501, 0x0d1f1400, 0x0e1f1201,\n\n\t0x00111e11, 0x00131e0f, 0x01131e0e, 0x02151d0c,\n\t0x02161d0b, 0x03171c0a, 0x04181b09, 0x05191b07,\n\t0x061a1a06, 0x071b1905, 0x091b1804, 0x0a1c1703,\n\t0x0b1d1602, 0x0c1d1502, 0x0e1d1401, 0x0f1e1300,\n\n\t0x00111e11, 0x00131d10, 0x01141d0e, 0x02151c0d,\n\t0x03161c0b, 0x04171b0a, 0x05171b09, 0x06181a08,\n\t0x07191907, 0x081a1806, 0x091a1805, 0x0a1b1704,\n\t0x0b1c1603, 0x0d1c1502, 0x0e1d1401, 0x0f1d1301,\n};\n\nstatic u32 sun8i_ui_scaler_base(struct sun8i_mixer *mixer, int channel)\n{\n\tint vi_num = mixer->cfg->vi_num;\n\n\tif (mixer->cfg->is_de3)\n\t\treturn DE3_VI_SCALER_UNIT_BASE +\n\t\t       DE3_VI_SCALER_UNIT_SIZE * vi_num +\n\t\t       DE3_UI_SCALER_UNIT_SIZE * (channel - vi_num);\n\telse\n\t\treturn DE2_VI_SCALER_UNIT_BASE +\n\t\t       DE2_VI_SCALER_UNIT_SIZE * vi_num +\n\t\t       DE2_UI_SCALER_UNIT_SIZE * (channel - vi_num);\n}\n\nstatic int sun8i_ui_scaler_coef_index(unsigned int step)\n{\n\tunsigned int scale, int_part, float_part;\n\n\tscale = step >> (SUN8I_UI_SCALER_SCALE_FRAC - 3);\n\tint_part = scale >> 3;\n\tfloat_part = scale & 0x7;\n\n\tswitch (int_part) {\n\tcase 0:\n\t\treturn 0;\n\tcase 1:\n\t\treturn float_part;\n\tcase 2:\n\t\treturn 8 + (float_part >> 1);\n\tcase 3:\n\t\treturn 12;\n\tcase 4:\n\t\treturn 13;\n\tdefault:\n\t\treturn 14;\n\t}\n}\n\nvoid sun8i_ui_scaler_enable(struct sun8i_mixer *mixer, int layer, bool enable)\n{\n\tu32 val, base;\n\n\tif (WARN_ON(layer < mixer->cfg->vi_num))\n\t\treturn;\n\n\tbase = sun8i_ui_scaler_base(mixer, layer);\n\n\tif (enable)\n\t\tval = SUN8I_SCALER_GSU_CTRL_EN |\n\t\t      SUN8I_SCALER_GSU_CTRL_COEFF_RDY;\n\telse\n\t\tval = 0;\n\n\tregmap_write(mixer->engine.regs, SUN8I_SCALER_GSU_CTRL(base), val);\n}\n\nvoid sun8i_ui_scaler_setup(struct sun8i_mixer *mixer, int layer,\n\t\t\t   u32 src_w, u32 src_h, u32 dst_w, u32 dst_h,\n\t\t\t   u32 hscale, u32 vscale, u32 hphase, u32 vphase)\n{\n\tu32 insize, outsize;\n\tint i, offset;\n\tu32 base;\n\n\tif (WARN_ON(layer < mixer->cfg->vi_num))\n\t\treturn;\n\n\tbase = sun8i_ui_scaler_base(mixer, layer);\n\n\thphase <<= SUN8I_UI_SCALER_PHASE_FRAC - 16;\n\tvphase <<= SUN8I_UI_SCALER_PHASE_FRAC - 16;\n\thscale <<= SUN8I_UI_SCALER_SCALE_FRAC - 16;\n\tvscale <<= SUN8I_UI_SCALER_SCALE_FRAC - 16;\n\n\tinsize = SUN8I_UI_SCALER_SIZE(src_w, src_h);\n\toutsize = SUN8I_UI_SCALER_SIZE(dst_w, dst_h);\n\n\tregmap_write(mixer->engine.regs,\n\t\t     SUN8I_SCALER_GSU_OUTSIZE(base), outsize);\n\tregmap_write(mixer->engine.regs,\n\t\t     SUN8I_SCALER_GSU_INSIZE(base), insize);\n\tregmap_write(mixer->engine.regs,\n\t\t     SUN8I_SCALER_GSU_HSTEP(base), hscale);\n\tregmap_write(mixer->engine.regs,\n\t\t     SUN8I_SCALER_GSU_VSTEP(base), vscale);\n\tregmap_write(mixer->engine.regs,\n\t\t     SUN8I_SCALER_GSU_HPHASE(base), hphase);\n\tregmap_write(mixer->engine.regs,\n\t\t     SUN8I_SCALER_GSU_VPHASE(base), vphase);\n\toffset = sun8i_ui_scaler_coef_index(hscale) *\n\t\t\tSUN8I_UI_SCALER_COEFF_COUNT;\n\tfor (i = 0; i < SUN8I_UI_SCALER_COEFF_COUNT; i++)\n\t\tregmap_write(mixer->engine.regs,\n\t\t\t     SUN8I_SCALER_GSU_HCOEFF(base, i),\n\t\t\t     lan2coefftab16[offset + i]);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}