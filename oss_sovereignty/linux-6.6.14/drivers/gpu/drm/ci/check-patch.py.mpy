{
  "module_name": "check-patch.py",
  "hash_id": "3ae9fc3de40e8ed788a70f3a7510e32c47b07936cd459b92c716bc855ac6e11e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/ci/check-patch.py",
  "human_readable_source": "#!/usr/bin/env python3\n# SPDX-License-Identifier: GPL-2.0-or-later\n#\n# check-patch.py: run checkpatch.pl across all commits in a branch\n#\n# Based on qemu/.gitlab-ci.d/check-patch.py\n#\n# Copyright (C) 2020 Red Hat, Inc.\n# Copyright (C) 2022 Collabora Ltd.\n\nimport os\nimport os.path\nimport sys\nimport subprocess\n\nrepourl = \"https://gitlab.freedesktop.org/%s.git\" % os.environ[\"CI_MERGE_REQUEST_PROJECT_PATH\"]\n\n# GitLab CI environment does not give us any direct info about the\n# base for the user's branch. We thus need to figure out a common\n# ancestor between the user's branch and current git master.\nos.environ[\"GIT_DEPTH\"] = \"1000\"\nsubprocess.call([\"git\", \"remote\", \"remove\", \"check-patch\"], stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL)\nsubprocess.check_call([\"git\", \"remote\", \"add\", \"check-patch\", repourl])\nsubprocess.check_call([\"git\", \"fetch\", \"check-patch\", os.environ[\"CI_MERGE_REQUEST_TARGET_BRANCH_NAME\"]],\n                      stdout=subprocess.DEVNULL,\n                      stderr=subprocess.DEVNULL)\n\nancestor = subprocess.check_output([\"git\", \"merge-base\",\n                                    \"check-patch/%s\" % os.environ[\"CI_MERGE_REQUEST_TARGET_BRANCH_NAME\"], \"HEAD\"],\n                                   universal_newlines=True)\n\nancestor = ancestor.strip()\n\nlog = subprocess.check_output([\"git\", \"log\", \"--format=%H %s\",\n                               ancestor + \"...\"],\n                              universal_newlines=True)\n\nsubprocess.check_call([\"git\", \"remote\", \"rm\", \"check-patch\"])\n\nif log == \"\":\n    print(\"\\nNo commits since %s, skipping checks\\n\" % ancestor)\n    sys.exit(0)\n\nerrors = False\n\nprint(\"\\nChecking all commits since %s...\\n\" % ancestor, flush=True)\n\nret = subprocess.run([\"scripts/checkpatch.pl\",\n                      \"--terse\",\n                      \"--types\", os.environ[\"CHECKPATCH_TYPES\"],\n                      \"--git\", ancestor + \"...\"])\n\nif ret.returncode != 0:\n    print(\"    \u274c FAIL one or more commits failed scripts/checkpatch.pl\")\n    sys.exit(1)\n\nsys.exit(0)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}