{
  "module_name": "mtk_drm_ddp_comp.h",
  "hash_id": "71658eb9ecc2e6a3acea8f46f316e2ac39535dbed33ab74605c62e9ee912cf9d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/mediatek/mtk_drm_ddp_comp.h",
  "human_readable_source": " \n \n\n#ifndef MTK_DRM_DDP_COMP_H\n#define MTK_DRM_DDP_COMP_H\n\n#include <linux/io.h>\n#include <linux/soc/mediatek/mtk-cmdq.h>\n#include <linux/soc/mediatek/mtk-mmsys.h>\n#include <linux/soc/mediatek/mtk-mutex.h>\n\nstruct device;\nstruct device_node;\nstruct drm_crtc;\nstruct drm_device;\nstruct mtk_plane_state;\nstruct drm_crtc_state;\n\nenum mtk_ddp_comp_type {\n\tMTK_DISP_AAL,\n\tMTK_DISP_BLS,\n\tMTK_DISP_CCORR,\n\tMTK_DISP_COLOR,\n\tMTK_DISP_DITHER,\n\tMTK_DISP_DSC,\n\tMTK_DISP_GAMMA,\n\tMTK_DISP_MERGE,\n\tMTK_DISP_MUTEX,\n\tMTK_DISP_OD,\n\tMTK_DISP_OVL,\n\tMTK_DISP_OVL_2L,\n\tMTK_DISP_OVL_ADAPTOR,\n\tMTK_DISP_POSTMASK,\n\tMTK_DISP_PWM,\n\tMTK_DISP_RDMA,\n\tMTK_DISP_UFOE,\n\tMTK_DISP_WDMA,\n\tMTK_DPI,\n\tMTK_DP_INTF,\n\tMTK_DSI,\n\tMTK_DDP_COMP_TYPE_MAX,\n};\n\nstruct mtk_ddp_comp;\nstruct cmdq_pkt;\nstruct mtk_ddp_comp_funcs {\n\tint (*clk_enable)(struct device *dev);\n\tvoid (*clk_disable)(struct device *dev);\n\tvoid (*config)(struct device *dev, unsigned int w,\n\t\t       unsigned int h, unsigned int vrefresh,\n\t\t       unsigned int bpc, struct cmdq_pkt *cmdq_pkt);\n\tvoid (*start)(struct device *dev);\n\tvoid (*stop)(struct device *dev);\n\tvoid (*register_vblank_cb)(struct device *dev,\n\t\t\t\t   void (*vblank_cb)(void *),\n\t\t\t\t   void *vblank_cb_data);\n\tvoid (*unregister_vblank_cb)(struct device *dev);\n\tvoid (*enable_vblank)(struct device *dev);\n\tvoid (*disable_vblank)(struct device *dev);\n\tunsigned int (*supported_rotations)(struct device *dev);\n\tunsigned int (*layer_nr)(struct device *dev);\n\tint (*layer_check)(struct device *dev,\n\t\t\t   unsigned int idx,\n\t\t\t   struct mtk_plane_state *state);\n\tvoid (*layer_config)(struct device *dev, unsigned int idx,\n\t\t\t     struct mtk_plane_state *state,\n\t\t\t     struct cmdq_pkt *cmdq_pkt);\n\tvoid (*gamma_set)(struct device *dev,\n\t\t\t  struct drm_crtc_state *state);\n\tvoid (*bgclr_in_on)(struct device *dev);\n\tvoid (*bgclr_in_off)(struct device *dev);\n\tvoid (*ctm_set)(struct device *dev,\n\t\t\tstruct drm_crtc_state *state);\n\tstruct device * (*dma_dev_get)(struct device *dev);\n\tconst u32 *(*get_formats)(struct device *dev);\n\tsize_t (*get_num_formats)(struct device *dev);\n\tvoid (*connect)(struct device *dev, struct device *mmsys_dev, unsigned int next);\n\tvoid (*disconnect)(struct device *dev, struct device *mmsys_dev, unsigned int next);\n\tvoid (*add)(struct device *dev, struct mtk_mutex *mutex);\n\tvoid (*remove)(struct device *dev, struct mtk_mutex *mutex);\n};\n\nstruct mtk_ddp_comp {\n\tstruct device *dev;\n\tint irq;\n\tunsigned int id;\n\tconst struct mtk_ddp_comp_funcs *funcs;\n};\n\nstatic inline int mtk_ddp_comp_clk_enable(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->clk_enable)\n\t\treturn comp->funcs->clk_enable(comp->dev);\n\n\treturn 0;\n}\n\nstatic inline void mtk_ddp_comp_clk_disable(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->clk_disable)\n\t\tcomp->funcs->clk_disable(comp->dev);\n}\n\nstatic inline void mtk_ddp_comp_config(struct mtk_ddp_comp *comp,\n\t\t\t\t       unsigned int w, unsigned int h,\n\t\t\t\t       unsigned int vrefresh, unsigned int bpc,\n\t\t\t\t       struct cmdq_pkt *cmdq_pkt)\n{\n\tif (comp->funcs && comp->funcs->config)\n\t\tcomp->funcs->config(comp->dev, w, h, vrefresh, bpc, cmdq_pkt);\n}\n\nstatic inline void mtk_ddp_comp_start(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->start)\n\t\tcomp->funcs->start(comp->dev);\n}\n\nstatic inline void mtk_ddp_comp_stop(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->stop)\n\t\tcomp->funcs->stop(comp->dev);\n}\n\nstatic inline void mtk_ddp_comp_register_vblank_cb(struct mtk_ddp_comp *comp,\n\t\t\t\t\t\t   void (*vblank_cb)(void *),\n\t\t\t\t\t\t   void *vblank_cb_data)\n{\n\tif (comp->funcs && comp->funcs->register_vblank_cb)\n\t\tcomp->funcs->register_vblank_cb(comp->dev, vblank_cb,\n\t\t\t\t\t\tvblank_cb_data);\n}\n\nstatic inline void mtk_ddp_comp_unregister_vblank_cb(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->unregister_vblank_cb)\n\t\tcomp->funcs->unregister_vblank_cb(comp->dev);\n}\n\nstatic inline void mtk_ddp_comp_enable_vblank(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->enable_vblank)\n\t\tcomp->funcs->enable_vblank(comp->dev);\n}\n\nstatic inline void mtk_ddp_comp_disable_vblank(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->disable_vblank)\n\t\tcomp->funcs->disable_vblank(comp->dev);\n}\n\nstatic inline\nunsigned int mtk_ddp_comp_supported_rotations(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->supported_rotations)\n\t\treturn comp->funcs->supported_rotations(comp->dev);\n\n\treturn 0;\n}\n\nstatic inline unsigned int mtk_ddp_comp_layer_nr(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->layer_nr)\n\t\treturn comp->funcs->layer_nr(comp->dev);\n\n\treturn 0;\n}\n\nstatic inline int mtk_ddp_comp_layer_check(struct mtk_ddp_comp *comp,\n\t\t\t\t\t   unsigned int idx,\n\t\t\t\t\t   struct mtk_plane_state *state)\n{\n\tif (comp->funcs && comp->funcs->layer_check)\n\t\treturn comp->funcs->layer_check(comp->dev, idx, state);\n\treturn 0;\n}\n\nstatic inline void mtk_ddp_comp_layer_config(struct mtk_ddp_comp *comp,\n\t\t\t\t\t     unsigned int idx,\n\t\t\t\t\t     struct mtk_plane_state *state,\n\t\t\t\t\t     struct cmdq_pkt *cmdq_pkt)\n{\n\tif (comp->funcs && comp->funcs->layer_config)\n\t\tcomp->funcs->layer_config(comp->dev, idx, state, cmdq_pkt);\n}\n\nstatic inline void mtk_ddp_gamma_set(struct mtk_ddp_comp *comp,\n\t\t\t\t     struct drm_crtc_state *state)\n{\n\tif (comp->funcs && comp->funcs->gamma_set)\n\t\tcomp->funcs->gamma_set(comp->dev, state);\n}\n\nstatic inline void mtk_ddp_comp_bgclr_in_on(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->bgclr_in_on)\n\t\tcomp->funcs->bgclr_in_on(comp->dev);\n}\n\nstatic inline void mtk_ddp_comp_bgclr_in_off(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->bgclr_in_off)\n\t\tcomp->funcs->bgclr_in_off(comp->dev);\n}\n\nstatic inline void mtk_ddp_ctm_set(struct mtk_ddp_comp *comp,\n\t\t\t\t   struct drm_crtc_state *state)\n{\n\tif (comp->funcs && comp->funcs->ctm_set)\n\t\tcomp->funcs->ctm_set(comp->dev, state);\n}\n\nstatic inline struct device *mtk_ddp_comp_dma_dev_get(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->dma_dev_get)\n\t\treturn comp->funcs->dma_dev_get(comp->dev);\n\treturn comp->dev;\n}\n\nstatic inline\nconst u32 *mtk_ddp_comp_get_formats(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->get_formats)\n\t\treturn comp->funcs->get_formats(comp->dev);\n\n\treturn NULL;\n}\n\nstatic inline\nsize_t mtk_ddp_comp_get_num_formats(struct mtk_ddp_comp *comp)\n{\n\tif (comp->funcs && comp->funcs->get_num_formats)\n\t\treturn comp->funcs->get_num_formats(comp->dev);\n\n\treturn 0;\n}\n\nstatic inline bool mtk_ddp_comp_add(struct mtk_ddp_comp *comp, struct mtk_mutex *mutex)\n{\n\tif (comp->funcs && comp->funcs->add) {\n\t\tcomp->funcs->add(comp->dev, mutex);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nstatic inline bool mtk_ddp_comp_remove(struct mtk_ddp_comp *comp, struct mtk_mutex *mutex)\n{\n\tif (comp->funcs && comp->funcs->remove) {\n\t\tcomp->funcs->remove(comp->dev, mutex);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nstatic inline bool mtk_ddp_comp_connect(struct mtk_ddp_comp *comp, struct device *mmsys_dev,\n\t\t\t\t\tunsigned int next)\n{\n\tif (comp->funcs && comp->funcs->connect) {\n\t\tcomp->funcs->connect(comp->dev, mmsys_dev, next);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nstatic inline bool mtk_ddp_comp_disconnect(struct mtk_ddp_comp *comp, struct device *mmsys_dev,\n\t\t\t\t\t   unsigned int next)\n{\n\tif (comp->funcs && comp->funcs->disconnect) {\n\t\tcomp->funcs->disconnect(comp->dev, mmsys_dev, next);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nint mtk_ddp_comp_get_id(struct device_node *node,\n\t\t\tenum mtk_ddp_comp_type comp_type);\nunsigned int mtk_drm_find_possible_crtc_by_comp(struct drm_device *drm,\n\t\t\t\t\t\tstruct device *dev);\nint mtk_ddp_comp_init(struct device_node *comp_node, struct mtk_ddp_comp *comp,\n\t\t      unsigned int comp_id);\nenum mtk_ddp_comp_type mtk_ddp_comp_get_type(unsigned int comp_id);\nvoid mtk_ddp_write(struct cmdq_pkt *cmdq_pkt, unsigned int value,\n\t\t   struct cmdq_client_reg *cmdq_reg, void __iomem *regs,\n\t\t   unsigned int offset);\nvoid mtk_ddp_write_relaxed(struct cmdq_pkt *cmdq_pkt, unsigned int value,\n\t\t\t   struct cmdq_client_reg *cmdq_reg, void __iomem *regs,\n\t\t\t   unsigned int offset);\nvoid mtk_ddp_write_mask(struct cmdq_pkt *cmdq_pkt, unsigned int value,\n\t\t\tstruct cmdq_client_reg *cmdq_reg, void __iomem *regs,\n\t\t\tunsigned int offset, unsigned int mask);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}