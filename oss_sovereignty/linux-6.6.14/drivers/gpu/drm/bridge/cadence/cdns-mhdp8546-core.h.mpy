{
  "module_name": "cdns-mhdp8546-core.h",
  "hash_id": "596bca5c25ea558adf0abcb3c4d19ee0f9ecc3ddb7d5c9200a2702b3c1391867",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/bridge/cadence/cdns-mhdp8546-core.h",
  "human_readable_source": " \n \n\n#ifndef CDNS_MHDP8546_CORE_H\n#define CDNS_MHDP8546_CORE_H\n\n#include <linux/bits.h>\n#include <linux/mutex.h>\n#include <linux/spinlock.h>\n\n#include <drm/display/drm_dp_helper.h>\n#include <drm/drm_bridge.h>\n#include <drm/drm_connector.h>\n\nstruct clk;\nstruct device;\nstruct phy;\n\n \n#define CDNS_APB_CTRL\t\t\t\t0x00000\n#define CDNS_CPU_STALL\t\t\t\tBIT(3)\n\n#define CDNS_MAILBOX_FULL\t\t\t0x00008\n#define CDNS_MAILBOX_EMPTY\t\t\t0x0000c\n#define CDNS_MAILBOX_TX_DATA\t\t\t0x00010\n#define CDNS_MAILBOX_RX_DATA\t\t\t0x00014\n#define CDNS_KEEP_ALIVE\t\t\t\t0x00018\n#define CDNS_KEEP_ALIVE_MASK\t\t\tGENMASK(7, 0)\n\n#define CDNS_VER_L\t\t\t\t0x0001C\n#define CDNS_VER_H\t\t\t\t0x00020\n#define CDNS_LIB_L_ADDR\t\t\t\t0x00024\n#define CDNS_LIB_H_ADDR\t\t\t\t0x00028\n\n#define CDNS_MB_INT_MASK\t\t\t0x00034\n#define CDNS_MB_INT_STATUS\t\t\t0x00038\n\n#define CDNS_SW_CLK_L\t\t\t\t0x0003c\n#define CDNS_SW_CLK_H\t\t\t\t0x00040\n\n#define CDNS_SW_EVENT0\t\t\t\t0x00044\n#define CDNS_DPTX_HPD\t\t\t\tBIT(0)\n#define CDNS_HDCP_TX_STATUS\t\t\tBIT(4)\n#define CDNS_HDCP2_TX_IS_KM_STORED\t\tBIT(5)\n#define CDNS_HDCP2_TX_STORE_KM\t\t\tBIT(6)\n#define CDNS_HDCP_TX_IS_RCVR_ID_VALID\t\tBIT(7)\n\n#define CDNS_SW_EVENT1\t\t\t\t0x00048\n#define CDNS_SW_EVENT2\t\t\t\t0x0004c\n#define CDNS_SW_EVENT3\t\t\t\t0x00050\n\n#define CDNS_APB_INT_MASK\t\t\t0x0006C\n#define CDNS_APB_INT_MASK_MAILBOX_INT\t\tBIT(0)\n#define CDNS_APB_INT_MASK_SW_EVENT_INT\t\tBIT(1)\n\n#define CDNS_APB_INT_STATUS\t\t\t0x00070\n\n#define CDNS_DPTX_CAR\t\t\t\t0x00904\n#define CDNS_VIF_CLK_EN\t\t\t\tBIT(0)\n#define CDNS_VIF_CLK_RSTN\t\t\tBIT(1)\n\n#define CDNS_SOURCE_VIDEO_IF(s)\t\t\t(0x00b00 + ((s) * 0x20))\n#define CDNS_BND_HSYNC2VSYNC(s)\t\t\t(CDNS_SOURCE_VIDEO_IF(s) + \\\n\t\t\t\t\t\t 0x00)\n#define CDNS_IP_DTCT_WIN\t\t\tGENMASK(11, 0)\n#define CDNS_IP_DET_INTERLACE_FORMAT\t\tBIT(12)\n#define CDNS_IP_BYPASS_V_INTERFACE\t\tBIT(13)\n\n#define CDNS_HSYNC2VSYNC_POL_CTRL(s)\t\t(CDNS_SOURCE_VIDEO_IF(s) + \\\n\t\t\t\t\t\t 0x10)\n#define CDNS_H2V_HSYNC_POL_ACTIVE_LOW\t\tBIT(1)\n#define CDNS_H2V_VSYNC_POL_ACTIVE_LOW\t\tBIT(2)\n\n#define CDNS_DPTX_PHY_CONFIG\t\t\t0x02000\n#define CDNS_PHY_TRAINING_EN\t\t\tBIT(0)\n#define CDNS_PHY_TRAINING_TYPE(x)\t\t(((x) & GENMASK(3, 0)) << 1)\n#define CDNS_PHY_SCRAMBLER_BYPASS\t\tBIT(5)\n#define CDNS_PHY_ENCODER_BYPASS\t\t\tBIT(6)\n#define CDNS_PHY_SKEW_BYPASS\t\t\tBIT(7)\n#define CDNS_PHY_TRAINING_AUTO\t\t\tBIT(8)\n#define CDNS_PHY_LANE0_SKEW(x)\t\t\t(((x) & GENMASK(2, 0)) << 9)\n#define CDNS_PHY_LANE1_SKEW(x)\t\t\t(((x) & GENMASK(2, 0)) << 12)\n#define CDNS_PHY_LANE2_SKEW(x)\t\t\t(((x) & GENMASK(2, 0)) << 15)\n#define CDNS_PHY_LANE3_SKEW(x)\t\t\t(((x) & GENMASK(2, 0)) << 18)\n#define CDNS_PHY_COMMON_CONFIG\t\t\t(CDNS_PHY_LANE1_SKEW(1) | \\\n\t\t\t\t\t\tCDNS_PHY_LANE2_SKEW(2) |  \\\n\t\t\t\t\t\tCDNS_PHY_LANE3_SKEW(3))\n#define CDNS_PHY_10BIT_EN\t\t\tBIT(21)\n\n#define CDNS_DP_FRAMER_GLOBAL_CONFIG\t\t0x02200\n#define CDNS_DP_NUM_LANES(x)\t\t\t((x) - 1)\n#define CDNS_DP_MST_EN\t\t\t\tBIT(2)\n#define CDNS_DP_FRAMER_EN\t\t\tBIT(3)\n#define CDNS_DP_RATE_GOVERNOR_EN\t\tBIT(4)\n#define CDNS_DP_NO_VIDEO_MODE\t\t\tBIT(5)\n#define CDNS_DP_DISABLE_PHY_RST\t\t\tBIT(6)\n#define CDNS_DP_WR_FAILING_EDGE_VSYNC\t\tBIT(7)\n\n#define CDNS_DP_FRAMER_TU\t\t\t0x02208\n#define CDNS_DP_FRAMER_TU_SIZE(x)\t\t(((x) & GENMASK(6, 0)) << 8)\n#define CDNS_DP_FRAMER_TU_VS(x)\t\t\t((x) & GENMASK(5, 0))\n#define CDNS_DP_FRAMER_TU_CNT_RST_EN\t\tBIT(15)\n\n#define CDNS_DP_MTPH_CONTROL\t\t\t0x02264\n#define CDNS_DP_MTPH_ECF_EN\t\t\tBIT(0)\n#define CDNS_DP_MTPH_ACT_EN\t\t\tBIT(1)\n#define CDNS_DP_MTPH_LVP_EN\t\t\tBIT(2)\n\n#define CDNS_DP_MTPH_STATUS\t\t\t0x0226C\n#define CDNS_DP_MTPH_ACT_STATUS\t\t\tBIT(0)\n\n#define CDNS_DP_LANE_EN\t\t\t\t0x02300\n#define CDNS_DP_LANE_EN_LANES(x)\t\tGENMASK((x) - 1, 0)\n\n#define CDNS_DP_ENHNCD\t\t\t\t0x02304\n\n#define CDNS_DPTX_STREAM(s)\t\t\t(0x03000 + (s) * 0x80)\n#define CDNS_DP_MSA_HORIZONTAL_0(s)\t\t(CDNS_DPTX_STREAM(s) + 0x00)\n#define CDNS_DP_MSAH0_H_TOTAL(x)\t\t(x)\n#define CDNS_DP_MSAH0_HSYNC_START(x)\t\t((x) << 16)\n\n#define CDNS_DP_MSA_HORIZONTAL_1(s)\t\t(CDNS_DPTX_STREAM(s) + 0x04)\n#define CDNS_DP_MSAH1_HSYNC_WIDTH(x)\t\t(x)\n#define CDNS_DP_MSAH1_HSYNC_POL_LOW\t\tBIT(15)\n#define CDNS_DP_MSAH1_HDISP_WIDTH(x)\t\t((x) << 16)\n\n#define CDNS_DP_MSA_VERTICAL_0(s)\t\t(CDNS_DPTX_STREAM(s) + 0x08)\n#define CDNS_DP_MSAV0_V_TOTAL(x)\t\t(x)\n#define CDNS_DP_MSAV0_VSYNC_START(x)\t\t((x) << 16)\n\n#define CDNS_DP_MSA_VERTICAL_1(s)\t\t(CDNS_DPTX_STREAM(s) + 0x0c)\n#define CDNS_DP_MSAV1_VSYNC_WIDTH(x)\t\t(x)\n#define CDNS_DP_MSAV1_VSYNC_POL_LOW\t\tBIT(15)\n#define CDNS_DP_MSAV1_VDISP_WIDTH(x)\t\t((x) << 16)\n\n#define CDNS_DP_MSA_MISC(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x10)\n#define CDNS_DP_STREAM_CONFIG(s)\t\t(CDNS_DPTX_STREAM(s) + 0x14)\n#define CDNS_DP_STREAM_CONFIG_2(s)\t\t(CDNS_DPTX_STREAM(s) + 0x2c)\n#define CDNS_DP_SC2_TU_VS_DIFF(x)\t\t((x) << 8)\n\n#define CDNS_DP_HORIZONTAL(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x30)\n#define CDNS_DP_H_HSYNC_WIDTH(x)\t\t(x)\n#define CDNS_DP_H_H_TOTAL(x)\t\t\t((x) << 16)\n\n#define CDNS_DP_VERTICAL_0(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x34)\n#define CDNS_DP_V0_VHEIGHT(x)\t\t\t(x)\n#define CDNS_DP_V0_VSTART(x)\t\t\t((x) << 16)\n\n#define CDNS_DP_VERTICAL_1(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x38)\n#define CDNS_DP_V1_VTOTAL(x)\t\t\t(x)\n#define CDNS_DP_V1_VTOTAL_EVEN\t\t\tBIT(16)\n\n#define CDNS_DP_MST_SLOT_ALLOCATE(s)\t\t(CDNS_DPTX_STREAM(s) + 0x44)\n#define CDNS_DP_S_ALLOC_START_SLOT(x)\t\t(x)\n#define CDNS_DP_S_ALLOC_END_SLOT(x)\t\t((x) << 8)\n\n#define CDNS_DP_RATE_GOVERNING(s)\t\t(CDNS_DPTX_STREAM(s) + 0x48)\n#define CDNS_DP_RG_TARG_AV_SLOTS_Y(x)\t\t(x)\n#define CDNS_DP_RG_TARG_AV_SLOTS_X(x)\t\t((x) << 4)\n#define CDNS_DP_RG_ENABLE\t\t\tBIT(10)\n\n#define CDNS_DP_FRAMER_PXL_REPR(s)\t\t(CDNS_DPTX_STREAM(s) + 0x4c)\n#define CDNS_DP_FRAMER_6_BPC\t\t\tBIT(0)\n#define CDNS_DP_FRAMER_8_BPC\t\t\tBIT(1)\n#define CDNS_DP_FRAMER_10_BPC\t\t\tBIT(2)\n#define CDNS_DP_FRAMER_12_BPC\t\t\tBIT(3)\n#define CDNS_DP_FRAMER_16_BPC\t\t\tBIT(4)\n#define CDNS_DP_FRAMER_PXL_FORMAT\t\t0x8\n#define CDNS_DP_FRAMER_RGB\t\t\tBIT(0)\n#define CDNS_DP_FRAMER_YCBCR444\t\t\tBIT(1)\n#define CDNS_DP_FRAMER_YCBCR422\t\t\tBIT(2)\n#define CDNS_DP_FRAMER_YCBCR420\t\t\tBIT(3)\n#define CDNS_DP_FRAMER_Y_ONLY\t\t\tBIT(4)\n\n#define CDNS_DP_FRAMER_SP(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x50)\n#define CDNS_DP_FRAMER_VSYNC_POL_LOW\t\tBIT(0)\n#define CDNS_DP_FRAMER_HSYNC_POL_LOW\t\tBIT(1)\n#define CDNS_DP_FRAMER_INTERLACE\t\tBIT(2)\n\n#define CDNS_DP_LINE_THRESH(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x64)\n#define CDNS_DP_ACTIVE_LINE_THRESH(x)\t\t(x)\n\n#define CDNS_DP_VB_ID(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x68)\n#define CDNS_DP_VB_ID_INTERLACED\t\tBIT(2)\n#define CDNS_DP_VB_ID_COMPRESSED\t\tBIT(6)\n\n#define CDNS_DP_FRONT_BACK_PORCH(s)\t\t(CDNS_DPTX_STREAM(s) + 0x78)\n#define CDNS_DP_BACK_PORCH(x)\t\t\t(x)\n#define CDNS_DP_FRONT_PORCH(x)\t\t\t((x) << 16)\n\n#define CDNS_DP_BYTE_COUNT(s)\t\t\t(CDNS_DPTX_STREAM(s) + 0x7c)\n#define CDNS_DP_BYTE_COUNT_BYTES_IN_CHUNK_SHIFT\t16\n\n \n#define MAILBOX_RETRY_US\t\t\t1000\n#define MAILBOX_TIMEOUT_US\t\t\t2000000\n\n#define MB_OPCODE_ID\t\t\t\t0\n#define MB_MODULE_ID\t\t\t\t1\n#define MB_SIZE_MSB_ID\t\t\t\t2\n#define MB_SIZE_LSB_ID\t\t\t\t3\n#define MB_DATA_ID\t\t\t\t4\n\n#define MB_MODULE_ID_DP_TX\t\t\t0x01\n#define MB_MODULE_ID_HDCP_TX\t\t\t0x07\n#define MB_MODULE_ID_HDCP_RX\t\t\t0x08\n#define MB_MODULE_ID_HDCP_GENERAL\t\t0x09\n#define MB_MODULE_ID_GENERAL\t\t\t0x0a\n\n \n#define FW_NAME\t\t\t\t\t\"cadence/mhdp8546.bin\"\n#define CDNS_MHDP_IMEM\t\t\t\t0x10000\n\n#define GENERAL_MAIN_CONTROL\t\t\t0x01\n#define GENERAL_TEST_ECHO\t\t\t0x02\n#define GENERAL_BUS_SETTINGS\t\t\t0x03\n#define GENERAL_TEST_ACCESS\t\t\t0x04\n#define GENERAL_REGISTER_READ\t\t\t0x07\n\n#define DPTX_SET_POWER_MNG\t\t\t0x00\n#define DPTX_GET_EDID\t\t\t\t0x02\n#define DPTX_READ_DPCD\t\t\t\t0x03\n#define DPTX_WRITE_DPCD\t\t\t\t0x04\n#define DPTX_ENABLE_EVENT\t\t\t0x05\n#define DPTX_WRITE_REGISTER\t\t\t0x06\n#define DPTX_READ_REGISTER\t\t\t0x07\n#define DPTX_WRITE_FIELD\t\t\t0x08\n#define DPTX_READ_EVENT\t\t\t\t0x0a\n#define DPTX_GET_LAST_AUX_STAUS\t\t\t0x0e\n#define DPTX_HPD_STATE\t\t\t\t0x11\n#define DPTX_ADJUST_LT\t\t\t\t0x12\n\n#define FW_STANDBY\t\t\t\t0\n#define FW_ACTIVE\t\t\t\t1\n\n \n#define DPTX_READ_EVENT_HPD_TO_HIGH             BIT(0)\n#define DPTX_READ_EVENT_HPD_TO_LOW              BIT(1)\n#define DPTX_READ_EVENT_HPD_PULSE               BIT(2)\n#define DPTX_READ_EVENT_HPD_STATE               BIT(3)\n\n \n#define CDNS_DP_TRAINING_PATTERN_4\t\t0x7\n\n#define CDNS_KEEP_ALIVE_TIMEOUT\t\t\t2000\n\n#define CDNS_VOLT_SWING(x)\t\t\t((x) & GENMASK(1, 0))\n#define CDNS_FORCE_VOLT_SWING\t\t\tBIT(2)\n\n#define CDNS_PRE_EMPHASIS(x)\t\t\t((x) & GENMASK(1, 0))\n#define CDNS_FORCE_PRE_EMPHASIS\t\t\tBIT(2)\n\n#define CDNS_SUPPORT_TPS(x)\t\t\tBIT((x) - 1)\n\n#define CDNS_FAST_LINK_TRAINING\t\t\tBIT(0)\n\n#define CDNS_LANE_MAPPING_TYPE_C_LANE_0(x)\t((x) & GENMASK(1, 0))\n#define CDNS_LANE_MAPPING_TYPE_C_LANE_1(x)\t((x) & GENMASK(3, 2))\n#define CDNS_LANE_MAPPING_TYPE_C_LANE_2(x)\t((x) & GENMASK(5, 4))\n#define CDNS_LANE_MAPPING_TYPE_C_LANE_3(x)\t((x) & GENMASK(7, 6))\n#define CDNS_LANE_MAPPING_NORMAL\t\t0xe4\n#define CDNS_LANE_MAPPING_FLIPPED\t\t0x1b\n\n#define CDNS_DP_MAX_NUM_LANES\t\t\t4\n#define CDNS_DP_TEST_VSC_SDP\t\t\tBIT(6)  \n#define CDNS_DP_TEST_COLOR_FORMAT_RAW_Y_ONLY\tBIT(7)\n\n#define CDNS_MHDP_MAX_STREAMS\t\t\t4\n\n#define DP_LINK_CAP_ENHANCED_FRAMING\t\tBIT(0)\n\nstruct cdns_mhdp_link {\n\tunsigned char revision;\n\tunsigned int rate;\n\tunsigned int num_lanes;\n\tunsigned long capabilities;\n};\n\nstruct cdns_mhdp_host {\n\tunsigned int link_rate;\n\tu8 lanes_cnt;\n\tu8 volt_swing;\n\tu8 pre_emphasis;\n\tu8 pattern_supp;\n\tu8 lane_mapping;\n\tbool fast_link;\n\tbool enhanced;\n\tbool scrambler;\n\tbool ssc;\n};\n\nstruct cdns_mhdp_sink {\n\tunsigned int link_rate;\n\tu8 lanes_cnt;\n\tu8 pattern_supp;\n\tbool fast_link;\n\tbool enhanced;\n\tbool ssc;\n};\n\nstruct cdns_mhdp_display_fmt {\n\tu32 color_format;\n\tu32 bpc;\n\tbool y_only;\n};\n\n \nenum mhdp_hw_state {\n\tMHDP_HW_READY = 1,\t \n\tMHDP_HW_STOPPED\t\t \n};\n\nstruct cdns_mhdp_device;\n\nstruct mhdp_platform_ops {\n\tint (*init)(struct cdns_mhdp_device *mhdp);\n\tvoid (*exit)(struct cdns_mhdp_device *mhdp);\n\tvoid (*enable)(struct cdns_mhdp_device *mhdp);\n\tvoid (*disable)(struct cdns_mhdp_device *mhdp);\n};\n\nstruct cdns_mhdp_bridge_state {\n\tstruct drm_bridge_state base;\n\tstruct drm_display_mode *current_mode;\n};\n\nstruct cdns_mhdp_platform_info {\n\tconst u32 *input_bus_flags;\n\tconst struct mhdp_platform_ops *ops;\n};\n\n#define to_cdns_mhdp_bridge_state(s) \\\n\t\tcontainer_of(s, struct cdns_mhdp_bridge_state, base)\n\nstruct cdns_mhdp_hdcp {\n\tstruct delayed_work check_work;\n\tstruct work_struct prop_work;\n\tstruct mutex mutex;  \n\tu32 value;\n\tu8 hdcp_content_type;\n};\n\nstruct cdns_mhdp_device {\n\tvoid __iomem *regs;\n\tvoid __iomem *sapb_regs;\n\tvoid __iomem *j721e_regs;\n\n\tstruct device *dev;\n\tstruct clk *clk;\n\tstruct phy *phy;\n\n\tconst struct cdns_mhdp_platform_info *info;\n\n\t \n\tstruct mutex mbox_mutex;\n\n\t \n\tstruct mutex link_mutex;\n\n\tstruct drm_connector connector;\n\tstruct drm_bridge bridge;\n\n\tstruct cdns_mhdp_link link;\n\tstruct drm_dp_aux aux;\n\n\tstruct cdns_mhdp_host host;\n\tstruct cdns_mhdp_sink sink;\n\tstruct cdns_mhdp_display_fmt display_fmt;\n\tu8 stream_id;\n\n\tbool link_up;\n\tbool plugged;\n\n\t \n\tspinlock_t start_lock;\n\tbool bridge_attached;\n\tbool bridge_enabled;\n\tenum mhdp_hw_state hw_state;\n\twait_queue_head_t fw_load_wq;\n\n\t \n\tstruct work_struct modeset_retry_work;\n\tstruct work_struct hpd_work;\n\n\twait_queue_head_t sw_events_wq;\n\tu32 sw_events;\n\n\tstruct cdns_mhdp_hdcp hdcp;\n\tbool hdcp_supported;\n};\n\n#define connector_to_mhdp(x) container_of(x, struct cdns_mhdp_device, connector)\n#define bridge_to_mhdp(x) container_of(x, struct cdns_mhdp_device, bridge)\n\nu32 cdns_mhdp_wait_for_sw_event(struct cdns_mhdp_device *mhdp, uint32_t event);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}