{
  "module_name": "logicvc_mode.c",
  "hash_id": "b145b461bf8060b11c810c37f919894a14aaa085a5948f36bc58e8f752f419b8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/logicvc/logicvc_mode.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n\n#include <drm/drm_atomic.h>\n#include <drm/drm_atomic_helper.h>\n#include <drm/drm_drv.h>\n#include <drm/drm_gem_dma_helper.h>\n#include <drm/drm_gem_framebuffer_helper.h>\n#include <drm/drm_mode_config.h>\n#include <drm/drm_panel.h>\n#include <drm/drm_print.h>\n#include <drm/drm_probe_helper.h>\n#include <drm/drm_vblank.h>\n\n#include \"logicvc_drm.h\"\n#include \"logicvc_interface.h\"\n#include \"logicvc_layer.h\"\n#include \"logicvc_mode.h\"\n\nstatic const struct drm_mode_config_funcs logicvc_mode_config_funcs = {\n\t.fb_create\t\t= drm_gem_fb_create,\n\t.atomic_check\t\t= drm_atomic_helper_check,\n\t.atomic_commit\t\t= drm_atomic_helper_commit,\n};\n\nint logicvc_mode_init(struct logicvc_drm *logicvc)\n{\n\tstruct drm_device *drm_dev = &logicvc->drm_dev;\n\tstruct drm_mode_config *mode_config = &drm_dev->mode_config;\n\tstruct logicvc_layer *layer_primary;\n\tuint32_t preferred_depth;\n\tint ret;\n\n\tret = drm_vblank_init(drm_dev, mode_config->num_crtc);\n\tif (ret) {\n\t\tdrm_err(drm_dev, \"Failed to initialize vblank\\n\");\n\t\treturn ret;\n\t}\n\n\tlayer_primary = logicvc_layer_get_primary(logicvc);\n\tif (!layer_primary) {\n\t\tdrm_err(drm_dev, \"Failed to get primary layer\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tpreferred_depth = layer_primary->formats->depth;\n\n\t \n\tif (layer_primary->formats->alpha)\n\t\tpreferred_depth += 8;\n\n\tmode_config->min_width = 64;\n\tmode_config->max_width = 2048;\n\tmode_config->min_height = 1;\n\tmode_config->max_height = 2048;\n\tmode_config->preferred_depth = preferred_depth;\n\tmode_config->funcs = &logicvc_mode_config_funcs;\n\n\tdrm_mode_config_reset(drm_dev);\n\n\tdrm_kms_helper_poll_init(drm_dev);\n\n\treturn 0;\n}\n\nvoid logicvc_mode_fini(struct logicvc_drm *logicvc)\n{\n\tstruct drm_device *drm_dev = &logicvc->drm_dev;\n\n\tdrm_kms_helper_poll_fini(drm_dev);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}