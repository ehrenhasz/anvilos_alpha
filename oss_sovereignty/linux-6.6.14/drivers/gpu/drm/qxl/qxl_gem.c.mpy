{
  "module_name": "qxl_gem.c",
  "hash_id": "f3a0df192e160bebbd05e6bc299ac395c3b390db9c8ade3bb93b2b55c1afd268",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/qxl/qxl_gem.c",
  "human_readable_source": " \n\n#include <drm/drm.h>\n\n#include \"qxl_drv.h\"\n#include \"qxl_object.h\"\n\nvoid qxl_gem_object_free(struct drm_gem_object *gobj)\n{\n\tstruct qxl_bo *qobj = gem_to_qxl_bo(gobj);\n\tstruct qxl_device *qdev;\n\tstruct ttm_buffer_object *tbo;\n\n\tqdev = to_qxl(gobj->dev);\n\n\tqxl_surface_evict(qdev, qobj, false);\n\n\ttbo = &qobj->tbo;\n\tttm_bo_put(tbo);\n}\n\nint qxl_gem_object_create(struct qxl_device *qdev, int size,\n\t\t\t  int alignment, int initial_domain,\n\t\t\t  bool discardable, bool kernel,\n\t\t\t  struct qxl_surface *surf,\n\t\t\t  struct drm_gem_object **obj)\n{\n\tstruct qxl_bo *qbo;\n\tint r;\n\n\t*obj = NULL;\n\t \n\tif (alignment < PAGE_SIZE)\n\t\talignment = PAGE_SIZE;\n\tr = qxl_bo_create(qdev, size, kernel, false, initial_domain, 0, surf, &qbo);\n\tif (r) {\n\t\tif (r != -ERESTARTSYS)\n\t\t\tDRM_ERROR(\n\t\t\t\"Failed to allocate GEM object (%d, %d, %u, %d)\\n\",\n\t\t\t\t  size, initial_domain, alignment, r);\n\t\treturn r;\n\t}\n\t*obj = &qbo->tbo.base;\n\n\tmutex_lock(&qdev->gem.mutex);\n\tlist_add_tail(&qbo->list, &qdev->gem.objects);\n\tmutex_unlock(&qdev->gem.mutex);\n\n\treturn 0;\n}\n\n \nint qxl_gem_object_create_with_handle(struct qxl_device *qdev,\n\t\t\t\t      struct drm_file *file_priv,\n\t\t\t\t      u32 domain,\n\t\t\t\t      size_t size,\n\t\t\t\t      struct qxl_surface *surf,\n\t\t\t\t      struct drm_gem_object **gobj,\n\t\t\t\t      uint32_t *handle)\n{\n\tint r;\n\tstruct drm_gem_object *local_gobj;\n\n\tBUG_ON(!handle);\n\n\tr = qxl_gem_object_create(qdev, size, 0,\n\t\t\t\t  domain,\n\t\t\t\t  false, false, surf,\n\t\t\t\t  &local_gobj);\n\tif (r)\n\t\treturn -ENOMEM;\n\tr = drm_gem_handle_create(file_priv, local_gobj, handle);\n\tif (r)\n\t\treturn r;\n\n\tif (gobj)\n\t\t*gobj = local_gobj;\n\telse\n\t\t \n\t\tdrm_gem_object_put(local_gobj);\n\n\treturn 0;\n}\n\nint qxl_gem_object_open(struct drm_gem_object *obj, struct drm_file *file_priv)\n{\n\treturn 0;\n}\n\nvoid qxl_gem_object_close(struct drm_gem_object *obj,\n\t\t\t  struct drm_file *file_priv)\n{\n}\n\nvoid qxl_gem_init(struct qxl_device *qdev)\n{\n\tINIT_LIST_HEAD(&qdev->gem.objects);\n}\n\nvoid qxl_gem_fini(struct qxl_device *qdev)\n{\n\tqxl_bo_force_delete(qdev);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}