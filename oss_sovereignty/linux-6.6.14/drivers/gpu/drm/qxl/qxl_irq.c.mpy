{
  "module_name": "qxl_irq.c",
  "hash_id": "2e8a979da53319d04199189fc80c886ee46a99407aee92ddd6470e63f6cd9c5c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/qxl/qxl_irq.c",
  "human_readable_source": " \n\n#include <linux/pci.h>\n\n#include <drm/drm_drv.h>\n\n#include \"qxl_drv.h\"\n\nstatic irqreturn_t qxl_irq_handler(int irq, void *arg)\n{\n\tstruct drm_device *dev = (struct drm_device *) arg;\n\tstruct qxl_device *qdev = to_qxl(dev);\n\tuint32_t pending;\n\n\tpending = xchg(&qdev->ram_header->int_pending, 0);\n\n\tif (!pending)\n\t\treturn IRQ_NONE;\n\n\tatomic_inc(&qdev->irq_received);\n\n\tif (pending & QXL_INTERRUPT_DISPLAY) {\n\t\tatomic_inc(&qdev->irq_received_display);\n\t\twake_up_all(&qdev->display_event);\n\t\tqxl_queue_garbage_collect(qdev, false);\n\t}\n\tif (pending & QXL_INTERRUPT_CURSOR) {\n\t\tatomic_inc(&qdev->irq_received_cursor);\n\t\twake_up_all(&qdev->cursor_event);\n\t}\n\tif (pending & QXL_INTERRUPT_IO_CMD) {\n\t\tatomic_inc(&qdev->irq_received_io_cmd);\n\t\twake_up_all(&qdev->io_cmd_event);\n\t}\n\tif (pending & QXL_INTERRUPT_ERROR) {\n\t\t \n\t\tqdev->irq_received_error++;\n\t\tDRM_WARN(\"driver is in bug mode\\n\");\n\t}\n\tif (pending & QXL_INTERRUPT_CLIENT_MONITORS_CONFIG) {\n\t\tschedule_work(&qdev->client_monitors_config_work);\n\t}\n\tqdev->ram_header->int_mask = QXL_INTERRUPT_MASK;\n\toutb(0, qdev->io_base + QXL_IO_UPDATE_IRQ);\n\treturn IRQ_HANDLED;\n}\n\nstatic void qxl_client_monitors_config_work_func(struct work_struct *work)\n{\n\tstruct qxl_device *qdev = container_of(work, struct qxl_device,\n\t\t\t\t\t       client_monitors_config_work);\n\n\tqxl_display_read_client_monitors_config(qdev);\n}\n\nint qxl_irq_init(struct qxl_device *qdev)\n{\n\tstruct drm_device *ddev = &qdev->ddev;\n\tstruct pci_dev *pdev = to_pci_dev(ddev->dev);\n\tint ret;\n\n\tinit_waitqueue_head(&qdev->display_event);\n\tinit_waitqueue_head(&qdev->cursor_event);\n\tinit_waitqueue_head(&qdev->io_cmd_event);\n\tinit_waitqueue_head(&qdev->release_event);\n\tINIT_WORK(&qdev->client_monitors_config_work,\n\t\t  qxl_client_monitors_config_work_func);\n\tatomic_set(&qdev->irq_received, 0);\n\tatomic_set(&qdev->irq_received_display, 0);\n\tatomic_set(&qdev->irq_received_cursor, 0);\n\tatomic_set(&qdev->irq_received_io_cmd, 0);\n\tqdev->irq_received_error = 0;\n\tret = request_irq(pdev->irq, qxl_irq_handler, IRQF_SHARED, ddev->driver->name, ddev);\n\tqdev->ram_header->int_mask = QXL_INTERRUPT_MASK;\n\tif (unlikely(ret != 0)) {\n\t\tDRM_ERROR(\"Failed installing irq: %d\\n\", ret);\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}