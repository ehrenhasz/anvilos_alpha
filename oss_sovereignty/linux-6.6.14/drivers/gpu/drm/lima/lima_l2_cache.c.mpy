{
  "module_name": "lima_l2_cache.c",
  "hash_id": "f3fa46ed6daeb4f1feef8e1bbb094fa7778f84d45f7dc018f32514fe607b4f6a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/lima/lima_l2_cache.c",
  "human_readable_source": "\n \n\n#include <linux/iopoll.h>\n#include <linux/device.h>\n\n#include \"lima_device.h\"\n#include \"lima_l2_cache.h\"\n#include \"lima_regs.h\"\n\n#define l2_cache_write(reg, data) writel(data, ip->iomem + reg)\n#define l2_cache_read(reg) readl(ip->iomem + reg)\n\nstatic int lima_l2_cache_wait_idle(struct lima_ip *ip)\n{\n\tstruct lima_device *dev = ip->dev;\n\tint err;\n\tu32 v;\n\n\terr = readl_poll_timeout(ip->iomem + LIMA_L2_CACHE_STATUS, v,\n\t\t\t\t !(v & LIMA_L2_CACHE_STATUS_COMMAND_BUSY),\n\t\t\t\t 0, 1000);\n\tif (err) {\n\t\tdev_err(dev->dev, \"l2 cache wait command timeout\\n\");\n\t\treturn err;\n\t}\n\treturn 0;\n}\n\nint lima_l2_cache_flush(struct lima_ip *ip)\n{\n\tint ret;\n\n\tspin_lock(&ip->data.lock);\n\tl2_cache_write(LIMA_L2_CACHE_COMMAND, LIMA_L2_CACHE_COMMAND_CLEAR_ALL);\n\tret = lima_l2_cache_wait_idle(ip);\n\tspin_unlock(&ip->data.lock);\n\treturn ret;\n}\n\nstatic int lima_l2_cache_hw_init(struct lima_ip *ip)\n{\n\tint err;\n\n\terr = lima_l2_cache_flush(ip);\n\tif (err)\n\t\treturn err;\n\n\tl2_cache_write(LIMA_L2_CACHE_ENABLE,\n\t\t       LIMA_L2_CACHE_ENABLE_ACCESS |\n\t\t       LIMA_L2_CACHE_ENABLE_READ_ALLOCATE);\n\tl2_cache_write(LIMA_L2_CACHE_MAX_READS, 0x1c);\n\n\treturn 0;\n}\n\nint lima_l2_cache_resume(struct lima_ip *ip)\n{\n\treturn lima_l2_cache_hw_init(ip);\n}\n\nvoid lima_l2_cache_suspend(struct lima_ip *ip)\n{\n\n}\n\nint lima_l2_cache_init(struct lima_ip *ip)\n{\n\tint i;\n\tu32 size;\n\tstruct lima_device *dev = ip->dev;\n\n\t \n\tif (ip->id == lima_ip_l2_cache2) {\n\t\tfor (i = lima_ip_pp4; i <= lima_ip_pp7; i++) {\n\t\t\tif (dev->ip[i].present)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (i > lima_ip_pp7)\n\t\t\treturn -ENODEV;\n\t}\n\n\tspin_lock_init(&ip->data.lock);\n\n\tsize = l2_cache_read(LIMA_L2_CACHE_SIZE);\n\tdev_info(dev->dev, \"l2 cache %uK, %u-way, %ubyte cache line, %ubit external bus\\n\",\n\t\t 1 << (((size >> 16) & 0xff) - 10),\n\t\t 1 << ((size >> 8) & 0xff),\n\t\t 1 << (size & 0xff),\n\t\t 1 << ((size >> 24) & 0xff));\n\n\treturn lima_l2_cache_hw_init(ip);\n}\n\nvoid lima_l2_cache_fini(struct lima_ip *ip)\n{\n\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}