{
  "module_name": "panel-novatek-nt36672a.c",
  "hash_id": "54bf7613bb58b2be1505478c4f40ab72ea786d58ed981041a2ae1ef91bde75fd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/panel/panel-novatek-nt36672a.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/of.h>\n\n#include <linux/gpio/consumer.h>\n#include <linux/pinctrl/consumer.h>\n#include <linux/regulator/consumer.h>\n\n#include <drm/drm_device.h>\n#include <drm/drm_mipi_dsi.h>\n#include <drm/drm_modes.h>\n#include <drm/drm_panel.h>\n\n#include <video/mipi_display.h>\n\nstruct nt36672a_panel_cmd {\n\tconst char data[2];\n};\n\nstatic const char * const nt36672a_regulator_names[] = {\n\t\"vddio\",\n\t\"vddpos\",\n\t\"vddneg\",\n};\n\nstatic unsigned long const nt36672a_regulator_enable_loads[] = {\n\t62000,\n\t100000,\n\t100000\n};\n\nstruct nt36672a_panel_desc {\n\tconst struct drm_display_mode *display_mode;\n\tconst char *panel_name;\n\n\tunsigned int width_mm;\n\tunsigned int height_mm;\n\n\tunsigned long mode_flags;\n\tenum mipi_dsi_pixel_format format;\n\tunsigned int lanes;\n\n\tunsigned int num_on_cmds_1;\n\tconst struct nt36672a_panel_cmd *on_cmds_1;\n\tunsigned int num_on_cmds_2;\n\tconst struct nt36672a_panel_cmd *on_cmds_2;\n\n\tunsigned int num_off_cmds;\n\tconst struct nt36672a_panel_cmd *off_cmds;\n};\n\nstruct nt36672a_panel {\n\tstruct drm_panel base;\n\tstruct mipi_dsi_device *link;\n\tconst struct nt36672a_panel_desc *desc;\n\n\tstruct regulator_bulk_data supplies[ARRAY_SIZE(nt36672a_regulator_names)];\n\n\tstruct gpio_desc *reset_gpio;\n\n\tbool prepared;\n};\n\nstatic inline struct nt36672a_panel *to_nt36672a_panel(struct drm_panel *panel)\n{\n\treturn container_of(panel, struct nt36672a_panel, base);\n}\n\nstatic int nt36672a_send_cmds(struct drm_panel *panel, const struct nt36672a_panel_cmd *cmds,\n\t\t\t      int num)\n{\n\tstruct nt36672a_panel *pinfo = to_nt36672a_panel(panel);\n\tunsigned int i;\n\tint err;\n\n\tfor (i = 0; i < num; i++) {\n\t\tconst struct nt36672a_panel_cmd *cmd = &cmds[i];\n\n\t\terr = mipi_dsi_dcs_write(pinfo->link, cmd->data[0], cmd->data + 1, 1);\n\n\t\tif (err < 0)\n\t\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\nstatic int nt36672a_panel_power_off(struct drm_panel *panel)\n{\n\tstruct nt36672a_panel *pinfo = to_nt36672a_panel(panel);\n\tint ret = 0;\n\n\tgpiod_set_value(pinfo->reset_gpio, 1);\n\n\tret = regulator_bulk_disable(ARRAY_SIZE(pinfo->supplies), pinfo->supplies);\n\tif (ret)\n\t\tdev_err(panel->dev, \"regulator_bulk_disable failed %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic int nt36672a_panel_unprepare(struct drm_panel *panel)\n{\n\tstruct nt36672a_panel *pinfo = to_nt36672a_panel(panel);\n\tint ret;\n\n\tif (!pinfo->prepared)\n\t\treturn 0;\n\n\t \n\tret = nt36672a_send_cmds(panel, pinfo->desc->off_cmds,\n\t\t\t\t pinfo->desc->num_off_cmds);\n\n\tif (ret < 0)\n\t\tdev_err(panel->dev, \"failed to send DCS off cmds: %d\\n\", ret);\n\n\tret = mipi_dsi_dcs_set_display_off(pinfo->link);\n\tif (ret < 0)\n\t\tdev_err(panel->dev, \"set_display_off cmd failed ret = %d\\n\", ret);\n\n\t \n\tmsleep(120);\n\n\tret = mipi_dsi_dcs_enter_sleep_mode(pinfo->link);\n\tif (ret < 0)\n\t\tdev_err(panel->dev, \"enter_sleep cmd failed ret = %d\\n\", ret);\n\n\t \n\tmsleep(60);\n\n\tret = nt36672a_panel_power_off(panel);\n\tif (ret < 0)\n\t\tdev_err(panel->dev, \"power_off failed ret = %d\\n\", ret);\n\n\tpinfo->prepared = false;\n\n\treturn ret;\n}\n\nstatic int nt36672a_panel_power_on(struct nt36672a_panel *pinfo)\n{\n\tint ret;\n\n\tret = regulator_bulk_enable(ARRAY_SIZE(pinfo->supplies), pinfo->supplies);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tgpiod_set_value(pinfo->reset_gpio, 1);\n\tmsleep(200);\n\tgpiod_set_value(pinfo->reset_gpio, 0);\n\tmsleep(200);\n\n\treturn 0;\n}\n\nstatic int nt36672a_panel_prepare(struct drm_panel *panel)\n{\n\tstruct nt36672a_panel *pinfo = to_nt36672a_panel(panel);\n\tint err;\n\n\tif (pinfo->prepared)\n\t\treturn 0;\n\n\terr = nt36672a_panel_power_on(pinfo);\n\tif (err < 0)\n\t\tgoto poweroff;\n\n\t \n\terr = nt36672a_send_cmds(panel, pinfo->desc->on_cmds_1,\n\t\t\t\t pinfo->desc->num_on_cmds_1);\n\n\tif (err < 0) {\n\t\tdev_err(panel->dev, \"failed to send DCS Init 1st Code: %d\\n\", err);\n\t\tgoto poweroff;\n\t}\n\n\terr = mipi_dsi_dcs_exit_sleep_mode(pinfo->link);\n\tif (err < 0) {\n\t\tdev_err(panel->dev, \"failed to exit sleep mode: %d\\n\", err);\n\t\tgoto poweroff;\n\t}\n\n\t \n\tmsleep(70);\n\n\terr = mipi_dsi_dcs_set_display_on(pinfo->link);\n\tif (err < 0) {\n\t\tdev_err(panel->dev, \"failed to Set Display ON: %d\\n\", err);\n\t\tgoto poweroff;\n\t}\n\n\t \n\terr = nt36672a_send_cmds(panel, pinfo->desc->on_cmds_2,\n\t\t\t\t pinfo->desc->num_on_cmds_2);\n\n\tif (err < 0) {\n\t\tdev_err(panel->dev, \"failed to send DCS Init 2nd Code: %d\\n\", err);\n\t\tgoto poweroff;\n\t}\n\n\tmsleep(120);\n\n\tpinfo->prepared = true;\n\n\treturn 0;\n\npoweroff:\n\tgpiod_set_value(pinfo->reset_gpio, 0);\n\treturn err;\n}\n\nstatic int nt36672a_panel_get_modes(struct drm_panel *panel,\n\t\t\t\t    struct drm_connector *connector)\n{\n\tstruct nt36672a_panel *pinfo = to_nt36672a_panel(panel);\n\tconst struct drm_display_mode *m = pinfo->desc->display_mode;\n\tstruct drm_display_mode *mode;\n\n\tmode = drm_mode_duplicate(connector->dev, m);\n\tif (!mode) {\n\t\tdev_err(panel->dev, \"failed to add mode %ux%u@%u\\n\", m->hdisplay,\n\t\t\tm->vdisplay, drm_mode_vrefresh(m));\n\t\treturn -ENOMEM;\n\t}\n\n\tconnector->display_info.width_mm = pinfo->desc->width_mm;\n\tconnector->display_info.height_mm = pinfo->desc->height_mm;\n\n\tdrm_mode_set_name(mode);\n\tdrm_mode_probed_add(connector, mode);\n\n\treturn 1;\n}\n\nstatic const struct drm_panel_funcs panel_funcs = {\n\t.unprepare = nt36672a_panel_unprepare,\n\t.prepare = nt36672a_panel_prepare,\n\t.get_modes = nt36672a_panel_get_modes,\n};\n\nstatic const struct nt36672a_panel_cmd tianma_fhd_video_on_cmds_1[] = {\n\t \n\t{ .data = {0xFF, 0x22} },\n\t{ .data = {0x00, 0x40} },\n\t{ .data = {0x01, 0xC0} },\n\t{ .data = {0x02, 0x40} },\n\t{ .data = {0x03, 0x40} },\n\t{ .data = {0x04, 0x40} },\n\t{ .data = {0x05, 0x40} },\n\t{ .data = {0x06, 0x40} },\n\t{ .data = {0x07, 0x40} },\n\t{ .data = {0x08, 0x40} },\n\t{ .data = {0x09, 0x40} },\n\t{ .data = {0x0A, 0x40} },\n\t{ .data = {0x0B, 0x40} },\n\t{ .data = {0x0C, 0x40} },\n\t{ .data = {0x0D, 0x40} },\n\t{ .data = {0x0E, 0x40} },\n\t{ .data = {0x0F, 0x40} },\n\t{ .data = {0x10, 0x40} },\n\t{ .data = {0x11, 0x50} },\n\t{ .data = {0x12, 0x60} },\n\t{ .data = {0x13, 0x70} },\n\t{ .data = {0x14, 0x58} },\n\t{ .data = {0x15, 0x68} },\n\t{ .data = {0x16, 0x78} },\n\t{ .data = {0x17, 0x77} },\n\t{ .data = {0x18, 0x39} },\n\t{ .data = {0x19, 0x2D} },\n\t{ .data = {0x1A, 0x2E} },\n\t{ .data = {0x1B, 0x32} },\n\t{ .data = {0x1C, 0x37} },\n\t{ .data = {0x1D, 0x3A} },\n\t{ .data = {0x1E, 0x40} },\n\t{ .data = {0x1F, 0x40} },\n\t{ .data = {0x20, 0x40} },\n\t{ .data = {0x21, 0x40} },\n\t{ .data = {0x22, 0x40} },\n\t{ .data = {0x23, 0x40} },\n\t{ .data = {0x24, 0x40} },\n\t{ .data = {0x25, 0x40} },\n\t{ .data = {0x26, 0x40} },\n\t{ .data = {0x27, 0x40} },\n\t{ .data = {0x28, 0x40} },\n\t{ .data = {0x2D, 0x00} },\n\t{ .data = {0x2F, 0x40} },\n\t{ .data = {0x30, 0x40} },\n\t{ .data = {0x31, 0x40} },\n\t{ .data = {0x32, 0x40} },\n\t{ .data = {0x33, 0x40} },\n\t{ .data = {0x34, 0x40} },\n\t{ .data = {0x35, 0x40} },\n\t{ .data = {0x36, 0x40} },\n\t{ .data = {0x37, 0x40} },\n\t{ .data = {0x38, 0x40} },\n\t{ .data = {0x39, 0x40} },\n\t{ .data = {0x3A, 0x40} },\n\t{ .data = {0x3B, 0x40} },\n\t{ .data = {0x3D, 0x40} },\n\t{ .data = {0x3F, 0x40} },\n\t{ .data = {0x40, 0x40} },\n\t{ .data = {0x41, 0x40} },\n\t{ .data = {0x42, 0x40} },\n\t{ .data = {0x43, 0x40} },\n\t{ .data = {0x44, 0x40} },\n\t{ .data = {0x45, 0x40} },\n\t{ .data = {0x46, 0x40} },\n\t{ .data = {0x47, 0x40} },\n\t{ .data = {0x48, 0x40} },\n\t{ .data = {0x49, 0x40} },\n\t{ .data = {0x4A, 0x40} },\n\t{ .data = {0x4B, 0x40} },\n\t{ .data = {0x4C, 0x40} },\n\t{ .data = {0x4D, 0x40} },\n\t{ .data = {0x4E, 0x40} },\n\t{ .data = {0x4F, 0x40} },\n\t{ .data = {0x50, 0x40} },\n\t{ .data = {0x51, 0x40} },\n\t{ .data = {0x52, 0x40} },\n\t{ .data = {0x53, 0x01} },\n\t{ .data = {0x54, 0x01} },\n\t{ .data = {0x55, 0xFE} },\n\t{ .data = {0x56, 0x77} },\n\t{ .data = {0x58, 0xCD} },\n\t{ .data = {0x59, 0xD0} },\n\t{ .data = {0x5A, 0xD0} },\n\t{ .data = {0x5B, 0x50} },\n\t{ .data = {0x5C, 0x50} },\n\t{ .data = {0x5D, 0x50} },\n\t{ .data = {0x5E, 0x50} },\n\t{ .data = {0x5F, 0x50} },\n\t{ .data = {0x60, 0x50} },\n\t{ .data = {0x61, 0x50} },\n\t{ .data = {0x62, 0x50} },\n\t{ .data = {0x63, 0x50} },\n\t{ .data = {0x64, 0x50} },\n\t{ .data = {0x65, 0x50} },\n\t{ .data = {0x66, 0x50} },\n\t{ .data = {0x67, 0x50} },\n\t{ .data = {0x68, 0x50} },\n\t{ .data = {0x69, 0x50} },\n\t{ .data = {0x6A, 0x50} },\n\t{ .data = {0x6B, 0x50} },\n\t{ .data = {0x6C, 0x50} },\n\t{ .data = {0x6D, 0x50} },\n\t{ .data = {0x6E, 0x50} },\n\t{ .data = {0x6F, 0x50} },\n\t{ .data = {0x70, 0x07} },\n\t{ .data = {0x71, 0x00} },\n\t{ .data = {0x72, 0x00} },\n\t{ .data = {0x73, 0x00} },\n\t{ .data = {0x74, 0x06} },\n\t{ .data = {0x75, 0x0C} },\n\t{ .data = {0x76, 0x03} },\n\t{ .data = {0x77, 0x09} },\n\t{ .data = {0x78, 0x0F} },\n\t{ .data = {0x79, 0x68} },\n\t{ .data = {0x7A, 0x88} },\n\t{ .data = {0x7C, 0x80} },\n\t{ .data = {0x7D, 0x80} },\n\t{ .data = {0x7E, 0x80} },\n\t{ .data = {0x7F, 0x00} },\n\t{ .data = {0x80, 0x00} },\n\t{ .data = {0x81, 0x00} },\n\t{ .data = {0x83, 0x01} },\n\t{ .data = {0x84, 0x00} },\n\t{ .data = {0x85, 0x80} },\n\t{ .data = {0x86, 0x80} },\n\t{ .data = {0x87, 0x80} },\n\t{ .data = {0x88, 0x40} },\n\t{ .data = {0x89, 0x91} },\n\t{ .data = {0x8A, 0x98} },\n\t{ .data = {0x8B, 0x80} },\n\t{ .data = {0x8C, 0x80} },\n\t{ .data = {0x8D, 0x80} },\n\t{ .data = {0x8E, 0x80} },\n\t{ .data = {0x8F, 0x80} },\n\t{ .data = {0x90, 0x80} },\n\t{ .data = {0x91, 0x80} },\n\t{ .data = {0x92, 0x80} },\n\t{ .data = {0x93, 0x80} },\n\t{ .data = {0x94, 0x80} },\n\t{ .data = {0x95, 0x80} },\n\t{ .data = {0x96, 0x80} },\n\t{ .data = {0x97, 0x80} },\n\t{ .data = {0x98, 0x80} },\n\t{ .data = {0x99, 0x80} },\n\t{ .data = {0x9A, 0x80} },\n\t{ .data = {0x9B, 0x80} },\n\t{ .data = {0x9C, 0x80} },\n\t{ .data = {0x9D, 0x80} },\n\t{ .data = {0x9E, 0x80} },\n\t{ .data = {0x9F, 0x80} },\n\t{ .data = {0xA0, 0x8A} },\n\t{ .data = {0xA2, 0x80} },\n\t{ .data = {0xA6, 0x80} },\n\t{ .data = {0xA7, 0x80} },\n\t{ .data = {0xA9, 0x80} },\n\t{ .data = {0xAA, 0x80} },\n\t{ .data = {0xAB, 0x80} },\n\t{ .data = {0xAC, 0x80} },\n\t{ .data = {0xAD, 0x80} },\n\t{ .data = {0xAE, 0x80} },\n\t{ .data = {0xAF, 0x80} },\n\t{ .data = {0xB7, 0x76} },\n\t{ .data = {0xB8, 0x76} },\n\t{ .data = {0xB9, 0x05} },\n\t{ .data = {0xBA, 0x0D} },\n\t{ .data = {0xBB, 0x14} },\n\t{ .data = {0xBC, 0x0F} },\n\t{ .data = {0xBD, 0x18} },\n\t{ .data = {0xBE, 0x1F} },\n\t{ .data = {0xBF, 0x05} },\n\t{ .data = {0xC0, 0x0D} },\n\t{ .data = {0xC1, 0x14} },\n\t{ .data = {0xC2, 0x03} },\n\t{ .data = {0xC3, 0x07} },\n\t{ .data = {0xC4, 0x0A} },\n\t{ .data = {0xC5, 0xA0} },\n\t{ .data = {0xC6, 0x55} },\n\t{ .data = {0xC7, 0xFF} },\n\t{ .data = {0xC8, 0x39} },\n\t{ .data = {0xC9, 0x44} },\n\t{ .data = {0xCA, 0x12} },\n\t{ .data = {0xCD, 0x80} },\n\t{ .data = {0xDB, 0x80} },\n\t{ .data = {0xDC, 0x80} },\n\t{ .data = {0xDD, 0x80} },\n\t{ .data = {0xE0, 0x80} },\n\t{ .data = {0xE1, 0x80} },\n\t{ .data = {0xE2, 0x80} },\n\t{ .data = {0xE3, 0x80} },\n\t{ .data = {0xE4, 0x80} },\n\t{ .data = {0xE5, 0x40} },\n\t{ .data = {0xE6, 0x40} },\n\t{ .data = {0xE7, 0x40} },\n\t{ .data = {0xE8, 0x40} },\n\t{ .data = {0xE9, 0x40} },\n\t{ .data = {0xEA, 0x40} },\n\t{ .data = {0xEB, 0x40} },\n\t{ .data = {0xEC, 0x40} },\n\t{ .data = {0xED, 0x40} },\n\t{ .data = {0xEE, 0x40} },\n\t{ .data = {0xEF, 0x40} },\n\t{ .data = {0xF0, 0x40} },\n\t{ .data = {0xF1, 0x40} },\n\t{ .data = {0xF2, 0x40} },\n\t{ .data = {0xF3, 0x40} },\n\t{ .data = {0xF4, 0x40} },\n\t{ .data = {0xF5, 0x40} },\n\t{ .data = {0xF6, 0x40} },\n\t{ .data = {0xFB, 0x1} },\n\t{ .data = {0xFF, 0x23} },\n\t{ .data = {0xFB, 0x01} },\n\t \n\t{ .data = {0x01, 0x84} },\n\t{ .data = {0x05, 0x2D} },\n\t{ .data = {0x06, 0x00} },\n\t  \n\t{ .data = {0x11, 0x01} },\n\t{ .data = {0x12, 0x7B} },\n\t{ .data = {0x15, 0x6F} },\n\t{ .data = {0x16, 0x0B} },\n\t  \n\t{ .data = {0x29, 0x0A} },\n\t{ .data = {0x30, 0xFF} },\n\t{ .data = {0x31, 0xFF} },\n\t{ .data = {0x32, 0xFF} },\n\t{ .data = {0x33, 0xFF} },\n\t{ .data = {0x34, 0xFF} },\n\t{ .data = {0x35, 0xFF} },\n\t{ .data = {0x36, 0xFF} },\n\t{ .data = {0x37, 0xFF} },\n\t{ .data = {0x38, 0xFC} },\n\t{ .data = {0x39, 0xF8} },\n\t{ .data = {0x3A, 0xF4} },\n\t{ .data = {0x3B, 0xF1} },\n\t{ .data = {0x3D, 0xEE} },\n\t{ .data = {0x3F, 0xEB} },\n\t{ .data = {0x40, 0xE8} },\n\t{ .data = {0x41, 0xE5} },\n\t  \n\t{ .data = {0x2A, 0x13} },\n\t{ .data = {0x45, 0xFF} },\n\t{ .data = {0x46, 0xFF} },\n\t{ .data = {0x47, 0xFF} },\n\t{ .data = {0x48, 0xFF} },\n\t{ .data = {0x49, 0xFF} },\n\t{ .data = {0x4A, 0xFF} },\n\t{ .data = {0x4B, 0xFF} },\n\t{ .data = {0x4C, 0xFF} },\n\t{ .data = {0x4D, 0xED} },\n\t{ .data = {0x4E, 0xD5} },\n\t{ .data = {0x4F, 0xBF} },\n\t{ .data = {0x50, 0xA6} },\n\t{ .data = {0x51, 0x96} },\n\t{ .data = {0x52, 0x86} },\n\t{ .data = {0x53, 0x76} },\n\t{ .data = {0x54, 0x66} },\n\t  \n\t{ .data = {0x2B, 0x0E} },\n\t{ .data = {0x58, 0xFF} },\n\t{ .data = {0x59, 0xFF} },\n\t{ .data = {0x5A, 0xFF} },\n\t{ .data = {0x5B, 0xFF} },\n\t{ .data = {0x5C, 0xFF} },\n\t{ .data = {0x5D, 0xFF} },\n\t{ .data = {0x5E, 0xFF} },\n\t{ .data = {0x5F, 0xFF} },\n\t{ .data = {0x60, 0xF6} },\n\t{ .data = {0x61, 0xEA} },\n\t{ .data = {0x62, 0xE1} },\n\t{ .data = {0x63, 0xD8} },\n\t{ .data = {0x64, 0xCE} },\n\t{ .data = {0x65, 0xC3} },\n\t{ .data = {0x66, 0xBA} },\n\t{ .data = {0x67, 0xB3} },\n\t{ .data = {0xFF, 0x25} },\n\t{ .data = {0xFB, 0x01} },\n\t{ .data = {0x05, 0x04} },\n\t{ .data = {0xFF, 0x26} },\n\t{ .data = {0xFB, 0x01} },\n\t{ .data = {0x1C, 0xAF} },\n\t{ .data = {0xFF, 0x10} },\n\t{ .data = {0xFB, 0x01} },\n\t{ .data = {0x51, 0xFF} },\n\t{ .data = {0x53, 0x24} },\n\t{ .data = {0x55, 0x00} },\n};\n\nstatic const struct nt36672a_panel_cmd tianma_fhd_video_on_cmds_2[] = {\n\t{ .data = {0xFF, 0x24} },\n\t{ .data = {0xFB, 0x01} },\n\t{ .data = {0xC3, 0x01} },\n\t{ .data = {0xC4, 0x54} },\n\t{ .data = {0xFF, 0x10} },\n};\n\nstatic const struct nt36672a_panel_cmd tianma_fhd_video_off_cmds[] = {\n\t{ .data = {0xFF, 0x24} },\n\t{ .data = {0xFB, 0x01} },\n\t{ .data = {0xC3, 0x01} },\n\t{ .data = {0xFF, 0x10} },\n};\n\nstatic const struct drm_display_mode tianma_fhd_video_panel_default_mode = {\n\t.clock\t\t= 161331,\n\n\t.hdisplay\t= 1080,\n\t.hsync_start\t= 1080 + 40,\n\t.hsync_end\t= 1080 + 40 + 20,\n\t.htotal\t\t= 1080 + 40 + 20 + 44,\n\n\t.vdisplay\t= 2246,\n\t.vsync_start\t= 2246 + 15,\n\t.vsync_end\t= 2246 + 15 + 2,\n\t.vtotal\t\t= 2246 + 15 + 2 + 8,\n\n\t.type = DRM_MODE_TYPE_DRIVER | DRM_MODE_TYPE_PREFERRED,\n};\n\nstatic const struct nt36672a_panel_desc tianma_fhd_video_panel_desc = {\n\t.display_mode = &tianma_fhd_video_panel_default_mode,\n\n\t.width_mm = 68,\n\t.height_mm = 136,\n\n\t.mode_flags = MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_VIDEO\n\t\t\t| MIPI_DSI_MODE_VIDEO_HSE\n\t\t\t| MIPI_DSI_CLOCK_NON_CONTINUOUS\n\t\t\t| MIPI_DSI_MODE_VIDEO_BURST,\n\t.format = MIPI_DSI_FMT_RGB888,\n\t.lanes = 4,\n\t.on_cmds_1 = tianma_fhd_video_on_cmds_1,\n\t.num_on_cmds_1 = ARRAY_SIZE(tianma_fhd_video_on_cmds_1),\n\t.on_cmds_2 = tianma_fhd_video_on_cmds_2,\n\t.num_on_cmds_2 = ARRAY_SIZE(tianma_fhd_video_on_cmds_2),\n\t.off_cmds = tianma_fhd_video_off_cmds,\n\t.num_off_cmds = ARRAY_SIZE(tianma_fhd_video_off_cmds),\n};\n\nstatic int nt36672a_panel_add(struct nt36672a_panel *pinfo)\n{\n\tstruct device *dev = &pinfo->link->dev;\n\tint i, ret;\n\n\tfor (i = 0; i < ARRAY_SIZE(pinfo->supplies); i++)\n\t\tpinfo->supplies[i].supply = nt36672a_regulator_names[i];\n\n\tret = devm_regulator_bulk_get(dev, ARRAY_SIZE(pinfo->supplies),\n\t\t\t\t      pinfo->supplies);\n\tif (ret < 0)\n\t\treturn dev_err_probe(dev, ret, \"failed to get regulators\\n\");\n\n\tfor (i = 0; i < ARRAY_SIZE(pinfo->supplies); i++) {\n\t\tret = regulator_set_load(pinfo->supplies[i].consumer,\n\t\t\t\t\t nt36672a_regulator_enable_loads[i]);\n\t\tif (ret)\n\t\t\treturn dev_err_probe(dev, ret, \"failed to set regulator enable loads\\n\");\n\t}\n\n\tpinfo->reset_gpio = devm_gpiod_get(dev, \"reset\", GPIOD_OUT_LOW);\n\tif (IS_ERR(pinfo->reset_gpio))\n\t\treturn dev_err_probe(dev, PTR_ERR(pinfo->reset_gpio),\n\t\t\t\t     \"failed to get reset gpio from DT\\n\");\n\n\tdrm_panel_init(&pinfo->base, dev, &panel_funcs, DRM_MODE_CONNECTOR_DSI);\n\n\tret = drm_panel_of_backlight(&pinfo->base);\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret, \"Failed to get backlight\\n\");\n\n\tdrm_panel_add(&pinfo->base);\n\n\treturn 0;\n}\n\nstatic int nt36672a_panel_probe(struct mipi_dsi_device *dsi)\n{\n\tstruct nt36672a_panel *pinfo;\n\tconst struct nt36672a_panel_desc *desc;\n\tint err;\n\n\tpinfo = devm_kzalloc(&dsi->dev, sizeof(*pinfo), GFP_KERNEL);\n\tif (!pinfo)\n\t\treturn -ENOMEM;\n\n\tdesc = of_device_get_match_data(&dsi->dev);\n\tdsi->mode_flags = desc->mode_flags;\n\tdsi->format = desc->format;\n\tdsi->lanes = desc->lanes;\n\tpinfo->desc = desc;\n\tpinfo->link = dsi;\n\n\tmipi_dsi_set_drvdata(dsi, pinfo);\n\n\terr = nt36672a_panel_add(pinfo);\n\tif (err < 0)\n\t\treturn err;\n\n\terr = mipi_dsi_attach(dsi);\n\tif (err < 0) {\n\t\tdrm_panel_remove(&pinfo->base);\n\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\nstatic void nt36672a_panel_remove(struct mipi_dsi_device *dsi)\n{\n\tstruct nt36672a_panel *pinfo = mipi_dsi_get_drvdata(dsi);\n\tint err;\n\n\terr = drm_panel_unprepare(&pinfo->base);\n\tif (err < 0)\n\t\tdev_err(&dsi->dev, \"failed to unprepare panel: %d\\n\", err);\n\n\terr = drm_panel_disable(&pinfo->base);\n\tif (err < 0)\n\t\tdev_err(&dsi->dev, \"failed to disable panel: %d\\n\", err);\n\n\terr = mipi_dsi_detach(dsi);\n\tif (err < 0)\n\t\tdev_err(&dsi->dev, \"failed to detach from DSI host: %d\\n\", err);\n\n\tdrm_panel_remove(&pinfo->base);\n}\n\nstatic void nt36672a_panel_shutdown(struct mipi_dsi_device *dsi)\n{\n\tstruct nt36672a_panel *pinfo = mipi_dsi_get_drvdata(dsi);\n\n\tdrm_panel_disable(&pinfo->base);\n\tdrm_panel_unprepare(&pinfo->base);\n}\n\nstatic const struct of_device_id tianma_fhd_video_of_match[] = {\n\t{ .compatible = \"tianma,fhd-video\", .data = &tianma_fhd_video_panel_desc },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, tianma_fhd_video_of_match);\n\nstatic struct mipi_dsi_driver nt36672a_panel_driver = {\n\t.driver = {\n\t\t.name = \"panel-tianma-nt36672a\",\n\t\t.of_match_table = tianma_fhd_video_of_match,\n\t},\n\t.probe = nt36672a_panel_probe,\n\t.remove = nt36672a_panel_remove,\n\t.shutdown = nt36672a_panel_shutdown,\n};\nmodule_mipi_dsi_driver(nt36672a_panel_driver);\n\nMODULE_AUTHOR(\"Sumit Semwal <sumit.semwal@linaro.org>\");\nMODULE_DESCRIPTION(\"NOVATEK NT36672A based MIPI-DSI LCD panel driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}