{
  "module_name": "panel-samsung-s6e63m0-dsi.c",
  "hash_id": "1d3945789edcbe5b5d2f870adedfd0b1937bb727e05d7311a124865519da3a34",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/panel/panel-samsung-s6e63m0-dsi.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/delay.h>\n#include <linux/mod_devicetable.h>\n\n#include <drm/drm_mipi_dsi.h>\n#include <drm/drm_print.h>\n\n#include \"panel-samsung-s6e63m0.h\"\n\n#define MCS_GLOBAL_PARAM\t0xb0\n#define S6E63M0_DSI_MAX_CHUNK\t15  \n\nstatic int s6e63m0_dsi_dcs_read(struct device *dev, void *trsp,\n\t\t\t\tconst u8 cmd, u8 *data)\n{\n\tstruct mipi_dsi_device *dsi = to_mipi_dsi_device(dev);\n\tint ret;\n\n\tret = mipi_dsi_dcs_read(dsi, cmd, data, 1);\n\tif (ret < 0) {\n\t\tdev_err(dev, \"could not read DCS CMD %02x\\n\", cmd);\n\t\treturn ret;\n\t}\n\n\tdev_dbg(dev, \"DSI read CMD %02x = %02x\\n\", cmd, *data);\n\n\treturn 0;\n}\n\nstatic int s6e63m0_dsi_dcs_write(struct device *dev, void *trsp,\n\t\t\t\t const u8 *data, size_t len)\n{\n\tstruct mipi_dsi_device *dsi = to_mipi_dsi_device(dev);\n\tconst u8 *seqp = data;\n\tu8 cmd;\n\tu8 cmdwritten;\n\tint remain;\n\tint chunk;\n\tint ret;\n\n\tdev_dbg(dev, \"DSI writing dcs seq: %*ph\\n\", (int)len, data);\n\n\t \n\tcmd = *seqp;\n\tseqp++;\n\tcmdwritten = 0;\n\tremain = len - 1;\n\tchunk = remain;\n\n\t \n\tif (chunk > S6E63M0_DSI_MAX_CHUNK)\n\t\tchunk = S6E63M0_DSI_MAX_CHUNK;\n\tret = mipi_dsi_dcs_write(dsi, cmd, seqp, chunk);\n\tif (ret < 0) {\n\t\tdev_err(dev, \"error sending DCS command seq cmd %02x\\n\", cmd);\n\t\treturn ret;\n\t}\n\tcmdwritten += chunk;\n\tseqp += chunk;\n\n\twhile (cmdwritten < remain) {\n\t\tchunk = remain - cmdwritten;\n\t\tif (chunk > S6E63M0_DSI_MAX_CHUNK)\n\t\t\tchunk = S6E63M0_DSI_MAX_CHUNK;\n\t\tret = mipi_dsi_dcs_write(dsi, MCS_GLOBAL_PARAM, &cmdwritten, 1);\n\t\tif (ret < 0) {\n\t\t\tdev_err(dev, \"error sending CMD %02x global param %02x\\n\",\n\t\t\t\tcmd, cmdwritten);\n\t\t\treturn ret;\n\t\t}\n\t\tret = mipi_dsi_dcs_write(dsi, cmd, seqp, chunk);\n\t\tif (ret < 0) {\n\t\t\tdev_err(dev, \"error sending CMD %02x chunk\\n\", cmd);\n\t\t\treturn ret;\n\t\t}\n\t\tcmdwritten += chunk;\n\t\tseqp += chunk;\n\t}\n\tdev_dbg(dev, \"sent command %02x %02x bytes\\n\", cmd, cmdwritten);\n\n\tusleep_range(8000, 9000);\n\n\treturn 0;\n}\n\nstatic int s6e63m0_dsi_probe(struct mipi_dsi_device *dsi)\n{\n\tstruct device *dev = &dsi->dev;\n\tint ret;\n\n\tdsi->lanes = 2;\n\tdsi->format = MIPI_DSI_FMT_RGB888;\n\tdsi->hs_rate = 349440000;\n\tdsi->lp_rate = 9600000;\n\tdsi->mode_flags = MIPI_DSI_MODE_VIDEO |\n\t\tMIPI_DSI_MODE_VIDEO_BURST;\n\n\tret = s6e63m0_probe(dev, NULL, s6e63m0_dsi_dcs_read,\n\t\t\t    s6e63m0_dsi_dcs_write, true);\n\tif (ret)\n\t\treturn ret;\n\n\tret = mipi_dsi_attach(dsi);\n\tif (ret < 0)\n\t\ts6e63m0_remove(dev);\n\n\treturn ret;\n}\n\nstatic void s6e63m0_dsi_remove(struct mipi_dsi_device *dsi)\n{\n\tmipi_dsi_detach(dsi);\n\ts6e63m0_remove(&dsi->dev);\n}\n\nstatic const struct of_device_id s6e63m0_dsi_of_match[] = {\n\t{ .compatible = \"samsung,s6e63m0\" },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, s6e63m0_dsi_of_match);\n\nstatic struct mipi_dsi_driver s6e63m0_dsi_driver = {\n\t.probe\t\t\t= s6e63m0_dsi_probe,\n\t.remove\t\t\t= s6e63m0_dsi_remove,\n\t.driver\t\t\t= {\n\t\t.name\t\t= \"panel-samsung-s6e63m0\",\n\t\t.of_match_table = s6e63m0_dsi_of_match,\n\t},\n};\nmodule_mipi_dsi_driver(s6e63m0_dsi_driver);\n\nMODULE_AUTHOR(\"Linus Walleij <linusw@kernel.org>\");\nMODULE_DESCRIPTION(\"s6e63m0 LCD DSI Driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}