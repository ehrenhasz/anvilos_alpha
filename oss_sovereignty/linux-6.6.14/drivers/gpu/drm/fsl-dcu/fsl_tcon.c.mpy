{
  "module_name": "fsl_tcon.c",
  "hash_id": "188bb98137628ef8e37dbbc7169191c0c9a6258e131a6f7b29294dcec643e20a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/fsl-dcu/fsl_tcon.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/io.h>\n#include <linux/mm.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\n#include \"fsl_tcon.h\"\n\nvoid fsl_tcon_bypass_disable(struct fsl_tcon *tcon)\n{\n\tregmap_update_bits(tcon->regs, FSL_TCON_CTRL1,\n\t\t\t   FSL_TCON_CTRL1_TCON_BYPASS, 0);\n}\n\nvoid fsl_tcon_bypass_enable(struct fsl_tcon *tcon)\n{\n\tregmap_update_bits(tcon->regs, FSL_TCON_CTRL1,\n\t\t\t   FSL_TCON_CTRL1_TCON_BYPASS,\n\t\t\t   FSL_TCON_CTRL1_TCON_BYPASS);\n}\n\nstatic struct regmap_config fsl_tcon_regmap_config = {\n\t.reg_bits = 32,\n\t.reg_stride = 4,\n\t.val_bits = 32,\n\n\t.name = \"tcon\",\n};\n\nstatic int fsl_tcon_init_regmap(struct device *dev,\n\t\t\t\tstruct fsl_tcon *tcon,\n\t\t\t\tstruct device_node *np)\n{\n\tstruct resource res;\n\tvoid __iomem *regs;\n\n\tif (of_address_to_resource(np, 0, &res))\n\t\treturn -EINVAL;\n\n\tregs = devm_ioremap_resource(dev, &res);\n\tif (IS_ERR(regs))\n\t\treturn PTR_ERR(regs);\n\n\ttcon->regs = devm_regmap_init_mmio(dev, regs,\n\t\t\t\t\t   &fsl_tcon_regmap_config);\n\treturn PTR_ERR_OR_ZERO(tcon->regs);\n}\n\nstruct fsl_tcon *fsl_tcon_init(struct device *dev)\n{\n\tstruct fsl_tcon *tcon;\n\tstruct device_node *np;\n\tint ret;\n\n\t \n\tnp = of_parse_phandle(dev->of_node, \"fsl,tcon\", 0);\n\tif (!np)\n\t\treturn NULL;\n\n\ttcon = devm_kzalloc(dev, sizeof(*tcon), GFP_KERNEL);\n\tif (!tcon)\n\t\tgoto err_node_put;\n\n\tret = fsl_tcon_init_regmap(dev, tcon, np);\n\tif (ret) {\n\t\tdev_err(dev, \"Couldn't create the TCON regmap\\n\");\n\t\tgoto err_node_put;\n\t}\n\n\ttcon->ipg_clk = of_clk_get_by_name(np, \"ipg\");\n\tif (IS_ERR(tcon->ipg_clk)) {\n\t\tdev_err(dev, \"Couldn't get the TCON bus clock\\n\");\n\t\tgoto err_node_put;\n\t}\n\n\tret = clk_prepare_enable(tcon->ipg_clk);\n\tif (ret) {\n\t\tdev_err(dev, \"Couldn't enable the TCON clock\\n\");\n\t\tgoto err_node_put;\n\t}\n\n\tof_node_put(np);\n\tdev_info(dev, \"Using TCON in bypass mode\\n\");\n\n\treturn tcon;\n\nerr_node_put:\n\tof_node_put(np);\n\treturn NULL;\n}\n\nvoid fsl_tcon_free(struct fsl_tcon *tcon)\n{\n\tclk_disable_unprepare(tcon->ipg_clk);\n\tclk_put(tcon->ipg_clk);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}