{
  "module_name": "drm_privacy_screen_x86.c",
  "hash_id": "da452aae7cf020443afa14e32b319e9b5836477c77867e9621fc13ab095d1fee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/drm_privacy_screen_x86.c",
  "human_readable_source": "\n \n\n#include <linux/acpi.h>\n#include <drm/drm_privacy_screen_machine.h>\n\n#ifdef CONFIG_X86\nstatic struct drm_privacy_screen_lookup arch_lookup;\n\nstruct arch_init_data {\n\tstruct drm_privacy_screen_lookup lookup;\n\tbool (*detect)(void);\n};\n\n#if IS_ENABLED(CONFIG_THINKPAD_ACPI)\nstatic acpi_status __init acpi_set_handle(acpi_handle handle, u32 level,\n\t\t\t\t\t  void *context, void **return_value)\n{\n\t*(acpi_handle *)return_value = handle;\n\treturn AE_CTRL_TERMINATE;\n}\n\nstatic bool __init detect_thinkpad_privacy_screen(void)\n{\n\tunion acpi_object obj = { .type = ACPI_TYPE_INTEGER };\n\tstruct acpi_object_list args = { .count = 1, .pointer = &obj, };\n\tacpi_handle ec_handle = NULL;\n\tunsigned long long output;\n\tacpi_status status;\n\n\tif (acpi_disabled)\n\t\treturn false;\n\n\t \n\tstatus = acpi_get_devices(\"PNP0C09\", acpi_set_handle, NULL, &ec_handle);\n\tif (ACPI_FAILURE(status) || !ec_handle)\n\t\treturn false;\n\n\t \n\tstatus = acpi_evaluate_integer(ec_handle, \"HKEY.GSSS\", &args, &output);\n\tif (ACPI_FAILURE(status))\n\t\treturn false;\n\n\treturn (output & 0x10000) ? true : false;\n}\n#endif\n\n#if IS_ENABLED(CONFIG_CHROMEOS_PRIVACY_SCREEN)\nstatic bool __init detect_chromeos_privacy_screen(void)\n{\n\treturn acpi_dev_present(\"GOOG0010\", NULL, -1);\n}\n#endif\n\nstatic const struct arch_init_data arch_init_data[] __initconst = {\n#if IS_ENABLED(CONFIG_THINKPAD_ACPI)\n\t{\n\t\t.lookup = {\n\t\t\t.dev_id = NULL,\n\t\t\t.con_id = NULL,\n\t\t\t.provider = \"privacy_screen-thinkpad_acpi\",\n\t\t},\n\t\t.detect = detect_thinkpad_privacy_screen,\n\t},\n#endif\n#if IS_ENABLED(CONFIG_CHROMEOS_PRIVACY_SCREEN)\n\t{\n\t\t.lookup = {\n\t\t\t.dev_id = NULL,\n\t\t\t.con_id = NULL,\n\t\t\t.provider = \"privacy_screen-GOOG0010:00\",\n\t\t},\n\t\t.detect = detect_chromeos_privacy_screen,\n\t},\n#endif\n};\n\nvoid __init drm_privacy_screen_lookup_init(void)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(arch_init_data); i++) {\n\t\tif (!arch_init_data[i].detect())\n\t\t\tcontinue;\n\n\t\tpr_info(\"Found '%s' privacy-screen provider\\n\",\n\t\t\tarch_init_data[i].lookup.provider);\n\n\t\t \n\t\tarch_lookup = arch_init_data[i].lookup;\n\t\tdrm_privacy_screen_lookup_add(&arch_lookup);\n\t\tbreak;\n\t}\n}\n\nvoid drm_privacy_screen_lookup_exit(void)\n{\n\tif (arch_lookup.provider)\n\t\tdrm_privacy_screen_lookup_remove(&arch_lookup);\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}