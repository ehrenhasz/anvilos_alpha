{
  "module_name": "kmb_dsi.h",
  "hash_id": "c69a254aff9957044fd959f1bc00da23b5f090a43f846e2f90850953bc29e7c1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/kmb/kmb_dsi.h",
  "human_readable_source": " \n\n#ifndef __KMB_DSI_H__\n#define __KMB_DSI_H__\n\n#include <drm/drm_encoder.h>\n#include <drm/drm_mipi_dsi.h>\n\n \n#define MIPI_TX_LANE_DATA_RATE_MBPS 891\n#define MIPI_TX_REF_CLK_KHZ         24000\n#define MIPI_TX_CFG_CLK_KHZ         24000\n#define MIPI_TX_BPP\t\t    24\n\n \n#define TEST_CODE_FSM_CONTROL\t\t\t\t0x03\n#define TEST_CODE_MULTIPLE_PHY_CTRL\t\t\t0x0C\n#define TEST_CODE_PLL_PROPORTIONAL_CHARGE_PUMP_CTRL\t0x0E\n#define TEST_CODE_PLL_INTEGRAL_CHARGE_PUMP_CTRL\t\t0x0F\n#define TEST_CODE_PLL_VCO_CTRL\t\t\t\t0x12\n#define TEST_CODE_PLL_GMP_CTRL\t\t\t\t0x13\n#define TEST_CODE_PLL_PHASE_ERR_CTRL\t\t\t0x14\n#define TEST_CODE_PLL_LOCK_FILTER\t\t\t0x15\n#define TEST_CODE_PLL_UNLOCK_FILTER\t\t\t0x16\n#define TEST_CODE_PLL_INPUT_DIVIDER\t\t\t0x17\n#define TEST_CODE_PLL_FEEDBACK_DIVIDER\t\t\t0x18\n#define   PLL_FEEDBACK_DIVIDER_HIGH\t\t\tBIT(7)\n#define TEST_CODE_PLL_OUTPUT_CLK_SEL\t\t\t0x19\n#define   PLL_N_OVR_EN\t\t\t\t\tBIT(4)\n#define   PLL_M_OVR_EN\t\t\t\t\tBIT(5)\n#define TEST_CODE_VOD_LEVEL\t\t\t\t0x24\n#define TEST_CODE_PLL_CHARGE_PUMP_BIAS\t\t\t0x1C\n#define TEST_CODE_PLL_LOCK_DETECTOR\t\t\t0x1D\n#define TEST_CODE_HS_FREQ_RANGE_CFG\t\t\t0x44\n#define TEST_CODE_PLL_ANALOG_PROG\t\t\t0x1F\n#define TEST_CODE_SLEW_RATE_OVERRIDE_CTRL\t\t0xA0\n#define TEST_CODE_SLEW_RATE_DDL_LOOP_CTRL\t\t0xA3\n#define TEST_CODE_SLEW_RATE_DDL_CYCLES\t\t\t0xA4\n\n \n#define PLL_N_MIN\t0\n#define PLL_N_MAX\t15\n#define PLL_M_MIN\t62\n#define PLL_M_MAX\t623\n#define PLL_FVCO_MAX\t1250\n\n#define TIMEOUT\t\t600\n\n#define MIPI_TX_FRAME_GEN\t\t\t\t4\n#define MIPI_TX_FRAME_GEN_SECTIONS\t\t\t4\n#define MIPI_CTRL_VIRTUAL_CHANNELS\t\t\t4\n#define MIPI_D_LANES_PER_DPHY\t\t\t\t2\n#define MIPI_CTRL_2LANE_MAX_MC_FIFO_LOC\t\t\t255\n#define MIPI_CTRL_4LANE_MAX_MC_FIFO_LOC\t\t\t511\n \n#define MIPI_DPHY_D_LANES\t\t\t\t2\n#define MIPI_DPHY_DEFAULT_BIT_RATES\t\t\t63\n\n#define KMB_MIPI_DEFAULT_CLK\t\t\t\t24000000\n#define KMB_MIPI_DEFAULT_CFG_CLK\t\t\t24000000\n\n#define to_kmb_dsi(x) container_of(x, struct kmb_dsi, base)\n\nstruct kmb_dsi {\n\tstruct drm_encoder base;\n\tstruct device *dev;\n\tstruct platform_device *pdev;\n\tstruct mipi_dsi_host *host;\n\tstruct mipi_dsi_device *device;\n\tstruct drm_bridge *adv_bridge;\n\tvoid __iomem *mipi_mmio;\n\tstruct clk *clk_mipi;\n\tstruct clk *clk_mipi_ecfg;\n\tstruct clk *clk_mipi_cfg;\n\tint sys_clk_mhz;\n};\n\n \n\nenum mipi_ctrl_num {\n\tMIPI_CTRL0 = 0,\n\tMIPI_CTRL1,\n\tMIPI_CTRL2,\n\tMIPI_CTRL3,\n\tMIPI_CTRL4,\n\tMIPI_CTRL5,\n\tMIPI_CTRL6,\n\tMIPI_CTRL7,\n\tMIPI_CTRL8,\n\tMIPI_CTRL9,\n\tMIPI_CTRL_NA\n};\n\nenum mipi_dphy_num {\n\tMIPI_DPHY0 = 0,\n\tMIPI_DPHY1,\n\tMIPI_DPHY2,\n\tMIPI_DPHY3,\n\tMIPI_DPHY4,\n\tMIPI_DPHY5,\n\tMIPI_DPHY6,\n\tMIPI_DPHY7,\n\tMIPI_DPHY8,\n\tMIPI_DPHY9,\n\tMIPI_DPHY_NA\n};\n\nenum mipi_dir {\n\tMIPI_RX,\n\tMIPI_TX\n};\n\nenum mipi_ctrl_type {\n\tMIPI_DSI,\n\tMIPI_CSI\n};\n\nenum mipi_data_if {\n\tMIPI_IF_DMA,\n\tMIPI_IF_PARALLEL\n};\n\nenum mipi_data_mode {\n\tMIPI_DATA_MODE0,\n\tMIPI_DATA_MODE1,\n\tMIPI_DATA_MODE2,\n\tMIPI_DATA_MODE3\n};\n\nenum mipi_dsi_video_mode {\n\tDSI_VIDEO_MODE_NO_BURST_PULSE,\n\tDSI_VIDEO_MODE_NO_BURST_EVENT,\n\tDSI_VIDEO_MODE_BURST\n};\n\nenum mipi_dsi_blanking_mode {\n\tTRANSITION_TO_LOW_POWER,\n\tSEND_BLANK_PACKET\n};\n\nenum mipi_dsi_eotp {\n\tDSI_EOTP_DISABLED,\n\tDSI_EOTP_ENABLES\n};\n\nenum mipi_dsi_data_type {\n\tDSI_SP_DT_RESERVED_00 = 0x00,\n\tDSI_SP_DT_VSYNC_START = 0x01,\n\tDSI_SP_DT_COLOR_MODE_OFF = 0x02,\n\tDSI_SP_DT_GENERIC_SHORT_WR = 0x03,\n\tDSI_SP_DT_GENERIC_RD = 0x04,\n\tDSI_SP_DT_DCS_SHORT_WR = 0x05,\n\tDSI_SP_DT_DCS_RD = 0x06,\n\tDSI_SP_DT_EOTP = 0x08,\n\tDSI_LP_DT_NULL = 0x09,\n\tDSI_LP_DT_RESERVED_0A = 0x0a,\n\tDSI_LP_DT_RESERVED_0B = 0x0b,\n\tDSI_LP_DT_LPPS_YCBCR422_20B = 0x0c,\n\tDSI_LP_DT_PPS_RGB101010_30B = 0x0d,\n\tDSI_LP_DT_PPS_RGB565_16B = 0x0e,\n\tDSI_LP_DT_RESERVED_0F = 0x0f,\n\n\tDSI_SP_DT_RESERVED_10 = 0x10,\n\tDSI_SP_DT_VSYNC_END = 0x11,\n\tDSI_SP_DT_COLOR_MODE_ON = 0x12,\n\tDSI_SP_DT_GENERIC_SHORT_WR_1PAR = 0x13,\n\tDSI_SP_DT_GENERIC_RD_1PAR = 0x14,\n\tDSI_SP_DT_DCS_SHORT_WR_1PAR = 0x15,\n\tDSI_SP_DT_RESERVED_16 = 0x16,\n\tDSI_SP_DT_RESERVED_17 = 0x17,\n\tDSI_SP_DT_RESERVED_18 = 0x18,\n\tDSI_LP_DT_BLANK = 0x19,\n\tDSI_LP_DT_RESERVED_1A = 0x1a,\n\tDSI_LP_DT_RESERVED_1B = 0x1b,\n\tDSI_LP_DT_PPS_YCBCR422_24B = 0x1c,\n\tDSI_LP_DT_PPS_RGB121212_36B = 0x1d,\n\tDSI_LP_DT_PPS_RGB666_18B = 0x1e,\n\tDSI_LP_DT_RESERVED_1F = 0x1f,\n\n\tDSI_SP_DT_RESERVED_20 = 0x20,\n\tDSI_SP_DT_HSYNC_START = 0x21,\n\tDSI_SP_DT_SHUT_DOWN_PERIPH_CMD = 0x22,\n\tDSI_SP_DT_GENERIC_SHORT_WR_2PAR = 0x23,\n\tDSI_SP_DT_GENERIC_RD_2PAR = 0x24,\n\tDSI_SP_DT_RESERVED_25 = 0x25,\n\tDSI_SP_DT_RESERVED_26 = 0x26,\n\tDSI_SP_DT_RESERVED_27 = 0x27,\n\tDSI_SP_DT_RESERVED_28 = 0x28,\n\tDSI_LP_DT_GENERIC_LONG_WR = 0x29,\n\tDSI_LP_DT_RESERVED_2A = 0x2a,\n\tDSI_LP_DT_RESERVED_2B = 0x2b,\n\tDSI_LP_DT_PPS_YCBCR422_16B = 0x2c,\n\tDSI_LP_DT_RESERVED_2D = 0x2d,\n\tDSI_LP_DT_LPPS_RGB666_18B = 0x2e,\n\tDSI_LP_DT_RESERVED_2F = 0x2f,\n\n\tDSI_SP_DT_RESERVED_30 = 0x30,\n\tDSI_SP_DT_HSYNC_END = 0x31,\n\tDSI_SP_DT_TURN_ON_PERIPH_CMD = 0x32,\n\tDSI_SP_DT_RESERVED_33 = 0x33,\n\tDSI_SP_DT_RESERVED_34 = 0x34,\n\tDSI_SP_DT_RESERVED_35 = 0x35,\n\tDSI_SP_DT_RESERVED_36 = 0x36,\n\tDSI_SP_DT_SET_MAX_RETURN_PKT_SIZE = 0x37,\n\tDSI_SP_DT_RESERVED_38 = 0x38,\n\tDSI_LP_DT_DSC_LONG_WR = 0x39,\n\tDSI_LP_DT_RESERVED_3A = 0x3a,\n\tDSI_LP_DT_RESERVED_3B = 0x3b,\n\tDSI_LP_DT_RESERVED_3C = 0x3c,\n\tDSI_LP_DT_PPS_YCBCR420_12B = 0x3d,\n\tDSI_LP_DT_PPS_RGB888_24B = 0x3e,\n\tDSI_LP_DT_RESERVED_3F = 0x3f\n};\n\nenum mipi_tx_hs_tp_sel {\n\tMIPI_TX_HS_TP_WHOLE_FRAME_COLOR0 = 0,\n\tMIPI_TX_HS_TP_WHOLE_FRAME_COLOR1,\n\tMIPI_TX_HS_TP_V_STRIPES,\n\tMIPI_TX_HS_TP_H_STRIPES,\n};\n\nenum dphy_mode {\n\tMIPI_DPHY_SLAVE = 0,\n\tMIPI_DPHY_MASTER\n};\n\nenum dphy_tx_fsm {\n\tDPHY_TX_POWERDWN = 0,\n\tDPHY_TX_BGPON,\n\tDPHY_TX_TERMCAL,\n\tDPHY_TX_TERMCALUP,\n\tDPHY_TX_OFFSETCAL,\n\tDPHY_TX_LOCK,\n\tDPHY_TX_SRCAL,\n\tDPHY_TX_IDLE,\n\tDPHY_TX_ULP,\n\tDPHY_TX_LANESTART,\n\tDPHY_TX_CLKALIGN,\n\tDPHY_TX_DDLTUNNING,\n\tDPHY_TX_ULP_FORCE_PLL,\n\tDPHY_TX_LOCK_LOSS\n};\n\nstruct mipi_data_type_params {\n\tu8 size_constraint_pixels;\n\tu8 size_constraint_bytes;\n\tu8 pixels_per_pclk;\n\tu8 bits_per_pclk;\n};\n\nstruct mipi_tx_dsi_cfg {\n\tu8 hfp_blank_en;\t \n\tu8 eotp_en;\t\t \n\t \n\tu8 lpm_last_vfp_line;\n\t \n\tu8 lpm_first_vsa_line;\n\tu8 sync_pulse_eventn;\t \n\tu8 hfp_blanking;\t \n\tu8 hbp_blanking;\t \n\tu8 hsa_blanking;\t \n\tu8 v_blanking;\t\t \n};\n\nstruct mipi_tx_frame_section_cfg {\n\tu32 dma_v_stride;\n\tu16 dma_v_scale_cfg;\n\tu16 width_pixels;\n\tu16 height_lines;\n\tu8 dma_packed;\n\tu8 bpp;\n\tu8 bpp_unpacked;\n\tu8 dma_h_stride;\n\tu8 data_type;\n\tu8 data_mode;\n\tu8 dma_flip_rotate_sel;\n};\n\nstruct mipi_tx_frame_timing_cfg {\n\tu32 bpp;\n\tu32 lane_rate_mbps;\n\tu32 hsync_width;\n\tu32 h_backporch;\n\tu32 h_frontporch;\n\tu32 h_active;\n\tu16 vsync_width;\n\tu16 v_backporch;\n\tu16 v_frontporch;\n\tu16 v_active;\n\tu8 active_lanes;\n};\n\nstruct mipi_tx_frame_sect_phcfg {\n\tu32 wc;\n\tenum mipi_data_mode data_mode;\n\tenum mipi_dsi_data_type data_type;\n\tu8 vchannel;\n\tu8 dma_packed;\n};\n\nstruct mipi_tx_frame_cfg {\n\tstruct mipi_tx_frame_section_cfg *sections[MIPI_TX_FRAME_GEN_SECTIONS];\n\tu32 hsync_width;\t \n\tu32 h_backporch;\t \n\tu32 h_frontporch;\t \n\tu16 vsync_width;\t \n\tu16 v_backporch;\t \n\tu16 v_frontporch;\t \n};\n\nstruct mipi_tx_ctrl_cfg {\n\tstruct mipi_tx_frame_cfg *frames[MIPI_TX_FRAME_GEN];\n\tconst struct mipi_tx_dsi_cfg *tx_dsi_cfg;\n\tu8 line_sync_pkt_en;\n\tu8 line_counter_active;\n\tu8 frame_counter_active;\n\tu8 tx_hsclkkidle_cnt;\n\tu8 tx_hsexit_cnt;\n\tu8 tx_crc_en;\n\tu8 tx_hact_wait_stop;\n\tu8 tx_always_use_hact;\n\tu8 tx_wait_trig;\n\tu8 tx_wait_all_sect;\n};\n\n \nstruct mipi_ctrl_cfg {\n\tu8 active_lanes;\t \n\tu32 lane_rate_mbps;\t \n\tu32 ref_clk_khz;\n\tu32 cfg_clk_khz;\n\tstruct mipi_tx_ctrl_cfg tx_ctrl_cfg;\n};\n\nstatic inline void kmb_write_mipi(struct kmb_dsi *kmb_dsi,\n\t\t\t\t  unsigned int reg, u32 value)\n{\n\twritel(value, (kmb_dsi->mipi_mmio + reg));\n}\n\nstatic inline u32 kmb_read_mipi(struct kmb_dsi *kmb_dsi, unsigned int reg)\n{\n\treturn readl(kmb_dsi->mipi_mmio + reg);\n}\n\nstatic inline void kmb_write_bits_mipi(struct kmb_dsi *kmb_dsi,\n\t\t\t\t       unsigned int reg, u32 offset,\n\t\t\t\t       u32 num_bits, u32 value)\n{\n\tu32 reg_val = kmb_read_mipi(kmb_dsi, reg);\n\tu32 mask = (1 << num_bits) - 1;\n\n\tvalue &= mask;\n\tmask <<= offset;\n\treg_val &= (~mask);\n\treg_val |= (value << offset);\n\tkmb_write_mipi(kmb_dsi, reg, reg_val);\n}\n\nstatic inline void kmb_set_bit_mipi(struct kmb_dsi *kmb_dsi,\n\t\t\t\t    unsigned int reg, u32 offset)\n{\n\tu32 reg_val = kmb_read_mipi(kmb_dsi, reg);\n\n\tkmb_write_mipi(kmb_dsi, reg, reg_val | (1 << offset));\n}\n\nstatic inline void kmb_clr_bit_mipi(struct kmb_dsi *kmb_dsi,\n\t\t\t\t    unsigned int reg, u32 offset)\n{\n\tu32 reg_val = kmb_read_mipi(kmb_dsi, reg);\n\n\tkmb_write_mipi(kmb_dsi, reg, reg_val & (~(1 << offset)));\n}\n\nint kmb_dsi_host_bridge_init(struct device *dev);\nstruct kmb_dsi *kmb_dsi_init(struct platform_device *pdev);\nvoid kmb_dsi_host_unregister(struct kmb_dsi *kmb_dsi);\nint kmb_dsi_mode_set(struct kmb_dsi *kmb_dsi, struct drm_display_mode *mode,\n\t\t     int sys_clk_mhz, struct drm_atomic_state *old_state);\nint kmb_dsi_map_mmio(struct kmb_dsi *kmb_dsi);\nint kmb_dsi_clk_init(struct kmb_dsi *kmb_dsi);\nint kmb_dsi_encoder_init(struct drm_device *dev, struct kmb_dsi *kmb_dsi);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}