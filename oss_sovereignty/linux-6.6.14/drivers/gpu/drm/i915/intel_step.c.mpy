{
  "module_name": "intel_step.c",
  "hash_id": "97d97c3a63634f4fa41aee29d0bd5162bf7b0b48467f0e2ce31e37db7daeaec1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/intel_step.c",
  "human_readable_source": "\n \n\n#include \"i915_drv.h\"\n#include \"intel_step.h\"\n\n \n\n \n#define COMMON_STEP(x)  .graphics_step = STEP_##x, .display_step = STEP_##x, .media_step = STEP_##x\n#define COMMON_GT_MEDIA_STEP(x)  .graphics_step = STEP_##x, .media_step = STEP_##x\n\nstatic const struct intel_step_info skl_revids[] = {\n\t[0x6] = { COMMON_STEP(G0) },\n\t[0x7] = { COMMON_STEP(H0) },\n\t[0x9] = { COMMON_STEP(J0) },\n\t[0xA] = { COMMON_STEP(I1) },\n};\n\nstatic const struct intel_step_info kbl_revids[] = {\n\t[1] = { COMMON_GT_MEDIA_STEP(B0), .display_step = STEP_B0 },\n\t[2] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_B0 },\n\t[3] = { COMMON_GT_MEDIA_STEP(D0), .display_step = STEP_B0 },\n\t[4] = { COMMON_GT_MEDIA_STEP(F0), .display_step = STEP_C0 },\n\t[5] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_B1 },\n\t[6] = { COMMON_GT_MEDIA_STEP(D1), .display_step = STEP_B1 },\n\t[7] = { COMMON_GT_MEDIA_STEP(G0), .display_step = STEP_C0 },\n};\n\nstatic const struct intel_step_info bxt_revids[] = {\n\t[0xA] = { COMMON_STEP(C0) },\n\t[0xB] = { COMMON_STEP(C0) },\n\t[0xC] = { COMMON_STEP(D0) },\n\t[0xD] = { COMMON_STEP(E0) },\n};\n\nstatic const struct intel_step_info glk_revids[] = {\n\t[3] = { COMMON_STEP(B0) },\n};\n\nstatic const struct intel_step_info icl_revids[] = {\n\t[7] = { COMMON_STEP(D0) },\n};\n\nstatic const struct intel_step_info jsl_ehl_revids[] = {\n\t[0] = { COMMON_STEP(A0) },\n\t[1] = { COMMON_STEP(B0) },\n};\n\nstatic const struct intel_step_info tgl_uy_revids[] = {\n\t[0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_A0 },\n\t[1] = { COMMON_GT_MEDIA_STEP(B0), .display_step = STEP_C0 },\n\t[2] = { COMMON_GT_MEDIA_STEP(B1), .display_step = STEP_C0 },\n\t[3] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_D0 },\n};\n\n \nstatic const struct intel_step_info tgl_revids[] = {\n\t[0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_B0 },\n\t[1] = { COMMON_GT_MEDIA_STEP(B0), .display_step = STEP_D0 },\n};\n\nstatic const struct intel_step_info rkl_revids[] = {\n\t[0] = { COMMON_STEP(A0) },\n\t[1] = { COMMON_STEP(B0) },\n\t[4] = { COMMON_STEP(C0) },\n};\n\nstatic const struct intel_step_info dg1_revids[] = {\n\t[0] = { COMMON_STEP(A0) },\n\t[1] = { COMMON_STEP(B0) },\n};\n\nstatic const struct intel_step_info adls_revids[] = {\n\t[0x0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_A0 },\n\t[0x1] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_A2 },\n\t[0x4] = { COMMON_GT_MEDIA_STEP(B0), .display_step = STEP_B0 },\n\t[0x8] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_B0 },\n\t[0xC] = { COMMON_GT_MEDIA_STEP(D0), .display_step = STEP_C0 },\n};\n\nstatic const struct intel_step_info adlp_revids[] = {\n\t[0x0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_A0 },\n\t[0x4] = { COMMON_GT_MEDIA_STEP(B0), .display_step = STEP_B0 },\n\t[0x8] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_C0 },\n\t[0xC] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_D0 },\n};\n\nstatic const struct intel_step_info xehpsdv_revids[] = {\n\t[0x0] = { COMMON_GT_MEDIA_STEP(A0) },\n\t[0x1] = { COMMON_GT_MEDIA_STEP(A1) },\n\t[0x4] = { COMMON_GT_MEDIA_STEP(B0) },\n\t[0x8] = { COMMON_GT_MEDIA_STEP(C0) },\n};\n\nstatic const struct intel_step_info dg2_g10_revid_step_tbl[] = {\n\t[0x0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_A0 },\n\t[0x1] = { COMMON_GT_MEDIA_STEP(A1), .display_step = STEP_A0 },\n\t[0x4] = { COMMON_GT_MEDIA_STEP(B0), .display_step = STEP_B0 },\n\t[0x8] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_C0 },\n};\n\nstatic const struct intel_step_info dg2_g11_revid_step_tbl[] = {\n\t[0x0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_B0 },\n\t[0x4] = { COMMON_GT_MEDIA_STEP(B0), .display_step = STEP_C0 },\n\t[0x5] = { COMMON_GT_MEDIA_STEP(B1), .display_step = STEP_C0 },\n};\n\nstatic const struct intel_step_info dg2_g12_revid_step_tbl[] = {\n\t[0x0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_C0 },\n};\n\nstatic const struct intel_step_info adls_rpls_revids[] = {\n\t[0x4] = { COMMON_GT_MEDIA_STEP(D0), .display_step = STEP_D0 },\n\t[0xC] = { COMMON_GT_MEDIA_STEP(D0), .display_step = STEP_C0 },\n};\n\nstatic const struct intel_step_info adlp_rplp_revids[] = {\n\t[0x4] = { COMMON_GT_MEDIA_STEP(C0), .display_step = STEP_E0 },\n};\n\nstatic const struct intel_step_info adlp_n_revids[] = {\n\t[0x0] = { COMMON_GT_MEDIA_STEP(A0), .display_step = STEP_D0 },\n};\n\nstatic u8 gmd_to_intel_step(struct drm_i915_private *i915,\n\t\t\t    struct intel_ip_version *gmd)\n{\n\tu8 step = gmd->step + STEP_A0;\n\n\tif (step >= STEP_FUTURE) {\n\t\tdrm_dbg(&i915->drm, \"Using future steppings\\n\");\n\t\treturn STEP_FUTURE;\n\t}\n\n\treturn step;\n}\n\nstatic void pvc_step_init(struct drm_i915_private *i915, int pci_revid);\n\nvoid intel_step_init(struct drm_i915_private *i915)\n{\n\tconst struct intel_step_info *revids = NULL;\n\tint size = 0;\n\tint revid = INTEL_REVID(i915);\n\tstruct intel_step_info step = {};\n\n\tif (HAS_GMD_ID(i915)) {\n\t\tstep.graphics_step = gmd_to_intel_step(i915,\n\t\t\t\t\t\t       &RUNTIME_INFO(i915)->graphics.ip);\n\t\tstep.media_step = gmd_to_intel_step(i915,\n\t\t\t\t\t\t    &RUNTIME_INFO(i915)->media.ip);\n\t\tstep.display_step = STEP_A0 + DISPLAY_RUNTIME_INFO(i915)->ip.step;\n\t\tif (step.display_step >= STEP_FUTURE) {\n\t\t\tdrm_dbg(&i915->drm, \"Using future display steppings\\n\");\n\t\t\tstep.display_step = STEP_FUTURE;\n\t\t}\n\n\t\tRUNTIME_INFO(i915)->step = step;\n\n\t\treturn;\n\t}\n\n\tif (IS_PONTEVECCHIO(i915)) {\n\t\tpvc_step_init(i915, revid);\n\t\treturn;\n\t} else if (IS_DG2_G10(i915)) {\n\t\trevids = dg2_g10_revid_step_tbl;\n\t\tsize = ARRAY_SIZE(dg2_g10_revid_step_tbl);\n\t} else if (IS_DG2_G11(i915)) {\n\t\trevids = dg2_g11_revid_step_tbl;\n\t\tsize = ARRAY_SIZE(dg2_g11_revid_step_tbl);\n\t} else if (IS_DG2_G12(i915)) {\n\t\trevids = dg2_g12_revid_step_tbl;\n\t\tsize = ARRAY_SIZE(dg2_g12_revid_step_tbl);\n\t} else if (IS_XEHPSDV(i915)) {\n\t\trevids = xehpsdv_revids;\n\t\tsize = ARRAY_SIZE(xehpsdv_revids);\n\t} else if (IS_ALDERLAKE_P_N(i915)) {\n\t\trevids = adlp_n_revids;\n\t\tsize = ARRAY_SIZE(adlp_n_revids);\n\t} else if (IS_RAPTORLAKE_P(i915)) {\n\t\trevids = adlp_rplp_revids;\n\t\tsize = ARRAY_SIZE(adlp_rplp_revids);\n\t} else if (IS_ALDERLAKE_P(i915)) {\n\t\trevids = adlp_revids;\n\t\tsize = ARRAY_SIZE(adlp_revids);\n\t} else if (IS_RAPTORLAKE_S(i915)) {\n\t\trevids = adls_rpls_revids;\n\t\tsize = ARRAY_SIZE(adls_rpls_revids);\n\t} else if (IS_ALDERLAKE_S(i915)) {\n\t\trevids = adls_revids;\n\t\tsize = ARRAY_SIZE(adls_revids);\n\t} else if (IS_DG1(i915)) {\n\t\trevids = dg1_revids;\n\t\tsize = ARRAY_SIZE(dg1_revids);\n\t} else if (IS_ROCKETLAKE(i915)) {\n\t\trevids = rkl_revids;\n\t\tsize = ARRAY_SIZE(rkl_revids);\n\t} else if (IS_TIGERLAKE_UY(i915)) {\n\t\trevids = tgl_uy_revids;\n\t\tsize = ARRAY_SIZE(tgl_uy_revids);\n\t} else if (IS_TIGERLAKE(i915)) {\n\t\trevids = tgl_revids;\n\t\tsize = ARRAY_SIZE(tgl_revids);\n\t} else if (IS_JASPERLAKE(i915) || IS_ELKHARTLAKE(i915)) {\n\t\trevids = jsl_ehl_revids;\n\t\tsize = ARRAY_SIZE(jsl_ehl_revids);\n\t} else if (IS_ICELAKE(i915)) {\n\t\trevids = icl_revids;\n\t\tsize = ARRAY_SIZE(icl_revids);\n\t} else if (IS_GEMINILAKE(i915)) {\n\t\trevids = glk_revids;\n\t\tsize = ARRAY_SIZE(glk_revids);\n\t} else if (IS_BROXTON(i915)) {\n\t\trevids = bxt_revids;\n\t\tsize = ARRAY_SIZE(bxt_revids);\n\t} else if (IS_KABYLAKE(i915)) {\n\t\trevids = kbl_revids;\n\t\tsize = ARRAY_SIZE(kbl_revids);\n\t} else if (IS_SKYLAKE(i915)) {\n\t\trevids = skl_revids;\n\t\tsize = ARRAY_SIZE(skl_revids);\n\t}\n\n\t \n\tif (!revids)\n\t\treturn;\n\n\tif (revid < size && revids[revid].graphics_step != STEP_NONE) {\n\t\tstep = revids[revid];\n\t} else {\n\t\tdrm_warn(&i915->drm, \"Unknown revid 0x%02x\\n\", revid);\n\n\t\t \n\t\twhile (revid < size && revids[revid].graphics_step == STEP_NONE)\n\t\t\trevid++;\n\n\t\tif (revid < size) {\n\t\t\tdrm_dbg(&i915->drm, \"Using steppings for revid 0x%02x\\n\",\n\t\t\t\trevid);\n\t\t\tstep = revids[revid];\n\t\t} else {\n\t\t\tdrm_dbg(&i915->drm, \"Using future steppings\\n\");\n\t\t\tstep.graphics_step = STEP_FUTURE;\n\t\t\tstep.display_step = STEP_FUTURE;\n\t\t}\n\t}\n\n\tif (drm_WARN_ON(&i915->drm, step.graphics_step == STEP_NONE))\n\t\treturn;\n\n\tRUNTIME_INFO(i915)->step = step;\n}\n\n#define PVC_BD_REVID\tGENMASK(5, 3)\n#define PVC_CT_REVID\tGENMASK(2, 0)\n\nstatic const int pvc_bd_subids[] = {\n\t[0x0] = STEP_A0,\n\t[0x3] = STEP_B0,\n\t[0x4] = STEP_B1,\n\t[0x5] = STEP_B3,\n};\n\nstatic const int pvc_ct_subids[] = {\n\t[0x3] = STEP_A0,\n\t[0x5] = STEP_B0,\n\t[0x6] = STEP_B1,\n\t[0x7] = STEP_C0,\n};\n\nstatic int\npvc_step_lookup(struct drm_i915_private *i915, const char *type,\n\t\tconst int *table, int size, int subid)\n{\n\tif (subid < size && table[subid] != STEP_NONE)\n\t\treturn table[subid];\n\n\tdrm_warn(&i915->drm, \"Unknown %s id 0x%02x\\n\", type, subid);\n\n\t \n\twhile (subid < size && table[subid] == STEP_NONE)\n\t\tsubid++;\n\n\tif (subid < size) {\n\t\tdrm_dbg(&i915->drm, \"Using steppings for %s id 0x%02x\\n\",\n\t\t\ttype, subid);\n\t\treturn table[subid];\n\t}\n\n\tdrm_dbg(&i915->drm, \"Using future steppings\\n\");\n\treturn STEP_FUTURE;\n}\n\n \nstatic void pvc_step_init(struct drm_i915_private *i915, int pci_revid)\n{\n\tint ct_subid, bd_subid;\n\n\tbd_subid = FIELD_GET(PVC_BD_REVID, pci_revid);\n\tct_subid = FIELD_GET(PVC_CT_REVID, pci_revid);\n\n\tRUNTIME_INFO(i915)->step.basedie_step =\n\t\tpvc_step_lookup(i915, \"Base Die\", pvc_bd_subids,\n\t\t\t\tARRAY_SIZE(pvc_bd_subids), bd_subid);\n\tRUNTIME_INFO(i915)->step.graphics_step =\n\t\tpvc_step_lookup(i915, \"Compute Tile\", pvc_ct_subids,\n\t\t\t\tARRAY_SIZE(pvc_ct_subids), ct_subid);\n}\n\n#define STEP_NAME_CASE(name)\t\\\n\tcase STEP_##name:\t\\\n\t\treturn #name;\n\nconst char *intel_step_name(enum intel_step step)\n{\n\tswitch (step) {\n\tSTEP_NAME_LIST(STEP_NAME_CASE);\n\n\tdefault:\n\t\treturn \"**\";\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}