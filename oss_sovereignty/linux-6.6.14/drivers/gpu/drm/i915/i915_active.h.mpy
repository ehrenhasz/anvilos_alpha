{
  "module_name": "i915_active.h",
  "hash_id": "d455d67facdc9bb06bbe7b666ebcd6d28123e33296620b939059d183bd5e2947",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_active.h",
  "human_readable_source": " \n\n#ifndef _I915_ACTIVE_H_\n#define _I915_ACTIVE_H_\n\n#include <linux/lockdep.h>\n\n#include \"i915_active_types.h\"\n#include \"i915_request.h\"\n\nstruct i915_request;\nstruct intel_engine_cs;\nstruct intel_timeline;\n\n \n\nvoid i915_active_noop(struct dma_fence *fence, struct dma_fence_cb *cb);\n\n \nstatic inline void\n__i915_active_fence_init(struct i915_active_fence *active,\n\t\t\t void *fence,\n\t\t\t dma_fence_func_t fn)\n{\n\tRCU_INIT_POINTER(active->fence, fence);\n\tactive->cb.func = fn ?: i915_active_noop;\n}\n\n#define INIT_ACTIVE_FENCE(A) \\\n\t__i915_active_fence_init((A), NULL, NULL)\n\nstruct dma_fence *\n__i915_active_fence_set(struct i915_active_fence *active,\n\t\t\tstruct dma_fence *fence);\n\n \nint __must_check\ni915_active_fence_set(struct i915_active_fence *active,\n\t\t      struct i915_request *rq);\n \nstatic inline struct dma_fence *\ni915_active_fence_get(struct i915_active_fence *active)\n{\n\tstruct dma_fence *fence;\n\n\trcu_read_lock();\n\tfence = dma_fence_get_rcu_safe(&active->fence);\n\trcu_read_unlock();\n\n\treturn fence;\n}\n\n \nstatic inline bool\ni915_active_fence_isset(const struct i915_active_fence *active)\n{\n\treturn rcu_access_pointer(active->fence);\n}\n\n \n\nvoid __i915_active_init(struct i915_active *ref,\n\t\t\tint (*active)(struct i915_active *ref),\n\t\t\tvoid (*retire)(struct i915_active *ref),\n\t\t\tunsigned long flags,\n\t\t\tstruct lock_class_key *mkey,\n\t\t\tstruct lock_class_key *wkey);\n\n \n#define i915_active_init(ref, active, retire, flags) do {\t\t\t\\\n\tstatic struct lock_class_key __mkey;\t\t\t\t\t\\\n\tstatic struct lock_class_key __wkey;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\t\\\n\t__i915_active_init(ref, active, retire, flags, &__mkey, &__wkey);\t\\\n} while (0)\n\nint i915_active_add_request(struct i915_active *ref, struct i915_request *rq);\n\nstruct dma_fence *\ni915_active_set_exclusive(struct i915_active *ref, struct dma_fence *f);\n\nint __i915_active_wait(struct i915_active *ref, int state);\nstatic inline int i915_active_wait(struct i915_active *ref)\n{\n\treturn __i915_active_wait(ref, TASK_INTERRUPTIBLE);\n}\n\nint i915_sw_fence_await_active(struct i915_sw_fence *fence,\n\t\t\t       struct i915_active *ref,\n\t\t\t       unsigned int flags);\nint i915_request_await_active(struct i915_request *rq,\n\t\t\t      struct i915_active *ref,\n\t\t\t      unsigned int flags);\n#define I915_ACTIVE_AWAIT_EXCL BIT(0)\n#define I915_ACTIVE_AWAIT_ACTIVE BIT(1)\n#define I915_ACTIVE_AWAIT_BARRIER BIT(2)\n\nint i915_active_acquire(struct i915_active *ref);\nint i915_active_acquire_for_context(struct i915_active *ref, u64 idx);\nbool i915_active_acquire_if_busy(struct i915_active *ref);\n\nvoid i915_active_release(struct i915_active *ref);\n\nstatic inline void __i915_active_acquire(struct i915_active *ref)\n{\n\tGEM_BUG_ON(!atomic_read(&ref->count));\n\tatomic_inc(&ref->count);\n}\n\nstatic inline bool\ni915_active_is_idle(const struct i915_active *ref)\n{\n\treturn !atomic_read(&ref->count);\n}\n\nvoid i915_active_fini(struct i915_active *ref);\n\nint i915_active_acquire_preallocate_barrier(struct i915_active *ref,\n\t\t\t\t\t    struct intel_engine_cs *engine);\nvoid i915_active_acquire_barrier(struct i915_active *ref);\nvoid i915_request_add_active_barriers(struct i915_request *rq);\n\nvoid i915_active_print(struct i915_active *ref, struct drm_printer *m);\nvoid i915_active_unlock_wait(struct i915_active *ref);\n\nstruct i915_active *i915_active_create(void);\nstruct i915_active *i915_active_get(struct i915_active *ref);\nvoid i915_active_put(struct i915_active *ref);\n\nstatic inline int __i915_request_await_exclusive(struct i915_request *rq,\n\t\t\t\t\t\t struct i915_active *active)\n{\n\tstruct dma_fence *fence;\n\tint err = 0;\n\n\tfence = i915_active_fence_get(&active->excl);\n\tif (fence) {\n\t\terr = i915_request_await_dma_fence(rq, fence);\n\t\tdma_fence_put(fence);\n\t}\n\n\treturn err;\n}\n\nvoid i915_active_module_exit(void);\nint i915_active_module_init(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}