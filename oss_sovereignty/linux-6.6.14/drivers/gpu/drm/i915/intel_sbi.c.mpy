{
  "module_name": "intel_sbi.c",
  "hash_id": "34a73183d999a83b463e7f96bc78251a9b3aa71bdd7f98990d9805161dfec3b1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/intel_sbi.c",
  "human_readable_source": "\n \n\n#include \"i915_drv.h\"\n#include \"intel_sbi.h\"\n#include \"i915_reg.h\"\n\n \nstatic int intel_sbi_rw(struct drm_i915_private *i915, u16 reg,\n\t\t\tenum intel_sbi_destination destination,\n\t\t\tu32 *val, bool is_read)\n{\n\tstruct intel_uncore *uncore = &i915->uncore;\n\tu32 cmd;\n\n\tlockdep_assert_held(&i915->sb_lock);\n\n\tif (intel_wait_for_register_fw(uncore,\n\t\t\t\t       SBI_CTL_STAT, SBI_BUSY, 0,\n\t\t\t\t       100)) {\n\t\tdrm_err(&i915->drm,\n\t\t\t\"timeout waiting for SBI to become ready\\n\");\n\t\treturn -EBUSY;\n\t}\n\n\tintel_uncore_write_fw(uncore, SBI_ADDR, (u32)reg << 16);\n\tintel_uncore_write_fw(uncore, SBI_DATA, is_read ? 0 : *val);\n\n\tif (destination == SBI_ICLK)\n\t\tcmd = SBI_CTL_DEST_ICLK | SBI_CTL_OP_CRRD;\n\telse\n\t\tcmd = SBI_CTL_DEST_MPHY | SBI_CTL_OP_IORD;\n\tif (!is_read)\n\t\tcmd |= BIT(8);\n\tintel_uncore_write_fw(uncore, SBI_CTL_STAT, cmd | SBI_BUSY);\n\n\tif (__intel_wait_for_register_fw(uncore,\n\t\t\t\t\t SBI_CTL_STAT, SBI_BUSY, 0,\n\t\t\t\t\t 100, 100, &cmd)) {\n\t\tdrm_err(&i915->drm,\n\t\t\t\"timeout waiting for SBI to complete read\\n\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\tif (cmd & SBI_RESPONSE_FAIL) {\n\t\tdrm_err(&i915->drm, \"error during SBI read of reg %x\\n\", reg);\n\t\treturn -ENXIO;\n\t}\n\n\tif (is_read)\n\t\t*val = intel_uncore_read_fw(uncore, SBI_DATA);\n\n\treturn 0;\n}\n\nu32 intel_sbi_read(struct drm_i915_private *i915, u16 reg,\n\t\t   enum intel_sbi_destination destination)\n{\n\tu32 result = 0;\n\n\tintel_sbi_rw(i915, reg, destination, &result, true);\n\n\treturn result;\n}\n\nvoid intel_sbi_write(struct drm_i915_private *i915, u16 reg, u32 value,\n\t\t     enum intel_sbi_destination destination)\n{\n\tintel_sbi_rw(i915, reg, destination, &value, false);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}