{
  "module_name": "i915_pci.c",
  "hash_id": "aa3b9076acd41e2c8592958be7a6b272eb2720367f143a323d309043a707de5d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_pci.c",
  "human_readable_source": " \n\n#include <drm/drm_color_mgmt.h>\n#include <drm/drm_drv.h>\n#include <drm/i915_pciids.h>\n\n#include \"display/intel_display.h\"\n#include \"display/intel_display_driver.h\"\n#include \"gt/intel_gt_regs.h\"\n#include \"gt/intel_sa_media.h\"\n#include \"gem/i915_gem_object_types.h\"\n\n#include \"i915_driver.h\"\n#include \"i915_drv.h\"\n#include \"i915_pci.h\"\n#include \"i915_reg.h\"\n#include \"intel_pci_config.h\"\n\n#define PLATFORM(x) .platform = (x)\n#define GEN(x) \\\n\t.__runtime.graphics.ip.ver = (x), \\\n\t.__runtime.media.ip.ver = (x)\n\n#define LEGACY_CACHELEVEL \\\n\t.cachelevel_to_pat = { \\\n\t\t[I915_CACHE_NONE]   = 0, \\\n\t\t[I915_CACHE_LLC]    = 1, \\\n\t\t[I915_CACHE_L3_LLC] = 2, \\\n\t\t[I915_CACHE_WT]     = 3, \\\n\t}\n\n#define TGL_CACHELEVEL \\\n\t.cachelevel_to_pat = { \\\n\t\t[I915_CACHE_NONE]   = 3, \\\n\t\t[I915_CACHE_LLC]    = 0, \\\n\t\t[I915_CACHE_L3_LLC] = 0, \\\n\t\t[I915_CACHE_WT]     = 2, \\\n\t}\n\n#define PVC_CACHELEVEL \\\n\t.cachelevel_to_pat = { \\\n\t\t[I915_CACHE_NONE]   = 0, \\\n\t\t[I915_CACHE_LLC]    = 3, \\\n\t\t[I915_CACHE_L3_LLC] = 3, \\\n\t\t[I915_CACHE_WT]     = 2, \\\n\t}\n\n#define MTL_CACHELEVEL \\\n\t.cachelevel_to_pat = { \\\n\t\t[I915_CACHE_NONE]   = 2, \\\n\t\t[I915_CACHE_LLC]    = 3, \\\n\t\t[I915_CACHE_L3_LLC] = 3, \\\n\t\t[I915_CACHE_WT]     = 1, \\\n\t}\n\n \n\n#define GEN_DEFAULT_PAGE_SIZES \\\n\t.__runtime.page_sizes = I915_GTT_PAGE_SIZE_4K\n\n#define GEN_DEFAULT_REGIONS \\\n\t.memory_regions = REGION_SMEM | REGION_STOLEN_SMEM\n\n#define I830_FEATURES \\\n\tGEN(2), \\\n\t.is_mobile = 1, \\\n\t.gpu_reset_clobbers_display = true, \\\n\t.has_3d_pipeline = 1, \\\n\t.hws_needs_physical = 1, \\\n\t.unfenced_needs_alignment = 1, \\\n\t.platform_engine_mask = BIT(RCS0), \\\n\t.has_snoop = true, \\\n\t.has_coherent_ggtt = false, \\\n\t.dma_mask_size = 32, \\\n\t.max_pat_index = 3, \\\n\tGEN_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\n#define I845_FEATURES \\\n\tGEN(2), \\\n\t.has_3d_pipeline = 1, \\\n\t.gpu_reset_clobbers_display = true, \\\n\t.hws_needs_physical = 1, \\\n\t.unfenced_needs_alignment = 1, \\\n\t.platform_engine_mask = BIT(RCS0), \\\n\t.has_snoop = true, \\\n\t.has_coherent_ggtt = false, \\\n\t.dma_mask_size = 32, \\\n\t.max_pat_index = 3, \\\n\tGEN_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\nstatic const struct intel_device_info i830_info = {\n\tI830_FEATURES,\n\tPLATFORM(INTEL_I830),\n};\n\nstatic const struct intel_device_info i845g_info = {\n\tI845_FEATURES,\n\tPLATFORM(INTEL_I845G),\n};\n\nstatic const struct intel_device_info i85x_info = {\n\tI830_FEATURES,\n\tPLATFORM(INTEL_I85X),\n};\n\nstatic const struct intel_device_info i865g_info = {\n\tI845_FEATURES,\n\tPLATFORM(INTEL_I865G),\n};\n\n#define GEN3_FEATURES \\\n\tGEN(3), \\\n\t.gpu_reset_clobbers_display = true, \\\n\t.platform_engine_mask = BIT(RCS0), \\\n\t.has_3d_pipeline = 1, \\\n\t.has_snoop = true, \\\n\t.has_coherent_ggtt = true, \\\n\t.dma_mask_size = 32, \\\n\t.max_pat_index = 3, \\\n\tGEN_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\nstatic const struct intel_device_info i915g_info = {\n\tGEN3_FEATURES,\n\tPLATFORM(INTEL_I915G),\n\t.has_coherent_ggtt = false,\n\t.hws_needs_physical = 1,\n\t.unfenced_needs_alignment = 1,\n};\n\nstatic const struct intel_device_info i915gm_info = {\n\tGEN3_FEATURES,\n\tPLATFORM(INTEL_I915GM),\n\t.is_mobile = 1,\n\t.hws_needs_physical = 1,\n\t.unfenced_needs_alignment = 1,\n};\n\nstatic const struct intel_device_info i945g_info = {\n\tGEN3_FEATURES,\n\tPLATFORM(INTEL_I945G),\n\t.hws_needs_physical = 1,\n\t.unfenced_needs_alignment = 1,\n};\n\nstatic const struct intel_device_info i945gm_info = {\n\tGEN3_FEATURES,\n\tPLATFORM(INTEL_I945GM),\n\t.is_mobile = 1,\n\t.hws_needs_physical = 1,\n\t.unfenced_needs_alignment = 1,\n};\n\nstatic const struct intel_device_info g33_info = {\n\tGEN3_FEATURES,\n\tPLATFORM(INTEL_G33),\n\t.dma_mask_size = 36,\n};\n\nstatic const struct intel_device_info pnv_g_info = {\n\tGEN3_FEATURES,\n\tPLATFORM(INTEL_PINEVIEW),\n\t.dma_mask_size = 36,\n};\n\nstatic const struct intel_device_info pnv_m_info = {\n\tGEN3_FEATURES,\n\tPLATFORM(INTEL_PINEVIEW),\n\t.is_mobile = 1,\n\t.dma_mask_size = 36,\n};\n\n#define GEN4_FEATURES \\\n\tGEN(4), \\\n\t.gpu_reset_clobbers_display = true, \\\n\t.platform_engine_mask = BIT(RCS0), \\\n\t.has_3d_pipeline = 1, \\\n\t.has_snoop = true, \\\n\t.has_coherent_ggtt = true, \\\n\t.dma_mask_size = 36, \\\n\t.max_pat_index = 3, \\\n\tGEN_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\nstatic const struct intel_device_info i965g_info = {\n\tGEN4_FEATURES,\n\tPLATFORM(INTEL_I965G),\n\t.hws_needs_physical = 1,\n\t.has_snoop = false,\n};\n\nstatic const struct intel_device_info i965gm_info = {\n\tGEN4_FEATURES,\n\tPLATFORM(INTEL_I965GM),\n\t.is_mobile = 1,\n\t.hws_needs_physical = 1,\n\t.has_snoop = false,\n};\n\nstatic const struct intel_device_info g45_info = {\n\tGEN4_FEATURES,\n\tPLATFORM(INTEL_G45),\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0),\n\t.gpu_reset_clobbers_display = false,\n};\n\nstatic const struct intel_device_info gm45_info = {\n\tGEN4_FEATURES,\n\tPLATFORM(INTEL_GM45),\n\t.is_mobile = 1,\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0),\n\t.gpu_reset_clobbers_display = false,\n};\n\n#define GEN5_FEATURES \\\n\tGEN(5), \\\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0), \\\n\t.has_3d_pipeline = 1, \\\n\t.has_snoop = true, \\\n\t.has_coherent_ggtt = true, \\\n\t  \\\n\t.has_rc6 = 0, \\\n\t.dma_mask_size = 36, \\\n\t.max_pat_index = 3, \\\n\tGEN_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\nstatic const struct intel_device_info ilk_d_info = {\n\tGEN5_FEATURES,\n\tPLATFORM(INTEL_IRONLAKE),\n};\n\nstatic const struct intel_device_info ilk_m_info = {\n\tGEN5_FEATURES,\n\tPLATFORM(INTEL_IRONLAKE),\n\t.is_mobile = 1,\n\t.has_rps = true,\n};\n\n#define GEN6_FEATURES \\\n\tGEN(6), \\\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0) | BIT(BCS0), \\\n\t.has_3d_pipeline = 1, \\\n\t.has_coherent_ggtt = true, \\\n\t.has_llc = 1, \\\n\t.has_rc6 = 1, \\\n\t  \\\n\t.has_rc6p = 0, \\\n\t.has_rps = true, \\\n\t.dma_mask_size = 40, \\\n\t.max_pat_index = 3, \\\n\t.__runtime.ppgtt_type = INTEL_PPGTT_ALIASING, \\\n\t.__runtime.ppgtt_size = 31, \\\n\tGEN_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\n#define SNB_D_PLATFORM \\\n\tGEN6_FEATURES, \\\n\tPLATFORM(INTEL_SANDYBRIDGE)\n\nstatic const struct intel_device_info snb_d_gt1_info = {\n\tSNB_D_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info snb_d_gt2_info = {\n\tSNB_D_PLATFORM,\n\t.gt = 2,\n};\n\n#define SNB_M_PLATFORM \\\n\tGEN6_FEATURES, \\\n\tPLATFORM(INTEL_SANDYBRIDGE), \\\n\t.is_mobile = 1\n\n\nstatic const struct intel_device_info snb_m_gt1_info = {\n\tSNB_M_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info snb_m_gt2_info = {\n\tSNB_M_PLATFORM,\n\t.gt = 2,\n};\n\n#define GEN7_FEATURES  \\\n\tGEN(7), \\\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0) | BIT(BCS0), \\\n\t.has_3d_pipeline = 1, \\\n\t.has_coherent_ggtt = true, \\\n\t.has_llc = 1, \\\n\t.has_rc6 = 1, \\\n\t.has_rc6p = 1, \\\n\t.has_reset_engine = true, \\\n\t.has_rps = true, \\\n\t.dma_mask_size = 40, \\\n\t.max_pat_index = 3, \\\n\t.__runtime.ppgtt_type = INTEL_PPGTT_ALIASING, \\\n\t.__runtime.ppgtt_size = 31, \\\n\tGEN_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\n#define IVB_D_PLATFORM \\\n\tGEN7_FEATURES, \\\n\tPLATFORM(INTEL_IVYBRIDGE), \\\n\t.has_l3_dpf = 1\n\nstatic const struct intel_device_info ivb_d_gt1_info = {\n\tIVB_D_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info ivb_d_gt2_info = {\n\tIVB_D_PLATFORM,\n\t.gt = 2,\n};\n\n#define IVB_M_PLATFORM \\\n\tGEN7_FEATURES, \\\n\tPLATFORM(INTEL_IVYBRIDGE), \\\n\t.is_mobile = 1, \\\n\t.has_l3_dpf = 1\n\nstatic const struct intel_device_info ivb_m_gt1_info = {\n\tIVB_M_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info ivb_m_gt2_info = {\n\tIVB_M_PLATFORM,\n\t.gt = 2,\n};\n\nstatic const struct intel_device_info ivb_q_info = {\n\tGEN7_FEATURES,\n\tPLATFORM(INTEL_IVYBRIDGE),\n\t.gt = 2,\n\t.has_l3_dpf = 1,\n};\n\nstatic const struct intel_device_info vlv_info = {\n\tPLATFORM(INTEL_VALLEYVIEW),\n\tGEN(7),\n\t.is_lp = 1,\n\t.has_runtime_pm = 1,\n\t.has_rc6 = 1,\n\t.has_reset_engine = true,\n\t.has_rps = true,\n\t.dma_mask_size = 40,\n\t.max_pat_index = 3,\n\t.__runtime.ppgtt_type = INTEL_PPGTT_ALIASING,\n\t.__runtime.ppgtt_size = 31,\n\t.has_snoop = true,\n\t.has_coherent_ggtt = false,\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0) | BIT(BCS0),\n\tGEN_DEFAULT_PAGE_SIZES,\n\tGEN_DEFAULT_REGIONS,\n\tLEGACY_CACHELEVEL,\n};\n\n#define G75_FEATURES  \\\n\tGEN7_FEATURES, \\\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0) | BIT(BCS0) | BIT(VECS0), \\\n\t.has_rc6p = 0  , \\\n\t.has_runtime_pm = 1\n\n#define HSW_PLATFORM \\\n\tG75_FEATURES, \\\n\tPLATFORM(INTEL_HASWELL), \\\n\t.has_l3_dpf = 1\n\nstatic const struct intel_device_info hsw_gt1_info = {\n\tHSW_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info hsw_gt2_info = {\n\tHSW_PLATFORM,\n\t.gt = 2,\n};\n\nstatic const struct intel_device_info hsw_gt3_info = {\n\tHSW_PLATFORM,\n\t.gt = 3,\n};\n\n#define GEN8_FEATURES \\\n\tG75_FEATURES, \\\n\tGEN(8), \\\n\t.has_logical_ring_contexts = 1, \\\n\t.dma_mask_size = 39, \\\n\t.__runtime.ppgtt_type = INTEL_PPGTT_FULL, \\\n\t.__runtime.ppgtt_size = 48, \\\n\t.has_64bit_reloc = 1\n\n#define BDW_PLATFORM \\\n\tGEN8_FEATURES, \\\n\tPLATFORM(INTEL_BROADWELL)\n\nstatic const struct intel_device_info bdw_gt1_info = {\n\tBDW_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info bdw_gt2_info = {\n\tBDW_PLATFORM,\n\t.gt = 2,\n};\n\nstatic const struct intel_device_info bdw_rsvd_info = {\n\tBDW_PLATFORM,\n\t.gt = 3,\n\t \n};\n\nstatic const struct intel_device_info bdw_gt3_info = {\n\tBDW_PLATFORM,\n\t.gt = 3,\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(VCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS1),\n};\n\nstatic const struct intel_device_info chv_info = {\n\tPLATFORM(INTEL_CHERRYVIEW),\n\tGEN(8),\n\t.is_lp = 1,\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0) | BIT(BCS0) | BIT(VECS0),\n\t.has_64bit_reloc = 1,\n\t.has_runtime_pm = 1,\n\t.has_rc6 = 1,\n\t.has_rps = true,\n\t.has_logical_ring_contexts = 1,\n\t.dma_mask_size = 39,\n\t.max_pat_index = 3,\n\t.__runtime.ppgtt_type = INTEL_PPGTT_FULL,\n\t.__runtime.ppgtt_size = 32,\n\t.has_reset_engine = 1,\n\t.has_snoop = true,\n\t.has_coherent_ggtt = false,\n\tGEN_DEFAULT_PAGE_SIZES,\n\tGEN_DEFAULT_REGIONS,\n\tLEGACY_CACHELEVEL,\n};\n\n#define GEN9_DEFAULT_PAGE_SIZES \\\n\t.__runtime.page_sizes = I915_GTT_PAGE_SIZE_4K | \\\n\t\tI915_GTT_PAGE_SIZE_64K\n\n#define GEN9_FEATURES \\\n\tGEN8_FEATURES, \\\n\tGEN(9), \\\n\tGEN9_DEFAULT_PAGE_SIZES, \\\n\t.has_gt_uc = 1\n\n#define SKL_PLATFORM \\\n\tGEN9_FEATURES, \\\n\tPLATFORM(INTEL_SKYLAKE)\n\nstatic const struct intel_device_info skl_gt1_info = {\n\tSKL_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info skl_gt2_info = {\n\tSKL_PLATFORM,\n\t.gt = 2,\n};\n\n#define SKL_GT3_PLUS_PLATFORM \\\n\tSKL_PLATFORM, \\\n\t.platform_engine_mask = \\\n\t\tBIT(RCS0) | BIT(VCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS1)\n\n\nstatic const struct intel_device_info skl_gt3_info = {\n\tSKL_GT3_PLUS_PLATFORM,\n\t.gt = 3,\n};\n\nstatic const struct intel_device_info skl_gt4_info = {\n\tSKL_GT3_PLUS_PLATFORM,\n\t.gt = 4,\n};\n\n#define GEN9_LP_FEATURES \\\n\tGEN(9), \\\n\t.is_lp = 1, \\\n\t.platform_engine_mask = BIT(RCS0) | BIT(VCS0) | BIT(BCS0) | BIT(VECS0), \\\n\t.has_3d_pipeline = 1, \\\n\t.has_64bit_reloc = 1, \\\n\t.has_runtime_pm = 1, \\\n\t.has_rc6 = 1, \\\n\t.has_rps = true, \\\n\t.has_logical_ring_contexts = 1, \\\n\t.has_gt_uc = 1, \\\n\t.dma_mask_size = 39, \\\n\t.__runtime.ppgtt_type = INTEL_PPGTT_FULL, \\\n\t.__runtime.ppgtt_size = 48, \\\n\t.has_reset_engine = 1, \\\n\t.has_snoop = true, \\\n\t.has_coherent_ggtt = false, \\\n\t.max_pat_index = 3, \\\n\tGEN9_DEFAULT_PAGE_SIZES, \\\n\tGEN_DEFAULT_REGIONS, \\\n\tLEGACY_CACHELEVEL\n\nstatic const struct intel_device_info bxt_info = {\n\tGEN9_LP_FEATURES,\n\tPLATFORM(INTEL_BROXTON),\n};\n\nstatic const struct intel_device_info glk_info = {\n\tGEN9_LP_FEATURES,\n\tPLATFORM(INTEL_GEMINILAKE),\n};\n\n#define KBL_PLATFORM \\\n\tGEN9_FEATURES, \\\n\tPLATFORM(INTEL_KABYLAKE)\n\nstatic const struct intel_device_info kbl_gt1_info = {\n\tKBL_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info kbl_gt2_info = {\n\tKBL_PLATFORM,\n\t.gt = 2,\n};\n\nstatic const struct intel_device_info kbl_gt3_info = {\n\tKBL_PLATFORM,\n\t.gt = 3,\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(VCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS1),\n};\n\n#define CFL_PLATFORM \\\n\tGEN9_FEATURES, \\\n\tPLATFORM(INTEL_COFFEELAKE)\n\nstatic const struct intel_device_info cfl_gt1_info = {\n\tCFL_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info cfl_gt2_info = {\n\tCFL_PLATFORM,\n\t.gt = 2,\n};\n\nstatic const struct intel_device_info cfl_gt3_info = {\n\tCFL_PLATFORM,\n\t.gt = 3,\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(VCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS1),\n};\n\n#define CML_PLATFORM \\\n\tGEN9_FEATURES, \\\n\tPLATFORM(INTEL_COMETLAKE)\n\nstatic const struct intel_device_info cml_gt1_info = {\n\tCML_PLATFORM,\n\t.gt = 1,\n};\n\nstatic const struct intel_device_info cml_gt2_info = {\n\tCML_PLATFORM,\n\t.gt = 2,\n};\n\n#define GEN11_DEFAULT_PAGE_SIZES \\\n\t.__runtime.page_sizes = I915_GTT_PAGE_SIZE_4K | \\\n\t\tI915_GTT_PAGE_SIZE_64K |\t\t\\\n\t\tI915_GTT_PAGE_SIZE_2M\n\n#define GEN11_FEATURES \\\n\tGEN9_FEATURES, \\\n\tGEN11_DEFAULT_PAGE_SIZES, \\\n\tGEN(11), \\\n\t.has_coherent_ggtt = false, \\\n\t.has_logical_ring_elsq = 1\n\nstatic const struct intel_device_info icl_info = {\n\tGEN11_FEATURES,\n\tPLATFORM(INTEL_ICELAKE),\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS0) | BIT(VCS2),\n};\n\nstatic const struct intel_device_info ehl_info = {\n\tGEN11_FEATURES,\n\tPLATFORM(INTEL_ELKHARTLAKE),\n\t.platform_engine_mask = BIT(RCS0) | BIT(BCS0) | BIT(VCS0) | BIT(VECS0),\n\t.__runtime.ppgtt_size = 36,\n};\n\nstatic const struct intel_device_info jsl_info = {\n\tGEN11_FEATURES,\n\tPLATFORM(INTEL_JASPERLAKE),\n\t.platform_engine_mask = BIT(RCS0) | BIT(BCS0) | BIT(VCS0) | BIT(VECS0),\n\t.__runtime.ppgtt_size = 36,\n};\n\n#define GEN12_FEATURES \\\n\tGEN11_FEATURES, \\\n\tGEN(12), \\\n\tTGL_CACHELEVEL, \\\n\t.has_global_mocs = 1, \\\n\t.has_pxp = 1, \\\n\t.max_pat_index = 3\n\nstatic const struct intel_device_info tgl_info = {\n\tGEN12_FEATURES,\n\tPLATFORM(INTEL_TIGERLAKE),\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS0) | BIT(VCS2),\n};\n\nstatic const struct intel_device_info rkl_info = {\n\tGEN12_FEATURES,\n\tPLATFORM(INTEL_ROCKETLAKE),\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS0),\n};\n\n#define DGFX_FEATURES \\\n\t.memory_regions = REGION_SMEM | REGION_LMEM | REGION_STOLEN_LMEM, \\\n\t.has_llc = 0, \\\n\t.has_pxp = 0, \\\n\t.has_snoop = 1, \\\n\t.is_dgfx = 1, \\\n\t.has_heci_gscfi = 1\n\nstatic const struct intel_device_info dg1_info = {\n\tGEN12_FEATURES,\n\tDGFX_FEATURES,\n\t.__runtime.graphics.ip.rel = 10,\n\tPLATFORM(INTEL_DG1),\n\t.require_force_probe = 1,\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(BCS0) | BIT(VECS0) |\n\t\tBIT(VCS0) | BIT(VCS2),\n\t \n\t.__runtime.ppgtt_size = 47,\n};\n\nstatic const struct intel_device_info adl_s_info = {\n\tGEN12_FEATURES,\n\tPLATFORM(INTEL_ALDERLAKE_S),\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS0) | BIT(VCS2),\n\t.dma_mask_size = 39,\n};\n\nstatic const struct intel_device_info adl_p_info = {\n\tGEN12_FEATURES,\n\tPLATFORM(INTEL_ALDERLAKE_P),\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(BCS0) | BIT(VECS0) | BIT(VCS0) | BIT(VCS2),\n\t.__runtime.ppgtt_size = 48,\n\t.dma_mask_size = 39,\n};\n\n#undef GEN\n\n#define XE_HP_PAGE_SIZES \\\n\t.__runtime.page_sizes = I915_GTT_PAGE_SIZE_4K | \\\n\t\tI915_GTT_PAGE_SIZE_64K |\t\t\\\n\t\tI915_GTT_PAGE_SIZE_2M\n\n#define XE_HP_FEATURES \\\n\t.__runtime.graphics.ip.ver = 12, \\\n\t.__runtime.graphics.ip.rel = 50, \\\n\tXE_HP_PAGE_SIZES, \\\n\tTGL_CACHELEVEL, \\\n\t.dma_mask_size = 46, \\\n\t.has_3d_pipeline = 1, \\\n\t.has_64bit_reloc = 1, \\\n\t.has_flat_ccs = 1, \\\n\t.has_4tile = 1, \\\n\t.has_global_mocs = 1, \\\n\t.has_gt_uc = 1, \\\n\t.has_llc = 1, \\\n\t.has_logical_ring_contexts = 1, \\\n\t.has_logical_ring_elsq = 1, \\\n\t.has_mslice_steering = 1, \\\n\t.has_oa_bpc_reporting = 1, \\\n\t.has_oa_slice_contrib_limits = 1, \\\n\t.has_oam = 1, \\\n\t.has_rc6 = 1, \\\n\t.has_reset_engine = 1, \\\n\t.has_rps = 1, \\\n\t.has_runtime_pm = 1, \\\n\t.max_pat_index = 3, \\\n\t.__runtime.ppgtt_size = 48, \\\n\t.__runtime.ppgtt_type = INTEL_PPGTT_FULL\n\n#define XE_HPM_FEATURES \\\n\t.__runtime.media.ip.ver = 12, \\\n\t.__runtime.media.ip.rel = 50\n\n__maybe_unused\nstatic const struct intel_device_info xehpsdv_info = {\n\tXE_HP_FEATURES,\n\tXE_HPM_FEATURES,\n\tDGFX_FEATURES,\n\tPLATFORM(INTEL_XEHPSDV),\n\t.has_64k_pages = 1,\n\t.has_media_ratio_mode = 1,\n\t.platform_engine_mask =\n\t\tBIT(RCS0) | BIT(BCS0) |\n\t\tBIT(VECS0) | BIT(VECS1) | BIT(VECS2) | BIT(VECS3) |\n\t\tBIT(VCS0) | BIT(VCS1) | BIT(VCS2) | BIT(VCS3) |\n\t\tBIT(VCS4) | BIT(VCS5) | BIT(VCS6) | BIT(VCS7) |\n\t\tBIT(CCS0) | BIT(CCS1) | BIT(CCS2) | BIT(CCS3),\n\t.require_force_probe = 1,\n};\n\n#define DG2_FEATURES \\\n\tXE_HP_FEATURES, \\\n\tXE_HPM_FEATURES, \\\n\tDGFX_FEATURES, \\\n\t.__runtime.graphics.ip.rel = 55, \\\n\t.__runtime.media.ip.rel = 55, \\\n\tPLATFORM(INTEL_DG2), \\\n\t.has_64k_pages = 1, \\\n\t.has_guc_deprivilege = 1, \\\n\t.has_heci_pxp = 1, \\\n\t.has_media_ratio_mode = 1, \\\n\t.platform_engine_mask = \\\n\t\tBIT(RCS0) | BIT(BCS0) | \\\n\t\tBIT(VECS0) | BIT(VECS1) | \\\n\t\tBIT(VCS0) | BIT(VCS2) | \\\n\t\tBIT(CCS0) | BIT(CCS1) | BIT(CCS2) | BIT(CCS3)\n\nstatic const struct intel_device_info dg2_info = {\n\tDG2_FEATURES,\n};\n\nstatic const struct intel_device_info ats_m_info = {\n\tDG2_FEATURES,\n\t.require_force_probe = 1,\n\t.tuning_thread_rr_after_dep = 1,\n};\n\n#define XE_HPC_FEATURES \\\n\tXE_HP_FEATURES, \\\n\t.dma_mask_size = 52, \\\n\t.has_3d_pipeline = 0, \\\n\t.has_guc_deprivilege = 1, \\\n\t.has_l3_ccs_read = 1, \\\n\t.has_mslice_steering = 0, \\\n\t.has_one_eu_per_fuse_bit = 1\n\n__maybe_unused\nstatic const struct intel_device_info pvc_info = {\n\tXE_HPC_FEATURES,\n\tXE_HPM_FEATURES,\n\tDGFX_FEATURES,\n\t.__runtime.graphics.ip.rel = 60,\n\t.__runtime.media.ip.rel = 60,\n\tPLATFORM(INTEL_PONTEVECCHIO),\n\t.has_flat_ccs = 0,\n\t.max_pat_index = 7,\n\t.platform_engine_mask =\n\t\tBIT(BCS0) |\n\t\tBIT(VCS0) |\n\t\tBIT(CCS0) | BIT(CCS1) | BIT(CCS2) | BIT(CCS3),\n\t.require_force_probe = 1,\n\tPVC_CACHELEVEL,\n};\n\nstatic const struct intel_gt_definition xelpmp_extra_gt[] = {\n\t{\n\t\t.type = GT_MEDIA,\n\t\t.name = \"Standalone Media GT\",\n\t\t.gsi_offset = MTL_MEDIA_GSI_BASE,\n\t\t.engine_mask = BIT(VECS0) | BIT(VCS0) | BIT(VCS2) | BIT(GSC0),\n\t},\n\t{}\n};\n\nstatic const struct intel_device_info mtl_info = {\n\tXE_HP_FEATURES,\n\t \n\t.__runtime.graphics.ip.ver = 12,\n\t.__runtime.graphics.ip.rel = 70,\n\t.__runtime.media.ip.ver = 13,\n\tPLATFORM(INTEL_METEORLAKE),\n\t.extra_gt_list = xelpmp_extra_gt,\n\t.has_flat_ccs = 0,\n\t.has_gmd_id = 1,\n\t.has_guc_deprivilege = 1,\n\t.has_llc = 0,\n\t.has_mslice_steering = 0,\n\t.has_snoop = 1,\n\t.max_pat_index = 4,\n\t.has_pxp = 1,\n\t.memory_regions = REGION_SMEM | REGION_STOLEN_LMEM,\n\t.platform_engine_mask = BIT(RCS0) | BIT(BCS0) | BIT(CCS0),\n\t.require_force_probe = 1,\n\tMTL_CACHELEVEL,\n};\n\n#undef PLATFORM\n\n \nstatic const struct pci_device_id pciidlist[] = {\n\tINTEL_I830_IDS(&i830_info),\n\tINTEL_I845G_IDS(&i845g_info),\n\tINTEL_I85X_IDS(&i85x_info),\n\tINTEL_I865G_IDS(&i865g_info),\n\tINTEL_I915G_IDS(&i915g_info),\n\tINTEL_I915GM_IDS(&i915gm_info),\n\tINTEL_I945G_IDS(&i945g_info),\n\tINTEL_I945GM_IDS(&i945gm_info),\n\tINTEL_I965G_IDS(&i965g_info),\n\tINTEL_G33_IDS(&g33_info),\n\tINTEL_I965GM_IDS(&i965gm_info),\n\tINTEL_GM45_IDS(&gm45_info),\n\tINTEL_G45_IDS(&g45_info),\n\tINTEL_PINEVIEW_G_IDS(&pnv_g_info),\n\tINTEL_PINEVIEW_M_IDS(&pnv_m_info),\n\tINTEL_IRONLAKE_D_IDS(&ilk_d_info),\n\tINTEL_IRONLAKE_M_IDS(&ilk_m_info),\n\tINTEL_SNB_D_GT1_IDS(&snb_d_gt1_info),\n\tINTEL_SNB_D_GT2_IDS(&snb_d_gt2_info),\n\tINTEL_SNB_M_GT1_IDS(&snb_m_gt1_info),\n\tINTEL_SNB_M_GT2_IDS(&snb_m_gt2_info),\n\tINTEL_IVB_Q_IDS(&ivb_q_info),  \n\tINTEL_IVB_M_GT1_IDS(&ivb_m_gt1_info),\n\tINTEL_IVB_M_GT2_IDS(&ivb_m_gt2_info),\n\tINTEL_IVB_D_GT1_IDS(&ivb_d_gt1_info),\n\tINTEL_IVB_D_GT2_IDS(&ivb_d_gt2_info),\n\tINTEL_HSW_GT1_IDS(&hsw_gt1_info),\n\tINTEL_HSW_GT2_IDS(&hsw_gt2_info),\n\tINTEL_HSW_GT3_IDS(&hsw_gt3_info),\n\tINTEL_VLV_IDS(&vlv_info),\n\tINTEL_BDW_GT1_IDS(&bdw_gt1_info),\n\tINTEL_BDW_GT2_IDS(&bdw_gt2_info),\n\tINTEL_BDW_GT3_IDS(&bdw_gt3_info),\n\tINTEL_BDW_RSVD_IDS(&bdw_rsvd_info),\n\tINTEL_CHV_IDS(&chv_info),\n\tINTEL_SKL_GT1_IDS(&skl_gt1_info),\n\tINTEL_SKL_GT2_IDS(&skl_gt2_info),\n\tINTEL_SKL_GT3_IDS(&skl_gt3_info),\n\tINTEL_SKL_GT4_IDS(&skl_gt4_info),\n\tINTEL_BXT_IDS(&bxt_info),\n\tINTEL_GLK_IDS(&glk_info),\n\tINTEL_KBL_GT1_IDS(&kbl_gt1_info),\n\tINTEL_KBL_GT2_IDS(&kbl_gt2_info),\n\tINTEL_KBL_GT3_IDS(&kbl_gt3_info),\n\tINTEL_KBL_GT4_IDS(&kbl_gt3_info),\n\tINTEL_AML_KBL_GT2_IDS(&kbl_gt2_info),\n\tINTEL_CFL_S_GT1_IDS(&cfl_gt1_info),\n\tINTEL_CFL_S_GT2_IDS(&cfl_gt2_info),\n\tINTEL_CFL_H_GT1_IDS(&cfl_gt1_info),\n\tINTEL_CFL_H_GT2_IDS(&cfl_gt2_info),\n\tINTEL_CFL_U_GT2_IDS(&cfl_gt2_info),\n\tINTEL_CFL_U_GT3_IDS(&cfl_gt3_info),\n\tINTEL_WHL_U_GT1_IDS(&cfl_gt1_info),\n\tINTEL_WHL_U_GT2_IDS(&cfl_gt2_info),\n\tINTEL_AML_CFL_GT2_IDS(&cfl_gt2_info),\n\tINTEL_WHL_U_GT3_IDS(&cfl_gt3_info),\n\tINTEL_CML_GT1_IDS(&cml_gt1_info),\n\tINTEL_CML_GT2_IDS(&cml_gt2_info),\n\tINTEL_CML_U_GT1_IDS(&cml_gt1_info),\n\tINTEL_CML_U_GT2_IDS(&cml_gt2_info),\n\tINTEL_ICL_11_IDS(&icl_info),\n\tINTEL_EHL_IDS(&ehl_info),\n\tINTEL_JSL_IDS(&jsl_info),\n\tINTEL_TGL_12_IDS(&tgl_info),\n\tINTEL_RKL_IDS(&rkl_info),\n\tINTEL_ADLS_IDS(&adl_s_info),\n\tINTEL_ADLP_IDS(&adl_p_info),\n\tINTEL_ADLN_IDS(&adl_p_info),\n\tINTEL_DG1_IDS(&dg1_info),\n\tINTEL_RPLS_IDS(&adl_s_info),\n\tINTEL_RPLP_IDS(&adl_p_info),\n\tINTEL_DG2_IDS(&dg2_info),\n\tINTEL_ATS_M_IDS(&ats_m_info),\n\tINTEL_MTL_IDS(&mtl_info),\n\t{0, 0, 0}\n};\nMODULE_DEVICE_TABLE(pci, pciidlist);\n\nstatic void i915_pci_remove(struct pci_dev *pdev)\n{\n\tstruct drm_i915_private *i915;\n\n\ti915 = pci_get_drvdata(pdev);\n\tif (!i915)  \n\t\treturn;\n\n\ti915_driver_remove(i915);\n\tpci_set_drvdata(pdev, NULL);\n}\n\n \nstatic bool device_id_in_list(u16 device_id, const char *devices, bool negative)\n{\n\tchar *s, *p, *tok;\n\tbool ret;\n\n\tif (!devices || !*devices)\n\t\treturn false;\n\n\t \n\tif (negative && strcmp(devices, \"!*\") == 0)\n\t\treturn true;\n\tif (!negative && strcmp(devices, \"*\") == 0)\n\t\treturn true;\n\n\ts = kstrdup(devices, GFP_KERNEL);\n\tif (!s)\n\t\treturn false;\n\n\tfor (p = s, ret = false; (tok = strsep(&p, \",\")) != NULL; ) {\n\t\tu16 val;\n\n\t\tif (negative && tok[0] == '!')\n\t\t\ttok++;\n\t\telse if ((negative && tok[0] != '!') ||\n\t\t\t (!negative && tok[0] == '!'))\n\t\t\tcontinue;\n\n\t\tif (kstrtou16(tok, 16, &val) == 0 && val == device_id) {\n\t\t\tret = true;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tkfree(s);\n\n\treturn ret;\n}\n\nstatic bool id_forced(u16 device_id)\n{\n\treturn device_id_in_list(device_id, i915_modparams.force_probe, false);\n}\n\nstatic bool id_blocked(u16 device_id)\n{\n\treturn device_id_in_list(device_id, i915_modparams.force_probe, true);\n}\n\nbool i915_pci_resource_valid(struct pci_dev *pdev, int bar)\n{\n\tif (!pci_resource_flags(pdev, bar))\n\t\treturn false;\n\n\tif (pci_resource_flags(pdev, bar) & IORESOURCE_UNSET)\n\t\treturn false;\n\n\tif (!pci_resource_len(pdev, bar))\n\t\treturn false;\n\n\treturn true;\n}\n\nstatic bool intel_mmio_bar_valid(struct pci_dev *pdev, struct intel_device_info *intel_info)\n{\n\treturn i915_pci_resource_valid(pdev, intel_mmio_bar(intel_info->__runtime.graphics.ip.ver));\n}\n\nstatic int i915_pci_probe(struct pci_dev *pdev, const struct pci_device_id *ent)\n{\n\tstruct intel_device_info *intel_info =\n\t\t(struct intel_device_info *) ent->driver_data;\n\tint err;\n\n\tif (intel_info->require_force_probe && !id_forced(pdev->device)) {\n\t\tdev_info(&pdev->dev,\n\t\t\t \"Your graphics device %04x is not properly supported by i915 in this\\n\"\n\t\t\t \"kernel version. To force driver probe anyway, use i915.force_probe=%04x\\n\"\n\t\t\t \"module parameter or CONFIG_DRM_I915_FORCE_PROBE=%04x configuration option,\\n\"\n\t\t\t \"or (recommended) check for kernel updates.\\n\",\n\t\t\t pdev->device, pdev->device, pdev->device);\n\t\treturn -ENODEV;\n\t}\n\n\tif (id_blocked(pdev->device)) {\n\t\tdev_info(&pdev->dev, \"I915 probe blocked for Device ID %04x.\\n\",\n\t\t\t pdev->device);\n\t\treturn -ENODEV;\n\t}\n\n\tif (intel_info->require_force_probe) {\n\t\tdev_info(&pdev->dev, \"Force probing unsupported Device ID %04x, tainting kernel\\n\",\n\t\t\t pdev->device);\n\t\tadd_taint(TAINT_USER, LOCKDEP_STILL_OK);\n\t}\n\n\t \n\tif (PCI_FUNC(pdev->devfn))\n\t\treturn -ENODEV;\n\n\tif (!intel_mmio_bar_valid(pdev, intel_info))\n\t\treturn -ENXIO;\n\n\t \n\tif (intel_display_driver_probe_defer(pdev))\n\t\treturn -EPROBE_DEFER;\n\n\terr = i915_driver_probe(pdev, ent);\n\tif (err)\n\t\treturn err;\n\n\tif (i915_inject_probe_failure(pci_get_drvdata(pdev))) {\n\t\ti915_pci_remove(pdev);\n\t\treturn -ENODEV;\n\t}\n\n\terr = i915_live_selftests(pdev);\n\tif (err) {\n\t\ti915_pci_remove(pdev);\n\t\treturn err > 0 ? -ENOTTY : err;\n\t}\n\n\terr = i915_perf_selftests(pdev);\n\tif (err) {\n\t\ti915_pci_remove(pdev);\n\t\treturn err > 0 ? -ENOTTY : err;\n\t}\n\n\treturn 0;\n}\n\nstatic void i915_pci_shutdown(struct pci_dev *pdev)\n{\n\tstruct drm_i915_private *i915 = pci_get_drvdata(pdev);\n\n\ti915_driver_shutdown(i915);\n}\n\nstatic struct pci_driver i915_pci_driver = {\n\t.name = DRIVER_NAME,\n\t.id_table = pciidlist,\n\t.probe = i915_pci_probe,\n\t.remove = i915_pci_remove,\n\t.shutdown = i915_pci_shutdown,\n\t.driver.pm = &i915_pm_ops,\n};\n\nint i915_pci_register_driver(void)\n{\n\treturn pci_register_driver(&i915_pci_driver);\n}\n\nvoid i915_pci_unregister_driver(void)\n{\n\tpci_unregister_driver(&i915_pci_driver);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}