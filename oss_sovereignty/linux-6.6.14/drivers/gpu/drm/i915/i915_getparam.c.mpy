{
  "module_name": "i915_getparam.c",
  "hash_id": "253f6bc6b588a9be6e78267f0bb8cae057503aa33710859a1de100a900f487ac",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_getparam.c",
  "human_readable_source": " \n\n#include \"gem/i915_gem_mman.h\"\n#include \"gt/intel_engine_user.h\"\n\n#include \"pxp/intel_pxp.h\"\n\n#include \"i915_cmd_parser.h\"\n#include \"i915_drv.h\"\n#include \"i915_getparam.h\"\n#include \"i915_perf.h\"\n\nint i915_getparam_ioctl(struct drm_device *dev, void *data,\n\t\t\tstruct drm_file *file_priv)\n{\n\tstruct drm_i915_private *i915 = to_i915(dev);\n\tstruct pci_dev *pdev = to_pci_dev(dev->dev);\n\tconst struct sseu_dev_info *sseu = &to_gt(i915)->info.sseu;\n\tdrm_i915_getparam_t *param = data;\n\tint value = 0;\n\n\tswitch (param->param) {\n\tcase I915_PARAM_IRQ_ACTIVE:\n\tcase I915_PARAM_ALLOW_BATCHBUFFER:\n\tcase I915_PARAM_LAST_DISPATCH:\n\tcase I915_PARAM_HAS_EXEC_CONSTANTS:\n\t\t \n\t\treturn -ENODEV;\n\tcase I915_PARAM_CHIPSET_ID:\n\t\tvalue = pdev->device;\n\t\tbreak;\n\tcase I915_PARAM_REVISION:\n\t\tvalue = pdev->revision;\n\t\tbreak;\n\tcase I915_PARAM_NUM_FENCES_AVAIL:\n\t\tvalue = to_gt(i915)->ggtt->num_fences;\n\t\tbreak;\n\tcase I915_PARAM_HAS_OVERLAY:\n\t\tvalue = !!i915->display.overlay;\n\t\tbreak;\n\tcase I915_PARAM_HAS_BSD:\n\t\tvalue = !!intel_engine_lookup_user(i915,\n\t\t\t\t\t\t   I915_ENGINE_CLASS_VIDEO, 0);\n\t\tbreak;\n\tcase I915_PARAM_HAS_BLT:\n\t\tvalue = !!intel_engine_lookup_user(i915,\n\t\t\t\t\t\t   I915_ENGINE_CLASS_COPY, 0);\n\t\tbreak;\n\tcase I915_PARAM_HAS_VEBOX:\n\t\tvalue = !!intel_engine_lookup_user(i915,\n\t\t\t\t\t\t   I915_ENGINE_CLASS_VIDEO_ENHANCE, 0);\n\t\tbreak;\n\tcase I915_PARAM_HAS_BSD2:\n\t\tvalue = !!intel_engine_lookup_user(i915,\n\t\t\t\t\t\t   I915_ENGINE_CLASS_VIDEO, 1);\n\t\tbreak;\n\tcase I915_PARAM_HAS_LLC:\n\t\tvalue = HAS_LLC(i915);\n\t\tbreak;\n\tcase I915_PARAM_HAS_WT:\n\t\tvalue = HAS_WT(i915);\n\t\tbreak;\n\tcase I915_PARAM_HAS_ALIASING_PPGTT:\n\t\tvalue = INTEL_PPGTT(i915);\n\t\tbreak;\n\tcase I915_PARAM_HAS_SEMAPHORES:\n\t\tvalue = !!(i915->caps.scheduler & I915_SCHEDULER_CAP_SEMAPHORES);\n\t\tbreak;\n\tcase I915_PARAM_HAS_SECURE_BATCHES:\n\t\tvalue = HAS_SECURE_BATCHES(i915) && capable(CAP_SYS_ADMIN);\n\t\tbreak;\n\tcase I915_PARAM_CMD_PARSER_VERSION:\n\t\tvalue = i915_cmd_parser_get_version(i915);\n\t\tbreak;\n\tcase I915_PARAM_SUBSLICE_TOTAL:\n\t\tvalue = intel_sseu_subslice_total(sseu);\n\t\tif (!value)\n\t\t\treturn -ENODEV;\n\t\tbreak;\n\tcase I915_PARAM_EU_TOTAL:\n\t\tvalue = sseu->eu_total;\n\t\tif (!value)\n\t\t\treturn -ENODEV;\n\t\tbreak;\n\tcase I915_PARAM_HAS_GPU_RESET:\n\t\tvalue = i915->params.enable_hangcheck &&\n\t\t\tintel_has_gpu_reset(to_gt(i915));\n\t\tif (value && intel_has_reset_engine(to_gt(i915)))\n\t\t\tvalue = 2;\n\t\tbreak;\n\tcase I915_PARAM_HAS_RESOURCE_STREAMER:\n\t\tvalue = 0;\n\t\tbreak;\n\tcase I915_PARAM_HAS_POOLED_EU:\n\t\tvalue = HAS_POOLED_EU(i915);\n\t\tbreak;\n\tcase I915_PARAM_MIN_EU_IN_POOL:\n\t\tvalue = sseu->min_eu_in_pool;\n\t\tbreak;\n\tcase I915_PARAM_HUC_STATUS:\n\t\t \n\t\tif (i915->media_gt)\n\t\t\tvalue = intel_huc_check_status(&i915->media_gt->uc.huc);\n\t\telse\n\t\t\tvalue = intel_huc_check_status(&to_gt(i915)->uc.huc);\n\t\tif (value < 0)\n\t\t\treturn value;\n\t\tbreak;\n\tcase I915_PARAM_PXP_STATUS:\n\t\tvalue = intel_pxp_get_readiness_status(i915->pxp);\n\t\tif (value < 0)\n\t\t\treturn value;\n\t\tbreak;\n\tcase I915_PARAM_MMAP_GTT_VERSION:\n\t\t \n\t\tvalue = i915_gem_mmap_gtt_version();\n\t\tbreak;\n\tcase I915_PARAM_HAS_SCHEDULER:\n\t\tvalue = i915->caps.scheduler;\n\t\tbreak;\n\n\tcase I915_PARAM_MMAP_VERSION:\n\t\t \n\tcase I915_PARAM_HAS_GEM:\n\tcase I915_PARAM_HAS_PAGEFLIPPING:\n\tcase I915_PARAM_HAS_EXECBUF2:  \n\tcase I915_PARAM_HAS_RELAXED_FENCING:\n\tcase I915_PARAM_HAS_COHERENT_RINGS:\n\tcase I915_PARAM_HAS_RELAXED_DELTA:\n\tcase I915_PARAM_HAS_GEN7_SOL_RESET:\n\tcase I915_PARAM_HAS_WAIT_TIMEOUT:\n\tcase I915_PARAM_HAS_PRIME_VMAP_FLUSH:\n\tcase I915_PARAM_HAS_PINNED_BATCHES:\n\tcase I915_PARAM_HAS_EXEC_NO_RELOC:\n\tcase I915_PARAM_HAS_EXEC_HANDLE_LUT:\n\tcase I915_PARAM_HAS_COHERENT_PHYS_GTT:\n\tcase I915_PARAM_HAS_EXEC_SOFTPIN:\n\tcase I915_PARAM_HAS_EXEC_ASYNC:\n\tcase I915_PARAM_HAS_EXEC_FENCE:\n\tcase I915_PARAM_HAS_EXEC_CAPTURE:\n\tcase I915_PARAM_HAS_EXEC_BATCH_FIRST:\n\tcase I915_PARAM_HAS_EXEC_FENCE_ARRAY:\n\tcase I915_PARAM_HAS_EXEC_SUBMIT_FENCE:\n\tcase I915_PARAM_HAS_EXEC_TIMELINE_FENCES:\n\tcase I915_PARAM_HAS_USERPTR_PROBE:\n\t\t \n\t\tvalue = 1;\n\t\tbreak;\n\tcase I915_PARAM_HAS_CONTEXT_ISOLATION:\n\t\tvalue = intel_engines_has_context_isolation(i915);\n\t\tbreak;\n\tcase I915_PARAM_SLICE_MASK:\n\t\t \n\t\tif (GRAPHICS_VER_FULL(i915) >= IP_VER(12, 50))\n\t\t\treturn -EINVAL;\n\n\t\tvalue = sseu->slice_mask;\n\t\tif (!value)\n\t\t\treturn -ENODEV;\n\t\tbreak;\n\tcase I915_PARAM_SUBSLICE_MASK:\n\t\t \n\t\tif (GRAPHICS_VER_FULL(i915) >= IP_VER(12, 50))\n\t\t\treturn -EINVAL;\n\n\t\t \n\t\tvalue = intel_sseu_get_hsw_subslices(sseu, 0);\n\t\tif (!value)\n\t\t\treturn -ENODEV;\n\t\tbreak;\n\tcase I915_PARAM_CS_TIMESTAMP_FREQUENCY:\n\t\tvalue = to_gt(i915)->clock_frequency;\n\t\tbreak;\n\tcase I915_PARAM_MMAP_GTT_COHERENT:\n\t\tvalue = INTEL_INFO(i915)->has_coherent_ggtt;\n\t\tbreak;\n\tcase I915_PARAM_PERF_REVISION:\n\t\tvalue = i915_perf_ioctl_version(i915);\n\t\tbreak;\n\tcase I915_PARAM_OA_TIMESTAMP_FREQUENCY:\n\t\tvalue = i915_perf_oa_timestamp_frequency(i915);\n\t\tbreak;\n\tdefault:\n\t\tdrm_dbg(&i915->drm, \"Unknown parameter %d\\n\", param->param);\n\t\treturn -EINVAL;\n\t}\n\n\tif (put_user(value, param->value))\n\t\treturn -EFAULT;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}