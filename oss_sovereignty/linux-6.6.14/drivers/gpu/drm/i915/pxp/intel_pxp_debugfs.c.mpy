{
  "module_name": "intel_pxp_debugfs.c",
  "hash_id": "b3968460d9eed64c83a0a0924f99eb4d29b3de6d92a764ccaba2989eff9faab7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/pxp/intel_pxp_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/string_helpers.h>\n\n#include <drm/drm_print.h>\n\n#include \"gt/intel_gt_debugfs.h\"\n\n#include \"i915_drv.h\"\n\n#include \"intel_pxp.h\"\n#include \"intel_pxp_debugfs.h\"\n#include \"intel_pxp_gsccs.h\"\n#include \"intel_pxp_irq.h\"\n#include \"intel_pxp_types.h\"\n\nstatic int pxp_info_show(struct seq_file *m, void *data)\n{\n\tstruct intel_pxp *pxp = m->private;\n\tstruct drm_printer p = drm_seq_file_printer(m);\n\n\tif (!intel_pxp_is_enabled(pxp)) {\n\t\tdrm_printf(&p, \"pxp disabled\\n\");\n\t\treturn 0;\n\t}\n\n\tdrm_printf(&p, \"active: %s\\n\", str_yes_no(intel_pxp_is_active(pxp)));\n\tdrm_printf(&p, \"instance counter: %u\\n\", pxp->key_instance);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(pxp_info);\n\nstatic int pxp_terminate_get(void *data, u64 *val)\n{\n\t \n\treturn -EPERM;\n}\n\nstatic int pxp_terminate_set(void *data, u64 val)\n{\n\tstruct intel_pxp *pxp = data;\n\tstruct intel_gt *gt = pxp->ctrl_gt;\n\tint timeout_ms;\n\n\tif (!intel_pxp_is_active(pxp))\n\t\treturn -ENODEV;\n\n\t \n\tspin_lock_irq(gt->irq_lock);\n\tintel_pxp_irq_handler(pxp, GEN12_DISPLAY_PXP_STATE_TERMINATED_INTERRUPT);\n\tspin_unlock_irq(gt->irq_lock);\n\n\ttimeout_ms = intel_pxp_get_backend_timeout_ms(pxp);\n\n\tif (!wait_for_completion_timeout(&pxp->termination,\n\t\t\t\t\t msecs_to_jiffies(timeout_ms)))\n\t\treturn -ETIMEDOUT;\n\n\treturn 0;\n}\n\nDEFINE_SIMPLE_ATTRIBUTE(pxp_terminate_fops, pxp_terminate_get, pxp_terminate_set, \"%llx\\n\");\n\nvoid intel_pxp_debugfs_register(struct intel_pxp *pxp)\n{\n\tstruct drm_minor *minor;\n\tstruct dentry *pxproot;\n\n\tif (!intel_pxp_is_supported(pxp))\n\t\treturn;\n\n\tminor = pxp->ctrl_gt->i915->drm.primary;\n\tif (!minor->debugfs_root)\n\t\treturn;\n\n\tpxproot = debugfs_create_dir(\"pxp\", minor->debugfs_root);\n\tif (IS_ERR(pxproot))\n\t\treturn;\n\n\tdebugfs_create_file(\"info\", 0444, pxproot,\n\t\t\t    pxp, &pxp_info_fops);\n\n\tdebugfs_create_file(\"terminate_state\", 0644, pxproot,\n\t\t\t    pxp, &pxp_terminate_fops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}