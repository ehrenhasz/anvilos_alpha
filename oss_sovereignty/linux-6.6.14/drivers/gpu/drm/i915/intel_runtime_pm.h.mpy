{
  "module_name": "intel_runtime_pm.h",
  "hash_id": "fde21910fd551287258af2f6ae96a55c8e55096d58d68473f4097a725877946e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/intel_runtime_pm.h",
  "human_readable_source": " \n \n\n#ifndef __INTEL_RUNTIME_PM_H__\n#define __INTEL_RUNTIME_PM_H__\n\n#include <linux/types.h>\n\n#include \"intel_wakeref.h\"\n\n#include \"i915_utils.h\"\n\nstruct device;\nstruct drm_i915_private;\nstruct drm_printer;\n\n \nstruct intel_runtime_pm {\n\tatomic_t wakeref_count;\n\tstruct device *kdev;  \n\tbool available;\n\tbool suspended;\n\tbool irqs_enabled;\n\tbool no_wakeref_tracking;\n\n\t \n\tspinlock_t lmem_userfault_lock;\n\n\t \n\tstruct list_head lmem_userfault_list;\n\n\t \n\tstruct intel_wakeref_auto userfault_wakeref;\n\n#if IS_ENABLED(CONFIG_DRM_I915_DEBUG_RUNTIME_PM)\n\t \n\tstruct intel_runtime_pm_debug {\n\t\tspinlock_t lock;\n\n\t\tdepot_stack_handle_t last_acquire;\n\t\tdepot_stack_handle_t last_release;\n\n\t\tdepot_stack_handle_t *owners;\n\t\tunsigned long count;\n\t} debug;\n#endif\n};\n\n#define BITS_PER_WAKEREF\t\\\n\tBITS_PER_TYPE(typeof_member(struct intel_runtime_pm, wakeref_count))\n#define INTEL_RPM_WAKELOCK_SHIFT\t(BITS_PER_WAKEREF / 2)\n#define INTEL_RPM_WAKELOCK_BIAS\t\t(1 << INTEL_RPM_WAKELOCK_SHIFT)\n#define INTEL_RPM_RAW_WAKEREF_MASK\t(INTEL_RPM_WAKELOCK_BIAS - 1)\n\nstatic inline int\nintel_rpm_raw_wakeref_count(int wakeref_count)\n{\n\treturn wakeref_count & INTEL_RPM_RAW_WAKEREF_MASK;\n}\n\nstatic inline int\nintel_rpm_wakelock_count(int wakeref_count)\n{\n\treturn wakeref_count >> INTEL_RPM_WAKELOCK_SHIFT;\n}\n\nstatic inline void\nassert_rpm_device_not_suspended(struct intel_runtime_pm *rpm)\n{\n\tWARN_ONCE(rpm->suspended,\n\t\t  \"Device suspended during HW access\\n\");\n}\n\nstatic inline void\n__assert_rpm_raw_wakeref_held(struct intel_runtime_pm *rpm, int wakeref_count)\n{\n\tassert_rpm_device_not_suspended(rpm);\n\tWARN_ONCE(!intel_rpm_raw_wakeref_count(wakeref_count),\n\t\t  \"RPM raw-wakeref not held\\n\");\n}\n\nstatic inline void\n__assert_rpm_wakelock_held(struct intel_runtime_pm *rpm, int wakeref_count)\n{\n\t__assert_rpm_raw_wakeref_held(rpm, wakeref_count);\n\tWARN_ONCE(!intel_rpm_wakelock_count(wakeref_count),\n\t\t  \"RPM wakelock ref not held during HW access\\n\");\n}\n\nstatic inline void\nassert_rpm_raw_wakeref_held(struct intel_runtime_pm *rpm)\n{\n\t__assert_rpm_raw_wakeref_held(rpm, atomic_read(&rpm->wakeref_count));\n}\n\nstatic inline void\nassert_rpm_wakelock_held(struct intel_runtime_pm *rpm)\n{\n\t__assert_rpm_wakelock_held(rpm, atomic_read(&rpm->wakeref_count));\n}\n\n \nstatic inline void\ndisable_rpm_wakeref_asserts(struct intel_runtime_pm *rpm)\n{\n\tatomic_add(INTEL_RPM_WAKELOCK_BIAS + 1,\n\t\t   &rpm->wakeref_count);\n}\n\n \nstatic inline void\nenable_rpm_wakeref_asserts(struct intel_runtime_pm *rpm)\n{\n\tatomic_sub(INTEL_RPM_WAKELOCK_BIAS + 1,\n\t\t   &rpm->wakeref_count);\n}\n\nvoid intel_runtime_pm_init_early(struct intel_runtime_pm *rpm);\nvoid intel_runtime_pm_enable(struct intel_runtime_pm *rpm);\nvoid intel_runtime_pm_disable(struct intel_runtime_pm *rpm);\nvoid intel_runtime_pm_driver_release(struct intel_runtime_pm *rpm);\n\nintel_wakeref_t intel_runtime_pm_get(struct intel_runtime_pm *rpm);\nintel_wakeref_t intel_runtime_pm_get_if_in_use(struct intel_runtime_pm *rpm);\nintel_wakeref_t intel_runtime_pm_get_if_active(struct intel_runtime_pm *rpm);\nintel_wakeref_t intel_runtime_pm_get_noresume(struct intel_runtime_pm *rpm);\nintel_wakeref_t intel_runtime_pm_get_raw(struct intel_runtime_pm *rpm);\n\n#define with_intel_runtime_pm(rpm, wf) \\\n\tfor ((wf) = intel_runtime_pm_get(rpm); (wf); \\\n\t     intel_runtime_pm_put((rpm), (wf)), (wf) = 0)\n\n#define with_intel_runtime_pm_if_in_use(rpm, wf) \\\n\tfor ((wf) = intel_runtime_pm_get_if_in_use(rpm); (wf); \\\n\t     intel_runtime_pm_put((rpm), (wf)), (wf) = 0)\n\n#define with_intel_runtime_pm_if_active(rpm, wf) \\\n\tfor ((wf) = intel_runtime_pm_get_if_active(rpm); (wf); \\\n\t     intel_runtime_pm_put((rpm), (wf)), (wf) = 0)\n\nvoid intel_runtime_pm_put_unchecked(struct intel_runtime_pm *rpm);\n#if IS_ENABLED(CONFIG_DRM_I915_DEBUG_RUNTIME_PM)\nvoid intel_runtime_pm_put(struct intel_runtime_pm *rpm, intel_wakeref_t wref);\n#else\nstatic inline void\nintel_runtime_pm_put(struct intel_runtime_pm *rpm, intel_wakeref_t wref)\n{\n\tintel_runtime_pm_put_unchecked(rpm);\n}\n#endif\nvoid intel_runtime_pm_put_raw(struct intel_runtime_pm *rpm, intel_wakeref_t wref);\n\n#if IS_ENABLED(CONFIG_DRM_I915_DEBUG_RUNTIME_PM)\nvoid print_intel_runtime_pm_wakeref(struct intel_runtime_pm *rpm,\n\t\t\t\t    struct drm_printer *p);\n#else\nstatic inline void print_intel_runtime_pm_wakeref(struct intel_runtime_pm *rpm,\n\t\t\t\t\t\t  struct drm_printer *p)\n{\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}