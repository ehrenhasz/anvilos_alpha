{
  "module_name": "i915_gem_object.c",
  "hash_id": "c5b593fe891872b049ac853b2c173a0739aa0c3ae261c86110fa0a0a3b8127c4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gem/selftests/i915_gem_object.c",
  "human_readable_source": " \n\n#include \"i915_selftest.h\"\n\n#include \"huge_gem_object.h\"\n#include \"selftests/igt_flush_test.h\"\n#include \"selftests/mock_gem_device.h\"\n\nstatic int igt_gem_object(void *arg)\n{\n\tstruct drm_i915_private *i915 = arg;\n\tstruct drm_i915_gem_object *obj;\n\tint err;\n\n\t \n\n\tobj = i915_gem_object_create_shmem(i915, PAGE_SIZE);\n\tif (IS_ERR(obj)) {\n\t\terr = PTR_ERR(obj);\n\t\tpr_err(\"i915_gem_object_create failed, err=%d\\n\", err);\n\t\tgoto out;\n\t}\n\n\terr = 0;\n\ti915_gem_object_put(obj);\nout:\n\treturn err;\n}\n\nstatic int igt_gem_huge(void *arg)\n{\n\tconst unsigned long nreal = 509;  \n\tstruct drm_i915_private *i915 = arg;\n\tstruct drm_i915_gem_object *obj;\n\tunsigned long n;\n\tint err;\n\n\t \n\n\tobj = huge_gem_object(i915,\n\t\t\t      nreal * PAGE_SIZE,\n\t\t\t      to_gt(i915)->ggtt->vm.total + PAGE_SIZE);\n\tif (IS_ERR(obj))\n\t\treturn PTR_ERR(obj);\n\n\terr = i915_gem_object_pin_pages_unlocked(obj);\n\tif (err) {\n\t\tpr_err(\"Failed to allocate %lu pages (%lu total), err=%d\\n\",\n\t\t       nreal, obj->base.size / PAGE_SIZE, err);\n\t\tgoto out;\n\t}\n\n\tfor (n = 0; n < obj->base.size / PAGE_SIZE; n++) {\n\t\tif (i915_gem_object_get_page(obj, n) !=\n\t\t    i915_gem_object_get_page(obj, n % nreal)) {\n\t\t\tpr_err(\"Page lookup mismatch at index %lu [%lu]\\n\",\n\t\t\t       n, n % nreal);\n\t\t\terr = -EINVAL;\n\t\t\tgoto out_unpin;\n\t\t}\n\t}\n\nout_unpin:\n\ti915_gem_object_unpin_pages(obj);\nout:\n\ti915_gem_object_put(obj);\n\treturn err;\n}\n\nint i915_gem_object_mock_selftests(void)\n{\n\tstatic const struct i915_subtest tests[] = {\n\t\tSUBTEST(igt_gem_object),\n\t};\n\tstruct drm_i915_private *i915;\n\tint err;\n\n\ti915 = mock_gem_device();\n\tif (!i915)\n\t\treturn -ENOMEM;\n\n\terr = i915_subtests(tests, i915);\n\n\tmock_destroy_device(i915);\n\treturn err;\n}\n\nint i915_gem_object_live_selftests(struct drm_i915_private *i915)\n{\n\tstatic const struct i915_subtest tests[] = {\n\t\tSUBTEST(igt_gem_huge),\n\t};\n\n\treturn i915_live_subtests(tests, i915);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}