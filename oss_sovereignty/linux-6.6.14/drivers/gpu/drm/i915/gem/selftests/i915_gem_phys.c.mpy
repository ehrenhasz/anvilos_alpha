{
  "module_name": "i915_gem_phys.c",
  "hash_id": "ce72eb1593c30315dad82ebfbce00d42e94953baecc5f2f9ba0cc974d2c69565",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gem/selftests/i915_gem_phys.c",
  "human_readable_source": " \n\n#include \"i915_selftest.h\"\n\n#include \"selftests/mock_gem_device.h\"\n\nstatic int mock_phys_object(void *arg)\n{\n\tstruct drm_i915_private *i915 = arg;\n\tstruct drm_i915_gem_object *obj;\n\tint err;\n\n\t \n\n\tobj = i915_gem_object_create_shmem(i915, PAGE_SIZE);\n\tif (IS_ERR(obj)) {\n\t\terr = PTR_ERR(obj);\n\t\tpr_err(\"i915_gem_object_create failed, err=%d\\n\", err);\n\t\tgoto out;\n\t}\n\n\ti915_gem_object_lock(obj, NULL);\n\tif (!i915_gem_object_has_struct_page(obj)) {\n\t\ti915_gem_object_unlock(obj);\n\t\terr = -EINVAL;\n\t\tpr_err(\"shmem has no struct page\\n\");\n\t\tgoto out_obj;\n\t}\n\n\terr = i915_gem_object_attach_phys(obj, PAGE_SIZE);\n\ti915_gem_object_unlock(obj);\n\tif (err) {\n\t\tpr_err(\"i915_gem_object_attach_phys failed, err=%d\\n\", err);\n\t\tgoto out_obj;\n\t}\n\n\tif (i915_gem_object_has_struct_page(obj)) {\n\t\tpr_err(\"i915_gem_object_attach_phys did not create a phys object\\n\");\n\t\terr = -EINVAL;\n\t\tgoto out_obj;\n\t}\n\n\tif (!atomic_read(&obj->mm.pages_pin_count)) {\n\t\tpr_err(\"i915_gem_object_attach_phys did not pin its phys pages\\n\");\n\t\terr = -EINVAL;\n\t\tgoto out_obj;\n\t}\n\n\t \n\ti915_gem_object_lock(obj, NULL);\n\terr = i915_gem_object_set_to_gtt_domain(obj, true);\n\ti915_gem_object_unlock(obj);\n\tif (err) {\n\t\tpr_err(\"i915_gem_object_set_to_gtt_domain failed with err=%d\\n\",\n\t\t       err);\n\t\tgoto out_obj;\n\t}\n\nout_obj:\n\ti915_gem_object_put(obj);\nout:\n\treturn err;\n}\n\nint i915_gem_phys_mock_selftests(void)\n{\n\tstatic const struct i915_subtest tests[] = {\n\t\tSUBTEST(mock_phys_object),\n\t};\n\tstruct drm_i915_private *i915;\n\tint err;\n\n\ti915 = mock_gem_device();\n\tif (!i915)\n\t\treturn -ENOMEM;\n\n\terr = i915_subtests(tests, i915);\n\n\tmock_destroy_device(i915);\n\treturn err;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}