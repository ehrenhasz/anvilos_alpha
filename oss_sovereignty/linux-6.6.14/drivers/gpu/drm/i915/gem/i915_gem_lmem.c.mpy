{
  "module_name": "i915_gem_lmem.c",
  "hash_id": "6d05bd41a6958e07fe727dd02d42cfeea2623e10ce86f1035df8fbb6446e3018",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gem/i915_gem_lmem.c",
  "human_readable_source": "\n \n\n#include <uapi/drm/i915_drm.h>\n\n#include \"intel_memory_region.h\"\n#include \"gem/i915_gem_region.h\"\n#include \"gem/i915_gem_lmem.h\"\n#include \"i915_drv.h\"\n\nvoid __iomem *\ni915_gem_object_lmem_io_map(struct drm_i915_gem_object *obj,\n\t\t\t    unsigned long n,\n\t\t\t    unsigned long size)\n{\n\tresource_size_t offset;\n\n\tGEM_BUG_ON(!i915_gem_object_is_contiguous(obj));\n\n\toffset = i915_gem_object_get_dma_address(obj, n);\n\toffset -= obj->mm.region->region.start;\n\n\treturn io_mapping_map_wc(&obj->mm.region->iomap, offset, size);\n}\n\n \nbool i915_gem_object_is_lmem(struct drm_i915_gem_object *obj)\n{\n\tstruct intel_memory_region *mr = READ_ONCE(obj->mm.region);\n\n#ifdef CONFIG_LOCKDEP\n\tif (i915_gem_object_migratable(obj) &&\n\t    i915_gem_object_evictable(obj))\n\t\tassert_object_held(obj);\n#endif\n\treturn mr && (mr->type == INTEL_MEMORY_LOCAL ||\n\t\t      mr->type == INTEL_MEMORY_STOLEN_LOCAL);\n}\n\n \nbool __i915_gem_object_is_lmem(struct drm_i915_gem_object *obj)\n{\n\tstruct intel_memory_region *mr = READ_ONCE(obj->mm.region);\n\n#ifdef CONFIG_LOCKDEP\n\tGEM_WARN_ON(dma_resv_test_signaled(obj->base.resv, DMA_RESV_USAGE_BOOKKEEP) &&\n\t\t    i915_gem_object_evictable(obj));\n#endif\n\treturn mr && (mr->type == INTEL_MEMORY_LOCAL ||\n\t\t      mr->type == INTEL_MEMORY_STOLEN_LOCAL);\n}\n\n \nstruct drm_i915_gem_object *\n__i915_gem_object_create_lmem_with_ps(struct drm_i915_private *i915,\n\t\t\t\t      resource_size_t size,\n\t\t\t\t      resource_size_t page_size,\n\t\t\t\t      unsigned int flags)\n{\n\treturn i915_gem_object_create_region(i915->mm.regions[INTEL_REGION_LMEM_0],\n\t\t\t\t\t     size, page_size, flags);\n}\n\nstruct drm_i915_gem_object *\ni915_gem_object_create_lmem_from_data(struct drm_i915_private *i915,\n\t\t\t\t      const void *data, size_t size)\n{\n\tstruct drm_i915_gem_object *obj;\n\tvoid *map;\n\n\tobj = i915_gem_object_create_lmem(i915,\n\t\t\t\t\t  round_up(size, PAGE_SIZE),\n\t\t\t\t\t  I915_BO_ALLOC_CONTIGUOUS);\n\tif (IS_ERR(obj))\n\t\treturn obj;\n\n\tmap = i915_gem_object_pin_map_unlocked(obj, I915_MAP_WC);\n\tif (IS_ERR(map)) {\n\t\ti915_gem_object_put(obj);\n\t\treturn map;\n\t}\n\n\tmemcpy(map, data, size);\n\n\ti915_gem_object_flush_map(obj);\n\t__i915_gem_object_release_map(obj);\n\n\treturn obj;\n}\n\nstruct drm_i915_gem_object *\ni915_gem_object_create_lmem(struct drm_i915_private *i915,\n\t\t\t    resource_size_t size,\n\t\t\t    unsigned int flags)\n{\n\treturn i915_gem_object_create_region(i915->mm.regions[INTEL_REGION_LMEM_0],\n\t\t\t\t\t     size, 0, flags);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}