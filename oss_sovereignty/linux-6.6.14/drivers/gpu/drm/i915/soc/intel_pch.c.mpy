{
  "module_name": "intel_pch.c",
  "hash_id": "5f237550cf7af369b59d480b7520f40013ed932f642e492612fa3b7a9fcdf0a8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/soc/intel_pch.c",
  "human_readable_source": "\n \n\n#include \"i915_drv.h\"\n#include \"i915_utils.h\"\n#include \"intel_pch.h\"\n\n \nstatic enum intel_pch\nintel_pch_type(const struct drm_i915_private *dev_priv, unsigned short id)\n{\n\tswitch (id) {\n\tcase INTEL_PCH_IBX_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Ibex Peak PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm, GRAPHICS_VER(dev_priv) != 5);\n\t\treturn PCH_IBX;\n\tcase INTEL_PCH_CPT_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found CougarPoint PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    GRAPHICS_VER(dev_priv) != 6 && !IS_IVYBRIDGE(dev_priv));\n\t\treturn PCH_CPT;\n\tcase INTEL_PCH_PPT_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found PantherPoint PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    GRAPHICS_VER(dev_priv) != 6 && !IS_IVYBRIDGE(dev_priv));\n\t\t \n\t\treturn PCH_CPT;\n\tcase INTEL_PCH_LPT_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found LynxPoint PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_HASWELL(dev_priv) && !IS_BROADWELL(dev_priv));\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    IS_HASWELL_ULT(dev_priv) || IS_BROADWELL_ULT(dev_priv));\n\t\treturn PCH_LPT;\n\tcase INTEL_PCH_LPT_LP_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found LynxPoint LP PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_HASWELL(dev_priv) && !IS_BROADWELL(dev_priv));\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_HASWELL_ULT(dev_priv) && !IS_BROADWELL_ULT(dev_priv));\n\t\treturn PCH_LPT;\n\tcase INTEL_PCH_WPT_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found WildcatPoint PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_HASWELL(dev_priv) && !IS_BROADWELL(dev_priv));\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    IS_HASWELL_ULT(dev_priv) || IS_BROADWELL_ULT(dev_priv));\n\t\t \n\t\treturn PCH_LPT;\n\tcase INTEL_PCH_WPT_LP_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found WildcatPoint LP PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_HASWELL(dev_priv) && !IS_BROADWELL(dev_priv));\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_HASWELL_ULT(dev_priv) && !IS_BROADWELL_ULT(dev_priv));\n\t\t \n\t\treturn PCH_LPT;\n\tcase INTEL_PCH_SPT_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found SunrisePoint PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_SKYLAKE(dev_priv) && !IS_KABYLAKE(dev_priv));\n\t\treturn PCH_SPT;\n\tcase INTEL_PCH_SPT_LP_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found SunrisePoint LP PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_SKYLAKE(dev_priv) &&\n\t\t\t    !IS_KABYLAKE(dev_priv) &&\n\t\t\t    !IS_COFFEELAKE(dev_priv) &&\n\t\t\t    !IS_COMETLAKE(dev_priv));\n\t\treturn PCH_SPT;\n\tcase INTEL_PCH_KBP_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Kaby Lake PCH (KBP)\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_SKYLAKE(dev_priv) &&\n\t\t\t    !IS_KABYLAKE(dev_priv) &&\n\t\t\t    !IS_COFFEELAKE(dev_priv) &&\n\t\t\t    !IS_COMETLAKE(dev_priv));\n\t\t \n\t\treturn PCH_SPT;\n\tcase INTEL_PCH_CNP_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Cannon Lake PCH (CNP)\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_COFFEELAKE(dev_priv) &&\n\t\t\t    !IS_COMETLAKE(dev_priv));\n\t\treturn PCH_CNP;\n\tcase INTEL_PCH_CNP_LP_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm,\n\t\t\t    \"Found Cannon Lake LP PCH (CNP-LP)\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_COFFEELAKE(dev_priv) &&\n\t\t\t    !IS_COMETLAKE(dev_priv));\n\t\treturn PCH_CNP;\n\tcase INTEL_PCH_CMP_DEVICE_ID_TYPE:\n\tcase INTEL_PCH_CMP2_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Comet Lake PCH (CMP)\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_COFFEELAKE(dev_priv) &&\n\t\t\t    !IS_COMETLAKE(dev_priv) &&\n\t\t\t    !IS_ROCKETLAKE(dev_priv));\n\t\t \n\t\treturn PCH_CNP;\n\tcase INTEL_PCH_CMP_V_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Comet Lake V PCH (CMP-V)\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm,\n\t\t\t    !IS_COFFEELAKE(dev_priv) &&\n\t\t\t    !IS_COMETLAKE(dev_priv));\n\t\t \n\t\treturn PCH_SPT;\n\tcase INTEL_PCH_ICP_DEVICE_ID_TYPE:\n\tcase INTEL_PCH_ICP2_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Ice Lake PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm, !IS_ICELAKE(dev_priv));\n\t\treturn PCH_ICP;\n\tcase INTEL_PCH_MCC_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Mule Creek Canyon PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm, !(IS_JASPERLAKE(dev_priv) ||\n\t\t\t\t\t      IS_ELKHARTLAKE(dev_priv)));\n\t\t \n\t\treturn PCH_TGP;\n\tcase INTEL_PCH_TGP_DEVICE_ID_TYPE:\n\tcase INTEL_PCH_TGP2_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Tiger Lake LP PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm, !IS_TIGERLAKE(dev_priv) &&\n\t\t\t    !IS_ROCKETLAKE(dev_priv) &&\n\t\t\t    !IS_GEN9_BC(dev_priv));\n\t\treturn PCH_TGP;\n\tcase INTEL_PCH_JSP_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Jasper Lake PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm, !(IS_JASPERLAKE(dev_priv) ||\n\t\t\t\t\t      IS_ELKHARTLAKE(dev_priv)));\n\t\t \n\t\treturn PCH_ICP;\n\tcase INTEL_PCH_ADP_DEVICE_ID_TYPE:\n\tcase INTEL_PCH_ADP2_DEVICE_ID_TYPE:\n\tcase INTEL_PCH_ADP3_DEVICE_ID_TYPE:\n\tcase INTEL_PCH_ADP4_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Alder Lake PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm, !IS_ALDERLAKE_S(dev_priv) &&\n\t\t\t    !IS_ALDERLAKE_P(dev_priv));\n\t\treturn PCH_ADP;\n\tcase INTEL_PCH_MTP_DEVICE_ID_TYPE:\n\tcase INTEL_PCH_MTP2_DEVICE_ID_TYPE:\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Found Meteor Lake PCH\\n\");\n\t\tdrm_WARN_ON(&dev_priv->drm, !IS_METEORLAKE(dev_priv));\n\t\treturn PCH_MTP;\n\tdefault:\n\t\treturn PCH_NONE;\n\t}\n}\n\nstatic bool intel_is_virt_pch(unsigned short id,\n\t\t\t      unsigned short svendor, unsigned short sdevice)\n{\n\treturn (id == INTEL_PCH_P2X_DEVICE_ID_TYPE ||\n\t\tid == INTEL_PCH_P3X_DEVICE_ID_TYPE ||\n\t\t(id == INTEL_PCH_QEMU_DEVICE_ID_TYPE &&\n\t\t svendor == PCI_SUBVENDOR_ID_REDHAT_QUMRANET &&\n\t\t sdevice == PCI_SUBDEVICE_ID_QEMU));\n}\n\nstatic void\nintel_virt_detect_pch(const struct drm_i915_private *dev_priv,\n\t\t      unsigned short *pch_id, enum intel_pch *pch_type)\n{\n\tunsigned short id = 0;\n\n\t \n\n\tif (IS_METEORLAKE(dev_priv))\n\t\tid = INTEL_PCH_MTP_DEVICE_ID_TYPE;\n\telse if (IS_ALDERLAKE_S(dev_priv) || IS_ALDERLAKE_P(dev_priv))\n\t\tid = INTEL_PCH_ADP_DEVICE_ID_TYPE;\n\telse if (IS_TIGERLAKE(dev_priv) || IS_ROCKETLAKE(dev_priv))\n\t\tid = INTEL_PCH_TGP_DEVICE_ID_TYPE;\n\telse if (IS_JASPERLAKE(dev_priv) || IS_ELKHARTLAKE(dev_priv))\n\t\tid = INTEL_PCH_MCC_DEVICE_ID_TYPE;\n\telse if (IS_ICELAKE(dev_priv))\n\t\tid = INTEL_PCH_ICP_DEVICE_ID_TYPE;\n\telse if (IS_COFFEELAKE(dev_priv) ||\n\t\t IS_COMETLAKE(dev_priv))\n\t\tid = INTEL_PCH_CNP_DEVICE_ID_TYPE;\n\telse if (IS_KABYLAKE(dev_priv) || IS_SKYLAKE(dev_priv))\n\t\tid = INTEL_PCH_SPT_DEVICE_ID_TYPE;\n\telse if (IS_HASWELL_ULT(dev_priv) || IS_BROADWELL_ULT(dev_priv))\n\t\tid = INTEL_PCH_LPT_LP_DEVICE_ID_TYPE;\n\telse if (IS_HASWELL(dev_priv) || IS_BROADWELL(dev_priv))\n\t\tid = INTEL_PCH_LPT_DEVICE_ID_TYPE;\n\telse if (GRAPHICS_VER(dev_priv) == 6 || IS_IVYBRIDGE(dev_priv))\n\t\tid = INTEL_PCH_CPT_DEVICE_ID_TYPE;\n\telse if (GRAPHICS_VER(dev_priv) == 5)\n\t\tid = INTEL_PCH_IBX_DEVICE_ID_TYPE;\n\n\tif (id)\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Assuming PCH ID %04x\\n\", id);\n\telse\n\t\tdrm_dbg_kms(&dev_priv->drm, \"Assuming no PCH\\n\");\n\n\t*pch_type = intel_pch_type(dev_priv, id);\n\n\t \n\tif (drm_WARN_ON(&dev_priv->drm,\n\t\t\tid && *pch_type == PCH_NONE))\n\t\tid = 0;\n\n\t*pch_id = id;\n}\n\nvoid intel_detect_pch(struct drm_i915_private *dev_priv)\n{\n\tstruct pci_dev *pch = NULL;\n\tunsigned short id;\n\tenum intel_pch pch_type;\n\n\t \n\tif (IS_DG1(dev_priv)) {\n\t\tdev_priv->pch_type = PCH_DG1;\n\t\treturn;\n\t} else if (IS_DG2(dev_priv)) {\n\t\tdev_priv->pch_type = PCH_DG2;\n\t\treturn;\n\t}\n\n\t \n\twhile ((pch = pci_get_class(PCI_CLASS_BRIDGE_ISA << 8, pch))) {\n\t\tif (pch->vendor != PCI_VENDOR_ID_INTEL)\n\t\t\tcontinue;\n\n\t\tid = pch->device & INTEL_PCH_DEVICE_ID_MASK;\n\n\t\tpch_type = intel_pch_type(dev_priv, id);\n\t\tif (pch_type != PCH_NONE) {\n\t\t\tdev_priv->pch_type = pch_type;\n\t\t\tdev_priv->pch_id = id;\n\t\t\tbreak;\n\t\t} else if (intel_is_virt_pch(id, pch->subsystem_vendor,\n\t\t\t\t\t     pch->subsystem_device)) {\n\t\t\tintel_virt_detect_pch(dev_priv, &id, &pch_type);\n\t\t\tdev_priv->pch_type = pch_type;\n\t\t\tdev_priv->pch_id = id;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\tif (pch && !HAS_DISPLAY(dev_priv)) {\n\t\tdrm_dbg_kms(&dev_priv->drm,\n\t\t\t    \"Display disabled, reverting to NOP PCH\\n\");\n\t\tdev_priv->pch_type = PCH_NOP;\n\t\tdev_priv->pch_id = 0;\n\t} else if (!pch) {\n\t\tif (i915_run_as_guest() && HAS_DISPLAY(dev_priv)) {\n\t\t\tintel_virt_detect_pch(dev_priv, &id, &pch_type);\n\t\t\tdev_priv->pch_type = pch_type;\n\t\t\tdev_priv->pch_id = id;\n\t\t} else {\n\t\t\tdrm_dbg_kms(&dev_priv->drm, \"No PCH found.\\n\");\n\t\t}\n\t}\n\n\tpci_dev_put(pch);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}