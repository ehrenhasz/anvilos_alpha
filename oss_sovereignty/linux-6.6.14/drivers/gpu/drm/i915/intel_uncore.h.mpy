{
  "module_name": "intel_uncore.h",
  "hash_id": "a7b85011702a17a9294238bbb4f9a11382e3099441cb162b914cdecf0efa5309",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/intel_uncore.h",
  "human_readable_source": " \n\n#ifndef __INTEL_UNCORE_H__\n#define __INTEL_UNCORE_H__\n\n#include <linux/spinlock.h>\n#include <linux/notifier.h>\n#include <linux/hrtimer.h>\n#include <linux/io-64-nonatomic-lo-hi.h>\n#include <linux/types.h>\n\n#include \"i915_reg_defs.h\"\n\nstruct drm_device;\nstruct drm_i915_private;\nstruct intel_runtime_pm;\nstruct intel_uncore;\nstruct intel_gt;\n\nstruct intel_uncore_mmio_debug {\n\tspinlock_t lock;  \n\tint unclaimed_mmio_check;\n\tint saved_mmio_check;\n\tu32 suspend_count;\n};\n\nenum forcewake_domain_id {\n\tFW_DOMAIN_ID_RENDER = 0,\n\tFW_DOMAIN_ID_GT,         \n\tFW_DOMAIN_ID_MEDIA,\n\tFW_DOMAIN_ID_MEDIA_VDBOX0,\n\tFW_DOMAIN_ID_MEDIA_VDBOX1,\n\tFW_DOMAIN_ID_MEDIA_VDBOX2,\n\tFW_DOMAIN_ID_MEDIA_VDBOX3,\n\tFW_DOMAIN_ID_MEDIA_VDBOX4,\n\tFW_DOMAIN_ID_MEDIA_VDBOX5,\n\tFW_DOMAIN_ID_MEDIA_VDBOX6,\n\tFW_DOMAIN_ID_MEDIA_VDBOX7,\n\tFW_DOMAIN_ID_MEDIA_VEBOX0,\n\tFW_DOMAIN_ID_MEDIA_VEBOX1,\n\tFW_DOMAIN_ID_MEDIA_VEBOX2,\n\tFW_DOMAIN_ID_MEDIA_VEBOX3,\n\tFW_DOMAIN_ID_GSC,\n\n\tFW_DOMAIN_ID_COUNT\n};\n\nenum forcewake_domains {\n\tFORCEWAKE_RENDER\t= BIT(FW_DOMAIN_ID_RENDER),\n\tFORCEWAKE_GT\t\t= BIT(FW_DOMAIN_ID_GT),\n\tFORCEWAKE_MEDIA\t\t= BIT(FW_DOMAIN_ID_MEDIA),\n\tFORCEWAKE_MEDIA_VDBOX0\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX0),\n\tFORCEWAKE_MEDIA_VDBOX1\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX1),\n\tFORCEWAKE_MEDIA_VDBOX2\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX2),\n\tFORCEWAKE_MEDIA_VDBOX3\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX3),\n\tFORCEWAKE_MEDIA_VDBOX4\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX4),\n\tFORCEWAKE_MEDIA_VDBOX5\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX5),\n\tFORCEWAKE_MEDIA_VDBOX6\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX6),\n\tFORCEWAKE_MEDIA_VDBOX7\t= BIT(FW_DOMAIN_ID_MEDIA_VDBOX7),\n\tFORCEWAKE_MEDIA_VEBOX0\t= BIT(FW_DOMAIN_ID_MEDIA_VEBOX0),\n\tFORCEWAKE_MEDIA_VEBOX1\t= BIT(FW_DOMAIN_ID_MEDIA_VEBOX1),\n\tFORCEWAKE_MEDIA_VEBOX2\t= BIT(FW_DOMAIN_ID_MEDIA_VEBOX2),\n\tFORCEWAKE_MEDIA_VEBOX3\t= BIT(FW_DOMAIN_ID_MEDIA_VEBOX3),\n\tFORCEWAKE_GSC\t\t= BIT(FW_DOMAIN_ID_GSC),\n\n\tFORCEWAKE_ALL = BIT(FW_DOMAIN_ID_COUNT) - 1,\n};\n\nstruct intel_uncore_fw_get {\n\tvoid (*force_wake_get)(struct intel_uncore *uncore,\n\t\t\t       enum forcewake_domains domains);\n};\n\nstruct intel_uncore_funcs {\n\tenum forcewake_domains (*read_fw_domains)(struct intel_uncore *uncore,\n\t\t\t\t\t\t  i915_reg_t r);\n\tenum forcewake_domains (*write_fw_domains)(struct intel_uncore *uncore,\n\t\t\t\t\t\t   i915_reg_t r);\n\n\tu8 (*mmio_readb)(struct intel_uncore *uncore,\n\t\t\t i915_reg_t r, bool trace);\n\tu16 (*mmio_readw)(struct intel_uncore *uncore,\n\t\t\t  i915_reg_t r, bool trace);\n\tu32 (*mmio_readl)(struct intel_uncore *uncore,\n\t\t\t  i915_reg_t r, bool trace);\n\tu64 (*mmio_readq)(struct intel_uncore *uncore,\n\t\t\t  i915_reg_t r, bool trace);\n\n\tvoid (*mmio_writeb)(struct intel_uncore *uncore,\n\t\t\t    i915_reg_t r, u8 val, bool trace);\n\tvoid (*mmio_writew)(struct intel_uncore *uncore,\n\t\t\t    i915_reg_t r, u16 val, bool trace);\n\tvoid (*mmio_writel)(struct intel_uncore *uncore,\n\t\t\t    i915_reg_t r, u32 val, bool trace);\n};\n\nstruct intel_forcewake_range {\n\tu32 start;\n\tu32 end;\n\n\tenum forcewake_domains domains;\n};\n\n \nstruct i915_range {\n\tu32 start;\n\tu32 end;\n};\n\nstruct intel_uncore {\n\tvoid __iomem *regs;\n\n\tstruct drm_i915_private *i915;\n\tstruct intel_gt *gt;\n\tstruct intel_runtime_pm *rpm;\n\n\tspinlock_t lock;  \n\n\t \n\tu32 gsi_offset;\n\n\tunsigned int flags;\n#define UNCORE_HAS_FORCEWAKE\t\tBIT(0)\n#define UNCORE_HAS_FPGA_DBG_UNCLAIMED\tBIT(1)\n#define UNCORE_HAS_DBG_UNCLAIMED\tBIT(2)\n#define UNCORE_HAS_FIFO\t\t\tBIT(3)\n#define UNCORE_NEEDS_FLR_ON_FINI\tBIT(4)\n\n\tconst struct intel_forcewake_range *fw_domains_table;\n\tunsigned int fw_domains_table_entries;\n\n\t \n\tconst struct i915_range *shadowed_reg_table;\n\tunsigned int shadowed_reg_table_entries;\n\n\tstruct notifier_block pmic_bus_access_nb;\n\tconst struct intel_uncore_fw_get *fw_get_funcs;\n\tstruct intel_uncore_funcs funcs;\n\n\tunsigned int fifo_count;\n\n\tenum forcewake_domains fw_domains;\n\tenum forcewake_domains fw_domains_active;\n\tenum forcewake_domains fw_domains_timer;\n\tenum forcewake_domains fw_domains_saved;  \n\n\tstruct intel_uncore_forcewake_domain {\n\t\tstruct intel_uncore *uncore;\n\t\tenum forcewake_domain_id id;\n\t\tenum forcewake_domains mask;\n\t\tunsigned int wake_count;\n\t\tbool active;\n\t\tstruct hrtimer timer;\n\t\tu32 __iomem *reg_set;\n\t\tu32 __iomem *reg_ack;\n\t} *fw_domain[FW_DOMAIN_ID_COUNT];\n\n\tunsigned int user_forcewake_count;\n\n\tstruct intel_uncore_mmio_debug *debug;\n};\n\n \n#define for_each_fw_domain_masked(domain__, mask__, uncore__, tmp__) \\\n\tfor (tmp__ = (mask__); tmp__ ;) \\\n\t\tfor_each_if(domain__ = (uncore__)->fw_domain[__mask_next_bit(tmp__)])\n\n#define for_each_fw_domain(domain__, uncore__, tmp__) \\\n\tfor_each_fw_domain_masked(domain__, (uncore__)->fw_domains, uncore__, tmp__)\n\nstatic inline bool\nintel_uncore_has_forcewake(const struct intel_uncore *uncore)\n{\n\treturn uncore->flags & UNCORE_HAS_FORCEWAKE;\n}\n\nstatic inline bool\nintel_uncore_has_fpga_dbg_unclaimed(const struct intel_uncore *uncore)\n{\n\treturn uncore->flags & UNCORE_HAS_FPGA_DBG_UNCLAIMED;\n}\n\nstatic inline bool\nintel_uncore_has_dbg_unclaimed(const struct intel_uncore *uncore)\n{\n\treturn uncore->flags & UNCORE_HAS_DBG_UNCLAIMED;\n}\n\nstatic inline bool\nintel_uncore_has_fifo(const struct intel_uncore *uncore)\n{\n\treturn uncore->flags & UNCORE_HAS_FIFO;\n}\n\nstatic inline bool\nintel_uncore_needs_flr_on_fini(const struct intel_uncore *uncore)\n{\n\treturn uncore->flags & UNCORE_NEEDS_FLR_ON_FINI;\n}\n\nstatic inline bool\nintel_uncore_set_flr_on_fini(struct intel_uncore *uncore)\n{\n\treturn uncore->flags |= UNCORE_NEEDS_FLR_ON_FINI;\n}\n\nvoid intel_uncore_mmio_debug_init_early(struct drm_i915_private *i915);\nvoid intel_uncore_init_early(struct intel_uncore *uncore,\n\t\t\t     struct intel_gt *gt);\nint intel_uncore_setup_mmio(struct intel_uncore *uncore, phys_addr_t phys_addr);\nint intel_uncore_init_mmio(struct intel_uncore *uncore);\nvoid intel_uncore_prune_engine_fw_domains(struct intel_uncore *uncore,\n\t\t\t\t\t  struct intel_gt *gt);\nbool intel_uncore_unclaimed_mmio(struct intel_uncore *uncore);\nbool intel_uncore_arm_unclaimed_mmio_detection(struct intel_uncore *uncore);\nvoid intel_uncore_cleanup_mmio(struct intel_uncore *uncore);\nvoid intel_uncore_fini_mmio(struct drm_device *dev, void *data);\nvoid intel_uncore_suspend(struct intel_uncore *uncore);\nvoid intel_uncore_resume_early(struct intel_uncore *uncore);\nvoid intel_uncore_runtime_resume(struct intel_uncore *uncore);\n\nvoid assert_forcewakes_inactive(struct intel_uncore *uncore);\nvoid assert_forcewakes_active(struct intel_uncore *uncore,\n\t\t\t      enum forcewake_domains fw_domains);\nconst char *intel_uncore_forcewake_domain_to_str(const enum forcewake_domain_id id);\n\nenum forcewake_domains\nintel_uncore_forcewake_for_reg(struct intel_uncore *uncore,\n\t\t\t       i915_reg_t reg, unsigned int op);\n#define FW_REG_READ  (1)\n#define FW_REG_WRITE (2)\n\nvoid intel_uncore_forcewake_get(struct intel_uncore *uncore,\n\t\t\t\tenum forcewake_domains domains);\nvoid intel_uncore_forcewake_put(struct intel_uncore *uncore,\n\t\t\t\tenum forcewake_domains domains);\nvoid intel_uncore_forcewake_put_delayed(struct intel_uncore *uncore,\n\t\t\t\t\tenum forcewake_domains domains);\nvoid intel_uncore_forcewake_flush(struct intel_uncore *uncore,\n\t\t\t\t  enum forcewake_domains fw_domains);\n\n \nvoid intel_uncore_forcewake_get__locked(struct intel_uncore *uncore,\n\t\t\t\t\tenum forcewake_domains domains);\nvoid intel_uncore_forcewake_put__locked(struct intel_uncore *uncore,\n\t\t\t\t\tenum forcewake_domains domains);\n\nvoid intel_uncore_forcewake_user_get(struct intel_uncore *uncore);\nvoid intel_uncore_forcewake_user_put(struct intel_uncore *uncore);\n\nint __intel_wait_for_register(struct intel_uncore *uncore,\n\t\t\t      i915_reg_t reg,\n\t\t\t      u32 mask,\n\t\t\t      u32 value,\n\t\t\t      unsigned int fast_timeout_us,\n\t\t\t      unsigned int slow_timeout_ms,\n\t\t\t      u32 *out_value);\nstatic inline int\nintel_wait_for_register(struct intel_uncore *uncore,\n\t\t\ti915_reg_t reg,\n\t\t\tu32 mask,\n\t\t\tu32 value,\n\t\t\tunsigned int timeout_ms)\n{\n\treturn __intel_wait_for_register(uncore, reg, mask, value, 2,\n\t\t\t\t\t timeout_ms, NULL);\n}\n\nint __intel_wait_for_register_fw(struct intel_uncore *uncore,\n\t\t\t\t i915_reg_t reg,\n\t\t\t\t u32 mask,\n\t\t\t\t u32 value,\n\t\t\t\t unsigned int fast_timeout_us,\n\t\t\t\t unsigned int slow_timeout_ms,\n\t\t\t\t u32 *out_value);\nstatic inline int\nintel_wait_for_register_fw(struct intel_uncore *uncore,\n\t\t\t   i915_reg_t reg,\n\t\t\t   u32 mask,\n\t\t\t   u32 value,\n\t\t\t       unsigned int timeout_ms)\n{\n\treturn __intel_wait_for_register_fw(uncore, reg, mask, value,\n\t\t\t\t\t    2, timeout_ms, NULL);\n}\n\n#define IS_GSI_REG(reg) ((reg) < 0x40000)\n\n \n#define __raw_read(x__, s__) \\\nstatic inline u##x__ __raw_uncore_read##x__(const struct intel_uncore *uncore, \\\n\t\t\t\t\t    i915_reg_t reg) \\\n{ \\\n\tu32 offset = i915_mmio_reg_offset(reg); \\\n\tif (IS_GSI_REG(offset)) \\\n\t\toffset += uncore->gsi_offset; \\\n\treturn read##s__(uncore->regs + offset); \\\n}\n\n#define __raw_write(x__, s__) \\\nstatic inline void __raw_uncore_write##x__(const struct intel_uncore *uncore, \\\n\t\t\t\t\t   i915_reg_t reg, u##x__ val) \\\n{ \\\n\tu32 offset = i915_mmio_reg_offset(reg); \\\n\tif (IS_GSI_REG(offset)) \\\n\t\toffset += uncore->gsi_offset; \\\n\twrite##s__(val, uncore->regs + offset); \\\n}\n__raw_read(8, b)\n__raw_read(16, w)\n__raw_read(32, l)\n__raw_read(64, q)\n\n__raw_write(8, b)\n__raw_write(16, w)\n__raw_write(32, l)\n__raw_write(64, q)\n\n#undef __raw_read\n#undef __raw_write\n\n#define __uncore_read(name__, x__, s__, trace__) \\\nstatic inline u##x__ intel_uncore_##name__(struct intel_uncore *uncore, \\\n\t\t\t\t\t   i915_reg_t reg) \\\n{ \\\n\treturn uncore->funcs.mmio_read##s__(uncore, reg, (trace__)); \\\n}\n\n#define __uncore_write(name__, x__, s__, trace__) \\\nstatic inline void intel_uncore_##name__(struct intel_uncore *uncore, \\\n\t\t\t\t\t i915_reg_t reg, u##x__ val) \\\n{ \\\n\tuncore->funcs.mmio_write##s__(uncore, reg, val, (trace__)); \\\n}\n\n__uncore_read(read8, 8, b, true)\n__uncore_read(read16, 16, w, true)\n__uncore_read(read, 32, l, true)\n__uncore_read(read16_notrace, 16, w, false)\n__uncore_read(read_notrace, 32, l, false)\n\n__uncore_write(write8, 8, b, true)\n__uncore_write(write16, 16, w, true)\n__uncore_write(write, 32, l, true)\n__uncore_write(write_notrace, 32, l, false)\n\n \n__uncore_read(read64, 64, q, true)\n\n#define intel_uncore_posting_read(...) ((void)intel_uncore_read_notrace(__VA_ARGS__))\n#define intel_uncore_posting_read16(...) ((void)intel_uncore_read16_notrace(__VA_ARGS__))\n\n#undef __uncore_read\n#undef __uncore_write\n\n \n#define intel_uncore_read_fw(...) __raw_uncore_read32(__VA_ARGS__)\n#define intel_uncore_write_fw(...) __raw_uncore_write32(__VA_ARGS__)\n#define intel_uncore_write64_fw(...) __raw_uncore_write64(__VA_ARGS__)\n#define intel_uncore_posting_read_fw(...) ((void)intel_uncore_read_fw(__VA_ARGS__))\n\nstatic inline u32 intel_uncore_rmw(struct intel_uncore *uncore,\n\t\t\t\t   i915_reg_t reg, u32 clear, u32 set)\n{\n\tu32 old, val;\n\n\told = intel_uncore_read(uncore, reg);\n\tval = (old & ~clear) | set;\n\tintel_uncore_write(uncore, reg, val);\n\treturn old;\n}\n\nstatic inline void intel_uncore_rmw_fw(struct intel_uncore *uncore,\n\t\t\t\t       i915_reg_t reg, u32 clear, u32 set)\n{\n\tu32 old, val;\n\n\told = intel_uncore_read_fw(uncore, reg);\n\tval = (old & ~clear) | set;\n\tif (val != old)\n\t\tintel_uncore_write_fw(uncore, reg, val);\n}\n\nstatic inline u64\nintel_uncore_read64_2x32(struct intel_uncore *uncore,\n\t\t\t i915_reg_t lower_reg, i915_reg_t upper_reg)\n{\n\tu32 upper, lower, old_upper, loop = 0;\n\tenum forcewake_domains fw_domains;\n\tunsigned long flags;\n\n\tfw_domains = intel_uncore_forcewake_for_reg(uncore, lower_reg,\n\t\t\t\t\t\t    FW_REG_READ);\n\n\tfw_domains |= intel_uncore_forcewake_for_reg(uncore, upper_reg,\n\t\t\t\t\t\t    FW_REG_READ);\n\n\tspin_lock_irqsave(&uncore->lock, flags);\n\tintel_uncore_forcewake_get__locked(uncore, fw_domains);\n\n\tupper = intel_uncore_read_fw(uncore, upper_reg);\n\tdo {\n\t\told_upper = upper;\n\t\tlower = intel_uncore_read_fw(uncore, lower_reg);\n\t\tupper = intel_uncore_read_fw(uncore, upper_reg);\n\t} while (upper != old_upper && loop++ < 2);\n\n\tintel_uncore_forcewake_put__locked(uncore, fw_domains);\n\tspin_unlock_irqrestore(&uncore->lock, flags);\n\n\treturn (u64)upper << 32 | lower;\n}\n\nstatic inline int intel_uncore_write_and_verify(struct intel_uncore *uncore,\n\t\t\t\t\t\ti915_reg_t reg, u32 val,\n\t\t\t\t\t\tu32 mask, u32 expected_val)\n{\n\tu32 reg_val;\n\n\tintel_uncore_write(uncore, reg, val);\n\treg_val = intel_uncore_read(uncore, reg);\n\n\treturn (reg_val & mask) != expected_val ? -EINVAL : 0;\n}\n\nstatic inline void __iomem *intel_uncore_regs(struct intel_uncore *uncore)\n{\n\treturn uncore->regs;\n}\n\n \n#define raw_reg_read(base, reg) \\\n\treadl(base + i915_mmio_reg_offset(reg))\n#define raw_reg_write(base, reg, value) \\\n\twritel(value, base + i915_mmio_reg_offset(reg))\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}