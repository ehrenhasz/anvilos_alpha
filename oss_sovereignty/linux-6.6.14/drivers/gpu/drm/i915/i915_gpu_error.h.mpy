{
  "module_name": "i915_gpu_error.h",
  "hash_id": "c705d6cfca76327663dc1d62a99b42ef31a1e5b6340019a9013db798dc74db9f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_gpu_error.h",
  "human_readable_source": " \n\n#ifndef _I915_GPU_ERROR_H_\n#define _I915_GPU_ERROR_H_\n\n#include <linux/atomic.h>\n#include <linux/kref.h>\n#include <linux/ktime.h>\n#include <linux/sched.h>\n\n#include <drm/drm_mm.h>\n\n#include \"display/intel_display_device.h\"\n#include \"gt/intel_engine.h\"\n#include \"gt/intel_engine_types.h\"\n#include \"gt/intel_gt_types.h\"\n#include \"gt/uc/intel_uc_fw.h\"\n\n#include \"intel_device_info.h\"\n\n#include \"i915_gem.h\"\n#include \"i915_gem_gtt.h\"\n#include \"i915_params.h\"\n#include \"i915_scheduler.h\"\n\nstruct drm_i915_private;\nstruct i915_vma_compress;\nstruct intel_engine_capture_vma;\nstruct intel_overlay_error_state;\n\nstruct i915_vma_coredump {\n\tstruct i915_vma_coredump *next;\n\n\tchar name[20];\n\n\tu64 gtt_offset;\n\tu64 gtt_size;\n\tu32 gtt_page_sizes;\n\n\tint unused;\n\tstruct list_head page_list;\n};\n\nstruct i915_request_coredump {\n\tunsigned long flags;\n\tpid_t pid;\n\tu32 context;\n\tu32 seqno;\n\tu32 head;\n\tu32 tail;\n\tstruct i915_sched_attr sched_attr;\n};\n\nstruct __guc_capture_parsed_output;\n\nstruct intel_engine_coredump {\n\tconst struct intel_engine_cs *engine;\n\n\tbool hung;\n\tbool simulated;\n\tu32 reset_count;\n\n\t \n\tu32 rq_head, rq_post, rq_tail;\n\n\t \n\tu32 ccid;\n\tu32 start;\n\tu32 tail;\n\tu32 head;\n\tu32 ctl;\n\tu32 mode;\n\tu32 hws;\n\tu32 ipeir;\n\tu32 ipehr;\n\tu32 esr;\n\tu32 bbstate;\n\tu32 instpm;\n\tu32 instps;\n\tu64 bbaddr;\n\tu64 acthd;\n\tu32 fault_reg;\n\tu64 faddr;\n\tu32 rc_psmi;  \n\tu32 nopid;\n\tu32 excc;\n\tu32 cmd_cctl;\n\tu32 cscmdop;\n\tu32 ctx_sr_ctl;\n\tu32 dma_faddr_hi;\n\tu32 dma_faddr_lo;\n\tstruct intel_instdone instdone;\n\n\t \n\tstruct intel_guc_state_capture *guc_capture;\n\tstruct __guc_capture_parsed_output *guc_capture_node;\n\n\tstruct i915_gem_context_coredump {\n\t\tchar comm[TASK_COMM_LEN];\n\n\t\tu64 total_runtime;\n\t\tu64 avg_runtime;\n\n\t\tpid_t pid;\n\t\tint active;\n\t\tint guilty;\n\t\tstruct i915_sched_attr sched_attr;\n\t\tu32 hwsp_seqno;\n\t} context;\n\n\tstruct i915_vma_coredump *vma;\n\n\tstruct i915_request_coredump execlist[EXECLIST_MAX_PORTS];\n\tunsigned int num_ports;\n\n\tstruct {\n\t\tu32 gfx_mode;\n\t\tunion {\n\t\t\tu64 pdp[4];\n\t\t\tu32 pp_dir_base;\n\t\t};\n\t} vm_info;\n\n\tstruct intel_engine_coredump *next;\n};\n\nstruct intel_ctb_coredump {\n\tu32 raw_head, head;\n\tu32 raw_tail, tail;\n\tu32 raw_status;\n\tu32 desc_offset;\n\tu32 cmds_offset;\n\tu32 size;\n};\n\nstruct intel_gt_coredump {\n\tconst struct intel_gt *_gt;\n\tbool awake;\n\tbool simulated;\n\n\tstruct intel_gt_info info;\n\n\t \n\tu32 eir;\n\tu32 pgtbl_er;\n\tu32 ier;\n\tu32 gtier[6], ngtier;\n\tu32 forcewake;\n\tu32 error;  \n\tu32 err_int;  \n\tu32 fault_data0;  \n\tu32 fault_data1;  \n\tu32 done_reg;\n\tu32 gac_eco;\n\tu32 gam_ecochk;\n\tu32 gab_ctl;\n\tu32 gfx_mode;\n\tu32 gtt_cache;\n\tu32 aux_err;  \n\tu32 gam_done;  \n\tu32 clock_frequency;\n\tu32 clock_period_ns;\n\n\t \n\tu32 derrmr;\n\tu32 sfc_done[I915_MAX_SFC];  \n\n\tu32 nfence;\n\tu64 fence[I915_MAX_NUM_FENCES];\n\n\tstruct intel_engine_coredump *engine;\n\n\tstruct intel_uc_coredump {\n\t\tstruct intel_uc_fw guc_fw;\n\t\tstruct intel_uc_fw huc_fw;\n\t\tstruct guc_info {\n\t\t\tstruct intel_ctb_coredump ctb[2];\n\t\t\tstruct i915_vma_coredump *vma_ctb;\n\t\t\tstruct i915_vma_coredump *vma_log;\n\t\t\tu32 timestamp;\n\t\t\tu16 last_fence;\n\t\t\tbool is_guc_capture;\n\t\t} guc;\n\t} *uc;\n\n\tstruct intel_gt_coredump *next;\n};\n\nstruct i915_gpu_coredump {\n\tstruct kref ref;\n\tktime_t time;\n\tktime_t boottime;\n\tktime_t uptime;\n\tunsigned long capture;\n\n\tstruct drm_i915_private *i915;\n\n\tstruct intel_gt_coredump *gt;\n\n\tchar error_msg[128];\n\tbool simulated;\n\tbool wakelock;\n\tbool suspended;\n\tint iommu;\n\tu32 reset_count;\n\tu32 suspend_count;\n\n\tstruct intel_device_info device_info;\n\tstruct intel_runtime_info runtime_info;\n\tstruct intel_display_device_info display_device_info;\n\tstruct intel_display_runtime_info display_runtime_info;\n\tstruct intel_driver_caps driver_caps;\n\tstruct i915_params params;\n\n\tstruct intel_overlay_error_state *overlay;\n\n\tstruct scatterlist *sgl, *fit;\n};\n\nstruct i915_gpu_error {\n\t \n\tspinlock_t lock;\n\t \n\tstruct i915_gpu_coredump *first_error;\n\n\tatomic_t pending_fb_pin;\n\n\t \n\tatomic_t reset_count;\n\n\t \n\tatomic_t reset_engine_count[MAX_ENGINE_CLASS];\n};\n\nstruct drm_i915_error_state_buf {\n\tstruct drm_i915_private *i915;\n\tstruct scatterlist *sgl, *cur, *end;\n\n\tchar *buf;\n\tsize_t bytes;\n\tsize_t size;\n\tloff_t iter;\n\n\tint err;\n};\n\nstatic inline u32 i915_reset_count(struct i915_gpu_error *error)\n{\n\treturn atomic_read(&error->reset_count);\n}\n\nstatic inline u32 i915_reset_engine_count(struct i915_gpu_error *error,\n\t\t\t\t\t  const struct intel_engine_cs *engine)\n{\n\treturn atomic_read(&error->reset_engine_count[engine->class]);\n}\n\nstatic inline void\ni915_increase_reset_engine_count(struct i915_gpu_error *error,\n\t\t\t\t const struct intel_engine_cs *engine)\n{\n\tatomic_inc(&error->reset_engine_count[engine->class]);\n}\n\n#define CORE_DUMP_FLAG_NONE           0x0\n#define CORE_DUMP_FLAG_IS_GUC_CAPTURE BIT(0)\n\n#if IS_ENABLED(CONFIG_DRM_I915_CAPTURE_ERROR) && IS_ENABLED(CONFIG_DRM_I915_DEBUG_GEM)\nvoid intel_klog_error_capture(struct intel_gt *gt,\n\t\t\t      intel_engine_mask_t engine_mask);\n#else\nstatic inline void intel_klog_error_capture(struct intel_gt *gt,\n\t\t\t\t\t    intel_engine_mask_t engine_mask)\n{\n}\n#endif\n\n#if IS_ENABLED(CONFIG_DRM_I915_CAPTURE_ERROR)\n\n__printf(2, 3)\nvoid i915_error_printf(struct drm_i915_error_state_buf *e, const char *f, ...);\nvoid intel_gpu_error_print_vma(struct drm_i915_error_state_buf *m,\n\t\t\t       const struct intel_engine_cs *engine,\n\t\t\t       const struct i915_vma_coredump *vma);\nstruct i915_vma_coredump *\nintel_gpu_error_find_batch(const struct intel_engine_coredump *ee);\n\nstruct i915_gpu_coredump *i915_gpu_coredump(struct intel_gt *gt,\n\t\t\t\t\t    intel_engine_mask_t engine_mask, u32 dump_flags);\nvoid i915_capture_error_state(struct intel_gt *gt,\n\t\t\t      intel_engine_mask_t engine_mask, u32 dump_flags);\n\nstruct i915_gpu_coredump *\ni915_gpu_coredump_alloc(struct drm_i915_private *i915, gfp_t gfp);\n\nstruct intel_gt_coredump *\nintel_gt_coredump_alloc(struct intel_gt *gt, gfp_t gfp, u32 dump_flags);\n\nstruct intel_engine_coredump *\nintel_engine_coredump_alloc(struct intel_engine_cs *engine, gfp_t gfp, u32 dump_flags);\n\nstruct intel_engine_capture_vma *\nintel_engine_coredump_add_request(struct intel_engine_coredump *ee,\n\t\t\t\t  struct i915_request *rq,\n\t\t\t\t  gfp_t gfp);\n\nvoid intel_engine_coredump_add_vma(struct intel_engine_coredump *ee,\n\t\t\t\t   struct intel_engine_capture_vma *capture,\n\t\t\t\t   struct i915_vma_compress *compress);\n\nstruct i915_vma_compress *\ni915_vma_capture_prepare(struct intel_gt_coredump *gt);\n\nvoid i915_vma_capture_finish(struct intel_gt_coredump *gt,\n\t\t\t     struct i915_vma_compress *compress);\n\nvoid i915_error_state_store(struct i915_gpu_coredump *error);\n\nstatic inline struct i915_gpu_coredump *\ni915_gpu_coredump_get(struct i915_gpu_coredump *gpu)\n{\n\tkref_get(&gpu->ref);\n\treturn gpu;\n}\n\nssize_t\ni915_gpu_coredump_copy_to_buffer(struct i915_gpu_coredump *error,\n\t\t\t\t char *buf, loff_t offset, size_t count);\n\nvoid __i915_gpu_coredump_free(struct kref *kref);\nstatic inline void i915_gpu_coredump_put(struct i915_gpu_coredump *gpu)\n{\n\tif (gpu)\n\t\tkref_put(&gpu->ref, __i915_gpu_coredump_free);\n}\n\nstruct i915_gpu_coredump *i915_first_error_state(struct drm_i915_private *i915);\nvoid i915_reset_error_state(struct drm_i915_private *i915);\nvoid i915_disable_error_state(struct drm_i915_private *i915, int err);\n\n#else\n\n__printf(2, 3)\nstatic inline void\ni915_error_printf(struct drm_i915_error_state_buf *e, const char *f, ...)\n{\n}\n\nstatic inline void\ni915_capture_error_state(struct intel_gt *gt, intel_engine_mask_t engine_mask, u32 dump_flags)\n{\n}\n\nstatic inline struct i915_gpu_coredump *\ni915_gpu_coredump_alloc(struct drm_i915_private *i915, gfp_t gfp)\n{\n\treturn NULL;\n}\n\nstatic inline struct intel_gt_coredump *\nintel_gt_coredump_alloc(struct intel_gt *gt, gfp_t gfp, u32 dump_flags)\n{\n\treturn NULL;\n}\n\nstatic inline struct intel_engine_coredump *\nintel_engine_coredump_alloc(struct intel_engine_cs *engine, gfp_t gfp, u32 dump_flags)\n{\n\treturn NULL;\n}\n\nstatic inline struct intel_engine_capture_vma *\nintel_engine_coredump_add_request(struct intel_engine_coredump *ee,\n\t\t\t\t  struct i915_request *rq,\n\t\t\t\t  gfp_t gfp)\n{\n\treturn NULL;\n}\n\nstatic inline void\nintel_engine_coredump_add_vma(struct intel_engine_coredump *ee,\n\t\t\t      struct intel_engine_capture_vma *capture,\n\t\t\t      struct i915_vma_compress *compress)\n{\n}\n\nstatic inline struct i915_vma_compress *\ni915_vma_capture_prepare(struct intel_gt_coredump *gt)\n{\n\treturn NULL;\n}\n\nstatic inline void\ni915_vma_capture_finish(struct intel_gt_coredump *gt,\n\t\t\tstruct i915_vma_compress *compress)\n{\n}\n\nstatic inline void\ni915_error_state_store(struct i915_gpu_coredump *error)\n{\n}\n\nstatic inline void i915_gpu_coredump_put(struct i915_gpu_coredump *gpu)\n{\n}\n\nstatic inline struct i915_gpu_coredump *\ni915_first_error_state(struct drm_i915_private *i915)\n{\n\treturn ERR_PTR(-ENODEV);\n}\n\nstatic inline void i915_reset_error_state(struct drm_i915_private *i915)\n{\n}\n\nstatic inline void i915_disable_error_state(struct drm_i915_private *i915,\n\t\t\t\t\t    int err)\n{\n}\n\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}