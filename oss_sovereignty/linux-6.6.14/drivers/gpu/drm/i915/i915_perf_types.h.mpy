{
  "module_name": "i915_perf_types.h",
  "hash_id": "3f038f8c053a696d46c30b6edbcb207cb3e47fff865a335be5b7bb53c953d9ff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_perf_types.h",
  "human_readable_source": " \n \n\n#ifndef _I915_PERF_TYPES_H_\n#define _I915_PERF_TYPES_H_\n\n#include <linux/atomic.h>\n#include <linux/device.h>\n#include <linux/hrtimer.h>\n#include <linux/llist.h>\n#include <linux/poll.h>\n#include <linux/sysfs.h>\n#include <linux/types.h>\n#include <linux/uuid.h>\n#include <linux/wait.h>\n#include <uapi/drm/i915_drm.h>\n\n#include \"gt/intel_engine_types.h\"\n#include \"gt/intel_sseu.h\"\n#include \"i915_reg_defs.h\"\n#include \"intel_uncore.h\"\n#include \"intel_wakeref.h\"\n\nstruct drm_i915_private;\nstruct file;\nstruct i915_active;\nstruct i915_gem_context;\nstruct i915_perf;\nstruct i915_vma;\nstruct intel_context;\nstruct intel_engine_cs;\n\nenum {\n\tPERF_GROUP_OAG = 0,\n\tPERF_GROUP_OAM_SAMEDIA_0 = 0,\n\n\tPERF_GROUP_MAX,\n\tPERF_GROUP_INVALID = U32_MAX,\n};\n\nenum report_header {\n\tHDR_32_BIT = 0,\n\tHDR_64_BIT,\n};\n\nstruct i915_perf_regs {\n\tu32 base;\n\ti915_reg_t oa_head_ptr;\n\ti915_reg_t oa_tail_ptr;\n\ti915_reg_t oa_buffer;\n\ti915_reg_t oa_ctx_ctrl;\n\ti915_reg_t oa_ctrl;\n\ti915_reg_t oa_debug;\n\ti915_reg_t oa_status;\n\tu32 oa_ctrl_counter_format_shift;\n};\n\nenum oa_type {\n\tTYPE_OAG,\n\tTYPE_OAM,\n};\n\nstruct i915_oa_format {\n\tu32 format;\n\tint size;\n\tint type;\n\tenum report_header header;\n};\n\nstruct i915_oa_reg {\n\ti915_reg_t addr;\n\tu32 value;\n};\n\nstruct i915_oa_config {\n\tstruct i915_perf *perf;\n\n\tchar uuid[UUID_STRING_LEN + 1];\n\tint id;\n\n\tconst struct i915_oa_reg *mux_regs;\n\tu32 mux_regs_len;\n\tconst struct i915_oa_reg *b_counter_regs;\n\tu32 b_counter_regs_len;\n\tconst struct i915_oa_reg *flex_regs;\n\tu32 flex_regs_len;\n\n\tstruct attribute_group sysfs_metric;\n\tstruct attribute *attrs[2];\n\tstruct kobj_attribute sysfs_metric_id;\n\n\tstruct kref ref;\n\tstruct rcu_head rcu;\n};\n\nstruct i915_perf_stream;\n\n \nstruct i915_perf_stream_ops {\n\t \n\tvoid (*enable)(struct i915_perf_stream *stream);\n\n\t \n\tvoid (*disable)(struct i915_perf_stream *stream);\n\n\t \n\tvoid (*poll_wait)(struct i915_perf_stream *stream,\n\t\t\t  struct file *file,\n\t\t\t  poll_table *wait);\n\n\t \n\tint (*wait_unlocked)(struct i915_perf_stream *stream);\n\n\t \n\tint (*read)(struct i915_perf_stream *stream,\n\t\t    char __user *buf,\n\t\t    size_t count,\n\t\t    size_t *offset);\n\n\t \n\tvoid (*destroy)(struct i915_perf_stream *stream);\n};\n\n \nstruct i915_perf_stream {\n\t \n\tstruct i915_perf *perf;\n\n\t \n\tstruct intel_uncore *uncore;\n\n\t \n\tstruct intel_engine_cs *engine;\n\n\t \n\tstruct mutex lock;\n\n\t \n\tu32 sample_flags;\n\n\t \n\tint sample_size;\n\n\t \n\tstruct i915_gem_context *ctx;\n\n\t \n\tbool enabled;\n\n\t \n\tbool hold_preemption;\n\n\t \n\tconst struct i915_perf_stream_ops *ops;\n\n\t \n\tstruct i915_oa_config *oa_config;\n\n\t \n\tstruct llist_head oa_config_bos;\n\n\t \n\tstruct intel_context *pinned_ctx;\n\n\t \n\tu32 specific_ctx_id;\n\n\t \n\tu32 specific_ctx_id_mask;\n\n\t \n\tstruct hrtimer poll_check_timer;\n\n\t \n\twait_queue_head_t poll_wq;\n\n\t \n\tbool pollin;\n\n\t \n\tbool periodic;\n\n\t \n\tint period_exponent;\n\n\t \n\tstruct {\n\t\tconst struct i915_oa_format *format;\n\t\tstruct i915_vma *vma;\n\t\tu8 *vaddr;\n\t\tu32 last_ctx_id;\n\t\tint size_exponent;\n\n\t\t \n\t\tspinlock_t ptr_lock;\n\n\t\t \n\t\tu32 head;\n\n\t\t \n\t\tu32 tail;\n\t} oa_buffer;\n\n\t \n\tstruct i915_vma *noa_wait;\n\n\t \n\tu64 poll_oa_period;\n\n\t \n\tbool override_gucrc;\n};\n\n \nstruct i915_oa_ops {\n\t \n\tbool (*is_valid_b_counter_reg)(struct i915_perf *perf, u32 addr);\n\n\t \n\tbool (*is_valid_mux_reg)(struct i915_perf *perf, u32 addr);\n\n\t \n\tbool (*is_valid_flex_reg)(struct i915_perf *perf, u32 addr);\n\n\t \n\tint (*enable_metric_set)(struct i915_perf_stream *stream,\n\t\t\t\t struct i915_active *active);\n\n\t \n\tvoid (*disable_metric_set)(struct i915_perf_stream *stream);\n\n\t \n\tvoid (*oa_enable)(struct i915_perf_stream *stream);\n\n\t \n\tvoid (*oa_disable)(struct i915_perf_stream *stream);\n\n\t \n\tint (*read)(struct i915_perf_stream *stream,\n\t\t    char __user *buf,\n\t\t    size_t count,\n\t\t    size_t *offset);\n\n\t \n\tu32 (*oa_hw_tail_read)(struct i915_perf_stream *stream);\n};\n\nstruct i915_perf_group {\n\t \n\tstruct i915_perf_stream *exclusive_stream;\n\n\t \n\tu32 num_engines;\n\n\t \n\tstruct i915_perf_regs regs;\n\n\t \n\tenum oa_type type;\n};\n\nstruct i915_perf_gt {\n\t \n\tstruct mutex lock;\n\n\t \n\tstruct intel_sseu sseu;\n\n\t \n\tu32 num_perf_groups;\n\n\t \n\tstruct i915_perf_group *group;\n};\n\nstruct i915_perf {\n\tstruct drm_i915_private *i915;\n\n\tstruct kobject *metrics_kobj;\n\n\t \n\tstruct mutex metrics_lock;\n\n\t \n\tstruct idr metrics_idr;\n\n\t \n\tstruct ratelimit_state spurious_report_rs;\n\n\t \n\tstruct ratelimit_state tail_pointer_race;\n\n\tu32 gen7_latched_oastatus1;\n\tu32 ctx_oactxctrl_offset;\n\tu32 ctx_flexeu0_offset;\n\n\t \n\tu32 gen8_valid_ctx_bit;\n\n\tstruct i915_oa_ops ops;\n\tconst struct i915_oa_format *oa_formats;\n\n\t \n#define FORMAT_MASK_SIZE DIV_ROUND_UP(I915_OA_FORMAT_MAX - 1, BITS_PER_LONG)\n\tunsigned long format_mask[FORMAT_MASK_SIZE];\n\n\tatomic64_t noa_programming_delay;\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}