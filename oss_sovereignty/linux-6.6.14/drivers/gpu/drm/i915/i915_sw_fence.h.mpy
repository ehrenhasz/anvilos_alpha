{
  "module_name": "i915_sw_fence.h",
  "hash_id": "da5f0019aeccb8cd650f3c986fcf6c9b263c7dfa372cef69557786bc343a6089",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_sw_fence.h",
  "human_readable_source": " \n\n#ifndef _I915_SW_FENCE_H_\n#define _I915_SW_FENCE_H_\n\n#include <linux/dma-fence.h>\n#include <linux/gfp.h>\n#include <linux/kref.h>\n#include <linux/notifier.h>  \n#include <linux/wait.h>\n\nstruct completion;\nstruct dma_resv;\nstruct i915_sw_fence;\n\nenum i915_sw_fence_notify {\n\tFENCE_COMPLETE,\n\tFENCE_FREE\n};\n\ntypedef int (*i915_sw_fence_notify_t)(struct i915_sw_fence *,\n\t\t\t\t      enum i915_sw_fence_notify state);\n\nstruct i915_sw_fence {\n\twait_queue_head_t wait;\n\ti915_sw_fence_notify_t fn;\n#ifdef CONFIG_DRM_I915_SW_FENCE_CHECK_DAG\n\tunsigned long flags;\n#endif\n\tatomic_t pending;\n\tint error;\n};\n\n#define I915_SW_FENCE_CHECKED_BIT\t0  \n\nvoid __i915_sw_fence_init(struct i915_sw_fence *fence,\n\t\t\t  i915_sw_fence_notify_t fn,\n\t\t\t  const char *name,\n\t\t\t  struct lock_class_key *key);\n#ifdef CONFIG_LOCKDEP\n#define i915_sw_fence_init(fence, fn)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tstatic struct lock_class_key __key;\t\t\t\\\n\t\t\t\t\t\t\t\t\\\n\tBUILD_BUG_ON((fn) == NULL);\t\t\t\t\\\n\t__i915_sw_fence_init((fence), (fn), #fence, &__key);\t\\\n} while (0)\n#else\n#define i915_sw_fence_init(fence, fn)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\\\n\tBUILD_BUG_ON((fn) == NULL);\t\t\t\t\\\n\t__i915_sw_fence_init((fence), (fn), NULL, NULL);\t\\\n} while (0)\n#endif\n\nvoid i915_sw_fence_reinit(struct i915_sw_fence *fence);\n\n#ifdef CONFIG_DRM_I915_SW_FENCE_DEBUG_OBJECTS\nvoid i915_sw_fence_fini(struct i915_sw_fence *fence);\n#else\nstatic inline void i915_sw_fence_fini(struct i915_sw_fence *fence) {}\n#endif\n\nvoid i915_sw_fence_commit(struct i915_sw_fence *fence);\n\nint i915_sw_fence_await_sw_fence(struct i915_sw_fence *fence,\n\t\t\t\t struct i915_sw_fence *after,\n\t\t\t\t wait_queue_entry_t *wq);\nint i915_sw_fence_await_sw_fence_gfp(struct i915_sw_fence *fence,\n\t\t\t\t     struct i915_sw_fence *after,\n\t\t\t\t     gfp_t gfp);\n\nstruct i915_sw_dma_fence_cb {\n\tstruct dma_fence_cb base;\n\tstruct i915_sw_fence *fence;\n};\n\nint __i915_sw_fence_await_dma_fence(struct i915_sw_fence *fence,\n\t\t\t\t    struct dma_fence *dma,\n\t\t\t\t    struct i915_sw_dma_fence_cb *cb);\nint i915_sw_fence_await_dma_fence(struct i915_sw_fence *fence,\n\t\t\t\t  struct dma_fence *dma,\n\t\t\t\t  unsigned long timeout,\n\t\t\t\t  gfp_t gfp);\n\nint i915_sw_fence_await_reservation(struct i915_sw_fence *fence,\n\t\t\t\t    struct dma_resv *resv,\n\t\t\t\t    bool write,\n\t\t\t\t    unsigned long timeout,\n\t\t\t\t    gfp_t gfp);\n\nbool i915_sw_fence_await(struct i915_sw_fence *fence);\nvoid i915_sw_fence_complete(struct i915_sw_fence *fence);\n\nstatic inline bool i915_sw_fence_signaled(const struct i915_sw_fence *fence)\n{\n\treturn atomic_read(&fence->pending) <= 0;\n}\n\nstatic inline bool i915_sw_fence_done(const struct i915_sw_fence *fence)\n{\n\treturn atomic_read(&fence->pending) < 0;\n}\n\nstatic inline void i915_sw_fence_wait(struct i915_sw_fence *fence)\n{\n\twait_event(fence->wait, i915_sw_fence_done(fence));\n}\n\nstatic inline void\ni915_sw_fence_set_error_once(struct i915_sw_fence *fence, int error)\n{\n\tif (unlikely(error))\n\t\tcmpxchg(&fence->error, 0, error);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}