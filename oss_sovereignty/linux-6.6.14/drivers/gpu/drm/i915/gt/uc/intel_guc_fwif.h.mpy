{
  "module_name": "intel_guc_fwif.h",
  "hash_id": "9ab7e14bab20ebb8c19f80b0bee887e0d24bad4cb01cb470313ce091146ab177",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gt/uc/intel_guc_fwif.h",
  "human_readable_source": " \n \n\n#ifndef _INTEL_GUC_FWIF_H\n#define _INTEL_GUC_FWIF_H\n\n#include <linux/bits.h>\n#include <linux/compiler.h>\n#include <linux/types.h>\n#include \"gt/intel_engine_types.h\"\n\n#include \"abi/guc_actions_abi.h\"\n#include \"abi/guc_actions_slpc_abi.h\"\n#include \"abi/guc_errors_abi.h\"\n#include \"abi/guc_communication_mmio_abi.h\"\n#include \"abi/guc_communication_ctb_abi.h\"\n#include \"abi/guc_klvs_abi.h\"\n#include \"abi/guc_messages_abi.h\"\n\n \n#define G2H_LEN_DW_SCHED_CONTEXT_MODE_SET\t2\n#define G2H_LEN_DW_DEREGISTER_CONTEXT\t\t1\n\n#define GUC_CONTEXT_DISABLE\t\t0\n#define GUC_CONTEXT_ENABLE\t\t1\n\n#define GUC_CLIENT_PRIORITY_KMD_HIGH\t0\n#define GUC_CLIENT_PRIORITY_HIGH\t1\n#define GUC_CLIENT_PRIORITY_KMD_NORMAL\t2\n#define GUC_CLIENT_PRIORITY_NORMAL\t3\n#define GUC_CLIENT_PRIORITY_NUM\t\t4\n\n#define GUC_MAX_CONTEXT_ID\t\t65535\n#define\tGUC_INVALID_CONTEXT_ID\t\tGUC_MAX_CONTEXT_ID\n\n#define GUC_RENDER_CLASS\t\t0\n#define GUC_VIDEO_CLASS\t\t\t1\n#define GUC_VIDEOENHANCE_CLASS\t\t2\n#define GUC_BLITTER_CLASS\t\t3\n#define GUC_COMPUTE_CLASS\t\t4\n#define GUC_GSC_OTHER_CLASS\t\t5\n#define GUC_LAST_ENGINE_CLASS\t\tGUC_GSC_OTHER_CLASS\n#define GUC_MAX_ENGINE_CLASSES\t\t16\n#define GUC_MAX_INSTANCES_PER_CLASS\t32\n\n#define GUC_DOORBELL_INVALID\t\t256\n\n \n#define WQ_STATUS_ACTIVE\t\t1\n#define WQ_STATUS_SUSPENDED\t\t2\n#define WQ_STATUS_CMD_ERROR\t\t3\n#define WQ_STATUS_ENGINE_ID_NOT_USED\t4\n#define WQ_STATUS_SUSPENDED_FROM_RESET\t5\n#define WQ_TYPE_BATCH_BUF\t\t0x1\n#define WQ_TYPE_PSEUDO\t\t\t0x2\n#define WQ_TYPE_INORDER\t\t\t0x3\n#define WQ_TYPE_NOOP\t\t\t0x4\n#define WQ_TYPE_MULTI_LRC\t\t0x5\n#define WQ_TYPE_MASK\t\t\tGENMASK(7, 0)\n#define WQ_LEN_MASK\t\t\tGENMASK(26, 16)\n\n#define WQ_GUC_ID_MASK\t\t\tGENMASK(15, 0)\n#define WQ_RING_TAIL_MASK\t\tGENMASK(28, 18)\n\n#define GUC_STAGE_DESC_ATTR_ACTIVE\tBIT(0)\n#define GUC_STAGE_DESC_ATTR_PENDING_DB\tBIT(1)\n#define GUC_STAGE_DESC_ATTR_KERNEL\tBIT(2)\n#define GUC_STAGE_DESC_ATTR_PREEMPT\tBIT(3)\n#define GUC_STAGE_DESC_ATTR_RESET\tBIT(4)\n#define GUC_STAGE_DESC_ATTR_WQLOCKED\tBIT(5)\n#define GUC_STAGE_DESC_ATTR_PCH\t\tBIT(6)\n#define GUC_STAGE_DESC_ATTR_TERMINATED\tBIT(7)\n\n#define GUC_CTL_LOG_PARAMS\t\t0\n#define   GUC_LOG_VALID\t\t\tBIT(0)\n#define   GUC_LOG_NOTIFY_ON_HALF_FULL\tBIT(1)\n#define   GUC_LOG_CAPTURE_ALLOC_UNITS\tBIT(2)\n#define   GUC_LOG_LOG_ALLOC_UNITS\tBIT(3)\n#define   GUC_LOG_CRASH_SHIFT\t\t4\n#define   GUC_LOG_CRASH_MASK\t\t(0x3 << GUC_LOG_CRASH_SHIFT)\n#define   GUC_LOG_DEBUG_SHIFT\t\t6\n#define   GUC_LOG_DEBUG_MASK\t        (0xF << GUC_LOG_DEBUG_SHIFT)\n#define   GUC_LOG_CAPTURE_SHIFT\t\t10\n#define   GUC_LOG_CAPTURE_MASK\t        (0x3 << GUC_LOG_CAPTURE_SHIFT)\n#define   GUC_LOG_BUF_ADDR_SHIFT\t12\n\n#define GUC_CTL_WA\t\t\t1\n#define   GUC_WA_GAM_CREDITS\t\tBIT(10)\n#define   GUC_WA_DUAL_QUEUE\t\tBIT(11)\n#define   GUC_WA_RCS_RESET_BEFORE_RC6\tBIT(13)\n#define   GUC_WA_CONTEXT_ISOLATION\tBIT(15)\n#define   GUC_WA_PRE_PARSER\t\tBIT(14)\n#define   GUC_WA_HOLD_CCS_SWITCHOUT\tBIT(17)\n#define   GUC_WA_POLLCS\t\t\tBIT(18)\n#define   GUC_WA_RCS_REGS_IN_CCS_REGS_LIST\tBIT(21)\n\n#define GUC_CTL_FEATURE\t\t\t2\n#define   GUC_CTL_ENABLE_SLPC\t\tBIT(2)\n#define   GUC_CTL_DISABLE_SCHEDULER\tBIT(14)\n\n#define GUC_CTL_DEBUG\t\t\t3\n#define   GUC_LOG_VERBOSITY_SHIFT\t0\n#define   GUC_LOG_VERBOSITY_LOW\t\t(0 << GUC_LOG_VERBOSITY_SHIFT)\n#define   GUC_LOG_VERBOSITY_MED\t\t(1 << GUC_LOG_VERBOSITY_SHIFT)\n#define   GUC_LOG_VERBOSITY_HIGH\t(2 << GUC_LOG_VERBOSITY_SHIFT)\n#define   GUC_LOG_VERBOSITY_ULTRA\t(3 << GUC_LOG_VERBOSITY_SHIFT)\n \n#define\t  GUC_LOG_VERBOSITY_MIN\t\t0\n#define\t  GUC_LOG_VERBOSITY_MAX\t\t3\n#define\t  GUC_LOG_VERBOSITY_MASK\t0x0000000f\n#define\t  GUC_LOG_DESTINATION_MASK\t(3 << 4)\n#define   GUC_LOG_DISABLED\t\t(1 << 6)\n#define   GUC_PROFILE_ENABLED\t\t(1 << 7)\n\n#define GUC_CTL_ADS\t\t\t4\n#define   GUC_ADS_ADDR_SHIFT\t\t1\n#define   GUC_ADS_ADDR_MASK\t\t(0xFFFFF << GUC_ADS_ADDR_SHIFT)\n\n#define GUC_CTL_DEVID\t\t\t5\n\n#define GUC_CTL_MAX_DWORDS\t\t(SOFT_SCRATCH_COUNT - 2)  \n\n \n#define GUC_GENERIC_GT_SYSINFO_SLICE_ENABLED\t\t0\n#define GUC_GENERIC_GT_SYSINFO_VDBOX_SFC_SUPPORT_MASK\t1\n#define GUC_GENERIC_GT_SYSINFO_DOORBELL_COUNT_PER_SQIDI\t2\n#define GUC_GENERIC_GT_SYSINFO_MAX\t\t\t16\n\n \n#define GUC_ENGINE_CLASS_SHIFT\t\t0\n#define GUC_ENGINE_CLASS_MASK\t\t(0x7 << GUC_ENGINE_CLASS_SHIFT)\n#define GUC_ENGINE_INSTANCE_SHIFT\t3\n#define GUC_ENGINE_INSTANCE_MASK\t(0xf << GUC_ENGINE_INSTANCE_SHIFT)\n#define GUC_ENGINE_ALL_INSTANCES\tBIT(7)\n\n#define MAKE_GUC_ID(class, instance) \\\n\t(((class) << GUC_ENGINE_CLASS_SHIFT) | \\\n\t ((instance) << GUC_ENGINE_INSTANCE_SHIFT))\n\n#define GUC_ID_TO_ENGINE_CLASS(guc_id) \\\n\t(((guc_id) & GUC_ENGINE_CLASS_MASK) >> GUC_ENGINE_CLASS_SHIFT)\n#define GUC_ID_TO_ENGINE_INSTANCE(guc_id) \\\n\t(((guc_id) & GUC_ENGINE_INSTANCE_MASK) >> GUC_ENGINE_INSTANCE_SHIFT)\n\n#define SLPC_EVENT(id, c) (\\\nFIELD_PREP(HOST2GUC_PC_SLPC_REQUEST_MSG_1_EVENT_ID, id) | \\\nFIELD_PREP(HOST2GUC_PC_SLPC_REQUEST_MSG_1_EVENT_ARGC, c) \\\n)\n\n \nstatic u8 engine_class_guc_class_map[] = {\n\t[RENDER_CLASS]            = GUC_RENDER_CLASS,\n\t[COPY_ENGINE_CLASS]       = GUC_BLITTER_CLASS,\n\t[VIDEO_DECODE_CLASS]      = GUC_VIDEO_CLASS,\n\t[VIDEO_ENHANCEMENT_CLASS] = GUC_VIDEOENHANCE_CLASS,\n\t[OTHER_CLASS]             = GUC_GSC_OTHER_CLASS,\n\t[COMPUTE_CLASS]           = GUC_COMPUTE_CLASS,\n};\n\nstatic u8 guc_class_engine_class_map[] = {\n\t[GUC_RENDER_CLASS]       = RENDER_CLASS,\n\t[GUC_BLITTER_CLASS]      = COPY_ENGINE_CLASS,\n\t[GUC_VIDEO_CLASS]        = VIDEO_DECODE_CLASS,\n\t[GUC_VIDEOENHANCE_CLASS] = VIDEO_ENHANCEMENT_CLASS,\n\t[GUC_COMPUTE_CLASS]      = COMPUTE_CLASS,\n\t[GUC_GSC_OTHER_CLASS]    = OTHER_CLASS,\n};\n\nstatic inline u8 engine_class_to_guc_class(u8 class)\n{\n\tBUILD_BUG_ON(ARRAY_SIZE(engine_class_guc_class_map) != MAX_ENGINE_CLASS + 1);\n\tGEM_BUG_ON(class > MAX_ENGINE_CLASS);\n\n\treturn engine_class_guc_class_map[class];\n}\n\nstatic inline u8 guc_class_to_engine_class(u8 guc_class)\n{\n\tBUILD_BUG_ON(ARRAY_SIZE(guc_class_engine_class_map) != GUC_LAST_ENGINE_CLASS + 1);\n\tGEM_BUG_ON(guc_class > GUC_LAST_ENGINE_CLASS);\n\n\treturn guc_class_engine_class_map[guc_class];\n}\n\n \nstruct guc_wq_item {\n\tu32 header;\n\tu32 context_desc;\n\tu32 submit_element_info;\n\tu32 fence_id;\n} __packed;\n\nstruct guc_process_desc_v69 {\n\tu32 stage_id;\n\tu64 db_base_addr;\n\tu32 head;\n\tu32 tail;\n\tu32 error_offset;\n\tu64 wq_base_addr;\n\tu32 wq_size_bytes;\n\tu32 wq_status;\n\tu32 engine_presence;\n\tu32 priority;\n\tu32 reserved[36];\n} __packed;\n\nstruct guc_sched_wq_desc {\n\tu32 head;\n\tu32 tail;\n\tu32 error_offset;\n\tu32 wq_status;\n\tu32 reserved[28];\n} __packed;\n\n \nstruct guc_ctxt_registration_info {\n\tu32 flags;\n\tu32 context_idx;\n\tu32 engine_class;\n\tu32 engine_submit_mask;\n\tu32 wq_desc_lo;\n\tu32 wq_desc_hi;\n\tu32 wq_base_lo;\n\tu32 wq_base_hi;\n\tu32 wq_size;\n\tu32 hwlrca_lo;\n\tu32 hwlrca_hi;\n};\n#define CONTEXT_REGISTRATION_FLAG_KMD\tBIT(0)\n\n \n#define CONTEXT_POLICY_FLAG_PREEMPT_TO_IDLE_V69\tBIT(0)\n\n \nstruct guc_lrc_desc_v69 {\n\tu32 hw_context_desc;\n\tu32 slpm_perf_mode_hint;\t \n\tu32 slpm_freq_hint;\n\tu32 engine_submit_mask;\t\t \n\tu8 engine_class;\n\tu8 reserved0[3];\n\tu32 priority;\n\tu32 process_desc;\n\tu32 wq_addr;\n\tu32 wq_size;\n\tu32 context_flags;\t\t \n\t \n\tu32 execution_quantum;\n\t \n\tu32 preemption_timeout;\n\tu32 policy_flags;\t\t \n\tu32 reserved1[19];\n} __packed;\n\n \nstruct guc_klv_generic_dw_t {\n\tu32 kl;\n\tu32 value;\n} __packed;\n\n \nstruct guc_update_context_policy_header {\n\tu32 action;\n\tu32 ctx_id;\n} __packed;\n\nstruct guc_update_context_policy {\n\tstruct guc_update_context_policy_header header;\n\tstruct guc_klv_generic_dw_t klv[GUC_CONTEXT_POLICIES_KLV_NUM_IDS];\n} __packed;\n\n \nstruct guc_update_scheduling_policy_header {\n\tu32 action;\n} __packed;\n\n \n#define MAX_SCHEDULING_POLICY_SIZE 3\n\nstruct guc_update_scheduling_policy {\n\tstruct guc_update_scheduling_policy_header header;\n\tu32 data[MAX_SCHEDULING_POLICY_SIZE];\n} __packed;\n\n#define GUC_POWER_UNSPECIFIED\t0\n#define GUC_POWER_D0\t\t1\n#define GUC_POWER_D1\t\t2\n#define GUC_POWER_D2\t\t3\n#define GUC_POWER_D3\t\t4\n\n \n\n#define GLOBAL_SCHEDULE_POLICY_RC_YIELD_DURATION\t100\t \n#define GLOBAL_SCHEDULE_POLICY_RC_YIELD_RATIO\t\t50\t \n\n#define GLOBAL_POLICY_MAX_NUM_WI 15\n\n \n#define GLOBAL_POLICY_DISABLE_ENGINE_RESET\t\t\t\tBIT(0)\n\n#define GLOBAL_POLICY_DEFAULT_DPC_PROMOTE_TIME_US 500000\n\n \n#define GUC_POLICY_MAX_EXEC_QUANTUM_US\t\t(100 * 1000 * 1000UL)\n#define GUC_POLICY_MAX_PREEMPT_TIMEOUT_US\t(100 * 1000 * 1000UL)\n\nstatic inline u32 guc_policy_max_exec_quantum_ms(void)\n{\n\tBUILD_BUG_ON(GUC_POLICY_MAX_EXEC_QUANTUM_US >= UINT_MAX);\n\treturn GUC_POLICY_MAX_EXEC_QUANTUM_US / 1000;\n}\n\nstatic inline u32 guc_policy_max_preempt_timeout_ms(void)\n{\n\tBUILD_BUG_ON(GUC_POLICY_MAX_PREEMPT_TIMEOUT_US >= UINT_MAX);\n\treturn GUC_POLICY_MAX_PREEMPT_TIMEOUT_US / 1000;\n}\n\nstruct guc_policies {\n\tu32 submission_queue_depth[GUC_MAX_ENGINE_CLASSES];\n\t \n\tu32 dpc_promote_time;\n\n\t \n\tu32 is_valid;\n\n\t \n\tu32 max_num_work_items;\n\n\tu32 global_flags;\n\tu32 reserved[4];\n} __packed;\n\n \nstruct guc_mmio_reg {\n\tu32 offset;\n\tu32 value;\n\tu32 flags;\n#define GUC_REGSET_MASKED\t\tBIT(0)\n#define GUC_REGSET_NEEDS_STEERING\tBIT(1)\n#define GUC_REGSET_MASKED_WITH_VALUE\tBIT(2)\n#define GUC_REGSET_RESTORE_ONLY\t\tBIT(3)\n#define GUC_REGSET_STEERING_GROUP       GENMASK(15, 12)\n#define GUC_REGSET_STEERING_INSTANCE    GENMASK(23, 20)\n\tu32 mask;\n} __packed;\n\n \nstruct guc_mmio_reg_set {\n\tu32 address;\n\tu16 count;\n\tu16 reserved;\n} __packed;\n\n \nstruct guc_gt_system_info {\n\tu8 mapping_table[GUC_MAX_ENGINE_CLASSES][GUC_MAX_INSTANCES_PER_CLASS];\n\tu32 engine_enabled_masks[GUC_MAX_ENGINE_CLASSES];\n\tu32 generic_gt_sysinfo[GUC_GENERIC_GT_SYSINFO_MAX];\n} __packed;\n\nenum {\n\tGUC_CAPTURE_LIST_INDEX_PF = 0,\n\tGUC_CAPTURE_LIST_INDEX_VF = 1,\n\tGUC_CAPTURE_LIST_INDEX_MAX = 2,\n};\n\n \nenum guc_capture_type {\n\tGUC_CAPTURE_LIST_TYPE_GLOBAL = 0,\n\tGUC_CAPTURE_LIST_TYPE_ENGINE_CLASS,\n\tGUC_CAPTURE_LIST_TYPE_ENGINE_INSTANCE,\n\tGUC_CAPTURE_LIST_TYPE_MAX,\n};\n\n \nenum {\n\tGUC_CAPTURE_LIST_CLASS_RENDER_COMPUTE = 0,\n\tGUC_CAPTURE_LIST_CLASS_VIDEO = 1,\n\tGUC_CAPTURE_LIST_CLASS_VIDEOENHANCE = 2,\n\tGUC_CAPTURE_LIST_CLASS_BLITTER = 3,\n\tGUC_CAPTURE_LIST_CLASS_GSC_OTHER = 4,\n};\n\n \nstruct guc_ads {\n\tstruct guc_mmio_reg_set reg_state_list[GUC_MAX_ENGINE_CLASSES][GUC_MAX_INSTANCES_PER_CLASS];\n\tu32 reserved0;\n\tu32 scheduler_policies;\n\tu32 gt_system_info;\n\tu32 reserved1;\n\tu32 control_data;\n\tu32 golden_context_lrca[GUC_MAX_ENGINE_CLASSES];\n\tu32 eng_state_size[GUC_MAX_ENGINE_CLASSES];\n\tu32 private_data;\n\tu32 reserved2;\n\tu32 capture_instance[GUC_CAPTURE_LIST_INDEX_MAX][GUC_MAX_ENGINE_CLASSES];\n\tu32 capture_class[GUC_CAPTURE_LIST_INDEX_MAX][GUC_MAX_ENGINE_CLASSES];\n\tu32 capture_global[GUC_CAPTURE_LIST_INDEX_MAX];\n\tu32 reserved[14];\n} __packed;\n\n \nstruct guc_engine_usage_record {\n\tu32 current_context_index;\n\tu32 last_switch_in_stamp;\n\tu32 reserved0;\n\tu32 total_runtime;\n\tu32 reserved1[4];\n} __packed;\n\nstruct guc_engine_usage {\n\tstruct guc_engine_usage_record engines[GUC_MAX_ENGINE_CLASSES][GUC_MAX_INSTANCES_PER_CLASS];\n} __packed;\n\n \n\nenum guc_log_buffer_type {\n\tGUC_DEBUG_LOG_BUFFER,\n\tGUC_CRASH_DUMP_LOG_BUFFER,\n\tGUC_CAPTURE_LOG_BUFFER,\n\tGUC_MAX_LOG_BUFFER\n};\n\n \nstruct guc_log_buffer_state {\n\tu32 marker[2];\n\tu32 read_ptr;\n\tu32 write_ptr;\n\tu32 size;\n\tu32 sampled_write_ptr;\n\tu32 wrap_offset;\n\tunion {\n\t\tstruct {\n\t\t\tu32 flush_to_file:1;\n\t\t\tu32 buffer_full_cnt:4;\n\t\t\tu32 reserved:27;\n\t\t};\n\t\tu32 flags;\n\t};\n\tu32 version;\n} __packed;\n\n \nenum intel_guc_recv_message {\n\tINTEL_GUC_RECV_MSG_CRASH_DUMP_POSTED = BIT(1),\n\tINTEL_GUC_RECV_MSG_EXCEPTION = BIT(30),\n};\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}