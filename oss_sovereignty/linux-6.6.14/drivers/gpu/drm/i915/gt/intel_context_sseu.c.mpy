{
  "module_name": "intel_context_sseu.c",
  "hash_id": "8f1f4795f1e5937f3b98c2ff650b55697299280661a6e050ce4ccd7554b9dbba",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gt/intel_context_sseu.c",
  "human_readable_source": "\n \n\n#include \"i915_drv.h\"\n#include \"i915_vma.h\"\n#include \"intel_context.h\"\n#include \"intel_engine_pm.h\"\n#include \"intel_gpu_commands.h\"\n#include \"intel_lrc.h\"\n#include \"intel_lrc_reg.h\"\n#include \"intel_ring.h\"\n#include \"intel_sseu.h\"\n\nstatic int gen8_emit_rpcs_config(struct i915_request *rq,\n\t\t\t\t const struct intel_context *ce,\n\t\t\t\t const struct intel_sseu sseu)\n{\n\tu64 offset;\n\tu32 *cs;\n\n\tcs = intel_ring_begin(rq, 4);\n\tif (IS_ERR(cs))\n\t\treturn PTR_ERR(cs);\n\n\toffset = i915_ggtt_offset(ce->state) +\n\t\t LRC_STATE_OFFSET + CTX_R_PWR_CLK_STATE * 4;\n\n\t*cs++ = MI_STORE_DWORD_IMM_GEN4 | MI_USE_GGTT;\n\t*cs++ = lower_32_bits(offset);\n\t*cs++ = upper_32_bits(offset);\n\t*cs++ = intel_sseu_make_rpcs(rq->engine->gt, &sseu);\n\n\tintel_ring_advance(rq, cs);\n\n\treturn 0;\n}\n\nstatic int\ngen8_modify_rpcs(struct intel_context *ce, const struct intel_sseu sseu)\n{\n\tstruct i915_request *rq;\n\tint ret;\n\n\tlockdep_assert_held(&ce->pin_mutex);\n\n\t \n\tif (!intel_context_pin_if_active(ce))\n\t\treturn 0;\n\n\trq = intel_engine_create_kernel_request(ce->engine);\n\tif (IS_ERR(rq)) {\n\t\tret = PTR_ERR(rq);\n\t\tgoto out_unpin;\n\t}\n\n\t \n\tret = intel_context_prepare_remote_request(ce, rq);\n\tif (ret == 0)\n\t\tret = gen8_emit_rpcs_config(rq, ce, sseu);\n\n\ti915_request_add(rq);\nout_unpin:\n\tintel_context_unpin(ce);\n\treturn ret;\n}\n\nint\nintel_context_reconfigure_sseu(struct intel_context *ce,\n\t\t\t       const struct intel_sseu sseu)\n{\n\tint ret;\n\n\tGEM_BUG_ON(GRAPHICS_VER(ce->engine->i915) < 8);\n\n\tret = intel_context_lock_pinned(ce);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tif (!memcmp(&ce->sseu, &sseu, sizeof(sseu)))\n\t\tgoto unlock;\n\n\tret = gen8_modify_rpcs(ce, sseu);\n\tif (!ret)\n\t\tce->sseu = sseu;\n\nunlock:\n\tintel_context_unlock_pinned(ce);\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}