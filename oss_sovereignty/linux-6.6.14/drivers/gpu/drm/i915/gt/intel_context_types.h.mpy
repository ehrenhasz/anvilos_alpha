{
  "module_name": "intel_context_types.h",
  "hash_id": "f4c47fa69889d8808bfb7eca89c02a752b24cee5b5b0cdcb0b0a8062cd5e004e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gt/intel_context_types.h",
  "human_readable_source": " \n \n\n#ifndef __INTEL_CONTEXT_TYPES__\n#define __INTEL_CONTEXT_TYPES__\n\n#include <linux/average.h>\n#include <linux/kref.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/types.h>\n\n#include \"i915_active_types.h\"\n#include \"i915_sw_fence.h\"\n#include \"i915_utils.h\"\n#include \"intel_engine_types.h\"\n#include \"intel_sseu.h\"\n\n#include \"uc/intel_guc_fwif.h\"\n\n#define CONTEXT_REDZONE POISON_INUSE\nDECLARE_EWMA(runtime, 3, 8);\n\nstruct i915_gem_context;\nstruct i915_gem_ww_ctx;\nstruct i915_vma;\nstruct intel_breadcrumbs;\nstruct intel_context;\nstruct intel_ring;\n\nstruct intel_context_ops {\n\tunsigned long flags;\n#define COPS_HAS_INFLIGHT_BIT 0\n#define COPS_HAS_INFLIGHT BIT(COPS_HAS_INFLIGHT_BIT)\n\n#define COPS_RUNTIME_CYCLES_BIT 1\n#define COPS_RUNTIME_CYCLES BIT(COPS_RUNTIME_CYCLES_BIT)\n\n\tint (*alloc)(struct intel_context *ce);\n\n\tvoid (*revoke)(struct intel_context *ce, struct i915_request *rq,\n\t\t       unsigned int preempt_timeout_ms);\n\n\tvoid (*close)(struct intel_context *ce);\n\n\tint (*pre_pin)(struct intel_context *ce, struct i915_gem_ww_ctx *ww, void **vaddr);\n\tint (*pin)(struct intel_context *ce, void *vaddr);\n\tvoid (*unpin)(struct intel_context *ce);\n\tvoid (*post_unpin)(struct intel_context *ce);\n\n\tvoid (*cancel_request)(struct intel_context *ce,\n\t\t\t       struct i915_request *rq);\n\n\tvoid (*enter)(struct intel_context *ce);\n\tvoid (*exit)(struct intel_context *ce);\n\n\tvoid (*sched_disable)(struct intel_context *ce);\n\n\tvoid (*update_stats)(struct intel_context *ce);\n\n\tvoid (*reset)(struct intel_context *ce);\n\tvoid (*destroy)(struct kref *kref);\n\n\t \n\tstruct intel_context *(*create_virtual)(struct intel_engine_cs **engine,\n\t\t\t\t\t\tunsigned int count,\n\t\t\t\t\t\tunsigned long flags);\n\tstruct intel_context *(*create_parallel)(struct intel_engine_cs **engines,\n\t\t\t\t\t\t unsigned int num_siblings,\n\t\t\t\t\t\t unsigned int width);\n\tstruct intel_engine_cs *(*get_sibling)(struct intel_engine_cs *engine,\n\t\t\t\t\t       unsigned int sibling);\n};\n\nstruct intel_context {\n\t \n\tunion {\n\t\tstruct kref ref;  \n\t\tstruct rcu_head rcu;\n\t};\n\n\tstruct intel_engine_cs *engine;\n\tstruct intel_engine_cs *inflight;\n#define __intel_context_inflight(engine) ptr_mask_bits(engine, 3)\n#define __intel_context_inflight_count(engine) ptr_unmask_bits(engine, 3)\n#define intel_context_inflight(ce) \\\n\t__intel_context_inflight(READ_ONCE((ce)->inflight))\n#define intel_context_inflight_count(ce) \\\n\t__intel_context_inflight_count(READ_ONCE((ce)->inflight))\n\n\tstruct i915_address_space *vm;\n\tstruct i915_gem_context __rcu *gem_context;\n\n\t \n\tstruct list_head signal_link;  \n\tstruct list_head signals;  \n\tspinlock_t signal_lock;  \n\n\tstruct i915_vma *state;\n\tu32 ring_size;\n\tstruct intel_ring *ring;\n\tstruct intel_timeline *timeline;\n\n\tunsigned long flags;\n#define CONTEXT_BARRIER_BIT\t\t0\n#define CONTEXT_ALLOC_BIT\t\t1\n#define CONTEXT_INIT_BIT\t\t2\n#define CONTEXT_VALID_BIT\t\t3\n#define CONTEXT_CLOSED_BIT\t\t4\n#define CONTEXT_USE_SEMAPHORES\t\t5\n#define CONTEXT_BANNED\t\t\t6\n#define CONTEXT_FORCE_SINGLE_SUBMISSION\t7\n#define CONTEXT_NOPREEMPT\t\t8\n#define CONTEXT_LRCA_DIRTY\t\t9\n#define CONTEXT_GUC_INIT\t\t10\n#define CONTEXT_PERMA_PIN\t\t11\n#define CONTEXT_IS_PARKING\t\t12\n#define CONTEXT_EXITING\t\t\t13\n\n\tstruct {\n\t\tu64 timeout_us;\n\t} watchdog;\n\n\tu32 *lrc_reg_state;\n\tunion {\n\t\tstruct {\n\t\t\tu32 lrca;\n\t\t\tu32 ccid;\n\t\t};\n\t\tu64 desc;\n\t} lrc;\n\tu32 tag;  \n\n\t \n\tstruct intel_context_stats {\n\t\tu64 active;\n\n\t\t \n\t\tstruct {\n\t\t\tstruct ewma_runtime avg;\n\t\t\tu64 total;\n\t\t\tu32 last;\n\t\t\tI915_SELFTEST_DECLARE(u32 num_underflow);\n\t\t\tI915_SELFTEST_DECLARE(u32 max_underflow);\n\t\t} runtime;\n\t} stats;\n\n\tunsigned int active_count;  \n\n\tatomic_t pin_count;\n\tstruct mutex pin_mutex;  \n\n\t \n\tstruct i915_active active;\n\n\tconst struct intel_context_ops *ops;\n\n\t \n\tstruct intel_sseu sseu;\n\n\t \n\tstruct list_head pinned_contexts_link;\n\n\tu8 wa_bb_page;  \n\n\tstruct {\n\t\t \n\t\tspinlock_t lock;\n\t\t \n\t\tu32 sched_state;\n\t\t \n\t\tstruct list_head fences;\n\t\t \n\t\tstruct i915_sw_fence blocked;\n\t\t \n\t\tstruct list_head requests;\n\t\t \n\t\tu8 prio;\n\t\t \n\t\tu32 prio_count[GUC_CLIENT_PRIORITY_NUM];\n\t\t \n\t\tstruct delayed_work sched_disable_delay_work;\n\t} guc_state;\n\n\tstruct {\n\t\t \n\t\tu16 id;\n\t\t \n\t\tatomic_t ref;\n\t\t \n\t\tstruct list_head link;\n\t} guc_id;\n\n\t \n\tstruct list_head destroyed_link;\n\n\t \n\tstruct {\n\t\tunion {\n\t\t\t \n\t\t\tstruct list_head child_list;\n\t\t\t \n\t\t\tstruct list_head child_link;\n\t\t};\n\t\t \n\t\tstruct intel_context *parent;\n\t\t \n\t\tstruct i915_request *last_rq;\n\t\t \n\t\tu64 fence_context;\n\t\t \n\t\tu32 seqno;\n\t\t \n\t\tu8 number_children;\n\t\t \n\t\tu8 child_index;\n\t\t \n\t\tstruct {\n\t\t\t \n\t\t\tu16 wqi_head;\n\t\t\t \n\t\t\tu16 wqi_tail;\n\t\t\t \n\t\t\tu32 *wq_head;\n\t\t\t \n\t\t\tu32 *wq_tail;\n\t\t\t \n\t\t\tu32 *wq_status;\n\n\t\t\t \n\t\t\tu8 parent_page;\n\t\t} guc;\n\t} parallel;\n\n#ifdef CONFIG_DRM_I915_SELFTEST\n\t \n\tbool drop_schedule_enable;\n\n\t \n\tbool drop_schedule_disable;\n\n\t \n\tbool drop_deregister;\n#endif\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}