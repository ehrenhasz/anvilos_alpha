{
  "module_name": "intel_gt_debugfs.c",
  "hash_id": "25a83464968290eec993a21c103d5fc32fe04edcec127711af427d9ae002c30c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gt/intel_gt_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n\n#include \"i915_drv.h\"\n#include \"intel_gt.h\"\n#include \"intel_gt_debugfs.h\"\n#include \"intel_gt_engines_debugfs.h\"\n#include \"intel_gt_mcr.h\"\n#include \"intel_gt_pm_debugfs.h\"\n#include \"intel_sseu_debugfs.h\"\n#include \"uc/intel_uc_debugfs.h\"\n\nint intel_gt_debugfs_reset_show(struct intel_gt *gt, u64 *val)\n{\n\tint ret = intel_gt_terminally_wedged(gt);\n\n\tswitch (ret) {\n\tcase -EIO:\n\t\t*val = 1;\n\t\treturn 0;\n\tcase 0:\n\t\t*val = 0;\n\t\treturn 0;\n\tdefault:\n\t\treturn ret;\n\t}\n}\n\nvoid intel_gt_debugfs_reset_store(struct intel_gt *gt, u64 val)\n{\n\t \n\twait_event(gt->reset.queue,\n\t\t   !test_bit(I915_RESET_BACKOFF, &gt->reset.flags));\n\n\tintel_gt_handle_error(gt, val, I915_ERROR_CAPTURE,\n\t\t\t      \"Manually reset engine mask to %llx\", val);\n}\n\n \nstatic int __intel_gt_debugfs_reset_show(void *data, u64 *val)\n{\n\treturn intel_gt_debugfs_reset_show(data, val);\n}\n\nstatic int __intel_gt_debugfs_reset_store(void *data, u64 val)\n{\n\tintel_gt_debugfs_reset_store(data, val);\n\n\treturn 0;\n}\n\nDEFINE_SIMPLE_ATTRIBUTE(reset_fops, __intel_gt_debugfs_reset_show,\n\t\t\t__intel_gt_debugfs_reset_store, \"%llu\\n\");\n\nstatic int steering_show(struct seq_file *m, void *data)\n{\n\tstruct drm_printer p = drm_seq_file_printer(m);\n\tstruct intel_gt *gt = m->private;\n\n\tintel_gt_mcr_report_steering(&p, gt, true);\n\n\treturn 0;\n}\nDEFINE_INTEL_GT_DEBUGFS_ATTRIBUTE(steering);\n\nstatic void gt_debugfs_register(struct intel_gt *gt, struct dentry *root)\n{\n\tstatic const struct intel_gt_debugfs_file files[] = {\n\t\t{ \"reset\", &reset_fops, NULL },\n\t\t{ \"steering\", &steering_fops },\n\t};\n\n\tintel_gt_debugfs_register_files(root, files, ARRAY_SIZE(files), gt);\n}\n\nvoid intel_gt_debugfs_register(struct intel_gt *gt)\n{\n\tstruct dentry *root;\n\tchar gtname[4];\n\n\tif (!gt->i915->drm.primary->debugfs_root)\n\t\treturn;\n\n\tsnprintf(gtname, sizeof(gtname), \"gt%u\", gt->info.id);\n\troot = debugfs_create_dir(gtname, gt->i915->drm.primary->debugfs_root);\n\tif (IS_ERR(root))\n\t\treturn;\n\n\tgt_debugfs_register(gt, root);\n\n\tintel_gt_engines_debugfs_register(gt, root);\n\tintel_gt_pm_debugfs_register(gt, root);\n\tintel_sseu_debugfs_register(gt, root);\n\n\tintel_uc_debugfs_register(&gt->uc, root);\n}\n\nvoid intel_gt_debugfs_register_files(struct dentry *root,\n\t\t\t\t     const struct intel_gt_debugfs_file *files,\n\t\t\t\t     unsigned long count, void *data)\n{\n\twhile (count--) {\n\t\tumode_t mode = files->fops->write ? 0644 : 0444;\n\n\t\tif (!files->eval || files->eval(data))\n\t\t\tdebugfs_create_file(files->name,\n\t\t\t\t\t    mode, root, data,\n\t\t\t\t\t    files->fops);\n\n\t\tfiles++;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}