{
  "module_name": "intel_gt_pm_irq.c",
  "hash_id": "474bfb802f1c8a366f5e9001d07ed8d503ff3df4125a7653d9be4189c21a8410",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gt/intel_gt_pm_irq.c",
  "human_readable_source": "\n \n\n#include \"i915_drv.h\"\n#include \"i915_reg.h\"\n#include \"intel_gt.h\"\n#include \"intel_gt_irq.h\"\n#include \"intel_gt_pm_irq.h\"\n#include \"intel_gt_regs.h\"\n\nstatic void write_pm_imr(struct intel_gt *gt)\n{\n\tstruct drm_i915_private *i915 = gt->i915;\n\tstruct intel_uncore *uncore = gt->uncore;\n\tu32 mask = gt->pm_imr;\n\ti915_reg_t reg;\n\n\tif (GRAPHICS_VER(i915) >= 11) {\n\t\treg = GEN11_GPM_WGBOXPERF_INTR_MASK;\n\t\tmask <<= 16;  \n\t} else if (GRAPHICS_VER(i915) >= 8) {\n\t\treg = GEN8_GT_IMR(2);\n\t} else {\n\t\treg = GEN6_PMIMR;\n\t}\n\n\tintel_uncore_write(uncore, reg, mask);\n}\n\nstatic void gen6_gt_pm_update_irq(struct intel_gt *gt,\n\t\t\t\t  u32 interrupt_mask,\n\t\t\t\t  u32 enabled_irq_mask)\n{\n\tu32 new_val;\n\n\tWARN_ON(enabled_irq_mask & ~interrupt_mask);\n\n\tlockdep_assert_held(gt->irq_lock);\n\n\tnew_val = gt->pm_imr;\n\tnew_val &= ~interrupt_mask;\n\tnew_val |= ~enabled_irq_mask & interrupt_mask;\n\n\tif (new_val != gt->pm_imr) {\n\t\tgt->pm_imr = new_val;\n\t\twrite_pm_imr(gt);\n\t}\n}\n\nvoid gen6_gt_pm_unmask_irq(struct intel_gt *gt, u32 mask)\n{\n\tgen6_gt_pm_update_irq(gt, mask, mask);\n}\n\nvoid gen6_gt_pm_mask_irq(struct intel_gt *gt, u32 mask)\n{\n\tgen6_gt_pm_update_irq(gt, mask, 0);\n}\n\nvoid gen6_gt_pm_reset_iir(struct intel_gt *gt, u32 reset_mask)\n{\n\tstruct intel_uncore *uncore = gt->uncore;\n\ti915_reg_t reg = GRAPHICS_VER(gt->i915) >= 8 ? GEN8_GT_IIR(2) : GEN6_PMIIR;\n\n\tlockdep_assert_held(gt->irq_lock);\n\n\tintel_uncore_write(uncore, reg, reset_mask);\n\tintel_uncore_write(uncore, reg, reset_mask);\n\tintel_uncore_posting_read(uncore, reg);\n}\n\nstatic void write_pm_ier(struct intel_gt *gt)\n{\n\tstruct drm_i915_private *i915 = gt->i915;\n\tstruct intel_uncore *uncore = gt->uncore;\n\tu32 mask = gt->pm_ier;\n\ti915_reg_t reg;\n\n\tif (GRAPHICS_VER(i915) >= 11) {\n\t\treg = GEN11_GPM_WGBOXPERF_INTR_ENABLE;\n\t\tmask <<= 16;  \n\t} else if (GRAPHICS_VER(i915) >= 8) {\n\t\treg = GEN8_GT_IER(2);\n\t} else {\n\t\treg = GEN6_PMIER;\n\t}\n\n\tintel_uncore_write(uncore, reg, mask);\n}\n\nvoid gen6_gt_pm_enable_irq(struct intel_gt *gt, u32 enable_mask)\n{\n\tlockdep_assert_held(gt->irq_lock);\n\n\tgt->pm_ier |= enable_mask;\n\twrite_pm_ier(gt);\n\tgen6_gt_pm_unmask_irq(gt, enable_mask);\n}\n\nvoid gen6_gt_pm_disable_irq(struct intel_gt *gt, u32 disable_mask)\n{\n\tlockdep_assert_held(gt->irq_lock);\n\n\tgt->pm_ier &= ~disable_mask;\n\tgen6_gt_pm_mask_irq(gt, disable_mask);\n\twrite_pm_ier(gt);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}