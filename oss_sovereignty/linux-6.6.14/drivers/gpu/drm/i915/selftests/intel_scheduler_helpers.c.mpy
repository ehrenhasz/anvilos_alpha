{
  "module_name": "intel_scheduler_helpers.c",
  "hash_id": "095fa1f7f3da9af2516ac18b42596f7ceb0929ad571cb13a57a3958372e4212a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/selftests/intel_scheduler_helpers.c",
  "human_readable_source": "\n \n\n\n#include \"gt/intel_gt.h\"\n#include \"i915_drv.h\"\n#include \"i915_selftest.h\"\n\n#include \"selftests/intel_scheduler_helpers.h\"\n\n#define REDUCED_TIMESLICE\t5\n#define REDUCED_PREEMPT\t\t10\n#define WAIT_FOR_RESET_TIME\t10000\n\nstruct intel_engine_cs *intel_selftest_find_any_engine(struct intel_gt *gt)\n{\n\tstruct intel_engine_cs *engine;\n\tenum intel_engine_id id;\n\n\tfor_each_engine(engine, gt, id)\n\t\treturn engine;\n\n\tpr_err(\"No valid engine found!\\n\");\n\treturn NULL;\n}\n\nint intel_selftest_modify_policy(struct intel_engine_cs *engine,\n\t\t\t\t struct intel_selftest_saved_policy *saved,\n\t\t\t\t enum selftest_scheduler_modify modify_type)\n{\n\tint err;\n\n\tsaved->reset = engine->i915->params.reset;\n\tsaved->flags = engine->flags;\n\tsaved->timeslice = engine->props.timeslice_duration_ms;\n\tsaved->preempt_timeout = engine->props.preempt_timeout_ms;\n\n\tswitch (modify_type) {\n\tcase SELFTEST_SCHEDULER_MODIFY_FAST_RESET:\n\t\t \n\t\tengine->i915->params.reset = 2;\n\t\tengine->flags |= I915_ENGINE_WANT_FORCED_PREEMPTION;\n\t\tengine->props.timeslice_duration_ms = REDUCED_TIMESLICE;\n\t\tengine->props.preempt_timeout_ms = REDUCED_PREEMPT;\n\t\tbreak;\n\n\tcase SELFTEST_SCHEDULER_MODIFY_NO_HANGCHECK:\n\t\tengine->props.preempt_timeout_ms = 0;\n\t\tbreak;\n\n\tdefault:\n\t\tpr_err(\"Invalid scheduler policy modification type: %d!\\n\", modify_type);\n\t\treturn -EINVAL;\n\t}\n\n\tif (!intel_engine_uses_guc(engine))\n\t\treturn 0;\n\n\terr = intel_guc_global_policies_update(&engine->gt->uc.guc);\n\tif (err)\n\t\tintel_selftest_restore_policy(engine, saved);\n\n\treturn err;\n}\n\nint intel_selftest_restore_policy(struct intel_engine_cs *engine,\n\t\t\t\t  struct intel_selftest_saved_policy *saved)\n{\n\t \n\tengine->i915->params.reset = saved->reset;\n\tengine->flags = saved->flags;\n\tengine->props.timeslice_duration_ms = saved->timeslice;\n\tengine->props.preempt_timeout_ms = saved->preempt_timeout;\n\n\tif (!intel_engine_uses_guc(engine))\n\t\treturn 0;\n\n\treturn intel_guc_global_policies_update(&engine->gt->uc.guc);\n}\n\nint intel_selftest_wait_for_rq(struct i915_request *rq)\n{\n\tlong ret;\n\n\tret = i915_request_wait(rq, 0, WAIT_FOR_RESET_TIME);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}