{
  "module_name": "igt_live_test.c",
  "hash_id": "e1e29ac9fd2fa53efdfcf1be07869086f1938236afd68246ffa342e2f8b67642",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/selftests/igt_live_test.c",
  "human_readable_source": " \n\n#include \"i915_drv.h\"\n#include \"gt/intel_gt.h\"\n#include \"gt/intel_gt_print.h\"\n\n#include \"../i915_selftest.h\"\n#include \"igt_flush_test.h\"\n#include \"igt_live_test.h\"\n\nint igt_live_test_begin(struct igt_live_test *t,\n\t\t\tstruct drm_i915_private *i915,\n\t\t\tconst char *func,\n\t\t\tconst char *name)\n{\n\tstruct intel_engine_cs *engine;\n\tenum intel_engine_id id;\n\tstruct intel_gt *gt;\n\tunsigned int i;\n\tint err;\n\n\tt->i915 = i915;\n\tt->func = func;\n\tt->name = name;\n\n\tfor_each_gt(gt, i915, i) {\n\n\t\terr = intel_gt_wait_for_idle(gt, MAX_SCHEDULE_TIMEOUT);\n\t\tif (err) {\n\t\t\tgt_err(gt, \"%s(%s): GT failed to idle before, with err=%d!\",\n\t\t\t       func, name, err);\n\t\t\treturn err;\n\t\t}\n\n\t\tfor_each_engine(engine, gt, id)\n\t\t\tt->reset_engine[i][id] =\n\t\t\t\ti915_reset_engine_count(&i915->gpu_error,\n\t\t\t\t\t\t\tengine);\n\t}\n\n\tt->reset_global = i915_reset_count(&i915->gpu_error);\n\n\treturn 0;\n}\n\nint igt_live_test_end(struct igt_live_test *t)\n{\n\tstruct drm_i915_private *i915 = t->i915;\n\tstruct intel_engine_cs *engine;\n\tenum intel_engine_id id;\n\tstruct intel_gt *gt;\n\tunsigned int i;\n\n\tif (igt_flush_test(i915))\n\t\treturn -EIO;\n\n\tif (t->reset_global != i915_reset_count(&i915->gpu_error)) {\n\t\tpr_err(\"%s(%s): GPU was reset %d times!\\n\",\n\t\t       t->func, t->name,\n\t\t       i915_reset_count(&i915->gpu_error) - t->reset_global);\n\t\treturn -EIO;\n\t}\n\n\tfor_each_gt(gt, i915, i) {\n\t\tfor_each_engine(engine, gt, id) {\n\t\t\tif (t->reset_engine[i][id] ==\n\t\t\t    i915_reset_engine_count(&i915->gpu_error, engine))\n\t\t\t\tcontinue;\n\n\t\t\tgt_err(gt, \"%s(%s): engine '%s' was reset %d times!\\n\",\n\t\t\t       t->func, t->name, engine->name,\n\t\t\t       i915_reset_engine_count(&i915->gpu_error, engine) -\n\t\t\t       t->reset_engine[i][id]);\n\t\t\treturn -EIO;\n\t\t}\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}