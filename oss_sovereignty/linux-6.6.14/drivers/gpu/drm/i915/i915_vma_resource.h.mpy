{
  "module_name": "i915_vma_resource.h",
  "hash_id": "631e5b141597d5efc8ba3c48b80ec41cf009d30d57872309af5cbdf6992b9d54",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_vma_resource.h",
  "human_readable_source": " \n \n\n#ifndef __I915_VMA_RESOURCE_H__\n#define __I915_VMA_RESOURCE_H__\n\n#include <linux/dma-fence.h>\n#include <linux/refcount.h>\n\n#include \"i915_gem.h\"\n#include \"i915_scatterlist.h\"\n#include \"i915_sw_fence.h\"\n#include \"intel_runtime_pm.h\"\n\nstruct intel_memory_region;\n\nstruct i915_page_sizes {\n\t \n\tunsigned int phys;\n\n\t \n\tunsigned int sg;\n};\n\n \nstruct i915_vma_bindinfo {\n\tstruct sg_table *pages;\n\tstruct i915_page_sizes page_sizes;\n\tstruct i915_refct_sgt *pages_rsgt;\n\tbool readonly:1;\n\tbool lmem:1;\n};\n\n \nstruct i915_vma_resource {\n\tstruct dma_fence unbind_fence;\n\t \n\tspinlock_t lock;\n\trefcount_t hold_count;\n\tstruct work_struct work;\n\tstruct i915_sw_fence chain;\n\tstruct rb_node rb;\n\tu64 __subtree_last;\n\tstruct i915_address_space *vm;\n\tintel_wakeref_t wakeref;\n\n\t \n\tstruct i915_vma_bindinfo bi;\n\n#if IS_ENABLED(CONFIG_DRM_I915_CAPTURE_ERROR)\n\tstruct intel_memory_region *mr;\n#endif\n\tconst struct i915_vma_ops *ops;\n\tvoid *private;\n\tu64 start;\n\tu64 node_size;\n\tu64 vma_size;\n\tu32 guard;\n\tu32 page_sizes_gtt;\n\n\tu32 bound_flags;\n\tbool allocated:1;\n\tbool immediate_unbind:1;\n\tbool needs_wakeref:1;\n\tbool skip_pte_rewrite:1;\n\n\tu32 *tlb;\n};\n\nbool i915_vma_resource_hold(struct i915_vma_resource *vma_res,\n\t\t\t    bool *lockdep_cookie);\n\nvoid i915_vma_resource_unhold(struct i915_vma_resource *vma_res,\n\t\t\t      bool lockdep_cookie);\n\nstruct i915_vma_resource *i915_vma_resource_alloc(void);\n\nvoid i915_vma_resource_free(struct i915_vma_resource *vma_res);\n\nstruct dma_fence *i915_vma_resource_unbind(struct i915_vma_resource *vma_res,\n\t\t\t\t\t   u32 *tlb);\n\nvoid __i915_vma_resource_init(struct i915_vma_resource *vma_res);\n\n \nstatic inline struct i915_vma_resource\n*i915_vma_resource_get(struct i915_vma_resource *vma_res)\n{\n\tdma_fence_get(&vma_res->unbind_fence);\n\treturn vma_res;\n}\n\n \nstatic inline void i915_vma_resource_put(struct i915_vma_resource *vma_res)\n{\n\tdma_fence_put(&vma_res->unbind_fence);\n}\n\n \nstatic inline void i915_vma_resource_init(struct i915_vma_resource *vma_res,\n\t\t\t\t\t  struct i915_address_space *vm,\n\t\t\t\t\t  struct sg_table *pages,\n\t\t\t\t\t  const struct i915_page_sizes *page_sizes,\n\t\t\t\t\t  struct i915_refct_sgt *pages_rsgt,\n\t\t\t\t\t  bool readonly,\n\t\t\t\t\t  bool lmem,\n\t\t\t\t\t  struct intel_memory_region *mr,\n\t\t\t\t\t  const struct i915_vma_ops *ops,\n\t\t\t\t\t  void *private,\n\t\t\t\t\t  u64 start,\n\t\t\t\t\t  u64 node_size,\n\t\t\t\t\t  u64 size,\n\t\t\t\t\t  u32 guard)\n{\n\t__i915_vma_resource_init(vma_res);\n\tvma_res->vm = vm;\n\tvma_res->bi.pages = pages;\n\tvma_res->bi.page_sizes = *page_sizes;\n\tif (pages_rsgt)\n\t\tvma_res->bi.pages_rsgt = i915_refct_sgt_get(pages_rsgt);\n\tvma_res->bi.readonly = readonly;\n\tvma_res->bi.lmem = lmem;\n#if IS_ENABLED(CONFIG_DRM_I915_CAPTURE_ERROR)\n\tvma_res->mr = mr;\n#endif\n\tvma_res->ops = ops;\n\tvma_res->private = private;\n\tvma_res->start = start;\n\tvma_res->node_size = node_size;\n\tvma_res->vma_size = size;\n\tvma_res->guard = guard;\n}\n\nstatic inline void i915_vma_resource_fini(struct i915_vma_resource *vma_res)\n{\n\tGEM_BUG_ON(refcount_read(&vma_res->hold_count) != 1);\n\tif (vma_res->bi.pages_rsgt)\n\t\ti915_refct_sgt_put(vma_res->bi.pages_rsgt);\n\ti915_sw_fence_fini(&vma_res->chain);\n}\n\nint i915_vma_resource_bind_dep_sync(struct i915_address_space *vm,\n\t\t\t\t    u64 first,\n\t\t\t\t    u64 last,\n\t\t\t\t    bool intr);\n\nint i915_vma_resource_bind_dep_await(struct i915_address_space *vm,\n\t\t\t\t     struct i915_sw_fence *sw_fence,\n\t\t\t\t     u64 first,\n\t\t\t\t     u64 last,\n\t\t\t\t     bool intr,\n\t\t\t\t     gfp_t gfp);\n\nvoid i915_vma_resource_bind_dep_sync_all(struct i915_address_space *vm);\n\nvoid i915_vma_resource_module_exit(void);\n\nint i915_vma_resource_module_init(void);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}