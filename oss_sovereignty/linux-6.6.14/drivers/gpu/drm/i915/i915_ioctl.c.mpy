{
  "module_name": "i915_ioctl.c",
  "hash_id": "3dfbba0a6f1f0026e7d0172bc656f43d04ee7351536c5861f474a3489a3ea6d8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/i915_ioctl.c",
  "human_readable_source": "\n \n\n#include \"gt/intel_engine_regs.h\"\n\n#include \"i915_drv.h\"\n#include \"i915_gem.h\"\n#include \"i915_ioctl.h\"\n#include \"i915_reg.h\"\n#include \"intel_runtime_pm.h\"\n#include \"intel_uncore.h\"\n\n \n\nstruct reg_whitelist {\n\ti915_reg_t offset_ldw;\n\ti915_reg_t offset_udw;\n\tu8 min_graphics_ver;\n\tu8 max_graphics_ver;\n\tu8 size;\n};\n\nstatic const struct reg_whitelist reg_read_whitelist[] = {\n\t{\n\t\t.offset_ldw = RING_TIMESTAMP(RENDER_RING_BASE),\n\t\t.offset_udw = RING_TIMESTAMP_UDW(RENDER_RING_BASE),\n\t\t.min_graphics_ver = 4,\n\t\t.max_graphics_ver = 12,\n\t\t.size = 8\n\t}\n};\n\nint i915_reg_read_ioctl(struct drm_device *dev,\n\t\t\tvoid *data, struct drm_file *unused)\n{\n\tstruct drm_i915_private *i915 = to_i915(dev);\n\tstruct intel_uncore *uncore = &i915->uncore;\n\tstruct drm_i915_reg_read *reg = data;\n\tstruct reg_whitelist const *entry;\n\tintel_wakeref_t wakeref;\n\tunsigned int flags;\n\tint remain;\n\tint ret = 0;\n\n\tentry = reg_read_whitelist;\n\tremain = ARRAY_SIZE(reg_read_whitelist);\n\twhile (remain) {\n\t\tu32 entry_offset = i915_mmio_reg_offset(entry->offset_ldw);\n\n\t\tGEM_BUG_ON(!is_power_of_2(entry->size));\n\t\tGEM_BUG_ON(entry->size > 8);\n\t\tGEM_BUG_ON(entry_offset & (entry->size - 1));\n\n\t\tif (IS_GRAPHICS_VER(i915, entry->min_graphics_ver, entry->max_graphics_ver) &&\n\t\t    entry_offset == (reg->offset & -entry->size))\n\t\t\tbreak;\n\t\tentry++;\n\t\tremain--;\n\t}\n\n\tif (!remain)\n\t\treturn -EINVAL;\n\n\tflags = reg->offset & (entry->size - 1);\n\n\twith_intel_runtime_pm(&i915->runtime_pm, wakeref) {\n\t\tif (entry->size == 8 && flags == I915_REG_READ_8B_WA)\n\t\t\treg->val = intel_uncore_read64_2x32(uncore,\n\t\t\t\t\t\t\t    entry->offset_ldw,\n\t\t\t\t\t\t\t    entry->offset_udw);\n\t\telse if (entry->size == 8 && flags == 0)\n\t\t\treg->val = intel_uncore_read64(uncore,\n\t\t\t\t\t\t       entry->offset_ldw);\n\t\telse if (entry->size == 4 && flags == 0)\n\t\t\treg->val = intel_uncore_read(uncore, entry->offset_ldw);\n\t\telse if (entry->size == 2 && flags == 0)\n\t\t\treg->val = intel_uncore_read16(uncore,\n\t\t\t\t\t\t       entry->offset_ldw);\n\t\telse if (entry->size == 1 && flags == 0)\n\t\t\treg->val = intel_uncore_read8(uncore,\n\t\t\t\t\t\t      entry->offset_ldw);\n\t\telse\n\t\t\tret = -EINVAL;\n\t}\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}