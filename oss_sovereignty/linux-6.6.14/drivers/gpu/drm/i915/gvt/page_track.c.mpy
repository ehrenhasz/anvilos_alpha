{
  "module_name": "page_track.c",
  "hash_id": "49683b028e2abd13b32895c6466149a4676c41189c9b789338296d15b6630e53",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/gvt/page_track.c",
  "human_readable_source": " \n#include \"i915_drv.h\"\n#include \"gvt.h\"\n\n \nstruct intel_vgpu_page_track *intel_vgpu_find_page_track(\n\t\tstruct intel_vgpu *vgpu, unsigned long gfn)\n{\n\treturn radix_tree_lookup(&vgpu->page_track_tree, gfn);\n}\n\n \nint intel_vgpu_register_page_track(struct intel_vgpu *vgpu, unsigned long gfn,\n\t\tgvt_page_track_handler_t handler, void *priv)\n{\n\tstruct intel_vgpu_page_track *track;\n\tint ret;\n\n\ttrack = intel_vgpu_find_page_track(vgpu, gfn);\n\tif (track)\n\t\treturn -EEXIST;\n\n\ttrack = kzalloc(sizeof(*track), GFP_KERNEL);\n\tif (!track)\n\t\treturn -ENOMEM;\n\n\ttrack->handler = handler;\n\ttrack->priv_data = priv;\n\n\tret = radix_tree_insert(&vgpu->page_track_tree, gfn, track);\n\tif (ret) {\n\t\tkfree(track);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\n \nvoid intel_vgpu_unregister_page_track(struct intel_vgpu *vgpu,\n\t\tunsigned long gfn)\n{\n\tstruct intel_vgpu_page_track *track;\n\n\ttrack = radix_tree_delete(&vgpu->page_track_tree, gfn);\n\tif (track) {\n\t\tif (track->tracked)\n\t\t\tintel_gvt_page_track_remove(vgpu, gfn);\n\t\tkfree(track);\n\t}\n}\n\n \nint intel_vgpu_enable_page_track(struct intel_vgpu *vgpu, unsigned long gfn)\n{\n\tstruct intel_vgpu_page_track *track;\n\tint ret;\n\n\ttrack = intel_vgpu_find_page_track(vgpu, gfn);\n\tif (!track)\n\t\treturn -ENXIO;\n\n\tif (track->tracked)\n\t\treturn 0;\n\n\tret = intel_gvt_page_track_add(vgpu, gfn);\n\tif (ret)\n\t\treturn ret;\n\ttrack->tracked = true;\n\treturn 0;\n}\n\n \nint intel_vgpu_disable_page_track(struct intel_vgpu *vgpu, unsigned long gfn)\n{\n\tstruct intel_vgpu_page_track *track;\n\tint ret;\n\n\ttrack = intel_vgpu_find_page_track(vgpu, gfn);\n\tif (!track)\n\t\treturn -ENXIO;\n\n\tif (!track->tracked)\n\t\treturn 0;\n\n\tret = intel_gvt_page_track_remove(vgpu, gfn);\n\tif (ret)\n\t\treturn ret;\n\ttrack->tracked = false;\n\treturn 0;\n}\n\n \nint intel_vgpu_page_track_handler(struct intel_vgpu *vgpu, u64 gpa,\n\t\tvoid *data, unsigned int bytes)\n{\n\tstruct intel_vgpu_page_track *page_track;\n\tint ret = 0;\n\n\tpage_track = intel_vgpu_find_page_track(vgpu, gpa >> PAGE_SHIFT);\n\tif (!page_track)\n\t\treturn -ENXIO;\n\n\tif (unlikely(vgpu->failsafe)) {\n\t\t \n\t\tintel_gvt_page_track_remove(vgpu, gpa >> PAGE_SHIFT);\n\t} else {\n\t\tret = page_track->handler(page_track, gpa, data, bytes);\n\t\tif (ret)\n\t\t\tgvt_err(\"guest page write error, gpa %llx\\n\", gpa);\n\t}\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}