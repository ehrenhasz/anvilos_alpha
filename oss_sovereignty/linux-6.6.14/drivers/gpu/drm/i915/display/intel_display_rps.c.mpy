{
  "module_name": "intel_display_rps.c",
  "hash_id": "6f28be2794be666c79f0baaf9d9e2ee7a1d855e4a58f9daa75d6de4886b06049",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/display/intel_display_rps.c",
  "human_readable_source": "\n \n\n#include <drm/drm_crtc.h>\n#include <drm/drm_vblank.h>\n\n#include \"gt/intel_rps.h\"\n#include \"i915_drv.h\"\n#include \"intel_display_rps.h\"\n#include \"intel_display_types.h\"\n\nstruct wait_rps_boost {\n\tstruct wait_queue_entry wait;\n\n\tstruct drm_crtc *crtc;\n\tstruct i915_request *request;\n};\n\nstatic int do_rps_boost(struct wait_queue_entry *_wait,\n\t\t\tunsigned mode, int sync, void *key)\n{\n\tstruct wait_rps_boost *wait = container_of(_wait, typeof(*wait), wait);\n\tstruct i915_request *rq = wait->request;\n\n\t \n\tif (!i915_request_started(rq))\n\t\tintel_rps_boost(rq);\n\ti915_request_put(rq);\n\n\tdrm_crtc_vblank_put(wait->crtc);\n\n\tlist_del(&wait->wait.entry);\n\tkfree(wait);\n\treturn 1;\n}\n\nvoid intel_display_rps_boost_after_vblank(struct drm_crtc *crtc,\n\t\t\t\t\t  struct dma_fence *fence)\n{\n\tstruct wait_rps_boost *wait;\n\n\tif (!dma_fence_is_i915(fence))\n\t\treturn;\n\n\tif (DISPLAY_VER(to_i915(crtc->dev)) < 6)\n\t\treturn;\n\n\tif (drm_crtc_vblank_get(crtc))\n\t\treturn;\n\n\twait = kmalloc(sizeof(*wait), GFP_KERNEL);\n\tif (!wait) {\n\t\tdrm_crtc_vblank_put(crtc);\n\t\treturn;\n\t}\n\n\twait->request = to_request(dma_fence_get(fence));\n\twait->crtc = crtc;\n\n\twait->wait.func = do_rps_boost;\n\twait->wait.flags = 0;\n\n\tadd_wait_queue(drm_crtc_vblank_waitqueue(crtc), &wait->wait);\n}\n\nvoid intel_display_rps_mark_interactive(struct drm_i915_private *i915,\n\t\t\t\t\tstruct intel_atomic_state *state,\n\t\t\t\t\tbool interactive)\n{\n\tif (state->rps_interactive == interactive)\n\t\treturn;\n\n\tintel_rps_mark_interactive(&to_gt(i915)->rps, interactive);\n\tstate->rps_interactive = interactive;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}