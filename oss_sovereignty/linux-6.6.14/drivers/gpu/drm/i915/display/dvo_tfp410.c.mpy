{
  "module_name": "dvo_tfp410.c",
  "hash_id": "6d24a0f36e52a60a441ab8ef38c6c9c25917ad35ec5c27dcef84790f2fddf51b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/display/dvo_tfp410.c",
  "human_readable_source": " \n\n#include \"intel_display_types.h\"\n#include \"intel_dvo_dev.h\"\n\n \n#define TFP410_VID\t\t0x014C\n#define TFP410_DID\t\t0x0410\n\n#define TFP410_VID_LO\t\t0x00\n#define TFP410_VID_HI\t\t0x01\n#define TFP410_DID_LO\t\t0x02\n#define TFP410_DID_HI\t\t0x03\n#define TFP410_REV\t\t0x04\n\n#define TFP410_CTL_1\t\t0x08\n#define TFP410_CTL_1_TDIS\t(1<<6)\n#define TFP410_CTL_1_VEN\t(1<<5)\n#define TFP410_CTL_1_HEN\t(1<<4)\n#define TFP410_CTL_1_DSEL\t(1<<3)\n#define TFP410_CTL_1_BSEL\t(1<<2)\n#define TFP410_CTL_1_EDGE\t(1<<1)\n#define TFP410_CTL_1_PD\t\t(1<<0)\n\n#define TFP410_CTL_2\t\t0x09\n#define TFP410_CTL_2_VLOW\t(1<<7)\n#define TFP410_CTL_2_MSEL_MASK\t(0x7<<4)\n#define TFP410_CTL_2_MSEL\t(1<<4)\n#define TFP410_CTL_2_TSEL\t(1<<3)\n#define TFP410_CTL_2_RSEN\t(1<<2)\n#define TFP410_CTL_2_HTPLG\t(1<<1)\n#define TFP410_CTL_2_MDI\t(1<<0)\n\n#define TFP410_CTL_3\t\t0x0A\n#define TFP410_CTL_3_DK_MASK\t(0x7<<5)\n#define TFP410_CTL_3_DK\t\t(1<<5)\n#define TFP410_CTL_3_DKEN\t(1<<4)\n#define TFP410_CTL_3_CTL_MASK\t(0x7<<1)\n#define TFP410_CTL_3_CTL\t(1<<1)\n\n#define TFP410_USERCFG\t\t0x0B\n\n#define TFP410_DE_DLY\t\t0x32\n\n#define TFP410_DE_CTL\t\t0x33\n#define TFP410_DE_CTL_DEGEN\t(1<<6)\n#define TFP410_DE_CTL_VSPOL\t(1<<5)\n#define TFP410_DE_CTL_HSPOL\t(1<<4)\n#define TFP410_DE_CTL_DEDLY8\t(1<<0)\n\n#define TFP410_DE_TOP\t\t0x34\n\n#define TFP410_DE_CNT_LO\t0x36\n#define TFP410_DE_CNT_HI\t0x37\n\n#define TFP410_DE_LIN_LO\t0x38\n#define TFP410_DE_LIN_HI\t0x39\n\n#define TFP410_H_RES_LO\t\t0x3A\n#define TFP410_H_RES_HI\t\t0x3B\n\n#define TFP410_V_RES_LO\t\t0x3C\n#define TFP410_V_RES_HI\t\t0x3D\n\nstruct tfp410_priv {\n\tbool quiet;\n};\n\nstatic bool tfp410_readb(struct intel_dvo_device *dvo, int addr, u8 *ch)\n{\n\tstruct tfp410_priv *tfp = dvo->dev_priv;\n\tstruct i2c_adapter *adapter = dvo->i2c_bus;\n\tu8 out_buf[2];\n\tu8 in_buf[2];\n\n\tstruct i2c_msg msgs[] = {\n\t\t{\n\t\t\t.addr = dvo->slave_addr,\n\t\t\t.flags = 0,\n\t\t\t.len = 1,\n\t\t\t.buf = out_buf,\n\t\t},\n\t\t{\n\t\t\t.addr = dvo->slave_addr,\n\t\t\t.flags = I2C_M_RD,\n\t\t\t.len = 1,\n\t\t\t.buf = in_buf,\n\t\t}\n\t};\n\n\tout_buf[0] = addr;\n\tout_buf[1] = 0;\n\n\tif (i2c_transfer(adapter, msgs, 2) == 2) {\n\t\t*ch = in_buf[0];\n\t\treturn true;\n\t}\n\n\tif (!tfp->quiet) {\n\t\tDRM_DEBUG_KMS(\"Unable to read register 0x%02x from %s:%02x.\\n\",\n\t\t\t  addr, adapter->name, dvo->slave_addr);\n\t}\n\treturn false;\n}\n\nstatic bool tfp410_writeb(struct intel_dvo_device *dvo, int addr, u8 ch)\n{\n\tstruct tfp410_priv *tfp = dvo->dev_priv;\n\tstruct i2c_adapter *adapter = dvo->i2c_bus;\n\tu8 out_buf[2];\n\tstruct i2c_msg msg = {\n\t\t.addr = dvo->slave_addr,\n\t\t.flags = 0,\n\t\t.len = 2,\n\t\t.buf = out_buf,\n\t};\n\n\tout_buf[0] = addr;\n\tout_buf[1] = ch;\n\n\tif (i2c_transfer(adapter, &msg, 1) == 1)\n\t\treturn true;\n\n\tif (!tfp->quiet) {\n\t\tDRM_DEBUG_KMS(\"Unable to write register 0x%02x to %s:%d.\\n\",\n\t\t\t  addr, adapter->name, dvo->slave_addr);\n\t}\n\n\treturn false;\n}\n\nstatic int tfp410_getid(struct intel_dvo_device *dvo, int addr)\n{\n\tu8 ch1, ch2;\n\n\tif (tfp410_readb(dvo, addr+0, &ch1) &&\n\t    tfp410_readb(dvo, addr+1, &ch2))\n\t\treturn ((ch2 << 8) & 0xFF00) | (ch1 & 0x00FF);\n\n\treturn -1;\n}\n\n \nstatic bool tfp410_init(struct intel_dvo_device *dvo,\n\t\t\tstruct i2c_adapter *adapter)\n{\n\t \n\tstruct tfp410_priv *tfp;\n\tint id;\n\n\ttfp = kzalloc(sizeof(struct tfp410_priv), GFP_KERNEL);\n\tif (tfp == NULL)\n\t\treturn false;\n\n\tdvo->i2c_bus = adapter;\n\tdvo->dev_priv = tfp;\n\ttfp->quiet = true;\n\n\tif ((id = tfp410_getid(dvo, TFP410_VID_LO)) != TFP410_VID) {\n\t\tDRM_DEBUG_KMS(\"tfp410 not detected got VID %X: from %s \"\n\t\t\t\t\"Slave %d.\\n\",\n\t\t\t  id, adapter->name, dvo->slave_addr);\n\t\tgoto out;\n\t}\n\n\tif ((id = tfp410_getid(dvo, TFP410_DID_LO)) != TFP410_DID) {\n\t\tDRM_DEBUG_KMS(\"tfp410 not detected got DID %X: from %s \"\n\t\t\t\t\"Slave %d.\\n\",\n\t\t\t  id, adapter->name, dvo->slave_addr);\n\t\tgoto out;\n\t}\n\ttfp->quiet = false;\n\treturn true;\nout:\n\tkfree(tfp);\n\treturn false;\n}\n\nstatic enum drm_connector_status tfp410_detect(struct intel_dvo_device *dvo)\n{\n\tenum drm_connector_status ret = connector_status_disconnected;\n\tu8 ctl2;\n\n\tif (tfp410_readb(dvo, TFP410_CTL_2, &ctl2)) {\n\t\tif (ctl2 & TFP410_CTL_2_RSEN)\n\t\t\tret = connector_status_connected;\n\t\telse\n\t\t\tret = connector_status_disconnected;\n\t}\n\n\treturn ret;\n}\n\nstatic enum drm_mode_status tfp410_mode_valid(struct intel_dvo_device *dvo,\n\t\t\t\t\t      struct drm_display_mode *mode)\n{\n\treturn MODE_OK;\n}\n\nstatic void tfp410_mode_set(struct intel_dvo_device *dvo,\n\t\t\t    const struct drm_display_mode *mode,\n\t\t\t    const struct drm_display_mode *adjusted_mode)\n{\n\t \n\t \n\treturn;\n}\n\n \nstatic void tfp410_dpms(struct intel_dvo_device *dvo, bool enable)\n{\n\tu8 ctl1;\n\n\tif (!tfp410_readb(dvo, TFP410_CTL_1, &ctl1))\n\t\treturn;\n\n\tif (enable)\n\t\tctl1 |= TFP410_CTL_1_PD;\n\telse\n\t\tctl1 &= ~TFP410_CTL_1_PD;\n\n\ttfp410_writeb(dvo, TFP410_CTL_1, ctl1);\n}\n\nstatic bool tfp410_get_hw_state(struct intel_dvo_device *dvo)\n{\n\tu8 ctl1;\n\n\tif (!tfp410_readb(dvo, TFP410_CTL_1, &ctl1))\n\t\treturn false;\n\n\tif (ctl1 & TFP410_CTL_1_PD)\n\t\treturn true;\n\telse\n\t\treturn false;\n}\n\nstatic void tfp410_dump_regs(struct intel_dvo_device *dvo)\n{\n\tu8 val, val2;\n\n\ttfp410_readb(dvo, TFP410_REV, &val);\n\tDRM_DEBUG_KMS(\"TFP410_REV: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_CTL_1, &val);\n\tDRM_DEBUG_KMS(\"TFP410_CTL1: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_CTL_2, &val);\n\tDRM_DEBUG_KMS(\"TFP410_CTL2: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_CTL_3, &val);\n\tDRM_DEBUG_KMS(\"TFP410_CTL3: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_USERCFG, &val);\n\tDRM_DEBUG_KMS(\"TFP410_USERCFG: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_DE_DLY, &val);\n\tDRM_DEBUG_KMS(\"TFP410_DE_DLY: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_DE_CTL, &val);\n\tDRM_DEBUG_KMS(\"TFP410_DE_CTL: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_DE_TOP, &val);\n\tDRM_DEBUG_KMS(\"TFP410_DE_TOP: 0x%02X\\n\", val);\n\ttfp410_readb(dvo, TFP410_DE_CNT_LO, &val);\n\ttfp410_readb(dvo, TFP410_DE_CNT_HI, &val2);\n\tDRM_DEBUG_KMS(\"TFP410_DE_CNT: 0x%02X%02X\\n\", val2, val);\n\ttfp410_readb(dvo, TFP410_DE_LIN_LO, &val);\n\ttfp410_readb(dvo, TFP410_DE_LIN_HI, &val2);\n\tDRM_DEBUG_KMS(\"TFP410_DE_LIN: 0x%02X%02X\\n\", val2, val);\n\ttfp410_readb(dvo, TFP410_H_RES_LO, &val);\n\ttfp410_readb(dvo, TFP410_H_RES_HI, &val2);\n\tDRM_DEBUG_KMS(\"TFP410_H_RES: 0x%02X%02X\\n\", val2, val);\n\ttfp410_readb(dvo, TFP410_V_RES_LO, &val);\n\ttfp410_readb(dvo, TFP410_V_RES_HI, &val2);\n\tDRM_DEBUG_KMS(\"TFP410_V_RES: 0x%02X%02X\\n\", val2, val);\n}\n\nstatic void tfp410_destroy(struct intel_dvo_device *dvo)\n{\n\tstruct tfp410_priv *tfp = dvo->dev_priv;\n\n\tif (tfp) {\n\t\tkfree(tfp);\n\t\tdvo->dev_priv = NULL;\n\t}\n}\n\nconst struct intel_dvo_dev_ops tfp410_ops = {\n\t.init = tfp410_init,\n\t.detect = tfp410_detect,\n\t.mode_valid = tfp410_mode_valid,\n\t.mode_set = tfp410_mode_set,\n\t.dpms = tfp410_dpms,\n\t.get_hw_state = tfp410_get_hw_state,\n\t.dump_regs = tfp410_dump_regs,\n\t.destroy = tfp410_destroy,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}