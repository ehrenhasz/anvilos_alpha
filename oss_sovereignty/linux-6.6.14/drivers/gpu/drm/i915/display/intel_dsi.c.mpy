{
  "module_name": "intel_dsi.c",
  "hash_id": "77047acf24829db25cf765fc7b6757d8cf56379d69a78e42f72a10bb5be5d0f6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/i915/display/intel_dsi.c",
  "human_readable_source": "\n \n\n#include <drm/drm_mipi_dsi.h>\n\n#include \"i915_drv.h\"\n#include \"intel_dsi.h\"\n#include \"intel_panel.h\"\n\nvoid intel_dsi_wait_panel_power_cycle(struct intel_dsi *intel_dsi)\n{\n\tktime_t panel_power_on_time;\n\ts64 panel_power_off_duration;\n\n\tpanel_power_on_time = ktime_get_boottime();\n\tpanel_power_off_duration = ktime_ms_delta(panel_power_on_time,\n\t\t\t\t\t\t  intel_dsi->panel_power_off_time);\n\n\tif (panel_power_off_duration < (s64)intel_dsi->panel_pwr_cycle_delay)\n\t\tmsleep(intel_dsi->panel_pwr_cycle_delay - panel_power_off_duration);\n}\n\nvoid intel_dsi_shutdown(struct intel_encoder *encoder)\n{\n\tstruct intel_dsi *intel_dsi = enc_to_intel_dsi(encoder);\n\n\tintel_dsi_wait_panel_power_cycle(intel_dsi);\n}\n\nint intel_dsi_bitrate(const struct intel_dsi *intel_dsi)\n{\n\tint bpp = mipi_dsi_pixel_format_to_bpp(intel_dsi->pixel_format);\n\n\tif (WARN_ON(bpp < 0))\n\t\tbpp = 16;\n\n\treturn intel_dsi->pclk * bpp / intel_dsi->lane_count;\n}\n\nint intel_dsi_tlpx_ns(const struct intel_dsi *intel_dsi)\n{\n\tswitch (intel_dsi->escape_clk_div) {\n\tdefault:\n\tcase 0:\n\t\treturn 50;\n\tcase 1:\n\t\treturn 100;\n\tcase 2:\n\t\treturn 200;\n\t}\n}\n\nint intel_dsi_get_modes(struct drm_connector *connector)\n{\n\treturn intel_panel_get_modes(to_intel_connector(connector));\n}\n\nenum drm_mode_status intel_dsi_mode_valid(struct drm_connector *connector,\n\t\t\t\t\t  struct drm_display_mode *mode)\n{\n\tstruct drm_i915_private *dev_priv = to_i915(connector->dev);\n\tstruct intel_connector *intel_connector = to_intel_connector(connector);\n\tconst struct drm_display_mode *fixed_mode =\n\t\tintel_panel_fixed_mode(intel_connector, mode);\n\tint max_dotclk = to_i915(connector->dev)->max_dotclk_freq;\n\tenum drm_mode_status status;\n\n\tdrm_dbg_kms(&dev_priv->drm, \"\\n\");\n\n\tif (mode->flags & DRM_MODE_FLAG_DBLSCAN)\n\t\treturn MODE_NO_DBLESCAN;\n\n\tstatus = intel_panel_mode_valid(intel_connector, mode);\n\tif (status != MODE_OK)\n\t\treturn status;\n\n\tif (fixed_mode->clock > max_dotclk)\n\t\treturn MODE_CLOCK_HIGH;\n\n\treturn intel_mode_valid_max_plane_size(dev_priv, mode, false);\n}\n\nstruct intel_dsi_host *intel_dsi_host_init(struct intel_dsi *intel_dsi,\n\t\t\t\t\t   const struct mipi_dsi_host_ops *funcs,\n\t\t\t\t\t   enum port port)\n{\n\tstruct intel_dsi_host *host;\n\tstruct mipi_dsi_device *device;\n\n\thost = kzalloc(sizeof(*host), GFP_KERNEL);\n\tif (!host)\n\t\treturn NULL;\n\n\thost->base.ops = funcs;\n\thost->intel_dsi = intel_dsi;\n\thost->port = port;\n\n\t \n\tdevice = kzalloc(sizeof(*device), GFP_KERNEL);\n\tif (!device) {\n\t\tkfree(host);\n\t\treturn NULL;\n\t}\n\n\tdevice->host = &host->base;\n\thost->device = device;\n\n\treturn host;\n}\n\nenum drm_panel_orientation\nintel_dsi_get_panel_orientation(struct intel_connector *connector)\n{\n\tstruct drm_i915_private *dev_priv = to_i915(connector->base.dev);\n\tenum drm_panel_orientation orientation;\n\n\torientation = connector->panel.vbt.dsi.orientation;\n\tif (orientation != DRM_MODE_PANEL_ORIENTATION_UNKNOWN)\n\t\treturn orientation;\n\n\torientation = dev_priv->display.vbt.orientation;\n\tif (orientation != DRM_MODE_PANEL_ORIENTATION_UNKNOWN)\n\t\treturn orientation;\n\n\treturn DRM_MODE_PANEL_ORIENTATION_NORMAL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}