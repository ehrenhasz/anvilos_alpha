{
  "module_name": "rcar_du_drv.c",
  "hash_id": "537ea180f8a0c83ac6ca86508e5e121fb429f5cec40f5e71d07f89b4cab051fa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/renesas/rcar-du/rcar_du_drv.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/dma-mapping.h>\n#include <linux/io.h>\n#include <linux/mm.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm.h>\n#include <linux/slab.h>\n#include <linux/wait.h>\n\n#include <drm/drm_atomic_helper.h>\n#include <drm/drm_drv.h>\n#include <drm/drm_fbdev_generic.h>\n#include <drm/drm_gem_dma_helper.h>\n#include <drm/drm_managed.h>\n#include <drm/drm_probe_helper.h>\n\n#include \"rcar_du_drv.h\"\n#include \"rcar_du_kms.h\"\n\n \n\nstatic const struct rcar_du_device_info rzg1_du_r8a7743_info = {\n\t.gen = 2,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(1) | BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 4,\n};\n\nstatic const struct rcar_du_device_info rzg1_du_r8a7745_info = {\n\t.gen = 2,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_DPAD1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_rpf = 4,\n};\n\nstatic const struct rcar_du_device_info rzg1_du_r8a77470_info = {\n\t.gen = 2,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_DPAD1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0) | BIT(1),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_rpf = 4,\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a774a1_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(2) | BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(2),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_HDMI0] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 5,\n\t.dpll_mask =  BIT(1),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a774b1_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(3) | BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(2),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_HDMI0] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 5,\n\t.dpll_mask =  BIT(1),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a774c0_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0) | BIT(1),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 2,\n\t.num_rpf = 4,\n\t.lvds_clk_mask =  BIT(1) | BIT(0),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a774e1_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(3) | BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(2),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_HDMI0] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 5,\n\t.dpll_mask =  BIT(1),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a7779_info = {\n\t.gen = 1,\n\t.features = RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_DPAD1] = {\n\t\t\t.possible_crtcs = BIT(1) | BIT(0),\n\t\t\t.port = 1,\n\t\t},\n\t},\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a7790_info = {\n\t.gen = 2,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.quirks = RCAR_DU_QUIRK_ALIGN_128B,\n\t.channels_mask = BIT(2) | BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(2) | BIT(1) | BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS1] = {\n\t\t\t.possible_crtcs = BIT(2) | BIT(1),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 2,\n\t.num_rpf = 4,\n};\n\n \nstatic const struct rcar_du_device_info rcar_du_r8a7791_info = {\n\t.gen = 2,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(1) | BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 4,\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a7792_info = {\n\t.gen = 2,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_DPAD1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_rpf = 4,\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a7794_info = {\n\t.gen = 2,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_DPAD1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_rpf = 4,\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a7795_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(3) | BIT(2) | BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(3),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_HDMI0] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_HDMI1] = {\n\t\t\t.possible_crtcs = BIT(2),\n\t\t\t.port = 2,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 3,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 5,\n\t.dpll_mask =  BIT(2) | BIT(1),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a7796_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(2) | BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(2),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_HDMI0] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 5,\n\t.dpll_mask =  BIT(1),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a77965_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(3) | BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(2),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_HDMI0] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 5,\n\t.dpll_mask =  BIT(1),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a77970_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_INTERLACED\n\t\t  | RCAR_DU_FEATURE_TVM_SYNC,\n\t.channels_mask = BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_lvds = 1,\n\t.num_rpf = 5,\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a7799x_info = {\n\t.gen = 3,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_CRTC_CLOCK\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DPAD0] = {\n\t\t\t.possible_crtcs = BIT(0) | BIT(1),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 1,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_LVDS1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 2,\n\t\t},\n\t},\n\t.num_lvds = 2,\n\t.num_rpf = 5,\n\t.lvds_clk_mask =  BIT(1) | BIT(0),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a779a0_info = {\n\t.gen = 4,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_NO_BLENDING,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DSI0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_DSI1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_rpf = 5,\n\t.dsi_clk_mask =  BIT(1) | BIT(0),\n};\n\nstatic const struct rcar_du_device_info rcar_du_r8a779g0_info = {\n\t.gen = 4,\n\t.features = RCAR_DU_FEATURE_CRTC_IRQ\n\t\t  | RCAR_DU_FEATURE_VSP1_SOURCE\n\t\t  | RCAR_DU_FEATURE_NO_BLENDING,\n\t.channels_mask = BIT(1) | BIT(0),\n\t.routes = {\n\t\t \n\t\t[RCAR_DU_OUTPUT_DSI0] = {\n\t\t\t.possible_crtcs = BIT(0),\n\t\t\t.port = 0,\n\t\t},\n\t\t[RCAR_DU_OUTPUT_DSI1] = {\n\t\t\t.possible_crtcs = BIT(1),\n\t\t\t.port = 1,\n\t\t},\n\t},\n\t.num_rpf = 5,\n\t.dsi_clk_mask =  BIT(1) | BIT(0),\n};\n\nstatic const struct of_device_id rcar_du_of_table[] = {\n\t{ .compatible = \"renesas,du-r8a7742\", .data = &rcar_du_r8a7790_info },\n\t{ .compatible = \"renesas,du-r8a7743\", .data = &rzg1_du_r8a7743_info },\n\t{ .compatible = \"renesas,du-r8a7744\", .data = &rzg1_du_r8a7743_info },\n\t{ .compatible = \"renesas,du-r8a7745\", .data = &rzg1_du_r8a7745_info },\n\t{ .compatible = \"renesas,du-r8a77470\", .data = &rzg1_du_r8a77470_info },\n\t{ .compatible = \"renesas,du-r8a774a1\", .data = &rcar_du_r8a774a1_info },\n\t{ .compatible = \"renesas,du-r8a774b1\", .data = &rcar_du_r8a774b1_info },\n\t{ .compatible = \"renesas,du-r8a774c0\", .data = &rcar_du_r8a774c0_info },\n\t{ .compatible = \"renesas,du-r8a774e1\", .data = &rcar_du_r8a774e1_info },\n\t{ .compatible = \"renesas,du-r8a7779\", .data = &rcar_du_r8a7779_info },\n\t{ .compatible = \"renesas,du-r8a7790\", .data = &rcar_du_r8a7790_info },\n\t{ .compatible = \"renesas,du-r8a7791\", .data = &rcar_du_r8a7791_info },\n\t{ .compatible = \"renesas,du-r8a7792\", .data = &rcar_du_r8a7792_info },\n\t{ .compatible = \"renesas,du-r8a7793\", .data = &rcar_du_r8a7791_info },\n\t{ .compatible = \"renesas,du-r8a7794\", .data = &rcar_du_r8a7794_info },\n\t{ .compatible = \"renesas,du-r8a7795\", .data = &rcar_du_r8a7795_info },\n\t{ .compatible = \"renesas,du-r8a7796\", .data = &rcar_du_r8a7796_info },\n\t{ .compatible = \"renesas,du-r8a77961\", .data = &rcar_du_r8a7796_info },\n\t{ .compatible = \"renesas,du-r8a77965\", .data = &rcar_du_r8a77965_info },\n\t{ .compatible = \"renesas,du-r8a77970\", .data = &rcar_du_r8a77970_info },\n\t{ .compatible = \"renesas,du-r8a77980\", .data = &rcar_du_r8a77970_info },\n\t{ .compatible = \"renesas,du-r8a77990\", .data = &rcar_du_r8a7799x_info },\n\t{ .compatible = \"renesas,du-r8a77995\", .data = &rcar_du_r8a7799x_info },\n\t{ .compatible = \"renesas,du-r8a779a0\", .data = &rcar_du_r8a779a0_info },\n\t{ .compatible = \"renesas,du-r8a779g0\", .data = &rcar_du_r8a779g0_info },\n\t{ }\n};\n\nMODULE_DEVICE_TABLE(of, rcar_du_of_table);\n\nconst char *rcar_du_output_name(enum rcar_du_output output)\n{\n\tstatic const char * const names[] = {\n\t\t[RCAR_DU_OUTPUT_DPAD0] = \"DPAD0\",\n\t\t[RCAR_DU_OUTPUT_DPAD1] = \"DPAD1\",\n\t\t[RCAR_DU_OUTPUT_DSI0] = \"DSI0\",\n\t\t[RCAR_DU_OUTPUT_DSI1] = \"DSI1\",\n\t\t[RCAR_DU_OUTPUT_HDMI0] = \"HDMI0\",\n\t\t[RCAR_DU_OUTPUT_HDMI1] = \"HDMI1\",\n\t\t[RCAR_DU_OUTPUT_LVDS0] = \"LVDS0\",\n\t\t[RCAR_DU_OUTPUT_LVDS1] = \"LVDS1\",\n\t\t[RCAR_DU_OUTPUT_TCON] = \"TCON\",\n\t};\n\n\tif (output >= ARRAY_SIZE(names) || !names[output])\n\t\treturn \"UNKNOWN\";\n\n\treturn names[output];\n}\n\n \n\nDEFINE_DRM_GEM_DMA_FOPS(rcar_du_fops);\n\nstatic const struct drm_driver rcar_du_driver = {\n\t.driver_features\t= DRIVER_GEM | DRIVER_MODESET | DRIVER_ATOMIC,\n\t.dumb_create\t\t= rcar_du_dumb_create,\n\t.gem_prime_import_sg_table = rcar_du_gem_prime_import_sg_table,\n\t.fops\t\t\t= &rcar_du_fops,\n\t.name\t\t\t= \"rcar-du\",\n\t.desc\t\t\t= \"Renesas R-Car Display Unit\",\n\t.date\t\t\t= \"20130110\",\n\t.major\t\t\t= 1,\n\t.minor\t\t\t= 0,\n};\n\n \n\nstatic int rcar_du_pm_suspend(struct device *dev)\n{\n\tstruct rcar_du_device *rcdu = dev_get_drvdata(dev);\n\n\treturn drm_mode_config_helper_suspend(&rcdu->ddev);\n}\n\nstatic int rcar_du_pm_resume(struct device *dev)\n{\n\tstruct rcar_du_device *rcdu = dev_get_drvdata(dev);\n\n\treturn drm_mode_config_helper_resume(&rcdu->ddev);\n}\n\nstatic DEFINE_SIMPLE_DEV_PM_OPS(rcar_du_pm_ops,\n\t\t\t\trcar_du_pm_suspend, rcar_du_pm_resume);\n\n \n\nstatic void rcar_du_remove(struct platform_device *pdev)\n{\n\tstruct rcar_du_device *rcdu = platform_get_drvdata(pdev);\n\tstruct drm_device *ddev = &rcdu->ddev;\n\n\tdrm_dev_unregister(ddev);\n\tdrm_atomic_helper_shutdown(ddev);\n\n\tdrm_kms_helper_poll_fini(ddev);\n}\n\nstatic void rcar_du_shutdown(struct platform_device *pdev)\n{\n\tstruct rcar_du_device *rcdu = platform_get_drvdata(pdev);\n\n\tdrm_atomic_helper_shutdown(&rcdu->ddev);\n}\n\nstatic int rcar_du_probe(struct platform_device *pdev)\n{\n\tstruct rcar_du_device *rcdu;\n\tunsigned int mask;\n\tint ret;\n\n\tif (drm_firmware_drivers_only())\n\t\treturn -ENODEV;\n\n\t \n\trcdu = devm_drm_dev_alloc(&pdev->dev, &rcar_du_driver,\n\t\t\t\t  struct rcar_du_device, ddev);\n\tif (IS_ERR(rcdu))\n\t\treturn PTR_ERR(rcdu);\n\n\trcdu->dev = &pdev->dev;\n\n\trcdu->info = of_device_get_match_data(rcdu->dev);\n\n\tplatform_set_drvdata(pdev, rcdu);\n\n\t \n\trcdu->mmio = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(rcdu->mmio))\n\t\treturn PTR_ERR(rcdu->mmio);\n\n\t \n\tmask = rcar_du_has(rcdu, RCAR_DU_FEATURE_VSP1_SOURCE) ? 40 : 32;\n\tret = dma_coerce_mask_and_coherent(&pdev->dev, DMA_BIT_MASK(mask));\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = rcar_du_modeset_init(rcdu);\n\tif (ret < 0) {\n\t\t \n\t\tif (ret != -EPROBE_DEFER)\n\t\t\tdev_err(&pdev->dev,\n\t\t\t\t\"failed to initialize DRM/KMS (%d)\\n\", ret);\n\t\tgoto error;\n\t}\n\n\t \n\tret = drm_dev_register(&rcdu->ddev, 0);\n\tif (ret)\n\t\tgoto error;\n\n\tdrm_info(&rcdu->ddev, \"Device %s probed\\n\", dev_name(&pdev->dev));\n\n\tdrm_fbdev_generic_setup(&rcdu->ddev, 32);\n\n\treturn 0;\n\nerror:\n\tdrm_kms_helper_poll_fini(&rcdu->ddev);\n\treturn ret;\n}\n\nstatic struct platform_driver rcar_du_platform_driver = {\n\t.probe\t\t= rcar_du_probe,\n\t.remove_new\t= rcar_du_remove,\n\t.shutdown\t= rcar_du_shutdown,\n\t.driver\t\t= {\n\t\t.name\t= \"rcar-du\",\n\t\t.pm\t= pm_sleep_ptr(&rcar_du_pm_ops),\n\t\t.of_match_table = rcar_du_of_table,\n\t},\n};\n\nmodule_platform_driver(rcar_du_platform_driver);\n\nMODULE_AUTHOR(\"Laurent Pinchart <laurent.pinchart@ideasonboard.com>\");\nMODULE_DESCRIPTION(\"Renesas R-Car Display Unit DRM Driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}