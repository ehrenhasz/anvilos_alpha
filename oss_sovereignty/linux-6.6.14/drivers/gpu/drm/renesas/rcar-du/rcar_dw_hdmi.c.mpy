{
  "module_name": "rcar_dw_hdmi.c",
  "hash_id": "0ecb9125a07d3fb32ef6090a96053931d49970cb235b74964bec97d29c2fd01d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/renesas/rcar-du/rcar_dw_hdmi.c",
  "human_readable_source": "\n \n\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <drm/bridge/dw_hdmi.h>\n#include <drm/drm_modes.h>\n\n#define RCAR_HDMI_PHY_OPMODE_PLLCFG\t0x06\t \n#define RCAR_HDMI_PHY_PLLCURRGMPCTRL\t0x10\t \n#define RCAR_HDMI_PHY_PLLDIVCTRL\t0x11\t \n\nstruct rcar_hdmi_phy_params {\n\tunsigned long mpixelclock;\n\tu16 opmode_div;\t \n\tu16 curr_gmp;\t \n\tu16 div;\t \n};\n\nstatic const struct rcar_hdmi_phy_params rcar_hdmi_phy_params[] = {\n\t{ 35500000,  0x0003, 0x0344, 0x0328 },\n\t{ 44900000,  0x0003, 0x0285, 0x0128 },\n\t{ 71000000,  0x0002, 0x1184, 0x0314 },\n\t{ 90000000,  0x0002, 0x1144, 0x0114 },\n\t{ 140250000, 0x0001, 0x20c4, 0x030a },\n\t{ 182750000, 0x0001, 0x2084, 0x010a },\n\t{ 281250000, 0x0000, 0x0084, 0x0305 },\n\t{ 297000000, 0x0000, 0x0084, 0x0105 },\n\t{ ~0UL,      0x0000, 0x0000, 0x0000 },\n};\n\nstatic enum drm_mode_status\nrcar_hdmi_mode_valid(struct dw_hdmi *hdmi, void *data,\n\t\t     const struct drm_display_info *info,\n\t\t     const struct drm_display_mode *mode)\n{\n\t \n\tif (mode->clock > 297000)\n\t\treturn MODE_CLOCK_HIGH;\n\n\treturn MODE_OK;\n}\n\nstatic int rcar_hdmi_phy_configure(struct dw_hdmi *hdmi, void *data,\n\t\t\t\t   unsigned long mpixelclock)\n{\n\tconst struct rcar_hdmi_phy_params *params = rcar_hdmi_phy_params;\n\n\tfor (; params->mpixelclock != ~0UL; ++params) {\n\t\tif (mpixelclock <= params->mpixelclock)\n\t\t\tbreak;\n\t}\n\n\tif (params->mpixelclock == ~0UL)\n\t\treturn -EINVAL;\n\n\tdw_hdmi_phy_i2c_write(hdmi, params->opmode_div,\n\t\t\t      RCAR_HDMI_PHY_OPMODE_PLLCFG);\n\tdw_hdmi_phy_i2c_write(hdmi, params->curr_gmp,\n\t\t\t      RCAR_HDMI_PHY_PLLCURRGMPCTRL);\n\tdw_hdmi_phy_i2c_write(hdmi, params->div, RCAR_HDMI_PHY_PLLDIVCTRL);\n\n\treturn 0;\n}\n\nstatic const struct dw_hdmi_plat_data rcar_dw_hdmi_plat_data = {\n\t.output_port = 1,\n\t.mode_valid = rcar_hdmi_mode_valid,\n\t.configure_phy\t= rcar_hdmi_phy_configure,\n};\n\nstatic int rcar_dw_hdmi_probe(struct platform_device *pdev)\n{\n\tstruct dw_hdmi *hdmi;\n\n\thdmi = dw_hdmi_probe(pdev, &rcar_dw_hdmi_plat_data);\n\tif (IS_ERR(hdmi))\n\t\treturn PTR_ERR(hdmi);\n\n\tplatform_set_drvdata(pdev, hdmi);\n\n\treturn 0;\n}\n\nstatic void rcar_dw_hdmi_remove(struct platform_device *pdev)\n{\n\tstruct dw_hdmi *hdmi = platform_get_drvdata(pdev);\n\n\tdw_hdmi_remove(hdmi);\n}\n\nstatic const struct of_device_id rcar_dw_hdmi_of_table[] = {\n\t{ .compatible = \"renesas,rcar-gen3-hdmi\" },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, rcar_dw_hdmi_of_table);\n\nstatic struct platform_driver rcar_dw_hdmi_platform_driver = {\n\t.probe\t\t= rcar_dw_hdmi_probe,\n\t.remove_new\t= rcar_dw_hdmi_remove,\n\t.driver\t\t= {\n\t\t.name\t= \"rcar-dw-hdmi\",\n\t\t.of_match_table = rcar_dw_hdmi_of_table,\n\t},\n};\n\nmodule_platform_driver(rcar_dw_hdmi_platform_driver);\n\nMODULE_AUTHOR(\"Laurent Pinchart <laurent.pinchart@ideasonboard.com>\");\nMODULE_DESCRIPTION(\"Renesas R-Car Gen3 HDMI Encoder Driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}