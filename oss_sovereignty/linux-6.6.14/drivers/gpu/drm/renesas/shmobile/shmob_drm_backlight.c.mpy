{
  "module_name": "shmob_drm_backlight.c",
  "hash_id": "86fd123db4d57197fc8630b329b1000be201658b80f929a5653178be57d11e5c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/renesas/shmobile/shmob_drm_backlight.c",
  "human_readable_source": "\n \n\n#include <linux/backlight.h>\n\n#include \"shmob_drm_backlight.h\"\n#include \"shmob_drm_crtc.h\"\n#include \"shmob_drm_drv.h\"\n\nstatic int shmob_drm_backlight_update(struct backlight_device *bdev)\n{\n\tstruct shmob_drm_connector *scon = bl_get_data(bdev);\n\tstruct shmob_drm_device *sdev = scon->connector.dev->dev_private;\n\tconst struct shmob_drm_backlight_data *bdata = &sdev->pdata->backlight;\n\tint brightness = backlight_get_brightness(bdev);\n\n\treturn bdata->set_brightness(brightness);\n}\n\nstatic int shmob_drm_backlight_get_brightness(struct backlight_device *bdev)\n{\n\tstruct shmob_drm_connector *scon = bl_get_data(bdev);\n\tstruct shmob_drm_device *sdev = scon->connector.dev->dev_private;\n\tconst struct shmob_drm_backlight_data *bdata = &sdev->pdata->backlight;\n\n\treturn bdata->get_brightness();\n}\n\nstatic const struct backlight_ops shmob_drm_backlight_ops = {\n\t.options\t= BL_CORE_SUSPENDRESUME,\n\t.update_status\t= shmob_drm_backlight_update,\n\t.get_brightness\t= shmob_drm_backlight_get_brightness,\n};\n\nvoid shmob_drm_backlight_dpms(struct shmob_drm_connector *scon, int mode)\n{\n\tif (scon->backlight == NULL)\n\t\treturn;\n\n\tscon->backlight->props.power = mode == DRM_MODE_DPMS_ON\n\t\t\t\t     ? FB_BLANK_UNBLANK : FB_BLANK_POWERDOWN;\n\tbacklight_update_status(scon->backlight);\n}\n\nint shmob_drm_backlight_init(struct shmob_drm_connector *scon)\n{\n\tstruct shmob_drm_device *sdev = scon->connector.dev->dev_private;\n\tconst struct shmob_drm_backlight_data *bdata = &sdev->pdata->backlight;\n\tstruct drm_connector *connector = &scon->connector;\n\tstruct drm_device *dev = connector->dev;\n\tstruct backlight_device *backlight;\n\n\tif (!bdata->max_brightness)\n\t\treturn 0;\n\n\tbacklight = backlight_device_register(bdata->name, dev->dev, scon,\n\t\t\t\t\t      &shmob_drm_backlight_ops, NULL);\n\tif (IS_ERR(backlight)) {\n\t\tdev_err(dev->dev, \"unable to register backlight device: %ld\\n\",\n\t\t\tPTR_ERR(backlight));\n\t\treturn PTR_ERR(backlight);\n\t}\n\n\tbacklight->props.max_brightness = bdata->max_brightness;\n\tbacklight->props.brightness = bdata->max_brightness;\n\tbacklight->props.power = FB_BLANK_POWERDOWN;\n\tbacklight_update_status(backlight);\n\n\tscon->backlight = backlight;\n\treturn 0;\n}\n\nvoid shmob_drm_backlight_exit(struct shmob_drm_connector *scon)\n{\n\tbacklight_device_unregister(scon->backlight);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}