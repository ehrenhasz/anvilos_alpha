{
  "module_name": "ast_drv.h",
  "hash_id": "987aac3a630c025d96231ec43c3422ca60cfafdb8c1e69e372880508b93c6f9b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/ast/ast_drv.h",
  "human_readable_source": " \n \n#ifndef __AST_DRV_H__\n#define __AST_DRV_H__\n\n#include <linux/i2c.h>\n#include <linux/i2c-algo-bit.h>\n#include <linux/io.h>\n#include <linux/types.h>\n\n#include <drm/drm_connector.h>\n#include <drm/drm_crtc.h>\n#include <drm/drm_encoder.h>\n#include <drm/drm_mode.h>\n#include <drm/drm_framebuffer.h>\n\n#define DRIVER_AUTHOR\t\t\"Dave Airlie\"\n\n#define DRIVER_NAME\t\t\"ast\"\n#define DRIVER_DESC\t\t\"AST\"\n#define DRIVER_DATE\t\t\"20120228\"\n\n#define DRIVER_MAJOR\t\t0\n#define DRIVER_MINOR\t\t1\n#define DRIVER_PATCHLEVEL\t0\n\n#define PCI_CHIP_AST2000 0x2000\n#define PCI_CHIP_AST2100 0x2010\n\n#define __AST_CHIP(__gen, __index)\t((__gen) << 16 | (__index))\n\nenum ast_chip {\n\t \n\tAST1000 = __AST_CHIP(1, 0), \n\tAST2000 = __AST_CHIP(1, 1),\n\t \n\tAST1100 = __AST_CHIP(2, 0),\n\tAST2100 = __AST_CHIP(2, 1),\n\tAST2050 = __AST_CHIP(2, 2), \n\t \n\tAST2200 = __AST_CHIP(3, 0),\n\tAST2150 = __AST_CHIP(3, 1),\n\t \n\tAST2300 = __AST_CHIP(4, 0),\n\tAST1300 = __AST_CHIP(4, 1),\n\tAST1050 = __AST_CHIP(4, 2), \n\t \n\tAST2400 = __AST_CHIP(5, 0),\n\tAST1400 = __AST_CHIP(5, 1),\n\tAST1250 = __AST_CHIP(5, 2), \n\t \n\tAST2500 = __AST_CHIP(6, 0),\n\tAST2510 = __AST_CHIP(6, 1),\n\tAST2520 = __AST_CHIP(6, 2), \n\t \n\tAST2600 = __AST_CHIP(7, 0),\n\tAST2620 = __AST_CHIP(7, 1), \n};\n\n#define __AST_CHIP_GEN(__chip)\t(((unsigned long)(__chip)) >> 16)\n\nenum ast_tx_chip {\n\tAST_TX_NONE,\n\tAST_TX_SIL164,\n\tAST_TX_DP501,\n\tAST_TX_ASTDP,\n};\n\n#define AST_TX_NONE_BIT\t\tBIT(AST_TX_NONE)\n#define AST_TX_SIL164_BIT\tBIT(AST_TX_SIL164)\n#define AST_TX_DP501_BIT\tBIT(AST_TX_DP501)\n#define AST_TX_ASTDP_BIT\tBIT(AST_TX_ASTDP)\n\n#define AST_DRAM_512Mx16 0\n#define AST_DRAM_1Gx16   1\n#define AST_DRAM_512Mx32 2\n#define AST_DRAM_1Gx32   3\n#define AST_DRAM_2Gx16   6\n#define AST_DRAM_4Gx16   7\n#define AST_DRAM_8Gx16   8\n\n \n\n#define AST_MAX_HWC_WIDTH\t64\n#define AST_MAX_HWC_HEIGHT\t64\n\n#define AST_HWC_SIZE\t\t(AST_MAX_HWC_WIDTH * AST_MAX_HWC_HEIGHT * 2)\n#define AST_HWC_SIGNATURE_SIZE\t32\n\n \n#define AST_HWC_SIGNATURE_CHECKSUM\t0x00\n#define AST_HWC_SIGNATURE_SizeX\t\t0x04\n#define AST_HWC_SIGNATURE_SizeY\t\t0x08\n#define AST_HWC_SIGNATURE_X\t\t0x0C\n#define AST_HWC_SIGNATURE_Y\t\t0x10\n#define AST_HWC_SIGNATURE_HOTSPOTX\t0x14\n#define AST_HWC_SIGNATURE_HOTSPOTY\t0x18\n\n \n\nstruct ast_plane {\n\tstruct drm_plane base;\n\n\tvoid __iomem *vaddr;\n\tu64 offset;\n\tunsigned long size;\n};\n\nstatic inline struct ast_plane *to_ast_plane(struct drm_plane *plane)\n{\n\treturn container_of(plane, struct ast_plane, base);\n}\n\n \n\nstruct ast_i2c_chan {\n\tstruct i2c_adapter adapter;\n\tstruct drm_device *dev;\n\tstruct i2c_algo_bit_data bit;\n};\n\nstruct ast_vga_connector {\n\tstruct drm_connector base;\n\tstruct ast_i2c_chan *i2c;\n};\n\nstatic inline struct ast_vga_connector *\nto_ast_vga_connector(struct drm_connector *connector)\n{\n\treturn container_of(connector, struct ast_vga_connector, base);\n}\n\nstruct ast_sil164_connector {\n\tstruct drm_connector base;\n\tstruct ast_i2c_chan *i2c;\n};\n\nstatic inline struct ast_sil164_connector *\nto_ast_sil164_connector(struct drm_connector *connector)\n{\n\treturn container_of(connector, struct ast_sil164_connector, base);\n}\n\nstruct ast_bmc_connector {\n\tstruct drm_connector base;\n\tstruct drm_connector *physical_connector;\n};\n\nstatic inline struct ast_bmc_connector *\nto_ast_bmc_connector(struct drm_connector *connector)\n{\n\treturn container_of(connector, struct ast_bmc_connector, base);\n}\n\n \n\nstruct ast_device {\n\tstruct drm_device base;\n\n\tstruct mutex ioregs_lock;  \n\tvoid __iomem *regs;\n\tvoid __iomem *ioregs;\n\tvoid __iomem *dp501_fw_buf;\n\n\tenum ast_chip chip;\n\tuint32_t dram_bus_width;\n\tuint32_t dram_type;\n\tuint32_t mclk;\n\n\tvoid __iomem\t*vram;\n\tunsigned long\tvram_base;\n\tunsigned long\tvram_size;\n\tunsigned long\tvram_fb_available;\n\n\tstruct ast_plane primary_plane;\n\tstruct ast_plane cursor_plane;\n\tstruct drm_crtc crtc;\n\tstruct {\n\t\tstruct {\n\t\t\tstruct drm_encoder encoder;\n\t\t\tstruct ast_vga_connector vga_connector;\n\t\t} vga;\n\t\tstruct {\n\t\t\tstruct drm_encoder encoder;\n\t\t\tstruct ast_sil164_connector sil164_connector;\n\t\t} sil164;\n\t\tstruct {\n\t\t\tstruct drm_encoder encoder;\n\t\t\tstruct drm_connector connector;\n\t\t} dp501;\n\t\tstruct {\n\t\t\tstruct drm_encoder encoder;\n\t\t\tstruct drm_connector connector;\n\t\t} astdp;\n\t\tstruct {\n\t\t\tstruct drm_encoder encoder;\n\t\t\tstruct ast_bmc_connector bmc_connector;\n\t\t} bmc;\n\t} output;\n\n\tbool support_wide_screen;\n\tenum {\n\t\tast_use_p2a,\n\t\tast_use_dt,\n\t\tast_use_defaults\n\t} config_mode;\n\n\tunsigned long tx_chip_types;\t\t \n\tu8 *dp501_fw_addr;\n\tconst struct firmware *dp501_fw;\t \n};\n\nstatic inline struct ast_device *to_ast_device(struct drm_device *dev)\n{\n\treturn container_of(dev, struct ast_device, base);\n}\n\nstruct ast_device *ast_device_create(const struct drm_driver *drv,\n\t\t\t\t     struct pci_dev *pdev,\n\t\t\t\t     unsigned long flags);\n\nstatic inline unsigned long __ast_gen(struct ast_device *ast)\n{\n\treturn __AST_CHIP_GEN(ast->chip);\n}\n#define AST_GEN(__ast)\t__ast_gen(__ast)\n\nstatic inline bool __ast_gen_is_eq(struct ast_device *ast, unsigned long gen)\n{\n\treturn __ast_gen(ast) == gen;\n}\n#define IS_AST_GEN1(__ast)\t__ast_gen_is_eq(__ast, 1)\n#define IS_AST_GEN2(__ast)\t__ast_gen_is_eq(__ast, 2)\n#define IS_AST_GEN3(__ast)\t__ast_gen_is_eq(__ast, 3)\n#define IS_AST_GEN4(__ast)\t__ast_gen_is_eq(__ast, 4)\n#define IS_AST_GEN5(__ast)\t__ast_gen_is_eq(__ast, 5)\n#define IS_AST_GEN6(__ast)\t__ast_gen_is_eq(__ast, 6)\n#define IS_AST_GEN7(__ast)\t__ast_gen_is_eq(__ast, 7)\n\n#define AST_IO_AR_PORT_WRITE\t\t(0x40)\n#define AST_IO_MISC_PORT_WRITE\t\t(0x42)\n#define AST_IO_VGA_ENABLE_PORT\t\t(0x43)\n#define AST_IO_SEQ_PORT\t\t\t(0x44)\n#define AST_IO_DAC_INDEX_READ\t\t(0x47)\n#define AST_IO_DAC_INDEX_WRITE\t\t(0x48)\n#define AST_IO_DAC_DATA\t\t        (0x49)\n#define AST_IO_GR_PORT\t\t\t(0x4E)\n#define AST_IO_CRTC_PORT\t\t(0x54)\n#define AST_IO_INPUT_STATUS1_READ\t(0x5A)\n#define AST_IO_MISC_PORT_READ\t\t(0x4C)\n\n#define AST_IO_MM_OFFSET\t\t(0x380)\n\n#define AST_IO_VGAIR1_VREFRESH\t\tBIT(3)\n\n#define AST_IO_VGACRCB_HWC_ENABLED     BIT(1)\n#define AST_IO_VGACRCB_HWC_16BPP       BIT(0)  \n\nstatic inline u32 ast_read32(struct ast_device *ast, u32 reg)\n{\n\treturn ioread32(ast->regs + reg);\n}\n\nstatic inline void ast_write32(struct ast_device *ast, u32 reg, u32 val)\n{\n\tiowrite32(val, ast->regs + reg);\n}\n\nstatic inline u8 ast_io_read8(struct ast_device *ast, u32 reg)\n{\n\treturn ioread8(ast->ioregs + reg);\n}\n\nstatic inline void ast_io_write8(struct ast_device *ast, u32 reg, u8 val)\n{\n\tiowrite8(val, ast->ioregs + reg);\n}\n\nstatic inline u8 ast_get_index_reg(struct ast_device *ast, u32 base, u8 index)\n{\n\tast_io_write8(ast, base, index);\n\t++base;\n\treturn ast_io_read8(ast, base);\n}\n\nstatic inline u8 ast_get_index_reg_mask(struct ast_device *ast, u32 base, u8 index,\n\t\t\t\t\tu8 preserve_mask)\n{\n\tu8 val = ast_get_index_reg(ast, base, index);\n\n\treturn val & preserve_mask;\n}\n\nstatic inline void ast_set_index_reg(struct ast_device *ast, u32 base, u8 index, u8 val)\n{\n\tast_io_write8(ast, base, index);\n\t++base;\n\tast_io_write8(ast, base, val);\n}\n\nstatic inline void ast_set_index_reg_mask(struct ast_device *ast, u32 base, u8 index,\n\t\t\t\t\t  u8 preserve_mask, u8 val)\n{\n\tu8 tmp = ast_get_index_reg_mask(ast, base, index, preserve_mask);\n\n\ttmp |= val;\n\tast_set_index_reg(ast, base, index, tmp);\n}\n\n#define AST_VIDMEM_SIZE_8M    0x00800000\n#define AST_VIDMEM_SIZE_16M   0x01000000\n#define AST_VIDMEM_SIZE_32M   0x02000000\n#define AST_VIDMEM_SIZE_64M   0x04000000\n#define AST_VIDMEM_SIZE_128M  0x08000000\n\n#define AST_VIDMEM_DEFAULT_SIZE AST_VIDMEM_SIZE_8M\n\nstruct ast_vbios_stdtable {\n\tu8 misc;\n\tu8 seq[4];\n\tu8 crtc[25];\n\tu8 ar[20];\n\tu8 gr[9];\n};\n\nstruct ast_vbios_enhtable {\n\tu32 ht;\n\tu32 hde;\n\tu32 hfp;\n\tu32 hsync;\n\tu32 vt;\n\tu32 vde;\n\tu32 vfp;\n\tu32 vsync;\n\tu32 dclk_index;\n\tu32 flags;\n\tu32 refresh_rate;\n\tu32 refresh_rate_index;\n\tu32 mode_id;\n};\n\nstruct ast_vbios_dclk_info {\n\tu8 param1;\n\tu8 param2;\n\tu8 param3;\n};\n\nstruct ast_vbios_mode_info {\n\tconst struct ast_vbios_stdtable *std_table;\n\tconst struct ast_vbios_enhtable *enh_table;\n};\n\nstruct ast_crtc_state {\n\tstruct drm_crtc_state base;\n\n\t \n\tconst struct drm_format_info *format;\n\n\tstruct ast_vbios_mode_info vbios_mode_info;\n};\n\n#define to_ast_crtc_state(state) container_of(state, struct ast_crtc_state, base)\n\nint ast_mode_config_init(struct ast_device *ast);\n\n#define AST_MM_ALIGN_SHIFT 4\n#define AST_MM_ALIGN_MASK ((1 << AST_MM_ALIGN_SHIFT) - 1)\n\n#define AST_DP501_FW_VERSION_MASK\tGENMASK(7, 4)\n#define AST_DP501_FW_VERSION_1\t\tBIT(4)\n#define AST_DP501_PNP_CONNECTED\t\tBIT(1)\n\n#define AST_DP501_DEFAULT_DCLK\t65\n\n#define AST_DP501_GBL_VERSION\t0xf000\n#define AST_DP501_PNPMONITOR\t0xf010\n#define AST_DP501_LINKRATE\t0xf014\n#define AST_DP501_EDID_DATA\t0xf020\n\n \n#define TX_TYPE_MASK\t\t\t\tGENMASK(3, 1)\n#define NO_TX\t\t\t\t\t\t(0 << 1)\n#define ITE66121_VBIOS_TX\t\t\t(1 << 1)\n#define SI164_VBIOS_TX\t\t\t\t(2 << 1)\n#define CH7003_VBIOS_TX\t\t\t(3 << 1)\n#define DP501_VBIOS_TX\t\t\t\t(4 << 1)\n#define ANX9807_VBIOS_TX\t\t\t(5 << 1)\n#define TX_FW_EMBEDDED_FW_TX\t\t(6 << 1)\n#define ASTDP_DPMCU_TX\t\t\t\t(7 << 1)\n\n#define AST_VRAM_INIT_STATUS_MASK\tGENMASK(7, 6)\n\n\n\n \n#define AST_DP_PHY_SLEEP\t\t\tBIT(4)\n#define AST_DP_VIDEO_ENABLE\t\tBIT(0)\n\n#define AST_DP_POWER_ON\t\t\ttrue\n#define AST_DP_POWER_OFF\t\t\tfalse\n\n \n#define ASTDP_MCU_FW_EXECUTING\t\t\tBIT(5)\n#define ASTDP_LINK_SUCCESS\t\t\t\tBIT(0)\n#define ASTDP_HPD\t\t\t\t\t\tBIT(0)\n#define ASTDP_HOST_EDID_READ_DONE\t\tBIT(0)\n#define ASTDP_HOST_EDID_READ_DONE_MASK\tGENMASK(0, 0)\n\n \n#define AST_DPMS_VSYNC_OFF\t\t\t\tBIT(1)\n#define AST_DPMS_HSYNC_OFF\t\t\t\tBIT(0)\n\n \n#define ASTDP_MIRROR_VIDEO_ENABLE\t\tBIT(4)\n\n#define ASTDP_EDID_READ_POINTER_MASK\tGENMASK(7, 0)\n#define ASTDP_EDID_VALID_FLAG_MASK\t\tGENMASK(0, 0)\n#define ASTDP_EDID_READ_DATA_MASK\t\tGENMASK(7, 0)\n\n \n#define ASTDP_MISC0_24bpp\t\t\tBIT(5)\n#define ASTDP_MISC1\t\t\t\t0\n#define ASTDP_AND_CLEAR_MASK\t\t0x00\n\n \n#define ASTDP_640x480_60\t\t0x00\n#define ASTDP_640x480_72\t\t0x01\n#define ASTDP_640x480_75\t\t0x02\n#define ASTDP_640x480_85\t\t0x03\n#define ASTDP_800x600_56\t\t0x04\n#define ASTDP_800x600_60\t\t0x05\n#define ASTDP_800x600_72\t\t0x06\n#define ASTDP_800x600_75\t\t0x07\n#define ASTDP_800x600_85\t\t0x08\n#define ASTDP_1024x768_60\t\t0x09\n#define ASTDP_1024x768_70\t\t0x0A\n#define ASTDP_1024x768_75\t\t0x0B\n#define ASTDP_1024x768_85\t\t0x0C\n#define ASTDP_1280x1024_60\t\t0x0D\n#define ASTDP_1280x1024_75\t\t0x0E\n#define ASTDP_1280x1024_85\t\t0x0F\n#define ASTDP_1600x1200_60\t\t0x10\n#define ASTDP_320x240_60\t\t0x11\n#define ASTDP_400x300_60\t\t0x12\n#define ASTDP_512x384_60\t\t0x13\n#define ASTDP_1920x1200_60\t\t0x14\n#define ASTDP_1920x1080_60\t\t0x15\n#define ASTDP_1280x800_60\t\t0x16\n#define ASTDP_1280x800_60_RB\t0x17\n#define ASTDP_1440x900_60\t\t0x18\n#define ASTDP_1440x900_60_RB\t0x19\n#define ASTDP_1680x1050_60\t\t0x1A\n#define ASTDP_1680x1050_60_RB\t0x1B\n#define ASTDP_1600x900_60\t\t0x1C\n#define ASTDP_1600x900_60_RB\t0x1D\n#define ASTDP_1366x768_60\t\t0x1E\n#define ASTDP_1152x864_75\t\t0x1F\n\nint ast_mm_init(struct ast_device *ast);\n\n \nvoid ast_post_gpu(struct drm_device *dev);\nu32 ast_mindwm(struct ast_device *ast, u32 r);\nvoid ast_moutdwm(struct ast_device *ast, u32 r, u32 v);\nvoid ast_patch_ahb_2500(struct ast_device *ast);\n \nvoid ast_set_dp501_video_output(struct drm_device *dev, u8 mode);\nbool ast_backup_fw(struct drm_device *dev, u8 *addr, u32 size);\nbool ast_dp501_is_connected(struct ast_device *ast);\nbool ast_dp501_read_edid(struct drm_device *dev, u8 *ediddata);\nu8 ast_get_dp501_max_clk(struct drm_device *dev);\nvoid ast_init_3rdtx(struct drm_device *dev);\n\n \nstruct ast_i2c_chan *ast_i2c_create(struct drm_device *dev);\n\n \nbool ast_astdp_is_connected(struct ast_device *ast);\nint ast_astdp_read_edid(struct drm_device *dev, u8 *ediddata);\nvoid ast_dp_launch(struct drm_device *dev);\nvoid ast_dp_power_on_off(struct drm_device *dev, bool no);\nvoid ast_dp_set_on_off(struct drm_device *dev, bool no);\nvoid ast_dp_set_mode(struct drm_crtc *crtc, struct ast_vbios_mode_info *vbios_mode);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}