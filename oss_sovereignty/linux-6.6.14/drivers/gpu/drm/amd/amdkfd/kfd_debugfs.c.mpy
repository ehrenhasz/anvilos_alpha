{
  "module_name": "kfd_debugfs.c",
  "hash_id": "754130d9d3e4e7c4631c87bcdde092a4e2f1ba45b2ff42eff0b22c2f2ae4d52d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdkfd/kfd_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/uaccess.h>\n\n#include \"kfd_priv.h\"\n\nstatic struct dentry *debugfs_root;\n\nstatic int kfd_debugfs_open(struct inode *inode, struct file *file)\n{\n\tint (*show)(struct seq_file *, void *) = inode->i_private;\n\n\treturn single_open(file, show, NULL);\n}\nstatic int kfd_debugfs_hang_hws_read(struct seq_file *m, void *data)\n{\n\tseq_puts(m, \"echo gpu_id > hang_hws\\n\");\n\treturn 0;\n}\n\nstatic ssize_t kfd_debugfs_hang_hws_write(struct file *file,\n\tconst char __user *user_buf, size_t size, loff_t *ppos)\n{\n\tstruct kfd_node *dev;\n\tchar tmp[16];\n\tuint32_t gpu_id;\n\tint ret = -EINVAL;\n\n\tmemset(tmp, 0, 16);\n\tif (size >= 16) {\n\t\tpr_err(\"Invalid input for gpu id.\\n\");\n\t\tgoto out;\n\t}\n\tif (copy_from_user(tmp, user_buf, size)) {\n\t\tret = -EFAULT;\n\t\tgoto out;\n\t}\n\tif (kstrtoint(tmp, 10, &gpu_id)) {\n\t\tpr_err(\"Invalid input for gpu id.\\n\");\n\t\tgoto out;\n\t}\n\tdev = kfd_device_by_id(gpu_id);\n\tif (dev) {\n\t\tkfd_debugfs_hang_hws(dev);\n\t\tret = size;\n\t} else\n\t\tpr_err(\"Cannot find device %d.\\n\", gpu_id);\n\nout:\n\treturn ret;\n}\n\nstatic const struct file_operations kfd_debugfs_fops = {\n\t.owner = THIS_MODULE,\n\t.open = kfd_debugfs_open,\n\t.read = seq_read,\n\t.llseek = seq_lseek,\n\t.release = single_release,\n};\n\nstatic const struct file_operations kfd_debugfs_hang_hws_fops = {\n\t.owner = THIS_MODULE,\n\t.open = kfd_debugfs_open,\n\t.read = seq_read,\n\t.write = kfd_debugfs_hang_hws_write,\n\t.llseek = seq_lseek,\n\t.release = single_release,\n};\n\nvoid kfd_debugfs_init(void)\n{\n\tdebugfs_root = debugfs_create_dir(\"kfd\", NULL);\n\n\tdebugfs_create_file(\"mqds\", S_IFREG | 0444, debugfs_root,\n\t\t\t    kfd_debugfs_mqds_by_process, &kfd_debugfs_fops);\n\tdebugfs_create_file(\"hqds\", S_IFREG | 0444, debugfs_root,\n\t\t\t    kfd_debugfs_hqds_by_device, &kfd_debugfs_fops);\n\tdebugfs_create_file(\"rls\", S_IFREG | 0444, debugfs_root,\n\t\t\t    kfd_debugfs_rls_by_device, &kfd_debugfs_fops);\n\tdebugfs_create_file(\"hang_hws\", S_IFREG | 0200, debugfs_root,\n\t\t\t    kfd_debugfs_hang_hws_read, &kfd_debugfs_hang_hws_fops);\n\tdebugfs_create_file(\"mem_limit\", S_IFREG | 0200, debugfs_root,\n\t\t\t    kfd_debugfs_kfd_mem_limits, &kfd_debugfs_fops);\n}\n\nvoid kfd_debugfs_fini(void)\n{\n\tdebugfs_remove_recursive(debugfs_root);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}