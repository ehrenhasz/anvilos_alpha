{
  "module_name": "kfd_device_queue_manager_v9.c",
  "hash_id": "90d89cdca25977543804913cf7d1d303f45e2395f8def229ba329d46b5e11aee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdkfd/kfd_device_queue_manager_v9.c",
  "human_readable_source": "\n \n\n#include \"kfd_device_queue_manager.h\"\n#include \"vega10_enum.h\"\n#include \"gc/gc_9_4_3_sh_mask.h\"\n\nstatic int update_qpd_v9(struct device_queue_manager *dqm,\n\t\t\t struct qcm_process_device *qpd);\nstatic void init_sdma_vm_v9(struct device_queue_manager *dqm, struct queue *q,\n\t\t\t    struct qcm_process_device *qpd);\n\nvoid device_queue_manager_init_v9(\n\tstruct device_queue_manager_asic_ops *asic_ops)\n{\n\tasic_ops->update_qpd = update_qpd_v9;\n\tasic_ops->init_sdma_vm = init_sdma_vm_v9;\n\tasic_ops->mqd_manager_init = mqd_manager_init_v9;\n}\n\nstatic uint32_t compute_sh_mem_bases_64bit(struct kfd_process_device *pdd)\n{\n\tuint32_t shared_base = pdd->lds_base >> 48;\n\tuint32_t private_base = pdd->scratch_base >> 48;\n\n\treturn (shared_base << SH_MEM_BASES__SHARED_BASE__SHIFT) |\n\t\tprivate_base;\n}\n\nstatic int update_qpd_v9(struct device_queue_manager *dqm,\n\t\t\t struct qcm_process_device *qpd)\n{\n\tstruct kfd_process_device *pdd;\n\n\tpdd = qpd_to_pdd(qpd);\n\n\t \n\tif (qpd->sh_mem_config == 0) {\n\t\tqpd->sh_mem_config = SH_MEM_ALIGNMENT_MODE_UNALIGNED <<\n\t\t\t\t\tSH_MEM_CONFIG__ALIGNMENT_MODE__SHIFT;\n\n\t\tif (dqm->dev->kfd->noretry)\n\t\t\tqpd->sh_mem_config |= 1 << SH_MEM_CONFIG__RETRY_DISABLE__SHIFT;\n\n\t\tif (KFD_GC_VERSION(dqm->dev->kfd) == IP_VERSION(9, 4, 3))\n\t\t\tqpd->sh_mem_config |=\n\t\t\t\t(1 << SH_MEM_CONFIG__F8_MODE__SHIFT);\n\n\t\tqpd->sh_mem_ape1_limit = 0;\n\t\tqpd->sh_mem_ape1_base = 0;\n\t}\n\n\tif (KFD_SUPPORT_XNACK_PER_PROCESS(dqm->dev)) {\n\t\tif (!pdd->process->xnack_enabled)\n\t\t\tqpd->sh_mem_config |= 1 << SH_MEM_CONFIG__RETRY_DISABLE__SHIFT;\n\t\telse\n\t\t\tqpd->sh_mem_config &= ~(1 << SH_MEM_CONFIG__RETRY_DISABLE__SHIFT);\n\t}\n\n\tqpd->sh_mem_bases = compute_sh_mem_bases_64bit(pdd);\n\n\tpr_debug(\"sh_mem_bases 0x%X sh_mem_config 0x%X\\n\", qpd->sh_mem_bases,\n\t\t qpd->sh_mem_config);\n\n\treturn 0;\n}\n\nstatic void init_sdma_vm_v9(struct device_queue_manager *dqm, struct queue *q,\n\t\t\t    struct qcm_process_device *qpd)\n{\n\t \n\tq->properties.sdma_vm_addr = 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}