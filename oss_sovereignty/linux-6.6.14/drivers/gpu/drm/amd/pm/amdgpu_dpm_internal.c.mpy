{
  "module_name": "amdgpu_dpm_internal.c",
  "hash_id": "6677c3fed5588ab2db529739bee4a497fbd88e950c585712a57cb189a10b882d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/pm/amdgpu_dpm_internal.c",
  "human_readable_source": " \n\n#include \"amdgpu.h\"\n#include \"amdgpu_display.h\"\n#include \"hwmgr.h\"\n#include \"amdgpu_smu.h\"\n#include \"amdgpu_dpm_internal.h\"\n\nvoid amdgpu_dpm_get_active_displays(struct amdgpu_device *adev)\n{\n\tstruct drm_device *ddev = adev_to_drm(adev);\n\tstruct drm_crtc *crtc;\n\tstruct amdgpu_crtc *amdgpu_crtc;\n\n\tadev->pm.dpm.new_active_crtcs = 0;\n\tadev->pm.dpm.new_active_crtc_count = 0;\n\tif (adev->mode_info.num_crtc && adev->mode_info.mode_config_initialized) {\n\t\tlist_for_each_entry(crtc,\n\t\t\t\t    &ddev->mode_config.crtc_list, head) {\n\t\t\tamdgpu_crtc = to_amdgpu_crtc(crtc);\n\t\t\tif (amdgpu_crtc->enabled) {\n\t\t\t\tadev->pm.dpm.new_active_crtcs |= (1 << amdgpu_crtc->crtc_id);\n\t\t\t\tadev->pm.dpm.new_active_crtc_count++;\n\t\t\t}\n\t\t}\n\t}\n}\n\nu32 amdgpu_dpm_get_vblank_time(struct amdgpu_device *adev)\n{\n\tstruct drm_device *dev = adev_to_drm(adev);\n\tstruct drm_crtc *crtc;\n\tstruct amdgpu_crtc *amdgpu_crtc;\n\tu32 vblank_in_pixels;\n\tu32 vblank_time_us = 0xffffffff;  \n\n\tif (adev->mode_info.num_crtc && adev->mode_info.mode_config_initialized) {\n\t\tlist_for_each_entry(crtc, &dev->mode_config.crtc_list, head) {\n\t\t\tamdgpu_crtc = to_amdgpu_crtc(crtc);\n\t\t\tif (crtc->enabled && amdgpu_crtc->enabled && amdgpu_crtc->hw_mode.clock) {\n\t\t\t\tvblank_in_pixels =\n\t\t\t\t\tamdgpu_crtc->hw_mode.crtc_htotal *\n\t\t\t\t\t(amdgpu_crtc->hw_mode.crtc_vblank_end -\n\t\t\t\t\tamdgpu_crtc->hw_mode.crtc_vdisplay +\n\t\t\t\t\t(amdgpu_crtc->v_border * 2));\n\n\t\t\t\tvblank_time_us = vblank_in_pixels * 1000 / amdgpu_crtc->hw_mode.clock;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn vblank_time_us;\n}\n\nu32 amdgpu_dpm_get_vrefresh(struct amdgpu_device *adev)\n{\n\tstruct drm_device *dev = adev_to_drm(adev);\n\tstruct drm_crtc *crtc;\n\tstruct amdgpu_crtc *amdgpu_crtc;\n\tu32 vrefresh = 0;\n\n\tif (adev->mode_info.num_crtc && adev->mode_info.mode_config_initialized) {\n\t\tlist_for_each_entry(crtc, &dev->mode_config.crtc_list, head) {\n\t\t\tamdgpu_crtc = to_amdgpu_crtc(crtc);\n\t\t\tif (crtc->enabled && amdgpu_crtc->enabled && amdgpu_crtc->hw_mode.clock) {\n\t\t\t\tvrefresh = drm_mode_vrefresh(&amdgpu_crtc->hw_mode);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn vrefresh;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}