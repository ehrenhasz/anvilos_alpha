{
  "module_name": "vega10_thermal.c",
  "hash_id": "349effe37727439be7e7df32779f0797e6307fdb583566f7a7afe4bf5ebd3275",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/pm/powerplay/hwmgr/vega10_thermal.c",
  "human_readable_source": " \n\n#include \"vega10_thermal.h\"\n#include \"vega10_hwmgr.h\"\n#include \"vega10_smumgr.h\"\n#include \"vega10_ppsmc.h\"\n#include \"vega10_inc.h\"\n#include \"soc15_common.h\"\n#include \"pp_debug.h\"\n\nstatic int vega10_get_current_rpm(struct pp_hwmgr *hwmgr, uint32_t *current_rpm)\n{\n\tsmum_send_msg_to_smc(hwmgr, PPSMC_MSG_GetCurrentRpm, current_rpm);\n\treturn 0;\n}\n\nint vega10_fan_ctrl_get_fan_speed_info(struct pp_hwmgr *hwmgr,\n\t\tstruct phm_fan_speed_info *fan_speed_info)\n{\n\n\tif (hwmgr->thermal_controller.fanInfo.bNoFan)\n\t\treturn 0;\n\n\tfan_speed_info->supports_percent_read = true;\n\tfan_speed_info->supports_percent_write = true;\n\tfan_speed_info->min_percent = 0;\n\tfan_speed_info->max_percent = 100;\n\n\tif (PP_CAP(PHM_PlatformCaps_FanSpeedInTableIsRPM) &&\n\t\thwmgr->thermal_controller.fanInfo.\n\t\tucTachometerPulsesPerRevolution) {\n\t\tfan_speed_info->supports_rpm_read = true;\n\t\tfan_speed_info->supports_rpm_write = true;\n\t\tfan_speed_info->min_rpm =\n\t\t\t\thwmgr->thermal_controller.fanInfo.ulMinRPM;\n\t\tfan_speed_info->max_rpm =\n\t\t\t\thwmgr->thermal_controller.fanInfo.ulMaxRPM;\n\t} else {\n\t\tfan_speed_info->min_rpm = 0;\n\t\tfan_speed_info->max_rpm = 0;\n\t}\n\n\treturn 0;\n}\n\nint vega10_fan_ctrl_get_fan_speed_pwm(struct pp_hwmgr *hwmgr,\n\t\tuint32_t *speed)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tuint32_t duty100, duty;\n\tuint64_t tmp64;\n\n\tduty100 = REG_GET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL1),\n\t\t\t\tCG_FDO_CTRL1, FMAX_DUTY100);\n\tduty = REG_GET_FIELD(RREG32_SOC15(THM, 0, mmCG_THERMAL_STATUS),\n\t\t\t\tCG_THERMAL_STATUS, FDO_PWM_DUTY);\n\n\tif (!duty100)\n\t\treturn -EINVAL;\n\n\ttmp64 = (uint64_t)duty * 255;\n\tdo_div(tmp64, duty100);\n\t*speed = MIN((uint32_t)tmp64, 255);\n\n\treturn 0;\n}\n\nint vega10_fan_ctrl_get_fan_speed_rpm(struct pp_hwmgr *hwmgr, uint32_t *speed)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\tuint32_t tach_period;\n\tuint32_t crystal_clock_freq;\n\tint result = 0;\n\n\tif (hwmgr->thermal_controller.fanInfo.bNoFan)\n\t\treturn -1;\n\n\tif (data->smu_features[GNLD_FAN_CONTROL].supported) {\n\t\tresult = vega10_get_current_rpm(hwmgr, speed);\n\t} else {\n\t\ttach_period =\n\t\t\tREG_GET_FIELD(RREG32_SOC15(THM, 0, mmCG_TACH_STATUS),\n\t\t\t\t\t  CG_TACH_STATUS,\n\t\t\t\t\t  TACH_PERIOD);\n\n\t\tif (tach_period == 0)\n\t\t\treturn -EINVAL;\n\n\t\tcrystal_clock_freq = amdgpu_asic_get_xclk((struct amdgpu_device *)hwmgr->adev);\n\n\t\t*speed = 60 * crystal_clock_freq * 10000 / tach_period;\n\t}\n\n\treturn result;\n}\n\n \nint vega10_fan_ctrl_set_static_mode(struct pp_hwmgr *hwmgr, uint32_t mode)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\n\tif (hwmgr->fan_ctrl_is_in_default_mode) {\n\t\thwmgr->fan_ctrl_default_mode =\n\t\t\tREG_GET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL2),\n\t\t\t\tCG_FDO_CTRL2, FDO_PWM_MODE);\n\t\thwmgr->tmin =\n\t\t\tREG_GET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL2),\n\t\t\t\tCG_FDO_CTRL2, TMIN);\n\t\thwmgr->fan_ctrl_is_in_default_mode = false;\n\t}\n\n\tWREG32_SOC15(THM, 0, mmCG_FDO_CTRL2,\n\t\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL2),\n\t\t\t\tCG_FDO_CTRL2, TMIN, 0));\n\tWREG32_SOC15(THM, 0, mmCG_FDO_CTRL2,\n\t\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL2),\n\t\t\t\tCG_FDO_CTRL2, FDO_PWM_MODE, mode));\n\n\treturn 0;\n}\n\n \nint vega10_fan_ctrl_set_default_mode(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\n\tif (!hwmgr->fan_ctrl_is_in_default_mode) {\n\t\tWREG32_SOC15(THM, 0, mmCG_FDO_CTRL2,\n\t\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL2),\n\t\t\t\tCG_FDO_CTRL2, FDO_PWM_MODE,\n\t\t\t\thwmgr->fan_ctrl_default_mode));\n\t\tWREG32_SOC15(THM, 0, mmCG_FDO_CTRL2,\n\t\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL2),\n\t\t\t\tCG_FDO_CTRL2, TMIN,\n\t\t\t\thwmgr->tmin << CG_FDO_CTRL2__TMIN__SHIFT));\n\t\thwmgr->fan_ctrl_is_in_default_mode = true;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int vega10_enable_fan_control_feature(struct pp_hwmgr *hwmgr)\n{\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\n\tif (data->smu_features[GNLD_FAN_CONTROL].supported) {\n\t\tPP_ASSERT_WITH_CODE(!vega10_enable_smc_features(\n\t\t\t\thwmgr, true,\n\t\t\t\tdata->smu_features[GNLD_FAN_CONTROL].\n\t\t\t\tsmu_feature_bitmap),\n\t\t\t\t\"Attempt to Enable FAN CONTROL feature Failed!\",\n\t\t\t\treturn -1);\n\t\tdata->smu_features[GNLD_FAN_CONTROL].enabled = true;\n\t}\n\n\treturn 0;\n}\n\nstatic int vega10_disable_fan_control_feature(struct pp_hwmgr *hwmgr)\n{\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\n\tif (data->smu_features[GNLD_FAN_CONTROL].supported) {\n\t\tPP_ASSERT_WITH_CODE(!vega10_enable_smc_features(\n\t\t\t\thwmgr, false,\n\t\t\t\tdata->smu_features[GNLD_FAN_CONTROL].\n\t\t\t\tsmu_feature_bitmap),\n\t\t\t\t\"Attempt to Enable FAN CONTROL feature Failed!\",\n\t\t\t\treturn -1);\n\t\tdata->smu_features[GNLD_FAN_CONTROL].enabled = false;\n\t}\n\n\treturn 0;\n}\n\nint vega10_fan_ctrl_start_smc_fan_control(struct pp_hwmgr *hwmgr)\n{\n\tif (hwmgr->thermal_controller.fanInfo.bNoFan)\n\t\treturn -1;\n\n\tPP_ASSERT_WITH_CODE(!vega10_enable_fan_control_feature(hwmgr),\n\t\t\t\"Attempt to Enable SMC FAN CONTROL Feature Failed!\",\n\t\t\treturn -1);\n\n\treturn 0;\n}\n\n\nint vega10_fan_ctrl_stop_smc_fan_control(struct pp_hwmgr *hwmgr)\n{\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\n\tif (hwmgr->thermal_controller.fanInfo.bNoFan)\n\t\treturn -1;\n\n\tif (data->smu_features[GNLD_FAN_CONTROL].supported) {\n\t\tPP_ASSERT_WITH_CODE(!vega10_disable_fan_control_feature(hwmgr),\n\t\t\t\t\"Attempt to Disable SMC FAN CONTROL Feature Failed!\",\n\t\t\t\treturn -1);\n\t}\n\treturn 0;\n}\n\n \nint vega10_fan_ctrl_set_fan_speed_pwm(struct pp_hwmgr *hwmgr,\n\t\tuint32_t speed)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tuint32_t duty100;\n\tuint32_t duty;\n\tuint64_t tmp64;\n\n\tif (hwmgr->thermal_controller.fanInfo.bNoFan)\n\t\treturn 0;\n\n\tspeed = MIN(speed, 255);\n\n\tif (PP_CAP(PHM_PlatformCaps_MicrocodeFanControl))\n\t\tvega10_fan_ctrl_stop_smc_fan_control(hwmgr);\n\n\tduty100 = REG_GET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL1),\n\t\t\t\t    CG_FDO_CTRL1, FMAX_DUTY100);\n\n\tif (duty100 == 0)\n\t\treturn -EINVAL;\n\n\ttmp64 = (uint64_t)speed * duty100;\n\tdo_div(tmp64, 255);\n\tduty = (uint32_t)tmp64;\n\n\tWREG32_SOC15(THM, 0, mmCG_FDO_CTRL0,\n\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL0),\n\t\t\tCG_FDO_CTRL0, FDO_STATIC_DUTY, duty));\n\n\treturn vega10_fan_ctrl_set_static_mode(hwmgr, FDO_PWM_MODE_STATIC);\n}\n\n \nint vega10_fan_ctrl_reset_fan_speed_to_default(struct pp_hwmgr *hwmgr)\n{\n\tif (hwmgr->thermal_controller.fanInfo.bNoFan)\n\t\treturn 0;\n\n\tif (PP_CAP(PHM_PlatformCaps_MicrocodeFanControl))\n\t\treturn vega10_fan_ctrl_start_smc_fan_control(hwmgr);\n\telse\n\t\treturn vega10_fan_ctrl_set_default_mode(hwmgr);\n}\n\n \nint vega10_fan_ctrl_set_fan_speed_rpm(struct pp_hwmgr *hwmgr, uint32_t speed)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tuint32_t tach_period;\n\tuint32_t crystal_clock_freq;\n\tint result = 0;\n\n\tif (hwmgr->thermal_controller.fanInfo.bNoFan ||\n\t    speed == 0 ||\n\t    (speed < hwmgr->thermal_controller.fanInfo.ulMinRPM) ||\n\t    (speed > hwmgr->thermal_controller.fanInfo.ulMaxRPM))\n\t\treturn -1;\n\n\tif (PP_CAP(PHM_PlatformCaps_MicrocodeFanControl))\n\t\tresult = vega10_fan_ctrl_stop_smc_fan_control(hwmgr);\n\n\tif (!result) {\n\t\tcrystal_clock_freq = amdgpu_asic_get_xclk((struct amdgpu_device *)hwmgr->adev);\n\t\ttach_period = 60 * crystal_clock_freq * 10000 / (8 * speed);\n\t\tWREG32_SOC15(THM, 0, mmCG_TACH_CTRL,\n\t\t\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_TACH_CTRL),\n\t\t\t\t\tCG_TACH_CTRL, TARGET_PERIOD,\n\t\t\t\t\ttach_period));\n\t}\n\treturn vega10_fan_ctrl_set_static_mode(hwmgr, FDO_PWM_MODE_STATIC_RPM);\n}\n\n \nint vega10_thermal_get_temperature(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tint temp;\n\n\ttemp = RREG32_SOC15(THM, 0, mmCG_MULT_THERMAL_STATUS);\n\n\ttemp = (temp & CG_MULT_THERMAL_STATUS__CTF_TEMP_MASK) >>\n\t\t\tCG_MULT_THERMAL_STATUS__CTF_TEMP__SHIFT;\n\n\ttemp = temp & 0x1ff;\n\n\ttemp *= PP_TEMPERATURE_UNITS_PER_CENTIGRADES;\n\n\treturn temp;\n}\n\n \nstatic int vega10_thermal_set_temperature_range(struct pp_hwmgr *hwmgr,\n\t\tstruct PP_TemperatureRange *range)\n{\n\tstruct phm_ppt_v2_information *pp_table_info =\n\t\t(struct phm_ppt_v2_information *)(hwmgr->pptable);\n\tstruct phm_tdp_table *tdp_table = pp_table_info->tdp_table;\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tint low = VEGA10_THERMAL_MINIMUM_ALERT_TEMP;\n\tint high = VEGA10_THERMAL_MAXIMUM_ALERT_TEMP;\n\tuint32_t val;\n\n\t \n\tif (low < range->min / PP_TEMPERATURE_UNITS_PER_CENTIGRADES)\n\t\tlow = range->min / PP_TEMPERATURE_UNITS_PER_CENTIGRADES;\n\n\t \n\tif ((tdp_table->usSoftwareShutdownTemp >\n\t     range->hotspot_crit_max / PP_TEMPERATURE_UNITS_PER_CENTIGRADES)) {\n\t\tif (high > tdp_table->usSoftwareShutdownTemp)\n\t\t\thigh = tdp_table->usSoftwareShutdownTemp;\n\t}\n\n\tif (low > high)\n\t\treturn -EINVAL;\n\n\tval = RREG32_SOC15(THM, 0, mmTHM_THERMAL_INT_CTRL);\n\n\tval = REG_SET_FIELD(val, THM_THERMAL_INT_CTRL, MAX_IH_CREDIT, 5);\n\tval = REG_SET_FIELD(val, THM_THERMAL_INT_CTRL, THERM_IH_HW_ENA, 1);\n\tval = REG_SET_FIELD(val, THM_THERMAL_INT_CTRL, DIG_THERM_INTH, high);\n\tval = REG_SET_FIELD(val, THM_THERMAL_INT_CTRL, DIG_THERM_INTL, low);\n\tval &= (~THM_THERMAL_INT_CTRL__THERM_TRIGGER_MASK_MASK) &\n\t\t\t(~THM_THERMAL_INT_CTRL__THERM_INTH_MASK_MASK) &\n\t\t\t(~THM_THERMAL_INT_CTRL__THERM_INTL_MASK_MASK);\n\n\tWREG32_SOC15(THM, 0, mmTHM_THERMAL_INT_CTRL, val);\n\n\treturn 0;\n}\n\n \nstatic int vega10_thermal_initialize(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\n\tif (hwmgr->thermal_controller.fanInfo.ucTachometerPulsesPerRevolution) {\n\t\tWREG32_SOC15(THM, 0, mmCG_TACH_CTRL,\n\t\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_TACH_CTRL),\n\t\t\t\tCG_TACH_CTRL, EDGE_PER_REV,\n\t\t\t\thwmgr->thermal_controller.fanInfo.ucTachometerPulsesPerRevolution - 1));\n\t}\n\n\tWREG32_SOC15(THM, 0, mmCG_FDO_CTRL2,\n\t\tREG_SET_FIELD(RREG32_SOC15(THM, 0, mmCG_FDO_CTRL2),\n\t\t\tCG_FDO_CTRL2, TACH_PWM_RESP_RATE, 0x28));\n\n\treturn 0;\n}\n\n \nstatic int vega10_thermal_enable_alert(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\tuint32_t val = 0;\n\n\tif (data->smu_features[GNLD_FW_CTF].supported) {\n\t\tif (data->smu_features[GNLD_FW_CTF].enabled)\n\t\t\tprintk(\"[Thermal_EnableAlert] FW CTF Already Enabled!\\n\");\n\n\t\tPP_ASSERT_WITH_CODE(!vega10_enable_smc_features(hwmgr,\n\t\t\t\ttrue,\n\t\t\t\tdata->smu_features[GNLD_FW_CTF].smu_feature_bitmap),\n\t\t\t\t\"Attempt to Enable FW CTF feature Failed!\",\n\t\t\t\treturn -1);\n\t\tdata->smu_features[GNLD_FW_CTF].enabled = true;\n\t}\n\n\tval |= (1 << THM_THERMAL_INT_ENA__THERM_INTH_CLR__SHIFT);\n\tval |= (1 << THM_THERMAL_INT_ENA__THERM_INTL_CLR__SHIFT);\n\tval |= (1 << THM_THERMAL_INT_ENA__THERM_TRIGGER_CLR__SHIFT);\n\n\tWREG32_SOC15(THM, 0, mmTHM_THERMAL_INT_ENA, val);\n\n\treturn 0;\n}\n\n \nint vega10_thermal_disable_alert(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\n\tif (data->smu_features[GNLD_FW_CTF].supported) {\n\t\tif (!data->smu_features[GNLD_FW_CTF].enabled)\n\t\t\tprintk(\"[Thermal_EnableAlert] FW CTF Already disabled!\\n\");\n\n\n\t\tPP_ASSERT_WITH_CODE(!vega10_enable_smc_features(hwmgr,\n\t\t\tfalse,\n\t\t\tdata->smu_features[GNLD_FW_CTF].smu_feature_bitmap),\n\t\t\t\"Attempt to disable FW CTF feature Failed!\",\n\t\t\treturn -1);\n\t\tdata->smu_features[GNLD_FW_CTF].enabled = false;\n\t}\n\n\tWREG32_SOC15(THM, 0, mmTHM_THERMAL_INT_ENA, 0);\n\n\treturn 0;\n}\n\n \nint vega10_thermal_stop_thermal_controller(struct pp_hwmgr *hwmgr)\n{\n\tint result = vega10_thermal_disable_alert(hwmgr);\n\n\tif (!hwmgr->thermal_controller.fanInfo.bNoFan)\n\t\tvega10_fan_ctrl_set_default_mode(hwmgr);\n\n\treturn result;\n}\n\n \nstatic int vega10_thermal_setup_fan_table(struct pp_hwmgr *hwmgr)\n{\n\tint ret;\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\tPPTable_t *table = &(data->smc_state_table.pp_table);\n\n\tif (!data->smu_features[GNLD_FAN_CONTROL].supported)\n\t\treturn 0;\n\n\ttable->FanMaximumRpm = (uint16_t)hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usMaxFanRPM;\n\ttable->FanThrottlingRpm = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanRPMMaxLimit;\n\ttable->FanAcousticLimitRpm = (uint16_t)(hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.ulMinFanSCLKAcousticLimit);\n\ttable->FanTargetTemperature = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usTMax;\n\n\tsmum_send_msg_to_smc_with_parameter(hwmgr,\n\t\t\t\tPPSMC_MSG_SetFanTemperatureTarget,\n\t\t\t\t(uint32_t)table->FanTargetTemperature,\n\t\t\t\tNULL);\n\n\ttable->FanPwmMin = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usPWMMin * 255 / 100;\n\ttable->FanTargetGfxclk = (uint16_t)(hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.ulTargetGfxClk);\n\ttable->FanGainEdge = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanGainEdge;\n\ttable->FanGainHotspot = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanGainHotspot;\n\ttable->FanGainLiquid = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanGainLiquid;\n\ttable->FanGainVrVddc = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanGainVrVddc;\n\ttable->FanGainVrMvdd = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanGainVrMvdd;\n\ttable->FanGainPlx = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanGainPlx;\n\ttable->FanGainHbm = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usFanGainHbm;\n\ttable->FanZeroRpmEnable = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.ucEnableZeroRPM;\n\ttable->FanStopTemp = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usZeroRPMStopTemperature;\n\ttable->FanStartTemp = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usZeroRPMStartTemperature;\n\n\tret = smum_smc_table_manager(hwmgr,\n\t\t\t\t(uint8_t *)(&(data->smc_state_table.pp_table)),\n\t\t\t\tPPTABLE, false);\n\tif (ret)\n\t\tpr_info(\"Failed to update Fan Control Table in PPTable!\");\n\n\treturn ret;\n}\n\nint vega10_enable_mgpu_fan_boost(struct pp_hwmgr *hwmgr)\n{\n\tstruct vega10_hwmgr *data = hwmgr->backend;\n\tPPTable_t *table = &(data->smc_state_table.pp_table);\n\tint ret;\n\n\tif (!data->smu_features[GNLD_FAN_CONTROL].supported)\n\t\treturn 0;\n\n\tif (!hwmgr->thermal_controller.advanceFanControlParameters.\n\t\t\tusMGpuThrottlingRPMLimit)\n\t\treturn 0;\n\n\ttable->FanThrottlingRpm = hwmgr->thermal_controller.\n\t\t\tadvanceFanControlParameters.usMGpuThrottlingRPMLimit;\n\n\tret = smum_smc_table_manager(hwmgr,\n\t\t\t\t(uint8_t *)(&(data->smc_state_table.pp_table)),\n\t\t\t\tPPTABLE, false);\n\tif (ret) {\n\t\tpr_info(\"Failed to update fan control table in pptable!\");\n\t\treturn ret;\n\t}\n\n\tret = vega10_disable_fan_control_feature(hwmgr);\n\tif (ret) {\n\t\tpr_info(\"Attempt to disable SMC fan control feature failed!\");\n\t\treturn ret;\n\t}\n\n\tret = vega10_enable_fan_control_feature(hwmgr);\n\tif (ret)\n\t\tpr_info(\"Attempt to enable SMC fan control feature failed!\");\n\n\treturn ret;\n}\n\n \nstatic int vega10_thermal_start_smc_fan_control(struct pp_hwmgr *hwmgr)\n{\n \n\tif (PP_CAP(PHM_PlatformCaps_MicrocodeFanControl))\n\t\tvega10_fan_ctrl_start_smc_fan_control(hwmgr);\n\n\treturn 0;\n}\n\n\nint vega10_start_thermal_controller(struct pp_hwmgr *hwmgr,\n\t\t\t\tstruct PP_TemperatureRange *range)\n{\n\tint ret = 0;\n\n\tif (range == NULL)\n\t\treturn -EINVAL;\n\n\tvega10_thermal_initialize(hwmgr);\n\tret = vega10_thermal_set_temperature_range(hwmgr, range);\n\tif (ret)\n\t\treturn -EINVAL;\n\n\tvega10_thermal_enable_alert(hwmgr);\n \n\tret = vega10_thermal_setup_fan_table(hwmgr);\n\tif (ret)\n\t\treturn -EINVAL;\n\n\tvega10_thermal_start_smc_fan_control(hwmgr);\n\n\treturn 0;\n};\n\n\n\n\nint vega10_thermal_ctrl_uninitialize_thermal_controller(struct pp_hwmgr *hwmgr)\n{\n\tif (!hwmgr->thermal_controller.fanInfo.bNoFan) {\n\t\tvega10_fan_ctrl_set_default_mode(hwmgr);\n\t\tvega10_fan_ctrl_stop_smc_fan_control(hwmgr);\n\t}\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}