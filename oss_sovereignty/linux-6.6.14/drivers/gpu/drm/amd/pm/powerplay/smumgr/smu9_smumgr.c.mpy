{
  "module_name": "smu9_smumgr.c",
  "hash_id": "9ee8acffb7312b3be87c815e158a6d07694e195ed40d466d54256b1706097e4b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/pm/powerplay/smumgr/smu9_smumgr.c",
  "human_readable_source": " \n\n#include \"smumgr.h\"\n#include \"smu9_smumgr.h\"\n#include \"vega10_inc.h\"\n#include \"soc15_common.h\"\n#include \"pp_debug.h\"\n\n\n \n#define MP0_Public                  0x03800000\n#define MP0_SRAM                    0x03900000\n#define MP1_Public                  0x03b00000\n#define MP1_SRAM                    0x03c00004\n\n#define smnMP1_FIRMWARE_FLAGS                                                                           0x3010028\n\nbool smu9_is_smc_ram_running(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tuint32_t mp1_fw_flags;\n\n\tmp1_fw_flags = RREG32_PCIE(MP1_Public |\n\t\t\t\t   (smnMP1_FIRMWARE_FLAGS & 0xffffffff));\n\n\tif (mp1_fw_flags & MP1_FIRMWARE_FLAGS__INTERRUPTS_ENABLED_MASK)\n\t\treturn true;\n\n\treturn false;\n}\n\n \nstatic uint32_t smu9_wait_for_response(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tuint32_t reg;\n\tuint32_t ret;\n\n\tif (hwmgr->pp_one_vf) {\n\t\treg = SOC15_REG_OFFSET(MP1, 0, mmMP1_SMN_C2PMSG_103);\n\n\t\tret = phm_wait_for_register_unequal(hwmgr, reg,\n\t\t\t\t0, MP1_C2PMSG_103__CONTENT_MASK);\n\n\t\tif (ret)\n\t\t\tpr_err(\"No response from smu\\n\");\n\n\t\treturn RREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_103);\n\t} else {\n\t\treg = SOC15_REG_OFFSET(MP1, 0, mmMP1_SMN_C2PMSG_90);\n\n\t\tret = phm_wait_for_register_unequal(hwmgr, reg,\n\t\t\t\t0, MP1_C2PMSG_90__CONTENT_MASK);\n\n\t\tif (ret)\n\t\t\tpr_err(\"No response from smu\\n\");\n\t\treturn RREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_90);\n\t}\n}\n\n \nstatic int smu9_send_msg_to_smc_without_waiting(struct pp_hwmgr *hwmgr,\n\t\t\t\t\t\tuint16_t msg)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\n\tif (hwmgr->pp_one_vf) {\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_101, msg);\n\t} else {\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_66, msg);\n\t}\n\n\treturn 0;\n}\n\n \nint smu9_send_msg_to_smc(struct pp_hwmgr *hwmgr, uint16_t msg)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tuint32_t ret;\n\n\tsmu9_wait_for_response(hwmgr);\n\n\tif (hwmgr->pp_one_vf)\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_103, 0);\n\telse\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_90, 0);\n\n\tsmu9_send_msg_to_smc_without_waiting(hwmgr, msg);\n\n\tret = smu9_wait_for_response(hwmgr);\n\tif (ret != 1)\n\t\tdev_err(adev->dev, \"Failed to send message: 0x%x, ret value: 0x%x\\n\", msg, ret);\n\n\treturn 0;\n}\n\n \nint smu9_send_msg_to_smc_with_parameter(struct pp_hwmgr *hwmgr,\n\t\t\t\t\tuint16_t msg, uint32_t parameter)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\tuint32_t ret;\n\n\tsmu9_wait_for_response(hwmgr);\n\n\tif (hwmgr->pp_one_vf) {\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_103, 0);\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_102, parameter);\n\t} else {\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_90, 0);\n\t\tWREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_82, parameter);\n\t}\n\n\tsmu9_send_msg_to_smc_without_waiting(hwmgr, msg);\n\n\tret = smu9_wait_for_response(hwmgr);\n\tif (ret != 1)\n\t\tpr_err(\"Failed message: 0x%x, input parameter: 0x%x, error code: 0x%x\\n\", msg, parameter, ret);\n\n\treturn 0;\n}\n\nuint32_t smu9_get_argument(struct pp_hwmgr *hwmgr)\n{\n\tstruct amdgpu_device *adev = hwmgr->adev;\n\n\tif (hwmgr->pp_one_vf)\n\t\treturn RREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_102);\n\telse\n\t\treturn RREG32_SOC15(MP1, 0, mmMP1_SMN_C2PMSG_82);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}