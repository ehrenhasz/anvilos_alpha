{
  "module_name": "amdgpu_xcp_drv.c",
  "hash_id": "8311dfef680f7be9fb3082b68fbbc20619aee6f8f547f1f4323f4839355440b2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdxcp/amdgpu_xcp_drv.c",
  "human_readable_source": " \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <drm/drm_drv.h>\n\n#include \"amdgpu_xcp_drv.h\"\n\n#define MAX_XCP_PLATFORM_DEVICE 64\n\nstruct xcp_device {\n\tstruct drm_device drm;\n\tstruct platform_device *pdev;\n};\n\nstatic const struct drm_driver amdgpu_xcp_driver = {\n\t.driver_features = DRIVER_GEM | DRIVER_RENDER,\n\t.name = \"amdgpu_xcp_drv\",\n\t.major = 1,\n\t.minor = 0,\n};\n\nstatic int pdev_num;\nstatic struct xcp_device *xcp_dev[MAX_XCP_PLATFORM_DEVICE];\n\nint amdgpu_xcp_drm_dev_alloc(struct drm_device **ddev)\n{\n\tstruct platform_device *pdev;\n\tstruct xcp_device *pxcp_dev;\n\tint ret;\n\n\tif (pdev_num >= MAX_XCP_PLATFORM_DEVICE)\n\t\treturn -ENODEV;\n\n\tpdev = platform_device_register_simple(\"amdgpu_xcp\", pdev_num, NULL, 0);\n\tif (IS_ERR(pdev))\n\t\treturn PTR_ERR(pdev);\n\n\tif (!devres_open_group(&pdev->dev, NULL, GFP_KERNEL)) {\n\t\tret = -ENOMEM;\n\t\tgoto out_unregister;\n\t}\n\n\tpxcp_dev = devm_drm_dev_alloc(&pdev->dev, &amdgpu_xcp_driver, struct xcp_device, drm);\n\tif (IS_ERR(pxcp_dev)) {\n\t\tret = PTR_ERR(pxcp_dev);\n\t\tgoto out_devres;\n\t}\n\n\txcp_dev[pdev_num] = pxcp_dev;\n\txcp_dev[pdev_num]->pdev = pdev;\n\t*ddev = &pxcp_dev->drm;\n\tpdev_num++;\n\n\treturn 0;\n\nout_devres:\n\tdevres_release_group(&pdev->dev, NULL);\nout_unregister:\n\tplatform_device_unregister(pdev);\n\n\treturn ret;\n}\nEXPORT_SYMBOL(amdgpu_xcp_drm_dev_alloc);\n\nvoid amdgpu_xcp_drv_release(void)\n{\n\tfor (--pdev_num; pdev_num >= 0; --pdev_num) {\n\t\tdevres_release_group(&xcp_dev[pdev_num]->pdev->dev, NULL);\n\t\tplatform_device_unregister(xcp_dev[pdev_num]->pdev);\n\t\txcp_dev[pdev_num]->pdev = NULL;\n\t\txcp_dev[pdev_num] = NULL;\n\t}\n\tpdev_num = 0;\n}\nEXPORT_SYMBOL(amdgpu_xcp_drv_release);\n\nstatic void __exit amdgpu_xcp_drv_exit(void)\n{\n\tamdgpu_xcp_drv_release();\n}\n\nmodule_exit(amdgpu_xcp_drv_exit);\n\nMODULE_AUTHOR(\"AMD linux driver team\");\nMODULE_DESCRIPTION(\"AMD XCP PLATFORM DEVICES\");\nMODULE_LICENSE(\"GPL and additional rights\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}