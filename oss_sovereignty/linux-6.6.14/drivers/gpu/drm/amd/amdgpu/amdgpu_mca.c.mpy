{
  "module_name": "amdgpu_mca.c",
  "hash_id": "b6b8379fddc946f0f0f457d0d4bb94bc78f66af0679d4db234acd8f8701cb71a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_mca.c",
  "human_readable_source": " \n#include \"amdgpu_ras.h\"\n#include \"amdgpu.h\"\n#include \"amdgpu_mca.h\"\n\n#include \"umc/umc_6_7_0_offset.h\"\n#include \"umc/umc_6_7_0_sh_mask.h\"\n\nvoid amdgpu_mca_query_correctable_error_count(struct amdgpu_device *adev,\n\t\t\t\t\t      uint64_t mc_status_addr,\n\t\t\t\t\t      unsigned long *error_count)\n{\n\tuint64_t mc_status = RREG64_PCIE(mc_status_addr);\n\n\tif (REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, Val) == 1 &&\n\t    REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, CECC) == 1)\n\t\t*error_count += 1;\n}\n\nvoid amdgpu_mca_query_uncorrectable_error_count(struct amdgpu_device *adev,\n\t\t\t\t\t\tuint64_t mc_status_addr,\n\t\t\t\t\t\tunsigned long *error_count)\n{\n\tuint64_t mc_status = RREG64_PCIE(mc_status_addr);\n\n\tif ((REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, Val) == 1) &&\n\t    (REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, Deferred) == 1 ||\n\t    REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, UECC) == 1 ||\n\t    REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, PCC) == 1 ||\n\t    REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, UC) == 1 ||\n\t    REG_GET_FIELD(mc_status, MCA_UMC_UMC0_MCUMC_STATUST0, TCC) == 1))\n\t\t*error_count += 1;\n}\n\nvoid amdgpu_mca_reset_error_count(struct amdgpu_device *adev,\n\t\t\t\t  uint64_t mc_status_addr)\n{\n\tWREG64_PCIE(mc_status_addr, 0x0ULL);\n}\n\nvoid amdgpu_mca_query_ras_error_count(struct amdgpu_device *adev,\n\t\t\t\t      uint64_t mc_status_addr,\n\t\t\t\t      void *ras_error_status)\n{\n\tstruct ras_err_data *err_data = (struct ras_err_data *)ras_error_status;\n\n\tamdgpu_mca_query_correctable_error_count(adev, mc_status_addr, &(err_data->ce_count));\n\tamdgpu_mca_query_uncorrectable_error_count(adev, mc_status_addr, &(err_data->ue_count));\n\n\tamdgpu_mca_reset_error_count(adev, mc_status_addr);\n}\n\nint amdgpu_mca_mp0_ras_sw_init(struct amdgpu_device *adev)\n{\n\tint err;\n\tstruct amdgpu_mca_ras_block *ras;\n\n\tif (!adev->mca.mp0.ras)\n\t\treturn 0;\n\n\tras = adev->mca.mp0.ras;\n\n\terr = amdgpu_ras_register_ras_block(adev, &ras->ras_block);\n\tif (err) {\n\t\tdev_err(adev->dev, \"Failed to register mca.mp0 ras block!\\n\");\n\t\treturn err;\n\t}\n\n\tstrcpy(ras->ras_block.ras_comm.name, \"mca.mp0\");\n\tras->ras_block.ras_comm.block = AMDGPU_RAS_BLOCK__MCA;\n\tras->ras_block.ras_comm.type = AMDGPU_RAS_ERROR__MULTI_UNCORRECTABLE;\n\tadev->mca.mp0.ras_if = &ras->ras_block.ras_comm;\n\n\treturn 0;\n}\n\nint amdgpu_mca_mp1_ras_sw_init(struct amdgpu_device *adev)\n{\n\tint err;\n\tstruct amdgpu_mca_ras_block *ras;\n\n\tif (!adev->mca.mp1.ras)\n\t\treturn 0;\n\n\tras = adev->mca.mp1.ras;\n\n\terr = amdgpu_ras_register_ras_block(adev, &ras->ras_block);\n\tif (err) {\n\t\tdev_err(adev->dev, \"Failed to register mca.mp1 ras block!\\n\");\n\t\treturn err;\n\t}\n\n\tstrcpy(ras->ras_block.ras_comm.name, \"mca.mp1\");\n\tras->ras_block.ras_comm.block = AMDGPU_RAS_BLOCK__MCA;\n\tras->ras_block.ras_comm.type = AMDGPU_RAS_ERROR__MULTI_UNCORRECTABLE;\n\tadev->mca.mp1.ras_if = &ras->ras_block.ras_comm;\n\n\treturn 0;\n}\n\nint amdgpu_mca_mpio_ras_sw_init(struct amdgpu_device *adev)\n{\n\tint err;\n\tstruct amdgpu_mca_ras_block *ras;\n\n\tif (!adev->mca.mpio.ras)\n\t\treturn 0;\n\n\tras = adev->mca.mpio.ras;\n\n\terr = amdgpu_ras_register_ras_block(adev, &ras->ras_block);\n\tif (err) {\n\t\tdev_err(adev->dev, \"Failed to register mca.mpio ras block!\\n\");\n\t\treturn err;\n\t}\n\n\tstrcpy(ras->ras_block.ras_comm.name, \"mca.mpio\");\n\tras->ras_block.ras_comm.block = AMDGPU_RAS_BLOCK__MCA;\n\tras->ras_block.ras_comm.type = AMDGPU_RAS_ERROR__MULTI_UNCORRECTABLE;\n\tadev->mca.mpio.ras_if = &ras->ras_block.ras_comm;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}