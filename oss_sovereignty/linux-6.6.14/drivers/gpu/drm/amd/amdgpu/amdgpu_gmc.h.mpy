{
  "module_name": "amdgpu_gmc.h",
  "hash_id": "b08d498b048df80c7f2e377a58d39ab5a6dc22d9d39db807077f894a9b375da8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_gmc.h",
  "human_readable_source": " \n#ifndef __AMDGPU_GMC_H__\n#define __AMDGPU_GMC_H__\n\n#include <linux/types.h>\n\n#include \"amdgpu_irq.h\"\n#include \"amdgpu_ras.h\"\n\n \n#define AMDGPU_GMC_HOLE_START\t0x0000800000000000ULL\n#define AMDGPU_GMC_HOLE_END\t0xffff800000000000ULL\n\n \n#define AMDGPU_GMC_HOLE_MASK\t0x0000ffffffffffffULL\n\n \n#define AMDGPU_GMC_FAULT_RING_ORDER\t8\n#define AMDGPU_GMC_FAULT_RING_SIZE\t(1 << AMDGPU_GMC_FAULT_RING_ORDER)\n\n \n#define AMDGPU_GMC_FAULT_HASH_ORDER\t8\n#define AMDGPU_GMC_FAULT_HASH_SIZE\t(1 << AMDGPU_GMC_FAULT_HASH_ORDER)\n\n \n#define AMDGPU_GMC_FAULT_TIMEOUT\t5000ULL\n\nstruct firmware;\n\nenum amdgpu_memory_partition {\n\tUNKNOWN_MEMORY_PARTITION_MODE = 0,\n\tAMDGPU_NPS1_PARTITION_MODE = 1,\n\tAMDGPU_NPS2_PARTITION_MODE = 2,\n\tAMDGPU_NPS3_PARTITION_MODE = 3,\n\tAMDGPU_NPS4_PARTITION_MODE = 4,\n\tAMDGPU_NPS6_PARTITION_MODE = 6,\n\tAMDGPU_NPS8_PARTITION_MODE = 8,\n};\n\n \nstruct amdgpu_gmc_fault {\n\tuint64_t\ttimestamp:48;\n\tuint64_t\tnext:AMDGPU_GMC_FAULT_RING_ORDER;\n\tatomic64_t\tkey;\n\tuint64_t\ttimestamp_expiry:48;\n};\n\n \nstruct amdgpu_vmhub_funcs {\n\tvoid (*print_l2_protection_fault_status)(struct amdgpu_device *adev,\n\t\t\t\t\t\t uint32_t status);\n\tuint32_t (*get_invalidate_req)(unsigned int vmid, uint32_t flush_type);\n};\n\nstruct amdgpu_vmhub {\n\tuint32_t\tctx0_ptb_addr_lo32;\n\tuint32_t\tctx0_ptb_addr_hi32;\n\tuint32_t\tvm_inv_eng0_sem;\n\tuint32_t\tvm_inv_eng0_req;\n\tuint32_t\tvm_inv_eng0_ack;\n\tuint32_t\tvm_context0_cntl;\n\tuint32_t\tvm_l2_pro_fault_status;\n\tuint32_t\tvm_l2_pro_fault_cntl;\n\n\t \n\tuint32_t\tctx_distance;\n\tuint32_t\tctx_addr_distance;  \n\tuint32_t\teng_distance;\n\tuint32_t\teng_addr_distance;  \n\n\tuint32_t        vm_cntx_cntl;\n\tuint32_t\tvm_cntx_cntl_vm_fault;\n\tuint32_t\tvm_l2_bank_select_reserved_cid2;\n\n\tuint32_t\tvm_contexts_disable;\n\n\tconst struct amdgpu_vmhub_funcs *vmhub_funcs;\n};\n\n \nstruct amdgpu_gmc_funcs {\n\t \n\tvoid (*flush_gpu_tlb)(struct amdgpu_device *adev, uint32_t vmid,\n\t\t\t\tuint32_t vmhub, uint32_t flush_type);\n\t \n\tint (*flush_gpu_tlb_pasid)(struct amdgpu_device *adev, uint16_t pasid,\n\t\t\t\t\tuint32_t flush_type, bool all_hub,\n\t\t\t\t\tuint32_t inst);\n\t \n\tuint64_t (*emit_flush_gpu_tlb)(struct amdgpu_ring *ring, unsigned vmid,\n\t\t\t\t       uint64_t pd_addr);\n\t \n\tvoid (*emit_pasid_mapping)(struct amdgpu_ring *ring, unsigned vmid,\n\t\t\t\t   unsigned pasid);\n\t \n\tvoid (*set_prt)(struct amdgpu_device *adev, bool enable);\n\t \n\tuint64_t (*map_mtype)(struct amdgpu_device *adev, uint32_t flags);\n\t \n\tvoid (*get_vm_pde)(struct amdgpu_device *adev, int level,\n\t\t\t   u64 *dst, u64 *flags);\n\t \n\tvoid (*get_vm_pte)(struct amdgpu_device *adev,\n\t\t\t   struct amdgpu_bo_va_mapping *mapping,\n\t\t\t   uint64_t *flags);\n\t \n\tvoid (*override_vm_pte_flags)(struct amdgpu_device *dev,\n\t\t\t\t      struct amdgpu_vm *vm,\n\t\t\t\t      uint64_t addr, uint64_t *flags);\n\t \n\tunsigned int (*get_vbios_fb_size)(struct amdgpu_device *adev);\n\n\tenum amdgpu_memory_partition (*query_mem_partition_mode)(\n\t\tstruct amdgpu_device *adev);\n};\n\nstruct amdgpu_xgmi_ras {\n\tstruct amdgpu_ras_block_object ras_block;\n};\n\nstruct amdgpu_xgmi {\n\t \n\tu64 node_id;\n\tu64 hive_id;\n\t \n\tu64 node_segment_size;\n\t \n\tunsigned physical_node_id;\n\t \n\tunsigned num_physical_nodes;\n\t \n\tstruct list_head head;\n\tbool supported;\n\tstruct ras_common_if *ras_if;\n\tbool connected_to_cpu;\n\tbool pending_reset;\n\tstruct amdgpu_xgmi_ras *ras;\n};\n\nstruct amdgpu_mem_partition_info {\n\tunion {\n\t\tstruct {\n\t\t\tuint32_t fpfn;\n\t\t\tuint32_t lpfn;\n\t\t} range;\n\t\tstruct {\n\t\t\tint node;\n\t\t} numa;\n\t};\n\tuint64_t size;\n};\n\n#define INVALID_PFN    -1\n\nstruct amdgpu_gmc {\n\t \n\tresource_size_t\t\taper_size;\n\tresource_size_t\t\taper_base;\n\t \n\tu64\t\t\tmc_vram_size;\n\tu64\t\t\tvisible_vram_size;\n\t \n\tu64\t\t\tagp_size;\n\tu64\t\t\tagp_start;\n\tu64\t\t\tagp_end;\n\t \n\tu64\t\t\tgart_size;\n\tu64\t\t\tgart_start;\n\tu64\t\t\tgart_end;\n\t \n\tu64\t\t\tvram_start;\n\tu64\t\t\tvram_end;\n\t \n\tu64\t\t\tfb_start;\n\tu64\t\t\tfb_end;\n\tunsigned\t\tvram_width;\n\tu64\t\t\treal_vram_size;\n\tint\t\t\tvram_mtrr;\n\tu64                     mc_mask;\n\tconst struct firmware   *fw;\t \n\tuint32_t                fw_version;\n\tstruct amdgpu_irq_src\tvm_fault;\n\tuint32_t\t\tvram_type;\n\tuint8_t\t\t\tvram_vendor;\n\tuint32_t                srbm_soft_reset;\n\tbool\t\t\tprt_warning;\n\tuint32_t\t\tsdpif_register;\n\t \n\tu64\t\t\tshared_aperture_start;\n\tu64\t\t\tshared_aperture_end;\n\tu64\t\t\tprivate_aperture_start;\n\tu64\t\t\tprivate_aperture_end;\n\t \n\tspinlock_t\t\tinvalidate_lock;\n\tbool\t\t\ttranslate_further;\n\tstruct kfd_vm_fault_info *vm_fault_info;\n\tatomic_t\t\tvm_fault_info_updated;\n\n\tstruct amdgpu_gmc_fault\tfault_ring[AMDGPU_GMC_FAULT_RING_SIZE];\n\tstruct {\n\t\tuint64_t\tidx:AMDGPU_GMC_FAULT_RING_ORDER;\n\t} fault_hash[AMDGPU_GMC_FAULT_HASH_SIZE];\n\tuint64_t\t\tlast_fault:AMDGPU_GMC_FAULT_RING_ORDER;\n\n\tbool tmz_enabled;\n\tbool is_app_apu;\n\n\tstruct amdgpu_mem_partition_info *mem_partitions;\n\tuint8_t num_mem_partitions;\n\tconst struct amdgpu_gmc_funcs\t*gmc_funcs;\n\n\tstruct amdgpu_xgmi xgmi;\n\tstruct amdgpu_irq_src\tecc_irq;\n\tint noretry;\n\n\tuint32_t\tvmid0_page_table_block_size;\n\tuint32_t\tvmid0_page_table_depth;\n\tstruct amdgpu_bo\t\t*pdb0_bo;\n\t \n\tvoid\t\t\t\t*ptr_pdb0;\n\n\t \n\tu64 mall_size;\n\tuint32_t m_half_use;\n\n\t \n\tint num_umc;\n\t \n\tu64 VM_L2_CNTL;\n\tu64 VM_L2_CNTL2;\n\tu64 VM_DUMMY_PAGE_FAULT_CNTL;\n\tu64 VM_DUMMY_PAGE_FAULT_ADDR_LO32;\n\tu64 VM_DUMMY_PAGE_FAULT_ADDR_HI32;\n\tu64 VM_L2_PROTECTION_FAULT_CNTL;\n\tu64 VM_L2_PROTECTION_FAULT_CNTL2;\n\tu64 VM_L2_PROTECTION_FAULT_MM_CNTL3;\n\tu64 VM_L2_PROTECTION_FAULT_MM_CNTL4;\n\tu64 VM_L2_PROTECTION_FAULT_ADDR_LO32;\n\tu64 VM_L2_PROTECTION_FAULT_ADDR_HI32;\n\tu64 VM_DEBUG;\n\tu64 VM_L2_MM_GROUP_RT_CLASSES;\n\tu64 VM_L2_BANK_SELECT_RESERVED_CID;\n\tu64 VM_L2_BANK_SELECT_RESERVED_CID2;\n\tu64 VM_L2_CACHE_PARITY_CNTL;\n\tu64 VM_L2_IH_LOG_CNTL;\n\tu64 VM_CONTEXT_CNTL[16];\n\tu64 VM_CONTEXT_PAGE_TABLE_BASE_ADDR_LO32[16];\n\tu64 VM_CONTEXT_PAGE_TABLE_BASE_ADDR_HI32[16];\n\tu64 VM_CONTEXT_PAGE_TABLE_START_ADDR_LO32[16];\n\tu64 VM_CONTEXT_PAGE_TABLE_START_ADDR_HI32[16];\n\tu64 VM_CONTEXT_PAGE_TABLE_END_ADDR_LO32[16];\n\tu64 VM_CONTEXT_PAGE_TABLE_END_ADDR_HI32[16];\n\tu64 MC_VM_MX_L1_TLB_CNTL;\n\n\tu64 noretry_flags;\n};\n\n#define amdgpu_gmc_flush_gpu_tlb(adev, vmid, vmhub, type) ((adev)->gmc.gmc_funcs->flush_gpu_tlb((adev), (vmid), (vmhub), (type)))\n#define amdgpu_gmc_flush_gpu_tlb_pasid(adev, pasid, type, allhub, inst) \\\n\t((adev)->gmc.gmc_funcs->flush_gpu_tlb_pasid \\\n\t((adev), (pasid), (type), (allhub), (inst)))\n#define amdgpu_gmc_emit_flush_gpu_tlb(r, vmid, addr) (r)->adev->gmc.gmc_funcs->emit_flush_gpu_tlb((r), (vmid), (addr))\n#define amdgpu_gmc_emit_pasid_mapping(r, vmid, pasid) (r)->adev->gmc.gmc_funcs->emit_pasid_mapping((r), (vmid), (pasid))\n#define amdgpu_gmc_map_mtype(adev, flags) (adev)->gmc.gmc_funcs->map_mtype((adev),(flags))\n#define amdgpu_gmc_get_vm_pde(adev, level, dst, flags) (adev)->gmc.gmc_funcs->get_vm_pde((adev), (level), (dst), (flags))\n#define amdgpu_gmc_get_vm_pte(adev, mapping, flags) (adev)->gmc.gmc_funcs->get_vm_pte((adev), (mapping), (flags))\n#define amdgpu_gmc_override_vm_pte_flags(adev, vm, addr, pte_flags)\t\\\n\t(adev)->gmc.gmc_funcs->override_vm_pte_flags\t\t\t\\\n\t\t((adev), (vm), (addr), (pte_flags))\n#define amdgpu_gmc_get_vbios_fb_size(adev) (adev)->gmc.gmc_funcs->get_vbios_fb_size((adev))\n\n \nstatic inline bool amdgpu_gmc_vram_full_visible(struct amdgpu_gmc *gmc)\n{\n\tWARN_ON(gmc->real_vram_size < gmc->visible_vram_size);\n\n\treturn (gmc->real_vram_size == gmc->visible_vram_size);\n}\n\n \nstatic inline uint64_t amdgpu_gmc_sign_extend(uint64_t addr)\n{\n\tif (addr >= AMDGPU_GMC_HOLE_START)\n\t\taddr |= AMDGPU_GMC_HOLE_END;\n\n\treturn addr;\n}\n\nint amdgpu_gmc_pdb0_alloc(struct amdgpu_device *adev);\nvoid amdgpu_gmc_get_pde_for_bo(struct amdgpu_bo *bo, int level,\n\t\t\t       uint64_t *addr, uint64_t *flags);\nint amdgpu_gmc_set_pte_pde(struct amdgpu_device *adev, void *cpu_pt_addr,\n\t\t\t\tuint32_t gpu_page_idx, uint64_t addr,\n\t\t\t\tuint64_t flags);\nuint64_t amdgpu_gmc_pd_addr(struct amdgpu_bo *bo);\nuint64_t amdgpu_gmc_agp_addr(struct ttm_buffer_object *bo);\nvoid amdgpu_gmc_sysvm_location(struct amdgpu_device *adev, struct amdgpu_gmc *mc);\nvoid amdgpu_gmc_vram_location(struct amdgpu_device *adev, struct amdgpu_gmc *mc,\n\t\t\t      u64 base);\nvoid amdgpu_gmc_gart_location(struct amdgpu_device *adev,\n\t\t\t      struct amdgpu_gmc *mc);\nvoid amdgpu_gmc_agp_location(struct amdgpu_device *adev,\n\t\t\t     struct amdgpu_gmc *mc);\nbool amdgpu_gmc_filter_faults(struct amdgpu_device *adev,\n\t\t\t      struct amdgpu_ih_ring *ih, uint64_t addr,\n\t\t\t      uint16_t pasid, uint64_t timestamp);\nvoid amdgpu_gmc_filter_faults_remove(struct amdgpu_device *adev, uint64_t addr,\n\t\t\t\t     uint16_t pasid);\nint amdgpu_gmc_ras_sw_init(struct amdgpu_device *adev);\nint amdgpu_gmc_ras_late_init(struct amdgpu_device *adev);\nvoid amdgpu_gmc_ras_fini(struct amdgpu_device *adev);\nint amdgpu_gmc_allocate_vm_inv_eng(struct amdgpu_device *adev);\n\nextern void amdgpu_gmc_tmz_set(struct amdgpu_device *adev);\nextern void amdgpu_gmc_noretry_set(struct amdgpu_device *adev);\n\nextern void\namdgpu_gmc_set_vm_fault_masks(struct amdgpu_device *adev, int hub_type,\n\t\t\t      bool enable);\n\nvoid amdgpu_gmc_get_vbios_allocations(struct amdgpu_device *adev);\n\nvoid amdgpu_gmc_init_pdb0(struct amdgpu_device *adev);\nuint64_t amdgpu_gmc_vram_mc2pa(struct amdgpu_device *adev, uint64_t mc_addr);\nuint64_t amdgpu_gmc_vram_pa(struct amdgpu_device *adev, struct amdgpu_bo *bo);\nuint64_t amdgpu_gmc_vram_cpu_pa(struct amdgpu_device *adev, struct amdgpu_bo *bo);\nint amdgpu_gmc_vram_checking(struct amdgpu_device *adev);\nint amdgpu_gmc_sysfs_init(struct amdgpu_device *adev);\nvoid amdgpu_gmc_sysfs_fini(struct amdgpu_device *adev);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}