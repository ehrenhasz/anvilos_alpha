{
  "module_name": "gfxhub_v1_1.c",
  "hash_id": "4e3b7d563c3ff0b86e10692c781333f2a995bf9d3e256b279b66b81c6955591d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/gfxhub_v1_1.c",
  "human_readable_source": " \n#include \"amdgpu.h\"\n#include \"gfxhub_v1_1.h\"\n\n#include \"gc/gc_9_2_1_offset.h\"\n#include \"gc/gc_9_2_1_sh_mask.h\"\n\n#include \"soc15_common.h\"\n\n#define mmMC_VM_XGMI_LFB_CNTL_ALDE\t\t\t0x0978\n#define mmMC_VM_XGMI_LFB_CNTL_ALDE_BASE_IDX\t\t0\n#define mmMC_VM_XGMI_LFB_SIZE_ALDE\t\t\t0x0979\n#define mmMC_VM_XGMI_LFB_SIZE_ALDE_BASE_IDX\t\t0\n\n#define MC_VM_XGMI_LFB_CNTL_ALDE__PF_LFB_REGION__SHIFT\t0x0\n#define MC_VM_XGMI_LFB_CNTL_ALDE__PF_MAX_REGION__SHIFT\t0x4\n#define MC_VM_XGMI_LFB_CNTL_ALDE__PF_LFB_REGION_MASK\t0x0000000FL\n#define MC_VM_XGMI_LFB_CNTL_ALDE__PF_MAX_REGION_MASK\t0x000000F0L\n\n#define MC_VM_XGMI_LFB_SIZE_ALDE__PF_LFB_SIZE__SHIFT\t0x0\n#define MC_VM_XGMI_LFB_SIZE_ALDE__PF_LFB_SIZE_MASK\t0x0001FFFFL\n\nint gfxhub_v1_1_get_xgmi_info(struct amdgpu_device *adev)\n{\n\tu32 max_num_physical_nodes;\n\tu32 max_physical_node_id;\n\tu32 xgmi_lfb_cntl;\n\tu32 max_region;\n\tu64 seg_size;\n\n\tif (adev->asic_type == CHIP_ALDEBARAN) {\n\t\txgmi_lfb_cntl = RREG32_SOC15(GC, 0, mmMC_VM_XGMI_LFB_CNTL_ALDE);\n\t\tseg_size = REG_GET_FIELD(\n\t\t\tRREG32_SOC15(GC, 0, mmMC_VM_XGMI_LFB_SIZE_ALDE),\n\t\t\tMC_VM_XGMI_LFB_SIZE, PF_LFB_SIZE) << 24;\n\t\tmax_region =\n\t\t\tREG_GET_FIELD(xgmi_lfb_cntl, MC_VM_XGMI_LFB_CNTL_ALDE, PF_MAX_REGION);\n\t} else {\n\t\txgmi_lfb_cntl = RREG32_SOC15(GC, 0, mmMC_VM_XGMI_LFB_CNTL);\n\t\tseg_size = REG_GET_FIELD(\n\t\t\tRREG32_SOC15(GC, 0, mmMC_VM_XGMI_LFB_SIZE),\n\t\t\tMC_VM_XGMI_LFB_SIZE, PF_LFB_SIZE) << 24;\n\t\tmax_region =\n\t\t\tREG_GET_FIELD(xgmi_lfb_cntl, MC_VM_XGMI_LFB_CNTL, PF_MAX_REGION);\n\t}\n\n\n\n\tswitch (adev->asic_type) {\n\tcase CHIP_VEGA20:\n\t\tmax_num_physical_nodes   = 4;\n\t\tmax_physical_node_id     = 3;\n\t\tbreak;\n\tcase CHIP_ARCTURUS:\n\t\tmax_num_physical_nodes   = 8;\n\t\tmax_physical_node_id     = 7;\n\t\tbreak;\n\tcase CHIP_ALDEBARAN:\n\t\tmax_num_physical_nodes   = 16;\n\t\tmax_physical_node_id     = 15;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tif (max_region || adev->gmc.xgmi.connected_to_cpu) {\n\t\tadev->gmc.xgmi.num_physical_nodes = max_region + 1;\n\n\t\tif (adev->gmc.xgmi.num_physical_nodes > max_num_physical_nodes)\n\t\t\treturn -EINVAL;\n\n\t\tif (adev->asic_type == CHIP_ALDEBARAN) {\n\t\t\tadev->gmc.xgmi.physical_node_id =\n\t\t\t\tREG_GET_FIELD(xgmi_lfb_cntl, MC_VM_XGMI_LFB_CNTL_ALDE,\n\t\t\t\t\t\tPF_LFB_REGION);\n\t\t} else {\n\t\t\tadev->gmc.xgmi.physical_node_id =\n\t\t\t\tREG_GET_FIELD(xgmi_lfb_cntl, MC_VM_XGMI_LFB_CNTL,\n\t\t\t\t\t\tPF_LFB_REGION);\n\t\t}\n\n\t\tif (adev->gmc.xgmi.physical_node_id > max_physical_node_id)\n\t\t\treturn -EINVAL;\n\n\t\tadev->gmc.xgmi.node_segment_size = seg_size;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}