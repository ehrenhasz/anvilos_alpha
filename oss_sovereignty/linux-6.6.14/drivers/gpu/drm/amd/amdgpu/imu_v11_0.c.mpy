{
  "module_name": "imu_v11_0.c",
  "hash_id": "ac53d6a994a8f5699534a9e33912ec6c197856277318597afc8f138dcba82088",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/imu_v11_0.c",
  "human_readable_source": " \n\n#include <linux/firmware.h>\n#include \"amdgpu.h\"\n#include \"amdgpu_imu.h\"\n#include \"amdgpu_dpm.h\"\n\n#include \"imu_v11_0_3.h\"\n\n#include \"gc/gc_11_0_0_offset.h\"\n#include \"gc/gc_11_0_0_sh_mask.h\"\n\nMODULE_FIRMWARE(\"amdgpu/gc_11_0_0_imu.bin\");\nMODULE_FIRMWARE(\"amdgpu/gc_11_0_1_imu.bin\");\nMODULE_FIRMWARE(\"amdgpu/gc_11_0_2_imu.bin\");\nMODULE_FIRMWARE(\"amdgpu/gc_11_0_3_imu.bin\");\nMODULE_FIRMWARE(\"amdgpu/gc_11_0_4_imu.bin\");\n\nstatic int imu_v11_0_init_microcode(struct amdgpu_device *adev)\n{\n\tchar fw_name[40];\n\tchar ucode_prefix[30];\n\tint err;\n\tconst struct imu_firmware_header_v1_0 *imu_hdr;\n\tstruct amdgpu_firmware_info *info = NULL;\n\n\tDRM_DEBUG(\"\\n\");\n\n\tamdgpu_ucode_ip_version_decode(adev, GC_HWIP, ucode_prefix, sizeof(ucode_prefix));\n\n\tsnprintf(fw_name, sizeof(fw_name), \"amdgpu/%s_imu.bin\", ucode_prefix);\n\terr = amdgpu_ucode_request(adev, &adev->gfx.imu_fw, fw_name);\n\tif (err)\n\t\tgoto out;\n\timu_hdr = (const struct imu_firmware_header_v1_0 *)adev->gfx.imu_fw->data;\n\tadev->gfx.imu_fw_version = le32_to_cpu(imu_hdr->header.ucode_version);\n\t\n\t\n\tif (adev->firmware.load_type == AMDGPU_FW_LOAD_PSP) {\n\t\tinfo = &adev->firmware.ucode[AMDGPU_UCODE_ID_IMU_I];\n\t\tinfo->ucode_id = AMDGPU_UCODE_ID_IMU_I;\n\t\tinfo->fw = adev->gfx.imu_fw;\n\t\tadev->firmware.fw_size +=\n\t\t\tALIGN(le32_to_cpu(imu_hdr->imu_iram_ucode_size_bytes), PAGE_SIZE);\n\t\tinfo = &adev->firmware.ucode[AMDGPU_UCODE_ID_IMU_D];\n\t\tinfo->ucode_id = AMDGPU_UCODE_ID_IMU_D;\n\t\tinfo->fw = adev->gfx.imu_fw;\n\t\tadev->firmware.fw_size +=\n\t\t\tALIGN(le32_to_cpu(imu_hdr->imu_dram_ucode_size_bytes), PAGE_SIZE);\n\t}\n\nout:\n\tif (err) {\n\t\tdev_err(adev->dev,\n\t\t\t\"gfx11: Failed to load firmware \\\"%s\\\"\\n\",\n\t\t\tfw_name);\n\t\tamdgpu_ucode_release(&adev->gfx.imu_fw);\n\t}\n\n\treturn err;\n}\n\nstatic int imu_v11_0_load_microcode(struct amdgpu_device *adev)\n{\n\tconst struct imu_firmware_header_v1_0 *hdr;\n\tconst __le32 *fw_data;\n\tunsigned i, fw_size;\n\n\tif (!adev->gfx.imu_fw)\n\t\treturn -EINVAL;\n\n\thdr = (const struct imu_firmware_header_v1_0 *)adev->gfx.imu_fw->data;\n\t\n\n\tfw_data = (const __le32 *)(adev->gfx.imu_fw->data +\n\t\t\tle32_to_cpu(hdr->header.ucode_array_offset_bytes));\n\tfw_size = le32_to_cpu(hdr->imu_iram_ucode_size_bytes) / 4;\n\n\tWREG32_SOC15(GC, 0, regGFX_IMU_I_RAM_ADDR, 0);\n\n\tfor (i = 0; i < fw_size; i++)\n\t\tWREG32_SOC15(GC, 0, regGFX_IMU_I_RAM_DATA, le32_to_cpup(fw_data++));\n\n\tWREG32_SOC15(GC, 0, regGFX_IMU_I_RAM_ADDR, adev->gfx.imu_fw_version);\n\n\tfw_data = (const __le32 *)(adev->gfx.imu_fw->data +\n\t\t\tle32_to_cpu(hdr->header.ucode_array_offset_bytes) +\n\t\t\tle32_to_cpu(hdr->imu_iram_ucode_size_bytes));\n\tfw_size = le32_to_cpu(hdr->imu_dram_ucode_size_bytes) / 4;\n\n\tWREG32_SOC15(GC, 0, regGFX_IMU_D_RAM_ADDR, 0);\n\n\tfor (i = 0; i < fw_size; i++)\n\t\tWREG32_SOC15(GC, 0, regGFX_IMU_D_RAM_DATA, le32_to_cpup(fw_data++));\n\n\tWREG32_SOC15(GC, 0, regGFX_IMU_D_RAM_ADDR, adev->gfx.imu_fw_version);\n\n\treturn 0;\n}\n\nstatic int imu_v11_0_wait_for_reset_status(struct amdgpu_device *adev)\n{\n\tint i, imu_reg_val = 0;\n\n\tfor (i = 0; i < adev->usec_timeout; i++) {\n\t\timu_reg_val = RREG32_SOC15(GC, 0, regGFX_IMU_GFX_RESET_CTRL);\n\t\tif ((imu_reg_val & 0x1f) == 0x1f)\n\t\t\tbreak;\n\t\tudelay(1);\n\t}\n\n\tif (i >= adev->usec_timeout) {\n\t\tdev_err(adev->dev, \"init imu: IMU start timeout\\n\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\treturn 0;\n}\n\nstatic void imu_v11_0_setup(struct amdgpu_device *adev)\n{\n\tint imu_reg_val;\n\n\t\n\tWREG32_SOC15(GC, 0, regGFX_IMU_C2PMSG_ACCESS_CTRL0, 0xffffff);\n\tWREG32_SOC15(GC, 0, regGFX_IMU_C2PMSG_ACCESS_CTRL1, 0xffff);\n\n\tif (adev->gfx.imu.mode == DEBUG_MODE) {\n\t\timu_reg_val = RREG32_SOC15(GC, 0, regGFX_IMU_C2PMSG_16);\n\t\timu_reg_val |= 0x1;\n\t\tWREG32_SOC15(GC, 0, regGFX_IMU_C2PMSG_16, imu_reg_val);\n\t}\n\n\t\n\timu_reg_val = RREG32_SOC15(GC, 0, regGFX_IMU_SCRATCH_10);\n\timu_reg_val |= 0x10007;\n\tWREG32_SOC15(GC, 0, regGFX_IMU_SCRATCH_10, imu_reg_val);\n}\n\nstatic int imu_v11_0_start(struct amdgpu_device *adev)\n{\n\tint imu_reg_val;\n\n\t\n\timu_reg_val = RREG32_SOC15(GC, 0, regGFX_IMU_CORE_CTRL);\n\timu_reg_val &= 0xfffffffe;\n\tWREG32_SOC15(GC, 0, regGFX_IMU_CORE_CTRL, imu_reg_val);\n\n\tif (adev->flags & AMD_IS_APU)\n\t\tamdgpu_dpm_set_gfx_power_up_by_imu(adev);\n\n\treturn imu_v11_0_wait_for_reset_status(adev);\n}\n\nstatic const struct imu_rlc_ram_golden imu_rlc_ram_golden_11[] =\n{\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_IO_RD_COMBINE_FLUSH, 0x00055555, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_IO_WR_COMBINE_FLUSH, 0x00055555, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_DRAM_COMBINE_FLUSH, 0x00555555, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_MISC2, 0x00001ffe, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_CREDITS , 0x003f3fff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_TAG_RESERVE1, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCC_RESERVE0, 0x00041000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCC_RESERVE1, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCD_RESERVE0, 0x00040000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCD_RESERVE1, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_MISC, 0x00000017, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_ENABLE, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_CREDITS , 0x003f3fbf, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_TAG_RESERVE0, 0x10201000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_TAG_RESERVE1, 0x00000080, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_VCC_RESERVE0, 0x1d041040, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_VCC_RESERVE1, 0x80000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_IO_PRIORITY, 0x88888888, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_MAM_CTRL, 0x0000d800, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_ARB_FINAL, 0x000003f7, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_ENABLE, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_PROTECTION_FAULT_CNTL2, 0x00020000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_APT_CNTL, 0x0000000c, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_CACHEABLE_DRAM_ADDRESS_END, 0x000fffff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_MISC, 0x0c48bff0, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_GC_SA_UNIT_DISABLE, 0x00fffc01, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_GC_PRIM_CONFIG, 0x000fffe1, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_RB_BACKEND_DISABLE, 0x0fffff01, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_GC_SHADER_ARRAY_CONFIG, 0xfffe0001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_MX_L1_TLB_CNTL, 0x00000500, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_SYSTEM_APERTURE_LOW_ADDR, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_SYSTEM_APERTURE_HIGH_ADDR, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_LOCAL_FB_ADDRESS_START, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_LOCAL_FB_ADDRESS_END, 0x000fffff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT0_CNTL, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT1_CNTL, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_NB_TOP_OF_DRAM_SLOT1, 0xff800000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_NB_LOWER_TOP_OF_DRAM2, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_NB_UPPER_TOP_OF_DRAM2, 0x00000fff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_PROTECTION_FAULT_CNTL, 0x00001ffc, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_MX_L1_TLB_CNTL, 0x00000501, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL, 0x00080603, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL2, 0x00000003, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL3, 0x00100003, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL5, 0x00003fe0, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT0_CNTL, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CONTEXT0_PER_PFVF_PTE_CACHE_FRAGMENT_SIZES, 0x00000c00, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT1_CNTL, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CONTEXT1_PER_PFVF_PTE_CACHE_FRAGMENT_SIZES, 0x00000c00, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGB_ADDR_CONFIG, 0x00000545, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGL2_PIPE_STEER_0, 0x13455431, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGL2_PIPE_STEER_1, 0x13455431, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGL2_PIPE_STEER_2, 0x76027602, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGL2_PIPE_STEER_3, 0x76207620, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGB_ADDR_CONFIG, 0x00000345, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCUTCL2_HARVEST_BYPASS_GROUPS, 0x0000003e, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_FB_LOCATION_BASE, 0x00006000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_FB_LOCATION_TOP, 0x000061ff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_APT_CNTL, 0x0000000c, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_AGP_BASE, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_AGP_BOT, 0x00000002, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_AGP_TOP, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_PROTECTION_FAULT_CNTL2, 0x00020000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regSDMA0_UCODE_SELFLOAD_CONTROL, 0x00000210, 0), \n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regSDMA1_UCODE_SELFLOAD_CONTROL, 0x00000210, 0), \n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCPC_PSP_DEBUG, CPC_PSP_DEBUG__GPA_OVERRIDE_MASK, 0), \n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCPG_PSP_DEBUG, CPG_PSP_DEBUG__GPA_OVERRIDE_MASK, 0)\n};\n\nstatic const struct imu_rlc_ram_golden imu_rlc_ram_golden_11_0_2[] =\n{\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_MISC, 0x0c48bff0, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_CREDITS, 0x003f3fbf, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_TAG_RESERVE0, 0x10200800, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_TAG_RESERVE1, 0x00000088, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_VCC_RESERVE0, 0x1d041040, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_VCC_RESERVE1, 0x80000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_IO_PRIORITY, 0x88888888, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_MAM_CTRL, 0x0000d800, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_ARB_FINAL, 0x000007ef, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_DRAM_PAGE_BURST, 0x20080200, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCEA_SDP_ENABLE, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_APT_CNTL, 0x0000000c, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_CACHEABLE_DRAM_ADDRESS_END, 0x000fffff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_IO_RD_COMBINE_FLUSH, 0x00055555, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_IO_WR_COMBINE_FLUSH, 0x00055555, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_DRAM_COMBINE_FLUSH, 0x00555555, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_MISC2, 0x00001ffe, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_CREDITS, 0x003f3fff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_TAG_RESERVE1, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCC_RESERVE0, 0x00041000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCC_RESERVE1, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCD_RESERVE0, 0x00040000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_VCD_RESERVE1, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_MISC, 0x00000017, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGUS_SDP_ENABLE, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_GC_SA_UNIT_DISABLE, 0x00fffc01, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_GC_PRIM_CONFIG, 0x000fffe1, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_RB_BACKEND_DISABLE, 0x00000f01, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCC_GC_SHADER_ARRAY_CONFIG, 0xfffe0001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGL1_PIPE_STEER, 0x000000e4, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCH_PIPE_STEER, 0x000000e4, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGL2_PIPE_STEER_0, 0x01231023, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGB_ADDR_CONFIG, 0x00000243, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCUTCL2_HARVEST_BYPASS_GROUPS, 0x00000002, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_MX_L1_TLB_CNTL, 0x00000500, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_SYSTEM_APERTURE_LOW_ADDR, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_SYSTEM_APERTURE_HIGH_ADDR, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_LOCAL_FB_ADDRESS_START, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_LOCAL_FB_ADDRESS_END, 0x000001ff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_FB_LOCATION_BASE, 0x00006000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_FB_LOCATION_TOP, 0x000061ff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT0_CNTL, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT1_CNTL, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_APT_CNTL, 0x0000000c, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_NB_TOP_OF_DRAM_SLOT1, 0xff800000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_NB_LOWER_TOP_OF_DRAM2, 0x00000001, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_NB_UPPER_TOP_OF_DRAM2, 0x00000fff, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_AGP_BASE, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_AGP_BOT, 0x00000002, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_AGP_TOP, 0x00000000, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_PROTECTION_FAULT_CNTL, 0x00001ffc, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_PROTECTION_FAULT_CNTL2, 0x00002825, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCMC_VM_MX_L1_TLB_CNTL, 0x00000501, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL, 0x00080603, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL2, 0x00000003, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL3, 0x00100003, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CNTL5, 0x00003fe0, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT0_CNTL, 0x00000001, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CONTEXT0_PER_PFVF_PTE_CACHE_FRAGMENT_SIZES, 0x00000c00, 0xe0000000),\n        IMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_CONTEXT1_CNTL, 0x00000001, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regGCVM_L2_CONTEXT1_PER_PFVF_PTE_CACHE_FRAGMENT_SIZES, 0x00000c00, 0xe0000000),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regSDMA0_UCODE_SELFLOAD_CONTROL, 0x00000210, 0),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regSDMA1_UCODE_SELFLOAD_CONTROL, 0x00000210, 0),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCPC_PSP_DEBUG, CPC_PSP_DEBUG__GPA_OVERRIDE_MASK, 0),\n\tIMU_RLC_RAM_GOLDEN_VALUE(GC, 0, regCPG_PSP_DEBUG, CPG_PSP_DEBUG__GPA_OVERRIDE_MASK, 0)\n};\n\nstatic void program_imu_rlc_ram(struct amdgpu_device *adev,\n\t\t\t\tconst struct imu_rlc_ram_golden *regs,\n\t\t\t\tconst u32 array_size)\n{\n\tconst struct imu_rlc_ram_golden *entry;\n\tu32 reg, data;\n\tint i;\n\n\tfor (i = 0; i < array_size; ++i) {\n\t\tentry = &regs[i];\n\t\treg =  adev->reg_offset[entry->hwip][entry->instance][entry->segment] + entry->reg;\n\t\treg |= entry->addr_mask;\n\n\t\tdata = entry->data;\n\t\tif (entry->reg == regGCMC_VM_AGP_BASE)\n\t\t\tdata = 0x00ffffff;\n\t\telse if (entry->reg == regGCMC_VM_AGP_TOP)\n\t\t\tdata = 0x0;\n\t\telse if (entry->reg == regGCMC_VM_FB_LOCATION_BASE)\n\t\t\tdata = adev->gmc.vram_start >> 24;\n\t\telse if (entry->reg == regGCMC_VM_FB_LOCATION_TOP)\n\t\t\tdata = adev->gmc.vram_end >> 24;\n\n\t\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_ADDR_HIGH, 0);\n\t\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_ADDR_LOW, reg);\n\t\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_DATA, data);\n\t}\n\t\n\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_ADDR_HIGH, 0);\n\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_ADDR_LOW, 0);\n\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_DATA, 0);\n}\n\nstatic void imu_v11_0_program_rlc_ram(struct amdgpu_device *adev)\n{\n\tu32 reg_data;\n\n\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_INDEX, 0x2);\n\n\tswitch (adev->ip_versions[GC_HWIP][0]) {\n\tcase IP_VERSION(11, 0, 0):\n\t\tprogram_imu_rlc_ram(adev, imu_rlc_ram_golden_11,\n\t\t\t\t(const u32)ARRAY_SIZE(imu_rlc_ram_golden_11));\n\t\tbreak;\n\tcase IP_VERSION(11, 0, 2):\n\t\tprogram_imu_rlc_ram(adev, imu_rlc_ram_golden_11_0_2,\n\t\t\t\t(const u32)ARRAY_SIZE(imu_rlc_ram_golden_11_0_2));\n\t\tbreak;\n\tcase IP_VERSION(11, 0, 3):\n\t\timu_v11_0_3_program_rlc_ram(adev);\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t\tbreak;\n\t}\n\n\t\n\treg_data = RREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_INDEX);\n\treg_data |= GFX_IMU_RLC_RAM_INDEX__RAM_VALID_MASK;\n\tWREG32_SOC15(GC, 0, regGFX_IMU_RLC_RAM_INDEX, reg_data);\n}\n\nconst struct amdgpu_imu_funcs gfx_v11_0_imu_funcs = {\n\t.init_microcode = imu_v11_0_init_microcode,\n\t.load_microcode = imu_v11_0_load_microcode,\n\t.setup_imu = imu_v11_0_setup,\n\t.start_imu = imu_v11_0_start,\n\t.program_rlc_ram = imu_v11_0_program_rlc_ram,\n\t.wait_for_reset_status = imu_v11_0_wait_for_reset_status,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}