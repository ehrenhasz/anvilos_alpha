{
  "module_name": "amdgpu_fdinfo.c",
  "hash_id": "3dca00d279215335a33bc063f441b6b7e9b560a2b320ae4df51124547d79965f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_fdinfo.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/list.h>\n#include <linux/module.h>\n#include <linux/uaccess.h>\n#include <linux/reboot.h>\n#include <linux/syscalls.h>\n\n#include <drm/amdgpu_drm.h>\n#include <drm/drm_debugfs.h>\n#include <drm/drm_drv.h>\n\n#include \"amdgpu.h\"\n#include \"amdgpu_vm.h\"\n#include \"amdgpu_gem.h\"\n#include \"amdgpu_ctx.h\"\n#include \"amdgpu_fdinfo.h\"\n\n\nstatic const char *amdgpu_ip_name[AMDGPU_HW_IP_NUM] = {\n\t[AMDGPU_HW_IP_GFX]\t=\t\"gfx\",\n\t[AMDGPU_HW_IP_COMPUTE]\t=\t\"compute\",\n\t[AMDGPU_HW_IP_DMA]\t=\t\"dma\",\n\t[AMDGPU_HW_IP_UVD]\t=\t\"dec\",\n\t[AMDGPU_HW_IP_VCE]\t=\t\"enc\",\n\t[AMDGPU_HW_IP_UVD_ENC]\t=\t\"enc_1\",\n\t[AMDGPU_HW_IP_VCN_DEC]\t=\t\"dec\",\n\t[AMDGPU_HW_IP_VCN_ENC]\t=\t\"enc\",\n\t[AMDGPU_HW_IP_VCN_JPEG]\t=\t\"jpeg\",\n};\n\nvoid amdgpu_show_fdinfo(struct drm_printer *p, struct drm_file *file)\n{\n\tstruct amdgpu_device *adev = drm_to_adev(file->minor->dev);\n\tstruct amdgpu_fpriv *fpriv = file->driver_priv;\n\tstruct amdgpu_vm *vm = &fpriv->vm;\n\n\tstruct amdgpu_mem_stats stats;\n\tktime_t usage[AMDGPU_HW_IP_NUM];\n\tuint32_t bus, dev, fn, domain;\n\tunsigned int hw_ip;\n\tint ret;\n\n\tmemset(&stats, 0, sizeof(stats));\n\tbus = adev->pdev->bus->number;\n\tdomain = pci_domain_nr(adev->pdev->bus);\n\tdev = PCI_SLOT(adev->pdev->devfn);\n\tfn = PCI_FUNC(adev->pdev->devfn);\n\n\tret = amdgpu_bo_reserve(vm->root.bo, false);\n\tif (ret)\n\t\treturn;\n\n\tamdgpu_vm_get_memory(vm, &stats);\n\tamdgpu_bo_unreserve(vm->root.bo);\n\n\tamdgpu_ctx_mgr_usage(&fpriv->ctx_mgr, usage);\n\n\t \n\n\tdrm_printf(p, \"pasid:\\t%u\\n\", fpriv->vm.pasid);\n\tdrm_printf(p, \"drm-driver:\\t%s\\n\", file->minor->dev->driver->name);\n\tdrm_printf(p, \"drm-pdev:\\t%04x:%02x:%02x.%d\\n\", domain, bus, dev, fn);\n\tdrm_printf(p, \"drm-client-id:\\t%llu\\n\", vm->immediate.fence_context);\n\tdrm_printf(p, \"drm-memory-vram:\\t%llu KiB\\n\", stats.vram/1024UL);\n\tdrm_printf(p, \"drm-memory-gtt: \\t%llu KiB\\n\", stats.gtt/1024UL);\n\tdrm_printf(p, \"drm-memory-cpu: \\t%llu KiB\\n\", stats.cpu/1024UL);\n\tdrm_printf(p, \"amd-memory-visible-vram:\\t%llu KiB\\n\",\n\t\t   stats.visible_vram/1024UL);\n\tdrm_printf(p, \"amd-evicted-vram:\\t%llu KiB\\n\",\n\t\t   stats.evicted_vram/1024UL);\n\tdrm_printf(p, \"amd-evicted-visible-vram:\\t%llu KiB\\n\",\n\t\t   stats.evicted_visible_vram/1024UL);\n\tdrm_printf(p, \"amd-requested-vram:\\t%llu KiB\\n\",\n\t\t   stats.requested_vram/1024UL);\n\tdrm_printf(p, \"amd-requested-visible-vram:\\t%llu KiB\\n\",\n\t\t   stats.requested_visible_vram/1024UL);\n\tdrm_printf(p, \"amd-requested-gtt:\\t%llu KiB\\n\",\n\t\t   stats.requested_gtt/1024UL);\n\tfor (hw_ip = 0; hw_ip < AMDGPU_HW_IP_NUM; ++hw_ip) {\n\t\tif (!usage[hw_ip])\n\t\t\tcontinue;\n\n\t\tdrm_printf(p, \"drm-engine-%s:\\t%lld ns\\n\", amdgpu_ip_name[hw_ip],\n\t\t\t   ktime_to_ns(usage[hw_ip]));\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}