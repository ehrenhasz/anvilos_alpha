{
  "module_name": "hdp_v6_0.c",
  "hash_id": "6ff42147f354a80c135481abff0ab5c42631367948e08cf73250695facf52f5c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/hdp_v6_0.c",
  "human_readable_source": " \n#include \"amdgpu.h\"\n#include \"amdgpu_atombios.h\"\n#include \"hdp_v6_0.h\"\n\n#include \"hdp/hdp_6_0_0_offset.h\"\n#include \"hdp/hdp_6_0_0_sh_mask.h\"\n#include <uapi/linux/kfd_ioctl.h>\n\nstatic void hdp_v6_0_flush_hdp(struct amdgpu_device *adev,\n\t\t\t\tstruct amdgpu_ring *ring)\n{\n\tif (!ring || !ring->funcs->emit_wreg)\n\t\tWREG32_NO_KIQ((adev->rmmio_remap.reg_offset + KFD_MMIO_REMAP_HDP_MEM_FLUSH_CNTL) >> 2, 0);\n\telse\n\t\tamdgpu_ring_emit_wreg(ring, (adev->rmmio_remap.reg_offset + KFD_MMIO_REMAP_HDP_MEM_FLUSH_CNTL) >> 2, 0);\n}\n\nstatic void hdp_v6_0_update_clock_gating(struct amdgpu_device *adev,\n\t\t\t\t\t bool enable)\n{\n\tuint32_t hdp_clk_cntl, hdp_clk_cntl1;\n\tuint32_t hdp_mem_pwr_cntl;\n\n\tif (!(adev->cg_flags & (AMD_CG_SUPPORT_HDP_LS |\n\t\t\t\tAMD_CG_SUPPORT_HDP_DS |\n\t\t\t\tAMD_CG_SUPPORT_HDP_SD)))\n\t\treturn;\n\n\thdp_clk_cntl = hdp_clk_cntl1 = RREG32_SOC15(HDP, 0,regHDP_CLK_CNTL);\n\thdp_mem_pwr_cntl = RREG32_SOC15(HDP, 0, regHDP_MEM_POWER_CTRL);\n\n\t \n\thdp_clk_cntl = REG_SET_FIELD(hdp_clk_cntl, HDP_CLK_CNTL,\n\t\t\t\t     RC_MEM_CLK_SOFT_OVERRIDE, 1);\n\tWREG32_SOC15(HDP, 0, regHDP_CLK_CNTL, hdp_clk_cntl);\n\n\t \n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t ATOMIC_MEM_POWER_CTRL_EN, 0);\n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t ATOMIC_MEM_POWER_LS_EN, 0);\n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t ATOMIC_MEM_POWER_DS_EN, 0);\n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t ATOMIC_MEM_POWER_SD_EN, 0);\n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t RC_MEM_POWER_CTRL_EN, 0);\n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t RC_MEM_POWER_LS_EN, 0);\n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t RC_MEM_POWER_DS_EN, 0);\n\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t RC_MEM_POWER_SD_EN, 0);\n\tWREG32_SOC15(HDP, 0, regHDP_MEM_POWER_CTRL, hdp_mem_pwr_cntl);\n\n\t \n\tif (enable) {\n\t\t \n\t\tif (adev->cg_flags & AMD_CG_SUPPORT_HDP_SD) {\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl,\n\t\t\t\t\t\t\t HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t ATOMIC_MEM_POWER_SD_EN, 1);\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl,\n\t\t\t\t\t\t\t HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t RC_MEM_POWER_SD_EN, 1);\n\t\t} else if (adev->cg_flags & AMD_CG_SUPPORT_HDP_LS) {\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl,\n\t\t\t\t\t\t\t HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t ATOMIC_MEM_POWER_LS_EN, 1);\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl,\n\t\t\t\t\t\t\t HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t RC_MEM_POWER_LS_EN, 1);\n\t\t} else if (adev->cg_flags & AMD_CG_SUPPORT_HDP_DS) {\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl,\n\t\t\t\t\t\t\t HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t ATOMIC_MEM_POWER_DS_EN, 1);\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl,\n\t\t\t\t\t\t\t HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t RC_MEM_POWER_DS_EN, 1);\n\t\t}\n\n\t\t \n\t\tif (adev->cg_flags & (AMD_CG_SUPPORT_HDP_LS | AMD_CG_SUPPORT_HDP_DS |\n\t\t\t\t      AMD_CG_SUPPORT_HDP_SD)) {\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t ATOMIC_MEM_POWER_CTRL_EN, 1);\n\t\t\thdp_mem_pwr_cntl = REG_SET_FIELD(hdp_mem_pwr_cntl, HDP_MEM_POWER_CTRL,\n\t\t\t\t\t\t\t RC_MEM_POWER_CTRL_EN, 1);\n\t\t\tWREG32_SOC15(HDP, 0, regHDP_MEM_POWER_CTRL, hdp_mem_pwr_cntl);\n\t\t}\n\t}\n\n\t \n\thdp_clk_cntl = REG_SET_FIELD(hdp_clk_cntl, HDP_CLK_CNTL,\n\t\t\t\t     RC_MEM_CLK_SOFT_OVERRIDE, 0);\n\tWREG32_SOC15(HDP, 0, regHDP_CLK_CNTL, hdp_clk_cntl);\n}\n\nstatic void hdp_v6_0_get_clockgating_state(struct amdgpu_device *adev,\n\t\t\t\t\t    u64 *flags)\n{\n\tuint32_t tmp;\n\n\t \n\ttmp = RREG32_SOC15(HDP, 0, regHDP_MEM_POWER_CTRL);\n\tif (tmp & HDP_MEM_POWER_CTRL__ATOMIC_MEM_POWER_LS_EN_MASK)\n\t\t*flags |= AMD_CG_SUPPORT_HDP_LS;\n\telse if (tmp & HDP_MEM_POWER_CTRL__ATOMIC_MEM_POWER_DS_EN_MASK)\n\t\t*flags |= AMD_CG_SUPPORT_HDP_DS;\n\telse if (tmp & HDP_MEM_POWER_CTRL__ATOMIC_MEM_POWER_SD_EN_MASK)\n\t\t*flags |= AMD_CG_SUPPORT_HDP_SD;\n}\n\nconst struct amdgpu_hdp_funcs hdp_v6_0_funcs = {\n\t.flush_hdp = hdp_v6_0_flush_hdp,\n\t.update_clock_gating = hdp_v6_0_update_clock_gating,\n\t.get_clock_gating_state = hdp_v6_0_get_clockgating_state,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}