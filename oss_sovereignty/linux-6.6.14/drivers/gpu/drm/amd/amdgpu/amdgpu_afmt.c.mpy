{
  "module_name": "amdgpu_afmt.c",
  "hash_id": "184f65f4fe58cae1828fa3100deff4f294e9323882e394f3e1e11a1d09a3b6aa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_afmt.c",
  "human_readable_source": " \n#include <linux/hdmi.h>\n#include <linux/gcd.h>\n\n#include <drm/amdgpu_drm.h>\n#include \"amdgpu.h\"\n\nstatic const struct amdgpu_afmt_acr amdgpu_afmt_predefined_acr[] = {\n     \n     \n    {  25175,  4096,  25175, 28224, 125875,  6144,  25175 },  \n    {  25200,  4096,  25200,  6272,  28000,  6144,  25200 },  \n    {  27000,  4096,  27000,  6272,  30000,  6144,  27000 },  \n    {  27027,  4096,  27027,  6272,  30030,  6144,  27027 },  \n    {  54000,  4096,  54000,  6272,  60000,  6144,  54000 },  \n    {  54054,  4096,  54054,  6272,  60060,  6144,  54054 },  \n    {  74176,  4096,  74176,  5733,  75335,  6144,  74176 },  \n    {  74250,  4096,  74250,  6272,  82500,  6144,  74250 },  \n    { 148352,  4096, 148352,  5733, 150670,  6144, 148352 },  \n    { 148500,  4096, 148500,  6272, 165000,  6144, 148500 },  \n};\n\n\n \nstatic void amdgpu_afmt_calc_cts(uint32_t clock, int *CTS, int *N, int freq)\n{\n\tint n, cts;\n\tunsigned long div, mul;\n\n\t \n\tn = 128 * freq;\n\tcts = clock * 1000;\n\n\t \n\tdiv = gcd(n, cts);\n\n\tn /= div;\n\tcts /= div;\n\n\t \n\tmul = ((128*freq/1000) + (n-1))/n;\n\n\tn *= mul;\n\tcts *= mul;\n\n\t \n\tif (n < (128*freq/1500))\n\t\tpr_warn(\"Calculated ACR N value is too small. You may experience audio problems.\\n\");\n\tif (n > (128*freq/300))\n\t\tpr_warn(\"Calculated ACR N value is too large. You may experience audio problems.\\n\");\n\n\t*N = n;\n\t*CTS = cts;\n\n\tDRM_DEBUG(\"Calculated ACR timing N=%d CTS=%d for frequency %d\\n\",\n\t\t  *N, *CTS, freq);\n}\n\nstruct amdgpu_afmt_acr amdgpu_afmt_acr(uint32_t clock)\n{\n\tstruct amdgpu_afmt_acr res;\n\tu8 i;\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(amdgpu_afmt_predefined_acr); i++) {\n\t\tif (amdgpu_afmt_predefined_acr[i].clock == clock)\n\t\t\treturn amdgpu_afmt_predefined_acr[i];\n\t}\n\n\t \n\tamdgpu_afmt_calc_cts(clock, &res.cts_32khz, &res.n_32khz, 32000);\n\tamdgpu_afmt_calc_cts(clock, &res.cts_44_1khz, &res.n_44_1khz, 44100);\n\tamdgpu_afmt_calc_cts(clock, &res.cts_48khz, &res.n_48khz, 48000);\n\n\treturn res;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}