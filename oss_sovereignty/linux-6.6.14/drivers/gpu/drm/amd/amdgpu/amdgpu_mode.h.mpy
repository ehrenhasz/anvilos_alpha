{
  "module_name": "amdgpu_mode.h",
  "hash_id": "fa3d5d8f396febf0092bdce5dff01820cde2ec3eb3efa3091d56efcb798dbaf6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_mode.h",
  "human_readable_source": " \n\n#ifndef AMDGPU_MODE_H\n#define AMDGPU_MODE_H\n\n#include <drm/display/drm_dp_helper.h>\n#include <drm/drm_crtc.h>\n#include <drm/drm_edid.h>\n#include <drm/drm_encoder.h>\n#include <drm/drm_fixed.h>\n#include <drm/drm_framebuffer.h>\n#include <drm/drm_probe_helper.h>\n#include <linux/i2c.h>\n#include <linux/i2c-algo-bit.h>\n#include <linux/hrtimer.h>\n#include \"amdgpu_irq.h\"\n\n#include <drm/display/drm_dp_mst_helper.h>\n#include \"modules/inc/mod_freesync.h\"\n#include \"amdgpu_dm_irq_params.h\"\n\nstruct amdgpu_bo;\nstruct amdgpu_device;\nstruct amdgpu_encoder;\nstruct amdgpu_router;\nstruct amdgpu_hpd;\n\n#define to_amdgpu_crtc(x) container_of(x, struct amdgpu_crtc, base)\n#define to_amdgpu_connector(x) container_of(x, struct amdgpu_connector, base)\n#define to_amdgpu_encoder(x) container_of(x, struct amdgpu_encoder, base)\n#define to_amdgpu_framebuffer(x) container_of(x, struct amdgpu_framebuffer, base)\n\n#define to_dm_plane_state(x)\tcontainer_of(x, struct dm_plane_state, base)\n\n#define AMDGPU_MAX_HPD_PINS 6\n#define AMDGPU_MAX_CRTCS 6\n#define AMDGPU_MAX_PLANES 6\n#define AMDGPU_MAX_AFMT_BLOCKS 9\n\nenum amdgpu_rmx_type {\n\tRMX_OFF,\n\tRMX_FULL,\n\tRMX_CENTER,\n\tRMX_ASPECT\n};\n\nenum amdgpu_underscan_type {\n\tUNDERSCAN_OFF,\n\tUNDERSCAN_ON,\n\tUNDERSCAN_AUTO,\n};\n\n#define AMDGPU_HPD_CONNECT_INT_DELAY_IN_MS 50\n#define AMDGPU_HPD_DISCONNECT_INT_DELAY_IN_MS 10\n\nenum amdgpu_hpd_id {\n\tAMDGPU_HPD_1 = 0,\n\tAMDGPU_HPD_2,\n\tAMDGPU_HPD_3,\n\tAMDGPU_HPD_4,\n\tAMDGPU_HPD_5,\n\tAMDGPU_HPD_6,\n\tAMDGPU_HPD_NONE = 0xff,\n};\n\nenum amdgpu_crtc_irq {\n\tAMDGPU_CRTC_IRQ_VBLANK1 = 0,\n\tAMDGPU_CRTC_IRQ_VBLANK2,\n\tAMDGPU_CRTC_IRQ_VBLANK3,\n\tAMDGPU_CRTC_IRQ_VBLANK4,\n\tAMDGPU_CRTC_IRQ_VBLANK5,\n\tAMDGPU_CRTC_IRQ_VBLANK6,\n\tAMDGPU_CRTC_IRQ_VLINE1,\n\tAMDGPU_CRTC_IRQ_VLINE2,\n\tAMDGPU_CRTC_IRQ_VLINE3,\n\tAMDGPU_CRTC_IRQ_VLINE4,\n\tAMDGPU_CRTC_IRQ_VLINE5,\n\tAMDGPU_CRTC_IRQ_VLINE6,\n\tAMDGPU_CRTC_IRQ_NONE = 0xff\n};\n\nenum amdgpu_pageflip_irq {\n\tAMDGPU_PAGEFLIP_IRQ_D1 = 0,\n\tAMDGPU_PAGEFLIP_IRQ_D2,\n\tAMDGPU_PAGEFLIP_IRQ_D3,\n\tAMDGPU_PAGEFLIP_IRQ_D4,\n\tAMDGPU_PAGEFLIP_IRQ_D5,\n\tAMDGPU_PAGEFLIP_IRQ_D6,\n\tAMDGPU_PAGEFLIP_IRQ_NONE = 0xff\n};\n\nenum amdgpu_flip_status {\n\tAMDGPU_FLIP_NONE,\n\tAMDGPU_FLIP_PENDING,\n\tAMDGPU_FLIP_SUBMITTED\n};\n\n#define AMDGPU_MAX_I2C_BUS 16\n\n \nstruct amdgpu_i2c_bus_rec {\n\tbool valid;\n\t \n\tuint8_t i2c_id;\n\t \n\tenum amdgpu_hpd_id hpd;\n\t \n\tbool hw_capable;\n\t \n\tbool mm_i2c;\n\t \n\tuint32_t mask_clk_reg;\n\tuint32_t mask_data_reg;\n\tuint32_t a_clk_reg;\n\tuint32_t a_data_reg;\n\tuint32_t en_clk_reg;\n\tuint32_t en_data_reg;\n\tuint32_t y_clk_reg;\n\tuint32_t y_data_reg;\n\tuint32_t mask_clk_mask;\n\tuint32_t mask_data_mask;\n\tuint32_t a_clk_mask;\n\tuint32_t a_data_mask;\n\tuint32_t en_clk_mask;\n\tuint32_t en_data_mask;\n\tuint32_t y_clk_mask;\n\tuint32_t y_data_mask;\n};\n\n#define AMDGPU_MAX_BIOS_CONNECTOR 16\n\n \n#define AMDGPU_PLL_USE_BIOS_DIVS        (1 << 0)\n#define AMDGPU_PLL_NO_ODD_POST_DIV      (1 << 1)\n#define AMDGPU_PLL_USE_REF_DIV          (1 << 2)\n#define AMDGPU_PLL_LEGACY               (1 << 3)\n#define AMDGPU_PLL_PREFER_LOW_REF_DIV   (1 << 4)\n#define AMDGPU_PLL_PREFER_HIGH_REF_DIV  (1 << 5)\n#define AMDGPU_PLL_PREFER_LOW_FB_DIV    (1 << 6)\n#define AMDGPU_PLL_PREFER_HIGH_FB_DIV   (1 << 7)\n#define AMDGPU_PLL_PREFER_LOW_POST_DIV  (1 << 8)\n#define AMDGPU_PLL_PREFER_HIGH_POST_DIV (1 << 9)\n#define AMDGPU_PLL_USE_FRAC_FB_DIV      (1 << 10)\n#define AMDGPU_PLL_PREFER_CLOSEST_LOWER (1 << 11)\n#define AMDGPU_PLL_USE_POST_DIV         (1 << 12)\n#define AMDGPU_PLL_IS_LCD               (1 << 13)\n#define AMDGPU_PLL_PREFER_MINM_OVER_MAXP (1 << 14)\n\nstruct amdgpu_pll {\n\t \n\tuint32_t reference_freq;\n\n\t \n\tuint32_t reference_div;\n\tuint32_t post_div;\n\n\t \n\tuint32_t pll_in_min;\n\tuint32_t pll_in_max;\n\tuint32_t pll_out_min;\n\tuint32_t pll_out_max;\n\tuint32_t lcd_pll_out_min;\n\tuint32_t lcd_pll_out_max;\n\tuint32_t best_vco;\n\n\t \n\tuint32_t min_ref_div;\n\tuint32_t max_ref_div;\n\tuint32_t min_post_div;\n\tuint32_t max_post_div;\n\tuint32_t min_feedback_div;\n\tuint32_t max_feedback_div;\n\tuint32_t min_frac_feedback_div;\n\tuint32_t max_frac_feedback_div;\n\n\t \n\tuint32_t flags;\n\n\t \n\tuint32_t id;\n};\n\nstruct amdgpu_i2c_chan {\n\tstruct i2c_adapter adapter;\n\tstruct drm_device *dev;\n\tstruct i2c_algo_bit_data bit;\n\tstruct amdgpu_i2c_bus_rec rec;\n\tstruct drm_dp_aux aux;\n\tbool has_aux;\n\tstruct mutex mutex;\n};\n\nstruct amdgpu_afmt {\n\tbool enabled;\n\tint offset;\n\tbool last_buffer_filled_status;\n\tint id;\n\tstruct amdgpu_audio_pin *pin;\n};\n\n \nstruct amdgpu_audio_pin {\n\tint\t\t\tchannels;\n\tint\t\t\trate;\n\tint\t\t\tbits_per_sample;\n\tu8\t\t\tstatus_bits;\n\tu8\t\t\tcategory_code;\n\tu32\t\t\toffset;\n\tbool\t\t\tconnected;\n\tu32\t\t\tid;\n};\n\nstruct amdgpu_audio {\n\tbool enabled;\n\tstruct amdgpu_audio_pin pin[AMDGPU_MAX_AFMT_BLOCKS];\n\tint num_pins;\n};\n\nstruct amdgpu_display_funcs {\n\t \n\tvoid (*bandwidth_update)(struct amdgpu_device *adev);\n\t \n\tu32 (*vblank_get_counter)(struct amdgpu_device *adev, int crtc);\n\t \n\tvoid (*backlight_set_level)(struct amdgpu_encoder *amdgpu_encoder,\n\t\t\t\t    u8 level);\n\t \n\tu8 (*backlight_get_level)(struct amdgpu_encoder *amdgpu_encoder);\n\t \n\tbool (*hpd_sense)(struct amdgpu_device *adev, enum amdgpu_hpd_id hpd);\n\tvoid (*hpd_set_polarity)(struct amdgpu_device *adev,\n\t\t\t\t enum amdgpu_hpd_id hpd);\n\tu32 (*hpd_get_gpio_reg)(struct amdgpu_device *adev);\n\t \n\tvoid (*page_flip)(struct amdgpu_device *adev,\n\t\t\t  int crtc_id, u64 crtc_base, bool async);\n\tint (*page_flip_get_scanoutpos)(struct amdgpu_device *adev, int crtc,\n\t\t\t\t\tu32 *vbl, u32 *position);\n\t \n\tvoid (*add_encoder)(struct amdgpu_device *adev,\n\t\t\t    uint32_t encoder_enum,\n\t\t\t    uint32_t supported_device,\n\t\t\t    u16 caps);\n\tvoid (*add_connector)(struct amdgpu_device *adev,\n\t\t\t      uint32_t connector_id,\n\t\t\t      uint32_t supported_device,\n\t\t\t      int connector_type,\n\t\t\t      struct amdgpu_i2c_bus_rec *i2c_bus,\n\t\t\t      uint16_t connector_object_id,\n\t\t\t      struct amdgpu_hpd *hpd,\n\t\t\t      struct amdgpu_router *router);\n\n\n};\n\nstruct amdgpu_framebuffer {\n\tstruct drm_framebuffer base;\n\n\tuint64_t tiling_flags;\n\tbool tmz_surface;\n\n\t \n\tuint64_t address;\n};\n\nstruct amdgpu_mode_info {\n\tstruct atom_context *atom_context;\n\tstruct card_info *atom_card_info;\n\tbool mode_config_initialized;\n\tstruct amdgpu_crtc *crtcs[AMDGPU_MAX_CRTCS];\n\tstruct drm_plane *planes[AMDGPU_MAX_PLANES];\n\tstruct amdgpu_afmt *afmt[AMDGPU_MAX_AFMT_BLOCKS];\n\t \n\tstruct drm_property *coherent_mode_property;\n\t \n\tstruct drm_property *load_detect_property;\n\t \n\tstruct drm_property *underscan_property;\n\tstruct drm_property *underscan_hborder_property;\n\tstruct drm_property *underscan_vborder_property;\n\t \n\tstruct drm_property *audio_property;\n\t \n\tstruct drm_property *dither_property;\n\t \n\tstruct drm_property *abm_level_property;\n\t \n\tstruct edid *bios_hardcoded_edid;\n\tint bios_hardcoded_edid_size;\n\n\t \n\tu32 firmware_flags;\n\t \n\tstruct amdgpu_encoder *bl_encoder;\n\tu8 bl_level;  \n\tstruct amdgpu_audio\taudio;  \n\tint\t\t\tnum_crtc;  \n\tint\t\t\tnum_hpd;  \n\tint\t\t\tnum_dig;  \n\tbool\t\t\tgpu_vm_support;  \n\tint\t\t\tdisp_priority;\n\tconst struct amdgpu_display_funcs *funcs;\n\tconst enum drm_plane_type *plane_type;\n};\n\n#define AMDGPU_MAX_BL_LEVEL 0xFF\n\nstruct amdgpu_backlight_privdata {\n\tstruct amdgpu_encoder *encoder;\n\tuint8_t negative;\n};\n\nstruct amdgpu_atom_ss {\n\tuint16_t percentage;\n\tuint16_t percentage_divider;\n\tuint8_t type;\n\tuint16_t step;\n\tuint8_t delay;\n\tuint8_t range;\n\tuint8_t refdiv;\n\t \n\tuint16_t rate;\n\tuint16_t amount;\n};\n\nstruct amdgpu_crtc {\n\tstruct drm_crtc base;\n\tint crtc_id;\n\tbool enabled;\n\tbool can_tile;\n\tuint32_t crtc_offset;\n\tstruct drm_gem_object *cursor_bo;\n\tuint64_t cursor_addr;\n\tint cursor_x;\n\tint cursor_y;\n\tint cursor_hot_x;\n\tint cursor_hot_y;\n\tint cursor_width;\n\tint cursor_height;\n\tint max_cursor_width;\n\tint max_cursor_height;\n\tenum amdgpu_rmx_type rmx_type;\n\tu8 h_border;\n\tu8 v_border;\n\tfixed20_12 vsc;\n\tfixed20_12 hsc;\n\tstruct drm_display_mode native_mode;\n\tu32 pll_id;\n\t \n\tstruct amdgpu_flip_work *pflip_works;\n\tenum amdgpu_flip_status pflip_status;\n\tint deferred_flip_completion;\n\t \n\tstruct dm_irq_params dm_irq_params;\n\t \n\tstruct amdgpu_atom_ss ss;\n\tbool ss_enabled;\n\tu32 adjusted_clock;\n\tint bpc;\n\tu32 pll_reference_div;\n\tu32 pll_post_div;\n\tu32 pll_flags;\n\tstruct drm_encoder *encoder;\n\tstruct drm_connector *connector;\n\t \n\tu32 line_time;\n\tu32 wm_low;\n\tu32 wm_high;\n\tu32 lb_vblank_lead_lines;\n\tstruct drm_display_mode hw_mode;\n\t \n\tstruct hrtimer vblank_timer;\n\tenum amdgpu_interrupt_state vsync_timer_enabled;\n\n\tint otg_inst;\n\tstruct drm_pending_vblank_event *event;\n};\n\nstruct amdgpu_encoder_atom_dig {\n\tbool linkb;\n\t \n\tbool coherent_mode;\n\tint dig_encoder;  \n\t \n\tuint32_t lcd_misc;\n\tuint16_t panel_pwr_delay;\n\tuint32_t lcd_ss_id;\n\t \n\tstruct drm_display_mode native_mode;\n\tstruct backlight_device *bl_dev;\n\tint dpms_mode;\n\tuint8_t backlight_level;\n\tint panel_mode;\n\tstruct amdgpu_afmt *afmt;\n};\n\nstruct amdgpu_encoder {\n\tstruct drm_encoder base;\n\tuint32_t encoder_enum;\n\tuint32_t encoder_id;\n\tuint32_t devices;\n\tuint32_t active_device;\n\tuint32_t flags;\n\tuint32_t pixel_clock;\n\tenum amdgpu_rmx_type rmx_type;\n\tenum amdgpu_underscan_type underscan_type;\n\tuint32_t underscan_hborder;\n\tuint32_t underscan_vborder;\n\tstruct drm_display_mode native_mode;\n\tvoid *enc_priv;\n\tint audio_polling_active;\n\tbool is_ext_encoder;\n\tu16 caps;\n};\n\nstruct amdgpu_connector_atom_dig {\n\t \n\tu8 dpcd[DP_RECEIVER_CAP_SIZE];\n\tu8 downstream_ports[DP_MAX_DOWNSTREAM_PORTS];\n\tu8 dp_sink_type;\n\tint dp_clock;\n\tint dp_lane_count;\n\tbool edp_on;\n};\n\nstruct amdgpu_gpio_rec {\n\tbool valid;\n\tu8 id;\n\tu32 reg;\n\tu32 mask;\n\tu32 shift;\n};\n\nstruct amdgpu_hpd {\n\tenum amdgpu_hpd_id hpd;\n\tu8 plugged_state;\n\tstruct amdgpu_gpio_rec gpio;\n};\n\nstruct amdgpu_router {\n\tu32 router_id;\n\tstruct amdgpu_i2c_bus_rec i2c_info;\n\tu8 i2c_addr;\n\t \n\tbool ddc_valid;\n\tu8 ddc_mux_type;\n\tu8 ddc_mux_control_pin;\n\tu8 ddc_mux_state;\n\t \n\tbool cd_valid;\n\tu8 cd_mux_type;\n\tu8 cd_mux_control_pin;\n\tu8 cd_mux_state;\n};\n\nenum amdgpu_connector_audio {\n\tAMDGPU_AUDIO_DISABLE = 0,\n\tAMDGPU_AUDIO_ENABLE = 1,\n\tAMDGPU_AUDIO_AUTO = 2\n};\n\nenum amdgpu_connector_dither {\n\tAMDGPU_FMT_DITHER_DISABLE = 0,\n\tAMDGPU_FMT_DITHER_ENABLE = 1,\n};\n\nstruct amdgpu_dm_dp_aux {\n\tstruct drm_dp_aux aux;\n\tstruct ddc_service *ddc_service;\n};\n\nstruct amdgpu_i2c_adapter {\n\tstruct i2c_adapter base;\n\n\tstruct ddc_service *ddc_service;\n};\n\n#define TO_DM_AUX(x) container_of((x), struct amdgpu_dm_dp_aux, aux)\n\nstruct amdgpu_connector {\n\tstruct drm_connector base;\n\tuint32_t connector_id;\n\tuint32_t devices;\n\tstruct amdgpu_i2c_chan *ddc_bus;\n\t \n\tbool shared_ddc;\n\tbool use_digital;\n\t \n\tstruct edid *edid;\n\tvoid *con_priv;\n\tbool dac_load_detect;\n\tbool detected_by_load;  \n\tbool detected_hpd_without_ddc;  \n\tuint16_t connector_object_id;\n\tstruct amdgpu_hpd hpd;\n\tstruct amdgpu_router router;\n\tstruct amdgpu_i2c_chan *router_bus;\n\tenum amdgpu_connector_audio audio;\n\tenum amdgpu_connector_dither dither;\n\tunsigned pixelclock_for_modeset;\n};\n\n \nstruct amdgpu_mst_connector {\n\tstruct amdgpu_connector base;\n\n\tstruct drm_dp_mst_topology_mgr mst_mgr;\n\tstruct amdgpu_dm_dp_aux dm_dp_aux;\n\tstruct drm_dp_mst_port *mst_output_port;\n\tstruct amdgpu_connector *mst_root;\n\tbool is_mst_connector;\n\tstruct amdgpu_encoder *mst_encoder;\n};\n\n#define ENCODER_MODE_IS_DP(em) (((em) == ATOM_ENCODER_MODE_DP) || \\\n\t\t\t\t((em) == ATOM_ENCODER_MODE_DP_MST))\n\n \n#define DRM_SCANOUTPOS_VALID        (1 << 0)\n#define DRM_SCANOUTPOS_IN_VBLANK    (1 << 1)\n#define DRM_SCANOUTPOS_ACCURATE     (1 << 2)\n#define USE_REAL_VBLANKSTART\t\t(1 << 30)\n#define GET_DISTANCE_TO_VBLANKSTART\t(1 << 31)\n\nvoid amdgpu_link_encoder_connector(struct drm_device *dev);\n\nstruct drm_connector *\namdgpu_get_connector_for_encoder(struct drm_encoder *encoder);\nstruct drm_connector *\namdgpu_get_connector_for_encoder_init(struct drm_encoder *encoder);\nbool amdgpu_dig_monitor_is_duallink(struct drm_encoder *encoder,\n\t\t\t\t    u32 pixel_clock);\n\nu16 amdgpu_encoder_get_dp_bridge_encoder_id(struct drm_encoder *encoder);\nstruct drm_encoder *amdgpu_get_external_encoder(struct drm_encoder *encoder);\n\nbool amdgpu_display_ddc_probe(struct amdgpu_connector *amdgpu_connector,\n\t\t\t      bool use_aux);\n\nvoid amdgpu_encoder_set_active_device(struct drm_encoder *encoder);\n\nint amdgpu_display_get_crtc_scanoutpos(struct drm_device *dev,\n\t\t\tunsigned int pipe, unsigned int flags, int *vpos,\n\t\t\tint *hpos, ktime_t *stime, ktime_t *etime,\n\t\t\tconst struct drm_display_mode *mode);\n\nint amdgpufb_remove(struct drm_device *dev, struct drm_framebuffer *fb);\n\nvoid amdgpu_enc_destroy(struct drm_encoder *encoder);\nvoid amdgpu_copy_fb(struct drm_device *dev, struct drm_gem_object *dst_obj);\nbool amdgpu_display_crtc_scaling_mode_fixup(struct drm_crtc *crtc,\n\t\t\t\tconst struct drm_display_mode *mode,\n\t\t\t\tstruct drm_display_mode *adjusted_mode);\nvoid amdgpu_panel_mode_fixup(struct drm_encoder *encoder,\n\t\t\t     struct drm_display_mode *adjusted_mode);\nint amdgpu_display_crtc_idx_to_irq_type(struct amdgpu_device *adev, int crtc);\n\nbool amdgpu_crtc_get_scanout_position(struct drm_crtc *crtc,\n\t\t\tbool in_vblank_irq, int *vpos,\n\t\t\tint *hpos, ktime_t *stime, ktime_t *etime,\n\t\t\tconst struct drm_display_mode *mode);\n\n \nvoid amdgpu_display_print_display_setup(struct drm_device *dev);\nint amdgpu_display_modeset_create_props(struct amdgpu_device *adev);\nint amdgpu_display_crtc_set_config(struct drm_mode_set *set,\n\t\t\t\t   struct drm_modeset_acquire_ctx *ctx);\nint amdgpu_display_crtc_page_flip_target(struct drm_crtc *crtc,\n\t\t\t\tstruct drm_framebuffer *fb,\n\t\t\t\tstruct drm_pending_vblank_event *event,\n\t\t\t\tuint32_t page_flip_flags, uint32_t target,\n\t\t\t\tstruct drm_modeset_acquire_ctx *ctx);\nextern const struct drm_mode_config_funcs amdgpu_mode_funcs;\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}