{
  "module_name": "amdgpu_rap.c",
  "hash_id": "5896a72d6c11a8348d49bf6a7a2ecd53e8e0ddfde4b577a6914ee49f6ff14e5f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_rap.c",
  "human_readable_source": " \n#include <linux/debugfs.h>\n#include <linux/pm_runtime.h>\n\n#include \"amdgpu.h\"\n#include \"amdgpu_rap.h\"\n\n \nstatic ssize_t amdgpu_rap_debugfs_write(struct file *f, const char __user *buf,\n\t\tsize_t size, loff_t *pos)\n{\n\tstruct amdgpu_device *adev = (struct amdgpu_device *)file_inode(f)->i_private;\n\tstruct ta_rap_shared_memory *rap_shared_mem;\n\tstruct ta_rap_cmd_output_data *rap_cmd_output;\n\tstruct drm_device *dev = adev_to_drm(adev);\n\tuint32_t op;\n\tenum ta_rap_status status;\n\tint ret;\n\n\tif (*pos || size != 2)\n\t\treturn -EINVAL;\n\n\tret = kstrtouint_from_user(buf, size, *pos, &op);\n\tif (ret)\n\t\treturn ret;\n\n\tret = pm_runtime_get_sync(dev->dev);\n\tif (ret < 0) {\n\t\tpm_runtime_put_autosuspend(dev->dev);\n\t\treturn ret;\n\t}\n\n\t \n\tamdgpu_gfx_off_ctrl(adev, false);\n\n\tswitch (op) {\n\tcase 2:\n\t\tret = psp_rap_invoke(&adev->psp, op, &status);\n\t\tif (!ret && status == TA_RAP_STATUS__SUCCESS) {\n\t\t\tdev_info(adev->dev, \"RAP L0 validate test success.\\n\");\n\t\t} else {\n\t\t\trap_shared_mem = (struct ta_rap_shared_memory *)\n\t\t\t\t\t adev->psp.rap_context.context.mem_context.shared_buf;\n\t\t\trap_cmd_output = &(rap_shared_mem->rap_out_message.output);\n\n\t\t\tdev_info(adev->dev, \"RAP test failed, the output is:\\n\");\n\t\t\tdev_info(adev->dev, \"\\tlast_subsection: 0x%08x.\\n\",\n\t\t\t\t rap_cmd_output->last_subsection);\n\t\t\tdev_info(adev->dev, \"\\tnum_total_validate: 0x%08x.\\n\",\n\t\t\t\t rap_cmd_output->num_total_validate);\n\t\t\tdev_info(adev->dev, \"\\tnum_valid: 0x%08x.\\n\",\n\t\t\t\t rap_cmd_output->num_valid);\n\t\t\tdev_info(adev->dev, \"\\tlast_validate_addr: 0x%08x.\\n\",\n\t\t\t\t rap_cmd_output->last_validate_addr);\n\t\t\tdev_info(adev->dev, \"\\tlast_validate_val: 0x%08x.\\n\",\n\t\t\t\t rap_cmd_output->last_validate_val);\n\t\t\tdev_info(adev->dev, \"\\tlast_validate_val_exptd: 0x%08x.\\n\",\n\t\t\t\t rap_cmd_output->last_validate_val_exptd);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tdev_info(adev->dev, \"Unsupported op id: %d, \", op);\n\t\tdev_info(adev->dev, \"Only support op 2(L0 validate test).\\n\");\n\t\tbreak;\n\t}\n\n\tamdgpu_gfx_off_ctrl(adev, true);\n\tpm_runtime_mark_last_busy(dev->dev);\n\tpm_runtime_put_autosuspend(dev->dev);\n\n\treturn size;\n}\n\nstatic const struct file_operations amdgpu_rap_debugfs_ops = {\n\t.owner = THIS_MODULE,\n\t.read = NULL,\n\t.write = amdgpu_rap_debugfs_write,\n\t.llseek = default_llseek\n};\n\nvoid amdgpu_rap_debugfs_init(struct amdgpu_device *adev)\n{\n\tstruct drm_minor *minor = adev_to_drm(adev)->primary;\n\n\tif (!adev->psp.rap_context.context.initialized)\n\t\treturn;\n\n\tdebugfs_create_file(\"rap_test\", S_IWUSR, minor->debugfs_root,\n\t\t\t\tadev, &amdgpu_rap_debugfs_ops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}