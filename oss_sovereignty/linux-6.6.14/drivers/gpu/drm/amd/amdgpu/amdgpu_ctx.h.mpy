{
  "module_name": "amdgpu_ctx.h",
  "hash_id": "c51f87d25f5ac689eb8da455c3aa221d8446c9f5e3a0bc61220965d056a82f84",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_ctx.h",
  "human_readable_source": " \n#ifndef __AMDGPU_CTX_H__\n#define __AMDGPU_CTX_H__\n\n#include <linux/ktime.h>\n#include <linux/types.h>\n\n#include \"amdgpu_ring.h\"\n\nstruct drm_device;\nstruct drm_file;\nstruct amdgpu_fpriv;\nstruct amdgpu_ctx_mgr;\n\n#define AMDGPU_MAX_ENTITY_NUM 4\n\nstruct amdgpu_ctx_entity {\n\tuint32_t\t\thw_ip;\n\tuint64_t\t\tsequence;\n\tstruct drm_sched_entity\tentity;\n\tstruct dma_fence\t*fences[];\n};\n\nstruct amdgpu_ctx {\n\tstruct kref\t\t\trefcount;\n\tstruct amdgpu_ctx_mgr\t\t*mgr;\n\tunsigned\t\t\treset_counter;\n\tunsigned\t\t\treset_counter_query;\n\tuint64_t\t\t\tgeneration;\n\tspinlock_t\t\t\tring_lock;\n\tstruct amdgpu_ctx_entity\t*entities[AMDGPU_HW_IP_NUM][AMDGPU_MAX_ENTITY_NUM];\n\tbool\t\t\t\tpreamble_presented;\n\tint32_t\t\t\t\tinit_priority;\n\tint32_t\t\t\t\toverride_priority;\n\tatomic_t\t\t\tguilty;\n\tunsigned long\t\t\tras_counter_ce;\n\tunsigned long\t\t\tras_counter_ue;\n\tuint32_t\t\t\tstable_pstate;\n\tstruct amdgpu_ctx_mgr\t\t*ctx_mgr;\n};\n\nstruct amdgpu_ctx_mgr {\n\tstruct amdgpu_device\t*adev;\n\tstruct mutex\t\tlock;\n\t \n\tstruct idr\t\tctx_handles;\n\tatomic64_t\t\ttime_spend[AMDGPU_HW_IP_NUM];\n};\n\nextern const unsigned int amdgpu_ctx_num_entities[AMDGPU_HW_IP_NUM];\n\nstruct amdgpu_ctx *amdgpu_ctx_get(struct amdgpu_fpriv *fpriv, uint32_t id);\nint amdgpu_ctx_put(struct amdgpu_ctx *ctx);\n\nint amdgpu_ctx_get_entity(struct amdgpu_ctx *ctx, u32 hw_ip, u32 instance,\n\t\t\t  u32 ring, struct drm_sched_entity **entity);\nuint64_t amdgpu_ctx_add_fence(struct amdgpu_ctx *ctx,\n\t\t\t      struct drm_sched_entity *entity,\n\t\t\t      struct dma_fence *fence);\nstruct dma_fence *amdgpu_ctx_get_fence(struct amdgpu_ctx *ctx,\n\t\t\t\t       struct drm_sched_entity *entity,\n\t\t\t\t       uint64_t seq);\nbool amdgpu_ctx_priority_is_valid(int32_t ctx_prio);\nvoid amdgpu_ctx_priority_override(struct amdgpu_ctx *ctx, int32_t ctx_prio);\n\nint amdgpu_ctx_ioctl(struct drm_device *dev, void *data,\n\t\t     struct drm_file *filp);\n\nint amdgpu_ctx_wait_prev_fence(struct amdgpu_ctx *ctx,\n\t\t\t       struct drm_sched_entity *entity);\n\nvoid amdgpu_ctx_mgr_init(struct amdgpu_ctx_mgr *mgr,\n\t\t\t struct amdgpu_device *adev);\nvoid amdgpu_ctx_mgr_entity_fini(struct amdgpu_ctx_mgr *mgr);\nlong amdgpu_ctx_mgr_entity_flush(struct amdgpu_ctx_mgr *mgr, long timeout);\nvoid amdgpu_ctx_mgr_fini(struct amdgpu_ctx_mgr *mgr);\nvoid amdgpu_ctx_mgr_usage(struct amdgpu_ctx_mgr *mgr,\n\t\t\t  ktime_t usage[AMDGPU_HW_IP_NUM]);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}