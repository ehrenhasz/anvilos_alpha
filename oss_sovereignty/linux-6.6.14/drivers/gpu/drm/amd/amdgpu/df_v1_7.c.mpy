{
  "module_name": "df_v1_7.c",
  "hash_id": "e7538ac76e30e5432f9596a0d64dfbc0d98c530e8232bf575c883db6743aeab4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/df_v1_7.c",
  "human_readable_source": " \n#include \"amdgpu.h\"\n#include \"df_v1_7.h\"\n\n#include \"df/df_1_7_default.h\"\n#include \"df/df_1_7_offset.h\"\n#include \"df/df_1_7_sh_mask.h\"\n\nstatic u32 df_v1_7_channel_number[] = {1, 2, 0, 4, 0, 8, 0, 16, 2};\n\nstatic void df_v1_7_sw_init(struct amdgpu_device *adev)\n{\n\tadev->df.hash_status.hash_64k = false;\n\tadev->df.hash_status.hash_2m = false;\n\tadev->df.hash_status.hash_1g = false;\n}\n\nstatic void df_v1_7_sw_fini(struct amdgpu_device *adev)\n{\n}\n\nstatic void df_v1_7_enable_broadcast_mode(struct amdgpu_device *adev,\n\t\t\t\t\t  bool enable)\n{\n\tu32 tmp;\n\n\tif (enable) {\n\t\ttmp = RREG32_SOC15(DF, 0, mmFabricConfigAccessControl);\n\t\ttmp &= ~FabricConfigAccessControl__CfgRegInstAccEn_MASK;\n\t\tWREG32_SOC15(DF, 0, mmFabricConfigAccessControl, tmp);\n\t} else\n\t\tWREG32_SOC15(DF, 0, mmFabricConfigAccessControl,\n\t\t\t     mmFabricConfigAccessControl_DEFAULT);\n}\n\nstatic u32 df_v1_7_get_fb_channel_number(struct amdgpu_device *adev)\n{\n\tu32 tmp;\n\n\ttmp = RREG32_SOC15(DF, 0, mmDF_CS_AON0_DramBaseAddress0);\n\ttmp &= DF_CS_AON0_DramBaseAddress0__IntLvNumChan_MASK;\n\ttmp >>= DF_CS_AON0_DramBaseAddress0__IntLvNumChan__SHIFT;\n\n\treturn tmp;\n}\n\nstatic u32 df_v1_7_get_hbm_channel_number(struct amdgpu_device *adev)\n{\n\tint fb_channel_number;\n\n\tfb_channel_number = adev->df.funcs->get_fb_channel_number(adev);\n\n\treturn df_v1_7_channel_number[fb_channel_number];\n}\n\nstatic void df_v1_7_update_medium_grain_clock_gating(struct amdgpu_device *adev,\n\t\t\t\t\t\t     bool enable)\n{\n\tu32 tmp;\n\n\t \n\tadev->df.funcs->enable_broadcast_mode(adev, true);\n\n\tif (enable && (adev->cg_flags & AMD_CG_SUPPORT_DF_MGCG)) {\n\t\ttmp = RREG32_SOC15(DF, 0, mmDF_PIE_AON0_DfGlobalClkGater);\n\t\ttmp &= ~DF_PIE_AON0_DfGlobalClkGater__MGCGMode_MASK;\n\t\ttmp |= DF_V1_7_MGCG_ENABLE_15_CYCLE_DELAY;\n\t\tWREG32_SOC15(DF, 0, mmDF_PIE_AON0_DfGlobalClkGater, tmp);\n\t} else {\n\t\ttmp = RREG32_SOC15(DF, 0, mmDF_PIE_AON0_DfGlobalClkGater);\n\t\ttmp &= ~DF_PIE_AON0_DfGlobalClkGater__MGCGMode_MASK;\n\t\ttmp |= DF_V1_7_MGCG_DISABLE;\n\t\tWREG32_SOC15(DF, 0, mmDF_PIE_AON0_DfGlobalClkGater, tmp);\n\t}\n\n\t \n\tadev->df.funcs->enable_broadcast_mode(adev, false);\n}\n\nstatic void df_v1_7_get_clockgating_state(struct amdgpu_device *adev,\n\t\t\t\t\t  u64 *flags)\n{\n\tu32 tmp;\n\n\t \n\ttmp = RREG32_SOC15(DF, 0, mmDF_PIE_AON0_DfGlobalClkGater);\n\tif (tmp & DF_V1_7_MGCG_ENABLE_15_CYCLE_DELAY)\n\t\t*flags |= AMD_CG_SUPPORT_DF_MGCG;\n}\n\nstatic void df_v1_7_enable_ecc_force_par_wr_rmw(struct amdgpu_device *adev,\n\t\t\t\t\t\tbool enable)\n{\n\tWREG32_FIELD15(DF, 0, DF_CS_AON0_CoherentSlaveModeCtrlA0,\n\t\t       ForceParWrRMW, enable);\n}\n\nconst struct amdgpu_df_funcs df_v1_7_funcs = {\n\t.sw_init = df_v1_7_sw_init,\n\t.sw_fini = df_v1_7_sw_fini,\n\t.enable_broadcast_mode = df_v1_7_enable_broadcast_mode,\n\t.get_fb_channel_number = df_v1_7_get_fb_channel_number,\n\t.get_hbm_channel_number = df_v1_7_get_hbm_channel_number,\n\t.update_medium_grain_clock_gating = df_v1_7_update_medium_grain_clock_gating,\n\t.get_clockgating_state = df_v1_7_get_clockgating_state,\n\t.enable_ecc_force_par_wr_rmw = df_v1_7_enable_ecc_force_par_wr_rmw,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}