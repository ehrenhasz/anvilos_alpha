{
  "module_name": "athub_v2_1.c",
  "hash_id": "cc358fcf3f531eb27cbf0da84625916a11d83026366caa393611222c89d74224",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/athub_v2_1.c",
  "human_readable_source": " \n\n#include \"amdgpu.h\"\n#include \"athub_v2_1.h\"\n\n#include \"athub/athub_2_1_0_offset.h\"\n#include \"athub/athub_2_1_0_sh_mask.h\"\n\n#include \"soc15_common.h\"\n\nstatic void\nathub_v2_1_update_medium_grain_clock_gating(struct amdgpu_device *adev,\n\t\t\t\t\t    bool enable)\n{\n\tuint32_t def, data;\n\n\tdef = data = RREG32_SOC15(ATHUB, 0, mmATHUB_MISC_CNTL);\n\n\tif (enable && (adev->cg_flags & AMD_CG_SUPPORT_MC_MGCG))\n\t\tdata |= ATHUB_MISC_CNTL__CG_ENABLE_MASK;\n\telse\n\t\tdata &= ~ATHUB_MISC_CNTL__CG_ENABLE_MASK;\n\n\tif (def != data)\n\t\tWREG32_SOC15(ATHUB, 0, mmATHUB_MISC_CNTL, data);\n}\n\nstatic void\nathub_v2_1_update_medium_grain_light_sleep(struct amdgpu_device *adev,\n\t\t\t\t\t   bool enable)\n{\n\tuint32_t def, data;\n\n\tdef = data = RREG32_SOC15(ATHUB, 0, mmATHUB_MISC_CNTL);\n\n\tif (enable && (adev->cg_flags & AMD_CG_SUPPORT_MC_LS) &&\n\t    (adev->cg_flags & AMD_CG_SUPPORT_HDP_LS))\n\t\tdata |= ATHUB_MISC_CNTL__CG_MEM_LS_ENABLE_MASK;\n\telse\n\t\tdata &= ~ATHUB_MISC_CNTL__CG_MEM_LS_ENABLE_MASK;\n\n\tif(def != data)\n\t\tWREG32_SOC15(ATHUB, 0, mmATHUB_MISC_CNTL, data);\n}\n\nint athub_v2_1_set_clockgating(struct amdgpu_device *adev,\n\t\t\t       enum amd_clockgating_state state)\n{\n\tif (amdgpu_sriov_vf(adev))\n\t\treturn 0;\n\n\tswitch (adev->ip_versions[ATHUB_HWIP][0]) {\n\tcase IP_VERSION(2, 1, 0):\n\tcase IP_VERSION(2, 1, 1):\n\tcase IP_VERSION(2, 1, 2):\n\tcase IP_VERSION(2, 4, 0):\n\t\tathub_v2_1_update_medium_grain_clock_gating(adev, state == AMD_CG_STATE_GATE);\n\t\tathub_v2_1_update_medium_grain_light_sleep(adev, state == AMD_CG_STATE_GATE);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nvoid athub_v2_1_get_clockgating(struct amdgpu_device *adev, u64 *flags)\n{\n\tint data;\n\n\t \n\tdata = RREG32_SOC15(ATHUB, 0, mmATHUB_MISC_CNTL);\n\tif (data & ATHUB_MISC_CNTL__CG_ENABLE_MASK)\n\t\t*flags |= AMD_CG_SUPPORT_ATHUB_MGCG;\n\n\t \n\tif (data & ATHUB_MISC_CNTL__CG_MEM_LS_ENABLE_MASK)\n\t\t*flags |= AMD_CG_SUPPORT_ATHUB_LS;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}