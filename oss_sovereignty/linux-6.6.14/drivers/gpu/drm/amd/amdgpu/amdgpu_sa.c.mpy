{
  "module_name": "amdgpu_sa.c",
  "hash_id": "0d2ddf720ae789dde7308af0db691775fd23e621456a738b8e8085dd587a4095",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_sa.c",
  "human_readable_source": " \n \n \n\n#include \"amdgpu.h\"\n\nint amdgpu_sa_bo_manager_init(struct amdgpu_device *adev,\n\t\t\t      struct amdgpu_sa_manager *sa_manager,\n\t\t\t      unsigned int size, u32 suballoc_align, u32 domain)\n{\n\tint r;\n\n\tr = amdgpu_bo_create_kernel(adev, size, AMDGPU_GPU_PAGE_SIZE, domain,\n\t\t\t\t    &sa_manager->bo, &sa_manager->gpu_addr,\n\t\t\t\t    &sa_manager->cpu_ptr);\n\tif (r) {\n\t\tdev_err(adev->dev, \"(%d) failed to allocate bo for manager\\n\", r);\n\t\treturn r;\n\t}\n\n\tmemset(sa_manager->cpu_ptr, 0, size);\n\tdrm_suballoc_manager_init(&sa_manager->base, size, suballoc_align);\n\treturn r;\n}\n\nvoid amdgpu_sa_bo_manager_fini(struct amdgpu_device *adev,\n\t\t\t       struct amdgpu_sa_manager *sa_manager)\n{\n\tif (sa_manager->bo == NULL) {\n\t\tdev_err(adev->dev, \"no bo for sa manager\\n\");\n\t\treturn;\n\t}\n\n\tdrm_suballoc_manager_fini(&sa_manager->base);\n\n\tamdgpu_bo_free_kernel(&sa_manager->bo, &sa_manager->gpu_addr, &sa_manager->cpu_ptr);\n}\n\nint amdgpu_sa_bo_new(struct amdgpu_sa_manager *sa_manager,\n\t\t     struct drm_suballoc **sa_bo,\n\t\t     unsigned int size)\n{\n\tstruct drm_suballoc *sa = drm_suballoc_new(&sa_manager->base, size,\n\t\t\t\t\t\t   GFP_KERNEL, false, 0);\n\n\tif (IS_ERR(sa)) {\n\t\t*sa_bo = NULL;\n\n\t\treturn PTR_ERR(sa);\n\t}\n\n\t*sa_bo = sa;\n\treturn 0;\n}\n\nvoid amdgpu_sa_bo_free(struct amdgpu_device *adev, struct drm_suballoc **sa_bo,\n\t\t       struct dma_fence *fence)\n{\n\tif (sa_bo == NULL || *sa_bo == NULL) {\n\t\treturn;\n\t}\n\n\tdrm_suballoc_free(*sa_bo, fence);\n\t*sa_bo = NULL;\n}\n\n#if defined(CONFIG_DEBUG_FS)\n\nvoid amdgpu_sa_bo_dump_debug_info(struct amdgpu_sa_manager *sa_manager,\n\t\t\t\t  struct seq_file *m)\n{\n\tstruct drm_printer p = drm_seq_file_printer(m);\n\n\tdrm_suballoc_dump_debug_info(&sa_manager->base, &p, sa_manager->gpu_addr);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}