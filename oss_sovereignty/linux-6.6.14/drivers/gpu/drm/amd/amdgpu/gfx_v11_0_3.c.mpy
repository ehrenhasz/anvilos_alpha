{
  "module_name": "gfx_v11_0_3.c",
  "hash_id": "c6dbe2144abba46c22847e342c684e2396923e84c0c6637ed912ef359e5f4ec2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/gfx_v11_0_3.c",
  "human_readable_source": " \n\n#include \"amdgpu.h\"\n#include \"soc21.h\"\n#include \"gc/gc_11_0_3_offset.h\"\n#include \"gc/gc_11_0_3_sh_mask.h\"\n#include \"ivsrcid/gfx/irqsrcs_gfx_11_0_0.h\"\n#include \"soc15.h\"\n#include \"soc15d.h\"\n#include \"gfx_v11_0.h\"\n\n\nstatic int gfx_v11_0_3_rlc_gc_fed_irq(struct amdgpu_device *adev,\n\t\t\t\t  struct amdgpu_irq_src *source,\n\t\t\t\t  struct amdgpu_iv_entry *entry)\n{\n\tuint32_t rlc_status0 = 0, rlc_status1 = 0;\n\tstruct ras_common_if *ras_if = NULL;\n\tstruct ras_dispatch_if ih_data = {\n\t\t.entry = entry,\n\t};\n\n\trlc_status0 = RREG32(SOC15_REG_OFFSET(GC, 0, regRLC_RLCS_FED_STATUS_0));\n\trlc_status1 = RREG32(SOC15_REG_OFFSET(GC, 0, regRLC_RLCS_FED_STATUS_1));\n\n\tif (!rlc_status0 && !rlc_status1) {\n\t\tdev_warn(adev->dev, \"RLC_GC_FED irq is generated, but rlc_status0 and rlc_status1 are empty!\\n\");\n\t\treturn 0;\n\t}\n\n\t \n\tif (REG_GET_FIELD(rlc_status0, RLC_RLCS_FED_STATUS_0, SDMA0_FED_ERR) ||\n\t    REG_GET_FIELD(rlc_status0, RLC_RLCS_FED_STATUS_0, SDMA1_FED_ERR))\n\t\tras_if = adev->sdma.ras_if;\n\telse\n\t\tras_if = adev->gfx.ras_if;\n\n\tif (!ras_if) {\n\t\tdev_err(adev->dev, \"Gfx or sdma ras block not initialized, rlc_status0:0x%x.\\n\",\n\t\t\t\trlc_status0);\n\t\treturn -EINVAL;\n\t}\n\n\tdev_warn(adev->dev, \"RLC %s FED IRQ\\n\", ras_if->name);\n\n\tif (!amdgpu_sriov_vf(adev)) {\n\t\tih_data.head = *ras_if;\n\t\tamdgpu_ras_interrupt_dispatch(adev, &ih_data);\n\t} else {\n\t\tif (adev->virt.ops && adev->virt.ops->ras_poison_handler)\n\t\t\tadev->virt.ops->ras_poison_handler(adev);\n\t\telse\n\t\t\tdev_warn(adev->dev,\n\t\t\t\t\"No ras_poison_handler interface in SRIOV for %s!\\n\", ras_if->name);\n\t}\n\n\treturn 0;\n}\n\nstatic int gfx_v11_0_3_poison_consumption_handler(struct amdgpu_device *adev,\n\t\t\t\t\tstruct amdgpu_iv_entry *entry)\n{\n\t \n\tif (entry && (entry->client_id == SOC21_IH_CLIENTID_GFX) &&\n\t    (entry->src_id == GFX_11_0_0__SRCID__RLC_GC_FED_INTERRUPT) &&\n\t     !entry->vmid && !entry->pasid) {\n\t\tuint32_t rlc_status0 = 0;\n\n\t\trlc_status0 = RREG32_SOC15(GC, 0, regRLC_RLCS_FED_STATUS_0);\n\n\t\tif (REG_GET_FIELD(rlc_status0, RLC_RLCS_FED_STATUS_0, SDMA0_FED_ERR) ||\n\t\t    REG_GET_FIELD(rlc_status0, RLC_RLCS_FED_STATUS_0, SDMA1_FED_ERR)) {\n\t\t\tstruct amdgpu_ras *ras = amdgpu_ras_get_context(adev);\n\n\t\t\tras->gpu_reset_flags |= AMDGPU_RAS_GPU_RESET_MODE2_RESET;\n\t\t}\n\n\t\tamdgpu_ras_reset_gpu(adev);\n\t}\n\n\treturn 0;\n}\n\nstruct amdgpu_gfx_ras gfx_v11_0_3_ras = {\n\t.rlc_gc_fed_irq = gfx_v11_0_3_rlc_gc_fed_irq,\n\t.poison_consumption_handler = gfx_v11_0_3_poison_consumption_handler,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}