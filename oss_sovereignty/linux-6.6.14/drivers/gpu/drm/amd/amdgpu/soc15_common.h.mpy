{
  "module_name": "soc15_common.h",
  "hash_id": "a19f8e49fbbd2f0edeca852616bf53b4c42f984d60f1d135c9ea7ba41d27850b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/soc15_common.h",
  "human_readable_source": " \n\n#ifndef __SOC15_COMMON_H__\n#define __SOC15_COMMON_H__\n\n \n#define GET_INST(ip, inst) \\\n\t(adev->ip_map.logical_to_dev_inst ? \\\n\tadev->ip_map.logical_to_dev_inst(adev, ip##_HWIP, inst) : inst)\n#define GET_MASK(ip, mask) \\\n\t(adev->ip_map.logical_to_dev_mask ? \\\n\tadev->ip_map.logical_to_dev_mask(adev, ip##_HWIP, mask) : mask)\n\n \n#define SOC15_REG_OFFSET(ip, inst, reg)\t(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg)\n#define SOC15_REG_OFFSET1(ip, inst, reg, offset) \\\n\t(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + (reg)+(offset))\n\n#define __WREG32_SOC15_RLC__(reg, value, flag, hwip, inst) \\\n\t((amdgpu_sriov_vf(adev) && adev->gfx.rlc.funcs && adev->gfx.rlc.rlcg_reg_access_supported) ? \\\n\t amdgpu_sriov_wreg(adev, reg, value, flag, hwip, inst) : \\\n\t WREG32(reg, value))\n\n#define __RREG32_SOC15_RLC__(reg, flag, hwip, inst) \\\n\t((amdgpu_sriov_vf(adev) && adev->gfx.rlc.funcs && adev->gfx.rlc.rlcg_reg_access_supported) ? \\\n\t amdgpu_sriov_rreg(adev, reg, flag, hwip, inst) : \\\n\t RREG32(reg))\n\n#define WREG32_FIELD15(ip, idx, reg, field, val)\t\\\n\t __WREG32_SOC15_RLC__(adev->reg_offset[ip##_HWIP][idx][mm##reg##_BASE_IDX] + mm##reg,\t\\\n\t\t\t\t(__RREG32_SOC15_RLC__( \\\n\t\t\t\t\tadev->reg_offset[ip##_HWIP][idx][mm##reg##_BASE_IDX] + mm##reg, \\\n\t\t\t\t\t0, ip##_HWIP, idx) & \\\n\t\t\t\t~REG_FIELD_MASK(reg, field)) | (val) << REG_FIELD_SHIFT(reg, field), \\\n\t\t\t      0, ip##_HWIP, idx)\n\n#define WREG32_FIELD15_PREREG(ip, idx, reg_name, field, val)        \\\n\t__WREG32_SOC15_RLC__(adev->reg_offset[ip##_HWIP][idx][reg##reg_name##_BASE_IDX] + reg##reg_name,   \\\n\t\t\t(__RREG32_SOC15_RLC__( \\\n\t\t\t\t\tadev->reg_offset[ip##_HWIP][idx][reg##reg_name##_BASE_IDX] + reg##reg_name, \\\n\t\t\t\t\t0, ip##_HWIP, idx) & \\\n\t\t\t\t\t~REG_FIELD_MASK(reg_name, field)) | (val) << REG_FIELD_SHIFT(reg_name, field), \\\n\t\t\t0, ip##_HWIP, idx)\n\n#define RREG32_SOC15(ip, inst, reg) \\\n\t__RREG32_SOC15_RLC__(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg, \\\n\t\t\t 0, ip##_HWIP, inst)\n\n#define RREG32_SOC15_IP(ip, reg) __RREG32_SOC15_RLC__(reg, 0, ip##_HWIP, 0)\n\n#define RREG32_SOC15_IP_NO_KIQ(ip, reg) __RREG32_SOC15_RLC__(reg, AMDGPU_REGS_NO_KIQ, ip##_HWIP, 0)\n\n#define RREG32_SOC15_NO_KIQ(ip, inst, reg) \\\n\t__RREG32_SOC15_RLC__(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg, \\\n\t\t\t AMDGPU_REGS_NO_KIQ, ip##_HWIP, inst)\n\n#define RREG32_SOC15_OFFSET(ip, inst, reg, offset) \\\n\t __RREG32_SOC15_RLC__((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + (reg)) + \\\n\t\t\t (offset), 0, ip##_HWIP, inst)\n\n#define WREG32_SOC15(ip, inst, reg, value) \\\n\t __WREG32_SOC15_RLC__((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg), \\\n\t\t\t  value, 0, ip##_HWIP, inst)\n\n#define WREG32_SOC15_IP(ip, reg, value) \\\n\t __WREG32_SOC15_RLC__(reg, value, 0, ip##_HWIP, 0)\n\n#define WREG32_SOC15_IP_NO_KIQ(ip, reg, value) \\\n\t __WREG32_SOC15_RLC__(reg, value, AMDGPU_REGS_NO_KIQ, ip##_HWIP, 0)\n\n#define WREG32_SOC15_NO_KIQ(ip, inst, reg, value) \\\n\t__WREG32_SOC15_RLC__(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg, \\\n\t\t\t     value, AMDGPU_REGS_NO_KIQ, ip##_HWIP, inst)\n\n#define WREG32_SOC15_OFFSET(ip, inst, reg, offset, value) \\\n\t __WREG32_SOC15_RLC__((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg) + offset, \\\n\t\t\t  value, 0, ip##_HWIP, inst)\n\n#define SOC15_WAIT_ON_RREG(ip, inst, reg, expected_value, mask)      \\\n\tamdgpu_device_wait_on_rreg(adev, inst,                       \\\n\t(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + (reg)), \\\n\t#reg, expected_value, mask)\n\n#define SOC15_WAIT_ON_RREG_OFFSET(ip, inst, reg, offset, expected_value, mask)  \\\n\tamdgpu_device_wait_on_rreg(adev, inst,                                  \\\n\t(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + (reg) + (offset)), \\\n\t#reg, expected_value, mask)\n\n#define WREG32_RLC(reg, value) \\\n\t__WREG32_SOC15_RLC__(reg, value, AMDGPU_REGS_RLC, GC_HWIP, 0)\n\n#define WREG32_RLC_EX(prefix, reg, value, inst) \\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tif (amdgpu_sriov_fullaccess(adev)) {    \\\n\t\t\tuint32_t i = 0;\t\\\n\t\t\tuint32_t retries = 50000;\t\\\n\t\t\tuint32_t r0 = adev->reg_offset[GC_HWIP][inst][prefix##SCRATCH_REG0_BASE_IDX] + prefix##SCRATCH_REG0;\t\\\n\t\t\tuint32_t r1 = adev->reg_offset[GC_HWIP][inst][prefix##SCRATCH_REG1_BASE_IDX] + prefix##SCRATCH_REG1;\t\\\n\t\t\tuint32_t spare_int = adev->reg_offset[GC_HWIP][inst][prefix##RLC_SPARE_INT_BASE_IDX] + prefix##RLC_SPARE_INT;\t\\\n\t\t\tWREG32(r0, value);\t\\\n\t\t\tWREG32(r1, (reg | 0x80000000));\t\\\n\t\t\tWREG32(spare_int, 0x1);\t\\\n\t\t\tfor (i = 0; i < retries; i++) {\t\\\n\t\t\t\tu32 tmp = RREG32(r1);\t\\\n\t\t\t\tif (!(tmp & 0x80000000))\t\\\n\t\t\t\t\tbreak;\t\\\n\t\t\t\tudelay(10);\t\\\n\t\t\t}\t\\\n\t\t\tif (i >= retries)\t\\\n\t\t\t\tpr_err(\"timeout: rlcg program reg:0x%05x failed !\\n\", reg);\t\\\n\t\t} else {\t\\\n\t\t\tWREG32(reg, value); \\\n\t\t}\t\\\n\t} while (0)\n\n \n#define WREG32_SOC15_RLC_SHADOW(ip, inst, reg, value) \\\n\t__WREG32_SOC15_RLC__((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg), value, AMDGPU_REGS_RLC, GC_HWIP, inst)\n\n \n#define RREG32_RLC(reg) \\\n\t__RREG32_SOC15_RLC__(reg, AMDGPU_REGS_RLC, GC_HWIP)\n\n#define WREG32_RLC_NO_KIQ(reg, value, hwip) \\\n\t__WREG32_SOC15_RLC__(reg, value, AMDGPU_REGS_NO_KIQ | AMDGPU_REGS_RLC, hwip, 0)\n\n#define RREG32_RLC_NO_KIQ(reg, hwip) \\\n\t__RREG32_SOC15_RLC__(reg, AMDGPU_REGS_NO_KIQ | AMDGPU_REGS_RLC, hwip, 0)\n\n#define WREG32_SOC15_RLC_SHADOW_EX(prefix, ip, inst, reg, value) \\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tuint32_t target_reg = adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg;\\\n\t\tif (amdgpu_sriov_fullaccess(adev)) {    \\\n\t\t\tuint32_t r2 = adev->reg_offset[GC_HWIP][inst][prefix##SCRATCH_REG1_BASE_IDX] + prefix##SCRATCH_REG2;\t\\\n\t\t\tuint32_t r3 = adev->reg_offset[GC_HWIP][inst][prefix##SCRATCH_REG1_BASE_IDX] + prefix##SCRATCH_REG3;\t\\\n\t\t\tuint32_t grbm_cntl = adev->reg_offset[GC_HWIP][inst][prefix##GRBM_GFX_CNTL_BASE_IDX] + prefix##GRBM_GFX_CNTL;   \\\n\t\t\tuint32_t grbm_idx = adev->reg_offset[GC_HWIP][inst][prefix##GRBM_GFX_INDEX_BASE_IDX] + prefix##GRBM_GFX_INDEX;   \\\n\t\t\tif (target_reg == grbm_cntl) \\\n\t\t\t\tWREG32(r2, value);\t\\\n\t\t\telse if (target_reg == grbm_idx) \\\n\t\t\t\tWREG32(r3, value);\t\\\n\t\t\tWREG32(target_reg, value);\t\\\n\t\t} else {\t\\\n\t\t\tWREG32(target_reg, value); \\\n\t\t}\t\\\n\t} while (0)\n\n#define RREG32_SOC15_RLC(ip, inst, reg) \\\n\t__RREG32_SOC15_RLC__(adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg, AMDGPU_REGS_RLC, ip##_HWIP, inst)\n\n#define WREG32_SOC15_RLC(ip, inst, reg, value) \\\n\tdo {\t\t\t\t\t\t\t\\\n\t\tuint32_t target_reg = adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg;\\\n\t\t__WREG32_SOC15_RLC__(target_reg, value, AMDGPU_REGS_RLC, ip##_HWIP, inst); \\\n\t} while (0)\n\n#define WREG32_SOC15_RLC_EX(prefix, ip, inst, reg, value) \\\n\tdo {\t\t\t\t\t\t\t\\\n\t\t\tuint32_t target_reg = adev->reg_offset[GC_HWIP][inst][reg##_BASE_IDX] + reg;\\\n\t\t\tWREG32_RLC_EX(prefix, target_reg, value, inst); \\\n\t} while (0)\n\n#define WREG32_FIELD15_RLC(ip, idx, reg, field, val)   \\\n\t__WREG32_SOC15_RLC__((adev->reg_offset[ip##_HWIP][idx][mm##reg##_BASE_IDX] + mm##reg), \\\n\t\t\t     (__RREG32_SOC15_RLC__(adev->reg_offset[ip##_HWIP][idx][mm##reg##_BASE_IDX] + mm##reg, \\\n\t\t\t\t\t\t   AMDGPU_REGS_RLC, ip##_HWIP, idx) & \\\n\t\t\t      ~REG_FIELD_MASK(reg, field)) | (val) << REG_FIELD_SHIFT(reg, field), \\\n\t\t\t     AMDGPU_REGS_RLC, ip##_HWIP, idx)\n\n#define WREG32_SOC15_OFFSET_RLC(ip, inst, reg, offset, value) \\\n\t__WREG32_SOC15_RLC__((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg) + offset, value, AMDGPU_REGS_RLC, ip##_HWIP, inst)\n\n#define RREG32_SOC15_OFFSET_RLC(ip, inst, reg, offset) \\\n\t__RREG32_SOC15_RLC__((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg) + offset, AMDGPU_REGS_RLC, ip##_HWIP, inst)\n\n \n#define RREG32_SOC15_EXT(ip, inst, reg, ext) \\\n\tRREG32_PCIE_EXT((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg) * 4 \\\n\t\t\t+ adev->asic_funcs->encode_ext_smn_addressing(ext)) \\\n\n#define WREG32_SOC15_EXT(ip, inst, reg, ext, value) \\\n\tWREG32_PCIE_EXT((adev->reg_offset[ip##_HWIP][inst][reg##_BASE_IDX] + reg) * 4 \\\n\t\t\t+ adev->asic_funcs->encode_ext_smn_addressing(ext), \\\n\t\t\tvalue) \\\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}