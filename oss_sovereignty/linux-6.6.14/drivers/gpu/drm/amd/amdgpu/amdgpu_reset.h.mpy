{
  "module_name": "amdgpu_reset.h",
  "hash_id": "3836ed49ddf0510d3f8f53ffb251010bbe352075c39629cf25adaa80a31af987",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/amdgpu/amdgpu_reset.h",
  "human_readable_source": " \n\n#ifndef __AMDGPU_RESET_H__\n#define __AMDGPU_RESET_H__\n\n#include \"amdgpu.h\"\n\nenum AMDGPU_RESET_FLAGS {\n\n\tAMDGPU_NEED_FULL_RESET = 0,\n\tAMDGPU_SKIP_HW_RESET = 1,\n\tAMDGPU_RESET_FOR_DEVICE_REMOVE = 2,\n};\n\nstruct amdgpu_reset_context {\n\tenum amd_reset_method method;\n\tstruct amdgpu_device *reset_req_dev;\n\tstruct amdgpu_job *job;\n\tstruct amdgpu_hive_info *hive;\n\tstruct list_head *reset_device_list;\n\tunsigned long flags;\n};\n\nstruct amdgpu_reset_handler {\n\tenum amd_reset_method reset_method;\n\tstruct list_head handler_list;\n\tint (*prepare_env)(struct amdgpu_reset_control *reset_ctl,\n\t\t\t   struct amdgpu_reset_context *context);\n\tint (*prepare_hwcontext)(struct amdgpu_reset_control *reset_ctl,\n\t\t\t\t struct amdgpu_reset_context *context);\n\tint (*perform_reset)(struct amdgpu_reset_control *reset_ctl,\n\t\t\t     struct amdgpu_reset_context *context);\n\tint (*restore_hwcontext)(struct amdgpu_reset_control *reset_ctl,\n\t\t\t\t struct amdgpu_reset_context *context);\n\tint (*restore_env)(struct amdgpu_reset_control *reset_ctl,\n\t\t\t   struct amdgpu_reset_context *context);\n\n\tint (*do_reset)(struct amdgpu_device *adev);\n};\n\nstruct amdgpu_reset_control {\n\tvoid *handle;\n\tstruct work_struct reset_work;\n\tstruct mutex reset_lock;\n\tstruct list_head reset_handlers;\n\tatomic_t in_reset;\n\tenum amd_reset_method active_reset;\n\tstruct amdgpu_reset_handler *(*get_reset_handler)(\n\t\tstruct amdgpu_reset_control *reset_ctl,\n\t\tstruct amdgpu_reset_context *context);\n\tvoid (*async_reset)(struct work_struct *work);\n};\n\n\nenum amdgpu_reset_domain_type {\n\tSINGLE_DEVICE,\n\tXGMI_HIVE\n};\n\nstruct amdgpu_reset_domain {\n\tstruct kref refcount;\n\tstruct workqueue_struct *wq;\n\tenum amdgpu_reset_domain_type type;\n\tstruct rw_semaphore sem;\n\tatomic_t in_gpu_reset;\n\tatomic_t reset_res;\n};\n\n\nint amdgpu_reset_init(struct amdgpu_device *adev);\nint amdgpu_reset_fini(struct amdgpu_device *adev);\n\nint amdgpu_reset_prepare_hwcontext(struct amdgpu_device *adev,\n\t\t\t\t   struct amdgpu_reset_context *reset_context);\n\nint amdgpu_reset_perform_reset(struct amdgpu_device *adev,\n\t\t\t       struct amdgpu_reset_context *reset_context);\n\nint amdgpu_reset_add_handler(struct amdgpu_reset_control *reset_ctl,\n\t\t\t     struct amdgpu_reset_handler *handler);\n\nstruct amdgpu_reset_domain *amdgpu_reset_create_reset_domain(enum amdgpu_reset_domain_type type,\n\t\t\t\t\t\t\t     char *wq_name);\n\nvoid amdgpu_reset_destroy_reset_domain(struct kref *ref);\n\nstatic inline bool amdgpu_reset_get_reset_domain(struct amdgpu_reset_domain *domain)\n{\n\treturn kref_get_unless_zero(&domain->refcount) != 0;\n}\n\nstatic inline void amdgpu_reset_put_reset_domain(struct amdgpu_reset_domain *domain)\n{\n\tif (domain)\n\t\tkref_put(&domain->refcount, amdgpu_reset_destroy_reset_domain);\n}\n\nstatic inline bool amdgpu_reset_domain_schedule(struct amdgpu_reset_domain *domain,\n\t\t\t\t\t\tstruct work_struct *work)\n{\n\treturn queue_work(domain->wq, work);\n}\n\nvoid amdgpu_device_lock_reset_domain(struct amdgpu_reset_domain *reset_domain);\n\nvoid amdgpu_device_unlock_reset_domain(struct amdgpu_reset_domain *reset_domain);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}