{
  "module_name": "hdcp_ddc.c",
  "hash_id": "dc03ce519fde23afbf47afad35e831d80043538fc26ebecb7734cb4944c15911",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/modules/hdcp/hdcp_ddc.c",
  "human_readable_source": " \n\n#include \"hdcp.h\"\n\n#define MIN(a, b) ((a) < (b) ? (a) : (b))\n#define HDCP_I2C_ADDR 0x3a\t \n#define KSV_READ_SIZE 0xf\t \n#define HDCP_MAX_AUX_TRANSACTION_SIZE 16\n\n#define DP_CP_IRQ (1 << 2)\n\nenum mod_hdcp_ddc_message_id {\n\tMOD_HDCP_MESSAGE_ID_INVALID = -1,\n\n\t \n\n\tMOD_HDCP_MESSAGE_ID_READ_BKSV = 0,\n\tMOD_HDCP_MESSAGE_ID_READ_RI_R0,\n\tMOD_HDCP_MESSAGE_ID_WRITE_AKSV,\n\tMOD_HDCP_MESSAGE_ID_WRITE_AINFO,\n\tMOD_HDCP_MESSAGE_ID_WRITE_AN,\n\tMOD_HDCP_MESSAGE_ID_READ_VH_X,\n\tMOD_HDCP_MESSAGE_ID_READ_VH_0,\n\tMOD_HDCP_MESSAGE_ID_READ_VH_1,\n\tMOD_HDCP_MESSAGE_ID_READ_VH_2,\n\tMOD_HDCP_MESSAGE_ID_READ_VH_3,\n\tMOD_HDCP_MESSAGE_ID_READ_VH_4,\n\tMOD_HDCP_MESSAGE_ID_READ_BCAPS,\n\tMOD_HDCP_MESSAGE_ID_READ_BSTATUS,\n\tMOD_HDCP_MESSAGE_ID_READ_KSV_FIFO,\n\tMOD_HDCP_MESSAGE_ID_READ_BINFO,\n\n\t \n\n\tMOD_HDCP_MESSAGE_ID_HDCP2VERSION,\n\tMOD_HDCP_MESSAGE_ID_RX_CAPS,\n\tMOD_HDCP_MESSAGE_ID_WRITE_AKE_INIT,\n\tMOD_HDCP_MESSAGE_ID_READ_AKE_SEND_CERT,\n\tMOD_HDCP_MESSAGE_ID_WRITE_AKE_NO_STORED_KM,\n\tMOD_HDCP_MESSAGE_ID_WRITE_AKE_STORED_KM,\n\tMOD_HDCP_MESSAGE_ID_READ_AKE_SEND_H_PRIME,\n\tMOD_HDCP_MESSAGE_ID_READ_AKE_SEND_PAIRING_INFO,\n\tMOD_HDCP_MESSAGE_ID_WRITE_LC_INIT,\n\tMOD_HDCP_MESSAGE_ID_READ_LC_SEND_L_PRIME,\n\tMOD_HDCP_MESSAGE_ID_WRITE_SKE_SEND_EKS,\n\tMOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST,\n\tMOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST_PART2,\n\tMOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_SEND_ACK,\n\tMOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_STREAM_MANAGE,\n\tMOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_STREAM_READY,\n\tMOD_HDCP_MESSAGE_ID_READ_RXSTATUS,\n\tMOD_HDCP_MESSAGE_ID_WRITE_CONTENT_STREAM_TYPE,\n\n\tMOD_HDCP_MESSAGE_ID_MAX\n};\n\nstatic const uint8_t hdcp_i2c_offsets[] = {\n\t[MOD_HDCP_MESSAGE_ID_READ_BKSV] = 0x0,\n\t[MOD_HDCP_MESSAGE_ID_READ_RI_R0] = 0x8,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKSV] = 0x10,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AINFO] = 0x15,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AN] = 0x18,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_X] = 0x20,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_0] = 0x20,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_1] = 0x24,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_2] = 0x28,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_3] = 0x2C,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_4] = 0x30,\n\t[MOD_HDCP_MESSAGE_ID_READ_BCAPS] = 0x40,\n\t[MOD_HDCP_MESSAGE_ID_READ_BSTATUS] = 0x41,\n\t[MOD_HDCP_MESSAGE_ID_READ_KSV_FIFO] = 0x43,\n\t[MOD_HDCP_MESSAGE_ID_READ_BINFO] = 0xFF,\n\t[MOD_HDCP_MESSAGE_ID_HDCP2VERSION] = 0x50,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKE_INIT] = 0x60,\n\t[MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_CERT] = 0x80,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKE_NO_STORED_KM] = 0x60,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKE_STORED_KM] = 0x60,\n\t[MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_H_PRIME] = 0x80,\n\t[MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_PAIRING_INFO] = 0x80,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_LC_INIT] = 0x60,\n\t[MOD_HDCP_MESSAGE_ID_READ_LC_SEND_L_PRIME] = 0x80,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_SKE_SEND_EKS] = 0x60,\n\t[MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST] = 0x80,\n\t[MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST_PART2] = 0x80,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_SEND_ACK] = 0x60,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_STREAM_MANAGE] = 0x60,\n\t[MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_STREAM_READY] = 0x80,\n\t[MOD_HDCP_MESSAGE_ID_READ_RXSTATUS] = 0x70,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_CONTENT_STREAM_TYPE] = 0x0\n};\n\nstatic const uint32_t hdcp_dpcd_addrs[] = {\n\t[MOD_HDCP_MESSAGE_ID_READ_BKSV] = 0x68000,\n\t[MOD_HDCP_MESSAGE_ID_READ_RI_R0] = 0x68005,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKSV] = 0x68007,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AINFO] = 0x6803B,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AN] = 0x6800c,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_X] = 0x68014,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_0] = 0x68014,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_1] = 0x68018,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_2] = 0x6801c,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_3] = 0x68020,\n\t[MOD_HDCP_MESSAGE_ID_READ_VH_4] = 0x68024,\n\t[MOD_HDCP_MESSAGE_ID_READ_BCAPS] = 0x68028,\n\t[MOD_HDCP_MESSAGE_ID_READ_BSTATUS] = 0x68029,\n\t[MOD_HDCP_MESSAGE_ID_READ_KSV_FIFO] = 0x6802c,\n\t[MOD_HDCP_MESSAGE_ID_READ_BINFO] = 0x6802a,\n\t[MOD_HDCP_MESSAGE_ID_RX_CAPS] = 0x6921d,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKE_INIT] = 0x69000,\n\t[MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_CERT] = 0x6900b,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKE_NO_STORED_KM] = 0x69220,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_AKE_STORED_KM] = 0x692a0,\n\t[MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_H_PRIME] = 0x692c0,\n\t[MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_PAIRING_INFO] = 0x692e0,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_LC_INIT] = 0x692f0,\n\t[MOD_HDCP_MESSAGE_ID_READ_LC_SEND_L_PRIME] = 0x692f8,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_SKE_SEND_EKS] = 0x69318,\n\t[MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST] = 0x69330,\n\t[MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST_PART2] = 0x69340,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_SEND_ACK] = 0x693e0,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_STREAM_MANAGE] = 0x693f0,\n\t[MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_STREAM_READY] = 0x69473,\n\t[MOD_HDCP_MESSAGE_ID_READ_RXSTATUS] = 0x69493,\n\t[MOD_HDCP_MESSAGE_ID_WRITE_CONTENT_STREAM_TYPE] = 0x69494\n};\n\nstatic enum mod_hdcp_status read(struct mod_hdcp *hdcp,\n\t\tenum mod_hdcp_ddc_message_id msg_id,\n\t\tuint8_t *buf,\n\t\tuint32_t buf_len)\n{\n\tbool success = true;\n\tuint32_t cur_size = 0;\n\tuint32_t data_offset = 0;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\twhile (buf_len > 0) {\n\t\t\tcur_size = MIN(buf_len, HDCP_MAX_AUX_TRANSACTION_SIZE);\n\t\t\tsuccess = hdcp->config.ddc.funcs.read_dpcd(hdcp->config.ddc.handle,\n\t\t\t\t\thdcp_dpcd_addrs[msg_id] + data_offset,\n\t\t\t\t\tbuf + data_offset,\n\t\t\t\t\tcur_size);\n\n\t\t\tif (!success)\n\t\t\t\tbreak;\n\n\t\t\tbuf_len -= cur_size;\n\t\t\tdata_offset += cur_size;\n\t\t}\n\t} else {\n\t\tsuccess = hdcp->config.ddc.funcs.read_i2c(\n\t\t\t\thdcp->config.ddc.handle,\n\t\t\t\tHDCP_I2C_ADDR,\n\t\t\t\thdcp_i2c_offsets[msg_id],\n\t\t\t\tbuf,\n\t\t\t\t(uint32_t)buf_len);\n\t}\n\n\treturn success ? MOD_HDCP_STATUS_SUCCESS : MOD_HDCP_STATUS_DDC_FAILURE;\n}\n\nstatic enum mod_hdcp_status read_repeatedly(struct mod_hdcp *hdcp,\n\t\tenum mod_hdcp_ddc_message_id msg_id,\n\t\tuint8_t *buf,\n\t\tuint32_t buf_len,\n\t\tuint8_t read_size)\n{\n\tenum mod_hdcp_status status = MOD_HDCP_STATUS_DDC_FAILURE;\n\tuint32_t cur_size = 0;\n\tuint32_t data_offset = 0;\n\n\twhile (buf_len > 0) {\n\t\tcur_size = MIN(buf_len, read_size);\n\t\tstatus = read(hdcp, msg_id, buf + data_offset, cur_size);\n\n\t\tif (status != MOD_HDCP_STATUS_SUCCESS)\n\t\t\tbreak;\n\n\t\tbuf_len -= cur_size;\n\t\tdata_offset += cur_size;\n\t}\n\n\treturn status;\n}\n\nstatic enum mod_hdcp_status write(struct mod_hdcp *hdcp,\n\t\tenum mod_hdcp_ddc_message_id msg_id,\n\t\tuint8_t *buf,\n\t\tuint32_t buf_len)\n{\n\tbool success = true;\n\tuint32_t cur_size = 0;\n\tuint32_t data_offset = 0;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\twhile (buf_len > 0) {\n\t\t\tcur_size = MIN(buf_len, HDCP_MAX_AUX_TRANSACTION_SIZE);\n\t\t\tsuccess = hdcp->config.ddc.funcs.write_dpcd(\n\t\t\t\t\thdcp->config.ddc.handle,\n\t\t\t\t\thdcp_dpcd_addrs[msg_id] + data_offset,\n\t\t\t\t\tbuf + data_offset,\n\t\t\t\t\tcur_size);\n\n\t\t\tif (!success)\n\t\t\t\tbreak;\n\n\t\t\tbuf_len -= cur_size;\n\t\t\tdata_offset += cur_size;\n\t\t}\n\t} else {\n\t\thdcp->buf[0] = hdcp_i2c_offsets[msg_id];\n\t\tmemmove(&hdcp->buf[1], buf, buf_len);\n\t\tsuccess = hdcp->config.ddc.funcs.write_i2c(\n\t\t\t\thdcp->config.ddc.handle,\n\t\t\t\tHDCP_I2C_ADDR,\n\t\t\t\thdcp->buf,\n\t\t\t\t(uint32_t)(buf_len+1));\n\t}\n\n\treturn success ? MOD_HDCP_STATUS_SUCCESS : MOD_HDCP_STATUS_DDC_FAILURE;\n}\n\nenum mod_hdcp_status mod_hdcp_read_bksv(struct mod_hdcp *hdcp)\n{\n\treturn read(hdcp, MOD_HDCP_MESSAGE_ID_READ_BKSV,\n\t\t\thdcp->auth.msg.hdcp1.bksv,\n\t\t\tsizeof(hdcp->auth.msg.hdcp1.bksv));\n}\n\nenum mod_hdcp_status mod_hdcp_read_bcaps(struct mod_hdcp *hdcp)\n{\n\treturn read(hdcp, MOD_HDCP_MESSAGE_ID_READ_BCAPS,\n\t\t\t&hdcp->auth.msg.hdcp1.bcaps,\n\t\t\tsizeof(hdcp->auth.msg.hdcp1.bcaps));\n}\n\nenum mod_hdcp_status mod_hdcp_read_bstatus(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_BSTATUS,\n\t\t\t\t\t(uint8_t *)&hdcp->auth.msg.hdcp1.bstatus,\n\t\t\t\t\t1);\n\telse\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_BSTATUS,\n\t\t\t\t(uint8_t *)&hdcp->auth.msg.hdcp1.bstatus,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp1.bstatus));\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_r0p(struct mod_hdcp *hdcp)\n{\n\treturn read(hdcp, MOD_HDCP_MESSAGE_ID_READ_RI_R0,\n\t\t\t(uint8_t *)&hdcp->auth.msg.hdcp1.r0p,\n\t\t\tsizeof(hdcp->auth.msg.hdcp1.r0p));\n}\n\n \nenum mod_hdcp_status mod_hdcp_read_ksvlist(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = read_repeatedly(hdcp, MOD_HDCP_MESSAGE_ID_READ_KSV_FIFO,\n\t\t\t\thdcp->auth.msg.hdcp1.ksvlist,\n\t\t\t\thdcp->auth.msg.hdcp1.ksvlist_size,\n\t\t\t\tKSV_READ_SIZE);\n\telse\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_KSV_FIFO,\n\t\t\t\t(uint8_t *)&hdcp->auth.msg.hdcp1.ksvlist,\n\t\t\t\thdcp->auth.msg.hdcp1.ksvlist_size);\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_vp(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_VH_0,\n\t\t\t&hdcp->auth.msg.hdcp1.vp[0], 4);\n\tif (status != MOD_HDCP_STATUS_SUCCESS)\n\t\tgoto out;\n\n\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_VH_1,\n\t\t\t&hdcp->auth.msg.hdcp1.vp[4], 4);\n\tif (status != MOD_HDCP_STATUS_SUCCESS)\n\t\tgoto out;\n\n\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_VH_2,\n\t\t\t&hdcp->auth.msg.hdcp1.vp[8], 4);\n\tif (status != MOD_HDCP_STATUS_SUCCESS)\n\t\tgoto out;\n\n\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_VH_3,\n\t\t\t&hdcp->auth.msg.hdcp1.vp[12], 4);\n\tif (status != MOD_HDCP_STATUS_SUCCESS)\n\t\tgoto out;\n\n\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_VH_4,\n\t\t\t&hdcp->auth.msg.hdcp1.vp[16], 4);\nout:\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_binfo(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_BINFO,\n\t\t\t\t(uint8_t *)&hdcp->auth.msg.hdcp1.binfo_dp,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp1.binfo_dp));\n\telse\n\t\tstatus = MOD_HDCP_STATUS_INVALID_OPERATION;\n\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_aksv(struct mod_hdcp *hdcp)\n{\n\treturn write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AKSV,\n\t\t\thdcp->auth.msg.hdcp1.aksv,\n\t\t\tsizeof(hdcp->auth.msg.hdcp1.aksv));\n}\n\nenum mod_hdcp_status mod_hdcp_write_ainfo(struct mod_hdcp *hdcp)\n{\n\treturn write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AINFO,\n\t\t\t&hdcp->auth.msg.hdcp1.ainfo,\n\t\t\tsizeof(hdcp->auth.msg.hdcp1.ainfo));\n}\n\nenum mod_hdcp_status mod_hdcp_write_an(struct mod_hdcp *hdcp)\n{\n\treturn write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AN,\n\t\t\thdcp->auth.msg.hdcp1.an,\n\t\t\tsizeof(hdcp->auth.msg.hdcp1.an));\n}\n\nenum mod_hdcp_status mod_hdcp_read_hdcp2version(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = MOD_HDCP_STATUS_INVALID_OPERATION;\n\telse\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_HDCP2VERSION,\n\t\t\t\t&hdcp->auth.msg.hdcp2.hdcp2version_hdmi,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.hdcp2version_hdmi));\n\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_rxcaps(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (!is_dp_hdcp(hdcp))\n\t\tstatus = MOD_HDCP_STATUS_INVALID_OPERATION;\n\telse\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_RX_CAPS,\n\t\t\t\thdcp->auth.msg.hdcp2.rxcaps_dp,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.rxcaps_dp));\n\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_rxstatus(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_RXSTATUS,\n\t\t\t\t&hdcp->auth.msg.hdcp2.rxstatus_dp,\n\t\t\t\t1);\n\t} else {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_RXSTATUS,\n\t\t\t\t\t(uint8_t *)&hdcp->auth.msg.hdcp2.rxstatus,\n\t\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.rxstatus));\n\t}\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_ake_cert(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\thdcp->auth.msg.hdcp2.ake_cert[0] = HDCP_2_2_AKE_SEND_CERT;\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_CERT,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_cert+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_cert)-1);\n\n\t} else {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_CERT,\n\t\t\t\t\thdcp->auth.msg.hdcp2.ake_cert,\n\t\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_cert));\n\t}\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_h_prime(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\thdcp->auth.msg.hdcp2.ake_h_prime[0] = HDCP_2_2_AKE_SEND_HPRIME;\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_H_PRIME,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_h_prime+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_h_prime)-1);\n\n\t} else {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_H_PRIME,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_h_prime,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_h_prime));\n\t}\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_pairing_info(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\thdcp->auth.msg.hdcp2.ake_pairing_info[0] = HDCP_2_2_AKE_SEND_PAIRING_INFO;\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_PAIRING_INFO,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_pairing_info+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_pairing_info)-1);\n\n\t} else {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_AKE_SEND_PAIRING_INFO,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_pairing_info,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_pairing_info));\n\t}\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_l_prime(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\thdcp->auth.msg.hdcp2.lc_l_prime[0] = HDCP_2_2_LC_SEND_LPRIME;\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_LC_SEND_L_PRIME,\n\t\t\t\thdcp->auth.msg.hdcp2.lc_l_prime+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.lc_l_prime)-1);\n\n\t} else {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_LC_SEND_L_PRIME,\n\t\t\t\thdcp->auth.msg.hdcp2.lc_l_prime,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.lc_l_prime));\n\t}\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_rx_id_list(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status = MOD_HDCP_STATUS_SUCCESS;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\tuint32_t device_count = 0;\n\t\tuint32_t rx_id_list_size = 0;\n\t\tuint32_t bytes_read = 0;\n\n\t\thdcp->auth.msg.hdcp2.rx_id_list[0] = HDCP_2_2_REP_SEND_RECVID_LIST;\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST,\n\t\t\t\t\t\thdcp->auth.msg.hdcp2.rx_id_list+1,\n\t\t\t\t\t\tHDCP_MAX_AUX_TRANSACTION_SIZE);\n\t\tif (status == MOD_HDCP_STATUS_SUCCESS) {\n\t\t\tbytes_read = HDCP_MAX_AUX_TRANSACTION_SIZE;\n\t\t\tdevice_count = HDCP_2_2_DEV_COUNT_LO(hdcp->auth.msg.hdcp2.rx_id_list[2]) +\n\t\t\t\t\t(HDCP_2_2_DEV_COUNT_HI(hdcp->auth.msg.hdcp2.rx_id_list[1]) << 4);\n\t\t\trx_id_list_size = MIN((21 + 5 * device_count),\n\t\t\t\t\t(sizeof(hdcp->auth.msg.hdcp2.rx_id_list) - 1));\n\t\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST_PART2,\n\t\t\t\t\thdcp->auth.msg.hdcp2.rx_id_list + 1 + bytes_read,\n\t\t\t\t\t(rx_id_list_size - 1) / HDCP_MAX_AUX_TRANSACTION_SIZE * HDCP_MAX_AUX_TRANSACTION_SIZE);\n\t\t}\n\t} else {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_SEND_RECEIVERID_LIST,\n\t\t\t\thdcp->auth.msg.hdcp2.rx_id_list,\n\t\t\t\thdcp->auth.msg.hdcp2.rx_id_list_size);\n\t}\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_read_stream_ready(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\thdcp->auth.msg.hdcp2.repeater_auth_stream_ready[0] = HDCP_2_2_REP_STREAM_READY;\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_STREAM_READY,\n\t\t\t\thdcp->auth.msg.hdcp2.repeater_auth_stream_ready+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.repeater_auth_stream_ready)-1);\n\n\t} else {\n\t\tstatus = read(hdcp, MOD_HDCP_MESSAGE_ID_READ_REPEATER_AUTH_STREAM_READY,\n\t\t\t\thdcp->auth.msg.hdcp2.repeater_auth_stream_ready,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.repeater_auth_stream_ready));\n\t}\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_ake_init(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AKE_INIT,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_init+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_init)-1);\n\telse\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AKE_INIT,\n\t\t\t\t\thdcp->auth.msg.hdcp2.ake_init,\n\t\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_init));\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_no_stored_km(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AKE_NO_STORED_KM,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_no_stored_km+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_no_stored_km)-1);\n\telse\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AKE_NO_STORED_KM,\n\t\t\thdcp->auth.msg.hdcp2.ake_no_stored_km,\n\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_no_stored_km));\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_stored_km(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AKE_STORED_KM,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_stored_km+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_stored_km)-1);\n\telse\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_AKE_STORED_KM,\n\t\t\t\thdcp->auth.msg.hdcp2.ake_stored_km,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ake_stored_km));\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_lc_init(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_LC_INIT,\n\t\t\t\thdcp->auth.msg.hdcp2.lc_init+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.lc_init)-1);\n\telse\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_LC_INIT,\n\t\t\t\thdcp->auth.msg.hdcp2.lc_init,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.lc_init));\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_eks(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp,\n\t\t\t\tMOD_HDCP_MESSAGE_ID_WRITE_SKE_SEND_EKS,\n\t\t\t\thdcp->auth.msg.hdcp2.ske_eks+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.ske_eks)-1);\n\telse\n\t\tstatus = write(hdcp,\n\t\t\tMOD_HDCP_MESSAGE_ID_WRITE_SKE_SEND_EKS,\n\t\t\thdcp->auth.msg.hdcp2.ske_eks,\n\t\t\tsizeof(hdcp->auth.msg.hdcp2.ske_eks));\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_repeater_auth_ack(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_SEND_ACK,\n\t\t\t\thdcp->auth.msg.hdcp2.repeater_auth_ack+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.repeater_auth_ack)-1);\n\telse\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_SEND_ACK,\n\t\t\t\thdcp->auth.msg.hdcp2.repeater_auth_ack,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.repeater_auth_ack));\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_stream_manage(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp,\n\t\t\t\tMOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_STREAM_MANAGE,\n\t\t\t\thdcp->auth.msg.hdcp2.repeater_auth_stream_manage+1,\n\t\t\t\thdcp->auth.msg.hdcp2.stream_manage_size-1);\n\telse\n\t\tstatus = write(hdcp,\n\t\t\t\tMOD_HDCP_MESSAGE_ID_WRITE_REPEATER_AUTH_STREAM_MANAGE,\n\t\t\t\thdcp->auth.msg.hdcp2.repeater_auth_stream_manage,\n\t\t\t\thdcp->auth.msg.hdcp2.stream_manage_size);\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_write_content_type(struct mod_hdcp *hdcp)\n{\n\tenum mod_hdcp_status status;\n\n\tif (is_dp_hdcp(hdcp))\n\t\tstatus = write(hdcp, MOD_HDCP_MESSAGE_ID_WRITE_CONTENT_STREAM_TYPE,\n\t\t\t\thdcp->auth.msg.hdcp2.content_stream_type_dp+1,\n\t\t\t\tsizeof(hdcp->auth.msg.hdcp2.content_stream_type_dp)-1);\n\telse\n\t\tstatus = MOD_HDCP_STATUS_INVALID_OPERATION;\n\treturn status;\n}\n\nenum mod_hdcp_status mod_hdcp_clear_cp_irq_status(struct mod_hdcp *hdcp)\n{\n\tuint8_t clear_cp_irq_bit = DP_CP_IRQ;\n\tuint32_t size = 1;\n\n\tif (is_dp_hdcp(hdcp)) {\n\t\tuint32_t cp_irq_addrs = (hdcp->connection.link.dp.rev >= 0x14)\n\t\t\t\t? DP_DEVICE_SERVICE_IRQ_VECTOR_ESI0:DP_DEVICE_SERVICE_IRQ_VECTOR;\n\t\treturn hdcp->config.ddc.funcs.write_dpcd(hdcp->config.ddc.handle, cp_irq_addrs,\n\t\t\t\t&clear_cp_irq_bit, size) ? MOD_HDCP_STATUS_SUCCESS : MOD_HDCP_STATUS_DDC_FAILURE;\n\t}\n\n\treturn MOD_HDCP_STATUS_INVALID_OPERATION;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}