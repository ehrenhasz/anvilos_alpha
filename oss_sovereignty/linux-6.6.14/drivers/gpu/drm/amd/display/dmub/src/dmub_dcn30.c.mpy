{
  "module_name": "dmub_dcn30.c",
  "hash_id": "6be762ecd03cdaef5f94d00bd4e26568ba45509ab78fd09929c2a709dd09c21f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dmub/src/dmub_dcn30.c",
  "human_readable_source": " \n\n#include \"../dmub_srv.h\"\n#include \"dmub_reg.h\"\n#include \"dmub_dcn20.h\"\n#include \"dmub_dcn30.h\"\n\n#include \"sienna_cichlid_ip_offset.h\"\n#include \"dcn/dcn_3_0_0_offset.h\"\n#include \"dcn/dcn_3_0_0_sh_mask.h\"\n\n#define BASE_INNER(seg) DCN_BASE__INST0_SEG##seg\n#define CTX dmub\n#define REGS dmub->regs\n\n \n\nconst struct dmub_srv_common_regs dmub_srv_dcn30_regs = {\n#define DMUB_SR(reg) REG_OFFSET(reg),\n\t{\n\t\tDMUB_COMMON_REGS()\n\t\tDMCUB_INTERNAL_REGS()\n\t},\n#undef DMUB_SR\n\n#define DMUB_SF(reg, field) FD_MASK(reg, field),\n\t{ DMUB_COMMON_FIELDS() },\n#undef DMUB_SF\n\n#define DMUB_SF(reg, field) FD_SHIFT(reg, field),\n\t{ DMUB_COMMON_FIELDS() },\n#undef DMUB_SF\n};\n\n \n\nstatic void dmub_dcn30_get_fb_base_offset(struct dmub_srv *dmub,\n\t\t\t\t\t  uint64_t *fb_base,\n\t\t\t\t\t  uint64_t *fb_offset)\n{\n\tuint32_t tmp;\n\n\tif (dmub->fb_base || dmub->fb_offset) {\n\t\t*fb_base = dmub->fb_base;\n\t\t*fb_offset = dmub->fb_offset;\n\t\treturn;\n\t}\n\n\tREG_GET(DCN_VM_FB_LOCATION_BASE, FB_BASE, &tmp);\n\t*fb_base = (uint64_t)tmp << 24;\n\n\tREG_GET(DCN_VM_FB_OFFSET, FB_OFFSET, &tmp);\n\t*fb_offset = (uint64_t)tmp << 24;\n}\n\nstatic inline void dmub_dcn30_translate_addr(const union dmub_addr *addr_in,\n\t\t\t\t\t     uint64_t fb_base,\n\t\t\t\t\t     uint64_t fb_offset,\n\t\t\t\t\t     union dmub_addr *addr_out)\n{\n\taddr_out->quad_part = addr_in->quad_part - fb_base + fb_offset;\n}\n\nvoid dmub_dcn30_backdoor_load(struct dmub_srv *dmub,\n\t\t\t      const struct dmub_window *cw0,\n\t\t\t      const struct dmub_window *cw1)\n{\n\tunion dmub_addr offset;\n\tuint64_t fb_base, fb_offset;\n\n\tdmub_dcn30_get_fb_base_offset(dmub, &fb_base, &fb_offset);\n\n\tREG_UPDATE(DMCUB_SEC_CNTL, DMCUB_SEC_RESET, 1);\n\n\t \n\n\tdmub_dcn30_translate_addr(&cw0->offset, fb_base, fb_offset, &offset);\n\n\tREG_WRITE(DMCUB_REGION3_CW0_OFFSET, offset.u.low_part);\n\tREG_WRITE(DMCUB_REGION3_CW0_OFFSET_HIGH, offset.u.high_part);\n\tREG_WRITE(DMCUB_REGION3_CW0_BASE_ADDRESS, cw0->region.base);\n\tREG_SET_2(DMCUB_REGION3_CW0_TOP_ADDRESS, 0,\n\t\t  DMCUB_REGION3_CW0_TOP_ADDRESS, cw0->region.top,\n\t\t  DMCUB_REGION3_CW0_ENABLE, 1);\n\n\tdmub_dcn30_translate_addr(&cw1->offset, fb_base, fb_offset, &offset);\n\n\tREG_WRITE(DMCUB_REGION3_CW1_OFFSET, offset.u.low_part);\n\tREG_WRITE(DMCUB_REGION3_CW1_OFFSET_HIGH, offset.u.high_part);\n\tREG_WRITE(DMCUB_REGION3_CW1_BASE_ADDRESS, cw1->region.base);\n\tREG_SET_2(DMCUB_REGION3_CW1_TOP_ADDRESS, 0,\n\t\t  DMCUB_REGION3_CW1_TOP_ADDRESS, cw1->region.top,\n\t\t  DMCUB_REGION3_CW1_ENABLE, 1);\n\n\tREG_UPDATE_2(DMCUB_SEC_CNTL, DMCUB_SEC_RESET, 0, DMCUB_MEM_UNIT_ID,\n\t\t     0x20);\n}\n\nvoid dmub_dcn30_setup_windows(struct dmub_srv *dmub,\n\t\t\t      const struct dmub_window *cw2,\n\t\t\t      const struct dmub_window *cw3,\n\t\t\t      const struct dmub_window *cw4,\n\t\t\t      const struct dmub_window *cw5,\n\t\t\t      const struct dmub_window *cw6)\n{\n\tunion dmub_addr offset;\n\n\t \n\n\toffset = cw2->offset;\n\n\tif (cw2->region.base != cw2->region.top) {\n\t\tREG_WRITE(DMCUB_REGION3_CW2_OFFSET, offset.u.low_part);\n\t\tREG_WRITE(DMCUB_REGION3_CW2_OFFSET_HIGH, offset.u.high_part);\n\t\tREG_WRITE(DMCUB_REGION3_CW2_BASE_ADDRESS, cw2->region.base);\n\t\tREG_SET_2(DMCUB_REGION3_CW2_TOP_ADDRESS, 0,\n\t\t\t  DMCUB_REGION3_CW2_TOP_ADDRESS, cw2->region.top,\n\t\t\t  DMCUB_REGION3_CW2_ENABLE, 1);\n\t} else {\n\t\tREG_WRITE(DMCUB_REGION3_CW2_OFFSET, 0);\n\t\tREG_WRITE(DMCUB_REGION3_CW2_OFFSET_HIGH, 0);\n\t\tREG_WRITE(DMCUB_REGION3_CW2_BASE_ADDRESS, 0);\n\t\tREG_WRITE(DMCUB_REGION3_CW2_TOP_ADDRESS, 0);\n\t}\n\n\toffset = cw3->offset;\n\n\tREG_WRITE(DMCUB_REGION3_CW3_OFFSET, offset.u.low_part);\n\tREG_WRITE(DMCUB_REGION3_CW3_OFFSET_HIGH, offset.u.high_part);\n\tREG_WRITE(DMCUB_REGION3_CW3_BASE_ADDRESS, cw3->region.base);\n\tREG_SET_2(DMCUB_REGION3_CW3_TOP_ADDRESS, 0,\n\t\t  DMCUB_REGION3_CW3_TOP_ADDRESS, cw3->region.top,\n\t\t  DMCUB_REGION3_CW3_ENABLE, 1);\n\n\toffset = cw4->offset;\n\n\t \n\tif (dmub_dcn20_use_cached_inbox(dmub)) {\n\t\tREG_WRITE(DMCUB_REGION3_CW4_OFFSET, offset.u.low_part);\n\t\tREG_WRITE(DMCUB_REGION3_CW4_OFFSET_HIGH, offset.u.high_part);\n\t\tREG_WRITE(DMCUB_REGION3_CW4_BASE_ADDRESS, cw4->region.base);\n\t\tREG_SET_2(DMCUB_REGION3_CW4_TOP_ADDRESS, 0,\n\t\t\t  DMCUB_REGION3_CW4_TOP_ADDRESS, cw4->region.top,\n\t\t\t  DMCUB_REGION3_CW4_ENABLE, 1);\n\t} else {\n\t\tREG_WRITE(DMCUB_REGION4_OFFSET, offset.u.low_part);\n\t\tREG_WRITE(DMCUB_REGION4_OFFSET_HIGH, offset.u.high_part);\n\t\tREG_SET_2(DMCUB_REGION4_TOP_ADDRESS, 0,\n\t\t\t  DMCUB_REGION4_TOP_ADDRESS,\n\t\t\t  cw4->region.top - cw4->region.base - 1,\n\t\t\t  DMCUB_REGION4_ENABLE, 1);\n\t}\n\n\toffset = cw5->offset;\n\n\tREG_WRITE(DMCUB_REGION3_CW5_OFFSET, offset.u.low_part);\n\tREG_WRITE(DMCUB_REGION3_CW5_OFFSET_HIGH, offset.u.high_part);\n\tREG_WRITE(DMCUB_REGION3_CW5_BASE_ADDRESS, cw5->region.base);\n\tREG_SET_2(DMCUB_REGION3_CW5_TOP_ADDRESS, 0,\n\t\t  DMCUB_REGION3_CW5_TOP_ADDRESS, cw5->region.top,\n\t\t  DMCUB_REGION3_CW5_ENABLE, 1);\n\n\tREG_WRITE(DMCUB_REGION5_OFFSET, offset.u.low_part);\n\tREG_WRITE(DMCUB_REGION5_OFFSET_HIGH, offset.u.high_part);\n\tREG_SET_2(DMCUB_REGION5_TOP_ADDRESS, 0,\n\t\t  DMCUB_REGION5_TOP_ADDRESS,\n\t\t  cw5->region.top - cw5->region.base - 1,\n\t\t  DMCUB_REGION5_ENABLE, 1);\n\n\toffset = cw6->offset;\n\n\tREG_WRITE(DMCUB_REGION3_CW6_OFFSET, offset.u.low_part);\n\tREG_WRITE(DMCUB_REGION3_CW6_OFFSET_HIGH, offset.u.high_part);\n\tREG_WRITE(DMCUB_REGION3_CW6_BASE_ADDRESS, cw6->region.base);\n\tREG_SET_2(DMCUB_REGION3_CW6_TOP_ADDRESS, 0,\n\t\t  DMCUB_REGION3_CW6_TOP_ADDRESS, cw6->region.top,\n\t\t  DMCUB_REGION3_CW6_ENABLE, 1);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}