{
  "module_name": "dmub_reg.c",
  "hash_id": "fc7be9dc35fec49365580745224620a6a2e90f79c4455cf9811dea22667af82b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dmub/src/dmub_reg.c",
  "human_readable_source": " \n\n#include \"dmub_reg.h\"\n#include \"../dmub_srv.h\"\n\nstruct dmub_reg_value_masks {\n\tuint32_t value;\n\tuint32_t mask;\n};\n\nstatic inline void\nset_reg_field_value_masks(struct dmub_reg_value_masks *field_value_mask,\n\t\t\t  uint32_t value, uint32_t mask, uint8_t shift)\n{\n\tfield_value_mask->value =\n\t\t(field_value_mask->value & ~mask) | (mask & (value << shift));\n\tfield_value_mask->mask = field_value_mask->mask | mask;\n}\n\nstatic void set_reg_field_values(struct dmub_reg_value_masks *field_value_mask,\n\t\t\t\t uint32_t addr, int n, uint8_t shift1,\n\t\t\t\t uint32_t mask1, uint32_t field_value1,\n\t\t\t\t va_list ap)\n{\n\tuint32_t shift, mask, field_value;\n\tint i = 1;\n\n\t \n\tset_reg_field_value_masks(field_value_mask, field_value1, mask1,\n\t\t\t\t  shift1);\n\n\twhile (i < n) {\n\t\tshift = va_arg(ap, uint32_t);\n\t\tmask = va_arg(ap, uint32_t);\n\t\tfield_value = va_arg(ap, uint32_t);\n\n\t\tset_reg_field_value_masks(field_value_mask, field_value, mask,\n\t\t\t\t\t  shift);\n\t\ti++;\n\t}\n}\n\nstatic inline uint32_t get_reg_field_value_ex(uint32_t reg_value, uint32_t mask,\n\t\t\t\t\t      uint8_t shift)\n{\n\treturn (mask & reg_value) >> shift;\n}\n\nvoid dmub_reg_update(struct dmub_srv *srv, uint32_t addr, int n, uint8_t shift1,\n\t\t     uint32_t mask1, uint32_t field_value1, ...)\n{\n\tstruct dmub_reg_value_masks field_value_mask = { 0 };\n\tuint32_t reg_val;\n\tva_list ap;\n\n\tva_start(ap, field_value1);\n\tset_reg_field_values(&field_value_mask, addr, n, shift1, mask1,\n\t\t\t     field_value1, ap);\n\tva_end(ap);\n\n\treg_val = srv->funcs.reg_read(srv->user_ctx, addr);\n\treg_val = (reg_val & ~field_value_mask.mask) | field_value_mask.value;\n\tsrv->funcs.reg_write(srv->user_ctx, addr, reg_val);\n}\n\nvoid dmub_reg_set(struct dmub_srv *srv, uint32_t addr, uint32_t reg_val, int n,\n\t\t  uint8_t shift1, uint32_t mask1, uint32_t field_value1, ...)\n{\n\tstruct dmub_reg_value_masks field_value_mask = { 0 };\n\tva_list ap;\n\n\tva_start(ap, field_value1);\n\tset_reg_field_values(&field_value_mask, addr, n, shift1, mask1,\n\t\t\t     field_value1, ap);\n\tva_end(ap);\n\n\treg_val = (reg_val & ~field_value_mask.mask) | field_value_mask.value;\n\tsrv->funcs.reg_write(srv->user_ctx, addr, reg_val);\n}\n\nvoid dmub_reg_get(struct dmub_srv *srv, uint32_t addr, uint8_t shift,\n\t\t  uint32_t mask, uint32_t *field_value)\n{\n\tuint32_t reg_val = srv->funcs.reg_read(srv->user_ctx, addr);\n\t*field_value = get_reg_field_value_ex(reg_val, mask, shift);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}