{
  "module_name": "link_fpga.c",
  "hash_id": "b4c225082f7fe56a49ad015c5cb8073a812445e7ad58869e5432a4b27ba21288",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/link/accessories/link_fpga.c",
  "human_readable_source": " \n#include \"link_fpga.h\"\n#include \"link/link_dpms.h\"\n#include \"dm_helpers.h\"\n#include \"link_hwss.h\"\n#include \"dccg.h\"\n#include \"resource.h\"\n\n#define DC_LOGGER_INIT(logger)\n\nvoid dp_fpga_hpo_enable_link_and_stream(struct dc_state *state, struct pipe_ctx *pipe_ctx)\n{\n\tstruct dc *dc = pipe_ctx->stream->ctx->dc;\n\tstruct dc_stream_state *stream = pipe_ctx->stream;\n\tstruct link_mst_stream_allocation_table proposed_table = {0};\n\tstruct fixed31_32 avg_time_slots_per_mtp;\n\tuint8_t req_slot_count = 0;\n\tuint8_t vc_id = 1; \n\tstruct dc_link_settings link_settings = pipe_ctx->link_config.dp_link_settings;\n\tconst struct link_hwss *link_hwss = get_link_hwss(stream->link, &pipe_ctx->link_res);\n\tDC_LOGGER_INIT(pipe_ctx->stream->ctx->logger);\n\n\tstream->link->cur_link_settings = link_settings;\n\n\tif (link_hwss->ext.enable_dp_link_output)\n\t\tlink_hwss->ext.enable_dp_link_output(stream->link, &pipe_ctx->link_res,\n\t\t\t\tstream->signal, pipe_ctx->clock_source->id,\n\t\t\t\t&link_settings);\n\n\t \n\tdc->hwss.enable_stream(pipe_ctx);\n\n\t \n\tif (pipe_ctx->stream->timing.flags.DSC) {\n\t\tlink_set_dsc_pps_packet(pipe_ctx, true, true);\n\t}\n\n\t \n\tif ((stream->signal == SIGNAL_TYPE_DISPLAY_PORT_MST) && (state->stream_count > 1)) {\n\t\t\n\t\tuint8_t i;\n\n\t\tproposed_table.stream_count = state->stream_count;\n\t\tfor (i = 0; i < state->stream_count; i++) {\n\t\t\tavg_time_slots_per_mtp = link_calculate_sst_avg_time_slots_per_mtp(state->streams[i], state->streams[i]->link);\n\t\t\treq_slot_count = dc_fixpt_ceil(avg_time_slots_per_mtp);\n\t\t\tproposed_table.stream_allocations[i].slot_count = req_slot_count;\n\t\t\tproposed_table.stream_allocations[i].vcp_id = i+1;\n\t\t\t \n\t\t\tproposed_table.stream_allocations[i].hpo_dp_stream_enc = state->res_ctx.pipe_ctx[i].stream_res.hpo_dp_stream_enc;\n\t\t}\n\t} else {\n\t\t\n\t\tavg_time_slots_per_mtp = link_calculate_sst_avg_time_slots_per_mtp(stream, stream->link);\n\t\treq_slot_count = dc_fixpt_ceil(avg_time_slots_per_mtp);\n\t\tproposed_table.stream_count = 1; \n\t\tproposed_table.stream_allocations[0].slot_count = req_slot_count;\n\t\tproposed_table.stream_allocations[0].vcp_id = vc_id;\n\t\tproposed_table.stream_allocations[0].hpo_dp_stream_enc = pipe_ctx->stream_res.hpo_dp_stream_enc;\n\t}\n\n\tlink_hwss->ext.update_stream_allocation_table(stream->link,\n\t\t\t&pipe_ctx->link_res,\n\t\t\t&proposed_table);\n\n\tif (link_hwss->ext.set_throttled_vcp_size)\n\t\tlink_hwss->ext.set_throttled_vcp_size(pipe_ctx, avg_time_slots_per_mtp);\n\n\tdc->hwss.unblank_stream(pipe_ctx, &stream->link->cur_link_settings);\n\tdc->hwss.enable_audio_stream(pipe_ctx);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}