{
  "module_name": "dcn10_hw_sequencer_debug.c",
  "hash_id": "ad1c78a3f66702b923c53f64e8512ede56603aa7b3da379264a8438ffa49b5c6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn10/dcn10_hw_sequencer_debug.c",
  "human_readable_source": " \n\n#include \"dm_services.h\"\n#include \"core_types.h\"\n#include \"resource.h\"\n#include \"custom_float.h\"\n#include \"dcn10_hw_sequencer.h\"\n#include \"dce110/dce110_hw_sequencer.h\"\n#include \"dce/dce_hwseq.h\"\n#include \"abm.h\"\n#include \"dmcu.h\"\n#include \"dcn10_optc.h\"\n#include \"dcn10/dcn10_dpp.h\"\n#include \"dcn10/dcn10_mpc.h\"\n#include \"timing_generator.h\"\n#include \"opp.h\"\n#include \"ipp.h\"\n#include \"mpc.h\"\n#include \"reg_helper.h\"\n#include \"dcn10_hubp.h\"\n#include \"dcn10_hubbub.h\"\n#include \"dcn10_cm_common.h\"\n#include \"clk_mgr.h\"\n\n__printf(3, 4)\nunsigned int snprintf_count(char *pbuf, unsigned int bufsize, char *fmt, ...)\n{\n\tint ret_vsnprintf;\n\tunsigned int chars_printed;\n\n\tva_list args;\n\tva_start(args, fmt);\n\n\tret_vsnprintf = vsnprintf(pbuf, bufsize, fmt, args);\n\n\tva_end(args);\n\n\tif (ret_vsnprintf > 0) {\n\t\tif (ret_vsnprintf < bufsize)\n\t\t\tchars_printed = ret_vsnprintf;\n\t\telse\n\t\t\tchars_printed = bufsize - 1;\n\t} else\n\t\tchars_printed = 0;\n\n\treturn chars_printed;\n}\n\nstatic unsigned int dcn10_get_hubbub_state(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tstruct dc_context *dc_ctx = dc->ctx;\n\tstruct dcn_hubbub_wm wm;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tconst uint32_t ref_clk_mhz = dc_ctx->dc->res_pool->ref_clocks.dchub_ref_clock_inKhz / 1000;\n\tstatic const unsigned int frac = 1000;\n\n\tmemset(&wm, 0, sizeof(struct dcn_hubbub_wm));\n\tdc->res_pool->hubbub->funcs->wm_read_state(dc->res_pool->hubbub, &wm);\n\n\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"wm_set_index,data_urgent,pte_meta_urgent,sr_enter,sr_exit,dram_clk_change\\n\");\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < 4; i++) {\n\t\tstruct dcn_hubbub_wm_set *s;\n\n\t\ts = &wm.sets[i];\n\n\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%d.%03d,%d.%03d,%d.%03d,%d.%03d,%d.%03d\\n\",\n\t\t\ts->wm_set,\n\t\t\t(s->data_urgent * frac) / ref_clk_mhz / frac, (s->data_urgent * frac) / ref_clk_mhz % frac,\n\t\t\t(s->pte_meta_urgent * frac) / ref_clk_mhz / frac, (s->pte_meta_urgent * frac) / ref_clk_mhz % frac,\n\t\t\t(s->sr_enter * frac) / ref_clk_mhz / frac, (s->sr_enter * frac) / ref_clk_mhz % frac,\n\t\t\t(s->sr_exit * frac) / ref_clk_mhz / frac, (s->sr_exit * frac) / ref_clk_mhz % frac,\n\t\t\t(s->dram_clk_change * frac) / ref_clk_mhz / frac, (s->dram_clk_change * frac) / ref_clk_mhz % frac);\n\t\tremaining_buffer -= chars_printed;\n\t\tpBuf += chars_printed;\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_hubp_states(struct dc *dc, char *pBuf, unsigned int bufSize, bool invarOnly)\n{\n\tstruct dc_context *dc_ctx = dc->ctx;\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tconst uint32_t ref_clk_mhz = dc_ctx->dc->res_pool->ref_clocks.dchub_ref_clock_inKhz / 1000;\n\tstatic const unsigned int frac = 1000;\n\n\tif (invarOnly)\n\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,format,addr_hi,width,height,rotation,mirror,sw_mode,dcc_en,blank_en,ttu_dis,underflow,\"\n\t\t\t\"min_ttu_vblank,qos_low_wm,qos_high_wm\"\n\t\t\t\"\\n\");\n\telse\n\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,format,addr_hi,addr_lo,width,height,rotation,mirror,sw_mode,dcc_en,blank_en,ttu_dis,underflow,\"\n\t\t\t\t\t\"min_ttu_vblank,qos_low_wm,qos_high_wm\"\n\t\t\t\t\t\"\\n\");\n\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < pool->pipe_count; i++) {\n\t\tstruct hubp *hubp = pool->hubps[i];\n\t\tstruct dcn_hubp_state *s = &(TO_DCN10_HUBP(hubp)->state);\n\n\t\thubp->funcs->hubp_read_state(hubp);\n\n\t\tif (!s->blank_en) {\n\t\t\tif (invarOnly)\n\t\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%x,%x,%d,%d,%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\t\"%d.%03d,%d.%03d,%d.%03d\"\n\t\t\t\t\t\"\\n\",\n\t\t\t\t\thubp->inst,\n\t\t\t\t\ts->pixel_format,\n\t\t\t\t\ts->inuse_addr_hi,\n\t\t\t\t\ts->viewport_width,\n\t\t\t\t\ts->viewport_height,\n\t\t\t\t\ts->rotation_angle,\n\t\t\t\t\ts->h_mirror_en,\n\t\t\t\t\ts->sw_mode,\n\t\t\t\t\ts->dcc_en,\n\t\t\t\t\ts->blank_en,\n\t\t\t\t\ts->ttu_disable,\n\t\t\t\t\ts->underflow_status,\n\t\t\t\t\t(s->min_ttu_vblank * frac) / ref_clk_mhz / frac, (s->min_ttu_vblank * frac) / ref_clk_mhz % frac,\n\t\t\t\t\t(s->qos_level_low_wm * frac) / ref_clk_mhz / frac, (s->qos_level_low_wm * frac) / ref_clk_mhz % frac,\n\t\t\t\t\t(s->qos_level_high_wm * frac) / ref_clk_mhz / frac, (s->qos_level_high_wm * frac) / ref_clk_mhz % frac);\n\t\t\telse\n\t\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%x,%x,%x,%d,%d,%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\t\"%d.%03d,%d.%03d,%d.%03d\"\n\t\t\t\t\t\"\\n\",\n\t\t\t\t\thubp->inst,\n\t\t\t\t\ts->pixel_format,\n\t\t\t\t\ts->inuse_addr_hi,\n\t\t\t\t\ts->inuse_addr_lo,\n\t\t\t\t\ts->viewport_width,\n\t\t\t\t\ts->viewport_height,\n\t\t\t\t\ts->rotation_angle,\n\t\t\t\t\ts->h_mirror_en,\n\t\t\t\t\ts->sw_mode,\n\t\t\t\t\ts->dcc_en,\n\t\t\t\t\ts->blank_en,\n\t\t\t\t\ts->ttu_disable,\n\t\t\t\t\ts->underflow_status,\n\t\t\t\t\t(s->min_ttu_vblank * frac) / ref_clk_mhz / frac, (s->min_ttu_vblank * frac) / ref_clk_mhz % frac,\n\t\t\t\t\t(s->qos_level_low_wm * frac) / ref_clk_mhz / frac, (s->qos_level_low_wm * frac) / ref_clk_mhz % frac,\n\t\t\t\t\t(s->qos_level_high_wm * frac) / ref_clk_mhz / frac, (s->qos_level_high_wm * frac) / ref_clk_mhz % frac);\n\n\t\t\tremaining_buffer -= chars_printed;\n\t\t\tpBuf += chars_printed;\n\t\t}\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_rq_states(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,drq_exp_m,prq_exp_m,mrq_exp_m,crq_exp_m,plane1_ba,\"\n\t\t\"luma_chunk_s,luma_min_chu_s,luma_meta_ch_s,luma_min_m_c_s,luma_dpte_gr_s,luma_mpte_gr_s,luma_swath_hei,luma_pte_row_h,\"\n\t\t\"chroma_chunk_s,chroma_min_chu_s,chroma_meta_ch_s,chroma_min_m_c_s,chroma_dpte_gr_s,chroma_mpte_gr_s,chroma_swath_hei,chroma_pte_row_h\"\n\t\t\"\\n\");\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < pool->pipe_count; i++) {\n\t\tstruct dcn_hubp_state *s = &(TO_DCN10_HUBP(pool->hubps[i])->state);\n\t\tstruct _vcs_dpi_display_rq_regs_st *rq_regs = &s->rq_regs;\n\n\t\tif (!s->blank_en) {\n\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,%x\"\n\t\t\t\t\"\\n\",\n\t\t\t\tpool->hubps[i]->inst, rq_regs->drq_expansion_mode, rq_regs->prq_expansion_mode, rq_regs->mrq_expansion_mode,\n\t\t\t\trq_regs->crq_expansion_mode, rq_regs->plane1_base_address, rq_regs->rq_regs_l.chunk_size,\n\t\t\t\trq_regs->rq_regs_l.min_chunk_size, rq_regs->rq_regs_l.meta_chunk_size,\n\t\t\t\trq_regs->rq_regs_l.min_meta_chunk_size, rq_regs->rq_regs_l.dpte_group_size,\n\t\t\t\trq_regs->rq_regs_l.mpte_group_size, rq_regs->rq_regs_l.swath_height,\n\t\t\t\trq_regs->rq_regs_l.pte_row_height_linear, rq_regs->rq_regs_c.chunk_size, rq_regs->rq_regs_c.min_chunk_size,\n\t\t\t\trq_regs->rq_regs_c.meta_chunk_size, rq_regs->rq_regs_c.min_meta_chunk_size,\n\t\t\t\trq_regs->rq_regs_c.dpte_group_size, rq_regs->rq_regs_c.mpte_group_size,\n\t\t\t\trq_regs->rq_regs_c.swath_height, rq_regs->rq_regs_c.pte_row_height_linear);\n\n\t\t\tremaining_buffer -= chars_printed;\n\t\t\tpBuf += chars_printed;\n\t\t}\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_dlg_states(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,rc_hbe,dlg_vbe,min_d_y_n,rc_per_ht,rc_x_a_s,\"\n\t\t\"dst_y_a_s,dst_y_pf,dst_y_vvb,dst_y_rvb,dst_y_vfl,dst_y_rfl,rf_pix_fq,\"\n\t\t\"vratio_pf,vrat_pf_c,rc_pg_vbl,rc_pg_vbc,rc_mc_vbl,rc_mc_vbc,rc_pg_fll,\"\n\t\t\"rc_pg_flc,rc_mc_fll,rc_mc_flc,pr_nom_l,pr_nom_c,rc_pg_nl,rc_pg_nc,\"\n\t\t\"mr_nom_l,mr_nom_c,rc_mc_nl,rc_mc_nc,rc_ld_pl,rc_ld_pc,rc_ld_l,\"\n\t\t\"rc_ld_c,cha_cur0,ofst_cur1,cha_cur1,vr_af_vc0,ddrq_limt,x_rt_dlay,x_rp_dlay,x_rr_sfl\"\n\t\t\"\\n\");\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < pool->pipe_count; i++) {\n\t\tstruct dcn_hubp_state *s = &(TO_DCN10_HUBP(pool->hubps[i])->state);\n\t\tstruct _vcs_dpi_display_dlg_regs_st *dlg_regs = &s->dlg_attr;\n\n\t\tif (!s->blank_en) {\n\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,%x,%x,%x\"\n\t\t\t\t\"\\n\",\n\t\t\t\tpool->hubps[i]->inst, dlg_regs->refcyc_h_blank_end, dlg_regs->dlg_vblank_end, dlg_regs->min_dst_y_next_start,\n\t\t\t\tdlg_regs->refcyc_per_htotal, dlg_regs->refcyc_x_after_scaler, dlg_regs->dst_y_after_scaler,\n\t\t\t\tdlg_regs->dst_y_prefetch, dlg_regs->dst_y_per_vm_vblank, dlg_regs->dst_y_per_row_vblank,\n\t\t\t\tdlg_regs->dst_y_per_vm_flip, dlg_regs->dst_y_per_row_flip, dlg_regs->ref_freq_to_pix_freq,\n\t\t\t\tdlg_regs->vratio_prefetch, dlg_regs->vratio_prefetch_c, dlg_regs->refcyc_per_pte_group_vblank_l,\n\t\t\t\tdlg_regs->refcyc_per_pte_group_vblank_c, dlg_regs->refcyc_per_meta_chunk_vblank_l,\n\t\t\t\tdlg_regs->refcyc_per_meta_chunk_vblank_c, dlg_regs->refcyc_per_pte_group_flip_l,\n\t\t\t\tdlg_regs->refcyc_per_pte_group_flip_c, dlg_regs->refcyc_per_meta_chunk_flip_l,\n\t\t\t\tdlg_regs->refcyc_per_meta_chunk_flip_c, dlg_regs->dst_y_per_pte_row_nom_l,\n\t\t\t\tdlg_regs->dst_y_per_pte_row_nom_c, dlg_regs->refcyc_per_pte_group_nom_l,\n\t\t\t\tdlg_regs->refcyc_per_pte_group_nom_c, dlg_regs->dst_y_per_meta_row_nom_l,\n\t\t\t\tdlg_regs->dst_y_per_meta_row_nom_c, dlg_regs->refcyc_per_meta_chunk_nom_l,\n\t\t\t\tdlg_regs->refcyc_per_meta_chunk_nom_c, dlg_regs->refcyc_per_line_delivery_pre_l,\n\t\t\t\tdlg_regs->refcyc_per_line_delivery_pre_c, dlg_regs->refcyc_per_line_delivery_l,\n\t\t\t\tdlg_regs->refcyc_per_line_delivery_c, dlg_regs->chunk_hdl_adjust_cur0, dlg_regs->dst_y_offset_cur1,\n\t\t\t\tdlg_regs->chunk_hdl_adjust_cur1, dlg_regs->vready_after_vcount0, dlg_regs->dst_y_delta_drq_limit,\n\t\t\t\tdlg_regs->xfc_reg_transfer_delay, dlg_regs->xfc_reg_precharge_delay,\n\t\t\t\tdlg_regs->xfc_reg_remote_surface_flip_latency);\n\n\t\t\tremaining_buffer -= chars_printed;\n\t\t\tpBuf += chars_printed;\n\t\t}\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_ttu_states(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,qos_ll_wm,qos_lh_wm,mn_ttu_vb,qos_l_flp,rc_rd_p_l,rc_rd_l,rc_rd_p_c,\"\n\t\t\"rc_rd_c,rc_rd_c0,rc_rd_pc0,rc_rd_c1,rc_rd_pc1,qos_lf_l,qos_rds_l,\"\n\t\t\"qos_lf_c,qos_rds_c,qos_lf_c0,qos_rds_c0,qos_lf_c1,qos_rds_c1\"\n\t\t\"\\n\");\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < pool->pipe_count; i++) {\n\t\tstruct dcn_hubp_state *s = &(TO_DCN10_HUBP(pool->hubps[i])->state);\n\t\tstruct _vcs_dpi_display_ttu_regs_st *ttu_regs = &s->ttu_attr;\n\n\t\tif (!s->blank_en) {\n\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x,%x,\"\n\t\t\t\t\"%x,%x,%x,%x,%x,%x\"\n\t\t\t\t\"\\n\",\n\t\t\t\tpool->hubps[i]->inst, ttu_regs->qos_level_low_wm, ttu_regs->qos_level_high_wm, ttu_regs->min_ttu_vblank,\n\t\t\t\tttu_regs->qos_level_flip, ttu_regs->refcyc_per_req_delivery_pre_l, ttu_regs->refcyc_per_req_delivery_l,\n\t\t\t\tttu_regs->refcyc_per_req_delivery_pre_c, ttu_regs->refcyc_per_req_delivery_c, ttu_regs->refcyc_per_req_delivery_cur0,\n\t\t\t\tttu_regs->refcyc_per_req_delivery_pre_cur0, ttu_regs->refcyc_per_req_delivery_cur1,\n\t\t\t\tttu_regs->refcyc_per_req_delivery_pre_cur1, ttu_regs->qos_level_fixed_l, ttu_regs->qos_ramp_disable_l,\n\t\t\t\tttu_regs->qos_level_fixed_c, ttu_regs->qos_ramp_disable_c, ttu_regs->qos_level_fixed_cur0,\n\t\t\t\tttu_regs->qos_ramp_disable_cur0, ttu_regs->qos_level_fixed_cur1, ttu_regs->qos_ramp_disable_cur1);\n\n\t\t\tremaining_buffer -= chars_printed;\n\t\t\tpBuf += chars_printed;\n\t\t}\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_cm_states(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,igam_format,igam_mode,dgam_mode,rgam_mode,gamut_mode,\"\n\t\t\"c11_c12,c13_c14,c21_c22,c23_c24,c31_c32,c33_c34\"\n\t\t\"\\n\");\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < pool->pipe_count; i++) {\n\t\tstruct dpp *dpp = pool->dpps[i];\n\t\tstruct dcn_dpp_state s = {0};\n\n\t\tdpp->funcs->dpp_read_state(dpp, &s);\n\n\t\tif (s.is_enabled) {\n\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%x,\"\n\t\t\t\t\t\"%s,%s,%s,\"\n\t\t\t\t\t\"%x,%08x,%08x,%08x,%08x,%08x,%08x\"\n\t\t\t\t\"\\n\",\n\t\t\t\tdpp->inst, s.igam_input_format,\n\t\t\t\t(s.igam_lut_mode == 0) ? \"BypassFixed\" :\n\t\t\t\t\t((s.igam_lut_mode == 1) ? \"BypassFloat\" :\n\t\t\t\t\t((s.igam_lut_mode == 2) ? \"RAM\" :\n\t\t\t\t\t((s.igam_lut_mode == 3) ? \"RAM\" :\n\t\t\t\t\t\t\t\t \"Unknown\"))),\n\t\t\t\t(s.dgam_lut_mode == 0) ? \"Bypass\" :\n\t\t\t\t\t((s.dgam_lut_mode == 1) ? \"sRGB\" :\n\t\t\t\t\t((s.dgam_lut_mode == 2) ? \"Ycc\" :\n\t\t\t\t\t((s.dgam_lut_mode == 3) ? \"RAM\" :\n\t\t\t\t\t((s.dgam_lut_mode == 4) ? \"RAM\" :\n\t\t\t\t\t\t\t\t \"Unknown\")))),\n\t\t\t\t(s.rgam_lut_mode == 0) ? \"Bypass\" :\n\t\t\t\t\t((s.rgam_lut_mode == 1) ? \"sRGB\" :\n\t\t\t\t\t((s.rgam_lut_mode == 2) ? \"Ycc\" :\n\t\t\t\t\t((s.rgam_lut_mode == 3) ? \"RAM\" :\n\t\t\t\t\t((s.rgam_lut_mode == 4) ? \"RAM\" :\n\t\t\t\t\t\t\t\t \"Unknown\")))),\n\t\t\t\ts.gamut_remap_mode, s.gamut_remap_c11_c12,\n\t\t\t\ts.gamut_remap_c13_c14, s.gamut_remap_c21_c22, s.gamut_remap_c23_c24,\n\t\t\t\ts.gamut_remap_c31_c32, s.gamut_remap_c33_c34);\n\n\t\t\tremaining_buffer -= chars_printed;\n\t\t\tpBuf += chars_printed;\n\t\t}\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_mpcc_states(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,opp,dpp,mpccbot,mode,alpha_mode,premult,overlap_only,idle\\n\");\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < pool->pipe_count; i++) {\n\t\tstruct mpcc_state s = {0};\n\n\t\tpool->mpc->funcs->read_mpcc_state(pool->mpc, i, &s);\n\n\t\tif (s.opp_id != 0xf) {\n\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%x,%x,%x,%x,%x,%x,%x,%x\\n\",\n\t\t\t\ti, s.opp_id, s.dpp_id, s.bot_mpcc_id,\n\t\t\t\ts.mode, s.alpha_mode, s.pre_multiplied_alpha, s.overlap_only,\n\t\t\t\ts.idle);\n\n\t\t\tremaining_buffer -= chars_printed;\n\t\t\tpBuf += chars_printed;\n\t\t}\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_otg_states(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"instance,v_bs,v_be,v_ss,v_se,vpol,vmax,vmin,vmax_sel,vmin_sel,\"\n\t\t\t\"h_bs,h_be,h_ss,h_se,hpol,htot,vtot,underflow,pixelclk[khz]\\n\");\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\tfor (i = 0; i < pool->timing_generator_count; i++) {\n\t\tstruct timing_generator *tg = pool->timing_generators[i];\n\t\tstruct dcn_otg_state s = {0};\n\t\tint pix_clk = 0;\n\n\t\toptc1_read_otg_state(DCN10TG_FROM_TG(tg), &s);\n\t\tpix_clk = dc->current_state->res_ctx.pipe_ctx[i].stream_res.pix_clk_params.requested_pix_clk_100hz / 10;\n\n\t\t\n\t\tif (s.otg_enabled & 1) {\n\t\t\tchars_printed = snprintf_count(pBuf, remaining_buffer, \"%x,%d,%d,%d,%d,%d,%d,%d,%d,%d,\"\n\t\t\t\t\"%d,%d,%d,%d,%d,%d,%d,%d,%d\"\n\t\t\t\t\"\\n\",\n\t\t\t\ttg->inst,\n\t\t\t\ts.v_blank_start,\n\t\t\t\ts.v_blank_end,\n\t\t\t\ts.v_sync_a_start,\n\t\t\t\ts.v_sync_a_end,\n\t\t\t\ts.v_sync_a_pol,\n\t\t\t\ts.v_total_max,\n\t\t\t\ts.v_total_min,\n\t\t\t\ts.v_total_max_sel,\n\t\t\t\ts.v_total_min_sel,\n\t\t\t\ts.h_blank_start,\n\t\t\t\ts.h_blank_end,\n\t\t\t\ts.h_sync_a_start,\n\t\t\t\ts.h_sync_a_end,\n\t\t\t\ts.h_sync_a_pol,\n\t\t\t\ts.h_total,\n\t\t\t\ts.v_total,\n\t\t\t\ts.underflow_occurred_status,\n\t\t\t\tpix_clk);\n\n\t\t\tremaining_buffer -= chars_printed;\n\t\t\tpBuf += chars_printed;\n\t\t}\n\t}\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic unsigned int dcn10_get_clock_states(struct dc *dc, char *pBuf, unsigned int bufSize)\n{\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buffer = bufSize;\n\n\tchars_printed = snprintf_count(pBuf, bufSize, \"dcfclk,dcfclk_deep_sleep,dispclk,\"\n\t\t\"dppclk,fclk,socclk\\n\"\n\t\t\"%d,%d,%d,%d,%d,%d\\n\",\n\t\tdc->current_state->bw_ctx.bw.dcn.clk.dcfclk_khz,\n\t\tdc->current_state->bw_ctx.bw.dcn.clk.dcfclk_deep_sleep_khz,\n\t\tdc->current_state->bw_ctx.bw.dcn.clk.dispclk_khz,\n\t\tdc->current_state->bw_ctx.bw.dcn.clk.dppclk_khz,\n\t\tdc->current_state->bw_ctx.bw.dcn.clk.fclk_khz,\n\t\tdc->current_state->bw_ctx.bw.dcn.clk.socclk_khz);\n\n\tremaining_buffer -= chars_printed;\n\tpBuf += chars_printed;\n\n\treturn bufSize - remaining_buffer;\n}\n\nstatic void dcn10_clear_otpc_underflow(struct dc *dc)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tfor (i = 0; i < pool->timing_generator_count; i++) {\n\t\tstruct timing_generator *tg = pool->timing_generators[i];\n\t\tstruct dcn_otg_state s = {0};\n\n\t\toptc1_read_otg_state(DCN10TG_FROM_TG(tg), &s);\n\n\t\tif (s.otg_enabled & 1)\n\t\t\ttg->funcs->clear_optc_underflow(tg);\n\t}\n}\n\nstatic void dcn10_clear_hubp_underflow(struct dc *dc)\n{\n\tstruct resource_pool *pool = dc->res_pool;\n\tint i;\n\n\tfor (i = 0; i < pool->pipe_count; i++) {\n\t\tstruct hubp *hubp = pool->hubps[i];\n\t\tstruct dcn_hubp_state *s = &(TO_DCN10_HUBP(hubp)->state);\n\n\t\thubp->funcs->hubp_read_state(hubp);\n\n\t\tif (!s->blank_en)\n\t\t\thubp->funcs->hubp_clear_underflow(hubp);\n\t}\n}\n\nvoid dcn10_clear_status_bits(struct dc *dc, unsigned int mask)\n{\n\t \n\tconst unsigned int DC_HW_STATE_MASK_HUBP_UNDERFLOW\t= 0x1;\n\tconst unsigned int DC_HW_STATE_MASK_OTPC_UNDERFLOW\t= 0x2;\n\n\tif (mask == 0x0)\n\t\tmask = 0xFFFFFFFF;\n\n\tif (mask & DC_HW_STATE_MASK_HUBP_UNDERFLOW)\n\t\tdcn10_clear_hubp_underflow(dc);\n\n\tif (mask & DC_HW_STATE_MASK_OTPC_UNDERFLOW)\n\t\tdcn10_clear_otpc_underflow(dc);\n}\n\nvoid dcn10_get_hw_state(struct dc *dc, char *pBuf, unsigned int bufSize, unsigned int mask)\n{\n\t \n\tconst unsigned int DC_HW_STATE_MASK_HUBBUB\t\t\t= 0x1;\n\tconst unsigned int DC_HW_STATE_MASK_HUBP\t\t\t= 0x2;\n\tconst unsigned int DC_HW_STATE_MASK_RQ\t\t\t\t= 0x4;\n\tconst unsigned int DC_HW_STATE_MASK_DLG\t\t\t\t= 0x8;\n\tconst unsigned int DC_HW_STATE_MASK_TTU\t\t\t\t= 0x10;\n\tconst unsigned int DC_HW_STATE_MASK_CM\t\t\t\t= 0x20;\n\tconst unsigned int DC_HW_STATE_MASK_MPCC\t\t\t= 0x40;\n\tconst unsigned int DC_HW_STATE_MASK_OTG\t\t\t\t= 0x80;\n\tconst unsigned int DC_HW_STATE_MASK_CLOCKS\t\t\t= 0x100;\n\tconst unsigned int DC_HW_STATE_INVAR_ONLY\t\t\t= 0x8000;\n\n\tunsigned int chars_printed = 0;\n\tunsigned int remaining_buf_size = bufSize;\n\n\tif (mask == 0x0)\n\t\tmask = 0xFFFF; \n\n\tif ((mask & DC_HW_STATE_MASK_HUBBUB) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_hubbub_state(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_HUBP) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_hubp_states(dc, pBuf, remaining_buf_size, mask & DC_HW_STATE_INVAR_ONLY);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_RQ) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_rq_states(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_DLG) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_dlg_states(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_TTU) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_ttu_states(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_CM) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_cm_states(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_MPCC) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_mpcc_states(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_OTG) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_otg_states(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n\n\tif ((mask & DC_HW_STATE_MASK_CLOCKS) && remaining_buf_size > 0) {\n\t\tchars_printed = dcn10_get_clock_states(dc, pBuf, remaining_buf_size);\n\t\tpBuf += chars_printed;\n\t\tremaining_buf_size -= chars_printed;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}