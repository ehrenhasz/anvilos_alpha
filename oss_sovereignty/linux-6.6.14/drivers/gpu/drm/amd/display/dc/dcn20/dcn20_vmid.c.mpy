{
  "module_name": "dcn20_vmid.c",
  "hash_id": "6ef3c57f3af0c1b94f3e2c4b83ddb66d6279b01509a5f32b294d91b5601f79b7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn20/dcn20_vmid.c",
  "human_readable_source": " \n\n#include <linux/delay.h>\n\n#include \"dcn20_vmid.h\"\n#include \"reg_helper.h\"\n\n#define REG(reg)\\\n\tvmid->regs->reg\n\n#define CTX \\\n\tvmid->ctx\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\tvmid->shifts->field_name, vmid->masks->field_name\n\nstatic void dcn20_wait_for_vmid_ready(struct dcn20_vmid *vmid)\n{\n\t \n\n\tint max_times = 10000;\n\tint delay_us  = 5;\n\tint i;\n\n\tfor (i = 0; i < max_times; ++i) {\n\t\tuint32_t entry_lo32;\n\n\t\tREG_GET(PAGE_TABLE_BASE_ADDR_LO32,\n\t\t\tVM_CONTEXT0_PAGE_DIRECTORY_ENTRY_LO32,\n\t\t\t&entry_lo32);\n\n\t\tif (entry_lo32 & 0x1)\n\t\t\treturn;\n\n\t\tudelay(delay_us);\n\t}\n\n\t \n\tDC_LOG_WARNING(\"Timeout while waiting for GPUVM context update\\n\");\n\tASSERT(0);\n}\n\nvoid dcn20_vmid_setup(struct dcn20_vmid *vmid, const struct dcn_vmid_page_table_config *config)\n{\n\tREG_SET(PAGE_TABLE_START_ADDR_HI32, 0,\n\t\t\tVM_CONTEXT0_START_LOGICAL_PAGE_NUMBER_HI4, (config->page_table_start_addr >> 32) & 0xF);\n\tREG_SET(PAGE_TABLE_START_ADDR_LO32, 0,\n\t\t\tVM_CONTEXT0_START_LOGICAL_PAGE_NUMBER_LO32, config->page_table_start_addr & 0xFFFFFFFF);\n\n\tREG_SET(PAGE_TABLE_END_ADDR_HI32, 0,\n\t\t\tVM_CONTEXT0_END_LOGICAL_PAGE_NUMBER_HI4, (config->page_table_end_addr >> 32) & 0xF);\n\tREG_SET(PAGE_TABLE_END_ADDR_LO32, 0,\n\t\t\tVM_CONTEXT0_END_LOGICAL_PAGE_NUMBER_LO32, config->page_table_end_addr & 0xFFFFFFFF);\n\n\tREG_SET_2(CNTL, 0,\n\t\t\tVM_CONTEXT0_PAGE_TABLE_DEPTH, config->depth,\n\t\t\tVM_CONTEXT0_PAGE_TABLE_BLOCK_SIZE, config->block_size);\n\n\tREG_SET(PAGE_TABLE_BASE_ADDR_HI32, 0,\n\t\t\tVM_CONTEXT0_PAGE_DIRECTORY_ENTRY_HI32, (config->page_table_base_addr >> 32) & 0xFFFFFFFF);\n\t \n\tREG_SET(PAGE_TABLE_BASE_ADDR_LO32, 0,\n\t\t\tVM_CONTEXT0_PAGE_DIRECTORY_ENTRY_LO32, config->page_table_base_addr & 0xFFFFFFFF);\n\n\tdcn20_wait_for_vmid_ready(vmid);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}