{
  "module_name": "dcn201_optc.c",
  "hash_id": "85fa333d1604a4b4b418983faa507778a1ba192911bf3788fd5e32ab5916ddf2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn201/dcn201_optc.c",
  "human_readable_source": " \n\n#include \"reg_helper.h\"\n#include \"dcn201_optc.h\"\n#include \"dcn10/dcn10_optc.h\"\n#include \"dc.h\"\n\n#define REG(reg)\\\n\toptc1->tg_regs->reg\n\n#define CTX \\\n\toptc1->base.ctx\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\toptc1->tg_shift->field_name, optc1->tg_mask->field_name\n\n \nbool optc201_is_two_pixels_per_containter(const struct dc_crtc_timing *timing)\n{\n\treturn optc1_is_two_pixels_per_containter(timing);\n}\n\nstatic void optc201_triplebuffer_lock(struct timing_generator *optc)\n{\n\tstruct optc *optc1 = DCN10TG_FROM_TG(optc);\n\n\tREG_SET(OTG_GLOBAL_CONTROL0, 0,\n\t\tOTG_MASTER_UPDATE_LOCK_SEL, optc->inst);\n\tREG_SET(OTG_VUPDATE_KEEPOUT, 0,\n\t\tOTG_MASTER_UPDATE_LOCK_VUPDATE_KEEPOUT_EN, 1);\n\tREG_SET(OTG_MASTER_UPDATE_LOCK, 0,\n\t\tOTG_MASTER_UPDATE_LOCK, 1);\n\n\tREG_WAIT(OTG_MASTER_UPDATE_LOCK,\n\t\t\tUPDATE_LOCK_STATUS, 1,\n\t\t\t1, 10);\n}\n\nstatic void optc201_triplebuffer_unlock(struct timing_generator *optc)\n{\n\tstruct optc *optc1 = DCN10TG_FROM_TG(optc);\n\n\tREG_SET(OTG_MASTER_UPDATE_LOCK, 0,\n\t\tOTG_MASTER_UPDATE_LOCK, 0);\n\tREG_SET(OTG_VUPDATE_KEEPOUT, 0,\n\t\tOTG_MASTER_UPDATE_LOCK_VUPDATE_KEEPOUT_EN, 0);\n\n}\n\nstatic bool optc201_validate_timing(\n\tstruct timing_generator *optc,\n\tconst struct dc_crtc_timing *timing)\n{\n\tuint32_t v_blank;\n\tuint32_t h_blank;\n\tuint32_t min_v_blank;\n\tstruct optc *optc1 = DCN10TG_FROM_TG(optc);\n\n\tASSERT(timing != NULL);\n\n\tv_blank = (timing->v_total - timing->v_addressable -\n\t\t\t\t\ttiming->v_border_top - timing->v_border_bottom);\n\n\th_blank = (timing->h_total - timing->h_addressable -\n\t\ttiming->h_border_right -\n\t\ttiming->h_border_left);\n\n\tif (timing->timing_3d_format != TIMING_3D_FORMAT_NONE &&\n\t\ttiming->timing_3d_format != TIMING_3D_FORMAT_HW_FRAME_PACKING &&\n\t\ttiming->timing_3d_format != TIMING_3D_FORMAT_TOP_AND_BOTTOM &&\n\t\ttiming->timing_3d_format != TIMING_3D_FORMAT_SIDE_BY_SIDE &&\n\t\ttiming->timing_3d_format != TIMING_3D_FORMAT_FRAME_ALTERNATE &&\n\t\ttiming->timing_3d_format != TIMING_3D_FORMAT_INBAND_FA)\n\t\treturn false;\n\n\t \n\tif (timing->h_total > optc1->max_h_total ||\n\t\ttiming->v_total > optc1->max_v_total)\n\t\treturn false;\n\n\tif (h_blank < optc1->min_h_blank)\n\t\treturn false;\n\n\tif (timing->h_sync_width  < optc1->min_h_sync_width ||\n\t\t timing->v_sync_width  < optc1->min_v_sync_width)\n\t\treturn false;\n\n\tmin_v_blank = timing->flags.INTERLACE?optc1->min_v_blank_interlace:optc1->min_v_blank;\n\n\tif (v_blank < min_v_blank)\n\t\treturn false;\n\n\treturn true;\n\n}\n\nstatic void optc201_get_optc_source(struct timing_generator *optc,\n\t\tuint32_t *num_of_src_opp,\n\t\tuint32_t *src_opp_id_0,\n\t\tuint32_t *src_opp_id_1)\n{\n\tstruct optc *optc1 = DCN10TG_FROM_TG(optc);\n\n\tREG_GET(OPTC_DATA_SOURCE_SELECT,\n\t\t\tOPTC_SEG0_SRC_SEL, src_opp_id_0);\n\n\t*num_of_src_opp = 1;\n}\n\nstatic struct timing_generator_funcs dcn201_tg_funcs = {\n\t\t.validate_timing = optc201_validate_timing,\n\t\t.program_timing = optc1_program_timing,\n\t\t.setup_vertical_interrupt0 = optc1_setup_vertical_interrupt0,\n\t\t.setup_vertical_interrupt1 = optc1_setup_vertical_interrupt1,\n\t\t.setup_vertical_interrupt2 = optc1_setup_vertical_interrupt2,\n\t\t.program_global_sync = optc1_program_global_sync,\n\t\t.enable_crtc = optc2_enable_crtc,\n\t\t.disable_crtc = optc1_disable_crtc,\n\t\t \n\t\t.is_counter_moving = optc1_is_counter_moving,\n\t\t.get_position = optc1_get_position,\n\t\t.get_frame_count = optc1_get_vblank_counter,\n\t\t.get_scanoutpos = optc1_get_crtc_scanoutpos,\n\t\t.get_otg_active_size = optc1_get_otg_active_size,\n\t\t.set_early_control = optc1_set_early_control,\n\t\t \n\t\t.wait_for_state = optc1_wait_for_state,\n\t\t.set_blank = optc1_set_blank,\n\t\t.is_blanked = optc1_is_blanked,\n\t\t.set_blank_color = optc1_program_blank_color,\n\t\t.did_triggered_reset_occur = optc1_did_triggered_reset_occur,\n\t\t.enable_reset_trigger = optc1_enable_reset_trigger,\n\t\t.enable_crtc_reset = optc1_enable_crtc_reset,\n\t\t.disable_reset_trigger = optc1_disable_reset_trigger,\n\t\t.triplebuffer_lock = optc201_triplebuffer_lock,\n\t\t.triplebuffer_unlock = optc201_triplebuffer_unlock,\n\t\t.lock = optc1_lock,\n\t\t.unlock = optc1_unlock,\n\t\t.enable_optc_clock = optc1_enable_optc_clock,\n\t\t.set_drr = optc1_set_drr,\n\t\t.get_last_used_drr_vtotal = NULL,\n\t\t.set_vtotal_min_max = optc1_set_vtotal_min_max,\n\t\t.set_static_screen_control = optc1_set_static_screen_control,\n\t\t.program_stereo = optc1_program_stereo,\n\t\t.is_stereo_left_eye = optc1_is_stereo_left_eye,\n\t\t.set_blank_data_double_buffer = optc1_set_blank_data_double_buffer,\n\t\t.tg_init = optc1_tg_init,\n\t\t.is_tg_enabled = optc1_is_tg_enabled,\n\t\t.is_optc_underflow_occurred = optc1_is_optc_underflow_occurred,\n\t\t.clear_optc_underflow = optc1_clear_optc_underflow,\n\t\t.get_crc = optc1_get_crc,\n\t\t.configure_crc = optc2_configure_crc,\n\t\t.set_dsc_config = optc2_set_dsc_config,\n\t\t.set_dwb_source = NULL,\n\t\t.get_optc_source = optc201_get_optc_source,\n\t\t.set_vtg_params = optc1_set_vtg_params,\n\t\t.program_manual_trigger = optc2_program_manual_trigger,\n\t\t.setup_manual_trigger = optc2_setup_manual_trigger,\n\t\t.get_hw_timing = optc1_get_hw_timing,\n};\n\nvoid dcn201_timing_generator_init(struct optc *optc1)\n{\n\toptc1->base.funcs = &dcn201_tg_funcs;\n\n\toptc1->max_h_total = optc1->tg_mask->OTG_H_TOTAL + 1;\n\toptc1->max_v_total = optc1->tg_mask->OTG_V_TOTAL + 1;\n\n\toptc1->min_h_blank = 32;\n\toptc1->min_v_blank = 3;\n\toptc1->min_v_blank_interlace = 5;\n\toptc1->min_h_sync_width = 8;\n\toptc1->min_v_sync_width = 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}