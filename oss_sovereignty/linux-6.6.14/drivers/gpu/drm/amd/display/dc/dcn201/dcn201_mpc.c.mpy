{
  "module_name": "dcn201_mpc.c",
  "hash_id": "cb24344fde154dbe24c974f5e9f2eb12b290533ee19ab368964c43cdb5e8f71b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn201/dcn201_mpc.c",
  "human_readable_source": " \n\n#include \"reg_helper.h\"\n#include \"dcn201_mpc.h\"\n\n#define REG(reg)\\\n\tmpc201->mpc_regs->reg\n\n#define CTX \\\n\tmpc201->base.ctx\n\n#define DC_LOGGER \\\n\tmpc201->base.ctx->logger\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\tmpc201->mpc_shift->field_name, mpc201->mpc_mask->field_name\n\nstatic void mpc201_set_out_rate_control(\n\tstruct mpc *mpc,\n\tint opp_id,\n\tbool enable,\n\tbool rate_2x_mode,\n\tstruct mpc_dwb_flow_control *flow_control)\n{\n\tstruct dcn201_mpc *mpc201 = TO_DCN201_MPC(mpc);\n\n\tREG_UPDATE_2(MUX[opp_id],\n\t\t\tMPC_OUT_RATE_CONTROL_DISABLE, !enable,\n\t\t\tMPC_OUT_RATE_CONTROL, rate_2x_mode);\n\n\tif (flow_control)\n\t\tREG_UPDATE_3(MUX[opp_id],\n\t\t\tMPC_OUT_FLOW_CONTROL_MODE, flow_control->flow_ctrl_mode,\n\t\t\tMPC_OUT_FLOW_CONTROL_COUNT0, flow_control->flow_ctrl_cnt0,\n\t\t\tMPC_OUT_FLOW_CONTROL_COUNT1, flow_control->flow_ctrl_cnt1);\n}\n\nstatic void mpc201_init_mpcc(struct mpcc *mpcc, int mpcc_inst)\n{\n\tmpcc->mpcc_id = mpcc_inst;\n\tmpcc->dpp_id = 0xf;\n\tmpcc->mpcc_bot = NULL;\n\tmpcc->blnd_cfg.overlap_only = false;\n\tmpcc->blnd_cfg.global_alpha = 0xff;\n\tmpcc->blnd_cfg.global_gain = 0xff;\n\tmpcc->blnd_cfg.background_color_bpc = 4;\n\tmpcc->blnd_cfg.bottom_gain_mode = 0;\n\tmpcc->blnd_cfg.top_gain = 0x1f000;\n\tmpcc->blnd_cfg.bottom_inside_gain = 0x1f000;\n\tmpcc->blnd_cfg.bottom_outside_gain = 0x1f000;\n\tmpcc->sm_cfg.enable = false;\n\tmpcc->shared_bottom = false;\n}\n\nstatic const struct mpc_funcs dcn201_mpc_funcs = {\n\t.read_mpcc_state = mpc1_read_mpcc_state,\n\t.insert_plane = mpc1_insert_plane,\n\t.remove_mpcc = mpc1_remove_mpcc,\n\t.mpc_init = mpc1_mpc_init,\n\t.mpc_init_single_inst = mpc1_mpc_init_single_inst,\n\t.update_blending = mpc2_update_blending,\n\t.cursor_lock = mpc1_cursor_lock,\n\t.get_mpcc_for_dpp = mpc1_get_mpcc_for_dpp,\n\t.get_mpcc_for_dpp_from_secondary = NULL,\n\t.wait_for_idle = mpc2_assert_idle_mpcc,\n\t.assert_mpcc_idle_before_connect = mpc2_assert_mpcc_idle_before_connect,\n\t.init_mpcc_list_from_hw = mpc1_init_mpcc_list_from_hw,\n\t.set_denorm = mpc2_set_denorm,\n\t.set_denorm_clamp = mpc2_set_denorm_clamp,\n\t.set_output_csc = mpc2_set_output_csc,\n\t.set_ocsc_default = mpc2_set_ocsc_default,\n\t.set_output_gamma = mpc2_set_output_gamma,\n\t.set_out_rate_control = mpc201_set_out_rate_control,\n\t.power_on_mpc_mem_pwr = mpc20_power_on_ogam_lut,\n\t.get_mpc_out_mux = mpc1_get_mpc_out_mux,\n\t.set_bg_color = mpc1_set_bg_color,\n};\n\nvoid dcn201_mpc_construct(struct dcn201_mpc *mpc201,\n\tstruct dc_context *ctx,\n\tconst struct dcn201_mpc_registers *mpc_regs,\n\tconst struct dcn201_mpc_shift *mpc_shift,\n\tconst struct dcn201_mpc_mask *mpc_mask,\n\tint num_mpcc)\n{\n\tint i;\n\n\tmpc201->base.ctx = ctx;\n\n\tmpc201->base.funcs = &dcn201_mpc_funcs;\n\n\tmpc201->mpc_regs = mpc_regs;\n\tmpc201->mpc_shift = mpc_shift;\n\tmpc201->mpc_mask = mpc_mask;\n\n\tmpc201->mpcc_in_use_mask = 0;\n\tmpc201->num_mpcc = num_mpcc;\n\n\tfor (i = 0; i < MAX_MPCC; i++)\n\t\tmpc201_init_mpcc(&mpc201->base.mpcc_array[i], i);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}