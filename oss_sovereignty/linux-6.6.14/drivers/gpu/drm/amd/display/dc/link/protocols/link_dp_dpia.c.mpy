{
  "module_name": "link_dp_dpia.c",
  "hash_id": "1f20e0636df16ea3373e935c8e7e7e1f91e86ff7e23233b3ef9790c3f9f801e9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c",
  "human_readable_source": "\n \n\n#include \"dc.h\"\n#include \"inc/core_status.h\"\n#include \"dpcd_defs.h\"\n\n#include \"link_dp_dpia.h\"\n#include \"link_hwss.h\"\n#include \"dm_helpers.h\"\n#include \"dmub/inc/dmub_cmd.h\"\n#include \"link_dpcd.h\"\n#include \"link_dp_training.h\"\n#include \"dc_dmub_srv.h\"\n\n#define DC_LOGGER \\\n\tlink->ctx->logger\n\n \n \n#define DP_TUNNELING_CAPABILITIES_SUPPORT 0xe000d\n#define DP_IN_ADAPTER_INFO                0xe000e\n#define DP_USB4_DRIVER_ID                 0xe000f\n#define DP_USB4_ROUTER_TOPOLOGY_ID        0xe001b\n\nenum dc_status dpcd_get_tunneling_device_data(struct dc_link *link)\n{\n\tenum dc_status status = DC_OK;\n\tuint8_t dpcd_dp_tun_data[3] = {0};\n\tuint8_t dpcd_topology_data[DPCD_USB4_TOPOLOGY_ID_LEN] = {0};\n\tuint8_t i = 0;\n\n\tstatus = core_link_read_dpcd(\n\t\t\tlink,\n\t\t\tDP_TUNNELING_CAPABILITIES_SUPPORT,\n\t\t\tdpcd_dp_tun_data,\n\t\t\tsizeof(dpcd_dp_tun_data));\n\n\tstatus = core_link_read_dpcd(\n\t\t\tlink,\n\t\t\tDP_USB4_ROUTER_TOPOLOGY_ID,\n\t\t\tdpcd_topology_data,\n\t\t\tsizeof(dpcd_topology_data));\n\n\tlink->dpcd_caps.usb4_dp_tun_info.dp_tun_cap.raw =\n\t\t\tdpcd_dp_tun_data[DP_TUNNELING_CAPABILITIES_SUPPORT - DP_TUNNELING_CAPABILITIES_SUPPORT];\n\tlink->dpcd_caps.usb4_dp_tun_info.dpia_info.raw =\n\t\t\tdpcd_dp_tun_data[DP_IN_ADAPTER_INFO - DP_TUNNELING_CAPABILITIES_SUPPORT];\n\tlink->dpcd_caps.usb4_dp_tun_info.usb4_driver_id =\n\t\t\tdpcd_dp_tun_data[DP_USB4_DRIVER_ID - DP_TUNNELING_CAPABILITIES_SUPPORT];\n\n\tfor (i = 0; i < DPCD_USB4_TOPOLOGY_ID_LEN; i++)\n\t\tlink->dpcd_caps.usb4_dp_tun_info.usb4_topology_id[i] = dpcd_topology_data[i];\n\n\treturn status;\n}\n\nbool dpia_query_hpd_status(struct dc_link *link)\n{\n\tunion dmub_rb_cmd cmd = {0};\n\tstruct dc_dmub_srv *dmub_srv = link->ctx->dmub_srv;\n\tbool is_hpd_high = false;\n\n\t \n\tcmd.query_hpd.header.type = DMUB_CMD__QUERY_HPD_STATE;\n\tcmd.query_hpd.data.instance = link->link_id.enum_id - ENUM_ID_1;\n\tcmd.query_hpd.data.ch_type = AUX_CHANNEL_DPIA;\n\n\t \n\tif (dm_execute_dmub_cmd(dmub_srv->ctx, &cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) && cmd.query_hpd.data.status == AUX_RET_SUCCESS)\n\t\tis_hpd_high = cmd.query_hpd.data.result;\n\n\tDC_LOG_DEBUG(\"%s: link(%d) dpia(%d) cmd_status(%d) result(%d)\\n\",\n\t\t__func__,\n\t\tlink->link_index,\n\t\tlink->link_id.enum_id - ENUM_ID_1,\n\t\tcmd.query_hpd.data.status,\n\t\tcmd.query_hpd.data.result);\n\n\treturn is_hpd_high;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}