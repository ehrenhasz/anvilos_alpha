{
  "module_name": "dcn_calcs.c",
  "hash_id": "672e457bed103bceba97098e7a66e4a3dda502026e7b6c3a6f534a744498f4ea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dml/calcs/dcn_calcs.c",
  "human_readable_source": " \n\n#include \"dm_services.h\"\n#include \"dc.h\"\n#include \"dcn_calcs.h\"\n#include \"dcn_calc_auto.h\"\n#include \"dal_asic_id.h\"\n#include \"resource.h\"\n#include \"dcn10/dcn10_resource.h\"\n#include \"dcn10/dcn10_hubbub.h\"\n#include \"dml/dml1_display_rq_dlg_calc.h\"\n\n#include \"dcn_calc_math.h\"\n\n#define DC_LOGGER \\\n\tdc->ctx->logger\n\n#define WM_SET_COUNT 4\n#define WM_A 0\n#define WM_B 1\n#define WM_C 2\n#define WM_D 3\n\n \n\n \nconst struct dcn_soc_bounding_box dcn10_soc_defaults = {\n\t\t \n\t\t.sr_exit_time = 17,  \n\t\t.sr_enter_plus_exit_time = 19,  \n\t\t.urgent_latency = 4,  \n\t\t.dram_clock_change_latency = 17,  \n\t\t.write_back_latency = 12,  \n\t\t.percent_of_ideal_drambw_received_after_urg_latency = 80,  \n\n\t\t \n\t\t \n\t\t.dcfclkv_max0p9 = 655,\t \n\t\t.dcfclkv_nom0p8 = 626,\t \n\t\t.dcfclkv_mid0p72 = 600,\t \n\t\t.dcfclkv_min0p65 = 300,\t \n\n\t\t \n\t\t.max_dispclk_vmax0p9 = 1108,\t \n\t\t.max_dispclk_vnom0p8 = 1029,\t \n\t\t.max_dispclk_vmid0p72 = 960,\t \n\t\t.max_dispclk_vmin0p65 = 626,\t \n\n\t\t \n\t\t.max_dppclk_vmax0p9 = 720,\t \n\t\t.max_dppclk_vnom0p8 = 686,\t \n\t\t.max_dppclk_vmid0p72 = 626,\t \n\t\t.max_dppclk_vmin0p65 = 400,\t \n\n\t\t \n\t\t.phyclkv_max0p9 = 900,  \n\t\t.phyclkv_nom0p8 = 847,  \n\t\t.phyclkv_mid0p72 = 800,  \n\t\t.phyclkv_min0p65 = 600,  \n\n\t\t \n\t\t \n\t\t.fabric_and_dram_bandwidth_vmax0p9 = 38.4f,  \n\t\t.fabric_and_dram_bandwidth_vnom0p8 = 34.133f,  \n\t\t.fabric_and_dram_bandwidth_vmid0p72 = 29.866f,  \n\t\t.fabric_and_dram_bandwidth_vmin0p65 = 12.8f,  \n\t\t \n\n\t\t.number_of_channels = 2,\n\n\t\t.socclk = 208,  \n\t\t.downspreading = 0.5f,  \n\t\t.round_trip_ping_latency_cycles = 128,  \n\t\t.urgent_out_of_order_return_per_channel = 256,  \n\t\t.vmm_page_size = 4096,  \n\t\t.return_bus_width = 64,  \n\t\t.max_request_size = 256,  \n\n\t\t \n\t\t.percent_disp_bw_limit = 0.3f  \n};\n\nconst struct dcn_ip_params dcn10_ip_defaults = {\n\t\t.rob_buffer_size_in_kbyte = 64,\n\t\t.det_buffer_size_in_kbyte = 164,\n\t\t.dpp_output_buffer_pixels = 2560,\n\t\t.opp_output_buffer_lines = 1,\n\t\t.pixel_chunk_size_in_kbyte = 8,\n\t\t.pte_enable = dcn_bw_yes,\n\t\t.pte_chunk_size = 2,  \n\t\t.meta_chunk_size = 2,  \n\t\t.writeback_chunk_size = 2,  \n\t\t.odm_capability = dcn_bw_no,\n\t\t.dsc_capability = dcn_bw_no,\n\t\t.line_buffer_size = 589824,  \n\t\t.max_line_buffer_lines = 12,\n\t\t.is_line_buffer_bpp_fixed = dcn_bw_no,\n\t\t.line_buffer_fixed_bpp = dcn_bw_na,\n\t\t.writeback_luma_buffer_size = 12,  \n\t\t.writeback_chroma_buffer_size = 8,  \n\t\t.max_num_dpp = 4,\n\t\t.max_num_writeback = 2,\n\t\t.max_dchub_topscl_throughput = 4,  \n\t\t.max_pscl_tolb_throughput = 2,  \n\t\t.max_lb_tovscl_throughput = 4,  \n\t\t.max_vscl_tohscl_throughput = 4,  \n\t\t.max_hscl_ratio = 4,\n\t\t.max_vscl_ratio = 4,\n\t\t.max_hscl_taps = 8,\n\t\t.max_vscl_taps = 8,\n\t\t.pte_buffer_size_in_requests = 42,\n\t\t.dispclk_ramping_margin = 1,  \n\t\t.under_scan_factor = 1.11f,\n\t\t.max_inter_dcn_tile_repeaters = 8,\n\t\t.can_vstartup_lines_exceed_vsync_plus_back_porch_lines_minus_one = dcn_bw_no,\n\t\t.bug_forcing_luma_and_chroma_request_to_same_size_fixed = dcn_bw_no,\n\t\t.dcfclk_cstate_latency = 10  \n};\n\nstatic enum dcn_bw_defs tl_sw_mode_to_bw_defs(enum swizzle_mode_values sw_mode)\n{\n\tswitch (sw_mode) {\n\tcase DC_SW_LINEAR:\n\t\treturn dcn_bw_sw_linear;\n\tcase DC_SW_4KB_S:\n\t\treturn dcn_bw_sw_4_kb_s;\n\tcase DC_SW_4KB_D:\n\t\treturn dcn_bw_sw_4_kb_d;\n\tcase DC_SW_64KB_S:\n\t\treturn dcn_bw_sw_64_kb_s;\n\tcase DC_SW_64KB_D:\n\t\treturn dcn_bw_sw_64_kb_d;\n\tcase DC_SW_VAR_S:\n\t\treturn dcn_bw_sw_var_s;\n\tcase DC_SW_VAR_D:\n\t\treturn dcn_bw_sw_var_d;\n\tcase DC_SW_64KB_S_T:\n\t\treturn dcn_bw_sw_64_kb_s_t;\n\tcase DC_SW_64KB_D_T:\n\t\treturn dcn_bw_sw_64_kb_d_t;\n\tcase DC_SW_4KB_S_X:\n\t\treturn dcn_bw_sw_4_kb_s_x;\n\tcase DC_SW_4KB_D_X:\n\t\treturn dcn_bw_sw_4_kb_d_x;\n\tcase DC_SW_64KB_S_X:\n\t\treturn dcn_bw_sw_64_kb_s_x;\n\tcase DC_SW_64KB_D_X:\n\t\treturn dcn_bw_sw_64_kb_d_x;\n\tcase DC_SW_VAR_S_X:\n\t\treturn dcn_bw_sw_var_s_x;\n\tcase DC_SW_VAR_D_X:\n\t\treturn dcn_bw_sw_var_d_x;\n\tcase DC_SW_256B_S:\n\tcase DC_SW_256_D:\n\tcase DC_SW_256_R:\n\tcase DC_SW_4KB_R:\n\tcase DC_SW_64KB_R:\n\tcase DC_SW_VAR_R:\n\tcase DC_SW_4KB_R_X:\n\tcase DC_SW_64KB_R_X:\n\tcase DC_SW_VAR_R_X:\n\tdefault:\n\t\tBREAK_TO_DEBUGGER();  \n\t\treturn dcn_bw_sw_4_kb_s;\n\t}\n}\n\nstatic int tl_lb_bpp_to_int(enum lb_pixel_depth depth)\n{\n\tswitch (depth) {\n\tcase LB_PIXEL_DEPTH_18BPP:\n\t\treturn 18;\n\tcase LB_PIXEL_DEPTH_24BPP:\n\t\treturn 24;\n\tcase LB_PIXEL_DEPTH_30BPP:\n\t\treturn 30;\n\tcase LB_PIXEL_DEPTH_36BPP:\n\t\treturn 36;\n\tdefault:\n\t\treturn 30;\n\t}\n}\n\nstatic enum dcn_bw_defs tl_pixel_format_to_bw_defs(enum surface_pixel_format format)\n{\n\tswitch (format) {\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ARGB1555:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_RGB565:\n\t\treturn dcn_bw_rgb_sub_16;\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ARGB8888:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ABGR8888:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ARGB2101010:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ABGR2101010_XR_BIAS:\n\t\treturn dcn_bw_rgb_sub_32;\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616F:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F:\n\t\treturn dcn_bw_rgb_sub_64;\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_YCbCr:\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_YCrCb:\n\t\treturn dcn_bw_yuv420_sub_8;\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCbCr:\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCrCb:\n\t\treturn dcn_bw_yuv420_sub_10;\n\tdefault:\n\t\treturn dcn_bw_rgb_sub_32;\n\t}\n}\n\nenum source_macro_tile_size swizzle_mode_to_macro_tile_size(enum swizzle_mode_values sw_mode)\n{\n\tswitch (sw_mode) {\n\t \n\tcase DC_SW_LINEAR:\n\t\treturn dm_4k_tile;\n\tcase DC_SW_4KB_S:\n\tcase DC_SW_4KB_S_X:\n\t\treturn dm_4k_tile;\n\tcase DC_SW_64KB_S:\n\tcase DC_SW_64KB_S_X:\n\tcase DC_SW_64KB_S_T:\n\t\treturn dm_64k_tile;\n\tcase DC_SW_VAR_S:\n\tcase DC_SW_VAR_S_X:\n\t\treturn dm_256k_tile;\n\n\t \n\tcase DC_SW_4KB_D:\n\tcase DC_SW_4KB_D_X:\n\t\treturn dm_4k_tile;\n\tcase DC_SW_64KB_D:\n\tcase DC_SW_64KB_D_X:\n\tcase DC_SW_64KB_D_T:\n\t\treturn dm_64k_tile;\n\tcase DC_SW_VAR_D:\n\tcase DC_SW_VAR_D_X:\n\t\treturn dm_256k_tile;\n\n\tcase DC_SW_4KB_R:\n\tcase DC_SW_4KB_R_X:\n\t\treturn dm_4k_tile;\n\tcase DC_SW_64KB_R:\n\tcase DC_SW_64KB_R_X:\n\t\treturn dm_64k_tile;\n\tcase DC_SW_VAR_R:\n\tcase DC_SW_VAR_R_X:\n\t\treturn dm_256k_tile;\n\n\t \n\tcase DC_SW_256B_S:\n\tdefault:\n\t\tASSERT(0);  \n\t\treturn 0;\n\t}\n}\n\nstatic void pipe_ctx_to_e2e_pipe_params (\n\t\tconst struct pipe_ctx *pipe,\n\t\tstruct _vcs_dpi_display_pipe_params_st *input)\n{\n\tinput->src.is_hsplit = false;\n\n\t \n\tif (pipe->plane_state->stereo_format == PLANE_STEREO_FORMAT_SIDE_BY_SIDE ||\n\t    pipe->plane_state->stereo_format == PLANE_STEREO_FORMAT_TOP_AND_BOTTOM) {\n\t\t \n\t\tinput->src.hsplit_grp = pipe->pipe_idx;\n\t} else if (pipe->top_pipe != NULL && pipe->top_pipe->plane_state == pipe->plane_state) {\n\t\tinput->src.is_hsplit = true;\n\t} else if (pipe->bottom_pipe != NULL && pipe->bottom_pipe->plane_state == pipe->plane_state) {\n\t\tinput->src.is_hsplit = true;\n\t}\n\n\tif (pipe->plane_res.dpp->ctx->dc->debug.optimized_watermark) {\n\t\t \n\t\tinput->src.dcc = pipe->plane_state->dcc.enable ? 1 : 0;\n\t} else {\n\t\t \n\t\tunsigned int bpe;\n\n\t\tinput->src.dcc = pipe->plane_res.dpp->ctx->dc->res_pool->hubbub->funcs->\n\t\t\tdcc_support_pixel_format(pipe->plane_state->format, &bpe) ? 1 : 0;\n\t}\n\tinput->src.dcc_rate            = 1;\n\tinput->src.meta_pitch          = pipe->plane_state->dcc.meta_pitch;\n\tinput->src.source_scan         = dm_horz;\n\tinput->src.sw_mode             = pipe->plane_state->tiling_info.gfx9.swizzle;\n\n\tinput->src.viewport_width      = pipe->plane_res.scl_data.viewport.width;\n\tinput->src.viewport_height     = pipe->plane_res.scl_data.viewport.height;\n\tinput->src.data_pitch          = pipe->plane_res.scl_data.viewport.width;\n\tinput->src.data_pitch_c        = pipe->plane_res.scl_data.viewport.width;\n\tinput->src.cur0_src_width      = 128;  \n\tinput->src.cur0_bpp            = 32;\n\n\tinput->src.macro_tile_size = swizzle_mode_to_macro_tile_size(pipe->plane_state->tiling_info.gfx9.swizzle);\n\n\tswitch (pipe->plane_state->rotation) {\n\tcase ROTATION_ANGLE_0:\n\tcase ROTATION_ANGLE_180:\n\t\tinput->src.source_scan = dm_horz;\n\t\tbreak;\n\tcase ROTATION_ANGLE_90:\n\tcase ROTATION_ANGLE_270:\n\t\tinput->src.source_scan = dm_vert;\n\t\tbreak;\n\tdefault:\n\t\tASSERT(0);  \n\t\tbreak;\n\t}\n\n\t \n\tswitch (pipe->plane_state->format) {\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_YCbCr:\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_YCrCb:\n\t\tinput->src.source_format = dm_420_8;\n\t\tinput->src.viewport_width_c    = input->src.viewport_width / 2;\n\t\tinput->src.viewport_height_c   = input->src.viewport_height / 2;\n\t\tbreak;\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCbCr:\n\tcase SURFACE_PIXEL_FORMAT_VIDEO_420_10bpc_YCrCb:\n\t\tinput->src.source_format = dm_420_10;\n\t\tinput->src.viewport_width_c    = input->src.viewport_width / 2;\n\t\tinput->src.viewport_height_c   = input->src.viewport_height / 2;\n\t\tbreak;\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ARGB16161616F:\n\tcase SURFACE_PIXEL_FORMAT_GRPH_ABGR16161616F:\n\t\tinput->src.source_format = dm_444_64;\n\t\tinput->src.viewport_width_c    = input->src.viewport_width;\n\t\tinput->src.viewport_height_c   = input->src.viewport_height;\n\t\tbreak;\n\tcase SURFACE_PIXEL_FORMAT_GRPH_RGBE_ALPHA:\n\t\tinput->src.source_format = dm_rgbe_alpha;\n\t\tinput->src.viewport_width_c    = input->src.viewport_width;\n\t\tinput->src.viewport_height_c   = input->src.viewport_height;\n\t\tbreak;\n\tdefault:\n\t\tinput->src.source_format = dm_444_32;\n\t\tinput->src.viewport_width_c    = input->src.viewport_width;\n\t\tinput->src.viewport_height_c   = input->src.viewport_height;\n\t\tbreak;\n\t}\n\n\tinput->scale_taps.htaps                = pipe->plane_res.scl_data.taps.h_taps;\n\tinput->scale_ratio_depth.hscl_ratio    = pipe->plane_res.scl_data.ratios.horz.value/4294967296.0;\n\tinput->scale_ratio_depth.vscl_ratio    = pipe->plane_res.scl_data.ratios.vert.value/4294967296.0;\n\tinput->scale_ratio_depth.vinit =  pipe->plane_res.scl_data.inits.v.value/4294967296.0;\n\tif (input->scale_ratio_depth.vinit < 1.0)\n\t\t\tinput->scale_ratio_depth.vinit = 1;\n\tinput->scale_taps.vtaps = pipe->plane_res.scl_data.taps.v_taps;\n\tinput->scale_taps.vtaps_c = pipe->plane_res.scl_data.taps.v_taps_c;\n\tinput->scale_taps.htaps_c              = pipe->plane_res.scl_data.taps.h_taps_c;\n\tinput->scale_ratio_depth.hscl_ratio_c  = pipe->plane_res.scl_data.ratios.horz_c.value/4294967296.0;\n\tinput->scale_ratio_depth.vscl_ratio_c  = pipe->plane_res.scl_data.ratios.vert_c.value/4294967296.0;\n\tinput->scale_ratio_depth.vinit_c       = pipe->plane_res.scl_data.inits.v_c.value/4294967296.0;\n\tif (input->scale_ratio_depth.vinit_c < 1.0)\n\t\t\tinput->scale_ratio_depth.vinit_c = 1;\n\tswitch (pipe->plane_res.scl_data.lb_params.depth) {\n\tcase LB_PIXEL_DEPTH_30BPP:\n\t\tinput->scale_ratio_depth.lb_depth = 30; break;\n\tcase LB_PIXEL_DEPTH_36BPP:\n\t\tinput->scale_ratio_depth.lb_depth = 36; break;\n\tdefault:\n\t\tinput->scale_ratio_depth.lb_depth = 24; break;\n\t}\n\n\n\tinput->dest.vactive        = pipe->stream->timing.v_addressable + pipe->stream->timing.v_border_top\n\t\t\t+ pipe->stream->timing.v_border_bottom;\n\n\tinput->dest.recout_width   = pipe->plane_res.scl_data.recout.width;\n\tinput->dest.recout_height  = pipe->plane_res.scl_data.recout.height;\n\n\tinput->dest.full_recout_width   = pipe->plane_res.scl_data.recout.width;\n\tinput->dest.full_recout_height  = pipe->plane_res.scl_data.recout.height;\n\n\tinput->dest.htotal         = pipe->stream->timing.h_total;\n\tinput->dest.hblank_start   = input->dest.htotal - pipe->stream->timing.h_front_porch;\n\tinput->dest.hblank_end     = input->dest.hblank_start\n\t\t\t- pipe->stream->timing.h_addressable\n\t\t\t- pipe->stream->timing.h_border_left\n\t\t\t- pipe->stream->timing.h_border_right;\n\n\tinput->dest.vtotal         = pipe->stream->timing.v_total;\n\tinput->dest.vblank_start   = input->dest.vtotal - pipe->stream->timing.v_front_porch;\n\tinput->dest.vblank_end     = input->dest.vblank_start\n\t\t\t- pipe->stream->timing.v_addressable\n\t\t\t- pipe->stream->timing.v_border_bottom\n\t\t\t- pipe->stream->timing.v_border_top;\n\tinput->dest.pixel_rate_mhz = pipe->stream->timing.pix_clk_100hz/10000.0;\n\tinput->dest.vstartup_start = pipe->pipe_dlg_param.vstartup_start;\n\tinput->dest.vupdate_offset = pipe->pipe_dlg_param.vupdate_offset;\n\tinput->dest.vupdate_offset = pipe->pipe_dlg_param.vupdate_offset;\n\tinput->dest.vupdate_width = pipe->pipe_dlg_param.vupdate_width;\n\n}\n\nstatic void dcn_bw_calc_rq_dlg_ttu(\n\t\tconst struct dc *dc,\n\t\tconst struct dcn_bw_internal_vars *v,\n\t\tstruct pipe_ctx *pipe,\n\t\tint in_idx)\n{\n\tstruct display_mode_lib *dml = (struct display_mode_lib *)(&dc->dml);\n\tstruct _vcs_dpi_display_dlg_regs_st *dlg_regs = &pipe->dlg_regs;\n\tstruct _vcs_dpi_display_ttu_regs_st *ttu_regs = &pipe->ttu_regs;\n\tstruct _vcs_dpi_display_rq_regs_st *rq_regs = &pipe->rq_regs;\n\tstruct _vcs_dpi_display_rq_params_st *rq_param = &pipe->dml_rq_param;\n\tstruct _vcs_dpi_display_dlg_sys_params_st *dlg_sys_param = &pipe->dml_dlg_sys_param;\n\tstruct _vcs_dpi_display_e2e_pipe_params_st *input = &pipe->dml_input;\n\tfloat total_active_bw = 0;\n\tfloat total_prefetch_bw = 0;\n\tint total_flip_bytes = 0;\n\tint i;\n\n\tmemset(dlg_regs, 0, sizeof(*dlg_regs));\n\tmemset(ttu_regs, 0, sizeof(*ttu_regs));\n\tmemset(rq_regs, 0, sizeof(*rq_regs));\n\tmemset(rq_param, 0, sizeof(*rq_param));\n\tmemset(dlg_sys_param, 0, sizeof(*dlg_sys_param));\n\tmemset(input, 0, sizeof(*input));\n\n\tfor (i = 0; i < number_of_planes; i++) {\n\t\ttotal_active_bw += v->read_bandwidth[i];\n\t\ttotal_prefetch_bw += v->prefetch_bandwidth[i];\n\t\ttotal_flip_bytes += v->total_immediate_flip_bytes[i];\n\t}\n\tdlg_sys_param->total_flip_bw = v->return_bw - dcn_bw_max2(total_active_bw, total_prefetch_bw);\n\tif (dlg_sys_param->total_flip_bw < 0.0)\n\t\tdlg_sys_param->total_flip_bw = 0;\n\n\tdlg_sys_param->t_mclk_wm_us = v->dram_clock_change_watermark;\n\tdlg_sys_param->t_sr_wm_us = v->stutter_enter_plus_exit_watermark;\n\tdlg_sys_param->t_urg_wm_us = v->urgent_watermark;\n\tdlg_sys_param->t_extra_us = v->urgent_extra_latency;\n\tdlg_sys_param->deepsleep_dcfclk_mhz = v->dcf_clk_deep_sleep;\n\tdlg_sys_param->total_flip_bytes = total_flip_bytes;\n\n\tpipe_ctx_to_e2e_pipe_params(pipe, &input->pipe);\n\tinput->clks_cfg.dcfclk_mhz = v->dcfclk;\n\tinput->clks_cfg.dispclk_mhz = v->dispclk;\n\tinput->clks_cfg.dppclk_mhz = v->dppclk;\n\tinput->clks_cfg.refclk_mhz = dc->res_pool->ref_clocks.dchub_ref_clock_inKhz / 1000.0;\n\tinput->clks_cfg.socclk_mhz = v->socclk;\n\tinput->clks_cfg.voltage = v->voltage_level;\n \n\tinput->dout.output_format = (v->output_format[in_idx] == dcn_bw_420) ? dm_420 : dm_444;\n\tinput->dout.output_type  = (v->output[in_idx] == dcn_bw_hdmi) ? dm_hdmi : dm_dp;\n\t \n\n\t \n\n\tdml1_rq_dlg_get_rq_params(dml, rq_param, &input->pipe.src);\n\tdml1_extract_rq_regs(dml, rq_regs, rq_param);\n\tdml1_rq_dlg_get_dlg_params(\n\t\t\tdml,\n\t\t\tdlg_regs,\n\t\t\tttu_regs,\n\t\t\t&rq_param->dlg,\n\t\t\tdlg_sys_param,\n\t\t\tinput,\n\t\t\ttrue,\n\t\t\ttrue,\n\t\t\tv->pte_enable == dcn_bw_yes,\n\t\t\tpipe->plane_state->flip_immediate);\n}\n\nstatic void split_stream_across_pipes(\n\t\tstruct resource_context *res_ctx,\n\t\tconst struct resource_pool *pool,\n\t\tstruct pipe_ctx *primary_pipe,\n\t\tstruct pipe_ctx *secondary_pipe)\n{\n\tint pipe_idx = secondary_pipe->pipe_idx;\n\n\tif (!primary_pipe->plane_state)\n\t\treturn;\n\n\t*secondary_pipe = *primary_pipe;\n\n\tsecondary_pipe->pipe_idx = pipe_idx;\n\tsecondary_pipe->plane_res.mi = pool->mis[secondary_pipe->pipe_idx];\n\tsecondary_pipe->plane_res.hubp = pool->hubps[secondary_pipe->pipe_idx];\n\tsecondary_pipe->plane_res.ipp = pool->ipps[secondary_pipe->pipe_idx];\n\tsecondary_pipe->plane_res.xfm = pool->transforms[secondary_pipe->pipe_idx];\n\tsecondary_pipe->plane_res.dpp = pool->dpps[secondary_pipe->pipe_idx];\n\tsecondary_pipe->plane_res.mpcc_inst = pool->dpps[secondary_pipe->pipe_idx]->inst;\n\tif (primary_pipe->bottom_pipe) {\n\t\tASSERT(primary_pipe->bottom_pipe != secondary_pipe);\n\t\tsecondary_pipe->bottom_pipe = primary_pipe->bottom_pipe;\n\t\tsecondary_pipe->bottom_pipe->top_pipe = secondary_pipe;\n\t}\n\tprimary_pipe->bottom_pipe = secondary_pipe;\n\tsecondary_pipe->top_pipe = primary_pipe;\n\n\tresource_build_scaling_params(primary_pipe);\n\tresource_build_scaling_params(secondary_pipe);\n}\n\n#if 0\nstatic void calc_wm_sets_and_perf_params(\n\t\tstruct dc_state *context,\n\t\tstruct dcn_bw_internal_vars *v)\n{\n\t \n\tif (v->voltage_level < 2) {\n\t\tv->fabric_and_dram_bandwidth_per_state[1] = v->fabric_and_dram_bandwidth_vnom0p8;\n\t\tv->fabric_and_dram_bandwidth_per_state[0] = v->fabric_and_dram_bandwidth_vnom0p8;\n\t\tv->fabric_and_dram_bandwidth = v->fabric_and_dram_bandwidth_vnom0p8;\n\t\tdispclkdppclkdcfclk_deep_sleep_prefetch_parameters_watermarks_and_performance_calculation(v);\n\n\t\tcontext->bw_ctx.bw.dcn.watermarks.b.cstate_pstate.cstate_exit_ns =\n\t\t\tv->stutter_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.b.cstate_pstate.cstate_enter_plus_exit_ns =\n\t\t\t\tv->stutter_enter_plus_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.b.cstate_pstate.pstate_change_ns =\n\t\t\t\tv->dram_clock_change_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.b.pte_meta_urgent_ns = v->ptemeta_urgent_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.b.urgent_ns = v->urgent_watermark * 1000;\n\n\t\tv->dcfclk_per_state[1] = v->dcfclkv_nom0p8;\n\t\tv->dcfclk_per_state[0] = v->dcfclkv_nom0p8;\n\t\tv->dcfclk = v->dcfclkv_nom0p8;\n\t\tdispclkdppclkdcfclk_deep_sleep_prefetch_parameters_watermarks_and_performance_calculation(v);\n\n\t\tcontext->bw_ctx.bw.dcn.watermarks.c.cstate_pstate.cstate_exit_ns =\n\t\t\tv->stutter_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.c.cstate_pstate.cstate_enter_plus_exit_ns =\n\t\t\t\tv->stutter_enter_plus_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.c.cstate_pstate.pstate_change_ns =\n\t\t\t\tv->dram_clock_change_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.c.pte_meta_urgent_ns = v->ptemeta_urgent_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.c.urgent_ns = v->urgent_watermark * 1000;\n\t}\n\n\tif (v->voltage_level < 3) {\n\t\tv->fabric_and_dram_bandwidth_per_state[2] = v->fabric_and_dram_bandwidth_vmax0p9;\n\t\tv->fabric_and_dram_bandwidth_per_state[1] = v->fabric_and_dram_bandwidth_vmax0p9;\n\t\tv->fabric_and_dram_bandwidth_per_state[0] = v->fabric_and_dram_bandwidth_vmax0p9;\n\t\tv->fabric_and_dram_bandwidth = v->fabric_and_dram_bandwidth_vmax0p9;\n\t\tv->dcfclk_per_state[2] = v->dcfclkv_max0p9;\n\t\tv->dcfclk_per_state[1] = v->dcfclkv_max0p9;\n\t\tv->dcfclk_per_state[0] = v->dcfclkv_max0p9;\n\t\tv->dcfclk = v->dcfclkv_max0p9;\n\t\tdispclkdppclkdcfclk_deep_sleep_prefetch_parameters_watermarks_and_performance_calculation(v);\n\n\t\tcontext->bw_ctx.bw.dcn.watermarks.d.cstate_pstate.cstate_exit_ns =\n\t\t\tv->stutter_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.d.cstate_pstate.cstate_enter_plus_exit_ns =\n\t\t\t\tv->stutter_enter_plus_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.d.cstate_pstate.pstate_change_ns =\n\t\t\t\tv->dram_clock_change_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.d.pte_meta_urgent_ns = v->ptemeta_urgent_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.d.urgent_ns = v->urgent_watermark * 1000;\n\t}\n\n\tv->fabric_and_dram_bandwidth_per_state[2] = v->fabric_and_dram_bandwidth_vnom0p8;\n\tv->fabric_and_dram_bandwidth_per_state[1] = v->fabric_and_dram_bandwidth_vmid0p72;\n\tv->fabric_and_dram_bandwidth_per_state[0] = v->fabric_and_dram_bandwidth_vmin0p65;\n\tv->fabric_and_dram_bandwidth = v->fabric_and_dram_bandwidth_per_state[v->voltage_level];\n\tv->dcfclk_per_state[2] = v->dcfclkv_nom0p8;\n\tv->dcfclk_per_state[1] = v->dcfclkv_mid0p72;\n\tv->dcfclk_per_state[0] = v->dcfclkv_min0p65;\n\tv->dcfclk = v->dcfclk_per_state[v->voltage_level];\n\tdispclkdppclkdcfclk_deep_sleep_prefetch_parameters_watermarks_and_performance_calculation(v);\n\n\tcontext->bw_ctx.bw.dcn.watermarks.a.cstate_pstate.cstate_exit_ns =\n\t\tv->stutter_exit_watermark * 1000;\n\tcontext->bw_ctx.bw.dcn.watermarks.a.cstate_pstate.cstate_enter_plus_exit_ns =\n\t\t\tv->stutter_enter_plus_exit_watermark * 1000;\n\tcontext->bw_ctx.bw.dcn.watermarks.a.cstate_pstate.pstate_change_ns =\n\t\t\tv->dram_clock_change_watermark * 1000;\n\tcontext->bw_ctx.bw.dcn.watermarks.a.pte_meta_urgent_ns = v->ptemeta_urgent_watermark * 1000;\n\tcontext->bw_ctx.bw.dcn.watermarks.a.urgent_ns = v->urgent_watermark * 1000;\n\tif (v->voltage_level >= 2) {\n\t\tcontext->bw_ctx.bw.dcn.watermarks.b = context->bw_ctx.bw.dcn.watermarks.a;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.c = context->bw_ctx.bw.dcn.watermarks.a;\n\t}\n\tif (v->voltage_level >= 3)\n\t\tcontext->bw_ctx.bw.dcn.watermarks.d = context->bw_ctx.bw.dcn.watermarks.a;\n}\n#endif\n\nstatic bool dcn_bw_apply_registry_override(struct dc *dc)\n{\n\tbool updated = false;\n\n\tif ((int)(dc->dcn_soc->sr_exit_time * 1000) != dc->debug.sr_exit_time_ns\n\t\t\t&& dc->debug.sr_exit_time_ns) {\n\t\tupdated = true;\n\t\tdc->dcn_soc->sr_exit_time = dc->debug.sr_exit_time_ns / 1000.0;\n\t}\n\n\tif ((int)(dc->dcn_soc->sr_enter_plus_exit_time * 1000)\n\t\t\t\t!= dc->debug.sr_enter_plus_exit_time_ns\n\t\t\t&& dc->debug.sr_enter_plus_exit_time_ns) {\n\t\tupdated = true;\n\t\tdc->dcn_soc->sr_enter_plus_exit_time =\n\t\t\t\tdc->debug.sr_enter_plus_exit_time_ns / 1000.0;\n\t}\n\n\tif ((int)(dc->dcn_soc->urgent_latency * 1000) != dc->debug.urgent_latency_ns\n\t\t\t&& dc->debug.urgent_latency_ns) {\n\t\tupdated = true;\n\t\tdc->dcn_soc->urgent_latency = dc->debug.urgent_latency_ns / 1000.0;\n\t}\n\n\tif ((int)(dc->dcn_soc->percent_of_ideal_drambw_received_after_urg_latency * 1000)\n\t\t\t\t!= dc->debug.percent_of_ideal_drambw\n\t\t\t&& dc->debug.percent_of_ideal_drambw) {\n\t\tupdated = true;\n\t\tdc->dcn_soc->percent_of_ideal_drambw_received_after_urg_latency =\n\t\t\t\tdc->debug.percent_of_ideal_drambw;\n\t}\n\n\tif ((int)(dc->dcn_soc->dram_clock_change_latency * 1000)\n\t\t\t\t!= dc->debug.dram_clock_change_latency_ns\n\t\t\t&& dc->debug.dram_clock_change_latency_ns) {\n\t\tupdated = true;\n\t\tdc->dcn_soc->dram_clock_change_latency =\n\t\t\t\tdc->debug.dram_clock_change_latency_ns / 1000.0;\n\t}\n\n\treturn updated;\n}\n\nstatic void hack_disable_optional_pipe_split(struct dcn_bw_internal_vars *v)\n{\n\t \n\tv->max_dispclk[0] = v->max_dppclk_vmin0p65;\n}\n\nstatic void hack_force_pipe_split(struct dcn_bw_internal_vars *v,\n\t\tunsigned int pixel_rate_100hz)\n{\n\tfloat pixel_rate_mhz = pixel_rate_100hz / 10000;\n\n\t \n\tif (pixel_rate_mhz < v->max_dppclk[0])\n\t\tv->max_dppclk[0] = pixel_rate_mhz;\n}\n\nstatic void hack_bounding_box(struct dcn_bw_internal_vars *v,\n\t\tstruct dc_debug_options *dbg,\n\t\tstruct dc_state *context)\n{\n\tint i;\n\n\tfor (i = 0; i < MAX_PIPES; i++) {\n\t\tstruct pipe_ctx *pipe = &context->res_ctx.pipe_ctx[i];\n\n\t\t \n\t\tif (pipe->plane_state &&\n\t\t    (pipe->plane_state->dst_rect.width <= 16 ||\n\t\t     pipe->plane_state->dst_rect.height <= 16 ||\n\t\t     pipe->plane_state->src_rect.width <= 16 ||\n\t\t     pipe->plane_state->src_rect.height <= 16)) {\n\t\t\thack_disable_optional_pipe_split(v);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif (dbg->pipe_split_policy == MPC_SPLIT_AVOID)\n\t\thack_disable_optional_pipe_split(v);\n\n\tif (dbg->pipe_split_policy == MPC_SPLIT_AVOID_MULT_DISP &&\n\t\tcontext->stream_count >= 2)\n\t\thack_disable_optional_pipe_split(v);\n\n\tif (context->stream_count == 1 &&\n\t\t\tdbg->force_single_disp_pipe_split)\n\t\thack_force_pipe_split(v, context->streams[0]->timing.pix_clk_100hz);\n}\n\nstatic unsigned int get_highest_allowed_voltage_level(bool is_vmin_only_asic)\n{\n\t \n\tif (is_vmin_only_asic)\n\t\treturn 0;\n\telse\t \n\t\treturn 4;\n}\n\nbool dcn_validate_bandwidth(\n\t\tstruct dc *dc,\n\t\tstruct dc_state *context,\n\t\tbool fast_validate)\n{\n\t \n\tBW_VAL_TRACE_SETUP();\n\n\tconst struct resource_pool *pool = dc->res_pool;\n\tstruct dcn_bw_internal_vars *v = &context->dcn_bw_vars;\n\tint i, input_idx, k;\n\tint vesa_sync_start, asic_blank_end, asic_blank_start;\n\tbool bw_limit_pass;\n\tfloat bw_limit;\n\n\tPERFORMANCE_TRACE_START();\n\n\tBW_VAL_TRACE_COUNT();\n\n\tif (dcn_bw_apply_registry_override(dc))\n\t\tdcn_bw_sync_calcs_and_dml(dc);\n\n\tmemset(v, 0, sizeof(*v));\n\n\tv->sr_exit_time = dc->dcn_soc->sr_exit_time;\n\tv->sr_enter_plus_exit_time = dc->dcn_soc->sr_enter_plus_exit_time;\n\tv->urgent_latency = dc->dcn_soc->urgent_latency;\n\tv->write_back_latency = dc->dcn_soc->write_back_latency;\n\tv->percent_of_ideal_drambw_received_after_urg_latency =\n\t\t\tdc->dcn_soc->percent_of_ideal_drambw_received_after_urg_latency;\n\n\tv->dcfclkv_min0p65 = dc->dcn_soc->dcfclkv_min0p65;\n\tv->dcfclkv_mid0p72 = dc->dcn_soc->dcfclkv_mid0p72;\n\tv->dcfclkv_nom0p8 = dc->dcn_soc->dcfclkv_nom0p8;\n\tv->dcfclkv_max0p9 = dc->dcn_soc->dcfclkv_max0p9;\n\n\tv->max_dispclk_vmin0p65 = dc->dcn_soc->max_dispclk_vmin0p65;\n\tv->max_dispclk_vmid0p72 = dc->dcn_soc->max_dispclk_vmid0p72;\n\tv->max_dispclk_vnom0p8 = dc->dcn_soc->max_dispclk_vnom0p8;\n\tv->max_dispclk_vmax0p9 = dc->dcn_soc->max_dispclk_vmax0p9;\n\n\tv->max_dppclk_vmin0p65 = dc->dcn_soc->max_dppclk_vmin0p65;\n\tv->max_dppclk_vmid0p72 = dc->dcn_soc->max_dppclk_vmid0p72;\n\tv->max_dppclk_vnom0p8 = dc->dcn_soc->max_dppclk_vnom0p8;\n\tv->max_dppclk_vmax0p9 = dc->dcn_soc->max_dppclk_vmax0p9;\n\n\tv->socclk = dc->dcn_soc->socclk;\n\n\tv->fabric_and_dram_bandwidth_vmin0p65 = dc->dcn_soc->fabric_and_dram_bandwidth_vmin0p65;\n\tv->fabric_and_dram_bandwidth_vmid0p72 = dc->dcn_soc->fabric_and_dram_bandwidth_vmid0p72;\n\tv->fabric_and_dram_bandwidth_vnom0p8 = dc->dcn_soc->fabric_and_dram_bandwidth_vnom0p8;\n\tv->fabric_and_dram_bandwidth_vmax0p9 = dc->dcn_soc->fabric_and_dram_bandwidth_vmax0p9;\n\n\tv->phyclkv_min0p65 = dc->dcn_soc->phyclkv_min0p65;\n\tv->phyclkv_mid0p72 = dc->dcn_soc->phyclkv_mid0p72;\n\tv->phyclkv_nom0p8 = dc->dcn_soc->phyclkv_nom0p8;\n\tv->phyclkv_max0p9 = dc->dcn_soc->phyclkv_max0p9;\n\n\tv->downspreading = dc->dcn_soc->downspreading;\n\tv->round_trip_ping_latency_cycles = dc->dcn_soc->round_trip_ping_latency_cycles;\n\tv->urgent_out_of_order_return_per_channel = dc->dcn_soc->urgent_out_of_order_return_per_channel;\n\tv->number_of_channels = dc->dcn_soc->number_of_channels;\n\tv->vmm_page_size = dc->dcn_soc->vmm_page_size;\n\tv->dram_clock_change_latency = dc->dcn_soc->dram_clock_change_latency;\n\tv->return_bus_width = dc->dcn_soc->return_bus_width;\n\n\tv->rob_buffer_size_in_kbyte = dc->dcn_ip->rob_buffer_size_in_kbyte;\n\tv->det_buffer_size_in_kbyte = dc->dcn_ip->det_buffer_size_in_kbyte;\n\tv->dpp_output_buffer_pixels = dc->dcn_ip->dpp_output_buffer_pixels;\n\tv->opp_output_buffer_lines = dc->dcn_ip->opp_output_buffer_lines;\n\tv->pixel_chunk_size_in_kbyte = dc->dcn_ip->pixel_chunk_size_in_kbyte;\n\tv->pte_enable = dc->dcn_ip->pte_enable;\n\tv->pte_chunk_size = dc->dcn_ip->pte_chunk_size;\n\tv->meta_chunk_size = dc->dcn_ip->meta_chunk_size;\n\tv->writeback_chunk_size = dc->dcn_ip->writeback_chunk_size;\n\tv->odm_capability = dc->dcn_ip->odm_capability;\n\tv->dsc_capability = dc->dcn_ip->dsc_capability;\n\tv->line_buffer_size = dc->dcn_ip->line_buffer_size;\n\tv->is_line_buffer_bpp_fixed = dc->dcn_ip->is_line_buffer_bpp_fixed;\n\tv->line_buffer_fixed_bpp = dc->dcn_ip->line_buffer_fixed_bpp;\n\tv->max_line_buffer_lines = dc->dcn_ip->max_line_buffer_lines;\n\tv->writeback_luma_buffer_size = dc->dcn_ip->writeback_luma_buffer_size;\n\tv->writeback_chroma_buffer_size = dc->dcn_ip->writeback_chroma_buffer_size;\n\tv->max_num_dpp = dc->dcn_ip->max_num_dpp;\n\tv->max_num_writeback = dc->dcn_ip->max_num_writeback;\n\tv->max_dchub_topscl_throughput = dc->dcn_ip->max_dchub_topscl_throughput;\n\tv->max_pscl_tolb_throughput = dc->dcn_ip->max_pscl_tolb_throughput;\n\tv->max_lb_tovscl_throughput = dc->dcn_ip->max_lb_tovscl_throughput;\n\tv->max_vscl_tohscl_throughput = dc->dcn_ip->max_vscl_tohscl_throughput;\n\tv->max_hscl_ratio = dc->dcn_ip->max_hscl_ratio;\n\tv->max_vscl_ratio = dc->dcn_ip->max_vscl_ratio;\n\tv->max_hscl_taps = dc->dcn_ip->max_hscl_taps;\n\tv->max_vscl_taps = dc->dcn_ip->max_vscl_taps;\n\tv->under_scan_factor = dc->dcn_ip->under_scan_factor;\n\tv->pte_buffer_size_in_requests = dc->dcn_ip->pte_buffer_size_in_requests;\n\tv->dispclk_ramping_margin = dc->dcn_ip->dispclk_ramping_margin;\n\tv->max_inter_dcn_tile_repeaters = dc->dcn_ip->max_inter_dcn_tile_repeaters;\n\tv->can_vstartup_lines_exceed_vsync_plus_back_porch_lines_minus_one =\n\t\t\tdc->dcn_ip->can_vstartup_lines_exceed_vsync_plus_back_porch_lines_minus_one;\n\tv->bug_forcing_luma_and_chroma_request_to_same_size_fixed =\n\t\t\tdc->dcn_ip->bug_forcing_luma_and_chroma_request_to_same_size_fixed;\n\n\tv->voltage[5] = dcn_bw_no_support;\n\tv->voltage[4] = dcn_bw_v_max0p9;\n\tv->voltage[3] = dcn_bw_v_max0p9;\n\tv->voltage[2] = dcn_bw_v_nom0p8;\n\tv->voltage[1] = dcn_bw_v_mid0p72;\n\tv->voltage[0] = dcn_bw_v_min0p65;\n\tv->fabric_and_dram_bandwidth_per_state[5] = v->fabric_and_dram_bandwidth_vmax0p9;\n\tv->fabric_and_dram_bandwidth_per_state[4] = v->fabric_and_dram_bandwidth_vmax0p9;\n\tv->fabric_and_dram_bandwidth_per_state[3] = v->fabric_and_dram_bandwidth_vmax0p9;\n\tv->fabric_and_dram_bandwidth_per_state[2] = v->fabric_and_dram_bandwidth_vnom0p8;\n\tv->fabric_and_dram_bandwidth_per_state[1] = v->fabric_and_dram_bandwidth_vmid0p72;\n\tv->fabric_and_dram_bandwidth_per_state[0] = v->fabric_and_dram_bandwidth_vmin0p65;\n\tv->dcfclk_per_state[5] = v->dcfclkv_max0p9;\n\tv->dcfclk_per_state[4] = v->dcfclkv_max0p9;\n\tv->dcfclk_per_state[3] = v->dcfclkv_max0p9;\n\tv->dcfclk_per_state[2] = v->dcfclkv_nom0p8;\n\tv->dcfclk_per_state[1] = v->dcfclkv_mid0p72;\n\tv->dcfclk_per_state[0] = v->dcfclkv_min0p65;\n\tv->max_dispclk[5] = v->max_dispclk_vmax0p9;\n\tv->max_dispclk[4] = v->max_dispclk_vmax0p9;\n\tv->max_dispclk[3] = v->max_dispclk_vmax0p9;\n\tv->max_dispclk[2] = v->max_dispclk_vnom0p8;\n\tv->max_dispclk[1] = v->max_dispclk_vmid0p72;\n\tv->max_dispclk[0] = v->max_dispclk_vmin0p65;\n\tv->max_dppclk[5] = v->max_dppclk_vmax0p9;\n\tv->max_dppclk[4] = v->max_dppclk_vmax0p9;\n\tv->max_dppclk[3] = v->max_dppclk_vmax0p9;\n\tv->max_dppclk[2] = v->max_dppclk_vnom0p8;\n\tv->max_dppclk[1] = v->max_dppclk_vmid0p72;\n\tv->max_dppclk[0] = v->max_dppclk_vmin0p65;\n\tv->phyclk_per_state[5] = v->phyclkv_max0p9;\n\tv->phyclk_per_state[4] = v->phyclkv_max0p9;\n\tv->phyclk_per_state[3] = v->phyclkv_max0p9;\n\tv->phyclk_per_state[2] = v->phyclkv_nom0p8;\n\tv->phyclk_per_state[1] = v->phyclkv_mid0p72;\n\tv->phyclk_per_state[0] = v->phyclkv_min0p65;\n\tv->synchronized_vblank = dcn_bw_no;\n\tv->ta_pscalculation = dcn_bw_override;\n\tv->allow_different_hratio_vratio = dcn_bw_yes;\n\n\tfor (i = 0, input_idx = 0; i < pool->pipe_count; i++) {\n\t\tstruct pipe_ctx *pipe = &context->res_ctx.pipe_ctx[i];\n\n\t\tif (!pipe->stream)\n\t\t\tcontinue;\n\t\t \n\t\tif (pipe->top_pipe && pipe->top_pipe->plane_state == pipe->plane_state)\n\t\t\tcontinue;\n\n\t\tv->underscan_output[input_idx] = false;  \n\t\tv->interlace_output[input_idx] = false;\n\n\t\tv->htotal[input_idx] = pipe->stream->timing.h_total;\n\t\tv->vtotal[input_idx] = pipe->stream->timing.v_total;\n\t\tv->vactive[input_idx] = pipe->stream->timing.v_addressable +\n\t\t\t\tpipe->stream->timing.v_border_top + pipe->stream->timing.v_border_bottom;\n\t\tv->v_sync_plus_back_porch[input_idx] = pipe->stream->timing.v_total\n\t\t\t\t- v->vactive[input_idx]\n\t\t\t\t- pipe->stream->timing.v_front_porch;\n\t\tv->pixel_clock[input_idx] = pipe->stream->timing.pix_clk_100hz/10000.0;\n\t\tif (pipe->stream->timing.timing_3d_format == TIMING_3D_FORMAT_HW_FRAME_PACKING)\n\t\t\tv->pixel_clock[input_idx] *= 2;\n\t\tif (!pipe->plane_state) {\n\t\t\tv->dcc_enable[input_idx] = dcn_bw_yes;\n\t\t\tv->source_pixel_format[input_idx] = dcn_bw_rgb_sub_32;\n\t\t\tv->source_surface_mode[input_idx] = dcn_bw_sw_4_kb_s;\n\t\t\tv->lb_bit_per_pixel[input_idx] = 30;\n\t\t\tv->viewport_width[input_idx] = pipe->stream->timing.h_addressable;\n\t\t\tv->viewport_height[input_idx] = pipe->stream->timing.v_addressable;\n\t\t\t \n\t\t\tif (v->viewport_width[input_idx] > 1920)\n\t\t\t\tv->viewport_width[input_idx] = 1920;\n\t\t\tif (v->viewport_height[input_idx] > 1080)\n\t\t\t\tv->viewport_height[input_idx] = 1080;\n\t\t\tv->scaler_rec_out_width[input_idx] = v->viewport_width[input_idx];\n\t\t\tv->scaler_recout_height[input_idx] = v->viewport_height[input_idx];\n\t\t\tv->override_hta_ps[input_idx] = 1;\n\t\t\tv->override_vta_ps[input_idx] = 1;\n\t\t\tv->override_hta_pschroma[input_idx] = 1;\n\t\t\tv->override_vta_pschroma[input_idx] = 1;\n\t\t\tv->source_scan[input_idx] = dcn_bw_hor;\n\n\t\t} else {\n\t\t\tv->viewport_height[input_idx] =  pipe->plane_res.scl_data.viewport.height;\n\t\t\tv->viewport_width[input_idx] = pipe->plane_res.scl_data.viewport.width;\n\t\t\tv->scaler_rec_out_width[input_idx] = pipe->plane_res.scl_data.recout.width;\n\t\t\tv->scaler_recout_height[input_idx] = pipe->plane_res.scl_data.recout.height;\n\t\t\tif (pipe->bottom_pipe && pipe->bottom_pipe->plane_state == pipe->plane_state) {\n\t\t\t\tif (pipe->plane_state->rotation % 2 == 0) {\n\t\t\t\t\tint viewport_end = pipe->plane_res.scl_data.viewport.width\n\t\t\t\t\t\t\t+ pipe->plane_res.scl_data.viewport.x;\n\t\t\t\t\tint viewport_b_end = pipe->bottom_pipe->plane_res.scl_data.viewport.width\n\t\t\t\t\t\t\t+ pipe->bottom_pipe->plane_res.scl_data.viewport.x;\n\n\t\t\t\t\tif (viewport_end > viewport_b_end)\n\t\t\t\t\t\tv->viewport_width[input_idx] = viewport_end\n\t\t\t\t\t\t\t- pipe->bottom_pipe->plane_res.scl_data.viewport.x;\n\t\t\t\t\telse\n\t\t\t\t\t\tv->viewport_width[input_idx] = viewport_b_end\n\t\t\t\t\t\t\t\t\t- pipe->plane_res.scl_data.viewport.x;\n\t\t\t\t} else  {\n\t\t\t\t\tint viewport_end = pipe->plane_res.scl_data.viewport.height\n\t\t\t\t\t\t+ pipe->plane_res.scl_data.viewport.y;\n\t\t\t\t\tint viewport_b_end = pipe->bottom_pipe->plane_res.scl_data.viewport.height\n\t\t\t\t\t\t+ pipe->bottom_pipe->plane_res.scl_data.viewport.y;\n\n\t\t\t\t\tif (viewport_end > viewport_b_end)\n\t\t\t\t\t\tv->viewport_height[input_idx] = viewport_end\n\t\t\t\t\t\t\t- pipe->bottom_pipe->plane_res.scl_data.viewport.y;\n\t\t\t\t\telse\n\t\t\t\t\t\tv->viewport_height[input_idx] = viewport_b_end\n\t\t\t\t\t\t\t\t\t- pipe->plane_res.scl_data.viewport.y;\n\t\t\t\t}\n\t\t\t\tv->scaler_rec_out_width[input_idx] = pipe->plane_res.scl_data.recout.width\n\t\t\t\t\t\t+ pipe->bottom_pipe->plane_res.scl_data.recout.width;\n\t\t\t}\n\n\t\t\tif (pipe->plane_state->rotation % 2 == 0) {\n\t\t\t\tASSERT(pipe->plane_res.scl_data.ratios.horz.value != dc_fixpt_one.value\n\t\t\t\t\t|| v->scaler_rec_out_width[input_idx] == v->viewport_width[input_idx]);\n\t\t\t\tASSERT(pipe->plane_res.scl_data.ratios.vert.value != dc_fixpt_one.value\n\t\t\t\t\t|| v->scaler_recout_height[input_idx] == v->viewport_height[input_idx]);\n\t\t\t} else {\n\t\t\t\tASSERT(pipe->plane_res.scl_data.ratios.horz.value != dc_fixpt_one.value\n\t\t\t\t\t|| v->scaler_recout_height[input_idx] == v->viewport_width[input_idx]);\n\t\t\t\tASSERT(pipe->plane_res.scl_data.ratios.vert.value != dc_fixpt_one.value\n\t\t\t\t\t|| v->scaler_rec_out_width[input_idx] == v->viewport_height[input_idx]);\n\t\t\t}\n\n\t\t\tif (dc->debug.optimized_watermark) {\n\t\t\t\t \n\t\t\t\tv->dcc_enable[input_idx] = pipe->plane_state->dcc.enable ? dcn_bw_yes : dcn_bw_no;\n\t\t\t} else {\n\t\t\t\t \n\t\t\t\tunsigned int bpe;\n\n\t\t\t\tv->dcc_enable[input_idx] = dc->res_pool->hubbub->funcs->dcc_support_pixel_format(\n\t\t\t\t\t\tpipe->plane_state->format, &bpe) ? dcn_bw_yes : dcn_bw_no;\n\t\t\t}\n\n\t\t\tv->source_pixel_format[input_idx] = tl_pixel_format_to_bw_defs(\n\t\t\t\t\tpipe->plane_state->format);\n\t\t\tv->source_surface_mode[input_idx] = tl_sw_mode_to_bw_defs(\n\t\t\t\t\tpipe->plane_state->tiling_info.gfx9.swizzle);\n\t\t\tv->lb_bit_per_pixel[input_idx] = tl_lb_bpp_to_int(pipe->plane_res.scl_data.lb_params.depth);\n\t\t\tv->override_hta_ps[input_idx] = pipe->plane_res.scl_data.taps.h_taps;\n\t\t\tv->override_vta_ps[input_idx] = pipe->plane_res.scl_data.taps.v_taps;\n\t\t\tv->override_hta_pschroma[input_idx] = pipe->plane_res.scl_data.taps.h_taps_c;\n\t\t\tv->override_vta_pschroma[input_idx] = pipe->plane_res.scl_data.taps.v_taps_c;\n\t\t\t \n\t\t\tif (v->override_hta_pschroma[input_idx] == 1)\n\t\t\t\tv->override_hta_pschroma[input_idx] = 2;\n\t\t\tif (v->override_vta_pschroma[input_idx] == 1)\n\t\t\t\tv->override_vta_pschroma[input_idx] = 2;\n\t\t\tv->source_scan[input_idx] = (pipe->plane_state->rotation % 2) ? dcn_bw_vert : dcn_bw_hor;\n\t\t}\n\t\tif (v->is_line_buffer_bpp_fixed == dcn_bw_yes)\n\t\t\tv->lb_bit_per_pixel[input_idx] = v->line_buffer_fixed_bpp;\n\t\tv->dcc_rate[input_idx] = 1;  \n\t\tv->output_format[input_idx] = pipe->stream->timing.pixel_encoding ==\n\t\t\t\tPIXEL_ENCODING_YCBCR420 ? dcn_bw_420 : dcn_bw_444;\n\t\tv->output[input_idx] = pipe->stream->signal ==\n\t\t\t\tSIGNAL_TYPE_HDMI_TYPE_A ? dcn_bw_hdmi : dcn_bw_dp;\n\t\tv->output_deep_color[input_idx] = dcn_bw_encoder_8bpc;\n\t\tif (v->output[input_idx] == dcn_bw_hdmi) {\n\t\t\tswitch (pipe->stream->timing.display_color_depth) {\n\t\t\tcase COLOR_DEPTH_101010:\n\t\t\t\tv->output_deep_color[input_idx] = dcn_bw_encoder_10bpc;\n\t\t\t\tbreak;\n\t\t\tcase COLOR_DEPTH_121212:\n\t\t\t\tv->output_deep_color[input_idx]  = dcn_bw_encoder_12bpc;\n\t\t\t\tbreak;\n\t\t\tcase COLOR_DEPTH_161616:\n\t\t\t\tv->output_deep_color[input_idx]  = dcn_bw_encoder_16bpc;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tinput_idx++;\n\t}\n\tv->number_of_active_planes = input_idx;\n\n\tscaler_settings_calculation(v);\n\n\thack_bounding_box(v, &dc->debug, context);\n\n\tmode_support_and_system_configuration(v);\n\n\t \n\tif (v->voltage_level != 0\n\t\t\t&& context->stream_count == 1\n\t\t\t&& dc->debug.force_single_disp_pipe_split) {\n\t\tv->max_dppclk[0] = v->max_dppclk_vmin0p65;\n\t\tmode_support_and_system_configuration(v);\n\t}\n\n\tif (v->voltage_level == 0 &&\n\t\t\t(dc->debug.sr_exit_time_dpm0_ns\n\t\t\t\t|| dc->debug.sr_enter_plus_exit_time_dpm0_ns)) {\n\n\t\tif (dc->debug.sr_enter_plus_exit_time_dpm0_ns)\n\t\t\tv->sr_enter_plus_exit_time =\n\t\t\t\tdc->debug.sr_enter_plus_exit_time_dpm0_ns / 1000.0f;\n\t\tif (dc->debug.sr_exit_time_dpm0_ns)\n\t\t\tv->sr_exit_time =  dc->debug.sr_exit_time_dpm0_ns / 1000.0f;\n\t\tcontext->bw_ctx.dml.soc.sr_enter_plus_exit_time_us = v->sr_enter_plus_exit_time;\n\t\tcontext->bw_ctx.dml.soc.sr_exit_time_us = v->sr_exit_time;\n\t\tmode_support_and_system_configuration(v);\n\t}\n\n\tdisplay_pipe_configuration(v);\n\n\tfor (k = 0; k <= v->number_of_active_planes - 1; k++) {\n\t\tif (v->source_scan[k] == dcn_bw_hor)\n\t\t\tv->swath_width_y[k] = v->viewport_width[k] / v->dpp_per_plane[k];\n\t\telse\n\t\t\tv->swath_width_y[k] = v->viewport_height[k] / v->dpp_per_plane[k];\n\t}\n\tfor (k = 0; k <= v->number_of_active_planes - 1; k++) {\n\t\tif (v->source_pixel_format[k] == dcn_bw_rgb_sub_64) {\n\t\t\tv->byte_per_pixel_dety[k] = 8.0;\n\t\t\tv->byte_per_pixel_detc[k] = 0.0;\n\t\t} else if (v->source_pixel_format[k] == dcn_bw_rgb_sub_32) {\n\t\t\tv->byte_per_pixel_dety[k] = 4.0;\n\t\t\tv->byte_per_pixel_detc[k] = 0.0;\n\t\t} else if (v->source_pixel_format[k] == dcn_bw_rgb_sub_16) {\n\t\t\tv->byte_per_pixel_dety[k] = 2.0;\n\t\t\tv->byte_per_pixel_detc[k] = 0.0;\n\t\t} else if (v->source_pixel_format[k] == dcn_bw_yuv420_sub_8) {\n\t\t\tv->byte_per_pixel_dety[k] = 1.0;\n\t\t\tv->byte_per_pixel_detc[k] = 2.0;\n\t\t} else {\n\t\t\tv->byte_per_pixel_dety[k] = 4.0f / 3.0f;\n\t\t\tv->byte_per_pixel_detc[k] = 8.0f / 3.0f;\n\t\t}\n\t}\n\n\tv->total_data_read_bandwidth = 0.0;\n\tfor (k = 0; k <= v->number_of_active_planes - 1; k++) {\n\t\tv->read_bandwidth_plane_luma[k] = v->swath_width_y[k] * v->dpp_per_plane[k] *\n\t\t\t\tdcn_bw_ceil2(v->byte_per_pixel_dety[k], 1.0) / (v->htotal[k] / v->pixel_clock[k]) * v->v_ratio[k];\n\t\tv->read_bandwidth_plane_chroma[k] = v->swath_width_y[k] / 2.0 * v->dpp_per_plane[k] *\n\t\t\t\tdcn_bw_ceil2(v->byte_per_pixel_detc[k], 2.0) / (v->htotal[k] / v->pixel_clock[k]) * v->v_ratio[k] / 2.0;\n\t\tv->total_data_read_bandwidth = v->total_data_read_bandwidth +\n\t\t\t\tv->read_bandwidth_plane_luma[k] + v->read_bandwidth_plane_chroma[k];\n\t}\n\n\tBW_VAL_TRACE_END_VOLTAGE_LEVEL();\n\n\tif (v->voltage_level != number_of_states_plus_one && !fast_validate) {\n\t\tfloat bw_consumed = v->total_bandwidth_consumed_gbyte_per_second;\n\n\t\tif (bw_consumed < v->fabric_and_dram_bandwidth_vmin0p65)\n\t\t\tbw_consumed = v->fabric_and_dram_bandwidth_vmin0p65;\n\t\telse if (bw_consumed < v->fabric_and_dram_bandwidth_vmid0p72)\n\t\t\tbw_consumed = v->fabric_and_dram_bandwidth_vmid0p72;\n\t\telse if (bw_consumed < v->fabric_and_dram_bandwidth_vnom0p8)\n\t\t\tbw_consumed = v->fabric_and_dram_bandwidth_vnom0p8;\n\t\telse\n\t\t\tbw_consumed = v->fabric_and_dram_bandwidth_vmax0p9;\n\n\t\tif (bw_consumed < v->fabric_and_dram_bandwidth)\n\t\t\tif (dc->debug.voltage_align_fclk)\n\t\t\t\tbw_consumed = v->fabric_and_dram_bandwidth;\n\n\t\tdisplay_pipe_configuration(v);\n\t\t \n\t\t \n\t\tdispclkdppclkdcfclk_deep_sleep_prefetch_parameters_watermarks_and_performance_calculation(v);\n\n\t\tcontext->bw_ctx.bw.dcn.watermarks.a.cstate_pstate.cstate_exit_ns =\n\t\t\tv->stutter_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.a.cstate_pstate.cstate_enter_plus_exit_ns =\n\t\t\t\tv->stutter_enter_plus_exit_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.a.cstate_pstate.pstate_change_ns =\n\t\t\t\tv->dram_clock_change_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.a.pte_meta_urgent_ns = v->ptemeta_urgent_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.a.urgent_ns = v->urgent_watermark * 1000;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.b = context->bw_ctx.bw.dcn.watermarks.a;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.c = context->bw_ctx.bw.dcn.watermarks.a;\n\t\tcontext->bw_ctx.bw.dcn.watermarks.d = context->bw_ctx.bw.dcn.watermarks.a;\n\n\t\tcontext->bw_ctx.bw.dcn.clk.fclk_khz = (int)(bw_consumed * 1000000 /\n\t\t\t\t(ddr4_dram_factor_single_Channel * v->number_of_channels));\n\t\tif (bw_consumed == v->fabric_and_dram_bandwidth_vmin0p65)\n\t\t\tcontext->bw_ctx.bw.dcn.clk.fclk_khz = (int)(bw_consumed * 1000000 / 32);\n\n\t\tcontext->bw_ctx.bw.dcn.clk.dcfclk_deep_sleep_khz = (int)(v->dcf_clk_deep_sleep * 1000);\n\t\tcontext->bw_ctx.bw.dcn.clk.dcfclk_khz = (int)(v->dcfclk * 1000);\n\n\t\tcontext->bw_ctx.bw.dcn.clk.dispclk_khz = (int)(v->dispclk * 1000);\n\t\tif (dc->debug.max_disp_clk == true)\n\t\t\tcontext->bw_ctx.bw.dcn.clk.dispclk_khz = (int)(dc->dcn_soc->max_dispclk_vmax0p9 * 1000);\n\n\t\tif (context->bw_ctx.bw.dcn.clk.dispclk_khz <\n\t\t\t\tdc->debug.min_disp_clk_khz) {\n\t\t\tcontext->bw_ctx.bw.dcn.clk.dispclk_khz =\n\t\t\t\t\tdc->debug.min_disp_clk_khz;\n\t\t}\n\n\t\tcontext->bw_ctx.bw.dcn.clk.dppclk_khz = context->bw_ctx.bw.dcn.clk.dispclk_khz /\n\t\t\t\tv->dispclk_dppclk_ratio;\n\t\tcontext->bw_ctx.bw.dcn.clk.phyclk_khz = v->phyclk_per_state[v->voltage_level];\n\t\tswitch (v->voltage_level) {\n\t\tcase 0:\n\t\t\tcontext->bw_ctx.bw.dcn.clk.max_supported_dppclk_khz =\n\t\t\t\t\t(int)(dc->dcn_soc->max_dppclk_vmin0p65 * 1000);\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tcontext->bw_ctx.bw.dcn.clk.max_supported_dppclk_khz =\n\t\t\t\t\t(int)(dc->dcn_soc->max_dppclk_vmid0p72 * 1000);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tcontext->bw_ctx.bw.dcn.clk.max_supported_dppclk_khz =\n\t\t\t\t\t(int)(dc->dcn_soc->max_dppclk_vnom0p8 * 1000);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tcontext->bw_ctx.bw.dcn.clk.max_supported_dppclk_khz =\n\t\t\t\t\t(int)(dc->dcn_soc->max_dppclk_vmax0p9 * 1000);\n\t\t\tbreak;\n\t\t}\n\n\t\tBW_VAL_TRACE_END_WATERMARKS();\n\n\t\tfor (i = 0, input_idx = 0; i < pool->pipe_count; i++) {\n\t\t\tstruct pipe_ctx *pipe = &context->res_ctx.pipe_ctx[i];\n\n\t\t\t \n\t\t\tif (!pipe->stream)\n\t\t\t\tcontinue;\n\t\t\t \n\t\t\tif (pipe->top_pipe && pipe->top_pipe->plane_state == pipe->plane_state)\n\t\t\t\tcontinue;\n\n\t\t\tpipe->pipe_dlg_param.vupdate_width = v->v_update_width_pix[input_idx];\n\t\t\tpipe->pipe_dlg_param.vupdate_offset = v->v_update_offset_pix[input_idx];\n\t\t\tpipe->pipe_dlg_param.vready_offset = v->v_ready_offset_pix[input_idx];\n\t\t\tpipe->pipe_dlg_param.vstartup_start = v->v_startup[input_idx];\n\n\t\t\tpipe->pipe_dlg_param.htotal = pipe->stream->timing.h_total;\n\t\t\tpipe->pipe_dlg_param.vtotal = pipe->stream->timing.v_total;\n\t\t\tvesa_sync_start = pipe->stream->timing.v_addressable +\n\t\t\t\t\t\tpipe->stream->timing.v_border_bottom +\n\t\t\t\t\t\tpipe->stream->timing.v_front_porch;\n\n\t\t\tasic_blank_end = (pipe->stream->timing.v_total -\n\t\t\t\t\t\tvesa_sync_start -\n\t\t\t\t\t\tpipe->stream->timing.v_border_top)\n\t\t\t* (pipe->stream->timing.flags.INTERLACE ? 1 : 0);\n\n\t\t\tasic_blank_start = asic_blank_end +\n\t\t\t\t\t\t(pipe->stream->timing.v_border_top +\n\t\t\t\t\t\tpipe->stream->timing.v_addressable +\n\t\t\t\t\t\tpipe->stream->timing.v_border_bottom)\n\t\t\t* (pipe->stream->timing.flags.INTERLACE ? 1 : 0);\n\n\t\t\tpipe->pipe_dlg_param.vblank_start = asic_blank_start;\n\t\t\tpipe->pipe_dlg_param.vblank_end = asic_blank_end;\n\n\t\t\tif (pipe->plane_state) {\n\t\t\t\tstruct pipe_ctx *hsplit_pipe = pipe->bottom_pipe;\n\n\t\t\t\tpipe->plane_state->update_flags.bits.full_update = 1;\n\n\t\t\t\tif (v->dpp_per_plane[input_idx] == 2 ||\n\t\t\t\t\t((pipe->stream->view_format ==\n\t\t\t\t\t  VIEW_3D_FORMAT_SIDE_BY_SIDE ||\n\t\t\t\t\t  pipe->stream->view_format ==\n\t\t\t\t\t  VIEW_3D_FORMAT_TOP_AND_BOTTOM) &&\n\t\t\t\t\t(pipe->stream->timing.timing_3d_format ==\n\t\t\t\t\t TIMING_3D_FORMAT_TOP_AND_BOTTOM ||\n\t\t\t\t\t pipe->stream->timing.timing_3d_format ==\n\t\t\t\t\t TIMING_3D_FORMAT_SIDE_BY_SIDE))) {\n\t\t\t\t\tif (hsplit_pipe && hsplit_pipe->plane_state == pipe->plane_state) {\n\t\t\t\t\t\t \n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.vupdate_width = v->v_update_width_pix[input_idx];\n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.vupdate_offset = v->v_update_offset_pix[input_idx];\n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.vready_offset = v->v_ready_offset_pix[input_idx];\n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.vstartup_start = v->v_startup[input_idx];\n\n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.htotal = pipe->stream->timing.h_total;\n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.vtotal = pipe->stream->timing.v_total;\n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.vblank_start = pipe->pipe_dlg_param.vblank_start;\n\t\t\t\t\t\thsplit_pipe->pipe_dlg_param.vblank_end = pipe->pipe_dlg_param.vblank_end;\n\t\t\t\t\t} else {\n\t\t\t\t\t\t \n\t\t\t\t\t\thsplit_pipe = resource_find_free_secondary_pipe_legacy(&context->res_ctx, pool, pipe);\n\t\t\t\t\t\tASSERT(hsplit_pipe);\n\t\t\t\t\t\tsplit_stream_across_pipes(&context->res_ctx, pool, pipe, hsplit_pipe);\n\t\t\t\t\t}\n\n\t\t\t\t\tdcn_bw_calc_rq_dlg_ttu(dc, v, hsplit_pipe, input_idx);\n\t\t\t\t} else if (hsplit_pipe && hsplit_pipe->plane_state == pipe->plane_state) {\n\t\t\t\t\t \n\t\t\t\t\tpipe->bottom_pipe = hsplit_pipe->bottom_pipe;\n\t\t\t\t\tif (hsplit_pipe->bottom_pipe)\n\t\t\t\t\t\thsplit_pipe->bottom_pipe->top_pipe = pipe;\n\t\t\t\t\thsplit_pipe->plane_state = NULL;\n\t\t\t\t\thsplit_pipe->stream = NULL;\n\t\t\t\t\thsplit_pipe->top_pipe = NULL;\n\t\t\t\t\thsplit_pipe->bottom_pipe = NULL;\n\t\t\t\t\t \n\t\t\t\t\tmemset(&hsplit_pipe->plane_res, 0, sizeof(hsplit_pipe->plane_res));\n\t\t\t\t\tmemset(&hsplit_pipe->stream_res, 0, sizeof(hsplit_pipe->stream_res));\n\t\t\t\t\tresource_build_scaling_params(pipe);\n\t\t\t\t}\n\t\t\t\t \n\t\t\t\tdcn_bw_calc_rq_dlg_ttu(dc, v, pipe, input_idx);\n\t\t\t}\n\n\t\t\tinput_idx++;\n\t\t}\n\t} else if (v->voltage_level == number_of_states_plus_one) {\n\t\tBW_VAL_TRACE_SKIP(fail);\n\t} else if (fast_validate) {\n\t\tBW_VAL_TRACE_SKIP(fast);\n\t}\n\n\tif (v->voltage_level == 0) {\n\t\tcontext->bw_ctx.dml.soc.sr_enter_plus_exit_time_us =\n\t\t\t\tdc->dcn_soc->sr_enter_plus_exit_time;\n\t\tcontext->bw_ctx.dml.soc.sr_exit_time_us = dc->dcn_soc->sr_exit_time;\n\t}\n\n\t \n\n\tbw_limit = dc->dcn_soc->percent_disp_bw_limit * v->fabric_and_dram_bandwidth_vmax0p9;\n\tbw_limit_pass = (v->total_data_read_bandwidth / 1000.0) < bw_limit;\n\n\tPERFORMANCE_TRACE_END();\n\tBW_VAL_TRACE_FINISH();\n\n\tif (bw_limit_pass && v->voltage_level <= get_highest_allowed_voltage_level(dc->config.is_vmin_only_asic))\n\t\treturn true;\n\telse\n\t\treturn false;\n}\n\nstatic unsigned int dcn_find_normalized_clock_vdd_Level(\n\tconst struct dc *dc,\n\tenum dm_pp_clock_type clocks_type,\n\tint clocks_in_khz)\n{\n\tint vdd_level = dcn_bw_v_min0p65;\n\n\tif (clocks_in_khz == 0) \n\t\treturn vdd_level;\n\n\tswitch (clocks_type) {\n\tcase DM_PP_CLOCK_TYPE_DISPLAY_CLK:\n\t\tif (clocks_in_khz > dc->dcn_soc->max_dispclk_vmax0p9*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p91;\n\t\t\tBREAK_TO_DEBUGGER();\n\t\t} else if (clocks_in_khz > dc->dcn_soc->max_dispclk_vnom0p8*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p9;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->max_dispclk_vmid0p72*1000) {\n\t\t\tvdd_level = dcn_bw_v_nom0p8;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->max_dispclk_vmin0p65*1000) {\n\t\t\tvdd_level = dcn_bw_v_mid0p72;\n\t\t} else\n\t\t\tvdd_level = dcn_bw_v_min0p65;\n\t\tbreak;\n\tcase DM_PP_CLOCK_TYPE_DISPLAYPHYCLK:\n\t\tif (clocks_in_khz > dc->dcn_soc->phyclkv_max0p9*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p91;\n\t\t\tBREAK_TO_DEBUGGER();\n\t\t} else if (clocks_in_khz > dc->dcn_soc->phyclkv_nom0p8*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p9;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->phyclkv_mid0p72*1000) {\n\t\t\tvdd_level = dcn_bw_v_nom0p8;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->phyclkv_min0p65*1000) {\n\t\t\tvdd_level = dcn_bw_v_mid0p72;\n\t\t} else\n\t\t\tvdd_level = dcn_bw_v_min0p65;\n\t\tbreak;\n\n\tcase DM_PP_CLOCK_TYPE_DPPCLK:\n\t\tif (clocks_in_khz > dc->dcn_soc->max_dppclk_vmax0p9*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p91;\n\t\t\tBREAK_TO_DEBUGGER();\n\t\t} else if (clocks_in_khz > dc->dcn_soc->max_dppclk_vnom0p8*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p9;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->max_dppclk_vmid0p72*1000) {\n\t\t\tvdd_level = dcn_bw_v_nom0p8;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->max_dppclk_vmin0p65*1000) {\n\t\t\tvdd_level = dcn_bw_v_mid0p72;\n\t\t} else\n\t\t\tvdd_level = dcn_bw_v_min0p65;\n\t\tbreak;\n\n\tcase DM_PP_CLOCK_TYPE_MEMORY_CLK:\n\t\t{\n\t\t\tunsigned factor = (ddr4_dram_factor_single_Channel * dc->dcn_soc->number_of_channels);\n\n\t\t\tif (clocks_in_khz > dc->dcn_soc->fabric_and_dram_bandwidth_vmax0p9*1000000/factor) {\n\t\t\t\tvdd_level = dcn_bw_v_max0p91;\n\t\t\t\tBREAK_TO_DEBUGGER();\n\t\t\t} else if (clocks_in_khz > dc->dcn_soc->fabric_and_dram_bandwidth_vnom0p8*1000000/factor) {\n\t\t\t\tvdd_level = dcn_bw_v_max0p9;\n\t\t\t} else if (clocks_in_khz > dc->dcn_soc->fabric_and_dram_bandwidth_vmid0p72*1000000/factor) {\n\t\t\t\tvdd_level = dcn_bw_v_nom0p8;\n\t\t\t} else if (clocks_in_khz > dc->dcn_soc->fabric_and_dram_bandwidth_vmin0p65*1000000/factor) {\n\t\t\t\tvdd_level = dcn_bw_v_mid0p72;\n\t\t\t} else\n\t\t\t\tvdd_level = dcn_bw_v_min0p65;\n\t\t}\n\t\tbreak;\n\n\tcase DM_PP_CLOCK_TYPE_DCFCLK:\n\t\tif (clocks_in_khz > dc->dcn_soc->dcfclkv_max0p9*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p91;\n\t\t\tBREAK_TO_DEBUGGER();\n\t\t} else if (clocks_in_khz > dc->dcn_soc->dcfclkv_nom0p8*1000) {\n\t\t\tvdd_level = dcn_bw_v_max0p9;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->dcfclkv_mid0p72*1000) {\n\t\t\tvdd_level = dcn_bw_v_nom0p8;\n\t\t} else if (clocks_in_khz > dc->dcn_soc->dcfclkv_min0p65*1000) {\n\t\t\tvdd_level = dcn_bw_v_mid0p72;\n\t\t} else\n\t\t\tvdd_level = dcn_bw_v_min0p65;\n\t\tbreak;\n\n\tdefault:\n\t\t break;\n\t}\n\treturn vdd_level;\n}\n\nunsigned int dcn_find_dcfclk_suits_all(\n\tconst struct dc *dc,\n\tstruct dc_clocks *clocks)\n{\n\tunsigned vdd_level, vdd_level_temp;\n\tunsigned dcf_clk;\n\n\t \n\tvdd_level = dcn_find_normalized_clock_vdd_Level(\n\t\tdc, DM_PP_CLOCK_TYPE_DISPLAY_CLK, clocks->dispclk_khz);\n\tvdd_level_temp = dcn_find_normalized_clock_vdd_Level(\n\t\tdc, DM_PP_CLOCK_TYPE_DISPLAYPHYCLK, clocks->phyclk_khz);\n\n\tvdd_level = dcn_bw_max(vdd_level, vdd_level_temp);\n\tvdd_level_temp = dcn_find_normalized_clock_vdd_Level(\n\t\tdc, DM_PP_CLOCK_TYPE_DPPCLK, clocks->dppclk_khz);\n\tvdd_level = dcn_bw_max(vdd_level, vdd_level_temp);\n\n\tvdd_level_temp = dcn_find_normalized_clock_vdd_Level(\n\t\tdc, DM_PP_CLOCK_TYPE_MEMORY_CLK, clocks->fclk_khz);\n\tvdd_level = dcn_bw_max(vdd_level, vdd_level_temp);\n\tvdd_level_temp = dcn_find_normalized_clock_vdd_Level(\n\t\tdc, DM_PP_CLOCK_TYPE_DCFCLK, clocks->dcfclk_khz);\n\n\t \n\tvdd_level = dcn_bw_max(vdd_level, vdd_level_temp);\n\tif (vdd_level == dcn_bw_v_max0p91) {\n\t\tBREAK_TO_DEBUGGER();\n\t\tdcf_clk = dc->dcn_soc->dcfclkv_max0p9*1000;\n\t} else if (vdd_level == dcn_bw_v_max0p9)\n\t\tdcf_clk =  dc->dcn_soc->dcfclkv_max0p9*1000;\n\telse if (vdd_level == dcn_bw_v_nom0p8)\n\t\tdcf_clk =  dc->dcn_soc->dcfclkv_nom0p8*1000;\n\telse if (vdd_level == dcn_bw_v_mid0p72)\n\t\tdcf_clk =  dc->dcn_soc->dcfclkv_mid0p72*1000;\n\telse\n\t\tdcf_clk =  dc->dcn_soc->dcfclkv_min0p65*1000;\n\n\tDC_LOG_BANDWIDTH_CALCS(\"\\tdcf_clk for voltage = %d\\n\", dcf_clk);\n\treturn dcf_clk;\n}\n\nvoid dcn_bw_update_from_pplib_fclks(\n\tstruct dc *dc,\n\tstruct dm_pp_clock_levels_with_voltage *fclks)\n{\n\tunsigned vmin0p65_idx, vmid0p72_idx, vnom0p8_idx, vmax0p9_idx;\n\n\tASSERT(fclks->num_levels);\n\n\tvmin0p65_idx = 0;\n\tvmid0p72_idx = fclks->num_levels -\n\t\t(fclks->num_levels > 2 ? 3 : (fclks->num_levels > 1 ? 2 : 1));\n\tvnom0p8_idx = fclks->num_levels - (fclks->num_levels > 1 ? 2 : 1);\n\tvmax0p9_idx = fclks->num_levels - 1;\n\n\tdc->dcn_soc->fabric_and_dram_bandwidth_vmin0p65 =\n\t\t32 * (fclks->data[vmin0p65_idx].clocks_in_khz / 1000.0) / 1000.0;\n\tdc->dcn_soc->fabric_and_dram_bandwidth_vmid0p72 =\n\t\tdc->dcn_soc->number_of_channels *\n\t\t(fclks->data[vmid0p72_idx].clocks_in_khz / 1000.0)\n\t\t* ddr4_dram_factor_single_Channel / 1000.0;\n\tdc->dcn_soc->fabric_and_dram_bandwidth_vnom0p8 =\n\t\tdc->dcn_soc->number_of_channels *\n\t\t(fclks->data[vnom0p8_idx].clocks_in_khz / 1000.0)\n\t\t* ddr4_dram_factor_single_Channel / 1000.0;\n\tdc->dcn_soc->fabric_and_dram_bandwidth_vmax0p9 =\n\t\tdc->dcn_soc->number_of_channels *\n\t\t(fclks->data[vmax0p9_idx].clocks_in_khz / 1000.0)\n\t\t* ddr4_dram_factor_single_Channel / 1000.0;\n}\n\nvoid dcn_bw_update_from_pplib_dcfclks(\n\tstruct dc *dc,\n\tstruct dm_pp_clock_levels_with_voltage *dcfclks)\n{\n\tif (dcfclks->num_levels >= 3) {\n\t\tdc->dcn_soc->dcfclkv_min0p65 = dcfclks->data[0].clocks_in_khz / 1000.0;\n\t\tdc->dcn_soc->dcfclkv_mid0p72 = dcfclks->data[dcfclks->num_levels - 3].clocks_in_khz / 1000.0;\n\t\tdc->dcn_soc->dcfclkv_nom0p8 = dcfclks->data[dcfclks->num_levels - 2].clocks_in_khz / 1000.0;\n\t\tdc->dcn_soc->dcfclkv_max0p9 = dcfclks->data[dcfclks->num_levels - 1].clocks_in_khz / 1000.0;\n\t}\n}\n\nvoid dcn_get_soc_clks(\n\tstruct dc *dc,\n\tint *min_fclk_khz,\n\tint *min_dcfclk_khz,\n\tint *socclk_khz)\n{\n\t*min_fclk_khz = dc->dcn_soc->fabric_and_dram_bandwidth_vmin0p65 * 1000000 / 32;\n\t*min_dcfclk_khz = dc->dcn_soc->dcfclkv_min0p65 * 1000;\n\t*socclk_khz = dc->dcn_soc->socclk * 1000;\n}\n\nvoid dcn_bw_notify_pplib_of_wm_ranges(\n\tstruct dc *dc,\n\tint min_fclk_khz,\n\tint min_dcfclk_khz,\n\tint socclk_khz)\n{\n\tstruct pp_smu_funcs_rv *pp = NULL;\n\tstruct pp_smu_wm_range_sets ranges = {0};\n\tconst int overdrive = 5000000;  \n\n\tif (dc->res_pool->pp_smu)\n\t\tpp = &dc->res_pool->pp_smu->rv_funcs;\n\tif (!pp || !pp->set_wm_ranges)\n\t\treturn;\n\n\t \n\t \n\tranges.num_reader_wm_sets = WM_SET_COUNT;\n\tranges.num_writer_wm_sets = WM_SET_COUNT;\n\tranges.reader_wm_sets[0].wm_inst = WM_A;\n\tranges.reader_wm_sets[0].min_drain_clk_mhz = min_dcfclk_khz / 1000;\n\tranges.reader_wm_sets[0].max_drain_clk_mhz = overdrive / 1000;\n\tranges.reader_wm_sets[0].min_fill_clk_mhz = min_fclk_khz / 1000;\n\tranges.reader_wm_sets[0].max_fill_clk_mhz = overdrive / 1000;\n\tranges.writer_wm_sets[0].wm_inst = WM_A;\n\tranges.writer_wm_sets[0].min_fill_clk_mhz = socclk_khz / 1000;\n\tranges.writer_wm_sets[0].max_fill_clk_mhz = overdrive / 1000;\n\tranges.writer_wm_sets[0].min_drain_clk_mhz = min_fclk_khz / 1000;\n\tranges.writer_wm_sets[0].max_drain_clk_mhz = overdrive / 1000;\n\n\tif (dc->debug.pplib_wm_report_mode == WM_REPORT_OVERRIDE) {\n\t\tranges.reader_wm_sets[0].wm_inst = WM_A;\n\t\tranges.reader_wm_sets[0].min_drain_clk_mhz = 300;\n\t\tranges.reader_wm_sets[0].max_drain_clk_mhz = 5000;\n\t\tranges.reader_wm_sets[0].min_fill_clk_mhz = 800;\n\t\tranges.reader_wm_sets[0].max_fill_clk_mhz = 5000;\n\t\tranges.writer_wm_sets[0].wm_inst = WM_A;\n\t\tranges.writer_wm_sets[0].min_fill_clk_mhz = 200;\n\t\tranges.writer_wm_sets[0].max_fill_clk_mhz = 5000;\n\t\tranges.writer_wm_sets[0].min_drain_clk_mhz = 800;\n\t\tranges.writer_wm_sets[0].max_drain_clk_mhz = 5000;\n\t}\n\n\tranges.reader_wm_sets[1] = ranges.writer_wm_sets[0];\n\tranges.reader_wm_sets[1].wm_inst = WM_B;\n\n\tranges.reader_wm_sets[2] = ranges.writer_wm_sets[0];\n\tranges.reader_wm_sets[2].wm_inst = WM_C;\n\n\tranges.reader_wm_sets[3] = ranges.writer_wm_sets[0];\n\tranges.reader_wm_sets[3].wm_inst = WM_D;\n\n\t \n\tpp->set_wm_ranges(&pp->pp_smu, &ranges);\n}\n\nvoid dcn_bw_sync_calcs_and_dml(struct dc *dc)\n{\n\tDC_LOG_BANDWIDTH_CALCS(\"sr_exit_time: %f ns\\n\"\n\t\t\t\"sr_enter_plus_exit_time: %f ns\\n\"\n\t\t\t\"urgent_latency: %f ns\\n\"\n\t\t\t\"write_back_latency: %f ns\\n\"\n\t\t\t\"percent_of_ideal_drambw_received_after_urg_latency: %f %%\\n\"\n\t\t\t\"max_request_size: %d bytes\\n\"\n\t\t\t\"dcfclkv_max0p9: %f kHz\\n\"\n\t\t\t\"dcfclkv_nom0p8: %f kHz\\n\"\n\t\t\t\"dcfclkv_mid0p72: %f kHz\\n\"\n\t\t\t\"dcfclkv_min0p65: %f kHz\\n\"\n\t\t\t\"max_dispclk_vmax0p9: %f kHz\\n\"\n\t\t\t\"max_dispclk_vnom0p8: %f kHz\\n\"\n\t\t\t\"max_dispclk_vmid0p72: %f kHz\\n\"\n\t\t\t\"max_dispclk_vmin0p65: %f kHz\\n\"\n\t\t\t\"max_dppclk_vmax0p9: %f kHz\\n\"\n\t\t\t\"max_dppclk_vnom0p8: %f kHz\\n\"\n\t\t\t\"max_dppclk_vmid0p72: %f kHz\\n\"\n\t\t\t\"max_dppclk_vmin0p65: %f kHz\\n\"\n\t\t\t\"socclk: %f kHz\\n\"\n\t\t\t\"fabric_and_dram_bandwidth_vmax0p9: %f MB/s\\n\"\n\t\t\t\"fabric_and_dram_bandwidth_vnom0p8: %f MB/s\\n\"\n\t\t\t\"fabric_and_dram_bandwidth_vmid0p72: %f MB/s\\n\"\n\t\t\t\"fabric_and_dram_bandwidth_vmin0p65: %f MB/s\\n\"\n\t\t\t\"phyclkv_max0p9: %f kHz\\n\"\n\t\t\t\"phyclkv_nom0p8: %f kHz\\n\"\n\t\t\t\"phyclkv_mid0p72: %f kHz\\n\"\n\t\t\t\"phyclkv_min0p65: %f kHz\\n\"\n\t\t\t\"downspreading: %f %%\\n\"\n\t\t\t\"round_trip_ping_latency_cycles: %d DCFCLK Cycles\\n\"\n\t\t\t\"urgent_out_of_order_return_per_channel: %d Bytes\\n\"\n\t\t\t\"number_of_channels: %d\\n\"\n\t\t\t\"vmm_page_size: %d Bytes\\n\"\n\t\t\t\"dram_clock_change_latency: %f ns\\n\"\n\t\t\t\"return_bus_width: %d Bytes\\n\",\n\t\t\tdc->dcn_soc->sr_exit_time * 1000,\n\t\t\tdc->dcn_soc->sr_enter_plus_exit_time * 1000,\n\t\t\tdc->dcn_soc->urgent_latency * 1000,\n\t\t\tdc->dcn_soc->write_back_latency * 1000,\n\t\t\tdc->dcn_soc->percent_of_ideal_drambw_received_after_urg_latency,\n\t\t\tdc->dcn_soc->max_request_size,\n\t\t\tdc->dcn_soc->dcfclkv_max0p9 * 1000,\n\t\t\tdc->dcn_soc->dcfclkv_nom0p8 * 1000,\n\t\t\tdc->dcn_soc->dcfclkv_mid0p72 * 1000,\n\t\t\tdc->dcn_soc->dcfclkv_min0p65 * 1000,\n\t\t\tdc->dcn_soc->max_dispclk_vmax0p9 * 1000,\n\t\t\tdc->dcn_soc->max_dispclk_vnom0p8 * 1000,\n\t\t\tdc->dcn_soc->max_dispclk_vmid0p72 * 1000,\n\t\t\tdc->dcn_soc->max_dispclk_vmin0p65 * 1000,\n\t\t\tdc->dcn_soc->max_dppclk_vmax0p9 * 1000,\n\t\t\tdc->dcn_soc->max_dppclk_vnom0p8 * 1000,\n\t\t\tdc->dcn_soc->max_dppclk_vmid0p72 * 1000,\n\t\t\tdc->dcn_soc->max_dppclk_vmin0p65 * 1000,\n\t\t\tdc->dcn_soc->socclk * 1000,\n\t\t\tdc->dcn_soc->fabric_and_dram_bandwidth_vmax0p9 * 1000,\n\t\t\tdc->dcn_soc->fabric_and_dram_bandwidth_vnom0p8 * 1000,\n\t\t\tdc->dcn_soc->fabric_and_dram_bandwidth_vmid0p72 * 1000,\n\t\t\tdc->dcn_soc->fabric_and_dram_bandwidth_vmin0p65 * 1000,\n\t\t\tdc->dcn_soc->phyclkv_max0p9 * 1000,\n\t\t\tdc->dcn_soc->phyclkv_nom0p8 * 1000,\n\t\t\tdc->dcn_soc->phyclkv_mid0p72 * 1000,\n\t\t\tdc->dcn_soc->phyclkv_min0p65 * 1000,\n\t\t\tdc->dcn_soc->downspreading * 100,\n\t\t\tdc->dcn_soc->round_trip_ping_latency_cycles,\n\t\t\tdc->dcn_soc->urgent_out_of_order_return_per_channel,\n\t\t\tdc->dcn_soc->number_of_channels,\n\t\t\tdc->dcn_soc->vmm_page_size,\n\t\t\tdc->dcn_soc->dram_clock_change_latency * 1000,\n\t\t\tdc->dcn_soc->return_bus_width);\n\tDC_LOG_BANDWIDTH_CALCS(\"rob_buffer_size_in_kbyte: %f\\n\"\n\t\t\t\"det_buffer_size_in_kbyte: %f\\n\"\n\t\t\t\"dpp_output_buffer_pixels: %f\\n\"\n\t\t\t\"opp_output_buffer_lines: %f\\n\"\n\t\t\t\"pixel_chunk_size_in_kbyte: %f\\n\"\n\t\t\t\"pte_enable: %d\\n\"\n\t\t\t\"pte_chunk_size: %d kbytes\\n\"\n\t\t\t\"meta_chunk_size: %d kbytes\\n\"\n\t\t\t\"writeback_chunk_size: %d kbytes\\n\"\n\t\t\t\"odm_capability: %d\\n\"\n\t\t\t\"dsc_capability: %d\\n\"\n\t\t\t\"line_buffer_size: %d bits\\n\"\n\t\t\t\"max_line_buffer_lines: %d\\n\"\n\t\t\t\"is_line_buffer_bpp_fixed: %d\\n\"\n\t\t\t\"line_buffer_fixed_bpp: %d\\n\"\n\t\t\t\"writeback_luma_buffer_size: %d kbytes\\n\"\n\t\t\t\"writeback_chroma_buffer_size: %d kbytes\\n\"\n\t\t\t\"max_num_dpp: %d\\n\"\n\t\t\t\"max_num_writeback: %d\\n\"\n\t\t\t\"max_dchub_topscl_throughput: %d pixels/dppclk\\n\"\n\t\t\t\"max_pscl_tolb_throughput: %d pixels/dppclk\\n\"\n\t\t\t\"max_lb_tovscl_throughput: %d pixels/dppclk\\n\"\n\t\t\t\"max_vscl_tohscl_throughput: %d pixels/dppclk\\n\"\n\t\t\t\"max_hscl_ratio: %f\\n\"\n\t\t\t\"max_vscl_ratio: %f\\n\"\n\t\t\t\"max_hscl_taps: %d\\n\"\n\t\t\t\"max_vscl_taps: %d\\n\"\n\t\t\t\"pte_buffer_size_in_requests: %d\\n\"\n\t\t\t\"dispclk_ramping_margin: %f %%\\n\"\n\t\t\t\"under_scan_factor: %f %%\\n\"\n\t\t\t\"max_inter_dcn_tile_repeaters: %d\\n\"\n\t\t\t\"can_vstartup_lines_exceed_vsync_plus_back_porch_lines_minus_one: %d\\n\"\n\t\t\t\"bug_forcing_luma_and_chroma_request_to_same_size_fixed: %d\\n\"\n\t\t\t\"dcfclk_cstate_latency: %d\\n\",\n\t\t\tdc->dcn_ip->rob_buffer_size_in_kbyte,\n\t\t\tdc->dcn_ip->det_buffer_size_in_kbyte,\n\t\t\tdc->dcn_ip->dpp_output_buffer_pixels,\n\t\t\tdc->dcn_ip->opp_output_buffer_lines,\n\t\t\tdc->dcn_ip->pixel_chunk_size_in_kbyte,\n\t\t\tdc->dcn_ip->pte_enable,\n\t\t\tdc->dcn_ip->pte_chunk_size,\n\t\t\tdc->dcn_ip->meta_chunk_size,\n\t\t\tdc->dcn_ip->writeback_chunk_size,\n\t\t\tdc->dcn_ip->odm_capability,\n\t\t\tdc->dcn_ip->dsc_capability,\n\t\t\tdc->dcn_ip->line_buffer_size,\n\t\t\tdc->dcn_ip->max_line_buffer_lines,\n\t\t\tdc->dcn_ip->is_line_buffer_bpp_fixed,\n\t\t\tdc->dcn_ip->line_buffer_fixed_bpp,\n\t\t\tdc->dcn_ip->writeback_luma_buffer_size,\n\t\t\tdc->dcn_ip->writeback_chroma_buffer_size,\n\t\t\tdc->dcn_ip->max_num_dpp,\n\t\t\tdc->dcn_ip->max_num_writeback,\n\t\t\tdc->dcn_ip->max_dchub_topscl_throughput,\n\t\t\tdc->dcn_ip->max_pscl_tolb_throughput,\n\t\t\tdc->dcn_ip->max_lb_tovscl_throughput,\n\t\t\tdc->dcn_ip->max_vscl_tohscl_throughput,\n\t\t\tdc->dcn_ip->max_hscl_ratio,\n\t\t\tdc->dcn_ip->max_vscl_ratio,\n\t\t\tdc->dcn_ip->max_hscl_taps,\n\t\t\tdc->dcn_ip->max_vscl_taps,\n\t\t\tdc->dcn_ip->pte_buffer_size_in_requests,\n\t\t\tdc->dcn_ip->dispclk_ramping_margin,\n\t\t\tdc->dcn_ip->under_scan_factor * 100,\n\t\t\tdc->dcn_ip->max_inter_dcn_tile_repeaters,\n\t\t\tdc->dcn_ip->can_vstartup_lines_exceed_vsync_plus_back_porch_lines_minus_one,\n\t\t\tdc->dcn_ip->bug_forcing_luma_and_chroma_request_to_same_size_fixed,\n\t\t\tdc->dcn_ip->dcfclk_cstate_latency);\n\n\tdc->dml.soc.sr_exit_time_us = dc->dcn_soc->sr_exit_time;\n\tdc->dml.soc.sr_enter_plus_exit_time_us = dc->dcn_soc->sr_enter_plus_exit_time;\n\tdc->dml.soc.urgent_latency_us = dc->dcn_soc->urgent_latency;\n\tdc->dml.soc.writeback_latency_us = dc->dcn_soc->write_back_latency;\n\tdc->dml.soc.ideal_dram_bw_after_urgent_percent =\n\t\t\tdc->dcn_soc->percent_of_ideal_drambw_received_after_urg_latency;\n\tdc->dml.soc.max_request_size_bytes = dc->dcn_soc->max_request_size;\n\tdc->dml.soc.downspread_percent = dc->dcn_soc->downspreading;\n\tdc->dml.soc.round_trip_ping_latency_dcfclk_cycles =\n\t\t\tdc->dcn_soc->round_trip_ping_latency_cycles;\n\tdc->dml.soc.urgent_out_of_order_return_per_channel_bytes =\n\t\t\tdc->dcn_soc->urgent_out_of_order_return_per_channel;\n\tdc->dml.soc.num_chans = dc->dcn_soc->number_of_channels;\n\tdc->dml.soc.vmm_page_size_bytes = dc->dcn_soc->vmm_page_size;\n\tdc->dml.soc.dram_clock_change_latency_us = dc->dcn_soc->dram_clock_change_latency;\n\tdc->dml.soc.return_bus_width_bytes = dc->dcn_soc->return_bus_width;\n\n\tdc->dml.ip.rob_buffer_size_kbytes = dc->dcn_ip->rob_buffer_size_in_kbyte;\n\tdc->dml.ip.det_buffer_size_kbytes = dc->dcn_ip->det_buffer_size_in_kbyte;\n\tdc->dml.ip.dpp_output_buffer_pixels = dc->dcn_ip->dpp_output_buffer_pixels;\n\tdc->dml.ip.opp_output_buffer_lines = dc->dcn_ip->opp_output_buffer_lines;\n\tdc->dml.ip.pixel_chunk_size_kbytes = dc->dcn_ip->pixel_chunk_size_in_kbyte;\n\tdc->dml.ip.pte_enable = dc->dcn_ip->pte_enable == dcn_bw_yes;\n\tdc->dml.ip.pte_chunk_size_kbytes = dc->dcn_ip->pte_chunk_size;\n\tdc->dml.ip.meta_chunk_size_kbytes = dc->dcn_ip->meta_chunk_size;\n\tdc->dml.ip.writeback_chunk_size_kbytes = dc->dcn_ip->writeback_chunk_size;\n\tdc->dml.ip.line_buffer_size_bits = dc->dcn_ip->line_buffer_size;\n\tdc->dml.ip.max_line_buffer_lines = dc->dcn_ip->max_line_buffer_lines;\n\tdc->dml.ip.IsLineBufferBppFixed = dc->dcn_ip->is_line_buffer_bpp_fixed == dcn_bw_yes;\n\tdc->dml.ip.LineBufferFixedBpp = dc->dcn_ip->line_buffer_fixed_bpp;\n\tdc->dml.ip.writeback_luma_buffer_size_kbytes = dc->dcn_ip->writeback_luma_buffer_size;\n\tdc->dml.ip.writeback_chroma_buffer_size_kbytes = dc->dcn_ip->writeback_chroma_buffer_size;\n\tdc->dml.ip.max_num_dpp = dc->dcn_ip->max_num_dpp;\n\tdc->dml.ip.max_num_wb = dc->dcn_ip->max_num_writeback;\n\tdc->dml.ip.max_dchub_pscl_bw_pix_per_clk = dc->dcn_ip->max_dchub_topscl_throughput;\n\tdc->dml.ip.max_pscl_lb_bw_pix_per_clk = dc->dcn_ip->max_pscl_tolb_throughput;\n\tdc->dml.ip.max_lb_vscl_bw_pix_per_clk = dc->dcn_ip->max_lb_tovscl_throughput;\n\tdc->dml.ip.max_vscl_hscl_bw_pix_per_clk = dc->dcn_ip->max_vscl_tohscl_throughput;\n\tdc->dml.ip.max_hscl_ratio = dc->dcn_ip->max_hscl_ratio;\n\tdc->dml.ip.max_vscl_ratio = dc->dcn_ip->max_vscl_ratio;\n\tdc->dml.ip.max_hscl_taps = dc->dcn_ip->max_hscl_taps;\n\tdc->dml.ip.max_vscl_taps = dc->dcn_ip->max_vscl_taps;\n\t \n\tdc->dml.ip.dispclk_ramp_margin_percent = dc->dcn_ip->dispclk_ramping_margin;\n\tdc->dml.ip.underscan_factor = dc->dcn_ip->under_scan_factor;\n\tdc->dml.ip.max_inter_dcn_tile_repeaters = dc->dcn_ip->max_inter_dcn_tile_repeaters;\n\tdc->dml.ip.can_vstartup_lines_exceed_vsync_plus_back_porch_lines_minus_one =\n\t\tdc->dcn_ip->can_vstartup_lines_exceed_vsync_plus_back_porch_lines_minus_one == dcn_bw_yes;\n\tdc->dml.ip.bug_forcing_LC_req_same_size_fixed =\n\t\tdc->dcn_ip->bug_forcing_luma_and_chroma_request_to_same_size_fixed == dcn_bw_yes;\n\tdc->dml.ip.dcfclk_cstate_latency = dc->dcn_ip->dcfclk_cstate_latency;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}