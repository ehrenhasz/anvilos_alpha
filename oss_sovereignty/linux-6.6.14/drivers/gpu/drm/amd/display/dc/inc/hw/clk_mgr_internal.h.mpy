{
  "module_name": "clk_mgr_internal.h",
  "hash_id": "2f6f6b70211e7738609064fb059a20d4b1385d7328fae05c42ef90591d76f66c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/inc/hw/clk_mgr_internal.h",
  "human_readable_source": " \n\n#ifndef __DAL_CLK_MGR_INTERNAL_H__\n#define __DAL_CLK_MGR_INTERNAL_H__\n\n#include \"clk_mgr.h\"\n#include \"dc.h\"\n\n \n#include \"resource.h\"\n\n\n \nenum dentist_base_divider_id {\n\tDENTIST_BASE_DID_1 = 0x08,\n\tDENTIST_BASE_DID_2 = 0x40,\n\tDENTIST_BASE_DID_3 = 0x60,\n\tDENTIST_BASE_DID_4 = 0x7e,\n\tDENTIST_MAX_DID = 0x7f\n};\n\n \nenum dentist_divider_range {\n\tDENTIST_DIVIDER_RANGE_1_START = 8,    \n\tDENTIST_DIVIDER_RANGE_1_STEP  = 1,    \n\tDENTIST_DIVIDER_RANGE_2_START = 64,   \n\tDENTIST_DIVIDER_RANGE_2_STEP  = 2,    \n\tDENTIST_DIVIDER_RANGE_3_START = 128,  \n\tDENTIST_DIVIDER_RANGE_3_STEP  = 4,    \n\tDENTIST_DIVIDER_RANGE_4_START = 248,  \n\tDENTIST_DIVIDER_RANGE_4_STEP  = 264,  \n\tDENTIST_DIVIDER_RANGE_SCALE_FACTOR = 4\n};\n\n \n\n \n\n#define TO_CLK_MGR_INTERNAL(clk_mgr)\\\n\tcontainer_of(clk_mgr, struct clk_mgr_internal, base)\n\n#define CTX \\\n\tclk_mgr->base.ctx\n\n#define DC_LOGGER \\\n\tclk_mgr->base.ctx->logger\n\n\n\n\n#define CLK_BASE(inst) \\\n\tCLK_BASE_INNER(inst)\n\n#define CLK_SRI(reg_name, block, inst)\\\n\t.reg_name = CLK_BASE(mm ## block ## _ ## inst ## _ ## reg_name ## _BASE_IDX) + \\\n\t\t\t\t\tmm ## block ## _ ## inst ## _ ## reg_name\n\n#define CLK_COMMON_REG_LIST_DCE_BASE() \\\n\t.DPREFCLK_CNTL = mmDPREFCLK_CNTL, \\\n\t.DENTIST_DISPCLK_CNTL = mmDENTIST_DISPCLK_CNTL\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\n#define CLK_COMMON_REG_LIST_DCE60_BASE() \\\n\tSR(DENTIST_DISPCLK_CNTL)\n#endif\n\n#define CLK_COMMON_REG_LIST_DCN_BASE() \\\n\tSR(DENTIST_DISPCLK_CNTL)\n\n#define VBIOS_SMU_MSG_BOX_REG_LIST_RV() \\\n\t.MP1_SMN_C2PMSG_91 = mmMP1_SMN_C2PMSG_91, \\\n\t.MP1_SMN_C2PMSG_83 = mmMP1_SMN_C2PMSG_83, \\\n\t.MP1_SMN_C2PMSG_67 = mmMP1_SMN_C2PMSG_67\n\n#define CLK_COMMON_REG_LIST_DCN_201() \\\n\tSR(DENTIST_DISPCLK_CNTL), \\\n\tCLK_SRI(CLK4_CLK_PLL_REQ, CLK4, 0), \\\n\tCLK_SRI(CLK4_CLK2_CURRENT_CNT, CLK4, 0)\n\n#define CLK_REG_LIST_NV10() \\\n\tSR(DENTIST_DISPCLK_CNTL), \\\n\tCLK_SRI(CLK3_CLK_PLL_REQ, CLK3, 0), \\\n\tCLK_SRI(CLK3_CLK2_DFS_CNTL, CLK3, 0)\n\n#define CLK_REG_LIST_DCN3()\t  \\\n\tCLK_COMMON_REG_LIST_DCN_BASE(), \\\n\tCLK_SRI(CLK0_CLK_PLL_REQ,   CLK02, 0), \\\n\tCLK_SRI(CLK0_CLK2_DFS_CNTL, CLK02, 0)\n\n#define CLK_SF(reg_name, field_name, post_fix)\\\n\t.field_name = reg_name ## __ ## field_name ## post_fix\n\n#define CLK_COMMON_MASK_SH_LIST_DCE_COMMON_BASE(mask_sh) \\\n\tCLK_SF(DPREFCLK_CNTL, DPREFCLK_SRC_SEL, mask_sh), \\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DPREFCLK_WDIVIDER, mask_sh)\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\n#define CLK_COMMON_MASK_SH_LIST_DCE60_COMMON_BASE(mask_sh) \\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DISPCLK_WDIVIDER, mask_sh),\\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DISPCLK_CHG_DONE, mask_sh)\n#endif\n\n#define CLK_COMMON_MASK_SH_LIST_DCN_COMMON_BASE(mask_sh) \\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DISPCLK_WDIVIDER, mask_sh),\\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DISPCLK_CHG_DONE, mask_sh)\n\n#define CLK_MASK_SH_LIST_RV1(mask_sh) \\\n\tCLK_COMMON_MASK_SH_LIST_DCN_COMMON_BASE(mask_sh),\\\n\tCLK_SF(MP1_SMN_C2PMSG_67, CONTENT, mask_sh),\\\n\tCLK_SF(MP1_SMN_C2PMSG_83, CONTENT, mask_sh),\\\n\tCLK_SF(MP1_SMN_C2PMSG_91, CONTENT, mask_sh),\n\n#define CLK_COMMON_MASK_SH_LIST_DCN20_BASE(mask_sh) \\\n\tCLK_COMMON_MASK_SH_LIST_DCN_COMMON_BASE(mask_sh),\\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DPPCLK_WDIVIDER, mask_sh),\\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DPPCLK_CHG_DONE, mask_sh)\n\n#define CLK_MASK_SH_LIST_NV10(mask_sh) \\\n\tCLK_COMMON_MASK_SH_LIST_DCN20_BASE(mask_sh),\\\n\tCLK_SF(CLK3_0_CLK3_CLK_PLL_REQ, FbMult_int, mask_sh),\\\n\tCLK_SF(CLK3_0_CLK3_CLK_PLL_REQ, FbMult_frac, mask_sh)\n\n#define CLK_COMMON_MASK_SH_LIST_DCN201_BASE(mask_sh) \\\n\tCLK_COMMON_MASK_SH_LIST_DCN_COMMON_BASE(mask_sh),\\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DPPCLK_WDIVIDER, mask_sh),\\\n\tCLK_SF(DENTIST_DISPCLK_CNTL, DENTIST_DPPCLK_CHG_DONE, mask_sh),\\\n\tCLK_SF(CLK4_0_CLK4_CLK_PLL_REQ, FbMult_int, mask_sh)\n\n#define CLK_REG_LIST_DCN32()\t  \\\n\tSR(DENTIST_DISPCLK_CNTL), \\\n\tCLK_SR_DCN32(CLK1_CLK_PLL_REQ), \\\n\tCLK_SR_DCN32(CLK1_CLK0_DFS_CNTL), \\\n\tCLK_SR_DCN32(CLK1_CLK1_DFS_CNTL), \\\n\tCLK_SR_DCN32(CLK1_CLK2_DFS_CNTL), \\\n\tCLK_SR_DCN32(CLK1_CLK3_DFS_CNTL), \\\n\tCLK_SR_DCN32(CLK1_CLK4_DFS_CNTL)\n\n#define CLK_COMMON_MASK_SH_LIST_DCN32(mask_sh) \\\n\tCLK_COMMON_MASK_SH_LIST_DCN20_BASE(mask_sh),\\\n\tCLK_SF(CLK1_CLK_PLL_REQ, FbMult_int, mask_sh),\\\n\tCLK_SF(CLK1_CLK_PLL_REQ, FbMult_frac, mask_sh)\n\n#define CLK_REG_LIST_DCN321()\t  \\\n\tSR(DENTIST_DISPCLK_CNTL), \\\n\tCLK_SR_DCN321(CLK0_CLK_PLL_REQ,   CLK01, 0), \\\n\tCLK_SR_DCN321(CLK0_CLK0_DFS_CNTL, CLK01, 0), \\\n\tCLK_SR_DCN321(CLK0_CLK1_DFS_CNTL, CLK01, 0), \\\n\tCLK_SR_DCN321(CLK0_CLK2_DFS_CNTL, CLK01, 0), \\\n\tCLK_SR_DCN321(CLK0_CLK3_DFS_CNTL, CLK01, 0), \\\n\tCLK_SR_DCN321(CLK0_CLK4_DFS_CNTL, CLK01, 0)\n\n#define CLK_COMMON_MASK_SH_LIST_DCN321(mask_sh) \\\n\tCLK_COMMON_MASK_SH_LIST_DCN20_BASE(mask_sh),\\\n\tCLK_SF(CLK0_CLK_PLL_REQ, FbMult_int, mask_sh),\\\n\tCLK_SF(CLK0_CLK_PLL_REQ, FbMult_frac, mask_sh)\n\n#define CLK_REG_FIELD_LIST(type) \\\n\ttype DPREFCLK_SRC_SEL; \\\n\ttype DENTIST_DPREFCLK_WDIVIDER; \\\n\ttype DENTIST_DISPCLK_WDIVIDER; \\\n\ttype DENTIST_DISPCLK_CHG_DONE;\n\n \n#define CLK20_REG_FIELD_LIST(type) \\\n\ttype DENTIST_DPPCLK_WDIVIDER; \\\n\ttype DENTIST_DPPCLK_CHG_DONE; \\\n\ttype FbMult_int; \\\n\ttype FbMult_frac;\n\n#define VBIOS_SMU_REG_FIELD_LIST(type) \\\n\ttype CONTENT;\n\nstruct clk_mgr_shift {\n\tCLK_REG_FIELD_LIST(uint8_t)\n\tCLK20_REG_FIELD_LIST(uint8_t)\n\tVBIOS_SMU_REG_FIELD_LIST(uint32_t)\n};\n\nstruct clk_mgr_mask {\n\tCLK_REG_FIELD_LIST(uint32_t)\n\tCLK20_REG_FIELD_LIST(uint32_t)\n\tVBIOS_SMU_REG_FIELD_LIST(uint32_t)\n};\n\nstruct clk_mgr_registers {\n\tuint32_t DPREFCLK_CNTL;\n\tuint32_t DENTIST_DISPCLK_CNTL;\n\tuint32_t CLK4_CLK2_CURRENT_CNT;\n\tuint32_t CLK4_CLK_PLL_REQ;\n\n\tuint32_t CLK3_CLK2_DFS_CNTL;\n\tuint32_t CLK3_CLK_PLL_REQ;\n\n\tuint32_t CLK0_CLK2_DFS_CNTL;\n\tuint32_t CLK0_CLK_PLL_REQ;\n\n\tuint32_t CLK1_CLK_PLL_REQ;\n\tuint32_t CLK1_CLK0_DFS_CNTL;\n\tuint32_t CLK1_CLK1_DFS_CNTL;\n\tuint32_t CLK1_CLK2_DFS_CNTL;\n\tuint32_t CLK1_CLK3_DFS_CNTL;\n\tuint32_t CLK1_CLK4_DFS_CNTL;\n\n\tuint32_t CLK0_CLK0_DFS_CNTL;\n\tuint32_t CLK0_CLK1_DFS_CNTL;\n\tuint32_t CLK0_CLK3_DFS_CNTL;\n\tuint32_t CLK0_CLK4_DFS_CNTL;\n\n\tuint32_t MP1_SMN_C2PMSG_67;\n\tuint32_t MP1_SMN_C2PMSG_83;\n\tuint32_t MP1_SMN_C2PMSG_91;\n};\n\nenum clock_type {\n\tclock_type_dispclk = 1,\n\tclock_type_dcfclk,\n\tclock_type_socclk,\n\tclock_type_pixelclk,\n\tclock_type_phyclk,\n\tclock_type_dppclk,\n\tclock_type_fclk,\n\tclock_type_dcfdsclk,\n\tclock_type_dscclk,\n\tclock_type_uclk,\n\tclock_type_dramclk,\n};\n\n\nstruct state_dependent_clocks {\n\tint display_clk_khz;\n\tint pixel_clk_khz;\n};\n\nstruct clk_mgr_internal {\n\tstruct clk_mgr base;\n\tint smu_ver;\n\tstruct pp_smu_funcs *pp_smu;\n\tstruct clk_mgr_internal_funcs *funcs;\n\n\tstruct dccg *dccg;\n\n\t \n\tconst struct clk_mgr_registers *regs;\n\tconst struct clk_mgr_shift *clk_mgr_shift;\n\tconst struct clk_mgr_mask *clk_mgr_mask;\n\n\tstruct state_dependent_clocks max_clks_by_state[DM_PP_CLOCKS_MAX_STATES];\n\n\t \n\t \n\tbool dfs_bypass_enabled;\n\t \n\tbool dfs_bypass_active;\n\n\tuint32_t dfs_ref_freq_khz;\n\t \n\tint dfs_bypass_disp_clk;\n\n\t \n\tbool ss_on_dprefclk;\n\n\t \n\tbool xgmi_enabled;\n\n\t \n\tint dprefclk_ss_percentage;\n\n\t \n\tint dprefclk_ss_divider;\n\n\tenum dm_pp_clocks_state max_clks_state;\n\tenum dm_pp_clocks_state cur_min_clks_state;\n\tbool periodic_retraining_disabled;\n\n\tunsigned int cur_phyclk_req_table[MAX_PIPES * 2];\n\n\tbool smu_present;\n\tvoid *wm_range_table;\n\tlong long wm_range_table_addr;\n\n\tbool dpm_present;\n};\n\nstruct clk_mgr_internal_funcs {\n\tint (*set_dispclk)(struct clk_mgr_internal *clk_mgr, int requested_dispclk_khz);\n\tint (*set_dprefclk)(struct clk_mgr_internal *clk_mgr);\n};\n\n\n \n\n\nstatic inline bool should_set_clock(bool safe_to_lower, int calc_clk, int cur_clk)\n{\n\treturn ((safe_to_lower && calc_clk < cur_clk) || calc_clk > cur_clk);\n}\n\nstatic inline bool should_update_pstate_support(bool safe_to_lower, bool calc_support, bool cur_support)\n{\n\tif (cur_support != calc_support) {\n\t\tif (calc_support && safe_to_lower)\n\t\t\treturn true;\n\t\telse if (!calc_support && !safe_to_lower)\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nstatic inline int khz_to_mhz_ceil(int khz)\n{\n\treturn (khz + 999) / 1000;\n}\n\nint clk_mgr_helper_get_active_display_cnt(\n\t\tstruct dc *dc,\n\t\tstruct dc_state *context);\n\nint clk_mgr_helper_get_active_plane_cnt(\n\t\tstruct dc *dc,\n\t\tstruct dc_state *context);\n\n\n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}