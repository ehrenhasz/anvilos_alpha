{
  "module_name": "dcn201_hubp.c",
  "hash_id": "ef9dec16929fe5dbb032a905b3fd096261c6a563243b427e46738de9732636d8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn201/dcn201_hubp.c",
  "human_readable_source": " \n#include \"dcn201_hubp.h\"\n\n#include \"dm_services.h\"\n#include \"dce_calcs.h\"\n#include \"reg_helper.h\"\n#include \"basics/conversion.h\"\n\n#define REG(reg)\\\n\thubp201->hubp_regs->reg\n\n#define CTX \\\n\thubp201->base.ctx\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\thubp201->hubp_shift->field_name, hubp201->hubp_mask->field_name\n\nstatic void hubp201_program_surface_config(\n\tstruct hubp *hubp,\n\tenum surface_pixel_format format,\n\tunion dc_tiling_info *tiling_info,\n\tstruct plane_size *plane_size,\n\tenum dc_rotation_angle rotation,\n\tstruct dc_plane_dcc_param *dcc,\n\tbool horizontal_mirror,\n\tunsigned int compat_level)\n{\n\thubp1_dcc_control(hubp, dcc->enable, dcc->independent_64b_blks);\n\thubp1_program_tiling(hubp, tiling_info, format);\n\thubp1_program_size(hubp, format, plane_size, dcc);\n\thubp1_program_pixel_format(hubp, format);\n}\n\nstatic void hubp201_program_deadline(\n\t\tstruct hubp *hubp,\n\t\tstruct _vcs_dpi_display_dlg_regs_st *dlg_attr,\n\t\tstruct _vcs_dpi_display_ttu_regs_st *ttu_attr)\n{\n\thubp1_program_deadline(hubp, dlg_attr, ttu_attr);\n}\n\nstatic void hubp201_program_requestor(struct hubp *hubp,\n\t\t\t\t      struct _vcs_dpi_display_rq_regs_st *rq_regs)\n{\n\tstruct dcn201_hubp *hubp201 = TO_DCN201_HUBP(hubp);\n\n\tREG_UPDATE(HUBPRET_CONTROL,\n\t\t\tDET_BUF_PLANE1_BASE_ADDRESS, rq_regs->plane1_base_address);\n\n\tREG_SET_4(DCN_EXPANSION_MODE, 0,\n\t\t\tDRQ_EXPANSION_MODE, rq_regs->drq_expansion_mode,\n\t\t\tPRQ_EXPANSION_MODE, rq_regs->prq_expansion_mode,\n\t\t\tMRQ_EXPANSION_MODE, rq_regs->mrq_expansion_mode,\n\t\t\tCRQ_EXPANSION_MODE, rq_regs->crq_expansion_mode);\n\n\tREG_SET_5(DCHUBP_REQ_SIZE_CONFIG, 0,\n\t\tCHUNK_SIZE, rq_regs->rq_regs_l.chunk_size,\n\t\tMIN_CHUNK_SIZE, rq_regs->rq_regs_l.min_chunk_size,\n\t\tMETA_CHUNK_SIZE, rq_regs->rq_regs_l.meta_chunk_size,\n\t\tMIN_META_CHUNK_SIZE, rq_regs->rq_regs_l.min_meta_chunk_size,\n\t\tSWATH_HEIGHT, rq_regs->rq_regs_l.swath_height);\n\n\tREG_SET_5(DCHUBP_REQ_SIZE_CONFIG_C, 0,\n\t\tCHUNK_SIZE_C, rq_regs->rq_regs_c.chunk_size,\n\t\tMIN_CHUNK_SIZE_C, rq_regs->rq_regs_c.min_chunk_size,\n\t\tMETA_CHUNK_SIZE_C, rq_regs->rq_regs_c.meta_chunk_size,\n\t\tMIN_META_CHUNK_SIZE_C, rq_regs->rq_regs_c.min_meta_chunk_size,\n\t\tSWATH_HEIGHT_C, rq_regs->rq_regs_c.swath_height);\n}\n\nstatic void hubp201_setup(\n\t\tstruct hubp *hubp,\n\t\tstruct _vcs_dpi_display_dlg_regs_st *dlg_attr,\n\t\tstruct _vcs_dpi_display_ttu_regs_st *ttu_attr,\n\t\tstruct _vcs_dpi_display_rq_regs_st *rq_regs,\n\t\tstruct _vcs_dpi_display_pipe_dest_params_st *pipe_dest)\n{\n\thubp2_vready_at_or_After_vsync(hubp, pipe_dest);\n\thubp201_program_requestor(hubp, rq_regs);\n\thubp201_program_deadline(hubp, dlg_attr, ttu_attr);\n}\n\nstatic struct hubp_funcs dcn201_hubp_funcs = {\n\t.hubp_enable_tripleBuffer = hubp2_enable_triplebuffer,\n\t.hubp_is_triplebuffer_enabled = hubp2_is_triplebuffer_enabled,\n\t.hubp_program_surface_flip_and_addr = hubp1_program_surface_flip_and_addr,\n\t.hubp_program_surface_config = hubp201_program_surface_config,\n\t.hubp_is_flip_pending = hubp1_is_flip_pending,\n\t.hubp_setup = hubp201_setup,\n\t.hubp_setup_interdependent = hubp2_setup_interdependent,\n\t.set_cursor_attributes\t= hubp2_cursor_set_attributes,\n\t.set_cursor_position\t= hubp1_cursor_set_position,\n\t.set_blank = hubp1_set_blank,\n\t.dcc_control = hubp1_dcc_control,\n\t.mem_program_viewport = min_set_viewport,\n\t.hubp_clk_cntl = hubp1_clk_cntl,\n\t.hubp_vtg_sel = hubp1_vtg_sel,\n\t.dmdata_set_attributes = hubp2_dmdata_set_attributes,\n\t.dmdata_load = hubp2_dmdata_load,\n\t.dmdata_status_done = hubp2_dmdata_status_done,\n\t.hubp_read_state = hubp2_read_state,\n\t.hubp_clear_underflow = hubp1_clear_underflow,\n\t.hubp_set_flip_control_surface_gsl = hubp2_set_flip_control_surface_gsl,\n\t.hubp_init = hubp1_init,\n};\n\nbool dcn201_hubp_construct(\n\tstruct dcn201_hubp *hubp201,\n\tstruct dc_context *ctx,\n\tuint32_t inst,\n\tconst struct dcn201_hubp_registers *hubp_regs,\n\tconst struct dcn201_hubp_shift *hubp_shift,\n\tconst struct dcn201_hubp_mask *hubp_mask)\n{\n\thubp201->base.funcs = &dcn201_hubp_funcs;\n\thubp201->base.ctx = ctx;\n\thubp201->hubp_regs = hubp_regs;\n\thubp201->hubp_shift = hubp_shift;\n\thubp201->hubp_mask = hubp_mask;\n\thubp201->base.inst = inst;\n\thubp201->base.opp_id = OPP_ID_INVALID;\n\thubp201->base.mpcc_id = 0xf;\n\n\treturn true;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}