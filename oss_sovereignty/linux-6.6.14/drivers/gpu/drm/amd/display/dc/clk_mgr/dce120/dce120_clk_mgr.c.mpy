{
  "module_name": "dce120_clk_mgr.c",
  "hash_id": "21e186b82813d26b67d4468c6e401fa903294a0512a061a5a357ed557cca5054",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/clk_mgr/dce120/dce120_clk_mgr.c",
  "human_readable_source": " \n\n#include \"core_types.h\"\n#include \"clk_mgr_internal.h\"\n\n#include \"dce112/dce112_clk_mgr.h\"\n#include \"dce110/dce110_clk_mgr.h\"\n#include \"dce120_clk_mgr.h\"\n#include \"dce100/dce_clk_mgr.h\"\n#include \"dce120/dce120_hw_sequencer.h\"\n\nstatic const struct state_dependent_clocks dce120_max_clks_by_state[] = {\n \n{ .display_clk_khz = 0, .pixel_clk_khz = 0 },\n \n{ .display_clk_khz = 0, .pixel_clk_khz = 0 },\n \n{ .display_clk_khz = 460000, .pixel_clk_khz = 400000 },\n \n{ .display_clk_khz = 670000, .pixel_clk_khz = 600000 },\n \n{ .display_clk_khz = 1133000, .pixel_clk_khz = 600000 } };\n\n \nstatic void dce121_clock_patch_xgmi_ss_info(struct clk_mgr_internal *clk_mgr_dce)\n{\n\tenum bp_result result;\n\tstruct spread_spectrum_info info = { { 0 } };\n\tstruct dc_bios *bp = clk_mgr_dce->base.ctx->dc_bios;\n\n\tclk_mgr_dce->xgmi_enabled = false;\n\n\tresult = bp->funcs->get_spread_spectrum_info(bp, AS_SIGNAL_TYPE_XGMI,\n\t\t\t\t\t\t     0, &info);\n\tif (result == BP_RESULT_OK && info.spread_spectrum_percentage != 0) {\n\t\tclk_mgr_dce->xgmi_enabled = true;\n\t\tclk_mgr_dce->ss_on_dprefclk = true;\n\t\tclk_mgr_dce->dprefclk_ss_divider =\n\t\t\t\tinfo.spread_percentage_divider;\n\n\t\tif (info.type.CENTER_MODE == 0) {\n\t\t\t \n\t\t\tclk_mgr_dce->dprefclk_ss_percentage =\n\t\t\t\t\tinfo.spread_spectrum_percentage;\n\t\t}\n\t}\n}\n\nstatic void dce12_update_clocks(struct clk_mgr *clk_mgr_base,\n\t\t\tstruct dc_state *context,\n\t\t\tbool safe_to_lower)\n{\n\tstruct clk_mgr_internal *clk_mgr_dce = TO_CLK_MGR_INTERNAL(clk_mgr_base);\n\tstruct dm_pp_clock_for_voltage_req clock_voltage_req = {0};\n\tint max_pix_clk = dce_get_max_pixel_clock_for_all_paths(context);\n\tint patched_disp_clk = context->bw_ctx.bw.dce.dispclk_khz;\n\n\t \n\tif (!clk_mgr_dce->dfs_bypass_active)\n\t\tpatched_disp_clk = patched_disp_clk * 115 / 100;\n\n\tif (should_set_clock(safe_to_lower, patched_disp_clk, clk_mgr_base->clks.dispclk_khz)) {\n\t\tclock_voltage_req.clk_type = DM_PP_CLOCK_TYPE_DISPLAY_CLK;\n\t\t \n\t\tif (clk_mgr_dce->xgmi_enabled)\n\t\t\tpatched_disp_clk = dce_adjust_dp_ref_freq_for_ss(\n\t\t\t\t\tclk_mgr_dce, patched_disp_clk);\n\t\tclock_voltage_req.clocks_in_khz = patched_disp_clk;\n\t\tclk_mgr_base->clks.dispclk_khz = dce112_set_clock(clk_mgr_base, patched_disp_clk);\n\n\t\tdm_pp_apply_clock_for_voltage_request(clk_mgr_base->ctx, &clock_voltage_req);\n\t}\n\n\tif (should_set_clock(safe_to_lower, max_pix_clk, clk_mgr_base->clks.phyclk_khz)) {\n\t\tclock_voltage_req.clk_type = DM_PP_CLOCK_TYPE_DISPLAYPHYCLK;\n\t\tclock_voltage_req.clocks_in_khz = max_pix_clk;\n\t\tclk_mgr_base->clks.phyclk_khz = max_pix_clk;\n\n\t\tdm_pp_apply_clock_for_voltage_request(clk_mgr_base->ctx, &clock_voltage_req);\n\t}\n\tdce11_pplib_apply_display_requirements(clk_mgr_base->ctx->dc, context);\n}\n\n\nstatic struct clk_mgr_funcs dce120_funcs = {\n\t.get_dp_ref_clk_frequency = dce12_get_dp_ref_freq_khz,\n\t.update_clocks = dce12_update_clocks\n};\n\nvoid dce120_clk_mgr_construct(struct dc_context *ctx, struct clk_mgr_internal *clk_mgr)\n{\n\tdce_clk_mgr_construct(ctx, clk_mgr);\n\n\tmemcpy(clk_mgr->max_clks_by_state,\n\t\tdce120_max_clks_by_state,\n\t\tsizeof(dce120_max_clks_by_state));\n\n\tclk_mgr->base.dprefclk_khz = 600000;\n\tclk_mgr->base.funcs = &dce120_funcs;\n}\n\nvoid dce121_clk_mgr_construct(struct dc_context *ctx, struct clk_mgr_internal *clk_mgr)\n{\n\tdce120_clk_mgr_construct(ctx, clk_mgr);\n\tclk_mgr->base.dprefclk_khz = 625000;\n\n\t \n\tif (dce121_xgmi_enabled(ctx->dc->hwseq))\n\t\tdce121_clock_patch_xgmi_ss_info(clk_mgr);\n\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}