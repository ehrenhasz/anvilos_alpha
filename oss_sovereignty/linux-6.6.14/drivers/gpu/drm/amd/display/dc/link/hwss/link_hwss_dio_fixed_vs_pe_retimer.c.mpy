{
  "module_name": "link_hwss_dio_fixed_vs_pe_retimer.c",
  "hash_id": "27aa6cce94edba3c127eccb8cef0b8beede7cd0ba55ae8909ec6a0ada41f6d00",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio_fixed_vs_pe_retimer.c",
  "human_readable_source": " \n#include \"link_hwss_dio.h\"\n#include \"link_hwss_dio_fixed_vs_pe_retimer.h\"\n#include \"link_enc_cfg.h\"\n\nuint8_t dp_dio_fixed_vs_pe_retimer_lane_cfg_to_hw_cfg(struct dc_link *link)\n{\n\t\n\tif (link->cur_link_settings.lane_count == LANE_COUNT_FOUR)\n\t\treturn 0xF2;\n\telse\n\t\treturn 0x12;\n}\n\nvoid dp_dio_fixed_vs_pe_retimer_exit_manual_automation(struct dc_link *link)\n{\n\tconst uint8_t dp_type = dp_dio_fixed_vs_pe_retimer_lane_cfg_to_hw_cfg(link);\n\tconst uint8_t vendor_lttpr_exit_manual_automation_0[4] = {0x1, 0x11, 0x0, 0x06};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_1[4] = {0x1, 0x50, dp_type, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_2[4] = {0x1, 0x50, 0x50, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_3[4] = {0x1, 0x51, 0x50, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_4[4] = {0x1, 0x10, 0x58, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_5[4] = {0x1, 0x10, 0x59, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_6[4] = {0x1, 0x30, 0x51, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_7[4] = {0x1, 0x30, 0x52, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_8[4] = {0x1, 0x30, 0x54, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_9[4] = {0x1, 0x30, 0x55, 0x0};\n\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_0[0], sizeof(vendor_lttpr_exit_manual_automation_0));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_1[0], sizeof(vendor_lttpr_exit_manual_automation_1));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_2[0], sizeof(vendor_lttpr_exit_manual_automation_2));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_3[0], sizeof(vendor_lttpr_exit_manual_automation_3));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_4[0], sizeof(vendor_lttpr_exit_manual_automation_4));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_5[0], sizeof(vendor_lttpr_exit_manual_automation_5));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_6[0], sizeof(vendor_lttpr_exit_manual_automation_6));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_7[0], sizeof(vendor_lttpr_exit_manual_automation_7));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_8[0], sizeof(vendor_lttpr_exit_manual_automation_8));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_exit_manual_automation_9[0], sizeof(vendor_lttpr_exit_manual_automation_9));\n}\n\nstatic bool set_dio_fixed_vs_pe_retimer_dp_link_test_pattern_override(struct dc_link *link,\n\t\tconst struct link_resource *link_res, struct encoder_set_dp_phy_pattern_param *tp_params,\n\t\tconst struct link_hwss *link_hwss)\n{\n\tstruct encoder_set_dp_phy_pattern_param hw_tp_params = { 0 };\n\tconst uint8_t pltpat_custom[10] = {0x1F, 0x7C, 0xF0, 0xC1, 0x07, 0x1F, 0x7C, 0xF0, 0xC1, 0x07};\n\tconst uint8_t vendor_lttpr_write_data_pg0[4] = {0x1, 0x11, 0x0, 0x0};\n\tconst uint8_t vendor_lttpr_exit_manual_automation_0[4] = {0x1, 0x11, 0x0, 0x06};\n\n\n\tif (tp_params == NULL)\n\t\treturn false;\n\n\tif (link->current_test_pattern >= DP_TEST_PATTERN_SQUARE_BEGIN &&\n\t\t\tlink->current_test_pattern <= DP_TEST_PATTERN_SQUARE_END) {\n\t\t\n\t\tdp_dio_fixed_vs_pe_retimer_exit_manual_automation(link);\n\t}\n\n\tswitch (tp_params->dp_phy_pattern) {\n\tcase DP_TEST_PATTERN_80BIT_CUSTOM:\n\t\tif (tp_params->custom_pattern_size == 0 || memcmp(tp_params->custom_pattern,\n\t\t\t\tpltpat_custom, tp_params->custom_pattern_size) != 0)\n\t\t\treturn false;\n\t\tbreak;\n\tcase DP_TEST_PATTERN_D102:\n\t\tbreak;\n\tdefault:\n\t\tif (link->current_test_pattern == DP_TEST_PATTERN_80BIT_CUSTOM ||\n\t\t\t\tlink->current_test_pattern == DP_TEST_PATTERN_D102)\n\t\t\t\n\t\t\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t\t\t&vendor_lttpr_exit_manual_automation_0[0],\n\t\t\t\t\tsizeof(vendor_lttpr_exit_manual_automation_0));\n\n\t\treturn false;\n\t}\n\n\thw_tp_params.dp_phy_pattern = tp_params->dp_phy_pattern;\n\thw_tp_params.dp_panel_mode = tp_params->dp_panel_mode;\n\n\tif (link_hwss->ext.set_dp_link_test_pattern)\n\t\tlink_hwss->ext.set_dp_link_test_pattern(link, link_res, &hw_tp_params);\n\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_write_data_pg0[0], sizeof(vendor_lttpr_write_data_pg0));\n\n\treturn true;\n}\n\nstatic void set_dio_fixed_vs_pe_retimer_dp_link_test_pattern(struct dc_link *link,\n\t\tconst struct link_resource *link_res,\n\t\tstruct encoder_set_dp_phy_pattern_param *tp_params)\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(link);\n\n\tif (!set_dio_fixed_vs_pe_retimer_dp_link_test_pattern_override(\n\t\t\tlink, link_res, tp_params, get_dio_link_hwss())) {\n\t\tlink_enc->funcs->dp_set_phy_pattern(link_enc, tp_params);\n\t}\n\tlink->dc->link_srv->dp_trace_source_sequence(link, DPCD_SOURCE_SEQ_AFTER_SET_SOURCE_PATTERN);\n}\n\nvoid enable_dio_fixed_vs_pe_retimer_program_4lane_output(struct dc_link *link)\n{\n\tconst uint8_t vendor_lttpr_write_data_4lane_1[4] = {0x1, 0x6E, 0xF2, 0x19};\n\tconst uint8_t vendor_lttpr_write_data_4lane_2[4] = {0x1, 0x6B, 0xF2, 0x01};\n\tconst uint8_t vendor_lttpr_write_data_4lane_3[4] = {0x1, 0x6D, 0xF2, 0x18};\n\tconst uint8_t vendor_lttpr_write_data_4lane_4[4] = {0x1, 0x6C, 0xF2, 0x03};\n\tconst uint8_t vendor_lttpr_write_data_4lane_5[4] = {0x1, 0x03, 0xF3, 0x06};\n\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_write_data_4lane_1[0], sizeof(vendor_lttpr_write_data_4lane_1));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_write_data_4lane_2[0], sizeof(vendor_lttpr_write_data_4lane_2));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_write_data_4lane_3[0], sizeof(vendor_lttpr_write_data_4lane_3));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_write_data_4lane_4[0], sizeof(vendor_lttpr_write_data_4lane_4));\n\tlink->dc->link_srv->configure_fixed_vs_pe_retimer(link->ddc,\n\t\t\t&vendor_lttpr_write_data_4lane_5[0], sizeof(vendor_lttpr_write_data_4lane_5));\n}\n\nstatic void enable_dio_fixed_vs_pe_retimer_dp_link_output(struct dc_link *link,\n\t\tconst struct link_resource *link_res,\n\t\tenum signal_type signal,\n\t\tenum clock_source_id clock_source,\n\t\tconst struct dc_link_settings *link_settings)\n{\n\tif (link_settings->lane_count == LANE_COUNT_FOUR)\n\t\tenable_dio_fixed_vs_pe_retimer_program_4lane_output(link);\n\n\tenable_dio_dp_link_output(link, link_res, signal, clock_source, link_settings);\n}\n\nstatic const struct link_hwss dio_fixed_vs_pe_retimer_link_hwss = {\n\t.setup_stream_encoder = setup_dio_stream_encoder,\n\t.reset_stream_encoder = reset_dio_stream_encoder,\n\t.setup_stream_attribute = setup_dio_stream_attribute,\n\t.disable_link_output = disable_dio_link_output,\n\t.setup_audio_output = setup_dio_audio_output,\n\t.enable_audio_packet = enable_dio_audio_packet,\n\t.disable_audio_packet = disable_dio_audio_packet,\n\t.ext = {\n\t\t.set_throttled_vcp_size = set_dio_throttled_vcp_size,\n\t\t.enable_dp_link_output = enable_dio_fixed_vs_pe_retimer_dp_link_output,\n\t\t.set_dp_link_test_pattern = set_dio_fixed_vs_pe_retimer_dp_link_test_pattern,\n\t\t.set_dp_lane_settings = set_dio_dp_lane_settings,\n\t\t.update_stream_allocation_table = update_dio_stream_allocation_table,\n\t},\n};\n\nbool requires_fixed_vs_pe_retimer_dio_link_hwss(const struct dc_link *link)\n{\n\tif (!(link->chip_caps & EXT_DISPLAY_PATH_CAPS__DP_FIXED_VS_EN))\n\t\treturn false;\n\n\tif (!link->dpcd_caps.lttpr_caps.main_link_channel_coding.bits.DP_128b_132b_SUPPORTED)\n\t\treturn false;\n\n\treturn true;\n}\n\nconst struct link_hwss *get_dio_fixed_vs_pe_retimer_link_hwss(void)\n{\n\treturn &dio_fixed_vs_pe_retimer_link_hwss;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}