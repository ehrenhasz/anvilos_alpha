{
  "module_name": "dcn32_dpp.c",
  "hash_id": "f555de44a8010395223b8b01eea88f462b3f20e57ec2e2d40ec6a547a4125f30",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn32/dcn32_dpp.c",
  "human_readable_source": " \n\n#include \"dm_services.h\"\n#include \"core_types.h\"\n#include \"reg_helper.h\"\n#include \"dcn32_dpp.h\"\n#include \"basics/conversion.h\"\n#include \"dcn30/dcn30_cm_common.h\"\n\n \nstatic void dscl32_calc_lb_num_partitions(\n\t\tconst struct scaler_data *scl_data,\n\t\tenum lb_memory_config lb_config,\n\t\tint *num_part_y,\n\t\tint *num_part_c)\n{\n\tint memory_line_size_y, memory_line_size_c, memory_line_size_a,\n\tlb_memory_size, lb_memory_size_c, lb_memory_size_a, num_partitions_a;\n\n\tint line_size = scl_data->viewport.width < scl_data->recout.width ?\n\t\t\tscl_data->viewport.width : scl_data->recout.width;\n\tint line_size_c = scl_data->viewport_c.width < scl_data->recout.width ?\n\t\t\tscl_data->viewport_c.width : scl_data->recout.width;\n\n\tif (line_size == 0)\n\t\tline_size = 1;\n\n\tif (line_size_c == 0)\n\t\tline_size_c = 1;\n\n\tmemory_line_size_y = (line_size + 5) / 6;  \n\tmemory_line_size_c = (line_size_c + 5) / 6;  \n\tmemory_line_size_a = (line_size + 5) / 6;  \n\n\tif (lb_config == LB_MEMORY_CONFIG_1) {\n\t\tlb_memory_size = 970;\n\t\tlb_memory_size_c = 970;\n\t\tlb_memory_size_a = 970;\n\t} else if (lb_config == LB_MEMORY_CONFIG_2) {\n\t\tlb_memory_size = 1290;\n\t\tlb_memory_size_c = 1290;\n\t\tlb_memory_size_a = 1290;\n\t} else if (lb_config == LB_MEMORY_CONFIG_3) {\n\t\tif (scl_data->viewport.width  == scl_data->h_active &&\n\t\t\tscl_data->viewport.height == scl_data->v_active) {\n\t\t\t \n\t\t\t \n\t\t\tlb_memory_size = 970 + 1290 + 1170 + 1170 + 1170;\n\t\t\tlb_memory_size_c = 970 + 1290;\n\t\t\tlb_memory_size_a = 970 + 1290 + 1170;\n\t\t} else {\n\t\t\t \n\t\t\tlb_memory_size = 970 + 1290 + 484 + 484 + 484;\n\t\t\tlb_memory_size_c = 970 + 1290;\n\t\t\tlb_memory_size_a = 970 + 1290 + 484;\n\t\t}\n\t} else {\n\t\tif (scl_data->viewport.width  == scl_data->h_active &&\n\t\t\tscl_data->viewport.height == scl_data->v_active) {\n\t\t\t \n\t\t\tlb_memory_size = 970 + 1290 + 1170;\n\t\t\tlb_memory_size_c = 970 + 1290 + 1170;\n\t\t\tlb_memory_size_a = 970 + 1290 + 1170;\n\t\t} else {\n\t\t\tlb_memory_size = 970 + 1290 + 484;\n\t\t\tlb_memory_size_c = 970 + 1290 + 484;\n\t\t\tlb_memory_size_a = 970 + 1290 + 484;\n\t\t}\n\t}\n\t*num_part_y = lb_memory_size / memory_line_size_y;\n\t*num_part_c = lb_memory_size_c / memory_line_size_c;\n\tnum_partitions_a = lb_memory_size_a / memory_line_size_a;\n\n\tif (scl_data->lb_params.alpha_en\n\t\t\t&& (num_partitions_a < *num_part_y))\n\t\t*num_part_y = num_partitions_a;\n\n\tif (*num_part_y > 32)\n\t\t*num_part_y = 32;\n\tif (*num_part_c > 32)\n\t\t*num_part_c = 32;\n}\n\nstatic struct dpp_funcs dcn32_dpp_funcs = {\n\t.dpp_program_gamcor_lut\t\t= dpp3_program_gamcor_lut,\n\t.dpp_read_state\t\t\t\t= dpp30_read_state,\n\t.dpp_reset\t\t\t\t\t= dpp_reset,\n\t.dpp_set_scaler\t\t\t\t= dpp1_dscl_set_scaler_manual_scale,\n\t.dpp_get_optimal_number_of_taps\t= dpp3_get_optimal_number_of_taps,\n\t.dpp_set_gamut_remap\t\t= dpp3_cm_set_gamut_remap,\n\t.dpp_set_csc_adjustment\t\t= NULL,\n\t.dpp_set_csc_default\t\t= NULL,\n\t.dpp_program_regamma_pwl\t= NULL,\n\t.dpp_set_pre_degam\t\t\t= dpp3_set_pre_degam,\n\t.dpp_program_input_lut\t\t= NULL,\n\t.dpp_full_bypass\t\t\t= dpp1_full_bypass,\n\t.dpp_setup\t\t\t\t\t= dpp3_cnv_setup,\n\t.dpp_program_degamma_pwl\t= NULL,\n\t.dpp_program_cm_dealpha\t\t= dpp3_program_cm_dealpha,\n\t.dpp_program_cm_bias\t\t= dpp3_program_cm_bias,\n\n\t.dpp_program_blnd_lut\t\t= NULL, \n\t.dpp_program_shaper_lut\t\t= NULL, \n\t.dpp_program_3dlut\t\t\t= NULL, \n\n\t.dpp_program_bias_and_scale\t= NULL,\n\t.dpp_cnv_set_alpha_keyer\t= dpp2_cnv_set_alpha_keyer,\n\t.set_cursor_attributes\t\t= dpp3_set_cursor_attributes,\n\t.set_cursor_position\t\t= dpp1_set_cursor_position,\n\t.set_optional_cursor_attributes\t= dpp1_cnv_set_optional_cursor_attributes,\n\t.dpp_dppclk_control\t\t\t= dpp1_dppclk_control,\n\t.dpp_set_hdr_multiplier\t\t= dpp3_set_hdr_multiplier,\n};\n\n\nstatic struct dpp_caps dcn32_dpp_cap = {\n\t.dscl_data_proc_format = DSCL_DATA_PRCESSING_FLOAT_FORMAT,\n\t.max_lb_partitions = 31,\n\t.dscl_calc_lb_num_partitions = dscl32_calc_lb_num_partitions,\n};\n\nbool dpp32_construct(\n\tstruct dcn3_dpp *dpp,\n\tstruct dc_context *ctx,\n\tuint32_t inst,\n\tconst struct dcn3_dpp_registers *tf_regs,\n\tconst struct dcn3_dpp_shift *tf_shift,\n\tconst struct dcn3_dpp_mask *tf_mask)\n{\n\tdpp->base.ctx = ctx;\n\n\tdpp->base.inst = inst;\n\tdpp->base.funcs = &dcn32_dpp_funcs;\n\tdpp->base.caps = &dcn32_dpp_cap;\n\n\tdpp->tf_regs = tf_regs;\n\tdpp->tf_shift = tf_shift;\n\tdpp->tf_mask = tf_mask;\n\n\treturn true;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}