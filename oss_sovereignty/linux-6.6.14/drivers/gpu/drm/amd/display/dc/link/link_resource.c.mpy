{
  "module_name": "link_resource.c",
  "hash_id": "020ddbac5ca72a9455f90e65e48d85fdde1543e8e893e3d165209c8050bf3f67",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/link/link_resource.c",
  "human_readable_source": " \n \n\n#include \"link_resource.h\"\n#include \"protocols/link_dp_capability.h\"\n\nvoid link_get_cur_link_res(const struct dc_link *link,\n\t\tstruct link_resource *link_res)\n{\n\tint i;\n\tstruct pipe_ctx *pipe = NULL;\n\n\tmemset(link_res, 0, sizeof(*link_res));\n\n\tfor (i = 0; i < MAX_PIPES; i++) {\n\t\tpipe = &link->dc->current_state->res_ctx.pipe_ctx[i];\n\t\tif (pipe->stream && pipe->stream->link && pipe->top_pipe == NULL) {\n\t\t\tif (pipe->stream->link == link) {\n\t\t\t\t*link_res = pipe->link_res;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n}\n\nvoid link_get_cur_res_map(const struct dc *dc, uint32_t *map)\n{\n\tstruct dc_link *link;\n\tuint32_t i;\n\tuint32_t hpo_dp_recycle_map = 0;\n\n\t*map = 0;\n\n\tif (dc->caps.dp_hpo) {\n\t\tfor (i = 0; i < dc->caps.max_links; i++) {\n\t\t\tlink = dc->links[i];\n\t\t\tif (link->link_status.link_active &&\n\t\t\t\t\tlink_dp_get_encoding_format(&link->reported_link_cap) == DP_128b_132b_ENCODING &&\n\t\t\t\t\tlink_dp_get_encoding_format(&link->cur_link_settings) != DP_128b_132b_ENCODING)\n\t\t\t\t \n\t\t\t\thpo_dp_recycle_map |= (1 << i);\n\t\t}\n\t\t*map |= (hpo_dp_recycle_map << LINK_RES_HPO_DP_REC_MAP__SHIFT);\n\t}\n}\n\nvoid link_restore_res_map(const struct dc *dc, uint32_t *map)\n{\n\tstruct dc_link *link;\n\tuint32_t i;\n\tunsigned int available_hpo_dp_count;\n\tuint32_t hpo_dp_recycle_map = (*map & LINK_RES_HPO_DP_REC_MAP__MASK)\n\t\t\t>> LINK_RES_HPO_DP_REC_MAP__SHIFT;\n\n\tif (dc->caps.dp_hpo) {\n\t\tavailable_hpo_dp_count = dc->res_pool->hpo_dp_link_enc_count;\n\t\t \n\t\tfor (i = 0; i < dc->caps.max_links; i++) {\n\t\t\tif ((hpo_dp_recycle_map & (1 << i)) == 0) {\n\t\t\t\tlink = dc->links[i];\n\t\t\t\tif (link->type != dc_connection_none &&\n\t\t\t\t\t\tlink_dp_get_encoding_format(&link->verified_link_cap) == DP_128b_132b_ENCODING) {\n\t\t\t\t\tif (available_hpo_dp_count > 0)\n\t\t\t\t\t\tavailable_hpo_dp_count--;\n\t\t\t\t\telse\n\t\t\t\t\t\t \n\t\t\t\t\t\tlink->verified_link_cap.link_rate = LINK_RATE_HIGH3;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t \n\t\tfor (i = 0; i < dc->caps.max_links; i++) {\n\t\t\tif ((hpo_dp_recycle_map & (1 << i)) != 0) {\n\t\t\t\tlink = dc->links[i];\n\t\t\t\tif (link->type != dc_connection_none &&\n\t\t\t\t\t\tlink_dp_get_encoding_format(&link->verified_link_cap) == DP_128b_132b_ENCODING) {\n\t\t\t\t\tif (available_hpo_dp_count > 0)\n\t\t\t\t\t\tavailable_hpo_dp_count--;\n\t\t\t\t\telse\n\t\t\t\t\t\t \n\t\t\t\t\t\tlink->verified_link_cap.link_rate = LINK_RATE_HIGH3;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}