{
  "module_name": "hw_factory_dcn21.c",
  "hash_id": "322c2006d9a85e789ec270fafceee8e6eacfb3a159d3010ff40331c97ecd9f93",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/gpio/dcn21/hw_factory_dcn21.c",
  "human_readable_source": " \n#include \"dm_services.h\"\n#include \"include/gpio_types.h\"\n#include \"../hw_factory.h\"\n\n\n#include \"../hw_gpio.h\"\n#include \"../hw_ddc.h\"\n#include \"../hw_hpd.h\"\n#include \"../hw_generic.h\"\n\n#include \"hw_factory_dcn21.h\"\n\n#include \"dcn/dcn_2_1_0_offset.h\"\n#include \"dcn/dcn_2_1_0_sh_mask.h\"\n#include \"renoir_ip_offset.h\"\n\n#include \"reg_helper.h\"\n#include \"../hpd_regs.h\"\n \n\n \n#define block HPD\n#define reg_num 0\n\n#undef BASE_INNER\n#define BASE_INNER(seg) DMU_BASE__INST0_SEG ## seg\n\n#define BASE(seg) BASE_INNER(seg)\n\n\n\n#define REG(reg_name)\\\n\t\tBASE(mm ## reg_name ## _BASE_IDX) + mm ## reg_name\n\n#define SF_HPD(reg_name, field_name, post_fix)\\\n\t.field_name = HPD0_ ## reg_name ## __ ## field_name ## post_fix\n\n#define REGI(reg_name, block, id)\\\n\tBASE(mm ## block ## id ## _ ## reg_name ## _BASE_IDX) + \\\n\t\t\t\tmm ## block ## id ## _ ## reg_name\n\n#define SF(reg_name, field_name, post_fix)\\\n\t.field_name = reg_name ## __ ## field_name ## post_fix\n\n \n\n\n\n#define hpd_regs(id) \\\n{\\\n\tHPD_REG_LIST(id)\\\n}\n\nstatic const struct hpd_registers hpd_regs[] = {\n\thpd_regs(0),\n\thpd_regs(1),\n\thpd_regs(2),\n\thpd_regs(3),\n\thpd_regs(4),\n};\n\nstatic const struct hpd_sh_mask hpd_shift = {\n\t\tHPD_MASK_SH_LIST(__SHIFT)\n};\n\nstatic const struct hpd_sh_mask hpd_mask = {\n\t\tHPD_MASK_SH_LIST(_MASK)\n};\n\n#include \"../ddc_regs.h\"\n\n  \n#define SF_DDC(reg_name, field_name, post_fix)\\\n\t.field_name = reg_name ## __ ## field_name ## post_fix\n\nstatic const struct ddc_registers ddc_data_regs_dcn[] = {\n\tddc_data_regs_dcn2(1),\n\tddc_data_regs_dcn2(2),\n\tddc_data_regs_dcn2(3),\n\tddc_data_regs_dcn2(4),\n\tddc_data_regs_dcn2(5),\n};\n\nstatic const struct ddc_registers ddc_clk_regs_dcn[] = {\n\tddc_clk_regs_dcn2(1),\n\tddc_clk_regs_dcn2(2),\n\tddc_clk_regs_dcn2(3),\n\tddc_clk_regs_dcn2(4),\n\tddc_clk_regs_dcn2(5),\n};\n\nstatic const struct ddc_sh_mask ddc_shift[] = {\n\tDDC_MASK_SH_LIST_DCN2(__SHIFT, 1),\n\tDDC_MASK_SH_LIST_DCN2(__SHIFT, 2),\n\tDDC_MASK_SH_LIST_DCN2(__SHIFT, 3),\n\tDDC_MASK_SH_LIST_DCN2(__SHIFT, 4),\n\tDDC_MASK_SH_LIST_DCN2(__SHIFT, 5),\n\tDDC_MASK_SH_LIST_DCN2(__SHIFT, 6)\n};\n\nstatic const struct ddc_sh_mask ddc_mask[] = {\n\tDDC_MASK_SH_LIST_DCN2(_MASK, 1),\n\tDDC_MASK_SH_LIST_DCN2(_MASK, 2),\n\tDDC_MASK_SH_LIST_DCN2(_MASK, 3),\n\tDDC_MASK_SH_LIST_DCN2(_MASK, 4),\n\tDDC_MASK_SH_LIST_DCN2(_MASK, 5),\n\tDDC_MASK_SH_LIST_DCN2(_MASK, 6)\n};\n\n#include \"../generic_regs.h\"\n\n \n#define SF_GENERIC(reg_name, field_name, post_fix)\\\n\t.field_name = reg_name ## __ ## field_name ## post_fix\n\n#define generic_regs(id) \\\n{\\\n\tGENERIC_REG_LIST(id)\\\n}\n\nstatic const struct generic_registers generic_regs[] = {\n\tgeneric_regs(A),\n};\n\nstatic const struct generic_sh_mask generic_shift[] = {\n\tGENERIC_MASK_SH_LIST(__SHIFT, A),\n};\n\nstatic const struct generic_sh_mask generic_mask[] = {\n\tGENERIC_MASK_SH_LIST(_MASK, A),\n};\n\nstatic void define_generic_registers(struct hw_gpio_pin *pin, uint32_t en)\n{\n\tstruct hw_generic *generic = HW_GENERIC_FROM_BASE(pin);\n\n\tgeneric->regs = &generic_regs[en];\n\tgeneric->shifts = &generic_shift[en];\n\tgeneric->masks = &generic_mask[en];\n\tgeneric->base.regs = &generic_regs[en].gpio;\n}\n\nstatic void define_ddc_registers(\n\t\tstruct hw_gpio_pin *pin,\n\t\tuint32_t en)\n{\n\tstruct hw_ddc *ddc = HW_DDC_FROM_BASE(pin);\n\n\tswitch (pin->id) {\n\tcase GPIO_ID_DDC_DATA:\n\t\tddc->regs = &ddc_data_regs_dcn[en];\n\t\tddc->base.regs = &ddc_data_regs_dcn[en].gpio;\n\t\tbreak;\n\tcase GPIO_ID_DDC_CLOCK:\n\t\tddc->regs = &ddc_clk_regs_dcn[en];\n\t\tddc->base.regs = &ddc_clk_regs_dcn[en].gpio;\n\t\tbreak;\n\tdefault:\n\t\tASSERT_CRITICAL(false);\n\t\treturn;\n\t}\n\n\tddc->shifts = &ddc_shift[en];\n\tddc->masks = &ddc_mask[en];\n\n}\n\nstatic void define_hpd_registers(struct hw_gpio_pin *pin, uint32_t en)\n{\n\tstruct hw_hpd *hpd = HW_HPD_FROM_BASE(pin);\n\n\thpd->regs = &hpd_regs[en];\n\thpd->shifts = &hpd_shift;\n\thpd->masks = &hpd_mask;\n\thpd->base.regs = &hpd_regs[en].gpio;\n}\n\n\n \nstatic const struct hw_factory_funcs funcs = {\n\t.init_ddc_data = dal_hw_ddc_init,\n\t.init_generic = dal_hw_generic_init,\n\t.init_hpd = dal_hw_hpd_init,\n\t.get_ddc_pin = dal_hw_ddc_get_pin,\n\t.get_hpd_pin = dal_hw_hpd_get_pin,\n\t.get_generic_pin = dal_hw_generic_get_pin,\n\t.define_hpd_registers = define_hpd_registers,\n\t.define_ddc_registers = define_ddc_registers,\n\t.define_generic_registers = define_generic_registers\n};\n \nvoid dal_hw_factory_dcn21_init(struct hw_factory *factory)\n{\n\t \n\tfactory->number_of_pins[GPIO_ID_DDC_DATA] = 8;\n\tfactory->number_of_pins[GPIO_ID_DDC_CLOCK] = 8;\n\tfactory->number_of_pins[GPIO_ID_GENERIC] = 4;\n\tfactory->number_of_pins[GPIO_ID_HPD] = 6;\n\tfactory->number_of_pins[GPIO_ID_GPIO_PAD] = 28;\n\tfactory->number_of_pins[GPIO_ID_VIP_PAD] = 0;\n\tfactory->number_of_pins[GPIO_ID_SYNC] = 0;\n\tfactory->number_of_pins[GPIO_ID_GSL] = 0; \n\n\tfactory->funcs = &funcs;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}