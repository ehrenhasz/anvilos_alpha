{
  "module_name": "dcn32_mmhubbub.c",
  "hash_id": "3467547e158ec12726d3f235e36bd344a2ec86d5d12bbe24703eda779eaa8096",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn32/dcn32_mmhubbub.c",
  "human_readable_source": " \n\n\n#include \"reg_helper.h\"\n#include \"resource.h\"\n#include \"mcif_wb.h\"\n#include \"dcn32_mmhubbub.h\"\n\n\n#define REG(reg)\\\n\tmcif_wb30->mcif_wb_regs->reg\n\n#define CTX \\\n\tmcif_wb30->base.ctx\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\tmcif_wb30->mcif_wb_shift->field_name, mcif_wb30->mcif_wb_mask->field_name\n\n#define MCIF_ADDR(addr) (((unsigned long long)addr & 0xffffffffff) + 0xFE) >> 8\n#define MCIF_ADDR_HIGH(addr) (unsigned long long)addr >> 40\n\n \n\nstatic void mmhubbub32_warmup_mcif(struct mcif_wb *mcif_wb,\n\t\tstruct mcif_warmup_params *params)\n{\n\tstruct dcn30_mmhubbub *mcif_wb30 = TO_DCN30_MMHUBBUB(mcif_wb);\n\tunion large_integer start_address_shift = {.quad_part = params->start_address.quad_part >> 5};\n\n\t \n\tREG_SET(MMHUBBUB_WARMUP_BASE_ADDR_HIGH, 0, MMHUBBUB_WARMUP_BASE_ADDR_HIGH, start_address_shift.high_part);\n\tREG_SET(MMHUBBUB_WARMUP_BASE_ADDR_LOW, 0, MMHUBBUB_WARMUP_BASE_ADDR_LOW, start_address_shift.low_part);\n\tREG_SET(MMHUBBUB_WARMUP_ADDR_REGION, 0, MMHUBBUB_WARMUP_ADDR_REGION, params->region_size >> 5);\n\n\n\t \n\tREG_SET_3(MMHUBBUB_WARMUP_CONTROL_STATUS, 0, MMHUBBUB_WARMUP_EN, true,\n\t\t\tMMHUBBUB_WARMUP_SW_INT_EN, true,\n\t\t\tMMHUBBUB_WARMUP_INC_ADDR, params->address_increment >> 5);\n\n\t \n\tREG_WAIT(MMHUBBUB_WARMUP_CONTROL_STATUS, MMHUBBUB_WARMUP_SW_INT_STATUS, 1, 20, 100);\n\n\t \n\tREG_UPDATE(MMHUBBUB_WARMUP_CONTROL_STATUS, MMHUBBUB_WARMUP_SW_INT_ACK, 1);\n\n\t \n\tREG_UPDATE(MMHUBBUB_WARMUP_CONTROL_STATUS, MMHUBBUB_WARMUP_EN, false);\n}\n\nstatic void mmhubbub32_config_mcif_buf(struct mcif_wb *mcif_wb,\n\t\tstruct mcif_buf_params *params,\n\t\tunsigned int dest_height)\n{\n\tstruct dcn30_mmhubbub *mcif_wb30 = TO_DCN30_MMHUBBUB(mcif_wb);\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_1_ADDR_Y, MCIF_WB_BUF_1_ADDR_Y, MCIF_ADDR(params->luma_address[0]));\n\tREG_UPDATE(MCIF_WB_BUF_1_ADDR_Y_HIGH, MCIF_WB_BUF_1_ADDR_Y_HIGH, MCIF_ADDR_HIGH(params->luma_address[0]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_1_ADDR_C, MCIF_WB_BUF_1_ADDR_C, MCIF_ADDR(params->chroma_address[0]));\n\tREG_UPDATE(MCIF_WB_BUF_1_ADDR_C_HIGH, MCIF_WB_BUF_1_ADDR_C_HIGH, MCIF_ADDR_HIGH(params->chroma_address[0]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_2_ADDR_Y, MCIF_WB_BUF_2_ADDR_Y, MCIF_ADDR(params->luma_address[1]));\n\tREG_UPDATE(MCIF_WB_BUF_2_ADDR_Y_HIGH, MCIF_WB_BUF_2_ADDR_Y_HIGH, MCIF_ADDR_HIGH(params->luma_address[1]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_2_ADDR_C, MCIF_WB_BUF_2_ADDR_C, MCIF_ADDR(params->chroma_address[1]));\n\tREG_UPDATE(MCIF_WB_BUF_2_ADDR_C_HIGH, MCIF_WB_BUF_2_ADDR_C_HIGH, MCIF_ADDR_HIGH(params->chroma_address[1]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_3_ADDR_Y, MCIF_WB_BUF_3_ADDR_Y, MCIF_ADDR(params->luma_address[2]));\n\tREG_UPDATE(MCIF_WB_BUF_3_ADDR_Y_HIGH, MCIF_WB_BUF_3_ADDR_Y_HIGH, MCIF_ADDR_HIGH(params->luma_address[2]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_3_ADDR_C, MCIF_WB_BUF_3_ADDR_C, MCIF_ADDR(params->chroma_address[2]));\n\tREG_UPDATE(MCIF_WB_BUF_3_ADDR_C_HIGH, MCIF_WB_BUF_3_ADDR_C_HIGH, MCIF_ADDR_HIGH(params->chroma_address[2]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_4_ADDR_Y, MCIF_WB_BUF_4_ADDR_Y, MCIF_ADDR(params->luma_address[3]));\n\tREG_UPDATE(MCIF_WB_BUF_4_ADDR_Y_HIGH, MCIF_WB_BUF_4_ADDR_Y_HIGH, MCIF_ADDR_HIGH(params->luma_address[3]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_4_ADDR_C, MCIF_WB_BUF_4_ADDR_C, MCIF_ADDR(params->chroma_address[3]));\n\tREG_UPDATE(MCIF_WB_BUF_4_ADDR_C_HIGH, MCIF_WB_BUF_4_ADDR_C_HIGH, MCIF_ADDR_HIGH(params->chroma_address[3]));\n\n\t \n\tREG_UPDATE(MCIF_WB_BUF_LUMA_SIZE, MCIF_WB_BUF_LUMA_SIZE, (params->luma_pitch>>8) * dest_height);\n\tREG_UPDATE(MCIF_WB_BUF_CHROMA_SIZE, MCIF_WB_BUF_CHROMA_SIZE, (params->chroma_pitch>>8) * dest_height);\n\n\t \n\tREG_UPDATE(MCIF_WB_BUFMGR_SW_CONTROL, MCIF_WB_BUF_ADDR_FENCE_EN, 1);\n\n\t \n\tREG_UPDATE_2(MCIF_WB_BUF_PITCH, MCIF_WB_BUF_LUMA_PITCH, params->luma_pitch >> 8,\n\t\t\tMCIF_WB_BUF_CHROMA_PITCH, params->chroma_pitch >> 8);\n}\n\nstatic void mmhubbub32_config_mcif_arb(struct mcif_wb *mcif_wb,\n\t\tstruct mcif_arb_params *params)\n{\n\tstruct dcn30_mmhubbub *mcif_wb30 = TO_DCN30_MMHUBBUB(mcif_wb);\n\n\t \n\tREG_UPDATE(MCIF_WB_ARBITRATION_CONTROL, MCIF_WB_TIME_PER_PIXEL, params->time_per_pixel);\n\n\t \n\t \n\t \n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK_MASK, 0x0);\n\t \n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK,  params->cli_watermark[0]);\n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK_MASK, 0x1);\n\t \n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK,  params->cli_watermark[1]);\n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK_MASK, 0x2);\n\t \n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK,  params->cli_watermark[2]);\n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK_MASK, 0x3);\n\t \n\tREG_UPDATE(MCIF_WB_WATERMARK, MCIF_WB_CLI_WATERMARK,  params->cli_watermark[3]);\n\n\t \n\t \n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK, NB_PSTATE_CHANGE_WATERMARK_MASK, 0x0);\n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK,\n\t\t\tNB_PSTATE_CHANGE_REFRESH_WATERMARK, params->pstate_watermark[0]);\n\t \n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK, NB_PSTATE_CHANGE_WATERMARK_MASK, 0x1);\n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK,\n\t\t\tNB_PSTATE_CHANGE_REFRESH_WATERMARK, params->pstate_watermark[1]);\n\t \n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK, NB_PSTATE_CHANGE_WATERMARK_MASK, 0x2);\n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK,\n\t\t\tNB_PSTATE_CHANGE_REFRESH_WATERMARK, params->pstate_watermark[2]);\n\t \n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK, NB_PSTATE_CHANGE_WATERMARK_MASK, 0x3);\n\tREG_UPDATE(MCIF_WB_NB_PSTATE_LATENCY_WATERMARK,\n\t\t\tNB_PSTATE_CHANGE_REFRESH_WATERMARK, params->pstate_watermark[3]);\n\n\t \n\t\n\t\n\n\t \n\tREG_UPDATE(MULTI_LEVEL_QOS_CTRL, MAX_SCALED_TIME_TO_URGENT, params->max_scaled_time);\n\n\t \n\tREG_UPDATE(MCIF_WB_BUFMGR_VCE_CONTROL, MCIF_WB_BUFMGR_SLICE_SIZE, params->slice_lines-1);\n\n\t \n\t \n\t \n\tREG_UPDATE(MCIF_WB_ARBITRATION_CONTROL, MCIF_WB_CLIENT_ARBITRATION_SLICE,  params->arbitration_slice);\n}\n\nstatic const struct mcif_wb_funcs dcn32_mmhubbub_funcs = {\n\t.warmup_mcif\t\t= mmhubbub32_warmup_mcif,\n\t.enable_mcif\t\t= mmhubbub2_enable_mcif,\n\t.disable_mcif\t\t= mmhubbub2_disable_mcif,\n\t.config_mcif_buf\t= mmhubbub32_config_mcif_buf,\n\t.config_mcif_arb\t= mmhubbub32_config_mcif_arb,\n\t.config_mcif_irq\t= mmhubbub2_config_mcif_irq,\n\t.dump_frame\t\t\t= mcifwb2_dump_frame,\n};\n\nvoid dcn32_mmhubbub_construct(struct dcn30_mmhubbub *mcif_wb30,\n\t\tstruct dc_context *ctx,\n\t\tconst struct dcn30_mmhubbub_registers *mcif_wb_regs,\n\t\tconst struct dcn30_mmhubbub_shift *mcif_wb_shift,\n\t\tconst struct dcn30_mmhubbub_mask *mcif_wb_mask,\n\t\tint inst)\n{\n\tmcif_wb30->base.ctx = ctx;\n\n\tmcif_wb30->base.inst = inst;\n\tmcif_wb30->base.funcs = &dcn32_mmhubbub_funcs;\n\n\tmcif_wb30->mcif_wb_regs = mcif_wb_regs;\n\tmcif_wb30->mcif_wb_shift = mcif_wb_shift;\n\tmcif_wb30->mcif_wb_mask = mcif_wb_mask;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}