{
  "module_name": "dce_opp.c",
  "hash_id": "cc366f5381daa67b29f11124b8ddbfb8d137b3f6a6cf8d714a62735a3a5c117d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dce/dce_opp.c",
  "human_readable_source": " \n\n#include \"dm_services.h\"\n#include \"basics/conversion.h\"\n\n#include \"dce_opp.h\"\n\n#include \"reg_helper.h\"\n\n#define REG(reg)\\\n\t(opp110->regs->reg)\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\topp110->opp_shift->field_name, opp110->opp_mask->field_name\n\n#define CTX \\\n\topp110->base.ctx\n\nenum {\n\tMAX_PWL_ENTRY = 128,\n\tMAX_REGIONS_NUMBER = 16\n};\n\nenum {\n\tMAX_LUT_ENTRY = 256,\n\tMAX_NUMBER_OF_ENTRIES = 256\n};\n\n\nenum {\n\tOUTPUT_CSC_MATRIX_SIZE = 12\n};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n\n\n\n \nstatic void set_truncation(\n\t\tstruct dce110_opp *opp110,\n\t\tconst struct bit_depth_reduction_params *params)\n{\n\t \n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\t\tFMT_TRUNCATE_EN, 0,\n\t\t\tFMT_TRUNCATE_DEPTH, 0,\n\t\t\tFMT_TRUNCATE_MODE, 0);\n\n\n\tif (params->pixel_encoding == PIXEL_ENCODING_YCBCR422) {\n\t\t \n\t\tif (params->flags.TRUNCATE_DEPTH == 1)\n\t\t\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\t\t\t\tFMT_TRUNCATE_EN, 1,\n\t\t\t\t\tFMT_TRUNCATE_DEPTH, 1,\n\t\t\t\t\tFMT_TRUNCATE_MODE, 0);\n\t\telse if (params->flags.TRUNCATE_DEPTH == 2)\n\t\t\t \n\t\t\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\t\t\t\tFMT_TRUNCATE_EN, 1,\n\t\t\t\t\tFMT_TRUNCATE_DEPTH, 2,\n\t\t\t\t\tFMT_TRUNCATE_MODE, 0);\n\t\treturn;\n\t}\n\t \n\tif (params->flags.TRUNCATE_ENABLED == 0)\n\t\treturn;\n\t \n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\t\t\tFMT_TRUNCATE_EN, 1,\n\t\t\t\tFMT_TRUNCATE_DEPTH,\n\t\t\t\tparams->flags.TRUNCATE_DEPTH,\n\t\t\t\tFMT_TRUNCATE_MODE,\n\t\t\t\tparams->flags.TRUNCATE_MODE);\n}\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\n \nstatic void dce60_set_truncation(\n\t\tstruct dce110_opp *opp110,\n\t\tconst struct bit_depth_reduction_params *params)\n{\n\t \n\n\t \n\tREG_UPDATE_2(FMT_BIT_DEPTH_CONTROL,\n\t\t\tFMT_TRUNCATE_EN, 0,\n\t\t\tFMT_TRUNCATE_DEPTH, 0);\n\n\tif (params->pixel_encoding == PIXEL_ENCODING_YCBCR422) {\n\t\t \n\t\tif (params->flags.TRUNCATE_DEPTH == 1)\n\t\t\tREG_UPDATE_2(FMT_BIT_DEPTH_CONTROL,\n\t\t\t\t\tFMT_TRUNCATE_EN, 1,\n\t\t\t\t\tFMT_TRUNCATE_DEPTH, 1);\n\t\telse if (params->flags.TRUNCATE_DEPTH == 2)\n\t\t\t \n\t\t\tREG_UPDATE_2(FMT_BIT_DEPTH_CONTROL,\n\t\t\t\t\tFMT_TRUNCATE_EN, 1,\n\t\t\t\t\tFMT_TRUNCATE_DEPTH, 2);\n\t\treturn;\n\t}\n\t \n\tif (params->flags.TRUNCATE_ENABLED == 0)\n\t\treturn;\n\t \n\tREG_UPDATE_2(FMT_BIT_DEPTH_CONTROL,\n\t\t\t\tFMT_TRUNCATE_EN, 1,\n\t\t\t\tFMT_TRUNCATE_DEPTH,\n\t\t\t\tparams->flags.TRUNCATE_DEPTH);\n}\n#endif\n\n \nstatic void set_spatial_dither(\n\tstruct dce110_opp *opp110,\n\tconst struct bit_depth_reduction_params *params)\n{\n\t \n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_SPATIAL_DITHER_EN, 0,\n\t\tFMT_SPATIAL_DITHER_DEPTH, 0,\n\t\tFMT_SPATIAL_DITHER_MODE, 0);\n\n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_HIGHPASS_RANDOM_ENABLE, 0,\n\t\tFMT_FRAME_RANDOM_ENABLE, 0,\n\t\tFMT_RGB_RANDOM_ENABLE, 0);\n\n\tREG_UPDATE(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_TEMPORAL_DITHER_EN, 0);\n\n\tif (params->flags.SPATIAL_DITHER_ENABLED == 0)\n\t\treturn;\n\n\t \n\n\tif (opp110->opp_mask->FMT_SPATIAL_DITHER_FRAME_COUNTER_MAX &&\n\t\t\topp110->opp_mask->FMT_SPATIAL_DITHER_FRAME_COUNTER_BIT_SWAP) {\n\t\tif (params->flags.FRAME_RANDOM == 1) {\n\t\t\tif (params->flags.SPATIAL_DITHER_DEPTH == 0 ||\n\t\t\tparams->flags.SPATIAL_DITHER_DEPTH == 1) {\n\t\t\t\tREG_UPDATE_2(FMT_CONTROL,\n\t\t\t\t\tFMT_SPATIAL_DITHER_FRAME_COUNTER_MAX, 15,\n\t\t\t\t\tFMT_SPATIAL_DITHER_FRAME_COUNTER_BIT_SWAP, 2);\n\t\t\t} else if (params->flags.SPATIAL_DITHER_DEPTH == 2) {\n\t\t\t\tREG_UPDATE_2(FMT_CONTROL,\n\t\t\t\t\tFMT_SPATIAL_DITHER_FRAME_COUNTER_MAX, 3,\n\t\t\t\t\tFMT_SPATIAL_DITHER_FRAME_COUNTER_BIT_SWAP, 1);\n\t\t\t} else\n\t\t\t\treturn;\n\t\t} else {\n\t\t\tREG_UPDATE_2(FMT_CONTROL,\n\t\t\t\t\tFMT_SPATIAL_DITHER_FRAME_COUNTER_MAX, 0,\n\t\t\t\t\tFMT_SPATIAL_DITHER_FRAME_COUNTER_BIT_SWAP, 0);\n\t\t}\n\t}\n\t \n\tREG_UPDATE(FMT_DITHER_RAND_R_SEED,\n\t\t\tFMT_RAND_R_SEED, params->r_seed_value);\n\n\tREG_UPDATE(FMT_DITHER_RAND_G_SEED,\n\t\t\tFMT_RAND_G_SEED, params->g_seed_value);\n\n\tREG_UPDATE(FMT_DITHER_RAND_B_SEED,\n\t\t\tFMT_RAND_B_SEED, params->b_seed_value);\n\n\t \n\t \n\t \n\n\t \n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_HIGHPASS_RANDOM_ENABLE, params->flags.HIGHPASS_RANDOM,\n\t\tFMT_FRAME_RANDOM_ENABLE, params->flags.FRAME_RANDOM,\n\t\tFMT_RGB_RANDOM_ENABLE, params->flags.RGB_RANDOM);\n\n\t \n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_SPATIAL_DITHER_DEPTH, params->flags.SPATIAL_DITHER_DEPTH,\n\t\tFMT_SPATIAL_DITHER_MODE, params->flags.SPATIAL_DITHER_MODE,\n\t\tFMT_SPATIAL_DITHER_EN, 1);\n}\n\n \n\nstatic void set_temporal_dither(\n\tstruct dce110_opp *opp110,\n\tconst struct bit_depth_reduction_params *params)\n{\n\t \n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_TEMPORAL_DITHER_EN, 0,\n\t\tFMT_TEMPORAL_DITHER_RESET, 0,\n\t\tFMT_TEMPORAL_DITHER_OFFSET, 0);\n\n\tREG_UPDATE_2(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_TEMPORAL_DITHER_DEPTH, 0,\n\t\tFMT_TEMPORAL_LEVEL, 0);\n\n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_25FRC_SEL, 0,\n\t\tFMT_50FRC_SEL, 0,\n\t\tFMT_75FRC_SEL, 0);\n\n\t \n\tif (params->flags.FRAME_MODULATION_ENABLED == 0 ||\n\t\tparams->flags.FRAME_MODULATION_DEPTH == 2)\n\t\treturn;\n\n\t \n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_TEMPORAL_DITHER_DEPTH, params->flags.FRAME_MODULATION_DEPTH,\n\t\tFMT_TEMPORAL_DITHER_RESET, 0,\n\t\tFMT_TEMPORAL_DITHER_OFFSET, 0);\n\n\t \n\tif (REG(FMT_TEMPORAL_DITHER_PATTERN_CONTROL)) {\n\t\tREG_WRITE(FMT_TEMPORAL_DITHER_PATTERN_CONTROL, 0);\n\t\t \n\t\tREG_WRITE(FMT_TEMPORAL_DITHER_PROGRAMMABLE_PATTERN_S_MATRIX, 0);\n\t\t \n\t\tREG_WRITE(FMT_TEMPORAL_DITHER_PROGRAMMABLE_PATTERN_T_MATRIX, 0);\n\t}\n\n\t \n\tREG_UPDATE(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_TEMPORAL_LEVEL, params->flags.TEMPORAL_LEVEL);\n\n\tREG_UPDATE_3(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_25FRC_SEL, params->flags.FRC25,\n\t\tFMT_50FRC_SEL, params->flags.FRC50,\n\t\tFMT_75FRC_SEL, params->flags.FRC75);\n\n\t \n\tREG_UPDATE(FMT_BIT_DEPTH_CONTROL,\n\t\tFMT_TEMPORAL_DITHER_EN, 1);\n}\n\n \nvoid dce110_opp_set_clamping(\n\tstruct dce110_opp *opp110,\n\tconst struct clamping_and_pixel_encoding_params *params)\n{\n\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\tFMT_CLAMP_DATA_EN, 0,\n\t\tFMT_CLAMP_COLOR_FORMAT, 0);\n\n\tswitch (params->clamping_level) {\n\tcase CLAMPING_FULL_RANGE:\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_8BPC:\n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 1);\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_10BPC:\n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 2);\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_12BPC:\n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 3);\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_PROGRAMMABLE:\n\t\t \n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 7);\n\n\t\t \n\t\tREG_SET_2(FMT_CLAMP_COMPONENT_R, 0,\n\t\t\tFMT_CLAMP_LOWER_R, 0x10,\n\t\t\tFMT_CLAMP_UPPER_R, 0xFEF);\n\n\t\tREG_SET_2(FMT_CLAMP_COMPONENT_G, 0,\n\t\t\tFMT_CLAMP_LOWER_G, 0x10,\n\t\t\tFMT_CLAMP_UPPER_G, 0xFEF);\n\n\t\tREG_SET_2(FMT_CLAMP_COMPONENT_B, 0,\n\t\t\tFMT_CLAMP_LOWER_B, 0x10,\n\t\t\tFMT_CLAMP_UPPER_B, 0xFEF);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\n \nstatic void dce60_opp_set_clamping(\n\tstruct dce110_opp *opp110,\n\tconst struct clamping_and_pixel_encoding_params *params)\n{\n\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\tFMT_CLAMP_DATA_EN, 0,\n\t\tFMT_CLAMP_COLOR_FORMAT, 0);\n\n\tswitch (params->clamping_level) {\n\tcase CLAMPING_FULL_RANGE:\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_8BPC:\n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 1);\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_10BPC:\n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 2);\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_12BPC:\n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 3);\n\t\tbreak;\n\tcase CLAMPING_LIMITED_RANGE_PROGRAMMABLE:\n\t\t \n\t\tREG_SET_2(FMT_CLAMP_CNTL, 0,\n\t\t\tFMT_CLAMP_DATA_EN, 1,\n\t\t\tFMT_CLAMP_COLOR_FORMAT, 7);\n\n\t\t \n\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n#endif\n\n \nstatic void set_pixel_encoding(\n\tstruct dce110_opp *opp110,\n\tconst struct clamping_and_pixel_encoding_params *params)\n{\n\tif (opp110->opp_mask->FMT_CBCR_BIT_REDUCTION_BYPASS)\n\t\tREG_UPDATE_3(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 0,\n\t\t\t\tFMT_SUBSAMPLING_MODE, 0,\n\t\t\t\tFMT_CBCR_BIT_REDUCTION_BYPASS, 0);\n\telse\n\t\tREG_UPDATE_2(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 0,\n\t\t\t\tFMT_SUBSAMPLING_MODE, 0);\n\n\tif (params->pixel_encoding == PIXEL_ENCODING_YCBCR422) {\n\t\tREG_UPDATE_2(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 1,\n\t\t\t\tFMT_SUBSAMPLING_ORDER, 0);\n\t}\n\tif (params->pixel_encoding == PIXEL_ENCODING_YCBCR420) {\n\t\tREG_UPDATE_3(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 2,\n\t\t\t\tFMT_SUBSAMPLING_MODE, 2,\n\t\t\t\tFMT_CBCR_BIT_REDUCTION_BYPASS, 1);\n\t}\n\n}\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\n \nstatic void dce60_set_pixel_encoding(\n\tstruct dce110_opp *opp110,\n\tconst struct clamping_and_pixel_encoding_params *params)\n{\n\tif (opp110->opp_mask->FMT_CBCR_BIT_REDUCTION_BYPASS)\n\t\tREG_UPDATE_2(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 0,\n\t\t\t\tFMT_CBCR_BIT_REDUCTION_BYPASS, 0);\n\telse\n\t\tREG_UPDATE(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 0);\n\n\tif (params->pixel_encoding == PIXEL_ENCODING_YCBCR422) {\n\t\tREG_UPDATE(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 1);\n\t}\n\tif (params->pixel_encoding == PIXEL_ENCODING_YCBCR420) {\n\t\tREG_UPDATE_2(FMT_CONTROL,\n\t\t\t\tFMT_PIXEL_ENCODING, 2,\n\t\t\t\tFMT_CBCR_BIT_REDUCTION_BYPASS, 1);\n\t}\n\n}\n#endif\n\nvoid dce110_opp_program_bit_depth_reduction(\n\tstruct output_pixel_processor *opp,\n\tconst struct bit_depth_reduction_params *params)\n{\n\tstruct dce110_opp *opp110 = TO_DCE110_OPP(opp);\n\n\tset_truncation(opp110, params);\n\tset_spatial_dither(opp110, params);\n\tset_temporal_dither(opp110, params);\n}\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\nstatic void dce60_opp_program_bit_depth_reduction(\n\tstruct output_pixel_processor *opp,\n\tconst struct bit_depth_reduction_params *params)\n{\n\tstruct dce110_opp *opp110 = TO_DCE110_OPP(opp);\n\n\tdce60_set_truncation(opp110, params);\n\tset_spatial_dither(opp110, params);\n\tset_temporal_dither(opp110, params);\n}\n#endif\n\nvoid dce110_opp_program_clamping_and_pixel_encoding(\n\tstruct output_pixel_processor *opp,\n\tconst struct clamping_and_pixel_encoding_params *params)\n{\n\tstruct dce110_opp *opp110 = TO_DCE110_OPP(opp);\n\n\tdce110_opp_set_clamping(opp110, params);\n\tset_pixel_encoding(opp110, params);\n}\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\nstatic void dce60_opp_program_clamping_and_pixel_encoding(\n\tstruct output_pixel_processor *opp,\n\tconst struct clamping_and_pixel_encoding_params *params)\n{\n\tstruct dce110_opp *opp110 = TO_DCE110_OPP(opp);\n\n\tdce60_opp_set_clamping(opp110, params);\n\tdce60_set_pixel_encoding(opp110, params);\n}\n#endif\n\n\nstatic void program_formatter_420_memory(struct output_pixel_processor *opp)\n{\n\tstruct dce110_opp *opp110 = TO_DCE110_OPP(opp);\n\tuint32_t fmt_mem_cntl_value;\n\n\t \n\t \n\t \n\tREG_GET(CONTROL,\n\t\t\tFMT420_MEM0_SOURCE_SEL, &fmt_mem_cntl_value);\n\n\tREG_UPDATE(FMT_CONTROL,\n\t\t\tFMT_SRC_SELECT, fmt_mem_cntl_value);\n\n\t \n\tREG_UPDATE(CONTROL,\n\t\t\tFMT420_MEM0_PWR_FORCE, 0);\n}\n\nvoid dce110_opp_set_dyn_expansion(\n\tstruct output_pixel_processor *opp,\n\tenum dc_color_space color_sp,\n\tenum dc_color_depth color_dpth,\n\tenum signal_type signal)\n{\n\tstruct dce110_opp *opp110 = TO_DCE110_OPP(opp);\n\n\tREG_UPDATE_2(FMT_DYNAMIC_EXP_CNTL,\n\t\t\tFMT_DYNAMIC_EXP_EN, 0,\n\t\t\tFMT_DYNAMIC_EXP_MODE, 0);\n\n\t \n\t \n\tif (signal == SIGNAL_TYPE_HDMI_TYPE_A ||\n\t\tsignal == SIGNAL_TYPE_DISPLAY_PORT ||\n\t\tsignal == SIGNAL_TYPE_DISPLAY_PORT_MST) {\n\t\tswitch (color_dpth) {\n\t\tcase COLOR_DEPTH_888:\n\t\t\tREG_UPDATE_2(FMT_DYNAMIC_EXP_CNTL,\n\t\t\t\tFMT_DYNAMIC_EXP_EN, 1,\n\t\t\t\tFMT_DYNAMIC_EXP_MODE, 1);\n\t\t\tbreak;\n\t\tcase COLOR_DEPTH_101010:\n\t\t\tREG_UPDATE_2(FMT_DYNAMIC_EXP_CNTL,\n\t\t\t\tFMT_DYNAMIC_EXP_EN, 1,\n\t\t\t\tFMT_DYNAMIC_EXP_MODE, 0);\n\t\t\tbreak;\n\t\tcase COLOR_DEPTH_121212:\n\t\t\tREG_UPDATE_2(\n\t\t\t\tFMT_DYNAMIC_EXP_CNTL,\n\t\t\t\tFMT_DYNAMIC_EXP_EN, 1, \n\t\t\t\tFMT_DYNAMIC_EXP_MODE, 0);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic void program_formatter_reset_dig_resync_fifo(struct output_pixel_processor *opp)\n{\n\tstruct dce110_opp *opp110 = TO_DCE110_OPP(opp);\n\n\t \n\tREG_UPDATE(FMT_CONTROL,\n\t\t\tFMT_420_PIXEL_PHASE_LOCKED_CLEAR, 1);\n\n\t \n\tREG_WAIT(FMT_CONTROL, FMT_420_PIXEL_PHASE_LOCKED, 1, 10, 10);\n\n}\n\nvoid dce110_opp_program_fmt(\n\tstruct output_pixel_processor *opp,\n\tstruct bit_depth_reduction_params *fmt_bit_depth,\n\tstruct clamping_and_pixel_encoding_params *clamping)\n{\n\t \n\n\tif (clamping->pixel_encoding == PIXEL_ENCODING_YCBCR420)\n\t\tprogram_formatter_420_memory(opp);\n\n\tdce110_opp_program_bit_depth_reduction(\n\t\topp,\n\t\tfmt_bit_depth);\n\n\tdce110_opp_program_clamping_and_pixel_encoding(\n\t\topp,\n\t\tclamping);\n\n\tif (clamping->pixel_encoding == PIXEL_ENCODING_YCBCR420)\n\t\tprogram_formatter_reset_dig_resync_fifo(opp);\n\n\treturn;\n}\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\nstatic void dce60_opp_program_fmt(\n\tstruct output_pixel_processor *opp,\n\tstruct bit_depth_reduction_params *fmt_bit_depth,\n\tstruct clamping_and_pixel_encoding_params *clamping)\n{\n\t \n\n\tif (clamping->pixel_encoding == PIXEL_ENCODING_YCBCR420)\n\t\tprogram_formatter_420_memory(opp);\n\n\tdce60_opp_program_bit_depth_reduction(\n\t\topp,\n\t\tfmt_bit_depth);\n\n\tdce60_opp_program_clamping_and_pixel_encoding(\n\t\topp,\n\t\tclamping);\n\n\tif (clamping->pixel_encoding == PIXEL_ENCODING_YCBCR420)\n\t\tprogram_formatter_reset_dig_resync_fifo(opp);\n\n\treturn;\n}\n#endif\n\n\n\n \n \n \n\nstatic const struct opp_funcs funcs = {\n\t.opp_set_dyn_expansion = dce110_opp_set_dyn_expansion,\n\t.opp_destroy = dce110_opp_destroy,\n\t.opp_program_fmt = dce110_opp_program_fmt,\n\t.opp_program_bit_depth_reduction = dce110_opp_program_bit_depth_reduction\n};\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\nstatic const struct opp_funcs dce60_opp_funcs = {\n\t.opp_set_dyn_expansion = dce110_opp_set_dyn_expansion,\n\t.opp_destroy = dce110_opp_destroy,\n\t.opp_program_fmt = dce60_opp_program_fmt,\n\t.opp_program_bit_depth_reduction = dce60_opp_program_bit_depth_reduction\n};\n#endif\n\nvoid dce110_opp_construct(struct dce110_opp *opp110,\n\tstruct dc_context *ctx,\n\tuint32_t inst,\n\tconst struct dce_opp_registers *regs,\n\tconst struct dce_opp_shift *opp_shift,\n\tconst struct dce_opp_mask *opp_mask)\n{\n\topp110->base.funcs = &funcs;\n\n\topp110->base.ctx = ctx;\n\n\topp110->base.inst = inst;\n\n\topp110->regs = regs;\n\topp110->opp_shift = opp_shift;\n\topp110->opp_mask = opp_mask;\n}\n\n#if defined(CONFIG_DRM_AMD_DC_SI)\nvoid dce60_opp_construct(struct dce110_opp *opp110,\n\tstruct dc_context *ctx,\n\tuint32_t inst,\n\tconst struct dce_opp_registers *regs,\n\tconst struct dce_opp_shift *opp_shift,\n\tconst struct dce_opp_mask *opp_mask)\n{\n\topp110->base.funcs = &dce60_opp_funcs;\n\n\topp110->base.ctx = ctx;\n\n\topp110->base.inst = inst;\n\n\topp110->regs = regs;\n\topp110->opp_shift = opp_shift;\n\topp110->opp_mask = opp_mask;\n}\n#endif\n\nvoid dce110_opp_destroy(struct output_pixel_processor **opp)\n{\n\tif (*opp)\n\t\tkfree(FROM_DCE11_OPP(*opp));\n\t*opp = NULL;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}