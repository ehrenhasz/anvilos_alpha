{
  "module_name": "dcn31_hpo_dp_link_encoder.c",
  "hash_id": "d66e08a802bdf16f19a76515e8e873697c402841b869e89b18134509a3de9e9e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_hpo_dp_link_encoder.c",
  "human_readable_source": " \n\n#include \"dc_bios_types.h\"\n#include \"dcn31_hpo_dp_link_encoder.h\"\n#include \"reg_helper.h\"\n#include \"stream_encoder.h\"\n\n#define DC_LOGGER \\\n\t\tenc3->base.ctx->logger\n\n#define REG(reg)\\\n\t(enc3->regs->reg)\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\tenc3->hpo_le_shift->field_name, enc3->hpo_le_mask->field_name\n\n\n#define CTX \\\n\tenc3->base.ctx\n\nenum {\n\tDP_SAT_UPDATE_MAX_RETRY = 200\n};\n\nvoid dcn31_hpo_dp_link_enc_enable(\n\t\tstruct hpo_dp_link_encoder *enc,\n\t\tenum dc_lane_count num_lanes)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tuint32_t dp_link_enabled;\n\n\t \n\tREG_GET(DP_DPHY_SYM32_STATUS,\n\t\t\tSTATUS, &dp_link_enabled);\n\n\t \n\tREG_UPDATE(DP_LINK_ENC_CLOCK_CONTROL, DP_LINK_ENC_CLOCK_EN, 1);\n\n\t \n\tif (!dp_link_enabled) {\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL, DPHY_RESET, 1);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL, DPHY_RESET, 0);\n\t}\n\n\t \n\tREG_UPDATE_3(DP_DPHY_SYM32_CONTROL,\n\t\t\tDPHY_ENABLE, 1,\n\t\t\tPRECODER_ENABLE, 1,\n\t\t\tNUM_LANES, num_lanes == LANE_COUNT_ONE ? 0 : num_lanes == LANE_COUNT_TWO ? 1 : 3);\n}\n\nvoid dcn31_hpo_dp_link_enc_disable(\n\t\tstruct hpo_dp_link_encoder *enc)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\n\t \n\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\tDPHY_ENABLE, 0);\n\n\t \n\tREG_UPDATE(DP_LINK_ENC_CLOCK_CONTROL, DP_LINK_ENC_CLOCK_EN, 0);\n}\n\nvoid dcn31_hpo_dp_link_enc_set_link_test_pattern(\n\t\tstruct hpo_dp_link_encoder *enc,\n\t\tstruct encoder_set_dp_phy_pattern_param *tp_params)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tuint32_t tp_custom;\n\n\tswitch (tp_params->dp_phy_pattern) {\n\tcase DP_TEST_PATTERN_VIDEO_MODE:\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_LINK_ACTIVE);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_128b_132b_TPS1_TRAINING_MODE:\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_LINK_TRAINING_TPS1);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_128b_132b_TPS2_TRAINING_MODE:\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_LINK_TRAINING_TPS2);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_128b_132b_TPS1:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_TPS1,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_TPS1,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_TPS1,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_TPS1);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_128b_132b_TPS2:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_TPS2,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_TPS2,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_TPS2,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_TPS2);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_PRBS7:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_PRBS_SEL0, DP_DPHY_TP_PRBS7,\n\t\t\t\tTP_PRBS_SEL1, DP_DPHY_TP_PRBS7,\n\t\t\t\tTP_PRBS_SEL2, DP_DPHY_TP_PRBS7,\n\t\t\t\tTP_PRBS_SEL3, DP_DPHY_TP_PRBS7);\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_PRBS);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_PRBS9:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_PRBS_SEL0, DP_DPHY_TP_PRBS9,\n\t\t\t\tTP_PRBS_SEL1, DP_DPHY_TP_PRBS9,\n\t\t\t\tTP_PRBS_SEL2, DP_DPHY_TP_PRBS9,\n\t\t\t\tTP_PRBS_SEL3, DP_DPHY_TP_PRBS9);\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_PRBS);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_PRBS11:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_PRBS_SEL0, DP_DPHY_TP_PRBS11,\n\t\t\t\tTP_PRBS_SEL1, DP_DPHY_TP_PRBS11,\n\t\t\t\tTP_PRBS_SEL2, DP_DPHY_TP_PRBS11,\n\t\t\t\tTP_PRBS_SEL3, DP_DPHY_TP_PRBS11);\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_PRBS);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_PRBS15:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_PRBS_SEL0, DP_DPHY_TP_PRBS15,\n\t\t\t\tTP_PRBS_SEL1, DP_DPHY_TP_PRBS15,\n\t\t\t\tTP_PRBS_SEL2, DP_DPHY_TP_PRBS15,\n\t\t\t\tTP_PRBS_SEL3, DP_DPHY_TP_PRBS15);\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_PRBS);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_PRBS23:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_PRBS_SEL0, DP_DPHY_TP_PRBS23,\n\t\t\t\tTP_PRBS_SEL1, DP_DPHY_TP_PRBS23,\n\t\t\t\tTP_PRBS_SEL2, DP_DPHY_TP_PRBS23,\n\t\t\t\tTP_PRBS_SEL3, DP_DPHY_TP_PRBS23);\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_PRBS);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_PRBS31:\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_PRBS_SEL0, DP_DPHY_TP_PRBS31,\n\t\t\t\tTP_PRBS_SEL1, DP_DPHY_TP_PRBS31,\n\t\t\t\tTP_PRBS_SEL2, DP_DPHY_TP_PRBS31,\n\t\t\t\tTP_PRBS_SEL3, DP_DPHY_TP_PRBS31);\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_PRBS,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_PRBS);\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_264BIT_CUSTOM:\n\t\ttp_custom = (tp_params->custom_pattern[2] << 16) | (tp_params->custom_pattern[1] << 8) | tp_params->custom_pattern[0];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM0, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[5] << 16) | (tp_params->custom_pattern[4] << 8) | tp_params->custom_pattern[3];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM1, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[8] << 16) | (tp_params->custom_pattern[7] << 8) | tp_params->custom_pattern[6];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM2, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[11] << 16) | (tp_params->custom_pattern[10] << 8) | tp_params->custom_pattern[9];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM3, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[14] << 16) | (tp_params->custom_pattern[13] << 8) | tp_params->custom_pattern[12];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM4, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[17] << 16) | (tp_params->custom_pattern[16] << 8) | tp_params->custom_pattern[15];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM5, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[20] << 16) | (tp_params->custom_pattern[19] << 8) | tp_params->custom_pattern[18];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM6, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[23] << 16) | (tp_params->custom_pattern[22] << 8) | tp_params->custom_pattern[21];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM7, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[26] << 16) | (tp_params->custom_pattern[25] << 8) | tp_params->custom_pattern[24];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM8, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[29] << 16) | (tp_params->custom_pattern[28] << 8) | tp_params->custom_pattern[27];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM9, 0, TP_CUSTOM, tp_custom);\n\t\ttp_custom = (tp_params->custom_pattern[32] << 16) | (tp_params->custom_pattern[31] << 8) | tp_params->custom_pattern[30];\n\t\tREG_SET(DP_DPHY_SYM32_TP_CUSTOM10, 0, TP_CUSTOM, tp_custom);\n\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_CUSTOM,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_CUSTOM,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_CUSTOM,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_CUSTOM);\n\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tcase DP_TEST_PATTERN_SQUARE:\n\tcase DP_TEST_PATTERN_SQUARE_PRESHOOT_DISABLED:\n\tcase DP_TEST_PATTERN_SQUARE_DEEMPHASIS_DISABLED:\n\tcase DP_TEST_PATTERN_SQUARE_PRESHOOT_DEEMPHASIS_DISABLED:\n\t\tREG_SET(DP_DPHY_SYM32_TP_SQ_PULSE, 0,\n\t\t\t\tTP_SQ_PULSE_WIDTH, tp_params->custom_pattern[0]);\n\n\t\tREG_UPDATE_4(DP_DPHY_SYM32_TP_CONFIG,\n\t\t\t\tTP_SELECT0, DP_DPHY_TP_SELECT_SQUARE,\n\t\t\t\tTP_SELECT1, DP_DPHY_TP_SELECT_SQUARE,\n\t\t\t\tTP_SELECT2, DP_DPHY_TP_SELECT_SQUARE,\n\t\t\t\tTP_SELECT3, DP_DPHY_TP_SELECT_SQUARE);\n\n\t\tREG_UPDATE(DP_DPHY_SYM32_CONTROL,\n\t\t\t\tMODE, DP2_TEST_PATTERN);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void fill_stream_allocation_row_info(\n\t\tconst struct link_mst_stream_allocation *stream_allocation,\n\t\tuint32_t *src,\n\t\tuint32_t *slots)\n{\n\tconst struct hpo_dp_stream_encoder *stream_enc = stream_allocation->hpo_dp_stream_enc;\n\n\tif (stream_enc && (stream_enc->id >= ENGINE_ID_HPO_DP_0)) {\n\t\t*src = stream_enc->id - ENGINE_ID_HPO_DP_0;\n\t\t*slots = stream_allocation->slot_count;\n\t} else {\n\t\t*src = 0;\n\t\t*slots = 0;\n\t}\n}\n\n \nvoid dcn31_hpo_dp_link_enc_update_stream_allocation_table(\n\t\tstruct hpo_dp_link_encoder *enc,\n\t\tconst struct link_mst_stream_allocation_table *table)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tuint32_t slots = 0;\n\tuint32_t src = 0;\n\n\t \n\n\t \n\n\tif (table->stream_count >= 1) {\n\t\tfill_stream_allocation_row_info(\n\t\t\t&table->stream_allocations[0],\n\t\t\t&src,\n\t\t\t&slots);\n\t} else {\n\t\tsrc = 0;\n\t\tslots = 0;\n\t}\n\n\tREG_UPDATE_2(DP_DPHY_SYM32_SAT_VC0,\n\t\t\tSAT_STREAM_SOURCE, src,\n\t\t\tSAT_SLOT_COUNT, slots);\n\n\tif (table->stream_count >= 2) {\n\t\tfill_stream_allocation_row_info(\n\t\t\t&table->stream_allocations[1],\n\t\t\t&src,\n\t\t\t&slots);\n\t} else {\n\t\tsrc = 0;\n\t\tslots = 0;\n\t}\n\n\tREG_UPDATE_2(DP_DPHY_SYM32_SAT_VC1,\n\t\t\tSAT_STREAM_SOURCE, src,\n\t\t\tSAT_SLOT_COUNT, slots);\n\n\tif (table->stream_count >= 3) {\n\t\tfill_stream_allocation_row_info(\n\t\t\t&table->stream_allocations[2],\n\t\t\t&src,\n\t\t\t&slots);\n\t} else {\n\t\tsrc = 0;\n\t\tslots = 0;\n\t}\n\n\tREG_UPDATE_2(DP_DPHY_SYM32_SAT_VC2,\n\t\t\tSAT_STREAM_SOURCE, src,\n\t\t\tSAT_SLOT_COUNT, slots);\n\n\tif (table->stream_count >= 4) {\n\t\tfill_stream_allocation_row_info(\n\t\t\t&table->stream_allocations[3],\n\t\t\t&src,\n\t\t\t&slots);\n\t} else {\n\t\tsrc = 0;\n\t\tslots = 0;\n\t}\n\n\tREG_UPDATE_2(DP_DPHY_SYM32_SAT_VC3,\n\t\t\tSAT_STREAM_SOURCE, src,\n\t\t\tSAT_SLOT_COUNT, slots);\n\n\t \n\n\t \n\n\t \n\tREG_UPDATE(DP_DPHY_SYM32_SAT_UPDATE,\n\t\t\tSAT_UPDATE, 1);\n\n\t \n\t \n\tREG_WAIT(DP_DPHY_SYM32_STATUS,\n\t\t\tSAT_UPDATE_PENDING, 0,\n\t\t\t10, DP_SAT_UPDATE_MAX_RETRY);\n}\n\nvoid dcn31_hpo_dp_link_enc_set_throttled_vcp_size(\n\t\tstruct hpo_dp_link_encoder *enc,\n\t\tuint32_t stream_encoder_inst,\n\t\tstruct fixed31_32 avg_time_slots_per_mtp)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tuint32_t x = dc_fixpt_floor(\n\t\tavg_time_slots_per_mtp);\n\tuint32_t y = dc_fixpt_ceil(\n\t\tdc_fixpt_shl(\n\t\t\tdc_fixpt_sub_int(\n\t\t\t\tavg_time_slots_per_mtp,\n\t\t\t\tx),\n\t\t\t25));\n\n\tswitch (stream_encoder_inst) {\n\tcase 0:\n\t\tREG_SET_2(DP_DPHY_SYM32_VC_RATE_CNTL0, 0,\n\t\t\t\tSTREAM_VC_RATE_X, x,\n\t\t\t\tSTREAM_VC_RATE_Y, y);\n\t\tbreak;\n\tcase 1:\n\t\tREG_SET_2(DP_DPHY_SYM32_VC_RATE_CNTL1, 0,\n\t\t\t\tSTREAM_VC_RATE_X, x,\n\t\t\t\tSTREAM_VC_RATE_Y, y);\n\t\tbreak;\n\tcase 2:\n\t\tREG_SET_2(DP_DPHY_SYM32_VC_RATE_CNTL2, 0,\n\t\t\t\tSTREAM_VC_RATE_X, x,\n\t\t\t\tSTREAM_VC_RATE_Y, y);\n\t\tbreak;\n\tcase 3:\n\t\tREG_SET_2(DP_DPHY_SYM32_VC_RATE_CNTL3, 0,\n\t\t\t\tSTREAM_VC_RATE_X, x,\n\t\t\t\tSTREAM_VC_RATE_Y, y);\n\t\tbreak;\n\tdefault:\n\t\tASSERT(0);\n\t}\n\n\t \n\t \n\tREG_WAIT(DP_DPHY_SYM32_STATUS,\n\t\t\tRATE_UPDATE_PENDING, 0,\n\t\t\t1, 10);\n}\n\nstatic bool dcn31_hpo_dp_link_enc_is_in_alt_mode(\n\t\tstruct hpo_dp_link_encoder *enc)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tuint32_t dp_alt_mode_disable = 0;\n\n\tASSERT((enc->transmitter >= TRANSMITTER_UNIPHY_A) && (enc->transmitter <= TRANSMITTER_UNIPHY_E));\n\n\t \n\tREG_GET(RDPCSTX_PHY_CNTL6[enc->transmitter], RDPCS_PHY_DPALT_DISABLE, &dp_alt_mode_disable);\n\treturn (dp_alt_mode_disable == 0);\n}\n\nvoid dcn31_hpo_dp_link_enc_read_state(\n\t\tstruct hpo_dp_link_encoder *enc,\n\t\tstruct hpo_dp_link_enc_state *state)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\n\tASSERT(state);\n\n\tREG_GET(DP_DPHY_SYM32_STATUS,\n\t\t\tSTATUS, &state->link_enc_enabled);\n\tREG_GET(DP_DPHY_SYM32_CONTROL,\n\t\t\tNUM_LANES, &state->lane_count);\n\tREG_GET(DP_DPHY_SYM32_CONTROL,\n\t\t\tMODE, (uint32_t *)&state->link_mode);\n\n\tREG_GET_2(DP_DPHY_SYM32_SAT_VC0,\n\t\t\tSAT_STREAM_SOURCE, &state->stream_src[0],\n\t\t\tSAT_SLOT_COUNT, &state->slot_count[0]);\n\tREG_GET_2(DP_DPHY_SYM32_SAT_VC1,\n\t\t\tSAT_STREAM_SOURCE, &state->stream_src[1],\n\t\t\tSAT_SLOT_COUNT, &state->slot_count[1]);\n\tREG_GET_2(DP_DPHY_SYM32_SAT_VC2,\n\t\t\tSAT_STREAM_SOURCE, &state->stream_src[2],\n\t\t\tSAT_SLOT_COUNT, &state->slot_count[2]);\n\tREG_GET_2(DP_DPHY_SYM32_SAT_VC3,\n\t\t\tSAT_STREAM_SOURCE, &state->stream_src[3],\n\t\t\tSAT_SLOT_COUNT, &state->slot_count[3]);\n\n\tREG_GET_2(DP_DPHY_SYM32_VC_RATE_CNTL0,\n\t\t\tSTREAM_VC_RATE_X, &state->vc_rate_x[0],\n\t\t\tSTREAM_VC_RATE_Y, &state->vc_rate_y[0]);\n\tREG_GET_2(DP_DPHY_SYM32_VC_RATE_CNTL1,\n\t\t\tSTREAM_VC_RATE_X, &state->vc_rate_x[1],\n\t\t\tSTREAM_VC_RATE_Y, &state->vc_rate_y[1]);\n\tREG_GET_2(DP_DPHY_SYM32_VC_RATE_CNTL2,\n\t\t\tSTREAM_VC_RATE_X, &state->vc_rate_x[2],\n\t\t\tSTREAM_VC_RATE_Y, &state->vc_rate_y[2]);\n\tREG_GET_2(DP_DPHY_SYM32_VC_RATE_CNTL3,\n\t\t\tSTREAM_VC_RATE_X, &state->vc_rate_x[3],\n\t\t\tSTREAM_VC_RATE_Y, &state->vc_rate_y[3]);\n}\n\nstatic enum bp_result link_transmitter_control(\n\tstruct dcn31_hpo_dp_link_encoder *enc3,\n\tstruct bp_transmitter_control *cntl)\n{\n\tenum bp_result result;\n\tstruct dc_bios *bp = enc3->base.ctx->dc_bios;\n\n\tresult = bp->funcs->transmitter_control(bp, cntl);\n\n\treturn result;\n}\n\n \nvoid dcn31_hpo_dp_link_enc_enable_dp_output(\n\tstruct hpo_dp_link_encoder *enc,\n\tconst struct dc_link_settings *link_settings,\n\tenum transmitter transmitter,\n\tenum hpd_source_id hpd_source)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tstruct bp_transmitter_control cntl = { 0 };\n\tenum bp_result result;\n\n\t \n\tenc3->base.transmitter = transmitter;\n\n\t \n\tenc3->base.hpd_source = hpd_source;\n\n\t \n\tcntl.action = TRANSMITTER_CONTROL_ENABLE;\n\tcntl.engine_id = ENGINE_ID_UNKNOWN;\n\tcntl.transmitter = enc3->base.transmitter;\n\t\n\tcntl.signal = SIGNAL_TYPE_DISPLAY_PORT_MST;\n\tcntl.lanes_number = link_settings->lane_count;\n\tcntl.hpd_sel = enc3->base.hpd_source;\n\tcntl.pixel_clock = link_settings->link_rate * 1000;\n\tcntl.color_depth = COLOR_DEPTH_UNDEFINED;\n\tcntl.hpo_engine_id = enc->inst + ENGINE_ID_HPO_DP_0;\n\n\tresult = link_transmitter_control(enc3, &cntl);\n\n\tif (result != BP_RESULT_OK) {\n\t\tDC_LOG_ERROR(\"%s: Failed to execute VBIOS command table!\\n\",\n\t\t\t__func__);\n\t\tBREAK_TO_DEBUGGER();\n\t}\n}\n\nvoid dcn31_hpo_dp_link_enc_disable_output(\n\tstruct hpo_dp_link_encoder *enc,\n\tenum signal_type signal)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tstruct bp_transmitter_control cntl = { 0 };\n\tenum bp_result result;\n\n\t \n\tcntl.action = TRANSMITTER_CONTROL_DISABLE;\n\tcntl.transmitter = enc3->base.transmitter;\n\tcntl.hpd_sel = enc3->base.hpd_source;\n\tcntl.signal = signal;\n\n\tresult = link_transmitter_control(enc3, &cntl);\n\n\tif (result != BP_RESULT_OK) {\n\t\tDC_LOG_ERROR(\"%s: Failed to execute VBIOS command table!\\n\",\n\t\t\t__func__);\n\t\tBREAK_TO_DEBUGGER();\n\t\treturn;\n\t}\n\n\t \n\tdcn31_hpo_dp_link_enc_disable(enc);\n}\n\nvoid dcn31_hpo_dp_link_enc_set_ffe(\n\tstruct hpo_dp_link_encoder *enc,\n\tconst struct dc_link_settings *link_settings,\n\tuint8_t ffe_preset)\n{\n\tstruct dcn31_hpo_dp_link_encoder *enc3 = DCN3_1_HPO_DP_LINK_ENC_FROM_HPO_LINK_ENC(enc);\n\tstruct bp_transmitter_control cntl = { 0 };\n\tenum bp_result result;\n\n\t \n\tcntl.transmitter = enc3->base.transmitter;\n\tcntl.action = TRANSMITTER_CONTROL_SET_VOLTAGE_AND_PREEMPASIS;\n\tcntl.signal = SIGNAL_TYPE_DISPLAY_PORT_MST;\n\tcntl.lanes_number = link_settings->lane_count;\n\tcntl.pixel_clock = link_settings->link_rate * 1000;\n\tcntl.lane_settings = ffe_preset;\n\n\tresult = link_transmitter_control(enc3, &cntl);\n\n\tif (result != BP_RESULT_OK) {\n\t\tDC_LOG_ERROR(\"%s: Failed to execute VBIOS command table!\\n\",\n\t\t\t__func__);\n\t\tBREAK_TO_DEBUGGER();\n\t\treturn;\n\t}\n}\n\nstatic struct hpo_dp_link_encoder_funcs dcn31_hpo_dp_link_encoder_funcs = {\n\t.enable_link_phy = dcn31_hpo_dp_link_enc_enable_dp_output,\n\t.disable_link_phy = dcn31_hpo_dp_link_enc_disable_output,\n\t.link_enable = dcn31_hpo_dp_link_enc_enable,\n\t.link_disable = dcn31_hpo_dp_link_enc_disable,\n\t.set_link_test_pattern = dcn31_hpo_dp_link_enc_set_link_test_pattern,\n\t.update_stream_allocation_table = dcn31_hpo_dp_link_enc_update_stream_allocation_table,\n\t.set_throttled_vcp_size = dcn31_hpo_dp_link_enc_set_throttled_vcp_size,\n\t.is_in_alt_mode = dcn31_hpo_dp_link_enc_is_in_alt_mode,\n\t.read_state = dcn31_hpo_dp_link_enc_read_state,\n\t.set_ffe = dcn31_hpo_dp_link_enc_set_ffe,\n};\n\nvoid hpo_dp_link_encoder31_construct(struct dcn31_hpo_dp_link_encoder *enc31,\n\t\tstruct dc_context *ctx,\n\t\tuint32_t inst,\n\t\tconst struct dcn31_hpo_dp_link_encoder_registers *hpo_le_regs,\n\t\tconst struct dcn31_hpo_dp_link_encoder_shift *hpo_le_shift,\n\t\tconst struct dcn31_hpo_dp_link_encoder_mask *hpo_le_mask)\n{\n\tenc31->base.ctx = ctx;\n\n\tenc31->base.inst = inst;\n\tenc31->base.funcs = &dcn31_hpo_dp_link_encoder_funcs;\n\tenc31->base.hpd_source = HPD_SOURCEID_UNKNOWN;\n\tenc31->base.transmitter = TRANSMITTER_UNKNOWN;\n\n\tenc31->regs = hpo_le_regs;\n\tenc31->hpo_le_shift = hpo_le_shift;\n\tenc31->hpo_le_mask = hpo_le_mask;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}