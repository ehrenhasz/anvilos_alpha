{
  "module_name": "dml1_display_rq_dlg_calc.c",
  "hash_id": "dc6bcdf65bc42d29f6a49bb3ac79d7d2de5ebc440bdf693aa23729f2e8346907",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dml/dml1_display_rq_dlg_calc.c",
  "human_readable_source": " \n\n#include \"dml1_display_rq_dlg_calc.h\"\n#include \"display_mode_lib.h\"\n\n#include \"dml_inline_defs.h\"\n\n \n\nstatic unsigned int get_bytes_per_element(enum source_format_class source_format, bool is_chroma)\n{\n\tunsigned int ret_val = 0;\n\n\tif (source_format == dm_444_16) {\n\t\tif (!is_chroma)\n\t\t\tret_val = 2;\n\t} else if (source_format == dm_444_32) {\n\t\tif (!is_chroma)\n\t\t\tret_val = 4;\n\t} else if (source_format == dm_444_64) {\n\t\tif (!is_chroma)\n\t\t\tret_val = 8;\n\t} else if (source_format == dm_420_8) {\n\t\tif (is_chroma)\n\t\t\tret_val = 2;\n\t\telse\n\t\t\tret_val = 1;\n\t} else if (source_format == dm_420_10) {\n\t\tif (is_chroma)\n\t\t\tret_val = 4;\n\t\telse\n\t\t\tret_val = 2;\n\t}\n\treturn ret_val;\n}\n\nstatic bool is_dual_plane(enum source_format_class source_format)\n{\n\tbool ret_val = 0;\n\n\tif ((source_format == dm_420_8) || (source_format == dm_420_10))\n\t\tret_val = 1;\n\n\treturn ret_val;\n}\n\nstatic void get_blk256_size(\n\t\tunsigned int *blk256_width,\n\t\tunsigned int *blk256_height,\n\t\tunsigned int bytes_per_element)\n{\n\tif (bytes_per_element == 1) {\n\t\t*blk256_width = 16;\n\t\t*blk256_height = 16;\n\t} else if (bytes_per_element == 2) {\n\t\t*blk256_width = 16;\n\t\t*blk256_height = 8;\n\t} else if (bytes_per_element == 4) {\n\t\t*blk256_width = 8;\n\t\t*blk256_height = 8;\n\t} else if (bytes_per_element == 8) {\n\t\t*blk256_width = 8;\n\t\t*blk256_height = 4;\n\t}\n}\n\nstatic double get_refcyc_per_delivery(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tdouble refclk_freq_in_mhz,\n\t\tdouble pclk_freq_in_mhz,\n\t\tunsigned int recout_width,\n\t\tdouble vratio,\n\t\tdouble hscale_pixel_rate,\n\t\tunsigned int delivery_width,\n\t\tunsigned int req_per_swath_ub)\n{\n\tdouble refcyc_per_delivery = 0.0;\n\n\tif (vratio <= 1.0) {\n\t\trefcyc_per_delivery = (double) refclk_freq_in_mhz * (double) recout_width\n\t\t\t\t/ pclk_freq_in_mhz / (double) req_per_swath_ub;\n\t} else {\n\t\trefcyc_per_delivery = (double) refclk_freq_in_mhz * (double) delivery_width\n\t\t\t\t/ (double) hscale_pixel_rate / (double) req_per_swath_ub;\n\t}\n\n\tDTRACE(\"DLG: %s: refclk_freq_in_mhz = %3.2f\", __func__, refclk_freq_in_mhz);\n\tDTRACE(\"DLG: %s: pclk_freq_in_mhz   = %3.2f\", __func__, pclk_freq_in_mhz);\n\tDTRACE(\"DLG: %s: recout_width       = %d\", __func__, recout_width);\n\tDTRACE(\"DLG: %s: vratio             = %3.2f\", __func__, vratio);\n\tDTRACE(\"DLG: %s: req_per_swath_ub   = %d\", __func__, req_per_swath_ub);\n\tDTRACE(\"DLG: %s: refcyc_per_delivery= %3.2f\", __func__, refcyc_per_delivery);\n\n\treturn refcyc_per_delivery;\n\n}\n\nstatic double get_vratio_pre(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tunsigned int max_num_sw,\n\t\tunsigned int max_partial_sw,\n\t\tunsigned int swath_height,\n\t\tdouble vinit,\n\t\tdouble l_sw)\n{\n\tdouble prefill = dml_floor(vinit, 1);\n\tdouble vratio_pre = 1.0;\n\n\tvratio_pre = (max_num_sw * swath_height + max_partial_sw) / l_sw;\n\n\tif (swath_height > 4) {\n\t\tdouble tmp0 = (max_num_sw * swath_height) / (l_sw - (prefill - 3.0) / 2.0);\n\n\t\tif (tmp0 > vratio_pre)\n\t\t\tvratio_pre = tmp0;\n\t}\n\n\tDTRACE(\"DLG: %s: max_num_sw        = %0d\", __func__, max_num_sw);\n\tDTRACE(\"DLG: %s: max_partial_sw    = %0d\", __func__, max_partial_sw);\n\tDTRACE(\"DLG: %s: swath_height      = %0d\", __func__, swath_height);\n\tDTRACE(\"DLG: %s: vinit             = %3.2f\", __func__, vinit);\n\tDTRACE(\"DLG: %s: vratio_pre        = %3.2f\", __func__, vratio_pre);\n\n\tif (vratio_pre < 1.0) {\n\t\tDTRACE(\"WARNING_DLG: %s:  vratio_pre=%3.2f < 1.0, set to 1.0\", __func__, vratio_pre);\n\t\tvratio_pre = 1.0;\n\t}\n\n\tif (vratio_pre > 4.0) {\n\t\tDTRACE(\n\t\t\t\t\"WARNING_DLG: %s:  vratio_pre=%3.2f > 4.0 (max scaling ratio). set to 4.0\",\n\t\t\t\t__func__,\n\t\t\t\tvratio_pre);\n\t\tvratio_pre = 4.0;\n\t}\n\n\treturn vratio_pre;\n}\n\nstatic void get_swath_need(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tunsigned int *max_num_sw,\n\t\tunsigned int *max_partial_sw,\n\t\tunsigned int swath_height,\n\t\tdouble vinit)\n{\n\tdouble prefill = dml_floor(vinit, 1);\n\tunsigned int max_partial_sw_int;\n\n\tDTRACE(\"DLG: %s: swath_height      = %0d\", __func__, swath_height);\n\tDTRACE(\"DLG: %s: vinit             = %3.2f\", __func__, vinit);\n\n\tASSERT(prefill > 0.0 && prefill <= 8.0);\n\n\t*max_num_sw = (unsigned int) (dml_ceil((prefill - 1.0) / (double) swath_height, 1) + 1.0);  \n\tmax_partial_sw_int =\n\t\t\t(prefill == 1) ?\n\t\t\t\t\t(swath_height - 1) :\n\t\t\t\t\t((unsigned int) (prefill - 2.0) % swath_height);\n\t*max_partial_sw = (max_partial_sw_int < 1) ? 1 : max_partial_sw_int;  \n\n\tDTRACE(\"DLG: %s: max_num_sw        = %0d\", __func__, *max_num_sw);\n\tDTRACE(\"DLG: %s: max_partial_sw    = %0d\", __func__, *max_partial_sw);\n}\n\nstatic unsigned int get_blk_size_bytes(const enum source_macro_tile_size tile_size)\n{\n\tif (tile_size == dm_256k_tile)\n\t\treturn (256 * 1024);\n\telse if (tile_size == dm_64k_tile)\n\t\treturn (64 * 1024);\n\telse\n\t\treturn (4 * 1024);\n}\n\nstatic void extract_rq_sizing_regs(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tstruct _vcs_dpi_display_data_rq_regs_st *rq_regs,\n\t\tconst struct _vcs_dpi_display_data_rq_sizing_params_st *rq_sizing)\n{\n\tDTRACE(\"DLG: %s: rq_sizing param\", __func__);\n\tprint__data_rq_sizing_params_st(mode_lib, rq_sizing);\n\n\trq_regs->chunk_size = dml_log2(rq_sizing->chunk_bytes) - 10;\n\n\tif (rq_sizing->min_chunk_bytes == 0)\n\t\trq_regs->min_chunk_size = 0;\n\telse\n\t\trq_regs->min_chunk_size = dml_log2(rq_sizing->min_chunk_bytes) - 8 + 1;\n\n\trq_regs->meta_chunk_size = dml_log2(rq_sizing->meta_chunk_bytes) - 10;\n\tif (rq_sizing->min_meta_chunk_bytes == 0)\n\t\trq_regs->min_meta_chunk_size = 0;\n\telse\n\t\trq_regs->min_meta_chunk_size = dml_log2(rq_sizing->min_meta_chunk_bytes) - 6 + 1;\n\n\trq_regs->dpte_group_size = dml_log2(rq_sizing->dpte_group_bytes) - 6;\n\trq_regs->mpte_group_size = dml_log2(rq_sizing->mpte_group_bytes) - 6;\n}\n\nvoid dml1_extract_rq_regs(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tstruct _vcs_dpi_display_rq_regs_st *rq_regs,\n\t\tconst struct _vcs_dpi_display_rq_params_st *rq_param)\n{\n\tunsigned int detile_buf_size_in_bytes = mode_lib->ip.det_buffer_size_kbytes * 1024;\n\tunsigned int detile_buf_plane1_addr = 0;\n\n\textract_rq_sizing_regs(mode_lib, &(rq_regs->rq_regs_l), &rq_param->sizing.rq_l);\n\tif (rq_param->yuv420)\n\t\textract_rq_sizing_regs(mode_lib, &(rq_regs->rq_regs_c), &rq_param->sizing.rq_c);\n\n\trq_regs->rq_regs_l.swath_height = dml_log2(rq_param->dlg.rq_l.swath_height);\n\trq_regs->rq_regs_c.swath_height = dml_log2(rq_param->dlg.rq_c.swath_height);\n\n\t \n\tif (rq_param->sizing.rq_l.chunk_bytes >= 32 * 1024) {  \n\t\trq_regs->drq_expansion_mode = 0;\n\t} else {\n\t\trq_regs->drq_expansion_mode = 2;\n\t}\n\trq_regs->prq_expansion_mode = 1;\n\trq_regs->mrq_expansion_mode = 1;\n\trq_regs->crq_expansion_mode = 1;\n\n\tif (rq_param->yuv420) {\n\t\tif ((double) rq_param->misc.rq_l.stored_swath_bytes\n\t\t\t\t/ (double) rq_param->misc.rq_c.stored_swath_bytes <= 1.5) {\n\t\t\tdetile_buf_plane1_addr = (detile_buf_size_in_bytes / 2.0 / 64.0);  \n\t\t} else {\n\t\t\tdetile_buf_plane1_addr = dml_round_to_multiple(\n\t\t\t\t\t(unsigned int) ((2.0 * detile_buf_size_in_bytes) / 3.0),\n\t\t\t\t\t256,\n\t\t\t\t\t0) / 64.0;  \n\t\t}\n\t}\n\trq_regs->plane1_base_address = detile_buf_plane1_addr;\n}\n\nstatic void handle_det_buf_split(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tstruct _vcs_dpi_display_rq_params_st *rq_param,\n\t\tconst struct _vcs_dpi_display_pipe_source_params_st *pipe_src_param)\n{\n\tunsigned int total_swath_bytes = 0;\n\tunsigned int swath_bytes_l = 0;\n\tunsigned int swath_bytes_c = 0;\n\tunsigned int full_swath_bytes_packed_l = 0;\n\tunsigned int full_swath_bytes_packed_c = 0;\n\tbool req128_l = 0;\n\tbool req128_c = 0;\n\tbool surf_linear = (pipe_src_param->sw_mode == dm_sw_linear);\n\tbool surf_vert = (pipe_src_param->source_scan == dm_vert);\n\tunsigned int log2_swath_height_l = 0;\n\tunsigned int log2_swath_height_c = 0;\n\tunsigned int detile_buf_size_in_bytes = mode_lib->ip.det_buffer_size_kbytes * 1024;\n\n\tfull_swath_bytes_packed_l = rq_param->misc.rq_l.full_swath_bytes;\n\tfull_swath_bytes_packed_c = rq_param->misc.rq_c.full_swath_bytes;\n\n\tif (rq_param->yuv420_10bpc) {\n\t\tfull_swath_bytes_packed_l = dml_round_to_multiple(\n\t\t\t\trq_param->misc.rq_l.full_swath_bytes * 2 / 3,\n\t\t\t\t256,\n\t\t\t\t1) + 256;\n\t\tfull_swath_bytes_packed_c = dml_round_to_multiple(\n\t\t\t\trq_param->misc.rq_c.full_swath_bytes * 2 / 3,\n\t\t\t\t256,\n\t\t\t\t1) + 256;\n\t}\n\n\tif (rq_param->yuv420) {\n\t\ttotal_swath_bytes = 2 * full_swath_bytes_packed_l + 2 * full_swath_bytes_packed_c;\n\n\t\tif (total_swath_bytes <= detile_buf_size_in_bytes) {  \n\t\t\treq128_l = 0;\n\t\t\treq128_c = 0;\n\t\t\tswath_bytes_l = full_swath_bytes_packed_l;\n\t\t\tswath_bytes_c = full_swath_bytes_packed_c;\n\t\t} else {  \n\t\t\treq128_l = 1;\n\t\t\treq128_c = 0;\n\t\t\tswath_bytes_l = full_swath_bytes_packed_l / 2;\n\t\t\tswath_bytes_c = full_swath_bytes_packed_c;\n\t\t}\n\n\t\t \n\t\tif (req128_l == 1) {\n\t\t\treq128_c = 1;\n\t\t\tDTRACE(\"DLG: %s: bug workaround DEGVIDCN10-137\", __func__);\n\t\t}\n\n\t\t \n\t} else {\n\t\ttotal_swath_bytes = 2 * full_swath_bytes_packed_l;\n\n\t\tif (total_swath_bytes <= detile_buf_size_in_bytes)\n\t\t\treq128_l = 0;\n\t\telse\n\t\t\treq128_l = 1;\n\n\t\tswath_bytes_l = total_swath_bytes;\n\t\tswath_bytes_c = 0;\n\t}\n\trq_param->misc.rq_l.stored_swath_bytes = swath_bytes_l;\n\trq_param->misc.rq_c.stored_swath_bytes = swath_bytes_c;\n\n\tif (surf_linear) {\n\t\tlog2_swath_height_l = 0;\n\t\tlog2_swath_height_c = 0;\n\t} else {\n\t\tunsigned int swath_height_l;\n\t\tunsigned int swath_height_c;\n\n\t\tif (!surf_vert) {\n\t\t\tswath_height_l = rq_param->misc.rq_l.blk256_height;\n\t\t\tswath_height_c = rq_param->misc.rq_c.blk256_height;\n\t\t} else {\n\t\t\tswath_height_l = rq_param->misc.rq_l.blk256_width;\n\t\t\tswath_height_c = rq_param->misc.rq_c.blk256_width;\n\t\t}\n\n\t\tif (swath_height_l > 0)\n\t\t\tlog2_swath_height_l = dml_log2(swath_height_l);\n\n\t\tif (req128_l && log2_swath_height_l > 0)\n\t\t\tlog2_swath_height_l -= 1;\n\n\t\tif (swath_height_c > 0)\n\t\t\tlog2_swath_height_c = dml_log2(swath_height_c);\n\n\t\tif (req128_c && log2_swath_height_c > 0)\n\t\t\tlog2_swath_height_c -= 1;\n\t}\n\n\trq_param->dlg.rq_l.swath_height = 1 << log2_swath_height_l;\n\trq_param->dlg.rq_c.swath_height = 1 << log2_swath_height_c;\n\n\tDTRACE(\"DLG: %s: req128_l = %0d\", __func__, req128_l);\n\tDTRACE(\"DLG: %s: req128_c = %0d\", __func__, req128_c);\n\tDTRACE(\"DLG: %s: full_swath_bytes_packed_l = %0d\", __func__, full_swath_bytes_packed_l);\n\tDTRACE(\"DLG: %s: full_swath_bytes_packed_c = %0d\", __func__, full_swath_bytes_packed_c);\n}\n\n \nstatic void dml1_rq_dlg_get_row_heights(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tunsigned int *o_dpte_row_height,\n\t\tunsigned int *o_meta_row_height,\n\t\tunsigned int vp_width,\n\t\tunsigned int data_pitch,\n\t\tint source_format,\n\t\tint tiling,\n\t\tint macro_tile_size,\n\t\tint source_scan,\n\t\tint is_chroma)\n{\n\tbool surf_linear = (tiling == dm_sw_linear);\n\tbool surf_vert = (source_scan == dm_vert);\n\n\tunsigned int bytes_per_element = get_bytes_per_element(\n\t\t\t(enum source_format_class) source_format,\n\t\t\tis_chroma);\n\tunsigned int log2_bytes_per_element = dml_log2(bytes_per_element);\n\tunsigned int blk256_width = 0;\n\tunsigned int blk256_height = 0;\n\n\tunsigned int log2_blk256_height;\n\tunsigned int blk_bytes;\n\tunsigned int log2_blk_bytes;\n\tunsigned int log2_blk_height;\n\tunsigned int log2_blk_width;\n\tunsigned int log2_meta_req_bytes;\n\tunsigned int log2_meta_req_height;\n\tunsigned int log2_meta_req_width;\n\tunsigned int log2_meta_row_height;\n\tunsigned int log2_vmpg_bytes;\n\tunsigned int dpte_buf_in_pte_reqs;\n\tunsigned int log2_vmpg_height;\n\tunsigned int log2_vmpg_width;\n\tunsigned int log2_dpte_req_height_ptes;\n\tunsigned int log2_dpte_req_width_ptes;\n\tunsigned int log2_dpte_req_height;\n\tunsigned int log2_dpte_req_width;\n\tunsigned int log2_dpte_row_height_linear;\n\tunsigned int log2_dpte_row_height;\n\tunsigned int dpte_req_width;\n\n\tif (surf_linear) {\n\t\tblk256_width = 256;\n\t\tblk256_height = 1;\n\t} else {\n\t\tget_blk256_size(&blk256_width, &blk256_height, bytes_per_element);\n\t}\n\n\tlog2_blk256_height = dml_log2((double) blk256_height);\n\tblk_bytes = surf_linear ?\n\t\t\t256 : get_blk_size_bytes((enum source_macro_tile_size) macro_tile_size);\n\tlog2_blk_bytes = dml_log2((double) blk_bytes);\n\tlog2_blk_height = 0;\n\tlog2_blk_width = 0;\n\n\t \n\tif (tiling != dm_sw_linear)\n\t\tlog2_blk_height = log2_blk256_height\n\t\t\t\t+ dml_ceil((double) (log2_blk_bytes - 8) / 2.0, 1);\n\telse\n\t\tlog2_blk_height = 0;  \n\n\tlog2_blk_width = log2_blk_bytes - log2_bytes_per_element - log2_blk_height;\n\n\t \n\t \n\t \n\tlog2_meta_req_bytes = 6;  \n\n\t \n\tlog2_meta_req_height = log2_blk256_height + 3;  \n\tlog2_meta_req_width = log2_meta_req_bytes + 8 - log2_bytes_per_element\n\t\t\t- log2_meta_req_height;\n\tlog2_meta_row_height = 0;\n\n\t \n\tif (!surf_vert)\n\t\tlog2_meta_row_height = log2_meta_req_height;\n\telse\n\t\tlog2_meta_row_height = log2_meta_req_width;\n\n\t*o_meta_row_height = 1 << log2_meta_row_height;\n\n\t \n\t \n\t \n\tlog2_vmpg_bytes = dml_log2(mode_lib->soc.vmm_page_size_bytes);\n\tdpte_buf_in_pte_reqs = mode_lib->ip.dpte_buffer_size_in_pte_reqs_luma;\n\n\tlog2_vmpg_height = 0;\n\tlog2_vmpg_width = 0;\n\tlog2_dpte_req_height_ptes = 0;\n\tlog2_dpte_req_width_ptes = 0;\n\tlog2_dpte_req_height = 0;\n\tlog2_dpte_req_width = 0;\n\tlog2_dpte_row_height_linear = 0;\n\tlog2_dpte_row_height = 0;\n\tdpte_req_width = 0;  \n\n\tif (surf_linear)\n\t\tlog2_vmpg_height = 0;  \n\telse\n\t\tlog2_vmpg_height = (log2_vmpg_bytes - 8) / 2 + log2_blk256_height;\n\tlog2_vmpg_width = log2_vmpg_bytes - log2_bytes_per_element - log2_vmpg_height;\n\n\t \n\tif (log2_blk_bytes <= log2_vmpg_bytes)\n\t\tlog2_dpte_req_height_ptes = 0;\n\telse if (log2_blk_height - log2_vmpg_height >= 2)\n\t\tlog2_dpte_req_height_ptes = 2;\n\telse\n\t\tlog2_dpte_req_height_ptes = log2_blk_height - log2_vmpg_height;\n\tlog2_dpte_req_width_ptes = 3 - log2_dpte_req_height_ptes;\n\n\tASSERT((log2_dpte_req_width_ptes == 3 && log2_dpte_req_height_ptes == 0) ||  \n\t\t\t(log2_dpte_req_width_ptes == 2 && log2_dpte_req_height_ptes == 1) ||  \n\t\t\t(log2_dpte_req_width_ptes == 1 && log2_dpte_req_height_ptes == 2));  \n\n\t \n\tlog2_dpte_req_height = log2_vmpg_height + log2_dpte_req_height_ptes;\n\tlog2_dpte_req_width = log2_vmpg_width + log2_dpte_req_width_ptes;\n\tdpte_req_width = 1 << log2_dpte_req_width;\n\n\t \n\tif (surf_linear) {\n\t\tlog2_dpte_row_height_linear = dml_floor(\n\t\t\t\tdml_log2(dpte_buf_in_pte_reqs * dpte_req_width / data_pitch),\n\t\t\t\t1);\n\n\t\tASSERT(log2_dpte_row_height_linear >= 3);\n\n\t\tif (log2_dpte_row_height_linear > 7)\n\t\t\tlog2_dpte_row_height_linear = 7;\n\n\t\tlog2_dpte_row_height = log2_dpte_row_height_linear;\n\t} else {\n\t\t \n\t\tif (!surf_vert)\n\t\t\tlog2_dpte_row_height = log2_dpte_req_height;\n\t\telse\n\t\t\tlog2_dpte_row_height =\n\t\t\t\t\t(log2_blk_width < log2_dpte_req_width) ?\n\t\t\t\t\t\t\tlog2_blk_width : log2_dpte_req_width;\n\t}\n\n\t \n\tif (!surf_vert && vp_width > (2560 + 16) && bytes_per_element >= 4 && log2_vmpg_bytes == 12\n\t\t\t&& log2_blk_bytes >= 16)\n\t\tlog2_dpte_row_height = log2_dpte_row_height - 1;  \n\n\t*o_dpte_row_height = 1 << log2_dpte_row_height;\n}\n\nstatic void get_surf_rq_param(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tstruct _vcs_dpi_display_data_rq_sizing_params_st *rq_sizing_param,\n\t\tstruct _vcs_dpi_display_data_rq_dlg_params_st *rq_dlg_param,\n\t\tstruct _vcs_dpi_display_data_rq_misc_params_st *rq_misc_param,\n\t\tconst struct _vcs_dpi_display_pipe_source_params_st *pipe_src_param,\n\t\tbool is_chroma)\n{\n\tbool mode_422 = 0;\n\tunsigned int vp_width = 0;\n\tunsigned int vp_height = 0;\n\tunsigned int data_pitch = 0;\n\tunsigned int meta_pitch = 0;\n\tunsigned int ppe = mode_422 ? 2 : 1;\n\tbool surf_linear;\n\tbool surf_vert;\n\tunsigned int bytes_per_element;\n\tunsigned int log2_bytes_per_element;\n\tunsigned int blk256_width;\n\tunsigned int blk256_height;\n\tunsigned int log2_blk256_width;\n\tunsigned int log2_blk256_height;\n\tunsigned int blk_bytes;\n\tunsigned int log2_blk_bytes;\n\tunsigned int log2_blk_height;\n\tunsigned int log2_blk_width;\n\tunsigned int log2_meta_req_bytes;\n\tunsigned int log2_meta_req_height;\n\tunsigned int log2_meta_req_width;\n\tunsigned int meta_req_width;\n\tunsigned int meta_req_height;\n\tunsigned int log2_meta_row_height;\n\tunsigned int meta_row_width_ub;\n\tunsigned int log2_meta_chunk_bytes;\n\tunsigned int log2_meta_chunk_height;\n\tunsigned int log2_meta_chunk_width;\n\tunsigned int log2_min_meta_chunk_bytes;\n\tunsigned int min_meta_chunk_width;\n\tunsigned int meta_chunk_width;\n\tunsigned int meta_chunk_per_row_int;\n\tunsigned int meta_row_remainder;\n\tunsigned int meta_chunk_threshold;\n\tunsigned int meta_blk_bytes;\n\tunsigned int meta_blk_height;\n\tunsigned int meta_blk_width;\n\tunsigned int meta_surface_bytes;\n\tunsigned int vmpg_bytes;\n\tunsigned int meta_pte_req_per_frame_ub;\n\tunsigned int meta_pte_bytes_per_frame_ub;\n\tunsigned int log2_vmpg_bytes;\n\tunsigned int dpte_buf_in_pte_reqs;\n\tunsigned int log2_vmpg_height;\n\tunsigned int log2_vmpg_width;\n\tunsigned int log2_dpte_req_height_ptes;\n\tunsigned int log2_dpte_req_width_ptes;\n\tunsigned int log2_dpte_req_height;\n\tunsigned int log2_dpte_req_width;\n\tunsigned int log2_dpte_row_height_linear;\n\tunsigned int log2_dpte_row_height;\n\tunsigned int log2_dpte_group_width;\n\tunsigned int dpte_row_width_ub;\n\tunsigned int dpte_row_height;\n\tunsigned int dpte_req_height;\n\tunsigned int dpte_req_width;\n\tunsigned int dpte_group_width;\n\tunsigned int log2_dpte_group_bytes;\n\tunsigned int log2_dpte_group_length;\n\tunsigned int func_meta_row_height, func_dpte_row_height;\n\n\t \n\tif (is_chroma) {\n\t\tvp_width = pipe_src_param->viewport_width_c / ppe;\n\t\tvp_height = pipe_src_param->viewport_height_c;\n\t\tdata_pitch = pipe_src_param->data_pitch_c;\n\t\tmeta_pitch = pipe_src_param->meta_pitch_c;\n\t} else {\n\t\tvp_width = pipe_src_param->viewport_width / ppe;\n\t\tvp_height = pipe_src_param->viewport_height;\n\t\tdata_pitch = pipe_src_param->data_pitch;\n\t\tmeta_pitch = pipe_src_param->meta_pitch;\n\t}\n\n\trq_sizing_param->chunk_bytes = 8192;\n\n\tif (rq_sizing_param->chunk_bytes == 64 * 1024)\n\t\trq_sizing_param->min_chunk_bytes = 0;\n\telse\n\t\trq_sizing_param->min_chunk_bytes = 1024;\n\n\trq_sizing_param->meta_chunk_bytes = 2048;\n\trq_sizing_param->min_meta_chunk_bytes = 256;\n\n\trq_sizing_param->mpte_group_bytes = 2048;\n\n\tsurf_linear = (pipe_src_param->sw_mode == dm_sw_linear);\n\tsurf_vert = (pipe_src_param->source_scan == dm_vert);\n\n\tbytes_per_element = get_bytes_per_element(\n\t\t\t(enum source_format_class) pipe_src_param->source_format,\n\t\t\tis_chroma);\n\tlog2_bytes_per_element = dml_log2(bytes_per_element);\n\tblk256_width = 0;\n\tblk256_height = 0;\n\n\tif (surf_linear) {\n\t\tblk256_width = 256 / bytes_per_element;\n\t\tblk256_height = 1;\n\t} else {\n\t\tget_blk256_size(&blk256_width, &blk256_height, bytes_per_element);\n\t}\n\n\tDTRACE(\"DLG: %s: surf_linear        = %d\", __func__, surf_linear);\n\tDTRACE(\"DLG: %s: surf_vert          = %d\", __func__, surf_vert);\n\tDTRACE(\"DLG: %s: blk256_width       = %d\", __func__, blk256_width);\n\tDTRACE(\"DLG: %s: blk256_height      = %d\", __func__, blk256_height);\n\n\tlog2_blk256_width = dml_log2((double) blk256_width);\n\tlog2_blk256_height = dml_log2((double) blk256_height);\n\tblk_bytes =\n\t\t\tsurf_linear ? 256 : get_blk_size_bytes(\n\t\t\t\t\t\t\t(enum source_macro_tile_size) pipe_src_param->macro_tile_size);\n\tlog2_blk_bytes = dml_log2((double) blk_bytes);\n\tlog2_blk_height = 0;\n\tlog2_blk_width = 0;\n\n\t \n\tif (pipe_src_param->sw_mode != dm_sw_linear)\n\t\tlog2_blk_height = log2_blk256_height\n\t\t\t\t+ dml_ceil((double) (log2_blk_bytes - 8) / 2.0, 1);\n\telse\n\t\tlog2_blk_height = 0;  \n\n\tlog2_blk_width = log2_blk_bytes - log2_bytes_per_element - log2_blk_height;\n\n\tif (!surf_vert) {\n\t\trq_dlg_param->swath_width_ub = dml_round_to_multiple(vp_width - 1, blk256_width, 1)\n\t\t\t\t+ blk256_width;\n\t\trq_dlg_param->req_per_swath_ub = rq_dlg_param->swath_width_ub >> log2_blk256_width;\n\t} else {\n\t\trq_dlg_param->swath_width_ub = dml_round_to_multiple(\n\t\t\t\tvp_height - 1,\n\t\t\t\tblk256_height,\n\t\t\t\t1) + blk256_height;\n\t\trq_dlg_param->req_per_swath_ub = rq_dlg_param->swath_width_ub >> log2_blk256_height;\n\t}\n\n\tif (!surf_vert)\n\t\trq_misc_param->full_swath_bytes = rq_dlg_param->swath_width_ub * blk256_height\n\t\t\t\t* bytes_per_element;\n\telse\n\t\trq_misc_param->full_swath_bytes = rq_dlg_param->swath_width_ub * blk256_width\n\t\t\t\t* bytes_per_element;\n\n\trq_misc_param->blk256_height = blk256_height;\n\trq_misc_param->blk256_width = blk256_width;\n\n\t \n\t \n\t \n\tlog2_meta_req_bytes = 6;  \n\n\t \n\tlog2_meta_req_height = log2_blk256_height + 3;  \n\tlog2_meta_req_width = log2_meta_req_bytes + 8 - log2_bytes_per_element\n\t\t\t- log2_meta_req_height;\n\tmeta_req_width = 1 << log2_meta_req_width;\n\tmeta_req_height = 1 << log2_meta_req_height;\n\tlog2_meta_row_height = 0;\n\tmeta_row_width_ub = 0;\n\n\t \n\tif (!surf_vert) {\n\t\tlog2_meta_row_height = log2_meta_req_height;\n\t\tmeta_row_width_ub = dml_round_to_multiple(vp_width - 1, meta_req_width, 1)\n\t\t\t\t+ meta_req_width;\n\t\trq_dlg_param->meta_req_per_row_ub = meta_row_width_ub / meta_req_width;\n\t} else {\n\t\tlog2_meta_row_height = log2_meta_req_width;\n\t\tmeta_row_width_ub = dml_round_to_multiple(vp_height - 1, meta_req_height, 1)\n\t\t\t\t+ meta_req_height;\n\t\trq_dlg_param->meta_req_per_row_ub = meta_row_width_ub / meta_req_height;\n\t}\n\trq_dlg_param->meta_bytes_per_row_ub = rq_dlg_param->meta_req_per_row_ub * 64;\n\n\tlog2_meta_chunk_bytes = dml_log2(rq_sizing_param->meta_chunk_bytes);\n\tlog2_meta_chunk_height = log2_meta_row_height;\n\n\t \n\tlog2_meta_chunk_width = log2_meta_chunk_bytes + 8 - log2_bytes_per_element\n\t\t\t- log2_meta_chunk_height;\n\tlog2_min_meta_chunk_bytes = dml_log2(rq_sizing_param->min_meta_chunk_bytes);\n\tmin_meta_chunk_width = 1\n\t\t\t<< (log2_min_meta_chunk_bytes + 8 - log2_bytes_per_element\n\t\t\t\t\t- log2_meta_chunk_height);\n\tmeta_chunk_width = 1 << log2_meta_chunk_width;\n\tmeta_chunk_per_row_int = (unsigned int) (meta_row_width_ub / meta_chunk_width);\n\tmeta_row_remainder = meta_row_width_ub % meta_chunk_width;\n\tmeta_chunk_threshold = 0;\n\tmeta_blk_bytes = 4096;\n\tmeta_blk_height = blk256_height * 64;\n\tmeta_blk_width = meta_blk_bytes * 256 / bytes_per_element / meta_blk_height;\n\tmeta_surface_bytes = meta_pitch\n\t\t\t* (dml_round_to_multiple(vp_height - 1, meta_blk_height, 1)\n\t\t\t\t\t+ meta_blk_height) * bytes_per_element / 256;\n\tvmpg_bytes = mode_lib->soc.vmm_page_size_bytes;\n\tmeta_pte_req_per_frame_ub = (dml_round_to_multiple(\n\t\t\tmeta_surface_bytes - vmpg_bytes,\n\t\t\t8 * vmpg_bytes,\n\t\t\t1) + 8 * vmpg_bytes) / (8 * vmpg_bytes);\n\tmeta_pte_bytes_per_frame_ub = meta_pte_req_per_frame_ub * 64;  \n\trq_dlg_param->meta_pte_bytes_per_frame_ub = meta_pte_bytes_per_frame_ub;\n\n\tDTRACE(\"DLG: %s: meta_blk_height             = %d\", __func__, meta_blk_height);\n\tDTRACE(\"DLG: %s: meta_blk_width              = %d\", __func__, meta_blk_width);\n\tDTRACE(\"DLG: %s: meta_surface_bytes          = %d\", __func__, meta_surface_bytes);\n\tDTRACE(\"DLG: %s: meta_pte_req_per_frame_ub   = %d\", __func__, meta_pte_req_per_frame_ub);\n\tDTRACE(\"DLG: %s: meta_pte_bytes_per_frame_ub = %d\", __func__, meta_pte_bytes_per_frame_ub);\n\n\tif (!surf_vert)\n\t\tmeta_chunk_threshold = 2 * min_meta_chunk_width - meta_req_width;\n\telse\n\t\tmeta_chunk_threshold = 2 * min_meta_chunk_width - meta_req_height;\n\n\tif (meta_row_remainder <= meta_chunk_threshold)\n\t\trq_dlg_param->meta_chunks_per_row_ub = meta_chunk_per_row_int + 1;\n\telse\n\t\trq_dlg_param->meta_chunks_per_row_ub = meta_chunk_per_row_int + 2;\n\n\trq_dlg_param->meta_row_height = 1 << log2_meta_row_height;\n\n\t \n\t \n\t \n\tlog2_vmpg_bytes = dml_log2(mode_lib->soc.vmm_page_size_bytes);\n\tdpte_buf_in_pte_reqs = mode_lib->ip.dpte_buffer_size_in_pte_reqs_luma;\n\n\tlog2_vmpg_height = 0;\n\tlog2_vmpg_width = 0;\n\tlog2_dpte_req_height_ptes = 0;\n\tlog2_dpte_req_width_ptes = 0;\n\tlog2_dpte_req_height = 0;\n\tlog2_dpte_req_width = 0;\n\tlog2_dpte_row_height_linear = 0;\n\tlog2_dpte_row_height = 0;\n\tlog2_dpte_group_width = 0;\n\tdpte_row_width_ub = 0;\n\tdpte_row_height = 0;\n\tdpte_req_height = 0;  \n\tdpte_req_width = 0;  \n\tdpte_group_width = 0;\n\tlog2_dpte_group_bytes = 0;\n\tlog2_dpte_group_length = 0;\n\n\tif (surf_linear)\n\t\tlog2_vmpg_height = 0;  \n\telse\n\t\tlog2_vmpg_height = (log2_vmpg_bytes - 8) / 2 + log2_blk256_height;\n\tlog2_vmpg_width = log2_vmpg_bytes - log2_bytes_per_element - log2_vmpg_height;\n\n\t \n\tif (log2_blk_bytes <= log2_vmpg_bytes)\n\t\tlog2_dpte_req_height_ptes = 0;\n\telse if (log2_blk_height - log2_vmpg_height >= 2)\n\t\tlog2_dpte_req_height_ptes = 2;\n\telse\n\t\tlog2_dpte_req_height_ptes = log2_blk_height - log2_vmpg_height;\n\tlog2_dpte_req_width_ptes = 3 - log2_dpte_req_height_ptes;\n\n\t \n\tASSERT((log2_dpte_req_width_ptes == 3 && log2_dpte_req_height_ptes == 0) ||  \n\t\t\t(log2_dpte_req_width_ptes == 2 && log2_dpte_req_height_ptes == 1) ||  \n\t\t\t(log2_dpte_req_width_ptes == 1 && log2_dpte_req_height_ptes == 2));  \n\n\t \n\tlog2_dpte_req_height = log2_vmpg_height + log2_dpte_req_height_ptes;\n\tlog2_dpte_req_width = log2_vmpg_width + log2_dpte_req_width_ptes;\n\tdpte_req_height = 1 << log2_dpte_req_height;\n\tdpte_req_width = 1 << log2_dpte_req_width;\n\n\t \n\tif (surf_linear) {\n\t\tlog2_dpte_row_height_linear = dml_floor(\n\t\t\t\tdml_log2(dpte_buf_in_pte_reqs * dpte_req_width / data_pitch),\n\t\t\t\t1);\n\n\t\tASSERT(log2_dpte_row_height_linear >= 3);\n\n\t\tif (log2_dpte_row_height_linear > 7)\n\t\t\tlog2_dpte_row_height_linear = 7;\n\n\t\tlog2_dpte_row_height = log2_dpte_row_height_linear;\n\t\trq_dlg_param->dpte_row_height = 1 << log2_dpte_row_height;\n\n\t\t \n\t\tdpte_row_width_ub = dml_round_to_multiple(\n\t\t\t\tdata_pitch * dpte_row_height - 1,\n\t\t\t\tdpte_req_width,\n\t\t\t\t1) + dpte_req_width;\n\t\trq_dlg_param->dpte_req_per_row_ub = dpte_row_width_ub / dpte_req_width;\n\t} else {\n\t\t \n\t\tif (!surf_vert) {\n\t\t\tlog2_dpte_row_height = log2_dpte_req_height;\n\t\t\tdpte_row_width_ub = dml_round_to_multiple(vp_width - 1, dpte_req_width, 1)\n\t\t\t\t\t+ dpte_req_width;\n\t\t\trq_dlg_param->dpte_req_per_row_ub = dpte_row_width_ub / dpte_req_width;\n\t\t} else {\n\t\t\tlog2_dpte_row_height =\n\t\t\t\t\t(log2_blk_width < log2_dpte_req_width) ?\n\t\t\t\t\t\t\tlog2_blk_width : log2_dpte_req_width;\n\t\t\tdpte_row_width_ub = dml_round_to_multiple(vp_height - 1, dpte_req_height, 1)\n\t\t\t\t\t+ dpte_req_height;\n\t\t\trq_dlg_param->dpte_req_per_row_ub = dpte_row_width_ub / dpte_req_height;\n\t\t}\n\t\trq_dlg_param->dpte_row_height = 1 << log2_dpte_row_height;\n\t}\n\trq_dlg_param->dpte_bytes_per_row_ub = rq_dlg_param->dpte_req_per_row_ub * 64;\n\n\t \n\tif (!surf_vert && vp_width > (2560 + 16) && bytes_per_element >= 4 && log2_vmpg_bytes == 12\n\t\t\t&& log2_blk_bytes >= 16) {\n\t\tlog2_dpte_row_height = log2_dpte_row_height - 1;  \n\t\trq_dlg_param->dpte_row_height = 1 << log2_dpte_row_height;\n\t}\n\n\t \n\tif (!surf_linear && (log2_dpte_req_height_ptes == 0) && surf_vert)  \n\t\trq_sizing_param->dpte_group_bytes = 512;\n\telse\n\t\t \n\t\trq_sizing_param->dpte_group_bytes = 2048;\n\n\t \n\tlog2_dpte_group_bytes = dml_log2(rq_sizing_param->dpte_group_bytes);\n\tlog2_dpte_group_length = log2_dpte_group_bytes - 6;  \n\n\t \n\tif (!surf_vert)\n\t\tlog2_dpte_group_width = log2_dpte_group_length + log2_dpte_req_width;\n\telse\n\t\tlog2_dpte_group_width = log2_dpte_group_length + log2_dpte_req_height;\n\n\tdpte_group_width = 1 << log2_dpte_group_width;\n\n\t \n\trq_dlg_param->dpte_groups_per_row_ub = dml_ceil(\n\t\t\t(double) dpte_row_width_ub / dpte_group_width,\n\t\t\t1);\n\n\tdml1_rq_dlg_get_row_heights(\n\t\t\tmode_lib,\n\t\t\t&func_dpte_row_height,\n\t\t\t&func_meta_row_height,\n\t\t\tvp_width,\n\t\t\tdata_pitch,\n\t\t\tpipe_src_param->source_format,\n\t\t\tpipe_src_param->sw_mode,\n\t\t\tpipe_src_param->macro_tile_size,\n\t\t\tpipe_src_param->source_scan,\n\t\t\tis_chroma);\n\n\t \n\tif (rq_dlg_param->meta_row_height != func_meta_row_height) {\n\t\tDTRACE(\n\t\t\t\t\"MISMATCH: rq_dlg_param->meta_row_height = %d\",\n\t\t\t\trq_dlg_param->meta_row_height);\n\t\tDTRACE(\"MISMATCH: func_meta_row_height = %d\", func_meta_row_height);\n\t\tASSERT(0);\n\t}\n\n\tif (rq_dlg_param->dpte_row_height != func_dpte_row_height) {\n\t\tDTRACE(\n\t\t\t\t\"MISMATCH: rq_dlg_param->dpte_row_height = %d\",\n\t\t\t\trq_dlg_param->dpte_row_height);\n\t\tDTRACE(\"MISMATCH: func_dpte_row_height = %d\", func_dpte_row_height);\n\t\tASSERT(0);\n\t}\n}\n\nvoid dml1_rq_dlg_get_rq_params(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tstruct _vcs_dpi_display_rq_params_st *rq_param,\n\t\tconst struct _vcs_dpi_display_pipe_source_params_st *pipe_src_param)\n{\n\t \n\trq_param->yuv420 = pipe_src_param->source_format == dm_420_8\n\t\t\t|| pipe_src_param->source_format == dm_420_10;\n\trq_param->yuv420_10bpc = pipe_src_param->source_format == dm_420_10;\n\n\tget_surf_rq_param(\n\t\t\tmode_lib,\n\t\t\t&(rq_param->sizing.rq_l),\n\t\t\t&(rq_param->dlg.rq_l),\n\t\t\t&(rq_param->misc.rq_l),\n\t\t\tpipe_src_param,\n\t\t\t0);\n\n\tif (is_dual_plane((enum source_format_class) pipe_src_param->source_format)) {\n\t\t \n\t\tget_surf_rq_param(\n\t\t\t\tmode_lib,\n\t\t\t\t&(rq_param->sizing.rq_c),\n\t\t\t\t&(rq_param->dlg.rq_c),\n\t\t\t\t&(rq_param->misc.rq_c),\n\t\t\t\tpipe_src_param,\n\t\t\t\t1);\n\t}\n\n\t \n\thandle_det_buf_split(mode_lib, rq_param, pipe_src_param);\n\tprint__rq_params_st(mode_lib, rq_param);\n}\n\n \nvoid dml1_rq_dlg_get_dlg_params(\n\t\tstruct display_mode_lib *mode_lib,\n\t\tstruct _vcs_dpi_display_dlg_regs_st *disp_dlg_regs,\n\t\tstruct _vcs_dpi_display_ttu_regs_st *disp_ttu_regs,\n\t\tconst struct _vcs_dpi_display_rq_dlg_params_st *rq_dlg_param,\n\t\tconst struct _vcs_dpi_display_dlg_sys_params_st *dlg_sys_param,\n\t\tconst struct _vcs_dpi_display_e2e_pipe_params_st *e2e_pipe_param,\n\t\tconst bool cstate_en,\n\t\tconst bool pstate_en,\n\t\tconst bool vm_en,\n\t\tconst bool iflip_en)\n{\n\t \n\tunsigned int htotal = e2e_pipe_param->pipe.dest.htotal;\n\tunsigned int hblank_end = e2e_pipe_param->pipe.dest.hblank_end;\n\tunsigned int vblank_start = e2e_pipe_param->pipe.dest.vblank_start;\n\tunsigned int vblank_end = e2e_pipe_param->pipe.dest.vblank_end;\n\tbool interlaced = e2e_pipe_param->pipe.dest.interlaced;\n\tunsigned int min_vblank = mode_lib->ip.min_vblank_lines;\n\n\tdouble pclk_freq_in_mhz = e2e_pipe_param->pipe.dest.pixel_rate_mhz;\n\tdouble refclk_freq_in_mhz = e2e_pipe_param->clks_cfg.refclk_mhz;\n\tdouble dppclk_freq_in_mhz = e2e_pipe_param->clks_cfg.dppclk_mhz;\n\tdouble dispclk_freq_in_mhz = e2e_pipe_param->clks_cfg.dispclk_mhz;\n\n\tdouble ref_freq_to_pix_freq;\n\tdouble prefetch_xy_calc_in_dcfclk;\n\tdouble min_dcfclk_mhz;\n\tdouble t_calc_us;\n\tdouble min_ttu_vblank;\n\tdouble min_dst_y_ttu_vblank;\n\tunsigned int dlg_vblank_start;\n\tbool dcc_en;\n\tbool dual_plane;\n\tbool mode_422;\n\tunsigned int access_dir;\n\tunsigned int bytes_per_element_l;\n\tunsigned int bytes_per_element_c;\n\tunsigned int vp_height_l;\n\tunsigned int vp_width_l;\n\tunsigned int vp_height_c;\n\tunsigned int vp_width_c;\n\tunsigned int htaps_l;\n\tunsigned int htaps_c;\n\tdouble hratios_l;\n\tdouble hratios_c;\n\tdouble vratio_l;\n\tdouble vratio_c;\n\tdouble line_time_in_us;\n\tdouble vinit_l;\n\tdouble vinit_c;\n\tdouble vinit_bot_l;\n\tdouble vinit_bot_c;\n\tunsigned int swath_height_l;\n\tunsigned int swath_width_ub_l;\n\tunsigned int dpte_bytes_per_row_ub_l;\n\tunsigned int dpte_groups_per_row_ub_l;\n\tunsigned int meta_pte_bytes_per_frame_ub_l;\n\tunsigned int meta_bytes_per_row_ub_l;\n\tunsigned int swath_height_c;\n\tunsigned int swath_width_ub_c;\n\tunsigned int dpte_bytes_per_row_ub_c;\n\tunsigned int dpte_groups_per_row_ub_c;\n\tunsigned int meta_chunks_per_row_ub_l;\n\tunsigned int vupdate_offset;\n\tunsigned int vupdate_width;\n\tunsigned int vready_offset;\n\tunsigned int dppclk_delay_subtotal;\n\tunsigned int dispclk_delay_subtotal;\n\tunsigned int pixel_rate_delay_subtotal;\n\tunsigned int vstartup_start;\n\tunsigned int dst_x_after_scaler;\n\tunsigned int dst_y_after_scaler;\n\tdouble line_wait;\n\tdouble line_o;\n\tdouble line_setup;\n\tdouble line_calc;\n\tdouble dst_y_prefetch;\n\tdouble t_pre_us;\n\tunsigned int vm_bytes;\n\tunsigned int meta_row_bytes;\n\tunsigned int max_num_sw_l;\n\tunsigned int max_num_sw_c;\n\tunsigned int max_partial_sw_l;\n\tunsigned int max_partial_sw_c;\n\tdouble max_vinit_l;\n\tdouble max_vinit_c;\n\tunsigned int lsw_l;\n\tunsigned int lsw_c;\n\tunsigned int sw_bytes_ub_l;\n\tunsigned int sw_bytes_ub_c;\n\tunsigned int sw_bytes;\n\tunsigned int dpte_row_bytes;\n\tdouble prefetch_bw;\n\tdouble flip_bw;\n\tdouble t_vm_us;\n\tdouble t_r0_us;\n\tdouble dst_y_per_vm_vblank;\n\tdouble dst_y_per_row_vblank;\n\tdouble min_dst_y_per_vm_vblank;\n\tdouble min_dst_y_per_row_vblank;\n\tdouble lsw;\n\tdouble vratio_pre_l;\n\tdouble vratio_pre_c;\n\tunsigned int req_per_swath_ub_l;\n\tunsigned int req_per_swath_ub_c;\n\tunsigned int meta_row_height_l;\n\tunsigned int swath_width_pixels_ub_l;\n\tunsigned int swath_width_pixels_ub_c;\n\tunsigned int scaler_rec_in_width_l;\n\tunsigned int scaler_rec_in_width_c;\n\tunsigned int dpte_row_height_l;\n\tunsigned int dpte_row_height_c;\n\tdouble hscale_pixel_rate_l;\n\tdouble hscale_pixel_rate_c;\n\tdouble min_hratio_fact_l;\n\tdouble min_hratio_fact_c;\n\tdouble refcyc_per_line_delivery_pre_l;\n\tdouble refcyc_per_line_delivery_pre_c;\n\tdouble refcyc_per_line_delivery_l;\n\tdouble refcyc_per_line_delivery_c;\n\tdouble refcyc_per_req_delivery_pre_l;\n\tdouble refcyc_per_req_delivery_pre_c;\n\tdouble refcyc_per_req_delivery_l;\n\tdouble refcyc_per_req_delivery_c;\n\tdouble refcyc_per_req_delivery_pre_cur0;\n\tdouble refcyc_per_req_delivery_cur0;\n\tunsigned int full_recout_width;\n\tdouble hratios_cur0;\n\tunsigned int cur0_src_width;\n\tenum cursor_bpp cur0_bpp;\n\tunsigned int cur0_req_size;\n\tunsigned int cur0_req_width;\n\tdouble cur0_width_ub;\n\tdouble cur0_req_per_width;\n\tdouble hactive_cur0;\n\n\tmemset(disp_dlg_regs, 0, sizeof(*disp_dlg_regs));\n\tmemset(disp_ttu_regs, 0, sizeof(*disp_ttu_regs));\n\n\tDTRACE(\"DLG: %s: cstate_en = %d\", __func__, cstate_en);\n\tDTRACE(\"DLG: %s: pstate_en = %d\", __func__, pstate_en);\n\tDTRACE(\"DLG: %s: vm_en     = %d\", __func__, vm_en);\n\tDTRACE(\"DLG: %s: iflip_en  = %d\", __func__, iflip_en);\n\n\t \n\t \n\t \n\tDTRACE(\"DLG: %s: dppclk_freq_in_mhz     = %3.2f\", __func__, dppclk_freq_in_mhz);\n\tDTRACE(\"DLG: %s: dispclk_freq_in_mhz    = %3.2f\", __func__, dispclk_freq_in_mhz);\n\tDTRACE(\"DLG: %s: refclk_freq_in_mhz     = %3.2f\", __func__, refclk_freq_in_mhz);\n\tDTRACE(\"DLG: %s: pclk_freq_in_mhz       = %3.2f\", __func__, pclk_freq_in_mhz);\n\tDTRACE(\"DLG: %s: interlaced             = %d\", __func__, interlaced);\n\n\tref_freq_to_pix_freq = refclk_freq_in_mhz / pclk_freq_in_mhz;\n\tASSERT(ref_freq_to_pix_freq < 4.0);\n\tdisp_dlg_regs->ref_freq_to_pix_freq =\n\t\t\t(unsigned int) (ref_freq_to_pix_freq * dml_pow(2, 19));\n\tdisp_dlg_regs->refcyc_per_htotal = (unsigned int) (ref_freq_to_pix_freq * (double) htotal\n\t\t\t* dml_pow(2, 8));\n\tdisp_dlg_regs->refcyc_h_blank_end = (unsigned int) ((double) hblank_end\n\t\t\t* (double) ref_freq_to_pix_freq);\n\tASSERT(disp_dlg_regs->refcyc_h_blank_end < (unsigned int) dml_pow(2, 13));\n\tdisp_dlg_regs->dlg_vblank_end = interlaced ? (vblank_end / 2) : vblank_end;  \n\n\tprefetch_xy_calc_in_dcfclk = 24.0;  \n\tmin_dcfclk_mhz = dlg_sys_param->deepsleep_dcfclk_mhz;\n\tt_calc_us = prefetch_xy_calc_in_dcfclk / min_dcfclk_mhz;\n\tmin_ttu_vblank = dlg_sys_param->t_urg_wm_us;\n\tif (cstate_en)\n\t\tmin_ttu_vblank = dml_max(dlg_sys_param->t_sr_wm_us, min_ttu_vblank);\n\tif (pstate_en)\n\t\tmin_ttu_vblank = dml_max(dlg_sys_param->t_mclk_wm_us, min_ttu_vblank);\n\tmin_ttu_vblank = min_ttu_vblank + t_calc_us;\n\n\tmin_dst_y_ttu_vblank = min_ttu_vblank * pclk_freq_in_mhz / (double) htotal;\n\tdlg_vblank_start = interlaced ? (vblank_start / 2) : vblank_start;\n\n\tdisp_dlg_regs->min_dst_y_next_start = (unsigned int) (((double) dlg_vblank_start\n\t\t\t+ min_dst_y_ttu_vblank) * dml_pow(2, 2));\n\tASSERT(disp_dlg_regs->min_dst_y_next_start < (unsigned int) dml_pow(2, 18));\n\n\tDTRACE(\"DLG: %s: min_dcfclk_mhz                         = %3.2f\", __func__, min_dcfclk_mhz);\n\tDTRACE(\"DLG: %s: min_ttu_vblank                         = %3.2f\", __func__, min_ttu_vblank);\n\tDTRACE(\n\t\t\t\"DLG: %s: min_dst_y_ttu_vblank                   = %3.2f\",\n\t\t\t__func__,\n\t\t\tmin_dst_y_ttu_vblank);\n\tDTRACE(\"DLG: %s: t_calc_us                              = %3.2f\", __func__, t_calc_us);\n\tDTRACE(\n\t\t\t\"DLG: %s: disp_dlg_regs->min_dst_y_next_start    = 0x%0x\",\n\t\t\t__func__,\n\t\t\tdisp_dlg_regs->min_dst_y_next_start);\n\tDTRACE(\n\t\t\t\"DLG: %s: ref_freq_to_pix_freq                   = %3.2f\",\n\t\t\t__func__,\n\t\t\tref_freq_to_pix_freq);\n\n\t \n\t \n\t \n\t \n\t \n\tdcc_en = e2e_pipe_param->pipe.src.dcc;\n\tdual_plane = is_dual_plane(\n\t\t\t(enum source_format_class) e2e_pipe_param->pipe.src.source_format);\n\tmode_422 = 0;  \n\taccess_dir = (e2e_pipe_param->pipe.src.source_scan == dm_vert);  \n\tbytes_per_element_l = get_bytes_per_element(\n\t\t\t(enum source_format_class) e2e_pipe_param->pipe.src.source_format,\n\t\t\t0);\n\tbytes_per_element_c = get_bytes_per_element(\n\t\t\t(enum source_format_class) e2e_pipe_param->pipe.src.source_format,\n\t\t\t1);\n\tvp_height_l = e2e_pipe_param->pipe.src.viewport_height;\n\tvp_width_l = e2e_pipe_param->pipe.src.viewport_width;\n\tvp_height_c = e2e_pipe_param->pipe.src.viewport_height_c;\n\tvp_width_c = e2e_pipe_param->pipe.src.viewport_width_c;\n\n\t \n\thtaps_l = e2e_pipe_param->pipe.scale_taps.htaps;\n\thtaps_c = e2e_pipe_param->pipe.scale_taps.htaps_c;\n\thratios_l = e2e_pipe_param->pipe.scale_ratio_depth.hscl_ratio;\n\thratios_c = e2e_pipe_param->pipe.scale_ratio_depth.hscl_ratio_c;\n\tvratio_l = e2e_pipe_param->pipe.scale_ratio_depth.vscl_ratio;\n\tvratio_c = e2e_pipe_param->pipe.scale_ratio_depth.vscl_ratio_c;\n\n\tline_time_in_us = (htotal / pclk_freq_in_mhz);\n\tvinit_l = e2e_pipe_param->pipe.scale_ratio_depth.vinit;\n\tvinit_c = e2e_pipe_param->pipe.scale_ratio_depth.vinit_c;\n\tvinit_bot_l = e2e_pipe_param->pipe.scale_ratio_depth.vinit_bot;\n\tvinit_bot_c = e2e_pipe_param->pipe.scale_ratio_depth.vinit_bot_c;\n\n\tswath_height_l = rq_dlg_param->rq_l.swath_height;\n\tswath_width_ub_l = rq_dlg_param->rq_l.swath_width_ub;\n\tdpte_bytes_per_row_ub_l = rq_dlg_param->rq_l.dpte_bytes_per_row_ub;\n\tdpte_groups_per_row_ub_l = rq_dlg_param->rq_l.dpte_groups_per_row_ub;\n\tmeta_pte_bytes_per_frame_ub_l = rq_dlg_param->rq_l.meta_pte_bytes_per_frame_ub;\n\tmeta_bytes_per_row_ub_l = rq_dlg_param->rq_l.meta_bytes_per_row_ub;\n\n\tswath_height_c = rq_dlg_param->rq_c.swath_height;\n\tswath_width_ub_c = rq_dlg_param->rq_c.swath_width_ub;\n\tdpte_bytes_per_row_ub_c = rq_dlg_param->rq_c.dpte_bytes_per_row_ub;\n\tdpte_groups_per_row_ub_c = rq_dlg_param->rq_c.dpte_groups_per_row_ub;\n\n\tmeta_chunks_per_row_ub_l = rq_dlg_param->rq_l.meta_chunks_per_row_ub;\n\tvupdate_offset = e2e_pipe_param->pipe.dest.vupdate_offset;\n\tvupdate_width = e2e_pipe_param->pipe.dest.vupdate_width;\n\tvready_offset = e2e_pipe_param->pipe.dest.vready_offset;\n\n\tdppclk_delay_subtotal = mode_lib->ip.dppclk_delay_subtotal;\n\tdispclk_delay_subtotal = mode_lib->ip.dispclk_delay_subtotal;\n\tpixel_rate_delay_subtotal = dppclk_delay_subtotal * pclk_freq_in_mhz / dppclk_freq_in_mhz\n\t\t\t+ dispclk_delay_subtotal * pclk_freq_in_mhz / dispclk_freq_in_mhz;\n\n\tvstartup_start = e2e_pipe_param->pipe.dest.vstartup_start;\n\n\tif (interlaced)\n\t\tvstartup_start = vstartup_start / 2;\n\n\tif (vstartup_start >= min_vblank) {\n\t\tDTRACE(\n\t\t\t\t\"WARNING_DLG: %s:  vblank_start=%d vblank_end=%d\",\n\t\t\t\t__func__,\n\t\t\t\tvblank_start,\n\t\t\t\tvblank_end);\n\t\tDTRACE(\n\t\t\t\t\"WARNING_DLG: %s:  vstartup_start=%d should be less than min_vblank=%d\",\n\t\t\t\t__func__,\n\t\t\t\tvstartup_start,\n\t\t\t\tmin_vblank);\n\t\tmin_vblank = vstartup_start + 1;\n\t\tDTRACE(\n\t\t\t\t\"WARNING_DLG: %s:  vstartup_start=%d should be less than min_vblank=%d\",\n\t\t\t\t__func__,\n\t\t\t\tvstartup_start,\n\t\t\t\tmin_vblank);\n\t}\n\n\tdst_x_after_scaler = 0;\n\tdst_y_after_scaler = 0;\n\n\tif (e2e_pipe_param->pipe.src.is_hsplit)\n\t\tdst_x_after_scaler = pixel_rate_delay_subtotal\n\t\t\t\t+ e2e_pipe_param->pipe.dest.recout_width;\n\telse\n\t\tdst_x_after_scaler = pixel_rate_delay_subtotal;\n\n\tif (e2e_pipe_param->dout.output_format == dm_420)\n\t\tdst_y_after_scaler = 1;\n\telse\n\t\tdst_y_after_scaler = 0;\n\n\tif (dst_x_after_scaler >= htotal) {\n\t\tdst_x_after_scaler = dst_x_after_scaler - htotal;\n\t\tdst_y_after_scaler = dst_y_after_scaler + 1;\n\t}\n\n\tDTRACE(\"DLG: %s: htotal                                 = %d\", __func__, htotal);\n\tDTRACE(\n\t\t\t\"DLG: %s: pixel_rate_delay_subtotal              = %d\",\n\t\t\t__func__,\n\t\t\tpixel_rate_delay_subtotal);\n\tDTRACE(\"DLG: %s: dst_x_after_scaler                     = %d\", __func__, dst_x_after_scaler);\n\tDTRACE(\"DLG: %s: dst_y_after_scaler                     = %d\", __func__, dst_y_after_scaler);\n\n\tline_wait = mode_lib->soc.urgent_latency_us;\n\tif (cstate_en)\n\t\tline_wait = dml_max(mode_lib->soc.sr_enter_plus_exit_time_us, line_wait);\n\tif (pstate_en)\n\t\tline_wait = dml_max(\n\t\t\t\tmode_lib->soc.dram_clock_change_latency_us\n\t\t\t\t\t\t+ mode_lib->soc.urgent_latency_us,\n\t\t\t\tline_wait);\n\tline_wait = line_wait / line_time_in_us;\n\n\tline_o = (double) dst_y_after_scaler + dst_x_after_scaler / (double) htotal;\n\tline_setup = (double) (vupdate_offset + vupdate_width + vready_offset) / (double) htotal;\n\tline_calc = t_calc_us / line_time_in_us;\n\n\tDTRACE(\n\t\t\t\"DLG: %s: soc.sr_enter_plus_exit_time_us     = %3.2f\",\n\t\t\t__func__,\n\t\t\t(double) mode_lib->soc.sr_enter_plus_exit_time_us);\n\tDTRACE(\n\t\t\t\"DLG: %s: soc.dram_clock_change_latency_us   = %3.2f\",\n\t\t\t__func__,\n\t\t\t(double) mode_lib->soc.dram_clock_change_latency_us);\n\tDTRACE(\n\t\t\t\"DLG: %s: soc.urgent_latency_us              = %3.2f\",\n\t\t\t__func__,\n\t\t\tmode_lib->soc.urgent_latency_us);\n\n\tDTRACE(\"DLG: %s: swath_height_l     = %d\", __func__, swath_height_l);\n\tif (dual_plane)\n\t\tDTRACE(\"DLG: %s: swath_height_c     = %d\", __func__, swath_height_c);\n\n\tDTRACE(\"DLG: %s: line_time_in_us    = %3.2f\", __func__, (double) line_time_in_us);\n\tDTRACE(\"DLG: %s: vupdate_offset     = %d\", __func__, vupdate_offset);\n\tDTRACE(\"DLG: %s: vupdate_width      = %d\", __func__, vupdate_width);\n\tDTRACE(\"DLG: %s: vready_offset      = %d\", __func__, vready_offset);\n\tDTRACE(\"DLG: %s: line_time_in_us    = %3.2f\", __func__, line_time_in_us);\n\tDTRACE(\"DLG: %s: line_wait          = %3.2f\", __func__, line_wait);\n\tDTRACE(\"DLG: %s: line_o             = %3.2f\", __func__, line_o);\n\tDTRACE(\"DLG: %s: line_setup         = %3.2f\", __func__, line_setup);\n\tDTRACE(\"DLG: %s: line_calc          = %3.2f\", __func__, line_calc);\n\n\tdst_y_prefetch = ((double) min_vblank - 1.0)\n\t\t\t- (line_setup + line_calc + line_wait + line_o);\n\tDTRACE(\"DLG: %s: dst_y_prefetch (before rnd) = %3.2f\", __func__, dst_y_prefetch);\n\tASSERT(dst_y_prefetch >= 2.0);\n\n\tdst_y_prefetch = dml_floor(4.0 * (dst_y_prefetch + 0.125), 1) / 4;\n\tDTRACE(\"DLG: %s: dst_y_prefetch (after rnd) = %3.2f\", __func__, dst_y_prefetch);\n\n\tt_pre_us = dst_y_prefetch * line_time_in_us;\n\tvm_bytes = 0;\n\tmeta_row_bytes = 0;\n\n\tif (dcc_en && vm_en)\n\t\tvm_bytes = meta_pte_bytes_per_frame_ub_l;\n\tif (dcc_en)\n\t\tmeta_row_bytes = meta_bytes_per_row_ub_l;\n\n\tmax_num_sw_l = 0;\n\tmax_num_sw_c = 0;\n\tmax_partial_sw_l = 0;\n\tmax_partial_sw_c = 0;\n\n\tmax_vinit_l = interlaced ? dml_max(vinit_l, vinit_bot_l) : vinit_l;\n\tmax_vinit_c = interlaced ? dml_max(vinit_c, vinit_bot_c) : vinit_c;\n\n\tget_swath_need(mode_lib, &max_num_sw_l, &max_partial_sw_l, swath_height_l, max_vinit_l);\n\tif (dual_plane)\n\t\tget_swath_need(\n\t\t\t\tmode_lib,\n\t\t\t\t&max_num_sw_c,\n\t\t\t\t&max_partial_sw_c,\n\t\t\t\tswath_height_c,\n\t\t\t\tmax_vinit_c);\n\n\tlsw_l = max_num_sw_l * swath_height_l + max_partial_sw_l;\n\tlsw_c = max_num_sw_c * swath_height_c + max_partial_sw_c;\n\tsw_bytes_ub_l = lsw_l * swath_width_ub_l * bytes_per_element_l;\n\tsw_bytes_ub_c = lsw_c * swath_width_ub_c * bytes_per_element_c;\n\tsw_bytes = 0;\n\tdpte_row_bytes = 0;\n\n\tif (vm_en) {\n\t\tif (dual_plane)\n\t\t\tdpte_row_bytes = dpte_bytes_per_row_ub_l + dpte_bytes_per_row_ub_c;\n\t\telse\n\t\t\tdpte_row_bytes = dpte_bytes_per_row_ub_l;\n\t} else {\n\t\tdpte_row_bytes = 0;\n\t}\n\n\tif (dual_plane)\n\t\tsw_bytes = sw_bytes_ub_l + sw_bytes_ub_c;\n\telse\n\t\tsw_bytes = sw_bytes_ub_l;\n\n\tDTRACE(\"DLG: %s: sw_bytes_ub_l           = %d\", __func__, sw_bytes_ub_l);\n\tDTRACE(\"DLG: %s: sw_bytes_ub_c           = %d\", __func__, sw_bytes_ub_c);\n\tDTRACE(\"DLG: %s: sw_bytes                = %d\", __func__, sw_bytes);\n\tDTRACE(\"DLG: %s: vm_bytes                = %d\", __func__, vm_bytes);\n\tDTRACE(\"DLG: %s: meta_row_bytes          = %d\", __func__, meta_row_bytes);\n\tDTRACE(\"DLG: %s: dpte_row_bytes          = %d\", __func__, dpte_row_bytes);\n\n\tprefetch_bw = (vm_bytes + 2 * dpte_row_bytes + 2 * meta_row_bytes + sw_bytes) / t_pre_us;\n\tflip_bw = ((vm_bytes + dpte_row_bytes + meta_row_bytes) * dlg_sys_param->total_flip_bw)\n\t\t\t/ (double) dlg_sys_param->total_flip_bytes;\n\tt_vm_us = line_time_in_us / 4.0;\n\tif (vm_en && dcc_en) {\n\t\tt_vm_us = dml_max(\n\t\t\t\tdlg_sys_param->t_extra_us,\n\t\t\t\tdml_max((double) vm_bytes / prefetch_bw, t_vm_us));\n\n\t\tif (iflip_en && !dual_plane) {\n\t\t\tt_vm_us = dml_max(mode_lib->soc.urgent_latency_us, t_vm_us);\n\t\t\tif (flip_bw > 0.)\n\t\t\t\tt_vm_us = dml_max(vm_bytes / flip_bw, t_vm_us);\n\t\t}\n\t}\n\n\tt_r0_us = dml_max(dlg_sys_param->t_extra_us - t_vm_us, line_time_in_us - t_vm_us);\n\n\tif (vm_en || dcc_en) {\n\t\tt_r0_us = dml_max(\n\t\t\t\t(double) (dpte_row_bytes + meta_row_bytes) / prefetch_bw,\n\t\t\t\tdlg_sys_param->t_extra_us);\n\t\tt_r0_us = dml_max((double) (line_time_in_us - t_vm_us), t_r0_us);\n\n\t\tif (iflip_en && !dual_plane) {\n\t\t\tt_r0_us = dml_max(mode_lib->soc.urgent_latency_us * 2.0, t_r0_us);\n\t\t\tif (flip_bw > 0.)\n\t\t\t\tt_r0_us = dml_max(\n\t\t\t\t\t\t(dpte_row_bytes + meta_row_bytes) / flip_bw,\n\t\t\t\t\t\tt_r0_us);\n\t\t}\n\t}\n\n\tdisp_dlg_regs->dst_y_after_scaler = dst_y_after_scaler;  \n\tdisp_dlg_regs->refcyc_x_after_scaler = dst_x_after_scaler * ref_freq_to_pix_freq;  \n\tASSERT(disp_dlg_regs->refcyc_x_after_scaler < (unsigned int) dml_pow(2, 13));\n\tDTRACE(\n\t\t\t\"DLG: %s: disp_dlg_regs->dst_y_after_scaler      = 0x%0x\",\n\t\t\t__func__,\n\t\t\tdisp_dlg_regs->dst_y_after_scaler);\n\tDTRACE(\n\t\t\t\"DLG: %s: disp_dlg_regs->refcyc_x_after_scaler   = 0x%0x\",\n\t\t\t__func__,\n\t\t\tdisp_dlg_regs->refcyc_x_after_scaler);\n\n\tdisp_dlg_regs->dst_y_prefetch = (unsigned int) (dst_y_prefetch * dml_pow(2, 2));\n\tDTRACE(\n\t\t\t\"DLG: %s: disp_dlg_regs->dst_y_prefetch  = %d\",\n\t\t\t__func__,\n\t\t\tdisp_dlg_regs->dst_y_prefetch);\n\n\tdst_y_per_vm_vblank = 0.0;\n\tdst_y_per_row_vblank = 0.0;\n\n\tdst_y_per_vm_vblank = t_vm_us / line_time_in_us;\n\tdst_y_per_vm_vblank = dml_floor(4.0 * (dst_y_per_vm_vblank + 0.125), 1) / 4.0;\n\tdisp_dlg_regs->dst_y_per_vm_vblank = (unsigned int) (dst_y_per_vm_vblank * dml_pow(2, 2));\n\n\tdst_y_per_row_vblank = t_r0_us / line_time_in_us;\n\tdst_y_per_row_vblank = dml_floor(4.0 * (dst_y_per_row_vblank + 0.125), 1) / 4.0;\n\tdisp_dlg_regs->dst_y_per_row_vblank = (unsigned int) (dst_y_per_row_vblank * dml_pow(2, 2));\n\n\tDTRACE(\"DLG: %s: lsw_l                   = %d\", __func__, lsw_l);\n\tDTRACE(\"DLG: %s: lsw_c                   = %d\", __func__, lsw_c);\n\tDTRACE(\"DLG: %s: dpte_bytes_per_row_ub_l = %d\", __func__, dpte_bytes_per_row_ub_l);\n\tDTRACE(\"DLG: %s: dpte_bytes_per_row_ub_c = %d\", __func__, dpte_bytes_per_row_ub_c);\n\n\tDTRACE(\"DLG: %s: prefetch_bw            = %3.2f\", __func__, prefetch_bw);\n\tDTRACE(\"DLG: %s: flip_bw                = %3.2f\", __func__, flip_bw);\n\tDTRACE(\"DLG: %s: t_pre_us               = %3.2f\", __func__, t_pre_us);\n\tDTRACE(\"DLG: %s: t_vm_us                = %3.2f\", __func__, t_vm_us);\n\tDTRACE(\"DLG: %s: t_r0_us                = %3.2f\", __func__, t_r0_us);\n\tDTRACE(\"DLG: %s: dst_y_per_vm_vblank    = %3.2f\", __func__, dst_y_per_vm_vblank);\n\tDTRACE(\"DLG: %s: dst_y_per_row_vblank   = %3.2f\", __func__, dst_y_per_row_vblank);\n\tDTRACE(\"DLG: %s: dst_y_prefetch         = %3.2f\", __func__, dst_y_prefetch);\n\n\tmin_dst_y_per_vm_vblank = 8.0;\n\tmin_dst_y_per_row_vblank = 16.0;\n\tif (htotal <= 75) {\n\t\tmin_vblank = 300;\n\t\tmin_dst_y_per_vm_vblank = 100.0;\n\t\tmin_dst_y_per_row_vblank = 100.0;\n\t}\n\n\tASSERT(dst_y_per_vm_vblank < min_dst_y_per_vm_vblank);\n\tASSERT(dst_y_per_row_vblank < min_dst_y_per_row_vblank);\n\n\tASSERT(dst_y_prefetch > (dst_y_per_vm_vblank + dst_y_per_row_vblank));\n\tlsw = dst_y_prefetch - (dst_y_per_vm_vblank + dst_y_per_row_vblank);\n\n\tDTRACE(\"DLG: %s: lsw = %3.2f\", __func__, lsw);\n\n\tvratio_pre_l = get_vratio_pre(\n\t\t\tmode_lib,\n\t\t\tmax_num_sw_l,\n\t\t\tmax_partial_sw_l,\n\t\t\tswath_height_l,\n\t\t\tmax_vinit_l,\n\t\t\tlsw);\n\tvratio_pre_c = 1.0;\n\tif (dual_plane)\n\t\tvratio_pre_c = get_vratio_pre(\n\t\t\t\tmode_lib,\n\t\t\t\tmax_num_sw_c,\n\t\t\t\tmax_partial_sw_c,\n\t\t\t\tswath_height_c,\n\t\t\t\tmax_vinit_c,\n\t\t\t\tlsw);\n\n\tDTRACE(\"DLG: %s: vratio_pre_l=%3.2f\", __func__, vratio_pre_l);\n\tDTRACE(\"DLG: %s: vratio_pre_c=%3.2f\", __func__, vratio_pre_c);\n\n\tASSERT(vratio_pre_l <= 4.0);\n\tif (vratio_pre_l >= 4.0)\n\t\tdisp_dlg_regs->vratio_prefetch = (unsigned int) dml_pow(2, 21) - 1;\n\telse\n\t\tdisp_dlg_regs->vratio_prefetch = (unsigned int) (vratio_pre_l * dml_pow(2, 19));\n\n\tASSERT(vratio_pre_c <= 4.0);\n\tif (vratio_pre_c >= 4.0)\n\t\tdisp_dlg_regs->vratio_prefetch_c = (unsigned int) dml_pow(2, 21) - 1;\n\telse\n\t\tdisp_dlg_regs->vratio_prefetch_c = (unsigned int) (vratio_pre_c * dml_pow(2, 19));\n\n\tdisp_dlg_regs->refcyc_per_pte_group_vblank_l =\n\t\t\t(unsigned int) (dst_y_per_row_vblank * (double) htotal\n\t\t\t\t\t* ref_freq_to_pix_freq / (double) dpte_groups_per_row_ub_l);\n\tASSERT(disp_dlg_regs->refcyc_per_pte_group_vblank_l < (unsigned int) dml_pow(2, 13));\n\n\tdisp_dlg_regs->refcyc_per_pte_group_vblank_c =\n\t\t\t(unsigned int) (dst_y_per_row_vblank * (double) htotal\n\t\t\t\t\t* ref_freq_to_pix_freq / (double) dpte_groups_per_row_ub_c);\n\tASSERT(disp_dlg_regs->refcyc_per_pte_group_vblank_c < (unsigned int) dml_pow(2, 13));\n\n\tdisp_dlg_regs->refcyc_per_meta_chunk_vblank_l =\n\t\t\t(unsigned int) (dst_y_per_row_vblank * (double) htotal\n\t\t\t\t\t* ref_freq_to_pix_freq / (double) meta_chunks_per_row_ub_l);\n\tASSERT(disp_dlg_regs->refcyc_per_meta_chunk_vblank_l < (unsigned int) dml_pow(2, 13));\n\n\tdisp_dlg_regs->refcyc_per_meta_chunk_vblank_c =\n\t\t\tdisp_dlg_regs->refcyc_per_meta_chunk_vblank_l; \n\n\t \n\treq_per_swath_ub_l = rq_dlg_param->rq_l.req_per_swath_ub;\n\treq_per_swath_ub_c = rq_dlg_param->rq_c.req_per_swath_ub;\n\tmeta_row_height_l = rq_dlg_param->rq_l.meta_row_height;\n\tswath_width_pixels_ub_l = 0;\n\tswath_width_pixels_ub_c = 0;\n\tscaler_rec_in_width_l = 0;\n\tscaler_rec_in_width_c = 0;\n\tdpte_row_height_l = rq_dlg_param->rq_l.dpte_row_height;\n\tdpte_row_height_c = rq_dlg_param->rq_c.dpte_row_height;\n\n\tdisp_dlg_regs->dst_y_per_pte_row_nom_l = (unsigned int) ((double) dpte_row_height_l\n\t\t\t/ (double) vratio_l * dml_pow(2, 2));\n\tASSERT(disp_dlg_regs->dst_y_per_pte_row_nom_l < (unsigned int) dml_pow(2, 17));\n\n\tdisp_dlg_regs->dst_y_per_pte_row_nom_c = (unsigned int) ((double) dpte_row_height_c\n\t\t\t/ (double) vratio_c * dml_pow(2, 2));\n\tASSERT(disp_dlg_regs->dst_y_per_pte_row_nom_c < (unsigned int) dml_pow(2, 17));\n\n\tdisp_dlg_regs->dst_y_per_meta_row_nom_l = (unsigned int) ((double) meta_row_height_l\n\t\t\t/ (double) vratio_l * dml_pow(2, 2));\n\tASSERT(disp_dlg_regs->dst_y_per_meta_row_nom_l < (unsigned int) dml_pow(2, 17));\n\n\tdisp_dlg_regs->dst_y_per_meta_row_nom_c = disp_dlg_regs->dst_y_per_meta_row_nom_l;  \n\n\tdisp_dlg_regs->refcyc_per_pte_group_nom_l = (unsigned int) ((double) dpte_row_height_l\n\t\t\t/ (double) vratio_l * (double) htotal * ref_freq_to_pix_freq\n\t\t\t/ (double) dpte_groups_per_row_ub_l);\n\tif (disp_dlg_regs->refcyc_per_pte_group_nom_l >= (unsigned int) dml_pow(2, 23))\n\t\tdisp_dlg_regs->refcyc_per_pte_group_nom_l = dml_pow(2, 23) - 1;\n\n\tdisp_dlg_regs->refcyc_per_pte_group_nom_c = (unsigned int) ((double) dpte_row_height_c\n\t\t\t/ (double) vratio_c * (double) htotal * ref_freq_to_pix_freq\n\t\t\t/ (double) dpte_groups_per_row_ub_c);\n\tif (disp_dlg_regs->refcyc_per_pte_group_nom_c >= (unsigned int) dml_pow(2, 23))\n\t\tdisp_dlg_regs->refcyc_per_pte_group_nom_c = dml_pow(2, 23) - 1;\n\n\tdisp_dlg_regs->refcyc_per_meta_chunk_nom_l = (unsigned int) ((double) meta_row_height_l\n\t\t\t/ (double) vratio_l * (double) htotal * ref_freq_to_pix_freq\n\t\t\t/ (double) meta_chunks_per_row_ub_l);\n\tif (disp_dlg_regs->refcyc_per_meta_chunk_nom_l >= (unsigned int) dml_pow(2, 23))\n\t\tdisp_dlg_regs->refcyc_per_meta_chunk_nom_l = dml_pow(2, 23) - 1;\n\n\tif (mode_422) {\n\t\tswath_width_pixels_ub_l = swath_width_ub_l * 2;  \n\t\tswath_width_pixels_ub_c = swath_width_ub_c * 2;\n\t} else {\n\t\tswath_width_pixels_ub_l = swath_width_ub_l * 1;\n\t\tswath_width_pixels_ub_c = swath_width_ub_c * 1;\n\t}\n\n\thscale_pixel_rate_l = 0.;\n\thscale_pixel_rate_c = 0.;\n\tmin_hratio_fact_l = 1.0;\n\tmin_hratio_fact_c = 1.0;\n\n\tif (htaps_l <= 1)\n\t\tmin_hratio_fact_l = 2.0;\n\telse if (htaps_l <= 6) {\n\t\tif ((hratios_l * 2.0) > 4.0)\n\t\t\tmin_hratio_fact_l = 4.0;\n\t\telse\n\t\t\tmin_hratio_fact_l = hratios_l * 2.0;\n\t} else {\n\t\tif (hratios_l > 4.0)\n\t\t\tmin_hratio_fact_l = 4.0;\n\t\telse\n\t\t\tmin_hratio_fact_l = hratios_l;\n\t}\n\n\thscale_pixel_rate_l = min_hratio_fact_l * dppclk_freq_in_mhz;\n\n\tif (htaps_c <= 1)\n\t\tmin_hratio_fact_c = 2.0;\n\telse if (htaps_c <= 6) {\n\t\tif ((hratios_c * 2.0) > 4.0)\n\t\t\tmin_hratio_fact_c = 4.0;\n\t\telse\n\t\t\tmin_hratio_fact_c = hratios_c * 2.0;\n\t} else {\n\t\tif (hratios_c > 4.0)\n\t\t\tmin_hratio_fact_c = 4.0;\n\t\telse\n\t\t\tmin_hratio_fact_c = hratios_c;\n\t}\n\n\thscale_pixel_rate_c = min_hratio_fact_c * dppclk_freq_in_mhz;\n\n\trefcyc_per_line_delivery_pre_l = 0.;\n\trefcyc_per_line_delivery_pre_c = 0.;\n\trefcyc_per_line_delivery_l = 0.;\n\trefcyc_per_line_delivery_c = 0.;\n\n\trefcyc_per_req_delivery_pre_l = 0.;\n\trefcyc_per_req_delivery_pre_c = 0.;\n\trefcyc_per_req_delivery_l = 0.;\n\trefcyc_per_req_delivery_c = 0.;\n\trefcyc_per_req_delivery_pre_cur0 = 0.;\n\trefcyc_per_req_delivery_cur0 = 0.;\n\n\tfull_recout_width = 0;\n\tif (e2e_pipe_param->pipe.src.is_hsplit) {\n\t\tif (e2e_pipe_param->pipe.dest.full_recout_width == 0) {\n\t\t\tDTRACE(\"DLG: %s: Warningfull_recout_width not set in hsplit mode\", __func__);\n\t\t\tfull_recout_width = e2e_pipe_param->pipe.dest.recout_width * 2;  \n\t\t} else\n\t\t\tfull_recout_width = e2e_pipe_param->pipe.dest.full_recout_width;\n\t} else\n\t\tfull_recout_width = e2e_pipe_param->pipe.dest.recout_width;\n\n\trefcyc_per_line_delivery_pre_l = get_refcyc_per_delivery(\n\t\t\tmode_lib,\n\t\t\trefclk_freq_in_mhz,\n\t\t\tpclk_freq_in_mhz,\n\t\t\tfull_recout_width,\n\t\t\tvratio_pre_l,\n\t\t\thscale_pixel_rate_l,\n\t\t\tswath_width_pixels_ub_l,\n\t\t\t1);  \n\n\trefcyc_per_line_delivery_l = get_refcyc_per_delivery(\n\t\t\tmode_lib,\n\t\t\trefclk_freq_in_mhz,\n\t\t\tpclk_freq_in_mhz,\n\t\t\tfull_recout_width,\n\t\t\tvratio_l,\n\t\t\thscale_pixel_rate_l,\n\t\t\tswath_width_pixels_ub_l,\n\t\t\t1);  \n\n\tDTRACE(\"DLG: %s: full_recout_width              = %d\", __func__, full_recout_width);\n\tDTRACE(\"DLG: %s: hscale_pixel_rate_l            = %3.2f\", __func__, hscale_pixel_rate_l);\n\tDTRACE(\n\t\t\t\"DLG: %s: refcyc_per_line_delivery_pre_l = %3.2f\",\n\t\t\t__func__,\n\t\t\trefcyc_per_line_delivery_pre_l);\n\tDTRACE(\n\t\t\t\"DLG: %s: refcyc_per_line_delivery_l     = %3.2f\",\n\t\t\t__func__,\n\t\t\trefcyc_per_line_delivery_l);\n\n\tdisp_dlg_regs->refcyc_per_line_delivery_pre_l = (unsigned int) dml_floor(\n\t\t\trefcyc_per_line_delivery_pre_l,\n\t\t\t1);\n\tdisp_dlg_regs->refcyc_per_line_delivery_l = (unsigned int) dml_floor(\n\t\t\trefcyc_per_line_delivery_l,\n\t\t\t1);\n\tASSERT(disp_dlg_regs->refcyc_per_line_delivery_pre_l < (unsigned int) dml_pow(2, 13));\n\tASSERT(disp_dlg_regs->refcyc_per_line_delivery_l < (unsigned int) dml_pow(2, 13));\n\n\tif (dual_plane) {\n\t\trefcyc_per_line_delivery_pre_c = get_refcyc_per_delivery(\n\t\t\t\tmode_lib,\n\t\t\t\trefclk_freq_in_mhz,\n\t\t\t\tpclk_freq_in_mhz,\n\t\t\t\tfull_recout_width,\n\t\t\t\tvratio_pre_c,\n\t\t\t\thscale_pixel_rate_c,\n\t\t\t\tswath_width_pixels_ub_c,\n\t\t\t\t1);  \n\n\t\trefcyc_per_line_delivery_c = get_refcyc_per_delivery(\n\t\t\t\tmode_lib,\n\t\t\t\trefclk_freq_in_mhz,\n\t\t\t\tpclk_freq_in_mhz,\n\t\t\t\tfull_recout_width,\n\t\t\t\tvratio_c,\n\t\t\t\thscale_pixel_rate_c,\n\t\t\t\tswath_width_pixels_ub_c,\n\t\t\t\t1);  \n\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: refcyc_per_line_delivery_pre_c = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\trefcyc_per_line_delivery_pre_c);\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: refcyc_per_line_delivery_c     = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\trefcyc_per_line_delivery_c);\n\n\t\tdisp_dlg_regs->refcyc_per_line_delivery_pre_c = (unsigned int) dml_floor(\n\t\t\t\trefcyc_per_line_delivery_pre_c,\n\t\t\t\t1);\n\t\tdisp_dlg_regs->refcyc_per_line_delivery_c = (unsigned int) dml_floor(\n\t\t\t\trefcyc_per_line_delivery_c,\n\t\t\t\t1);\n\t\tASSERT(disp_dlg_regs->refcyc_per_line_delivery_pre_c < (unsigned int) dml_pow(2, 13));\n\t\tASSERT(disp_dlg_regs->refcyc_per_line_delivery_c < (unsigned int) dml_pow(2, 13));\n\t}\n\tdisp_dlg_regs->chunk_hdl_adjust_cur0 = 3;\n\n\t \n\tif (access_dir) {  \n\t\tscaler_rec_in_width_l = vp_height_l;\n\t\tscaler_rec_in_width_c = vp_height_c;\n\t} else {\n\t\tscaler_rec_in_width_l = vp_width_l;\n\t\tscaler_rec_in_width_c = vp_width_c;\n\t}\n\n\trefcyc_per_req_delivery_pre_l = get_refcyc_per_delivery(\n\t\t\tmode_lib,\n\t\t\trefclk_freq_in_mhz,\n\t\t\tpclk_freq_in_mhz,\n\t\t\tfull_recout_width,\n\t\t\tvratio_pre_l,\n\t\t\thscale_pixel_rate_l,\n\t\t\tscaler_rec_in_width_l,\n\t\t\treq_per_swath_ub_l);  \n\trefcyc_per_req_delivery_l = get_refcyc_per_delivery(\n\t\t\tmode_lib,\n\t\t\trefclk_freq_in_mhz,\n\t\t\tpclk_freq_in_mhz,\n\t\t\tfull_recout_width,\n\t\t\tvratio_l,\n\t\t\thscale_pixel_rate_l,\n\t\t\tscaler_rec_in_width_l,\n\t\t\treq_per_swath_ub_l);  \n\n\tDTRACE(\n\t\t\t\"DLG: %s: refcyc_per_req_delivery_pre_l = %3.2f\",\n\t\t\t__func__,\n\t\t\trefcyc_per_req_delivery_pre_l);\n\tDTRACE(\n\t\t\t\"DLG: %s: refcyc_per_req_delivery_l     = %3.2f\",\n\t\t\t__func__,\n\t\t\trefcyc_per_req_delivery_l);\n\n\tdisp_ttu_regs->refcyc_per_req_delivery_pre_l = (unsigned int) (refcyc_per_req_delivery_pre_l\n\t\t\t* dml_pow(2, 10));\n\tdisp_ttu_regs->refcyc_per_req_delivery_l = (unsigned int) (refcyc_per_req_delivery_l\n\t\t\t* dml_pow(2, 10));\n\n\tASSERT(refcyc_per_req_delivery_pre_l < dml_pow(2, 13));\n\tASSERT(refcyc_per_req_delivery_l < dml_pow(2, 13));\n\n\tif (dual_plane) {\n\t\trefcyc_per_req_delivery_pre_c = get_refcyc_per_delivery(\n\t\t\t\tmode_lib,\n\t\t\t\trefclk_freq_in_mhz,\n\t\t\t\tpclk_freq_in_mhz,\n\t\t\t\tfull_recout_width,\n\t\t\t\tvratio_pre_c,\n\t\t\t\thscale_pixel_rate_c,\n\t\t\t\tscaler_rec_in_width_c,\n\t\t\t\treq_per_swath_ub_c);  \n\t\trefcyc_per_req_delivery_c = get_refcyc_per_delivery(\n\t\t\t\tmode_lib,\n\t\t\t\trefclk_freq_in_mhz,\n\t\t\t\tpclk_freq_in_mhz,\n\t\t\t\tfull_recout_width,\n\t\t\t\tvratio_c,\n\t\t\t\thscale_pixel_rate_c,\n\t\t\t\tscaler_rec_in_width_c,\n\t\t\t\treq_per_swath_ub_c);  \n\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: refcyc_per_req_delivery_pre_c = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\trefcyc_per_req_delivery_pre_c);\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: refcyc_per_req_delivery_c     = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\trefcyc_per_req_delivery_c);\n\n\t\tdisp_ttu_regs->refcyc_per_req_delivery_pre_c =\n\t\t\t\t(unsigned int) (refcyc_per_req_delivery_pre_c * dml_pow(2, 10));\n\t\tdisp_ttu_regs->refcyc_per_req_delivery_c = (unsigned int) (refcyc_per_req_delivery_c\n\t\t\t\t* dml_pow(2, 10));\n\n\t\tASSERT(refcyc_per_req_delivery_pre_c < dml_pow(2, 13));\n\t\tASSERT(refcyc_per_req_delivery_c < dml_pow(2, 13));\n\t}\n\n\t \n\thratios_cur0 = e2e_pipe_param->pipe.scale_ratio_depth.hscl_ratio;\n\tcur0_src_width = e2e_pipe_param->pipe.src.cur0_src_width;  \n\tcur0_bpp = (enum cursor_bpp) e2e_pipe_param->pipe.src.cur0_bpp;\n\tcur0_req_size = 0;\n\tcur0_req_width = 0;\n\tcur0_width_ub = 0.0;\n\tcur0_req_per_width = 0.0;\n\thactive_cur0 = 0.0;\n\n\tASSERT(cur0_src_width <= 256);\n\n\tif (cur0_src_width > 0) {\n\t\tunsigned int cur0_bit_per_pixel = 0;\n\n\t\tif (cur0_bpp == dm_cur_2bit) {\n\t\t\tcur0_req_size = 64;  \n\t\t\tcur0_bit_per_pixel = 2;\n\t\t} else {  \n\t\t\tcur0_bit_per_pixel = 32;\n\t\t\tif (cur0_src_width >= 1 && cur0_src_width <= 16)\n\t\t\t\tcur0_req_size = 64;\n\t\t\telse if (cur0_src_width >= 17 && cur0_src_width <= 31)\n\t\t\t\tcur0_req_size = 128;\n\t\t\telse\n\t\t\t\tcur0_req_size = 256;\n\t\t}\n\n\t\tcur0_req_width = (double) cur0_req_size / ((double) cur0_bit_per_pixel / 8.0);\n\t\tcur0_width_ub = dml_ceil((double) cur0_src_width / (double) cur0_req_width, 1)\n\t\t\t\t* (double) cur0_req_width;\n\t\tcur0_req_per_width = cur0_width_ub / (double) cur0_req_width;\n\t\thactive_cur0 = (double) cur0_src_width / hratios_cur0;  \n\n\t\tif (vratio_pre_l <= 1.0) {\n\t\t\trefcyc_per_req_delivery_pre_cur0 = hactive_cur0 * ref_freq_to_pix_freq\n\t\t\t\t\t/ (double) cur0_req_per_width;\n\t\t} else {\n\t\t\trefcyc_per_req_delivery_pre_cur0 = (double) refclk_freq_in_mhz\n\t\t\t\t\t* (double) cur0_src_width / hscale_pixel_rate_l\n\t\t\t\t\t/ (double) cur0_req_per_width;\n\t\t}\n\n\t\tdisp_ttu_regs->refcyc_per_req_delivery_pre_cur0 =\n\t\t\t\t(unsigned int) (refcyc_per_req_delivery_pre_cur0 * dml_pow(2, 10));\n\t\tASSERT(refcyc_per_req_delivery_pre_cur0 < dml_pow(2, 13));\n\n\t\tif (vratio_l <= 1.0) {\n\t\t\trefcyc_per_req_delivery_cur0 = hactive_cur0 * ref_freq_to_pix_freq\n\t\t\t\t\t/ (double) cur0_req_per_width;\n\t\t} else {\n\t\t\trefcyc_per_req_delivery_cur0 = (double) refclk_freq_in_mhz\n\t\t\t\t\t* (double) cur0_src_width / hscale_pixel_rate_l\n\t\t\t\t\t/ (double) cur0_req_per_width;\n\t\t}\n\n\t\tDTRACE(\"DLG: %s: cur0_req_width                     = %d\", __func__, cur0_req_width);\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: cur0_width_ub                      = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\tcur0_width_ub);\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: cur0_req_per_width                 = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\tcur0_req_per_width);\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: hactive_cur0                       = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\thactive_cur0);\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: refcyc_per_req_delivery_pre_cur0   = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\trefcyc_per_req_delivery_pre_cur0);\n\t\tDTRACE(\n\t\t\t\t\"DLG: %s: refcyc_per_req_delivery_cur0       = %3.2f\",\n\t\t\t\t__func__,\n\t\t\t\trefcyc_per_req_delivery_cur0);\n\n\t\tdisp_ttu_regs->refcyc_per_req_delivery_cur0 =\n\t\t\t\t(unsigned int) (refcyc_per_req_delivery_cur0 * dml_pow(2, 10));\n\t\tASSERT(refcyc_per_req_delivery_cur0 < dml_pow(2, 13));\n\t} else {\n\t\tdisp_ttu_regs->refcyc_per_req_delivery_pre_cur0 = 0;\n\t\tdisp_ttu_regs->refcyc_per_req_delivery_cur0 = 0;\n\t}\n\n\t \n\tdisp_ttu_regs->qos_level_low_wm = 0;\n\tASSERT(disp_ttu_regs->qos_level_low_wm < dml_pow(2, 14));\n\tdisp_ttu_regs->qos_level_high_wm = (unsigned int) (4.0 * (double) htotal\n\t\t\t* ref_freq_to_pix_freq);\n\tASSERT(disp_ttu_regs->qos_level_high_wm < dml_pow(2, 14));\n\n\tdisp_ttu_regs->qos_level_flip = 14;\n\tdisp_ttu_regs->qos_level_fixed_l = 8;\n\tdisp_ttu_regs->qos_level_fixed_c = 8;\n\tdisp_ttu_regs->qos_level_fixed_cur0 = 8;\n\tdisp_ttu_regs->qos_ramp_disable_l = 0;\n\tdisp_ttu_regs->qos_ramp_disable_c = 0;\n\tdisp_ttu_regs->qos_ramp_disable_cur0 = 0;\n\n\tdisp_ttu_regs->min_ttu_vblank = min_ttu_vblank * refclk_freq_in_mhz;\n\tASSERT(disp_ttu_regs->min_ttu_vblank < dml_pow(2, 24));\n\n\tprint__ttu_regs_st(mode_lib, disp_ttu_regs);\n\tprint__dlg_regs_st(mode_lib, disp_dlg_regs);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}