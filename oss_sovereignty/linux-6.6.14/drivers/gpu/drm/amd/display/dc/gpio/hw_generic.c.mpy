{
  "module_name": "hw_generic.c",
  "hash_id": "b4995e1c79fb28b8d2f5dd3b74d55c45e5c6d73bde6e8793d5552b15dc85056a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/gpio/hw_generic.c",
  "human_readable_source": " \n\n#include <linux/slab.h>\n\n#include \"dm_services.h\"\n\n#include \"include/gpio_interface.h\"\n#include \"include/gpio_types.h\"\n#include \"hw_gpio.h\"\n#include \"hw_generic.h\"\n\n#include \"reg_helper.h\"\n#include \"generic_regs.h\"\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\tgeneric->shifts->field_name, generic->masks->field_name\n\n#define CTX \\\n\tgeneric->base.base.ctx\n#define REG(reg)\\\n\t(generic->regs->reg)\n\nstruct gpio;\n\nstatic void dal_hw_generic_destruct(\n\tstruct hw_generic *pin)\n{\n\tdal_hw_gpio_destruct(&pin->base);\n}\n\nstatic void dal_hw_generic_destroy(\n\tstruct hw_gpio_pin **ptr)\n{\n\tstruct hw_generic *generic = HW_GENERIC_FROM_BASE(*ptr);\n\n\tdal_hw_generic_destruct(generic);\n\n\tkfree(generic);\n\n\t*ptr = NULL;\n}\n\nstatic enum gpio_result set_config(\n\tstruct hw_gpio_pin *ptr,\n\tconst struct gpio_config_data *config_data)\n{\n\tstruct hw_generic *generic = HW_GENERIC_FROM_BASE(ptr);\n\n\tif (!config_data)\n\t\treturn GPIO_RESULT_INVALID_DATA;\n\n\tREG_UPDATE_2(mux,\n\t\tGENERIC_EN, config_data->config.generic_mux.enable_output_from_mux,\n\t\tGENERIC_SEL, config_data->config.generic_mux.mux_select);\n\n\treturn GPIO_RESULT_OK;\n}\n\nstatic const struct hw_gpio_pin_funcs funcs = {\n\t.destroy = dal_hw_generic_destroy,\n\t.open = dal_hw_gpio_open,\n\t.get_value = dal_hw_gpio_get_value,\n\t.set_value = dal_hw_gpio_set_value,\n\t.set_config = set_config,\n\t.change_mode = dal_hw_gpio_change_mode,\n\t.close = dal_hw_gpio_close,\n};\n\nstatic void dal_hw_generic_construct(\n\tstruct hw_generic *pin,\n\tenum gpio_id id,\n\tuint32_t en,\n\tstruct dc_context *ctx)\n{\n\tdal_hw_gpio_construct(&pin->base, id, en, ctx);\n\tpin->base.base.funcs = &funcs;\n}\n\nvoid dal_hw_generic_init(\n\tstruct hw_generic **hw_generic,\n\tstruct dc_context *ctx,\n\tenum gpio_id id,\n\tuint32_t en)\n{\n\tif ((en < GPIO_DDC_LINE_MIN) || (en > GPIO_DDC_LINE_MAX)) {\n\t\tASSERT_CRITICAL(false);\n\t\t*hw_generic = NULL;\n\t}\n\n\t*hw_generic = kzalloc(sizeof(struct hw_generic), GFP_KERNEL);\n\tif (!*hw_generic) {\n\t\tASSERT_CRITICAL(false);\n\t\treturn;\n\t}\n\n\tdal_hw_generic_construct(*hw_generic, id, en, ctx);\n}\n\n\nstruct hw_gpio_pin *dal_hw_generic_get_pin(struct gpio *gpio)\n{\n\tstruct hw_generic *hw_generic = dal_gpio_get_generic(gpio);\n\n\treturn &hw_generic->base.base;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}