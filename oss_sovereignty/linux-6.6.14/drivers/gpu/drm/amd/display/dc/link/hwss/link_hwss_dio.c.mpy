{
  "module_name": "link_hwss_dio.c",
  "hash_id": "14acbd6e93fa338a140dd69a2103b64ff0c090e7027a68297d2f0805bc8f946e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/link/hwss/link_hwss_dio.c",
  "human_readable_source": " \n#include \"link_hwss_dio.h\"\n#include \"core_types.h\"\n#include \"link_enc_cfg.h\"\n\nvoid set_dio_throttled_vcp_size(struct pipe_ctx *pipe_ctx,\n\t\tstruct fixed31_32 throttled_vcp_size)\n{\n\tstruct stream_encoder *stream_encoder = pipe_ctx->stream_res.stream_enc;\n\n\tstream_encoder->funcs->set_throttled_vcp_size(\n\t\t\t\tstream_encoder,\n\t\t\t\tthrottled_vcp_size);\n}\n\nvoid setup_dio_stream_encoder(struct pipe_ctx *pipe_ctx)\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(pipe_ctx->stream->link);\n\tstruct stream_encoder *stream_enc = pipe_ctx->stream_res.stream_enc;\n\n\tlink_enc->funcs->connect_dig_be_to_fe(link_enc,\n\t\t\tpipe_ctx->stream_res.stream_enc->id, true);\n\tif (dc_is_dp_signal(pipe_ctx->stream->signal))\n\t\tpipe_ctx->stream->ctx->dc->link_srv->dp_trace_source_sequence(pipe_ctx->stream->link,\n\t\t\t\tDPCD_SOURCE_SEQ_AFTER_CONNECT_DIG_FE_BE);\n\tif (stream_enc->funcs->map_stream_to_link)\n\t\tstream_enc->funcs->map_stream_to_link(stream_enc,\n\t\t\t\tstream_enc->stream_enc_inst, link_enc->transmitter - TRANSMITTER_UNIPHY_A);\n\tif (stream_enc->funcs->enable_fifo)\n\t\tstream_enc->funcs->enable_fifo(stream_enc);\n}\n\nvoid reset_dio_stream_encoder(struct pipe_ctx *pipe_ctx)\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(pipe_ctx->stream->link);\n\tstruct stream_encoder *stream_enc = pipe_ctx->stream_res.stream_enc;\n\n\tif (stream_enc && stream_enc->funcs->disable_fifo)\n\t\tstream_enc->funcs->disable_fifo(stream_enc);\n\n\tlink_enc->funcs->connect_dig_be_to_fe(\n\t\t\tlink_enc,\n\t\t\tpipe_ctx->stream_res.stream_enc->id,\n\t\t\tfalse);\n\tif (dc_is_dp_signal(pipe_ctx->stream->signal))\n\t\tpipe_ctx->stream->ctx->dc->link_srv->dp_trace_source_sequence(\n\t\t\t\tpipe_ctx->stream->link,\n\t\t\t\tDPCD_SOURCE_SEQ_AFTER_DISCONNECT_DIG_FE_BE);\n\n}\n\nvoid setup_dio_stream_attribute(struct pipe_ctx *pipe_ctx)\n{\n\tstruct stream_encoder *stream_encoder = pipe_ctx->stream_res.stream_enc;\n\tstruct dc_stream_state *stream = pipe_ctx->stream;\n\tstruct dc_link *link = stream->link;\n\n\tif (!dc_is_virtual_signal(stream->signal))\n\t\tstream_encoder->funcs->setup_stereo_sync(\n\t\t\t\tstream_encoder,\n\t\t\t\tpipe_ctx->stream_res.tg->inst,\n\t\t\t\tstream->timing.timing_3d_format != TIMING_3D_FORMAT_NONE);\n\n\tif (dc_is_dp_signal(stream->signal))\n\t\tstream_encoder->funcs->dp_set_stream_attribute(\n\t\t\t\tstream_encoder,\n\t\t\t\t&stream->timing,\n\t\t\t\tstream->output_color_space,\n\t\t\t\tstream->use_vsc_sdp_for_colorimetry,\n\t\t\t\tlink->dpcd_caps.dprx_feature.bits.SST_SPLIT_SDP_CAP);\n\telse if (dc_is_hdmi_tmds_signal(stream->signal))\n\t\tstream_encoder->funcs->hdmi_set_stream_attribute(\n\t\t\t\tstream_encoder,\n\t\t\t\t&stream->timing,\n\t\t\t\tstream->phy_pix_clk,\n\t\t\t\tpipe_ctx->stream_res.audio != NULL);\n\telse if (dc_is_dvi_signal(stream->signal))\n\t\tstream_encoder->funcs->dvi_set_stream_attribute(\n\t\t\t\tstream_encoder,\n\t\t\t\t&stream->timing,\n\t\t\t\t(stream->signal == SIGNAL_TYPE_DVI_DUAL_LINK) ?\n\t\t\t\t\t\ttrue : false);\n\telse if (dc_is_lvds_signal(stream->signal))\n\t\tstream_encoder->funcs->lvds_set_stream_attribute(\n\t\t\t\tstream_encoder,\n\t\t\t\t&stream->timing);\n\n\tif (dc_is_dp_signal(stream->signal))\n\t\tlink->dc->link_srv->dp_trace_source_sequence(link,\n\t\t\t\tDPCD_SOURCE_SEQ_AFTER_DP_STREAM_ATTR);\n}\n\nvoid enable_dio_dp_link_output(struct dc_link *link,\n\t\tconst struct link_resource *link_res,\n\t\tenum signal_type signal,\n\t\tenum clock_source_id clock_source,\n\t\tconst struct dc_link_settings *link_settings)\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(link);\n\n\tif (dc_is_dp_sst_signal(signal))\n\t\tlink_enc->funcs->enable_dp_output(\n\t\t\t\tlink_enc,\n\t\t\t\tlink_settings,\n\t\t\t\tclock_source);\n\telse\n\t\tlink_enc->funcs->enable_dp_mst_output(\n\t\t\t\tlink_enc,\n\t\t\t\tlink_settings,\n\t\t\t\tclock_source);\n\tlink->dc->link_srv->dp_trace_source_sequence(link,\n\t\t\tDPCD_SOURCE_SEQ_AFTER_ENABLE_LINK_PHY);\n}\n\nvoid disable_dio_link_output(struct dc_link *link,\n\t\tconst struct link_resource *link_res,\n\t\tenum signal_type signal)\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(link);\n\n\tlink_enc->funcs->disable_output(link_enc, signal);\n\tlink->dc->link_srv->dp_trace_source_sequence(link,\n\t\t\tDPCD_SOURCE_SEQ_AFTER_DISABLE_LINK_PHY);\n}\n\nvoid set_dio_dp_link_test_pattern(struct dc_link *link,\n\t\tconst struct link_resource *link_res,\n\t\tstruct encoder_set_dp_phy_pattern_param *tp_params)\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(link);\n\n\tlink_enc->funcs->dp_set_phy_pattern(link_enc, tp_params);\n\tlink->dc->link_srv->dp_trace_source_sequence(link, DPCD_SOURCE_SEQ_AFTER_SET_SOURCE_PATTERN);\n}\n\nvoid set_dio_dp_lane_settings(struct dc_link *link,\n\t\tconst struct link_resource *link_res,\n\t\tconst struct dc_link_settings *link_settings,\n\t\tconst struct dc_lane_settings lane_settings[LANE_COUNT_DP_MAX])\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(link);\n\n\tlink_enc->funcs->dp_set_lane_settings(link_enc, link_settings, lane_settings);\n}\n\nvoid update_dio_stream_allocation_table(struct dc_link *link,\n\t\tconst struct link_resource *link_res,\n\t\tconst struct link_mst_stream_allocation_table *table)\n{\n\tstruct link_encoder *link_enc = link_enc_cfg_get_link_enc(link);\n\n\tASSERT(link_enc);\n\tlink_enc->funcs->update_mst_stream_allocation_table(link_enc, table);\n}\n\nvoid setup_dio_audio_output(struct pipe_ctx *pipe_ctx,\n\t\tstruct audio_output *audio_output, uint32_t audio_inst)\n{\n\tif (dc_is_dp_signal(pipe_ctx->stream->signal))\n\t\tpipe_ctx->stream_res.stream_enc->funcs->dp_audio_setup(\n\t\t\t\tpipe_ctx->stream_res.stream_enc,\n\t\t\t\taudio_inst,\n\t\t\t\t&pipe_ctx->stream->audio_info);\n\telse\n\t\tpipe_ctx->stream_res.stream_enc->funcs->hdmi_audio_setup(\n\t\t\t\tpipe_ctx->stream_res.stream_enc,\n\t\t\t\taudio_inst,\n\t\t\t\t&pipe_ctx->stream->audio_info,\n\t\t\t\t&audio_output->crtc_info);\n}\n\nvoid enable_dio_audio_packet(struct pipe_ctx *pipe_ctx)\n{\n\tif (dc_is_dp_signal(pipe_ctx->stream->signal))\n\t\tpipe_ctx->stream_res.stream_enc->funcs->dp_audio_enable(\n\t\t\t\tpipe_ctx->stream_res.stream_enc);\n\n\tpipe_ctx->stream_res.stream_enc->funcs->audio_mute_control(\n\t\t\tpipe_ctx->stream_res.stream_enc, false);\n\n\tif (dc_is_dp_signal(pipe_ctx->stream->signal))\n\t\tpipe_ctx->stream->ctx->dc->link_srv->dp_trace_source_sequence(\n\t\t\t\tpipe_ctx->stream->link,\n\t\t\t\tDPCD_SOURCE_SEQ_AFTER_ENABLE_AUDIO_STREAM);\n}\n\nvoid disable_dio_audio_packet(struct pipe_ctx *pipe_ctx)\n{\n\tpipe_ctx->stream_res.stream_enc->funcs->audio_mute_control(\n\t\t\tpipe_ctx->stream_res.stream_enc, true);\n\n\tif (pipe_ctx->stream_res.audio) {\n\t\tif (dc_is_dp_signal(pipe_ctx->stream->signal))\n\t\t\tpipe_ctx->stream_res.stream_enc->funcs->dp_audio_disable(\n\t\t\t\t\tpipe_ctx->stream_res.stream_enc);\n\t\telse\n\t\t\tpipe_ctx->stream_res.stream_enc->funcs->hdmi_audio_disable(\n\t\t\t\t\tpipe_ctx->stream_res.stream_enc);\n\t}\n\n\tif (dc_is_dp_signal(pipe_ctx->stream->signal))\n\t\tpipe_ctx->stream->ctx->dc->link_srv->dp_trace_source_sequence(\n\t\t\t\tpipe_ctx->stream->link,\n\t\t\t\tDPCD_SOURCE_SEQ_AFTER_DISABLE_AUDIO_STREAM);\n}\n\nstatic const struct link_hwss dio_link_hwss = {\n\t.setup_stream_encoder = setup_dio_stream_encoder,\n\t.reset_stream_encoder = reset_dio_stream_encoder,\n\t.setup_stream_attribute = setup_dio_stream_attribute,\n\t.disable_link_output = disable_dio_link_output,\n\t.setup_audio_output = setup_dio_audio_output,\n\t.enable_audio_packet = enable_dio_audio_packet,\n\t.disable_audio_packet = disable_dio_audio_packet,\n\t.ext = {\n\t\t.set_throttled_vcp_size = set_dio_throttled_vcp_size,\n\t\t.enable_dp_link_output = enable_dio_dp_link_output,\n\t\t.set_dp_link_test_pattern = set_dio_dp_link_test_pattern,\n\t\t.set_dp_lane_settings = set_dio_dp_lane_settings,\n\t\t.update_stream_allocation_table = update_dio_stream_allocation_table,\n\t},\n};\n\nbool can_use_dio_link_hwss(const struct dc_link *link,\n\t\tconst struct link_resource *link_res)\n{\n\treturn link->link_enc != NULL;\n}\n\nconst struct link_hwss *get_dio_link_hwss(void)\n{\n\treturn &dio_link_hwss;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}