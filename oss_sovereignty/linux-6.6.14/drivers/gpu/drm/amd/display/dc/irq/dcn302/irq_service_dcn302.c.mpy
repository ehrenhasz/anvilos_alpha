{
  "module_name": "irq_service_dcn302.c",
  "hash_id": "d5a4cfc5f92ac4075da4813c86d7dc598e35e1c76451783d461150bdfa5c3f4b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/irq/dcn302/irq_service_dcn302.c",
  "human_readable_source": " \n\n#include \"dm_services.h\"\n\n#include \"irq_service_dcn302.h\"\n\n#include \"../dce110/irq_service_dce110.h\"\n\n#include \"dimgrey_cavefish_ip_offset.h\"\n#include \"dcn/dcn_3_0_0_offset.h\"\n#include \"dcn/dcn_3_0_0_sh_mask.h\"\n\n#include \"ivsrcid/dcn/irqsrcs_dcn_1_0.h\"\n\nstatic enum dc_irq_source to_dal_irq_source_dcn302(struct irq_service *irq_service, uint32_t src_id, uint32_t ext_id)\n{\n\tswitch (src_id) {\n\tcase DCN_1_0__SRCID__DC_D1_OTG_VSTARTUP:\n\t\treturn DC_IRQ_SOURCE_VBLANK1;\n\tcase DCN_1_0__SRCID__DC_D2_OTG_VSTARTUP:\n\t\treturn DC_IRQ_SOURCE_VBLANK2;\n\tcase DCN_1_0__SRCID__DC_D3_OTG_VSTARTUP:\n\t\treturn DC_IRQ_SOURCE_VBLANK3;\n\tcase DCN_1_0__SRCID__DC_D4_OTG_VSTARTUP:\n\t\treturn DC_IRQ_SOURCE_VBLANK4;\n\tcase DCN_1_0__SRCID__DC_D5_OTG_VSTARTUP:\n\t\treturn DC_IRQ_SOURCE_VBLANK5;\n\tcase DCN_1_0__SRCID__DC_D6_OTG_VSTARTUP:\n\t\treturn DC_IRQ_SOURCE_VBLANK6;\n\tcase DCN_1_0__SRCID__DMCUB_OUTBOX_HIGH_PRIORITY_READY_INT:\n\t\treturn DC_IRQ_SOURCE_DMCUB_OUTBOX0;\n\tcase DCN_1_0__SRCID__OTG1_VERTICAL_INTERRUPT0_CONTROL:\n\t\treturn DC_IRQ_SOURCE_DC1_VLINE0;\n\tcase DCN_1_0__SRCID__OTG2_VERTICAL_INTERRUPT0_CONTROL:\n\t\treturn DC_IRQ_SOURCE_DC2_VLINE0;\n\tcase DCN_1_0__SRCID__OTG3_VERTICAL_INTERRUPT0_CONTROL:\n\t\treturn DC_IRQ_SOURCE_DC3_VLINE0;\n\tcase DCN_1_0__SRCID__OTG4_VERTICAL_INTERRUPT0_CONTROL:\n\t\treturn DC_IRQ_SOURCE_DC4_VLINE0;\n\tcase DCN_1_0__SRCID__OTG5_VERTICAL_INTERRUPT0_CONTROL:\n\t\treturn DC_IRQ_SOURCE_DC5_VLINE0;\n\tcase DCN_1_0__SRCID__OTG6_VERTICAL_INTERRUPT0_CONTROL:\n\t\treturn DC_IRQ_SOURCE_DC6_VLINE0;\n\tcase DCN_1_0__SRCID__HUBP0_FLIP_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_PFLIP1;\n\tcase DCN_1_0__SRCID__HUBP1_FLIP_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_PFLIP2;\n\tcase DCN_1_0__SRCID__HUBP2_FLIP_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_PFLIP3;\n\tcase DCN_1_0__SRCID__HUBP3_FLIP_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_PFLIP4;\n\tcase DCN_1_0__SRCID__HUBP4_FLIP_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_PFLIP5;\n\tcase DCN_1_0__SRCID__HUBP5_FLIP_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_PFLIP6;\n\tcase DCN_1_0__SRCID__OTG0_IHC_V_UPDATE_NO_LOCK_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_VUPDATE1;\n\tcase DCN_1_0__SRCID__OTG1_IHC_V_UPDATE_NO_LOCK_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_VUPDATE2;\n\tcase DCN_1_0__SRCID__OTG2_IHC_V_UPDATE_NO_LOCK_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_VUPDATE3;\n\tcase DCN_1_0__SRCID__OTG3_IHC_V_UPDATE_NO_LOCK_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_VUPDATE4;\n\tcase DCN_1_0__SRCID__OTG4_IHC_V_UPDATE_NO_LOCK_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_VUPDATE5;\n\tcase DCN_1_0__SRCID__OTG5_IHC_V_UPDATE_NO_LOCK_INTERRUPT:\n\t\treturn DC_IRQ_SOURCE_VUPDATE6;\n\n\tcase DCN_1_0__SRCID__DC_HPD1_INT:\n\t\t \n\t\tswitch (ext_id) {\n\t\tcase DCN_1_0__CTXID__DC_HPD1_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD1;\n\t\tcase DCN_1_0__CTXID__DC_HPD2_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD2;\n\t\tcase DCN_1_0__CTXID__DC_HPD3_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD3;\n\t\tcase DCN_1_0__CTXID__DC_HPD4_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD4;\n\t\tcase DCN_1_0__CTXID__DC_HPD5_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD5;\n\t\tcase DCN_1_0__CTXID__DC_HPD6_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD6;\n\t\tcase DCN_1_0__CTXID__DC_HPD1_RX_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD1RX;\n\t\tcase DCN_1_0__CTXID__DC_HPD2_RX_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD2RX;\n\t\tcase DCN_1_0__CTXID__DC_HPD3_RX_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD3RX;\n\t\tcase DCN_1_0__CTXID__DC_HPD4_RX_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD4RX;\n\t\tcase DCN_1_0__CTXID__DC_HPD5_RX_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD5RX;\n\t\tcase DCN_1_0__CTXID__DC_HPD6_RX_INT:\n\t\t\treturn DC_IRQ_SOURCE_HPD6RX;\n\t\tdefault:\n\t\t\treturn DC_IRQ_SOURCE_INVALID;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\treturn DC_IRQ_SOURCE_INVALID;\n\t}\n}\n\nstatic bool hpd_ack(struct irq_service *irq_service, const struct irq_source_info *info)\n{\n\tuint32_t addr = info->status_reg;\n\tuint32_t value = dm_read_reg(irq_service->ctx, addr);\n\tuint32_t current_status = get_reg_field_value(value, HPD0_DC_HPD_INT_STATUS, DC_HPD_SENSE_DELAYED);\n\n\tdal_irq_service_ack_generic(irq_service, info);\n\n\tvalue = dm_read_reg(irq_service->ctx, info->enable_reg);\n\n\tset_reg_field_value(value, current_status ? 0 : 1, HPD0_DC_HPD_INT_CONTROL, DC_HPD_INT_POLARITY);\n\n\tdm_write_reg(irq_service->ctx, info->enable_reg, value);\n\n\treturn true;\n}\n\nstatic const struct irq_source_info_funcs hpd_irq_info_funcs = {\n\t\t.set = NULL,\n\t\t.ack = hpd_ack\n};\n\nstatic const struct irq_source_info_funcs hpd_rx_irq_info_funcs = {\n\t\t.set = NULL,\n\t\t.ack = NULL\n};\n\nstatic const struct irq_source_info_funcs pflip_irq_info_funcs = {\n\t\t.set = NULL,\n\t\t.ack = NULL\n};\n\nstatic const struct irq_source_info_funcs vupdate_no_lock_irq_info_funcs = {\n\t.set = NULL,\n\t.ack = NULL\n};\n\nstatic const struct irq_source_info_funcs vblank_irq_info_funcs = {\n\t\t.set = NULL,\n\t\t.ack = NULL\n};\n\nstatic const struct irq_source_info_funcs dmub_trace_irq_info_funcs = {\n\t.set = NULL,\n\t.ack = NULL\n};\n\nstatic const struct irq_source_info_funcs vline0_irq_info_funcs = {\n\t.set = NULL,\n\t.ack = NULL\n};\n\n#undef BASE_INNER\n#define BASE_INNER(seg) DCN_BASE__INST0_SEG ## seg\n\n \n#define BASE(seg) BASE_INNER(seg)\n\n#define SRI(reg_name, block, id)\\\n\t\tBASE(mm ## block ## id ## _ ## reg_name ## _BASE_IDX) + \\\n\t\tmm ## block ## id ## _ ## reg_name\n\n#define SRI_DMUB(reg_name)\\\n\t\tBASE(mm ## reg_name ## _BASE_IDX) + \\\n\t\t\tmm ## reg_name\n\n#define IRQ_REG_ENTRY(block, reg_num, reg1, mask1, reg2, mask2)\\\n\t\t.enable_reg = SRI(reg1, block, reg_num),\\\n\t\t.enable_mask = block ## reg_num ## _ ## reg1 ## __ ## mask1 ## _MASK,\\\n\t\t.enable_value = {\\\n\t\t\t\tblock ## reg_num ## _ ## reg1 ## __ ## mask1 ## _MASK,\\\n\t\t\t\t~block ## reg_num ## _ ## reg1 ## __ ## mask1 ## _MASK \\\n\t\t},\\\n\t\t.ack_reg = SRI(reg2, block, reg_num),\\\n\t\t.ack_mask = block ## reg_num ## _ ## reg2 ## __ ## mask2 ## _MASK,\\\n\t\t.ack_value = block ## reg_num ## _ ## reg2 ## __ ## mask2 ## _MASK \\\n\n#define dmub_trace_int_entry()\\\n\t[DC_IRQ_SOURCE_DMCUB_OUTBOX0] = {\\\n\t\tIRQ_REG_ENTRY_DMUB(DMCUB_INTERRUPT_ENABLE, DMCUB_OUTBOX0_READY_INT_EN,\\\n\t\t\tDMCUB_INTERRUPT_ACK, DMCUB_OUTBOX0_READY_INT_ACK),\\\n\t\t.funcs = &dmub_trace_irq_info_funcs\\\n\t}\n\n#define IRQ_REG_ENTRY_DMUB(reg1, mask1, reg2, mask2)\\\n\t.enable_reg = SRI_DMUB(reg1),\\\n\t.enable_mask = \\\n\t\treg1 ## __ ## mask1 ## _MASK,\\\n\t.enable_value = {\\\n\t\treg1 ## __ ## mask1 ## _MASK,\\\n\t\t~reg1 ## __ ## mask1 ## _MASK \\\n\t},\\\n\t.ack_reg = SRI_DMUB(reg2),\\\n\t.ack_mask = \\\n\t\treg2 ## __ ## mask2 ## _MASK,\\\n\t.ack_value = \\\n\t\treg2 ## __ ## mask2 ## _MASK \\\n\n#define hpd_int_entry(reg_num)\\\n\t\t[DC_IRQ_SOURCE_HPD1 + reg_num] = {\\\n\t\t\t\tIRQ_REG_ENTRY(HPD, reg_num,\\\n\t\t\t\t\t\tDC_HPD_INT_CONTROL, DC_HPD_INT_EN,\\\n\t\t\t\t\t\tDC_HPD_INT_CONTROL, DC_HPD_INT_ACK),\\\n\t\t\t\t\t\t.status_reg = SRI(DC_HPD_INT_STATUS, HPD, reg_num),\\\n\t\t\t\t\t\t.funcs = &hpd_irq_info_funcs\\\n}\n\n#define hpd_rx_int_entry(reg_num)\\\n\t\t[DC_IRQ_SOURCE_HPD1RX + reg_num] = {\\\n\t\t\t\tIRQ_REG_ENTRY(HPD, reg_num,\\\n\t\t\t\t\t\tDC_HPD_INT_CONTROL, DC_HPD_RX_INT_EN,\\\n\t\t\t\t\t\tDC_HPD_INT_CONTROL, DC_HPD_RX_INT_ACK),\\\n\t\t\t\t\t\t.status_reg = SRI(DC_HPD_INT_STATUS, HPD, reg_num),\\\n\t\t\t\t\t\t.funcs = &hpd_rx_irq_info_funcs\\\n}\n#define pflip_int_entry(reg_num)\\\n\t\t[DC_IRQ_SOURCE_PFLIP1 + reg_num] = {\\\n\t\t\t\tIRQ_REG_ENTRY(HUBPREQ, reg_num,\\\n\t\t\t\t\t\tDCSURF_SURFACE_FLIP_INTERRUPT, SURFACE_FLIP_INT_MASK,\\\n\t\t\t\t\t\tDCSURF_SURFACE_FLIP_INTERRUPT, SURFACE_FLIP_CLEAR),\\\n\t\t\t\t\t\t.funcs = &pflip_irq_info_funcs\\\n}\n\n \n#define vupdate_no_lock_int_entry(reg_num)\\\n\t[DC_IRQ_SOURCE_VUPDATE1 + reg_num] = {\\\n\t\tIRQ_REG_ENTRY(OTG, reg_num,\\\n\t\t\tOTG_GLOBAL_SYNC_STATUS, VUPDATE_NO_LOCK_INT_EN,\\\n\t\t\tOTG_GLOBAL_SYNC_STATUS, VUPDATE_NO_LOCK_EVENT_CLEAR),\\\n\t\t.funcs = &vupdate_no_lock_irq_info_funcs\\\n\t}\n\n#define vblank_int_entry(reg_num)\\\n\t[DC_IRQ_SOURCE_VBLANK1 + reg_num] = {\\\n\t\tIRQ_REG_ENTRY(OTG, reg_num,\\\n\t\t\tOTG_GLOBAL_SYNC_STATUS, VSTARTUP_INT_EN,\\\n\t\t\tOTG_GLOBAL_SYNC_STATUS, VSTARTUP_EVENT_CLEAR),\\\n\t\t.funcs = &vblank_irq_info_funcs\\\n\t}\n\n#define vline0_int_entry(reg_num)\\\n\t[DC_IRQ_SOURCE_DC1_VLINE0 + reg_num] = {\\\n\t\tIRQ_REG_ENTRY(OTG, reg_num,\\\n\t\t\tOTG_VERTICAL_INTERRUPT0_CONTROL, OTG_VERTICAL_INTERRUPT0_INT_ENABLE,\\\n\t\t\tOTG_VERTICAL_INTERRUPT0_CONTROL, OTG_VERTICAL_INTERRUPT0_CLEAR),\\\n\t\t.funcs = &vline0_irq_info_funcs\\\n\t}\n\n#define dummy_irq_entry() { .funcs = &dummy_irq_info_funcs }\n\n#define i2c_int_entry(reg_num) \\\n\t\t[DC_IRQ_SOURCE_I2C_DDC ## reg_num] = dummy_irq_entry()\n\n#define dp_sink_int_entry(reg_num) \\\n\t\t[DC_IRQ_SOURCE_DPSINK ## reg_num] = dummy_irq_entry()\n\n#define gpio_pad_int_entry(reg_num) \\\n\t\t[DC_IRQ_SOURCE_GPIOPAD ## reg_num] = dummy_irq_entry()\n\n#define dc_underflow_int_entry(reg_num) \\\n\t\t[DC_IRQ_SOURCE_DC ## reg_num ## UNDERFLOW] = dummy_irq_entry()\n\nstatic const struct irq_source_info_funcs dummy_irq_info_funcs = {\n\t\t.set = dal_irq_service_dummy_set,\n\t\t.ack = dal_irq_service_dummy_ack\n};\n\nstatic const struct irq_source_info irq_source_info_dcn302[DAL_IRQ_SOURCES_NUMBER] = {\n\t\t[DC_IRQ_SOURCE_INVALID] = dummy_irq_entry(),\n\t\thpd_int_entry(0),\n\t\thpd_int_entry(1),\n\t\thpd_int_entry(2),\n\t\thpd_int_entry(3),\n\t\thpd_int_entry(4),\n\t\thpd_rx_int_entry(0),\n\t\thpd_rx_int_entry(1),\n\t\thpd_rx_int_entry(2),\n\t\thpd_rx_int_entry(3),\n\t\thpd_rx_int_entry(4),\n\t\ti2c_int_entry(1),\n\t\ti2c_int_entry(2),\n\t\ti2c_int_entry(3),\n\t\ti2c_int_entry(4),\n\t\ti2c_int_entry(5),\n\t\tdp_sink_int_entry(1),\n\t\tdp_sink_int_entry(2),\n\t\tdp_sink_int_entry(3),\n\t\tdp_sink_int_entry(4),\n\t\tdp_sink_int_entry(5),\n\t\t[DC_IRQ_SOURCE_TIMER] = dummy_irq_entry(),\n\t\tpflip_int_entry(0),\n\t\tpflip_int_entry(1),\n\t\tpflip_int_entry(2),\n\t\tpflip_int_entry(3),\n\t\tpflip_int_entry(4),\n\t\t[DC_IRQ_SOURCE_PFLIP_UNDERLAY0] = dummy_irq_entry(),\n\t\tgpio_pad_int_entry(0),\n\t\tgpio_pad_int_entry(1),\n\t\tgpio_pad_int_entry(2),\n\t\tgpio_pad_int_entry(3),\n\t\tgpio_pad_int_entry(4),\n\t\tgpio_pad_int_entry(5),\n\t\tgpio_pad_int_entry(6),\n\t\tgpio_pad_int_entry(7),\n\t\tgpio_pad_int_entry(8),\n\t\tgpio_pad_int_entry(9),\n\t\tgpio_pad_int_entry(10),\n\t\tgpio_pad_int_entry(11),\n\t\tgpio_pad_int_entry(12),\n\t\tgpio_pad_int_entry(13),\n\t\tgpio_pad_int_entry(14),\n\t\tgpio_pad_int_entry(15),\n\t\tgpio_pad_int_entry(16),\n\t\tgpio_pad_int_entry(17),\n\t\tgpio_pad_int_entry(18),\n\t\tgpio_pad_int_entry(19),\n\t\tgpio_pad_int_entry(20),\n\t\tgpio_pad_int_entry(21),\n\t\tgpio_pad_int_entry(22),\n\t\tgpio_pad_int_entry(23),\n\t\tgpio_pad_int_entry(24),\n\t\tgpio_pad_int_entry(25),\n\t\tgpio_pad_int_entry(26),\n\t\tgpio_pad_int_entry(27),\n\t\tgpio_pad_int_entry(28),\n\t\tgpio_pad_int_entry(29),\n\t\tgpio_pad_int_entry(30),\n\t\tdc_underflow_int_entry(1),\n\t\tdc_underflow_int_entry(2),\n\t\tdc_underflow_int_entry(3),\n\t\tdc_underflow_int_entry(4),\n\t\tdc_underflow_int_entry(5),\n\t\t[DC_IRQ_SOURCE_DMCU_SCP] = dummy_irq_entry(),\n\t\t[DC_IRQ_SOURCE_VBIOS_SW] = dummy_irq_entry(),\n\t\tvupdate_no_lock_int_entry(0),\n\t\tvupdate_no_lock_int_entry(1),\n\t\tvupdate_no_lock_int_entry(2),\n\t\tvupdate_no_lock_int_entry(3),\n\t\tvupdate_no_lock_int_entry(4),\n\t\tvblank_int_entry(0),\n\t\tvblank_int_entry(1),\n\t\tvblank_int_entry(2),\n\t\tvblank_int_entry(3),\n\t\tvblank_int_entry(4),\n\t\tvline0_int_entry(0),\n\t\tvline0_int_entry(1),\n\t\tvline0_int_entry(2),\n\t\tvline0_int_entry(3),\n\t\tvline0_int_entry(4),\n\t\tdmub_trace_int_entry(),\n};\n\nstatic const struct irq_service_funcs irq_service_funcs_dcn302 = {\n\t\t.to_dal_irq_source = to_dal_irq_source_dcn302\n};\n\nstatic void dcn302_irq_construct(struct irq_service *irq_service, struct irq_service_init_data *init_data)\n{\n\tdal_irq_service_construct(irq_service, init_data);\n\n\tirq_service->info = irq_source_info_dcn302;\n\tirq_service->funcs = &irq_service_funcs_dcn302;\n}\n\nstruct irq_service *dal_irq_service_dcn302_create(struct irq_service_init_data *init_data)\n{\n\tstruct irq_service *irq_service = kzalloc(sizeof(*irq_service), GFP_KERNEL);\n\n\tif (!irq_service)\n\t\treturn NULL;\n\n\tdcn302_irq_construct(irq_service, init_data);\n\treturn irq_service;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}