{
  "module_name": "dcn21_dccg.c",
  "hash_id": "50e788a66ed07be6b804b283fb4033a27eec47f167525599c0c9566abdf3d3d5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/dc/dcn21/dcn21_dccg.c",
  "human_readable_source": " \n\n#include \"reg_helper.h\"\n#include \"core_types.h\"\n#include \"dcn20/dcn20_dccg.h\"\n#include \"dcn21_dccg.h\"\n\n#define TO_DCN_DCCG(dccg)\\\n\tcontainer_of(dccg, struct dcn_dccg, base)\n\n#define REG(reg) \\\n\t(dccg_dcn->regs->reg)\n\n#undef FN\n#define FN(reg_name, field_name) \\\n\tdccg_dcn->dccg_shift->field_name, dccg_dcn->dccg_mask->field_name\n\n#define CTX \\\n\tdccg_dcn->base.ctx\n#define DC_LOGGER \\\n\tdccg->ctx->logger\n\nstatic void dccg21_update_dpp_dto(struct dccg *dccg, int dpp_inst, int req_dppclk)\n{\n\tstruct dcn_dccg *dccg_dcn = TO_DCN_DCCG(dccg);\n\n\tif (dccg->ref_dppclk) {\n\t\tint ref_dppclk = dccg->ref_dppclk;\n\t\tint modulo = ref_dppclk / 10000;\n\t\tint phase;\n\n\t\tif (req_dppclk) {\n\t\t\t \n\t\t\tphase = (req_dppclk + 9999) / 10000;\n\n\t\t\tif (phase > modulo) {\n\t\t\t\t \n\t\t\t\tphase = modulo;\n\t\t\t}\n\t\t} else {\n\t\t\t \n\t\t\tphase = 10;\n\t\t}\n\n\t\tREG_SET_2(DPPCLK_DTO_PARAM[dpp_inst], 0,\n\t\t\t\tDPPCLK0_DTO_PHASE, phase,\n\t\t\t\tDPPCLK0_DTO_MODULO, modulo);\n\n\t\tREG_UPDATE(DPPCLK_DTO_CTRL,\n\t\t\t\tDPPCLK_DTO_ENABLE[dpp_inst], 1);\n\t}\n\n\tdccg->pipe_dppclk_khz[dpp_inst] = req_dppclk;\n}\n\n\nstatic const struct dccg_funcs dccg21_funcs = {\n\t.update_dpp_dto = dccg21_update_dpp_dto,\n\t.get_dccg_ref_freq = dccg2_get_dccg_ref_freq,\n\t.set_fifo_errdet_ovr_en = dccg2_set_fifo_errdet_ovr_en,\n\t.otg_add_pixel = dccg2_otg_add_pixel,\n\t.otg_drop_pixel = dccg2_otg_drop_pixel,\n\t.dccg_init = dccg2_init\n};\n\nstruct dccg *dccg21_create(\n\tstruct dc_context *ctx,\n\tconst struct dccg_registers *regs,\n\tconst struct dccg_shift *dccg_shift,\n\tconst struct dccg_mask *dccg_mask)\n{\n\tstruct dcn_dccg *dccg_dcn = kzalloc(sizeof(*dccg_dcn), GFP_KERNEL);\n\tstruct dccg *base;\n\n\tif (dccg_dcn == NULL) {\n\t\tBREAK_TO_DEBUGGER();\n\t\treturn NULL;\n\t}\n\n\tbase = &dccg_dcn->base;\n\tbase->ctx = ctx;\n\tbase->funcs = &dccg21_funcs;\n\n\tdccg_dcn->regs = regs;\n\tdccg_dcn->dccg_shift = dccg_shift;\n\tdccg_dcn->dccg_mask = dccg_mask;\n\n\treturn &dccg_dcn->base;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}