{
  "module_name": "amdgpu_dm.h",
  "hash_id": "cf539e49c9a438e7e4ca55e3700aef87411259f8c0c5dd4d0f302bdaa582a6f6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.h",
  "human_readable_source": " \n\n#ifndef __AMDGPU_DM_H__\n#define __AMDGPU_DM_H__\n\n#include <drm/display/drm_dp_mst_helper.h>\n#include <drm/drm_atomic.h>\n#include <drm/drm_connector.h>\n#include <drm/drm_crtc.h>\n#include <drm/drm_plane.h>\n#include \"link_service_types.h\"\n\n \n\n#define AMDGPU_DM_MAX_DISPLAY_INDEX 31\n\n#define AMDGPU_DM_MAX_CRTC 6\n\n#define AMDGPU_DM_MAX_NUM_EDP 2\n\n#define AMDGPU_DMUB_NOTIFICATION_MAX 5\n\n#define HDMI_AMD_VENDOR_SPECIFIC_DATA_BLOCK_IEEE_REGISTRATION_ID 0x00001A\n#define AMD_VSDB_VERSION_3_FEATURECAP_REPLAYMODE 0x40\n#define HDMI_AMD_VENDOR_SPECIFIC_DATA_BLOCK_VERSION_3 0x3\n \n\n#include \"irq_types.h\"\n#include \"signal_types.h\"\n#include \"amdgpu_dm_crc.h\"\n#include \"mod_info_packet.h\"\nstruct aux_payload;\nstruct set_config_cmd_payload;\nenum aux_return_code_type;\nenum set_config_status;\n\n \nstruct amdgpu_device;\nstruct amdgpu_crtc;\nstruct drm_device;\nstruct dc;\nstruct amdgpu_bo;\nstruct dmub_srv;\nstruct dc_plane_state;\nstruct dmub_notification;\n\nstruct amd_vsdb_block {\n\tunsigned char ieee_id[3];\n\tunsigned char version;\n\tunsigned char feature_caps;\n};\n\nstruct common_irq_params {\n\tstruct amdgpu_device *adev;\n\tenum dc_irq_source irq_src;\n\tatomic64_t previous_timestamp;\n};\n\n \nstruct dm_compressor_info {\n\tvoid *cpu_addr;\n\tstruct amdgpu_bo *bo_ptr;\n\tuint64_t gpu_addr;\n};\n\ntypedef void (*dmub_notify_interrupt_callback_t)(struct amdgpu_device *adev, struct dmub_notification *notify);\n\n \nstruct dmub_hpd_work {\n\tstruct work_struct handle_hpd_work;\n\tstruct dmub_notification *dmub_notify;\n\tstruct amdgpu_device *adev;\n};\n\n \nstruct vblank_control_work {\n\tstruct work_struct work;\n\tstruct amdgpu_display_manager *dm;\n\tstruct amdgpu_crtc *acrtc;\n\tstruct dc_stream_state *stream;\n\tbool enable;\n};\n\n \nstruct amdgpu_dm_backlight_caps {\n\t \n\tunion dpcd_sink_ext_caps *ext_caps;\n\t \n\tu32 aux_min_input_signal;\n\t \n\tu32 aux_max_input_signal;\n\t \n\tint min_input_signal;\n\t \n\tint max_input_signal;\n\t \n\tbool caps_valid;\n\t \n\tbool aux_support;\n};\n\n \nstruct dal_allocation {\n\tstruct list_head list;\n\tstruct amdgpu_bo *bo;\n\tvoid *cpu_ptr;\n\tu64 gpu_addr;\n};\n\n \nstruct hpd_rx_irq_offload_work_queue {\n\t \n\tstruct workqueue_struct *wq;\n\t \n\tspinlock_t offload_lock;\n\t \n\tbool is_handling_link_loss;\n\t \n\tbool is_handling_mst_msg_rdy_event;\n\t \n\tstruct amdgpu_dm_connector *aconnector;\n};\n\n \nstruct hpd_rx_irq_offload_work {\n\t \n\tstruct work_struct work;\n\t \n\tunion hpd_irq_data data;\n\t \n\tstruct hpd_rx_irq_offload_work_queue *offload_wq;\n};\n\n \nstruct amdgpu_display_manager {\n\n\tstruct dc *dc;\n\n\t \n\tstruct dmub_srv *dmub_srv;\n\n\t \n\n\tstruct dmub_notification *dmub_notify;\n\n\t \n\n\tdmub_notify_interrupt_callback_t dmub_callback[AMDGPU_DMUB_NOTIFICATION_MAX];\n\n\t \n\n\tbool dmub_thread_offload[AMDGPU_DMUB_NOTIFICATION_MAX];\n\n\t \n\tstruct dmub_srv_fb_info *dmub_fb_info;\n\n\t \n\tconst struct firmware *dmub_fw;\n\n\t \n\tstruct amdgpu_bo *dmub_bo;\n\n\t \n\tu64 dmub_bo_gpu_addr;\n\n\t \n\tvoid *dmub_bo_cpu_addr;\n\n\t \n\tuint32_t dmcub_fw_version;\n\n\t \n\tstruct cgs_device *cgs_device;\n\n\tstruct amdgpu_device *adev;\n\tstruct drm_device *ddev;\n\tu16 display_indexes_num;\n\n\t \n\tstruct drm_private_obj atomic_obj;\n\n\t \n\tstruct mutex dc_lock;\n\n\t \n\tstruct mutex audio_lock;\n\n\t \n\tstruct drm_audio_component *audio_component;\n\n\t \n\tbool audio_registered;\n\n\t \n\tstruct list_head irq_handler_list_low_tab[DAL_IRQ_SOURCES_NUMBER];\n\n\t \n\tstruct list_head irq_handler_list_high_tab[DAL_IRQ_SOURCES_NUMBER];\n\n\t \n\tstruct common_irq_params\n\tpflip_params[DC_IRQ_SOURCE_PFLIP_LAST - DC_IRQ_SOURCE_PFLIP_FIRST + 1];\n\n\t \n\tstruct common_irq_params\n\tvblank_params[DC_IRQ_SOURCE_VBLANK6 - DC_IRQ_SOURCE_VBLANK1 + 1];\n\n\t \n\tstruct common_irq_params\n\tvline0_params[DC_IRQ_SOURCE_DC6_VLINE0 - DC_IRQ_SOURCE_DC1_VLINE0 + 1];\n\n\t \n\tstruct common_irq_params\n\tvupdate_params[DC_IRQ_SOURCE_VUPDATE6 - DC_IRQ_SOURCE_VUPDATE1 + 1];\n\n\t \n\tstruct common_irq_params\n\tdmub_trace_params[1];\n\n\tstruct common_irq_params\n\tdmub_outbox_params[1];\n\n\tspinlock_t irq_handler_list_table_lock;\n\n\tstruct backlight_device *backlight_dev[AMDGPU_DM_MAX_NUM_EDP];\n\n\tconst struct dc_link *backlight_link[AMDGPU_DM_MAX_NUM_EDP];\n\n\tuint8_t num_of_edps;\n\n\tstruct amdgpu_dm_backlight_caps backlight_caps[AMDGPU_DM_MAX_NUM_EDP];\n\n\tstruct mod_freesync *freesync_module;\n\tstruct hdcp_workqueue *hdcp_workqueue;\n\n\t \n\tstruct workqueue_struct *vblank_control_workqueue;\n\n\tstruct drm_atomic_state *cached_state;\n\tstruct dc_state *cached_dc_state;\n\n\tstruct dm_compressor_info compressor;\n\n\tconst struct firmware *fw_dmcu;\n\tuint32_t dmcu_fw_version;\n\t \n\tconst struct gpu_info_soc_bounding_box_v1_0 *soc_bounding_box;\n\n\t \n\tuint32_t active_vblank_irq_count;\n\n#if defined(CONFIG_DRM_AMD_SECURE_DISPLAY)\n\t \n\tstruct secure_display_context *secure_display_ctxs;\n#endif\n\t \n\tstruct hpd_rx_irq_offload_work_queue *hpd_rx_offload_wq;\n\t \n\tstruct amdgpu_encoder mst_encoders[AMDGPU_DM_MAX_CRTC];\n\tbool force_timing_sync;\n\tbool disable_hpd_irq;\n\tbool dmcub_trace_event_en;\n\t \n\tstruct list_head da_list;\n\tstruct completion dmub_aux_transfer_done;\n\tstruct workqueue_struct *delayed_hpd_wq;\n\n\t \n\tu32 brightness[AMDGPU_DM_MAX_NUM_EDP];\n\t \n\tu32 actual_brightness[AMDGPU_DM_MAX_NUM_EDP];\n\n\t \n\tbool aux_hpd_discon_quirk;\n\n\t \n\tstruct mutex dpia_aux_lock;\n};\n\nenum dsc_clock_force_state {\n\tDSC_CLK_FORCE_DEFAULT = 0,\n\tDSC_CLK_FORCE_ENABLE,\n\tDSC_CLK_FORCE_DISABLE,\n};\n\nstruct dsc_preferred_settings {\n\tenum dsc_clock_force_state dsc_force_enable;\n\tuint32_t dsc_num_slices_v;\n\tuint32_t dsc_num_slices_h;\n\tuint32_t dsc_bits_per_pixel;\n\tbool dsc_force_disable_passthrough;\n};\n\nenum mst_progress_status {\n\tMST_STATUS_DEFAULT = 0,\n\tMST_PROBE = BIT(0),\n\tMST_REMOTE_EDID = BIT(1),\n\tMST_ALLOCATE_NEW_PAYLOAD = BIT(2),\n\tMST_CLEAR_ALLOCATED_PAYLOAD = BIT(3),\n};\n\n \nstruct amdgpu_hdmi_vsdb_info {\n\t \n\tunsigned int amd_vsdb_version;\n\n\t \n\tbool freesync_supported;\n\n\t \n\tunsigned int min_refresh_rate_hz;\n\n\t \n\tunsigned int max_refresh_rate_hz;\n\n\t \n\tbool replay_mode;\n};\n\nstruct amdgpu_dm_connector {\n\n\tstruct drm_connector base;\n\tuint32_t connector_id;\n\tint bl_idx;\n\n\t \n\tstruct edid *edid;\n\n\t \n\tstruct amdgpu_hpd hpd;\n\n\t \n\tint num_modes;\n\n\t \n\tstruct dc_sink *dc_sink;\n\tstruct dc_link *dc_link;\n\n\t \n\tstruct dc_sink *dc_em_sink;\n\n\t \n\tstruct drm_dp_mst_topology_mgr mst_mgr;\n\tstruct amdgpu_dm_dp_aux dm_dp_aux;\n\tstruct drm_dp_mst_port *mst_output_port;\n\tstruct amdgpu_dm_connector *mst_root;\n\tstruct drm_dp_aux *dsc_aux;\n\tstruct mutex handle_mst_msg_ready;\n\n\t \n\tstruct amdgpu_i2c_adapter *i2c;\n\n\t \n\t \n\tint min_vfreq;\n\n\t \n\tint max_vfreq ;\n\tint pixel_clock_mhz;\n\n\t \n\tint audio_inst;\n\n\tstruct mutex hpd_lock;\n\n\tbool fake_enable;\n\tbool force_yuv420_output;\n\tstruct dsc_preferred_settings dsc_settings;\n\tunion dp_downstream_port_present mst_downstream_port_present;\n\t \n\tstruct drm_display_mode freesync_vid_base;\n\n\tint psr_skip_count;\n\n\t \n\tuint8_t mst_status;\n\n\t \n\tbool timing_changed;\n\tstruct dc_crtc_timing *timing_requested;\n\n\t \n\tbool pack_sdp_v1_3;\n\tenum adaptive_sync_type as_type;\n\tstruct amdgpu_hdmi_vsdb_info vsdb_info;\n};\n\nstatic inline void amdgpu_dm_set_mst_status(uint8_t *status,\n\t\tuint8_t flags, bool set)\n{\n\tif (set)\n\t\t*status |= flags;\n\telse\n\t\t*status &= ~flags;\n}\n\n#define to_amdgpu_dm_connector(x) container_of(x, struct amdgpu_dm_connector, base)\n\nextern const struct amdgpu_ip_block_version dm_ip_block;\n\nstruct dm_plane_state {\n\tstruct drm_plane_state base;\n\tstruct dc_plane_state *dc_state;\n};\n\nstruct dm_crtc_state {\n\tstruct drm_crtc_state base;\n\tstruct dc_stream_state *stream;\n\n\tbool cm_has_degamma;\n\tbool cm_is_degamma_srgb;\n\n\tbool mpo_requested;\n\n\tint update_type;\n\tint active_planes;\n\n\tint crc_skip_count;\n\n\tbool freesync_vrr_info_changed;\n\n\tbool dsc_force_changed;\n\tbool vrr_supported;\n\tstruct mod_freesync_config freesync_config;\n\tstruct dc_info_packet vrr_infopacket;\n\n\tint abm_level;\n};\n\n#define to_dm_crtc_state(x) container_of(x, struct dm_crtc_state, base)\n\nstruct dm_atomic_state {\n\tstruct drm_private_state base;\n\n\tstruct dc_state *context;\n};\n\n#define to_dm_atomic_state(x) container_of(x, struct dm_atomic_state, base)\n\nstruct dm_connector_state {\n\tstruct drm_connector_state base;\n\n\tenum amdgpu_rmx_type scaling;\n\tuint8_t underscan_vborder;\n\tuint8_t underscan_hborder;\n\tbool underscan_enable;\n\tbool freesync_capable;\n\tbool update_hdcp;\n\tuint8_t abm_level;\n\tint vcpi_slots;\n\tuint64_t pbn;\n};\n\n#define to_dm_connector_state(x)\\\n\tcontainer_of((x), struct dm_connector_state, base)\n\nvoid amdgpu_dm_connector_funcs_reset(struct drm_connector *connector);\nstruct drm_connector_state *\namdgpu_dm_connector_atomic_duplicate_state(struct drm_connector *connector);\nint amdgpu_dm_connector_atomic_set_property(struct drm_connector *connector,\n\t\t\t\t\t    struct drm_connector_state *state,\n\t\t\t\t\t    struct drm_property *property,\n\t\t\t\t\t    uint64_t val);\n\nint amdgpu_dm_connector_atomic_get_property(struct drm_connector *connector,\n\t\t\t\t\t    const struct drm_connector_state *state,\n\t\t\t\t\t    struct drm_property *property,\n\t\t\t\t\t    uint64_t *val);\n\nint amdgpu_dm_get_encoder_crtc_mask(struct amdgpu_device *adev);\n\nvoid amdgpu_dm_connector_init_helper(struct amdgpu_display_manager *dm,\n\t\t\t\t     struct amdgpu_dm_connector *aconnector,\n\t\t\t\t     int connector_type,\n\t\t\t\t     struct dc_link *link,\n\t\t\t\t     int link_index);\n\nenum drm_mode_status amdgpu_dm_connector_mode_valid(struct drm_connector *connector,\n\t\t\t\t   struct drm_display_mode *mode);\n\nvoid dm_restore_drm_connector_state(struct drm_device *dev,\n\t\t\t\t    struct drm_connector *connector);\n\nvoid amdgpu_dm_update_freesync_caps(struct drm_connector *connector,\n\t\t\t\t\tstruct edid *edid);\n\nvoid amdgpu_dm_trigger_timing_sync(struct drm_device *dev);\n\n#define MAX_COLOR_LUT_ENTRIES 4096\n \n#define MAX_COLOR_LEGACY_LUT_ENTRIES 256\n\nvoid amdgpu_dm_init_color_mod(void);\nint amdgpu_dm_verify_lut_sizes(const struct drm_crtc_state *crtc_state);\nint amdgpu_dm_update_crtc_color_mgmt(struct dm_crtc_state *crtc);\nint amdgpu_dm_update_plane_color_mgmt(struct dm_crtc_state *crtc,\n\t\t\t\t      struct dc_plane_state *dc_plane_state);\n\nvoid amdgpu_dm_update_connector_after_detect(\n\t\tstruct amdgpu_dm_connector *aconnector);\n\nextern const struct drm_encoder_helper_funcs amdgpu_dm_encoder_helper_funcs;\n\nint amdgpu_dm_process_dmub_aux_transfer_sync(struct dc_context *ctx, unsigned int link_index,\n\t\t\t\t\tstruct aux_payload *payload, enum aux_return_code_type *operation_result);\n\nint amdgpu_dm_process_dmub_set_config_sync(struct dc_context *ctx, unsigned int link_index,\n\t\t\t\t\tstruct set_config_cmd_payload *payload, enum set_config_status *operation_result);\n\nbool check_seamless_boot_capability(struct amdgpu_device *adev);\n\nstruct dc_stream_state *\n\tcreate_validate_stream_for_sink(struct amdgpu_dm_connector *aconnector,\n\t\t\t\t\tconst struct drm_display_mode *drm_mode,\n\t\t\t\t\tconst struct dm_connector_state *dm_state,\n\t\t\t\t\tconst struct dc_stream_state *old_stream);\n\nint dm_atomic_get_state(struct drm_atomic_state *state,\n\t\t\tstruct dm_atomic_state **dm_state);\n\nstruct amdgpu_dm_connector *\namdgpu_dm_find_first_crtc_matching_connector(struct drm_atomic_state *state,\n\t\t\t\t\t     struct drm_crtc *crtc);\n\nint convert_dc_color_depth_into_bpc(enum dc_color_depth display_color_depth);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}