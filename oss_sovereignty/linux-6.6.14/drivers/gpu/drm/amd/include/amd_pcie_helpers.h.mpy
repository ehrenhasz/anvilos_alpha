{
  "module_name": "amd_pcie_helpers.h",
  "hash_id": "56501b9b9a80029f37b3c6658177a39f260a0819fb0a41e83ed5fc0aff735fad",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/include/amd_pcie_helpers.h",
  "human_readable_source": " \n\n#ifndef __AMD_PCIE_HELPERS_H__\n#define __AMD_PCIE_HELPERS_H__\n\n#include \"amd_pcie.h\"\n\nstatic inline bool is_pcie_gen3_supported(uint32_t pcie_link_speed_cap)\n{\n\tif (pcie_link_speed_cap & CAIL_PCIE_LINK_SPEED_SUPPORT_GEN3)\n\t\treturn true;\n\n\treturn false;\n}\n\nstatic inline bool is_pcie_gen2_supported(uint32_t pcie_link_speed_cap)\n{\n\tif (pcie_link_speed_cap & CAIL_PCIE_LINK_SPEED_SUPPORT_GEN2)\n\t\treturn true;\n\n\treturn false;\n}\n\n \nstatic inline uint16_t get_pcie_gen_support(uint32_t pcie_link_speed_cap,\n\t\t\t\t\t    uint16_t ns_pcie_gen)\n{\n\tuint32_t asic_pcie_link_speed_cap = (pcie_link_speed_cap &\n\t\tCAIL_ASIC_PCIE_LINK_SPEED_SUPPORT_MASK);\n\tuint32_t sys_pcie_link_speed_cap  = (pcie_link_speed_cap &\n\t\tCAIL_PCIE_LINK_SPEED_SUPPORT_MASK);\n\n\tswitch (asic_pcie_link_speed_cap) {\n\tcase CAIL_ASIC_PCIE_LINK_SPEED_SUPPORT_GEN1:\n\t\treturn PP_PCIEGen1;\n\n\tcase CAIL_ASIC_PCIE_LINK_SPEED_SUPPORT_GEN2:\n\t\treturn PP_PCIEGen2;\n\n\tcase CAIL_ASIC_PCIE_LINK_SPEED_SUPPORT_GEN3:\n\t\treturn PP_PCIEGen3;\n\n\tdefault:\n\t\tif (is_pcie_gen3_supported(sys_pcie_link_speed_cap) &&\n\t\t\t(ns_pcie_gen == PP_PCIEGen3)) {\n\t\t\treturn PP_PCIEGen3;\n\t\t} else if (is_pcie_gen2_supported(sys_pcie_link_speed_cap) &&\n\t\t\t((ns_pcie_gen == PP_PCIEGen3) || (ns_pcie_gen == PP_PCIEGen2))) {\n\t\t\treturn PP_PCIEGen2;\n\t\t}\n\t}\n\n\treturn PP_PCIEGen1;\n}\n\nstatic inline uint16_t get_pcie_lane_support(uint32_t pcie_lane_width_cap,\n\t\t\t\t\t     uint16_t ns_pcie_lanes)\n{\n\tint i, j;\n\tuint16_t new_pcie_lanes = ns_pcie_lanes;\n\tuint16_t pcie_lanes[7] = {1, 2, 4, 8, 12, 16, 32};\n\n\tswitch (pcie_lane_width_cap) {\n\tcase 0:\n\t\tpr_err(\"No valid PCIE lane width reported\\n\");\n\t\tbreak;\n\tcase CAIL_PCIE_LINK_WIDTH_SUPPORT_X1:\n\t\tnew_pcie_lanes = 1;\n\t\tbreak;\n\tcase CAIL_PCIE_LINK_WIDTH_SUPPORT_X2:\n\t\tnew_pcie_lanes = 2;\n\t\tbreak;\n\tcase CAIL_PCIE_LINK_WIDTH_SUPPORT_X4:\n\t\tnew_pcie_lanes = 4;\n\t\tbreak;\n\tcase CAIL_PCIE_LINK_WIDTH_SUPPORT_X8:\n\t\tnew_pcie_lanes = 8;\n\t\tbreak;\n\tcase CAIL_PCIE_LINK_WIDTH_SUPPORT_X12:\n\t\tnew_pcie_lanes = 12;\n\t\tbreak;\n\tcase CAIL_PCIE_LINK_WIDTH_SUPPORT_X16:\n\t\tnew_pcie_lanes = 16;\n\t\tbreak;\n\tcase CAIL_PCIE_LINK_WIDTH_SUPPORT_X32:\n\t\tnew_pcie_lanes = 32;\n\t\tbreak;\n\tdefault:\n\t\tfor (i = 0; i < 7; i++) {\n\t\t\tif (ns_pcie_lanes == pcie_lanes[i]) {\n\t\t\t\tif (pcie_lane_width_cap & (0x10000 << i)) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\tfor (j = i - 1; j >= 0; j--) {\n\t\t\t\t\t\tif (pcie_lane_width_cap & (0x10000 << j)) {\n\t\t\t\t\t\t\tnew_pcie_lanes = pcie_lanes[j];\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (j < 0) {\n\t\t\t\t\t\tfor (j = i + 1; j < 7; j++) {\n\t\t\t\t\t\t\tif (pcie_lane_width_cap & (0x10000 << j)) {\n\t\t\t\t\t\t\t\tnew_pcie_lanes = pcie_lanes[j];\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (j > 7)\n\t\t\t\t\t\t\tpr_err(\"Cannot find a valid PCIE lane width!\\n\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t}\n\n\treturn new_pcie_lanes;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}