{
  "module_name": "kgd_kfd_interface.h",
  "hash_id": "322cb4156fbc9661140cc0114dc68e4926f4b561e9339fad3c0d26f68a15a533",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/amd/include/kgd_kfd_interface.h",
  "human_readable_source": " \n\n \n\n#ifndef KGD_KFD_INTERFACE_H_INCLUDED\n#define KGD_KFD_INTERFACE_H_INCLUDED\n\n#include <linux/types.h>\n#include <linux/bitmap.h>\n#include <linux/dma-fence.h>\n#include \"amdgpu_irq.h\"\n#include \"amdgpu_gfx.h\"\n\nstruct pci_dev;\nstruct amdgpu_device;\n\nstruct kfd_dev;\nstruct kgd_mem;\n\nenum kfd_preempt_type {\n\tKFD_PREEMPT_TYPE_WAVEFRONT_DRAIN = 0,\n\tKFD_PREEMPT_TYPE_WAVEFRONT_RESET,\n\tKFD_PREEMPT_TYPE_WAVEFRONT_SAVE\n};\n\nstruct kfd_vm_fault_info {\n\tuint64_t\tpage_addr;\n\tuint32_t\tvmid;\n\tuint32_t\tmc_id;\n\tuint32_t\tstatus;\n\tbool\t\tprot_valid;\n\tbool\t\tprot_read;\n\tbool\t\tprot_write;\n\tbool\t\tprot_exec;\n};\n\nstruct kfd_cu_info {\n\tuint32_t num_shader_engines;\n\tuint32_t num_shader_arrays_per_engine;\n\tuint32_t num_cu_per_sh;\n\tuint32_t cu_active_number;\n\tuint32_t cu_ao_mask;\n\tuint32_t simd_per_cu;\n\tuint32_t max_waves_per_simd;\n\tuint32_t wave_front_size;\n\tuint32_t max_scratch_slots_per_cu;\n\tuint32_t lds_size;\n\tuint32_t cu_bitmap[AMDGPU_MAX_GC_INSTANCES][4][4];\n};\n\n \nstruct kfd_local_mem_info {\n\tuint64_t local_mem_size_private;\n\tuint64_t local_mem_size_public;\n\tuint32_t vram_width;\n\tuint32_t mem_clk_max;\n};\n\nenum kgd_memory_pool {\n\tKGD_POOL_SYSTEM_CACHEABLE = 1,\n\tKGD_POOL_SYSTEM_WRITECOMBINE = 2,\n\tKGD_POOL_FRAMEBUFFER = 3,\n};\n\n \nenum kfd_sched_policy {\n\tKFD_SCHED_POLICY_HWS = 0,\n\tKFD_SCHED_POLICY_HWS_NO_OVERSUBSCRIPTION,\n\tKFD_SCHED_POLICY_NO_HWS\n};\n\nstruct kgd2kfd_shared_resources {\n\t \n\tunsigned int compute_vmid_bitmap;\n\n\t \n\tuint32_t num_pipe_per_mec;\n\n\t \n\tuint32_t num_queue_per_pipe;\n\n\t \n\tDECLARE_BITMAP(cp_queue_bitmap, KGD_MAX_QUEUES);\n\n\t \n\tuint32_t *sdma_doorbell_idx;\n\n\t \n\tuint32_t non_cp_doorbells_start;\n\tuint32_t non_cp_doorbells_end;\n\n\t \n\tphys_addr_t doorbell_physical_address;\n\n\t \n\tsize_t doorbell_aperture_size;\n\n\t \n\tsize_t doorbell_start_offset;\n\n\t \n\tuint64_t gpuvm_size;\n\n\t \n\tint drm_render_minor;\n\n\tbool enable_mes;\n};\n\nstruct tile_config {\n\tuint32_t *tile_config_ptr;\n\tuint32_t *macro_tile_config_ptr;\n\tuint32_t num_tile_configs;\n\tuint32_t num_macro_tile_configs;\n\n\tuint32_t gb_addr_config;\n\tuint32_t num_banks;\n\tuint32_t num_ranks;\n};\n\n#define KFD_MAX_NUM_OF_QUEUES_PER_DEVICE_DEFAULT 4096\n\n \nstruct kfd2kgd_calls {\n\t \n\tvoid (*program_sh_mem_settings)(struct amdgpu_device *adev, uint32_t vmid,\n\t\t\tuint32_t sh_mem_config,\tuint32_t sh_mem_ape1_base,\n\t\t\tuint32_t sh_mem_ape1_limit, uint32_t sh_mem_bases,\n\t\t\tuint32_t inst);\n\n\tint (*set_pasid_vmid_mapping)(struct amdgpu_device *adev, u32 pasid,\n\t\t\t\t\tunsigned int vmid, uint32_t inst);\n\n\tint (*init_interrupts)(struct amdgpu_device *adev, uint32_t pipe_id,\n\t\t\tuint32_t inst);\n\n\tint (*hqd_load)(struct amdgpu_device *adev, void *mqd, uint32_t pipe_id,\n\t\t\tuint32_t queue_id, uint32_t __user *wptr,\n\t\t\tuint32_t wptr_shift, uint32_t wptr_mask,\n\t\t\tstruct mm_struct *mm, uint32_t inst);\n\n\tint (*hiq_mqd_load)(struct amdgpu_device *adev, void *mqd,\n\t\t\t    uint32_t pipe_id, uint32_t queue_id,\n\t\t\t    uint32_t doorbell_off, uint32_t inst);\n\n\tint (*hqd_sdma_load)(struct amdgpu_device *adev, void *mqd,\n\t\t\t     uint32_t __user *wptr, struct mm_struct *mm);\n\n\tint (*hqd_dump)(struct amdgpu_device *adev,\n\t\t\tuint32_t pipe_id, uint32_t queue_id,\n\t\t\tuint32_t (**dump)[2], uint32_t *n_regs, uint32_t inst);\n\n\tint (*hqd_sdma_dump)(struct amdgpu_device *adev,\n\t\t\t     uint32_t engine_id, uint32_t queue_id,\n\t\t\t     uint32_t (**dump)[2], uint32_t *n_regs);\n\n\tbool (*hqd_is_occupied)(struct amdgpu_device *adev,\n\t\t\t\tuint64_t queue_address, uint32_t pipe_id,\n\t\t\t\tuint32_t queue_id, uint32_t inst);\n\n\tint (*hqd_destroy)(struct amdgpu_device *adev, void *mqd,\n\t\t\t\tenum kfd_preempt_type reset_type,\n\t\t\t\tunsigned int timeout, uint32_t pipe_id,\n\t\t\t\tuint32_t queue_id, uint32_t inst);\n\n\tbool (*hqd_sdma_is_occupied)(struct amdgpu_device *adev, void *mqd);\n\n\tint (*hqd_sdma_destroy)(struct amdgpu_device *adev, void *mqd,\n\t\t\t\tunsigned int timeout);\n\n\tint (*wave_control_execute)(struct amdgpu_device *adev,\n\t\t\t\t\tuint32_t gfx_index_val,\n\t\t\t\t\tuint32_t sq_cmd, uint32_t inst);\n\tbool (*get_atc_vmid_pasid_mapping_info)(struct amdgpu_device *adev,\n\t\t\t\t\tuint8_t vmid,\n\t\t\t\t\tuint16_t *p_pasid);\n\n\t \n\tvoid (*set_scratch_backing_va)(struct amdgpu_device *adev,\n\t\t\t\tuint64_t va, uint32_t vmid);\n\n\tvoid (*set_vm_context_page_table_base)(struct amdgpu_device *adev,\n\t\t\tuint32_t vmid, uint64_t page_table_base);\n\tuint32_t (*read_vmid_from_vmfault_reg)(struct amdgpu_device *adev);\n\n\tuint32_t (*enable_debug_trap)(struct amdgpu_device *adev,\n\t\t\t\t\tbool restore_dbg_registers,\n\t\t\t\t\tuint32_t vmid);\n\tuint32_t (*disable_debug_trap)(struct amdgpu_device *adev,\n\t\t\t\t\tbool keep_trap_enabled,\n\t\t\t\t\tuint32_t vmid);\n\tint (*validate_trap_override_request)(struct amdgpu_device *adev,\n\t\t\t\t\tuint32_t trap_override,\n\t\t\t\t\tuint32_t *trap_mask_supported);\n\tuint32_t (*set_wave_launch_trap_override)(struct amdgpu_device *adev,\n\t\t\t\t\t     uint32_t vmid,\n\t\t\t\t\t     uint32_t trap_override,\n\t\t\t\t\t     uint32_t trap_mask_bits,\n\t\t\t\t\t     uint32_t trap_mask_request,\n\t\t\t\t\t     uint32_t *trap_mask_prev,\n\t\t\t\t\t     uint32_t kfd_dbg_trap_cntl_prev);\n\tuint32_t (*set_wave_launch_mode)(struct amdgpu_device *adev,\n\t\t\t\t\tuint8_t wave_launch_mode,\n\t\t\t\t\tuint32_t vmid);\n\tuint32_t (*set_address_watch)(struct amdgpu_device *adev,\n\t\t\t\t\tuint64_t watch_address,\n\t\t\t\t\tuint32_t watch_address_mask,\n\t\t\t\t\tuint32_t watch_id,\n\t\t\t\t\tuint32_t watch_mode,\n\t\t\t\t\tuint32_t debug_vmid,\n\t\t\t\t\tuint32_t inst);\n\tuint32_t (*clear_address_watch)(struct amdgpu_device *adev,\n\t\t\tuint32_t watch_id);\n\tvoid (*get_iq_wait_times)(struct amdgpu_device *adev,\n\t\t\tuint32_t *wait_times,\n\t\t\tuint32_t inst);\n\tvoid (*build_grace_period_packet_info)(struct amdgpu_device *adev,\n\t\t\tuint32_t wait_times,\n\t\t\tuint32_t grace_period,\n\t\t\tuint32_t *reg_offset,\n\t\t\tuint32_t *reg_data);\n\tvoid (*get_cu_occupancy)(struct amdgpu_device *adev, int pasid,\n\t\t\tint *wave_cnt, int *max_waves_per_cu, uint32_t inst);\n\tvoid (*program_trap_handler_settings)(struct amdgpu_device *adev,\n\t\t\tuint32_t vmid, uint64_t tba_addr, uint64_t tma_addr,\n\t\t\tuint32_t inst);\n};\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}