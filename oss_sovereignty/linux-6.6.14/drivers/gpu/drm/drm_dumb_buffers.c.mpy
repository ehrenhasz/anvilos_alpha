{
  "module_name": "drm_dumb_buffers.c",
  "hash_id": "6b0406ae5c7c8bea0133c4a35548c9036e96fd10cc8af5123d4e8e62086ff3ff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/drm_dumb_buffers.c",
  "human_readable_source": " \n\n#include <drm/drm_device.h>\n#include <drm/drm_drv.h>\n#include <drm/drm_gem.h>\n#include <drm/drm_mode.h>\n\n#include \"drm_crtc_internal.h\"\n#include \"drm_internal.h\"\n\n \n\nint drm_mode_create_dumb(struct drm_device *dev,\n\t\t\t struct drm_mode_create_dumb *args,\n\t\t\t struct drm_file *file_priv)\n{\n\tu32 cpp, stride, size;\n\n\tif (!dev->driver->dumb_create)\n\t\treturn -ENOSYS;\n\tif (!args->width || !args->height || !args->bpp)\n\t\treturn -EINVAL;\n\n\t \n\tif (args->bpp > U32_MAX - 8)\n\t\treturn -EINVAL;\n\tcpp = DIV_ROUND_UP(args->bpp, 8);\n\tif (cpp > U32_MAX / args->width)\n\t\treturn -EINVAL;\n\tstride = cpp * args->width;\n\tif (args->height > U32_MAX / stride)\n\t\treturn -EINVAL;\n\n\t \n\tsize = args->height * stride;\n\tif (PAGE_ALIGN(size) == 0)\n\t\treturn -EINVAL;\n\n\t \n\targs->handle = 0;\n\targs->pitch = 0;\n\targs->size = 0;\n\n\treturn dev->driver->dumb_create(file_priv, dev, args);\n}\n\nint drm_mode_create_dumb_ioctl(struct drm_device *dev,\n\t\t\t       void *data, struct drm_file *file_priv)\n{\n\treturn drm_mode_create_dumb(dev, data, file_priv);\n}\n\n \nint drm_mode_mmap_dumb_ioctl(struct drm_device *dev,\n\t\t\t     void *data, struct drm_file *file_priv)\n{\n\tstruct drm_mode_map_dumb *args = data;\n\n\tif (!dev->driver->dumb_create)\n\t\treturn -ENOSYS;\n\n\tif (dev->driver->dumb_map_offset)\n\t\treturn dev->driver->dumb_map_offset(file_priv, dev,\n\t\t\t\t\t\t    args->handle,\n\t\t\t\t\t\t    &args->offset);\n\telse\n\t\treturn drm_gem_dumb_map_offset(file_priv, dev, args->handle,\n\t\t\t\t\t       &args->offset);\n}\n\nint drm_mode_destroy_dumb(struct drm_device *dev, u32 handle,\n\t\t\t  struct drm_file *file_priv)\n{\n\tif (!dev->driver->dumb_create)\n\t\treturn -ENOSYS;\n\n\treturn drm_gem_handle_delete(file_priv, handle);\n}\n\nint drm_mode_destroy_dumb_ioctl(struct drm_device *dev,\n\t\t\t\tvoid *data, struct drm_file *file_priv)\n{\n\tstruct drm_mode_destroy_dumb *args = data;\n\n\treturn drm_mode_destroy_dumb(dev, args->handle, file_priv);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}