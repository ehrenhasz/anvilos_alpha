{
  "module_name": "hdmi_pll_8960.c",
  "hash_id": "0523cbb90db9ef6456788e354b26c7098312c10d0a837574f188664c30b945ed",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/msm/hdmi/hdmi_pll_8960.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/delay.h>\n\n#include \"hdmi.h\"\n\nstruct hdmi_pll_8960 {\n\tstruct platform_device *pdev;\n\tstruct clk_hw clk_hw;\n\tvoid __iomem *mmio;\n\n\tunsigned long pixclk;\n};\n\n#define hw_clk_to_pll(x) container_of(x, struct hdmi_pll_8960, clk_hw)\n\n \n\nstruct pll_rate {\n\tunsigned long rate;\n\tint num_reg;\n\tstruct {\n\t\tu32 val;\n\t\tu32 reg;\n\t} conf[32];\n};\n\n \nstatic const struct pll_rate freqtbl[] = {\n\t{ 154000000, 14, {\n\t\t{ 0x08, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x20, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0xf9, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x03, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG3   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x0d, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x4d, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0x5e, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0x42, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t\t}\n\t},\n\t \n\t{ 148500000, 27, {\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_CHRG_PUMP_CFG },\n\t\t{ 0x01, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x2c, REG_HDMI_8960_PHY_PLL_IDAC_ADJ_CFG  },\n\t\t{ 0x06, REG_HDMI_8960_PHY_PLL_I_VI_KVCO_CFG },\n\t\t{ 0x0a, REG_HDMI_8960_PHY_PLL_PWRDN_B       },\n\t\t{ 0x76, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x01, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0x4c, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0xc0, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t{ 0x9a, REG_HDMI_8960_PHY_PLL_SSC_CFG0      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG1      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG2      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG3      },\n\t\t{ 0x10, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG0  },\n\t\t{ 0x1a, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG1  },\n\t\t{ 0x0d, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG2  },\n\t\t{ 0xe6, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG3   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG6   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG7   },\n\t\t\t}\n\t},\n\t{ 108000000, 13, {\n\t\t{ 0x08, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x21, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0xf9, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x1c, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x49, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x49, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t\t}\n\t},\n\t \n\t{ 74250000, 8, {\n\t\t{ 0x0a, REG_HDMI_8960_PHY_PLL_PWRDN_B       },\n\t\t{ 0x12, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x01, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x76, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0xe6, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t\t}\n\t},\n\t{ 74176000, 14, {\n\t\t{ 0x18, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x20, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0xf9, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0xe5, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG3   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x0c, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x4c, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0x7d, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0xbc, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t\t}\n\t},\n\t{ 65000000, 14, {\n\t\t{ 0x18, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x20, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0xf9, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x8a, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG3   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x0b, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x4b, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0x7b, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0x09, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t\t}\n\t},\n\t \n\t{ 27030000, 18, {\n\t\t{ 0x0a, REG_HDMI_8960_PHY_PLL_PWRDN_B       },\n\t\t{ 0x38, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_CHRG_PUMP_CFG },\n\t\t{ 0x20, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0xff, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x4e, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0xd7, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0x03, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t{ 0x2a, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x03, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG3   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG6   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG7   },\n\t\t\t}\n\t},\n\t \n\t{ 27000000, 27, {\n\t\t{ 0x32, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_CHRG_PUMP_CFG },\n\t\t{ 0x01, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x2c, REG_HDMI_8960_PHY_PLL_IDAC_ADJ_CFG  },\n\t\t{ 0x06, REG_HDMI_8960_PHY_PLL_I_VI_KVCO_CFG },\n\t\t{ 0x0a, REG_HDMI_8960_PHY_PLL_PWRDN_B       },\n\t\t{ 0x7b, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x01, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0x4c, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0xc0, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t{ 0x9a, REG_HDMI_8960_PHY_PLL_SSC_CFG0      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG1      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG2      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG3      },\n\t\t{ 0x10, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG0  },\n\t\t{ 0x1a, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG1  },\n\t\t{ 0x0d, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG2  },\n\t\t{ 0x2a, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x03, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG3   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG6   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG7   },\n\t\t\t}\n\t},\n\t \n\t{ 25200000, 27, {\n\t\t{ 0x32, REG_HDMI_8960_PHY_PLL_REFCLK_CFG    },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_CHRG_PUMP_CFG },\n\t\t{ 0x01, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG0 },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_LOOP_FLT_CFG1 },\n\t\t{ 0x2c, REG_HDMI_8960_PHY_PLL_IDAC_ADJ_CFG  },\n\t\t{ 0x06, REG_HDMI_8960_PHY_PLL_I_VI_KVCO_CFG },\n\t\t{ 0x0a, REG_HDMI_8960_PHY_PLL_PWRDN_B       },\n\t\t{ 0x77, REG_HDMI_8960_PHY_PLL_SDM_CFG0      },\n\t\t{ 0x4c, REG_HDMI_8960_PHY_PLL_SDM_CFG1      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG2      },\n\t\t{ 0xc0, REG_HDMI_8960_PHY_PLL_SDM_CFG3      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SDM_CFG4      },\n\t\t{ 0x9a, REG_HDMI_8960_PHY_PLL_SSC_CFG0      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG1      },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_SSC_CFG2      },\n\t\t{ 0x20, REG_HDMI_8960_PHY_PLL_SSC_CFG3      },\n\t\t{ 0x10, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG0  },\n\t\t{ 0x1a, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG1  },\n\t\t{ 0x0d, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG2  },\n\t\t{ 0xf4, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG0   },\n\t\t{ 0x02, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG1   },\n\t\t{ 0x3b, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG2   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG3   },\n\t\t{ 0x86, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG4   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG5   },\n\t\t{ 0x33, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG6   },\n\t\t{ 0x00, REG_HDMI_8960_PHY_PLL_VCOCAL_CFG7   },\n\t\t\t}\n\t},\n};\n\nstatic inline void pll_write(struct hdmi_pll_8960 *pll, u32 reg, u32 data)\n{\n\tmsm_writel(data, pll->mmio + reg);\n}\n\nstatic inline u32 pll_read(struct hdmi_pll_8960 *pll, u32 reg)\n{\n\treturn msm_readl(pll->mmio + reg);\n}\n\nstatic inline struct hdmi_phy *pll_get_phy(struct hdmi_pll_8960 *pll)\n{\n\treturn platform_get_drvdata(pll->pdev);\n}\n\nstatic int hdmi_pll_enable(struct clk_hw *hw)\n{\n\tstruct hdmi_pll_8960 *pll = hw_clk_to_pll(hw);\n\tstruct hdmi_phy *phy = pll_get_phy(pll);\n\tint timeout_count, pll_lock_retry = 10;\n\tunsigned int val;\n\n\tDBG(\"\");\n\n\t \n\tpll_write(pll, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG2, 0x8d);\n\tpll_write(pll, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG0, 0x10);\n\tpll_write(pll, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG1, 0x1a);\n\n\t \n\tudelay(10);\n\n\t \n\tpll_write(pll, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG2, 0x0d);\n\n\tval = hdmi_phy_read(phy, REG_HDMI_8960_PHY_REG12);\n\tval |= HDMI_8960_PHY_REG12_SW_RESET;\n\t \n\thdmi_phy_write(phy, REG_HDMI_8960_PHY_REG12, val);\n\tval &= ~HDMI_8960_PHY_REG12_SW_RESET;\n\t \n\tudelay(10);\n\t \n\thdmi_phy_write(phy, REG_HDMI_8960_PHY_REG12, val);\n\thdmi_phy_write(phy, REG_HDMI_8960_PHY_REG2,  0x3f);\n\n\tval = hdmi_phy_read(phy, REG_HDMI_8960_PHY_REG12);\n\tval |= HDMI_8960_PHY_REG12_PWRDN_B;\n\thdmi_phy_write(phy, REG_HDMI_8960_PHY_REG12, val);\n\t \n\tmb();\n\tudelay(10);\n\n\tval = pll_read(pll, REG_HDMI_8960_PHY_PLL_PWRDN_B);\n\tval |= HDMI_8960_PHY_PLL_PWRDN_B_PLL_PWRDN_B;\n\tval &= ~HDMI_8960_PHY_PLL_PWRDN_B_PD_PLL;\n\tpll_write(pll, REG_HDMI_8960_PHY_PLL_PWRDN_B, val);\n\thdmi_phy_write(phy, REG_HDMI_8960_PHY_REG2, 0x80);\n\n\ttimeout_count = 1000;\n\twhile (--pll_lock_retry > 0) {\n\t\t \n\t\tval = pll_read(pll, REG_HDMI_8960_PHY_PLL_STATUS0);\n\t\tif (val & HDMI_8960_PHY_PLL_STATUS0_PLL_LOCK)\n\t\t\tbreak;\n\n\t\tudelay(1);\n\n\t\tif (--timeout_count > 0)\n\t\t\tcontinue;\n\n\t\t \n\t\tpll_write(pll, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG2, 0x8d);\n\t\tudelay(10);\n\t\tpll_write(pll, REG_HDMI_8960_PHY_PLL_LOCKDET_CFG2, 0x0d);\n\n\t\t \n\t\tudelay(350);\n\n\t\ttimeout_count = 1000;\n\t}\n\n\treturn 0;\n}\n\nstatic void hdmi_pll_disable(struct clk_hw *hw)\n{\n\tstruct hdmi_pll_8960 *pll = hw_clk_to_pll(hw);\n\tstruct hdmi_phy *phy = pll_get_phy(pll);\n\tunsigned int val;\n\n\tDBG(\"\");\n\n\tval = hdmi_phy_read(phy, REG_HDMI_8960_PHY_REG12);\n\tval &= ~HDMI_8960_PHY_REG12_PWRDN_B;\n\thdmi_phy_write(phy, REG_HDMI_8960_PHY_REG12, val);\n\n\tval = pll_read(pll, REG_HDMI_8960_PHY_PLL_PWRDN_B);\n\tval |= HDMI_8960_PHY_REG12_SW_RESET;\n\tval &= ~HDMI_8960_PHY_REG12_PWRDN_B;\n\tpll_write(pll, REG_HDMI_8960_PHY_PLL_PWRDN_B, val);\n\t \n\tmb();\n}\n\nstatic const struct pll_rate *find_rate(unsigned long rate)\n{\n\tint i;\n\n\tfor (i = 1; i < ARRAY_SIZE(freqtbl); i++)\n\t\tif (rate > freqtbl[i].rate)\n\t\t\treturn &freqtbl[i - 1];\n\n\treturn &freqtbl[i - 1];\n}\n\nstatic unsigned long hdmi_pll_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t  unsigned long parent_rate)\n{\n\tstruct hdmi_pll_8960 *pll = hw_clk_to_pll(hw);\n\n\treturn pll->pixclk;\n}\n\nstatic long hdmi_pll_round_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\tunsigned long *parent_rate)\n{\n\tconst struct pll_rate *pll_rate = find_rate(rate);\n\n\treturn pll_rate->rate;\n}\n\nstatic int hdmi_pll_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t     unsigned long parent_rate)\n{\n\tstruct hdmi_pll_8960 *pll = hw_clk_to_pll(hw);\n\tconst struct pll_rate *pll_rate = find_rate(rate);\n\tint i;\n\n\tDBG(\"rate=%lu\", rate);\n\n\tfor (i = 0; i < pll_rate->num_reg; i++)\n\t\tpll_write(pll, pll_rate->conf[i].reg, pll_rate->conf[i].val);\n\n\tpll->pixclk = rate;\n\n\treturn 0;\n}\n\nstatic const struct clk_ops hdmi_pll_ops = {\n\t.enable = hdmi_pll_enable,\n\t.disable = hdmi_pll_disable,\n\t.recalc_rate = hdmi_pll_recalc_rate,\n\t.round_rate = hdmi_pll_round_rate,\n\t.set_rate = hdmi_pll_set_rate,\n};\n\nstatic const struct clk_parent_data hdmi_pll_parents[] = {\n\t{ .fw_name = \"pxo\", .name = \"pxo_board\" },\n};\n\nstatic struct clk_init_data pll_init = {\n\t.name = \"hdmi_pll\",\n\t.ops = &hdmi_pll_ops,\n\t.parent_data = hdmi_pll_parents,\n\t.num_parents = ARRAY_SIZE(hdmi_pll_parents),\n\t.flags = CLK_IGNORE_UNUSED,\n};\n\nint msm_hdmi_pll_8960_init(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct hdmi_pll_8960 *pll;\n\tint i, ret;\n\n\t \n\tfor (i = 0; i < (ARRAY_SIZE(freqtbl) - 1); i++)\n\t\tif (WARN_ON(freqtbl[i].rate < freqtbl[i + 1].rate))\n\t\t\treturn -EINVAL;\n\n\tpll = devm_kzalloc(dev, sizeof(*pll), GFP_KERNEL);\n\tif (!pll)\n\t\treturn -ENOMEM;\n\n\tpll->mmio = msm_ioremap(pdev, \"hdmi_pll\");\n\tif (IS_ERR(pll->mmio)) {\n\t\tDRM_DEV_ERROR(dev, \"failed to map pll base\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tpll->pdev = pdev;\n\tpll->clk_hw.init = &pll_init;\n\n\tret = devm_clk_hw_register(dev, &pll->clk_hw);\n\tif (ret < 0) {\n\t\tDRM_DEV_ERROR(dev, \"failed to register pll clock\\n\");\n\t\treturn ret;\n\t}\n\n\tret = devm_of_clk_add_hw_provider(dev, of_clk_hw_simple_get, &pll->clk_hw);\n\tif (ret) {\n\t\tDRM_DEV_ERROR(dev, \"%s: failed to register clk provider: %d\\n\", __func__, ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}