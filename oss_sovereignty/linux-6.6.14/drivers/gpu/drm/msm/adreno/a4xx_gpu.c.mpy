{
  "module_name": "a4xx_gpu.c",
  "hash_id": "06205c3fbf0411ad52160878804235ef69ea1820b54e98bb0377082d14f11a1c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/msm/adreno/a4xx_gpu.c",
  "human_readable_source": "\n \n#include \"a4xx_gpu.h\"\n\n#define A4XX_INT0_MASK \\\n\t(A4XX_INT0_RBBM_AHB_ERROR |        \\\n\t A4XX_INT0_RBBM_ATB_BUS_OVERFLOW | \\\n\t A4XX_INT0_CP_T0_PACKET_IN_IB |    \\\n\t A4XX_INT0_CP_OPCODE_ERROR |       \\\n\t A4XX_INT0_CP_RESERVED_BIT_ERROR | \\\n\t A4XX_INT0_CP_HW_FAULT |           \\\n\t A4XX_INT0_CP_IB1_INT |            \\\n\t A4XX_INT0_CP_IB2_INT |            \\\n\t A4XX_INT0_CP_RB_INT |             \\\n\t A4XX_INT0_CP_REG_PROTECT_FAULT |  \\\n\t A4XX_INT0_CP_AHB_ERROR_HALT |     \\\n\t A4XX_INT0_CACHE_FLUSH_TS |        \\\n\t A4XX_INT0_UCHE_OOB_ACCESS)\n\nextern bool hang_debug;\nstatic void a4xx_dump(struct msm_gpu *gpu);\nstatic bool a4xx_idle(struct msm_gpu *gpu);\n\nstatic void a4xx_submit(struct msm_gpu *gpu, struct msm_gem_submit *submit)\n{\n\tstruct msm_ringbuffer *ring = submit->ring;\n\tunsigned int i;\n\n\tfor (i = 0; i < submit->nr_cmds; i++) {\n\t\tswitch (submit->cmd[i].type) {\n\t\tcase MSM_SUBMIT_CMD_IB_TARGET_BUF:\n\t\t\t \n\t\t\tbreak;\n\t\tcase MSM_SUBMIT_CMD_CTX_RESTORE_BUF:\n\t\t\t \n\t\t\tif (gpu->cur_ctx_seqno == submit->queue->ctx->seqno)\n\t\t\t\tbreak;\n\t\t\tfallthrough;\n\t\tcase MSM_SUBMIT_CMD_BUF:\n\t\t\tOUT_PKT3(ring, CP_INDIRECT_BUFFER_PFE, 2);\n\t\t\tOUT_RING(ring, lower_32_bits(submit->cmd[i].iova));\n\t\t\tOUT_RING(ring, submit->cmd[i].size);\n\t\t\tOUT_PKT2(ring);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tOUT_PKT0(ring, REG_AXXX_CP_SCRATCH_REG2, 1);\n\tOUT_RING(ring, submit->seqno);\n\n\t \n\tOUT_PKT3(ring, CP_EVENT_WRITE, 1);\n\tOUT_RING(ring, HLSQ_FLUSH);\n\n\t \n\tOUT_PKT3(ring, CP_WAIT_FOR_IDLE, 1);\n\tOUT_RING(ring, 0x00000000);\n\n\t \n\tOUT_PKT3(ring, CP_EVENT_WRITE, 3);\n\tOUT_RING(ring, CACHE_FLUSH_TS | CP_EVENT_WRITE_0_IRQ);\n\tOUT_RING(ring, rbmemptr(ring, fence));\n\tOUT_RING(ring, submit->seqno);\n\n\tadreno_flush(gpu, ring, REG_A4XX_CP_RB_WPTR);\n}\n\n \nstatic void a4xx_enable_hwcg(struct msm_gpu *gpu)\n{\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tunsigned int i;\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_TP(i), 0x02222202);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL2_TP(i), 0x00002222);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_TP(i), 0x0E739CE7);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_TP(i), 0x00111111);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_SP(i), 0x22222222);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL2_SP(i), 0x00222222);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_SP(i), 0x00000104);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_SP(i), 0x00000081);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_UCHE, 0x22222222);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL2_UCHE, 0x02222222);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL3_UCHE, 0x00000000);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL4_UCHE, 0x00000000);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_UCHE, 0x00004444);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_UCHE, 0x00001112);\n\tfor (i = 0; i < 4; i++)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_RB(i), 0x22222222);\n\n\t \n\tfor (i = 0; i < 4; i++) {\n\t\tif (adreno_is_a420(adreno_gpu)) {\n\t\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL2_RB(i),\n\t\t\t\t\t0x00002020);\n\t\t} else {\n\t\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL2_RB(i),\n\t\t\t\t\t0x00022020);\n\t\t}\n\t}\n\n\t \n\tif (!adreno_is_a405(adreno_gpu)) {\n\t\tfor (i = 0; i < 4; i++) {\n\t\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_MARB_CCU(i),\n\t\t\t\t\t0x00000922);\n\t\t}\n\n\t\tfor (i = 0; i < 4; i++) {\n\t\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_RB_MARB_CCU(i),\n\t\t\t\t\t0x00000000);\n\t\t}\n\n\t\tfor (i = 0; i < 4; i++) {\n\t\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_RB_MARB_CCU_L1(i),\n\t\t\t\t\t0x00000001);\n\t\t}\n\t}\n\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_MODE_GPC, 0x02222222);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_GPC, 0x04100104);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_GPC, 0x00022222);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_COM_DCOM, 0x00000022);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_COM_DCOM, 0x0000010F);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_COM_DCOM, 0x00000022);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_TSE_RAS_RBBM, 0x00222222);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_TSE_RAS_RBBM, 0x00004104);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_TSE_RAS_RBBM, 0x00000222);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL_HLSQ , 0x00000000);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_HYST_HLSQ, 0x00000000);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_HLSQ, 0x00220000);\n\t \n\tif (adreno_is_a430(adreno_gpu) && adreno_patchid(adreno_gpu) < 2)\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL, 0);\n\telse\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL, 0xAAAAAAAA);\n\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_CTL2, 0);\n}\n\n\nstatic bool a4xx_me_init(struct msm_gpu *gpu)\n{\n\tstruct msm_ringbuffer *ring = gpu->rb[0];\n\n\tOUT_PKT3(ring, CP_ME_INIT, 17);\n\tOUT_RING(ring, 0x000003f7);\n\tOUT_RING(ring, 0x00000000);\n\tOUT_RING(ring, 0x00000000);\n\tOUT_RING(ring, 0x00000000);\n\tOUT_RING(ring, 0x00000080);\n\tOUT_RING(ring, 0x00000100);\n\tOUT_RING(ring, 0x00000180);\n\tOUT_RING(ring, 0x00006600);\n\tOUT_RING(ring, 0x00000150);\n\tOUT_RING(ring, 0x0000014e);\n\tOUT_RING(ring, 0x00000154);\n\tOUT_RING(ring, 0x00000001);\n\tOUT_RING(ring, 0x00000000);\n\tOUT_RING(ring, 0x00000000);\n\tOUT_RING(ring, 0x00000000);\n\tOUT_RING(ring, 0x00000000);\n\tOUT_RING(ring, 0x00000000);\n\n\tadreno_flush(gpu, ring, REG_A4XX_CP_RB_WPTR);\n\treturn a4xx_idle(gpu);\n}\n\nstatic int a4xx_hw_init(struct msm_gpu *gpu)\n{\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tstruct a4xx_gpu *a4xx_gpu = to_a4xx_gpu(adreno_gpu);\n\tuint32_t *ptr, len;\n\tint i, ret;\n\n\tif (adreno_is_a405(adreno_gpu)) {\n\t\tgpu_write(gpu, REG_A4XX_VBIF_ROUND_ROBIN_QOS_ARB, 0x00000003);\n\t} else if (adreno_is_a420(adreno_gpu)) {\n\t\tgpu_write(gpu, REG_A4XX_VBIF_ABIT_SORT, 0x0001001F);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_ABIT_SORT_CONF, 0x000000A4);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_GATE_OFF_WRREQ_EN, 0x00000001);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_RD_LIM_CONF0, 0x18181818);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_RD_LIM_CONF1, 0x00000018);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_WR_LIM_CONF0, 0x18181818);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_WR_LIM_CONF1, 0x00000018);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_ROUND_ROBIN_QOS_ARB, 0x00000003);\n\t} else if (adreno_is_a430(adreno_gpu)) {\n\t\tgpu_write(gpu, REG_A4XX_VBIF_GATE_OFF_WRREQ_EN, 0x00000001);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_RD_LIM_CONF0, 0x18181818);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_RD_LIM_CONF1, 0x00000018);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_WR_LIM_CONF0, 0x18181818);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_IN_WR_LIM_CONF1, 0x00000018);\n\t\tgpu_write(gpu, REG_A4XX_VBIF_ROUND_ROBIN_QOS_ARB, 0x00000003);\n\t} else {\n\t\tBUG();\n\t}\n\n\t \n\tgpu_write(gpu, REG_A4XX_RBBM_GPU_BUSY_MASKED, 0xffffffff);\n\n\t \n\tgpu_write(gpu, REG_A4XX_RBBM_SP_HYST_CNT, 0x10);\n\tgpu_write(gpu, REG_A4XX_RBBM_WAIT_IDLE_CLOCKS_CTL, 0x10);\n\n\tif (adreno_is_a430(adreno_gpu)) {\n\t\tgpu_write(gpu, REG_A4XX_RBBM_WAIT_IDLE_CLOCKS_CTL2, 0x30);\n\t}\n\n\t  \n\tgpu_write(gpu, REG_A4XX_RBBM_AHB_CTL0, 0x00000001);\n\n\t \n\tgpu_write(gpu, REG_A4XX_RBBM_AHB_CTL1, 0xa6ffffff);\n\n\t \n\tgpu_write(gpu, REG_A4XX_RBBM_RBBM_CTL, 0x00000030);\n\n\t \n\tgpu_write(gpu, REG_A4XX_RBBM_INTERFACE_HANG_INT_CTL,\n\t\t\t(1 << 30) | 0xFFFF);\n\n\tgpu_write(gpu, REG_A4XX_RB_GMEM_BASE_ADDR,\n\t\t\t(unsigned int)(a4xx_gpu->ocmem.base >> 14));\n\n\t \n\tgpu_write(gpu, REG_A4XX_RBBM_PERFCTR_CTL, 0x01);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PERFCTR_CP_SEL_0, CP_ALWAYS_COUNT);\n\n\tif (adreno_is_a430(adreno_gpu))\n\t\tgpu_write(gpu, REG_A4XX_UCHE_CACHE_WAYS_VFD, 0x07);\n\n\t \n\tgpu_write(gpu, REG_A4XX_UCHE_TRAP_BASE_LO, 0xffff0000);\n\tgpu_write(gpu, REG_A4XX_UCHE_TRAP_BASE_HI, 0xffff0000);\n\n\tgpu_write(gpu, REG_A4XX_CP_DEBUG, (1 << 25) |\n\t\t\t(adreno_is_a420(adreno_gpu) ? (1 << 29) : 0));\n\n\t \n\t \n\tif (!adreno_is_a420(adreno_gpu)) {\n\t\tgpu_write(gpu, REG_A4XX_RBBM_SP_REGFILE_SLEEP_CNTL_0,\n\t\t\t0x00000441);\n\t\tgpu_write(gpu, REG_A4XX_RBBM_SP_REGFILE_SLEEP_CNTL_1,\n\t\t\t0x00000441);\n\t}\n\n\ta4xx_enable_hwcg(gpu);\n\n\t \n\tif (adreno_is_a420(adreno_gpu)) {\n\t\tunsigned int val;\n\t\tval = gpu_read(gpu, REG_A4XX_RBBM_CLOCK_DELAY_HLSQ);\n\t\tval &= ~A4XX_CGC_HLSQ_EARLY_CYC__MASK;\n\t\tval |= 2 << A4XX_CGC_HLSQ_EARLY_CYC__SHIFT;\n\t\tgpu_write(gpu, REG_A4XX_RBBM_CLOCK_DELAY_HLSQ, val);\n\t}\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PROTECT_CTRL, 0x00000007);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(0), 0x62000010);\n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(1), 0x63000020);\n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(2), 0x64000040);\n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(3), 0x65000080);\n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(4), 0x66000100);\n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(5), 0x64000200);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(6), 0x67000800);\n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(7), 0x64001600);\n\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(8), 0x60003300);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(9), 0x60003800);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(10), 0x61003980);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_PROTECT(11), 0x6e010000);\n\n\tgpu_write(gpu, REG_A4XX_RBBM_INT_0_MASK, A4XX_INT0_MASK);\n\n\tret = adreno_hw_init(gpu);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_RB_CNTL,\n\t\tMSM_GPU_RB_CNTL_DEFAULT | AXXX_CP_RB_CNTL_NO_UPDATE);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_RB_BASE, lower_32_bits(gpu->rb[0]->iova));\n\n\t \n\tptr = (uint32_t *)(adreno_gpu->fw[ADRENO_FW_PM4]->data);\n\tlen = adreno_gpu->fw[ADRENO_FW_PM4]->size / 4;\n\tDBG(\"loading PM4 ucode version: %u\", ptr[0]);\n\tgpu_write(gpu, REG_A4XX_CP_ME_RAM_WADDR, 0);\n\tfor (i = 1; i < len; i++)\n\t\tgpu_write(gpu, REG_A4XX_CP_ME_RAM_DATA, ptr[i]);\n\n\t \n\tptr = (uint32_t *)(adreno_gpu->fw[ADRENO_FW_PFP]->data);\n\tlen = adreno_gpu->fw[ADRENO_FW_PFP]->size / 4;\n\tDBG(\"loading PFP ucode version: %u\", ptr[0]);\n\n\tgpu_write(gpu, REG_A4XX_CP_PFP_UCODE_ADDR, 0);\n\tfor (i = 1; i < len; i++)\n\t\tgpu_write(gpu, REG_A4XX_CP_PFP_UCODE_DATA, ptr[i]);\n\n\t \n\tgpu_write(gpu, REG_A4XX_CP_ME_CNTL, 0);\n\n\treturn a4xx_me_init(gpu) ? 0 : -EINVAL;\n}\n\nstatic void a4xx_recover(struct msm_gpu *gpu)\n{\n\tint i;\n\n\tadreno_dump_info(gpu);\n\n\tfor (i = 0; i < 8; i++) {\n\t\tprintk(\"CP_SCRATCH_REG%d: %u\\n\", i,\n\t\t\tgpu_read(gpu, REG_AXXX_CP_SCRATCH_REG0 + i));\n\t}\n\n\t \n\tif (hang_debug)\n\t\ta4xx_dump(gpu);\n\n\tgpu_write(gpu, REG_A4XX_RBBM_SW_RESET_CMD, 1);\n\tgpu_read(gpu, REG_A4XX_RBBM_SW_RESET_CMD);\n\tgpu_write(gpu, REG_A4XX_RBBM_SW_RESET_CMD, 0);\n\tadreno_recover(gpu);\n}\n\nstatic void a4xx_destroy(struct msm_gpu *gpu)\n{\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tstruct a4xx_gpu *a4xx_gpu = to_a4xx_gpu(adreno_gpu);\n\n\tDBG(\"%s\", gpu->name);\n\n\tadreno_gpu_cleanup(adreno_gpu);\n\n\tadreno_gpu_ocmem_cleanup(&a4xx_gpu->ocmem);\n\n\tkfree(a4xx_gpu);\n}\n\nstatic bool a4xx_idle(struct msm_gpu *gpu)\n{\n\t \n\tif (!adreno_idle(gpu, gpu->rb[0]))\n\t\treturn false;\n\n\t \n\tif (spin_until(!(gpu_read(gpu, REG_A4XX_RBBM_STATUS) &\n\t\t\t\t\tA4XX_RBBM_STATUS_GPU_BUSY))) {\n\t\tDRM_ERROR(\"%s: timeout waiting for GPU to idle!\\n\", gpu->name);\n\t\t \n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nstatic irqreturn_t a4xx_irq(struct msm_gpu *gpu)\n{\n\tuint32_t status;\n\n\tstatus = gpu_read(gpu, REG_A4XX_RBBM_INT_0_STATUS);\n\tDBG(\"%s: Int status %08x\", gpu->name, status);\n\n\tif (status & A4XX_INT0_CP_REG_PROTECT_FAULT) {\n\t\tuint32_t reg = gpu_read(gpu, REG_A4XX_CP_PROTECT_STATUS);\n\t\tprintk(\"CP | Protected mode error| %s | addr=%x\\n\",\n\t\t\treg & (1 << 24) ? \"WRITE\" : \"READ\",\n\t\t\t(reg & 0xFFFFF) >> 2);\n\t}\n\n\tgpu_write(gpu, REG_A4XX_RBBM_INT_CLEAR_CMD, status);\n\n\tmsm_gpu_retire(gpu);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic const unsigned int a4xx_registers[] = {\n\t \n\t0x0000, 0x0002, 0x0004, 0x0021, 0x0023, 0x0024, 0x0026, 0x0026,\n\t0x0028, 0x002B, 0x002E, 0x0034, 0x0037, 0x0044, 0x0047, 0x0066,\n\t0x0068, 0x0095, 0x009C, 0x0170, 0x0174, 0x01AF,\n\t \n\t0x0200, 0x0233, 0x0240, 0x0250, 0x04C0, 0x04DD, 0x0500, 0x050B,\n\t0x0578, 0x058F,\n\t \n\t0x0C00, 0x0C03, 0x0C08, 0x0C41, 0x0C50, 0x0C51,\n\t \n\t0x0C80, 0x0C81, 0x0C88, 0x0C8F,\n\t \n\t0x0CC0, 0x0CC0, 0x0CC4, 0x0CD2,\n\t \n\t0x0D00, 0x0D0C, 0x0D10, 0x0D17, 0x0D20, 0x0D23,\n\t \n\t0x0E40, 0x0E4A,\n\t \n\t0x0E60, 0x0E61, 0x0E63, 0x0E68,\n\t \n\t0x0E80, 0x0E84, 0x0E88, 0x0E95,\n\t \n\t0x1000, 0x1000, 0x1002, 0x1002, 0x1004, 0x1004, 0x1008, 0x100A,\n\t0x100C, 0x100D, 0x100F, 0x1010, 0x1012, 0x1016, 0x1024, 0x1024,\n\t0x1027, 0x1027, 0x1100, 0x1100, 0x1102, 0x1102, 0x1104, 0x1104,\n\t0x1110, 0x1110, 0x1112, 0x1116, 0x1124, 0x1124, 0x1300, 0x1300,\n\t0x1380, 0x1380,\n\t \n\t0x2000, 0x2004, 0x2008, 0x2067, 0x2070, 0x2078, 0x207B, 0x216E,\n\t \n\t0x21C0, 0x21C6, 0x21D0, 0x21D0, 0x21D9, 0x21D9, 0x21E5, 0x21E7,\n\t \n\t0x2200, 0x2204, 0x2208, 0x22A9,\n\t \n\t0x2400, 0x2404, 0x2408, 0x2467, 0x2470, 0x2478, 0x247B, 0x256E,\n\t \n\t0x25C0, 0x25C6, 0x25D0, 0x25D0, 0x25D9, 0x25D9, 0x25E5, 0x25E7,\n\t \n\t0x2600, 0x2604, 0x2608, 0x26A9,\n\t \n\t0x2C00, 0x2C01, 0x2C10, 0x2C10, 0x2C12, 0x2C16, 0x2C1D, 0x2C20,\n\t0x2C28, 0x2C28, 0x2C30, 0x2C30, 0x2C32, 0x2C36, 0x2C40, 0x2C40,\n\t0x2C50, 0x2C50, 0x2C52, 0x2C56, 0x2C80, 0x2C80, 0x2C94, 0x2C95,\n\t \n\t0x3000, 0x3007, 0x300C, 0x3014, 0x3018, 0x301D, 0x3020, 0x3022,\n\t0x3024, 0x3026, 0x3028, 0x302A, 0x302C, 0x302D, 0x3030, 0x3031,\n\t0x3034, 0x3036, 0x3038, 0x3038, 0x303C, 0x303D, 0x3040, 0x3040,\n\t0x3049, 0x3049, 0x3058, 0x3058, 0x305B, 0x3061, 0x3064, 0x3068,\n\t0x306C, 0x306D, 0x3080, 0x3088, 0x308B, 0x308C, 0x3090, 0x3094,\n\t0x3098, 0x3098, 0x309C, 0x309C, 0x30C0, 0x30C0, 0x30C8, 0x30C8,\n\t0x30D0, 0x30D0, 0x30D8, 0x30D8, 0x30E0, 0x30E0, 0x3100, 0x3100,\n\t0x3108, 0x3108, 0x3110, 0x3110, 0x3118, 0x3118, 0x3120, 0x3120,\n\t0x3124, 0x3125, 0x3129, 0x3129, 0x3131, 0x3131, 0x330C, 0x330C,\n\t0x3310, 0x3310, 0x3400, 0x3401, 0x3410, 0x3410, 0x3412, 0x3416,\n\t0x341D, 0x3420, 0x3428, 0x3428, 0x3430, 0x3430, 0x3432, 0x3436,\n\t0x3440, 0x3440, 0x3450, 0x3450, 0x3452, 0x3456, 0x3480, 0x3480,\n\t0x3494, 0x3495, 0x4000, 0x4000, 0x4002, 0x4002, 0x4004, 0x4004,\n\t0x4008, 0x400A, 0x400C, 0x400D, 0x400F, 0x4012, 0x4014, 0x4016,\n\t0x401D, 0x401D, 0x4020, 0x4027, 0x4060, 0x4062, 0x4200, 0x4200,\n\t0x4300, 0x4300, 0x4400, 0x4400, 0x4500, 0x4500, 0x4800, 0x4802,\n\t0x480F, 0x480F, 0x4811, 0x4811, 0x4813, 0x4813, 0x4815, 0x4816,\n\t0x482B, 0x482B, 0x4857, 0x4857, 0x4883, 0x4883, 0x48AF, 0x48AF,\n\t0x48C5, 0x48C5, 0x48E5, 0x48E5, 0x4905, 0x4905, 0x4925, 0x4925,\n\t0x4945, 0x4945, 0x4950, 0x4950, 0x495B, 0x495B, 0x4980, 0x498E,\n\t0x4B00, 0x4B00, 0x4C00, 0x4C00, 0x4D00, 0x4D00, 0x4E00, 0x4E00,\n\t0x4E80, 0x4E80, 0x4F00, 0x4F00, 0x4F08, 0x4F08, 0x4F10, 0x4F10,\n\t0x4F18, 0x4F18, 0x4F20, 0x4F20, 0x4F30, 0x4F30, 0x4F60, 0x4F60,\n\t0x4F80, 0x4F81, 0x4F88, 0x4F89, 0x4FEE, 0x4FEE, 0x4FF3, 0x4FF3,\n\t0x6000, 0x6001, 0x6008, 0x600F, 0x6014, 0x6016, 0x6018, 0x601B,\n\t0x61FD, 0x61FD, 0x623C, 0x623C, 0x6380, 0x6380, 0x63A0, 0x63A0,\n\t0x63C0, 0x63C1, 0x63C8, 0x63C9, 0x63D0, 0x63D4, 0x63D6, 0x63D6,\n\t0x63EE, 0x63EE, 0x6400, 0x6401, 0x6408, 0x640F, 0x6414, 0x6416,\n\t0x6418, 0x641B, 0x65FD, 0x65FD, 0x663C, 0x663C, 0x6780, 0x6780,\n\t0x67A0, 0x67A0, 0x67C0, 0x67C1, 0x67C8, 0x67C9, 0x67D0, 0x67D4,\n\t0x67D6, 0x67D6, 0x67EE, 0x67EE, 0x6800, 0x6801, 0x6808, 0x680F,\n\t0x6814, 0x6816, 0x6818, 0x681B, 0x69FD, 0x69FD, 0x6A3C, 0x6A3C,\n\t0x6B80, 0x6B80, 0x6BA0, 0x6BA0, 0x6BC0, 0x6BC1, 0x6BC8, 0x6BC9,\n\t0x6BD0, 0x6BD4, 0x6BD6, 0x6BD6, 0x6BEE, 0x6BEE,\n\t~0  \n};\n\nstatic const unsigned int a405_registers[] = {\n\t \n\t0x0000, 0x0002, 0x0004, 0x0021, 0x0023, 0x0024, 0x0026, 0x0026,\n\t0x0028, 0x002B, 0x002E, 0x0034, 0x0037, 0x0044, 0x0047, 0x0066,\n\t0x0068, 0x0095, 0x009C, 0x0170, 0x0174, 0x01AF,\n\t \n\t0x0200, 0x0233, 0x0240, 0x0250, 0x04C0, 0x04DD, 0x0500, 0x050B,\n\t0x0578, 0x058F,\n\t \n\t0x0C00, 0x0C03, 0x0C08, 0x0C41, 0x0C50, 0x0C51,\n\t \n\t0x0C80, 0x0C81, 0x0C88, 0x0C8F,\n\t \n\t0x0CC0, 0x0CC0, 0x0CC4, 0x0CD2,\n\t \n\t0x0D00, 0x0D0C, 0x0D10, 0x0D17, 0x0D20, 0x0D23,\n\t \n\t0x0E40, 0x0E4A,\n\t \n\t0x0E60, 0x0E61, 0x0E63, 0x0E68,\n\t \n\t0x0E80, 0x0E84, 0x0E88, 0x0E95,\n\t \n\t0x2000, 0x2004, 0x2008, 0x2067, 0x2070, 0x2078, 0x207B, 0x216E,\n\t \n\t0x21C0, 0x21C6, 0x21D0, 0x21D0, 0x21D9, 0x21D9, 0x21E5, 0x21E7,\n\t \n\t0x2200, 0x2204, 0x2208, 0x22A9,\n\t \n\t0x2400, 0x2404, 0x2408, 0x2467, 0x2470, 0x2478, 0x247B, 0x256E,\n\t \n\t0x25C0, 0x25C6, 0x25D0, 0x25D0, 0x25D9, 0x25D9, 0x25E5, 0x25E7,\n\t \n\t0x2600, 0x2604, 0x2608, 0x26A9,\n\t \n\t0x3000, 0x3007, 0x302C, 0x302C, 0x3030, 0x3030, 0x3034, 0x3036,\n\t0x3038, 0x3038, 0x303C, 0x303D, 0x3040, 0x3040, 0x3049, 0x3049,\n\t0x3058, 0x3058, 0x305B, 0x3061, 0x3064, 0x3068, 0x306C, 0x306D,\n\t0x3080, 0x3088, 0x308B, 0x308C, 0x3090, 0x3094, 0x3098, 0x3098,\n\t0x309C, 0x309C, 0x30C0, 0x30C0, 0x30C8, 0x30C8, 0x30D0, 0x30D0,\n\t0x30D8, 0x30D8, 0x30E0, 0x30E0, 0x3100, 0x3100, 0x3108, 0x3108,\n\t0x3110, 0x3110, 0x3118, 0x3118, 0x3120, 0x3120, 0x3124, 0x3125,\n\t0x3129, 0x3129, 0x340C, 0x340C, 0x3410, 0x3410,\n\t~0  \n};\n\nstatic struct msm_gpu_state *a4xx_gpu_state_get(struct msm_gpu *gpu)\n{\n\tstruct msm_gpu_state *state = kzalloc(sizeof(*state), GFP_KERNEL);\n\n\tif (!state)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tadreno_gpu_state_get(gpu, state);\n\n\tstate->rbbm_status = gpu_read(gpu, REG_A4XX_RBBM_STATUS);\n\n\treturn state;\n}\n\nstatic void a4xx_dump(struct msm_gpu *gpu)\n{\n\tprintk(\"status:   %08x\\n\",\n\t\t\tgpu_read(gpu, REG_A4XX_RBBM_STATUS));\n\tadreno_dump(gpu);\n}\n\nstatic int a4xx_pm_resume(struct msm_gpu *gpu) {\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tint ret;\n\n\tret = msm_gpu_pm_resume(gpu);\n\tif (ret)\n\t\treturn ret;\n\n\tif (adreno_is_a430(adreno_gpu)) {\n\t\tunsigned int reg;\n\t\t \n\t\tgpu_write(gpu, REG_A4XX_RBBM_POWER_CNTL_IP, 0x778000);\n\t\tdo {\n\t\t\tudelay(5);\n\t\t\treg = gpu_read(gpu, REG_A4XX_RBBM_POWER_STATUS);\n\t\t} while (!(reg & A4XX_RBBM_POWER_CNTL_IP_SP_TP_PWR_ON));\n\t}\n\treturn 0;\n}\n\nstatic int a4xx_pm_suspend(struct msm_gpu *gpu) {\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tint ret;\n\n\tret = msm_gpu_pm_suspend(gpu);\n\tif (ret)\n\t\treturn ret;\n\n\tif (adreno_is_a430(adreno_gpu)) {\n\t\t \n\t\tgpu_write(gpu, REG_A4XX_RBBM_POWER_CNTL_IP, 0x778001);\n\t}\n\treturn 0;\n}\n\nstatic int a4xx_get_timestamp(struct msm_gpu *gpu, uint64_t *value)\n{\n\t*value = gpu_read64(gpu, REG_A4XX_RBBM_PERFCTR_CP_0_LO);\n\n\treturn 0;\n}\n\nstatic u64 a4xx_gpu_busy(struct msm_gpu *gpu, unsigned long *out_sample_rate)\n{\n\tu64 busy_cycles;\n\n\tbusy_cycles = gpu_read64(gpu, REG_A4XX_RBBM_PERFCTR_RBBM_1_LO);\n\t*out_sample_rate = clk_get_rate(gpu->core_clk);\n\n\treturn busy_cycles;\n}\n\nstatic u32 a4xx_get_rptr(struct msm_gpu *gpu, struct msm_ringbuffer *ring)\n{\n\tring->memptrs->rptr = gpu_read(gpu, REG_A4XX_CP_RB_RPTR);\n\treturn ring->memptrs->rptr;\n}\n\nstatic const struct adreno_gpu_funcs funcs = {\n\t.base = {\n\t\t.get_param = adreno_get_param,\n\t\t.set_param = adreno_set_param,\n\t\t.hw_init = a4xx_hw_init,\n\t\t.pm_suspend = a4xx_pm_suspend,\n\t\t.pm_resume = a4xx_pm_resume,\n\t\t.recover = a4xx_recover,\n\t\t.submit = a4xx_submit,\n\t\t.active_ring = adreno_active_ring,\n\t\t.irq = a4xx_irq,\n\t\t.destroy = a4xx_destroy,\n#if defined(CONFIG_DEBUG_FS) || defined(CONFIG_DEV_COREDUMP)\n\t\t.show = adreno_show,\n#endif\n\t\t.gpu_busy = a4xx_gpu_busy,\n\t\t.gpu_state_get = a4xx_gpu_state_get,\n\t\t.gpu_state_put = adreno_gpu_state_put,\n\t\t.create_address_space = adreno_create_address_space,\n\t\t.get_rptr = a4xx_get_rptr,\n\t},\n\t.get_timestamp = a4xx_get_timestamp,\n};\n\nstruct msm_gpu *a4xx_gpu_init(struct drm_device *dev)\n{\n\tstruct a4xx_gpu *a4xx_gpu = NULL;\n\tstruct adreno_gpu *adreno_gpu;\n\tstruct msm_gpu *gpu;\n\tstruct msm_drm_private *priv = dev->dev_private;\n\tstruct platform_device *pdev = priv->gpu_pdev;\n\tstruct icc_path *ocmem_icc_path;\n\tstruct icc_path *icc_path;\n\tint ret;\n\n\tif (!pdev) {\n\t\tDRM_DEV_ERROR(dev->dev, \"no a4xx device\\n\");\n\t\tret = -ENXIO;\n\t\tgoto fail;\n\t}\n\n\ta4xx_gpu = kzalloc(sizeof(*a4xx_gpu), GFP_KERNEL);\n\tif (!a4xx_gpu) {\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tadreno_gpu = &a4xx_gpu->base;\n\tgpu = &adreno_gpu->base;\n\n\tgpu->perfcntrs = NULL;\n\tgpu->num_perfcntrs = 0;\n\n\tret = adreno_gpu_init(dev, pdev, adreno_gpu, &funcs, 1);\n\tif (ret)\n\t\tgoto fail;\n\n\tadreno_gpu->registers = adreno_is_a405(adreno_gpu) ? a405_registers :\n\t\t\t\t\t\t\t     a4xx_registers;\n\n\t \n\tret = adreno_gpu_ocmem_init(dev->dev, adreno_gpu,\n\t\t\t\t    &a4xx_gpu->ocmem);\n\tif (ret)\n\t\tgoto fail;\n\n\tif (!gpu->aspace) {\n\t\t \n\t\tDRM_DEV_ERROR(dev->dev, \"No memory protection without IOMMU\\n\");\n\t\tif (!allow_vram_carveout) {\n\t\t\tret = -ENXIO;\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\ticc_path = devm_of_icc_get(&pdev->dev, \"gfx-mem\");\n\tif (IS_ERR(icc_path)) {\n\t\tret = PTR_ERR(icc_path);\n\t\tgoto fail;\n\t}\n\n\tocmem_icc_path = devm_of_icc_get(&pdev->dev, \"ocmem\");\n\tif (IS_ERR(ocmem_icc_path)) {\n\t\tret = PTR_ERR(ocmem_icc_path);\n\t\t \n\t\tif (ret != -ENODATA)\n\t\t\tgoto fail;\n\t\tocmem_icc_path = NULL;\n\t}\n\n\t \n\ticc_set_bw(icc_path, 0, Bps_to_icc(gpu->fast_rate) * 8);\n\ticc_set_bw(ocmem_icc_path, 0, Bps_to_icc(gpu->fast_rate) * 8);\n\n\treturn gpu;\n\nfail:\n\tif (a4xx_gpu)\n\t\ta4xx_destroy(&a4xx_gpu->base.base);\n\n\treturn ERR_PTR(ret);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}