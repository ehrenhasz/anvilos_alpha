{
  "module_name": "adreno_device.c",
  "hash_id": "783c583c33c83319a8ef58845682584d434398edc60af10e7fab6b34fec16e52",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/msm/adreno/adreno_device.c",
  "human_readable_source": "\n \n\n#include \"adreno_gpu.h\"\n\nbool hang_debug = false;\nMODULE_PARM_DESC(hang_debug, \"Dump registers when hang is detected (can be slow!)\");\nmodule_param_named(hang_debug, hang_debug, bool, 0600);\n\nbool snapshot_debugbus = false;\nMODULE_PARM_DESC(snapshot_debugbus, \"Include debugbus sections in GPU devcoredump (if not fused off)\");\nmodule_param_named(snapshot_debugbus, snapshot_debugbus, bool, 0600);\n\nbool allow_vram_carveout = false;\nMODULE_PARM_DESC(allow_vram_carveout, \"Allow using VRAM Carveout, in place of IOMMU\");\nmodule_param_named(allow_vram_carveout, allow_vram_carveout, bool, 0600);\n\nstatic const struct adreno_info gpulist[] = {\n\t{\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x02000000),\n\t\t.family = ADRENO_2XX_GEN1,\n\t\t.revn  = 200,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"yamato_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"yamato_pfp.fw\",\n\t\t},\n\t\t.gmem  = SZ_256K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a2xx_gpu_init,\n\t}, {  \n\t\t.chip_ids = ADRENO_CHIP_IDS(0x02000001),\n\t\t.family = ADRENO_2XX_GEN1,\n\t\t.revn  = 201,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"yamato_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"yamato_pfp.fw\",\n\t\t},\n\t\t.gmem  = SZ_128K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a2xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x02020000),\n\t\t.family = ADRENO_2XX_GEN2,\n\t\t.revn  = 220,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"leia_pm4_470.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"leia_pfp_470.fw\",\n\t\t},\n\t\t.gmem  = SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a2xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(\n\t\t\t0x03000512,\n\t\t\t0x03000520\n\t\t),\n\t\t.family = ADRENO_3XX,\n\t\t.revn  = 305,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a300_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a300_pfp.fw\",\n\t\t},\n\t\t.gmem  = SZ_256K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a3xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x03000600),\n\t\t.family = ADRENO_3XX,\n\t\t.revn  = 307,         \n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a300_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a300_pfp.fw\",\n\t\t},\n\t\t.gmem  = SZ_128K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a3xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(\n\t\t\t0x03020000,\n\t\t\t0x03020001,\n\t\t\t0x03020002\n\t\t),\n\t\t.family = ADRENO_3XX,\n\t\t.revn  = 320,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a300_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a300_pfp.fw\",\n\t\t},\n\t\t.gmem  = SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a3xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(\n\t\t\t0x03030000,\n\t\t\t0x03030001,\n\t\t\t0x03030002\n\t\t),\n\t\t.family = ADRENO_3XX,\n\t\t.revn  = 330,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a330_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a330_pfp.fw\",\n\t\t},\n\t\t.gmem  = SZ_1M,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a3xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x04000500),\n\t\t.family = ADRENO_4XX,\n\t\t.revn  = 405,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a420_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a420_pfp.fw\",\n\t\t},\n\t\t.gmem  = SZ_256K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a4xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x04020000),\n\t\t.family = ADRENO_4XX,\n\t\t.revn  = 420,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a420_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a420_pfp.fw\",\n\t\t},\n\t\t.gmem  = (SZ_1M + SZ_512K),\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a4xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x04030002),\n\t\t.family = ADRENO_4XX,\n\t\t.revn  = 430,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a420_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a420_pfp.fw\",\n\t\t},\n\t\t.gmem  = (SZ_1M + SZ_512K),\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init  = a4xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x05000600),\n\t\t.family = ADRENO_5XX,\n\t\t.revn = 506,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a530_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a530_pfp.fw\",\n\t\t},\n\t\t.gmem = (SZ_128K + SZ_8K),\n\t\t \n\t\t.inactive_period = 250,\n\t\t.quirks = ADRENO_QUIRK_TWO_PASS_USE_WFI |\n\t\t\t  ADRENO_QUIRK_LMLOADKILL_DISABLE,\n\t\t.init = a5xx_gpu_init,\n\t\t.zapfw = \"a506_zap.mdt\",\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x05000800),\n\t\t.family = ADRENO_5XX,\n\t\t.revn = 508,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a530_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a530_pfp.fw\",\n\t\t},\n\t\t.gmem = (SZ_128K + SZ_8K),\n\t\t \n\t\t.inactive_period = 250,\n\t\t.quirks = ADRENO_QUIRK_LMLOADKILL_DISABLE,\n\t\t.init = a5xx_gpu_init,\n\t\t.zapfw = \"a508_zap.mdt\",\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x05000900),\n\t\t.family = ADRENO_5XX,\n\t\t.revn = 509,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a530_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a530_pfp.fw\",\n\t\t},\n\t\t.gmem = (SZ_256K + SZ_16K),\n\t\t \n\t\t.inactive_period = 250,\n\t\t.quirks = ADRENO_QUIRK_LMLOADKILL_DISABLE,\n\t\t.init = a5xx_gpu_init,\n\t\t \n\t\t.zapfw = \"a512_zap.mdt\",\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x05010000),\n\t\t.family = ADRENO_5XX,\n\t\t.revn = 510,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a530_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a530_pfp.fw\",\n\t\t},\n\t\t.gmem = SZ_256K,\n\t\t \n\t\t.inactive_period = 250,\n\t\t.init = a5xx_gpu_init,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x05010200),\n\t\t.family = ADRENO_5XX,\n\t\t.revn = 512,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a530_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a530_pfp.fw\",\n\t\t},\n\t\t.gmem = (SZ_256K + SZ_16K),\n\t\t \n\t\t.inactive_period = 250,\n\t\t.quirks = ADRENO_QUIRK_LMLOADKILL_DISABLE,\n\t\t.init = a5xx_gpu_init,\n\t\t.zapfw = \"a512_zap.mdt\",\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(\n\t\t\t0x05030002,\n\t\t\t0x05030004\n\t\t),\n\t\t.family = ADRENO_5XX,\n\t\t.revn = 530,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a530_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a530_pfp.fw\",\n\t\t\t[ADRENO_FW_GPMU] = \"a530v3_gpmu.fw2\",\n\t\t},\n\t\t.gmem = SZ_1M,\n\t\t \n\t\t.inactive_period = 250,\n\t\t.quirks = ADRENO_QUIRK_TWO_PASS_USE_WFI |\n\t\t\tADRENO_QUIRK_FAULT_DETECT_MASK,\n\t\t.init = a5xx_gpu_init,\n\t\t.zapfw = \"a530_zap.mdt\",\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x05040001),\n\t\t.family = ADRENO_5XX,\n\t\t.revn = 540,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_PM4] = \"a530_pm4.fw\",\n\t\t\t[ADRENO_FW_PFP] = \"a530_pfp.fw\",\n\t\t\t[ADRENO_FW_GPMU] = \"a540_gpmu.fw2\",\n\t\t},\n\t\t.gmem = SZ_1M,\n\t\t \n\t\t.inactive_period = 250,\n\t\t.quirks = ADRENO_QUIRK_LMLOADKILL_DISABLE,\n\t\t.init = a5xx_gpu_init,\n\t\t.zapfw = \"a540_zap.mdt\",\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06010000),\n\t\t.family = ADRENO_6XX_GEN1,\n\t\t.revn = 610,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t},\n\t\t.gmem = (SZ_128K + SZ_4K),\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a610_zap.mdt\",\n\t\t.hwcg = a612_hwcg,\n\t\t \n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0,   0 },\n\t\t\t{ 206, 1 },\n\t\t\t{ 200, 2 },\n\t\t\t{ 157, 3 },\n\t\t\t{ 127, 4 },\n\t\t),\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06010800),\n\t\t.family = ADRENO_6XX_GEN1,\n\t\t.revn = 618,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a630_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT,\n\t\t.init = a6xx_gpu_init,\n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0,   0 },\n\t\t\t{ 169, 1 },\n\t\t\t{ 174, 2 },\n\t\t),\n\t}, {\n\t\t.machine = \"qcom,sm4350\",\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06010900),\n\t\t.family = ADRENO_6XX_GEN1,\n\t\t.revn = 619,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a619_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a615_zap.mdt\",\n\t\t.hwcg = a615_hwcg,\n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0,   0 },\n\t\t\t{ 138, 1 },\n\t\t\t{ 92,  2 },\n\t\t),\n\t}, {\n\t\t.machine = \"qcom,sm6375\",\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06010901),\n\t\t.family = ADRENO_6XX_GEN1,\n\t\t.revn = 619,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a619_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a615_zap.mdt\",\n\t\t.hwcg = a615_hwcg,\n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0,   0 },\n\t\t\t{ 190, 1 },\n\t\t\t{ 177, 2 },\n\t\t),\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06010900),\n\t\t.family = ADRENO_6XX_GEN1,\n\t\t.revn = 619,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a619_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a615_zap.mdt\",\n\t\t.hwcg = a615_hwcg,\n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0,   0 },\n\t\t\t{ 120, 4 },\n\t\t\t{ 138, 3 },\n\t\t\t{ 169, 2 },\n\t\t\t{ 180, 1 },\n\t\t),\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(\n\t\t\t0x06030001,\n\t\t\t0x06030002\n\t\t),\n\t\t.family = ADRENO_6XX_GEN1,\n\t\t.revn = 630,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a630_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_1M,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a630_zap.mdt\",\n\t\t.hwcg = a630_hwcg,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06040001),\n\t\t.family = ADRENO_6XX_GEN2,\n\t\t.revn = 640,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a640_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_1M,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a640_zap.mdt\",\n\t\t.hwcg = a640_hwcg,\n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0, 0 },\n\t\t\t{ 1, 1 },\n\t\t),\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06050002),\n\t\t.family = ADRENO_6XX_GEN3,\n\t\t.revn = 650,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a650_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a650_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_1M + SZ_128K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT |\n\t\t\tADRENO_QUIRK_HAS_HW_APRIV,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a650_zap.mdt\",\n\t\t.hwcg = a650_hwcg,\n\t\t.address_space_size = SZ_16G,\n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0, 0 },\n\t\t\t{ 1, 1 },\n\t\t\t{ 2, 3 },  \n\t\t\t{ 3, 2 },\n\t\t),\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06060001),\n\t\t.family = ADRENO_6XX_GEN4,\n\t\t.revn = 660,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a660_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a660_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_1M + SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT |\n\t\t\tADRENO_QUIRK_HAS_HW_APRIV,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a660_zap.mdt\",\n\t\t.hwcg = a660_hwcg,\n\t\t.address_space_size = SZ_16G,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06030500),\n\t\t.family = ADRENO_6XX_GEN4,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a660_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a660_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_512K,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT |\n\t\t\tADRENO_QUIRK_HAS_HW_APRIV,\n\t\t.init = a6xx_gpu_init,\n\t\t.hwcg = a660_hwcg,\n\t\t.address_space_size = SZ_16G,\n\t\t.speedbins = ADRENO_SPEEDBINS(\n\t\t\t{ 0,   0 },\n\t\t\t{ 117, 0 },\n\t\t\t{ 190, 1 },\n\t\t),\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06080001),\n\t\t.family = ADRENO_6XX_GEN2,\n\t\t.revn = 680,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a630_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a640_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_2M,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a640_zap.mdt\",\n\t\t.hwcg = a640_hwcg,\n\t}, {\n\t\t.chip_ids = ADRENO_CHIP_IDS(0x06090000),\n\t\t.family = ADRENO_6XX_GEN4,\n\t\t.fw = {\n\t\t\t[ADRENO_FW_SQE] = \"a660_sqe.fw\",\n\t\t\t[ADRENO_FW_GMU] = \"a660_gmu.bin\",\n\t\t},\n\t\t.gmem = SZ_4M,\n\t\t.inactive_period = DRM_MSM_INACTIVE_PERIOD,\n\t\t.quirks = ADRENO_QUIRK_HAS_CACHED_COHERENT |\n\t\t\tADRENO_QUIRK_HAS_HW_APRIV,\n\t\t.init = a6xx_gpu_init,\n\t\t.zapfw = \"a690_zap.mdt\",\n\t\t.hwcg = a690_hwcg,\n\t\t.address_space_size = SZ_16G,\n\t},\n};\n\nMODULE_FIRMWARE(\"qcom/a300_pm4.fw\");\nMODULE_FIRMWARE(\"qcom/a300_pfp.fw\");\nMODULE_FIRMWARE(\"qcom/a330_pm4.fw\");\nMODULE_FIRMWARE(\"qcom/a330_pfp.fw\");\nMODULE_FIRMWARE(\"qcom/a420_pm4.fw\");\nMODULE_FIRMWARE(\"qcom/a420_pfp.fw\");\nMODULE_FIRMWARE(\"qcom/a530_pm4.fw\");\nMODULE_FIRMWARE(\"qcom/a530_pfp.fw\");\nMODULE_FIRMWARE(\"qcom/a530v3_gpmu.fw2\");\nMODULE_FIRMWARE(\"qcom/a530_zap.mdt\");\nMODULE_FIRMWARE(\"qcom/a530_zap.b00\");\nMODULE_FIRMWARE(\"qcom/a530_zap.b01\");\nMODULE_FIRMWARE(\"qcom/a530_zap.b02\");\nMODULE_FIRMWARE(\"qcom/a540_gpmu.fw2\");\nMODULE_FIRMWARE(\"qcom/a619_gmu.bin\");\nMODULE_FIRMWARE(\"qcom/a630_sqe.fw\");\nMODULE_FIRMWARE(\"qcom/a630_gmu.bin\");\nMODULE_FIRMWARE(\"qcom/a630_zap.mbn\");\nMODULE_FIRMWARE(\"qcom/a640_gmu.bin\");\nMODULE_FIRMWARE(\"qcom/a650_gmu.bin\");\nMODULE_FIRMWARE(\"qcom/a650_sqe.fw\");\nMODULE_FIRMWARE(\"qcom/a660_gmu.bin\");\nMODULE_FIRMWARE(\"qcom/a660_sqe.fw\");\nMODULE_FIRMWARE(\"qcom/leia_pfp_470.fw\");\nMODULE_FIRMWARE(\"qcom/leia_pm4_470.fw\");\nMODULE_FIRMWARE(\"qcom/yamato_pfp.fw\");\nMODULE_FIRMWARE(\"qcom/yamato_pm4.fw\");\n\nstatic const struct adreno_info *adreno_info(uint32_t chip_id)\n{\n\t \n\tfor (int i = 0; i < ARRAY_SIZE(gpulist); i++) {\n\t\tconst struct adreno_info *info = &gpulist[i];\n\t\tif (info->machine && !of_machine_is_compatible(info->machine))\n\t\t\tcontinue;\n\t\tfor (int j = 0; info->chip_ids[j]; j++)\n\t\t\tif (info->chip_ids[j] == chip_id)\n\t\t\t\treturn info;\n\t}\n\n\treturn NULL;\n}\n\nstruct msm_gpu *adreno_load_gpu(struct drm_device *dev)\n{\n\tstruct msm_drm_private *priv = dev->dev_private;\n\tstruct platform_device *pdev = priv->gpu_pdev;\n\tstruct msm_gpu *gpu = NULL;\n\tstruct adreno_gpu *adreno_gpu;\n\tint ret;\n\n\tif (pdev)\n\t\tgpu = dev_to_gpu(&pdev->dev);\n\n\tif (!gpu) {\n\t\tdev_err_once(dev->dev, \"no GPU device was found\\n\");\n\t\treturn NULL;\n\t}\n\n\tadreno_gpu = to_adreno_gpu(gpu);\n\n\t \n\n\tret = adreno_load_fw(adreno_gpu);\n\tif (ret)\n\t\treturn NULL;\n\n\tif (gpu->funcs->ucode_load) {\n\t\tret = gpu->funcs->ucode_load(gpu);\n\t\tif (ret)\n\t\t\treturn NULL;\n\t}\n\n\t \n\tpm_runtime_enable(&pdev->dev);\n\n\tret = pm_runtime_get_sync(&pdev->dev);\n\tif (ret < 0) {\n\t\tpm_runtime_put_noidle(&pdev->dev);\n\t\tDRM_DEV_ERROR(dev->dev, \"Couldn't power up the GPU: %d\\n\", ret);\n\t\tgoto err_disable_rpm;\n\t}\n\n\tmutex_lock(&gpu->lock);\n\tret = msm_gpu_hw_init(gpu);\n\tmutex_unlock(&gpu->lock);\n\tif (ret) {\n\t\tDRM_DEV_ERROR(dev->dev, \"gpu hw init failed: %d\\n\", ret);\n\t\tgoto err_put_rpm;\n\t}\n\n\tpm_runtime_put_autosuspend(&pdev->dev);\n\n#ifdef CONFIG_DEBUG_FS\n\tif (gpu->funcs->debugfs_init) {\n\t\tgpu->funcs->debugfs_init(gpu, dev->primary);\n\t\tgpu->funcs->debugfs_init(gpu, dev->render);\n\t}\n#endif\n\n\treturn gpu;\n\nerr_put_rpm:\n\tpm_runtime_put_sync_suspend(&pdev->dev);\nerr_disable_rpm:\n\tpm_runtime_disable(&pdev->dev);\n\n\treturn NULL;\n}\n\nstatic int find_chipid(struct device *dev, uint32_t *chipid)\n{\n\tstruct device_node *node = dev->of_node;\n\tconst char *compat;\n\tint ret;\n\n\t \n\tret = of_property_read_string_index(node, \"compatible\", 0, &compat);\n\tif (ret == 0) {\n\t\tunsigned int r, patch;\n\n\t\tif (sscanf(compat, \"qcom,adreno-%u.%u\", &r, &patch) == 2 ||\n\t\t    sscanf(compat, \"amd,imageon-%u.%u\", &r, &patch) == 2) {\n\t\t\tuint32_t core, major, minor;\n\n\t\t\tcore = r / 100;\n\t\t\tr %= 100;\n\t\t\tmajor = r / 10;\n\t\t\tr %= 10;\n\t\t\tminor = r;\n\n\t\t\t*chipid = (core << 24) |\n\t\t\t\t(major << 16) |\n\t\t\t\t(minor << 8) |\n\t\t\t\tpatch;\n\n\t\t\treturn 0;\n\t\t}\n\n\t\tif (sscanf(compat, \"qcom,adreno-%08x\", chipid) == 1)\n\t\t\treturn 0;\n\t}\n\n\t \n\tret = of_property_read_u32(node, \"qcom,chipid\", chipid);\n\tif (ret) {\n\t\tDRM_DEV_ERROR(dev, \"could not parse qcom,chipid: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tdev_warn(dev, \"Using legacy qcom,chipid binding!\\n\");\n\n\treturn 0;\n}\n\nstatic int adreno_bind(struct device *dev, struct device *master, void *data)\n{\n\tstatic struct adreno_platform_config config = {};\n\tconst struct adreno_info *info;\n\tstruct msm_drm_private *priv = dev_get_drvdata(master);\n\tstruct drm_device *drm = priv->dev;\n\tstruct msm_gpu *gpu;\n\tint ret;\n\n\tret = find_chipid(dev, &config.chip_id);\n\tif (ret)\n\t\treturn ret;\n\n\tdev->platform_data = &config;\n\tpriv->gpu_pdev = to_platform_device(dev);\n\n\tinfo = adreno_info(config.chip_id);\n\tif (!info) {\n\t\tdev_warn(drm->dev, \"Unknown GPU revision: %\"ADRENO_CHIPID_FMT\"\\n\",\n\t\t\tADRENO_CHIPID_ARGS(config.chip_id));\n\t\treturn -ENXIO;\n\t}\n\n\tconfig.info = info;\n\n\tDBG(\"Found GPU: %\"ADRENO_CHIPID_FMT, ADRENO_CHIPID_ARGS(config.chip_id));\n\n\tpriv->is_a2xx = info->family < ADRENO_3XX;\n\tpriv->has_cached_coherent =\n\t\t!!(info->quirks & ADRENO_QUIRK_HAS_CACHED_COHERENT);\n\n\tgpu = info->init(drm);\n\tif (IS_ERR(gpu)) {\n\t\tdev_warn(drm->dev, \"failed to load adreno gpu\\n\");\n\t\treturn PTR_ERR(gpu);\n\t}\n\n\tret = dev_pm_opp_of_find_icc_paths(dev, NULL);\n\tif (ret)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nstatic int adreno_system_suspend(struct device *dev);\nstatic void adreno_unbind(struct device *dev, struct device *master,\n\t\tvoid *data)\n{\n\tstruct msm_drm_private *priv = dev_get_drvdata(master);\n\tstruct msm_gpu *gpu = dev_to_gpu(dev);\n\n\tif (pm_runtime_enabled(dev))\n\t\tWARN_ON_ONCE(adreno_system_suspend(dev));\n\tgpu->funcs->destroy(gpu);\n\n\tpriv->gpu_pdev = NULL;\n}\n\nstatic const struct component_ops a3xx_ops = {\n\t.bind   = adreno_bind,\n\t.unbind = adreno_unbind,\n};\n\nstatic void adreno_device_register_headless(void)\n{\n\t \n\tstruct platform_device_info dummy_info = {\n\t\t.parent = NULL,\n\t\t.name = \"msm\",\n\t\t.id = -1,\n\t\t.res = NULL,\n\t\t.num_res = 0,\n\t\t.data = NULL,\n\t\t.size_data = 0,\n\t\t.dma_mask = ~0,\n\t};\n\tplatform_device_register_full(&dummy_info);\n}\n\nstatic int adreno_probe(struct platform_device *pdev)\n{\n\n\tint ret;\n\n\tret = component_add(&pdev->dev, &a3xx_ops);\n\tif (ret)\n\t\treturn ret;\n\n\tif (of_device_is_compatible(pdev->dev.of_node, \"amd,imageon\"))\n\t\tadreno_device_register_headless();\n\n\treturn 0;\n}\n\nstatic int adreno_remove(struct platform_device *pdev)\n{\n\tcomponent_del(&pdev->dev, &a3xx_ops);\n\treturn 0;\n}\n\nstatic void adreno_shutdown(struct platform_device *pdev)\n{\n\tWARN_ON_ONCE(adreno_system_suspend(&pdev->dev));\n}\n\nstatic const struct of_device_id dt_match[] = {\n\t{ .compatible = \"qcom,adreno\" },\n\t{ .compatible = \"qcom,adreno-3xx\" },\n\t \n\t{ .compatible = \"amd,imageon\" },\n\t \n\t{ .compatible = \"qcom,kgsl-3d0\" },\n\t{}\n};\n\nstatic int adreno_runtime_resume(struct device *dev)\n{\n\tstruct msm_gpu *gpu = dev_to_gpu(dev);\n\n\treturn gpu->funcs->pm_resume(gpu);\n}\n\nstatic int adreno_runtime_suspend(struct device *dev)\n{\n\tstruct msm_gpu *gpu = dev_to_gpu(dev);\n\n\t \n\tWARN_ON_ONCE(gpu->active_submits);\n\n\treturn gpu->funcs->pm_suspend(gpu);\n}\n\nstatic void suspend_scheduler(struct msm_gpu *gpu)\n{\n\tint i;\n\n\t \n\tfor (i = 0; i < gpu->nr_rings; i++) {\n\t\tstruct drm_gpu_scheduler *sched = &gpu->rb[i]->sched;\n\t\tkthread_park(sched->thread);\n\t}\n}\n\nstatic void resume_scheduler(struct msm_gpu *gpu)\n{\n\tint i;\n\n\tfor (i = 0; i < gpu->nr_rings; i++) {\n\t\tstruct drm_gpu_scheduler *sched = &gpu->rb[i]->sched;\n\t\tkthread_unpark(sched->thread);\n\t}\n}\n\nstatic int adreno_system_suspend(struct device *dev)\n{\n\tstruct msm_gpu *gpu = dev_to_gpu(dev);\n\tint remaining, ret;\n\n\tif (!gpu)\n\t\treturn 0;\n\n\tsuspend_scheduler(gpu);\n\n\tremaining = wait_event_timeout(gpu->retire_event,\n\t\t\t\t       gpu->active_submits == 0,\n\t\t\t\t       msecs_to_jiffies(1000));\n\tif (remaining == 0) {\n\t\tdev_err(dev, \"Timeout waiting for GPU to suspend\\n\");\n\t\tret = -EBUSY;\n\t\tgoto out;\n\t}\n\n\tret = pm_runtime_force_suspend(dev);\nout:\n\tif (ret)\n\t\tresume_scheduler(gpu);\n\n\treturn ret;\n}\n\nstatic int adreno_system_resume(struct device *dev)\n{\n\tstruct msm_gpu *gpu = dev_to_gpu(dev);\n\n\tif (!gpu)\n\t\treturn 0;\n\n\tresume_scheduler(gpu);\n\treturn pm_runtime_force_resume(dev);\n}\n\nstatic const struct dev_pm_ops adreno_pm_ops = {\n\tSYSTEM_SLEEP_PM_OPS(adreno_system_suspend, adreno_system_resume)\n\tRUNTIME_PM_OPS(adreno_runtime_suspend, adreno_runtime_resume, NULL)\n};\n\nstatic struct platform_driver adreno_driver = {\n\t.probe = adreno_probe,\n\t.remove = adreno_remove,\n\t.shutdown = adreno_shutdown,\n\t.driver = {\n\t\t.name = \"adreno\",\n\t\t.of_match_table = dt_match,\n\t\t.pm = &adreno_pm_ops,\n\t},\n};\n\nvoid __init adreno_register(void)\n{\n\tplatform_driver_register(&adreno_driver);\n}\n\nvoid __exit adreno_unregister(void)\n{\n\tplatform_driver_unregister(&adreno_driver);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}