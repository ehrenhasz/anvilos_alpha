{
  "module_name": "a2xx_gpu.c",
  "hash_id": "dd1a9e066338470c6454b2b19237ceb4250e610f8441ed10d41f0d41fd12831b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/msm/adreno/a2xx_gpu.c",
  "human_readable_source": "\n \n\n#include \"a2xx_gpu.h\"\n#include \"msm_gem.h\"\n#include \"msm_mmu.h\"\n\nextern bool hang_debug;\n\nstatic void a2xx_dump(struct msm_gpu *gpu);\nstatic bool a2xx_idle(struct msm_gpu *gpu);\n\nstatic void a2xx_submit(struct msm_gpu *gpu, struct msm_gem_submit *submit)\n{\n\tstruct msm_ringbuffer *ring = submit->ring;\n\tunsigned int i;\n\n\tfor (i = 0; i < submit->nr_cmds; i++) {\n\t\tswitch (submit->cmd[i].type) {\n\t\tcase MSM_SUBMIT_CMD_IB_TARGET_BUF:\n\t\t\t \n\t\t\tbreak;\n\t\tcase MSM_SUBMIT_CMD_CTX_RESTORE_BUF:\n\t\t\t \n\t\t\tif (gpu->cur_ctx_seqno == submit->queue->ctx->seqno)\n\t\t\t\tbreak;\n\t\t\tfallthrough;\n\t\tcase MSM_SUBMIT_CMD_BUF:\n\t\t\tOUT_PKT3(ring, CP_INDIRECT_BUFFER_PFD, 2);\n\t\t\tOUT_RING(ring, lower_32_bits(submit->cmd[i].iova));\n\t\t\tOUT_RING(ring, submit->cmd[i].size);\n\t\t\tOUT_PKT2(ring);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tOUT_PKT0(ring, REG_AXXX_CP_SCRATCH_REG2, 1);\n\tOUT_RING(ring, submit->seqno);\n\n\t \n\tOUT_PKT3(ring, CP_WAIT_FOR_IDLE, 1);\n\tOUT_RING(ring, 0x00000000);\n\n\tOUT_PKT3(ring, CP_EVENT_WRITE, 3);\n\tOUT_RING(ring, CACHE_FLUSH_TS);\n\tOUT_RING(ring, rbmemptr(ring, fence));\n\tOUT_RING(ring, submit->seqno);\n\tOUT_PKT3(ring, CP_INTERRUPT, 1);\n\tOUT_RING(ring, 0x80000000);\n\n\tadreno_flush(gpu, ring, REG_AXXX_CP_RB_WPTR);\n}\n\nstatic bool a2xx_me_init(struct msm_gpu *gpu)\n{\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tstruct a2xx_gpu *a2xx_gpu = to_a2xx_gpu(adreno_gpu);\n\tstruct msm_ringbuffer *ring = gpu->rb[0];\n\n\tOUT_PKT3(ring, CP_ME_INIT, 18);\n\n\t \n\tOUT_RING(ring, 0x000003ff);\n\t \n\tOUT_RING(ring, 0x00000000);\n\t \n\tOUT_RING(ring, 0x00000000);\n\n\tOUT_RING(ring, REG_A2XX_RB_SURFACE_INFO - 0x2000);\n\tOUT_RING(ring, REG_A2XX_PA_SC_WINDOW_OFFSET - 0x2000);\n\tOUT_RING(ring, REG_A2XX_VGT_MAX_VTX_INDX - 0x2000);\n\tOUT_RING(ring, REG_A2XX_SQ_PROGRAM_CNTL - 0x2000);\n\tOUT_RING(ring, REG_A2XX_RB_DEPTHCONTROL - 0x2000);\n\tOUT_RING(ring, REG_A2XX_PA_SU_POINT_SIZE - 0x2000);\n\tOUT_RING(ring, REG_A2XX_PA_SC_LINE_CNTL - 0x2000);\n\tOUT_RING(ring, REG_A2XX_PA_SU_POLY_OFFSET_FRONT_SCALE - 0x2000);\n\n\t \n\tOUT_RING(ring, 0x80000180);\n\t \n\tOUT_RING(ring, 0x00000001);\n\t \n\tOUT_RING(ring, 0x00000000);\n\t \n\tOUT_RING(ring, 0x00000000);\n\t \n\tif (a2xx_gpu->protection_disabled)\n\t\tOUT_RING(ring, 0x00000000);\n\telse\n\t\tOUT_RING(ring, 0x200001f2);\n\t \n\tOUT_RING(ring, 0x00000000);\n\t \n\tOUT_RING(ring, 0x00000000);\n\n\tif (!a2xx_gpu->protection_disabled) {\n\t\t \n\t\tOUT_PKT3(ring, CP_SET_PROTECTED_MODE, 1);\n\t\tOUT_RING(ring, 1);\n\t}\n\n\tadreno_flush(gpu, ring, REG_AXXX_CP_RB_WPTR);\n\treturn a2xx_idle(gpu);\n}\n\nstatic int a2xx_hw_init(struct msm_gpu *gpu)\n{\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tstruct a2xx_gpu *a2xx_gpu = to_a2xx_gpu(adreno_gpu);\n\tdma_addr_t pt_base, tran_error;\n\tuint32_t *ptr, len;\n\tint i, ret;\n\n\tmsm_gpummu_params(gpu->aspace->mmu, &pt_base, &tran_error);\n\n\tDBG(\"%s\", gpu->name);\n\n\t \n\tgpu_write(gpu, REG_AXXX_CP_ME_CNTL, AXXX_CP_ME_CNTL_HALT);\n\n\tgpu_write(gpu, REG_A2XX_RBBM_PM_OVERRIDE1, 0xfffffffe);\n\tgpu_write(gpu, REG_A2XX_RBBM_PM_OVERRIDE2, 0xffffffff);\n\n\t \n\tgpu_write(gpu, REG_A2XX_RBBM_SOFT_RESET, 0xffffffff);\n\tmsleep(30);\n\tgpu_write(gpu, REG_A2XX_RBBM_SOFT_RESET, 0x00000000);\n\n\tif (adreno_is_a225(adreno_gpu))\n\t\tgpu_write(gpu, REG_A2XX_SQ_FLOW_CONTROL, 0x18000000);\n\n\t \n\tgpu_write(gpu, REG_A2XX_RBBM_CNTL, 0x00004442);\n\n\t \n\tgpu_write(gpu, REG_A2XX_MH_MMU_MPU_BASE, 0x00000000);\n\tgpu_write(gpu, REG_A2XX_MH_MMU_MPU_END, 0xfffff000);\n\n\tgpu_write(gpu, REG_A2XX_MH_MMU_CONFIG, A2XX_MH_MMU_CONFIG_MMU_ENABLE |\n\t\tA2XX_MH_MMU_CONFIG_RB_W_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_CP_W_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_CP_R0_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_CP_R1_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_CP_R2_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_CP_R3_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_CP_R4_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_VGT_R0_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_VGT_R1_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_TC_R_CLNT_BEHAVIOR(BEH_TRAN_RNG) |\n\t\tA2XX_MH_MMU_CONFIG_PA_W_CLNT_BEHAVIOR(BEH_TRAN_RNG));\n\n\t \n\tgpu_write(gpu, REG_A2XX_MH_MMU_VA_RANGE, SZ_16M |\n\t\tA2XX_MH_MMU_VA_RANGE_NUM_64KB_REGIONS(0xfff));\n\n\tgpu_write(gpu, REG_A2XX_MH_MMU_PT_BASE, pt_base);\n\tgpu_write(gpu, REG_A2XX_MH_MMU_TRAN_ERROR, tran_error);\n\n\tgpu_write(gpu, REG_A2XX_MH_MMU_INVALIDATE,\n\t\tA2XX_MH_MMU_INVALIDATE_INVALIDATE_ALL |\n\t\tA2XX_MH_MMU_INVALIDATE_INVALIDATE_TC);\n\n\tgpu_write(gpu, REG_A2XX_MH_ARBITER_CONFIG,\n\t\tA2XX_MH_ARBITER_CONFIG_SAME_PAGE_LIMIT(16) |\n\t\tA2XX_MH_ARBITER_CONFIG_L1_ARB_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_L1_ARB_HOLD_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_PAGE_SIZE(1) |\n\t\tA2XX_MH_ARBITER_CONFIG_TC_REORDER_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_TC_ARB_HOLD_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_IN_FLIGHT_LIMIT_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_IN_FLIGHT_LIMIT(8) |\n\t\tA2XX_MH_ARBITER_CONFIG_CP_CLNT_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_VGT_CLNT_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_TC_CLNT_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_RB_CLNT_ENABLE |\n\t\tA2XX_MH_ARBITER_CONFIG_PA_CLNT_ENABLE);\n\tif (!adreno_is_a20x(adreno_gpu))\n\t\tgpu_write(gpu, REG_A2XX_MH_CLNT_INTF_CTRL_CONFIG1, 0x00032f07);\n\n\tgpu_write(gpu, REG_A2XX_SQ_VS_PROGRAM, 0x00000000);\n\tgpu_write(gpu, REG_A2XX_SQ_PS_PROGRAM, 0x00000000);\n\n\tgpu_write(gpu, REG_A2XX_RBBM_PM_OVERRIDE1, 0);  \n\tgpu_write(gpu, REG_A2XX_RBBM_PM_OVERRIDE2, 0);  \n\n\t \n\tgpu_write(gpu, REG_A2XX_RBBM_DEBUG, 0x00080000);\n\n\tgpu_write(gpu, REG_A2XX_RBBM_INT_CNTL,\n\t\tA2XX_RBBM_INT_CNTL_RDERR_INT_MASK);\n\tgpu_write(gpu, REG_AXXX_CP_INT_CNTL,\n\t\tAXXX_CP_INT_CNTL_T0_PACKET_IN_IB_MASK |\n\t\tAXXX_CP_INT_CNTL_OPCODE_ERROR_MASK |\n\t\tAXXX_CP_INT_CNTL_PROTECTED_MODE_ERROR_MASK |\n\t\tAXXX_CP_INT_CNTL_RESERVED_BIT_ERROR_MASK |\n\t\tAXXX_CP_INT_CNTL_IB_ERROR_MASK |\n\t\tAXXX_CP_INT_CNTL_IB1_INT_MASK |\n\t\tAXXX_CP_INT_CNTL_RB_INT_MASK);\n\tgpu_write(gpu, REG_A2XX_SQ_INT_CNTL, 0);\n\tgpu_write(gpu, REG_A2XX_MH_INTERRUPT_MASK,\n\t\tA2XX_MH_INTERRUPT_MASK_AXI_READ_ERROR |\n\t\tA2XX_MH_INTERRUPT_MASK_AXI_WRITE_ERROR |\n\t\tA2XX_MH_INTERRUPT_MASK_MMU_PAGE_FAULT);\n\n\tfor (i = 3; i <= 5; i++)\n\t\tif ((SZ_16K << i) == adreno_gpu->info->gmem)\n\t\t\tbreak;\n\tgpu_write(gpu, REG_A2XX_RB_EDRAM_INFO, i);\n\n\tret = adreno_hw_init(gpu);\n\tif (ret)\n\t\treturn ret;\n\n\tgpu_write(gpu, REG_AXXX_CP_RB_CNTL,\n\t\tMSM_GPU_RB_CNTL_DEFAULT | AXXX_CP_RB_CNTL_NO_UPDATE);\n\n\tgpu_write(gpu, REG_AXXX_CP_RB_BASE, lower_32_bits(gpu->rb[0]->iova));\n\n\t \n\n\t \n\tptr = (uint32_t *)(adreno_gpu->fw[ADRENO_FW_PM4]->data);\n\tlen = adreno_gpu->fw[ADRENO_FW_PM4]->size / 4;\n\tDBG(\"loading PM4 ucode version: %x\", ptr[1]);\n\n\t \n\tif (ptr[1] == 0) {\n\t\tdev_warn(gpu->dev->dev,\n\t\t\t \"Legacy firmware detected, disabling protection support\\n\");\n\t\ta2xx_gpu->protection_disabled = true;\n\t}\n\n\tgpu_write(gpu, REG_AXXX_CP_DEBUG,\n\t\t\tAXXX_CP_DEBUG_MIU_128BIT_WRITE_ENABLE);\n\tgpu_write(gpu, REG_AXXX_CP_ME_RAM_WADDR, 0);\n\tfor (i = 1; i < len; i++)\n\t\tgpu_write(gpu, REG_AXXX_CP_ME_RAM_DATA, ptr[i]);\n\n\t \n\tptr = (uint32_t *)(adreno_gpu->fw[ADRENO_FW_PFP]->data);\n\tlen = adreno_gpu->fw[ADRENO_FW_PFP]->size / 4;\n\tDBG(\"loading PFP ucode version: %x\", ptr[5]);\n\n\tgpu_write(gpu, REG_A2XX_CP_PFP_UCODE_ADDR, 0);\n\tfor (i = 1; i < len; i++)\n\t\tgpu_write(gpu, REG_A2XX_CP_PFP_UCODE_DATA, ptr[i]);\n\n\tgpu_write(gpu, REG_AXXX_CP_QUEUE_THRESHOLDS, 0x000C0804);\n\n\t \n\tgpu_write(gpu, REG_AXXX_CP_ME_CNTL, 0);\n\n\treturn a2xx_me_init(gpu) ? 0 : -EINVAL;\n}\n\nstatic void a2xx_recover(struct msm_gpu *gpu)\n{\n\tint i;\n\n\tadreno_dump_info(gpu);\n\n\tfor (i = 0; i < 8; i++) {\n\t\tprintk(\"CP_SCRATCH_REG%d: %u\\n\", i,\n\t\t\tgpu_read(gpu, REG_AXXX_CP_SCRATCH_REG0 + i));\n\t}\n\n\t \n\tif (hang_debug)\n\t\ta2xx_dump(gpu);\n\n\tgpu_write(gpu, REG_A2XX_RBBM_SOFT_RESET, 1);\n\tgpu_read(gpu, REG_A2XX_RBBM_SOFT_RESET);\n\tgpu_write(gpu, REG_A2XX_RBBM_SOFT_RESET, 0);\n\tadreno_recover(gpu);\n}\n\nstatic void a2xx_destroy(struct msm_gpu *gpu)\n{\n\tstruct adreno_gpu *adreno_gpu = to_adreno_gpu(gpu);\n\tstruct a2xx_gpu *a2xx_gpu = to_a2xx_gpu(adreno_gpu);\n\n\tDBG(\"%s\", gpu->name);\n\n\tadreno_gpu_cleanup(adreno_gpu);\n\n\tkfree(a2xx_gpu);\n}\n\nstatic bool a2xx_idle(struct msm_gpu *gpu)\n{\n\t \n\tif (!adreno_idle(gpu, gpu->rb[0]))\n\t\treturn false;\n\n\t \n\tif (spin_until(!(gpu_read(gpu, REG_A2XX_RBBM_STATUS) &\n\t\t\tA2XX_RBBM_STATUS_GUI_ACTIVE))) {\n\t\tDRM_ERROR(\"%s: timeout waiting for GPU to idle!\\n\", gpu->name);\n\n\t\t \n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nstatic irqreturn_t a2xx_irq(struct msm_gpu *gpu)\n{\n\tuint32_t mstatus, status;\n\n\tmstatus = gpu_read(gpu, REG_A2XX_MASTER_INT_SIGNAL);\n\n\tif (mstatus & A2XX_MASTER_INT_SIGNAL_MH_INT_STAT) {\n\t\tstatus = gpu_read(gpu, REG_A2XX_MH_INTERRUPT_STATUS);\n\n\t\tdev_warn(gpu->dev->dev, \"MH_INT: %08X\\n\", status);\n\t\tdev_warn(gpu->dev->dev, \"MMU_PAGE_FAULT: %08X\\n\",\n\t\t\tgpu_read(gpu, REG_A2XX_MH_MMU_PAGE_FAULT));\n\n\t\tgpu_write(gpu, REG_A2XX_MH_INTERRUPT_CLEAR, status);\n\t}\n\n\tif (mstatus & A2XX_MASTER_INT_SIGNAL_CP_INT_STAT) {\n\t\tstatus = gpu_read(gpu, REG_AXXX_CP_INT_STATUS);\n\n\t\t \n\t\tif (status & ~AXXX_CP_INT_CNTL_RB_INT_MASK)\n\t\t\tdev_warn(gpu->dev->dev, \"CP_INT: %08X\\n\", status);\n\n\t\tgpu_write(gpu, REG_AXXX_CP_INT_ACK, status);\n\t}\n\n\tif (mstatus & A2XX_MASTER_INT_SIGNAL_RBBM_INT_STAT) {\n\t\tstatus = gpu_read(gpu, REG_A2XX_RBBM_INT_STATUS);\n\n\t\tdev_warn(gpu->dev->dev, \"RBBM_INT: %08X\\n\", status);\n\n\t\tgpu_write(gpu, REG_A2XX_RBBM_INT_ACK, status);\n\t}\n\n\tmsm_gpu_retire(gpu);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic const unsigned int a200_registers[] = {\n\t0x0000, 0x0002, 0x0004, 0x000B, 0x003B, 0x003D, 0x0040, 0x0044,\n\t0x0046, 0x0047, 0x01C0, 0x01C1, 0x01C3, 0x01C8, 0x01D5, 0x01D9,\n\t0x01DC, 0x01DD, 0x01EA, 0x01EA, 0x01EE, 0x01F3, 0x01F6, 0x01F7,\n\t0x01FC, 0x01FF, 0x0391, 0x0392, 0x039B, 0x039E, 0x03B2, 0x03B5,\n\t0x03B7, 0x03B7, 0x03F8, 0x03FB, 0x0440, 0x0440, 0x0443, 0x0444,\n\t0x044B, 0x044B, 0x044D, 0x044F, 0x0452, 0x0452, 0x0454, 0x045B,\n\t0x047F, 0x047F, 0x0578, 0x0587, 0x05C9, 0x05C9, 0x05D0, 0x05D0,\n\t0x0601, 0x0604, 0x0606, 0x0609, 0x060B, 0x060E, 0x0613, 0x0614,\n\t0x0A29, 0x0A2B, 0x0A2F, 0x0A31, 0x0A40, 0x0A43, 0x0A45, 0x0A45,\n\t0x0A4E, 0x0A4F, 0x0C2C, 0x0C2C, 0x0C30, 0x0C30, 0x0C38, 0x0C3C,\n\t0x0C40, 0x0C40, 0x0C44, 0x0C44, 0x0C80, 0x0C86, 0x0C88, 0x0C94,\n\t0x0C99, 0x0C9A, 0x0CA4, 0x0CA5, 0x0D00, 0x0D03, 0x0D06, 0x0D06,\n\t0x0D08, 0x0D0B, 0x0D34, 0x0D35, 0x0DAE, 0x0DC1, 0x0DC8, 0x0DD4,\n\t0x0DD8, 0x0DD9, 0x0E00, 0x0E00, 0x0E02, 0x0E04, 0x0E17, 0x0E1E,\n\t0x0EC0, 0x0EC9, 0x0ECB, 0x0ECC, 0x0ED0, 0x0ED0, 0x0ED4, 0x0ED7,\n\t0x0EE0, 0x0EE2, 0x0F01, 0x0F02, 0x0F0C, 0x0F0C, 0x0F0E, 0x0F12,\n\t0x0F26, 0x0F2A, 0x0F2C, 0x0F2C, 0x2000, 0x2002, 0x2006, 0x200F,\n\t0x2080, 0x2082, 0x2100, 0x2109, 0x210C, 0x2114, 0x2180, 0x2184,\n\t0x21F5, 0x21F7, 0x2200, 0x2208, 0x2280, 0x2283, 0x2293, 0x2294,\n\t0x2300, 0x2308, 0x2312, 0x2312, 0x2316, 0x231D, 0x2324, 0x2326,\n\t0x2380, 0x2383, 0x2400, 0x2402, 0x2406, 0x240F, 0x2480, 0x2482,\n\t0x2500, 0x2509, 0x250C, 0x2514, 0x2580, 0x2584, 0x25F5, 0x25F7,\n\t0x2600, 0x2608, 0x2680, 0x2683, 0x2693, 0x2694, 0x2700, 0x2708,\n\t0x2712, 0x2712, 0x2716, 0x271D, 0x2724, 0x2726, 0x2780, 0x2783,\n\t0x4000, 0x4003, 0x4800, 0x4805, 0x4900, 0x4900, 0x4908, 0x4908,\n\t~0    \n};\n\nstatic const unsigned int a220_registers[] = {\n\t0x0000, 0x0002, 0x0004, 0x000B, 0x003B, 0x003D, 0x0040, 0x0044,\n\t0x0046, 0x0047, 0x01C0, 0x01C1, 0x01C3, 0x01C8, 0x01D5, 0x01D9,\n\t0x01DC, 0x01DD, 0x01EA, 0x01EA, 0x01EE, 0x01F3, 0x01F6, 0x01F7,\n\t0x01FC, 0x01FF, 0x0391, 0x0392, 0x039B, 0x039E, 0x03B2, 0x03B5,\n\t0x03B7, 0x03B7, 0x03F8, 0x03FB, 0x0440, 0x0440, 0x0443, 0x0444,\n\t0x044B, 0x044B, 0x044D, 0x044F, 0x0452, 0x0452, 0x0454, 0x045B,\n\t0x047F, 0x047F, 0x0578, 0x0587, 0x05C9, 0x05C9, 0x05D0, 0x05D0,\n\t0x0601, 0x0604, 0x0606, 0x0609, 0x060B, 0x060E, 0x0613, 0x0614,\n\t0x0A29, 0x0A2B, 0x0A2F, 0x0A31, 0x0A40, 0x0A40, 0x0A42, 0x0A43,\n\t0x0A45, 0x0A45, 0x0A4E, 0x0A4F, 0x0C30, 0x0C30, 0x0C38, 0x0C39,\n\t0x0C3C, 0x0C3C, 0x0C80, 0x0C81, 0x0C88, 0x0C93, 0x0D00, 0x0D03,\n\t0x0D05, 0x0D06, 0x0D08, 0x0D0B, 0x0D34, 0x0D35, 0x0DAE, 0x0DC1,\n\t0x0DC8, 0x0DD4, 0x0DD8, 0x0DD9, 0x0E00, 0x0E00, 0x0E02, 0x0E04,\n\t0x0E17, 0x0E1E, 0x0EC0, 0x0EC9, 0x0ECB, 0x0ECC, 0x0ED0, 0x0ED0,\n\t0x0ED4, 0x0ED7, 0x0EE0, 0x0EE2, 0x0F01, 0x0F02, 0x2000, 0x2002,\n\t0x2006, 0x200F, 0x2080, 0x2082, 0x2100, 0x2102, 0x2104, 0x2109,\n\t0x210C, 0x2114, 0x2180, 0x2184, 0x21F5, 0x21F7, 0x2200, 0x2202,\n\t0x2204, 0x2204, 0x2208, 0x2208, 0x2280, 0x2282, 0x2294, 0x2294,\n\t0x2300, 0x2308, 0x2309, 0x230A, 0x2312, 0x2312, 0x2316, 0x2316,\n\t0x2318, 0x231D, 0x2324, 0x2326, 0x2380, 0x2383, 0x2400, 0x2402,\n\t0x2406, 0x240F, 0x2480, 0x2482, 0x2500, 0x2502, 0x2504, 0x2509,\n\t0x250C, 0x2514, 0x2580, 0x2584, 0x25F5, 0x25F7, 0x2600, 0x2602,\n\t0x2604, 0x2606, 0x2608, 0x2608, 0x2680, 0x2682, 0x2694, 0x2694,\n\t0x2700, 0x2708, 0x2712, 0x2712, 0x2716, 0x2716, 0x2718, 0x271D,\n\t0x2724, 0x2726, 0x2780, 0x2783, 0x4000, 0x4003, 0x4800, 0x4805,\n\t0x4900, 0x4900, 0x4908, 0x4908,\n\t~0    \n};\n\nstatic const unsigned int a225_registers[] = {\n\t0x0000, 0x0002, 0x0004, 0x000B, 0x003B, 0x003D, 0x0040, 0x0044,\n\t0x0046, 0x0047, 0x013C, 0x013C, 0x0140, 0x014F, 0x01C0, 0x01C1,\n\t0x01C3, 0x01C8, 0x01D5, 0x01D9, 0x01DC, 0x01DD, 0x01EA, 0x01EA,\n\t0x01EE, 0x01F3, 0x01F6, 0x01F7, 0x01FC, 0x01FF, 0x0391, 0x0392,\n\t0x039B, 0x039E, 0x03B2, 0x03B5, 0x03B7, 0x03B7, 0x03F8, 0x03FB,\n\t0x0440, 0x0440, 0x0443, 0x0444, 0x044B, 0x044B, 0x044D, 0x044F,\n\t0x0452, 0x0452, 0x0454, 0x045B, 0x047F, 0x047F, 0x0578, 0x0587,\n\t0x05C9, 0x05C9, 0x05D0, 0x05D0, 0x0601, 0x0604, 0x0606, 0x0609,\n\t0x060B, 0x060E, 0x0613, 0x0614, 0x0A29, 0x0A2B, 0x0A2F, 0x0A31,\n\t0x0A40, 0x0A40, 0x0A42, 0x0A43, 0x0A45, 0x0A45, 0x0A4E, 0x0A4F,\n\t0x0C01, 0x0C1D, 0x0C30, 0x0C30, 0x0C38, 0x0C39, 0x0C3C, 0x0C3C,\n\t0x0C80, 0x0C81, 0x0C88, 0x0C93, 0x0D00, 0x0D03, 0x0D05, 0x0D06,\n\t0x0D08, 0x0D0B, 0x0D34, 0x0D35, 0x0DAE, 0x0DC1, 0x0DC8, 0x0DD4,\n\t0x0DD8, 0x0DD9, 0x0E00, 0x0E00, 0x0E02, 0x0E04, 0x0E17, 0x0E1E,\n\t0x0EC0, 0x0EC9, 0x0ECB, 0x0ECC, 0x0ED0, 0x0ED0, 0x0ED4, 0x0ED7,\n\t0x0EE0, 0x0EE2, 0x0F01, 0x0F02, 0x2000, 0x200F, 0x2080, 0x2082,\n\t0x2100, 0x2109, 0x210C, 0x2114, 0x2180, 0x2184, 0x21F5, 0x21F7,\n\t0x2200, 0x2202, 0x2204, 0x2206, 0x2208, 0x2210, 0x2220, 0x2222,\n\t0x2280, 0x2282, 0x2294, 0x2294, 0x2297, 0x2297, 0x2300, 0x230A,\n\t0x2312, 0x2312, 0x2315, 0x2316, 0x2318, 0x231D, 0x2324, 0x2326,\n\t0x2340, 0x2357, 0x2360, 0x2360, 0x2380, 0x2383, 0x2400, 0x240F,\n\t0x2480, 0x2482, 0x2500, 0x2509, 0x250C, 0x2514, 0x2580, 0x2584,\n\t0x25F5, 0x25F7, 0x2600, 0x2602, 0x2604, 0x2606, 0x2608, 0x2610,\n\t0x2620, 0x2622, 0x2680, 0x2682, 0x2694, 0x2694, 0x2697, 0x2697,\n\t0x2700, 0x270A, 0x2712, 0x2712, 0x2715, 0x2716, 0x2718, 0x271D,\n\t0x2724, 0x2726, 0x2740, 0x2757, 0x2760, 0x2760, 0x2780, 0x2783,\n\t0x4000, 0x4003, 0x4800, 0x4806, 0x4808, 0x4808, 0x4900, 0x4900,\n\t0x4908, 0x4908,\n\t~0    \n};\n\n \nstatic void a2xx_dump(struct msm_gpu *gpu)\n{\n\tprintk(\"status:   %08x\\n\",\n\t\t\tgpu_read(gpu, REG_A2XX_RBBM_STATUS));\n\tadreno_dump(gpu);\n}\n\nstatic struct msm_gpu_state *a2xx_gpu_state_get(struct msm_gpu *gpu)\n{\n\tstruct msm_gpu_state *state = kzalloc(sizeof(*state), GFP_KERNEL);\n\n\tif (!state)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tadreno_gpu_state_get(gpu, state);\n\n\tstate->rbbm_status = gpu_read(gpu, REG_A2XX_RBBM_STATUS);\n\n\treturn state;\n}\n\nstatic struct msm_gem_address_space *\na2xx_create_address_space(struct msm_gpu *gpu, struct platform_device *pdev)\n{\n\tstruct msm_mmu *mmu = msm_gpummu_new(&pdev->dev, gpu);\n\tstruct msm_gem_address_space *aspace;\n\n\taspace = msm_gem_address_space_create(mmu, \"gpu\", SZ_16M,\n\t\t0xfff * SZ_64K);\n\n\tif (IS_ERR(aspace) && !IS_ERR(mmu))\n\t\tmmu->funcs->destroy(mmu);\n\n\treturn aspace;\n}\n\nstatic u32 a2xx_get_rptr(struct msm_gpu *gpu, struct msm_ringbuffer *ring)\n{\n\tring->memptrs->rptr = gpu_read(gpu, REG_AXXX_CP_RB_RPTR);\n\treturn ring->memptrs->rptr;\n}\n\nstatic const struct adreno_gpu_funcs funcs = {\n\t.base = {\n\t\t.get_param = adreno_get_param,\n\t\t.set_param = adreno_set_param,\n\t\t.hw_init = a2xx_hw_init,\n\t\t.pm_suspend = msm_gpu_pm_suspend,\n\t\t.pm_resume = msm_gpu_pm_resume,\n\t\t.recover = a2xx_recover,\n\t\t.submit = a2xx_submit,\n\t\t.active_ring = adreno_active_ring,\n\t\t.irq = a2xx_irq,\n\t\t.destroy = a2xx_destroy,\n#if defined(CONFIG_DEBUG_FS) || defined(CONFIG_DEV_COREDUMP)\n\t\t.show = adreno_show,\n#endif\n\t\t.gpu_state_get = a2xx_gpu_state_get,\n\t\t.gpu_state_put = adreno_gpu_state_put,\n\t\t.create_address_space = a2xx_create_address_space,\n\t\t.get_rptr = a2xx_get_rptr,\n\t},\n};\n\nstatic const struct msm_gpu_perfcntr perfcntrs[] = {\n \n};\n\nstruct msm_gpu *a2xx_gpu_init(struct drm_device *dev)\n{\n\tstruct a2xx_gpu *a2xx_gpu = NULL;\n\tstruct adreno_gpu *adreno_gpu;\n\tstruct msm_gpu *gpu;\n\tstruct msm_drm_private *priv = dev->dev_private;\n\tstruct platform_device *pdev = priv->gpu_pdev;\n\tint ret;\n\n\tif (!pdev) {\n\t\tdev_err(dev->dev, \"no a2xx device\\n\");\n\t\tret = -ENXIO;\n\t\tgoto fail;\n\t}\n\n\ta2xx_gpu = kzalloc(sizeof(*a2xx_gpu), GFP_KERNEL);\n\tif (!a2xx_gpu) {\n\t\tret = -ENOMEM;\n\t\tgoto fail;\n\t}\n\n\tadreno_gpu = &a2xx_gpu->base;\n\tgpu = &adreno_gpu->base;\n\n\tgpu->perfcntrs = perfcntrs;\n\tgpu->num_perfcntrs = ARRAY_SIZE(perfcntrs);\n\n\tret = adreno_gpu_init(dev, pdev, adreno_gpu, &funcs, 1);\n\tif (ret)\n\t\tgoto fail;\n\n\tif (adreno_is_a20x(adreno_gpu))\n\t\tadreno_gpu->registers = a200_registers;\n\telse if (adreno_is_a225(adreno_gpu))\n\t\tadreno_gpu->registers = a225_registers;\n\telse\n\t\tadreno_gpu->registers = a220_registers;\n\n\tif (!gpu->aspace) {\n\t\tdev_err(dev->dev, \"No memory protection without MMU\\n\");\n\t\tif (!allow_vram_carveout) {\n\t\t\tret = -ENXIO;\n\t\t\tgoto fail;\n\t\t}\n\t}\n\n\treturn gpu;\n\nfail:\n\tif (a2xx_gpu)\n\t\ta2xx_destroy(&a2xx_gpu->base.base);\n\n\treturn ERR_PTR(ret);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}