{
  "module_name": "dpu_writeback.c",
  "hash_id": "bfde20e226df3d566a997ec1791d8b58df2ff996e161eb625569506eadd6b847",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/msm/disp/dpu1/dpu_writeback.c",
  "human_readable_source": "\n \n\n#include <drm/drm_edid.h>\n\n#include \"dpu_writeback.h\"\n\nstatic int dpu_wb_conn_get_modes(struct drm_connector *connector)\n{\n\tstruct drm_device *dev = connector->dev;\n\tstruct msm_drm_private *priv = dev->dev_private;\n\tstruct dpu_kms *dpu_kms = to_dpu_kms(priv->kms);\n\n\t \n\treturn drm_add_modes_noedid(connector, dpu_kms->catalog->caps->max_mixer_width,\n\t\t\tdev->mode_config.max_height);\n}\n\nstatic const struct drm_connector_funcs dpu_wb_conn_funcs = {\n\t.reset = drm_atomic_helper_connector_reset,\n\t.fill_modes = drm_helper_probe_single_connector_modes,\n\t.destroy = drm_connector_cleanup,\n\t.atomic_duplicate_state = drm_atomic_helper_connector_duplicate_state,\n\t.atomic_destroy_state = drm_atomic_helper_connector_destroy_state,\n};\n\nstatic int dpu_wb_conn_prepare_job(struct drm_writeback_connector *connector,\n\t\tstruct drm_writeback_job *job)\n{\n\n\tstruct dpu_wb_connector *dpu_wb_conn = to_dpu_wb_conn(connector);\n\n\tif (!job->fb)\n\t\treturn 0;\n\n\tdpu_encoder_prepare_wb_job(dpu_wb_conn->wb_enc, job);\n\n\treturn 0;\n}\n\nstatic void dpu_wb_conn_cleanup_job(struct drm_writeback_connector *connector,\n\t\tstruct drm_writeback_job *job)\n{\n\tstruct dpu_wb_connector *dpu_wb_conn = to_dpu_wb_conn(connector);\n\n\tif (!job->fb)\n\t\treturn;\n\n\tdpu_encoder_cleanup_wb_job(dpu_wb_conn->wb_enc, job);\n}\n\nstatic const struct drm_connector_helper_funcs dpu_wb_conn_helper_funcs = {\n\t.get_modes = dpu_wb_conn_get_modes,\n\t.prepare_writeback_job = dpu_wb_conn_prepare_job,\n\t.cleanup_writeback_job = dpu_wb_conn_cleanup_job,\n};\n\nint dpu_writeback_init(struct drm_device *dev, struct drm_encoder *enc,\n\t\tconst u32 *format_list, u32 num_formats)\n{\n\tstruct dpu_wb_connector *dpu_wb_conn;\n\tint rc = 0;\n\n\tdpu_wb_conn = devm_kzalloc(dev->dev, sizeof(*dpu_wb_conn), GFP_KERNEL);\n\tif (!dpu_wb_conn)\n\t\treturn -ENOMEM;\n\n\tdrm_connector_helper_add(&dpu_wb_conn->base.base, &dpu_wb_conn_helper_funcs);\n\n\t \n\trc = drm_writeback_connector_init_with_encoder(dev, &dpu_wb_conn->base, enc,\n\t\t\t&dpu_wb_conn_funcs, format_list, num_formats);\n\n\tif (!rc)\n\t\tdpu_wb_conn->wb_enc = enc;\n\n\treturn rc;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}