{
  "module_name": "dpu_hw_dspp.c",
  "hash_id": "4b9f8b85e09fda46b4aa71f6fcb878c60487f4cc6a8e62b003a6b9c8d0c5b096",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/msm/disp/dpu1/dpu_hw_dspp.c",
  "human_readable_source": "\n \n\n#include \"dpu_hwio.h\"\n#include \"dpu_hw_catalog.h\"\n#include \"dpu_hw_lm.h\"\n#include \"dpu_hw_dspp.h\"\n#include \"dpu_kms.h\"\n\n\n \n#define PCC_EN BIT(0)\n#define PCC_DIS 0\n#define PCC_RED_R_OFF 0x10\n#define PCC_RED_G_OFF 0x1C\n#define PCC_RED_B_OFF 0x28\n#define PCC_GREEN_R_OFF 0x14\n#define PCC_GREEN_G_OFF 0x20\n#define PCC_GREEN_B_OFF 0x2C\n#define PCC_BLUE_R_OFF 0x18\n#define PCC_BLUE_G_OFF 0x24\n#define PCC_BLUE_B_OFF 0x30\n\nstatic void dpu_setup_dspp_pcc(struct dpu_hw_dspp *ctx,\n\t\tstruct dpu_hw_pcc_cfg *cfg)\n{\n\n\tu32 base;\n\n\tif (!ctx) {\n\t\tDRM_ERROR(\"invalid ctx %pK\\n\", ctx);\n\t\treturn;\n\t}\n\n\tbase = ctx->cap->sblk->pcc.base;\n\n\tif (!base) {\n\t\tDRM_ERROR(\"invalid ctx %pK pcc base 0x%x\\n\", ctx, base);\n\t\treturn;\n\t}\n\n\tif (!cfg) {\n\t\tDRM_DEBUG_DRIVER(\"disable pcc feature\\n\");\n\t\tDPU_REG_WRITE(&ctx->hw, base, PCC_DIS);\n\t\treturn;\n\t}\n\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_RED_R_OFF, cfg->r.r);\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_RED_G_OFF, cfg->r.g);\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_RED_B_OFF, cfg->r.b);\n\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_GREEN_R_OFF, cfg->g.r);\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_GREEN_G_OFF, cfg->g.g);\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_GREEN_B_OFF, cfg->g.b);\n\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_BLUE_R_OFF, cfg->b.r);\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_BLUE_G_OFF, cfg->b.g);\n\tDPU_REG_WRITE(&ctx->hw, base + PCC_BLUE_B_OFF, cfg->b.b);\n\n\tDPU_REG_WRITE(&ctx->hw, base, PCC_EN);\n}\n\nstatic void _setup_dspp_ops(struct dpu_hw_dspp *c,\n\t\tunsigned long features)\n{\n\tif (test_bit(DPU_DSPP_PCC, &features))\n\t\tc->ops.setup_pcc = dpu_setup_dspp_pcc;\n}\n\nstruct dpu_hw_dspp *dpu_hw_dspp_init(const struct dpu_dspp_cfg *cfg,\n\t\t\tvoid __iomem *addr)\n{\n\tstruct dpu_hw_dspp *c;\n\n\tif (!addr)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tc = kzalloc(sizeof(*c), GFP_KERNEL);\n\tif (!c)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tc->hw.blk_addr = addr + cfg->base;\n\tc->hw.log_mask = DPU_DBG_MASK_DSPP;\n\n\t \n\tc->idx = cfg->id;\n\tc->cap = cfg;\n\t_setup_dspp_ops(c, c->cap->features);\n\n\treturn c;\n}\n\nvoid dpu_hw_dspp_destroy(struct dpu_hw_dspp *dspp)\n{\n\tkfree(dspp);\n}\n\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}