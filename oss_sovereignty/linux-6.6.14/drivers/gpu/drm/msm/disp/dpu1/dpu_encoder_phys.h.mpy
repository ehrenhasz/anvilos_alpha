{
  "module_name": "dpu_encoder_phys.h",
  "hash_id": "9caae1bc38cc5c62c49343a2facdd63a488dd066aafd0f5d7f119e545a2bb947",
  "original_prompt": "Ingested from linux-6.6.14/drivers/gpu/drm/msm/disp/dpu1/dpu_encoder_phys.h",
  "human_readable_source": " \n \n\n#ifndef __DPU_ENCODER_PHYS_H__\n#define __DPU_ENCODER_PHYS_H__\n\n#include <drm/drm_writeback.h>\n#include <linux/jiffies.h>\n\n#include \"dpu_kms.h\"\n#include \"dpu_hw_intf.h\"\n#include \"dpu_hw_wb.h\"\n#include \"dpu_hw_pingpong.h\"\n#include \"dpu_hw_ctl.h\"\n#include \"dpu_hw_top.h\"\n#include \"dpu_encoder.h\"\n#include \"dpu_crtc.h\"\n\n#define DPU_ENCODER_NAME_MAX\t16\n\n \n#define KICKOFF_TIMEOUT_MS\t\t84\n#define KICKOFF_TIMEOUT_JIFFIES\t\tmsecs_to_jiffies(KICKOFF_TIMEOUT_MS)\n\n \nenum dpu_enc_split_role {\n\tENC_ROLE_SOLO,\n\tENC_ROLE_MASTER,\n\tENC_ROLE_SLAVE,\n};\n\n \nenum dpu_enc_enable_state {\n\tDPU_ENC_DISABLING,\n\tDPU_ENC_DISABLED,\n\tDPU_ENC_ENABLING,\n\tDPU_ENC_ENABLED,\n\tDPU_ENC_ERR_NEEDS_HW_RESET\n};\n\nstruct dpu_encoder_phys;\n\n \n\nstruct dpu_encoder_phys_ops {\n\tvoid (*prepare_commit)(struct dpu_encoder_phys *encoder);\n\tbool (*is_master)(struct dpu_encoder_phys *encoder);\n\tvoid (*atomic_mode_set)(struct dpu_encoder_phys *encoder,\n\t\t\tstruct drm_crtc_state *crtc_state,\n\t\t\tstruct drm_connector_state *conn_state);\n\tvoid (*enable)(struct dpu_encoder_phys *encoder);\n\tvoid (*disable)(struct dpu_encoder_phys *encoder);\n\tint (*atomic_check)(struct dpu_encoder_phys *encoder,\n\t\t\t    struct drm_crtc_state *crtc_state,\n\t\t\t    struct drm_connector_state *conn_state);\n\tvoid (*destroy)(struct dpu_encoder_phys *encoder);\n\tint (*control_vblank_irq)(struct dpu_encoder_phys *enc, bool enable);\n\tint (*wait_for_commit_done)(struct dpu_encoder_phys *phys_enc);\n\tint (*wait_for_tx_complete)(struct dpu_encoder_phys *phys_enc);\n\tint (*wait_for_vblank)(struct dpu_encoder_phys *phys_enc);\n\tvoid (*prepare_for_kickoff)(struct dpu_encoder_phys *phys_enc);\n\tvoid (*handle_post_kickoff)(struct dpu_encoder_phys *phys_enc);\n\tvoid (*trigger_start)(struct dpu_encoder_phys *phys_enc);\n\tbool (*needs_single_flush)(struct dpu_encoder_phys *phys_enc);\n\tvoid (*irq_control)(struct dpu_encoder_phys *phys, bool enable);\n\tvoid (*prepare_idle_pc)(struct dpu_encoder_phys *phys_enc);\n\tvoid (*restore)(struct dpu_encoder_phys *phys);\n\tint (*get_line_count)(struct dpu_encoder_phys *phys);\n\tint (*get_frame_count)(struct dpu_encoder_phys *phys);\n\tvoid (*prepare_wb_job)(struct dpu_encoder_phys *phys_enc,\n\t\t\tstruct drm_writeback_job *job);\n\tvoid (*cleanup_wb_job)(struct dpu_encoder_phys *phys_enc,\n\t\t\tstruct drm_writeback_job *job);\n\tbool (*is_valid_for_commit)(struct dpu_encoder_phys *phys_enc);\n};\n\n \nenum dpu_intr_idx {\n\tINTR_IDX_VSYNC,\n\tINTR_IDX_PINGPONG,\n\tINTR_IDX_UNDERRUN,\n\tINTR_IDX_CTL_START,\n\tINTR_IDX_RDPTR,\n\tINTR_IDX_WB_DONE,\n\tINTR_IDX_MAX,\n};\n\n \nstruct dpu_encoder_phys {\n\tstruct drm_encoder *parent;\n\tstruct dpu_encoder_phys_ops ops;\n\tstruct dpu_hw_mdp *hw_mdptop;\n\tstruct dpu_hw_ctl *hw_ctl;\n\tstruct dpu_hw_pingpong *hw_pp;\n\tstruct dpu_hw_intf *hw_intf;\n\tstruct dpu_hw_wb *hw_wb;\n\tstruct dpu_kms *dpu_kms;\n\tstruct drm_display_mode cached_mode;\n\tenum dpu_enc_split_role split_role;\n\tenum dpu_intf_mode intf_mode;\n\tspinlock_t *enc_spinlock;\n\tenum dpu_enc_enable_state enable_state;\n\tatomic_t vblank_refcount;\n\tatomic_t vsync_cnt;\n\tatomic_t underrun_cnt;\n\tatomic_t pending_ctlstart_cnt;\n\tatomic_t pending_kickoff_cnt;\n\twait_queue_head_t pending_kickoff_wq;\n\tint irq[INTR_IDX_MAX];\n\tbool has_intf_te;\n};\n\nstatic inline int dpu_encoder_phys_inc_pending(struct dpu_encoder_phys *phys)\n{\n\tatomic_inc_return(&phys->pending_ctlstart_cnt);\n\treturn atomic_inc_return(&phys->pending_kickoff_cnt);\n}\n\n \nstruct dpu_encoder_phys_wb {\n\tstruct dpu_encoder_phys base;\n\tatomic_t wbirq_refcount;\n\tint wb_done_timeout_cnt;\n\tstruct dpu_hw_wb_cfg wb_cfg;\n\tstruct drm_writeback_connector *wb_conn;\n\tstruct drm_writeback_job *wb_job;\n\tstruct dpu_hw_fmt_layout dest;\n};\n\n \nstruct dpu_encoder_phys_cmd {\n\tstruct dpu_encoder_phys base;\n\tint stream_sel;\n\tbool serialize_wait4pp;\n\tint pp_timeout_report_cnt;\n\tatomic_t pending_vblank_cnt;\n\twait_queue_head_t pending_vblank_wq;\n};\n\n \nstruct dpu_enc_phys_init_params {\n\tstruct dpu_kms *dpu_kms;\n\tstruct drm_encoder *parent;\n\tenum dpu_enc_split_role split_role;\n\tstruct dpu_hw_intf *hw_intf;\n\tstruct dpu_hw_wb *hw_wb;\n\tspinlock_t *enc_spinlock;\n};\n\n \nstruct dpu_encoder_wait_info {\n\twait_queue_head_t *wq;\n\tatomic_t *atomic_cnt;\n\ts64 timeout_ms;\n};\n\n \nstruct dpu_encoder_phys *dpu_encoder_phys_vid_init(\n\t\tstruct dpu_enc_phys_init_params *p);\n\n \nstruct dpu_encoder_phys *dpu_encoder_phys_cmd_init(\n\t\tstruct dpu_enc_phys_init_params *p);\n\n \nstruct dpu_encoder_phys *dpu_encoder_phys_wb_init(\n\t\tstruct dpu_enc_phys_init_params *p);\n\n \nvoid dpu_encoder_helper_trigger_start(struct dpu_encoder_phys *phys_enc);\n\nstatic inline enum dpu_3d_blend_mode dpu_encoder_helper_get_3d_blend_mode(\n\t\tstruct dpu_encoder_phys *phys_enc)\n{\n\tstruct dpu_crtc_state *dpu_cstate;\n\n\tif (!phys_enc || phys_enc->enable_state == DPU_ENC_DISABLING)\n\t\treturn BLEND_3D_NONE;\n\n\tdpu_cstate = to_dpu_crtc_state(phys_enc->parent->crtc->state);\n\n\t \n\tif (phys_enc->split_role == ENC_ROLE_SOLO &&\n\t    dpu_cstate->num_mixers == CRTC_DUAL_MIXERS &&\n\t    !dpu_encoder_use_dsc_merge(phys_enc->parent))\n\t\treturn BLEND_3D_H_ROW_INT;\n\n\treturn BLEND_3D_NONE;\n}\n\n \nunsigned int dpu_encoder_helper_get_dsc(struct dpu_encoder_phys *phys_enc);\n\n \nvoid dpu_encoder_helper_split_config(\n\t\tstruct dpu_encoder_phys *phys_enc,\n\t\tenum dpu_intf interface);\n\n \nvoid dpu_encoder_helper_report_irq_timeout(struct dpu_encoder_phys *phys_enc,\n\t\tenum dpu_intr_idx intr_idx);\n\n \nint dpu_encoder_helper_wait_for_irq(struct dpu_encoder_phys *phys_enc,\n\t\tint irq,\n\t\tvoid (*func)(void *arg, int irq_idx),\n\t\tstruct dpu_encoder_wait_info *wait_info);\n\n \nvoid dpu_encoder_helper_phys_cleanup(struct dpu_encoder_phys *phys_enc);\n\n \nvoid dpu_encoder_vblank_callback(struct drm_encoder *drm_enc,\n\t\t\t\t struct dpu_encoder_phys *phy_enc);\n\n \nvoid dpu_encoder_underrun_callback(struct drm_encoder *drm_enc,\n\t\t\t\t   struct dpu_encoder_phys *phy_enc);\n\n \nvoid dpu_encoder_frame_done_callback(\n\t\tstruct drm_encoder *drm_enc,\n\t\tstruct dpu_encoder_phys *ready_phys, u32 event);\n\nvoid dpu_encoder_phys_init(struct dpu_encoder_phys *phys,\n\t\t\t   struct dpu_enc_phys_init_params *p);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}