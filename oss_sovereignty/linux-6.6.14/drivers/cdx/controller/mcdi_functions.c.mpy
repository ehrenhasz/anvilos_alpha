{
  "module_name": "mcdi_functions.c",
  "hash_id": "0700ae710cf8b3a65361b6631032f77cef75c722cea32a4103ade7e3ae61d6fc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/cdx/controller/mcdi_functions.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n\n#include \"mcdi.h\"\n#include \"mcdi_functions.h\"\n\nint cdx_mcdi_get_num_buses(struct cdx_mcdi *cdx)\n{\n\tMCDI_DECLARE_BUF(outbuf, MC_CMD_CDX_BUS_ENUM_BUSES_OUT_LEN);\n\tsize_t outlen;\n\tint ret;\n\n\tret = cdx_mcdi_rpc(cdx, MC_CMD_CDX_BUS_ENUM_BUSES, NULL, 0,\n\t\t\t   outbuf, sizeof(outbuf), &outlen);\n\tif (ret)\n\t\treturn ret;\n\n\tif (outlen != MC_CMD_CDX_BUS_ENUM_BUSES_OUT_LEN)\n\t\treturn -EIO;\n\n\treturn MCDI_DWORD(outbuf, CDX_BUS_ENUM_BUSES_OUT_BUS_COUNT);\n}\n\nint cdx_mcdi_get_num_devs(struct cdx_mcdi *cdx, int bus_num)\n{\n\tMCDI_DECLARE_BUF(outbuf, MC_CMD_CDX_BUS_ENUM_DEVICES_OUT_LEN);\n\tMCDI_DECLARE_BUF(inbuf, MC_CMD_CDX_BUS_ENUM_DEVICES_IN_LEN);\n\tsize_t outlen;\n\tint ret;\n\n\tMCDI_SET_DWORD(inbuf, CDX_BUS_ENUM_DEVICES_IN_BUS, bus_num);\n\n\tret = cdx_mcdi_rpc(cdx, MC_CMD_CDX_BUS_ENUM_DEVICES, inbuf, sizeof(inbuf),\n\t\t\t   outbuf, sizeof(outbuf), &outlen);\n\tif (ret)\n\t\treturn ret;\n\n\tif (outlen != MC_CMD_CDX_BUS_ENUM_DEVICES_OUT_LEN)\n\t\treturn -EIO;\n\n\treturn MCDI_DWORD(outbuf, CDX_BUS_ENUM_DEVICES_OUT_DEVICE_COUNT);\n}\n\nint cdx_mcdi_get_dev_config(struct cdx_mcdi *cdx,\n\t\t\t    u8 bus_num, u8 dev_num,\n\t\t\t    struct cdx_dev_params *dev_params)\n{\n\tMCDI_DECLARE_BUF(outbuf, MC_CMD_CDX_BUS_GET_DEVICE_CONFIG_OUT_LEN);\n\tMCDI_DECLARE_BUF(inbuf, MC_CMD_CDX_BUS_GET_DEVICE_CONFIG_IN_LEN);\n\tstruct resource *res = &dev_params->res[0];\n\tsize_t outlen;\n\tu32 req_id;\n\tint ret;\n\n\tMCDI_SET_DWORD(inbuf, CDX_BUS_GET_DEVICE_CONFIG_IN_BUS, bus_num);\n\tMCDI_SET_DWORD(inbuf, CDX_BUS_GET_DEVICE_CONFIG_IN_DEVICE, dev_num);\n\n\tret = cdx_mcdi_rpc(cdx, MC_CMD_CDX_BUS_GET_DEVICE_CONFIG, inbuf, sizeof(inbuf),\n\t\t\t   outbuf, sizeof(outbuf), &outlen);\n\tif (ret)\n\t\treturn ret;\n\n\tif (outlen != MC_CMD_CDX_BUS_GET_DEVICE_CONFIG_OUT_LEN)\n\t\treturn -EIO;\n\n\tdev_params->bus_num = bus_num;\n\tdev_params->dev_num = dev_num;\n\n\treq_id = MCDI_DWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_REQUESTER_ID);\n\tdev_params->req_id = req_id;\n\n\tdev_params->res_count = 0;\n\tif (MCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION0_SIZE) != 0) {\n\t\tres[dev_params->res_count].start =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION0_BASE);\n\t\tres[dev_params->res_count].end =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION0_BASE) +\n\t\t\t\t   MCDI_QWORD(outbuf,\n\t\t\t\t\t      CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION0_SIZE) - 1;\n\t\tres[dev_params->res_count].flags = IORESOURCE_MEM;\n\t\tdev_params->res_count++;\n\t}\n\n\tif (MCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION1_SIZE) != 0) {\n\t\tres[dev_params->res_count].start =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION1_BASE);\n\t\tres[dev_params->res_count].end =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION1_BASE) +\n\t\t\t\t   MCDI_QWORD(outbuf,\n\t\t\t\t\t      CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION1_SIZE) - 1;\n\t\tres[dev_params->res_count].flags = IORESOURCE_MEM;\n\t\tdev_params->res_count++;\n\t}\n\n\tif (MCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION2_SIZE) != 0) {\n\t\tres[dev_params->res_count].start =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION2_BASE);\n\t\tres[dev_params->res_count].end =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION2_BASE) +\n\t\t\t\t   MCDI_QWORD(outbuf,\n\t\t\t\t\t      CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION2_SIZE) - 1;\n\t\tres[dev_params->res_count].flags = IORESOURCE_MEM;\n\t\tdev_params->res_count++;\n\t}\n\n\tif (MCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION3_SIZE) != 0) {\n\t\tres[dev_params->res_count].start =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION3_BASE);\n\t\tres[dev_params->res_count].end =\n\t\t\tMCDI_QWORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION3_BASE) +\n\t\t\t\t   MCDI_QWORD(outbuf,\n\t\t\t\t\t      CDX_BUS_GET_DEVICE_CONFIG_OUT_MMIO_REGION3_SIZE) - 1;\n\t\tres[dev_params->res_count].flags = IORESOURCE_MEM;\n\t\tdev_params->res_count++;\n\t}\n\n\tdev_params->vendor = MCDI_WORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_VENDOR_ID);\n\tdev_params->device = MCDI_WORD(outbuf, CDX_BUS_GET_DEVICE_CONFIG_OUT_DEVICE_ID);\n\n\treturn 0;\n}\n\nint cdx_mcdi_reset_device(struct cdx_mcdi *cdx, u8 bus_num, u8 dev_num)\n{\n\tMCDI_DECLARE_BUF(inbuf, MC_CMD_CDX_DEVICE_RESET_IN_LEN);\n\tint ret;\n\n\tMCDI_SET_DWORD(inbuf, CDX_DEVICE_RESET_IN_BUS, bus_num);\n\tMCDI_SET_DWORD(inbuf, CDX_DEVICE_RESET_IN_DEVICE, dev_num);\n\n\tret = cdx_mcdi_rpc(cdx, MC_CMD_CDX_DEVICE_RESET, inbuf, sizeof(inbuf),\n\t\t\t   NULL, 0, NULL);\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}