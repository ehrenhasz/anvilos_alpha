{
  "module_name": "mtip32xx.h",
  "hash_id": "f52ef094917878d886429074661301496b4f0342f2a06827b40c958a22f0cd28",
  "original_prompt": "Ingested from linux-6.6.14/drivers/block/mtip32xx/mtip32xx.h",
  "human_readable_source": " \n \n\n#ifndef __MTIP32XX_H__\n#define __MTIP32XX_H__\n\n#include <linux/spinlock.h>\n#include <linux/rwsem.h>\n#include <linux/ata.h>\n#include <linux/interrupt.h>\n\n \n#define PCI_SUBSYSTEM_DEVICEID\t0x2E\n\n \n#define PCIE_CONFIG_EXT_DEVICE_CONTROL_OFFSET\t0x48\n\n \n#define MTIP_SEC_ERASE_MODE     0x2\n\n \n#define MTIP_MAX_RETRIES\t2\n\n \n#define MTIP_NCQ_CMD_TIMEOUT_MS      15000\n#define MTIP_IOCTL_CMD_TIMEOUT_MS    5000\n#define MTIP_INT_CMD_TIMEOUT_MS      5000\n#define MTIP_QUIESCE_IO_TIMEOUT_MS   (MTIP_NCQ_CMD_TIMEOUT_MS * \\\n\t\t\t\t     (MTIP_MAX_RETRIES + 1))\n\n \n#define MTIP_TIMEOUT_CHECK_PERIOD\t500\n\n \n#define MTIP_FTL_REBUILD_OFFSET\t\t142\n#define MTIP_FTL_REBUILD_MAGIC\t\t0xED51\n#define MTIP_FTL_REBUILD_TIMEOUT_MS\t2400000\n\n \n#define MTIP_MAX_UNALIGNED_SLOTS\t2\n\n \n#define MTIP_TAG_BIT(tag)\t(tag & 0x1F)\n\n \n#define MTIP_TAG_INDEX(tag)\t(tag >> 5)\n\n \n#define MTIP_MAX_SG\t\t504\n\n \n#define MTIP_MAX_SLOT_GROUPS\t8\n\n \n#define MTIP_TAG_INTERNAL\t0\n\n \n#define PCI_VENDOR_ID_MICRON    0x1344\n#define P320H_DEVICE_ID\t\t0x5150\n#define P320M_DEVICE_ID\t\t0x5151\n#define P320S_DEVICE_ID\t\t0x5152\n#define P325M_DEVICE_ID\t\t0x5153\n#define P420H_DEVICE_ID\t\t0x5160\n#define P420M_DEVICE_ID\t\t0x5161\n#define P425M_DEVICE_ID\t\t0x5163\n\n \n#define MTIP_DRV_NAME\t\t\"mtip32xx\"\n#define MTIP_DRV_VERSION\t\"1.3.1\"\n\n \n#define MTIP_MAX_MINORS\t\t16\n\n \n#define MTIP_MAX_COMMAND_SLOTS\t(MTIP_MAX_SLOT_GROUPS * 32)\n\n \n#define U32_PER_LONG\t(sizeof(long) / sizeof(u32))\n#define SLOTBITS_IN_LONGS ((MTIP_MAX_SLOT_GROUPS + \\\n\t\t\t\t\t(U32_PER_LONG-1))/U32_PER_LONG)\n\n \n#define MTIP_ABAR\t\t5\n\n#ifdef DEBUG\n #define dbg_printk(format, arg...)\t\\\n\tprintk(pr_fmt(format), ##arg);\n#else\n #define dbg_printk(format, arg...)\n#endif\n\n#define MTIP_DFS_MAX_BUF_SIZE 1024\n\nenum {\n\t \n\tMTIP_PF_IC_ACTIVE_BIT       = 0,  \n\tMTIP_PF_EH_ACTIVE_BIT       = 1,  \n\tMTIP_PF_SE_ACTIVE_BIT       = 2,  \n\tMTIP_PF_DM_ACTIVE_BIT       = 3,  \n\tMTIP_PF_TO_ACTIVE_BIT       = 9,  \n\tMTIP_PF_PAUSE_IO      =\t((1 << MTIP_PF_IC_ACTIVE_BIT) |\n\t\t\t\t(1 << MTIP_PF_EH_ACTIVE_BIT) |\n\t\t\t\t(1 << MTIP_PF_SE_ACTIVE_BIT) |\n\t\t\t\t(1 << MTIP_PF_DM_ACTIVE_BIT) |\n\t\t\t\t(1 << MTIP_PF_TO_ACTIVE_BIT)),\n\tMTIP_PF_HOST_CAP_64         = 10,  \n\n\tMTIP_PF_SVC_THD_ACTIVE_BIT  = 4,\n\tMTIP_PF_ISSUE_CMDS_BIT      = 5,\n\tMTIP_PF_REBUILD_BIT         = 6,\n\tMTIP_PF_SVC_THD_STOP_BIT    = 8,\n\n\tMTIP_PF_SVC_THD_WORK\t= ((1 << MTIP_PF_EH_ACTIVE_BIT) |\n\t\t\t\t  (1 << MTIP_PF_ISSUE_CMDS_BIT) |\n\t\t\t\t  (1 << MTIP_PF_REBUILD_BIT) |\n\t\t\t\t  (1 << MTIP_PF_SVC_THD_STOP_BIT) |\n\t\t\t\t  (1 << MTIP_PF_TO_ACTIVE_BIT)),\n\n\t \n\tMTIP_DDF_SEC_LOCK_BIT\t    = 0,\n\tMTIP_DDF_REMOVE_PENDING_BIT = 1,\n\tMTIP_DDF_OVER_TEMP_BIT      = 2,\n\tMTIP_DDF_WRITE_PROTECT_BIT  = 3,\n\tMTIP_DDF_CLEANUP_BIT        = 5,\n\tMTIP_DDF_RESUME_BIT         = 6,\n\tMTIP_DDF_INIT_DONE_BIT      = 7,\n\tMTIP_DDF_REBUILD_FAILED_BIT = 8,\n\n\tMTIP_DDF_STOP_IO      = ((1 << MTIP_DDF_REMOVE_PENDING_BIT) |\n\t\t\t\t(1 << MTIP_DDF_SEC_LOCK_BIT) |\n\t\t\t\t(1 << MTIP_DDF_OVER_TEMP_BIT) |\n\t\t\t\t(1 << MTIP_DDF_WRITE_PROTECT_BIT) |\n\t\t\t\t(1 << MTIP_DDF_REBUILD_FAILED_BIT)),\n\n};\n\nstruct smart_attr {\n\tu8 attr_id;\n\t__le16 flags;\n\tu8 cur;\n\tu8 worst;\n\t__le32 data;\n\tu8 res[3];\n} __packed;\n\nstruct mtip_work {\n\tstruct work_struct work;\n\tvoid *port;\n\tint cpu_binding;\n\tu32 completed;\n} ____cacheline_aligned_in_smp;\n\n#define DEFINE_HANDLER(group)                                  \\\n\tvoid mtip_workq_sdbf##group(struct work_struct *work)       \\\n\t{                                                      \\\n\t\tstruct mtip_work *w = (struct mtip_work *) work;         \\\n\t\tmtip_workq_sdbfx(w->port, group, w->completed);     \\\n\t}\n\n \nstruct host_to_dev_fis {\n\t \n\tunsigned char type;\n\tunsigned char opts;\n\tunsigned char command;\n\tunsigned char features;\n\n\tunion {\n\t\tunsigned char lba_low;\n\t\tunsigned char sector;\n\t};\n\tunion {\n\t\tunsigned char lba_mid;\n\t\tunsigned char cyl_low;\n\t};\n\tunion {\n\t\tunsigned char lba_hi;\n\t\tunsigned char cyl_hi;\n\t};\n\tunion {\n\t\tunsigned char device;\n\t\tunsigned char head;\n\t};\n\n\tunion {\n\t\tunsigned char lba_low_ex;\n\t\tunsigned char sector_ex;\n\t};\n\tunion {\n\t\tunsigned char lba_mid_ex;\n\t\tunsigned char cyl_low_ex;\n\t};\n\tunion {\n\t\tunsigned char lba_hi_ex;\n\t\tunsigned char cyl_hi_ex;\n\t};\n\tunsigned char features_ex;\n\n\tunsigned char sect_count;\n\tunsigned char sect_cnt_ex;\n\tunsigned char res2;\n\tunsigned char control;\n\n\tunsigned int res3;\n};\n\n \nstruct mtip_cmd_hdr {\n\t \n\t__le32 opts;\n\t \n\tunion {\n\t\t__le32 byte_count;\n\t\t__le32 status;\n\t};\n\t \n\t__le32 ctba;\n\t \n\t__le32 ctbau;\n\t \n\tu32 res[4];\n};\n\n \nstruct mtip_cmd_sg {\n\t \n\t__le32 dba;\n\t \n\t__le32 dba_upper;\n\t \n\t__le32 reserved;\n\t \n\t__le32 info;\n};\nstruct mtip_port;\n\nstruct mtip_int_cmd;\n\n \nstruct mtip_cmd {\n\tvoid *command;  \n\n\tdma_addr_t command_dma;  \n\n\tint scatter_ents;  \n\n\tint unaligned;  \n\n\tunion {\n\t\tstruct scatterlist sg[MTIP_MAX_SG];  \n\t\tstruct mtip_int_cmd *icmd;\n\t};\n\n\tint retries;  \n\n\tint direction;  \n\tblk_status_t status;\n};\n\n \nstruct mtip_port {\n\t \n\tstruct driver_data *dd;\n\t \n\tunsigned long identify_valid;\n\t \n\tvoid __iomem *mmio;\n\t \n\tvoid __iomem *s_active[MTIP_MAX_SLOT_GROUPS];\n\t \n\tvoid __iomem *completed[MTIP_MAX_SLOT_GROUPS];\n\t \n\tvoid __iomem *cmd_issue[MTIP_MAX_SLOT_GROUPS];\n\t \n\tvoid *command_list;\n\t \n\tdma_addr_t command_list_dma;\n\t \n\tvoid *rxfis;\n\t \n\tdma_addr_t rxfis_dma;\n\t \n\tvoid *block1;\n\t \n\tdma_addr_t block1_dma;\n\t \n\tu16 *identify;\n\t \n\tdma_addr_t identify_dma;\n\t \n\tu16 *sector_buffer;\n\t \n\tdma_addr_t sector_buffer_dma;\n\n\tu16 *log_buf;\n\tdma_addr_t log_buf_dma;\n\n\tu8 *smart_buf;\n\tdma_addr_t smart_buf_dma;\n\n\t \n\tunsigned long cmds_to_issue[SLOTBITS_IN_LONGS];\n\t \n\twait_queue_head_t svc_wait;\n\t \n\tunsigned long flags;\n\t \n\tunsigned long ic_pause_timer;\n\n\t \n\tatomic_t cmd_slot_unal;\n\n\t \n\tspinlock_t cmd_issue_lock[MTIP_MAX_SLOT_GROUPS];\n};\n\n \nstruct driver_data {\n\tvoid __iomem *mmio;  \n\n\tint major;  \n\n\tint instance;  \n\n\tstruct gendisk *disk;  \n\n\tstruct pci_dev *pdev;  \n\n\tstruct request_queue *queue;  \n\n\tstruct blk_mq_tag_set tags;  \n\n\tstruct mtip_port *port;  \n\n\tunsigned product_type;  \n\n\tunsigned slot_groups;  \n\n\tunsigned long index;  \n\n\tunsigned long dd_flag;  \n\n\tstruct task_struct *mtip_svc_handler;  \n\n\tstruct dentry *dfs_node;\n\n\tbool sr;\n\n\tint numa_node;  \n\n\tchar workq_name[32];\n\n\tstruct workqueue_struct *isr_workq;\n\n\tatomic_t irq_workers_active;\n\n\tstruct mtip_work work[MTIP_MAX_SLOT_GROUPS];\n\n\tint isr_binding;\n\n\tint unal_qdepth;  \n};\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}