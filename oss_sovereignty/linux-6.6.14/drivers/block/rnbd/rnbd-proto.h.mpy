{
  "module_name": "rnbd-proto.h",
  "hash_id": "9a317cec74d5f64d0b28b0d28b6310be03d57ba0a2ff5f258d4f56ab4675ee8d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/block/rnbd/rnbd-proto.h",
  "human_readable_source": " \n \n#ifndef RNBD_PROTO_H\n#define RNBD_PROTO_H\n\n#include <linux/types.h>\n#include <linux/blk-mq.h>\n#include <linux/limits.h>\n#include <linux/inet.h>\n#include <linux/in.h>\n#include <linux/in6.h>\n#include <rdma/ib.h>\n\n#define RNBD_PROTO_VER_MAJOR 2\n#define RNBD_PROTO_VER_MINOR 0\n\n \n#define RTRS_PORT 1234\n\n \nenum rnbd_msg_type {\n\tRNBD_MSG_SESS_INFO,\n\tRNBD_MSG_SESS_INFO_RSP,\n\tRNBD_MSG_OPEN,\n\tRNBD_MSG_OPEN_RSP,\n\tRNBD_MSG_IO,\n\tRNBD_MSG_CLOSE,\n};\n\n \nstruct rnbd_msg_hdr {\n\t__le16\t\ttype;\n\t__le16\t\t__padding;\n};\n\n \nenum rnbd_access_mode {\n\tRNBD_ACCESS_RO,\n\tRNBD_ACCESS_RW,\n\tRNBD_ACCESS_MIGRATION,\n};\n\nstatic const __maybe_unused struct {\n\tenum rnbd_access_mode mode;\n\tconst char *str;\n} rnbd_access_modes[] = {\n\t[RNBD_ACCESS_RO] = {RNBD_ACCESS_RO, \"ro\"},\n\t[RNBD_ACCESS_RW] = {RNBD_ACCESS_RW, \"rw\"},\n\t[RNBD_ACCESS_MIGRATION] = {RNBD_ACCESS_MIGRATION, \"migration\"},\n};\n\n \nstruct rnbd_msg_sess_info {\n\tstruct rnbd_msg_hdr hdr;\n\tu8\t\tver;\n\tu8\t\treserved[31];\n};\n\n \nstruct rnbd_msg_sess_info_rsp {\n\tstruct rnbd_msg_hdr hdr;\n\tu8\t\tver;\n\tu8\t\treserved[31];\n};\n\n \nstruct rnbd_msg_open {\n\tstruct rnbd_msg_hdr hdr;\n\tu8\t\taccess_mode;\n\tu8\t\tresv1;\n\ts8\t\tdev_name[NAME_MAX];\n\tu8\t\treserved[3];\n};\n\n \nstruct rnbd_msg_close {\n\tstruct rnbd_msg_hdr hdr;\n\t__le32\t\tdevice_id;\n};\n\nenum rnbd_cache_policy {\n\tRNBD_FUA = 1 << 0,\n\tRNBD_WRITEBACK = 1 << 1,\n};\n\n \nstruct rnbd_msg_open_rsp {\n\tstruct rnbd_msg_hdr\thdr;\n\t__le32\t\t\tdevice_id;\n\t__le64\t\t\tnsectors;\n\t__le32\t\t\tmax_hw_sectors;\n\t__le32\t\t\tmax_write_same_sectors;\n\t__le32\t\t\tmax_discard_sectors;\n\t__le32\t\t\tdiscard_granularity;\n\t__le32\t\t\tdiscard_alignment;\n\t__le16\t\t\tphysical_block_size;\n\t__le16\t\t\tlogical_block_size;\n\t__le16\t\t\tmax_segments;\n\t__le16\t\t\tsecure_discard;\n\tu8\t\t\tobsolete_rotational;\n\tu8\t\t\tcache_policy;\n\tu8\t\t\treserved[10];\n};\n\n \nstruct rnbd_msg_io {\n\tstruct rnbd_msg_hdr hdr;\n\t__le32\t\tdevice_id;\n\t__le64\t\tsector;\n\t__le32\t\trw;\n\t__le32\t\tbi_size;\n\t__le16\t\tprio;\n};\n\n#define RNBD_OP_BITS  8\n#define RNBD_OP_MASK  ((1 << RNBD_OP_BITS) - 1)\n\n \nenum rnbd_io_flags {\n\n\t \n\tRNBD_OP_READ\t\t= 0,\n\tRNBD_OP_WRITE\t\t= 1,\n\tRNBD_OP_FLUSH\t\t= 2,\n\tRNBD_OP_DISCARD\t= 3,\n\tRNBD_OP_SECURE_ERASE\t= 4,\n\tRNBD_OP_WRITE_SAME\t= 5,\n\n\t \n\tRNBD_F_SYNC  = 1<<(RNBD_OP_BITS + 0),\n\tRNBD_F_FUA   = 1<<(RNBD_OP_BITS + 1),\n};\n\nstatic inline u32 rnbd_op(u32 flags)\n{\n\treturn flags & RNBD_OP_MASK;\n}\n\nstatic inline u32 rnbd_flags(u32 flags)\n{\n\treturn flags & ~RNBD_OP_MASK;\n}\n\nstatic inline blk_opf_t rnbd_to_bio_flags(u32 rnbd_opf)\n{\n\tblk_opf_t bio_opf;\n\n\tswitch (rnbd_op(rnbd_opf)) {\n\tcase RNBD_OP_READ:\n\t\tbio_opf = REQ_OP_READ;\n\t\tbreak;\n\tcase RNBD_OP_WRITE:\n\t\tbio_opf = REQ_OP_WRITE;\n\t\tbreak;\n\tcase RNBD_OP_FLUSH:\n\t\tbio_opf = REQ_OP_WRITE | REQ_PREFLUSH;\n\t\tbreak;\n\tcase RNBD_OP_DISCARD:\n\t\tbio_opf = REQ_OP_DISCARD;\n\t\tbreak;\n\tcase RNBD_OP_SECURE_ERASE:\n\t\tbio_opf = REQ_OP_SECURE_ERASE;\n\t\tbreak;\n\tdefault:\n\t\tWARN(1, \"Unknown RNBD type: %d (flags %d)\\n\",\n\t\t     rnbd_op(rnbd_opf), rnbd_opf);\n\t\tbio_opf = 0;\n\t}\n\n\tif (rnbd_opf & RNBD_F_SYNC)\n\t\tbio_opf |= REQ_SYNC;\n\n\tif (rnbd_opf & RNBD_F_FUA)\n\t\tbio_opf |= REQ_FUA;\n\n\treturn bio_opf;\n}\n\nstatic inline u32 rq_to_rnbd_flags(struct request *rq)\n{\n\tu32 rnbd_opf;\n\n\tswitch (req_op(rq)) {\n\tcase REQ_OP_READ:\n\t\trnbd_opf = RNBD_OP_READ;\n\t\tbreak;\n\tcase REQ_OP_WRITE:\n\t\trnbd_opf = RNBD_OP_WRITE;\n\t\tbreak;\n\tcase REQ_OP_DISCARD:\n\t\trnbd_opf = RNBD_OP_DISCARD;\n\t\tbreak;\n\tcase REQ_OP_SECURE_ERASE:\n\t\trnbd_opf = RNBD_OP_SECURE_ERASE;\n\t\tbreak;\n\tcase REQ_OP_FLUSH:\n\t\trnbd_opf = RNBD_OP_FLUSH;\n\t\tbreak;\n\tdefault:\n\t\tWARN(1, \"Unknown request type %d (flags %llu)\\n\",\n\t\t     (__force u32)req_op(rq),\n\t\t     (__force unsigned long long)rq->cmd_flags);\n\t\trnbd_opf = 0;\n\t}\n\n\tif (op_is_sync(rq->cmd_flags))\n\t\trnbd_opf |= RNBD_F_SYNC;\n\n\tif (op_is_flush(rq->cmd_flags))\n\t\trnbd_opf |= RNBD_F_FUA;\n\n\treturn rnbd_opf;\n}\n\nconst char *rnbd_access_mode_str(enum rnbd_access_mode mode);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}