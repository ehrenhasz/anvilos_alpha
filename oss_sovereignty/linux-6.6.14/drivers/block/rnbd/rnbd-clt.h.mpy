{
  "module_name": "rnbd-clt.h",
  "hash_id": "de8430ef033a1cb979f64bbabbe4b8d72700cd7f53efc9f24bd71667e2b3bb29",
  "original_prompt": "Ingested from linux-6.6.14/drivers/block/rnbd/rnbd-clt.h",
  "human_readable_source": " \n \n\n#ifndef RNBD_CLT_H\n#define RNBD_CLT_H\n\n#include <linux/wait.h>\n#include <linux/in.h>\n#include <linux/inet.h>\n#include <linux/blk-mq.h>\n#include <linux/refcount.h>\n\n#include <rtrs.h>\n#include \"rnbd-proto.h\"\n#include \"rnbd-log.h\"\n\n \n#define RECONNECT_DELAY 30\n \n#define MAX_RECONNECTS -1\n\nenum rnbd_clt_dev_state {\n\tDEV_STATE_INIT,\n\tDEV_STATE_MAPPED,\n\tDEV_STATE_MAPPED_DISCONNECTED,\n\tDEV_STATE_UNMAPPED,\n};\n\nstruct rnbd_iu_comp {\n\twait_queue_head_t wait;\n\tint errno;\n};\n\n#ifdef CONFIG_ARCH_NO_SG_CHAIN\n#define RNBD_INLINE_SG_CNT 0\n#else\n#define RNBD_INLINE_SG_CNT 2\n#endif\n#define RNBD_RDMA_SGL_SIZE (sizeof(struct scatterlist) * RNBD_INLINE_SG_CNT)\n\nstruct rnbd_iu {\n\tunion {\n\t\tstruct request *rq;  \n\t\tvoid *buf;  \n\t};\n\tstruct rtrs_permit\t*permit;\n\tunion {\n\t\t \n\t\tstruct rnbd_clt_dev *dev;\n\t\t \n\t\tstruct rnbd_clt_session *sess;\n\t};\n\tstruct sg_table\t\tsgt;\n\tstruct work_struct\twork;\n\tint\t\t\terrno;\n\tstruct rnbd_iu_comp\tcomp;\n\tatomic_t\t\trefcount;\n\tstruct scatterlist\tfirst_sgl[];  \n};\n\nstruct rnbd_cpu_qlist {\n\tstruct list_head\trequeue_list;\n\tspinlock_t\t\trequeue_lock;\n\tunsigned int\t\tcpu;\n};\n\nstruct rnbd_clt_session {\n\tstruct list_head        list;\n\tstruct rtrs_clt_sess        *rtrs;\n\twait_queue_head_t       rtrs_waitq;\n\tbool                    rtrs_ready;\n\tstruct rnbd_cpu_qlist\t__percpu\n\t\t\t\t*cpu_queues;\n\tDECLARE_BITMAP(cpu_queues_bm, NR_CPUS);\n\tint\t__percpu\t*cpu_rr;  \n\tatomic_t\t\tbusy;\n\tsize_t\t\t\tqueue_depth;\n\tu32\t\t\tmax_io_size;\n\tu32\t\t\tmax_segments;\n\tstruct blk_mq_tag_set\ttag_set;\n\tu32\t\t\tnr_poll_queues;\n\tstruct mutex\t\tlock;  \n\tstruct list_head        devs_list;  \n\trefcount_t\t\trefcount;\n\tchar\t\t\tsessname[NAME_MAX];\n\tu8\t\t\tver;  \n};\n\n \nstruct rnbd_queue {\n\tstruct list_head\trequeue_list;\n\tunsigned long\t\tin_list;\n\tstruct rnbd_clt_dev\t*dev;\n\tstruct blk_mq_hw_ctx\t*hctx;\n};\n\nstruct rnbd_clt_dev {\n\tstruct kobject\t\tkobj;\n\tstruct rnbd_clt_session\t*sess;\n\tstruct request_queue\t*queue;\n\tstruct rnbd_queue\t*hw_queues;\n\tu32\t\t\tdevice_id;\n\t \n\tu32\t\t\tclt_device_id;\n\tstruct mutex\t\tlock;\n\tenum rnbd_clt_dev_state\tdev_state;\n\trefcount_t\t\trefcount;\n\tchar\t\t\t*pathname;\n\tenum rnbd_access_mode\taccess_mode;\n\tu32\t\t\tnr_poll_queues;\n\tu64\t\t\tsize;\t\t \n\tstruct list_head        list;\n\tstruct gendisk\t\t*gd;\n\tchar\t\t\t*blk_symlink_name;\n\tstruct work_struct\tunmap_on_rmmod_work;\n};\n\n \n\nstruct rnbd_clt_dev *rnbd_clt_map_device(const char *sessname,\n\t\t\t\t\t   struct rtrs_addr *paths,\n\t\t\t\t\t   size_t path_cnt, u16 port_nr,\n\t\t\t\t\t   const char *pathname,\n\t\t\t\t\t   enum rnbd_access_mode access_mode,\n\t\t\t\t\t   u32 nr_poll_queues);\nint rnbd_clt_unmap_device(struct rnbd_clt_dev *dev, bool force,\n\t\t\t   const struct attribute *sysfs_self);\n\nint rnbd_clt_remap_device(struct rnbd_clt_dev *dev);\nint rnbd_clt_resize_disk(struct rnbd_clt_dev *dev, sector_t newsize);\n\n \n\nint rnbd_clt_create_sysfs_files(void);\n\nvoid rnbd_clt_destroy_sysfs_files(void);\n\nvoid rnbd_clt_remove_dev_symlink(struct rnbd_clt_dev *dev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}