{
  "module_name": "controller.h",
  "hash_id": "35d29b412b2f96e3d368ef0a69222a34c0cd629fa925fb6afcd34ff24a8b3e3b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/surface/aggregator/controller.h",
  "human_readable_source": " \n \n\n#ifndef _SURFACE_AGGREGATOR_CONTROLLER_H\n#define _SURFACE_AGGREGATOR_CONTROLLER_H\n\n#include <linux/kref.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/rbtree.h>\n#include <linux/rwsem.h>\n#include <linux/serdev.h>\n#include <linux/spinlock.h>\n#include <linux/srcu.h>\n#include <linux/types.h>\n#include <linux/workqueue.h>\n\n#include <linux/surface_aggregator/controller.h>\n#include <linux/surface_aggregator/serial_hub.h>\n\n#include \"ssh_request_layer.h\"\n\n\n \n\n \nstruct ssh_seq_counter {\n\tu8 value;\n};\n\n \nstruct ssh_rqid_counter {\n\tu16 value;\n};\n\n\n \n\n \nstruct ssam_nf_head {\n\tstruct srcu_struct srcu;\n\tstruct list_head head;\n};\n\n \nstruct ssam_nf {\n\tstruct mutex lock;\n\tstruct rb_root refcount;\n\tstruct ssam_nf_head head[SSH_NUM_EVENTS];\n};\n\n\n \n\nstruct ssam_cplt;\n\n \nstruct ssam_event_item {\n\tstruct list_head node;\n\tu16 rqid;\n\n\tstruct {\n\t\tvoid (*free)(struct ssam_event_item *event);\n\t} ops;\n\n\tstruct ssam_event event;\t \n};\n\n \nstruct ssam_event_queue {\n\tstruct ssam_cplt *cplt;\n\n\tspinlock_t lock;\n\tstruct list_head head;\n\tstruct work_struct work;\n};\n\n \nstruct ssam_event_target {\n\tstruct ssam_event_queue queue[SSH_NUM_EVENTS];\n};\n\n \nstruct ssam_cplt {\n\tstruct device *dev;\n\tstruct workqueue_struct *wq;\n\n\tstruct {\n\t\tstruct ssam_event_target target[SSH_NUM_TARGETS];\n\t\tstruct ssam_nf notif;\n\t} event;\n};\n\n\n \n\n \nenum ssam_controller_state {\n\tSSAM_CONTROLLER_UNINITIALIZED,\n\tSSAM_CONTROLLER_INITIALIZED,\n\tSSAM_CONTROLLER_STARTED,\n\tSSAM_CONTROLLER_STOPPED,\n\tSSAM_CONTROLLER_SUSPENDED,\n};\n\n \nstruct ssam_controller_caps {\n\tu32 ssh_power_profile;\n\tu32 ssh_buffer_size;\n\tu32 screen_on_sleep_idle_timeout;\n\tu32 screen_off_sleep_idle_timeout;\n\tu32 d3_closes_handle:1;\n};\n\n \nstruct ssam_controller {\n\tstruct kref kref;\n\n\tstruct rw_semaphore lock;\n\tenum ssam_controller_state state;\n\n\tstruct ssh_rtl rtl;\n\tstruct ssam_cplt cplt;\n\n\tstruct {\n\t\tstruct ssh_seq_counter seq;\n\t\tstruct ssh_rqid_counter rqid;\n\t} counter;\n\n\tstruct {\n\t\tint num;\n\t\tbool wakeup_enabled;\n\t} irq;\n\n\tstruct ssam_controller_caps caps;\n};\n\n#define to_ssam_controller(ptr, member) \\\n\tcontainer_of(ptr, struct ssam_controller, member)\n\n#define ssam_dbg(ctrl, fmt, ...)  rtl_dbg(&(ctrl)->rtl, fmt, ##__VA_ARGS__)\n#define ssam_info(ctrl, fmt, ...) rtl_info(&(ctrl)->rtl, fmt, ##__VA_ARGS__)\n#define ssam_warn(ctrl, fmt, ...) rtl_warn(&(ctrl)->rtl, fmt, ##__VA_ARGS__)\n#define ssam_err(ctrl, fmt, ...)  rtl_err(&(ctrl)->rtl, fmt, ##__VA_ARGS__)\n\n \nstatic inline\nint ssam_controller_receive_buf(struct ssam_controller *ctrl,\n\t\t\t\tconst unsigned char *buf, size_t n)\n{\n\treturn ssh_ptl_rx_rcvbuf(&ctrl->rtl.ptl, buf, n);\n}\n\n \nstatic inline void ssam_controller_write_wakeup(struct ssam_controller *ctrl)\n{\n\tssh_ptl_tx_wakeup_transfer(&ctrl->rtl.ptl);\n}\n\nint ssam_controller_init(struct ssam_controller *ctrl, struct serdev_device *s);\nint ssam_controller_start(struct ssam_controller *ctrl);\nvoid ssam_controller_shutdown(struct ssam_controller *ctrl);\nvoid ssam_controller_destroy(struct ssam_controller *ctrl);\n\nint ssam_notifier_disable_registered(struct ssam_controller *ctrl);\nvoid ssam_notifier_restore_registered(struct ssam_controller *ctrl);\n\nint ssam_irq_setup(struct ssam_controller *ctrl);\nvoid ssam_irq_free(struct ssam_controller *ctrl);\nint ssam_irq_arm_for_wakeup(struct ssam_controller *ctrl);\nvoid ssam_irq_disarm_wakeup(struct ssam_controller *ctrl);\n\nvoid ssam_controller_lock(struct ssam_controller *c);\nvoid ssam_controller_unlock(struct ssam_controller *c);\n\nint ssam_get_firmware_version(struct ssam_controller *ctrl, u32 *version);\nint ssam_ctrl_notif_display_off(struct ssam_controller *ctrl);\nint ssam_ctrl_notif_display_on(struct ssam_controller *ctrl);\nint ssam_ctrl_notif_d0_exit(struct ssam_controller *ctrl);\nint ssam_ctrl_notif_d0_entry(struct ssam_controller *ctrl);\n\nint ssam_controller_suspend(struct ssam_controller *ctrl);\nint ssam_controller_resume(struct ssam_controller *ctrl);\n\nint ssam_event_item_cache_init(void);\nvoid ssam_event_item_cache_destroy(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}