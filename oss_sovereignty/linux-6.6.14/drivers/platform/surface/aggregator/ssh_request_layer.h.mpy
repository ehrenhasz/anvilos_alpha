{
  "module_name": "ssh_request_layer.h",
  "hash_id": "c2ac8624444b1308daff6282e6ffcec3a870869f8ef27fe29dc6ad3c59fcea1c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/surface/aggregator/ssh_request_layer.h",
  "human_readable_source": " \n \n\n#ifndef _SURFACE_AGGREGATOR_SSH_REQUEST_LAYER_H\n#define _SURFACE_AGGREGATOR_SSH_REQUEST_LAYER_H\n\n#include <linux/atomic.h>\n#include <linux/ktime.h>\n#include <linux/list.h>\n#include <linux/spinlock.h>\n#include <linux/workqueue.h>\n\n#include <linux/surface_aggregator/serial_hub.h>\n#include <linux/surface_aggregator/controller.h>\n\n#include \"ssh_packet_layer.h\"\n\n \nenum ssh_rtl_state_flags {\n\tSSH_RTL_SF_SHUTDOWN_BIT,\n};\n\n \nstruct ssh_rtl_ops {\n\tvoid (*handle_event)(struct ssh_rtl *rtl, const struct ssh_command *cmd,\n\t\t\t     const struct ssam_span *data);\n};\n\n \nstruct ssh_rtl {\n\tstruct ssh_ptl ptl;\n\tunsigned long state;\n\n\tstruct {\n\t\tspinlock_t lock;\n\t\tstruct list_head head;\n\t} queue;\n\n\tstruct {\n\t\tspinlock_t lock;\n\t\tstruct list_head head;\n\t\tatomic_t count;\n\t} pending;\n\n\tstruct {\n\t\tstruct work_struct work;\n\t} tx;\n\n\tstruct {\n\t\tspinlock_t lock;\n\t\tktime_t timeout;\n\t\tktime_t expires;\n\t\tstruct delayed_work reaper;\n\t} rtx_timeout;\n\n\tstruct ssh_rtl_ops ops;\n};\n\n#define rtl_dbg(r, fmt, ...)  ptl_dbg(&(r)->ptl, fmt, ##__VA_ARGS__)\n#define rtl_info(p, fmt, ...) ptl_info(&(p)->ptl, fmt, ##__VA_ARGS__)\n#define rtl_warn(r, fmt, ...) ptl_warn(&(r)->ptl, fmt, ##__VA_ARGS__)\n#define rtl_err(r, fmt, ...)  ptl_err(&(r)->ptl, fmt, ##__VA_ARGS__)\n#define rtl_dbg_cond(r, fmt, ...) __ssam_prcond(rtl_dbg, r, fmt, ##__VA_ARGS__)\n\n#define to_ssh_rtl(ptr, member) \\\n\tcontainer_of(ptr, struct ssh_rtl, member)\n\n \nstatic inline struct device *ssh_rtl_get_device(struct ssh_rtl *rtl)\n{\n\treturn ssh_ptl_get_device(&rtl->ptl);\n}\n\n \nstatic inline struct ssh_rtl *ssh_request_rtl(struct ssh_request *rqst)\n{\n\tstruct ssh_ptl *ptl;\n\n\tptl = READ_ONCE(rqst->packet.ptl);\n\treturn likely(ptl) ? to_ssh_rtl(ptl, ptl) : NULL;\n}\n\nint ssh_rtl_submit(struct ssh_rtl *rtl, struct ssh_request *rqst);\nbool ssh_rtl_cancel(struct ssh_request *rqst, bool pending);\n\nint ssh_rtl_init(struct ssh_rtl *rtl, struct serdev_device *serdev,\n\t\t const struct ssh_rtl_ops *ops);\n\nint ssh_rtl_start(struct ssh_rtl *rtl);\nint ssh_rtl_flush(struct ssh_rtl *rtl, unsigned long timeout);\nvoid ssh_rtl_shutdown(struct ssh_rtl *rtl);\nvoid ssh_rtl_destroy(struct ssh_rtl *rtl);\n\nint ssh_request_init(struct ssh_request *rqst, enum ssam_request_flags flags,\n\t\t     const struct ssh_request_ops *ops);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}