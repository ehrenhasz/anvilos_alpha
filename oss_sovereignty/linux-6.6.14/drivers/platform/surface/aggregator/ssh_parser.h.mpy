{
  "module_name": "ssh_parser.h",
  "hash_id": "39108bb4cbe19078a5d62198c7783cecdbb5dcb8e32b114b7679f2ecf2b45492",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/surface/aggregator/ssh_parser.h",
  "human_readable_source": " \n \n\n#ifndef _SURFACE_AGGREGATOR_SSH_PARSER_H\n#define _SURFACE_AGGREGATOR_SSH_PARSER_H\n\n#include <linux/device.h>\n#include <linux/kfifo.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n\n#include <linux/surface_aggregator/serial_hub.h>\n\n \nstruct sshp_buf {\n\tu8    *ptr;\n\tsize_t len;\n\tsize_t cap;\n};\n\n \nstatic inline void sshp_buf_init(struct sshp_buf *buf, u8 *ptr, size_t cap)\n{\n\tbuf->ptr = ptr;\n\tbuf->len = 0;\n\tbuf->cap = cap;\n}\n\n \nstatic inline int sshp_buf_alloc(struct sshp_buf *buf, size_t cap, gfp_t flags)\n{\n\tu8 *ptr;\n\n\tptr = kzalloc(cap, flags);\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\n\tsshp_buf_init(buf, ptr, cap);\n\treturn 0;\n}\n\n \nstatic inline void sshp_buf_free(struct sshp_buf *buf)\n{\n\tkfree(buf->ptr);\n\tbuf->ptr = NULL;\n\tbuf->len = 0;\n\tbuf->cap = 0;\n}\n\n \nstatic inline void sshp_buf_drop(struct sshp_buf *buf, size_t n)\n{\n\tmemmove(buf->ptr, buf->ptr + n, buf->len - n);\n\tbuf->len -= n;\n}\n\n \nstatic inline size_t sshp_buf_read_from_fifo(struct sshp_buf *buf,\n\t\t\t\t\t     struct kfifo *fifo)\n{\n\tsize_t n;\n\n\tn =  kfifo_out(fifo, buf->ptr + buf->len, buf->cap - buf->len);\n\tbuf->len += n;\n\n\treturn n;\n}\n\n \nstatic inline void sshp_buf_span_from(struct sshp_buf *buf, size_t offset,\n\t\t\t\t      struct ssam_span *span)\n{\n\tspan->ptr = buf->ptr + offset;\n\tspan->len = buf->len - offset;\n}\n\nbool sshp_find_syn(const struct ssam_span *src, struct ssam_span *rem);\n\nint sshp_parse_frame(const struct device *dev, const struct ssam_span *source,\n\t\t     struct ssh_frame **frame, struct ssam_span *payload,\n\t\t     size_t maxlen);\n\nint sshp_parse_command(const struct device *dev, const struct ssam_span *source,\n\t\t       struct ssh_command **command,\n\t\t       struct ssam_span *command_data);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}