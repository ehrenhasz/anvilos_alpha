{
  "module_name": "surface_aggregator_registry.c",
  "hash_id": "9172a3889cb4456e40c7968d2d7152b65e62dc61bd3c4cf9f5e161ff7392c67c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/surface/surface_aggregator_registry.c",
  "human_readable_source": "\n \n\n#include <linux/acpi.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/property.h>\n#include <linux/types.h>\n\n#include <linux/surface_aggregator/device.h>\n\n\n \n\n \n\n \nstatic const struct software_node ssam_node_root = {\n\t.name = \"ssam_platform_hub\",\n};\n\n \nstatic const struct software_node ssam_node_hub_kip = {\n\t.name = \"ssam:00:00:01:0e:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hub_base = {\n\t.name = \"ssam:00:00:01:11:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_bat_ac = {\n\t.name = \"ssam:01:02:01:01:01\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_bat_main = {\n\t.name = \"ssam:01:02:01:01:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_bat_sb3base = {\n\t.name = \"ssam:01:02:02:01:00\",\n\t.parent = &ssam_node_hub_base,\n};\n\n \nstatic const struct software_node ssam_node_tmp_pprof = {\n\t.name = \"ssam:01:03:01:00:01\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_kip_tablet_switch = {\n\t.name = \"ssam:01:0e:01:00:01\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_bas_dtx = {\n\t.name = \"ssam:01:11:01:00:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_sam_keyboard = {\n\t.name = \"ssam:01:15:01:01:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_sam_penstash = {\n\t.name = \"ssam:01:15:01:02:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_sam_touchpad = {\n\t.name = \"ssam:01:15:01:03:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_sam_sensors = {\n\t.name = \"ssam:01:15:01:06:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_sam_ucm_ucsi = {\n\t.name = \"ssam:01:15:01:07:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_sam_sysctrl = {\n\t.name = \"ssam:01:15:01:08:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_main_keyboard = {\n\t.name = \"ssam:01:15:02:01:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_main_touchpad = {\n\t.name = \"ssam:01:15:02:03:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_main_iid5 = {\n\t.name = \"ssam:01:15:02:05:00\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node ssam_node_hid_base_keyboard = {\n\t.name = \"ssam:01:15:02:01:00\",\n\t.parent = &ssam_node_hub_base,\n};\n\n \nstatic const struct software_node ssam_node_hid_base_touchpad = {\n\t.name = \"ssam:01:15:02:03:00\",\n\t.parent = &ssam_node_hub_base,\n};\n\n \nstatic const struct software_node ssam_node_hid_base_iid5 = {\n\t.name = \"ssam:01:15:02:05:00\",\n\t.parent = &ssam_node_hub_base,\n};\n\n \nstatic const struct software_node ssam_node_hid_base_iid6 = {\n\t.name = \"ssam:01:15:02:06:00\",\n\t.parent = &ssam_node_hub_base,\n};\n\n \nstatic const struct software_node ssam_node_hid_kip_keyboard = {\n\t.name = \"ssam:01:15:02:01:00\",\n\t.parent = &ssam_node_hub_kip,\n};\n\n \nstatic const struct software_node ssam_node_hid_kip_penstash = {\n\t.name = \"ssam:01:15:02:02:00\",\n\t.parent = &ssam_node_hub_kip,\n};\n\n \nstatic const struct software_node ssam_node_hid_kip_touchpad = {\n\t.name = \"ssam:01:15:02:03:00\",\n\t.parent = &ssam_node_hub_kip,\n};\n\n \nstatic const struct software_node ssam_node_hid_kip_fwupd = {\n\t.name = \"ssam:01:15:02:05:00\",\n\t.parent = &ssam_node_hub_kip,\n};\n\n \nstatic const struct software_node ssam_node_pos_tablet_switch = {\n\t.name = \"ssam:01:26:01:00:01\",\n\t.parent = &ssam_node_root,\n};\n\n \nstatic const struct software_node *ssam_node_group_gen5[] = {\n\t&ssam_node_root,\n\t&ssam_node_tmp_pprof,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_sb3[] = {\n\t&ssam_node_root,\n\t&ssam_node_hub_base,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_bat_sb3base,\n\t&ssam_node_tmp_pprof,\n\t&ssam_node_bas_dtx,\n\t&ssam_node_hid_base_keyboard,\n\t&ssam_node_hid_base_touchpad,\n\t&ssam_node_hid_base_iid5,\n\t&ssam_node_hid_base_iid6,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_sl3[] = {\n\t&ssam_node_root,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_tmp_pprof,\n\t&ssam_node_hid_main_keyboard,\n\t&ssam_node_hid_main_touchpad,\n\t&ssam_node_hid_main_iid5,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_sl5[] = {\n\t&ssam_node_root,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_tmp_pprof,\n\t&ssam_node_hid_main_keyboard,\n\t&ssam_node_hid_main_touchpad,\n\t&ssam_node_hid_main_iid5,\n\t&ssam_node_hid_sam_ucm_ucsi,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_sls[] = {\n\t&ssam_node_root,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_tmp_pprof,\n\t&ssam_node_pos_tablet_switch,\n\t&ssam_node_hid_sam_keyboard,\n\t&ssam_node_hid_sam_penstash,\n\t&ssam_node_hid_sam_touchpad,\n\t&ssam_node_hid_sam_sensors,\n\t&ssam_node_hid_sam_ucm_ucsi,\n\t&ssam_node_hid_sam_sysctrl,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_slg1[] = {\n\t&ssam_node_root,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_tmp_pprof,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_sp7[] = {\n\t&ssam_node_root,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_tmp_pprof,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_sp8[] = {\n\t&ssam_node_root,\n\t&ssam_node_hub_kip,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_tmp_pprof,\n\t&ssam_node_kip_tablet_switch,\n\t&ssam_node_hid_kip_keyboard,\n\t&ssam_node_hid_kip_penstash,\n\t&ssam_node_hid_kip_touchpad,\n\t&ssam_node_hid_kip_fwupd,\n\t&ssam_node_hid_sam_sensors,\n\t&ssam_node_hid_sam_ucm_ucsi,\n\tNULL,\n};\n\n \nstatic const struct software_node *ssam_node_group_sp9[] = {\n\t&ssam_node_root,\n\t&ssam_node_hub_kip,\n\t&ssam_node_bat_ac,\n\t&ssam_node_bat_main,\n\t&ssam_node_tmp_pprof,\n\t&ssam_node_pos_tablet_switch,\n\t&ssam_node_hid_kip_keyboard,\n\t&ssam_node_hid_kip_penstash,\n\t&ssam_node_hid_kip_touchpad,\n\t&ssam_node_hid_kip_fwupd,\n\t&ssam_node_hid_sam_sensors,\n\t&ssam_node_hid_sam_ucm_ucsi,\n\tNULL,\n};\n\n\n \n\nstatic const struct acpi_device_id ssam_platform_hub_match[] = {\n\t \n\t{ \"MSHW0081\", (unsigned long)ssam_node_group_gen5 },\n\n\t \n\t{ \"MSHW0111\", (unsigned long)ssam_node_group_gen5 },\n\n\t \n\t{ \"MSHW0116\", (unsigned long)ssam_node_group_sp7 },\n\n\t \n\t{ \"MSHW0119\", (unsigned long)ssam_node_group_sp7 },\n\n\t \n\t{ \"MSHW0263\", (unsigned long)ssam_node_group_sp8 },\n\n\t \n\t{ \"MSHW0343\", (unsigned long)ssam_node_group_sp9 },\n\n\t \n\t{ \"MSHW0107\", (unsigned long)ssam_node_group_gen5 },\n\n\t \n\t{ \"MSHW0117\", (unsigned long)ssam_node_group_sb3 },\n\n\t \n\t{ \"MSHW0086\", (unsigned long)ssam_node_group_gen5 },\n\n\t \n\t{ \"MSHW0112\", (unsigned long)ssam_node_group_gen5 },\n\n\t \n\t{ \"MSHW0114\", (unsigned long)ssam_node_group_sl3 },\n\n\t \n\t{ \"MSHW0110\", (unsigned long)ssam_node_group_sl3 },\n\n\t \n\t{ \"MSHW0250\", (unsigned long)ssam_node_group_sl3 },\n\n\t \n\t{ \"MSHW0350\", (unsigned long)ssam_node_group_sl5 },\n\n\t \n\t{ \"MSHW0118\", (unsigned long)ssam_node_group_slg1 },\n\n\t \n\t{ \"MSHW0290\", (unsigned long)ssam_node_group_slg1 },\n\n\t \n\t{ \"MSHW0123\", (unsigned long)ssam_node_group_sls },\n\n\t{ },\n};\nMODULE_DEVICE_TABLE(acpi, ssam_platform_hub_match);\n\nstatic int ssam_platform_hub_probe(struct platform_device *pdev)\n{\n\tconst struct software_node **nodes;\n\tstruct ssam_controller *ctrl;\n\tstruct fwnode_handle *root;\n\tint status;\n\n\tnodes = (const struct software_node **)acpi_device_get_match_data(&pdev->dev);\n\tif (!nodes)\n\t\treturn -ENODEV;\n\n\t \n\tctrl = ssam_client_bind(&pdev->dev);\n\tif (IS_ERR(ctrl))\n\t\treturn PTR_ERR(ctrl) == -ENODEV ? -EPROBE_DEFER : PTR_ERR(ctrl);\n\n\tstatus = software_node_register_node_group(nodes);\n\tif (status)\n\t\treturn status;\n\n\troot = software_node_fwnode(&ssam_node_root);\n\tif (!root) {\n\t\tsoftware_node_unregister_node_group(nodes);\n\t\treturn -ENOENT;\n\t}\n\n\tset_secondary_fwnode(&pdev->dev, root);\n\n\tstatus = __ssam_register_clients(&pdev->dev, ctrl, root);\n\tif (status) {\n\t\tset_secondary_fwnode(&pdev->dev, NULL);\n\t\tsoftware_node_unregister_node_group(nodes);\n\t}\n\n\tplatform_set_drvdata(pdev, nodes);\n\treturn status;\n}\n\nstatic int ssam_platform_hub_remove(struct platform_device *pdev)\n{\n\tconst struct software_node **nodes = platform_get_drvdata(pdev);\n\n\tssam_remove_clients(&pdev->dev);\n\tset_secondary_fwnode(&pdev->dev, NULL);\n\tsoftware_node_unregister_node_group(nodes);\n\treturn 0;\n}\n\nstatic struct platform_driver ssam_platform_hub_driver = {\n\t.probe = ssam_platform_hub_probe,\n\t.remove = ssam_platform_hub_remove,\n\t.driver = {\n\t\t.name = \"surface_aggregator_platform_hub\",\n\t\t.acpi_match_table = ssam_platform_hub_match,\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n};\nmodule_platform_driver(ssam_platform_hub_driver);\n\nMODULE_AUTHOR(\"Maximilian Luz <luzmaximilian@gmail.com>\");\nMODULE_DESCRIPTION(\"Device-registry for Surface System Aggregator Module\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}