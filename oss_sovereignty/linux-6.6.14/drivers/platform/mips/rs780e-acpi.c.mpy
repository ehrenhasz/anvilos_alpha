{
  "module_name": "rs780e-acpi.c",
  "hash_id": "575bd00a2190831e1051de5effb3dfe8b88d91460a91e1941b600a6eea539c66",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/mips/rs780e-acpi.c",
  "human_readable_source": "\n#include <linux/io.h>\n#include <linux/init.h>\n#include <linux/ioport.h>\n#include <linux/export.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n\nstatic unsigned long acpi_iobase;\n\n#define ACPI_PM_EVT_BLK         (acpi_iobase + 0x00)  \n#define ACPI_PM_CNT_BLK         (acpi_iobase + 0x04)  \n#define ACPI_PMA_CNT_BLK        (acpi_iobase + 0x0F)  \n#define ACPI_PM_TMR_BLK         (acpi_iobase + 0x18)  \n#define ACPI_GPE0_BLK           (acpi_iobase + 0x10)  \n#define ACPI_END                (acpi_iobase + 0x80)\n\n#define PM_INDEX        0xCD6\n#define PM_DATA         0xCD7\n#define PM2_INDEX       0xCD0\n#define PM2_DATA        0xCD1\n\nstatic void pmio_write_index(u16 index, u8 reg, u8 value)\n{\n\toutb(reg, index);\n\toutb(value, index + 1);\n}\n\nstatic u8 pmio_read_index(u16 index, u8 reg)\n{\n\toutb(reg, index);\n\treturn inb(index + 1);\n}\n\nvoid pm_iowrite(u8 reg, u8 value)\n{\n\tpmio_write_index(PM_INDEX, reg, value);\n}\nEXPORT_SYMBOL(pm_iowrite);\n\nu8 pm_ioread(u8 reg)\n{\n\treturn pmio_read_index(PM_INDEX, reg);\n}\nEXPORT_SYMBOL(pm_ioread);\n\nvoid pm2_iowrite(u8 reg, u8 value)\n{\n\tpmio_write_index(PM2_INDEX, reg, value);\n}\nEXPORT_SYMBOL(pm2_iowrite);\n\nu8 pm2_ioread(u8 reg)\n{\n\treturn pmio_read_index(PM2_INDEX, reg);\n}\nEXPORT_SYMBOL(pm2_ioread);\n\nstatic void acpi_hw_clear_status(void)\n{\n\tu16 value;\n\n\t \n\tvalue = inw(ACPI_PM_EVT_BLK);\n\tvalue |= (1 << 8 | 1 << 15);\n\toutw(value, ACPI_PM_EVT_BLK);\n\n\t \n\toutl(inl(ACPI_GPE0_BLK), ACPI_GPE0_BLK);\n}\n\nstatic void acpi_registers_setup(void)\n{\n\tu32 value;\n\n\t \n\tpm_iowrite(0x20, ACPI_PM_EVT_BLK & 0xff);\n\tpm_iowrite(0x21, ACPI_PM_EVT_BLK >> 8);\n\n\t \n\tpm_iowrite(0x22, ACPI_PM_CNT_BLK & 0xff);\n\tpm_iowrite(0x23, ACPI_PM_CNT_BLK >> 8);\n\n\t \n\tpm_iowrite(0x28, ACPI_GPE0_BLK & 0xff);\n\tpm_iowrite(0x29, ACPI_GPE0_BLK >> 8);\n\n\t \n\tpm_iowrite(0x2e, ACPI_END & 0xff);\n\tpm_iowrite(0x2f, ACPI_END >> 8);\n\n\t \n\tpm_iowrite(0x0e, 1 << 3);\n\n\t \n\toutw(1, ACPI_PM_CNT_BLK);\n\n\t \n\tpm_iowrite(0x10, pm_ioread(0x10) | 1);\n\n\t \n\tvalue = inl(ACPI_GPE0_BLK + 4);\n\toutl(value | (1 << 14) | (1 << 22), ACPI_GPE0_BLK + 4);\n\n\t \n\tpm_iowrite(0x8d, pm_ioread(0x8d) & (~(1 << 1)));\n\n\t \n\tpm_iowrite(0x94, pm_ioread(0x94) | (1 << 3));\n\n\t \n\tpm_iowrite(0x33, pm_ioread(0x33) & (~(3 << 4)));\n\n\t \n\tpm_iowrite(0x3d, pm_ioread(0x3d) & (~(3 << 2)));\n\n\t \n\tpm_iowrite(0x37, pm_ioread(0x37) & (~(1 << 6)));\n\n\t \n\tpm_iowrite(0x7c, pm_ioread(0x7c) | (1 << 6));\n\n\t \n\tvalue = pm2_ioread(0xf6);\n\tvalue |= ((1 << 7) | (1 << 3));\n\tpm2_iowrite(0xf6, value);\n\n\t \n\tvalue = pm2_ioread(0xf8);\n\tvalue |= ((1 << 5) | (1 << 1));\n\tpm2_iowrite(0xf8, value);\n}\n\nstatic int rs780e_acpi_probe(struct platform_device *pdev)\n{\n\tstruct resource *res;\n\n\tres = platform_get_resource(pdev, IORESOURCE_IO, 0);\n\tif (!res)\n\t\treturn -ENODEV;\n\n\t \n\tif (!request_region(res->start, resource_size(res), \"acpi\")) {\n\t\tpr_err(\"RS780E-ACPI: Failed to request IO Region\\n\");\n\t\treturn -EBUSY;\n\t}\n\n\tacpi_iobase = res->start;\n\n\tacpi_registers_setup();\n\tacpi_hw_clear_status();\n\n\treturn 0;\n}\n\nstatic const struct of_device_id rs780e_acpi_match[] = {\n\t{ .compatible = \"loongson,rs780e-acpi\" },\n\t{},\n};\n\nstatic struct platform_driver rs780e_acpi_driver = {\n\t.probe = rs780e_acpi_probe,\n\t.driver = {\n\t\t.name = \"RS780E-ACPI\",\n\t\t.of_match_table = rs780e_acpi_match,\n\t},\n};\nbuiltin_platform_driver(rs780e_acpi_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}