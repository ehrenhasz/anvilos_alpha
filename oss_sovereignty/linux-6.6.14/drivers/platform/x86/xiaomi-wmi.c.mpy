{
  "module_name": "xiaomi-wmi.c",
  "hash_id": "c77e05f38a694767c9c876fb4537514308341652d554befe32c314923ed5f7a6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/xiaomi-wmi.c",
  "human_readable_source": "\n \n\n#include <linux/acpi.h>\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/wmi.h>\n\n#include <uapi/linux/input-event-codes.h>\n\n#define XIAOMI_KEY_FN_ESC_0\t\"A2095CCE-0491-44E7-BA27-F8ED8F88AA86\"\n#define XIAOMI_KEY_FN_ESC_1\t\"7BBE8E39-B486-473D-BA13-66F75C5805CD\"\n#define XIAOMI_KEY_FN_FN\t\"409B028D-F06B-4C7C-8BBB-EE133A6BD87E\"\n#define XIAOMI_KEY_CAPSLOCK\t\"83FE7607-053A-4644-822A-21532C621FC7\"\n#define XIAOMI_KEY_FN_F7\t\"76E9027C-95D0-4180-8692-DA6747DD1C2D\"\n\n#define XIAOMI_DEVICE(guid, key)\t\t\\\n\t.guid_string = (guid),\t\t\t\\\n\t.context = &(const unsigned int){key}\n\nstruct xiaomi_wmi {\n\tstruct input_dev *input_dev;\n\tunsigned int key_code;\n};\n\nstatic int xiaomi_wmi_probe(struct wmi_device *wdev, const void *context)\n{\n\tstruct xiaomi_wmi *data;\n\n\tif (wdev == NULL || context == NULL)\n\t\treturn -EINVAL;\n\n\tdata = devm_kzalloc(&wdev->dev, sizeof(struct xiaomi_wmi), GFP_KERNEL);\n\tif (data == NULL)\n\t\treturn -ENOMEM;\n\tdev_set_drvdata(&wdev->dev, data);\n\n\tdata->input_dev = devm_input_allocate_device(&wdev->dev);\n\tif (data->input_dev == NULL)\n\t\treturn -ENOMEM;\n\tdata->input_dev->name = \"Xiaomi WMI keys\";\n\tdata->input_dev->phys = \"wmi/input0\";\n\n\tdata->key_code = *((const unsigned int *)context);\n\tset_bit(EV_KEY, data->input_dev->evbit);\n\tset_bit(data->key_code, data->input_dev->keybit);\n\n\treturn input_register_device(data->input_dev);\n}\n\nstatic void xiaomi_wmi_notify(struct wmi_device *wdev, union acpi_object *dummy)\n{\n\tstruct xiaomi_wmi *data;\n\n\tif (wdev == NULL)\n\t\treturn;\n\n\tdata = dev_get_drvdata(&wdev->dev);\n\tif (data == NULL)\n\t\treturn;\n\n\tinput_report_key(data->input_dev, data->key_code, 1);\n\tinput_sync(data->input_dev);\n\tinput_report_key(data->input_dev, data->key_code, 0);\n\tinput_sync(data->input_dev);\n}\n\nstatic const struct wmi_device_id xiaomi_wmi_id_table[] = {\n\t\n\t\n\t{ XIAOMI_DEVICE(XIAOMI_KEY_FN_FN, KEY_PROG1) },\n\t\n\t{ XIAOMI_DEVICE(XIAOMI_KEY_FN_F7, KEY_CUT) },\n\n\t \n\t{ }\n};\n\nstatic struct wmi_driver xiaomi_wmi_driver = {\n\t.driver = {\n\t\t.name = \"xiaomi-wmi\",\n\t},\n\t.id_table = xiaomi_wmi_id_table,\n\t.probe = xiaomi_wmi_probe,\n\t.notify = xiaomi_wmi_notify,\n};\nmodule_wmi_driver(xiaomi_wmi_driver);\n\nMODULE_DEVICE_TABLE(wmi, xiaomi_wmi_id_table);\nMODULE_AUTHOR(\"Mattias Jacobsson\");\nMODULE_DESCRIPTION(\"Xiaomi WMI driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}