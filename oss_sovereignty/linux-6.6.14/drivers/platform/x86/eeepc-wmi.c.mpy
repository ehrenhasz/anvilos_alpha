{
  "module_name": "eeepc-wmi.c",
  "hash_id": "fb6aa18dd87c27f429f991cd5745a39a4357ad79ddf2b38b68fe9e397c95e63b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/eeepc-wmi.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/input.h>\n#include <linux/input/sparse-keymap.h>\n#include <linux/dmi.h>\n#include <linux/fb.h>\n#include <linux/acpi.h>\n\n#include \"asus-wmi.h\"\n\n#define\tEEEPC_WMI_FILE\t\"eeepc-wmi\"\n\nMODULE_AUTHOR(\"Corentin Chary <corentin.chary@gmail.com>\");\nMODULE_DESCRIPTION(\"Eee PC WMI Hotkey Driver\");\nMODULE_LICENSE(\"GPL\");\n\n#define EEEPC_ACPI_HID\t\t\"ASUS010\"  \n\n#define EEEPC_WMI_EVENT_GUID\t\"ABBC0F72-8EA1-11D1-00A0-C90629100000\"\n\nMODULE_ALIAS(\"wmi:\"EEEPC_WMI_EVENT_GUID);\n\nstatic bool hotplug_wireless;\n\nmodule_param(hotplug_wireless, bool, 0444);\nMODULE_PARM_DESC(hotplug_wireless,\n\t\t \"Enable hotplug for wireless device. \"\n\t\t \"If your laptop needs that, please report to \"\n\t\t \"acpi4asus-user@lists.sourceforge.net.\");\n\n \n#define HOME_PRESS\t0xe4\n#define HOME_HOLD\t0xea\n#define HOME_RELEASE\t0xe5\n\nstatic const struct key_entry eeepc_wmi_keymap[] = {\n\t{ KE_KEY, ASUS_WMI_BRN_DOWN, { KEY_BRIGHTNESSDOWN } },\n\t{ KE_KEY, ASUS_WMI_BRN_UP, { KEY_BRIGHTNESSUP } },\n\t \n\t{ KE_KEY, 0x30, { KEY_VOLUMEUP } },\n\t{ KE_KEY, 0x31, { KEY_VOLUMEDOWN } },\n\t{ KE_KEY, 0x32, { KEY_MUTE } },\n\t{ KE_KEY, 0x5c, { KEY_F15 } },  \n\t{ KE_KEY, 0x5d, { KEY_WLAN } },\n\t{ KE_KEY, 0x6b, { KEY_TOUCHPAD_TOGGLE } },  \n\t{ KE_KEY, 0x82, { KEY_CAMERA } },\n\t{ KE_KEY, 0x83, { KEY_CAMERA_ZOOMIN } },\n\t{ KE_KEY, 0x88, { KEY_WLAN } },\n\t{ KE_KEY, 0xbd, { KEY_CAMERA } },\n\t{ KE_KEY, 0xcc, { KEY_SWITCHVIDEOMODE } },\n\t{ KE_KEY, 0xe0, { KEY_PROG1 } },  \n\t{ KE_KEY, 0xe1, { KEY_F14 } },  \n\t{ KE_KEY, HOME_PRESS, { KEY_CONFIG } },  \n\t{ KE_KEY, 0xe8, { KEY_SCREENLOCK } },\n\t{ KE_KEY, 0xe9, { KEY_DISPLAYTOGGLE } },\n\t{ KE_KEY, 0xeb, { KEY_CAMERA_ZOOMOUT } },\n\t{ KE_KEY, 0xec, { KEY_CAMERA_UP } },\n\t{ KE_KEY, 0xed, { KEY_CAMERA_DOWN } },\n\t{ KE_KEY, 0xee, { KEY_CAMERA_LEFT } },\n\t{ KE_KEY, 0xef, { KEY_CAMERA_RIGHT } },\n\t{ KE_KEY, 0xf3, { KEY_MENU } },\n\t{ KE_KEY, 0xf5, { KEY_HOMEPAGE } },\n\t{ KE_KEY, 0xf6, { KEY_ESC } },\n\t{ KE_END, 0},\n};\n\nstatic struct quirk_entry quirk_asus_unknown = {\n};\n\nstatic struct quirk_entry quirk_asus_1000h = {\n\t.hotplug_wireless = true,\n};\n\nstatic struct quirk_entry quirk_asus_et2012_type1 = {\n\t.store_backlight_power = true,\n};\n\nstatic struct quirk_entry quirk_asus_et2012_type3 = {\n\t.scalar_panel_brightness = true,\n\t.store_backlight_power = true,\n};\n\nstatic struct quirk_entry *quirks;\n\nstatic void et2012_quirks(void)\n{\n\tconst struct dmi_device *dev = NULL;\n\tchar oemstring[30];\n\n\twhile ((dev = dmi_find_device(DMI_DEV_TYPE_OEM_STRING, NULL, dev))) {\n\t\tif (sscanf(dev->name, \"AEMS%24c\", oemstring) == 1) {\n\t\t\tif (oemstring[18] == '1')\n\t\t\t\tquirks = &quirk_asus_et2012_type1;\n\t\t\telse if (oemstring[18] == '3')\n\t\t\t\tquirks = &quirk_asus_et2012_type3;\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nstatic int dmi_matched(const struct dmi_system_id *dmi)\n{\n\tchar *model;\n\n\tquirks = dmi->driver_data;\n\n\tmodel = (char *)dmi->matches[1].substr;\n\tif (unlikely(strncmp(model, \"ET2012\", 6) == 0))\n\t\tet2012_quirks();\n\n\treturn 1;\n}\n\nstatic const struct dmi_system_id asus_quirks[] = {\n\t{\n\t\t.callback = dmi_matched,\n\t\t.ident = \"ASUSTeK Computer INC. 1000H\",\n\t\t.matches = {\n\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer INC.\"),\n\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"1000H\"),\n\t\t},\n\t\t.driver_data = &quirk_asus_1000h,\n\t},\n\t{\n\t\t.callback = dmi_matched,\n\t\t.ident = \"ASUSTeK Computer INC. ET2012E/I\",\n\t\t.matches = {\n\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"ASUSTeK Computer INC.\"),\n\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"ET2012\"),\n\t\t},\n\t\t.driver_data = &quirk_asus_unknown,\n\t},\n\t{}\n};\n\nstatic void eeepc_wmi_key_filter(struct asus_wmi_driver *asus_wmi, int *code,\n\t\t\t\t unsigned int *value, bool *autorelease)\n{\n\tswitch (*code) {\n\tcase HOME_PRESS:\n\t\t*value = 1;\n\t\t*autorelease = 0;\n\t\tbreak;\n\tcase HOME_HOLD:\n\t\t*code = ASUS_WMI_KEY_IGNORE;\n\t\tbreak;\n\tcase HOME_RELEASE:\n\t\t*code = HOME_PRESS;\n\t\t*value = 0;\n\t\t*autorelease = 0;\n\t\tbreak;\n\t}\n}\n\nstatic int eeepc_wmi_probe(struct platform_device *pdev)\n{\n\tif (acpi_dev_found(EEEPC_ACPI_HID)) {\n\t\tpr_warn(\"Found legacy ATKD device (%s)\\n\", EEEPC_ACPI_HID);\n\t\tpr_warn(\"WMI device present, but legacy ATKD device is also \"\n\t\t\t\"present and enabled\\n\");\n\t\tpr_warn(\"You probably booted with acpi_osi=\\\"Linux\\\" or \"\n\t\t\t\"acpi_osi=\\\"!Windows 2009\\\"\\n\");\n\t\tpr_warn(\"Can't load eeepc-wmi, use default acpi_osi \"\n\t\t\t\"(preferred) or eeepc-laptop\\n\");\n\t\treturn -EBUSY;\n\t}\n\treturn 0;\n}\n\nstatic void eeepc_wmi_quirks(struct asus_wmi_driver *driver)\n{\n\tquirks = &quirk_asus_unknown;\n\tquirks->hotplug_wireless = hotplug_wireless;\n\n\tdmi_check_system(asus_quirks);\n\n\tdriver->quirks = quirks;\n\tdriver->quirks->wapf = -1;\n\tdriver->panel_power = FB_BLANK_UNBLANK;\n}\n\nstatic struct asus_wmi_driver asus_wmi_driver = {\n\t.name = EEEPC_WMI_FILE,\n\t.owner = THIS_MODULE,\n\t.event_guid = EEEPC_WMI_EVENT_GUID,\n\t.keymap = eeepc_wmi_keymap,\n\t.input_name = \"Eee PC WMI hotkeys\",\n\t.input_phys = EEEPC_WMI_FILE \"/input0\",\n\t.key_filter = eeepc_wmi_key_filter,\n\t.probe = eeepc_wmi_probe,\n\t.detect_quirks = eeepc_wmi_quirks,\n};\n\n\nstatic int __init eeepc_wmi_init(void)\n{\n\treturn asus_wmi_register_driver(&asus_wmi_driver);\n}\n\nstatic void __exit eeepc_wmi_exit(void)\n{\n\tasus_wmi_unregister_driver(&asus_wmi_driver);\n}\n\nmodule_init(eeepc_wmi_init);\nmodule_exit(eeepc_wmi_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}