{
  "module_name": "meraki-mx100.c",
  "hash_id": "28da28a951adacfa8b3037ab0a821d6a730dc1f9cb8d1389e4019b2a2f662e2c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/meraki-mx100.c",
  "human_readable_source": "\n\n \n\n#define pr_fmt(fmt)\tKBUILD_MODNAME \": \" fmt\n\n#include <linux/dmi.h>\n#include <linux/err.h>\n#include <linux/gpio_keys.h>\n#include <linux/gpio/machine.h>\n#include <linux/input.h>\n#include <linux/io.h>\n#include <linux/kernel.h>\n#include <linux/leds.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#define TINK_GPIO_DRIVER_NAME \"gpio_ich\"\n\n \nstatic const struct gpio_led tink_leds[] = {\n\t{\n\t\t.name = \"mx100:green:internet\",\n\t\t.default_trigger = \"default-on\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan2\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan3\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan4\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan5\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan6\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan7\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan8\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan9\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan10\",\n\t},\n\t{\n\t\t.name = \"mx100:green:lan11\",\n\t},\n\t{\n\t\t.name = \"mx100:green:ha\",\n\t},\n\t{\n\t\t.name = \"mx100:orange:ha\",\n\t},\n\t{\n\t\t.name = \"mx100:green:usb\",\n\t},\n\t{\n\t\t.name = \"mx100:orange:usb\",\n\t},\n};\n\nstatic const struct gpio_led_platform_data tink_leds_pdata = {\n\t.num_leds\t= ARRAY_SIZE(tink_leds),\n\t.leds\t\t= tink_leds,\n};\n\nstatic struct gpiod_lookup_table tink_leds_table = {\n\t.dev_id = \"leds-gpio\",\n\t.table = {\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 11,\n\t\t\t\tNULL, 0, GPIO_ACTIVE_LOW),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 18,\n\t\t\t\tNULL, 1, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 20,\n\t\t\t\tNULL, 2, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 22,\n\t\t\t\tNULL, 3, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 23,\n\t\t\t\tNULL, 4, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 32,\n\t\t\t\tNULL, 5, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 34,\n\t\t\t\tNULL, 6, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 35,\n\t\t\t\tNULL, 7, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 36,\n\t\t\t\tNULL, 8, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 37,\n\t\t\t\tNULL, 9, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 48,\n\t\t\t\tNULL, 10, GPIO_ACTIVE_HIGH),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 16,\n\t\t\t\tNULL, 11, GPIO_ACTIVE_LOW),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 7,\n\t\t\t\tNULL, 12, GPIO_ACTIVE_LOW),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 21,\n\t\t\t\tNULL, 13, GPIO_ACTIVE_LOW),\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 19,\n\t\t\t\tNULL, 14, GPIO_ACTIVE_LOW),\n\t\t{}  \n\t}\n};\n\n \nstatic struct gpio_keys_button tink_buttons[] = {\n\t{\n\t\t.desc\t\t\t= \"Reset\",\n\t\t.type\t\t\t= EV_KEY,\n\t\t.code\t\t\t= KEY_RESTART,\n\t\t.active_low             = 1,\n\t\t.debounce_interval      = 100,\n\t},\n};\n\nstatic const struct gpio_keys_platform_data tink_buttons_pdata = {\n\t.buttons\t= tink_buttons,\n\t.nbuttons\t= ARRAY_SIZE(tink_buttons),\n\t.poll_interval  = 20,\n\t.rep\t\t= 0,\n\t.name\t\t= \"mx100-keys\",\n};\n\nstatic struct gpiod_lookup_table tink_keys_table = {\n\t.dev_id = \"gpio-keys-polled\",\n\t.table = {\n\t\tGPIO_LOOKUP_IDX(TINK_GPIO_DRIVER_NAME, 60,\n\t\t\t\tNULL, 0, GPIO_ACTIVE_LOW),\n\t\t{}  \n\t}\n};\n\n \nstatic const struct dmi_system_id tink_systems[] __initconst = {\n\t{\n\t\t.matches = {\n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Cisco\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_NAME, \"MX100-HW\"),\n\t\t},\n\t},\n\t{}  \n};\nMODULE_DEVICE_TABLE(dmi, tink_systems);\n\nstatic struct platform_device *tink_leds_pdev;\nstatic struct platform_device *tink_keys_pdev;\n\nstatic struct platform_device * __init tink_create_dev(\n\tconst char *name, const void *pdata, size_t sz)\n{\n\tstruct platform_device *pdev;\n\n\tpdev = platform_device_register_data(NULL,\n\t\tname, PLATFORM_DEVID_NONE, pdata, sz);\n\tif (IS_ERR(pdev))\n\t\tpr_err(\"failed registering %s: %ld\\n\", name, PTR_ERR(pdev));\n\n\treturn pdev;\n}\n\nstatic int __init tink_board_init(void)\n{\n\tint ret;\n\n\tif (!dmi_first_match(tink_systems))\n\t\treturn -ENODEV;\n\n\t \n\toutl(inl(0x530) | BIT(28), 0x530);\n\n\tgpiod_add_lookup_table(&tink_leds_table);\n\tgpiod_add_lookup_table(&tink_keys_table);\n\n\ttink_leds_pdev = tink_create_dev(\"leds-gpio\",\n\t\t&tink_leds_pdata, sizeof(tink_leds_pdata));\n\tif (IS_ERR(tink_leds_pdev)) {\n\t\tret = PTR_ERR(tink_leds_pdev);\n\t\tgoto err;\n\t}\n\n\ttink_keys_pdev = tink_create_dev(\"gpio-keys-polled\",\n\t\t&tink_buttons_pdata, sizeof(tink_buttons_pdata));\n\tif (IS_ERR(tink_keys_pdev)) {\n\t\tret = PTR_ERR(tink_keys_pdev);\n\t\tplatform_device_unregister(tink_leds_pdev);\n\t\tgoto err;\n\t}\n\n\treturn 0;\n\nerr:\n\tgpiod_remove_lookup_table(&tink_keys_table);\n\tgpiod_remove_lookup_table(&tink_leds_table);\n\treturn ret;\n}\nmodule_init(tink_board_init);\n\nstatic void __exit tink_board_exit(void)\n{\n\tplatform_device_unregister(tink_keys_pdev);\n\tplatform_device_unregister(tink_leds_pdev);\n\tgpiod_remove_lookup_table(&tink_keys_table);\n\tgpiod_remove_lookup_table(&tink_leds_table);\n}\nmodule_exit(tink_board_exit);\n\nMODULE_AUTHOR(\"Chris Blake <chrisrblake93@gmail.com>\");\nMODULE_DESCRIPTION(\"Cisco Meraki MX100 Platform Driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:meraki-mx100\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}