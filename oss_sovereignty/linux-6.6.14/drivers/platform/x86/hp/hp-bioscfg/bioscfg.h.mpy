{
  "module_name": "bioscfg.h",
  "hash_id": "9d353de38b7d570e73c430556d1bc8dbea0b066ee4a2bb538a7d1985cbbcd60b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/hp/hp-bioscfg/bioscfg.h",
  "human_readable_source": " \n\n#ifndef _HP_BIOSCFG_H_\n#define _HP_BIOSCFG_H_\n\n#include <linux/wmi.h>\n#include <linux/types.h>\n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/nls.h>\n\n#define DRIVER_NAME\t\t\"hp-bioscfg\"\n\n#define MAX_BUFF_SIZE\t\t512\n#define MAX_KEY_MOD_SIZE\t256\n#define MAX_PASSWD_SIZE\t\t64\n#define MAX_PREREQUISITES_SIZE\t20\n#define MAX_REQ_ELEM_SIZE\t128\n#define MAX_VALUES_SIZE\t\t16\n#define MAX_ENCODINGS_SIZE\t16\n#define MAX_ELEMENTS_SIZE\t16\n\n#define SPM_STR_DESC\t\t\"Secure Platform Management\"\n#define SPM_STR\t\t\t\"SPM\"\n#define SURE_START_DESC\t\t\"Sure Start\"\n#define SURE_START_STR\t\t\"Sure_Start\"\n#define SETUP_PASSWD\t\t\"Setup Password\"\n#define POWER_ON_PASSWD\t\t\"Power-On Password\"\n\n#define LANG_CODE_STR\t\t\"en_US.UTF-8\"\n#define SCHEDULE_POWER_ON\t\"Scheduled Power-On\"\n\n#define COMMA_SEP\t\t\",\"\n#define SEMICOLON_SEP\t\t\";\"\n\n \n\n#define UTF_PREFIX\t\t\"<utf-16/>\"\n#define BEAM_PREFIX\t\t\"<BEAM/>\"\n\nenum mechanism_values {\n\tPASSWORD\t\t= 0x00,\n\tSIGNING_KEY\t\t= 0x01,\n\tENDORSEMENT_KEY\t\t= 0x02,\n};\n\n#define BIOS_ADMIN\t\t\"bios-admin\"\n#define POWER_ON\t\t\"power-on\"\n#define BIOS_SPM\t\t\"enhanced-bios-auth\"\n\n#define PASSWD_MECHANISM_TYPES \"password\"\n\n#define HP_WMI_BIOS_GUID\t\t\"5FB7F034-2C63-45e9-BE91-3D44E2C707E4\"\n\n#define HP_WMI_BIOS_STRING_GUID\t\t\"988D08E3-68F4-4c35-AF3E-6A1B8106F83C\"\n#define HP_WMI_BIOS_INTEGER_GUID\t\"8232DE3D-663D-4327-A8F4-E293ADB9BF05\"\n#define HP_WMI_BIOS_ENUMERATION_GUID\t\"2D114B49-2DFB-4130-B8FE-4A3C09E75133\"\n#define HP_WMI_BIOS_ORDERED_LIST_GUID\t\"14EA9746-CE1F-4098-A0E0-7045CB4DA745\"\n#define HP_WMI_BIOS_PASSWORD_GUID\t\"322F2028-0F84-4901-988E-015176049E2D\"\n#define HP_WMI_SET_BIOS_SETTING_GUID\t\"1F4C91EB-DC5C-460b-951D-C7CB9B4B8D5E\"\n\nenum hp_wmi_spm_commandtype {\n\tHPWMI_SECUREPLATFORM_GET_STATE  = 0x10,\n\tHPWMI_SECUREPLATFORM_SET_KEK\t= 0x11,\n\tHPWMI_SECUREPLATFORM_SET_SK\t= 0x12,\n};\n\nenum hp_wmi_surestart_commandtype {\n\tHPWMI_SURESTART_GET_LOG_COUNT\t= 0x01,\n\tHPWMI_SURESTART_GET_LOG\t\t= 0x02,\n};\n\nenum hp_wmi_command {\n\tHPWMI_READ\t\t= 0x01,\n\tHPWMI_WRITE\t\t= 0x02,\n\tHPWMI_ODM\t\t= 0x03,\n\tHPWMI_SURESTART\t\t= 0x20006,\n\tHPWMI_GM\t\t= 0x20008,\n\tHPWMI_SECUREPLATFORM\t= 0x20010,\n};\n\nstruct bios_return {\n\tu32 sigpass;\n\tu32 return_code;\n};\n\nenum wmi_error_values {\n\tSUCCESS\t\t\t\t= 0x00,\n\tCMD_FAILED\t\t\t= 0x01,\n\tINVALID_SIGN\t\t\t= 0x02,\n\tINVALID_CMD_VALUE\t\t= 0x03,\n\tINVALID_CMD_TYPE\t\t= 0x04,\n\tINVALID_DATA_SIZE\t\t= 0x05,\n\tINVALID_CMD_PARAM\t\t= 0x06,\n\tENCRYP_CMD_REQUIRED\t\t= 0x07,\n\tNO_SECURE_SESSION\t\t= 0x08,\n\tSECURE_SESSION_FOUND\t\t= 0x09,\n\tSECURE_SESSION_FAILED\t\t= 0x0A,\n\tAUTH_FAILED\t\t\t= 0x0B,\n\tINVALID_BIOS_AUTH\t\t= 0x0E,\n\tNONCE_DID_NOT_MATCH\t\t= 0x18,\n\tGENERIC_ERROR\t\t\t= 0x1C,\n\tBIOS_ADMIN_POLICY_NOT_MET\t= 0x28,\n\tBIOS_ADMIN_NOT_SET\t\t= 0x38,\n\tP21_NO_PROVISIONED\t\t= 0x1000,\n\tP21_PROVISION_IN_PROGRESS\t= 0x1001,\n\tP21_IN_USE\t\t\t= 0x1002,\n\tHEP_NOT_ACTIVE\t\t\t= 0x1004,\n\tHEP_ALREADY_SET\t\t\t= 0x1006,\n\tHEP_CHECK_STATE\t\t\t= 0x1007,\n};\n\nstruct common_data {\n\tu8 display_name[MAX_BUFF_SIZE];\n\tu8 path[MAX_BUFF_SIZE];\n\tu32 is_readonly;\n\tu32 display_in_ui;\n\tu32 requires_physical_presence;\n\tu32 sequence;\n\tu32 prerequisites_size;\n\tu8 prerequisites[MAX_PREREQUISITES_SIZE][MAX_BUFF_SIZE];\n\tu32 security_level;\n};\n\nstruct string_data {\n\tstruct common_data common;\n\tstruct kobject *attr_name_kobj;\n\tu8 current_value[MAX_BUFF_SIZE];\n\tu8 new_value[MAX_BUFF_SIZE];\n\tu32 min_length;\n\tu32 max_length;\n};\n\nstruct integer_data {\n\tstruct common_data common;\n\tstruct kobject *attr_name_kobj;\n\tu32 current_value;\n\tu32 new_value;\n\tu32 lower_bound;\n\tu32 upper_bound;\n\tu32 scalar_increment;\n};\n\nstruct enumeration_data {\n\tstruct common_data common;\n\tstruct kobject *attr_name_kobj;\n\tu8 current_value[MAX_BUFF_SIZE];\n\tu8 new_value[MAX_BUFF_SIZE];\n\tu32 possible_values_size;\n\tu8 possible_values[MAX_VALUES_SIZE][MAX_BUFF_SIZE];\n};\n\nstruct ordered_list_data {\n\tstruct common_data common;\n\tstruct kobject *attr_name_kobj;\n\tu8 current_value[MAX_BUFF_SIZE];\n\tu8 new_value[MAX_BUFF_SIZE];\n\tu32 elements_size;\n\tu8 elements[MAX_ELEMENTS_SIZE][MAX_BUFF_SIZE];\n};\n\nstruct password_data {\n\tstruct common_data common;\n\tstruct kobject *attr_name_kobj;\n\tu8 current_password[MAX_PASSWD_SIZE];\n\tu8 new_password[MAX_PASSWD_SIZE];\n\tu32 min_password_length;\n\tu32 max_password_length;\n\tu32 encodings_size;\n\tu8 encodings[MAX_ENCODINGS_SIZE][MAX_BUFF_SIZE];\n\tbool is_enabled;\n\n\t \n\tu32 role;\n\n\t \n\tu32 mechanism;\n};\n\nstruct secure_platform_data {\n\tstruct kobject *attr_name_kobj;\n\tu8 attribute_name[MAX_BUFF_SIZE];\n\tu8 *endorsement_key;\n\tu8 *signing_key;\n\tu8 *auth_token;\n\tbool is_enabled;\n\tu32 mechanism;\n};\n\nstruct bioscfg_priv {\n\tstruct kset *authentication_dir_kset;\n\tstruct kset *main_dir_kset;\n\tstruct device *class_dev;\n\tstruct string_data *string_data;\n\tu32 string_instances_count;\n\tstruct integer_data *integer_data;\n\tu32 integer_instances_count;\n\tstruct enumeration_data *enumeration_data;\n\tu32 enumeration_instances_count;\n\tstruct ordered_list_data *ordered_list_data;\n\tu32 ordered_list_instances_count;\n\tstruct password_data *password_data;\n\tu32 password_instances_count;\n\n\tstruct kobject *sure_start_attr_kobj;\n\tstruct secure_platform_data spm_data;\n\tu8 display_name_language_code[MAX_BUFF_SIZE];\n\tbool pending_reboot;\n\tstruct mutex mutex;\n};\n\n \nextern struct bioscfg_priv bioscfg_drv;\n\nenum hp_wmi_data_type {\n\tHPWMI_STRING_TYPE,\n\tHPWMI_INTEGER_TYPE,\n\tHPWMI_ENUMERATION_TYPE,\n\tHPWMI_ORDERED_LIST_TYPE,\n\tHPWMI_PASSWORD_TYPE,\n\tHPWMI_SECURE_PLATFORM_TYPE,\n\tHPWMI_SURE_START_TYPE,\n};\n\nenum hp_wmi_data_elements {\n\t \n\tNAME = 0,\n\tVALUE = 1,\n\tPATH = 2,\n\tIS_READONLY = 3,\n\tDISPLAY_IN_UI = 4,\n\tREQUIRES_PHYSICAL_PRESENCE = 5,\n\tSEQUENCE = 6,\n\tPREREQUISITES_SIZE = 7,\n\tPREREQUISITES = 8,\n\tSECURITY_LEVEL = 9,\n\n\t \n\tSTR_MIN_LENGTH = 10,\n\tSTR_MAX_LENGTH = 11,\n\tSTR_ELEM_CNT = 12,\n\n\t \n\tINT_LOWER_BOUND = 10,\n\tINT_UPPER_BOUND = 11,\n\tINT_SCALAR_INCREMENT = 12,\n\tINT_ELEM_CNT = 13,\n\n\t \n\tENUM_CURRENT_VALUE = 10,\n\tENUM_SIZE = 11,\n\tENUM_POSSIBLE_VALUES = 12,\n\tENUM_ELEM_CNT = 13,\n\n\t \n\tORD_LIST_SIZE = 10,\n\tORD_LIST_ELEMENTS = 11,\n\tORD_ELEM_CNT = 12,\n\n\t \n\tPSWD_MIN_LENGTH = 10,\n\tPSWD_MAX_LENGTH = 11,\n\tPSWD_SIZE = 12,\n\tPSWD_ENCODINGS = 13,\n\tPSWD_IS_SET = 14,\n\tPSWD_ELEM_CNT = 15,\n};\n\n#define GET_INSTANCE_ID(type)\t\t\t\t\t\t\\\n\tstatic int get_##type##_instance_id(struct kobject *kobj)\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tint i;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tfor (i = 0; i <= bioscfg_drv.type##_instances_count; i++) { \\\n\t\t\tif (!strcmp(kobj->name, bioscfg_drv.type##_data[i].attr_name_kobj->name)) \\\n\t\t\t\treturn i;\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\treturn -EIO;\t\t\t\t\t\t\\\n\t}\n\n#define ATTRIBUTE_S_PROPERTY_SHOW(name, type)\t\t\t\t\\\n\tstatic ssize_t name##_show(struct kobject *kobj, struct kobj_attribute *attr, \\\n\t\t\t\t   char *buf)\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tint i = get_##type##_instance_id(kobj);\t\t\t\\\n\t\tif (i >= 0)\t\t\t\t\t\t\\\n\t\t\treturn sysfs_emit(buf, \"%s\\n\", bioscfg_drv.type##_data[i].name); \\\n\t\treturn -EIO;\t\t\t\t\t\t\\\n\t}\n\n#define ATTRIBUTE_N_PROPERTY_SHOW(name, type)\t\t\t\t\\\n\tstatic ssize_t name##_show(struct kobject *kobj, struct kobj_attribute *attr, \\\n\t\t\t\t   char *buf)\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tint i = get_##type##_instance_id(kobj);\t\t\t\\\n\t\tif (i >= 0)\t\t\t\t\t\t\\\n\t\t\treturn sysfs_emit(buf, \"%d\\n\", bioscfg_drv.type##_data[i].name); \\\n\t\treturn -EIO;\t\t\t\t\t\t\\\n\t}\n\n#define ATTRIBUTE_PROPERTY_STORE(curr_val, type)\t\t\t\\\n\tstatic ssize_t curr_val##_store(struct kobject *kobj,\t\t\\\n\t\t\t\t\tstruct kobj_attribute *attr,\t\\\n\t\t\t\t\tconst char *buf, size_t count)\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tchar *attr_value = NULL;\t\t\t\t\\\n\t\tint i;\t\t\t\t\t\t\t\\\n\t\tint ret = -EIO;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tattr_value = kstrdup(buf, GFP_KERNEL);\t\t\t\\\n\t\tif (!attr_value)\t\t\t\t\t\\\n\t\t\treturn -ENOMEM;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tret = hp_enforce_single_line_input(attr_value, count);\t\\\n\t\tif (!ret) {\t\t\t\t\t\t\\\n\t\t\ti = get_##type##_instance_id(kobj);\t\t\\\n\t\t\tif (i >= 0)\t\t\t\t\t\\\n\t\t\t\tret = validate_##type##_input(i, attr_value); \\\n\t\t}\t\t\t\t\t\t\t\\\n\t\tif (!ret)\t\t\t\t\t\t\\\n\t\t\tret = hp_set_attribute(kobj->name, attr_value);\t\\\n\t\tif (!ret) {\t\t\t\t\t\t\\\n\t\t\tupdate_##type##_value(i, attr_value);\t\t\\\n\t\t\tif (bioscfg_drv.type##_data[i].common.requires_physical_presence)\t\\\n\t\t\t\thp_set_reboot_and_signal_event();\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t\thp_clear_all_credentials();\t\t\t\t\\\n\t\tkfree(attr_value);\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\treturn ret ? ret : count;\t\t\t\t\\\n\t}\n\n#define ATTRIBUTE_SPM_N_PROPERTY_SHOW(name, type)\t\t\t\\\n\tstatic ssize_t name##_show(struct kobject *kobj, struct kobj_attribute *attr, char *buf) \\\n\t{\t\t\t\t\t\t\t\t\\\n\t\treturn sysfs_emit(buf, \"%d\\n\", bioscfg_drv.type##_data.name); \\\n\t}\n\n#define ATTRIBUTE_SPM_S_PROPERTY_SHOW(name, type)\t\t\t\\\n\tstatic ssize_t name##_show(struct kobject *kobj, struct kobj_attribute *attr, char *buf) \\\n\t{\t\t\t\t\t\t\t\t\\\n\t\treturn sysfs_emit(buf, \"%s\\n\", bioscfg_drv.type##_data.name); \\\n\t}\n\n#define ATTRIBUTE_VALUES_PROPERTY_SHOW(name, type, sep)\t\t\t\\\n\tstatic ssize_t name##_show(struct kobject *kobj,\t\t\\\n\t\t\t\t   struct kobj_attribute *attr, char *buf) \\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tint i;\t\t\t\t\t\t\t\\\n\t\tint len = 0;\t\t\t\t\t\t\\\n\t\tint instance_id = get_##type##_instance_id(kobj);\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tif (instance_id < 0)\t\t\t\t\t\\\n\t\t\treturn 0;\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\tfor (i = 0; i < bioscfg_drv.type##_data[instance_id].name##_size; i++) { \\\n\t\t\tif (i)\t\t\t\t\t\t\\\n\t\t\t\tlen += sysfs_emit_at(buf, len, \"%s\", sep); \\\n\t\t\t\t\t\t\t\t\t\\\n\t\t\tlen += sysfs_emit_at(buf, len, \"%s\",\t\t\\\n\t\t\t\t\t     bioscfg_drv.type##_data[instance_id].name[i]); \\\n\t\t}\t\t\t\t\t\t\t\\\n\t\tlen += sysfs_emit_at(buf, len, \"\\n\");\t\t\t\\\n\t\treturn len;\t\t\t\t\t\t\\\n\t}\n\n#define ATTRIBUTE_S_COMMON_PROPERTY_SHOW(name, type)\t\t\\\n\tstatic ssize_t name##_show(struct kobject *kobj, struct kobj_attribute *attr, \\\n\t\t\t\t   char *buf)\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\tint i = get_##type##_instance_id(kobj);\t\t\t\\\n\t\tif (i >= 0)\t\t\t\t\t\t\\\n\t\t\treturn sysfs_emit(buf, \"%s\\n\", bioscfg_drv.type##_data[i].common.name); \\\n\t\treturn -EIO;\t\t\t\t\t\t\\\n\t}\n\nextern struct kobj_attribute common_display_langcode;\n\n \n\n \nint hp_populate_string_buffer_data(u8 *buffer_ptr, u32 *buffer_size,\n\t\t\t\t   int instance_id,\n\t\t\t\t   struct kobject *attr_name_kobj);\nint hp_alloc_string_data(void);\nvoid hp_exit_string_attributes(void);\nint hp_populate_string_package_data(union acpi_object *str_obj,\n\t\t\t\t    int instance_id,\n\t\t\t\t    struct kobject *attr_name_kobj);\n\n \nint hp_populate_integer_buffer_data(u8 *buffer_ptr, u32 *buffer_size,\n\t\t\t\t    int instance_id,\n\t\t\t\t    struct kobject *attr_name_kobj);\nint hp_alloc_integer_data(void);\nvoid hp_exit_integer_attributes(void);\nint hp_populate_integer_package_data(union acpi_object *integer_obj,\n\t\t\t\t     int instance_id,\n\t\t\t\t     struct kobject *attr_name_kobj);\n\n \nint hp_populate_enumeration_buffer_data(u8 *buffer_ptr, u32 *buffer_size,\n\t\t\t\t\tint instance_id,\n\t\t\t\t\tstruct kobject *attr_name_kobj);\nint hp_alloc_enumeration_data(void);\nvoid hp_exit_enumeration_attributes(void);\nint hp_populate_enumeration_package_data(union acpi_object *enum_obj,\n\t\t\t\t\t int instance_id,\n\t\t\t\t\t struct kobject *attr_name_kobj);\n\n \nint hp_populate_ordered_list_buffer_data(u8 *buffer_ptr,\n\t\t\t\t\t u32 *buffer_size,\n\t\t\t\t\t int instance_id,\n\t\t\t\t\t struct kobject *attr_name_kobj);\nint hp_alloc_ordered_list_data(void);\nvoid hp_exit_ordered_list_attributes(void);\nint hp_populate_ordered_list_package_data(union acpi_object *order_obj,\n\t\t\t\t\t  int instance_id,\n\t\t\t\t\t  struct kobject *attr_name_kobj);\n\n \nint hp_populate_password_buffer_data(u8 *buffer_ptr, u32 *buffer_size,\n\t\t\t\t     int instance_id,\n\t\t\t\t     struct kobject *attr_name_kobj);\nint hp_populate_password_package_data(union acpi_object *password_obj,\n\t\t\t\t      int instance_id,\n\t\t\t\t      struct kobject *attr_name_kobj);\nint hp_alloc_password_data(void);\nint hp_get_password_instance_for_type(const char *name);\nint hp_clear_all_credentials(void);\nint hp_set_attribute(const char *a_name, const char *a_value);\n\n \nvoid hp_exit_password_attributes(void);\nvoid hp_exit_secure_platform_attributes(void);\nint hp_populate_secure_platform_data(struct kobject *attr_name_kobj);\nint hp_populate_security_buffer(u16 *buffer, const char *authentication);\n\n \nint hp_wmi_set_bios_setting(u16 *input_buffer, u32 input_size);\nint hp_wmi_perform_query(int query, enum hp_wmi_command command,\n\t\t\t void *buffer, u32 insize, u32 outsize);\n\n \nvoid hp_exit_sure_start_attributes(void);\nint hp_populate_sure_start_data(struct kobject *attr_name_kobj);\n\n \n\nvoid hp_exit_attr_set_interface(void);\nint hp_init_attr_set_interface(void);\nsize_t hp_calculate_string_buffer(const char *str);\nsize_t hp_calculate_security_buffer(const char *authentication);\nvoid *hp_ascii_to_utf16_unicode(u16 *p, const u8 *str);\nint hp_get_integer_from_buffer(u8 **buffer, u32 *buffer_size, u32 *integer);\nint hp_get_string_from_buffer(u8 **buffer, u32 *buffer_size, char *dst, u32 dst_size);\nint hp_convert_hexstr_to_str(const char *input, u32 input_len, char **str, int *len);\nint hp_encode_outsize_for_pvsz(int outsize);\nint hp_enforce_single_line_input(char *buf, size_t count);\nvoid hp_set_reboot_and_signal_event(void);\nssize_t display_name_language_code_show(struct kobject *kobj,\n\t\t\t\t\tstruct kobj_attribute *attr,\n\t\t\t\t\tchar *buf);\nunion acpi_object *hp_get_wmiobj_pointer(int instance_id, const char *guid_string);\nint hp_get_instance_count(const char *guid_string);\nvoid hp_update_attribute_permissions(bool isreadonly, struct kobj_attribute *current_val);\nvoid hp_friendly_user_name_update(char *path, const char *attr_name,\n\t\t\t\t  char *attr_display, int attr_size);\nint hp_wmi_error_and_message(int error_code);\nint hp_get_common_data_from_buffer(u8 **buffer_ptr, u32 *buffer_size, struct common_data *common);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}