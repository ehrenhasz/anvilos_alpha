{
  "module_name": "surestart-attributes.c",
  "hash_id": "6db7015b58135ad7fc66852b9eadca857539b09512d9001c5b9c07b926fc6852",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/hp/hp-bioscfg/surestart-attributes.c",
  "human_readable_source": "\n \n\n#include \"bioscfg.h\"\n#include <linux/types.h>\n\n \n#define LOG_MAX_ENTRIES\t\t254\n\n \n#define LOG_ENTRY_SIZE\t\t16\n\n \nstatic ssize_t audit_log_entry_count_show(struct kobject *kobj,\n\t\t\t\t\t  struct kobj_attribute *attr, char *buf)\n{\n\tint ret;\n\tu32 count = 0;\n\n\tret = hp_wmi_perform_query(HPWMI_SURESTART_GET_LOG_COUNT,\n\t\t\t\t   HPWMI_SURESTART,\n\t\t\t\t   &count, 1, sizeof(count));\n\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn sysfs_emit(buf, \"%d,%d,%d\\n\", count, LOG_ENTRY_SIZE,\n\t\t\t  LOG_MAX_ENTRIES);\n}\n\n \nstatic ssize_t audit_log_entries_show(struct kobject *kobj,\n\t\t\t\t      struct kobj_attribute *attr, char *buf)\n{\n\tint ret;\n\tint i;\n\tu32 count = 0;\n\tu8 audit_log_buffer[128];\n\n\t\n\tret = hp_wmi_perform_query(HPWMI_SURESTART_GET_LOG_COUNT,\n\t\t\t\t   HPWMI_SURESTART,\n\t\t\t\t   &count, 1, sizeof(count));\n\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tif (count * LOG_ENTRY_SIZE > PAGE_SIZE)\n\t\treturn -EIO;\n\n\t \n\tfor (i = 0; i < count; i++) {\n\t\taudit_log_buffer[0] = i + 1;\n\n\t\t \n\t\tret = hp_wmi_perform_query(HPWMI_SURESTART_GET_LOG,\n\t\t\t\t\t   HPWMI_SURESTART,\n\t\t\t\t\t   audit_log_buffer, 1, 128);\n\n\t\tif (ret < 0 || (LOG_ENTRY_SIZE * i) > PAGE_SIZE) {\n\t\t\t \n\t\t\tbreak;\n\t\t} else {\n\t\t\tmemcpy(buf, audit_log_buffer, LOG_ENTRY_SIZE);\n\t\t\tbuf += LOG_ENTRY_SIZE;\n\t\t}\n\t}\n\n\treturn i * LOG_ENTRY_SIZE;\n}\n\nstatic struct kobj_attribute sure_start_audit_log_entry_count = __ATTR_RO(audit_log_entry_count);\nstatic struct kobj_attribute sure_start_audit_log_entries = __ATTR_RO(audit_log_entries);\n\nstatic struct attribute *sure_start_attrs[] = {\n\t&sure_start_audit_log_entry_count.attr,\n\t&sure_start_audit_log_entries.attr,\n\tNULL\n};\n\nstatic const struct attribute_group sure_start_attr_group = {\n\t.attrs = sure_start_attrs,\n};\n\nvoid hp_exit_sure_start_attributes(void)\n{\n\tsysfs_remove_group(bioscfg_drv.sure_start_attr_kobj,\n\t\t\t   &sure_start_attr_group);\n}\n\nint hp_populate_sure_start_data(struct kobject *attr_name_kobj)\n{\n\tbioscfg_drv.sure_start_attr_kobj = attr_name_kobj;\n\treturn sysfs_create_group(attr_name_kobj, &sure_start_attr_group);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}