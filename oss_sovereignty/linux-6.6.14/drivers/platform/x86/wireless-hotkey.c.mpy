{
  "module_name": "wireless-hotkey.c",
  "hash_id": "738e9b224318019a332e171be3d25a181c4f550995d84e270414a65b08aa085f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/wireless-hotkey.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/input.h>\n#include <linux/platform_device.h>\n#include <linux/acpi.h>\n#include <acpi/acpi_bus.h>\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Alex Hung\");\nMODULE_ALIAS(\"acpi*:HPQ6001:*\");\nMODULE_ALIAS(\"acpi*:WSTADEF:*\");\nMODULE_ALIAS(\"acpi*:AMDI0051:*\");\n\nstruct wl_button {\n\tstruct input_dev *input_dev;\n\tchar phys[32];\n};\n\nstatic const struct acpi_device_id wl_ids[] = {\n\t{\"HPQ6001\", 0},\n\t{\"WSTADEF\", 0},\n\t{\"AMDI0051\", 0},\n\t{\"\", 0},\n};\n\nstatic int wireless_input_setup(struct acpi_device *device)\n{\n\tstruct wl_button *button = acpi_driver_data(device);\n\tint err;\n\n\tbutton->input_dev = input_allocate_device();\n\tif (!button->input_dev)\n\t\treturn -ENOMEM;\n\n\tsnprintf(button->phys, sizeof(button->phys), \"%s/input0\", acpi_device_hid(device));\n\n\tbutton->input_dev->name = \"Wireless hotkeys\";\n\tbutton->input_dev->phys = button->phys;\n\tbutton->input_dev->id.bustype = BUS_HOST;\n\tbutton->input_dev->evbit[0] = BIT(EV_KEY);\n\tset_bit(KEY_RFKILL, button->input_dev->keybit);\n\n\terr = input_register_device(button->input_dev);\n\tif (err)\n\t\tgoto err_free_dev;\n\n\treturn 0;\n\nerr_free_dev:\n\tinput_free_device(button->input_dev);\n\treturn err;\n}\n\nstatic void wireless_input_destroy(struct acpi_device *device)\n{\n\tstruct wl_button *button = acpi_driver_data(device);\n\n\tinput_unregister_device(button->input_dev);\n\tkfree(button);\n}\n\nstatic void wl_notify(struct acpi_device *acpi_dev, u32 event)\n{\n\tstruct wl_button *button = acpi_driver_data(acpi_dev);\n\n\tif (event != 0x80) {\n\t\tpr_info(\"Received unknown event (0x%x)\\n\", event);\n\t\treturn;\n\t}\n\n\tinput_report_key(button->input_dev, KEY_RFKILL, 1);\n\tinput_sync(button->input_dev);\n\tinput_report_key(button->input_dev, KEY_RFKILL, 0);\n\tinput_sync(button->input_dev);\n}\n\nstatic int wl_add(struct acpi_device *device)\n{\n\tstruct wl_button *button;\n\tint err;\n\n\tbutton = kzalloc(sizeof(struct wl_button), GFP_KERNEL);\n\tif (!button)\n\t\treturn -ENOMEM;\n\n\tdevice->driver_data = button;\n\n\terr = wireless_input_setup(device);\n\tif (err) {\n\t\tpr_err(\"Failed to setup wireless hotkeys\\n\");\n\t\tkfree(button);\n\t}\n\n\treturn err;\n}\n\nstatic void wl_remove(struct acpi_device *device)\n{\n\twireless_input_destroy(device);\n}\n\nstatic struct acpi_driver wl_driver = {\n\t.name\t= \"wireless-hotkey\",\n\t.owner\t= THIS_MODULE,\n\t.ids\t= wl_ids,\n\t.ops\t= {\n\t\t.add\t= wl_add,\n\t\t.remove\t= wl_remove,\n\t\t.notify\t= wl_notify,\n\t},\n};\n\nmodule_acpi_driver(wl_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}