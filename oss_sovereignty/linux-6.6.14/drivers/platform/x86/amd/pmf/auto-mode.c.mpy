{
  "module_name": "auto-mode.c",
  "hash_id": "d702f9185d91bf05036f47ead254786aa062a530bad839c75240c479536db3f9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/amd/pmf/auto-mode.c",
  "human_readable_source": "\n \n\n#include <linux/acpi.h>\n#include <linux/workqueue.h>\n#include \"pmf.h\"\n\nstatic struct auto_mode_mode_config config_store;\nstatic const char *state_as_str(unsigned int state);\n\n#ifdef CONFIG_AMD_PMF_DEBUG\nstatic void amd_pmf_dump_auto_mode_defaults(struct auto_mode_mode_config *data)\n{\n\tstruct auto_mode_mode_settings *its_mode;\n\n\tpr_debug(\"Auto Mode Data - BEGIN\\n\");\n\n\t \n\tpr_debug(\"balanced_to_perf: %u ms\\n\",\n\t\t data->transition[AUTO_TRANSITION_TO_PERFORMANCE].time_constant);\n\tpr_debug(\"perf_to_balanced: %u ms\\n\",\n\t\t data->transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].time_constant);\n\tpr_debug(\"quiet_to_balanced: %u ms\\n\",\n\t\t data->transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].time_constant);\n\tpr_debug(\"balanced_to_quiet: %u ms\\n\",\n\t\t data->transition[AUTO_TRANSITION_TO_QUIET].time_constant);\n\n\t \n\tpr_debug(\"pfloor_perf: %u mW\\n\", data->mode_set[AUTO_PERFORMANCE].power_floor);\n\tpr_debug(\"pfloor_balanced: %u mW\\n\", data->mode_set[AUTO_BALANCE].power_floor);\n\tpr_debug(\"pfloor_quiet: %u mW\\n\", data->mode_set[AUTO_QUIET].power_floor);\n\n\t \n\tpr_debug(\"pd_balanced_to_perf: %u mW\\n\",\n\t\t data->transition[AUTO_TRANSITION_TO_PERFORMANCE].power_delta);\n\tpr_debug(\"pd_perf_to_balanced: %u mW\\n\",\n\t\t data->transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].power_delta);\n\tpr_debug(\"pd_quiet_to_balanced: %u mW\\n\",\n\t\t data->transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].power_delta);\n\tpr_debug(\"pd_balanced_to_quiet: %u mW\\n\",\n\t\t data->transition[AUTO_TRANSITION_TO_QUIET].power_delta);\n\n\t \n\tits_mode = &data->mode_set[AUTO_PERFORMANCE_ON_LAP];\n\tpr_debug(\"stt_apu_perf_on_lap: %u C\\n\",\n\t\t its_mode->power_control.stt_skin_temp[STT_TEMP_APU]);\n\tpr_debug(\"stt_hs2_perf_on_lap: %u C\\n\",\n\t\t its_mode->power_control.stt_skin_temp[STT_TEMP_HS2]);\n\tpr_debug(\"stt_min_limit_perf_on_lap: %u mW\\n\", its_mode->power_control.stt_min);\n\n\tits_mode = &data->mode_set[AUTO_PERFORMANCE];\n\tpr_debug(\"stt_apu_perf: %u C\\n\", its_mode->power_control.stt_skin_temp[STT_TEMP_APU]);\n\tpr_debug(\"stt_hs2_perf: %u C\\n\", its_mode->power_control.stt_skin_temp[STT_TEMP_HS2]);\n\tpr_debug(\"stt_min_limit_perf: %u mW\\n\", its_mode->power_control.stt_min);\n\n\tits_mode = &data->mode_set[AUTO_BALANCE];\n\tpr_debug(\"stt_apu_balanced: %u C\\n\", its_mode->power_control.stt_skin_temp[STT_TEMP_APU]);\n\tpr_debug(\"stt_hs2_balanced: %u C\\n\", its_mode->power_control.stt_skin_temp[STT_TEMP_HS2]);\n\tpr_debug(\"stt_min_limit_balanced: %u mW\\n\", its_mode->power_control.stt_min);\n\n\tits_mode = &data->mode_set[AUTO_QUIET];\n\tpr_debug(\"stt_apu_quiet: %u C\\n\", its_mode->power_control.stt_skin_temp[STT_TEMP_APU]);\n\tpr_debug(\"stt_hs2_quiet: %u C\\n\", its_mode->power_control.stt_skin_temp[STT_TEMP_HS2]);\n\tpr_debug(\"stt_min_limit_quiet: %u mW\\n\", its_mode->power_control.stt_min);\n\n\t \n\tits_mode = &data->mode_set[AUTO_PERFORMANCE_ON_LAP];\n\tpr_debug(\"fppt_perf_on_lap: %u mW\\n\", its_mode->power_control.fppt);\n\tpr_debug(\"sppt_perf_on_lap: %u mW\\n\", its_mode->power_control.sppt);\n\tpr_debug(\"spl_perf_on_lap: %u mW\\n\", its_mode->power_control.spl);\n\tpr_debug(\"sppt_apu_only_perf_on_lap: %u mW\\n\", its_mode->power_control.sppt_apu_only);\n\n\tits_mode = &data->mode_set[AUTO_PERFORMANCE];\n\tpr_debug(\"fppt_perf: %u mW\\n\", its_mode->power_control.fppt);\n\tpr_debug(\"sppt_perf: %u mW\\n\", its_mode->power_control.sppt);\n\tpr_debug(\"spl_perf: %u mW\\n\", its_mode->power_control.spl);\n\tpr_debug(\"sppt_apu_only_perf: %u mW\\n\", its_mode->power_control.sppt_apu_only);\n\n\tits_mode = &data->mode_set[AUTO_BALANCE];\n\tpr_debug(\"fppt_balanced: %u mW\\n\", its_mode->power_control.fppt);\n\tpr_debug(\"sppt_balanced: %u mW\\n\", its_mode->power_control.sppt);\n\tpr_debug(\"spl_balanced: %u mW\\n\", its_mode->power_control.spl);\n\tpr_debug(\"sppt_apu_only_balanced: %u mW\\n\", its_mode->power_control.sppt_apu_only);\n\n\tits_mode = &data->mode_set[AUTO_QUIET];\n\tpr_debug(\"fppt_quiet: %u mW\\n\", its_mode->power_control.fppt);\n\tpr_debug(\"sppt_quiet: %u mW\\n\", its_mode->power_control.sppt);\n\tpr_debug(\"spl_quiet: %u mW\\n\", its_mode->power_control.spl);\n\tpr_debug(\"sppt_apu_only_quiet: %u mW\\n\", its_mode->power_control.sppt_apu_only);\n\n\t \n\tpr_debug(\"fan_id_perf: %lu\\n\",\n\t\t data->mode_set[AUTO_PERFORMANCE].fan_control.fan_id);\n\tpr_debug(\"fan_id_balanced: %lu\\n\",\n\t\t data->mode_set[AUTO_BALANCE].fan_control.fan_id);\n\tpr_debug(\"fan_id_quiet: %lu\\n\",\n\t\t data->mode_set[AUTO_QUIET].fan_control.fan_id);\n\n\tpr_debug(\"Auto Mode Data - END\\n\");\n}\n#else\nstatic void amd_pmf_dump_auto_mode_defaults(struct auto_mode_mode_config *data) {}\n#endif\n\nstatic void amd_pmf_set_automode(struct amd_pmf_dev *dev, int idx,\n\t\t\t\t struct auto_mode_mode_config *table)\n{\n\tstruct power_table_control *pwr_ctrl = &config_store.mode_set[idx].power_control;\n\n\tamd_pmf_send_cmd(dev, SET_SPL, false, pwr_ctrl->spl, NULL);\n\tamd_pmf_send_cmd(dev, SET_FPPT, false, pwr_ctrl->fppt, NULL);\n\tamd_pmf_send_cmd(dev, SET_SPPT, false, pwr_ctrl->sppt, NULL);\n\tamd_pmf_send_cmd(dev, SET_SPPT_APU_ONLY, false, pwr_ctrl->sppt_apu_only, NULL);\n\tamd_pmf_send_cmd(dev, SET_STT_MIN_LIMIT, false, pwr_ctrl->stt_min, NULL);\n\tamd_pmf_send_cmd(dev, SET_STT_LIMIT_APU, false,\n\t\t\t pwr_ctrl->stt_skin_temp[STT_TEMP_APU], NULL);\n\tamd_pmf_send_cmd(dev, SET_STT_LIMIT_HS2, false,\n\t\t\t pwr_ctrl->stt_skin_temp[STT_TEMP_HS2], NULL);\n\n\tif (is_apmf_func_supported(dev, APMF_FUNC_SET_FAN_IDX))\n\t\tapmf_update_fan_idx(dev, config_store.mode_set[idx].fan_control.manual,\n\t\t\t\t    config_store.mode_set[idx].fan_control.fan_id);\n}\n\nstatic int amd_pmf_get_moving_avg(struct amd_pmf_dev *pdev, int socket_power)\n{\n\tint i, total = 0;\n\n\tif (pdev->socket_power_history_idx == -1) {\n\t\tfor (i = 0; i < AVG_SAMPLE_SIZE; i++)\n\t\t\tpdev->socket_power_history[i] = socket_power;\n\t}\n\n\tpdev->socket_power_history_idx = (pdev->socket_power_history_idx + 1) % AVG_SAMPLE_SIZE;\n\tpdev->socket_power_history[pdev->socket_power_history_idx] = socket_power;\n\n\tfor (i = 0; i < AVG_SAMPLE_SIZE; i++)\n\t\ttotal += pdev->socket_power_history[i];\n\n\treturn total / AVG_SAMPLE_SIZE;\n}\n\nvoid amd_pmf_trans_automode(struct amd_pmf_dev *dev, int socket_power, ktime_t time_elapsed_ms)\n{\n\tint avg_power = 0;\n\tbool update = false;\n\tint i, j;\n\n\t \n\tavg_power = amd_pmf_get_moving_avg(dev, socket_power);\n\n\tfor (i = 0; i < AUTO_TRANSITION_MAX; i++) {\n\t\tif ((config_store.transition[i].shifting_up && avg_power >=\n\t\t     config_store.transition[i].power_threshold) ||\n\t\t    (!config_store.transition[i].shifting_up && avg_power <=\n\t\t     config_store.transition[i].power_threshold)) {\n\t\t\tif (config_store.transition[i].timer <\n\t\t\t    config_store.transition[i].time_constant)\n\t\t\t\tconfig_store.transition[i].timer += time_elapsed_ms;\n\t\t} else {\n\t\t\tconfig_store.transition[i].timer = 0;\n\t\t}\n\n\t\tif (config_store.transition[i].timer >=\n\t\t    config_store.transition[i].time_constant &&\n\t\t    !config_store.transition[i].applied) {\n\t\t\tconfig_store.transition[i].applied = true;\n\t\t\tupdate = true;\n\t\t} else if (config_store.transition[i].timer <=\n\t\t\t   config_store.transition[i].time_constant &&\n\t\t\t   config_store.transition[i].applied) {\n\t\t\tconfig_store.transition[i].applied = false;\n\t\t\tupdate = true;\n\t\t}\n\n#ifdef CONFIG_AMD_PMF_DEBUG\n\t\tdev_dbg(dev->dev, \"[AUTO MODE] average_power : %d mW mode: %s\\n\", avg_power,\n\t\t\tstate_as_str(config_store.current_mode));\n\n\t\tdev_dbg(dev->dev, \"[AUTO MODE] time: %lld ms timer: %u ms tc: %u ms\\n\",\n\t\t\ttime_elapsed_ms, config_store.transition[i].timer,\n\t\t\tconfig_store.transition[i].time_constant);\n\n\t\tdev_dbg(dev->dev, \"[AUTO MODE] shiftup: %u pt: %u mW pf: %u mW pd: %u mW\\n\",\n\t\t\tconfig_store.transition[i].shifting_up,\n\t\t\tconfig_store.transition[i].power_threshold,\n\t\t\tconfig_store.mode_set[i].power_floor,\n\t\t\tconfig_store.transition[i].power_delta);\n#endif\n\t}\n\n\tdev_dbg(dev->dev, \"[AUTO_MODE] avg power: %u mW mode: %s\\n\", avg_power,\n\t\tstate_as_str(config_store.current_mode));\n\n#ifdef CONFIG_AMD_PMF_DEBUG\n\tdev_dbg(dev->dev, \"[AUTO MODE] priority1: %u priority2: %u priority3: %u priority4: %u\\n\",\n\t\tconfig_store.transition[0].applied,\n\t\tconfig_store.transition[1].applied,\n\t\tconfig_store.transition[2].applied,\n\t\tconfig_store.transition[3].applied);\n#endif\n\n\tif (update) {\n\t\tfor (j = 0; j < AUTO_TRANSITION_MAX; j++) {\n\t\t\t \n\t\t\tif (config_store.transition[j].applied) {\n\t\t\t\tif (config_store.current_mode !=\n\t\t\t\t    config_store.transition[j].target_mode) {\n\t\t\t\t\tconfig_store.current_mode =\n\t\t\t\t\t\t\tconfig_store.transition[j].target_mode;\n\t\t\t\t\tdev_dbg(dev->dev, \"[AUTO_MODE] moving to mode:%s\\n\",\n\t\t\t\t\t\tstate_as_str(config_store.current_mode));\n\t\t\t\t\tamd_pmf_set_automode(dev, config_store.current_mode, NULL);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid amd_pmf_update_2_cql(struct amd_pmf_dev *dev, bool is_cql_event)\n{\n\tint mode = config_store.current_mode;\n\n\tconfig_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].target_mode =\n\t\t\t\t   is_cql_event ? AUTO_PERFORMANCE_ON_LAP : AUTO_PERFORMANCE;\n\n\tif ((mode == AUTO_PERFORMANCE || mode == AUTO_PERFORMANCE_ON_LAP) &&\n\t    mode != config_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].target_mode) {\n\t\tmode = config_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].target_mode;\n\t\tamd_pmf_set_automode(dev, mode, NULL);\n\t}\n\tdev_dbg(dev->dev, \"updated CQL thermals\\n\");\n}\n\nstatic void amd_pmf_get_power_threshold(void)\n{\n\tconfig_store.transition[AUTO_TRANSITION_TO_QUIET].power_threshold =\n\t\t\t\tconfig_store.mode_set[AUTO_BALANCE].power_floor -\n\t\t\t\tconfig_store.transition[AUTO_TRANSITION_TO_QUIET].power_delta;\n\n\tconfig_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].power_threshold =\n\t\t\t\tconfig_store.mode_set[AUTO_BALANCE].power_floor -\n\t\t\t\tconfig_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].power_delta;\n\n\tconfig_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].power_threshold =\n\t\t\tconfig_store.mode_set[AUTO_QUIET].power_floor -\n\t\t\tconfig_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].power_delta;\n\n\tconfig_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].power_threshold =\n\t\tconfig_store.mode_set[AUTO_PERFORMANCE].power_floor -\n\t\tconfig_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].power_delta;\n\n#ifdef CONFIG_AMD_PMF_DEBUG\n\tpr_debug(\"[AUTO MODE TO_QUIET] pt: %u mW pf: %u mW pd: %u mW\\n\",\n\t\t config_store.transition[AUTO_TRANSITION_TO_QUIET].power_threshold,\n\t\t config_store.mode_set[AUTO_BALANCE].power_floor,\n\t\t config_store.transition[AUTO_TRANSITION_TO_QUIET].power_delta);\n\n\tpr_debug(\"[AUTO MODE TO_PERFORMANCE] pt: %u mW pf: %u mW pd: %u mW\\n\",\n\t\t config_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].power_threshold,\n\t\t config_store.mode_set[AUTO_BALANCE].power_floor,\n\t\t config_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].power_delta);\n\n\tpr_debug(\"[AUTO MODE QUIET_TO_BALANCE] pt: %u mW pf: %u mW pd: %u mW\\n\",\n\t\t config_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE]\n\t\t .power_threshold,\n\t\t config_store.mode_set[AUTO_QUIET].power_floor,\n\t\t config_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].power_delta);\n\n\tpr_debug(\"[AUTO MODE PERFORMANCE_TO_BALANCE] pt: %u mW pf: %u mW pd: %u mW\\n\",\n\t\t config_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE]\n\t\t .power_threshold,\n\t\t config_store.mode_set[AUTO_PERFORMANCE].power_floor,\n\t\t config_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].power_delta);\n#endif\n}\n\nstatic const char *state_as_str(unsigned int state)\n{\n\tswitch (state) {\n\tcase AUTO_QUIET:\n\t\treturn \"QUIET\";\n\tcase AUTO_BALANCE:\n\t\treturn \"BALANCED\";\n\tcase AUTO_PERFORMANCE_ON_LAP:\n\t\treturn \"ON_LAP\";\n\tcase AUTO_PERFORMANCE:\n\t\treturn \"PERFORMANCE\";\n\tdefault:\n\t\treturn \"Unknown Auto Mode State\";\n\t}\n}\n\nstatic void amd_pmf_load_defaults_auto_mode(struct amd_pmf_dev *dev)\n{\n\tstruct apmf_auto_mode output;\n\tstruct power_table_control *pwr_ctrl;\n\tint i;\n\n\tapmf_get_auto_mode_def(dev, &output);\n\t \n\tconfig_store.transition[AUTO_TRANSITION_TO_QUIET].time_constant =\n\t\t\t\t\t\t\t\toutput.balanced_to_quiet;\n\tconfig_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].time_constant =\n\t\t\t\t\t\t\t\toutput.balanced_to_perf;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].time_constant =\n\t\t\t\t\t\t\t\toutput.quiet_to_balanced;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].time_constant =\n\t\t\t\t\t\t\t\toutput.perf_to_balanced;\n\n\t \n\tconfig_store.mode_set[AUTO_QUIET].power_floor = output.pfloor_quiet;\n\tconfig_store.mode_set[AUTO_BALANCE].power_floor = output.pfloor_balanced;\n\tconfig_store.mode_set[AUTO_PERFORMANCE].power_floor = output.pfloor_perf;\n\tconfig_store.mode_set[AUTO_PERFORMANCE_ON_LAP].power_floor = output.pfloor_perf;\n\n\t \n\tconfig_store.transition[AUTO_TRANSITION_TO_QUIET].power_delta =\n\t\t\t\t\t\t\t\toutput.pd_balanced_to_quiet;\n\tconfig_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].power_delta =\n\t\t\t\t\t\t\t\toutput.pd_balanced_to_perf;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].power_delta =\n\t\t\t\t\t\t\t\toutput.pd_quiet_to_balanced;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].power_delta =\n\t\t\t\t\t\t\t\toutput.pd_perf_to_balanced;\n\n\t \n\tamd_pmf_get_power_threshold();\n\n\t \n\tpwr_ctrl = &config_store.mode_set[AUTO_QUIET].power_control;\n\tpwr_ctrl->spl = output.spl_quiet;\n\tpwr_ctrl->sppt = output.sppt_quiet;\n\tpwr_ctrl->fppt = output.fppt_quiet;\n\tpwr_ctrl->sppt_apu_only = output.sppt_apu_only_quiet;\n\tpwr_ctrl->stt_min = output.stt_min_limit_quiet;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_APU] = output.stt_apu_quiet;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_HS2] = output.stt_hs2_quiet;\n\n\tpwr_ctrl = &config_store.mode_set[AUTO_BALANCE].power_control;\n\tpwr_ctrl->spl = output.spl_balanced;\n\tpwr_ctrl->sppt = output.sppt_balanced;\n\tpwr_ctrl->fppt = output.fppt_balanced;\n\tpwr_ctrl->sppt_apu_only = output.sppt_apu_only_balanced;\n\tpwr_ctrl->stt_min = output.stt_min_limit_balanced;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_APU] = output.stt_apu_balanced;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_HS2] = output.stt_hs2_balanced;\n\n\tpwr_ctrl = &config_store.mode_set[AUTO_PERFORMANCE].power_control;\n\tpwr_ctrl->spl = output.spl_perf;\n\tpwr_ctrl->sppt = output.sppt_perf;\n\tpwr_ctrl->fppt = output.fppt_perf;\n\tpwr_ctrl->sppt_apu_only = output.sppt_apu_only_perf;\n\tpwr_ctrl->stt_min = output.stt_min_limit_perf;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_APU] = output.stt_apu_perf;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_HS2] = output.stt_hs2_perf;\n\n\tpwr_ctrl = &config_store.mode_set[AUTO_PERFORMANCE_ON_LAP].power_control;\n\tpwr_ctrl->spl = output.spl_perf_on_lap;\n\tpwr_ctrl->sppt = output.sppt_perf_on_lap;\n\tpwr_ctrl->fppt = output.fppt_perf_on_lap;\n\tpwr_ctrl->sppt_apu_only = output.sppt_apu_only_perf_on_lap;\n\tpwr_ctrl->stt_min = output.stt_min_limit_perf_on_lap;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_APU] = output.stt_apu_perf_on_lap;\n\tpwr_ctrl->stt_skin_temp[STT_TEMP_HS2] = output.stt_hs2_perf_on_lap;\n\n\t \n\tconfig_store.mode_set[AUTO_QUIET].fan_control.fan_id = output.fan_id_quiet;\n\tconfig_store.mode_set[AUTO_BALANCE].fan_control.fan_id = output.fan_id_balanced;\n\tconfig_store.mode_set[AUTO_PERFORMANCE].fan_control.fan_id = output.fan_id_perf;\n\tconfig_store.mode_set[AUTO_PERFORMANCE_ON_LAP].fan_control.fan_id =\n\t\t\t\t\t\t\t\t\toutput.fan_id_perf;\n\n\tconfig_store.transition[AUTO_TRANSITION_TO_QUIET].target_mode = AUTO_QUIET;\n\tconfig_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].target_mode =\n\t\t\t\t\t\t\t\tAUTO_PERFORMANCE;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].target_mode =\n\t\t\t\t\t\t\t\t\tAUTO_BALANCE;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].target_mode =\n\t\t\t\t\t\t\t\t\tAUTO_BALANCE;\n\n\tconfig_store.transition[AUTO_TRANSITION_TO_QUIET].shifting_up = false;\n\tconfig_store.transition[AUTO_TRANSITION_TO_PERFORMANCE].shifting_up = true;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_QUIET_TO_BALANCE].shifting_up = true;\n\tconfig_store.transition[AUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE].shifting_up =\n\t\t\t\t\t\t\t\t\t\tfalse;\n\n\tfor (i = 0 ; i < AUTO_MODE_MAX ; i++) {\n\t\tif (config_store.mode_set[i].fan_control.fan_id == FAN_INDEX_AUTO)\n\t\t\tconfig_store.mode_set[i].fan_control.manual = false;\n\t\telse\n\t\t\tconfig_store.mode_set[i].fan_control.manual = true;\n\t}\n\n\t \n\tconfig_store.current_mode = AUTO_BALANCE;\n\tdev->socket_power_history_idx = -1;\n\n\tamd_pmf_dump_auto_mode_defaults(&config_store);\n}\n\nint amd_pmf_reset_amt(struct amd_pmf_dev *dev)\n{\n\t \n\n\tif (is_apmf_func_supported(dev, APMF_FUNC_STATIC_SLIDER_GRANULAR)) {\n\t\tdev_dbg(dev->dev, \"resetting AMT thermals\\n\");\n\t\tamd_pmf_set_sps_power_limits(dev);\n\t}\n\treturn 0;\n}\n\nvoid amd_pmf_handle_amt(struct amd_pmf_dev *dev)\n{\n\tamd_pmf_set_automode(dev, config_store.current_mode, NULL);\n}\n\nvoid amd_pmf_deinit_auto_mode(struct amd_pmf_dev *dev)\n{\n\tcancel_delayed_work_sync(&dev->work_buffer);\n}\n\nvoid amd_pmf_init_auto_mode(struct amd_pmf_dev *dev)\n{\n\tamd_pmf_load_defaults_auto_mode(dev);\n\tamd_pmf_init_metrics_table(dev);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}