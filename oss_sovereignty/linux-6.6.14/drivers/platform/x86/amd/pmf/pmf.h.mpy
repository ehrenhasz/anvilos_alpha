{
  "module_name": "pmf.h",
  "hash_id": "e45c7c346327ecce8c96034e396f6c4cced4fe1e557759224e4f29032100e747",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/amd/pmf/pmf.h",
  "human_readable_source": " \n \n\n#ifndef PMF_H\n#define PMF_H\n\n#include <linux/acpi.h>\n#include <linux/platform_profile.h>\n\n \n#define APMF_FUNC_VERIFY_INTERFACE\t\t\t0\n#define APMF_FUNC_GET_SYS_PARAMS\t\t\t1\n#define APMF_FUNC_SBIOS_REQUESTS\t\t\t2\n#define APMF_FUNC_SBIOS_HEARTBEAT\t\t\t4\n#define APMF_FUNC_AUTO_MODE\t\t\t\t\t5\n#define APMF_FUNC_SET_FAN_IDX\t\t\t\t7\n#define APMF_FUNC_OS_POWER_SLIDER_UPDATE\t\t8\n#define APMF_FUNC_STATIC_SLIDER_GRANULAR       9\n#define APMF_FUNC_DYN_SLIDER_AC\t\t\t\t11\n#define APMF_FUNC_DYN_SLIDER_DC\t\t\t\t12\n\n \n#define SET_SPL\t\t\t\t0x03  \n#define SET_SPPT\t\t\t0x05  \n#define SET_FPPT\t\t\t0x07  \n#define GET_SPL\t\t\t\t0x0B\n#define GET_SPPT\t\t\t0x0D\n#define GET_FPPT\t\t\t0x0F\n#define SET_DRAM_ADDR_HIGH\t0x14\n#define SET_DRAM_ADDR_LOW\t0x15\n#define SET_TRANSFER_TABLE\t0x16\n#define SET_STT_MIN_LIMIT\t0x18  \n#define SET_STT_LIMIT_APU\t0x19\n#define SET_STT_LIMIT_HS2\t0x1A\n#define SET_SPPT_APU_ONLY\t0x1D\n#define GET_SPPT_APU_ONLY\t0x1E\n#define GET_STT_MIN_LIMIT\t0x1F\n#define GET_STT_LIMIT_APU\t0x20\n#define GET_STT_LIMIT_HS2\t0x21\n\n \n#define DC_BEST_PERF\t\t0\n#define DC_BETTER_PERF\t\t1\n#define DC_BATTERY_SAVER\t3\n#define AC_BEST_PERF\t\t4\n#define AC_BETTER_PERF\t\t5\n#define AC_BETTER_BATTERY\t6\n\n \n#define FAN_INDEX_AUTO\t\t0xFFFFFFFF\n\n#define ARG_NONE 0\n#define AVG_SAMPLE_SIZE 3\n\n \nstruct apmf_verify_interface {\n\tu16 size;\n\tu16 version;\n\tu32 notification_mask;\n\tu32 supported_functions;\n} __packed;\n\nstruct apmf_system_params {\n\tu16 size;\n\tu32 valid_mask;\n\tu32 flags;\n\tu8 command_code;\n\tu32 heartbeat_int;\n} __packed;\n\nstruct apmf_sbios_req {\n\tu16 size;\n\tu32 pending_req;\n\tu8 rsd;\n\tu8 cql_event;\n\tu8 amt_event;\n\tu32 fppt;\n\tu32 sppt;\n\tu32 fppt_apu_only;\n\tu32 spl;\n\tu32 stt_min_limit;\n\tu8 skin_temp_apu;\n\tu8 skin_temp_hs2;\n} __packed;\n\nstruct apmf_fan_idx {\n\tu16 size;\n\tu8 fan_ctl_mode;\n\tu32 fan_ctl_idx;\n} __packed;\n\nstruct smu_pmf_metrics {\n\tu16 gfxclk_freq;  \n\tu16 socclk_freq;  \n\tu16 vclk_freq;  \n\tu16 dclk_freq;  \n\tu16 memclk_freq;  \n\tu16 spare;\n\tu16 gfx_activity;  \n\tu16 uvd_activity;  \n\tu16 voltage[2];  \n\tu16 currents[2];  \n\tu16 power[2]; \n\tu16 core_freq[8];  \n\tu16 core_power[8];  \n\tu16 core_temp[8];  \n\tu16 l3_freq;  \n\tu16 l3_temp;  \n\tu16 gfx_temp;  \n\tu16 soc_temp;  \n\tu16 throttler_status;\n\tu16 current_socketpower;  \n\tu16 stapm_orig_limit;  \n\tu16 stapm_cur_limit;  \n\tu32 apu_power;  \n\tu32 dgpu_power;  \n\tu16 vdd_tdc_val;  \n\tu16 soc_tdc_val;  \n\tu16 vdd_edc_val;  \n\tu16 soc_edcv_al;  \n\tu16 infra_cpu_maxfreq;  \n\tu16 infra_gfx_maxfreq;  \n\tu16 skin_temp;  \n\tu16 device_state;\n} __packed;\n\nenum amd_stt_skin_temp {\n\tSTT_TEMP_APU,\n\tSTT_TEMP_HS2,\n\tSTT_TEMP_COUNT,\n};\n\nenum amd_slider_op {\n\tSLIDER_OP_GET,\n\tSLIDER_OP_SET,\n};\n\nenum power_source {\n\tPOWER_SOURCE_AC,\n\tPOWER_SOURCE_DC,\n\tPOWER_SOURCE_MAX,\n};\n\nenum power_modes {\n\tPOWER_MODE_PERFORMANCE,\n\tPOWER_MODE_BALANCED_POWER,\n\tPOWER_MODE_POWER_SAVER,\n\tPOWER_MODE_MAX,\n};\n\nstruct amd_pmf_dev {\n\tvoid __iomem *regbase;\n\tvoid __iomem *smu_virt_addr;\n\tvoid *buf;\n\tu32 base_addr;\n\tu32 cpu_id;\n\tstruct device *dev;\n\tstruct mutex lock;  \n\tu32 supported_func;\n\tenum platform_profile_option current_profile;\n\tstruct platform_profile_handler pprof;\n\tstruct dentry *dbgfs_dir;\n\tint hb_interval;  \n\tstruct delayed_work heart_beat;\n\tstruct smu_pmf_metrics m_table;\n\tstruct delayed_work work_buffer;\n\tktime_t start_time;\n\tint socket_power_history[AVG_SAMPLE_SIZE];\n\tint socket_power_history_idx;\n\tbool amt_enabled;\n\tstruct mutex update_mutex;  \n\tbool cnqf_enabled;\n\tbool cnqf_supported;\n\tstruct notifier_block pwr_src_notifier;\n};\n\nstruct apmf_sps_prop_granular {\n\tu32 fppt;\n\tu32 sppt;\n\tu32 sppt_apu_only;\n\tu32 spl;\n\tu32 stt_min;\n\tu8 stt_skin_temp[STT_TEMP_COUNT];\n\tu32 fan_id;\n} __packed;\n\n \nstruct apmf_static_slider_granular_output {\n\tu16 size;\n\tstruct apmf_sps_prop_granular prop[POWER_SOURCE_MAX * POWER_MODE_MAX];\n} __packed;\n\nstruct amd_pmf_static_slider_granular {\n\tu16 size;\n\tstruct apmf_sps_prop_granular prop[POWER_SOURCE_MAX][POWER_MODE_MAX];\n};\n\nstruct os_power_slider {\n\tu16 size;\n\tu8 slider_event;\n} __packed;\n\nstruct fan_table_control {\n\tbool manual;\n\tunsigned long fan_id;\n};\n\nstruct power_table_control {\n\tu32 spl;\n\tu32 sppt;\n\tu32 fppt;\n\tu32 sppt_apu_only;\n\tu32 stt_min;\n\tu32 stt_skin_temp[STT_TEMP_COUNT];\n\tu32 reserved[16];\n};\n\n \nenum auto_mode_transition_priority {\n\tAUTO_TRANSITION_TO_PERFORMANCE,  \n\tAUTO_TRANSITION_FROM_QUIET_TO_BALANCE,  \n\tAUTO_TRANSITION_TO_QUIET,  \n\tAUTO_TRANSITION_FROM_PERFORMANCE_TO_BALANCE,  \n\tAUTO_TRANSITION_MAX,\n};\n\nenum auto_mode_mode {\n\tAUTO_QUIET,\n\tAUTO_BALANCE,\n\tAUTO_PERFORMANCE_ON_LAP,\n\tAUTO_PERFORMANCE,\n\tAUTO_MODE_MAX,\n};\n\nstruct auto_mode_trans_params {\n\tu32 time_constant;  \n\tu32 power_delta;  \n\tu32 power_threshold;\n\tu32 timer;  \n\tu32 applied;\n\tenum auto_mode_mode target_mode;\n\tu32 shifting_up;\n};\n\nstruct auto_mode_mode_settings {\n\tstruct power_table_control power_control;\n\tstruct fan_table_control fan_control;\n\tu32 power_floor;\n};\n\nstruct auto_mode_mode_config {\n\tstruct auto_mode_trans_params transition[AUTO_TRANSITION_MAX];\n\tstruct auto_mode_mode_settings mode_set[AUTO_MODE_MAX];\n\tenum auto_mode_mode current_mode;\n};\n\nstruct apmf_auto_mode {\n\tu16 size;\n\t \n\tu32 balanced_to_perf;\n\tu32 perf_to_balanced;\n\tu32 quiet_to_balanced;\n\tu32 balanced_to_quiet;\n\t \n\tu32 pfloor_perf;\n\tu32 pfloor_balanced;\n\tu32 pfloor_quiet;\n\t \n\tu32 pd_balanced_to_perf;\n\tu32 pd_perf_to_balanced;\n\tu32 pd_quiet_to_balanced;\n\tu32 pd_balanced_to_quiet;\n\t \n\tu8 stt_apu_perf_on_lap;  \n\tu8 stt_hs2_perf_on_lap;  \n\tu8 stt_apu_perf;\n\tu8 stt_hs2_perf;\n\tu8 stt_apu_balanced;\n\tu8 stt_hs2_balanced;\n\tu8 stt_apu_quiet;\n\tu8 stt_hs2_quiet;\n\tu32 stt_min_limit_perf_on_lap;  \n\tu32 stt_min_limit_perf;\n\tu32 stt_min_limit_balanced;\n\tu32 stt_min_limit_quiet;\n\t \n\tu32 fppt_perf_on_lap;  \n\tu32 sppt_perf_on_lap;  \n\tu32 spl_perf_on_lap;  \n\tu32 sppt_apu_only_perf_on_lap;  \n\tu32 fppt_perf;\n\tu32 sppt_perf;\n\tu32 spl_perf;\n\tu32 sppt_apu_only_perf;\n\tu32 fppt_balanced;\n\tu32 sppt_balanced;\n\tu32 spl_balanced;\n\tu32 sppt_apu_only_balanced;\n\tu32 fppt_quiet;\n\tu32 sppt_quiet;\n\tu32 spl_quiet;\n\tu32 sppt_apu_only_quiet;\n\t \n\tu32 fan_id_perf;\n\tu32 fan_id_balanced;\n\tu32 fan_id_quiet;\n} __packed;\n\n \nenum cnqf_trans_priority {\n\tCNQF_TRANSITION_TO_TURBO,  \n\tCNQF_TRANSITION_FROM_BALANCE_TO_PERFORMANCE,  \n\tCNQF_TRANSITION_FROM_QUIET_TO_BALANCE,  \n\tCNQF_TRANSITION_TO_QUIET,  \n\tCNQF_TRANSITION_FROM_PERFORMANCE_TO_BALANCE,  \n\tCNQF_TRANSITION_FROM_TURBO_TO_PERFORMANCE,  \n\tCNQF_TRANSITION_MAX,\n};\n\nenum cnqf_mode {\n\tCNQF_MODE_QUIET,\n\tCNQF_MODE_BALANCE,\n\tCNQF_MODE_PERFORMANCE,\n\tCNQF_MODE_TURBO,\n\tCNQF_MODE_MAX,\n};\n\nenum apmf_cnqf_pos {\n\tAPMF_CNQF_TURBO,\n\tAPMF_CNQF_PERFORMANCE,\n\tAPMF_CNQF_BALANCE,\n\tAPMF_CNQF_QUIET,\n\tAPMF_CNQF_MAX,\n};\n\nstruct cnqf_mode_settings {\n\tstruct power_table_control power_control;\n\tstruct fan_table_control fan_control;\n\tu32 power_floor;\n};\n\nstruct cnqf_tran_params {\n\tu32 time_constant;  \n\tu32 power_threshold;\n\tu32 timer;  \n\tu32 total_power;\n\tu32 count;\n\tbool priority;\n\tbool shifting_up;\n\tenum cnqf_mode target_mode;\n};\n\nstruct cnqf_config {\n\tstruct cnqf_tran_params trans_param[POWER_SOURCE_MAX][CNQF_TRANSITION_MAX];\n\tstruct cnqf_mode_settings mode_set[POWER_SOURCE_MAX][CNQF_MODE_MAX];\n\tstruct power_table_control defaults;\n\tenum cnqf_mode current_mode;\n\tu32 power_src;\n\tu32 avg_power;\n};\n\nstruct apmf_cnqf_power_set {\n\tu32 pfloor;\n\tu32 fppt;\n\tu32 sppt;\n\tu32 sppt_apu_only;\n\tu32 spl;\n\tu32 stt_min_limit;\n\tu8 stt_skintemp[STT_TEMP_COUNT];\n\tu32 fan_id;\n} __packed;\n\nstruct apmf_dyn_slider_output {\n\tu16 size;\n\tu16 flags;\n\tu32 t_perf_to_turbo;\n\tu32 t_balanced_to_perf;\n\tu32 t_quiet_to_balanced;\n\tu32 t_balanced_to_quiet;\n\tu32 t_perf_to_balanced;\n\tu32 t_turbo_to_perf;\n\tstruct apmf_cnqf_power_set ps[APMF_CNQF_MAX];\n} __packed;\n\n \nint apmf_acpi_init(struct amd_pmf_dev *pmf_dev);\nvoid apmf_acpi_deinit(struct amd_pmf_dev *pmf_dev);\nint is_apmf_func_supported(struct amd_pmf_dev *pdev, unsigned long index);\nint amd_pmf_send_cmd(struct amd_pmf_dev *dev, u8 message, bool get, u32 arg, u32 *data);\nint amd_pmf_init_metrics_table(struct amd_pmf_dev *dev);\nint amd_pmf_get_power_source(void);\nint apmf_install_handler(struct amd_pmf_dev *pmf_dev);\nint apmf_os_power_slider_update(struct amd_pmf_dev *dev, u8 flag);\n\n \nint amd_pmf_get_pprof_modes(struct amd_pmf_dev *pmf);\nvoid amd_pmf_update_slider(struct amd_pmf_dev *dev, bool op, int idx,\n\t\t\t   struct amd_pmf_static_slider_granular *table);\nint amd_pmf_init_sps(struct amd_pmf_dev *dev);\nvoid amd_pmf_deinit_sps(struct amd_pmf_dev *dev);\nint apmf_get_static_slider_granular(struct amd_pmf_dev *pdev,\n\t\t\t\t    struct apmf_static_slider_granular_output *output);\nbool is_pprof_balanced(struct amd_pmf_dev *pmf);\nint amd_pmf_power_slider_update_event(struct amd_pmf_dev *dev);\n\n\nint apmf_update_fan_idx(struct amd_pmf_dev *pdev, bool manual, u32 idx);\nint amd_pmf_set_sps_power_limits(struct amd_pmf_dev *pmf);\n\n \nint apmf_get_auto_mode_def(struct amd_pmf_dev *pdev, struct apmf_auto_mode *data);\nvoid amd_pmf_init_auto_mode(struct amd_pmf_dev *dev);\nvoid amd_pmf_deinit_auto_mode(struct amd_pmf_dev *dev);\nvoid amd_pmf_trans_automode(struct amd_pmf_dev *dev, int socket_power, ktime_t time_elapsed_ms);\nint apmf_get_sbios_requests(struct amd_pmf_dev *pdev, struct apmf_sbios_req *req);\n\nvoid amd_pmf_update_2_cql(struct amd_pmf_dev *dev, bool is_cql_event);\nint amd_pmf_reset_amt(struct amd_pmf_dev *dev);\nvoid amd_pmf_handle_amt(struct amd_pmf_dev *dev);\n\n \nint apmf_get_dyn_slider_def_ac(struct amd_pmf_dev *pdev, struct apmf_dyn_slider_output *data);\nint apmf_get_dyn_slider_def_dc(struct amd_pmf_dev *pdev, struct apmf_dyn_slider_output *data);\nint amd_pmf_init_cnqf(struct amd_pmf_dev *dev);\nvoid amd_pmf_deinit_cnqf(struct amd_pmf_dev *dev);\nint amd_pmf_trans_cnqf(struct amd_pmf_dev *dev, int socket_power, ktime_t time_lapsed_ms);\nextern const struct attribute_group cnqf_feature_attribute_group;\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}