{
  "module_name": "adv_swbutton.c",
  "hash_id": "fe93b60c512ae57911d43a00e039dffadf9842314a0efafd11d51d9ddac49d22",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/adv_swbutton.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/input.h>\n#include <linux/acpi.h>\n#include <linux/platform_device.h>\n\n#define ACPI_BUTTON_HID_SWBTN               \"AHC0310\"\n\n#define ACPI_BUTTON_NOTIFY_SWBTN_RELEASE    0x86\n#define ACPI_BUTTON_NOTIFY_SWBTN_PRESSED    0x85\n\nstruct adv_swbutton {\n\tstruct input_dev *input;\n\tchar phys[32];\n};\n\n \nstatic void adv_swbutton_notify(acpi_handle handle, u32 event, void *context)\n{\n\tstruct platform_device *device = context;\n\tstruct adv_swbutton *button = dev_get_drvdata(&device->dev);\n\n\tswitch (event) {\n\tcase ACPI_BUTTON_NOTIFY_SWBTN_RELEASE:\n\t\tinput_report_key(button->input, KEY_PROG1, 0);\n\t\tinput_sync(button->input);\n\t\tbreak;\n\tcase ACPI_BUTTON_NOTIFY_SWBTN_PRESSED:\n\t\tinput_report_key(button->input, KEY_PROG1, 1);\n\t\tinput_sync(button->input);\n\t\tbreak;\n\tdefault:\n\t\tdev_dbg(&device->dev, \"Unsupported event [0x%x]\\n\", event);\n\t}\n}\n\nstatic int adv_swbutton_probe(struct platform_device *device)\n{\n\tstruct adv_swbutton *button;\n\tstruct input_dev *input;\n\tacpi_handle handle = ACPI_HANDLE(&device->dev);\n\tacpi_status status;\n\tint error;\n\n\tbutton = devm_kzalloc(&device->dev, sizeof(*button), GFP_KERNEL);\n\tif (!button)\n\t\treturn -ENOMEM;\n\n\tdev_set_drvdata(&device->dev, button);\n\n\tinput = devm_input_allocate_device(&device->dev);\n\tif (!input)\n\t\treturn -ENOMEM;\n\n\tbutton->input = input;\n\tsnprintf(button->phys, sizeof(button->phys), \"%s/button/input0\", ACPI_BUTTON_HID_SWBTN);\n\n\tinput->name = \"Advantech Software Button\";\n\tinput->phys = button->phys;\n\tinput->id.bustype = BUS_HOST;\n\tinput->dev.parent = &device->dev;\n\tset_bit(EV_REP, input->evbit);\n\tinput_set_capability(input, EV_KEY, KEY_PROG1);\n\n\terror = input_register_device(input);\n\tif (error)\n\t\treturn error;\n\n\tdevice_init_wakeup(&device->dev, true);\n\n\tstatus = acpi_install_notify_handler(handle,\n\t\t\t\t\t     ACPI_DEVICE_NOTIFY,\n\t\t\t\t\t     adv_swbutton_notify,\n\t\t\t\t\t     device);\n\tif (ACPI_FAILURE(status)) {\n\t\tdev_err(&device->dev, \"Error installing notify handler\\n\");\n\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}\n\nstatic void adv_swbutton_remove(struct platform_device *device)\n{\n\tacpi_handle handle = ACPI_HANDLE(&device->dev);\n\n\tacpi_remove_notify_handler(handle, ACPI_DEVICE_NOTIFY,\n\t\t\t\t   adv_swbutton_notify);\n}\n\nstatic const struct acpi_device_id button_device_ids[] = {\n\t{ACPI_BUTTON_HID_SWBTN, 0},\n\t{\"\", 0},\n};\nMODULE_DEVICE_TABLE(acpi, button_device_ids);\n\nstatic struct platform_driver adv_swbutton_driver = {\n\t.driver = {\n\t\t.name = \"adv_swbutton\",\n\t\t.acpi_match_table = button_device_ids,\n\t},\n\t.probe = adv_swbutton_probe,\n\t.remove_new = adv_swbutton_remove,\n};\nmodule_platform_driver(adv_swbutton_driver);\n\nMODULE_AUTHOR(\"Andrea Ho\");\nMODULE_DESCRIPTION(\"Advantech ACPI SW Button Driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}