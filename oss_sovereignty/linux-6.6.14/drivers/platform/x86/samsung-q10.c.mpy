{
  "module_name": "samsung-q10.c",
  "hash_id": "a09d596888f36ebd014c11ad9937187d137d5c743889d713cb861deea58f922f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/samsung-q10.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/platform_device.h>\n#include <linux/backlight.h>\n#include <linux/dmi.h>\n#include <linux/acpi.h>\n\n#define SAMSUNGQ10_BL_MAX_INTENSITY 7\n\nstatic acpi_handle ec_handle;\n\nstatic bool force;\nmodule_param(force, bool, 0);\nMODULE_PARM_DESC(force,\n\t\t\"Disable the DMI check and force the driver to be loaded\");\n\nstatic int samsungq10_bl_set_intensity(struct backlight_device *bd)\n{\n\n\tacpi_status status;\n\tint i;\n\n\tfor (i = 0; i < SAMSUNGQ10_BL_MAX_INTENSITY; i++) {\n\t\tstatus = acpi_evaluate_object(ec_handle, \"_Q63\", NULL, NULL);\n\t\tif (ACPI_FAILURE(status))\n\t\t\treturn -EIO;\n\t}\n\tfor (i = 0; i < bd->props.brightness; i++) {\n\t\tstatus = acpi_evaluate_object(ec_handle, \"_Q64\", NULL, NULL);\n\t\tif (ACPI_FAILURE(status))\n\t\t\treturn -EIO;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct backlight_ops samsungq10_bl_ops = {\n\t.update_status\t= samsungq10_bl_set_intensity,\n};\n\nstatic int samsungq10_probe(struct platform_device *pdev)\n{\n\n\tstruct backlight_properties props;\n\tstruct backlight_device *bd;\n\n\tmemset(&props, 0, sizeof(struct backlight_properties));\n\tprops.type = BACKLIGHT_PLATFORM;\n\tprops.max_brightness = SAMSUNGQ10_BL_MAX_INTENSITY;\n\tbd = backlight_device_register(\"samsung\", &pdev->dev, NULL,\n\t\t\t\t       &samsungq10_bl_ops, &props);\n\tif (IS_ERR(bd))\n\t\treturn PTR_ERR(bd);\n\n\tplatform_set_drvdata(pdev, bd);\n\n\treturn 0;\n}\n\nstatic void samsungq10_remove(struct platform_device *pdev)\n{\n\n\tstruct backlight_device *bd = platform_get_drvdata(pdev);\n\n\tbacklight_device_unregister(bd);\n}\n\nstatic struct platform_driver samsungq10_driver = {\n\t.driver\t\t= {\n\t\t.name\t= KBUILD_MODNAME,\n\t},\n\t.probe\t\t= samsungq10_probe,\n\t.remove_new\t= samsungq10_remove,\n};\n\nstatic struct platform_device *samsungq10_device;\n\nstatic int __init dmi_check_callback(const struct dmi_system_id *id)\n{\n\tprintk(KERN_INFO KBUILD_MODNAME \": found model '%s'\\n\", id->ident);\n\treturn 1;\n}\n\nstatic const struct dmi_system_id samsungq10_dmi_table[] __initconst = {\n\t{\n\t\t.ident = \"Samsung Q10\",\n\t\t.matches = {\n\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Samsung\"),\n\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"SQ10\"),\n\t\t},\n\t\t.callback = dmi_check_callback,\n\t},\n\t{\n\t\t.ident = \"Samsung Q20\",\n\t\t.matches = {\n\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"SAMSUNG Electronics\"),\n\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"SENS Q20\"),\n\t\t},\n\t\t.callback = dmi_check_callback,\n\t},\n\t{\n\t\t.ident = \"Samsung Q25\",\n\t\t.matches = {\n\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"SAMSUNG Electronics\"),\n\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"NQ25\"),\n\t\t},\n\t\t.callback = dmi_check_callback,\n\t},\n\t{\n\t\t.ident = \"Dell Latitude X200\",\n\t\t.matches = {\n\t\t\tDMI_MATCH(DMI_SYS_VENDOR, \"Dell Computer Corporation\"),\n\t\t\tDMI_MATCH(DMI_PRODUCT_NAME, \"X200\"),\n\t\t},\n\t\t.callback = dmi_check_callback,\n\t},\n\t{ },\n};\nMODULE_DEVICE_TABLE(dmi, samsungq10_dmi_table);\n\nstatic int __init samsungq10_init(void)\n{\n\tif (!force && !dmi_check_system(samsungq10_dmi_table))\n\t\treturn -ENODEV;\n\n\tec_handle = ec_get_handle();\n\n\tif (!ec_handle)\n\t\treturn -ENODEV;\n\n\tsamsungq10_device = platform_create_bundle(&samsungq10_driver,\n\t\t\t\t\t\t   samsungq10_probe,\n\t\t\t\t\t\t   NULL, 0, NULL, 0);\n\n\treturn PTR_ERR_OR_ZERO(samsungq10_device);\n}\n\nstatic void __exit samsungq10_exit(void)\n{\n\tplatform_device_unregister(samsungq10_device);\n\tplatform_driver_unregister(&samsungq10_driver);\n}\n\nmodule_init(samsungq10_init);\nmodule_exit(samsungq10_exit);\n\nMODULE_AUTHOR(\"Frederick van der Wyck <fvanderwyck@gmail.com>\");\nMODULE_DESCRIPTION(\"Samsung Q10 Driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}