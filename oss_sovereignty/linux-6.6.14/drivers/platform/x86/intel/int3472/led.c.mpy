{
  "module_name": "led.c",
  "hash_id": "f864d519dcd93f0b80e078a1084a24eddc3678ab7a50ac259e4ca1c729ee6447",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/intel/int3472/led.c",
  "human_readable_source": "\n \n\n#include <linux/acpi.h>\n#include <linux/gpio/consumer.h>\n#include <linux/leds.h>\n#include \"common.h\"\n\nstatic int int3472_pled_set(struct led_classdev *led_cdev,\n\t\t\t\t     enum led_brightness brightness)\n{\n\tstruct int3472_discrete_device *int3472 =\n\t\tcontainer_of(led_cdev, struct int3472_discrete_device, pled.classdev);\n\n\tgpiod_set_value_cansleep(int3472->pled.gpio, brightness);\n\treturn 0;\n}\n\nint skl_int3472_register_pled(struct int3472_discrete_device *int3472,\n\t\t\t      struct acpi_resource_gpio *agpio, u32 polarity)\n{\n\tchar *p, *path = agpio->resource_source.string_ptr;\n\tint ret;\n\n\tif (int3472->pled.classdev.dev)\n\t\treturn -EBUSY;\n\n\tint3472->pled.gpio = acpi_get_and_request_gpiod(path, agpio->pin_table[0],\n\t\t\t\t\t\t\t     \"int3472,privacy-led\");\n\tif (IS_ERR(int3472->pled.gpio))\n\t\treturn dev_err_probe(int3472->dev, PTR_ERR(int3472->pled.gpio),\n\t\t\t\t     \"getting privacy LED GPIO\\n\");\n\n\tif (polarity == GPIO_ACTIVE_LOW)\n\t\tgpiod_toggle_active_low(int3472->pled.gpio);\n\n\t \n\tgpiod_direction_output(int3472->pled.gpio, 0);\n\n\t \n\tsnprintf(int3472->pled.name, sizeof(int3472->pled.name),\n\t\t \"%s::privacy_led\", acpi_dev_name(int3472->sensor));\n\tp = strchr(int3472->pled.name, ':');\n\tif (p)\n\t\t*p = '_';\n\n\tint3472->pled.classdev.name = int3472->pled.name;\n\tint3472->pled.classdev.max_brightness = 1;\n\tint3472->pled.classdev.brightness_set_blocking = int3472_pled_set;\n\n\tret = led_classdev_register(int3472->dev, &int3472->pled.classdev);\n\tif (ret)\n\t\tgoto err_free_gpio;\n\n\tint3472->pled.lookup.provider = int3472->pled.name;\n\tint3472->pled.lookup.dev_id = int3472->sensor_name;\n\tint3472->pled.lookup.con_id = \"privacy-led\";\n\tled_add_lookup(&int3472->pled.lookup);\n\n\treturn 0;\n\nerr_free_gpio:\n\tgpiod_put(int3472->pled.gpio);\n\treturn ret;\n}\n\nvoid skl_int3472_unregister_pled(struct int3472_discrete_device *int3472)\n{\n\tif (IS_ERR_OR_NULL(int3472->pled.classdev.dev))\n\t\treturn;\n\n\tled_remove_lookup(&int3472->pled.lookup);\n\tled_classdev_unregister(&int3472->pled.classdev);\n\tgpiod_put(int3472->pled.gpio);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}