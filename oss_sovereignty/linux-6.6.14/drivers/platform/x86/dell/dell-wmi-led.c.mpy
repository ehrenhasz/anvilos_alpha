{
  "module_name": "dell-wmi-led.c",
  "hash_id": "abd55f578f347c1cac35cd76c7e9d99603613012d6141dca26fe588691e8f4b3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/dell/dell-wmi-led.c",
  "human_readable_source": " \n\n#include <linux/acpi.h>\n#include <linux/leds.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\nMODULE_AUTHOR(\"Louis Davis/Jim Dailey\");\nMODULE_DESCRIPTION(\"Dell LED Control Driver\");\nMODULE_LICENSE(\"GPL\");\n\n#define DELL_LED_BIOS_GUID \"F6E4FE6E-909D-47cb-8BAB-C9F6F2F8D396\"\nMODULE_ALIAS(\"wmi:\" DELL_LED_BIOS_GUID);\n\n \n#define INVALID_DEVICE_ID\t250\n#define INVALID_PARAMETER\t251\n#define INVALID_BUFFER\t\t252\n#define INTERFACE_ERROR\t\t253\n#define UNSUPPORTED_COMMAND\t254\n#define UNSPECIFIED_ERROR\t255\n\n \n#define DEVICE_ID_PANEL_BACK\t1\n\n \n#define CMD_LED_ON\t16\n#define CMD_LED_OFF\t17\n#define CMD_LED_BLINK\t18\n\nstruct bios_args {\n\tunsigned char length;\n\tunsigned char result_code;\n\tunsigned char device_id;\n\tunsigned char command;\n\tunsigned char on_time;\n\tunsigned char off_time;\n};\n\nstatic int dell_led_perform_fn(u8 length, u8 result_code, u8 device_id,\n\t\t\t       u8 command, u8 on_time, u8 off_time)\n{\n\tstruct acpi_buffer output = { ACPI_ALLOCATE_BUFFER, NULL };\n\tstruct bios_args *bios_return;\n\tstruct acpi_buffer input;\n\tunion acpi_object *obj;\n\tacpi_status status;\n\tu8 return_code;\n\n\tstruct bios_args args = {\n\t\t.length = length,\n\t\t.result_code = result_code,\n\t\t.device_id = device_id,\n\t\t.command = command,\n\t\t.on_time = on_time,\n\t\t.off_time = off_time\n\t};\n\n\tinput.length = sizeof(struct bios_args);\n\tinput.pointer = &args;\n\n\tstatus = wmi_evaluate_method(DELL_LED_BIOS_GUID, 0, 1, &input, &output);\n\tif (ACPI_FAILURE(status))\n\t\treturn status;\n\n\tobj = output.pointer;\n\n\tif (!obj)\n\t\treturn -EINVAL;\n\tif (obj->type != ACPI_TYPE_BUFFER) {\n\t\tkfree(obj);\n\t\treturn -EINVAL;\n\t}\n\n\tbios_return = ((struct bios_args *)obj->buffer.pointer);\n\treturn_code = bios_return->result_code;\n\n\tkfree(obj);\n\n\treturn return_code;\n}\n\nstatic int led_on(void)\n{\n\treturn dell_led_perform_fn(3,\t \n\t\tINTERFACE_ERROR,\t \n\t\tDEVICE_ID_PANEL_BACK,\t \n\t\tCMD_LED_ON,\t\t \n\t\t0,\t\t\t \n\t\t0);\t\t\t \n}\n\nstatic int led_off(void)\n{\n\treturn dell_led_perform_fn(3,\t \n\t\tINTERFACE_ERROR,\t \n\t\tDEVICE_ID_PANEL_BACK,\t \n\t\tCMD_LED_OFF,\t\t \n\t\t0,\t\t\t \n\t\t0);\t\t\t \n}\n\nstatic int led_blink(unsigned char on_eighths, unsigned char off_eighths)\n{\n\treturn dell_led_perform_fn(5,\t \n\t\tINTERFACE_ERROR,\t \n\t\tDEVICE_ID_PANEL_BACK,\t \n\t\tCMD_LED_BLINK,\t\t \n\t\ton_eighths,\t\t \n\t\toff_eighths);\t\t \n}\n\nstatic void dell_led_set(struct led_classdev *led_cdev,\n\t\t\t enum led_brightness value)\n{\n\tif (value == LED_OFF)\n\t\tled_off();\n\telse\n\t\tled_on();\n}\n\nstatic int dell_led_blink(struct led_classdev *led_cdev,\n\t\t\t  unsigned long *delay_on, unsigned long *delay_off)\n{\n\tunsigned long on_eighths;\n\tunsigned long off_eighths;\n\n\t \n\n\ton_eighths = DIV_ROUND_UP(*delay_on, 125);\n\ton_eighths = clamp_t(unsigned long, on_eighths, 1, 255);\n\t*delay_on = on_eighths * 125;\n\n\toff_eighths = DIV_ROUND_UP(*delay_off, 125);\n\toff_eighths = clamp_t(unsigned long, off_eighths, 1, 255);\n\t*delay_off = off_eighths * 125;\n\n\tled_blink(on_eighths, off_eighths);\n\n\treturn 0;\n}\n\nstatic struct led_classdev dell_led = {\n\t.name\t\t= \"dell::lid\",\n\t.brightness\t= LED_OFF,\n\t.max_brightness = 1,\n\t.brightness_set = dell_led_set,\n\t.blink_set\t= dell_led_blink,\n\t.flags\t\t= LED_CORE_SUSPENDRESUME,\n};\n\nstatic int __init dell_led_init(void)\n{\n\tint error = 0;\n\n\tif (!wmi_has_guid(DELL_LED_BIOS_GUID))\n\t\treturn -ENODEV;\n\n\terror = led_off();\n\tif (error != 0)\n\t\treturn -ENODEV;\n\n\treturn led_classdev_register(NULL, &dell_led);\n}\n\nstatic void __exit dell_led_exit(void)\n{\n\tled_classdev_unregister(&dell_led);\n\n\tled_off();\n}\n\nmodule_init(dell_led_init);\nmodule_exit(dell_led_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}