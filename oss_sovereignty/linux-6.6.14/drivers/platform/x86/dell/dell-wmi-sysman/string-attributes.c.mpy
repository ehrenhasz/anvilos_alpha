{
  "module_name": "string-attributes.c",
  "hash_id": "2844fc828b60f9351c708d918f30758051175728f91840eb3d85d2077dc95fe8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/dell/dell-wmi-sysman/string-attributes.c",
  "human_readable_source": "\n \n\n#include \"dell-wmi-sysman.h\"\n\nenum string_properties {MIN_LEN = 6, MAX_LEN};\n\nget_instance_id(str);\n\nstatic ssize_t current_value_show(struct kobject *kobj, struct kobj_attribute *attr, char *buf)\n{\n\tint instance_id = get_str_instance_id(kobj);\n\tunion acpi_object *obj;\n\tssize_t ret;\n\n\tif (instance_id < 0)\n\t\treturn -EIO;\n\n\t \n\tobj = get_wmiobj_pointer(instance_id, DELL_WMI_BIOS_STRING_ATTRIBUTE_GUID);\n\tif (!obj)\n\t\treturn -EIO;\n\tif (obj->package.elements[CURRENT_VAL].type != ACPI_TYPE_STRING) {\n\t\tkfree(obj);\n\t\treturn -EINVAL;\n\t}\n\tret = snprintf(buf, PAGE_SIZE, \"%s\\n\", obj->package.elements[CURRENT_VAL].string.pointer);\n\tkfree(obj);\n\treturn ret;\n}\n\n \nstatic int validate_str_input(int instance_id, const char *buf)\n{\n\tint in_len = strlen(buf);\n\n\tif ((in_len < wmi_priv.str_data[instance_id].min_length) ||\n\t\t\t(in_len > wmi_priv.str_data[instance_id].max_length))\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nattribute_s_property_show(display_name_language_code, str);\nstatic struct kobj_attribute str_displ_langcode =\n\t\t__ATTR_RO(display_name_language_code);\n\nattribute_s_property_show(display_name, str);\nstatic struct kobj_attribute str_displ_name =\n\t\t__ATTR_RO(display_name);\n\nattribute_s_property_show(default_value, str);\nstatic struct kobj_attribute str_default_val =\n\t\t__ATTR_RO(default_value);\n\nattribute_property_store(current_value, str);\nstatic struct kobj_attribute str_current_val =\n\t\t__ATTR_RW_MODE(current_value, 0600);\n\nattribute_s_property_show(dell_modifier, str);\nstatic struct kobj_attribute str_modifier =\n\t\t__ATTR_RO(dell_modifier);\n\nattribute_n_property_show(min_length, str);\nstatic struct kobj_attribute str_min_length =\n\t\t__ATTR_RO(min_length);\n\nattribute_n_property_show(max_length, str);\nstatic struct kobj_attribute str_max_length =\n\t\t__ATTR_RO(max_length);\n\nstatic ssize_t type_show(struct kobject *kobj, struct kobj_attribute *attr,\n\t\t\t char *buf)\n{\n\treturn sprintf(buf, \"string\\n\");\n}\nstatic struct kobj_attribute str_type =\n\t__ATTR_RO(type);\n\nstatic struct attribute *str_attrs[] = {\n\t&str_displ_langcode.attr,\n\t&str_displ_name.attr,\n\t&str_default_val.attr,\n\t&str_current_val.attr,\n\t&str_modifier.attr,\n\t&str_min_length.attr,\n\t&str_max_length.attr,\n\t&str_type.attr,\n\tNULL,\n};\n\nstatic const struct attribute_group str_attr_group = {\n\t.attrs = str_attrs,\n};\n\nint alloc_str_data(void)\n{\n\tint ret = 0;\n\n\twmi_priv.str_instances_count = get_instance_count(DELL_WMI_BIOS_STRING_ATTRIBUTE_GUID);\n\twmi_priv.str_data = kcalloc(wmi_priv.str_instances_count,\n\t\t\t\t\tsizeof(struct str_data), GFP_KERNEL);\n\tif (!wmi_priv.str_data) {\n\t\twmi_priv.str_instances_count = 0;\n\t\tret = -ENOMEM;\n\t}\n\treturn ret;\n}\n\n \nint populate_str_data(union acpi_object *str_obj, int instance_id, struct kobject *attr_name_kobj)\n{\n\twmi_priv.str_data[instance_id].attr_name_kobj = attr_name_kobj;\n\tif (check_property_type(str, ATTR_NAME, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.str_data[instance_id].attribute_name,\n\t\t     str_obj[ATTR_NAME].string.pointer);\n\tif (check_property_type(str, DISPL_NAME_LANG_CODE, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.str_data[instance_id].display_name_language_code,\n\t\t     str_obj[DISPL_NAME_LANG_CODE].string.pointer);\n\tif (check_property_type(str, DISPLAY_NAME, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.str_data[instance_id].display_name,\n\t\t     str_obj[DISPLAY_NAME].string.pointer);\n\tif (check_property_type(str, DEFAULT_VAL, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.str_data[instance_id].default_value,\n\t\t     str_obj[DEFAULT_VAL].string.pointer);\n\tif (check_property_type(str, MODIFIER, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.str_data[instance_id].dell_modifier,\n\t\t     str_obj[MODIFIER].string.pointer);\n\tif (check_property_type(str, MIN_LEN, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\twmi_priv.str_data[instance_id].min_length = (uintptr_t)str_obj[MIN_LEN].string.pointer;\n\tif (check_property_type(str, MAX_LEN, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\twmi_priv.str_data[instance_id].max_length = (uintptr_t) str_obj[MAX_LEN].string.pointer;\n\n\treturn sysfs_create_group(attr_name_kobj, &str_attr_group);\n}\n\n \nvoid exit_str_attributes(void)\n{\n\tint instance_id;\n\n\tfor (instance_id = 0; instance_id < wmi_priv.str_instances_count; instance_id++) {\n\t\tif (wmi_priv.str_data[instance_id].attr_name_kobj)\n\t\t\tsysfs_remove_group(wmi_priv.str_data[instance_id].attr_name_kobj,\n\t\t\t\t\t\t\t\t&str_attr_group);\n\t}\n\twmi_priv.str_instances_count = 0;\n\n\tkfree(wmi_priv.str_data);\n\twmi_priv.str_data = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}