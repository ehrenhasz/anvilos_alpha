{
  "module_name": "enum-attributes.c",
  "hash_id": "c2af380b254891b4363dd7da80ff571f6ce8b0db6d7967901b10a3aa48a576e5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/dell/dell-wmi-sysman/enum-attributes.c",
  "human_readable_source": "\n \n\n#include \"dell-wmi-sysman.h\"\n\nget_instance_id(enumeration);\n\nstatic ssize_t current_value_show(struct kobject *kobj, struct kobj_attribute *attr, char *buf)\n{\n\tint instance_id = get_enumeration_instance_id(kobj);\n\tunion acpi_object *obj;\n\tssize_t ret;\n\n\tif (instance_id < 0)\n\t\treturn instance_id;\n\n\t \n\tobj = get_wmiobj_pointer(instance_id, DELL_WMI_BIOS_ENUMERATION_ATTRIBUTE_GUID);\n\tif (!obj)\n\t\treturn -EIO;\n\tif (obj->package.elements[CURRENT_VAL].type != ACPI_TYPE_STRING) {\n\t\tkfree(obj);\n\t\treturn -EINVAL;\n\t}\n\tret = snprintf(buf, PAGE_SIZE, \"%s\\n\", obj->package.elements[CURRENT_VAL].string.pointer);\n\tkfree(obj);\n\treturn ret;\n}\n\n \nstatic int validate_enumeration_input(int instance_id, const char *buf)\n{\n\tchar *options, *tmp, *p;\n\tint ret = -EINVAL;\n\n\toptions = tmp = kstrdup(wmi_priv.enumeration_data[instance_id].possible_values,\n\t\t\t\t GFP_KERNEL);\n\tif (!options)\n\t\treturn -ENOMEM;\n\n\twhile ((p = strsep(&options, \";\")) != NULL) {\n\t\tif (!*p)\n\t\t\tcontinue;\n\t\tif (!strcasecmp(p, buf)) {\n\t\t\tret = 0;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tkfree(tmp);\n\treturn ret;\n}\n\nattribute_s_property_show(display_name_language_code, enumeration);\nstatic struct kobj_attribute displ_langcode =\n\t\t__ATTR_RO(display_name_language_code);\n\nattribute_s_property_show(display_name, enumeration);\nstatic struct kobj_attribute displ_name =\n\t\t__ATTR_RO(display_name);\n\nattribute_s_property_show(default_value, enumeration);\nstatic struct kobj_attribute default_val =\n\t\t__ATTR_RO(default_value);\n\nattribute_property_store(current_value, enumeration);\nstatic struct kobj_attribute current_val =\n\t\t__ATTR_RW_MODE(current_value, 0600);\n\nattribute_s_property_show(dell_modifier, enumeration);\nstatic struct kobj_attribute modifier =\n\t\t__ATTR_RO(dell_modifier);\n\nattribute_s_property_show(dell_value_modifier, enumeration);\nstatic struct kobj_attribute value_modfr =\n\t\t__ATTR_RO(dell_value_modifier);\n\nattribute_s_property_show(possible_values, enumeration);\nstatic struct kobj_attribute poss_val =\n\t\t__ATTR_RO(possible_values);\n\nstatic ssize_t type_show(struct kobject *kobj, struct kobj_attribute *attr,\n\t\t\t char *buf)\n{\n\treturn sprintf(buf, \"enumeration\\n\");\n}\nstatic struct kobj_attribute type =\n\t\t__ATTR_RO(type);\n\nstatic struct attribute *enumeration_attrs[] = {\n\t&displ_langcode.attr,\n\t&displ_name.attr,\n\t&default_val.attr,\n\t&current_val.attr,\n\t&modifier.attr,\n\t&value_modfr.attr,\n\t&poss_val.attr,\n\t&type.attr,\n\tNULL,\n};\n\nstatic const struct attribute_group enumeration_attr_group = {\n\t.attrs = enumeration_attrs,\n};\n\nint alloc_enum_data(void)\n{\n\tint ret = 0;\n\n\twmi_priv.enumeration_instances_count =\n\t\tget_instance_count(DELL_WMI_BIOS_ENUMERATION_ATTRIBUTE_GUID);\n\twmi_priv.enumeration_data = kcalloc(wmi_priv.enumeration_instances_count,\n\t\t\t\t\tsizeof(struct enumeration_data), GFP_KERNEL);\n\tif (!wmi_priv.enumeration_data) {\n\t\twmi_priv.enumeration_instances_count = 0;\n\t\tret = -ENOMEM;\n\t}\n\treturn ret;\n}\n\n \nint populate_enum_data(union acpi_object *enumeration_obj, int instance_id,\n\t\t\tstruct kobject *attr_name_kobj, u32 enum_property_count)\n{\n\tint i, next_obj, value_modifier_count, possible_values_count;\n\n\twmi_priv.enumeration_data[instance_id].attr_name_kobj = attr_name_kobj;\n\tif (check_property_type(enumeration, ATTR_NAME, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.enumeration_data[instance_id].attribute_name,\n\t\tenumeration_obj[ATTR_NAME].string.pointer);\n\tif (check_property_type(enumeration, DISPL_NAME_LANG_CODE, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.enumeration_data[instance_id].display_name_language_code,\n\t\tenumeration_obj[DISPL_NAME_LANG_CODE].string.pointer);\n\tif (check_property_type(enumeration, DISPLAY_NAME, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.enumeration_data[instance_id].display_name,\n\t\tenumeration_obj[DISPLAY_NAME].string.pointer);\n\tif (check_property_type(enumeration, DEFAULT_VAL, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.enumeration_data[instance_id].default_value,\n\t\tenumeration_obj[DEFAULT_VAL].string.pointer);\n\tif (check_property_type(enumeration, MODIFIER, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.enumeration_data[instance_id].dell_modifier,\n\t\tenumeration_obj[MODIFIER].string.pointer);\n\n\tnext_obj = MODIFIER + 1;\n\n\tif (next_obj >= enum_property_count)\n\t\treturn -EINVAL;\n\n\tif (check_property_type(enumeration, next_obj, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\tvalue_modifier_count = (uintptr_t)enumeration_obj[next_obj++].string.pointer;\n\n\tfor (i = 0; i < value_modifier_count; i++) {\n\t\tif (next_obj >= enum_property_count)\n\t\t\treturn -EINVAL;\n\t\tif (check_property_type(enumeration, next_obj, ACPI_TYPE_STRING))\n\t\t\treturn -EINVAL;\n\t\tstrcat(wmi_priv.enumeration_data[instance_id].dell_value_modifier,\n\t\t\tenumeration_obj[next_obj++].string.pointer);\n\t\tstrcat(wmi_priv.enumeration_data[instance_id].dell_value_modifier, \";\");\n\t}\n\n\tif (next_obj >= enum_property_count)\n\t\treturn -EINVAL;\n\n\tif (check_property_type(enumeration, next_obj, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\tpossible_values_count = (uintptr_t) enumeration_obj[next_obj++].string.pointer;\n\n\tfor (i = 0; i < possible_values_count; i++) {\n\t\tif (next_obj >= enum_property_count)\n\t\t\treturn -EINVAL;\n\t\tif (check_property_type(enumeration, next_obj, ACPI_TYPE_STRING))\n\t\t\treturn -EINVAL;\n\t\tstrcat(wmi_priv.enumeration_data[instance_id].possible_values,\n\t\t\tenumeration_obj[next_obj++].string.pointer);\n\t\tstrcat(wmi_priv.enumeration_data[instance_id].possible_values, \";\");\n\t}\n\n\treturn sysfs_create_group(attr_name_kobj, &enumeration_attr_group);\n}\n\n \nvoid exit_enum_attributes(void)\n{\n\tint instance_id;\n\n\tfor (instance_id = 0; instance_id < wmi_priv.enumeration_instances_count; instance_id++) {\n\t\tif (wmi_priv.enumeration_data[instance_id].attr_name_kobj)\n\t\t\tsysfs_remove_group(wmi_priv.enumeration_data[instance_id].attr_name_kobj,\n\t\t\t\t\t\t\t\t&enumeration_attr_group);\n\t}\n\twmi_priv.enumeration_instances_count = 0;\n\n\tkfree(wmi_priv.enumeration_data);\n\twmi_priv.enumeration_data = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}