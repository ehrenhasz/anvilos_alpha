{
  "module_name": "int-attributes.c",
  "hash_id": "640003a978cfaa029936daf575687b338d70d7508aeb5f07aafb848f6c7fc04b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/dell/dell-wmi-sysman/int-attributes.c",
  "human_readable_source": "\n \n\n#include \"dell-wmi-sysman.h\"\n\nenum int_properties {MIN_VALUE = 6, MAX_VALUE, SCALAR_INCR};\n\nget_instance_id(integer);\n\nstatic ssize_t current_value_show(struct kobject *kobj, struct kobj_attribute *attr, char *buf)\n{\n\tint instance_id = get_integer_instance_id(kobj);\n\tunion acpi_object *obj;\n\tssize_t ret;\n\n\tif (instance_id < 0)\n\t\treturn instance_id;\n\n\t \n\tobj = get_wmiobj_pointer(instance_id, DELL_WMI_BIOS_INTEGER_ATTRIBUTE_GUID);\n\tif (!obj)\n\t\treturn -EIO;\n\tif (obj->package.elements[CURRENT_VAL].type != ACPI_TYPE_INTEGER) {\n\t\tkfree(obj);\n\t\treturn -EINVAL;\n\t}\n\tret = snprintf(buf, PAGE_SIZE, \"%lld\\n\", obj->package.elements[CURRENT_VAL].integer.value);\n\tkfree(obj);\n\treturn ret;\n}\n\n \nstatic int validate_integer_input(int instance_id, char *buf)\n{\n\tint in_val;\n\tint ret;\n\n\tret = kstrtoint(buf, 0, &in_val);\n\tif (ret)\n\t\treturn ret;\n\tif (in_val < wmi_priv.integer_data[instance_id].min_value ||\n\t\t\tin_val > wmi_priv.integer_data[instance_id].max_value)\n\t\treturn -EINVAL;\n\n\t \n\tif (*buf == '+')\n\t\tmemmove(buf, (buf + 1), strlen(buf + 1) + 1);\n\n\treturn ret;\n}\n\nattribute_s_property_show(display_name_language_code, integer);\nstatic struct kobj_attribute integer_displ_langcode =\n\t__ATTR_RO(display_name_language_code);\n\nattribute_s_property_show(display_name, integer);\nstatic struct kobj_attribute integer_displ_name =\n\t__ATTR_RO(display_name);\n\nattribute_n_property_show(default_value, integer);\nstatic struct kobj_attribute integer_default_val =\n\t__ATTR_RO(default_value);\n\nattribute_property_store(current_value, integer);\nstatic struct kobj_attribute integer_current_val =\n\t__ATTR_RW_MODE(current_value, 0600);\n\nattribute_s_property_show(dell_modifier, integer);\nstatic struct kobj_attribute integer_modifier =\n\t__ATTR_RO(dell_modifier);\n\nattribute_n_property_show(min_value, integer);\nstatic struct kobj_attribute integer_lower_bound =\n\t__ATTR_RO(min_value);\n\nattribute_n_property_show(max_value, integer);\nstatic struct kobj_attribute integer_upper_bound =\n\t__ATTR_RO(max_value);\n\nattribute_n_property_show(scalar_increment, integer);\nstatic struct kobj_attribute integer_scalar_increment =\n\t__ATTR_RO(scalar_increment);\n\nstatic ssize_t type_show(struct kobject *kobj, struct kobj_attribute *attr,\n\t\t\t char *buf)\n{\n\treturn sprintf(buf, \"integer\\n\");\n}\nstatic struct kobj_attribute integer_type =\n\t__ATTR_RO(type);\n\nstatic struct attribute *integer_attrs[] = {\n\t&integer_displ_langcode.attr,\n\t&integer_displ_name.attr,\n\t&integer_default_val.attr,\n\t&integer_current_val.attr,\n\t&integer_modifier.attr,\n\t&integer_lower_bound.attr,\n\t&integer_upper_bound.attr,\n\t&integer_scalar_increment.attr,\n\t&integer_type.attr,\n\tNULL,\n};\n\nstatic const struct attribute_group integer_attr_group = {\n\t.attrs = integer_attrs,\n};\n\nint alloc_int_data(void)\n{\n\tint ret = 0;\n\n\twmi_priv.integer_instances_count = get_instance_count(DELL_WMI_BIOS_INTEGER_ATTRIBUTE_GUID);\n\twmi_priv.integer_data = kcalloc(wmi_priv.integer_instances_count,\n\t\t\t\t\tsizeof(struct integer_data), GFP_KERNEL);\n\tif (!wmi_priv.integer_data) {\n\t\twmi_priv.integer_instances_count = 0;\n\t\tret = -ENOMEM;\n\t}\n\treturn ret;\n}\n\n \nint populate_int_data(union acpi_object *integer_obj, int instance_id,\n\t\t\tstruct kobject *attr_name_kobj)\n{\n\twmi_priv.integer_data[instance_id].attr_name_kobj = attr_name_kobj;\n\tif (check_property_type(integer, ATTR_NAME, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.integer_data[instance_id].attribute_name,\n\t\tinteger_obj[ATTR_NAME].string.pointer);\n\tif (check_property_type(integer, DISPL_NAME_LANG_CODE, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.integer_data[instance_id].display_name_language_code,\n\t\tinteger_obj[DISPL_NAME_LANG_CODE].string.pointer);\n\tif (check_property_type(integer, DISPLAY_NAME, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.integer_data[instance_id].display_name,\n\t\tinteger_obj[DISPLAY_NAME].string.pointer);\n\tif (check_property_type(integer, DEFAULT_VAL, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\twmi_priv.integer_data[instance_id].default_value =\n\t\t(uintptr_t)integer_obj[DEFAULT_VAL].string.pointer;\n\tif (check_property_type(integer, MODIFIER, ACPI_TYPE_STRING))\n\t\treturn -EINVAL;\n\tstrlcpy_attr(wmi_priv.integer_data[instance_id].dell_modifier,\n\t\tinteger_obj[MODIFIER].string.pointer);\n\tif (check_property_type(integer, MIN_VALUE, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\twmi_priv.integer_data[instance_id].min_value =\n\t\t(uintptr_t)integer_obj[MIN_VALUE].string.pointer;\n\tif (check_property_type(integer, MAX_VALUE, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\twmi_priv.integer_data[instance_id].max_value =\n\t\t(uintptr_t)integer_obj[MAX_VALUE].string.pointer;\n\tif (check_property_type(integer, SCALAR_INCR, ACPI_TYPE_INTEGER))\n\t\treturn -EINVAL;\n\twmi_priv.integer_data[instance_id].scalar_increment =\n\t\t(uintptr_t)integer_obj[SCALAR_INCR].string.pointer;\n\n\treturn sysfs_create_group(attr_name_kobj, &integer_attr_group);\n}\n\n \nvoid exit_int_attributes(void)\n{\n\tint instance_id;\n\n\tfor (instance_id = 0; instance_id < wmi_priv.integer_instances_count; instance_id++) {\n\t\tif (wmi_priv.integer_data[instance_id].attr_name_kobj)\n\t\t\tsysfs_remove_group(wmi_priv.integer_data[instance_id].attr_name_kobj,\n\t\t\t\t\t\t\t\t&integer_attr_group);\n\t}\n\twmi_priv.integer_instances_count = 0;\n\n\tkfree(wmi_priv.integer_data);\n\twmi_priv.integer_data = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}