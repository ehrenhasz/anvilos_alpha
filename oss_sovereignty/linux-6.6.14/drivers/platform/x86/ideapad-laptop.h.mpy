{
  "module_name": "ideapad-laptop.h",
  "hash_id": "b5a74211c785385b3f3dfbd05a6ece9c3bdabd088110bab73ab9b20f065d2269",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/x86/ideapad-laptop.h",
  "human_readable_source": " \n \n\n#ifndef _IDEAPAD_LAPTOP_H_\n#define _IDEAPAD_LAPTOP_H_\n\n#include <linux/acpi.h>\n#include <linux/jiffies.h>\n#include <linux/errno.h>\n\nenum {\n\tVPCCMD_R_VPC1 = 0x10,\n\tVPCCMD_R_BL_MAX,\n\tVPCCMD_R_BL,\n\tVPCCMD_W_BL,\n\tVPCCMD_R_WIFI,\n\tVPCCMD_W_WIFI,\n\tVPCCMD_R_BT,\n\tVPCCMD_W_BT,\n\tVPCCMD_R_BL_POWER,\n\tVPCCMD_R_NOVO,\n\tVPCCMD_R_VPC2,\n\tVPCCMD_R_TOUCHPAD,\n\tVPCCMD_W_TOUCHPAD,\n\tVPCCMD_R_CAMERA,\n\tVPCCMD_W_CAMERA,\n\tVPCCMD_R_3G,\n\tVPCCMD_W_3G,\n\tVPCCMD_R_ODD,  \n\tVPCCMD_W_FAN,\n\tVPCCMD_R_RF,\n\tVPCCMD_W_RF,\n\tVPCCMD_W_YMC = 0x2A,\n\tVPCCMD_R_FAN = 0x2B,\n\tVPCCMD_R_SPECIAL_BUTTONS = 0x31,\n\tVPCCMD_W_BL_POWER = 0x33,\n};\n\nstatic inline int eval_int_with_arg(acpi_handle handle, const char *name, unsigned long arg, unsigned long *res)\n{\n\tstruct acpi_object_list params;\n\tunsigned long long result;\n\tunion acpi_object in_obj;\n\tacpi_status status;\n\n\tparams.count = 1;\n\tparams.pointer = &in_obj;\n\tin_obj.type = ACPI_TYPE_INTEGER;\n\tin_obj.integer.value = arg;\n\n\tstatus = acpi_evaluate_integer(handle, (char *)name, &params, &result);\n\tif (ACPI_FAILURE(status))\n\t\treturn -EIO;\n\n\tif (res)\n\t\t*res = result;\n\n\treturn 0;\n}\n\nstatic inline int eval_vpcr(acpi_handle handle, unsigned long cmd, unsigned long *res)\n{\n\treturn eval_int_with_arg(handle, \"VPCR\", cmd, res);\n}\n\nstatic inline int eval_vpcw(acpi_handle handle, unsigned long cmd, unsigned long data)\n{\n\tstruct acpi_object_list params;\n\tunion acpi_object in_obj[2];\n\tacpi_status status;\n\n\tparams.count = 2;\n\tparams.pointer = in_obj;\n\tin_obj[0].type = ACPI_TYPE_INTEGER;\n\tin_obj[0].integer.value = cmd;\n\tin_obj[1].type = ACPI_TYPE_INTEGER;\n\tin_obj[1].integer.value = data;\n\n\tstatus = acpi_evaluate_object(handle, \"VPCW\", &params, NULL);\n\tif (ACPI_FAILURE(status))\n\t\treturn -EIO;\n\n\treturn 0;\n}\n\n#define IDEAPAD_EC_TIMEOUT 200  \n\nstatic inline int read_ec_data(acpi_handle handle, unsigned long cmd, unsigned long *data)\n{\n\tunsigned long end_jiffies, val;\n\tint err;\n\n\terr = eval_vpcw(handle, 1, cmd);\n\tif (err)\n\t\treturn err;\n\n\tend_jiffies = jiffies + msecs_to_jiffies(IDEAPAD_EC_TIMEOUT) + 1;\n\n\twhile (time_before(jiffies, end_jiffies)) {\n\t\tschedule();\n\n\t\terr = eval_vpcr(handle, 1, &val);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tif (val == 0)\n\t\t\treturn eval_vpcr(handle, 0, data);\n\t}\n\n\tacpi_handle_err(handle, \"timeout in %s\\n\", __func__);\n\n\treturn -ETIMEDOUT;\n}\n\nstatic inline int write_ec_cmd(acpi_handle handle, unsigned long cmd, unsigned long data)\n{\n\tunsigned long end_jiffies, val;\n\tint err;\n\n\terr = eval_vpcw(handle, 0, data);\n\tif (err)\n\t\treturn err;\n\n\terr = eval_vpcw(handle, 1, cmd);\n\tif (err)\n\t\treturn err;\n\n\tend_jiffies = jiffies + msecs_to_jiffies(IDEAPAD_EC_TIMEOUT) + 1;\n\n\twhile (time_before(jiffies, end_jiffies)) {\n\t\tschedule();\n\n\t\terr = eval_vpcr(handle, 1, &val);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tif (val == 0)\n\t\t\treturn 0;\n\t}\n\n\tacpi_handle_err(handle, \"timeout in %s\\n\", __func__);\n\n\treturn -ETIMEDOUT;\n}\n\n#undef IDEAPAD_EC_TIMEOUT\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}