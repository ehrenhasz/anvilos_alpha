{
  "module_name": "properties.c",
  "hash_id": "09f138965c17f8459d4e0ed4a9345a7fe60cf06af4d27b0b4702cf1f4c1af0c8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/chrome/wilco_ec/properties.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/export.h>\n#include <linux/platform_data/wilco-ec.h>\n#include <linux/string.h>\n#include <linux/types.h>\n#include <asm/unaligned.h>\n\n \nenum ec_property_op {\n\tEC_OP_GET = 0,\n\tEC_OP_SET = 1,\n};\n\nstruct ec_property_request {\n\tu8 op;  \n\tu8 property_id[4];  \n\tu8 length;\n\tu8 data[WILCO_EC_PROPERTY_MAX_SIZE];\n} __packed;\n\nstruct ec_property_response {\n\tu8 reserved[2];\n\tu8 op;  \n\tu8 property_id[4];  \n\tu8 length;\n\tu8 data[WILCO_EC_PROPERTY_MAX_SIZE];\n} __packed;\n\nstatic int send_property_msg(struct wilco_ec_device *ec,\n\t\t\t     struct ec_property_request *rq,\n\t\t\t     struct ec_property_response *rs)\n{\n\tstruct wilco_ec_message ec_msg;\n\tint ret;\n\n\tmemset(&ec_msg, 0, sizeof(ec_msg));\n\tec_msg.type = WILCO_EC_MSG_PROPERTY;\n\tec_msg.request_data = rq;\n\tec_msg.request_size = sizeof(*rq);\n\tec_msg.response_data = rs;\n\tec_msg.response_size = sizeof(*rs);\n\n\tret = wilco_ec_mailbox(ec, &ec_msg);\n\tif (ret < 0)\n\t\treturn ret;\n\tif (rs->op != rq->op)\n\t\treturn -EBADMSG;\n\tif (memcmp(rq->property_id, rs->property_id, sizeof(rs->property_id)))\n\t\treturn -EBADMSG;\n\n\treturn 0;\n}\n\nint wilco_ec_get_property(struct wilco_ec_device *ec,\n\t\t\t  struct wilco_ec_property_msg *prop_msg)\n{\n\tstruct ec_property_request rq;\n\tstruct ec_property_response rs;\n\tint ret;\n\n\tmemset(&rq, 0, sizeof(rq));\n\trq.op = EC_OP_GET;\n\tput_unaligned_le32(prop_msg->property_id, rq.property_id);\n\n\tret = send_property_msg(ec, &rq, &rs);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tprop_msg->length = rs.length;\n\tmemcpy(prop_msg->data, rs.data, rs.length);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(wilco_ec_get_property);\n\nint wilco_ec_set_property(struct wilco_ec_device *ec,\n\t\t\t  struct wilco_ec_property_msg *prop_msg)\n{\n\tstruct ec_property_request rq;\n\tstruct ec_property_response rs;\n\tint ret;\n\n\tmemset(&rq, 0, sizeof(rq));\n\trq.op = EC_OP_SET;\n\tput_unaligned_le32(prop_msg->property_id, rq.property_id);\n\trq.length = prop_msg->length;\n\tmemcpy(rq.data, prop_msg->data, prop_msg->length);\n\n\tret = send_property_msg(ec, &rq, &rs);\n\tif (ret < 0)\n\t\treturn ret;\n\tif (rs.length != prop_msg->length)\n\t\treturn -EBADMSG;\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(wilco_ec_set_property);\n\nint wilco_ec_get_byte_property(struct wilco_ec_device *ec, u32 property_id,\n\t\t\t       u8 *val)\n{\n\tstruct wilco_ec_property_msg msg;\n\tint ret;\n\n\tmsg.property_id = property_id;\n\n\tret = wilco_ec_get_property(ec, &msg);\n\tif (ret < 0)\n\t\treturn ret;\n\tif (msg.length != 1)\n\t\treturn -EBADMSG;\n\n\t*val = msg.data[0];\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(wilco_ec_get_byte_property);\n\nint wilco_ec_set_byte_property(struct wilco_ec_device *ec, u32 property_id,\n\t\t\t       u8 val)\n{\n\tstruct wilco_ec_property_msg msg;\n\n\tmsg.property_id = property_id;\n\tmsg.data[0] = val;\n\tmsg.length = 1;\n\n\treturn wilco_ec_set_property(ec, &msg);\n}\nEXPORT_SYMBOL_GPL(wilco_ec_set_byte_property);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}