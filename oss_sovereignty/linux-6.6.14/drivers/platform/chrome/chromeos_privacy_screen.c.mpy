{
  "module_name": "chromeos_privacy_screen.c",
  "hash_id": "cba93893c23a6e1ba3eafef94d2a7fb1c037b7c23b5be89c660c1be81bf49222",
  "original_prompt": "Ingested from linux-6.6.14/drivers/platform/chrome/chromeos_privacy_screen.c",
  "human_readable_source": "\n\n \n\n#include <linux/acpi.h>\n#include <drm/drm_privacy_screen_driver.h>\n\n \n#define PRIV_SCRN_DSM_REVID\t\t1\t \n#define PRIV_SCRN_DSM_FN_GET_STATUS\t1\t \n#define PRIV_SCRN_DSM_FN_ENABLE\t\t2\t \n#define PRIV_SCRN_DSM_FN_DISABLE\t3\t \n\nstatic const guid_t chromeos_privacy_screen_dsm_guid =\n\t\t    GUID_INIT(0xc7033113, 0x8720, 0x4ceb,\n\t\t\t      0x90, 0x90, 0x9d, 0x52, 0xb3, 0xe5, 0x2d, 0x73);\n\nstatic void\nchromeos_privacy_screen_get_hw_state(struct drm_privacy_screen\n\t\t\t\t     *drm_privacy_screen)\n{\n\tunion acpi_object *obj;\n\tacpi_handle handle;\n\tstruct device *privacy_screen =\n\t\tdrm_privacy_screen_get_drvdata(drm_privacy_screen);\n\n\thandle = acpi_device_handle(to_acpi_device(privacy_screen));\n\tobj = acpi_evaluate_dsm(handle, &chromeos_privacy_screen_dsm_guid,\n\t\t\t\tPRIV_SCRN_DSM_REVID,\n\t\t\t\tPRIV_SCRN_DSM_FN_GET_STATUS, NULL);\n\tif (!obj) {\n\t\tdev_err(privacy_screen,\n\t\t\t\"_DSM failed to get privacy-screen state\\n\");\n\t\treturn;\n\t}\n\n\tif (obj->type != ACPI_TYPE_INTEGER)\n\t\tdev_err(privacy_screen,\n\t\t\t\"Bad _DSM to get privacy-screen state\\n\");\n\telse if (obj->integer.value == 1)\n\t\tdrm_privacy_screen->hw_state = drm_privacy_screen->sw_state =\n\t\t\tPRIVACY_SCREEN_ENABLED;\n\telse\n\t\tdrm_privacy_screen->hw_state = drm_privacy_screen->sw_state =\n\t\t\tPRIVACY_SCREEN_DISABLED;\n\n\tACPI_FREE(obj);\n}\n\nstatic int\nchromeos_privacy_screen_set_sw_state(struct drm_privacy_screen\n\t\t\t\t     *drm_privacy_screen,\n\t\t\t\t     enum drm_privacy_screen_status state)\n{\n\tunion acpi_object *obj = NULL;\n\tacpi_handle handle;\n\tstruct device *privacy_screen =\n\t\tdrm_privacy_screen_get_drvdata(drm_privacy_screen);\n\n\thandle = acpi_device_handle(to_acpi_device(privacy_screen));\n\n\tif (state == PRIVACY_SCREEN_DISABLED) {\n\t\tobj = acpi_evaluate_dsm(handle,\n\t\t\t\t\t&chromeos_privacy_screen_dsm_guid,\n\t\t\t\t\tPRIV_SCRN_DSM_REVID,\n\t\t\t\t\tPRIV_SCRN_DSM_FN_DISABLE, NULL);\n\t} else if (state == PRIVACY_SCREEN_ENABLED) {\n\t\tobj = acpi_evaluate_dsm(handle,\n\t\t\t\t\t&chromeos_privacy_screen_dsm_guid,\n\t\t\t\t\tPRIV_SCRN_DSM_REVID,\n\t\t\t\t\tPRIV_SCRN_DSM_FN_ENABLE, NULL);\n\t} else {\n\t\tdev_err(privacy_screen,\n\t\t\t\"Bad attempt to set privacy-screen status to %u\\n\",\n\t\t\tstate);\n\t\treturn -EINVAL;\n\t}\n\n\tif (!obj) {\n\t\tdev_err(privacy_screen,\n\t\t\t\"_DSM failed to set privacy-screen state\\n\");\n\t\treturn -EIO;\n\t}\n\n\tdrm_privacy_screen->hw_state = drm_privacy_screen->sw_state = state;\n\tACPI_FREE(obj);\n\treturn 0;\n}\n\nstatic const struct drm_privacy_screen_ops chromeos_privacy_screen_ops = {\n\t.get_hw_state = chromeos_privacy_screen_get_hw_state,\n\t.set_sw_state = chromeos_privacy_screen_set_sw_state,\n};\n\nstatic int chromeos_privacy_screen_add(struct acpi_device *adev)\n{\n\tstruct drm_privacy_screen *drm_privacy_screen =\n\t\tdrm_privacy_screen_register(&adev->dev,\n\t\t\t\t\t    &chromeos_privacy_screen_ops,\n\t\t\t\t\t    &adev->dev);\n\n\tif (IS_ERR(drm_privacy_screen)) {\n\t\tdev_err(&adev->dev, \"Error registering privacy-screen\\n\");\n\t\treturn PTR_ERR(drm_privacy_screen);\n\t}\n\n\tadev->driver_data = drm_privacy_screen;\n\tdev_info(&adev->dev, \"registered privacy-screen '%s'\\n\",\n\t\t dev_name(&drm_privacy_screen->dev));\n\n\treturn 0;\n}\n\nstatic void chromeos_privacy_screen_remove(struct acpi_device *adev)\n{\n\tstruct drm_privacy_screen *drm_privacy_screen =\tacpi_driver_data(adev);\n\n\tdrm_privacy_screen_unregister(drm_privacy_screen);\n}\n\nstatic const struct acpi_device_id chromeos_privacy_screen_device_ids[] = {\n\t{\"GOOG0010\", 0},  \n\t{}\n};\nMODULE_DEVICE_TABLE(acpi, chromeos_privacy_screen_device_ids);\n\nstatic struct acpi_driver chromeos_privacy_screen_driver = {\n\t.name = \"chromeos_privacy_screen_driver\",\n\t.class = \"ChromeOS\",\n\t.ids = chromeos_privacy_screen_device_ids,\n\t.ops = {\n\t\t.add = chromeos_privacy_screen_add,\n\t\t.remove = chromeos_privacy_screen_remove,\n\t},\n};\n\nmodule_acpi_driver(chromeos_privacy_screen_driver);\nMODULE_LICENSE(\"GPL v2\");\nMODULE_DESCRIPTION(\"ChromeOS ACPI Privacy Screen driver\");\nMODULE_AUTHOR(\"Rajat Jain <rajatja@google.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}