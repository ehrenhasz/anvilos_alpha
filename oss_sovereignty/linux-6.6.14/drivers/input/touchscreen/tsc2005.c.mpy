{
  "module_name": "tsc2005.c",
  "hash_id": "d9b48c8ade54a28221eba2c96bfcdf2ab4dd199af7475be64125a582528dbd73",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/touchscreen/tsc2005.c",
  "human_readable_source": "\n \n\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/spi/spi.h>\n#include <linux/regmap.h>\n#include \"tsc200x-core.h\"\n\nstatic const struct input_id tsc2005_input_id = {\n\t.bustype = BUS_SPI,\n\t.product = 2005,\n};\n\nstatic int tsc2005_cmd(struct device *dev, u8 cmd)\n{\n\tu8 tx = TSC200X_CMD | TSC200X_CMD_12BIT | cmd;\n\tstruct spi_transfer xfer = {\n\t\t.tx_buf         = &tx,\n\t\t.len            = 1,\n\t\t.bits_per_word  = 8,\n\t};\n\tstruct spi_message msg;\n\tstruct spi_device *spi = to_spi_device(dev);\n\tint error;\n\n\tspi_message_init(&msg);\n\tspi_message_add_tail(&xfer, &msg);\n\n\terror = spi_sync(spi, &msg);\n\tif (error) {\n\t\tdev_err(dev, \"%s: failed, command: %x, spi error: %d\\n\",\n\t\t\t__func__, cmd, error);\n\t\treturn error;\n\t}\n\n\treturn 0;\n}\n\nstatic int tsc2005_probe(struct spi_device *spi)\n{\n\tint error;\n\n\tspi->mode = SPI_MODE_0;\n\tspi->bits_per_word = 8;\n\tif (!spi->max_speed_hz)\n\t\tspi->max_speed_hz = TSC2005_SPI_MAX_SPEED_HZ;\n\n\terror = spi_setup(spi);\n\tif (error)\n\t\treturn error;\n\n\treturn tsc200x_probe(&spi->dev, spi->irq, &tsc2005_input_id,\n\t\t\t     devm_regmap_init_spi(spi, &tsc200x_regmap_config),\n\t\t\t     tsc2005_cmd);\n}\n\nstatic void tsc2005_remove(struct spi_device *spi)\n{\n\ttsc200x_remove(&spi->dev);\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id tsc2005_of_match[] = {\n\t{ .compatible = \"ti,tsc2005\" },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, tsc2005_of_match);\n#endif\n\nstatic struct spi_driver tsc2005_driver = {\n\t.driver\t= {\n\t\t.name\t= \"tsc2005\",\n\t\t.of_match_table = of_match_ptr(tsc2005_of_match),\n\t\t.pm\t= pm_sleep_ptr(&tsc200x_pm_ops),\n\t},\n\t.probe\t= tsc2005_probe,\n\t.remove\t= tsc2005_remove,\n};\nmodule_spi_driver(tsc2005_driver);\n\nMODULE_AUTHOR(\"Michael Welling <mwelling@ieee.org>\");\nMODULE_DESCRIPTION(\"TSC2005 Touchscreen Driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"spi:tsc2005\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}