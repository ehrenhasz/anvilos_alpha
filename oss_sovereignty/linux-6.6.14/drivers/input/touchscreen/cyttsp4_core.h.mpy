{
  "module_name": "cyttsp4_core.h",
  "hash_id": "e475e6c59765e3b2017d0a0045ea1d8678fddd9f0bd367917723621dd70fb10b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/touchscreen/cyttsp4_core.h",
  "human_readable_source": " \n \n\n#ifndef _LINUX_CYTTSP4_CORE_H\n#define _LINUX_CYTTSP4_CORE_H\n\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/input.h>\n#include <linux/kernel.h>\n#include <linux/limits.h>\n#include <linux/module.h>\n#include <linux/stringify.h>\n#include <linux/types.h>\n#include <linux/platform_data/cyttsp4.h>\n\n#define CY_REG_BASE\t\t\t0x00\n\n#define CY_POST_CODEL_WDG_RST\t\t0x01\n#define CY_POST_CODEL_CFG_DATA_CRC_FAIL\t0x02\n#define CY_POST_CODEL_PANEL_TEST_FAIL\t0x04\n\n#define CY_NUM_BTN_PER_REG\t\t4\n\n \n#define CY_BYTE_OFS_MASK\t\t0x1F\n#define CY_BOFS_MASK\t\t\t0xE0\n#define CY_BOFS_SHIFT\t\t\t5\n\n#define CY_TMA1036_TCH_REC_SIZE\t\t6\n#define CY_TMA4XX_TCH_REC_SIZE\t\t9\n#define CY_TMA1036_MAX_TCH\t\t0x0E\n#define CY_TMA4XX_MAX_TCH\t\t0x1E\n\n#define CY_NORMAL_ORIGIN\t\t0\t \n#define CY_INVERT_ORIGIN\t\t1\t \n\n \n#define GET_NUM_TOUCHES(x)\t\t((x) & 0x1F)\n#define IS_LARGE_AREA(x)\t\t((x) & 0x20)\n#define IS_BAD_PKT(x)\t\t\t((x) & 0x20)\n#define IS_BOOTLOADER(hst_mode, reset_detect)\t\\\n\t\t((hst_mode) & 0x01 || (reset_detect) != 0)\n#define IS_TMO(t)\t\t\t((t) == 0)\n\n\nenum cyttsp_cmd_bits {\n\tCY_CMD_COMPLETE = (1 << 6),\n};\n\n \n#define CY_WATCHDOG_TIMEOUT\t\t1000\n\n#define CY_MAX_PRINT_SIZE\t\t512\n#ifdef VERBOSE_DEBUG\n#define CY_MAX_PRBUF_SIZE\t\tPIPE_BUF\n#define CY_PR_TRUNCATED\t\t\t\" truncated...\"\n#endif\n\nenum cyttsp4_ic_grpnum {\n\tCY_IC_GRPNUM_RESERVED,\n\tCY_IC_GRPNUM_CMD_REGS,\n\tCY_IC_GRPNUM_TCH_REP,\n\tCY_IC_GRPNUM_DATA_REC,\n\tCY_IC_GRPNUM_TEST_REC,\n\tCY_IC_GRPNUM_PCFG_REC,\n\tCY_IC_GRPNUM_TCH_PARM_VAL,\n\tCY_IC_GRPNUM_TCH_PARM_SIZE,\n\tCY_IC_GRPNUM_RESERVED1,\n\tCY_IC_GRPNUM_RESERVED2,\n\tCY_IC_GRPNUM_OPCFG_REC,\n\tCY_IC_GRPNUM_DDATA_REC,\n\tCY_IC_GRPNUM_MDATA_REC,\n\tCY_IC_GRPNUM_TEST_REGS,\n\tCY_IC_GRPNUM_BTN_KEYS,\n\tCY_IC_GRPNUM_TTHE_REGS,\n\tCY_IC_GRPNUM_NUM\n};\n\nenum cyttsp4_int_state {\n\tCY_INT_NONE,\n\tCY_INT_IGNORE      = (1 << 0),\n\tCY_INT_MODE_CHANGE = (1 << 1),\n\tCY_INT_EXEC_CMD    = (1 << 2),\n\tCY_INT_AWAKE       = (1 << 3),\n};\n\nenum cyttsp4_mode {\n\tCY_MODE_UNKNOWN,\n\tCY_MODE_BOOTLOADER   = (1 << 1),\n\tCY_MODE_OPERATIONAL  = (1 << 2),\n\tCY_MODE_SYSINFO      = (1 << 3),\n\tCY_MODE_CAT          = (1 << 4),\n\tCY_MODE_STARTUP      = (1 << 5),\n\tCY_MODE_LOADER       = (1 << 6),\n\tCY_MODE_CHANGE_MODE  = (1 << 7),\n\tCY_MODE_CHANGED      = (1 << 8),\n\tCY_MODE_CMD_COMPLETE = (1 << 9),\n};\n\nenum cyttsp4_sleep_state {\n\tSS_SLEEP_OFF,\n\tSS_SLEEP_ON,\n\tSS_SLEEPING,\n\tSS_WAKING,\n};\n\nenum cyttsp4_startup_state {\n\tSTARTUP_NONE,\n\tSTARTUP_QUEUED,\n\tSTARTUP_RUNNING,\n};\n\n#define CY_NUM_REVCTRL\t\t\t8\nstruct cyttsp4_cydata {\n\tu8 ttpidh;\n\tu8 ttpidl;\n\tu8 fw_ver_major;\n\tu8 fw_ver_minor;\n\tu8 revctrl[CY_NUM_REVCTRL];\n\tu8 blver_major;\n\tu8 blver_minor;\n\tu8 jtag_si_id3;\n\tu8 jtag_si_id2;\n\tu8 jtag_si_id1;\n\tu8 jtag_si_id0;\n\tu8 mfgid_sz;\n\tu8 cyito_idh;\n\tu8 cyito_idl;\n\tu8 cyito_verh;\n\tu8 cyito_verl;\n\tu8 ttsp_ver_major;\n\tu8 ttsp_ver_minor;\n\tu8 device_info;\n\tu8 mfg_id[];\n} __packed;\n\nstruct cyttsp4_test {\n\tu8 post_codeh;\n\tu8 post_codel;\n} __packed;\n\nstruct cyttsp4_pcfg {\n\tu8 electrodes_x;\n\tu8 electrodes_y;\n\tu8 len_xh;\n\tu8 len_xl;\n\tu8 len_yh;\n\tu8 len_yl;\n\tu8 res_xh;\n\tu8 res_xl;\n\tu8 res_yh;\n\tu8 res_yl;\n\tu8 max_zh;\n\tu8 max_zl;\n\tu8 panel_info0;\n} __packed;\n\nstruct cyttsp4_tch_rec_params {\n\tu8 loc;\n\tu8 size;\n} __packed;\n\n#define CY_NUM_TCH_FIELDS\t\t7\n#define CY_NUM_EXT_TCH_FIELDS\t\t3\nstruct cyttsp4_opcfg {\n\tu8 cmd_ofs;\n\tu8 rep_ofs;\n\tu8 rep_szh;\n\tu8 rep_szl;\n\tu8 num_btns;\n\tu8 tt_stat_ofs;\n\tu8 obj_cfg0;\n\tu8 max_tchs;\n\tu8 tch_rec_size;\n\tstruct cyttsp4_tch_rec_params tch_rec_old[CY_NUM_TCH_FIELDS];\n\tu8 btn_rec_size;\t \n\tu8 btn_diff_ofs;\t \n\tu8 btn_diff_size;\t \n\tstruct cyttsp4_tch_rec_params tch_rec_new[CY_NUM_EXT_TCH_FIELDS];\n} __packed;\n\nstruct cyttsp4_sysinfo_ptr {\n\tstruct cyttsp4_cydata *cydata;\n\tstruct cyttsp4_test *test;\n\tstruct cyttsp4_pcfg *pcfg;\n\tstruct cyttsp4_opcfg *opcfg;\n\tstruct cyttsp4_ddata *ddata;\n\tstruct cyttsp4_mdata *mdata;\n} __packed;\n\nstruct cyttsp4_sysinfo_data {\n\tu8 hst_mode;\n\tu8 reserved;\n\tu8 map_szh;\n\tu8 map_szl;\n\tu8 cydata_ofsh;\n\tu8 cydata_ofsl;\n\tu8 test_ofsh;\n\tu8 test_ofsl;\n\tu8 pcfg_ofsh;\n\tu8 pcfg_ofsl;\n\tu8 opcfg_ofsh;\n\tu8 opcfg_ofsl;\n\tu8 ddata_ofsh;\n\tu8 ddata_ofsl;\n\tu8 mdata_ofsh;\n\tu8 mdata_ofsl;\n} __packed;\n\nenum cyttsp4_tch_abs {\t \n\tCY_TCH_X,\t \n\tCY_TCH_Y,\t \n\tCY_TCH_P,\t \n\tCY_TCH_T,\t \n\tCY_TCH_E,\t \n\tCY_TCH_O,\t \n\tCY_TCH_W,\t \n\tCY_TCH_MAJ,\t \n\tCY_TCH_MIN,\t \n\tCY_TCH_OR,\t \n\tCY_TCH_NUM_ABS\n};\n\nstruct cyttsp4_touch {\n\tint abs[CY_TCH_NUM_ABS];\n};\n\nstruct cyttsp4_tch_abs_params {\n\tsize_t ofs;\t \n\tsize_t size;\t \n\tsize_t max;\t \n\tsize_t bofs;\t \n};\n\nstruct cyttsp4_sysinfo_ofs {\n\tsize_t chip_type;\n\tsize_t cmd_ofs;\n\tsize_t rep_ofs;\n\tsize_t rep_sz;\n\tsize_t num_btns;\n\tsize_t num_btn_regs;\t \n\tsize_t tt_stat_ofs;\n\tsize_t tch_rec_size;\n\tsize_t obj_cfg0;\n\tsize_t max_tchs;\n\tsize_t mode_size;\n\tsize_t data_size;\n\tsize_t map_sz;\n\tsize_t max_x;\n\tsize_t x_origin;\t \n\tsize_t max_y;\n\tsize_t y_origin;\t \n\tsize_t max_p;\n\tsize_t cydata_ofs;\n\tsize_t test_ofs;\n\tsize_t pcfg_ofs;\n\tsize_t opcfg_ofs;\n\tsize_t ddata_ofs;\n\tsize_t mdata_ofs;\n\tsize_t cydata_size;\n\tsize_t test_size;\n\tsize_t pcfg_size;\n\tsize_t opcfg_size;\n\tsize_t ddata_size;\n\tsize_t mdata_size;\n\tsize_t btn_keys_size;\n\tstruct cyttsp4_tch_abs_params tch_abs[CY_TCH_NUM_ABS];\n\tsize_t btn_rec_size;  \n\tsize_t btn_diff_ofs; \n\tsize_t btn_diff_size; \n};\n\nenum cyttsp4_btn_state {\n\tCY_BTN_RELEASED,\n\tCY_BTN_PRESSED,\n\tCY_BTN_NUM_STATE\n};\n\nstruct cyttsp4_btn {\n\tbool enabled;\n\tint state;\t \n\tint key_code;\n};\n\nstruct cyttsp4_sysinfo {\n\tbool ready;\n\tstruct cyttsp4_sysinfo_data si_data;\n\tstruct cyttsp4_sysinfo_ptr si_ptrs;\n\tstruct cyttsp4_sysinfo_ofs si_ofs;\n\tstruct cyttsp4_btn *btn;\t \n\tu8 *btn_rec_data;\t\t \n\tu8 *xy_mode;\t\t\t \n\tu8 *xy_data;\t\t\t \n};\n\nstruct cyttsp4_mt_data {\n\tstruct cyttsp4_mt_platform_data *pdata;\n\tstruct cyttsp4_sysinfo *si;\n\tstruct input_dev *input;\n\tstruct mutex report_lock;\n\tbool is_suspended;\n\tchar phys[NAME_MAX];\n\tint num_prv_tch;\n};\n\nstruct cyttsp4 {\n\tstruct device *dev;\n\tstruct mutex system_lock;\n\tstruct mutex adap_lock;\n\tenum cyttsp4_mode mode;\n\tenum cyttsp4_sleep_state sleep_state;\n\tenum cyttsp4_startup_state startup_state;\n\tint int_status;\n\twait_queue_head_t wait_q;\n\tint irq;\n\tstruct work_struct startup_work;\n\tstruct work_struct watchdog_work;\n\tstruct timer_list watchdog_timer;\n\tstruct cyttsp4_sysinfo sysinfo;\n\tvoid *exclusive_dev;\n\tint exclusive_waits;\n\tatomic_t ignore_irq;\n\tbool invalid_touch_app;\n\tstruct cyttsp4_mt_data md;\n\tstruct cyttsp4_platform_data *pdata;\n\tstruct cyttsp4_core_platform_data *cpdata;\n\tconst struct cyttsp4_bus_ops *bus_ops;\n\tu8 *xfer_buf;\n#ifdef VERBOSE_DEBUG\n\tu8 pr_buf[CY_MAX_PRBUF_SIZE];\n#endif\n};\n\nstruct cyttsp4_bus_ops {\n\tu16 bustype;\n\tint (*write)(struct device *dev, u8 *xfer_buf, u16 addr, u8 length,\n\t\t\tconst void *values);\n\tint (*read)(struct device *dev, u8 *xfer_buf, u16 addr, u8 length,\n\t\t\tvoid *values);\n};\n\nenum cyttsp4_hst_mode_bits {\n\tCY_HST_TOGGLE      = (1 << 7),\n\tCY_HST_MODE_CHANGE = (1 << 3),\n\tCY_HST_MODE        = (7 << 4),\n\tCY_HST_OPERATE     = (0 << 4),\n\tCY_HST_SYSINFO     = (1 << 4),\n\tCY_HST_CAT         = (2 << 4),\n\tCY_HST_LOWPOW      = (1 << 2),\n\tCY_HST_SLEEP       = (1 << 1),\n\tCY_HST_RESET       = (1 << 0),\n};\n\n \n#define CY_IGNORE_VALUE\t\t\t0xFFFF\n\n \nenum cyttsp4_sig_caps {\n\tCY_SIGNAL_OST,\n\tCY_MIN_OST,\n\tCY_MAX_OST,\n\tCY_FUZZ_OST,\n\tCY_FLAT_OST,\n\tCY_NUM_ABS_SET\t \n};\n\n \nenum cyttsp4_sig_ost {\n\tCY_ABS_X_OST,\n\tCY_ABS_Y_OST,\n\tCY_ABS_P_OST,\n\tCY_ABS_W_OST,\n\tCY_ABS_ID_OST,\n\tCY_ABS_MAJ_OST,\n\tCY_ABS_MIN_OST,\n\tCY_ABS_OR_OST,\n\tCY_NUM_ABS_OST\t \n};\n\nenum cyttsp4_flags {\n\tCY_FLAG_NONE = 0x00,\n\tCY_FLAG_HOVER = 0x04,\n\tCY_FLAG_FLIP = 0x08,\n\tCY_FLAG_INV_X = 0x10,\n\tCY_FLAG_INV_Y = 0x20,\n\tCY_FLAG_VKEYS = 0x40,\n};\n\nenum cyttsp4_object_id {\n\tCY_OBJ_STANDARD_FINGER,\n\tCY_OBJ_LARGE_OBJECT,\n\tCY_OBJ_STYLUS,\n\tCY_OBJ_HOVER,\n};\n\nenum cyttsp4_event_id {\n\tCY_EV_NO_EVENT,\n\tCY_EV_TOUCHDOWN,\n\tCY_EV_MOVE,\t\t \n\tCY_EV_LIFTOFF,\t\t \n};\n\n \n#define CY_PCFG_RESOLUTION_X_MASK\t0x7F\n\n \n#define CY_PCFG_RESOLUTION_Y_MASK\t0x7F\n\n \n#define CY_PCFG_ORIGIN_X_MASK\t\t0x80\n\n \n#define CY_PCFG_ORIGIN_Y_MASK\t\t0x80\n\nstatic inline int cyttsp4_adap_read(struct cyttsp4 *ts, u16 addr, int size,\n\t\tvoid *buf)\n{\n\treturn ts->bus_ops->read(ts->dev, ts->xfer_buf, addr, size, buf);\n}\n\nstatic inline int cyttsp4_adap_write(struct cyttsp4 *ts, u16 addr, int size,\n\t\tconst void *buf)\n{\n\treturn ts->bus_ops->write(ts->dev, ts->xfer_buf, addr, size, buf);\n}\n\nextern struct cyttsp4 *cyttsp4_probe(const struct cyttsp4_bus_ops *ops,\n\t\tstruct device *dev, u16 irq, size_t xfer_buf_size);\nextern int cyttsp4_remove(struct cyttsp4 *ts);\nint cyttsp_i2c_write_block_data(struct device *dev, u8 *xfer_buf, u16 addr,\n\t\tu8 length, const void *values);\nint cyttsp_i2c_read_block_data(struct device *dev, u8 *xfer_buf, u16 addr,\n\t\tu8 length, void *values);\nextern const struct dev_pm_ops cyttsp4_pm_ops;\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}