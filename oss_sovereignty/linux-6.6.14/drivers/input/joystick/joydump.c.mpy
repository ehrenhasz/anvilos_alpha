{
  "module_name": "joydump.c",
  "hash_id": "0b8dc4cb9f2354a9411fbaa22fc3363216720db6224eec1916711607789d2f11",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/joystick/joydump.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/gameport.h>\n#include <linux/kernel.h>\n#include <linux/delay.h>\n#include <linux/slab.h>\n\n#define DRIVER_DESC\t\"Gameport data dumper module\"\n\nMODULE_AUTHOR(\"Vojtech Pavlik <vojtech@ucw.cz>\");\nMODULE_DESCRIPTION(DRIVER_DESC);\nMODULE_LICENSE(\"GPL\");\n\n#define BUF_SIZE 256\n\nstruct joydump {\n\tunsigned int time;\n\tunsigned char data;\n};\n\nstatic int joydump_connect(struct gameport *gameport, struct gameport_driver *drv)\n{\n\tstruct joydump *buf;\t \n\tstruct joydump *dump, *prev;\t \n\tint axes[4], buttons;\n\tint i, j, t, timeout;\n\tunsigned long flags;\n\tunsigned char u;\n\n\tprintk(KERN_INFO \"joydump: ,------------------ START ----------------.\\n\");\n\tprintk(KERN_INFO \"joydump: | Dumping: %30s |\\n\", gameport->phys);\n\tprintk(KERN_INFO \"joydump: | Speed: %28d kHz |\\n\", gameport->speed);\n\n\tif (gameport_open(gameport, drv, GAMEPORT_MODE_RAW)) {\n\n\t\tprintk(KERN_INFO \"joydump: | Raw mode not available - trying cooked.    |\\n\");\n\n\t\tif (gameport_open(gameport, drv, GAMEPORT_MODE_COOKED)) {\n\n\t\t\tprintk(KERN_INFO \"joydump: | Cooked not available either. Failing.   |\\n\");\n\t\t\tprintk(KERN_INFO \"joydump: `------------------- END -----------------'\\n\");\n\t\t\treturn -ENODEV;\n\t\t}\n\n\t\tgameport_cooked_read(gameport, axes, &buttons);\n\n\t\tfor (i = 0; i < 4; i++)\n\t\t\tprintk(KERN_INFO \"joydump: | Axis %d: %4d.                           |\\n\", i, axes[i]);\n\t\tprintk(KERN_INFO \"joydump: | Buttons %02x.                             |\\n\", buttons);\n\t\tprintk(KERN_INFO \"joydump: `------------------- END -----------------'\\n\");\n\t}\n\n\ttimeout = gameport_time(gameport, 10000);  \n\n\tbuf = kmalloc_array(BUF_SIZE, sizeof(struct joydump), GFP_KERNEL);\n\tif (!buf) {\n\t\tprintk(KERN_INFO \"joydump: no memory for testing\\n\");\n\t\tgoto jd_end;\n\t}\n\tdump = buf;\n\tt = 0;\n\ti = 1;\n\n\tlocal_irq_save(flags);\n\n\tu = gameport_read(gameport);\n\n\tdump->data = u;\n\tdump->time = t;\n\tdump++;\n\n\tgameport_trigger(gameport);\n\n\twhile (i < BUF_SIZE && t < timeout) {\n\n\t\tdump->data = gameport_read(gameport);\n\n\t\tif (dump->data ^ u) {\n\t\t\tu = dump->data;\n\t\t\tdump->time = t;\n\t\t\ti++;\n\t\t\tdump++;\n\t\t}\n\t\tt++;\n\t}\n\n\tlocal_irq_restore(flags);\n\n \n\n\tt = i;\n\tdump = buf;\n\tprev = dump;\n\n\tprintk(KERN_INFO \"joydump: >------------------ DATA -----------------<\\n\");\n\tprintk(KERN_INFO \"joydump: | index: %3d delta: %3d us data: \", 0, 0);\n\tfor (j = 7; j >= 0; j--)\n\t\tprintk(\"%d\", (dump->data >> j) & 1);\n\tprintk(\" |\\n\");\n\tdump++;\n\n\tfor (i = 1; i < t; i++, dump++, prev++) {\n\t\tprintk(KERN_INFO \"joydump: | index: %3d delta: %3d us data: \",\n\t\t\ti, dump->time - prev->time);\n\t\tfor (j = 7; j >= 0; j--)\n\t\t\tprintk(\"%d\", (dump->data >> j) & 1);\n\t\tprintk(\" |\\n\");\n\t}\n\tkfree(buf);\n\njd_end:\n\tprintk(KERN_INFO \"joydump: `------------------- END -----------------'\\n\");\n\n\treturn 0;\n}\n\nstatic void joydump_disconnect(struct gameport *gameport)\n{\n\tgameport_close(gameport);\n}\n\nstatic struct gameport_driver joydump_drv = {\n\t.driver\t\t= {\n\t\t.name\t= \"joydump\",\n\t},\n\t.description\t= DRIVER_DESC,\n\t.connect\t= joydump_connect,\n\t.disconnect\t= joydump_disconnect,\n};\n\nmodule_gameport_driver(joydump_drv);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}