{
  "module_name": "iforce.h",
  "hash_id": "5af92f84e3f8309c43269af3e2ca3a4eae183a4d35e71b47ad558313d722c726",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/joystick/iforce/iforce.h",
  "human_readable_source": " \n \n\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/spinlock.h>\n#include <linux/circ_buf.h>\n#include <linux/mutex.h>\n\n \n#include <linux/ioport.h>\n\n\n#define IFORCE_MAX_LENGTH\t16\n\n#define IFORCE_EFFECTS_MAX\t32\n\n \n#define FF_MOD1_IS_USED\t\t0\n#define FF_MOD2_IS_USED\t\t1\n#define FF_CORE_IS_USED\t\t2\n#define FF_CORE_IS_PLAYED\t3\t \n#define FF_CORE_SHOULD_PLAY\t4\t \n#define FF_CORE_UPDATE\t\t5\t \n#define FF_MODCORE_CNT\t\t6\n\nstruct iforce_core_effect {\n\t \n\tstruct resource mod1_chunk;\n\tstruct resource mod2_chunk;\n\tunsigned long flags[BITS_TO_LONGS(FF_MODCORE_CNT)];\n};\n\n#define FF_CMD_EFFECT\t\t0x010e\n#define FF_CMD_ENVELOPE\t\t0x0208\n#define FF_CMD_MAGNITUDE\t0x0303\n#define FF_CMD_PERIOD\t\t0x0407\n#define FF_CMD_CONDITION\t0x050a\n\n#define FF_CMD_AUTOCENTER\t0x4002\n#define FF_CMD_PLAY\t\t0x4103\n#define FF_CMD_ENABLE\t\t0x4201\n#define FF_CMD_GAIN\t\t0x4301\n\n#define FF_CMD_QUERY\t\t0xff01\n\n \n#define XMIT_SIZE\t\t256\n#define XMIT_INC(var, n)\t(var)+=n; (var)&= XMIT_SIZE -1\n \n#define IFORCE_XMIT_RUNNING\t0\n#define IFORCE_XMIT_AGAIN\t1\n\nstruct iforce_device {\n\tu16 idvendor;\n\tu16 idproduct;\n\tchar *name;\n\tsigned short *btn;\n\tsigned short *abs;\n\tsigned short *ff;\n};\n\nstruct iforce;\n\nstruct iforce_xport_ops {\n\tvoid (*xmit)(struct iforce *iforce);\n\tint (*get_id)(struct iforce *iforce, u8 id,\n\t\t      u8 *response_data, size_t *response_len);\n\tint (*start_io)(struct iforce *iforce);\n\tvoid (*stop_io)(struct iforce *iforce);\n};\n\nstruct iforce {\n\tstruct input_dev *dev;\t\t \n\tstruct iforce_device *type;\n\tconst struct iforce_xport_ops *xport_ops;\n\n\tspinlock_t xmit_lock;\n\t \n\tstruct circ_buf xmit;\n\tunsigned char xmit_data[XMIT_SIZE];\n\tunsigned long xmit_flags[1];\n\n\t\t\t\t\t \n\twait_queue_head_t wait;\n\tstruct resource device_memory;\n\tstruct iforce_core_effect core_effects[IFORCE_EFFECTS_MAX];\n\tstruct mutex mem_mutex;\n};\n\n \n#define HI(a)\t((unsigned char)((a) >> 8))\n#define LO(a)\t((unsigned char)((a) & 0xff))\n\n \n#define HIFIX80(a) ((unsigned char)(((a)<0? (a)+255 : (a))>>8))\n\n \n#define TIME_SCALE(a)\t(a)\n\nstatic inline int iforce_get_id_packet(struct iforce *iforce, u8 id,\n\t\t\t\t       u8 *response_data, size_t *response_len)\n{\n\treturn iforce->xport_ops->get_id(iforce, id,\n\t\t\t\t\t response_data, response_len);\n}\n\nstatic inline void iforce_clear_xmit_and_wake(struct iforce *iforce)\n{\n\tclear_bit(IFORCE_XMIT_RUNNING, iforce->xmit_flags);\n\twake_up_all(&iforce->wait);\n}\n\n \n \nint iforce_init_device(struct device *parent, u16 bustype,\n\t\t       struct iforce *iforce);\n\n \nint iforce_control_playback(struct iforce*, u16 id, unsigned int);\nvoid iforce_process_packet(struct iforce *iforce,\n\t\t\t   u8 packet_id, u8 *data, size_t len);\nint iforce_send_packet(struct iforce *iforce, u16 cmd, unsigned char* data);\nvoid iforce_dump_packet(struct iforce *iforce, char *msg, u16 cmd, unsigned char *data);\n\n \nint iforce_upload_periodic(struct iforce *, struct ff_effect *, struct ff_effect *);\nint iforce_upload_constant(struct iforce *, struct ff_effect *, struct ff_effect *);\nint iforce_upload_condition(struct iforce *, struct ff_effect *, struct ff_effect *);\n\n \nextern struct serio_driver iforce_serio_drv;\nextern struct usb_driver iforce_usb_driver;\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}