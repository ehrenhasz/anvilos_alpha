{
  "module_name": "rmi_f34.h",
  "hash_id": "1fbea83a19f9d9732d7c08bee90061c3b8731f64c157e80e4c7f2f0477541eff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/rmi4/rmi_f34.h",
  "human_readable_source": " \n \n\n#ifndef _RMI_F34_H\n#define _RMI_F34_H\n\n \n#define F34_FW_IMAGE_OFFSET\t0x100\n\n \n#define F34_BLOCK_DATA_OFFSET\t2\n\n \n#define F34_WRITE_FW_BLOCK\t0x2\n#define F34_ERASE_ALL\t\t0x3\n#define F34_READ_CONFIG_BLOCK\t0x5\n#define F34_WRITE_CONFIG_BLOCK\t0x6\n#define F34_ERASE_CONFIG\t0x7\n#define F34_ENABLE_FLASH_PROG\t0xf\n\n#define F34_STATUS_IN_PROGRESS\t0xff\n#define F34_STATUS_IDLE\t\t0x80\n\n#define F34_IDLE_WAIT_MS\t500\n#define F34_ENABLE_WAIT_MS\t300\n#define F34_ERASE_WAIT_MS\t5000\n#define F34_WRITE_WAIT_MS\t3000\n\n#define F34_BOOTLOADER_ID_LEN\t2\n\n \n#define V7_FLASH_STATUS_OFFSET\t\t0\n#define V7_PARTITION_ID_OFFSET\t\t1\n#define V7_BLOCK_NUMBER_OFFSET\t\t2\n#define V7_TRANSFER_LENGTH_OFFSET\t3\n#define V7_COMMAND_OFFSET\t\t4\n#define V7_PAYLOAD_OFFSET\t\t5\n#define V7_BOOTLOADER_ID_OFFSET\t\t1\n\n#define IMAGE_HEADER_VERSION_10\t\t0x10\n\n#define CONFIG_ID_SIZE\t\t\t32\n#define PRODUCT_ID_SIZE\t\t\t10\n\n\n#define HAS_BSR\t\t\t\tBIT(5)\n#define HAS_CONFIG_ID\t\t\tBIT(3)\n#define HAS_GUEST_CODE\t\t\tBIT(6)\n#define HAS_DISP_CFG\t\t\tBIT(5)\n\n \n#define CMD_V7_IDLE\t\t\t0\n#define CMD_V7_ENTER_BL\t\t\t1\n#define CMD_V7_READ\t\t\t2\n#define CMD_V7_WRITE\t\t\t3\n#define CMD_V7_ERASE\t\t\t4\n#define CMD_V7_ERASE_AP\t\t\t5\n#define CMD_V7_SENSOR_ID\t\t6\n\n#define v7_CMD_IDLE\t\t\t0\n#define v7_CMD_WRITE_FW\t\t\t1\n#define v7_CMD_WRITE_CONFIG\t\t2\n#define v7_CMD_WRITE_LOCKDOWN\t\t3\n#define v7_CMD_WRITE_GUEST_CODE\t\t4\n#define v7_CMD_READ_CONFIG\t\t5\n#define v7_CMD_ERASE_ALL\t\t6\n#define v7_CMD_ERASE_UI_FIRMWARE\t7\n#define v7_CMD_ERASE_UI_CONFIG\t\t8\n#define v7_CMD_ERASE_BL_CONFIG\t\t9\n#define v7_CMD_ERASE_DISP_CONFIG\t10\n#define v7_CMD_ERASE_FLASH_CONFIG\t11\n#define v7_CMD_ERASE_GUEST_CODE\t\t12\n#define v7_CMD_ENABLE_FLASH_PROG\t13\n\n#define v7_UI_CONFIG_AREA\t\t0\n#define v7_PM_CONFIG_AREA\t\t1\n#define v7_BL_CONFIG_AREA\t\t2\n#define v7_DP_CONFIG_AREA\t\t3\n#define v7_FLASH_CONFIG_AREA\t\t4\n\n \n#define BOOTLOADER_PARTITION\t\t1\n#define DEVICE_CONFIG_PARTITION\t\t2\n#define FLASH_CONFIG_PARTITION\t\t3\n#define MANUFACTURING_BLOCK_PARTITION\t4\n#define GUEST_SERIALIZATION_PARTITION\t5\n#define GLOBAL_PARAMETERS_PARTITION\t6\n#define CORE_CODE_PARTITION\t\t7\n#define CORE_CONFIG_PARTITION\t\t8\n#define GUEST_CODE_PARTITION\t\t9\n#define DISPLAY_CONFIG_PARTITION\t10\n\n \n#define TOP_LEVEL_CONTAINER\t\t\t0\n#define UI_CONTAINER\t\t\t\t1\n#define UI_CONFIG_CONTAINER\t\t\t2\n#define BL_CONTAINER\t\t\t\t3\n#define BL_IMAGE_CONTAINER\t\t\t4\n#define BL_CONFIG_CONTAINER\t\t\t5\n#define BL_LOCKDOWN_INFO_CONTAINER\t\t6\n#define PERMANENT_CONFIG_CONTAINER\t\t7\n#define GUEST_CODE_CONTAINER\t\t\t8\n#define BL_PROTOCOL_DESCRIPTOR_CONTAINER\t9\n#define UI_PROTOCOL_DESCRIPTOR_CONTAINER\t10\n#define RMI_SELF_DISCOVERY_CONTAINER\t\t11\n#define RMI_PAGE_CONTENT_CONTAINER\t\t12\n#define GENERAL_INFORMATION_CONTAINER\t\t13\n#define DEVICE_CONFIG_CONTAINER\t\t\t14\n#define FLASH_CONFIG_CONTAINER\t\t\t15\n#define GUEST_SERIALIZATION_CONTAINER\t\t16\n#define GLOBAL_PARAMETERS_CONTAINER\t\t17\n#define CORE_CODE_CONTAINER\t\t\t18\n#define CORE_CONFIG_CONTAINER\t\t\t19\n#define DISPLAY_CONFIG_CONTAINER\t\t20\n\nstruct f34v7_query_1_7 {\n\tu8 bl_minor_revision;\t\t\t \n\tu8 bl_major_revision;\n\t__le32 bl_fw_id;\t\t\t \n\tu8 minimum_write_size;\t\t\t \n\t__le16 block_size;\n\t__le16 flash_page_size;\n\t__le16 adjustable_partition_area_size;\t \n\t__le16 flash_config_length;\t\t \n\t__le16 payload_length;\t\t\t \n\tu8 partition_support[4];\t\t \n} __packed;\n\nstruct f34v7_data_1_5 {\n\tu8 partition_id;\n\t__le16 block_offset;\n\t__le16 transfer_length;\n\tu8 command;\n\tu8 payload[2];\n} __packed;\n\nstruct block_data {\n\tconst void *data;\n\tint size;\n};\n\nstruct partition_table {\n\tu8 partition_id;\n\tu8 byte_1_reserved;\n\t__le16 partition_length;\n\t__le16 start_physical_address;\n\t__le16 partition_properties;\n} __packed;\n\nstruct physical_address {\n\tu16 ui_firmware;\n\tu16 ui_config;\n\tu16 dp_config;\n\tu16 guest_code;\n};\n\nstruct container_descriptor {\n\t__le32 content_checksum;\n\t__le16 container_id;\n\tu8 minor_version;\n\tu8 major_version;\n\tu8 reserved_08;\n\tu8 reserved_09;\n\tu8 reserved_0a;\n\tu8 reserved_0b;\n\tu8 container_option_flags[4];\n\t__le32 content_options_length;\n\t__le32 content_options_address;\n\t__le32 content_length;\n\t__le32 content_address;\n} __packed;\n\nstruct block_count {\n\tu16 ui_firmware;\n\tu16 ui_config;\n\tu16 dp_config;\n\tu16 fl_config;\n\tu16 pm_config;\n\tu16 bl_config;\n\tu16 lockdown;\n\tu16 guest_code;\n};\n\nstruct image_header_10 {\n\t__le32 checksum;\n\tu8 reserved_04;\n\tu8 reserved_05;\n\tu8 minor_header_version;\n\tu8 major_header_version;\n\tu8 reserved_08;\n\tu8 reserved_09;\n\tu8 reserved_0a;\n\tu8 reserved_0b;\n\t__le32 top_level_container_start_addr;\n};\n\nstruct image_metadata {\n\tbool contains_firmware_id;\n\tbool contains_bootloader;\n\tbool contains_display_cfg;\n\tbool contains_guest_code;\n\tbool contains_flash_config;\n\tunsigned int firmware_id;\n\tunsigned int checksum;\n\tunsigned int bootloader_size;\n\tunsigned int display_cfg_offset;\n\tunsigned char bl_version;\n\tunsigned char product_id[PRODUCT_ID_SIZE + 1];\n\tunsigned char cstmr_product_id[PRODUCT_ID_SIZE + 1];\n\tstruct block_data bootloader;\n\tstruct block_data ui_firmware;\n\tstruct block_data ui_config;\n\tstruct block_data dp_config;\n\tstruct block_data fl_config;\n\tstruct block_data bl_config;\n\tstruct block_data guest_code;\n\tstruct block_data lockdown;\n\tstruct block_count blkcount;\n\tstruct physical_address phyaddr;\n};\n\nstruct rmi_f34_firmware {\n\t__le32 checksum;\n\tu8 pad1[3];\n\tu8 bootloader_version;\n\t__le32 image_size;\n\t__le32 config_size;\n\tu8 product_id[10];\n\tu8 product_info[2];\n\tu8 pad2[228];\n\tu8 data[];\n};\n\nstruct f34v5_data {\n\tu16 block_size;\n\tu16 fw_blocks;\n\tu16 config_blocks;\n\tu16 ctrl_address;\n\tu8 status;\n\n\tstruct completion cmd_done;\n\tstruct mutex flash_mutex;\n};\n\nstruct f34v7_data {\n\tbool has_display_cfg;\n\tbool has_guest_code;\n\tbool in_bl_mode;\n\tu8 *read_config_buf;\n\tsize_t read_config_buf_size;\n\tu8 command;\n\tu8 flash_status;\n\tu16 block_size;\n\tu16 config_block_count;\n\tu16 config_size;\n\tu16 config_area;\n\tu16 flash_config_length;\n\tu16 payload_length;\n\tu8 partitions;\n\tu16 partition_table_bytes;\n\n\tstruct block_count blkcount;\n\tstruct physical_address phyaddr;\n\tstruct image_metadata img;\n\n\tconst void *config_data;\n\tconst void *image;\n\tstruct completion cmd_done;\n};\n\nstruct f34_data {\n\tstruct rmi_function *fn;\n\n\tu8 bl_version;\n\tunsigned char bootloader_id[5];\n\tunsigned char configuration_id[CONFIG_ID_SIZE*2 + 1];\n\n\tint update_status;\n\tint update_progress;\n\tint update_size;\n\n\tunion {\n\t\tstruct f34v5_data v5;\n\t\tstruct f34v7_data v7;\n\t};\n};\n\nint rmi_f34v7_start_reflash(struct f34_data *f34, const struct firmware *fw);\nint rmi_f34v7_do_reflash(struct f34_data *f34, const struct firmware *fw);\nint rmi_f34v7_probe(struct f34_data *f34);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}