{
  "module_name": "apm-power.c",
  "hash_id": "0a2bb36e2a764f42d03a0dc30acc7a54f2661642efd8fac7afdb94bfdf60d623",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/apm-power.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/input.h>\n#include <linux/slab.h>\n#include <linux/init.h>\n#include <linux/tty.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/apm-emulation.h>\n\nstatic void system_power_event(unsigned int keycode)\n{\n\tswitch (keycode) {\n\tcase KEY_SUSPEND:\n\t\tapm_queue_event(APM_USER_SUSPEND);\n\t\tpr_info(\"Requesting system suspend...\\n\");\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void apmpower_event(struct input_handle *handle, unsigned int type,\n\t\t\t   unsigned int code, int value)\n{\n\t \n\tif (value != 1)\n\t\treturn;\n\n\tswitch (type) {\n\tcase EV_PWR:\n\t\tsystem_power_event(code);\n\t\tbreak;\n\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic int apmpower_connect(struct input_handler *handler,\n\t\t\t\t\t  struct input_dev *dev,\n\t\t\t\t\t  const struct input_device_id *id)\n{\n\tstruct input_handle *handle;\n\tint error;\n\n\thandle = kzalloc(sizeof(struct input_handle), GFP_KERNEL);\n\tif (!handle)\n\t\treturn -ENOMEM;\n\n\thandle->dev = dev;\n\thandle->handler = handler;\n\thandle->name = \"apm-power\";\n\n\terror = input_register_handle(handle);\n\tif (error) {\n\t\tpr_err(\"Failed to register input power handler, error %d\\n\",\n\t\t       error);\n\t\tkfree(handle);\n\t\treturn error;\n\t}\n\n\terror = input_open_device(handle);\n\tif (error) {\n\t\tpr_err(\"Failed to open input power device, error %d\\n\", error);\n\t\tinput_unregister_handle(handle);\n\t\tkfree(handle);\n\t\treturn error;\n\t}\n\n\treturn 0;\n}\n\nstatic void apmpower_disconnect(struct input_handle *handle)\n{\n\tinput_close_device(handle);\n\tinput_unregister_handle(handle);\n\tkfree(handle);\n}\n\nstatic const struct input_device_id apmpower_ids[] = {\n\t{\n\t\t.flags = INPUT_DEVICE_ID_MATCH_EVBIT,\n\t\t.evbit = { BIT_MASK(EV_PWR) },\n\t},\n\t{ },\n};\n\nMODULE_DEVICE_TABLE(input, apmpower_ids);\n\nstatic struct input_handler apmpower_handler = {\n\t.event =\tapmpower_event,\n\t.connect =\tapmpower_connect,\n\t.disconnect =\tapmpower_disconnect,\n\t.name =\t\t\"apm-power\",\n\t.id_table =\tapmpower_ids,\n};\n\nstatic int __init apmpower_init(void)\n{\n\treturn input_register_handler(&apmpower_handler);\n}\n\nstatic void __exit apmpower_exit(void)\n{\n\tinput_unregister_handler(&apmpower_handler);\n}\n\nmodule_init(apmpower_init);\nmodule_exit(apmpower_exit);\n\nMODULE_AUTHOR(\"Richard Purdie <rpurdie@rpsys.net>\");\nMODULE_DESCRIPTION(\"Input Power Event -> APM Bridge\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}