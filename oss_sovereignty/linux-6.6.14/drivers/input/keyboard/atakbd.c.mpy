{
  "module_name": "atakbd.c",
  "hash_id": "f95c6aa242dd3e022a9f11cceb57babe38ccc10e2aad78adceacaca156f166fd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/keyboard/atakbd.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/input.h>\n#include <linux/delay.h>\n#include <linux/interrupt.h>\n\n#include <asm/atariints.h>\n#include <asm/atarihw.h>\n#include <asm/atarikb.h>\n#include <asm/irq.h>\n\nMODULE_AUTHOR(\"Michael Schmitz <schmitz@biophys.uni-duesseldorf.de>\");\nMODULE_DESCRIPTION(\"Atari keyboard driver\");\nMODULE_LICENSE(\"GPL\");\n\n \n\n\nstatic unsigned char atakbd_keycode[0x73] = {\t \n\t[1]\t = KEY_ESC,\n\t[2]\t = KEY_1,\n\t[3]\t = KEY_2,\n\t[4]\t = KEY_3,\n\t[5]\t = KEY_4,\n\t[6]\t = KEY_5,\n\t[7]\t = KEY_6,\n\t[8]\t = KEY_7,\n\t[9]\t = KEY_8,\n\t[10]\t = KEY_9,\n\t[11]\t = KEY_0,\n\t[12]\t = KEY_MINUS,\n\t[13]\t = KEY_EQUAL,\n\t[14]\t = KEY_BACKSPACE,\n\t[15]\t = KEY_TAB,\n\t[16]\t = KEY_Q,\n\t[17]\t = KEY_W,\n\t[18]\t = KEY_E,\n\t[19]\t = KEY_R,\n\t[20]\t = KEY_T,\n\t[21]\t = KEY_Y,\n\t[22]\t = KEY_U,\n\t[23]\t = KEY_I,\n\t[24]\t = KEY_O,\n\t[25]\t = KEY_P,\n\t[26]\t = KEY_LEFTBRACE,\n\t[27]\t = KEY_RIGHTBRACE,\n\t[28]\t = KEY_ENTER,\n\t[29]\t = KEY_LEFTCTRL,\n\t[30]\t = KEY_A,\n\t[31]\t = KEY_S,\n\t[32]\t = KEY_D,\n\t[33]\t = KEY_F,\n\t[34]\t = KEY_G,\n\t[35]\t = KEY_H,\n\t[36]\t = KEY_J,\n\t[37]\t = KEY_K,\n\t[38]\t = KEY_L,\n\t[39]\t = KEY_SEMICOLON,\n\t[40]\t = KEY_APOSTROPHE,\n\t[41]\t = KEY_GRAVE,\n\t[42]\t = KEY_LEFTSHIFT,\n\t[43]\t = KEY_BACKSLASH,\n\t[44]\t = KEY_Z,\n\t[45]\t = KEY_X,\n\t[46]\t = KEY_C,\n\t[47]\t = KEY_V,\n\t[48]\t = KEY_B,\n\t[49]\t = KEY_N,\n\t[50]\t = KEY_M,\n\t[51]\t = KEY_COMMA,\n\t[52]\t = KEY_DOT,\n\t[53]\t = KEY_SLASH,\n\t[54]\t = KEY_RIGHTSHIFT,\n\t[55]\t = KEY_KPASTERISK,\n\t[56]\t = KEY_LEFTALT,\n\t[57]\t = KEY_SPACE,\n\t[58]\t = KEY_CAPSLOCK,\n\t[59]\t = KEY_F1,\n\t[60]\t = KEY_F2,\n\t[61]\t = KEY_F3,\n\t[62]\t = KEY_F4,\n\t[63]\t = KEY_F5,\n\t[64]\t = KEY_F6,\n\t[65]\t = KEY_F7,\n\t[66]\t = KEY_F8,\n\t[67]\t = KEY_F9,\n\t[68]\t = KEY_F10,\n\t[71]\t = KEY_HOME,\n\t[72]\t = KEY_UP,\n\t[74]\t = KEY_KPMINUS,\n\t[75]\t = KEY_LEFT,\n\t[77]\t = KEY_RIGHT,\n\t[78]\t = KEY_KPPLUS,\n\t[80]\t = KEY_DOWN,\n\t[82]\t = KEY_INSERT,\n\t[83]\t = KEY_DELETE,\n\t[96]\t = KEY_102ND,\n\t[97]\t = KEY_UNDO,\n\t[98]\t = KEY_HELP,\n\t[99]\t = KEY_KPLEFTPAREN,\n\t[100]\t = KEY_KPRIGHTPAREN,\n\t[101]\t = KEY_KPSLASH,\n\t[102]\t = KEY_KPASTERISK,\n\t[103]\t = KEY_KP7,\n\t[104]\t = KEY_KP8,\n\t[105]\t = KEY_KP9,\n\t[106]\t = KEY_KP4,\n\t[107]\t = KEY_KP5,\n\t[108]\t = KEY_KP6,\n\t[109]\t = KEY_KP1,\n\t[110]\t = KEY_KP2,\n\t[111]\t = KEY_KP3,\n\t[112]\t = KEY_KP0,\n\t[113]\t = KEY_KPDOT,\n\t[114]\t = KEY_KPENTER,\n};\n\nstatic struct input_dev *atakbd_dev;\n\nstatic void atakbd_interrupt(unsigned char scancode, char down)\n{\n\n\tif (scancode < 0x73) {\t\t \n\n\t\t\n\n\t\tscancode = atakbd_keycode[scancode];\n\n\t\tinput_report_key(atakbd_dev, scancode, down);\n\t\tinput_sync(atakbd_dev);\n\t} else\t\t\t\t \n\t\tprintk(KERN_INFO \"atakbd: unhandled scancode %x\\n\", scancode);\n\n\treturn;\n}\n\nstatic int __init atakbd_init(void)\n{\n\tint i, error;\n\n\tif (!MACH_IS_ATARI || !ATARIHW_PRESENT(ST_MFP))\n\t\treturn -ENODEV;\n\n\t\n\terror = atari_keyb_init();\n\tif (error)\n\t\treturn error;\n\n\tatakbd_dev = input_allocate_device();\n\tif (!atakbd_dev)\n\t\treturn -ENOMEM;\n\n\tatakbd_dev->name = \"Atari Keyboard\";\n\tatakbd_dev->phys = \"atakbd/input0\";\n\tatakbd_dev->id.bustype = BUS_HOST;\n\tatakbd_dev->id.vendor = 0x0001;\n\tatakbd_dev->id.product = 0x0001;\n\tatakbd_dev->id.version = 0x0100;\n\n\tatakbd_dev->evbit[0] = BIT_MASK(EV_KEY) | BIT_MASK(EV_REP);\n\tatakbd_dev->keycode = atakbd_keycode;\n\tatakbd_dev->keycodesize = sizeof(unsigned char);\n\tatakbd_dev->keycodemax = ARRAY_SIZE(atakbd_keycode);\n\n\tfor (i = 1; i < 0x72; i++) {\n\t\tset_bit(atakbd_keycode[i], atakbd_dev->keybit);\n\t}\n\n\t \n\terror = input_register_device(atakbd_dev);\n\tif (error) {\n\t\tinput_free_device(atakbd_dev);\n\t\treturn error;\n\t}\n\n\tatari_input_keyboard_interrupt_hook = atakbd_interrupt;\n\n\treturn 0;\n}\n\nstatic void __exit atakbd_exit(void)\n{\n\tatari_input_keyboard_interrupt_hook = NULL;\n\tinput_unregister_device(atakbd_dev);\n}\n\nmodule_init(atakbd_init);\nmodule_exit(atakbd_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}