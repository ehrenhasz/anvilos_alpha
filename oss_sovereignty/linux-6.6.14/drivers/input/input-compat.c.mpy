{
  "module_name": "input-compat.c",
  "hash_id": "c2aa189474ca53bdd1106ffdbab33f6052d574af580dde7e6b33dfbed2e5ba35",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/input-compat.c",
  "human_readable_source": "\n \n\n#include <linux/export.h>\n#include <linux/uaccess.h>\n#include \"input-compat.h\"\n\n#ifdef CONFIG_COMPAT\n\nint input_event_from_user(const char __user *buffer,\n\t\t\t  struct input_event *event)\n{\n\tif (in_compat_syscall() && !COMPAT_USE_64BIT_TIME) {\n\t\tstruct input_event_compat compat_event;\n\n\t\tif (copy_from_user(&compat_event, buffer,\n\t\t\t\t   sizeof(struct input_event_compat)))\n\t\t\treturn -EFAULT;\n\n\t\tevent->input_event_sec = compat_event.sec;\n\t\tevent->input_event_usec = compat_event.usec;\n\t\tevent->type = compat_event.type;\n\t\tevent->code = compat_event.code;\n\t\tevent->value = compat_event.value;\n\n\t} else {\n\t\tif (copy_from_user(event, buffer, sizeof(struct input_event)))\n\t\t\treturn -EFAULT;\n\t}\n\n\treturn 0;\n}\n\nint input_event_to_user(char __user *buffer,\n\t\t\tconst struct input_event *event)\n{\n\tif (in_compat_syscall() && !COMPAT_USE_64BIT_TIME) {\n\t\tstruct input_event_compat compat_event;\n\n\t\tcompat_event.sec = event->input_event_sec;\n\t\tcompat_event.usec = event->input_event_usec;\n\t\tcompat_event.type = event->type;\n\t\tcompat_event.code = event->code;\n\t\tcompat_event.value = event->value;\n\n\t\tif (copy_to_user(buffer, &compat_event,\n\t\t\t\t sizeof(struct input_event_compat)))\n\t\t\treturn -EFAULT;\n\n\t} else {\n\t\tif (copy_to_user(buffer, event, sizeof(struct input_event)))\n\t\t\treturn -EFAULT;\n\t}\n\n\treturn 0;\n}\n\nint input_ff_effect_from_user(const char __user *buffer, size_t size,\n\t\t\t      struct ff_effect *effect)\n{\n\tif (in_compat_syscall()) {\n\t\tstruct ff_effect_compat *compat_effect;\n\n\t\tif (size != sizeof(struct ff_effect_compat))\n\t\t\treturn -EINVAL;\n\n\t\t \n\t\tcompat_effect = (struct ff_effect_compat *)effect;\n\n\t\tif (copy_from_user(compat_effect, buffer,\n\t\t\t\t   sizeof(struct ff_effect_compat)))\n\t\t\treturn -EFAULT;\n\n\t\tif (compat_effect->type == FF_PERIODIC &&\n\t\t    compat_effect->u.periodic.waveform == FF_CUSTOM)\n\t\t\teffect->u.periodic.custom_data =\n\t\t\t\tcompat_ptr(compat_effect->u.periodic.custom_data);\n\t} else {\n\t\tif (size != sizeof(struct ff_effect))\n\t\t\treturn -EINVAL;\n\n\t\tif (copy_from_user(effect, buffer, sizeof(struct ff_effect)))\n\t\t\treturn -EFAULT;\n\t}\n\n\treturn 0;\n}\n\n#else\n\nint input_event_from_user(const char __user *buffer,\n\t\t\t struct input_event *event)\n{\n\tif (copy_from_user(event, buffer, sizeof(struct input_event)))\n\t\treturn -EFAULT;\n\n\treturn 0;\n}\n\nint input_event_to_user(char __user *buffer,\n\t\t\tconst struct input_event *event)\n{\n\tif (copy_to_user(buffer, event, sizeof(struct input_event)))\n\t\treturn -EFAULT;\n\n\treturn 0;\n}\n\nint input_ff_effect_from_user(const char __user *buffer, size_t size,\n\t\t\t      struct ff_effect *effect)\n{\n\tif (size != sizeof(struct ff_effect))\n\t\treturn -EINVAL;\n\n\tif (copy_from_user(effect, buffer, sizeof(struct ff_effect)))\n\t\treturn -EFAULT;\n\n\treturn 0;\n}\n\n#endif  \n\nEXPORT_SYMBOL_GPL(input_event_from_user);\nEXPORT_SYMBOL_GPL(input_event_to_user);\nEXPORT_SYMBOL_GPL(input_ff_effect_from_user);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}