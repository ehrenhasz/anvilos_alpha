{
  "module_name": "rpcmouse.c",
  "hash_id": "0df2e832a60300c956ac730a58a2f0647711fe4b6f97be0dd9ac4a1f61c67cc2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/mouse/rpcmouse.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/module.h>\n#include <linux/ptrace.h>\n#include <linux/interrupt.h>\n#include <linux/init.h>\n#include <linux/input.h>\n#include <linux/io.h>\n\n#include <mach/hardware.h>\n#include <asm/irq.h>\n#include <asm/hardware/iomd.h>\n\nMODULE_AUTHOR(\"Vojtech Pavlik, Russell King\");\nMODULE_DESCRIPTION(\"Acorn RiscPC mouse driver\");\nMODULE_LICENSE(\"GPL\");\n\nstatic short rpcmouse_lastx, rpcmouse_lasty;\nstatic struct input_dev *rpcmouse_dev;\n\nstatic irqreturn_t rpcmouse_irq(int irq, void *dev_id)\n{\n\tstruct input_dev *dev = dev_id;\n\tshort x, y, dx, dy, b;\n\n\tx = (short) iomd_readl(IOMD_MOUSEX);\n\ty = (short) iomd_readl(IOMD_MOUSEY);\n\tb = (short) (__raw_readl(IOMEM(0xe0310000)) ^ 0x70);\n\n\tdx = x - rpcmouse_lastx;\n\tdy = y - rpcmouse_lasty;\n\n\trpcmouse_lastx = x;\n\trpcmouse_lasty = y;\n\n\tinput_report_rel(dev, REL_X, dx);\n\tinput_report_rel(dev, REL_Y, -dy);\n\n\tinput_report_key(dev, BTN_LEFT,   b & 0x40);\n\tinput_report_key(dev, BTN_MIDDLE, b & 0x20);\n\tinput_report_key(dev, BTN_RIGHT,  b & 0x10);\n\n\tinput_sync(dev);\n\n\treturn IRQ_HANDLED;\n}\n\n\nstatic int __init rpcmouse_init(void)\n{\n\tint err;\n\n\trpcmouse_dev = input_allocate_device();\n\tif (!rpcmouse_dev)\n\t\treturn -ENOMEM;\n\n\trpcmouse_dev->name = \"Acorn RiscPC Mouse\";\n\trpcmouse_dev->phys = \"rpcmouse/input0\";\n\trpcmouse_dev->id.bustype = BUS_HOST;\n\trpcmouse_dev->id.vendor  = 0x0005;\n\trpcmouse_dev->id.product = 0x0001;\n\trpcmouse_dev->id.version = 0x0100;\n\n\trpcmouse_dev->evbit[0] = BIT_MASK(EV_KEY) | BIT_MASK(EV_REL);\n\trpcmouse_dev->keybit[BIT_WORD(BTN_LEFT)] = BIT_MASK(BTN_LEFT) |\n\t\tBIT_MASK(BTN_MIDDLE) | BIT_MASK(BTN_RIGHT);\n\trpcmouse_dev->relbit[0]\t= BIT_MASK(REL_X) | BIT_MASK(REL_Y);\n\n\trpcmouse_lastx = (short) iomd_readl(IOMD_MOUSEX);\n\trpcmouse_lasty = (short) iomd_readl(IOMD_MOUSEY);\n\n\tif (request_irq(IRQ_VSYNCPULSE, rpcmouse_irq, IRQF_SHARED, \"rpcmouse\", rpcmouse_dev)) {\n\t\tprintk(KERN_ERR \"rpcmouse: unable to allocate VSYNC interrupt\\n\");\n\t\terr = -EBUSY;\n\t\tgoto err_free_dev;\n\t}\n\n\terr = input_register_device(rpcmouse_dev);\n\tif (err)\n\t\tgoto err_free_irq;\n\n\treturn 0;\n\n err_free_irq:\n\tfree_irq(IRQ_VSYNCPULSE, rpcmouse_dev);\n err_free_dev:\n\tinput_free_device(rpcmouse_dev);\n\n\treturn err;\n}\n\nstatic void __exit rpcmouse_exit(void)\n{\n\tfree_irq(IRQ_VSYNCPULSE, rpcmouse_dev);\n\tinput_unregister_device(rpcmouse_dev);\n}\n\nmodule_init(rpcmouse_init);\nmodule_exit(rpcmouse_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}