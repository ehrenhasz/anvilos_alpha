{
  "module_name": "cyapa.h",
  "hash_id": "0e6b2064830e07b89b055d5f85cbdef41edb54c0f7c7e671df77a9b340904379",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/mouse/cyapa.h",
  "human_readable_source": " \n\n#ifndef _CYAPA_H\n#define _CYAPA_H\n\n#include <linux/firmware.h>\n\n \n#define CYAPA_GEN_UNKNOWN   0x00    \n#define CYAPA_GEN3   0x03    \n#define CYAPA_GEN5   0x05    \n#define CYAPA_GEN6   0x06    \n\n#define CYAPA_NAME   \"Cypress APA Trackpad (cyapa)\"\n\n \n#define SMBUS_READ  0x01\n#define SMBUS_WRITE 0x00\n#define SMBUS_ENCODE_IDX(cmd, idx) ((cmd) | (((idx) & 0x03) << 1))\n#define SMBUS_ENCODE_RW(cmd, rw) ((cmd) | ((rw) & 0x01))\n#define SMBUS_BYTE_BLOCK_CMD_MASK 0x80\n#define SMBUS_GROUP_BLOCK_CMD_MASK 0x40\n\n \n#define CYAPA_CMD_SOFT_RESET       0x00\n#define CYAPA_CMD_POWER_MODE       0x01\n#define CYAPA_CMD_DEV_STATUS       0x02\n#define CYAPA_CMD_GROUP_DATA       0x03\n#define CYAPA_CMD_GROUP_CMD        0x04\n#define CYAPA_CMD_GROUP_QUERY      0x05\n#define CYAPA_CMD_BL_STATUS        0x06\n#define CYAPA_CMD_BL_HEAD          0x07\n#define CYAPA_CMD_BL_CMD           0x08\n#define CYAPA_CMD_BL_DATA          0x09\n#define CYAPA_CMD_BL_ALL           0x0a\n#define CYAPA_CMD_BLK_PRODUCT_ID   0x0b\n#define CYAPA_CMD_BLK_HEAD         0x0c\n#define CYAPA_CMD_MAX_BASELINE     0x0d\n#define CYAPA_CMD_MIN_BASELINE     0x0e\n\n#define BL_HEAD_OFFSET 0x00\n#define BL_DATA_OFFSET 0x10\n\n#define BL_STATUS_SIZE  3   \n#define CYAPA_REG_MAP_SIZE  256\n\n \n#define REG_OP_STATUS     0x00\n#define OP_STATUS_SRC     0x80\n#define OP_STATUS_POWER   0x0c\n#define OP_STATUS_DEV     0x03\n#define OP_STATUS_MASK (OP_STATUS_SRC | OP_STATUS_POWER | OP_STATUS_DEV)\n\n \n#define REG_OP_DATA1       0x01\n#define OP_DATA_VALID      0x08\n#define OP_DATA_MIDDLE_BTN 0x04\n#define OP_DATA_RIGHT_BTN  0x02\n#define OP_DATA_LEFT_BTN   0x01\n#define OP_DATA_BTN_MASK (OP_DATA_MIDDLE_BTN | OP_DATA_RIGHT_BTN | \\\n\t\t\t  OP_DATA_LEFT_BTN)\n\n \n#define REG_BL_FILE\t0x00\n#define BL_FILE\t\t0x00\n\n \n#define REG_BL_STATUS        0x01\n#define BL_STATUS_REV_6_5    0x60\n#define BL_STATUS_BUSY       0x80\n#define BL_STATUS_RUNNING    0x10\n#define BL_STATUS_REV_3_2    0x0c\n#define BL_STATUS_WATCHDOG   0x02\n#define BL_STATUS_CSUM_VALID 0x01\n#define BL_STATUS_REV_MASK (BL_STATUS_WATCHDOG | BL_STATUS_REV_3_2 | \\\n\t\t\t    BL_STATUS_REV_6_5)\n\n \n#define REG_BL_ERROR         0x02\n#define BL_ERROR_INVALID     0x80\n#define BL_ERROR_INVALID_KEY 0x40\n#define BL_ERROR_BOOTLOADING 0x20\n#define BL_ERROR_CMD_CSUM    0x10\n#define BL_ERROR_FLASH_PROT  0x08\n#define BL_ERROR_FLASH_CSUM  0x04\n#define BL_ERROR_RESERVED    0x03\n#define BL_ERROR_NO_ERR_IDLE    0x00\n#define BL_ERROR_NO_ERR_ACTIVE  (BL_ERROR_BOOTLOADING)\n\n#define CAPABILITY_BTN_SHIFT            3\n#define CAPABILITY_LEFT_BTN_MASK\t(0x01 << 3)\n#define CAPABILITY_RIGHT_BTN_MASK\t(0x01 << 4)\n#define CAPABILITY_MIDDLE_BTN_MASK\t(0x01 << 5)\n#define CAPABILITY_BTN_MASK  (CAPABILITY_LEFT_BTN_MASK | \\\n\t\t\t      CAPABILITY_RIGHT_BTN_MASK | \\\n\t\t\t      CAPABILITY_MIDDLE_BTN_MASK)\n\n#define PWR_MODE_MASK   0xfc\n#define PWR_MODE_FULL_ACTIVE (0x3f << 2)\n#define PWR_MODE_IDLE        (0x03 << 2)  \n#define PWR_MODE_SLEEP       (0x05 << 2)  \n#define PWR_MODE_BTN_ONLY    (0x01 << 2)\n#define PWR_MODE_OFF         (0x00 << 2)\n\n#define PWR_STATUS_MASK      0x0c\n#define PWR_STATUS_ACTIVE    (0x03 << 2)\n#define PWR_STATUS_IDLE      (0x02 << 2)\n#define PWR_STATUS_BTN_ONLY  (0x01 << 2)\n#define PWR_STATUS_OFF       (0x00 << 2)\n\n#define AUTOSUSPEND_DELAY   2000  \n\n#define BTN_ONLY_MODE_NAME   \"buttononly\"\n#define OFF_MODE_NAME        \"off\"\n\n \n#define PIP_HID_DESCRIPTOR_ADDR\t\t0x0001\n#define PIP_REPORT_DESCRIPTOR_ADDR\t0x0002\n#define PIP_INPUT_REPORT_ADDR\t\t0x0003\n#define PIP_OUTPUT_REPORT_ADDR\t\t0x0004\n#define PIP_CMD_DATA_ADDR\t\t0x0006\n\n#define PIP_RETRIEVE_DATA_STRUCTURE\t0x24\n#define PIP_CMD_CALIBRATE\t\t0x28\n#define PIP_BL_CMD_VERIFY_APP_INTEGRITY\t0x31\n#define PIP_BL_CMD_GET_BL_INFO\t\t0x38\n#define PIP_BL_CMD_PROGRAM_VERIFY_ROW\t0x39\n#define PIP_BL_CMD_LAUNCH_APP\t\t0x3b\n#define PIP_BL_CMD_INITIATE_BL\t\t0x48\n#define PIP_INVALID_CMD\t\t\t0xff\n\n#define PIP_HID_DESCRIPTOR_SIZE\t\t32\n#define PIP_HID_APP_REPORT_ID\t\t0xf7\n#define PIP_HID_BL_REPORT_ID\t\t0xff\n\n#define PIP_BL_CMD_REPORT_ID\t\t0x40\n#define PIP_BL_RESP_REPORT_ID\t\t0x30\n#define PIP_APP_CMD_REPORT_ID\t\t0x2f\n#define PIP_APP_RESP_REPORT_ID\t\t0x1f\n\n#define PIP_READ_SYS_INFO_CMD_LENGTH\t7\n#define PIP_BL_READ_APP_INFO_CMD_LENGTH\t13\n#define PIP_MIN_BL_CMD_LENGTH\t\t13\n#define PIP_MIN_BL_RESP_LENGTH\t\t11\n#define PIP_MIN_APP_CMD_LENGTH\t\t7\n#define PIP_MIN_APP_RESP_LENGTH\t\t5\n#define PIP_UNSUPPORTED_CMD_RESP_LENGTH\t6\n#define PIP_READ_SYS_INFO_RESP_LENGTH\t71\n#define PIP_BL_APP_INFO_RESP_LENGTH\t30\n#define PIP_BL_GET_INFO_RESP_LENGTH\t19\n\n#define PIP_BL_PLATFORM_VER_SHIFT\t4\n#define PIP_BL_PLATFORM_VER_MASK\t0x0f\n\n#define PIP_PRODUCT_FAMILY_MASK\t\t0xf000\n#define PIP_PRODUCT_FAMILY_TRACKPAD\t0x1000\n\n#define PIP_DEEP_SLEEP_STATE_ON\t\t0x00\n#define PIP_DEEP_SLEEP_STATE_OFF\t0x01\n#define PIP_DEEP_SLEEP_STATE_MASK\t0x03\n#define PIP_APP_DEEP_SLEEP_REPORT_ID\t0xf0\n#define PIP_DEEP_SLEEP_RESP_LENGTH\t5\n#define PIP_DEEP_SLEEP_OPCODE\t\t0x08\n#define PIP_DEEP_SLEEP_OPCODE_MASK\t0x0f\n\n#define PIP_RESP_LENGTH_OFFSET\t\t0\n#define\t    PIP_RESP_LENGTH_SIZE\t2\n#define PIP_RESP_REPORT_ID_OFFSET\t2\n#define PIP_RESP_RSVD_OFFSET\t\t3\n#define     PIP_RESP_RSVD_KEY\t\t0x00\n#define PIP_RESP_BL_SOP_OFFSET\t\t4\n#define     PIP_SOP_KEY\t\t\t0x01   \n#define     PIP_EOP_KEY\t\t\t0x17   \n#define PIP_RESP_APP_CMD_OFFSET\t\t4\n#define     GET_PIP_CMD_CODE(reg)\t((reg) & 0x7f)\n#define PIP_RESP_STATUS_OFFSET\t\t5\n\n#define VALID_CMD_RESP_HEADER(resp, cmd)\t\t\t\t  \\\n\t(((resp)[PIP_RESP_REPORT_ID_OFFSET] == PIP_APP_RESP_REPORT_ID) && \\\n\t((resp)[PIP_RESP_RSVD_OFFSET] == PIP_RESP_RSVD_KEY) &&\t\t  \\\n\t(GET_PIP_CMD_CODE((resp)[PIP_RESP_APP_CMD_OFFSET]) == (cmd)))\n\n#define PIP_CMD_COMPLETE_SUCCESS(resp_data) \\\n\t((resp_data)[PIP_RESP_STATUS_OFFSET] == 0x00)\n\n \n#define UNINIT_SLEEP_TIME\t0xffff\n#define UNINIT_PWR_MODE\t\t0xff\n#define PIP_DEV_SET_PWR_STATE(cyapa, s)\t\t((cyapa)->dev_pwr_mode = (s))\n#define PIP_DEV_GET_PWR_STATE(cyapa)\t\t((cyapa)->dev_pwr_mode)\n#define PIP_DEV_SET_SLEEP_TIME(cyapa, t)\t((cyapa)->dev_sleep_time = (t))\n#define PIP_DEV_GET_SLEEP_TIME(cyapa)\t\t((cyapa)->dev_sleep_time)\n#define PIP_DEV_UNINIT_SLEEP_TIME(cyapa)\t\\\n\t\t(((cyapa)->dev_sleep_time) == UNINIT_SLEEP_TIME)\n\n \n#define CYAPA_MAX_MT_SLOTS  15\n\nstruct cyapa;\n\ntypedef bool (*cb_sort)(struct cyapa *, u8 *, int);\n\nenum cyapa_pm_stage {\n\tCYAPA_PM_DEACTIVE,\n\tCYAPA_PM_ACTIVE,\n\tCYAPA_PM_SUSPEND,\n\tCYAPA_PM_RESUME,\n\tCYAPA_PM_RUNTIME_SUSPEND,\n\tCYAPA_PM_RUNTIME_RESUME,\n};\n\nstruct cyapa_dev_ops {\n\tint (*check_fw)(struct cyapa *, const struct firmware *);\n\tint (*bl_enter)(struct cyapa *);\n\tint (*bl_activate)(struct cyapa *);\n\tint (*bl_initiate)(struct cyapa *, const struct firmware *);\n\tint (*update_fw)(struct cyapa *, const struct firmware *);\n\tint (*bl_deactivate)(struct cyapa *);\n\n\tssize_t (*show_baseline)(struct device *,\n\t\t\tstruct device_attribute *, char *);\n\tssize_t (*calibrate_store)(struct device *,\n\t\t\tstruct device_attribute *, const char *, size_t);\n\n\tint (*initialize)(struct cyapa *cyapa);\n\n\tint (*state_parse)(struct cyapa *cyapa, u8 *reg_status, int len);\n\tint (*operational_check)(struct cyapa *cyapa);\n\n\tint (*irq_handler)(struct cyapa *);\n\tbool (*irq_cmd_handler)(struct cyapa *);\n\tint (*sort_empty_output_data)(struct cyapa *,\n\t\t\tu8 *, int *, cb_sort);\n\n\tint (*set_power_mode)(struct cyapa *, u8, u16, enum cyapa_pm_stage);\n\n\tint (*set_proximity)(struct cyapa *, bool);\n};\n\nstruct cyapa_pip_cmd_states {\n\tstruct mutex cmd_lock;\n\tstruct completion cmd_ready;\n\tatomic_t cmd_issued;\n\tu8 in_progress_cmd;\n\tbool is_irq_mode;\n\n\tcb_sort resp_sort_func;\n\tu8 *resp_data;\n\tint *resp_len;\n\n\tenum cyapa_pm_stage pm_stage;\n\tstruct mutex pm_stage_lock;\n\n\tu8 irq_cmd_buf[CYAPA_REG_MAP_SIZE];\n\tu8 empty_buf[CYAPA_REG_MAP_SIZE];\n};\n\nunion cyapa_cmd_states {\n\tstruct cyapa_pip_cmd_states pip;\n};\n\nenum cyapa_state {\n\tCYAPA_STATE_NO_DEVICE,\n\tCYAPA_STATE_BL_BUSY,\n\tCYAPA_STATE_BL_IDLE,\n\tCYAPA_STATE_BL_ACTIVE,\n\tCYAPA_STATE_OP,\n\tCYAPA_STATE_GEN5_BL,\n\tCYAPA_STATE_GEN5_APP,\n\tCYAPA_STATE_GEN6_BL,\n\tCYAPA_STATE_GEN6_APP,\n};\n\nstruct gen6_interval_setting {\n\tu16 active_interval;\n\tu16 lp1_interval;\n\tu16 lp2_interval;\n};\n\n \nstruct cyapa {\n\tenum cyapa_state state;\n\tu8 status[BL_STATUS_SIZE];\n\tbool operational;  \n\n\tstruct regulator *vcc;\n\tstruct i2c_client *client;\n\tstruct input_dev *input;\n\tchar phys[32];\t \n\tbool irq_wake;   \n\tbool smbus;\n\n\t \n\tu8 suspend_power_mode;\n\tu16 suspend_sleep_time;\n\tu8 runtime_suspend_power_mode;\n\tu16 runtime_suspend_sleep_time;\n\tu8 dev_pwr_mode;\n\tu16 dev_sleep_time;\n\tstruct gen6_interval_setting gen6_interval_setting;\n\n\t \n\tchar product_id[16];\n\tu8 platform_ver;   \n\tu8 fw_maj_ver;   \n\tu8 fw_min_ver;   \n\tu8 btn_capability;\n\tu8 gen;\n\tint max_abs_x;\n\tint max_abs_y;\n\tint physical_size_x;\n\tint physical_size_y;\n\n\t \n\tu8 x_origin;   \n\tu8 y_origin;   \n\tint electrodes_x;   \n\tint electrodes_y;   \n\tint electrodes_rx;   \n\tint aligned_electrodes_rx;   \n\tint max_z;\n\n\t \n\tstruct mutex state_sync_lock;\n\n\tconst struct cyapa_dev_ops *ops;\n\n\tunion cyapa_cmd_states cmd_states;\n};\n\n\nssize_t cyapa_i2c_reg_read_block(struct cyapa *cyapa, u8 reg, size_t len,\n\t\t\t\t u8 *values);\nssize_t cyapa_smbus_read_block(struct cyapa *cyapa, u8 cmd, size_t len,\n\t\t\t       u8 *values);\n\nssize_t cyapa_read_block(struct cyapa *cyapa, u8 cmd_idx, u8 *values);\n\nint cyapa_poll_state(struct cyapa *cyapa, unsigned int timeout);\n\nu8 cyapa_sleep_time_to_pwr_cmd(u16 sleep_time);\nu16 cyapa_pwr_cmd_to_sleep_time(u8 pwr_mode);\n\nssize_t cyapa_i2c_pip_read(struct cyapa *cyapa, u8 *buf, size_t size);\nssize_t cyapa_i2c_pip_write(struct cyapa *cyapa, u8 *buf, size_t size);\nint cyapa_empty_pip_output_data(struct cyapa *cyapa,\n\t\t\t\tu8 *buf, int *len, cb_sort func);\nint cyapa_i2c_pip_cmd_irq_sync(struct cyapa *cyapa,\n\t\t\t       u8 *cmd, int cmd_len,\n\t\t\t       u8 *resp_data, int *resp_len,\n\t\t\t       unsigned long timeout,\n\t\t\t       cb_sort func,\n\t\t\t       bool irq_mode);\nint cyapa_pip_state_parse(struct cyapa *cyapa, u8 *reg_data, int len);\nbool cyapa_pip_sort_system_info_data(struct cyapa *cyapa, u8 *buf, int len);\nbool cyapa_sort_tsg_pip_bl_resp_data(struct cyapa *cyapa, u8 *data, int len);\nint cyapa_pip_deep_sleep(struct cyapa *cyapa, u8 state);\nbool cyapa_sort_tsg_pip_app_resp_data(struct cyapa *cyapa, u8 *data, int len);\nint cyapa_pip_bl_exit(struct cyapa *cyapa);\nint cyapa_pip_bl_enter(struct cyapa *cyapa);\n\n\nbool cyapa_is_pip_bl_mode(struct cyapa *cyapa);\nbool cyapa_is_pip_app_mode(struct cyapa *cyapa);\nint cyapa_pip_cmd_state_initialize(struct cyapa *cyapa);\n\nint cyapa_pip_resume_scanning(struct cyapa *cyapa);\nint cyapa_pip_suspend_scanning(struct cyapa *cyapa);\n\nint cyapa_pip_check_fw(struct cyapa *cyapa, const struct firmware *fw);\nint cyapa_pip_bl_initiate(struct cyapa *cyapa, const struct firmware *fw);\nint cyapa_pip_do_fw_update(struct cyapa *cyapa, const struct firmware *fw);\nint cyapa_pip_bl_activate(struct cyapa *cyapa);\nint cyapa_pip_bl_deactivate(struct cyapa *cyapa);\nssize_t cyapa_pip_do_calibrate(struct device *dev,\n\t\t\t       struct device_attribute *attr,\n\t\t\t       const char *buf, size_t count);\nint cyapa_pip_set_proximity(struct cyapa *cyapa, bool enable);\n\nbool cyapa_pip_irq_cmd_handler(struct cyapa *cyapa);\nint cyapa_pip_irq_handler(struct cyapa *cyapa);\n\n\nextern u8 pip_read_sys_info[];\nextern u8 pip_bl_read_app_info[];\nextern const char product_id[];\nextern const struct cyapa_dev_ops cyapa_gen3_ops;\nextern const struct cyapa_dev_ops cyapa_gen5_ops;\nextern const struct cyapa_dev_ops cyapa_gen6_ops;\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}