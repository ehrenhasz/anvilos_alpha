{
  "module_name": "emu10k1-gp.c",
  "hash_id": "0089bb2178fae7bfda0e172204569cace496b78a20ec6c3e3b0e9edc8920d85b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/gameport/emu10k1-gp.c",
  "human_readable_source": "\n \n\n \n\n#include <asm/io.h>\n\n#include <linux/module.h>\n#include <linux/ioport.h>\n#include <linux/gameport.h>\n#include <linux/slab.h>\n#include <linux/pci.h>\n\nMODULE_AUTHOR(\"Vojtech Pavlik <vojtech@ucw.cz>\");\nMODULE_DESCRIPTION(\"EMU10k1 gameport driver\");\nMODULE_LICENSE(\"GPL\");\n\nstruct emu {\n\tstruct pci_dev *dev;\n\tstruct gameport *gameport;\n\tint io;\n\tint size;\n};\n\nstatic const struct pci_device_id emu_tbl[] = {\n\n\t{ 0x1102, 0x7002, PCI_ANY_ID, PCI_ANY_ID },  \n\t{ 0x1102, 0x7003, PCI_ANY_ID, PCI_ANY_ID },  \n\t{ 0x1102, 0x7004, PCI_ANY_ID, PCI_ANY_ID },  \n\t{ 0x1102, 0x7005, PCI_ANY_ID, PCI_ANY_ID },  \n\t{ 0, }\n};\n\nMODULE_DEVICE_TABLE(pci, emu_tbl);\n\nstatic int emu_probe(struct pci_dev *pdev, const struct pci_device_id *ent)\n{\n\tstruct emu *emu;\n\tstruct gameport *port;\n\tint error;\n\n\temu = kzalloc(sizeof(struct emu), GFP_KERNEL);\n\tport = gameport_allocate_port();\n\tif (!emu || !port) {\n\t\tprintk(KERN_ERR \"emu10k1-gp: Memory allocation failed\\n\");\n\t\terror = -ENOMEM;\n\t\tgoto err_out_free;\n\t}\n\n\terror = pci_enable_device(pdev);\n\tif (error)\n\t\tgoto err_out_free;\n\n\temu->io = pci_resource_start(pdev, 0);\n\temu->size = pci_resource_len(pdev, 0);\n\n\temu->dev = pdev;\n\temu->gameport = port;\n\n\tgameport_set_name(port, \"EMU10K1\");\n\tgameport_set_phys(port, \"pci%s/gameport0\", pci_name(pdev));\n\tport->dev.parent = &pdev->dev;\n\tport->io = emu->io;\n\n\tif (!request_region(emu->io, emu->size, \"emu10k1-gp\")) {\n\t\tprintk(KERN_ERR \"emu10k1-gp: unable to grab region 0x%x-0x%x\\n\",\n\t\t\temu->io, emu->io + emu->size - 1);\n\t\terror = -EBUSY;\n\t\tgoto err_out_disable_dev;\n\t}\n\n\tpci_set_drvdata(pdev, emu);\n\n\tgameport_register_port(port);\n\n\treturn 0;\n\n err_out_disable_dev:\n\tpci_disable_device(pdev);\n err_out_free:\n\tgameport_free_port(port);\n\tkfree(emu);\n\treturn error;\n}\n\nstatic void emu_remove(struct pci_dev *pdev)\n{\n\tstruct emu *emu = pci_get_drvdata(pdev);\n\n\tgameport_unregister_port(emu->gameport);\n\trelease_region(emu->io, emu->size);\n\tkfree(emu);\n\n\tpci_disable_device(pdev);\n}\n\nstatic struct pci_driver emu_driver = {\n        .name =         \"Emu10k1_gameport\",\n        .id_table =     emu_tbl,\n        .probe =        emu_probe,\n\t.remove =\temu_remove,\n};\n\nmodule_pci_driver(emu_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}