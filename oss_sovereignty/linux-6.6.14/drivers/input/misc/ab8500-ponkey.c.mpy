{
  "module_name": "ab8500-ponkey.c",
  "hash_id": "885a62dfb263bb4b847c1f1e910c7b8b6c06d01b91b0fe84c7855a8929da4a49",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/ab8500-ponkey.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/input.h>\n#include <linux/interrupt.h>\n#include <linux/mfd/abx500/ab8500.h>\n#include <linux/of.h>\n#include <linux/slab.h>\n\n \nstruct ab8500_ponkey {\n\tstruct input_dev\t*idev;\n\tstruct ab8500\t\t*ab8500;\n\tint\t\t\tirq_dbf;\n\tint\t\t\tirq_dbr;\n};\n\n \nstatic irqreturn_t ab8500_ponkey_handler(int irq, void *data)\n{\n\tstruct ab8500_ponkey *ponkey = data;\n\n\tif (irq == ponkey->irq_dbf)\n\t\tinput_report_key(ponkey->idev, KEY_POWER, true);\n\telse if (irq == ponkey->irq_dbr)\n\t\tinput_report_key(ponkey->idev, KEY_POWER, false);\n\n\tinput_sync(ponkey->idev);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int ab8500_ponkey_probe(struct platform_device *pdev)\n{\n\tstruct ab8500 *ab8500 = dev_get_drvdata(pdev->dev.parent);\n\tstruct ab8500_ponkey *ponkey;\n\tstruct input_dev *input;\n\tint irq_dbf, irq_dbr;\n\tint error;\n\n\tirq_dbf = platform_get_irq_byname(pdev, \"ONKEY_DBF\");\n\tif (irq_dbf < 0)\n\t\treturn irq_dbf;\n\n\tirq_dbr = platform_get_irq_byname(pdev, \"ONKEY_DBR\");\n\tif (irq_dbr < 0)\n\t\treturn irq_dbr;\n\n\tponkey = devm_kzalloc(&pdev->dev, sizeof(struct ab8500_ponkey),\n\t\t\t      GFP_KERNEL);\n\tif (!ponkey)\n\t\treturn -ENOMEM;\n\n\tinput = devm_input_allocate_device(&pdev->dev);\n\tif (!input)\n\t\treturn -ENOMEM;\n\n\tponkey->idev = input;\n\tponkey->ab8500 = ab8500;\n\tponkey->irq_dbf = irq_dbf;\n\tponkey->irq_dbr = irq_dbr;\n\n\tinput->name = \"AB8500 POn(PowerOn) Key\";\n\tinput->dev.parent = &pdev->dev;\n\n\tinput_set_capability(input, EV_KEY, KEY_POWER);\n\n\terror = devm_request_any_context_irq(&pdev->dev, ponkey->irq_dbf,\n\t\t\t\t\t     ab8500_ponkey_handler, 0,\n\t\t\t\t\t     \"ab8500-ponkey-dbf\", ponkey);\n\tif (error < 0) {\n\t\tdev_err(ab8500->dev, \"Failed to request dbf IRQ#%d: %d\\n\",\n\t\t\tponkey->irq_dbf, error);\n\t\treturn error;\n\t}\n\n\terror = devm_request_any_context_irq(&pdev->dev, ponkey->irq_dbr,\n\t\t\t\t\t     ab8500_ponkey_handler, 0,\n\t\t\t\t\t     \"ab8500-ponkey-dbr\", ponkey);\n\tif (error < 0) {\n\t\tdev_err(ab8500->dev, \"Failed to request dbr IRQ#%d: %d\\n\",\n\t\t\tponkey->irq_dbr, error);\n\t\treturn error;\n\t}\n\n\terror = input_register_device(ponkey->idev);\n\tif (error) {\n\t\tdev_err(ab8500->dev, \"Can't register input device: %d\\n\", error);\n\t\treturn error;\n\t}\n\n\treturn 0;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id ab8500_ponkey_match[] = {\n\t{ .compatible = \"stericsson,ab8500-ponkey\", },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, ab8500_ponkey_match);\n#endif\n\nstatic struct platform_driver ab8500_ponkey_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"ab8500-poweron-key\",\n\t\t.of_match_table = of_match_ptr(ab8500_ponkey_match),\n\t},\n\t.probe\t\t= ab8500_ponkey_probe,\n};\nmodule_platform_driver(ab8500_ponkey_driver);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_AUTHOR(\"Sundar Iyer <sundar.iyer@stericsson.com>\");\nMODULE_DESCRIPTION(\"ST-Ericsson AB8500 Power-ON(Pon) Key driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}