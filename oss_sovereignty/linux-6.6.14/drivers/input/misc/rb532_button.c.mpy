{
  "module_name": "rb532_button.c",
  "hash_id": "32ddfbbcddbe9abff8e31ecac360aa536f124993a9ad7b03307856c66841b7af",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/rb532_button.c",
  "human_readable_source": "\n \n\n#include <linux/input.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/gpio.h>\n\n#include <asm/mach-rc32434/gpio.h>\n#include <asm/mach-rc32434/rb.h>\n\n#define DRV_NAME \"rb532-button\"\n\n#define RB532_BTN_RATE 100  \n#define RB532_BTN_KSYM BTN_0\n\n \nstatic bool rb532_button_pressed(void)\n{\n\tint val;\n\n\tset_latch_u5(0, LO_FOFF);\n\tgpio_direction_input(GPIO_BTN_S1);\n\n\tval = gpio_get_value(GPIO_BTN_S1);\n\n\trb532_gpio_set_func(GPIO_BTN_S1);\n\tset_latch_u5(LO_FOFF, 0);\n\n\treturn !val;\n}\n\nstatic void rb532_button_poll(struct input_dev *input)\n{\n\tinput_report_key(input, RB532_BTN_KSYM, rb532_button_pressed());\n\tinput_sync(input);\n}\n\nstatic int rb532_button_probe(struct platform_device *pdev)\n{\n\tstruct input_dev *input;\n\tint error;\n\n\tinput = devm_input_allocate_device(&pdev->dev);\n\tif (!input)\n\t\treturn -ENOMEM;\n\n\tinput->name = \"rb532 button\";\n\tinput->phys = \"rb532/button0\";\n\tinput->id.bustype = BUS_HOST;\n\n\tinput_set_capability(input, EV_KEY, RB532_BTN_KSYM);\n\n\terror = input_setup_polling(input, rb532_button_poll);\n\tif (error)\n\t\treturn error;\n\n\tinput_set_poll_interval(input, RB532_BTN_RATE);\n\n\terror = input_register_device(input);\n\tif (error)\n\t\treturn error;\n\n\treturn 0;\n}\n\nstatic struct platform_driver rb532_button_driver = {\n\t.probe = rb532_button_probe,\n\t.driver = {\n\t\t.name = DRV_NAME,\n\t},\n};\nmodule_platform_driver(rb532_button_driver);\n\nMODULE_AUTHOR(\"Phil Sutter <n0-1@freewrt.org>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"Support for S1 button on Routerboard 532\");\nMODULE_ALIAS(\"platform:\" DRV_NAME);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}