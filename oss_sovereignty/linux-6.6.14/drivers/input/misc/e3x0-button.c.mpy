{
  "module_name": "e3x0-button.c",
  "hash_id": "5c658f40f4f1b68225f6b3bde3f5e1811d9a22836f15ec7a9974141d9ab3c733",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/e3x0-button.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/input.h>\n#include <linux/interrupt.h>\n#include <linux/of.h>\n#include <linux/slab.h>\n\nstatic irqreturn_t e3x0_button_release_handler(int irq, void *data)\n{\n\tstruct input_dev *idev = data;\n\n\tinput_report_key(idev, KEY_POWER, 0);\n\tinput_sync(idev);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t e3x0_button_press_handler(int irq, void *data)\n{\n\tstruct input_dev *idev = data;\n\n\tinput_report_key(idev, KEY_POWER, 1);\n\tpm_wakeup_event(idev->dev.parent, 0);\n\tinput_sync(idev);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int e3x0_button_suspend(struct device *dev)\n{\n\tstruct platform_device *pdev = to_platform_device(dev);\n\n\tif (device_may_wakeup(dev))\n\t\tenable_irq_wake(platform_get_irq_byname(pdev, \"press\"));\n\n\treturn 0;\n}\n\nstatic int e3x0_button_resume(struct device *dev)\n{\n\tstruct platform_device *pdev = to_platform_device(dev);\n\n\tif (device_may_wakeup(dev))\n\t\tdisable_irq_wake(platform_get_irq_byname(pdev, \"press\"));\n\n\treturn 0;\n}\n\nstatic DEFINE_SIMPLE_DEV_PM_OPS(e3x0_button_pm_ops,\n\t\t\t\te3x0_button_suspend, e3x0_button_resume);\n\nstatic int e3x0_button_probe(struct platform_device *pdev)\n{\n\tstruct input_dev *input;\n\tint irq_press, irq_release;\n\tint error;\n\n\tirq_press = platform_get_irq_byname(pdev, \"press\");\n\tif (irq_press < 0)\n\t\treturn irq_press;\n\n\tirq_release = platform_get_irq_byname(pdev, \"release\");\n\tif (irq_release < 0)\n\t\treturn irq_release;\n\n\tinput = devm_input_allocate_device(&pdev->dev);\n\tif (!input)\n\t\treturn -ENOMEM;\n\n\tinput->name = \"NI Ettus Research USRP E3x0 Button Driver\";\n\tinput->phys = \"e3x0_button/input0\";\n\tinput->dev.parent = &pdev->dev;\n\n\tinput_set_capability(input, EV_KEY, KEY_POWER);\n\n\terror = devm_request_irq(&pdev->dev, irq_press,\n\t\t\t\t e3x0_button_press_handler, 0,\n\t\t\t\t \"e3x0-button\", input);\n\tif (error) {\n\t\tdev_err(&pdev->dev, \"Failed to request 'press' IRQ#%d: %d\\n\",\n\t\t\tirq_press, error);\n\t\treturn error;\n\t}\n\n\terror = devm_request_irq(&pdev->dev, irq_release,\n\t\t\t\t e3x0_button_release_handler, 0,\n\t\t\t\t \"e3x0-button\", input);\n\tif (error) {\n\t\tdev_err(&pdev->dev, \"Failed to request 'release' IRQ#%d: %d\\n\",\n\t\t\tirq_release, error);\n\t\treturn error;\n\t}\n\n\terror = input_register_device(input);\n\tif (error) {\n\t\tdev_err(&pdev->dev, \"Can't register input device: %d\\n\", error);\n\t\treturn error;\n\t}\n\n\tdevice_init_wakeup(&pdev->dev, 1);\n\treturn 0;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id e3x0_button_match[] = {\n\t{ .compatible = \"ettus,e3x0-button\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, e3x0_button_match);\n#endif\n\nstatic struct platform_driver e3x0_button_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"e3x0-button\",\n\t\t.of_match_table = of_match_ptr(e3x0_button_match),\n\t\t.pm\t= pm_sleep_ptr(&e3x0_button_pm_ops),\n\t},\n\t.probe\t\t= e3x0_button_probe,\n};\n\nmodule_platform_driver(e3x0_button_driver);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_AUTHOR(\"Moritz Fischer <moritz.fischer@ettus.com>\");\nMODULE_DESCRIPTION(\"NI Ettus Research USRP E3x0 Button driver\");\nMODULE_ALIAS(\"platform:e3x0-button\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}