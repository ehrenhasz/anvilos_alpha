{
  "module_name": "pcf50633-input.c",
  "hash_id": "237737e363fc71b08a41f627638fe86ce37f38db444c84730cf8b17979453d30",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/pcf50633-input.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/platform_device.h>\n#include <linux/input.h>\n#include <linux/slab.h>\n\n#include <linux/mfd/pcf50633/core.h>\n\n#define PCF50633_OOCSTAT_ONKEY\t0x01\n#define PCF50633_REG_OOCSTAT\t0x12\n#define PCF50633_REG_OOCMODE\t0x10\n\nstruct pcf50633_input {\n\tstruct pcf50633 *pcf;\n\tstruct input_dev *input_dev;\n};\n\nstatic void\npcf50633_input_irq(int irq, void *data)\n{\n\tstruct pcf50633_input *input;\n\tint onkey_released;\n\n\tinput = data;\n\n\t \n\tonkey_released = pcf50633_reg_read(input->pcf, PCF50633_REG_OOCSTAT)\n\t\t\t\t\t\t& PCF50633_OOCSTAT_ONKEY;\n\n\tif (irq == PCF50633_IRQ_ONKEYF && !onkey_released)\n\t\tinput_report_key(input->input_dev, KEY_POWER, 1);\n\telse if (irq == PCF50633_IRQ_ONKEYR && onkey_released)\n\t\tinput_report_key(input->input_dev, KEY_POWER, 0);\n\n\tinput_sync(input->input_dev);\n}\n\nstatic int pcf50633_input_probe(struct platform_device *pdev)\n{\n\tstruct pcf50633_input *input;\n\tstruct input_dev *input_dev;\n\tint ret;\n\n\n\tinput = kzalloc(sizeof(*input), GFP_KERNEL);\n\tif (!input)\n\t\treturn -ENOMEM;\n\n\tinput_dev = input_allocate_device();\n\tif (!input_dev) {\n\t\tkfree(input);\n\t\treturn -ENOMEM;\n\t}\n\n\tplatform_set_drvdata(pdev, input);\n\tinput->pcf = dev_to_pcf50633(pdev->dev.parent);\n\tinput->input_dev = input_dev;\n\n\tinput_dev->name = \"PCF50633 PMU events\";\n\tinput_dev->id.bustype = BUS_I2C;\n\tinput_dev->evbit[0] = BIT(EV_KEY) | BIT(EV_PWR);\n\tset_bit(KEY_POWER, input_dev->keybit);\n\n\tret = input_register_device(input_dev);\n\tif (ret) {\n\t\tinput_free_device(input_dev);\n\t\tkfree(input);\n\t\treturn ret;\n\t}\n\tpcf50633_register_irq(input->pcf, PCF50633_IRQ_ONKEYR,\n\t\t\t\tpcf50633_input_irq, input);\n\tpcf50633_register_irq(input->pcf, PCF50633_IRQ_ONKEYF,\n\t\t\t\tpcf50633_input_irq, input);\n\n\treturn 0;\n}\n\nstatic int pcf50633_input_remove(struct platform_device *pdev)\n{\n\tstruct pcf50633_input *input  = platform_get_drvdata(pdev);\n\n\tpcf50633_free_irq(input->pcf, PCF50633_IRQ_ONKEYR);\n\tpcf50633_free_irq(input->pcf, PCF50633_IRQ_ONKEYF);\n\n\tinput_unregister_device(input->input_dev);\n\tkfree(input);\n\n\treturn 0;\n}\n\nstatic struct platform_driver pcf50633_input_driver = {\n\t.driver = {\n\t\t.name = \"pcf50633-input\",\n\t},\n\t.probe = pcf50633_input_probe,\n\t.remove = pcf50633_input_remove,\n};\nmodule_platform_driver(pcf50633_input_driver);\n\nMODULE_AUTHOR(\"Balaji Rao <balajirrao@openmoko.org>\");\nMODULE_DESCRIPTION(\"PCF50633 input driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:pcf50633-input\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}