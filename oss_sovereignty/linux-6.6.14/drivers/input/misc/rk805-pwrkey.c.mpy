{
  "module_name": "rk805-pwrkey.c",
  "hash_id": "91bf5eb8ac80be97bc9fb1e53f16c78af00013fd32058adea6874b8f042d6bf4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/rk805-pwrkey.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include <linux/init.h>\n#include <linux/input.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\nstatic irqreturn_t pwrkey_fall_irq(int irq, void *_pwr)\n{\n\tstruct input_dev *pwr = _pwr;\n\n\tinput_report_key(pwr, KEY_POWER, 1);\n\tinput_sync(pwr);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t pwrkey_rise_irq(int irq, void *_pwr)\n{\n\tstruct input_dev *pwr = _pwr;\n\n\tinput_report_key(pwr, KEY_POWER, 0);\n\tinput_sync(pwr);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int rk805_pwrkey_probe(struct platform_device *pdev)\n{\n\tstruct input_dev *pwr;\n\tint fall_irq, rise_irq;\n\tint err;\n\n\tpwr = devm_input_allocate_device(&pdev->dev);\n\tif (!pwr) {\n\t\tdev_err(&pdev->dev, \"Can't allocate power button\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tpwr->name = \"rk805 pwrkey\";\n\tpwr->phys = \"rk805_pwrkey/input0\";\n\tpwr->id.bustype = BUS_HOST;\n\tinput_set_capability(pwr, EV_KEY, KEY_POWER);\n\n\tfall_irq = platform_get_irq(pdev, 0);\n\tif (fall_irq < 0)\n\t\treturn fall_irq;\n\n\trise_irq = platform_get_irq(pdev, 1);\n\tif (rise_irq < 0)\n\t\treturn rise_irq;\n\n\terr = devm_request_any_context_irq(&pwr->dev, fall_irq,\n\t\t\t\t\t   pwrkey_fall_irq,\n\t\t\t\t\t   IRQF_TRIGGER_FALLING | IRQF_ONESHOT,\n\t\t\t\t\t   \"rk805_pwrkey_fall\", pwr);\n\tif (err < 0) {\n\t\tdev_err(&pdev->dev, \"Can't register fall irq: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\terr = devm_request_any_context_irq(&pwr->dev, rise_irq,\n\t\t\t\t\t   pwrkey_rise_irq,\n\t\t\t\t\t   IRQF_TRIGGER_RISING | IRQF_ONESHOT,\n\t\t\t\t\t   \"rk805_pwrkey_rise\", pwr);\n\tif (err < 0) {\n\t\tdev_err(&pdev->dev, \"Can't register rise irq: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\terr = input_register_device(pwr);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"Can't register power button: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\tplatform_set_drvdata(pdev, pwr);\n\tdevice_init_wakeup(&pdev->dev, true);\n\n\treturn 0;\n}\n\nstatic struct platform_driver rk805_pwrkey_driver = {\n\t.probe\t= rk805_pwrkey_probe,\n\t.driver\t= {\n\t\t.name = \"rk805-pwrkey\",\n\t},\n};\nmodule_platform_driver(rk805_pwrkey_driver);\n\nMODULE_ALIAS(\"platform:rk805-pwrkey\");\nMODULE_AUTHOR(\"Joseph Chen <chenjh@rock-chips.com>\");\nMODULE_DESCRIPTION(\"RK805 PMIC Power Key driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}