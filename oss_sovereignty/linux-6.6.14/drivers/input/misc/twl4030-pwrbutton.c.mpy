{
  "module_name": "twl4030-pwrbutton.c",
  "hash_id": "f571c951b583d030fa405530b70c876b309a258d16b26d868899f8ebfc880aaa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/twl4030-pwrbutton.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/input.h>\n#include <linux/interrupt.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/mfd/twl.h>\n\n#define PWR_PWRON_IRQ (1 << 0)\n\n#define STS_HW_CONDITIONS 0xf\n\nstatic irqreturn_t powerbutton_irq(int irq, void *_pwr)\n{\n\tstruct input_dev *pwr = _pwr;\n\tint err;\n\tu8 value;\n\n\terr = twl_i2c_read_u8(TWL_MODULE_PM_MASTER, &value, STS_HW_CONDITIONS);\n\tif (!err)  {\n\t\tpm_wakeup_event(pwr->dev.parent, 0);\n\t\tinput_report_key(pwr, KEY_POWER, value & PWR_PWRON_IRQ);\n\t\tinput_sync(pwr);\n\t} else {\n\t\tdev_err(pwr->dev.parent, \"twl4030: i2c error %d while reading\"\n\t\t\t\" TWL4030 PM_MASTER STS_HW_CONDITIONS register\\n\", err);\n\t}\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int twl4030_pwrbutton_probe(struct platform_device *pdev)\n{\n\tstruct input_dev *pwr;\n\tint irq = platform_get_irq(pdev, 0);\n\tint err;\n\n\tpwr = devm_input_allocate_device(&pdev->dev);\n\tif (!pwr) {\n\t\tdev_err(&pdev->dev, \"Can't allocate power button\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tinput_set_capability(pwr, EV_KEY, KEY_POWER);\n\tpwr->name = \"twl4030_pwrbutton\";\n\tpwr->phys = \"twl4030_pwrbutton/input0\";\n\tpwr->dev.parent = &pdev->dev;\n\n\terr = devm_request_threaded_irq(&pdev->dev, irq, NULL, powerbutton_irq,\n\t\t\tIRQF_TRIGGER_FALLING | IRQF_TRIGGER_RISING |\n\t\t\tIRQF_ONESHOT,\n\t\t\t\"twl4030_pwrbutton\", pwr);\n\tif (err < 0) {\n\t\tdev_err(&pdev->dev, \"Can't get IRQ for pwrbutton: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\terr = input_register_device(pwr);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"Can't register power button: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\tdevice_init_wakeup(&pdev->dev, true);\n\n\treturn 0;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id twl4030_pwrbutton_dt_match_table[] = {\n       { .compatible = \"ti,twl4030-pwrbutton\" },\n       {},\n};\nMODULE_DEVICE_TABLE(of, twl4030_pwrbutton_dt_match_table);\n#endif\n\nstatic struct platform_driver twl4030_pwrbutton_driver = {\n\t.probe\t\t= twl4030_pwrbutton_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"twl4030_pwrbutton\",\n\t\t.of_match_table = of_match_ptr(twl4030_pwrbutton_dt_match_table),\n\t},\n};\nmodule_platform_driver(twl4030_pwrbutton_driver);\n\nMODULE_ALIAS(\"platform:twl4030_pwrbutton\");\nMODULE_DESCRIPTION(\"Triton2 Power Button\");\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Peter De Schrijver <peter.de-schrijver@nokia.com>\");\nMODULE_AUTHOR(\"Felipe Balbi <felipe.balbi@nokia.com>\");\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}