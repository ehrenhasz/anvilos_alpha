{
  "module_name": "rave-sp-pwrbutton.c",
  "hash_id": "7288356eb85142d8fc02c19d7744d5f226be3031e2035ec82c87aae7f952230d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/rave-sp-pwrbutton.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n#include <linux/input.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/mfd/rave-sp.h>\n#include <linux/platform_device.h>\n\n#define RAVE_SP_EVNT_BUTTON_PRESS\t(RAVE_SP_EVNT_BASE + 0x00)\n\nstruct rave_sp_power_button {\n\tstruct input_dev *idev;\n\tstruct notifier_block nb;\n};\n\nstatic int rave_sp_power_button_event(struct notifier_block *nb,\n\t\t\t\t      unsigned long action, void *data)\n{\n\tstruct rave_sp_power_button *pb =\n\t\tcontainer_of(nb, struct rave_sp_power_button, nb);\n\tconst u8 event = rave_sp_action_unpack_event(action);\n\tconst u8 value = rave_sp_action_unpack_value(action);\n\tstruct input_dev *idev = pb->idev;\n\n\tif (event == RAVE_SP_EVNT_BUTTON_PRESS) {\n\t\tinput_report_key(idev, KEY_POWER, value);\n\t\tinput_sync(idev);\n\n\t\treturn NOTIFY_STOP;\n\t}\n\n\treturn NOTIFY_DONE;\n}\n\nstatic int rave_sp_pwrbutton_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct rave_sp_power_button *pb;\n\tstruct input_dev *idev;\n\tint error;\n\n\tpb = devm_kzalloc(dev, sizeof(*pb), GFP_KERNEL);\n\tif (!pb)\n\t\treturn -ENOMEM;\n\n\tidev = devm_input_allocate_device(dev);\n\tif (!idev)\n\t\treturn -ENOMEM;\n\n\tidev->name = pdev->name;\n\n\tinput_set_capability(idev, EV_KEY, KEY_POWER);\n\n\terror = input_register_device(idev);\n\tif (error)\n\t\treturn error;\n\n\tpb->idev = idev;\n\tpb->nb.notifier_call = rave_sp_power_button_event;\n\tpb->nb.priority = 128;\n\n\terror = devm_rave_sp_register_event_notifier(dev, &pb->nb);\n\tif (error)\n\t\treturn error;\n\n\treturn 0;\n}\n\nstatic const struct of_device_id rave_sp_pwrbutton_of_match[] = {\n\t{ .compatible = \"zii,rave-sp-pwrbutton\" },\n\t{}\n};\n\nstatic struct platform_driver rave_sp_pwrbutton_driver = {\n\t.probe = rave_sp_pwrbutton_probe,\n\t.driver\t= {\n\t\t.name = KBUILD_MODNAME,\n\t\t.of_match_table = rave_sp_pwrbutton_of_match,\n\t},\n};\nmodule_platform_driver(rave_sp_pwrbutton_driver);\n\nMODULE_DEVICE_TABLE(of, rave_sp_pwrbutton_of_match);\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Andrey Vostrikov <andrey.vostrikov@cogentembedded.com>\");\nMODULE_AUTHOR(\"Nikita Yushchenko <nikita.yoush@cogentembedded.com>\");\nMODULE_AUTHOR(\"Andrey Smirnov <andrew.smirnov@gmail.com>\");\nMODULE_DESCRIPTION(\"RAVE SP Power Button driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}