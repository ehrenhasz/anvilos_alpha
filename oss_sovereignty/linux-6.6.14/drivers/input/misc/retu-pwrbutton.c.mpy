{
  "module_name": "retu-pwrbutton.c",
  "hash_id": "fac34b9a89a776f9d01beb0561d9c6acce111ebd200b0a2cb8e33838b78b2223",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/retu-pwrbutton.c",
  "human_readable_source": " \n\n#include <linux/irq.h>\n#include <linux/slab.h>\n#include <linux/errno.h>\n#include <linux/input.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/mfd/retu.h>\n#include <linux/interrupt.h>\n#include <linux/platform_device.h>\n\n#define RETU_STATUS_PWRONX (1 << 5)\n\nstatic irqreturn_t retu_pwrbutton_irq(int irq, void *_pwr)\n{\n\tstruct input_dev *idev = _pwr;\n\tstruct retu_dev *rdev = input_get_drvdata(idev);\n\tbool state;\n\n\tstate = !(retu_read(rdev, RETU_REG_STATUS) & RETU_STATUS_PWRONX);\n\tinput_report_key(idev, KEY_POWER, state);\n\tinput_sync(idev);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int retu_pwrbutton_probe(struct platform_device *pdev)\n{\n\tstruct retu_dev *rdev = dev_get_drvdata(pdev->dev.parent);\n\tstruct input_dev *idev;\n\tint irq;\n\tint error;\n\n\tirq = platform_get_irq(pdev, 0);\n\tif (irq < 0)\n\t\treturn irq;\n\n\tidev = devm_input_allocate_device(&pdev->dev);\n\tif (!idev)\n\t\treturn -ENOMEM;\n\n\tidev->name = \"retu-pwrbutton\";\n\tidev->dev.parent = &pdev->dev;\n\n\tinput_set_capability(idev, EV_KEY, KEY_POWER);\n\tinput_set_drvdata(idev, rdev);\n\n\terror = devm_request_threaded_irq(&pdev->dev, irq,\n\t\t\t\t\t  NULL, retu_pwrbutton_irq,\n\t\t\t\t\t  IRQF_ONESHOT,\n\t\t\t\t\t  \"retu-pwrbutton\", idev);\n\tif (error)\n\t\treturn error;\n\n\terror = input_register_device(idev);\n\tif (error)\n\t\treturn error;\n\n\treturn 0;\n}\n\nstatic struct platform_driver retu_pwrbutton_driver = {\n\t.probe\t\t= retu_pwrbutton_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"retu-pwrbutton\",\n\t},\n};\nmodule_platform_driver(retu_pwrbutton_driver);\n\nMODULE_ALIAS(\"platform:retu-pwrbutton\");\nMODULE_DESCRIPTION(\"Retu Power Button\");\nMODULE_AUTHOR(\"Ari Saastamoinen\");\nMODULE_AUTHOR(\"Felipe Balbi\");\nMODULE_AUTHOR(\"Aaro Koskinen <aaro.koskinen@iki.fi>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}