{
  "module_name": "adxl34x-spi.c",
  "hash_id": "2191291feaa9108026359e0d06bd75b340a50c25bd6d457f8d11e53ca39231a4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/input/misc/adxl34x-spi.c",
  "human_readable_source": "\n \n\n#include <linux/input.h>\t \n#include <linux/module.h>\n#include <linux/spi/spi.h>\n#include <linux/pm.h>\n#include <linux/types.h>\n#include \"adxl34x.h\"\n\n#define MAX_SPI_FREQ_HZ\t\t5000000\n#define MAX_FREQ_NO_FIFODELAY\t1500000\n#define ADXL34X_CMD_MULTB\t(1 << 6)\n#define ADXL34X_CMD_READ\t(1 << 7)\n#define ADXL34X_WRITECMD(reg)\t(reg & 0x3F)\n#define ADXL34X_READCMD(reg)\t(ADXL34X_CMD_READ | (reg & 0x3F))\n#define ADXL34X_READMB_CMD(reg) (ADXL34X_CMD_READ | ADXL34X_CMD_MULTB \\\n\t\t\t\t\t| (reg & 0x3F))\n\nstatic int adxl34x_spi_read(struct device *dev, unsigned char reg)\n{\n\tstruct spi_device *spi = to_spi_device(dev);\n\tunsigned char cmd;\n\n\tcmd = ADXL34X_READCMD(reg);\n\n\treturn spi_w8r8(spi, cmd);\n}\n\nstatic int adxl34x_spi_write(struct device *dev,\n\t\t\t     unsigned char reg, unsigned char val)\n{\n\tstruct spi_device *spi = to_spi_device(dev);\n\tunsigned char buf[2];\n\n\tbuf[0] = ADXL34X_WRITECMD(reg);\n\tbuf[1] = val;\n\n\treturn spi_write(spi, buf, sizeof(buf));\n}\n\nstatic int adxl34x_spi_read_block(struct device *dev,\n\t\t\t\t  unsigned char reg, int count,\n\t\t\t\t  void *buf)\n{\n\tstruct spi_device *spi = to_spi_device(dev);\n\tssize_t status;\n\n\treg = ADXL34X_READMB_CMD(reg);\n\tstatus = spi_write_then_read(spi, &reg, 1, buf, count);\n\n\treturn (status < 0) ? status : 0;\n}\n\nstatic const struct adxl34x_bus_ops adxl34x_spi_bops = {\n\t.bustype\t= BUS_SPI,\n\t.write\t\t= adxl34x_spi_write,\n\t.read\t\t= adxl34x_spi_read,\n\t.read_block\t= adxl34x_spi_read_block,\n};\n\nstatic int adxl34x_spi_probe(struct spi_device *spi)\n{\n\tstruct adxl34x *ac;\n\n\t \n\tif (spi->max_speed_hz > MAX_SPI_FREQ_HZ) {\n\t\tdev_err(&spi->dev, \"SPI CLK %d Hz too fast\\n\", spi->max_speed_hz);\n\t\treturn -EINVAL;\n\t}\n\n\tac = adxl34x_probe(&spi->dev, spi->irq,\n\t\t\t   spi->max_speed_hz > MAX_FREQ_NO_FIFODELAY,\n\t\t\t   &adxl34x_spi_bops);\n\n\tif (IS_ERR(ac))\n\t\treturn PTR_ERR(ac);\n\n\tspi_set_drvdata(spi, ac);\n\n\treturn 0;\n}\n\nstatic void adxl34x_spi_remove(struct spi_device *spi)\n{\n\tstruct adxl34x *ac = spi_get_drvdata(spi);\n\n\tadxl34x_remove(ac);\n}\n\nstatic struct spi_driver adxl34x_driver = {\n\t.driver = {\n\t\t.name = \"adxl34x\",\n\t\t.pm = pm_sleep_ptr(&adxl34x_pm),\n\t},\n\t.probe   = adxl34x_spi_probe,\n\t.remove  = adxl34x_spi_remove,\n};\n\nmodule_spi_driver(adxl34x_driver);\n\nMODULE_AUTHOR(\"Michael Hennerich <hennerich@blackfin.uclinux.org>\");\nMODULE_DESCRIPTION(\"ADXL345/346 Three-Axis Digital Accelerometer SPI Bus Driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}