{
  "module_name": "gov_bang_bang.c",
  "hash_id": "2c41c2f6d28924a4233acddcf0ee5f7876271ec7d1b4e62318d38c1376d8548a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/thermal/gov_bang_bang.c",
  "human_readable_source": "\n \n\n#include <linux/thermal.h>\n\n#include \"thermal_core.h\"\n\nstatic int thermal_zone_trip_update(struct thermal_zone_device *tz, int trip_id)\n{\n\tstruct thermal_trip trip;\n\tstruct thermal_instance *instance;\n\tint ret;\n\n\tret = __thermal_zone_get_trip(tz, trip_id, &trip);\n\tif (ret) {\n\t\tpr_warn_once(\"Failed to retrieve trip point %d\\n\", trip_id);\n\t\treturn ret;\n\t}\n\n\tif (!trip.hysteresis)\n\t\tdev_info_once(&tz->device,\n\t\t\t      \"Zero hysteresis value for thermal zone %s\\n\", tz->type);\n\n\tdev_dbg(&tz->device, \"Trip%d[temp=%d]:temp=%d:hyst=%d\\n\",\n\t\t\t\ttrip_id, trip.temperature, tz->temperature,\n\t\t\t\ttrip.hysteresis);\n\n\tlist_for_each_entry(instance, &tz->thermal_instances, tz_node) {\n\t\tif (instance->trip != trip_id)\n\t\t\tcontinue;\n\n\t\t \n\t\tif (instance->target == THERMAL_NO_TARGET)\n\t\t\tinstance->target = 0;\n\n\t\t \n\t\tif (instance->target != 0 && instance->target != 1) {\n\t\t\tpr_warn(\"Thermal instance %s controlled by bang-bang has unexpected state: %ld\\n\",\n\t\t\t\t\tinstance->name, instance->target);\n\t\t\tinstance->target = 1;\n\t\t}\n\n\t\t \n\t\tif (instance->target == 0 && tz->temperature >= trip.temperature)\n\t\t\tinstance->target = 1;\n\t\telse if (instance->target == 1 &&\n\t\t\t tz->temperature <= trip.temperature - trip.hysteresis)\n\t\t\tinstance->target = 0;\n\n\t\tdev_dbg(&instance->cdev->device, \"target=%d\\n\",\n\t\t\t\t\t(int)instance->target);\n\n\t\tmutex_lock(&instance->cdev->lock);\n\t\tinstance->cdev->updated = false;  \n\t\tmutex_unlock(&instance->cdev->lock);\n\t}\n\n\treturn 0;\n}\n\n \nstatic int bang_bang_control(struct thermal_zone_device *tz, int trip)\n{\n\tstruct thermal_instance *instance;\n\tint ret;\n\n\tlockdep_assert_held(&tz->lock);\n\n\tret = thermal_zone_trip_update(tz, trip);\n\tif (ret)\n\t\treturn ret;\n\n\tlist_for_each_entry(instance, &tz->thermal_instances, tz_node)\n\t\tthermal_cdev_update(instance->cdev);\n\n\treturn 0;\n}\n\nstatic struct thermal_governor thermal_gov_bang_bang = {\n\t.name\t\t= \"bang_bang\",\n\t.throttle\t= bang_bang_control,\n};\nTHERMAL_GOVERNOR_DECLARE(thermal_gov_bang_bang);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}