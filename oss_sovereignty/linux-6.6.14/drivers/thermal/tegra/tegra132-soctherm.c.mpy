{
  "module_name": "tegra132-soctherm.c",
  "hash_id": "5df88d0ac2b8a07b6c314a6f313826a42e24f6d10926f23ff5c6ba7ac90898a2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/thermal/tegra/tegra132-soctherm.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <dt-bindings/thermal/tegra124-soctherm.h>\n\n#include \"soctherm.h\"\n\n#define TEGRA132_THERMTRIP_ANY_EN_MASK\t\t(0x1 << 28)\n#define TEGRA132_THERMTRIP_MEM_EN_MASK\t\t(0x1 << 27)\n#define TEGRA132_THERMTRIP_GPU_EN_MASK\t\t(0x1 << 26)\n#define TEGRA132_THERMTRIP_CPU_EN_MASK\t\t(0x1 << 25)\n#define TEGRA132_THERMTRIP_TSENSE_EN_MASK\t(0x1 << 24)\n#define TEGRA132_THERMTRIP_GPUMEM_THRESH_MASK\t(0xff << 16)\n#define TEGRA132_THERMTRIP_CPU_THRESH_MASK\t(0xff << 8)\n#define TEGRA132_THERMTRIP_TSENSE_THRESH_MASK\t0xff\n\n#define TEGRA132_THERMCTL_LVL0_UP_THRESH_MASK\t(0xff << 17)\n#define TEGRA132_THERMCTL_LVL0_DN_THRESH_MASK\t(0xff << 9)\n\n#define TEGRA132_THRESH_GRAIN\t\t\t1000\n#define TEGRA132_BPTT\t\t\t\t8\n\nstatic const struct tegra_tsensor_configuration tegra132_tsensor_config = {\n\t.tall = 16300,\n\t.tiddq_en = 1,\n\t.ten_count = 1,\n\t.tsample = 120,\n\t.tsample_ate = 480,\n};\n\nstatic const struct tegra_tsensor_group tegra132_tsensor_group_cpu = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_CPU,\n\t.name = \"cpu\",\n\t.sensor_temp_offset = SENSOR_TEMP1,\n\t.sensor_temp_mask = SENSOR_TEMP1_CPU_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_CPU_MASK,\n\t.pllx_hotspot_diff = 10,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_CPU_MASK,\n\t.thermtrip_any_en_mask = TEGRA132_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA132_THERMTRIP_CPU_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA132_THERMTRIP_CPU_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_CPU_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_CPU,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA132_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA132_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra132_tsensor_group_gpu = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_GPU,\n\t.name = \"gpu\",\n\t.sensor_temp_offset = SENSOR_TEMP1,\n\t.sensor_temp_mask = SENSOR_TEMP1_GPU_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_GPU_MASK,\n\t.pllx_hotspot_diff = 5,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_GPU_MASK,\n\t.thermtrip_any_en_mask = TEGRA132_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA132_THERMTRIP_GPU_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA132_THERMTRIP_GPUMEM_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_GPU_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_GPU,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA132_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA132_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra132_tsensor_group_pll = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_PLLX,\n\t.name = \"pll\",\n\t.sensor_temp_offset = SENSOR_TEMP2,\n\t.sensor_temp_mask = SENSOR_TEMP2_PLLX_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_PLLX_MASK,\n\t.thermtrip_any_en_mask = TEGRA132_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA132_THERMTRIP_TSENSE_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA132_THERMTRIP_TSENSE_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_TSENSE_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_TSENSE,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA132_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA132_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra132_tsensor_group_mem = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_MEM,\n\t.name = \"mem\",\n\t.sensor_temp_offset = SENSOR_TEMP2,\n\t.sensor_temp_mask = SENSOR_TEMP2_MEM_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_MEM_MASK,\n\t.pllx_hotspot_diff = 0,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_MEM_MASK,\n\t.thermtrip_any_en_mask = TEGRA132_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA132_THERMTRIP_MEM_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA132_THERMTRIP_GPUMEM_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_MEM_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_MEM,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA132_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA132_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group *tegra132_tsensor_groups[] = {\n\t&tegra132_tsensor_group_cpu,\n\t&tegra132_tsensor_group_gpu,\n\t&tegra132_tsensor_group_pll,\n\t&tegra132_tsensor_group_mem,\n};\n\nstatic struct tegra_tsensor tegra132_tsensors[] = {\n\t{\n\t\t.name = \"cpu0\",\n\t\t.base = 0xc0,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x098,\n\t\t.fuse_corr_alpha = 1126600,\n\t\t.fuse_corr_beta = -9433500,\n\t\t.group = &tegra132_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu1\",\n\t\t.base = 0xe0,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x084,\n\t\t.fuse_corr_alpha = 1110800,\n\t\t.fuse_corr_beta = -7383000,\n\t\t.group = &tegra132_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu2\",\n\t\t.base = 0x100,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x088,\n\t\t.fuse_corr_alpha = 1113800,\n\t\t.fuse_corr_beta = -6215200,\n\t\t.group = &tegra132_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu3\",\n\t\t.base = 0x120,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x12c,\n\t\t.fuse_corr_alpha = 1129600,\n\t\t.fuse_corr_beta = -8196100,\n\t\t.group = &tegra132_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"mem0\",\n\t\t.base = 0x140,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x158,\n\t\t.fuse_corr_alpha = 1132900,\n\t\t.fuse_corr_beta = -6755300,\n\t\t.group = &tegra132_tsensor_group_mem,\n\t}, {\n\t\t.name = \"mem1\",\n\t\t.base = 0x160,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x15c,\n\t\t.fuse_corr_alpha = 1142300,\n\t\t.fuse_corr_beta = -7374200,\n\t\t.group = &tegra132_tsensor_group_mem,\n\t}, {\n\t\t.name = \"gpu\",\n\t\t.base = 0x180,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x154,\n\t\t.fuse_corr_alpha = 1125100,\n\t\t.fuse_corr_beta = -6350400,\n\t\t.group = &tegra132_tsensor_group_gpu,\n\t}, {\n\t\t.name = \"pllx\",\n\t\t.base = 0x1a0,\n\t\t.config = &tegra132_tsensor_config,\n\t\t.calib_fuse_offset = 0x160,\n\t\t.fuse_corr_alpha = 1118100,\n\t\t.fuse_corr_beta = -8208800,\n\t\t.group = &tegra132_tsensor_group_pll,\n\t},\n};\n\n \nstatic const struct tegra_soctherm_fuse tegra132_soctherm_fuse = {\n\t.fuse_base_cp_mask = 0x3ff,\n\t.fuse_base_cp_shift = 0,\n\t.fuse_base_ft_mask = 0x7ff << 10,\n\t.fuse_base_ft_shift = 10,\n\t.fuse_shift_ft_mask = 0x1f << 21,\n\t.fuse_shift_ft_shift = 21,\n\t.fuse_spare_realignment = 0x1fc,\n};\n\nconst struct tegra_soctherm_soc tegra132_soctherm = {\n\t.tsensors = tegra132_tsensors,\n\t.num_tsensors = ARRAY_SIZE(tegra132_tsensors),\n\t.ttgs = tegra132_tsensor_groups,\n\t.num_ttgs = ARRAY_SIZE(tegra132_tsensor_groups),\n\t.tfuse = &tegra132_soctherm_fuse,\n\t.thresh_grain = TEGRA132_THRESH_GRAIN,\n\t.bptt = TEGRA132_BPTT,\n\t.use_ccroc = true,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}