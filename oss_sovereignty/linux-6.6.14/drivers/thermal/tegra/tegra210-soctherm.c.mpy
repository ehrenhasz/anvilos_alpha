{
  "module_name": "tegra210-soctherm.c",
  "hash_id": "1a0fd156d333362b90cf95e7f9916f3a3a29469e9831d594f6428860da58ef7b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/thermal/tegra/tegra210-soctherm.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <soc/tegra/fuse.h>\n\n#include <dt-bindings/thermal/tegra124-soctherm.h>\n\n#include \"soctherm.h\"\n\n#define TEGRA210_THERMTRIP_ANY_EN_MASK\t\t(0x1 << 31)\n#define TEGRA210_THERMTRIP_MEM_EN_MASK\t\t(0x1 << 30)\n#define TEGRA210_THERMTRIP_GPU_EN_MASK\t\t(0x1 << 29)\n#define TEGRA210_THERMTRIP_CPU_EN_MASK\t\t(0x1 << 28)\n#define TEGRA210_THERMTRIP_TSENSE_EN_MASK\t(0x1 << 27)\n#define TEGRA210_THERMTRIP_GPUMEM_THRESH_MASK\t(0x1ff << 18)\n#define TEGRA210_THERMTRIP_CPU_THRESH_MASK\t(0x1ff << 9)\n#define TEGRA210_THERMTRIP_TSENSE_THRESH_MASK\t0x1ff\n\n#define TEGRA210_THERMCTL_LVL0_UP_THRESH_MASK\t(0x1ff << 18)\n#define TEGRA210_THERMCTL_LVL0_DN_THRESH_MASK\t(0x1ff << 9)\n\n#define TEGRA210_THRESH_GRAIN\t\t\t500\n#define TEGRA210_BPTT\t\t\t\t9\n\nstatic const struct tegra_tsensor_configuration tegra210_tsensor_config = {\n\t.tall = 16300,\n\t.tiddq_en = 1,\n\t.ten_count = 1,\n\t.tsample = 120,\n\t.tsample_ate = 480,\n};\n\nstatic const struct tegra_tsensor_group tegra210_tsensor_group_cpu = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_CPU,\n\t.name = \"cpu\",\n\t.sensor_temp_offset = SENSOR_TEMP1,\n\t.sensor_temp_mask = SENSOR_TEMP1_CPU_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_CPU_MASK,\n\t.pllx_hotspot_diff = 10,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_CPU_MASK,\n\t.thermtrip_any_en_mask = TEGRA210_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA210_THERMTRIP_CPU_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA210_THERMTRIP_CPU_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_CPU_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_CPU,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA210_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA210_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra210_tsensor_group_gpu = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_GPU,\n\t.name = \"gpu\",\n\t.sensor_temp_offset = SENSOR_TEMP1,\n\t.sensor_temp_mask = SENSOR_TEMP1_GPU_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_GPU_MASK,\n\t.pllx_hotspot_diff = 5,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_GPU_MASK,\n\t.thermtrip_any_en_mask = TEGRA210_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA210_THERMTRIP_GPU_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA210_THERMTRIP_GPUMEM_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_GPU_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_GPU,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA210_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA210_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra210_tsensor_group_pll = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_PLLX,\n\t.name = \"pll\",\n\t.sensor_temp_offset = SENSOR_TEMP2,\n\t.sensor_temp_mask = SENSOR_TEMP2_PLLX_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_PLLX_MASK,\n\t.thermtrip_any_en_mask = TEGRA210_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA210_THERMTRIP_TSENSE_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA210_THERMTRIP_TSENSE_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_TSENSE_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_TSENSE,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA210_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA210_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra210_tsensor_group_mem = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_MEM,\n\t.name = \"mem\",\n\t.sensor_temp_offset = SENSOR_TEMP2,\n\t.sensor_temp_mask = SENSOR_TEMP2_MEM_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_MEM_MASK,\n\t.pllx_hotspot_diff = 0,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_MEM_MASK,\n\t.thermtrip_any_en_mask = TEGRA210_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA210_THERMTRIP_MEM_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA210_THERMTRIP_GPUMEM_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_MEM_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_MEM,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA210_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA210_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group *tegra210_tsensor_groups[] = {\n\t&tegra210_tsensor_group_cpu,\n\t&tegra210_tsensor_group_gpu,\n\t&tegra210_tsensor_group_pll,\n\t&tegra210_tsensor_group_mem,\n};\n\nstatic const struct tegra_tsensor tegra210_tsensors[] = {\n\t{\n\t\t.name = \"cpu0\",\n\t\t.base = 0xc0,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x098,\n\t\t.fuse_corr_alpha = 1085000,\n\t\t.fuse_corr_beta = 3244200,\n\t\t.group = &tegra210_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu1\",\n\t\t.base = 0xe0,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x084,\n\t\t.fuse_corr_alpha = 1126200,\n\t\t.fuse_corr_beta = -67500,\n\t\t.group = &tegra210_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu2\",\n\t\t.base = 0x100,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x088,\n\t\t.fuse_corr_alpha = 1098400,\n\t\t.fuse_corr_beta = 2251100,\n\t\t.group = &tegra210_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu3\",\n\t\t.base = 0x120,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x12c,\n\t\t.fuse_corr_alpha = 1108000,\n\t\t.fuse_corr_beta = 602700,\n\t\t.group = &tegra210_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"mem0\",\n\t\t.base = 0x140,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x158,\n\t\t.fuse_corr_alpha = 1069200,\n\t\t.fuse_corr_beta = 3549900,\n\t\t.group = &tegra210_tsensor_group_mem,\n\t}, {\n\t\t.name = \"mem1\",\n\t\t.base = 0x160,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x15c,\n\t\t.fuse_corr_alpha = 1173700,\n\t\t.fuse_corr_beta = -6263600,\n\t\t.group = &tegra210_tsensor_group_mem,\n\t}, {\n\t\t.name = \"gpu\",\n\t\t.base = 0x180,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x154,\n\t\t.fuse_corr_alpha = 1074300,\n\t\t.fuse_corr_beta = 2734900,\n\t\t.group = &tegra210_tsensor_group_gpu,\n\t}, {\n\t\t.name = \"pllx\",\n\t\t.base = 0x1a0,\n\t\t.config = &tegra210_tsensor_config,\n\t\t.calib_fuse_offset = 0x160,\n\t\t.fuse_corr_alpha = 1039700,\n\t\t.fuse_corr_beta = 6829100,\n\t\t.group = &tegra210_tsensor_group_pll,\n\t},\n};\n\n \nstatic const struct tegra_soctherm_fuse tegra210_soctherm_fuse = {\n\t.fuse_base_cp_mask = 0x3ff << 11,\n\t.fuse_base_cp_shift = 11,\n\t.fuse_base_ft_mask = 0x7ff << 21,\n\t.fuse_base_ft_shift = 21,\n\t.fuse_shift_ft_mask = 0x1f << 6,\n\t.fuse_shift_ft_shift = 6,\n\t.fuse_spare_realignment = 0,\n};\n\nstatic struct tsensor_group_thermtrips tegra210_tsensor_thermtrips[] = {\n\t{.id = TEGRA124_SOCTHERM_SENSOR_NUM},\n\t{.id = TEGRA124_SOCTHERM_SENSOR_NUM},\n\t{.id = TEGRA124_SOCTHERM_SENSOR_NUM},\n\t{.id = TEGRA124_SOCTHERM_SENSOR_NUM},\n};\n\nconst struct tegra_soctherm_soc tegra210_soctherm = {\n\t.tsensors = tegra210_tsensors,\n\t.num_tsensors = ARRAY_SIZE(tegra210_tsensors),\n\t.ttgs = tegra210_tsensor_groups,\n\t.num_ttgs = ARRAY_SIZE(tegra210_tsensor_groups),\n\t.tfuse = &tegra210_soctherm_fuse,\n\t.thresh_grain = TEGRA210_THRESH_GRAIN,\n\t.bptt = TEGRA210_BPTT,\n\t.use_ccroc = false,\n\t.thermtrips = tegra210_tsensor_thermtrips,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}