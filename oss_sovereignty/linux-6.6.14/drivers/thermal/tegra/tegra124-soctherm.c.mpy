{
  "module_name": "tegra124-soctherm.c",
  "hash_id": "024b80d58c7b695bd37ece0cb8459df478854158aee10ccc7e163cb13ed82cd2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/thermal/tegra/tegra124-soctherm.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <dt-bindings/thermal/tegra124-soctherm.h>\n\n#include \"soctherm.h\"\n\n#define TEGRA124_THERMTRIP_ANY_EN_MASK\t\t(0x1 << 28)\n#define TEGRA124_THERMTRIP_MEM_EN_MASK\t\t(0x1 << 27)\n#define TEGRA124_THERMTRIP_GPU_EN_MASK\t\t(0x1 << 26)\n#define TEGRA124_THERMTRIP_CPU_EN_MASK\t\t(0x1 << 25)\n#define TEGRA124_THERMTRIP_TSENSE_EN_MASK\t(0x1 << 24)\n#define TEGRA124_THERMTRIP_GPUMEM_THRESH_MASK\t(0xff << 16)\n#define TEGRA124_THERMTRIP_CPU_THRESH_MASK\t(0xff << 8)\n#define TEGRA124_THERMTRIP_TSENSE_THRESH_MASK\t0xff\n\n#define TEGRA124_THERMCTL_LVL0_UP_THRESH_MASK\t(0xff << 17)\n#define TEGRA124_THERMCTL_LVL0_DN_THRESH_MASK\t(0xff << 9)\n\n#define TEGRA124_THRESH_GRAIN\t\t\t1000\n#define TEGRA124_BPTT\t\t\t\t8\n\nstatic const struct tegra_tsensor_configuration tegra124_tsensor_config = {\n\t.tall = 16300,\n\t.tiddq_en = 1,\n\t.ten_count = 1,\n\t.tsample = 120,\n\t.tsample_ate = 480,\n};\n\nstatic const struct tegra_tsensor_group tegra124_tsensor_group_cpu = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_CPU,\n\t.name\t= \"cpu\",\n\t.sensor_temp_offset\t= SENSOR_TEMP1,\n\t.sensor_temp_mask\t= SENSOR_TEMP1_CPU_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_CPU_MASK,\n\t.pllx_hotspot_diff = 10,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_CPU_MASK,\n\t.thermtrip_any_en_mask = TEGRA124_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA124_THERMTRIP_CPU_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA124_THERMTRIP_CPU_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_CPU_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_CPU,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA124_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA124_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra124_tsensor_group_gpu = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_GPU,\n\t.name = \"gpu\",\n\t.sensor_temp_offset = SENSOR_TEMP1,\n\t.sensor_temp_mask = SENSOR_TEMP1_GPU_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_GPU_MASK,\n\t.pllx_hotspot_diff = 5,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_GPU_MASK,\n\t.thermtrip_any_en_mask = TEGRA124_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA124_THERMTRIP_GPU_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA124_THERMTRIP_GPUMEM_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_GPU_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_GPU,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA124_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA124_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra124_tsensor_group_pll = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_PLLX,\n\t.name = \"pll\",\n\t.sensor_temp_offset = SENSOR_TEMP2,\n\t.sensor_temp_mask = SENSOR_TEMP2_PLLX_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_PLLX_MASK,\n\t.thermtrip_any_en_mask = TEGRA124_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA124_THERMTRIP_TSENSE_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA124_THERMTRIP_TSENSE_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_TSENSE_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_TSENSE,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA124_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA124_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group tegra124_tsensor_group_mem = {\n\t.id = TEGRA124_SOCTHERM_SENSOR_MEM,\n\t.name = \"mem\",\n\t.sensor_temp_offset = SENSOR_TEMP2,\n\t.sensor_temp_mask = SENSOR_TEMP2_MEM_TEMP_MASK,\n\t.pdiv = 8,\n\t.pdiv_ate = 8,\n\t.pdiv_mask = SENSOR_PDIV_MEM_MASK,\n\t.pllx_hotspot_diff = 0,\n\t.pllx_hotspot_mask = SENSOR_HOTSPOT_MEM_MASK,\n\t.thermtrip_any_en_mask = TEGRA124_THERMTRIP_ANY_EN_MASK,\n\t.thermtrip_enable_mask = TEGRA124_THERMTRIP_MEM_EN_MASK,\n\t.thermtrip_threshold_mask = TEGRA124_THERMTRIP_GPUMEM_THRESH_MASK,\n\t.thermctl_isr_mask = THERM_IRQ_MEM_MASK,\n\t.thermctl_lvl0_offset = THERMCTL_LEVEL0_GROUP_MEM,\n\t.thermctl_lvl0_up_thresh_mask = TEGRA124_THERMCTL_LVL0_UP_THRESH_MASK,\n\t.thermctl_lvl0_dn_thresh_mask = TEGRA124_THERMCTL_LVL0_DN_THRESH_MASK,\n};\n\nstatic const struct tegra_tsensor_group *tegra124_tsensor_groups[] = {\n\t&tegra124_tsensor_group_cpu,\n\t&tegra124_tsensor_group_gpu,\n\t&tegra124_tsensor_group_pll,\n\t&tegra124_tsensor_group_mem,\n};\n\nstatic const struct tegra_tsensor tegra124_tsensors[] = {\n\t{\n\t\t.name = \"cpu0\",\n\t\t.base = 0xc0,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x098,\n\t\t.fuse_corr_alpha = 1135400,\n\t\t.fuse_corr_beta = -6266900,\n\t\t.group = &tegra124_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu1\",\n\t\t.base = 0xe0,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x084,\n\t\t.fuse_corr_alpha = 1122220,\n\t\t.fuse_corr_beta = -5700700,\n\t\t.group = &tegra124_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu2\",\n\t\t.base = 0x100,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x088,\n\t\t.fuse_corr_alpha = 1127000,\n\t\t.fuse_corr_beta = -6768200,\n\t\t.group = &tegra124_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"cpu3\",\n\t\t.base = 0x120,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x12c,\n\t\t.fuse_corr_alpha = 1110900,\n\t\t.fuse_corr_beta = -6232000,\n\t\t.group = &tegra124_tsensor_group_cpu,\n\t}, {\n\t\t.name = \"mem0\",\n\t\t.base = 0x140,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x158,\n\t\t.fuse_corr_alpha = 1122300,\n\t\t.fuse_corr_beta = -5936400,\n\t\t.group = &tegra124_tsensor_group_mem,\n\t}, {\n\t\t.name = \"mem1\",\n\t\t.base = 0x160,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x15c,\n\t\t.fuse_corr_alpha = 1145700,\n\t\t.fuse_corr_beta = -7124600,\n\t\t.group = &tegra124_tsensor_group_mem,\n\t}, {\n\t\t.name = \"gpu\",\n\t\t.base = 0x180,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x154,\n\t\t.fuse_corr_alpha = 1120100,\n\t\t.fuse_corr_beta = -6000500,\n\t\t.group = &tegra124_tsensor_group_gpu,\n\t}, {\n\t\t.name = \"pllx\",\n\t\t.base = 0x1a0,\n\t\t.config = &tegra124_tsensor_config,\n\t\t.calib_fuse_offset = 0x160,\n\t\t.fuse_corr_alpha = 1106500,\n\t\t.fuse_corr_beta = -6729300,\n\t\t.group = &tegra124_tsensor_group_pll,\n\t},\n};\n\n \nstatic const struct tegra_soctherm_fuse tegra124_soctherm_fuse = {\n\t.fuse_base_cp_mask = 0x3ff,\n\t.fuse_base_cp_shift = 0,\n\t.fuse_base_ft_mask = 0x7ff << 10,\n\t.fuse_base_ft_shift = 10,\n\t.fuse_shift_ft_mask = 0x1f << 21,\n\t.fuse_shift_ft_shift = 21,\n\t.fuse_spare_realignment = 0x1fc,\n};\n\nconst struct tegra_soctherm_soc tegra124_soctherm = {\n\t.tsensors = tegra124_tsensors,\n\t.num_tsensors = ARRAY_SIZE(tegra124_tsensors),\n\t.ttgs = tegra124_tsensor_groups,\n\t.num_ttgs = ARRAY_SIZE(tegra124_tsensor_groups),\n\t.tfuse = &tegra124_soctherm_fuse,\n\t.thresh_grain = TEGRA124_THRESH_GRAIN,\n\t.bptt = TEGRA124_BPTT,\n\t.use_ccroc = false,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}