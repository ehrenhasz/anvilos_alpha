{
  "module_name": "int3402_thermal.c",
  "hash_id": "997a5d186d1cf90694fa0efcbb07424753d3bf632c6d68d3b9c8f6441af4bbe1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/thermal/intel/int340x_thermal/int3402_thermal.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/acpi.h>\n#include <linux/thermal.h>\n#include \"int340x_thermal_zone.h\"\n\n#define INT3402_PERF_CHANGED_EVENT\t0x80\n#define INT3402_THERMAL_EVENT\t\t0x90\n\nstruct int3402_thermal_data {\n\tacpi_handle *handle;\n\tstruct int34x_thermal_zone *int340x_zone;\n};\n\nstatic void int3402_notify(acpi_handle handle, u32 event, void *data)\n{\n\tstruct int3402_thermal_data *priv = data;\n\n\tif (!priv)\n\t\treturn;\n\n\tswitch (event) {\n\tcase INT3402_PERF_CHANGED_EVENT:\n\t\tbreak;\n\tcase INT3402_THERMAL_EVENT:\n\t\tint340x_thermal_zone_device_update(priv->int340x_zone,\n\t\t\t\t\t\t   THERMAL_TRIP_VIOLATED);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic int int3402_thermal_probe(struct platform_device *pdev)\n{\n\tstruct acpi_device *adev = ACPI_COMPANION(&pdev->dev);\n\tstruct int3402_thermal_data *d;\n\tint ret;\n\n\tif (!acpi_has_method(adev->handle, \"_TMP\"))\n\t\treturn -ENODEV;\n\n\td = devm_kzalloc(&pdev->dev, sizeof(*d), GFP_KERNEL);\n\tif (!d)\n\t\treturn -ENOMEM;\n\n\td->int340x_zone = int340x_thermal_zone_add(adev, NULL);\n\tif (IS_ERR(d->int340x_zone))\n\t\treturn PTR_ERR(d->int340x_zone);\n\n\tret = acpi_install_notify_handler(adev->handle,\n\t\t\t\t\t  ACPI_DEVICE_NOTIFY,\n\t\t\t\t\t  int3402_notify,\n\t\t\t\t\t  d);\n\tif (ret) {\n\t\tint340x_thermal_zone_remove(d->int340x_zone);\n\t\treturn ret;\n\t}\n\n\td->handle = adev->handle;\n\tplatform_set_drvdata(pdev, d);\n\n\treturn 0;\n}\n\nstatic int int3402_thermal_remove(struct platform_device *pdev)\n{\n\tstruct int3402_thermal_data *d = platform_get_drvdata(pdev);\n\n\tacpi_remove_notify_handler(d->handle,\n\t\t\t\t   ACPI_DEVICE_NOTIFY, int3402_notify);\n\tint340x_thermal_zone_remove(d->int340x_zone);\n\n\treturn 0;\n}\n\nstatic const struct acpi_device_id int3402_thermal_match[] = {\n\t{\"INT3402\", 0},\n\t{}\n};\n\nMODULE_DEVICE_TABLE(acpi, int3402_thermal_match);\n\nstatic struct platform_driver int3402_thermal_driver = {\n\t.probe = int3402_thermal_probe,\n\t.remove = int3402_thermal_remove,\n\t.driver = {\n\t\t   .name = \"int3402 thermal\",\n\t\t   .acpi_match_table = int3402_thermal_match,\n\t\t   },\n};\n\nmodule_platform_driver(int3402_thermal_driver);\n\nMODULE_DESCRIPTION(\"INT3402 Thermal driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}