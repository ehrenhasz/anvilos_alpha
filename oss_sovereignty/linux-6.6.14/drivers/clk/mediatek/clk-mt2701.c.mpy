{
  "module_name": "clk-mt2701.c",
  "hash_id": "2243c0eda366d48f0930b6b9097f1dc6053e89cccce85e0020ff21c9b489948b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mediatek/clk-mt2701.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n\n#include \"clk-cpumux.h\"\n#include \"clk-gate.h\"\n#include \"clk-mtk.h\"\n#include \"clk-pll.h\"\n\n#include <dt-bindings/clock/mt2701-clk.h>\n\n \n#define DUMMY_RATE\t\t0\n\nstatic DEFINE_SPINLOCK(mt2701_clk_lock);\n\nstatic const struct mtk_fixed_clk top_fixed_clks[] = {\n\tFIXED_CLK(CLK_TOP_DPI, \"dpi_ck\", \"clk26m\",\n\t\t108 * MHZ),\n\tFIXED_CLK(CLK_TOP_DMPLL, \"dmpll_ck\", \"clk26m\",\n\t\t400 * MHZ),\n\tFIXED_CLK(CLK_TOP_VENCPLL, \"vencpll_ck\", \"clk26m\",\n\t\t295750000),\n\tFIXED_CLK(CLK_TOP_HDMI_0_PIX340M, \"hdmi_0_pix340m\", \"clk26m\",\n\t\t340 * MHZ),\n\tFIXED_CLK(CLK_TOP_HDMI_0_DEEP340M, \"hdmi_0_deep340m\", \"clk26m\",\n\t\t340 * MHZ),\n\tFIXED_CLK(CLK_TOP_HDMI_0_PLL340M, \"hdmi_0_pll340m\", \"clk26m\",\n\t\t340 * MHZ),\n\tFIXED_CLK(CLK_TOP_HADDS2_FB, \"hadds2_fbclk\", \"clk26m\",\n\t\t27 * MHZ),\n\tFIXED_CLK(CLK_TOP_WBG_DIG_416M, \"wbg_dig_ck_416m\", \"clk26m\",\n\t\t416 * MHZ),\n\tFIXED_CLK(CLK_TOP_DSI0_LNTC_DSI, \"dsi0_lntc_dsi\", \"clk26m\",\n\t\t143 * MHZ),\n\tFIXED_CLK(CLK_TOP_HDMI_SCL_RX, \"hdmi_scl_rx\", \"clk26m\",\n\t\t27 * MHZ),\n\tFIXED_CLK(CLK_TOP_AUD_EXT1, \"aud_ext1\", \"clk26m\",\n\t\tDUMMY_RATE),\n\tFIXED_CLK(CLK_TOP_AUD_EXT2, \"aud_ext2\", \"clk26m\",\n\t\tDUMMY_RATE),\n\tFIXED_CLK(CLK_TOP_NFI1X_PAD, \"nfi1x_pad\", \"clk26m\",\n\t\tDUMMY_RATE),\n};\n\nstatic const struct mtk_fixed_factor top_fixed_divs[] = {\n\tFACTOR(CLK_TOP_SYSPLL, \"syspll_ck\", \"mainpll\", 1, 1),\n\tFACTOR(CLK_TOP_SYSPLL_D2, \"syspll_d2\", \"mainpll\", 1, 2),\n\tFACTOR(CLK_TOP_SYSPLL_D3, \"syspll_d3\", \"mainpll\", 1, 3),\n\tFACTOR(CLK_TOP_SYSPLL_D5, \"syspll_d5\", \"mainpll\", 1, 5),\n\tFACTOR(CLK_TOP_SYSPLL_D7, \"syspll_d7\", \"mainpll\", 1, 7),\n\tFACTOR(CLK_TOP_SYSPLL1_D2, \"syspll1_d2\", \"syspll_d2\", 1, 2),\n\tFACTOR(CLK_TOP_SYSPLL1_D4, \"syspll1_d4\", \"syspll_d2\", 1, 4),\n\tFACTOR(CLK_TOP_SYSPLL1_D8, \"syspll1_d8\", \"syspll_d2\", 1, 8),\n\tFACTOR(CLK_TOP_SYSPLL1_D16, \"syspll1_d16\", \"syspll_d2\", 1, 16),\n\tFACTOR(CLK_TOP_SYSPLL2_D2, \"syspll2_d2\", \"syspll_d3\", 1, 2),\n\tFACTOR(CLK_TOP_SYSPLL2_D4, \"syspll2_d4\", \"syspll_d3\", 1, 4),\n\tFACTOR(CLK_TOP_SYSPLL2_D8, \"syspll2_d8\", \"syspll_d3\", 1, 8),\n\tFACTOR(CLK_TOP_SYSPLL3_D2, \"syspll3_d2\", \"syspll_d5\", 1, 2),\n\tFACTOR(CLK_TOP_SYSPLL3_D4, \"syspll3_d4\", \"syspll_d5\", 1, 4),\n\tFACTOR(CLK_TOP_SYSPLL4_D2, \"syspll4_d2\", \"syspll_d7\", 1, 2),\n\tFACTOR(CLK_TOP_SYSPLL4_D4, \"syspll4_d4\", \"syspll_d7\", 1, 4),\n\n\tFACTOR(CLK_TOP_UNIVPLL, \"univpll_ck\", \"univpll\", 1, 1),\n\tFACTOR(CLK_TOP_UNIVPLL_D2, \"univpll_d2\", \"univpll\", 1, 2),\n\tFACTOR(CLK_TOP_UNIVPLL_D3, \"univpll_d3\", \"univpll\", 1, 3),\n\tFACTOR(CLK_TOP_UNIVPLL_D5, \"univpll_d5\", \"univpll\", 1, 5),\n\tFACTOR(CLK_TOP_UNIVPLL_D7, \"univpll_d7\", \"univpll\", 1, 7),\n\tFACTOR(CLK_TOP_UNIVPLL_D26, \"univpll_d26\", \"univpll\", 1, 26),\n\tFACTOR(CLK_TOP_UNIVPLL_D52, \"univpll_d52\", \"univpll\", 1, 52),\n\tFACTOR(CLK_TOP_UNIVPLL_D108, \"univpll_d108\", \"univpll\", 1, 108),\n\tFACTOR(CLK_TOP_USB_PHY48M, \"usb_phy48m_ck\", \"univpll\", 1, 26),\n\tFACTOR(CLK_TOP_UNIVPLL1_D2, \"univpll1_d2\", \"univpll_d2\", 1, 2),\n\tFACTOR(CLK_TOP_UNIVPLL1_D4, \"univpll1_d4\", \"univpll_d2\", 1, 4),\n\tFACTOR(CLK_TOP_UNIVPLL1_D8, \"univpll1_d8\", \"univpll_d2\", 1, 8),\n\tFACTOR(CLK_TOP_8BDAC, \"8bdac_ck\", \"univpll_d2\", 1, 1),\n\tFACTOR(CLK_TOP_UNIVPLL2_D2, \"univpll2_d2\", \"univpll_d3\", 1, 2),\n\tFACTOR(CLK_TOP_UNIVPLL2_D4, \"univpll2_d4\", \"univpll_d3\", 1, 4),\n\tFACTOR(CLK_TOP_UNIVPLL2_D8, \"univpll2_d8\", \"univpll_d3\", 1, 8),\n\tFACTOR(CLK_TOP_UNIVPLL2_D16, \"univpll2_d16\", \"univpll_d3\", 1, 16),\n\tFACTOR(CLK_TOP_UNIVPLL2_D32, \"univpll2_d32\", \"univpll_d3\", 1, 32),\n\tFACTOR(CLK_TOP_UNIVPLL3_D2, \"univpll3_d2\", \"univpll_d5\", 1, 2),\n\tFACTOR(CLK_TOP_UNIVPLL3_D4, \"univpll3_d4\", \"univpll_d5\", 1, 4),\n\tFACTOR(CLK_TOP_UNIVPLL3_D8, \"univpll3_d8\", \"univpll_d5\", 1, 8),\n\n\tFACTOR(CLK_TOP_MSDCPLL, \"msdcpll_ck\", \"msdcpll\", 1, 1),\n\tFACTOR(CLK_TOP_MSDCPLL_D2, \"msdcpll_d2\", \"msdcpll\", 1, 2),\n\tFACTOR(CLK_TOP_MSDCPLL_D4, \"msdcpll_d4\", \"msdcpll\", 1, 4),\n\tFACTOR(CLK_TOP_MSDCPLL_D8, \"msdcpll_d8\", \"msdcpll\", 1, 8),\n\n\tFACTOR(CLK_TOP_MMPLL, \"mmpll_ck\", \"mmpll\", 1, 1),\n\tFACTOR(CLK_TOP_MMPLL_D2, \"mmpll_d2\", \"mmpll\", 1, 2),\n\n\tFACTOR(CLK_TOP_DMPLL_D2, \"dmpll_d2\", \"dmpll_ck\", 1, 2),\n\tFACTOR(CLK_TOP_DMPLL_D4, \"dmpll_d4\", \"dmpll_ck\", 1, 4),\n\tFACTOR(CLK_TOP_DMPLL_X2, \"dmpll_x2\", \"dmpll_ck\", 1, 1),\n\n\tFACTOR(CLK_TOP_TVDPLL, \"tvdpll_ck\", \"tvdpll\", 1, 1),\n\tFACTOR(CLK_TOP_TVDPLL_D2, \"tvdpll_d2\", \"tvdpll\", 1, 2),\n\tFACTOR(CLK_TOP_TVDPLL_D4, \"tvdpll_d4\", \"tvdpll\", 1, 4),\n\n\tFACTOR(CLK_TOP_VDECPLL, \"vdecpll_ck\", \"vdecpll\", 1, 1),\n\tFACTOR(CLK_TOP_TVD2PLL, \"tvd2pll_ck\", \"tvd2pll\", 1, 1),\n\tFACTOR(CLK_TOP_TVD2PLL_D2, \"tvd2pll_d2\", \"tvd2pll\", 1, 2),\n\n\tFACTOR(CLK_TOP_MIPIPLL, \"mipipll\", \"dpi_ck\", 1, 1),\n\tFACTOR(CLK_TOP_MIPIPLL_D2, \"mipipll_d2\", \"dpi_ck\", 1, 2),\n\tFACTOR(CLK_TOP_MIPIPLL_D4, \"mipipll_d4\", \"dpi_ck\", 1, 4),\n\n\tFACTOR(CLK_TOP_HDMIPLL, \"hdmipll_ck\", \"hdmitx_dig_cts\", 1, 1),\n\tFACTOR(CLK_TOP_HDMIPLL_D2, \"hdmipll_d2\", \"hdmitx_dig_cts\", 1, 2),\n\tFACTOR(CLK_TOP_HDMIPLL_D3, \"hdmipll_d3\", \"hdmitx_dig_cts\", 1, 3),\n\n\tFACTOR(CLK_TOP_ARMPLL_1P3G, \"armpll_1p3g_ck\", \"armpll\", 1, 1),\n\n\tFACTOR(CLK_TOP_AUDPLL, \"audpll\", \"audpll_sel\", 1, 1),\n\tFACTOR(CLK_TOP_AUDPLL_D4, \"audpll_d4\", \"audpll_sel\", 1, 4),\n\tFACTOR(CLK_TOP_AUDPLL_D8, \"audpll_d8\", \"audpll_sel\", 1, 8),\n\tFACTOR(CLK_TOP_AUDPLL_D16, \"audpll_d16\", \"audpll_sel\", 1, 16),\n\tFACTOR(CLK_TOP_AUDPLL_D24, \"audpll_d24\", \"audpll_sel\", 1, 24),\n\n\tFACTOR(CLK_TOP_AUD1PLL_98M, \"aud1pll_98m_ck\", \"aud1pll\", 1, 3),\n\tFACTOR(CLK_TOP_AUD2PLL_90M, \"aud2pll_90m_ck\", \"aud2pll\", 1, 3),\n\tFACTOR(CLK_TOP_HADDS2PLL_98M, \"hadds2pll_98m\", \"hadds2pll\", 1, 3),\n\tFACTOR(CLK_TOP_HADDS2PLL_294M, \"hadds2pll_294m\", \"hadds2pll\", 1, 1),\n\tFACTOR(CLK_TOP_ETHPLL_500M, \"ethpll_500m_ck\", \"ethpll\", 1, 1),\n\tFACTOR(CLK_TOP_CLK26M_D8, \"clk26m_d8\", \"clk26m\", 1, 8),\n\tFACTOR(CLK_TOP_32K_INTERNAL, \"32k_internal\", \"clk26m\", 1, 793),\n\tFACTOR(CLK_TOP_32K_EXTERNAL, \"32k_external\", \"rtc32k\", 1, 1),\n\tFACTOR(CLK_TOP_AXISEL_D4, \"axisel_d4\", \"axi_sel\", 1, 4),\n};\n\nstatic const char * const axi_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d2\",\n\t\"syspll_d5\",\n\t\"syspll1_d4\",\n\t\"univpll_d5\",\n\t\"univpll2_d2\",\n\t\"mmpll_d2\",\n\t\"dmpll_d2\"\n};\n\nstatic const char * const mem_parents[] = {\n\t\"clk26m\",\n\t\"dmpll_ck\"\n};\n\nstatic const char * const ddrphycfg_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d8\"\n};\n\nstatic const char * const mm_parents[] = {\n\t\"clk26m\",\n\t\"vencpll_ck\",\n\t\"syspll1_d2\",\n\t\"syspll1_d4\",\n\t\"univpll_d5\",\n\t\"univpll1_d2\",\n\t\"univpll2_d2\",\n\t\"dmpll_ck\"\n};\n\nstatic const char * const pwm_parents[] = {\n\t\"clk26m\",\n\t\"univpll2_d4\",\n\t\"univpll3_d2\",\n\t\"univpll1_d4\",\n};\n\nstatic const char * const vdec_parents[] = {\n\t\"clk26m\",\n\t\"vdecpll_ck\",\n\t\"syspll_d5\",\n\t\"syspll1_d4\",\n\t\"univpll_d5\",\n\t\"univpll2_d2\",\n\t\"vencpll_ck\",\n\t\"msdcpll_d2\",\n\t\"mmpll_d2\"\n};\n\nstatic const char * const mfg_parents[] = {\n\t\"clk26m\",\n\t\"mmpll_ck\",\n\t\"dmpll_x2_ck\",\n\t\"msdcpll_ck\",\n\t\"clk26m\",\n\t\"syspll_d3\",\n\t\"univpll_d3\",\n\t\"univpll1_d2\"\n};\n\nstatic const char * const camtg_parents[] = {\n\t\"clk26m\",\n\t\"univpll_d26\",\n\t\"univpll2_d2\",\n\t\"syspll3_d2\",\n\t\"syspll3_d4\",\n\t\"msdcpll_d2\",\n\t\"mmpll_d2\"\n};\n\nstatic const char * const uart_parents[] = {\n\t\"clk26m\",\n\t\"univpll2_d8\"\n};\n\nstatic const char * const spi_parents[] = {\n\t\"clk26m\",\n\t\"syspll3_d2\",\n\t\"syspll4_d2\",\n\t\"univpll2_d4\",\n\t\"univpll1_d8\"\n};\n\nstatic const char * const usb20_parents[] = {\n\t\"clk26m\",\n\t\"univpll1_d8\",\n\t\"univpll3_d4\"\n};\n\nstatic const char * const msdc30_parents[] = {\n\t\"clk26m\",\n\t\"msdcpll_d2\",\n\t\"syspll2_d2\",\n\t\"syspll1_d4\",\n\t\"univpll1_d4\",\n\t\"univpll2_d4\"\n};\n\nstatic const char * const aud_intbus_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d4\",\n\t\"syspll3_d2\",\n\t\"syspll4_d2\",\n\t\"univpll3_d2\",\n\t\"univpll2_d4\"\n};\n\nstatic const char * const pmicspi_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d8\",\n\t\"syspll2_d4\",\n\t\"syspll4_d2\",\n\t\"syspll3_d4\",\n\t\"syspll2_d8\",\n\t\"syspll1_d16\",\n\t\"univpll3_d4\",\n\t\"univpll_d26\",\n\t\"dmpll_d2\",\n\t\"dmpll_d4\"\n};\n\nstatic const char * const scp_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d8\",\n\t\"dmpll_d2\",\n\t\"dmpll_d4\"\n};\n\nstatic const char * const dpi0_parents[] = {\n\t\"clk26m\",\n\t\"mipipll\",\n\t\"mipipll_d2\",\n\t\"mipipll_d4\",\n\t\"clk26m\",\n\t\"tvdpll_ck\",\n\t\"tvdpll_d2\",\n\t\"tvdpll_d4\"\n};\n\nstatic const char * const dpi1_parents[] = {\n\t\"clk26m\",\n\t\"tvdpll_ck\",\n\t\"tvdpll_d2\",\n\t\"tvdpll_d4\"\n};\n\nstatic const char * const tve_parents[] = {\n\t\"clk26m\",\n\t\"mipipll\",\n\t\"mipipll_d2\",\n\t\"mipipll_d4\",\n\t\"clk26m\",\n\t\"tvdpll_ck\",\n\t\"tvdpll_d2\",\n\t\"tvdpll_d4\"\n};\n\nstatic const char * const hdmi_parents[] = {\n\t\"clk26m\",\n\t\"hdmipll_ck\",\n\t\"hdmipll_d2\",\n\t\"hdmipll_d3\"\n};\n\nstatic const char * const apll_parents[] = {\n\t\"clk26m\",\n\t\"audpll\",\n\t\"audpll_d4\",\n\t\"audpll_d8\",\n\t\"audpll_d16\",\n\t\"audpll_d24\",\n\t\"clk26m\",\n\t\"clk26m\"\n};\n\nstatic const char * const rtc_parents[] = {\n\t\"32k_internal\",\n\t\"32k_external\",\n\t\"clk26m\",\n\t\"univpll3_d8\"\n};\n\nstatic const char * const nfi2x_parents[] = {\n\t\"clk26m\",\n\t\"syspll2_d2\",\n\t\"syspll_d7\",\n\t\"univpll3_d2\",\n\t\"syspll2_d4\",\n\t\"univpll3_d4\",\n\t\"syspll4_d4\",\n\t\"clk26m\"\n};\n\nstatic const char * const emmc_hclk_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d2\",\n\t\"syspll1_d4\",\n\t\"syspll2_d2\"\n};\n\nstatic const char * const flash_parents[] = {\n\t\"clk26m_d8\",\n\t\"clk26m\",\n\t\"syspll2_d8\",\n\t\"syspll3_d4\",\n\t\"univpll3_d4\",\n\t\"syspll4_d2\",\n\t\"syspll2_d4\",\n\t\"univpll2_d4\"\n};\n\nstatic const char * const di_parents[] = {\n\t\"clk26m\",\n\t\"tvd2pll_ck\",\n\t\"tvd2pll_d2\",\n\t\"clk26m\"\n};\n\nstatic const char * const nr_osd_parents[] = {\n\t\"clk26m\",\n\t\"vencpll_ck\",\n\t\"syspll1_d2\",\n\t\"syspll1_d4\",\n\t\"univpll_d5\",\n\t\"univpll1_d2\",\n\t\"univpll2_d2\",\n\t\"dmpll_ck\"\n};\n\nstatic const char * const hdmirx_bist_parents[] = {\n\t\"clk26m\",\n\t\"syspll_d3\",\n\t\"clk26m\",\n\t\"syspll1_d16\",\n\t\"syspll4_d2\",\n\t\"syspll1_d4\",\n\t\"vencpll_ck\",\n\t\"clk26m\"\n};\n\nstatic const char * const intdir_parents[] = {\n\t\"clk26m\",\n\t\"mmpll_ck\",\n\t\"syspll_d2\",\n\t\"univpll_d2\"\n};\n\nstatic const char * const asm_parents[] = {\n\t\"clk26m\",\n\t\"univpll2_d4\",\n\t\"univpll2_d2\",\n\t\"syspll_d5\"\n};\n\nstatic const char * const ms_card_parents[] = {\n\t\"clk26m\",\n\t\"univpll3_d8\",\n\t\"syspll4_d4\"\n};\n\nstatic const char * const ethif_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d2\",\n\t\"syspll_d5\",\n\t\"syspll1_d4\",\n\t\"univpll_d5\",\n\t\"univpll1_d2\",\n\t\"dmpll_ck\",\n\t\"dmpll_d2\"\n};\n\nstatic const char * const hdmirx_parents[] = {\n\t\"clk26m\",\n\t\"univpll_d52\"\n};\n\nstatic const char * const cmsys_parents[] = {\n\t\"clk26m\",\n\t\"syspll1_d2\",\n\t\"univpll1_d2\",\n\t\"univpll_d5\",\n\t\"syspll_d5\",\n\t\"syspll2_d2\",\n\t\"syspll1_d4\",\n\t\"syspll3_d2\",\n\t\"syspll2_d4\",\n\t\"syspll1_d8\",\n\t\"clk26m\",\n\t\"clk26m\",\n\t\"clk26m\",\n\t\"clk26m\",\n\t\"clk26m\"\n};\n\nstatic const char * const clk_8bdac_parents[] = {\n\t\"32k_internal\",\n\t\"8bdac_ck\",\n\t\"clk26m\",\n\t\"clk26m\"\n};\n\nstatic const char * const aud2dvd_parents[] = {\n\t\"a1sys_hp_ck\",\n\t\"a2sys_hp_ck\"\n};\n\nstatic const char * const padmclk_parents[] = {\n\t\"clk26m\",\n\t\"univpll_d26\",\n\t\"univpll_d52\",\n\t\"univpll_d108\",\n\t\"univpll2_d8\",\n\t\"univpll2_d16\",\n\t\"univpll2_d32\"\n};\n\nstatic const char * const aud_mux_parents[] = {\n\t\"clk26m\",\n\t\"aud1pll_98m_ck\",\n\t\"aud2pll_90m_ck\",\n\t\"hadds2pll_98m\",\n\t\"audio_ext1_ck\",\n\t\"audio_ext2_ck\"\n};\n\nstatic const char * const aud_src_parents[] = {\n\t\"aud_mux1_sel\",\n\t\"aud_mux2_sel\"\n};\n\nstatic const char * const cpu_parents[] = {\n\t\"clk26m\",\n\t\"armpll\",\n\t\"mainpll\",\n\t\"mmpll\"\n};\n\nstatic const struct mtk_composite cpu_muxes[] __initconst = {\n\tMUX(CLK_INFRA_CPUSEL, \"infra_cpu_sel\", cpu_parents, 0x0000, 2, 2),\n};\n\nstatic const struct mtk_composite top_muxes[] = {\n\tMUX_GATE_FLAGS(CLK_TOP_AXI_SEL, \"axi_sel\", axi_parents,\n\t\t0x0040, 0, 3, 7, CLK_IS_CRITICAL),\n\tMUX_GATE_FLAGS(CLK_TOP_MEM_SEL, \"mem_sel\", mem_parents,\n\t\t0x0040, 8, 1, 15, CLK_IS_CRITICAL),\n\tMUX_GATE_FLAGS(CLK_TOP_DDRPHYCFG_SEL, \"ddrphycfg_sel\",\n\t\tddrphycfg_parents, 0x0040, 16, 1, 23, CLK_IS_CRITICAL),\n\tMUX_GATE(CLK_TOP_MM_SEL, \"mm_sel\", mm_parents,\n\t\t0x0040, 24, 3, 31),\n\n\tMUX_GATE(CLK_TOP_PWM_SEL, \"pwm_sel\", pwm_parents,\n\t\t0x0050, 0, 2, 7),\n\tMUX_GATE(CLK_TOP_VDEC_SEL, \"vdec_sel\", vdec_parents,\n\t\t0x0050, 8, 4, 15),\n\tMUX_GATE(CLK_TOP_MFG_SEL, \"mfg_sel\", mfg_parents,\n\t\t0x0050, 16, 3, 23),\n\tMUX_GATE(CLK_TOP_CAMTG_SEL, \"camtg_sel\", camtg_parents,\n\t\t0x0050, 24, 3, 31),\n\tMUX_GATE(CLK_TOP_UART_SEL, \"uart_sel\", uart_parents,\n\t\t0x0060, 0, 1, 7),\n\n\tMUX_GATE(CLK_TOP_SPI0_SEL, \"spi0_sel\", spi_parents,\n\t\t0x0060, 8, 3, 15),\n\tMUX_GATE(CLK_TOP_USB20_SEL, \"usb20_sel\", usb20_parents,\n\t\t0x0060, 16, 2, 23),\n\tMUX_GATE(CLK_TOP_MSDC30_0_SEL, \"msdc30_0_sel\", msdc30_parents,\n\t\t0x0060, 24, 3, 31),\n\n\tMUX_GATE(CLK_TOP_MSDC30_1_SEL, \"msdc30_1_sel\", msdc30_parents,\n\t\t0x0070, 0, 3, 7),\n\tMUX_GATE(CLK_TOP_MSDC30_2_SEL, \"msdc30_2_sel\", msdc30_parents,\n\t\t0x0070, 8, 3, 15),\n\tMUX_GATE(CLK_TOP_AUDIO_SEL, \"audio_sel\", msdc30_parents,\n\t\t0x0070, 16, 1, 23),\n\tMUX_GATE(CLK_TOP_AUDINTBUS_SEL, \"aud_intbus_sel\", aud_intbus_parents,\n\t\t0x0070, 24, 3, 31),\n\n\tMUX_GATE(CLK_TOP_PMICSPI_SEL, \"pmicspi_sel\", pmicspi_parents,\n\t\t0x0080, 0, 4, 7),\n\tMUX_GATE(CLK_TOP_SCP_SEL, \"scp_sel\", scp_parents,\n\t\t0x0080, 8, 2, 15),\n\tMUX_GATE(CLK_TOP_DPI0_SEL, \"dpi0_sel\", dpi0_parents,\n\t\t0x0080, 16, 3, 23),\n\tMUX_GATE_FLAGS_2(CLK_TOP_DPI1_SEL, \"dpi1_sel\", dpi1_parents,\n\t\t0x0080, 24, 2, 31, 0, CLK_MUX_ROUND_CLOSEST),\n\n\tMUX_GATE(CLK_TOP_TVE_SEL, \"tve_sel\", tve_parents,\n\t\t0x0090, 0, 3, 7),\n\tMUX_GATE(CLK_TOP_HDMI_SEL, \"hdmi_sel\", hdmi_parents,\n\t\t0x0090, 8, 2, 15),\n\tMUX_GATE(CLK_TOP_APLL_SEL, \"apll_sel\", apll_parents,\n\t\t0x0090, 16, 3, 23),\n\n\tMUX_GATE_FLAGS(CLK_TOP_RTC_SEL, \"rtc_sel\", rtc_parents,\n\t\t0x00A0, 0, 2, 7, CLK_IS_CRITICAL),\n\tMUX_GATE(CLK_TOP_NFI2X_SEL, \"nfi2x_sel\", nfi2x_parents,\n\t\t0x00A0, 8, 3, 15),\n\tMUX_GATE(CLK_TOP_EMMC_HCLK_SEL, \"emmc_hclk_sel\", emmc_hclk_parents,\n\t\t0x00A0, 24, 2, 31),\n\n\tMUX_GATE(CLK_TOP_FLASH_SEL, \"flash_sel\", flash_parents,\n\t\t0x00B0, 0, 3, 7),\n\tMUX_GATE(CLK_TOP_DI_SEL, \"di_sel\", di_parents,\n\t\t0x00B0, 8, 2, 15),\n\tMUX_GATE(CLK_TOP_NR_SEL, \"nr_sel\", nr_osd_parents,\n\t\t0x00B0, 16, 3, 23),\n\tMUX_GATE(CLK_TOP_OSD_SEL, \"osd_sel\", nr_osd_parents,\n\t\t0x00B0, 24, 3, 31),\n\n\tMUX_GATE(CLK_TOP_HDMIRX_BIST_SEL, \"hdmirx_bist_sel\",\n\t\thdmirx_bist_parents, 0x00C0, 0, 3, 7),\n\tMUX_GATE(CLK_TOP_INTDIR_SEL, \"intdir_sel\", intdir_parents,\n\t\t0x00C0, 8, 2, 15),\n\tMUX_GATE(CLK_TOP_ASM_I_SEL, \"asm_i_sel\", asm_parents,\n\t\t0x00C0, 16, 2, 23),\n\tMUX_GATE(CLK_TOP_ASM_M_SEL, \"asm_m_sel\", asm_parents,\n\t\t0x00C0, 24, 3, 31),\n\n\tMUX_GATE(CLK_TOP_ASM_H_SEL, \"asm_h_sel\", asm_parents,\n\t\t0x00D0, 0, 2, 7),\n\tMUX_GATE(CLK_TOP_MS_CARD_SEL, \"ms_card_sel\", ms_card_parents,\n\t\t0x00D0, 16, 2, 23),\n\tMUX_GATE(CLK_TOP_ETHIF_SEL, \"ethif_sel\", ethif_parents,\n\t\t0x00D0, 24, 3, 31),\n\n\tMUX_GATE(CLK_TOP_HDMIRX26_24_SEL, \"hdmirx26_24_sel\", hdmirx_parents,\n\t\t0x00E0, 0, 1, 7),\n\tMUX_GATE(CLK_TOP_MSDC30_3_SEL, \"msdc30_3_sel\", msdc30_parents,\n\t\t0x00E0, 8, 3, 15),\n\tMUX_GATE(CLK_TOP_CMSYS_SEL, \"cmsys_sel\", cmsys_parents,\n\t\t0x00E0, 16, 4, 23),\n\n\tMUX_GATE(CLK_TOP_SPI1_SEL, \"spi2_sel\", spi_parents,\n\t\t0x00E0, 24, 3, 31),\n\tMUX_GATE(CLK_TOP_SPI2_SEL, \"spi1_sel\", spi_parents,\n\t\t0x00F0, 0, 3, 7),\n\tMUX_GATE(CLK_TOP_8BDAC_SEL, \"8bdac_sel\", clk_8bdac_parents,\n\t\t0x00F0, 8, 2, 15),\n\tMUX_GATE(CLK_TOP_AUD2DVD_SEL, \"aud2dvd_sel\", aud2dvd_parents,\n\t\t0x00F0, 16, 1, 23),\n\n\tMUX(CLK_TOP_PADMCLK_SEL, \"padmclk_sel\", padmclk_parents,\n\t\t0x0100, 0, 3),\n\n\tMUX(CLK_TOP_AUD_MUX1_SEL, \"aud_mux1_sel\", aud_mux_parents,\n\t\t0x012c, 0, 3),\n\tMUX(CLK_TOP_AUD_MUX2_SEL, \"aud_mux2_sel\", aud_mux_parents,\n\t\t0x012c, 3, 3),\n\tMUX(CLK_TOP_AUDPLL_MUX_SEL, \"audpll_sel\", aud_mux_parents,\n\t\t0x012c, 6, 3),\n\tMUX_GATE(CLK_TOP_AUD_K1_SRC_SEL, \"aud_k1_src_sel\", aud_src_parents,\n\t\t0x012c, 15, 1, 23),\n\tMUX_GATE(CLK_TOP_AUD_K2_SRC_SEL, \"aud_k2_src_sel\", aud_src_parents,\n\t\t0x012c, 16, 1, 24),\n\tMUX_GATE(CLK_TOP_AUD_K3_SRC_SEL, \"aud_k3_src_sel\", aud_src_parents,\n\t\t0x012c, 17, 1, 25),\n\tMUX_GATE(CLK_TOP_AUD_K4_SRC_SEL, \"aud_k4_src_sel\", aud_src_parents,\n\t\t0x012c, 18, 1, 26),\n\tMUX_GATE(CLK_TOP_AUD_K5_SRC_SEL, \"aud_k5_src_sel\", aud_src_parents,\n\t\t0x012c, 19, 1, 27),\n\tMUX_GATE(CLK_TOP_AUD_K6_SRC_SEL, \"aud_k6_src_sel\", aud_src_parents,\n\t\t0x012c, 20, 1, 28),\n};\n\nstatic const struct mtk_clk_divider top_adj_divs[] = {\n\tDIV_ADJ(CLK_TOP_AUD_EXTCK1_DIV, \"audio_ext1_ck\", \"aud_ext1\",\n\t\t0x0120, 0, 8),\n\tDIV_ADJ(CLK_TOP_AUD_EXTCK2_DIV, \"audio_ext2_ck\", \"aud_ext2\",\n\t\t0x0120, 8, 8),\n\tDIV_ADJ(CLK_TOP_AUD_MUX1_DIV, \"aud_mux1_div\", \"aud_mux1_sel\",\n\t\t0x0120, 16, 8),\n\tDIV_ADJ(CLK_TOP_AUD_MUX2_DIV, \"aud_mux2_div\", \"aud_mux2_sel\",\n\t\t0x0120, 24, 8),\n\tDIV_ADJ(CLK_TOP_AUD_K1_SRC_DIV, \"aud_k1_src_div\", \"aud_k1_src_sel\",\n\t\t0x0124, 0, 8),\n\tDIV_ADJ(CLK_TOP_AUD_K2_SRC_DIV, \"aud_k2_src_div\", \"aud_k2_src_sel\",\n\t\t0x0124, 8, 8),\n\tDIV_ADJ(CLK_TOP_AUD_K3_SRC_DIV, \"aud_k3_src_div\", \"aud_k3_src_sel\",\n\t\t0x0124, 16, 8),\n\tDIV_ADJ(CLK_TOP_AUD_K4_SRC_DIV, \"aud_k4_src_div\", \"aud_k4_src_sel\",\n\t\t0x0124, 24, 8),\n\tDIV_ADJ(CLK_TOP_AUD_K5_SRC_DIV, \"aud_k5_src_div\", \"aud_k5_src_sel\",\n\t\t0x0128, 0, 8),\n\tDIV_ADJ(CLK_TOP_AUD_K6_SRC_DIV, \"aud_k6_src_div\", \"aud_k6_src_sel\",\n\t\t0x0128, 8, 8),\n};\n\nstatic const struct mtk_gate_regs top_aud_cg_regs = {\n\t.sta_ofs = 0x012C,\n};\n\n#define GATE_TOP_AUD(_id, _name, _parent, _shift)\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &top_aud_cg_regs, _shift, &mtk_clk_gate_ops_no_setclr)\n\nstatic const struct mtk_gate top_clks[] = {\n\tGATE_TOP_AUD(CLK_TOP_AUD_48K_TIMING, \"a1sys_hp_ck\", \"aud_mux1_div\",\n\t\t21),\n\tGATE_TOP_AUD(CLK_TOP_AUD_44K_TIMING, \"a2sys_hp_ck\", \"aud_mux2_div\",\n\t\t22),\n\tGATE_TOP_AUD(CLK_TOP_AUD_I2S1_MCLK, \"aud_i2s1_mclk\", \"aud_k1_src_div\",\n\t\t23),\n\tGATE_TOP_AUD(CLK_TOP_AUD_I2S2_MCLK, \"aud_i2s2_mclk\", \"aud_k2_src_div\",\n\t\t24),\n\tGATE_TOP_AUD(CLK_TOP_AUD_I2S3_MCLK, \"aud_i2s3_mclk\", \"aud_k3_src_div\",\n\t\t25),\n\tGATE_TOP_AUD(CLK_TOP_AUD_I2S4_MCLK, \"aud_i2s4_mclk\", \"aud_k4_src_div\",\n\t\t26),\n\tGATE_TOP_AUD(CLK_TOP_AUD_I2S5_MCLK, \"aud_i2s5_mclk\", \"aud_k5_src_div\",\n\t\t27),\n\tGATE_TOP_AUD(CLK_TOP_AUD_I2S6_MCLK, \"aud_i2s6_mclk\", \"aud_k6_src_div\",\n\t\t28),\n};\n\nstatic int mtk_topckgen_init(struct platform_device *pdev)\n{\n\tstruct clk_hw_onecell_data *clk_data;\n\tvoid __iomem *base;\n\tstruct device_node *node = pdev->dev.of_node;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tclk_data = mtk_alloc_clk_data(CLK_TOP_NR);\n\tif (!clk_data)\n\t\treturn -ENOMEM;\n\n\tmtk_clk_register_fixed_clks(top_fixed_clks, ARRAY_SIZE(top_fixed_clks),\n\t\t\t\t\t\t\t\tclk_data);\n\n\tmtk_clk_register_factors(top_fixed_divs, ARRAY_SIZE(top_fixed_divs),\n\t\t\t\t\t\t\t\tclk_data);\n\n\tmtk_clk_register_composites(&pdev->dev, top_muxes,\n\t\t\t\t    ARRAY_SIZE(top_muxes), base,\n\t\t\t\t    &mt2701_clk_lock, clk_data);\n\n\tmtk_clk_register_dividers(&pdev->dev, top_adj_divs, ARRAY_SIZE(top_adj_divs),\n\t\t\t\tbase, &mt2701_clk_lock, clk_data);\n\n\tmtk_clk_register_gates(&pdev->dev, node, top_clks,\n\t\t\t       ARRAY_SIZE(top_clks), clk_data);\n\n\treturn of_clk_add_hw_provider(node, of_clk_hw_onecell_get, clk_data);\n}\n\nstatic const struct mtk_gate_regs infra_cg_regs = {\n\t.set_ofs = 0x0040,\n\t.clr_ofs = 0x0044,\n\t.sta_ofs = 0x0048,\n};\n\n#define GATE_ICG(_id, _name, _parent, _shift)\t\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &infra_cg_regs, _shift, &mtk_clk_gate_ops_setclr)\n\nstatic const struct mtk_gate infra_clks[] = {\n\tGATE_ICG(CLK_INFRA_DBG, \"dbgclk\", \"axi_sel\", 0),\n\tGATE_ICG(CLK_INFRA_SMI, \"smi_ck\", \"mm_sel\", 1),\n\tGATE_ICG(CLK_INFRA_QAXI_CM4, \"cm4_ck\", \"axi_sel\", 2),\n\tGATE_ICG(CLK_INFRA_AUD_SPLIN_B, \"audio_splin_bck\", \"hadds2pll_294m\", 4),\n\tGATE_ICG(CLK_INFRA_AUDIO, \"audio_ck\", \"clk26m\", 5),\n\tGATE_ICG(CLK_INFRA_EFUSE, \"efuse_ck\", \"clk26m\", 6),\n\tGATE_ICG(CLK_INFRA_L2C_SRAM, \"l2c_sram_ck\", \"mm_sel\", 7),\n\tGATE_ICG(CLK_INFRA_M4U, \"m4u_ck\", \"mem_sel\", 8),\n\tGATE_ICG(CLK_INFRA_CONNMCU, \"connsys_bus\", \"wbg_dig_ck_416m\", 12),\n\tGATE_ICG(CLK_INFRA_TRNG, \"trng_ck\", \"axi_sel\", 13),\n\tGATE_ICG(CLK_INFRA_RAMBUFIF, \"rambufif_ck\", \"mem_sel\", 14),\n\tGATE_ICG(CLK_INFRA_CPUM, \"cpum_ck\", \"mem_sel\", 15),\n\tGATE_ICG(CLK_INFRA_KP, \"kp_ck\", \"axi_sel\", 16),\n\tGATE_ICG(CLK_INFRA_CEC, \"cec_ck\", \"rtc_sel\", 18),\n\tGATE_ICG(CLK_INFRA_IRRX, \"irrx_ck\", \"axi_sel\", 19),\n\tGATE_ICG(CLK_INFRA_PMICSPI, \"pmicspi_ck\", \"pmicspi_sel\", 22),\n\tGATE_ICG(CLK_INFRA_PMICWRAP, \"pmicwrap_ck\", \"axi_sel\", 23),\n\tGATE_ICG(CLK_INFRA_DDCCI, \"ddcci_ck\", \"axi_sel\", 24),\n};\n\nstatic const struct mtk_fixed_factor infra_fixed_divs[] = {\n\tFACTOR(CLK_INFRA_CLK_13M, \"clk13m\", \"clk26m\", 1, 2),\n};\n\nstatic u16 infrasys_rst_ofs[] = { 0x30, 0x34, };\nstatic u16 pericfg_rst_ofs[] = { 0x0, 0x4, };\n\nstatic const struct mtk_clk_rst_desc clk_rst_desc[] = {\n\t \n\t{\n\t\t.version = MTK_RST_SIMPLE,\n\t\t.rst_bank_ofs = infrasys_rst_ofs,\n\t\t.rst_bank_nr = ARRAY_SIZE(infrasys_rst_ofs),\n\t},\n\t \n\t{\n\t\t.version = MTK_RST_SIMPLE,\n\t\t.rst_bank_ofs = pericfg_rst_ofs,\n\t\t.rst_bank_nr = ARRAY_SIZE(pericfg_rst_ofs),\n\t},\n};\n\nstatic struct clk_hw_onecell_data *infra_clk_data;\n\nstatic void __init mtk_infrasys_init_early(struct device_node *node)\n{\n\tint r, i;\n\n\tif (!infra_clk_data) {\n\t\tinfra_clk_data = mtk_alloc_clk_data(CLK_INFRA_NR);\n\t\tif (!infra_clk_data)\n\t\t\treturn;\n\n\t\tfor (i = 0; i < CLK_INFRA_NR; i++)\n\t\t\tinfra_clk_data->hws[i] = ERR_PTR(-EPROBE_DEFER);\n\t}\n\n\tmtk_clk_register_factors(infra_fixed_divs, ARRAY_SIZE(infra_fixed_divs),\n\t\t\t\t\t\tinfra_clk_data);\n\n\tmtk_clk_register_cpumuxes(NULL, node, cpu_muxes, ARRAY_SIZE(cpu_muxes),\n\t\t\t\t  infra_clk_data);\n\n\tr = of_clk_add_hw_provider(node, of_clk_hw_onecell_get,\n\t\t\t\t   infra_clk_data);\n\tif (r)\n\t\tpr_err(\"%s(): could not register clock provider: %d\\n\",\n\t\t\t__func__, r);\n}\nCLK_OF_DECLARE_DRIVER(mtk_infra, \"mediatek,mt2701-infracfg\",\n\t\t\tmtk_infrasys_init_early);\n\nstatic int mtk_infrasys_init(struct platform_device *pdev)\n{\n\tint r, i;\n\tstruct device_node *node = pdev->dev.of_node;\n\n\tif (!infra_clk_data) {\n\t\tinfra_clk_data = mtk_alloc_clk_data(CLK_INFRA_NR);\n\t\tif (!infra_clk_data)\n\t\t\treturn -ENOMEM;\n\t} else {\n\t\tfor (i = 0; i < CLK_INFRA_NR; i++) {\n\t\t\tif (infra_clk_data->hws[i] == ERR_PTR(-EPROBE_DEFER))\n\t\t\t\tinfra_clk_data->hws[i] = ERR_PTR(-ENOENT);\n\t\t}\n\t}\n\n\tmtk_clk_register_gates(&pdev->dev, node, infra_clks,\n\t\t\t       ARRAY_SIZE(infra_clks), infra_clk_data);\n\tmtk_clk_register_factors(infra_fixed_divs, ARRAY_SIZE(infra_fixed_divs),\n\t\t\t\t\t\tinfra_clk_data);\n\n\tr = of_clk_add_hw_provider(node, of_clk_hw_onecell_get,\n\t\t\t\t   infra_clk_data);\n\tif (r)\n\t\treturn r;\n\n\tmtk_register_reset_controller_with_dev(&pdev->dev, &clk_rst_desc[0]);\n\n\treturn 0;\n}\n\nstatic const struct mtk_gate_regs peri0_cg_regs = {\n\t.set_ofs = 0x0008,\n\t.clr_ofs = 0x0010,\n\t.sta_ofs = 0x0018,\n};\n\nstatic const struct mtk_gate_regs peri1_cg_regs = {\n\t.set_ofs = 0x000c,\n\t.clr_ofs = 0x0014,\n\t.sta_ofs = 0x001c,\n};\n\n#define GATE_PERI0(_id, _name, _parent, _shift)\t\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &peri0_cg_regs, _shift, &mtk_clk_gate_ops_setclr)\n\n#define GATE_PERI1(_id, _name, _parent, _shift)\t\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &peri1_cg_regs, _shift, &mtk_clk_gate_ops_setclr)\n\nstatic const struct mtk_gate peri_clks[] = {\n\tGATE_PERI0(CLK_PERI_USB0_MCU, \"usb0_mcu_ck\", \"axi_sel\", 31),\n\tGATE_PERI0(CLK_PERI_ETH, \"eth_ck\", \"clk26m\", 30),\n\tGATE_PERI0(CLK_PERI_SPI0, \"spi0_ck\", \"spi0_sel\", 29),\n\tGATE_PERI0(CLK_PERI_AUXADC, \"auxadc_ck\", \"clk26m\", 28),\n\tGATE_PERI0(CLK_PERI_I2C3, \"i2c3_ck\", \"clk26m\", 27),\n\tGATE_PERI0(CLK_PERI_I2C2, \"i2c2_ck\", \"axi_sel\", 26),\n\tGATE_PERI0(CLK_PERI_I2C1, \"i2c1_ck\", \"axi_sel\", 25),\n\tGATE_PERI0(CLK_PERI_I2C0, \"i2c0_ck\", \"axi_sel\", 24),\n\tGATE_PERI0(CLK_PERI_BTIF, \"bitif_ck\", \"axi_sel\", 23),\n\tGATE_PERI0(CLK_PERI_UART3, \"uart3_ck\", \"axi_sel\", 22),\n\tGATE_PERI0(CLK_PERI_UART2, \"uart2_ck\", \"axi_sel\", 21),\n\tGATE_PERI0(CLK_PERI_UART1, \"uart1_ck\", \"axi_sel\", 20),\n\tGATE_PERI0(CLK_PERI_UART0, \"uart0_ck\", \"axi_sel\", 19),\n\tGATE_PERI0(CLK_PERI_NLI, \"nli_ck\", \"axi_sel\", 18),\n\tGATE_PERI0(CLK_PERI_MSDC50_3, \"msdc50_3_ck\", \"emmc_hclk_sel\", 17),\n\tGATE_PERI0(CLK_PERI_MSDC30_3, \"msdc30_3_ck\", \"msdc30_3_sel\", 16),\n\tGATE_PERI0(CLK_PERI_MSDC30_2, \"msdc30_2_ck\", \"msdc30_2_sel\", 15),\n\tGATE_PERI0(CLK_PERI_MSDC30_1, \"msdc30_1_ck\", \"msdc30_1_sel\", 14),\n\tGATE_PERI0(CLK_PERI_MSDC30_0, \"msdc30_0_ck\", \"msdc30_0_sel\", 13),\n\tGATE_PERI0(CLK_PERI_AP_DMA, \"ap_dma_ck\", \"axi_sel\", 12),\n\tGATE_PERI0(CLK_PERI_USB1, \"usb1_ck\", \"usb20_sel\", 11),\n\tGATE_PERI0(CLK_PERI_USB0, \"usb0_ck\", \"usb20_sel\", 10),\n\tGATE_PERI0(CLK_PERI_PWM, \"pwm_ck\", \"axi_sel\", 9),\n\tGATE_PERI0(CLK_PERI_PWM7, \"pwm7_ck\", \"axisel_d4\", 8),\n\tGATE_PERI0(CLK_PERI_PWM6, \"pwm6_ck\", \"axisel_d4\", 7),\n\tGATE_PERI0(CLK_PERI_PWM5, \"pwm5_ck\", \"axisel_d4\", 6),\n\tGATE_PERI0(CLK_PERI_PWM4, \"pwm4_ck\", \"axisel_d4\", 5),\n\tGATE_PERI0(CLK_PERI_PWM3, \"pwm3_ck\", \"axisel_d4\", 4),\n\tGATE_PERI0(CLK_PERI_PWM2, \"pwm2_ck\", \"axisel_d4\", 3),\n\tGATE_PERI0(CLK_PERI_PWM1, \"pwm1_ck\", \"axisel_d4\", 2),\n\tGATE_PERI0(CLK_PERI_THERM, \"therm_ck\", \"axi_sel\", 1),\n\tGATE_PERI0(CLK_PERI_NFI, \"nfi_ck\", \"nfi2x_sel\", 0),\n\n\tGATE_PERI1(CLK_PERI_FCI, \"fci_ck\", \"ms_card_sel\", 11),\n\tGATE_PERI1(CLK_PERI_SPI2, \"spi2_ck\", \"spi2_sel\", 10),\n\tGATE_PERI1(CLK_PERI_SPI1, \"spi1_ck\", \"spi1_sel\", 9),\n\tGATE_PERI1(CLK_PERI_HOST89_DVD, \"host89_dvd_ck\", \"aud2dvd_sel\", 8),\n\tGATE_PERI1(CLK_PERI_HOST89_SPI, \"host89_spi_ck\", \"spi0_sel\", 7),\n\tGATE_PERI1(CLK_PERI_HOST89_INT, \"host89_int_ck\", \"axi_sel\", 6),\n\tGATE_PERI1(CLK_PERI_FLASH, \"flash_ck\", \"nfi2x_sel\", 5),\n\tGATE_PERI1(CLK_PERI_NFI_PAD, \"nfi_pad_ck\", \"nfi1x_pad\", 4),\n\tGATE_PERI1(CLK_PERI_NFI_ECC, \"nfi_ecc_ck\", \"nfi1x_pad\", 3),\n\tGATE_PERI1(CLK_PERI_GCPU, \"gcpu_ck\", \"axi_sel\", 2),\n\tGATE_PERI1(CLK_PERI_USB_SLV, \"usbslv_ck\", \"axi_sel\", 1),\n\tGATE_PERI1(CLK_PERI_USB1_MCU, \"usb1_mcu_ck\", \"axi_sel\", 0),\n};\n\nstatic const char * const uart_ck_sel_parents[] = {\n\t\"clk26m\",\n\t\"uart_sel\",\n};\n\nstatic const struct mtk_composite peri_muxs[] = {\n\tMUX(CLK_PERI_UART0_SEL, \"uart0_ck_sel\", uart_ck_sel_parents,\n\t\t0x40c, 0, 1),\n\tMUX(CLK_PERI_UART1_SEL, \"uart1_ck_sel\", uart_ck_sel_parents,\n\t\t0x40c, 1, 1),\n\tMUX(CLK_PERI_UART2_SEL, \"uart2_ck_sel\", uart_ck_sel_parents,\n\t\t0x40c, 2, 1),\n\tMUX(CLK_PERI_UART3_SEL, \"uart3_ck_sel\", uart_ck_sel_parents,\n\t\t0x40c, 3, 1),\n};\n\nstatic int mtk_pericfg_init(struct platform_device *pdev)\n{\n\tstruct clk_hw_onecell_data *clk_data;\n\tvoid __iomem *base;\n\tint r;\n\tstruct device_node *node = pdev->dev.of_node;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tclk_data = mtk_alloc_clk_data(CLK_PERI_NR);\n\tif (!clk_data)\n\t\treturn -ENOMEM;\n\n\tmtk_clk_register_gates(&pdev->dev, node, peri_clks,\n\t\t\t       ARRAY_SIZE(peri_clks), clk_data);\n\n\tmtk_clk_register_composites(&pdev->dev, peri_muxs,\n\t\t\t\t    ARRAY_SIZE(peri_muxs), base,\n\t\t\t\t    &mt2701_clk_lock, clk_data);\n\n\tr = of_clk_add_hw_provider(node, of_clk_hw_onecell_get, clk_data);\n\tif (r)\n\t\treturn r;\n\n\tmtk_register_reset_controller_with_dev(&pdev->dev, &clk_rst_desc[1]);\n\n\treturn 0;\n}\n\n#define MT8590_PLL_FMAX\t\t(2000 * MHZ)\n#define CON0_MT8590_RST_BAR\tBIT(27)\n\n#define PLL(_id, _name, _reg, _pwr_reg, _en_mask, _flags, _pcwbits, _pd_reg, \\\n\t\t\t_pd_shift, _tuner_reg, _pcw_reg, _pcw_shift) {\t\\\n\t\t.id = _id,\t\t\t\t\t\t\\\n\t\t.name = _name,\t\t\t\t\t\t\\\n\t\t.reg = _reg,\t\t\t\t\t\t\\\n\t\t.pwr_reg = _pwr_reg,\t\t\t\t\t\\\n\t\t.en_mask = _en_mask,\t\t\t\t\t\\\n\t\t.flags = _flags,\t\t\t\t\t\\\n\t\t.rst_bar_mask = CON0_MT8590_RST_BAR,\t\t\t\\\n\t\t.fmax = MT8590_PLL_FMAX,\t\t\t\t\\\n\t\t.pcwbits = _pcwbits,\t\t\t\t\t\\\n\t\t.pd_reg = _pd_reg,\t\t\t\t\t\\\n\t\t.pd_shift = _pd_shift,\t\t\t\t\t\\\n\t\t.tuner_reg = _tuner_reg,\t\t\t\t\\\n\t\t.pcw_reg = _pcw_reg,\t\t\t\t\t\\\n\t\t.pcw_shift = _pcw_shift,\t\t\t\t\\\n\t}\n\nstatic const struct mtk_pll_data apmixed_plls[] = {\n\tPLL(CLK_APMIXED_ARMPLL, \"armpll\", 0x200, 0x20c, 0x80000000,\n\t\t\tPLL_AO, 21, 0x204, 24, 0x0, 0x204, 0),\n\tPLL(CLK_APMIXED_MAINPLL, \"mainpll\", 0x210, 0x21c, 0xf0000000,\n\t\t  HAVE_RST_BAR, 21, 0x210, 4, 0x0, 0x214, 0),\n\tPLL(CLK_APMIXED_UNIVPLL, \"univpll\", 0x220, 0x22c, 0xf3000000,\n\t\t  HAVE_RST_BAR, 7, 0x220, 4, 0x0, 0x224, 14),\n\tPLL(CLK_APMIXED_MMPLL, \"mmpll\", 0x230, 0x23c, 0, 0,\n\t\t\t\t21, 0x230, 4, 0x0, 0x234, 0),\n\tPLL(CLK_APMIXED_MSDCPLL, \"msdcpll\", 0x240, 0x24c, 0x00000001, 0,\n\t\t\t\t21, 0x240, 4, 0x0, 0x244, 0),\n\tPLL(CLK_APMIXED_TVDPLL, \"tvdpll\", 0x250, 0x25c, 0x00000001, 0,\n\t\t\t\t21, 0x250, 4, 0x0, 0x254, 0),\n\tPLL(CLK_APMIXED_AUD1PLL, \"aud1pll\", 0x270, 0x27c, 0x00000001, 0,\n\t\t\t\t31, 0x270, 4, 0x0, 0x274, 0),\n\tPLL(CLK_APMIXED_TRGPLL, \"trgpll\", 0x280, 0x28c, 0x00000001, 0,\n\t\t\t\t31, 0x280, 4, 0x0, 0x284, 0),\n\tPLL(CLK_APMIXED_ETHPLL, \"ethpll\", 0x290, 0x29c, 0x00000001, 0,\n\t\t\t\t31, 0x290, 4, 0x0, 0x294, 0),\n\tPLL(CLK_APMIXED_VDECPLL, \"vdecpll\", 0x2a0, 0x2ac, 0x00000001, 0,\n\t\t\t\t31, 0x2a0, 4, 0x0, 0x2a4, 0),\n\tPLL(CLK_APMIXED_HADDS2PLL, \"hadds2pll\", 0x2b0, 0x2bc, 0x00000001, 0,\n\t\t\t\t31, 0x2b0, 4, 0x0, 0x2b4, 0),\n\tPLL(CLK_APMIXED_AUD2PLL, \"aud2pll\", 0x2c0, 0x2cc, 0x00000001, 0,\n\t\t\t\t31, 0x2c0, 4, 0x0, 0x2c4, 0),\n\tPLL(CLK_APMIXED_TVD2PLL, \"tvd2pll\", 0x2d0, 0x2dc, 0x00000001, 0,\n\t\t\t\t21, 0x2d0, 4, 0x0, 0x2d4, 0),\n};\n\nstatic const struct mtk_fixed_factor apmixed_fixed_divs[] = {\n\tFACTOR(CLK_APMIXED_HDMI_REF, \"hdmi_ref\", \"tvdpll\", 1, 1),\n};\n\nstatic int mtk_apmixedsys_init(struct platform_device *pdev)\n{\n\tstruct clk_hw_onecell_data *clk_data;\n\tstruct device_node *node = pdev->dev.of_node;\n\n\tclk_data = mtk_alloc_clk_data(CLK_APMIXED_NR);\n\tif (!clk_data)\n\t\treturn -ENOMEM;\n\n\tmtk_clk_register_plls(node, apmixed_plls, ARRAY_SIZE(apmixed_plls),\n\t\t\t\t\t\t\t\tclk_data);\n\tmtk_clk_register_factors(apmixed_fixed_divs, ARRAY_SIZE(apmixed_fixed_divs),\n\t\t\t\t\t\t\t\tclk_data);\n\n\treturn of_clk_add_hw_provider(node, of_clk_hw_onecell_get, clk_data);\n}\n\nstatic const struct of_device_id of_match_clk_mt2701[] = {\n\t{\n\t\t.compatible = \"mediatek,mt2701-topckgen\",\n\t\t.data = mtk_topckgen_init,\n\t}, {\n\t\t.compatible = \"mediatek,mt2701-infracfg\",\n\t\t.data = mtk_infrasys_init,\n\t}, {\n\t\t.compatible = \"mediatek,mt2701-pericfg\",\n\t\t.data = mtk_pericfg_init,\n\t}, {\n\t\t.compatible = \"mediatek,mt2701-apmixedsys\",\n\t\t.data = mtk_apmixedsys_init,\n\t}, {\n\t\t \n\t}\n};\nMODULE_DEVICE_TABLE(of, of_match_clk_mt2701);\n\nstatic int clk_mt2701_probe(struct platform_device *pdev)\n{\n\tint (*clk_init)(struct platform_device *);\n\tint r;\n\n\tclk_init = of_device_get_match_data(&pdev->dev);\n\tif (!clk_init)\n\t\treturn -EINVAL;\n\n\tr = clk_init(pdev);\n\tif (r)\n\t\tdev_err(&pdev->dev,\n\t\t\t\"could not register clock provider: %s: %d\\n\",\n\t\t\tpdev->name, r);\n\n\treturn r;\n}\n\nstatic struct platform_driver clk_mt2701_drv = {\n\t.probe = clk_mt2701_probe,\n\t.driver = {\n\t\t.name = \"clk-mt2701\",\n\t\t.of_match_table = of_match_clk_mt2701,\n\t},\n};\n\nstatic int __init clk_mt2701_init(void)\n{\n\treturn platform_driver_register(&clk_mt2701_drv);\n}\n\narch_initcall(clk_mt2701_init);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}