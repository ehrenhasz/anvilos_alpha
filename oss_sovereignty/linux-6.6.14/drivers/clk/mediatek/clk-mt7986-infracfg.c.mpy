{
  "module_name": "clk-mt7986-infracfg.c",
  "hash_id": "2f9417197843b31c1a372860bf3f6db185dab59b3659d42e8e55f908647a0dd2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mediatek/clk-mt7986-infracfg.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n#include \"clk-mtk.h\"\n#include \"clk-gate.h\"\n#include \"clk-mux.h\"\n\n#include <dt-bindings/clock/mt7986-clk.h>\n#include <linux/clk.h>\n\nstatic DEFINE_SPINLOCK(mt7986_clk_lock);\n\nstatic const struct mtk_fixed_factor infra_divs[] = {\n\tFACTOR(CLK_INFRA_SYSAXI_D2, \"infra_sysaxi_d2\", \"sysaxi_sel\", 1, 2),\n};\n\nstatic const char *const infra_uart_parent[] __initconst = { \"csw_f26m_sel\",\n\t\t\t\t\t\t\t     \"uart_sel\" };\n\nstatic const char *const infra_spi_parents[] __initconst = { \"i2c_sel\",\n\t\t\t\t\t\t\t     \"spi_sel\" };\n\nstatic const char *const infra_pwm_bsel_parents[] __initconst = {\n\t\"top_rtc_32p7k\", \"csw_f26m_sel\", \"infra_sysaxi_d2\", \"pwm_sel\"\n};\n\nstatic const char *const infra_pcie_parents[] __initconst = {\n\t\"top_rtc_32p7k\", \"csw_f26m_sel\", \"top_xtal\", \"pextp_tl_ck_sel\"\n};\n\nstatic const struct mtk_mux infra_muxes[] = {\n\t \n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_UART0_SEL, \"infra_uart0_sel\",\n\t\t\t     infra_uart_parent, 0x0018, 0x0010, 0x0014, 0, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_UART1_SEL, \"infra_uart1_sel\",\n\t\t\t     infra_uart_parent, 0x0018, 0x0010, 0x0014, 1, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_UART2_SEL, \"infra_uart2_sel\",\n\t\t\t     infra_uart_parent, 0x0018, 0x0010, 0x0014, 2, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_SPI0_SEL, \"infra_spi0_sel\",\n\t\t\t     infra_spi_parents, 0x0018, 0x0010, 0x0014, 4, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_SPI1_SEL, \"infra_spi1_sel\",\n\t\t\t     infra_spi_parents, 0x0018, 0x0010, 0x0014, 5, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PWM1_SEL, \"infra_pwm1_sel\",\n\t\t\t     infra_pwm_bsel_parents, 0x0018, 0x0010, 0x0014, 9,\n\t\t\t     2, -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PWM2_SEL, \"infra_pwm2_sel\",\n\t\t\t     infra_pwm_bsel_parents, 0x0018, 0x0010, 0x0014, 11,\n\t\t\t     2, -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PWM_BSEL, \"infra_pwm_bsel\",\n\t\t\t     infra_pwm_bsel_parents, 0x0018, 0x0010, 0x0014, 13,\n\t\t\t     2, -1, -1, -1),\n\t \n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PCIE_SEL, \"infra_pcie_sel\",\n\t\t\t     infra_pcie_parents, 0x0028, 0x0020, 0x0024, 0, 2,\n\t\t\t     -1, -1, -1),\n};\n\nstatic const struct mtk_gate_regs infra0_cg_regs = {\n\t.set_ofs = 0x40,\n\t.clr_ofs = 0x44,\n\t.sta_ofs = 0x48,\n};\n\nstatic const struct mtk_gate_regs infra1_cg_regs = {\n\t.set_ofs = 0x50,\n\t.clr_ofs = 0x54,\n\t.sta_ofs = 0x58,\n};\n\nstatic const struct mtk_gate_regs infra2_cg_regs = {\n\t.set_ofs = 0x60,\n\t.clr_ofs = 0x64,\n\t.sta_ofs = 0x68,\n};\n\n#define GATE_INFRA0(_id, _name, _parent, _shift)\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &infra0_cg_regs, _shift, &mtk_clk_gate_ops_setclr)\n\n#define GATE_INFRA1(_id, _name, _parent, _shift)\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &infra1_cg_regs, _shift, &mtk_clk_gate_ops_setclr)\n\n#define GATE_INFRA2(_id, _name, _parent, _shift)\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &infra2_cg_regs, _shift, &mtk_clk_gate_ops_setclr)\n\nstatic const struct mtk_gate infra_clks[] = {\n\t \n\tGATE_INFRA0(CLK_INFRA_GPT_STA, \"infra_gpt_sta\", \"infra_sysaxi_d2\", 0),\n\tGATE_INFRA0(CLK_INFRA_PWM_HCK, \"infra_pwm_hck\", \"infra_sysaxi_d2\", 1),\n\tGATE_INFRA0(CLK_INFRA_PWM_STA, \"infra_pwm_sta\", \"infra_pwm_bsel\", 2),\n\tGATE_INFRA0(CLK_INFRA_PWM1_CK, \"infra_pwm1\", \"infra_pwm1_sel\", 3),\n\tGATE_INFRA0(CLK_INFRA_PWM2_CK, \"infra_pwm2\", \"infra_pwm2_sel\", 4),\n\tGATE_INFRA0(CLK_INFRA_CQ_DMA_CK, \"infra_cq_dma\", \"sysaxi_sel\", 6),\n\tGATE_INFRA0(CLK_INFRA_EIP97_CK, \"infra_eip97\", \"eip_b_sel\", 7),\n\tGATE_INFRA0(CLK_INFRA_AUD_BUS_CK, \"infra_aud_bus\", \"sysaxi_sel\", 8),\n\tGATE_INFRA0(CLK_INFRA_AUD_26M_CK, \"infra_aud_26m\", \"csw_f26m_sel\", 9),\n\tGATE_INFRA0(CLK_INFRA_AUD_L_CK, \"infra_aud_l\", \"aud_l_sel\", 10),\n\tGATE_INFRA0(CLK_INFRA_AUD_AUD_CK, \"infra_aud_aud\", \"a1sys_sel\", 11),\n\tGATE_INFRA0(CLK_INFRA_AUD_EG2_CK, \"infra_aud_eg2\", \"a_tuner_sel\", 13),\n\tGATE_INFRA0(CLK_INFRA_DRAMC_26M_CK, \"infra_dramc_26m\", \"csw_f26m_sel\",\n\t\t    14),\n\tGATE_INFRA0(CLK_INFRA_DBG_CK, \"infra_dbg\", \"infra_sysaxi_d2\", 15),\n\tGATE_INFRA0(CLK_INFRA_AP_DMA_CK, \"infra_ap_dma\", \"infra_sysaxi_d2\", 16),\n\tGATE_INFRA0(CLK_INFRA_SEJ_CK, \"infra_sej\", \"infra_sysaxi_d2\", 24),\n\tGATE_INFRA0(CLK_INFRA_SEJ_13M_CK, \"infra_sej_13m\", \"csw_f26m_sel\", 25),\n\tGATE_INFRA0(CLK_INFRA_TRNG_CK, \"infra_trng\", \"sysaxi_sel\", 26),\n\t \n\tGATE_INFRA1(CLK_INFRA_THERM_CK, \"infra_therm\", \"csw_f26m_sel\", 0),\n\tGATE_INFRA1(CLK_INFRA_I2C0_CK, \"infra_i2c0\", \"i2c_sel\", 1),\n\tGATE_INFRA1(CLK_INFRA_UART0_CK, \"infra_uart0\", \"infra_uart0_sel\", 2),\n\tGATE_INFRA1(CLK_INFRA_UART1_CK, \"infra_uart1\", \"infra_uart1_sel\", 3),\n\tGATE_INFRA1(CLK_INFRA_UART2_CK, \"infra_uart2\", \"infra_uart2_sel\", 4),\n\tGATE_INFRA1(CLK_INFRA_NFI1_CK, \"infra_nfi1\", \"nfi1x_sel\", 8),\n\tGATE_INFRA1(CLK_INFRA_SPINFI1_CK, \"infra_spinfi1\", \"spinfi_sel\", 9),\n\tGATE_INFRA1(CLK_INFRA_NFI_HCK_CK, \"infra_nfi_hck\", \"infra_sysaxi_d2\",\n\t\t    10),\n\tGATE_INFRA1(CLK_INFRA_SPI0_CK, \"infra_spi0\", \"infra_spi0_sel\", 11),\n\tGATE_INFRA1(CLK_INFRA_SPI1_CK, \"infra_spi1\", \"infra_spi1_sel\", 12),\n\tGATE_INFRA1(CLK_INFRA_SPI0_HCK_CK, \"infra_spi0_hck\", \"infra_sysaxi_d2\",\n\t\t    13),\n\tGATE_INFRA1(CLK_INFRA_SPI1_HCK_CK, \"infra_spi1_hck\", \"infra_sysaxi_d2\",\n\t\t    14),\n\tGATE_INFRA1(CLK_INFRA_FRTC_CK, \"infra_frtc\", \"top_rtc_32k\", 15),\n\tGATE_INFRA1(CLK_INFRA_MSDC_CK, \"infra_msdc\", \"emmc_416m_sel\", 16),\n\tGATE_INFRA1(CLK_INFRA_MSDC_HCK_CK, \"infra_msdc_hck\", \"emmc_250m_sel\",\n\t\t    17),\n\tGATE_INFRA1(CLK_INFRA_MSDC_133M_CK, \"infra_msdc_133m\", \"sysaxi_sel\",\n\t\t    18),\n\tGATE_INFRA1(CLK_INFRA_MSDC_66M_CK, \"infra_msdc_66m\", \"infra_sysaxi_d2\",\n\t\t    19),\n\tGATE_INFRA1(CLK_INFRA_ADC_26M_CK, \"infra_adc_26m\", \"infra_adc_frc\", 20),\n\tGATE_INFRA1(CLK_INFRA_ADC_FRC_CK, \"infra_adc_frc\", \"csw_f26m_sel\", 21),\n\tGATE_INFRA1(CLK_INFRA_FBIST2FPC_CK, \"infra_fbist2fpc\", \"nfi1x_sel\", 23),\n\t \n\tGATE_INFRA2(CLK_INFRA_IUSB_133_CK, \"infra_iusb_133\", \"sysaxi_sel\", 0),\n\tGATE_INFRA2(CLK_INFRA_IUSB_66M_CK, \"infra_iusb_66m\", \"infra_sysaxi_d2\",\n\t\t    1),\n\tGATE_INFRA2(CLK_INFRA_IUSB_SYS_CK, \"infra_iusb_sys\", \"u2u3_sys_sel\", 2),\n\tGATE_INFRA2(CLK_INFRA_IUSB_CK, \"infra_iusb\", \"u2u3_sel\", 3),\n\tGATE_INFRA2(CLK_INFRA_IPCIE_CK, \"infra_ipcie\", \"pextp_tl_ck_sel\", 12),\n\tGATE_INFRA2(CLK_INFRA_IPCIE_PIPE_CK, \"infra_ipcie_pipe\", \"top_xtal\",\n\t\t    13),\n\tGATE_INFRA2(CLK_INFRA_IPCIER_CK, \"infra_ipcier\", \"csw_f26m_sel\", 14),\n\tGATE_INFRA2(CLK_INFRA_IPCIEB_CK, \"infra_ipcieb\", \"sysaxi_sel\", 15),\n};\n\nstatic const struct mtk_clk_desc infra_desc = {\n\t.clks = infra_clks,\n\t.num_clks = ARRAY_SIZE(infra_clks),\n\t.factor_clks = infra_divs,\n\t.num_factor_clks = ARRAY_SIZE(infra_divs),\n\t.mux_clks = infra_muxes,\n\t.num_mux_clks = ARRAY_SIZE(infra_muxes),\n\t.clk_lock = &mt7986_clk_lock,\n};\n\nstatic const struct of_device_id of_match_clk_mt7986_infracfg[] = {\n\t{ .compatible = \"mediatek,mt7986-infracfg\", .data = &infra_desc },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, of_match_clk_mt7986_infracfg);\n\nstatic struct platform_driver clk_mt7986_infracfg_drv = {\n\t.driver = {\n\t\t.name = \"clk-mt7986-infracfg\",\n\t\t.of_match_table = of_match_clk_mt7986_infracfg,\n\t},\n\t.probe = mtk_clk_simple_probe,\n\t.remove_new = mtk_clk_simple_remove,\n};\nmodule_platform_driver(clk_mt7986_infracfg_drv);\n\nMODULE_DESCRIPTION(\"MediaTek MT7986 infracfg clocks driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}