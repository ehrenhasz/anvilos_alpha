{
  "module_name": "clk-mt7622-infracfg.c",
  "hash_id": "1c8faf2275d7147d6092370db9607eb3443b97c8fe5feffce5cdba86a06c586f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mediatek/clk-mt7622-infracfg.c",
  "human_readable_source": "\n \n\n#include <dt-bindings/clock/mt7622-clk.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include \"clk-cpumux.h\"\n#include \"clk-gate.h\"\n#include \"clk-mtk.h\"\n#include \"reset.h\"\n\n#define GATE_INFRA(_id, _name, _parent, _shift)\t\t\t\t\\\n\tGATE_MTK(_id, _name, _parent, &infra_cg_regs, _shift, &mtk_clk_gate_ops_setclr)\n\nstatic const struct mtk_gate_regs infra_cg_regs = {\n\t.set_ofs = 0x40,\n\t.clr_ofs = 0x44,\n\t.sta_ofs = 0x48,\n};\n\nstatic const char * const infra_mux1_parents[] = {\n\t\"clkxtal\",\n\t\"armpll\",\n\t\"main_core_en\",\n\t\"armpll\"\n};\n\nstatic const struct mtk_composite cpu_muxes[] = {\n\tMUX(CLK_INFRA_MUX1_SEL, \"infra_mux1_sel\", infra_mux1_parents, 0x000, 2, 2),\n};\n\nstatic const struct mtk_gate infra_clks[] = {\n\tGATE_INFRA(CLK_INFRA_DBGCLK_PD, \"infra_dbgclk_pd\", \"axi_sel\", 0),\n\tGATE_INFRA(CLK_INFRA_TRNG, \"trng_ck\", \"axi_sel\", 2),\n\tGATE_INFRA(CLK_INFRA_AUDIO_PD, \"infra_audio_pd\", \"aud_intbus_sel\", 5),\n\tGATE_INFRA(CLK_INFRA_IRRX_PD, \"infra_irrx_pd\", \"irrx_sel\", 16),\n\tGATE_INFRA(CLK_INFRA_APXGPT_PD, \"infra_apxgpt_pd\", \"f10m_ref_sel\", 18),\n\tGATE_INFRA(CLK_INFRA_PMIC_PD, \"infra_pmic_pd\", \"pmicspi_sel\", 22),\n};\n\nstatic u16 infrasys_rst_ofs[] = { 0x30 };\n\nstatic const struct mtk_clk_rst_desc clk_rst_desc = {\n\t.version = MTK_RST_SIMPLE,\n\t.rst_bank_ofs = infrasys_rst_ofs,\n\t.rst_bank_nr = ARRAY_SIZE(infrasys_rst_ofs),\n};\n\nstatic const struct of_device_id of_match_clk_mt7622_infracfg[] = {\n\t{ .compatible = \"mediatek,mt7622-infracfg\" },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, of_match_clk_mt7622_infracfg);\n\nstatic int clk_mt7622_infracfg_probe(struct platform_device *pdev)\n{\n\tstruct clk_hw_onecell_data *clk_data;\n\tstruct device_node *node = pdev->dev.of_node;\n\tvoid __iomem *base;\n\tint ret;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tclk_data = mtk_alloc_clk_data(CLK_INFRA_NR_CLK);\n\tif (!clk_data)\n\t\treturn -ENOMEM;\n\n\tret = mtk_register_reset_controller_with_dev(&pdev->dev, &clk_rst_desc);\n\tif (ret)\n\t\tgoto free_clk_data;\n\n\tret = mtk_clk_register_gates(&pdev->dev, node, infra_clks,\n\t\t\t\t     ARRAY_SIZE(infra_clks), clk_data);\n\tif (ret)\n\t\tgoto free_clk_data;\n\n\tret = mtk_clk_register_cpumuxes(&pdev->dev, node, cpu_muxes,\n\t\t\t\t\tARRAY_SIZE(cpu_muxes), clk_data);\n\tif (ret)\n\t\tgoto unregister_gates;\n\n\tret = of_clk_add_hw_provider(node, of_clk_hw_onecell_get, clk_data);\n\tif (ret)\n\t\tgoto unregister_cpumuxes;\n\n\treturn 0;\n\nunregister_cpumuxes:\n\tmtk_clk_unregister_cpumuxes(cpu_muxes, ARRAY_SIZE(cpu_muxes), clk_data);\nunregister_gates:\n\tmtk_clk_unregister_gates(infra_clks, ARRAY_SIZE(infra_clks), clk_data);\nfree_clk_data:\n\tmtk_free_clk_data(clk_data);\n\treturn ret;\n}\n\nstatic void clk_mt7622_infracfg_remove(struct platform_device *pdev)\n{\n\tstruct device_node *node = pdev->dev.of_node;\n\tstruct clk_hw_onecell_data *clk_data = platform_get_drvdata(pdev);\n\n\tof_clk_del_provider(node);\n\tmtk_clk_unregister_cpumuxes(cpu_muxes, ARRAY_SIZE(cpu_muxes), clk_data);\n\tmtk_clk_unregister_gates(infra_clks, ARRAY_SIZE(infra_clks), clk_data);\n\tmtk_free_clk_data(clk_data);\n}\n\nstatic struct platform_driver clk_mt7622_infracfg_drv = {\n\t.driver = {\n\t\t.name = \"clk-mt7622-infracfg\",\n\t\t.of_match_table = of_match_clk_mt7622_infracfg,\n\t},\n\t.probe = clk_mt7622_infracfg_probe,\n\t.remove_new = clk_mt7622_infracfg_remove,\n};\nmodule_platform_driver(clk_mt7622_infracfg_drv);\n\nMODULE_DESCRIPTION(\"MediaTek MT7622 infracfg clocks driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}