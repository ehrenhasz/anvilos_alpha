{
  "module_name": "clk-mt7981-infracfg.c",
  "hash_id": "a4cf50c4e6844211739b60bd7a7bc9697b55db407bfbd10cc254b7e1c3f72a39",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mediatek/clk-mt7981-infracfg.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n#include \"clk-mtk.h\"\n#include \"clk-gate.h\"\n#include \"clk-mux.h\"\n\n#include <dt-bindings/clock/mediatek,mt7981-clk.h>\n#include <linux/clk.h>\n\nstatic DEFINE_SPINLOCK(mt7981_clk_lock);\n\nstatic const struct mtk_fixed_factor infra_divs[] = {\n\tFACTOR(CLK_INFRA_66M_MCK, \"infra_66m_mck\", \"sysaxi_sel\", 1, 2),\n};\n\nstatic const char *const infra_uart_parent[] __initconst = { \"csw_f26m_sel\",\n\t\t\t\t\t\t\t\t\"uart_sel\" };\n\nstatic const char *const infra_spi0_parents[] __initconst = { \"i2c_sel\",\n\t\t\t\t\t\t\t      \"spi_sel\" };\n\nstatic const char *const infra_spi1_parents[] __initconst = { \"i2c_sel\",\n\t\t\t\t\t\t\t      \"spim_mst_sel\" };\n\nstatic const char *const infra_pwm1_parents[] __initconst = { \"pwm_sel\" };\n\nstatic const char *const infra_pwm_bsel_parents[] __initconst = {\n\t\"cb_rtc_32p7k\", \"csw_f26m_sel\", \"infra_66m_mck\", \"pwm_sel\"\n};\n\nstatic const char *const infra_pcie_parents[] __initconst = {\n\t\"cb_rtc_32p7k\", \"csw_f26m_sel\", \"cb_cksq_40m\", \"pextp_tl_ck_sel\"\n};\n\nstatic const struct mtk_mux infra_muxes[] = {\n\t \n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_UART0_SEL, \"infra_uart0_sel\",\n\t\t\t     infra_uart_parent, 0x0018, 0x0010, 0x0014, 0, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_UART1_SEL, \"infra_uart1_sel\",\n\t\t\t     infra_uart_parent, 0x0018, 0x0010, 0x0014, 1, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_UART2_SEL, \"infra_uart2_sel\",\n\t\t\t     infra_uart_parent, 0x0018, 0x0010, 0x0014, 2, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_SPI0_SEL, \"infra_spi0_sel\",\n\t\t\t     infra_spi0_parents, 0x0018, 0x0010, 0x0014, 4, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_SPI1_SEL, \"infra_spi1_sel\",\n\t\t\t     infra_spi1_parents, 0x0018, 0x0010, 0x0014, 5, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_SPI2_SEL, \"infra_spi2_sel\",\n\t\t\t     infra_spi0_parents, 0x0018, 0x0010, 0x0014, 6, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PWM1_SEL, \"infra_pwm1_sel\",\n\t\t\t     infra_pwm1_parents, 0x0018, 0x0010, 0x0014, 9, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PWM2_SEL, \"infra_pwm2_sel\",\n\t\t\t     infra_pwm1_parents, 0x0018, 0x0010, 0x0014, 11, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PWM3_SEL, \"infra_pwm3_sel\",\n\t\t\t     infra_pwm1_parents, 0x0018, 0x0010, 0x0014, 15, 1,\n\t\t\t     -1, -1, -1),\n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PWM_BSEL, \"infra_pwm_bsel\",\n\t\t\t     infra_pwm_bsel_parents, 0x0018, 0x0010, 0x0014, 13,\n\t\t\t     2, -1, -1, -1),\n\t \n\tMUX_GATE_CLR_SET_UPD(CLK_INFRA_PCIE_SEL, \"infra_pcie_sel\",\n\t\t\t     infra_pcie_parents, 0x0028, 0x0020, 0x0024, 0, 2,\n\t\t\t     -1, -1, -1),\n};\n\nstatic const struct mtk_gate_regs infra0_cg_regs = {\n\t.set_ofs = 0x40,\n\t.clr_ofs = 0x44,\n\t.sta_ofs = 0x48,\n};\n\nstatic const struct mtk_gate_regs infra1_cg_regs = {\n\t.set_ofs = 0x50,\n\t.clr_ofs = 0x54,\n\t.sta_ofs = 0x58,\n};\n\nstatic const struct mtk_gate_regs infra2_cg_regs = {\n\t.set_ofs = 0x60,\n\t.clr_ofs = 0x64,\n\t.sta_ofs = 0x68,\n};\n\n#define GATE_INFRA0(_id, _name, _parent, _shift)                               \\\n\t{                                                                      \\\n\t\t.id = _id, .name = _name, .parent_name = _parent,              \\\n\t\t.regs = &infra0_cg_regs, .shift = _shift,                      \\\n\t\t.ops = &mtk_clk_gate_ops_setclr,                               \\\n\t}\n\n#define GATE_INFRA1(_id, _name, _parent, _shift)                               \\\n\t{                                                                      \\\n\t\t.id = _id, .name = _name, .parent_name = _parent,              \\\n\t\t.regs = &infra1_cg_regs, .shift = _shift,                      \\\n\t\t.ops = &mtk_clk_gate_ops_setclr,                               \\\n\t}\n\n#define GATE_INFRA2(_id, _name, _parent, _shift)                               \\\n\t{                                                                      \\\n\t\t.id = _id, .name = _name, .parent_name = _parent,              \\\n\t\t.regs = &infra2_cg_regs, .shift = _shift,                      \\\n\t\t.ops = &mtk_clk_gate_ops_setclr,                               \\\n\t}\n\nstatic const struct mtk_gate infra_clks[] = {\n\t \n\tGATE_INFRA0(CLK_INFRA_GPT_STA, \"infra_gpt_sta\", \"infra_66m_mck\", 0),\n\tGATE_INFRA0(CLK_INFRA_PWM_HCK, \"infra_pwm_hck\", \"infra_66m_mck\", 1),\n\tGATE_INFRA0(CLK_INFRA_PWM_STA, \"infra_pwm_sta\", \"infra_pwm_bsel\", 2),\n\tGATE_INFRA0(CLK_INFRA_PWM1_CK, \"infra_pwm1\", \"infra_pwm1_sel\", 3),\n\tGATE_INFRA0(CLK_INFRA_PWM2_CK, \"infra_pwm2\", \"infra_pwm2_sel\", 4),\n\tGATE_INFRA0(CLK_INFRA_CQ_DMA_CK, \"infra_cq_dma\", \"sysaxi\", 6),\n\n\tGATE_INFRA0(CLK_INFRA_AUD_BUS_CK, \"infra_aud_bus\", \"sysaxi\", 8),\n\tGATE_INFRA0(CLK_INFRA_AUD_26M_CK, \"infra_aud_26m\", \"csw_f26m_sel\", 9),\n\tGATE_INFRA0(CLK_INFRA_AUD_L_CK, \"infra_aud_l\", \"aud_l\", 10),\n\tGATE_INFRA0(CLK_INFRA_AUD_AUD_CK, \"infra_aud_aud\", \"a1sys\", 11),\n\tGATE_INFRA0(CLK_INFRA_AUD_EG2_CK, \"infra_aud_eg2\", \"a_tuner\", 13),\n\tGATE_INFRA0(CLK_INFRA_DRAMC_26M_CK, \"infra_dramc_26m\", \"csw_f26m_sel\",\n\t\t    14),\n\tGATE_INFRA0(CLK_INFRA_DBG_CK, \"infra_dbg\", \"infra_66m_mck\", 15),\n\tGATE_INFRA0(CLK_INFRA_AP_DMA_CK, \"infra_ap_dma\", \"infra_66m_mck\", 16),\n\tGATE_INFRA0(CLK_INFRA_SEJ_CK, \"infra_sej\", \"infra_66m_mck\", 24),\n\tGATE_INFRA0(CLK_INFRA_SEJ_13M_CK, \"infra_sej_13m\", \"csw_f26m_sel\", 25),\n\tGATE_INFRA0(CLK_INFRA_PWM3_CK, \"infra_pwm3\", \"infra_pwm3_sel\", 27),\n\t \n\tGATE_INFRA1(CLK_INFRA_THERM_CK, \"infra_therm\", \"csw_f26m_sel\", 0),\n\tGATE_INFRA1(CLK_INFRA_I2C0_CK, \"infra_i2c0\", \"i2c_bck\", 1),\n\tGATE_INFRA1(CLK_INFRA_UART0_CK, \"infra_uart0\", \"infra_uart0_sel\", 2),\n\tGATE_INFRA1(CLK_INFRA_UART1_CK, \"infra_uart1\", \"infra_uart1_sel\", 3),\n\tGATE_INFRA1(CLK_INFRA_UART2_CK, \"infra_uart2\", \"infra_uart2_sel\", 4),\n\tGATE_INFRA1(CLK_INFRA_SPI2_CK, \"infra_spi2\", \"infra_spi2_sel\", 6),\n\tGATE_INFRA1(CLK_INFRA_SPI2_HCK_CK, \"infra_spi2_hck\", \"infra_66m_mck\", 7),\n\tGATE_INFRA1(CLK_INFRA_NFI1_CK, \"infra_nfi1\", \"nfi1x\", 8),\n\tGATE_INFRA1(CLK_INFRA_SPINFI1_CK, \"infra_spinfi1\", \"spinfi_bck\", 9),\n\tGATE_INFRA1(CLK_INFRA_NFI_HCK_CK, \"infra_nfi_hck\", \"infra_66m_mck\", 10),\n\tGATE_INFRA1(CLK_INFRA_SPI0_CK, \"infra_spi0\", \"infra_spi0_sel\", 11),\n\tGATE_INFRA1(CLK_INFRA_SPI1_CK, \"infra_spi1\", \"infra_spi1_sel\", 12),\n\tGATE_INFRA1(CLK_INFRA_SPI0_HCK_CK, \"infra_spi0_hck\", \"infra_66m_mck\",\n\t\t    13),\n\tGATE_INFRA1(CLK_INFRA_SPI1_HCK_CK, \"infra_spi1_hck\", \"infra_66m_mck\",\n\t\t    14),\n\tGATE_INFRA1(CLK_INFRA_FRTC_CK, \"infra_frtc\", \"cb_rtc_32k\", 15),\n\tGATE_INFRA1(CLK_INFRA_MSDC_CK, \"infra_msdc\", \"emmc_400m\", 16),\n\tGATE_INFRA1(CLK_INFRA_MSDC_HCK_CK, \"infra_msdc_hck\", \"emmc_208m\", 17),\n\tGATE_INFRA1(CLK_INFRA_MSDC_133M_CK, \"infra_msdc_133m\", \"sysaxi\", 18),\n\tGATE_INFRA1(CLK_INFRA_MSDC_66M_CK, \"infra_msdc_66m\", \"sysaxi\", 19),\n\tGATE_INFRA1(CLK_INFRA_ADC_26M_CK, \"infra_adc_26m\", \"infra_adc_frc\", 20),\n\tGATE_INFRA1(CLK_INFRA_ADC_FRC_CK, \"infra_adc_frc\", \"csw_f26m\", 21),\n\tGATE_INFRA1(CLK_INFRA_FBIST2FPC_CK, \"infra_fbist2fpc\", \"nfi1x\", 23),\n\tGATE_INFRA1(CLK_INFRA_I2C_MCK_CK, \"infra_i2c_mck\", \"sysaxi\", 25),\n\tGATE_INFRA1(CLK_INFRA_I2C_PCK_CK, \"infra_i2c_pck\", \"infra_66m_mck\", 26),\n\t \n\tGATE_INFRA2(CLK_INFRA_IUSB_133_CK, \"infra_iusb_133\", \"sysaxi\", 0),\n\tGATE_INFRA2(CLK_INFRA_IUSB_66M_CK, \"infra_iusb_66m\", \"sysaxi\", 1),\n\tGATE_INFRA2(CLK_INFRA_IUSB_SYS_CK, \"infra_iusb_sys\", \"u2u3_sys\", 2),\n\tGATE_INFRA2(CLK_INFRA_IUSB_CK, \"infra_iusb\", \"u2u3_ref\", 3),\n\tGATE_INFRA2(CLK_INFRA_IPCIE_CK, \"infra_ipcie\", \"pextp_tl\", 12),\n\tGATE_INFRA2(CLK_INFRA_IPCIE_PIPE_CK, \"infra_ipcie_pipe\", \"cb_cksq_40m\",\n\t\t    13),\n\tGATE_INFRA2(CLK_INFRA_IPCIER_CK, \"infra_ipcier\", \"csw_f26m\", 14),\n\tGATE_INFRA2(CLK_INFRA_IPCIEB_CK, \"infra_ipcieb\", \"sysaxi\", 15),\n};\n\nstatic const struct mtk_clk_desc infracfg_desc = {\n\t.factor_clks = infra_divs,\n\t.num_factor_clks = ARRAY_SIZE(infra_divs),\n\t.mux_clks = infra_muxes,\n\t.num_mux_clks = ARRAY_SIZE(infra_muxes),\n\t.clks = infra_clks,\n\t.num_clks = ARRAY_SIZE(infra_clks),\n\t.clk_lock = &mt7981_clk_lock,\n};\n\nstatic const struct of_device_id of_match_clk_mt7981_infracfg[] = {\n\t{ .compatible = \"mediatek,mt7981-infracfg\", .data = &infracfg_desc },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, of_match_clk_mt7981_infracfg);\n\nstatic struct platform_driver clk_mt7981_infracfg_drv = {\n\t.probe = mtk_clk_simple_probe,\n\t.remove_new = mtk_clk_simple_remove,\n\t.driver = {\n\t\t.name = \"clk-mt7981-infracfg\",\n\t\t.of_match_table = of_match_clk_mt7981_infracfg,\n\t},\n};\nmodule_platform_driver(clk_mt7981_infracfg_drv);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}