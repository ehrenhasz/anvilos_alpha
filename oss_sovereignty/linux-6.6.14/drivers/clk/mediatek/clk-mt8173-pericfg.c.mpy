{
  "module_name": "clk-mt8173-pericfg.c",
  "hash_id": "620a08883f9819495acdc23d0ba279eb19f6596f2d8fa6c76d83e53962944287",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mediatek/clk-mt8173-pericfg.c",
  "human_readable_source": "\n \n\n#include <dt-bindings/clock/mt8173-clk.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include \"clk-gate.h\"\n#include \"clk-mtk.h\"\n#include \"reset.h\"\n\n#define GATE_PERI0(_id, _name, _parent, _shift)\t\t\t\\\n\t\tGATE_MTK(_id, _name, _parent, &peri0_cg_regs,\t\\\n\t\t\t _shift, &mtk_clk_gate_ops_setclr)\n\n#define GATE_PERI1(_id, _name, _parent, _shift)\t\t\t\\\n\t\tGATE_MTK(_id, _name, _parent, &peri1_cg_regs,\t\\\n\t\t\t _shift, &mtk_clk_gate_ops_setclr)\n\nstatic DEFINE_SPINLOCK(mt8173_clk_lock);\n\nstatic const struct mtk_gate_regs peri0_cg_regs = {\n\t.set_ofs = 0x0008,\n\t.clr_ofs = 0x0010,\n\t.sta_ofs = 0x0018,\n};\n\nstatic const struct mtk_gate_regs peri1_cg_regs = {\n\t.set_ofs = 0x000c,\n\t.clr_ofs = 0x0014,\n\t.sta_ofs = 0x001c,\n};\n\nstatic const char * const uart_ck_sel_parents[] = {\n\t\"clk26m\",\n\t\"uart_sel\",\n};\n\nstatic const struct mtk_composite peri_clks[] = {\n\tMUX(CLK_PERI_UART0_SEL, \"uart0_ck_sel\", uart_ck_sel_parents, 0x40c, 0, 1),\n\tMUX(CLK_PERI_UART1_SEL, \"uart1_ck_sel\", uart_ck_sel_parents, 0x40c, 1, 1),\n\tMUX(CLK_PERI_UART2_SEL, \"uart2_ck_sel\", uart_ck_sel_parents, 0x40c, 2, 1),\n\tMUX(CLK_PERI_UART3_SEL, \"uart3_ck_sel\", uart_ck_sel_parents, 0x40c, 3, 1),\n};\n\nstatic const struct mtk_gate peri_gates[] = {\n\tGATE_DUMMY(CLK_DUMMY, \"peri_gate_dummy\"),\n\t \n\tGATE_PERI0(CLK_PERI_NFI, \"peri_nfi\", \"axi_sel\", 0),\n\tGATE_PERI0(CLK_PERI_THERM, \"peri_therm\", \"axi_sel\", 1),\n\tGATE_PERI0(CLK_PERI_PWM1, \"peri_pwm1\", \"axi_sel\", 2),\n\tGATE_PERI0(CLK_PERI_PWM2, \"peri_pwm2\", \"axi_sel\", 3),\n\tGATE_PERI0(CLK_PERI_PWM3, \"peri_pwm3\", \"axi_sel\", 4),\n\tGATE_PERI0(CLK_PERI_PWM4, \"peri_pwm4\", \"axi_sel\", 5),\n\tGATE_PERI0(CLK_PERI_PWM5, \"peri_pwm5\", \"axi_sel\", 6),\n\tGATE_PERI0(CLK_PERI_PWM6, \"peri_pwm6\", \"axi_sel\", 7),\n\tGATE_PERI0(CLK_PERI_PWM7, \"peri_pwm7\", \"axi_sel\", 8),\n\tGATE_PERI0(CLK_PERI_PWM, \"peri_pwm\", \"axi_sel\", 9),\n\tGATE_PERI0(CLK_PERI_USB0, \"peri_usb0\", \"usb20_sel\", 10),\n\tGATE_PERI0(CLK_PERI_USB1, \"peri_usb1\", \"usb20_sel\", 11),\n\tGATE_PERI0(CLK_PERI_AP_DMA, \"peri_ap_dma\", \"axi_sel\", 12),\n\tGATE_PERI0(CLK_PERI_MSDC30_0, \"peri_msdc30_0\", \"msdc50_0_sel\", 13),\n\tGATE_PERI0(CLK_PERI_MSDC30_1, \"peri_msdc30_1\", \"msdc30_1_sel\", 14),\n\tGATE_PERI0(CLK_PERI_MSDC30_2, \"peri_msdc30_2\", \"msdc30_2_sel\", 15),\n\tGATE_PERI0(CLK_PERI_MSDC30_3, \"peri_msdc30_3\", \"msdc30_3_sel\", 16),\n\tGATE_PERI0(CLK_PERI_NLI_ARB, \"peri_nli_arb\", \"axi_sel\", 17),\n\tGATE_PERI0(CLK_PERI_IRDA, \"peri_irda\", \"irda_sel\", 18),\n\tGATE_PERI0(CLK_PERI_UART0, \"peri_uart0\", \"axi_sel\", 19),\n\tGATE_PERI0(CLK_PERI_UART1, \"peri_uart1\", \"axi_sel\", 20),\n\tGATE_PERI0(CLK_PERI_UART2, \"peri_uart2\", \"axi_sel\", 21),\n\tGATE_PERI0(CLK_PERI_UART3, \"peri_uart3\", \"axi_sel\", 22),\n\tGATE_PERI0(CLK_PERI_I2C0, \"peri_i2c0\", \"axi_sel\", 23),\n\tGATE_PERI0(CLK_PERI_I2C1, \"peri_i2c1\", \"axi_sel\", 24),\n\tGATE_PERI0(CLK_PERI_I2C2, \"peri_i2c2\", \"axi_sel\", 25),\n\tGATE_PERI0(CLK_PERI_I2C3, \"peri_i2c3\", \"axi_sel\", 26),\n\tGATE_PERI0(CLK_PERI_I2C4, \"peri_i2c4\", \"axi_sel\", 27),\n\tGATE_PERI0(CLK_PERI_AUXADC, \"peri_auxadc\", \"clk26m\", 28),\n\tGATE_PERI0(CLK_PERI_SPI0, \"peri_spi0\", \"spi_sel\", 29),\n\tGATE_PERI0(CLK_PERI_I2C5, \"peri_i2c5\", \"axi_sel\", 30),\n\tGATE_PERI0(CLK_PERI_NFIECC, \"peri_nfiecc\", \"axi_sel\", 31),\n\t \n\tGATE_PERI1(CLK_PERI_SPI, \"peri_spi\", \"spi_sel\", 0),\n\tGATE_PERI1(CLK_PERI_IRRX, \"peri_irrx\", \"spi_sel\", 1),\n\tGATE_PERI1(CLK_PERI_I2C6, \"peri_i2c6\", \"axi_sel\", 2),\n};\n\nstatic u16 pericfg_rst_ofs[] = { 0x0, 0x4 };\n\nstatic const struct mtk_clk_rst_desc clk_rst_desc = {\n\t.version = MTK_RST_SIMPLE,\n\t.rst_bank_ofs = pericfg_rst_ofs,\n\t.rst_bank_nr = ARRAY_SIZE(pericfg_rst_ofs),\n};\n\nstatic const struct mtk_clk_desc peri_desc = {\n\t.clks = peri_gates,\n\t.num_clks = ARRAY_SIZE(peri_gates),\n\t.composite_clks = peri_clks,\n\t.num_composite_clks = ARRAY_SIZE(peri_clks),\n\t.clk_lock = &mt8173_clk_lock,\n\t.rst_desc = &clk_rst_desc,\n};\n\nstatic const struct of_device_id of_match_clk_mt8173_pericfg[] = {\n\t{ .compatible = \"mediatek,mt8173-pericfg\", .data = &peri_desc },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, of_match_clk_mt8173_pericfg);\n\nstatic struct platform_driver clk_mt8173_pericfg_drv = {\n\t.driver = {\n\t\t.name = \"clk-mt8173-pericfg\",\n\t\t.of_match_table = of_match_clk_mt8173_pericfg,\n\t},\n\t.probe = mtk_clk_simple_probe,\n\t.remove_new = mtk_clk_simple_remove,\n};\nmodule_platform_driver(clk_mt8173_pericfg_drv);\n\nMODULE_DESCRIPTION(\"MediaTek MT8173 pericfg clocks driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}