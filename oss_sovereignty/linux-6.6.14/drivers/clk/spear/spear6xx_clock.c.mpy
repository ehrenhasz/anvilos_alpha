{
  "module_name": "spear6xx_clock.c",
  "hash_id": "6778c37440872565f5c6d10bc3d11389ab4342337766e8213ef914d8ca0986ce",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/spear/spear6xx_clock.c",
  "human_readable_source": "\n \n\n#include <linux/clkdev.h>\n#include <linux/clk/spear.h>\n#include <linux/io.h>\n#include <linux/spinlock_types.h>\n#include \"clk.h\"\n\nstatic DEFINE_SPINLOCK(_lock);\n\n#define PLL1_CTR\t\t\t(misc_base + 0x008)\n#define PLL1_FRQ\t\t\t(misc_base + 0x00C)\n#define PLL2_CTR\t\t\t(misc_base + 0x014)\n#define PLL2_FRQ\t\t\t(misc_base + 0x018)\n#define PLL_CLK_CFG\t\t\t(misc_base + 0x020)\n\t \n\t#define MCTR_CLK_SHIFT\t\t28\n\t#define MCTR_CLK_MASK\t\t3\n\n#define CORE_CLK_CFG\t\t\t(misc_base + 0x024)\n\t \n\t#define HCLK_RATIO_SHIFT\t10\n\t#define HCLK_RATIO_MASK\t\t2\n\t#define PCLK_RATIO_SHIFT\t8\n\t#define PCLK_RATIO_MASK\t\t2\n\n#define PERIP_CLK_CFG\t\t\t(misc_base + 0x028)\n\t \n\t#define CLCD_CLK_SHIFT\t\t2\n\t#define CLCD_CLK_MASK\t\t2\n\t#define UART_CLK_SHIFT\t\t4\n\t#define UART_CLK_MASK\t\t1\n\t#define FIRDA_CLK_SHIFT\t\t5\n\t#define FIRDA_CLK_MASK\t\t2\n\t#define GPT0_CLK_SHIFT\t\t8\n\t#define GPT1_CLK_SHIFT\t\t10\n\t#define GPT2_CLK_SHIFT\t\t11\n\t#define GPT3_CLK_SHIFT\t\t12\n\t#define GPT_CLK_MASK\t\t1\n\n#define PERIP1_CLK_ENB\t\t\t(misc_base + 0x02C)\n\t \n\t#define UART0_CLK_ENB\t\t3\n\t#define UART1_CLK_ENB\t\t4\n\t#define SSP0_CLK_ENB\t\t5\n\t#define SSP1_CLK_ENB\t\t6\n\t#define I2C_CLK_ENB\t\t7\n\t#define JPEG_CLK_ENB\t\t8\n\t#define FSMC_CLK_ENB\t\t9\n\t#define FIRDA_CLK_ENB\t\t10\n\t#define GPT2_CLK_ENB\t\t11\n\t#define GPT3_CLK_ENB\t\t12\n\t#define GPIO2_CLK_ENB\t\t13\n\t#define SSP2_CLK_ENB\t\t14\n\t#define ADC_CLK_ENB\t\t15\n\t#define GPT1_CLK_ENB\t\t11\n\t#define RTC_CLK_ENB\t\t17\n\t#define GPIO1_CLK_ENB\t\t18\n\t#define DMA_CLK_ENB\t\t19\n\t#define SMI_CLK_ENB\t\t21\n\t#define CLCD_CLK_ENB\t\t22\n\t#define GMAC_CLK_ENB\t\t23\n\t#define USBD_CLK_ENB\t\t24\n\t#define USBH0_CLK_ENB\t\t25\n\t#define USBH1_CLK_ENB\t\t26\n\n#define PRSC0_CLK_CFG\t\t\t(misc_base + 0x044)\n#define PRSC1_CLK_CFG\t\t\t(misc_base + 0x048)\n#define PRSC2_CLK_CFG\t\t\t(misc_base + 0x04C)\n\n#define CLCD_CLK_SYNT\t\t\t(misc_base + 0x05C)\n#define FIRDA_CLK_SYNT\t\t\t(misc_base + 0x060)\n#define UART_CLK_SYNT\t\t\t(misc_base + 0x064)\n\n \nstatic struct pll_rate_tbl pll_rtbl[] = {\n\t{.mode = 0, .m = 0x53, .n = 0x0F, .p = 0x1},  \n\t{.mode = 0, .m = 0x85, .n = 0x0F, .p = 0x1},  \n\t{.mode = 0, .m = 0xA6, .n = 0x0F, .p = 0x1},  \n};\n\n \nstatic struct aux_rate_tbl aux_rtbl[] = {\n\t \n\t{.xscale = 2, .yscale = 27, .eq = 0},  \n\t{.xscale = 2, .yscale = 8, .eq = 0},  \n\t{.xscale = 2, .yscale = 4, .eq = 0},  \n\t{.xscale = 1, .yscale = 2, .eq = 1},  \n};\n\nstatic const char *clcd_parents[] = { \"pll3_clk\", \"clcd_syn_gclk\", };\nstatic const char *firda_parents[] = { \"pll3_clk\", \"firda_syn_gclk\", };\nstatic const char *uart_parents[] = { \"pll3_clk\", \"uart_syn_gclk\", };\nstatic const char *gpt0_1_parents[] = { \"pll3_clk\", \"gpt0_1_syn_clk\", };\nstatic const char *gpt2_parents[] = { \"pll3_clk\", \"gpt2_syn_clk\", };\nstatic const char *gpt3_parents[] = { \"pll3_clk\", \"gpt3_syn_clk\", };\nstatic const char *ddr_parents[] = { \"ahb_clk\", \"ahbmult2_clk\", \"none\",\n\t\"pll2_clk\", };\n\n \nstatic struct gpt_rate_tbl gpt_rtbl[] = {\n\t \n\t{.mscale = 4, .nscale = 0},  \n\t{.mscale = 2, .nscale = 0},  \n\t{.mscale = 1, .nscale = 0},  \n};\n\nvoid __init spear6xx_clk_init(void __iomem *misc_base)\n{\n\tstruct clk *clk, *clk1;\n\n\tclk = clk_register_fixed_rate(NULL, \"osc_32k_clk\", NULL, 0, 32000);\n\tclk_register_clkdev(clk, \"osc_32k_clk\", NULL);\n\n\tclk = clk_register_fixed_rate(NULL, \"osc_30m_clk\", NULL, 0, 30000000);\n\tclk_register_clkdev(clk, \"osc_30m_clk\", NULL);\n\n\t \n\tclk = clk_register_gate(NULL, \"rtc_spear\", \"osc_32k_clk\", 0,\n\t\t\tPERIP1_CLK_ENB, RTC_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"rtc-spear\");\n\n\t \n\tclk = clk_register_fixed_rate(NULL, \"pll3_clk\", \"osc_24m_clk\", 0,\n\t\t\t48000000);\n\tclk_register_clkdev(clk, \"pll3_clk\", NULL);\n\n\tclk = clk_register_vco_pll(\"vco1_clk\", \"pll1_clk\", NULL, \"osc_30m_clk\",\n\t\t\t0, PLL1_CTR, PLL1_FRQ, pll_rtbl, ARRAY_SIZE(pll_rtbl),\n\t\t\t&_lock, &clk1, NULL);\n\tclk_register_clkdev(clk, \"vco1_clk\", NULL);\n\tclk_register_clkdev(clk1, \"pll1_clk\", NULL);\n\n\tclk = clk_register_vco_pll(\"vco2_clk\", \"pll2_clk\", NULL, \"osc_30m_clk\",\n\t\t\t0, PLL2_CTR, PLL2_FRQ, pll_rtbl, ARRAY_SIZE(pll_rtbl),\n\t\t\t&_lock, &clk1, NULL);\n\tclk_register_clkdev(clk, \"vco2_clk\", NULL);\n\tclk_register_clkdev(clk1, \"pll2_clk\", NULL);\n\n\tclk = clk_register_fixed_factor(NULL, \"wdt_clk\", \"osc_30m_clk\", 0, 1,\n\t\t\t1);\n\tclk_register_clkdev(clk, NULL, \"fc880000.wdt\");\n\n\t \n\tclk = clk_register_fixed_factor(NULL, \"cpu_clk\", \"pll1_clk\",\n\t\t\tCLK_SET_RATE_PARENT, 1, 1);\n\tclk_register_clkdev(clk, \"cpu_clk\", NULL);\n\n\tclk = clk_register_divider(NULL, \"ahb_clk\", \"pll1_clk\",\n\t\t\tCLK_SET_RATE_PARENT, CORE_CLK_CFG, HCLK_RATIO_SHIFT,\n\t\t\tHCLK_RATIO_MASK, 0, &_lock);\n\tclk_register_clkdev(clk, \"ahb_clk\", NULL);\n\n\tclk = clk_register_aux(\"uart_syn_clk\", \"uart_syn_gclk\", \"pll1_clk\", 0,\n\t\t\tUART_CLK_SYNT, NULL, aux_rtbl, ARRAY_SIZE(aux_rtbl),\n\t\t\t&_lock, &clk1);\n\tclk_register_clkdev(clk, \"uart_syn_clk\", NULL);\n\tclk_register_clkdev(clk1, \"uart_syn_gclk\", NULL);\n\n\tclk = clk_register_mux(NULL, \"uart_mclk\", uart_parents,\n\t\t\tARRAY_SIZE(uart_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPERIP_CLK_CFG, UART_CLK_SHIFT, UART_CLK_MASK, 0,\n\t\t\t&_lock);\n\tclk_register_clkdev(clk, \"uart_mclk\", NULL);\n\n\tclk = clk_register_gate(NULL, \"uart0\", \"uart_mclk\", 0, PERIP1_CLK_ENB,\n\t\t\tUART0_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d0000000.serial\");\n\n\tclk = clk_register_gate(NULL, \"uart1\", \"uart_mclk\", 0, PERIP1_CLK_ENB,\n\t\t\tUART1_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d0080000.serial\");\n\n\tclk = clk_register_aux(\"firda_syn_clk\", \"firda_syn_gclk\", \"pll1_clk\",\n\t\t\t0, FIRDA_CLK_SYNT, NULL, aux_rtbl, ARRAY_SIZE(aux_rtbl),\n\t\t\t&_lock, &clk1);\n\tclk_register_clkdev(clk, \"firda_syn_clk\", NULL);\n\tclk_register_clkdev(clk1, \"firda_syn_gclk\", NULL);\n\n\tclk = clk_register_mux(NULL, \"firda_mclk\", firda_parents,\n\t\t\tARRAY_SIZE(firda_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPERIP_CLK_CFG, FIRDA_CLK_SHIFT, FIRDA_CLK_MASK, 0,\n\t\t\t&_lock);\n\tclk_register_clkdev(clk, \"firda_mclk\", NULL);\n\n\tclk = clk_register_gate(NULL, \"firda_clk\", \"firda_mclk\", 0,\n\t\t\tPERIP1_CLK_ENB, FIRDA_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"firda\");\n\n\tclk = clk_register_aux(\"clcd_syn_clk\", \"clcd_syn_gclk\", \"pll1_clk\",\n\t\t\t0, CLCD_CLK_SYNT, NULL, aux_rtbl, ARRAY_SIZE(aux_rtbl),\n\t\t\t&_lock, &clk1);\n\tclk_register_clkdev(clk, \"clcd_syn_clk\", NULL);\n\tclk_register_clkdev(clk1, \"clcd_syn_gclk\", NULL);\n\n\tclk = clk_register_mux(NULL, \"clcd_mclk\", clcd_parents,\n\t\t\tARRAY_SIZE(clcd_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPERIP_CLK_CFG, CLCD_CLK_SHIFT, CLCD_CLK_MASK, 0,\n\t\t\t&_lock);\n\tclk_register_clkdev(clk, \"clcd_mclk\", NULL);\n\n\tclk = clk_register_gate(NULL, \"clcd_clk\", \"clcd_mclk\", 0,\n\t\t\tPERIP1_CLK_ENB, CLCD_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"fc200000.clcd\");\n\n\t \n\tclk = clk_register_gpt(\"gpt0_1_syn_clk\", \"pll1_clk\", 0, PRSC0_CLK_CFG,\n\t\t\tgpt_rtbl, ARRAY_SIZE(gpt_rtbl), &_lock);\n\tclk_register_clkdev(clk, \"gpt0_1_syn_clk\", NULL);\n\n\tclk = clk_register_mux(NULL, \"gpt0_mclk\", gpt0_1_parents,\n\t\t\tARRAY_SIZE(gpt0_1_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPERIP_CLK_CFG, GPT0_CLK_SHIFT, GPT_CLK_MASK, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"gpt0\");\n\n\tclk = clk_register_mux(NULL, \"gpt1_mclk\", gpt0_1_parents,\n\t\t\tARRAY_SIZE(gpt0_1_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPERIP_CLK_CFG, GPT1_CLK_SHIFT, GPT_CLK_MASK, 0, &_lock);\n\tclk_register_clkdev(clk, \"gpt1_mclk\", NULL);\n\n\tclk = clk_register_gate(NULL, \"gpt1_clk\", \"gpt1_mclk\", 0,\n\t\t\tPERIP1_CLK_ENB, GPT1_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"gpt1\");\n\n\tclk = clk_register_gpt(\"gpt2_syn_clk\", \"pll1_clk\", 0, PRSC1_CLK_CFG,\n\t\t\tgpt_rtbl, ARRAY_SIZE(gpt_rtbl), &_lock);\n\tclk_register_clkdev(clk, \"gpt2_syn_clk\", NULL);\n\n\tclk = clk_register_mux(NULL, \"gpt2_mclk\", gpt2_parents,\n\t\t\tARRAY_SIZE(gpt2_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPERIP_CLK_CFG, GPT2_CLK_SHIFT, GPT_CLK_MASK, 0, &_lock);\n\tclk_register_clkdev(clk, \"gpt2_mclk\", NULL);\n\n\tclk = clk_register_gate(NULL, \"gpt2_clk\", \"gpt2_mclk\", 0,\n\t\t\tPERIP1_CLK_ENB, GPT2_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"gpt2\");\n\n\tclk = clk_register_gpt(\"gpt3_syn_clk\", \"pll1_clk\", 0, PRSC2_CLK_CFG,\n\t\t\tgpt_rtbl, ARRAY_SIZE(gpt_rtbl), &_lock);\n\tclk_register_clkdev(clk, \"gpt3_syn_clk\", NULL);\n\n\tclk = clk_register_mux(NULL, \"gpt3_mclk\", gpt3_parents,\n\t\t\tARRAY_SIZE(gpt3_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPERIP_CLK_CFG, GPT3_CLK_SHIFT, GPT_CLK_MASK, 0, &_lock);\n\tclk_register_clkdev(clk, \"gpt3_mclk\", NULL);\n\n\tclk = clk_register_gate(NULL, \"gpt3_clk\", \"gpt3_mclk\", 0,\n\t\t\tPERIP1_CLK_ENB, GPT3_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"gpt3\");\n\n\t \n\tclk = clk_register_gate(NULL, \"usbh0_clk\", \"pll3_clk\", 0,\n\t\t\tPERIP1_CLK_ENB, USBH0_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"e1800000.ehci\");\n\tclk_register_clkdev(clk, NULL, \"e1900000.ohci\");\n\n\tclk = clk_register_gate(NULL, \"usbh1_clk\", \"pll3_clk\", 0,\n\t\t\tPERIP1_CLK_ENB, USBH1_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"e2000000.ehci\");\n\tclk_register_clkdev(clk, NULL, \"e2100000.ohci\");\n\n\tclk = clk_register_gate(NULL, \"usbd_clk\", \"pll3_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tUSBD_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"designware_udc\");\n\n\t \n\tclk = clk_register_fixed_factor(NULL, \"ahbmult2_clk\", \"ahb_clk\", 0, 2,\n\t\t\t1);\n\tclk_register_clkdev(clk, \"ahbmult2_clk\", NULL);\n\n\tclk = clk_register_mux(NULL, \"ddr_clk\", ddr_parents,\n\t\t\tARRAY_SIZE(ddr_parents), CLK_SET_RATE_NO_REPARENT,\n\t\t\tPLL_CLK_CFG, MCTR_CLK_SHIFT, MCTR_CLK_MASK, 0, &_lock);\n\tclk_register_clkdev(clk, \"ddr_clk\", NULL);\n\n\tclk = clk_register_divider(NULL, \"apb_clk\", \"ahb_clk\",\n\t\t\tCLK_SET_RATE_PARENT, CORE_CLK_CFG, PCLK_RATIO_SHIFT,\n\t\t\tPCLK_RATIO_MASK, 0, &_lock);\n\tclk_register_clkdev(clk, \"apb_clk\", NULL);\n\n\tclk = clk_register_gate(NULL, \"dma_clk\", \"ahb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tDMA_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"fc400000.dma\");\n\n\tclk = clk_register_gate(NULL, \"fsmc_clk\", \"ahb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tFSMC_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d1800000.flash\");\n\n\tclk = clk_register_gate(NULL, \"gmac_clk\", \"ahb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tGMAC_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"e0800000.ethernet\");\n\n\tclk = clk_register_gate(NULL, \"i2c_clk\", \"ahb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tI2C_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d0200000.i2c\");\n\n\tclk = clk_register_gate(NULL, \"jpeg_clk\", \"ahb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tJPEG_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"jpeg\");\n\n\tclk = clk_register_gate(NULL, \"smi_clk\", \"ahb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tSMI_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"fc000000.flash\");\n\n\t \n\tclk = clk_register_gate(NULL, \"adc_clk\", \"apb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tADC_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d820b000.adc\");\n\n\tclk = clk_register_fixed_factor(NULL, \"gpio0_clk\", \"apb_clk\", 0, 1, 1);\n\tclk_register_clkdev(clk, NULL, \"f0100000.gpio\");\n\n\tclk = clk_register_gate(NULL, \"gpio1_clk\", \"apb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tGPIO1_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"fc980000.gpio\");\n\n\tclk = clk_register_gate(NULL, \"gpio2_clk\", \"apb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tGPIO2_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d8100000.gpio\");\n\n\tclk = clk_register_gate(NULL, \"ssp0_clk\", \"apb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tSSP0_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d0100000.spi\");\n\n\tclk = clk_register_gate(NULL, \"ssp1_clk\", \"apb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tSSP1_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d0180000.spi\");\n\n\tclk = clk_register_gate(NULL, \"ssp2_clk\", \"apb_clk\", 0, PERIP1_CLK_ENB,\n\t\t\tSSP2_CLK_ENB, 0, &_lock);\n\tclk_register_clkdev(clk, NULL, \"d8180000.spi\");\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}