{
  "module_name": "clk-bcm2835-aux.c",
  "hash_id": "53d07690b87468da7b3711021c8bf7e72fb7a82efd13eba75ece380b42d6ff12",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/bcm/clk-bcm2835-aux.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <dt-bindings/clock/bcm2835-aux.h>\n\n#define BCM2835_AUXIRQ\t\t0x00\n#define BCM2835_AUXENB\t\t0x04\n\nstatic int bcm2835_aux_clk_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct clk_hw_onecell_data *onecell;\n\tconst char *parent;\n\tstruct clk *parent_clk;\n\tvoid __iomem *reg, *gate;\n\n\tparent_clk = devm_clk_get(dev, NULL);\n\tif (IS_ERR(parent_clk))\n\t\treturn PTR_ERR(parent_clk);\n\tparent = __clk_get_name(parent_clk);\n\n\treg = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\tonecell = devm_kmalloc(dev,\n\t\t\t       struct_size(onecell, hws,\n\t\t\t\t\t   BCM2835_AUX_CLOCK_COUNT),\n\t\t\t       GFP_KERNEL);\n\tif (!onecell)\n\t\treturn -ENOMEM;\n\tonecell->num = BCM2835_AUX_CLOCK_COUNT;\n\n\tgate = reg + BCM2835_AUXENB;\n\tonecell->hws[BCM2835_AUX_CLOCK_UART] =\n\t\tclk_hw_register_gate(dev, \"aux_uart\", parent, 0, gate, 0, 0, NULL);\n\n\tonecell->hws[BCM2835_AUX_CLOCK_SPI1] =\n\t\tclk_hw_register_gate(dev, \"aux_spi1\", parent, 0, gate, 1, 0, NULL);\n\n\tonecell->hws[BCM2835_AUX_CLOCK_SPI2] =\n\t\tclk_hw_register_gate(dev, \"aux_spi2\", parent, 0, gate, 2, 0, NULL);\n\n\treturn of_clk_add_hw_provider(pdev->dev.of_node, of_clk_hw_onecell_get,\n\t\t\t\t      onecell);\n}\n\nstatic const struct of_device_id bcm2835_aux_clk_of_match[] = {\n\t{ .compatible = \"brcm,bcm2835-aux\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, bcm2835_aux_clk_of_match);\n\nstatic struct platform_driver bcm2835_aux_clk_driver = {\n\t.driver = {\n\t\t.name = \"bcm2835-aux-clk\",\n\t\t.of_match_table = bcm2835_aux_clk_of_match,\n\t},\n\t.probe          = bcm2835_aux_clk_probe,\n};\nbuiltin_platform_driver(bcm2835_aux_clk_driver);\n\nMODULE_AUTHOR(\"Eric Anholt <eric@anholt.net>\");\nMODULE_DESCRIPTION(\"BCM2835 auxiliary peripheral clock driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}