{
  "module_name": "clk-nsp.c",
  "hash_id": "102cc023e8d6deb6b5900f625c84a453ae1bcbe66c48aad9e394053aebbe1ead",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/bcm/clk-nsp.c",
  "human_readable_source": "\n\n\n#include <linux/kernel.h>\n#include <linux/err.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n\n#include <dt-bindings/clock/bcm-nsp.h>\n#include \"clk-iproc.h\"\n\n#define REG_VAL(o, s, w) { .offset = o, .shift = s, .width = w, }\n\n#define AON_VAL(o, pw, ps, is) { .offset = o, .pwr_width = pw, \\\n\t.pwr_shift = ps, .iso_shift = is }\n\n#define RESET_VAL(o, rs, prs) { .offset = o, .reset_shift = rs, \\\n\t.p_reset_shift = prs }\n\n#define DF_VAL(o, kis, kiw, kps, kpw, kas, kaw) { .offset = o, .ki_shift = kis,\\\n\t.ki_width = kiw, .kp_shift = kps, .kp_width = kpw, .ka_shift = kas,    \\\n\t.ka_width = kaw }\n\n#define ENABLE_VAL(o, es, hs, bs) { .offset = o, .enable_shift = es, \\\n\t.hold_shift = hs, .bypass_shift = bs }\n\nstatic void __init nsp_armpll_init(struct device_node *node)\n{\n\tiproc_armpll_setup(node);\n}\nCLK_OF_DECLARE(nsp_armpll, \"brcm,nsp-armpll\", nsp_armpll_init);\n\nstatic const struct iproc_pll_ctrl genpll = {\n\t.flags = IPROC_CLK_PLL_HAS_NDIV_FRAC | IPROC_CLK_EMBED_PWRCTRL,\n\t.aon = AON_VAL(0x0, 1, 12, 0),\n\t.reset = RESET_VAL(0x0, 11, 10),\n\t.dig_filter = DF_VAL(0x0, 4, 3, 0, 4, 7, 3),\n\t.ndiv_int = REG_VAL(0x14, 20, 10),\n\t.ndiv_frac = REG_VAL(0x14, 0, 20),\n\t.pdiv = REG_VAL(0x18, 24, 3),\n\t.status = REG_VAL(0x20, 12, 1),\n};\n\nstatic const struct iproc_clk_ctrl genpll_clk[] = {\n\t[BCM_NSP_GENPLL_PHY_CLK] = {\n\t\t.channel = BCM_NSP_GENPLL_PHY_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x4, 12, 6, 18),\n\t\t.mdiv = REG_VAL(0x18, 16, 8),\n\t},\n\t[BCM_NSP_GENPLL_ENET_SW_CLK] = {\n\t\t.channel = BCM_NSP_GENPLL_ENET_SW_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x4, 13, 7, 19),\n\t\t.mdiv = REG_VAL(0x18, 8, 8),\n\t},\n\t[BCM_NSP_GENPLL_USB_PHY_REF_CLK] = {\n\t\t.channel = BCM_NSP_GENPLL_USB_PHY_REF_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x4, 14, 8, 20),\n\t\t.mdiv = REG_VAL(0x18, 0, 8),\n\t},\n\t[BCM_NSP_GENPLL_IPROCFAST_CLK] = {\n\t\t.channel = BCM_NSP_GENPLL_IPROCFAST_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x4, 15, 9, 21),\n\t\t.mdiv = REG_VAL(0x1c, 16, 8),\n\t},\n\t[BCM_NSP_GENPLL_SATA1_CLK] = {\n\t\t.channel = BCM_NSP_GENPLL_SATA1_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x4, 16, 10, 22),\n\t\t.mdiv = REG_VAL(0x1c, 8, 8),\n\t},\n\t[BCM_NSP_GENPLL_SATA2_CLK] = {\n\t\t.channel = BCM_NSP_GENPLL_SATA2_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x4, 17, 11, 23),\n\t\t.mdiv = REG_VAL(0x1c, 0, 8),\n\t},\n};\n\nstatic void __init nsp_genpll_clk_init(struct device_node *node)\n{\n\tiproc_pll_clk_setup(node, &genpll, NULL, 0, genpll_clk,\n\t\t\t    ARRAY_SIZE(genpll_clk));\n}\nCLK_OF_DECLARE(nsp_genpll_clk, \"brcm,nsp-genpll\", nsp_genpll_clk_init);\n\nstatic const struct iproc_pll_ctrl lcpll0 = {\n\t.flags = IPROC_CLK_PLL_HAS_NDIV_FRAC | IPROC_CLK_EMBED_PWRCTRL,\n\t.aon = AON_VAL(0x0, 1, 24, 0),\n\t.reset = RESET_VAL(0x0, 23, 22),\n\t.dig_filter = DF_VAL(0x0, 16, 3, 12, 4, 19, 4),\n\t.ndiv_int = REG_VAL(0x4, 20, 8),\n\t.ndiv_frac = REG_VAL(0x4, 0, 20),\n\t.pdiv = REG_VAL(0x4, 28, 3),\n\t.status = REG_VAL(0x10, 12, 1),\n};\n\nstatic const struct iproc_clk_ctrl lcpll0_clk[] = {\n\t[BCM_NSP_LCPLL0_PCIE_PHY_REF_CLK] = {\n\t\t.channel = BCM_NSP_LCPLL0_PCIE_PHY_REF_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 6, 3, 9),\n\t\t.mdiv = REG_VAL(0x8, 24, 8),\n\t},\n\t[BCM_NSP_LCPLL0_SDIO_CLK] = {\n\t\t.channel = BCM_NSP_LCPLL0_SDIO_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 7, 4, 10),\n\t\t.mdiv = REG_VAL(0x8, 16, 8),\n\t},\n\t[BCM_NSP_LCPLL0_DDR_PHY_CLK] = {\n\t\t.channel = BCM_NSP_LCPLL0_DDR_PHY_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 8, 5, 11),\n\t\t.mdiv = REG_VAL(0x8, 8, 8),\n\t},\n};\n\nstatic void __init nsp_lcpll0_clk_init(struct device_node *node)\n{\n\tiproc_pll_clk_setup(node, &lcpll0, NULL, 0, lcpll0_clk,\n\t\t\t    ARRAY_SIZE(lcpll0_clk));\n}\nCLK_OF_DECLARE(nsp_lcpll0_clk, \"brcm,nsp-lcpll0\", nsp_lcpll0_clk_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}