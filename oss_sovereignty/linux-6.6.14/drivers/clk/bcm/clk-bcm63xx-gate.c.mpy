{
  "module_name": "clk-bcm63xx-gate.c",
  "hash_id": "732f7f44ae589a1f33e7a7deecf3360acd0682cd8532aabeb099333b4e9e8424",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/bcm/clk-bcm63xx-gate.c",
  "human_readable_source": "\n\n#include <linux/clk-provider.h>\n#include <linux/init.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n\n#include <dt-bindings/clock/bcm3368-clock.h>\n#include <dt-bindings/clock/bcm6318-clock.h>\n#include <dt-bindings/clock/bcm6328-clock.h>\n#include <dt-bindings/clock/bcm6358-clock.h>\n#include <dt-bindings/clock/bcm6362-clock.h>\n#include <dt-bindings/clock/bcm6368-clock.h>\n#include <dt-bindings/clock/bcm63268-clock.h>\n\nstruct clk_bcm63xx_table_entry {\n\tconst char * const name;\n\tu8 bit;\n\tunsigned long flags;\n};\n\nstruct clk_bcm63xx_hw {\n\tvoid __iomem *regs;\n\tspinlock_t lock;\n\n\tstruct clk_hw_onecell_data data;\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm3368_clocks[] = {\n\t{\n\t\t.name = \"mac\",\n\t\t.bit = BCM3368_CLK_MAC,\n\t}, {\n\t\t.name = \"tc\",\n\t\t.bit = BCM3368_CLK_TC,\n\t}, {\n\t\t.name = \"us_top\",\n\t\t.bit = BCM3368_CLK_US_TOP,\n\t}, {\n\t\t.name = \"ds_top\",\n\t\t.bit = BCM3368_CLK_DS_TOP,\n\t}, {\n\t\t.name = \"acm\",\n\t\t.bit = BCM3368_CLK_ACM,\n\t}, {\n\t\t.name = \"spi\",\n\t\t.bit = BCM3368_CLK_SPI,\n\t}, {\n\t\t.name = \"usbs\",\n\t\t.bit = BCM3368_CLK_USBS,\n\t}, {\n\t\t.name = \"bmu\",\n\t\t.bit = BCM3368_CLK_BMU,\n\t}, {\n\t\t.name = \"pcm\",\n\t\t.bit = BCM3368_CLK_PCM,\n\t}, {\n\t\t.name = \"ntp\",\n\t\t.bit = BCM3368_CLK_NTP,\n\t}, {\n\t\t.name = \"acp_b\",\n\t\t.bit = BCM3368_CLK_ACP_B,\n\t}, {\n\t\t.name = \"acp_a\",\n\t\t.bit = BCM3368_CLK_ACP_A,\n\t}, {\n\t\t.name = \"emusb\",\n\t\t.bit = BCM3368_CLK_EMUSB,\n\t}, {\n\t\t.name = \"enet0\",\n\t\t.bit = BCM3368_CLK_ENET0,\n\t}, {\n\t\t.name = \"enet1\",\n\t\t.bit = BCM3368_CLK_ENET1,\n\t}, {\n\t\t.name = \"usbsu\",\n\t\t.bit = BCM3368_CLK_USBSU,\n\t}, {\n\t\t.name = \"ephy\",\n\t\t.bit = BCM3368_CLK_EPHY,\n\t}, {\n\t\t \n\t},\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm6318_clocks[] = {\n\t{\n\t\t.name = \"adsl_asb\",\n\t\t.bit = BCM6318_CLK_ADSL_ASB,\n\t}, {\n\t\t.name = \"usb_asb\",\n\t\t.bit = BCM6318_CLK_USB_ASB,\n\t}, {\n\t\t.name = \"mips_asb\",\n\t\t.bit = BCM6318_CLK_MIPS_ASB,\n\t}, {\n\t\t.name = \"pcie_asb\",\n\t\t.bit = BCM6318_CLK_PCIE_ASB,\n\t}, {\n\t\t.name = \"phymips_asb\",\n\t\t.bit = BCM6318_CLK_PHYMIPS_ASB,\n\t}, {\n\t\t.name = \"robosw_asb\",\n\t\t.bit = BCM6318_CLK_ROBOSW_ASB,\n\t}, {\n\t\t.name = \"sar_asb\",\n\t\t.bit = BCM6318_CLK_SAR_ASB,\n\t}, {\n\t\t.name = \"sdr_asb\",\n\t\t.bit = BCM6318_CLK_SDR_ASB,\n\t}, {\n\t\t.name = \"swreg_asb\",\n\t\t.bit = BCM6318_CLK_SWREG_ASB,\n\t}, {\n\t\t.name = \"periph_asb\",\n\t\t.bit = BCM6318_CLK_PERIPH_ASB,\n\t}, {\n\t\t.name = \"cpubus160\",\n\t\t.bit = BCM6318_CLK_CPUBUS160,\n\t}, {\n\t\t.name = \"adsl\",\n\t\t.bit = BCM6318_CLK_ADSL,\n\t}, {\n\t\t.name = \"sar125\",\n\t\t.bit = BCM6318_CLK_SAR125,\n\t}, {\n\t\t.name = \"mips\",\n\t\t.bit = BCM6318_CLK_MIPS,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"pcie\",\n\t\t.bit = BCM6318_CLK_PCIE,\n\t}, {\n\t\t.name = \"robosw250\",\n\t\t.bit = BCM6318_CLK_ROBOSW250,\n\t}, {\n\t\t.name = \"robosw025\",\n\t\t.bit = BCM6318_CLK_ROBOSW025,\n\t}, {\n\t\t.name = \"sdr\",\n\t\t.bit = BCM6318_CLK_SDR,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"usbd\",\n\t\t.bit = BCM6318_CLK_USBD,\n\t}, {\n\t\t.name = \"hsspi\",\n\t\t.bit = BCM6318_CLK_HSSPI,\n\t}, {\n\t\t.name = \"pcie25\",\n\t\t.bit = BCM6318_CLK_PCIE25,\n\t}, {\n\t\t.name = \"phymips\",\n\t\t.bit = BCM6318_CLK_PHYMIPS,\n\t}, {\n\t\t.name = \"afe\",\n\t\t.bit = BCM6318_CLK_AFE,\n\t}, {\n\t\t.name = \"qproc\",\n\t\t.bit = BCM6318_CLK_QPROC,\n\t}, {\n\t\t \n\t},\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm6318_ubus_clocks[] = {\n\t{\n\t\t.name = \"adsl-ubus\",\n\t\t.bit = BCM6318_UCLK_ADSL,\n\t}, {\n\t\t.name = \"arb-ubus\",\n\t\t.bit = BCM6318_UCLK_ARB,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"mips-ubus\",\n\t\t.bit = BCM6318_UCLK_MIPS,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"pcie-ubus\",\n\t\t.bit = BCM6318_UCLK_PCIE,\n\t}, {\n\t\t.name = \"periph-ubus\",\n\t\t.bit = BCM6318_UCLK_PERIPH,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"phymips-ubus\",\n\t\t.bit = BCM6318_UCLK_PHYMIPS,\n\t}, {\n\t\t.name = \"robosw-ubus\",\n\t\t.bit = BCM6318_UCLK_ROBOSW,\n\t}, {\n\t\t.name = \"sar-ubus\",\n\t\t.bit = BCM6318_UCLK_SAR,\n\t}, {\n\t\t.name = \"sdr-ubus\",\n\t\t.bit = BCM6318_UCLK_SDR,\n\t}, {\n\t\t.name = \"usb-ubus\",\n\t\t.bit = BCM6318_UCLK_USB,\n\t}, {\n\t\t \n\t},\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm6328_clocks[] = {\n\t{\n\t\t.name = \"phy_mips\",\n\t\t.bit = BCM6328_CLK_PHYMIPS,\n\t}, {\n\t\t.name = \"adsl_qproc\",\n\t\t.bit = BCM6328_CLK_ADSL_QPROC,\n\t}, {\n\t\t.name = \"adsl_afe\",\n\t\t.bit = BCM6328_CLK_ADSL_AFE,\n\t}, {\n\t\t.name = \"adsl\",\n\t\t.bit = BCM6328_CLK_ADSL,\n\t}, {\n\t\t.name = \"mips\",\n\t\t.bit = BCM6328_CLK_MIPS,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"sar\",\n\t\t.bit = BCM6328_CLK_SAR,\n\t}, {\n\t\t.name = \"pcm\",\n\t\t.bit = BCM6328_CLK_PCM,\n\t}, {\n\t\t.name = \"usbd\",\n\t\t.bit = BCM6328_CLK_USBD,\n\t}, {\n\t\t.name = \"usbh\",\n\t\t.bit = BCM6328_CLK_USBH,\n\t}, {\n\t\t.name = \"hsspi\",\n\t\t.bit = BCM6328_CLK_HSSPI,\n\t}, {\n\t\t.name = \"pcie\",\n\t\t.bit = BCM6328_CLK_PCIE,\n\t}, {\n\t\t.name = \"robosw\",\n\t\t.bit = BCM6328_CLK_ROBOSW,\n\t}, {\n\t\t \n\t},\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm6358_clocks[] = {\n\t{\n\t\t.name = \"enet\",\n\t\t.bit = BCM6358_CLK_ENET,\n\t}, {\n\t\t.name = \"adslphy\",\n\t\t.bit = BCM6358_CLK_ADSLPHY,\n\t}, {\n\t\t.name = \"pcm\",\n\t\t.bit = BCM6358_CLK_PCM,\n\t}, {\n\t\t.name = \"spi\",\n\t\t.bit = BCM6358_CLK_SPI,\n\t}, {\n\t\t.name = \"usbs\",\n\t\t.bit = BCM6358_CLK_USBS,\n\t}, {\n\t\t.name = \"sar\",\n\t\t.bit = BCM6358_CLK_SAR,\n\t}, {\n\t\t.name = \"emusb\",\n\t\t.bit = BCM6358_CLK_EMUSB,\n\t}, {\n\t\t.name = \"enet0\",\n\t\t.bit = BCM6358_CLK_ENET0,\n\t}, {\n\t\t.name = \"enet1\",\n\t\t.bit = BCM6358_CLK_ENET1,\n\t}, {\n\t\t.name = \"usbsu\",\n\t\t.bit = BCM6358_CLK_USBSU,\n\t}, {\n\t\t.name = \"ephy\",\n\t\t.bit = BCM6358_CLK_EPHY,\n\t}, {\n\t\t \n\t},\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm6362_clocks[] = {\n\t{\n\t\t.name = \"adsl_qproc\",\n\t\t.bit = BCM6362_CLK_ADSL_QPROC,\n\t}, {\n\t\t.name = \"adsl_afe\",\n\t\t.bit = BCM6362_CLK_ADSL_AFE,\n\t}, {\n\t\t.name = \"adsl\",\n\t\t.bit = BCM6362_CLK_ADSL,\n\t}, {\n\t\t.name = \"mips\",\n\t\t.bit = BCM6362_CLK_MIPS,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"wlan_ocp\",\n\t\t.bit = BCM6362_CLK_WLAN_OCP,\n\t}, {\n\t\t.name = \"swpkt_usb\",\n\t\t.bit = BCM6362_CLK_SWPKT_USB,\n\t}, {\n\t\t.name = \"swpkt_sar\",\n\t\t.bit = BCM6362_CLK_SWPKT_SAR,\n\t}, {\n\t\t.name = \"sar\",\n\t\t.bit = BCM6362_CLK_SAR,\n\t}, {\n\t\t.name = \"robosw\",\n\t\t.bit = BCM6362_CLK_ROBOSW,\n\t}, {\n\t\t.name = \"pcm\",\n\t\t.bit = BCM6362_CLK_PCM,\n\t}, {\n\t\t.name = \"usbd\",\n\t\t.bit = BCM6362_CLK_USBD,\n\t}, {\n\t\t.name = \"usbh\",\n\t\t.bit = BCM6362_CLK_USBH,\n\t}, {\n\t\t.name = \"ipsec\",\n\t\t.bit = BCM6362_CLK_IPSEC,\n\t}, {\n\t\t.name = \"spi\",\n\t\t.bit = BCM6362_CLK_SPI,\n\t}, {\n\t\t.name = \"hsspi\",\n\t\t.bit = BCM6362_CLK_HSSPI,\n\t}, {\n\t\t.name = \"pcie\",\n\t\t.bit = BCM6362_CLK_PCIE,\n\t}, {\n\t\t.name = \"fap\",\n\t\t.bit = BCM6362_CLK_FAP,\n\t}, {\n\t\t.name = \"phymips\",\n\t\t.bit = BCM6362_CLK_PHYMIPS,\n\t}, {\n\t\t.name = \"nand\",\n\t\t.bit = BCM6362_CLK_NAND,\n\t}, {\n\t\t \n\t},\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm6368_clocks[] = {\n\t{\n\t\t.name = \"vdsl_qproc\",\n\t\t.bit = BCM6368_CLK_VDSL_QPROC,\n\t}, {\n\t\t.name = \"vdsl_afe\",\n\t\t.bit = BCM6368_CLK_VDSL_AFE,\n\t}, {\n\t\t.name = \"vdsl_bonding\",\n\t\t.bit = BCM6368_CLK_VDSL_BONDING,\n\t}, {\n\t\t.name = \"vdsl\",\n\t\t.bit = BCM6368_CLK_VDSL,\n\t}, {\n\t\t.name = \"phymips\",\n\t\t.bit = BCM6368_CLK_PHYMIPS,\n\t}, {\n\t\t.name = \"swpkt_usb\",\n\t\t.bit = BCM6368_CLK_SWPKT_USB,\n\t}, {\n\t\t.name = \"swpkt_sar\",\n\t\t.bit = BCM6368_CLK_SWPKT_SAR,\n\t}, {\n\t\t.name = \"spi\",\n\t\t.bit = BCM6368_CLK_SPI,\n\t}, {\n\t\t.name = \"usbd\",\n\t\t.bit = BCM6368_CLK_USBD,\n\t}, {\n\t\t.name = \"sar\",\n\t\t.bit = BCM6368_CLK_SAR,\n\t}, {\n\t\t.name = \"robosw\",\n\t\t.bit = BCM6368_CLK_ROBOSW,\n\t}, {\n\t\t.name = \"utopia\",\n\t\t.bit = BCM6368_CLK_UTOPIA,\n\t}, {\n\t\t.name = \"pcm\",\n\t\t.bit = BCM6368_CLK_PCM,\n\t}, {\n\t\t.name = \"usbh\",\n\t\t.bit = BCM6368_CLK_USBH,\n\t}, {\n\t\t.name = \"disable_gless\",\n\t\t.bit = BCM6368_CLK_DIS_GLESS,\n\t}, {\n\t\t.name = \"nand\",\n\t\t.bit = BCM6368_CLK_NAND,\n\t}, {\n\t\t.name = \"ipsec\",\n\t\t.bit = BCM6368_CLK_IPSEC,\n\t}, {\n\t\t \n\t},\n};\n\nstatic const struct clk_bcm63xx_table_entry bcm63268_clocks[] = {\n\t{\n\t\t.name = \"disable_gless\",\n\t\t.bit = BCM63268_CLK_DIS_GLESS,\n\t}, {\n\t\t.name = \"vdsl_qproc\",\n\t\t.bit = BCM63268_CLK_VDSL_QPROC,\n\t}, {\n\t\t.name = \"vdsl_afe\",\n\t\t.bit = BCM63268_CLK_VDSL_AFE,\n\t}, {\n\t\t.name = \"vdsl\",\n\t\t.bit = BCM63268_CLK_VDSL,\n\t}, {\n\t\t.name = \"mips\",\n\t\t.bit = BCM63268_CLK_MIPS,\n\t\t.flags = CLK_IS_CRITICAL,\n\t}, {\n\t\t.name = \"wlan_ocp\",\n\t\t.bit = BCM63268_CLK_WLAN_OCP,\n\t}, {\n\t\t.name = \"dect\",\n\t\t.bit = BCM63268_CLK_DECT,\n\t}, {\n\t\t.name = \"fap0\",\n\t\t.bit = BCM63268_CLK_FAP0,\n\t}, {\n\t\t.name = \"fap1\",\n\t\t.bit = BCM63268_CLK_FAP1,\n\t}, {\n\t\t.name = \"sar\",\n\t\t.bit = BCM63268_CLK_SAR,\n\t}, {\n\t\t.name = \"robosw\",\n\t\t.bit = BCM63268_CLK_ROBOSW,\n\t}, {\n\t\t.name = \"pcm\",\n\t\t.bit = BCM63268_CLK_PCM,\n\t}, {\n\t\t.name = \"usbd\",\n\t\t.bit = BCM63268_CLK_USBD,\n\t}, {\n\t\t.name = \"usbh\",\n\t\t.bit = BCM63268_CLK_USBH,\n\t}, {\n\t\t.name = \"ipsec\",\n\t\t.bit = BCM63268_CLK_IPSEC,\n\t}, {\n\t\t.name = \"spi\",\n\t\t.bit = BCM63268_CLK_SPI,\n\t}, {\n\t\t.name = \"hsspi\",\n\t\t.bit = BCM63268_CLK_HSSPI,\n\t}, {\n\t\t.name = \"pcie\",\n\t\t.bit = BCM63268_CLK_PCIE,\n\t}, {\n\t\t.name = \"phymips\",\n\t\t.bit = BCM63268_CLK_PHYMIPS,\n\t}, {\n\t\t.name = \"gmac\",\n\t\t.bit = BCM63268_CLK_GMAC,\n\t}, {\n\t\t.name = \"nand\",\n\t\t.bit = BCM63268_CLK_NAND,\n\t}, {\n\t\t.name = \"tbus\",\n\t\t.bit = BCM63268_CLK_TBUS,\n\t}, {\n\t\t.name = \"robosw250\",\n\t\t.bit = BCM63268_CLK_ROBOSW250,\n\t}, {\n\t\t \n\t},\n};\n\nstatic int clk_bcm63xx_probe(struct platform_device *pdev)\n{\n\tconst struct clk_bcm63xx_table_entry *entry, *table;\n\tstruct clk_bcm63xx_hw *hw;\n\tu8 maxbit = 0;\n\tint i, ret;\n\n\ttable = of_device_get_match_data(&pdev->dev);\n\tif (!table)\n\t\treturn -EINVAL;\n\n\tfor (entry = table; entry->name; entry++)\n\t\tmaxbit = max_t(u8, maxbit, entry->bit);\n\tmaxbit++;\n\n\thw = devm_kzalloc(&pdev->dev, struct_size(hw, data.hws, maxbit),\n\t\t\t  GFP_KERNEL);\n\tif (!hw)\n\t\treturn -ENOMEM;\n\n\tplatform_set_drvdata(pdev, hw);\n\n\tspin_lock_init(&hw->lock);\n\n\thw->data.num = maxbit;\n\tfor (i = 0; i < maxbit; i++)\n\t\thw->data.hws[i] = ERR_PTR(-ENODEV);\n\n\thw->regs = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(hw->regs))\n\t\treturn PTR_ERR(hw->regs);\n\n\tfor (entry = table; entry->name; entry++) {\n\t\tstruct clk_hw *clk;\n\n\t\tclk = clk_hw_register_gate(&pdev->dev, entry->name, NULL,\n\t\t\t\t\t   entry->flags, hw->regs, entry->bit,\n\t\t\t\t\t   CLK_GATE_BIG_ENDIAN, &hw->lock);\n\t\tif (IS_ERR(clk)) {\n\t\t\tret = PTR_ERR(clk);\n\t\t\tgoto out_err;\n\t\t}\n\n\t\thw->data.hws[entry->bit] = clk;\n\t}\n\n\tret = of_clk_add_hw_provider(pdev->dev.of_node, of_clk_hw_onecell_get,\n\t\t\t\t     &hw->data);\n\tif (!ret)\n\t\treturn 0;\nout_err:\n\tfor (i = 0; i < hw->data.num; i++) {\n\t\tif (!IS_ERR(hw->data.hws[i]))\n\t\t\tclk_hw_unregister_gate(hw->data.hws[i]);\n\t}\n\n\treturn ret;\n}\n\nstatic void clk_bcm63xx_remove(struct platform_device *pdev)\n{\n\tstruct clk_bcm63xx_hw *hw = platform_get_drvdata(pdev);\n\tint i;\n\n\tof_clk_del_provider(pdev->dev.of_node);\n\n\tfor (i = 0; i < hw->data.num; i++) {\n\t\tif (!IS_ERR(hw->data.hws[i]))\n\t\t\tclk_hw_unregister_gate(hw->data.hws[i]);\n\t}\n}\n\nstatic const struct of_device_id clk_bcm63xx_dt_ids[] = {\n\t{ .compatible = \"brcm,bcm3368-clocks\", .data = &bcm3368_clocks, },\n\t{ .compatible = \"brcm,bcm6318-clocks\", .data = &bcm6318_clocks, },\n\t{ .compatible = \"brcm,bcm6318-ubus-clocks\", .data = &bcm6318_ubus_clocks, },\n\t{ .compatible = \"brcm,bcm6328-clocks\", .data = &bcm6328_clocks, },\n\t{ .compatible = \"brcm,bcm6358-clocks\", .data = &bcm6358_clocks, },\n\t{ .compatible = \"brcm,bcm6362-clocks\", .data = &bcm6362_clocks, },\n\t{ .compatible = \"brcm,bcm6368-clocks\", .data = &bcm6368_clocks, },\n\t{ .compatible = \"brcm,bcm63268-clocks\", .data = &bcm63268_clocks, },\n\t{ }\n};\n\nstatic struct platform_driver clk_bcm63xx = {\n\t.probe = clk_bcm63xx_probe,\n\t.remove_new = clk_bcm63xx_remove,\n\t.driver = {\n\t\t.name = \"bcm63xx-clock\",\n\t\t.of_match_table = clk_bcm63xx_dt_ids,\n\t},\n};\nbuiltin_platform_driver(clk_bcm63xx);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}