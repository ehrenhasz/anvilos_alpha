{
  "module_name": "clk-ns2.c",
  "hash_id": "a706c19d2d0845bb25132e916ec28261ada88fdf86ec92b6a92730a6adcda0a8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/bcm/clk-ns2.c",
  "human_readable_source": "\n\n\n#include <linux/kernel.h>\n#include <linux/err.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n\n#include <dt-bindings/clock/bcm-ns2.h>\n#include \"clk-iproc.h\"\n\n#define REG_VAL(o, s, w) { .offset = o, .shift = s, .width = w, }\n\n#define AON_VAL(o, pw, ps, is) { .offset = o, .pwr_width = pw, \\\n\t.pwr_shift = ps, .iso_shift = is }\n\n#define RESET_VAL(o, rs, prs) { .offset = o, .reset_shift = rs, \\\n\t.p_reset_shift = prs }\n\n#define DF_VAL(o, kis, kiw, kps, kpw, kas, kaw) { .offset = o, .ki_shift = kis,\\\n\t.ki_width = kiw, .kp_shift = kps, .kp_width = kpw, .ka_shift = kas,    \\\n\t.ka_width = kaw }\n\n#define VCO_CTRL_VAL(uo, lo) { .u_offset = uo, .l_offset = lo }\n\n#define ENABLE_VAL(o, es, hs, bs) { .offset = o, .enable_shift = es, \\\n\t.hold_shift = hs, .bypass_shift = bs }\n\nstatic const struct iproc_pll_ctrl genpll_scr = {\n\t.flags = IPROC_CLK_AON | IPROC_CLK_PLL_SPLIT_STAT_CTRL,\n\t.aon = AON_VAL(0x0, 1, 15, 12),\n\t.reset = RESET_VAL(0x4, 2, 1),\n\t.dig_filter = DF_VAL(0x0, 9, 3, 5, 4, 2, 3),\n\t.ndiv_int = REG_VAL(0x8, 4, 10),\n\t.pdiv = REG_VAL(0x8, 0, 4),\n\t.vco_ctrl = VCO_CTRL_VAL(0x10, 0xc),\n\t.status = REG_VAL(0x0, 27, 1),\n};\n\n\nstatic const struct iproc_clk_ctrl genpll_scr_clk[] = {\n\t \n\t[BCM_NS2_GENPLL_SCR_SCR_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SCR_SCR_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 18, 12, 0),\n\t\t.mdiv = REG_VAL(0x18, 0, 8),\n\t},\n\t[BCM_NS2_GENPLL_SCR_FS_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SCR_FS_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 19, 13, 0),\n\t\t.mdiv = REG_VAL(0x18, 8, 8),\n\t},\n\t[BCM_NS2_GENPLL_SCR_AUDIO_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SCR_AUDIO_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 20, 14, 0),\n\t\t.mdiv = REG_VAL(0x14, 0, 8),\n\t},\n\t[BCM_NS2_GENPLL_SCR_CH3_UNUSED] = {\n\t\t.channel = BCM_NS2_GENPLL_SCR_CH3_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 21, 15, 0),\n\t\t.mdiv = REG_VAL(0x14, 8, 8),\n\t},\n\t[BCM_NS2_GENPLL_SCR_CH4_UNUSED] = {\n\t\t.channel = BCM_NS2_GENPLL_SCR_CH4_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 22, 16, 0),\n\t\t.mdiv = REG_VAL(0x14, 16, 8),\n\t},\n\t[BCM_NS2_GENPLL_SCR_CH5_UNUSED] = {\n\t\t.channel = BCM_NS2_GENPLL_SCR_CH5_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 23, 17, 0),\n\t\t.mdiv = REG_VAL(0x14, 24, 8),\n\t},\n};\n\nstatic void __init ns2_genpll_scr_clk_init(struct device_node *node)\n{\n\tiproc_pll_clk_setup(node, &genpll_scr, NULL, 0, genpll_scr_clk,\n\t\t\t    ARRAY_SIZE(genpll_scr_clk));\n}\nCLK_OF_DECLARE(ns2_genpll_src_clk, \"brcm,ns2-genpll-scr\",\n\t       ns2_genpll_scr_clk_init);\n\nstatic const struct iproc_pll_ctrl genpll_sw = {\n\t.flags = IPROC_CLK_AON | IPROC_CLK_PLL_SPLIT_STAT_CTRL,\n\t.aon = AON_VAL(0x0, 1, 11, 10),\n\t.reset = RESET_VAL(0x4, 2, 1),\n\t.dig_filter = DF_VAL(0x0, 9, 3, 5, 4, 2, 3),\n\t.ndiv_int = REG_VAL(0x8, 4, 10),\n\t.pdiv = REG_VAL(0x8, 0, 4),\n\t.vco_ctrl = VCO_CTRL_VAL(0x10, 0xc),\n\t.status = REG_VAL(0x0, 13, 1),\n};\n\nstatic const struct iproc_clk_ctrl genpll_sw_clk[] = {\n\t \n\t[BCM_NS2_GENPLL_SW_RPE_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SW_RPE_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 18, 12, 0),\n\t\t.mdiv = REG_VAL(0x18, 0, 8),\n\t},\n\t[BCM_NS2_GENPLL_SW_250_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SW_250_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 19, 13, 0),\n\t\t.mdiv = REG_VAL(0x18, 8, 8),\n\t},\n\t[BCM_NS2_GENPLL_SW_NIC_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SW_NIC_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 20, 14, 0),\n\t\t.mdiv = REG_VAL(0x14, 0, 8),\n\t},\n\t[BCM_NS2_GENPLL_SW_CHIMP_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SW_CHIMP_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 21, 15, 0),\n\t\t.mdiv = REG_VAL(0x14, 8, 8),\n\t},\n\t[BCM_NS2_GENPLL_SW_PORT_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SW_PORT_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 22, 16, 0),\n\t\t.mdiv = REG_VAL(0x14, 16, 8),\n\t},\n\t[BCM_NS2_GENPLL_SW_SDIO_CLK] = {\n\t\t.channel = BCM_NS2_GENPLL_SW_SDIO_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 23, 17, 0),\n\t\t.mdiv = REG_VAL(0x14, 24, 8),\n\t},\n};\n\nstatic void __init ns2_genpll_sw_clk_init(struct device_node *node)\n{\n\tiproc_pll_clk_setup(node, &genpll_sw, NULL, 0, genpll_sw_clk,\n\t\t\t    ARRAY_SIZE(genpll_sw_clk));\n}\nCLK_OF_DECLARE(ns2_genpll_sw_clk, \"brcm,ns2-genpll-sw\",\n\t       ns2_genpll_sw_clk_init);\n\nstatic const struct iproc_pll_ctrl lcpll_ddr = {\n\t.flags = IPROC_CLK_AON | IPROC_CLK_PLL_SPLIT_STAT_CTRL,\n\t.aon = AON_VAL(0x0, 2, 1, 0),\n\t.reset = RESET_VAL(0x4, 2, 1),\n\t.dig_filter = DF_VAL(0x0, 9, 3, 5, 4, 1, 4),\n\t.ndiv_int = REG_VAL(0x8, 4, 10),\n\t.pdiv = REG_VAL(0x8, 0, 4),\n\t.vco_ctrl = VCO_CTRL_VAL(0x10, 0xc),\n\t.status = REG_VAL(0x0, 0, 1),\n};\n\nstatic const struct iproc_clk_ctrl lcpll_ddr_clk[] = {\n\t \n\t[BCM_NS2_LCPLL_DDR_PCIE_SATA_USB_CLK] = {\n\t\t.channel = BCM_NS2_LCPLL_DDR_PCIE_SATA_USB_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 18, 12, 0),\n\t\t.mdiv = REG_VAL(0x14, 0, 8),\n\t},\n\t[BCM_NS2_LCPLL_DDR_DDR_CLK] = {\n\t\t.channel = BCM_NS2_LCPLL_DDR_DDR_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 19, 13, 0),\n\t\t.mdiv = REG_VAL(0x14, 8, 8),\n\t},\n\t[BCM_NS2_LCPLL_DDR_CH2_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_DDR_CH2_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 20, 14, 0),\n\t\t.mdiv = REG_VAL(0x10, 0, 8),\n\t},\n\t[BCM_NS2_LCPLL_DDR_CH3_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_DDR_CH3_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 21, 15, 0),\n\t\t.mdiv = REG_VAL(0x10, 8, 8),\n\t},\n\t[BCM_NS2_LCPLL_DDR_CH4_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_DDR_CH4_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 22, 16, 0),\n\t\t.mdiv = REG_VAL(0x10, 16, 8),\n\t},\n\t[BCM_NS2_LCPLL_DDR_CH5_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_DDR_CH5_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 23, 17, 0),\n\t\t.mdiv = REG_VAL(0x10, 24, 8),\n\t},\n};\n\nstatic void __init ns2_lcpll_ddr_clk_init(struct device_node *node)\n{\n\tiproc_pll_clk_setup(node, &lcpll_ddr, NULL, 0, lcpll_ddr_clk,\n\t\t\t    ARRAY_SIZE(lcpll_ddr_clk));\n}\nCLK_OF_DECLARE(ns2_lcpll_ddr_clk, \"brcm,ns2-lcpll-ddr\",\n\t       ns2_lcpll_ddr_clk_init);\n\nstatic const struct iproc_pll_ctrl lcpll_ports = {\n\t.flags = IPROC_CLK_AON | IPROC_CLK_PLL_SPLIT_STAT_CTRL,\n\t.aon = AON_VAL(0x0, 2, 5, 4),\n\t.reset = RESET_VAL(0x4, 2, 1),\n\t.dig_filter = DF_VAL(0x0, 9, 3, 5, 4, 1, 4),\n\t.ndiv_int = REG_VAL(0x8, 4, 10),\n\t.pdiv = REG_VAL(0x8, 0, 4),\n\t.vco_ctrl = VCO_CTRL_VAL(0x10, 0xc),\n\t.status = REG_VAL(0x0, 0, 1),\n};\n\nstatic const struct iproc_clk_ctrl lcpll_ports_clk[] = {\n\t \n\t[BCM_NS2_LCPLL_PORTS_WAN_CLK] = {\n\t\t.channel = BCM_NS2_LCPLL_PORTS_WAN_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 18, 12, 0),\n\t\t.mdiv = REG_VAL(0x14, 0, 8),\n\t},\n\t[BCM_NS2_LCPLL_PORTS_RGMII_CLK] = {\n\t\t.channel = BCM_NS2_LCPLL_PORTS_RGMII_CLK,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 19, 13, 0),\n\t\t.mdiv = REG_VAL(0x14, 8, 8),\n\t},\n\t[BCM_NS2_LCPLL_PORTS_CH2_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_PORTS_CH2_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 20, 14, 0),\n\t\t.mdiv = REG_VAL(0x10, 0, 8),\n\t},\n\t[BCM_NS2_LCPLL_PORTS_CH3_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_PORTS_CH3_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 21, 15, 0),\n\t\t.mdiv = REG_VAL(0x10, 8, 8),\n\t},\n\t[BCM_NS2_LCPLL_PORTS_CH4_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_PORTS_CH4_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 22, 16, 0),\n\t\t.mdiv = REG_VAL(0x10, 16, 8),\n\t},\n\t[BCM_NS2_LCPLL_PORTS_CH5_UNUSED] = {\n\t\t.channel = BCM_NS2_LCPLL_PORTS_CH5_UNUSED,\n\t\t.flags = IPROC_CLK_AON,\n\t\t.enable = ENABLE_VAL(0x0, 23, 17, 0),\n\t\t.mdiv = REG_VAL(0x10, 24, 8),\n\t},\n};\n\nstatic void __init ns2_lcpll_ports_clk_init(struct device_node *node)\n{\n\tiproc_pll_clk_setup(node, &lcpll_ports, NULL, 0, lcpll_ports_clk,\n\t\t\t    ARRAY_SIZE(lcpll_ports_clk));\n}\nCLK_OF_DECLARE(ns2_lcpll_ports_clk, \"brcm,ns2-lcpll-ports\",\n\t       ns2_lcpll_ports_clk_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}