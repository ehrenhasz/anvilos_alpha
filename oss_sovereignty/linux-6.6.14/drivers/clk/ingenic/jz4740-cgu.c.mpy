{
  "module_name": "jz4740-cgu.c",
  "hash_id": "720ca7161b4c6e611fefb8829924cc1c299d1e9b44b89287b9906238e620a48a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/ingenic/jz4740-cgu.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/delay.h>\n#include <linux/io.h>\n#include <linux/of.h>\n\n#include <dt-bindings/clock/ingenic,jz4740-cgu.h>\n\n#include \"cgu.h\"\n#include \"pm.h\"\n\n \n#define CGU_REG_CPCCR\t\t0x00\n#define CGU_REG_LCR\t\t0x04\n#define CGU_REG_CPPCR\t\t0x10\n#define CGU_REG_CLKGR\t\t0x20\n#define CGU_REG_SCR\t\t0x24\n#define CGU_REG_I2SCDR\t\t0x60\n#define CGU_REG_LPCDR\t\t0x64\n#define CGU_REG_MSCCDR\t\t0x68\n#define CGU_REG_UHCCDR\t\t0x6c\n#define CGU_REG_SSICDR\t\t0x74\n\n \n#define PLLCTL_M_SHIFT\t\t23\n#define PLLCTL_M_MASK\t\t(0x1ff << PLLCTL_M_SHIFT)\n#define PLLCTL_N_SHIFT\t\t18\n#define PLLCTL_N_MASK\t\t(0x1f << PLLCTL_N_SHIFT)\n#define PLLCTL_OD_SHIFT\t\t16\n#define PLLCTL_OD_MASK\t\t(0x3 << PLLCTL_OD_SHIFT)\n#define PLLCTL_STABLE\t\t(1 << 10)\n#define PLLCTL_BYPASS\t\t(1 << 9)\n#define PLLCTL_ENABLE\t\t(1 << 8)\n\n \n#define LCR_SLEEP\t\t(1 << 0)\n\n \n#define CLKGR_UDC\t\t(1 << 11)\n\nstatic struct ingenic_cgu *cgu;\n\nstatic const s8 pll_od_encoding[4] = {\n\t0x0, 0x1, -1, 0x3,\n};\n\nstatic const u8 jz4740_cgu_cpccr_div_table[] = {\n\t1, 2, 3, 4, 6, 8, 12, 16, 24, 32,\n};\n\nstatic const u8 jz4740_cgu_pll_half_div_table[] = {\n\t2, 1,\n};\n\nstatic const struct ingenic_cgu_clk_info jz4740_cgu_clocks[] = {\n\n\t \n\n\t[JZ4740_CLK_EXT] = { \"ext\", CGU_CLK_EXT },\n\t[JZ4740_CLK_RTC] = { \"rtc\", CGU_CLK_EXT },\n\n\t[JZ4740_CLK_PLL] = {\n\t\t\"pll\", CGU_CLK_PLL,\n\t\t.parents = { JZ4740_CLK_EXT, -1, -1, -1 },\n\t\t.pll = {\n\t\t\t.reg = CGU_REG_CPPCR,\n\t\t\t.rate_multiplier = 1,\n\t\t\t.m_shift = 23,\n\t\t\t.m_bits = 9,\n\t\t\t.m_offset = 2,\n\t\t\t.n_shift = 18,\n\t\t\t.n_bits = 5,\n\t\t\t.n_offset = 2,\n\t\t\t.od_shift = 16,\n\t\t\t.od_bits = 2,\n\t\t\t.od_max = 4,\n\t\t\t.od_encoding = pll_od_encoding,\n\t\t\t.stable_bit = 10,\n\t\t\t.bypass_reg = CGU_REG_CPPCR,\n\t\t\t.bypass_bit = 9,\n\t\t\t.enable_bit = 8,\n\t\t},\n\t},\n\n\t \n\n\t[JZ4740_CLK_PLL_HALF] = {\n\t\t\"pll half\", CGU_CLK_DIV,\n\t\t.parents = { JZ4740_CLK_PLL, -1, -1, -1 },\n\t\t.div = {\n\t\t\tCGU_REG_CPCCR, 21, 1, 1, -1, -1, -1, 0,\n\t\t\tjz4740_cgu_pll_half_div_table,\n\t\t},\n\t},\n\n\t[JZ4740_CLK_CCLK] = {\n\t\t\"cclk\", CGU_CLK_DIV,\n\t\t \n\t\t.flags = CLK_IS_CRITICAL,\n\t\t.parents = { JZ4740_CLK_PLL, -1, -1, -1 },\n\t\t.div = {\n\t\t\tCGU_REG_CPCCR, 0, 1, 4, 22, -1, -1, 0,\n\t\t\tjz4740_cgu_cpccr_div_table,\n\t\t},\n\t},\n\n\t[JZ4740_CLK_HCLK] = {\n\t\t\"hclk\", CGU_CLK_DIV,\n\t\t.parents = { JZ4740_CLK_PLL, -1, -1, -1 },\n\t\t.div = {\n\t\t\tCGU_REG_CPCCR, 4, 1, 4, 22, -1, -1, 0,\n\t\t\tjz4740_cgu_cpccr_div_table,\n\t\t},\n\t},\n\n\t[JZ4740_CLK_PCLK] = {\n\t\t\"pclk\", CGU_CLK_DIV,\n\t\t.parents = { JZ4740_CLK_PLL, -1, -1, -1 },\n\t\t.div = {\n\t\t\tCGU_REG_CPCCR, 8, 1, 4, 22, -1, -1, 0,\n\t\t\tjz4740_cgu_cpccr_div_table,\n\t\t},\n\t},\n\n\t[JZ4740_CLK_MCLK] = {\n\t\t\"mclk\", CGU_CLK_DIV,\n\t\t \n\t\t.flags = CLK_IS_CRITICAL,\n\t\t.parents = { JZ4740_CLK_PLL, -1, -1, -1 },\n\t\t.div = {\n\t\t\tCGU_REG_CPCCR, 12, 1, 4, 22, -1, -1, 0,\n\t\t\tjz4740_cgu_cpccr_div_table,\n\t\t},\n\t},\n\n\t[JZ4740_CLK_LCD] = {\n\t\t\"lcd\", CGU_CLK_DIV | CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_PLL_HALF, -1, -1, -1 },\n\t\t.div = {\n\t\t\tCGU_REG_CPCCR, 16, 1, 5, 22, -1, -1, 0,\n\t\t\tjz4740_cgu_cpccr_div_table,\n\t\t},\n\t\t.gate = { CGU_REG_CLKGR, 10 },\n\t},\n\n\t[JZ4740_CLK_LCD_PCLK] = {\n\t\t\"lcd_pclk\", CGU_CLK_DIV,\n\t\t.parents = { JZ4740_CLK_PLL_HALF, -1, -1, -1 },\n\t\t.div = { CGU_REG_LPCDR, 0, 1, 11, -1, -1, -1 },\n\t},\n\n\t[JZ4740_CLK_I2S] = {\n\t\t\"i2s\", CGU_CLK_MUX | CGU_CLK_DIV | CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, JZ4740_CLK_PLL_HALF, -1, -1 },\n\t\t.mux = { CGU_REG_CPCCR, 31, 1 },\n\t\t.div = { CGU_REG_I2SCDR, 0, 1, 9, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 6 },\n\t},\n\n\t[JZ4740_CLK_SPI] = {\n\t\t\"spi\", CGU_CLK_MUX | CGU_CLK_DIV | CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, JZ4740_CLK_PLL, -1, -1 },\n\t\t.mux = { CGU_REG_SSICDR, 31, 1 },\n\t\t.div = { CGU_REG_SSICDR, 0, 1, 4, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 4 },\n\t},\n\n\t[JZ4740_CLK_MMC] = {\n\t\t\"mmc\", CGU_CLK_DIV | CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_PLL_HALF, -1, -1, -1 },\n\t\t.div = { CGU_REG_MSCCDR, 0, 1, 5, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 7 },\n\t},\n\n\t[JZ4740_CLK_UHC] = {\n\t\t\"uhc\", CGU_CLK_DIV | CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_PLL_HALF, -1, -1, -1 },\n\t\t.div = { CGU_REG_UHCCDR, 0, 1, 4, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 14 },\n\t},\n\n\t[JZ4740_CLK_UDC] = {\n\t\t\"udc\", CGU_CLK_MUX | CGU_CLK_DIV | CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, JZ4740_CLK_PLL_HALF, -1, -1 },\n\t\t.mux = { CGU_REG_CPCCR, 29, 1 },\n\t\t.div = { CGU_REG_CPCCR, 23, 1, 6, -1, -1, -1 },\n\t\t.gate = { CGU_REG_SCR, 6, true },\n\t},\n\n\t \n\n\t[JZ4740_CLK_UART0] = {\n\t\t\"uart0\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 0 },\n\t},\n\n\t[JZ4740_CLK_UART1] = {\n\t\t\"uart1\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 15 },\n\t},\n\n\t[JZ4740_CLK_DMA] = {\n\t\t\"dma\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_PCLK, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 12 },\n\t},\n\n\t[JZ4740_CLK_IPU] = {\n\t\t\"ipu\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_PCLK, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 13 },\n\t},\n\n\t[JZ4740_CLK_ADC] = {\n\t\t\"adc\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 8 },\n\t},\n\n\t[JZ4740_CLK_I2C] = {\n\t\t\"i2c\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 3 },\n\t},\n\n\t[JZ4740_CLK_AIC] = {\n\t\t\"aic\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 5 },\n\t},\n\n\t[JZ4740_CLK_TCU] = {\n\t\t\"tcu\", CGU_CLK_GATE,\n\t\t.parents = { JZ4740_CLK_EXT, -1, -1, -1 },\n\t\t.gate = { CGU_REG_CLKGR, 1 },\n\t},\n};\n\nstatic void __init jz4740_cgu_init(struct device_node *np)\n{\n\tint retval;\n\n\tcgu = ingenic_cgu_new(jz4740_cgu_clocks,\n\t\t\t      ARRAY_SIZE(jz4740_cgu_clocks), np);\n\tif (!cgu) {\n\t\tpr_err(\"%s: failed to initialise CGU\\n\", __func__);\n\t\treturn;\n\t}\n\n\tretval = ingenic_cgu_register_clocks(cgu);\n\tif (retval)\n\t\tpr_err(\"%s: failed to register CGU Clocks\\n\", __func__);\n\n\tingenic_cgu_register_syscore_ops(cgu);\n}\nCLK_OF_DECLARE_DRIVER(jz4740_cgu, \"ingenic,jz4740-cgu\", jz4740_cgu_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}