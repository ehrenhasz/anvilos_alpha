{
  "module_name": "sama7g5.c",
  "hash_id": "61e2a0923839fd6bef9cf01f83e793c7b111d4150cee2ebd8ce518865b6eceda",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/at91/sama7g5.c",
  "human_readable_source": "\n \n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/mfd/syscon.h>\n#include <linux/slab.h>\n\n#include <dt-bindings/clock/at91.h>\n\n#include \"pmc.h\"\n\n#define SAMA7G5_INIT_TABLE(_table, _count)\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tu8 _i;\t\t\t\t\t\\\n\t\tfor (_i = 0; _i < (_count); _i++)\t\\\n\t\t\t(_table)[_i] = _i;\t\t\\\n\t} while (0)\n\n#define SAMA7G5_FILL_TABLE(_to, _from, _count)\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tu8 _i;\t\t\t\t\t\\\n\t\tfor (_i = 0; _i < (_count); _i++) {\t\\\n\t\t\t(_to)[_i] = (_from)[_i];\t\\\n\t\t}\t\t\t\t\t\\\n\t} while (0)\n\nstatic DEFINE_SPINLOCK(pmc_pll_lock);\nstatic DEFINE_SPINLOCK(pmc_mck0_lock);\nstatic DEFINE_SPINLOCK(pmc_mckX_lock);\n\n \nenum pll_ids {\n\tPLL_ID_CPU,\n\tPLL_ID_SYS,\n\tPLL_ID_DDR,\n\tPLL_ID_IMG,\n\tPLL_ID_BAUD,\n\tPLL_ID_AUDIO,\n\tPLL_ID_ETH,\n\tPLL_ID_MAX,\n};\n\n \nenum pll_component_id {\n\tPLL_COMPID_FRAC,\n\tPLL_COMPID_DIV0,\n\tPLL_COMPID_DIV1,\n};\n\n \nenum pll_type {\n\tPLL_TYPE_FRAC,\n\tPLL_TYPE_DIV,\n};\n\n \nstatic const struct clk_pll_layout pll_layout_frac = {\n\t.mul_mask\t= GENMASK(31, 24),\n\t.frac_mask\t= GENMASK(21, 0),\n\t.mul_shift\t= 24,\n\t.frac_shift\t= 0,\n};\n\n \nstatic const struct clk_pll_layout pll_layout_divpmc = {\n\t.div_mask\t= GENMASK(7, 0),\n\t.endiv_mask\t= BIT(29),\n\t.div_shift\t= 0,\n\t.endiv_shift\t= 29,\n};\n\n \nstatic const struct clk_pll_layout pll_layout_divio = {\n\t.div_mask\t= GENMASK(19, 12),\n\t.endiv_mask\t= BIT(30),\n\t.div_shift\t= 12,\n\t.endiv_shift\t= 30,\n};\n\n \nstatic const struct clk_range cpu_pll_outputs[] = {\n\t{ .min = 2343750, .max = 1000000002 },\n};\n\n \nstatic const struct clk_range pll_outputs[] = {\n\t{ .min = 2343750, .max = 1200000000 },\n};\n\n \nstatic const struct clk_pll_characteristics cpu_pll_characteristics = {\n\t.input = { .min = 12000000, .max = 50000000 },\n\t.num_output = ARRAY_SIZE(cpu_pll_outputs),\n\t.output = cpu_pll_outputs,\n};\n\n \nstatic const struct clk_pll_characteristics pll_characteristics = {\n\t.input = { .min = 12000000, .max = 50000000 },\n\t.num_output = ARRAY_SIZE(pll_outputs),\n\t.output = pll_outputs,\n};\n\n \nenum sama7g5_pll_parent {\n\tSAMA7G5_PLL_PARENT_MAINCK,\n\tSAMA7G5_PLL_PARENT_MAIN_XTAL,\n\tSAMA7G5_PLL_PARENT_FRACCK,\n};\n\n \nstatic struct sama7g5_pll {\n\tconst char *n;\n\tconst struct clk_pll_layout *l;\n\tconst struct clk_pll_characteristics *c;\n\tstruct clk_hw *hw;\n\tunsigned long f;\n\tenum sama7g5_pll_parent p;\n\tu8 t;\n\tu8 eid;\n\tu8 safe_div;\n} sama7g5_plls[][PLL_ID_MAX] = {\n\t[PLL_ID_CPU] = {\n\t\t[PLL_COMPID_FRAC] = {\n\t\t\t.n = \"cpupll_fracck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_MAINCK,\n\t\t\t.l = &pll_layout_frac,\n\t\t\t.c = &cpu_pll_characteristics,\n\t\t\t.t = PLL_TYPE_FRAC,\n\t\t\t \n\t\t\t.f = CLK_IS_CRITICAL,\n\t\t},\n\n\t\t[PLL_COMPID_DIV0] = {\n\t\t\t.n = \"cpupll_divpmcck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divpmc,\n\t\t\t.c = &cpu_pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t \n\t\t\t.f = CLK_IS_CRITICAL | CLK_SET_RATE_PARENT,\n\t\t\t.eid = PMC_CPUPLL,\n\t\t\t \n\t\t\t.safe_div = 15,\n\t\t},\n\t},\n\n\t[PLL_ID_SYS] = {\n\t\t[PLL_COMPID_FRAC] = {\n\t\t\t.n = \"syspll_fracck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_MAINCK,\n\t\t\t.l = &pll_layout_frac,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_FRAC,\n\t\t\t \n\t\t\t.f = CLK_IS_CRITICAL | CLK_SET_RATE_GATE,\n\t\t},\n\n\t\t[PLL_COMPID_DIV0] = {\n\t\t\t.n = \"syspll_divpmcck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divpmc,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t \n\t\t\t.f = CLK_IS_CRITICAL | CLK_SET_RATE_GATE,\n\t\t\t.eid = PMC_SYSPLL,\n\t\t},\n\t},\n\n\t[PLL_ID_DDR] = {\n\t\t[PLL_COMPID_FRAC] = {\n\t\t\t.n = \"ddrpll_fracck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_MAINCK,\n\t\t\t.l = &pll_layout_frac,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_FRAC,\n\t\t\t \n\t\t\t.f = CLK_IS_CRITICAL | CLK_SET_RATE_GATE,\n\t\t},\n\n\t\t[PLL_COMPID_DIV0] = {\n\t\t\t.n = \"ddrpll_divpmcck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divpmc,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t \n\t\t\t.f = CLK_IS_CRITICAL | CLK_SET_RATE_GATE,\n\t\t},\n\t},\n\n\t[PLL_ID_IMG] = {\n\t\t[PLL_COMPID_FRAC] = {\n\t\t\t.n = \"imgpll_fracck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_MAINCK,\n\t\t\t.l = &pll_layout_frac,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_FRAC,\n\t\t\t.f = CLK_SET_RATE_GATE,\n\t\t},\n\n\t\t[PLL_COMPID_DIV0] = {\n\t\t\t.n = \"imgpll_divpmcck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divpmc,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t.f = CLK_SET_RATE_GATE | CLK_SET_PARENT_GATE |\n\t\t\t     CLK_SET_RATE_PARENT,\n\t\t},\n\t},\n\n\t[PLL_ID_BAUD] = {\n\t\t[PLL_COMPID_FRAC] = {\n\t\t\t.n = \"baudpll_fracck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_MAINCK,\n\t\t\t.l = &pll_layout_frac,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_FRAC,\n\t\t\t.f = CLK_SET_RATE_GATE, },\n\n\t\t[PLL_COMPID_DIV0] = {\n\t\t\t.n = \"baudpll_divpmcck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divpmc,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t.f = CLK_SET_RATE_GATE | CLK_SET_PARENT_GATE |\n\t\t\t     CLK_SET_RATE_PARENT,\n\t\t},\n\t},\n\n\t[PLL_ID_AUDIO] = {\n\t\t[PLL_COMPID_FRAC] = {\n\t\t\t.n = \"audiopll_fracck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_MAIN_XTAL,\n\t\t\t.l = &pll_layout_frac,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_FRAC,\n\t\t\t.f = CLK_SET_RATE_GATE,\n\t\t},\n\n\t\t[PLL_COMPID_DIV0] = {\n\t\t\t.n = \"audiopll_divpmcck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divpmc,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t.f = CLK_SET_RATE_GATE | CLK_SET_PARENT_GATE |\n\t\t\t     CLK_SET_RATE_PARENT,\n\t\t\t.eid = PMC_AUDIOPMCPLL,\n\t\t},\n\n\t\t[PLL_COMPID_DIV1] = {\n\t\t\t.n = \"audiopll_diviock\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divio,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t.f = CLK_SET_RATE_GATE | CLK_SET_PARENT_GATE |\n\t\t\t     CLK_SET_RATE_PARENT,\n\t\t\t.eid = PMC_AUDIOIOPLL,\n\t\t},\n\t},\n\n\t[PLL_ID_ETH] = {\n\t\t[PLL_COMPID_FRAC] = {\n\t\t\t.n = \"ethpll_fracck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_MAIN_XTAL,\n\t\t\t.l = &pll_layout_frac,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_FRAC,\n\t\t\t.f = CLK_SET_RATE_GATE,\n\t\t},\n\n\t\t[PLL_COMPID_DIV0] = {\n\t\t\t.n = \"ethpll_divpmcck\",\n\t\t\t.p = SAMA7G5_PLL_PARENT_FRACCK,\n\t\t\t.l = &pll_layout_divpmc,\n\t\t\t.c = &pll_characteristics,\n\t\t\t.t = PLL_TYPE_DIV,\n\t\t\t.f = CLK_SET_RATE_GATE | CLK_SET_PARENT_GATE |\n\t\t\t     CLK_SET_RATE_PARENT,\n\t\t},\n\t},\n};\n\n \n#define PLL_IDS_TO_ARR_ENTRY(_id, _comp) { PLL_ID_##_id, PLL_COMPID_##_comp}\n\n \nstatic struct {\n\tconst char *n;\n\tstruct {\n\t\tint pll_id;\n\t\tint pll_compid;\n\t} ep[4];\n\tstruct clk_hw *hw;\n\tint ep_chg_id;\n\tu8 ep_count;\n\tu8 ep_mux_table[4];\n\tu8 id;\n\tu8 eid;\n\tu8 c;\n} sama7g5_mckx[] = {\n\t{ .n = \"mck0\", },  \n\t{ .n = \"mck1\",\n\t  .id = 1,\n\t  .ep = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), },\n\t  .ep_mux_table = { 5, },\n\t  .ep_count = 1,\n\t  .ep_chg_id = INT_MIN,\n\t  .eid = PMC_MCK1,\n\t  .c = 1, },\n\n\t{ .n = \"mck2\",\n\t  .id = 2,\n\t  .ep = { PLL_IDS_TO_ARR_ENTRY(DDR, DIV0), },\n\t  .ep_mux_table = { 6, },\n\t  .ep_count = 1,\n\t  .ep_chg_id = INT_MIN,\n\t  .c = 1, },\n\n\t{ .n = \"mck3\",\n\t  .id = 3,\n\t  .ep = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(DDR, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(IMG, DIV0), },\n\t  .ep_mux_table = { 5, 6, 7, },\n\t  .ep_count = 3,\n\t  .ep_chg_id = 5, },\n\n\t{ .n = \"mck4\",\n\t  .id = 4,\n\t  .ep = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), },\n\t  .ep_mux_table = { 5, },\n\t  .ep_count = 1,\n\t  .ep_chg_id = INT_MIN,\n\t  .c = 1, },\n};\n\n \nstatic const struct {\n\tconst char *n;\n\tu8 id;\n} sama7g5_systemck[] = {\n\t{ .n = \"pck0\", .id = 8, },\n\t{ .n = \"pck1\", .id = 9, },\n\t{ .n = \"pck2\", .id = 10, },\n\t{ .n = \"pck3\", .id = 11, },\n\t{ .n = \"pck4\", .id = 12, },\n\t{ .n = \"pck5\", .id = 13, },\n\t{ .n = \"pck6\", .id = 14, },\n\t{ .n = \"pck7\", .id = 15, },\n};\n\n \nstatic u32 sama7g5_prog_mux_table[] = { 0, 1, 2, 5, 6, 7, 8, 9, 10, };\n\n \nenum sama7g5_pck_parent_hw_id {\n\tPCK_PARENT_HW_MCK0,\n\tPCK_PARENT_HW_MCK1,\n\tPCK_PARENT_HW_MCK2,\n\tPCK_PARENT_HW_MCK3,\n\tPCK_PARENT_HW_MCK4,\n\tPCK_PARENT_HW_MAX,\n};\n\n \nstatic struct {\n\tconst char *n;\n\tenum sama7g5_pck_parent_hw_id p;\n\tstruct clk_range r;\n\tu8 chgp;\n\tu8 id;\n} sama7g5_periphck[] = {\n\t{ .n = \"pioA_clk\",\t.p = PCK_PARENT_HW_MCK0, .id = 11, },\n\t{ .n = \"securam_clk\",\t.p = PCK_PARENT_HW_MCK0, .id = 18, },\n\t{ .n = \"sfr_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 19, },\n\t{ .n = \"hsmc_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 21, },\n\t{ .n = \"xdmac0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 22, },\n\t{ .n = \"xdmac1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 23, },\n\t{ .n = \"xdmac2_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 24, },\n\t{ .n = \"acc_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 25, },\n\t{ .n = \"aes_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 27, },\n\t{ .n = \"tzaesbasc_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 28, },\n\t{ .n = \"asrc_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 30, .r = { .max = 200000000, }, },\n\t{ .n = \"cpkcc_clk\",\t.p = PCK_PARENT_HW_MCK0, .id = 32, },\n\t{ .n = \"csi_clk\",\t.p = PCK_PARENT_HW_MCK3, .id = 33, .r = { .max = 266000000, }, .chgp = 1, },\n\t{ .n = \"csi2dc_clk\",\t.p = PCK_PARENT_HW_MCK3, .id = 34, .r = { .max = 266000000, }, .chgp = 1, },\n\t{ .n = \"eic_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 37, },\n\t{ .n = \"flex0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 38, },\n\t{ .n = \"flex1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 39, },\n\t{ .n = \"flex2_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 40, },\n\t{ .n = \"flex3_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 41, },\n\t{ .n = \"flex4_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 42, },\n\t{ .n = \"flex5_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 43, },\n\t{ .n = \"flex6_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 44, },\n\t{ .n = \"flex7_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 45, },\n\t{ .n = \"flex8_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 46, },\n\t{ .n = \"flex9_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 47, },\n\t{ .n = \"flex10_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 48, },\n\t{ .n = \"flex11_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 49, },\n\t{ .n = \"gmac0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 51, },\n\t{ .n = \"gmac1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 52, },\n\t{ .n = \"icm_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 55, },\n\t{ .n = \"isc_clk\",\t.p = PCK_PARENT_HW_MCK3, .id = 56, .r = { .max = 266000000, }, .chgp = 1, },\n\t{ .n = \"i2smcc0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 57, .r = { .max = 200000000, }, },\n\t{ .n = \"i2smcc1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 58, .r = { .max = 200000000, }, },\n\t{ .n = \"matrix_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 60, },\n\t{ .n = \"mcan0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 61, .r = { .max = 200000000, }, },\n\t{ .n = \"mcan1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 62, .r = { .max = 200000000, }, },\n\t{ .n = \"mcan2_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 63, .r = { .max = 200000000, }, },\n\t{ .n = \"mcan3_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 64, .r = { .max = 200000000, }, },\n\t{ .n = \"mcan4_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 65, .r = { .max = 200000000, }, },\n\t{ .n = \"mcan5_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 66, .r = { .max = 200000000, }, },\n\t{ .n = \"pdmc0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 68, .r = { .max = 200000000, }, },\n\t{ .n = \"pdmc1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 69, .r = { .max = 200000000, }, },\n\t{ .n = \"pit64b0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 70, },\n\t{ .n = \"pit64b1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 71, },\n\t{ .n = \"pit64b2_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 72, },\n\t{ .n = \"pit64b3_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 73, },\n\t{ .n = \"pit64b4_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 74, },\n\t{ .n = \"pit64b5_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 75, },\n\t{ .n = \"pwm_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 77, },\n\t{ .n = \"qspi0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 78, },\n\t{ .n = \"qspi1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 79, },\n\t{ .n = \"sdmmc0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 80, },\n\t{ .n = \"sdmmc1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 81, },\n\t{ .n = \"sdmmc2_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 82, },\n\t{ .n = \"sha_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 83, },\n\t{ .n = \"spdifrx_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 84, .r = { .max = 200000000, }, },\n\t{ .n = \"spdiftx_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 85, .r = { .max = 200000000, }, },\n\t{ .n = \"ssc0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 86, .r = { .max = 200000000, }, },\n\t{ .n = \"ssc1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 87, .r = { .max = 200000000, }, },\n\t{ .n = \"tcb0_ch0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 88, .r = { .max = 200000000, }, },\n\t{ .n = \"tcb0_ch1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 89, .r = { .max = 200000000, }, },\n\t{ .n = \"tcb0_ch2_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 90, .r = { .max = 200000000, }, },\n\t{ .n = \"tcb1_ch0_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 91, .r = { .max = 200000000, }, },\n\t{ .n = \"tcb1_ch1_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 92, .r = { .max = 200000000, }, },\n\t{ .n = \"tcb1_ch2_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 93, .r = { .max = 200000000, }, },\n\t{ .n = \"tcpca_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 94, },\n\t{ .n = \"tcpcb_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 95, },\n\t{ .n = \"tdes_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 96, },\n\t{ .n = \"trng_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 97, },\n\t{ .n = \"udphsa_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 104, },\n\t{ .n = \"udphsb_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 105, },\n\t{ .n = \"uhphs_clk\",\t.p = PCK_PARENT_HW_MCK1, .id = 106, },\n};\n\n \nstatic const struct {\n\tconst char *n;\n\tstruct {\n\t\tint pll_id;\n\t\tint pll_compid;\n\t} pp[8];\n\tconst char pp_mux_table[8];\n\tstruct clk_range r;\n\tint pp_chg_id;\n\tu8 pp_count;\n\tu8 id;\n} sama7g5_gck[] = {\n\t{ .n  = \"adc_gclk\",\n\t  .id = 26,\n\t  .r = { .max = 100000000, },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 5, 7, 9, },\n\t  .pp_count = 3,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"asrc_gclk\",\n\t  .id = 30,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 9, },\n\t  .pp_count = 1,\n\t  .pp_chg_id = 3, },\n\n\t{ .n  = \"csi_gclk\",\n\t  .id = 33,\n\t  .r = { .max = 27000000  },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(DDR, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0), },\n\t  .pp_mux_table = { 6, 7, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex0_gclk\",\n\t  .id = 38,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex1_gclk\",\n\t  .id = 39,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex2_gclk\",\n\t  .id = 40,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex3_gclk\",\n\t  .id = 41,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex4_gclk\",\n\t  .id = 42,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex5_gclk\",\n\t  .id = 43,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex6_gclk\",\n\t  .id = 44,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex7_gclk\",\n\t  .id = 45,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex8_gclk\",\n\t  .id = 46,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex9_gclk\",\n\t  .id = 47,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex10_gclk\",\n\t  .id = 48,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"flex11_gclk\",\n\t  .id = 49,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"gmac0_gclk\",\n\t  .id = 51,\n\t  .r = { .max = 125000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 10, },\n\t  .pp_count = 1,\n\t  .pp_chg_id = 3, },\n\n\t{ .n  = \"gmac1_gclk\",\n\t  .id = 52,\n\t  .r = { .max = 50000000  },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 10, },\n\t  .pp_count = 1,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"gmac0_tsu_gclk\",\n\t  .id = 53,\n\t  .r = { .max = 300000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 9, 10, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"gmac1_tsu_gclk\",\n\t  .id = 54,\n\t  .r = { .max = 300000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 9, 10, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"i2smcc0_gclk\",\n\t  .id = 57,\n\t  .r = { .max = 100000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 5, 9, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = 4, },\n\n\t{ .n  = \"i2smcc1_gclk\",\n\t  .id = 58,\n\t  .r = { .max = 100000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 5, 9, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = 4, },\n\n\t{ .n  = \"mcan0_gclk\",\n\t  .id = 61,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"mcan1_gclk\",\n\t  .id = 62,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"mcan2_gclk\",\n\t  .id = 63,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"mcan3_gclk\",\n\t  .id = 64,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"mcan4_gclk\",\n\t  .id = 65,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"mcan5_gclk\",\n\t  .id = 66,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pdmc0_gclk\",\n\t  .id = 68,\n\t  .r = { .max = 50000000  },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 5, 9, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pdmc1_gclk\",\n\t  .id = 69,\n\t  .r = { .max = 50000000, },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 5, 9, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pit64b0_gclk\",\n\t  .id = 70,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pit64b1_gclk\",\n\t  .id = 71,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pit64b2_gclk\",\n\t  .id = 72,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pit64b3_gclk\",\n\t  .id = 73,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pit64b4_gclk\",\n\t  .id = 74,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"pit64b5_gclk\",\n\t  .id = 75,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"qspi0_gclk\",\n\t  .id = 78,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"qspi1_gclk\",\n\t  .id = 79,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"sdmmc0_gclk\",\n\t  .id = 80,\n\t  .r = { .max = 208000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = 4, },\n\n\t{ .n  = \"sdmmc1_gclk\",\n\t  .id = 81,\n\t  .r = { .max = 208000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = 4, },\n\n\t{ .n  = \"sdmmc2_gclk\",\n\t  .id = 82,\n\t  .r = { .max = 208000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), },\n\t  .pp_mux_table = { 5, 8, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = 4, },\n\n\t{ .n  = \"spdifrx_gclk\",\n\t  .id = 84,\n\t  .r = { .max = 150000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 5, 9, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = 4, },\n\n\t{ .n = \"spdiftx_gclk\",\n\t  .id = 85,\n\t  .r = { .max = 25000000  },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0), },\n\t  .pp_mux_table = { 5, 9, },\n\t  .pp_count = 2,\n\t  .pp_chg_id = 4, },\n\n\t{ .n  = \"tcb0_ch0_gclk\",\n\t  .id = 88,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"tcb1_ch0_gclk\",\n\t  .id = 91,\n\t  .r = { .max = 200000000 },\n\t  .pp = { PLL_IDS_TO_ARR_ENTRY(SYS, DIV0), PLL_IDS_TO_ARR_ENTRY(IMG, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(BAUD, DIV0), PLL_IDS_TO_ARR_ENTRY(AUDIO, DIV0),\n\t\t  PLL_IDS_TO_ARR_ENTRY(ETH, DIV0), },\n\t  .pp_mux_table = { 5, 7, 8, 9, 10, },\n\t  .pp_count = 5,\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"tcpca_gclk\",\n\t  .id = 94,\n\t  .r = { .max = 32768, },\n\t  .pp_chg_id = INT_MIN, },\n\n\t{ .n  = \"tcpcb_gclk\",\n\t  .id = 95,\n\t  .r = { .max = 32768, },\n\t  .pp_chg_id = INT_MIN, },\n};\n\n \nstatic const struct clk_master_characteristics mck0_characteristics = {\n\t.output = { .min = 32768, .max = 200000000 },\n\t.divisors = { 1, 2, 4, 3, 5 },\n\t.have_div3_pres = 1,\n};\n\n \nstatic const struct clk_master_layout mck0_layout = {\n\t.mask = 0x773,\n\t.pres_shift = 4,\n\t.offset = 0x28,\n};\n\n \nstatic const struct clk_programmable_layout programmable_layout = {\n\t.pres_mask = 0xff,\n\t.pres_shift = 8,\n\t.css_mask = 0x1f,\n\t.have_slck_mck = 0,\n\t.is_pres_direct = 1,\n};\n\n \nstatic const struct clk_pcr_layout sama7g5_pcr_layout = {\n\t.offset = 0x88,\n\t.cmd = BIT(31),\n\t.gckcss_mask = GENMASK(12, 8),\n\t.pid_mask = GENMASK(6, 0),\n};\n\nstatic void __init sama7g5_pmc_setup(struct device_node *np)\n{\n\tconst char *main_xtal_name = \"main_xtal\";\n\tstruct pmc_data *sama7g5_pmc;\n\tvoid **alloc_mem = NULL;\n\tint alloc_mem_size = 0;\n\tstruct regmap *regmap;\n\tstruct clk_hw *hw, *main_rc_hw, *main_osc_hw, *main_xtal_hw;\n\tstruct clk_hw *td_slck_hw, *md_slck_hw;\n\tstatic struct clk_parent_data parent_data;\n\tstruct clk_hw *parent_hws[10];\n\tbool bypass;\n\tint i, j;\n\n\ttd_slck_hw = __clk_get_hw(of_clk_get_by_name(np, \"td_slck\"));\n\tmd_slck_hw = __clk_get_hw(of_clk_get_by_name(np, \"md_slck\"));\n\tmain_xtal_hw = __clk_get_hw(of_clk_get_by_name(np, main_xtal_name));\n\n\tif (!td_slck_hw || !md_slck_hw || !main_xtal_hw)\n\t\treturn;\n\n\tregmap = device_node_to_regmap(np);\n\tif (IS_ERR(regmap))\n\t\treturn;\n\n\tsama7g5_pmc = pmc_data_allocate(PMC_MCK1 + 1,\n\t\t\t\t\tnck(sama7g5_systemck),\n\t\t\t\t\tnck(sama7g5_periphck),\n\t\t\t\t\tnck(sama7g5_gck), 8);\n\tif (!sama7g5_pmc)\n\t\treturn;\n\n\talloc_mem = kmalloc(sizeof(void *) *\n\t\t\t    (ARRAY_SIZE(sama7g5_mckx) + ARRAY_SIZE(sama7g5_gck)),\n\t\t\t    GFP_KERNEL);\n\tif (!alloc_mem)\n\t\tgoto err_free;\n\n\tmain_rc_hw = at91_clk_register_main_rc_osc(regmap, \"main_rc_osc\", 12000000,\n\t\t\t\t\t\t   50000000);\n\tif (IS_ERR(main_rc_hw))\n\t\tgoto err_free;\n\n\tbypass = of_property_read_bool(np, \"atmel,osc-bypass\");\n\n\tparent_data.name = main_xtal_name;\n\tparent_data.fw_name = main_xtal_name;\n\tmain_osc_hw = at91_clk_register_main_osc(regmap, \"main_osc\", NULL,\n\t\t\t\t\t\t &parent_data, bypass);\n\tif (IS_ERR(main_osc_hw))\n\t\tgoto err_free;\n\n\tparent_hws[0] = main_rc_hw;\n\tparent_hws[1] = main_osc_hw;\n\thw = at91_clk_register_sam9x5_main(regmap, \"mainck\", NULL, parent_hws, 2);\n\tif (IS_ERR(hw))\n\t\tgoto err_free;\n\n\tsama7g5_pmc->chws[PMC_MAIN] = hw;\n\n\tfor (i = 0; i < PLL_ID_MAX; i++) {\n\t\tfor (j = 0; j < 3; j++) {\n\t\t\tstruct clk_hw *parent_hw;\n\n\t\t\tif (!sama7g5_plls[i][j].n)\n\t\t\t\tcontinue;\n\n\t\t\tswitch (sama7g5_plls[i][j].t) {\n\t\t\tcase PLL_TYPE_FRAC:\n\t\t\t\tswitch (sama7g5_plls[i][j].p) {\n\t\t\t\tcase SAMA7G5_PLL_PARENT_MAINCK:\n\t\t\t\t\tparent_hw = sama7g5_pmc->chws[PMC_MAIN];\n\t\t\t\t\tbreak;\n\t\t\t\tcase SAMA7G5_PLL_PARENT_MAIN_XTAL:\n\t\t\t\t\tparent_hw = main_xtal_hw;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\t \n\t\t\t\t\tparent_hw = NULL;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\thw = sam9x60_clk_register_frac_pll(regmap,\n\t\t\t\t\t&pmc_pll_lock, sama7g5_plls[i][j].n,\n\t\t\t\t\tNULL, parent_hw, i,\n\t\t\t\t\tsama7g5_plls[i][j].c,\n\t\t\t\t\tsama7g5_plls[i][j].l,\n\t\t\t\t\tsama7g5_plls[i][j].f);\n\t\t\t\tbreak;\n\n\t\t\tcase PLL_TYPE_DIV:\n\t\t\t\thw = sam9x60_clk_register_div_pll(regmap,\n\t\t\t\t\t&pmc_pll_lock, sama7g5_plls[i][j].n,\n\t\t\t\t\tNULL, sama7g5_plls[i][0].hw, i,\n\t\t\t\t\tsama7g5_plls[i][j].c,\n\t\t\t\t\tsama7g5_plls[i][j].l,\n\t\t\t\t\tsama7g5_plls[i][j].f,\n\t\t\t\t\tsama7g5_plls[i][j].safe_div);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (IS_ERR(hw))\n\t\t\t\tgoto err_free;\n\n\t\t\tsama7g5_plls[i][j].hw = hw;\n\t\t\tif (sama7g5_plls[i][j].eid)\n\t\t\t\tsama7g5_pmc->chws[sama7g5_plls[i][j].eid] = hw;\n\t\t}\n\t}\n\n\thw = at91_clk_register_master_div(regmap, \"mck0\", NULL,\n\t\t\t\t\t  sama7g5_plls[PLL_ID_CPU][1].hw,\n\t\t\t\t\t  &mck0_layout, &mck0_characteristics,\n\t\t\t\t\t  &pmc_mck0_lock, CLK_GET_RATE_NOCACHE, 5);\n\tif (IS_ERR(hw))\n\t\tgoto err_free;\n\n\tsama7g5_mckx[PCK_PARENT_HW_MCK0].hw = sama7g5_pmc->chws[PMC_MCK] = hw;\n\n\tparent_hws[0] = md_slck_hw;\n\tparent_hws[1] = td_slck_hw;\n\tparent_hws[2] = sama7g5_pmc->chws[PMC_MAIN];\n\tfor (i = PCK_PARENT_HW_MCK1; i < ARRAY_SIZE(sama7g5_mckx); i++) {\n\t\tu8 num_parents = 3 + sama7g5_mckx[i].ep_count;\n\t\tstruct clk_hw *tmp_parent_hws[8];\n\t\tu32 *mux_table;\n\n\t\tmux_table = kmalloc_array(num_parents, sizeof(*mux_table),\n\t\t\t\t\t  GFP_KERNEL);\n\t\tif (!mux_table)\n\t\t\tgoto err_free;\n\n\t\tSAMA7G5_INIT_TABLE(mux_table, 3);\n\t\tSAMA7G5_FILL_TABLE(&mux_table[3], sama7g5_mckx[i].ep_mux_table,\n\t\t\t\t   sama7g5_mckx[i].ep_count);\n\t\tfor (j = 0; j < sama7g5_mckx[i].ep_count; j++) {\n\t\t\tu8 pll_id = sama7g5_mckx[i].ep[j].pll_id;\n\t\t\tu8 pll_compid = sama7g5_mckx[i].ep[j].pll_compid;\n\n\t\t\ttmp_parent_hws[j] = sama7g5_plls[pll_id][pll_compid].hw;\n\t\t}\n\t\tSAMA7G5_FILL_TABLE(&parent_hws[3], tmp_parent_hws,\n\t\t\t\t   sama7g5_mckx[i].ep_count);\n\n\t\thw = at91_clk_sama7g5_register_master(regmap, sama7g5_mckx[i].n,\n\t\t\t\t   num_parents, NULL, parent_hws, mux_table,\n\t\t\t\t   &pmc_mckX_lock, sama7g5_mckx[i].id,\n\t\t\t\t   sama7g5_mckx[i].c,\n\t\t\t\t   sama7g5_mckx[i].ep_chg_id);\n\t\tif (IS_ERR(hw))\n\t\t\tgoto err_free;\n\n\t\talloc_mem[alloc_mem_size++] = mux_table;\n\n\t\tsama7g5_mckx[i].hw = hw;\n\t\tif (sama7g5_mckx[i].eid)\n\t\t\tsama7g5_pmc->chws[sama7g5_mckx[i].eid] = hw;\n\t}\n\n\thw = at91_clk_sama7g5_register_utmi(regmap, \"utmick\", NULL, main_xtal_hw);\n\tif (IS_ERR(hw))\n\t\tgoto err_free;\n\n\tsama7g5_pmc->chws[PMC_UTMI] = hw;\n\n\tparent_hws[0] = md_slck_hw;\n\tparent_hws[1] = td_slck_hw;\n\tparent_hws[2] = sama7g5_pmc->chws[PMC_MAIN];\n\tparent_hws[3] = sama7g5_plls[PLL_ID_SYS][PLL_COMPID_DIV0].hw;\n\tparent_hws[4] = sama7g5_plls[PLL_ID_DDR][PLL_COMPID_DIV0].hw;\n\tparent_hws[5] = sama7g5_plls[PLL_ID_IMG][PLL_COMPID_DIV0].hw;\n\tparent_hws[6] = sama7g5_plls[PLL_ID_BAUD][PLL_COMPID_DIV0].hw;\n\tparent_hws[7] = sama7g5_plls[PLL_ID_AUDIO][PLL_COMPID_DIV0].hw;\n\tparent_hws[8] = sama7g5_plls[PLL_ID_ETH][PLL_COMPID_DIV0].hw;\n\tfor (i = 0; i < 8; i++) {\n\t\tchar name[6];\n\n\t\tsnprintf(name, sizeof(name), \"prog%d\", i);\n\n\t\thw = at91_clk_register_programmable(regmap, name, NULL, parent_hws,\n\t\t\t\t\t\t    9, i,\n\t\t\t\t\t\t    &programmable_layout,\n\t\t\t\t\t\t    sama7g5_prog_mux_table);\n\t\tif (IS_ERR(hw))\n\t\t\tgoto err_free;\n\n\t\tsama7g5_pmc->pchws[i] = hw;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(sama7g5_systemck); i++) {\n\t\thw = at91_clk_register_system(regmap, sama7g5_systemck[i].n,\n\t\t\t\t\t      NULL, sama7g5_pmc->pchws[i],\n\t\t\t\t\t      sama7g5_systemck[i].id, 0);\n\t\tif (IS_ERR(hw))\n\t\t\tgoto err_free;\n\n\t\tsama7g5_pmc->shws[sama7g5_systemck[i].id] = hw;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(sama7g5_periphck); i++) {\n\t\thw = at91_clk_register_sam9x5_peripheral(regmap, &pmc_pcr_lock,\n\t\t\t\t\t\t&sama7g5_pcr_layout,\n\t\t\t\t\t\tsama7g5_periphck[i].n,\n\t\t\t\t\t\tNULL,\n\t\t\t\t\t\tsama7g5_mckx[sama7g5_periphck[i].p].hw,\n\t\t\t\t\t\tsama7g5_periphck[i].id,\n\t\t\t\t\t\t&sama7g5_periphck[i].r,\n\t\t\t\t\t\tsama7g5_periphck[i].chgp ? 0 :\n\t\t\t\t\t\tINT_MIN, 0);\n\t\tif (IS_ERR(hw))\n\t\t\tgoto err_free;\n\n\t\tsama7g5_pmc->phws[sama7g5_periphck[i].id] = hw;\n\t}\n\n\tparent_hws[0] = md_slck_hw;\n\tparent_hws[1] = td_slck_hw;\n\tparent_hws[2] = sama7g5_pmc->chws[PMC_MAIN];\n\tfor (i = 0; i < ARRAY_SIZE(sama7g5_gck); i++) {\n\t\tu8 num_parents = 3 + sama7g5_gck[i].pp_count;\n\t\tstruct clk_hw *tmp_parent_hws[8];\n\t\tu32 *mux_table;\n\n\t\tmux_table = kmalloc_array(num_parents, sizeof(*mux_table),\n\t\t\t\t\t  GFP_KERNEL);\n\t\tif (!mux_table)\n\t\t\tgoto err_free;\n\n\t\tSAMA7G5_INIT_TABLE(mux_table, 3);\n\t\tSAMA7G5_FILL_TABLE(&mux_table[3], sama7g5_gck[i].pp_mux_table,\n\t\t\t\t   sama7g5_gck[i].pp_count);\n\t\tfor (j = 0; j < sama7g5_gck[i].pp_count; j++) {\n\t\t\tu8 pll_id = sama7g5_gck[i].pp[j].pll_id;\n\t\t\tu8 pll_compid = sama7g5_gck[i].pp[j].pll_compid;\n\n\t\t\ttmp_parent_hws[j] = sama7g5_plls[pll_id][pll_compid].hw;\n\t\t}\n\t\tSAMA7G5_FILL_TABLE(&parent_hws[3], tmp_parent_hws,\n\t\t\t\t   sama7g5_gck[i].pp_count);\n\n\t\thw = at91_clk_register_generated(regmap, &pmc_pcr_lock,\n\t\t\t\t\t\t &sama7g5_pcr_layout,\n\t\t\t\t\t\t sama7g5_gck[i].n, NULL,\n\t\t\t\t\t\t parent_hws, mux_table,\n\t\t\t\t\t\t num_parents,\n\t\t\t\t\t\t sama7g5_gck[i].id,\n\t\t\t\t\t\t &sama7g5_gck[i].r,\n\t\t\t\t\t\t sama7g5_gck[i].pp_chg_id);\n\t\tif (IS_ERR(hw))\n\t\t\tgoto err_free;\n\n\t\tsama7g5_pmc->ghws[sama7g5_gck[i].id] = hw;\n\t\talloc_mem[alloc_mem_size++] = mux_table;\n\t}\n\n\tof_clk_add_hw_provider(np, of_clk_hw_pmc_get, sama7g5_pmc);\n\n\treturn;\n\nerr_free:\n\tif (alloc_mem) {\n\t\tfor (i = 0; i < alloc_mem_size; i++)\n\t\t\tkfree(alloc_mem[i]);\n\t\tkfree(alloc_mem);\n\t}\n\n\tkfree(sama7g5_pmc);\n}\n\n \nCLK_OF_DECLARE(sama7g5_pmc, \"microchip,sama7g5-pmc\", sama7g5_pmc_setup);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}