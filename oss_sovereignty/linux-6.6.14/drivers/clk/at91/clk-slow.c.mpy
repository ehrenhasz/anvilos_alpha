{
  "module_name": "clk-slow.c",
  "hash_id": "ffdc4e9328b0cdb471a5f72ec2ac80bccccc503f34b0d49c34b7383acf84e61e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/at91/clk-slow.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/clkdev.h>\n#include <linux/clk/at91_pmc.h>\n#include <linux/of.h>\n#include <linux/mfd/syscon.h>\n#include <linux/regmap.h>\n\n#include \"pmc.h\"\n\nstruct clk_sam9260_slow {\n\tstruct clk_hw hw;\n\tstruct regmap *regmap;\n};\n\n#define to_clk_sam9260_slow(hw) container_of(hw, struct clk_sam9260_slow, hw)\n\nstatic u8 clk_sam9260_slow_get_parent(struct clk_hw *hw)\n{\n\tstruct clk_sam9260_slow *slowck = to_clk_sam9260_slow(hw);\n\tunsigned int status;\n\n\tregmap_read(slowck->regmap, AT91_PMC_SR, &status);\n\n\treturn status & AT91_PMC_OSCSEL ? 1 : 0;\n}\n\nstatic const struct clk_ops sam9260_slow_ops = {\n\t.get_parent = clk_sam9260_slow_get_parent,\n};\n\nstruct clk_hw * __init\nat91_clk_register_sam9260_slow(struct regmap *regmap,\n\t\t\t       const char *name,\n\t\t\t       const char **parent_names,\n\t\t\t       int num_parents)\n{\n\tstruct clk_sam9260_slow *slowck;\n\tstruct clk_hw *hw;\n\tstruct clk_init_data init;\n\tint ret;\n\n\tif (!name)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tif (!parent_names || !num_parents)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tslowck = kzalloc(sizeof(*slowck), GFP_KERNEL);\n\tif (!slowck)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinit.name = name;\n\tinit.ops = &sam9260_slow_ops;\n\tinit.parent_names = parent_names;\n\tinit.num_parents = num_parents;\n\tinit.flags = 0;\n\n\tslowck->hw.init = &init;\n\tslowck->regmap = regmap;\n\n\thw = &slowck->hw;\n\tret = clk_hw_register(NULL, &slowck->hw);\n\tif (ret) {\n\t\tkfree(slowck);\n\t\thw = ERR_PTR(ret);\n\t}\n\n\treturn hw;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}