{
  "module_name": "clk-uniphier-core.c",
  "hash_id": "0c82bf8456bd46c28594357635396a7ef0170b379c7966bfe5f3b200cf229252",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/uniphier/clk-uniphier-core.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/init.h>\n#include <linux/mfd/syscon.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n\n#include \"clk-uniphier.h\"\n\nstatic struct clk_hw *uniphier_clk_register(struct device *dev,\n\t\t\t\t\t    struct regmap *regmap,\n\t\t\t\t\tconst struct uniphier_clk_data *data)\n{\n\tswitch (data->type) {\n\tcase UNIPHIER_CLK_TYPE_CPUGEAR:\n\t\treturn uniphier_clk_register_cpugear(dev, regmap, data->name,\n\t\t\t\t\t\t     &data->data.cpugear);\n\tcase UNIPHIER_CLK_TYPE_FIXED_FACTOR:\n\t\treturn uniphier_clk_register_fixed_factor(dev, data->name,\n\t\t\t\t\t\t\t  &data->data.factor);\n\tcase UNIPHIER_CLK_TYPE_FIXED_RATE:\n\t\treturn uniphier_clk_register_fixed_rate(dev, data->name,\n\t\t\t\t\t\t\t&data->data.rate);\n\tcase UNIPHIER_CLK_TYPE_GATE:\n\t\treturn uniphier_clk_register_gate(dev, regmap, data->name,\n\t\t\t\t\t\t  &data->data.gate);\n\tcase UNIPHIER_CLK_TYPE_MUX:\n\t\treturn uniphier_clk_register_mux(dev, regmap, data->name,\n\t\t\t\t\t\t &data->data.mux);\n\tdefault:\n\t\tdev_err(dev, \"unsupported clock type\\n\");\n\t\treturn ERR_PTR(-EINVAL);\n\t}\n}\n\nstatic int uniphier_clk_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct clk_hw_onecell_data *hw_data;\n\tconst struct uniphier_clk_data *p, *data;\n\tstruct regmap *regmap;\n\tstruct device_node *parent;\n\tint clk_num = 0;\n\n\tdata = of_device_get_match_data(dev);\n\tif (WARN_ON(!data))\n\t\treturn -EINVAL;\n\n\tparent = of_get_parent(dev->of_node);  \n\tregmap = syscon_node_to_regmap(parent);\n\tof_node_put(parent);\n\tif (IS_ERR(regmap)) {\n\t\tdev_err(dev, \"failed to get regmap (error %ld)\\n\",\n\t\t\tPTR_ERR(regmap));\n\t\treturn PTR_ERR(regmap);\n\t}\n\n\tfor (p = data; p->name; p++)\n\t\tclk_num = max(clk_num, p->idx + 1);\n\n\thw_data = devm_kzalloc(dev, struct_size(hw_data, hws, clk_num),\n\t\t\tGFP_KERNEL);\n\tif (!hw_data)\n\t\treturn -ENOMEM;\n\n\thw_data->num = clk_num;\n\n\t \n\twhile (--clk_num >= 0)\n\t\thw_data->hws[clk_num] = ERR_PTR(-EINVAL);\n\n\tfor (p = data; p->name; p++) {\n\t\tstruct clk_hw *hw;\n\n\t\tdev_dbg(dev, \"register %s (index=%d)\\n\", p->name, p->idx);\n\t\thw = uniphier_clk_register(dev, regmap, p);\n\t\tif (WARN(IS_ERR(hw), \"failed to register %s\", p->name))\n\t\t\tcontinue;\n\n\t\tif (p->idx >= 0)\n\t\t\thw_data->hws[p->idx] = hw;\n\t}\n\n\treturn devm_of_clk_add_hw_provider(dev, of_clk_hw_onecell_get,\n\t\t\t\t\t   hw_data);\n}\n\nstatic const struct of_device_id uniphier_clk_match[] = {\n\t \n\t{\n\t\t.compatible = \"socionext,uniphier-ld4-clock\",\n\t\t.data = uniphier_ld4_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pro4-clock\",\n\t\t.data = uniphier_pro4_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-sld8-clock\",\n\t\t.data = uniphier_sld8_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pro5-clock\",\n\t\t.data = uniphier_pro5_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pxs2-clock\",\n\t\t.data = uniphier_pxs2_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-ld11-clock\",\n\t\t.data = uniphier_ld11_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-ld20-clock\",\n\t\t.data = uniphier_ld20_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pxs3-clock\",\n\t\t.data = uniphier_pxs3_sys_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-nx1-clock\",\n\t\t.data = uniphier_nx1_sys_clk_data,\n\t},\n\t \n\t{\n\t\t.compatible = \"socionext,uniphier-ld4-mio-clock\",\n\t\t.data = uniphier_ld4_mio_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pro4-mio-clock\",\n\t\t.data = uniphier_ld4_mio_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-sld8-mio-clock\",\n\t\t.data = uniphier_ld4_mio_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pro5-sd-clock\",\n\t\t.data = uniphier_pro5_sd_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pxs2-sd-clock\",\n\t\t.data = uniphier_pro5_sd_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-ld11-mio-clock\",\n\t\t.data = uniphier_ld4_mio_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-ld20-sd-clock\",\n\t\t.data = uniphier_pro5_sd_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pxs3-sd-clock\",\n\t\t.data = uniphier_pro5_sd_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-nx1-sd-clock\",\n\t\t.data = uniphier_pro5_sd_clk_data,\n\t},\n\t \n\t{\n\t\t.compatible = \"socionext,uniphier-ld4-peri-clock\",\n\t\t.data = uniphier_ld4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pro4-peri-clock\",\n\t\t.data = uniphier_pro4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-sld8-peri-clock\",\n\t\t.data = uniphier_ld4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pro5-peri-clock\",\n\t\t.data = uniphier_pro4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pxs2-peri-clock\",\n\t\t.data = uniphier_pro4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-ld11-peri-clock\",\n\t\t.data = uniphier_pro4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-ld20-peri-clock\",\n\t\t.data = uniphier_pro4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-pxs3-peri-clock\",\n\t\t.data = uniphier_pro4_peri_clk_data,\n\t},\n\t{\n\t\t.compatible = \"socionext,uniphier-nx1-peri-clock\",\n\t\t.data = uniphier_pro4_peri_clk_data,\n\t},\n\t \n\t{\n\t\t.compatible = \"socionext,uniphier-pro4-sg-clock\",\n\t\t.data = uniphier_pro4_sg_clk_data,\n\t},\n\t{   }\n};\n\nstatic struct platform_driver uniphier_clk_driver = {\n\t.probe = uniphier_clk_probe,\n\t.driver = {\n\t\t.name = \"uniphier-clk\",\n\t\t.of_match_table = uniphier_clk_match,\n\t},\n};\nbuiltin_platform_driver(uniphier_clk_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}