{
  "module_name": "clk-uniphier-gate.c",
  "hash_id": "94f8d30883ed5829f5b328bc4f63e86faeb6a9fa7b7c39c843843d221fa5b438",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/uniphier/clk-uniphier-gate.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/device.h>\n#include <linux/regmap.h>\n\n#include \"clk-uniphier.h\"\n\nstruct uniphier_clk_gate {\n\tstruct clk_hw hw;\n\tstruct regmap *regmap;\n\tunsigned int reg;\n\tunsigned int bit;\n};\n\n#define to_uniphier_clk_gate(_hw) \\\n\t\t\t\tcontainer_of(_hw, struct uniphier_clk_gate, hw)\n\nstatic int uniphier_clk_gate_endisable(struct clk_hw *hw, int enable)\n{\n\tstruct uniphier_clk_gate *gate = to_uniphier_clk_gate(hw);\n\n\treturn regmap_write_bits(gate->regmap, gate->reg, BIT(gate->bit),\n\t\t\t\t enable ? BIT(gate->bit) : 0);\n}\n\nstatic int uniphier_clk_gate_enable(struct clk_hw *hw)\n{\n\treturn uniphier_clk_gate_endisable(hw, 1);\n}\n\nstatic void uniphier_clk_gate_disable(struct clk_hw *hw)\n{\n\tif (uniphier_clk_gate_endisable(hw, 0) < 0)\n\t\tpr_warn(\"failed to disable clk\\n\");\n}\n\nstatic int uniphier_clk_gate_is_enabled(struct clk_hw *hw)\n{\n\tstruct uniphier_clk_gate *gate = to_uniphier_clk_gate(hw);\n\tunsigned int val;\n\n\tif (regmap_read(gate->regmap, gate->reg, &val) < 0)\n\t\tpr_warn(\"is_enabled() may return wrong result\\n\");\n\n\treturn !!(val & BIT(gate->bit));\n}\n\nstatic const struct clk_ops uniphier_clk_gate_ops = {\n\t.enable = uniphier_clk_gate_enable,\n\t.disable = uniphier_clk_gate_disable,\n\t.is_enabled = uniphier_clk_gate_is_enabled,\n};\n\nstruct clk_hw *uniphier_clk_register_gate(struct device *dev,\n\t\t\t\t\t  struct regmap *regmap,\n\t\t\t\t\t  const char *name,\n\t\t\t\tconst struct uniphier_clk_gate_data *data)\n{\n\tstruct uniphier_clk_gate *gate;\n\tstruct clk_init_data init;\n\tint ret;\n\n\tgate = devm_kzalloc(dev, sizeof(*gate), GFP_KERNEL);\n\tif (!gate)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinit.name = name;\n\tinit.ops = &uniphier_clk_gate_ops;\n\tinit.flags = data->parent_name ? CLK_SET_RATE_PARENT : 0;\n\tinit.parent_names = data->parent_name ? &data->parent_name : NULL;\n\tinit.num_parents = data->parent_name ? 1 : 0;\n\n\tgate->regmap = regmap;\n\tgate->reg = data->reg;\n\tgate->bit = data->bit;\n\tgate->hw.init = &init;\n\n\tret = devm_clk_hw_register(dev, &gate->hw);\n\tif (ret)\n\t\treturn ERR_PTR(ret);\n\n\treturn &gate->hw;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}