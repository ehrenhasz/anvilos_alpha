{
  "module_name": "clk-starfive-jh7110-sys.c",
  "hash_id": "0e93098f282cfba2745ad0e47dab597993e3272210f1ee421defc55d6b4aed94",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/starfive/clk-starfive-jh7110-sys.c",
  "human_readable_source": "\n \n\n#include <linux/auxiliary_bus.h>\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n\n#include <soc/starfive/reset-starfive-jh71x0.h>\n\n#include <dt-bindings/clock/starfive,jh7110-crg.h>\n\n#include \"clk-starfive-jh7110.h\"\n\n \n#define JH7110_SYSCLK_OSC\t\t\t(JH7110_SYSCLK_END + 0)\n#define JH7110_SYSCLK_GMAC1_RMII_REFIN\t\t(JH7110_SYSCLK_END + 1)\n#define JH7110_SYSCLK_GMAC1_RGMII_RXIN\t\t(JH7110_SYSCLK_END + 2)\n#define JH7110_SYSCLK_I2STX_BCLK_EXT\t\t(JH7110_SYSCLK_END + 3)\n#define JH7110_SYSCLK_I2STX_LRCK_EXT\t\t(JH7110_SYSCLK_END + 4)\n#define JH7110_SYSCLK_I2SRX_BCLK_EXT\t\t(JH7110_SYSCLK_END + 5)\n#define JH7110_SYSCLK_I2SRX_LRCK_EXT\t\t(JH7110_SYSCLK_END + 6)\n#define JH7110_SYSCLK_TDM_EXT\t\t\t(JH7110_SYSCLK_END + 7)\n#define JH7110_SYSCLK_MCLK_EXT\t\t\t(JH7110_SYSCLK_END + 8)\n#define JH7110_SYSCLK_PLL0_OUT\t\t\t(JH7110_SYSCLK_END + 9)\n#define JH7110_SYSCLK_PLL1_OUT\t\t\t(JH7110_SYSCLK_END + 10)\n#define JH7110_SYSCLK_PLL2_OUT\t\t\t(JH7110_SYSCLK_END + 11)\n\nstatic const struct jh71x0_clk_data jh7110_sysclk_data[] __initconst = {\n\t \n\tJH71X0__MUX(JH7110_SYSCLK_CPU_ROOT, \"cpu_root\", 2,\n\t\t    JH7110_SYSCLK_OSC,\n\t\t    JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_CPU_CORE, \"cpu_core\", 7, JH7110_SYSCLK_CPU_ROOT),\n\tJH71X0__DIV(JH7110_SYSCLK_CPU_BUS, \"cpu_bus\", 2, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0__MUX(JH7110_SYSCLK_GPU_ROOT, \"gpu_root\", 2,\n\t\t    JH7110_SYSCLK_PLL2_OUT,\n\t\t    JH7110_SYSCLK_PLL1_OUT),\n\tJH71X0_MDIV(JH7110_SYSCLK_PERH_ROOT, \"perh_root\", 2, 2,\n\t\t    JH7110_SYSCLK_PLL0_OUT,\n\t\t    JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0__MUX(JH7110_SYSCLK_BUS_ROOT, \"bus_root\", 2,\n\t\t    JH7110_SYSCLK_OSC,\n\t\t    JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_NOCSTG_BUS, \"nocstg_bus\", 3, JH7110_SYSCLK_BUS_ROOT),\n\tJH71X0__DIV(JH7110_SYSCLK_AXI_CFG0, \"axi_cfg0\", 3, JH7110_SYSCLK_BUS_ROOT),\n\tJH71X0__DIV(JH7110_SYSCLK_STG_AXIAHB, \"stg_axiahb\", 2, JH7110_SYSCLK_AXI_CFG0),\n\tJH71X0_GATE(JH7110_SYSCLK_AHB0, \"ahb0\", CLK_IS_CRITICAL, JH7110_SYSCLK_STG_AXIAHB),\n\tJH71X0_GATE(JH7110_SYSCLK_AHB1, \"ahb1\", CLK_IS_CRITICAL, JH7110_SYSCLK_STG_AXIAHB),\n\tJH71X0__DIV(JH7110_SYSCLK_APB_BUS, \"apb_bus\", 8, JH7110_SYSCLK_STG_AXIAHB),\n\tJH71X0_GATE(JH7110_SYSCLK_APB0, \"apb0\", CLK_IS_CRITICAL, JH7110_SYSCLK_APB_BUS),\n\tJH71X0__DIV(JH7110_SYSCLK_PLL0_DIV2, \"pll0_div2\", 2, JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_PLL1_DIV2, \"pll1_div2\", 2, JH7110_SYSCLK_PLL1_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_PLL2_DIV2, \"pll2_div2\", 2, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_AUDIO_ROOT, \"audio_root\", 8, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_MCLK_INNER, \"mclk_inner\", 64, JH7110_SYSCLK_AUDIO_ROOT),\n\tJH71X0__MUX(JH7110_SYSCLK_MCLK, \"mclk\", 2,\n\t\t    JH7110_SYSCLK_MCLK_INNER,\n\t\t    JH7110_SYSCLK_MCLK_EXT),\n\tJH71X0_GATE(JH7110_SYSCLK_MCLK_OUT, \"mclk_out\", 0, JH7110_SYSCLK_MCLK_INNER),\n\tJH71X0_MDIV(JH7110_SYSCLK_ISP_2X, \"isp_2x\", 8, 2,\n\t\t    JH7110_SYSCLK_PLL2_OUT,\n\t\t    JH7110_SYSCLK_PLL1_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_ISP_AXI, \"isp_axi\", 4, JH7110_SYSCLK_ISP_2X),\n\tJH71X0_GDIV(JH7110_SYSCLK_GCLK0, \"gclk0\", 0, 62, JH7110_SYSCLK_PLL0_DIV2),\n\tJH71X0_GDIV(JH7110_SYSCLK_GCLK1, \"gclk1\", 0, 62, JH7110_SYSCLK_PLL1_DIV2),\n\tJH71X0_GDIV(JH7110_SYSCLK_GCLK2, \"gclk2\", 0, 62, JH7110_SYSCLK_PLL2_DIV2),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_CORE, \"core\", CLK_IS_CRITICAL, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_CORE1, \"core1\", CLK_IS_CRITICAL, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_CORE2, \"core2\", CLK_IS_CRITICAL, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_CORE3, \"core3\", CLK_IS_CRITICAL, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_CORE4, \"core4\", CLK_IS_CRITICAL, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_DEBUG, \"debug\", 0, JH7110_SYSCLK_CPU_BUS),\n\tJH71X0__DIV(JH7110_SYSCLK_RTC_TOGGLE, \"rtc_toggle\", 6, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_TRACE0, \"trace0\", 0, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_TRACE1, \"trace1\", 0, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_TRACE2, \"trace2\", 0, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_TRACE3, \"trace3\", 0, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_TRACE4, \"trace4\", 0, JH7110_SYSCLK_CPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_TRACE_COM, \"trace_com\", 0, JH7110_SYSCLK_CPU_BUS),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_CPU_AXI, \"noc_bus_cpu_axi\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_CPU_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_AXICFG0_AXI, \"noc_bus_axicfg0_axi\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_AXI_CFG0),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_OSC_DIV2, \"osc_div2\", 2, JH7110_SYSCLK_OSC),\n\tJH71X0__DIV(JH7110_SYSCLK_PLL1_DIV4, \"pll1_div4\", 2, JH7110_SYSCLK_PLL1_DIV2),\n\tJH71X0__DIV(JH7110_SYSCLK_PLL1_DIV8, \"pll1_div8\", 2, JH7110_SYSCLK_PLL1_DIV4),\n\tJH71X0__MUX(JH7110_SYSCLK_DDR_BUS, \"ddr_bus\", 4,\n\t\t    JH7110_SYSCLK_OSC_DIV2,\n\t\t    JH7110_SYSCLK_PLL1_DIV2,\n\t\t    JH7110_SYSCLK_PLL1_DIV4,\n\t\t    JH7110_SYSCLK_PLL1_DIV8),\n\tJH71X0_GATE(JH7110_SYSCLK_DDR_AXI, \"ddr_axi\", CLK_IS_CRITICAL, JH7110_SYSCLK_DDR_BUS),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_GPU_CORE, \"gpu_core\", 7, JH7110_SYSCLK_GPU_ROOT),\n\tJH71X0_GATE(JH7110_SYSCLK_GPU_CORE_CLK, \"gpu_core_clk\", 0, JH7110_SYSCLK_GPU_CORE),\n\tJH71X0_GATE(JH7110_SYSCLK_GPU_SYS_CLK, \"gpu_sys_clk\", 0, JH7110_SYSCLK_ISP_AXI),\n\tJH71X0_GATE(JH7110_SYSCLK_GPU_APB, \"gpu_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GDIV(JH7110_SYSCLK_GPU_RTC_TOGGLE, \"gpu_rtc_toggle\", 0, 12, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_GPU_AXI, \"noc_bus_gpu_axi\", 0, JH7110_SYSCLK_GPU_CORE),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_ISP_TOP_CORE, \"isp_top_core\", 0, JH7110_SYSCLK_ISP_2X),\n\tJH71X0_GATE(JH7110_SYSCLK_ISP_TOP_AXI, \"isp_top_axi\", 0, JH7110_SYSCLK_ISP_AXI),\n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_ISP_AXI, \"noc_bus_isp_axi\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_ISP_AXI),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_HIFI4_CORE, \"hifi4_core\", 15, JH7110_SYSCLK_BUS_ROOT),\n\tJH71X0__DIV(JH7110_SYSCLK_HIFI4_AXI, \"hifi4_axi\", 2, JH7110_SYSCLK_HIFI4_CORE),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_AXI_CFG1_MAIN, \"axi_cfg1_main\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_ISP_AXI),\n\tJH71X0_GATE(JH7110_SYSCLK_AXI_CFG1_AHB, \"axi_cfg1_ahb\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_AHB0),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_VOUT_SRC, \"vout_src\", 0, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_VOUT_AXI, \"vout_axi\", 7, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_DISP_AXI, \"noc_bus_disp_axi\", 0, JH7110_SYSCLK_VOUT_AXI),\n\tJH71X0_GATE(JH7110_SYSCLK_VOUT_TOP_AHB, \"vout_top_ahb\", 0, JH7110_SYSCLK_AHB1),\n\tJH71X0_GATE(JH7110_SYSCLK_VOUT_TOP_AXI, \"vout_top_axi\", 0, JH7110_SYSCLK_VOUT_AXI),\n\tJH71X0_GATE(JH7110_SYSCLK_VOUT_TOP_HDMITX0_MCLK, \"vout_top_hdmitx0_mclk\", 0,\n\t\t    JH7110_SYSCLK_MCLK),\n\tJH71X0__DIV(JH7110_SYSCLK_VOUT_TOP_MIPIPHY_REF, \"vout_top_mipiphy_ref\", 2,\n\t\t    JH7110_SYSCLK_OSC),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_JPEGC_AXI, \"jpegc_axi\", 16, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0_GATE(JH7110_SYSCLK_CODAJ12_AXI, \"codaj12_axi\", 0, JH7110_SYSCLK_JPEGC_AXI),\n\tJH71X0_GDIV(JH7110_SYSCLK_CODAJ12_CORE, \"codaj12_core\", 0, 16, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0_GATE(JH7110_SYSCLK_CODAJ12_APB, \"codaj12_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_VDEC_AXI, \"vdec_axi\", 7, JH7110_SYSCLK_BUS_ROOT),\n\tJH71X0_GATE(JH7110_SYSCLK_WAVE511_AXI, \"wave511_axi\", 0, JH7110_SYSCLK_VDEC_AXI),\n\tJH71X0_GDIV(JH7110_SYSCLK_WAVE511_BPU, \"wave511_bpu\", 0, 7, JH7110_SYSCLK_BUS_ROOT),\n\tJH71X0_GDIV(JH7110_SYSCLK_WAVE511_VCE, \"wave511_vce\", 0, 7, JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0_GATE(JH7110_SYSCLK_WAVE511_APB, \"wave511_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_VDEC_JPG, \"vdec_jpg\", 0, JH7110_SYSCLK_JPEGC_AXI),\n\tJH71X0_GATE(JH7110_SYSCLK_VDEC_MAIN, \"vdec_main\", 0, JH7110_SYSCLK_VDEC_AXI),\n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_VDEC_AXI, \"noc_bus_vdec_axi\", 0, JH7110_SYSCLK_VDEC_AXI),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_VENC_AXI, \"venc_axi\", 15, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0_GATE(JH7110_SYSCLK_WAVE420L_AXI, \"wave420l_axi\", 0, JH7110_SYSCLK_VENC_AXI),\n\tJH71X0_GDIV(JH7110_SYSCLK_WAVE420L_BPU, \"wave420l_bpu\", 0, 15, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0_GDIV(JH7110_SYSCLK_WAVE420L_VCE, \"wave420l_vce\", 0, 15, JH7110_SYSCLK_PLL2_OUT),\n\tJH71X0_GATE(JH7110_SYSCLK_WAVE420L_APB, \"wave420l_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_VENC_AXI, \"noc_bus_venc_axi\", 0, JH7110_SYSCLK_VENC_AXI),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_AXI_CFG0_MAIN_DIV, \"axi_cfg0_main_div\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_AHB1),\n\tJH71X0_GATE(JH7110_SYSCLK_AXI_CFG0_MAIN, \"axi_cfg0_main\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_AXI_CFG0),\n\tJH71X0_GATE(JH7110_SYSCLK_AXI_CFG0_HIFI4, \"axi_cfg0_hifi4\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_HIFI4_AXI),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_AXIMEM2_AXI, \"aximem2_axi\", 0, JH7110_SYSCLK_AXI_CFG0),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_QSPI_AHB, \"qspi_ahb\", 0, JH7110_SYSCLK_AHB1),\n\tJH71X0_GATE(JH7110_SYSCLK_QSPI_APB, \"qspi_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0__DIV(JH7110_SYSCLK_QSPI_REF_SRC, \"qspi_ref_src\", 16, JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0_GMUX(JH7110_SYSCLK_QSPI_REF, \"qspi_ref\", 0, 2,\n\t\t    JH7110_SYSCLK_OSC,\n\t\t    JH7110_SYSCLK_QSPI_REF_SRC),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_SDIO0_AHB, \"sdio0_ahb\", 0, JH7110_SYSCLK_AHB0),\n\tJH71X0_GATE(JH7110_SYSCLK_SDIO1_AHB, \"sdio1_ahb\", 0, JH7110_SYSCLK_AHB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_SDIO0_SDCARD, \"sdio0_sdcard\", 0, 15, JH7110_SYSCLK_AXI_CFG0),\n\tJH71X0_GDIV(JH7110_SYSCLK_SDIO1_SDCARD, \"sdio1_sdcard\", 0, 15, JH7110_SYSCLK_AXI_CFG0),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_USB_125M, \"usb_125m\", 15, JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0_GATE(JH7110_SYSCLK_NOC_BUS_STG_AXI, \"noc_bus_stg_axi\", CLK_IS_CRITICAL,\n\t\t    JH7110_SYSCLK_NOCSTG_BUS),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_GMAC1_AHB, \"gmac1_ahb\", 0, JH7110_SYSCLK_AHB0),\n\tJH71X0_GATE(JH7110_SYSCLK_GMAC1_AXI, \"gmac1_axi\", 0, JH7110_SYSCLK_STG_AXIAHB),\n\tJH71X0__DIV(JH7110_SYSCLK_GMAC_SRC, \"gmac_src\", 7, JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_GMAC1_GTXCLK, \"gmac1_gtxclk\", 15, JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0__DIV(JH7110_SYSCLK_GMAC1_RMII_RTX, \"gmac1_rmii_rtx\", 30,\n\t\t    JH7110_SYSCLK_GMAC1_RMII_REFIN),\n\tJH71X0_GDIV(JH7110_SYSCLK_GMAC1_PTP, \"gmac1_ptp\", 0, 31, JH7110_SYSCLK_GMAC_SRC),\n\tJH71X0__MUX(JH7110_SYSCLK_GMAC1_RX, \"gmac1_rx\", 2,\n\t\t    JH7110_SYSCLK_GMAC1_RGMII_RXIN,\n\t\t    JH7110_SYSCLK_GMAC1_RMII_RTX),\n\tJH71X0__INV(JH7110_SYSCLK_GMAC1_RX_INV, \"gmac1_rx_inv\", JH7110_SYSCLK_GMAC1_RX),\n\tJH71X0_GMUX(JH7110_SYSCLK_GMAC1_TX, \"gmac1_tx\",\n\t\t    CLK_SET_RATE_PARENT | CLK_SET_RATE_NO_REPARENT, 2,\n\t\t    JH7110_SYSCLK_GMAC1_GTXCLK,\n\t\t    JH7110_SYSCLK_GMAC1_RMII_RTX),\n\tJH71X0__INV(JH7110_SYSCLK_GMAC1_TX_INV, \"gmac1_tx_inv\", JH7110_SYSCLK_GMAC1_TX),\n\tJH71X0_GATE(JH7110_SYSCLK_GMAC1_GTXC, \"gmac1_gtxc\", 0, JH7110_SYSCLK_GMAC1_GTXCLK),\n\t \n\tJH71X0_GDIV(JH7110_SYSCLK_GMAC0_GTXCLK, \"gmac0_gtxclk\", 0, 15, JH7110_SYSCLK_PLL0_OUT),\n\tJH71X0_GDIV(JH7110_SYSCLK_GMAC0_PTP, \"gmac0_ptp\", 0, 31, JH7110_SYSCLK_GMAC_SRC),\n\tJH71X0_GDIV(JH7110_SYSCLK_GMAC_PHY, \"gmac_phy\", 0, 31, JH7110_SYSCLK_GMAC_SRC),\n\tJH71X0_GATE(JH7110_SYSCLK_GMAC0_GTXC, \"gmac0_gtxc\", 0, JH7110_SYSCLK_GMAC0_GTXCLK),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_IOMUX_APB, \"iomux_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_MAILBOX_APB, \"mailbox_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_INT_CTRL_APB, \"int_ctrl_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_CAN0_APB, \"can0_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GDIV(JH7110_SYSCLK_CAN0_TIMER, \"can0_timer\", 0, 24, JH7110_SYSCLK_OSC),\n\tJH71X0_GDIV(JH7110_SYSCLK_CAN0_CAN, \"can0_can\", 0, 63, JH7110_SYSCLK_PERH_ROOT),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_CAN1_APB, \"can1_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GDIV(JH7110_SYSCLK_CAN1_TIMER, \"can1_timer\", 0, 24, JH7110_SYSCLK_OSC),\n\tJH71X0_GDIV(JH7110_SYSCLK_CAN1_CAN, \"can1_can\", 0, 63, JH7110_SYSCLK_PERH_ROOT),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_PWM_APB, \"pwm_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_WDT_APB, \"wdt_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_WDT_CORE, \"wdt_core\", 0, JH7110_SYSCLK_OSC),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_TIMER_APB, \"timer_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_TIMER0, \"timer0\", 0, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_TIMER1, \"timer1\", 0, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_TIMER2, \"timer2\", 0, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_TIMER3, \"timer3\", 0, JH7110_SYSCLK_OSC),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_TEMP_APB, \"temp_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GDIV(JH7110_SYSCLK_TEMP_CORE, \"temp_core\", 0, 24, JH7110_SYSCLK_OSC),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_SPI0_APB, \"spi0_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_SPI1_APB, \"spi1_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_SPI2_APB, \"spi2_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_SPI3_APB, \"spi3_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_SPI4_APB, \"spi4_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_SPI5_APB, \"spi5_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_SPI6_APB, \"spi6_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_I2C0_APB, \"i2c0_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_I2C1_APB, \"i2c1_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_I2C2_APB, \"i2c2_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_I2C3_APB, \"i2c3_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_I2C4_APB, \"i2c4_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_I2C5_APB, \"i2c5_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\tJH71X0_GATE(JH7110_SYSCLK_I2C6_APB, \"i2c6_apb\", 0, JH7110_SYSCLK_APB_BUS),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_UART0_APB, \"uart0_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_UART0_CORE, \"uart0_core\", 0, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_UART1_APB, \"uart1_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_UART1_CORE, \"uart1_core\", 0, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_UART2_APB, \"uart2_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_UART2_CORE, \"uart2_core\", 0, JH7110_SYSCLK_OSC),\n\tJH71X0_GATE(JH7110_SYSCLK_UART3_APB, \"uart3_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_UART3_CORE, \"uart3_core\", 0, 10, JH7110_SYSCLK_PERH_ROOT),\n\tJH71X0_GATE(JH7110_SYSCLK_UART4_APB, \"uart4_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_UART4_CORE, \"uart4_core\", 0, 10, JH7110_SYSCLK_PERH_ROOT),\n\tJH71X0_GATE(JH7110_SYSCLK_UART5_APB, \"uart5_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_UART5_CORE, \"uart5_core\", 0, 10, JH7110_SYSCLK_PERH_ROOT),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_PWMDAC_APB, \"pwmdac_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_PWMDAC_CORE, \"pwmdac_core\", 0, 256, JH7110_SYSCLK_AUDIO_ROOT),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_SPDIF_APB, \"spdif_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GATE(JH7110_SYSCLK_SPDIF_CORE, \"spdif_core\", 0, JH7110_SYSCLK_MCLK),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_I2STX0_APB, \"i2stx0_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_I2STX0_BCLK_MST, \"i2stx0_bclk_mst\", 0, 32, JH7110_SYSCLK_MCLK),\n\tJH71X0__INV(JH7110_SYSCLK_I2STX0_BCLK_MST_INV, \"i2stx0_bclk_mst_inv\",\n\t\t    JH7110_SYSCLK_I2STX0_BCLK_MST),\n\tJH71X0_MDIV(JH7110_SYSCLK_I2STX0_LRCK_MST, \"i2stx0_lrck_mst\", 64, 2,\n\t\t    JH7110_SYSCLK_I2STX0_BCLK_MST_INV,\n\t\t    JH7110_SYSCLK_I2STX0_BCLK_MST),\n\tJH71X0__MUX(JH7110_SYSCLK_I2STX0_BCLK, \"i2stx0_bclk\",\t2,\n\t\t    JH7110_SYSCLK_I2STX0_BCLK_MST,\n\t\t    JH7110_SYSCLK_I2STX_BCLK_EXT),\n\tJH71X0__INV(JH7110_SYSCLK_I2STX0_BCLK_INV, \"i2stx0_bclk_inv\", JH7110_SYSCLK_I2STX0_BCLK),\n\tJH71X0__MUX(JH7110_SYSCLK_I2STX0_LRCK, \"i2stx0_lrck\", 2,\n\t\t    JH7110_SYSCLK_I2STX0_LRCK_MST,\n\t\t    JH7110_SYSCLK_I2STX_LRCK_EXT),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_I2STX1_APB, \"i2stx1_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_I2STX1_BCLK_MST, \"i2stx1_bclk_mst\", 0, 32, JH7110_SYSCLK_MCLK),\n\tJH71X0__INV(JH7110_SYSCLK_I2STX1_BCLK_MST_INV, \"i2stx1_bclk_mst_inv\",\n\t\t    JH7110_SYSCLK_I2STX1_BCLK_MST),\n\tJH71X0_MDIV(JH7110_SYSCLK_I2STX1_LRCK_MST, \"i2stx1_lrck_mst\", 64, 2,\n\t\t    JH7110_SYSCLK_I2STX1_BCLK_MST_INV,\n\t\t    JH7110_SYSCLK_I2STX1_BCLK_MST),\n\tJH71X0__MUX(JH7110_SYSCLK_I2STX1_BCLK, \"i2stx1_bclk\", 2,\n\t\t    JH7110_SYSCLK_I2STX1_BCLK_MST,\n\t\t    JH7110_SYSCLK_I2STX_BCLK_EXT),\n\tJH71X0__INV(JH7110_SYSCLK_I2STX1_BCLK_INV, \"i2stx1_bclk_inv\", JH7110_SYSCLK_I2STX1_BCLK),\n\tJH71X0__MUX(JH7110_SYSCLK_I2STX1_LRCK, \"i2stx1_lrck\", 2,\n\t\t    JH7110_SYSCLK_I2STX1_LRCK_MST,\n\t\t    JH7110_SYSCLK_I2STX_LRCK_EXT),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_I2SRX_APB, \"i2srx_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_I2SRX_BCLK_MST, \"i2srx_bclk_mst\", 0, 32, JH7110_SYSCLK_MCLK),\n\tJH71X0__INV(JH7110_SYSCLK_I2SRX_BCLK_MST_INV, \"i2srx_bclk_mst_inv\",\n\t\t    JH7110_SYSCLK_I2SRX_BCLK_MST),\n\tJH71X0_MDIV(JH7110_SYSCLK_I2SRX_LRCK_MST, \"i2srx_lrck_mst\", 64, 2,\n\t\t    JH7110_SYSCLK_I2SRX_BCLK_MST_INV,\n\t\t    JH7110_SYSCLK_I2SRX_BCLK_MST),\n\tJH71X0__MUX(JH7110_SYSCLK_I2SRX_BCLK, \"i2srx_bclk\", 2,\n\t\t    JH7110_SYSCLK_I2SRX_BCLK_MST,\n\t\t    JH7110_SYSCLK_I2SRX_BCLK_EXT),\n\tJH71X0__INV(JH7110_SYSCLK_I2SRX_BCLK_INV, \"i2srx_bclk_inv\", JH7110_SYSCLK_I2SRX_BCLK),\n\tJH71X0__MUX(JH7110_SYSCLK_I2SRX_LRCK, \"i2srx_lrck\", 2,\n\t\t    JH7110_SYSCLK_I2SRX_LRCK_MST,\n\t\t    JH7110_SYSCLK_I2SRX_LRCK_EXT),\n\t \n\tJH71X0_GDIV(JH7110_SYSCLK_PDM_DMIC, \"pdm_dmic\", 0, 64, JH7110_SYSCLK_MCLK),\n\tJH71X0_GATE(JH7110_SYSCLK_PDM_APB, \"pdm_apb\", 0, JH7110_SYSCLK_APB0),\n\t \n\tJH71X0_GATE(JH7110_SYSCLK_TDM_AHB, \"tdm_ahb\", 0, JH7110_SYSCLK_AHB0),\n\tJH71X0_GATE(JH7110_SYSCLK_TDM_APB, \"tdm_apb\", 0, JH7110_SYSCLK_APB0),\n\tJH71X0_GDIV(JH7110_SYSCLK_TDM_INTERNAL, \"tdm_internal\", 0, 64, JH7110_SYSCLK_MCLK),\n\tJH71X0__MUX(JH7110_SYSCLK_TDM_TDM, \"tdm_tdm\", 2,\n\t\t    JH7110_SYSCLK_TDM_INTERNAL,\n\t\t    JH7110_SYSCLK_TDM_EXT),\n\tJH71X0__INV(JH7110_SYSCLK_TDM_TDM_INV, \"tdm_tdm_inv\", JH7110_SYSCLK_TDM_TDM),\n\t \n\tJH71X0__DIV(JH7110_SYSCLK_JTAG_CERTIFICATION_TRNG, \"jtag_certification_trng\", 4,\n\t\t    JH7110_SYSCLK_OSC),\n};\n\nstatic struct clk_hw *jh7110_sysclk_get(struct of_phandle_args *clkspec, void *data)\n{\n\tstruct jh71x0_clk_priv *priv = data;\n\tunsigned int idx = clkspec->args[0];\n\n\tif (idx < JH7110_SYSCLK_END)\n\t\treturn &priv->reg[idx].hw;\n\n\treturn ERR_PTR(-EINVAL);\n}\n\nstatic void jh7110_reset_unregister_adev(void *_adev)\n{\n\tstruct auxiliary_device *adev = _adev;\n\n\tauxiliary_device_delete(adev);\n\tauxiliary_device_uninit(adev);\n}\n\nstatic void jh7110_reset_adev_release(struct device *dev)\n{\n\tstruct auxiliary_device *adev = to_auxiliary_dev(dev);\n\tstruct jh71x0_reset_adev *rdev = to_jh71x0_reset_adev(adev);\n\n\tkfree(rdev);\n}\n\nint jh7110_reset_controller_register(struct jh71x0_clk_priv *priv,\n\t\t\t\t     const char *adev_name,\n\t\t\t\t     u32 adev_id)\n{\n\tstruct jh71x0_reset_adev *rdev;\n\tstruct auxiliary_device *adev;\n\tint ret;\n\n\trdev = kzalloc(sizeof(*rdev), GFP_KERNEL);\n\tif (!rdev)\n\t\treturn -ENOMEM;\n\n\trdev->base = priv->base;\n\n\tadev = &rdev->adev;\n\tadev->name = adev_name;\n\tadev->dev.parent = priv->dev;\n\tadev->dev.release = jh7110_reset_adev_release;\n\tadev->id = adev_id;\n\n\tret = auxiliary_device_init(adev);\n\tif (ret)\n\t\treturn ret;\n\n\tret = auxiliary_device_add(adev);\n\tif (ret) {\n\t\tauxiliary_device_uninit(adev);\n\t\treturn ret;\n\t}\n\n\treturn devm_add_action_or_reset(priv->dev,\n\t\t\t\t\tjh7110_reset_unregister_adev, adev);\n}\nEXPORT_SYMBOL_GPL(jh7110_reset_controller_register);\n\nstatic int __init jh7110_syscrg_probe(struct platform_device *pdev)\n{\n\tstruct jh71x0_clk_priv *priv;\n\tunsigned int idx;\n\tint ret;\n\tstruct clk *pllclk;\n\n\tpriv = devm_kzalloc(&pdev->dev,\n\t\t\t    struct_size(priv, reg, JH7110_SYSCLK_END),\n\t\t\t    GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tspin_lock_init(&priv->rmw_lock);\n\tpriv->dev = &pdev->dev;\n\tpriv->base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(priv->base))\n\t\treturn PTR_ERR(priv->base);\n\n\t \n\tpllclk = clk_get(priv->dev, \"pll0_out\");\n\tif (IS_ERR(pllclk)) {\n\t\t \n\t\tpriv->pll[0] = devm_clk_hw_register_fixed_factor(priv->dev, \"pll0_out\",\n\t\t\t\t\t\t\t\t \"osc\", 0, 125, 3);\n\t\tif (IS_ERR(priv->pll[0]))\n\t\t\treturn PTR_ERR(priv->pll[0]);\n\t} else {\n\t\tclk_put(pllclk);\n\t\tpriv->pll[0] = NULL;\n\t}\n\n\tpllclk = clk_get(priv->dev, \"pll1_out\");\n\tif (IS_ERR(pllclk)) {\n\t\t \n\t\tpriv->pll[1] = devm_clk_hw_register_fixed_factor(priv->dev, \"pll1_out\",\n\t\t\t\t\t\t\t\t \"osc\", 0, 533, 12);\n\t\tif (IS_ERR(priv->pll[1]))\n\t\t\treturn PTR_ERR(priv->pll[1]);\n\t} else {\n\t\tclk_put(pllclk);\n\t\tpriv->pll[1] = NULL;\n\t}\n\n\tpllclk = clk_get(priv->dev, \"pll2_out\");\n\tif (IS_ERR(pllclk)) {\n\t\t \n\t\tpriv->pll[2] = devm_clk_hw_register_fixed_factor(priv->dev, \"pll2_out\",\n\t\t\t\t\t\t\t\t \"osc\", 0, 99, 2);\n\t\tif (IS_ERR(priv->pll[2]))\n\t\t\treturn PTR_ERR(priv->pll[2]);\n\t} else {\n\t\tclk_put(pllclk);\n\t\tpriv->pll[2] = NULL;\n\t}\n\n\tfor (idx = 0; idx < JH7110_SYSCLK_END; idx++) {\n\t\tu32 max = jh7110_sysclk_data[idx].max;\n\t\tstruct clk_parent_data parents[4] = {};\n\t\tstruct clk_init_data init = {\n\t\t\t.name = jh7110_sysclk_data[idx].name,\n\t\t\t.ops = starfive_jh71x0_clk_ops(max),\n\t\t\t.parent_data = parents,\n\t\t\t.num_parents =\n\t\t\t\t((max & JH71X0_CLK_MUX_MASK) >> JH71X0_CLK_MUX_SHIFT) + 1,\n\t\t\t.flags = jh7110_sysclk_data[idx].flags,\n\t\t};\n\t\tstruct jh71x0_clk *clk = &priv->reg[idx];\n\t\tunsigned int i;\n\n\t\tfor (i = 0; i < init.num_parents; i++) {\n\t\t\tunsigned int pidx = jh7110_sysclk_data[idx].parents[i];\n\n\t\t\tif (pidx < JH7110_SYSCLK_END)\n\t\t\t\tparents[i].hw = &priv->reg[pidx].hw;\n\t\t\telse if (pidx == JH7110_SYSCLK_OSC)\n\t\t\t\tparents[i].fw_name = \"osc\";\n\t\t\telse if (pidx == JH7110_SYSCLK_GMAC1_RMII_REFIN)\n\t\t\t\tparents[i].fw_name = \"gmac1_rmii_refin\";\n\t\t\telse if (pidx == JH7110_SYSCLK_GMAC1_RGMII_RXIN)\n\t\t\t\tparents[i].fw_name = \"gmac1_rgmii_rxin\";\n\t\t\telse if (pidx == JH7110_SYSCLK_I2STX_BCLK_EXT)\n\t\t\t\tparents[i].fw_name = \"i2stx_bclk_ext\";\n\t\t\telse if (pidx == JH7110_SYSCLK_I2STX_LRCK_EXT)\n\t\t\t\tparents[i].fw_name = \"i2stx_lrck_ext\";\n\t\t\telse if (pidx == JH7110_SYSCLK_I2SRX_BCLK_EXT)\n\t\t\t\tparents[i].fw_name = \"i2srx_bclk_ext\";\n\t\t\telse if (pidx == JH7110_SYSCLK_I2SRX_LRCK_EXT)\n\t\t\t\tparents[i].fw_name = \"i2srx_lrck_ext\";\n\t\t\telse if (pidx == JH7110_SYSCLK_TDM_EXT)\n\t\t\t\tparents[i].fw_name = \"tdm_ext\";\n\t\t\telse if (pidx == JH7110_SYSCLK_MCLK_EXT)\n\t\t\t\tparents[i].fw_name = \"mclk_ext\";\n\t\t\telse if (pidx == JH7110_SYSCLK_PLL0_OUT && !priv->pll[0])\n\t\t\t\tparents[i].fw_name = \"pll0_out\";\n\t\t\telse if (pidx == JH7110_SYSCLK_PLL1_OUT && !priv->pll[1])\n\t\t\t\tparents[i].fw_name = \"pll1_out\";\n\t\t\telse if (pidx == JH7110_SYSCLK_PLL2_OUT && !priv->pll[2])\n\t\t\t\tparents[i].fw_name = \"pll2_out\";\n\t\t\telse\n\t\t\t\tparents[i].hw = priv->pll[pidx - JH7110_SYSCLK_PLL0_OUT];\n\t\t}\n\n\t\tclk->hw.init = &init;\n\t\tclk->idx = idx;\n\t\tclk->max_div = max & JH71X0_CLK_DIV_MASK;\n\n\t\tret = devm_clk_hw_register(&pdev->dev, &clk->hw);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = devm_of_clk_add_hw_provider(&pdev->dev, jh7110_sysclk_get, priv);\n\tif (ret)\n\t\treturn ret;\n\n\treturn jh7110_reset_controller_register(priv, \"rst-sys\", 0);\n}\n\nstatic const struct of_device_id jh7110_syscrg_match[] = {\n\t{ .compatible = \"starfive,jh7110-syscrg\" },\n\t{   }\n};\n\nstatic struct platform_driver jh7110_syscrg_driver = {\n\t.driver = {\n\t\t.name = \"clk-starfive-jh7110-sys\",\n\t\t.of_match_table = jh7110_syscrg_match,\n\t\t.suppress_bind_attrs = true,\n\t},\n};\nbuiltin_platform_driver_probe(jh7110_syscrg_driver, jh7110_syscrg_probe);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}