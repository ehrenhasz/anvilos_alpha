{
  "module_name": "interface.c",
  "hash_id": "85a6cf5ea3293afd970ed7607c6004786b4084dddf455e7a0f68cf611844ffa3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/ti/interface.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/slab.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/clk/ti.h>\n#include \"clock.h\"\n\n#undef pr_fmt\n#define pr_fmt(fmt) \"%s: \" fmt, __func__\n\nstatic const struct clk_ops ti_interface_clk_ops = {\n\t.init\t\t= &omap2_init_clk_clkdm,\n\t.enable\t\t= &omap2_dflt_clk_enable,\n\t.disable\t= &omap2_dflt_clk_disable,\n\t.is_enabled\t= &omap2_dflt_clk_is_enabled,\n};\n\nstatic struct clk *_register_interface(struct device_node *node,\n\t\t\t\t       const char *name,\n\t\t\t\t       const char *parent_name,\n\t\t\t\t       struct clk_omap_reg *reg, u8 bit_idx,\n\t\t\t\t       const struct clk_hw_omap_ops *ops)\n{\n\tstruct clk_init_data init = { NULL };\n\tstruct clk_hw_omap *clk_hw;\n\tstruct clk *clk;\n\n\tclk_hw = kzalloc(sizeof(*clk_hw), GFP_KERNEL);\n\tif (!clk_hw)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tclk_hw->hw.init = &init;\n\tclk_hw->ops = ops;\n\tmemcpy(&clk_hw->enable_reg, reg, sizeof(*reg));\n\tclk_hw->enable_bit = bit_idx;\n\n\tinit.name = name;\n\tinit.ops = &ti_interface_clk_ops;\n\tinit.flags = 0;\n\n\tinit.num_parents = 1;\n\tinit.parent_names = &parent_name;\n\n\tclk = of_ti_clk_register_omap_hw(node, &clk_hw->hw, name);\n\n\tif (IS_ERR(clk))\n\t\tkfree(clk_hw);\n\n\treturn clk;\n}\n\nstatic void __init _of_ti_interface_clk_setup(struct device_node *node,\n\t\t\t\t\t      const struct clk_hw_omap_ops *ops)\n{\n\tstruct clk *clk;\n\tconst char *parent_name;\n\tstruct clk_omap_reg reg;\n\tu8 enable_bit = 0;\n\tconst char *name;\n\tu32 val;\n\n\tif (ti_clk_get_reg_addr(node, 0, &reg))\n\t\treturn;\n\n\tif (!of_property_read_u32(node, \"ti,bit-shift\", &val))\n\t\tenable_bit = val;\n\n\tparent_name = of_clk_get_parent_name(node, 0);\n\tif (!parent_name) {\n\t\tpr_err(\"%pOFn must have a parent\\n\", node);\n\t\treturn;\n\t}\n\n\tname = ti_dt_clk_name(node);\n\tclk = _register_interface(node, name, parent_name, &reg,\n\t\t\t\t  enable_bit, ops);\n\n\tif (!IS_ERR(clk))\n\t\tof_clk_add_provider(node, of_clk_src_simple_get, clk);\n}\n\nstatic void __init of_ti_interface_clk_setup(struct device_node *node)\n{\n\t_of_ti_interface_clk_setup(node, &clkhwops_iclk_wait);\n}\nCLK_OF_DECLARE(ti_interface_clk, \"ti,omap3-interface-clock\",\n\t       of_ti_interface_clk_setup);\n\nstatic void __init of_ti_no_wait_interface_clk_setup(struct device_node *node)\n{\n\t_of_ti_interface_clk_setup(node, &clkhwops_iclk);\n}\nCLK_OF_DECLARE(ti_no_wait_interface_clk, \"ti,omap3-no-wait-interface-clock\",\n\t       of_ti_no_wait_interface_clk_setup);\n\n#ifdef CONFIG_ARCH_OMAP3\nstatic void __init of_ti_hsotgusb_interface_clk_setup(struct device_node *node)\n{\n\t_of_ti_interface_clk_setup(node,\n\t\t\t\t   &clkhwops_omap3430es2_iclk_hsotgusb_wait);\n}\nCLK_OF_DECLARE(ti_hsotgusb_interface_clk, \"ti,omap3-hsotgusb-interface-clock\",\n\t       of_ti_hsotgusb_interface_clk_setup);\n\nstatic void __init of_ti_dss_interface_clk_setup(struct device_node *node)\n{\n\t_of_ti_interface_clk_setup(node,\n\t\t\t\t   &clkhwops_omap3430es2_iclk_dss_usbhost_wait);\n}\nCLK_OF_DECLARE(ti_dss_interface_clk, \"ti,omap3-dss-interface-clock\",\n\t       of_ti_dss_interface_clk_setup);\n\nstatic void __init of_ti_ssi_interface_clk_setup(struct device_node *node)\n{\n\t_of_ti_interface_clk_setup(node, &clkhwops_omap3430es2_iclk_ssi_wait);\n}\nCLK_OF_DECLARE(ti_ssi_interface_clk, \"ti,omap3-ssi-interface-clock\",\n\t       of_ti_ssi_interface_clk_setup);\n\nstatic void __init of_ti_am35xx_interface_clk_setup(struct device_node *node)\n{\n\t_of_ti_interface_clk_setup(node, &clkhwops_am35xx_ipss_wait);\n}\nCLK_OF_DECLARE(ti_am35xx_interface_clk, \"ti,am35xx-interface-clock\",\n\t       of_ti_am35xx_interface_clk_setup);\n#endif\n\n#ifdef CONFIG_SOC_OMAP2430\nstatic void __init of_ti_omap2430_interface_clk_setup(struct device_node *node)\n{\n\t_of_ti_interface_clk_setup(node, &clkhwops_omap2430_i2chs_wait);\n}\nCLK_OF_DECLARE(ti_omap2430_interface_clk, \"ti,omap2430-interface-clock\",\n\t       of_ti_omap2430_interface_clk_setup);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}