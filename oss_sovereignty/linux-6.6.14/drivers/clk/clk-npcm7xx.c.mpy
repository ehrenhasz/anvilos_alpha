{
  "module_name": "clk-npcm7xx.c",
  "hash_id": "46946af745343e24f1b435a486fe08abc5eda580cd2991892b0d90da280b3174",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/clk-npcm7xx.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/kernel.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/bitfield.h>\n\n#include <dt-bindings/clock/nuvoton,npcm7xx-clock.h>\n\nstruct npcm7xx_clk_pll {\n\tstruct clk_hw\thw;\n\tvoid __iomem\t*pllcon;\n\tu8\t\tflags;\n};\n\n#define to_npcm7xx_clk_pll(_hw) container_of(_hw, struct npcm7xx_clk_pll, hw)\n\n#define PLLCON_LOKI\tBIT(31)\n#define PLLCON_LOKS\tBIT(30)\n#define PLLCON_FBDV\tGENMASK(27, 16)\n#define PLLCON_OTDV2\tGENMASK(15, 13)\n#define PLLCON_PWDEN\tBIT(12)\n#define PLLCON_OTDV1\tGENMASK(10, 8)\n#define PLLCON_INDV\tGENMASK(5, 0)\n\nstatic unsigned long npcm7xx_clk_pll_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t\t unsigned long parent_rate)\n{\n\tstruct npcm7xx_clk_pll *pll = to_npcm7xx_clk_pll(hw);\n\tunsigned long fbdv, indv, otdv1, otdv2;\n\tunsigned int val;\n\tu64 ret;\n\n\tif (parent_rate == 0) {\n\t\tpr_err(\"%s: parent rate is zero\", __func__);\n\t\treturn 0;\n\t}\n\n\tval = readl_relaxed(pll->pllcon);\n\n\tindv = FIELD_GET(PLLCON_INDV, val);\n\tfbdv = FIELD_GET(PLLCON_FBDV, val);\n\totdv1 = FIELD_GET(PLLCON_OTDV1, val);\n\totdv2 = FIELD_GET(PLLCON_OTDV2, val);\n\n\tret = (u64)parent_rate * fbdv;\n\tdo_div(ret, indv * otdv1 * otdv2);\n\n\treturn ret;\n}\n\nstatic const struct clk_ops npcm7xx_clk_pll_ops = {\n\t.recalc_rate = npcm7xx_clk_pll_recalc_rate,\n};\n\nstatic struct clk_hw *\nnpcm7xx_clk_register_pll(void __iomem *pllcon, const char *name,\n\t\t\t const char *parent_name, unsigned long flags)\n{\n\tstruct npcm7xx_clk_pll *pll;\n\tstruct clk_init_data init;\n\tstruct clk_hw *hw;\n\tint ret;\n\n\tpll = kzalloc(sizeof(*pll), GFP_KERNEL);\n\tif (!pll)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tpr_debug(\"%s reg, name=%s, p=%s\\n\", __func__, name, parent_name);\n\n\tinit.name = name;\n\tinit.ops = &npcm7xx_clk_pll_ops;\n\tinit.parent_names = &parent_name;\n\tinit.num_parents = 1;\n\tinit.flags = flags;\n\n\tpll->pllcon = pllcon;\n\tpll->hw.init = &init;\n\n\thw = &pll->hw;\n\n\tret = clk_hw_register(NULL, hw);\n\tif (ret) {\n\t\tkfree(pll);\n\t\thw = ERR_PTR(ret);\n\t}\n\n\treturn hw;\n}\n\n#define NPCM7XX_CLKEN1          (0x00)\n#define NPCM7XX_CLKEN2          (0x28)\n#define NPCM7XX_CLKEN3          (0x30)\n#define NPCM7XX_CLKSEL          (0x04)\n#define NPCM7XX_CLKDIV1         (0x08)\n#define NPCM7XX_CLKDIV2         (0x2C)\n#define NPCM7XX_CLKDIV3         (0x58)\n#define NPCM7XX_PLLCON0         (0x0C)\n#define NPCM7XX_PLLCON1         (0x10)\n#define NPCM7XX_PLLCON2         (0x54)\n#define NPCM7XX_SWRSTR          (0x14)\n#define NPCM7XX_IRQWAKECON      (0x18)\n#define NPCM7XX_IRQWAKEFLAG     (0x1C)\n#define NPCM7XX_IPSRST1         (0x20)\n#define NPCM7XX_IPSRST2         (0x24)\n#define NPCM7XX_IPSRST3         (0x34)\n#define NPCM7XX_WD0RCR          (0x38)\n#define NPCM7XX_WD1RCR          (0x3C)\n#define NPCM7XX_WD2RCR          (0x40)\n#define NPCM7XX_SWRSTC1         (0x44)\n#define NPCM7XX_SWRSTC2         (0x48)\n#define NPCM7XX_SWRSTC3         (0x4C)\n#define NPCM7XX_SWRSTC4         (0x50)\n#define NPCM7XX_CORSTC          (0x5C)\n#define NPCM7XX_PLLCONG         (0x60)\n#define NPCM7XX_AHBCKFI         (0x64)\n#define NPCM7XX_SECCNT          (0x68)\n#define NPCM7XX_CNTR25M         (0x6C)\n\nstruct npcm7xx_clk_mux_data {\n\tu8 shift;\n\tu8 mask;\n\tu32 *table;\n\tconst char *name;\n\tconst char * const *parent_names;\n\tu8 num_parents;\n\tunsigned long flags;\n\t \n\tint onecell_idx;\n\n};\n\nstruct npcm7xx_clk_div_data {\n\tu32 reg;\n\tu8 shift;\n\tu8 width;\n\tconst char *name;\n\tconst char *parent_name;\n\tu8 clk_divider_flags;\n\tunsigned long flags;\n\t \n\tint onecell_idx;\n};\n\nstruct npcm7xx_clk_pll_data {\n\tu32 reg;\n\tconst char *name;\n\tconst char *parent_name;\n\tunsigned long flags;\n\t \n\tint onecell_idx;\n};\n\n \n#define NPCM7XX_CLK_S_REFCLK      \"refclk\"\n#define NPCM7XX_CLK_S_SYSBYPCK    \"sysbypck\"\n#define NPCM7XX_CLK_S_MCBYPCK     \"mcbypck\"\n#define NPCM7XX_CLK_S_GFXBYPCK    \"gfxbypck\"\n#define NPCM7XX_CLK_S_PLL0        \"pll0\"\n#define NPCM7XX_CLK_S_PLL1        \"pll1\"\n#define NPCM7XX_CLK_S_PLL1_DIV2   \"pll1_div2\"\n#define NPCM7XX_CLK_S_PLL2        \"pll2\"\n#define NPCM7XX_CLK_S_PLL_GFX     \"pll_gfx\"\n#define NPCM7XX_CLK_S_PLL2_DIV2   \"pll2_div2\"\n#define NPCM7XX_CLK_S_PIX_MUX     \"gfx_pixel\"\n#define NPCM7XX_CLK_S_GPRFSEL_MUX \"gprfsel_mux\"\n#define NPCM7XX_CLK_S_MC_MUX      \"mc_phy\"\n#define NPCM7XX_CLK_S_CPU_MUX     \"cpu\"   \n#define NPCM7XX_CLK_S_MC          \"mc\"\n#define NPCM7XX_CLK_S_AXI         \"axi\"   \n#define NPCM7XX_CLK_S_AHB         \"ahb\"   \n#define NPCM7XX_CLK_S_CLKOUT_MUX  \"clkout_mux\"\n#define NPCM7XX_CLK_S_UART_MUX    \"uart_mux\"\n#define NPCM7XX_CLK_S_TIM_MUX     \"timer_mux\"\n#define NPCM7XX_CLK_S_SD_MUX      \"sd_mux\"\n#define NPCM7XX_CLK_S_GFXM_MUX    \"gfxm_mux\"\n#define NPCM7XX_CLK_S_SU_MUX      \"serial_usb_mux\"\n#define NPCM7XX_CLK_S_DVC_MUX     \"dvc_mux\"\n#define NPCM7XX_CLK_S_GFX_MUX     \"gfx_mux\"\n#define NPCM7XX_CLK_S_GFX_PIXEL   \"gfx_pixel\"\n#define NPCM7XX_CLK_S_SPI0        \"spi0\"\n#define NPCM7XX_CLK_S_SPI3        \"spi3\"\n#define NPCM7XX_CLK_S_SPIX        \"spix\"\n#define NPCM7XX_CLK_S_APB1        \"apb1\"\n#define NPCM7XX_CLK_S_APB2        \"apb2\"\n#define NPCM7XX_CLK_S_APB3        \"apb3\"\n#define NPCM7XX_CLK_S_APB4        \"apb4\"\n#define NPCM7XX_CLK_S_APB5        \"apb5\"\n#define NPCM7XX_CLK_S_TOCK        \"tock\"\n#define NPCM7XX_CLK_S_CLKOUT      \"clkout\"\n#define NPCM7XX_CLK_S_UART        \"uart\"\n#define NPCM7XX_CLK_S_TIMER       \"timer\"\n#define NPCM7XX_CLK_S_MMC         \"mmc\"\n#define NPCM7XX_CLK_S_SDHC        \"sdhc\"\n#define NPCM7XX_CLK_S_ADC         \"adc\"\n#define NPCM7XX_CLK_S_GFX         \"gfx0_gfx1_mem\"\n#define NPCM7XX_CLK_S_USBIF       \"serial_usbif\"\n#define NPCM7XX_CLK_S_USB_HOST    \"usb_host\"\n#define NPCM7XX_CLK_S_USB_BRIDGE  \"usb_bridge\"\n#define NPCM7XX_CLK_S_PCI         \"pci\"\n\nstatic u32 pll_mux_table[] = {0, 1, 2, 3};\nstatic const char * const pll_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_PLL0,\n\tNPCM7XX_CLK_S_PLL1_DIV2,\n\tNPCM7XX_CLK_S_REFCLK,\n\tNPCM7XX_CLK_S_PLL2_DIV2,\n};\n\nstatic u32 cpuck_mux_table[] = {0, 1, 2, 3};\nstatic const char * const cpuck_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_PLL0,\n\tNPCM7XX_CLK_S_PLL1_DIV2,\n\tNPCM7XX_CLK_S_REFCLK,\n\tNPCM7XX_CLK_S_SYSBYPCK,\n};\n\nstatic u32 pixcksel_mux_table[] = {0, 2};\nstatic const char * const pixcksel_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_PLL_GFX,\n\tNPCM7XX_CLK_S_REFCLK,\n};\n\nstatic u32 sucksel_mux_table[] = {2, 3};\nstatic const char * const sucksel_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_REFCLK,\n\tNPCM7XX_CLK_S_PLL2_DIV2,\n};\n\nstatic u32 mccksel_mux_table[] = {0, 2, 3};\nstatic const char * const mccksel_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_PLL1_DIV2,\n\tNPCM7XX_CLK_S_REFCLK,\n\tNPCM7XX_CLK_S_MCBYPCK,\n};\n\nstatic u32 clkoutsel_mux_table[] = {0, 1, 2, 3, 4};\nstatic const char * const clkoutsel_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_PLL0,\n\tNPCM7XX_CLK_S_PLL1_DIV2,\n\tNPCM7XX_CLK_S_REFCLK,\n\tNPCM7XX_CLK_S_PLL_GFX, \n\tNPCM7XX_CLK_S_PLL2_DIV2,\n};\n\nstatic u32 gfxmsel_mux_table[] = {2, 3};\nstatic const char * const gfxmsel_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_REFCLK,\n\tNPCM7XX_CLK_S_PLL2_DIV2,\n};\n\nstatic u32 dvcssel_mux_table[] = {2, 3};\nstatic const char * const dvcssel_mux_parents[] __initconst = {\n\tNPCM7XX_CLK_S_REFCLK,\n\tNPCM7XX_CLK_S_PLL2,\n};\n\nstatic const struct npcm7xx_clk_pll_data npcm7xx_plls[] __initconst = {\n\t{NPCM7XX_PLLCON0, NPCM7XX_CLK_S_PLL0, NPCM7XX_CLK_S_REFCLK, 0, -1},\n\n\t{NPCM7XX_PLLCON1, NPCM7XX_CLK_S_PLL1,\n\tNPCM7XX_CLK_S_REFCLK, 0, -1},\n\n\t{NPCM7XX_PLLCON2, NPCM7XX_CLK_S_PLL2,\n\tNPCM7XX_CLK_S_REFCLK, 0, -1},\n\n\t{NPCM7XX_PLLCONG, NPCM7XX_CLK_S_PLL_GFX,\n\tNPCM7XX_CLK_S_REFCLK, 0, -1},\n};\n\nstatic const struct npcm7xx_clk_mux_data npcm7xx_muxes[] __initconst = {\n\t{0, GENMASK(1, 0), cpuck_mux_table, NPCM7XX_CLK_S_CPU_MUX,\n\tcpuck_mux_parents, ARRAY_SIZE(cpuck_mux_parents), CLK_IS_CRITICAL,\n\tNPCM7XX_CLK_CPU},\n\n\t{4, GENMASK(1, 0), pixcksel_mux_table, NPCM7XX_CLK_S_PIX_MUX,\n\tpixcksel_mux_parents, ARRAY_SIZE(pixcksel_mux_parents), 0,\n\tNPCM7XX_CLK_GFX_PIXEL},\n\n\t{6, GENMASK(1, 0), pll_mux_table, NPCM7XX_CLK_S_SD_MUX,\n\tpll_mux_parents, ARRAY_SIZE(pll_mux_parents), 0, -1},\n\n\t{8, GENMASK(1, 0), pll_mux_table, NPCM7XX_CLK_S_UART_MUX,\n\tpll_mux_parents, ARRAY_SIZE(pll_mux_parents), 0, -1},\n\n\t{10, GENMASK(1, 0), sucksel_mux_table, NPCM7XX_CLK_S_SU_MUX,\n\tsucksel_mux_parents, ARRAY_SIZE(sucksel_mux_parents), 0, -1},\n\n\t{12, GENMASK(1, 0), mccksel_mux_table, NPCM7XX_CLK_S_MC_MUX,\n\tmccksel_mux_parents, ARRAY_SIZE(mccksel_mux_parents), 0, -1},\n\n\t{14, GENMASK(1, 0), pll_mux_table, NPCM7XX_CLK_S_TIM_MUX,\n\tpll_mux_parents, ARRAY_SIZE(pll_mux_parents), 0, -1},\n\n\t{16, GENMASK(1, 0), pll_mux_table, NPCM7XX_CLK_S_GFX_MUX,\n\tpll_mux_parents, ARRAY_SIZE(pll_mux_parents), 0, -1},\n\n\t{18, GENMASK(2, 0), clkoutsel_mux_table, NPCM7XX_CLK_S_CLKOUT_MUX,\n\tclkoutsel_mux_parents, ARRAY_SIZE(clkoutsel_mux_parents), 0, -1},\n\n\t{21, GENMASK(1, 0), gfxmsel_mux_table, NPCM7XX_CLK_S_GFXM_MUX,\n\tgfxmsel_mux_parents, ARRAY_SIZE(gfxmsel_mux_parents), 0, -1},\n\n\t{23, GENMASK(1, 0), dvcssel_mux_table, NPCM7XX_CLK_S_DVC_MUX,\n\tdvcssel_mux_parents, ARRAY_SIZE(dvcssel_mux_parents), 0, -1},\n};\n\n \nstatic const struct npcm7xx_clk_div_data npcm7xx_divs[] __initconst = {\n\t{NPCM7XX_CLKDIV1, 28, 3, NPCM7XX_CLK_S_ADC,\n\tNPCM7XX_CLK_S_TIMER, CLK_DIVIDER_POWER_OF_TWO, 0, NPCM7XX_CLK_ADC},\n\t \n\t{NPCM7XX_CLKDIV1, 26, 2, NPCM7XX_CLK_S_AHB,\n\tNPCM7XX_CLK_S_AXI, 0, CLK_IS_CRITICAL, NPCM7XX_CLK_AHB},\n\t \n\t{NPCM7XX_CLKDIV1, 21, 5, NPCM7XX_CLK_S_TIMER,\n\tNPCM7XX_CLK_S_TIM_MUX, 0, 0, NPCM7XX_CLK_TIMER},\n\t \n\t{NPCM7XX_CLKDIV1, 16, 5, NPCM7XX_CLK_S_UART,\n\tNPCM7XX_CLK_S_UART_MUX, 0, 0, NPCM7XX_CLK_UART},\n\t \n\t{NPCM7XX_CLKDIV1, 11, 5, NPCM7XX_CLK_S_MMC,\n\tNPCM7XX_CLK_S_SD_MUX, 0, 0, NPCM7XX_CLK_MMC},\n\t \n\t{NPCM7XX_CLKDIV1, 6, 5, NPCM7XX_CLK_S_SPI3,\n\tNPCM7XX_CLK_S_AHB, 0, 0, NPCM7XX_CLK_SPI3},\n\t \n\t{NPCM7XX_CLKDIV1, 2, 4, NPCM7XX_CLK_S_PCI,\n\tNPCM7XX_CLK_S_GFX_MUX, 0, 0, NPCM7XX_CLK_PCI},\n\t \n\t{NPCM7XX_CLKDIV1, 0, 1, NPCM7XX_CLK_S_AXI,\n\tNPCM7XX_CLK_S_CPU_MUX, CLK_DIVIDER_POWER_OF_TWO, CLK_IS_CRITICAL,\n\tNPCM7XX_CLK_AXI}, \n\n\t{NPCM7XX_CLKDIV2, 30, 2, NPCM7XX_CLK_S_APB4,\n\tNPCM7XX_CLK_S_AHB, CLK_DIVIDER_POWER_OF_TWO, 0, NPCM7XX_CLK_APB4},\n\t \n\t{NPCM7XX_CLKDIV2, 28, 2, NPCM7XX_CLK_S_APB3,\n\tNPCM7XX_CLK_S_AHB, CLK_DIVIDER_POWER_OF_TWO, 0, NPCM7XX_CLK_APB3},\n\t \n\t{NPCM7XX_CLKDIV2, 26, 2, NPCM7XX_CLK_S_APB2,\n\tNPCM7XX_CLK_S_AHB, CLK_DIVIDER_POWER_OF_TWO, 0, NPCM7XX_CLK_APB2},\n\t \n\t{NPCM7XX_CLKDIV2, 24, 2, NPCM7XX_CLK_S_APB1,\n\tNPCM7XX_CLK_S_AHB, CLK_DIVIDER_POWER_OF_TWO, 0, NPCM7XX_CLK_APB1},\n\t \n\t{NPCM7XX_CLKDIV2, 22, 2, NPCM7XX_CLK_S_APB5,\n\tNPCM7XX_CLK_S_AHB, CLK_DIVIDER_POWER_OF_TWO, 0, NPCM7XX_CLK_APB5},\n\t \n\t{NPCM7XX_CLKDIV2, 16, 5, NPCM7XX_CLK_S_CLKOUT,\n\tNPCM7XX_CLK_S_CLKOUT_MUX, 0, 0, NPCM7XX_CLK_CLKOUT},\n\t \n\t{NPCM7XX_CLKDIV2, 13, 3, NPCM7XX_CLK_S_GFX,\n\tNPCM7XX_CLK_S_GFX_MUX, 0, 0, NPCM7XX_CLK_GFX},\n\t \n\t{NPCM7XX_CLKDIV2, 8, 5, NPCM7XX_CLK_S_USB_BRIDGE,\n\tNPCM7XX_CLK_S_SU_MUX, 0, 0, NPCM7XX_CLK_SU},\n\t \n\t{NPCM7XX_CLKDIV2, 4, 4, NPCM7XX_CLK_S_USB_HOST,\n\tNPCM7XX_CLK_S_SU_MUX, 0, 0, NPCM7XX_CLK_SU48},\n\t \n\t{NPCM7XX_CLKDIV2, 0, 4, NPCM7XX_CLK_S_SDHC,\n\tNPCM7XX_CLK_S_SD_MUX, 0, 0, NPCM7XX_CLK_SDHC}\n\t, \n\n\t{NPCM7XX_CLKDIV3, 6, 5, NPCM7XX_CLK_S_SPI0,\n\tNPCM7XX_CLK_S_AHB, 0, 0, NPCM7XX_CLK_SPI0},\n\t \n\t{NPCM7XX_CLKDIV3, 1, 5, NPCM7XX_CLK_S_SPIX,\n\tNPCM7XX_CLK_S_AHB, 0, 0, NPCM7XX_CLK_SPIX},\n\t \n\n};\n\nstatic DEFINE_SPINLOCK(npcm7xx_clk_lock);\n\nstatic void __init npcm7xx_clk_init(struct device_node *clk_np)\n{\n\tstruct clk_hw_onecell_data *npcm7xx_clk_data;\n\tvoid __iomem *clk_base;\n\tstruct resource res;\n\tstruct clk_hw *hw;\n\tint ret;\n\tint i;\n\n\tret = of_address_to_resource(clk_np, 0, &res);\n\tif (ret) {\n\t\tpr_err(\"%pOFn: failed to get resource, ret %d\\n\", clk_np,\n\t\t\tret);\n\t\treturn;\n\t}\n\n\tclk_base = ioremap(res.start, resource_size(&res));\n\tif (!clk_base)\n\t\tgoto npcm7xx_init_error;\n\n\tnpcm7xx_clk_data = kzalloc(struct_size(npcm7xx_clk_data, hws,\n\t\t\t\t   NPCM7XX_NUM_CLOCKS), GFP_KERNEL);\n\tif (!npcm7xx_clk_data)\n\t\tgoto npcm7xx_init_np_err;\n\n\tnpcm7xx_clk_data->num = NPCM7XX_NUM_CLOCKS;\n\n\tfor (i = 0; i < NPCM7XX_NUM_CLOCKS; i++)\n\t\tnpcm7xx_clk_data->hws[i] = ERR_PTR(-EPROBE_DEFER);\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(npcm7xx_plls); i++) {\n\t\tconst struct npcm7xx_clk_pll_data *pll_data = &npcm7xx_plls[i];\n\n\t\thw = npcm7xx_clk_register_pll(clk_base + pll_data->reg,\n\t\t\tpll_data->name, pll_data->parent_name, pll_data->flags);\n\t\tif (IS_ERR(hw)) {\n\t\t\tpr_err(\"npcm7xx_clk: Can't register pll\\n\");\n\t\t\tgoto npcm7xx_init_fail;\n\t\t}\n\n\t\tif (pll_data->onecell_idx >= 0)\n\t\t\tnpcm7xx_clk_data->hws[pll_data->onecell_idx] = hw;\n\t}\n\n\t \n\thw = clk_hw_register_fixed_factor(NULL, NPCM7XX_CLK_S_PLL1_DIV2,\n\t\t\tNPCM7XX_CLK_S_PLL1, 0, 1, 2);\n\tif (IS_ERR(hw)) {\n\t\tpr_err(\"npcm7xx_clk: Can't register fixed div\\n\");\n\t\tgoto npcm7xx_init_fail;\n\t}\n\n\thw = clk_hw_register_fixed_factor(NULL, NPCM7XX_CLK_S_PLL2_DIV2,\n\t\t\tNPCM7XX_CLK_S_PLL2, 0, 1, 2);\n\tif (IS_ERR(hw)) {\n\t\tpr_err(\"npcm7xx_clk: Can't register div2\\n\");\n\t\tgoto npcm7xx_init_fail;\n\t}\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(npcm7xx_muxes); i++) {\n\t\tconst struct npcm7xx_clk_mux_data *mux_data = &npcm7xx_muxes[i];\n\n\t\thw = clk_hw_register_mux_table(NULL,\n\t\t\tmux_data->name,\n\t\t\tmux_data->parent_names, mux_data->num_parents,\n\t\t\tmux_data->flags, clk_base + NPCM7XX_CLKSEL,\n\t\t\tmux_data->shift, mux_data->mask, 0,\n\t\t\tmux_data->table, &npcm7xx_clk_lock);\n\n\t\tif (IS_ERR(hw)) {\n\t\t\tpr_err(\"npcm7xx_clk: Can't register mux\\n\");\n\t\t\tgoto npcm7xx_init_fail;\n\t\t}\n\n\t\tif (mux_data->onecell_idx >= 0)\n\t\t\tnpcm7xx_clk_data->hws[mux_data->onecell_idx] = hw;\n\t}\n\n\t \n\tfor (i = 0; i < ARRAY_SIZE(npcm7xx_divs); i++) {\n\t\tconst struct npcm7xx_clk_div_data *div_data = &npcm7xx_divs[i];\n\n\t\thw = clk_hw_register_divider(NULL, div_data->name,\n\t\t\t\tdiv_data->parent_name,\n\t\t\t\tdiv_data->flags,\n\t\t\t\tclk_base + div_data->reg,\n\t\t\t\tdiv_data->shift, div_data->width,\n\t\t\t\tdiv_data->clk_divider_flags, &npcm7xx_clk_lock);\n\t\tif (IS_ERR(hw)) {\n\t\t\tpr_err(\"npcm7xx_clk: Can't register div table\\n\");\n\t\t\tgoto npcm7xx_init_fail;\n\t\t}\n\n\t\tif (div_data->onecell_idx >= 0)\n\t\t\tnpcm7xx_clk_data->hws[div_data->onecell_idx] = hw;\n\t}\n\n\tret = of_clk_add_hw_provider(clk_np, of_clk_hw_onecell_get,\n\t\t\t\t\tnpcm7xx_clk_data);\n\tif (ret)\n\t\tpr_err(\"failed to add DT provider: %d\\n\", ret);\n\n\tof_node_put(clk_np);\n\n\treturn;\n\nnpcm7xx_init_fail:\n\tkfree(npcm7xx_clk_data);\nnpcm7xx_init_np_err:\n\tiounmap(clk_base);\nnpcm7xx_init_error:\n\tof_node_put(clk_np);\n}\nCLK_OF_DECLARE(npcm7xx_clk_init, \"nuvoton,npcm750-clk\", npcm7xx_clk_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}