{
  "module_name": "clk-imx25.c",
  "hash_id": "bc9d0aaac550d9aae0b344f177e284bb59fa5cf0a4a5cf7375852690e3f88014",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/imx/clk-imx25.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/list.h>\n#include <linux/clk.h>\n#include <linux/io.h>\n#include <linux/clkdev.h>\n#include <linux/err.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/of_irq.h>\n#include <soc/imx/revision.h>\n\n#include \"clk.h\"\n\n#define CCM_MPCTL\t0x00\n#define CCM_UPCTL\t0x04\n#define CCM_CCTL\t0x08\n#define CCM_CGCR0\t0x0C\n#define CCM_CGCR1\t0x10\n#define CCM_CGCR2\t0x14\n#define CCM_PCDR0\t0x18\n#define CCM_PCDR1\t0x1C\n#define CCM_PCDR2\t0x20\n#define CCM_PCDR3\t0x24\n#define CCM_RCSR\t0x28\n#define CCM_CRDR\t0x2C\n#define CCM_DCVR0\t0x30\n#define CCM_DCVR1\t0x34\n#define CCM_DCVR2\t0x38\n#define CCM_DCVR3\t0x3c\n#define CCM_LTR0\t0x40\n#define CCM_LTR1\t0x44\n#define CCM_LTR2\t0x48\n#define CCM_LTR3\t0x4c\n#define CCM_MCR\t\t0x64\n\n#define ccm(x)\t(ccm_base + (x))\n\nstatic struct clk_onecell_data clk_data;\n\nstatic const char *cpu_sel_clks[] = { \"mpll\", \"mpll_cpu_3_4\", };\nstatic const char *per_sel_clks[] = { \"ahb\", \"upll\", };\nstatic const char *cko_sel_clks[] = { \"dummy\", \"osc\", \"cpu\", \"ahb\",\n\t\t\t\t      \"ipg\", \"dummy\", \"dummy\", \"dummy\",\n\t\t\t\t      \"dummy\", \"dummy\", \"per0\", \"per2\",\n\t\t\t\t      \"per13\", \"per14\", \"usbotg_ahb\", \"dummy\",};\n\nenum mx25_clks {\n\tdummy, osc, mpll, upll, mpll_cpu_3_4, cpu_sel, cpu, ahb, usb_div, ipg,\n\tper0_sel, per1_sel, per2_sel, per3_sel, per4_sel, per5_sel, per6_sel,\n\tper7_sel, per8_sel, per9_sel, per10_sel, per11_sel, per12_sel,\n\tper13_sel, per14_sel, per15_sel, per0, per1, per2, per3, per4, per5,\n\tper6, per7, per8, per9, per10, per11, per12, per13, per14, per15,\n\tcsi_ipg_per, epit_ipg_per, esai_ipg_per, esdhc1_ipg_per, esdhc2_ipg_per,\n\tgpt_ipg_per, i2c_ipg_per, lcdc_ipg_per, nfc_ipg_per, owire_ipg_per,\n\tpwm_ipg_per, sim1_ipg_per, sim2_ipg_per, ssi1_ipg_per, ssi2_ipg_per,\n\tuart_ipg_per, ata_ahb, reserved1, csi_ahb, emi_ahb, esai_ahb, esdhc1_ahb,\n\tesdhc2_ahb, fec_ahb, lcdc_ahb, rtic_ahb, sdma_ahb, slcdc_ahb, usbotg_ahb,\n\treserved2, reserved3, reserved4, reserved5, can1_ipg, can2_ipg,\tcsi_ipg,\n\tcspi1_ipg, cspi2_ipg, cspi3_ipg, dryice_ipg, ect_ipg, epit1_ipg, epit2_ipg,\n\treserved6, esdhc1_ipg, esdhc2_ipg, fec_ipg, reserved7, reserved8, reserved9,\n\tgpt1_ipg, gpt2_ipg, gpt3_ipg, gpt4_ipg, reserved10, reserved11, reserved12,\n\tiim_ipg, reserved13, reserved14, kpp_ipg, lcdc_ipg, reserved15, pwm1_ipg,\n\tpwm2_ipg, pwm3_ipg, pwm4_ipg, rngb_ipg, reserved16, scc_ipg, sdma_ipg,\n\tsim1_ipg, sim2_ipg, slcdc_ipg, spba_ipg, ssi1_ipg, ssi2_ipg, tsc_ipg,\n\tuart1_ipg, uart2_ipg, uart3_ipg, uart4_ipg, uart5_ipg, reserved17,\n\twdt_ipg, cko_div, cko_sel, cko, clk_max\n};\n\nstatic struct clk *clk[clk_max];\n\nstatic void __init __mx25_clocks_init(void __iomem *ccm_base)\n{\n\tBUG_ON(!ccm_base);\n\n\tclk[dummy] = imx_clk_fixed(\"dummy\", 0);\n\tclk[mpll] = imx_clk_pllv1(IMX_PLLV1_IMX25, \"mpll\", \"osc\", ccm(CCM_MPCTL));\n\tclk[upll] = imx_clk_pllv1(IMX_PLLV1_IMX25, \"upll\", \"osc\", ccm(CCM_UPCTL));\n\tclk[mpll_cpu_3_4] = imx_clk_fixed_factor(\"mpll_cpu_3_4\", \"mpll\", 3, 4);\n\tclk[cpu_sel] = imx_clk_mux(\"cpu_sel\", ccm(CCM_CCTL), 14, 1, cpu_sel_clks, ARRAY_SIZE(cpu_sel_clks));\n\tclk[cpu] = imx_clk_divider(\"cpu\", \"cpu_sel\", ccm(CCM_CCTL), 30, 2);\n\tclk[ahb] = imx_clk_divider(\"ahb\", \"cpu\", ccm(CCM_CCTL), 28, 2);\n\tclk[usb_div] = imx_clk_divider(\"usb_div\", \"upll\", ccm(CCM_CCTL), 16, 6); \n\tclk[ipg] = imx_clk_fixed_factor(\"ipg\", \"ahb\", 1, 2);\n\tclk[per0_sel] = imx_clk_mux(\"per0_sel\", ccm(CCM_MCR), 0, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per1_sel] = imx_clk_mux(\"per1_sel\", ccm(CCM_MCR), 1, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per2_sel] = imx_clk_mux(\"per2_sel\", ccm(CCM_MCR), 2, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per3_sel] = imx_clk_mux(\"per3_sel\", ccm(CCM_MCR), 3, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per4_sel] = imx_clk_mux(\"per4_sel\", ccm(CCM_MCR), 4, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per5_sel] = imx_clk_mux(\"per5_sel\", ccm(CCM_MCR), 5, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per6_sel] = imx_clk_mux(\"per6_sel\", ccm(CCM_MCR), 6, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per7_sel] = imx_clk_mux(\"per7_sel\", ccm(CCM_MCR), 7, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per8_sel] = imx_clk_mux(\"per8_sel\", ccm(CCM_MCR), 8, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per9_sel] = imx_clk_mux(\"per9_sel\", ccm(CCM_MCR), 9, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per10_sel] = imx_clk_mux(\"per10_sel\", ccm(CCM_MCR), 10, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per11_sel] = imx_clk_mux(\"per11_sel\", ccm(CCM_MCR), 11, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per12_sel] = imx_clk_mux(\"per12_sel\", ccm(CCM_MCR), 12, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per13_sel] = imx_clk_mux(\"per13_sel\", ccm(CCM_MCR), 13, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per14_sel] = imx_clk_mux(\"per14_sel\", ccm(CCM_MCR), 14, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[per15_sel] = imx_clk_mux(\"per15_sel\", ccm(CCM_MCR), 15, 1, per_sel_clks, ARRAY_SIZE(per_sel_clks));\n\tclk[cko_div] = imx_clk_divider(\"cko_div\", \"cko_sel\", ccm(CCM_MCR), 24, 6);\n\tclk[cko_sel] = imx_clk_mux(\"cko_sel\", ccm(CCM_MCR), 20, 4, cko_sel_clks, ARRAY_SIZE(cko_sel_clks));\n\tclk[cko] = imx_clk_gate(\"cko\", \"cko_div\", ccm(CCM_MCR),  30);\n\tclk[per0] = imx_clk_divider(\"per0\", \"per0_sel\", ccm(CCM_PCDR0), 0, 6);\n\tclk[per1] = imx_clk_divider(\"per1\", \"per1_sel\", ccm(CCM_PCDR0), 8, 6);\n\tclk[per2] = imx_clk_divider(\"per2\", \"per2_sel\", ccm(CCM_PCDR0), 16, 6);\n\tclk[per3] = imx_clk_divider(\"per3\", \"per3_sel\", ccm(CCM_PCDR0), 24, 6);\n\tclk[per4] = imx_clk_divider(\"per4\", \"per4_sel\", ccm(CCM_PCDR1), 0, 6);\n\tclk[per5] = imx_clk_divider(\"per5\", \"per5_sel\", ccm(CCM_PCDR1), 8, 6);\n\tclk[per6] = imx_clk_divider(\"per6\", \"per6_sel\", ccm(CCM_PCDR1), 16, 6);\n\tclk[per7] = imx_clk_divider(\"per7\", \"per7_sel\", ccm(CCM_PCDR1), 24, 6);\n\tclk[per8] = imx_clk_divider(\"per8\", \"per8_sel\", ccm(CCM_PCDR2), 0, 6);\n\tclk[per9] = imx_clk_divider(\"per9\", \"per9_sel\", ccm(CCM_PCDR2), 8, 6);\n\tclk[per10] = imx_clk_divider(\"per10\", \"per10_sel\", ccm(CCM_PCDR2), 16, 6);\n\tclk[per11] = imx_clk_divider(\"per11\", \"per11_sel\", ccm(CCM_PCDR2), 24, 6);\n\tclk[per12] = imx_clk_divider(\"per12\", \"per12_sel\", ccm(CCM_PCDR3), 0, 6);\n\tclk[per13] = imx_clk_divider(\"per13\", \"per13_sel\", ccm(CCM_PCDR3), 8, 6);\n\tclk[per14] = imx_clk_divider(\"per14\", \"per14_sel\", ccm(CCM_PCDR3), 16, 6);\n\tclk[per15] = imx_clk_divider(\"per15\", \"per15_sel\", ccm(CCM_PCDR3), 24, 6);\n\tclk[csi_ipg_per] = imx_clk_gate(\"csi_ipg_per\", \"per0\", ccm(CCM_CGCR0), 0);\n\tclk[epit_ipg_per] = imx_clk_gate(\"epit_ipg_per\", \"per1\", ccm(CCM_CGCR0),  1);\n\tclk[esai_ipg_per] = imx_clk_gate(\"esai_ipg_per\", \"per2\", ccm(CCM_CGCR0),  2);\n\tclk[esdhc1_ipg_per] = imx_clk_gate(\"esdhc1_ipg_per\", \"per3\", ccm(CCM_CGCR0),  3);\n\tclk[esdhc2_ipg_per] = imx_clk_gate(\"esdhc2_ipg_per\", \"per4\", ccm(CCM_CGCR0),  4);\n\tclk[gpt_ipg_per] = imx_clk_gate(\"gpt_ipg_per\", \"per5\", ccm(CCM_CGCR0),  5);\n\tclk[i2c_ipg_per] = imx_clk_gate(\"i2c_ipg_per\", \"per6\", ccm(CCM_CGCR0),  6);\n\tclk[lcdc_ipg_per] = imx_clk_gate(\"lcdc_ipg_per\", \"per7\", ccm(CCM_CGCR0),  7);\n\tclk[nfc_ipg_per] = imx_clk_gate(\"nfc_ipg_per\", \"per8\", ccm(CCM_CGCR0),  8);\n\tclk[owire_ipg_per] = imx_clk_gate(\"owire_ipg_per\", \"per9\", ccm(CCM_CGCR0),  9);\n\tclk[pwm_ipg_per] = imx_clk_gate(\"pwm_ipg_per\", \"per10\", ccm(CCM_CGCR0),  10);\n\tclk[sim1_ipg_per] = imx_clk_gate(\"sim1_ipg_per\", \"per11\", ccm(CCM_CGCR0),  11);\n\tclk[sim2_ipg_per] = imx_clk_gate(\"sim2_ipg_per\", \"per12\", ccm(CCM_CGCR0),  12);\n\tclk[ssi1_ipg_per] = imx_clk_gate(\"ssi1_ipg_per\", \"per13\", ccm(CCM_CGCR0), 13);\n\tclk[ssi2_ipg_per] = imx_clk_gate(\"ssi2_ipg_per\", \"per14\", ccm(CCM_CGCR0), 14);\n\tclk[uart_ipg_per] = imx_clk_gate(\"uart_ipg_per\", \"per15\", ccm(CCM_CGCR0), 15);\n\tclk[ata_ahb] = imx_clk_gate(\"ata_ahb\", \"ahb\", ccm(CCM_CGCR0), 16);\n\t \n\tclk[csi_ahb] = imx_clk_gate(\"csi_ahb\", \"ahb\", ccm(CCM_CGCR0), 18);\n\tclk[emi_ahb] = imx_clk_gate(\"emi_ahb\", \"ahb\", ccm(CCM_CGCR0), 19);\n\tclk[esai_ahb] = imx_clk_gate(\"esai_ahb\", \"ahb\", ccm(CCM_CGCR0), 20);\n\tclk[esdhc1_ahb] = imx_clk_gate(\"esdhc1_ahb\", \"ahb\", ccm(CCM_CGCR0), 21);\n\tclk[esdhc2_ahb] = imx_clk_gate(\"esdhc2_ahb\", \"ahb\", ccm(CCM_CGCR0), 22);\n\tclk[fec_ahb] = imx_clk_gate(\"fec_ahb\", \"ahb\", ccm(CCM_CGCR0), 23);\n\tclk[lcdc_ahb] = imx_clk_gate(\"lcdc_ahb\", \"ahb\", ccm(CCM_CGCR0), 24);\n\tclk[rtic_ahb] = imx_clk_gate(\"rtic_ahb\", \"ahb\", ccm(CCM_CGCR0), 25);\n\tclk[sdma_ahb] = imx_clk_gate(\"sdma_ahb\", \"ahb\", ccm(CCM_CGCR0), 26);\n\tclk[slcdc_ahb] = imx_clk_gate(\"slcdc_ahb\", \"ahb\", ccm(CCM_CGCR0), 27);\n\tclk[usbotg_ahb] = imx_clk_gate(\"usbotg_ahb\", \"ahb\", ccm(CCM_CGCR0), 28);\n\t \n\t \n\tclk[can1_ipg] = imx_clk_gate(\"can1_ipg\", \"ipg\", ccm(CCM_CGCR1),  2);\n\tclk[can2_ipg] = imx_clk_gate(\"can2_ipg\", \"ipg\", ccm(CCM_CGCR1),  3);\n\tclk[csi_ipg] = imx_clk_gate(\"csi_ipg\", \"ipg\", ccm(CCM_CGCR1),  4);\n\tclk[cspi1_ipg] = imx_clk_gate(\"cspi1_ipg\", \"ipg\", ccm(CCM_CGCR1),  5);\n\tclk[cspi2_ipg] = imx_clk_gate(\"cspi2_ipg\", \"ipg\", ccm(CCM_CGCR1),  6);\n\tclk[cspi3_ipg] = imx_clk_gate(\"cspi3_ipg\", \"ipg\", ccm(CCM_CGCR1),  7);\n\tclk[dryice_ipg] = imx_clk_gate(\"dryice_ipg\", \"ipg\", ccm(CCM_CGCR1),  8);\n\tclk[ect_ipg] = imx_clk_gate(\"ect_ipg\", \"ipg\", ccm(CCM_CGCR1),  9);\n\tclk[epit1_ipg] = imx_clk_gate(\"epit1_ipg\", \"ipg\", ccm(CCM_CGCR1),  10);\n\tclk[epit2_ipg] = imx_clk_gate(\"epit2_ipg\", \"ipg\", ccm(CCM_CGCR1),  11);\n\t \n\tclk[esdhc1_ipg] = imx_clk_gate(\"esdhc1_ipg\", \"ipg\", ccm(CCM_CGCR1), 13);\n\tclk[esdhc2_ipg] = imx_clk_gate(\"esdhc2_ipg\", \"ipg\", ccm(CCM_CGCR1), 14);\n\tclk[fec_ipg] = imx_clk_gate(\"fec_ipg\", \"ipg\", ccm(CCM_CGCR1), 15);\n\t \n\t \n\t \n\tclk[gpt1_ipg] = imx_clk_gate(\"gpt1_ipg\", \"ipg\", ccm(CCM_CGCR1), 19);\n\tclk[gpt2_ipg] = imx_clk_gate(\"gpt2_ipg\", \"ipg\", ccm(CCM_CGCR1), 20);\n\tclk[gpt3_ipg] = imx_clk_gate(\"gpt3_ipg\", \"ipg\", ccm(CCM_CGCR1), 21);\n\tclk[gpt4_ipg] = imx_clk_gate(\"gpt4_ipg\", \"ipg\", ccm(CCM_CGCR1), 22);\n\t \n\t \n\t \n\tclk[iim_ipg] = imx_clk_gate(\"iim_ipg\", \"ipg\", ccm(CCM_CGCR1), 26);\n\t \n\t \n\tclk[kpp_ipg] = imx_clk_gate(\"kpp_ipg\", \"ipg\", ccm(CCM_CGCR1), 28);\n\tclk[lcdc_ipg] = imx_clk_gate(\"lcdc_ipg\", \"ipg\", ccm(CCM_CGCR1), 29);\n\t \n\tclk[pwm1_ipg] = imx_clk_gate(\"pwm1_ipg\", \"ipg\", ccm(CCM_CGCR1), 31);\n\tclk[pwm2_ipg] = imx_clk_gate(\"pwm2_ipg\", \"ipg\", ccm(CCM_CGCR2),  0);\n\tclk[pwm3_ipg] = imx_clk_gate(\"pwm3_ipg\", \"ipg\", ccm(CCM_CGCR2),  1);\n\tclk[pwm4_ipg] = imx_clk_gate(\"pwm4_ipg\", \"ipg\", ccm(CCM_CGCR2),  2);\n\tclk[rngb_ipg] = imx_clk_gate(\"rngb_ipg\", \"ipg\", ccm(CCM_CGCR2),  3);\n\t \n\tclk[scc_ipg] = imx_clk_gate(\"scc_ipg\", \"ipg\", ccm(CCM_CGCR2),  5);\n\tclk[sdma_ipg] = imx_clk_gate(\"sdma_ipg\", \"ipg\", ccm(CCM_CGCR2),  6);\n\tclk[sim1_ipg] = imx_clk_gate(\"sim1_ipg\", \"ipg\", ccm(CCM_CGCR2),  7);\n\tclk[sim2_ipg] = imx_clk_gate(\"sim2_ipg\", \"ipg\", ccm(CCM_CGCR2),  8);\n\tclk[slcdc_ipg] = imx_clk_gate(\"slcdc_ipg\", \"ipg\", ccm(CCM_CGCR2),  9);\n\tclk[spba_ipg] = imx_clk_gate(\"spba_ipg\", \"ipg\", ccm(CCM_CGCR2),  10);\n\tclk[ssi1_ipg] = imx_clk_gate(\"ssi1_ipg\", \"ipg\", ccm(CCM_CGCR2), 11);\n\tclk[ssi2_ipg] = imx_clk_gate(\"ssi2_ipg\", \"ipg\", ccm(CCM_CGCR2), 12);\n\tclk[tsc_ipg] = imx_clk_gate(\"tsc_ipg\", \"ipg\", ccm(CCM_CGCR2), 13);\n\tclk[uart1_ipg] = imx_clk_gate(\"uart1_ipg\", \"ipg\", ccm(CCM_CGCR2), 14);\n\tclk[uart2_ipg] = imx_clk_gate(\"uart2_ipg\", \"ipg\", ccm(CCM_CGCR2), 15);\n\tclk[uart3_ipg] = imx_clk_gate(\"uart3_ipg\", \"ipg\", ccm(CCM_CGCR2), 16);\n\tclk[uart4_ipg] = imx_clk_gate(\"uart4_ipg\", \"ipg\", ccm(CCM_CGCR2), 17);\n\tclk[uart5_ipg] = imx_clk_gate(\"uart5_ipg\", \"ipg\", ccm(CCM_CGCR2), 18);\n\t \n\tclk[wdt_ipg] = imx_clk_gate(\"wdt_ipg\", \"ipg\", ccm(CCM_CGCR2), 19);\n\n\timx_check_clocks(clk, ARRAY_SIZE(clk));\n\n\tclk_prepare_enable(clk[emi_ahb]);\n\n\t \n\tclk_set_parent(clk[per5_sel], clk[ahb]);\n\n\t \n\tclk_set_parent(clk[cko_sel], clk[ipg]);\n\n\timx_register_uart_clocks();\n\n\timx_print_silicon_rev(\"i.MX25\", mx25_revision());\n}\n\nstatic void __init mx25_clocks_init_dt(struct device_node *np)\n{\n\tvoid __iomem *ccm;\n\n\tccm = of_iomap(np, 0);\n\t__mx25_clocks_init(ccm);\n\n\tclk_data.clks = clk;\n\tclk_data.clk_num = ARRAY_SIZE(clk);\n\tof_clk_add_provider(np, of_clk_src_onecell_get, &clk_data);\n}\nCLK_OF_DECLARE(imx25_ccm, \"fsl,imx25-ccm\", mx25_clocks_init_dt);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}