{
  "module_name": "clk-gate-exclusive.c",
  "hash_id": "2fedf156b18344ee04a21c3be5beb833d5a3ea3c6cd1da06d1d6ba5ee58b1a95",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/imx/clk-gate-exclusive.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/slab.h>\n#include \"clk.h\"\n\n \nstruct clk_gate_exclusive {\n\tstruct clk_gate gate;\n\tu32 exclusive_mask;\n};\n\nstatic int clk_gate_exclusive_enable(struct clk_hw *hw)\n{\n\tstruct clk_gate *gate = to_clk_gate(hw);\n\tstruct clk_gate_exclusive *exgate = container_of(gate,\n\t\t\t\t\tstruct clk_gate_exclusive, gate);\n\tu32 val = readl(gate->reg);\n\n\tif (val & exgate->exclusive_mask)\n\t\treturn -EBUSY;\n\n\treturn clk_gate_ops.enable(hw);\n}\n\nstatic void clk_gate_exclusive_disable(struct clk_hw *hw)\n{\n\tclk_gate_ops.disable(hw);\n}\n\nstatic int clk_gate_exclusive_is_enabled(struct clk_hw *hw)\n{\n\treturn clk_gate_ops.is_enabled(hw);\n}\n\nstatic const struct clk_ops clk_gate_exclusive_ops = {\n\t.enable = clk_gate_exclusive_enable,\n\t.disable = clk_gate_exclusive_disable,\n\t.is_enabled = clk_gate_exclusive_is_enabled,\n};\n\nstruct clk_hw *imx_clk_hw_gate_exclusive(const char *name, const char *parent,\n\t void __iomem *reg, u8 shift, u32 exclusive_mask)\n{\n\tstruct clk_gate_exclusive *exgate;\n\tstruct clk_gate *gate;\n\tstruct clk_hw *hw;\n\tstruct clk_init_data init;\n\tint ret;\n\n\tif (exclusive_mask == 0)\n\t\treturn ERR_PTR(-EINVAL);\n\n\texgate = kzalloc(sizeof(*exgate), GFP_KERNEL);\n\tif (!exgate)\n\t\treturn ERR_PTR(-ENOMEM);\n\tgate = &exgate->gate;\n\n\tinit.name = name;\n\tinit.ops = &clk_gate_exclusive_ops;\n\tinit.flags = CLK_SET_RATE_PARENT;\n\tinit.parent_names = parent ? &parent : NULL;\n\tinit.num_parents = parent ? 1 : 0;\n\n\tgate->reg = reg;\n\tgate->bit_idx = shift;\n\tgate->lock = &imx_ccm_lock;\n\tgate->hw.init = &init;\n\texgate->exclusive_mask = exclusive_mask;\n\n\thw = &gate->hw;\n\n\tret = clk_hw_register(NULL, hw);\n\tif (ret) {\n\t\tkfree(gate);\n\t\treturn ERR_PTR(ret);\n\t}\n\n\treturn hw;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}