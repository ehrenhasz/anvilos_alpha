{
  "module_name": "clk-imx93.c",
  "hash_id": "24e8aa8697c5f71c45390e93096ddb1ada4d6abb9f7116117dd2c741675e288f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/imx/clk-imx93.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n#include <dt-bindings/clock/imx93-clock.h>\n\n#include \"clk.h\"\n\nenum clk_sel {\n\tLOW_SPEED_IO_SEL,\n\tNON_IO_SEL,\n\tFAST_SEL,\n\tAUDIO_SEL,\n\tVIDEO_SEL,\n\tTPM_SEL,\n\tCKO1_SEL,\n\tCKO2_SEL,\n\tMISC_SEL,\n\tMAX_SEL\n};\n\nstatic u32 share_count_sai1;\nstatic u32 share_count_sai2;\nstatic u32 share_count_sai3;\nstatic u32 share_count_mub;\nstatic u32 share_count_pdm;\n\nstatic const char * const a55_core_sels[] = {\"a55_alt\", \"arm_pll\"};\nstatic const char *parent_names[MAX_SEL][4] = {\n\t{\"osc_24m\", \"sys_pll_pfd0_div2\", \"sys_pll_pfd1_div2\", \"video_pll\"},\n\t{\"osc_24m\", \"sys_pll_pfd0_div2\", \"sys_pll_pfd1_div2\", \"sys_pll_pfd2_div2\"},\n\t{\"osc_24m\", \"sys_pll_pfd0\", \"sys_pll_pfd1\", \"sys_pll_pfd2\"},\n\t{\"osc_24m\", \"audio_pll\", \"video_pll\", \"clk_ext1\"},\n\t{\"osc_24m\", \"audio_pll\", \"video_pll\", \"sys_pll_pfd0\"},\n\t{\"osc_24m\", \"sys_pll_pfd0\", \"audio_pll\", \"clk_ext1\"},\n\t{\"osc_24m\", \"sys_pll_pfd0\", \"sys_pll_pfd1\", \"audio_pll\"},\n\t{\"osc_24m\", \"sys_pll_pfd0\", \"sys_pll_pfd1\", \"video_pll\"},\n\t{\"osc_24m\", \"audio_pll\", \"video_pll\", \"sys_pll_pfd2\"},\n};\n\nstatic const struct imx93_clk_root {\n\tu32 clk;\n\tchar *name;\n\tu32 off;\n\tenum clk_sel sel;\n\tunsigned long flags;\n} root_array[] = {\n\t \n\t{ IMX93_CLK_A55_PERIPH,\t\t\"a55_periph_root\",\t0x0000,\tFAST_SEL, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_A55_MTR_BUS,\t\"a55_mtr_bus_root\",\t0x0080,\tLOW_SPEED_IO_SEL, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_A55,\t\t\"a55_alt_root\",\t\t0x0100,\tFAST_SEL, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_M33,\t\t\"m33_root\",\t\t0x0180,\tLOW_SPEED_IO_SEL, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_BUS_WAKEUP,\t\t\"bus_wakeup_root\",\t0x0280,\tLOW_SPEED_IO_SEL, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_BUS_AON,\t\t\"bus_aon_root\",\t\t0x0300,\tLOW_SPEED_IO_SEL, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_WAKEUP_AXI,\t\t\"wakeup_axi_root\",\t0x0380,\tFAST_SEL, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_SWO_TRACE,\t\t\"swo_trace_root\",\t0x0400,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_M33_SYSTICK,\t\"m33_systick_root\",\t0x0480,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_FLEXIO1,\t\t\"flexio1_root\",\t\t0x0500,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_FLEXIO2,\t\t\"flexio2_root\",\t\t0x0580,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPTMR1,\t\t\"lptmr1_root\",\t\t0x0700,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPTMR2,\t\t\"lptmr2_root\",\t\t0x0780,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_TPM2,\t\t\"tpm2_root\",\t\t0x0880,\tTPM_SEL, },\n\t{ IMX93_CLK_TPM4,\t\t\"tpm4_root\",\t\t0x0980,\tTPM_SEL, },\n\t{ IMX93_CLK_TPM5,\t\t\"tpm5_root\",\t\t0x0a00,\tTPM_SEL, },\n\t{ IMX93_CLK_TPM6,\t\t\"tpm6_root\",\t\t0x0a80,\tTPM_SEL, },\n\t{ IMX93_CLK_FLEXSPI1,\t\t\"flexspi1_root\",\t0x0b00,\tFAST_SEL, },\n\t{ IMX93_CLK_CAN1,\t\t\"can1_root\",\t\t0x0b80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_CAN2,\t\t\"can2_root\",\t\t0x0c00,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART1,\t\t\"lpuart1_root\",\t\t0x0c80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART2,\t\t\"lpuart2_root\",\t\t0x0d00,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART3,\t\t\"lpuart3_root\",\t\t0x0d80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART4,\t\t\"lpuart4_root\",\t\t0x0e00,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART5,\t\t\"lpuart5_root\",\t\t0x0e80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART6,\t\t\"lpuart6_root\",\t\t0x0f00,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART7,\t\t\"lpuart7_root\",\t\t0x0f80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPUART8,\t\t\"lpuart8_root\",\t\t0x1000,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C1,\t\t\"lpi2c1_root\",\t\t0x1080,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C2,\t\t\"lpi2c2_root\",\t\t0x1100,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C3,\t\t\"lpi2c3_root\",\t\t0x1180,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C4,\t\t\"lpi2c4_root\",\t\t0x1200,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C5,\t\t\"lpi2c5_root\",\t\t0x1280,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C6,\t\t\"lpi2c6_root\",\t\t0x1300,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C7,\t\t\"lpi2c7_root\",\t\t0x1380,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPI2C8,\t\t\"lpi2c8_root\",\t\t0x1400,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI1,\t\t\"lpspi1_root\",\t\t0x1480,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI2,\t\t\"lpspi2_root\",\t\t0x1500,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI3,\t\t\"lpspi3_root\",\t\t0x1580,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI4,\t\t\"lpspi4_root\",\t\t0x1600,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI5,\t\t\"lpspi5_root\",\t\t0x1680,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI6,\t\t\"lpspi6_root\",\t\t0x1700,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI7,\t\t\"lpspi7_root\",\t\t0x1780,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_LPSPI8,\t\t\"lpspi8_root\",\t\t0x1800,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_I3C1,\t\t\"i3c1_root\",\t\t0x1880,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_I3C2,\t\t\"i3c2_root\",\t\t0x1900,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_USDHC1,\t\t\"usdhc1_root\",\t\t0x1980,\tFAST_SEL, },\n\t{ IMX93_CLK_USDHC2,\t\t\"usdhc2_root\",\t\t0x1a00,\tFAST_SEL, },\n\t{ IMX93_CLK_USDHC3,\t\t\"usdhc3_root\",\t\t0x1a80,\tFAST_SEL, },\n\t{ IMX93_CLK_SAI1,\t\t\"sai1_root\",\t\t0x1b00,\tAUDIO_SEL, },\n\t{ IMX93_CLK_SAI2,\t\t\"sai2_root\",\t\t0x1b80,\tAUDIO_SEL, },\n\t{ IMX93_CLK_SAI3,\t\t\"sai3_root\",\t\t0x1c00,\tAUDIO_SEL, },\n\t{ IMX93_CLK_CCM_CKO1,\t\t\"ccm_cko1_root\",\t0x1c80,\tCKO1_SEL, },\n\t{ IMX93_CLK_CCM_CKO2,\t\t\"ccm_cko2_root\",\t0x1d00,\tCKO2_SEL, },\n\t{ IMX93_CLK_CCM_CKO3,\t\t\"ccm_cko3_root\",\t0x1d80,\tCKO1_SEL, },\n\t{ IMX93_CLK_CCM_CKO4,\t\t\"ccm_cko4_root\",\t0x1e00,\tCKO2_SEL, },\n\t \n\t{ IMX93_CLK_HSIO,\t\t\"hsio_root\",\t\t0x1e80,\tLOW_SPEED_IO_SEL, CLK_IS_CRITICAL},\n\t{ IMX93_CLK_HSIO_USB_TEST_60M,\t\"hsio_usb_test_60m_root\", 0x1f00, LOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_HSIO_ACSCAN_80M,\t\"hsio_acscan_80m_root\",\t0x1f80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_HSIO_ACSCAN_480M,\t\"hsio_acscan_480m_root\", 0x2000, MISC_SEL, },\n\t{ IMX93_CLK_NIC_AXI,\t\t\"nic_axi_root\",\t\t0x2080, FAST_SEL, CLK_IS_CRITICAL, },\n\t{ IMX93_CLK_ML_APB,\t\t\"ml_apb_root\",\t\t0x2180,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_ML,\t\t\t\"ml_root\",\t\t0x2200,\tFAST_SEL, },\n\t{ IMX93_CLK_MEDIA_AXI,\t\t\"media_axi_root\",\t0x2280,\tFAST_SEL, },\n\t{ IMX93_CLK_MEDIA_APB,\t\t\"media_apb_root\",\t0x2300,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_MEDIA_LDB,\t\t\"media_ldb_root\",\t0x2380,\tVIDEO_SEL, },\n\t{ IMX93_CLK_MEDIA_DISP_PIX,\t\"media_disp_pix_root\",\t0x2400,\tVIDEO_SEL, },\n\t{ IMX93_CLK_CAM_PIX,\t\t\"cam_pix_root\",\t\t0x2480,\tVIDEO_SEL, },\n\t{ IMX93_CLK_MIPI_TEST_BYTE,\t\"mipi_test_byte_root\",\t0x2500,\tVIDEO_SEL, },\n\t{ IMX93_CLK_MIPI_PHY_CFG,\t\"mipi_phy_cfg_root\",\t0x2580,\tVIDEO_SEL, },\n\t{ IMX93_CLK_ADC,\t\t\"adc_root\",\t\t0x2700,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_PDM,\t\t\"pdm_root\",\t\t0x2780,\tAUDIO_SEL, },\n\t{ IMX93_CLK_TSTMR1,\t\t\"tstmr1_root\",\t\t0x2800,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_TSTMR2,\t\t\"tstmr2_root\",\t\t0x2880,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_MQS1,\t\t\"mqs1_root\",\t\t0x2900,\tAUDIO_SEL, },\n\t{ IMX93_CLK_MQS2,\t\t\"mqs2_root\",\t\t0x2980,\tAUDIO_SEL, },\n\t{ IMX93_CLK_AUDIO_XCVR,\t\t\"audio_xcvr_root\",\t0x2a00,\tNON_IO_SEL, },\n\t{ IMX93_CLK_SPDIF,\t\t\"spdif_root\",\t\t0x2a80,\tAUDIO_SEL, },\n\t{ IMX93_CLK_ENET,\t\t\"enet_root\",\t\t0x2b00,\tNON_IO_SEL, },\n\t{ IMX93_CLK_ENET_TIMER1,\t\"enet_timer1_root\",\t0x2b80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_ENET_TIMER2,\t\"enet_timer2_root\",\t0x2c00,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_ENET_REF,\t\t\"enet_ref_root\",\t0x2c80,\tNON_IO_SEL, },\n\t{ IMX93_CLK_ENET_REF_PHY,\t\"enet_ref_phy_root\",\t0x2d00,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_I3C1_SLOW,\t\t\"i3c1_slow_root\",\t0x2d80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_I3C2_SLOW,\t\t\"i3c2_slow_root\",\t0x2e00,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_USB_PHY_BURUNIN,\t\"usb_phy_root\",\t\t0x2e80,\tLOW_SPEED_IO_SEL, },\n\t{ IMX93_CLK_PAL_CAME_SCAN,\t\"pal_came_scan_root\",\t0x2f00,\tMISC_SEL, }\n};\n\nstatic const struct imx93_clk_ccgr {\n\tu32 clk;\n\tchar *name;\n\tchar *parent_name;\n\tu32 off;\n\tunsigned long flags;\n\tu32 *shared_count;\n} ccgr_array[] = {\n\t{ IMX93_CLK_A55_GATE,\t\t\"a55_alt\",\t\"a55_alt_root\",\t\t0x8000, },\n\t \n\t{ IMX93_CLK_CM33_GATE,\t\t\"cm33\",\t\t\"m33_root\",\t\t0x8040, CLK_IS_CRITICAL },\n\t{ IMX93_CLK_ADC1_GATE,\t\t\"adc1\",\t\t\"adc_root\",\t\t0x82c0, },\n\t{ IMX93_CLK_WDOG1_GATE,\t\t\"wdog1\",\t\"osc_24m\",\t\t0x8300, },\n\t{ IMX93_CLK_WDOG2_GATE,\t\t\"wdog2\",\t\"osc_24m\",\t\t0x8340, },\n\t{ IMX93_CLK_WDOG3_GATE,\t\t\"wdog3\",\t\"osc_24m\",\t\t0x8380, },\n\t{ IMX93_CLK_WDOG4_GATE,\t\t\"wdog4\",\t\"osc_24m\",\t\t0x83c0, },\n\t{ IMX93_CLK_WDOG5_GATE,\t\t\"wdog5\",\t\"osc_24m\",\t\t0x8400, },\n\t{ IMX93_CLK_SEMA1_GATE,\t\t\"sema1\",\t\"bus_aon_root\",\t\t0x8440, },\n\t{ IMX93_CLK_SEMA2_GATE,\t\t\"sema2\",\t\"bus_wakeup_root\",\t0x8480, },\n\t{ IMX93_CLK_MU1_A_GATE,\t\t\"mu1_a\",\t\"bus_aon_root\",\t\t0x84c0, CLK_IGNORE_UNUSED },\n\t{ IMX93_CLK_MU2_A_GATE,\t\t\"mu2_a\",\t\"bus_wakeup_root\",\t0x84c0, CLK_IGNORE_UNUSED },\n\t{ IMX93_CLK_MU1_B_GATE,\t\t\"mu1_b\",\t\"bus_aon_root\",\t\t0x8500, 0, &share_count_mub },\n\t{ IMX93_CLK_MU2_B_GATE,\t\t\"mu2_b\",\t\"bus_wakeup_root\",\t0x8500, 0, &share_count_mub },\n\t{ IMX93_CLK_EDMA1_GATE,\t\t\"edma1\",\t\"m33_root\",\t\t0x8540, },\n\t{ IMX93_CLK_EDMA2_GATE,\t\t\"edma2\",\t\"wakeup_axi_root\",\t0x8580, },\n\t{ IMX93_CLK_FLEXSPI1_GATE,\t\"flexspi1\",\t\"flexspi1_root\",\t0x8640, },\n\t{ IMX93_CLK_GPIO1_GATE,\t\t\"gpio1\",\t\"m33_root\",\t\t0x8880, },\n\t{ IMX93_CLK_GPIO2_GATE,\t\t\"gpio2\",\t\"bus_wakeup_root\",\t0x88c0, },\n\t{ IMX93_CLK_GPIO3_GATE,\t\t\"gpio3\",\t\"bus_wakeup_root\",\t0x8900, },\n\t{ IMX93_CLK_GPIO4_GATE,\t\t\"gpio4\",\t\"bus_wakeup_root\",\t0x8940, },\n\t{ IMX93_CLK_FLEXIO1_GATE,\t\"flexio1\",\t\"flexio1_root\",\t\t0x8980, },\n\t{ IMX93_CLK_FLEXIO2_GATE,\t\"flexio2\",\t\"flexio2_root\",\t\t0x89c0, },\n\t{ IMX93_CLK_LPIT1_GATE,\t\t\"lpit1\",\t\"bus_aon_root\",\t\t0x8a00, },\n\t{ IMX93_CLK_LPIT2_GATE,\t\t\"lpit2\",\t\"bus_wakeup_root\",\t0x8a40, },\n\t{ IMX93_CLK_LPTMR1_GATE,\t\"lptmr1\",\t\"lptmr1_root\",\t\t0x8a80, },\n\t{ IMX93_CLK_LPTMR2_GATE,\t\"lptmr2\",\t\"lptmr2_root\",\t\t0x8ac0, },\n\t{ IMX93_CLK_TPM1_GATE,\t\t\"tpm1\",\t\t\"bus_aon_root\",\t\t0x8b00, },\n\t{ IMX93_CLK_TPM2_GATE,\t\t\"tpm2\",\t\t\"tpm2_root\",\t\t0x8b40, },\n\t{ IMX93_CLK_TPM3_GATE,\t\t\"tpm3\",\t\t\"bus_wakeup_root\",\t0x8b80, },\n\t{ IMX93_CLK_TPM4_GATE,\t\t\"tpm4\",\t\t\"tpm4_root\",\t\t0x8bc0, },\n\t{ IMX93_CLK_TPM5_GATE,\t\t\"tpm5\",\t\t\"tpm5_root\",\t\t0x8c00, },\n\t{ IMX93_CLK_TPM6_GATE,\t\t\"tpm6\",\t\t\"tpm6_root\",\t\t0x8c40, },\n\t{ IMX93_CLK_CAN1_GATE,\t\t\"can1\",\t\t\"can1_root\",\t\t0x8c80, },\n\t{ IMX93_CLK_CAN2_GATE,\t\t\"can2\",\t\t\"can2_root\",\t\t0x8cc0, },\n\t{ IMX93_CLK_LPUART1_GATE,\t\"lpuart1\",\t\"lpuart1_root\",\t\t0x8d00, },\n\t{ IMX93_CLK_LPUART2_GATE,\t\"lpuart2\",\t\"lpuart2_root\",\t\t0x8d40, },\n\t{ IMX93_CLK_LPUART3_GATE,\t\"lpuart3\",\t\"lpuart3_root\",\t\t0x8d80, },\n\t{ IMX93_CLK_LPUART4_GATE,\t\"lpuart4\",\t\"lpuart4_root\",\t\t0x8dc0, },\n\t{ IMX93_CLK_LPUART5_GATE,\t\"lpuart5\",\t\"lpuart5_root\",\t\t0x8e00, },\n\t{ IMX93_CLK_LPUART6_GATE,\t\"lpuart6\",\t\"lpuart6_root\",\t\t0x8e40, },\n\t{ IMX93_CLK_LPUART7_GATE,\t\"lpuart7\",\t\"lpuart7_root\",\t\t0x8e80, },\n\t{ IMX93_CLK_LPUART8_GATE,\t\"lpuart8\",\t\"lpuart8_root\",\t\t0x8ec0, },\n\t{ IMX93_CLK_LPI2C1_GATE,\t\"lpi2c1\",\t\"lpi2c1_root\",\t\t0x8f00, },\n\t{ IMX93_CLK_LPI2C2_GATE,\t\"lpi2c2\",\t\"lpi2c2_root\",\t\t0x8f40, },\n\t{ IMX93_CLK_LPI2C3_GATE,\t\"lpi2c3\",\t\"lpi2c3_root\",\t\t0x8f80, },\n\t{ IMX93_CLK_LPI2C4_GATE,\t\"lpi2c4\",\t\"lpi2c4_root\",\t\t0x8fc0, },\n\t{ IMX93_CLK_LPI2C5_GATE,\t\"lpi2c5\",\t\"lpi2c5_root\",\t\t0x9000, },\n\t{ IMX93_CLK_LPI2C6_GATE,\t\"lpi2c6\",\t\"lpi2c6_root\",\t\t0x9040, },\n\t{ IMX93_CLK_LPI2C7_GATE,\t\"lpi2c7\",\t\"lpi2c7_root\",\t\t0x9080, },\n\t{ IMX93_CLK_LPI2C8_GATE,\t\"lpi2c8\",\t\"lpi2c8_root\",\t\t0x90c0, },\n\t{ IMX93_CLK_LPSPI1_GATE,\t\"lpspi1\",\t\"lpspi1_root\",\t\t0x9100, },\n\t{ IMX93_CLK_LPSPI2_GATE,\t\"lpspi2\",\t\"lpspi2_root\",\t\t0x9140, },\n\t{ IMX93_CLK_LPSPI3_GATE,\t\"lpspi3\",\t\"lpspi3_root\",\t\t0x9180, },\n\t{ IMX93_CLK_LPSPI4_GATE,\t\"lpspi4\",\t\"lpspi4_root\",\t\t0x91c0, },\n\t{ IMX93_CLK_LPSPI5_GATE,\t\"lpspi5\",\t\"lpspi5_root\",\t\t0x9200, },\n\t{ IMX93_CLK_LPSPI6_GATE,\t\"lpspi6\",\t\"lpspi6_root\",\t\t0x9240, },\n\t{ IMX93_CLK_LPSPI7_GATE,\t\"lpspi7\",\t\"lpspi7_root\",\t\t0x9280, },\n\t{ IMX93_CLK_LPSPI8_GATE,\t\"lpspi8\",\t\"lpspi8_root\",\t\t0x92c0, },\n\t{ IMX93_CLK_I3C1_GATE,\t\t\"i3c1\",\t\t\"i3c1_root\",\t\t0x9300, },\n\t{ IMX93_CLK_I3C2_GATE,\t\t\"i3c2\",\t\t\"i3c2_root\",\t\t0x9340, },\n\t{ IMX93_CLK_USDHC1_GATE,\t\"usdhc1\",\t\"usdhc1_root\",\t\t0x9380, },\n\t{ IMX93_CLK_USDHC2_GATE,\t\"usdhc2\",\t\"usdhc2_root\",\t\t0x93c0, },\n\t{ IMX93_CLK_USDHC3_GATE,\t\"usdhc3\",\t\"usdhc3_root\",\t\t0x9400, },\n\t{ IMX93_CLK_SAI1_GATE,          \"sai1\",         \"sai1_root\",            0x9440, 0, &share_count_sai1},\n\t{ IMX93_CLK_SAI1_IPG,\t\t\"sai1_ipg_clk\", \"bus_aon_root\",\t\t0x9440, 0, &share_count_sai1},\n\t{ IMX93_CLK_SAI2_GATE,          \"sai2\",         \"sai2_root\",            0x9480, 0, &share_count_sai2},\n\t{ IMX93_CLK_SAI2_IPG,\t\t\"sai2_ipg_clk\", \"bus_wakeup_root\",\t0x9480, 0, &share_count_sai2},\n\t{ IMX93_CLK_SAI3_GATE,          \"sai3\",         \"sai3_root\",            0x94c0, 0, &share_count_sai3},\n\t{ IMX93_CLK_SAI3_IPG,\t\t\"sai3_ipg_clk\", \"bus_wakeup_root\",\t0x94c0, 0, &share_count_sai3},\n\t{ IMX93_CLK_MIPI_CSI_GATE,\t\"mipi_csi\",\t\"media_apb_root\",\t0x9580, },\n\t{ IMX93_CLK_MIPI_DSI_GATE,\t\"mipi_dsi\",\t\"media_apb_root\",\t0x95c0, },\n\t{ IMX93_CLK_LVDS_GATE,\t\t\"lvds\",\t\t\"media_ldb_root\",\t0x9600, },\n\t{ IMX93_CLK_LCDIF_GATE,\t\t\"lcdif\",\t\"media_apb_root\",\t0x9640, },\n\t{ IMX93_CLK_PXP_GATE,\t\t\"pxp\",\t\t\"media_apb_root\",\t0x9680, },\n\t{ IMX93_CLK_ISI_GATE,\t\t\"isi\",\t\t\"media_apb_root\",\t0x96c0, },\n\t{ IMX93_CLK_NIC_MEDIA_GATE,\t\"nic_media\",\t\"media_axi_root\",\t0x9700, },\n\t{ IMX93_CLK_USB_CONTROLLER_GATE, \"usb_controller\", \"hsio_root\",\t\t0x9a00, },\n\t{ IMX93_CLK_USB_TEST_60M_GATE,\t\"usb_test_60m\",\t\"hsio_usb_test_60m_root\", 0x9a40, },\n\t{ IMX93_CLK_HSIO_TROUT_24M_GATE, \"hsio_trout_24m\", \"osc_24m\",\t\t0x9a80, },\n\t{ IMX93_CLK_PDM_GATE,\t\t\"pdm\",\t\t\"pdm_root\",\t\t0x9ac0, 0, &share_count_pdm},\n\t{ IMX93_CLK_PDM_IPG,\t\t\"pdm_ipg_clk\",\t\"bus_aon_root\",\t\t0x9ac0, 0, &share_count_pdm},\n\t{ IMX93_CLK_MQS1_GATE,\t\t\"mqs1\",\t\t\"sai1_root\",\t\t0x9b00, },\n\t{ IMX93_CLK_MQS2_GATE,\t\t\"mqs2\",\t\t\"sai3_root\",\t\t0x9b40, },\n\t{ IMX93_CLK_AUD_XCVR_GATE,\t\"aud_xcvr\",\t\"audio_xcvr_root\",\t0x9b80, },\n\t{ IMX93_CLK_SPDIF_GATE,\t\t\"spdif\",\t\"spdif_root\",\t\t0x9c00, },\n\t{ IMX93_CLK_HSIO_32K_GATE,\t\"hsio_32k\",\t\"osc_32k\",\t\t0x9dc0, },\n\t{ IMX93_CLK_ENET1_GATE,\t\t\"enet1\",\t\"wakeup_axi_root\",\t0x9e00, },\n\t{ IMX93_CLK_ENET_QOS_GATE,\t\"enet_qos\",\t\"wakeup_axi_root\",\t0x9e40, },\n\t \n\t{ IMX93_CLK_SYS_CNT_GATE,\t\"sys_cnt\",\t\"osc_24m\",\t\t0x9e80, CLK_IS_CRITICAL},\n\t{ IMX93_CLK_TSTMR1_GATE,\t\"tstmr1\",\t\"bus_aon_root\",\t\t0x9ec0, },\n\t{ IMX93_CLK_TSTMR2_GATE,\t\"tstmr2\",\t\"bus_wakeup_root\",\t0x9f00, },\n\t{ IMX93_CLK_TMC_GATE,\t\t\"tmc\",\t\t\"osc_24m\",\t\t0x9f40, },\n\t{ IMX93_CLK_PMRO_GATE,\t\t\"pmro\",\t\t\"osc_24m\",\t\t0x9f80, }\n};\n\nstatic struct clk_hw_onecell_data *clk_hw_data;\nstatic struct clk_hw **clks;\n\nstatic int imx93_clocks_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct device_node *np = dev->of_node;\n\tconst struct imx93_clk_root *root;\n\tconst struct imx93_clk_ccgr *ccgr;\n\tvoid __iomem *base, *anatop_base;\n\tint i, ret;\n\n\tclk_hw_data = devm_kzalloc(dev, struct_size(clk_hw_data, hws,\n\t\t\t\t\t  IMX93_CLK_END), GFP_KERNEL);\n\tif (!clk_hw_data)\n\t\treturn -ENOMEM;\n\n\tclk_hw_data->num = IMX93_CLK_END;\n\tclks = clk_hw_data->hws;\n\n\tclks[IMX93_CLK_DUMMY] = imx_clk_hw_fixed(\"dummy\", 0);\n\tclks[IMX93_CLK_24M] = imx_get_clk_hw_by_name(np, \"osc_24m\");\n\tclks[IMX93_CLK_32K] = imx_get_clk_hw_by_name(np, \"osc_32k\");\n\tclks[IMX93_CLK_EXT1] = imx_get_clk_hw_by_name(np, \"clk_ext1\");\n\n\tclks[IMX93_CLK_SYS_PLL_PFD0] = imx_clk_hw_fixed(\"sys_pll_pfd0\", 1000000000);\n\tclks[IMX93_CLK_SYS_PLL_PFD0_DIV2] = imx_clk_hw_fixed_factor(\"sys_pll_pfd0_div2\",\n\t\t\t\t\t\t\t\t    \"sys_pll_pfd0\", 1, 2);\n\tclks[IMX93_CLK_SYS_PLL_PFD1] = imx_clk_hw_fixed(\"sys_pll_pfd1\", 800000000);\n\tclks[IMX93_CLK_SYS_PLL_PFD1_DIV2] = imx_clk_hw_fixed_factor(\"sys_pll_pfd1_div2\",\n\t\t\t\t\t\t\t\t    \"sys_pll_pfd1\", 1, 2);\n\tclks[IMX93_CLK_SYS_PLL_PFD2] = imx_clk_hw_fixed(\"sys_pll_pfd2\", 625000000);\n\tclks[IMX93_CLK_SYS_PLL_PFD2_DIV2] = imx_clk_hw_fixed_factor(\"sys_pll_pfd2_div2\",\n\t\t\t\t\t\t\t\t    \"sys_pll_pfd2\", 1, 2);\n\n\tnp = of_find_compatible_node(NULL, NULL, \"fsl,imx93-anatop\");\n\tanatop_base = devm_of_iomap(dev, np, 0, NULL);\n\tof_node_put(np);\n\tif (WARN_ON(IS_ERR(anatop_base))) {\n\t\tret = PTR_ERR(anatop_base);\n\t\tgoto unregister_hws;\n\t}\n\n\tclks[IMX93_CLK_ARM_PLL] = imx_clk_fracn_gppll_integer(\"arm_pll\", \"osc_24m\",\n\t\t\t\t\t\t\t      anatop_base + 0x1000,\n\t\t\t\t\t\t\t      &imx_fracn_gppll_integer);\n\tclks[IMX93_CLK_AUDIO_PLL] = imx_clk_fracn_gppll(\"audio_pll\", \"osc_24m\", anatop_base + 0x1200,\n\t\t\t\t\t\t\t&imx_fracn_gppll);\n\tclks[IMX93_CLK_VIDEO_PLL] = imx_clk_fracn_gppll(\"video_pll\", \"osc_24m\", anatop_base + 0x1400,\n\t\t\t\t\t\t\t&imx_fracn_gppll);\n\n\tnp = dev->of_node;\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (WARN_ON(IS_ERR(base))) {\n\t\tret = PTR_ERR(base);\n\t\tgoto unregister_hws;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(root_array); i++) {\n\t\troot = &root_array[i];\n\t\tclks[root->clk] = imx93_clk_composite_flags(root->name,\n\t\t\t\t\t\t\t    parent_names[root->sel],\n\t\t\t\t\t\t\t    4, base + root->off, 3,\n\t\t\t\t\t\t\t    root->flags);\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(ccgr_array); i++) {\n\t\tccgr = &ccgr_array[i];\n\t\tclks[ccgr->clk] = imx93_clk_gate(NULL, ccgr->name, ccgr->parent_name,\n\t\t\t\t\t\t ccgr->flags, base + ccgr->off, 0, 1, 1, 3,\n\t\t\t\t\t\t ccgr->shared_count);\n\t}\n\n\tclks[IMX93_CLK_A55_SEL] = imx_clk_hw_mux2(\"a55_sel\", base + 0x4820, 0, 1, a55_core_sels,\n\t\t\t\t\t\t  ARRAY_SIZE(a55_core_sels));\n\tclks[IMX93_CLK_A55_CORE] = imx_clk_hw_cpu(\"a55_core\", \"a55_sel\",\n\t\t\t\t\t\t  clks[IMX93_CLK_A55_SEL]->clk,\n\t\t\t\t\t\t  clks[IMX93_CLK_A55_SEL]->clk,\n\t\t\t\t\t\t  clks[IMX93_CLK_ARM_PLL]->clk,\n\t\t\t\t\t\t  clks[IMX93_CLK_A55_GATE]->clk);\n\n\timx_check_clk_hws(clks, IMX93_CLK_END);\n\n\tret = of_clk_add_hw_provider(np, of_clk_hw_onecell_get, clk_hw_data);\n\tif (ret < 0) {\n\t\tdev_err(dev, \"failed to register clks for i.MX93\\n\");\n\t\tgoto unregister_hws;\n\t}\n\n\timx_register_uart_clocks();\n\n\treturn 0;\n\nunregister_hws:\n\timx_unregister_hw_clocks(clks, IMX93_CLK_END);\n\n\treturn ret;\n}\n\nstatic const struct of_device_id imx93_clk_of_match[] = {\n\t{ .compatible = \"fsl,imx93-ccm\" },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, imx93_clk_of_match);\n\nstatic struct platform_driver imx93_clk_driver = {\n\t.probe = imx93_clocks_probe,\n\t.driver = {\n\t\t.name = \"imx93-ccm\",\n\t\t.suppress_bind_attrs = true,\n\t\t.of_match_table = imx93_clk_of_match,\n\t},\n};\nmodule_platform_driver(imx93_clk_driver);\nmodule_param(mcore_booted, bool, 0444);\nMODULE_PARM_DESC(mcore_booted, \"See Cortex-M core is booted or not\");\n\nMODULE_DESCRIPTION(\"NXP i.MX93 clock driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}