{
  "module_name": "clk-gate-zynqmp.c",
  "hash_id": "8db77880ebecb2658e16fcd6d8c578a358979556bd064ba5c9fbffc456866611",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/zynqmp/clk-gate-zynqmp.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/slab.h>\n#include \"clk-zynqmp.h\"\n\n \nstruct zynqmp_clk_gate {\n\tstruct clk_hw hw;\n\tu8 flags;\n\tu32 clk_id;\n};\n\n#define to_zynqmp_clk_gate(_hw) container_of(_hw, struct zynqmp_clk_gate, hw)\n\n \nstatic int zynqmp_clk_gate_enable(struct clk_hw *hw)\n{\n\tstruct zynqmp_clk_gate *gate = to_zynqmp_clk_gate(hw);\n\tconst char *clk_name = clk_hw_get_name(hw);\n\tu32 clk_id = gate->clk_id;\n\tint ret;\n\n\tret = zynqmp_pm_clock_enable(clk_id);\n\n\tif (ret)\n\t\tpr_debug(\"%s() clock enable failed for %s (id %d), ret = %d\\n\",\n\t\t\t __func__, clk_name, clk_id, ret);\n\n\treturn ret;\n}\n\n \nstatic void zynqmp_clk_gate_disable(struct clk_hw *hw)\n{\n\tstruct zynqmp_clk_gate *gate = to_zynqmp_clk_gate(hw);\n\tconst char *clk_name = clk_hw_get_name(hw);\n\tu32 clk_id = gate->clk_id;\n\tint ret;\n\n\tret = zynqmp_pm_clock_disable(clk_id);\n\n\tif (ret)\n\t\tpr_debug(\"%s() clock disable failed for %s (id %d), ret = %d\\n\",\n\t\t\t __func__, clk_name, clk_id, ret);\n}\n\n \nstatic int zynqmp_clk_gate_is_enabled(struct clk_hw *hw)\n{\n\tstruct zynqmp_clk_gate *gate = to_zynqmp_clk_gate(hw);\n\tconst char *clk_name = clk_hw_get_name(hw);\n\tu32 clk_id = gate->clk_id;\n\tint state, ret;\n\n\tret = zynqmp_pm_clock_getstate(clk_id, &state);\n\tif (ret) {\n\t\tpr_debug(\"%s() clock get state failed for %s, ret = %d\\n\",\n\t\t\t __func__, clk_name, ret);\n\t\treturn -EIO;\n\t}\n\n\treturn state ? 1 : 0;\n}\n\nstatic const struct clk_ops zynqmp_clk_gate_ops = {\n\t.enable = zynqmp_clk_gate_enable,\n\t.disable = zynqmp_clk_gate_disable,\n\t.is_enabled = zynqmp_clk_gate_is_enabled,\n};\n\n \nstruct clk_hw *zynqmp_clk_register_gate(const char *name, u32 clk_id,\n\t\t\t\t\tconst char * const *parents,\n\t\t\t\t\tu8 num_parents,\n\t\t\t\t\tconst struct clock_topology *nodes)\n{\n\tstruct zynqmp_clk_gate *gate;\n\tstruct clk_hw *hw;\n\tint ret;\n\tstruct clk_init_data init;\n\n\t \n\tgate = kzalloc(sizeof(*gate), GFP_KERNEL);\n\tif (!gate)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinit.name = name;\n\tinit.ops = &zynqmp_clk_gate_ops;\n\n\tinit.flags = zynqmp_clk_map_common_ccf_flags(nodes->flag);\n\n\tinit.parent_names = parents;\n\tinit.num_parents = 1;\n\n\t \n\tgate->flags = nodes->type_flag;\n\tgate->hw.init = &init;\n\tgate->clk_id = clk_id;\n\n\thw = &gate->hw;\n\tret = clk_hw_register(NULL, hw);\n\tif (ret) {\n\t\tkfree(gate);\n\t\thw = ERR_PTR(ret);\n\t}\n\n\treturn hw;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}