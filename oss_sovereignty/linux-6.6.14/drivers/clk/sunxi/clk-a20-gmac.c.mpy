{
  "module_name": "clk-a20-gmac.c",
  "hash_id": "a63489b61624ccb80a4c2c9c5ccbe4e4a9819cfb7d02674fe3fe2ed56385e97b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi/clk-a20-gmac.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/slab.h>\n\nstatic DEFINE_SPINLOCK(gmac_lock);\n\n \n\n#define SUN7I_A20_GMAC_GPIT\t2\n#define SUN7I_A20_GMAC_MASK\t0x3\n#define SUN7I_A20_GMAC_PARENTS\t2\n\nstatic u32 sun7i_a20_gmac_mux_table[SUN7I_A20_GMAC_PARENTS] = {\n\t0x00,  \n\t0x02,  \n};\n\nstatic void __init sun7i_a20_gmac_clk_setup(struct device_node *node)\n{\n\tstruct clk *clk;\n\tstruct clk_mux *mux;\n\tstruct clk_gate *gate;\n\tconst char *clk_name = node->name;\n\tconst char *parents[SUN7I_A20_GMAC_PARENTS];\n\tvoid __iomem *reg;\n\n\tif (of_property_read_string(node, \"clock-output-names\", &clk_name))\n\t\treturn;\n\n\t \n\tmux = kzalloc(sizeof(struct clk_mux), GFP_KERNEL);\n\tif (!mux)\n\t\treturn;\n\n\tgate = kzalloc(sizeof(struct clk_gate), GFP_KERNEL);\n\tif (!gate)\n\t\tgoto free_mux;\n\n\t \n\tif (of_clk_parent_fill(node, parents, 2) != 2)\n\t\tgoto free_gate;\n\n\treg = of_iomap(node, 0);\n\tif (!reg)\n\t\tgoto free_gate;\n\n\t \n\tgate->reg = reg;\n\tgate->bit_idx = SUN7I_A20_GMAC_GPIT;\n\tgate->lock = &gmac_lock;\n\tmux->reg = reg;\n\tmux->mask = SUN7I_A20_GMAC_MASK;\n\tmux->table = sun7i_a20_gmac_mux_table;\n\tmux->lock = &gmac_lock;\n\n\tclk = clk_register_composite(NULL, clk_name,\n\t\t\tparents, SUN7I_A20_GMAC_PARENTS,\n\t\t\t&mux->hw, &clk_mux_ops,\n\t\t\tNULL, NULL,\n\t\t\t&gate->hw, &clk_gate_ops,\n\t\t\t0);\n\n\tif (IS_ERR(clk))\n\t\tgoto iounmap_reg;\n\n\tof_clk_add_provider(node, of_clk_src_simple_get, clk);\n\n\treturn;\n\niounmap_reg:\n\tiounmap(reg);\nfree_gate:\n\tkfree(gate);\nfree_mux:\n\tkfree(mux);\n}\nCLK_OF_DECLARE(sun7i_a20_gmac, \"allwinner,sun7i-a20-gmac-clk\",\n\t\tsun7i_a20_gmac_clk_setup);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}