{
  "module_name": "clk-sun8i-apb0.c",
  "hash_id": "97dd61c29a8c3cf690ab46e132bb5f05bf5190ad539fccce7d4b648433237df5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi/clk-sun8i-apb0.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n\nstatic struct clk *sun8i_a23_apb0_register(struct device_node *node,\n\t\t\t\t\t   void __iomem *reg)\n{\n\tconst char *clk_name = node->name;\n\tconst char *clk_parent;\n\tstruct clk *clk;\n\tint ret;\n\n\tclk_parent = of_clk_get_parent_name(node, 0);\n\tif (!clk_parent)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tof_property_read_string(node, \"clock-output-names\", &clk_name);\n\n\t \n\tclk = clk_register_divider(NULL, clk_name, clk_parent, 0, reg,\n\t\t\t\t   0, 2, 0, NULL);\n\tif (IS_ERR(clk))\n\t\treturn clk;\n\n\tret = of_clk_add_provider(node, of_clk_src_simple_get, clk);\n\tif (ret)\n\t\tgoto err_unregister;\n\n\treturn clk;\n\nerr_unregister:\n\tclk_unregister_divider(clk);\n\n\treturn ERR_PTR(ret);\n}\n\nstatic void sun8i_a23_apb0_setup(struct device_node *node)\n{\n\tvoid __iomem *reg;\n\tstruct resource res;\n\tstruct clk *clk;\n\n\treg = of_io_request_and_map(node, 0, of_node_full_name(node));\n\tif (IS_ERR(reg)) {\n\t\t \n\t\tif (PTR_ERR(reg) != -EINVAL)\n\t\t\tpr_err(\"Could not get registers for a23-apb0-clk\\n\");\n\n\t\treturn;\n\t}\n\n\tclk = sun8i_a23_apb0_register(node, reg);\n\tif (IS_ERR(clk))\n\t\tgoto err_unmap;\n\n\treturn;\n\nerr_unmap:\n\tiounmap(reg);\n\tof_address_to_resource(node, 0, &res);\n\trelease_mem_region(res.start, resource_size(&res));\n}\nCLK_OF_DECLARE_DRIVER(sun8i_a23_apb0, \"allwinner,sun8i-a23-apb0-clk\",\n\t\t      sun8i_a23_apb0_setup);\n\nstatic int sun8i_a23_apb0_clk_probe(struct platform_device *pdev)\n{\n\tstruct device_node *np = pdev->dev.of_node;\n\tvoid __iomem *reg;\n\tstruct clk *clk;\n\n\treg = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\tclk = sun8i_a23_apb0_register(np, reg);\n\treturn PTR_ERR_OR_ZERO(clk);\n}\n\nstatic const struct of_device_id sun8i_a23_apb0_clk_dt_ids[] = {\n\t{ .compatible = \"allwinner,sun8i-a23-apb0-clk\" },\n\t{   }\n};\n\nstatic struct platform_driver sun8i_a23_apb0_clk_driver = {\n\t.driver = {\n\t\t.name = \"sun8i-a23-apb0-clk\",\n\t\t.of_match_table = sun8i_a23_apb0_clk_dt_ids,\n\t},\n\t.probe = sun8i_a23_apb0_clk_probe,\n};\nbuiltin_platform_driver(sun8i_a23_apb0_clk_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}