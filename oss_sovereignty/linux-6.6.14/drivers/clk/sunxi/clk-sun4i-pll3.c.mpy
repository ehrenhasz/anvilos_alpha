{
  "module_name": "clk-sun4i-pll3.c",
  "hash_id": "a55dbf94d51be4b4bc6a1f2651eb489b0aa970db0d563b8adc284b020cd82e39",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi/clk-sun4i-pll3.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n\n#define SUN4I_A10_PLL3_GATE_BIT\t31\n#define SUN4I_A10_PLL3_DIV_WIDTH\t7\n#define SUN4I_A10_PLL3_DIV_SHIFT\t0\n\nstatic DEFINE_SPINLOCK(sun4i_a10_pll3_lock);\n\nstatic void __init sun4i_a10_pll3_setup(struct device_node *node)\n{\n\tconst char *clk_name = node->name, *parent;\n\tstruct clk_multiplier *mult;\n\tstruct clk_gate *gate;\n\tstruct resource res;\n\tvoid __iomem *reg;\n\tstruct clk *clk;\n\tint ret;\n\n\tof_property_read_string(node, \"clock-output-names\", &clk_name);\n\tparent = of_clk_get_parent_name(node, 0);\n\n\treg = of_io_request_and_map(node, 0, of_node_full_name(node));\n\tif (IS_ERR(reg)) {\n\t\tpr_err(\"%s: Could not map the clock registers\\n\", clk_name);\n\t\treturn;\n\t}\n\n\tgate = kzalloc(sizeof(*gate), GFP_KERNEL);\n\tif (!gate)\n\t\tgoto err_unmap;\n\n\tgate->reg = reg;\n\tgate->bit_idx = SUN4I_A10_PLL3_GATE_BIT;\n\tgate->lock = &sun4i_a10_pll3_lock;\n\n\tmult = kzalloc(sizeof(*mult), GFP_KERNEL);\n\tif (!mult)\n\t\tgoto err_free_gate;\n\n\tmult->reg = reg;\n\tmult->shift = SUN4I_A10_PLL3_DIV_SHIFT;\n\tmult->width = SUN4I_A10_PLL3_DIV_WIDTH;\n\tmult->lock = &sun4i_a10_pll3_lock;\n\n\tclk = clk_register_composite(NULL, clk_name,\n\t\t\t\t     &parent, 1,\n\t\t\t\t     NULL, NULL,\n\t\t\t\t     &mult->hw, &clk_multiplier_ops,\n\t\t\t\t     &gate->hw, &clk_gate_ops,\n\t\t\t\t     0);\n\tif (IS_ERR(clk)) {\n\t\tpr_err(\"%s: Couldn't register the clock\\n\", clk_name);\n\t\tgoto err_free_mult;\n\t}\n\n\tret = of_clk_add_provider(node, of_clk_src_simple_get, clk);\n\tif (ret) {\n\t\tpr_err(\"%s: Couldn't register DT provider\\n\",\n\t\t       clk_name);\n\t\tgoto err_clk_unregister;\n\t}\n\n\treturn;\n\nerr_clk_unregister:\n\tclk_unregister_composite(clk);\nerr_free_mult:\n\tkfree(mult);\nerr_free_gate:\n\tkfree(gate);\nerr_unmap:\n\tiounmap(reg);\n\tof_address_to_resource(node, 0, &res);\n\trelease_mem_region(res.start, resource_size(&res));\n}\n\nCLK_OF_DECLARE(sun4i_a10_pll3, \"allwinner,sun4i-a10-pll3-clk\",\n\t       sun4i_a10_pll3_setup);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}