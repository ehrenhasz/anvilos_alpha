{
  "module_name": "clk-sun6i-ar100.c",
  "hash_id": "8c2981266bc027719e98a43f567550c3fc0dc5f36f60f210a30cb8eab1c32313",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi/clk-sun6i-ar100.c",
  "human_readable_source": "\n \n\n#include <linux/bitops.h>\n#include <linux/clk-provider.h>\n#include <linux/init.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/spinlock.h>\n\n#include \"clk-factors.h\"\n\n \nstatic void sun6i_get_ar100_factors(struct factors_request *req)\n{\n\tunsigned long div;\n\tint shift;\n\n\t \n\tif (req->rate > req->parent_rate)\n\t\treq->rate = req->parent_rate;\n\n\tdiv = DIV_ROUND_UP(req->parent_rate, req->rate);\n\n\tif (div < 32)\n\t\tshift = 0;\n\telse if (div >> 1 < 32)\n\t\tshift = 1;\n\telse if (div >> 2 < 32)\n\t\tshift = 2;\n\telse\n\t\tshift = 3;\n\n\tdiv >>= shift;\n\n\tif (div > 32)\n\t\tdiv = 32;\n\n\treq->rate = (req->parent_rate >> shift) / div;\n\treq->m = div - 1;\n\treq->p = shift;\n}\n\nstatic const struct clk_factors_config sun6i_ar100_config = {\n\t.mwidth = 5,\n\t.mshift = 8,\n\t.pwidth = 2,\n\t.pshift = 4,\n};\n\nstatic const struct factors_data sun6i_ar100_data = {\n\t.mux = 16,\n\t.muxmask = GENMASK(1, 0),\n\t.table = &sun6i_ar100_config,\n\t.getter = sun6i_get_ar100_factors,\n};\n\nstatic DEFINE_SPINLOCK(sun6i_ar100_lock);\n\nstatic int sun6i_a31_ar100_clk_probe(struct platform_device *pdev)\n{\n\tstruct device_node *np = pdev->dev.of_node;\n\tvoid __iomem *reg;\n\tstruct clk *clk;\n\n\treg = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\tclk = sunxi_factors_register(np, &sun6i_ar100_data, &sun6i_ar100_lock,\n\t\t\t\t     reg);\n\tif (!clk)\n\t\treturn -ENOMEM;\n\n\tplatform_set_drvdata(pdev, clk);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id sun6i_a31_ar100_clk_dt_ids[] = {\n\t{ .compatible = \"allwinner,sun6i-a31-ar100-clk\" },\n\t{   }\n};\n\nstatic struct platform_driver sun6i_a31_ar100_clk_driver = {\n\t.driver = {\n\t\t.name = \"sun6i-a31-ar100-clk\",\n\t\t.of_match_table = sun6i_a31_ar100_clk_dt_ids,\n\t\t.suppress_bind_attrs = true,\n\t},\n\t.probe = sun6i_a31_ar100_clk_probe,\n};\nbuiltin_platform_driver(sun6i_a31_ar100_clk_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}