{
  "module_name": "pll-da850.c",
  "hash_id": "dbda4562e4fe33aa49c077c98370c44a6f100bb7dfdee84cd7a524f81c8e1214",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/davinci/pll-da850.c",
  "human_readable_source": "\n \n\n#include <linux/bitops.h>\n#include <linux/clk-provider.h>\n#include <linux/clk/davinci.h>\n#include <linux/clkdev.h>\n#include <linux/device.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/kernel.h>\n#include <linux/mfd/da8xx-cfgchip.h>\n#include <linux/mfd/syscon.h>\n#include <linux/of_address.h>\n#include <linux/of.h>\n#include <linux/types.h>\n\n#include \"pll.h\"\n\n#define OCSEL_OCSRC_OSCIN\t\t0x14\n#define OCSEL_OCSRC_PLL0_SYSCLK(n)\t(0x16 + (n))\n#define OCSEL_OCSRC_PLL1_OBSCLK\t\t0x1e\n#define OCSEL_OCSRC_PLL1_SYSCLK(n)\t(0x16 + (n))\n\nstatic const struct davinci_pll_clk_info da850_pll0_info = {\n\t.name = \"pll0\",\n\t.unlock_reg = CFGCHIP(0),\n\t.unlock_mask = CFGCHIP0_PLL_MASTER_LOCK,\n\t.pllm_mask = GENMASK(4, 0),\n\t.pllm_min = 4,\n\t.pllm_max = 32,\n\t.pllout_min_rate = 300000000,\n\t.pllout_max_rate = 600000000,\n\t.flags = PLL_HAS_CLKMODE | PLL_HAS_PREDIV | PLL_HAS_POSTDIV |\n\t\t PLL_HAS_EXTCLKSRC,\n};\n\n \n\nSYSCLK(1, pll0_sysclk1, pll0_pllen, 5, SYSCLK_FIXED_DIV);\nSYSCLK(2, pll0_sysclk2, pll0_pllen, 5, SYSCLK_FIXED_DIV);\nSYSCLK(3, pll0_sysclk3, pll0_pllen, 5, 0);\nSYSCLK(4, pll0_sysclk4, pll0_pllen, 5, SYSCLK_FIXED_DIV);\nSYSCLK(5, pll0_sysclk5, pll0_pllen, 5, 0);\nSYSCLK(6, pll0_sysclk6, pll0_pllen, 5, SYSCLK_ARM_RATE | SYSCLK_FIXED_DIV);\nSYSCLK(7, pll0_sysclk7, pll0_pllen, 5, 0);\n\nstatic const char * const da850_pll0_obsclk_parent_names[] = {\n\t\"oscin\",\n\t\"pll0_sysclk1\",\n\t\"pll0_sysclk2\",\n\t\"pll0_sysclk3\",\n\t\"pll0_sysclk4\",\n\t\"pll0_sysclk5\",\n\t\"pll0_sysclk6\",\n\t\"pll0_sysclk7\",\n\t\"pll1_obsclk\",\n};\n\nstatic u32 da850_pll0_obsclk_table[] = {\n\tOCSEL_OCSRC_OSCIN,\n\tOCSEL_OCSRC_PLL0_SYSCLK(1),\n\tOCSEL_OCSRC_PLL0_SYSCLK(2),\n\tOCSEL_OCSRC_PLL0_SYSCLK(3),\n\tOCSEL_OCSRC_PLL0_SYSCLK(4),\n\tOCSEL_OCSRC_PLL0_SYSCLK(5),\n\tOCSEL_OCSRC_PLL0_SYSCLK(6),\n\tOCSEL_OCSRC_PLL0_SYSCLK(7),\n\tOCSEL_OCSRC_PLL1_OBSCLK,\n};\n\nstatic const struct davinci_pll_obsclk_info da850_pll0_obsclk_info = {\n\t.name = \"pll0_obsclk\",\n\t.parent_names = da850_pll0_obsclk_parent_names,\n\t.num_parents = ARRAY_SIZE(da850_pll0_obsclk_parent_names),\n\t.table = da850_pll0_obsclk_table,\n\t.ocsrc_mask = GENMASK(4, 0),\n};\n\nint da850_pll0_init(struct device *dev, void __iomem *base, struct regmap *cfgchip)\n{\n\tstruct clk *clk;\n\n\tdavinci_pll_clk_register(dev, &da850_pll0_info, \"ref_clk\", base, cfgchip);\n\n\tclk = davinci_pll_sysclk_register(dev, &pll0_sysclk1, base);\n\tclk_register_clkdev(clk, \"pll0_sysclk1\", \"da850-psc0\");\n\n\tclk = davinci_pll_sysclk_register(dev, &pll0_sysclk2, base);\n\tclk_register_clkdev(clk, \"pll0_sysclk2\", \"da850-psc0\");\n\tclk_register_clkdev(clk, \"pll0_sysclk2\", \"da850-psc1\");\n\tclk_register_clkdev(clk, \"pll0_sysclk2\", \"da850-async3-clksrc\");\n\n\tclk = davinci_pll_sysclk_register(dev, &pll0_sysclk3, base);\n\tclk_register_clkdev(clk, \"pll0_sysclk3\", \"da850-async1-clksrc\");\n\n\tclk = davinci_pll_sysclk_register(dev, &pll0_sysclk4, base);\n\tclk_register_clkdev(clk, \"pll0_sysclk4\", \"da850-psc0\");\n\tclk_register_clkdev(clk, \"pll0_sysclk4\", \"da850-psc1\");\n\n\tdavinci_pll_sysclk_register(dev, &pll0_sysclk5, base);\n\n\tclk = davinci_pll_sysclk_register(dev, &pll0_sysclk6, base);\n\tclk_register_clkdev(clk, \"pll0_sysclk6\", \"da850-psc0\");\n\n\tdavinci_pll_sysclk_register(dev, &pll0_sysclk7, base);\n\n\tdavinci_pll_auxclk_register(dev, \"pll0_auxclk\", base);\n\n\tclk = clk_register_fixed_factor(dev, \"async2\", \"pll0_auxclk\",\n\t\t\t\t\tCLK_IS_CRITICAL, 1, 1);\n\n\tclk_register_clkdev(clk, NULL, \"i2c_davinci.1\");\n\tclk_register_clkdev(clk, \"timer0\", NULL);\n\tclk_register_clkdev(clk, NULL, \"davinci-wdt\");\n\n\tdavinci_pll_obsclk_register(dev, &da850_pll0_obsclk_info, base);\n\n\treturn 0;\n}\n\nstatic const struct davinci_pll_sysclk_info *da850_pll0_sysclk_info[] = {\n\t&pll0_sysclk1,\n\t&pll0_sysclk2,\n\t&pll0_sysclk3,\n\t&pll0_sysclk4,\n\t&pll0_sysclk5,\n\t&pll0_sysclk6,\n\t&pll0_sysclk7,\n\tNULL\n};\n\nvoid of_da850_pll0_init(struct device_node *node)\n{\n\tvoid __iomem *base;\n\tstruct regmap *cfgchip;\n\n\tbase = of_iomap(node, 0);\n\tif (!base) {\n\t\tpr_err(\"%s: ioremap failed\\n\", __func__);\n\t\treturn;\n\t}\n\n\tcfgchip = syscon_regmap_lookup_by_compatible(\"ti,da830-cfgchip\");\n\n\tof_davinci_pll_init(NULL, node, &da850_pll0_info,\n\t\t\t    &da850_pll0_obsclk_info,\n\t\t\t    da850_pll0_sysclk_info, 7, base, cfgchip);\n}\n\nstatic const struct davinci_pll_clk_info da850_pll1_info = {\n\t.name = \"pll1\",\n\t.unlock_reg = CFGCHIP(3),\n\t.unlock_mask = CFGCHIP3_PLL1_MASTER_LOCK,\n\t.pllm_mask = GENMASK(4, 0),\n\t.pllm_min = 4,\n\t.pllm_max = 32,\n\t.pllout_min_rate = 300000000,\n\t.pllout_max_rate = 600000000,\n\t.flags = PLL_HAS_POSTDIV,\n};\n\nSYSCLK(1, pll1_sysclk1, pll1_pllen, 5, SYSCLK_ALWAYS_ENABLED);\nSYSCLK(2, pll1_sysclk2, pll1_pllen, 5, 0);\nSYSCLK(3, pll1_sysclk3, pll1_pllen, 5, 0);\n\nstatic const char * const da850_pll1_obsclk_parent_names[] = {\n\t\"oscin\",\n\t\"pll1_sysclk1\",\n\t\"pll1_sysclk2\",\n\t\"pll1_sysclk3\",\n};\n\nstatic u32 da850_pll1_obsclk_table[] = {\n\tOCSEL_OCSRC_OSCIN,\n\tOCSEL_OCSRC_PLL1_SYSCLK(1),\n\tOCSEL_OCSRC_PLL1_SYSCLK(2),\n\tOCSEL_OCSRC_PLL1_SYSCLK(3),\n};\n\nstatic const struct davinci_pll_obsclk_info da850_pll1_obsclk_info = {\n\t.name = \"pll1_obsclk\",\n\t.parent_names = da850_pll1_obsclk_parent_names,\n\t.num_parents = ARRAY_SIZE(da850_pll1_obsclk_parent_names),\n\t.table = da850_pll1_obsclk_table,\n\t.ocsrc_mask = GENMASK(4, 0),\n};\n\nint da850_pll1_init(struct device *dev, void __iomem *base, struct regmap *cfgchip)\n{\n\tstruct clk *clk;\n\n\tdavinci_pll_clk_register(dev, &da850_pll1_info, \"oscin\", base, cfgchip);\n\n\tdavinci_pll_sysclk_register(dev, &pll1_sysclk1, base);\n\n\tclk = davinci_pll_sysclk_register(dev, &pll1_sysclk2, base);\n\tclk_register_clkdev(clk, \"pll1_sysclk2\", \"da850-async3-clksrc\");\n\n\tdavinci_pll_sysclk_register(dev, &pll1_sysclk3, base);\n\n\tdavinci_pll_obsclk_register(dev, &da850_pll1_obsclk_info, base);\n\n\treturn 0;\n}\n\nstatic const struct davinci_pll_sysclk_info *da850_pll1_sysclk_info[] = {\n\t&pll1_sysclk1,\n\t&pll1_sysclk2,\n\t&pll1_sysclk3,\n\tNULL\n};\n\nint of_da850_pll1_init(struct device *dev, void __iomem *base, struct regmap *cfgchip)\n{\n\treturn of_davinci_pll_init(dev, dev->of_node, &da850_pll1_info,\n\t\t\t\t   &da850_pll1_obsclk_info,\n\t\t\t\t   da850_pll1_sysclk_info, 3, base, cfgchip);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}