{
  "module_name": "g12a-aoclk.c",
  "hash_id": "b4a1de5fd03adc94b2b534920b2c96afe254d0ea8b3286da0a938ab9888207bd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/meson/g12a-aoclk.c",
  "human_readable_source": "\n \n#include <linux/clk-provider.h>\n#include <linux/platform_device.h>\n#include <linux/reset-controller.h>\n#include <linux/mfd/syscon.h>\n#include <linux/module.h>\n#include \"meson-aoclk.h\"\n\n#include \"clk-regmap.h\"\n#include \"clk-dualdiv.h\"\n\n#include <dt-bindings/clock/g12a-aoclkc.h>\n#include <dt-bindings/reset/g12a-aoclkc.h>\n\n \n#define AO_RTI_STATUS_REG3\t0x0C\n#define AO_RTI_PWR_CNTL_REG0\t0x10\n#define AO_RTI_GEN_CNTL_REG0\t0x40\n#define AO_CLK_GATE0\t\t0x4c\n#define AO_CLK_GATE0_SP\t\t0x50\n#define AO_OSCIN_CNTL\t\t0x58\n#define AO_CEC_CLK_CNTL_REG0\t0x74\n#define AO_CEC_CLK_CNTL_REG1\t0x78\n#define AO_SAR_CLK\t\t0x90\n#define AO_RTC_ALT_CLK_CNTL0\t0x94\n#define AO_RTC_ALT_CLK_CNTL1\t0x98\n\n \n#define AXG_AO_GATE(_name, _reg, _bit)\t\t\t\t\t\\\nstatic struct clk_regmap g12a_aoclk_##_name = {\t\t\t\t\\\n\t.data = &(struct clk_regmap_gate_data) {\t\t\t\\\n\t\t.offset = (_reg),\t\t\t\t\t\\\n\t\t.bit_idx = (_bit),\t\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\\\n\t.hw.init = &(struct clk_init_data) {\t\t\t\t\\\n\t\t.name =  \"g12a_ao_\" #_name,\t\t\t\t\\\n\t\t.ops = &clk_regmap_gate_ops,\t\t\t\t\\\n\t\t.parent_data = &(const struct clk_parent_data) {\t\\\n\t\t\t.fw_name = \"mpeg-clk\",\t\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.num_parents = 1,\t\t\t\t\t\\\n\t\t.flags = CLK_IGNORE_UNUSED,\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\\\n}\n\nAXG_AO_GATE(ahb, AO_CLK_GATE0, 0);\nAXG_AO_GATE(ir_in, AO_CLK_GATE0, 1);\nAXG_AO_GATE(i2c_m0, AO_CLK_GATE0, 2);\nAXG_AO_GATE(i2c_s0, AO_CLK_GATE0, 3);\nAXG_AO_GATE(uart, AO_CLK_GATE0, 4);\nAXG_AO_GATE(prod_i2c, AO_CLK_GATE0, 5);\nAXG_AO_GATE(uart2, AO_CLK_GATE0, 6);\nAXG_AO_GATE(ir_out, AO_CLK_GATE0, 7);\nAXG_AO_GATE(saradc, AO_CLK_GATE0, 8);\nAXG_AO_GATE(mailbox, AO_CLK_GATE0_SP, 0);\nAXG_AO_GATE(m3, AO_CLK_GATE0_SP, 1);\nAXG_AO_GATE(ahb_sram, AO_CLK_GATE0_SP, 2);\nAXG_AO_GATE(rti, AO_CLK_GATE0_SP, 3);\nAXG_AO_GATE(m4_fclk, AO_CLK_GATE0_SP, 4);\nAXG_AO_GATE(m4_hclk, AO_CLK_GATE0_SP, 5);\n\nstatic struct clk_regmap g12a_aoclk_cts_oscin = {\n\t.data = &(struct clk_regmap_gate_data){\n\t\t.offset = AO_RTI_PWR_CNTL_REG0,\n\t\t.bit_idx = 14,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"cts_oscin\",\n\t\t.ops = &clk_regmap_gate_ro_ops,\n\t\t.parent_data = &(const struct clk_parent_data) {\n\t\t\t.fw_name = \"xtal\",\n\t\t},\n\t\t.num_parents = 1,\n\t},\n};\n\nstatic const struct meson_clk_dualdiv_param g12a_32k_div_table[] = {\n\t{\n\t\t.dual\t= 1,\n\t\t.n1\t= 733,\n\t\t.m1\t= 8,\n\t\t.n2\t= 732,\n\t\t.m2\t= 11,\n\t}, {}\n};\n\n \n\nstatic struct clk_regmap g12a_aoclk_32k_by_oscin_pre = {\n\t.data = &(struct clk_regmap_gate_data){\n\t\t.offset = AO_RTC_ALT_CLK_CNTL0,\n\t\t.bit_idx = 31,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_32k_by_oscin_pre\",\n\t\t.ops = &clk_regmap_gate_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_cts_oscin.hw\n\t\t},\n\t\t.num_parents = 1,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_32k_by_oscin_div = {\n\t.data = &(struct meson_clk_dualdiv_data){\n\t\t.n1 = {\n\t\t\t.reg_off = AO_RTC_ALT_CLK_CNTL0,\n\t\t\t.shift   = 0,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.n2 = {\n\t\t\t.reg_off = AO_RTC_ALT_CLK_CNTL0,\n\t\t\t.shift   = 12,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.m1 = {\n\t\t\t.reg_off = AO_RTC_ALT_CLK_CNTL1,\n\t\t\t.shift   = 0,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.m2 = {\n\t\t\t.reg_off = AO_RTC_ALT_CLK_CNTL1,\n\t\t\t.shift   = 12,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.dual = {\n\t\t\t.reg_off = AO_RTC_ALT_CLK_CNTL0,\n\t\t\t.shift   = 28,\n\t\t\t.width   = 1,\n\t\t},\n\t\t.table = g12a_32k_div_table,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_32k_by_oscin_div\",\n\t\t.ops = &meson_clk_dualdiv_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_32k_by_oscin_pre.hw\n\t\t},\n\t\t.num_parents = 1,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_32k_by_oscin_sel = {\n\t.data = &(struct clk_regmap_mux_data) {\n\t\t.offset = AO_RTC_ALT_CLK_CNTL1,\n\t\t.mask = 0x1,\n\t\t.shift = 24,\n\t\t.flags = CLK_MUX_ROUND_CLOSEST,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_32k_by_oscin_sel\",\n\t\t.ops = &clk_regmap_mux_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_32k_by_oscin_div.hw,\n\t\t\t&g12a_aoclk_32k_by_oscin_pre.hw,\n\t\t},\n\t\t.num_parents = 2,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_32k_by_oscin = {\n\t.data = &(struct clk_regmap_gate_data){\n\t\t.offset = AO_RTC_ALT_CLK_CNTL0,\n\t\t.bit_idx = 30,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_32k_by_oscin\",\n\t\t.ops = &clk_regmap_gate_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_32k_by_oscin_sel.hw\n\t\t},\n\t\t.num_parents = 1,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\n \n\nstatic struct clk_regmap g12a_aoclk_cec_pre = {\n\t.data = &(struct clk_regmap_gate_data){\n\t\t.offset = AO_CEC_CLK_CNTL_REG0,\n\t\t.bit_idx = 31,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_cec_pre\",\n\t\t.ops = &clk_regmap_gate_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_cts_oscin.hw\n\t\t},\n\t\t.num_parents = 1,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_cec_div = {\n\t.data = &(struct meson_clk_dualdiv_data){\n\t\t.n1 = {\n\t\t\t.reg_off = AO_CEC_CLK_CNTL_REG0,\n\t\t\t.shift   = 0,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.n2 = {\n\t\t\t.reg_off = AO_CEC_CLK_CNTL_REG0,\n\t\t\t.shift   = 12,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.m1 = {\n\t\t\t.reg_off = AO_CEC_CLK_CNTL_REG1,\n\t\t\t.shift   = 0,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.m2 = {\n\t\t\t.reg_off = AO_CEC_CLK_CNTL_REG1,\n\t\t\t.shift   = 12,\n\t\t\t.width   = 12,\n\t\t},\n\t\t.dual = {\n\t\t\t.reg_off = AO_CEC_CLK_CNTL_REG0,\n\t\t\t.shift   = 28,\n\t\t\t.width   = 1,\n\t\t},\n\t\t.table = g12a_32k_div_table,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_cec_div\",\n\t\t.ops = &meson_clk_dualdiv_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_cec_pre.hw\n\t\t},\n\t\t.num_parents = 1,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_cec_sel = {\n\t.data = &(struct clk_regmap_mux_data) {\n\t\t.offset = AO_CEC_CLK_CNTL_REG1,\n\t\t.mask = 0x1,\n\t\t.shift = 24,\n\t\t.flags = CLK_MUX_ROUND_CLOSEST,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_cec_sel\",\n\t\t.ops = &clk_regmap_mux_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_cec_div.hw,\n\t\t\t&g12a_aoclk_cec_pre.hw,\n\t\t},\n\t\t.num_parents = 2,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_cec = {\n\t.data = &(struct clk_regmap_gate_data){\n\t\t.offset = AO_CEC_CLK_CNTL_REG0,\n\t\t.bit_idx = 30,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_cec\",\n\t\t.ops = &clk_regmap_gate_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_cec_sel.hw\n\t\t},\n\t\t.num_parents = 1,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_cts_rtc_oscin = {\n\t.data = &(struct clk_regmap_mux_data) {\n\t\t.offset = AO_RTI_PWR_CNTL_REG0,\n\t\t.mask = 0x1,\n\t\t.shift = 10,\n\t\t.flags = CLK_MUX_ROUND_CLOSEST,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_cts_rtc_oscin\",\n\t\t.ops = &clk_regmap_mux_ops,\n\t\t.parent_data = (const struct clk_parent_data []) {\n\t\t\t{ .hw = &g12a_aoclk_32k_by_oscin.hw },\n\t\t\t{ .fw_name = \"ext-32k-0\", },\n\t\t},\n\t\t.num_parents = 2,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_clk81 = {\n\t.data = &(struct clk_regmap_mux_data) {\n\t\t.offset = AO_RTI_PWR_CNTL_REG0,\n\t\t.mask = 0x1,\n\t\t.shift = 8,\n\t\t.flags = CLK_MUX_ROUND_CLOSEST,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_clk81\",\n\t\t.ops = &clk_regmap_mux_ro_ops,\n\t\t.parent_data = (const struct clk_parent_data []) {\n\t\t\t{ .fw_name = \"mpeg-clk\", },\n\t\t\t{ .hw = &g12a_aoclk_cts_rtc_oscin.hw },\n\t\t},\n\t\t.num_parents = 2,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_saradc_mux = {\n\t.data = &(struct clk_regmap_mux_data) {\n\t\t.offset = AO_SAR_CLK,\n\t\t.mask = 0x3,\n\t\t.shift = 9,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_saradc_mux\",\n\t\t.ops = &clk_regmap_mux_ops,\n\t\t.parent_data = (const struct clk_parent_data []) {\n\t\t\t{ .fw_name = \"xtal\", },\n\t\t\t{ .hw = &g12a_aoclk_clk81.hw },\n\t\t},\n\t\t.num_parents = 2,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_saradc_div = {\n\t.data = &(struct clk_regmap_div_data) {\n\t\t.offset = AO_SAR_CLK,\n\t\t.shift = 0,\n\t\t.width = 8,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_saradc_div\",\n\t\t.ops = &clk_regmap_divider_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_saradc_mux.hw\n\t\t},\n\t\t.num_parents = 1,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\nstatic struct clk_regmap g12a_aoclk_saradc_gate = {\n\t.data = &(struct clk_regmap_gate_data) {\n\t\t.offset = AO_SAR_CLK,\n\t\t.bit_idx = 8,\n\t},\n\t.hw.init = &(struct clk_init_data){\n\t\t.name = \"g12a_ao_saradc_gate\",\n\t\t.ops = &clk_regmap_gate_ops,\n\t\t.parent_hws = (const struct clk_hw *[]) {\n\t\t\t&g12a_aoclk_saradc_div.hw\n\t\t},\n\t\t.num_parents = 1,\n\t\t.flags = CLK_SET_RATE_PARENT,\n\t},\n};\n\nstatic const unsigned int g12a_aoclk_reset[] = {\n\t[RESET_AO_IR_IN]\t= 16,\n\t[RESET_AO_UART]\t\t= 17,\n\t[RESET_AO_I2C_M]\t= 18,\n\t[RESET_AO_I2C_S]\t= 19,\n\t[RESET_AO_SAR_ADC]\t= 20,\n\t[RESET_AO_UART2]\t= 22,\n\t[RESET_AO_IR_OUT]\t= 23,\n};\n\nstatic struct clk_regmap *g12a_aoclk_regmap[] = {\n\t&g12a_aoclk_ahb,\n\t&g12a_aoclk_ir_in,\n\t&g12a_aoclk_i2c_m0,\n\t&g12a_aoclk_i2c_s0,\n\t&g12a_aoclk_uart,\n\t&g12a_aoclk_prod_i2c,\n\t&g12a_aoclk_uart2,\n\t&g12a_aoclk_ir_out,\n\t&g12a_aoclk_saradc,\n\t&g12a_aoclk_mailbox,\n\t&g12a_aoclk_m3,\n\t&g12a_aoclk_ahb_sram,\n\t&g12a_aoclk_rti,\n\t&g12a_aoclk_m4_fclk,\n\t&g12a_aoclk_m4_hclk,\n\t&g12a_aoclk_cts_oscin,\n\t&g12a_aoclk_32k_by_oscin_pre,\n\t&g12a_aoclk_32k_by_oscin_div,\n\t&g12a_aoclk_32k_by_oscin_sel,\n\t&g12a_aoclk_32k_by_oscin,\n\t&g12a_aoclk_cec_pre,\n\t&g12a_aoclk_cec_div,\n\t&g12a_aoclk_cec_sel,\n\t&g12a_aoclk_cec,\n\t&g12a_aoclk_cts_rtc_oscin,\n\t&g12a_aoclk_clk81,\n\t&g12a_aoclk_saradc_mux,\n\t&g12a_aoclk_saradc_div,\n\t&g12a_aoclk_saradc_gate,\n};\n\nstatic struct clk_hw *g12a_aoclk_hw_clks[] = {\n\t[CLKID_AO_AHB]\t\t= &g12a_aoclk_ahb.hw,\n\t[CLKID_AO_IR_IN]\t= &g12a_aoclk_ir_in.hw,\n\t[CLKID_AO_I2C_M0]\t= &g12a_aoclk_i2c_m0.hw,\n\t[CLKID_AO_I2C_S0]\t= &g12a_aoclk_i2c_s0.hw,\n\t[CLKID_AO_UART]\t\t= &g12a_aoclk_uart.hw,\n\t[CLKID_AO_PROD_I2C]\t= &g12a_aoclk_prod_i2c.hw,\n\t[CLKID_AO_UART2]\t= &g12a_aoclk_uart2.hw,\n\t[CLKID_AO_IR_OUT]\t= &g12a_aoclk_ir_out.hw,\n\t[CLKID_AO_SAR_ADC]\t= &g12a_aoclk_saradc.hw,\n\t[CLKID_AO_MAILBOX]\t= &g12a_aoclk_mailbox.hw,\n\t[CLKID_AO_M3]\t\t= &g12a_aoclk_m3.hw,\n\t[CLKID_AO_AHB_SRAM]\t= &g12a_aoclk_ahb_sram.hw,\n\t[CLKID_AO_RTI]\t\t= &g12a_aoclk_rti.hw,\n\t[CLKID_AO_M4_FCLK]\t= &g12a_aoclk_m4_fclk.hw,\n\t[CLKID_AO_M4_HCLK]\t= &g12a_aoclk_m4_hclk.hw,\n\t[CLKID_AO_CLK81]\t= &g12a_aoclk_clk81.hw,\n\t[CLKID_AO_SAR_ADC_SEL]\t= &g12a_aoclk_saradc_mux.hw,\n\t[CLKID_AO_SAR_ADC_DIV]\t= &g12a_aoclk_saradc_div.hw,\n\t[CLKID_AO_SAR_ADC_CLK]\t= &g12a_aoclk_saradc_gate.hw,\n\t[CLKID_AO_CTS_OSCIN]\t= &g12a_aoclk_cts_oscin.hw,\n\t[CLKID_AO_32K_PRE]\t= &g12a_aoclk_32k_by_oscin_pre.hw,\n\t[CLKID_AO_32K_DIV]\t= &g12a_aoclk_32k_by_oscin_div.hw,\n\t[CLKID_AO_32K_SEL]\t= &g12a_aoclk_32k_by_oscin_sel.hw,\n\t[CLKID_AO_32K]\t\t= &g12a_aoclk_32k_by_oscin.hw,\n\t[CLKID_AO_CEC_PRE]\t= &g12a_aoclk_cec_pre.hw,\n\t[CLKID_AO_CEC_DIV]\t= &g12a_aoclk_cec_div.hw,\n\t[CLKID_AO_CEC_SEL]\t= &g12a_aoclk_cec_sel.hw,\n\t[CLKID_AO_CEC]\t\t= &g12a_aoclk_cec.hw,\n\t[CLKID_AO_CTS_RTC_OSCIN] = &g12a_aoclk_cts_rtc_oscin.hw,\n};\n\nstatic const struct meson_aoclk_data g12a_aoclkc_data = {\n\t.reset_reg\t= AO_RTI_GEN_CNTL_REG0,\n\t.num_reset\t= ARRAY_SIZE(g12a_aoclk_reset),\n\t.reset\t\t= g12a_aoclk_reset,\n\t.num_clks\t= ARRAY_SIZE(g12a_aoclk_regmap),\n\t.clks\t\t= g12a_aoclk_regmap,\n\t.hw_clks\t= {\n\t\t.hws\t= g12a_aoclk_hw_clks,\n\t\t.num\t= ARRAY_SIZE(g12a_aoclk_hw_clks),\n\t},\n};\n\nstatic const struct of_device_id g12a_aoclkc_match_table[] = {\n\t{\n\t\t.compatible\t= \"amlogic,meson-g12a-aoclkc\",\n\t\t.data\t\t= &g12a_aoclkc_data,\n\t},\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, g12a_aoclkc_match_table);\n\nstatic struct platform_driver g12a_aoclkc_driver = {\n\t.probe\t\t= meson_aoclkc_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"g12a-aoclkc\",\n\t\t.of_match_table = g12a_aoclkc_match_table,\n\t},\n};\n\nmodule_platform_driver(g12a_aoclkc_driver);\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}