{
  "module_name": "clk-cpu-dyndiv.c",
  "hash_id": "d11ee6bf36fb676c68c5161d86c18641a19a697e4aafdff6cdcc38f5c7a63035",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/meson/clk-cpu-dyndiv.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/module.h>\n\n#include \"clk-regmap.h\"\n#include \"clk-cpu-dyndiv.h\"\n\nstatic inline struct meson_clk_cpu_dyndiv_data *\nmeson_clk_cpu_dyndiv_data(struct clk_regmap *clk)\n{\n\treturn (struct meson_clk_cpu_dyndiv_data *)clk->data;\n}\n\nstatic unsigned long meson_clk_cpu_dyndiv_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t\t      unsigned long prate)\n{\n\tstruct clk_regmap *clk = to_clk_regmap(hw);\n\tstruct meson_clk_cpu_dyndiv_data *data = meson_clk_cpu_dyndiv_data(clk);\n\n\treturn divider_recalc_rate(hw, prate,\n\t\t\t\t   meson_parm_read(clk->map, &data->div),\n\t\t\t\t   NULL, 0, data->div.width);\n}\n\nstatic int meson_clk_cpu_dyndiv_determine_rate(struct clk_hw *hw,\n\t\t\t\t\t       struct clk_rate_request *req)\n{\n\tstruct clk_regmap *clk = to_clk_regmap(hw);\n\tstruct meson_clk_cpu_dyndiv_data *data = meson_clk_cpu_dyndiv_data(clk);\n\n\treturn divider_determine_rate(hw, req, NULL, data->div.width, 0);\n}\n\nstatic int meson_clk_cpu_dyndiv_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\t\t  unsigned long parent_rate)\n{\n\tstruct clk_regmap *clk = to_clk_regmap(hw);\n\tstruct meson_clk_cpu_dyndiv_data *data = meson_clk_cpu_dyndiv_data(clk);\n\tunsigned int val;\n\tint ret;\n\n\tret = divider_get_val(rate, parent_rate, NULL, data->div.width, 0);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tval = (unsigned int)ret << data->div.shift;\n\n\t \n\tmeson_parm_write(clk->map, &data->dyn, 1);\n\n\t \n\treturn regmap_update_bits(clk->map, data->div.reg_off,\n\t\t\t\t  SETPMASK(data->div.width, data->div.shift) |\n\t\t\t\t  SETPMASK(data->dyn.width, data->dyn.shift),\n\t\t\t\t  val);\n};\n\nconst struct clk_ops meson_clk_cpu_dyndiv_ops = {\n\t.recalc_rate = meson_clk_cpu_dyndiv_recalc_rate,\n\t.determine_rate = meson_clk_cpu_dyndiv_determine_rate,\n\t.set_rate = meson_clk_cpu_dyndiv_set_rate,\n};\nEXPORT_SYMBOL_GPL(meson_clk_cpu_dyndiv_ops);\n\nMODULE_DESCRIPTION(\"Amlogic CPU Dynamic Clock divider\");\nMODULE_AUTHOR(\"Neil Armstrong <narmstrong@baylibre.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}