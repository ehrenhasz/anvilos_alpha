{
  "module_name": "clk-div.c",
  "hash_id": "4d8c0170a14bfe345ca84f3b8829b9d92d53804023f42881e53e8c684b067ee0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mxs/clk-div.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/err.h>\n#include <linux/slab.h>\n#include \"clk.h\"\n\n \nstruct clk_div {\n\tstruct clk_divider divider;\n\tconst struct clk_ops *ops;\n\tvoid __iomem *reg;\n\tu8 busy;\n};\n\nstatic inline struct clk_div *to_clk_div(struct clk_hw *hw)\n{\n\tstruct clk_divider *divider = to_clk_divider(hw);\n\n\treturn container_of(divider, struct clk_div, divider);\n}\n\nstatic unsigned long clk_div_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t unsigned long parent_rate)\n{\n\tstruct clk_div *div = to_clk_div(hw);\n\n\treturn div->ops->recalc_rate(&div->divider.hw, parent_rate);\n}\n\nstatic long clk_div_round_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t       unsigned long *prate)\n{\n\tstruct clk_div *div = to_clk_div(hw);\n\n\treturn div->ops->round_rate(&div->divider.hw, rate, prate);\n}\n\nstatic int clk_div_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t    unsigned long parent_rate)\n{\n\tstruct clk_div *div = to_clk_div(hw);\n\tint ret;\n\n\tret = div->ops->set_rate(&div->divider.hw, rate, parent_rate);\n\tif (!ret)\n\t\tret = mxs_clk_wait(div->reg, div->busy);\n\n\treturn ret;\n}\n\nstatic const struct clk_ops clk_div_ops = {\n\t.recalc_rate = clk_div_recalc_rate,\n\t.round_rate = clk_div_round_rate,\n\t.set_rate = clk_div_set_rate,\n};\n\nstruct clk *mxs_clk_div(const char *name, const char *parent_name,\n\t\t\tvoid __iomem *reg, u8 shift, u8 width, u8 busy)\n{\n\tstruct clk_div *div;\n\tstruct clk *clk;\n\tstruct clk_init_data init;\n\n\tdiv = kzalloc(sizeof(*div), GFP_KERNEL);\n\tif (!div)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinit.name = name;\n\tinit.ops = &clk_div_ops;\n\tinit.flags = CLK_SET_RATE_PARENT;\n\tinit.parent_names = (parent_name ? &parent_name: NULL);\n\tinit.num_parents = (parent_name ? 1 : 0);\n\n\tdiv->reg = reg;\n\tdiv->busy = busy;\n\n\tdiv->divider.reg = reg;\n\tdiv->divider.shift = shift;\n\tdiv->divider.width = width;\n\tdiv->divider.flags = CLK_DIVIDER_ONE_BASED;\n\tdiv->divider.lock = &mxs_lock;\n\tdiv->divider.hw.init = &init;\n\tdiv->ops = &clk_divider_ops;\n\n\tclk = clk_register(NULL, &div->divider.hw);\n\tif (IS_ERR(clk))\n\t\tkfree(div);\n\n\treturn clk;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}