{
  "module_name": "r8a7743-cpg-mssr.c",
  "hash_id": "4464040e8d9deea221fae57948dd6cbd28e760cba763afb42918c6abba62db15",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/renesas/r8a7743-cpg-mssr.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/of.h>\n#include <linux/soc/renesas/rcar-rst.h>\n\n#include <dt-bindings/clock/r8a7743-cpg-mssr.h>\n\n#include \"renesas-cpg-mssr.h\"\n#include \"rcar-gen2-cpg.h\"\n\nenum clk_ids {\n\t \n\tLAST_DT_CORE_CLK = R8A7743_CLK_OSC,\n\n\t \n\tCLK_EXTAL,\n\tCLK_USB_EXTAL,\n\n\t \n\tCLK_MAIN,\n\tCLK_PLL0,\n\tCLK_PLL1,\n\tCLK_PLL3,\n\tCLK_PLL1_DIV2,\n\n\t \n\tMOD_CLK_BASE\n};\n\nstatic struct cpg_core_clk r8a7743_core_clks[] __initdata = {\n\t \n\tDEF_INPUT(\"extal\",\tCLK_EXTAL),\n\tDEF_INPUT(\"usb_extal\",\tCLK_USB_EXTAL),\n\n\t \n\tDEF_BASE(\".main\",\tCLK_MAIN, CLK_TYPE_GEN2_MAIN, CLK_EXTAL),\n\tDEF_BASE(\".pll0\",\tCLK_PLL0, CLK_TYPE_GEN2_PLL0, CLK_MAIN),\n\tDEF_BASE(\".pll1\",\tCLK_PLL1, CLK_TYPE_GEN2_PLL1, CLK_MAIN),\n\tDEF_BASE(\".pll3\",\tCLK_PLL3, CLK_TYPE_GEN2_PLL3, CLK_MAIN),\n\n\tDEF_FIXED(\".pll1_div2\",\tCLK_PLL1_DIV2, CLK_PLL1, 2, 1),\n\n\t \n\tDEF_BASE(\"z\",    R8A7743_CLK_Z,    CLK_TYPE_GEN2_Z,\tCLK_PLL0),\n\tDEF_BASE(\"sdh\",  R8A7743_CLK_SDH,  CLK_TYPE_GEN2_SDH,\tCLK_PLL1),\n\tDEF_BASE(\"sd0\",  R8A7743_CLK_SD0,  CLK_TYPE_GEN2_SD0,\tCLK_PLL1),\n\tDEF_BASE(\"qspi\", R8A7743_CLK_QSPI, CLK_TYPE_GEN2_QSPI,\tCLK_PLL1_DIV2),\n\tDEF_BASE(\"rcan\", R8A7743_CLK_RCAN, CLK_TYPE_GEN2_RCAN,\tCLK_USB_EXTAL),\n\n\tDEF_FIXED(\"zg\",    R8A7743_CLK_ZG,\tCLK_PLL1,\t    3, 1),\n\tDEF_FIXED(\"zx\",    R8A7743_CLK_ZX,\tCLK_PLL1,\t    3, 1),\n\tDEF_FIXED(\"zs\",    R8A7743_CLK_ZS,\tCLK_PLL1,\t    6, 1),\n\tDEF_FIXED(\"hp\",    R8A7743_CLK_HP,\tCLK_PLL1,\t   12, 1),\n\tDEF_FIXED(\"b\",     R8A7743_CLK_B,\tCLK_PLL1,\t   12, 1),\n\tDEF_FIXED(\"lb\",    R8A7743_CLK_LB,\tCLK_PLL1,\t   24, 1),\n\tDEF_FIXED(\"p\",     R8A7743_CLK_P,\tCLK_PLL1,\t   24, 1),\n\tDEF_FIXED(\"cl\",    R8A7743_CLK_CL,\tCLK_PLL1,\t   48, 1),\n\tDEF_FIXED(\"m2\",    R8A7743_CLK_M2,\tCLK_PLL1,\t    8, 1),\n\tDEF_FIXED(\"zb3\",   R8A7743_CLK_ZB3,\tCLK_PLL3,\t    4, 1),\n\tDEF_FIXED(\"zb3d2\", R8A7743_CLK_ZB3D2,\tCLK_PLL3,\t    8, 1),\n\tDEF_FIXED(\"ddr\",   R8A7743_CLK_DDR,\tCLK_PLL3,\t    8, 1),\n\tDEF_FIXED(\"mp\",    R8A7743_CLK_MP,\tCLK_PLL1_DIV2,\t   15, 1),\n\tDEF_FIXED(\"cp\",    R8A7743_CLK_CP,\tCLK_EXTAL,\t    2, 1),\n\tDEF_FIXED(\"r\",     R8A7743_CLK_R,\tCLK_PLL1,\t49152, 1),\n\tDEF_FIXED(\"osc\",   R8A7743_CLK_OSC,\tCLK_PLL1,\t12288, 1),\n\n\tDEF_DIV6P1(\"sd2\",  R8A7743_CLK_SD2,\tCLK_PLL1_DIV2,\t0x078),\n\tDEF_DIV6P1(\"sd3\",  R8A7743_CLK_SD3,\tCLK_PLL1_DIV2,\t0x26c),\n\tDEF_DIV6P1(\"mmc0\", R8A7743_CLK_MMC0,\tCLK_PLL1_DIV2,\t0x240),\n};\n\nstatic const struct mssr_mod_clk r8a7743_mod_clks[] __initconst = {\n\tDEF_MOD(\"msiof0\",\t\t   0,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"vcp0\",\t\t\t 101,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"vpc0\",\t\t\t 103,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"tmu1\",\t\t\t 111,\tR8A7743_CLK_P),\n\tDEF_MOD(\"3dg\",\t\t\t 112,\tR8A7743_CLK_ZG),\n\tDEF_MOD(\"2d-dmac\",\t\t 115,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"fdp1-1\",\t\t 118,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"fdp1-0\",\t\t 119,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"tmu3\",\t\t\t 121,\tR8A7743_CLK_P),\n\tDEF_MOD(\"tmu2\",\t\t\t 122,\tR8A7743_CLK_P),\n\tDEF_MOD(\"cmt0\",\t\t\t 124,\tR8A7743_CLK_R),\n\tDEF_MOD(\"tmu0\",\t\t\t 125,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"vsp1du1\",\t\t 127,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"vsp1du0\",\t\t 128,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"vsps\",\t\t\t 131,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"scifa2\",\t\t 202,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"scifa1\",\t\t 203,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"scifa0\",\t\t 204,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"msiof2\",\t\t 205,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"scifb0\",\t\t 206,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"scifb1\",\t\t 207,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"msiof1\",\t\t 208,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"scifb2\",\t\t 216,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"sys-dmac1\",\t\t 218,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"sys-dmac0\",\t\t 219,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"tpu0\",\t\t\t 304,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"sdhi3\",\t\t 311,\tR8A7743_CLK_SD3),\n\tDEF_MOD(\"sdhi2\",\t\t 312,\tR8A7743_CLK_SD2),\n\tDEF_MOD(\"sdhi0\",\t\t 314,\tR8A7743_CLK_SD0),\n\tDEF_MOD(\"mmcif0\",\t\t 315,\tR8A7743_CLK_MMC0),\n\tDEF_MOD(\"iic0\",\t\t\t 318,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"pciec\",\t\t 319,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"iic1\",\t\t\t 323,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"usb3.0\",\t\t 328,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"cmt1\",\t\t\t 329,\tR8A7743_CLK_R),\n\tDEF_MOD(\"usbhs-dmac0\",\t\t 330,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"usbhs-dmac1\",\t\t 331,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"rwdt\",\t\t\t 402,\tR8A7743_CLK_R),\n\tDEF_MOD(\"irqc\",\t\t\t 407,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"intc-sys\",\t\t 408,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"audio-dmac1\",\t\t 501,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"audio-dmac0\",\t\t 502,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"thermal\",\t\t 522,\tCLK_EXTAL),\n\tDEF_MOD(\"pwm\",\t\t\t 523,\tR8A7743_CLK_P),\n\tDEF_MOD(\"usb-ehci\",\t\t 703,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"usbhs\",\t\t 704,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"hscif2\",\t\t 713,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"scif5\",\t\t 714,\tR8A7743_CLK_P),\n\tDEF_MOD(\"scif4\",\t\t 715,\tR8A7743_CLK_P),\n\tDEF_MOD(\"hscif1\",\t\t 716,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"hscif0\",\t\t 717,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"scif3\",\t\t 718,\tR8A7743_CLK_P),\n\tDEF_MOD(\"scif2\",\t\t 719,\tR8A7743_CLK_P),\n\tDEF_MOD(\"scif1\",\t\t 720,\tR8A7743_CLK_P),\n\tDEF_MOD(\"scif0\",\t\t 721,\tR8A7743_CLK_P),\n\tDEF_MOD(\"du1\",\t\t\t 723,\tR8A7743_CLK_ZX),\n\tDEF_MOD(\"du0\",\t\t\t 724,\tR8A7743_CLK_ZX),\n\tDEF_MOD(\"lvds0\",\t\t 726,\tR8A7743_CLK_ZX),\n\tDEF_MOD(\"ipmmu-sgx\",\t\t 800,\tR8A7743_CLK_ZX),\n\tDEF_MOD(\"vin2\",\t\t\t 809,\tR8A7743_CLK_ZG),\n\tDEF_MOD(\"vin1\",\t\t\t 810,\tR8A7743_CLK_ZG),\n\tDEF_MOD(\"vin0\",\t\t\t 811,\tR8A7743_CLK_ZG),\n\tDEF_MOD(\"etheravb\",\t\t 812,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"ether\",\t\t 813,\tR8A7743_CLK_P),\n\tDEF_MOD(\"sata1\",\t\t 814,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"sata0\",\t\t 815,\tR8A7743_CLK_ZS),\n\tDEF_MOD(\"gpio7\",\t\t 904,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"gpio6\",\t\t 905,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"gpio5\",\t\t 907,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"gpio4\",\t\t 908,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"gpio3\",\t\t 909,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"gpio2\",\t\t 910,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"gpio1\",\t\t 911,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"gpio0\",\t\t 912,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"can1\",\t\t\t 915,\tR8A7743_CLK_P),\n\tDEF_MOD(\"can0\",\t\t\t 916,\tR8A7743_CLK_P),\n\tDEF_MOD(\"qspi_mod\",\t\t 917,\tR8A7743_CLK_QSPI),\n\tDEF_MOD(\"i2c5\",\t\t\t 925,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"iicdvfs\",\t\t 926,\tR8A7743_CLK_CP),\n\tDEF_MOD(\"i2c4\",\t\t\t 927,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"i2c3\",\t\t\t 928,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"i2c2\",\t\t\t 929,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"i2c1\",\t\t\t 930,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"i2c0\",\t\t\t 931,\tR8A7743_CLK_HP),\n\tDEF_MOD(\"ssi-all\",\t\t1005,\tR8A7743_CLK_P),\n\tDEF_MOD(\"ssi9\",\t\t\t1006,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi8\",\t\t\t1007,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi7\",\t\t\t1008,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi6\",\t\t\t1009,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi5\",\t\t\t1010,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi4\",\t\t\t1011,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi3\",\t\t\t1012,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi2\",\t\t\t1013,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi1\",\t\t\t1014,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"ssi0\",\t\t\t1015,\tMOD_CLK_ID(1005)),\n\tDEF_MOD(\"scu-all\",\t\t1017,\tR8A7743_CLK_P),\n\tDEF_MOD(\"scu-dvc1\",\t\t1018,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-dvc0\",\t\t1019,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-ctu1-mix1\",\t1020,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-ctu0-mix0\",\t1021,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src9\",\t\t1022,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src8\",\t\t1023,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src7\",\t\t1024,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src6\",\t\t1025,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src5\",\t\t1026,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src4\",\t\t1027,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src3\",\t\t1028,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src2\",\t\t1029,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src1\",\t\t1030,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scu-src0\",\t\t1031,\tMOD_CLK_ID(1017)),\n\tDEF_MOD(\"scifa3\",\t\t1106,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"scifa4\",\t\t1107,\tR8A7743_CLK_MP),\n\tDEF_MOD(\"scifa5\",\t\t1108,\tR8A7743_CLK_MP),\n};\n\nstatic const unsigned int r8a7743_crit_mod_clks[] __initconst = {\n\tMOD_CLK_ID(402),\t \n\tMOD_CLK_ID(408),\t \n};\n\n \n\n \n#define CPG_PLL_CONFIG_INDEX(md)\t((((md) & BIT(14)) >> 12) | \\\n\t\t\t\t\t (((md) & BIT(13)) >> 12) | \\\n\t\t\t\t\t (((md) & BIT(19)) >> 19))\n\nstatic const struct rcar_gen2_cpg_pll_config cpg_pll_configs[8] __initconst = {\n\t \n\t{ 1,\t\t208,\t\t106,\t},\n\t{ 1,\t\t208,\t\t88,\t},\n\t{ 1,\t\t156,\t\t80,\t},\n\t{ 1,\t\t156,\t\t66,\t},\n\t{ 2,\t\t240,\t\t122,\t},\n\t{ 2,\t\t240,\t\t102,\t},\n\t{ 2,\t\t208,\t\t106,\t},\n\t{ 2,\t\t208,\t\t88,\t},\n};\n\nstatic int __init r8a7743_cpg_mssr_init(struct device *dev)\n{\n\tconst struct rcar_gen2_cpg_pll_config *cpg_pll_config;\n\tstruct device_node *np = dev->of_node;\n\tunsigned int i;\n\tu32 cpg_mode;\n\tint error;\n\n\terror = rcar_rst_read_mode_pins(&cpg_mode);\n\tif (error)\n\t\treturn error;\n\n\tcpg_pll_config = &cpg_pll_configs[CPG_PLL_CONFIG_INDEX(cpg_mode)];\n\n\tif (of_device_is_compatible(np, \"renesas,r8a7744-cpg-mssr\")) {\n\t\t \n\t\tfor (i = 0; i < ARRAY_SIZE(r8a7743_core_clks); i++)\n\t\t\tif (r8a7743_core_clks[i].id == R8A7743_CLK_ZG) {\n\t\t\t\tr8a7743_core_clks[i].div = 5;\n\t\t\t\tbreak;\n\t\t\t}\n\t}\n\treturn rcar_gen2_cpg_init(cpg_pll_config, 2, cpg_mode);\n}\n\nconst struct cpg_mssr_info r8a7743_cpg_mssr_info __initconst = {\n\t \n\t.core_clks = r8a7743_core_clks,\n\t.num_core_clks = ARRAY_SIZE(r8a7743_core_clks),\n\t.last_dt_core_clk = LAST_DT_CORE_CLK,\n\t.num_total_core_clks = MOD_CLK_BASE,\n\n\t \n\t.mod_clks = r8a7743_mod_clks,\n\t.num_mod_clks = ARRAY_SIZE(r8a7743_mod_clks),\n\t.num_hw_mod_clks = 12 * 32,\n\n\t \n\t.crit_mod_clks = r8a7743_crit_mod_clks,\n\t.num_crit_mod_clks = ARRAY_SIZE(r8a7743_crit_mod_clks),\n\n\t \n\t.init = r8a7743_cpg_mssr_init,\n\t.cpg_clk_register = rcar_gen2_cpg_clk_register,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}