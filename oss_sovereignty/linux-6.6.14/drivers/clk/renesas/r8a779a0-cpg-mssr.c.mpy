{
  "module_name": "r8a779a0-cpg-mssr.c",
  "hash_id": "e3ff72aeb6068259cc5df17bb9b66c3d8a5f10d5c6741fd8d133dc5daac44b02",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/renesas/r8a779a0-cpg-mssr.c",
  "human_readable_source": "\n \n\n#include <linux/bitfield.h>\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/soc/renesas/rcar-rst.h>\n\n#include <dt-bindings/clock/r8a779a0-cpg-mssr.h>\n\n#include \"renesas-cpg-mssr.h\"\n#include \"rcar-gen4-cpg.h\"\n\nenum clk_ids {\n\t \n\tLAST_DT_CORE_CLK = R8A779A0_CLK_OSC,\n\n\t \n\tCLK_EXTAL,\n\tCLK_EXTALR,\n\n\t \n\tCLK_MAIN,\n\tCLK_PLL1,\n\tCLK_PLL20,\n\tCLK_PLL21,\n\tCLK_PLL30,\n\tCLK_PLL31,\n\tCLK_PLL5,\n\tCLK_PLL1_DIV2,\n\tCLK_PLL20_DIV2,\n\tCLK_PLL21_DIV2,\n\tCLK_PLL30_DIV2,\n\tCLK_PLL31_DIV2,\n\tCLK_PLL5_DIV2,\n\tCLK_PLL5_DIV4,\n\tCLK_S1,\n\tCLK_S3,\n\tCLK_SDSRC,\n\tCLK_RPCSRC,\n\tCLK_OCO,\n\n\t \n\tMOD_CLK_BASE\n};\n\n#define DEF_PLL(_name, _id, _offset)\t\\\n\tDEF_BASE(_name, _id, CLK_TYPE_GEN4_PLL2X_3X, CLK_MAIN, \\\n\t\t .offset = _offset)\n\nstatic const struct cpg_core_clk r8a779a0_core_clks[] __initconst = {\n\t \n\tDEF_INPUT(\"extal\",  CLK_EXTAL),\n\tDEF_INPUT(\"extalr\", CLK_EXTALR),\n\n\t \n\tDEF_BASE(\".main\", CLK_MAIN,\tCLK_TYPE_GEN4_MAIN, CLK_EXTAL),\n\tDEF_BASE(\".pll1\", CLK_PLL1,\tCLK_TYPE_GEN4_PLL1, CLK_MAIN),\n\tDEF_BASE(\".pll5\", CLK_PLL5,\tCLK_TYPE_GEN4_PLL5, CLK_MAIN),\n\tDEF_PLL(\".pll20\", CLK_PLL20,\t0x0834),\n\tDEF_PLL(\".pll21\", CLK_PLL21,\t0x0838),\n\tDEF_PLL(\".pll30\", CLK_PLL30,\t0x083c),\n\tDEF_PLL(\".pll31\", CLK_PLL31,\t0x0840),\n\n\tDEF_FIXED(\".pll1_div2\",\t\tCLK_PLL1_DIV2,\tCLK_PLL1,\t2, 1),\n\tDEF_FIXED(\".pll20_div2\",\tCLK_PLL20_DIV2,\tCLK_PLL20,\t2, 1),\n\tDEF_FIXED(\".pll21_div2\",\tCLK_PLL21_DIV2,\tCLK_PLL21,\t2, 1),\n\tDEF_FIXED(\".pll30_div2\",\tCLK_PLL30_DIV2,\tCLK_PLL30,\t2, 1),\n\tDEF_FIXED(\".pll31_div2\",\tCLK_PLL31_DIV2,\tCLK_PLL31,\t2, 1),\n\tDEF_FIXED(\".pll5_div2\",\t\tCLK_PLL5_DIV2,\tCLK_PLL5,\t2, 1),\n\tDEF_FIXED(\".pll5_div4\",\t\tCLK_PLL5_DIV4,\tCLK_PLL5_DIV2,\t2, 1),\n\tDEF_FIXED(\".s1\",\t\tCLK_S1,\t\tCLK_PLL1_DIV2,\t2, 1),\n\tDEF_FIXED(\".s3\",\t\tCLK_S3,\t\tCLK_PLL1_DIV2,\t4, 1),\n\tDEF_FIXED(\".sdsrc\",\t\tCLK_SDSRC,\tCLK_PLL5_DIV4,\t1, 1),\n\n\tDEF_RATE(\".oco\",\t\tCLK_OCO,\t32768),\n\n\tDEF_BASE(\".rpcsrc\",\t\tCLK_RPCSRC,\tCLK_TYPE_GEN4_RPCSRC, CLK_PLL5),\n\n\t \n\tDEF_GEN4_Z(\"z0\",\tR8A779A0_CLK_Z0,\tCLK_TYPE_GEN4_Z,\tCLK_PLL20,\t2, 0),\n\tDEF_GEN4_Z(\"z1\",\tR8A779A0_CLK_Z1,\tCLK_TYPE_GEN4_Z,\tCLK_PLL21,\t2, 8),\n\tDEF_FIXED(\"zx\",\t\tR8A779A0_CLK_ZX,\tCLK_PLL20_DIV2,\t2, 1),\n\tDEF_FIXED(\"s1d1\",\tR8A779A0_CLK_S1D1,\tCLK_S1,\t\t1, 1),\n\tDEF_FIXED(\"s1d2\",\tR8A779A0_CLK_S1D2,\tCLK_S1,\t\t2, 1),\n\tDEF_FIXED(\"s1d4\",\tR8A779A0_CLK_S1D4,\tCLK_S1,\t\t4, 1),\n\tDEF_FIXED(\"s1d8\",\tR8A779A0_CLK_S1D8,\tCLK_S1,\t\t8, 1),\n\tDEF_FIXED(\"s1d12\",\tR8A779A0_CLK_S1D12,\tCLK_S1,\t\t12, 1),\n\tDEF_FIXED(\"s3d1\",\tR8A779A0_CLK_S3D1,\tCLK_S3,\t\t1, 1),\n\tDEF_FIXED(\"s3d2\",\tR8A779A0_CLK_S3D2,\tCLK_S3,\t\t2, 1),\n\tDEF_FIXED(\"s3d4\",\tR8A779A0_CLK_S3D4,\tCLK_S3,\t\t4, 1),\n\tDEF_FIXED(\"zs\",\t\tR8A779A0_CLK_ZS,\tCLK_PLL1_DIV2,\t4, 1),\n\tDEF_FIXED(\"zt\",\t\tR8A779A0_CLK_ZT,\tCLK_PLL1_DIV2,\t2, 1),\n\tDEF_FIXED(\"ztr\",\tR8A779A0_CLK_ZTR,\tCLK_PLL1_DIV2,\t2, 1),\n\tDEF_FIXED(\"zr\",\t\tR8A779A0_CLK_ZR,\tCLK_PLL1_DIV2,\t1, 1),\n\tDEF_FIXED(\"cnndsp\",\tR8A779A0_CLK_CNNDSP,\tCLK_PLL5_DIV4,\t1, 1),\n\tDEF_FIXED(\"vip\",\tR8A779A0_CLK_VIP,\tCLK_PLL5,\t5, 1),\n\tDEF_FIXED(\"adgh\",\tR8A779A0_CLK_ADGH,\tCLK_PLL5_DIV4,\t1, 1),\n\tDEF_FIXED(\"icu\",\tR8A779A0_CLK_ICU,\tCLK_PLL5_DIV4,\t2, 1),\n\tDEF_FIXED(\"icud2\",\tR8A779A0_CLK_ICUD2,\tCLK_PLL5_DIV4,\t4, 1),\n\tDEF_FIXED(\"vcbus\",\tR8A779A0_CLK_VCBUS,\tCLK_PLL5_DIV4,\t1, 1),\n\tDEF_FIXED(\"cbfusa\",\tR8A779A0_CLK_CBFUSA,\tCLK_EXTAL,\t2, 1),\n\tDEF_FIXED(\"cp\",\t\tR8A779A0_CLK_CP,\tCLK_EXTAL,\t2, 1),\n\tDEF_FIXED(\"cl16mck\",\tR8A779A0_CLK_CL16MCK,\tCLK_PLL1_DIV2,\t64, 1),\n\n\tDEF_GEN4_SDH(\"sd0h\",\tR8A779A0_CLK_SD0H,\tCLK_SDSRC,\t   0x870),\n\tDEF_GEN4_SD(\"sd0\",\tR8A779A0_CLK_SD0,\tR8A779A0_CLK_SD0H, 0x870),\n\n\tDEF_BASE(\"rpc\",\t\tR8A779A0_CLK_RPC, CLK_TYPE_GEN4_RPC, CLK_RPCSRC),\n\tDEF_BASE(\"rpcd2\",\tR8A779A0_CLK_RPCD2, CLK_TYPE_GEN4_RPCD2,\n\t\t R8A779A0_CLK_RPC),\n\n\tDEF_DIV6P1(\"mso\",\tR8A779A0_CLK_MSO,\tCLK_PLL5_DIV4,\t0x87c),\n\tDEF_DIV6P1(\"canfd\",\tR8A779A0_CLK_CANFD,\tCLK_PLL5_DIV4,\t0x878),\n\tDEF_DIV6P1(\"csi0\",\tR8A779A0_CLK_CSI0,\tCLK_PLL5_DIV4,\t0x880),\n\tDEF_DIV6P1(\"dsi\",\tR8A779A0_CLK_DSI,\tCLK_PLL5_DIV4,\t0x884),\n\n\tDEF_GEN4_OSC(\"osc\",\tR8A779A0_CLK_OSC,\tCLK_EXTAL,\t8),\n\tDEF_GEN4_MDSEL(\"r\",\tR8A779A0_CLK_R, 29, CLK_EXTALR, 1, CLK_OCO, 1),\n};\n\nstatic const struct mssr_mod_clk r8a779a0_mod_clks[] __initconst = {\n\tDEF_MOD(\"avb0\",\t\t211,\tR8A779A0_CLK_S3D2),\n\tDEF_MOD(\"avb1\",\t\t212,\tR8A779A0_CLK_S3D2),\n\tDEF_MOD(\"avb2\",\t\t213,\tR8A779A0_CLK_S3D2),\n\tDEF_MOD(\"avb3\",\t\t214,\tR8A779A0_CLK_S3D2),\n\tDEF_MOD(\"avb4\",\t\t215,\tR8A779A0_CLK_S3D2),\n\tDEF_MOD(\"avb5\",\t\t216,\tR8A779A0_CLK_S3D2),\n\tDEF_MOD(\"canfd0\",\t328,\tR8A779A0_CLK_CANFD),\n\tDEF_MOD(\"csi40\",\t331,\tR8A779A0_CLK_CSI0),\n\tDEF_MOD(\"csi41\",\t400,\tR8A779A0_CLK_CSI0),\n\tDEF_MOD(\"csi42\",\t401,\tR8A779A0_CLK_CSI0),\n\tDEF_MOD(\"csi43\",\t402,\tR8A779A0_CLK_CSI0),\n\tDEF_MOD(\"du\",\t\t411,\tR8A779A0_CLK_S3D1),\n\tDEF_MOD(\"dsi0\",\t\t415,\tR8A779A0_CLK_DSI),\n\tDEF_MOD(\"dsi1\",\t\t416,\tR8A779A0_CLK_DSI),\n\tDEF_MOD(\"fcpvd0\",\t508,\tR8A779A0_CLK_S3D1),\n\tDEF_MOD(\"fcpvd1\",\t509,\tR8A779A0_CLK_S3D1),\n\tDEF_MOD(\"hscif0\",\t514,\tR8A779A0_CLK_S1D2),\n\tDEF_MOD(\"hscif1\",\t515,\tR8A779A0_CLK_S1D2),\n\tDEF_MOD(\"hscif2\",\t516,\tR8A779A0_CLK_S1D2),\n\tDEF_MOD(\"hscif3\",\t517,\tR8A779A0_CLK_S1D2),\n\tDEF_MOD(\"i2c0\",\t\t518,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"i2c1\",\t\t519,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"i2c2\",\t\t520,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"i2c3\",\t\t521,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"i2c4\",\t\t522,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"i2c5\",\t\t523,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"i2c6\",\t\t524,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"ispcs0\",\t612,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"ispcs1\",\t613,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"ispcs2\",\t614,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"ispcs3\",\t615,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"msi0\",\t\t618,\tR8A779A0_CLK_MSO),\n\tDEF_MOD(\"msi1\",\t\t619,\tR8A779A0_CLK_MSO),\n\tDEF_MOD(\"msi2\",\t\t620,\tR8A779A0_CLK_MSO),\n\tDEF_MOD(\"msi3\",\t\t621,\tR8A779A0_CLK_MSO),\n\tDEF_MOD(\"msi4\",\t\t622,\tR8A779A0_CLK_MSO),\n\tDEF_MOD(\"msi5\",\t\t623,\tR8A779A0_CLK_MSO),\n\tDEF_MOD(\"pwm0\",\t\t628,\tR8A779A0_CLK_S1D8),\n\tDEF_MOD(\"rpc-if\",\t629,\tR8A779A0_CLK_RPCD2),\n\tDEF_MOD(\"scif0\",\t702,\tR8A779A0_CLK_S1D8),\n\tDEF_MOD(\"scif1\",\t703,\tR8A779A0_CLK_S1D8),\n\tDEF_MOD(\"scif3\",\t704,\tR8A779A0_CLK_S1D8),\n\tDEF_MOD(\"scif4\",\t705,\tR8A779A0_CLK_S1D8),\n\tDEF_MOD(\"sdhi0\",\t706,\tR8A779A0_CLK_SD0),\n\tDEF_MOD(\"sys-dmac1\",\t709,\tR8A779A0_CLK_S1D2),\n\tDEF_MOD(\"sys-dmac2\",\t710,\tR8A779A0_CLK_S1D2),\n\tDEF_MOD(\"tmu0\",\t\t713,\tR8A779A0_CLK_CL16MCK),\n\tDEF_MOD(\"tmu1\",\t\t714,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"tmu2\",\t\t715,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"tmu3\",\t\t716,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"tmu4\",\t\t717,\tR8A779A0_CLK_S1D4),\n\tDEF_MOD(\"tpu0\",\t\t718,\tR8A779A0_CLK_S1D8),\n\tDEF_MOD(\"vin00\",\t730,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin01\",\t731,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin02\",\t800,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin03\",\t801,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin04\",\t802,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin05\",\t803,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin06\",\t804,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin07\",\t805,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin10\",\t806,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin11\",\t807,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin12\",\t808,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin13\",\t809,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin14\",\t810,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin15\",\t811,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin16\",\t812,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin17\",\t813,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin20\",\t814,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin21\",\t815,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin22\",\t816,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin23\",\t817,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin24\",\t818,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin25\",\t819,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin26\",\t820,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin27\",\t821,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin30\",\t822,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin31\",\t823,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin32\",\t824,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin33\",\t825,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin34\",\t826,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin35\",\t827,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin36\",\t828,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vin37\",\t829,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vspd0\",\t830,\tR8A779A0_CLK_S3D1),\n\tDEF_MOD(\"vspd1\",\t831,\tR8A779A0_CLK_S3D1),\n\tDEF_MOD(\"rwdt\",\t\t907,\tR8A779A0_CLK_R),\n\tDEF_MOD(\"cmt0\",\t\t910,\tR8A779A0_CLK_R),\n\tDEF_MOD(\"cmt1\",\t\t911,\tR8A779A0_CLK_R),\n\tDEF_MOD(\"cmt2\",\t\t912,\tR8A779A0_CLK_R),\n\tDEF_MOD(\"cmt3\",\t\t913,\tR8A779A0_CLK_R),\n\tDEF_MOD(\"pfc0\",\t\t915,\tR8A779A0_CLK_CP),\n\tDEF_MOD(\"pfc1\",\t\t916,\tR8A779A0_CLK_CP),\n\tDEF_MOD(\"pfc2\",\t\t917,\tR8A779A0_CLK_CP),\n\tDEF_MOD(\"pfc3\",\t\t918,\tR8A779A0_CLK_CP),\n\tDEF_MOD(\"tsc\",\t\t919,\tR8A779A0_CLK_CL16MCK),\n\tDEF_MOD(\"vspx0\",\t1028,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vspx1\",\t1029,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vspx2\",\t1030,\tR8A779A0_CLK_S1D1),\n\tDEF_MOD(\"vspx3\",\t1031,\tR8A779A0_CLK_S1D1),\n};\n\nstatic const unsigned int r8a779a0_crit_mod_clks[] __initconst = {\n\tMOD_CLK_ID(907),\t \n};\n\n \n \n#define CPG_PLL_CONFIG_INDEX(md)\t((((md) & BIT(14)) >> 13) | \\\n\t\t\t\t\t (((md) & BIT(13)) >> 13))\nstatic const struct rcar_gen4_cpg_pll_config cpg_pll_configs[4] = {\n\t \n\t{ 1,\t\t128,\t1,\t0,\t0,\t0,\t0,\t144,\t1,\t192,\t1,\t0,\t0,\t16,\t},\n\t{ 1,\t\t106,\t1,\t0,\t0,\t0,\t0,\t120,\t1,\t160,\t1,\t0,\t0,\t19,\t},\n\t{ 0,\t\t0,\t0,\t0,\t0,\t0,\t0,\t0,\t0,\t0,\t0,\t0,\t0,\t0,\t},\n\t{ 2,\t\t128,\t1,\t0,\t0,\t0,\t0,\t144,\t1,\t192,\t1,\t0,\t0,\t32,\t},\n};\n\n\nstatic int __init r8a779a0_cpg_mssr_init(struct device *dev)\n{\n\tconst struct rcar_gen4_cpg_pll_config *cpg_pll_config;\n\tu32 cpg_mode;\n\tint error;\n\n\terror = rcar_rst_read_mode_pins(&cpg_mode);\n\tif (error)\n\t\treturn error;\n\n\tcpg_pll_config = &cpg_pll_configs[CPG_PLL_CONFIG_INDEX(cpg_mode)];\n\n\treturn rcar_gen4_cpg_init(cpg_pll_config, CLK_EXTALR, cpg_mode);\n}\n\nconst struct cpg_mssr_info r8a779a0_cpg_mssr_info __initconst = {\n\t \n\t.core_clks = r8a779a0_core_clks,\n\t.num_core_clks = ARRAY_SIZE(r8a779a0_core_clks),\n\t.last_dt_core_clk = LAST_DT_CORE_CLK,\n\t.num_total_core_clks = MOD_CLK_BASE,\n\n\t \n\t.mod_clks = r8a779a0_mod_clks,\n\t.num_mod_clks = ARRAY_SIZE(r8a779a0_mod_clks),\n\t.num_hw_mod_clks = 15 * 32,\n\n\t \n\t.crit_mod_clks\t\t= r8a779a0_crit_mod_clks,\n\t.num_crit_mod_clks\t= ARRAY_SIZE(r8a779a0_crit_mod_clks),\n\n\t \n\t.init = r8a779a0_cpg_mssr_init,\n\t.cpg_clk_register = rcar_gen4_cpg_clk_register,\n\n\t.reg_layout = CLK_REG_LAYOUT_RCAR_GEN4,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}