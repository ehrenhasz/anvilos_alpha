{
  "module_name": "clk-fixed-mmio.c",
  "hash_id": "ba4ad146e56909c1d3d736f8ccf146b9fd152fa7130ddb032bff9cf65e240787",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/clk-fixed-mmio.c",
  "human_readable_source": "\n\n \n\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n\nstatic struct clk_hw *fixed_mmio_clk_setup(struct device_node *node)\n{\n\tstruct clk_hw *clk;\n\tconst char *clk_name = node->name;\n\tvoid __iomem *base;\n\tu32 freq;\n\tint ret;\n\n\tbase = of_iomap(node, 0);\n\tif (!base) {\n\t\tpr_err(\"%pOFn: failed to map address\\n\", node);\n\t\treturn ERR_PTR(-EIO);\n\t}\n\n\tfreq = readl(base);\n\tiounmap(base);\n\tof_property_read_string(node, \"clock-output-names\", &clk_name);\n\n\tclk = clk_hw_register_fixed_rate(NULL, clk_name, NULL, 0, freq);\n\tif (IS_ERR(clk)) {\n\t\tpr_err(\"%pOFn: failed to register fixed rate clock\\n\", node);\n\t\treturn clk;\n\t}\n\n\tret = of_clk_add_hw_provider(node, of_clk_hw_simple_get, clk);\n\tif (ret) {\n\t\tpr_err(\"%pOFn: failed to add clock provider\\n\", node);\n\t\tclk_hw_unregister(clk);\n\t\tclk = ERR_PTR(ret);\n\t}\n\n\treturn clk;\n}\n\nstatic void __init of_fixed_mmio_clk_setup(struct device_node *node)\n{\n\tfixed_mmio_clk_setup(node);\n}\nCLK_OF_DECLARE(fixed_mmio_clk, \"fixed-mmio-clock\", of_fixed_mmio_clk_setup);\n\n \nstatic int of_fixed_mmio_clk_probe(struct platform_device *pdev)\n{\n\tstruct clk_hw *clk;\n\n\tclk = fixed_mmio_clk_setup(pdev->dev.of_node);\n\tif (IS_ERR(clk))\n\t\treturn PTR_ERR(clk);\n\n\tplatform_set_drvdata(pdev, clk);\n\n\treturn 0;\n}\n\nstatic void of_fixed_mmio_clk_remove(struct platform_device *pdev)\n{\n\tstruct clk_hw *clk = platform_get_drvdata(pdev);\n\n\tof_clk_del_provider(pdev->dev.of_node);\n\tclk_hw_unregister_fixed_rate(clk);\n}\n\nstatic const struct of_device_id of_fixed_mmio_clk_ids[] = {\n\t{ .compatible = \"fixed-mmio-clock\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, of_fixed_mmio_clk_ids);\n\nstatic struct platform_driver of_fixed_mmio_clk_driver = {\n\t.driver = {\n\t\t.name = \"of_fixed_mmio_clk\",\n\t\t.of_match_table = of_fixed_mmio_clk_ids,\n\t},\n\t.probe = of_fixed_mmio_clk_probe,\n\t.remove_new = of_fixed_mmio_clk_remove,\n};\nmodule_platform_driver(of_fixed_mmio_clk_driver);\n\nMODULE_AUTHOR(\"Jan Kotas <jank@cadence.com>\");\nMODULE_DESCRIPTION(\"Memory Mapped IO Fixed clock driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}