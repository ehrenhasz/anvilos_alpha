{
  "module_name": "clkc-tmpv770x.c",
  "hash_id": "cf9ca92c6f792f7c9d86fae1e0c9ef68b232850c68be4546605cd2ad6fa3df23",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/visconti/clkc-tmpv770x.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/platform_device.h>\n\n#include <dt-bindings/clock/toshiba,tmpv770x.h>\n#include <dt-bindings/reset/toshiba,tmpv770x.h>\n\n#include \"clkc.h\"\n#include \"reset.h\"\n\nstatic DEFINE_SPINLOCK(tmpv770x_clk_lock);\nstatic DEFINE_SPINLOCK(tmpv770x_rst_lock);\n\nstatic const struct clk_parent_data clks_parent_data[] = {\n\t{ .fw_name = \"pipll1\", .name = \"pipll1\", },\n};\n\nstatic const struct clk_parent_data pietherplls_parent_data[] = {\n\t{ .fw_name = \"pietherpll\", .name = \"pietherpll\", },\n};\n\nstatic const struct visconti_fixed_clk fixed_clk_tables[] = {\n\t \n\t \n\t \n\t{ TMPV770X_CLK_PIPLL1_DIV4, \"pipll1_div4\", \"pipll1\", 0, 1, 4, },\n\t \n\t{ TMPV770X_CLK_PIPLL1_DIV2, \"pipll1_div2\", \"pipll1\", 0, 1, 2, },\n\t \n\t{ TMPV770X_CLK_PIPLL1_DIV1, \"pipll1_div1\", \"pipll1\", 0, 1, 1, },\n\t \n\t \n\t{ TMPV770X_CLK_PIDNNPLL_DIV1, \"pidnnpll_div1\", \"pidnnpll\", 0, 1, 1, },\n\t{ TMPV770X_CLK_PIREFCLK, \"pirefclk\", \"osc2-clk\", 0, 1, 1, },\n\t{ TMPV770X_CLK_WDTCLK, \"wdtclk\", \"osc2-clk\", 0, 1, 1, },\n};\n\nstatic const struct visconti_clk_gate_table pietherpll_clk_gate_tables[] = {\n\t \n\t{ TMPV770X_CLK_PIETHER_2P5M, \"piether_2p5m\",\n\t\tpietherplls_parent_data, ARRAY_SIZE(pietherplls_parent_data),\n\t\tCLK_SET_RATE_PARENT, 0x34, 0x134, 4, 200,\n\t\tTMPV770X_RESET_PIETHER_2P5M, },\n\t{ TMPV770X_CLK_PIETHER_25M, \"piether_25m\",\n\t\tpietherplls_parent_data, ARRAY_SIZE(pietherplls_parent_data),\n\t\tCLK_SET_RATE_PARENT, 0x34, 0x134, 5, 20,\n\t\tTMPV770X_RESET_PIETHER_25M, },\n\t{ TMPV770X_CLK_PIETHER_50M, \"piether_50m\",\n\t\tpietherplls_parent_data, ARRAY_SIZE(pietherplls_parent_data),\n\t\tCLK_SET_RATE_PARENT, 0x34, 0x134, 6, 10,\n\t\tTMPV770X_RESET_PIETHER_50M, },\n\t{ TMPV770X_CLK_PIETHER_125M, \"piether_125m\",\n\t\tpietherplls_parent_data, ARRAY_SIZE(pietherplls_parent_data),\n\t\tCLK_SET_RATE_PARENT, 0x34, 0x134, 7, 4,\n\t\tTMPV770X_RESET_PIETHER_125M, },\n};\n\nstatic const struct visconti_clk_gate_table clk_gate_tables[] = {\n\t{ TMPV770X_CLK_HOX, \"hox\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\tCLK_SET_RATE_PARENT | CLK_IGNORE_UNUSED, 0x4c, 0x14c, 0, 1,\n\t\tTMPV770X_RESET_HOX, },\n\t{ TMPV770X_CLK_PCIE_MSTR, \"pcie_mstr\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\tCLK_SET_RATE_PARENT | CLK_IGNORE_UNUSED, 0x38, 0x138, 0, 1,\n\t\tTMPV770X_RESET_PCIE_MSTR, },\n\t{ TMPV770X_CLK_PCIE_AUX, \"pcie_aux\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\tCLK_SET_RATE_PARENT | CLK_IGNORE_UNUSED, 0x38, 0x138, 1, 24,\n\t\tTMPV770X_RESET_PCIE_AUX, },\n\t{ TMPV770X_CLK_PIINTC, \"piintc\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\tCLK_IGNORE_UNUSED, 0x8, 0x108, 0, 2, \n\t\tTMPV770X_RESET_PIINTC,},\n\t{ TMPV770X_CLK_PIETHER_BUS, \"piether_bus\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x34, 0x134, 0, 2,\n\t\tTMPV770X_RESET_PIETHER_BUS, },  \n\t{ TMPV770X_CLK_PISPI0, \"pispi0\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x28, 0x128, 0, 2,\n\t\tTMPV770X_RESET_PISPI0, },\n\t{ TMPV770X_CLK_PISPI1, \"pispi1\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x28, 0x128, 1, 2,\n\t\tTMPV770X_RESET_PISPI1, },\n\t{ TMPV770X_CLK_PISPI2, \"pispi2\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x28, 0x128, 2, 2,\n\t\tTMPV770X_RESET_PISPI2, },\n\t{ TMPV770X_CLK_PISPI3, \"pispi3\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x28, 0x128, 3, 2,\n\t\tTMPV770X_RESET_PISPI3,},\n\t{ TMPV770X_CLK_PISPI4, \"pispi4\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x28, 0x128, 4, 2,\n\t\tTMPV770X_RESET_PISPI4, },\n\t{ TMPV770X_CLK_PISPI5, \"pispi5\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x28, 0x128, 5, 2,\n\t\tTMPV770X_RESET_PISPI5},\n\t{ TMPV770X_CLK_PISPI6, \"pispi6\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x28, 0x128, 6, 2,\n\t\tTMPV770X_RESET_PISPI6,},\n\t{ TMPV770X_CLK_PIUART0, \"piuart0\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t\n\t\t0, 0x2c, 0x12c, 0, 4,\n\t\tTMPV770X_RESET_PIUART0,},\n\t{ TMPV770X_CLK_PIUART1, \"piuart1\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t\n\t\t0, 0x2c, 0x12c, 1, 4,\n\t\tTMPV770X_RESET_PIUART1, },\n\t{ TMPV770X_CLK_PIUART2, \"piuart2\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x2c, 0x12c, 2, 4,\n\t\tTMPV770X_RESET_PIUART2, },\n\t{ TMPV770X_CLK_PIUART3, \"piuart3\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x2c, 0x12c, 3, 4,\n\t\tTMPV770X_RESET_PIUART3, },\n\t{ TMPV770X_CLK_PII2C0, \"pii2c0\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 0, 4,\n\t\tTMPV770X_RESET_PII2C0, },\n\t{ TMPV770X_CLK_PII2C1, \"pii2c1\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 1, 4,\n\t\tTMPV770X_RESET_PII2C1, },\n\t{ TMPV770X_CLK_PII2C2, \"pii2c2\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 2, 4,\n\t\tTMPV770X_RESET_PII2C2, },\n\t{ TMPV770X_CLK_PII2C3, \"pii2c3\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 3, 4,\n\t\tTMPV770X_RESET_PII2C3,},\n\t{ TMPV770X_CLK_PII2C4, \"pii2c4\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 4, 4,\n\t\tTMPV770X_RESET_PII2C4, },\n\t{ TMPV770X_CLK_PII2C5, \"pii2c5\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 5, 4,\n\t\tTMPV770X_RESET_PII2C5, },\n\t{ TMPV770X_CLK_PII2C6, \"pii2c6\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 6, 4,\n\t\tTMPV770X_RESET_PII2C6, },\n\t{ TMPV770X_CLK_PII2C7, \"pii2c7\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 7, 4,\n\t\tTMPV770X_RESET_PII2C7, },\n\t{ TMPV770X_CLK_PII2C8, \"pii2c8\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x30, 0x130, 8, 4,\n\t\tTMPV770X_RESET_PII2C8, },\n\t \n\t{ TMPV770X_CLK_PIPCMIF, \"pipcmif\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x64, 0x164, 0, 4,\n\t\tTMPV770X_RESET_PIPCMIF, },\n\t \n\t{ TMPV770X_CLK_WRCK, \"wrck\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x68, 0x168, 9, 32,\n\t\tNO_RESET, },\n\t{ TMPV770X_CLK_PICKMON, \"pickmon\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x10, 0x110, 8, 4,\n\t\tTMPV770X_RESET_PICKMON, },\n\t{ TMPV770X_CLK_SBUSCLK, \"sbusclk\",\n\t\tclks_parent_data, ARRAY_SIZE(clks_parent_data),\n\t\t0, 0x14, 0x114, 0, 4,\n\t\tTMPV770X_RESET_SBUSCLK, },\n};\n\nstatic const struct visconti_reset_data clk_reset_data[] = {\n\t[TMPV770X_RESET_PIETHER_2P5M]\t= { 0x434, 0x534, 4, },\n\t[TMPV770X_RESET_PIETHER_25M]\t= { 0x434, 0x534, 5, },\n\t[TMPV770X_RESET_PIETHER_50M]\t= { 0x434, 0x534, 6, },\n\t[TMPV770X_RESET_PIETHER_125M]\t= { 0x434, 0x534, 7, },\n\t[TMPV770X_RESET_HOX]\t\t= { 0x44c, 0x54c, 0, },\n\t[TMPV770X_RESET_PCIE_MSTR]\t= { 0x438, 0x538, 0, },\n\t[TMPV770X_RESET_PCIE_AUX]\t= { 0x438, 0x538, 1, },\n\t[TMPV770X_RESET_PIINTC]\t\t= { 0x408, 0x508, 0, },\n\t[TMPV770X_RESET_PIETHER_BUS]\t= { 0x434, 0x534, 0, },\n\t[TMPV770X_RESET_PISPI0]\t\t= { 0x428, 0x528, 0, },\n\t[TMPV770X_RESET_PISPI1]\t\t= { 0x428, 0x528, 1, },\n\t[TMPV770X_RESET_PISPI2]\t\t= { 0x428, 0x528, 2, },\n\t[TMPV770X_RESET_PISPI3]\t\t= { 0x428, 0x528, 3, },\n\t[TMPV770X_RESET_PISPI4]\t\t= { 0x428, 0x528, 4, },\n\t[TMPV770X_RESET_PISPI5]\t\t= { 0x428, 0x528, 5, },\n\t[TMPV770X_RESET_PISPI6]\t\t= { 0x428, 0x528, 6, },\n\t[TMPV770X_RESET_PIUART0]\t= { 0x42c, 0x52c, 0, },\n\t[TMPV770X_RESET_PIUART1]\t= { 0x42c, 0x52c, 1, },\n\t[TMPV770X_RESET_PIUART2]\t= { 0x42c, 0x52c, 2, },\n\t[TMPV770X_RESET_PIUART3]\t= { 0x42c, 0x52c, 3, },\n\t[TMPV770X_RESET_PII2C0]\t\t= { 0x430, 0x530, 0, },\n\t[TMPV770X_RESET_PII2C1]\t\t= { 0x430, 0x530, 1, },\n\t[TMPV770X_RESET_PII2C2]\t\t= { 0x430, 0x530, 2, },\n\t[TMPV770X_RESET_PII2C3]\t\t= { 0x430, 0x530, 3, },\n\t[TMPV770X_RESET_PII2C4]\t\t= { 0x430, 0x530, 4, },\n\t[TMPV770X_RESET_PII2C5]\t\t= { 0x430, 0x530, 5, },\n\t[TMPV770X_RESET_PII2C6]\t\t= { 0x430, 0x530, 6, },\n\t[TMPV770X_RESET_PII2C7]\t\t= { 0x430, 0x530, 7, },\n\t[TMPV770X_RESET_PII2C8]\t\t= { 0x430, 0x530, 8, },\n\t[TMPV770X_RESET_PIPCMIF]\t= { 0x464, 0x564, 0, },\n\t[TMPV770X_RESET_PICKMON]\t= { 0x410, 0x510, 8, },\n\t[TMPV770X_RESET_SBUSCLK]\t= { 0x414, 0x514, 0, },\n};\n\nstatic int visconti_clk_probe(struct platform_device *pdev)\n{\n\tstruct device_node *np = pdev->dev.of_node;\n\tstruct visconti_clk_provider *ctx;\n\tstruct device *dev = &pdev->dev;\n\tstruct regmap *regmap;\n\tint ret, i;\n\n\tregmap = syscon_node_to_regmap(np);\n\tif (IS_ERR(regmap))\n\t\treturn PTR_ERR(regmap);\n\n\tctx = visconti_init_clk(dev, regmap, TMPV770X_NR_CLK);\n\tif (IS_ERR(ctx))\n\t\treturn PTR_ERR(ctx);\n\n\tret = visconti_register_reset_controller(dev, regmap, clk_reset_data,\n\t\t\t\t\t\t TMPV770X_NR_RESET,\n\t\t\t\t\t\t &visconti_reset_ops,\n\t\t\t\t\t\t &tmpv770x_rst_lock);\n\tif (ret) {\n\t\tdev_err(dev, \"Failed to register reset controller: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tfor (i = 0; i < (ARRAY_SIZE(fixed_clk_tables)); i++)\n\t\tctx->clk_data.hws[fixed_clk_tables[i].id] =\n\t\t\tclk_hw_register_fixed_factor(NULL,\n\t\t\t\t\t\t     fixed_clk_tables[i].name,\n\t\t\t\t\t\t     fixed_clk_tables[i].parent,\n\t\t\t\t\t\t     fixed_clk_tables[i].flag,\n\t\t\t\t\t\t     fixed_clk_tables[i].mult,\n\t\t\t\t\t\t     fixed_clk_tables[i].div);\n\n\tret = visconti_clk_register_gates(ctx, clk_gate_tables,\n\t\t\t\t    ARRAY_SIZE(clk_gate_tables), clk_reset_data,\n\t\t\t\t    &tmpv770x_clk_lock);\n\tif (ret) {\n\t\tdev_err(dev, \"Failed to register main clock gate: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = visconti_clk_register_gates(ctx, pietherpll_clk_gate_tables,\n\t\t\t\t    ARRAY_SIZE(pietherpll_clk_gate_tables),\n\t\t\t\t    clk_reset_data, &tmpv770x_clk_lock);\n\tif (ret) {\n\t\tdev_err(dev, \"Failed to register pietherpll clock gate: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn of_clk_add_hw_provider(np, of_clk_hw_onecell_get, &ctx->clk_data);\n}\n\nstatic const struct of_device_id visconti_clk_ids[] = {\n\t{ .compatible = \"toshiba,tmpv7708-pismu\", },\n\t{ }\n};\n\nstatic struct platform_driver visconti_clk_driver = {\n\t.probe  = visconti_clk_probe,\n\t.driver = {\n\t\t.name   = \"visconti-clk\",\n\t\t.of_match_table = visconti_clk_ids,\n\t},\n};\n\nbuiltin_platform_driver(visconti_clk_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}