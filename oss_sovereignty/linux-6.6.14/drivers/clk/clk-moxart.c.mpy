{
  "module_name": "clk-moxart.c",
  "hash_id": "96f6b51990517fa16b95eb3963e58cefd923b2dc4e62154161a7bb2c159a7827",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/clk-moxart.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of_address.h>\n#include <linux/clkdev.h>\n\nstatic void __init moxart_of_pll_clk_init(struct device_node *node)\n{\n\tvoid __iomem *base;\n\tstruct clk_hw *hw;\n\tstruct clk *ref_clk;\n\tunsigned int mul;\n\tconst char *name = node->name;\n\tconst char *parent_name;\n\n\tof_property_read_string(node, \"clock-output-names\", &name);\n\tparent_name = of_clk_get_parent_name(node, 0);\n\n\tbase = of_iomap(node, 0);\n\tif (!base) {\n\t\tpr_err(\"%pOF: of_iomap failed\\n\", node);\n\t\treturn;\n\t}\n\n\tmul = readl(base + 0x30) >> 3 & 0x3f;\n\tiounmap(base);\n\n\tref_clk = of_clk_get(node, 0);\n\tif (IS_ERR(ref_clk)) {\n\t\tpr_err(\"%pOF: of_clk_get failed\\n\", node);\n\t\treturn;\n\t}\n\n\thw = clk_hw_register_fixed_factor(NULL, name, parent_name, 0, mul, 1);\n\tif (IS_ERR(hw)) {\n\t\tpr_err(\"%pOF: failed to register clock\\n\", node);\n\t\treturn;\n\t}\n\n\tclk_hw_register_clkdev(hw, NULL, name);\n\tof_clk_add_hw_provider(node, of_clk_hw_simple_get, hw);\n}\nCLK_OF_DECLARE(moxart_pll_clock, \"moxa,moxart-pll-clock\",\n\t       moxart_of_pll_clk_init);\n\nstatic void __init moxart_of_apb_clk_init(struct device_node *node)\n{\n\tvoid __iomem *base;\n\tstruct clk_hw *hw;\n\tstruct clk *pll_clk;\n\tunsigned int div, val;\n\tunsigned int div_idx[] = { 2, 3, 4, 6, 8};\n\tconst char *name = node->name;\n\tconst char *parent_name;\n\n\tof_property_read_string(node, \"clock-output-names\", &name);\n\tparent_name = of_clk_get_parent_name(node, 0);\n\n\tbase = of_iomap(node, 0);\n\tif (!base) {\n\t\tpr_err(\"%pOF: of_iomap failed\\n\", node);\n\t\treturn;\n\t}\n\n\tval = readl(base + 0xc) >> 4 & 0x7;\n\tiounmap(base);\n\n\tif (val > 4)\n\t\tval = 0;\n\tdiv = div_idx[val] * 2;\n\n\tpll_clk = of_clk_get(node, 0);\n\tif (IS_ERR(pll_clk)) {\n\t\tpr_err(\"%pOF: of_clk_get failed\\n\", node);\n\t\treturn;\n\t}\n\n\thw = clk_hw_register_fixed_factor(NULL, name, parent_name, 0, 1, div);\n\tif (IS_ERR(hw)) {\n\t\tpr_err(\"%pOF: failed to register clock\\n\", node);\n\t\treturn;\n\t}\n\n\tclk_hw_register_clkdev(hw, NULL, name);\n\tof_clk_add_hw_provider(node, of_clk_hw_simple_get, hw);\n}\nCLK_OF_DECLARE(moxart_apb_clock, \"moxa,moxart-apb-clock\",\n\t       moxart_of_apb_clk_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}