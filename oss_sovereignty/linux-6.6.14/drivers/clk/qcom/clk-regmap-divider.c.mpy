{
  "module_name": "clk-regmap-divider.c",
  "hash_id": "9425f15cb31ebd4726649fd2be421914a8788e979a0a47d46a36e052777c2666",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/qcom/clk-regmap-divider.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/bitops.h>\n#include <linux/regmap.h>\n#include <linux/export.h>\n\n#include \"clk-regmap-divider.h\"\n\nstatic inline struct clk_regmap_div *to_clk_regmap_div(struct clk_hw *hw)\n{\n\treturn container_of(to_clk_regmap(hw), struct clk_regmap_div, clkr);\n}\n\nstatic long div_round_ro_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t      unsigned long *prate)\n{\n\tstruct clk_regmap_div *divider = to_clk_regmap_div(hw);\n\tstruct clk_regmap *clkr = &divider->clkr;\n\tu32 val;\n\n\tregmap_read(clkr->regmap, divider->reg, &val);\n\tval >>= divider->shift;\n\tval &= BIT(divider->width) - 1;\n\n\treturn divider_ro_round_rate(hw, rate, prate, NULL, divider->width,\n\t\t\t\t     CLK_DIVIDER_ROUND_CLOSEST, val);\n}\n\nstatic long div_round_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t   unsigned long *prate)\n{\n\tstruct clk_regmap_div *divider = to_clk_regmap_div(hw);\n\n\treturn divider_round_rate(hw, rate, prate, NULL, divider->width,\n\t\t\t\t  CLK_DIVIDER_ROUND_CLOSEST);\n}\n\nstatic int div_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\tunsigned long parent_rate)\n{\n\tstruct clk_regmap_div *divider = to_clk_regmap_div(hw);\n\tstruct clk_regmap *clkr = &divider->clkr;\n\tu32 div;\n\n\tdiv = divider_get_val(rate, parent_rate, NULL, divider->width,\n\t\t\t      CLK_DIVIDER_ROUND_CLOSEST);\n\n\treturn regmap_update_bits(clkr->regmap, divider->reg,\n\t\t\t\t  (BIT(divider->width) - 1) << divider->shift,\n\t\t\t\t  div << divider->shift);\n}\n\nstatic unsigned long div_recalc_rate(struct clk_hw *hw,\n\t\t\t\t     unsigned long parent_rate)\n{\n\tstruct clk_regmap_div *divider = to_clk_regmap_div(hw);\n\tstruct clk_regmap *clkr = &divider->clkr;\n\tu32 div;\n\n\tregmap_read(clkr->regmap, divider->reg, &div);\n\tdiv >>= divider->shift;\n\tdiv &= BIT(divider->width) - 1;\n\n\treturn divider_recalc_rate(hw, parent_rate, div, NULL,\n\t\t\t\t   CLK_DIVIDER_ROUND_CLOSEST, divider->width);\n}\n\nconst struct clk_ops clk_regmap_div_ops = {\n\t.round_rate = div_round_rate,\n\t.set_rate = div_set_rate,\n\t.recalc_rate = div_recalc_rate,\n};\nEXPORT_SYMBOL_GPL(clk_regmap_div_ops);\n\nconst struct clk_ops clk_regmap_div_ro_ops = {\n\t.round_rate = div_round_ro_rate,\n\t.recalc_rate = div_recalc_rate,\n};\nEXPORT_SYMBOL_GPL(clk_regmap_div_ro_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}