{
  "module_name": "clk-regmap-phy-mux.c",
  "hash_id": "c85716c40a017a37e56cf6b740ba51737dd7ac650f4279e0906b50efd466aab6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/qcom/clk-regmap-phy-mux.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/bitfield.h>\n#include <linux/regmap.h>\n#include <linux/export.h>\n\n#include \"clk-regmap.h\"\n#include \"clk-regmap-phy-mux.h\"\n\n#define PHY_MUX_MASK\t\tGENMASK(1, 0)\n#define PHY_MUX_PHY_SRC\t\t0\n#define PHY_MUX_REF_SRC\t\t2\n\nstatic inline struct clk_regmap_phy_mux *to_clk_regmap_phy_mux(struct clk_regmap *clkr)\n{\n\treturn container_of(clkr, struct clk_regmap_phy_mux, clkr);\n}\n\nstatic int phy_mux_is_enabled(struct clk_hw *hw)\n{\n\tstruct clk_regmap *clkr = to_clk_regmap(hw);\n\tstruct clk_regmap_phy_mux *phy_mux = to_clk_regmap_phy_mux(clkr);\n\tunsigned int val;\n\n\tregmap_read(clkr->regmap, phy_mux->reg, &val);\n\tval = FIELD_GET(PHY_MUX_MASK, val);\n\n\tWARN_ON(val != PHY_MUX_PHY_SRC && val != PHY_MUX_REF_SRC);\n\n\treturn val == PHY_MUX_PHY_SRC;\n}\n\nstatic int phy_mux_enable(struct clk_hw *hw)\n{\n\tstruct clk_regmap *clkr = to_clk_regmap(hw);\n\tstruct clk_regmap_phy_mux *phy_mux = to_clk_regmap_phy_mux(clkr);\n\n\treturn regmap_update_bits(clkr->regmap, phy_mux->reg,\n\t\t\t\t  PHY_MUX_MASK,\n\t\t\t\t  FIELD_PREP(PHY_MUX_MASK, PHY_MUX_PHY_SRC));\n}\n\nstatic void phy_mux_disable(struct clk_hw *hw)\n{\n\tstruct clk_regmap *clkr = to_clk_regmap(hw);\n\tstruct clk_regmap_phy_mux *phy_mux = to_clk_regmap_phy_mux(clkr);\n\n\tregmap_update_bits(clkr->regmap, phy_mux->reg,\n\t\t\t   PHY_MUX_MASK,\n\t\t\t   FIELD_PREP(PHY_MUX_MASK, PHY_MUX_REF_SRC));\n}\n\nconst struct clk_ops clk_regmap_phy_mux_ops = {\n\t.enable = phy_mux_enable,\n\t.disable = phy_mux_disable,\n\t.is_enabled = phy_mux_is_enabled,\n};\nEXPORT_SYMBOL_GPL(clk_regmap_phy_mux_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}