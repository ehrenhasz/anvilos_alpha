{
  "module_name": "clk-regmap-mux.c",
  "hash_id": "859df960c96dba05b77c77a45d8291b37a9667ae7077f57ee9d17b37812fcb81",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/qcom/clk-regmap-mux.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/bitops.h>\n#include <linux/regmap.h>\n#include <linux/export.h>\n\n#include \"clk-regmap-mux.h\"\n\nstatic inline struct clk_regmap_mux *to_clk_regmap_mux(struct clk_hw *hw)\n{\n\treturn container_of(to_clk_regmap(hw), struct clk_regmap_mux, clkr);\n}\n\nstatic u8 mux_get_parent(struct clk_hw *hw)\n{\n\tstruct clk_regmap_mux *mux = to_clk_regmap_mux(hw);\n\tstruct clk_regmap *clkr = to_clk_regmap(hw);\n\tunsigned int mask = GENMASK(mux->width - 1, 0);\n\tunsigned int val;\n\n\tregmap_read(clkr->regmap, mux->reg, &val);\n\n\tval >>= mux->shift;\n\tval &= mask;\n\n\tif (mux->parent_map)\n\t\treturn qcom_find_cfg_index(hw, mux->parent_map, val);\n\n\treturn val;\n}\n\nstatic int mux_set_parent(struct clk_hw *hw, u8 index)\n{\n\tstruct clk_regmap_mux *mux = to_clk_regmap_mux(hw);\n\tstruct clk_regmap *clkr = to_clk_regmap(hw);\n\tunsigned int mask = GENMASK(mux->width + mux->shift - 1, mux->shift);\n\tunsigned int val;\n\n\tif (mux->parent_map)\n\t\tindex = mux->parent_map[index].cfg;\n\n\tval = index;\n\tval <<= mux->shift;\n\n\treturn regmap_update_bits(clkr->regmap, mux->reg, mask, val);\n}\n\nconst struct clk_ops clk_regmap_mux_closest_ops = {\n\t.get_parent = mux_get_parent,\n\t.set_parent = mux_set_parent,\n\t.determine_rate = __clk_mux_determine_rate_closest,\n};\nEXPORT_SYMBOL_GPL(clk_regmap_mux_closest_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}