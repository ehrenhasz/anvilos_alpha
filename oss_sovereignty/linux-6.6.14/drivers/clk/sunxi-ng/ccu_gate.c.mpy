{
  "module_name": "ccu_gate.c",
  "hash_id": "5cf587c8e87fd8c2989438eec5d7c151cd344147f595d7ee85ece43a787ed3e3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi-ng/ccu_gate.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n\n#include \"ccu_gate.h\"\n\nvoid ccu_gate_helper_disable(struct ccu_common *common, u32 gate)\n{\n\tunsigned long flags;\n\tu32 reg;\n\n\tif (!gate)\n\t\treturn;\n\n\tspin_lock_irqsave(common->lock, flags);\n\n\treg = readl(common->base + common->reg);\n\twritel(reg & ~gate, common->base + common->reg);\n\n\tspin_unlock_irqrestore(common->lock, flags);\n}\nEXPORT_SYMBOL_NS_GPL(ccu_gate_helper_disable, SUNXI_CCU);\n\nstatic void ccu_gate_disable(struct clk_hw *hw)\n{\n\tstruct ccu_gate *cg = hw_to_ccu_gate(hw);\n\n\treturn ccu_gate_helper_disable(&cg->common, cg->enable);\n}\n\nint ccu_gate_helper_enable(struct ccu_common *common, u32 gate)\n{\n\tunsigned long flags;\n\tu32 reg;\n\n\tif (!gate)\n\t\treturn 0;\n\n\tspin_lock_irqsave(common->lock, flags);\n\n\treg = readl(common->base + common->reg);\n\twritel(reg | gate, common->base + common->reg);\n\n\tspin_unlock_irqrestore(common->lock, flags);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_NS_GPL(ccu_gate_helper_enable, SUNXI_CCU);\n\nstatic int ccu_gate_enable(struct clk_hw *hw)\n{\n\tstruct ccu_gate *cg = hw_to_ccu_gate(hw);\n\n\treturn ccu_gate_helper_enable(&cg->common, cg->enable);\n}\n\nint ccu_gate_helper_is_enabled(struct ccu_common *common, u32 gate)\n{\n\tif (!gate)\n\t\treturn 1;\n\n\treturn readl(common->base + common->reg) & gate;\n}\nEXPORT_SYMBOL_NS_GPL(ccu_gate_helper_is_enabled, SUNXI_CCU);\n\nstatic int ccu_gate_is_enabled(struct clk_hw *hw)\n{\n\tstruct ccu_gate *cg = hw_to_ccu_gate(hw);\n\n\treturn ccu_gate_helper_is_enabled(&cg->common, cg->enable);\n}\n\nstatic unsigned long ccu_gate_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t  unsigned long parent_rate)\n{\n\tstruct ccu_gate *cg = hw_to_ccu_gate(hw);\n\tunsigned long rate = parent_rate;\n\n\tif (cg->common.features & CCU_FEATURE_ALL_PREDIV)\n\t\trate /= cg->common.prediv;\n\n\treturn rate;\n}\n\nstatic long ccu_gate_round_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\tunsigned long *prate)\n{\n\tstruct ccu_gate *cg = hw_to_ccu_gate(hw);\n\tint div = 1;\n\n\tif (cg->common.features & CCU_FEATURE_ALL_PREDIV)\n\t\tdiv = cg->common.prediv;\n\n\tif (clk_hw_get_flags(hw) & CLK_SET_RATE_PARENT) {\n\t\tunsigned long best_parent = rate;\n\n\t\tif (cg->common.features & CCU_FEATURE_ALL_PREDIV)\n\t\t\tbest_parent *= div;\n\t\t*prate = clk_hw_round_rate(clk_hw_get_parent(hw), best_parent);\n\t}\n\n\treturn *prate / div;\n}\n\nstatic int ccu_gate_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t     unsigned long parent_rate)\n{\n\t \n\n\treturn 0;\n}\n\nconst struct clk_ops ccu_gate_ops = {\n\t.disable\t= ccu_gate_disable,\n\t.enable\t\t= ccu_gate_enable,\n\t.is_enabled\t= ccu_gate_is_enabled,\n\t.round_rate\t= ccu_gate_round_rate,\n\t.set_rate\t= ccu_gate_set_rate,\n\t.recalc_rate\t= ccu_gate_recalc_rate,\n};\nEXPORT_SYMBOL_NS_GPL(ccu_gate_ops, SUNXI_CCU);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}