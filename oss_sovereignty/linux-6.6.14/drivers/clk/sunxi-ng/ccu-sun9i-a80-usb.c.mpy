{
  "module_name": "ccu-sun9i-a80-usb.c",
  "hash_id": "bb92610e8ff0db63108f91ab403496db64131372b0ff368cd4f4a872aaad062c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi-ng/ccu-sun9i-a80-usb.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include \"ccu_common.h\"\n#include \"ccu_gate.h\"\n#include \"ccu_reset.h\"\n\n#include \"ccu-sun9i-a80-usb.h\"\n\nstatic const struct clk_parent_data clk_parent_hosc[] = {\n\t{ .fw_name = \"hosc\" },\n};\n\nstatic const struct clk_parent_data clk_parent_bus[] = {\n\t{ .fw_name = \"bus\" },\n};\n\nstatic SUNXI_CCU_GATE_DATA(bus_hci0_clk, \"bus-hci0\", clk_parent_bus, 0x0, BIT(1), 0);\nstatic SUNXI_CCU_GATE_DATA(usb_ohci0_clk, \"usb-ohci0\", clk_parent_hosc, 0x0, BIT(2), 0);\nstatic SUNXI_CCU_GATE_DATA(bus_hci1_clk, \"bus-hci1\", clk_parent_bus, 0x0, BIT(3), 0);\nstatic SUNXI_CCU_GATE_DATA(bus_hci2_clk, \"bus-hci2\", clk_parent_bus, 0x0, BIT(5), 0);\nstatic SUNXI_CCU_GATE_DATA(usb_ohci2_clk, \"usb-ohci2\", clk_parent_hosc, 0x0, BIT(6), 0);\n\nstatic SUNXI_CCU_GATE_DATA(usb0_phy_clk, \"usb0-phy\", clk_parent_hosc, 0x4, BIT(1), 0);\nstatic SUNXI_CCU_GATE_DATA(usb1_hsic_clk, \"usb1-hsic\", clk_parent_hosc, 0x4, BIT(2), 0);\nstatic SUNXI_CCU_GATE_DATA(usb1_phy_clk, \"usb1-phy\", clk_parent_hosc, 0x4, BIT(3), 0);\nstatic SUNXI_CCU_GATE_DATA(usb2_hsic_clk, \"usb2-hsic\", clk_parent_hosc, 0x4, BIT(4), 0);\nstatic SUNXI_CCU_GATE_DATA(usb2_phy_clk, \"usb2-phy\", clk_parent_hosc, 0x4, BIT(5), 0);\nstatic SUNXI_CCU_GATE_DATA(usb_hsic_clk, \"usb-hsic\", clk_parent_hosc, 0x4, BIT(10), 0);\n\nstatic struct ccu_common *sun9i_a80_usb_clks[] = {\n\t&bus_hci0_clk.common,\n\t&usb_ohci0_clk.common,\n\t&bus_hci1_clk.common,\n\t&bus_hci2_clk.common,\n\t&usb_ohci2_clk.common,\n\n\t&usb0_phy_clk.common,\n\t&usb1_hsic_clk.common,\n\t&usb1_phy_clk.common,\n\t&usb2_hsic_clk.common,\n\t&usb2_phy_clk.common,\n\t&usb_hsic_clk.common,\n};\n\nstatic struct clk_hw_onecell_data sun9i_a80_usb_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_BUS_HCI0]\t= &bus_hci0_clk.common.hw,\n\t\t[CLK_USB_OHCI0]\t= &usb_ohci0_clk.common.hw,\n\t\t[CLK_BUS_HCI1]\t= &bus_hci1_clk.common.hw,\n\t\t[CLK_BUS_HCI2]\t= &bus_hci2_clk.common.hw,\n\t\t[CLK_USB_OHCI2]\t= &usb_ohci2_clk.common.hw,\n\n\t\t[CLK_USB0_PHY]\t= &usb0_phy_clk.common.hw,\n\t\t[CLK_USB1_HSIC]\t= &usb1_hsic_clk.common.hw,\n\t\t[CLK_USB1_PHY]\t= &usb1_phy_clk.common.hw,\n\t\t[CLK_USB2_HSIC]\t= &usb2_hsic_clk.common.hw,\n\t\t[CLK_USB2_PHY]\t= &usb2_phy_clk.common.hw,\n\t\t[CLK_USB_HSIC]\t= &usb_hsic_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER,\n};\n\nstatic struct ccu_reset_map sun9i_a80_usb_resets[] = {\n\t[RST_USB0_HCI]\t\t= { 0x0, BIT(17) },\n\t[RST_USB1_HCI]\t\t= { 0x0, BIT(18) },\n\t[RST_USB2_HCI]\t\t= { 0x0, BIT(19) },\n\n\t[RST_USB0_PHY]\t\t= { 0x4, BIT(17) },\n\t[RST_USB1_HSIC]\t\t= { 0x4, BIT(18) },\n\t[RST_USB1_PHY]\t\t= { 0x4, BIT(19) },\n\t[RST_USB2_HSIC]\t\t= { 0x4, BIT(20) },\n\t[RST_USB2_PHY]\t\t= { 0x4, BIT(21) },\n};\n\nstatic const struct sunxi_ccu_desc sun9i_a80_usb_clk_desc = {\n\t.ccu_clks\t= sun9i_a80_usb_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun9i_a80_usb_clks),\n\n\t.hw_clks\t= &sun9i_a80_usb_hw_clks,\n\n\t.resets\t\t= sun9i_a80_usb_resets,\n\t.num_resets\t= ARRAY_SIZE(sun9i_a80_usb_resets),\n};\n\nstatic int sun9i_a80_usb_clk_probe(struct platform_device *pdev)\n{\n\tstruct clk *bus_clk;\n\tvoid __iomem *reg;\n\tint ret;\n\n\treg = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\tbus_clk = devm_clk_get(&pdev->dev, \"bus\");\n\tif (IS_ERR(bus_clk))\n\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(bus_clk),\n\t\t\t\t     \"Couldn't get bus clk\\n\");\n\n\t \n\tret = clk_prepare_enable(bus_clk);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Couldn't enable bus clk: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = devm_sunxi_ccu_probe(&pdev->dev, reg, &sun9i_a80_usb_clk_desc);\n\tif (ret)\n\t\tgoto err_disable_clk;\n\n\treturn 0;\n\nerr_disable_clk:\n\tclk_disable_unprepare(bus_clk);\n\treturn ret;\n}\n\nstatic const struct of_device_id sun9i_a80_usb_clk_ids[] = {\n\t{ .compatible = \"allwinner,sun9i-a80-usb-clks\" },\n\t{ }\n};\n\nstatic struct platform_driver sun9i_a80_usb_clk_driver = {\n\t.probe\t= sun9i_a80_usb_clk_probe,\n\t.driver\t= {\n\t\t.name\t= \"sun9i-a80-usb-clks\",\n\t\t.of_match_table\t= sun9i_a80_usb_clk_ids,\n\t},\n};\nmodule_platform_driver(sun9i_a80_usb_clk_driver);\n\nMODULE_IMPORT_NS(SUNXI_CCU);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}