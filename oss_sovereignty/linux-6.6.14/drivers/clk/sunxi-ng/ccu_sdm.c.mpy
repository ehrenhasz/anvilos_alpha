{
  "module_name": "ccu_sdm.c",
  "hash_id": "f10a0503ca15121027903e6615e7e89036e47ae7d2f05e7fdb1f55d0c7824927",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi-ng/ccu_sdm.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/spinlock.h>\n\n#include \"ccu_sdm.h\"\n\nbool ccu_sdm_helper_is_enabled(struct ccu_common *common,\n\t\t\t       struct ccu_sdm_internal *sdm)\n{\n\tif (!(common->features & CCU_FEATURE_SIGMA_DELTA_MOD))\n\t\treturn false;\n\n\tif (sdm->enable && !(readl(common->base + common->reg) & sdm->enable))\n\t\treturn false;\n\n\treturn !!(readl(common->base + sdm->tuning_reg) & sdm->tuning_enable);\n}\nEXPORT_SYMBOL_NS_GPL(ccu_sdm_helper_is_enabled, SUNXI_CCU);\n\nvoid ccu_sdm_helper_enable(struct ccu_common *common,\n\t\t\t   struct ccu_sdm_internal *sdm,\n\t\t\t   unsigned long rate)\n{\n\tunsigned long flags;\n\tunsigned int i;\n\tu32 reg;\n\n\tif (!(common->features & CCU_FEATURE_SIGMA_DELTA_MOD))\n\t\treturn;\n\n\t \n\tfor (i = 0; i < sdm->table_size; i++)\n\t\tif (sdm->table[i].rate == rate)\n\t\t\twritel(sdm->table[i].pattern,\n\t\t\t       common->base + sdm->tuning_reg);\n\n\t \n\tspin_lock_irqsave(common->lock, flags);\n\treg = readl(common->base + sdm->tuning_reg);\n\twritel(reg | sdm->tuning_enable, common->base + sdm->tuning_reg);\n\tspin_unlock_irqrestore(common->lock, flags);\n\n\tspin_lock_irqsave(common->lock, flags);\n\treg = readl(common->base + common->reg);\n\twritel(reg | sdm->enable, common->base + common->reg);\n\tspin_unlock_irqrestore(common->lock, flags);\n}\nEXPORT_SYMBOL_NS_GPL(ccu_sdm_helper_enable, SUNXI_CCU);\n\nvoid ccu_sdm_helper_disable(struct ccu_common *common,\n\t\t\t    struct ccu_sdm_internal *sdm)\n{\n\tunsigned long flags;\n\tu32 reg;\n\n\tif (!(common->features & CCU_FEATURE_SIGMA_DELTA_MOD))\n\t\treturn;\n\n\tspin_lock_irqsave(common->lock, flags);\n\treg = readl(common->base + common->reg);\n\twritel(reg & ~sdm->enable, common->base + common->reg);\n\tspin_unlock_irqrestore(common->lock, flags);\n\n\tspin_lock_irqsave(common->lock, flags);\n\treg = readl(common->base + sdm->tuning_reg);\n\twritel(reg & ~sdm->tuning_enable, common->base + sdm->tuning_reg);\n\tspin_unlock_irqrestore(common->lock, flags);\n}\nEXPORT_SYMBOL_NS_GPL(ccu_sdm_helper_disable, SUNXI_CCU);\n\n \nbool ccu_sdm_helper_has_rate(struct ccu_common *common,\n\t\t\t     struct ccu_sdm_internal *sdm,\n\t\t\t     unsigned long rate)\n{\n\tunsigned int i;\n\n\tif (!(common->features & CCU_FEATURE_SIGMA_DELTA_MOD))\n\t\treturn false;\n\n\tfor (i = 0; i < sdm->table_size; i++)\n\t\tif (sdm->table[i].rate == rate)\n\t\t\treturn true;\n\n\treturn false;\n}\nEXPORT_SYMBOL_NS_GPL(ccu_sdm_helper_has_rate, SUNXI_CCU);\n\nunsigned long ccu_sdm_helper_read_rate(struct ccu_common *common,\n\t\t\t\t       struct ccu_sdm_internal *sdm,\n\t\t\t\t       u32 m, u32 n)\n{\n\tunsigned int i;\n\tu32 reg;\n\n\tpr_debug(\"%s: Read sigma-delta modulation setting\\n\",\n\t\t clk_hw_get_name(&common->hw));\n\n\tif (!(common->features & CCU_FEATURE_SIGMA_DELTA_MOD))\n\t\treturn 0;\n\n\tpr_debug(\"%s: clock is sigma-delta modulated\\n\",\n\t\t clk_hw_get_name(&common->hw));\n\n\treg = readl(common->base + sdm->tuning_reg);\n\n\tpr_debug(\"%s: pattern reg is 0x%x\",\n\t\t clk_hw_get_name(&common->hw), reg);\n\n\tfor (i = 0; i < sdm->table_size; i++)\n\t\tif (sdm->table[i].pattern == reg &&\n\t\t    sdm->table[i].m == m && sdm->table[i].n == n)\n\t\t\treturn sdm->table[i].rate;\n\n\t \n\treturn 0;\n}\nEXPORT_SYMBOL_NS_GPL(ccu_sdm_helper_read_rate, SUNXI_CCU);\n\nint ccu_sdm_helper_get_factors(struct ccu_common *common,\n\t\t\t       struct ccu_sdm_internal *sdm,\n\t\t\t       unsigned long rate,\n\t\t\t       unsigned long *m, unsigned long *n)\n{\n\tunsigned int i;\n\n\tif (!(common->features & CCU_FEATURE_SIGMA_DELTA_MOD))\n\t\treturn -EINVAL;\n\n\tfor (i = 0; i < sdm->table_size; i++)\n\t\tif (sdm->table[i].rate == rate) {\n\t\t\t*m = sdm->table[i].m;\n\t\t\t*n = sdm->table[i].n;\n\t\t\treturn 0;\n\t\t}\n\n\t \n\treturn -EINVAL;\n}\nEXPORT_SYMBOL_NS_GPL(ccu_sdm_helper_get_factors, SUNXI_CCU);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}