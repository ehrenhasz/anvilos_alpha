{
  "module_name": "ccu-sun8i-r.c",
  "hash_id": "b0e603f2decacd52c005557fcff85dc88ed735b21c103ff44a2a8d8026e3b40e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi-ng/ccu-sun8i-r.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n\n#include \"ccu_common.h\"\n#include \"ccu_reset.h\"\n\n#include \"ccu_div.h\"\n#include \"ccu_gate.h\"\n#include \"ccu_mp.h\"\n#include \"ccu_nm.h\"\n\n#include \"ccu-sun8i-r.h\"\n\nstatic const struct clk_parent_data ar100_parents[] = {\n\t{ .fw_name = \"losc\" },\n\t{ .fw_name = \"hosc\" },\n\t{ .fw_name = \"pll-periph\" },\n\t{ .fw_name = \"iosc\" },\n};\n\nstatic const struct ccu_mux_var_prediv ar100_predivs[] = {\n\t{ .index = 2, .shift = 8, .width = 5 },\n};\n\nstatic struct ccu_div ar100_clk = {\n\t.div\t\t= _SUNXI_CCU_DIV_FLAGS(4, 2, CLK_DIVIDER_POWER_OF_TWO),\n\n\t.mux\t\t= {\n\t\t.shift\t= 16,\n\t\t.width\t= 2,\n\n\t\t.var_predivs\t= ar100_predivs,\n\t\t.n_var_predivs\t= ARRAY_SIZE(ar100_predivs),\n\t},\n\n\t.common\t\t= {\n\t\t.reg\t\t= 0x00,\n\t\t.features\t= CCU_FEATURE_VARIABLE_PREDIV,\n\t\t.hw.init\t= CLK_HW_INIT_PARENTS_DATA(\"ar100\",\n\t\t\t\t\t\t\t   ar100_parents,\n\t\t\t\t\t\t\t   &ccu_div_ops,\n\t\t\t\t\t\t\t   0),\n\t},\n};\n\nstatic CLK_FIXED_FACTOR_HW(ahb0_clk, \"ahb0\", &ar100_clk.common.hw, 1, 1, 0);\n\nstatic SUNXI_CCU_M(apb0_clk, \"apb0\", \"ahb0\", 0x0c, 0, 2, 0);\n\n \nstatic const struct clk_hw *apb0_gate_parent[] = { &apb0_clk.common.hw };\nstatic SUNXI_CCU_GATE_HWS(apb0_pio_clk,\t\t\"apb0-pio\",\n\t\t\t  apb0_gate_parent, 0x28, BIT(0), 0);\nstatic SUNXI_CCU_GATE_HWS(apb0_ir_clk,\t\t\"apb0-ir\",\n\t\t\t  apb0_gate_parent, 0x28, BIT(1), 0);\nstatic SUNXI_CCU_GATE_HWS(apb0_timer_clk,\t\"apb0-timer\",\n\t\t\t  apb0_gate_parent, 0x28, BIT(2), 0);\nstatic SUNXI_CCU_GATE_HWS(apb0_rsb_clk,\t\t\"apb0-rsb\",\n\t\t\t  apb0_gate_parent, 0x28, BIT(3), 0);\nstatic SUNXI_CCU_GATE_HWS(apb0_uart_clk,\t\"apb0-uart\",\n\t\t\t  apb0_gate_parent, 0x28, BIT(4), 0);\nstatic SUNXI_CCU_GATE_HWS(apb0_i2c_clk,\t\t\"apb0-i2c\",\n\t\t\t  apb0_gate_parent, 0x28, BIT(6), 0);\nstatic SUNXI_CCU_GATE_HWS(apb0_twd_clk,\t\t\"apb0-twd\",\n\t\t\t  apb0_gate_parent, 0x28, BIT(7), 0);\n\nstatic const char * const r_mod0_default_parents[] = { \"osc32k\", \"osc24M\" };\nstatic SUNXI_CCU_MP_WITH_MUX_GATE(ir_clk, \"ir\",\n\t\t\t\t  r_mod0_default_parents, 0x54,\n\t\t\t\t  0, 4,\t\t \n\t\t\t\t  16, 2,\t \n\t\t\t\t  24, 2,\t \n\t\t\t\t  BIT(31),\t \n\t\t\t\t  0);\n\nstatic const struct clk_parent_data a83t_r_mod0_parents[] = {\n\t{ .fw_name = \"iosc\" },\n\t{ .fw_name = \"hosc\" },\n};\nstatic const struct ccu_mux_fixed_prediv a83t_ir_predivs[] = {\n\t{ .index = 0, .div = 16 },\n};\nstatic struct ccu_mp a83t_ir_clk = {\n\t.enable\t= BIT(31),\n\n\t.m\t= _SUNXI_CCU_DIV(0, 4),\n\t.p\t= _SUNXI_CCU_DIV(16, 2),\n\n\t.mux\t= {\n\t\t.shift\t= 24,\n\t\t.width\t= 2,\n\t\t.fixed_predivs\t= a83t_ir_predivs,\n\t\t.n_predivs\t= ARRAY_SIZE(a83t_ir_predivs),\n\t},\n\n\t.common\t\t= {\n\t\t.reg\t\t= 0x54,\n\t\t.features\t= CCU_FEATURE_VARIABLE_PREDIV,\n\t\t.hw.init\t= CLK_HW_INIT_PARENTS_DATA(\"ir\",\n\t\t\t\t\t\t\t   a83t_r_mod0_parents,\n\t\t\t\t\t\t\t   &ccu_mp_ops,\n\t\t\t\t\t\t\t   0),\n\t},\n};\n\nstatic struct ccu_common *sun8i_r_ccu_clks[] = {\n\t&ar100_clk.common,\n\t&apb0_clk.common,\n\t&apb0_pio_clk.common,\n\t&apb0_ir_clk.common,\n\t&apb0_timer_clk.common,\n\t&apb0_rsb_clk.common,\n\t&apb0_uart_clk.common,\n\t&apb0_i2c_clk.common,\n\t&apb0_twd_clk.common,\n\t&ir_clk.common,\n\t&a83t_ir_clk.common,\n};\n\nstatic struct clk_hw_onecell_data sun8i_a83t_r_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_AR100]\t\t= &ar100_clk.common.hw,\n\t\t[CLK_AHB0]\t\t= &ahb0_clk.hw,\n\t\t[CLK_APB0]\t\t= &apb0_clk.common.hw,\n\t\t[CLK_APB0_PIO]\t\t= &apb0_pio_clk.common.hw,\n\t\t[CLK_APB0_IR]\t\t= &apb0_ir_clk.common.hw,\n\t\t[CLK_APB0_TIMER]\t= &apb0_timer_clk.common.hw,\n\t\t[CLK_APB0_RSB]\t\t= &apb0_rsb_clk.common.hw,\n\t\t[CLK_APB0_UART]\t\t= &apb0_uart_clk.common.hw,\n\t\t[CLK_APB0_I2C]\t\t= &apb0_i2c_clk.common.hw,\n\t\t[CLK_APB0_TWD]\t\t= &apb0_twd_clk.common.hw,\n\t\t[CLK_IR]\t\t= &a83t_ir_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER,\n};\n\nstatic struct clk_hw_onecell_data sun8i_h3_r_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_AR100]\t\t= &ar100_clk.common.hw,\n\t\t[CLK_AHB0]\t\t= &ahb0_clk.hw,\n\t\t[CLK_APB0]\t\t= &apb0_clk.common.hw,\n\t\t[CLK_APB0_PIO]\t\t= &apb0_pio_clk.common.hw,\n\t\t[CLK_APB0_IR]\t\t= &apb0_ir_clk.common.hw,\n\t\t[CLK_APB0_TIMER]\t= &apb0_timer_clk.common.hw,\n\t\t[CLK_APB0_UART]\t\t= &apb0_uart_clk.common.hw,\n\t\t[CLK_APB0_I2C]\t\t= &apb0_i2c_clk.common.hw,\n\t\t[CLK_APB0_TWD]\t\t= &apb0_twd_clk.common.hw,\n\t\t[CLK_IR]\t\t= &ir_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER,\n};\n\nstatic struct clk_hw_onecell_data sun50i_a64_r_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_AR100]\t\t= &ar100_clk.common.hw,\n\t\t[CLK_AHB0]\t\t= &ahb0_clk.hw,\n\t\t[CLK_APB0]\t\t= &apb0_clk.common.hw,\n\t\t[CLK_APB0_PIO]\t\t= &apb0_pio_clk.common.hw,\n\t\t[CLK_APB0_IR]\t\t= &apb0_ir_clk.common.hw,\n\t\t[CLK_APB0_TIMER]\t= &apb0_timer_clk.common.hw,\n\t\t[CLK_APB0_RSB]\t\t= &apb0_rsb_clk.common.hw,\n\t\t[CLK_APB0_UART]\t\t= &apb0_uart_clk.common.hw,\n\t\t[CLK_APB0_I2C]\t\t= &apb0_i2c_clk.common.hw,\n\t\t[CLK_APB0_TWD]\t\t= &apb0_twd_clk.common.hw,\n\t\t[CLK_IR]\t\t= &ir_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER,\n};\n\nstatic struct ccu_reset_map sun8i_a83t_r_ccu_resets[] = {\n\t[RST_APB0_IR]\t\t=  { 0xb0, BIT(1) },\n\t[RST_APB0_TIMER]\t=  { 0xb0, BIT(2) },\n\t[RST_APB0_RSB]\t\t=  { 0xb0, BIT(3) },\n\t[RST_APB0_UART]\t\t=  { 0xb0, BIT(4) },\n\t[RST_APB0_I2C]\t\t=  { 0xb0, BIT(6) },\n};\n\nstatic struct ccu_reset_map sun8i_h3_r_ccu_resets[] = {\n\t[RST_APB0_IR]\t\t=  { 0xb0, BIT(1) },\n\t[RST_APB0_TIMER]\t=  { 0xb0, BIT(2) },\n\t[RST_APB0_UART]\t\t=  { 0xb0, BIT(4) },\n\t[RST_APB0_I2C]\t\t=  { 0xb0, BIT(6) },\n};\n\nstatic struct ccu_reset_map sun50i_a64_r_ccu_resets[] = {\n\t[RST_APB0_IR]\t\t=  { 0xb0, BIT(1) },\n\t[RST_APB0_TIMER]\t=  { 0xb0, BIT(2) },\n\t[RST_APB0_RSB]\t\t=  { 0xb0, BIT(3) },\n\t[RST_APB0_UART]\t\t=  { 0xb0, BIT(4) },\n\t[RST_APB0_I2C]\t\t=  { 0xb0, BIT(6) },\n};\n\nstatic const struct sunxi_ccu_desc sun8i_a83t_r_ccu_desc = {\n\t.ccu_clks\t= sun8i_r_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_r_ccu_clks),\n\n\t.hw_clks\t= &sun8i_a83t_r_hw_clks,\n\n\t.resets\t\t= sun8i_a83t_r_ccu_resets,\n\t.num_resets\t= ARRAY_SIZE(sun8i_a83t_r_ccu_resets),\n};\n\nstatic const struct sunxi_ccu_desc sun8i_h3_r_ccu_desc = {\n\t.ccu_clks\t= sun8i_r_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_r_ccu_clks),\n\n\t.hw_clks\t= &sun8i_h3_r_hw_clks,\n\n\t.resets\t\t= sun8i_h3_r_ccu_resets,\n\t.num_resets\t= ARRAY_SIZE(sun8i_h3_r_ccu_resets),\n};\n\nstatic const struct sunxi_ccu_desc sun50i_a64_r_ccu_desc = {\n\t.ccu_clks\t= sun8i_r_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_r_ccu_clks),\n\n\t.hw_clks\t= &sun50i_a64_r_hw_clks,\n\n\t.resets\t\t= sun50i_a64_r_ccu_resets,\n\t.num_resets\t= ARRAY_SIZE(sun50i_a64_r_ccu_resets),\n};\n\nstatic int sun8i_r_ccu_probe(struct platform_device *pdev)\n{\n\tconst struct sunxi_ccu_desc *desc;\n\tvoid __iomem *reg;\n\n\tdesc = of_device_get_match_data(&pdev->dev);\n\tif (!desc)\n\t\treturn -EINVAL;\n\n\treg = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\treturn devm_sunxi_ccu_probe(&pdev->dev, reg, desc);\n}\n\nstatic const struct of_device_id sun8i_r_ccu_ids[] = {\n\t{\n\t\t.compatible = \"allwinner,sun8i-a83t-r-ccu\",\n\t\t.data = &sun8i_a83t_r_ccu_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-h3-r-ccu\",\n\t\t.data = &sun8i_h3_r_ccu_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun50i-a64-r-ccu\",\n\t\t.data = &sun50i_a64_r_ccu_desc,\n\t},\n\t{ }\n};\n\nstatic struct platform_driver sun8i_r_ccu_driver = {\n\t.probe\t= sun8i_r_ccu_probe,\n\t.driver\t= {\n\t\t.name\t\t\t= \"sun8i-r-ccu\",\n\t\t.suppress_bind_attrs\t= true,\n\t\t.of_match_table\t\t= sun8i_r_ccu_ids,\n\t},\n};\nmodule_platform_driver(sun8i_r_ccu_driver);\n\nMODULE_IMPORT_NS(SUNXI_CCU);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}