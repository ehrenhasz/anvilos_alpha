{
  "module_name": "ccu-sun9i-a80-de.c",
  "hash_id": "8bd876ec7d5a8de37bc77d021d1096c72d4f1d7d55e726546041bb7168f38e87",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi-ng/ccu-sun9i-a80-de.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/reset.h>\n\n#include \"ccu_common.h\"\n#include \"ccu_div.h\"\n#include \"ccu_gate.h\"\n#include \"ccu_reset.h\"\n\n#include \"ccu-sun9i-a80-de.h\"\n\nstatic SUNXI_CCU_GATE(fe0_clk,\t\t\"fe0\",\t\t\"fe0-div\",\n\t\t      0x00, BIT(0), 0);\nstatic SUNXI_CCU_GATE(fe1_clk,\t\t\"fe1\",\t\t\"fe1-div\",\n\t\t      0x00, BIT(1), 0);\nstatic SUNXI_CCU_GATE(fe2_clk,\t\t\"fe2\",\t\t\"fe2-div\",\n\t\t      0x00, BIT(2), 0);\nstatic SUNXI_CCU_GATE(iep_deu0_clk,\t\"iep-deu0\",\t\"de\",\n\t\t      0x00, BIT(4), 0);\nstatic SUNXI_CCU_GATE(iep_deu1_clk,\t\"iep-deu1\",\t\"de\",\n\t\t      0x00, BIT(5), 0);\nstatic SUNXI_CCU_GATE(be0_clk,\t\t\"be0\",\t\t\"be0-div\",\n\t\t      0x00, BIT(8), 0);\nstatic SUNXI_CCU_GATE(be1_clk,\t\t\"be1\",\t\t\"be1-div\",\n\t\t      0x00, BIT(9), 0);\nstatic SUNXI_CCU_GATE(be2_clk,\t\t\"be2\",\t\t\"be2-div\",\n\t\t      0x00, BIT(10), 0);\nstatic SUNXI_CCU_GATE(iep_drc0_clk,\t\"iep-drc0\",\t\"de\",\n\t\t      0x00, BIT(12), 0);\nstatic SUNXI_CCU_GATE(iep_drc1_clk,\t\"iep-drc1\",\t\"de\",\n\t\t      0x00, BIT(13), 0);\nstatic SUNXI_CCU_GATE(merge_clk,\t\"merge\",\t\"de\",\n\t\t      0x00, BIT(20), 0);\n\nstatic SUNXI_CCU_GATE(dram_fe0_clk,\t\"dram-fe0\",\t\"sdram\",\n\t\t      0x04, BIT(0), 0);\nstatic SUNXI_CCU_GATE(dram_fe1_clk,\t\"dram-fe1\",\t\"sdram\",\n\t\t      0x04, BIT(1), 0);\nstatic SUNXI_CCU_GATE(dram_fe2_clk,\t\"dram-fe2\",\t\"sdram\",\n\t\t      0x04, BIT(2), 0);\nstatic SUNXI_CCU_GATE(dram_deu0_clk,\t\"dram-deu0\",\t\"sdram\",\n\t\t      0x04, BIT(4), 0);\nstatic SUNXI_CCU_GATE(dram_deu1_clk,\t\"dram-deu1\",\t\"sdram\",\n\t\t      0x04, BIT(5), 0);\nstatic SUNXI_CCU_GATE(dram_be0_clk,\t\"dram-be0\",\t\"sdram\",\n\t\t      0x04, BIT(8), 0);\nstatic SUNXI_CCU_GATE(dram_be1_clk,\t\"dram-be1\",\t\"sdram\",\n\t\t      0x04, BIT(9), 0);\nstatic SUNXI_CCU_GATE(dram_be2_clk,\t\"dram-be2\",\t\"sdram\",\n\t\t      0x04, BIT(10), 0);\nstatic SUNXI_CCU_GATE(dram_drc0_clk,\t\"dram-drc0\",\t\"sdram\",\n\t\t      0x04, BIT(12), 0);\nstatic SUNXI_CCU_GATE(dram_drc1_clk,\t\"dram-drc1\",\t\"sdram\",\n\t\t      0x04, BIT(13), 0);\n\nstatic SUNXI_CCU_GATE(bus_fe0_clk,\t\"bus-fe0\",\t\"bus-de\",\n\t\t      0x08, BIT(0), 0);\nstatic SUNXI_CCU_GATE(bus_fe1_clk,\t\"bus-fe1\",\t\"bus-de\",\n\t\t      0x08, BIT(1), 0);\nstatic SUNXI_CCU_GATE(bus_fe2_clk,\t\"bus-fe2\",\t\"bus-de\",\n\t\t      0x08, BIT(2), 0);\nstatic SUNXI_CCU_GATE(bus_deu0_clk,\t\"bus-deu0\",\t\"bus-de\",\n\t\t      0x08, BIT(4), 0);\nstatic SUNXI_CCU_GATE(bus_deu1_clk,\t\"bus-deu1\",\t\"bus-de\",\n\t\t      0x08, BIT(5), 0);\nstatic SUNXI_CCU_GATE(bus_be0_clk,\t\"bus-be0\",\t\"bus-de\",\n\t\t      0x08, BIT(8), 0);\nstatic SUNXI_CCU_GATE(bus_be1_clk,\t\"bus-be1\",\t\"bus-de\",\n\t\t      0x08, BIT(9), 0);\nstatic SUNXI_CCU_GATE(bus_be2_clk,\t\"bus-be2\",\t\"bus-de\",\n\t\t      0x08, BIT(10), 0);\nstatic SUNXI_CCU_GATE(bus_drc0_clk,\t\"bus-drc0\",\t\"bus-de\",\n\t\t      0x08, BIT(12), 0);\nstatic SUNXI_CCU_GATE(bus_drc1_clk,\t\"bus-drc1\",\t\"bus-de\",\n\t\t      0x08, BIT(13), 0);\n\nstatic SUNXI_CCU_M(fe0_div_clk, \"fe0-div\", \"de\", 0x20, 0, 4, 0);\nstatic SUNXI_CCU_M(fe1_div_clk, \"fe1-div\", \"de\", 0x20, 4, 4, 0);\nstatic SUNXI_CCU_M(fe2_div_clk, \"fe2-div\", \"de\", 0x20, 8, 4, 0);\nstatic SUNXI_CCU_M(be0_div_clk, \"be0-div\", \"de\", 0x20, 16, 4, 0);\nstatic SUNXI_CCU_M(be1_div_clk, \"be1-div\", \"de\", 0x20, 20, 4, 0);\nstatic SUNXI_CCU_M(be2_div_clk, \"be2-div\", \"de\", 0x20, 24, 4, 0);\n\nstatic struct ccu_common *sun9i_a80_de_clks[] = {\n\t&fe0_clk.common,\n\t&fe1_clk.common,\n\t&fe2_clk.common,\n\t&iep_deu0_clk.common,\n\t&iep_deu1_clk.common,\n\t&be0_clk.common,\n\t&be1_clk.common,\n\t&be2_clk.common,\n\t&iep_drc0_clk.common,\n\t&iep_drc1_clk.common,\n\t&merge_clk.common,\n\n\t&dram_fe0_clk.common,\n\t&dram_fe1_clk.common,\n\t&dram_fe2_clk.common,\n\t&dram_deu0_clk.common,\n\t&dram_deu1_clk.common,\n\t&dram_be0_clk.common,\n\t&dram_be1_clk.common,\n\t&dram_be2_clk.common,\n\t&dram_drc0_clk.common,\n\t&dram_drc1_clk.common,\n\n\t&bus_fe0_clk.common,\n\t&bus_fe1_clk.common,\n\t&bus_fe2_clk.common,\n\t&bus_deu0_clk.common,\n\t&bus_deu1_clk.common,\n\t&bus_be0_clk.common,\n\t&bus_be1_clk.common,\n\t&bus_be2_clk.common,\n\t&bus_drc0_clk.common,\n\t&bus_drc1_clk.common,\n\n\t&fe0_div_clk.common,\n\t&fe1_div_clk.common,\n\t&fe2_div_clk.common,\n\t&be0_div_clk.common,\n\t&be1_div_clk.common,\n\t&be2_div_clk.common,\n};\n\nstatic struct clk_hw_onecell_data sun9i_a80_de_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_FE0]\t= &fe0_clk.common.hw,\n\t\t[CLK_FE1]\t= &fe1_clk.common.hw,\n\t\t[CLK_FE2]\t= &fe2_clk.common.hw,\n\t\t[CLK_IEP_DEU0]\t= &iep_deu0_clk.common.hw,\n\t\t[CLK_IEP_DEU1]\t= &iep_deu1_clk.common.hw,\n\t\t[CLK_BE0]\t= &be0_clk.common.hw,\n\t\t[CLK_BE1]\t= &be1_clk.common.hw,\n\t\t[CLK_BE2]\t= &be2_clk.common.hw,\n\t\t[CLK_IEP_DRC0]\t= &iep_drc0_clk.common.hw,\n\t\t[CLK_IEP_DRC1]\t= &iep_drc1_clk.common.hw,\n\t\t[CLK_MERGE]\t= &merge_clk.common.hw,\n\n\t\t[CLK_DRAM_FE0]\t= &dram_fe0_clk.common.hw,\n\t\t[CLK_DRAM_FE1]\t= &dram_fe1_clk.common.hw,\n\t\t[CLK_DRAM_FE2]\t= &dram_fe2_clk.common.hw,\n\t\t[CLK_DRAM_DEU0]\t= &dram_deu0_clk.common.hw,\n\t\t[CLK_DRAM_DEU1]\t= &dram_deu1_clk.common.hw,\n\t\t[CLK_DRAM_BE0]\t= &dram_be0_clk.common.hw,\n\t\t[CLK_DRAM_BE1]\t= &dram_be1_clk.common.hw,\n\t\t[CLK_DRAM_BE2]\t= &dram_be2_clk.common.hw,\n\t\t[CLK_DRAM_DRC0]\t= &dram_drc0_clk.common.hw,\n\t\t[CLK_DRAM_DRC1]\t= &dram_drc1_clk.common.hw,\n\n\t\t[CLK_BUS_FE0]\t= &bus_fe0_clk.common.hw,\n\t\t[CLK_BUS_FE1]\t= &bus_fe1_clk.common.hw,\n\t\t[CLK_BUS_FE2]\t= &bus_fe2_clk.common.hw,\n\t\t[CLK_BUS_DEU0]\t= &bus_deu0_clk.common.hw,\n\t\t[CLK_BUS_DEU1]\t= &bus_deu1_clk.common.hw,\n\t\t[CLK_BUS_BE0]\t= &bus_be0_clk.common.hw,\n\t\t[CLK_BUS_BE1]\t= &bus_be1_clk.common.hw,\n\t\t[CLK_BUS_BE2]\t= &bus_be2_clk.common.hw,\n\t\t[CLK_BUS_DRC0]\t= &bus_drc0_clk.common.hw,\n\t\t[CLK_BUS_DRC1]\t= &bus_drc1_clk.common.hw,\n\n\t\t[CLK_FE0_DIV]\t= &fe0_div_clk.common.hw,\n\t\t[CLK_FE1_DIV]\t= &fe1_div_clk.common.hw,\n\t\t[CLK_FE2_DIV]\t= &fe2_div_clk.common.hw,\n\t\t[CLK_BE0_DIV]\t= &be0_div_clk.common.hw,\n\t\t[CLK_BE1_DIV]\t= &be1_div_clk.common.hw,\n\t\t[CLK_BE2_DIV]\t= &be2_div_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER,\n};\n\nstatic struct ccu_reset_map sun9i_a80_de_resets[] = {\n\t[RST_FE0]\t= { 0x0c, BIT(0) },\n\t[RST_FE1]\t= { 0x0c, BIT(1) },\n\t[RST_FE2]\t= { 0x0c, BIT(2) },\n\t[RST_DEU0]\t= { 0x0c, BIT(4) },\n\t[RST_DEU1]\t= { 0x0c, BIT(5) },\n\t[RST_BE0]\t= { 0x0c, BIT(8) },\n\t[RST_BE1]\t= { 0x0c, BIT(9) },\n\t[RST_BE2]\t= { 0x0c, BIT(10) },\n\t[RST_DRC0]\t= { 0x0c, BIT(12) },\n\t[RST_DRC1]\t= { 0x0c, BIT(13) },\n\t[RST_MERGE]\t= { 0x0c, BIT(20) },\n};\n\nstatic const struct sunxi_ccu_desc sun9i_a80_de_clk_desc = {\n\t.ccu_clks\t= sun9i_a80_de_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun9i_a80_de_clks),\n\n\t.hw_clks\t= &sun9i_a80_de_hw_clks,\n\n\t.resets\t\t= sun9i_a80_de_resets,\n\t.num_resets\t= ARRAY_SIZE(sun9i_a80_de_resets),\n};\n\nstatic int sun9i_a80_de_clk_probe(struct platform_device *pdev)\n{\n\tstruct clk *bus_clk;\n\tstruct reset_control *rstc;\n\tvoid __iomem *reg;\n\tint ret;\n\n\treg = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\tbus_clk = devm_clk_get(&pdev->dev, \"bus\");\n\tif (IS_ERR(bus_clk))\n\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(bus_clk),\n\t\t\t\t     \"Couldn't get bus clk\\n\");\n\n\trstc = devm_reset_control_get_exclusive(&pdev->dev, NULL);\n\tif (IS_ERR(rstc))\n\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(rstc),\n\t\t\t\t     \"Couldn't get reset control\\n\");\n\n\t \n\tret = clk_prepare_enable(bus_clk);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Couldn't enable bus clk: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\t \n\tret = reset_control_deassert(rstc);\n\tif (ret) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"Couldn't deassert reset control: %d\\n\", ret);\n\t\tgoto err_disable_clk;\n\t}\n\n\tret = devm_sunxi_ccu_probe(&pdev->dev, reg, &sun9i_a80_de_clk_desc);\n\tif (ret)\n\t\tgoto err_assert_reset;\n\n\treturn 0;\n\nerr_assert_reset:\n\treset_control_assert(rstc);\nerr_disable_clk:\n\tclk_disable_unprepare(bus_clk);\n\treturn ret;\n}\n\nstatic const struct of_device_id sun9i_a80_de_clk_ids[] = {\n\t{ .compatible = \"allwinner,sun9i-a80-de-clks\" },\n\t{ }\n};\n\nstatic struct platform_driver sun9i_a80_de_clk_driver = {\n\t.probe\t= sun9i_a80_de_clk_probe,\n\t.driver\t= {\n\t\t.name\t= \"sun9i-a80-de-clks\",\n\t\t.suppress_bind_attrs = true,\n\t\t.of_match_table\t= sun9i_a80_de_clk_ids,\n\t},\n};\nmodule_platform_driver(sun9i_a80_de_clk_driver);\n\nMODULE_IMPORT_NS(SUNXI_CCU);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}