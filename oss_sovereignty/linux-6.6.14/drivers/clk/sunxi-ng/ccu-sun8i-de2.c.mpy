{
  "module_name": "ccu-sun8i-de2.c",
  "hash_id": "6a3d5bc6662779f60017b1606b585926393a2494a7dba9d930f0de65df9aeb87",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sunxi-ng/ccu-sun8i-de2.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/reset.h>\n\n#include \"ccu_common.h\"\n#include \"ccu_div.h\"\n#include \"ccu_gate.h\"\n#include \"ccu_reset.h\"\n\n#include \"ccu-sun8i-de2.h\"\n\nstatic SUNXI_CCU_GATE(bus_mixer0_clk,\t\"bus-mixer0\",\t\"bus-de\",\n\t\t      0x04, BIT(0), 0);\nstatic SUNXI_CCU_GATE(bus_mixer1_clk,\t\"bus-mixer1\",\t\"bus-de\",\n\t\t      0x04, BIT(1), 0);\nstatic SUNXI_CCU_GATE(bus_wb_clk,\t\"bus-wb\",\t\"bus-de\",\n\t\t      0x04, BIT(2), 0);\nstatic SUNXI_CCU_GATE(bus_rot_clk,\t\"bus-rot\",\t\"bus-de\",\n\t\t      0x04, BIT(3), 0);\n\nstatic SUNXI_CCU_GATE(mixer0_clk,\t\"mixer0\",\t\"mixer0-div\",\n\t\t      0x00, BIT(0), CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_GATE(mixer1_clk,\t\"mixer1\",\t\"mixer1-div\",\n\t\t      0x00, BIT(1), CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_GATE(wb_clk,\t\t\"wb\",\t\t\"wb-div\",\n\t\t      0x00, BIT(2), CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_GATE(rot_clk,\t\t\"rot\",\t\t\"rot-div\",\n\t\t      0x00, BIT(3), CLK_SET_RATE_PARENT);\n\nstatic SUNXI_CCU_M(mixer0_div_clk, \"mixer0-div\", \"de\", 0x0c, 0, 4,\n\t\t   CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_M(mixer1_div_clk, \"mixer1-div\", \"de\", 0x0c, 4, 4,\n\t\t   CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_M(wb_div_clk, \"wb-div\", \"de\", 0x0c, 8, 4,\n\t\t   CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_M(rot_div_clk, \"rot-div\", \"de\", 0x0c, 0x0c, 4,\n\t\t   CLK_SET_RATE_PARENT);\n\nstatic SUNXI_CCU_M(mixer0_div_a83_clk, \"mixer0-div\", \"pll-de\", 0x0c, 0, 4,\n\t\t   CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_M(mixer1_div_a83_clk, \"mixer1-div\", \"pll-de\", 0x0c, 4, 4,\n\t\t   CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_M(wb_div_a83_clk, \"wb-div\", \"pll-de\", 0x0c, 8, 4,\n\t\t   CLK_SET_RATE_PARENT);\nstatic SUNXI_CCU_M(rot_div_a83_clk, \"rot-div\", \"pll-de\", 0x0c, 0x0c, 4,\n\t\t   CLK_SET_RATE_PARENT);\n\nstatic struct ccu_common *sun8i_de2_ccu_clks[] = {\n\t&mixer0_clk.common,\n\t&mixer1_clk.common,\n\t&wb_clk.common,\n\t&rot_clk.common,\n\n\t&bus_mixer0_clk.common,\n\t&bus_mixer1_clk.common,\n\t&bus_wb_clk.common,\n\t&bus_rot_clk.common,\n\n\t&mixer0_div_clk.common,\n\t&mixer1_div_clk.common,\n\t&wb_div_clk.common,\n\t&rot_div_clk.common,\n\n\t&mixer0_div_a83_clk.common,\n\t&mixer1_div_a83_clk.common,\n\t&wb_div_a83_clk.common,\n\t&rot_div_a83_clk.common,\n};\n\nstatic struct clk_hw_onecell_data sun8i_a83t_de2_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_MIXER0]\t\t= &mixer0_clk.common.hw,\n\t\t[CLK_MIXER1]\t\t= &mixer1_clk.common.hw,\n\t\t[CLK_WB]\t\t= &wb_clk.common.hw,\n\t\t[CLK_ROT]\t\t= &rot_clk.common.hw,\n\n\t\t[CLK_BUS_MIXER0]\t= &bus_mixer0_clk.common.hw,\n\t\t[CLK_BUS_MIXER1]\t= &bus_mixer1_clk.common.hw,\n\t\t[CLK_BUS_WB]\t\t= &bus_wb_clk.common.hw,\n\t\t[CLK_BUS_ROT]\t\t= &bus_rot_clk.common.hw,\n\n\t\t[CLK_MIXER0_DIV]\t= &mixer0_div_a83_clk.common.hw,\n\t\t[CLK_MIXER1_DIV]\t= &mixer1_div_a83_clk.common.hw,\n\t\t[CLK_WB_DIV]\t\t= &wb_div_a83_clk.common.hw,\n\t\t[CLK_ROT_DIV]\t\t= &rot_div_a83_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER_WITH_ROT,\n};\n\nstatic struct clk_hw_onecell_data sun8i_h3_de2_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_MIXER0]\t\t= &mixer0_clk.common.hw,\n\t\t[CLK_MIXER1]\t\t= &mixer1_clk.common.hw,\n\t\t[CLK_WB]\t\t= &wb_clk.common.hw,\n\n\t\t[CLK_BUS_MIXER0]\t= &bus_mixer0_clk.common.hw,\n\t\t[CLK_BUS_MIXER1]\t= &bus_mixer1_clk.common.hw,\n\t\t[CLK_BUS_WB]\t\t= &bus_wb_clk.common.hw,\n\n\t\t[CLK_MIXER0_DIV]\t= &mixer0_div_clk.common.hw,\n\t\t[CLK_MIXER1_DIV]\t= &mixer1_div_clk.common.hw,\n\t\t[CLK_WB_DIV]\t\t= &wb_div_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER_WITHOUT_ROT,\n};\n\nstatic struct clk_hw_onecell_data sun8i_v3s_de2_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_MIXER0]\t\t= &mixer0_clk.common.hw,\n\t\t[CLK_WB]\t\t= &wb_clk.common.hw,\n\n\t\t[CLK_BUS_MIXER0]\t= &bus_mixer0_clk.common.hw,\n\t\t[CLK_BUS_WB]\t\t= &bus_wb_clk.common.hw,\n\n\t\t[CLK_MIXER0_DIV]\t= &mixer0_div_clk.common.hw,\n\t\t[CLK_WB_DIV]\t\t= &wb_div_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER_WITHOUT_ROT,\n};\n\nstatic struct clk_hw_onecell_data sun50i_a64_de2_hw_clks = {\n\t.hws\t= {\n\t\t[CLK_MIXER0]\t\t= &mixer0_clk.common.hw,\n\t\t[CLK_MIXER1]\t\t= &mixer1_clk.common.hw,\n\t\t[CLK_WB]\t\t= &wb_clk.common.hw,\n\t\t[CLK_ROT]\t\t= &rot_clk.common.hw,\n\n\t\t[CLK_BUS_MIXER0]\t= &bus_mixer0_clk.common.hw,\n\t\t[CLK_BUS_MIXER1]\t= &bus_mixer1_clk.common.hw,\n\t\t[CLK_BUS_WB]\t\t= &bus_wb_clk.common.hw,\n\t\t[CLK_BUS_ROT]\t\t= &bus_rot_clk.common.hw,\n\n\t\t[CLK_MIXER0_DIV]\t= &mixer0_div_clk.common.hw,\n\t\t[CLK_MIXER1_DIV]\t= &mixer1_div_clk.common.hw,\n\t\t[CLK_WB_DIV]\t\t= &wb_div_clk.common.hw,\n\t\t[CLK_ROT_DIV]\t\t= &rot_div_clk.common.hw,\n\t},\n\t.num\t= CLK_NUMBER_WITH_ROT,\n};\n\nstatic struct ccu_reset_map sun8i_a83t_de2_resets[] = {\n\t[RST_MIXER0]\t= { 0x08, BIT(0) },\n\t \n\t[RST_WB]\t= { 0x08, BIT(2) },\n\t[RST_ROT]\t= { 0x08, BIT(3) },\n};\n\nstatic struct ccu_reset_map sun8i_h3_de2_resets[] = {\n\t[RST_MIXER0]\t= { 0x08, BIT(0) },\n\t \n\t[RST_WB]\t= { 0x08, BIT(2) },\n};\n\nstatic struct ccu_reset_map sun50i_a64_de2_resets[] = {\n\t[RST_MIXER0]\t= { 0x08, BIT(0) },\n\t[RST_MIXER1]\t= { 0x08, BIT(1) },\n\t[RST_WB]\t= { 0x08, BIT(2) },\n\t[RST_ROT]\t= { 0x08, BIT(3) },\n};\n\nstatic struct ccu_reset_map sun50i_h5_de2_resets[] = {\n\t[RST_MIXER0]\t= { 0x08, BIT(0) },\n\t[RST_MIXER1]\t= { 0x08, BIT(1) },\n\t[RST_WB]\t= { 0x08, BIT(2) },\n};\n\nstatic const struct sunxi_ccu_desc sun8i_a83t_de2_clk_desc = {\n\t.ccu_clks\t= sun8i_de2_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_de2_ccu_clks),\n\n\t.hw_clks\t= &sun8i_a83t_de2_hw_clks,\n\n\t.resets\t\t= sun8i_a83t_de2_resets,\n\t.num_resets\t= ARRAY_SIZE(sun8i_a83t_de2_resets),\n};\n\nstatic const struct sunxi_ccu_desc sun8i_h3_de2_clk_desc = {\n\t.ccu_clks\t= sun8i_de2_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_de2_ccu_clks),\n\n\t.hw_clks\t= &sun8i_h3_de2_hw_clks,\n\n\t.resets\t\t= sun8i_h3_de2_resets,\n\t.num_resets\t= ARRAY_SIZE(sun8i_h3_de2_resets),\n};\n\nstatic const struct sunxi_ccu_desc sun8i_r40_de2_clk_desc = {\n\t.ccu_clks\t= sun8i_de2_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_de2_ccu_clks),\n\n\t.hw_clks\t= &sun50i_a64_de2_hw_clks,\n\n\t.resets\t\t= sun8i_a83t_de2_resets,\n\t.num_resets\t= ARRAY_SIZE(sun8i_a83t_de2_resets),\n};\n\nstatic const struct sunxi_ccu_desc sun8i_v3s_de2_clk_desc = {\n\t.ccu_clks\t= sun8i_de2_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_de2_ccu_clks),\n\n\t.hw_clks\t= &sun8i_v3s_de2_hw_clks,\n\n\t.resets\t\t= sun8i_a83t_de2_resets,\n\t.num_resets\t= ARRAY_SIZE(sun8i_a83t_de2_resets),\n};\n\nstatic const struct sunxi_ccu_desc sun50i_a64_de2_clk_desc = {\n\t.ccu_clks\t= sun8i_de2_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_de2_ccu_clks),\n\n\t.hw_clks\t= &sun50i_a64_de2_hw_clks,\n\n\t.resets\t\t= sun50i_a64_de2_resets,\n\t.num_resets\t= ARRAY_SIZE(sun50i_a64_de2_resets),\n};\n\nstatic const struct sunxi_ccu_desc sun50i_h5_de2_clk_desc = {\n\t.ccu_clks\t= sun8i_de2_ccu_clks,\n\t.num_ccu_clks\t= ARRAY_SIZE(sun8i_de2_ccu_clks),\n\n\t.hw_clks\t= &sun8i_h3_de2_hw_clks,\n\n\t.resets\t\t= sun50i_h5_de2_resets,\n\t.num_resets\t= ARRAY_SIZE(sun50i_h5_de2_resets),\n};\n\nstatic int sunxi_de2_clk_probe(struct platform_device *pdev)\n{\n\tstruct clk *bus_clk, *mod_clk;\n\tstruct reset_control *rstc;\n\tvoid __iomem *reg;\n\tconst struct sunxi_ccu_desc *ccu_desc;\n\tint ret;\n\n\tccu_desc = of_device_get_match_data(&pdev->dev);\n\tif (!ccu_desc)\n\t\treturn -EINVAL;\n\n\treg = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\tbus_clk = devm_clk_get(&pdev->dev, \"bus\");\n\tif (IS_ERR(bus_clk))\n\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(bus_clk),\n\t\t\t\t     \"Couldn't get bus clk\\n\");\n\n\tmod_clk = devm_clk_get(&pdev->dev, \"mod\");\n\tif (IS_ERR(mod_clk))\n\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(mod_clk),\n\t\t\t\t     \"Couldn't get mod clk\\n\");\n\n\trstc = devm_reset_control_get_exclusive(&pdev->dev, NULL);\n\tif (IS_ERR(rstc))\n\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(rstc),\n\t\t\t\t     \"Couldn't get reset control\\n\");\n\n\t \n\tret = clk_prepare_enable(bus_clk);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Couldn't enable bus clk: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = clk_prepare_enable(mod_clk);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Couldn't enable mod clk: %d\\n\", ret);\n\t\tgoto err_disable_bus_clk;\n\t}\n\n\t \n\tret = reset_control_deassert(rstc);\n\tif (ret) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"Couldn't deassert reset control: %d\\n\", ret);\n\t\tgoto err_disable_mod_clk;\n\t}\n\n\tret = devm_sunxi_ccu_probe(&pdev->dev, reg, ccu_desc);\n\tif (ret)\n\t\tgoto err_assert_reset;\n\n\treturn 0;\n\nerr_assert_reset:\n\treset_control_assert(rstc);\nerr_disable_mod_clk:\n\tclk_disable_unprepare(mod_clk);\nerr_disable_bus_clk:\n\tclk_disable_unprepare(bus_clk);\n\treturn ret;\n}\n\nstatic const struct of_device_id sunxi_de2_clk_ids[] = {\n\t{\n\t\t.compatible = \"allwinner,sun8i-a83t-de2-clk\",\n\t\t.data = &sun8i_a83t_de2_clk_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-h3-de2-clk\",\n\t\t.data = &sun8i_h3_de2_clk_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-r40-de2-clk\",\n\t\t.data = &sun8i_r40_de2_clk_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun8i-v3s-de2-clk\",\n\t\t.data = &sun8i_v3s_de2_clk_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun50i-a64-de2-clk\",\n\t\t.data = &sun50i_a64_de2_clk_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun50i-h5-de2-clk\",\n\t\t.data = &sun50i_h5_de2_clk_desc,\n\t},\n\t{\n\t\t.compatible = \"allwinner,sun50i-h6-de3-clk\",\n\t\t.data = &sun50i_h5_de2_clk_desc,\n\t},\n\t{ }\n};\n\nstatic struct platform_driver sunxi_de2_clk_driver = {\n\t.probe\t= sunxi_de2_clk_probe,\n\t.driver\t= {\n\t\t.name\t= \"sunxi-de2-clks\",\n\t\t.of_match_table\t= sunxi_de2_clk_ids,\n\t},\n};\nmodule_platform_driver(sunxi_de2_clk_driver);\n\nMODULE_IMPORT_NS(SUNXI_CCU);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}