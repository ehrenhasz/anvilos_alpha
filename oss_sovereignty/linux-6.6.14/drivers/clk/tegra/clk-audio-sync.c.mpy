{
  "module_name": "clk-audio-sync.c",
  "hash_id": "89e0c952b867a490f0d07afd474e6599ee5eff6a4f9772a8116073602154e85d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/tegra/clk-audio-sync.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n\n#include \"clk.h\"\n\nstatic unsigned long clk_sync_source_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t\t unsigned long parent_rate)\n{\n\tstruct tegra_clk_sync_source *sync = to_clk_sync_source(hw);\n\n\treturn sync->rate;\n}\n\nstatic long clk_sync_source_round_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\t       unsigned long *prate)\n{\n\tstruct tegra_clk_sync_source *sync = to_clk_sync_source(hw);\n\n\tif (rate > sync->max_rate)\n\t\treturn -EINVAL;\n\telse\n\t\treturn rate;\n}\n\nstatic int clk_sync_source_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\t    unsigned long parent_rate)\n{\n\tstruct tegra_clk_sync_source *sync = to_clk_sync_source(hw);\n\n\tsync->rate = rate;\n\treturn 0;\n}\n\nconst struct clk_ops tegra_clk_sync_source_ops = {\n\t.round_rate = clk_sync_source_round_rate,\n\t.set_rate = clk_sync_source_set_rate,\n\t.recalc_rate = clk_sync_source_recalc_rate,\n};\n\nstruct clk *tegra_clk_register_sync_source(const char *name,\n\t\t\t\t\t   unsigned long max_rate)\n{\n\tstruct tegra_clk_sync_source *sync;\n\tstruct clk_init_data init;\n\tstruct clk *clk;\n\n\tsync = kzalloc(sizeof(*sync), GFP_KERNEL);\n\tif (!sync) {\n\t\tpr_err(\"%s: could not allocate sync source clk\\n\", __func__);\n\t\treturn ERR_PTR(-ENOMEM);\n\t}\n\n\tsync->max_rate = max_rate;\n\n\tinit.ops = &tegra_clk_sync_source_ops;\n\tinit.name = name;\n\tinit.flags = 0;\n\tinit.parent_names = NULL;\n\tinit.num_parents = 0;\n\n\t \n\tsync->hw.init = &init;\n\n\tclk = clk_register(NULL, &sync->hw);\n\tif (IS_ERR(clk))\n\t\tkfree(sync);\n\n\treturn clk;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}