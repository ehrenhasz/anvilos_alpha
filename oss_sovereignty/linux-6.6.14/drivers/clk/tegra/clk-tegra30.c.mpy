{
  "module_name": "clk-tegra30.c",
  "hash_id": "37e86352bf2c461892455bd0cffa327f01ef5080d20c88611983a4d09b453cb1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/tegra/clk-tegra30.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/delay.h>\n#include <linux/clk-provider.h>\n#include <linux/clkdev.h>\n#include <linux/init.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n#include <linux/clk/tegra.h>\n\n#include <soc/tegra/pmc.h>\n\n#include <dt-bindings/clock/tegra30-car.h>\n\n#include \"clk.h\"\n#include \"clk-id.h\"\n\n#define OSC_CTRL\t\t\t0x50\n#define OSC_CTRL_OSC_FREQ_MASK\t\t(0xF<<28)\n#define OSC_CTRL_OSC_FREQ_13MHZ\t\t(0X0<<28)\n#define OSC_CTRL_OSC_FREQ_19_2MHZ\t(0X4<<28)\n#define OSC_CTRL_OSC_FREQ_12MHZ\t\t(0X8<<28)\n#define OSC_CTRL_OSC_FREQ_26MHZ\t\t(0XC<<28)\n#define OSC_CTRL_OSC_FREQ_16_8MHZ\t(0X1<<28)\n#define OSC_CTRL_OSC_FREQ_38_4MHZ\t(0X5<<28)\n#define OSC_CTRL_OSC_FREQ_48MHZ\t\t(0X9<<28)\n#define OSC_CTRL_MASK\t\t\t(0x3f2 | OSC_CTRL_OSC_FREQ_MASK)\n\n#define OSC_CTRL_PLL_REF_DIV_MASK\t(3<<26)\n#define OSC_CTRL_PLL_REF_DIV_1\t\t(0<<26)\n#define OSC_CTRL_PLL_REF_DIV_2\t\t(1<<26)\n#define OSC_CTRL_PLL_REF_DIV_4\t\t(2<<26)\n\n#define OSC_FREQ_DET\t\t\t0x58\n#define OSC_FREQ_DET_TRIG\t\tBIT(31)\n\n#define OSC_FREQ_DET_STATUS\t\t0x5c\n#define OSC_FREQ_DET_BUSY\t\tBIT(31)\n#define OSC_FREQ_DET_CNT_MASK\t\t0xffff\n\n#define CCLKG_BURST_POLICY 0x368\n#define SUPER_CCLKG_DIVIDER 0x36c\n#define CCLKLP_BURST_POLICY 0x370\n#define SUPER_CCLKLP_DIVIDER 0x374\n#define SCLK_BURST_POLICY 0x028\n#define SUPER_SCLK_DIVIDER 0x02c\n\n#define SYSTEM_CLK_RATE 0x030\n\n#define TEGRA30_CLK_PERIPH_BANKS\t5\n\n#define PLLC_BASE 0x80\n#define PLLC_MISC 0x8c\n#define PLLM_BASE 0x90\n#define PLLM_MISC 0x9c\n#define PLLP_BASE 0xa0\n#define PLLP_MISC 0xac\n#define PLLX_BASE 0xe0\n#define PLLX_MISC 0xe4\n#define PLLD_BASE 0xd0\n#define PLLD_MISC 0xdc\n#define PLLD2_BASE 0x4b8\n#define PLLD2_MISC 0x4bc\n#define PLLE_BASE 0xe8\n#define PLLE_MISC 0xec\n#define PLLA_BASE 0xb0\n#define PLLA_MISC 0xbc\n#define PLLU_BASE 0xc0\n#define PLLU_MISC 0xcc\n\n#define PLL_MISC_LOCK_ENABLE 18\n#define PLLDU_MISC_LOCK_ENABLE 22\n#define PLLE_MISC_LOCK_ENABLE 9\n\n#define PLL_BASE_LOCK BIT(27)\n#define PLLE_MISC_LOCK BIT(11)\n\n#define PLLE_AUX 0x48c\n#define PLLC_OUT 0x84\n#define PLLM_OUT 0x94\n#define PLLP_OUTA 0xa4\n#define PLLP_OUTB 0xa8\n#define PLLA_OUT 0xb4\n\n#define AUDIO_SYNC_CLK_I2S0 0x4a0\n#define AUDIO_SYNC_CLK_I2S1 0x4a4\n#define AUDIO_SYNC_CLK_I2S2 0x4a8\n#define AUDIO_SYNC_CLK_I2S3 0x4ac\n#define AUDIO_SYNC_CLK_I2S4 0x4b0\n#define AUDIO_SYNC_CLK_SPDIF 0x4b4\n\n#define CLK_SOURCE_SPDIF_OUT 0x108\n#define CLK_SOURCE_PWM 0x110\n#define CLK_SOURCE_D_AUDIO 0x3d0\n#define CLK_SOURCE_DAM0 0x3d8\n#define CLK_SOURCE_DAM1 0x3dc\n#define CLK_SOURCE_DAM2 0x3e0\n#define CLK_SOURCE_3D2 0x3b0\n#define CLK_SOURCE_2D 0x15c\n#define CLK_SOURCE_HDMI 0x18c\n#define CLK_SOURCE_DSIB 0xd0\n#define CLK_SOURCE_SE 0x42c\n#define CLK_SOURCE_EMC 0x19c\n\n#define AUDIO_SYNC_DOUBLER 0x49c\n\n \n#define TEGRA_CLK_RST_CONTROLLER_CLK_CPU_CMPLX\t\t0x4c\n#define TEGRA_CLK_RST_CONTROLLER_RST_CPU_CMPLX_SET\t0x340\n#define TEGRA_CLK_RST_CONTROLLER_RST_CPU_CMPLX_CLR\t0x344\n#define TEGRA30_CLK_RST_CONTROLLER_CLK_CPU_CMPLX_CLR\t0x34c\n#define TEGRA30_CLK_RST_CONTROLLER_CPU_CMPLX_STATUS\t0x470\n\n#define CPU_CLOCK(cpu)\t(0x1 << (8 + cpu))\n#define CPU_RESET(cpu)\t(0x1111ul << (cpu))\n\n#define CLK_RESET_CCLK_BURST\t0x20\n#define CLK_RESET_CCLK_DIVIDER\t0x24\n#define CLK_RESET_PLLX_BASE\t0xe0\n#define CLK_RESET_PLLX_MISC\t0xe4\n\n#define CLK_RESET_SOURCE_CSITE\t0x1d4\n\n#define CLK_RESET_CCLK_BURST_POLICY_SHIFT\t28\n#define CLK_RESET_CCLK_RUN_POLICY_SHIFT\t\t4\n#define CLK_RESET_CCLK_IDLE_POLICY_SHIFT\t0\n#define CLK_RESET_CCLK_IDLE_POLICY\t\t1\n#define CLK_RESET_CCLK_RUN_POLICY\t\t2\n#define CLK_RESET_CCLK_BURST_POLICY_PLLX\t8\n\n \n#define PMC_PLLM_WB0_OVERRIDE 0x1dc\n\n#ifdef CONFIG_PM_SLEEP\nstatic struct cpu_clk_suspend_context {\n\tu32 pllx_misc;\n\tu32 pllx_base;\n\n\tu32 cpu_burst;\n\tu32 clk_csite_src;\n\tu32 cclk_divider;\n} tegra30_cpu_clk_sctx;\n#endif\n\nstatic void __iomem *clk_base;\nstatic void __iomem *pmc_base;\nstatic unsigned long input_freq;\n\nstatic DEFINE_SPINLOCK(cml_lock);\nstatic DEFINE_SPINLOCK(pll_d_lock);\n\n#define TEGRA_INIT_DATA_MUX(_name, _parents, _offset,\t\\\n\t\t\t    _clk_num, _gate_flags, _clk_id)\t\\\n\tTEGRA_INIT_DATA(_name, NULL, NULL, _parents, _offset,\t\\\n\t\t\t30, 2, 0, 0, 8, 1, TEGRA_DIVIDER_ROUND_UP, \\\n\t\t\t_clk_num, _gate_flags, _clk_id)\n\n#define TEGRA_INIT_DATA_MUX8(_name, _parents, _offset, \\\n\t\t\t     _clk_num, _gate_flags, _clk_id)\t\\\n\tTEGRA_INIT_DATA(_name, NULL, NULL, _parents, _offset,\t\\\n\t\t\t29, 3, 0, 0, 8, 1, TEGRA_DIVIDER_ROUND_UP, \\\n\t\t\t_clk_num, _gate_flags, _clk_id)\n\n#define TEGRA_INIT_DATA_INT(_name, _parents, _offset,\t\\\n\t\t\t    _clk_num, _gate_flags, _clk_id)\t\\\n\tTEGRA_INIT_DATA(_name, NULL, NULL, _parents, _offset,\t\\\n\t\t\t30, 2, 0, 0, 8, 1, TEGRA_DIVIDER_INT |\t\t\\\n\t\t\tTEGRA_DIVIDER_ROUND_UP, _clk_num,\t\\\n\t\t\t_gate_flags, _clk_id)\n\n#define TEGRA_INIT_DATA_NODIV(_name, _parents, _offset, \\\n\t\t\t      _mux_shift, _mux_width, _clk_num, \\\n\t\t\t      _gate_flags, _clk_id)\t\t\t\\\n\tTEGRA_INIT_DATA(_name, NULL, NULL, _parents, _offset,\t\\\n\t\t\t_mux_shift, _mux_width, 0, 0, 0, 0, 0,\\\n\t\t\t_clk_num, _gate_flags,\t\\\n\t\t\t_clk_id)\n\nstatic struct clk **clks;\n\nstatic struct tegra_clk_pll_freq_table pll_c_freq_table[] = {\n\t{ 12000000, 1040000000, 520,  6, 1, 8 },\n\t{ 13000000, 1040000000, 480,  6, 1, 8 },\n\t{ 16800000, 1040000000, 495,  8, 1, 8 },  \n\t{ 19200000, 1040000000, 325,  6, 1, 6 },\n\t{ 26000000, 1040000000, 520, 13, 1, 8 },\n\t{ 12000000,  832000000, 416,  6, 1, 8 },\n\t{ 13000000,  832000000, 832, 13, 1, 8 },\n\t{ 16800000,  832000000, 396,  8, 1, 8 },  \n\t{ 19200000,  832000000, 260,  6, 1, 8 },\n\t{ 26000000,  832000000, 416, 13, 1, 8 },\n\t{ 12000000,  624000000, 624, 12, 1, 8 },\n\t{ 13000000,  624000000, 624, 13, 1, 8 },\n\t{ 16800000,  600000000, 520, 14, 1, 8 },\n\t{ 19200000,  624000000, 520, 16, 1, 8 },\n\t{ 26000000,  624000000, 624, 26, 1, 8 },\n\t{ 12000000,  600000000, 600, 12, 1, 8 },\n\t{ 13000000,  600000000, 600, 13, 1, 8 },\n\t{ 16800000,  600000000, 500, 14, 1, 8 },\n\t{ 19200000,  600000000, 375, 12, 1, 6 },\n\t{ 26000000,  600000000, 600, 26, 1, 8 },\n\t{ 12000000,  520000000, 520, 12, 1, 8 },\n\t{ 13000000,  520000000, 520, 13, 1, 8 },\n\t{ 16800000,  520000000, 495, 16, 1, 8 },  \n\t{ 19200000,  520000000, 325, 12, 1, 6 },\n\t{ 26000000,  520000000, 520, 26, 1, 8 },\n\t{ 12000000,  416000000, 416, 12, 1, 8 },\n\t{ 13000000,  416000000, 416, 13, 1, 8 },\n\t{ 16800000,  416000000, 396, 16, 1, 8 },  \n\t{ 19200000,  416000000, 260, 12, 1, 6 },\n\t{ 26000000,  416000000, 416, 26, 1, 8 },\n\t{        0,          0,   0,  0, 0, 0 },\n};\n\nstatic struct tegra_clk_pll_freq_table pll_m_freq_table[] = {\n\t{ 12000000, 666000000, 666, 12, 1, 8 },\n\t{ 13000000, 666000000, 666, 13, 1, 8 },\n\t{ 16800000, 666000000, 555, 14, 1, 8 },\n\t{ 19200000, 666000000, 555, 16, 1, 8 },\n\t{ 26000000, 666000000, 666, 26, 1, 8 },\n\t{ 12000000, 600000000, 600, 12, 1, 8 },\n\t{ 13000000, 600000000, 600, 13, 1, 8 },\n\t{ 16800000, 600000000, 500, 14, 1, 8 },\n\t{ 19200000, 600000000, 375, 12, 1, 6 },\n\t{ 26000000, 600000000, 600, 26, 1, 8 },\n\t{        0,         0,   0,  0, 0, 0 },\n};\n\nstatic struct tegra_clk_pll_freq_table pll_p_freq_table[] = {\n\t{ 12000000, 216000000, 432, 12, 2, 8 },\n\t{ 13000000, 216000000, 432, 13, 2, 8 },\n\t{ 16800000, 216000000, 360, 14, 2, 8 },\n\t{ 19200000, 216000000, 360, 16, 2, 8 },\n\t{ 26000000, 216000000, 432, 26, 2, 8 },\n\t{        0,         0,   0,  0, 0, 0 },\n};\n\nstatic struct tegra_clk_pll_freq_table pll_a_freq_table[] = {\n\t{  9600000, 564480000, 294,  5, 1, 4 },\n\t{  9600000, 552960000, 288,  5, 1, 4 },\n\t{  9600000,  24000000,   5,  2, 1, 1 },\n\t{ 28800000,  56448000,  49, 25, 1, 1 },\n\t{ 28800000,  73728000,  64, 25, 1, 1 },\n\t{ 28800000,  24000000,   5,  6, 1, 1 },\n\t{        0,         0,   0,  0, 0, 0 },\n};\n\nstatic struct tegra_clk_pll_freq_table pll_d_freq_table[] = {\n\t{ 12000000,  216000000,  216, 12, 1,  4 },\n\t{ 13000000,  216000000,  216, 13, 1,  4 },\n\t{ 16800000,  216000000,  180, 14, 1,  4 },\n\t{ 19200000,  216000000,  180, 16, 1,  4 },\n\t{ 26000000,  216000000,  216, 26, 1,  4 },\n\t{ 12000000,  594000000,  594, 12, 1,  8 },\n\t{ 13000000,  594000000,  594, 13, 1,  8 },\n\t{ 16800000,  594000000,  495, 14, 1,  8 },\n\t{ 19200000,  594000000,  495, 16, 1,  8 },\n\t{ 26000000,  594000000,  594, 26, 1,  8 },\n\t{ 12000000, 1000000000, 1000, 12, 1, 12 },\n\t{ 13000000, 1000000000, 1000, 13, 1, 12 },\n\t{ 19200000, 1000000000,  625, 12, 1,  8 },\n\t{ 26000000, 1000000000, 1000, 26, 1, 12 },\n\t{        0,          0,    0,  0, 0,  0 },\n};\n\nstatic const struct pdiv_map pllu_p[] = {\n\t{ .pdiv = 1, .hw_val = 1 },\n\t{ .pdiv = 2, .hw_val = 0 },\n\t{ .pdiv = 0, .hw_val = 0 },\n};\n\nstatic struct tegra_clk_pll_freq_table pll_u_freq_table[] = {\n\t{ 12000000, 480000000, 960, 12, 2, 12 },\n\t{ 13000000, 480000000, 960, 13, 2, 12 },\n\t{ 16800000, 480000000, 400,  7, 2,  5 },\n\t{ 19200000, 480000000, 200,  4, 2,  3 },\n\t{ 26000000, 480000000, 960, 26, 2, 12 },\n\t{        0,         0,   0,  0, 0,  0 },\n};\n\nstatic struct tegra_clk_pll_freq_table pll_x_freq_table[] = {\n\t \n\t{ 12000000, 1700000000, 850,   6, 1, 8 },\n\t{ 13000000, 1700000000, 915,   7, 1, 8 },  \n\t{ 16800000, 1700000000, 708,   7, 1, 8 },  \n\t{ 19200000, 1700000000, 885,  10, 1, 8 },  \n\t{ 26000000, 1700000000, 850,  13, 1, 8 },\n\t \n\t{ 12000000, 1600000000, 800,   6, 1, 8 },\n\t{ 13000000, 1600000000, 738,   6, 1, 8 },  \n\t{ 16800000, 1600000000, 857,   9, 1, 8 },  \n\t{ 19200000, 1600000000, 500,   6, 1, 8 },\n\t{ 26000000, 1600000000, 800,  13, 1, 8 },\n\t \n\t{ 12000000, 1500000000, 750,   6, 1, 8 },\n\t{ 13000000, 1500000000, 923,   8, 1, 8 },  \n\t{ 16800000, 1500000000, 625,   7, 1, 8 },\n\t{ 19200000, 1500000000, 625,   8, 1, 8 },\n\t{ 26000000, 1500000000, 750,  13, 1, 8 },\n\t \n\t{ 12000000, 1400000000,  700,  6, 1, 8 },\n\t{ 13000000, 1400000000,  969,  9, 1, 8 },  \n\t{ 16800000, 1400000000, 1000, 12, 1, 8 },\n\t{ 19200000, 1400000000,  875, 12, 1, 8 },\n\t{ 26000000, 1400000000,  700, 13, 1, 8 },\n\t \n\t{ 12000000, 1300000000,  975,  9, 1, 8 },\n\t{ 13000000, 1300000000, 1000, 10, 1, 8 },\n\t{ 16800000, 1300000000,  928, 12, 1, 8 },  \n\t{ 19200000, 1300000000,  812, 12, 1, 8 },  \n\t{ 26000000, 1300000000,  650, 13, 1, 8 },\n\t \n\t{ 12000000, 1200000000, 1000, 10, 1, 8 },\n\t{ 13000000, 1200000000,  923, 10, 1, 8 },  \n\t{ 16800000, 1200000000, 1000, 14, 1, 8 },\n\t{ 19200000, 1200000000, 1000, 16, 1, 8 },\n\t{ 26000000, 1200000000,  600, 13, 1, 8 },\n\t \n\t{ 12000000, 1100000000, 825,   9, 1, 8 },\n\t{ 13000000, 1100000000, 846,  10, 1, 8 },  \n\t{ 16800000, 1100000000, 982,  15, 1, 8 },  \n\t{ 19200000, 1100000000, 859,  15, 1, 8 },  \n\t{ 26000000, 1100000000, 550,  13, 1, 8 },\n\t \n\t{ 12000000, 1000000000, 1000, 12, 1, 8 },\n\t{ 13000000, 1000000000, 1000, 13, 1, 8 },\n\t{ 16800000, 1000000000,  833, 14, 1, 8 },  \n\t{ 19200000, 1000000000,  625, 12, 1, 8 },\n\t{ 26000000, 1000000000, 1000, 26, 1, 8 },\n\t{        0,          0,    0,  0, 0, 0 },\n};\n\nstatic const struct pdiv_map plle_p[] = {\n\t{ .pdiv = 18, .hw_val = 18 },\n\t{ .pdiv = 24, .hw_val = 24 },\n\t{ .pdiv =  0, .hw_val =  0 },\n};\n\nstatic struct tegra_clk_pll_freq_table pll_e_freq_table[] = {\n\t \n\t{  12000000, 100000000, 150,  1, 18, 11 },\n\t{ 216000000, 100000000, 200, 18, 24, 13 },\n\t{         0,         0,   0,  0,  0,  0 },\n};\n\n \nstatic struct tegra_clk_pll_params pll_c_params __ro_after_init = {\n\t.input_min = 2000000,\n\t.input_max = 31000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 20000000,\n\t.vco_max = 1400000000,\n\t.base_reg = PLLC_BASE,\n\t.misc_reg = PLLC_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLL_MISC_LOCK_ENABLE,\n\t.lock_delay = 300,\n\t.freq_table = pll_c_freq_table,\n\t.flags = TEGRA_PLL_HAS_CPCON | TEGRA_PLL_USE_LOCK |\n\t\t TEGRA_PLL_HAS_LOCK_ENABLE,\n};\n\nstatic struct div_nmp pllm_nmp = {\n\t.divn_shift = 8,\n\t.divn_width = 10,\n\t.override_divn_shift = 5,\n\t.divm_shift = 0,\n\t.divm_width = 5,\n\t.override_divm_shift = 0,\n\t.divp_shift = 20,\n\t.divp_width = 3,\n\t.override_divp_shift = 15,\n};\n\nstatic struct tegra_clk_pll_params pll_m_params __ro_after_init = {\n\t.input_min = 2000000,\n\t.input_max = 31000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 20000000,\n\t.vco_max = 1200000000,\n\t.base_reg = PLLM_BASE,\n\t.misc_reg = PLLM_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLL_MISC_LOCK_ENABLE,\n\t.lock_delay = 300,\n\t.div_nmp = &pllm_nmp,\n\t.pmc_divnm_reg = PMC_PLLM_WB0_OVERRIDE,\n\t.pmc_divp_reg = PMC_PLLM_WB0_OVERRIDE,\n\t.freq_table = pll_m_freq_table,\n\t.flags = TEGRA_PLLM | TEGRA_PLL_HAS_CPCON |\n\t\t TEGRA_PLL_SET_DCCON | TEGRA_PLL_USE_LOCK |\n\t\t TEGRA_PLL_HAS_LOCK_ENABLE | TEGRA_PLL_FIXED,\n};\n\nstatic struct tegra_clk_pll_params pll_p_params __ro_after_init = {\n\t.input_min = 2000000,\n\t.input_max = 31000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 20000000,\n\t.vco_max = 1400000000,\n\t.base_reg = PLLP_BASE,\n\t.misc_reg = PLLP_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLL_MISC_LOCK_ENABLE,\n\t.lock_delay = 300,\n\t.freq_table = pll_p_freq_table,\n\t.flags = TEGRA_PLL_FIXED | TEGRA_PLL_HAS_CPCON | TEGRA_PLL_USE_LOCK |\n\t\t TEGRA_PLL_HAS_LOCK_ENABLE,\n\t.fixed_rate = 408000000,\n};\n\nstatic struct tegra_clk_pll_params pll_a_params = {\n\t.input_min = 2000000,\n\t.input_max = 31000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 20000000,\n\t.vco_max = 1400000000,\n\t.base_reg = PLLA_BASE,\n\t.misc_reg = PLLA_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLL_MISC_LOCK_ENABLE,\n\t.lock_delay = 300,\n\t.freq_table = pll_a_freq_table,\n\t.flags = TEGRA_PLL_HAS_CPCON | TEGRA_PLL_USE_LOCK |\n\t\t TEGRA_PLL_HAS_LOCK_ENABLE,\n};\n\nstatic struct tegra_clk_pll_params pll_d_params __ro_after_init = {\n\t.input_min = 2000000,\n\t.input_max = 40000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 40000000,\n\t.vco_max = 1000000000,\n\t.base_reg = PLLD_BASE,\n\t.misc_reg = PLLD_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLLDU_MISC_LOCK_ENABLE,\n\t.lock_delay = 1000,\n\t.freq_table = pll_d_freq_table,\n\t.flags = TEGRA_PLL_HAS_CPCON | TEGRA_PLL_SET_LFCON |\n\t\t TEGRA_PLL_USE_LOCK | TEGRA_PLL_HAS_LOCK_ENABLE,\n};\n\nstatic struct tegra_clk_pll_params pll_d2_params __ro_after_init = {\n\t.input_min = 2000000,\n\t.input_max = 40000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 40000000,\n\t.vco_max = 1000000000,\n\t.base_reg = PLLD2_BASE,\n\t.misc_reg = PLLD2_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLLDU_MISC_LOCK_ENABLE,\n\t.lock_delay = 1000,\n\t.freq_table = pll_d_freq_table,\n\t.flags = TEGRA_PLL_HAS_CPCON | TEGRA_PLL_SET_LFCON |\n\t\t TEGRA_PLL_USE_LOCK | TEGRA_PLL_HAS_LOCK_ENABLE,\n};\n\nstatic struct tegra_clk_pll_params pll_u_params __ro_after_init = {\n\t.input_min = 2000000,\n\t.input_max = 40000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 48000000,\n\t.vco_max = 960000000,\n\t.base_reg = PLLU_BASE,\n\t.misc_reg = PLLU_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLLDU_MISC_LOCK_ENABLE,\n\t.lock_delay = 1000,\n\t.pdiv_tohw = pllu_p,\n\t.freq_table = pll_u_freq_table,\n\t.flags = TEGRA_PLLU | TEGRA_PLL_HAS_CPCON | TEGRA_PLL_SET_LFCON |\n\t\t TEGRA_PLL_HAS_LOCK_ENABLE,\n};\n\nstatic struct tegra_clk_pll_params pll_x_params __ro_after_init = {\n\t.input_min = 2000000,\n\t.input_max = 31000000,\n\t.cf_min = 1000000,\n\t.cf_max = 6000000,\n\t.vco_min = 20000000,\n\t.vco_max = 1700000000,\n\t.base_reg = PLLX_BASE,\n\t.misc_reg = PLLX_MISC,\n\t.lock_mask = PLL_BASE_LOCK,\n\t.lock_enable_bit_idx = PLL_MISC_LOCK_ENABLE,\n\t.lock_delay = 300,\n\t.freq_table = pll_x_freq_table,\n\t.flags = TEGRA_PLL_HAS_CPCON | TEGRA_PLL_SET_DCCON |\n\t\t TEGRA_PLL_USE_LOCK | TEGRA_PLL_HAS_LOCK_ENABLE,\n\t.pre_rate_change = tegra_cclk_pre_pllx_rate_change,\n\t.post_rate_change = tegra_cclk_post_pllx_rate_change,\n};\n\nstatic struct tegra_clk_pll_params pll_e_params __ro_after_init = {\n\t.input_min = 12000000,\n\t.input_max = 216000000,\n\t.cf_min = 12000000,\n\t.cf_max = 12000000,\n\t.vco_min = 1200000000,\n\t.vco_max = 2400000000U,\n\t.base_reg = PLLE_BASE,\n\t.misc_reg = PLLE_MISC,\n\t.lock_mask = PLLE_MISC_LOCK,\n\t.lock_enable_bit_idx = PLLE_MISC_LOCK_ENABLE,\n\t.lock_delay = 300,\n\t.pdiv_tohw = plle_p,\n\t.freq_table = pll_e_freq_table,\n\t.flags = TEGRA_PLLE_CONFIGURE | TEGRA_PLL_FIXED |\n\t\t TEGRA_PLL_HAS_LOCK_ENABLE | TEGRA_PLL_LOCK_MISC,\n\t.fixed_rate = 100000000,\n};\n\nstatic unsigned long tegra30_input_freq[] = {\n\t[ 0] = 13000000,\n\t[ 1] = 16800000,\n\t[ 4] = 19200000,\n\t[ 5] = 38400000,\n\t[ 8] = 12000000,\n\t[ 9] = 48000000,\n\t[12] = 26000000,\n};\n\nstatic struct tegra_devclk devclks[] = {\n\t{ .con_id = \"pll_c\", .dt_id = TEGRA30_CLK_PLL_C },\n\t{ .con_id = \"pll_c_out1\", .dt_id = TEGRA30_CLK_PLL_C_OUT1 },\n\t{ .con_id = \"pll_p\", .dt_id = TEGRA30_CLK_PLL_P },\n\t{ .con_id = \"pll_p_out1\", .dt_id = TEGRA30_CLK_PLL_P_OUT1 },\n\t{ .con_id = \"pll_p_out2\", .dt_id = TEGRA30_CLK_PLL_P_OUT2 },\n\t{ .con_id = \"pll_p_out3\", .dt_id = TEGRA30_CLK_PLL_P_OUT3 },\n\t{ .con_id = \"pll_p_out4\", .dt_id = TEGRA30_CLK_PLL_P_OUT4 },\n\t{ .con_id = \"pll_m\", .dt_id = TEGRA30_CLK_PLL_M },\n\t{ .con_id = \"pll_m_out1\", .dt_id = TEGRA30_CLK_PLL_M_OUT1 },\n\t{ .con_id = \"pll_x\", .dt_id = TEGRA30_CLK_PLL_X },\n\t{ .con_id = \"pll_x_out0\", .dt_id = TEGRA30_CLK_PLL_X_OUT0 },\n\t{ .con_id = \"pll_u\", .dt_id = TEGRA30_CLK_PLL_U },\n\t{ .con_id = \"pll_d\", .dt_id = TEGRA30_CLK_PLL_D },\n\t{ .con_id = \"pll_d_out0\", .dt_id = TEGRA30_CLK_PLL_D_OUT0 },\n\t{ .con_id = \"pll_d2\", .dt_id = TEGRA30_CLK_PLL_D2 },\n\t{ .con_id = \"pll_d2_out0\", .dt_id = TEGRA30_CLK_PLL_D2_OUT0 },\n\t{ .con_id = \"pll_a\", .dt_id = TEGRA30_CLK_PLL_A },\n\t{ .con_id = \"pll_a_out0\", .dt_id = TEGRA30_CLK_PLL_A_OUT0 },\n\t{ .con_id = \"pll_e\", .dt_id = TEGRA30_CLK_PLL_E },\n\t{ .con_id = \"spdif_in_sync\", .dt_id = TEGRA30_CLK_SPDIF_IN_SYNC },\n\t{ .con_id = \"i2s0_sync\", .dt_id = TEGRA30_CLK_I2S0_SYNC },\n\t{ .con_id = \"i2s1_sync\", .dt_id = TEGRA30_CLK_I2S1_SYNC },\n\t{ .con_id = \"i2s2_sync\", .dt_id = TEGRA30_CLK_I2S2_SYNC },\n\t{ .con_id = \"i2s3_sync\", .dt_id = TEGRA30_CLK_I2S3_SYNC },\n\t{ .con_id = \"i2s4_sync\", .dt_id = TEGRA30_CLK_I2S4_SYNC },\n\t{ .con_id = \"vimclk_sync\", .dt_id = TEGRA30_CLK_VIMCLK_SYNC },\n\t{ .con_id = \"audio0\", .dt_id = TEGRA30_CLK_AUDIO0 },\n\t{ .con_id = \"audio1\", .dt_id = TEGRA30_CLK_AUDIO1 },\n\t{ .con_id = \"audio2\", .dt_id = TEGRA30_CLK_AUDIO2 },\n\t{ .con_id = \"audio3\", .dt_id = TEGRA30_CLK_AUDIO3 },\n\t{ .con_id = \"audio4\", .dt_id = TEGRA30_CLK_AUDIO4 },\n\t{ .con_id = \"spdif\", .dt_id = TEGRA30_CLK_SPDIF },\n\t{ .con_id = \"audio0_2x\", .dt_id = TEGRA30_CLK_AUDIO0_2X },\n\t{ .con_id = \"audio1_2x\", .dt_id = TEGRA30_CLK_AUDIO1_2X },\n\t{ .con_id = \"audio2_2x\", .dt_id = TEGRA30_CLK_AUDIO2_2X },\n\t{ .con_id = \"audio3_2x\", .dt_id = TEGRA30_CLK_AUDIO3_2X },\n\t{ .con_id = \"audio4_2x\", .dt_id = TEGRA30_CLK_AUDIO4_2X },\n\t{ .con_id = \"spdif_2x\", .dt_id = TEGRA30_CLK_SPDIF_2X },\n\t{ .con_id = \"extern1\", .dt_id = TEGRA30_CLK_EXTERN1 },\n\t{ .con_id = \"extern2\", .dt_id = TEGRA30_CLK_EXTERN2 },\n\t{ .con_id = \"extern3\", .dt_id = TEGRA30_CLK_EXTERN3 },\n\t{ .con_id = \"cclk_g\", .dt_id = TEGRA30_CLK_CCLK_G },\n\t{ .con_id = \"cclk_lp\", .dt_id = TEGRA30_CLK_CCLK_LP },\n\t{ .con_id = \"sclk\", .dt_id = TEGRA30_CLK_SCLK },\n\t{ .con_id = \"hclk\", .dt_id = TEGRA30_CLK_HCLK },\n\t{ .con_id = \"pclk\", .dt_id = TEGRA30_CLK_PCLK },\n\t{ .con_id = \"twd\", .dt_id = TEGRA30_CLK_TWD },\n\t{ .con_id = \"emc\", .dt_id = TEGRA30_CLK_EMC },\n\t{ .con_id = \"clk_32k\", .dt_id = TEGRA30_CLK_CLK_32K },\n\t{ .con_id = \"osc\", .dt_id = TEGRA30_CLK_OSC },\n\t{ .con_id = \"osc_div2\", .dt_id = TEGRA30_CLK_OSC_DIV2 },\n\t{ .con_id = \"osc_div4\", .dt_id = TEGRA30_CLK_OSC_DIV4 },\n\t{ .con_id = \"cml0\", .dt_id = TEGRA30_CLK_CML0 },\n\t{ .con_id = \"cml1\", .dt_id = TEGRA30_CLK_CML1 },\n\t{ .con_id = \"clk_m\", .dt_id = TEGRA30_CLK_CLK_M },\n\t{ .con_id = \"pll_ref\", .dt_id = TEGRA30_CLK_PLL_REF },\n\t{ .con_id = \"csus\", .dev_id = \"tengra_camera\", .dt_id = TEGRA30_CLK_CSUS },\n\t{ .con_id = \"vcp\", .dev_id = \"tegra-avp\", .dt_id = TEGRA30_CLK_VCP },\n\t{ .con_id = \"bsea\", .dev_id = \"tegra-avp\", .dt_id = TEGRA30_CLK_BSEA },\n\t{ .con_id = \"bsev\", .dev_id = \"tegra-aes\", .dt_id = TEGRA30_CLK_BSEV },\n\t{ .con_id = \"dsia\", .dev_id = \"tegradc.0\", .dt_id = TEGRA30_CLK_DSIA },\n\t{ .con_id = \"csi\", .dev_id = \"tegra_camera\", .dt_id = TEGRA30_CLK_CSI },\n\t{ .con_id = \"isp\", .dev_id = \"tegra_camera\", .dt_id = TEGRA30_CLK_ISP },\n\t{ .con_id = \"pcie\", .dev_id = \"tegra-pcie\", .dt_id = TEGRA30_CLK_PCIE },\n\t{ .con_id = \"afi\", .dev_id = \"tegra-pcie\", .dt_id = TEGRA30_CLK_AFI },\n\t{ .con_id = \"fuse\", .dt_id = TEGRA30_CLK_FUSE },\n\t{ .con_id = \"fuse_burn\", .dev_id = \"fuse-tegra\", .dt_id = TEGRA30_CLK_FUSE_BURN },\n\t{ .con_id = \"apbif\", .dev_id = \"tegra30-ahub\", .dt_id = TEGRA30_CLK_APBIF },\n\t{ .con_id = \"hda2hdmi\", .dev_id = \"tegra30-hda\", .dt_id = TEGRA30_CLK_HDA2HDMI },\n\t{ .dev_id = \"tegra-apbdma\", .dt_id = TEGRA30_CLK_APBDMA },\n\t{ .dev_id = \"rtc-tegra\", .dt_id = TEGRA30_CLK_RTC },\n\t{ .dev_id = \"timer\", .dt_id = TEGRA30_CLK_TIMER },\n\t{ .dev_id = \"tegra-kbc\", .dt_id = TEGRA30_CLK_KBC },\n\t{ .dev_id = \"fsl-tegra-udc\", .dt_id = TEGRA30_CLK_USBD },\n\t{ .dev_id = \"tegra-ehci.1\", .dt_id = TEGRA30_CLK_USB2 },\n\t{ .dev_id = \"tegra-ehci.2\", .dt_id = TEGRA30_CLK_USB2 },\n\t{ .dev_id = \"kfuse-tegra\", .dt_id = TEGRA30_CLK_KFUSE },\n\t{ .dev_id = \"tegra_sata_cold\", .dt_id = TEGRA30_CLK_SATA_COLD },\n\t{ .dev_id = \"dtv\", .dt_id = TEGRA30_CLK_DTV },\n\t{ .dev_id = \"tegra30-i2s.0\", .dt_id = TEGRA30_CLK_I2S0 },\n\t{ .dev_id = \"tegra30-i2s.1\", .dt_id = TEGRA30_CLK_I2S1 },\n\t{ .dev_id = \"tegra30-i2s.2\", .dt_id = TEGRA30_CLK_I2S2 },\n\t{ .dev_id = \"tegra30-i2s.3\", .dt_id = TEGRA30_CLK_I2S3 },\n\t{ .dev_id = \"tegra30-i2s.4\", .dt_id = TEGRA30_CLK_I2S4 },\n\t{ .con_id = \"spdif_out\", .dev_id = \"tegra30-spdif\", .dt_id = TEGRA30_CLK_SPDIF_OUT },\n\t{ .con_id = \"spdif_in\", .dev_id = \"tegra30-spdif\", .dt_id = TEGRA30_CLK_SPDIF_IN },\n\t{ .con_id = \"d_audio\", .dev_id = \"tegra30-ahub\", .dt_id = TEGRA30_CLK_D_AUDIO },\n\t{ .dev_id = \"tegra30-dam.0\", .dt_id = TEGRA30_CLK_DAM0 },\n\t{ .dev_id = \"tegra30-dam.1\", .dt_id = TEGRA30_CLK_DAM1 },\n\t{ .dev_id = \"tegra30-dam.2\", .dt_id = TEGRA30_CLK_DAM2 },\n\t{ .con_id = \"hda\", .dev_id = \"tegra30-hda\", .dt_id = TEGRA30_CLK_HDA },\n\t{ .con_id = \"hda2codec_2x\", .dev_id = \"tegra30-hda\", .dt_id = TEGRA30_CLK_HDA2CODEC_2X },\n\t{ .dev_id = \"spi_tegra.0\", .dt_id = TEGRA30_CLK_SBC1 },\n\t{ .dev_id = \"spi_tegra.1\", .dt_id = TEGRA30_CLK_SBC2 },\n\t{ .dev_id = \"spi_tegra.2\", .dt_id = TEGRA30_CLK_SBC3 },\n\t{ .dev_id = \"spi_tegra.3\", .dt_id = TEGRA30_CLK_SBC4 },\n\t{ .dev_id = \"spi_tegra.4\", .dt_id = TEGRA30_CLK_SBC5 },\n\t{ .dev_id = \"spi_tegra.5\", .dt_id = TEGRA30_CLK_SBC6 },\n\t{ .dev_id = \"tegra_sata_oob\", .dt_id = TEGRA30_CLK_SATA_OOB },\n\t{ .dev_id = \"tegra_sata\", .dt_id = TEGRA30_CLK_SATA },\n\t{ .dev_id = \"tegra_nand\", .dt_id = TEGRA30_CLK_NDFLASH },\n\t{ .dev_id = \"tegra_nand_speed\", .dt_id = TEGRA30_CLK_NDSPEED },\n\t{ .dev_id = \"vfir\", .dt_id = TEGRA30_CLK_VFIR },\n\t{ .dev_id = \"csite\", .dt_id = TEGRA30_CLK_CSITE },\n\t{ .dev_id = \"la\", .dt_id = TEGRA30_CLK_LA },\n\t{ .dev_id = \"tegra_w1\", .dt_id = TEGRA30_CLK_OWR },\n\t{ .dev_id = \"mipi\", .dt_id = TEGRA30_CLK_MIPI },\n\t{ .dev_id = \"tegra-tsensor\", .dt_id = TEGRA30_CLK_TSENSOR },\n\t{ .dev_id = \"i2cslow\", .dt_id = TEGRA30_CLK_I2CSLOW },\n\t{ .dev_id = \"vde\", .dt_id = TEGRA30_CLK_VDE },\n\t{ .con_id = \"vi\", .dev_id = \"tegra_camera\", .dt_id = TEGRA30_CLK_VI },\n\t{ .dev_id = \"epp\", .dt_id = TEGRA30_CLK_EPP },\n\t{ .dev_id = \"mpe\", .dt_id = TEGRA30_CLK_MPE },\n\t{ .dev_id = \"host1x\", .dt_id = TEGRA30_CLK_HOST1X },\n\t{ .dev_id = \"3d\", .dt_id = TEGRA30_CLK_GR3D },\n\t{ .dev_id = \"3d2\", .dt_id = TEGRA30_CLK_GR3D2 },\n\t{ .dev_id = \"2d\", .dt_id = TEGRA30_CLK_GR2D },\n\t{ .dev_id = \"se\", .dt_id = TEGRA30_CLK_SE },\n\t{ .dev_id = \"mselect\", .dt_id = TEGRA30_CLK_MSELECT },\n\t{ .dev_id = \"tegra-nor\", .dt_id = TEGRA30_CLK_NOR },\n\t{ .dev_id = \"sdhci-tegra.0\", .dt_id = TEGRA30_CLK_SDMMC1 },\n\t{ .dev_id = \"sdhci-tegra.1\", .dt_id = TEGRA30_CLK_SDMMC2 },\n\t{ .dev_id = \"sdhci-tegra.2\", .dt_id = TEGRA30_CLK_SDMMC3 },\n\t{ .dev_id = \"sdhci-tegra.3\", .dt_id = TEGRA30_CLK_SDMMC4 },\n\t{ .dev_id = \"cve\", .dt_id = TEGRA30_CLK_CVE },\n\t{ .dev_id = \"tvo\", .dt_id = TEGRA30_CLK_TVO },\n\t{ .dev_id = \"tvdac\", .dt_id = TEGRA30_CLK_TVDAC },\n\t{ .dev_id = \"actmon\", .dt_id = TEGRA30_CLK_ACTMON },\n\t{ .con_id = \"vi_sensor\", .dev_id = \"tegra_camera\", .dt_id = TEGRA30_CLK_VI_SENSOR },\n\t{ .con_id = \"div-clk\", .dev_id = \"tegra-i2c.0\", .dt_id = TEGRA30_CLK_I2C1 },\n\t{ .con_id = \"div-clk\", .dev_id = \"tegra-i2c.1\", .dt_id = TEGRA30_CLK_I2C2 },\n\t{ .con_id = \"div-clk\", .dev_id = \"tegra-i2c.2\", .dt_id = TEGRA30_CLK_I2C3 },\n\t{ .con_id = \"div-clk\", .dev_id = \"tegra-i2c.3\", .dt_id = TEGRA30_CLK_I2C4 },\n\t{ .con_id = \"div-clk\", .dev_id = \"tegra-i2c.4\", .dt_id = TEGRA30_CLK_I2C5 },\n\t{ .dev_id = \"tegra_uart.0\", .dt_id = TEGRA30_CLK_UARTA },\n\t{ .dev_id = \"tegra_uart.1\", .dt_id = TEGRA30_CLK_UARTB },\n\t{ .dev_id = \"tegra_uart.2\", .dt_id = TEGRA30_CLK_UARTC },\n\t{ .dev_id = \"tegra_uart.3\", .dt_id = TEGRA30_CLK_UARTD },\n\t{ .dev_id = \"tegra_uart.4\", .dt_id = TEGRA30_CLK_UARTE },\n\t{ .dev_id = \"hdmi\", .dt_id = TEGRA30_CLK_HDMI },\n\t{ .dev_id = \"extern1\", .dt_id = TEGRA30_CLK_EXTERN1 },\n\t{ .dev_id = \"extern2\", .dt_id = TEGRA30_CLK_EXTERN2 },\n\t{ .dev_id = \"extern3\", .dt_id = TEGRA30_CLK_EXTERN3 },\n\t{ .dev_id = \"pwm\", .dt_id = TEGRA30_CLK_PWM },\n\t{ .dev_id = \"tegradc.0\", .dt_id = TEGRA30_CLK_DISP1 },\n\t{ .dev_id = \"tegradc.1\", .dt_id = TEGRA30_CLK_DISP2 },\n\t{ .dev_id = \"tegradc.1\", .dt_id = TEGRA30_CLK_DSIB },\n};\n\nstatic struct tegra_clk tegra30_clks[tegra_clk_max] __initdata = {\n\t[tegra_clk_clk_32k] = { .dt_id = TEGRA30_CLK_CLK_32K, .present = true },\n\t[tegra_clk_clk_m] = { .dt_id = TEGRA30_CLK_CLK_M, .present = true },\n\t[tegra_clk_osc] = { .dt_id = TEGRA30_CLK_OSC, .present = true },\n\t[tegra_clk_osc_div2] = { .dt_id = TEGRA30_CLK_OSC_DIV2, .present = true },\n\t[tegra_clk_osc_div4] = { .dt_id = TEGRA30_CLK_OSC_DIV4, .present = true },\n\t[tegra_clk_pll_ref] = { .dt_id = TEGRA30_CLK_PLL_REF, .present = true },\n\t[tegra_clk_spdif_in_sync] = { .dt_id = TEGRA30_CLK_SPDIF_IN_SYNC, .present = true },\n\t[tegra_clk_i2s0_sync] = { .dt_id = TEGRA30_CLK_I2S0_SYNC, .present = true },\n\t[tegra_clk_i2s1_sync] = { .dt_id = TEGRA30_CLK_I2S1_SYNC, .present = true },\n\t[tegra_clk_i2s2_sync] = { .dt_id = TEGRA30_CLK_I2S2_SYNC, .present = true },\n\t[tegra_clk_i2s3_sync] = { .dt_id = TEGRA30_CLK_I2S3_SYNC, .present = true },\n\t[tegra_clk_i2s4_sync] = { .dt_id = TEGRA30_CLK_I2S4_SYNC, .present = true },\n\t[tegra_clk_vimclk_sync] = { .dt_id = TEGRA30_CLK_VIMCLK_SYNC, .present = true },\n\t[tegra_clk_audio0] = { .dt_id = TEGRA30_CLK_AUDIO0, .present = true },\n\t[tegra_clk_audio1] = { .dt_id = TEGRA30_CLK_AUDIO1, .present = true },\n\t[tegra_clk_audio2] = { .dt_id = TEGRA30_CLK_AUDIO2, .present = true },\n\t[tegra_clk_audio3] = { .dt_id = TEGRA30_CLK_AUDIO3, .present = true },\n\t[tegra_clk_audio4] = { .dt_id = TEGRA30_CLK_AUDIO4, .present = true },\n\t[tegra_clk_spdif] = { .dt_id = TEGRA30_CLK_SPDIF, .present = true },\n\t[tegra_clk_audio0_mux] = { .dt_id = TEGRA30_CLK_AUDIO0_MUX, .present = true },\n\t[tegra_clk_audio1_mux] = { .dt_id = TEGRA30_CLK_AUDIO1_MUX, .present = true },\n\t[tegra_clk_audio2_mux] = { .dt_id = TEGRA30_CLK_AUDIO2_MUX, .present = true },\n\t[tegra_clk_audio3_mux] = { .dt_id = TEGRA30_CLK_AUDIO3_MUX, .present = true },\n\t[tegra_clk_audio4_mux] = { .dt_id = TEGRA30_CLK_AUDIO4_MUX, .present = true },\n\t[tegra_clk_spdif_mux] = { .dt_id = TEGRA30_CLK_SPDIF_MUX, .present = true },\n\t[tegra_clk_audio0_2x] = { .dt_id = TEGRA30_CLK_AUDIO0_2X, .present = true },\n\t[tegra_clk_audio1_2x] = { .dt_id = TEGRA30_CLK_AUDIO1_2X, .present = true },\n\t[tegra_clk_audio2_2x] = { .dt_id = TEGRA30_CLK_AUDIO2_2X, .present = true },\n\t[tegra_clk_audio3_2x] = { .dt_id = TEGRA30_CLK_AUDIO3_2X, .present = true },\n\t[tegra_clk_audio4_2x] = { .dt_id = TEGRA30_CLK_AUDIO4_2X, .present = true },\n\t[tegra_clk_spdif_2x] = { .dt_id = TEGRA30_CLK_SPDIF_2X, .present = true },\n\t[tegra_clk_hclk] = { .dt_id = TEGRA30_CLK_HCLK, .present = true },\n\t[tegra_clk_pclk] = { .dt_id = TEGRA30_CLK_PCLK, .present = true },\n\t[tegra_clk_i2s0] = { .dt_id = TEGRA30_CLK_I2S0, .present = true },\n\t[tegra_clk_i2s1] = { .dt_id = TEGRA30_CLK_I2S1, .present = true },\n\t[tegra_clk_i2s2] = { .dt_id = TEGRA30_CLK_I2S2, .present = true },\n\t[tegra_clk_i2s3] = { .dt_id = TEGRA30_CLK_I2S3, .present = true },\n\t[tegra_clk_i2s4] = { .dt_id = TEGRA30_CLK_I2S4, .present = true },\n\t[tegra_clk_spdif_in] = { .dt_id = TEGRA30_CLK_SPDIF_IN, .present = true },\n\t[tegra_clk_hda] = { .dt_id = TEGRA30_CLK_HDA, .present = true },\n\t[tegra_clk_hda2codec_2x] = { .dt_id = TEGRA30_CLK_HDA2CODEC_2X, .present = true },\n\t[tegra_clk_sbc1] = { .dt_id = TEGRA30_CLK_SBC1, .present = true },\n\t[tegra_clk_sbc2] = { .dt_id = TEGRA30_CLK_SBC2, .present = true },\n\t[tegra_clk_sbc3] = { .dt_id = TEGRA30_CLK_SBC3, .present = true },\n\t[tegra_clk_sbc4] = { .dt_id = TEGRA30_CLK_SBC4, .present = true },\n\t[tegra_clk_sbc5] = { .dt_id = TEGRA30_CLK_SBC5, .present = true },\n\t[tegra_clk_sbc6] = { .dt_id = TEGRA30_CLK_SBC6, .present = true },\n\t[tegra_clk_ndflash] = { .dt_id = TEGRA30_CLK_NDFLASH, .present = true },\n\t[tegra_clk_ndspeed] = { .dt_id = TEGRA30_CLK_NDSPEED, .present = true },\n\t[tegra_clk_vfir] = { .dt_id = TEGRA30_CLK_VFIR, .present = true },\n\t[tegra_clk_la] = { .dt_id = TEGRA30_CLK_LA, .present = true },\n\t[tegra_clk_csite] = { .dt_id = TEGRA30_CLK_CSITE, .present = true },\n\t[tegra_clk_owr] = { .dt_id = TEGRA30_CLK_OWR, .present = true },\n\t[tegra_clk_mipi] = { .dt_id = TEGRA30_CLK_MIPI, .present = true },\n\t[tegra_clk_tsensor] = { .dt_id = TEGRA30_CLK_TSENSOR, .present = true },\n\t[tegra_clk_i2cslow] = { .dt_id = TEGRA30_CLK_I2CSLOW, .present = true },\n\t[tegra_clk_vde] = { .dt_id = TEGRA30_CLK_VDE, .present = true },\n\t[tegra_clk_vi] = { .dt_id = TEGRA30_CLK_VI, .present = true },\n\t[tegra_clk_epp] = { .dt_id = TEGRA30_CLK_EPP, .present = true },\n\t[tegra_clk_mpe] = { .dt_id = TEGRA30_CLK_MPE, .present = true },\n\t[tegra_clk_host1x] = { .dt_id = TEGRA30_CLK_HOST1X, .present = true },\n\t[tegra_clk_gr2d] = { .dt_id = TEGRA30_CLK_GR2D, .present = true },\n\t[tegra_clk_gr3d] = { .dt_id = TEGRA30_CLK_GR3D, .present = true },\n\t[tegra_clk_mselect] = { .dt_id = TEGRA30_CLK_MSELECT, .present = true },\n\t[tegra_clk_nor] = { .dt_id = TEGRA30_CLK_NOR, .present = true },\n\t[tegra_clk_sdmmc1] = { .dt_id = TEGRA30_CLK_SDMMC1, .present = true },\n\t[tegra_clk_sdmmc2] = { .dt_id = TEGRA30_CLK_SDMMC2, .present = true },\n\t[tegra_clk_sdmmc3] = { .dt_id = TEGRA30_CLK_SDMMC3, .present = true },\n\t[tegra_clk_sdmmc4] = { .dt_id = TEGRA30_CLK_SDMMC4, .present = true },\n\t[tegra_clk_cve] = { .dt_id = TEGRA30_CLK_CVE, .present = true },\n\t[tegra_clk_tvo] = { .dt_id = TEGRA30_CLK_TVO, .present = true },\n\t[tegra_clk_tvdac] = { .dt_id = TEGRA30_CLK_TVDAC, .present = true },\n\t[tegra_clk_actmon] = { .dt_id = TEGRA30_CLK_ACTMON, .present = true },\n\t[tegra_clk_vi_sensor] = { .dt_id = TEGRA30_CLK_VI_SENSOR, .present = true },\n\t[tegra_clk_i2c1] = { .dt_id = TEGRA30_CLK_I2C1, .present = true },\n\t[tegra_clk_i2c2] = { .dt_id = TEGRA30_CLK_I2C2, .present = true },\n\t[tegra_clk_i2c3] = { .dt_id = TEGRA30_CLK_I2C3, .present = true },\n\t[tegra_clk_i2c4] = { .dt_id = TEGRA30_CLK_I2C4, .present = true },\n\t[tegra_clk_i2c5] = { .dt_id = TEGRA30_CLK_I2C5, .present = true },\n\t[tegra_clk_uarta] = { .dt_id = TEGRA30_CLK_UARTA, .present = true },\n\t[tegra_clk_uartb] = { .dt_id = TEGRA30_CLK_UARTB, .present = true },\n\t[tegra_clk_uartc] = { .dt_id = TEGRA30_CLK_UARTC, .present = true },\n\t[tegra_clk_uartd] = { .dt_id = TEGRA30_CLK_UARTD, .present = true },\n\t[tegra_clk_uarte] = { .dt_id = TEGRA30_CLK_UARTE, .present = true },\n\t[tegra_clk_extern1] = { .dt_id = TEGRA30_CLK_EXTERN1, .present = true },\n\t[tegra_clk_extern2] = { .dt_id = TEGRA30_CLK_EXTERN2, .present = true },\n\t[tegra_clk_extern3] = { .dt_id = TEGRA30_CLK_EXTERN3, .present = true },\n\t[tegra_clk_disp1] = { .dt_id = TEGRA30_CLK_DISP1, .present = true },\n\t[tegra_clk_disp2] = { .dt_id = TEGRA30_CLK_DISP2, .present = true },\n\t[tegra_clk_ahbdma] = { .dt_id = TEGRA30_CLK_AHBDMA, .present = true },\n\t[tegra_clk_apbdma] = { .dt_id = TEGRA30_CLK_APBDMA, .present = true },\n\t[tegra_clk_rtc] = { .dt_id = TEGRA30_CLK_RTC, .present = true },\n\t[tegra_clk_timer] = { .dt_id = TEGRA30_CLK_TIMER, .present = true },\n\t[tegra_clk_kbc] = { .dt_id = TEGRA30_CLK_KBC, .present = true },\n\t[tegra_clk_csus] = { .dt_id = TEGRA30_CLK_CSUS, .present = true },\n\t[tegra_clk_vcp] = { .dt_id = TEGRA30_CLK_VCP, .present = true },\n\t[tegra_clk_bsea] = { .dt_id = TEGRA30_CLK_BSEA, .present = true },\n\t[tegra_clk_bsev] = { .dt_id = TEGRA30_CLK_BSEV, .present = true },\n\t[tegra_clk_usbd] = { .dt_id = TEGRA30_CLK_USBD, .present = true },\n\t[tegra_clk_usb2] = { .dt_id = TEGRA30_CLK_USB2, .present = true },\n\t[tegra_clk_usb3] = { .dt_id = TEGRA30_CLK_USB3, .present = true },\n\t[tegra_clk_csi] = { .dt_id = TEGRA30_CLK_CSI, .present = true },\n\t[tegra_clk_isp] = { .dt_id = TEGRA30_CLK_ISP, .present = true },\n\t[tegra_clk_kfuse] = { .dt_id = TEGRA30_CLK_KFUSE, .present = true },\n\t[tegra_clk_fuse] = { .dt_id = TEGRA30_CLK_FUSE, .present = true },\n\t[tegra_clk_fuse_burn] = { .dt_id = TEGRA30_CLK_FUSE_BURN, .present = true },\n\t[tegra_clk_apbif] = { .dt_id = TEGRA30_CLK_APBIF, .present = true },\n\t[tegra_clk_hda2hdmi] = { .dt_id = TEGRA30_CLK_HDA2HDMI, .present = true },\n\t[tegra_clk_sata_cold] = { .dt_id = TEGRA30_CLK_SATA_COLD, .present = true },\n\t[tegra_clk_sata_oob] = { .dt_id = TEGRA30_CLK_SATA_OOB, .present = true },\n\t[tegra_clk_sata] = { .dt_id = TEGRA30_CLK_SATA, .present = true },\n\t[tegra_clk_dtv] = { .dt_id = TEGRA30_CLK_DTV, .present = true },\n\t[tegra_clk_pll_p] = { .dt_id = TEGRA30_CLK_PLL_P, .present = true },\n\t[tegra_clk_pll_p_out1] = { .dt_id = TEGRA30_CLK_PLL_P_OUT1, .present = true },\n\t[tegra_clk_pll_p_out2] = { .dt_id = TEGRA30_CLK_PLL_P_OUT2, .present = true },\n\t[tegra_clk_pll_p_out3] = { .dt_id = TEGRA30_CLK_PLL_P_OUT3, .present = true },\n\t[tegra_clk_pll_p_out4] = { .dt_id = TEGRA30_CLK_PLL_P_OUT4, .present = true },\n\t[tegra_clk_pll_a] = { .dt_id = TEGRA30_CLK_PLL_A, .present = true },\n\t[tegra_clk_pll_a_out0] = { .dt_id = TEGRA30_CLK_PLL_A_OUT0, .present = true },\n\t[tegra_clk_cec] = { .dt_id = TEGRA30_CLK_CEC, .present = true },\n\t[tegra_clk_emc] = { .dt_id = TEGRA30_CLK_EMC, .present = false },\n};\n\nstatic const char *pll_e_parents[] = { \"pll_ref\", \"pll_p\" };\n\nstatic void __init tegra30_pll_init(void)\n{\n\tstruct clk *clk;\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_c_out1_div\", \"pll_c\",\n\t\t\t\tclk_base + PLLC_OUT, 0, TEGRA_DIVIDER_ROUND_UP,\n\t\t\t\t8, 8, 1, NULL);\n\tclk = tegra_clk_register_pll_out(\"pll_c_out1\", \"pll_c_out1_div\",\n\t\t\t\tclk_base + PLLC_OUT, 1, 0, CLK_SET_RATE_PARENT,\n\t\t\t\t0, NULL);\n\tclks[TEGRA30_CLK_PLL_C_OUT1] = clk;\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_m_out1_div\", \"pll_m\",\n\t\t\t\tclk_base + PLLM_OUT, 0, TEGRA_DIVIDER_ROUND_UP,\n\t\t\t\t8, 8, 1, NULL);\n\tclk = tegra_clk_register_pll_out(\"pll_m_out1\", \"pll_m_out1_div\",\n\t\t\t\tclk_base + PLLM_OUT, 1, 0,\n\t\t\t\tCLK_SET_RATE_PARENT, 0, NULL);\n\tclks[TEGRA30_CLK_PLL_M_OUT1] = clk;\n\n\t \n\tclk = tegra_clk_register_pll(\"pll_x\", \"pll_ref\", clk_base, pmc_base, 0,\n\t\t\t    &pll_x_params, NULL);\n\tclks[TEGRA30_CLK_PLL_X] = clk;\n\n\t \n\tclk = clk_register_fixed_factor(NULL, \"pll_x_out0\", \"pll_x\",\n\t\t\t\t\tCLK_SET_RATE_PARENT, 1, 2);\n\tclks[TEGRA30_CLK_PLL_X_OUT0] = clk;\n\n\t \n\tclk = tegra_clk_register_pllu(\"pll_u\", \"pll_ref\", clk_base, 0,\n\t\t\t\t      &pll_u_params, NULL);\n\tclks[TEGRA30_CLK_PLL_U] = clk;\n\n\t \n\tclk = tegra_clk_register_pll(\"pll_d\", \"pll_ref\", clk_base, pmc_base, 0,\n\t\t\t    &pll_d_params, &pll_d_lock);\n\tclks[TEGRA30_CLK_PLL_D] = clk;\n\n\t \n\tclk = clk_register_fixed_factor(NULL, \"pll_d_out0\", \"pll_d\",\n\t\t\t\t\tCLK_SET_RATE_PARENT, 1, 2);\n\tclks[TEGRA30_CLK_PLL_D_OUT0] = clk;\n\n\t \n\tclk = tegra_clk_register_pll(\"pll_d2\", \"pll_ref\", clk_base, pmc_base, 0,\n\t\t\t    &pll_d2_params, NULL);\n\tclks[TEGRA30_CLK_PLL_D2] = clk;\n\n\t \n\tclk = clk_register_fixed_factor(NULL, \"pll_d2_out0\", \"pll_d2\",\n\t\t\t\t\tCLK_SET_RATE_PARENT, 1, 2);\n\tclks[TEGRA30_CLK_PLL_D2_OUT0] = clk;\n\n\t \n\tclk = clk_register_mux(NULL, \"pll_e_mux\", pll_e_parents,\n\t\t\t       ARRAY_SIZE(pll_e_parents),\n\t\t\t       CLK_SET_RATE_NO_REPARENT,\n\t\t\t       clk_base + PLLE_AUX, 2, 1, 0, NULL);\n}\n\nstatic const char *cclk_g_parents[] = { \"clk_m\", \"pll_c\", \"clk_32k\", \"pll_m\",\n\t\t\t\t\t\"pll_p_cclkg\", \"pll_p_out4_cclkg\",\n\t\t\t\t\t\"pll_p_out3_cclkg\", \"unused\", \"pll_x\" };\nstatic const char *cclk_lp_parents[] = { \"clk_m\", \"pll_c\", \"clk_32k\", \"pll_m\",\n\t\t\t\t\t \"pll_p_cclklp\", \"pll_p_out4_cclklp\",\n\t\t\t\t\t \"pll_p_out3_cclklp\", \"unused\", \"pll_x\",\n\t\t\t\t\t \"pll_x_out0\" };\nstatic const char *sclk_parents[] = { \"clk_m\", \"pll_c_out1\", \"pll_p_out4\",\n\t\t\t\t      \"pll_p_out3\", \"pll_p_out2\", \"unused\",\n\t\t\t\t      \"clk_32k\", \"pll_m_out1\" };\n\nstatic void __init tegra30_super_clk_init(void)\n{\n\tstruct clk *clk;\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_p_cclkg\", \"pll_p\",\n\t\t\t\tclk_base + SUPER_CCLKG_DIVIDER, 0,\n\t\t\t\tTEGRA_DIVIDER_INT, 16, 8, 1, NULL);\n\tclk_register_clkdev(clk, \"pll_p_cclkg\", NULL);\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_p_out3_cclkg\", \"pll_p_out3\",\n\t\t\t\tclk_base + SUPER_CCLKG_DIVIDER, 0,\n\t\t\t\tTEGRA_DIVIDER_INT, 16, 8, 1, NULL);\n\tclk_register_clkdev(clk, \"pll_p_out3_cclkg\", NULL);\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_p_out4_cclkg\", \"pll_p_out4\",\n\t\t\t\tclk_base + SUPER_CCLKG_DIVIDER, 0,\n\t\t\t\tTEGRA_DIVIDER_INT, 16, 8, 1, NULL);\n\tclk_register_clkdev(clk, \"pll_p_out4_cclkg\", NULL);\n\n\t \n\tclk = tegra_clk_register_super_cclk(\"cclk_g\", cclk_g_parents,\n\t\t\t\t  ARRAY_SIZE(cclk_g_parents),\n\t\t\t\t  CLK_SET_RATE_PARENT | CLK_GET_RATE_NOCACHE,\n\t\t\t\t  clk_base + CCLKG_BURST_POLICY,\n\t\t\t\t  0, NULL);\n\tclks[TEGRA30_CLK_CCLK_G] = clk;\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_p_cclklp\", \"pll_p\",\n\t\t\t\tclk_base + SUPER_CCLKLP_DIVIDER, 0,\n\t\t\t\tTEGRA_DIVIDER_INT, 16, 8, 1, NULL);\n\tclk_register_clkdev(clk, \"pll_p_cclklp\", NULL);\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_p_out3_cclklp\", \"pll_p_out3\",\n\t\t\t\tclk_base + SUPER_CCLKLP_DIVIDER, 0,\n\t\t\t\tTEGRA_DIVIDER_INT, 16, 8, 1, NULL);\n\tclk_register_clkdev(clk, \"pll_p_out3_cclklp\", NULL);\n\n\t \n\tclk = tegra_clk_register_divider(\"pll_p_out4_cclklp\", \"pll_p_out4\",\n\t\t\t\tclk_base + SUPER_CCLKLP_DIVIDER, 0,\n\t\t\t\tTEGRA_DIVIDER_INT, 16, 8, 1, NULL);\n\tclk_register_clkdev(clk, \"pll_p_out4_cclklp\", NULL);\n\n\t \n\tclk = tegra_clk_register_super_mux(\"cclk_lp\", cclk_lp_parents,\n\t\t\t\t  ARRAY_SIZE(cclk_lp_parents),\n\t\t\t\t  CLK_SET_RATE_PARENT,\n\t\t\t\t  clk_base + CCLKLP_BURST_POLICY,\n\t\t\t\t  TEGRA_DIVIDER_2, 4, 8, 9,\n\t\t\t      NULL);\n\tclks[TEGRA30_CLK_CCLK_LP] = clk;\n\n\t \n\tclk = clk_register_fixed_factor(NULL, \"twd\", \"cclk_g\",\n\t\t\t\t\tCLK_SET_RATE_PARENT, 1, 2);\n\tclks[TEGRA30_CLK_TWD] = clk;\n\n\ttegra_super_clk_gen4_init(clk_base, pmc_base, tegra30_clks, NULL);\n}\n\nstatic const char *mux_pllacp_clkm[] = { \"pll_a_out0\", \"unused\", \"pll_p\",\n\t\t\t\t\t \"clk_m\" };\nstatic const char *mux_pllpcm_clkm[] = { \"pll_p\", \"pll_c\", \"pll_m\", \"clk_m\" };\nstatic const char *spdif_out_parents[] = { \"pll_a_out0\", \"spdif_2x\", \"pll_p\",\n\t\t\t\t\t   \"clk_m\" };\nstatic const char *mux_pllmcpa[] = { \"pll_m\", \"pll_c\", \"pll_p\", \"pll_a_out0\" };\nstatic const char *mux_pllpmdacd2_clkm[] = { \"pll_p\", \"pll_m\", \"pll_d_out0\",\n\t\t\t\t\t     \"pll_a_out0\", \"pll_c\",\n\t\t\t\t\t     \"pll_d2_out0\", \"clk_m\" };\nstatic const char *mux_plld_out0_plld2_out0[] = { \"pll_d_out0\",\n\t\t\t\t\t\t  \"pll_d2_out0\" };\nstatic const char *pwm_parents[] = { \"pll_p\", \"pll_c\", \"clk_32k\", \"clk_m\" };\n\nstatic struct tegra_periph_init_data tegra_periph_clk_list[] = {\n\tTEGRA_INIT_DATA_MUX(\"spdif_out\", spdif_out_parents, CLK_SOURCE_SPDIF_OUT, 10, TEGRA_PERIPH_ON_APB, TEGRA30_CLK_SPDIF_OUT),\n\tTEGRA_INIT_DATA_MUX(\"d_audio\", mux_pllacp_clkm, CLK_SOURCE_D_AUDIO, 106, 0, TEGRA30_CLK_D_AUDIO),\n\tTEGRA_INIT_DATA_MUX(\"dam0\", mux_pllacp_clkm, CLK_SOURCE_DAM0, 108, 0, TEGRA30_CLK_DAM0),\n\tTEGRA_INIT_DATA_MUX(\"dam1\", mux_pllacp_clkm, CLK_SOURCE_DAM1, 109, 0, TEGRA30_CLK_DAM1),\n\tTEGRA_INIT_DATA_MUX(\"dam2\", mux_pllacp_clkm, CLK_SOURCE_DAM2, 110, 0, TEGRA30_CLK_DAM2),\n\tTEGRA_INIT_DATA_INT(\"3d2\", mux_pllmcpa, CLK_SOURCE_3D2, 98, 0, TEGRA30_CLK_GR3D2),\n\tTEGRA_INIT_DATA_INT(\"se\", mux_pllpcm_clkm, CLK_SOURCE_SE, 127, 0, TEGRA30_CLK_SE),\n\tTEGRA_INIT_DATA_MUX8(\"hdmi\", mux_pllpmdacd2_clkm, CLK_SOURCE_HDMI, 51, 0, TEGRA30_CLK_HDMI),\n\tTEGRA_INIT_DATA(\"pwm\", NULL, NULL, pwm_parents, CLK_SOURCE_PWM, 28, 2, 0, 0, 8, 1, 0, 17, TEGRA_PERIPH_ON_APB, TEGRA30_CLK_PWM),\n};\n\nstatic struct tegra_periph_init_data tegra_periph_nodiv_clk_list[] = {\n\tTEGRA_INIT_DATA_NODIV(\"dsib\", mux_plld_out0_plld2_out0, CLK_SOURCE_DSIB, 25, 1, 82, 0, TEGRA30_CLK_DSIB),\n};\n\nstatic void __init tegra30_periph_clk_init(void)\n{\n\tstruct tegra_periph_init_data *data;\n\tstruct clk *clk;\n\tunsigned int i;\n\n\t \n\tclk = tegra_clk_register_periph_gate(\"dsia\", \"pll_d_out0\", 0, clk_base,\n\t\t\t\t    0, 48, periph_clk_enb_refcnt);\n\tclks[TEGRA30_CLK_DSIA] = clk;\n\n\t \n\tclk = tegra_clk_register_periph_gate(\"pcie\", \"clk_m\", 0, clk_base, 0,\n\t\t\t\t    70, periph_clk_enb_refcnt);\n\tclks[TEGRA30_CLK_PCIE] = clk;\n\n\t \n\tclk = tegra_clk_register_periph_gate(\"afi\", \"clk_m\", 0, clk_base, 0, 72,\n\t\t\t\t    periph_clk_enb_refcnt);\n\tclks[TEGRA30_CLK_AFI] = clk;\n\n\t \n\tclk = tegra20_clk_register_emc(clk_base + CLK_SOURCE_EMC, true);\n\n\tclks[TEGRA30_CLK_EMC] = clk;\n\n\tclk = tegra_clk_register_mc(\"mc\", \"emc\", clk_base + CLK_SOURCE_EMC,\n\t\t\t\t    NULL);\n\tclks[TEGRA30_CLK_MC] = clk;\n\n\t \n\tclk = clk_register_gate(NULL, \"cml0\", \"pll_e\", 0, clk_base + PLLE_AUX,\n\t\t\t\t0, 0, &cml_lock);\n\tclks[TEGRA30_CLK_CML0] = clk;\n\n\t \n\tclk = clk_register_gate(NULL, \"cml1\", \"pll_e\", 0, clk_base + PLLE_AUX,\n\t\t\t\t1, 0, &cml_lock);\n\tclks[TEGRA30_CLK_CML1] = clk;\n\n\tfor (i = 0; i < ARRAY_SIZE(tegra_periph_clk_list); i++) {\n\t\tdata = &tegra_periph_clk_list[i];\n\t\tclk = tegra_clk_register_periph_data(clk_base, data);\n\t\tclks[data->clk_id] = clk;\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(tegra_periph_nodiv_clk_list); i++) {\n\t\tdata = &tegra_periph_nodiv_clk_list[i];\n\t\tclk = tegra_clk_register_periph_nodiv(data->name,\n\t\t\t\t\tdata->p.parent_names,\n\t\t\t\t\tdata->num_parents, &data->periph,\n\t\t\t\t\tclk_base, data->offset);\n\t\tclks[data->clk_id] = clk;\n\t}\n\n\ttegra_periph_clk_init(clk_base, pmc_base, tegra30_clks, &pll_p_params);\n}\n\n \nstatic void tegra30_wait_cpu_in_reset(u32 cpu)\n{\n\tunsigned int reg;\n\n\tdo {\n\t\treg = readl(clk_base +\n\t\t\t    TEGRA30_CLK_RST_CONTROLLER_CPU_CMPLX_STATUS);\n\t\tcpu_relax();\n\t} while (!(reg & (1 << cpu)));\t \n\n\treturn;\n}\n\nstatic void tegra30_put_cpu_in_reset(u32 cpu)\n{\n\twritel(CPU_RESET(cpu),\n\t       clk_base + TEGRA_CLK_RST_CONTROLLER_RST_CPU_CMPLX_SET);\n\tdmb();\n}\n\nstatic void tegra30_cpu_out_of_reset(u32 cpu)\n{\n\twritel(CPU_RESET(cpu),\n\t       clk_base + TEGRA_CLK_RST_CONTROLLER_RST_CPU_CMPLX_CLR);\n\twmb();\n}\n\nstatic void tegra30_enable_cpu_clock(u32 cpu)\n{\n\twritel(CPU_CLOCK(cpu),\n\t       clk_base + TEGRA30_CLK_RST_CONTROLLER_CLK_CPU_CMPLX_CLR);\n\treadl(clk_base + TEGRA30_CLK_RST_CONTROLLER_CLK_CPU_CMPLX_CLR);\n}\n\nstatic void tegra30_disable_cpu_clock(u32 cpu)\n{\n\tunsigned int reg;\n\n\treg = readl(clk_base + TEGRA_CLK_RST_CONTROLLER_CLK_CPU_CMPLX);\n\twritel(reg | CPU_CLOCK(cpu),\n\t       clk_base + TEGRA_CLK_RST_CONTROLLER_CLK_CPU_CMPLX);\n}\n\n#ifdef CONFIG_PM_SLEEP\nstatic bool tegra30_cpu_rail_off_ready(void)\n{\n\tunsigned int cpu_rst_status;\n\tint cpu_pwr_status;\n\n\tcpu_rst_status = readl(clk_base +\n\t\t\t\tTEGRA30_CLK_RST_CONTROLLER_CPU_CMPLX_STATUS);\n\tcpu_pwr_status = tegra_pmc_cpu_is_powered(1) ||\n\t\t\t tegra_pmc_cpu_is_powered(2) ||\n\t\t\t tegra_pmc_cpu_is_powered(3);\n\n\tif (((cpu_rst_status & 0xE) != 0xE) || cpu_pwr_status)\n\t\treturn false;\n\n\treturn true;\n}\n\nstatic void tegra30_cpu_clock_suspend(void)\n{\n\t \n\ttegra30_cpu_clk_sctx.clk_csite_src =\n\t\t\t\treadl(clk_base + CLK_RESET_SOURCE_CSITE);\n\twritel(3 << 30, clk_base + CLK_RESET_SOURCE_CSITE);\n\n\ttegra30_cpu_clk_sctx.cpu_burst =\n\t\t\t\treadl(clk_base + CLK_RESET_CCLK_BURST);\n\ttegra30_cpu_clk_sctx.pllx_base =\n\t\t\t\treadl(clk_base + CLK_RESET_PLLX_BASE);\n\ttegra30_cpu_clk_sctx.pllx_misc =\n\t\t\t\treadl(clk_base + CLK_RESET_PLLX_MISC);\n\ttegra30_cpu_clk_sctx.cclk_divider =\n\t\t\t\treadl(clk_base + CLK_RESET_CCLK_DIVIDER);\n}\n\nstatic void tegra30_cpu_clock_resume(void)\n{\n\tunsigned int reg, policy;\n\tu32 misc, base;\n\n\t \n\treg = readl(clk_base + CLK_RESET_CCLK_BURST);\n\tpolicy = (reg >> CLK_RESET_CCLK_BURST_POLICY_SHIFT) & 0xF;\n\n\tif (policy == CLK_RESET_CCLK_IDLE_POLICY)\n\t\treg = (reg >> CLK_RESET_CCLK_IDLE_POLICY_SHIFT) & 0xF;\n\telse if (policy == CLK_RESET_CCLK_RUN_POLICY)\n\t\treg = (reg >> CLK_RESET_CCLK_RUN_POLICY_SHIFT) & 0xF;\n\telse\n\t\tBUG();\n\n\tif (reg != CLK_RESET_CCLK_BURST_POLICY_PLLX) {\n\t\tmisc = readl_relaxed(clk_base + CLK_RESET_PLLX_MISC);\n\t\tbase = readl_relaxed(clk_base + CLK_RESET_PLLX_BASE);\n\n\t\tif (misc != tegra30_cpu_clk_sctx.pllx_misc ||\n\t\t    base != tegra30_cpu_clk_sctx.pllx_base) {\n\t\t\t \n\t\t\twritel(tegra30_cpu_clk_sctx.pllx_misc,\n\t\t\t\t\t\tclk_base + CLK_RESET_PLLX_MISC);\n\t\t\twritel(tegra30_cpu_clk_sctx.pllx_base,\n\t\t\t\t\t\tclk_base + CLK_RESET_PLLX_BASE);\n\n\t\t\t \n\t\t\tif (tegra30_cpu_clk_sctx.pllx_base & (1 << 30))\n\t\t\t\tudelay(300);\n\t\t}\n\t}\n\n\t \n\twritel(tegra30_cpu_clk_sctx.cclk_divider,\n\t\t\t\t\tclk_base + CLK_RESET_CCLK_DIVIDER);\n\twritel(tegra30_cpu_clk_sctx.cpu_burst,\n\t\t\t\t\tclk_base + CLK_RESET_CCLK_BURST);\n\n\twritel(tegra30_cpu_clk_sctx.clk_csite_src,\n\t\t\t\t\tclk_base + CLK_RESET_SOURCE_CSITE);\n}\n#endif\n\nstatic struct tegra_cpu_car_ops tegra30_cpu_car_ops = {\n\t.wait_for_reset\t= tegra30_wait_cpu_in_reset,\n\t.put_in_reset\t= tegra30_put_cpu_in_reset,\n\t.out_of_reset\t= tegra30_cpu_out_of_reset,\n\t.enable_clock\t= tegra30_enable_cpu_clock,\n\t.disable_clock\t= tegra30_disable_cpu_clock,\n#ifdef CONFIG_PM_SLEEP\n\t.rail_off_ready\t= tegra30_cpu_rail_off_ready,\n\t.suspend\t= tegra30_cpu_clock_suspend,\n\t.resume\t\t= tegra30_cpu_clock_resume,\n#endif\n};\n\nstatic struct tegra_clk_init_table init_table[] = {\n\t{ TEGRA30_CLK_UARTA, TEGRA30_CLK_PLL_P, 408000000, 0 },\n\t{ TEGRA30_CLK_UARTB, TEGRA30_CLK_PLL_P, 408000000, 0 },\n\t{ TEGRA30_CLK_UARTC, TEGRA30_CLK_PLL_P, 408000000, 0 },\n\t{ TEGRA30_CLK_UARTD, TEGRA30_CLK_PLL_P, 408000000, 0 },\n\t{ TEGRA30_CLK_UARTE, TEGRA30_CLK_PLL_P, 408000000, 0 },\n\t{ TEGRA30_CLK_PLL_A, TEGRA30_CLK_CLK_MAX, 564480000, 0 },\n\t{ TEGRA30_CLK_PLL_A_OUT0, TEGRA30_CLK_CLK_MAX, 11289600, 0 },\n\t{ TEGRA30_CLK_I2S0, TEGRA30_CLK_PLL_A_OUT0, 11289600, 0 },\n\t{ TEGRA30_CLK_I2S1, TEGRA30_CLK_PLL_A_OUT0, 11289600, 0 },\n\t{ TEGRA30_CLK_I2S2, TEGRA30_CLK_PLL_A_OUT0, 11289600, 0 },\n\t{ TEGRA30_CLK_I2S3, TEGRA30_CLK_PLL_A_OUT0, 11289600, 0 },\n\t{ TEGRA30_CLK_I2S4, TEGRA30_CLK_PLL_A_OUT0, 11289600, 0 },\n\t{ TEGRA30_CLK_SDMMC1, TEGRA30_CLK_PLL_P, 48000000, 0 },\n\t{ TEGRA30_CLK_SDMMC2, TEGRA30_CLK_PLL_P, 48000000, 0 },\n\t{ TEGRA30_CLK_SDMMC3, TEGRA30_CLK_PLL_P, 48000000, 0 },\n\t{ TEGRA30_CLK_CSITE, TEGRA30_CLK_CLK_MAX, 0, 1 },\n\t{ TEGRA30_CLK_MSELECT, TEGRA30_CLK_CLK_MAX, 0, 1 },\n\t{ TEGRA30_CLK_SBC1, TEGRA30_CLK_PLL_P, 100000000, 0 },\n\t{ TEGRA30_CLK_SBC2, TEGRA30_CLK_PLL_P, 100000000, 0 },\n\t{ TEGRA30_CLK_SBC3, TEGRA30_CLK_PLL_P, 100000000, 0 },\n\t{ TEGRA30_CLK_SBC4, TEGRA30_CLK_PLL_P, 100000000, 0 },\n\t{ TEGRA30_CLK_SBC5, TEGRA30_CLK_PLL_P, 100000000, 0 },\n\t{ TEGRA30_CLK_SBC6, TEGRA30_CLK_PLL_P, 100000000, 0 },\n\t{ TEGRA30_CLK_PLL_C, TEGRA30_CLK_CLK_MAX, 600000000, 0 },\n\t{ TEGRA30_CLK_HOST1X, TEGRA30_CLK_PLL_C, 150000000, 0 },\n\t{ TEGRA30_CLK_TWD, TEGRA30_CLK_CLK_MAX, 0, 1 },\n\t{ TEGRA30_CLK_GR2D, TEGRA30_CLK_PLL_C, 300000000, 0 },\n\t{ TEGRA30_CLK_GR3D, TEGRA30_CLK_PLL_C, 300000000, 0 },\n\t{ TEGRA30_CLK_GR3D2, TEGRA30_CLK_PLL_C, 300000000, 0 },\n\t{ TEGRA30_CLK_PLL_U, TEGRA30_CLK_CLK_MAX, 480000000, 0 },\n\t{ TEGRA30_CLK_VDE, TEGRA30_CLK_PLL_C, 300000000, 0 },\n\t{ TEGRA30_CLK_SPDIF_IN_SYNC, TEGRA30_CLK_CLK_MAX, 24000000, 0 },\n\t{ TEGRA30_CLK_I2S0_SYNC, TEGRA30_CLK_CLK_MAX, 24000000, 0 },\n\t{ TEGRA30_CLK_I2S1_SYNC, TEGRA30_CLK_CLK_MAX, 24000000, 0 },\n\t{ TEGRA30_CLK_I2S2_SYNC, TEGRA30_CLK_CLK_MAX, 24000000, 0 },\n\t{ TEGRA30_CLK_I2S3_SYNC, TEGRA30_CLK_CLK_MAX, 24000000, 0 },\n\t{ TEGRA30_CLK_I2S4_SYNC, TEGRA30_CLK_CLK_MAX, 24000000, 0 },\n\t{ TEGRA30_CLK_VIMCLK_SYNC, TEGRA30_CLK_CLK_MAX, 24000000, 0 },\n\t{ TEGRA30_CLK_HDA, TEGRA30_CLK_PLL_P, 102000000, 0 },\n\t{ TEGRA30_CLK_HDA2CODEC_2X, TEGRA30_CLK_PLL_P, 48000000, 0 },\n\t{ TEGRA30_CLK_PWM, TEGRA30_CLK_PLL_P, 48000000, 0 },\n\t \n\t{ TEGRA30_CLK_CLK_MAX, TEGRA30_CLK_CLK_MAX, 0, 0 },\n};\n\n \nstatic struct tegra_clk_duplicate tegra_clk_duplicates[] = {\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_USBD, \"utmip-pad\", NULL),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_USBD, \"tegra-ehci.0\", NULL),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_USBD, \"tegra-otg\", NULL),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_BSEV, \"tegra-avp\", \"bsev\"),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_BSEV, \"nvavp\", \"bsev\"),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_VDE, \"tegra-aes\", \"vde\"),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_BSEA, \"tegra-aes\", \"bsea\"),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_BSEA, \"nvavp\", \"bsea\"),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_CML1, \"tegra_sata_cml\", NULL),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_CML0, \"tegra_pcie\", \"cml\"),\n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_VCP, \"nvavp\", \"vcp\"),\n\t \n\tTEGRA_CLK_DUPLICATE(TEGRA30_CLK_CLK_MAX, NULL, NULL),\n};\n\nstatic const struct of_device_id pmc_match[] __initconst = {\n\t{ .compatible = \"nvidia,tegra30-pmc\" },\n\t{ },\n};\n\nstatic struct tegra_audio_clk_info tegra30_audio_plls[] = {\n\t{ \"pll_a\", &pll_a_params, tegra_clk_pll_a, \"pll_p_out1\" },\n};\n\nstatic bool tegra30_car_initialized;\n\nstatic struct clk *tegra30_clk_src_onecell_get(struct of_phandle_args *clkspec,\n\t\t\t\t\t       void *data)\n{\n\tstruct clk_hw *hw;\n\tstruct clk *clk;\n\n\t \n\tif (clkspec->args[0] != TEGRA30_CLK_RTC &&\n\t    clkspec->args[0] != TEGRA30_CLK_TWD &&\n\t    clkspec->args[0] != TEGRA30_CLK_TIMER &&\n\t    !tegra30_car_initialized)\n\t\treturn ERR_PTR(-EPROBE_DEFER);\n\n\tclk = of_clk_src_onecell_get(clkspec, data);\n\tif (IS_ERR(clk))\n\t\treturn clk;\n\n\thw = __clk_get_hw(clk);\n\n\tif (clkspec->args[0] == TEGRA30_CLK_EMC) {\n\t\tif (!tegra20_clk_emc_driver_available(hw))\n\t\t\treturn ERR_PTR(-EPROBE_DEFER);\n\t}\n\n\treturn clk;\n}\n\nstatic void __init tegra30_clock_init(struct device_node *np)\n{\n\tstruct device_node *node;\n\n\tclk_base = of_iomap(np, 0);\n\tif (!clk_base) {\n\t\tpr_err(\"ioremap tegra30 CAR failed\\n\");\n\t\treturn;\n\t}\n\n\tnode = of_find_matching_node(NULL, pmc_match);\n\tif (!node) {\n\t\tpr_err(\"Failed to find pmc node\\n\");\n\t\tBUG();\n\t}\n\n\tpmc_base = of_iomap(node, 0);\n\tof_node_put(node);\n\tif (!pmc_base) {\n\t\tpr_err(\"Can't map pmc registers\\n\");\n\t\tBUG();\n\t}\n\n\tclks = tegra_clk_init(clk_base, TEGRA30_CLK_CLK_MAX,\n\t\t\t\tTEGRA30_CLK_PERIPH_BANKS);\n\tif (!clks)\n\t\treturn;\n\n\tif (tegra_osc_clk_init(clk_base, tegra30_clks, tegra30_input_freq,\n\t\t\t       ARRAY_SIZE(tegra30_input_freq), 1, &input_freq,\n\t\t\t       NULL) < 0)\n\t\treturn;\n\n\ttegra_fixed_clk_init(tegra30_clks);\n\ttegra30_pll_init();\n\ttegra30_super_clk_init();\n\ttegra30_periph_clk_init();\n\ttegra_audio_clk_init(clk_base, pmc_base, tegra30_clks,\n\t\t\t     tegra30_audio_plls,\n\t\t\t     ARRAY_SIZE(tegra30_audio_plls), 24000000);\n\n\ttegra_init_dup_clks(tegra_clk_duplicates, clks, TEGRA30_CLK_CLK_MAX);\n\n\ttegra_add_of_provider(np, tegra30_clk_src_onecell_get);\n\n\ttegra_cpu_car_ops = &tegra30_cpu_car_ops;\n}\nCLK_OF_DECLARE_DRIVER(tegra30, \"nvidia,tegra30-car\", tegra30_clock_init);\n\n \nstatic int tegra30_car_probe(struct platform_device *pdev)\n{\n\tstruct clk *clk;\n\n\t \n\tclk = tegra_clk_register_pll(\"pll_c\", \"pll_ref\", clk_base, pmc_base, 0,\n\t\t\t\t     &pll_c_params, NULL);\n\tclks[TEGRA30_CLK_PLL_C] = clk;\n\n\t \n\tclk = tegra_clk_register_plle(\"pll_e\", \"pll_e_mux\", clk_base, pmc_base,\n\t\t\t\t      CLK_GET_RATE_NOCACHE, &pll_e_params, NULL);\n\tclks[TEGRA30_CLK_PLL_E] = clk;\n\n\t \n\tclk = tegra_clk_register_pll(\"pll_m\", \"pll_ref\", clk_base, pmc_base,\n\t\t\t\t     CLK_SET_RATE_GATE, &pll_m_params, NULL);\n\tclks[TEGRA30_CLK_PLL_M] = clk;\n\n\t \n\tclk = tegra_clk_register_super_mux(\"sclk\", sclk_parents,\n\t\t\t\t\t   ARRAY_SIZE(sclk_parents),\n\t\t\t\t\t   CLK_SET_RATE_PARENT | CLK_IS_CRITICAL,\n\t\t\t\t\t   clk_base + SCLK_BURST_POLICY,\n\t\t\t\t\t   0, 4, 0, 0, NULL);\n\tclks[TEGRA30_CLK_SCLK] = clk;\n\n\ttegra_register_devclks(devclks, ARRAY_SIZE(devclks));\n\ttegra_init_from_table(init_table, clks, TEGRA30_CLK_CLK_MAX);\n\ttegra30_car_initialized = true;\n\n\treturn 0;\n}\n\nstatic const struct of_device_id tegra30_car_match[] = {\n\t{ .compatible = \"nvidia,tegra30-car\" },\n\t{ }\n};\n\nstatic struct platform_driver tegra30_car_driver = {\n\t.driver = {\n\t\t.name = \"tegra30-car\",\n\t\t.of_match_table = tegra30_car_match,\n\t\t.suppress_bind_attrs = true,\n\t},\n\t.probe = tegra30_car_probe,\n};\n\n \nstatic int tegra30_car_init(void)\n{\n\treturn platform_driver_register(&tegra30_car_driver);\n}\npostcore_initcall(tegra30_car_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}