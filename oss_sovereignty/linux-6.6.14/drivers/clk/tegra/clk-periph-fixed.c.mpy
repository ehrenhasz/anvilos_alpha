{
  "module_name": "clk-periph-fixed.c",
  "hash_id": "6ae5ccfb5e8902bec9c9122019bd143e1b6d9692db7b7c543c761ef777dc88b7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/tegra/clk-periph-fixed.c",
  "human_readable_source": "\n \n\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n\n#include \"clk.h\"\n\nstatic inline struct tegra_clk_periph_fixed *\nto_tegra_clk_periph_fixed(struct clk_hw *hw)\n{\n\treturn container_of(hw, struct tegra_clk_periph_fixed, hw);\n}\n\nstatic int tegra_clk_periph_fixed_is_enabled(struct clk_hw *hw)\n{\n\tstruct tegra_clk_periph_fixed *fixed = to_tegra_clk_periph_fixed(hw);\n\tu32 mask = 1 << (fixed->num % 32), value;\n\n\tvalue = readl(fixed->base + fixed->regs->enb_reg);\n\tif (value & mask) {\n\t\tvalue = readl(fixed->base + fixed->regs->rst_reg);\n\t\tif ((value & mask) == 0)\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nstatic int tegra_clk_periph_fixed_enable(struct clk_hw *hw)\n{\n\tstruct tegra_clk_periph_fixed *fixed = to_tegra_clk_periph_fixed(hw);\n\tu32 mask = 1 << (fixed->num % 32);\n\n\twritel(mask, fixed->base + fixed->regs->enb_set_reg);\n\n\treturn 0;\n}\n\nstatic void tegra_clk_periph_fixed_disable(struct clk_hw *hw)\n{\n\tstruct tegra_clk_periph_fixed *fixed = to_tegra_clk_periph_fixed(hw);\n\tu32 mask = 1 << (fixed->num % 32);\n\n\twritel(mask, fixed->base + fixed->regs->enb_clr_reg);\n}\n\nstatic unsigned long\ntegra_clk_periph_fixed_recalc_rate(struct clk_hw *hw,\n\t\t\t\t   unsigned long parent_rate)\n{\n\tstruct tegra_clk_periph_fixed *fixed = to_tegra_clk_periph_fixed(hw);\n\tunsigned long long rate;\n\n\trate = (unsigned long long)parent_rate * fixed->mul;\n\tdo_div(rate, fixed->div);\n\n\treturn (unsigned long)rate;\n}\n\nstatic const struct clk_ops tegra_clk_periph_fixed_ops = {\n\t.is_enabled = tegra_clk_periph_fixed_is_enabled,\n\t.enable = tegra_clk_periph_fixed_enable,\n\t.disable = tegra_clk_periph_fixed_disable,\n\t.recalc_rate = tegra_clk_periph_fixed_recalc_rate,\n};\n\nstruct clk *tegra_clk_register_periph_fixed(const char *name,\n\t\t\t\t\t    const char *parent,\n\t\t\t\t\t    unsigned long flags,\n\t\t\t\t\t    void __iomem *base,\n\t\t\t\t\t    unsigned int mul,\n\t\t\t\t\t    unsigned int div,\n\t\t\t\t\t    unsigned int num)\n{\n\tconst struct tegra_clk_periph_regs *regs;\n\tstruct tegra_clk_periph_fixed *fixed;\n\tstruct clk_init_data init;\n\tstruct clk *clk;\n\n\tregs = get_reg_bank(num);\n\tif (!regs)\n\t\treturn ERR_PTR(-EINVAL);\n\n\tfixed = kzalloc(sizeof(*fixed), GFP_KERNEL);\n\tif (!fixed)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tinit.name = name;\n\tinit.flags = flags;\n\tinit.parent_names = parent ? &parent : NULL;\n\tinit.num_parents = parent ? 1 : 0;\n\tinit.ops = &tegra_clk_periph_fixed_ops;\n\n\tfixed->base = base;\n\tfixed->regs = regs;\n\tfixed->mul = mul;\n\tfixed->div = div;\n\tfixed->num = num;\n\n\tfixed->hw.init = &init;\n\n\tclk = clk_register(NULL, &fixed->hw);\n\tif (IS_ERR(clk))\n\t\tkfree(fixed);\n\n\treturn clk;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}