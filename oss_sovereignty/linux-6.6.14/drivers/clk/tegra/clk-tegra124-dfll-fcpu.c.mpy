{
  "module_name": "clk-tegra124-dfll-fcpu.c",
  "hash_id": "8e1e3b2dfa544fd32c374664384c32c78e43552622292d47afb42cb3eb16f111",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/tegra/clk-tegra124-dfll-fcpu.c",
  "human_readable_source": "\n \n\n#include <linux/cpu.h>\n#include <linux/err.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/consumer.h>\n#include <soc/tegra/fuse.h>\n\n#include \"clk.h\"\n#include \"clk-dfll.h\"\n#include \"cvb.h\"\n\nstruct dfll_fcpu_data {\n\tconst unsigned long *cpu_max_freq_table;\n\tunsigned int cpu_max_freq_table_size;\n\tconst struct cvb_table *cpu_cvb_tables;\n\tunsigned int cpu_cvb_tables_size;\n};\n\n \nstatic const unsigned long tegra124_cpu_max_freq_table[] = {\n\t[0] = 2014500000UL,\n\t[1] = 2320500000UL,\n\t[2] = 2116500000UL,\n\t[3] = 2524500000UL,\n};\n\nstatic const struct cvb_table tegra124_cpu_cvb_tables[] = {\n\t{\n\t\t.speedo_id = -1,\n\t\t.process_id = -1,\n\t\t.min_millivolts = 900,\n\t\t.max_millivolts = 1260,\n\t\t.speedo_scale = 100,\n\t\t.voltage_scale = 1000,\n\t\t.entries = {\n\t\t\t{  204000000UL, { 1112619, -29295, 402 } },\n\t\t\t{  306000000UL, { 1150460, -30585, 402 } },\n\t\t\t{  408000000UL, { 1190122, -31865, 402 } },\n\t\t\t{  510000000UL, { 1231606, -33155, 402 } },\n\t\t\t{  612000000UL, { 1274912, -34435, 402 } },\n\t\t\t{  714000000UL, { 1320040, -35725, 402 } },\n\t\t\t{  816000000UL, { 1366990, -37005, 402 } },\n\t\t\t{  918000000UL, { 1415762, -38295, 402 } },\n\t\t\t{ 1020000000UL, { 1466355, -39575, 402 } },\n\t\t\t{ 1122000000UL, { 1518771, -40865, 402 } },\n\t\t\t{ 1224000000UL, { 1573009, -42145, 402 } },\n\t\t\t{ 1326000000UL, { 1629068, -43435, 402 } },\n\t\t\t{ 1428000000UL, { 1686950, -44715, 402 } },\n\t\t\t{ 1530000000UL, { 1746653, -46005, 402 } },\n\t\t\t{ 1632000000UL, { 1808179, -47285, 402 } },\n\t\t\t{ 1734000000UL, { 1871526, -48575, 402 } },\n\t\t\t{ 1836000000UL, { 1936696, -49855, 402 } },\n\t\t\t{ 1938000000UL, { 2003687, -51145, 402 } },\n\t\t\t{ 2014500000UL, { 2054787, -52095, 402 } },\n\t\t\t{ 2116500000UL, { 2124957, -53385, 402 } },\n\t\t\t{ 2218500000UL, { 2196950, -54665, 402 } },\n\t\t\t{ 2320500000UL, { 2270765, -55955, 402 } },\n\t\t\t{ 2422500000UL, { 2346401, -57235, 402 } },\n\t\t\t{ 2524500000UL, { 2437299, -58535, 402 } },\n\t\t\t{          0UL, {       0,      0,   0 } },\n\t\t},\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0x005020ff,\n\t\t\t.tune0_high = 0x005040ff,\n\t\t\t.tune1 = 0x00000060,\n\t\t}\n\t},\n};\n\nstatic const unsigned long tegra210_cpu_max_freq_table[] = {\n\t[0] = 1912500000UL,\n\t[1] = 1912500000UL,\n\t[2] = 2218500000UL,\n\t[3] = 1785000000UL,\n\t[4] = 1632000000UL,\n\t[5] = 1912500000UL,\n\t[6] = 2014500000UL,\n\t[7] = 1734000000UL,\n\t[8] = 1683000000UL,\n\t[9] = 1555500000UL,\n\t[10] = 1504500000UL,\n};\n\n#define CPU_CVB_TABLE \\\n\t.speedo_scale = 100,\t\\\n\t.voltage_scale = 1000,\t\\\n\t.entries = {\t\t\\\n\t\t{  204000000UL,\t{ 1007452, -23865, 370 } }, \\\n\t\t{  306000000UL,\t{ 1052709, -24875, 370 } }, \\\n\t\t{  408000000UL,\t{ 1099069, -25895, 370 } }, \\\n\t\t{  510000000UL,\t{ 1146534, -26905, 370 } }, \\\n\t\t{  612000000UL,\t{ 1195102, -27915, 370 } }, \\\n\t\t{  714000000UL,\t{ 1244773, -28925, 370 } }, \\\n\t\t{  816000000UL,\t{ 1295549, -29935, 370 } }, \\\n\t\t{  918000000UL,\t{ 1347428, -30955, 370 } }, \\\n\t\t{ 1020000000UL,\t{ 1400411, -31965, 370 } }, \\\n\t\t{ 1122000000UL,\t{ 1454497, -32975, 370 } }, \\\n\t\t{ 1224000000UL,\t{ 1509687, -33985, 370 } }, \\\n\t\t{ 1326000000UL,\t{ 1565981, -35005, 370 } }, \\\n\t\t{ 1428000000UL,\t{ 1623379, -36015, 370 } }, \\\n\t\t{ 1530000000UL,\t{ 1681880, -37025, 370 } }, \\\n\t\t{ 1632000000UL,\t{ 1741485, -38035, 370 } }, \\\n\t\t{ 1734000000UL,\t{ 1802194, -39055, 370 } }, \\\n\t\t{ 1836000000UL,\t{ 1864006, -40065, 370 } }, \\\n\t\t{ 1912500000UL,\t{ 1910780, -40815, 370 } }, \\\n\t\t{ 2014500000UL,\t{ 1227000,      0,   0 } }, \\\n\t\t{ 2218500000UL,\t{ 1227000,      0,   0 } }, \\\n\t\t{          0UL,\t{       0,      0,   0 } }, \\\n\t}\n\n#define CPU_CVB_TABLE_XA \\\n\t.speedo_scale = 100,\t\\\n\t.voltage_scale = 1000,\t\\\n\t.entries = {\t\t\\\n\t\t{  204000000UL,\t{ 1250024, -39785, 565 } }, \\\n\t\t{  306000000UL,\t{ 1297556, -41145, 565 } }, \\\n\t\t{  408000000UL,\t{ 1346718, -42505, 565 } }, \\\n\t\t{  510000000UL,\t{ 1397511, -43855, 565 } }, \\\n\t\t{  612000000UL,\t{ 1449933, -45215, 565 } }, \\\n\t\t{  714000000UL,\t{ 1503986, -46575, 565 } }, \\\n\t\t{  816000000UL,\t{ 1559669, -47935, 565 } }, \\\n\t\t{  918000000UL,\t{ 1616982, -49295, 565 } }, \\\n\t\t{ 1020000000UL,\t{ 1675926, -50645, 565 } }, \\\n\t\t{ 1122000000UL,\t{ 1736500, -52005, 565 } }, \\\n\t\t{ 1224000000UL,\t{ 1798704, -53365, 565 } }, \\\n\t\t{ 1326000000UL,\t{ 1862538, -54725, 565 } }, \\\n\t\t{ 1428000000UL,\t{ 1928003, -56085, 565 } }, \\\n\t\t{ 1530000000UL,\t{ 1995097, -57435, 565 } }, \\\n\t\t{ 1606500000UL,\t{ 2046149, -58445, 565 } }, \\\n\t\t{ 1632000000UL,\t{ 2063822, -58795, 565 } }, \\\n\t\t{          0UL,\t{       0,      0,   0 } }, \\\n\t}\n\n#define CPU_CVB_TABLE_EUCM1 \\\n\t.speedo_scale = 100,\t\\\n\t.voltage_scale = 1000,\t\\\n\t.entries = {\t\t\\\n\t\t{  204000000UL,\t{  734429, 0, 0 } }, \\\n\t\t{  306000000UL,\t{  768191, 0, 0 } }, \\\n\t\t{  408000000UL,\t{  801953, 0, 0 } }, \\\n\t\t{  510000000UL,\t{  835715, 0, 0 } }, \\\n\t\t{  612000000UL,\t{  869477, 0, 0 } }, \\\n\t\t{  714000000UL,\t{  903239, 0, 0 } }, \\\n\t\t{  816000000UL,\t{  937001, 0, 0 } }, \\\n\t\t{  918000000UL,\t{  970763, 0, 0 } }, \\\n\t\t{ 1020000000UL,\t{ 1004525, 0, 0 } }, \\\n\t\t{ 1122000000UL,\t{ 1038287, 0, 0 } }, \\\n\t\t{ 1224000000UL,\t{ 1072049, 0, 0 } }, \\\n\t\t{ 1326000000UL,\t{ 1105811, 0, 0 } }, \\\n\t\t{ 1428000000UL,\t{ 1130000, 0, 0 } }, \\\n\t\t{ 1555500000UL,\t{ 1130000, 0, 0 } }, \\\n\t\t{ 1632000000UL,\t{ 1170000, 0, 0 } }, \\\n\t\t{ 1734000000UL,\t{ 1227500, 0, 0 } }, \\\n\t\t{          0UL,\t{       0, 0, 0 } }, \\\n\t}\n\n#define CPU_CVB_TABLE_EUCM2 \\\n\t.speedo_scale = 100,\t\\\n\t.voltage_scale = 1000,\t\\\n\t.entries = {\t\t\\\n\t\t{  204000000UL,\t{  742283, 0, 0 } }, \\\n\t\t{  306000000UL,\t{  776249, 0, 0 } }, \\\n\t\t{  408000000UL,\t{  810215, 0, 0 } }, \\\n\t\t{  510000000UL,\t{  844181, 0, 0 } }, \\\n\t\t{  612000000UL,\t{  878147, 0, 0 } }, \\\n\t\t{  714000000UL,\t{  912113, 0, 0 } }, \\\n\t\t{  816000000UL,\t{  946079, 0, 0 } }, \\\n\t\t{  918000000UL,\t{  980045, 0, 0 } }, \\\n\t\t{ 1020000000UL,\t{ 1014011, 0, 0 } }, \\\n\t\t{ 1122000000UL,\t{ 1047977, 0, 0 } }, \\\n\t\t{ 1224000000UL,\t{ 1081943, 0, 0 } }, \\\n\t\t{ 1326000000UL,\t{ 1090000, 0, 0 } }, \\\n\t\t{ 1479000000UL,\t{ 1090000, 0, 0 } }, \\\n\t\t{ 1555500000UL,\t{ 1162000, 0, 0 } }, \\\n\t\t{ 1683000000UL,\t{ 1195000, 0, 0 } }, \\\n\t\t{          0UL,\t{       0, 0, 0 } }, \\\n\t}\n\n#define CPU_CVB_TABLE_EUCM2_JOINT_RAIL \\\n\t.speedo_scale = 100,\t\\\n\t.voltage_scale = 1000,\t\\\n\t.entries = {\t\t\\\n\t\t{  204000000UL,\t{  742283, 0, 0 } }, \\\n\t\t{  306000000UL,\t{  776249, 0, 0 } }, \\\n\t\t{  408000000UL,\t{  810215, 0, 0 } }, \\\n\t\t{  510000000UL,\t{  844181, 0, 0 } }, \\\n\t\t{  612000000UL,\t{  878147, 0, 0 } }, \\\n\t\t{  714000000UL,\t{  912113, 0, 0 } }, \\\n\t\t{  816000000UL,\t{  946079, 0, 0 } }, \\\n\t\t{  918000000UL,\t{  980045, 0, 0 } }, \\\n\t\t{ 1020000000UL,\t{ 1014011, 0, 0 } }, \\\n\t\t{ 1122000000UL,\t{ 1047977, 0, 0 } }, \\\n\t\t{ 1224000000UL,\t{ 1081943, 0, 0 } }, \\\n\t\t{ 1326000000UL,\t{ 1090000, 0, 0 } }, \\\n\t\t{ 1479000000UL,\t{ 1090000, 0, 0 } }, \\\n\t\t{ 1504500000UL,\t{ 1120000, 0, 0 } }, \\\n\t\t{          0UL,\t{       0, 0, 0 } }, \\\n\t}\n\n#define CPU_CVB_TABLE_ODN \\\n\t.speedo_scale = 100,\t\\\n\t.voltage_scale = 1000,\t\\\n\t.entries = {\t\t\\\n\t\t{  204000000UL,\t{  721094, 0, 0 } }, \\\n\t\t{  306000000UL,\t{  754040, 0, 0 } }, \\\n\t\t{  408000000UL,\t{  786986, 0, 0 } }, \\\n\t\t{  510000000UL,\t{  819932, 0, 0 } }, \\\n\t\t{  612000000UL,\t{  852878, 0, 0 } }, \\\n\t\t{  714000000UL,\t{  885824, 0, 0 } }, \\\n\t\t{  816000000UL,\t{  918770, 0, 0 } }, \\\n\t\t{  918000000UL,\t{  915716, 0, 0 } }, \\\n\t\t{ 1020000000UL,\t{  984662, 0, 0 } }, \\\n\t\t{ 1122000000UL,\t{ 1017608, 0, 0 } }, \\\n\t\t{ 1224000000UL,\t{ 1050554, 0, 0 } }, \\\n\t\t{ 1326000000UL,\t{ 1083500, 0, 0 } }, \\\n\t\t{ 1428000000UL,\t{ 1116446, 0, 0 } }, \\\n\t\t{ 1581000000UL,\t{ 1130000, 0, 0 } }, \\\n\t\t{ 1683000000UL,\t{ 1168000, 0, 0 } }, \\\n\t\t{ 1785000000UL,\t{ 1227500, 0, 0 } }, \\\n\t\t{          0UL,\t{       0, 0, 0 } }, \\\n\t}\n\nstatic struct cvb_table tegra210_cpu_cvb_tables[] = {\n\t{\n\t\t.speedo_id = 10,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 840,\n\t\t.max_millivolts = 1120,\n\t\tCPU_CVB_TABLE_EUCM2_JOINT_RAIL,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 10,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 840,\n\t\t.max_millivolts = 1120,\n\t\tCPU_CVB_TABLE_EUCM2_JOINT_RAIL,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 9,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 900,\n\t\t.max_millivolts = 1162,\n\t\tCPU_CVB_TABLE_EUCM2,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 9,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 900,\n\t\t.max_millivolts = 1162,\n\t\tCPU_CVB_TABLE_EUCM2,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 8,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 900,\n\t\t.max_millivolts = 1195,\n\t\tCPU_CVB_TABLE_EUCM2,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 8,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 900,\n\t\t.max_millivolts = 1195,\n\t\tCPU_CVB_TABLE_EUCM2,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 7,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 841,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE_EUCM1,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 7,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 841,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE_EUCM1,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 6,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 870,\n\t\t.max_millivolts = 1150,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 6,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 870,\n\t\t.max_millivolts = 1150,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune1 = 0x25501d0,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 5,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 818,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 5,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 818,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x25501d0,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 4,\n\t\t.process_id = -1,\n\t\t.min_millivolts = 918,\n\t\t.max_millivolts = 1113,\n\t\tCPU_CVB_TABLE_XA,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune1 = 0x17711BD,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 3,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 825,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE_ODN,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 3,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 825,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE_ODN,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x25501d0,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 2,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 870,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 2,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 870,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune1 = 0x25501d0,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 1,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 837,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 1,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 837,\n\t\t.max_millivolts = 1227,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x25501d0,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 0,\n\t\t.process_id = 0,\n\t\t.min_millivolts = 850,\n\t\t.max_millivolts = 1170,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x20091d9,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n\t{\n\t\t.speedo_id = 0,\n\t\t.process_id = 1,\n\t\t.min_millivolts = 850,\n\t\t.max_millivolts = 1170,\n\t\tCPU_CVB_TABLE,\n\t\t.cpu_dfll_data = {\n\t\t\t.tune0_low = 0xffead0ff,\n\t\t\t.tune0_high = 0xffead0ff,\n\t\t\t.tune1 = 0x25501d0,\n\t\t\t.tune_high_min_millivolts = 864,\n\t\t}\n\t},\n};\n\nstatic const struct dfll_fcpu_data tegra124_dfll_fcpu_data = {\n\t.cpu_max_freq_table = tegra124_cpu_max_freq_table,\n\t.cpu_max_freq_table_size = ARRAY_SIZE(tegra124_cpu_max_freq_table),\n\t.cpu_cvb_tables = tegra124_cpu_cvb_tables,\n\t.cpu_cvb_tables_size = ARRAY_SIZE(tegra124_cpu_cvb_tables)\n};\n\nstatic const struct dfll_fcpu_data tegra210_dfll_fcpu_data = {\n\t.cpu_max_freq_table = tegra210_cpu_max_freq_table,\n\t.cpu_max_freq_table_size = ARRAY_SIZE(tegra210_cpu_max_freq_table),\n\t.cpu_cvb_tables = tegra210_cpu_cvb_tables,\n\t.cpu_cvb_tables_size = ARRAY_SIZE(tegra210_cpu_cvb_tables),\n};\n\nstatic const struct of_device_id tegra124_dfll_fcpu_of_match[] = {\n\t{\n\t\t.compatible = \"nvidia,tegra124-dfll\",\n\t\t.data = &tegra124_dfll_fcpu_data,\n\t},\n\t{\n\t\t.compatible = \"nvidia,tegra210-dfll\",\n\t\t.data = &tegra210_dfll_fcpu_data\n\t},\n\t{ },\n};\n\nstatic void get_alignment_from_dt(struct device *dev,\n\t\t\t\t  struct rail_alignment *align)\n{\n\tif (of_property_read_u32(dev->of_node,\n\t\t\t\t \"nvidia,pwm-voltage-step-microvolts\",\n\t\t\t\t &align->step_uv))\n\t\talign->step_uv = 0;\n\n\tif (of_property_read_u32(dev->of_node,\n\t\t\t\t \"nvidia,pwm-min-microvolts\",\n\t\t\t\t &align->offset_uv))\n\t\talign->offset_uv = 0;\n}\n\nstatic int get_alignment_from_regulator(struct device *dev,\n\t\t\t\t\t struct rail_alignment *align)\n{\n\tstruct regulator *reg = regulator_get(dev, \"vdd-cpu\");\n\n\tif (IS_ERR(reg))\n\t\treturn PTR_ERR(reg);\n\n\talign->offset_uv = regulator_list_voltage(reg, 0);\n\talign->step_uv = regulator_get_linear_step(reg);\n\n\tregulator_put(reg);\n\n\treturn 0;\n}\n\nstatic int tegra124_dfll_fcpu_probe(struct platform_device *pdev)\n{\n\tint process_id, speedo_id, speedo_value, err;\n\tstruct tegra_dfll_soc_data *soc;\n\tconst struct dfll_fcpu_data *fcpu_data;\n\tstruct rail_alignment align;\n\n\tfcpu_data = of_device_get_match_data(&pdev->dev);\n\tif (!fcpu_data)\n\t\treturn -ENODEV;\n\n\tprocess_id = tegra_sku_info.cpu_process_id;\n\tspeedo_id = tegra_sku_info.cpu_speedo_id;\n\tspeedo_value = tegra_sku_info.cpu_speedo_value;\n\n\tif (speedo_id >= fcpu_data->cpu_max_freq_table_size) {\n\t\tdev_err(&pdev->dev, \"unknown max CPU freq for speedo_id=%d\\n\",\n\t\t\tspeedo_id);\n\t\treturn -ENODEV;\n\t}\n\n\tsoc = devm_kzalloc(&pdev->dev, sizeof(*soc), GFP_KERNEL);\n\tif (!soc)\n\t\treturn -ENOMEM;\n\n\tsoc->dev = get_cpu_device(0);\n\tif (!soc->dev) {\n\t\tdev_err(&pdev->dev, \"no CPU0 device\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tif (of_property_read_bool(pdev->dev.of_node, \"nvidia,pwm-to-pmic\")) {\n\t\tget_alignment_from_dt(&pdev->dev, &align);\n\t} else {\n\t\terr = get_alignment_from_regulator(&pdev->dev, &align);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\tsoc->max_freq = fcpu_data->cpu_max_freq_table[speedo_id];\n\n\tsoc->cvb = tegra_cvb_add_opp_table(soc->dev, fcpu_data->cpu_cvb_tables,\n\t\t\t\t\t   fcpu_data->cpu_cvb_tables_size,\n\t\t\t\t\t   &align, process_id, speedo_id,\n\t\t\t\t\t   speedo_value, soc->max_freq);\n\tsoc->alignment = align;\n\n\tif (IS_ERR(soc->cvb)) {\n\t\tdev_err(&pdev->dev, \"couldn't add OPP table: %ld\\n\",\n\t\t\tPTR_ERR(soc->cvb));\n\t\treturn PTR_ERR(soc->cvb);\n\t}\n\n\terr = tegra_dfll_register(pdev, soc);\n\tif (err < 0) {\n\t\ttegra_cvb_remove_opp_table(soc->dev, soc->cvb, soc->max_freq);\n\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\nstatic void tegra124_dfll_fcpu_remove(struct platform_device *pdev)\n{\n\tstruct tegra_dfll_soc_data *soc;\n\n\t \n\tsoc = tegra_dfll_unregister(pdev);\n\tif (IS_ERR(soc))\n\t\treturn;\n\n\ttegra_cvb_remove_opp_table(soc->dev, soc->cvb, soc->max_freq);\n}\n\nstatic const struct dev_pm_ops tegra124_dfll_pm_ops = {\n\tSET_RUNTIME_PM_OPS(tegra_dfll_runtime_suspend,\n\t\t\t   tegra_dfll_runtime_resume, NULL)\n\tSET_SYSTEM_SLEEP_PM_OPS(tegra_dfll_suspend, tegra_dfll_resume)\n};\n\nstatic struct platform_driver tegra124_dfll_fcpu_driver = {\n\t.probe = tegra124_dfll_fcpu_probe,\n\t.remove_new = tegra124_dfll_fcpu_remove,\n\t.driver = {\n\t\t.name = \"tegra124-dfll\",\n\t\t.of_match_table = tegra124_dfll_fcpu_of_match,\n\t\t.pm = &tegra124_dfll_pm_ops,\n\t},\n};\nbuiltin_platform_driver(tegra124_dfll_fcpu_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}