{
  "module_name": "clk-agilex.c",
  "hash_id": "e4433fc835536fd3302b887cc09ce865fd84c7b5fceb0d47d65a3580696af244",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/socfpga/clk-agilex.c",
  "human_readable_source": "\n \n#include <linux/slab.h>\n#include <linux/clk-provider.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n\n#include <dt-bindings/clock/agilex-clock.h>\n\n#include \"stratix10-clk.h\"\n\nstatic const struct clk_parent_data pll_mux[] = {\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data boot_mux[] = {\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n};\n\nstatic const struct clk_parent_data mpu_free_mux[] = {\n\t{ .fw_name = \"main_pll_c0\",\n\t  .name = \"main_pll_c0\", },\n\t{ .fw_name = \"peri_pll_c0\",\n\t  .name = \"peri_pll_c0\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data noc_free_mux[] = {\n\t{ .fw_name = \"main_pll_c1\",\n\t  .name = \"main_pll_c1\", },\n\t{ .fw_name = \"peri_pll_c1\",\n\t  .name = \"peri_pll_c1\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data emaca_free_mux[] = {\n\t{ .fw_name = \"main_pll_c2\",\n\t  .name = \"main_pll_c2\", },\n\t{ .fw_name = \"peri_pll_c2\",\n\t  .name = \"peri_pll_c2\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data emacb_free_mux[] = {\n\t{ .fw_name = \"main_pll_c3\",\n\t  .name = \"main_pll_c3\", },\n\t{ .fw_name = \"peri_pll_c3\",\n\t  .name = \"peri_pll_c3\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data emac_ptp_free_mux[] = {\n\t{ .fw_name = \"main_pll_c3\",\n\t  .name = \"main_pll_c3\", },\n\t{ .fw_name = \"peri_pll_c3\",\n\t  .name = \"peri_pll_c3\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data gpio_db_free_mux[] = {\n\t{ .fw_name = \"main_pll_c3\",\n\t  .name = \"main_pll_c3\", },\n\t{ .fw_name = \"peri_pll_c3\",\n\t  .name = \"peri_pll_c3\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data psi_ref_free_mux[] = {\n\t{ .fw_name = \"main_pll_c2\",\n\t  .name = \"main_pll_c2\", },\n\t{ .fw_name = \"peri_pll_c2\",\n\t  .name = \"peri_pll_c2\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data sdmmc_free_mux[] = {\n\t{ .fw_name = \"main_pll_c3\",\n\t  .name = \"main_pll_c3\", },\n\t{ .fw_name = \"peri_pll_c3\",\n\t  .name = \"peri_pll_c3\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data s2f_usr0_free_mux[] = {\n\t{ .fw_name = \"main_pll_c2\",\n\t  .name = \"main_pll_c2\", },\n\t{ .fw_name = \"peri_pll_c2\",\n\t  .name = \"peri_pll_c2\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data s2f_usr1_free_mux[] = {\n\t{ .fw_name = \"main_pll_c2\",\n\t  .name = \"main_pll_c2\", },\n\t{ .fw_name = \"peri_pll_c2\",\n\t  .name = \"peri_pll_c2\", },\n\t{ .fw_name = \"osc1\",\n\t  .name = \"osc1\", },\n\t{ .fw_name = \"cb-intosc-hs-div2-clk\",\n\t  .name = \"cb-intosc-hs-div2-clk\", },\n\t{ .fw_name = \"f2s-free-clk\",\n\t  .name = \"f2s-free-clk\", },\n};\n\nstatic const struct clk_parent_data mpu_mux[] = {\n\t{ .fw_name = \"mpu_free_clk\",\n\t  .name = \"mpu_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data emac_mux[] = {\n\t{ .fw_name = \"emaca_free_clk\",\n\t  .name = \"emaca_free_clk\", },\n\t{ .fw_name = \"emacb_free_clk\",\n\t  .name = \"emacb_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data noc_mux[] = {\n\t{ .fw_name = \"noc_free_clk\",\n\t  .name = \"noc_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data sdmmc_mux[] = {\n\t{ .fw_name = \"sdmmc_free_clk\",\n\t  .name = \"sdmmc_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data s2f_user0_mux[] = {\n\t{ .fw_name = \"s2f_user0_free_clk\",\n\t  .name = \"s2f_user0_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data s2f_user1_mux[] = {\n\t{ .fw_name = \"s2f_user1_free_clk\",\n\t  .name = \"s2f_user1_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data psi_mux[] = {\n\t{ .fw_name = \"psi_ref_free_clk\",\n\t  .name = \"psi_ref_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data gpio_db_mux[] = {\n\t{ .fw_name = \"gpio_db_free_clk\",\n\t  .name = \"gpio_db_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\nstatic const struct clk_parent_data emac_ptp_mux[] = {\n\t{ .fw_name = \"emac_ptp_free_clk\",\n\t  .name = \"emac_ptp_free_clk\", },\n\t{ .fw_name = \"boot_clk\",\n\t  .name = \"boot_clk\", },\n};\n\n \nstatic const struct stratix10_pll_clock agilex_pll_clks[] = {\n\t{ AGILEX_BOOT_CLK, \"boot_clk\", boot_mux, ARRAY_SIZE(boot_mux), 0,\n\t  0x0},\n\t{ AGILEX_MAIN_PLL_CLK, \"main_pll\", pll_mux, ARRAY_SIZE(pll_mux),\n\t  0, 0x48},\n\t{ AGILEX_PERIPH_PLL_CLK, \"periph_pll\", pll_mux, ARRAY_SIZE(pll_mux),\n\t  0, 0x9c},\n};\n\nstatic const struct n5x_perip_c_clock n5x_main_perip_c_clks[] = {\n\t{ AGILEX_MAIN_PLL_C0_CLK, \"main_pll_c0\", \"main_pll\", NULL, 1, 0, 0x54, 0},\n\t{ AGILEX_MAIN_PLL_C1_CLK, \"main_pll_c1\", \"main_pll\", NULL, 1, 0, 0x54, 8},\n\t{ AGILEX_MAIN_PLL_C2_CLK, \"main_pll_c2\", \"main_pll\", NULL, 1, 0, 0x54, 16},\n\t{ AGILEX_MAIN_PLL_C3_CLK, \"main_pll_c3\", \"main_pll\", NULL, 1, 0, 0x54, 24},\n\t{ AGILEX_PERIPH_PLL_C0_CLK, \"peri_pll_c0\", \"periph_pll\", NULL, 1, 0, 0xA8, 0},\n\t{ AGILEX_PERIPH_PLL_C1_CLK, \"peri_pll_c1\", \"periph_pll\", NULL, 1, 0, 0xA8, 8},\n\t{ AGILEX_PERIPH_PLL_C2_CLK, \"peri_pll_c2\", \"periph_pll\", NULL, 1, 0, 0xA8, 16},\n\t{ AGILEX_PERIPH_PLL_C3_CLK, \"peri_pll_c3\", \"periph_pll\", NULL, 1, 0, 0xA8, 24},\n};\n\nstatic const struct stratix10_perip_c_clock agilex_main_perip_c_clks[] = {\n\t{ AGILEX_MAIN_PLL_C0_CLK, \"main_pll_c0\", \"main_pll\", NULL, 1, 0, 0x58},\n\t{ AGILEX_MAIN_PLL_C1_CLK, \"main_pll_c1\", \"main_pll\", NULL, 1, 0, 0x5C},\n\t{ AGILEX_MAIN_PLL_C2_CLK, \"main_pll_c2\", \"main_pll\", NULL, 1, 0, 0x64},\n\t{ AGILEX_MAIN_PLL_C3_CLK, \"main_pll_c3\", \"main_pll\", NULL, 1, 0, 0x68},\n\t{ AGILEX_PERIPH_PLL_C0_CLK, \"peri_pll_c0\", \"periph_pll\", NULL, 1, 0, 0xAC},\n\t{ AGILEX_PERIPH_PLL_C1_CLK, \"peri_pll_c1\", \"periph_pll\", NULL, 1, 0, 0xB0},\n\t{ AGILEX_PERIPH_PLL_C2_CLK, \"peri_pll_c2\", \"periph_pll\", NULL, 1, 0, 0xB8},\n\t{ AGILEX_PERIPH_PLL_C3_CLK, \"peri_pll_c3\", \"periph_pll\", NULL, 1, 0, 0xBC},\n};\n\nstatic const struct stratix10_perip_cnt_clock agilex_main_perip_cnt_clks[] = {\n\t{ AGILEX_MPU_FREE_CLK, \"mpu_free_clk\", NULL, mpu_free_mux, ARRAY_SIZE(mpu_free_mux),\n\t   0, 0x3C, 0, 0, 0},\n\t{ AGILEX_NOC_FREE_CLK, \"noc_free_clk\", NULL, noc_free_mux, ARRAY_SIZE(noc_free_mux),\n\t  0, 0x40, 0, 0, 0},\n\t{ AGILEX_L4_SYS_FREE_CLK, \"l4_sys_free_clk\", NULL, noc_mux, ARRAY_SIZE(noc_mux), 0,\n\t  0, 4, 0x30, 1},\n\t{ AGILEX_EMAC_A_FREE_CLK, \"emaca_free_clk\", NULL, emaca_free_mux, ARRAY_SIZE(emaca_free_mux),\n\t  0, 0xD4, 0, 0x88, 0},\n\t{ AGILEX_EMAC_B_FREE_CLK, \"emacb_free_clk\", NULL, emacb_free_mux, ARRAY_SIZE(emacb_free_mux),\n\t  0, 0xD8, 0, 0x88, 1},\n\t{ AGILEX_EMAC_PTP_FREE_CLK, \"emac_ptp_free_clk\", NULL, emac_ptp_free_mux,\n\t  ARRAY_SIZE(emac_ptp_free_mux), 0, 0xDC, 0, 0x88, 2},\n\t{ AGILEX_GPIO_DB_FREE_CLK, \"gpio_db_free_clk\", NULL, gpio_db_free_mux,\n\t  ARRAY_SIZE(gpio_db_free_mux), 0, 0xE0, 0, 0x88, 3},\n\t{ AGILEX_SDMMC_FREE_CLK, \"sdmmc_free_clk\", NULL, sdmmc_free_mux,\n\t  ARRAY_SIZE(sdmmc_free_mux), 0, 0xE4, 0, 0, 0},\n\t{ AGILEX_S2F_USER0_FREE_CLK, \"s2f_user0_free_clk\", NULL, s2f_usr0_free_mux,\n\t  ARRAY_SIZE(s2f_usr0_free_mux), 0, 0xE8, 0, 0x30, 2},\n\t{ AGILEX_S2F_USER1_FREE_CLK, \"s2f_user1_free_clk\", NULL, s2f_usr1_free_mux,\n\t  ARRAY_SIZE(s2f_usr1_free_mux), 0, 0xEC, 0, 0x88, 5},\n\t{ AGILEX_PSI_REF_FREE_CLK, \"psi_ref_free_clk\", NULL, psi_ref_free_mux,\n\t  ARRAY_SIZE(psi_ref_free_mux), 0, 0xF0, 0, 0x88, 6},\n};\n\nstatic const struct stratix10_gate_clock agilex_gate_clks[] = {\n\t{ AGILEX_MPU_CLK, \"mpu_clk\", NULL, mpu_mux, ARRAY_SIZE(mpu_mux), 0, 0x24,\n\t  0, 0, 0, 0, 0x30, 0, 0},\n\t{ AGILEX_MPU_PERIPH_CLK, \"mpu_periph_clk\", \"mpu_clk\", NULL, 1, 0, 0x24,\n\t  0, 0, 0, 0, 0, 0, 4},\n\t{ AGILEX_MPU_CCU_CLK, \"mpu_ccu_clk\", \"mpu_clk\", NULL, 1, 0, 0x24,\n\t  0, 0, 0, 0, 0, 0, 2},\n\t{ AGILEX_L4_MAIN_CLK, \"l4_main_clk\", NULL, noc_mux, ARRAY_SIZE(noc_mux), 0, 0x24,\n\t  1, 0x44, 0, 2, 0x30, 1, 0},\n\t{ AGILEX_L4_MP_CLK, \"l4_mp_clk\", NULL, noc_mux, ARRAY_SIZE(noc_mux), 0, 0x24,\n\t  2, 0x44, 8, 2, 0x30, 1, 0},\n\t \n\t{ AGILEX_L4_SP_CLK, \"l4_sp_clk\", NULL, noc_mux, ARRAY_SIZE(noc_mux), CLK_IS_CRITICAL, 0x24,\n\t  3, 0x44, 16, 2, 0x30, 1, 0},\n\t{ AGILEX_CS_AT_CLK, \"cs_at_clk\", NULL, noc_mux, ARRAY_SIZE(noc_mux), 0, 0x24,\n\t  4, 0x44, 24, 2, 0x30, 1, 0},\n\t{ AGILEX_CS_TRACE_CLK, \"cs_trace_clk\", NULL, noc_mux, ARRAY_SIZE(noc_mux), 0, 0x24,\n\t  4, 0x44, 26, 2, 0x30, 1, 0},\n\t{ AGILEX_CS_PDBG_CLK, \"cs_pdbg_clk\", \"cs_at_clk\", NULL, 1, 0, 0x24,\n\t  4, 0x44, 28, 1, 0, 0, 0},\n\t{ AGILEX_CS_TIMER_CLK, \"cs_timer_clk\", NULL, noc_mux, ARRAY_SIZE(noc_mux), 0, 0x24,\n\t  5, 0, 0, 0, 0x30, 1, 0},\n\t{ AGILEX_EMAC0_CLK, \"emac0_clk\", NULL, emac_mux, ARRAY_SIZE(emac_mux), 0, 0x7C,\n\t  0, 0, 0, 0, 0x94, 26, 0},\n\t{ AGILEX_EMAC1_CLK, \"emac1_clk\", NULL, emac_mux, ARRAY_SIZE(emac_mux), 0, 0x7C,\n\t  1, 0, 0, 0, 0x94, 27, 0},\n\t{ AGILEX_EMAC2_CLK, \"emac2_clk\", NULL, emac_mux, ARRAY_SIZE(emac_mux), 0, 0x7C,\n\t  2, 0, 0, 0, 0x94, 28, 0},\n\t{ AGILEX_EMAC_PTP_CLK, \"emac_ptp_clk\", NULL, emac_ptp_mux, ARRAY_SIZE(emac_ptp_mux), 0, 0x7C,\n\t  3, 0, 0, 0, 0x88, 2, 0},\n\t{ AGILEX_GPIO_DB_CLK, \"gpio_db_clk\", NULL, gpio_db_mux, ARRAY_SIZE(gpio_db_mux), 0, 0x7C,\n\t  4, 0x98, 0, 16, 0x88, 3, 0},\n\t{ AGILEX_SDMMC_CLK, \"sdmmc_clk\", NULL, sdmmc_mux, ARRAY_SIZE(sdmmc_mux), 0, 0x7C,\n\t  5, 0, 0, 0, 0x88, 4, 4},\n\t{ AGILEX_S2F_USER0_CLK, \"s2f_user0_clk\", NULL, s2f_user0_mux, ARRAY_SIZE(s2f_user0_mux), 0, 0x24,\n\t  6, 0, 0, 0, 0x30, 2, 0},\n\t{ AGILEX_S2F_USER1_CLK, \"s2f_user1_clk\", NULL, s2f_user1_mux, ARRAY_SIZE(s2f_user1_mux), 0, 0x7C,\n\t  6, 0, 0, 0, 0x88, 5, 0},\n\t{ AGILEX_PSI_REF_CLK, \"psi_ref_clk\", NULL, psi_mux, ARRAY_SIZE(psi_mux), 0, 0x7C,\n\t  7, 0, 0, 0, 0x88, 6, 0},\n\t{ AGILEX_USB_CLK, \"usb_clk\", \"l4_mp_clk\", NULL, 1, 0, 0x7C,\n\t  8, 0, 0, 0, 0, 0, 0},\n\t{ AGILEX_SPI_M_CLK, \"spi_m_clk\", \"l4_mp_clk\", NULL, 1, 0, 0x7C,\n\t  9, 0, 0, 0, 0, 0, 0},\n\t{ AGILEX_NAND_X_CLK, \"nand_x_clk\", \"l4_mp_clk\", NULL, 1, 0, 0x7C,\n\t  10, 0, 0, 0, 0, 0, 0},\n\t{ AGILEX_NAND_CLK, \"nand_clk\", \"nand_x_clk\", NULL, 1, 0, 0x7C,\n\t  10, 0, 0, 0, 0, 0, 4},\n\t{ AGILEX_NAND_ECC_CLK, \"nand_ecc_clk\", \"nand_x_clk\", NULL, 1, 0, 0x7C,\n\t  10, 0, 0, 0, 0, 0, 4},\n};\n\nstatic int n5x_clk_register_c_perip(const struct n5x_perip_c_clock *clks,\n\t\t\t\t       int nums, struct stratix10_clock_data *data)\n{\n\tstruct clk_hw *hw_clk;\n\tvoid __iomem *base = data->base;\n\tint i;\n\n\tfor (i = 0; i < nums; i++) {\n\t\thw_clk = n5x_register_periph(&clks[i], base);\n\t\tif (IS_ERR(hw_clk)) {\n\t\t\tpr_err(\"%s: failed to register clock %s\\n\",\n\t\t\t       __func__, clks[i].name);\n\t\t\tcontinue;\n\t\t}\n\t\tdata->clk_data.hws[clks[i].id] = hw_clk;\n\t}\n\treturn 0;\n}\n\nstatic int agilex_clk_register_c_perip(const struct stratix10_perip_c_clock *clks,\n\t\t\t\t       int nums, struct stratix10_clock_data *data)\n{\n\tstruct clk_hw *hw_clk;\n\tvoid __iomem *base = data->base;\n\tint i;\n\n\tfor (i = 0; i < nums; i++) {\n\t\thw_clk = s10_register_periph(&clks[i], base);\n\t\tif (IS_ERR(hw_clk)) {\n\t\t\tpr_err(\"%s: failed to register clock %s\\n\",\n\t\t\t       __func__, clks[i].name);\n\t\t\tcontinue;\n\t\t}\n\t\tdata->clk_data.hws[clks[i].id] = hw_clk;\n\t}\n\treturn 0;\n}\n\nstatic int agilex_clk_register_cnt_perip(const struct stratix10_perip_cnt_clock *clks,\n\t\t\t\t\t int nums, struct stratix10_clock_data *data)\n{\n\tstruct clk_hw *hw_clk;\n\tvoid __iomem *base = data->base;\n\tint i;\n\n\tfor (i = 0; i < nums; i++) {\n\t\thw_clk = s10_register_cnt_periph(&clks[i], base);\n\t\tif (IS_ERR(hw_clk)) {\n\t\t\tpr_err(\"%s: failed to register clock %s\\n\",\n\t\t\t       __func__, clks[i].name);\n\t\t\tcontinue;\n\t\t}\n\t\tdata->clk_data.hws[clks[i].id] = hw_clk;\n\t}\n\n\treturn 0;\n}\n\nstatic int agilex_clk_register_gate(const struct stratix10_gate_clock *clks,\n\t\t\t\t    int nums, struct stratix10_clock_data *data)\n{\n\tstruct clk_hw *hw_clk;\n\tvoid __iomem *base = data->base;\n\tint i;\n\n\tfor (i = 0; i < nums; i++) {\n\t\thw_clk = agilex_register_gate(&clks[i], base);\n\t\tif (IS_ERR(hw_clk)) {\n\t\t\tpr_err(\"%s: failed to register clock %s\\n\",\n\t\t\t       __func__, clks[i].name);\n\t\t\tcontinue;\n\t\t}\n\t\tdata->clk_data.hws[clks[i].id] = hw_clk;\n\t}\n\n\treturn 0;\n}\n\nstatic int agilex_clk_register_pll(const struct stratix10_pll_clock *clks,\n\t\t\t\t int nums, struct stratix10_clock_data *data)\n{\n\tstruct clk_hw *hw_clk;\n\tvoid __iomem *base = data->base;\n\tint i;\n\n\tfor (i = 0; i < nums; i++) {\n\t\thw_clk = agilex_register_pll(&clks[i], base);\n\t\tif (IS_ERR(hw_clk)) {\n\t\t\tpr_err(\"%s: failed to register clock %s\\n\",\n\t\t\t       __func__, clks[i].name);\n\t\t\tcontinue;\n\t\t}\n\t\tdata->clk_data.hws[clks[i].id] = hw_clk;\n\t}\n\n\treturn 0;\n}\n\nstatic int n5x_clk_register_pll(const struct stratix10_pll_clock *clks,\n\t\t\t\t int nums, struct stratix10_clock_data *data)\n{\n\tstruct clk_hw *hw_clk;\n\tvoid __iomem *base = data->base;\n\tint i;\n\n\tfor (i = 0; i < nums; i++) {\n\t\thw_clk = n5x_register_pll(&clks[i], base);\n\t\tif (IS_ERR(hw_clk)) {\n\t\t\tpr_err(\"%s: failed to register clock %s\\n\",\n\t\t\t       __func__, clks[i].name);\n\t\t\tcontinue;\n\t\t}\n\t\tdata->clk_data.hws[clks[i].id] = hw_clk;\n\t}\n\n\treturn 0;\n}\n\nstatic int agilex_clkmgr_init(struct platform_device *pdev)\n{\n\tstruct device_node *np = pdev->dev.of_node;\n\tstruct device *dev = &pdev->dev;\n\tstruct stratix10_clock_data *clk_data;\n\tvoid __iomem *base;\n\tint i, num_clks;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tnum_clks = AGILEX_NUM_CLKS;\n\n\tclk_data = devm_kzalloc(dev, struct_size(clk_data, clk_data.hws,\n\t\t\t\tnum_clks), GFP_KERNEL);\n\tif (!clk_data)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < num_clks; i++)\n\t\tclk_data->clk_data.hws[i] = ERR_PTR(-ENOENT);\n\n\tclk_data->base = base;\n\tclk_data->clk_data.num = num_clks;\n\n\tagilex_clk_register_pll(agilex_pll_clks, ARRAY_SIZE(agilex_pll_clks), clk_data);\n\n\tagilex_clk_register_c_perip(agilex_main_perip_c_clks,\n\t\t\t\t ARRAY_SIZE(agilex_main_perip_c_clks), clk_data);\n\n\tagilex_clk_register_cnt_perip(agilex_main_perip_cnt_clks,\n\t\t\t\t   ARRAY_SIZE(agilex_main_perip_cnt_clks),\n\t\t\t\t   clk_data);\n\n\tagilex_clk_register_gate(agilex_gate_clks, ARRAY_SIZE(agilex_gate_clks),\n\t\t\t      clk_data);\n\tof_clk_add_hw_provider(np, of_clk_hw_onecell_get, &clk_data->clk_data);\n\treturn 0;\n}\n\nstatic int n5x_clkmgr_init(struct platform_device *pdev)\n{\n\tstruct device_node *np = pdev->dev.of_node;\n\tstruct device *dev = &pdev->dev;\n\tstruct stratix10_clock_data *clk_data;\n\tvoid __iomem *base;\n\tint i, num_clks;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tnum_clks = AGILEX_NUM_CLKS;\n\n\tclk_data = devm_kzalloc(dev, struct_size(clk_data, clk_data.hws,\n\t\t\t\tnum_clks), GFP_KERNEL);\n\tif (!clk_data)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < num_clks; i++)\n\t\tclk_data->clk_data.hws[i] = ERR_PTR(-ENOENT);\n\n\tclk_data->base = base;\n\tclk_data->clk_data.num = num_clks;\n\n\tn5x_clk_register_pll(agilex_pll_clks, ARRAY_SIZE(agilex_pll_clks), clk_data);\n\n\tn5x_clk_register_c_perip(n5x_main_perip_c_clks,\n\t\t\t\t ARRAY_SIZE(n5x_main_perip_c_clks), clk_data);\n\n\tagilex_clk_register_cnt_perip(agilex_main_perip_cnt_clks,\n\t\t\t\t   ARRAY_SIZE(agilex_main_perip_cnt_clks),\n\t\t\t\t   clk_data);\n\n\tagilex_clk_register_gate(agilex_gate_clks, ARRAY_SIZE(agilex_gate_clks),\n\t\t\t      clk_data);\n\tof_clk_add_hw_provider(np, of_clk_hw_onecell_get, &clk_data->clk_data);\n\treturn 0;\n}\n\nstatic int agilex_clkmgr_probe(struct platform_device *pdev)\n{\n\tint (*probe_func)(struct platform_device *init_func);\n\n\tprobe_func = of_device_get_match_data(&pdev->dev);\n\tif (!probe_func)\n\t\treturn -ENODEV;\n\treturn\tprobe_func(pdev);\n}\n\nstatic const struct of_device_id agilex_clkmgr_match_table[] = {\n\t{ .compatible = \"intel,agilex-clkmgr\",\n\t  .data = agilex_clkmgr_init },\n\t{ .compatible = \"intel,easic-n5x-clkmgr\",\n\t  .data = n5x_clkmgr_init },\n\t{ }\n};\n\nstatic struct platform_driver agilex_clkmgr_driver = {\n\t.probe\t\t= agilex_clkmgr_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"agilex-clkmgr\",\n\t\t.suppress_bind_attrs = true,\n\t\t.of_match_table = agilex_clkmgr_match_table,\n\t},\n};\n\nstatic int __init agilex_clk_init(void)\n{\n\treturn platform_driver_register(&agilex_clkmgr_driver);\n}\ncore_initcall(agilex_clk_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}