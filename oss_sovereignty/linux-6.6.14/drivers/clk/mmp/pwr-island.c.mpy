{
  "module_name": "pwr-island.c",
  "hash_id": "abd815a9600d62710826dfcae755c9f25b41b63cefac2d9470c5a4479a6d49cf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mmp/pwr-island.c",
  "human_readable_source": "\n \n\n#include <linux/pm_domain.h>\n#include <linux/slab.h>\n#include <linux/io.h>\n\n#include \"clk.h\"\n\n#define to_mmp_pm_domain(genpd) container_of(genpd, struct mmp_pm_domain, genpd)\n\nstruct mmp_pm_domain {\n\tstruct generic_pm_domain genpd;\n\tvoid __iomem *reg;\n\tspinlock_t *lock;\n\tu32 power_on;\n\tu32 reset;\n\tu32 clock_enable;\n\tunsigned int flags;\n};\n\nstatic int mmp_pm_domain_power_on(struct generic_pm_domain *genpd)\n{\n\tstruct mmp_pm_domain *pm_domain = to_mmp_pm_domain(genpd);\n\tunsigned long flags = 0;\n\tu32 val;\n\n\tif (pm_domain->lock)\n\t\tspin_lock_irqsave(pm_domain->lock, flags);\n\n\tval = readl(pm_domain->reg);\n\n\t \n\tval |= pm_domain->power_on;\n\twritel(val, pm_domain->reg);\n\n\t \n\tval |= 0x100;\n\twritel(val, pm_domain->reg);\n\n\t \n\tif (pm_domain->reset || pm_domain->clock_enable) {\n\t\tu32 after_power_on = val;\n\n\t\tval &= ~pm_domain->reset;\n\t\twritel(val, pm_domain->reg);\n\n\t\tval |= pm_domain->clock_enable;\n\t\twritel(val, pm_domain->reg);\n\n\t\tval |= pm_domain->reset;\n\t\twritel(val, pm_domain->reg);\n\n\t\twritel(after_power_on, pm_domain->reg);\n\t}\n\n\tif (pm_domain->lock)\n\t\tspin_unlock_irqrestore(pm_domain->lock, flags);\n\n\treturn 0;\n}\n\nstatic int mmp_pm_domain_power_off(struct generic_pm_domain *genpd)\n{\n\tstruct mmp_pm_domain *pm_domain = to_mmp_pm_domain(genpd);\n\tunsigned long flags = 0;\n\tu32 val;\n\n\tif (pm_domain->flags & MMP_PM_DOMAIN_NO_DISABLE)\n\t\treturn 0;\n\n\tif (pm_domain->lock)\n\t\tspin_lock_irqsave(pm_domain->lock, flags);\n\n\t \n\tval = readl(pm_domain->reg);\n\tval &= ~pm_domain->power_on;\n\tval &= ~0x100;\n\twritel(val, pm_domain->reg);\n\n\tif (pm_domain->lock)\n\t\tspin_unlock_irqrestore(pm_domain->lock, flags);\n\n\treturn 0;\n}\n\nstruct generic_pm_domain *mmp_pm_domain_register(const char *name,\n\t\tvoid __iomem *reg,\n\t\tu32 power_on, u32 reset, u32 clock_enable,\n\t\tunsigned int flags, spinlock_t *lock)\n{\n\tstruct mmp_pm_domain *pm_domain;\n\n\tpm_domain = kzalloc(sizeof(*pm_domain), GFP_KERNEL);\n\tif (!pm_domain)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tpm_domain->reg = reg;\n\tpm_domain->power_on = power_on;\n\tpm_domain->reset = reset;\n\tpm_domain->clock_enable = clock_enable;\n\tpm_domain->flags = flags;\n\tpm_domain->lock = lock;\n\n\tpm_genpd_init(&pm_domain->genpd, NULL, true);\n\tpm_domain->genpd.name = name;\n\tpm_domain->genpd.power_on = mmp_pm_domain_power_on;\n\tpm_domain->genpd.power_off = mmp_pm_domain_power_off;\n\n\treturn &pm_domain->genpd;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}