{
  "module_name": "div.c",
  "hash_id": "d67008fad2a84a36e1e5ffd0c83c3909be1af86db23dde08cc9cb57159290eb1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sprd/div.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <linux/clk-provider.h>\n\n#include \"div.h\"\n\nstatic long sprd_div_round_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\tunsigned long *parent_rate)\n{\n\tstruct sprd_div *cd = hw_to_sprd_div(hw);\n\n\treturn divider_round_rate(&cd->common.hw, rate, parent_rate, NULL,\n\t\t\t\t  cd->div.width, 0);\n}\n\nunsigned long sprd_div_helper_recalc_rate(struct sprd_clk_common *common,\n\t\t\t\t\t  const struct sprd_div_internal *div,\n\t\t\t\t\t  unsigned long parent_rate)\n{\n\tunsigned long val;\n\tunsigned int reg;\n\n\tregmap_read(common->regmap, common->reg, &reg);\n\tval = reg >> div->shift;\n\tval &= (1 << div->width) - 1;\n\n\treturn divider_recalc_rate(&common->hw, parent_rate, val, NULL, 0,\n\t\t\t\t   div->width);\n}\nEXPORT_SYMBOL_GPL(sprd_div_helper_recalc_rate);\n\nstatic unsigned long sprd_div_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t  unsigned long parent_rate)\n{\n\tstruct sprd_div *cd = hw_to_sprd_div(hw);\n\n\treturn sprd_div_helper_recalc_rate(&cd->common, &cd->div, parent_rate);\n}\n\nint sprd_div_helper_set_rate(const struct sprd_clk_common *common,\n\t\t\t     const struct sprd_div_internal *div,\n\t\t\t     unsigned long rate,\n\t\t\t     unsigned long parent_rate)\n{\n\tunsigned long val;\n\tunsigned int reg;\n\n\tval = divider_get_val(rate, parent_rate, NULL,\n\t\t\t      div->width, 0);\n\n\tregmap_read(common->regmap, common->reg, &reg);\n\treg &= ~GENMASK(div->width + div->shift - 1, div->shift);\n\n\tregmap_write(common->regmap, common->reg,\n\t\t\t  reg | (val << div->shift));\n\n\treturn 0;\n\n}\nEXPORT_SYMBOL_GPL(sprd_div_helper_set_rate);\n\nstatic int sprd_div_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t     unsigned long parent_rate)\n{\n\tstruct sprd_div *cd = hw_to_sprd_div(hw);\n\n\treturn sprd_div_helper_set_rate(&cd->common, &cd->div,\n\t\t\t\t\trate, parent_rate);\n}\n\nconst struct clk_ops sprd_div_ops = {\n\t.recalc_rate = sprd_div_recalc_rate,\n\t.round_rate = sprd_div_round_rate,\n\t.set_rate = sprd_div_set_rate,\n};\nEXPORT_SYMBOL_GPL(sprd_div_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}