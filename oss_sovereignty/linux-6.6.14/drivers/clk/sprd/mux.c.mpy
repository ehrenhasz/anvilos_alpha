{
  "module_name": "mux.c",
  "hash_id": "04364ec7072fb3f74f1ecbd813ae2c726421e4bce72f0a2c5966f1705d442609",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/sprd/mux.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <linux/clk.h>\n#include <linux/clk-provider.h>\n#include <linux/regmap.h>\n\n#include \"mux.h\"\n\nu8 sprd_mux_helper_get_parent(const struct sprd_clk_common *common,\n\t\t\t      const struct sprd_mux_ssel *mux)\n{\n\tunsigned int reg;\n\tu8 parent;\n\tint num_parents;\n\tint i;\n\n\tregmap_read(common->regmap, common->reg, &reg);\n\tparent = reg >> mux->shift;\n\tparent &= (1 << mux->width) - 1;\n\n\tif (!mux->table)\n\t\treturn parent;\n\n\tnum_parents = clk_hw_get_num_parents(&common->hw);\n\n\tfor (i = 0; i < num_parents - 1; i++)\n\t\tif (parent >= mux->table[i] && parent < mux->table[i + 1])\n\t\t\treturn i;\n\n\treturn num_parents - 1;\n}\nEXPORT_SYMBOL_GPL(sprd_mux_helper_get_parent);\n\nstatic u8 sprd_mux_get_parent(struct clk_hw *hw)\n{\n\tstruct sprd_mux *cm = hw_to_sprd_mux(hw);\n\n\treturn sprd_mux_helper_get_parent(&cm->common, &cm->mux);\n}\n\nint sprd_mux_helper_set_parent(const struct sprd_clk_common *common,\n\t\t\t       const struct sprd_mux_ssel *mux,\n\t\t\t       u8 index)\n{\n\tunsigned int reg;\n\n\tif (mux->table)\n\t\tindex = mux->table[index];\n\n\tregmap_read(common->regmap, common->reg, &reg);\n\treg &= ~GENMASK(mux->width + mux->shift - 1, mux->shift);\n\tregmap_write(common->regmap, common->reg,\n\t\t\t  reg | (index << mux->shift));\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(sprd_mux_helper_set_parent);\n\nstatic int sprd_mux_set_parent(struct clk_hw *hw, u8 index)\n{\n\tstruct sprd_mux *cm = hw_to_sprd_mux(hw);\n\n\treturn sprd_mux_helper_set_parent(&cm->common, &cm->mux, index);\n}\n\nconst struct clk_ops sprd_mux_ops = {\n\t.get_parent = sprd_mux_get_parent,\n\t.set_parent = sprd_mux_set_parent,\n\t.determine_rate = __clk_mux_determine_rate,\n};\nEXPORT_SYMBOL_GPL(sprd_mux_ops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}