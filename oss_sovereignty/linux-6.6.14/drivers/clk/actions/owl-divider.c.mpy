{
  "module_name": "owl-divider.c",
  "hash_id": "abba5f361f0f57bb49904153f928c54bcf8b652169453d4e71b43243b0e52e89",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/actions/owl-divider.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n#include <linux/clk-provider.h>\n#include <linux/regmap.h>\n\n#include \"owl-divider.h\"\n\nlong owl_divider_helper_round_rate(struct owl_clk_common *common,\n\t\t\t\tconst struct owl_divider_hw *div_hw,\n\t\t\t\tunsigned long rate,\n\t\t\t\tunsigned long *parent_rate)\n{\n\treturn divider_round_rate(&common->hw, rate, parent_rate,\n\t\t\t\t  div_hw->table, div_hw->width,\n\t\t\t\t  div_hw->div_flags);\n}\n\nstatic long owl_divider_round_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\tunsigned long *parent_rate)\n{\n\tstruct owl_divider *div = hw_to_owl_divider(hw);\n\n\treturn owl_divider_helper_round_rate(&div->common, &div->div_hw,\n\t\t\t\t\t     rate, parent_rate);\n}\n\nunsigned long owl_divider_helper_recalc_rate(struct owl_clk_common *common,\n\t\t\t\t\t const struct owl_divider_hw *div_hw,\n\t\t\t\t\t unsigned long parent_rate)\n{\n\tunsigned long val;\n\tunsigned int reg;\n\n\tregmap_read(common->regmap, div_hw->reg, &reg);\n\tval = reg >> div_hw->shift;\n\tval &= (1 << div_hw->width) - 1;\n\n\treturn divider_recalc_rate(&common->hw, parent_rate,\n\t\t\t\t   val, div_hw->table,\n\t\t\t\t   div_hw->div_flags,\n\t\t\t\t   div_hw->width);\n}\n\nstatic unsigned long owl_divider_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t  unsigned long parent_rate)\n{\n\tstruct owl_divider *div = hw_to_owl_divider(hw);\n\n\treturn owl_divider_helper_recalc_rate(&div->common,\n\t\t\t\t\t      &div->div_hw, parent_rate);\n}\n\nint owl_divider_helper_set_rate(const struct owl_clk_common *common,\n\t\t\t\tconst struct owl_divider_hw *div_hw,\n\t\t\t\tunsigned long rate,\n\t\t\t\tunsigned long parent_rate)\n{\n\tunsigned long val;\n\tunsigned int reg;\n\n\tval = divider_get_val(rate, parent_rate, div_hw->table,\n\t\t\t      div_hw->width, 0);\n\n\tregmap_read(common->regmap, div_hw->reg, &reg);\n\treg &= ~GENMASK(div_hw->width + div_hw->shift - 1, div_hw->shift);\n\n\tregmap_write(common->regmap, div_hw->reg,\n\t\t\t  reg | (val << div_hw->shift));\n\n\treturn 0;\n}\n\nstatic int owl_divider_set_rate(struct clk_hw *hw, unsigned long rate,\n\t\t\t\tunsigned long parent_rate)\n{\n\tstruct owl_divider *div = hw_to_owl_divider(hw);\n\n\treturn owl_divider_helper_set_rate(&div->common, &div->div_hw,\n\t\t\t\t\trate, parent_rate);\n}\n\nconst struct clk_ops owl_divider_ops = {\n\t.recalc_rate = owl_divider_recalc_rate,\n\t.round_rate = owl_divider_round_rate,\n\t.set_rate = owl_divider_set_rate,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}