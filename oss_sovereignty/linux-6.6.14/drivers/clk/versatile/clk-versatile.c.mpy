{
  "module_name": "clk-versatile.c",
  "hash_id": "1a5e9e12120bc118ddfc3dfb5284166f64e059c9686a4f40ad78dda9ce8bd3ef",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/versatile/clk-versatile.c",
  "human_readable_source": "\n \n#include <linux/clk-provider.h>\n#include <linux/err.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n\n#include \"icst.h\"\n#include \"clk-icst.h\"\n\n#define INTEGRATOR_HDR_LOCK_OFFSET\t0x14\n\n#define VERSATILE_SYS_OSCCLCD_OFFSET\t0x1c\n#define VERSATILE_SYS_LOCK_OFFSET\t0x20\n\n \nstatic void __iomem *cm_base;\n\nstatic const struct icst_params cp_auxosc_params = {\n\t.vco_max\t= ICST525_VCO_MAX_5V,\n\t.vco_min\t= ICST525_VCO_MIN,\n\t.vd_min \t= 8,\n\t.vd_max \t= 263,\n\t.rd_min \t= 3,\n\t.rd_max \t= 65,\n\t.s2div\t\t= icst525_s2div,\n\t.idx2s\t\t= icst525_idx2s,\n};\n\nstatic const struct clk_icst_desc cm_auxosc_desc __initconst = {\n\t.params = &cp_auxosc_params,\n\t.vco_offset = 0x1c,\n\t.lock_offset = INTEGRATOR_HDR_LOCK_OFFSET,\n};\n\nstatic const struct icst_params versatile_auxosc_params = {\n\t.vco_max\t= ICST307_VCO_MAX,\n\t.vco_min\t= ICST307_VCO_MIN,\n\t.vd_min\t\t= 4 + 8,\n\t.vd_max\t\t= 511 + 8,\n\t.rd_min\t\t= 1 + 2,\n\t.rd_max\t\t= 127 + 2,\n\t.s2div\t\t= icst307_s2div,\n\t.idx2s\t\t= icst307_idx2s,\n};\n\nstatic const struct clk_icst_desc versatile_auxosc_desc __initconst = {\n\t.params = &versatile_auxosc_params,\n\t.vco_offset = VERSATILE_SYS_OSCCLCD_OFFSET,\n\t.lock_offset = VERSATILE_SYS_LOCK_OFFSET,\n};\nstatic void __init cm_osc_setup(struct device_node *np,\n\t\t\t\tconst struct clk_icst_desc *desc)\n{\n\tstruct clk *clk;\n\tconst char *clk_name = np->name;\n\tconst char *parent_name;\n\n\tif (!cm_base) {\n\t\t \n\t\tstruct device_node *parent;\n\n\t\tparent = of_get_parent(np);\n\t\tif (!parent) {\n\t\t\tpr_err(\"no parent on core module clock\\n\");\n\t\t\treturn;\n\t\t}\n\t\tcm_base = of_iomap(parent, 0);\n\t\tof_node_put(parent);\n\t\tif (!cm_base) {\n\t\t\tpr_err(\"could not remap core module base\\n\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\tparent_name = of_clk_get_parent_name(np, 0);\n\tclk = icst_clk_register(NULL, desc, clk_name, parent_name, cm_base);\n\tif (!IS_ERR(clk))\n\t\tof_clk_add_provider(np, of_clk_src_simple_get, clk);\n}\n\nstatic void __init of_integrator_cm_osc_setup(struct device_node *np)\n{\n\tcm_osc_setup(np, &cm_auxosc_desc);\n}\nCLK_OF_DECLARE(integrator_cm_auxosc_clk,\n\t\"arm,integrator-cm-auxosc\", of_integrator_cm_osc_setup);\n\nstatic void __init of_versatile_cm_osc_setup(struct device_node *np)\n{\n\tcm_osc_setup(np, &versatile_auxosc_desc);\n}\nCLK_OF_DECLARE(versatile_cm_auxosc_clk,\n\t       \"arm,versatile-cm-auxosc\", of_versatile_cm_osc_setup);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}