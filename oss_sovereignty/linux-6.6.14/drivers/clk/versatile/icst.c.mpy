{
  "module_name": "icst.c",
  "hash_id": "22e589e28a3cf7418db7a5e4d51a1c180cc0c3755ca87b66616abf58100bdd2c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/versatile/icst.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <asm/div64.h>\n#include \"icst.h\"\n\n \nconst unsigned char icst307_s2div[8] = { 10, 2, 8, 4, 5, 7, 3, 6 };\nconst unsigned char icst525_s2div[8] = { 10, 2, 8, 4, 5, 7, 9, 6 };\nEXPORT_SYMBOL(icst307_s2div);\nEXPORT_SYMBOL(icst525_s2div);\n\nunsigned long icst_hz(const struct icst_params *p, struct icst_vco vco)\n{\n\tu64 dividend = p->ref * 2 * (u64)(vco.v + 8);\n\tu32 divisor = (vco.r + 2) * p->s2div[vco.s];\n\n\tdo_div(dividend, divisor);\n\treturn (unsigned long)dividend;\n}\n\nEXPORT_SYMBOL(icst_hz);\n\n \nconst unsigned char icst307_idx2s[8] = { 1, 6, 3, 4, 7, 5, 2, 0 };\nconst unsigned char icst525_idx2s[8] = { 1, 3, 4, 7, 5, 2, 6, 0 };\nEXPORT_SYMBOL(icst307_idx2s);\nEXPORT_SYMBOL(icst525_idx2s);\n\nstruct icst_vco\nicst_hz_to_vco(const struct icst_params *p, unsigned long freq)\n{\n\tstruct icst_vco vco = { .s = 1, .v = p->vd_max, .r = p->rd_max };\n\tunsigned long f;\n\tunsigned int i = 0, rd, best = (unsigned int)-1;\n\n\t \n\tdo {\n\t\tf = freq * p->s2div[p->idx2s[i]];\n\n\t\tif (f > p->vco_min && f <= p->vco_max)\n\t\t\tbreak;\n\t\ti++;\n\t} while (i < 8);\n\n\tif (i >= 8)\n\t\treturn vco;\n\n\tvco.s = p->idx2s[i];\n\n\t \n\tfor (rd = p->rd_min; rd <= p->rd_max; rd++) {\n\t\tunsigned long fref_div, f_pll;\n\t\tunsigned int vd;\n\t\tint f_diff;\n\n\t\tfref_div = (2 * p->ref) / rd;\n\n\t\tvd = (f + fref_div / 2) / fref_div;\n\t\tif (vd < p->vd_min || vd > p->vd_max)\n\t\t\tcontinue;\n\n\t\tf_pll = fref_div * vd;\n\t\tf_diff = f_pll - f;\n\t\tif (f_diff < 0)\n\t\t\tf_diff = -f_diff;\n\n\t\tif ((unsigned)f_diff < best) {\n\t\t\tvco.v = vd - 8;\n\t\t\tvco.r = rd - 2;\n\t\t\tif (f_diff == 0)\n\t\t\t\tbreak;\n\t\t\tbest = f_diff;\n\t\t}\n\t}\n\n\treturn vco;\n}\n\nEXPORT_SYMBOL(icst_hz_to_vco);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}