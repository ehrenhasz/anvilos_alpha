{
  "module_name": "clk-hi655x.c",
  "hash_id": "d069ce10dd550e22587c2b8da1b5d4b0cc146479dd7f645b5e926eaa45d9edeb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/clk-hi655x.c",
  "human_readable_source": "\n \n#include <linux/clk-provider.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n#include <linux/mfd/core.h>\n#include <linux/mfd/hi655x-pmic.h>\n\n#define HI655X_CLK_BASE\tHI655X_BUS_ADDR(0x1c)\n#define HI655X_CLK_SET\tBIT(6)\n\nstruct hi655x_clk {\n\tstruct hi655x_pmic *hi655x;\n\tstruct clk_hw       clk_hw;\n};\n\nstatic unsigned long hi655x_clk_recalc_rate(struct clk_hw *hw,\n\t\t\t\t\t    unsigned long parent_rate)\n{\n\treturn 32768;\n}\n\nstatic int hi655x_clk_enable(struct clk_hw *hw, bool enable)\n{\n\tstruct hi655x_clk *hi655x_clk =\n\t\tcontainer_of(hw, struct hi655x_clk, clk_hw);\n\n\tstruct hi655x_pmic *hi655x = hi655x_clk->hi655x;\n\n\treturn regmap_update_bits(hi655x->regmap, HI655X_CLK_BASE,\n\t\t\t\t  HI655X_CLK_SET, enable ? HI655X_CLK_SET : 0);\n}\n\nstatic int hi655x_clk_prepare(struct clk_hw *hw)\n{\n\treturn hi655x_clk_enable(hw, true);\n}\n\nstatic void hi655x_clk_unprepare(struct clk_hw *hw)\n{\n\thi655x_clk_enable(hw, false);\n}\n\nstatic int hi655x_clk_is_prepared(struct clk_hw *hw)\n{\n\tstruct hi655x_clk *hi655x_clk =\n\t\tcontainer_of(hw, struct hi655x_clk, clk_hw);\n\tstruct hi655x_pmic *hi655x = hi655x_clk->hi655x;\n\tint ret;\n\tuint32_t val;\n\n\tret = regmap_read(hi655x->regmap, HI655X_CLK_BASE, &val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\treturn val & HI655X_CLK_BASE;\n}\n\nstatic const struct clk_ops hi655x_clk_ops = {\n\t.prepare     = hi655x_clk_prepare,\n\t.unprepare   = hi655x_clk_unprepare,\n\t.is_prepared = hi655x_clk_is_prepared,\n\t.recalc_rate = hi655x_clk_recalc_rate,\n};\n\nstatic int hi655x_clk_probe(struct platform_device *pdev)\n{\n\tstruct device *parent = pdev->dev.parent;\n\tstruct hi655x_pmic *hi655x = dev_get_drvdata(parent);\n\tstruct hi655x_clk *hi655x_clk;\n\tconst char *clk_name = \"hi655x-clk\";\n\tstruct clk_init_data init = {\n\t\t.name = clk_name,\n\t\t.ops = &hi655x_clk_ops\n\t};\n\tint ret;\n\n\thi655x_clk = devm_kzalloc(&pdev->dev, sizeof(*hi655x_clk), GFP_KERNEL);\n\tif (!hi655x_clk)\n\t\treturn -ENOMEM;\n\n\tof_property_read_string_index(parent->of_node, \"clock-output-names\",\n\t\t\t\t      0, &clk_name);\n\n\thi655x_clk->clk_hw.init\t= &init;\n\thi655x_clk->hi655x\t= hi655x;\n\n\tplatform_set_drvdata(pdev, hi655x_clk);\n\n\tret = devm_clk_hw_register(&pdev->dev, &hi655x_clk->clk_hw);\n\tif (ret)\n\t\treturn ret;\n\n\treturn devm_of_clk_add_hw_provider(&pdev->dev, of_clk_hw_simple_get,\n\t\t\t\t\t   &hi655x_clk->clk_hw);\n}\n\nstatic struct platform_driver hi655x_clk_driver = {\n\t.probe =  hi655x_clk_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"hi655x-clk\",\n\t},\n};\n\nmodule_platform_driver(hi655x_clk_driver);\n\nMODULE_DESCRIPTION(\"Clk driver for the hi655x series PMICs\");\nMODULE_AUTHOR(\"Daniel Lezcano <daniel.lezcano@linaro.org>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:hi655x-clk\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}