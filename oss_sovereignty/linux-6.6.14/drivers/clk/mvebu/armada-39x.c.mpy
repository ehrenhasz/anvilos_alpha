{
  "module_name": "armada-39x.c",
  "hash_id": "3bfa10580fda21bc4a5c988370ea1f105883103e8e8d0170b4437b11ead482aa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mvebu/armada-39x.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include \"common.h\"\n\n \n\n#define SARL \t\t\t\t\t0\n#define  SARL_A390_TCLK_FREQ_OPT\t\t15\n#define  SARL_A390_TCLK_FREQ_OPT_MASK\t\t0x1\n#define  SARL_A390_CPU_DDR_L2_FREQ_OPT\t\t10\n#define  SARL_A390_CPU_DDR_L2_FREQ_OPT_MASK\t0x1F\n#define SARH\t\t\t\t\t4\n#define  SARH_A390_REFCLK_FREQ\t\t\tBIT(0)\n\nstatic const u32 armada_39x_tclk_frequencies[] __initconst = {\n\t250000000,\n\t200000000,\n};\n\nstatic u32 __init armada_39x_get_tclk_freq(void __iomem *sar)\n{\n\tu8 tclk_freq_select;\n\n\ttclk_freq_select = ((readl(sar + SARL) >> SARL_A390_TCLK_FREQ_OPT) &\n\t\t\t    SARL_A390_TCLK_FREQ_OPT_MASK);\n\treturn armada_39x_tclk_frequencies[tclk_freq_select];\n}\n\nstatic const u32 armada_39x_cpu_frequencies[] __initconst = {\n\t[0x0] = 666 * 1000 * 1000,\n\t[0x2] = 800 * 1000 * 1000,\n\t[0x3] = 800 * 1000 * 1000,\n\t[0x4] = 1066 * 1000 * 1000,\n\t[0x5] = 1066 * 1000 * 1000,\n\t[0x6] = 1200 * 1000 * 1000,\n\t[0x8] = 1332 * 1000 * 1000,\n\t[0xB] = 1600 * 1000 * 1000,\n\t[0xC] = 1600 * 1000 * 1000,\n\t[0x12] = 1800 * 1000 * 1000,\n\t[0x1E] = 1800 * 1000 * 1000,\n};\n\nstatic u32 __init armada_39x_get_cpu_freq(void __iomem *sar)\n{\n\tu8 cpu_freq_select;\n\n\tcpu_freq_select = ((readl(sar + SARL) >> SARL_A390_CPU_DDR_L2_FREQ_OPT) &\n\t\t\t   SARL_A390_CPU_DDR_L2_FREQ_OPT_MASK);\n\tif (cpu_freq_select >= ARRAY_SIZE(armada_39x_cpu_frequencies)) {\n\t\tpr_err(\"Selected CPU frequency (%d) unsupported\\n\",\n\t\t\tcpu_freq_select);\n\t\treturn 0;\n\t}\n\n\treturn armada_39x_cpu_frequencies[cpu_freq_select];\n}\n\nenum { A390_CPU_TO_NBCLK, A390_CPU_TO_HCLK, A390_CPU_TO_DCLK };\n\nstatic const struct coreclk_ratio armada_39x_coreclk_ratios[] __initconst = {\n\t{ .id = A390_CPU_TO_NBCLK, .name = \"nbclk\" },\n\t{ .id = A390_CPU_TO_HCLK, .name = \"hclk\" },\n\t{ .id = A390_CPU_TO_DCLK, .name = \"dclk\" },\n};\n\nstatic void __init armada_39x_get_clk_ratio(\n\tvoid __iomem *sar, int id, int *mult, int *div)\n{\n\tswitch (id) {\n\tcase A390_CPU_TO_NBCLK:\n\t\t*mult = 1;\n\t\t*div = 2;\n\t\tbreak;\n\tcase A390_CPU_TO_HCLK:\n\t\t*mult = 1;\n\t\t*div = 4;\n\t\tbreak;\n\tcase A390_CPU_TO_DCLK:\n\t\t*mult = 1;\n\t\t*div = 2;\n\t\tbreak;\n\t}\n}\n\nstatic u32 __init armada_39x_refclk_ratio(void __iomem *sar)\n{\n\tif (readl(sar + SARH) & SARH_A390_REFCLK_FREQ)\n\t\treturn 40 * 1000 * 1000;\n\telse\n\t\treturn 25 * 1000 * 1000;\n}\n\nstatic const struct coreclk_soc_desc armada_39x_coreclks = {\n\t.get_tclk_freq = armada_39x_get_tclk_freq,\n\t.get_cpu_freq = armada_39x_get_cpu_freq,\n\t.get_clk_ratio = armada_39x_get_clk_ratio,\n\t.get_refclk_freq = armada_39x_refclk_ratio,\n\t.ratios = armada_39x_coreclk_ratios,\n\t.num_ratios = ARRAY_SIZE(armada_39x_coreclk_ratios),\n};\n\nstatic void __init armada_39x_coreclk_init(struct device_node *np)\n{\n\tmvebu_coreclk_setup(np, &armada_39x_coreclks);\n}\nCLK_OF_DECLARE(armada_39x_core_clk, \"marvell,armada-390-core-clock\",\n\t       armada_39x_coreclk_init);\n\n \nstatic const struct clk_gating_soc_desc armada_39x_gating_desc[] __initconst = {\n\t{ \"pex1\", NULL, 5 },\n\t{ \"pex2\", NULL, 6 },\n\t{ \"pex3\", NULL, 7 },\n\t{ \"pex0\", NULL, 8 },\n\t{ \"usb3h0\", NULL, 9 },\n\t{ \"usb3h1\", NULL, 10 },\n\t{ \"sata0\", NULL, 15 },\n\t{ \"sdio\", NULL, 17 },\n\t{ \"xor0\", NULL, 22 },\n\t{ \"xor1\", NULL, 28 },\n\t{ }\n};\n\nstatic void __init armada_39x_clk_gating_init(struct device_node *np)\n{\n\tmvebu_clk_gating_setup(np, armada_39x_gating_desc);\n}\nCLK_OF_DECLARE(armada_39x_clk_gating, \"marvell,armada-390-gating-clock\",\n\t       armada_39x_clk_gating_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}