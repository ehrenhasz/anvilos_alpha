{
  "module_name": "dove.c",
  "hash_id": "6b2669e63db4e90394d5ae35aa40e4b9593d324b27e1ac2da77df274e312f6ac",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mvebu/dove.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include \"common.h\"\n#include \"dove-divider.h\"\n\n \n\n#define SAR_DOVE_CPU_FREQ\t\t5\n#define SAR_DOVE_CPU_FREQ_MASK\t\t0xf\n#define SAR_DOVE_L2_RATIO\t\t9\n#define SAR_DOVE_L2_RATIO_MASK\t\t0x7\n#define SAR_DOVE_DDR_RATIO\t\t12\n#define SAR_DOVE_DDR_RATIO_MASK\t\t0xf\n#define SAR_DOVE_TCLK_FREQ\t\t23\n#define SAR_DOVE_TCLK_FREQ_MASK\t\t0x3\n\nenum { DOVE_CPU_TO_L2, DOVE_CPU_TO_DDR };\n\nstatic const struct coreclk_ratio dove_coreclk_ratios[] __initconst = {\n\t{ .id = DOVE_CPU_TO_L2, .name = \"l2clk\", },\n\t{ .id = DOVE_CPU_TO_DDR, .name = \"ddrclk\", }\n};\n\nstatic const u32 dove_tclk_freqs[] __initconst = {\n\t166666667,\n\t125000000,\n\t0, 0\n};\n\nstatic u32 __init dove_get_tclk_freq(void __iomem *sar)\n{\n\tu32 opt = (readl(sar) >> SAR_DOVE_TCLK_FREQ) &\n\t\tSAR_DOVE_TCLK_FREQ_MASK;\n\treturn dove_tclk_freqs[opt];\n}\n\nstatic const u32 dove_cpu_freqs[] __initconst = {\n\t0, 0, 0, 0, 0,\n\t1000000000,\n\t933333333, 933333333,\n\t800000000, 800000000, 800000000,\n\t1066666667,\n\t666666667,\n\t533333333,\n\t400000000,\n\t333333333\n};\n\nstatic u32 __init dove_get_cpu_freq(void __iomem *sar)\n{\n\tu32 opt = (readl(sar) >> SAR_DOVE_CPU_FREQ) &\n\t\tSAR_DOVE_CPU_FREQ_MASK;\n\treturn dove_cpu_freqs[opt];\n}\n\nstatic const int dove_cpu_l2_ratios[8][2] __initconst = {\n\t{ 1, 1 }, { 0, 1 }, { 1, 2 }, { 0, 1 },\n\t{ 1, 3 }, { 0, 1 }, { 1, 4 }, { 0, 1 }\n};\n\nstatic const int dove_cpu_ddr_ratios[16][2] __initconst = {\n\t{ 1, 1 }, { 0, 1 }, { 1, 2 }, { 2, 5 },\n\t{ 1, 3 }, { 0, 1 }, { 1, 4 }, { 0, 1 },\n\t{ 1, 5 }, { 0, 1 }, { 1, 6 }, { 0, 1 },\n\t{ 1, 7 }, { 0, 1 }, { 1, 8 }, { 1, 10 }\n};\n\nstatic void __init dove_get_clk_ratio(\n\tvoid __iomem *sar, int id, int *mult, int *div)\n{\n\tswitch (id) {\n\tcase DOVE_CPU_TO_L2:\n\t{\n\t\tu32 opt = (readl(sar) >> SAR_DOVE_L2_RATIO) &\n\t\t\tSAR_DOVE_L2_RATIO_MASK;\n\t\t*mult = dove_cpu_l2_ratios[opt][0];\n\t\t*div = dove_cpu_l2_ratios[opt][1];\n\t\tbreak;\n\t}\n\tcase DOVE_CPU_TO_DDR:\n\t{\n\t\tu32 opt = (readl(sar) >> SAR_DOVE_DDR_RATIO) &\n\t\t\tSAR_DOVE_DDR_RATIO_MASK;\n\t\t*mult = dove_cpu_ddr_ratios[opt][0];\n\t\t*div = dove_cpu_ddr_ratios[opt][1];\n\t\tbreak;\n\t}\n\t}\n}\n\nstatic const struct coreclk_soc_desc dove_coreclks = {\n\t.get_tclk_freq = dove_get_tclk_freq,\n\t.get_cpu_freq = dove_get_cpu_freq,\n\t.get_clk_ratio = dove_get_clk_ratio,\n\t.ratios = dove_coreclk_ratios,\n\t.num_ratios = ARRAY_SIZE(dove_coreclk_ratios),\n};\n\n \n\nstatic const struct clk_gating_soc_desc dove_gating_desc[] __initconst = {\n\t{ \"usb0\", NULL, 0, 0 },\n\t{ \"usb1\", NULL, 1, 0 },\n\t{ \"ge\",\t\"gephy\", 2, 0 },\n\t{ \"sata\", NULL, 3, 0 },\n\t{ \"pex0\", NULL, 4, 0 },\n\t{ \"pex1\", NULL, 5, 0 },\n\t{ \"sdio0\", NULL, 8, 0 },\n\t{ \"sdio1\", NULL, 9, 0 },\n\t{ \"nand\", NULL, 10, 0 },\n\t{ \"camera\", NULL, 11, 0 },\n\t{ \"i2s0\", NULL, 12, 0 },\n\t{ \"i2s1\", NULL, 13, 0 },\n\t{ \"crypto\", NULL, 15, 0 },\n\t{ \"ac97\", NULL, 21, 0 },\n\t{ \"pdma\", NULL, 22, 0 },\n\t{ \"xor0\", NULL, 23, 0 },\n\t{ \"xor1\", NULL, 24, 0 },\n\t{ \"gephy\", NULL, 30, 0 },\n\t{ }\n};\n\nstatic void __init dove_clk_init(struct device_node *np)\n{\n\tstruct device_node *cgnp =\n\t\tof_find_compatible_node(NULL, NULL, \"marvell,dove-gating-clock\");\n\tstruct device_node *ddnp =\n\t\tof_find_compatible_node(NULL, NULL, \"marvell,dove-divider-clock\");\n\n\tmvebu_coreclk_setup(np, &dove_coreclks);\n\n\tif (ddnp) {\n\t\tdove_divider_clk_init(ddnp);\n\t\tof_node_put(ddnp);\n\t}\n\n\tif (cgnp) {\n\t\tmvebu_clk_gating_setup(cgnp, dove_gating_desc);\n\t\tof_node_put(cgnp);\n\t}\n}\nCLK_OF_DECLARE(dove_clk, \"marvell,dove-core-clock\", dove_clk_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}