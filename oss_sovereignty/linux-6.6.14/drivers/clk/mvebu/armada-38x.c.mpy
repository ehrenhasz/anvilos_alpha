{
  "module_name": "armada-38x.c",
  "hash_id": "4e5de6df9678728b7f4b5b5533dd4a6dc5d9fa0f65fdd436def9602b0b39c5d2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/clk/mvebu/armada-38x.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/clk-provider.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include \"common.h\"\n\n \n\n#define SAR_A380_TCLK_FREQ_OPT\t\t  15\n#define SAR_A380_TCLK_FREQ_OPT_MASK\t  0x1\n#define SAR_A380_CPU_DDR_L2_FREQ_OPT\t  10\n#define SAR_A380_CPU_DDR_L2_FREQ_OPT_MASK 0x1F\n\nstatic const u32 armada_38x_tclk_frequencies[] __initconst = {\n\t250000000,\n\t200000000,\n};\n\nstatic u32 __init armada_38x_get_tclk_freq(void __iomem *sar)\n{\n\tu8 tclk_freq_select;\n\n\ttclk_freq_select = ((readl(sar) >> SAR_A380_TCLK_FREQ_OPT) &\n\t\t\t    SAR_A380_TCLK_FREQ_OPT_MASK);\n\treturn armada_38x_tclk_frequencies[tclk_freq_select];\n}\n\nstatic const u32 armada_38x_cpu_frequencies[] __initconst = {\n\t666 * 1000 * 1000,  0, 800 * 1000 * 1000, 0,\n\t1066 * 1000 * 1000, 0, 1200 * 1000 * 1000, 0,\n\t1332 * 1000 * 1000, 0, 0, 0,\n\t1600 * 1000 * 1000, 0, 0, 0,\n\t1866 * 1000 * 1000, 0, 0, 2000 * 1000 * 1000,\n};\n\nstatic u32 __init armada_38x_get_cpu_freq(void __iomem *sar)\n{\n\tu8 cpu_freq_select;\n\n\tcpu_freq_select = ((readl(sar) >> SAR_A380_CPU_DDR_L2_FREQ_OPT) &\n\t\t\t   SAR_A380_CPU_DDR_L2_FREQ_OPT_MASK);\n\tif (cpu_freq_select >= ARRAY_SIZE(armada_38x_cpu_frequencies)) {\n\t\tpr_err(\"Selected CPU frequency (%d) unsupported\\n\",\n\t\t\tcpu_freq_select);\n\t\treturn 0;\n\t}\n\n\treturn armada_38x_cpu_frequencies[cpu_freq_select];\n}\n\nenum { A380_CPU_TO_DDR, A380_CPU_TO_L2 };\n\nstatic const struct coreclk_ratio armada_38x_coreclk_ratios[] __initconst = {\n\t{ .id = A380_CPU_TO_L2,\t .name = \"l2clk\" },\n\t{ .id = A380_CPU_TO_DDR, .name = \"ddrclk\" },\n};\n\nstatic const int armada_38x_cpu_l2_ratios[32][2] __initconst = {\n\t{1, 2}, {0, 1}, {1, 2}, {0, 1},\n\t{1, 2}, {0, 1}, {1, 2}, {0, 1},\n\t{1, 2}, {0, 1}, {0, 1}, {0, 1},\n\t{1, 2}, {0, 1}, {0, 1}, {0, 1},\n\t{1, 2}, {0, 1}, {0, 1}, {1, 2},\n\t{0, 1}, {0, 1}, {0, 1}, {0, 1},\n\t{0, 1}, {0, 1}, {0, 1}, {0, 1},\n\t{0, 1}, {0, 1}, {0, 1}, {0, 1},\n};\n\nstatic const int armada_38x_cpu_ddr_ratios[32][2] __initconst = {\n\t{0, 1}, {0, 1}, {0, 1}, {0, 1},\n\t{1, 2}, {0, 1}, {0, 1}, {0, 1},\n\t{1, 2}, {0, 1}, {0, 1}, {0, 1},\n\t{1, 2}, {0, 1}, {0, 1}, {0, 1},\n\t{1, 2}, {0, 1}, {0, 1}, {7, 15},\n\t{0, 1}, {0, 1}, {0, 1}, {0, 1},\n\t{0, 1}, {0, 1}, {0, 1}, {0, 1},\n\t{0, 1}, {0, 1}, {0, 1}, {0, 1},\n};\n\nstatic void __init armada_38x_get_clk_ratio(\n\tvoid __iomem *sar, int id, int *mult, int *div)\n{\n\tu32 opt = ((readl(sar) >> SAR_A380_CPU_DDR_L2_FREQ_OPT) &\n\t\tSAR_A380_CPU_DDR_L2_FREQ_OPT_MASK);\n\n\tswitch (id) {\n\tcase A380_CPU_TO_L2:\n\t\t*mult = armada_38x_cpu_l2_ratios[opt][0];\n\t\t*div = armada_38x_cpu_l2_ratios[opt][1];\n\t\tbreak;\n\tcase A380_CPU_TO_DDR:\n\t\t*mult = armada_38x_cpu_ddr_ratios[opt][0];\n\t\t*div = armada_38x_cpu_ddr_ratios[opt][1];\n\t\tbreak;\n\t}\n}\n\nstatic const struct coreclk_soc_desc armada_38x_coreclks = {\n\t.get_tclk_freq = armada_38x_get_tclk_freq,\n\t.get_cpu_freq = armada_38x_get_cpu_freq,\n\t.get_clk_ratio = armada_38x_get_clk_ratio,\n\t.ratios = armada_38x_coreclk_ratios,\n\t.num_ratios = ARRAY_SIZE(armada_38x_coreclk_ratios),\n};\n\nstatic void __init armada_38x_coreclk_init(struct device_node *np)\n{\n\tmvebu_coreclk_setup(np, &armada_38x_coreclks);\n}\nCLK_OF_DECLARE(armada_38x_core_clk, \"marvell,armada-380-core-clock\",\n\t       armada_38x_coreclk_init);\n\n \nstatic const struct clk_gating_soc_desc armada_38x_gating_desc[] __initconst = {\n\t{ \"audio\", NULL, 0 },\n\t{ \"ge2\", NULL, 2 },\n\t{ \"ge1\", NULL, 3 },\n\t{ \"ge0\", NULL, 4 },\n\t{ \"pex1\", NULL, 5 },\n\t{ \"pex2\", NULL, 6 },\n\t{ \"pex3\", NULL, 7 },\n\t{ \"pex0\", NULL, 8 },\n\t{ \"usb3h0\", NULL, 9 },\n\t{ \"usb3h1\", NULL, 10 },\n\t{ \"usb3d\", NULL, 11 },\n\t{ \"bm\", NULL, 13 },\n\t{ \"crypto0z\", NULL, 14 },\n\t{ \"sata0\", NULL, 15 },\n\t{ \"crypto1z\", NULL, 16 },\n\t{ \"sdio\", NULL, 17 },\n\t{ \"usb2\", NULL, 18 },\n\t{ \"crypto1\", NULL, 21 },\n\t{ \"xor0\", NULL, 22 },\n\t{ \"crypto0\", NULL, 23 },\n\t{ \"tdm\", NULL, 25 },\n\t{ \"xor1\", NULL, 28 },\n\t{ \"sata1\", NULL, 30 },\n\t{ }\n};\n\nstatic void __init armada_38x_clk_gating_init(struct device_node *np)\n{\n\tmvebu_clk_gating_setup(np, armada_38x_gating_desc);\n}\nCLK_OF_DECLARE(armada_38x_clk_gating, \"marvell,armada-380-gating-clock\",\n\t       armada_38x_clk_gating_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}