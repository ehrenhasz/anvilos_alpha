{
  "module_name": "remoteproc_elf_helpers.h",
  "hash_id": "279c86cfd9c8849b4cf2696096f1095f3dfa69403f30ab7ecb685e18b4afdf62",
  "original_prompt": "Ingested from linux-6.6.14/drivers/remoteproc/remoteproc_elf_helpers.h",
  "human_readable_source": " \n \n\n#ifndef REMOTEPROC_ELF_LOADER_H\n#define REMOTEPROC_ELF_LOADER_H\n\n#include <linux/elf.h>\n#include <linux/types.h>\n\n \nstatic inline u8 fw_elf_get_class(const struct firmware *fw)\n{\n\tstruct elf32_hdr *ehdr = (struct elf32_hdr *)fw->data;\n\n\treturn ehdr->e_ident[EI_CLASS];\n}\n\nstatic inline void elf_hdr_init_ident(struct elf32_hdr *hdr, u8 class)\n{\n\tmemcpy(hdr->e_ident, ELFMAG, SELFMAG);\n\thdr->e_ident[EI_CLASS] = class;\n\thdr->e_ident[EI_DATA] = ELFDATA2LSB;\n\thdr->e_ident[EI_VERSION] = EV_CURRENT;\n\thdr->e_ident[EI_OSABI] = ELFOSABI_NONE;\n}\n\n \n#define ELF_GEN_FIELD_GET_SET(__s, __field, __type) \\\nstatic inline __type elf_##__s##_get_##__field(u8 class, const void *arg) \\\n{ \\\n\tif (class == ELFCLASS32) \\\n\t\treturn (__type) ((const struct elf32_##__s *) arg)->__field; \\\n\telse \\\n\t\treturn (__type) ((const struct elf64_##__s *) arg)->__field; \\\n} \\\nstatic inline void elf_##__s##_set_##__field(u8 class, void *arg, \\\n\t\t\t\t\t     __type value) \\\n{ \\\n\tif (class == ELFCLASS32) \\\n\t\t((struct elf32_##__s *) arg)->__field = (__type) value; \\\n\telse \\\n\t\t((struct elf64_##__s *) arg)->__field = (__type) value; \\\n}\n\nELF_GEN_FIELD_GET_SET(hdr, e_entry, u64)\nELF_GEN_FIELD_GET_SET(hdr, e_phnum, u16)\nELF_GEN_FIELD_GET_SET(hdr, e_shnum, u16)\nELF_GEN_FIELD_GET_SET(hdr, e_phoff, u64)\nELF_GEN_FIELD_GET_SET(hdr, e_shoff, u64)\nELF_GEN_FIELD_GET_SET(hdr, e_shstrndx, u16)\nELF_GEN_FIELD_GET_SET(hdr, e_machine, u16)\nELF_GEN_FIELD_GET_SET(hdr, e_type, u16)\nELF_GEN_FIELD_GET_SET(hdr, e_version, u32)\nELF_GEN_FIELD_GET_SET(hdr, e_ehsize, u32)\nELF_GEN_FIELD_GET_SET(hdr, e_phentsize, u16)\nELF_GEN_FIELD_GET_SET(hdr, e_shentsize, u16)\n\nELF_GEN_FIELD_GET_SET(phdr, p_paddr, u64)\nELF_GEN_FIELD_GET_SET(phdr, p_vaddr, u64)\nELF_GEN_FIELD_GET_SET(phdr, p_filesz, u64)\nELF_GEN_FIELD_GET_SET(phdr, p_memsz, u64)\nELF_GEN_FIELD_GET_SET(phdr, p_type, u32)\nELF_GEN_FIELD_GET_SET(phdr, p_offset, u64)\nELF_GEN_FIELD_GET_SET(phdr, p_flags, u32)\nELF_GEN_FIELD_GET_SET(phdr, p_align, u64)\n\nELF_GEN_FIELD_GET_SET(shdr, sh_type, u32)\nELF_GEN_FIELD_GET_SET(shdr, sh_flags, u32)\nELF_GEN_FIELD_GET_SET(shdr, sh_entsize, u16)\nELF_GEN_FIELD_GET_SET(shdr, sh_size, u64)\nELF_GEN_FIELD_GET_SET(shdr, sh_offset, u64)\nELF_GEN_FIELD_GET_SET(shdr, sh_name, u32)\nELF_GEN_FIELD_GET_SET(shdr, sh_addr, u64)\n\n#define ELF_STRUCT_SIZE(__s) \\\nstatic inline unsigned long elf_size_of_##__s(u8 class) \\\n{ \\\n\tif (class == ELFCLASS32)\\\n\t\treturn sizeof(struct elf32_##__s); \\\n\telse \\\n\t\treturn sizeof(struct elf64_##__s); \\\n}\n\nELF_STRUCT_SIZE(shdr)\nELF_STRUCT_SIZE(phdr)\nELF_STRUCT_SIZE(hdr)\n\nstatic inline unsigned int elf_strtbl_add(const char *name, void *ehdr, u8 class, size_t *index)\n{\n\tu16 shstrndx = elf_hdr_get_e_shstrndx(class, ehdr);\n\tvoid *shdr;\n\tchar *strtab;\n\tsize_t idx, ret;\n\n\tshdr = ehdr + elf_size_of_hdr(class) + shstrndx * elf_size_of_shdr(class);\n\tstrtab = ehdr + elf_shdr_get_sh_offset(class, shdr);\n\tidx = index ? *index : 0;\n\tif (!strtab || !name)\n\t\treturn 0;\n\n\tret = idx;\n\tstrcpy((strtab + idx), name);\n\tidx += strlen(name) + 1;\n\tif (index)\n\t\t*index = idx;\n\n\treturn ret;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}