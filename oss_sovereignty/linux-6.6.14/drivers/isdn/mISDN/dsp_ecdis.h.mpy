{
  "module_name": "dsp_ecdis.h",
  "hash_id": "289999fb5169b7fdf302c1055d14a1417efbe793a015edeaa55881733253331c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/isdn/mISDN/dsp_ecdis.h",
  "human_readable_source": " \n \n\n#include \"dsp_biquad.h\"\n\nstruct ec_disable_detector_state {\n\tstruct biquad2_state notch;\n\tint notch_level;\n\tint channel_level;\n\tint tone_present;\n\tint tone_cycle_duration;\n\tint good_cycles;\n\tint hit;\n};\n\n\n#define FALSE 0\n#define TRUE (!FALSE)\n\nstatic inline void\necho_can_disable_detector_init(struct ec_disable_detector_state *det)\n{\n\t \n\t \n\tbiquad2_init(&det->notch,\n\t\t     (int32_t)(-0.7600000 * 32768.0),\n\t\t     (int32_t)(-0.1183852 * 32768.0),\n\t\t     (int32_t)(-0.5104039 * 32768.0),\n\t\t     (int32_t)(0.1567596 * 32768.0),\n\t\t     (int32_t)(1.0000000 * 32768.0));\n\n\tdet->channel_level = 0;\n\tdet->notch_level = 0;\n\tdet->tone_present = FALSE;\n\tdet->tone_cycle_duration = 0;\n\tdet->good_cycles = 0;\n\tdet->hit = 0;\n}\n \n\nstatic inline int\necho_can_disable_detector_update(struct ec_disable_detector_state *det,\n\t\t\t\t int16_t amp)\n{\n\tint16_t notched;\n\n\tnotched = biquad2(&det->notch, amp);\n\t \n\tdet->channel_level += ((abs(amp) - det->channel_level) >> 5);\n\tdet->notch_level += ((abs(notched) - det->notch_level) >> 4);\n\tif (det->channel_level > 280) {\n\t\t \n\t\tif (det->notch_level * 6 < det->channel_level) {\n\t\t\t \n\t\t\tif (!det->tone_present) {\n\t\t\t\t \n\t\t\t\tif (det->tone_cycle_duration >= 425 * 8\n\t\t\t\t    && det->tone_cycle_duration <= 475 * 8) {\n\t\t\t\t\tdet->good_cycles++;\n\t\t\t\t\tif (det->good_cycles > 2)\n\t\t\t\t\t\tdet->hit = TRUE;\n\t\t\t\t}\n\t\t\t\tdet->tone_cycle_duration = 0;\n\t\t\t}\n\t\t\tdet->tone_present = TRUE;\n\t\t} else\n\t\t\tdet->tone_present = FALSE;\n\t\tdet->tone_cycle_duration++;\n\t} else {\n\t\tdet->tone_present = FALSE;\n\t\tdet->tone_cycle_duration = 0;\n\t\tdet->good_cycles = 0;\n\t}\n\treturn det->hit;\n}\n \n \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}