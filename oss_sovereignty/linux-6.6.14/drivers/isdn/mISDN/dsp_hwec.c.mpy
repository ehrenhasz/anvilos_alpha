{
  "module_name": "dsp_hwec.c",
  "hash_id": "abf896c6bf2eec301a3c1cf8362e625aaac602319f13bcd4d585c5947d014eea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/isdn/mISDN/dsp_hwec.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/mISDNdsp.h>\n#include <linux/mISDNif.h>\n#include \"core.h\"\n#include \"dsp.h\"\n#include \"dsp_hwec.h\"\n\nstatic struct mISDN_dsp_element_arg args[] = {\n\t{ \"deftaps\", \"128\", \"Set the number of taps of cancellation.\" },\n};\n\nstatic struct mISDN_dsp_element dsp_hwec_p = {\n\t.name = \"hwec\",\n\t.new = NULL,\n\t.free = NULL,\n\t.process_tx = NULL,\n\t.process_rx = NULL,\n\t.num_args = ARRAY_SIZE(args),\n\t.args = args,\n};\nstruct mISDN_dsp_element *dsp_hwec = &dsp_hwec_p;\n\nvoid dsp_hwec_enable(struct dsp *dsp, const char *arg)\n{\n\tint deftaps = 128,\n\t\tlen;\n\tstruct mISDN_ctrl_req\tcq;\n\n\tif (!dsp) {\n\t\tprintk(KERN_ERR \"%s: failed to enable hwec: dsp is NULL\\n\",\n\t\t       __func__);\n\t\treturn;\n\t}\n\n\tif (!arg)\n\t\tgoto _do;\n\n\tlen = strlen(arg);\n\tif (!len)\n\t\tgoto _do;\n\n\t{\n\t\tchar *dup, *tok, *name, *val;\n\t\tint tmp;\n\n\t\tdup = kstrdup(arg, GFP_ATOMIC);\n\t\tif (!dup)\n\t\t\treturn;\n\n\t\twhile ((tok = strsep(&dup, \",\"))) {\n\t\t\tif (!strlen(tok))\n\t\t\t\tcontinue;\n\t\t\tname = strsep(&tok, \"=\");\n\t\t\tval = tok;\n\n\t\t\tif (!val)\n\t\t\t\tcontinue;\n\n\t\t\tif (!strcmp(name, \"deftaps\")) {\n\t\t\t\tif (sscanf(val, \"%d\", &tmp) == 1)\n\t\t\t\t\tdeftaps = tmp;\n\t\t\t}\n\t\t}\n\n\t\tkfree(dup);\n\t}\n\n_do:\n\tprintk(KERN_DEBUG \"%s: enabling hwec with deftaps=%d\\n\",\n\t       __func__, deftaps);\n\tmemset(&cq, 0, sizeof(cq));\n\tcq.op = MISDN_CTRL_HFC_ECHOCAN_ON;\n\tcq.p1 = deftaps;\n\tif (!dsp->ch.peer->ctrl(&dsp->ch, CONTROL_CHANNEL, &cq)) {\n\t\tprintk(KERN_DEBUG \"%s: CONTROL_CHANNEL failed\\n\",\n\t\t       __func__);\n\t\treturn;\n\t}\n}\n\nvoid dsp_hwec_disable(struct dsp *dsp)\n{\n\tstruct mISDN_ctrl_req\tcq;\n\n\tif (!dsp) {\n\t\tprintk(KERN_ERR \"%s: failed to disable hwec: dsp is NULL\\n\",\n\t\t       __func__);\n\t\treturn;\n\t}\n\n\tprintk(KERN_DEBUG \"%s: disabling hwec\\n\", __func__);\n\tmemset(&cq, 0, sizeof(cq));\n\tcq.op = MISDN_CTRL_HFC_ECHOCAN_OFF;\n\tif (!dsp->ch.peer->ctrl(&dsp->ch, CONTROL_CHANNEL, &cq)) {\n\t\tprintk(KERN_DEBUG \"%s: CONTROL_CHANNEL failed\\n\",\n\t\t       __func__);\n\t\treturn;\n\t}\n}\n\nint dsp_hwec_init(void)\n{\n\tmISDN_dsp_element_register(dsp_hwec);\n\n\treturn 0;\n}\n\nvoid dsp_hwec_exit(void)\n{\n\tmISDN_dsp_element_unregister(dsp_hwec);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}