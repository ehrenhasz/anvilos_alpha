{
  "module_name": "dsp_tones.c",
  "hash_id": "c8a9fd1a73743e0d2857a647f1c206578e229583b4142eeb71f6c5f61058a016",
  "original_prompt": "Ingested from linux-6.6.14/drivers/isdn/mISDN/dsp_tones.c",
  "human_readable_source": " \n\n#include <linux/gfp.h>\n#include <linux/mISDNif.h>\n#include <linux/mISDNdsp.h>\n#include \"core.h\"\n#include \"dsp.h\"\n\n\n#define DATA_S sample_silence\n#define SIZE_S (&sizeof_silence)\n#define DATA_GA sample_german_all\n#define SIZE_GA (&sizeof_german_all)\n#define DATA_GO sample_german_old\n#define SIZE_GO (&sizeof_german_old)\n#define DATA_DT sample_american_dialtone\n#define SIZE_DT (&sizeof_american_dialtone)\n#define DATA_RI sample_american_ringing\n#define SIZE_RI (&sizeof_american_ringing)\n#define DATA_BU sample_american_busy\n#define SIZE_BU (&sizeof_american_busy)\n#define DATA_S1 sample_special1\n#define SIZE_S1 (&sizeof_special1)\n#define DATA_S2 sample_special2\n#define SIZE_S2 (&sizeof_special2)\n#define DATA_S3 sample_special3\n#define SIZE_S3 (&sizeof_special3)\n\n \n \n \n\n \n \n\nstatic u8 sample_german_all[] = {\n\t0x80, 0xab, 0x81, 0x6d, 0xfd, 0xdd, 0x5d, 0x9d,\n\t0x4d, 0xd1, 0x89, 0x88, 0xd0, 0x4c, 0x9c, 0x5c,\n\t0xdc, 0xfc, 0x6c,\n\t0x80, 0xab, 0x81, 0x6d, 0xfd, 0xdd, 0x5d, 0x9d,\n\t0x4d, 0xd1, 0x89, 0x88, 0xd0, 0x4c, 0x9c, 0x5c,\n\t0xdc, 0xfc, 0x6c,\n\t0x80, 0xab, 0x81, 0x6d, 0xfd, 0xdd, 0x5d, 0x9d,\n\t0x4d, 0xd1, 0x89, 0x88, 0xd0, 0x4c, 0x9c, 0x5c,\n\t0xdc, 0xfc, 0x6c,\n\t0x80, 0xab, 0x81, 0x6d, 0xfd, 0xdd, 0x5d, 0x9d,\n\t0x4d, 0xd1, 0x89, 0x88, 0xd0, 0x4c, 0x9c, 0x5c,\n\t0xdc, 0xfc, 0x6c,\n};\nstatic u32 sizeof_german_all = sizeof(sample_german_all);\n\nstatic u8 sample_german_old[] = {\n\t0xec, 0x68, 0xe1, 0x6d, 0x6d, 0x91, 0x51, 0xed,\n\t0x6d, 0x01, 0x1e, 0x10, 0x0c, 0x90, 0x60, 0x70,\n\t0x8c,\n\t0xec, 0x68, 0xe1, 0x6d, 0x6d, 0x91, 0x51, 0xed,\n\t0x6d, 0x01, 0x1e, 0x10, 0x0c, 0x90, 0x60, 0x70,\n\t0x8c,\n\t0xec, 0x68, 0xe1, 0x6d, 0x6d, 0x91, 0x51, 0xed,\n\t0x6d, 0x01, 0x1e, 0x10, 0x0c, 0x90, 0x60, 0x70,\n\t0x8c,\n\t0xec, 0x68, 0xe1, 0x6d, 0x6d, 0x91, 0x51, 0xed,\n\t0x6d, 0x01, 0x1e, 0x10, 0x0c, 0x90, 0x60, 0x70,\n\t0x8c,\n};\nstatic u32 sizeof_german_old = sizeof(sample_german_old);\n\nstatic u8 sample_american_dialtone[] = {\n\t0x2a, 0x18, 0x90, 0x6c, 0x4c, 0xbc, 0x4c, 0x6c,\n\t0x10, 0x58, 0x32, 0xb9, 0x31, 0x2d, 0x8d, 0x0d,\n\t0x8d, 0x2d, 0x31, 0x99, 0x0f, 0x28, 0x60, 0xf0,\n\t0xd0, 0x50, 0xd0, 0x30, 0x60, 0x08, 0x8e, 0x67,\n\t0x09, 0x19, 0x21, 0xe1, 0xd9, 0xb9, 0x29, 0x67,\n\t0x83, 0x02, 0xce, 0xbe, 0xee, 0x1a, 0x1b, 0xef,\n\t0xbf, 0xcf, 0x03, 0x82, 0x66, 0x28, 0xb8, 0xd8,\n\t0xe0, 0x20, 0x18, 0x08, 0x66, 0x8f, 0x09, 0x61,\n\t0x31, 0xd1, 0x51, 0xd1, 0xf1, 0x61, 0x29, 0x0e,\n\t0x98, 0x30, 0x2c, 0x8c, 0x0c, 0x8c, 0x2c, 0x30,\n\t0xb8, 0x33, 0x59, 0x11, 0x6d, 0x4d, 0xbd, 0x4d,\n\t0x6d, 0x91, 0x19,\n};\nstatic u32 sizeof_american_dialtone = sizeof(sample_american_dialtone);\n\nstatic u8 sample_american_ringing[] = {\n\t0x2a, 0xe0, 0xac, 0x0c, 0xbc, 0x4c, 0x8c, 0x90,\n\t0x48, 0xc7, 0xc1, 0xed, 0xcd, 0x4d, 0xcd, 0xed,\n\t0xc1, 0xb7, 0x08, 0x30, 0xec, 0xcc, 0xcc, 0x8c,\n\t0x10, 0x58, 0x1a, 0x99, 0x71, 0xed, 0x8d, 0x8d,\n\t0x2d, 0x41, 0x89, 0x9e, 0x20, 0x70, 0x2c, 0xec,\n\t0x2c, 0x70, 0x20, 0x86, 0x77, 0xe1, 0x31, 0x11,\n\t0xd1, 0xf1, 0x81, 0x09, 0xa3, 0x56, 0x58, 0x00,\n\t0x40, 0xc0, 0x60, 0x38, 0x46, 0x43, 0x57, 0x39,\n\t0xd9, 0x59, 0x99, 0xc9, 0x77, 0x2f, 0x2e, 0xc6,\n\t0xd6, 0x28, 0xd6, 0x36, 0x26, 0x2e, 0x8a, 0xa3,\n\t0x43, 0x63, 0x4b, 0x4a, 0x62, 0x42, 0xa2, 0x8b,\n\t0x2f, 0x27, 0x37, 0xd7, 0x29, 0xd7, 0xc7, 0x2f,\n\t0x2e, 0x76, 0xc8, 0x98, 0x58, 0xd8, 0x38, 0x56,\n\t0x42, 0x47, 0x39, 0x61, 0xc1, 0x41, 0x01, 0x59,\n\t0x57, 0xa2, 0x08, 0x80, 0xf0, 0xd0, 0x10, 0x30,\n\t0xe0, 0x76, 0x87, 0x21, 0x71, 0x2d, 0xed, 0x2d,\n\t0x71, 0x21, 0x9f, 0x88, 0x40, 0x2c, 0x8c, 0x8c,\n\t0xec, 0x70, 0x98, 0x1b, 0x59, 0x11, 0x8d, 0xcd,\n\t0xcd, 0xed, 0x31, 0x09, 0xb6, 0xc0, 0xec, 0xcc,\n\t0x4c, 0xcc, 0xec, 0xc0, 0xc6, 0x49, 0x91, 0x8d,\n\t0x4d, 0xbd, 0x0d, 0xad, 0xe1,\n};\nstatic u32 sizeof_american_ringing = sizeof(sample_american_ringing);\n\nstatic u8 sample_american_busy[] = {\n\t0x2a, 0x00, 0x6c, 0x4c, 0x4c, 0x6c, 0xb0, 0x66,\n\t0x99, 0x11, 0x6d, 0x8d, 0x2d, 0x41, 0xd7, 0x96,\n\t0x60, 0xf0, 0x70, 0x40, 0x58, 0xf6, 0x53, 0x57,\n\t0x09, 0x89, 0xd7, 0x5f, 0xe3, 0x2a, 0xe3, 0x5f,\n\t0xd7, 0x89, 0x09, 0x57, 0x53, 0xf6, 0x58, 0x40,\n\t0x70, 0xf0, 0x60, 0x96, 0xd7, 0x41, 0x2d, 0x8d,\n\t0x6d, 0x11, 0x99, 0x66, 0xb0, 0x6c, 0x4c, 0x4c,\n\t0x6c, 0x00, 0x2a, 0x01, 0x6d, 0x4d, 0x4d, 0x6d,\n\t0xb1, 0x67, 0x98, 0x10, 0x6c, 0x8c, 0x2c, 0x40,\n\t0xd6, 0x97, 0x61, 0xf1, 0x71, 0x41, 0x59, 0xf7,\n\t0x52, 0x56, 0x08, 0x88, 0xd6, 0x5e, 0xe2, 0x2a,\n\t0xe2, 0x5e, 0xd6, 0x88, 0x08, 0x56, 0x52, 0xf7,\n\t0x59, 0x41, 0x71, 0xf1, 0x61, 0x97, 0xd6, 0x40,\n\t0x2c, 0x8c, 0x6c, 0x10, 0x98, 0x67, 0xb1, 0x6d,\n\t0x4d, 0x4d, 0x6d, 0x01,\n};\nstatic u32 sizeof_american_busy = sizeof(sample_american_busy);\n\nstatic u8 sample_special1[] = {\n\t0x2a, 0x2c, 0xbc, 0x6c, 0xd6, 0x71, 0xbd, 0x0d,\n\t0xd9, 0x80, 0xcc, 0x4c, 0x40, 0x39, 0x0d, 0xbd,\n\t0x11, 0x86, 0xec, 0xbc, 0xec, 0x0e, 0x51, 0xbd,\n\t0x8d, 0x89, 0x30, 0x4c, 0xcc, 0xe0, 0xe1, 0xcd,\n\t0x4d, 0x31, 0x88, 0x8c, 0xbc, 0x50, 0x0f, 0xed,\n\t0xbd, 0xed, 0x87, 0x10, 0xbc, 0x0c, 0x38, 0x41,\n\t0x4d, 0xcd, 0x81, 0xd8, 0x0c, 0xbc, 0x70, 0xd7,\n\t0x6d, 0xbd, 0x2d,\n};\nstatic u32 sizeof_special1 = sizeof(sample_special1);\n\nstatic u8 sample_special2[] = {\n\t0x2a, 0xcc, 0x8c, 0xd7, 0x4d, 0x2d, 0x18, 0xbc,\n\t0x10, 0xc1, 0xbd, 0xc1, 0x10, 0xbc, 0x18, 0x2d,\n\t0x4d, 0xd7, 0x8c, 0xcc, 0x2a, 0xcd, 0x8d, 0xd6,\n\t0x4c, 0x2c, 0x19, 0xbd, 0x11, 0xc0, 0xbc, 0xc0,\n\t0x11, 0xbd, 0x19, 0x2c, 0x4c, 0xd6, 0x8d, 0xcd,\n\t0x2a, 0xcc, 0x8c, 0xd7, 0x4d, 0x2d, 0x18, 0xbc,\n\t0x10, 0xc1, 0xbd, 0xc1, 0x10, 0xbc, 0x18, 0x2d,\n\t0x4d, 0xd7, 0x8c, 0xcc, 0x2a, 0xcd, 0x8d, 0xd6,\n\t0x4c, 0x2c, 0x19, 0xbd, 0x11, 0xc0, 0xbc, 0xc0,\n\t0x11, 0xbd, 0x19, 0x2c, 0x4c, 0xd6, 0x8d, 0xcd,\n};\nstatic u32 sizeof_special2 = sizeof(sample_special2);\n\nstatic u8 sample_special3[] = {\n\t0x2a, 0xbc, 0x18, 0xcd, 0x11, 0x2c, 0x8c, 0xc1,\n\t0x4d, 0xd6, 0xbc, 0xd6, 0x4d, 0xc1, 0x8c, 0x2c,\n\t0x11, 0xcd, 0x18, 0xbc, 0x2a, 0xbd, 0x19, 0xcc,\n\t0x10, 0x2d, 0x8d, 0xc0, 0x4c, 0xd7, 0xbd, 0xd7,\n\t0x4c, 0xc0, 0x8d, 0x2d, 0x10, 0xcc, 0x19, 0xbd,\n\t0x2a, 0xbc, 0x18, 0xcd, 0x11, 0x2c, 0x8c, 0xc1,\n\t0x4d, 0xd6, 0xbc, 0xd6, 0x4d, 0xc1, 0x8c, 0x2c,\n\t0x11, 0xcd, 0x18, 0xbc, 0x2a, 0xbd, 0x19, 0xcc,\n\t0x10, 0x2d, 0x8d, 0xc0, 0x4c, 0xd7, 0xbd, 0xd7,\n\t0x4c, 0xc0, 0x8d, 0x2d, 0x10, 0xcc, 0x19, 0xbd,\n};\nstatic u32 sizeof_special3 = sizeof(sample_special3);\n\nstatic u8 sample_silence[] = {\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n\t0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a, 0x2a,\n};\nstatic u32 sizeof_silence = sizeof(sample_silence);\n\nstruct tones_samples {\n\tu32 *len;\n\tu8 *data;\n};\nstatic struct\ntones_samples samples[] = {\n\t{&sizeof_german_all, sample_german_all},\n\t{&sizeof_german_old, sample_german_old},\n\t{&sizeof_american_dialtone, sample_american_dialtone},\n\t{&sizeof_american_ringing, sample_american_ringing},\n\t{&sizeof_american_busy, sample_american_busy},\n\t{&sizeof_special1, sample_special1},\n\t{&sizeof_special2, sample_special2},\n\t{&sizeof_special3, sample_special3},\n\t{NULL, NULL},\n};\n\n \n\nvoid\ndsp_audio_generate_ulaw_samples(void)\n{\n\tint i, j;\n\n\ti = 0;\n\twhile (samples[i].len) {\n\t\tj = 0;\n\t\twhile (j < (*samples[i].len)) {\n\t\t\tsamples[i].data[j] =\n\t\t\t\tdsp_audio_alaw_to_ulaw[samples[i].data[j]];\n\t\t\tj++;\n\t\t}\n\t\ti++;\n\t}\n}\n\n\n \n\nstatic struct pattern {\n\tint tone;\n\tu8 *data[10];\n\tu32 *siz[10];\n\tu32 seq[10];\n} pattern[] = {\n\t{TONE_GERMAN_DIALTONE,\n\t {DATA_GA, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GA, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {1900, 0, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_OLDDIALTONE,\n\t {DATA_GO, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GO, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {1998, 0, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_AMERICAN_DIALTONE,\n\t {DATA_DT, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_DT, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {8000, 0, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_DIALPBX,\n\t {DATA_GA, DATA_S, DATA_GA, DATA_S, DATA_GA, DATA_S, NULL, NULL, NULL,\n\t  NULL},\n\t {SIZE_GA, SIZE_S, SIZE_GA, SIZE_S, SIZE_GA, SIZE_S, NULL, NULL, NULL,\n\t  NULL},\n\t {2000, 2000, 2000, 2000, 2000, 12000, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_OLDDIALPBX,\n\t {DATA_GO, DATA_S, DATA_GO, DATA_S, DATA_GO, DATA_S, NULL, NULL, NULL,\n\t  NULL},\n\t {SIZE_GO, SIZE_S, SIZE_GO, SIZE_S, SIZE_GO, SIZE_S, NULL, NULL, NULL,\n\t  NULL},\n\t {2000, 2000, 2000, 2000, 2000, 12000, 0, 0, 0, 0} },\n\n\t{TONE_AMERICAN_DIALPBX,\n\t {DATA_DT, DATA_S, DATA_DT, DATA_S, DATA_DT, DATA_S, NULL, NULL, NULL,\n\t  NULL},\n\t {SIZE_DT, SIZE_S, SIZE_DT, SIZE_S, SIZE_DT, SIZE_S, NULL, NULL, NULL,\n\t  NULL},\n\t {2000, 2000, 2000, 2000, 2000, 12000, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_RINGING,\n\t {DATA_GA, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GA, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {8000, 32000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_OLDRINGING,\n\t {DATA_GO, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GO, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {8000, 40000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_AMERICAN_RINGING,\n\t {DATA_RI, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_RI, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {8000, 32000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_RINGPBX,\n\t {DATA_GA, DATA_S, DATA_GA, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GA, SIZE_S, SIZE_GA, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {4000, 4000, 4000, 28000, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_OLDRINGPBX,\n\t {DATA_GO, DATA_S, DATA_GO, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GO, SIZE_S, SIZE_GO, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {4000, 4000, 4000, 28000, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_AMERICAN_RINGPBX,\n\t {DATA_RI, DATA_S, DATA_RI, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_RI, SIZE_S, SIZE_RI, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {4000, 4000, 4000, 28000, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_BUSY,\n\t {DATA_GA, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GA, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {4000, 4000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_OLDBUSY,\n\t {DATA_GO, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GO, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {1000, 5000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_AMERICAN_BUSY,\n\t {DATA_BU, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_BU, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {4000, 4000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_HANGUP,\n\t {DATA_GA, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GA, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {4000, 4000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_OLDHANGUP,\n\t {DATA_GO, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GO, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {1000, 5000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_AMERICAN_HANGUP,\n\t {DATA_DT, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_DT, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {8000, 0, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_SPECIAL_INFO,\n\t {DATA_S1, DATA_S2, DATA_S3, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_S1, SIZE_S2, SIZE_S3, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {2666, 2666, 2666, 8002, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_GASSENBESETZT,\n\t {DATA_GA, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GA, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {2000, 2000, 0, 0, 0, 0, 0, 0, 0, 0} },\n\n\t{TONE_GERMAN_AUFSCHALTTON,\n\t {DATA_GO, DATA_S, DATA_GO, DATA_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {SIZE_GO, SIZE_S, SIZE_GO, SIZE_S, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {1000, 5000, 1000, 17000, 0, 0, 0, 0, 0, 0} },\n\n\t{0,\n\t {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL, NULL},\n\t {0, 0, 0, 0, 0, 0, 0, 0, 0, 0} },\n};\n\n \n\n \nvoid dsp_tone_copy(struct dsp *dsp, u8 *data, int len)\n{\n\tint index, count, start, num;\n\tstruct pattern *pat;\n\tstruct dsp_tone *tone = &dsp->tone;\n\n\t \n\tif (!tone->tone) {\n\t\tmemset(data, dsp_silence, len);\n\t\treturn;\n\t}\n\n\t \n\tpat = (struct pattern *)tone->pattern;\n\t \n\tindex = tone->index;  \n\tcount = tone->count;  \n\n\t \n\twhile (len) {\n\t\t \n\t\twhile (42) {\n\t\t\t \n\t\t\tif (!pat->seq[index]) {\n\t\t\t\tcount = 0;\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\t \n\t\t\tif (count < pat->seq[index])\n\t\t\t\tbreak;\n\t\t\tif (dsp_debug & DEBUG_DSP_TONE)\n\t\t\t\tprintk(KERN_DEBUG \"%s: reaching next sequence \"\n\t\t\t\t       \"(index=%d)\\n\", __func__, index);\n\t\t\tcount -= pat->seq[index];\n\t\t\tindex++;\n\t\t}\n\t\t \n\t\tstart = count % (*(pat->siz[index]));\n\t\tnum = len;\n\t\tif (num + count > pat->seq[index])\n\t\t\tnum = pat->seq[index] - count;\n\t\tif (num + start > (*(pat->siz[index])))\n\t\t\tnum = (*(pat->siz[index])) - start;\n\t\t \n\t\tmemcpy(data, pat->data[index] + start, num);\n\t\t \n\t\tdata += num;\n\t\tcount += num;\n\t\tlen -= num;\n\t}\n\ttone->index = index;\n\ttone->count = count;\n\n\t \n\treturn;\n}\n\n\n \n\nstatic void\ndsp_tone_hw_message(struct dsp *dsp, u8 *sample, int len)\n{\n\tstruct sk_buff *nskb;\n\n\t \n\tnskb = _alloc_mISDN_skb(PH_CONTROL_REQ,\n\t\t\t\t(len) ? HFC_SPL_LOOP_ON : HFC_SPL_LOOP_OFF, len, sample,\n\t\t\t\tGFP_ATOMIC);\n\tif (nskb) {\n\t\tif (dsp->ch.peer) {\n\t\t\tif (dsp->ch.recv(dsp->ch.peer, nskb))\n\t\t\t\tdev_kfree_skb(nskb);\n\t\t} else\n\t\t\tdev_kfree_skb(nskb);\n\t}\n}\n\n\n \nvoid\ndsp_tone_timeout(struct timer_list *t)\n{\n\tstruct dsp *dsp = from_timer(dsp, t, tone.tl);\n\tstruct dsp_tone *tone = &dsp->tone;\n\tstruct pattern *pat = (struct pattern *)tone->pattern;\n\tint index = tone->index;\n\n\tif (!tone->tone)\n\t\treturn;\n\n\tindex++;\n\tif (!pat->seq[index])\n\t\tindex = 0;\n\ttone->index = index;\n\n\t \n\tif (pat->data[index] == DATA_S)\n\t\tdsp_tone_hw_message(dsp, NULL, 0);\n\telse\n\t\tdsp_tone_hw_message(dsp, pat->data[index], *(pat->siz[index]));\n\t \n\ttone->tl.expires = jiffies + (pat->seq[index] * HZ) / 8000;\n\tadd_timer(&tone->tl);\n}\n\n\n \n\n \nint\ndsp_tone(struct dsp *dsp, int tone)\n{\n\tstruct pattern *pat;\n\tint i;\n\tstruct dsp_tone *tonet = &dsp->tone;\n\n\ttonet->software = 0;\n\ttonet->hardware = 0;\n\n\t \n\tif (!tone) {\n\t\tif (dsp->features.hfc_loops && timer_pending(&tonet->tl))\n\t\t\tdel_timer(&tonet->tl);\n\t\tif (dsp->features.hfc_loops)\n\t\t\tdsp_tone_hw_message(dsp, NULL, 0);\n\t\ttonet->tone = 0;\n\t\treturn 0;\n\t}\n\n\tpat = NULL;\n\ti = 0;\n\twhile (pattern[i].tone) {\n\t\tif (pattern[i].tone == tone) {\n\t\t\tpat = &pattern[i];\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\tif (!pat) {\n\t\tprintk(KERN_WARNING \"dsp: given tone 0x%x is invalid\\n\", tone);\n\t\treturn -EINVAL;\n\t}\n\tif (dsp_debug & DEBUG_DSP_TONE)\n\t\tprintk(KERN_DEBUG \"%s: now starting tone %d (index=%d)\\n\",\n\t\t       __func__, tone, 0);\n\ttonet->tone = tone;\n\ttonet->pattern = pat;\n\ttonet->index = 0;\n\ttonet->count = 0;\n\n\tif (dsp->features.hfc_loops) {\n\t\ttonet->hardware = 1;\n\t\t \n\t\tdsp_tone_hw_message(dsp, pat->data[0], *(pat->siz[0]));\n\t\t \n\t\tif (timer_pending(&tonet->tl))\n\t\t\tdel_timer(&tonet->tl);\n\t\ttonet->tl.expires = jiffies + (pat->seq[0] * HZ) / 8000;\n\t\tadd_timer(&tonet->tl);\n\t} else {\n\t\ttonet->software = 1;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}