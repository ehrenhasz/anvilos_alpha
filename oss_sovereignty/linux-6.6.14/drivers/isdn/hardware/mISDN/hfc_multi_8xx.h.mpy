{
  "module_name": "hfc_multi_8xx.h",
  "hash_id": "08e478905a0604b5f33c18ccffb65c567f85c70993020f984d3af8937d1fe71c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/isdn/hardware/mISDN/hfc_multi_8xx.h",
  "human_readable_source": " \n \n\n#include <asm/cpm1.h>\n\n \n#ifndef IMAP_ADDR\n#define IMAP_ADDR\t0xFFF00000\n#endif\n\nstatic void\n#ifdef HFC_REGISTER_DEBUG\nHFC_outb_embsd(struct hfc_multi *hc, u_char reg, u_char val,\n\t       const char *function, int line)\n#else\n\tHFC_outb_embsd(struct hfc_multi *hc, u_char reg, u_char val)\n#endif\n{\n\thc->immap->im_ioport.iop_padat |= PA_XHFC_A0;\n\twriteb(reg, hc->xhfc_memaddr);\n\thc->immap->im_ioport.iop_padat &= ~(PA_XHFC_A0);\n\twriteb(val, hc->xhfc_memdata);\n}\nstatic u_char\n#ifdef HFC_REGISTER_DEBUG\nHFC_inb_embsd(struct hfc_multi *hc, u_char reg, const char *function, int line)\n#else\n\tHFC_inb_embsd(struct hfc_multi *hc, u_char reg)\n#endif\n{\n\thc->immap->im_ioport.iop_padat |= PA_XHFC_A0;\n\twriteb(reg, hc->xhfc_memaddr);\n\thc->immap->im_ioport.iop_padat &= ~(PA_XHFC_A0);\n\treturn readb(hc->xhfc_memdata);\n}\nstatic u_short\n#ifdef HFC_REGISTER_DEBUG\nHFC_inw_embsd(struct hfc_multi *hc, u_char reg, const char *function, int line)\n#else\n\tHFC_inw_embsd(struct hfc_multi *hc, u_char reg)\n#endif\n{\n\thc->immap->im_ioport.iop_padat |= PA_XHFC_A0;\n\twriteb(reg, hc->xhfc_memaddr);\n\thc->immap->im_ioport.iop_padat &= ~(PA_XHFC_A0);\n\treturn readb(hc->xhfc_memdata);\n}\nstatic void\n#ifdef HFC_REGISTER_DEBUG\nHFC_wait_embsd(struct hfc_multi *hc, const char *function, int line)\n#else\n\tHFC_wait_embsd(struct hfc_multi *hc)\n#endif\n{\n\thc->immap->im_ioport.iop_padat |= PA_XHFC_A0;\n\twriteb(R_STATUS, hc->xhfc_memaddr);\n\thc->immap->im_ioport.iop_padat &= ~(PA_XHFC_A0);\n\twhile (readb(hc->xhfc_memdata) & V_BUSY)\n\t\tcpu_relax();\n}\n\n \nvoid\nwrite_fifo_embsd(struct hfc_multi *hc, u_char *data, int len)\n{\n\thc->immap->im_ioport.iop_padat |= PA_XHFC_A0;\n\t*hc->xhfc_memaddr = A_FIFO_DATA0;\n\thc->immap->im_ioport.iop_padat &= ~(PA_XHFC_A0);\n\twhile (len) {\n\t\t*hc->xhfc_memdata = *data;\n\t\tdata++;\n\t\tlen--;\n\t}\n}\n\n \nvoid\nread_fifo_embsd(struct hfc_multi *hc, u_char *data, int len)\n{\n\thc->immap->im_ioport.iop_padat |= PA_XHFC_A0;\n\t*hc->xhfc_memaddr = A_FIFO_DATA0;\n\thc->immap->im_ioport.iop_padat &= ~(PA_XHFC_A0);\n\twhile (len) {\n\t\t*data = (u_char)(*hc->xhfc_memdata);\n\t\tdata++;\n\t\tlen--;\n\t}\n}\n\nstatic int\nsetup_embedded(struct hfc_multi *hc, struct hm_map *m)\n{\n\tprintk(KERN_INFO\n\t       \"HFC-multi: card manufacturer: '%s' card name: '%s' clock: %s\\n\",\n\t       m->vendor_name, m->card_name, m->clock2 ? \"double\" : \"normal\");\n\n\thc->pci_dev = NULL;\n\tif (m->clock2)\n\t\ttest_and_set_bit(HFC_CHIP_CLOCK2, &hc->chip);\n\n\thc->leds = m->leds;\n\thc->ledstate = 0xAFFEAFFE;\n\thc->opticalsupport = m->opticalsupport;\n\n\thc->pci_iobase = 0;\n\thc->pci_membase = 0;\n\thc->xhfc_membase = NULL;\n\thc->xhfc_memaddr = NULL;\n\thc->xhfc_memdata = NULL;\n\n\t \n\tif (m->io_mode)  \n\t\thc->io_mode = m->io_mode;\n\tswitch (hc->io_mode) {\n\tcase HFC_IO_MODE_EMBSD:\n\t\ttest_and_set_bit(HFC_CHIP_EMBSD, &hc->chip);\n\t\thc->slots = 128;  \n\t\thc->HFC_outb = HFC_outb_embsd;\n\t\thc->HFC_inb = HFC_inb_embsd;\n\t\thc->HFC_inw = HFC_inw_embsd;\n\t\thc->HFC_wait = HFC_wait_embsd;\n\t\thc->read_fifo = read_fifo_embsd;\n\t\thc->write_fifo = write_fifo_embsd;\n\t\thc->xhfc_origmembase = XHFC_MEMBASE + XHFC_OFFSET * hc->id;\n\t\thc->xhfc_membase = (u_char *)ioremap(hc->xhfc_origmembase,\n\t\t\t\t\t\t     XHFC_MEMSIZE);\n\t\tif (!hc->xhfc_membase) {\n\t\t\tprintk(KERN_WARNING\n\t\t\t       \"HFC-multi: failed to remap xhfc address space. \"\n\t\t\t       \"(internal error)\\n\");\n\t\t\treturn -EIO;\n\t\t}\n\t\thc->xhfc_memaddr = (u_long *)(hc->xhfc_membase + 4);\n\t\thc->xhfc_memdata = (u_long *)(hc->xhfc_membase);\n\t\tprintk(KERN_INFO\n\t\t       \"HFC-multi: xhfc_membase:%#lx xhfc_origmembase:%#lx \"\n\t\t       \"xhfc_memaddr:%#lx xhfc_memdata:%#lx\\n\",\n\t\t       (u_long)hc->xhfc_membase, hc->xhfc_origmembase,\n\t\t       (u_long)hc->xhfc_memaddr, (u_long)hc->xhfc_memdata);\n\t\tbreak;\n\tdefault:\n\t\tprintk(KERN_WARNING \"HFC-multi: Invalid IO mode.\\n\");\n\t\treturn -EIO;\n\t}\n\n\t \n\thc->immap = (struct immap *)(IMAP_ADDR);\n\thc->immap->im_ioport.iop_papar &= ~(PA_XHFC_A0);\n\thc->immap->im_ioport.iop_paodr &= ~(PA_XHFC_A0);\n\thc->immap->im_ioport.iop_padir |=   PA_XHFC_A0;\n\n\t \n\thc->pb_irqmsk = (PB_XHFC_IRQ1 << hc->id);\n\thc->immap->im_cpm.cp_pbpar &= ~(hc->pb_irqmsk);\n\thc->immap->im_cpm.cp_pbodr &= ~(hc->pb_irqmsk);\n\thc->immap->im_cpm.cp_pbdir &= ~(hc->pb_irqmsk);\n\n\t \n\t \n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}