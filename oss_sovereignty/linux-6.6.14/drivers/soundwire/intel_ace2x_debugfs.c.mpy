{
  "module_name": "intel_ace2x_debugfs.c",
  "hash_id": "f4cdc5fb625126c5b149af1760ea5808d326bd13302e7ee40f3eaad92de7855e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soundwire/intel_ace2x_debugfs.c",
  "human_readable_source": "\n\n\n#include <linux/acpi.h>\n#include <linux/debugfs.h>\n#include <linux/delay.h>\n#include <linux/device.h>\n#include <linux/io.h>\n#include <linux/pm_runtime.h>\n#include <linux/soundwire/sdw.h>\n#include <linux/soundwire/sdw_intel.h>\n#include <linux/soundwire/sdw_registers.h>\n#include \"bus.h\"\n#include \"cadence_master.h\"\n#include \"intel.h\"\n\n \n#ifdef CONFIG_DEBUG_FS\n\n#define RD_BUF (2 * PAGE_SIZE)\n\nstatic ssize_t intel_sprintf(void __iomem *mem, bool l,\n\t\t\t     char *buf, size_t pos, unsigned int reg)\n{\n\tint value;\n\n\tif (l)\n\t\tvalue = intel_readl(mem, reg);\n\telse\n\t\tvalue = intel_readw(mem, reg);\n\n\treturn scnprintf(buf + pos, RD_BUF - pos, \"%4x\\t%4x\\n\", reg, value);\n}\n\nstatic int intel_reg_show(struct seq_file *s_file, void *data)\n{\n\tstruct sdw_intel *sdw = s_file->private;\n\tvoid __iomem *s = sdw->link_res->shim;\n\tvoid __iomem *vs_s = sdw->link_res->shim_vs;\n\tssize_t ret;\n\tu32 pcm_cap;\n\tint pcm_bd;\n\tchar *buf;\n\tint j;\n\n\tbuf = kzalloc(RD_BUF, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tret = scnprintf(buf, RD_BUF, \"Register  Value\\n\");\n\tret += scnprintf(buf + ret, RD_BUF - ret, \"\\nShim\\n\");\n\n\tret += intel_sprintf(s, true, buf, ret, SDW_SHIM2_LECAP);\n\tret += intel_sprintf(s, false, buf, ret, SDW_SHIM2_PCMSCAP);\n\n\tpcm_cap = intel_readw(s, SDW_SHIM2_PCMSCAP);\n\tpcm_bd = FIELD_GET(SDW_SHIM2_PCMSCAP_BSS, pcm_cap);\n\n\tfor (j = 0; j < pcm_bd; j++) {\n\t\tret += intel_sprintf(s, false, buf, ret,\n\t\t\t\tSDW_SHIM2_PCMSYCHM(j));\n\t\tret += intel_sprintf(s, false, buf, ret,\n\t\t\t\tSDW_SHIM2_PCMSYCHC(j));\n\t}\n\n\tret += scnprintf(buf + ret, RD_BUF - ret, \"\\nVS CLK controls\\n\");\n\tret += intel_sprintf(vs_s, true, buf, ret, SDW_SHIM2_INTEL_VS_LVSCTL);\n\n\tret += scnprintf(buf + ret, RD_BUF - ret, \"\\nVS Wake registers\\n\");\n\tret += intel_sprintf(vs_s, false, buf, ret, SDW_SHIM2_INTEL_VS_WAKEEN);\n\tret += intel_sprintf(vs_s, false, buf, ret, SDW_SHIM2_INTEL_VS_WAKESTS);\n\n\tret += scnprintf(buf + ret, RD_BUF - ret, \"\\nVS IOCTL, ACTMCTL\\n\");\n\tret += intel_sprintf(vs_s, false, buf, ret, SDW_SHIM2_INTEL_VS_IOCTL);\n\tret += intel_sprintf(vs_s, false, buf, ret, SDW_SHIM2_INTEL_VS_ACTMCTL);\n\n\tseq_printf(s_file, \"%s\", buf);\n\tkfree(buf);\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(intel_reg);\n\nstatic int intel_set_m_datamode(void *data, u64 value)\n{\n\tstruct sdw_intel *sdw = data;\n\tstruct sdw_bus *bus = &sdw->cdns.bus;\n\n\tif (value > SDW_PORT_DATA_MODE_STATIC_1)\n\t\treturn -EINVAL;\n\n\t \n\tadd_taint(TAINT_USER, LOCKDEP_STILL_OK);\n\n\tbus->params.m_data_mode = value;\n\n\treturn 0;\n}\nDEFINE_DEBUGFS_ATTRIBUTE(intel_set_m_datamode_fops, NULL,\n\t\t\t intel_set_m_datamode, \"%llu\\n\");\n\nstatic int intel_set_s_datamode(void *data, u64 value)\n{\n\tstruct sdw_intel *sdw = data;\n\tstruct sdw_bus *bus = &sdw->cdns.bus;\n\n\tif (value > SDW_PORT_DATA_MODE_STATIC_1)\n\t\treturn -EINVAL;\n\n\t \n\tadd_taint(TAINT_USER, LOCKDEP_STILL_OK);\n\n\tbus->params.s_data_mode = value;\n\n\treturn 0;\n}\nDEFINE_DEBUGFS_ATTRIBUTE(intel_set_s_datamode_fops, NULL,\n\t\t\t intel_set_s_datamode, \"%llu\\n\");\n\nvoid intel_ace2x_debugfs_init(struct sdw_intel *sdw)\n{\n\tstruct dentry *root = sdw->cdns.bus.debugfs;\n\n\tif (!root)\n\t\treturn;\n\n\tsdw->debugfs = debugfs_create_dir(\"intel-sdw\", root);\n\n\tdebugfs_create_file(\"intel-registers\", 0400, sdw->debugfs, sdw,\n\t\t\t    &intel_reg_fops);\n\n\tdebugfs_create_file(\"intel-m-datamode\", 0200, sdw->debugfs, sdw,\n\t\t\t    &intel_set_m_datamode_fops);\n\n\tdebugfs_create_file(\"intel-s-datamode\", 0200, sdw->debugfs, sdw,\n\t\t\t    &intel_set_s_datamode_fops);\n\n\tsdw_cdns_debugfs_init(&sdw->cdns, sdw->debugfs);\n}\n\nvoid intel_ace2x_debugfs_exit(struct sdw_intel *sdw)\n{\n\tdebugfs_remove_recursive(sdw->debugfs);\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}