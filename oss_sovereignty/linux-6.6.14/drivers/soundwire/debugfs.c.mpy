{
  "module_name": "debugfs.c",
  "hash_id": "20c97dfdb34937b4b99840a821bb44c0827f7f759c984ce42330298d38b9c31a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soundwire/debugfs.c",
  "human_readable_source": "\n\n\n#include <linux/device.h>\n#include <linux/debugfs.h>\n#include <linux/mod_devicetable.h>\n#include <linux/pm_runtime.h>\n#include <linux/slab.h>\n#include <linux/soundwire/sdw.h>\n#include <linux/soundwire/sdw_registers.h>\n#include \"bus.h\"\n\nstatic struct dentry *sdw_debugfs_root;\n\nvoid sdw_bus_debugfs_init(struct sdw_bus *bus)\n{\n\tchar name[16];\n\n\tif (!sdw_debugfs_root)\n\t\treturn;\n\n\t \n\tsnprintf(name, sizeof(name), \"master-%d-%d\", bus->id, bus->link_id);\n\tbus->debugfs = debugfs_create_dir(name, sdw_debugfs_root);\n}\n\nvoid sdw_bus_debugfs_exit(struct sdw_bus *bus)\n{\n\tdebugfs_remove_recursive(bus->debugfs);\n}\n\n#define RD_BUF (3 * PAGE_SIZE)\n\nstatic ssize_t sdw_sprintf(struct sdw_slave *slave,\n\t\t\t   char *buf, size_t pos, unsigned int reg)\n{\n\tint value;\n\n\tvalue = sdw_read_no_pm(slave, reg);\n\n\tif (value < 0)\n\t\treturn scnprintf(buf + pos, RD_BUF - pos, \"%3x\\tXX\\n\", reg);\n\telse\n\t\treturn scnprintf(buf + pos, RD_BUF - pos,\n\t\t\t\t\"%3x\\t%2x\\n\", reg, value);\n}\n\nstatic int sdw_slave_reg_show(struct seq_file *s_file, void *data)\n{\n\tstruct sdw_slave *slave = s_file->private;\n\tchar *buf;\n\tssize_t ret;\n\tint i, j;\n\n\tbuf = kzalloc(RD_BUF, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tret = pm_runtime_get_sync(&slave->dev);\n\tif (ret < 0 && ret != -EACCES) {\n\t\tpm_runtime_put_noidle(&slave->dev);\n\t\tkfree(buf);\n\t\treturn ret;\n\t}\n\n\tret = scnprintf(buf, RD_BUF, \"Register  Value\\n\");\n\n\t \n\tret += scnprintf(buf + ret, RD_BUF - ret, \"\\nDP0\\n\");\n\tfor (i = SDW_DP0_INT; i <= SDW_DP0_PREPARECTRL; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\n\t \n\tret += scnprintf(buf + ret, RD_BUF - ret, \"Bank0\\n\");\n\tret += sdw_sprintf(slave, buf, ret, SDW_DP0_CHANNELEN);\n\tfor (i = SDW_DP0_SAMPLECTRL1; i <= SDW_DP0_LANECTRL; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\n\t \n\tret += scnprintf(buf + ret, RD_BUF - ret, \"Bank1\\n\");\n\tret += sdw_sprintf(slave, buf, ret,\n\t\t\tSDW_DP0_CHANNELEN + SDW_BANK1_OFFSET);\n\tfor (i = SDW_DP0_SAMPLECTRL1 + SDW_BANK1_OFFSET;\n\t\t\ti <= SDW_DP0_LANECTRL + SDW_BANK1_OFFSET; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\n\t \n\tret += scnprintf(buf + ret, RD_BUF - ret, \"\\nSCP\\n\");\n\tfor (i = SDW_SCP_INT1; i <= SDW_SCP_BUS_CLOCK_BASE; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\tfor (i = SDW_SCP_DEVID_0; i <= SDW_SCP_DEVID_5; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\tfor (i = SDW_SCP_FRAMECTRL_B0; i <= SDW_SCP_BUSCLOCK_SCALE_B0; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\tfor (i = SDW_SCP_FRAMECTRL_B1; i <= SDW_SCP_BUSCLOCK_SCALE_B1; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\tfor (i = SDW_SCP_PHY_OUT_CTRL_0; i <= SDW_SCP_PHY_OUT_CTRL_7; i++)\n\t\tret += sdw_sprintf(slave, buf, ret, i);\n\n\n\t \n\n\t \n\tfor (i = 1; SDW_VALID_PORT_RANGE(i); i++) {\n\n\t\t \n\t\tret += scnprintf(buf + ret, RD_BUF - ret, \"\\nDP%d\\n\", i);\n\t\tfor (j = SDW_DPN_INT(i); j <= SDW_DPN_PREPARECTRL(i); j++)\n\t\t\tret += sdw_sprintf(slave, buf, ret, j);\n\n\t\t \n\t\tret += scnprintf(buf + ret, RD_BUF - ret, \"Bank0\\n\");\n\t\tfor (j = SDW_DPN_CHANNELEN_B0(i);\n\t\t     j <= SDW_DPN_LANECTRL_B0(i); j++)\n\t\t\tret += sdw_sprintf(slave, buf, ret, j);\n\n\t\t \n\t\tret += scnprintf(buf + ret, RD_BUF - ret, \"Bank1\\n\");\n\t\tfor (j = SDW_DPN_CHANNELEN_B1(i);\n\t\t     j <= SDW_DPN_LANECTRL_B1(i); j++)\n\t\t\tret += sdw_sprintf(slave, buf, ret, j);\n\t}\n\n\tseq_printf(s_file, \"%s\", buf);\n\n\tpm_runtime_mark_last_busy(&slave->dev);\n\tpm_runtime_put(&slave->dev);\n\n\tkfree(buf);\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(sdw_slave_reg);\n\nvoid sdw_slave_debugfs_init(struct sdw_slave *slave)\n{\n\tstruct dentry *master;\n\tstruct dentry *d;\n\tchar name[32];\n\n\tmaster = slave->bus->debugfs;\n\n\t \n\tsnprintf(name, sizeof(name), \"%s\", dev_name(&slave->dev));\n\td = debugfs_create_dir(name, master);\n\n\tdebugfs_create_file(\"registers\", 0400, d, slave, &sdw_slave_reg_fops);\n\n\tslave->debugfs = d;\n}\n\nvoid sdw_slave_debugfs_exit(struct sdw_slave *slave)\n{\n\tdebugfs_remove_recursive(slave->debugfs);\n}\n\nvoid sdw_debugfs_init(void)\n{\n\tsdw_debugfs_root = debugfs_create_dir(\"soundwire\", NULL);\n}\n\nvoid sdw_debugfs_exit(void)\n{\n\tdebugfs_remove_recursive(sdw_debugfs_root);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}