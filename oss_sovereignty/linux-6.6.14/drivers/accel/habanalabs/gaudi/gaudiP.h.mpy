{
  "module_name": "gaudiP.h",
  "hash_id": "e66eb8d08230288ecdd5829c9899c60db30b5b0728ba9a9881b3545f8c23d80a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/accel/habanalabs/gaudi/gaudiP.h",
  "human_readable_source": " \n\n#ifndef GAUDIP_H_\n#define GAUDIP_H_\n\n#include <uapi/drm/habanalabs_accel.h>\n#include \"../common/habanalabs.h\"\n#include \"../include/common/hl_boot_if.h\"\n#include \"../include/gaudi/gaudi_packets.h\"\n#include \"../include/gaudi/gaudi.h\"\n#include \"../include/gaudi/gaudi_async_events.h\"\n#include \"../include/gaudi/gaudi_fw_if.h\"\n\n#define NUMBER_OF_EXT_HW_QUEUES\t\t8\n#define NUMBER_OF_CMPLT_QUEUES\t\tNUMBER_OF_EXT_HW_QUEUES\n#define NUMBER_OF_CPU_HW_QUEUES\t\t1\n#define NUMBER_OF_INT_HW_QUEUES\t\t100\n#define NUMBER_OF_HW_QUEUES\t\t(NUMBER_OF_EXT_HW_QUEUES + \\\n\t\t\t\t\tNUMBER_OF_CPU_HW_QUEUES + \\\n\t\t\t\t\tNUMBER_OF_INT_HW_QUEUES)\n\n \n#define NUMBER_OF_COLLECTIVE_QUEUES\t12\n#define NUMBER_OF_SOBS_IN_GRP\t\t11\n\n#define GAUDI_STREAM_MASTER_ARR_SIZE\t8\n\n#define CORESIGHT_TIMEOUT_USEC\t\t100000\t\t \n\n#define GAUDI_MAX_CLK_FREQ\t\t2200000000ull\t \n\n#define MAX_POWER_DEFAULT_PCI\t\t200000\t\t \n#define MAX_POWER_DEFAULT_PMC\t\t350000\t\t \n\n#define DC_POWER_DEFAULT_PCI\t\t60000\t\t \n#define DC_POWER_DEFAULT_PMC\t\t60000\t\t \n\n#define DC_POWER_DEFAULT_PMC_SEC\t97000\t\t \n\n#define GAUDI_CPU_TIMEOUT_USEC\t\t30000000\t \n\n#define TPC_ENABLED_MASK\t\t0xFF\n\n#define GAUDI_HBM_SIZE_32GB\t\t0x800000000ull\n#define GAUDI_HBM_DEVICES\t\t4\n#define GAUDI_HBM_CHANNELS\t\t8\n#define GAUDI_HBM_CFG_BASE\t\t(mmHBM0_BASE - CFG_BASE)\n#define GAUDI_HBM_CFG_OFFSET\t\t(mmHBM1_BASE - mmHBM0_BASE)\n\n#define DMA_MAX_TRANSFER_SIZE\t\tU32_MAX\n\n#define GAUDI_DEFAULT_CARD_NAME\t\t\"HL205\"\n\n#define GAUDI_MAX_PENDING_CS\t\tSZ_16K\n\n#if !IS_MAX_PENDING_CS_VALID(GAUDI_MAX_PENDING_CS)\n#error \"GAUDI_MAX_PENDING_CS must be power of 2 and greater than 1\"\n#endif\n\n#define PCI_DMA_NUMBER_OF_CHNLS\t\t2\n#define HBM_DMA_NUMBER_OF_CHNLS\t\t6\n#define DMA_NUMBER_OF_CHNLS\t\t(PCI_DMA_NUMBER_OF_CHNLS + \\\n\t\t\t\t\t\tHBM_DMA_NUMBER_OF_CHNLS)\n\n#define MME_NUMBER_OF_SLAVE_ENGINES\t2\n#define MME_NUMBER_OF_ENGINES\t\t(MME_NUMBER_OF_MASTER_ENGINES + \\\n\t\t\t\t\tMME_NUMBER_OF_SLAVE_ENGINES)\n#define MME_NUMBER_OF_QMANS\t\t(MME_NUMBER_OF_MASTER_ENGINES * \\\n\t\t\t\t\tQMAN_STREAMS)\n\n#define QMAN_STREAMS\t\t4\n#define PQ_FETCHER_CACHE_SIZE\t8\n\n#define DMA_QMAN_OFFSET\t\t(mmDMA1_QM_BASE - mmDMA0_QM_BASE)\n#define TPC_QMAN_OFFSET\t\t(mmTPC1_QM_BASE - mmTPC0_QM_BASE)\n#define MME_QMAN_OFFSET\t\t(mmMME1_QM_BASE - mmMME0_QM_BASE)\n#define NIC_MACRO_QMAN_OFFSET\t(mmNIC1_QM0_BASE - mmNIC0_QM0_BASE)\n#define NIC_ENGINE_QMAN_OFFSET\t(mmNIC0_QM1_BASE - mmNIC0_QM0_BASE)\n\n#define TPC_CFG_OFFSET\t\t(mmTPC1_CFG_BASE - mmTPC0_CFG_BASE)\n\n#define DMA_CORE_OFFSET\t\t(mmDMA1_CORE_BASE - mmDMA0_CORE_BASE)\n\n#define QMAN_LDMA_SRC_OFFSET\t(mmDMA0_CORE_SRC_BASE_LO - mmDMA0_CORE_CFG_0)\n#define QMAN_LDMA_DST_OFFSET\t(mmDMA0_CORE_DST_BASE_LO - mmDMA0_CORE_CFG_0)\n#define QMAN_LDMA_SIZE_OFFSET\t(mmDMA0_CORE_DST_TSIZE_0 - mmDMA0_CORE_CFG_0)\n\n#define QMAN_CPDMA_SRC_OFFSET\t(mmDMA0_QM_CQ_PTR_LO_4 - mmDMA0_CORE_CFG_0)\n#define QMAN_CPDMA_DST_OFFSET\t(mmDMA0_CORE_DST_BASE_LO - mmDMA0_CORE_CFG_0)\n#define QMAN_CPDMA_SIZE_OFFSET\t(mmDMA0_QM_CQ_TSIZE_4 - mmDMA0_CORE_CFG_0)\n\n#define SIF_RTR_CTRL_OFFSET\t(mmSIF_RTR_CTRL_1_BASE - mmSIF_RTR_CTRL_0_BASE)\n\n#define NIF_RTR_CTRL_OFFSET\t(mmNIF_RTR_CTRL_1_BASE - mmNIF_RTR_CTRL_0_BASE)\n\n#define MME_ACC_OFFSET\t\t(mmMME1_ACC_BASE - mmMME0_ACC_BASE)\n#define SRAM_BANK_OFFSET\t(mmSRAM_Y0_X1_RTR_BASE - mmSRAM_Y0_X0_RTR_BASE)\n\n#define NUM_OF_SOB_IN_BLOCK\t\t\\\n\t(((mmSYNC_MNGR_E_N_SYNC_MNGR_OBJS_SOB_OBJ_2047 - \\\n\tmmSYNC_MNGR_E_N_SYNC_MNGR_OBJS_SOB_OBJ_0) + 4) >> 2)\n\n#define NUM_OF_MONITORS_IN_BLOCK\t\\\n\t(((mmSYNC_MNGR_E_N_SYNC_MNGR_OBJS_MON_STATUS_511 - \\\n\tmmSYNC_MNGR_E_N_SYNC_MNGR_OBJS_MON_STATUS_0) + 4) >> 2)\n\n#define MONITOR_MAX_SOBS\t8\n\n \n\n#define CPU_FW_IMAGE_SIZE\t0x10000000\t \n#define MMU_PAGE_TABLES_SIZE\t0x0BF00000\t \n#define MMU_CACHE_MNG_SIZE\t0x00100000\t \n#define RESERVED\t\t0x04000000\t \n\n#define CPU_FW_IMAGE_ADDR\tDRAM_PHYS_BASE\n#define MMU_PAGE_TABLES_ADDR\t(CPU_FW_IMAGE_ADDR + CPU_FW_IMAGE_SIZE)\n#define MMU_CACHE_MNG_ADDR\t(MMU_PAGE_TABLES_ADDR + MMU_PAGE_TABLES_SIZE)\n\n#define DRAM_DRIVER_END_ADDR\t(MMU_CACHE_MNG_ADDR + MMU_CACHE_MNG_SIZE +\\\n\t\t\t\t\t\t\t\tRESERVED)\n\n#define DRAM_BASE_ADDR_USER\t0x20000000\n\n#if (DRAM_DRIVER_END_ADDR > DRAM_BASE_ADDR_USER)\n#error \"Driver must reserve no more than 512MB\"\n#endif\n\n \n\n#define MME_QMAN_LENGTH\t\t\t1024\n#define MME_QMAN_SIZE_IN_BYTES\t\t(MME_QMAN_LENGTH * QMAN_PQ_ENTRY_SIZE)\n\n#define HBM_DMA_QMAN_LENGTH\t\t4096\n#define HBM_DMA_QMAN_SIZE_IN_BYTES\t\\\n\t\t\t\t(HBM_DMA_QMAN_LENGTH * QMAN_PQ_ENTRY_SIZE)\n\n#define TPC_QMAN_LENGTH\t\t\t1024\n#define TPC_QMAN_SIZE_IN_BYTES\t\t(TPC_QMAN_LENGTH * QMAN_PQ_ENTRY_SIZE)\n\n#define NIC_QMAN_LENGTH\t\t\t4096\n#define NIC_QMAN_SIZE_IN_BYTES\t\t(NIC_QMAN_LENGTH * QMAN_PQ_ENTRY_SIZE)\n\n\n#define SRAM_USER_BASE_OFFSET  GAUDI_DRIVER_SRAM_RESERVED_SIZE_FROM_START\n\n \n#define VA_HOST_SPACE_START\t0x1000000000000ull\t \n#define VA_HOST_SPACE_END\t0x3FF8000000000ull\t \n#define VA_HOST_SPACE_SIZE\t(VA_HOST_SPACE_END - \\\n\t\t\t\t\tVA_HOST_SPACE_START)  \n#define HOST_SPACE_INTERNAL_CB_SZ\tSZ_2M\n\n#define HW_CAP_PLL\t\tBIT(0)\n#define HW_CAP_HBM\t\tBIT(1)\n#define HW_CAP_MMU\t\tBIT(2)\n#define HW_CAP_MME\t\tBIT(3)\n#define HW_CAP_CPU\t\tBIT(4)\n#define HW_CAP_PCI_DMA\t\tBIT(5)\n#define HW_CAP_MSI\t\tBIT(6)\n#define HW_CAP_CPU_Q\t\tBIT(7)\n#define HW_CAP_HBM_DMA\t\tBIT(8)\n#define HW_CAP_SRAM_SCRAMBLER\tBIT(10)\n#define HW_CAP_HBM_SCRAMBLER\tBIT(11)\n\n#define HW_CAP_NIC0\t\tBIT(14)\n#define HW_CAP_NIC1\t\tBIT(15)\n#define HW_CAP_NIC2\t\tBIT(16)\n#define HW_CAP_NIC3\t\tBIT(17)\n#define HW_CAP_NIC4\t\tBIT(18)\n#define HW_CAP_NIC5\t\tBIT(19)\n#define HW_CAP_NIC6\t\tBIT(20)\n#define HW_CAP_NIC7\t\tBIT(21)\n#define HW_CAP_NIC8\t\tBIT(22)\n#define HW_CAP_NIC9\t\tBIT(23)\n#define HW_CAP_NIC_MASK\t\tGENMASK(23, 14)\n#define HW_CAP_NIC_SHIFT\t14\n\n#define HW_CAP_TPC0\t\tBIT(24)\n#define HW_CAP_TPC1\t\tBIT(25)\n#define HW_CAP_TPC2\t\tBIT(26)\n#define HW_CAP_TPC3\t\tBIT(27)\n#define HW_CAP_TPC4\t\tBIT(28)\n#define HW_CAP_TPC5\t\tBIT(29)\n#define HW_CAP_TPC6\t\tBIT(30)\n#define HW_CAP_TPC7\t\tBIT(31)\n#define HW_CAP_TPC_MASK\t\tGENMASK(31, 24)\n#define HW_CAP_TPC_SHIFT\t24\n\n#define NEXT_SYNC_OBJ_ADDR_INTERVAL \\\n\t(mmSYNC_MNGR_W_N_SYNC_MNGR_OBJS_SOB_OBJ_0 - \\\n\t mmSYNC_MNGR_E_N_SYNC_MNGR_OBJS_SOB_OBJ_0)\n#define NUM_OF_MME_ENGINES\t\t\t2\n#define NUM_OF_MME_SUB_ENGINES\t\t2\n#define NUM_OF_TPC_ENGINES\t\t\t8\n#define NUM_OF_DMA_ENGINES\t\t\t8\n#define NUM_OF_QUEUES\t\t\t\t5\n#define NUM_OF_STREAMS\t\t\t\t4\n#define NUM_OF_FENCES\t\t\t\t4\n\n\n#define GAUDI_CPU_PCI_MSB_ADDR(addr)\t(((addr) & GENMASK_ULL(49, 39)) >> 39)\n#define GAUDI_PCI_TO_CPU_ADDR(addr)\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\t(addr) &= ~GENMASK_ULL(49, 39);\t\t\\\n\t\t(addr) |= BIT_ULL(39);\t\t\t\\\n\t} while (0)\n#define GAUDI_CPU_TO_PCI_ADDR(addr, extension)\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\t(addr) &= ~GENMASK_ULL(49, 39);\t\t\\\n\t\t(addr) |= (u64) (extension) << 39;\t\\\n\t} while (0)\n\nenum gaudi_dma_channels {\n\tGAUDI_PCI_DMA_1,\n\tGAUDI_PCI_DMA_2,\n\tGAUDI_HBM_DMA_1,\n\tGAUDI_HBM_DMA_2,\n\tGAUDI_HBM_DMA_3,\n\tGAUDI_HBM_DMA_4,\n\tGAUDI_HBM_DMA_5,\n\tGAUDI_HBM_DMA_6,\n\tGAUDI_DMA_MAX\n};\n\nenum gaudi_tpc_mask {\n\tGAUDI_TPC_MASK_TPC0 = 0x01,\n\tGAUDI_TPC_MASK_TPC1 = 0x02,\n\tGAUDI_TPC_MASK_TPC2 = 0x04,\n\tGAUDI_TPC_MASK_TPC3 = 0x08,\n\tGAUDI_TPC_MASK_TPC4 = 0x10,\n\tGAUDI_TPC_MASK_TPC5 = 0x20,\n\tGAUDI_TPC_MASK_TPC6 = 0x40,\n\tGAUDI_TPC_MASK_TPC7 = 0x80,\n\tGAUDI_TPC_MASK_ALL = 0xFF\n};\n\nenum gaudi_nic_mask {\n\tGAUDI_NIC_MASK_NIC0 = 0x01,\n\tGAUDI_NIC_MASK_NIC1 = 0x02,\n\tGAUDI_NIC_MASK_NIC2 = 0x04,\n\tGAUDI_NIC_MASK_NIC3 = 0x08,\n\tGAUDI_NIC_MASK_NIC4 = 0x10,\n\tGAUDI_NIC_MASK_NIC5 = 0x20,\n\tGAUDI_NIC_MASK_NIC6 = 0x40,\n\tGAUDI_NIC_MASK_NIC7 = 0x80,\n\tGAUDI_NIC_MASK_NIC8 = 0x100,\n\tGAUDI_NIC_MASK_NIC9 = 0x200,\n\tGAUDI_NIC_MASK_ALL = 0x3FF\n};\n\n \nstruct gaudi_hw_sob_group {\n\tstruct hl_device\t*hdev;\n\tstruct kref\t\tkref;\n\tu32\t\t\tbase_sob_id;\n\tu32\t\t\tqueue_id;\n};\n\n#define NUM_SOB_GROUPS (HL_RSVD_SOBS * QMAN_STREAMS)\n \nstruct gaudi_collective_properties {\n\tstruct gaudi_hw_sob_group hw_sob_group[NUM_SOB_GROUPS];\n\tu16\t\t\tnext_sob_group_val[QMAN_STREAMS];\n\tu8\t\t\tcurr_sob_group_idx[QMAN_STREAMS];\n\tu8\t\t\tmstr_sob_mask[HL_COLLECTIVE_RSVD_MSTR_MONS];\n};\n\n \nstruct gaudi_internal_qman_info {\n\tvoid\t\t*pq_kernel_addr;\n\tdma_addr_t\tpq_dma_addr;\n\tsize_t\t\tpq_size;\n};\n\n \nstruct gaudi_device {\n\tint (*cpucp_info_get)(struct hl_device *hdev);\n\n\t \n\tspinlock_t\t\t\thw_queues_lock;\n\n\tstruct gaudi_internal_qman_info\tinternal_qmans[GAUDI_QUEUE_ID_SIZE];\n\n\tstruct gaudi_collective_properties collective_props;\n\n\tu64\t\t\t\thbm_bar_cur_addr;\n\n\tu32\t\t\t\tevents[GAUDI_EVENT_SIZE];\n\tu32\t\t\t\tevents_stat[GAUDI_EVENT_SIZE];\n\tu32\t\t\t\tevents_stat_aggregate[GAUDI_EVENT_SIZE];\n\tu32\t\t\t\thw_cap_initialized;\n\tu8\t\t\t\tmmu_cache_inv_pi;\n};\n\nvoid gaudi_init_security(struct hl_device *hdev);\nvoid gaudi_ack_protection_bits_errors(struct hl_device *hdev);\nint gaudi_debug_coresight(struct hl_device *hdev, struct hl_ctx *ctx, void *data);\nvoid gaudi_halt_coresight(struct hl_device *hdev, struct hl_ctx *ctx);\nvoid gaudi_mmu_prepare_reg(struct hl_device *hdev, u64 reg, u32 asid);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}