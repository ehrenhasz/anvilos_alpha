{
  "module_name": "db8500_wdt.c",
  "hash_id": "c278443f0d9bc267b4d235a6200d390fe623cf1d4b029a13033787a6d88777ac",
  "original_prompt": "Ingested from linux-6.6.14/drivers/watchdog/db8500_wdt.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/moduleparam.h>\n#include <linux/err.h>\n#include <linux/uaccess.h>\n#include <linux/watchdog.h>\n#include <linux/platform_device.h>\n\n#include <linux/mfd/dbx500-prcmu.h>\n\n#define WATCHDOG_TIMEOUT 600  \n\n#define WATCHDOG_MIN\t0\n#define WATCHDOG_MAX28\t268435   \n\nstatic unsigned int timeout = WATCHDOG_TIMEOUT;\nmodule_param(timeout, uint, 0);\nMODULE_PARM_DESC(timeout,\n\t\"Watchdog timeout in seconds. default=\"\n\t\t\t\t__MODULE_STRING(WATCHDOG_TIMEOUT) \".\");\n\nstatic bool nowayout = WATCHDOG_NOWAYOUT;\nmodule_param(nowayout, bool, 0);\nMODULE_PARM_DESC(nowayout,\n\t\"Watchdog cannot be stopped once started (default=\"\n\t\t\t\t__MODULE_STRING(WATCHDOG_NOWAYOUT) \")\");\n\nstatic int db8500_wdt_start(struct watchdog_device *wdd)\n{\n\treturn prcmu_enable_a9wdog(PRCMU_WDOG_ALL);\n}\n\nstatic int db8500_wdt_stop(struct watchdog_device *wdd)\n{\n\treturn prcmu_disable_a9wdog(PRCMU_WDOG_ALL);\n}\n\nstatic int db8500_wdt_keepalive(struct watchdog_device *wdd)\n{\n\treturn prcmu_kick_a9wdog(PRCMU_WDOG_ALL);\n}\n\nstatic int db8500_wdt_set_timeout(struct watchdog_device *wdd,\n\t\t\t\t unsigned int timeout)\n{\n\tdb8500_wdt_stop(wdd);\n\tprcmu_load_a9wdog(PRCMU_WDOG_ALL, timeout * 1000);\n\tdb8500_wdt_start(wdd);\n\n\treturn 0;\n}\n\nstatic const struct watchdog_info db8500_wdt_info = {\n\t.options = WDIOF_SETTIMEOUT | WDIOF_KEEPALIVEPING | WDIOF_MAGICCLOSE,\n\t.identity = \"DB8500 WDT\",\n\t.firmware_version = 1,\n};\n\nstatic const struct watchdog_ops db8500_wdt_ops = {\n\t.owner = THIS_MODULE,\n\t.start = db8500_wdt_start,\n\t.stop  = db8500_wdt_stop,\n\t.ping  = db8500_wdt_keepalive,\n\t.set_timeout = db8500_wdt_set_timeout,\n};\n\nstatic struct watchdog_device db8500_wdt = {\n\t.info = &db8500_wdt_info,\n\t.ops = &db8500_wdt_ops,\n\t.min_timeout = WATCHDOG_MIN,\n\t.max_timeout = WATCHDOG_MAX28,\n};\n\nstatic int db8500_wdt_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tint ret;\n\n\ttimeout = 600;  \n\tdb8500_wdt.parent = dev;\n\twatchdog_set_nowayout(&db8500_wdt, nowayout);\n\n\t \n\tprcmu_config_a9wdog(PRCMU_WDOG_CPU1, false);\n\n\t \n\tprcmu_load_a9wdog(PRCMU_WDOG_ALL, timeout * 1000);\n\n\tret = devm_watchdog_register_device(dev, &db8500_wdt);\n\tif (ret)\n\t\treturn ret;\n\n\tdev_info(dev, \"initialized\\n\");\n\n\treturn 0;\n}\n\nstatic int db8500_wdt_suspend(struct platform_device *pdev,\n\t\t\t     pm_message_t state)\n{\n\tif (watchdog_active(&db8500_wdt)) {\n\t\tdb8500_wdt_stop(&db8500_wdt);\n\t\tprcmu_config_a9wdog(PRCMU_WDOG_CPU1, true);\n\n\t\tprcmu_load_a9wdog(PRCMU_WDOG_ALL, timeout * 1000);\n\t\tdb8500_wdt_start(&db8500_wdt);\n\t}\n\treturn 0;\n}\n\nstatic int db8500_wdt_resume(struct platform_device *pdev)\n{\n\tif (watchdog_active(&db8500_wdt)) {\n\t\tdb8500_wdt_stop(&db8500_wdt);\n\t\tprcmu_config_a9wdog(PRCMU_WDOG_CPU1, false);\n\n\t\tprcmu_load_a9wdog(PRCMU_WDOG_ALL, timeout * 1000);\n\t\tdb8500_wdt_start(&db8500_wdt);\n\t}\n\treturn 0;\n}\n\nstatic struct platform_driver db8500_wdt_driver = {\n\t.probe\t\t= db8500_wdt_probe,\n\t.suspend\t= pm_ptr(db8500_wdt_suspend),\n\t.resume\t\t= pm_ptr(db8500_wdt_resume),\n\t.driver\t\t= {\n\t\t.name\t= \"db8500_wdt\",\n\t},\n};\n\nmodule_platform_driver(db8500_wdt_driver);\n\nMODULE_AUTHOR(\"Jonas Aaberg <jonas.aberg@stericsson.com>\");\nMODULE_DESCRIPTION(\"DB8500 Watchdog Driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:db8500_wdt\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}