{
  "module_name": "ep93xx_wdt.c",
  "hash_id": "3fb22c7100e63dccc183a3d4be5b45ee9a631622662c9128b0669ac3287f605f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/watchdog/ep93xx_wdt.c",
  "human_readable_source": "\n \n\n#include <linux/platform_device.h>\n#include <linux/module.h>\n#include <linux/watchdog.h>\n#include <linux/io.h>\n\n \n#define WDT_TIMEOUT 30\n\nstatic bool nowayout = WATCHDOG_NOWAYOUT;\nmodule_param(nowayout, bool, 0);\nMODULE_PARM_DESC(nowayout, \"Watchdog cannot be stopped once started\");\n\nstatic unsigned int timeout;\nmodule_param(timeout, uint, 0);\nMODULE_PARM_DESC(timeout, \"Watchdog timeout in seconds.\");\n\n#define EP93XX_WATCHDOG\t\t0x00\n#define EP93XX_WDSTATUS\t\t0x04\n\nstruct ep93xx_wdt_priv {\n\tvoid __iomem *mmio;\n\tstruct watchdog_device wdd;\n};\n\nstatic int ep93xx_wdt_start(struct watchdog_device *wdd)\n{\n\tstruct ep93xx_wdt_priv *priv = watchdog_get_drvdata(wdd);\n\n\twritel(0xaaaa, priv->mmio + EP93XX_WATCHDOG);\n\n\treturn 0;\n}\n\nstatic int ep93xx_wdt_stop(struct watchdog_device *wdd)\n{\n\tstruct ep93xx_wdt_priv *priv = watchdog_get_drvdata(wdd);\n\n\twritel(0xaa55, priv->mmio + EP93XX_WATCHDOG);\n\n\treturn 0;\n}\n\nstatic int ep93xx_wdt_ping(struct watchdog_device *wdd)\n{\n\tstruct ep93xx_wdt_priv *priv = watchdog_get_drvdata(wdd);\n\n\twritel(0x5555, priv->mmio + EP93XX_WATCHDOG);\n\n\treturn 0;\n}\n\nstatic const struct watchdog_info ep93xx_wdt_ident = {\n\t.options\t= WDIOF_CARDRESET |\n\t\t\t  WDIOF_SETTIMEOUT |\n\t\t\t  WDIOF_MAGICCLOSE |\n\t\t\t  WDIOF_KEEPALIVEPING,\n\t.identity\t= \"EP93xx Watchdog\",\n};\n\nstatic const struct watchdog_ops ep93xx_wdt_ops = {\n\t.owner\t\t= THIS_MODULE,\n\t.start\t\t= ep93xx_wdt_start,\n\t.stop\t\t= ep93xx_wdt_stop,\n\t.ping\t\t= ep93xx_wdt_ping,\n};\n\nstatic int ep93xx_wdt_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct ep93xx_wdt_priv *priv;\n\tstruct watchdog_device *wdd;\n\tunsigned long val;\n\tint ret;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->mmio = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(priv->mmio))\n\t\treturn PTR_ERR(priv->mmio);\n\n\tval = readl(priv->mmio + EP93XX_WATCHDOG);\n\n\twdd = &priv->wdd;\n\twdd->bootstatus = (val & 0x01) ? WDIOF_CARDRESET : 0;\n\twdd->info = &ep93xx_wdt_ident;\n\twdd->ops = &ep93xx_wdt_ops;\n\twdd->min_timeout = 1;\n\twdd->max_hw_heartbeat_ms = 200;\n\twdd->parent = dev;\n\n\twatchdog_set_nowayout(wdd, nowayout);\n\n\twdd->timeout = WDT_TIMEOUT;\n\twatchdog_init_timeout(wdd, timeout, dev);\n\n\twatchdog_set_drvdata(wdd, priv);\n\n\tret = devm_watchdog_register_device(dev, wdd);\n\tif (ret)\n\t\treturn ret;\n\n\tdev_info(dev, \"EP93XX watchdog driver %s\\n\",\n\t\t (val & 0x08) ? \" (nCS1 disable detected)\" : \"\");\n\n\treturn 0;\n}\n\nstatic struct platform_driver ep93xx_wdt_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"ep93xx-wdt\",\n\t},\n\t.probe\t\t= ep93xx_wdt_probe,\n};\n\nmodule_platform_driver(ep93xx_wdt_driver);\n\nMODULE_AUTHOR(\"Ray Lehtiniemi <rayl@mail.com>\");\nMODULE_AUTHOR(\"Alessandro Zummo <a.zummo@towertech.it>\");\nMODULE_AUTHOR(\"H Hartley Sweeten <hsweeten@visionengravers.com>\");\nMODULE_DESCRIPTION(\"EP93xx Watchdog\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}