{
  "module_name": "iTCO_vendor_support.c",
  "hash_id": "b0915670ea1d864d1513d69649cd8f8f041be929931f08eab6dc7649448b9d48",
  "original_prompt": "Ingested from linux-6.6.14/drivers/watchdog/iTCO_vendor_support.c",
  "human_readable_source": "\n \n\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n \n#define DRV_NAME\t\"iTCO_vendor_support\"\n#define DRV_VERSION\t\"1.04\"\n\n \n#include <linux/module.h>\t\t \n#include <linux/moduleparam.h>\t\t \n#include <linux/types.h>\t\t \n#include <linux/errno.h>\t\t \n#include <linux/kernel.h>\t\t \n#include <linux/init.h>\t\t\t \n#include <linux/ioport.h>\t\t \n#include <linux/io.h>\t\t\t \n\n#include \"iTCO_vendor.h\"\n\n \n \n#define SUPERMICRO_OLD_BOARD\t1\n \n#define SUPERMICRO_NEW_BOARD\t2\n \n#define BROKEN_BIOS\t\t911\n\nint iTCO_vendorsupport;\nEXPORT_SYMBOL(iTCO_vendorsupport);\n\nmodule_param_named(vendorsupport, iTCO_vendorsupport, int, 0);\nMODULE_PARM_DESC(vendorsupport, \"iTCO vendor specific support mode, default=\"\n\t\t\t\"0 (none), 1=SuperMicro Pent3, 911=Broken SMI BIOS\");\n\n \n\n \n\nstatic void supermicro_old_pre_start(struct resource *smires)\n{\n\tunsigned long val32;\n\n\t \n\tval32 = inl(smires->start);\n\tval32 &= 0xffffdfff;\t \n\toutl(val32, smires->start);\t \n}\n\nstatic void supermicro_old_pre_stop(struct resource *smires)\n{\n\tunsigned long val32;\n\n\t \n\tval32 = inl(smires->start);\n\tval32 |= 0x00002000;\t \n\toutl(val32, smires->start);\t \n}\n\n \n\nstatic void broken_bios_start(struct resource *smires)\n{\n\tunsigned long val32;\n\n\tval32 = inl(smires->start);\n\t \n\tval32 &= 0xffffdffe;\n\toutl(val32, smires->start);\n}\n\nstatic void broken_bios_stop(struct resource *smires)\n{\n\tunsigned long val32;\n\n\tval32 = inl(smires->start);\n\t \n\tval32 |= 0x00002001;\n\toutl(val32, smires->start);\n}\n\n \n\nvoid iTCO_vendor_pre_start(struct resource *smires,\n\t\t\t   unsigned int heartbeat)\n{\n\tswitch (iTCO_vendorsupport) {\n\tcase SUPERMICRO_OLD_BOARD:\n\t\tsupermicro_old_pre_start(smires);\n\t\tbreak;\n\tcase BROKEN_BIOS:\n\t\tbroken_bios_start(smires);\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL(iTCO_vendor_pre_start);\n\nvoid iTCO_vendor_pre_stop(struct resource *smires)\n{\n\tswitch (iTCO_vendorsupport) {\n\tcase SUPERMICRO_OLD_BOARD:\n\t\tsupermicro_old_pre_stop(smires);\n\t\tbreak;\n\tcase BROKEN_BIOS:\n\t\tbroken_bios_stop(smires);\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL(iTCO_vendor_pre_stop);\n\nint iTCO_vendor_check_noreboot_on(void)\n{\n\tswitch (iTCO_vendorsupport) {\n\tcase SUPERMICRO_OLD_BOARD:\n\t\treturn 0;\n\tdefault:\n\t\treturn 1;\n\t}\n}\nEXPORT_SYMBOL(iTCO_vendor_check_noreboot_on);\n\nstatic int __init iTCO_vendor_init_module(void)\n{\n\tif (iTCO_vendorsupport == SUPERMICRO_NEW_BOARD) {\n\t\tpr_warn(\"Option vendorsupport=%d is no longer supported, \"\n\t\t\t\"please use the w83627hf_wdt driver instead\\n\",\n\t\t\tSUPERMICRO_NEW_BOARD);\n\t\treturn -EINVAL;\n\t}\n\tpr_info(\"vendor-support=%d\\n\", iTCO_vendorsupport);\n\treturn 0;\n}\n\nstatic void __exit iTCO_vendor_exit_module(void)\n{\n\tpr_info(\"Module Unloaded\\n\");\n}\n\nmodule_init(iTCO_vendor_init_module);\nmodule_exit(iTCO_vendor_exit_module);\n\nMODULE_AUTHOR(\"Wim Van Sebroeck <wim@iguana.be>, \"\n\t\t\"R. Seretny <lkpatches@paypc.com>\");\nMODULE_DESCRIPTION(\"Intel TCO Vendor Specific WatchDog Timer Driver Support\");\nMODULE_VERSION(DRV_VERSION);\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}