{
  "module_name": "rmem.c",
  "hash_id": "4853ab1dfe6d2aabfe5af45b6f09752a2db6f0cd742f74b0fa9e3ab971fd2941",
  "original_prompt": "Ingested from linux-6.6.14/drivers/nvmem/rmem.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/nvmem-provider.h>\n#include <linux/of_reserved_mem.h>\n#include <linux/platform_device.h>\n\nstruct rmem {\n\tstruct device *dev;\n\tstruct nvmem_device *nvmem;\n\tstruct reserved_mem *mem;\n\n\tphys_addr_t size;\n};\n\nstatic int rmem_read(void *context, unsigned int offset,\n\t\t     void *val, size_t bytes)\n{\n\tstruct rmem *priv = context;\n\tsize_t available = priv->mem->size;\n\tloff_t off = offset;\n\tvoid *addr;\n\tint count;\n\n\t \n\taddr = memremap(priv->mem->base, available, MEMREMAP_WB);\n\tif (!addr) {\n\t\tdev_err(priv->dev, \"Failed to remap memory region\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tcount = memory_read_from_buffer(val, bytes, &off, addr, available);\n\n\tmemunmap(addr);\n\n\treturn count;\n}\n\nstatic int rmem_probe(struct platform_device *pdev)\n{\n\tstruct nvmem_config config = { };\n\tstruct device *dev = &pdev->dev;\n\tstruct reserved_mem *mem;\n\tstruct rmem *priv;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\tpriv->dev = dev;\n\n\tmem = of_reserved_mem_lookup(dev->of_node);\n\tif (!mem) {\n\t\tdev_err(dev, \"Failed to lookup reserved memory\\n\");\n\t\treturn -EINVAL;\n\t}\n\tpriv->mem = mem;\n\n\tconfig.dev = dev;\n\tconfig.priv = priv;\n\tconfig.name = \"rmem\";\n\tconfig.id = NVMEM_DEVID_AUTO;\n\tconfig.size = mem->size;\n\tconfig.reg_read = rmem_read;\n\n\treturn PTR_ERR_OR_ZERO(devm_nvmem_register(dev, &config));\n}\n\nstatic const struct of_device_id rmem_match[] = {\n\t{ .compatible = \"nvmem-rmem\", },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, rmem_match);\n\nstatic struct platform_driver rmem_driver = {\n\t.probe = rmem_probe,\n\t.driver = {\n\t\t.name = \"rmem\",\n\t\t.of_match_table = rmem_match,\n\t},\n};\nmodule_platform_driver(rmem_driver);\n\nMODULE_AUTHOR(\"Nicolas Saenz Julienne <nsaenzjulienne@suse.de>\");\nMODULE_DESCRIPTION(\"Reserved Memory Based nvmem Driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}