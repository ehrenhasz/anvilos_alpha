{
  "module_name": "zynqmp_nvmem.c",
  "hash_id": "7458f7c99d0ba67006c146c29c4e4fd1e835d2a51335593340ff794e49703486",
  "original_prompt": "Ingested from linux-6.6.14/drivers/nvmem/zynqmp_nvmem.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/nvmem-provider.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/firmware/xlnx-zynqmp.h>\n\n#define SILICON_REVISION_MASK 0xF\n\nstruct zynqmp_nvmem_data {\n\tstruct device *dev;\n\tstruct nvmem_device *nvmem;\n};\n\nstatic int zynqmp_nvmem_read(void *context, unsigned int offset,\n\t\t\t     void *val, size_t bytes)\n{\n\tint ret;\n\tint idcode, version;\n\tstruct zynqmp_nvmem_data *priv = context;\n\n\tret = zynqmp_pm_get_chipid(&idcode, &version);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tdev_dbg(priv->dev, \"Read chipid val %x %x\\n\", idcode, version);\n\t*(int *)val = version & SILICON_REVISION_MASK;\n\n\treturn 0;\n}\n\nstatic struct nvmem_config econfig = {\n\t.name = \"zynqmp-nvmem\",\n\t.owner = THIS_MODULE,\n\t.word_size = 1,\n\t.size = 1,\n\t.read_only = true,\n};\n\nstatic const struct of_device_id zynqmp_nvmem_match[] = {\n\t{ .compatible = \"xlnx,zynqmp-nvmem-fw\", },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, zynqmp_nvmem_match);\n\nstatic int zynqmp_nvmem_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct zynqmp_nvmem_data *priv;\n\n\tpriv = devm_kzalloc(dev, sizeof(struct zynqmp_nvmem_data), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->dev = dev;\n\teconfig.dev = dev;\n\teconfig.reg_read = zynqmp_nvmem_read;\n\teconfig.priv = priv;\n\n\tpriv->nvmem = devm_nvmem_register(dev, &econfig);\n\n\treturn PTR_ERR_OR_ZERO(priv->nvmem);\n}\n\nstatic struct platform_driver zynqmp_nvmem_driver = {\n\t.probe = zynqmp_nvmem_probe,\n\t.driver = {\n\t\t.name = \"zynqmp-nvmem\",\n\t\t.of_match_table = zynqmp_nvmem_match,\n\t},\n};\n\nmodule_platform_driver(zynqmp_nvmem_driver);\n\nMODULE_AUTHOR(\"Michal Simek <michal.simek@amd.com>, Nava kishore Manne <nava.kishore.manne@amd.com>\");\nMODULE_DESCRIPTION(\"ZynqMP NVMEM driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}