{
  "module_name": "lpc18xx_otp.c",
  "hash_id": "8d39d92228f7c88f295cc1e55086e93e3a18a768fe2ac7b764ea5e2b94b8a485",
  "original_prompt": "Ingested from linux-6.6.14/drivers/nvmem/lpc18xx_otp.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/nvmem-provider.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n\n \n#define LPC18XX_OTP_NUM_BANKS\t\t4\n#define LPC18XX_OTP_WORDS_PER_BANK\t4\n#define LPC18XX_OTP_WORD_SIZE\t\tsizeof(u32)\n#define LPC18XX_OTP_SIZE\t\t(LPC18XX_OTP_NUM_BANKS * \\\n\t\t\t\t\t LPC18XX_OTP_WORDS_PER_BANK * \\\n\t\t\t\t\t LPC18XX_OTP_WORD_SIZE)\n\nstruct lpc18xx_otp {\n\tvoid __iomem *base;\n};\n\nstatic int lpc18xx_otp_read(void *context, unsigned int offset,\n\t\t\t    void *val, size_t bytes)\n{\n\tstruct lpc18xx_otp *otp = context;\n\tunsigned int count = bytes >> 2;\n\tu32 index = offset >> 2;\n\tu32 *buf = val;\n\tint i;\n\n\tif (count > (LPC18XX_OTP_SIZE - index))\n\t\tcount = LPC18XX_OTP_SIZE - index;\n\n\tfor (i = index; i < (index + count); i++)\n\t\t*buf++ = readl(otp->base + i * LPC18XX_OTP_WORD_SIZE);\n\n\treturn 0;\n}\n\nstatic struct nvmem_config lpc18xx_otp_nvmem_config = {\n\t.name = \"lpc18xx-otp\",\n\t.read_only = true,\n\t.word_size = LPC18XX_OTP_WORD_SIZE,\n\t.stride = LPC18XX_OTP_WORD_SIZE,\n\t.reg_read = lpc18xx_otp_read,\n};\n\nstatic int lpc18xx_otp_probe(struct platform_device *pdev)\n{\n\tstruct nvmem_device *nvmem;\n\tstruct lpc18xx_otp *otp;\n\n\totp = devm_kzalloc(&pdev->dev, sizeof(*otp), GFP_KERNEL);\n\tif (!otp)\n\t\treturn -ENOMEM;\n\n\totp->base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(otp->base))\n\t\treturn PTR_ERR(otp->base);\n\n\tlpc18xx_otp_nvmem_config.size = LPC18XX_OTP_SIZE;\n\tlpc18xx_otp_nvmem_config.dev = &pdev->dev;\n\tlpc18xx_otp_nvmem_config.priv = otp;\n\n\tnvmem = devm_nvmem_register(&pdev->dev, &lpc18xx_otp_nvmem_config);\n\n\treturn PTR_ERR_OR_ZERO(nvmem);\n}\n\nstatic const struct of_device_id lpc18xx_otp_dt_ids[] = {\n\t{ .compatible = \"nxp,lpc1850-otp\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, lpc18xx_otp_dt_ids);\n\nstatic struct platform_driver lpc18xx_otp_driver = {\n\t.probe\t= lpc18xx_otp_probe,\n\t.driver = {\n\t\t.name\t= \"lpc18xx_otp\",\n\t\t.of_match_table = lpc18xx_otp_dt_ids,\n\t},\n};\nmodule_platform_driver(lpc18xx_otp_driver);\n\nMODULE_AUTHOR(\"Joachim Eastwoood <manabian@gmail.com>\");\nMODULE_DESCRIPTION(\"NXP LPC18xx OTP NVMEM driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}