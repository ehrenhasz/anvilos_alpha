{
  "module_name": "mdio-mux-gpio.c",
  "hash_id": "d7f7dc1c3f1bb3afd9918fea788b03f2f37b00311c7026d05f5ee4d46c35f7fc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/mdio/mdio-mux-gpio.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/gpio/consumer.h>\n#include <linux/mdio-mux.h>\n#include <linux/module.h>\n#include <linux/of_mdio.h>\n#include <linux/phy.h>\n#include <linux/platform_device.h>\n\n#define DRV_VERSION \"1.1\"\n#define DRV_DESCRIPTION \"GPIO controlled MDIO bus multiplexer driver\"\n\nstruct mdio_mux_gpio_state {\n\tstruct gpio_descs *gpios;\n\tvoid *mux_handle;\n};\n\nstatic int mdio_mux_gpio_switch_fn(int current_child, int desired_child,\n\t\t\t\t   void *data)\n{\n\tstruct mdio_mux_gpio_state *s = data;\n\tDECLARE_BITMAP(values, BITS_PER_TYPE(desired_child));\n\n\tif (current_child == desired_child)\n\t\treturn 0;\n\n\tvalues[0] = desired_child;\n\n\tgpiod_set_array_value_cansleep(s->gpios->ndescs, s->gpios->desc,\n\t\t\t\t       s->gpios->info, values);\n\n\treturn 0;\n}\n\nstatic int mdio_mux_gpio_probe(struct platform_device *pdev)\n{\n\tstruct mdio_mux_gpio_state *s;\n\tstruct gpio_descs *gpios;\n\tint r;\n\n\tgpios = devm_gpiod_get_array(&pdev->dev, NULL, GPIOD_OUT_LOW);\n\tif (IS_ERR(gpios))\n\t\treturn PTR_ERR(gpios);\n\n\ts = devm_kzalloc(&pdev->dev, sizeof(*s), GFP_KERNEL);\n\tif (!s)\n\t\treturn -ENOMEM;\n\n\ts->gpios = gpios;\n\n\tr = mdio_mux_init(&pdev->dev, pdev->dev.of_node,\n\t\t\t  mdio_mux_gpio_switch_fn, &s->mux_handle, s, NULL);\n\n\tif (r != 0)\n\t\treturn r;\n\n\tpdev->dev.platform_data = s;\n\treturn 0;\n}\n\nstatic int mdio_mux_gpio_remove(struct platform_device *pdev)\n{\n\tstruct mdio_mux_gpio_state *s = dev_get_platdata(&pdev->dev);\n\tmdio_mux_uninit(s->mux_handle);\n\treturn 0;\n}\n\nstatic const struct of_device_id mdio_mux_gpio_match[] = {\n\t{\n\t\t.compatible = \"mdio-mux-gpio\",\n\t},\n\t{\n\t\t \n\t\t.compatible = \"cavium,mdio-mux-sn74cbtlv3253\",\n\t},\n\t{},\n};\nMODULE_DEVICE_TABLE(of, mdio_mux_gpio_match);\n\nstatic struct platform_driver mdio_mux_gpio_driver = {\n\t.driver = {\n\t\t.name\t\t= \"mdio-mux-gpio\",\n\t\t.of_match_table = mdio_mux_gpio_match,\n\t},\n\t.probe\t\t= mdio_mux_gpio_probe,\n\t.remove\t\t= mdio_mux_gpio_remove,\n};\n\nmodule_platform_driver(mdio_mux_gpio_driver);\n\nMODULE_DESCRIPTION(DRV_DESCRIPTION);\nMODULE_VERSION(DRV_VERSION);\nMODULE_AUTHOR(\"David Daney\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}