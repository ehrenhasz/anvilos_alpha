{
  "module_name": "mdio-mux-multiplexer.c",
  "hash_id": "b23c1bbe2a329a6abf45c0fda37360615def910415cd79e9ec627d6203ab8c36",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/mdio/mdio-mux-multiplexer.c",
  "human_readable_source": "\n \n\n#include <linux/mdio-mux.h>\n#include <linux/module.h>\n#include <linux/mux/consumer.h>\n#include <linux/platform_device.h>\n\nstruct mdio_mux_multiplexer_state {\n\tstruct mux_control *muxc;\n\tbool do_deselect;\n\tvoid *mux_handle;\n};\n\n \nstatic int mdio_mux_multiplexer_switch_fn(int current_child, int desired_child,\n\t\t\t\t\t  void *data)\n{\n\tstruct platform_device *pdev;\n\tstruct mdio_mux_multiplexer_state *s;\n\tint ret = 0;\n\n\tpdev = (struct platform_device *)data;\n\ts = platform_get_drvdata(pdev);\n\n\tif (!(current_child ^ desired_child))\n\t\treturn 0;\n\n\tif (s->do_deselect)\n\t\tret = mux_control_deselect(s->muxc);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"mux_control_deselect failed in %s: %d\\n\",\n\t\t\t__func__, ret);\n\t\treturn ret;\n\t}\n\n\tret =  mux_control_select(s->muxc, desired_child);\n\tif (!ret) {\n\t\tdev_dbg(&pdev->dev, \"%s %d -> %d\\n\", __func__, current_child,\n\t\t\tdesired_child);\n\t\ts->do_deselect = true;\n\t} else {\n\t\ts->do_deselect = false;\n\t}\n\n\treturn ret;\n}\n\nstatic int mdio_mux_multiplexer_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct mdio_mux_multiplexer_state *s;\n\tint ret = 0;\n\n\ts = devm_kzalloc(&pdev->dev, sizeof(*s), GFP_KERNEL);\n\tif (!s)\n\t\treturn -ENOMEM;\n\n\ts->muxc = devm_mux_control_get(dev, NULL);\n\tif (IS_ERR(s->muxc))\n\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(s->muxc),\n\t\t\t\t     \"Failed to get mux\\n\");\n\n\tplatform_set_drvdata(pdev, s);\n\n\tret = mdio_mux_init(&pdev->dev, pdev->dev.of_node,\n\t\t\t    mdio_mux_multiplexer_switch_fn, &s->mux_handle,\n\t\t\t    pdev, NULL);\n\n\treturn ret;\n}\n\nstatic int mdio_mux_multiplexer_remove(struct platform_device *pdev)\n{\n\tstruct mdio_mux_multiplexer_state *s = platform_get_drvdata(pdev);\n\n\tmdio_mux_uninit(s->mux_handle);\n\n\tif (s->do_deselect)\n\t\tmux_control_deselect(s->muxc);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id mdio_mux_multiplexer_match[] = {\n\t{ .compatible = \"mdio-mux-multiplexer\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, mdio_mux_multiplexer_match);\n\nstatic struct platform_driver mdio_mux_multiplexer_driver = {\n\t.driver = {\n\t\t.name\t\t= \"mdio-mux-multiplexer\",\n\t\t.of_match_table\t= mdio_mux_multiplexer_match,\n\t},\n\t.probe\t\t= mdio_mux_multiplexer_probe,\n\t.remove\t\t= mdio_mux_multiplexer_remove,\n};\n\nmodule_platform_driver(mdio_mux_multiplexer_driver);\n\nMODULE_DESCRIPTION(\"MDIO bus multiplexer using kernel multiplexer subsystem\");\nMODULE_AUTHOR(\"Pankaj Bansal <pankaj.bansal@nxp.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}