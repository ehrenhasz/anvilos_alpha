{
  "module_name": "mdio-octeon.c",
  "hash_id": "e359fb293ae71d06c7a75ea5f33119930899f388b96fcd53166d633c8a3ba7a4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/mdio/mdio-octeon.c",
  "human_readable_source": "\n \n\n#include <linux/gfp.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of_address.h>\n#include <linux/of_mdio.h>\n#include <linux/phy.h>\n#include <linux/platform_device.h>\n\n#include \"mdio-cavium.h\"\n\nstatic int octeon_mdiobus_probe(struct platform_device *pdev)\n{\n\tstruct cavium_mdiobus *bus;\n\tstruct mii_bus *mii_bus;\n\tstruct resource *res_mem;\n\tresource_size_t mdio_phys;\n\tresource_size_t regsize;\n\tunion cvmx_smix_en smi_en;\n\tint err = -ENOENT;\n\n\tmii_bus = devm_mdiobus_alloc_size(&pdev->dev, sizeof(*bus));\n\tif (!mii_bus)\n\t\treturn -ENOMEM;\n\n\tres_mem = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\tif (res_mem == NULL) {\n\t\tdev_err(&pdev->dev, \"found no memory resource\\n\");\n\t\treturn -ENXIO;\n\t}\n\n\tbus = mii_bus->priv;\n\tbus->mii_bus = mii_bus;\n\tmdio_phys = res_mem->start;\n\tregsize = resource_size(res_mem);\n\n\tif (!devm_request_mem_region(&pdev->dev, mdio_phys, regsize,\n\t\t\t\t     res_mem->name)) {\n\t\tdev_err(&pdev->dev, \"request_mem_region failed\\n\");\n\t\treturn -ENXIO;\n\t}\n\n\tbus->register_base = devm_ioremap(&pdev->dev, mdio_phys, regsize);\n\tif (!bus->register_base) {\n\t\tdev_err(&pdev->dev, \"dev_ioremap failed\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tsmi_en.u64 = 0;\n\tsmi_en.s.en = 1;\n\toct_mdio_writeq(smi_en.u64, bus->register_base + SMI_EN);\n\n\tbus->mii_bus->name = KBUILD_MODNAME;\n\tsnprintf(bus->mii_bus->id, MII_BUS_ID_SIZE, \"%px\", bus->register_base);\n\tbus->mii_bus->parent = &pdev->dev;\n\n\tbus->mii_bus->read = cavium_mdiobus_read_c22;\n\tbus->mii_bus->write = cavium_mdiobus_write_c22;\n\tbus->mii_bus->read_c45 = cavium_mdiobus_read_c45;\n\tbus->mii_bus->write_c45 = cavium_mdiobus_write_c45;\n\n\tplatform_set_drvdata(pdev, bus);\n\n\terr = of_mdiobus_register(bus->mii_bus, pdev->dev.of_node);\n\tif (err)\n\t\tgoto fail_register;\n\n\tdev_info(&pdev->dev, \"Probed\\n\");\n\n\treturn 0;\nfail_register:\n\tsmi_en.u64 = 0;\n\toct_mdio_writeq(smi_en.u64, bus->register_base + SMI_EN);\n\treturn err;\n}\n\nstatic int octeon_mdiobus_remove(struct platform_device *pdev)\n{\n\tstruct cavium_mdiobus *bus;\n\tunion cvmx_smix_en smi_en;\n\n\tbus = platform_get_drvdata(pdev);\n\n\tmdiobus_unregister(bus->mii_bus);\n\tsmi_en.u64 = 0;\n\toct_mdio_writeq(smi_en.u64, bus->register_base + SMI_EN);\n\treturn 0;\n}\n\nstatic const struct of_device_id octeon_mdiobus_match[] = {\n\t{\n\t\t.compatible = \"cavium,octeon-3860-mdio\",\n\t},\n\t{},\n};\nMODULE_DEVICE_TABLE(of, octeon_mdiobus_match);\n\nstatic struct platform_driver octeon_mdiobus_driver = {\n\t.driver = {\n\t\t.name\t\t= KBUILD_MODNAME,\n\t\t.of_match_table = octeon_mdiobus_match,\n\t},\n\t.probe\t\t= octeon_mdiobus_probe,\n\t.remove\t\t= octeon_mdiobus_remove,\n};\n\nmodule_platform_driver(octeon_mdiobus_driver);\n\nMODULE_DESCRIPTION(\"Cavium OCTEON MDIO bus driver\");\nMODULE_AUTHOR(\"David Daney\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}