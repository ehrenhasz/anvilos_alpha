{
  "module_name": "sja1105_ptp.h",
  "hash_id": "2142ee92c206fbb7773ebfaf250c08ec4fbce8cefd3782d35215ed0863e0edad",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/sja1105/sja1105_ptp.h",
  "human_readable_source": " \n \n#ifndef _SJA1105_PTP_H\n#define _SJA1105_PTP_H\n\n#include <linux/timer.h>\n\n#if IS_ENABLED(CONFIG_NET_DSA_SJA1105_PTP)\n\n \n#define SJA1105_TICK_NS\t\t\t8\n\nstatic inline s64 ns_to_sja1105_ticks(s64 ns)\n{\n\treturn ns / SJA1105_TICK_NS;\n}\n\nstatic inline s64 sja1105_ticks_to_ns(s64 ticks)\n{\n\treturn ticks * SJA1105_TICK_NS;\n}\n\n \nstatic inline s64 future_base_time(s64 base_time, s64 cycle_time, s64 now)\n{\n\ts64 a, b, n;\n\n\tif (base_time >= now)\n\t\treturn base_time;\n\n\ta = now - base_time;\n\tb = cycle_time;\n\tn = div_s64(a + b - 1, b);\n\n\treturn base_time + n * cycle_time;\n}\n\n \nstatic inline s64 ns_to_sja1105_delta(s64 ns)\n{\n\treturn div_s64(ns, 200);\n}\n\nstatic inline s64 sja1105_delta_to_ns(s64 delta)\n{\n\treturn delta * 200;\n}\n\nstruct sja1105_ptp_cmd {\n\tu64 startptpcp;\t\t \n\tu64 stopptpcp;\t\t \n\tu64 ptpstrtsch;\t\t \n\tu64 ptpstopsch;\t\t \n\tu64 resptp;\t\t \n\tu64 corrclk4ts;\t\t \n\tu64 ptpclkadd;\t\t \n};\n\nstruct sja1105_ptp_data {\n\tstruct timer_list extts_timer;\n\t \n\tstruct sk_buff_head skb_rxtstamp_queue;\n\t \n\tstruct sk_buff_head skb_txtstamp_queue;\n\tstruct ptp_clock_info caps;\n\tstruct ptp_clock *clock;\n\tstruct sja1105_ptp_cmd cmd;\n\t \n\tstruct mutex lock;\n\tbool extts_enabled;\n\tu64 ptpsyncts;\n};\n\nint sja1105_ptp_clock_register(struct dsa_switch *ds);\n\nvoid sja1105_ptp_clock_unregister(struct dsa_switch *ds);\n\nvoid sja1105et_ptp_cmd_packing(u8 *buf, struct sja1105_ptp_cmd *cmd,\n\t\t\t       enum packing_op op);\n\nvoid sja1105pqrs_ptp_cmd_packing(u8 *buf, struct sja1105_ptp_cmd *cmd,\n\t\t\t\t enum packing_op op);\n\nint sja1105_get_ts_info(struct dsa_switch *ds, int port,\n\t\t\tstruct ethtool_ts_info *ts);\n\nvoid sja1105_ptp_txtstamp_skb(struct dsa_switch *ds, int slot,\n\t\t\t      struct sk_buff *clone);\n\nbool sja1105_port_rxtstamp(struct dsa_switch *ds, int port,\n\t\t\t   struct sk_buff *skb, unsigned int type);\n\nvoid sja1105_port_txtstamp(struct dsa_switch *ds, int port,\n\t\t\t   struct sk_buff *skb);\n\nint sja1105_hwtstamp_get(struct dsa_switch *ds, int port, struct ifreq *ifr);\n\nint sja1105_hwtstamp_set(struct dsa_switch *ds, int port, struct ifreq *ifr);\n\nint __sja1105_ptp_gettimex(struct dsa_switch *ds, u64 *ns,\n\t\t\t   struct ptp_system_timestamp *sts);\n\nint __sja1105_ptp_settime(struct dsa_switch *ds, u64 ns,\n\t\t\t  struct ptp_system_timestamp *ptp_sts);\n\nint __sja1105_ptp_adjtime(struct dsa_switch *ds, s64 delta);\n\nint sja1105_ptp_commit(struct dsa_switch *ds, struct sja1105_ptp_cmd *cmd,\n\t\t       sja1105_spi_rw_mode_t rw);\n\nbool sja1105_rxtstamp(struct dsa_switch *ds, int port, struct sk_buff *skb);\nbool sja1110_rxtstamp(struct dsa_switch *ds, int port, struct sk_buff *skb);\nvoid sja1110_txtstamp(struct dsa_switch *ds, int port, struct sk_buff *skb);\n\nvoid sja1110_process_meta_tstamp(struct dsa_switch *ds, int port, u8 ts_id,\n\t\t\t\t enum sja1110_meta_tstamp dir, u64 tstamp);\n\n#else\n\nstruct sja1105_ptp_cmd;\n\n \nstruct sja1105_ptp_data {\n\tstruct mutex lock;\n};\n\nstatic inline int sja1105_ptp_clock_register(struct dsa_switch *ds)\n{\n\treturn 0;\n}\n\nstatic inline void sja1105_ptp_clock_unregister(struct dsa_switch *ds) { }\n\nstatic inline void sja1105_ptp_txtstamp_skb(struct dsa_switch *ds, int slot,\n\t\t\t\t\t    struct sk_buff *clone)\n{\n}\n\nstatic inline int __sja1105_ptp_gettimex(struct dsa_switch *ds, u64 *ns,\n\t\t\t\t\t struct ptp_system_timestamp *sts)\n{\n\treturn 0;\n}\n\nstatic inline int __sja1105_ptp_settime(struct dsa_switch *ds, u64 ns,\n\t\t\t\t\tstruct ptp_system_timestamp *ptp_sts)\n{\n\treturn 0;\n}\n\nstatic inline int __sja1105_ptp_adjtime(struct dsa_switch *ds, s64 delta)\n{\n\treturn 0;\n}\n\nstatic inline int sja1105_ptp_commit(struct dsa_switch *ds,\n\t\t\t\t     struct sja1105_ptp_cmd *cmd,\n\t\t\t\t     sja1105_spi_rw_mode_t rw)\n{\n\treturn 0;\n}\n\n#define sja1105et_ptp_cmd_packing NULL\n\n#define sja1105pqrs_ptp_cmd_packing NULL\n\n#define sja1105_get_ts_info NULL\n\n#define sja1105_port_rxtstamp NULL\n\n#define sja1105_port_txtstamp NULL\n\n#define sja1105_hwtstamp_get NULL\n\n#define sja1105_hwtstamp_set NULL\n\n#define sja1105_rxtstamp NULL\n#define sja1110_rxtstamp NULL\n#define sja1110_txtstamp NULL\n\n#define sja1110_process_meta_tstamp NULL\n\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}