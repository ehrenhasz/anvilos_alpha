{
  "module_name": "sja1105_dynamic_config.c",
  "hash_id": "1ea13074bf80e9d2777ef755c0f641e0f60bcd13505e1b3fb8cb1d849d017788",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/sja1105/sja1105_dynamic_config.c",
  "human_readable_source": "\n \n#include \"sja1105.h\"\n\n \n\n#define SJA1105_SIZE_DYN_CMD\t\t\t\t\t4\n\n#define SJA1105ET_SIZE_VL_LOOKUP_DYN_CMD\t\t\t\\\n\tSJA1105_SIZE_DYN_CMD\n\n#define SJA1105PQRS_SIZE_VL_LOOKUP_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105_SIZE_VL_LOOKUP_ENTRY)\n\n#define SJA1110_SIZE_VL_POLICING_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105_SIZE_VL_POLICING_ENTRY)\n\n#define SJA1105ET_SIZE_MAC_CONFIG_DYN_ENTRY\t\t\t\\\n\tSJA1105_SIZE_DYN_CMD\n\n#define SJA1105ET_SIZE_L2_LOOKUP_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105ET_SIZE_L2_LOOKUP_ENTRY)\n\n#define SJA1105PQRS_SIZE_L2_LOOKUP_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105PQRS_SIZE_L2_LOOKUP_ENTRY)\n\n#define SJA1110_SIZE_L2_LOOKUP_DYN_CMD\t\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1110_SIZE_L2_LOOKUP_ENTRY)\n\n#define SJA1105_SIZE_VLAN_LOOKUP_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + 4 + SJA1105_SIZE_VLAN_LOOKUP_ENTRY)\n\n#define SJA1110_SIZE_VLAN_LOOKUP_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1110_SIZE_VLAN_LOOKUP_ENTRY)\n\n#define SJA1105_SIZE_L2_FORWARDING_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105_SIZE_L2_FORWARDING_ENTRY)\n\n#define SJA1105ET_SIZE_MAC_CONFIG_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105ET_SIZE_MAC_CONFIG_DYN_ENTRY)\n\n#define SJA1105PQRS_SIZE_MAC_CONFIG_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105PQRS_SIZE_MAC_CONFIG_ENTRY)\n\n#define SJA1105ET_SIZE_L2_LOOKUP_PARAMS_DYN_CMD\t\t\t\\\n\tSJA1105_SIZE_DYN_CMD\n\n#define SJA1105PQRS_SIZE_L2_LOOKUP_PARAMS_DYN_CMD\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105PQRS_SIZE_L2_LOOKUP_PARAMS_ENTRY)\n\n#define SJA1110_SIZE_L2_LOOKUP_PARAMS_DYN_CMD\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1110_SIZE_L2_LOOKUP_PARAMS_ENTRY)\n\n#define SJA1105ET_SIZE_GENERAL_PARAMS_DYN_CMD\t\t\t\\\n\tSJA1105_SIZE_DYN_CMD\n\n#define SJA1105PQRS_SIZE_GENERAL_PARAMS_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105PQRS_SIZE_GENERAL_PARAMS_ENTRY)\n\n#define SJA1110_SIZE_GENERAL_PARAMS_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1110_SIZE_GENERAL_PARAMS_ENTRY)\n\n#define SJA1105PQRS_SIZE_AVB_PARAMS_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105PQRS_SIZE_AVB_PARAMS_ENTRY)\n\n#define SJA1105_SIZE_RETAGGING_DYN_CMD\t\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105_SIZE_RETAGGING_ENTRY)\n\n#define SJA1105ET_SIZE_CBS_DYN_CMD\t\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105ET_SIZE_CBS_ENTRY)\n\n#define SJA1105PQRS_SIZE_CBS_DYN_CMD\t\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105PQRS_SIZE_CBS_ENTRY)\n\n#define SJA1110_SIZE_XMII_PARAMS_DYN_CMD\t\t\t\\\n\tSJA1110_SIZE_XMII_PARAMS_ENTRY\n\n#define SJA1110_SIZE_L2_POLICING_DYN_CMD\t\t\t\\\n\t(SJA1105_SIZE_DYN_CMD + SJA1105_SIZE_L2_POLICING_ENTRY)\n\n#define SJA1110_SIZE_L2_FORWARDING_PARAMS_DYN_CMD\t\t\\\n\tSJA1105_SIZE_L2_FORWARDING_PARAMS_ENTRY\n\n#define SJA1105_MAX_DYN_CMD_SIZE\t\t\t\t\\\n\tSJA1110_SIZE_GENERAL_PARAMS_DYN_CMD\n\nstruct sja1105_dyn_cmd {\n\tbool search;\n\tu64 valid;\n\tu64 rdwrset;\n\tu64 errors;\n\tu64 valident;\n\tu64 index;\n};\n\nenum sja1105_hostcmd {\n\tSJA1105_HOSTCMD_SEARCH = 1,\n\tSJA1105_HOSTCMD_READ = 2,\n\tSJA1105_HOSTCMD_WRITE = 3,\n\tSJA1105_HOSTCMD_INVALIDATE = 4,\n};\n\n \nstatic void\nsja1105et_vl_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\tenum packing_op op)\n{\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(buf, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(buf, &cmd->errors,  30, 30, size, op);\n\tsja1105_packing(buf, &cmd->rdwrset, 29, 29, size, op);\n\tsja1105_packing(buf, &cmd->index,    9,  0, size, op);\n}\n\n \nstatic void\nsja1105pqrs_vl_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t  enum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_VL_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->errors,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    9,  0, size, op);\n}\n\nstatic void\nsja1110_vl_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t      enum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_L2_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,   11,  0, size, op);\n}\n\nstatic size_t sja1105et_vl_lookup_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t\tenum packing_op op)\n{\n\tstruct sja1105_vl_lookup_entry *entry = entry_ptr;\n\tconst int size = SJA1105ET_SIZE_VL_LOOKUP_DYN_CMD;\n\n\tsja1105_packing(buf, &entry->egrmirr,  21, 17, size, op);\n\tsja1105_packing(buf, &entry->ingrmirr, 16, 16, size, op);\n\treturn size;\n}\n\nstatic void\nsja1110_vl_policing_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\tenum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_VL_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->index,   11,  0, size, op);\n}\n\nstatic void\nsja1105pqrs_common_l2_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t\t enum packing_op op, int entry_size)\n{\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\tu8 *p = buf + entry_size;\n\tu64 hostcmd;\n\n\tsja1105_packing(p, &cmd->valid,    31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,   29, 29, size, op);\n\tsja1105_packing(p, &cmd->valident, 27, 27, size, op);\n\n\t \n\tif (cmd->rdwrset == SPI_READ) {\n\t\tif (cmd->search)\n\t\t\thostcmd = SJA1105_HOSTCMD_SEARCH;\n\t\telse\n\t\t\thostcmd = SJA1105_HOSTCMD_READ;\n\t} else {\n\t\t \n\t\tif (cmd->valident)\n\t\t\thostcmd = SJA1105_HOSTCMD_WRITE;\n\t\telse\n\t\t\thostcmd = SJA1105_HOSTCMD_INVALIDATE;\n\t}\n\tsja1105_packing(p, &hostcmd, 25, 23, size, op);\n}\n\nstatic void\nsja1105pqrs_l2_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t  enum packing_op op)\n{\n\tint entry_size = SJA1105PQRS_SIZE_L2_LOOKUP_ENTRY;\n\n\tsja1105pqrs_common_l2_lookup_cmd_packing(buf, cmd, op, entry_size);\n\n\t \n\tsja1105_packing(buf, &cmd->index, 15, 6, entry_size, op);\n}\n\nstatic void\nsja1110_l2_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t      enum packing_op op)\n{\n\tint entry_size = SJA1110_SIZE_L2_LOOKUP_ENTRY;\n\n\tsja1105pqrs_common_l2_lookup_cmd_packing(buf, cmd, op, entry_size);\n\n\tsja1105_packing(buf, &cmd->index, 10, 1, entry_size, op);\n}\n\n \nstatic size_t\nsja1105pqrs_dyn_l2_lookup_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\tenum packing_op op)\n{\n\tstruct sja1105_l2_lookup_entry *entry = entry_ptr;\n\tu8 *cmd = buf + SJA1105PQRS_SIZE_L2_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(cmd, &entry->lockeds, 28, 28, size, op);\n\n\treturn sja1105pqrs_l2_lookup_entry_packing(buf, entry_ptr, op);\n}\n\nstatic size_t sja1110_dyn_l2_lookup_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t\t  enum packing_op op)\n{\n\tstruct sja1105_l2_lookup_entry *entry = entry_ptr;\n\tu8 *cmd = buf + SJA1110_SIZE_L2_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(cmd, &entry->lockeds, 28, 28, size, op);\n\n\treturn sja1110_l2_lookup_entry_packing(buf, entry_ptr, op);\n}\n\nstatic void\nsja1105et_l2_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\tenum packing_op op)\n{\n\tu8 *p = buf + SJA1105ET_SIZE_L2_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,    31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,   29, 29, size, op);\n\tsja1105_packing(p, &cmd->valident, 27, 27, size, op);\n\t \n\tsja1105_packing(buf, &cmd->index, 29, 20,\n\t\t\tSJA1105ET_SIZE_L2_LOOKUP_ENTRY, op);\n}\n\nstatic size_t sja1105et_dyn_l2_lookup_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t\t    enum packing_op op)\n{\n\tstruct sja1105_l2_lookup_entry *entry = entry_ptr;\n\tu8 *cmd = buf + SJA1105ET_SIZE_L2_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(cmd, &entry->lockeds, 28, 28, size, op);\n\n\treturn sja1105et_l2_lookup_entry_packing(buf, entry_ptr, op);\n}\n\nstatic void\nsja1105et_mgmt_route_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t enum packing_op op)\n{\n\tu8 *p = buf + SJA1105ET_SIZE_L2_LOOKUP_ENTRY;\n\tu64 mgmtroute = 1;\n\n\tsja1105et_l2_lookup_cmd_packing(buf, cmd, op);\n\tif (op == PACK)\n\t\tsja1105_pack(p, &mgmtroute, 26, 26, SJA1105_SIZE_DYN_CMD);\n}\n\nstatic size_t sja1105et_mgmt_route_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t\t enum packing_op op)\n{\n\tstruct sja1105_mgmt_entry *entry = entry_ptr;\n\tconst size_t size = SJA1105ET_SIZE_L2_LOOKUP_ENTRY;\n\n\t \n\tsja1105_packing(buf, &entry->tsreg,     85, 85, size, op);\n\tsja1105_packing(buf, &entry->takets,    84, 84, size, op);\n\tsja1105_packing(buf, &entry->macaddr,   83, 36, size, op);\n\tsja1105_packing(buf, &entry->destports, 35, 31, size, op);\n\tsja1105_packing(buf, &entry->enfport,   30, 30, size, op);\n\treturn size;\n}\n\nstatic void\nsja1105pqrs_mgmt_route_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t   enum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_L2_LOOKUP_ENTRY;\n\tu64 mgmtroute = 1;\n\n\tsja1105pqrs_l2_lookup_cmd_packing(buf, cmd, op);\n\tif (op == PACK)\n\t\tsja1105_pack(p, &mgmtroute, 26, 26, SJA1105_SIZE_DYN_CMD);\n}\n\nstatic size_t sja1105pqrs_mgmt_route_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t\t   enum packing_op op)\n{\n\tconst size_t size = SJA1105PQRS_SIZE_L2_LOOKUP_ENTRY;\n\tstruct sja1105_mgmt_entry *entry = entry_ptr;\n\n\t \n\tsja1105_packing(buf, &entry->tsreg,     71, 71, size, op);\n\tsja1105_packing(buf, &entry->takets,    70, 70, size, op);\n\tsja1105_packing(buf, &entry->macaddr,   69, 22, size, op);\n\tsja1105_packing(buf, &entry->destports, 21, 17, size, op);\n\tsja1105_packing(buf, &entry->enfport,   16, 16, size, op);\n\treturn size;\n}\n\n \nstatic void\nsja1105_vlan_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\tenum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_VLAN_LOOKUP_ENTRY + 4;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,    31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->valident, 27, 27, size, op);\n\t \n\tsja1105_packing(buf, &cmd->index, 38, 27,\n\t\t\tSJA1105_SIZE_VLAN_LOOKUP_ENTRY, op);\n}\n\n \nstatic void\nsja1110_vlan_lookup_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\tenum packing_op op)\n{\n\tu8 *p = buf + SJA1110_SIZE_VLAN_LOOKUP_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\tu64 type_entry = 0;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n\t \n\tsja1105_packing(buf, &cmd->index, 38, 27,\n\t\t\tSJA1110_SIZE_VLAN_LOOKUP_ENTRY, op);\n\n\t \n\tif (op == PACK && !cmd->valident) {\n\t\tsja1105_packing(buf, &type_entry, 40, 39,\n\t\t\t\tSJA1110_SIZE_VLAN_LOOKUP_ENTRY, PACK);\n\t} else if (op == UNPACK) {\n\t\tsja1105_packing(buf, &type_entry, 40, 39,\n\t\t\t\tSJA1110_SIZE_VLAN_LOOKUP_ENTRY, UNPACK);\n\t\tcmd->valident = !!type_entry;\n\t}\n}\n\nstatic void\nsja1105_l2_forwarding_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t  enum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_L2_FORWARDING_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->errors,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    4,  0, size, op);\n}\n\nstatic void\nsja1110_l2_forwarding_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t  enum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_L2_FORWARDING_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    4,  0, size, op);\n}\n\nstatic void\nsja1105et_mac_config_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t enum packing_op op)\n{\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\t \n\tu8 *reg1 = buf + 4;\n\n\tsja1105_packing(reg1, &cmd->valid, 31, 31, size, op);\n\tsja1105_packing(reg1, &cmd->index, 26, 24, size, op);\n}\n\nstatic size_t sja1105et_mac_config_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t\t enum packing_op op)\n{\n\tconst int size = SJA1105ET_SIZE_MAC_CONFIG_DYN_ENTRY;\n\tstruct sja1105_mac_config_entry *entry = entry_ptr;\n\t \n\tu8 *reg1 = buf + 4;\n\tu8 *reg2 = buf;\n\n\tsja1105_packing(reg1, &entry->speed,     30, 29, size, op);\n\tsja1105_packing(reg1, &entry->drpdtag,   23, 23, size, op);\n\tsja1105_packing(reg1, &entry->drpuntag,  22, 22, size, op);\n\tsja1105_packing(reg1, &entry->retag,     21, 21, size, op);\n\tsja1105_packing(reg1, &entry->dyn_learn, 20, 20, size, op);\n\tsja1105_packing(reg1, &entry->egress,    19, 19, size, op);\n\tsja1105_packing(reg1, &entry->ingress,   18, 18, size, op);\n\tsja1105_packing(reg1, &entry->ing_mirr,  17, 17, size, op);\n\tsja1105_packing(reg1, &entry->egr_mirr,  16, 16, size, op);\n\tsja1105_packing(reg1, &entry->vlanprio,  14, 12, size, op);\n\tsja1105_packing(reg1, &entry->vlanid,    11,  0, size, op);\n\tsja1105_packing(reg2, &entry->tp_delin,  31, 16, size, op);\n\tsja1105_packing(reg2, &entry->tp_delout, 15,  0, size, op);\n\t \n\t \n\treturn 0;\n}\n\nstatic void\nsja1105pqrs_mac_config_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t   enum packing_op op)\n{\n\tconst int size = SJA1105ET_SIZE_MAC_CONFIG_DYN_ENTRY;\n\tu8 *p = buf + SJA1105PQRS_SIZE_MAC_CONFIG_ENTRY;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->errors,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    2,  0, size, op);\n}\n\nstatic void\nsja1110_mac_config_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t       enum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_MAC_CONFIG_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    3,  0, size, op);\n}\n\nstatic void\nsja1105et_l2_lookup_params_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t       enum packing_op op)\n{\n\tsja1105_packing(buf, &cmd->valid, 31, 31,\n\t\t\tSJA1105ET_SIZE_L2_LOOKUP_PARAMS_DYN_CMD, op);\n}\n\nstatic size_t\nsja1105et_l2_lookup_params_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t enum packing_op op)\n{\n\tstruct sja1105_l2_lookup_params_entry *entry = entry_ptr;\n\n\tsja1105_packing(buf, &entry->poly, 7, 0,\n\t\t\tSJA1105ET_SIZE_L2_LOOKUP_PARAMS_DYN_CMD, op);\n\t \n\treturn 0;\n}\n\nstatic void\nsja1105pqrs_l2_lookup_params_cmd_packing(void *buf,\n\t\t\t\t\t struct sja1105_dyn_cmd *cmd,\n\t\t\t\t\t enum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_L2_LOOKUP_PARAMS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n}\n\nstatic void\nsja1110_l2_lookup_params_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t     enum packing_op op)\n{\n\tu8 *p = buf + SJA1110_SIZE_L2_LOOKUP_PARAMS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n}\n\nstatic void\nsja1105et_general_params_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t     enum packing_op op)\n{\n\tconst int size = SJA1105ET_SIZE_GENERAL_PARAMS_DYN_CMD;\n\n\tsja1105_packing(buf, &cmd->valid,  31, 31, size, op);\n\tsja1105_packing(buf, &cmd->errors, 30, 30, size, op);\n}\n\nstatic size_t\nsja1105et_general_params_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t       enum packing_op op)\n{\n\tstruct sja1105_general_params_entry *entry = entry_ptr;\n\tconst int size = SJA1105ET_SIZE_GENERAL_PARAMS_DYN_CMD;\n\n\tsja1105_packing(buf, &entry->mirr_port, 2, 0, size, op);\n\t \n\treturn 0;\n}\n\nstatic void\nsja1105pqrs_general_params_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t       enum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_GENERAL_PARAMS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->errors,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 28, 28, size, op);\n}\n\nstatic void\nsja1110_general_params_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t   enum packing_op op)\n{\n\tu8 *p = buf + SJA1110_SIZE_GENERAL_PARAMS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n}\n\nstatic void\nsja1105pqrs_avb_params_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t   enum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_AVB_PARAMS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->errors,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 29, 29, size, op);\n}\n\nstatic void\nsja1105_retagging_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t      enum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_RETAGGING_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,    31, 31, size, op);\n\tsja1105_packing(p, &cmd->errors,   30, 30, size, op);\n\tsja1105_packing(p, &cmd->valident, 29, 29, size, op);\n\tsja1105_packing(p, &cmd->rdwrset,  28, 28, size, op);\n\tsja1105_packing(p, &cmd->index,     5,  0, size, op);\n}\n\nstatic void\nsja1110_retagging_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t      enum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_RETAGGING_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,    31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset,  30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,   29, 29, size, op);\n\tsja1105_packing(p, &cmd->valident, 28, 28, size, op);\n\tsja1105_packing(p, &cmd->index,     4,  0, size, op);\n}\n\nstatic void sja1105et_cbs_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t      enum packing_op op)\n{\n\tu8 *p = buf + SJA1105ET_SIZE_CBS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid, 31, 31, size, op);\n\tsja1105_packing(p, &cmd->index, 19, 16, size, op);\n}\n\nstatic size_t sja1105et_cbs_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t  enum packing_op op)\n{\n\tconst size_t size = SJA1105ET_SIZE_CBS_ENTRY;\n\tstruct sja1105_cbs_entry *entry = entry_ptr;\n\tu8 *cmd = buf + size;\n\tu32 *p = buf;\n\n\tsja1105_packing(cmd, &entry->port, 5, 3, SJA1105_SIZE_DYN_CMD, op);\n\tsja1105_packing(cmd, &entry->prio, 2, 0, SJA1105_SIZE_DYN_CMD, op);\n\tsja1105_packing(p + 3, &entry->credit_lo,  31, 0, size, op);\n\tsja1105_packing(p + 2, &entry->credit_hi,  31, 0, size, op);\n\tsja1105_packing(p + 1, &entry->send_slope, 31, 0, size, op);\n\tsja1105_packing(p + 0, &entry->idle_slope, 31, 0, size, op);\n\treturn size;\n}\n\nstatic void sja1105pqrs_cbs_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t\tenum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_CBS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    3,  0, size, op);\n}\n\nstatic void sja1110_cbs_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t    enum packing_op op)\n{\n\tu8 *p = buf + SJA1105PQRS_SIZE_CBS_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    7,  0, size, op);\n}\n\nstatic size_t sja1105pqrs_cbs_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\t    enum packing_op op)\n{\n\tconst size_t size = SJA1105PQRS_SIZE_CBS_ENTRY;\n\tstruct sja1105_cbs_entry *entry = entry_ptr;\n\n\tsja1105_packing(buf, &entry->port,      159, 157, size, op);\n\tsja1105_packing(buf, &entry->prio,      156, 154, size, op);\n\tsja1105_packing(buf, &entry->credit_lo, 153, 122, size, op);\n\tsja1105_packing(buf, &entry->credit_hi, 121,  90, size, op);\n\tsja1105_packing(buf, &entry->send_slope, 89,  58, size, op);\n\tsja1105_packing(buf, &entry->idle_slope, 57,  26, size, op);\n\treturn size;\n}\n\nstatic size_t sja1110_cbs_entry_packing(void *buf, void *entry_ptr,\n\t\t\t\t\tenum packing_op op)\n{\n\tconst size_t size = SJA1105PQRS_SIZE_CBS_ENTRY;\n\tstruct sja1105_cbs_entry *entry = entry_ptr;\n\tu64 entry_type = SJA1110_CBS_SHAPER;\n\n\tsja1105_packing(buf, &entry_type,       159, 159, size, op);\n\tsja1105_packing(buf, &entry->credit_lo, 151, 120, size, op);\n\tsja1105_packing(buf, &entry->credit_hi, 119,  88, size, op);\n\tsja1105_packing(buf, &entry->send_slope, 87,  56, size, op);\n\tsja1105_packing(buf, &entry->idle_slope, 55,  24, size, op);\n\treturn size;\n}\n\nstatic void sja1110_dummy_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\t      enum packing_op op)\n{\n}\n\nstatic void\nsja1110_l2_policing_cmd_packing(void *buf, struct sja1105_dyn_cmd *cmd,\n\t\t\t\tenum packing_op op)\n{\n\tu8 *p = buf + SJA1105_SIZE_L2_POLICING_ENTRY;\n\tconst int size = SJA1105_SIZE_DYN_CMD;\n\n\tsja1105_packing(p, &cmd->valid,   31, 31, size, op);\n\tsja1105_packing(p, &cmd->rdwrset, 30, 30, size, op);\n\tsja1105_packing(p, &cmd->errors,  29, 29, size, op);\n\tsja1105_packing(p, &cmd->index,    6,  0, size, op);\n}\n\n#define OP_READ\t\tBIT(0)\n#define OP_WRITE\tBIT(1)\n#define OP_DEL\t\tBIT(2)\n#define OP_SEARCH\tBIT(3)\n#define OP_VALID_ANYWAY\tBIT(4)\n\n \nconst struct sja1105_dynamic_table_ops sja1105et_dyn_ops[BLK_IDX_MAX_DYN] = {\n\t[BLK_IDX_VL_LOOKUP] = {\n\t\t.entry_packing = sja1105et_vl_lookup_entry_packing,\n\t\t.cmd_packing = sja1105et_vl_lookup_cmd_packing,\n\t\t.access = OP_WRITE,\n\t\t.max_entry_count = SJA1105_MAX_VL_LOOKUP_COUNT,\n\t\t.packed_size = SJA1105ET_SIZE_VL_LOOKUP_DYN_CMD,\n\t\t.addr = 0x35,\n\t},\n\t[BLK_IDX_L2_LOOKUP] = {\n\t\t.entry_packing = sja1105et_dyn_l2_lookup_entry_packing,\n\t\t.cmd_packing = sja1105et_l2_lookup_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL),\n\t\t.max_entry_count = SJA1105_MAX_L2_LOOKUP_COUNT,\n\t\t.packed_size = SJA1105ET_SIZE_L2_LOOKUP_DYN_CMD,\n\t\t.addr = 0x20,\n\t},\n\t[BLK_IDX_MGMT_ROUTE] = {\n\t\t.entry_packing = sja1105et_mgmt_route_entry_packing,\n\t\t.cmd_packing = sja1105et_mgmt_route_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.max_entry_count = SJA1105_NUM_PORTS,\n\t\t.packed_size = SJA1105ET_SIZE_L2_LOOKUP_DYN_CMD,\n\t\t.addr = 0x20,\n\t},\n\t[BLK_IDX_VLAN_LOOKUP] = {\n\t\t.entry_packing = sja1105_vlan_lookup_entry_packing,\n\t\t.cmd_packing = sja1105_vlan_lookup_cmd_packing,\n\t\t.access = (OP_WRITE | OP_DEL),\n\t\t.max_entry_count = SJA1105_MAX_VLAN_LOOKUP_COUNT,\n\t\t.packed_size = SJA1105_SIZE_VLAN_LOOKUP_DYN_CMD,\n\t\t.addr = 0x27,\n\t},\n\t[BLK_IDX_L2_FORWARDING] = {\n\t\t.entry_packing = sja1105_l2_forwarding_entry_packing,\n\t\t.cmd_packing = sja1105_l2_forwarding_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_L2_FORWARDING_COUNT,\n\t\t.access = OP_WRITE,\n\t\t.packed_size = SJA1105_SIZE_L2_FORWARDING_DYN_CMD,\n\t\t.addr = 0x24,\n\t},\n\t[BLK_IDX_MAC_CONFIG] = {\n\t\t.entry_packing = sja1105et_mac_config_entry_packing,\n\t\t.cmd_packing = sja1105et_mac_config_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_MAC_CONFIG_COUNT,\n\t\t.access = OP_WRITE,\n\t\t.packed_size = SJA1105ET_SIZE_MAC_CONFIG_DYN_CMD,\n\t\t.addr = 0x36,\n\t},\n\t[BLK_IDX_L2_LOOKUP_PARAMS] = {\n\t\t.entry_packing = sja1105et_l2_lookup_params_entry_packing,\n\t\t.cmd_packing = sja1105et_l2_lookup_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_L2_LOOKUP_PARAMS_COUNT,\n\t\t.access = OP_WRITE,\n\t\t.packed_size = SJA1105ET_SIZE_L2_LOOKUP_PARAMS_DYN_CMD,\n\t\t.addr = 0x38,\n\t},\n\t[BLK_IDX_GENERAL_PARAMS] = {\n\t\t.entry_packing = sja1105et_general_params_entry_packing,\n\t\t.cmd_packing = sja1105et_general_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_GENERAL_PARAMS_COUNT,\n\t\t.access = OP_WRITE,\n\t\t.packed_size = SJA1105ET_SIZE_GENERAL_PARAMS_DYN_CMD,\n\t\t.addr = 0x34,\n\t},\n\t[BLK_IDX_RETAGGING] = {\n\t\t.entry_packing = sja1105_retagging_entry_packing,\n\t\t.cmd_packing = sja1105_retagging_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_RETAGGING_COUNT,\n\t\t.access = (OP_WRITE | OP_DEL),\n\t\t.packed_size = SJA1105_SIZE_RETAGGING_DYN_CMD,\n\t\t.addr = 0x31,\n\t},\n\t[BLK_IDX_CBS] = {\n\t\t.entry_packing = sja1105et_cbs_entry_packing,\n\t\t.cmd_packing = sja1105et_cbs_cmd_packing,\n\t\t.max_entry_count = SJA1105ET_MAX_CBS_COUNT,\n\t\t.access = OP_WRITE,\n\t\t.packed_size = SJA1105ET_SIZE_CBS_DYN_CMD,\n\t\t.addr = 0x2c,\n\t},\n};\n\n \nconst struct sja1105_dynamic_table_ops sja1105pqrs_dyn_ops[BLK_IDX_MAX_DYN] = {\n\t[BLK_IDX_VL_LOOKUP] = {\n\t\t.entry_packing = sja1105_vl_lookup_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_vl_lookup_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE),\n\t\t.max_entry_count = SJA1105_MAX_VL_LOOKUP_COUNT,\n\t\t.packed_size = SJA1105PQRS_SIZE_VL_LOOKUP_DYN_CMD,\n\t\t.addr = 0x47,\n\t},\n\t[BLK_IDX_L2_LOOKUP] = {\n\t\t.entry_packing = sja1105pqrs_dyn_l2_lookup_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_l2_lookup_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL | OP_SEARCH),\n\t\t.max_entry_count = SJA1105_MAX_L2_LOOKUP_COUNT,\n\t\t.packed_size = SJA1105PQRS_SIZE_L2_LOOKUP_DYN_CMD,\n\t\t.addr = 0x24,\n\t},\n\t[BLK_IDX_MGMT_ROUTE] = {\n\t\t.entry_packing = sja1105pqrs_mgmt_route_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_mgmt_route_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL | OP_SEARCH | OP_VALID_ANYWAY),\n\t\t.max_entry_count = SJA1105_NUM_PORTS,\n\t\t.packed_size = SJA1105PQRS_SIZE_L2_LOOKUP_DYN_CMD,\n\t\t.addr = 0x24,\n\t},\n\t[BLK_IDX_VLAN_LOOKUP] = {\n\t\t.entry_packing = sja1105_vlan_lookup_entry_packing,\n\t\t.cmd_packing = sja1105_vlan_lookup_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL),\n\t\t.max_entry_count = SJA1105_MAX_VLAN_LOOKUP_COUNT,\n\t\t.packed_size = SJA1105_SIZE_VLAN_LOOKUP_DYN_CMD,\n\t\t.addr = 0x2D,\n\t},\n\t[BLK_IDX_L2_FORWARDING] = {\n\t\t.entry_packing = sja1105_l2_forwarding_entry_packing,\n\t\t.cmd_packing = sja1105_l2_forwarding_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_L2_FORWARDING_COUNT,\n\t\t.access = OP_WRITE,\n\t\t.packed_size = SJA1105_SIZE_L2_FORWARDING_DYN_CMD,\n\t\t.addr = 0x2A,\n\t},\n\t[BLK_IDX_MAC_CONFIG] = {\n\t\t.entry_packing = sja1105pqrs_mac_config_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_mac_config_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_MAC_CONFIG_COUNT,\n\t\t.access = (OP_READ | OP_WRITE),\n\t\t.packed_size = SJA1105PQRS_SIZE_MAC_CONFIG_DYN_CMD,\n\t\t.addr = 0x4B,\n\t},\n\t[BLK_IDX_L2_LOOKUP_PARAMS] = {\n\t\t.entry_packing = sja1105pqrs_l2_lookup_params_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_l2_lookup_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_L2_LOOKUP_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_WRITE),\n\t\t.packed_size = SJA1105PQRS_SIZE_L2_LOOKUP_PARAMS_DYN_CMD,\n\t\t.addr = 0x54,\n\t},\n\t[BLK_IDX_AVB_PARAMS] = {\n\t\t.entry_packing = sja1105pqrs_avb_params_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_avb_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_AVB_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_WRITE),\n\t\t.packed_size = SJA1105PQRS_SIZE_AVB_PARAMS_DYN_CMD,\n\t\t.addr = 0x8003,\n\t},\n\t[BLK_IDX_GENERAL_PARAMS] = {\n\t\t.entry_packing = sja1105pqrs_general_params_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_general_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_GENERAL_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_WRITE),\n\t\t.packed_size = SJA1105PQRS_SIZE_GENERAL_PARAMS_DYN_CMD,\n\t\t.addr = 0x3B,\n\t},\n\t[BLK_IDX_RETAGGING] = {\n\t\t.entry_packing = sja1105_retagging_entry_packing,\n\t\t.cmd_packing = sja1105_retagging_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_RETAGGING_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL),\n\t\t.packed_size = SJA1105_SIZE_RETAGGING_DYN_CMD,\n\t\t.addr = 0x38,\n\t},\n\t[BLK_IDX_CBS] = {\n\t\t.entry_packing = sja1105pqrs_cbs_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_cbs_cmd_packing,\n\t\t.max_entry_count = SJA1105PQRS_MAX_CBS_COUNT,\n\t\t.access = OP_WRITE,\n\t\t.packed_size = SJA1105PQRS_SIZE_CBS_DYN_CMD,\n\t\t.addr = 0x32,\n\t},\n};\n\n \nconst struct sja1105_dynamic_table_ops sja1110_dyn_ops[BLK_IDX_MAX_DYN] = {\n\t[BLK_IDX_VL_LOOKUP] = {\n\t\t.entry_packing = sja1110_vl_lookup_entry_packing,\n\t\t.cmd_packing = sja1110_vl_lookup_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.max_entry_count = SJA1110_MAX_VL_LOOKUP_COUNT,\n\t\t.packed_size = SJA1105PQRS_SIZE_VL_LOOKUP_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x124),\n\t},\n\t[BLK_IDX_VL_POLICING] = {\n\t\t.entry_packing = sja1110_vl_policing_entry_packing,\n\t\t.cmd_packing = sja1110_vl_policing_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.max_entry_count = SJA1110_MAX_VL_POLICING_COUNT,\n\t\t.packed_size = SJA1110_SIZE_VL_POLICING_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x310),\n\t},\n\t[BLK_IDX_L2_LOOKUP] = {\n\t\t.entry_packing = sja1110_dyn_l2_lookup_entry_packing,\n\t\t.cmd_packing = sja1110_l2_lookup_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL | OP_SEARCH),\n\t\t.max_entry_count = SJA1105_MAX_L2_LOOKUP_COUNT,\n\t\t.packed_size = SJA1110_SIZE_L2_LOOKUP_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x8c),\n\t},\n\t[BLK_IDX_VLAN_LOOKUP] = {\n\t\t.entry_packing = sja1110_vlan_lookup_entry_packing,\n\t\t.cmd_packing = sja1110_vlan_lookup_cmd_packing,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL),\n\t\t.max_entry_count = SJA1105_MAX_VLAN_LOOKUP_COUNT,\n\t\t.packed_size = SJA1110_SIZE_VLAN_LOOKUP_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0xb4),\n\t},\n\t[BLK_IDX_L2_FORWARDING] = {\n\t\t.entry_packing = sja1110_l2_forwarding_entry_packing,\n\t\t.cmd_packing = sja1110_l2_forwarding_cmd_packing,\n\t\t.max_entry_count = SJA1110_MAX_L2_FORWARDING_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1105_SIZE_L2_FORWARDING_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0xa8),\n\t},\n\t[BLK_IDX_MAC_CONFIG] = {\n\t\t.entry_packing = sja1110_mac_config_entry_packing,\n\t\t.cmd_packing = sja1110_mac_config_cmd_packing,\n\t\t.max_entry_count = SJA1110_MAX_MAC_CONFIG_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1105PQRS_SIZE_MAC_CONFIG_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x134),\n\t},\n\t[BLK_IDX_L2_LOOKUP_PARAMS] = {\n\t\t.entry_packing = sja1110_l2_lookup_params_entry_packing,\n\t\t.cmd_packing = sja1110_l2_lookup_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_L2_LOOKUP_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1110_SIZE_L2_LOOKUP_PARAMS_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x158),\n\t},\n\t[BLK_IDX_AVB_PARAMS] = {\n\t\t.entry_packing = sja1105pqrs_avb_params_entry_packing,\n\t\t.cmd_packing = sja1105pqrs_avb_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_AVB_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1105PQRS_SIZE_AVB_PARAMS_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x2000C),\n\t},\n\t[BLK_IDX_GENERAL_PARAMS] = {\n\t\t.entry_packing = sja1110_general_params_entry_packing,\n\t\t.cmd_packing = sja1110_general_params_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_GENERAL_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1110_SIZE_GENERAL_PARAMS_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0xe8),\n\t},\n\t[BLK_IDX_RETAGGING] = {\n\t\t.entry_packing = sja1110_retagging_entry_packing,\n\t\t.cmd_packing = sja1110_retagging_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_RETAGGING_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_DEL),\n\t\t.packed_size = SJA1105_SIZE_RETAGGING_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0xdc),\n\t},\n\t[BLK_IDX_CBS] = {\n\t\t.entry_packing = sja1110_cbs_entry_packing,\n\t\t.cmd_packing = sja1110_cbs_cmd_packing,\n\t\t.max_entry_count = SJA1110_MAX_CBS_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1105PQRS_SIZE_CBS_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0xc4),\n\t},\n\t[BLK_IDX_XMII_PARAMS] = {\n\t\t.entry_packing = sja1110_xmii_params_entry_packing,\n\t\t.cmd_packing = sja1110_dummy_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_XMII_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1110_SIZE_XMII_PARAMS_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x3c),\n\t},\n\t[BLK_IDX_L2_POLICING] = {\n\t\t.entry_packing = sja1110_l2_policing_entry_packing,\n\t\t.cmd_packing = sja1110_l2_policing_cmd_packing,\n\t\t.max_entry_count = SJA1110_MAX_L2_POLICING_COUNT,\n\t\t.access = (OP_READ | OP_WRITE | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1110_SIZE_L2_POLICING_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x2fc),\n\t},\n\t[BLK_IDX_L2_FORWARDING_PARAMS] = {\n\t\t.entry_packing = sja1110_l2_forwarding_params_entry_packing,\n\t\t.cmd_packing = sja1110_dummy_cmd_packing,\n\t\t.max_entry_count = SJA1105_MAX_L2_FORWARDING_PARAMS_COUNT,\n\t\t.access = (OP_READ | OP_VALID_ANYWAY),\n\t\t.packed_size = SJA1110_SIZE_L2_FORWARDING_PARAMS_DYN_CMD,\n\t\t.addr = SJA1110_SPI_ADDR(0x20000),\n\t},\n};\n\n#define SJA1105_DYNAMIC_CONFIG_SLEEP_US\t\t10\n#define SJA1105_DYNAMIC_CONFIG_TIMEOUT_US\t100000\n\nstatic int\nsja1105_dynamic_config_poll_valid(struct sja1105_private *priv,\n\t\t\t\t  const struct sja1105_dynamic_table_ops *ops,\n\t\t\t\t  void *entry, bool check_valident,\n\t\t\t\t  bool check_errors)\n{\n\tu8 packed_buf[SJA1105_MAX_DYN_CMD_SIZE] = {};\n\tstruct sja1105_dyn_cmd cmd = {};\n\tint rc;\n\n\t \n\trc = sja1105_xfer_buf(priv, SPI_READ, ops->addr, packed_buf,\n\t\t\t      ops->packed_size);\n\tif (rc)\n\t\treturn rc;\n\n\t \n\tops->cmd_packing(packed_buf, &cmd, UNPACK);\n\n\t \n\tif (cmd.valid)\n\t\treturn -EAGAIN;\n\n\tif (check_valident && !cmd.valident && !(ops->access & OP_VALID_ANYWAY))\n\t\treturn -ENOENT;\n\n\tif (check_errors && cmd.errors)\n\t\treturn -EINVAL;\n\n\t \n\tif (entry)\n\t\tops->entry_packing(packed_buf, entry, UNPACK);\n\n\treturn 0;\n}\n\n \nstatic int\nsja1105_dynamic_config_wait_complete(struct sja1105_private *priv,\n\t\t\t\t     const struct sja1105_dynamic_table_ops *ops,\n\t\t\t\t     void *entry, bool check_valident,\n\t\t\t\t     bool check_errors)\n{\n\tint err, rc;\n\n\terr = read_poll_timeout(sja1105_dynamic_config_poll_valid,\n\t\t\t\trc, rc != -EAGAIN,\n\t\t\t\tSJA1105_DYNAMIC_CONFIG_SLEEP_US,\n\t\t\t\tSJA1105_DYNAMIC_CONFIG_TIMEOUT_US,\n\t\t\t\tfalse, priv, ops, entry, check_valident,\n\t\t\t\tcheck_errors);\n\treturn err < 0 ? err : rc;\n}\n\n \nint sja1105_dynamic_config_read(struct sja1105_private *priv,\n\t\t\t\tenum sja1105_blk_idx blk_idx,\n\t\t\t\tint index, void *entry)\n{\n\tconst struct sja1105_dynamic_table_ops *ops;\n\tstruct sja1105_dyn_cmd cmd = {0};\n\t \n\tu8 packed_buf[SJA1105_MAX_DYN_CMD_SIZE] = {0};\n\tint rc;\n\n\tif (blk_idx >= BLK_IDX_MAX_DYN)\n\t\treturn -ERANGE;\n\n\tops = &priv->info->dyn_ops[blk_idx];\n\n\tif (index >= 0 && index >= ops->max_entry_count)\n\t\treturn -ERANGE;\n\tif (index < 0 && !(ops->access & OP_SEARCH))\n\t\treturn -EOPNOTSUPP;\n\tif (!(ops->access & OP_READ))\n\t\treturn -EOPNOTSUPP;\n\tif (ops->packed_size > SJA1105_MAX_DYN_CMD_SIZE)\n\t\treturn -ERANGE;\n\tif (!ops->cmd_packing)\n\t\treturn -EOPNOTSUPP;\n\tif (!ops->entry_packing)\n\t\treturn -EOPNOTSUPP;\n\n\tcmd.valid = true;  \n\tcmd.rdwrset = SPI_READ;  \n\tif (index < 0) {\n\t\t \n\t\tcmd.index = 0;\n\t\tcmd.search = true;\n\t} else {\n\t\tcmd.index = index;\n\t\tcmd.search = false;\n\t}\n\tcmd.valident = true;\n\tops->cmd_packing(packed_buf, &cmd, PACK);\n\n\tif (cmd.search)\n\t\tops->entry_packing(packed_buf, entry, PACK);\n\n\t \n\tmutex_lock(&priv->dynamic_config_lock);\n\trc = sja1105_xfer_buf(priv, SPI_WRITE, ops->addr, packed_buf,\n\t\t\t      ops->packed_size);\n\tif (rc < 0)\n\t\tgoto out;\n\n\trc = sja1105_dynamic_config_wait_complete(priv, ops, entry, true, false);\nout:\n\tmutex_unlock(&priv->dynamic_config_lock);\n\n\treturn rc;\n}\n\nint sja1105_dynamic_config_write(struct sja1105_private *priv,\n\t\t\t\t enum sja1105_blk_idx blk_idx,\n\t\t\t\t int index, void *entry, bool keep)\n{\n\tconst struct sja1105_dynamic_table_ops *ops;\n\tstruct sja1105_dyn_cmd cmd = {0};\n\t \n\tu8 packed_buf[SJA1105_MAX_DYN_CMD_SIZE] = {0};\n\tint rc;\n\n\tif (blk_idx >= BLK_IDX_MAX_DYN)\n\t\treturn -ERANGE;\n\n\tops = &priv->info->dyn_ops[blk_idx];\n\n\tif (index >= ops->max_entry_count)\n\t\treturn -ERANGE;\n\tif (index < 0)\n\t\treturn -ERANGE;\n\tif (!(ops->access & OP_WRITE))\n\t\treturn -EOPNOTSUPP;\n\tif (!keep && !(ops->access & OP_DEL))\n\t\treturn -EOPNOTSUPP;\n\tif (ops->packed_size > SJA1105_MAX_DYN_CMD_SIZE)\n\t\treturn -ERANGE;\n\n\tcmd.valident = keep;  \n\tcmd.valid = true;  \n\tcmd.rdwrset = SPI_WRITE;  \n\tcmd.index = index;\n\n\tif (!ops->cmd_packing)\n\t\treturn -EOPNOTSUPP;\n\tops->cmd_packing(packed_buf, &cmd, PACK);\n\n\tif (!ops->entry_packing)\n\t\treturn -EOPNOTSUPP;\n\t \n\tif (keep)\n\t\tops->entry_packing(packed_buf, entry, PACK);\n\n\t \n\tmutex_lock(&priv->dynamic_config_lock);\n\trc = sja1105_xfer_buf(priv, SPI_WRITE, ops->addr, packed_buf,\n\t\t\t      ops->packed_size);\n\tif (rc < 0)\n\t\tgoto out;\n\n\trc = sja1105_dynamic_config_wait_complete(priv, ops, NULL, false, true);\nout:\n\tmutex_unlock(&priv->dynamic_config_lock);\n\n\treturn rc;\n}\n\nstatic u8 sja1105_crc8_add(u8 crc, u8 byte, u8 poly)\n{\n\tint i;\n\n\tfor (i = 0; i < 8; i++) {\n\t\tif ((crc ^ byte) & (1 << 7)) {\n\t\t\tcrc <<= 1;\n\t\t\tcrc ^= poly;\n\t\t} else {\n\t\t\tcrc <<= 1;\n\t\t}\n\t\tbyte <<= 1;\n\t}\n\treturn crc;\n}\n\n \nu8 sja1105et_fdb_hash(struct sja1105_private *priv, const u8 *addr, u16 vid)\n{\n\tstruct sja1105_l2_lookup_params_entry *l2_lookup_params =\n\t\tpriv->static_config.tables[BLK_IDX_L2_LOOKUP_PARAMS].entries;\n\tu64 input, poly_koopman = l2_lookup_params->poly;\n\t \n\tu8 poly = (u8)(1 + (poly_koopman << 1));\n\tu8 crc = 0;  \n\tint i;\n\n\tinput = ((u64)vid << 48) | ether_addr_to_u64(addr);\n\n\t \n\tfor (i = 56; i >= 0; i -= 8) {\n\t\tu8 byte = (input & (0xffull << i)) >> i;\n\n\t\tcrc = sja1105_crc8_add(crc, byte, poly);\n\t}\n\treturn crc;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}