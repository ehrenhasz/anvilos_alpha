{
  "module_name": "sja1105_ethtool.c",
  "hash_id": "0b6bd42ecbdd0afd3c767fe51fec85880d33d8b8fb2d37ece28796db72afe27f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/sja1105/sja1105_ethtool.c",
  "human_readable_source": "\n \n#include \"sja1105.h\"\n\nenum sja1105_counter_index {\n\t__SJA1105_COUNTER_UNUSED,\n\t \n\tN_RUNT,\n\tN_SOFERR,\n\tN_ALIGNERR,\n\tN_MIIERR,\n\tTYPEERR,\n\tSIZEERR,\n\tTCTIMEOUT,\n\tPRIORERR,\n\tNOMASTER,\n\tMEMOV,\n\tMEMERR,\n\tINVTYP,\n\tINTCYOV,\n\tDOMERR,\n\tPCFBAGDROP,\n\tSPCPRIOR,\n\tAGEPRIOR,\n\tPORTDROP,\n\tLENDROP,\n\tBAGDROP,\n\tPOLICEERR,\n\tDRPNONA664ERR,\n\tSPCERR,\n\tAGEDRP,\n\t \n\tN_N664ERR,\n\tN_VLANERR,\n\tN_UNRELEASED,\n\tN_SIZEERR,\n\tN_CRCERR,\n\tN_VLNOTFOUND,\n\tN_CTPOLERR,\n\tN_POLERR,\n\tN_RXFRM,\n\tN_RXBYTE,\n\tN_TXFRM,\n\tN_TXBYTE,\n\t \n\tN_QFULL,\n\tN_PART_DROP,\n\tN_EGR_DISABLED,\n\tN_NOT_REACH,\n\t__MAX_SJA1105ET_PORT_COUNTER,\n\t \n\t \n\tN_DROPS_NOLEARN = __MAX_SJA1105ET_PORT_COUNTER,\n\tN_DROPS_NOROUTE,\n\tN_DROPS_ILL_DTAG,\n\tN_DROPS_DTAG,\n\tN_DROPS_SOTAG,\n\tN_DROPS_SITAG,\n\tN_DROPS_UTAG,\n\tN_TX_BYTES_1024_2047,\n\tN_TX_BYTES_512_1023,\n\tN_TX_BYTES_256_511,\n\tN_TX_BYTES_128_255,\n\tN_TX_BYTES_65_127,\n\tN_TX_BYTES_64,\n\tN_TX_MCAST,\n\tN_TX_BCAST,\n\tN_RX_BYTES_1024_2047,\n\tN_RX_BYTES_512_1023,\n\tN_RX_BYTES_256_511,\n\tN_RX_BYTES_128_255,\n\tN_RX_BYTES_65_127,\n\tN_RX_BYTES_64,\n\tN_RX_MCAST,\n\tN_RX_BCAST,\n\t__MAX_SJA1105PQRS_PORT_COUNTER,\n};\n\nstruct sja1105_port_counter {\n\tenum sja1105_stats_area area;\n\tconst char name[ETH_GSTRING_LEN];\n\tint offset;\n\tint start;\n\tint end;\n\tbool is_64bit;\n};\n\nstatic const struct sja1105_port_counter sja1105_port_counters[] = {\n\t \n\t[N_RUNT] = {\n\t\t.area = MAC,\n\t\t.name = \"n_runt\",\n\t\t.offset = 0,\n\t\t.start = 31,\n\t\t.end = 24,\n\t},\n\t[N_SOFERR] = {\n\t\t.area = MAC,\n\t\t.name = \"n_soferr\",\n\t\t.offset = 0x0,\n\t\t.start = 23,\n\t\t.end = 16,\n\t},\n\t[N_ALIGNERR] = {\n\t\t.area = MAC,\n\t\t.name = \"n_alignerr\",\n\t\t.offset = 0x0,\n\t\t.start = 15,\n\t\t.end = 8,\n\t},\n\t[N_MIIERR] = {\n\t\t.area = MAC,\n\t\t.name = \"n_miierr\",\n\t\t.offset = 0x0,\n\t\t.start = 7,\n\t\t.end = 0,\n\t},\n\t \n\t[TYPEERR] = {\n\t\t.area = MAC,\n\t\t.name = \"typeerr\",\n\t\t.offset = 0x1,\n\t\t.start = 27,\n\t\t.end = 27,\n\t},\n\t[SIZEERR] = {\n\t\t.area = MAC,\n\t\t.name = \"sizeerr\",\n\t\t.offset = 0x1,\n\t\t.start = 26,\n\t\t.end = 26,\n\t},\n\t[TCTIMEOUT] = {\n\t\t.area = MAC,\n\t\t.name = \"tctimeout\",\n\t\t.offset = 0x1,\n\t\t.start = 25,\n\t\t.end = 25,\n\t},\n\t[PRIORERR] = {\n\t\t.area = MAC,\n\t\t.name = \"priorerr\",\n\t\t.offset = 0x1,\n\t\t.start = 24,\n\t\t.end = 24,\n\t},\n\t[NOMASTER] = {\n\t\t.area = MAC,\n\t\t.name = \"nomaster\",\n\t\t.offset = 0x1,\n\t\t.start = 23,\n\t\t.end = 23,\n\t},\n\t[MEMOV] = {\n\t\t.area = MAC,\n\t\t.name = \"memov\",\n\t\t.offset = 0x1,\n\t\t.start = 22,\n\t\t.end = 22,\n\t},\n\t[MEMERR] = {\n\t\t.area = MAC,\n\t\t.name = \"memerr\",\n\t\t.offset = 0x1,\n\t\t.start = 21,\n\t\t.end = 21,\n\t},\n\t[INVTYP] = {\n\t\t.area = MAC,\n\t\t.name = \"invtyp\",\n\t\t.offset = 0x1,\n\t\t.start = 19,\n\t\t.end = 19,\n\t},\n\t[INTCYOV] = {\n\t\t.area = MAC,\n\t\t.name = \"intcyov\",\n\t\t.offset = 0x1,\n\t\t.start = 18,\n\t\t.end = 18,\n\t},\n\t[DOMERR] = {\n\t\t.area = MAC,\n\t\t.name = \"domerr\",\n\t\t.offset = 0x1,\n\t\t.start = 17,\n\t\t.end = 17,\n\t},\n\t[PCFBAGDROP] = {\n\t\t.area = MAC,\n\t\t.name = \"pcfbagdrop\",\n\t\t.offset = 0x1,\n\t\t.start = 16,\n\t\t.end = 16,\n\t},\n\t[SPCPRIOR] = {\n\t\t.area = MAC,\n\t\t.name = \"spcprior\",\n\t\t.offset = 0x1,\n\t\t.start = 15,\n\t\t.end = 12,\n\t},\n\t[AGEPRIOR] = {\n\t\t.area = MAC,\n\t\t.name = \"ageprior\",\n\t\t.offset = 0x1,\n\t\t.start = 11,\n\t\t.end = 8,\n\t},\n\t[PORTDROP] = {\n\t\t.area = MAC,\n\t\t.name = \"portdrop\",\n\t\t.offset = 0x1,\n\t\t.start = 6,\n\t\t.end = 6,\n\t},\n\t[LENDROP] = {\n\t\t.area = MAC,\n\t\t.name = \"lendrop\",\n\t\t.offset = 0x1,\n\t\t.start = 5,\n\t\t.end = 5,\n\t},\n\t[BAGDROP] = {\n\t\t.area = MAC,\n\t\t.name = \"bagdrop\",\n\t\t.offset = 0x1,\n\t\t.start = 4,\n\t\t.end = 4,\n\t},\n\t[POLICEERR] = {\n\t\t.area = MAC,\n\t\t.name = \"policeerr\",\n\t\t.offset = 0x1,\n\t\t.start = 3,\n\t\t.end = 3,\n\t},\n\t[DRPNONA664ERR] = {\n\t\t.area = MAC,\n\t\t.name = \"drpnona664err\",\n\t\t.offset = 0x1,\n\t\t.start = 2,\n\t\t.end = 2,\n\t},\n\t[SPCERR] = {\n\t\t.area = MAC,\n\t\t.name = \"spcerr\",\n\t\t.offset = 0x1,\n\t\t.start = 1,\n\t\t.end = 1,\n\t},\n\t[AGEDRP] = {\n\t\t.area = MAC,\n\t\t.name = \"agedrp\",\n\t\t.offset = 0x1,\n\t\t.start = 0,\n\t\t.end = 0,\n\t},\n\t \n\t[N_N664ERR] = {\n\t\t.area = HL1,\n\t\t.name = \"n_n664err\",\n\t\t.offset = 0xF,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_VLANERR] = {\n\t\t.area = HL1,\n\t\t.name = \"n_vlanerr\",\n\t\t.offset = 0xE,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_UNRELEASED] = {\n\t\t.area = HL1,\n\t\t.name = \"n_unreleased\",\n\t\t.offset = 0xD,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_SIZEERR] = {\n\t\t.area = HL1,\n\t\t.name = \"n_sizeerr\",\n\t\t.offset = 0xC,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_CRCERR] = {\n\t\t.area = HL1,\n\t\t.name = \"n_crcerr\",\n\t\t.offset = 0xB,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_VLNOTFOUND] = {\n\t\t.area = HL1,\n\t\t.name = \"n_vlnotfound\",\n\t\t.offset = 0xA,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_CTPOLERR] = {\n\t\t.area = HL1,\n\t\t.name = \"n_ctpolerr\",\n\t\t.offset = 0x9,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_POLERR] = {\n\t\t.area = HL1,\n\t\t.name = \"n_polerr\",\n\t\t.offset = 0x8,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RXFRM] = {\n\t\t.area = HL1,\n\t\t.name = \"n_rxfrm\",\n\t\t.offset = 0x6,\n\t\t.start = 31,\n\t\t.end = 0,\n\t\t.is_64bit = true,\n\t},\n\t[N_RXBYTE] = {\n\t\t.area = HL1,\n\t\t.name = \"n_rxbyte\",\n\t\t.offset = 0x4,\n\t\t.start = 31,\n\t\t.end = 0,\n\t\t.is_64bit = true,\n\t},\n\t[N_TXFRM] = {\n\t\t.area = HL1,\n\t\t.name = \"n_txfrm\",\n\t\t.offset = 0x2,\n\t\t.start = 31,\n\t\t.end = 0,\n\t\t.is_64bit = true,\n\t},\n\t[N_TXBYTE] = {\n\t\t.area = HL1,\n\t\t.name = \"n_txbyte\",\n\t\t.offset = 0x0,\n\t\t.start = 31,\n\t\t.end = 0,\n\t\t.is_64bit = true,\n\t},\n\t[N_QFULL] = {\n\t\t.area = HL2,\n\t\t.name = \"n_qfull\",\n\t\t.offset = 0x3,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_PART_DROP] = {\n\t\t.area = HL2,\n\t\t.name = \"n_part_drop\",\n\t\t.offset = 0x2,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_EGR_DISABLED] = {\n\t\t.area = HL2,\n\t\t.name = \"n_egr_disabled\",\n\t\t.offset = 0x1,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_NOT_REACH] = {\n\t\t.area = HL2,\n\t\t.name = \"n_not_reach\",\n\t\t.offset = 0x0,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t \n\t[N_DROPS_NOLEARN] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_drops_nolearn\",\n\t\t.offset = 0x16,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_DROPS_NOROUTE] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_drops_noroute\",\n\t\t.offset = 0x15,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_DROPS_ILL_DTAG] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_drops_ill_dtag\",\n\t\t.offset = 0x14,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_DROPS_DTAG] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_drops_dtag\",\n\t\t.offset = 0x13,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_DROPS_SOTAG] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_drops_sotag\",\n\t\t.offset = 0x12,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_DROPS_SITAG] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_drops_sitag\",\n\t\t.offset = 0x11,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_DROPS_UTAG] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_drops_utag\",\n\t\t.offset = 0x10,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_BYTES_1024_2047] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_bytes_1024_2047\",\n\t\t.offset = 0x0F,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_BYTES_512_1023] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_bytes_512_1023\",\n\t\t.offset = 0x0E,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_BYTES_256_511] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_bytes_256_511\",\n\t\t.offset = 0x0D,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_BYTES_128_255] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_bytes_128_255\",\n\t\t.offset = 0x0C,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_BYTES_65_127] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_bytes_65_127\",\n\t\t.offset = 0x0B,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_BYTES_64] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_bytes_64\",\n\t\t.offset = 0x0A,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_MCAST] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_mcast\",\n\t\t.offset = 0x09,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_TX_BCAST] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_tx_bcast\",\n\t\t.offset = 0x08,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_BYTES_1024_2047] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_bytes_1024_2047\",\n\t\t.offset = 0x07,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_BYTES_512_1023] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_bytes_512_1023\",\n\t\t.offset = 0x06,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_BYTES_256_511] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_bytes_256_511\",\n\t\t.offset = 0x05,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_BYTES_128_255] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_bytes_128_255\",\n\t\t.offset = 0x04,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_BYTES_65_127] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_bytes_65_127\",\n\t\t.offset = 0x03,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_BYTES_64] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_bytes_64\",\n\t\t.offset = 0x02,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_MCAST] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_mcast\",\n\t\t.offset = 0x01,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n\t[N_RX_BCAST] = {\n\t\t.area = ETHER,\n\t\t.name = \"n_rx_bcast\",\n\t\t.offset = 0x00,\n\t\t.start = 31,\n\t\t.end = 0,\n\t},\n};\n\nstatic int sja1105_port_counter_read(struct sja1105_private *priv, int port,\n\t\t\t\t     enum sja1105_counter_index idx, u64 *ctr)\n{\n\tconst struct sja1105_port_counter *c = &sja1105_port_counters[idx];\n\tsize_t size = c->is_64bit ? 8 : 4;\n\tu8 buf[8] = {0};\n\tu64 regs;\n\tint rc;\n\n\tregs = priv->info->regs->stats[c->area][port];\n\n\trc = sja1105_xfer_buf(priv, SPI_READ, regs + c->offset, buf, size);\n\tif (rc)\n\t\treturn rc;\n\n\tsja1105_unpack(buf, ctr, c->start, c->end, size);\n\n\treturn 0;\n}\n\nvoid sja1105_get_ethtool_stats(struct dsa_switch *ds, int port, u64 *data)\n{\n\tstruct sja1105_private *priv = ds->priv;\n\tenum sja1105_counter_index max_ctr, i;\n\tint rc, k = 0;\n\n\tif (priv->info->device_id == SJA1105E_DEVICE_ID ||\n\t    priv->info->device_id == SJA1105T_DEVICE_ID)\n\t\tmax_ctr = __MAX_SJA1105ET_PORT_COUNTER;\n\telse\n\t\tmax_ctr = __MAX_SJA1105PQRS_PORT_COUNTER;\n\n\tfor (i = 0; i < max_ctr; i++) {\n\t\trc = sja1105_port_counter_read(priv, port, i, &data[k++]);\n\t\tif (rc) {\n\t\t\tdev_err(ds->dev,\n\t\t\t\t\"Failed to read port %d counters: %d\\n\",\n\t\t\t\tport, rc);\n\t\t\tbreak;\n\t\t}\n\t}\n}\n\nvoid sja1105_get_strings(struct dsa_switch *ds, int port,\n\t\t\t u32 stringset, u8 *data)\n{\n\tstruct sja1105_private *priv = ds->priv;\n\tenum sja1105_counter_index max_ctr, i;\n\tchar *p = data;\n\n\tif (stringset != ETH_SS_STATS)\n\t\treturn;\n\n\tif (priv->info->device_id == SJA1105E_DEVICE_ID ||\n\t    priv->info->device_id == SJA1105T_DEVICE_ID)\n\t\tmax_ctr = __MAX_SJA1105ET_PORT_COUNTER;\n\telse\n\t\tmax_ctr = __MAX_SJA1105PQRS_PORT_COUNTER;\n\n\tfor (i = 0; i < max_ctr; i++) {\n\t\tstrscpy(p, sja1105_port_counters[i].name, ETH_GSTRING_LEN);\n\t\tp += ETH_GSTRING_LEN;\n\t}\n}\n\nint sja1105_get_sset_count(struct dsa_switch *ds, int port, int sset)\n{\n\tstruct sja1105_private *priv = ds->priv;\n\tenum sja1105_counter_index max_ctr, i;\n\tint sset_count = 0;\n\n\tif (sset != ETH_SS_STATS)\n\t\treturn -EOPNOTSUPP;\n\n\tif (priv->info->device_id == SJA1105E_DEVICE_ID ||\n\t    priv->info->device_id == SJA1105T_DEVICE_ID)\n\t\tmax_ctr = __MAX_SJA1105ET_PORT_COUNTER;\n\telse\n\t\tmax_ctr = __MAX_SJA1105PQRS_PORT_COUNTER;\n\n\tfor (i = 0; i < max_ctr; i++) {\n\t\tif (!strlen(sja1105_port_counters[i].name))\n\t\t\tcontinue;\n\n\t\tsset_count++;\n\t}\n\n\treturn sset_count;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}