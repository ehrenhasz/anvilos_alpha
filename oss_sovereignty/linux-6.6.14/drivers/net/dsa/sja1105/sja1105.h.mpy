{
  "module_name": "sja1105.h",
  "hash_id": "eb9d7d258eb5506b54c71e649d423a03ef4983529c5b7a57f099e61362c59ba8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/sja1105/sja1105.h",
  "human_readable_source": " \n \n#ifndef _SJA1105_H\n#define _SJA1105_H\n\n#include <linux/ptp_clock_kernel.h>\n#include <linux/timecounter.h>\n#include <linux/dsa/sja1105.h>\n#include <linux/dsa/8021q.h>\n#include <net/dsa.h>\n#include <linux/mutex.h>\n#include \"sja1105_static_config.h\"\n\n#define SJA1105ET_FDB_BIN_SIZE\t\t4\n \n#define SJA1105_AGEING_TIME_MS(ms)\t((ms) / 10)\n#define SJA1105_NUM_L2_POLICERS\t\tSJA1110_MAX_L2_POLICING_COUNT\n\n \n#define SJA1105_RGMII_DELAY_PS_TO_PHASE(ps) \\\n\t(((ps) * 360) / 800)\n#define SJA1105_RGMII_DELAY_PHASE_TO_PS(phase) \\\n\t((800 * (phase)) / 360)\n#define SJA1105_RGMII_DELAY_PHASE_TO_HW(phase) \\\n\t(((phase) - 738) / 9)\n#define SJA1105_RGMII_DELAY_PS_TO_HW(ps) \\\n\tSJA1105_RGMII_DELAY_PHASE_TO_HW(SJA1105_RGMII_DELAY_PS_TO_PHASE(ps))\n\n \n#define SJA1105_RGMII_DELAY_MIN_PS \\\n\tSJA1105_RGMII_DELAY_PHASE_TO_PS(738)\n#define SJA1105_RGMII_DELAY_MAX_PS \\\n\tSJA1105_RGMII_DELAY_PHASE_TO_PS(1017)\n\ntypedef enum {\n\tSPI_READ = 0,\n\tSPI_WRITE = 1,\n} sja1105_spi_rw_mode_t;\n\n#include \"sja1105_tas.h\"\n#include \"sja1105_ptp.h\"\n\nenum sja1105_stats_area {\n\tMAC,\n\tHL1,\n\tHL2,\n\tETHER,\n\t__MAX_SJA1105_STATS_AREA,\n};\n\n \nstruct sja1105_regs {\n\tu64 device_id;\n\tu64 prod_id;\n\tu64 status;\n\tu64 port_control;\n\tu64 rgu;\n\tu64 vl_status;\n\tu64 config;\n\tu64 rmii_pll1;\n\tu64 ptppinst;\n\tu64 ptppindur;\n\tu64 ptp_control;\n\tu64 ptpclkval;\n\tu64 ptpclkrate;\n\tu64 ptpclkcorp;\n\tu64 ptpsyncts;\n\tu64 ptpschtm;\n\tu64 ptpegr_ts[SJA1105_MAX_NUM_PORTS];\n\tu64 pad_mii_tx[SJA1105_MAX_NUM_PORTS];\n\tu64 pad_mii_rx[SJA1105_MAX_NUM_PORTS];\n\tu64 pad_mii_id[SJA1105_MAX_NUM_PORTS];\n\tu64 cgu_idiv[SJA1105_MAX_NUM_PORTS];\n\tu64 mii_tx_clk[SJA1105_MAX_NUM_PORTS];\n\tu64 mii_rx_clk[SJA1105_MAX_NUM_PORTS];\n\tu64 mii_ext_tx_clk[SJA1105_MAX_NUM_PORTS];\n\tu64 mii_ext_rx_clk[SJA1105_MAX_NUM_PORTS];\n\tu64 rgmii_tx_clk[SJA1105_MAX_NUM_PORTS];\n\tu64 rmii_ref_clk[SJA1105_MAX_NUM_PORTS];\n\tu64 rmii_ext_tx_clk[SJA1105_MAX_NUM_PORTS];\n\tu64 stats[__MAX_SJA1105_STATS_AREA][SJA1105_MAX_NUM_PORTS];\n\tu64 mdio_100base_tx;\n\tu64 mdio_100base_t1;\n\tu64 pcs_base[SJA1105_MAX_NUM_PORTS];\n};\n\nstruct sja1105_mdio_private {\n\tstruct sja1105_private *priv;\n};\n\nenum {\n\tSJA1105_SPEED_AUTO,\n\tSJA1105_SPEED_10MBPS,\n\tSJA1105_SPEED_100MBPS,\n\tSJA1105_SPEED_1000MBPS,\n\tSJA1105_SPEED_2500MBPS,\n\tSJA1105_SPEED_MAX,\n};\n\nenum sja1105_internal_phy_t {\n\tSJA1105_NO_PHY\t\t= 0,\n\tSJA1105_PHY_BASE_TX,\n\tSJA1105_PHY_BASE_T1,\n};\n\nstruct sja1105_info {\n\tu64 device_id;\n\t \n\tu64 part_no;\n\t \n\tint ptp_ts_bits;\n\t \n\tint ptpegr_ts_bytes;\n\tint num_cbs_shapers;\n\tint max_frame_mem;\n\tint num_ports;\n\tbool multiple_cascade_ports;\n\t \n\tbool fixed_cbs_mapping;\n\tenum dsa_tag_protocol tag_proto;\n\tconst struct sja1105_dynamic_table_ops *dyn_ops;\n\tconst struct sja1105_table_ops *static_ops;\n\tconst struct sja1105_regs *regs;\n\tbool can_limit_mcast_flood;\n\tint (*reset_cmd)(struct dsa_switch *ds);\n\tint (*setup_rgmii_delay)(const void *ctx, int port);\n\t \n\tint (*fdb_add_cmd)(struct dsa_switch *ds, int port,\n\t\t\t   const unsigned char *addr, u16 vid);\n\tint (*fdb_del_cmd)(struct dsa_switch *ds, int port,\n\t\t\t   const unsigned char *addr, u16 vid);\n\tvoid (*ptp_cmd_packing)(u8 *buf, struct sja1105_ptp_cmd *cmd,\n\t\t\t\tenum packing_op op);\n\tbool (*rxtstamp)(struct dsa_switch *ds, int port, struct sk_buff *skb);\n\tvoid (*txtstamp)(struct dsa_switch *ds, int port, struct sk_buff *skb);\n\tint (*clocking_setup)(struct sja1105_private *priv);\n\tint (*pcs_mdio_read_c45)(struct mii_bus *bus, int phy, int mmd,\n\t\t\t\t int reg);\n\tint (*pcs_mdio_write_c45)(struct mii_bus *bus, int phy, int mmd,\n\t\t\t\t  int reg, u16 val);\n\tint (*disable_microcontroller)(struct sja1105_private *priv);\n\tconst char *name;\n\tbool supports_mii[SJA1105_MAX_NUM_PORTS];\n\tbool supports_rmii[SJA1105_MAX_NUM_PORTS];\n\tbool supports_rgmii[SJA1105_MAX_NUM_PORTS];\n\tbool supports_sgmii[SJA1105_MAX_NUM_PORTS];\n\tbool supports_2500basex[SJA1105_MAX_NUM_PORTS];\n\tenum sja1105_internal_phy_t internal_phy[SJA1105_MAX_NUM_PORTS];\n\tconst u64 port_speed[SJA1105_SPEED_MAX];\n};\n\nenum sja1105_key_type {\n\tSJA1105_KEY_BCAST,\n\tSJA1105_KEY_TC,\n\tSJA1105_KEY_VLAN_UNAWARE_VL,\n\tSJA1105_KEY_VLAN_AWARE_VL,\n};\n\nstruct sja1105_key {\n\tenum sja1105_key_type type;\n\n\tunion {\n\t\t \n\t\tstruct {\n\t\t\tint pcp;\n\t\t} tc;\n\n\t\t \n\t\t \n\t\tstruct {\n\t\t\tu64 dmac;\n\t\t\tu16 vid;\n\t\t\tu16 pcp;\n\t\t} vl;\n\t};\n};\n\nenum sja1105_rule_type {\n\tSJA1105_RULE_BCAST_POLICER,\n\tSJA1105_RULE_TC_POLICER,\n\tSJA1105_RULE_VL,\n};\n\nenum sja1105_vl_type {\n\tSJA1105_VL_NONCRITICAL,\n\tSJA1105_VL_RATE_CONSTRAINED,\n\tSJA1105_VL_TIME_TRIGGERED,\n};\n\nstruct sja1105_rule {\n\tstruct list_head list;\n\tunsigned long cookie;\n\tunsigned long port_mask;\n\tstruct sja1105_key key;\n\tenum sja1105_rule_type type;\n\n\t \n\tunion {\n\t\t \n\t\tstruct {\n\t\t\tint sharindx;\n\t\t} bcast_pol;\n\n\t\t \n\t\tstruct {\n\t\t\tint sharindx;\n\t\t} tc_pol;\n\n\t\t \n\t\tstruct {\n\t\t\tenum sja1105_vl_type type;\n\t\t\tunsigned long destports;\n\t\t\tint sharindx;\n\t\t\tint maxlen;\n\t\t\tint ipv;\n\t\t\tu64 base_time;\n\t\t\tu64 cycle_time;\n\t\t\tint num_entries;\n\t\t\tstruct action_gate_entry *entries;\n\t\t\tstruct flow_stats stats;\n\t\t} vl;\n\t};\n};\n\nstruct sja1105_flow_block {\n\tstruct list_head rules;\n\tbool l2_policer_used[SJA1105_NUM_L2_POLICERS];\n\tint num_virtual_links;\n};\n\nstruct sja1105_private {\n\tstruct sja1105_static_config static_config;\n\tint rgmii_rx_delay_ps[SJA1105_MAX_NUM_PORTS];\n\tint rgmii_tx_delay_ps[SJA1105_MAX_NUM_PORTS];\n\tphy_interface_t phy_mode[SJA1105_MAX_NUM_PORTS];\n\tbool fixed_link[SJA1105_MAX_NUM_PORTS];\n\tunsigned long ucast_egress_floods;\n\tunsigned long bcast_egress_floods;\n\tunsigned long hwts_tx_en;\n\tunsigned long hwts_rx_en;\n\tconst struct sja1105_info *info;\n\tsize_t max_xfer_len;\n\tstruct spi_device *spidev;\n\tstruct dsa_switch *ds;\n\tu16 bridge_pvid[SJA1105_MAX_NUM_PORTS];\n\tu16 tag_8021q_pvid[SJA1105_MAX_NUM_PORTS];\n\tstruct sja1105_flow_block flow_block;\n\t \n\tstruct mutex mgmt_lock;\n\t \n\tstruct mutex fdb_lock;\n\t \n\tspinlock_t ts_id_lock;\n\tu8 ts_id;\n\t \n\tstruct mutex dynamic_config_lock;\n\tstruct devlink_region **regions;\n\tstruct sja1105_cbs_entry *cbs;\n\tstruct mii_bus *mdio_base_t1;\n\tstruct mii_bus *mdio_base_tx;\n\tstruct mii_bus *mdio_pcs;\n\tstruct dw_xpcs *xpcs[SJA1105_MAX_NUM_PORTS];\n\tstruct sja1105_ptp_data ptp_data;\n\tstruct sja1105_tas_data tas_data;\n};\n\n#include \"sja1105_dynamic_config.h\"\n\nstruct sja1105_spi_message {\n\tu64 access;\n\tu64 read_count;\n\tu64 address;\n};\n\n \nenum sja1105_reset_reason {\n\tSJA1105_VLAN_FILTERING = 0,\n\tSJA1105_AGEING_TIME,\n\tSJA1105_SCHEDULING,\n\tSJA1105_BEST_EFFORT_POLICING,\n\tSJA1105_VIRTUAL_LINKS,\n};\n\nint sja1105_static_config_reload(struct sja1105_private *priv,\n\t\t\t\t enum sja1105_reset_reason reason);\nint sja1105_vlan_filtering(struct dsa_switch *ds, int port, bool enabled,\n\t\t\t   struct netlink_ext_ack *extack);\nvoid sja1105_frame_memory_partitioning(struct sja1105_private *priv);\n\n \nint sja1105_mdiobus_register(struct dsa_switch *ds);\nvoid sja1105_mdiobus_unregister(struct dsa_switch *ds);\nint sja1105_pcs_mdio_read_c45(struct mii_bus *bus, int phy, int mmd, int reg);\nint sja1105_pcs_mdio_write_c45(struct mii_bus *bus, int phy, int mmd, int reg,\n\t\t\t       u16 val);\nint sja1110_pcs_mdio_read_c45(struct mii_bus *bus, int phy, int mmd, int reg);\nint sja1110_pcs_mdio_write_c45(struct mii_bus *bus, int phy, int mmd, int reg,\n\t\t\t       u16 val);\n\n \nint sja1105_devlink_setup(struct dsa_switch *ds);\nvoid sja1105_devlink_teardown(struct dsa_switch *ds);\nint sja1105_devlink_info_get(struct dsa_switch *ds,\n\t\t\t     struct devlink_info_req *req,\n\t\t\t     struct netlink_ext_ack *extack);\n\n \nint sja1105_xfer_buf(const struct sja1105_private *priv,\n\t\t     sja1105_spi_rw_mode_t rw, u64 reg_addr,\n\t\t     u8 *buf, size_t len);\nint sja1105_xfer_u32(const struct sja1105_private *priv,\n\t\t     sja1105_spi_rw_mode_t rw, u64 reg_addr, u32 *value,\n\t\t     struct ptp_system_timestamp *ptp_sts);\nint sja1105_xfer_u64(const struct sja1105_private *priv,\n\t\t     sja1105_spi_rw_mode_t rw, u64 reg_addr, u64 *value,\n\t\t     struct ptp_system_timestamp *ptp_sts);\nint static_config_buf_prepare_for_upload(struct sja1105_private *priv,\n\t\t\t\t\t void *config_buf, int buf_len);\nint sja1105_static_config_upload(struct sja1105_private *priv);\nint sja1105_inhibit_tx(const struct sja1105_private *priv,\n\t\t       unsigned long port_bitmap, bool tx_inhibited);\n\nextern const struct sja1105_info sja1105e_info;\nextern const struct sja1105_info sja1105t_info;\nextern const struct sja1105_info sja1105p_info;\nextern const struct sja1105_info sja1105q_info;\nextern const struct sja1105_info sja1105r_info;\nextern const struct sja1105_info sja1105s_info;\nextern const struct sja1105_info sja1110a_info;\nextern const struct sja1105_info sja1110b_info;\nextern const struct sja1105_info sja1110c_info;\nextern const struct sja1105_info sja1110d_info;\n\n \n\ntypedef enum {\n\tXMII_MAC = 0,\n\tXMII_PHY = 1,\n} sja1105_mii_role_t;\n\ntypedef enum {\n\tXMII_MODE_MII\t\t= 0,\n\tXMII_MODE_RMII\t\t= 1,\n\tXMII_MODE_RGMII\t\t= 2,\n\tXMII_MODE_SGMII\t\t= 3,\n} sja1105_phy_interface_t;\n\nint sja1105pqrs_setup_rgmii_delay(const void *ctx, int port);\nint sja1110_setup_rgmii_delay(const void *ctx, int port);\nint sja1105_clocking_setup_port(struct sja1105_private *priv, int port);\nint sja1105_clocking_setup(struct sja1105_private *priv);\nint sja1110_disable_microcontroller(struct sja1105_private *priv);\n\n \nvoid sja1105_get_ethtool_stats(struct dsa_switch *ds, int port, u64 *data);\nvoid sja1105_get_strings(struct dsa_switch *ds, int port,\n\t\t\t u32 stringset, u8 *data);\nint sja1105_get_sset_count(struct dsa_switch *ds, int port, int sset);\n\n \nint sja1105_dynamic_config_read(struct sja1105_private *priv,\n\t\t\t\tenum sja1105_blk_idx blk_idx,\n\t\t\t\tint index, void *entry);\nint sja1105_dynamic_config_write(struct sja1105_private *priv,\n\t\t\t\t enum sja1105_blk_idx blk_idx,\n\t\t\t\t int index, void *entry, bool keep);\n\nenum sja1105_iotag {\n\tSJA1105_C_TAG = 0,  \n\tSJA1105_S_TAG = 1,  \n};\n\nenum sja1110_vlan_type {\n\tSJA1110_VLAN_INVALID = 0,\n\tSJA1110_VLAN_C_TAG = 1,  \n\tSJA1110_VLAN_S_TAG = 2,  \n\tSJA1110_VLAN_D_TAG = 3,  \n};\n\nenum sja1110_shaper_type {\n\tSJA1110_LEAKY_BUCKET_SHAPER = 0,\n\tSJA1110_CBS_SHAPER = 1,\n};\n\nu8 sja1105et_fdb_hash(struct sja1105_private *priv, const u8 *addr, u16 vid);\nint sja1105et_fdb_add(struct dsa_switch *ds, int port,\n\t\t      const unsigned char *addr, u16 vid);\nint sja1105et_fdb_del(struct dsa_switch *ds, int port,\n\t\t      const unsigned char *addr, u16 vid);\nint sja1105pqrs_fdb_add(struct dsa_switch *ds, int port,\n\t\t\tconst unsigned char *addr, u16 vid);\nint sja1105pqrs_fdb_del(struct dsa_switch *ds, int port,\n\t\t\tconst unsigned char *addr, u16 vid);\n\n \nint sja1105_cls_flower_del(struct dsa_switch *ds, int port,\n\t\t\t   struct flow_cls_offload *cls, bool ingress);\nint sja1105_cls_flower_add(struct dsa_switch *ds, int port,\n\t\t\t   struct flow_cls_offload *cls, bool ingress);\nint sja1105_cls_flower_stats(struct dsa_switch *ds, int port,\n\t\t\t     struct flow_cls_offload *cls, bool ingress);\nvoid sja1105_flower_setup(struct dsa_switch *ds);\nvoid sja1105_flower_teardown(struct dsa_switch *ds);\nstruct sja1105_rule *sja1105_rule_find(struct sja1105_private *priv,\n\t\t\t\t       unsigned long cookie);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}