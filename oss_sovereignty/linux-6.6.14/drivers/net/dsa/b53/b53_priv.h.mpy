{
  "module_name": "b53_priv.h",
  "hash_id": "0aecfc83d8cedddd1bf70ef2e7f69c65be570ac08c3f5775d40618fe2b94c07e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/b53/b53_priv.h",
  "human_readable_source": " \n\n#ifndef __B53_PRIV_H\n#define __B53_PRIV_H\n\n#include <linux/kernel.h>\n#include <linux/mutex.h>\n#include <linux/phylink.h>\n#include <linux/etherdevice.h>\n#include <net/dsa.h>\n\n#include \"b53_regs.h\"\n\nstruct b53_device;\nstruct net_device;\n\nstruct b53_io_ops {\n\tint (*read8)(struct b53_device *dev, u8 page, u8 reg, u8 *value);\n\tint (*read16)(struct b53_device *dev, u8 page, u8 reg, u16 *value);\n\tint (*read32)(struct b53_device *dev, u8 page, u8 reg, u32 *value);\n\tint (*read48)(struct b53_device *dev, u8 page, u8 reg, u64 *value);\n\tint (*read64)(struct b53_device *dev, u8 page, u8 reg, u64 *value);\n\tint (*write8)(struct b53_device *dev, u8 page, u8 reg, u8 value);\n\tint (*write16)(struct b53_device *dev, u8 page, u8 reg, u16 value);\n\tint (*write32)(struct b53_device *dev, u8 page, u8 reg, u32 value);\n\tint (*write48)(struct b53_device *dev, u8 page, u8 reg, u64 value);\n\tint (*write64)(struct b53_device *dev, u8 page, u8 reg, u64 value);\n\tint (*phy_read16)(struct b53_device *dev, int addr, int reg, u16 *value);\n\tint (*phy_write16)(struct b53_device *dev, int addr, int reg, u16 value);\n\tint (*irq_enable)(struct b53_device *dev, int port);\n\tvoid (*irq_disable)(struct b53_device *dev, int port);\n\tvoid (*phylink_get_caps)(struct b53_device *dev, int port,\n\t\t\t\t struct phylink_config *config);\n\tstruct phylink_pcs *(*phylink_mac_select_pcs)(struct b53_device *dev,\n\t\t\t\t\t\t      int port,\n\t\t\t\t\t\t      phy_interface_t interface);\n\tu8 (*serdes_map_lane)(struct b53_device *dev, int port);\n\tvoid (*serdes_link_set)(struct b53_device *dev, int port,\n\t\t\t\tunsigned int mode, phy_interface_t interface,\n\t\t\t\tbool link_up);\n};\n\n#define B53_INVALID_LANE\t0xff\n\nenum {\n\tBCM4908_DEVICE_ID = 0x4908,\n\tBCM5325_DEVICE_ID = 0x25,\n\tBCM5365_DEVICE_ID = 0x65,\n\tBCM5389_DEVICE_ID = 0x89,\n\tBCM5395_DEVICE_ID = 0x95,\n\tBCM5397_DEVICE_ID = 0x97,\n\tBCM5398_DEVICE_ID = 0x98,\n\tBCM53115_DEVICE_ID = 0x53115,\n\tBCM53125_DEVICE_ID = 0x53125,\n\tBCM53128_DEVICE_ID = 0x53128,\n\tBCM63XX_DEVICE_ID = 0x6300,\n\tBCM63268_DEVICE_ID = 0x63268,\n\tBCM53010_DEVICE_ID = 0x53010,\n\tBCM53011_DEVICE_ID = 0x53011,\n\tBCM53012_DEVICE_ID = 0x53012,\n\tBCM53018_DEVICE_ID = 0x53018,\n\tBCM53019_DEVICE_ID = 0x53019,\n\tBCM58XX_DEVICE_ID = 0x5800,\n\tBCM583XX_DEVICE_ID = 0x58300,\n\tBCM7445_DEVICE_ID = 0x7445,\n\tBCM7278_DEVICE_ID = 0x7278,\n\tBCM53134_DEVICE_ID = 0x5075,\n};\n\nstruct b53_pcs {\n\tstruct phylink_pcs pcs;\n\tstruct b53_device *dev;\n\tu8 lane;\n};\n\n#define B53_N_PORTS\t9\n#define B53_N_PORTS_25\t6\n#define B53_N_PCS\t2\n\nstruct b53_port {\n\tu16\t\tvlan_ctl_mask;\n\tstruct ethtool_eee eee;\n};\n\nstruct b53_vlan {\n\tu16 members;\n\tu16 untag;\n\tbool valid;\n};\n\nstruct b53_device {\n\tstruct dsa_switch *ds;\n\tstruct b53_platform_data *pdata;\n\tconst char *name;\n\n\tstruct mutex reg_mutex;\n\tstruct mutex stats_mutex;\n\tstruct mutex arl_mutex;\n\tconst struct b53_io_ops *ops;\n\n\t \n\tu32 chip_id;\n\tu8 core_rev;\n\tu8 vta_regs[3];\n\tu8 duplex_reg;\n\tu8 jumbo_pm_reg;\n\tu8 jumbo_size_reg;\n\tint reset_gpio;\n\tu8 num_arl_bins;\n\tu16 num_arl_buckets;\n\tenum dsa_tag_protocol tag_protocol;\n\n\t \n\tu16 enabled_ports;\n\tunsigned int imp_port;\n\n\t \n\tu8 current_page;\n\tstruct device *dev;\n\tu8 serdes_lane;\n\n\t \n\tstruct mii_bus *bus;\n\n\tvoid *priv;\n\n\t \n\tbool enable_jumbo;\n\n\tunsigned int num_vlans;\n\tstruct b53_vlan *vlans;\n\tbool vlan_enabled;\n\tunsigned int num_ports;\n\tstruct b53_port *ports;\n\n\tstruct b53_pcs pcs[B53_N_PCS];\n};\n\n#define b53_for_each_port(dev, i) \\\n\tfor (i = 0; i < B53_N_PORTS; i++) \\\n\t\tif (dev->enabled_ports & BIT(i))\n\n\nstatic inline int is5325(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM5325_DEVICE_ID;\n}\n\nstatic inline int is5365(struct b53_device *dev)\n{\n#ifdef CONFIG_BCM47XX\n\treturn dev->chip_id == BCM5365_DEVICE_ID;\n#else\n\treturn 0;\n#endif\n}\n\nstatic inline int is5397_98(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM5397_DEVICE_ID ||\n\t\tdev->chip_id == BCM5398_DEVICE_ID;\n}\n\nstatic inline int is539x(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM5395_DEVICE_ID ||\n\t\tdev->chip_id == BCM5397_DEVICE_ID ||\n\t\tdev->chip_id == BCM5398_DEVICE_ID;\n}\n\nstatic inline int is531x5(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM53115_DEVICE_ID ||\n\t\tdev->chip_id == BCM53125_DEVICE_ID ||\n\t\tdev->chip_id == BCM53128_DEVICE_ID ||\n\t\tdev->chip_id == BCM53134_DEVICE_ID;\n}\n\nstatic inline int is63xx(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM63XX_DEVICE_ID ||\n\t\tdev->chip_id == BCM63268_DEVICE_ID;\n}\n\nstatic inline int is63268(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM63268_DEVICE_ID;\n}\n\nstatic inline int is5301x(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM53010_DEVICE_ID ||\n\t\tdev->chip_id == BCM53011_DEVICE_ID ||\n\t\tdev->chip_id == BCM53012_DEVICE_ID ||\n\t\tdev->chip_id == BCM53018_DEVICE_ID ||\n\t\tdev->chip_id == BCM53019_DEVICE_ID;\n}\n\nstatic inline int is58xx(struct b53_device *dev)\n{\n\treturn dev->chip_id == BCM58XX_DEVICE_ID ||\n\t\tdev->chip_id == BCM583XX_DEVICE_ID ||\n\t\tdev->chip_id == BCM7445_DEVICE_ID ||\n\t\tdev->chip_id == BCM7278_DEVICE_ID ||\n\t\tdev->chip_id == BCM53134_DEVICE_ID;\n}\n\n#define B53_63XX_RGMII0\t4\n#define B53_CPU_PORT_25\t5\n#define B53_CPU_PORT\t8\n\nstatic inline unsigned int b53_max_arl_entries(struct b53_device *dev)\n{\n\treturn dev->num_arl_buckets * dev->num_arl_bins;\n}\n\nstruct b53_device *b53_switch_alloc(struct device *base,\n\t\t\t\t    const struct b53_io_ops *ops,\n\t\t\t\t    void *priv);\n\nint b53_switch_detect(struct b53_device *dev);\n\nint b53_switch_register(struct b53_device *dev);\n\nstatic inline void b53_switch_remove(struct b53_device *dev)\n{\n\tdsa_unregister_switch(dev->ds);\n}\n\nstatic inline void b53_switch_shutdown(struct b53_device *dev)\n{\n\tdsa_switch_shutdown(dev->ds);\n}\n\n#define b53_build_op(type_op_size, val_type)\t\t\t\t\\\nstatic inline int b53_##type_op_size(struct b53_device *dev, u8 page,\t\\\n\t\t\t\t     u8 reg, val_type val)\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tint ret;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tmutex_lock(&dev->reg_mutex);\t\t\t\t\t\\\n\tret = dev->ops->type_op_size(dev, page, reg, val);\t\t\\\n\tmutex_unlock(&dev->reg_mutex);\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\treturn ret;\t\t\t\t\t\t\t\\\n}\n\nb53_build_op(read8, u8 *);\nb53_build_op(read16, u16 *);\nb53_build_op(read32, u32 *);\nb53_build_op(read48, u64 *);\nb53_build_op(read64, u64 *);\n\nb53_build_op(write8, u8);\nb53_build_op(write16, u16);\nb53_build_op(write32, u32);\nb53_build_op(write48, u64);\nb53_build_op(write64, u64);\n\nstruct b53_arl_entry {\n\tu16 port;\n\tu8 mac[ETH_ALEN];\n\tu16 vid;\n\tu8 is_valid:1;\n\tu8 is_age:1;\n\tu8 is_static:1;\n};\n\nstatic inline void b53_arl_to_entry(struct b53_arl_entry *ent,\n\t\t\t\t    u64 mac_vid, u32 fwd_entry)\n{\n\tmemset(ent, 0, sizeof(*ent));\n\tent->port = fwd_entry & ARLTBL_DATA_PORT_ID_MASK;\n\tent->is_valid = !!(fwd_entry & ARLTBL_VALID);\n\tent->is_age = !!(fwd_entry & ARLTBL_AGE);\n\tent->is_static = !!(fwd_entry & ARLTBL_STATIC);\n\tu64_to_ether_addr(mac_vid, ent->mac);\n\tent->vid = mac_vid >> ARLTBL_VID_S;\n}\n\nstatic inline void b53_arl_from_entry(u64 *mac_vid, u32 *fwd_entry,\n\t\t\t\t      const struct b53_arl_entry *ent)\n{\n\t*mac_vid = ether_addr_to_u64(ent->mac);\n\t*mac_vid |= (u64)(ent->vid & ARLTBL_VID_MASK) << ARLTBL_VID_S;\n\t*fwd_entry = ent->port & ARLTBL_DATA_PORT_ID_MASK;\n\tif (ent->is_valid)\n\t\t*fwd_entry |= ARLTBL_VALID;\n\tif (ent->is_static)\n\t\t*fwd_entry |= ARLTBL_STATIC;\n\tif (ent->is_age)\n\t\t*fwd_entry |= ARLTBL_AGE;\n}\n\n#ifdef CONFIG_BCM47XX\n\n#include <linux/bcm47xx_nvram.h>\n#include <bcm47xx_board.h>\nstatic inline int b53_switch_get_reset_gpio(struct b53_device *dev)\n{\n\tenum bcm47xx_board board = bcm47xx_board_get();\n\n\tswitch (board) {\n\tcase BCM47XX_BOARD_LINKSYS_WRT300NV11:\n\tcase BCM47XX_BOARD_LINKSYS_WRT310NV1:\n\t\treturn 8;\n\tdefault:\n\t\treturn bcm47xx_nvram_gpio_pin(\"robo_reset\");\n\t}\n}\n#else\nstatic inline int b53_switch_get_reset_gpio(struct b53_device *dev)\n{\n\treturn -ENOENT;\n}\n#endif\n\n \nvoid b53_imp_vlan_setup(struct dsa_switch *ds, int cpu_port);\nint b53_configure_vlan(struct dsa_switch *ds);\nvoid b53_get_strings(struct dsa_switch *ds, int port, u32 stringset,\n\t\t     uint8_t *data);\nvoid b53_get_ethtool_stats(struct dsa_switch *ds, int port, uint64_t *data);\nint b53_get_sset_count(struct dsa_switch *ds, int port, int sset);\nvoid b53_get_ethtool_phy_stats(struct dsa_switch *ds, int port, uint64_t *data);\nint b53_br_join(struct dsa_switch *ds, int port, struct dsa_bridge bridge,\n\t\tbool *tx_fwd_offload, struct netlink_ext_ack *extack);\nvoid b53_br_leave(struct dsa_switch *ds, int port, struct dsa_bridge bridge);\nvoid b53_br_set_stp_state(struct dsa_switch *ds, int port, u8 state);\nvoid b53_br_fast_age(struct dsa_switch *ds, int port);\nint b53_br_flags_pre(struct dsa_switch *ds, int port,\n\t\t     struct switchdev_brport_flags flags,\n\t\t     struct netlink_ext_ack *extack);\nint b53_br_flags(struct dsa_switch *ds, int port,\n\t\t struct switchdev_brport_flags flags,\n\t\t struct netlink_ext_ack *extack);\nint b53_setup_devlink_resources(struct dsa_switch *ds);\nvoid b53_port_event(struct dsa_switch *ds, int port);\nvoid b53_phylink_mac_config(struct dsa_switch *ds, int port,\n\t\t\t    unsigned int mode,\n\t\t\t    const struct phylink_link_state *state);\nvoid b53_phylink_mac_link_down(struct dsa_switch *ds, int port,\n\t\t\t       unsigned int mode,\n\t\t\t       phy_interface_t interface);\nvoid b53_phylink_mac_link_up(struct dsa_switch *ds, int port,\n\t\t\t     unsigned int mode,\n\t\t\t     phy_interface_t interface,\n\t\t\t     struct phy_device *phydev,\n\t\t\t     int speed, int duplex,\n\t\t\t     bool tx_pause, bool rx_pause);\nint b53_vlan_filtering(struct dsa_switch *ds, int port, bool vlan_filtering,\n\t\t       struct netlink_ext_ack *extack);\nint b53_vlan_add(struct dsa_switch *ds, int port,\n\t\t const struct switchdev_obj_port_vlan *vlan,\n\t\t struct netlink_ext_ack *extack);\nint b53_vlan_del(struct dsa_switch *ds, int port,\n\t\t const struct switchdev_obj_port_vlan *vlan);\nint b53_fdb_add(struct dsa_switch *ds, int port,\n\t\tconst unsigned char *addr, u16 vid,\n\t\tstruct dsa_db db);\nint b53_fdb_del(struct dsa_switch *ds, int port,\n\t\tconst unsigned char *addr, u16 vid,\n\t\tstruct dsa_db db);\nint b53_fdb_dump(struct dsa_switch *ds, int port,\n\t\t dsa_fdb_dump_cb_t *cb, void *data);\nint b53_mdb_add(struct dsa_switch *ds, int port,\n\t\tconst struct switchdev_obj_port_mdb *mdb,\n\t\tstruct dsa_db db);\nint b53_mdb_del(struct dsa_switch *ds, int port,\n\t\tconst struct switchdev_obj_port_mdb *mdb,\n\t\tstruct dsa_db db);\nint b53_mirror_add(struct dsa_switch *ds, int port,\n\t\t   struct dsa_mall_mirror_tc_entry *mirror, bool ingress,\n\t\t   struct netlink_ext_ack *extack);\nenum dsa_tag_protocol b53_get_tag_protocol(struct dsa_switch *ds, int port,\n\t\t\t\t\t   enum dsa_tag_protocol mprot);\nvoid b53_mirror_del(struct dsa_switch *ds, int port,\n\t\t    struct dsa_mall_mirror_tc_entry *mirror);\nint b53_enable_port(struct dsa_switch *ds, int port, struct phy_device *phy);\nvoid b53_disable_port(struct dsa_switch *ds, int port);\nvoid b53_brcm_hdr_setup(struct dsa_switch *ds, int port);\nvoid b53_eee_enable_set(struct dsa_switch *ds, int port, bool enable);\nint b53_eee_init(struct dsa_switch *ds, int port, struct phy_device *phy);\nint b53_get_mac_eee(struct dsa_switch *ds, int port, struct ethtool_eee *e);\nint b53_set_mac_eee(struct dsa_switch *ds, int port, struct ethtool_eee *e);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}