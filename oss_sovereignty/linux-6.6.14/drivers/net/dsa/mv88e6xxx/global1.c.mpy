{
  "module_name": "global1.c",
  "hash_id": "d73d1c0dfb2b0cb42fb17fd8465b1b47bf7d51cba7179581e9724b7c017ae117",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/mv88e6xxx/global1.c",
  "human_readable_source": "\n \n\n#include <linux/bitfield.h>\n\n#include \"chip.h\"\n#include \"global1.h\"\n\nint mv88e6xxx_g1_read(struct mv88e6xxx_chip *chip, int reg, u16 *val)\n{\n\tint addr = chip->info->global1_addr;\n\n\treturn mv88e6xxx_read(chip, addr, reg, val);\n}\n\nint mv88e6xxx_g1_write(struct mv88e6xxx_chip *chip, int reg, u16 val)\n{\n\tint addr = chip->info->global1_addr;\n\n\treturn mv88e6xxx_write(chip, addr, reg, val);\n}\n\nint mv88e6xxx_g1_wait_bit(struct mv88e6xxx_chip *chip, int reg, int\n\t\t\t  bit, int val)\n{\n\treturn mv88e6xxx_wait_bit(chip, chip->info->global1_addr, reg,\n\t\t\t\t  bit, val);\n}\n\nint mv88e6xxx_g1_wait_mask(struct mv88e6xxx_chip *chip, int reg,\n\t\t\t   u16 mask, u16 val)\n{\n\treturn mv88e6xxx_wait_mask(chip, chip->info->global1_addr, reg,\n\t\t\t\t   mask, val);\n}\n\n \n\nstatic int mv88e6185_g1_wait_ppu_disabled(struct mv88e6xxx_chip *chip)\n{\n\treturn mv88e6xxx_g1_wait_mask(chip, MV88E6XXX_G1_STS,\n\t\t\t\t      MV88E6185_G1_STS_PPU_STATE_MASK,\n\t\t\t\t      MV88E6185_G1_STS_PPU_STATE_DISABLED);\n}\n\nstatic int mv88e6185_g1_wait_ppu_polling(struct mv88e6xxx_chip *chip)\n{\n\treturn mv88e6xxx_g1_wait_mask(chip, MV88E6XXX_G1_STS,\n\t\t\t\t      MV88E6185_G1_STS_PPU_STATE_MASK,\n\t\t\t\t      MV88E6185_G1_STS_PPU_STATE_POLLING);\n}\n\nstatic int mv88e6352_g1_wait_ppu_polling(struct mv88e6xxx_chip *chip)\n{\n\tint bit = __bf_shf(MV88E6352_G1_STS_PPU_STATE);\n\n\treturn mv88e6xxx_g1_wait_bit(chip, MV88E6XXX_G1_STS, bit, 1);\n}\n\nstatic int mv88e6xxx_g1_wait_init_ready(struct mv88e6xxx_chip *chip)\n{\n\tint bit = __bf_shf(MV88E6XXX_G1_STS_INIT_READY);\n\n\t \n\treturn mv88e6xxx_g1_wait_bit(chip, MV88E6XXX_G1_STS, bit, 1);\n}\n\n \nint mv88e6xxx_g1_set_switch_mac(struct mv88e6xxx_chip *chip, u8 *addr)\n{\n\tu16 reg;\n\tint err;\n\n\treg = (addr[0] << 8) | addr[1];\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_MAC_01, reg);\n\tif (err)\n\t\treturn err;\n\n\treg = (addr[2] << 8) | addr[3];\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_MAC_23, reg);\n\tif (err)\n\t\treturn err;\n\n\treg = (addr[4] << 8) | addr[5];\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_MAC_45, reg);\n\tif (err)\n\t\treturn err;\n\n\treturn 0;\n}\n\n \n\nint mv88e6185_g1_reset(struct mv88e6xxx_chip *chip)\n{\n\tu16 val;\n\tint err;\n\n\t \n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_CTL1, &val);\n\tif (err)\n\t\treturn err;\n\n\tval |= MV88E6XXX_G1_CTL1_SW_RESET;\n\tval |= MV88E6XXX_G1_CTL1_PPU_ENABLE;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_CTL1, val);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_wait_init_ready(chip);\n\tif (err)\n\t\treturn err;\n\n\treturn mv88e6185_g1_wait_ppu_polling(chip);\n}\n\nint mv88e6250_g1_reset(struct mv88e6xxx_chip *chip)\n{\n\tu16 val;\n\tint err;\n\n\t \n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_CTL1, &val);\n\tif (err)\n\t\treturn err;\n\n\tval |= MV88E6XXX_G1_CTL1_SW_RESET;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_CTL1, val);\n\tif (err)\n\t\treturn err;\n\n\treturn mv88e6xxx_g1_wait_init_ready(chip);\n}\n\nint mv88e6352_g1_reset(struct mv88e6xxx_chip *chip)\n{\n\tint err;\n\n\terr = mv88e6250_g1_reset(chip);\n\tif (err)\n\t\treturn err;\n\n\treturn mv88e6352_g1_wait_ppu_polling(chip);\n}\n\nint mv88e6185_g1_ppu_enable(struct mv88e6xxx_chip *chip)\n{\n\tu16 val;\n\tint err;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_CTL1, &val);\n\tif (err)\n\t\treturn err;\n\n\tval |= MV88E6XXX_G1_CTL1_PPU_ENABLE;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_CTL1, val);\n\tif (err)\n\t\treturn err;\n\n\treturn mv88e6185_g1_wait_ppu_polling(chip);\n}\n\nint mv88e6185_g1_ppu_disable(struct mv88e6xxx_chip *chip)\n{\n\tu16 val;\n\tint err;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_CTL1, &val);\n\tif (err)\n\t\treturn err;\n\n\tval &= ~MV88E6XXX_G1_CTL1_PPU_ENABLE;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_CTL1, val);\n\tif (err)\n\t\treturn err;\n\n\treturn mv88e6185_g1_wait_ppu_disabled(chip);\n}\n\nint mv88e6185_g1_set_max_frame_size(struct mv88e6xxx_chip *chip, int mtu)\n{\n\tu16 val;\n\tint err;\n\n\tmtu += ETH_HLEN + ETH_FCS_LEN;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_CTL1, &val);\n\tif (err)\n\t\treturn err;\n\n\tval &= ~MV88E6185_G1_CTL1_MAX_FRAME_1632;\n\n\tif (mtu > 1518)\n\t\tval |= MV88E6185_G1_CTL1_MAX_FRAME_1632;\n\n\treturn mv88e6xxx_g1_write(chip, MV88E6XXX_G1_CTL1, val);\n}\n\n \n\nint mv88e6085_g1_ip_pri_map(struct mv88e6xxx_chip *chip)\n{\n\tint err;\n\n\t \n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_0, 0x0000);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_1, 0x0000);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_2, 0x5555);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_3, 0x5555);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_4, 0xaaaa);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_5, 0xaaaa);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_6, 0xffff);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IP_PRI_7, 0xffff);\n\tif (err)\n\t\treturn err;\n\n\treturn 0;\n}\n\n \n\nint mv88e6085_g1_ieee_pri_map(struct mv88e6xxx_chip *chip)\n{\n\t \n\treturn mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IEEE_PRI, 0xfa41);\n}\n\nint mv88e6250_g1_ieee_pri_map(struct mv88e6xxx_chip *chip)\n{\n\t \n\treturn mv88e6xxx_g1_write(chip, MV88E6XXX_G1_IEEE_PRI, 0xfa50);\n}\n\n \n \n\nint mv88e6095_g1_set_egress_port(struct mv88e6xxx_chip *chip,\n\t\t\t\t enum mv88e6xxx_egress_direction direction,\n\t\t\t\t int port)\n{\n\tu16 reg;\n\tint err;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6185_G1_MONITOR_CTL, &reg);\n\tif (err)\n\t\treturn err;\n\n\tswitch (direction) {\n\tcase MV88E6XXX_EGRESS_DIR_INGRESS:\n\t\treg &= ~MV88E6185_G1_MONITOR_CTL_INGRESS_DEST_MASK;\n\t\treg |= port <<\n\t\t       __bf_shf(MV88E6185_G1_MONITOR_CTL_INGRESS_DEST_MASK);\n\t\tbreak;\n\tcase MV88E6XXX_EGRESS_DIR_EGRESS:\n\t\treg &= ~MV88E6185_G1_MONITOR_CTL_EGRESS_DEST_MASK;\n\t\treg |= port <<\n\t\t       __bf_shf(MV88E6185_G1_MONITOR_CTL_EGRESS_DEST_MASK);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn mv88e6xxx_g1_write(chip, MV88E6185_G1_MONITOR_CTL, reg);\n}\n\n \nint mv88e6095_g1_set_cpu_port(struct mv88e6xxx_chip *chip, int port)\n{\n\tu16 reg;\n\tint err;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6185_G1_MONITOR_CTL, &reg);\n\tif (err)\n\t\treturn err;\n\n\treg &= ~MV88E6185_G1_MONITOR_CTL_ARP_DEST_MASK;\n\treg |= port << __bf_shf(MV88E6185_G1_MONITOR_CTL_ARP_DEST_MASK);\n\n\treturn mv88e6xxx_g1_write(chip, MV88E6185_G1_MONITOR_CTL, reg);\n}\n\nstatic int mv88e6390_g1_monitor_write(struct mv88e6xxx_chip *chip,\n\t\t\t\t      u16 pointer, u8 data)\n{\n\tu16 reg;\n\n\treg = MV88E6390_G1_MONITOR_MGMT_CTL_UPDATE | pointer | data;\n\n\treturn mv88e6xxx_g1_write(chip, MV88E6390_G1_MONITOR_MGMT_CTL, reg);\n}\n\nint mv88e6390_g1_set_egress_port(struct mv88e6xxx_chip *chip,\n\t\t\t\t enum mv88e6xxx_egress_direction direction,\n\t\t\t\t int port)\n{\n\tu16 ptr;\n\n\tswitch (direction) {\n\tcase MV88E6XXX_EGRESS_DIR_INGRESS:\n\t\tptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_INGRESS_DEST;\n\t\tbreak;\n\tcase MV88E6XXX_EGRESS_DIR_EGRESS:\n\t\tptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_EGRESS_DEST;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn mv88e6390_g1_monitor_write(chip, ptr, port);\n}\n\nint mv88e6390_g1_set_cpu_port(struct mv88e6xxx_chip *chip, int port)\n{\n\tu16 ptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_CPU_DEST;\n\n\t \n\tport |= MV88E6390_G1_MONITOR_MGMT_CTL_PTR_CPU_DEST_MGMTPRI;\n\n\treturn mv88e6390_g1_monitor_write(chip, ptr, port);\n}\n\nint mv88e6390_g1_set_ptp_cpu_port(struct mv88e6xxx_chip *chip, int port)\n{\n\tu16 ptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_PTP_CPU_DEST;\n\n\t \n\tport |= MV88E6390_G1_MONITOR_MGMT_CTL_PTR_CPU_DEST_MGMTPRI;\n\n\treturn mv88e6390_g1_monitor_write(chip, ptr, port);\n}\n\nint mv88e6390_g1_mgmt_rsvd2cpu(struct mv88e6xxx_chip *chip)\n{\n\tu16 ptr;\n\tint err;\n\n\t \n\tptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_0180C200000XLO;\n\terr = mv88e6390_g1_monitor_write(chip, ptr, 0xff);\n\tif (err)\n\t\treturn err;\n\n\t \n\tptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_0180C200000XHI;\n\terr = mv88e6390_g1_monitor_write(chip, ptr, 0xff);\n\tif (err)\n\t\treturn err;\n\n\t \n\tptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_0180C200002XLO;\n\terr = mv88e6390_g1_monitor_write(chip, ptr, 0xff);\n\tif (err)\n\t\treturn err;\n\n\t \n\tptr = MV88E6390_G1_MONITOR_MGMT_CTL_PTR_0180C200002XHI;\n\terr = mv88e6390_g1_monitor_write(chip, ptr, 0xff);\n\tif (err)\n\t\treturn err;\n\n\treturn 0;\n}\n\n \n\nstatic int mv88e6xxx_g1_ctl2_mask(struct mv88e6xxx_chip *chip, u16 mask,\n\t\t\t\t  u16 val)\n{\n\tu16 reg;\n\tint err;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_CTL2, &reg);\n\tif (err)\n\t\treturn err;\n\n\treg &= ~mask;\n\treg |= val & mask;\n\n\treturn mv88e6xxx_g1_write(chip, MV88E6XXX_G1_CTL2, reg);\n}\n\nint mv88e6185_g1_set_cascade_port(struct mv88e6xxx_chip *chip, int port)\n{\n\tconst u16 mask = MV88E6185_G1_CTL2_CASCADE_PORT_MASK;\n\n\treturn mv88e6xxx_g1_ctl2_mask(chip, mask, port << __bf_shf(mask));\n}\n\nint mv88e6085_g1_rmu_disable(struct mv88e6xxx_chip *chip)\n{\n\treturn mv88e6xxx_g1_ctl2_mask(chip, MV88E6085_G1_CTL2_P10RM |\n\t\t\t\t      MV88E6085_G1_CTL2_RM_ENABLE, 0);\n}\n\nint mv88e6352_g1_rmu_disable(struct mv88e6xxx_chip *chip)\n{\n\treturn mv88e6xxx_g1_ctl2_mask(chip, MV88E6352_G1_CTL2_RMU_MODE_MASK,\n\t\t\t\t      MV88E6352_G1_CTL2_RMU_MODE_DISABLED);\n}\n\nint mv88e6390_g1_rmu_disable(struct mv88e6xxx_chip *chip)\n{\n\treturn mv88e6xxx_g1_ctl2_mask(chip, MV88E6390_G1_CTL2_RMU_MODE_MASK,\n\t\t\t\t      MV88E6390_G1_CTL2_RMU_MODE_DISABLED);\n}\n\nint mv88e6390_g1_stats_set_histogram(struct mv88e6xxx_chip *chip)\n{\n\treturn mv88e6xxx_g1_ctl2_mask(chip, MV88E6390_G1_CTL2_HIST_MODE_MASK,\n\t\t\t\t      MV88E6390_G1_CTL2_HIST_MODE_RX |\n\t\t\t\t      MV88E6390_G1_CTL2_HIST_MODE_TX);\n}\n\nint mv88e6xxx_g1_set_device_number(struct mv88e6xxx_chip *chip, int index)\n{\n\treturn mv88e6xxx_g1_ctl2_mask(chip,\n\t\t\t\t      MV88E6XXX_G1_CTL2_DEVICE_NUMBER_MASK,\n\t\t\t\t      index);\n}\n\n \n\nstatic int mv88e6xxx_g1_stats_wait(struct mv88e6xxx_chip *chip)\n{\n\tint bit = __bf_shf(MV88E6XXX_G1_STATS_OP_BUSY);\n\n\treturn mv88e6xxx_g1_wait_bit(chip, MV88E6XXX_G1_STATS_OP, bit, 0);\n}\n\nint mv88e6095_g1_stats_set_histogram(struct mv88e6xxx_chip *chip)\n{\n\tu16 val;\n\tint err;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_STATS_OP, &val);\n\tif (err)\n\t\treturn err;\n\n\tval |= MV88E6XXX_G1_STATS_OP_HIST_RX_TX;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_STATS_OP, val);\n\n\treturn err;\n}\n\nint mv88e6xxx_g1_stats_snapshot(struct mv88e6xxx_chip *chip, int port)\n{\n\tint err;\n\n\t \n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_STATS_OP,\n\t\t\t\t MV88E6XXX_G1_STATS_OP_BUSY |\n\t\t\t\t MV88E6XXX_G1_STATS_OP_CAPTURE_PORT |\n\t\t\t\t MV88E6XXX_G1_STATS_OP_HIST_RX_TX | port);\n\tif (err)\n\t\treturn err;\n\n\t \n\treturn mv88e6xxx_g1_stats_wait(chip);\n}\n\nint mv88e6320_g1_stats_snapshot(struct mv88e6xxx_chip *chip, int port)\n{\n\tport = (port + 1) << 5;\n\n\treturn mv88e6xxx_g1_stats_snapshot(chip, port);\n}\n\nint mv88e6390_g1_stats_snapshot(struct mv88e6xxx_chip *chip, int port)\n{\n\tint err;\n\n\tport = (port + 1) << 5;\n\n\t \n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_STATS_OP,\n\t\t\t\t MV88E6XXX_G1_STATS_OP_BUSY |\n\t\t\t\t MV88E6XXX_G1_STATS_OP_CAPTURE_PORT | port);\n\tif (err)\n\t\treturn err;\n\n\t \n\treturn mv88e6xxx_g1_stats_wait(chip);\n}\n\nvoid mv88e6xxx_g1_stats_read(struct mv88e6xxx_chip *chip, int stat, u32 *val)\n{\n\tu32 value;\n\tu16 reg;\n\tint err;\n\n\t*val = 0;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_STATS_OP,\n\t\t\t\t MV88E6XXX_G1_STATS_OP_BUSY |\n\t\t\t\t MV88E6XXX_G1_STATS_OP_READ_CAPTURED | stat);\n\tif (err)\n\t\treturn;\n\n\terr = mv88e6xxx_g1_stats_wait(chip);\n\tif (err)\n\t\treturn;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_STATS_COUNTER_32, &reg);\n\tif (err)\n\t\treturn;\n\n\tvalue = reg << 16;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_STATS_COUNTER_01, &reg);\n\tif (err)\n\t\treturn;\n\n\t*val = value | reg;\n}\n\nint mv88e6xxx_g1_stats_clear(struct mv88e6xxx_chip *chip)\n{\n\tint err;\n\tu16 val;\n\n\terr = mv88e6xxx_g1_read(chip, MV88E6XXX_G1_STATS_OP, &val);\n\tif (err)\n\t\treturn err;\n\n\t \n\tval &= MV88E6XXX_G1_STATS_OP_HIST_RX_TX;\n\tval |= MV88E6XXX_G1_STATS_OP_BUSY | MV88E6XXX_G1_STATS_OP_FLUSH_ALL;\n\n\terr = mv88e6xxx_g1_write(chip, MV88E6XXX_G1_STATS_OP, val);\n\tif (err)\n\t\treturn err;\n\n\t \n\treturn mv88e6xxx_g1_stats_wait(chip);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}