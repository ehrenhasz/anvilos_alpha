{
  "module_name": "global2_avb.c",
  "hash_id": "9b42cdeffc2eda8c53709aa9144c90a9dce6a041282c651ff29dd14eec9de47b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/mv88e6xxx/global2_avb.c",
  "human_readable_source": "\n \n\n#include <linux/bitfield.h>\n\n#include \"global2.h\"\n\n \n\n \nstatic int mv88e6xxx_g2_avb_wait(struct mv88e6xxx_chip *chip)\n{\n\tint bit = __bf_shf(MV88E6352_G2_AVB_CMD_BUSY);\n\n\treturn mv88e6xxx_g2_wait_bit(chip, MV88E6352_G2_AVB_CMD, bit, 0);\n}\n\nstatic int mv88e6xxx_g2_avb_read(struct mv88e6xxx_chip *chip, u16 readop,\n\t\t\t\t u16 *data, int len)\n{\n\tint err;\n\tint i;\n\n\terr = mv88e6xxx_g2_avb_wait(chip);\n\tif (err)\n\t\treturn err;\n\n\t \n\tif (len > 4)\n\t\treturn -E2BIG;\n\n\terr = mv88e6xxx_g2_write(chip, MV88E6352_G2_AVB_CMD,\n\t\t\t\t MV88E6352_G2_AVB_CMD_BUSY | readop);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g2_avb_wait(chip);\n\tif (err)\n\t\treturn err;\n\n\tfor (i = 0; i < len; ++i) {\n\t\terr = mv88e6xxx_g2_read(chip, MV88E6352_G2_AVB_DATA,\n\t\t\t\t\t&data[i]);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int mv88e6xxx_g2_avb_write(struct mv88e6xxx_chip *chip, u16 writeop,\n\t\t\t\t  u16 data)\n{\n\tint err;\n\n\terr = mv88e6xxx_g2_avb_wait(chip);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g2_write(chip, MV88E6352_G2_AVB_DATA, data);\n\tif (err)\n\t\treturn err;\n\n\terr = mv88e6xxx_g2_write(chip, MV88E6352_G2_AVB_CMD,\n\t\t\t\t MV88E6352_G2_AVB_CMD_BUSY | writeop);\n\n\treturn mv88e6xxx_g2_avb_wait(chip);\n}\n\nstatic int mv88e6352_g2_avb_port_ptp_read(struct mv88e6xxx_chip *chip,\n\t\t\t\t\t  int port, int addr, u16 *data,\n\t\t\t\t\t  int len)\n{\n\tu16 readop = (len == 1 ? MV88E6352_G2_AVB_CMD_OP_READ :\n\t\t\t\t MV88E6352_G2_AVB_CMD_OP_READ_INCR) |\n\t\t     (port << 8) | (MV88E6352_G2_AVB_CMD_BLOCK_PTP << 5) |\n\t\t     addr;\n\n\treturn mv88e6xxx_g2_avb_read(chip, readop, data, len);\n}\n\nstatic int mv88e6352_g2_avb_port_ptp_write(struct mv88e6xxx_chip *chip,\n\t\t\t\t\t   int port, int addr, u16 data)\n{\n\tu16 writeop = MV88E6352_G2_AVB_CMD_OP_WRITE | (port << 8) |\n\t\t      (MV88E6352_G2_AVB_CMD_BLOCK_PTP << 5) | addr;\n\n\treturn mv88e6xxx_g2_avb_write(chip, writeop, data);\n}\n\nstatic int mv88e6352_g2_avb_ptp_read(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t     u16 *data, int len)\n{\n\treturn mv88e6352_g2_avb_port_ptp_read(chip,\n\t\t\t\t\tMV88E6352_G2_AVB_CMD_PORT_PTPGLOBAL,\n\t\t\t\t\taddr, data, len);\n}\n\nstatic int mv88e6352_g2_avb_ptp_write(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t      u16 data)\n{\n\treturn mv88e6352_g2_avb_port_ptp_write(chip,\n\t\t\t\t\tMV88E6352_G2_AVB_CMD_PORT_PTPGLOBAL,\n\t\t\t\t\taddr, data);\n}\n\nstatic int mv88e6352_g2_avb_tai_read(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t     u16 *data, int len)\n{\n\treturn mv88e6352_g2_avb_port_ptp_read(chip,\n\t\t\t\t\tMV88E6352_G2_AVB_CMD_PORT_TAIGLOBAL,\n\t\t\t\t\taddr, data, len);\n}\n\nstatic int mv88e6352_g2_avb_tai_write(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t      u16 data)\n{\n\treturn mv88e6352_g2_avb_port_ptp_write(chip,\n\t\t\t\t\tMV88E6352_G2_AVB_CMD_PORT_TAIGLOBAL,\n\t\t\t\t\taddr, data);\n}\n\nconst struct mv88e6xxx_avb_ops mv88e6352_avb_ops = {\n\t.port_ptp_read\t\t= mv88e6352_g2_avb_port_ptp_read,\n\t.port_ptp_write\t\t= mv88e6352_g2_avb_port_ptp_write,\n\t.ptp_read\t\t= mv88e6352_g2_avb_ptp_read,\n\t.ptp_write\t\t= mv88e6352_g2_avb_ptp_write,\n\t.tai_read\t\t= mv88e6352_g2_avb_tai_read,\n\t.tai_write\t\t= mv88e6352_g2_avb_tai_write,\n};\n\nstatic int mv88e6165_g2_avb_tai_read(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t     u16 *data, int len)\n{\n\treturn mv88e6352_g2_avb_port_ptp_read(chip,\n\t\t\t\t\tMV88E6165_G2_AVB_CMD_PORT_PTPGLOBAL,\n\t\t\t\t\taddr, data, len);\n}\n\nstatic int mv88e6165_g2_avb_tai_write(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t      u16 data)\n{\n\treturn mv88e6352_g2_avb_port_ptp_write(chip,\n\t\t\t\t\tMV88E6165_G2_AVB_CMD_PORT_PTPGLOBAL,\n\t\t\t\t\taddr, data);\n}\n\nconst struct mv88e6xxx_avb_ops mv88e6165_avb_ops = {\n\t.port_ptp_read\t\t= mv88e6352_g2_avb_port_ptp_read,\n\t.port_ptp_write\t\t= mv88e6352_g2_avb_port_ptp_write,\n\t.ptp_read\t\t= mv88e6352_g2_avb_ptp_read,\n\t.ptp_write\t\t= mv88e6352_g2_avb_ptp_write,\n\t.tai_read\t\t= mv88e6165_g2_avb_tai_read,\n\t.tai_write\t\t= mv88e6165_g2_avb_tai_write,\n};\n\nstatic int mv88e6390_g2_avb_port_ptp_read(struct mv88e6xxx_chip *chip,\n\t\t\t\t\t  int port, int addr, u16 *data,\n\t\t\t\t\t  int len)\n{\n\tu16 readop = (len == 1 ? MV88E6390_G2_AVB_CMD_OP_READ :\n\t\t\t\t MV88E6390_G2_AVB_CMD_OP_READ_INCR) |\n\t\t     (port << 8) | (MV88E6352_G2_AVB_CMD_BLOCK_PTP << 5) |\n\t\t     addr;\n\n\treturn mv88e6xxx_g2_avb_read(chip, readop, data, len);\n}\n\nstatic int mv88e6390_g2_avb_port_ptp_write(struct mv88e6xxx_chip *chip,\n\t\t\t\t\t   int port, int addr, u16 data)\n{\n\tu16 writeop = MV88E6390_G2_AVB_CMD_OP_WRITE | (port << 8) |\n\t\t      (MV88E6352_G2_AVB_CMD_BLOCK_PTP << 5) | addr;\n\n\treturn mv88e6xxx_g2_avb_write(chip, writeop, data);\n}\n\nstatic int mv88e6390_g2_avb_ptp_read(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t     u16 *data, int len)\n{\n\treturn mv88e6390_g2_avb_port_ptp_read(chip,\n\t\t\t\t\tMV88E6390_G2_AVB_CMD_PORT_PTPGLOBAL,\n\t\t\t\t\taddr, data, len);\n}\n\nstatic int mv88e6390_g2_avb_ptp_write(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t      u16 data)\n{\n\treturn mv88e6390_g2_avb_port_ptp_write(chip,\n\t\t\t\t\tMV88E6390_G2_AVB_CMD_PORT_PTPGLOBAL,\n\t\t\t\t\taddr, data);\n}\n\nstatic int mv88e6390_g2_avb_tai_read(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t     u16 *data, int len)\n{\n\treturn mv88e6390_g2_avb_port_ptp_read(chip,\n\t\t\t\t\tMV88E6390_G2_AVB_CMD_PORT_TAIGLOBAL,\n\t\t\t\t\taddr, data, len);\n}\n\nstatic int mv88e6390_g2_avb_tai_write(struct mv88e6xxx_chip *chip, int addr,\n\t\t\t\t      u16 data)\n{\n\treturn mv88e6390_g2_avb_port_ptp_write(chip,\n\t\t\t\t\tMV88E6390_G2_AVB_CMD_PORT_TAIGLOBAL,\n\t\t\t\t\taddr, data);\n}\n\nconst struct mv88e6xxx_avb_ops mv88e6390_avb_ops = {\n\t.port_ptp_read\t\t= mv88e6390_g2_avb_port_ptp_read,\n\t.port_ptp_write\t\t= mv88e6390_g2_avb_port_ptp_write,\n\t.ptp_read\t\t= mv88e6390_g2_avb_ptp_read,\n\t.ptp_write\t\t= mv88e6390_g2_avb_ptp_write,\n\t.tai_read\t\t= mv88e6390_g2_avb_tai_read,\n\t.tai_write\t\t= mv88e6390_g2_avb_tai_write,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}