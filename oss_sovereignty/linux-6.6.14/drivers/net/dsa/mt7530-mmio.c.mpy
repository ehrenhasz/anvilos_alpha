{
  "module_name": "mt7530-mmio.c",
  "hash_id": "42f99f42bf14cd5d07de722206a250f1cb76d220eaee28671a5790d41ab6987c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/mt7530-mmio.c",
  "human_readable_source": "\n\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/consumer.h>\n#include <linux/reset.h>\n#include <net/dsa.h>\n\n#include \"mt7530.h\"\n\nstatic const struct of_device_id mt7988_of_match[] = {\n\t{ .compatible = \"mediatek,mt7988-switch\", .data = &mt753x_table[ID_MT7988], },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, mt7988_of_match);\n\nstatic int\nmt7988_probe(struct platform_device *pdev)\n{\n\tstatic struct regmap_config *sw_regmap_config;\n\tstruct mt7530_priv *priv;\n\tvoid __iomem *base_addr;\n\tint ret;\n\n\tpriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->bus = NULL;\n\tpriv->dev = &pdev->dev;\n\n\tret = mt7530_probe_common(priv);\n\tif (ret)\n\t\treturn ret;\n\n\tpriv->rstc = devm_reset_control_get(&pdev->dev, NULL);\n\tif (IS_ERR(priv->rstc)) {\n\t\tdev_err(&pdev->dev, \"Couldn't get our reset line\\n\");\n\t\treturn PTR_ERR(priv->rstc);\n\t}\n\n\tbase_addr = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base_addr)) {\n\t\tdev_err(&pdev->dev, \"cannot request I/O memory space\\n\");\n\t\treturn -ENXIO;\n\t}\n\n\tsw_regmap_config = devm_kzalloc(&pdev->dev, sizeof(*sw_regmap_config), GFP_KERNEL);\n\tif (!sw_regmap_config)\n\t\treturn -ENOMEM;\n\n\tsw_regmap_config->name = \"switch\";\n\tsw_regmap_config->reg_bits = 16;\n\tsw_regmap_config->val_bits = 32;\n\tsw_regmap_config->reg_stride = 4;\n\tsw_regmap_config->max_register = MT7530_CREV;\n\tpriv->regmap = devm_regmap_init_mmio(&pdev->dev, base_addr, sw_regmap_config);\n\tif (IS_ERR(priv->regmap))\n\t\treturn PTR_ERR(priv->regmap);\n\n\treturn dsa_register_switch(priv->ds);\n}\n\nstatic int\nmt7988_remove(struct platform_device *pdev)\n{\n\tstruct mt7530_priv *priv = platform_get_drvdata(pdev);\n\n\tif (priv)\n\t\tmt7530_remove_common(priv);\n\n\treturn 0;\n}\n\nstatic void mt7988_shutdown(struct platform_device *pdev)\n{\n\tstruct mt7530_priv *priv = platform_get_drvdata(pdev);\n\n\tif (!priv)\n\t\treturn;\n\n\tdsa_switch_shutdown(priv->ds);\n\n\tdev_set_drvdata(&pdev->dev, NULL);\n}\n\nstatic struct platform_driver mt7988_platform_driver = {\n\t.probe  = mt7988_probe,\n\t.remove = mt7988_remove,\n\t.shutdown = mt7988_shutdown,\n\t.driver = {\n\t\t.name = \"mt7530-mmio\",\n\t\t.of_match_table = mt7988_of_match,\n\t},\n};\nmodule_platform_driver(mt7988_platform_driver);\n\nMODULE_AUTHOR(\"Daniel Golle <daniel@makrotopia.org>\");\nMODULE_DESCRIPTION(\"Driver for Mediatek MT7530 Switch (MMIO)\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}