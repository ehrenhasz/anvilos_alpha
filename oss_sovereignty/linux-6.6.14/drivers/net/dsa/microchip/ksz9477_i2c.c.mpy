{
  "module_name": "ksz9477_i2c.c",
  "hash_id": "81a73ffba37f62c43a226e8f1f5caf545e83dd32e98d865fac675fe45a003ee9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/dsa/microchip/ksz9477_i2c.c",
  "human_readable_source": "\n \n\n#include <linux/i2c.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n\n#include \"ksz_common.h\"\n\nKSZ_REGMAP_TABLE(ksz9477, not_used, 16, 0, 0);\n\nstatic int ksz9477_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct regmap_config rc;\n\tstruct ksz_device *dev;\n\tint i, ret;\n\n\tdev = ksz_switch_alloc(&i2c->dev, i2c);\n\tif (!dev)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < __KSZ_NUM_REGMAPS; i++) {\n\t\trc = ksz9477_regmap_config[i];\n\t\trc.lock_arg = &dev->regmap_mutex;\n\t\tdev->regmap[i] = devm_regmap_init_i2c(i2c, &rc);\n\t\tif (IS_ERR(dev->regmap[i])) {\n\t\t\treturn dev_err_probe(&i2c->dev, PTR_ERR(dev->regmap[i]),\n\t\t\t\t\t     \"Failed to initialize regmap%i\\n\",\n\t\t\t\t\t     ksz9477_regmap_config[i].val_bits);\n\t\t}\n\t}\n\n\tif (i2c->dev.platform_data)\n\t\tdev->pdata = i2c->dev.platform_data;\n\n\tdev->irq = i2c->irq;\n\n\tret = ksz_switch_register(dev);\n\n\t \n\tif (ret)\n\t\treturn ret;\n\n\ti2c_set_clientdata(i2c, dev);\n\n\treturn 0;\n}\n\nstatic void ksz9477_i2c_remove(struct i2c_client *i2c)\n{\n\tstruct ksz_device *dev = i2c_get_clientdata(i2c);\n\n\tif (dev)\n\t\tksz_switch_remove(dev);\n}\n\nstatic void ksz9477_i2c_shutdown(struct i2c_client *i2c)\n{\n\tstruct ksz_device *dev = i2c_get_clientdata(i2c);\n\n\tif (!dev)\n\t\treturn;\n\n\tif (dev->dev_ops->reset)\n\t\tdev->dev_ops->reset(dev);\n\n\tdsa_switch_shutdown(dev->ds);\n\n\ti2c_set_clientdata(i2c, NULL);\n}\n\nstatic const struct i2c_device_id ksz9477_i2c_id[] = {\n\t{ \"ksz9477-switch\", 0 },\n\t{},\n};\n\nMODULE_DEVICE_TABLE(i2c, ksz9477_i2c_id);\n\nstatic const struct of_device_id ksz9477_dt_ids[] = {\n\t{\n\t\t.compatible = \"microchip,ksz9477\",\n\t\t.data = &ksz_switch_chips[KSZ9477]\n\t},\n\t{\n\t\t.compatible = \"microchip,ksz9896\",\n\t\t.data = &ksz_switch_chips[KSZ9896]\n\t},\n\t{\n\t\t.compatible = \"microchip,ksz9897\",\n\t\t.data = &ksz_switch_chips[KSZ9897]\n\t},\n\t{\n\t\t.compatible = \"microchip,ksz9893\",\n\t\t.data = &ksz_switch_chips[KSZ9893]\n\t},\n\t{\n\t\t.compatible = \"microchip,ksz9563\",\n\t\t.data = &ksz_switch_chips[KSZ9563]\n\t},\n\t{\n\t\t.compatible = \"microchip,ksz8563\",\n\t\t.data = &ksz_switch_chips[KSZ8563]\n\t},\n\t{\n\t\t.compatible = \"microchip,ksz9567\",\n\t\t.data = &ksz_switch_chips[KSZ9567]\n\t},\n\t{},\n};\nMODULE_DEVICE_TABLE(of, ksz9477_dt_ids);\n\nstatic struct i2c_driver ksz9477_i2c_driver = {\n\t.driver = {\n\t\t.name\t= \"ksz9477-switch\",\n\t\t.of_match_table = ksz9477_dt_ids,\n\t},\n\t.probe = ksz9477_i2c_probe,\n\t.remove\t= ksz9477_i2c_remove,\n\t.shutdown = ksz9477_i2c_shutdown,\n\t.id_table = ksz9477_i2c_id,\n};\n\nmodule_i2c_driver(ksz9477_i2c_driver);\n\nMODULE_AUTHOR(\"Tristram Ha <Tristram.Ha@microchip.com>\");\nMODULE_DESCRIPTION(\"Microchip KSZ9477 Series Switch I2C access Driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}