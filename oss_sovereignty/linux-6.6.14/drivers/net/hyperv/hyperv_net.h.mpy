{
  "module_name": "hyperv_net.h",
  "hash_id": "c5cac5298ac153c87688f2894b6752f6301dd4362dd622b4bb245ca54e06ff48",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/hyperv/hyperv_net.h",
  "human_readable_source": " \n \n\n#ifndef _HYPERV_NET_H\n#define _HYPERV_NET_H\n\n#include <linux/list.h>\n#include <linux/hyperv.h>\n#include <linux/rndis.h>\n#include <linux/jhash.h>\n#include <net/xdp.h>\n\n \n#define OID_GEN_RECEIVE_SCALE_CAPABILITIES 0x00010203   \n#define OID_GEN_RECEIVE_SCALE_PARAMETERS 0x00010204   \n\n#define NDIS_OBJECT_TYPE_RSS_CAPABILITIES 0x88\n#define NDIS_OBJECT_TYPE_RSS_PARAMETERS 0x89\n#define NDIS_OBJECT_TYPE_OFFLOAD\t0xa7\n\n#define NDIS_RECEIVE_SCALE_CAPABILITIES_REVISION_2 2\n#define NDIS_RECEIVE_SCALE_PARAMETERS_REVISION_2 2\n\nstruct ndis_obj_header {\n\tu8 type;\n\tu8 rev;\n\tu16 size;\n} __packed;\n\n \n#define NDIS_RSS_CAPS_MESSAGE_SIGNALED_INTERRUPTS 0x01000000\n#define NDIS_RSS_CAPS_CLASSIFICATION_AT_ISR       0x02000000\n#define NDIS_RSS_CAPS_CLASSIFICATION_AT_DPC       0x04000000\n#define NDIS_RSS_CAPS_USING_MSI_X                 0x08000000\n#define NDIS_RSS_CAPS_RSS_AVAILABLE_ON_PORTS      0x10000000\n#define NDIS_RSS_CAPS_SUPPORTS_MSI_X              0x20000000\n#define NDIS_RSS_CAPS_HASH_TYPE_TCP_IPV4          0x00000100\n#define NDIS_RSS_CAPS_HASH_TYPE_TCP_IPV6          0x00000200\n#define NDIS_RSS_CAPS_HASH_TYPE_TCP_IPV6_EX       0x00000400\n\nstruct ndis_recv_scale_cap {  \n\tstruct ndis_obj_header hdr;\n\tu32 cap_flag;\n\tu32 num_int_msg;\n\tu32 num_recv_que;\n\tu16 num_indirect_tabent;\n} __packed;\n\n\n \n#define NDIS_RSS_PARAM_FLAG_BASE_CPU_UNCHANGED     0x0001\n#define NDIS_RSS_PARAM_FLAG_HASH_INFO_UNCHANGED    0x0002\n#define NDIS_RSS_PARAM_FLAG_ITABLE_UNCHANGED       0x0004\n#define NDIS_RSS_PARAM_FLAG_HASH_KEY_UNCHANGED     0x0008\n#define NDIS_RSS_PARAM_FLAG_DISABLE_RSS            0x0010\n\n \n#define NDIS_HASH_FUNC_TOEPLITZ 0x00000001\n#define NDIS_HASH_IPV4          0x00000100\n#define NDIS_HASH_TCP_IPV4      0x00000200\n#define NDIS_HASH_IPV6          0x00000400\n#define NDIS_HASH_IPV6_EX       0x00000800\n#define NDIS_HASH_TCP_IPV6      0x00001000\n#define NDIS_HASH_TCP_IPV6_EX   0x00002000\n\n#define NDIS_RSS_INDIRECTION_TABLE_MAX_SIZE_REVISION_2 (128 * 4)\n#define NDIS_RSS_HASH_SECRET_KEY_MAX_SIZE_REVISION_2   40\n\n#define ITAB_NUM 128\n#define ITAB_NUM_MAX 256\n\nstruct ndis_recv_scale_param {  \n\tstruct ndis_obj_header hdr;\n\n\t \n\tu16 flag;\n\n\t \n\tu16 base_cpu_number;\n\n\t \n\tu32 hashinfo;\n\n\t \n\tu16 indirect_tabsize;\n\n\t \n\tu32 indirect_taboffset;\n\n\t \n\tu16 hashkey_size;\n\n\t \n\tu32 hashkey_offset;\n\n\tu32 processor_masks_offset;\n\tu32 num_processor_masks;\n\tu32 processor_masks_entry_size;\n};\n\nstruct ndis_tcp_ip_checksum_info {\n\tunion {\n\t\tstruct {\n\t\t\tu32 is_ipv4:1;\n\t\t\tu32 is_ipv6:1;\n\t\t\tu32 tcp_checksum:1;\n\t\t\tu32 udp_checksum:1;\n\t\t\tu32 ip_header_checksum:1;\n\t\t\tu32 reserved:11;\n\t\t\tu32 tcp_header_offset:10;\n\t\t} transmit;\n\t\tstruct {\n\t\t\tu32 tcp_checksum_failed:1;\n\t\t\tu32 udp_checksum_failed:1;\n\t\t\tu32 ip_checksum_failed:1;\n\t\t\tu32 tcp_checksum_succeeded:1;\n\t\t\tu32 udp_checksum_succeeded:1;\n\t\t\tu32 ip_checksum_succeeded:1;\n\t\t\tu32 loopback:1;\n\t\t\tu32 tcp_checksum_value_invalid:1;\n\t\t\tu32 ip_checksum_value_invalid:1;\n\t\t} receive;\n\t\tu32  value;\n\t};\n};\n\nstruct ndis_pkt_8021q_info {\n\tunion {\n\t\tstruct {\n\t\t\tu32 pri:3;  \n\t\t\tu32 cfi:1;  \n\t\t\tu32 vlanid:12;  \n\t\t\tu32 reserved:16;\n\t\t};\n\t\tu32 value;\n\t};\n};\n\n \nstruct hv_netvsc_packet {\n\t \n\tu8 cp_partial;  \n\n\tu8 rmsg_size;  \n\tu8 rmsg_pgcnt;  \n\tu8 page_buf_cnt;\n\n\tu16 q_idx;\n\tu16 total_packets;\n\n\tu32 total_bytes;\n\tu32 send_buf_index;\n\tu32 total_data_buflen;\n\tstruct hv_dma_range *dma_range;\n};\n\n#define NETVSC_HASH_KEYLEN 40\n\nstruct netvsc_device_info {\n\tunsigned char mac_adr[ETH_ALEN];\n\tu32  num_chn;\n\tu32  send_sections;\n\tu32  recv_sections;\n\tu32  send_section_size;\n\tu32  recv_section_size;\n\n\tstruct bpf_prog *bprog;\n\n\tu8 rss_key[NETVSC_HASH_KEYLEN];\n};\n\nenum rndis_device_state {\n\tRNDIS_DEV_UNINITIALIZED = 0,\n\tRNDIS_DEV_INITIALIZING,\n\tRNDIS_DEV_INITIALIZED,\n\tRNDIS_DEV_DATAINITIALIZED,\n};\n\nstruct rndis_device {\n\tstruct net_device *ndev;\n\n\tenum rndis_device_state state;\n\n\tatomic_t new_req_id;\n\n\tspinlock_t request_lock;\n\tstruct list_head req_list;\n\n\tstruct work_struct mcast_work;\n\tu32 filter;\n\n\tbool link_state;         \n\n\tu8 hw_mac_adr[ETH_ALEN];\n\tu8 rss_key[NETVSC_HASH_KEYLEN];\n};\n\n\n \nstruct rndis_message;\nstruct ndis_offload_params;\nstruct netvsc_device;\nstruct netvsc_channel;\nstruct net_device_context;\n\nextern u32 netvsc_ring_bytes;\n\nstruct netvsc_device *netvsc_device_add(struct hv_device *device,\n\t\t\t\t\tconst struct netvsc_device_info *info);\nint netvsc_alloc_recv_comp_ring(struct netvsc_device *net_device, u32 q_idx);\nvoid netvsc_device_remove(struct hv_device *device);\nint netvsc_send(struct net_device *net,\n\t\tstruct hv_netvsc_packet *packet,\n\t\tstruct rndis_message *rndis_msg,\n\t\tstruct hv_page_buffer *page_buffer,\n\t\tstruct sk_buff *skb,\n\t\tbool xdp_tx);\nvoid netvsc_linkstatus_callback(struct net_device *net,\n\t\t\t\tstruct rndis_message *resp,\n\t\t\t\tvoid *data, u32 data_buflen);\nint netvsc_recv_callback(struct net_device *net,\n\t\t\t struct netvsc_device *nvdev,\n\t\t\t struct netvsc_channel *nvchan);\nvoid netvsc_channel_cb(void *context);\nint netvsc_poll(struct napi_struct *napi, int budget);\n\nvoid netvsc_xdp_xmit(struct sk_buff *skb, struct net_device *ndev);\nu32 netvsc_run_xdp(struct net_device *ndev, struct netvsc_channel *nvchan,\n\t\t   struct xdp_buff *xdp);\nunsigned int netvsc_xdp_fraglen(unsigned int len);\nstruct bpf_prog *netvsc_xdp_get(struct netvsc_device *nvdev);\nint netvsc_xdp_set(struct net_device *dev, struct bpf_prog *prog,\n\t\t   struct netlink_ext_ack *extack,\n\t\t   struct netvsc_device *nvdev);\nint netvsc_vf_setxdp(struct net_device *vf_netdev, struct bpf_prog *prog);\nint netvsc_bpf(struct net_device *dev, struct netdev_bpf *bpf);\nint netvsc_ndoxdp_xmit(struct net_device *ndev, int n,\n\t\t       struct xdp_frame **frames, u32 flags);\n\nint rndis_set_subchannel(struct net_device *ndev,\n\t\t\t struct netvsc_device *nvdev,\n\t\t\t struct netvsc_device_info *dev_info);\nint rndis_filter_open(struct netvsc_device *nvdev);\nint rndis_filter_close(struct netvsc_device *nvdev);\nstruct netvsc_device *rndis_filter_device_add(struct hv_device *dev,\n\t\t\t\t\t      struct netvsc_device_info *info);\nvoid rndis_filter_update(struct netvsc_device *nvdev);\nvoid rndis_filter_device_remove(struct hv_device *dev,\n\t\t\t\tstruct netvsc_device *nvdev);\nint rndis_filter_set_rss_param(struct rndis_device *rdev,\n\t\t\t       const u8 *key);\nint rndis_filter_set_offload_params(struct net_device *ndev,\n\t\t\t\t    struct netvsc_device *nvdev,\n\t\t\t\t    struct ndis_offload_params *req_offloads);\nint rndis_filter_receive(struct net_device *ndev,\n\t\t\t struct netvsc_device *net_dev,\n\t\t\t struct netvsc_channel *nvchan,\n\t\t\t void *data, u32 buflen);\n\nint rndis_filter_set_device_mac(struct netvsc_device *ndev,\n\t\t\t\tconst char *mac);\n\nint netvsc_switch_datapath(struct net_device *nv_dev, bool vf);\n\n#define NVSP_INVALID_PROTOCOL_VERSION\t((u32)0xFFFFFFFF)\n\n#define NVSP_PROTOCOL_VERSION_1\t\t2\n#define NVSP_PROTOCOL_VERSION_2\t\t0x30002\n#define NVSP_PROTOCOL_VERSION_4\t\t0x40000\n#define NVSP_PROTOCOL_VERSION_5\t\t0x50000\n#define NVSP_PROTOCOL_VERSION_6\t\t0x60000\n#define NVSP_PROTOCOL_VERSION_61\t0x60001\n\nenum {\n\tNVSP_MSG_TYPE_NONE = 0,\n\n\t \n\tNVSP_MSG_TYPE_INIT\t\t\t= 1,\n\tNVSP_MSG_TYPE_INIT_COMPLETE\t\t= 2,\n\n\tNVSP_VERSION_MSG_START\t\t\t= 100,\n\n\t \n\tNVSP_MSG1_TYPE_SEND_NDIS_VER\t\t= NVSP_VERSION_MSG_START,\n\n\tNVSP_MSG1_TYPE_SEND_RECV_BUF,\n\tNVSP_MSG1_TYPE_SEND_RECV_BUF_COMPLETE,\n\tNVSP_MSG1_TYPE_REVOKE_RECV_BUF,\n\n\tNVSP_MSG1_TYPE_SEND_SEND_BUF,\n\tNVSP_MSG1_TYPE_SEND_SEND_BUF_COMPLETE,\n\tNVSP_MSG1_TYPE_REVOKE_SEND_BUF,\n\n\tNVSP_MSG1_TYPE_SEND_RNDIS_PKT,\n\tNVSP_MSG1_TYPE_SEND_RNDIS_PKT_COMPLETE,\n\n\t \n\tNVSP_MSG2_TYPE_SEND_CHIMNEY_DELEGATED_BUF,\n\tNVSP_MSG2_TYPE_SEND_CHIMNEY_DELEGATED_BUF_COMP,\n\tNVSP_MSG2_TYPE_REVOKE_CHIMNEY_DELEGATED_BUF,\n\n\tNVSP_MSG2_TYPE_RESUME_CHIMNEY_RX_INDICATION,\n\n\tNVSP_MSG2_TYPE_TERMINATE_CHIMNEY,\n\tNVSP_MSG2_TYPE_TERMINATE_CHIMNEY_COMP,\n\n\tNVSP_MSG2_TYPE_INDICATE_CHIMNEY_EVENT,\n\n\tNVSP_MSG2_TYPE_SEND_CHIMNEY_PKT,\n\tNVSP_MSG2_TYPE_SEND_CHIMNEY_PKT_COMP,\n\n\tNVSP_MSG2_TYPE_POST_CHIMNEY_RECV_REQ,\n\tNVSP_MSG2_TYPE_POST_CHIMNEY_RECV_REQ_COMP,\n\n\tNVSP_MSG2_TYPE_ALLOC_RXBUF,\n\tNVSP_MSG2_TYPE_ALLOC_RXBUF_COMP,\n\n\tNVSP_MSG2_TYPE_FREE_RXBUF,\n\n\tNVSP_MSG2_TYPE_SEND_VMQ_RNDIS_PKT,\n\tNVSP_MSG2_TYPE_SEND_VMQ_RNDIS_PKT_COMP,\n\n\tNVSP_MSG2_TYPE_SEND_NDIS_CONFIG,\n\n\tNVSP_MSG2_TYPE_ALLOC_CHIMNEY_HANDLE,\n\tNVSP_MSG2_TYPE_ALLOC_CHIMNEY_HANDLE_COMP,\n\n\tNVSP_MSG2_MAX = NVSP_MSG2_TYPE_ALLOC_CHIMNEY_HANDLE_COMP,\n\n\t \n\tNVSP_MSG4_TYPE_SEND_VF_ASSOCIATION,\n\tNVSP_MSG4_TYPE_SWITCH_DATA_PATH,\n\tNVSP_MSG4_TYPE_UPLINK_CONNECT_STATE_DEPRECATED,\n\n\tNVSP_MSG4_MAX = NVSP_MSG4_TYPE_UPLINK_CONNECT_STATE_DEPRECATED,\n\n\t \n\tNVSP_MSG5_TYPE_OID_QUERY_EX,\n\tNVSP_MSG5_TYPE_OID_QUERY_EX_COMP,\n\tNVSP_MSG5_TYPE_SUBCHANNEL,\n\tNVSP_MSG5_TYPE_SEND_INDIRECTION_TABLE,\n\n\tNVSP_MSG5_MAX = NVSP_MSG5_TYPE_SEND_INDIRECTION_TABLE,\n\n\t \n\tNVSP_MSG6_TYPE_PD_API,\n\tNVSP_MSG6_TYPE_PD_POST_BATCH,\n\n\tNVSP_MSG6_MAX = NVSP_MSG6_TYPE_PD_POST_BATCH\n};\n\nenum {\n\tNVSP_STAT_NONE = 0,\n\tNVSP_STAT_SUCCESS,\n\tNVSP_STAT_FAIL,\n\tNVSP_STAT_PROTOCOL_TOO_NEW,\n\tNVSP_STAT_PROTOCOL_TOO_OLD,\n\tNVSP_STAT_INVALID_RNDIS_PKT,\n\tNVSP_STAT_BUSY,\n\tNVSP_STAT_PROTOCOL_UNSUPPORTED,\n\tNVSP_STAT_MAX,\n};\n\nstruct nvsp_message_header {\n\tu32 msg_type;\n};\n\n \n\n \nstruct nvsp_message_init {\n\tu32 min_protocol_ver;\n\tu32 max_protocol_ver;\n} __packed;\n\n \nstruct nvsp_message_init_complete {\n\tu32 negotiated_protocol_ver;\n\tu32 max_mdl_chain_len;\n\tu32 status;\n} __packed;\n\nunion nvsp_message_init_uber {\n\tstruct nvsp_message_init init;\n\tstruct nvsp_message_init_complete init_complete;\n} __packed;\n\n \n\n \nstruct nvsp_1_message_send_ndis_version {\n\tu32 ndis_major_ver;\n\tu32 ndis_minor_ver;\n} __packed;\n\n \nstruct nvsp_1_message_send_receive_buffer {\n\tu32 gpadl_handle;\n\tu16 id;\n} __packed;\n\nstruct nvsp_1_receive_buffer_section {\n\tu32 offset;\n\tu32 sub_alloc_size;\n\tu32 num_sub_allocs;\n\tu32 end_offset;\n} __packed;\n\n \nstruct nvsp_1_message_send_receive_buffer_complete {\n\tu32 status;\n\tu32 num_sections;\n\n\t \n\n\t \n\n\t \n\n\tstruct nvsp_1_receive_buffer_section sections[1];\n} __packed;\n\n \nstruct nvsp_1_message_revoke_receive_buffer {\n\tu16 id;\n};\n\n \nstruct nvsp_1_message_send_send_buffer {\n\tu32 gpadl_handle;\n\tu16 id;\n} __packed;\n\n \nstruct nvsp_1_message_send_send_buffer_complete {\n\tu32 status;\n\n\t \n\tu32 section_size;\n} __packed;\n\n \nstruct nvsp_1_message_revoke_send_buffer {\n\tu16 id;\n};\n\n \nstruct nvsp_1_message_send_rndis_packet {\n\t \n\tu32 channel_type;\n\n\t \n\tu32 send_buf_section_index;\n\tu32 send_buf_section_size;\n} __packed;\n\n \nstruct nvsp_1_message_send_rndis_packet_complete {\n\tu32 status;\n};\n\nunion nvsp_1_message_uber {\n\tstruct nvsp_1_message_send_ndis_version send_ndis_ver;\n\n\tstruct nvsp_1_message_send_receive_buffer send_recv_buf;\n\tstruct nvsp_1_message_send_receive_buffer_complete\n\t\t\t\t\t\tsend_recv_buf_complete;\n\tstruct nvsp_1_message_revoke_receive_buffer revoke_recv_buf;\n\n\tstruct nvsp_1_message_send_send_buffer send_send_buf;\n\tstruct nvsp_1_message_send_send_buffer_complete send_send_buf_complete;\n\tstruct nvsp_1_message_revoke_send_buffer revoke_send_buf;\n\n\tstruct nvsp_1_message_send_rndis_packet send_rndis_pkt;\n\tstruct nvsp_1_message_send_rndis_packet_complete\n\t\t\t\t\t\tsend_rndis_pkt_complete;\n} __packed;\n\n\n \nstruct nvsp_2_vsc_capability {\n\tunion {\n\t\tu64 data;\n\t\tstruct {\n\t\t\tu64 vmq:1;\n\t\t\tu64 chimney:1;\n\t\t\tu64 sriov:1;\n\t\t\tu64 ieee8021q:1;\n\t\t\tu64 correlation_id:1;\n\t\t\tu64 teaming:1;\n\t\t\tu64 vsubnetid:1;\n\t\t\tu64 rsc:1;\n\t\t};\n\t};\n} __packed;\n\nstruct nvsp_2_send_ndis_config {\n\tu32 mtu;\n\tu32 reserved;\n\tstruct nvsp_2_vsc_capability capability;\n} __packed;\n\n \nstruct nvsp_2_alloc_rxbuf {\n\t \n\tu32 alloc_id;\n\n\t \n\tu32 len;\n} __packed;\n\n \nstruct nvsp_2_alloc_rxbuf_comp {\n\t \n\tu32 status;\n\n\tu32 alloc_id;\n\n\t \n\tu32 gpadl_handle;\n\n\t \n\tu64 recv_buf_id;\n} __packed;\n\nstruct nvsp_2_free_rxbuf {\n\tu64 recv_buf_id;\n} __packed;\n\nunion nvsp_2_message_uber {\n\tstruct nvsp_2_send_ndis_config send_ndis_config;\n\tstruct nvsp_2_alloc_rxbuf alloc_rxbuf;\n\tstruct nvsp_2_alloc_rxbuf_comp alloc_rxbuf_comp;\n\tstruct nvsp_2_free_rxbuf free_rxbuf;\n} __packed;\n\nstruct nvsp_4_send_vf_association {\n\t \n\tu32 allocated;\n\n\t \n\tu32 serial;\n} __packed;\n\nenum nvsp_vm_datapath {\n\tNVSP_DATAPATH_SYNTHETIC = 0,\n\tNVSP_DATAPATH_VF,\n\tNVSP_DATAPATH_MAX\n};\n\nstruct nvsp_4_sw_datapath {\n\tu32 active_datapath;  \n} __packed;\n\nunion nvsp_4_message_uber {\n\tstruct nvsp_4_send_vf_association vf_assoc;\n\tstruct nvsp_4_sw_datapath active_dp;\n} __packed;\n\nenum nvsp_subchannel_operation {\n\tNVSP_SUBCHANNEL_NONE = 0,\n\tNVSP_SUBCHANNEL_ALLOCATE,\n\tNVSP_SUBCHANNEL_MAX\n};\n\nstruct nvsp_5_subchannel_request {\n\tu32 op;\n\tu32 num_subchannels;\n} __packed;\n\nstruct nvsp_5_subchannel_complete {\n\tu32 status;\n\tu32 num_subchannels;  \n} __packed;\n\nstruct nvsp_5_send_indirect_table {\n\t \n\tu32 count;\n\n\t \n\tu32 offset;\n} __packed;\n\nunion nvsp_5_message_uber {\n\tstruct nvsp_5_subchannel_request subchn_req;\n\tstruct nvsp_5_subchannel_complete subchn_comp;\n\tstruct nvsp_5_send_indirect_table send_table;\n} __packed;\n\nenum nvsp_6_pd_api_op {\n\tPD_API_OP_CONFIG = 1,\n\tPD_API_OP_SW_DATAPATH,  \n\tPD_API_OP_OPEN_PROVIDER,\n\tPD_API_OP_CLOSE_PROVIDER,\n\tPD_API_OP_CREATE_QUEUE,\n\tPD_API_OP_FLUSH_QUEUE,\n\tPD_API_OP_FREE_QUEUE,\n\tPD_API_OP_ALLOC_COM_BUF,  \n\tPD_API_OP_FREE_COM_BUF,  \n\tPD_API_OP_MAX\n};\n\nstruct grp_affinity {\n\tu64 mask;\n\tu16 grp;\n\tu16 reserved[3];\n} __packed;\n\nstruct nvsp_6_pd_api_req {\n\tu32 op;\n\n\tunion {\n\t\t \n\t\tstruct __packed {\n\t\t\tu64 mmio_pa;  \n\t\t\tu32 mmio_len;\n\n\t\t\t \n\t\t\tu16 num_subchn;\n\t\t} config;\n\n\t\t \n\t\tstruct __packed {\n\t\t\t \n\t\t\tu8 host_dpath_is_pd;\n\n\t\t\t \n\t\t\tu8 guest_pd_enabled;\n\t\t} sw_dpath;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 prov_id;  \n\t\t\tu32 flag;\n\t\t} open_prov;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 prov_id;\n\t\t} cls_prov;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 prov_id;\n\t\t\tu16 q_id;\n\t\t\tu16 q_size;\n\t\t\tu8 is_recv_q;\n\t\t\tu8 is_rss_q;\n\t\t\tu32 recv_data_len;\n\t\t\tstruct grp_affinity affy;\n\t\t} cr_q;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 prov_id;\n\t\t\tu16 q_id;\n\t\t} del_q;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 prov_id;\n\t\t\tu16 q_id;\n\t\t} flush_q;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 len;\n\t\t\tu32 pf_node;  \n\t\t\tu16 region_id;\n\t\t} alloc_com_buf;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 len;\n\t\t\tu64 pa;  \n\t\t\tu32 pf_node;  \n\t\t\tu16 region_id;\n\t\t\tu8 cache_type;\n\t\t} free_com_buf;\n\t} __packed;\n} __packed;\n\nstruct nvsp_6_pd_api_comp {\n\tu32 op;\n\tu32 status;\n\n\tunion {\n\t\tstruct __packed {\n\t\t\t \n\t\t\tu16 num_pd_q;\n\n\t\t\t \n\t\t\tu8 num_rss_q;\n\n\t\t\tu8 is_supported;  \n\t\t\tu8 is_enabled;  \n\t\t} config;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 prov_id;\n\t\t} open_prov;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu32 prov_id;\n\t\t\tu16 q_id;\n\t\t\tu16 q_size;\n\t\t\tu32 recv_data_len;\n\t\t\tstruct grp_affinity affy;\n\t\t} cr_q;\n\n\t\t \n\t\tstruct __packed {\n\t\t\tu64 pa;  \n\t\t\tu32 len;\n\t\t\tu32 pf_node;  \n\t\t\tu16 region_id;\n\t\t\tu8 cache_type;\n\t\t} alloc_com_buf;\n\t} __packed;\n} __packed;\n\nstruct nvsp_6_pd_buf {\n\tu32 region_offset;\n\tu16 region_id;\n\tu16 is_partial:1;\n\tu16 reserved:15;\n} __packed;\n\nstruct nvsp_6_pd_batch_msg {\n\tstruct nvsp_message_header hdr;\n\tu16 count;\n\tu16 guest2host:1;\n\tu16 is_recv:1;\n\tu16 reserved:14;\n\tstruct nvsp_6_pd_buf pd_buf[0];\n} __packed;\n\nunion nvsp_6_message_uber {\n\tstruct nvsp_6_pd_api_req pd_req;\n\tstruct nvsp_6_pd_api_comp pd_comp;\n} __packed;\n\nunion nvsp_all_messages {\n\tunion nvsp_message_init_uber init_msg;\n\tunion nvsp_1_message_uber v1_msg;\n\tunion nvsp_2_message_uber v2_msg;\n\tunion nvsp_4_message_uber v4_msg;\n\tunion nvsp_5_message_uber v5_msg;\n\tunion nvsp_6_message_uber v6_msg;\n} __packed;\n\n \nstruct nvsp_message {\n\tstruct nvsp_message_header hdr;\n\tunion nvsp_all_messages msg;\n} __packed;\n\n\n#define NETVSC_MTU 65535\n#define NETVSC_MTU_MIN ETH_MIN_MTU\n\n \n#define NETVSC_RECEIVE_BUFFER_SIZE\t\t(1024 * 1024 * 31)  \n#define NETVSC_RECEIVE_BUFFER_SIZE_LEGACY\t(1024 * 1024 * 15)  \n#define NETVSC_RECEIVE_BUFFER_DEFAULT\t\t(1024 * 1024 * 16)\n\n#define NETVSC_SEND_BUFFER_SIZE\t\t\t(1024 * 1024 * 15)   \n#define NETVSC_SEND_BUFFER_DEFAULT\t\t(1024 * 1024)\n\n#define NETVSC_INVALID_INDEX\t\t\t-1\n\n#define NETVSC_SEND_SECTION_SIZE\t\t6144\n#define NETVSC_RECV_SECTION_SIZE\t\t1728\n\n \n#define NETVSC_MIN_TX_SECTIONS\t10\n#define NETVSC_DEFAULT_TX\t(NETVSC_SEND_BUFFER_DEFAULT \\\n\t\t\t\t / NETVSC_SEND_SECTION_SIZE)\n#define NETVSC_MIN_RX_SECTIONS\t10\n#define NETVSC_DEFAULT_RX\t(NETVSC_RECEIVE_BUFFER_DEFAULT \\\n\t\t\t\t / NETVSC_RECV_SECTION_SIZE)\n\n#define NETVSC_RECEIVE_BUFFER_ID\t\t0xcafe\n#define NETVSC_SEND_BUFFER_ID\t\t\t0\n\n#define NETVSC_SUPPORTED_HW_FEATURES (NETIF_F_RXCSUM | NETIF_F_IP_CSUM | \\\n\t\t\t\t      NETIF_F_TSO | NETIF_F_IPV6_CSUM | \\\n\t\t\t\t      NETIF_F_TSO6 | NETIF_F_LRO | \\\n\t\t\t\t      NETIF_F_SG | NETIF_F_RXHASH)\n\n#define VRSS_SEND_TAB_SIZE 16   \n#define VRSS_CHANNEL_MAX 64\n#define VRSS_CHANNEL_DEFAULT 8\n\n#define RNDIS_MAX_PKT_DEFAULT 8\n#define RNDIS_PKT_ALIGN_DEFAULT 8\n\n#define NETVSC_XDP_HDRM 256\n\n#define NETVSC_MIN_OUT_MSG_SIZE (sizeof(struct vmpacket_descriptor) + \\\n\t\t\t\t sizeof(struct nvsp_message))\n#define NETVSC_MIN_IN_MSG_SIZE sizeof(struct vmpacket_descriptor)\n\n \nstatic inline u32 netvsc_rqstor_size(unsigned long ringbytes)\n{\n\treturn ringbytes / NETVSC_MIN_OUT_MSG_SIZE +\n\t\tringbytes / NETVSC_MIN_IN_MSG_SIZE;\n}\n\n \n#define NETVSC_MAX_XFER_PAGE_RANGES NVSP_RSC_MAX\n#define NETVSC_XFER_HEADER_SIZE(rng_cnt) \\\n\t\t(offsetof(struct vmtransfer_page_packet_header, ranges) + \\\n\t\t(rng_cnt) * sizeof(struct vmtransfer_page_range))\n#define NETVSC_MAX_PKT_SIZE (NETVSC_XFER_HEADER_SIZE(NETVSC_MAX_XFER_PAGE_RANGES) + \\\n\t\tsizeof(struct nvsp_message) + (sizeof(u32) * VRSS_SEND_TAB_SIZE))\n\nstruct multi_send_data {\n\tstruct sk_buff *skb;  \n\tstruct hv_netvsc_packet *pkt;  \n\tu32 count;  \n};\n\nstruct recv_comp_data {\n\tu64 tid;  \n\tu32 status;\n};\n\nstruct multi_recv_comp {\n\tstruct recv_comp_data *slots;\n\tu32 first;\t \n\tu32 next;\t \n};\n\n#define NVSP_RSC_MAX 562  \n\nstruct nvsc_rsc {\n\tstruct ndis_pkt_8021q_info vlan;\n\tstruct ndis_tcp_ip_checksum_info csum_info;\n\tu32 hash_info;\n\tu8 ppi_flags;  \n\tu8 is_last;  \n\tu32 cnt;  \n\tu32 pktlen;  \n\tvoid *data[NVSP_RSC_MAX];\n\tu32 len[NVSP_RSC_MAX];\n};\n\n#define NVSC_RSC_VLAN\t\tBIT(0)\t \n#define NVSC_RSC_CSUM_INFO\tBIT(1)\t \n#define NVSC_RSC_HASH_INFO\tBIT(2)\t \n\nstruct netvsc_stats_tx {\n\tu64 packets;\n\tu64 bytes;\n\tu64 xdp_xmit;\n\tstruct u64_stats_sync syncp;\n};\n\nstruct netvsc_stats_rx {\n\tu64 packets;\n\tu64 bytes;\n\tu64 broadcast;\n\tu64 multicast;\n\tu64 xdp_drop;\n\tu64 xdp_redirect;\n\tu64 xdp_tx;\n\tstruct u64_stats_sync syncp;\n};\n\nstruct netvsc_ethtool_stats {\n\tunsigned long tx_scattered;\n\tunsigned long tx_no_memory;\n\tunsigned long tx_no_space;\n\tunsigned long tx_too_big;\n\tunsigned long tx_busy;\n\tunsigned long tx_send_full;\n\tunsigned long rx_comp_busy;\n\tunsigned long rx_no_memory;\n\tunsigned long stop_queue;\n\tunsigned long wake_queue;\n\tunsigned long vlan_error;\n};\n\nstruct netvsc_ethtool_pcpu_stats {\n\tu64     rx_packets;\n\tu64     rx_bytes;\n\tu64     tx_packets;\n\tu64     tx_bytes;\n\tu64     vf_rx_packets;\n\tu64     vf_rx_bytes;\n\tu64     vf_tx_packets;\n\tu64     vf_tx_bytes;\n};\n\nstruct netvsc_vf_pcpu_stats {\n\tu64     rx_packets;\n\tu64     rx_bytes;\n\tu64     tx_packets;\n\tu64     tx_bytes;\n\tstruct u64_stats_sync   syncp;\n\tu32\ttx_dropped;\n};\n\nstruct netvsc_reconfig {\n\tstruct list_head list;\n\tu32 event;\n};\n\n \n#define HV_TCP4_L4HASH 1\n#define HV_TCP6_L4HASH 2\n#define HV_UDP4_L4HASH 4\n#define HV_UDP6_L4HASH 8\n#define HV_DEFAULT_L4HASH (HV_TCP4_L4HASH | HV_TCP6_L4HASH | HV_UDP4_L4HASH | \\\n\t\t\t   HV_UDP6_L4HASH)\n\n \nstruct net_device_context {\n\t \n\tstruct hv_device *device_ctx;\n\t \n\tstruct netvsc_device __rcu *nvdev;\n\t \n\tstruct list_head list;\n\t \n\tstruct delayed_work dwork;\n\t \n\tunsigned long last_reconfig;\n\t \n\tstruct list_head reconfig_events;\n\t \n\tspinlock_t lock;\n\n\tu32 msg_enable;  \n\n\tu32 tx_checksum_mask;\n\n\tu32 tx_table[VRSS_SEND_TAB_SIZE];\n\n\tu16 *rx_table;\n\n\tu32 rx_table_sz;\n\n\t \n\tu8 duplex;\n\tu32 speed;\n\tu32 l4_hash;  \n\tstruct netvsc_ethtool_stats eth_stats;\n\n\t \n\tstruct net_device __rcu *vf_netdev;\n\tstruct netvsc_vf_pcpu_stats __percpu *vf_stats;\n\tstruct delayed_work vf_takeover;\n\n\t \n\tu32 vf_alloc;\n\t \n\tu32 vf_serial;\n\t \n\tstruct completion vf_add;\n\t \n\tbool  data_path_is_vf;\n\n\t \n\tstruct netvsc_device_info *saved_netvsc_dev_info;\n};\n\n \nstatic inline u32 netvsc_get_hash(struct sk_buff *skb,\n\t\t\t\t  const struct net_device_context *ndc)\n{\n\tstruct flow_keys flow;\n\tu32 hash, pkt_proto = 0;\n\tstatic u32 hashrnd __read_mostly;\n\n\tnet_get_random_once(&hashrnd, sizeof(hashrnd));\n\n\tif (!skb_flow_dissect_flow_keys(skb, &flow, 0))\n\t\treturn 0;\n\n\tswitch (flow.basic.ip_proto) {\n\tcase IPPROTO_TCP:\n\t\tif (flow.basic.n_proto == htons(ETH_P_IP))\n\t\t\tpkt_proto = HV_TCP4_L4HASH;\n\t\telse if (flow.basic.n_proto == htons(ETH_P_IPV6))\n\t\t\tpkt_proto = HV_TCP6_L4HASH;\n\n\t\tbreak;\n\n\tcase IPPROTO_UDP:\n\t\tif (flow.basic.n_proto == htons(ETH_P_IP))\n\t\t\tpkt_proto = HV_UDP4_L4HASH;\n\t\telse if (flow.basic.n_proto == htons(ETH_P_IPV6))\n\t\t\tpkt_proto = HV_UDP6_L4HASH;\n\n\t\tbreak;\n\t}\n\n\tif (pkt_proto & ndc->l4_hash) {\n\t\treturn skb_get_hash(skb);\n\t} else {\n\t\tif (flow.basic.n_proto == htons(ETH_P_IP))\n\t\t\thash = jhash2((u32 *)&flow.addrs.v4addrs, 2, hashrnd);\n\t\telse if (flow.basic.n_proto == htons(ETH_P_IPV6))\n\t\t\thash = jhash2((u32 *)&flow.addrs.v6addrs, 8, hashrnd);\n\t\telse\n\t\t\treturn 0;\n\n\t\t__skb_set_sw_hash(skb, hash, false);\n\t}\n\n\treturn hash;\n}\n\n \nstruct netvsc_channel {\n\tstruct vmbus_channel *channel;\n\tstruct netvsc_device *net_device;\n\tvoid *recv_buf;  \n\tconst struct vmpacket_descriptor *desc;\n\tstruct napi_struct napi;\n\tstruct multi_send_data msd;\n\tstruct multi_recv_comp mrc;\n\tatomic_t queue_sends;\n\tstruct nvsc_rsc rsc;\n\n\tstruct bpf_prog __rcu *bpf_prog;\n\tstruct xdp_rxq_info xdp_rxq;\n\tbool xdp_flush;\n\n\tstruct netvsc_stats_tx tx_stats;\n\tstruct netvsc_stats_rx rx_stats;\n};\n\n \nstruct netvsc_device {\n\tu32 nvsp_version;\n\n\twait_queue_head_t wait_drain;\n\tbool destroy;\n\tbool tx_disable;  \n\n\t \n\tvoid *recv_buf;\n\tu32 recv_buf_size;  \n\tstruct vmbus_gpadl recv_buf_gpadl_handle;\n\tu32 recv_section_cnt;\n\tu32 recv_section_size;\n\tu32 recv_completion_cnt;\n\n\t \n\tvoid *send_buf;\n\tu32 send_buf_size;\n\tstruct vmbus_gpadl send_buf_gpadl_handle;\n\tu32 send_section_cnt;\n\tu32 send_section_size;\n\tunsigned long *send_section_map;\n\n\t \n\tstruct completion channel_init_wait;\n\tstruct nvsp_message channel_init_pkt;\n\n\tstruct nvsp_message revoke_packet;\n\n\tu32 max_chn;\n\tu32 num_chn;\n\n\tatomic_t open_chn;\n\tstruct work_struct subchan_work;\n\twait_queue_head_t subchan_open;\n\n\tstruct rndis_device *extension;\n\n\tu32 max_pkt;  \n\tu32 pkt_align;  \n\n\tstruct netvsc_channel chan_table[VRSS_CHANNEL_MAX];\n\n\tstruct rcu_head rcu;\n};\n\n \nstruct rndis_initialize_request {\n\tu32 req_id;\n\tu32 major_ver;\n\tu32 minor_ver;\n\tu32 max_xfer_size;\n};\n\n \nstruct rndis_initialize_complete {\n\tu32 req_id;\n\tu32 status;\n\tu32 major_ver;\n\tu32 minor_ver;\n\tu32 dev_flags;\n\tu32 medium;\n\tu32 max_pkt_per_msg;\n\tu32 max_xfer_size;\n\tu32 pkt_alignment_factor;\n\tu32 af_list_offset;\n\tu32 af_list_size;\n};\n\n \n \nstruct rndis_co_address_family {\n\tu32 address_family;\n\tu32 major_ver;\n\tu32 minor_ver;\n};\n\n \nstruct rndis_halt_request {\n\tu32 req_id;\n};\n\n \nstruct rndis_query_request {\n\tu32 req_id;\n\tu32 oid;\n\tu32 info_buflen;\n\tu32 info_buf_offset;\n\tu32 dev_vc_handle;\n};\n\n \nstruct rndis_query_complete {\n\tu32 req_id;\n\tu32 status;\n\tu32 info_buflen;\n\tu32 info_buf_offset;\n};\n\n \nstruct rndis_set_request {\n\tu32 req_id;\n\tu32 oid;\n\tu32 info_buflen;\n\tu32 info_buf_offset;\n\tu32 dev_vc_handle;\n\tu8  info_buf[];\n};\n\n \nstruct rndis_set_complete {\n\tu32 req_id;\n\tu32 status;\n};\n\n \nstruct rndis_reset_request {\n\tu32 reserved;\n};\n\n \nstruct rndis_reset_complete {\n\tu32 status;\n\tu32 addressing_reset;\n};\n\n \nstruct rndis_indicate_status {\n\tu32 status;\n\tu32 status_buflen;\n\tu32 status_buf_offset;\n};\n\n \n \nstruct rndis_diagnostic_info {\n\tu32 diag_status;\n\tu32 error_offset;\n};\n\n \nstruct rndis_keepalive_request {\n\tu32 req_id;\n};\n\n \nstruct rndis_keepalive_complete {\n\tu32 req_id;\n\tu32 status;\n};\n\n \nstruct rndis_packet {\n\tu32 data_offset;\n\tu32 data_len;\n\tu32 oob_data_offset;\n\tu32 oob_data_len;\n\tu32 num_oob_data_elements;\n\tu32 per_pkt_info_offset;\n\tu32 per_pkt_info_len;\n\tu32 vc_handle;\n\tu32 reserved;\n};\n\n \nstruct rndis_oobd {\n\tu32 size;\n\tu32 type;\n\tu32 class_info_offset;\n};\n\n \nstruct rndis_per_packet_info {\n\tu32 size;\n\tu32 type:31;\n\tu32 internal:1;\n\tu32 ppi_offset;\n};\n\nenum ndis_per_pkt_info_type {\n\tTCPIP_CHKSUM_PKTINFO,\n\tIPSEC_PKTINFO,\n\tTCP_LARGESEND_PKTINFO,\n\tCLASSIFICATION_HANDLE_PKTINFO,\n\tNDIS_RESERVED,\n\tSG_LIST_PKTINFO,\n\tIEEE_8021Q_INFO,\n\tORIGINAL_PKTINFO,\n\tPACKET_CANCEL_ID,\n\tNBL_HASH_VALUE = PACKET_CANCEL_ID,\n\tORIGINAL_NET_BUFLIST,\n\tCACHED_NET_BUFLIST,\n\tSHORT_PKT_PADINFO,\n\tMAX_PER_PKT_INFO\n};\n\nenum rndis_per_pkt_info_interal_type {\n\tRNDIS_PKTINFO_ID = 1,\n\t \n\n\tRNDIS_PKTINFO_MAX\n};\n\n#define RNDIS_PKTINFO_SUBALLOC BIT(0)\n#define RNDIS_PKTINFO_1ST_FRAG BIT(1)\n#define RNDIS_PKTINFO_LAST_FRAG BIT(2)\n\n#define RNDIS_PKTINFO_ID_V1 1\n\nstruct rndis_pktinfo_id {\n\tu8 ver;\n\tu8 flag;\n\tu16 pkt_id;\n};\n\nstruct ndis_object_header {\n\tu8 type;\n\tu8 revision;\n\tu16 size;\n};\n\n#define NDIS_OBJECT_TYPE_DEFAULT\t0x80\n#define NDIS_OFFLOAD_PARAMETERS_REVISION_3 3\n#define NDIS_OFFLOAD_PARAMETERS_REVISION_2 2\n#define NDIS_OFFLOAD_PARAMETERS_REVISION_1 1\n\n#define NDIS_OFFLOAD_PARAMETERS_NO_CHANGE 0\n#define NDIS_OFFLOAD_PARAMETERS_LSOV2_DISABLED 1\n#define NDIS_OFFLOAD_PARAMETERS_LSOV2_ENABLED  2\n#define NDIS_OFFLOAD_PARAMETERS_LSOV1_ENABLED  2\n#define NDIS_OFFLOAD_PARAMETERS_RSC_DISABLED 1\n#define NDIS_OFFLOAD_PARAMETERS_RSC_ENABLED 2\n#define NDIS_OFFLOAD_PARAMETERS_TX_RX_DISABLED 1\n#define NDIS_OFFLOAD_PARAMETERS_TX_ENABLED_RX_DISABLED 2\n#define NDIS_OFFLOAD_PARAMETERS_RX_ENABLED_TX_DISABLED 3\n#define NDIS_OFFLOAD_PARAMETERS_TX_RX_ENABLED 4\n\n#define NDIS_TCP_LARGE_SEND_OFFLOAD_V2_TYPE\t1\n#define NDIS_TCP_LARGE_SEND_OFFLOAD_IPV4\t0\n#define NDIS_TCP_LARGE_SEND_OFFLOAD_IPV6\t1\n\n#define VERSION_4_OFFLOAD_SIZE\t\t\t22\n \n#define OID_TCP_OFFLOAD_CURRENT_CONFIG 0xFC01020B  \n#define OID_TCP_OFFLOAD_PARAMETERS 0xFC01020C\t\t \n#define OID_TCP_OFFLOAD_HARDWARE_CAPABILITIES 0xFC01020D \n#define OID_TCP_CONNECTION_OFFLOAD_CURRENT_CONFIG 0xFC01020E  \n#define OID_TCP_CONNECTION_OFFLOAD_HARDWARE_CAPABILITIES 0xFC01020F  \n#define OID_OFFLOAD_ENCAPSULATION 0x0101010A  \n\n \n\n#define\tNDIS_OFFLOAD_ENCAP_NONE\t\t0x0000\n#define\tNDIS_OFFLOAD_ENCAP_NULL\t\t0x0001\n#define\tNDIS_OFFLOAD_ENCAP_8023\t\t0x0002\n#define\tNDIS_OFFLOAD_ENCAP_8023PQ\t0x0004\n#define\tNDIS_OFFLOAD_ENCAP_8023PQ_OOB\t0x0008\n#define\tNDIS_OFFLOAD_ENCAP_RFC1483\t0x0010\n\nstruct ndis_csum_offload {\n\tu32\tip4_txenc;\n\tu32\tip4_txcsum;\n#define\tNDIS_TXCSUM_CAP_IP4OPT\t\t0x001\n#define\tNDIS_TXCSUM_CAP_TCP4OPT\t\t0x004\n#define\tNDIS_TXCSUM_CAP_TCP4\t\t0x010\n#define\tNDIS_TXCSUM_CAP_UDP4\t\t0x040\n#define\tNDIS_TXCSUM_CAP_IP4\t\t0x100\n\n#define NDIS_TXCSUM_ALL_TCP4\t(NDIS_TXCSUM_CAP_TCP4 | NDIS_TXCSUM_CAP_TCP4OPT)\n\n\tu32\tip4_rxenc;\n\tu32\tip4_rxcsum;\n#define\tNDIS_RXCSUM_CAP_IP4OPT\t\t0x001\n#define\tNDIS_RXCSUM_CAP_TCP4OPT\t\t0x004\n#define\tNDIS_RXCSUM_CAP_TCP4\t\t0x010\n#define\tNDIS_RXCSUM_CAP_UDP4\t\t0x040\n#define\tNDIS_RXCSUM_CAP_IP4\t\t0x100\n\tu32\tip6_txenc;\n\tu32\tip6_txcsum;\n#define\tNDIS_TXCSUM_CAP_IP6EXT\t\t0x001\n#define\tNDIS_TXCSUM_CAP_TCP6OPT\t\t0x004\n#define\tNDIS_TXCSUM_CAP_TCP6\t\t0x010\n#define\tNDIS_TXCSUM_CAP_UDP6\t\t0x040\n\tu32\tip6_rxenc;\n\tu32\tip6_rxcsum;\n#define\tNDIS_RXCSUM_CAP_IP6EXT\t\t0x001\n#define\tNDIS_RXCSUM_CAP_TCP6OPT\t\t0x004\n#define\tNDIS_RXCSUM_CAP_TCP6\t\t0x010\n#define\tNDIS_RXCSUM_CAP_UDP6\t\t0x040\n\n#define NDIS_TXCSUM_ALL_TCP6\t(NDIS_TXCSUM_CAP_TCP6 |\t\t\\\n\t\t\t\t NDIS_TXCSUM_CAP_TCP6OPT |\t\\\n\t\t\t\t NDIS_TXCSUM_CAP_IP6EXT)\n};\n\nstruct ndis_lsov1_offload {\n\tu32\tencap;\n\tu32\tmaxsize;\n\tu32\tminsegs;\n\tu32\topts;\n};\n\nstruct ndis_ipsecv1_offload {\n\tu32\tencap;\n\tu32\tah_esp;\n\tu32\txport_tun;\n\tu32\tip4_opts;\n\tu32\tflags;\n\tu32\tip4_ah;\n\tu32\tip4_esp;\n};\n\nstruct ndis_lsov2_offload {\n\tu32\tip4_encap;\n\tu32\tip4_maxsz;\n\tu32\tip4_minsg;\n\tu32\tip6_encap;\n\tu32\tip6_maxsz;\n\tu32\tip6_minsg;\n\tu32\tip6_opts;\n#define\tNDIS_LSOV2_CAP_IP6EXT\t\t0x001\n#define\tNDIS_LSOV2_CAP_TCP6OPT\t\t0x004\n\n#define NDIS_LSOV2_CAP_IP6\t\t(NDIS_LSOV2_CAP_IP6EXT | \\\n\t\t\t\t\t NDIS_LSOV2_CAP_TCP6OPT)\n};\n\nstruct ndis_ipsecv2_offload {\n\tu32\tencap;\n\tu8\tip6;\n\tu8\tip4opt;\n\tu8\tip6ext;\n\tu8\tah;\n\tu8\tesp;\n\tu8\tah_esp;\n\tu8\txport;\n\tu8\ttun;\n\tu8\txport_tun;\n\tu8\tlso;\n\tu8\textseq;\n\tu32\tudp_esp;\n\tu32\tauth;\n\tu32\tcrypto;\n\tu32\tsa_caps;\n};\n\nstruct ndis_rsc_offload {\n\tu8\tip4;\n\tu8\tip6;\n};\n\nstruct ndis_encap_offload {\n\tu32\tflags;\n\tu32\tmaxhdr;\n};\n\nstruct ndis_offload {\n\tstruct ndis_object_header\theader;\n\tstruct ndis_csum_offload\tcsum;\n\tstruct ndis_lsov1_offload\tlsov1;\n\tstruct ndis_ipsecv1_offload\tipsecv1;\n\tstruct ndis_lsov2_offload\tlsov2;\n\tu32\t\t\t\tflags;\n\t \n\tstruct ndis_ipsecv2_offload\tipsecv2;\n\t \n\tstruct ndis_rsc_offload\t\trsc;\n\tstruct ndis_encap_offload\tencap_gre;\n};\n\n#define\tNDIS_OFFLOAD_SIZE\t\tsizeof(struct ndis_offload)\n#define\tNDIS_OFFLOAD_SIZE_6_0\t\toffsetof(struct ndis_offload, ipsecv2)\n#define\tNDIS_OFFLOAD_SIZE_6_1\t\toffsetof(struct ndis_offload, rsc)\n\nstruct ndis_offload_params {\n\tstruct ndis_object_header header;\n\tu8 ip_v4_csum;\n\tu8 tcp_ip_v4_csum;\n\tu8 udp_ip_v4_csum;\n\tu8 tcp_ip_v6_csum;\n\tu8 udp_ip_v6_csum;\n\tu8 lso_v1;\n\tu8 ip_sec_v1;\n\tu8 lso_v2_ipv4;\n\tu8 lso_v2_ipv6;\n\tu8 tcp_connection_ip_v4;\n\tu8 tcp_connection_ip_v6;\n\tu32 flags;\n\tu8 ip_sec_v2;\n\tu8 ip_sec_v2_ip_v4;\n\tstruct {\n\t\tu8 rsc_ip_v4;\n\t\tu8 rsc_ip_v6;\n\t};\n\tstruct {\n\t\tu8 encapsulated_packet_task_offload;\n\t\tu8 encapsulation_types;\n\t};\n};\n\nstruct ndis_tcp_lso_info {\n\tunion {\n\t\tstruct {\n\t\t\tu32 unused:30;\n\t\t\tu32 type:1;\n\t\t\tu32 reserved2:1;\n\t\t} transmit;\n\t\tstruct {\n\t\t\tu32 mss:20;\n\t\t\tu32 tcp_header_offset:10;\n\t\t\tu32 type:1;\n\t\t\tu32 reserved2:1;\n\t\t} lso_v1_transmit;\n\t\tstruct {\n\t\t\tu32 tcp_payload:30;\n\t\t\tu32 type:1;\n\t\t\tu32 reserved2:1;\n\t\t} lso_v1_transmit_complete;\n\t\tstruct {\n\t\t\tu32 mss:20;\n\t\t\tu32 tcp_header_offset:10;\n\t\t\tu32 type:1;\n\t\t\tu32 ip_version:1;\n\t\t} lso_v2_transmit;\n\t\tstruct {\n\t\t\tu32 reserved:30;\n\t\t\tu32 type:1;\n\t\t\tu32 reserved2:1;\n\t\t} lso_v2_transmit_complete;\n\t\tu32  value;\n\t};\n};\n\n#define NDIS_VLAN_PPI_SIZE (sizeof(struct rndis_per_packet_info) + \\\n\t\tsizeof(struct ndis_pkt_8021q_info))\n\n#define NDIS_CSUM_PPI_SIZE (sizeof(struct rndis_per_packet_info) + \\\n\t\tsizeof(struct ndis_tcp_ip_checksum_info))\n\n#define NDIS_LSO_PPI_SIZE (sizeof(struct rndis_per_packet_info) + \\\n\t\tsizeof(struct ndis_tcp_lso_info))\n\n#define NDIS_HASH_PPI_SIZE (sizeof(struct rndis_per_packet_info) + \\\n\t\tsizeof(u32))\n\n \n#define NDIS_ALL_PPI_SIZE (NDIS_VLAN_PPI_SIZE + NDIS_CSUM_PPI_SIZE + \\\n\t\t\t   NDIS_LSO_PPI_SIZE + NDIS_HASH_PPI_SIZE)\n\n \n \nstruct rndis_config_parameter_info {\n\tu32 parameter_name_offset;\n\tu32 parameter_name_length;\n\tu32 parameter_type;\n\tu32 parameter_value_offset;\n\tu32 parameter_value_length;\n};\n\n \n#define RNDIS_CONFIG_PARAM_TYPE_INTEGER     0\n#define RNDIS_CONFIG_PARAM_TYPE_STRING      2\n\n \n \n\n \nstruct rcondis_mp_create_vc {\n\tu32 req_id;\n\tu32 ndis_vc_handle;\n};\n\n \nstruct rcondis_mp_create_vc_complete {\n\tu32 req_id;\n\tu32 dev_vc_handle;\n\tu32 status;\n};\n\n \nstruct rcondis_mp_delete_vc {\n\tu32 req_id;\n\tu32 dev_vc_handle;\n};\n\n \nstruct rcondis_mp_delete_vc_complete {\n\tu32 req_id;\n\tu32 status;\n};\n\n \nstruct rcondis_mp_query_request {\n\tu32 req_id;\n\tu32 request_type;\n\tu32 oid;\n\tu32 dev_vc_handle;\n\tu32 info_buflen;\n\tu32 info_buf_offset;\n};\n\n \nstruct rcondis_mp_set_request {\n\tu32 req_id;\n\tu32 request_type;\n\tu32 oid;\n\tu32 dev_vc_handle;\n\tu32 info_buflen;\n\tu32 info_buf_offset;\n};\n\n \nstruct rcondis_indicate_status {\n\tu32 ndis_vc_handle;\n\tu32 status;\n\tu32 status_buflen;\n\tu32 status_buf_offset;\n};\n\n \nstruct rcondis_specific_parameters {\n\tu32 parameter_type;\n\tu32 parameter_length;\n\tu32 parameter_lffset;\n};\n\nstruct rcondis_media_parameters {\n\tu32 flags;\n\tu32 reserved1;\n\tu32 reserved2;\n\tstruct rcondis_specific_parameters media_specific;\n};\n\nstruct rndis_flowspec {\n\tu32 token_rate;\n\tu32 token_bucket_size;\n\tu32 peak_bandwidth;\n\tu32 latency;\n\tu32 delay_variation;\n\tu32 service_type;\n\tu32 max_sdu_size;\n\tu32 minimum_policed_size;\n};\n\nstruct rcondis_call_manager_parameters {\n\tstruct rndis_flowspec transmit;\n\tstruct rndis_flowspec receive;\n\tstruct rcondis_specific_parameters call_mgr_specific;\n};\n\n \nstruct rcondis_mp_activate_vc_request {\n\tu32 req_id;\n\tu32 flags;\n\tu32 dev_vc_handle;\n\tu32 media_params_offset;\n\tu32 media_params_length;\n\tu32 call_mgr_params_offset;\n\tu32 call_mgr_params_length;\n};\n\n \nstruct rcondis_mp_activate_vc_complete {\n\tu32 req_id;\n\tu32 status;\n};\n\n \nstruct rcondis_mp_deactivate_vc_request {\n\tu32 req_id;\n\tu32 flags;\n\tu32 dev_vc_handle;\n};\n\n \nstruct rcondis_mp_deactivate_vc_complete {\n\tu32 req_id;\n\tu32 status;\n};\n\n\n \nunion rndis_message_container {\n\tstruct rndis_packet pkt;\n\tstruct rndis_initialize_request init_req;\n\tstruct rndis_halt_request halt_req;\n\tstruct rndis_query_request query_req;\n\tstruct rndis_set_request set_req;\n\tstruct rndis_reset_request reset_req;\n\tstruct rndis_keepalive_request keep_alive_req;\n\tstruct rndis_indicate_status indicate_status;\n\tstruct rndis_initialize_complete init_complete;\n\tstruct rndis_query_complete query_complete;\n\tstruct rndis_set_complete set_complete;\n\tstruct rndis_reset_complete reset_complete;\n\tstruct rndis_keepalive_complete keep_alive_complete;\n\tstruct rcondis_mp_create_vc co_miniport_create_vc;\n\tstruct rcondis_mp_delete_vc co_miniport_delete_vc;\n\tstruct rcondis_indicate_status co_indicate_status;\n\tstruct rcondis_mp_activate_vc_request co_miniport_activate_vc;\n\tstruct rcondis_mp_deactivate_vc_request co_miniport_deactivate_vc;\n\tstruct rcondis_mp_create_vc_complete co_miniport_create_vc_complete;\n\tstruct rcondis_mp_delete_vc_complete co_miniport_delete_vc_complete;\n\tstruct rcondis_mp_activate_vc_complete co_miniport_activate_vc_complete;\n\tstruct rcondis_mp_deactivate_vc_complete\n\t\tco_miniport_deactivate_vc_complete;\n};\n\n \nstruct rndis_message {\n\tu32 ndis_msg_type;\n\n\t \n\t \n\tu32 msg_len;\n\n\t \n\tunion rndis_message_container msg;\n};\n\n\n \n\n \n \n#define RNDIS_MESSAGE_SIZE(msg)\t\t\t\t\\\n\t(sizeof(msg) + (sizeof(struct rndis_message) -\t\\\n\t sizeof(union rndis_message_container)))\n\n#define RNDIS_HEADER_SIZE\t(sizeof(struct rndis_message) - \\\n\t\t\t\t sizeof(union rndis_message_container))\n\n#define RNDIS_AND_PPI_SIZE (sizeof(struct rndis_message) + NDIS_ALL_PPI_SIZE)\n\n#define NDIS_PACKET_TYPE_DIRECTED\t0x00000001\n#define NDIS_PACKET_TYPE_MULTICAST\t0x00000002\n#define NDIS_PACKET_TYPE_ALL_MULTICAST\t0x00000004\n#define NDIS_PACKET_TYPE_BROADCAST\t0x00000008\n#define NDIS_PACKET_TYPE_SOURCE_ROUTING\t0x00000010\n#define NDIS_PACKET_TYPE_PROMISCUOUS\t0x00000020\n#define NDIS_PACKET_TYPE_SMT\t\t0x00000040\n#define NDIS_PACKET_TYPE_ALL_LOCAL\t0x00000080\n#define NDIS_PACKET_TYPE_GROUP\t\t0x00000100\n#define NDIS_PACKET_TYPE_ALL_FUNCTIONAL\t0x00000200\n#define NDIS_PACKET_TYPE_FUNCTIONAL\t0x00000400\n#define NDIS_PACKET_TYPE_MAC_FRAME\t0x00000800\n\n#define TRANSPORT_INFO_NOT_IP   0\n#define TRANSPORT_INFO_IPV4_TCP 0x01\n#define TRANSPORT_INFO_IPV4_UDP 0x02\n#define TRANSPORT_INFO_IPV6_TCP 0x10\n#define TRANSPORT_INFO_IPV6_UDP 0x20\n\n#define RETRY_US_LO\t5000\n#define RETRY_US_HI\t10000\n#define RETRY_MAX\t2000\t \n\nvoid netvsc_dma_unmap(struct hv_device *hv_dev,\n\t\t      struct hv_netvsc_packet *packet);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}