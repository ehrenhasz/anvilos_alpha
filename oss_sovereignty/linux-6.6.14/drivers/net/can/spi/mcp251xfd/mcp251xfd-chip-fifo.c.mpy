{
  "module_name": "mcp251xfd-chip-fifo.c",
  "hash_id": "fbad57a674d5ee9abb57fe3adc737c4f11418c6b4fd1274f02107a301e018afa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/can/spi/mcp251xfd/mcp251xfd-chip-fifo.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n\n\n\n\n#include <linux/bitfield.h>\n\n#include \"mcp251xfd.h\"\n\nstatic int\nmcp251xfd_chip_rx_fifo_init_one(const struct mcp251xfd_priv *priv,\n\t\t\t\tconst struct mcp251xfd_rx_ring *ring)\n{\n\tu32 fifo_con;\n\n\t \n\tfifo_con = FIELD_PREP(MCP251XFD_REG_FIFOCON_FSIZE_MASK,\n\t\t\t      ring->obj_num - 1) |\n\t\tMCP251XFD_REG_FIFOCON_RXTSEN |\n\t\tMCP251XFD_REG_FIFOCON_RXOVIE |\n\t\tMCP251XFD_REG_FIFOCON_TFNRFNIE;\n\n\tif (mcp251xfd_is_fd_mode(priv))\n\t\tfifo_con |= FIELD_PREP(MCP251XFD_REG_FIFOCON_PLSIZE_MASK,\n\t\t\t\t       MCP251XFD_REG_FIFOCON_PLSIZE_64);\n\telse\n\t\tfifo_con |= FIELD_PREP(MCP251XFD_REG_FIFOCON_PLSIZE_MASK,\n\t\t\t\t       MCP251XFD_REG_FIFOCON_PLSIZE_8);\n\n\treturn regmap_write(priv->map_reg,\n\t\t\t    MCP251XFD_REG_FIFOCON(ring->fifo_nr), fifo_con);\n}\n\nstatic int\nmcp251xfd_chip_rx_filter_init_one(const struct mcp251xfd_priv *priv,\n\t\t\t\t  const struct mcp251xfd_rx_ring *ring)\n{\n\tu32 fltcon;\n\n\tfltcon = MCP251XFD_REG_FLTCON_FLTEN(ring->nr) |\n\t\tMCP251XFD_REG_FLTCON_FBP(ring->nr, ring->fifo_nr);\n\n\treturn regmap_update_bits(priv->map_reg,\n\t\t\t\t  MCP251XFD_REG_FLTCON(ring->nr >> 2),\n\t\t\t\t  MCP251XFD_REG_FLTCON_FLT_MASK(ring->nr),\n\t\t\t\t  fltcon);\n}\n\nint mcp251xfd_chip_fifo_init(const struct mcp251xfd_priv *priv)\n{\n\tconst struct mcp251xfd_tx_ring *tx_ring = priv->tx;\n\tconst struct mcp251xfd_rx_ring *rx_ring;\n\tu32 val;\n\tint err, n;\n\n\t \n\tval = FIELD_PREP(MCP251XFD_REG_TEFCON_FSIZE_MASK,\n\t\t\t tx_ring->obj_num - 1) |\n\t\tMCP251XFD_REG_TEFCON_TEFTSEN |\n\t\tMCP251XFD_REG_TEFCON_TEFOVIE |\n\t\tMCP251XFD_REG_TEFCON_TEFNEIE;\n\n\terr = regmap_write(priv->map_reg, MCP251XFD_REG_TEFCON, val);\n\tif (err)\n\t\treturn err;\n\n\t \n\tval = FIELD_PREP(MCP251XFD_REG_FIFOCON_FSIZE_MASK,\n\t\t\t tx_ring->obj_num - 1) |\n\t\tMCP251XFD_REG_FIFOCON_TXEN |\n\t\tMCP251XFD_REG_FIFOCON_TXATIE;\n\n\tif (mcp251xfd_is_fd_mode(priv))\n\t\tval |= FIELD_PREP(MCP251XFD_REG_FIFOCON_PLSIZE_MASK,\n\t\t\t\t  MCP251XFD_REG_FIFOCON_PLSIZE_64);\n\telse\n\t\tval |= FIELD_PREP(MCP251XFD_REG_FIFOCON_PLSIZE_MASK,\n\t\t\t\t  MCP251XFD_REG_FIFOCON_PLSIZE_8);\n\n\tif (priv->can.ctrlmode & CAN_CTRLMODE_ONE_SHOT)\n\t\tval |= FIELD_PREP(MCP251XFD_REG_FIFOCON_TXAT_MASK,\n\t\t\t\t  MCP251XFD_REG_FIFOCON_TXAT_ONE_SHOT);\n\telse\n\t\tval |= FIELD_PREP(MCP251XFD_REG_FIFOCON_TXAT_MASK,\n\t\t\t\t  MCP251XFD_REG_FIFOCON_TXAT_UNLIMITED);\n\n\terr = regmap_write(priv->map_reg,\n\t\t\t   MCP251XFD_REG_FIFOCON(priv->tx->fifo_nr),\n\t\t\t   val);\n\tif (err)\n\t\treturn err;\n\n\t \n\tmcp251xfd_for_each_rx_ring(priv, rx_ring, n) {\n\t\terr = mcp251xfd_chip_rx_fifo_init_one(priv, rx_ring);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\terr = mcp251xfd_chip_rx_filter_init_one(priv, rx_ring);\n\t\tif (err)\n\t\t\treturn err;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}