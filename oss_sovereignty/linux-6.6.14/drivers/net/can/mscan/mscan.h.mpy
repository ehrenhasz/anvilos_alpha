{
  "module_name": "mscan.h",
  "hash_id": "3011b0764dd27168b82d1f2e52ef77649e2e9a2cba9c7f4bc5d7c0f774ae07de",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/can/mscan/mscan.h",
  "human_readable_source": " \n \n\n#ifndef __MSCAN_H__\n#define __MSCAN_H__\n\n#include <linux/clk.h>\n#include <linux/types.h>\n\n \n#define MSCAN_RXFRM\t\t0x80\n#define MSCAN_RXACT\t\t0x40\n#define MSCAN_CSWAI\t\t0x20\n#define MSCAN_SYNCH\t\t0x10\n#define MSCAN_TIME\t\t0x08\n#define MSCAN_WUPE\t\t0x04\n#define MSCAN_SLPRQ\t\t0x02\n#define MSCAN_INITRQ\t\t0x01\n\n \n#define MSCAN_CANE\t\t0x80\n#define MSCAN_CLKSRC\t\t0x40\n#define MSCAN_LOOPB\t\t0x20\n#define MSCAN_LISTEN\t\t0x10\n#define MSCAN_BORM\t\t0x08\n#define MSCAN_WUPM\t\t0x04\n#define MSCAN_SLPAK\t\t0x02\n#define MSCAN_INITAK\t\t0x01\n\n \n#ifdef CONFIG_PPC\n#define MSCAN_FOR_MPC5XXX\n#endif\n\n#ifdef MSCAN_FOR_MPC5XXX\n#define MSCAN_CLKSRC_BUS\t0\n#define MSCAN_CLKSRC_XTAL\tMSCAN_CLKSRC\n#define MSCAN_CLKSRC_IPS\tMSCAN_CLKSRC\n#else\n#define MSCAN_CLKSRC_BUS\tMSCAN_CLKSRC\n#define MSCAN_CLKSRC_XTAL\t0\n#endif\n\n \n#define MSCAN_WUPIF\t\t0x80\n#define MSCAN_CSCIF\t\t0x40\n#define MSCAN_RSTAT1\t\t0x20\n#define MSCAN_RSTAT0\t\t0x10\n#define MSCAN_TSTAT1\t\t0x08\n#define MSCAN_TSTAT0\t\t0x04\n#define MSCAN_OVRIF\t\t0x02\n#define MSCAN_RXF\t\t0x01\n#define MSCAN_ERR_IF \t\t(MSCAN_OVRIF | MSCAN_CSCIF)\n#define MSCAN_RSTAT_MSK\t\t(MSCAN_RSTAT1 | MSCAN_RSTAT0)\n#define MSCAN_TSTAT_MSK\t\t(MSCAN_TSTAT1 | MSCAN_TSTAT0)\n#define MSCAN_STAT_MSK\t\t(MSCAN_RSTAT_MSK | MSCAN_TSTAT_MSK)\n\n#define MSCAN_STATE_BUS_OFF\t(MSCAN_RSTAT1 | MSCAN_RSTAT0 | \\\n\t\t\t\t MSCAN_TSTAT1 | MSCAN_TSTAT0)\n#define MSCAN_STATE_TX(canrflg)\t(((canrflg)&MSCAN_TSTAT_MSK)>>2)\n#define MSCAN_STATE_RX(canrflg)\t(((canrflg)&MSCAN_RSTAT_MSK)>>4)\n#define MSCAN_STATE_ACTIVE\t0\n#define MSCAN_STATE_WARNING\t1\n#define MSCAN_STATE_PASSIVE\t2\n#define MSCAN_STATE_BUSOFF\t3\n\n \n#define MSCAN_WUPIE\t\t0x80\n#define MSCAN_CSCIE\t\t0x40\n#define MSCAN_RSTATE1\t\t0x20\n#define MSCAN_RSTATE0\t\t0x10\n#define MSCAN_TSTATE1\t\t0x08\n#define MSCAN_TSTATE0\t\t0x04\n#define MSCAN_OVRIE\t\t0x02\n#define MSCAN_RXFIE\t\t0x01\n\n \n#define MSCAN_TXE2\t\t0x04\n#define MSCAN_TXE1\t\t0x02\n#define MSCAN_TXE0\t\t0x01\n#define MSCAN_TXE\t\t(MSCAN_TXE2 | MSCAN_TXE1 | MSCAN_TXE0)\n\n \n#define MSCAN_TXIE2\t\t0x04\n#define MSCAN_TXIE1\t\t0x02\n#define MSCAN_TXIE0\t\t0x01\n#define MSCAN_TXIE\t\t(MSCAN_TXIE2 | MSCAN_TXIE1 | MSCAN_TXIE0)\n\n \n#define MSCAN_ABTRQ2\t\t0x04\n#define MSCAN_ABTRQ1\t\t0x02\n#define MSCAN_ABTRQ0\t\t0x01\n\n \n#define MSCAN_ABTAK2\t\t0x04\n#define MSCAN_ABTAK1\t\t0x02\n#define MSCAN_ABTAK0\t\t0x01\n\n \n#define MSCAN_TX2\t\t0x04\n#define MSCAN_TX1\t\t0x02\n#define MSCAN_TX0\t\t0x01\n\n \n#define MSCAN_IDAM1\t\t0x20\n#define MSCAN_IDAM0\t\t0x10\n#define MSCAN_IDHIT2\t\t0x04\n#define MSCAN_IDHIT1\t\t0x02\n#define MSCAN_IDHIT0\t\t0x01\n\n#define MSCAN_AF_32BIT\t\t0x00\n#define MSCAN_AF_16BIT\t\tMSCAN_IDAM0\n#define MSCAN_AF_8BIT\t\tMSCAN_IDAM1\n#define MSCAN_AF_CLOSED\t\t(MSCAN_IDAM0|MSCAN_IDAM1)\n#define MSCAN_AF_MASK\t\t(~(MSCAN_IDAM0|MSCAN_IDAM1))\n\n \n#define MSCAN_BOHOLD\t\t0x01\n\n \n#define MSCAN_SFF_RTR_SHIFT\t4\n#define MSCAN_EFF_RTR_SHIFT\t0\n#define MSCAN_EFF_FLAGS\t\t0x18\t \n\n#ifdef MSCAN_FOR_MPC5XXX\n#define _MSCAN_RESERVED_(n, num) u8 _res##n[num]\n#define _MSCAN_RESERVED_DSR_SIZE\t2\n#else\n#define _MSCAN_RESERVED_(n, num)\n#define _MSCAN_RESERVED_DSR_SIZE\t0\n#endif\n\n \nstruct mscan_regs {\n\t \n\tu8 canctl0;\t\t\t\t \n\tu8 canctl1;\t\t\t\t \n\t_MSCAN_RESERVED_(1, 2);\t\t\t \n\tu8 canbtr0;\t\t\t\t \n\tu8 canbtr1;\t\t\t\t \n\t_MSCAN_RESERVED_(2, 2);\t\t\t \n\tu8 canrflg;\t\t\t\t \n\tu8 canrier;\t\t\t\t \n\t_MSCAN_RESERVED_(3, 2);\t\t\t \n\tu8 cantflg;\t\t\t\t \n\tu8 cantier;\t\t\t\t \n\t_MSCAN_RESERVED_(4, 2);\t\t\t \n\tu8 cantarq;\t\t\t\t \n\tu8 cantaak;\t\t\t\t \n\t_MSCAN_RESERVED_(5, 2);\t\t\t \n\tu8 cantbsel;\t\t\t\t \n\tu8 canidac;\t\t\t\t \n\tu8 reserved;\t\t\t\t \n\t_MSCAN_RESERVED_(6, 2);\t\t\t \n\tu8 canmisc;\t\t\t\t \n\t_MSCAN_RESERVED_(7, 2);\t\t\t \n\tu8 canrxerr;\t\t\t\t \n\tu8 cantxerr;\t\t\t\t \n\t_MSCAN_RESERVED_(8, 2);\t\t\t \n\tu16 canidar1_0;\t\t\t\t \n\t_MSCAN_RESERVED_(9, 2);\t\t\t \n\tu16 canidar3_2;\t\t\t\t \n\t_MSCAN_RESERVED_(10, 2);\t\t \n\tu16 canidmr1_0;\t\t\t\t \n\t_MSCAN_RESERVED_(11, 2);\t\t \n\tu16 canidmr3_2;\t\t\t\t \n\t_MSCAN_RESERVED_(12, 2);\t\t \n\tu16 canidar5_4;\t\t\t\t \n\t_MSCAN_RESERVED_(13, 2);\t\t \n\tu16 canidar7_6;\t\t\t\t \n\t_MSCAN_RESERVED_(14, 2);\t\t \n\tu16 canidmr5_4;\t\t\t\t \n\t_MSCAN_RESERVED_(15, 2);\t\t \n\tu16 canidmr7_6;\t\t\t\t \n\t_MSCAN_RESERVED_(16, 2);\t\t \n\tstruct {\n\t\tu16 idr1_0;\t\t\t \n\t\t_MSCAN_RESERVED_(17, 2);\t \n\t\tu16 idr3_2;\t\t\t \n\t\t_MSCAN_RESERVED_(18, 2);\t \n\t\tu16 dsr1_0;\t\t\t \n\t\t_MSCAN_RESERVED_(19, 2);\t \n\t\tu16 dsr3_2;\t\t\t \n\t\t_MSCAN_RESERVED_(20, 2);\t \n\t\tu16 dsr5_4;\t\t\t \n\t\t_MSCAN_RESERVED_(21, 2);\t \n\t\tu16 dsr7_6;\t\t\t \n\t\t_MSCAN_RESERVED_(22, 2);\t \n\t\tu8 dlr;\t\t\t\t \n\t\tu8 reserved;\t\t\t \n\t\t_MSCAN_RESERVED_(23, 2);\t \n\t\tu16 time;\t\t\t \n\t} rx;\n\t_MSCAN_RESERVED_(24, 2);\t\t \n\tstruct {\n\t\tu16 idr1_0;\t\t\t \n\t\t_MSCAN_RESERVED_(25, 2);\t \n\t\tu16 idr3_2;\t\t\t \n\t\t_MSCAN_RESERVED_(26, 2);\t \n\t\tu16 dsr1_0;\t\t\t \n\t\t_MSCAN_RESERVED_(27, 2);\t \n\t\tu16 dsr3_2;\t\t\t \n\t\t_MSCAN_RESERVED_(28, 2);\t \n\t\tu16 dsr5_4;\t\t\t \n\t\t_MSCAN_RESERVED_(29, 2);\t \n\t\tu16 dsr7_6;\t\t\t \n\t\t_MSCAN_RESERVED_(30, 2);\t \n\t\tu8 dlr;\t\t\t\t \n\t\tu8 tbpr;\t\t\t \n\t\t_MSCAN_RESERVED_(31, 2);\t \n\t\tu16 time;\t\t\t \n\t} tx;\n\t_MSCAN_RESERVED_(32, 2);\t\t \n} __packed;\n\n#undef _MSCAN_RESERVED_\n#define MSCAN_REGION \tsizeof(struct mscan)\n\n#define MSCAN_NORMAL_MODE\t0\n#define MSCAN_SLEEP_MODE\tMSCAN_SLPRQ\n#define MSCAN_INIT_MODE\t\t(MSCAN_INITRQ | MSCAN_SLPRQ)\n#define MSCAN_POWEROFF_MODE\t(MSCAN_CSWAI | MSCAN_SLPRQ)\n#define MSCAN_SET_MODE_RETRIES\t255\n#define MSCAN_ECHO_SKB_MAX\t3\n#define MSCAN_RX_INTS_ENABLE\t(MSCAN_OVRIE | MSCAN_RXFIE | MSCAN_CSCIE | \\\n\t\t\t\t MSCAN_RSTATE1 | MSCAN_RSTATE0 | \\\n\t\t\t\t MSCAN_TSTATE1 | MSCAN_TSTATE0)\n\n \nenum {\n\tMSCAN_TYPE_MPC5200,\n\tMSCAN_TYPE_MPC5121\n};\n\n#define BTR0_BRP_MASK\t\t0x3f\n#define BTR0_SJW_SHIFT\t\t6\n#define BTR0_SJW_MASK\t\t(0x3 << BTR0_SJW_SHIFT)\n\n#define BTR1_TSEG1_MASK \t0xf\n#define BTR1_TSEG2_SHIFT\t4\n#define BTR1_TSEG2_MASK \t(0x7 << BTR1_TSEG2_SHIFT)\n#define BTR1_SAM_SHIFT  \t7\n\n#define BTR0_SET_BRP(brp)\t(((brp) - 1) & BTR0_BRP_MASK)\n#define BTR0_SET_SJW(sjw)\t((((sjw) - 1) << BTR0_SJW_SHIFT) & \\\n\t\t\t\t BTR0_SJW_MASK)\n\n#define BTR1_SET_TSEG1(tseg1)\t(((tseg1) - 1) &  BTR1_TSEG1_MASK)\n#define BTR1_SET_TSEG2(tseg2)\t((((tseg2) - 1) << BTR1_TSEG2_SHIFT) & \\\n\t\t\t\t BTR1_TSEG2_MASK)\n#define BTR1_SET_SAM(sam)\t((sam) ? 1 << BTR1_SAM_SHIFT : 0)\n\n#define F_RX_PROGRESS\t0\n#define F_TX_PROGRESS\t1\n#define F_TX_WAIT_ALL\t2\n\n#define TX_QUEUE_SIZE\t3\n\nstruct tx_queue_entry {\n\tstruct list_head list;\n\tu8 mask;\n\tu8 id;\n};\n\nstruct mscan_priv {\n\tstruct can_priv can;\t \n\tunsigned int type; \t \n\tunsigned long flags;\n\tvoid __iomem *reg_base;\t \n\tstruct clk *clk_ipg;\t \n\tstruct clk *clk_can;\t \n\tu8 shadow_statflg;\n\tu8 shadow_canrier;\n\tu8 cur_pri;\n\tu8 prev_buf_id;\n\tu8 tx_active;\n\n\tstruct list_head tx_head;\n\tstruct tx_queue_entry tx_queue[TX_QUEUE_SIZE];\n\tstruct napi_struct napi;\n};\n\nstruct net_device *alloc_mscandev(void);\nint register_mscandev(struct net_device *dev, int mscan_clksrc);\nvoid unregister_mscandev(struct net_device *dev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}