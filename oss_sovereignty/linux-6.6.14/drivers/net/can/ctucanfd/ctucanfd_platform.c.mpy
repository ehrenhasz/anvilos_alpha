{
  "module_name": "ctucanfd_platform.c",
  "hash_id": "deb2d999e718b8d66c9137ec9b409c36f62e831c2781fc1624b92dbe0eb916ef",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/can/ctucanfd/ctucanfd_platform.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/netdevice.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n\n#include \"ctucanfd.h\"\n\n#define DRV_NAME\t\"ctucanfd\"\n\nstatic void ctucan_platform_set_drvdata(struct device *dev,\n\t\t\t\t\tstruct net_device *ndev)\n{\n\tstruct platform_device *pdev = container_of(dev, struct platform_device,\n\t\t\t\t\t\t    dev);\n\n\tplatform_set_drvdata(pdev, ndev);\n}\n\n \nstatic int ctucan_platform_probe(struct platform_device *pdev)\n{\n\tstruct device\t*dev = &pdev->dev;\n\tvoid __iomem *addr;\n\tint ret;\n\tunsigned int ntxbufs;\n\tint irq;\n\n\t \n\taddr = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(addr)) {\n\t\tret = PTR_ERR(addr);\n\t\tgoto err;\n\t}\n\tirq = platform_get_irq(pdev, 0);\n\tif (irq < 0) {\n\t\tret = irq;\n\t\tgoto err;\n\t}\n\n\t \n\tntxbufs = 4;\n\tret = ctucan_probe_common(dev, addr, irq, ntxbufs, 0,\n\t\t\t\t  1, ctucan_platform_set_drvdata);\n\n\tif (ret < 0)\n\t\tplatform_set_drvdata(pdev, NULL);\n\nerr:\n\treturn ret;\n}\n\n \nstatic void ctucan_platform_remove(struct platform_device *pdev)\n{\n\tstruct net_device *ndev = platform_get_drvdata(pdev);\n\tstruct ctucan_priv *priv = netdev_priv(ndev);\n\n\tnetdev_dbg(ndev, \"ctucan_remove\");\n\n\tunregister_candev(ndev);\n\tpm_runtime_disable(&pdev->dev);\n\tnetif_napi_del(&priv->napi);\n\tfree_candev(ndev);\n}\n\nstatic SIMPLE_DEV_PM_OPS(ctucan_platform_pm_ops, ctucan_suspend, ctucan_resume);\n\n \nstatic const struct of_device_id ctucan_of_match[] = {\n\t{ .compatible = \"ctu,ctucanfd-2\", },\n\t{ .compatible = \"ctu,ctucanfd\", },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, ctucan_of_match);\n\nstatic struct platform_driver ctucanfd_driver = {\n\t.probe\t= ctucan_platform_probe,\n\t.remove_new = ctucan_platform_remove,\n\t.driver\t= {\n\t\t.name = DRV_NAME,\n\t\t.pm = &ctucan_platform_pm_ops,\n\t\t.of_match_table\t= ctucan_of_match,\n\t},\n};\n\nmodule_platform_driver(ctucanfd_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Martin Jerabek\");\nMODULE_DESCRIPTION(\"CTU CAN FD for platform\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}