{
  "module_name": "flexcan-ethtool.c",
  "hash_id": "9b20ba9f1596815527185546c197d42e006c1ce404e8fc30415f80de1cf2deaf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/can/flexcan/flexcan-ethtool.c",
  "human_readable_source": "\n \n\n#include <linux/can/dev.h>\n#include <linux/ethtool.h>\n#include <linux/kernel.h>\n#include <linux/netdevice.h>\n#include <linux/platform_device.h>\n\n#include \"flexcan.h\"\n\nstatic const char flexcan_priv_flags_strings[][ETH_GSTRING_LEN] = {\n#define FLEXCAN_PRIV_FLAGS_RX_RTR BIT(0)\n\t\"rx-rtr\",\n};\n\nstatic void\nflexcan_get_ringparam(struct net_device *ndev, struct ethtool_ringparam *ring,\n\t\t      struct kernel_ethtool_ringparam *kernel_ring,\n\t\t      struct netlink_ext_ack *ext_ack)\n{\n\tconst struct flexcan_priv *priv = netdev_priv(ndev);\n\n\tring->rx_max_pending = priv->mb_count;\n\tring->tx_max_pending = priv->mb_count;\n\n\tif (priv->devtype_data.quirks & FLEXCAN_QUIRK_USE_RX_MAILBOX)\n\t\tring->rx_pending = priv->offload.mb_last -\n\t\t\tpriv->offload.mb_first + 1;\n\telse\n\t\tring->rx_pending = 6;\t \n\n\t \n\tring->tx_pending = 1;\n}\n\nstatic void\nflexcan_get_strings(struct net_device *ndev, u32 stringset, u8 *data)\n{\n\tswitch (stringset) {\n\tcase ETH_SS_PRIV_FLAGS:\n\t\tmemcpy(data, flexcan_priv_flags_strings,\n\t\t       sizeof(flexcan_priv_flags_strings));\n\t}\n}\n\nstatic u32 flexcan_get_priv_flags(struct net_device *ndev)\n{\n\tconst struct flexcan_priv *priv = netdev_priv(ndev);\n\tu32 priv_flags = 0;\n\n\tif (flexcan_active_rx_rtr(priv))\n\t\tpriv_flags |= FLEXCAN_PRIV_FLAGS_RX_RTR;\n\n\treturn priv_flags;\n}\n\nstatic int flexcan_set_priv_flags(struct net_device *ndev, u32 priv_flags)\n{\n\tstruct flexcan_priv *priv = netdev_priv(ndev);\n\tu32 quirks = priv->devtype_data.quirks;\n\n\tif (priv_flags & FLEXCAN_PRIV_FLAGS_RX_RTR) {\n\t\tif (flexcan_supports_rx_mailbox_rtr(priv))\n\t\t\tquirks |= FLEXCAN_QUIRK_USE_RX_MAILBOX;\n\t\telse if (flexcan_supports_rx_fifo(priv))\n\t\t\tquirks &= ~FLEXCAN_QUIRK_USE_RX_MAILBOX;\n\t\telse\n\t\t\tquirks |= FLEXCAN_QUIRK_USE_RX_MAILBOX;\n\t} else {\n\t\tif (flexcan_supports_rx_mailbox(priv))\n\t\t\tquirks |= FLEXCAN_QUIRK_USE_RX_MAILBOX;\n\t\telse\n\t\t\tquirks &= ~FLEXCAN_QUIRK_USE_RX_MAILBOX;\n\t}\n\n\tif (quirks != priv->devtype_data.quirks && netif_running(ndev))\n\t\treturn -EBUSY;\n\n\tpriv->devtype_data.quirks = quirks;\n\n\tif (!(priv_flags & FLEXCAN_PRIV_FLAGS_RX_RTR) &&\n\t    !flexcan_active_rx_rtr(priv))\n\t\tnetdev_info(ndev,\n\t\t\t    \"Activating RX mailbox mode, cannot receive RTR frames.\\n\");\n\n\treturn 0;\n}\n\nstatic int flexcan_get_sset_count(struct net_device *netdev, int sset)\n{\n\tswitch (sset) {\n\tcase ETH_SS_PRIV_FLAGS:\n\t\treturn ARRAY_SIZE(flexcan_priv_flags_strings);\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n\nconst struct ethtool_ops flexcan_ethtool_ops = {\n\t.get_ringparam = flexcan_get_ringparam,\n\t.get_strings = flexcan_get_strings,\n\t.get_priv_flags = flexcan_get_priv_flags,\n\t.set_priv_flags = flexcan_set_priv_flags,\n\t.get_sset_count = flexcan_get_sset_count,\n\t.get_ts_info = ethtool_op_get_ts_info,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}