{
  "module_name": "vmxnet3_int.h",
  "hash_id": "b5e2e463873b653e78dd39e215bf5fbcdd5cacbbd0f7e10efff39bfe99db3a20",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/vmxnet3/vmxnet3_int.h",
  "human_readable_source": " \n\n#ifndef _VMXNET3_INT_H\n#define _VMXNET3_INT_H\n\n#include <linux/bitops.h>\n#include <linux/ethtool.h>\n#include <linux/delay.h>\n#include <linux/netdevice.h>\n#include <linux/pci.h>\n#include <linux/compiler.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/ioport.h>\n#include <linux/highmem.h>\n#include <linux/timer.h>\n#include <linux/skbuff.h>\n#include <linux/interrupt.h>\n#include <linux/workqueue.h>\n#include <linux/uaccess.h>\n#include <asm/dma.h>\n#include <asm/page.h>\n\n#include <linux/tcp.h>\n#include <linux/udp.h>\n#include <linux/ip.h>\n#include <linux/ipv6.h>\n#include <linux/in.h>\n#include <linux/etherdevice.h>\n#include <asm/checksum.h>\n#include <linux/if_vlan.h>\n#include <linux/if_arp.h>\n#include <linux/inetdevice.h>\n#include <linux/log2.h>\n#include <linux/bpf.h>\n#include <net/page_pool/helpers.h>\n#include <net/xdp.h>\n\n#include \"vmxnet3_defs.h\"\n\n#ifdef DEBUG\n# define VMXNET3_DRIVER_VERSION_REPORT VMXNET3_DRIVER_VERSION_STRING\"-NAPI(debug)\"\n#else\n# define VMXNET3_DRIVER_VERSION_REPORT VMXNET3_DRIVER_VERSION_STRING\"-NAPI\"\n#endif\n\n\n \n#define VMXNET3_DRIVER_VERSION_STRING   \"1.7.0.0-k\"\n\n \n#define VMXNET3_DRIVER_VERSION_NUM      0x01070000\n\n#if defined(CONFIG_PCI_MSI)\n\t \n\t#define VMXNET3_RSS\n#endif\n\n#define VMXNET3_REV_7\t\t6\t \n#define VMXNET3_REV_6\t\t5\t \n#define VMXNET3_REV_5\t\t4\t \n#define VMXNET3_REV_4\t\t3\t \n#define VMXNET3_REV_3\t\t2\t \n#define VMXNET3_REV_2\t\t1\t \n#define VMXNET3_REV_1\t\t0\t \n\n \n\nenum {\n\tVMNET_CAP_SG\t        = 0x0001,  \n\tVMNET_CAP_IP4_CSUM      = 0x0002,  \n\tVMNET_CAP_HW_CSUM       = 0x0004,  \n\tVMNET_CAP_HIGH_DMA      = 0x0008,  \n\tVMNET_CAP_TOE\t        = 0x0010,  \n\tVMNET_CAP_TSO\t        = 0x0020,  \n\tVMNET_CAP_SW_TSO        = 0x0040,  \n\tVMNET_CAP_VMXNET_APROM  = 0x0080,  \n\tVMNET_CAP_HW_TX_VLAN    = 0x0100,  \n\tVMNET_CAP_HW_RX_VLAN    = 0x0200,  \n\tVMNET_CAP_SW_VLAN       = 0x0400,  \n\tVMNET_CAP_WAKE_PCKT_RCV = 0x0800,  \n\tVMNET_CAP_ENABLE_INT_INLINE = 0x1000,   \n\tVMNET_CAP_ENABLE_HEADER_COPY = 0x2000,   \n\tVMNET_CAP_TX_CHAIN      = 0x4000,  \n\tVMNET_CAP_RX_CHAIN      = 0x8000,  \n\tVMNET_CAP_LPD           = 0x10000,  \n\tVMNET_CAP_BPF           = 0x20000,  \n\tVMNET_CAP_SG_SPAN_PAGES = 0x40000,  \n\t\t\t\t\t    \n\tVMNET_CAP_IP6_CSUM      = 0x80000,  \n\tVMNET_CAP_TSO6         = 0x100000,  \n\tVMNET_CAP_TSO256k      = 0x200000,  \n\t\t\t\t\t    \n\tVMNET_CAP_UPT          = 0x400000   \n};\n\n \n#define MAX_ETHERNET_CARDS\t\t10\n#define MAX_PCI_PASSTHRU_DEVICE\t\t6\n\nstruct vmxnet3_cmd_ring {\n\tunion Vmxnet3_GenericDesc *base;\n\tu32\t\tsize;\n\tu32\t\tnext2fill;\n\tu32\t\tnext2comp;\n\tu8\t\tgen;\n\tu8              isOutOfOrder;\n\tdma_addr_t\tbasePA;\n};\n\nstatic inline void\nvmxnet3_cmd_ring_adv_next2fill(struct vmxnet3_cmd_ring *ring)\n{\n\tring->next2fill++;\n\tif (unlikely(ring->next2fill == ring->size)) {\n\t\tring->next2fill = 0;\n\t\tVMXNET3_FLIP_RING_GEN(ring->gen);\n\t}\n}\n\nstatic inline void\nvmxnet3_cmd_ring_adv_next2comp(struct vmxnet3_cmd_ring *ring)\n{\n\tVMXNET3_INC_RING_IDX_ONLY(ring->next2comp, ring->size);\n}\n\nstatic inline int\nvmxnet3_cmd_ring_desc_avail(struct vmxnet3_cmd_ring *ring)\n{\n\treturn (ring->next2comp > ring->next2fill ? 0 : ring->size) +\n\t\tring->next2comp - ring->next2fill - 1;\n}\n\nstruct vmxnet3_comp_ring {\n\tunion Vmxnet3_GenericDesc *base;\n\tu32               size;\n\tu32               next2proc;\n\tu8                gen;\n\tu8                intr_idx;\n\tdma_addr_t           basePA;\n};\n\nstatic inline void\nvmxnet3_comp_ring_adv_next2proc(struct vmxnet3_comp_ring *ring)\n{\n\tring->next2proc++;\n\tif (unlikely(ring->next2proc == ring->size)) {\n\t\tring->next2proc = 0;\n\t\tVMXNET3_FLIP_RING_GEN(ring->gen);\n\t}\n}\n\nstruct vmxnet3_tx_data_ring {\n\tstruct Vmxnet3_TxDataDesc *base;\n\tu32              size;\n\tdma_addr_t          basePA;\n};\n\n#define VMXNET3_MAP_NONE\t0\n#define VMXNET3_MAP_SINGLE\tBIT(0)\n#define VMXNET3_MAP_PAGE\tBIT(1)\n#define VMXNET3_MAP_XDP\t\tBIT(2)\n\nstruct vmxnet3_tx_buf_info {\n\tu32      map_type;\n\tu16      len;\n\tu16      sop_idx;\n\tdma_addr_t  dma_addr;\n\tunion {\n\t\tstruct sk_buff *skb;\n\t\tstruct xdp_frame *xdpf;\n\t};\n};\n\nstruct vmxnet3_tq_driver_stats {\n\tu64 drop_total;      \n\tu64 drop_too_many_frags;\n\tu64 drop_oversized_hdr;\n\tu64 drop_hdr_inspect_err;\n\tu64 drop_tso;\n\n\tu64 tx_ring_full;\n\tu64 linearized;          \n\tu64 copy_skb_header;     \n\tu64 oversized_hdr;\n\n\tu64 xdp_xmit;\n\tu64 xdp_xmit_err;\n};\n\nstruct vmxnet3_tx_ctx {\n\tbool   ipv4;\n\tbool   ipv6;\n\tu16 mss;\n\tu32    l4_offset;\t \n\n\tu32\tl4_hdr_size;\t \n\tu32 copy_size;        \n\tunion Vmxnet3_GenericDesc *sop_txd;\n\tunion Vmxnet3_GenericDesc *eop_txd;\n};\n\nstruct vmxnet3_tx_queue {\n\tchar\t\t\tname[IFNAMSIZ+8];  \n\tstruct vmxnet3_adapter\t\t*adapter;\n\tspinlock_t                      tx_lock;\n\tstruct vmxnet3_cmd_ring         tx_ring;\n\tstruct vmxnet3_tx_buf_info      *buf_info;\n\tstruct vmxnet3_tx_data_ring     data_ring;\n\tstruct vmxnet3_comp_ring        comp_ring;\n\tstruct Vmxnet3_TxQueueCtrl      *shared;\n\tstruct vmxnet3_tq_driver_stats  stats;\n\tbool                            stopped;\n\tint                             num_stop;   \n\tint\t\t\t\tqid;\n\tu16\t\t\t\ttxdata_desc_size;\n} ____cacheline_aligned;\n\nenum vmxnet3_rx_buf_type {\n\tVMXNET3_RX_BUF_NONE = 0,\n\tVMXNET3_RX_BUF_SKB = 1,\n\tVMXNET3_RX_BUF_PAGE = 2,\n\tVMXNET3_RX_BUF_XDP = 3,\n};\n\n#define VMXNET3_RXD_COMP_PENDING        0\n#define VMXNET3_RXD_COMP_DONE           1\n\nstruct vmxnet3_rx_buf_info {\n\tenum vmxnet3_rx_buf_type buf_type;\n\tu16     len;\n\tu8      comp_state;\n\tunion {\n\t\tstruct sk_buff *skb;\n\t\tstruct page    *page;\n\t};\n\tdma_addr_t dma_addr;\n};\n\nstruct vmxnet3_rx_ctx {\n\tstruct sk_buff *skb;\n\tu32 sop_idx;\n};\n\nstruct vmxnet3_rq_driver_stats {\n\tu64 drop_total;\n\tu64 drop_err;\n\tu64 drop_fcs;\n\tu64 rx_buf_alloc_failure;\n\n\tu64 xdp_packets;\t \n\tu64 xdp_tx;\n\tu64 xdp_redirects;\n\tu64 xdp_drops;\n\tu64 xdp_aborted;\n};\n\nstruct vmxnet3_rx_data_ring {\n\tVmxnet3_RxDataDesc *base;\n\tdma_addr_t basePA;\n\tu16 desc_size;\n};\n\nstruct vmxnet3_rx_queue {\n\tchar\t\t\tname[IFNAMSIZ + 8];  \n\tstruct vmxnet3_adapter\t  *adapter;\n\tstruct napi_struct        napi;\n\tstruct vmxnet3_cmd_ring   rx_ring[2];\n\tstruct vmxnet3_rx_data_ring data_ring;\n\tstruct vmxnet3_comp_ring  comp_ring;\n\tstruct vmxnet3_rx_ctx     rx_ctx;\n\tu32 qid;             \n\tu32 qid2;            \n\tu32 dataRingQid;     \n\tstruct vmxnet3_rx_buf_info     *buf_info[2];\n\tstruct Vmxnet3_RxQueueCtrl            *shared;\n\tstruct vmxnet3_rq_driver_stats  stats;\n\tstruct page_pool *page_pool;\n\tstruct xdp_rxq_info xdp_rxq;\n} ____cacheline_aligned;\n\n#define VMXNET3_DEVICE_MAX_TX_QUEUES 32\n#define VMXNET3_DEVICE_MAX_RX_QUEUES 32    \n\n#define VMXNET3_DEVICE_DEFAULT_TX_QUEUES 8\n#define VMXNET3_DEVICE_DEFAULT_RX_QUEUES 8    \n\n \n#define VMXNET3_RSS_IND_TABLE_SIZE (VMXNET3_DEVICE_MAX_RX_QUEUES * 4)\n\n#define VMXNET3_LINUX_MAX_MSIX_VECT     (VMXNET3_DEVICE_MAX_TX_QUEUES + \\\n\t\t\t\t\t VMXNET3_DEVICE_MAX_RX_QUEUES + 1)\n#define VMXNET3_LINUX_MIN_MSIX_VECT     3  \n\n\nstruct vmxnet3_intr {\n\tenum vmxnet3_intr_mask_mode  mask_mode;\n\tenum vmxnet3_intr_type       type;\t \n\tu8  num_intrs;\t\t\t \n\tu8  event_intr_idx;\t\t \n\tu8  mod_levels[VMXNET3_LINUX_MAX_MSIX_VECT];  \n\tchar\tevent_msi_vector_name[IFNAMSIZ+17];\n#ifdef CONFIG_PCI_MSI\n\tstruct msix_entry msix_entries[VMXNET3_LINUX_MAX_MSIX_VECT];\n#endif\n};\n\n \n#define VMXNET3_INTR_BUDDYSHARE 0     \n#define VMXNET3_INTR_TXSHARE 1\t      \n#define VMXNET3_INTR_DONTSHARE 2      \n\n\n#define VMXNET3_STATE_BIT_RESETTING   0\n#define VMXNET3_STATE_BIT_QUIESCED    1\nstruct vmxnet3_adapter {\n\tstruct vmxnet3_tx_queue\t\ttx_queue[VMXNET3_DEVICE_MAX_TX_QUEUES];\n\tstruct vmxnet3_rx_queue\t\trx_queue[VMXNET3_DEVICE_MAX_RX_QUEUES];\n\tunsigned long\t\t\tactive_vlans[BITS_TO_LONGS(VLAN_N_VID)];\n\tstruct vmxnet3_intr\t\tintr;\n\tspinlock_t\t\t\tcmd_lock;\n\tstruct Vmxnet3_DriverShared\t*shared;\n\tstruct Vmxnet3_PMConf\t\t*pm_conf;\n\tstruct Vmxnet3_TxQueueDesc\t*tqd_start;      \n\tstruct Vmxnet3_RxQueueDesc\t*rqd_start;\t \n\tstruct net_device\t\t*netdev;\n\tstruct pci_dev\t\t\t*pdev;\n\n\tu8\t\t\t__iomem *hw_addr0;  \n\tu8\t\t\t__iomem *hw_addr1;  \n\tu8                              version;\n\n#ifdef VMXNET3_RSS\n\tstruct UPT1_RSSConf\t\t*rss_conf;\n\tbool\t\t\t\trss;\n#endif\n\tu32\t\t\t\tnum_rx_queues;\n\tu32\t\t\t\tnum_tx_queues;\n\n\t \n\tunsigned\t\t\tskb_buf_size;\n\tint\t\trx_buf_per_pkt;   \n\tdma_addr_t\t\t\tshared_pa;\n\tdma_addr_t queue_desc_pa;\n\tdma_addr_t coal_conf_pa;\n\n\t \n\tu32     wol;\n\n\t \n\tu32     link_speed;  \n\n\tu64     tx_timeout_count;\n\n\t \n\tu32 tx_ring_size;\n\tu32 rx_ring_size;\n\tu32 rx_ring2_size;\n\n\t \n\tu16 txdata_desc_size;\n\tu16 rxdata_desc_size;\n\n\tbool rxdataring_enabled;\n\tbool default_rss_fields;\n\tenum Vmxnet3_RSSField rss_fields;\n\n\tstruct work_struct work;\n\n\tunsigned long  state;     \n\n\tint share_intr;\n\n\tstruct Vmxnet3_CoalesceScheme *coal_conf;\n\tbool   default_coal_mode;\n\n\tdma_addr_t adapter_pa;\n\tdma_addr_t pm_conf_pa;\n\tdma_addr_t rss_conf_pa;\n\tbool   queuesExtEnabled;\n\tstruct Vmxnet3_RingBufferSize     ringBufSize;\n\tu32    devcap_supported[8];\n\tu32    ptcap_supported[8];\n\tu32    dev_caps[8];\n\tu16    tx_prod_offset;\n\tu16    rx_prod_offset;\n\tu16    rx_prod2_offset;\n\tstruct bpf_prog __rcu *xdp_bpf_prog;\n};\n\n#define VMXNET3_WRITE_BAR0_REG(adapter, reg, val)  \\\n\twritel((val), (adapter)->hw_addr0 + (reg))\n#define VMXNET3_READ_BAR0_REG(adapter, reg)        \\\n\treadl((adapter)->hw_addr0 + (reg))\n\n#define VMXNET3_WRITE_BAR1_REG(adapter, reg, val)  \\\n\twritel((val), (adapter)->hw_addr1 + (reg))\n#define VMXNET3_READ_BAR1_REG(adapter, reg)        \\\n\treadl((adapter)->hw_addr1 + (reg))\n\n#define VMXNET3_WAKE_QUEUE_THRESHOLD(tq)  (5)\n#define VMXNET3_RX_ALLOC_THRESHOLD(rq, ring_idx, adapter) \\\n\t((rq)->rx_ring[ring_idx].size >> 3)\n\n#define VMXNET3_GET_ADDR_LO(dma)   ((u32)(dma))\n#define VMXNET3_GET_ADDR_HI(dma)   ((u32)(((u64)(dma)) >> 32))\n\n#define VMXNET3_VERSION_GE_2(adapter) \\\n\t(adapter->version >= VMXNET3_REV_2 + 1)\n#define VMXNET3_VERSION_GE_3(adapter) \\\n\t(adapter->version >= VMXNET3_REV_3 + 1)\n#define VMXNET3_VERSION_GE_4(adapter) \\\n\t(adapter->version >= VMXNET3_REV_4 + 1)\n#define VMXNET3_VERSION_GE_5(adapter) \\\n\t(adapter->version >= VMXNET3_REV_5 + 1)\n#define VMXNET3_VERSION_GE_6(adapter) \\\n\t(adapter->version >= VMXNET3_REV_6 + 1)\n#define VMXNET3_VERSION_GE_7(adapter) \\\n\t(adapter->version >= VMXNET3_REV_7 + 1)\n\n \n#define VMXNET3_DEF_TX_RING_SIZE    512\n#define VMXNET3_DEF_RX_RING_SIZE    1024\n#define VMXNET3_DEF_RX_RING2_SIZE   512\n\n#define VMXNET3_DEF_RXDATA_DESC_SIZE 128\n\n#define VMXNET3_MAX_ETH_HDR_SIZE    22\n#define VMXNET3_MAX_SKB_BUF_SIZE    (3*1024)\n\n#define VMXNET3_GET_RING_IDX(adapter, rqID)\t\t\\\n\t((rqID >= adapter->num_rx_queues &&\t\t\\\n\t rqID < 2 * adapter->num_rx_queues) ? 1 : 0)\t\\\n\n#define VMXNET3_RX_DATA_RING(adapter, rqID)\t\t\\\n\t(rqID >= 2 * adapter->num_rx_queues &&\t\t\\\n\trqID < 3 * adapter->num_rx_queues)\t\t\\\n\n#define VMXNET3_COAL_STATIC_DEFAULT_DEPTH\t64\n\n#define VMXNET3_COAL_RBC_RATE(usecs) (1000000 / usecs)\n#define VMXNET3_COAL_RBC_USECS(rbc_rate) (1000000 / rbc_rate)\n#define VMXNET3_RSS_FIELDS_DEFAULT (VMXNET3_RSS_FIELDS_TCPIP4 | \\\n\t\t\t\t    VMXNET3_RSS_FIELDS_TCPIP6)\n\nint\nvmxnet3_quiesce_dev(struct vmxnet3_adapter *adapter);\n\nint\nvmxnet3_activate_dev(struct vmxnet3_adapter *adapter);\n\nvoid\nvmxnet3_force_close(struct vmxnet3_adapter *adapter);\n\nvoid\nvmxnet3_reset_dev(struct vmxnet3_adapter *adapter);\n\nvoid\nvmxnet3_tq_destroy_all(struct vmxnet3_adapter *adapter);\n\nvoid\nvmxnet3_rq_destroy_all(struct vmxnet3_adapter *adapter);\n\nint\nvmxnet3_rq_create_all(struct vmxnet3_adapter *adapter);\n\nvoid\nvmxnet3_adjust_rx_ring_size(struct vmxnet3_adapter *adapter);\n\nnetdev_features_t\nvmxnet3_fix_features(struct net_device *netdev, netdev_features_t features);\n\nnetdev_features_t\nvmxnet3_features_check(struct sk_buff *skb,\n\t\t       struct net_device *netdev, netdev_features_t features);\n\nint\nvmxnet3_set_features(struct net_device *netdev, netdev_features_t features);\n\nint\nvmxnet3_create_queues(struct vmxnet3_adapter *adapter,\n\t\t      u32 tx_ring_size, u32 rx_ring_size, u32 rx_ring2_size,\n\t\t      u16 txdata_desc_size, u16 rxdata_desc_size);\n\nvoid vmxnet3_set_ethtool_ops(struct net_device *netdev);\n\nvoid vmxnet3_get_stats64(struct net_device *dev,\n\t\t\t struct rtnl_link_stats64 *stats);\nbool vmxnet3_check_ptcapability(u32 cap_supported, u32 cap);\n\nextern char vmxnet3_driver_name[];\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}