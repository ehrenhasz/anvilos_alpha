{
  "module_name": "ipa_sysfs.c",
  "hash_id": "cbcaa4ad4c88517ce993e245f7eeca39b16c98cdd2240cb8e058de257c8165d4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ipa/ipa_sysfs.c",
  "human_readable_source": "\n\n \n\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/device.h>\n#include <linux/sysfs.h>\n\n#include \"ipa.h\"\n#include \"ipa_version.h\"\n#include \"ipa_sysfs.h\"\n\nstatic const char *ipa_version_string(struct ipa *ipa)\n{\n\tswitch (ipa->version) {\n\tcase IPA_VERSION_3_0:\n\t\treturn \"3.0\";\n\tcase IPA_VERSION_3_1:\n\t\treturn \"3.1\";\n\tcase IPA_VERSION_3_5:\n\t\treturn \"3.5\";\n\tcase IPA_VERSION_3_5_1:\n\t\treturn \"3.5.1\";\n\tcase IPA_VERSION_4_0:\n\t\treturn \"4.0\";\n\tcase IPA_VERSION_4_1:\n\t\treturn \"4.1\";\n\tcase IPA_VERSION_4_2:\n\t\treturn \"4.2\";\n\tcase IPA_VERSION_4_5:\n\t\treturn \"4.5\";\n\tcase IPA_VERSION_4_7:\n\t\treturn \"4.7\";\n\tcase IPA_VERSION_4_9:\n\t\treturn \"4.9\";\n\tcase IPA_VERSION_4_11:\n\t\treturn \"4.11\";\n\tcase IPA_VERSION_5_0:\n\t\treturn \"5.0\";\n\tdefault:\n\t\treturn \"0.0\";\t \n\t}\n}\n\nstatic ssize_t\nversion_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\tstruct ipa *ipa = dev_get_drvdata(dev);\n\n\treturn sysfs_emit(buf, \"%s\\n\", ipa_version_string(ipa));\n}\n\nstatic DEVICE_ATTR_RO(version);\n\nstatic struct attribute *ipa_attrs[] = {\n\t&dev_attr_version.attr,\n\tNULL\n};\n\nconst struct attribute_group ipa_attribute_group = {\n\t.attrs\t\t= ipa_attrs,\n};\n\nstatic const char *ipa_offload_string(struct ipa *ipa)\n{\n\treturn ipa->version < IPA_VERSION_4_5 ? \"MAPv4\" : \"MAPv5\";\n}\n\nstatic ssize_t rx_offload_show(struct device *dev,\n\t\t\t       struct device_attribute *attr, char *buf)\n{\n\tstruct ipa *ipa = dev_get_drvdata(dev);\n\n\treturn sysfs_emit(buf, \"%s\\n\", ipa_offload_string(ipa));\n}\n\nstatic DEVICE_ATTR_RO(rx_offload);\n\nstatic ssize_t tx_offload_show(struct device *dev,\n\t\t\t       struct device_attribute *attr, char *buf)\n{\n\tstruct ipa *ipa = dev_get_drvdata(dev);\n\n\treturn sysfs_emit(buf, \"%s\\n\", ipa_offload_string(ipa));\n}\n\nstatic DEVICE_ATTR_RO(tx_offload);\n\nstatic struct attribute *ipa_feature_attrs[] = {\n\t&dev_attr_rx_offload.attr,\n\t&dev_attr_tx_offload.attr,\n\tNULL\n};\n\nconst struct attribute_group ipa_feature_attribute_group = {\n\t.name\t\t= \"feature\",\n\t.attrs\t\t= ipa_feature_attrs,\n};\n\nstatic umode_t ipa_endpoint_id_is_visible(struct kobject *kobj,\n\t\t\t\t\t  struct attribute *attr, int n)\n{\n\tstruct ipa *ipa = dev_get_drvdata(kobj_to_dev(kobj));\n\tstruct device_attribute *dev_attr;\n\tstruct dev_ext_attribute *ea;\n\tbool visible;\n\n\t \n\tdev_attr = container_of(attr, struct device_attribute, attr);\n\tea = container_of(dev_attr, struct dev_ext_attribute, attr);\n\n\tvisible = !!ipa->name_map[(enum ipa_endpoint_name)(uintptr_t)ea->var];\n\n\treturn visible ? attr->mode : 0;\n}\n\nstatic ssize_t endpoint_id_attr_show(struct device *dev,\n\t\t\t\t     struct device_attribute *attr, char *buf)\n{\n\tstruct ipa *ipa = dev_get_drvdata(dev);\n\tstruct ipa_endpoint *endpoint;\n\tstruct dev_ext_attribute *ea;\n\n\tea = container_of(attr, struct dev_ext_attribute, attr);\n\tendpoint = ipa->name_map[(enum ipa_endpoint_name)(uintptr_t)ea->var];\n\n\treturn sysfs_emit(buf, \"%u\\n\", endpoint->endpoint_id);\n}\n\n#define ENDPOINT_ID_ATTR(_n, _endpoint_name)\t\t\t\t    \\\n\tstatic struct dev_ext_attribute dev_attr_endpoint_id_ ## _n = {\t    \\\n\t\t.attr\t= __ATTR(_n, 0444, endpoint_id_attr_show, NULL),    \\\n\t\t.var\t= (void *)(_endpoint_name),\t\t\t    \\\n\t}\n\nENDPOINT_ID_ATTR(modem_rx, IPA_ENDPOINT_AP_MODEM_RX);\nENDPOINT_ID_ATTR(modem_tx, IPA_ENDPOINT_AP_MODEM_TX);\n\nstatic struct attribute *ipa_endpoint_id_attrs[] = {\n\t&dev_attr_endpoint_id_modem_rx.attr.attr,\n\t&dev_attr_endpoint_id_modem_tx.attr.attr,\n\tNULL\n};\n\nconst struct attribute_group ipa_endpoint_id_attribute_group = {\n\t.name\t\t= \"endpoint_id\",\n\t.is_visible\t= ipa_endpoint_id_is_visible,\n\t.attrs\t\t= ipa_endpoint_id_attrs,\n};\n\n \n#define MODEM_ATTR(_n, _endpoint_name)\t\t\t\t\t    \\\n\tstatic struct dev_ext_attribute dev_attr_modem_ ## _n = {\t    \\\n\t\t.attr\t= __ATTR(_n, 0444, endpoint_id_attr_show, NULL),    \\\n\t\t.var\t= (void *)(_endpoint_name),\t\t\t    \\\n\t}\n\nMODEM_ATTR(rx_endpoint_id, IPA_ENDPOINT_AP_MODEM_RX);\nMODEM_ATTR(tx_endpoint_id, IPA_ENDPOINT_AP_MODEM_TX);\n\nstatic struct attribute *ipa_modem_attrs[] = {\n\t&dev_attr_modem_rx_endpoint_id.attr.attr,\n\t&dev_attr_modem_tx_endpoint_id.attr.attr,\n\tNULL,\n};\n\nconst struct attribute_group ipa_modem_attribute_group = {\n\t.name\t\t= \"modem\",\n\t.attrs\t\t= ipa_modem_attrs,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}