{
  "module_name": "ipa_reg.c",
  "hash_id": "c542651597da8c44304a2af8d81ce15787b538a9f79963e905a79e7d246f0bae",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ipa/ipa_reg.c",
  "human_readable_source": "\n\n \n\n#include <linux/io.h>\n\n#include \"ipa.h\"\n#include \"ipa_reg.h\"\n\n \nstatic bool ipa_reg_id_valid(struct ipa *ipa, enum ipa_reg_id reg_id)\n{\n\tenum ipa_version version = ipa->version;\n\n\tswitch (reg_id) {\n\tcase FILT_ROUT_HASH_EN:\n\t\treturn version == IPA_VERSION_4_2;\n\n\tcase FILT_ROUT_HASH_FLUSH:\n\t\treturn version < IPA_VERSION_5_0 && version != IPA_VERSION_4_2;\n\n\tcase FILT_ROUT_CACHE_FLUSH:\n\tcase ENDP_FILTER_CACHE_CFG:\n\tcase ENDP_ROUTER_CACHE_CFG:\n\t\treturn version >= IPA_VERSION_5_0;\n\n\tcase IPA_BCR:\n\tcase COUNTER_CFG:\n\t\treturn version < IPA_VERSION_4_5;\n\n\tcase IPA_TX_CFG:\n\tcase FLAVOR_0:\n\tcase IDLE_INDICATION_CFG:\n\t\treturn version >= IPA_VERSION_3_5;\n\n\tcase QTIME_TIMESTAMP_CFG:\n\tcase TIMERS_XO_CLK_DIV_CFG:\n\tcase TIMERS_PULSE_GRAN_CFG:\n\t\treturn version >= IPA_VERSION_4_5;\n\n\tcase SRC_RSRC_GRP_45_RSRC_TYPE:\n\tcase DST_RSRC_GRP_45_RSRC_TYPE:\n\t\treturn version <= IPA_VERSION_3_1 ||\n\t\t       version == IPA_VERSION_4_5 ||\n\t\t       version == IPA_VERSION_5_0;\n\n\tcase SRC_RSRC_GRP_67_RSRC_TYPE:\n\tcase DST_RSRC_GRP_67_RSRC_TYPE:\n\t\treturn version <= IPA_VERSION_3_1 ||\n\t\t       version == IPA_VERSION_5_0;\n\n\tcase ENDP_FILTER_ROUTER_HSH_CFG:\n\t\treturn version < IPA_VERSION_5_0 &&\n\t\t\tversion != IPA_VERSION_4_2;\n\n\tcase IRQ_SUSPEND_EN:\n\tcase IRQ_SUSPEND_CLR:\n\t\treturn version >= IPA_VERSION_3_1;\n\n\tcase COMP_CFG:\n\tcase CLKON_CFG:\n\tcase ROUTE:\n\tcase SHARED_MEM_SIZE:\n\tcase QSB_MAX_WRITES:\n\tcase QSB_MAX_READS:\n\tcase STATE_AGGR_ACTIVE:\n\tcase LOCAL_PKT_PROC_CNTXT:\n\tcase AGGR_FORCE_CLOSE:\n\tcase SRC_RSRC_GRP_01_RSRC_TYPE:\n\tcase SRC_RSRC_GRP_23_RSRC_TYPE:\n\tcase DST_RSRC_GRP_01_RSRC_TYPE:\n\tcase DST_RSRC_GRP_23_RSRC_TYPE:\n\tcase ENDP_INIT_CTRL:\n\tcase ENDP_INIT_CFG:\n\tcase ENDP_INIT_NAT:\n\tcase ENDP_INIT_HDR:\n\tcase ENDP_INIT_HDR_EXT:\n\tcase ENDP_INIT_HDR_METADATA_MASK:\n\tcase ENDP_INIT_MODE:\n\tcase ENDP_INIT_AGGR:\n\tcase ENDP_INIT_HOL_BLOCK_EN:\n\tcase ENDP_INIT_HOL_BLOCK_TIMER:\n\tcase ENDP_INIT_DEAGGR:\n\tcase ENDP_INIT_RSRC_GRP:\n\tcase ENDP_INIT_SEQ:\n\tcase ENDP_STATUS:\n\tcase IPA_IRQ_STTS:\n\tcase IPA_IRQ_EN:\n\tcase IPA_IRQ_CLR:\n\tcase IPA_IRQ_UC:\n\tcase IRQ_SUSPEND_INFO:\n\t\treturn true;\t \n\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nconst struct reg *ipa_reg(struct ipa *ipa, enum ipa_reg_id reg_id)\n{\n\tif (WARN(!ipa_reg_id_valid(ipa, reg_id), \"invalid reg %u\\n\", reg_id))\n\t\treturn NULL;\n\n\treturn reg(ipa->regs, reg_id);\n}\n\nstatic const struct regs *ipa_regs(enum ipa_version version)\n{\n\tswitch (version) {\n\tcase IPA_VERSION_3_1:\n\t\treturn &ipa_regs_v3_1;\n\tcase IPA_VERSION_3_5_1:\n\t\treturn &ipa_regs_v3_5_1;\n\tcase IPA_VERSION_4_2:\n\t\treturn &ipa_regs_v4_2;\n\tcase IPA_VERSION_4_5:\n\t\treturn &ipa_regs_v4_5;\n\tcase IPA_VERSION_4_7:\n\t\treturn &ipa_regs_v4_7;\n\tcase IPA_VERSION_4_9:\n\t\treturn &ipa_regs_v4_9;\n\tcase IPA_VERSION_4_11:\n\t\treturn &ipa_regs_v4_11;\n\tcase IPA_VERSION_5_0:\n\t\treturn &ipa_regs_v5_0;\n\tdefault:\n\t\treturn NULL;\n\t}\n}\n\nint ipa_reg_init(struct ipa *ipa)\n{\n\tstruct device *dev = &ipa->pdev->dev;\n\tconst struct regs *regs;\n\tstruct resource *res;\n\n\tregs = ipa_regs(ipa->version);\n\tif (!regs)\n\t\treturn -EINVAL;\n\n\tif (WARN_ON(regs->reg_count > IPA_REG_ID_COUNT))\n\t\treturn -EINVAL;\n\n\t \n\tres = platform_get_resource_byname(ipa->pdev, IORESOURCE_MEM,\n\t\t\t\t\t   \"ipa-reg\");\n\tif (!res) {\n\t\tdev_err(dev, \"DT error getting \\\"ipa-reg\\\" memory property\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tipa->reg_virt = ioremap(res->start, resource_size(res));\n\tif (!ipa->reg_virt) {\n\t\tdev_err(dev, \"unable to remap \\\"ipa-reg\\\" memory\\n\");\n\t\treturn -ENOMEM;\n\t}\n\tipa->regs = regs;\n\n\treturn 0;\n}\n\nvoid ipa_reg_exit(struct ipa *ipa)\n{\n\tiounmap(ipa->reg_virt);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}