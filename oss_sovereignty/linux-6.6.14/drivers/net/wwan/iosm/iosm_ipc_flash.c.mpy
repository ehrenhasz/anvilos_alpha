{
  "module_name": "iosm_ipc_flash.c",
  "hash_id": "72c95754d9d98549dcbfcb48663e2c2049aae824e5323f464f8206c4920b6242",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wwan/iosm/iosm_ipc_flash.c",
  "human_readable_source": "\n \n\n#include \"iosm_ipc_coredump.h\"\n#include \"iosm_ipc_devlink.h\"\n#include \"iosm_ipc_flash.h\"\n\n \nstatic int ipc_flash_proc_format_ebl_pack(struct iosm_flash_data *flash_req,\n\t\t\t\t\t  u32 pack_length, u16 pack_id,\n\t\t\t\t\t  u8 *payload, u32 payload_length)\n{\n\tu16 checksum = pack_id;\n\tu32 i;\n\n\tif (payload_length + IOSM_EBL_HEAD_SIZE > pack_length)\n\t\treturn -EINVAL;\n\n\tflash_req->pack_id = cpu_to_le16(pack_id);\n\tflash_req->msg_length = cpu_to_le32(payload_length);\n\tchecksum += (payload_length >> IOSM_EBL_PAYL_SHIFT) +\n\t\t     (payload_length & IOSM_EBL_CKSM);\n\n\tfor (i = 0; i < payload_length; i++)\n\t\tchecksum += payload[i];\n\n\tflash_req->checksum = cpu_to_le16(checksum);\n\n\treturn 0;\n}\n\n \nstatic int ipc_flash_proc_check_ebl_rsp(void *hdr_rsp, void *payload_rsp)\n{\n\tstruct iosm_ebl_error  *err_info = payload_rsp;\n\tu16 *rsp_code = hdr_rsp;\n\tu32 i;\n\n\tif (*rsp_code == IOSM_EBL_RSP_BUFF) {\n\t\tfor (i = 0; i < IOSM_MAX_ERRORS; i++) {\n\t\t\tif (!err_info->error[i].error_code) {\n\t\t\t\tpr_err(\"EBL: error_class = %d, error_code = %d\",\n\t\t\t\t       err_info->error[i].error_class,\n\t\t\t\t       err_info->error[i].error_code);\n\t\t\t}\n\t\t}\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int ipc_flash_send_data(struct iosm_devlink *ipc_devlink, u32 size,\n\t\t\t       u16 pack_id, u8 *payload, u32 payload_length)\n{\n\tstruct iosm_flash_data flash_req;\n\tint ret;\n\n\tret = ipc_flash_proc_format_ebl_pack(&flash_req, size,\n\t\t\t\t\t     pack_id, payload, payload_length);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL2 pack failed for pack_id:%d\",\n\t\t\tpack_id);\n\t\tgoto ipc_free_payload;\n\t}\n\n\tret = ipc_imem_sys_devlink_write(ipc_devlink, (u8 *)&flash_req,\n\t\t\t\t\t IOSM_EBL_HEAD_SIZE);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL Header write failed for Id:%x\",\n\t\t\tpack_id);\n\t\tgoto ipc_free_payload;\n\t}\n\n\tret = ipc_imem_sys_devlink_write(ipc_devlink, payload, payload_length);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL Payload write failed for Id:%x\",\n\t\t\tpack_id);\n\t}\n\nipc_free_payload:\n\treturn ret;\n}\n\n \nint ipc_flash_link_establish(struct iosm_imem *ipc_imem)\n{\n\tu8 ler_data[IOSM_LER_RSP_SIZE];\n\tu32 bytes_read;\n\n\t \n\tipc_imem->ipc_devlink->devlink_sio.channel =\n\t\t\t\t\tipc_imem_sys_devlink_open(ipc_imem);\n\n\tif (!ipc_imem->ipc_devlink->devlink_sio.channel)\n\t\tgoto chl_open_fail;\n\n\tif (ipc_imem_sys_devlink_read(ipc_imem->ipc_devlink, ler_data,\n\t\t\t\t      IOSM_LER_RSP_SIZE, &bytes_read))\n\t\tgoto devlink_read_fail;\n\n\tif (bytes_read != IOSM_LER_RSP_SIZE)\n\t\tgoto devlink_read_fail;\n\n\treturn 0;\n\ndevlink_read_fail:\n\tipc_imem_sys_devlink_close(ipc_imem->ipc_devlink);\nchl_open_fail:\n\treturn -EIO;\n}\n\n \nstatic int ipc_flash_receive_data(struct iosm_devlink *ipc_devlink, u32 size,\n\t\t\t\t  u8 *mdm_rsp)\n{\n\tu8 mdm_rsp_hdr[IOSM_EBL_HEAD_SIZE];\n\tu32 bytes_read;\n\tint ret;\n\n\tret = ipc_imem_sys_devlink_read(ipc_devlink, mdm_rsp_hdr,\n\t\t\t\t\tIOSM_EBL_HEAD_SIZE, &bytes_read);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL rsp to read %d bytes failed\",\n\t\t\tIOSM_EBL_HEAD_SIZE);\n\t\tgoto ipc_flash_recv_err;\n\t}\n\n\tif (bytes_read != IOSM_EBL_HEAD_SIZE) {\n\t\tret = -EINVAL;\n\t\tgoto ipc_flash_recv_err;\n\t}\n\n\tret = ipc_imem_sys_devlink_read(ipc_devlink, mdm_rsp, size,\n\t\t\t\t\t&bytes_read);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL rsp to read %d bytes failed\",\n\t\t\tsize);\n\t\tgoto ipc_flash_recv_err;\n\t}\n\n\tif (bytes_read != size) {\n\t\tret = -EINVAL;\n\t\tgoto ipc_flash_recv_err;\n\t}\n\n\tret = ipc_flash_proc_check_ebl_rsp(mdm_rsp_hdr + 2, mdm_rsp);\n\nipc_flash_recv_err:\n\treturn ret;\n}\n\n \nstatic int ipc_flash_send_receive(struct iosm_devlink *ipc_devlink, u16 pack_id,\n\t\t\t\t  u8 *payload, u32 payload_length, u8 *mdm_rsp)\n{\n\tsize_t frame_len = IOSM_EBL_DW_PACK_SIZE;\n\tint ret;\n\n\tif (pack_id == FLASH_SET_PROT_CONF)\n\t\tframe_len = IOSM_EBL_W_PACK_SIZE;\n\n\tret = ipc_flash_send_data(ipc_devlink, frame_len, pack_id, payload,\n\t\t\t\t  payload_length);\n\tif (ret)\n\t\tgoto ipc_flash_send_rcv;\n\n\tret = ipc_flash_receive_data(ipc_devlink,\n\t\t\t\t     frame_len - IOSM_EBL_HEAD_SIZE, mdm_rsp);\n\nipc_flash_send_rcv:\n\treturn ret;\n}\n\n \nint ipc_flash_boot_set_capabilities(struct iosm_devlink *ipc_devlink,\n\t\t\t\t    u8 *mdm_rsp)\n{\n\tipc_devlink->ebl_ctx.ebl_sw_info_version =\n\t\t\tipc_devlink->ebl_ctx.m_ebl_resp[EBL_RSP_SW_INFO_VER];\n\tipc_devlink->ebl_ctx.m_ebl_resp[EBL_SKIP_ERASE] = IOSM_CAP_NOT_ENHANCED;\n\tipc_devlink->ebl_ctx.m_ebl_resp[EBL_SKIP_CRC] = IOSM_CAP_NOT_ENHANCED;\n\n\tif (ipc_devlink->ebl_ctx.m_ebl_resp[EBL_CAPS_FLAG] &\n\t\t\t\t\t\t\tIOSM_CAP_USE_EXT_CAP) {\n\t\tif (ipc_devlink->param.erase_full_flash)\n\t\t\tipc_devlink->ebl_ctx.m_ebl_resp[EBL_OOS_CONFIG] &=\n\t\t\t\t~((u8)IOSM_EXT_CAP_ERASE_ALL);\n\t\telse\n\t\t\tipc_devlink->ebl_ctx.m_ebl_resp[EBL_OOS_CONFIG] &=\n\t\t\t\t~((u8)IOSM_EXT_CAP_COMMIT_ALL);\n\t\tipc_devlink->ebl_ctx.m_ebl_resp[EBL_EXT_CAPS_HANDLED] =\n\t\t\t\tIOSM_CAP_USE_EXT_CAP;\n\t}\n\n\t \n\treturn ipc_flash_send_receive(ipc_devlink, FLASH_SET_PROT_CONF,\n\t\t\t\t     ipc_devlink->ebl_ctx.m_ebl_resp,\n\t\t\t\t     IOSM_EBL_RSP_SIZE, mdm_rsp);\n}\n\n \nint ipc_flash_read_swid(struct iosm_devlink *ipc_devlink, u8 *mdm_rsp)\n{\n\tstruct iosm_flash_msg_control cmd_msg;\n\tstruct iosm_swid_table *swid;\n\tchar ebl_swid[IOSM_SWID_STR];\n\tint ret;\n\n\tif (ipc_devlink->ebl_ctx.ebl_sw_info_version !=\n\t\t\tIOSM_EXT_CAP_SWID_OOS_PACK)\n\t\treturn -EINVAL;\n\n\tcmd_msg.action = cpu_to_le32(FLASH_OOSC_ACTION_READ);\n\tcmd_msg.type = cpu_to_le32(FLASH_OOSC_TYPE_SWID_TABLE);\n\tcmd_msg.length = cpu_to_le32(IOSM_MSG_LEN_ARG);\n\tcmd_msg.arguments = cpu_to_le32(IOSM_MSG_LEN_ARG);\n\n\tret = ipc_flash_send_receive(ipc_devlink, FLASH_OOS_CONTROL,\n\t\t\t\t     (u8 *)&cmd_msg, IOSM_MDM_SEND_16, mdm_rsp);\n\tif (ret)\n\t\tgoto ipc_swid_err;\n\n\tcmd_msg.action = cpu_to_le32(*((u32 *)mdm_rsp));\n\n\tret = ipc_flash_send_receive(ipc_devlink, FLASH_OOS_DATA_READ,\n\t\t\t\t     (u8 *)&cmd_msg, IOSM_MDM_SEND_4, mdm_rsp);\n\tif (ret)\n\t\tgoto ipc_swid_err;\n\n\tswid = (struct iosm_swid_table *)mdm_rsp;\n\tdev_dbg(ipc_devlink->dev, \"SWID %x RF_ENGINE_ID %x\", swid->sw_id_val,\n\t\tswid->rf_engine_id_val);\n\n\tsnprintf(ebl_swid, sizeof(ebl_swid), \"SWID: %x, RF_ENGINE_ID: %x\",\n\t\t swid->sw_id_val, swid->rf_engine_id_val);\n\n\tdevlink_flash_update_status_notify(ipc_devlink->devlink_ctx, ebl_swid,\n\t\t\t\t\t   NULL, 0, 0);\nipc_swid_err:\n\treturn ret;\n}\n\n \nstatic int ipc_flash_erase_check(struct iosm_devlink *ipc_devlink, u8 *mdm_rsp)\n{\n\tint ret, count = 0;\n\tu16 mdm_rsp_data;\n\n\t \n\tdo {\n\t\tmdm_rsp_data = IOSM_MDM_SEND_DATA;\n\t\tret = ipc_flash_send_receive(ipc_devlink, FLASH_ERASE_CHECK,\n\t\t\t\t\t     (u8 *)&mdm_rsp_data,\n\t\t\t\t\t     IOSM_MDM_SEND_2, mdm_rsp);\n\t\tif (ret)\n\t\t\tgoto ipc_erase_chk_err;\n\n\t\tmdm_rsp_data = *((u16 *)mdm_rsp);\n\t\tif (mdm_rsp_data > IOSM_MDM_ERASE_RSP) {\n\t\t\tdev_err(ipc_devlink->dev,\n\t\t\t\t\"Flash Erase Check resp wrong 0x%04X\",\n\t\t\t\tmdm_rsp_data);\n\t\t\tret = -EINVAL;\n\t\t\tgoto ipc_erase_chk_err;\n\t\t}\n\t\tcount++;\n\t\tmsleep(IOSM_FLASH_ERASE_CHECK_INTERVAL);\n\t} while ((mdm_rsp_data != IOSM_MDM_ERASE_RSP) &&\n\t\t(count < (IOSM_FLASH_ERASE_CHECK_TIMEOUT /\n\t\tIOSM_FLASH_ERASE_CHECK_INTERVAL)));\n\n\tif (mdm_rsp_data != IOSM_MDM_ERASE_RSP) {\n\t\tdev_err(ipc_devlink->dev, \"Modem erase check timeout failure!\");\n\t\tret = -ETIMEDOUT;\n\t}\n\nipc_erase_chk_err:\n\treturn ret;\n}\n\n \nstatic int ipc_flash_full_erase(struct iosm_devlink *ipc_devlink, u8 *mdm_rsp)\n{\n\tu32 erase_address = IOSM_ERASE_START_ADDR;\n\tstruct iosm_flash_msg_control cmd_msg;\n\tu32 erase_length = IOSM_ERASE_LEN;\n\tint ret;\n\n\tdev_dbg(ipc_devlink->dev, \"Erase full nand flash\");\n\tcmd_msg.action = cpu_to_le32(FLASH_OOSC_ACTION_ERASE);\n\tcmd_msg.type = cpu_to_le32(FLASH_OOSC_TYPE_ALL_FLASH);\n\tcmd_msg.length = cpu_to_le32(erase_length);\n\tcmd_msg.arguments = cpu_to_le32(erase_address);\n\n\tret = ipc_flash_send_receive(ipc_devlink, FLASH_OOS_CONTROL,\n\t\t\t\t     (unsigned char *)&cmd_msg,\n\t\t\t\t     IOSM_MDM_SEND_16, mdm_rsp);\n\tif (ret)\n\t\tgoto ipc_flash_erase_err;\n\n\tipc_devlink->param.erase_full_flash_done = IOSM_SET_FLAG;\n\tret = ipc_flash_erase_check(ipc_devlink, mdm_rsp);\n\nipc_flash_erase_err:\n\treturn ret;\n}\n\n \nstatic int ipc_flash_download_region(struct iosm_devlink *ipc_devlink,\n\t\t\t\t     const struct firmware *fw, u8 *mdm_rsp)\n{\n\tu32 raw_len, rest_len = fw->size - IOSM_DEVLINK_HDR_SIZE;\n\tstruct iosm_devlink_image *fls_data;\n\t__le32 reg_info[2];  \n\tu32 nand_address;\n\tchar *file_ptr;\n\tint ret;\n\n\tfls_data = (struct iosm_devlink_image *)fw->data;\n\tfile_ptr = (void *)(fls_data + 1);\n\tnand_address = le32_to_cpu(fls_data->region_address);\n\treg_info[0] = cpu_to_le32(nand_address);\n\n\tif (!ipc_devlink->param.erase_full_flash_done) {\n\t\treg_info[1] = cpu_to_le32(nand_address + rest_len - 2);\n\t\tret = ipc_flash_send_receive(ipc_devlink, FLASH_ERASE_START,\n\t\t\t\t\t     (u8 *)reg_info, IOSM_MDM_SEND_8,\n\t\t\t\t\t     mdm_rsp);\n\t\tif (ret)\n\t\t\tgoto dl_region_fail;\n\n\t\tret = ipc_flash_erase_check(ipc_devlink, mdm_rsp);\n\t\tif (ret)\n\t\t\tgoto dl_region_fail;\n\t}\n\n\t \n\tret = ipc_flash_send_receive(ipc_devlink, FLASH_SET_ADDRESS,\n\t\t\t\t     (u8 *)reg_info, IOSM_MDM_SEND_4, mdm_rsp);\n\tif (ret)\n\t\tgoto dl_region_fail;\n\n\t \n\tret = ipc_flash_send_data(ipc_devlink, IOSM_EBL_DW_PACK_SIZE,\n\t\t\t\t  FLASH_WRITE_IMAGE_RAW, (u8 *)&rest_len,\n\t\t\t\t  IOSM_MDM_SEND_4);\n\tif (ret)\n\t\tgoto dl_region_fail;\n\n\tdo {\n\t\traw_len = (rest_len > IOSM_FLS_BUF_SIZE) ? IOSM_FLS_BUF_SIZE :\n\t\t\t\trest_len;\n\t\tret = ipc_imem_sys_devlink_write(ipc_devlink, file_ptr,\n\t\t\t\t\t\t raw_len);\n\t\tif (ret) {\n\t\t\tdev_err(ipc_devlink->dev, \"Image write failed\");\n\t\t\tgoto dl_region_fail;\n\t\t}\n\t\tfile_ptr += raw_len;\n\t\trest_len -= raw_len;\n\t} while (rest_len);\n\n\tret = ipc_flash_receive_data(ipc_devlink, IOSM_EBL_DW_PAYL_SIZE,\n\t\t\t\t     mdm_rsp);\n\ndl_region_fail:\n\treturn ret;\n}\n\n \nint ipc_flash_send_fls(struct iosm_devlink *ipc_devlink,\n\t\t       const struct firmware *fw, u8 *mdm_rsp)\n{\n\tu32 fw_size = fw->size - IOSM_DEVLINK_HDR_SIZE;\n\tstruct iosm_devlink_image *fls_data;\n\tu16 flash_cmd;\n\tint ret;\n\n\tfls_data = (struct iosm_devlink_image *)fw->data;\n\tif (ipc_devlink->param.erase_full_flash) {\n\t\tipc_devlink->param.erase_full_flash = false;\n\t\tret = ipc_flash_full_erase(ipc_devlink, mdm_rsp);\n\t\tif (ret)\n\t\t\tgoto ipc_flash_err;\n\t}\n\n\t \n\tif (!fls_data->download_region) {\n\t\tret = ipc_flash_send_receive(ipc_devlink, FLASH_SEC_START,\n\t\t\t\t\t     (u8 *)fw->data +\n\t\t\t\t\t     IOSM_DEVLINK_HDR_SIZE, fw_size,\n\t\t\t\t\t     mdm_rsp);\n\t\tif (ret)\n\t\t\tgoto ipc_flash_err;\n\t} else {\n\t\t \n\t\tret = ipc_flash_download_region(ipc_devlink, fw, mdm_rsp);\n\t\tif (ret)\n\t\t\tgoto ipc_flash_err;\n\n\t\tif (fls_data->last_region) {\n\t\t\t \n\t\t\tflash_cmd = IOSM_MDM_SEND_DATA;\n\t\t\tret = ipc_flash_send_receive(ipc_devlink, FLASH_SEC_END,\n\t\t\t\t\t\t     (u8 *)&flash_cmd,\n\t\t\t\t\t\t     IOSM_MDM_SEND_2, mdm_rsp);\n\t\t}\n\t}\n\nipc_flash_err:\n\treturn ret;\n}\n\n \nint ipc_flash_boot_psi(struct iosm_devlink *ipc_devlink,\n\t\t       const struct firmware *fw)\n{\n\tu32 bytes_read, psi_size = fw->size - IOSM_DEVLINK_HDR_SIZE;\n\tu8 psi_ack_byte[IOSM_PSI_ACK], read_data[2];\n\tu8 *psi_code;\n\tint ret;\n\n\tdev_dbg(ipc_devlink->dev, \"Boot transfer PSI\");\n\tpsi_code = kmemdup(fw->data + IOSM_DEVLINK_HDR_SIZE, psi_size,\n\t\t\t   GFP_KERNEL);\n\tif (!psi_code)\n\t\treturn -ENOMEM;\n\n\tret = ipc_imem_sys_devlink_write(ipc_devlink, psi_code, psi_size);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"RPSI Image write failed\");\n\t\tgoto ipc_flash_psi_free;\n\t}\n\n\tret = ipc_imem_sys_devlink_read(ipc_devlink, read_data,\n\t\t\t\t\tIOSM_LER_ACK_SIZE, &bytes_read);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"ipc_devlink_sio_read ACK failed\");\n\t\tgoto ipc_flash_psi_free;\n\t}\n\n\tif (bytes_read != IOSM_LER_ACK_SIZE) {\n\t\tret = -EINVAL;\n\t\tgoto ipc_flash_psi_free;\n\t}\n\n\tsnprintf(psi_ack_byte, sizeof(psi_ack_byte), \"%x%x\", read_data[0],\n\t\t read_data[1]);\n\tdevlink_flash_update_status_notify(ipc_devlink->devlink_ctx,\n\t\t\t\t\t   psi_ack_byte, \"PSI ACK\", 0, 0);\n\n\tif (read_data[0] == 0x00 && read_data[1] == 0xCD) {\n\t\tdev_dbg(ipc_devlink->dev, \"Coredump detected\");\n\t\tret = ipc_coredump_get_list(ipc_devlink,\n\t\t\t\t\t    rpsi_cmd_coredump_start);\n\t\tif (ret)\n\t\t\tdev_err(ipc_devlink->dev, \"Failed to get cd list\");\n\t}\n\nipc_flash_psi_free:\n\tkfree(psi_code);\n\treturn ret;\n}\n\n \nint ipc_flash_boot_ebl(struct iosm_devlink *ipc_devlink,\n\t\t       const struct firmware *fw)\n{\n\tu32 ebl_size = fw->size - IOSM_DEVLINK_HDR_SIZE;\n\tu8 read_data[2];\n\tu32 bytes_read;\n\tint ret;\n\n\tif (ipc_mmio_get_exec_stage(ipc_devlink->pcie->imem->mmio) !=\n\t\t\t\t    IPC_MEM_EXEC_STAGE_PSI) {\n\t\tdevlink_flash_update_status_notify(ipc_devlink->devlink_ctx,\n\t\t\t\t\t\t   \"Invalid execution stage\",\n\t\t\t\t\t\t   NULL, 0, 0);\n\t\treturn -EINVAL;\n\t}\n\n\tdev_dbg(ipc_devlink->dev, \"Boot transfer EBL\");\n\tret = ipc_devlink_send_cmd(ipc_devlink, rpsi_cmd_code_ebl,\n\t\t\t\t   IOSM_RPSI_LOAD_SIZE);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"Sending rpsi_cmd_code_ebl failed\");\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tret = ipc_imem_sys_devlink_read(ipc_devlink, read_data, IOSM_READ_SIZE,\n\t\t\t\t\t&bytes_read);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"rpsi_cmd_code_ebl read failed\");\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tif (bytes_read != IOSM_READ_SIZE) {\n\t\tret = -EINVAL;\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tret = ipc_imem_sys_devlink_write(ipc_devlink, (u8 *)&ebl_size,\n\t\t\t\t\t sizeof(ebl_size));\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL length write failed\");\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tret = ipc_imem_sys_devlink_read(ipc_devlink, read_data, IOSM_READ_SIZE,\n\t\t\t\t\t&bytes_read);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL read failed\");\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tif (bytes_read != IOSM_READ_SIZE) {\n\t\tret = -EINVAL;\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tret = ipc_imem_sys_devlink_write(ipc_devlink,\n\t\t\t\t\t (u8 *)fw->data + IOSM_DEVLINK_HDR_SIZE,\n\t\t\t\t\t ebl_size);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL data transfer failed\");\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tret = ipc_imem_sys_devlink_read(ipc_devlink, read_data, IOSM_READ_SIZE,\n\t\t\t\t\t&bytes_read);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL read failed\");\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tif (bytes_read != IOSM_READ_SIZE) {\n\t\tret = -EINVAL;\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tret = ipc_imem_sys_devlink_read(ipc_devlink,\n\t\t\t\t\tipc_devlink->ebl_ctx.m_ebl_resp,\n\t\t\t\t\tIOSM_EBL_RSP_SIZE, &bytes_read);\n\tif (ret) {\n\t\tdev_err(ipc_devlink->dev, \"EBL response read failed\");\n\t\tgoto ipc_flash_ebl_err;\n\t}\n\n\tif (bytes_read != IOSM_EBL_RSP_SIZE)\n\t\tret = -EINVAL;\n\nipc_flash_ebl_err:\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}