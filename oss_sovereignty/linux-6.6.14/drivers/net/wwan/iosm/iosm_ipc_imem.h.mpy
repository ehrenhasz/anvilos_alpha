{
  "module_name": "iosm_ipc_imem.h",
  "hash_id": "b2be8a7d0fa1ee172350eefd43480ea4f6d250992015c31af097d74230df40e5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wwan/iosm/iosm_ipc_imem.h",
  "human_readable_source": " \n\n#ifndef IOSM_IPC_IMEM_H\n#define IOSM_IPC_IMEM_H\n\n#include <linux/skbuff.h>\n\n#include \"iosm_ipc_mmio.h\"\n#include \"iosm_ipc_pcie.h\"\n#include \"iosm_ipc_uevent.h\"\n#include \"iosm_ipc_wwan.h\"\n#include \"iosm_ipc_task_queue.h\"\n\nstruct ipc_chnl_cfg;\n\n \n#define IRQ_MOD_OFF 0\n#define IRQ_MOD_NET 1000\n#define IRQ_MOD_TRC 4000\n\n \n#define IPC_PSI_TRANSFER_TIMEOUT 3000\n\n \n#define IPC_MODEM_BOOT_TIMEOUT 500\n\n \n#define IPC_MODEM_UNINIT_TIMEOUT_MS 30\n\n \n#define IPC_PEND_DATA_TIMEOUT 500\n\n \n#define IPC_REMOTE_TS_TIMEOUT_MS 10\n\n \n#define IPC_TD_ALLOC_TIMER_PERIOD_MS 100\n\n \n#define IPC_HOST_SLEEP_HOST 0\n\n \n#define IPC_HOST_SLEEP_DEVICE 1\n\n \n#define IPC_HOST_SLEEP_ENTER_SLEEP 0\n\n \n#define IPC_HOST_SLEEP_EXIT_SLEEP 1\n\n#define IMEM_IRQ_DONT_CARE (-1)\n\n#define IPC_MEM_MAX_CHANNELS 8\n\n#define IPC_MEM_MUX_IP_SESSION_ENTRIES 8\n\n#define IPC_MEM_MUX_IP_CH_IF_ID 0\n\n#define TD_UPDATE_DEFAULT_TIMEOUT_USEC 1900\n\n#define FORCE_UPDATE_DEFAULT_TIMEOUT_USEC 500\n\n \n#define IPC_HOST_SLEEP_ENTER_SLEEP_NO_PROTOCOL 2\n\n \n#define IPC_MEM_INBAND_CRASH_SIG 1\n\n \n#define IPC_MEM_DL_ETH_OFFSET 16\n\n#define IPC_CB(skb) ((struct ipc_skb_cb *)((skb)->cb))\n#define IOSM_CHIP_INFO_SIZE_MAX 100\n\n#define FULLY_FUNCTIONAL 0\n#define IOSM_DEVLINK_INIT 1\n\n \nenum ipc_mem_pipes {\n\tIPC_MEM_PIPE_0 = 0,\n\tIPC_MEM_PIPE_1,\n\tIPC_MEM_PIPE_2,\n\tIPC_MEM_PIPE_3,\n\tIPC_MEM_PIPE_4,\n\tIPC_MEM_PIPE_5,\n\tIPC_MEM_PIPE_6,\n\tIPC_MEM_PIPE_7,\n\tIPC_MEM_PIPE_8,\n\tIPC_MEM_PIPE_9,\n\tIPC_MEM_PIPE_10,\n\tIPC_MEM_PIPE_11,\n\tIPC_MEM_PIPE_12,\n\tIPC_MEM_PIPE_13,\n\tIPC_MEM_PIPE_14,\n\tIPC_MEM_PIPE_15,\n\tIPC_MEM_PIPE_16,\n\tIPC_MEM_PIPE_17,\n\tIPC_MEM_PIPE_18,\n\tIPC_MEM_PIPE_19,\n\tIPC_MEM_PIPE_20,\n\tIPC_MEM_PIPE_21,\n\tIPC_MEM_PIPE_22,\n\tIPC_MEM_PIPE_23,\n\tIPC_MEM_MAX_PIPES\n};\n\n \nenum ipc_channel_state {\n\tIMEM_CHANNEL_FREE,\n\tIMEM_CHANNEL_RESERVED,\n\tIMEM_CHANNEL_ACTIVE,\n\tIMEM_CHANNEL_CLOSING,\n};\n\n \nenum ipc_ctype {\n\tIPC_CTYPE_WWAN,\n\tIPC_CTYPE_CTRL,\n};\n\n \nenum ipc_mem_pipe_dir {\n\tIPC_MEM_DIR_UL,\n\tIPC_MEM_DIR_DL,\n};\n\n \nenum ipc_hp_identifier {\n\tIPC_HP_MR = 0,\n\tIPC_HP_PM_TRIGGER,\n\tIPC_HP_WAKEUP_SPEC_TMR,\n\tIPC_HP_TD_UPD_TMR_START,\n\tIPC_HP_TD_UPD_TMR,\n\tIPC_HP_FAST_TD_UPD_TMR,\n\tIPC_HP_UL_WRITE_TD,\n\tIPC_HP_DL_PROCESS,\n\tIPC_HP_NET_CHANNEL_INIT,\n\tIPC_HP_CDEV_OPEN,\n};\n\n \nstruct ipc_pipe {\n\tstruct ipc_protocol_td *tdr_start;\n\tstruct ipc_mem_channel *channel;\n\tstruct sk_buff **skbr_start;\n\tdma_addr_t phy_tdr_start;\n\tu32 old_head;\n\tu32 old_tail;\n\tu32 nr_of_entries;\n\tu32 max_nr_of_queued_entries;\n\tu32 accumulation_backoff;\n\tu32 irq_moderation;\n\tu32 pipe_nr;\n\tu32 irq;\n\tenum ipc_mem_pipe_dir dir;\n\tu32 buf_size;\n\tu16 nr_of_queued_entries;\n\tu8 is_open:1;\n};\n\n \nstruct ipc_mem_channel {\n\tint channel_id;\n\tenum ipc_ctype ctype;\n\tint index;\n\tstruct ipc_pipe ul_pipe;\n\tstruct ipc_pipe dl_pipe;\n\tint if_id;\n\tu32 net_err_count;\n\tenum ipc_channel_state state;\n\tstruct completion ul_sem;\n\tstruct sk_buff_head ul_list;\n};\n\n \nenum ipc_phase {\n\tIPC_P_OFF,\n\tIPC_P_OFF_REQ,\n\tIPC_P_CRASH,\n\tIPC_P_CD_READY,\n\tIPC_P_ROM,\n\tIPC_P_PSI,\n\tIPC_P_EBL,\n\tIPC_P_RUN,\n};\n\n \nstruct iosm_imem {\n\tstruct iosm_mmio *mmio;\n\tstruct iosm_protocol *ipc_protocol;\n\tstruct ipc_task *ipc_task;\n\tstruct iosm_wwan *wwan;\n\tstruct iosm_mux *mux;\n\tstruct iosm_cdev *ipc_port[IPC_MEM_MAX_CHANNELS];\n\tstruct iosm_pcie *pcie;\n#ifdef CONFIG_WWAN_DEBUGFS\n\tstruct iosm_trace *trace;\n#endif\n\tstruct device *dev;\n\tenum ipc_mem_device_ipc_state ipc_requested_state;\n\tstruct ipc_mem_channel channels[IPC_MEM_MAX_CHANNELS];\n\tstruct iosm_devlink *ipc_devlink;\n\tu32 ipc_status;\n\tu32 nr_of_channels;\n\tstruct hrtimer startup_timer;\n\tktime_t hrtimer_period;\n\tstruct hrtimer tdupdate_timer;\n\tstruct hrtimer fast_update_timer;\n\tstruct hrtimer td_alloc_timer;\n\tstruct hrtimer adb_timer;\n\tenum rom_exit_code rom_exit_code;\n\tu32 enter_runtime;\n\tstruct completion ul_pend_sem;\n\tu32 app_notify_ul_pend;\n\tstruct completion dl_pend_sem;\n\tu32 app_notify_dl_pend;\n\tenum ipc_phase phase;\n\tu16 pci_device_id;\n\tint cp_version;\n\tint device_sleep;\n\tstruct work_struct run_state_worker;\n\tu8 ev_irq_pending[IPC_IRQ_VECTORS];\n\tunsigned long flag;\n\tu8 td_update_timer_suspended:1,\n\t   ev_mux_net_transmit_pending:1,\n\t   reset_det_n:1,\n\t   pcie_wake_n:1;\n#ifdef CONFIG_WWAN_DEBUGFS\n\tstruct dentry *debugfs_wwan_dir;\n\tstruct dentry *debugfs_dir;\n#endif\n};\n\n \nstruct iosm_imem *ipc_imem_init(struct iosm_pcie *pcie, unsigned int device_id,\n\t\t\t\tvoid __iomem *mmio, struct device *dev);\n\n \nvoid ipc_imem_pm_s2idle_sleep(struct iosm_imem *ipc_imem, bool sleep);\n\n \nvoid ipc_imem_pm_suspend(struct iosm_imem *ipc_imem);\n\n \nvoid ipc_imem_pm_resume(struct iosm_imem *ipc_imem);\n\n \nvoid ipc_imem_cleanup(struct iosm_imem *ipc_imem);\n\n \nvoid ipc_imem_irq_process(struct iosm_imem *ipc_imem, int irq);\n\n \nint imem_get_device_sleep_state(struct iosm_imem *ipc_imem);\n\n \nvoid ipc_imem_td_update_timer_suspend(struct iosm_imem *ipc_imem, bool suspend);\n\n \nvoid ipc_imem_channel_close(struct iosm_imem *ipc_imem, int channel_id);\n\n \nint ipc_imem_channel_alloc(struct iosm_imem *ipc_imem, int index,\n\t\t\t   enum ipc_ctype ctype);\n\n \nstruct ipc_mem_channel *ipc_imem_channel_open(struct iosm_imem *ipc_imem,\n\t\t\t\t\t      int channel_id, u32 db_id);\n\n \nvoid ipc_imem_td_update_timer_start(struct iosm_imem *ipc_imem);\n\n \nbool ipc_imem_ul_write_td(struct iosm_imem *ipc_imem);\n\n \nvoid ipc_imem_ul_send(struct iosm_imem *ipc_imem);\n\n \nvoid ipc_imem_channel_update(struct iosm_imem *ipc_imem, int id,\n\t\t\t     struct ipc_chnl_cfg chnl_cfg, u32 irq_moderation);\n\n \nvoid ipc_imem_channel_free(struct ipc_mem_channel *channel);\n\n \nvoid ipc_imem_hrtimer_stop(struct hrtimer *hr_timer);\n\n \nvoid ipc_imem_pipe_cleanup(struct iosm_imem *ipc_imem, struct ipc_pipe *pipe);\n\n \nvoid ipc_imem_pipe_close(struct iosm_imem *ipc_imem, struct ipc_pipe *pipe);\n\n \nenum ipc_phase ipc_imem_phase_update(struct iosm_imem *ipc_imem);\n\n \nconst char *ipc_imem_phase_get_string(enum ipc_phase phase);\n\n \nvoid ipc_imem_msg_send_feature_set(struct iosm_imem *ipc_imem,\n\t\t\t\t   unsigned int reset_enable, bool atomic_ctx);\n\n \nvoid ipc_imem_ipc_init_check(struct iosm_imem *ipc_imem);\n\n \nvoid ipc_imem_channel_init(struct iosm_imem *ipc_imem, enum ipc_ctype ctype,\n\t\t\t   struct ipc_chnl_cfg chnl_cfg, u32 irq_moderation);\n\n \nint ipc_imem_devlink_trigger_chip_info(struct iosm_imem *ipc_imem);\n\nvoid ipc_imem_adb_timer_start(struct iosm_imem *ipc_imem);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}