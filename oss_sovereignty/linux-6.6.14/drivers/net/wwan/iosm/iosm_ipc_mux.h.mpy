{
  "module_name": "iosm_ipc_mux.h",
  "hash_id": "9355f891d6ff2e7c4ff72614660857434c9f168f6ee59e1062260abf27d1766c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wwan/iosm/iosm_ipc_mux.h",
  "human_readable_source": " \n\n#ifndef IOSM_IPC_MUX_H\n#define IOSM_IPC_MUX_H\n\n#include \"iosm_ipc_protocol.h\"\n\n#define IPC_MEM_MAX_UL_DG_ENTRIES\t100\n#define IPC_MEM_MAX_TDS_MUX_AGGR_UL\t60\n#define IPC_MEM_MAX_TDS_MUX_AGGR_DL\t60\n\n#define IPC_MEM_MAX_ADB_BUF_SIZE (16 * 1024)\n#define IPC_MEM_MAX_UL_ADB_BUF_SIZE IPC_MEM_MAX_ADB_BUF_SIZE\n#define IPC_MEM_MAX_DL_ADB_BUF_SIZE IPC_MEM_MAX_ADB_BUF_SIZE\n\n \n#define IPC_MEM_MAX_DL_MUX_LITE_BUF_SIZE (2 * 1024)\n\n \n#define IPC_MEM_MAX_TDS_MUX_LITE_UL 800\n#define IPC_MEM_MAX_TDS_MUX_LITE_DL 1200\n\n \n#define MUX_CMD_OPEN_SESSION 1\n\n \n#define MUX_CMD_OPEN_SESSION_RESP 2\n\n \n#define MUX_CMD_CLOSE_SESSION 3\n\n \n#define MUX_CMD_CLOSE_SESSION_RESP 4\n\n \n#define MUX_LITE_CMD_FLOW_CTL 5\n\n \n#define MUX_LITE_CMD_FLOW_CTL_ACK 6\n\n \n#define MUX_LITE_CMD_LINK_STATUS_REPORT 7\n\n \n#define MUX_LITE_CMD_LINK_STATUS_REPORT_RESP 8\n\n \n#define MUX_CMD_INVALID 255\n\n \n#define MUX_CMD_RESP_SUCCESS 0\n\n \n#define IPC_MEM_WWAN_MUX BIT(0)\n\n \nenum mux_event {\n\tMUX_E_INACTIVE,  \n\tMUX_E_MUX_SESSION_OPEN,  \n\tMUX_E_MUX_SESSION_CLOSE,  \n\tMUX_E_MUX_CHANNEL_CLOSE,  \n\tMUX_E_NO_ORDERS,  \n\tMUX_E_NOT_APPLICABLE,  \n};\n\n \nstruct mux_session_open {\n\tenum mux_event event;\n\t__le32 if_id;\n};\n\n \nstruct mux_session_close {\n\tenum mux_event event;\n\t__le32 if_id;\n};\n\n \nstruct mux_channel_close {\n\tenum mux_event event;\n};\n\n \nstruct mux_common {\n\tenum mux_event event;\n};\n\n \nunion mux_msg {\n\tstruct mux_session_open session_open;\n\tstruct mux_session_close session_close;\n\tstruct mux_channel_close channel_close;\n\tstruct mux_common common;\n};\n\n \nstruct mux_cmd_open_session {\n\tu8 flow_ctrl;  \n\t \n\tu8 ipv4v6_hints;  \n\t \n\t__le16 reserved2;  \n\t__le32 dl_head_pad_len;  \n\t \n};\n\n \nstruct mux_cmd_open_session_resp {\n\t__le32 response;  \n\tu8 flow_ctrl;  \n\t \n\tu8 ipv4v6_hints;  \n\t \n\t__le16 reserved2;  \n\t__le32 ul_head_pad_len;  \n\t \n};\n\n \nstruct mux_cmd_close_session_resp {\n\t__le32 response;\n};\n\n \nstruct mux_cmd_flow_ctl {\n\t__le32 mask;  \n\t \n};\n\n \nstruct mux_cmd_link_status_report {\n\tu8 payload;\n};\n\n \nstruct mux_cmd_link_status_report_resp {\n\t__le32 response;\n};\n\n \nunion mux_cmd_param {\n\tstruct mux_cmd_open_session open_session;\n\tstruct mux_cmd_open_session_resp open_session_resp;\n\tstruct mux_cmd_close_session_resp close_session_resp;\n\tstruct mux_cmd_flow_ctl flow_ctl;\n\tstruct mux_cmd_link_status_report link_status;\n\tstruct mux_cmd_link_status_report_resp link_status_resp;\n};\n\n \nenum mux_state {\n\tMUX_S_INACTIVE,  \n\tMUX_S_ACTIVE,  \n\tMUX_S_ERROR,  \n};\n\n \nenum ipc_mux_protocol {\n\tMUX_UNKNOWN,\n\tMUX_LITE,\n\tMUX_AGGREGATION,\n};\n\n \nenum ipc_mux_ul_flow {\n\tMUX_UL_UNKNOWN,\n\tMUX_UL,  \n\tMUX_UL_ON_CREDITS,  \n};\n\n \nstruct mux_session {\n\tstruct iosm_wwan *wwan;  \n\tint if_id;  \n\tu32 flags;\n\tu32 ul_head_pad_len;  \n\tu32 dl_head_pad_len;  \n\tstruct sk_buff_head ul_list;  \n\tu32 flow_ctl_mask;  \n\tu32 flow_ctl_en_cnt;  \n\tu32 flow_ctl_dis_cnt;  \n\tint ul_flow_credits;  \n\tu8 net_tx_stop:1,\n\t   flush:1;  \n};\n\n \nstruct mux_adth_dg {\n\t__le32 datagram_index;\n\t__le16 datagram_length;\n\tu8 service_class;\n\tu8 reserved;\n};\n\n \nstruct mux_qlth_ql {\n\t__le32 nr_of_bytes;\n};\n\n \nstruct mux_qlth {\n\t__le32 signature;\n\t__le16 table_length;\n\tu8 if_id;\n\tu8 reserved;\n\t__le32 next_table_index;\n\t__le32 reserved2;\n\tstruct mux_qlth_ql ql;\n};\n\n \nstruct mux_adb {\n\tstruct sk_buff *dest_skb;\n\tu8 *buf;\n\tstruct mux_adgh *adgh;\n\tstruct sk_buff *qlth_skb;\n\tu32 *next_table_index;\n\tstruct sk_buff_head free_list;\n\tint size;\n\tu32 if_cnt;\n\tu32 dg_cnt_total;\n\tu32 payload_size;\n\tstruct mux_adth_dg\n\t\tdg[IPC_MEM_MUX_IP_SESSION_ENTRIES][IPC_MEM_MAX_UL_DG_ENTRIES];\n\tstruct mux_qlth *pp_qlt[IPC_MEM_MUX_IP_SESSION_ENTRIES];\n\tstruct mux_adbh *adbh;\n\tu32 qlt_updated[IPC_MEM_MUX_IP_SESSION_ENTRIES];\n\tu32 dg_count[IPC_MEM_MUX_IP_SESSION_ENTRIES];\n};\n\n \nstruct mux_acb {\n\tstruct sk_buff *skb;  \n\tint if_id;  \n\tu8 *buf_p;\n\tu32 wanted_response;\n\tu32 got_response;\n\tu32 cmd;\n\tunion mux_cmd_param got_param;  \n};\n\n \nstruct iosm_mux {\n\tstruct device *dev;\n\tstruct mux_session session[IPC_MEM_MUX_IP_SESSION_ENTRIES];\n\tstruct ipc_mem_channel *channel;\n\tstruct iosm_pcie *pcie;\n\tstruct iosm_imem *imem;\n\tstruct iosm_wwan *wwan;\n\tstruct iosm_protocol *ipc_protocol;\n\tint channel_id;\n\tenum ipc_mux_protocol protocol;\n\tenum ipc_mux_ul_flow ul_flow;\n\tint nr_sessions;\n\tint instance_id;\n\tenum mux_state state;\n\tenum mux_event event;\n\tu32 tx_transaction_id;\n\tint rr_next_session;\n\tstruct mux_adb ul_adb;\n\tint size_needed;\n\tlong long ul_data_pend_bytes;\n\tstruct mux_acb acb;\n\tint wwan_q_offset;\n\tu16 acb_tx_sequence_nr;\n\tu16 adb_tx_sequence_nr;\n\tunsigned long long acc_adb_size;\n\tunsigned long long acc_payload_size;\n\tu8 initialized:1,\n\t   ev_mux_net_transmit_pending:1,\n\t   adb_prep_ongoing;\n} __packed;\n\n \nstruct ipc_mux_config {\n\tenum ipc_mux_protocol protocol;\n\tenum ipc_mux_ul_flow ul_flow;\n\tint instance_id;\n};\n\n \nstruct iosm_mux *ipc_mux_init(struct ipc_mux_config *mux_cfg,\n\t\t\t      struct iosm_imem *ipc_imem);\n\n \nvoid ipc_mux_deinit(struct iosm_mux *ipc_mux);\n\n \nvoid ipc_mux_check_n_restart_tx(struct iosm_mux *ipc_mux);\n\n \nenum ipc_mux_protocol ipc_mux_get_active_protocol(struct iosm_mux *ipc_mux);\n\n \nint ipc_mux_open_session(struct iosm_mux *ipc_mux, int session_nr);\n\n \nint ipc_mux_close_session(struct iosm_mux *ipc_mux, int session_nr);\n\n \nint ipc_mux_get_max_sessions(struct iosm_mux *ipc_mux);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}