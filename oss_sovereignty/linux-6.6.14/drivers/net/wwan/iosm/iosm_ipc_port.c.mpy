{
  "module_name": "iosm_ipc_port.c",
  "hash_id": "2cf488dd58cc5d1c0d3db0304de5c0d420b8fa5b12030f4c915ed4629223f9b6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wwan/iosm/iosm_ipc_port.c",
  "human_readable_source": "\n \n\n#include \"iosm_ipc_chnl_cfg.h\"\n#include \"iosm_ipc_imem_ops.h\"\n#include \"iosm_ipc_port.h\"\n\n \nstatic int ipc_port_ctrl_start(struct wwan_port *port)\n{\n\tstruct iosm_cdev *ipc_port = wwan_port_get_drvdata(port);\n\tint ret = 0;\n\n\tipc_port->channel = ipc_imem_sys_port_open(ipc_port->ipc_imem,\n\t\t\t\t\t\t   ipc_port->chl_id,\n\t\t\t\t\t\t   IPC_HP_CDEV_OPEN);\n\tif (!ipc_port->channel)\n\t\tret = -EIO;\n\n\treturn ret;\n}\n\n \nstatic void ipc_port_ctrl_stop(struct wwan_port *port)\n{\n\tstruct iosm_cdev *ipc_port = wwan_port_get_drvdata(port);\n\n\tipc_imem_sys_port_close(ipc_port->ipc_imem, ipc_port->channel);\n}\n\n \nstatic int ipc_port_ctrl_tx(struct wwan_port *port, struct sk_buff *skb)\n{\n\tstruct iosm_cdev *ipc_port = wwan_port_get_drvdata(port);\n\n\treturn ipc_imem_sys_cdev_write(ipc_port, skb);\n}\n\nstatic const struct wwan_port_ops ipc_wwan_ctrl_ops = {\n\t.start = ipc_port_ctrl_start,\n\t.stop = ipc_port_ctrl_stop,\n\t.tx = ipc_port_ctrl_tx,\n};\n\n \nstruct iosm_cdev *ipc_port_init(struct iosm_imem *ipc_imem,\n\t\t\t\tstruct ipc_chnl_cfg ipc_port_cfg)\n{\n\tstruct iosm_cdev *ipc_port = kzalloc(sizeof(*ipc_port), GFP_KERNEL);\n\tenum wwan_port_type port_type = ipc_port_cfg.wwan_port_type;\n\tenum ipc_channel_id chl_id = ipc_port_cfg.id;\n\n\tif (!ipc_port)\n\t\treturn NULL;\n\n\tipc_port->dev = ipc_imem->dev;\n\tipc_port->pcie = ipc_imem->pcie;\n\n\tipc_port->port_type = port_type;\n\tipc_port->chl_id = chl_id;\n\tipc_port->ipc_imem = ipc_imem;\n\n\tipc_port->iosm_port = wwan_create_port(ipc_port->dev, port_type,\n\t\t\t\t\t       &ipc_wwan_ctrl_ops, NULL,\n\t\t\t\t\t       ipc_port);\n\n\treturn ipc_port;\n}\n\n \nvoid ipc_port_deinit(struct iosm_cdev *port[])\n{\n\tstruct iosm_cdev *ipc_port;\n\tu8 ctrl_chl_nr;\n\n\tfor (ctrl_chl_nr = 0; ctrl_chl_nr < IPC_MEM_MAX_CHANNELS;\n\t     ctrl_chl_nr++) {\n\t\tif (port[ctrl_chl_nr]) {\n\t\t\tipc_port = port[ctrl_chl_nr];\n\t\t\twwan_remove_port(ipc_port->iosm_port);\n\t\t\tkfree(ipc_port);\n\t\t}\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}