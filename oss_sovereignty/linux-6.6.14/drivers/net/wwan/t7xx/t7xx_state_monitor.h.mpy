{
  "module_name": "t7xx_state_monitor.h",
  "hash_id": "83d425422d588307d69412bd90ab52266973fa6cb4c51248ebf042be4e203a64",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wwan/t7xx/t7xx_state_monitor.h",
  "human_readable_source": " \n\n#ifndef __T7XX_MONITOR_H__\n#define __T7XX_MONITOR_H__\n\n#include <linux/bits.h>\n#include <linux/sched.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n#include <linux/wait.h>\n\n#include \"t7xx_modem_ops.h\"\n\nenum t7xx_fsm_state {\n\tFSM_STATE_INIT,\n\tFSM_STATE_PRE_START,\n\tFSM_STATE_STARTING,\n\tFSM_STATE_READY,\n\tFSM_STATE_EXCEPTION,\n\tFSM_STATE_STOPPING,\n\tFSM_STATE_STOPPED,\n};\n\nenum t7xx_fsm_event_state {\n\tFSM_EVENT_INVALID,\n\tFSM_EVENT_MD_HS2,\n\tFSM_EVENT_AP_HS2,\n\tFSM_EVENT_MD_EX,\n\tFSM_EVENT_MD_EX_REC_OK,\n\tFSM_EVENT_MD_EX_PASS,\n\tFSM_EVENT_MD_HS2_EXIT,\n\tFSM_EVENT_AP_HS2_EXIT,\n\tFSM_EVENT_MAX\n};\n\nenum t7xx_fsm_cmd_state {\n\tFSM_CMD_INVALID,\n\tFSM_CMD_START,\n\tFSM_CMD_EXCEPTION,\n\tFSM_CMD_PRE_STOP,\n\tFSM_CMD_STOP,\n};\n\nenum t7xx_ex_reason {\n\tEXCEPTION_HS_TIMEOUT,\n\tEXCEPTION_EVENT,\n};\n\nenum t7xx_md_irq_type {\n\tMD_IRQ_WDT,\n\tMD_IRQ_CCIF_EX,\n\tMD_IRQ_PORT_ENUM,\n};\n\nenum md_state {\n\tMD_STATE_INVALID,\n\tMD_STATE_WAITING_FOR_HS1,\n\tMD_STATE_WAITING_FOR_HS2,\n\tMD_STATE_READY,\n\tMD_STATE_EXCEPTION,\n\tMD_STATE_WAITING_TO_STOP,\n\tMD_STATE_STOPPED,\n};\n\n#define FSM_CMD_FLAG_WAIT_FOR_COMPLETION\tBIT(0)\n#define FSM_CMD_FLAG_FLIGHT_MODE\t\tBIT(1)\n#define FSM_CMD_FLAG_IN_INTERRUPT\t\tBIT(2)\n#define FSM_CMD_EX_REASON\t\t\tGENMASK(23, 16)\n\nstruct t7xx_fsm_ctl {\n\tstruct t7xx_modem\t*md;\n\tenum md_state\t\tmd_state;\n\tunsigned int\t\tcurr_state;\n\tstruct list_head\tcommand_queue;\n\tstruct list_head\tevent_queue;\n\twait_queue_head_t\tcommand_wq;\n\twait_queue_head_t\tevent_wq;\n\twait_queue_head_t\tasync_hk_wq;\n\tspinlock_t\t\tevent_lock;\t\t \n\tspinlock_t\t\tcommand_lock;\t\t \n\tstruct task_struct\t*fsm_thread;\n\tbool\t\t\texp_flg;\n\tspinlock_t\t\tnotifier_lock;\t\t \n\tstruct list_head\tnotifier_list;\n};\n\nstruct t7xx_fsm_event {\n\tstruct list_head\tentry;\n\tenum t7xx_fsm_event_state event_id;\n\tunsigned int\t\tlength;\n\tunsigned char\t\tdata[];\n};\n\nstruct t7xx_fsm_command {\n\tstruct list_head\tentry;\n\tenum t7xx_fsm_cmd_state\tcmd_id;\n\tunsigned int\t\tflag;\n\tstruct completion\t*done;\n\tint\t\t\t*ret;\n};\n\nstruct t7xx_fsm_notifier {\n\tstruct list_head\tentry;\n\tint (*notifier_fn)(enum md_state state, void *data);\n\tvoid\t\t\t*data;\n};\n\nint t7xx_fsm_append_cmd(struct t7xx_fsm_ctl *ctl, enum t7xx_fsm_cmd_state cmd_id,\n\t\t\tunsigned int flag);\nint t7xx_fsm_append_event(struct t7xx_fsm_ctl *ctl, enum t7xx_fsm_event_state event_id,\n\t\t\t  unsigned char *data, unsigned int length);\nvoid t7xx_fsm_clr_event(struct t7xx_fsm_ctl *ctl, enum t7xx_fsm_event_state event_id);\nvoid t7xx_fsm_broadcast_state(struct t7xx_fsm_ctl *ctl, enum md_state state);\nvoid t7xx_fsm_reset(struct t7xx_modem *md);\nint t7xx_fsm_init(struct t7xx_modem *md);\nvoid t7xx_fsm_uninit(struct t7xx_modem *md);\nint t7xx_fsm_recv_md_intr(struct t7xx_fsm_ctl *ctl, enum t7xx_md_irq_type type);\nenum md_state t7xx_fsm_get_md_state(struct t7xx_fsm_ctl *ctl);\nunsigned int t7xx_fsm_get_ctl_state(struct t7xx_fsm_ctl *ctl);\nvoid t7xx_fsm_notifier_register(struct t7xx_modem *md, struct t7xx_fsm_notifier *notifier);\nvoid t7xx_fsm_notifier_unregister(struct t7xx_modem *md, struct t7xx_fsm_notifier *notifier);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}