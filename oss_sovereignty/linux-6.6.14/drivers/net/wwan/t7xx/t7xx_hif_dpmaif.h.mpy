{
  "module_name": "t7xx_hif_dpmaif.h",
  "hash_id": "cc3d529069b32eeaa6308b10f30647de3da0562c87814197b9c9b5adc3edd194",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wwan/t7xx/t7xx_hif_dpmaif.h",
  "human_readable_source": " \n\n#ifndef __T7XX_HIF_DPMAIF_H__\n#define __T7XX_HIF_DPMAIF_H__\n\n#include <linux/bitmap.h>\n#include <linux/mm_types.h>\n#include <linux/netdevice.h>\n#include <linux/sched.h>\n#include <linux/skbuff.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n#include <linux/wait.h>\n#include <linux/workqueue.h>\n\n#include \"t7xx_dpmaif.h\"\n#include \"t7xx_pci.h\"\n#include \"t7xx_state_monitor.h\"\n\n \nstruct t7xx_skb_cb {\n\tu8\tnetif_idx;\n\tu8\ttxq_number;\n\tu8\trx_pkt_type;\n};\n\n#define T7XX_SKB_CB(__skb)\t((struct t7xx_skb_cb *)(__skb)->cb)\n\nenum dpmaif_rdwr {\n\tDPMAIF_READ,\n\tDPMAIF_WRITE,\n};\n\n \nstruct dpmaif_cur_rx_skb_info {\n\tbool\t\t\tmsg_pit_received;\n\tstruct sk_buff\t\t*cur_skb;\n\tunsigned int\t\tcur_chn_idx;\n\tunsigned int\t\tcheck_sum;\n\tunsigned int\t\tpit_dp;\n\tunsigned int\t\tpkt_type;\n\tint\t\t\terr_payload;\n};\n\nstruct dpmaif_bat {\n\tunsigned int\t\tp_buffer_addr;\n\tunsigned int\t\tbuffer_addr_ext;\n};\n\nstruct dpmaif_bat_skb {\n\tstruct sk_buff\t\t*skb;\n\tdma_addr_t\t\tdata_bus_addr;\n\tunsigned int\t\tdata_len;\n};\n\nstruct dpmaif_bat_page {\n\tstruct page\t\t*page;\n\tdma_addr_t\t\tdata_bus_addr;\n\tunsigned int\t\toffset;\n\tunsigned int\t\tdata_len;\n};\n\nenum bat_type {\n\tBAT_TYPE_NORMAL,\n\tBAT_TYPE_FRAG,\n};\n\nstruct dpmaif_bat_request {\n\tvoid\t\t\t*bat_base;\n\tdma_addr_t\t\tbat_bus_addr;\n\tunsigned int\t\tbat_size_cnt;\n\tunsigned int\t\tbat_wr_idx;\n\tunsigned int\t\tbat_release_rd_idx;\n\tvoid\t\t\t*bat_skb;\n\tunsigned int\t\tpkt_buf_sz;\n\tunsigned long\t\t*bat_bitmap;\n\tatomic_t\t\trefcnt;\n\tspinlock_t\t\tmask_lock;  \n\tenum bat_type\t\ttype;\n};\n\nstruct dpmaif_rx_queue {\n\tunsigned int\t\tindex;\n\tbool\t\t\tque_started;\n\tunsigned int\t\tbudget;\n\n\tvoid\t\t\t*pit_base;\n\tdma_addr_t\t\tpit_bus_addr;\n\tunsigned int\t\tpit_size_cnt;\n\n\tunsigned int\t\tpit_rd_idx;\n\tunsigned int\t\tpit_wr_idx;\n\tunsigned int\t\tpit_release_rd_idx;\n\n\tstruct dpmaif_bat_request *bat_req;\n\tstruct dpmaif_bat_request *bat_frag;\n\n\tatomic_t\t\trx_processing;\n\n\tstruct dpmaif_ctrl\t*dpmaif_ctrl;\n\tunsigned int\t\texpect_pit_seq;\n\tunsigned int\t\tpit_remain_release_cnt;\n\tstruct dpmaif_cur_rx_skb_info rx_data_info;\n\tstruct napi_struct\tnapi;\n\tbool\t\t\tsleep_lock_pending;\n};\n\nstruct dpmaif_tx_queue {\n\tunsigned int\t\tindex;\n\tbool\t\t\tque_started;\n\tatomic_t\t\ttx_budget;\n\tvoid\t\t\t*drb_base;\n\tdma_addr_t\t\tdrb_bus_addr;\n\tunsigned int\t\tdrb_size_cnt;\n\tunsigned int\t\tdrb_wr_idx;\n\tunsigned int\t\tdrb_rd_idx;\n\tunsigned int\t\tdrb_release_rd_idx;\n\tvoid\t\t\t*drb_skb_base;\n\twait_queue_head_t\treq_wq;\n\tstruct workqueue_struct\t*worker;\n\tstruct work_struct\tdpmaif_tx_work;\n\tspinlock_t\t\ttx_lock;  \n\tatomic_t\t\ttx_processing;\n\n\tstruct dpmaif_ctrl\t*dpmaif_ctrl;\n\tstruct sk_buff_head\ttx_skb_head;\n};\n\nstruct dpmaif_isr_para {\n\tstruct dpmaif_ctrl\t*dpmaif_ctrl;\n\tunsigned char\t\tpcie_int;\n\tunsigned char\t\tdlq_id;\n};\n\nenum dpmaif_state {\n\tDPMAIF_STATE_MIN,\n\tDPMAIF_STATE_PWROFF,\n\tDPMAIF_STATE_PWRON,\n\tDPMAIF_STATE_EXCEPTION,\n\tDPMAIF_STATE_MAX\n};\n\nenum dpmaif_txq_state {\n\tDMPAIF_TXQ_STATE_IRQ,\n\tDMPAIF_TXQ_STATE_FULL,\n};\n\nstruct dpmaif_callbacks {\n\tvoid (*state_notify)(struct t7xx_pci_dev *t7xx_dev,\n\t\t\t     enum dpmaif_txq_state state, int txq_number);\n\tvoid (*recv_skb)(struct t7xx_ccmni_ctrl *ccmni_ctlb, struct sk_buff *skb,\n\t\t\t struct napi_struct *napi);\n};\n\nstruct dpmaif_ctrl {\n\tstruct device\t\t\t*dev;\n\tstruct t7xx_pci_dev\t\t*t7xx_dev;\n\tstruct md_pm_entity\t\tdpmaif_pm_entity;\n\tenum dpmaif_state\t\tstate;\n\tbool\t\t\t\tdpmaif_sw_init_done;\n\tstruct dpmaif_hw_info\t\thw_info;\n\tstruct dpmaif_tx_queue\t\ttxq[DPMAIF_TXQ_NUM];\n\tstruct dpmaif_rx_queue\t\trxq[DPMAIF_RXQ_NUM];\n\n\tunsigned char\t\t\trxq_int_mapping[DPMAIF_RXQ_NUM];\n\tstruct dpmaif_isr_para\t\tisr_para[DPMAIF_RXQ_NUM];\n\n\tstruct dpmaif_bat_request\tbat_req;\n\tstruct dpmaif_bat_request\tbat_frag;\n\tstruct workqueue_struct\t\t*bat_release_wq;\n\tstruct work_struct\t\tbat_release_work;\n\n\twait_queue_head_t\t\ttx_wq;\n\tstruct task_struct\t\t*tx_thread;\n\n\tstruct dpmaif_callbacks\t\t*callbacks;\n};\n\nstruct dpmaif_ctrl *t7xx_dpmaif_hif_init(struct t7xx_pci_dev *t7xx_dev,\n\t\t\t\t\t struct dpmaif_callbacks *callbacks);\nvoid t7xx_dpmaif_hif_exit(struct dpmaif_ctrl *dpmaif_ctrl);\nint t7xx_dpmaif_md_state_callback(struct dpmaif_ctrl *dpmaif_ctrl, enum md_state state);\nunsigned int t7xx_ring_buf_get_next_wr_idx(unsigned int buf_len, unsigned int buf_idx);\nunsigned int t7xx_ring_buf_rd_wr_count(unsigned int total_cnt, unsigned int rd_idx,\n\t\t\t\t       unsigned int wr_idx, enum dpmaif_rdwr);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}