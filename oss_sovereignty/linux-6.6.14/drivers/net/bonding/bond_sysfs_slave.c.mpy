{
  "module_name": "bond_sysfs_slave.c",
  "hash_id": "70db9938b5af384042b5de27e02dba03770b9815aa4118707de50c6aba228376",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/bonding/bond_sysfs_slave.c",
  "human_readable_source": "\n \n\n#include <linux/capability.h>\n#include <linux/kernel.h>\n#include <linux/netdevice.h>\n\n#include <net/bonding.h>\n\nstruct slave_attribute {\n\tstruct attribute attr;\n\tssize_t (*show)(struct slave *, char *);\n};\n\n#define SLAVE_ATTR_RO(_name)\t\t\t\t\t\\\nconst struct slave_attribute slave_attr_##_name = __ATTR_RO(_name)\n\nstatic ssize_t state_show(struct slave *slave, char *buf)\n{\n\tswitch (bond_slave_state(slave)) {\n\tcase BOND_STATE_ACTIVE:\n\t\treturn sysfs_emit(buf, \"active\\n\");\n\tcase BOND_STATE_BACKUP:\n\t\treturn sysfs_emit(buf, \"backup\\n\");\n\tdefault:\n\t\treturn sysfs_emit(buf, \"UNKNOWN\\n\");\n\t}\n}\nstatic SLAVE_ATTR_RO(state);\n\nstatic ssize_t mii_status_show(struct slave *slave, char *buf)\n{\n\treturn sysfs_emit(buf, \"%s\\n\", bond_slave_link_status(slave->link));\n}\nstatic SLAVE_ATTR_RO(mii_status);\n\nstatic ssize_t link_failure_count_show(struct slave *slave, char *buf)\n{\n\treturn sysfs_emit(buf, \"%d\\n\", slave->link_failure_count);\n}\nstatic SLAVE_ATTR_RO(link_failure_count);\n\nstatic ssize_t perm_hwaddr_show(struct slave *slave, char *buf)\n{\n\treturn sysfs_emit(buf, \"%*phC\\n\",\n\t\t       slave->dev->addr_len,\n\t\t       slave->perm_hwaddr);\n}\nstatic SLAVE_ATTR_RO(perm_hwaddr);\n\nstatic ssize_t queue_id_show(struct slave *slave, char *buf)\n{\n\treturn sysfs_emit(buf, \"%d\\n\", slave->queue_id);\n}\nstatic SLAVE_ATTR_RO(queue_id);\n\nstatic ssize_t ad_aggregator_id_show(struct slave *slave, char *buf)\n{\n\tconst struct aggregator *agg;\n\n\tif (BOND_MODE(slave->bond) == BOND_MODE_8023AD) {\n\t\tagg = SLAVE_AD_INFO(slave)->port.aggregator;\n\t\tif (agg)\n\t\t\treturn sysfs_emit(buf, \"%d\\n\",\n\t\t\t\t\t  agg->aggregator_identifier);\n\t}\n\n\treturn sysfs_emit(buf, \"N/A\\n\");\n}\nstatic SLAVE_ATTR_RO(ad_aggregator_id);\n\nstatic ssize_t ad_actor_oper_port_state_show(struct slave *slave, char *buf)\n{\n\tconst struct port *ad_port;\n\n\tif (BOND_MODE(slave->bond) == BOND_MODE_8023AD) {\n\t\tad_port = &SLAVE_AD_INFO(slave)->port;\n\t\tif (ad_port->aggregator)\n\t\t\treturn sysfs_emit(buf, \"%u\\n\",\n\t\t\t\t       ad_port->actor_oper_port_state);\n\t}\n\n\treturn sysfs_emit(buf, \"N/A\\n\");\n}\nstatic SLAVE_ATTR_RO(ad_actor_oper_port_state);\n\nstatic ssize_t ad_partner_oper_port_state_show(struct slave *slave, char *buf)\n{\n\tconst struct port *ad_port;\n\n\tif (BOND_MODE(slave->bond) == BOND_MODE_8023AD) {\n\t\tad_port = &SLAVE_AD_INFO(slave)->port;\n\t\tif (ad_port->aggregator)\n\t\t\treturn sysfs_emit(buf, \"%u\\n\",\n\t\t\t\t       ad_port->partner_oper.port_state);\n\t}\n\n\treturn sysfs_emit(buf, \"N/A\\n\");\n}\nstatic SLAVE_ATTR_RO(ad_partner_oper_port_state);\n\nstatic const struct attribute *slave_attrs[] = {\n\t&slave_attr_state.attr,\n\t&slave_attr_mii_status.attr,\n\t&slave_attr_link_failure_count.attr,\n\t&slave_attr_perm_hwaddr.attr,\n\t&slave_attr_queue_id.attr,\n\t&slave_attr_ad_aggregator_id.attr,\n\t&slave_attr_ad_actor_oper_port_state.attr,\n\t&slave_attr_ad_partner_oper_port_state.attr,\n\tNULL\n};\n\n#define to_slave_attr(_at) container_of(_at, struct slave_attribute, attr)\n\nstatic ssize_t slave_show(struct kobject *kobj,\n\t\t\t  struct attribute *attr, char *buf)\n{\n\tstruct slave_attribute *slave_attr = to_slave_attr(attr);\n\tstruct slave *slave = to_slave(kobj);\n\n\treturn slave_attr->show(slave, buf);\n}\n\nconst struct sysfs_ops slave_sysfs_ops = {\n\t.show = slave_show,\n};\n\nint bond_sysfs_slave_add(struct slave *slave)\n{\n\treturn sysfs_create_files(&slave->kobj, slave_attrs);\n}\n\nvoid bond_sysfs_slave_del(struct slave *slave)\n{\n\tsysfs_remove_files(&slave->kobj, slave_attrs);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}