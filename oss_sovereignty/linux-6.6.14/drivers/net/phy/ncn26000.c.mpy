{
  "module_name": "ncn26000.c",
  "hash_id": "b2f83c4f52e8b6a71aa3285bdf2049df05d8826cfb59a35ea7da10f78e5c1a27",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/phy/ncn26000.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/bitfield.h>\n#include <linux/errno.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/mii.h>\n#include <linux/phy.h>\n\n#include \"mdio-open-alliance.h\"\n\n#define PHY_ID_NCN26000\t\t\t0x180FF5A1\n\n#define NCN26000_REG_IRQ_CTL            16\n#define NCN26000_REG_IRQ_STATUS         17\n\n\n#define NCN26000_BCMR_LINK_CTRL_BIT\tBMCR_ANENABLE\n\n\n#define NCN26000_BMSR_LINK_STATUS_BIT\tBMSR_ANEGCOMPLETE\n\n#define NCN26000_IRQ_LINKST_BIT\t\tBIT(0)\n#define NCN26000_IRQ_PLCAST_BIT\t\tBIT(1)\n#define NCN26000_IRQ_LJABBER_BIT\tBIT(2)\n#define NCN26000_IRQ_RJABBER_BIT\tBIT(3)\n#define NCN26000_IRQ_PLCAREC_BIT\tBIT(4)\n#define NCN26000_IRQ_PHYSCOL_BIT\tBIT(5)\n#define NCN26000_IRQ_RESET_BIT\t\tBIT(15)\n\n#define TO_TMR_DEFAULT\t\t\t32\n\nstatic int ncn26000_config_init(struct phy_device *phydev)\n{\n\t \n\treturn phy_write_mmd(phydev, MDIO_MMD_VEND2, MDIO_OATC14_PLCA_TOTMR,\n\t\t\t     TO_TMR_DEFAULT);\n}\n\nstatic int ncn26000_config_aneg(struct phy_device *phydev)\n{\n\t \n\tphydev->mdix_ctrl = ETH_TP_MDI_AUTO;\n\tphydev->mdix = ETH_TP_MDI;\n\n\t\n\treturn phy_write(phydev, MII_BMCR, NCN26000_BCMR_LINK_CTRL_BIT);\n}\n\nstatic int ncn26000_read_status(struct phy_device *phydev)\n{\n\t \n\tint ret;\n\n\t \n\tif (!phy_polling_mode(phydev) || !phydev->link) {\n\t\tret = phy_read(phydev, MII_BMSR);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\telse if (ret & NCN26000_BMSR_LINK_STATUS_BIT)\n\t\t\tgoto upd_link;\n\t}\n\n\tret = phy_read(phydev, MII_BMSR);\n\tif (ret < 0)\n\t\treturn ret;\n\nupd_link:\n\t\n\tif (ret & NCN26000_BMSR_LINK_STATUS_BIT) {\n\t\tphydev->link = 1;\n\t\tphydev->pause = 0;\n\t\tphydev->duplex = DUPLEX_HALF;\n\t\tphydev->speed = SPEED_10;\n\t} else {\n\t\tphydev->link = 0;\n\t\tphydev->duplex = DUPLEX_UNKNOWN;\n\t\tphydev->speed = SPEED_UNKNOWN;\n\t}\n\n\treturn 0;\n}\n\nstatic irqreturn_t ncn26000_handle_interrupt(struct phy_device *phydev)\n{\n\tint ret;\n\n\t\n\tret = phy_read(phydev, NCN26000_REG_IRQ_STATUS);\n\n\t\n\tif (ret < 0 || (ret & NCN26000_REG_IRQ_STATUS) == 0)\n\t\treturn IRQ_NONE;\n\n\tphy_trigger_machine(phydev);\n\treturn IRQ_HANDLED;\n}\n\nstatic int ncn26000_config_intr(struct phy_device *phydev)\n{\n\tint ret;\n\tu16 irqe;\n\n\tif (phydev->interrupts == PHY_INTERRUPT_ENABLED) {\n\t\t\n\t\tret = phy_read(phydev, NCN26000_REG_IRQ_STATUS);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\n\t\t\n\t\tirqe = NCN26000_IRQ_LINKST_BIT;\n\t} else {\n\t\t\n\t\tirqe = 0;\n\t}\n\n\tret = phy_write(phydev, NCN26000_REG_IRQ_CTL, irqe);\n\tif (ret != 0)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nstatic struct phy_driver ncn26000_driver[] = {\n\t{\n\t\tPHY_ID_MATCH_MODEL(PHY_ID_NCN26000),\n\t\t.name\t\t\t= \"NCN26000\",\n\t\t.features\t\t= PHY_BASIC_T1S_P2MP_FEATURES,\n\t\t.config_init            = ncn26000_config_init,\n\t\t.config_intr            = ncn26000_config_intr,\n\t\t.config_aneg\t\t= ncn26000_config_aneg,\n\t\t.read_status\t\t= ncn26000_read_status,\n\t\t.handle_interrupt       = ncn26000_handle_interrupt,\n\t\t.get_plca_cfg\t\t= genphy_c45_plca_get_cfg,\n\t\t.set_plca_cfg\t\t= genphy_c45_plca_set_cfg,\n\t\t.get_plca_status\t= genphy_c45_plca_get_status,\n\t\t.soft_reset             = genphy_soft_reset,\n\t},\n};\n\nmodule_phy_driver(ncn26000_driver);\n\nstatic struct mdio_device_id __maybe_unused ncn26000_tbl[] = {\n\t{ PHY_ID_MATCH_MODEL(PHY_ID_NCN26000) },\n\t{ }\n};\n\nMODULE_DEVICE_TABLE(mdio, ncn26000_tbl);\n\nMODULE_AUTHOR(\"Piergiorgio Beruto\");\nMODULE_DESCRIPTION(\"onsemi 10BASE-T1S PHY driver\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}