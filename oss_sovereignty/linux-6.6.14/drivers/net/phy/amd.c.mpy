{
  "module_name": "amd.c",
  "hash_id": "96a0a4408bda2664b53d5a4d59e94a1af397865bdd52db8df244ee7dd7e69e4e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/phy/amd.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/mii.h>\n#include <linux/phy.h>\n\n#define PHY_ID_AM79C874\t\t0x0022561b\n\n#define MII_AM79C_IR\t\t17\t \n#define MII_AM79C_IR_EN_LINK\t0x0400\t \n#define MII_AM79C_IR_EN_ANEG\t0x0100\t \n#define MII_AM79C_IR_IMASK_INIT\t(MII_AM79C_IR_EN_LINK | MII_AM79C_IR_EN_ANEG)\n\n#define MII_AM79C_IR_LINK_DOWN\tBIT(2)\n#define MII_AM79C_IR_ANEG_DONE\tBIT(0)\n#define MII_AM79C_IR_IMASK_STAT\t(MII_AM79C_IR_LINK_DOWN | MII_AM79C_IR_ANEG_DONE)\n\nMODULE_DESCRIPTION(\"AMD PHY driver\");\nMODULE_AUTHOR(\"Heiko Schocher <hs@denx.de>\");\nMODULE_LICENSE(\"GPL\");\n\nstatic int am79c_ack_interrupt(struct phy_device *phydev)\n{\n\tint err;\n\n\terr = phy_read(phydev, MII_BMSR);\n\tif (err < 0)\n\t\treturn err;\n\n\terr = phy_read(phydev, MII_AM79C_IR);\n\tif (err < 0)\n\t\treturn err;\n\n\treturn 0;\n}\n\nstatic int am79c_config_init(struct phy_device *phydev)\n{\n\treturn 0;\n}\n\nstatic int am79c_config_intr(struct phy_device *phydev)\n{\n\tint err;\n\n\tif (phydev->interrupts == PHY_INTERRUPT_ENABLED) {\n\t\terr = am79c_ack_interrupt(phydev);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\terr = phy_write(phydev, MII_AM79C_IR, MII_AM79C_IR_IMASK_INIT);\n\t} else {\n\t\terr = phy_write(phydev, MII_AM79C_IR, 0);\n\t\tif (err)\n\t\t\treturn err;\n\n\t\terr = am79c_ack_interrupt(phydev);\n\t}\n\n\treturn err;\n}\n\nstatic irqreturn_t am79c_handle_interrupt(struct phy_device *phydev)\n{\n\tint irq_status;\n\n\tirq_status = phy_read(phydev, MII_AM79C_IR);\n\tif (irq_status < 0) {\n\t\tphy_error(phydev);\n\t\treturn IRQ_NONE;\n\t}\n\n\tif (!(irq_status & MII_AM79C_IR_IMASK_STAT))\n\t\treturn IRQ_NONE;\n\n\tphy_trigger_machine(phydev);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic struct phy_driver am79c_driver[] = { {\n\t.phy_id\t\t= PHY_ID_AM79C874,\n\t.name\t\t= \"AM79C874\",\n\t.phy_id_mask\t= 0xfffffff0,\n\t \n\t.config_init\t= am79c_config_init,\n\t.config_intr\t= am79c_config_intr,\n\t.handle_interrupt = am79c_handle_interrupt,\n} };\n\nmodule_phy_driver(am79c_driver);\n\nstatic struct mdio_device_id __maybe_unused amd_tbl[] = {\n\t{ PHY_ID_AM79C874, 0xfffffff0 },\n\t{ }\n};\n\nMODULE_DEVICE_TABLE(mdio, amd_tbl);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}