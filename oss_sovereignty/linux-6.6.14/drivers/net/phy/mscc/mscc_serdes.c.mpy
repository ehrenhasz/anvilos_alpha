{
  "module_name": "mscc_serdes.c",
  "hash_id": "178098c1643ae70ecde9936c838d2a32b441fad5a1cf868f91364ee85b70f8d9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/phy/mscc/mscc_serdes.c",
  "human_readable_source": "\n \n\n#include <linux/phy.h>\n#include \"mscc_serdes.h\"\n#include \"mscc.h\"\n\nstatic int pll5g_detune(struct phy_device *phydev)\n{\n\tu32 rd_dat;\n\tint ret;\n\n\trd_dat = vsc85xx_csr_read(phydev, MACRO_CTRL, PHY_S6G_PLL5G_CFG2);\n\trd_dat &= ~PHY_S6G_PLL5G_CFG2_GAIN_MASK;\n\trd_dat |= PHY_S6G_PLL5G_CFG2_ENA_GAIN;\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_PLL5G_CFG2, rd_dat);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int pll5g_tune(struct phy_device *phydev)\n{\n\tu32 rd_dat;\n\tint ret;\n\n\trd_dat = vsc85xx_csr_read(phydev, MACRO_CTRL, PHY_S6G_PLL5G_CFG2);\n\trd_dat &= ~PHY_S6G_PLL5G_CFG2_ENA_GAIN;\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_PLL5G_CFG2, rd_dat);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_pll_cfg_wr(struct phy_device *phydev,\n\t\t\t\t   const u32 pll_ena_offs,\n\t\t\t\t   const u32 pll_fsm_ctrl_data,\n\t\t\t\t   const u32 pll_fsm_ena)\n{\n\tint ret;\n\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_PLL_CFG,\n\t\t\t\t(pll_fsm_ena << PHY_S6G_PLL_ENA_OFFS_POS) |\n\t\t\t\t(pll_fsm_ctrl_data << PHY_S6G_PLL_FSM_CTRL_DATA_POS) |\n\t\t\t\t(pll_ena_offs << PHY_S6G_PLL_FSM_ENA_POS));\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_common_cfg_wr(struct phy_device *phydev,\n\t\t\t\t      const u32 sys_rst,\n\t\t\t\t      const u32 ena_lane,\n\t\t\t\t      const u32 ena_loop,\n\t\t\t\t      const u32 qrate,\n\t\t\t\t      const u32 if_mode,\n\t\t\t\t      const u32 pwd_tx)\n{\n\t \n\t \n\t \n\t \n\t \n\t \n\n\tint ret;\n\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_COMMON_CFG,\n\t\t\t\t(sys_rst << PHY_S6G_SYS_RST_POS) |\n\t\t\t\t(ena_lane << PHY_S6G_ENA_LANE_POS) |\n\t\t\t\t(ena_loop << PHY_S6G_ENA_LOOP_POS) |\n\t\t\t\t(qrate << PHY_S6G_QRATE_POS) |\n\t\t\t\t(if_mode << PHY_S6G_IF_MODE_POS));\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_des_cfg_wr(struct phy_device *phydev,\n\t\t\t\t   const u32 des_phy_ctrl,\n\t\t\t\t   const u32 des_mbtr_ctrl,\n\t\t\t\t   const u32 des_bw_hyst,\n\t\t\t\t   const u32 des_bw_ana,\n\t\t\t\t   const u32 des_cpmd_sel)\n{\n\tu32 reg_val;\n\tint ret;\n\n\t \n\treg_val = (des_phy_ctrl << PHY_S6G_DES_PHY_CTRL_POS) |\n\t\t  (des_mbtr_ctrl << PHY_S6G_DES_MBTR_CTRL_POS) |\n\t\t  (des_cpmd_sel << PHY_S6G_DES_CPMD_SEL_POS) |\n\t\t  (des_bw_hyst << PHY_S6G_DES_BW_HYST_POS) |\n\t\t  (des_bw_ana << PHY_S6G_DES_BW_ANA_POS);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_DES_CFG,\n\t\t\t\treg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_ib_cfg0_wr(struct phy_device *phydev,\n\t\t\t\t   const u32 ib_rtrm_adj,\n\t\t\t\t   const u32 ib_sig_det_clk_sel,\n\t\t\t\t   const u32 ib_reg_pat_sel_offset,\n\t\t\t\t   const u32 ib_cal_ena)\n{\n\tu32 base_val;\n\tu32 reg_val;\n\tint ret;\n\n\t \n\tbase_val = 0x60a85837;\n\t \n\treg_val = base_val | (ib_rtrm_adj << 25) |\n\t\t  (ib_sig_det_clk_sel << 16) |\n\t\t  (ib_reg_pat_sel_offset << 8) |\n\t\t  (ib_cal_ena << 3);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_IB_CFG0,\n\t\t\t\treg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_ib_cfg1_wr(struct phy_device *phydev,\n\t\t\t\t   const u32 ib_tjtag,\n\t\t\t\t   const u32 ib_tsdet,\n\t\t\t\t   const u32 ib_scaly,\n\t\t\t\t   const u32 ib_frc_offset,\n\t\t\t\t   const u32 ib_filt_offset)\n{\n\tu32 ib_filt_val;\n\tu32 reg_val = 0;\n\tint ret;\n\n\t \n\tib_filt_val = 0xe0;\n\t \n\treg_val  = (ib_tjtag << 17) + (ib_tsdet << 12) + (ib_scaly << 8) +\n\t\t   ib_filt_val + (ib_filt_offset << 4) + (ib_frc_offset << 0);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_IB_CFG1,\n\t\t\t\treg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_ib_cfg2_wr(struct phy_device *phydev,\n\t\t\t\t   const u32 ib_tinfv,\n\t\t\t\t   const u32 ib_tcalv,\n\t\t\t\t   const u32 ib_ureg)\n{\n\tu32 ib_cfg2_val;\n\tu32 base_val;\n\tint ret;\n\n\t \n\tbase_val = 0x0f878010;\n\t \n\tib_cfg2_val = base_val | ((ib_tinfv) << 28) | ((ib_tcalv) << 5) |\n\t\t      (ib_ureg << 0);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_IB_CFG2,\n\t\t\t\tib_cfg2_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_ib_cfg3_wr(struct phy_device *phydev,\n\t\t\t\t   const u32 ib_ini_hp,\n\t\t\t\t   const u32 ib_ini_mid,\n\t\t\t\t   const u32 ib_ini_lp,\n\t\t\t\t   const u32 ib_ini_offset)\n{\n\tu32 reg_val;\n\tint ret;\n\n\treg_val  = (ib_ini_hp << 24) + (ib_ini_mid << 16) +\n\t\t   (ib_ini_lp << 8) + (ib_ini_offset << 0);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_IB_CFG3,\n\t\t\t\treg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_ib_cfg4_wr(struct phy_device *phydev,\n\t\t\t\t   const u32 ib_max_hp,\n\t\t\t\t   const u32 ib_max_mid,\n\t\t\t\t   const u32 ib_max_lp,\n\t\t\t\t   const u32 ib_max_offset)\n{\n\tu32 reg_val;\n\tint ret;\n\n\treg_val  = (ib_max_hp << 24) + (ib_max_mid << 16) +\n\t\t   (ib_max_lp << 8) + (ib_max_offset << 0);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_IB_CFG4,\n\t\t\t\treg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_misc_cfg_wr(struct phy_device *phydev,\n\t\t\t\t    const u32 lane_rst)\n{\n\tint ret;\n\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_MISC_CFG,\n\t\t\t\tlane_rst);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_gp_cfg_wr(struct phy_device *phydev, const u32 gp_cfg_val)\n{\n\tint ret;\n\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_GP_CFG,\n\t\t\t\tgp_cfg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_dft_cfg2_wr(struct phy_device *phydev,\n\t\t\t\t    const u32 rx_ji_ampl,\n\t\t\t\t    const u32 rx_step_freq,\n\t\t\t\t    const u32 rx_ji_ena,\n\t\t\t\t    const u32 rx_waveform_sel,\n\t\t\t\t    const u32 rx_freqoff_dir,\n\t\t\t\t    const u32 rx_freqoff_ena)\n{\n\tu32 reg_val;\n\tint ret;\n\n\t \n\treg_val = (rx_ji_ampl << 8) | (rx_step_freq << 4) |\n\t\t  (rx_ji_ena << 3) | (rx_waveform_sel << 2) |\n\t\t  (rx_freqoff_dir << 1) | rx_freqoff_ena;\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_IB_DFT_CFG2,\n\t\t\t\treg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nstatic int vsc85xx_sd6g_dft_cfg0_wr(struct phy_device *phydev,\n\t\t\t\t    const u32 prbs_sel,\n\t\t\t\t    const u32 test_mode,\n\t\t\t\t    const u32 rx_dft_ena)\n{\n\tu32 reg_val;\n\tint ret;\n\n\t \n\treg_val = (prbs_sel << 20) | (test_mode << 16) | (rx_dft_ena << 2);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_DFT_CFG0,\n\t\t\t\treg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\n \nstatic int vsc85xx_pll5g_cfg0_wr(struct phy_device *phydev,\n\t\t\t\t const u32 selbgv820)\n{\n\tu32 base_val;\n\tu32 reg_val;\n\tint ret;\n\n\t \n\tbase_val = 0x7036f145;\n\t \n\treg_val = base_val | (selbgv820 << 23);\n\tret = vsc85xx_csr_write(phydev, MACRO_CTRL,\n\t\t\t\tPHY_S6G_PLL5G_CFG0, reg_val);\n\tif (ret)\n\t\tdev_err(&phydev->mdio.dev, \"%s: write error\\n\", __func__);\n\treturn ret;\n}\n\nint vsc85xx_sd6g_config_v2(struct phy_device *phydev)\n{\n\tu32 ib_sig_det_clk_sel_cal = 0;\n\tu32 ib_sig_det_clk_sel_mm  = 7;\n\tu32 pll_fsm_ctrl_data = 60;\n\tunsigned long deadline;\n\tu32 des_bw_ana_val = 3;\n\tu32 ib_tsdet_cal = 16;\n\tu32 ib_tsdet_mm  = 5;\n\tu32 ib_rtrm_adj;\n\tu32 if_mode = 1;\n\tu32 gp_iter = 5;\n\tu32 val32 = 0;\n\tu32 qrate = 1;\n\tu32 iter;\n\tint val = 0;\n\tint ret;\n\n\tphy_base_write(phydev, MSCC_EXT_PAGE_ACCESS, MSCC_PHY_PAGE_STANDARD);\n\n\t \n\tret = pll5g_detune(phydev);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_pll_cfg_wr(phydev, 3, pll_fsm_ctrl_data, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_common_cfg_wr(phydev, 0, 0, 0, qrate, if_mode, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_des_cfg_wr(phydev, 6, 2, 5, des_bw_ana_val, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tib_rtrm_adj = 13;\n\tret = vsc85xx_sd6g_ib_cfg0_wr(phydev, ib_rtrm_adj, ib_sig_det_clk_sel_mm, 0, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg1_wr(phydev, 8, ib_tsdet_mm, 15, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg2_wr(phydev, 3, 13, 5);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg3_wr(phydev,  0, 31, 1, 31);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg4_wr(phydev, 63, 63, 2, 63);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_common_cfg_wr(phydev, 1, 1, 0, qrate, if_mode, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_misc_cfg_wr(phydev, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_pll_cfg_wr(phydev, 3, pll_fsm_ctrl_data, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\tdeadline = jiffies + msecs_to_jiffies(PROC_CMD_NCOMPLETED_TIMEOUT_MS);\n\tdo {\n\t\tusleep_range(500, 1000);\n\t\tret = phy_update_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tval32 = vsc85xx_csr_read(phydev, MACRO_CTRL,\n\t\t\t\t\t PHY_S6G_PLL_STATUS);\n\t\t \n\t} while (time_before(jiffies, deadline) && (val32 & BIT(12)));\n\n\tif (val32 & BIT(12))\n\t\treturn -ETIMEDOUT;\n\n\t \n\tret = vsc85xx_sd6g_misc_cfg_wr(phydev, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_common_cfg_wr(phydev, 1, 1, 0, qrate, if_mode, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_gp_cfg_wr(phydev, 768);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_dft_cfg2_wr(phydev, 0, 2, 0, 0, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_dft_cfg0_wr(phydev, 0, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_des_cfg_wr(phydev, 6, 2, 5, des_bw_ana_val, 2);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_ib_cfg1_wr(phydev, 8, ib_tsdet_cal, 15, 1, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg0_wr(phydev, ib_rtrm_adj, ib_sig_det_clk_sel_cal, 0, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_ib_cfg0_wr(phydev, ib_rtrm_adj,\n\t\t\t\t      ib_sig_det_clk_sel_cal, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\t \n\tfor (iter = 0; iter < gp_iter; iter++) {\n\t\t \n\t\tret = vsc85xx_sd6g_gp_cfg_wr(phydev, 769);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\t \n\t\tret = vsc85xx_sd6g_gp_cfg_wr(phydev, 768);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = vsc85xx_sd6g_ib_cfg1_wr(phydev, 8, ib_tsdet_cal, 15, 1, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg1_wr(phydev, 8, ib_tsdet_cal, 15, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tdeadline = jiffies + msecs_to_jiffies(PROC_CMD_NCOMPLETED_TIMEOUT_MS);\n\tdo {\n\t\tusleep_range(500, 1000);\n\t\tret = phy_update_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tval32 = vsc85xx_csr_read(phydev, MACRO_CTRL,\n\t\t\t\t\t PHY_S6G_IB_STATUS0);\n\t\t \n\t} while (time_before(jiffies, deadline) && (~val32 & BIT(8)));\n\n\tif (~val32 & BIT(8))\n\t\treturn -ETIMEDOUT;\n\n\t \n\tret = vsc85xx_sd6g_ib_cfg0_wr(phydev, ib_rtrm_adj, ib_sig_det_clk_sel_mm, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg1_wr(phydev, 8, ib_tsdet_mm, 15, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_common_cfg_wr(phydev, 1, 1, 0, qrate, if_mode, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_dft_cfg2_wr(phydev, 0, 0, 0, 0, 0, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_dft_cfg0_wr(phydev, 0, 0, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_des_cfg_wr(phydev, 6, 2, 5, des_bw_ana_val, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = pll5g_tune(phydev);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\t \n\tret = vsc85xx_sd6g_pll_cfg_wr(phydev, 3, pll_fsm_ctrl_data, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_common_cfg_wr(phydev, 0, 1, 0, qrate, if_mode, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tphy_base_write(phydev, MSCC_EXT_PAGE_ACCESS, MSCC_PHY_PAGE_EXTENDED_GPIO);\n\tret = phy_base_read(phydev, MSCC_PHY_MAC_CFG_FASTLINK);\n\tif ((ret & MAC_CFG_MASK) == MAC_CFG_QSGMII) {\n\t\t \n\t\tpll_fsm_ctrl_data = 120;\n\t\tqrate   = 0;\n\t\tif_mode = 3;\n\t\tdes_bw_ana_val = 5;\n\t\tval = PROC_CMD_MCB_ACCESS_MAC_CONF | PROC_CMD_RST_CONF_PORT |\n\t\t\tPROC_CMD_READ_MOD_WRITE_PORT | PROC_CMD_QSGMII_MAC;\n\n\t\tret = vsc8584_cmd(phydev, val);\n\t\tif (ret) {\n\t\t\tdev_err(&phydev->mdio.dev, \"%s: QSGMII error: %d\\n\",\n\t\t\t\t__func__, ret);\n\t\t\treturn ret;\n\t\t}\n\n\t\tphy_base_write(phydev, MSCC_EXT_PAGE_ACCESS, MSCC_PHY_PAGE_STANDARD);\n\t} else if ((ret & MAC_CFG_MASK) == MAC_CFG_SGMII) {\n\t\t \n\t\tpll_fsm_ctrl_data = 60;\n\t\tqrate   = 1;\n\t\tif_mode = 1;\n\t\tdes_bw_ana_val = 3;\n\n\t\tval = PROC_CMD_MCB_ACCESS_MAC_CONF | PROC_CMD_RST_CONF_PORT |\n\t\t\tPROC_CMD_READ_MOD_WRITE_PORT | PROC_CMD_SGMII_MAC;\n\n\t\tret = vsc8584_cmd(phydev, val);\n\t\tif (ret) {\n\t\t\tdev_err(&phydev->mdio.dev, \"%s: SGMII error: %d\\n\",\n\t\t\t\t__func__, ret);\n\t\t\treturn ret;\n\t\t}\n\n\t\tphy_base_write(phydev, MSCC_EXT_PAGE_ACCESS, MSCC_PHY_PAGE_STANDARD);\n\t} else {\n\t\tdev_err(&phydev->mdio.dev, \"%s: invalid mac_if: %x\\n\",\n\t\t\t__func__, ret);\n\t}\n\n\tret = phy_update_mcb_s6g(phydev, PHY_S6G_LCPLL_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_update_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_pll5g_cfg0_wr(phydev, 4);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_S6G_LCPLL_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_des_cfg_wr(phydev, 6, 2, 5, des_bw_ana_val, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg0_wr(phydev, ib_rtrm_adj, ib_sig_det_clk_sel_mm, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg1_wr(phydev, 8, ib_tsdet_mm, 15, 0, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_common_cfg_wr(phydev, 1, 1, 0, qrate, if_mode, 0);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg2_wr(phydev, 3, 13, 5);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg3_wr(phydev,  0, 31, 1, 31);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_ib_cfg4_wr(phydev, 63, 63, 2, 63);\n\tif (ret)\n\t\treturn ret;\n\tret = vsc85xx_sd6g_misc_cfg_wr(phydev, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tret = vsc85xx_sd6g_pll_cfg_wr(phydev, 3, pll_fsm_ctrl_data, 1);\n\tif (ret)\n\t\treturn ret;\n\tret = phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tdeadline = jiffies + msecs_to_jiffies(PROC_CMD_NCOMPLETED_TIMEOUT_MS);\n\tdo {\n\t\tusleep_range(500, 1000);\n\t\tret = phy_update_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tval32 = vsc85xx_csr_read(phydev, MACRO_CTRL,\n\t\t\t\t\t PHY_S6G_PLL_STATUS);\n\t\t \n\t} while (time_before(jiffies, deadline) && (val32 & BIT(12)));\n\n\tif (val32 & BIT(12))\n\t\treturn -ETIMEDOUT;\n\n\t \n\tret = vsc85xx_sd6g_misc_cfg_wr(phydev, 0);\n\tif (ret)\n\t\treturn ret;\n\n\treturn phy_commit_mcb_s6g(phydev, PHY_MCB_S6G_CFG, 0);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}