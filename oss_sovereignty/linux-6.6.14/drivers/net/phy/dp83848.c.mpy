{
  "module_name": "dp83848.c",
  "hash_id": "596cc52c197241575aebc803d7e667048d5f2ee5a7065cd981085d868bd002ef",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/phy/dp83848.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/phy.h>\n\n#define TI_DP83848C_PHY_ID\t\t0x20005ca0\n#define TI_DP83620_PHY_ID\t\t0x20005ce0\n#define NS_DP83848C_PHY_ID\t\t0x20005c90\n#define TLK10X_PHY_ID\t\t\t0x2000a210\n\n \n#define DP83848_MICR\t\t\t0x11  \n#define DP83848_MISR\t\t\t0x12  \n\n \n#define DP83848_MICR_INT_OE\t\tBIT(0)  \n#define DP83848_MICR_INTEN\t\tBIT(1)  \n\n \n#define DP83848_MISR_RHF_INT_EN\t\tBIT(0)  \n#define DP83848_MISR_FHF_INT_EN\t\tBIT(1)  \n#define DP83848_MISR_ANC_INT_EN\t\tBIT(2)  \n#define DP83848_MISR_DUP_INT_EN\t\tBIT(3)  \n#define DP83848_MISR_SPD_INT_EN\t\tBIT(4)  \n#define DP83848_MISR_LINK_INT_EN\tBIT(5)  \n#define DP83848_MISR_ED_INT_EN\t\tBIT(6)  \n#define DP83848_MISR_LQM_INT_EN\t\tBIT(7)  \n\n#define DP83848_INT_EN_MASK\t\t\\\n\t(DP83848_MISR_ANC_INT_EN |\t\\\n\t DP83848_MISR_DUP_INT_EN |\t\\\n\t DP83848_MISR_SPD_INT_EN |\t\\\n\t DP83848_MISR_LINK_INT_EN)\n\n#define DP83848_MISR_RHF_INT\t\tBIT(8)\n#define DP83848_MISR_FHF_INT\t\tBIT(9)\n#define DP83848_MISR_ANC_INT\t\tBIT(10)\n#define DP83848_MISR_DUP_INT\t\tBIT(11)\n#define DP83848_MISR_SPD_INT\t\tBIT(12)\n#define DP83848_MISR_LINK_INT\t\tBIT(13)\n#define DP83848_MISR_ED_INT\t\tBIT(14)\n\n#define DP83848_INT_MASK\t\t\\\n\t(DP83848_MISR_ANC_INT |\t\\\n\t DP83848_MISR_DUP_INT |\t\\\n\t DP83848_MISR_SPD_INT |\t\\\n\t DP83848_MISR_LINK_INT)\n\nstatic int dp83848_ack_interrupt(struct phy_device *phydev)\n{\n\tint err = phy_read(phydev, DP83848_MISR);\n\n\treturn err < 0 ? err : 0;\n}\n\nstatic int dp83848_config_intr(struct phy_device *phydev)\n{\n\tint control, ret;\n\n\tcontrol = phy_read(phydev, DP83848_MICR);\n\tif (control < 0)\n\t\treturn control;\n\n\tif (phydev->interrupts == PHY_INTERRUPT_ENABLED) {\n\t\tret = dp83848_ack_interrupt(phydev);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tcontrol |= DP83848_MICR_INT_OE;\n\t\tcontrol |= DP83848_MICR_INTEN;\n\n\t\tret = phy_write(phydev, DP83848_MISR, DP83848_INT_EN_MASK);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\n\t\tret = phy_write(phydev, DP83848_MICR, control);\n\t} else {\n\t\tcontrol &= ~DP83848_MICR_INTEN;\n\t\tret = phy_write(phydev, DP83848_MICR, control);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = dp83848_ack_interrupt(phydev);\n\t}\n\n\treturn ret;\n}\n\nstatic irqreturn_t dp83848_handle_interrupt(struct phy_device *phydev)\n{\n\tint irq_status;\n\n\tirq_status = phy_read(phydev, DP83848_MISR);\n\tif (irq_status < 0) {\n\t\tphy_error(phydev);\n\t\treturn IRQ_NONE;\n\t}\n\n\tif (!(irq_status & DP83848_INT_MASK))\n\t\treturn IRQ_NONE;\n\n\tphy_trigger_machine(phydev);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int dp83848_config_init(struct phy_device *phydev)\n{\n\tint val;\n\n\t \n\tval = phy_read(phydev, MII_BMCR);\n\tif (!(val & BMCR_ANENABLE))\n\t\tphydev->autoneg = AUTONEG_DISABLE;\n\n\treturn 0;\n}\n\nstatic struct mdio_device_id __maybe_unused dp83848_tbl[] = {\n\t{ TI_DP83848C_PHY_ID, 0xfffffff0 },\n\t{ NS_DP83848C_PHY_ID, 0xfffffff0 },\n\t{ TI_DP83620_PHY_ID, 0xfffffff0 },\n\t{ TLK10X_PHY_ID, 0xfffffff0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(mdio, dp83848_tbl);\n\n#define DP83848_PHY_DRIVER(_id, _name, _config_init)\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.phy_id\t\t= _id,\t\t\t\t\\\n\t\t.phy_id_mask\t= 0xfffffff0,\t\t\t\\\n\t\t.name\t\t= _name,\t\t\t\\\n\t\t \t\t\t\\\n\t\t\t\t\t\t\t\t\\\n\t\t.soft_reset\t= genphy_soft_reset,\t\t\\\n\t\t.config_init\t= _config_init,\t\t\t\\\n\t\t.suspend\t= genphy_suspend,\t\t\\\n\t\t.resume\t\t= genphy_resume,\t\t\\\n\t\t\t\t\t\t\t\t\\\n\t\t \t\t\t\t\\\n\t\t.config_intr\t= dp83848_config_intr,\t\t\\\n\t\t.handle_interrupt = dp83848_handle_interrupt,\t\\\n\t}\n\nstatic struct phy_driver dp83848_driver[] = {\n\tDP83848_PHY_DRIVER(TI_DP83848C_PHY_ID, \"TI DP83848C 10/100 Mbps PHY\",\n\t\t\t   NULL),\n\tDP83848_PHY_DRIVER(NS_DP83848C_PHY_ID, \"NS DP83848C 10/100 Mbps PHY\",\n\t\t\t   NULL),\n\tDP83848_PHY_DRIVER(TI_DP83620_PHY_ID, \"TI DP83620 10/100 Mbps PHY\",\n\t\t\t   dp83848_config_init),\n\tDP83848_PHY_DRIVER(TLK10X_PHY_ID, \"TI TLK10X 10/100 Mbps PHY\",\n\t\t\t   NULL),\n};\nmodule_phy_driver(dp83848_driver);\n\nMODULE_DESCRIPTION(\"Texas Instruments DP83848 PHY driver\");\nMODULE_AUTHOR(\"Andrew F. Davis <afd@ti.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}