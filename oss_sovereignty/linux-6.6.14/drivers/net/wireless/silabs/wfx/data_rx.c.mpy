{
  "module_name": "data_rx.c",
  "hash_id": "967f8878f24974c5b841930907015be7250f5cd2a22c46342bbe81783f274c0c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/silabs/wfx/data_rx.c",
  "human_readable_source": "\n \n#include <linux/etherdevice.h>\n#include <net/mac80211.h>\n\n#include \"data_rx.h\"\n#include \"wfx.h\"\n#include \"bh.h\"\n#include \"sta.h\"\n\nstatic void wfx_rx_handle_ba(struct wfx_vif *wvif, struct ieee80211_mgmt *mgmt)\n{\n\tstruct ieee80211_vif *vif = wvif_to_vif(wvif);\n\tint params, tid;\n\n\tif (wfx_api_older_than(wvif->wdev, 3, 6))\n\t\treturn;\n\n\tswitch (mgmt->u.action.u.addba_req.action_code) {\n\tcase WLAN_ACTION_ADDBA_REQ:\n\t\tparams = le16_to_cpu(mgmt->u.action.u.addba_req.capab);\n\t\ttid = (params & IEEE80211_ADDBA_PARAM_TID_MASK) >> 2;\n\t\tieee80211_start_rx_ba_session_offl(vif, mgmt->sa, tid);\n\t\tbreak;\n\tcase WLAN_ACTION_DELBA:\n\t\tparams = le16_to_cpu(mgmt->u.action.u.delba.params);\n\t\ttid = (params &  IEEE80211_DELBA_PARAM_TID_MASK) >> 12;\n\t\tieee80211_stop_rx_ba_session_offl(vif, mgmt->sa, tid);\n\t\tbreak;\n\t}\n}\n\nvoid wfx_rx_cb(struct wfx_vif *wvif, const struct wfx_hif_ind_rx *arg, struct sk_buff *skb)\n{\n\tstruct ieee80211_rx_status *hdr = IEEE80211_SKB_RXCB(skb);\n\tstruct ieee80211_hdr *frame = (struct ieee80211_hdr *)skb->data;\n\tstruct ieee80211_mgmt *mgmt = (struct ieee80211_mgmt *)skb->data;\n\n\tmemset(hdr, 0, sizeof(*hdr));\n\n\tif (arg->status == HIF_STATUS_RX_FAIL_MIC)\n\t\thdr->flag |= RX_FLAG_MMIC_ERROR | RX_FLAG_IV_STRIPPED;\n\telse if (arg->status)\n\t\tgoto drop;\n\n\tif (skb->len < sizeof(struct ieee80211_pspoll)) {\n\t\tdev_warn(wvif->wdev->dev, \"malformed SDU received\\n\");\n\t\tgoto drop;\n\t}\n\n\thdr->band = NL80211_BAND_2GHZ;\n\thdr->freq = ieee80211_channel_to_frequency(arg->channel_number, hdr->band);\n\n\tif (arg->rxed_rate >= 14) {\n\t\thdr->encoding = RX_ENC_HT;\n\t\thdr->rate_idx = arg->rxed_rate - 14;\n\t} else if (arg->rxed_rate >= 4) {\n\t\thdr->rate_idx = arg->rxed_rate - 2;\n\t} else {\n\t\thdr->rate_idx = arg->rxed_rate;\n\t}\n\n\tif (!arg->rcpi_rssi) {\n\t\thdr->flag |= RX_FLAG_NO_SIGNAL_VAL;\n\t\tdev_info(wvif->wdev->dev, \"received frame without RSSI data\\n\");\n\t}\n\thdr->signal = arg->rcpi_rssi / 2 - 110;\n\thdr->antenna = 0;\n\n\tif (arg->encryp)\n\t\thdr->flag |= RX_FLAG_DECRYPTED;\n\n\t \n\tif (ieee80211_is_action(frame->frame_control) &&\n\t    mgmt->u.action.category == WLAN_CATEGORY_BACK &&\n\t    skb->len > IEEE80211_MIN_ACTION_SIZE) {\n\t\twfx_rx_handle_ba(wvif, mgmt);\n\t\tgoto drop;\n\t}\n\n\tieee80211_rx_irqsafe(wvif->wdev->hw, skb);\n\treturn;\n\ndrop:\n\tdev_kfree_skb(skb);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}