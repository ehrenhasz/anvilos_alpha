{
  "module_name": "mt76x02_mac.h",
  "hash_id": "a25445bcb6ebcbb15eefabe29955c39013e7ee2ec4dedd41f619e486b77ce4d2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt76x02_mac.h",
  "human_readable_source": " \n \n\n#ifndef __MT76X02_MAC_H\n#define __MT76X02_MAC_H\n\nstruct mt76x02_dev;\n\nstruct mt76x02_tx_status {\n\tu8 valid:1;\n\tu8 success:1;\n\tu8 aggr:1;\n\tu8 ack_req:1;\n\tu8 wcid;\n\tu8 pktid;\n\tu8 retry;\n\tu16 rate;\n} __packed __aligned(2);\n\n#define MT_VIF_WCID(_n)\t\t(254 - ((_n) & 7))\n#define MT_MAX_VIFS\t\t8\n\n#define MT_PKTID_RATE\t\tGENMASK(4, 0)\n#define MT_PKTID_AC\t\tGENMASK(6, 5)\n\nstruct mt76x02_vif {\n\tstruct mt76_wcid group_wcid;  \n\tu8 idx;\n};\n\nDECLARE_EWMA(pktlen, 8, 8);\n\nstruct mt76x02_sta {\n\tstruct mt76_wcid wcid;  \n\n\tstruct mt76x02_vif *vif;\n\tstruct mt76x02_tx_status status;\n\tint n_frames;\n\n\tstruct ewma_pktlen pktlen;\n};\n\n#define MT_RXINFO_BA\t\t\tBIT(0)\n#define MT_RXINFO_DATA\t\t\tBIT(1)\n#define MT_RXINFO_NULL\t\t\tBIT(2)\n#define MT_RXINFO_FRAG\t\t\tBIT(3)\n#define MT_RXINFO_UNICAST\t\tBIT(4)\n#define MT_RXINFO_MULTICAST\t\tBIT(5)\n#define MT_RXINFO_BROADCAST\t\tBIT(6)\n#define MT_RXINFO_MYBSS\t\t\tBIT(7)\n#define MT_RXINFO_CRCERR\t\tBIT(8)\n#define MT_RXINFO_ICVERR\t\tBIT(9)\n#define MT_RXINFO_MICERR\t\tBIT(10)\n#define MT_RXINFO_AMSDU\t\t\tBIT(11)\n#define MT_RXINFO_HTC\t\t\tBIT(12)\n#define MT_RXINFO_RSSI\t\t\tBIT(13)\n#define MT_RXINFO_L2PAD\t\t\tBIT(14)\n#define MT_RXINFO_AMPDU\t\t\tBIT(15)\n#define MT_RXINFO_DECRYPT\t\tBIT(16)\n#define MT_RXINFO_BSSIDX3\t\tBIT(17)\n#define MT_RXINFO_WAPI_KEY\t\tBIT(18)\n#define MT_RXINFO_PN_LEN\t\tGENMASK(21, 19)\n#define MT_RXINFO_SW_FTYPE0\t\tBIT(22)\n#define MT_RXINFO_SW_FTYPE1\t\tBIT(23)\n#define MT_RXINFO_PROBE_RESP\t\tBIT(24)\n#define MT_RXINFO_BEACON\t\tBIT(25)\n#define MT_RXINFO_DISASSOC\t\tBIT(26)\n#define MT_RXINFO_DEAUTH\t\tBIT(27)\n#define MT_RXINFO_ACTION\t\tBIT(28)\n#define MT_RXINFO_TCP_SUM_ERR\t\tBIT(30)\n#define MT_RXINFO_IP_SUM_ERR\t\tBIT(31)\n\n#define MT_RXWI_CTL_WCID\t\tGENMASK(7, 0)\n#define MT_RXWI_CTL_KEY_IDX\t\tGENMASK(9, 8)\n#define MT_RXWI_CTL_BSS_IDX\t\tGENMASK(12, 10)\n#define MT_RXWI_CTL_UDF\t\t\tGENMASK(15, 13)\n#define MT_RXWI_CTL_MPDU_LEN\t\tGENMASK(29, 16)\n#define MT_RXWI_CTL_EOF\t\t\tBIT(31)\n\n#define MT_RXWI_TID\t\t\tGENMASK(3, 0)\n#define MT_RXWI_SN\t\t\tGENMASK(15, 4)\n\n#define MT_RXWI_RATE_INDEX\t\tGENMASK(5, 0)\n#define MT_RXWI_RATE_LDPC\t\tBIT(6)\n#define MT_RXWI_RATE_BW\t\t\tGENMASK(8, 7)\n#define MT_RXWI_RATE_SGI\t\tBIT(9)\n#define MT_RXWI_RATE_STBC\t\tBIT(10)\n#define MT_RXWI_RATE_LDPC_EXSYM\t\tBIT(11)\n#define MT_RXWI_RATE_PHY\t\tGENMASK(15, 13)\n\n#define MT_RATE_INDEX_VHT_IDX\t\tGENMASK(3, 0)\n#define MT_RATE_INDEX_VHT_NSS\t\tGENMASK(5, 4)\n\nstruct mt76x02_rxwi {\n\t__le32 rxinfo;\n\n\t__le32 ctl;\n\n\t__le16 tid_sn;\n\t__le16 rate;\n\n\tu8 rssi[4];\n\n\t__le32 bbp_rxinfo[4];\n};\n\n#define MT_TX_PWR_ADJ\t\t\tGENMASK(3, 0)\n\nenum mt76x2_phy_bandwidth {\n\tMT_PHY_BW_20,\n\tMT_PHY_BW_40,\n\tMT_PHY_BW_80,\n};\n\n#define MT_TXWI_FLAGS_FRAG\t\tBIT(0)\n#define MT_TXWI_FLAGS_MMPS\t\tBIT(1)\n#define MT_TXWI_FLAGS_CFACK\t\tBIT(2)\n#define MT_TXWI_FLAGS_TS\t\tBIT(3)\n#define MT_TXWI_FLAGS_AMPDU\t\tBIT(4)\n#define MT_TXWI_FLAGS_MPDU_DENSITY\tGENMASK(7, 5)\n#define MT_TXWI_FLAGS_TXOP\t\tGENMASK(9, 8)\n#define MT_TXWI_FLAGS_NDPS\t\tBIT(10)\n#define MT_TXWI_FLAGS_RTSBWSIG\t\tBIT(11)\n#define MT_TXWI_FLAGS_NDP_BW\t\tGENMASK(13, 12)\n#define MT_TXWI_FLAGS_SOUND\t\tBIT(14)\n#define MT_TXWI_FLAGS_TX_RATE_LUT\tBIT(15)\n\n#define MT_TXWI_ACK_CTL_REQ\t\tBIT(0)\n#define MT_TXWI_ACK_CTL_NSEQ\t\tBIT(1)\n#define MT_TXWI_ACK_CTL_BA_WINDOW\tGENMASK(7, 2)\n\nstruct mt76x02_txwi {\n\t__le16 flags;\n\t__le16 rate;\n\tu8 ack_ctl;\n\tu8 wcid;\n\t__le16 len_ctl;\n\t__le32 iv;\n\t__le32 eiv;\n\tu8 aid;\n\tu8 txstream;\n\tu8 ctl2;\n\tu8 pktid;\n} __packed __aligned(4);\n\nstatic inline bool mt76x02_wait_for_mac(struct mt76_dev *dev)\n{\n\tconst u32 MAC_CSR0 = 0x1000;\n\tint i;\n\n\tfor (i = 0; i < 500; i++) {\n\t\tif (test_bit(MT76_REMOVED, &dev->phy.state))\n\t\t\treturn false;\n\n\t\tswitch (dev->bus->rr(dev, MAC_CSR0)) {\n\t\tcase 0:\n\t\tcase ~0:\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn true;\n\t\t}\n\t\tusleep_range(5000, 10000);\n\t}\n\treturn false;\n}\n\nvoid mt76x02_mac_reset_counters(struct mt76x02_dev *dev);\nvoid mt76x02_mac_set_short_preamble(struct mt76x02_dev *dev, bool enable);\nint mt76x02_mac_shared_key_setup(struct mt76x02_dev *dev, u8 vif_idx,\n\t\t\t\t u8 key_idx, struct ieee80211_key_conf *key);\nint mt76x02_mac_wcid_set_key(struct mt76x02_dev *dev, u8 idx,\n\t\t\t     struct ieee80211_key_conf *key);\nvoid mt76x02_mac_wcid_sync_pn(struct mt76x02_dev *dev, u8 idx,\n\t\t\t      struct ieee80211_key_conf *key);\nvoid mt76x02_mac_wcid_setup(struct mt76x02_dev *dev, u8 idx, u8 vif_idx,\n\t\t\t    u8 *mac);\nvoid mt76x02_mac_wcid_set_drop(struct mt76x02_dev *dev, u8 idx, bool drop);\nvoid mt76x02_mac_wcid_set_rate(struct mt76x02_dev *dev, struct mt76_wcid *wcid,\n\t\t\t       const struct ieee80211_tx_rate *rate);\nbool mt76x02_mac_load_tx_status(struct mt76x02_dev *dev,\n\t\t\t\tstruct mt76x02_tx_status *stat);\nvoid mt76x02_send_tx_status(struct mt76x02_dev *dev,\n\t\t\t    struct mt76x02_tx_status *stat, u8 *update);\nint mt76x02_mac_process_rx(struct mt76x02_dev *dev, struct sk_buff *skb,\n\t\t\t   void *rxi);\nvoid mt76x02_mac_set_tx_protection(struct mt76x02_dev *dev, bool legacy_prot,\n\t\t\t\t   int ht_mode);\nvoid mt76x02_mac_set_rts_thresh(struct mt76x02_dev *dev, u32 val);\nvoid mt76x02_mac_setaddr(struct mt76x02_dev *dev, const u8 *addr);\nvoid mt76x02_mac_write_txwi(struct mt76x02_dev *dev, struct mt76x02_txwi *txwi,\n\t\t\t    struct sk_buff *skb, struct mt76_wcid *wcid,\n\t\t\t    struct ieee80211_sta *sta, int len);\nvoid mt76x02_mac_poll_tx_status(struct mt76x02_dev *dev, bool irq);\nvoid mt76x02_tx_complete_skb(struct mt76_dev *mdev, struct mt76_queue_entry *e);\nvoid mt76x02_update_channel(struct mt76_phy *mphy);\nvoid mt76x02_mac_work(struct work_struct *work);\n\nvoid mt76x02_mac_cc_reset(struct mt76x02_dev *dev);\nvoid mt76x02_mac_set_bssid(struct mt76x02_dev *dev, u8 idx, const u8 *addr);\nvoid mt76x02_mac_set_beacon(struct mt76x02_dev *dev, struct sk_buff *skb);\nvoid mt76x02_mac_set_beacon_enable(struct mt76x02_dev *dev,\n\t\t\t\t   struct ieee80211_vif *vif, bool enable);\n\nvoid mt76x02_edcca_init(struct mt76x02_dev *dev);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}