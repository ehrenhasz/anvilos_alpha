{
  "module_name": "mt7996.h",
  "hash_id": "cc38d1ec85a17a1aa0ca14874afc9eee48114e5a1db6bd4024ad03dc67de12cb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt7996/mt7996.h",
  "human_readable_source": " \n \n\n#ifndef __MT7996_H\n#define __MT7996_H\n\n#include <linux/interrupt.h>\n#include <linux/ktime.h>\n#include \"../mt76_connac.h\"\n#include \"regs.h\"\n\n#define MT7996_MAX_INTERFACES\t\t19\t \n#define MT7996_MAX_WMM_SETS\t\t4\n#define MT7996_WTBL_RESERVED\t\t(mt7996_wtbl_size(dev) - 1)\n#define MT7996_WTBL_STA\t\t\t(MT7996_WTBL_RESERVED - \\\n\t\t\t\t\t mt7996_max_interface_num(dev))\n\n#define MT7996_WATCHDOG_TIME\t\t(HZ / 10)\n#define MT7996_RESET_TIMEOUT\t\t(30 * HZ)\n\n#define MT7996_TX_RING_SIZE\t\t2048\n#define MT7996_TX_MCU_RING_SIZE\t\t256\n#define MT7996_TX_FWDL_RING_SIZE\t128\n\n#define MT7996_RX_RING_SIZE\t\t1536\n#define MT7996_RX_MCU_RING_SIZE\t\t512\n#define MT7996_RX_MCU_RING_SIZE_WA\t1024\n\n#define MT7996_FIRMWARE_WA\t\t\"mediatek/mt7996/mt7996_wa.bin\"\n#define MT7996_FIRMWARE_WM\t\t\"mediatek/mt7996/mt7996_wm.bin\"\n#define MT7996_FIRMWARE_DSP\t\t\"mediatek/mt7996/mt7996_dsp.bin\"\n#define MT7996_ROM_PATCH\t\t\"mediatek/mt7996/mt7996_rom_patch.bin\"\n\n#define MT7996_EEPROM_DEFAULT\t\t\"mediatek/mt7996/mt7996_eeprom.bin\"\n#define MT7996_EEPROM_SIZE\t\t7680\n#define MT7996_EEPROM_BLOCK_SIZE\t16\n#define MT7996_TOKEN_SIZE\t\t16384\n\n#define MT7996_CFEND_RATE_DEFAULT\t0x49\t \n#define MT7996_CFEND_RATE_11B\t\t0x03\t \n\n#define MT7996_MAX_TWT_AGRT\t\t16\n#define MT7996_MAX_STA_TWT_AGRT\t\t8\n#define MT7996_MAX_QUEUE\t\t(__MT_RXQ_MAX +\t__MT_MCUQ_MAX + 3)\n\n \n#define MT7996_BASIC_RATES_TBL\t\t11\n#define MT7996_BEACON_RATES_TBL\t\t25\n\nstruct mt7996_vif;\nstruct mt7996_sta;\nstruct mt7996_dfs_pulse;\nstruct mt7996_dfs_pattern;\n\nenum mt7996_ram_type {\n\tMT7996_RAM_TYPE_WM,\n\tMT7996_RAM_TYPE_WA,\n\tMT7996_RAM_TYPE_DSP,\n};\n\nenum mt7996_txq_id {\n\tMT7996_TXQ_FWDL = 16,\n\tMT7996_TXQ_MCU_WM,\n\tMT7996_TXQ_BAND0,\n\tMT7996_TXQ_BAND1,\n\tMT7996_TXQ_MCU_WA,\n\tMT7996_TXQ_BAND2,\n};\n\nenum mt7996_rxq_id {\n\tMT7996_RXQ_MCU_WM = 0,\n\tMT7996_RXQ_MCU_WA,\n\tMT7996_RXQ_MCU_WA_MAIN = 2,\n\tMT7996_RXQ_MCU_WA_EXT = 2, \n\tMT7996_RXQ_MCU_WA_TRI = 3,\n\tMT7996_RXQ_BAND0 = 4,\n\tMT7996_RXQ_BAND1 = 4, \n\tMT7996_RXQ_BAND2 = 5,\n};\n\nstruct mt7996_twt_flow {\n\tstruct list_head list;\n\tu64 start_tsf;\n\tu64 tsf;\n\tu32 duration;\n\tu16 wcid;\n\t__le16 mantissa;\n\tu8 exp;\n\tu8 table_id;\n\tu8 id;\n\tu8 protection:1;\n\tu8 flowtype:1;\n\tu8 trigger:1;\n\tu8 sched:1;\n};\n\nDECLARE_EWMA(avg_signal, 10, 8)\n\nstruct mt7996_sta {\n\tstruct mt76_wcid wcid;  \n\n\tstruct mt7996_vif *vif;\n\n\tstruct list_head rc_list;\n\tu32 airtime_ac[8];\n\n\tint ack_signal;\n\tstruct ewma_avg_signal avg_ack_signal;\n\n\tunsigned long changed;\n\tunsigned long jiffies;\n\n\tstruct mt76_connac_sta_key_conf bip;\n\n\tstruct {\n\t\tu8 flowid_mask;\n\t\tstruct mt7996_twt_flow flow[MT7996_MAX_STA_TWT_AGRT];\n\t} twt;\n};\n\nstruct mt7996_vif {\n\tstruct mt76_vif mt76;  \n\n\tstruct mt7996_sta sta;\n\tstruct mt7996_phy *phy;\n\n\tstruct ieee80211_tx_queue_params queue_params[IEEE80211_NUM_ACS];\n\tstruct cfg80211_bitrate_mask bitrate_mask;\n};\n\n \nstruct mt7996_crash_data {\n\tguid_t guid;\n\tstruct timespec64 timestamp;\n\n\tu8 *memdump_buf;\n\tsize_t memdump_buf_len;\n};\n\nstruct mt7996_hif {\n\tstruct list_head list;\n\n\tstruct device *dev;\n\tvoid __iomem *regs;\n\tint irq;\n};\n\nstruct mt7996_phy {\n\tstruct mt76_phy *mt76;\n\tstruct mt7996_dev *dev;\n\n\tstruct ieee80211_sband_iftype_data iftype[NUM_NL80211_BANDS][NUM_NL80211_IFTYPES];\n\n\tstruct ieee80211_vif *monitor_vif;\n\n\tu32 rxfilter;\n\tu64 omac_mask;\n\n\tu16 noise;\n\n\ts16 coverage_class;\n\tu8 slottime;\n\n\tu8 rdd_state;\n\n\tu32 rx_ampdu_ts;\n\tu32 ampdu_ref;\n\n\tstruct mt76_mib_stats mib;\n\tstruct mt76_channel_state state_ts;\n};\n\nstruct mt7996_dev {\n\tunion {  \n\t\tstruct mt76_dev mt76;\n\t\tstruct mt76_phy mphy;\n\t};\n\n\tstruct mt7996_hif *hif2;\n\tstruct mt7996_reg_desc reg;\n\tu8 q_id[MT7996_MAX_QUEUE];\n\tu32 q_int_mask[MT7996_MAX_QUEUE];\n\tu32 q_wfdma_mask;\n\n\tconst struct mt76_bus_ops *bus_ops;\n\tstruct mt7996_phy phy;\n\n\t \n\tstruct cfg80211_chan_def rdd2_chandef;\n\tstruct mt7996_phy *rdd2_phy;\n\n\tu16 chainmask;\n\tu8 chainshift[__MT_MAX_BAND];\n\tu32 hif_idx;\n\n\tstruct work_struct init_work;\n\tstruct work_struct rc_work;\n\tstruct work_struct dump_work;\n\tstruct work_struct reset_work;\n\twait_queue_head_t reset_wait;\n\tstruct {\n\t\tu32 state;\n\t\tu32 wa_reset_count;\n\t\tu32 wm_reset_count;\n\t\tbool hw_full_reset:1;\n\t\tbool hw_init_done:1;\n\t\tbool restart:1;\n\t} recovery;\n\n\t \n\tstruct mutex dump_mutex;\n#ifdef CONFIG_DEV_COREDUMP\n\tstruct {\n\t\tstruct mt7996_crash_data *crash_data;\n\t} coredump;\n#endif\n\n\tstruct list_head sta_rc_list;\n\tstruct list_head twt_list;\n\n\tu32 hw_pattern;\n\n\tbool dbdc_support:1;\n\tbool tbtc_support:1;\n\tbool flash_mode:1;\n\tbool has_eht:1;\n\n\tbool ibf;\n\tu8 fw_debug_wm;\n\tu8 fw_debug_wa;\n\tu8 fw_debug_bin;\n\tu16 fw_debug_seq;\n\n\tstruct dentry *debugfs_dir;\n\tstruct rchan *relay_fwlog;\n\n\tstruct {\n\t\tu8 table_mask;\n\t\tu8 n_agrt;\n\t} twt;\n\n\tu32 reg_l1_backup;\n\tu32 reg_l2_backup;\n\n\tu8 wtbl_size_group;\n};\n\nenum {\n\tWFDMA0 = 0x0,\n\tWFDMA1,\n\tWFDMA_EXT,\n\t__MT_WFDMA_MAX,\n};\n\nenum {\n\tMT_RX_SEL0,\n\tMT_RX_SEL1,\n\tMT_RX_SEL2,  \n};\n\nenum mt7996_rdd_cmd {\n\tRDD_STOP,\n\tRDD_START,\n\tRDD_DET_MODE,\n\tRDD_RADAR_EMULATE,\n\tRDD_START_TXQ = 20,\n\tRDD_CAC_START = 50,\n\tRDD_CAC_END,\n\tRDD_NORMAL_START,\n\tRDD_DISABLE_DFS_CAL,\n\tRDD_PULSE_DBG,\n\tRDD_READ_PULSE,\n\tRDD_RESUME_BF,\n\tRDD_IRQ_OFF,\n};\n\nstatic inline struct mt7996_phy *\nmt7996_hw_phy(struct ieee80211_hw *hw)\n{\n\tstruct mt76_phy *phy = hw->priv;\n\n\treturn phy->priv;\n}\n\nstatic inline struct mt7996_dev *\nmt7996_hw_dev(struct ieee80211_hw *hw)\n{\n\tstruct mt76_phy *phy = hw->priv;\n\n\treturn container_of(phy->dev, struct mt7996_dev, mt76);\n}\n\nstatic inline struct mt7996_phy *\n__mt7996_phy(struct mt7996_dev *dev, enum mt76_band_id band)\n{\n\tstruct mt76_phy *phy = dev->mt76.phys[band];\n\n\tif (!phy)\n\t\treturn NULL;\n\n\treturn phy->priv;\n}\n\nstatic inline struct mt7996_phy *\nmt7996_phy2(struct mt7996_dev *dev)\n{\n\treturn __mt7996_phy(dev, MT_BAND1);\n}\n\nstatic inline struct mt7996_phy *\nmt7996_phy3(struct mt7996_dev *dev)\n{\n\treturn __mt7996_phy(dev, MT_BAND2);\n}\n\nextern const struct ieee80211_ops mt7996_ops;\nextern struct pci_driver mt7996_pci_driver;\nextern struct pci_driver mt7996_hif_driver;\n\nstruct mt7996_dev *mt7996_mmio_probe(struct device *pdev,\n\t\t\t\t     void __iomem *mem_base, u32 device_id);\nvoid mt7996_wfsys_reset(struct mt7996_dev *dev);\nirqreturn_t mt7996_irq_handler(int irq, void *dev_instance);\nu64 __mt7996_get_tsf(struct ieee80211_hw *hw, struct mt7996_vif *mvif);\nint mt7996_register_device(struct mt7996_dev *dev);\nvoid mt7996_unregister_device(struct mt7996_dev *dev);\nint mt7996_eeprom_init(struct mt7996_dev *dev);\nint mt7996_eeprom_parse_hw_cap(struct mt7996_dev *dev, struct mt7996_phy *phy);\nint mt7996_eeprom_get_target_power(struct mt7996_dev *dev,\n\t\t\t\t   struct ieee80211_channel *chan);\ns8 mt7996_eeprom_get_power_delta(struct mt7996_dev *dev, int band);\nint mt7996_dma_init(struct mt7996_dev *dev);\nvoid mt7996_dma_reset(struct mt7996_dev *dev, bool force);\nvoid mt7996_dma_prefetch(struct mt7996_dev *dev);\nvoid mt7996_dma_cleanup(struct mt7996_dev *dev);\nvoid mt7996_dma_start(struct mt7996_dev *dev, bool reset);\nvoid mt7996_init_txpower(struct mt7996_dev *dev,\n\t\t\t struct ieee80211_supported_band *sband);\nint mt7996_txbf_init(struct mt7996_dev *dev);\nvoid mt7996_reset(struct mt7996_dev *dev);\nint mt7996_run(struct ieee80211_hw *hw);\nint mt7996_mcu_init(struct mt7996_dev *dev);\nint mt7996_mcu_init_firmware(struct mt7996_dev *dev);\nint mt7996_mcu_twt_agrt_update(struct mt7996_dev *dev,\n\t\t\t       struct mt7996_vif *mvif,\n\t\t\t       struct mt7996_twt_flow *flow,\n\t\t\t       int cmd);\nint mt7996_mcu_add_dev_info(struct mt7996_phy *phy,\n\t\t\t    struct ieee80211_vif *vif, bool enable);\nint mt7996_mcu_add_bss_info(struct mt7996_phy *phy,\n\t\t\t    struct ieee80211_vif *vif, int enable);\nint mt7996_mcu_add_sta(struct mt7996_dev *dev, struct ieee80211_vif *vif,\n\t\t       struct ieee80211_sta *sta, bool enable);\nint mt7996_mcu_add_tx_ba(struct mt7996_dev *dev,\n\t\t\t struct ieee80211_ampdu_params *params,\n\t\t\t bool add);\nint mt7996_mcu_add_rx_ba(struct mt7996_dev *dev,\n\t\t\t struct ieee80211_ampdu_params *params,\n\t\t\t bool add);\nint mt7996_mcu_update_bss_color(struct mt7996_dev *dev, struct ieee80211_vif *vif,\n\t\t\t\tstruct cfg80211_he_bss_color *he_bss_color);\nint mt7996_mcu_add_beacon(struct ieee80211_hw *hw, struct ieee80211_vif *vif,\n\t\t\t  int enable);\nint mt7996_mcu_beacon_inband_discov(struct mt7996_dev *dev,\n\t\t\t\t    struct ieee80211_vif *vif, u32 changed);\nint mt7996_mcu_add_obss_spr(struct mt7996_phy *phy, struct ieee80211_vif *vif,\n\t\t\t    struct ieee80211_he_obss_pd *he_obss_pd);\nint mt7996_mcu_add_rate_ctrl(struct mt7996_dev *dev, struct ieee80211_vif *vif,\n\t\t\t     struct ieee80211_sta *sta, bool changed);\nint mt7996_set_channel(struct mt7996_phy *phy);\nint mt7996_mcu_set_chan_info(struct mt7996_phy *phy, u16 tag);\nint mt7996_mcu_set_tx(struct mt7996_dev *dev, struct ieee80211_vif *vif);\nint mt7996_mcu_set_fixed_rate_ctrl(struct mt7996_dev *dev,\n\t\t\t\t   void *data, u16 version);\nint mt7996_mcu_set_eeprom(struct mt7996_dev *dev);\nint mt7996_mcu_get_eeprom(struct mt7996_dev *dev, u32 offset);\nint mt7996_mcu_get_eeprom_free_block(struct mt7996_dev *dev, u8 *block_num);\nint mt7996_mcu_get_chip_config(struct mt7996_dev *dev, u32 *cap);\nint mt7996_mcu_set_ser(struct mt7996_dev *dev, u8 action, u8 set, u8 band);\nint mt7996_mcu_set_txbf(struct mt7996_dev *dev, u8 action);\nint mt7996_mcu_set_fcc5_lpn(struct mt7996_dev *dev, int val);\nint mt7996_mcu_set_pulse_th(struct mt7996_dev *dev,\n\t\t\t    const struct mt7996_dfs_pulse *pulse);\nint mt7996_mcu_set_radar_th(struct mt7996_dev *dev, int index,\n\t\t\t    const struct mt7996_dfs_pattern *pattern);\nint mt7996_mcu_set_radio_en(struct mt7996_phy *phy, bool enable);\nint mt7996_mcu_set_rts_thresh(struct mt7996_phy *phy, u32 val);\nint mt7996_mcu_set_timing(struct mt7996_phy *phy, struct ieee80211_vif *vif);\nint mt7996_mcu_get_chan_mib_info(struct mt7996_phy *phy, bool chan_switch);\nint mt7996_mcu_rdd_cmd(struct mt7996_dev *dev, int cmd, u8 index,\n\t\t       u8 rx_sel, u8 val);\nint mt7996_mcu_rdd_background_enable(struct mt7996_phy *phy,\n\t\t\t\t     struct cfg80211_chan_def *chandef);\nint mt7996_mcu_rf_regval(struct mt7996_dev *dev, u32 regidx, u32 *val, bool set);\nint mt7996_mcu_set_hdr_trans(struct mt7996_dev *dev, bool hdr_trans);\nint mt7996_mcu_set_rro(struct mt7996_dev *dev, u16 tag, u8 val);\nint mt7996_mcu_wa_cmd(struct mt7996_dev *dev, int cmd, u32 a1, u32 a2, u32 a3);\nint mt7996_mcu_fw_log_2_host(struct mt7996_dev *dev, u8 type, u8 ctrl);\nint mt7996_mcu_fw_dbg_ctrl(struct mt7996_dev *dev, u32 module, u8 level);\nint mt7996_mcu_trigger_assert(struct mt7996_dev *dev);\nvoid mt7996_mcu_rx_event(struct mt7996_dev *dev, struct sk_buff *skb);\nvoid mt7996_mcu_exit(struct mt7996_dev *dev);\n\nstatic inline u8 mt7996_max_interface_num(struct mt7996_dev *dev)\n{\n\treturn MT7996_MAX_INTERFACES * (1 + dev->dbdc_support + dev->tbtc_support);\n}\n\nstatic inline u16 mt7996_wtbl_size(struct mt7996_dev *dev)\n{\n\treturn (dev->wtbl_size_group << 8) + 64;\n}\n\nvoid mt7996_dual_hif_set_irq_mask(struct mt7996_dev *dev, bool write_reg,\n\t\t\t\t  u32 clear, u32 set);\n\nstatic inline void mt7996_irq_enable(struct mt7996_dev *dev, u32 mask)\n{\n\tif (dev->hif2)\n\t\tmt7996_dual_hif_set_irq_mask(dev, false, 0, mask);\n\telse\n\t\tmt76_set_irq_mask(&dev->mt76, 0, 0, mask);\n\n\ttasklet_schedule(&dev->mt76.irq_tasklet);\n}\n\nstatic inline void mt7996_irq_disable(struct mt7996_dev *dev, u32 mask)\n{\n\tif (dev->hif2)\n\t\tmt7996_dual_hif_set_irq_mask(dev, true, mask, 0);\n\telse\n\t\tmt76_set_irq_mask(&dev->mt76, MT_INT_MASK_CSR, mask, 0);\n}\n\nvoid mt7996_memcpy_fromio(struct mt7996_dev *dev, void *buf, u32 offset,\n\t\t\t  size_t len);\n\nvoid mt7996_mac_init(struct mt7996_dev *dev);\nu32 mt7996_mac_wtbl_lmac_addr(struct mt7996_dev *dev, u16 wcid, u8 dw);\nbool mt7996_mac_wtbl_update(struct mt7996_dev *dev, int idx, u32 mask);\nvoid mt7996_mac_reset_counters(struct mt7996_phy *phy);\nvoid mt7996_mac_cca_stats_reset(struct mt7996_phy *phy);\nvoid mt7996_mac_enable_nf(struct mt7996_dev *dev, u8 band);\nvoid mt7996_mac_enable_rtscts(struct mt7996_dev *dev,\n\t\t\t      struct ieee80211_vif *vif, bool enable);\nvoid mt7996_mac_set_fixed_rate_table(struct mt7996_dev *dev,\n\t\t\t\t     u8 tbl_idx, u16 rate_idx);\nvoid mt7996_mac_write_txwi(struct mt7996_dev *dev, __le32 *txwi,\n\t\t\t   struct sk_buff *skb, struct mt76_wcid *wcid,\n\t\t\t   struct ieee80211_key_conf *key, int pid,\n\t\t\t   enum mt76_txq_id qid, u32 changed);\nvoid mt7996_mac_set_coverage_class(struct mt7996_phy *phy);\nint mt7996_mac_sta_add(struct mt76_dev *mdev, struct ieee80211_vif *vif,\n\t\t       struct ieee80211_sta *sta);\nvoid mt7996_mac_sta_remove(struct mt76_dev *mdev, struct ieee80211_vif *vif,\n\t\t\t   struct ieee80211_sta *sta);\nvoid mt7996_mac_work(struct work_struct *work);\nvoid mt7996_mac_reset_work(struct work_struct *work);\nvoid mt7996_mac_dump_work(struct work_struct *work);\nvoid mt7996_mac_sta_rc_work(struct work_struct *work);\nvoid mt7996_mac_update_stats(struct mt7996_phy *phy);\nvoid mt7996_mac_twt_teardown_flow(struct mt7996_dev *dev,\n\t\t\t\t  struct mt7996_sta *msta,\n\t\t\t\t  u8 flowid);\nvoid mt7996_mac_add_twt_setup(struct ieee80211_hw *hw,\n\t\t\t      struct ieee80211_sta *sta,\n\t\t\t      struct ieee80211_twt_setup *twt);\nint mt7996_tx_prepare_skb(struct mt76_dev *mdev, void *txwi_ptr,\n\t\t\t  enum mt76_txq_id qid, struct mt76_wcid *wcid,\n\t\t\t  struct ieee80211_sta *sta,\n\t\t\t  struct mt76_tx_info *tx_info);\nvoid mt7996_tx_token_put(struct mt7996_dev *dev);\nvoid mt7996_queue_rx_skb(struct mt76_dev *mdev, enum mt76_rxq_id q,\n\t\t\t struct sk_buff *skb, u32 *info);\nbool mt7996_rx_check(struct mt76_dev *mdev, void *data, int len);\nvoid mt7996_stats_work(struct work_struct *work);\nint mt76_dfs_start_rdd(struct mt7996_dev *dev, bool force);\nint mt7996_dfs_init_radar_detector(struct mt7996_phy *phy);\nvoid mt7996_set_stream_he_eht_caps(struct mt7996_phy *phy);\nvoid mt7996_set_stream_vht_txbf_caps(struct mt7996_phy *phy);\nvoid mt7996_update_channel(struct mt76_phy *mphy);\nint mt7996_init_debugfs(struct mt7996_phy *phy);\nvoid mt7996_debugfs_rx_fw_monitor(struct mt7996_dev *dev, const void *data, int len);\nbool mt7996_debugfs_rx_log(struct mt7996_dev *dev, const void *data, int len);\nint mt7996_mcu_add_key(struct mt76_dev *dev, struct ieee80211_vif *vif,\n\t\t       struct mt76_connac_sta_key_conf *sta_key_conf,\n\t\t       struct ieee80211_key_conf *key, int mcu_cmd,\n\t\t       struct mt76_wcid *wcid, enum set_key_cmd cmd);\nint mt7996_mcu_wtbl_update_hdr_trans(struct mt7996_dev *dev,\n\t\t\t\t     struct ieee80211_vif *vif,\n\t\t\t\t     struct ieee80211_sta *sta);\n#ifdef CONFIG_MAC80211_DEBUGFS\nvoid mt7996_sta_add_debugfs(struct ieee80211_hw *hw, struct ieee80211_vif *vif,\n\t\t\t    struct ieee80211_sta *sta, struct dentry *dir);\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}