{
  "module_name": "mmio.c",
  "hash_id": "be75dc1839017c8b6807ca1057e00e721911ed415d6b0ce6ef9e49686cd001c3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mmio.c",
  "human_readable_source": "\n \n\n#include \"mt76.h\"\n#include \"trace.h\"\n\nstatic u32 mt76_mmio_rr(struct mt76_dev *dev, u32 offset)\n{\n\tu32 val;\n\n\tval = readl(dev->mmio.regs + offset);\n\ttrace_reg_rr(dev, offset, val);\n\n\treturn val;\n}\n\nstatic void mt76_mmio_wr(struct mt76_dev *dev, u32 offset, u32 val)\n{\n\ttrace_reg_wr(dev, offset, val);\n\twritel(val, dev->mmio.regs + offset);\n}\n\nstatic u32 mt76_mmio_rmw(struct mt76_dev *dev, u32 offset, u32 mask, u32 val)\n{\n\tval |= mt76_mmio_rr(dev, offset) & ~mask;\n\tmt76_mmio_wr(dev, offset, val);\n\treturn val;\n}\n\nstatic void mt76_mmio_write_copy(struct mt76_dev *dev, u32 offset,\n\t\t\t\t const void *data, int len)\n{\n\t__iowrite32_copy(dev->mmio.regs + offset, data, DIV_ROUND_UP(len, 4));\n}\n\nstatic void mt76_mmio_read_copy(struct mt76_dev *dev, u32 offset,\n\t\t\t\tvoid *data, int len)\n{\n\t__ioread32_copy(data, dev->mmio.regs + offset, DIV_ROUND_UP(len, 4));\n}\n\nstatic int mt76_mmio_wr_rp(struct mt76_dev *dev, u32 base,\n\t\t\t   const struct mt76_reg_pair *data, int len)\n{\n\twhile (len > 0) {\n\t\tmt76_mmio_wr(dev, data->reg, data->value);\n\t\tdata++;\n\t\tlen--;\n\t}\n\n\treturn 0;\n}\n\nstatic int mt76_mmio_rd_rp(struct mt76_dev *dev, u32 base,\n\t\t\t   struct mt76_reg_pair *data, int len)\n{\n\twhile (len > 0) {\n\t\tdata->value = mt76_mmio_rr(dev, data->reg);\n\t\tdata++;\n\t\tlen--;\n\t}\n\n\treturn 0;\n}\n\nvoid mt76_set_irq_mask(struct mt76_dev *dev, u32 addr,\n\t\t       u32 clear, u32 set)\n{\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&dev->mmio.irq_lock, flags);\n\tdev->mmio.irqmask &= ~clear;\n\tdev->mmio.irqmask |= set;\n\tif (addr) {\n\t\tif (mtk_wed_device_active(&dev->mmio.wed))\n\t\t\tmtk_wed_device_irq_set_mask(&dev->mmio.wed,\n\t\t\t\t\t\t    dev->mmio.irqmask);\n\t\telse\n\t\t\tmt76_mmio_wr(dev, addr, dev->mmio.irqmask);\n\t}\n\tspin_unlock_irqrestore(&dev->mmio.irq_lock, flags);\n}\nEXPORT_SYMBOL_GPL(mt76_set_irq_mask);\n\nvoid mt76_mmio_init(struct mt76_dev *dev, void __iomem *regs)\n{\n\tstatic const struct mt76_bus_ops mt76_mmio_ops = {\n\t\t.rr = mt76_mmio_rr,\n\t\t.rmw = mt76_mmio_rmw,\n\t\t.wr = mt76_mmio_wr,\n\t\t.write_copy = mt76_mmio_write_copy,\n\t\t.read_copy = mt76_mmio_read_copy,\n\t\t.wr_rp = mt76_mmio_wr_rp,\n\t\t.rd_rp = mt76_mmio_rd_rp,\n\t\t.type = MT76_BUS_MMIO,\n\t};\n\n\tdev->bus = &mt76_mmio_ops;\n\tdev->mmio.regs = regs;\n\n\tspin_lock_init(&dev->mmio.irq_lock);\n}\nEXPORT_SYMBOL_GPL(mt76_mmio_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}