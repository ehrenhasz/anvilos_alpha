{
  "module_name": "pci.c",
  "hash_id": "a430c7c0aaf019b29db13ae0f1bc8c284585326926b625a5f69634dbfd9bd584",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt7603/pci.c",
  "human_readable_source": "\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n\n#include \"mt7603.h\"\n\nstatic const struct pci_device_id mt76pci_device_table[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_MEDIATEK, 0x7603) },\n\t{ },\n};\n\nstatic int\nmt76pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)\n{\n\tstruct mt7603_dev *dev;\n\tstruct mt76_dev *mdev;\n\tint ret;\n\n\tret = pcim_enable_device(pdev);\n\tif (ret)\n\t\treturn ret;\n\n\tret = pcim_iomap_regions(pdev, BIT(0), pci_name(pdev));\n\tif (ret)\n\t\treturn ret;\n\n\tpci_set_master(pdev);\n\n\tret = dma_set_mask(&pdev->dev, DMA_BIT_MASK(32));\n\tif (ret)\n\t\treturn ret;\n\n\tmdev = mt76_alloc_device(&pdev->dev, sizeof(*dev), &mt7603_ops,\n\t\t\t\t &mt7603_drv_ops);\n\tif (!mdev)\n\t\treturn -ENOMEM;\n\n\tdev = container_of(mdev, struct mt7603_dev, mt76);\n\tmt76_mmio_init(mdev, pcim_iomap_table(pdev)[0]);\n\n\tmdev->rev = (mt76_rr(dev, MT_HW_CHIPID) << 16) |\n\t\t    (mt76_rr(dev, MT_HW_REV) & 0xff);\n\tdev_info(mdev->dev, \"ASIC revision: %04x\\n\", mdev->rev);\n\n\tmt76_wr(dev, MT_INT_MASK_CSR, 0);\n\n\tret = devm_request_irq(mdev->dev, pdev->irq, mt7603_irq_handler,\n\t\t\t       IRQF_SHARED, KBUILD_MODNAME, dev);\n\tif (ret)\n\t\tgoto error;\n\n\tret = mt7603_register_device(dev);\n\tif (ret)\n\t\tgoto error;\n\n\treturn 0;\nerror:\n\tmt76_free_device(&dev->mt76);\n\n\treturn ret;\n}\n\nstatic void\nmt76pci_remove(struct pci_dev *pdev)\n{\n\tstruct mt76_dev *mdev = pci_get_drvdata(pdev);\n\tstruct mt7603_dev *dev = container_of(mdev, struct mt7603_dev, mt76);\n\n\tmt7603_unregister_device(dev);\n}\n\nMODULE_DEVICE_TABLE(pci, mt76pci_device_table);\nMODULE_FIRMWARE(MT7603_FIRMWARE_E1);\nMODULE_FIRMWARE(MT7603_FIRMWARE_E2);\n\nstruct pci_driver mt7603_pci_driver = {\n\t.name\t\t= KBUILD_MODNAME,\n\t.id_table\t= mt76pci_device_table,\n\t.probe\t\t= mt76pci_probe,\n\t.remove\t\t= mt76pci_remove,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}