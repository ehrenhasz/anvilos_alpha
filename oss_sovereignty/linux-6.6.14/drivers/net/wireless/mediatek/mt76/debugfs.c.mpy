{
  "module_name": "debugfs.c",
  "hash_id": "b06a615e6b85c7b57ca93bf79fe639dee6e9f2e3eb2aa0805692400a4d44d7ab",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/debugfs.c",
  "human_readable_source": "\n \n#include \"mt76.h\"\n\nstatic int\nmt76_reg_set(void *data, u64 val)\n{\n\tstruct mt76_dev *dev = data;\n\n\t__mt76_wr(dev, dev->debugfs_reg, val);\n\treturn 0;\n}\n\nstatic int\nmt76_reg_get(void *data, u64 *val)\n{\n\tstruct mt76_dev *dev = data;\n\n\t*val = __mt76_rr(dev, dev->debugfs_reg);\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(fops_regval, mt76_reg_get, mt76_reg_set,\n\t\t\t \"0x%08llx\\n\");\n\nstatic int\nmt76_napi_threaded_set(void *data, u64 val)\n{\n\tstruct mt76_dev *dev = data;\n\n\tif (!mt76_is_mmio(dev))\n\t\treturn -EOPNOTSUPP;\n\n\tif (dev->napi_dev.threaded != val)\n\t\treturn dev_set_threaded(&dev->napi_dev, val);\n\n\treturn 0;\n}\n\nstatic int\nmt76_napi_threaded_get(void *data, u64 *val)\n{\n\tstruct mt76_dev *dev = data;\n\n\t*val = dev->napi_dev.threaded;\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(fops_napi_threaded, mt76_napi_threaded_get,\n\t\t\t mt76_napi_threaded_set, \"%llu\\n\");\n\nint mt76_queues_read(struct seq_file *s, void *data)\n{\n\tstruct mt76_dev *dev = dev_get_drvdata(s->private);\n\tint i;\n\n\tseq_puts(s, \"     queue | hw-queued |      head |      tail |\\n\");\n\tfor (i = 0; i < ARRAY_SIZE(dev->phy.q_tx); i++) {\n\t\tstruct mt76_queue *q = dev->phy.q_tx[i];\n\n\t\tif (!q)\n\t\t\tcontinue;\n\n\t\tseq_printf(s, \" %9d | %9d | %9d | %9d |\\n\",\n\t\t\t   i, q->queued, q->head, q->tail);\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(mt76_queues_read);\n\nstatic int mt76_rx_queues_read(struct seq_file *s, void *data)\n{\n\tstruct mt76_dev *dev = dev_get_drvdata(s->private);\n\tint i, queued;\n\n\tseq_puts(s, \"     queue | hw-queued |      head |      tail |\\n\");\n\tmt76_for_each_q_rx(dev, i) {\n\t\tstruct mt76_queue *q = &dev->q_rx[i];\n\n\t\tqueued = mt76_is_usb(dev) ? q->ndesc - q->queued : q->queued;\n\t\tseq_printf(s, \" %9d | %9d | %9d | %9d |\\n\",\n\t\t\t   i, queued, q->head, q->tail);\n\t}\n\n\treturn 0;\n}\n\nvoid mt76_seq_puts_array(struct seq_file *file, const char *str,\n\t\t\t s8 *val, int len)\n{\n\tint i;\n\n\tseq_printf(file, \"%10s:\", str);\n\tfor (i = 0; i < len; i++)\n\t\tseq_printf(file, \" %2d\", val[i]);\n\tseq_puts(file, \"\\n\");\n}\nEXPORT_SYMBOL_GPL(mt76_seq_puts_array);\n\nstruct dentry *\nmt76_register_debugfs_fops(struct mt76_phy *phy,\n\t\t\t   const struct file_operations *ops)\n{\n\tconst struct file_operations *fops = ops ? ops : &fops_regval;\n\tstruct mt76_dev *dev = phy->dev;\n\tstruct dentry *dir;\n\n\tdir = debugfs_create_dir(\"mt76\", phy->hw->wiphy->debugfsdir);\n\tif (!dir)\n\t\treturn NULL;\n\n\tdebugfs_create_u8(\"led_pin\", 0600, dir, &phy->leds.pin);\n\tdebugfs_create_u32(\"regidx\", 0600, dir, &dev->debugfs_reg);\n\tdebugfs_create_file_unsafe(\"regval\", 0600, dir, dev, fops);\n\tdebugfs_create_file_unsafe(\"napi_threaded\", 0600, dir, dev,\n\t\t\t\t   &fops_napi_threaded);\n\tdebugfs_create_blob(\"eeprom\", 0400, dir, &dev->eeprom);\n\tif (dev->otp.data)\n\t\tdebugfs_create_blob(\"otp\", 0400, dir, &dev->otp);\n\tdebugfs_create_devm_seqfile(dev->dev, \"rx-queues\", dir,\n\t\t\t\t    mt76_rx_queues_read);\n\n\treturn dir;\n}\nEXPORT_SYMBOL_GPL(mt76_register_debugfs_fops);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}