{
  "module_name": "util.h",
  "hash_id": "f33f3a220ebbcba3fa07df98db9954cd5610f77eb33216ebd5dac8f92289ec73",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/util.h",
  "human_readable_source": " \n \n\n#ifndef __MT76_UTIL_H\n#define __MT76_UTIL_H\n\n#include <linux/skbuff.h>\n#include <linux/bitops.h>\n#include <linux/bitfield.h>\n#include <net/mac80211.h>\n\nstruct mt76_worker\n{\n\tstruct task_struct *task;\n\tvoid (*fn)(struct mt76_worker *);\n\tunsigned long state;\n};\n\nenum {\n\tMT76_WORKER_SCHEDULED,\n\tMT76_WORKER_RUNNING,\n};\n\n#define MT76_INCR(_var, _size) \\\n\t(_var = (((_var) + 1) % (_size)))\n\nint mt76_wcid_alloc(u32 *mask, int size);\n\nstatic inline void\nmt76_wcid_mask_set(u32 *mask, int idx)\n{\n\tmask[idx / 32] |= BIT(idx % 32);\n}\n\nstatic inline void\nmt76_wcid_mask_clear(u32 *mask, int idx)\n{\n\tmask[idx / 32] &= ~BIT(idx % 32);\n}\n\nstatic inline void\nmt76_skb_set_moredata(struct sk_buff *skb, bool enable)\n{\n\tstruct ieee80211_hdr *hdr = (struct ieee80211_hdr *)skb->data;\n\n\tif (enable)\n\t\thdr->frame_control |= cpu_to_le16(IEEE80211_FCTL_MOREDATA);\n\telse\n\t\thdr->frame_control &= ~cpu_to_le16(IEEE80211_FCTL_MOREDATA);\n}\n\nint __mt76_worker_fn(void *ptr);\n\nstatic inline int\nmt76_worker_setup(struct ieee80211_hw *hw, struct mt76_worker *w,\n\t\t  void (*fn)(struct mt76_worker *),\n\t\t  const char *name)\n{\n\tconst char *dev_name = wiphy_name(hw->wiphy);\n\tint ret;\n\n\tif (fn)\n\t\tw->fn = fn;\n\tw->task = kthread_run(__mt76_worker_fn, w,\n\t\t\t      \"mt76-%s %s\", name, dev_name);\n\n\tif (IS_ERR(w->task)) {\n\t\tret = PTR_ERR(w->task);\n\t\tw->task = NULL;\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic inline void mt76_worker_schedule(struct mt76_worker *w)\n{\n\tif (!w->task)\n\t\treturn;\n\n\tif (!test_and_set_bit(MT76_WORKER_SCHEDULED, &w->state) &&\n\t    !test_bit(MT76_WORKER_RUNNING, &w->state))\n\t\twake_up_process(w->task);\n}\n\nstatic inline void mt76_worker_disable(struct mt76_worker *w)\n{\n\tif (!w->task)\n\t\treturn;\n\n\tkthread_park(w->task);\n\tWRITE_ONCE(w->state, 0);\n}\n\nstatic inline void mt76_worker_enable(struct mt76_worker *w)\n{\n\tif (!w->task)\n\t\treturn;\n\n\tkthread_unpark(w->task);\n\tmt76_worker_schedule(w);\n}\n\nstatic inline void mt76_worker_teardown(struct mt76_worker *w)\n{\n\tif (!w->task)\n\t\treturn;\n\n\tkthread_stop(w->task);\n\tw->task = NULL;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}