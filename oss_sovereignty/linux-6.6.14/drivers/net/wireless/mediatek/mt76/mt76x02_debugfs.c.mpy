{
  "module_name": "mt76x02_debugfs.c",
  "hash_id": "69086f8a23e284a78dd4f508e8584dbfeeb6ad4db35e9c8e2de28937a21fddb5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt76x02_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include \"mt76x02.h\"\n\nstatic int\nmt76x02_ampdu_stat_show(struct seq_file *file, void *data)\n{\n\tstruct mt76x02_dev *dev = file->private;\n\tint i, j;\n\n\tfor (i = 0; i < 4; i++) {\n\t\tseq_puts(file, \"Length: \");\n\t\tfor (j = 0; j < 8; j++)\n\t\t\tseq_printf(file, \"%8d | \", i * 8 + j + 1);\n\t\tseq_puts(file, \"\\n\");\n\t\tseq_puts(file, \"Count:  \");\n\t\tfor (j = 0; j < 8; j++)\n\t\t\tseq_printf(file, \"%8d | \",\n\t\t\t\t   dev->mphy.aggr_stats[i * 8 + j]);\n\t\tseq_puts(file, \"\\n\");\n\t\tseq_puts(file, \"--------\");\n\t\tfor (j = 0; j < 8; j++)\n\t\t\tseq_puts(file, \"-----------\");\n\t\tseq_puts(file, \"\\n\");\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mt76x02_ampdu_stat);\n\nstatic int read_txpower(struct seq_file *file, void *data)\n{\n\tstruct mt76x02_dev *dev = dev_get_drvdata(file->private);\n\n\tseq_printf(file, \"Target power: %d\\n\", dev->target_power);\n\n\tmt76_seq_puts_array(file, \"Delta\", dev->target_power_delta,\n\t\t\t    ARRAY_SIZE(dev->target_power_delta));\n\treturn 0;\n}\n\nstatic int\nmt76x02_dfs_stat_show(struct seq_file *file, void *data)\n{\n\tstruct mt76x02_dev *dev = file->private;\n\tstruct mt76x02_dfs_pattern_detector *dfs_pd = &dev->dfs_pd;\n\tint i;\n\n\tseq_printf(file, \"allocated sequences:\\t%d\\n\",\n\t\t   dfs_pd->seq_stats.seq_pool_len);\n\tseq_printf(file, \"used sequences:\\t\\t%d\\n\",\n\t\t   dfs_pd->seq_stats.seq_len);\n\tseq_puts(file, \"\\n\");\n\n\tfor (i = 0; i < MT_DFS_NUM_ENGINES; i++) {\n\t\tseq_printf(file, \"engine: %d\\n\", i);\n\t\tseq_printf(file, \"  hw pattern detected:\\t%d\\n\",\n\t\t\t   dfs_pd->stats[i].hw_pattern);\n\t\tseq_printf(file, \"  hw pulse discarded:\\t%d\\n\",\n\t\t\t   dfs_pd->stats[i].hw_pulse_discarded);\n\t\tseq_printf(file, \"  sw pattern detected:\\t%d\\n\",\n\t\t\t   dfs_pd->stats[i].sw_pattern);\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mt76x02_dfs_stat);\n\nstatic int read_agc(struct seq_file *file, void *data)\n{\n\tstruct mt76x02_dev *dev = dev_get_drvdata(file->private);\n\n\tseq_printf(file, \"avg_rssi: %d\\n\", dev->cal.avg_rssi_all);\n\tseq_printf(file, \"low_gain: %d\\n\", dev->cal.low_gain);\n\tseq_printf(file, \"false_cca: %d\\n\", dev->cal.false_cca);\n\tseq_printf(file, \"agc_gain_adjust: %d\\n\", dev->cal.agc_gain_adjust);\n\n\treturn 0;\n}\n\nstatic int\nmt76_edcca_set(void *data, u64 val)\n{\n\tstruct mt76x02_dev *dev = data;\n\tenum nl80211_dfs_regions region = dev->mt76.region;\n\n\tmutex_lock(&dev->mt76.mutex);\n\n\tdev->ed_monitor_enabled = !!val;\n\tdev->ed_monitor = dev->ed_monitor_enabled &&\n\t\t\t  region == NL80211_DFS_ETSI;\n\tmt76x02_edcca_init(dev);\n\n\tmutex_unlock(&dev->mt76.mutex);\n\n\treturn 0;\n}\n\nstatic int\nmt76_edcca_get(void *data, u64 *val)\n{\n\tstruct mt76x02_dev *dev = data;\n\n\t*val = dev->ed_monitor_enabled;\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(fops_edcca, mt76_edcca_get, mt76_edcca_set,\n\t\t\t \"%lld\\n\");\n\nstatic int mt76x02_read_rate_txpower(struct seq_file *s, void *data)\n{\n\tstruct mt76x02_dev *dev = dev_get_drvdata(s->private);\n\n\tmt76_seq_puts_array(s, \"CCK\", dev->rate_power.cck,\n\t\t\t    ARRAY_SIZE(dev->rate_power.cck));\n\tmt76_seq_puts_array(s, \"OFDM\", dev->rate_power.ofdm,\n\t\t\t    ARRAY_SIZE(dev->rate_power.ofdm));\n\tmt76_seq_puts_array(s, \"HT\", dev->rate_power.ht,\n\t\t\t    ARRAY_SIZE(dev->rate_power.ht));\n\tmt76_seq_puts_array(s, \"VHT\", dev->rate_power.vht,\n\t\t\t    ARRAY_SIZE(dev->rate_power.vht));\n\treturn 0;\n}\n\nvoid mt76x02_init_debugfs(struct mt76x02_dev *dev)\n{\n\tstruct dentry *dir;\n\n\tdir = mt76_register_debugfs(&dev->mt76);\n\tif (!dir)\n\t\treturn;\n\n\tdebugfs_create_devm_seqfile(dev->mt76.dev, \"xmit-queues\", dir,\n\t\t\t\t    mt76_queues_read);\n\tdebugfs_create_u8(\"temperature\", 0400, dir, &dev->cal.temp);\n\tdebugfs_create_bool(\"tpc\", 0600, dir, &dev->enable_tpc);\n\n\tdebugfs_create_file(\"edcca\", 0600, dir, dev, &fops_edcca);\n\tdebugfs_create_file(\"ampdu_stat\", 0400, dir, dev, &mt76x02_ampdu_stat_fops);\n\tdebugfs_create_file(\"dfs_stats\", 0400, dir, dev, &mt76x02_dfs_stat_fops);\n\tdebugfs_create_devm_seqfile(dev->mt76.dev, \"txpower\", dir,\n\t\t\t\t    read_txpower);\n\n\tdebugfs_create_devm_seqfile(dev->mt76.dev, \"rate_txpower\", dir,\n\t\t\t\t    mt76x02_read_rate_txpower);\n\tdebugfs_create_devm_seqfile(dev->mt76.dev, \"agc\", dir, read_agc);\n\n\tdebugfs_create_u32(\"tx_hang_reset\", 0400, dir, &dev->tx_hang_reset);\n}\nEXPORT_SYMBOL_GPL(mt76x02_init_debugfs);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}