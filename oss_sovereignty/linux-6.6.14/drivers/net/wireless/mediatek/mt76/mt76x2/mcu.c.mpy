{
  "module_name": "mcu.c",
  "hash_id": "59c2c58e343ea6948e3d760e90c8c3460f27cf5c52a7fb4dc21233eec21894c7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt76x2/mcu.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/firmware.h>\n#include <linux/delay.h>\n\n#include \"mt76x2.h\"\n#include \"mcu.h\"\n#include \"eeprom.h\"\n\nint mt76x2_mcu_set_channel(struct mt76x02_dev *dev, u8 channel, u8 bw,\n\t\t\t   u8 bw_index, bool scan)\n{\n\tstruct {\n\t\tu8 idx;\n\t\tu8 scan;\n\t\tu8 bw;\n\t\tu8 _pad0;\n\n\t\t__le16 chainmask;\n\t\tu8 ext_chan;\n\t\tu8 _pad1;\n\n\t} __packed __aligned(4) msg = {\n\t\t.idx = channel,\n\t\t.scan = scan,\n\t\t.bw = bw,\n\t\t.chainmask = cpu_to_le16(dev->mphy.chainmask),\n\t};\n\n\t \n\tmt76_mcu_send_msg(&dev->mt76, CMD_SWITCH_CHANNEL_OP, &msg,\n\t\t\t  sizeof(msg), true);\n\n\tusleep_range(5000, 10000);\n\n\tmsg.ext_chan = 0xe0 + bw_index;\n\treturn mt76_mcu_send_msg(&dev->mt76, CMD_SWITCH_CHANNEL_OP, &msg,\n\t\t\t\t sizeof(msg), true);\n}\nEXPORT_SYMBOL_GPL(mt76x2_mcu_set_channel);\n\nint mt76x2_mcu_load_cr(struct mt76x02_dev *dev, u8 type, u8 temp_level,\n\t\t       u8 channel)\n{\n\tstruct {\n\t\tu8 cr_mode;\n\t\tu8 temp;\n\t\tu8 ch;\n\t\tu8 _pad0;\n\n\t\t__le32 cfg;\n\t} __packed __aligned(4) msg = {\n\t\t.cr_mode = type,\n\t\t.temp = temp_level,\n\t\t.ch = channel,\n\t};\n\tu32 val;\n\n\tval = BIT(31);\n\tval |= (mt76x02_eeprom_get(dev, MT_EE_NIC_CONF_0) >> 8) & 0x00ff;\n\tval |= (mt76x02_eeprom_get(dev, MT_EE_NIC_CONF_1) << 8) & 0xff00;\n\tmsg.cfg = cpu_to_le32(val);\n\n\t \n\treturn mt76_mcu_send_msg(&dev->mt76, CMD_LOAD_CR, &msg, sizeof(msg),\n\t\t\t\t true);\n}\nEXPORT_SYMBOL_GPL(mt76x2_mcu_load_cr);\n\nint mt76x2_mcu_init_gain(struct mt76x02_dev *dev, u8 channel, u32 gain,\n\t\t\t bool force)\n{\n\tstruct {\n\t\t__le32 channel;\n\t\t__le32 gain_val;\n\t} __packed __aligned(4) msg = {\n\t\t.channel = cpu_to_le32(channel),\n\t\t.gain_val = cpu_to_le32(gain),\n\t};\n\n\tif (force)\n\t\tmsg.channel |= cpu_to_le32(BIT(31));\n\n\treturn mt76_mcu_send_msg(&dev->mt76, CMD_INIT_GAIN_OP, &msg,\n\t\t\t\t sizeof(msg), true);\n}\nEXPORT_SYMBOL_GPL(mt76x2_mcu_init_gain);\n\nint mt76x2_mcu_tssi_comp(struct mt76x02_dev *dev,\n\t\t\t struct mt76x2_tssi_comp *tssi_data)\n{\n\tstruct {\n\t\t__le32 id;\n\t\tstruct mt76x2_tssi_comp data;\n\t} __packed __aligned(4) msg = {\n\t\t.id = cpu_to_le32(MCU_CAL_TSSI_COMP),\n\t\t.data = *tssi_data,\n\t};\n\n\treturn mt76_mcu_send_msg(&dev->mt76, CMD_CALIBRATION_OP, &msg,\n\t\t\t\t sizeof(msg), true);\n}\nEXPORT_SYMBOL_GPL(mt76x2_mcu_tssi_comp);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}