{
  "module_name": "usb.c",
  "hash_id": "ce274a0a24a9d5cf1173ab533d5f70a51e76c66a6202a3c2091854031ea5effa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt76x2/usb.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n\n#include \"../mt76x02_usb.h\"\n#include \"mt76x2u.h\"\n\nstatic const struct usb_device_id mt76x2u_device_table[] = {\n\t{ USB_DEVICE(0x0b05, 0x1833) },\t \n\t{ USB_DEVICE(0x0b05, 0x17eb) },\t \n\t{ USB_DEVICE(0x0b05, 0x180b) },\t \n\t{ USB_DEVICE(0x0e8d, 0x7612) },\t \n\t{ USB_DEVICE(0x057c, 0x8503) },\t \n\t{ USB_DEVICE(0x7392, 0xb711) },\t \n\t{ USB_DEVICE(0x0e8d, 0x7632) },\t \n\t{ USB_DEVICE(0x2c4e, 0x0103) },\t \n\t{ USB_DEVICE(0x0846, 0x9053) },\t \n\t{ USB_DEVICE(0x045e, 0x02e6) },\t \n\t{ USB_DEVICE(0x045e, 0x02fe) },\t \n\t{ },\n};\n\nstatic int mt76x2u_probe(struct usb_interface *intf,\n\t\t\t const struct usb_device_id *id)\n{\n\tstatic const struct mt76_driver_ops drv_ops = {\n\t\t.drv_flags = MT_DRV_SW_RX_AIRTIME,\n\t\t.survey_flags = SURVEY_INFO_TIME_TX,\n\t\t.update_survey = mt76x02_update_channel,\n\t\t.tx_prepare_skb = mt76x02u_tx_prepare_skb,\n\t\t.tx_complete_skb = mt76x02u_tx_complete_skb,\n\t\t.tx_status_data = mt76x02_tx_status_data,\n\t\t.rx_skb = mt76x02_queue_rx_skb,\n\t\t.sta_ps = mt76x02_sta_ps,\n\t\t.sta_add = mt76x02_sta_add,\n\t\t.sta_remove = mt76x02_sta_remove,\n\t};\n\tstruct usb_device *udev = interface_to_usbdev(intf);\n\tstruct mt76x02_dev *dev;\n\tstruct mt76_dev *mdev;\n\tint err;\n\n\tmdev = mt76_alloc_device(&intf->dev, sizeof(*dev), &mt76x2u_ops,\n\t\t\t\t &drv_ops);\n\tif (!mdev)\n\t\treturn -ENOMEM;\n\n\tdev = container_of(mdev, struct mt76x02_dev, mt76);\n\n\tudev = usb_get_dev(udev);\n\tusb_reset_device(udev);\n\n\tusb_set_intfdata(intf, dev);\n\n\tmt76x02u_init_mcu(mdev);\n\terr = mt76u_init(mdev, intf);\n\tif (err < 0)\n\t\tgoto err;\n\n\tmdev->rev = mt76_rr(dev, MT_ASIC_VERSION);\n\tdev_info(mdev->dev, \"ASIC revision: %08x\\n\", mdev->rev);\n\tif (!is_mt76x2(dev)) {\n\t\terr = -ENODEV;\n\t\tgoto err;\n\t}\n\n\terr = mt76x2u_register_device(dev);\n\tif (err < 0)\n\t\tgoto err;\n\n\treturn 0;\n\nerr:\n\tmt76u_queues_deinit(&dev->mt76);\n\tmt76_free_device(&dev->mt76);\n\tusb_set_intfdata(intf, NULL);\n\tusb_put_dev(udev);\n\n\treturn err;\n}\n\nstatic void mt76x2u_disconnect(struct usb_interface *intf)\n{\n\tstruct usb_device *udev = interface_to_usbdev(intf);\n\tstruct mt76x02_dev *dev = usb_get_intfdata(intf);\n\tstruct ieee80211_hw *hw = mt76_hw(dev);\n\n\tset_bit(MT76_REMOVED, &dev->mphy.state);\n\tieee80211_unregister_hw(hw);\n\tmt76x2u_cleanup(dev);\n\tmt76_free_device(&dev->mt76);\n\tusb_set_intfdata(intf, NULL);\n\tusb_put_dev(udev);\n}\n\nstatic int __maybe_unused mt76x2u_suspend(struct usb_interface *intf,\n\t\t\t\t\t  pm_message_t state)\n{\n\tstruct mt76x02_dev *dev = usb_get_intfdata(intf);\n\n\tmt76u_stop_rx(&dev->mt76);\n\n\treturn 0;\n}\n\nstatic int __maybe_unused mt76x2u_resume(struct usb_interface *intf)\n{\n\tstruct mt76x02_dev *dev = usb_get_intfdata(intf);\n\tint err;\n\n\terr = mt76u_resume_rx(&dev->mt76);\n\tif (err < 0)\n\t\tgoto err;\n\n\terr = mt76x2u_init_hardware(dev);\n\tif (err < 0)\n\t\tgoto err;\n\n\treturn 0;\n\nerr:\n\tmt76x2u_cleanup(dev);\n\treturn err;\n}\n\nMODULE_DEVICE_TABLE(usb, mt76x2u_device_table);\nMODULE_FIRMWARE(MT7662_FIRMWARE);\nMODULE_FIRMWARE(MT7662_ROM_PATCH);\n\nstatic struct usb_driver mt76x2u_driver = {\n\t.name\t\t= KBUILD_MODNAME,\n\t.id_table\t= mt76x2u_device_table,\n\t.probe\t\t= mt76x2u_probe,\n\t.disconnect\t= mt76x2u_disconnect,\n#ifdef CONFIG_PM\n\t.suspend\t= mt76x2u_suspend,\n\t.resume\t\t= mt76x2u_resume,\n\t.reset_resume\t= mt76x2u_resume,\n#endif  \n\t.soft_unbind\t= 1,\n\t.disable_hub_initiated_lpm = 1,\n};\nmodule_usb_driver(mt76x2u_driver);\n\nMODULE_AUTHOR(\"Lorenzo Bianconi <lorenzo.bianconi83@gmail.com>\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}