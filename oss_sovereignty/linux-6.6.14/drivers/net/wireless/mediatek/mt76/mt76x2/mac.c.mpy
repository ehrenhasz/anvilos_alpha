{
  "module_name": "mac.c",
  "hash_id": "0b6328d5d7c74b978bc7be4fbd87a2c1f69a326f8282f3f7503b00a9d545d639",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt76x2/mac.c",
  "human_readable_source": "\n \n\n#include \"mt76x2.h\"\n\nvoid mt76x2_mac_stop(struct mt76x02_dev *dev, bool force)\n{\n\tbool stopped = false;\n\tu32 rts_cfg;\n\tint i;\n\n\tmt76_clear(dev, MT_TXOP_CTRL_CFG, MT_TXOP_ED_CCA_EN);\n\tmt76_clear(dev, MT_TXOP_HLDR_ET, MT_TXOP_HLDR_TX40M_BLK_EN);\n\n\tmt76_wr(dev, MT_MAC_SYS_CTRL, 0);\n\n\trts_cfg = mt76_rr(dev, MT_TX_RTS_CFG);\n\tmt76_wr(dev, MT_TX_RTS_CFG, rts_cfg & ~MT_TX_RTS_CFG_RETRY_LIMIT);\n\n\t \n\tfor (i = 0; i < 300; i++) {\n\t\tif ((mt76_rr(dev, MT_MAC_STATUS) &\n\t\t     (MT_MAC_STATUS_RX | MT_MAC_STATUS_TX)) ||\n\t\t    mt76_rr(dev, MT_BBP(IBI, 12))) {\n\t\t\tudelay(1);\n\t\t\tcontinue;\n\t\t}\n\n\t\tstopped = true;\n\t\tbreak;\n\t}\n\n\tif (force && !stopped) {\n\t\tmt76_set(dev, MT_BBP(CORE, 4), BIT(1));\n\t\tmt76_clear(dev, MT_BBP(CORE, 4), BIT(1));\n\n\t\tmt76_set(dev, MT_BBP(CORE, 4), BIT(0));\n\t\tmt76_clear(dev, MT_BBP(CORE, 4), BIT(0));\n\t}\n\n\tmt76_wr(dev, MT_TX_RTS_CFG, rts_cfg);\n}\nEXPORT_SYMBOL_GPL(mt76x2_mac_stop);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}