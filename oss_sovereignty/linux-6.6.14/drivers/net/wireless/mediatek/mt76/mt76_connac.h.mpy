{
  "module_name": "mt76_connac.h",
  "hash_id": "c8b2208b405a2bc3ddca86e1102dfff7240404eee051d31d860b933160c517c8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt76/mt76_connac.h",
  "human_readable_source": " \n \n\n#ifndef __MT76_CONNAC_H\n#define __MT76_CONNAC_H\n\n#include \"mt76.h\"\n\nenum rx_pkt_type {\n\tPKT_TYPE_TXS,\n\tPKT_TYPE_TXRXV,\n\tPKT_TYPE_NORMAL,\n\tPKT_TYPE_RX_DUP_RFB,\n\tPKT_TYPE_RX_TMR,\n\tPKT_TYPE_RETRIEVE,\n\tPKT_TYPE_TXRX_NOTIFY,\n\tPKT_TYPE_RX_EVENT,\n\tPKT_TYPE_NORMAL_MCU,\n\tPKT_TYPE_RX_FW_MONITOR\t= 0x0c,\n\tPKT_TYPE_TXRX_NOTIFY_V0\t= 0x18,\n};\n\n#define MT76_CONNAC_SCAN_IE_LEN\t\t\t600\n#define MT76_CONNAC_MAX_NUM_SCHED_SCAN_INTERVAL\t 10\n#define MT76_CONNAC_MAX_TIME_SCHED_SCAN_INTERVAL U16_MAX\n#define MT76_CONNAC_MAX_SCHED_SCAN_SSID\t\t10\n#define MT76_CONNAC_MAX_SCAN_MATCH\t\t16\n\n#define MT76_CONNAC_MAX_WMM_SETS\t\t4\n\n#define MT76_CONNAC_COREDUMP_TIMEOUT\t\t(HZ / 20)\n#define MT76_CONNAC_COREDUMP_SZ\t\t\t(1300 * 1024)\n\n#define MT_TXD_SIZE\t\t\t\t(8 * 4)\n\n#define MT_USB_TXD_SIZE\t\t\t\t(MT_TXD_SIZE + 8 * 4)\n#define MT_USB_HDR_SIZE\t\t\t\t4\n#define MT_USB_TAIL_SIZE\t\t\t4\n\n#define MT_SDIO_TXD_SIZE\t\t\t(MT_TXD_SIZE + 8 * 4)\n#define MT_SDIO_TAIL_SIZE\t\t\t8\n#define MT_SDIO_HDR_SIZE\t\t\t4\n\n#define MT_MSDU_ID_VALID\t\tBIT(15)\n\n#define MT_TXD_LEN_LAST\t\t\tBIT(15)\n#define MT_TXD_LEN_MASK\t\t\tGENMASK(11, 0)\n#define MT_TXD_LEN_MSDU_LAST\t\tBIT(14)\n#define MT_TXD_LEN_AMSDU_LAST\t\tBIT(15)\n\nenum {\n\tCMD_CBW_20MHZ = IEEE80211_STA_RX_BW_20,\n\tCMD_CBW_40MHZ = IEEE80211_STA_RX_BW_40,\n\tCMD_CBW_80MHZ = IEEE80211_STA_RX_BW_80,\n\tCMD_CBW_160MHZ = IEEE80211_STA_RX_BW_160,\n\tCMD_CBW_10MHZ,\n\tCMD_CBW_5MHZ,\n\tCMD_CBW_8080MHZ,\n\tCMD_CBW_320MHZ,\n\n\tCMD_HE_MCS_BW80 = 0,\n\tCMD_HE_MCS_BW160,\n\tCMD_HE_MCS_BW8080,\n\tCMD_HE_MCS_BW_NUM\n};\n\nenum {\n\tHW_BSSID_0 = 0x0,\n\tHW_BSSID_1,\n\tHW_BSSID_2,\n\tHW_BSSID_3,\n\tHW_BSSID_MAX = HW_BSSID_3,\n\tEXT_BSSID_START = 0x10,\n\tEXT_BSSID_1,\n\tEXT_BSSID_15 = 0x1f,\n\tEXT_BSSID_MAX = EXT_BSSID_15,\n\tREPEATER_BSSID_START = 0x20,\n\tREPEATER_BSSID_MAX = 0x3f,\n};\n\nstruct mt76_connac_reg_map {\n\tu32 phys;\n\tu32 maps;\n\tu32 size;\n};\n\nstruct mt76_connac_pm {\n\tbool enable:1;\n\tbool enable_user:1;\n\tbool ds_enable:1;\n\tbool ds_enable_user:1;\n\tbool suspended:1;\n\n\tspinlock_t txq_lock;\n\tstruct {\n\t\tstruct mt76_wcid *wcid;\n\t\tstruct sk_buff *skb;\n\t} tx_q[IEEE80211_NUM_ACS];\n\n\tstruct work_struct wake_work;\n\twait_queue_head_t wait;\n\n\tstruct {\n\t\tspinlock_t lock;\n\t\tu32 count;\n\t} wake;\n\tstruct mutex mutex;\n\n\tstruct delayed_work ps_work;\n\tunsigned long last_activity;\n\tunsigned long idle_timeout;\n\n\tstruct {\n\t\tunsigned long last_wake_event;\n\t\tunsigned long awake_time;\n\t\tunsigned long last_doze_event;\n\t\tunsigned long doze_time;\n\t\tunsigned int lp_wake;\n\t} stats;\n};\n\nstruct mt76_connac_coredump {\n\tstruct sk_buff_head msg_list;\n\tstruct delayed_work work;\n\tunsigned long last_activity;\n};\n\nstruct mt76_connac_sta_key_conf {\n\ts8 keyidx;\n\tu8 key[16];\n};\n\n#define MT_TXP_MAX_BUF_NUM\t\t6\n\nstruct mt76_connac_fw_txp {\n\t__le16 flags;\n\t__le16 token;\n\tu8 bss_idx;\n\t__le16 rept_wds_wcid;\n\tu8 nbuf;\n\t__le32 buf[MT_TXP_MAX_BUF_NUM];\n\t__le16 len[MT_TXP_MAX_BUF_NUM];\n} __packed __aligned(4);\n\n#define MT_HW_TXP_MAX_MSDU_NUM\t\t4\n#define MT_HW_TXP_MAX_BUF_NUM\t\t4\n\nstruct mt76_connac_txp_ptr {\n\t__le32 buf0;\n\t__le16 len0;\n\t__le16 len1;\n\t__le32 buf1;\n} __packed __aligned(4);\n\nstruct mt76_connac_hw_txp {\n\t__le16 msdu_id[MT_HW_TXP_MAX_MSDU_NUM];\n\tstruct mt76_connac_txp_ptr ptr[MT_HW_TXP_MAX_BUF_NUM / 2];\n} __packed __aligned(4);\n\nstruct mt76_connac_txp_common {\n\tunion {\n\t\tstruct mt76_connac_fw_txp fw;\n\t\tstruct mt76_connac_hw_txp hw;\n\t};\n};\n\nstruct mt76_connac_tx_free {\n\t__le16 rx_byte_cnt;\n\t__le16 ctrl;\n\t__le32 txd;\n} __packed __aligned(4);\n\nextern const struct wiphy_wowlan_support mt76_connac_wowlan_support;\n\nstatic inline bool is_mt7922(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7922;\n}\n\nstatic inline bool is_mt7921(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7961 || is_mt7922(dev);\n}\n\nstatic inline bool is_mt7663(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7663;\n}\n\nstatic inline bool is_mt7915(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7915;\n}\n\nstatic inline bool is_mt7916(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7906;\n}\n\nstatic inline bool is_mt7981(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7981;\n}\n\nstatic inline bool is_mt7986(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7986;\n}\n\nstatic inline bool is_mt798x(struct mt76_dev *dev)\n{\n\treturn is_mt7981(dev) || is_mt7986(dev);\n}\n\nstatic inline bool is_mt7996(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7990;\n}\n\nstatic inline bool is_mt7622(struct mt76_dev *dev)\n{\n\tif (!IS_ENABLED(CONFIG_MT7622_WMAC))\n\t\treturn false;\n\n\treturn mt76_chip(dev) == 0x7622;\n}\n\nstatic inline bool is_mt7615(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7615 || mt76_chip(dev) == 0x7611;\n}\n\nstatic inline bool is_mt7611(struct mt76_dev *dev)\n{\n\treturn mt76_chip(dev) == 0x7611;\n}\n\nstatic inline bool is_connac_v1(struct mt76_dev *dev)\n{\n\treturn is_mt7615(dev) || is_mt7663(dev) || is_mt7622(dev);\n}\n\nstatic inline bool is_mt76_fw_txp(struct mt76_dev *dev)\n{\n\tswitch (mt76_chip(dev)) {\n\tcase 0x7961:\n\tcase 0x7922:\n\tcase 0x7663:\n\tcase 0x7622:\n\t\treturn false;\n\tdefault:\n\t\treturn true;\n\t}\n}\n\nstatic inline u8 mt76_connac_chan_bw(struct cfg80211_chan_def *chandef)\n{\n\tstatic const u8 width_to_bw[] = {\n\t\t[NL80211_CHAN_WIDTH_40] = CMD_CBW_40MHZ,\n\t\t[NL80211_CHAN_WIDTH_80] = CMD_CBW_80MHZ,\n\t\t[NL80211_CHAN_WIDTH_80P80] = CMD_CBW_8080MHZ,\n\t\t[NL80211_CHAN_WIDTH_160] = CMD_CBW_160MHZ,\n\t\t[NL80211_CHAN_WIDTH_5] = CMD_CBW_5MHZ,\n\t\t[NL80211_CHAN_WIDTH_10] = CMD_CBW_10MHZ,\n\t\t[NL80211_CHAN_WIDTH_20] = CMD_CBW_20MHZ,\n\t\t[NL80211_CHAN_WIDTH_20_NOHT] = CMD_CBW_20MHZ,\n\t\t[NL80211_CHAN_WIDTH_320] = CMD_CBW_320MHZ,\n\t};\n\n\tif (chandef->width >= ARRAY_SIZE(width_to_bw))\n\t\treturn 0;\n\n\treturn width_to_bw[chandef->width];\n}\n\nstatic inline u8 mt76_connac_lmac_mapping(u8 ac)\n{\n\t \n\treturn 3 - ac;\n}\n\nstatic inline void *\nmt76_connac_txwi_to_txp(struct mt76_dev *dev, struct mt76_txwi_cache *t)\n{\n\tu8 *txwi;\n\n\tif (!t)\n\t\treturn NULL;\n\n\ttxwi = mt76_get_txwi_ptr(dev, t);\n\n\treturn (void *)(txwi + MT_TXD_SIZE);\n}\n\nstatic inline u8 mt76_connac_spe_idx(u8 antenna_mask)\n{\n\tstatic const u8 ant_to_spe[] = {0, 0, 1, 0, 3, 2, 4, 0,\n\t\t\t\t\t9, 8, 6, 10, 16, 12, 18, 0};\n\n\tif (antenna_mask >= sizeof(ant_to_spe))\n\t\treturn 0;\n\n\treturn ant_to_spe[antenna_mask];\n}\n\nstatic inline void mt76_connac_irq_enable(struct mt76_dev *dev, u32 mask)\n{\n\tmt76_set_irq_mask(dev, 0, 0, mask);\n\ttasklet_schedule(&dev->irq_tasklet);\n}\n\nint mt76_connac_pm_wake(struct mt76_phy *phy, struct mt76_connac_pm *pm);\nvoid mt76_connac_power_save_sched(struct mt76_phy *phy,\n\t\t\t\t  struct mt76_connac_pm *pm);\nvoid mt76_connac_free_pending_tx_skbs(struct mt76_connac_pm *pm,\n\t\t\t\t      struct mt76_wcid *wcid);\n\nstatic inline void mt76_connac_tx_cleanup(struct mt76_dev *dev)\n{\n\tdev->queue_ops->tx_cleanup(dev, dev->q_mcu[MT_MCUQ_WM], false);\n\tdev->queue_ops->tx_cleanup(dev, dev->q_mcu[MT_MCUQ_WA], false);\n}\n\nstatic inline bool\nmt76_connac_pm_ref(struct mt76_phy *phy, struct mt76_connac_pm *pm)\n{\n\tbool ret = false;\n\n\tspin_lock_bh(&pm->wake.lock);\n\tif (test_bit(MT76_STATE_PM, &phy->state))\n\t\tgoto out;\n\n\tpm->wake.count++;\n\tret = true;\nout:\n\tspin_unlock_bh(&pm->wake.lock);\n\n\treturn ret;\n}\n\nstatic inline void\nmt76_connac_pm_unref(struct mt76_phy *phy, struct mt76_connac_pm *pm)\n{\n\tspin_lock_bh(&pm->wake.lock);\n\n\tpm->last_activity = jiffies;\n\tif (--pm->wake.count == 0 &&\n\t    test_bit(MT76_STATE_MCU_RUNNING, &phy->state))\n\t\tmt76_connac_power_save_sched(phy, pm);\n\n\tspin_unlock_bh(&pm->wake.lock);\n}\n\nstatic inline bool\nmt76_connac_skip_fw_pmctrl(struct mt76_phy *phy, struct mt76_connac_pm *pm)\n{\n\tstruct mt76_dev *dev = phy->dev;\n\tbool ret;\n\n\tif (dev->token_count)\n\t\treturn true;\n\n\tspin_lock_bh(&pm->wake.lock);\n\tret = pm->wake.count || test_and_set_bit(MT76_STATE_PM, &phy->state);\n\tspin_unlock_bh(&pm->wake.lock);\n\n\treturn ret;\n}\n\nstatic inline void\nmt76_connac_mutex_acquire(struct mt76_dev *dev, struct mt76_connac_pm *pm)\n\t__acquires(&dev->mutex)\n{\n\tmutex_lock(&dev->mutex);\n\tmt76_connac_pm_wake(&dev->phy, pm);\n}\n\nstatic inline void\nmt76_connac_mutex_release(struct mt76_dev *dev, struct mt76_connac_pm *pm)\n\t__releases(&dev->mutex)\n{\n\tmt76_connac_power_save_sched(&dev->phy, pm);\n\tmutex_unlock(&dev->mutex);\n}\n\nvoid mt76_connac_gen_ppe_thresh(u8 *he_ppet, int nss);\nint mt76_connac_init_tx_queues(struct mt76_phy *phy, int idx, int n_desc,\n\t\t\t       int ring_base, u32 flags);\nvoid mt76_connac_write_hw_txp(struct mt76_dev *dev,\n\t\t\t      struct mt76_tx_info *tx_info,\n\t\t\t      void *txp_ptr, u32 id);\nvoid mt76_connac_txp_skb_unmap(struct mt76_dev *dev,\n\t\t\t       struct mt76_txwi_cache *txwi);\nvoid mt76_connac_tx_complete_skb(struct mt76_dev *mdev,\n\t\t\t\t struct mt76_queue_entry *e);\nvoid mt76_connac_pm_queue_skb(struct ieee80211_hw *hw,\n\t\t\t      struct mt76_connac_pm *pm,\n\t\t\t      struct mt76_wcid *wcid,\n\t\t\t      struct sk_buff *skb);\nvoid mt76_connac_pm_dequeue_skbs(struct mt76_phy *phy,\n\t\t\t\t struct mt76_connac_pm *pm);\nvoid mt76_connac2_mac_write_txwi(struct mt76_dev *dev, __le32 *txwi,\n\t\t\t\t struct sk_buff *skb, struct mt76_wcid *wcid,\n\t\t\t\t struct ieee80211_key_conf *key, int pid,\n\t\t\t\t enum mt76_txq_id qid, u32 changed);\nu16 mt76_connac2_mac_tx_rate_val(struct mt76_phy *mphy,\n\t\t\t\t struct ieee80211_vif *vif,\n\t\t\t\t bool beacon, bool mcast);\nbool mt76_connac2_mac_fill_txs(struct mt76_dev *dev, struct mt76_wcid *wcid,\n\t\t\t       __le32 *txs_data);\nbool mt76_connac2_mac_add_txs_skb(struct mt76_dev *dev, struct mt76_wcid *wcid,\n\t\t\t\t  int pid, __le32 *txs_data);\nvoid mt76_connac2_mac_decode_he_radiotap(struct mt76_dev *dev,\n\t\t\t\t\t struct sk_buff *skb,\n\t\t\t\t\t __le32 *rxv, u32 mode);\nint mt76_connac2_reverse_frag0_hdr_trans(struct ieee80211_vif *vif,\n\t\t\t\t\t struct sk_buff *skb, u16 hdr_offset);\nint mt76_connac2_mac_fill_rx_rate(struct mt76_dev *dev,\n\t\t\t\t  struct mt76_rx_status *status,\n\t\t\t\t  struct ieee80211_supported_band *sband,\n\t\t\t\t  __le32 *rxv, u8 *mode);\nvoid mt76_connac2_tx_check_aggr(struct ieee80211_sta *sta, __le32 *txwi);\nvoid mt76_connac2_txwi_free(struct mt76_dev *dev, struct mt76_txwi_cache *t,\n\t\t\t    struct ieee80211_sta *sta,\n\t\t\t    struct list_head *free_list);\nvoid mt76_connac2_tx_token_put(struct mt76_dev *dev);\n\n \nvoid mt76_connac3_mac_decode_he_radiotap(struct sk_buff *skb, __le32 *rxv,\n\t\t\t\t\t u8 mode);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}