{
  "module_name": "mt7601u.h",
  "hash_id": "07f3fb0eb934e1af6742b11a9cf5d04863cd7d6be0b88f59c8bdebd5015bc532",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/mediatek/mt7601u/mt7601u.h",
  "human_readable_source": " \n \n\n#ifndef MT7601U_H\n#define MT7601U_H\n\n#include <linux/bitfield.h>\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/mutex.h>\n#include <linux/usb.h>\n#include <linux/completion.h>\n#include <net/mac80211.h>\n#include <linux/debugfs.h>\n#include <linux/average.h>\n\n#include \"regs.h\"\n\n#define MT_CALIBRATE_INTERVAL\t\t(4 * HZ)\n\n#define MT_FREQ_CAL_INIT_DELAY\t\t(30 * HZ)\n#define MT_FREQ_CAL_CHECK_INTERVAL\t(10 * HZ)\n#define MT_FREQ_CAL_ADJ_INTERVAL\t(HZ / 2)\n\n#define MT_BBP_REG_VERSION\t\t0x00\n\n#define MT_USB_AGGR_SIZE_LIMIT\t\t28  \n#define MT_USB_AGGR_TIMEOUT\t\t0x80  \n#define MT_RX_ORDER\t\t\t3\n#define MT_RX_URB_SIZE\t\t\t(PAGE_SIZE << MT_RX_ORDER)\n\nstruct mt7601u_dma_buf {\n\tstruct urb *urb;\n\tvoid *buf;\n\tdma_addr_t dma;\n\tsize_t len;\n};\n\nstruct mt7601u_mcu {\n\tstruct mutex mutex;\n\n\tu8 msg_seq;\n\n\tstruct mt7601u_dma_buf resp;\n\tstruct completion resp_cmpl;\n};\n\nstruct mt7601u_freq_cal {\n\tstruct delayed_work work;\n\tu8 freq;\n\tbool enabled;\n\tbool adjusting;\n};\n\nstruct mac_stats {\n\tu64 rx_stat[6];\n\tu64 tx_stat[6];\n\tu64 aggr_stat[2];\n\tu64 aggr_n[32];\n\tu64 zero_len_del[2];\n};\n\n#define N_RX_ENTRIES\t16\nstruct mt7601u_rx_queue {\n\tstruct mt7601u_dev *dev;\n\n\tstruct mt7601u_dma_buf_rx {\n\t\tstruct urb *urb;\n\t\tstruct page *p;\n\t} e[N_RX_ENTRIES];\n\n\tunsigned int start;\n\tunsigned int end;\n\tunsigned int entries;\n\tunsigned int pending;\n};\n\n#define N_TX_ENTRIES\t64\n\nstruct mt7601u_tx_queue {\n\tstruct mt7601u_dev *dev;\n\n\tstruct mt7601u_dma_buf_tx {\n\t\tstruct urb *urb;\n\t\tstruct sk_buff *skb;\n\t} e[N_TX_ENTRIES];\n\n\tunsigned int start;\n\tunsigned int end;\n\tunsigned int entries;\n\tunsigned int used;\n\tunsigned int fifo_seq;\n};\n\n \n#define N_WCIDS\t\t128\n#define GROUP_WCID(idx)\t(N_WCIDS - 2 - idx)\n\nstruct mt7601u_eeprom_params;\n\n#define MT_EE_TEMPERATURE_SLOPE\t\t39\n#define MT_FREQ_OFFSET_INVALID\t\t-128\n\nenum mt_temp_mode {\n\tMT_TEMP_MODE_NORMAL,\n\tMT_TEMP_MODE_HIGH,\n\tMT_TEMP_MODE_LOW,\n};\n\nenum mt_bw {\n\tMT_BW_20,\n\tMT_BW_40,\n};\n\nenum {\n\tMT7601U_STATE_INITIALIZED,\n\tMT7601U_STATE_REMOVED,\n\tMT7601U_STATE_WLAN_RUNNING,\n\tMT7601U_STATE_MCU_RUNNING,\n\tMT7601U_STATE_SCANNING,\n\tMT7601U_STATE_READING_STATS,\n\tMT7601U_STATE_MORE_STATS,\n};\n\nDECLARE_EWMA(rssi, 10, 4);\n\n \nstruct mt7601u_dev {\n\tstruct ieee80211_hw *hw;\n\tstruct device *dev;\n\n\tunsigned long state;\n\n\tstruct mutex mutex;\n\n\tunsigned long wcid_mask[N_WCIDS / BITS_PER_LONG];\n\n\tstruct cfg80211_chan_def chandef;\n\tstruct ieee80211_supported_band *sband_2g;\n\n\tstruct mt7601u_mcu mcu;\n\n\tstruct delayed_work cal_work;\n\tstruct delayed_work mac_work;\n\n\tstruct workqueue_struct *stat_wq;\n\tstruct delayed_work stat_work;\n\n\tstruct mt76_wcid *mon_wcid;\n\tstruct mt76_wcid __rcu *wcid[N_WCIDS];\n\n\tspinlock_t lock;\n\tspinlock_t mac_lock;\n\n\tconst u16 *beacon_offsets;\n\n\tu8 macaddr[ETH_ALEN];\n\tstruct mt7601u_eeprom_params *ee;\n\n\tstruct mutex vendor_req_mutex;\n\tvoid *vend_buf;\n\n\tstruct mutex reg_atomic_mutex;\n\tstruct mutex hw_atomic_mutex;\n\n\tu32 rxfilter;\n\tu32 debugfs_reg;\n\n\tu8 out_eps[8];\n\tu8 in_eps[8];\n\tu16 out_max_packet;\n\tu16 in_max_packet;\n\n\t \n\tspinlock_t tx_lock;\n\tstruct tasklet_struct tx_tasklet;\n\tstruct mt7601u_tx_queue *tx_q;\n\tstruct sk_buff_head tx_skb_done;\n\n\tatomic_t avg_ampdu_len;\n\n\t \n\tspinlock_t rx_lock;\n\tstruct tasklet_struct rx_tasklet;\n\tstruct mt7601u_rx_queue rx_q;\n\n\t \n\tspinlock_t con_mon_lock;\n\tu8 ap_bssid[ETH_ALEN];\n\n\ts8 bcn_freq_off;\n\tu8 bcn_phy_mode;\n\n\tstruct ewma_rssi avg_rssi;\n\n\tu8 agc_save;\n\n\tstruct mt7601u_freq_cal freq_cal;\n\n\tbool tssi_read_trig;\n\n\ts8 tssi_init;\n\ts8 tssi_init_hvga;\n\ts16 tssi_init_hvga_offset_db;\n\n\tint prev_pwr_diff;\n\n\tenum mt_temp_mode temp_mode;\n\tint curr_temp;\n\tint dpd_temp;\n\ts8 raw_temp;\n\tbool pll_lock_protect;\n\n\tu8 bw;\n\tbool chan_ext_below;\n\n\t \n\tu32 rf_pa_mode[2];\n\n\tstruct mac_stats stats;\n};\n\nstruct mt7601u_tssi_params {\n\tchar tssi0;\n\tint trgt_power;\n};\n\nstruct mt76_wcid {\n\tu8 idx;\n\tu8 hw_key_idx;\n\n\tu16 tx_rate;\n\tbool tx_rate_set;\n\tu8 tx_rate_nss;\n};\n\nstruct mt76_vif {\n\tu8 idx;\n\n\tstruct mt76_wcid group_wcid;\n};\n\nstruct mt76_sta {\n\tstruct mt76_wcid wcid;\n\tu16 agg_ssn[IEEE80211_NUM_TIDS];\n};\n\nstruct mt76_reg_pair {\n\tu32 reg;\n\tu32 value;\n};\n\nstruct mt7601u_rxwi;\n\nextern const struct ieee80211_ops mt7601u_ops;\n\nvoid mt7601u_init_debugfs(struct mt7601u_dev *dev);\n\nu32 mt7601u_rr(struct mt7601u_dev *dev, u32 offset);\nvoid mt7601u_wr(struct mt7601u_dev *dev, u32 offset, u32 val);\nu32 mt7601u_rmw(struct mt7601u_dev *dev, u32 offset, u32 mask, u32 val);\nu32 mt7601u_rmc(struct mt7601u_dev *dev, u32 offset, u32 mask, u32 val);\nvoid mt7601u_wr_copy(struct mt7601u_dev *dev, u32 offset,\n\t\t     const void *data, int len);\n\nint mt7601u_wait_asic_ready(struct mt7601u_dev *dev);\nbool mt76_poll(struct mt7601u_dev *dev, u32 offset, u32 mask, u32 val,\n\t       int timeout);\nbool mt76_poll_msec(struct mt7601u_dev *dev, u32 offset, u32 mask, u32 val,\n\t\t    int timeout);\n\n \n#define mt76_rmw_field(_dev, _reg, _field, _val)\t\\\n\tmt76_rmw(_dev, _reg, _field, FIELD_PREP(_field, _val))\n\nstatic inline u32 mt76_rr(struct mt7601u_dev *dev, u32 offset)\n{\n\treturn mt7601u_rr(dev, offset);\n}\n\nstatic inline void mt76_wr(struct mt7601u_dev *dev, u32 offset, u32 val)\n{\n\treturn mt7601u_wr(dev, offset, val);\n}\n\nstatic inline u32\nmt76_rmw(struct mt7601u_dev *dev, u32 offset, u32 mask, u32 val)\n{\n\treturn mt7601u_rmw(dev, offset, mask, val);\n}\n\nstatic inline u32 mt76_set(struct mt7601u_dev *dev, u32 offset, u32 val)\n{\n\treturn mt76_rmw(dev, offset, 0, val);\n}\n\nstatic inline u32 mt76_clear(struct mt7601u_dev *dev, u32 offset, u32 val)\n{\n\treturn mt76_rmw(dev, offset, val, 0);\n}\n\nint mt7601u_write_reg_pairs(struct mt7601u_dev *dev, u32 base,\n\t\t\t    const struct mt76_reg_pair *data, int len);\nint mt7601u_burst_write_regs(struct mt7601u_dev *dev, u32 offset,\n\t\t\t     const u32 *data, int n);\nvoid mt7601u_addr_wr(struct mt7601u_dev *dev, const u32 offset, const u8 *addr);\n\n \nstruct mt7601u_dev *mt7601u_alloc_device(struct device *dev);\nint mt7601u_init_hardware(struct mt7601u_dev *dev);\nint mt7601u_register_device(struct mt7601u_dev *dev);\nvoid mt7601u_cleanup(struct mt7601u_dev *dev);\n\nint mt7601u_mac_start(struct mt7601u_dev *dev);\nvoid mt7601u_mac_stop(struct mt7601u_dev *dev);\n\n \nint mt7601u_phy_init(struct mt7601u_dev *dev);\nint mt7601u_wait_bbp_ready(struct mt7601u_dev *dev);\nvoid mt7601u_set_rx_path(struct mt7601u_dev *dev, u8 path);\nvoid mt7601u_set_tx_dac(struct mt7601u_dev *dev, u8 path);\nint mt7601u_bbp_set_bw(struct mt7601u_dev *dev, int bw);\nvoid mt7601u_agc_save(struct mt7601u_dev *dev);\nvoid mt7601u_agc_restore(struct mt7601u_dev *dev);\nint mt7601u_phy_set_channel(struct mt7601u_dev *dev,\n\t\t\t    struct cfg80211_chan_def *chandef);\nvoid mt7601u_phy_recalibrate_after_assoc(struct mt7601u_dev *dev);\nint mt7601u_phy_get_rssi(struct mt7601u_dev *dev,\n\t\t\t struct mt7601u_rxwi *rxwi, u16 rate);\nvoid mt7601u_phy_con_cal_onoff(struct mt7601u_dev *dev,\n\t\t\t       struct ieee80211_bss_conf *info);\n\n \nvoid mt7601u_mac_work(struct work_struct *work);\nvoid mt7601u_mac_set_protection(struct mt7601u_dev *dev, bool legacy_prot,\n\t\t\t\tint ht_mode);\nvoid mt7601u_mac_set_short_preamble(struct mt7601u_dev *dev, bool short_preamb);\nvoid mt7601u_mac_config_tsf(struct mt7601u_dev *dev, bool enable, int interval);\nvoid\nmt7601u_mac_wcid_setup(struct mt7601u_dev *dev, u8 idx, u8 vif_idx, u8 *mac);\nvoid mt7601u_mac_set_ampdu_factor(struct mt7601u_dev *dev);\n\n \nvoid mt7601u_tx(struct ieee80211_hw *hw, struct ieee80211_tx_control *control,\n\t\tstruct sk_buff *skb);\nint mt7601u_conf_tx(struct ieee80211_hw *hw, struct ieee80211_vif *vif,\n\t\t    unsigned int link_id, u16 queue,\n\t\t    const struct ieee80211_tx_queue_params *params);\nvoid mt7601u_tx_status(struct mt7601u_dev *dev, struct sk_buff *skb);\nvoid mt7601u_tx_stat(struct work_struct *work);\n\n \nvoid mt76_remove_hdr_pad(struct sk_buff *skb);\nint mt76_insert_hdr_pad(struct sk_buff *skb);\n\nu32 mt7601u_bbp_set_ctrlch(struct mt7601u_dev *dev, bool below);\n\nstatic inline u32 mt7601u_mac_set_ctrlch(struct mt7601u_dev *dev, bool below)\n{\n\treturn mt7601u_rmc(dev, MT_TX_BAND_CFG, 1, below);\n}\n\nint mt7601u_dma_init(struct mt7601u_dev *dev);\nvoid mt7601u_dma_cleanup(struct mt7601u_dev *dev);\n\nint mt7601u_dma_enqueue_tx(struct mt7601u_dev *dev, struct sk_buff *skb,\n\t\t\t   struct mt76_wcid *wcid, int hw_q);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}