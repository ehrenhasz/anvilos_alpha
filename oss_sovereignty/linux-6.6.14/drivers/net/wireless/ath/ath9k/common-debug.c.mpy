{
  "module_name": "common-debug.c",
  "hash_id": "38f6fd7bb8fea826a7c812291984e64584340d8d6bd7ab415ec9108baf20f1c7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath9k/common-debug.c",
  "human_readable_source": " \n\n#include \"common.h\"\n\nstatic ssize_t read_file_modal_eeprom(struct file *file, char __user *user_buf,\n\t\t\t\t      size_t count, loff_t *ppos)\n{\n\tstruct ath_hw *ah = file->private_data;\n\tu32 len = 0, size = 6000;\n\tchar *buf;\n\tsize_t retval;\n\n\tbuf = kzalloc(size, GFP_KERNEL);\n\tif (buf == NULL)\n\t\treturn -ENOMEM;\n\n\tlen = ah->eep_ops->dump_eeprom(ah, false, buf, len, size);\n\n\tretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\n\tkfree(buf);\n\n\treturn retval;\n}\n\nstatic const struct file_operations fops_modal_eeprom = {\n\t.read = read_file_modal_eeprom,\n\t.open = simple_open,\n\t.owner = THIS_MODULE,\n\t.llseek = default_llseek,\n};\n\n\nvoid ath9k_cmn_debug_modal_eeprom(struct dentry *debugfs_phy,\n\t\t\t\t  struct ath_hw *ah)\n{\n\tdebugfs_create_file(\"modal_eeprom\", 0400, debugfs_phy, ah,\n\t\t\t    &fops_modal_eeprom);\n}\nEXPORT_SYMBOL(ath9k_cmn_debug_modal_eeprom);\n\nstatic ssize_t read_file_base_eeprom(struct file *file, char __user *user_buf,\n\t\t\t\t     size_t count, loff_t *ppos)\n{\n\tstruct ath_hw *ah = file->private_data;\n\tu32 len = 0, size = 1500;\n\tssize_t retval = 0;\n\tchar *buf;\n\n\tbuf = kzalloc(size, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tlen = ah->eep_ops->dump_eeprom(ah, true, buf, len, size);\n\n\tretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\n\tkfree(buf);\n\n\treturn retval;\n}\n\nstatic const struct file_operations fops_base_eeprom = {\n\t.read = read_file_base_eeprom,\n\t.open = simple_open,\n\t.owner = THIS_MODULE,\n\t.llseek = default_llseek,\n};\n\nvoid ath9k_cmn_debug_base_eeprom(struct dentry *debugfs_phy,\n\t\t\t\t struct ath_hw *ah)\n{\n\tdebugfs_create_file(\"base_eeprom\", 0400, debugfs_phy, ah,\n\t\t\t    &fops_base_eeprom);\n}\nEXPORT_SYMBOL(ath9k_cmn_debug_base_eeprom);\n\nvoid ath9k_cmn_debug_stat_rx(struct ath_rx_stats *rxstats,\n\t\t\t     struct ath_rx_status *rs)\n{\n#define RX_PHY_ERR_INC(c) rxstats->phy_err_stats[c]++\n#define RX_CMN_STAT_INC(c) (rxstats->c++)\n\n\tRX_CMN_STAT_INC(rx_pkts_all);\n\trxstats->rx_bytes_all += rs->rs_datalen;\n\n\tif (rs->rs_status & ATH9K_RXERR_CRC)\n\t\tRX_CMN_STAT_INC(crc_err);\n\tif (rs->rs_status & ATH9K_RXERR_DECRYPT)\n\t\tRX_CMN_STAT_INC(decrypt_crc_err);\n\tif (rs->rs_status & ATH9K_RXERR_MIC)\n\t\tRX_CMN_STAT_INC(mic_err);\n\tif (rs->rs_status & ATH9K_RX_DELIM_CRC_PRE)\n\t\tRX_CMN_STAT_INC(pre_delim_crc_err);\n\tif (rs->rs_status & ATH9K_RX_DELIM_CRC_POST)\n\t\tRX_CMN_STAT_INC(post_delim_crc_err);\n\tif (rs->rs_status & ATH9K_RX_DECRYPT_BUSY)\n\t\tRX_CMN_STAT_INC(decrypt_busy_err);\n\n\tif (rs->rs_status & ATH9K_RXERR_PHY) {\n\t\tRX_CMN_STAT_INC(phy_err);\n\t\tif (rs->rs_phyerr < ATH9K_PHYERR_MAX)\n\t\t\tRX_PHY_ERR_INC(rs->rs_phyerr);\n\t}\n\n#undef RX_CMN_STAT_INC\n#undef RX_PHY_ERR_INC\n}\nEXPORT_SYMBOL(ath9k_cmn_debug_stat_rx);\n\nstatic ssize_t read_file_recv(struct file *file, char __user *user_buf,\n\t\t\t      size_t count, loff_t *ppos)\n{\n#define RXS_ERR(s, e)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tlen += scnprintf(buf + len, size - len,\t\\\n\t\t\t\t \"%18s : %10u\\n\", s,\t\\\n\t\t\t\t rxstats->e);\t\t\\\n\t} while (0)\n\n\tstruct ath_rx_stats *rxstats = file->private_data;\n\tchar *buf;\n\tunsigned int len = 0, size = 1600;\n\tssize_t retval = 0;\n\n\tbuf = kzalloc(size, GFP_KERNEL);\n\tif (buf == NULL)\n\t\treturn -ENOMEM;\n\n\tRXS_ERR(\"PKTS-ALL\", rx_pkts_all);\n\tRXS_ERR(\"BYTES-ALL\", rx_bytes_all);\n\tRXS_ERR(\"BEACONS\", rx_beacons);\n\tRXS_ERR(\"FRAGS\", rx_frags);\n\tRXS_ERR(\"SPECTRAL\", rx_spectral);\n\tRXS_ERR(\"SPECTRAL SMPL GOOD\", rx_spectral_sample_good);\n\tRXS_ERR(\"SPECTRAL SMPL ERR\", rx_spectral_sample_err);\n\n\tRXS_ERR(\"CRC ERR\", crc_err);\n\tRXS_ERR(\"DECRYPT CRC ERR\", decrypt_crc_err);\n\tRXS_ERR(\"PHY ERR\", phy_err);\n\tRXS_ERR(\"MIC ERR\", mic_err);\n\tRXS_ERR(\"PRE-DELIM CRC ERR\", pre_delim_crc_err);\n\tRXS_ERR(\"POST-DELIM CRC ERR\", post_delim_crc_err);\n\tRXS_ERR(\"DECRYPT BUSY ERR\", decrypt_busy_err);\n\tRXS_ERR(\"LENGTH-ERR\", rx_len_err);\n\tRXS_ERR(\"OOM-ERR\", rx_oom_err);\n\tRXS_ERR(\"RATE-ERR\", rx_rate_err);\n\tRXS_ERR(\"TOO-MANY-FRAGS\", rx_too_many_frags_err);\n\n\tif (len > size)\n\t\tlen = size;\n\n\tretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\n\tkfree(buf);\n\n\treturn retval;\n\n#undef RXS_ERR\n}\n\nstatic const struct file_operations fops_recv = {\n\t.read = read_file_recv,\n\t.open = simple_open,\n\t.owner = THIS_MODULE,\n\t.llseek = default_llseek,\n};\n\nvoid ath9k_cmn_debug_recv(struct dentry *debugfs_phy,\n\t\t\t  struct ath_rx_stats *rxstats)\n{\n\tdebugfs_create_file(\"recv\", 0400, debugfs_phy, rxstats, &fops_recv);\n}\nEXPORT_SYMBOL(ath9k_cmn_debug_recv);\n\nstatic ssize_t read_file_phy_err(struct file *file, char __user *user_buf,\n\t\t\t\t size_t count, loff_t *ppos)\n{\n#define PHY_ERR(s, p) \\\n\tlen += scnprintf(buf + len, size - len, \"%22s : %10u\\n\", s, \\\n\t\t\t rxstats->phy_err_stats[p])\n\n\tstruct ath_rx_stats *rxstats = file->private_data;\n\tchar *buf;\n\tunsigned int len = 0, size = 1600;\n\tssize_t retval = 0;\n\n\tbuf = kzalloc(size, GFP_KERNEL);\n\tif (buf == NULL)\n\t\treturn -ENOMEM;\n\n\tPHY_ERR(\"UNDERRUN ERR\", ATH9K_PHYERR_UNDERRUN);\n\tPHY_ERR(\"TIMING ERR\", ATH9K_PHYERR_TIMING);\n\tPHY_ERR(\"PARITY ERR\", ATH9K_PHYERR_PARITY);\n\tPHY_ERR(\"RATE ERR\", ATH9K_PHYERR_RATE);\n\tPHY_ERR(\"LENGTH ERR\", ATH9K_PHYERR_LENGTH);\n\tPHY_ERR(\"RADAR ERR\", ATH9K_PHYERR_RADAR);\n\tPHY_ERR(\"SERVICE ERR\", ATH9K_PHYERR_SERVICE);\n\tPHY_ERR(\"TOR ERR\", ATH9K_PHYERR_TOR);\n\n\tPHY_ERR(\"OFDM-TIMING ERR\", ATH9K_PHYERR_OFDM_TIMING);\n\tPHY_ERR(\"OFDM-SIGNAL-PARITY ERR\", ATH9K_PHYERR_OFDM_SIGNAL_PARITY);\n\tPHY_ERR(\"OFDM-RATE ERR\", ATH9K_PHYERR_OFDM_RATE_ILLEGAL);\n\tPHY_ERR(\"OFDM-LENGTH ERR\", ATH9K_PHYERR_OFDM_LENGTH_ILLEGAL);\n\tPHY_ERR(\"OFDM-POWER-DROP ERR\", ATH9K_PHYERR_OFDM_POWER_DROP);\n\tPHY_ERR(\"OFDM-SERVICE ERR\", ATH9K_PHYERR_OFDM_SERVICE);\n\tPHY_ERR(\"OFDM-RESTART ERR\", ATH9K_PHYERR_OFDM_RESTART);\n\n\tPHY_ERR(\"CCK-BLOCKER ERR\", ATH9K_PHYERR_CCK_BLOCKER);\n\tPHY_ERR(\"CCK-TIMING ERR\", ATH9K_PHYERR_CCK_TIMING);\n\tPHY_ERR(\"CCK-HEADER-CRC ERR\", ATH9K_PHYERR_CCK_HEADER_CRC);\n\tPHY_ERR(\"CCK-RATE ERR\", ATH9K_PHYERR_CCK_RATE_ILLEGAL);\n\tPHY_ERR(\"CCK-LENGTH ERR\", ATH9K_PHYERR_CCK_LENGTH_ILLEGAL);\n\tPHY_ERR(\"CCK-POWER-DROP ERR\", ATH9K_PHYERR_CCK_POWER_DROP);\n\tPHY_ERR(\"CCK-SERVICE ERR\", ATH9K_PHYERR_CCK_SERVICE);\n\tPHY_ERR(\"CCK-RESTART ERR\", ATH9K_PHYERR_CCK_RESTART);\n\n\tPHY_ERR(\"HT-CRC ERR\", ATH9K_PHYERR_HT_CRC_ERROR);\n\tPHY_ERR(\"HT-LENGTH ERR\", ATH9K_PHYERR_HT_LENGTH_ILLEGAL);\n\tPHY_ERR(\"HT-RATE ERR\", ATH9K_PHYERR_HT_RATE_ILLEGAL);\n\tPHY_ERR(\"HT-ZLF ERR\", ATH9K_PHYERR_HT_ZLF);\n\n\tPHY_ERR(\"FALSE-RADAR-EXT ERR\", ATH9K_PHYERR_FALSE_RADAR_EXT);\n\tPHY_ERR(\"GREEN-FIELD ERR\", ATH9K_PHYERR_GREEN_FIELD);\n\tPHY_ERR(\"SPECTRAL ERR\", ATH9K_PHYERR_SPECTRAL);\n\n\tif (len > size)\n\t\tlen = size;\n\n\tretval = simple_read_from_buffer(user_buf, count, ppos, buf, len);\n\tkfree(buf);\n\n\treturn retval;\n\n#undef PHY_ERR\n}\n\nstatic const struct file_operations fops_phy_err = {\n\t.read = read_file_phy_err,\n\t.open = simple_open,\n\t.owner = THIS_MODULE,\n\t.llseek = default_llseek,\n};\n\nvoid ath9k_cmn_debug_phy_err(struct dentry *debugfs_phy,\n\t\t\t     struct ath_rx_stats *rxstats)\n{\n\tdebugfs_create_file(\"phy_err\", 0400, debugfs_phy, rxstats,\n\t\t\t    &fops_phy_err);\n}\nEXPORT_SYMBOL(ath9k_cmn_debug_phy_err);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}