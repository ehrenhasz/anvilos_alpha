{
  "module_name": "common-spectral.h",
  "hash_id": "fcdf7d41516d1e4627778a351ab9351f499f42f154e8d51ae01b84596e1021fa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath9k/common-spectral.h",
  "human_readable_source": " \n\n#ifndef SPECTRAL_H\n#define SPECTRAL_H\n\n#include \"../spectral_common.h\"\n\n \nenum spectral_mode {\n\tSPECTRAL_DISABLED = 0,\n\tSPECTRAL_BACKGROUND,\n\tSPECTRAL_MANUAL,\n\tSPECTRAL_CHANSCAN,\n};\n\n#define SPECTRAL_SCAN_BITMASK\t\t0x10\n \nstruct ath_radar_info {\n\tu8 pulse_length_pri;\n\tu8 pulse_length_ext;\n\tu8 pulse_bw_info;\n} __packed;\n\n \nstruct ath_ht20_mag_info {\n\tu8 all_bins[3];\n\tu8 max_exp;\n} __packed;\n\n \nstruct ath_ht20_fft_packet {\n\tu8 data[SPECTRAL_HT20_NUM_BINS];\n\tstruct ath_ht20_mag_info mag_info;\n\tstruct ath_radar_info radar_info;\n} __packed;\n\n#define SPECTRAL_HT20_TOTAL_DATA_LEN\t(sizeof(struct ath_ht20_fft_packet))\n#define\tSPECTRAL_HT20_SAMPLE_LEN\t(sizeof(struct ath_ht20_mag_info) +\\\n\t\t\t\t\tSPECTRAL_HT20_NUM_BINS)\n\n \nstruct ath_ht20_40_mag_info {\n\tu8 lower_bins[3];\n\tu8 upper_bins[3];\n\tu8 max_exp;\n} __packed;\n\n \nstruct ath_ht20_40_fft_packet {\n\tu8 data[SPECTRAL_HT20_40_NUM_BINS];\n\tstruct ath_ht20_40_mag_info mag_info;\n\tstruct ath_radar_info radar_info;\n} __packed;\n\nstruct ath_spec_scan_priv {\n\tstruct ath_hw *ah;\n\t \n\tstruct rchan *rfs_chan_spec_scan;\n\tenum spectral_mode spectral_mode;\n\tstruct ath_spec_scan spec_config;\n};\n\n#define SPECTRAL_HT20_40_TOTAL_DATA_LEN\t(sizeof(struct ath_ht20_40_fft_packet))\n#define\tSPECTRAL_HT20_40_SAMPLE_LEN\t(sizeof(struct ath_ht20_40_mag_info) +\\\n\t\t\t\t\tSPECTRAL_HT20_40_NUM_BINS)\n\n#define\tSPECTRAL_SAMPLE_MAX_LEN\t\tSPECTRAL_HT20_40_SAMPLE_LEN\n\n \nstatic inline u16 spectral_max_magnitude(u8 *bins)\n{\n\treturn (bins[0] & 0xc0) >> 6 |\n\t       (bins[1] & 0xff) << 2 |\n\t       (bins[2] & 0x03) << 10;\n}\n\n \nstatic inline u8 spectral_max_index(u8 *bins, int num_bins)\n{\n\ts8 m = (bins[2] & 0xfc) >> 2;\n\tu8 zero_idx = num_bins / 2;\n\n\t \n\tif (m & 0x20) {\n\t\tm &= ~0x20;\n\t\tm |= 0xe0;\n\t}\n\n\t \n\tm += zero_idx;\n\n\t \n\tif (m < 0 || m > num_bins - 1)\n\t\tm = 0;\n\n\treturn m;\n}\n\nstatic inline u8 spectral_max_index_ht40(u8 *bins)\n{\n\tu8 idx;\n\n\tidx = spectral_max_index(bins, SPECTRAL_HT20_40_NUM_BINS);\n\n\t \n\treturn idx % (SPECTRAL_HT20_40_NUM_BINS / 2);\n}\n\nstatic inline u8 spectral_max_index_ht20(u8 *bins)\n{\n\treturn spectral_max_index(bins, SPECTRAL_HT20_NUM_BINS);\n}\n\n \nstatic inline u8 spectral_bitmap_weight(u8 *bins)\n{\n\treturn bins[0] & 0x3f;\n}\n\n#ifdef CONFIG_ATH9K_COMMON_SPECTRAL\nvoid ath9k_cmn_spectral_init_debug(struct ath_spec_scan_priv *spec_priv, struct dentry *debugfs_phy);\nvoid ath9k_cmn_spectral_deinit_debug(struct ath_spec_scan_priv *spec_priv);\n\nvoid ath9k_cmn_spectral_scan_trigger(struct ath_common *common,\n\t\t\t\t struct ath_spec_scan_priv *spec_priv);\nint ath9k_cmn_spectral_scan_config(struct ath_common *common,\n\t\t\t       struct ath_spec_scan_priv *spec_priv,\n\t\t\t       enum spectral_mode spectral_mode);\nint ath_cmn_process_fft(struct ath_spec_scan_priv *spec_priv, struct ieee80211_hdr *hdr,\n\t\t    struct ath_rx_status *rs, u64 tsf);\n#else\nstatic inline void ath9k_cmn_spectral_init_debug(struct ath_spec_scan_priv *spec_priv,\n\t\t\t\t\t\t struct dentry *debugfs_phy)\n{\n}\n\nstatic inline void ath9k_cmn_spectral_deinit_debug(struct ath_spec_scan_priv *spec_priv)\n{\n}\n\nstatic inline void ath9k_cmn_spectral_scan_trigger(struct ath_common *common,\n\t\t\t\t\t\t   struct ath_spec_scan_priv *spec_priv)\n{\n}\n\nstatic inline int ath_cmn_process_fft(struct ath_spec_scan_priv *spec_priv,\n\t\t\t\t      struct ieee80211_hdr *hdr,\n\t\t\t\t      struct ath_rx_status *rs, u64 tsf)\n{\n\treturn 0;\n}\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}