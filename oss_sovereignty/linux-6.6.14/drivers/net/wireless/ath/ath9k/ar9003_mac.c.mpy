{
  "module_name": "ar9003_mac.c",
  "hash_id": "b4a6263c032147fec2d7f5db774c79559658aba36b4cfb95864ac165c97733c1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath9k/ar9003_mac.c",
  "human_readable_source": " \n#include <linux/export.h>\n#include \"hw.h\"\n#include \"ar9003_mac.h\"\n#include \"ar9003_mci.h\"\n\nstatic void ar9003_hw_rx_enable(struct ath_hw *hw)\n{\n\tREG_WRITE(hw, AR_CR, 0);\n}\n\nstatic void\nar9003_set_txdesc(struct ath_hw *ah, void *ds, struct ath_tx_info *i)\n{\n\tstruct ar9003_txc *ads = ds;\n\tint checksum = 0;\n\tu32 val, ctl12, ctl17;\n\tu8 desc_len;\n\n\tdesc_len = ((AR_SREV_9462(ah) || AR_SREV_9565(ah)) ? 0x18 : 0x17);\n\n\tval = (ATHEROS_VENDOR_ID << AR_DescId_S) |\n\t      (1 << AR_TxRxDesc_S) |\n\t      (1 << AR_CtrlStat_S) |\n\t      (i->qcu << AR_TxQcuNum_S) | desc_len;\n\n\tchecksum += val;\n\tWRITE_ONCE(ads->info, val);\n\n\tchecksum += i->link;\n\tWRITE_ONCE(ads->link, i->link);\n\n\tchecksum += i->buf_addr[0];\n\tWRITE_ONCE(ads->data0, i->buf_addr[0]);\n\tchecksum += i->buf_addr[1];\n\tWRITE_ONCE(ads->data1, i->buf_addr[1]);\n\tchecksum += i->buf_addr[2];\n\tWRITE_ONCE(ads->data2, i->buf_addr[2]);\n\tchecksum += i->buf_addr[3];\n\tWRITE_ONCE(ads->data3, i->buf_addr[3]);\n\n\tchecksum += (val = (i->buf_len[0] << AR_BufLen_S) & AR_BufLen);\n\tWRITE_ONCE(ads->ctl3, val);\n\tchecksum += (val = (i->buf_len[1] << AR_BufLen_S) & AR_BufLen);\n\tWRITE_ONCE(ads->ctl5, val);\n\tchecksum += (val = (i->buf_len[2] << AR_BufLen_S) & AR_BufLen);\n\tWRITE_ONCE(ads->ctl7, val);\n\tchecksum += (val = (i->buf_len[3] << AR_BufLen_S) & AR_BufLen);\n\tWRITE_ONCE(ads->ctl9, val);\n\n\tchecksum = (u16) (((checksum & 0xffff) + (checksum >> 16)) & 0xffff);\n\tWRITE_ONCE(ads->ctl10, checksum);\n\n\tif (i->is_first || i->is_last) {\n\t\tWRITE_ONCE(ads->ctl13, set11nTries(i->rates, 0)\n\t\t\t| set11nTries(i->rates, 1)\n\t\t\t| set11nTries(i->rates, 2)\n\t\t\t| set11nTries(i->rates, 3)\n\t\t\t| (i->dur_update ? AR_DurUpdateEna : 0)\n\t\t\t| SM(0, AR_BurstDur));\n\n\t\tWRITE_ONCE(ads->ctl14, set11nRate(i->rates, 0)\n\t\t\t| set11nRate(i->rates, 1)\n\t\t\t| set11nRate(i->rates, 2)\n\t\t\t| set11nRate(i->rates, 3));\n\t} else {\n\t\tWRITE_ONCE(ads->ctl13, 0);\n\t\tWRITE_ONCE(ads->ctl14, 0);\n\t}\n\n\tads->ctl20 = 0;\n\tads->ctl21 = 0;\n\tads->ctl22 = 0;\n\tads->ctl23 = 0;\n\n\tctl17 = SM(i->keytype, AR_EncrType);\n\tif (!i->is_first) {\n\t\tWRITE_ONCE(ads->ctl11, 0);\n\t\tWRITE_ONCE(ads->ctl12, i->is_last ? 0 : AR_TxMore);\n\t\tWRITE_ONCE(ads->ctl15, 0);\n\t\tWRITE_ONCE(ads->ctl16, 0);\n\t\tWRITE_ONCE(ads->ctl17, ctl17);\n\t\tWRITE_ONCE(ads->ctl18, 0);\n\t\tWRITE_ONCE(ads->ctl19, 0);\n\t\treturn;\n\t}\n\n\tWRITE_ONCE(ads->ctl11, (i->pkt_len & AR_FrameLen)\n\t\t| (i->flags & ATH9K_TXDESC_VMF ? AR_VirtMoreFrag : 0)\n\t\t| SM(i->txpower[0], AR_XmitPower0)\n\t\t| (i->flags & ATH9K_TXDESC_VEOL ? AR_VEOL : 0)\n\t\t| (i->keyix != ATH9K_TXKEYIX_INVALID ? AR_DestIdxValid : 0)\n\t\t| (i->flags & ATH9K_TXDESC_LOWRXCHAIN ? AR_LowRxChain : 0)\n\t\t| (i->flags & ATH9K_TXDESC_CLRDMASK ? AR_ClrDestMask : 0)\n\t\t| (i->flags & ATH9K_TXDESC_RTSENA ? AR_RTSEnable :\n\t\t   (i->flags & ATH9K_TXDESC_CTSENA ? AR_CTSEnable : 0)));\n\n\tctl12 = (i->keyix != ATH9K_TXKEYIX_INVALID ?\n\t\t SM(i->keyix, AR_DestIdx) : 0)\n\t\t| SM(i->type, AR_FrameType)\n\t\t| (i->flags & ATH9K_TXDESC_NOACK ? AR_NoAck : 0)\n\t\t| (i->flags & ATH9K_TXDESC_EXT_ONLY ? AR_ExtOnly : 0)\n\t\t| (i->flags & ATH9K_TXDESC_EXT_AND_CTL ? AR_ExtAndCtl : 0);\n\n\tctl17 |= (i->flags & ATH9K_TXDESC_LDPC ? AR_LDPC : 0);\n\tswitch (i->aggr) {\n\tcase AGGR_BUF_FIRST:\n\t\tctl17 |= SM(i->aggr_len, AR_AggrLen);\n\t\tfallthrough;\n\tcase AGGR_BUF_MIDDLE:\n\t\tctl12 |= AR_IsAggr | AR_MoreAggr;\n\t\tctl17 |= SM(i->ndelim, AR_PadDelim);\n\t\tbreak;\n\tcase AGGR_BUF_LAST:\n\t\tctl12 |= AR_IsAggr;\n\t\tbreak;\n\tcase AGGR_BUF_NONE:\n\t\tbreak;\n\t}\n\n\tval = (i->flags & ATH9K_TXDESC_PAPRD) >> ATH9K_TXDESC_PAPRD_S;\n\tctl12 |= SM(val, AR_PAPRDChainMask);\n\n\tWRITE_ONCE(ads->ctl12, ctl12);\n\tWRITE_ONCE(ads->ctl17, ctl17);\n\n\tWRITE_ONCE(ads->ctl15, set11nPktDurRTSCTS(i->rates, 0)\n\t\t| set11nPktDurRTSCTS(i->rates, 1));\n\n\tWRITE_ONCE(ads->ctl16, set11nPktDurRTSCTS(i->rates, 2)\n\t\t| set11nPktDurRTSCTS(i->rates, 3));\n\n\tWRITE_ONCE(ads->ctl18,\n\t\t  set11nRateFlags(i->rates, 0) | set11nChainSel(i->rates, 0)\n\t\t| set11nRateFlags(i->rates, 1) | set11nChainSel(i->rates, 1)\n\t\t| set11nRateFlags(i->rates, 2) | set11nChainSel(i->rates, 2)\n\t\t| set11nRateFlags(i->rates, 3) | set11nChainSel(i->rates, 3)\n\t\t| SM(i->rtscts_rate, AR_RTSCTSRate));\n\n\tWRITE_ONCE(ads->ctl19, AR_Not_Sounding);\n\n\tWRITE_ONCE(ads->ctl20, SM(i->txpower[1], AR_XmitPower1));\n\tWRITE_ONCE(ads->ctl21, SM(i->txpower[2], AR_XmitPower2));\n\tWRITE_ONCE(ads->ctl22, SM(i->txpower[3], AR_XmitPower3));\n}\n\nstatic u16 ar9003_calc_ptr_chksum(struct ar9003_txc *ads)\n{\n\tint checksum;\n\n\tchecksum = ads->info + ads->link\n\t\t+ ads->data0 + ads->ctl3\n\t\t+ ads->data1 + ads->ctl5\n\t\t+ ads->data2 + ads->ctl7\n\t\t+ ads->data3 + ads->ctl9;\n\n\treturn ((checksum & 0xffff) + (checksum >> 16)) & AR_TxPtrChkSum;\n}\n\nstatic void ar9003_hw_set_desc_link(void *ds, u32 ds_link)\n{\n\tstruct ar9003_txc *ads = ds;\n\n\tads->link = ds_link;\n\tads->ctl10 &= ~AR_TxPtrChkSum;\n\tads->ctl10 |= ar9003_calc_ptr_chksum(ads);\n}\n\nstatic bool ar9003_hw_get_isr(struct ath_hw *ah, enum ath9k_int *masked,\n\t\t\t      u32 *sync_cause_p)\n{\n\tu32 isr = 0;\n\tu32 mask2 = 0;\n\tstruct ath9k_hw_capabilities *pCap = &ah->caps;\n\tstruct ath_common *common = ath9k_hw_common(ah);\n\tu32 sync_cause = 0, async_cause, async_mask = AR_INTR_MAC_IRQ;\n\tbool fatal_int;\n\n\tif (ath9k_hw_mci_is_enabled(ah))\n\t\tasync_mask |= AR_INTR_ASYNC_MASK_MCI;\n\n\tasync_cause = REG_READ(ah, AR_INTR_ASYNC_CAUSE(ah));\n\n\tif (async_cause & async_mask) {\n\t\tif ((REG_READ(ah, AR_RTC_STATUS(ah)) & AR_RTC_STATUS_M(ah))\n\t\t\t\t== AR_RTC_STATUS_ON)\n\t\t\tisr = REG_READ(ah, AR_ISR);\n\t}\n\n\n\tsync_cause = REG_READ(ah, AR_INTR_SYNC_CAUSE(ah)) & AR_INTR_SYNC_DEFAULT;\n\n\t*masked = 0;\n\n\tif (!isr && !sync_cause && !async_cause)\n\t\treturn false;\n\n\tif (isr) {\n\t\tif (isr & AR_ISR_BCNMISC) {\n\t\t\tu32 isr2;\n\t\t\tisr2 = REG_READ(ah, AR_ISR_S2);\n\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_TIM) >>\n\t\t\t\t  MAP_ISR_S2_TIM);\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_DTIM) >>\n\t\t\t\t  MAP_ISR_S2_DTIM);\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_DTIMSYNC) >>\n\t\t\t\t  MAP_ISR_S2_DTIMSYNC);\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_CABEND) >>\n\t\t\t\t  MAP_ISR_S2_CABEND);\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_GTT) <<\n\t\t\t\t  MAP_ISR_S2_GTT);\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_CST) <<\n\t\t\t\t  MAP_ISR_S2_CST);\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_TSFOOR) >>\n\t\t\t\t  MAP_ISR_S2_TSFOOR);\n\t\t\tmask2 |= ((isr2 & AR_ISR_S2_BB_WATCHDOG) >>\n\t\t\t\t  MAP_ISR_S2_BB_WATCHDOG);\n\n\t\t\tif (!(pCap->hw_caps & ATH9K_HW_CAP_RAC_SUPPORTED)) {\n\t\t\t\tREG_WRITE(ah, AR_ISR_S2, isr2);\n\t\t\t\tisr &= ~AR_ISR_BCNMISC;\n\t\t\t}\n\t\t}\n\n\t\tif ((pCap->hw_caps & ATH9K_HW_CAP_RAC_SUPPORTED))\n\t\t\tisr = REG_READ(ah, AR_ISR_RAC);\n\n\t\tif (isr == 0xffffffff) {\n\t\t\t*masked = 0;\n\t\t\treturn false;\n\t\t}\n\n\t\t*masked = isr & ATH9K_INT_COMMON;\n\n\t\tif (ah->config.rx_intr_mitigation)\n\t\t\tif (isr & (AR_ISR_RXMINTR | AR_ISR_RXINTM))\n\t\t\t\t*masked |= ATH9K_INT_RXLP;\n\n\t\tif (ah->config.tx_intr_mitigation)\n\t\t\tif (isr & (AR_ISR_TXMINTR | AR_ISR_TXINTM))\n\t\t\t\t*masked |= ATH9K_INT_TX;\n\n\t\tif (isr & (AR_ISR_LP_RXOK | AR_ISR_RXERR))\n\t\t\t*masked |= ATH9K_INT_RXLP;\n\n\t\tif (isr & AR_ISR_HP_RXOK)\n\t\t\t*masked |= ATH9K_INT_RXHP;\n\n\t\tif (isr & (AR_ISR_TXOK | AR_ISR_TXERR | AR_ISR_TXEOL)) {\n\t\t\t*masked |= ATH9K_INT_TX;\n\n\t\t\tif (!(pCap->hw_caps & ATH9K_HW_CAP_RAC_SUPPORTED)) {\n\t\t\t\tu32 s0, s1;\n\t\t\t\ts0 = REG_READ(ah, AR_ISR_S0);\n\t\t\t\tREG_WRITE(ah, AR_ISR_S0, s0);\n\t\t\t\ts1 = REG_READ(ah, AR_ISR_S1);\n\t\t\t\tREG_WRITE(ah, AR_ISR_S1, s1);\n\n\t\t\t\tisr &= ~(AR_ISR_TXOK | AR_ISR_TXERR |\n\t\t\t\t\t AR_ISR_TXEOL);\n\t\t\t}\n\t\t}\n\n\t\tif (isr & AR_ISR_GENTMR) {\n\t\t\tu32 s5;\n\n\t\t\tif (pCap->hw_caps & ATH9K_HW_CAP_RAC_SUPPORTED)\n\t\t\t\ts5 = REG_READ(ah, AR_ISR_S5_S(ah));\n\t\t\telse\n\t\t\t\ts5 = REG_READ(ah, AR_ISR_S5);\n\n\t\t\tah->intr_gen_timer_trigger =\n\t\t\t\tMS(s5, AR_ISR_S5_GENTIMER_TRIG);\n\n\t\t\tah->intr_gen_timer_thresh =\n\t\t\t\tMS(s5, AR_ISR_S5_GENTIMER_THRESH);\n\n\t\t\tif (ah->intr_gen_timer_trigger)\n\t\t\t\t*masked |= ATH9K_INT_GENTIMER;\n\n\t\t\tif (!(pCap->hw_caps & ATH9K_HW_CAP_RAC_SUPPORTED)) {\n\t\t\t\tREG_WRITE(ah, AR_ISR_S5, s5);\n\t\t\t\tisr &= ~AR_ISR_GENTMR;\n\t\t\t}\n\n\t\t}\n\n\t\t*masked |= mask2;\n\n\t\tif (!(pCap->hw_caps & ATH9K_HW_CAP_RAC_SUPPORTED)) {\n\t\t\tREG_WRITE(ah, AR_ISR, isr);\n\n\t\t\t(void) REG_READ(ah, AR_ISR);\n\t\t}\n\n\t\tif (*masked & ATH9K_INT_BB_WATCHDOG)\n\t\t\tar9003_hw_bb_watchdog_read(ah);\n\t}\n\n\tif (async_cause & AR_INTR_ASYNC_MASK_MCI)\n\t\tar9003_mci_get_isr(ah, masked);\n\n\tif (sync_cause) {\n\t\tif (sync_cause_p)\n\t\t\t*sync_cause_p = sync_cause;\n\t\tfatal_int =\n\t\t\t(sync_cause &\n\t\t\t (AR_INTR_SYNC_HOST1_FATAL | AR_INTR_SYNC_HOST1_PERR))\n\t\t\t? true : false;\n\n\t\tif (fatal_int) {\n\t\t\tif (sync_cause & AR_INTR_SYNC_HOST1_FATAL) {\n\t\t\t\tath_dbg(common, ANY,\n\t\t\t\t\t\"received PCI FATAL interrupt\\n\");\n\t\t\t}\n\t\t\tif (sync_cause & AR_INTR_SYNC_HOST1_PERR) {\n\t\t\t\tath_dbg(common, ANY,\n\t\t\t\t\t\"received PCI PERR interrupt\\n\");\n\t\t\t}\n\t\t\t*masked |= ATH9K_INT_FATAL;\n\t\t}\n\n\t\tif (sync_cause & AR_INTR_SYNC_RADM_CPL_TIMEOUT) {\n\t\t\tREG_WRITE(ah, AR_RC, AR_RC_HOSTIF);\n\t\t\tREG_WRITE(ah, AR_RC, 0);\n\t\t\t*masked |= ATH9K_INT_FATAL;\n\t\t}\n\n\t\tif (sync_cause & AR_INTR_SYNC_LOCAL_TIMEOUT)\n\t\t\tath_dbg(common, INTERRUPT,\n\t\t\t\t\"AR_INTR_SYNC_LOCAL_TIMEOUT\\n\");\n\n\t\tREG_WRITE(ah, AR_INTR_SYNC_CAUSE_CLR(ah), sync_cause);\n\t\t(void) REG_READ(ah, AR_INTR_SYNC_CAUSE_CLR(ah));\n\n\t}\n\treturn true;\n}\n\nstatic int ar9003_hw_proc_txdesc(struct ath_hw *ah, void *ds,\n\t\t\t\t struct ath_tx_status *ts)\n{\n\tstruct ar9003_txs *ads;\n\tu32 status;\n\n\tads = &ah->ts_ring[ah->ts_tail];\n\n\tstatus = READ_ONCE(ads->status8);\n\tif ((status & AR_TxDone) == 0)\n\t\treturn -EINPROGRESS;\n\n\tah->ts_tail = (ah->ts_tail + 1) % ah->ts_size;\n\n\tif ((MS(ads->ds_info, AR_DescId) != ATHEROS_VENDOR_ID) ||\n\t    (MS(ads->ds_info, AR_TxRxDesc) != 1)) {\n\t\tath_dbg(ath9k_hw_common(ah), XMIT,\n\t\t\t\"Tx Descriptor error %x\\n\", ads->ds_info);\n\t\tmemset(ads, 0, sizeof(*ads));\n\t\treturn -EIO;\n\t}\n\n\tts->ts_rateindex = MS(status, AR_FinalTxIdx);\n\tts->ts_seqnum = MS(status, AR_SeqNum);\n\tts->tid = MS(status, AR_TxTid);\n\n\tts->qid = MS(ads->ds_info, AR_TxQcuNum);\n\tts->desc_id = MS(ads->status1, AR_TxDescId);\n\tts->ts_tstamp = ads->status4;\n\tts->ts_status = 0;\n\tts->ts_flags  = 0;\n\n\tif (status & AR_TxOpExceeded)\n\t\tts->ts_status |= ATH9K_TXERR_XTXOP;\n\tstatus = READ_ONCE(ads->status2);\n\tts->ts_rssi_ctl0 = MS(status, AR_TxRSSIAnt00);\n\tts->ts_rssi_ctl1 = MS(status, AR_TxRSSIAnt01);\n\tts->ts_rssi_ctl2 = MS(status, AR_TxRSSIAnt02);\n\tif (status & AR_TxBaStatus) {\n\t\tts->ts_flags |= ATH9K_TX_BA;\n\t\tts->ba_low = ads->status5;\n\t\tts->ba_high = ads->status6;\n\t}\n\n\tstatus = READ_ONCE(ads->status3);\n\tif (status & AR_ExcessiveRetries)\n\t\tts->ts_status |= ATH9K_TXERR_XRETRY;\n\tif (status & AR_Filtered)\n\t\tts->ts_status |= ATH9K_TXERR_FILT;\n\tif (status & AR_FIFOUnderrun) {\n\t\tts->ts_status |= ATH9K_TXERR_FIFO;\n\t\tath9k_hw_updatetxtriglevel(ah, true);\n\t}\n\tif (status & AR_TxTimerExpired)\n\t\tts->ts_status |= ATH9K_TXERR_TIMER_EXPIRED;\n\tif (status & AR_DescCfgErr)\n\t\tts->ts_flags |= ATH9K_TX_DESC_CFG_ERR;\n\tif (status & AR_TxDataUnderrun) {\n\t\tts->ts_flags |= ATH9K_TX_DATA_UNDERRUN;\n\t\tath9k_hw_updatetxtriglevel(ah, true);\n\t}\n\tif (status & AR_TxDelimUnderrun) {\n\t\tts->ts_flags |= ATH9K_TX_DELIM_UNDERRUN;\n\t\tath9k_hw_updatetxtriglevel(ah, true);\n\t}\n\tts->ts_shortretry = MS(status, AR_RTSFailCnt);\n\tts->ts_longretry = MS(status, AR_DataFailCnt);\n\tts->ts_virtcol = MS(status, AR_VirtRetryCnt);\n\n\tstatus = READ_ONCE(ads->status7);\n\tts->ts_rssi = MS(status, AR_TxRSSICombined);\n\tts->ts_rssi_ext0 = MS(status, AR_TxRSSIAnt10);\n\tts->ts_rssi_ext1 = MS(status, AR_TxRSSIAnt11);\n\tts->ts_rssi_ext2 = MS(status, AR_TxRSSIAnt12);\n\n\tmemset(ads, 0, sizeof(*ads));\n\n\treturn 0;\n}\n\nstatic int ar9003_hw_get_duration(struct ath_hw *ah, const void *ds, int index)\n{\n\tconst struct ar9003_txc *adc = ds;\n\n\tswitch (index) {\n\tcase 0:\n\t\treturn MS(READ_ONCE(adc->ctl15), AR_PacketDur0);\n\tcase 1:\n\t\treturn MS(READ_ONCE(adc->ctl15), AR_PacketDur1);\n\tcase 2:\n\t\treturn MS(READ_ONCE(adc->ctl16), AR_PacketDur2);\n\tcase 3:\n\t\treturn MS(READ_ONCE(adc->ctl16), AR_PacketDur3);\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nvoid ar9003_hw_attach_mac_ops(struct ath_hw *hw)\n{\n\tstruct ath_hw_ops *ops = ath9k_hw_ops(hw);\n\n\tops->rx_enable = ar9003_hw_rx_enable;\n\tops->set_desc_link = ar9003_hw_set_desc_link;\n\tops->get_isr = ar9003_hw_get_isr;\n\tops->set_txdesc = ar9003_set_txdesc;\n\tops->proc_txdesc = ar9003_hw_proc_txdesc;\n\tops->get_duration = ar9003_hw_get_duration;\n}\n\nvoid ath9k_hw_set_rx_bufsize(struct ath_hw *ah, u16 buf_size)\n{\n\tREG_WRITE(ah, AR_DATABUF_SIZE, buf_size & AR_DATABUF_SIZE_MASK);\n}\nEXPORT_SYMBOL(ath9k_hw_set_rx_bufsize);\n\nvoid ath9k_hw_addrxbuf_edma(struct ath_hw *ah, u32 rxdp,\n\t\t\t    enum ath9k_rx_qtype qtype)\n{\n\tif (qtype == ATH9K_RX_QUEUE_HP)\n\t\tREG_WRITE(ah, AR_HP_RXDP, rxdp);\n\telse\n\t\tREG_WRITE(ah, AR_LP_RXDP, rxdp);\n}\nEXPORT_SYMBOL(ath9k_hw_addrxbuf_edma);\n\nint ath9k_hw_process_rxdesc_edma(struct ath_hw *ah, struct ath_rx_status *rxs,\n\t\t\t\t void *buf_addr)\n{\n\tstruct ar9003_rxs *rxsp = buf_addr;\n\tunsigned int phyerr;\n\n\tif ((rxsp->status11 & AR_RxDone) == 0)\n\t\treturn -EINPROGRESS;\n\n\tif (MS(rxsp->ds_info, AR_DescId) != 0x168c)\n\t\treturn -EINVAL;\n\n\tif ((rxsp->ds_info & (AR_TxRxDesc | AR_CtrlStat)) != 0)\n\t\treturn -EINPROGRESS;\n\n\trxs->rs_status = 0;\n\trxs->rs_flags =  0;\n\trxs->enc_flags = 0;\n\trxs->bw = RATE_INFO_BW_20;\n\n\trxs->rs_datalen = rxsp->status2 & AR_DataLen;\n\trxs->rs_tstamp =  rxsp->status3;\n\n\t \n\trxs->rs_rssi = MS(rxsp->status5, AR_RxRSSICombined);\n\trxs->rs_rssi_ctl[0] = MS(rxsp->status1, AR_RxRSSIAnt00);\n\trxs->rs_rssi_ctl[1] = MS(rxsp->status1, AR_RxRSSIAnt01);\n\trxs->rs_rssi_ctl[2] = MS(rxsp->status1, AR_RxRSSIAnt02);\n\trxs->rs_rssi_ext[0] = MS(rxsp->status5, AR_RxRSSIAnt10);\n\trxs->rs_rssi_ext[1] = MS(rxsp->status5, AR_RxRSSIAnt11);\n\trxs->rs_rssi_ext[2] = MS(rxsp->status5, AR_RxRSSIAnt12);\n\n\tif (rxsp->status11 & AR_RxKeyIdxValid)\n\t\trxs->rs_keyix = MS(rxsp->status11, AR_KeyIdx);\n\telse\n\t\trxs->rs_keyix = ATH9K_RXKEYIX_INVALID;\n\n\trxs->rs_rate = MS(rxsp->status1, AR_RxRate);\n\trxs->rs_more = (rxsp->status2 & AR_RxMore) ? 1 : 0;\n\n\trxs->rs_firstaggr = (rxsp->status11 & AR_RxFirstAggr) ? 1 : 0;\n\trxs->rs_isaggr = (rxsp->status11 & AR_RxAggr) ? 1 : 0;\n\trxs->rs_moreaggr = (rxsp->status11 & AR_RxMoreAggr) ? 1 : 0;\n\trxs->rs_antenna = (MS(rxsp->status4, AR_RxAntenna) & 0x7);\n\trxs->enc_flags |= (rxsp->status4 & AR_GI) ? RX_ENC_FLAG_SHORT_GI : 0;\n\trxs->enc_flags |=\n\t\t(rxsp->status4 & AR_STBC) ? (1 << RX_ENC_FLAG_STBC_SHIFT) : 0;\n\trxs->bw = (rxsp->status4 & AR_2040) ? RATE_INFO_BW_40 : RATE_INFO_BW_20;\n\n\trxs->evm0 = rxsp->status6;\n\trxs->evm1 = rxsp->status7;\n\trxs->evm2 = rxsp->status8;\n\trxs->evm3 = rxsp->status9;\n\trxs->evm4 = (rxsp->status10 & 0xffff);\n\n\tif (rxsp->status11 & AR_PreDelimCRCErr)\n\t\trxs->rs_flags |= ATH9K_RX_DELIM_CRC_PRE;\n\n\tif (rxsp->status11 & AR_PostDelimCRCErr)\n\t\trxs->rs_flags |= ATH9K_RX_DELIM_CRC_POST;\n\n\tif (rxsp->status11 & AR_DecryptBusyErr)\n\t\trxs->rs_flags |= ATH9K_RX_DECRYPT_BUSY;\n\n\tif ((rxsp->status11 & AR_RxFrameOK) == 0) {\n\t\t \n\t\tif (rxsp->status11 & AR_CRCErr)\n\t\t\trxs->rs_status |= ATH9K_RXERR_CRC;\n\t\telse if (rxsp->status11 & AR_DecryptCRCErr)\n\t\t\trxs->rs_status |= ATH9K_RXERR_DECRYPT;\n\t\telse if (rxsp->status11 & AR_MichaelErr)\n\t\t\trxs->rs_status |= ATH9K_RXERR_MIC;\n\t\tif (rxsp->status11 & AR_PHYErr) {\n\t\t\tphyerr = MS(rxsp->status11, AR_PHYErrCode);\n\t\t\t \n\t\t\tif ((phyerr == ATH9K_PHYERR_OFDM_RESTART) &&\n\t\t\t    (rxsp->status11 & AR_PostDelimCRCErr)) {\n\t\t\t\trxs->rs_phyerr = 0;\n\t\t\t} else {\n\t\t\t\trxs->rs_status |= ATH9K_RXERR_PHY;\n\t\t\t\trxs->rs_phyerr = phyerr;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (rxsp->status11 & AR_KeyMiss)\n\t\trxs->rs_status |= ATH9K_RXERR_KEYMISS;\n\n\treturn 0;\n}\nEXPORT_SYMBOL(ath9k_hw_process_rxdesc_edma);\n\nvoid ath9k_hw_reset_txstatus_ring(struct ath_hw *ah)\n{\n\tah->ts_tail = 0;\n\n\tmemset((void *) ah->ts_ring, 0,\n\t\tah->ts_size * sizeof(struct ar9003_txs));\n\n\tath_dbg(ath9k_hw_common(ah), XMIT,\n\t\t\"TS Start 0x%x End 0x%x Virt %p, Size %d\\n\",\n\t\tah->ts_paddr_start, ah->ts_paddr_end,\n\t\tah->ts_ring, ah->ts_size);\n\n\tREG_WRITE(ah, AR_Q_STATUS_RING_START, ah->ts_paddr_start);\n\tREG_WRITE(ah, AR_Q_STATUS_RING_END, ah->ts_paddr_end);\n}\n\nvoid ath9k_hw_setup_statusring(struct ath_hw *ah, void *ts_start,\n\t\t\t       u32 ts_paddr_start,\n\t\t\t       u16 size)\n{\n\n\tah->ts_paddr_start = ts_paddr_start;\n\tah->ts_paddr_end = ts_paddr_start + (size * sizeof(struct ar9003_txs));\n\tah->ts_size = size;\n\tah->ts_ring = ts_start;\n\n\tath9k_hw_reset_txstatus_ring(ah);\n}\nEXPORT_SYMBOL(ath9k_hw_setup_statusring);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}