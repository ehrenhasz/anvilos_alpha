{
  "module_name": "qmi.c",
  "hash_id": "de50f07904d64058906632ebfedcc4d7321e7663eff49752ee71ada5a6b98add",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath11k/qmi.c",
  "human_readable_source": "\n \n\n#include <linux/elf.h>\n\n#include \"qmi.h\"\n#include \"core.h\"\n#include \"debug.h\"\n#include \"hif.h\"\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/ioport.h>\n#include <linux/firmware.h>\n#include <linux/of_irq.h>\n\n#define SLEEP_CLOCK_SELECT_INTERNAL_BIT\t0x02\n#define HOST_CSTATE_BIT\t\t\t0x04\n#define PLATFORM_CAP_PCIE_GLOBAL_RESET\t0x08\n#define PLATFORM_CAP_PCIE_PME_D3COLD\t0x10\n\n#define FW_BUILD_ID_MASK \"QC_IMAGE_VERSION_STRING=\"\n\nbool ath11k_cold_boot_cal = 1;\nEXPORT_SYMBOL(ath11k_cold_boot_cal);\nmodule_param_named(cold_boot_cal, ath11k_cold_boot_cal, bool, 0644);\nMODULE_PARM_DESC(cold_boot_cal,\n\t\t \"Decrease the channel switch time but increase the driver load time (Default: true)\");\n\nstatic const struct qmi_elem_info qmi_wlanfw_host_cap_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   num_clients_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   num_clients),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   wake_msi_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   wake_msi),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   gpios_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   gpios_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= QMI_WLFW_MAX_NUM_GPIO_V01,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   gpios),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   nm_modem_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   nm_modem),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   bdf_support_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   bdf_support),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   bdf_cache_support_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   bdf_cache_support),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x16,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   m3_support_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x16,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   m3_support),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x17,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   m3_cache_support_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x17,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   m3_cache_support),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x18,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   cal_filesys_support_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x18,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   cal_filesys_support),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x19,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   cal_cache_support_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x19,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   cal_cache_support),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1A,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   cal_done_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1A,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   cal_done),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1B,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   mem_bucket_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1B,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   mem_bucket),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1C,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   mem_cfg_mode_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1C,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_req_msg_v01,\n\t\t\t\t\t   mem_cfg_mode),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_host_cap_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_host_cap_resp_msg_v01, resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_ind_register_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   fw_ready_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   fw_ready_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   initiate_cal_download_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   initiate_cal_download_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   initiate_cal_update_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   initiate_cal_update_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   msa_ready_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   msa_ready_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   pin_connect_result_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   pin_connect_result_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   client_id_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   client_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x16,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   request_mem_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x16,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   request_mem_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x17,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   fw_mem_ready_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x17,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   fw_mem_ready_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x18,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   fw_init_done_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x18,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   fw_init_done_enable),\n\t},\n\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x19,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   rejuvenate_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x19,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   rejuvenate_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1A,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   xo_cal_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1A,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   xo_cal_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1B,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   cal_done_enable_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x1B,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_req_msg_v01,\n\t\t\t\t\t   cal_done_enable),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_ind_register_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_resp_msg_v01,\n\t\t\t\t\t   resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_resp_msg_v01,\n\t\t\t\t\t   fw_status_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_8_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u64),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ind_register_resp_msg_v01,\n\t\t\t\t\t   fw_status),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_mem_cfg_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_8_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u64),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_cfg_s_v01, offset),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_cfg_s_v01, size),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_cfg_s_v01, secure_flag),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_mem_seg_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_s_v01,\n\t\t\t\t  size),\n\t},\n\t{\n\t\t.data_type\t= QMI_SIGNED_4_BYTE_ENUM,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(enum qmi_wlanfw_mem_type_enum_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_s_v01, type),\n\t},\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_s_v01, mem_cfg_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= QMI_WLANFW_MAX_NUM_MEM_CFG_V01,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_mem_cfg_s_v01),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_s_v01, mem_cfg),\n\t\t.ei_array\t= qmi_wlanfw_mem_cfg_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_request_mem_ind_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x01,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_request_mem_ind_msg_v01,\n\t\t\t\t\t   mem_seg_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= ATH11K_QMI_WLANFW_MAX_NUM_MEM_SEG_V01,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_mem_seg_s_v01),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x01,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_request_mem_ind_msg_v01,\n\t\t\t\t\t   mem_seg),\n\t\t.ei_array\t= qmi_wlanfw_mem_seg_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_mem_seg_resp_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_8_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u64),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_resp_s_v01, addr),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_resp_s_v01, size),\n\t},\n\t{\n\t\t.data_type\t= QMI_SIGNED_4_BYTE_ENUM,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(enum qmi_wlanfw_mem_type_enum_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_resp_s_v01, type),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_mem_seg_resp_s_v01, restore),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_respond_mem_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x01,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_respond_mem_req_msg_v01,\n\t\t\t\t\t   mem_seg_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= ATH11K_QMI_WLANFW_MAX_NUM_MEM_SEG_V01,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_mem_seg_resp_s_v01),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x01,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_respond_mem_req_msg_v01,\n\t\t\t\t\t   mem_seg),\n\t\t.ei_array\t= qmi_wlanfw_mem_seg_resp_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_respond_mem_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_respond_mem_resp_msg_v01,\n\t\t\t\t\t   resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_cap_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_device_info_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type      = QMI_EOTI,\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlfw_device_info_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_device_info_resp_msg_v01,\n\t\t\t\t\t   resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_device_info_resp_msg_v01,\n\t\t\t\t\t   bar_addr_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_8_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u64),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_device_info_resp_msg_v01,\n\t\t\t\t\t   bar_addr),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_device_info_resp_msg_v01,\n\t\t\t\t\t   bar_size_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_device_info_resp_msg_v01,\n\t\t\t\t\t   bar_size),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_rf_chip_info_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_rf_chip_info_s_v01,\n\t\t\t\t\t   chip_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_rf_chip_info_s_v01,\n\t\t\t\t\t   chip_family),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_rf_board_info_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_rf_board_info_s_v01,\n\t\t\t\t\t   board_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_soc_info_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_soc_info_s_v01, soc_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_fw_version_info_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_fw_version_info_s_v01,\n\t\t\t\t\t   fw_version),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRING,\n\t\t.elem_len\t= ATH11K_QMI_WLANFW_MAX_TIMESTAMP_LEN_V01 + 1,\n\t\t.elem_size\t= sizeof(char),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_fw_version_info_s_v01,\n\t\t\t\t\t   fw_build_timestamp),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_cap_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01, resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   chip_info_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_rf_chip_info_s_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   chip_info),\n\t\t.ei_array\t= qmi_wlanfw_rf_chip_info_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   board_info_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_rf_board_info_s_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   board_info),\n\t\t.ei_array\t= qmi_wlanfw_rf_board_info_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   soc_info_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_soc_info_s_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   soc_info),\n\t\t.ei_array\t= qmi_wlanfw_soc_info_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   fw_version_info_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_fw_version_info_s_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   fw_version_info),\n\t\t.ei_array\t= qmi_wlanfw_fw_version_info_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   fw_build_id_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRING,\n\t\t.elem_len\t= ATH11K_QMI_WLANFW_MAX_BUILD_ID_LEN_V01 + 1,\n\t\t.elem_size\t= sizeof(char),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   fw_build_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   num_macs_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   num_macs),\n\t},\n\t{\n\t\t.data_type      = QMI_OPT_FLAG,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u8),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x16,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   voltage_mv_valid),\n\t},\n\t{\n\t\t.data_type      = QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u32),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x16,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   voltage_mv),\n\t},\n\t{\n\t\t.data_type      = QMI_OPT_FLAG,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u8),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x17,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   time_freq_hz_valid),\n\t},\n\t{\n\t\t.data_type      = QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u32),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x17,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   time_freq_hz),\n\t},\n\t{\n\t\t.data_type      = QMI_OPT_FLAG,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u8),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x18,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   otp_version_valid),\n\t},\n\t{\n\t\t.data_type      = QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u32),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x18,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   otp_version),\n\t},\n\t{\n\t\t.data_type      = QMI_OPT_FLAG,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u8),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x19,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   eeprom_read_timeout_valid),\n\t},\n\t{\n\t\t.data_type      = QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len       = 1,\n\t\t.elem_size      = sizeof(u32),\n\t\t.array_type     = NO_ARRAY,\n\t\t.tlv_type       = 0x19,\n\t\t.offset         = offsetof(struct qmi_wlanfw_cap_resp_msg_v01,\n\t\t\t\t\t   eeprom_read_timeout),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_bdf_download_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x01,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   file_id_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_SIGNED_4_BYTE_ENUM,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(enum qmi_wlanfw_cal_temp_id_enum_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   file_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   total_size_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   total_size),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   seg_id_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   seg_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   data_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u16),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   data_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= QMI_WLANFW_MAX_DATA_SIZE_V01,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   data),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   end_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   end),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   bdf_type_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x15,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_req_msg_v01,\n\t\t\t\t\t   bdf_type),\n\t},\n\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_bdf_download_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_bdf_download_resp_msg_v01,\n\t\t\t\t\t   resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_m3_info_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_8_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u64),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x01,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_m3_info_req_msg_v01, addr),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_m3_info_req_msg_v01, size),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_m3_info_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_m3_info_resp_msg_v01, resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_ce_tgt_pipe_cfg_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_tgt_pipe_cfg_s_v01,\n\t\t\t\t\t   pipe_num),\n\t},\n\t{\n\t\t.data_type\t= QMI_SIGNED_4_BYTE_ENUM,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(enum qmi_wlanfw_pipedir_enum_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_tgt_pipe_cfg_s_v01,\n\t\t\t\t\t   pipe_dir),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_tgt_pipe_cfg_s_v01,\n\t\t\t\t\t   nentries),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_tgt_pipe_cfg_s_v01,\n\t\t\t\t\t   nbytes_max),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_tgt_pipe_cfg_s_v01,\n\t\t\t\t\t   flags),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_ce_svc_pipe_cfg_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_svc_pipe_cfg_s_v01,\n\t\t\t\t\t   service_id),\n\t},\n\t{\n\t\t.data_type\t= QMI_SIGNED_4_BYTE_ENUM,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(enum qmi_wlanfw_pipedir_enum_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_svc_pipe_cfg_s_v01,\n\t\t\t\t\t   pipe_dir),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_ce_svc_pipe_cfg_s_v01,\n\t\t\t\t\t   pipe_num),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_shadow_reg_cfg_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_2_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u16),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_shadow_reg_cfg_s_v01, id),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_2_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u16),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_shadow_reg_cfg_s_v01,\n\t\t\t\t\t   offset),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_shadow_reg_v2_cfg_s_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_shadow_reg_v2_cfg_s_v01,\n\t\t\t\t\t   addr),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_wlan_mode_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_4_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u32),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x01,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_mode_req_msg_v01,\n\t\t\t\t\t   mode),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_mode_req_msg_v01,\n\t\t\t\t\t   hw_debug_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_mode_req_msg_v01,\n\t\t\t\t\t   hw_debug),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_wlan_mode_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_mode_resp_msg_v01,\n\t\t\t\t\t   resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_wlan_cfg_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   host_version_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRING,\n\t\t.elem_len\t= QMI_WLANFW_MAX_STR_LEN_V01 + 1,\n\t\t.elem_size\t= sizeof(char),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   host_version),\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   tgt_cfg_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   tgt_cfg_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= QMI_WLANFW_MAX_NUM_CE_V01,\n\t\t.elem_size\t= sizeof(\n\t\t\t\tstruct qmi_wlanfw_ce_tgt_pipe_cfg_s_v01),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x11,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   tgt_cfg),\n\t\t.ei_array\t= qmi_wlanfw_ce_tgt_pipe_cfg_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   svc_cfg_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   svc_cfg_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= QMI_WLANFW_MAX_NUM_SVC_V01,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_ce_svc_pipe_cfg_s_v01),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x12,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   svc_cfg),\n\t\t.ei_array\t= qmi_wlanfw_ce_svc_pipe_cfg_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   shadow_reg_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   shadow_reg_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= QMI_WLANFW_MAX_NUM_SHADOW_REG_V01,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_shadow_reg_cfg_s_v01),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x13,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   shadow_reg),\n\t\t.ei_array\t= qmi_wlanfw_shadow_reg_cfg_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   shadow_reg_v2_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_DATA_LEN,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   shadow_reg_v2_len),\n\t},\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= QMI_WLANFW_MAX_NUM_SHADOW_REG_V2_V01,\n\t\t.elem_size\t= sizeof(struct qmi_wlanfw_shadow_reg_v2_cfg_s_v01),\n\t\t.array_type\t= VAR_LEN_ARRAY,\n\t\t.tlv_type\t= 0x14,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_req_msg_v01,\n\t\t\t\t\t   shadow_reg_v2),\n\t\t.ei_array\t= qmi_wlanfw_shadow_reg_v2_cfg_s_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_wlan_cfg_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_cfg_resp_msg_v01, resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_mem_ready_ind_msg_v01_ei[] = {\n\t{\n\t\t.data_type = QMI_EOTI,\n\t\t.array_type = NO_ARRAY,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_fw_ready_ind_msg_v01_ei[] = {\n\t{\n\t\t.data_type = QMI_EOTI,\n\t\t.array_type = NO_ARRAY,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_cold_boot_cal_done_ind_msg_v01_ei[] = {\n\t{\n\t\t.data_type = QMI_EOTI,\n\t\t.array_type = NO_ARRAY,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_wlan_ini_req_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_OPT_FLAG,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_ini_req_msg_v01,\n\t\t\t\t\t   enablefwlog_valid),\n\t},\n\t{\n\t\t.data_type\t= QMI_UNSIGNED_1_BYTE,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(u8),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x10,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_ini_req_msg_v01,\n\t\t\t\t\t   enablefwlog),\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlanfw_wlan_ini_resp_msg_v01_ei[] = {\n\t{\n\t\t.data_type\t= QMI_STRUCT,\n\t\t.elem_len\t= 1,\n\t\t.elem_size\t= sizeof(struct qmi_response_type_v01),\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= 0x02,\n\t\t.offset\t\t= offsetof(struct qmi_wlanfw_wlan_ini_resp_msg_v01,\n\t\t\t\t\t   resp),\n\t\t.ei_array\t= qmi_response_type_v01_ei,\n\t},\n\t{\n\t\t.data_type\t= QMI_EOTI,\n\t\t.array_type\t= NO_ARRAY,\n\t\t.tlv_type\t= QMI_COMMON_TLV_TYPE,\n\t},\n};\n\nstatic const struct qmi_elem_info qmi_wlfw_fw_init_done_ind_msg_v01_ei[] = {\n\t{\n\t\t.data_type = QMI_EOTI,\n\t\t.array_type = NO_ARRAY,\n\t},\n};\n\nstatic int ath11k_qmi_host_cap_send(struct ath11k_base *ab)\n{\n\tstruct qmi_wlanfw_host_cap_req_msg_v01 req;\n\tstruct qmi_wlanfw_host_cap_resp_msg_v01 resp;\n\tstruct qmi_txn txn;\n\tint ret = 0;\n\n\tmemset(&req, 0, sizeof(req));\n\tmemset(&resp, 0, sizeof(resp));\n\n\treq.num_clients_valid = 1;\n\treq.num_clients = 1;\n\treq.mem_cfg_mode = ab->qmi.target_mem_mode;\n\treq.mem_cfg_mode_valid = 1;\n\treq.bdf_support_valid = 1;\n\treq.bdf_support = 1;\n\n\tif (ab->hw_params.m3_fw_support) {\n\t\treq.m3_support_valid = 1;\n\t\treq.m3_support = 1;\n\t\treq.m3_cache_support_valid = 1;\n\t\treq.m3_cache_support = 1;\n\t} else {\n\t\treq.m3_support_valid = 0;\n\t\treq.m3_support = 0;\n\t\treq.m3_cache_support_valid = 0;\n\t\treq.m3_cache_support = 0;\n\t}\n\n\treq.cal_done_valid = 1;\n\treq.cal_done = ab->qmi.cal_done;\n\n\tif (ab->hw_params.internal_sleep_clock) {\n\t\treq.nm_modem_valid = 1;\n\n\t\t \n\t\treq.nm_modem |= HOST_CSTATE_BIT;\n\n\t\t \n\t\treq.nm_modem |= SLEEP_CLOCK_SELECT_INTERNAL_BIT;\n\t}\n\n\tif (ab->hw_params.global_reset)\n\t\treq.nm_modem |= PLATFORM_CAP_PCIE_GLOBAL_RESET;\n\n\treq.nm_modem |= PLATFORM_CAP_PCIE_PME_D3COLD;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"host cap request\\n\");\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t   qmi_wlanfw_host_cap_resp_msg_v01_ei, &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_HOST_CAP_REQ_V01,\n\t\t\t       QMI_WLANFW_HOST_CAP_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_host_cap_req_msg_v01_ei, &req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to send host capability request: %d\\n\", ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0)\n\t\tgoto out;\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"host capability request failed: %d %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\nout:\n\treturn ret;\n}\n\nstatic int ath11k_qmi_fw_ind_register_send(struct ath11k_base *ab)\n{\n\tstruct qmi_wlanfw_ind_register_req_msg_v01 *req;\n\tstruct qmi_wlanfw_ind_register_resp_msg_v01 *resp;\n\tstruct qmi_handle *handle = &ab->qmi.handle;\n\tstruct qmi_txn txn;\n\tint ret;\n\n\treq = kzalloc(sizeof(*req), GFP_KERNEL);\n\tif (!req)\n\t\treturn -ENOMEM;\n\n\tresp = kzalloc(sizeof(*resp), GFP_KERNEL);\n\tif (!resp) {\n\t\tret = -ENOMEM;\n\t\tgoto resp_out;\n\t}\n\n\treq->client_id_valid = 1;\n\treq->client_id = QMI_WLANFW_CLIENT_ID;\n\treq->fw_ready_enable_valid = 1;\n\treq->fw_ready_enable = 1;\n\treq->cal_done_enable_valid = 1;\n\treq->cal_done_enable = 1;\n\treq->fw_init_done_enable_valid = 1;\n\treq->fw_init_done_enable = 1;\n\n\treq->pin_connect_result_enable_valid = 0;\n\treq->pin_connect_result_enable = 0;\n\n\t \n\tif (!ab->hw_params.fixed_fw_mem) {\n\t\treq->request_mem_enable_valid = 1;\n\t\treq->request_mem_enable = 1;\n\t\treq->fw_mem_ready_enable_valid = 1;\n\t\treq->fw_mem_ready_enable = 1;\n\t}\n\n\tret = qmi_txn_init(handle, &txn,\n\t\t\t   qmi_wlanfw_ind_register_resp_msg_v01_ei, resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"indication register request\\n\");\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_IND_REGISTER_REQ_V01,\n\t\t\t       QMI_WLANFW_IND_REGISTER_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_ind_register_req_msg_v01_ei, req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to send indication register request: %d\\n\",\n\t\t\t    ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to register fw indication: %d\\n\", ret);\n\t\tgoto out;\n\t}\n\n\tif (resp->resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"firmware indication register request failed: %d %d\\n\",\n\t\t\t    resp->resp.result, resp->resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\nout:\n\tkfree(resp);\nresp_out:\n\tkfree(req);\n\treturn ret;\n}\n\nstatic int ath11k_qmi_respond_fw_mem_request(struct ath11k_base *ab)\n{\n\tstruct qmi_wlanfw_respond_mem_req_msg_v01 *req;\n\tstruct qmi_wlanfw_respond_mem_resp_msg_v01 resp;\n\tstruct qmi_txn txn;\n\tint ret = 0, i;\n\tbool delayed;\n\n\treq = kzalloc(sizeof(*req), GFP_KERNEL);\n\tif (!req)\n\t\treturn -ENOMEM;\n\n\tmemset(&resp, 0, sizeof(resp));\n\n\t \n\tif (!(ab->hw_params.fixed_mem_region ||\n\t      test_bit(ATH11K_FLAG_FIXED_MEM_RGN, &ab->dev_flags)) &&\n\t      ab->qmi.target_mem_delayed) {\n\t\tdelayed = true;\n\t\tath11k_dbg(ab, ATH11K_DBG_QMI, \"delays mem_request %d\\n\",\n\t\t\t   ab->qmi.mem_seg_count);\n\t\tmemset(req, 0, sizeof(*req));\n\t} else {\n\t\tdelayed = false;\n\t\treq->mem_seg_len = ab->qmi.mem_seg_count;\n\n\t\tfor (i = 0; i < req->mem_seg_len ; i++) {\n\t\t\treq->mem_seg[i].addr = ab->qmi.target_mem[i].paddr;\n\t\t\treq->mem_seg[i].size = ab->qmi.target_mem[i].size;\n\t\t\treq->mem_seg[i].type = ab->qmi.target_mem[i].type;\n\t\t\tath11k_dbg(ab, ATH11K_DBG_QMI,\n\t\t\t\t   \"req mem_seg[%d] %pad %u %u\\n\", i,\n\t\t\t\t    &ab->qmi.target_mem[i].paddr,\n\t\t\t\t    ab->qmi.target_mem[i].size,\n\t\t\t\t    ab->qmi.target_mem[i].type);\n\t\t}\n\t}\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t   qmi_wlanfw_respond_mem_resp_msg_v01_ei, &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"respond memory request delayed %i\\n\",\n\t\t   delayed);\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_RESPOND_MEM_REQ_V01,\n\t\t\t       QMI_WLANFW_RESPOND_MEM_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_respond_mem_req_msg_v01_ei, req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to respond qmi memory request: %d\\n\",\n\t\t\t    ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to wait qmi memory request: %d\\n\", ret);\n\t\tgoto out;\n\t}\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\t \n\t\tif (delayed && resp.resp.error == 0)\n\t\t\tgoto out;\n\n\t\tath11k_warn(ab, \"qmi respond memory request failed: %d %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\nout:\n\tkfree(req);\n\treturn ret;\n}\n\nstatic void ath11k_qmi_free_target_mem_chunk(struct ath11k_base *ab)\n{\n\tint i;\n\n\tfor (i = 0; i < ab->qmi.mem_seg_count; i++) {\n\t\tif ((ab->hw_params.fixed_mem_region ||\n\t\t     test_bit(ATH11K_FLAG_FIXED_MEM_RGN, &ab->dev_flags)) &&\n\t\t     ab->qmi.target_mem[i].iaddr)\n\t\t\tiounmap(ab->qmi.target_mem[i].iaddr);\n\n\t\tif (!ab->qmi.target_mem[i].vaddr)\n\t\t\tcontinue;\n\n\t\tdma_free_coherent(ab->dev,\n\t\t\t\t  ab->qmi.target_mem[i].prev_size,\n\t\t\t\t  ab->qmi.target_mem[i].vaddr,\n\t\t\t\t  ab->qmi.target_mem[i].paddr);\n\t\tab->qmi.target_mem[i].vaddr = NULL;\n\t}\n}\n\nstatic int ath11k_qmi_alloc_target_mem_chunk(struct ath11k_base *ab)\n{\n\tint i;\n\tstruct target_mem_chunk *chunk;\n\n\tab->qmi.target_mem_delayed = false;\n\n\tfor (i = 0; i < ab->qmi.mem_seg_count; i++) {\n\t\tchunk = &ab->qmi.target_mem[i];\n\n\t\t \n\t\tif (chunk->vaddr) {\n\t\t\tif (chunk->prev_type == chunk->type &&\n\t\t\t    chunk->prev_size == chunk->size)\n\t\t\t\tcontinue;\n\n\t\t\t \n\t\t\tdma_free_coherent(ab->dev, chunk->prev_size,\n\t\t\t\t\t  chunk->vaddr, chunk->paddr);\n\t\t\tchunk->vaddr = NULL;\n\t\t}\n\n\t\tchunk->vaddr = dma_alloc_coherent(ab->dev,\n\t\t\t\t\t\t  chunk->size,\n\t\t\t\t\t\t  &chunk->paddr,\n\t\t\t\t\t\t  GFP_KERNEL | __GFP_NOWARN);\n\t\tif (!chunk->vaddr) {\n\t\t\tif (ab->qmi.mem_seg_count <= ATH11K_QMI_FW_MEM_REQ_SEGMENT_CNT) {\n\t\t\t\tath11k_dbg(ab, ATH11K_DBG_QMI,\n\t\t\t\t\t   \"dma allocation failed (%d B type %u), will try later with small size\\n\",\n\t\t\t\t\t    chunk->size,\n\t\t\t\t\t    chunk->type);\n\t\t\t\tath11k_qmi_free_target_mem_chunk(ab);\n\t\t\t\tab->qmi.target_mem_delayed = true;\n\t\t\t\treturn 0;\n\t\t\t}\n\n\t\t\tath11k_err(ab, \"failed to allocate dma memory for qmi (%d B type %u)\\n\",\n\t\t\t\t   chunk->size,\n\t\t\t\t   chunk->type);\n\t\t\treturn -EINVAL;\n\t\t}\n\t\tchunk->prev_type = chunk->type;\n\t\tchunk->prev_size = chunk->size;\n\t}\n\n\treturn 0;\n}\n\nstatic int ath11k_qmi_assign_target_mem_chunk(struct ath11k_base *ab)\n{\n\tstruct device *dev = ab->dev;\n\tstruct device_node *hremote_node = NULL;\n\tstruct resource res;\n\tu32 host_ddr_sz;\n\tint i, idx, ret;\n\n\tfor (i = 0, idx = 0; i < ab->qmi.mem_seg_count; i++) {\n\t\tswitch (ab->qmi.target_mem[i].type) {\n\t\tcase HOST_DDR_REGION_TYPE:\n\t\t\thremote_node = of_parse_phandle(dev->of_node, \"memory-region\", 0);\n\t\t\tif (!hremote_node) {\n\t\t\t\tath11k_dbg(ab, ATH11K_DBG_QMI,\n\t\t\t\t\t   \"fail to get hremote_node\\n\");\n\t\t\t\treturn -ENODEV;\n\t\t\t}\n\n\t\t\tret = of_address_to_resource(hremote_node, 0, &res);\n\t\t\tof_node_put(hremote_node);\n\t\t\tif (ret) {\n\t\t\t\tath11k_dbg(ab, ATH11K_DBG_QMI,\n\t\t\t\t\t   \"fail to get reg from hremote\\n\");\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tif (res.end - res.start + 1 < ab->qmi.target_mem[i].size) {\n\t\t\t\tath11k_dbg(ab, ATH11K_DBG_QMI,\n\t\t\t\t\t   \"fail to assign memory of sz\\n\");\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tab->qmi.target_mem[idx].paddr = res.start;\n\t\t\tab->qmi.target_mem[idx].iaddr =\n\t\t\t\tioremap(ab->qmi.target_mem[idx].paddr,\n\t\t\t\t\tab->qmi.target_mem[i].size);\n\t\t\tif (!ab->qmi.target_mem[idx].iaddr)\n\t\t\t\treturn -EIO;\n\n\t\t\tab->qmi.target_mem[idx].size = ab->qmi.target_mem[i].size;\n\t\t\thost_ddr_sz = ab->qmi.target_mem[i].size;\n\t\t\tab->qmi.target_mem[idx].type = ab->qmi.target_mem[i].type;\n\t\t\tidx++;\n\t\t\tbreak;\n\t\tcase BDF_MEM_REGION_TYPE:\n\t\t\tab->qmi.target_mem[idx].paddr = ab->hw_params.bdf_addr;\n\t\t\tab->qmi.target_mem[idx].vaddr = NULL;\n\t\t\tab->qmi.target_mem[idx].size = ab->qmi.target_mem[i].size;\n\t\t\tab->qmi.target_mem[idx].type = ab->qmi.target_mem[i].type;\n\t\t\tidx++;\n\t\t\tbreak;\n\t\tcase CALDB_MEM_REGION_TYPE:\n\t\t\tif (ab->qmi.target_mem[i].size > ATH11K_QMI_CALDB_SIZE) {\n\t\t\t\tath11k_warn(ab, \"qmi mem size is low to load caldata\\n\");\n\t\t\t\treturn -EINVAL;\n\t\t\t}\n\n\t\t\tif (ath11k_core_coldboot_cal_support(ab)) {\n\t\t\t\tif (hremote_node) {\n\t\t\t\t\tab->qmi.target_mem[idx].paddr =\n\t\t\t\t\t\t\tres.start + host_ddr_sz;\n\t\t\t\t\tab->qmi.target_mem[idx].iaddr =\n\t\t\t\t\t\tioremap(ab->qmi.target_mem[idx].paddr,\n\t\t\t\t\t\t\tab->qmi.target_mem[i].size);\n\t\t\t\t\tif (!ab->qmi.target_mem[idx].iaddr)\n\t\t\t\t\t\treturn -EIO;\n\t\t\t\t} else {\n\t\t\t\t\tab->qmi.target_mem[idx].paddr =\n\t\t\t\t\t\tATH11K_QMI_CALDB_ADDRESS;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tab->qmi.target_mem[idx].paddr = 0;\n\t\t\t\tab->qmi.target_mem[idx].vaddr = NULL;\n\t\t\t}\n\t\t\tab->qmi.target_mem[idx].size = ab->qmi.target_mem[i].size;\n\t\t\tab->qmi.target_mem[idx].type = ab->qmi.target_mem[i].type;\n\t\t\tidx++;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tath11k_warn(ab, \"qmi ignore invalid mem req type %d\\n\",\n\t\t\t\t    ab->qmi.target_mem[i].type);\n\t\t\tbreak;\n\t\t}\n\t}\n\tab->qmi.mem_seg_count = idx;\n\n\treturn 0;\n}\n\nstatic int ath11k_qmi_request_device_info(struct ath11k_base *ab)\n{\n\tstruct qmi_wlanfw_device_info_req_msg_v01 req = {};\n\tstruct qmi_wlanfw_device_info_resp_msg_v01 resp = {};\n\tstruct qmi_txn txn;\n\tvoid __iomem *bar_addr_va;\n\tint ret;\n\n\t \n\tif (!ab->hw_params.hybrid_bus_type)\n\t\treturn 0;\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t   qmi_wlfw_device_info_resp_msg_v01_ei, &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_DEVICE_INFO_REQ_V01,\n\t\t\t       QMI_WLANFW_DEVICE_INFO_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_device_info_req_msg_v01_ei, &req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to send qmi target device info request: %d\\n\",\n\t\t\t    ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to wait qmi target device info request: %d\\n\",\n\t\t\t    ret);\n\t\tgoto out;\n\t}\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"qmi device info request failed: %d %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tif (!resp.bar_addr_valid || !resp.bar_size_valid) {\n\t\tath11k_warn(ab, \"qmi device info response invalid: %d %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tif (!resp.bar_addr ||\n\t    resp.bar_size != ATH11K_QMI_DEVICE_BAR_SIZE) {\n\t\tath11k_warn(ab, \"qmi device info invalid address and size: %llu %u\\n\",\n\t\t\t    resp.bar_addr, resp.bar_size);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tbar_addr_va = devm_ioremap(ab->dev, resp.bar_addr, resp.bar_size);\n\n\tif (!bar_addr_va) {\n\t\tath11k_warn(ab, \"qmi device info ioremap failed\\n\");\n\t\tab->mem_len = 0;\n\t\tret = -EIO;\n\t\tgoto out;\n\t}\n\n\tab->mem = bar_addr_va;\n\tab->mem_len = resp.bar_size;\n\n\treturn 0;\nout:\n\treturn ret;\n}\n\nstatic int ath11k_qmi_request_target_cap(struct ath11k_base *ab)\n{\n\tstruct qmi_wlanfw_cap_req_msg_v01 req;\n\tstruct qmi_wlanfw_cap_resp_msg_v01 resp;\n\tstruct qmi_txn txn;\n\tint ret = 0;\n\tint r;\n\tchar *fw_build_id;\n\tint fw_build_id_mask_len;\n\n\tmemset(&req, 0, sizeof(req));\n\tmemset(&resp, 0, sizeof(resp));\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn, qmi_wlanfw_cap_resp_msg_v01_ei,\n\t\t\t   &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"target cap request\\n\");\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_CAP_REQ_V01,\n\t\t\t       QMI_WLANFW_CAP_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_cap_req_msg_v01_ei, &req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to send qmi cap request: %d\\n\",\n\t\t\t    ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to wait qmi cap request: %d\\n\", ret);\n\t\tgoto out;\n\t}\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"qmi cap request failed: %d %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\tif (resp.chip_info_valid) {\n\t\tab->qmi.target.chip_id = resp.chip_info.chip_id;\n\t\tab->qmi.target.chip_family = resp.chip_info.chip_family;\n\t}\n\n\tif (resp.board_info_valid)\n\t\tab->qmi.target.board_id = resp.board_info.board_id;\n\telse\n\t\tab->qmi.target.board_id = 0xFF;\n\n\tif (resp.soc_info_valid)\n\t\tab->qmi.target.soc_id = resp.soc_info.soc_id;\n\n\tif (resp.fw_version_info_valid) {\n\t\tab->qmi.target.fw_version = resp.fw_version_info.fw_version;\n\t\tstrscpy(ab->qmi.target.fw_build_timestamp,\n\t\t\tresp.fw_version_info.fw_build_timestamp,\n\t\t\tsizeof(ab->qmi.target.fw_build_timestamp));\n\t}\n\n\tif (resp.fw_build_id_valid)\n\t\tstrscpy(ab->qmi.target.fw_build_id, resp.fw_build_id,\n\t\t\tsizeof(ab->qmi.target.fw_build_id));\n\n\tif (resp.eeprom_read_timeout_valid) {\n\t\tab->qmi.target.eeprom_caldata =\n\t\t\t\t\tresp.eeprom_read_timeout;\n\t\tath11k_dbg(ab, ATH11K_DBG_QMI, \"cal data supported from eeprom\\n\");\n\t}\n\n\tfw_build_id = ab->qmi.target.fw_build_id;\n\tfw_build_id_mask_len = strlen(FW_BUILD_ID_MASK);\n\tif (!strncmp(fw_build_id, FW_BUILD_ID_MASK, fw_build_id_mask_len))\n\t\tfw_build_id = fw_build_id + fw_build_id_mask_len;\n\n\tath11k_info(ab, \"chip_id 0x%x chip_family 0x%x board_id 0x%x soc_id 0x%x\\n\",\n\t\t    ab->qmi.target.chip_id, ab->qmi.target.chip_family,\n\t\t    ab->qmi.target.board_id, ab->qmi.target.soc_id);\n\n\tath11k_info(ab, \"fw_version 0x%x fw_build_timestamp %s fw_build_id %s\",\n\t\t    ab->qmi.target.fw_version,\n\t\t    ab->qmi.target.fw_build_timestamp,\n\t\t    fw_build_id);\n\n\tr = ath11k_core_check_smbios(ab);\n\tif (r)\n\t\tath11k_dbg(ab, ATH11K_DBG_QMI, \"SMBIOS bdf variant name not set.\\n\");\n\n\tr = ath11k_core_check_dt(ab);\n\tif (r)\n\t\tath11k_dbg(ab, ATH11K_DBG_QMI, \"DT bdf variant name not set.\\n\");\n\nout:\n\treturn ret;\n}\n\nstatic int ath11k_qmi_load_file_target_mem(struct ath11k_base *ab,\n\t\t\t\t\t   const u8 *data, u32 len, u8 type)\n{\n\tstruct qmi_wlanfw_bdf_download_req_msg_v01 *req;\n\tstruct qmi_wlanfw_bdf_download_resp_msg_v01 resp;\n\tstruct qmi_txn txn;\n\tconst u8 *temp = data;\n\tvoid __iomem *bdf_addr = NULL;\n\tint ret;\n\tu32 remaining = len;\n\n\treq = kzalloc(sizeof(*req), GFP_KERNEL);\n\tif (!req)\n\t\treturn -ENOMEM;\n\n\tmemset(&resp, 0, sizeof(resp));\n\n\tif (ab->hw_params.fixed_bdf_addr) {\n\t\tbdf_addr = ioremap(ab->hw_params.bdf_addr, ab->hw_params.fw.board_size);\n\t\tif (!bdf_addr) {\n\t\t\tath11k_warn(ab, \"qmi ioremap error for bdf_addr\\n\");\n\t\t\tret = -EIO;\n\t\t\tgoto err_free_req;\n\t\t}\n\t}\n\n\twhile (remaining) {\n\t\treq->valid = 1;\n\t\treq->file_id_valid = 1;\n\t\treq->file_id = ab->qmi.target.board_id;\n\t\treq->total_size_valid = 1;\n\t\treq->total_size = remaining;\n\t\treq->seg_id_valid = 1;\n\t\treq->data_valid = 1;\n\t\treq->bdf_type = type;\n\t\treq->bdf_type_valid = 1;\n\t\treq->end_valid = 1;\n\t\treq->end = 0;\n\n\t\tif (remaining > QMI_WLANFW_MAX_DATA_SIZE_V01) {\n\t\t\treq->data_len = QMI_WLANFW_MAX_DATA_SIZE_V01;\n\t\t} else {\n\t\t\treq->data_len = remaining;\n\t\t\treq->end = 1;\n\t\t}\n\n\t\tif (ab->hw_params.fixed_bdf_addr ||\n\t\t    type == ATH11K_QMI_FILE_TYPE_EEPROM) {\n\t\t\treq->data_valid = 0;\n\t\t\treq->end = 1;\n\t\t\treq->data_len = ATH11K_QMI_MAX_BDF_FILE_NAME_SIZE;\n\t\t} else {\n\t\t\tmemcpy(req->data, temp, req->data_len);\n\t\t}\n\n\t\tif (ab->hw_params.fixed_bdf_addr) {\n\t\t\tif (type == ATH11K_QMI_FILE_TYPE_CALDATA)\n\t\t\t\tbdf_addr += ab->hw_params.fw.cal_offset;\n\n\t\t\tmemcpy_toio(bdf_addr, temp, len);\n\t\t}\n\n\t\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t\t   qmi_wlanfw_bdf_download_resp_msg_v01_ei,\n\t\t\t\t   &resp);\n\t\tif (ret < 0)\n\t\t\tgoto err_iounmap;\n\n\t\tath11k_dbg(ab, ATH11K_DBG_QMI, \"bdf download req fixed addr type %d\\n\",\n\t\t\t   type);\n\n\t\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t\t       QMI_WLANFW_BDF_DOWNLOAD_REQ_V01,\n\t\t\t\t       QMI_WLANFW_BDF_DOWNLOAD_REQ_MSG_V01_MAX_LEN,\n\t\t\t\t       qmi_wlanfw_bdf_download_req_msg_v01_ei, req);\n\t\tif (ret < 0) {\n\t\t\tqmi_txn_cancel(&txn);\n\t\t\tgoto err_iounmap;\n\t\t}\n\n\t\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\t\tif (ret < 0) {\n\t\t\tath11k_warn(ab, \"failed to wait board file download request: %d\\n\",\n\t\t\t\t    ret);\n\t\t\tgoto err_iounmap;\n\t\t}\n\n\t\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\t\tath11k_warn(ab, \"board file download request failed: %d %d\\n\",\n\t\t\t\t    resp.resp.result, resp.resp.error);\n\t\t\tret = -EINVAL;\n\t\t\tgoto err_iounmap;\n\t\t}\n\n\t\tif (ab->hw_params.fixed_bdf_addr ||\n\t\t    type == ATH11K_QMI_FILE_TYPE_EEPROM) {\n\t\t\tremaining = 0;\n\t\t} else {\n\t\t\tremaining -= req->data_len;\n\t\t\ttemp += req->data_len;\n\t\t\treq->seg_id++;\n\t\t\tath11k_dbg(ab, ATH11K_DBG_QMI, \"bdf download request remaining %i\\n\",\n\t\t\t\t   remaining);\n\t\t}\n\t}\n\nerr_iounmap:\n\tif (ab->hw_params.fixed_bdf_addr)\n\t\tiounmap(bdf_addr);\n\nerr_free_req:\n\tkfree(req);\n\n\treturn ret;\n}\n\nstatic int ath11k_qmi_load_bdf_qmi(struct ath11k_base *ab,\n\t\t\t\t   bool regdb)\n{\n\tstruct device *dev = ab->dev;\n\tchar filename[ATH11K_QMI_MAX_BDF_FILE_NAME_SIZE];\n\tconst struct firmware *fw_entry;\n\tstruct ath11k_board_data bd;\n\tu32 fw_size, file_type;\n\tint ret = 0, bdf_type;\n\tconst u8 *tmp;\n\n\tmemset(&bd, 0, sizeof(bd));\n\n\tif (regdb) {\n\t\tret = ath11k_core_fetch_regdb(ab, &bd);\n\t} else {\n\t\tret = ath11k_core_fetch_bdf(ab, &bd);\n\t\tif (ret)\n\t\t\tath11k_warn(ab, \"qmi failed to fetch board file: %d\\n\", ret);\n\t}\n\n\tif (ret)\n\t\tgoto out;\n\n\tif (regdb)\n\t\tbdf_type = ATH11K_QMI_BDF_TYPE_REGDB;\n\telse if (bd.len >= SELFMAG && memcmp(bd.data, ELFMAG, SELFMAG) == 0)\n\t\tbdf_type = ATH11K_QMI_BDF_TYPE_ELF;\n\telse\n\t\tbdf_type = ATH11K_QMI_BDF_TYPE_BIN;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"bdf_type %d\\n\", bdf_type);\n\n\tfw_size = min_t(u32, ab->hw_params.fw.board_size, bd.len);\n\n\tret = ath11k_qmi_load_file_target_mem(ab, bd.data, fw_size, bdf_type);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to load bdf file\\n\");\n\t\tgoto out;\n\t}\n\n\t \n\tif (bdf_type == ATH11K_QMI_BDF_TYPE_ELF || bdf_type == ATH11K_QMI_BDF_TYPE_REGDB)\n\t\tgoto out;\n\n\tif (ab->qmi.target.eeprom_caldata) {\n\t\tfile_type = ATH11K_QMI_FILE_TYPE_EEPROM;\n\t\ttmp = filename;\n\t\tfw_size = ATH11K_QMI_MAX_BDF_FILE_NAME_SIZE;\n\t} else {\n\t\tfile_type = ATH11K_QMI_FILE_TYPE_CALDATA;\n\n\t\t \n\t\tsnprintf(filename, sizeof(filename), \"cal-%s-%s.bin\",\n\t\t\t ath11k_bus_str(ab->hif.bus), dev_name(dev));\n\t\tfw_entry = ath11k_core_firmware_request(ab, filename);\n\t\tif (!IS_ERR(fw_entry))\n\t\t\tgoto success;\n\n\t\tfw_entry = ath11k_core_firmware_request(ab, ATH11K_DEFAULT_CAL_FILE);\n\t\tif (IS_ERR(fw_entry)) {\n\t\t\t \n\t\t\tif (ath11k_ftm_mode) {\n\t\t\t\tath11k_info(ab,\n\t\t\t\t\t    \"Booting without cal data file in factory test mode\\n\");\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tret = PTR_ERR(fw_entry);\n\t\t\tath11k_warn(ab,\n\t\t\t\t    \"qmi failed to load CAL data file:%s\\n\",\n\t\t\t\t    filename);\n\t\t\tgoto out;\n\t\t}\nsuccess:\n\t\tfw_size = min_t(u32, ab->hw_params.fw.board_size, fw_entry->size);\n\t\ttmp = fw_entry->data;\n\t}\n\n\tret = ath11k_qmi_load_file_target_mem(ab, tmp, fw_size, file_type);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to load caldata\\n\");\n\t\tgoto out_qmi_cal;\n\t}\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"caldata type: %u\\n\", file_type);\n\nout_qmi_cal:\n\tif (!ab->qmi.target.eeprom_caldata)\n\t\trelease_firmware(fw_entry);\nout:\n\tath11k_core_free_bdf(ab, &bd);\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"BDF download sequence completed\\n\");\n\n\treturn ret;\n}\n\nstatic int ath11k_qmi_m3_load(struct ath11k_base *ab)\n{\n\tstruct m3_mem_region *m3_mem = &ab->qmi.m3_mem;\n\tconst struct firmware *fw;\n\tchar path[100];\n\tint ret;\n\n\tfw = ath11k_core_firmware_request(ab, ATH11K_M3_FILE);\n\tif (IS_ERR(fw)) {\n\t\tret = PTR_ERR(fw);\n\t\tath11k_core_create_firmware_path(ab, ATH11K_M3_FILE,\n\t\t\t\t\t\t path, sizeof(path));\n\t\tath11k_err(ab, \"failed to load %s: %d\\n\", path, ret);\n\t\treturn ret;\n\t}\n\n\tif (m3_mem->vaddr || m3_mem->size)\n\t\tgoto skip_m3_alloc;\n\n\tm3_mem->vaddr = dma_alloc_coherent(ab->dev,\n\t\t\t\t\t   fw->size, &m3_mem->paddr,\n\t\t\t\t\t   GFP_KERNEL);\n\tif (!m3_mem->vaddr) {\n\t\tath11k_err(ab, \"failed to allocate memory for M3 with size %zu\\n\",\n\t\t\t   fw->size);\n\t\trelease_firmware(fw);\n\t\treturn -ENOMEM;\n\t}\n\nskip_m3_alloc:\n\tmemcpy(m3_mem->vaddr, fw->data, fw->size);\n\tm3_mem->size = fw->size;\n\trelease_firmware(fw);\n\n\treturn 0;\n}\n\nstatic void ath11k_qmi_m3_free(struct ath11k_base *ab)\n{\n\tstruct m3_mem_region *m3_mem = &ab->qmi.m3_mem;\n\n\tif (!ab->hw_params.m3_fw_support || !m3_mem->vaddr)\n\t\treturn;\n\n\tdma_free_coherent(ab->dev, m3_mem->size,\n\t\t\t  m3_mem->vaddr, m3_mem->paddr);\n\tm3_mem->vaddr = NULL;\n\tm3_mem->size = 0;\n}\n\nstatic int ath11k_qmi_wlanfw_m3_info_send(struct ath11k_base *ab)\n{\n\tstruct m3_mem_region *m3_mem = &ab->qmi.m3_mem;\n\tstruct qmi_wlanfw_m3_info_req_msg_v01 req;\n\tstruct qmi_wlanfw_m3_info_resp_msg_v01 resp;\n\tstruct qmi_txn txn;\n\tint ret = 0;\n\n\tmemset(&req, 0, sizeof(req));\n\tmemset(&resp, 0, sizeof(resp));\n\n\tif (ab->hw_params.m3_fw_support) {\n\t\tret = ath11k_qmi_m3_load(ab);\n\t\tif (ret) {\n\t\t\tath11k_err(ab, \"failed to load m3 firmware: %d\", ret);\n\t\t\treturn ret;\n\t\t}\n\n\t\treq.addr = m3_mem->paddr;\n\t\treq.size = m3_mem->size;\n\t} else {\n\t\treq.addr = 0;\n\t\treq.size = 0;\n\t}\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t   qmi_wlanfw_m3_info_resp_msg_v01_ei, &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"m3 info req\\n\");\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_M3_INFO_REQ_V01,\n\t\t\t       QMI_WLANFW_M3_INFO_REQ_MSG_V01_MAX_MSG_LEN,\n\t\t\t       qmi_wlanfw_m3_info_req_msg_v01_ei, &req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to send m3 information request: %d\\n\",\n\t\t\t    ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to wait m3 information request: %d\\n\", ret);\n\t\tgoto out;\n\t}\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"m3 info request failed: %d %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\nout:\n\treturn ret;\n}\n\nstatic int ath11k_qmi_wlanfw_mode_send(struct ath11k_base *ab,\n\t\t\t\t       u32 mode)\n{\n\tstruct qmi_wlanfw_wlan_mode_req_msg_v01 req;\n\tstruct qmi_wlanfw_wlan_mode_resp_msg_v01 resp;\n\tstruct qmi_txn txn;\n\tint ret = 0;\n\n\tmemset(&req, 0, sizeof(req));\n\tmemset(&resp, 0, sizeof(resp));\n\n\treq.mode = mode;\n\treq.hw_debug_valid = 1;\n\treq.hw_debug = 0;\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t   qmi_wlanfw_wlan_mode_resp_msg_v01_ei, &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"wlan mode req mode %d\\n\", mode);\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_WLAN_MODE_REQ_V01,\n\t\t\t       QMI_WLANFW_WLAN_MODE_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_wlan_mode_req_msg_v01_ei, &req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to send wlan mode request (mode %d): %d\\n\",\n\t\t\t    mode, ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tif (mode == ATH11K_FIRMWARE_MODE_OFF && ret == -ENETRESET) {\n\t\t\tath11k_warn(ab, \"WLFW service is dis-connected\\n\");\n\t\t\treturn 0;\n\t\t}\n\t\tath11k_warn(ab, \"failed to wait wlan mode request (mode %d): %d\\n\",\n\t\t\t    mode, ret);\n\t\tgoto out;\n\t}\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"wlan mode request failed (mode: %d): %d %d\\n\",\n\t\t\t    mode, resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\nout:\n\treturn ret;\n}\n\nstatic int ath11k_qmi_wlanfw_wlan_cfg_send(struct ath11k_base *ab)\n{\n\tstruct qmi_wlanfw_wlan_cfg_req_msg_v01 *req;\n\tstruct qmi_wlanfw_wlan_cfg_resp_msg_v01 resp;\n\tstruct ce_pipe_config *ce_cfg;\n\tstruct service_to_pipe *svc_cfg;\n\tstruct qmi_txn txn;\n\tint ret = 0, pipe_num;\n\n\tce_cfg\t= (struct ce_pipe_config *)ab->qmi.ce_cfg.tgt_ce;\n\tsvc_cfg\t= (struct service_to_pipe *)ab->qmi.ce_cfg.svc_to_ce_map;\n\n\treq = kzalloc(sizeof(*req), GFP_KERNEL);\n\tif (!req)\n\t\treturn -ENOMEM;\n\n\tmemset(&resp, 0, sizeof(resp));\n\n\treq->host_version_valid = 1;\n\tstrscpy(req->host_version, ATH11K_HOST_VERSION_STRING,\n\t\tsizeof(req->host_version));\n\n\treq->tgt_cfg_valid = 1;\n\t \n\treq->tgt_cfg_len = ab->qmi.ce_cfg.tgt_ce_len;\n\tfor (pipe_num = 0; pipe_num < req->tgt_cfg_len ; pipe_num++) {\n\t\treq->tgt_cfg[pipe_num].pipe_num = ce_cfg[pipe_num].pipenum;\n\t\treq->tgt_cfg[pipe_num].pipe_dir = ce_cfg[pipe_num].pipedir;\n\t\treq->tgt_cfg[pipe_num].nentries = ce_cfg[pipe_num].nentries;\n\t\treq->tgt_cfg[pipe_num].nbytes_max = ce_cfg[pipe_num].nbytes_max;\n\t\treq->tgt_cfg[pipe_num].flags = ce_cfg[pipe_num].flags;\n\t}\n\n\treq->svc_cfg_valid = 1;\n\t \n\treq->svc_cfg_len = ab->qmi.ce_cfg.svc_to_ce_map_len;\n\tfor (pipe_num = 0; pipe_num < req->svc_cfg_len; pipe_num++) {\n\t\treq->svc_cfg[pipe_num].service_id = svc_cfg[pipe_num].service_id;\n\t\treq->svc_cfg[pipe_num].pipe_dir = svc_cfg[pipe_num].pipedir;\n\t\treq->svc_cfg[pipe_num].pipe_num = svc_cfg[pipe_num].pipenum;\n\t}\n\treq->shadow_reg_valid = 0;\n\n\t \n\tif (ab->hw_params.supports_shadow_regs) {\n\t\treq->shadow_reg_v2_valid = 1;\n\t\treq->shadow_reg_v2_len = min_t(u32,\n\t\t\t\t\t       ab->qmi.ce_cfg.shadow_reg_v2_len,\n\t\t\t\t\t       QMI_WLANFW_MAX_NUM_SHADOW_REG_V2_V01);\n\t\tmemcpy(&req->shadow_reg_v2, ab->qmi.ce_cfg.shadow_reg_v2,\n\t\t       sizeof(u32) * req->shadow_reg_v2_len);\n\t} else {\n\t\treq->shadow_reg_v2_valid = 0;\n\t}\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t   qmi_wlanfw_wlan_cfg_resp_msg_v01_ei, &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"wlan cfg req\\n\");\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_WLAN_CFG_REQ_V01,\n\t\t\t       QMI_WLANFW_WLAN_CFG_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_wlan_cfg_req_msg_v01_ei, req);\n\tif (ret < 0) {\n\t\tqmi_txn_cancel(&txn);\n\t\tath11k_warn(ab, \"failed to send wlan config request: %d\\n\",\n\t\t\t    ret);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to wait wlan config request: %d\\n\", ret);\n\t\tgoto out;\n\t}\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"wlan config request failed: %d %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\nout:\n\tkfree(req);\n\treturn ret;\n}\n\nstatic int ath11k_qmi_wlanfw_wlan_ini_send(struct ath11k_base *ab, bool enable)\n{\n\tint ret;\n\tstruct qmi_txn txn;\n\tstruct qmi_wlanfw_wlan_ini_req_msg_v01 req = {};\n\tstruct qmi_wlanfw_wlan_ini_resp_msg_v01 resp = {};\n\n\treq.enablefwlog_valid = true;\n\treq.enablefwlog = enable ? 1 : 0;\n\n\tret = qmi_txn_init(&ab->qmi.handle, &txn,\n\t\t\t   qmi_wlanfw_wlan_ini_resp_msg_v01_ei, &resp);\n\tif (ret < 0)\n\t\tgoto out;\n\n\tret = qmi_send_request(&ab->qmi.handle, NULL, &txn,\n\t\t\t       QMI_WLANFW_WLAN_INI_REQ_V01,\n\t\t\t       QMI_WLANFW_WLAN_INI_REQ_MSG_V01_MAX_LEN,\n\t\t\t       qmi_wlanfw_wlan_ini_req_msg_v01_ei, &req);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to send wlan ini request, err = %d\\n\",\n\t\t\t    ret);\n\t\tqmi_txn_cancel(&txn);\n\t\tgoto out;\n\t}\n\n\tret = qmi_txn_wait(&txn, msecs_to_jiffies(ATH11K_QMI_WLANFW_TIMEOUT_MS));\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed wlan ini request, err = %d\\n\", ret);\n\t\tgoto out;\n\t}\n\n\tif (resp.resp.result != QMI_RESULT_SUCCESS_V01) {\n\t\tath11k_warn(ab, \"qmi wlan ini request failed, result: %d, err: %d\\n\",\n\t\t\t    resp.resp.result, resp.resp.error);\n\t\tret = -EINVAL;\n\t}\n\nout:\n\treturn ret;\n}\n\nvoid ath11k_qmi_firmware_stop(struct ath11k_base *ab)\n{\n\tint ret;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"firmware stop\\n\");\n\n\tret = ath11k_qmi_wlanfw_mode_send(ab, ATH11K_FIRMWARE_MODE_OFF);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to send wlan mode off: %d\\n\", ret);\n\t\treturn;\n\t}\n}\n\nint ath11k_qmi_firmware_start(struct ath11k_base *ab,\n\t\t\t      u32 mode)\n{\n\tint ret;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"firmware start\\n\");\n\n\tif (ab->hw_params.fw_wmi_diag_event) {\n\t\tret = ath11k_qmi_wlanfw_wlan_ini_send(ab, true);\n\t\tif (ret < 0) {\n\t\t\tath11k_warn(ab, \"qmi failed to send wlan fw ini:%d\\n\", ret);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\tret = ath11k_qmi_wlanfw_wlan_cfg_send(ab);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to send wlan cfg: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = ath11k_qmi_wlanfw_mode_send(ab, mode);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to send wlan fw mode: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nint ath11k_qmi_fwreset_from_cold_boot(struct ath11k_base *ab)\n{\n\tint timeout;\n\n\tif (!ath11k_core_coldboot_cal_support(ab) ||\n\t    ab->hw_params.cbcal_restart_fw == 0)\n\t\treturn 0;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"wait for cold boot done\\n\");\n\n\ttimeout = wait_event_timeout(ab->qmi.cold_boot_waitq,\n\t\t\t\t     (ab->qmi.cal_done == 1),\n\t\t\t\t     ATH11K_COLD_BOOT_FW_RESET_DELAY);\n\n\tif (timeout <= 0) {\n\t\tath11k_warn(ab, \"Coldboot Calibration timed out\\n\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\t \n\tath11k_hif_power_down(ab);\n\tath11k_hif_power_up(ab);\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"exit wait for cold boot done\\n\");\n\treturn 0;\n}\nEXPORT_SYMBOL(ath11k_qmi_fwreset_from_cold_boot);\n\nstatic int ath11k_qmi_process_coldboot_calibration(struct ath11k_base *ab)\n{\n\tint timeout;\n\tint ret;\n\n\tret = ath11k_qmi_wlanfw_mode_send(ab, ATH11K_FIRMWARE_MODE_COLD_BOOT);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to send wlan fw mode: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"Coldboot calibration wait started\\n\");\n\n\ttimeout = wait_event_timeout(ab->qmi.cold_boot_waitq,\n\t\t\t\t     (ab->qmi.cal_done  == 1),\n\t\t\t\t     ATH11K_COLD_BOOT_FW_RESET_DELAY);\n\tif (timeout <= 0) {\n\t\tath11k_warn(ab, \"coldboot calibration timed out\\n\");\n\t\treturn 0;\n\t}\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"Coldboot calibration done\\n\");\n\n\treturn 0;\n}\n\nstatic int\nath11k_qmi_driver_event_post(struct ath11k_qmi *qmi,\n\t\t\t     enum ath11k_qmi_event_type type,\n\t\t\t     void *data)\n{\n\tstruct ath11k_qmi_driver_event *event;\n\n\tevent = kzalloc(sizeof(*event), GFP_ATOMIC);\n\tif (!event)\n\t\treturn -ENOMEM;\n\n\tevent->type = type;\n\tevent->data = data;\n\n\tspin_lock(&qmi->event_lock);\n\tlist_add_tail(&event->list, &qmi->event_list);\n\tspin_unlock(&qmi->event_lock);\n\n\tqueue_work(qmi->event_wq, &qmi->event_work);\n\n\treturn 0;\n}\n\nstatic int ath11k_qmi_event_mem_request(struct ath11k_qmi *qmi)\n{\n\tstruct ath11k_base *ab = qmi->ab;\n\tint ret;\n\n\tret = ath11k_qmi_respond_fw_mem_request(ab);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to respond fw mem req: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nstatic int ath11k_qmi_event_load_bdf(struct ath11k_qmi *qmi)\n{\n\tstruct ath11k_base *ab = qmi->ab;\n\tint ret;\n\n\tret = ath11k_qmi_request_target_cap(ab);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to request qmi target capabilities: %d\\n\",\n\t\t\t    ret);\n\t\treturn ret;\n\t}\n\n\tret = ath11k_qmi_request_device_info(ab);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to request qmi device info: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tif (ab->hw_params.supports_regdb)\n\t\tath11k_qmi_load_bdf_qmi(ab, true);\n\n\tret = ath11k_qmi_load_bdf_qmi(ab, false);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to load board data file: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int ath11k_qmi_event_server_arrive(struct ath11k_qmi *qmi)\n{\n\tstruct ath11k_base *ab = qmi->ab;\n\tint ret;\n\n\tret = ath11k_qmi_fw_ind_register_send(ab);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to send qmi firmware indication: %d\\n\",\n\t\t\t    ret);\n\t\treturn ret;\n\t}\n\n\tret = ath11k_qmi_host_cap_send(ab);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to send qmi host cap: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tif (!ab->hw_params.fixed_fw_mem)\n\t\treturn ret;\n\n\tret = ath11k_qmi_event_load_bdf(qmi);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"qmi failed to download BDF:%d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nstatic void ath11k_qmi_msg_mem_request_cb(struct qmi_handle *qmi_hdl,\n\t\t\t\t\t  struct sockaddr_qrtr *sq,\n\t\t\t\t\t  struct qmi_txn *txn,\n\t\t\t\t\t  const void *data)\n{\n\tstruct ath11k_qmi *qmi = container_of(qmi_hdl, struct ath11k_qmi, handle);\n\tstruct ath11k_base *ab = qmi->ab;\n\tconst struct qmi_wlanfw_request_mem_ind_msg_v01 *msg = data;\n\tint i, ret;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"firmware request memory request\\n\");\n\n\tif (msg->mem_seg_len == 0 ||\n\t    msg->mem_seg_len > ATH11K_QMI_WLANFW_MAX_NUM_MEM_SEG_V01)\n\t\tath11k_warn(ab, \"invalid memory segment length: %u\\n\",\n\t\t\t    msg->mem_seg_len);\n\n\tab->qmi.mem_seg_count = msg->mem_seg_len;\n\n\tfor (i = 0; i < qmi->mem_seg_count ; i++) {\n\t\tab->qmi.target_mem[i].type = msg->mem_seg[i].type;\n\t\tab->qmi.target_mem[i].size = msg->mem_seg[i].size;\n\t\tath11k_dbg(ab, ATH11K_DBG_QMI, \"mem seg type %d size %d\\n\",\n\t\t\t   msg->mem_seg[i].type, msg->mem_seg[i].size);\n\t}\n\n\tif (ab->hw_params.fixed_mem_region ||\n\t    test_bit(ATH11K_FLAG_FIXED_MEM_RGN, &ab->dev_flags)) {\n\t\tret = ath11k_qmi_assign_target_mem_chunk(ab);\n\t\tif (ret) {\n\t\t\tath11k_warn(ab, \"failed to assign qmi target memory: %d\\n\",\n\t\t\t\t    ret);\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\tret = ath11k_qmi_alloc_target_mem_chunk(ab);\n\t\tif (ret) {\n\t\t\tath11k_warn(ab, \"failed to allocate qmi target memory: %d\\n\",\n\t\t\t\t    ret);\n\t\t\treturn;\n\t\t}\n\t}\n\n\tath11k_qmi_driver_event_post(qmi, ATH11K_QMI_EVENT_REQUEST_MEM, NULL);\n}\n\nstatic void ath11k_qmi_msg_mem_ready_cb(struct qmi_handle *qmi_hdl,\n\t\t\t\t\tstruct sockaddr_qrtr *sq,\n\t\t\t\t\tstruct qmi_txn *txn,\n\t\t\t\t\tconst void *decoded)\n{\n\tstruct ath11k_qmi *qmi = container_of(qmi_hdl, struct ath11k_qmi, handle);\n\tstruct ath11k_base *ab = qmi->ab;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"firmware memory ready indication\\n\");\n\tath11k_qmi_driver_event_post(qmi, ATH11K_QMI_EVENT_FW_MEM_READY, NULL);\n}\n\nstatic void ath11k_qmi_msg_fw_ready_cb(struct qmi_handle *qmi_hdl,\n\t\t\t\t       struct sockaddr_qrtr *sq,\n\t\t\t\t       struct qmi_txn *txn,\n\t\t\t\t       const void *decoded)\n{\n\tstruct ath11k_qmi *qmi = container_of(qmi_hdl, struct ath11k_qmi, handle);\n\tstruct ath11k_base *ab = qmi->ab;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"firmware ready\\n\");\n\n\tif (!ab->qmi.cal_done) {\n\t\tab->qmi.cal_done = 1;\n\t\twake_up(&ab->qmi.cold_boot_waitq);\n\t}\n\n\tath11k_qmi_driver_event_post(qmi, ATH11K_QMI_EVENT_FW_READY, NULL);\n}\n\nstatic void ath11k_qmi_msg_cold_boot_cal_done_cb(struct qmi_handle *qmi_hdl,\n\t\t\t\t\t\t struct sockaddr_qrtr *sq,\n\t\t\t\t\t\t struct qmi_txn *txn,\n\t\t\t\t\t\t const void *decoded)\n{\n\tstruct ath11k_qmi *qmi = container_of(qmi_hdl,\n\t\t\t\t\t      struct ath11k_qmi, handle);\n\tstruct ath11k_base *ab = qmi->ab;\n\n\tab->qmi.cal_done = 1;\n\twake_up(&ab->qmi.cold_boot_waitq);\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"cold boot calibration done\\n\");\n}\n\nstatic void ath11k_qmi_msg_fw_init_done_cb(struct qmi_handle *qmi_hdl,\n\t\t\t\t\t   struct sockaddr_qrtr *sq,\n\t\t\t\t\t   struct qmi_txn *txn,\n\t\t\t\t\t   const void *decoded)\n{\n\tstruct ath11k_qmi *qmi = container_of(qmi_hdl,\n\t\t\t\t\t      struct ath11k_qmi, handle);\n\tstruct ath11k_base *ab = qmi->ab;\n\n\tath11k_qmi_driver_event_post(qmi, ATH11K_QMI_EVENT_FW_INIT_DONE, NULL);\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"firmware init done\\n\");\n}\n\nstatic const struct qmi_msg_handler ath11k_qmi_msg_handlers[] = {\n\t{\n\t\t.type = QMI_INDICATION,\n\t\t.msg_id = QMI_WLFW_REQUEST_MEM_IND_V01,\n\t\t.ei = qmi_wlanfw_request_mem_ind_msg_v01_ei,\n\t\t.decoded_size = sizeof(struct qmi_wlanfw_request_mem_ind_msg_v01),\n\t\t.fn = ath11k_qmi_msg_mem_request_cb,\n\t},\n\t{\n\t\t.type = QMI_INDICATION,\n\t\t.msg_id = QMI_WLFW_FW_MEM_READY_IND_V01,\n\t\t.ei = qmi_wlanfw_mem_ready_ind_msg_v01_ei,\n\t\t.decoded_size = sizeof(struct qmi_wlanfw_fw_mem_ready_ind_msg_v01),\n\t\t.fn = ath11k_qmi_msg_mem_ready_cb,\n\t},\n\t{\n\t\t.type = QMI_INDICATION,\n\t\t.msg_id = QMI_WLFW_FW_READY_IND_V01,\n\t\t.ei = qmi_wlanfw_fw_ready_ind_msg_v01_ei,\n\t\t.decoded_size = sizeof(struct qmi_wlanfw_fw_ready_ind_msg_v01),\n\t\t.fn = ath11k_qmi_msg_fw_ready_cb,\n\t},\n\t{\n\t\t.type = QMI_INDICATION,\n\t\t.msg_id = QMI_WLFW_COLD_BOOT_CAL_DONE_IND_V01,\n\t\t.ei = qmi_wlanfw_cold_boot_cal_done_ind_msg_v01_ei,\n\t\t.decoded_size =\n\t\t\tsizeof(struct qmi_wlanfw_fw_cold_cal_done_ind_msg_v01),\n\t\t.fn = ath11k_qmi_msg_cold_boot_cal_done_cb,\n\t},\n\t{\n\t\t.type = QMI_INDICATION,\n\t\t.msg_id = QMI_WLFW_FW_INIT_DONE_IND_V01,\n\t\t.ei = qmi_wlfw_fw_init_done_ind_msg_v01_ei,\n\t\t.decoded_size =\n\t\t\tsizeof(struct qmi_wlfw_fw_init_done_ind_msg_v01),\n\t\t.fn = ath11k_qmi_msg_fw_init_done_cb,\n\t},\n\n\t \n\t{},\n};\n\nstatic int ath11k_qmi_ops_new_server(struct qmi_handle *qmi_hdl,\n\t\t\t\t     struct qmi_service *service)\n{\n\tstruct ath11k_qmi *qmi = container_of(qmi_hdl, struct ath11k_qmi, handle);\n\tstruct ath11k_base *ab = qmi->ab;\n\tstruct sockaddr_qrtr *sq = &qmi->sq;\n\tint ret;\n\n\tsq->sq_family = AF_QIPCRTR;\n\tsq->sq_node = service->node;\n\tsq->sq_port = service->port;\n\n\tret = kernel_connect(qmi_hdl->sock, (struct sockaddr *)sq,\n\t\t\t     sizeof(*sq), 0);\n\tif (ret) {\n\t\tath11k_warn(ab, \"failed to connect to qmi remote service: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"wifi fw qmi service connected\\n\");\n\tath11k_qmi_driver_event_post(qmi, ATH11K_QMI_EVENT_SERVER_ARRIVE, NULL);\n\n\treturn ret;\n}\n\nstatic void ath11k_qmi_ops_del_server(struct qmi_handle *qmi_hdl,\n\t\t\t\t      struct qmi_service *service)\n{\n\tstruct ath11k_qmi *qmi = container_of(qmi_hdl, struct ath11k_qmi, handle);\n\tstruct ath11k_base *ab = qmi->ab;\n\n\tath11k_dbg(ab, ATH11K_DBG_QMI, \"wifi fw del server\\n\");\n\tath11k_qmi_driver_event_post(qmi, ATH11K_QMI_EVENT_SERVER_EXIT, NULL);\n}\n\nstatic const struct qmi_ops ath11k_qmi_ops = {\n\t.new_server = ath11k_qmi_ops_new_server,\n\t.del_server = ath11k_qmi_ops_del_server,\n};\n\nstatic void ath11k_qmi_driver_event_work(struct work_struct *work)\n{\n\tstruct ath11k_qmi *qmi = container_of(work, struct ath11k_qmi,\n\t\t\t\t\t      event_work);\n\tstruct ath11k_qmi_driver_event *event;\n\tstruct ath11k_base *ab = qmi->ab;\n\tint ret;\n\n\tspin_lock(&qmi->event_lock);\n\twhile (!list_empty(&qmi->event_list)) {\n\t\tevent = list_first_entry(&qmi->event_list,\n\t\t\t\t\t struct ath11k_qmi_driver_event, list);\n\t\tlist_del(&event->list);\n\t\tspin_unlock(&qmi->event_lock);\n\n\t\tif (test_bit(ATH11K_FLAG_UNREGISTERING, &ab->dev_flags)) {\n\t\t\tkfree(event);\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (event->type) {\n\t\tcase ATH11K_QMI_EVENT_SERVER_ARRIVE:\n\t\t\tret = ath11k_qmi_event_server_arrive(qmi);\n\t\t\tif (ret < 0)\n\t\t\t\tset_bit(ATH11K_FLAG_QMI_FAIL, &ab->dev_flags);\n\t\t\tbreak;\n\t\tcase ATH11K_QMI_EVENT_SERVER_EXIT:\n\t\t\tset_bit(ATH11K_FLAG_CRASH_FLUSH, &ab->dev_flags);\n\t\t\tset_bit(ATH11K_FLAG_RECOVERY, &ab->dev_flags);\n\n\t\t\tif (!ab->is_reset)\n\t\t\t\tath11k_core_pre_reconfigure_recovery(ab);\n\t\t\tbreak;\n\t\tcase ATH11K_QMI_EVENT_REQUEST_MEM:\n\t\t\tret = ath11k_qmi_event_mem_request(qmi);\n\t\t\tif (ret < 0)\n\t\t\t\tset_bit(ATH11K_FLAG_QMI_FAIL, &ab->dev_flags);\n\t\t\tbreak;\n\t\tcase ATH11K_QMI_EVENT_FW_MEM_READY:\n\t\t\tret = ath11k_qmi_event_load_bdf(qmi);\n\t\t\tif (ret < 0) {\n\t\t\t\tset_bit(ATH11K_FLAG_QMI_FAIL, &ab->dev_flags);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tret = ath11k_qmi_wlanfw_m3_info_send(ab);\n\t\t\tif (ret < 0) {\n\t\t\t\tath11k_warn(ab,\n\t\t\t\t\t    \"failed to send qmi m3 info req: %d\\n\", ret);\n\t\t\t\tset_bit(ATH11K_FLAG_QMI_FAIL, &ab->dev_flags);\n\t\t\t}\n\n\t\t\tbreak;\n\t\tcase ATH11K_QMI_EVENT_FW_INIT_DONE:\n\t\t\tclear_bit(ATH11K_FLAG_QMI_FAIL, &ab->dev_flags);\n\t\t\tif (test_bit(ATH11K_FLAG_REGISTERED, &ab->dev_flags)) {\n\t\t\t\tath11k_hal_dump_srng_stats(ab);\n\t\t\t\tqueue_work(ab->workqueue, &ab->restart_work);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (ab->qmi.cal_done == 0 &&\n\t\t\t    ath11k_core_coldboot_cal_support(ab)) {\n\t\t\t\tath11k_qmi_process_coldboot_calibration(ab);\n\t\t\t} else {\n\t\t\t\tclear_bit(ATH11K_FLAG_CRASH_FLUSH,\n\t\t\t\t\t  &ab->dev_flags);\n\t\t\t\tclear_bit(ATH11K_FLAG_RECOVERY, &ab->dev_flags);\n\t\t\t\tret = ath11k_core_qmi_firmware_ready(ab);\n\t\t\t\tif (ret) {\n\t\t\t\t\tset_bit(ATH11K_FLAG_QMI_FAIL, &ab->dev_flags);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tset_bit(ATH11K_FLAG_REGISTERED, &ab->dev_flags);\n\t\t\t}\n\n\t\t\tbreak;\n\t\tcase ATH11K_QMI_EVENT_FW_READY:\n\t\t\t \n\t\t\tif (ab->hw_params.cbcal_restart_fw)\n\t\t\t\tbreak;\n\n\t\t\tclear_bit(ATH11K_FLAG_CRASH_FLUSH,\n\t\t\t\t  &ab->dev_flags);\n\t\t\tclear_bit(ATH11K_FLAG_RECOVERY, &ab->dev_flags);\n\t\t\tath11k_core_qmi_firmware_ready(ab);\n\t\t\tset_bit(ATH11K_FLAG_REGISTERED, &ab->dev_flags);\n\n\t\t\tbreak;\n\t\tcase ATH11K_QMI_EVENT_COLD_BOOT_CAL_DONE:\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tath11k_warn(ab, \"invalid qmi event type: %d\", event->type);\n\t\t\tbreak;\n\t\t}\n\t\tkfree(event);\n\t\tspin_lock(&qmi->event_lock);\n\t}\n\tspin_unlock(&qmi->event_lock);\n}\n\nint ath11k_qmi_init_service(struct ath11k_base *ab)\n{\n\tint ret;\n\n\tmemset(&ab->qmi.target, 0, sizeof(struct target_info));\n\tmemset(&ab->qmi.target_mem, 0, sizeof(struct target_mem_chunk));\n\tab->qmi.ab = ab;\n\n\tab->qmi.target_mem_mode = ab->hw_params.fw_mem_mode;\n\tret = qmi_handle_init(&ab->qmi.handle, ATH11K_QMI_RESP_LEN_MAX,\n\t\t\t      &ath11k_qmi_ops, ath11k_qmi_msg_handlers);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to initialize qmi handle: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tab->qmi.event_wq = alloc_ordered_workqueue(\"ath11k_qmi_driver_event\", 0);\n\tif (!ab->qmi.event_wq) {\n\t\tath11k_err(ab, \"failed to allocate workqueue\\n\");\n\t\treturn -EFAULT;\n\t}\n\n\tINIT_LIST_HEAD(&ab->qmi.event_list);\n\tspin_lock_init(&ab->qmi.event_lock);\n\tINIT_WORK(&ab->qmi.event_work, ath11k_qmi_driver_event_work);\n\n\tret = qmi_add_lookup(&ab->qmi.handle, ATH11K_QMI_WLFW_SERVICE_ID_V01,\n\t\t\t     ATH11K_QMI_WLFW_SERVICE_VERS_V01,\n\t\t\t     ab->qmi.service_ins_id);\n\tif (ret < 0) {\n\t\tath11k_warn(ab, \"failed to add qmi lookup: %d\\n\", ret);\n\t\tdestroy_workqueue(ab->qmi.event_wq);\n\t\treturn ret;\n\t}\n\n\treturn ret;\n}\n\nvoid ath11k_qmi_deinit_service(struct ath11k_base *ab)\n{\n\tqmi_handle_release(&ab->qmi.handle);\n\tcancel_work_sync(&ab->qmi.event_work);\n\tdestroy_workqueue(ab->qmi.event_wq);\n\tath11k_qmi_m3_free(ab);\n\tath11k_qmi_free_target_mem_chunk(ab);\n}\nEXPORT_SYMBOL(ath11k_qmi_deinit_service);\n\nvoid ath11k_qmi_free_resource(struct ath11k_base *ab)\n{\n\tath11k_qmi_free_target_mem_chunk(ab);\n\tath11k_qmi_m3_free(ab);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}