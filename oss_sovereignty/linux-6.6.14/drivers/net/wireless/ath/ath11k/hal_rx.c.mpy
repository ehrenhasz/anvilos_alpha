{
  "module_name": "hal_rx.c",
  "hash_id": "ca4e43fc0edb81ebf3e35ddacc0253fce4e50b2f1522c83624996a8c2562c04b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath11k/hal_rx.c",
  "human_readable_source": "\n \n\n#include \"debug.h\"\n#include \"hal.h\"\n#include \"hal_tx.h\"\n#include \"hal_rx.h\"\n#include \"hal_desc.h\"\n#include \"hif.h\"\n\nstatic void ath11k_hal_reo_set_desc_hdr(struct hal_desc_header *hdr,\n\t\t\t\t\tu8 owner, u8 buffer_type, u32 magic)\n{\n\thdr->info0 = FIELD_PREP(HAL_DESC_HDR_INFO0_OWNER, owner) |\n\t\t     FIELD_PREP(HAL_DESC_HDR_INFO0_BUF_TYPE, buffer_type);\n\n\t \n\thdr->info0 |= FIELD_PREP(HAL_DESC_HDR_INFO0_DBG_RESERVED, magic);\n}\n\nstatic int ath11k_hal_reo_cmd_queue_stats(struct hal_tlv_hdr *tlv,\n\t\t\t\t\t  struct ath11k_hal_reo_cmd *cmd)\n{\n\tstruct hal_reo_get_queue_stats *desc;\n\n\ttlv->tl = FIELD_PREP(HAL_TLV_HDR_TAG, HAL_REO_GET_QUEUE_STATS) |\n\t\t  FIELD_PREP(HAL_TLV_HDR_LEN, sizeof(*desc));\n\n\tdesc = (struct hal_reo_get_queue_stats *)tlv->value;\n\tmemset_startat(desc, 0, queue_addr_lo);\n\n\tdesc->cmd.info0 &= ~HAL_REO_CMD_HDR_INFO0_STATUS_REQUIRED;\n\tif (cmd->flag & HAL_REO_CMD_FLG_NEED_STATUS)\n\t\tdesc->cmd.info0 |= HAL_REO_CMD_HDR_INFO0_STATUS_REQUIRED;\n\n\tdesc->queue_addr_lo = cmd->addr_lo;\n\tdesc->info0 = FIELD_PREP(HAL_REO_GET_QUEUE_STATS_INFO0_QUEUE_ADDR_HI,\n\t\t\t\t cmd->addr_hi);\n\tif (cmd->flag & HAL_REO_CMD_FLG_STATS_CLEAR)\n\t\tdesc->info0 |= HAL_REO_GET_QUEUE_STATS_INFO0_CLEAR_STATS;\n\n\treturn FIELD_GET(HAL_REO_CMD_HDR_INFO0_CMD_NUMBER, desc->cmd.info0);\n}\n\nstatic int ath11k_hal_reo_cmd_flush_cache(struct ath11k_hal *hal, struct hal_tlv_hdr *tlv,\n\t\t\t\t\t  struct ath11k_hal_reo_cmd *cmd)\n{\n\tstruct hal_reo_flush_cache *desc;\n\tu8 avail_slot = ffz(hal->avail_blk_resource);\n\n\tif (cmd->flag & HAL_REO_CMD_FLG_FLUSH_BLOCK_LATER) {\n\t\tif (avail_slot >= HAL_MAX_AVAIL_BLK_RES)\n\t\t\treturn -ENOSPC;\n\n\t\thal->current_blk_index = avail_slot;\n\t}\n\n\ttlv->tl = FIELD_PREP(HAL_TLV_HDR_TAG, HAL_REO_FLUSH_CACHE) |\n\t\t  FIELD_PREP(HAL_TLV_HDR_LEN, sizeof(*desc));\n\n\tdesc = (struct hal_reo_flush_cache *)tlv->value;\n\tmemset_startat(desc, 0, cache_addr_lo);\n\n\tdesc->cmd.info0 &= ~HAL_REO_CMD_HDR_INFO0_STATUS_REQUIRED;\n\tif (cmd->flag & HAL_REO_CMD_FLG_NEED_STATUS)\n\t\tdesc->cmd.info0 |= HAL_REO_CMD_HDR_INFO0_STATUS_REQUIRED;\n\n\tdesc->cache_addr_lo = cmd->addr_lo;\n\tdesc->info0 = FIELD_PREP(HAL_REO_FLUSH_CACHE_INFO0_CACHE_ADDR_HI,\n\t\t\t\t cmd->addr_hi);\n\n\tif (cmd->flag & HAL_REO_CMD_FLG_FLUSH_FWD_ALL_MPDUS)\n\t\tdesc->info0 |= HAL_REO_FLUSH_CACHE_INFO0_FWD_ALL_MPDUS;\n\n\tif (cmd->flag & HAL_REO_CMD_FLG_FLUSH_BLOCK_LATER) {\n\t\tdesc->info0 |= HAL_REO_FLUSH_CACHE_INFO0_BLOCK_CACHE_USAGE;\n\t\tdesc->info0 |=\n\t\t\tFIELD_PREP(HAL_REO_FLUSH_CACHE_INFO0_BLOCK_RESRC_IDX,\n\t\t\t\t   avail_slot);\n\t}\n\n\tif (cmd->flag & HAL_REO_CMD_FLG_FLUSH_NO_INVAL)\n\t\tdesc->info0 |= HAL_REO_FLUSH_CACHE_INFO0_FLUSH_WO_INVALIDATE;\n\n\tif (cmd->flag & HAL_REO_CMD_FLG_FLUSH_ALL)\n\t\tdesc->info0 |= HAL_REO_FLUSH_CACHE_INFO0_FLUSH_ALL;\n\n\treturn FIELD_GET(HAL_REO_CMD_HDR_INFO0_CMD_NUMBER, desc->cmd.info0);\n}\n\nstatic int ath11k_hal_reo_cmd_update_rx_queue(struct hal_tlv_hdr *tlv,\n\t\t\t\t\t      struct ath11k_hal_reo_cmd *cmd)\n{\n\tstruct hal_reo_update_rx_queue *desc;\n\n\ttlv->tl = FIELD_PREP(HAL_TLV_HDR_TAG, HAL_REO_UPDATE_RX_REO_QUEUE) |\n\t\t  FIELD_PREP(HAL_TLV_HDR_LEN, sizeof(*desc));\n\n\tdesc = (struct hal_reo_update_rx_queue *)tlv->value;\n\tmemset_startat(desc, 0, queue_addr_lo);\n\n\tdesc->cmd.info0 &= ~HAL_REO_CMD_HDR_INFO0_STATUS_REQUIRED;\n\tif (cmd->flag & HAL_REO_CMD_FLG_NEED_STATUS)\n\t\tdesc->cmd.info0 |= HAL_REO_CMD_HDR_INFO0_STATUS_REQUIRED;\n\n\tdesc->queue_addr_lo = cmd->addr_lo;\n\tdesc->info0 =\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_QUEUE_ADDR_HI,\n\t\t\t   cmd->addr_hi) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_RX_QUEUE_NUM,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_RX_QUEUE_NUM)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_VLD,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_VLD)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_ASSOC_LNK_DESC_CNT,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_ALDC)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_DIS_DUP_DETECTION,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_DIS_DUP_DETECTION)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_SOFT_REORDER_EN,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_SOFT_REORDER_EN)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_AC,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_AC)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_BAR,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_BAR)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_RETRY,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_RETRY)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_CHECK_2K_MODE,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_CHECK_2K_MODE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_OOR_MODE,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_OOR_MODE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_BA_WINDOW_SIZE,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_BA_WINDOW_SIZE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_PN_CHECK,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_PN_CHECK)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_EVEN_PN,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_EVEN_PN)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_UNEVEN_PN,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_UNEVEN_PN)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_PN_HANDLE_ENABLE,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_PN_HANDLE_ENABLE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_PN_SIZE,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_PN_SIZE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_IGNORE_AMPDU_FLG,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_IGNORE_AMPDU_FLG)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_SVLD,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_SVLD)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_SSN,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_SSN)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_SEQ_2K_ERR,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_SEQ_2K_ERR)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_PN_VALID,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_PN_VALID)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO0_UPD_PN,\n\t\t\t   !!(cmd->upd0 & HAL_REO_CMD_UPD0_PN));\n\n\tdesc->info1 =\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_RX_QUEUE_NUMBER,\n\t\t\t   cmd->rx_queue_num) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_VLD,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_VLD)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_ASSOC_LNK_DESC_COUNTER,\n\t\t\t   FIELD_GET(HAL_REO_CMD_UPD1_ALDC, cmd->upd1)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_DIS_DUP_DETECTION,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_DIS_DUP_DETECTION)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_SOFT_REORDER_EN,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_SOFT_REORDER_EN)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_AC,\n\t\t\t   FIELD_GET(HAL_REO_CMD_UPD1_AC, cmd->upd1)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_BAR,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_BAR)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_CHECK_2K_MODE,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_CHECK_2K_MODE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_RETRY,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_RETRY)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_OOR_MODE,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_OOR_MODE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_PN_CHECK,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_PN_CHECK)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_EVEN_PN,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_EVEN_PN)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_UNEVEN_PN,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_UNEVEN_PN)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_PN_HANDLE_ENABLE,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_PN_HANDLE_ENABLE)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO1_IGNORE_AMPDU_FLG,\n\t\t\t   !!(cmd->upd1 & HAL_REO_CMD_UPD1_IGNORE_AMPDU_FLG));\n\n\tif (cmd->pn_size == 24)\n\t\tcmd->pn_size = HAL_RX_REO_QUEUE_PN_SIZE_24;\n\telse if (cmd->pn_size == 48)\n\t\tcmd->pn_size = HAL_RX_REO_QUEUE_PN_SIZE_48;\n\telse if (cmd->pn_size == 128)\n\t\tcmd->pn_size = HAL_RX_REO_QUEUE_PN_SIZE_128;\n\n\tif (cmd->ba_window_size < 1)\n\t\tcmd->ba_window_size = 1;\n\n\tif (cmd->ba_window_size == 1)\n\t\tcmd->ba_window_size++;\n\n\tdesc->info2 =\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO2_BA_WINDOW_SIZE,\n\t\t\t   cmd->ba_window_size - 1) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO2_PN_SIZE, cmd->pn_size) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO2_SVLD,\n\t\t\t   !!(cmd->upd2 & HAL_REO_CMD_UPD2_SVLD)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO2_SSN,\n\t\t\t   FIELD_GET(HAL_REO_CMD_UPD2_SSN, cmd->upd2)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO2_SEQ_2K_ERR,\n\t\t\t   !!(cmd->upd2 & HAL_REO_CMD_UPD2_SEQ_2K_ERR)) |\n\t\tFIELD_PREP(HAL_REO_UPD_RX_QUEUE_INFO2_PN_ERR,\n\t\t\t   !!(cmd->upd2 & HAL_REO_CMD_UPD2_PN_ERR));\n\n\treturn FIELD_GET(HAL_REO_CMD_HDR_INFO0_CMD_NUMBER, desc->cmd.info0);\n}\n\nint ath11k_hal_reo_cmd_send(struct ath11k_base *ab, struct hal_srng *srng,\n\t\t\t    enum hal_reo_cmd_type type,\n\t\t\t    struct ath11k_hal_reo_cmd *cmd)\n{\n\tstruct hal_tlv_hdr *reo_desc;\n\tint ret;\n\n\tspin_lock_bh(&srng->lock);\n\n\tath11k_hal_srng_access_begin(ab, srng);\n\treo_desc = (struct hal_tlv_hdr *)ath11k_hal_srng_src_get_next_entry(ab, srng);\n\tif (!reo_desc) {\n\t\tret = -ENOBUFS;\n\t\tgoto out;\n\t}\n\n\tswitch (type) {\n\tcase HAL_REO_CMD_GET_QUEUE_STATS:\n\t\tret = ath11k_hal_reo_cmd_queue_stats(reo_desc, cmd);\n\t\tbreak;\n\tcase HAL_REO_CMD_FLUSH_CACHE:\n\t\tret = ath11k_hal_reo_cmd_flush_cache(&ab->hal, reo_desc, cmd);\n\t\tbreak;\n\tcase HAL_REO_CMD_UPDATE_RX_QUEUE:\n\t\tret = ath11k_hal_reo_cmd_update_rx_queue(reo_desc, cmd);\n\t\tbreak;\n\tcase HAL_REO_CMD_FLUSH_QUEUE:\n\tcase HAL_REO_CMD_UNBLOCK_CACHE:\n\tcase HAL_REO_CMD_FLUSH_TIMEOUT_LIST:\n\t\tath11k_warn(ab, \"Unsupported reo command %d\\n\", type);\n\t\tret = -ENOTSUPP;\n\t\tbreak;\n\tdefault:\n\t\tath11k_warn(ab, \"Unknown reo command %d\\n\", type);\n\t\tret = -EINVAL;\n\t\tbreak;\n\t}\n\n\tath11k_dp_shadow_start_timer(ab, srng, &ab->dp.reo_cmd_timer);\n\nout:\n\tath11k_hal_srng_access_end(ab, srng);\n\tspin_unlock_bh(&srng->lock);\n\n\treturn ret;\n}\n\nvoid ath11k_hal_rx_buf_addr_info_set(void *desc, dma_addr_t paddr,\n\t\t\t\t     u32 cookie, u8 manager)\n{\n\tstruct ath11k_buffer_addr *binfo = (struct ath11k_buffer_addr *)desc;\n\tu32 paddr_lo, paddr_hi;\n\n\tpaddr_lo = lower_32_bits(paddr);\n\tpaddr_hi = upper_32_bits(paddr);\n\tbinfo->info0 = FIELD_PREP(BUFFER_ADDR_INFO0_ADDR, paddr_lo);\n\tbinfo->info1 = FIELD_PREP(BUFFER_ADDR_INFO1_ADDR, paddr_hi) |\n\t\t       FIELD_PREP(BUFFER_ADDR_INFO1_SW_COOKIE, cookie) |\n\t\t       FIELD_PREP(BUFFER_ADDR_INFO1_RET_BUF_MGR, manager);\n}\n\nvoid ath11k_hal_rx_buf_addr_info_get(void *desc, dma_addr_t *paddr,\n\t\t\t\t     u32 *cookie, u8 *rbm)\n{\n\tstruct ath11k_buffer_addr *binfo = (struct ath11k_buffer_addr *)desc;\n\n\t*paddr =\n\t\t(((u64)FIELD_GET(BUFFER_ADDR_INFO1_ADDR, binfo->info1)) << 32) |\n\t\tFIELD_GET(BUFFER_ADDR_INFO0_ADDR, binfo->info0);\n\t*cookie = FIELD_GET(BUFFER_ADDR_INFO1_SW_COOKIE, binfo->info1);\n\t*rbm = FIELD_GET(BUFFER_ADDR_INFO1_RET_BUF_MGR, binfo->info1);\n}\n\nvoid ath11k_hal_rx_msdu_link_info_get(void *link_desc, u32 *num_msdus,\n\t\t\t\t      u32 *msdu_cookies,\n\t\t\t\t      enum hal_rx_buf_return_buf_manager *rbm)\n{\n\tstruct hal_rx_msdu_link *link = (struct hal_rx_msdu_link *)link_desc;\n\tstruct hal_rx_msdu_details *msdu;\n\tint i;\n\n\t*num_msdus = HAL_NUM_RX_MSDUS_PER_LINK_DESC;\n\n\tmsdu = &link->msdu_link[0];\n\t*rbm = FIELD_GET(BUFFER_ADDR_INFO1_RET_BUF_MGR,\n\t\t\t msdu->buf_addr_info.info1);\n\n\tfor (i = 0; i < *num_msdus; i++) {\n\t\tmsdu = &link->msdu_link[i];\n\n\t\tif (!FIELD_GET(BUFFER_ADDR_INFO0_ADDR,\n\t\t\t       msdu->buf_addr_info.info0)) {\n\t\t\t*num_msdus = i;\n\t\t\tbreak;\n\t\t}\n\t\t*msdu_cookies = FIELD_GET(BUFFER_ADDR_INFO1_SW_COOKIE,\n\t\t\t\t\t  msdu->buf_addr_info.info1);\n\t\tmsdu_cookies++;\n\t}\n}\n\nint ath11k_hal_desc_reo_parse_err(struct ath11k_base *ab, u32 *rx_desc,\n\t\t\t\t  dma_addr_t *paddr, u32 *desc_bank)\n{\n\tstruct hal_reo_dest_ring *desc = (struct hal_reo_dest_ring *)rx_desc;\n\tenum hal_reo_dest_ring_push_reason push_reason;\n\tenum hal_reo_dest_ring_error_code err_code;\n\n\tpush_reason = FIELD_GET(HAL_REO_DEST_RING_INFO0_PUSH_REASON,\n\t\t\t\tdesc->info0);\n\terr_code = FIELD_GET(HAL_REO_DEST_RING_INFO0_ERROR_CODE,\n\t\t\t     desc->info0);\n\tab->soc_stats.reo_error[err_code]++;\n\n\tif (push_reason != HAL_REO_DEST_RING_PUSH_REASON_ERR_DETECTED &&\n\t    push_reason != HAL_REO_DEST_RING_PUSH_REASON_ROUTING_INSTRUCTION) {\n\t\tath11k_warn(ab, \"expected error push reason code, received %d\\n\",\n\t\t\t    push_reason);\n\t\treturn -EINVAL;\n\t}\n\n\tif (FIELD_GET(HAL_REO_DEST_RING_INFO0_BUFFER_TYPE, desc->info0) !=\n\t    HAL_REO_DEST_RING_BUFFER_TYPE_LINK_DESC) {\n\t\tath11k_warn(ab, \"expected buffer type link_desc\");\n\t\treturn -EINVAL;\n\t}\n\n\tath11k_hal_rx_reo_ent_paddr_get(ab, rx_desc, paddr, desc_bank);\n\n\treturn 0;\n}\n\nint ath11k_hal_wbm_desc_parse_err(struct ath11k_base *ab, void *desc,\n\t\t\t\t  struct hal_rx_wbm_rel_info *rel_info)\n{\n\tstruct hal_wbm_release_ring *wbm_desc = desc;\n\tenum hal_wbm_rel_desc_type type;\n\tenum hal_wbm_rel_src_module rel_src;\n\tenum hal_rx_buf_return_buf_manager ret_buf_mgr;\n\n\ttype = FIELD_GET(HAL_WBM_RELEASE_INFO0_DESC_TYPE,\n\t\t\t wbm_desc->info0);\n\t \n\tif (type != HAL_WBM_REL_DESC_TYPE_REL_MSDU) {\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\n\trel_src = FIELD_GET(HAL_WBM_RELEASE_INFO0_REL_SRC_MODULE,\n\t\t\t    wbm_desc->info0);\n\tif (rel_src != HAL_WBM_REL_SRC_MODULE_RXDMA &&\n\t    rel_src != HAL_WBM_REL_SRC_MODULE_REO)\n\t\treturn -EINVAL;\n\n\tret_buf_mgr = FIELD_GET(BUFFER_ADDR_INFO1_RET_BUF_MGR,\n\t\t\t\twbm_desc->buf_addr_info.info1);\n\tif (ret_buf_mgr != HAL_RX_BUF_RBM_SW3_BM) {\n\t\tab->soc_stats.invalid_rbm++;\n\t\treturn -EINVAL;\n\t}\n\n\trel_info->cookie = FIELD_GET(BUFFER_ADDR_INFO1_SW_COOKIE,\n\t\t\t\t     wbm_desc->buf_addr_info.info1);\n\trel_info->err_rel_src = rel_src;\n\tif (rel_src == HAL_WBM_REL_SRC_MODULE_REO) {\n\t\trel_info->push_reason =\n\t\t\tFIELD_GET(HAL_WBM_RELEASE_INFO0_REO_PUSH_REASON,\n\t\t\t\t  wbm_desc->info0);\n\t\trel_info->err_code =\n\t\t\tFIELD_GET(HAL_WBM_RELEASE_INFO0_REO_ERROR_CODE,\n\t\t\t\t  wbm_desc->info0);\n\t} else {\n\t\trel_info->push_reason =\n\t\t\tFIELD_GET(HAL_WBM_RELEASE_INFO0_RXDMA_PUSH_REASON,\n\t\t\t\t  wbm_desc->info0);\n\t\trel_info->err_code =\n\t\t\tFIELD_GET(HAL_WBM_RELEASE_INFO0_RXDMA_ERROR_CODE,\n\t\t\t\t  wbm_desc->info0);\n\t}\n\n\trel_info->first_msdu = FIELD_GET(HAL_WBM_RELEASE_INFO2_FIRST_MSDU,\n\t\t\t\t\t wbm_desc->info2);\n\trel_info->last_msdu = FIELD_GET(HAL_WBM_RELEASE_INFO2_LAST_MSDU,\n\t\t\t\t\twbm_desc->info2);\n\treturn 0;\n}\n\nvoid ath11k_hal_rx_reo_ent_paddr_get(struct ath11k_base *ab, void *desc,\n\t\t\t\t     dma_addr_t *paddr, u32 *desc_bank)\n{\n\tstruct ath11k_buffer_addr *buff_addr = desc;\n\n\t*paddr = ((u64)(FIELD_GET(BUFFER_ADDR_INFO1_ADDR, buff_addr->info1)) << 32) |\n\t\t  FIELD_GET(BUFFER_ADDR_INFO0_ADDR, buff_addr->info0);\n\n\t*desc_bank = FIELD_GET(BUFFER_ADDR_INFO1_SW_COOKIE, buff_addr->info1);\n}\n\nvoid ath11k_hal_rx_msdu_link_desc_set(struct ath11k_base *ab, void *desc,\n\t\t\t\t      void *link_desc,\n\t\t\t\t      enum hal_wbm_rel_bm_act action)\n{\n\tstruct hal_wbm_release_ring *dst_desc = desc;\n\tstruct hal_wbm_release_ring *src_desc = link_desc;\n\n\tdst_desc->buf_addr_info = src_desc->buf_addr_info;\n\tdst_desc->info0 |= FIELD_PREP(HAL_WBM_RELEASE_INFO0_REL_SRC_MODULE,\n\t\t\t\t      HAL_WBM_REL_SRC_MODULE_SW) |\n\t\t\t   FIELD_PREP(HAL_WBM_RELEASE_INFO0_BM_ACTION, action) |\n\t\t\t   FIELD_PREP(HAL_WBM_RELEASE_INFO0_DESC_TYPE,\n\t\t\t\t      HAL_WBM_REL_DESC_TYPE_MSDU_LINK);\n}\n\nvoid ath11k_hal_reo_status_queue_stats(struct ath11k_base *ab, u32 *reo_desc,\n\t\t\t\t       struct hal_reo_status *status)\n{\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_get_queue_stats_status *desc =\n\t\t(struct hal_reo_get_queue_stats_status *)tlv->value;\n\n\tstatus->uniform_hdr.cmd_num =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM,\n\t\t\t\t\t  desc->hdr.info0);\n\tstatus->uniform_hdr.cmd_status =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS,\n\t\t\t\t\t  desc->hdr.info0);\n\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"Queue stats status:\\n\");\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"header: cmd_num %d status %d\\n\",\n\t\t   status->uniform_hdr.cmd_num,\n\t\t   status->uniform_hdr.cmd_status);\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"ssn %ld cur_idx %ld\\n\",\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO0_SSN,\n\t\t\t     desc->info0),\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO0_CUR_IDX,\n\t\t\t     desc->info0));\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"pn = [%08x, %08x, %08x, %08x]\\n\",\n\t\t   desc->pn[0], desc->pn[1], desc->pn[2], desc->pn[3]);\n\tath11k_dbg(ab, ATH11K_DBG_HAL,\n\t\t   \"last_rx: enqueue_tstamp %08x dequeue_tstamp %08x\\n\",\n\t\t   desc->last_rx_enqueue_timestamp,\n\t\t   desc->last_rx_dequeue_timestamp);\n\tath11k_dbg(ab, ATH11K_DBG_HAL,\n\t\t   \"rx_bitmap [%08x %08x %08x %08x %08x %08x %08x %08x]\\n\",\n\t\t   desc->rx_bitmap[0], desc->rx_bitmap[1], desc->rx_bitmap[2],\n\t\t   desc->rx_bitmap[3], desc->rx_bitmap[4], desc->rx_bitmap[5],\n\t\t   desc->rx_bitmap[6], desc->rx_bitmap[7]);\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"count: cur_mpdu %ld cur_msdu %ld\\n\",\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO1_MPDU_COUNT,\n\t\t\t     desc->info1),\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO1_MSDU_COUNT,\n\t\t\t     desc->info1));\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"fwd_timeout %ld fwd_bar %ld dup_count %ld\\n\",\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO2_TIMEOUT_COUNT,\n\t\t\t     desc->info2),\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO2_FDTB_COUNT,\n\t\t\t     desc->info2),\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO2_DUPLICATE_COUNT,\n\t\t\t     desc->info2));\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"frames_in_order %ld bar_rcvd %ld\\n\",\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO3_FIO_COUNT,\n\t\t\t     desc->info3),\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO3_BAR_RCVD_CNT,\n\t\t\t     desc->info3));\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"num_mpdus %d num_msdus %d total_bytes %d\\n\",\n\t\t   desc->num_mpdu_frames, desc->num_msdu_frames,\n\t\t   desc->total_bytes);\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"late_rcvd %ld win_jump_2k %ld hole_cnt %ld\\n\",\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO4_LATE_RX_MPDU,\n\t\t\t     desc->info4),\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO4_WINDOW_JMP2K,\n\t\t\t     desc->info4),\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO4_HOLE_COUNT,\n\t\t\t     desc->info4));\n\tath11k_dbg(ab, ATH11K_DBG_HAL, \"looping count %ld\\n\",\n\t\t   FIELD_GET(HAL_REO_GET_QUEUE_STATS_STATUS_INFO5_LOOPING_CNT,\n\t\t\t     desc->info5));\n}\n\nint ath11k_hal_reo_process_status(u8 *reo_desc, u8 *status)\n{\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_status_hdr *hdr;\n\n\thdr = (struct hal_reo_status_hdr *)tlv->value;\n\t*status = FIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS, hdr->info0);\n\n\treturn FIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM, hdr->info0);\n}\n\nvoid ath11k_hal_reo_flush_queue_status(struct ath11k_base *ab, u32 *reo_desc,\n\t\t\t\t       struct hal_reo_status *status)\n{\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_flush_queue_status *desc =\n\t\t(struct hal_reo_flush_queue_status *)tlv->value;\n\n\tstatus->uniform_hdr.cmd_num =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM,\n\t\t\t\t\t  desc->hdr.info0);\n\tstatus->uniform_hdr.cmd_status =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS,\n\t\t\t\t\t  desc->hdr.info0);\n\tstatus->u.flush_queue.err_detected =\n\t\tFIELD_GET(HAL_REO_FLUSH_QUEUE_INFO0_ERR_DETECTED,\n\t\t\t  desc->info0);\n}\n\nvoid ath11k_hal_reo_flush_cache_status(struct ath11k_base *ab, u32 *reo_desc,\n\t\t\t\t       struct hal_reo_status *status)\n{\n\tstruct ath11k_hal *hal = &ab->hal;\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_flush_cache_status *desc =\n\t\t(struct hal_reo_flush_cache_status *)tlv->value;\n\n\tstatus->uniform_hdr.cmd_num =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM,\n\t\t\t\t\t  desc->hdr.info0);\n\tstatus->uniform_hdr.cmd_status =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS,\n\t\t\t\t\t  desc->hdr.info0);\n\n\tstatus->u.flush_cache.err_detected =\n\t\t\tFIELD_GET(HAL_REO_FLUSH_CACHE_STATUS_INFO0_IS_ERR,\n\t\t\t\t  desc->info0);\n\tstatus->u.flush_cache.err_code =\n\t\tFIELD_GET(HAL_REO_FLUSH_CACHE_STATUS_INFO0_BLOCK_ERR_CODE,\n\t\t\t  desc->info0);\n\tif (!status->u.flush_cache.err_code)\n\t\thal->avail_blk_resource |= BIT(hal->current_blk_index);\n\n\tstatus->u.flush_cache.cache_controller_flush_status_hit =\n\t\tFIELD_GET(HAL_REO_FLUSH_CACHE_STATUS_INFO0_FLUSH_STATUS_HIT,\n\t\t\t  desc->info0);\n\n\tstatus->u.flush_cache.cache_controller_flush_status_desc_type =\n\t\tFIELD_GET(HAL_REO_FLUSH_CACHE_STATUS_INFO0_FLUSH_DESC_TYPE,\n\t\t\t  desc->info0);\n\tstatus->u.flush_cache.cache_controller_flush_status_client_id =\n\t\tFIELD_GET(HAL_REO_FLUSH_CACHE_STATUS_INFO0_FLUSH_CLIENT_ID,\n\t\t\t  desc->info0);\n\tstatus->u.flush_cache.cache_controller_flush_status_err =\n\t\tFIELD_GET(HAL_REO_FLUSH_CACHE_STATUS_INFO0_FLUSH_ERR,\n\t\t\t  desc->info0);\n\tstatus->u.flush_cache.cache_controller_flush_status_cnt =\n\t\tFIELD_GET(HAL_REO_FLUSH_CACHE_STATUS_INFO0_FLUSH_COUNT,\n\t\t\t  desc->info0);\n}\n\nvoid ath11k_hal_reo_unblk_cache_status(struct ath11k_base *ab, u32 *reo_desc,\n\t\t\t\t       struct hal_reo_status *status)\n{\n\tstruct ath11k_hal *hal = &ab->hal;\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_unblock_cache_status *desc =\n\t\t(struct hal_reo_unblock_cache_status *)tlv->value;\n\n\tstatus->uniform_hdr.cmd_num =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM,\n\t\t\t\t\t  desc->hdr.info0);\n\tstatus->uniform_hdr.cmd_status =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS,\n\t\t\t\t\t  desc->hdr.info0);\n\n\tstatus->u.unblock_cache.err_detected =\n\t\t\tFIELD_GET(HAL_REO_UNBLOCK_CACHE_STATUS_INFO0_IS_ERR,\n\t\t\t\t  desc->info0);\n\tstatus->u.unblock_cache.unblock_type =\n\t\t\tFIELD_GET(HAL_REO_UNBLOCK_CACHE_STATUS_INFO0_TYPE,\n\t\t\t\t  desc->info0);\n\n\tif (!status->u.unblock_cache.err_detected &&\n\t    status->u.unblock_cache.unblock_type ==\n\t    HAL_REO_STATUS_UNBLOCK_BLOCKING_RESOURCE)\n\t\thal->avail_blk_resource &= ~BIT(hal->current_blk_index);\n}\n\nvoid ath11k_hal_reo_flush_timeout_list_status(struct ath11k_base *ab,\n\t\t\t\t\t      u32 *reo_desc,\n\t\t\t\t\t      struct hal_reo_status *status)\n{\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_flush_timeout_list_status *desc =\n\t\t(struct hal_reo_flush_timeout_list_status *)tlv->value;\n\n\tstatus->uniform_hdr.cmd_num =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM,\n\t\t\t\t\t  desc->hdr.info0);\n\tstatus->uniform_hdr.cmd_status =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS,\n\t\t\t\t\t  desc->hdr.info0);\n\n\tstatus->u.timeout_list.err_detected =\n\t\t\tFIELD_GET(HAL_REO_FLUSH_TIMEOUT_STATUS_INFO0_IS_ERR,\n\t\t\t\t  desc->info0);\n\tstatus->u.timeout_list.list_empty =\n\t\t\tFIELD_GET(HAL_REO_FLUSH_TIMEOUT_STATUS_INFO0_LIST_EMPTY,\n\t\t\t\t  desc->info0);\n\n\tstatus->u.timeout_list.release_desc_cnt =\n\t\tFIELD_GET(HAL_REO_FLUSH_TIMEOUT_STATUS_INFO1_REL_DESC_COUNT,\n\t\t\t  desc->info1);\n\tstatus->u.timeout_list.fwd_buf_cnt =\n\t\tFIELD_GET(HAL_REO_FLUSH_TIMEOUT_STATUS_INFO1_FWD_BUF_COUNT,\n\t\t\t  desc->info1);\n}\n\nvoid ath11k_hal_reo_desc_thresh_reached_status(struct ath11k_base *ab,\n\t\t\t\t\t       u32 *reo_desc,\n\t\t\t\t\t       struct hal_reo_status *status)\n{\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_desc_thresh_reached_status *desc =\n\t\t(struct hal_reo_desc_thresh_reached_status *)tlv->value;\n\n\tstatus->uniform_hdr.cmd_num =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM,\n\t\t\t\t\t  desc->hdr.info0);\n\tstatus->uniform_hdr.cmd_status =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS,\n\t\t\t\t\t  desc->hdr.info0);\n\n\tstatus->u.desc_thresh_reached.threshold_idx =\n\t\tFIELD_GET(HAL_REO_DESC_THRESH_STATUS_INFO0_THRESH_INDEX,\n\t\t\t  desc->info0);\n\n\tstatus->u.desc_thresh_reached.link_desc_counter0 =\n\t\tFIELD_GET(HAL_REO_DESC_THRESH_STATUS_INFO1_LINK_DESC_COUNTER0,\n\t\t\t  desc->info1);\n\n\tstatus->u.desc_thresh_reached.link_desc_counter1 =\n\t\tFIELD_GET(HAL_REO_DESC_THRESH_STATUS_INFO2_LINK_DESC_COUNTER1,\n\t\t\t  desc->info2);\n\n\tstatus->u.desc_thresh_reached.link_desc_counter2 =\n\t\tFIELD_GET(HAL_REO_DESC_THRESH_STATUS_INFO3_LINK_DESC_COUNTER2,\n\t\t\t  desc->info3);\n\n\tstatus->u.desc_thresh_reached.link_desc_counter_sum =\n\t\tFIELD_GET(HAL_REO_DESC_THRESH_STATUS_INFO4_LINK_DESC_COUNTER_SUM,\n\t\t\t  desc->info4);\n}\n\nvoid ath11k_hal_reo_update_rx_reo_queue_status(struct ath11k_base *ab,\n\t\t\t\t\t       u32 *reo_desc,\n\t\t\t\t\t       struct hal_reo_status *status)\n{\n\tstruct hal_tlv_hdr *tlv = (struct hal_tlv_hdr *)reo_desc;\n\tstruct hal_reo_status_hdr *desc =\n\t\t(struct hal_reo_status_hdr *)tlv->value;\n\n\tstatus->uniform_hdr.cmd_num =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_STATUS_NUM,\n\t\t\t\t\t  desc->info0);\n\tstatus->uniform_hdr.cmd_status =\n\t\t\t\tFIELD_GET(HAL_REO_STATUS_HDR_INFO0_EXEC_STATUS,\n\t\t\t\t\t  desc->info0);\n}\n\nu32 ath11k_hal_reo_qdesc_size(u32 ba_window_size, u8 tid)\n{\n\tu32 num_ext_desc;\n\n\tif (ba_window_size <= 1) {\n\t\tif (tid != HAL_DESC_REO_NON_QOS_TID)\n\t\t\tnum_ext_desc = 1;\n\t\telse\n\t\t\tnum_ext_desc = 0;\n\t} else if (ba_window_size <= 105) {\n\t\tnum_ext_desc = 1;\n\t} else if (ba_window_size <= 210) {\n\t\tnum_ext_desc = 2;\n\t} else {\n\t\tnum_ext_desc = 3;\n\t}\n\n\treturn sizeof(struct hal_rx_reo_queue) +\n\t\t(num_ext_desc * sizeof(struct hal_rx_reo_queue_ext));\n}\n\nvoid ath11k_hal_reo_qdesc_setup(void *vaddr, int tid, u32 ba_window_size,\n\t\t\t\tu32 start_seq, enum hal_pn_type type)\n{\n\tstruct hal_rx_reo_queue *qdesc = (struct hal_rx_reo_queue *)vaddr;\n\tstruct hal_rx_reo_queue_ext *ext_desc;\n\n\tmemset(qdesc, 0, sizeof(*qdesc));\n\n\tath11k_hal_reo_set_desc_hdr(&qdesc->desc_hdr, HAL_DESC_REO_OWNED,\n\t\t\t\t    HAL_DESC_REO_QUEUE_DESC,\n\t\t\t\t    REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_0);\n\n\tqdesc->rx_queue_num = FIELD_PREP(HAL_RX_REO_QUEUE_RX_QUEUE_NUMBER, tid);\n\n\tqdesc->info0 =\n\t\tFIELD_PREP(HAL_RX_REO_QUEUE_INFO0_VLD, 1) |\n\t\tFIELD_PREP(HAL_RX_REO_QUEUE_INFO0_ASSOC_LNK_DESC_COUNTER, 1) |\n\t\tFIELD_PREP(HAL_RX_REO_QUEUE_INFO0_AC, ath11k_tid_to_ac(tid));\n\n\tif (ba_window_size < 1)\n\t\tba_window_size = 1;\n\n\tif (ba_window_size == 1 && tid != HAL_DESC_REO_NON_QOS_TID)\n\t\tba_window_size++;\n\n\tif (ba_window_size == 1)\n\t\tqdesc->info0 |= FIELD_PREP(HAL_RX_REO_QUEUE_INFO0_RETRY, 1);\n\n\tqdesc->info0 |= FIELD_PREP(HAL_RX_REO_QUEUE_INFO0_BA_WINDOW_SIZE,\n\t\t\t\t   ba_window_size - 1);\n\tswitch (type) {\n\tcase HAL_PN_TYPE_NONE:\n\tcase HAL_PN_TYPE_WAPI_EVEN:\n\tcase HAL_PN_TYPE_WAPI_UNEVEN:\n\t\tbreak;\n\tcase HAL_PN_TYPE_WPA:\n\t\tqdesc->info0 |=\n\t\t\tFIELD_PREP(HAL_RX_REO_QUEUE_INFO0_PN_CHECK, 1) |\n\t\t\tFIELD_PREP(HAL_RX_REO_QUEUE_INFO0_PN_SIZE,\n\t\t\t\t   HAL_RX_REO_QUEUE_PN_SIZE_48);\n\t\tbreak;\n\t}\n\n\t \n\tqdesc->info0 |= FIELD_PREP(HAL_RX_REO_QUEUE_INFO0_IGNORE_AMPDU_FLG, 1);\n\n\tqdesc->info1 |= FIELD_PREP(HAL_RX_REO_QUEUE_INFO1_SVLD, 0);\n\n\tif (start_seq <= 0xfff)\n\t\tqdesc->info1 = FIELD_PREP(HAL_RX_REO_QUEUE_INFO1_SSN,\n\t\t\t\t\t  start_seq);\n\n\tif (tid == HAL_DESC_REO_NON_QOS_TID)\n\t\treturn;\n\n\text_desc = qdesc->ext_desc;\n\n\t \n\tmemset(ext_desc, 0, sizeof(*ext_desc));\n\tath11k_hal_reo_set_desc_hdr(&ext_desc->desc_hdr, HAL_DESC_REO_OWNED,\n\t\t\t\t    HAL_DESC_REO_QUEUE_EXT_DESC,\n\t\t\t\t    REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_1);\n\text_desc++;\n\tmemset(ext_desc, 0, sizeof(*ext_desc));\n\tath11k_hal_reo_set_desc_hdr(&ext_desc->desc_hdr, HAL_DESC_REO_OWNED,\n\t\t\t\t    HAL_DESC_REO_QUEUE_EXT_DESC,\n\t\t\t\t    REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_2);\n\text_desc++;\n\tmemset(ext_desc, 0, sizeof(*ext_desc));\n\tath11k_hal_reo_set_desc_hdr(&ext_desc->desc_hdr, HAL_DESC_REO_OWNED,\n\t\t\t\t    HAL_DESC_REO_QUEUE_EXT_DESC,\n\t\t\t\t    REO_QUEUE_DESC_MAGIC_DEBUG_PATTERN_3);\n}\n\nvoid ath11k_hal_reo_init_cmd_ring(struct ath11k_base *ab,\n\t\t\t\t  struct hal_srng *srng)\n{\n\tstruct hal_srng_params params;\n\tstruct hal_tlv_hdr *tlv;\n\tstruct hal_reo_get_queue_stats *desc;\n\tint i, cmd_num = 1;\n\tint entry_size;\n\tu8 *entry;\n\n\tmemset(&params, 0, sizeof(params));\n\n\tentry_size = ath11k_hal_srng_get_entrysize(ab, HAL_REO_CMD);\n\tath11k_hal_srng_get_params(ab, srng, &params);\n\tentry = (u8 *)params.ring_base_vaddr;\n\n\tfor (i = 0; i < params.num_entries; i++) {\n\t\ttlv = (struct hal_tlv_hdr *)entry;\n\t\tdesc = (struct hal_reo_get_queue_stats *)tlv->value;\n\t\tdesc->cmd.info0 =\n\t\t\tFIELD_PREP(HAL_REO_CMD_HDR_INFO0_CMD_NUMBER, cmd_num++);\n\t\tentry += entry_size;\n\t}\n}\n\n#define HAL_MAX_UL_MU_USERS\t37\nstatic inline void\nath11k_hal_rx_handle_ofdma_info(void *rx_tlv,\n\t\t\t\tstruct hal_rx_user_status *rx_user_status)\n{\n\tstruct hal_rx_ppdu_end_user_stats *ppdu_end_user =\n\t\t(struct hal_rx_ppdu_end_user_stats *)rx_tlv;\n\n\trx_user_status->ul_ofdma_user_v0_word0 = __le32_to_cpu(ppdu_end_user->info6);\n\n\trx_user_status->ul_ofdma_user_v0_word1 = __le32_to_cpu(ppdu_end_user->rsvd2[10]);\n}\n\nstatic inline void\nath11k_hal_rx_populate_byte_count(void *rx_tlv, void *ppduinfo,\n\t\t\t\t  struct hal_rx_user_status *rx_user_status)\n{\n\tstruct hal_rx_ppdu_end_user_stats *ppdu_end_user =\n\t\t(struct hal_rx_ppdu_end_user_stats *)rx_tlv;\n\n\trx_user_status->mpdu_ok_byte_count =\n\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_RSVD2_6_MPDU_OK_BYTE_COUNT,\n\t\t\t  __le32_to_cpu(ppdu_end_user->rsvd2[6]));\n\trx_user_status->mpdu_err_byte_count =\n\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_RSVD2_8_MPDU_ERR_BYTE_COUNT,\n\t\t\t  __le32_to_cpu(ppdu_end_user->rsvd2[8]));\n}\n\nstatic inline void\nath11k_hal_rx_populate_mu_user_info(void *rx_tlv, struct hal_rx_mon_ppdu_info *ppdu_info,\n\t\t\t\t    struct hal_rx_user_status *rx_user_status)\n{\n\trx_user_status->ast_index = ppdu_info->ast_index;\n\trx_user_status->tid = ppdu_info->tid;\n\trx_user_status->tcp_msdu_count =\n\t\tppdu_info->tcp_msdu_count;\n\trx_user_status->udp_msdu_count =\n\t\tppdu_info->udp_msdu_count;\n\trx_user_status->other_msdu_count =\n\t\tppdu_info->other_msdu_count;\n\trx_user_status->frame_control = ppdu_info->frame_control;\n\trx_user_status->frame_control_info_valid =\n\t\tppdu_info->frame_control_info_valid;\n\trx_user_status->data_sequence_control_info_valid =\n\t\tppdu_info->data_sequence_control_info_valid;\n\trx_user_status->first_data_seq_ctrl =\n\t\tppdu_info->first_data_seq_ctrl;\n\trx_user_status->preamble_type = ppdu_info->preamble_type;\n\trx_user_status->ht_flags = ppdu_info->ht_flags;\n\trx_user_status->vht_flags = ppdu_info->vht_flags;\n\trx_user_status->he_flags = ppdu_info->he_flags;\n\trx_user_status->rs_flags = ppdu_info->rs_flags;\n\n\trx_user_status->mpdu_cnt_fcs_ok =\n\t\tppdu_info->num_mpdu_fcs_ok;\n\trx_user_status->mpdu_cnt_fcs_err =\n\t\tppdu_info->num_mpdu_fcs_err;\n\n\tath11k_hal_rx_populate_byte_count(rx_tlv, ppdu_info, rx_user_status);\n}\n\nstatic u16 ath11k_hal_rx_mpduinfo_get_peerid(struct ath11k_base *ab,\n\t\t\t\t\t     struct hal_rx_mpdu_info *mpdu_info)\n{\n\treturn ab->hw_params.hw_ops->mpdu_info_get_peerid(mpdu_info);\n}\n\nstatic enum hal_rx_mon_status\nath11k_hal_rx_parse_mon_status_tlv(struct ath11k_base *ab,\n\t\t\t\t   struct hal_rx_mon_ppdu_info *ppdu_info,\n\t\t\t\t   u32 tlv_tag, u8 *tlv_data, u32 userid)\n{\n\tu32 info0, info1, value;\n\tu8 he_dcm = 0, he_stbc = 0;\n\tu16 he_gi = 0, he_ltf = 0;\n\n\tswitch (tlv_tag) {\n\tcase HAL_RX_PPDU_START: {\n\t\tstruct hal_rx_ppdu_start *ppdu_start =\n\t\t\t(struct hal_rx_ppdu_start *)tlv_data;\n\n\t\tppdu_info->ppdu_id =\n\t\t\tFIELD_GET(HAL_RX_PPDU_START_INFO0_PPDU_ID,\n\t\t\t\t  __le32_to_cpu(ppdu_start->info0));\n\t\tppdu_info->chan_num = __le32_to_cpu(ppdu_start->chan_num);\n\t\tppdu_info->ppdu_ts = __le32_to_cpu(ppdu_start->ppdu_start_ts);\n\t\tbreak;\n\t}\n\tcase HAL_RX_PPDU_END_USER_STATS: {\n\t\tstruct hal_rx_ppdu_end_user_stats *eu_stats =\n\t\t\t(struct hal_rx_ppdu_end_user_stats *)tlv_data;\n\n\t\tinfo0 = __le32_to_cpu(eu_stats->info0);\n\t\tinfo1 = __le32_to_cpu(eu_stats->info1);\n\n\t\tppdu_info->ast_index =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO2_AST_INDEX,\n\t\t\t\t  __le32_to_cpu(eu_stats->info2));\n\t\tppdu_info->tid =\n\t\t\tffs(FIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO6_TID_BITMAP,\n\t\t\t\t      __le32_to_cpu(eu_stats->info6))) - 1;\n\t\tppdu_info->tcp_msdu_count =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO4_TCP_MSDU_CNT,\n\t\t\t\t  __le32_to_cpu(eu_stats->info4));\n\t\tppdu_info->udp_msdu_count =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO4_UDP_MSDU_CNT,\n\t\t\t\t  __le32_to_cpu(eu_stats->info4));\n\t\tppdu_info->other_msdu_count =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO5_OTHER_MSDU_CNT,\n\t\t\t\t  __le32_to_cpu(eu_stats->info5));\n\t\tppdu_info->tcp_ack_msdu_count =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO5_TCP_ACK_MSDU_CNT,\n\t\t\t\t  __le32_to_cpu(eu_stats->info5));\n\t\tppdu_info->preamble_type =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO1_PKT_TYPE, info1);\n\t\tppdu_info->num_mpdu_fcs_ok =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO1_MPDU_CNT_FCS_OK,\n\t\t\t\t  info1);\n\t\tppdu_info->num_mpdu_fcs_err =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_USER_STATS_INFO0_MPDU_CNT_FCS_ERR,\n\t\t\t\t  info0);\n\t\tswitch (ppdu_info->preamble_type) {\n\t\tcase HAL_RX_PREAMBLE_11N:\n\t\t\tppdu_info->ht_flags = 1;\n\t\t\tbreak;\n\t\tcase HAL_RX_PREAMBLE_11AC:\n\t\t\tppdu_info->vht_flags = 1;\n\t\t\tbreak;\n\t\tcase HAL_RX_PREAMBLE_11AX:\n\t\t\tppdu_info->he_flags = 1;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\n\t\tif (userid < HAL_MAX_UL_MU_USERS) {\n\t\t\tstruct hal_rx_user_status *rxuser_stats =\n\t\t\t\t&ppdu_info->userstats;\n\n\t\t\tath11k_hal_rx_handle_ofdma_info(tlv_data, rxuser_stats);\n\t\t\tath11k_hal_rx_populate_mu_user_info(tlv_data, ppdu_info,\n\t\t\t\t\t\t\t    rxuser_stats);\n\t\t}\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[0] =\n\t\t\t\t\t__le32_to_cpu(eu_stats->rsvd1[0]);\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[1] =\n\t\t\t\t\t__le32_to_cpu(eu_stats->rsvd1[1]);\n\n\t\tbreak;\n\t}\n\tcase HAL_RX_PPDU_END_USER_STATS_EXT: {\n\t\tstruct hal_rx_ppdu_end_user_stats_ext *eu_stats =\n\t\t\t(struct hal_rx_ppdu_end_user_stats_ext *)tlv_data;\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[2] = eu_stats->info1;\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[3] = eu_stats->info2;\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[4] = eu_stats->info3;\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[5] = eu_stats->info4;\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[6] = eu_stats->info5;\n\t\tppdu_info->userstats.mpdu_fcs_ok_bitmap[7] = eu_stats->info6;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_HT_SIG: {\n\t\tstruct hal_rx_ht_sig_info *ht_sig =\n\t\t\t(struct hal_rx_ht_sig_info *)tlv_data;\n\n\t\tinfo0 = __le32_to_cpu(ht_sig->info0);\n\t\tinfo1 = __le32_to_cpu(ht_sig->info1);\n\n\t\tppdu_info->mcs = FIELD_GET(HAL_RX_HT_SIG_INFO_INFO0_MCS, info0);\n\t\tppdu_info->bw = FIELD_GET(HAL_RX_HT_SIG_INFO_INFO0_BW, info0);\n\t\tppdu_info->is_stbc = FIELD_GET(HAL_RX_HT_SIG_INFO_INFO1_STBC,\n\t\t\t\t\t       info1);\n\t\tppdu_info->ldpc = FIELD_GET(HAL_RX_HT_SIG_INFO_INFO1_FEC_CODING, info1);\n\t\tppdu_info->gi = info1 & HAL_RX_HT_SIG_INFO_INFO1_GI;\n\n\t\tswitch (ppdu_info->mcs) {\n\t\tcase 0 ... 7:\n\t\t\tppdu_info->nss = 1;\n\t\t\tbreak;\n\t\tcase 8 ... 15:\n\t\t\tppdu_info->nss = 2;\n\t\t\tbreak;\n\t\tcase 16 ... 23:\n\t\t\tppdu_info->nss = 3;\n\t\t\tbreak;\n\t\tcase 24 ... 31:\n\t\t\tppdu_info->nss = 4;\n\t\t\tbreak;\n\t\t}\n\n\t\tif (ppdu_info->nss > 1)\n\t\t\tppdu_info->mcs = ppdu_info->mcs % 8;\n\n\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_SU;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_L_SIG_B: {\n\t\tstruct hal_rx_lsig_b_info *lsigb =\n\t\t\t(struct hal_rx_lsig_b_info *)tlv_data;\n\n\t\tppdu_info->rate = FIELD_GET(HAL_RX_LSIG_B_INFO_INFO0_RATE,\n\t\t\t\t\t    __le32_to_cpu(lsigb->info0));\n\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_SU;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_L_SIG_A: {\n\t\tstruct hal_rx_lsig_a_info *lsiga =\n\t\t\t(struct hal_rx_lsig_a_info *)tlv_data;\n\n\t\tppdu_info->rate = FIELD_GET(HAL_RX_LSIG_A_INFO_INFO0_RATE,\n\t\t\t\t\t    __le32_to_cpu(lsiga->info0));\n\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_SU;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_VHT_SIG_A: {\n\t\tstruct hal_rx_vht_sig_a_info *vht_sig =\n\t\t\t(struct hal_rx_vht_sig_a_info *)tlv_data;\n\t\tu32 nsts;\n\t\tu32 group_id;\n\t\tu8 gi_setting;\n\n\t\tinfo0 = __le32_to_cpu(vht_sig->info0);\n\t\tinfo1 = __le32_to_cpu(vht_sig->info1);\n\n\t\tppdu_info->ldpc = FIELD_GET(HAL_RX_VHT_SIG_A_INFO_INFO1_SU_MU_CODING,\n\t\t\t\t\t    info1);\n\t\tppdu_info->mcs = FIELD_GET(HAL_RX_VHT_SIG_A_INFO_INFO1_MCS,\n\t\t\t\t\t   info1);\n\t\tgi_setting = FIELD_GET(HAL_RX_VHT_SIG_A_INFO_INFO1_GI_SETTING,\n\t\t\t\t       info1);\n\t\tswitch (gi_setting) {\n\t\tcase HAL_RX_VHT_SIG_A_NORMAL_GI:\n\t\t\tppdu_info->gi = HAL_RX_GI_0_8_US;\n\t\t\tbreak;\n\t\tcase HAL_RX_VHT_SIG_A_SHORT_GI:\n\t\tcase HAL_RX_VHT_SIG_A_SHORT_GI_AMBIGUITY:\n\t\t\tppdu_info->gi = HAL_RX_GI_0_4_US;\n\t\t\tbreak;\n\t\t}\n\n\t\tppdu_info->is_stbc = info0 & HAL_RX_VHT_SIG_A_INFO_INFO0_STBC;\n\t\tnsts = FIELD_GET(HAL_RX_VHT_SIG_A_INFO_INFO0_NSTS, info0);\n\t\tif (ppdu_info->is_stbc && nsts > 0)\n\t\t\tnsts = ((nsts + 1) >> 1) - 1;\n\n\t\tppdu_info->nss = (nsts & VHT_SIG_SU_NSS_MASK) + 1;\n\t\tppdu_info->bw = FIELD_GET(HAL_RX_VHT_SIG_A_INFO_INFO0_BW,\n\t\t\t\t\t  info0);\n\t\tppdu_info->beamformed = info1 &\n\t\t\t\t\tHAL_RX_VHT_SIG_A_INFO_INFO1_BEAMFORMED;\n\t\tgroup_id = FIELD_GET(HAL_RX_VHT_SIG_A_INFO_INFO0_GROUP_ID,\n\t\t\t\t     info0);\n\t\tif (group_id == 0 || group_id == 63)\n\t\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_SU;\n\t\telse\n\t\t\tppdu_info->reception_type =\n\t\t\t\tHAL_RX_RECEPTION_TYPE_MU_MIMO;\n\t\tppdu_info->vht_flag_values5 = group_id;\n\t\tppdu_info->vht_flag_values3[0] = (((ppdu_info->mcs) << 4) |\n\t\t\t\t\t\t   ppdu_info->nss);\n\t\tppdu_info->vht_flag_values2 = ppdu_info->bw;\n\t\tppdu_info->vht_flag_values4 =\n\t\t\tFIELD_GET(HAL_RX_VHT_SIG_A_INFO_INFO1_SU_MU_CODING, info1);\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_HE_SIG_A_SU: {\n\t\tstruct hal_rx_he_sig_a_su_info *he_sig_a =\n\t\t\t(struct hal_rx_he_sig_a_su_info *)tlv_data;\n\n\t\tppdu_info->he_flags = 1;\n\t\tinfo0 = __le32_to_cpu(he_sig_a->info0);\n\t\tinfo1 = __le32_to_cpu(he_sig_a->info1);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_FORMAT_IND, info0);\n\n\t\tif (value == 0)\n\t\t\tppdu_info->he_data1 = IEEE80211_RADIOTAP_HE_DATA1_FORMAT_TRIG;\n\t\telse\n\t\t\tppdu_info->he_data1 = IEEE80211_RADIOTAP_HE_DATA1_FORMAT_SU;\n\n\t\tppdu_info->he_data1 |=\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_BSS_COLOR_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_BEAM_CHANGE_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_UL_DL_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_DATA_MCS_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_DATA_DCM_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_CODING_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_LDPC_XSYMSEG_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_STBC_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_BW_RU_ALLOC_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_DOPPLER_KNOWN;\n\n\t\tppdu_info->he_data2 |=\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_GI_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_TXBF_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_PE_DISAMBIG_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_TXOP_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_NUM_LTF_SYMS_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_PRE_FEC_PAD_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_MIDAMBLE_KNOWN;\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_BSS_COLOR, info0);\n\t\tppdu_info->he_data3 =\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_BSS_COLOR, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_BEAM_CHANGE, info0);\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_BEAM_CHANGE, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_DL_UL_FLAG, info0);\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_UL_DL, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_TRANSMIT_MCS, info0);\n\t\tppdu_info->mcs = value;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_DATA_MCS, value);\n\n\t\the_dcm = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_DCM, info0);\n\t\tppdu_info->dcm = he_dcm;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_DATA_DCM, he_dcm);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_CODING, info1);\n\t\tppdu_info->ldpc = (value == HAL_RX_SU_MU_CODING_LDPC) ? 1 : 0;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_CODING, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_LDPC_EXTRA, info1);\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_LDPC_XSYMSEG, value);\n\t\the_stbc = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_STBC, info1);\n\t\tppdu_info->is_stbc = he_stbc;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_STBC, he_stbc);\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_SPATIAL_REUSE, info0);\n\t\tppdu_info->he_data4 =\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA4_SU_MU_SPTL_REUSE, value);\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_TRANSMIT_BW, info0);\n\t\tppdu_info->bw = value;\n\t\tppdu_info->he_data5 =\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_CP_LTF_SIZE, info0);\n\t\tswitch (value) {\n\t\tcase 0:\n\t\t\t\the_gi = HE_GI_0_8;\n\t\t\t\the_ltf = HE_LTF_1_X;\n\t\t\t\tbreak;\n\t\tcase 1:\n\t\t\t\the_gi = HE_GI_0_8;\n\t\t\t\the_ltf = HE_LTF_2_X;\n\t\t\t\tbreak;\n\t\tcase 2:\n\t\t\t\the_gi = HE_GI_1_6;\n\t\t\t\the_ltf = HE_LTF_2_X;\n\t\t\t\tbreak;\n\t\tcase 3:\n\t\t\t\tif (he_dcm && he_stbc) {\n\t\t\t\t\the_gi = HE_GI_0_8;\n\t\t\t\t\the_ltf = HE_LTF_4_X;\n\t\t\t\t} else {\n\t\t\t\t\the_gi = HE_GI_3_2;\n\t\t\t\t\the_ltf = HE_LTF_4_X;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tppdu_info->gi = he_gi;\n\t\the_gi = (he_gi != 0) ? he_gi - 1 : 0;\n\t\tppdu_info->he_data5 |= FIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_GI, he_gi);\n\t\tppdu_info->ltf_size = he_ltf;\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE,\n\t\t\t\t   (he_ltf == HE_LTF_4_X) ? he_ltf - 1 : he_ltf);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_NSTS, info0);\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_NUM_LTF_SYMS, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_PKT_EXT_FACTOR, info1);\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_PRE_FEC_PAD, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_TXBF, info1);\n\t\tppdu_info->beamformed = value;\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_TXBF, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_PKT_EXT_PE_DISAM, info1);\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_PE_DISAMBIG, value);\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO0_NSTS, info0);\n\t\tvalue++;\n\t\tppdu_info->nss = value;\n\t\tppdu_info->he_data6 =\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA6_NSTS, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_DOPPLER_IND, info1);\n\t\tppdu_info->he_data6 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA6_DOPPLER, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_SU_INFO_INFO1_TXOP_DURATION, info1);\n\t\tppdu_info->he_data6 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA6_TXOP, value);\n\n\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_SU;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_HE_SIG_A_MU_DL: {\n\t\tstruct hal_rx_he_sig_a_mu_dl_info *he_sig_a_mu_dl =\n\t\t\t(struct hal_rx_he_sig_a_mu_dl_info *)tlv_data;\n\n\t\tinfo0 = __le32_to_cpu(he_sig_a_mu_dl->info0);\n\t\tinfo1 = __le32_to_cpu(he_sig_a_mu_dl->info1);\n\n\t\tppdu_info->he_mu_flags = 1;\n\n\t\tppdu_info->he_data1 = IEEE80211_RADIOTAP_HE_DATA1_FORMAT_MU;\n\t\tppdu_info->he_data1 |=\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_BSS_COLOR_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_UL_DL_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_LDPC_XSYMSEG_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_STBC_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_BW_RU_ALLOC_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_DOPPLER_KNOWN;\n\n\t\tppdu_info->he_data2 =\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_GI_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_NUM_LTF_SYMS_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_PRE_FEC_PAD_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_PE_DISAMBIG_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_TXOP_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA2_MIDAMBLE_KNOWN;\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_BSS_COLOR, info0);\n\t\tppdu_info->he_data3 =\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_BSS_COLOR, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_UL_FLAG, info0);\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_UL_DL, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO1_LDPC_EXTRA, info1);\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_LDPC_XSYMSEG, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO1_STBC, info1);\n\t\the_stbc = value;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_STBC, value);\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_SPATIAL_REUSE, info0);\n\t\tppdu_info->he_data4 =\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA4_SU_MU_SPTL_REUSE, value);\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_TRANSMIT_BW, info0);\n\t\tppdu_info->bw = value;\n\t\tppdu_info->he_data5 =\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_DATA_BW_RU_ALLOC, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_CP_LTF_SIZE, info0);\n\t\tswitch (value) {\n\t\tcase 0:\n\t\t\the_gi = HE_GI_0_8;\n\t\t\the_ltf = HE_LTF_4_X;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\the_gi = HE_GI_0_8;\n\t\t\the_ltf = HE_LTF_2_X;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\the_gi = HE_GI_1_6;\n\t\t\the_ltf = HE_LTF_2_X;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\the_gi = HE_GI_3_2;\n\t\t\the_ltf = HE_LTF_4_X;\n\t\t\tbreak;\n\t\t}\n\t\tppdu_info->gi = he_gi;\n\t\the_gi = (he_gi != 0) ? he_gi - 1 : 0;\n\t\tppdu_info->he_data5 |= FIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_GI, he_gi);\n\t\tppdu_info->ltf_size = he_ltf;\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_LTF_SIZE,\n\t\t\t\t   (he_ltf == HE_LTF_4_X) ? he_ltf - 1 : he_ltf);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO1_NUM_LTF_SYMB, info1);\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_NUM_LTF_SYMS, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO1_PKT_EXT_FACTOR,\n\t\t\t\t  info1);\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_PRE_FEC_PAD, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO1_PKT_EXT_PE_DISAM,\n\t\t\t\t  info1);\n\t\tppdu_info->he_data5 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA5_PE_DISAMBIG, value);\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_DOPPLER_INDICATION,\n\t\t\t\t  info0);\n\t\tppdu_info->he_data6 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA6_DOPPLER, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO1_TXOP_DURATION, info1);\n\t\tppdu_info->he_data6 |=\n\t\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA6_TXOP, value);\n\n\t\t \n\t\t \n\t\tppdu_info->he_flags1 =\n\t\t\tIEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_MCS_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_DCM_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_COMP_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_SYMS_USERS_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_MU_FLAGS1_CH1_RU_KNOWN;\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_MCS_OF_SIGB, info0);\n\t\tppdu_info->he_flags1 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_MCS_KNOWN,\n\t\t\t\t   value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_DCM_OF_SIGB, info0);\n\t\tppdu_info->he_flags1 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_MU_FLAGS1_SIG_B_DCM_KNOWN,\n\t\t\t\t   value);\n\n\t\t \n\t\tppdu_info->he_flags2 =\n\t\t\tIEEE80211_RADIOTAP_HE_MU_FLAGS2_BW_FROM_SIG_A_BW_KNOWN;\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_TRANSMIT_BW, info0);\n\t\tppdu_info->he_flags2 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_MU_FLAGS2_BW_FROM_SIG_A_BW,\n\t\t\t\t   value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_COMP_MODE_SIGB, info0);\n\t\tppdu_info->he_flags2 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_MU_FLAGS2_SIG_B_COMP, value);\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_A_MU_DL_INFO_INFO0_NUM_SIGB_SYMB, info0);\n\t\tvalue = value - 1;\n\t\tppdu_info->he_flags2 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_MU_FLAGS2_SIG_B_SYMS_USERS,\n\t\t\t\t   value);\n\n\t\tppdu_info->is_stbc = info1 &\n\t\t\t\t     HAL_RX_HE_SIG_A_MU_DL_INFO_INFO1_STBC;\n\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_MU_MIMO;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_HE_SIG_B1_MU: {\n\t\tstruct hal_rx_he_sig_b1_mu_info *he_sig_b1_mu =\n\t\t\t(struct hal_rx_he_sig_b1_mu_info *)tlv_data;\n\t\tu16 ru_tones;\n\n\t\tinfo0 = __le32_to_cpu(he_sig_b1_mu->info0);\n\n\t\tru_tones = FIELD_GET(HAL_RX_HE_SIG_B1_MU_INFO_INFO0_RU_ALLOCATION,\n\t\t\t\t     info0);\n\t\tppdu_info->ru_alloc =\n\t\t\tath11k_mac_phy_he_ru_to_nl80211_he_ru_alloc(ru_tones);\n\t\tppdu_info->he_RU[0] = ru_tones;\n\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_MU_MIMO;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_HE_SIG_B2_MU: {\n\t\tstruct hal_rx_he_sig_b2_mu_info *he_sig_b2_mu =\n\t\t\t(struct hal_rx_he_sig_b2_mu_info *)tlv_data;\n\n\t\tinfo0 = __le32_to_cpu(he_sig_b2_mu->info0);\n\n\t\tppdu_info->he_data1 |= IEEE80211_RADIOTAP_HE_DATA1_DATA_MCS_KNOWN |\n\t\t\t\t       IEEE80211_RADIOTAP_HE_DATA1_CODING_KNOWN;\n\n\t\tppdu_info->mcs =\n\t\t\tFIELD_GET(HAL_RX_HE_SIG_B2_MU_INFO_INFO0_STA_MCS, info0);\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_DATA_MCS, ppdu_info->mcs);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_B2_MU_INFO_INFO0_STA_CODING, info0);\n\t\tppdu_info->ldpc = value;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_CODING, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_B2_MU_INFO_INFO0_STA_ID, info0);\n\t\tppdu_info->he_data4 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA4_MU_STA_ID, value);\n\n\t\tppdu_info->nss =\n\t\t\tFIELD_GET(HAL_RX_HE_SIG_B2_MU_INFO_INFO0_STA_NSTS, info0) + 1;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_HE_SIG_B2_OFDMA: {\n\t\tstruct hal_rx_he_sig_b2_ofdma_info *he_sig_b2_ofdma =\n\t\t\t(struct hal_rx_he_sig_b2_ofdma_info *)tlv_data;\n\n\t\tinfo0 = __le32_to_cpu(he_sig_b2_ofdma->info0);\n\n\t\tppdu_info->he_data1 |=\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_DATA_MCS_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_DATA_DCM_KNOWN |\n\t\t\tIEEE80211_RADIOTAP_HE_DATA1_CODING_KNOWN;\n\n\t\t \n\t\tppdu_info->he_data2 |= IEEE80211_RADIOTAP_HE_DATA2_TXBF_KNOWN;\n\n\t\tppdu_info->mcs =\n\t\t\tFIELD_GET(HAL_RX_HE_SIG_B2_OFDMA_INFO_INFO0_STA_MCS,\n\t\t\t\t  info0);\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_DATA_MCS, ppdu_info->mcs);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_B2_OFDMA_INFO_INFO0_STA_DCM, info0);\n\t\the_dcm = value;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_DATA_DCM, value);\n\n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_B2_OFDMA_INFO_INFO0_STA_CODING, info0);\n\t\tppdu_info->ldpc = value;\n\t\tppdu_info->he_data3 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA3_CODING, value);\n\n\t\t \n\t\tvalue = FIELD_GET(HAL_RX_HE_SIG_B2_OFDMA_INFO_INFO0_STA_ID, info0);\n\t\tppdu_info->he_data4 |=\n\t\t\tFIELD_PREP(IEEE80211_RADIOTAP_HE_DATA4_MU_STA_ID, value);\n\n\t\tppdu_info->nss =\n\t\t\tFIELD_GET(HAL_RX_HE_SIG_B2_OFDMA_INFO_INFO0_STA_NSTS,\n\t\t\t\t  info0) + 1;\n\t\tppdu_info->beamformed =\n\t\t\tinfo0 & HAL_RX_HE_SIG_B2_OFDMA_INFO_INFO0_STA_TXBF;\n\t\tppdu_info->reception_type = HAL_RX_RECEPTION_TYPE_MU_OFDMA;\n\t\tbreak;\n\t}\n\tcase HAL_PHYRX_RSSI_LEGACY: {\n\t\tint i;\n\t\tbool db2dbm = test_bit(WMI_TLV_SERVICE_HW_DB2DBM_CONVERSION_SUPPORT,\n\t\t\t\t       ab->wmi_ab.svc_map);\n\t\tstruct hal_rx_phyrx_rssi_legacy_info *rssi =\n\t\t\t(struct hal_rx_phyrx_rssi_legacy_info *)tlv_data;\n\n\t\t \n\t\tppdu_info->rssi_comb =\n\t\t\tFIELD_GET(HAL_RX_PHYRX_RSSI_LEGACY_INFO_INFO0_RSSI_COMB,\n\t\t\t\t  __le32_to_cpu(rssi->info0));\n\n\t\tif (db2dbm) {\n\t\t\tfor (i = 0; i < ARRAY_SIZE(rssi->preamble); i++) {\n\t\t\t\tppdu_info->rssi_chain_pri20[i] =\n\t\t\t\t\tle32_get_bits(rssi->preamble[i].rssi_2040,\n\t\t\t\t\t\t      HAL_RX_PHYRX_RSSI_PREAMBLE_PRI20);\n\t\t\t}\n\t\t}\n\t\tbreak;\n\t}\n\tcase HAL_RX_MPDU_START: {\n\t\tstruct hal_rx_mpdu_info *mpdu_info =\n\t\t\t\t(struct hal_rx_mpdu_info *)tlv_data;\n\t\tu16 peer_id;\n\n\t\tpeer_id = ath11k_hal_rx_mpduinfo_get_peerid(ab, mpdu_info);\n\t\tif (peer_id)\n\t\t\tppdu_info->peer_id = peer_id;\n\t\tbreak;\n\t}\n\tcase HAL_RXPCU_PPDU_END_INFO: {\n\t\tstruct hal_rx_ppdu_end_duration *ppdu_rx_duration =\n\t\t\t(struct hal_rx_ppdu_end_duration *)tlv_data;\n\t\tppdu_info->rx_duration =\n\t\t\tFIELD_GET(HAL_RX_PPDU_END_DURATION,\n\t\t\t\t  __le32_to_cpu(ppdu_rx_duration->info0));\n\t\tppdu_info->tsft = __le32_to_cpu(ppdu_rx_duration->rsvd0[1]);\n\t\tppdu_info->tsft = (ppdu_info->tsft << 32) |\n\t\t\t\t\t__le32_to_cpu(ppdu_rx_duration->rsvd0[0]);\n\t\tbreak;\n\t}\n\tcase HAL_DUMMY:\n\t\treturn HAL_RX_MON_STATUS_BUF_DONE;\n\tcase HAL_RX_PPDU_END_STATUS_DONE:\n\tcase 0:\n\t\treturn HAL_RX_MON_STATUS_PPDU_DONE;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn HAL_RX_MON_STATUS_PPDU_NOT_DONE;\n}\n\nenum hal_rx_mon_status\nath11k_hal_rx_parse_mon_status(struct ath11k_base *ab,\n\t\t\t       struct hal_rx_mon_ppdu_info *ppdu_info,\n\t\t\t       struct sk_buff *skb)\n{\n\tstruct hal_tlv_hdr *tlv;\n\tenum hal_rx_mon_status hal_status = HAL_RX_MON_STATUS_BUF_DONE;\n\tu16 tlv_tag;\n\tu16 tlv_len;\n\tu32 tlv_userid = 0;\n\tu8 *ptr = skb->data;\n\n\tdo {\n\t\ttlv = (struct hal_tlv_hdr *)ptr;\n\t\ttlv_tag = FIELD_GET(HAL_TLV_HDR_TAG, tlv->tl);\n\t\ttlv_len = FIELD_GET(HAL_TLV_HDR_LEN, tlv->tl);\n\t\ttlv_userid = FIELD_GET(HAL_TLV_USR_ID, tlv->tl);\n\t\tptr += sizeof(*tlv);\n\n\t\t \n\t\tif (tlv_tag == HAL_RX_PPDU_END)\n\t\t\ttlv_len = sizeof(struct hal_rx_rxpcu_classification_overview);\n\n\t\thal_status = ath11k_hal_rx_parse_mon_status_tlv(ab, ppdu_info,\n\t\t\t\t\t\t\t\ttlv_tag, ptr, tlv_userid);\n\t\tptr += tlv_len;\n\t\tptr = PTR_ALIGN(ptr, HAL_TLV_ALIGN);\n\n\t\tif ((ptr - skb->data) >= DP_RX_BUFFER_SIZE)\n\t\t\tbreak;\n\t} while (hal_status == HAL_RX_MON_STATUS_PPDU_NOT_DONE);\n\n\treturn hal_status;\n}\n\nvoid ath11k_hal_rx_reo_ent_buf_paddr_get(void *rx_desc, dma_addr_t *paddr,\n\t\t\t\t\t u32 *sw_cookie, void **pp_buf_addr,\n\t\t\t\t\t u8 *rbm, u32 *msdu_cnt)\n{\n\tstruct hal_reo_entrance_ring *reo_ent_ring =\n\t\t(struct hal_reo_entrance_ring *)rx_desc;\n\tstruct ath11k_buffer_addr *buf_addr_info;\n\tstruct rx_mpdu_desc *rx_mpdu_desc_info_details;\n\n\trx_mpdu_desc_info_details =\n\t\t\t(struct rx_mpdu_desc *)&reo_ent_ring->rx_mpdu_info;\n\n\t*msdu_cnt = FIELD_GET(RX_MPDU_DESC_INFO0_MSDU_COUNT,\n\t\t\t      rx_mpdu_desc_info_details->info0);\n\n\tbuf_addr_info = (struct ath11k_buffer_addr *)&reo_ent_ring->buf_addr_info;\n\n\t*paddr = (((u64)FIELD_GET(BUFFER_ADDR_INFO1_ADDR,\n\t\t\t\t  buf_addr_info->info1)) << 32) |\n\t\t\tFIELD_GET(BUFFER_ADDR_INFO0_ADDR,\n\t\t\t\t  buf_addr_info->info0);\n\n\t*sw_cookie = FIELD_GET(BUFFER_ADDR_INFO1_SW_COOKIE,\n\t\t\t       buf_addr_info->info1);\n\t*rbm = FIELD_GET(BUFFER_ADDR_INFO1_RET_BUF_MGR,\n\t\t\t buf_addr_info->info1);\n\n\t*pp_buf_addr = (void *)buf_addr_info;\n}\n\nvoid\nath11k_hal_rx_sw_mon_ring_buf_paddr_get(void *rx_desc,\n\t\t\t\t\tstruct hal_sw_mon_ring_entries *sw_mon_entries)\n{\n\tstruct hal_sw_monitor_ring *sw_mon_ring = rx_desc;\n\tstruct ath11k_buffer_addr *buf_addr_info;\n\tstruct ath11k_buffer_addr *status_buf_addr_info;\n\tstruct rx_mpdu_desc *rx_mpdu_desc_info_details;\n\n\trx_mpdu_desc_info_details = &sw_mon_ring->rx_mpdu_info;\n\n\tsw_mon_entries->msdu_cnt = FIELD_GET(RX_MPDU_DESC_INFO0_MSDU_COUNT,\n\t\t\t\t\t     rx_mpdu_desc_info_details->info0);\n\n\tbuf_addr_info = &sw_mon_ring->buf_addr_info;\n\tstatus_buf_addr_info = &sw_mon_ring->status_buf_addr_info;\n\n\tsw_mon_entries->mon_dst_paddr = (((u64)FIELD_GET(BUFFER_ADDR_INFO1_ADDR,\n\t\t\t\t\tbuf_addr_info->info1)) << 32) |\n\t\t\t\t\tFIELD_GET(BUFFER_ADDR_INFO0_ADDR,\n\t\t\t\t\t\t  buf_addr_info->info0);\n\n\tsw_mon_entries->mon_status_paddr =\n\t\t\t(((u64)FIELD_GET(BUFFER_ADDR_INFO1_ADDR,\n\t\t\t\t\t status_buf_addr_info->info1)) << 32) |\n\t\t\t\tFIELD_GET(BUFFER_ADDR_INFO0_ADDR,\n\t\t\t\t\t  status_buf_addr_info->info0);\n\n\tsw_mon_entries->mon_dst_sw_cookie = FIELD_GET(BUFFER_ADDR_INFO1_SW_COOKIE,\n\t\t\t\t\t\t      buf_addr_info->info1);\n\n\tsw_mon_entries->mon_status_sw_cookie = FIELD_GET(BUFFER_ADDR_INFO1_SW_COOKIE,\n\t\t\t\t\t\t\t status_buf_addr_info->info1);\n\n\tsw_mon_entries->status_buf_count = FIELD_GET(HAL_SW_MON_RING_INFO0_STATUS_BUF_CNT,\n\t\t\t\t\t\t     sw_mon_ring->info0);\n\n\tsw_mon_entries->dst_buf_addr_info = buf_addr_info;\n\tsw_mon_entries->status_buf_addr_info = status_buf_addr_info;\n\n\tsw_mon_entries->ppdu_id =\n\t\tFIELD_GET(HAL_SW_MON_RING_INFO1_PHY_PPDU_ID, sw_mon_ring->info1);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}