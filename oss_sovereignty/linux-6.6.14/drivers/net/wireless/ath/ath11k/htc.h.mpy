{
  "module_name": "htc.h",
  "hash_id": "2b48e41188dc46cd7baf86cb5ee103d7a85099a5fecc65da36a544c999cc4c2e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath11k/htc.h",
  "human_readable_source": " \n \n\n#ifndef ATH11K_HTC_H\n#define ATH11K_HTC_H\n\n#include <linux/kernel.h>\n#include <linux/list.h>\n#include <linux/bug.h>\n#include <linux/skbuff.h>\n#include <linux/timer.h>\n\nstruct ath11k_base;\n\n#define HTC_HDR_ENDPOINTID                       GENMASK(7, 0)\n#define HTC_HDR_FLAGS                            GENMASK(15, 8)\n#define HTC_HDR_PAYLOADLEN                       GENMASK(31, 16)\n#define HTC_HDR_CONTROLBYTES0                    GENMASK(7, 0)\n#define HTC_HDR_CONTROLBYTES1                    GENMASK(15, 8)\n#define HTC_HDR_RESERVED                         GENMASK(31, 16)\n\n#define HTC_SVC_MSG_SERVICE_ID                   GENMASK(31, 16)\n#define HTC_SVC_MSG_CONNECTIONFLAGS              GENMASK(15, 0)\n#define HTC_SVC_MSG_SERVICEMETALENGTH            GENMASK(23, 16)\n#define HTC_READY_MSG_CREDITCOUNT                GENMASK(31, 16)\n#define HTC_READY_MSG_CREDITSIZE                 GENMASK(15, 0)\n#define HTC_READY_MSG_MAXENDPOINTS               GENMASK(23, 16)\n\n#define HTC_READY_EX_MSG_HTCVERSION              GENMASK(7, 0)\n#define HTC_READY_EX_MSG_MAXMSGSPERHTCBUNDLE     GENMASK(15, 8)\n\n#define HTC_SVC_RESP_MSG_SERVICEID           GENMASK(31, 16)\n#define HTC_SVC_RESP_MSG_STATUS              GENMASK(7, 0)\n#define HTC_SVC_RESP_MSG_ENDPOINTID          GENMASK(15, 8)\n#define HTC_SVC_RESP_MSG_MAXMSGSIZE          GENMASK(31, 16)\n#define HTC_SVC_RESP_MSG_SERVICEMETALENGTH   GENMASK(7, 0)\n\n#define HTC_MSG_MESSAGEID                        GENMASK(15, 0)\n#define HTC_SETUP_COMPLETE_EX_MSG_SETUPFLAGS     GENMASK(31, 0)\n#define HTC_SETUP_COMPLETE_EX_MSG_MAXMSGSPERBUNDLEDRECV      GENMASK(7, 0)\n#define HTC_SETUP_COMPLETE_EX_MSG_RSVD0          GENMASK(15, 8)\n#define HTC_SETUP_COMPLETE_EX_MSG_RSVD1          GENMASK(23, 16)\n#define HTC_SETUP_COMPLETE_EX_MSG_RSVD2          GENMASK(31, 24)\n\nenum ath11k_htc_tx_flags {\n\tATH11K_HTC_FLAG_NEED_CREDIT_UPDATE = 0x01,\n\tATH11K_HTC_FLAG_SEND_BUNDLE        = 0x02\n};\n\nenum ath11k_htc_rx_flags {\n\tATH11K_HTC_FLAG_TRAILER_PRESENT = 0x02,\n\tATH11K_HTC_FLAG_BUNDLE_MASK     = 0xF0\n};\n\nstruct ath11k_htc_hdr {\n\tu32 htc_info;\n\tu32 ctrl_info;\n} __packed __aligned(4);\n\nenum ath11k_htc_msg_id {\n\tATH11K_HTC_MSG_READY_ID                = 1,\n\tATH11K_HTC_MSG_CONNECT_SERVICE_ID      = 2,\n\tATH11K_HTC_MSG_CONNECT_SERVICE_RESP_ID = 3,\n\tATH11K_HTC_MSG_SETUP_COMPLETE_ID       = 4,\n\tATH11K_HTC_MSG_SETUP_COMPLETE_EX_ID    = 5,\n\tATH11K_HTC_MSG_SEND_SUSPEND_COMPLETE   = 6,\n\tATH11K_HTC_MSG_NACK_SUSPEND\t       = 7,\n\tATH11K_HTC_MSG_WAKEUP_FROM_SUSPEND_ID  = 8,\n};\n\nenum ath11k_htc_version {\n\tATH11K_HTC_VERSION_2P0 = 0x00,  \n\tATH11K_HTC_VERSION_2P1 = 0x01,  \n};\n\n#define ATH11K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_MASK GENMASK(1, 0)\n#define ATH11K_HTC_CONN_FLAGS_RECV_ALLOC GENMASK(15, 8)\n\nenum ath11k_htc_conn_flags {\n\tATH11K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_ONE_FOURTH    = 0x0,\n\tATH11K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_ONE_HALF      = 0x1,\n\tATH11K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_THREE_FOURTHS = 0x2,\n\tATH11K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_UNITY         = 0x3,\n\tATH11K_HTC_CONN_FLAGS_REDUCE_CREDIT_DRIBBLE\t    = 0x4,\n\tATH11K_HTC_CONN_FLAGS_DISABLE_CREDIT_FLOW_CTRL\t    = 0x8,\n};\n\nenum ath11k_htc_conn_svc_status {\n\tATH11K_HTC_CONN_SVC_STATUS_SUCCESS      = 0,\n\tATH11K_HTC_CONN_SVC_STATUS_NOT_FOUND    = 1,\n\tATH11K_HTC_CONN_SVC_STATUS_FAILED       = 2,\n\tATH11K_HTC_CONN_SVC_STATUS_NO_RESOURCES = 3,\n\tATH11K_HTC_CONN_SVC_STATUS_NO_MORE_EP   = 4\n};\n\nstruct ath11k_htc_ready {\n\tu32 id_credit_count;\n\tu32 size_ep;\n} __packed;\n\nstruct ath11k_htc_ready_extended {\n\tstruct ath11k_htc_ready base;\n\tu32 ver_bundle;\n} __packed;\n\nstruct ath11k_htc_conn_svc {\n\tu32 msg_svc_id;\n\tu32 flags_len;\n} __packed;\n\nstruct ath11k_htc_conn_svc_resp {\n\tu32 msg_svc_id;\n\tu32 flags_len;\n\tu32 svc_meta_pad;\n} __packed;\n\n#define ATH11K_GLOBAL_DISABLE_CREDIT_FLOW BIT(1)\n\nstruct ath11k_htc_setup_complete_extended {\n\tu32 msg_id;\n\tu32 flags;\n\tu32 max_msgs_per_bundled_recv;\n} __packed;\n\nstruct ath11k_htc_msg {\n\tu32 msg_svc_id;\n\tu32 flags_len;\n} __packed __aligned(4);\n\nenum ath11k_htc_record_id {\n\tATH11K_HTC_RECORD_NULL    = 0,\n\tATH11K_HTC_RECORD_CREDITS = 1\n};\n\nstruct ath11k_htc_record_hdr {\n\tu8 id;  \n\tu8 len;\n\tu8 pad0;\n\tu8 pad1;\n} __packed;\n\nstruct ath11k_htc_credit_report {\n\tu8 eid;  \n\tu8 credits;\n\tu8 pad0;\n\tu8 pad1;\n} __packed;\n\nstruct ath11k_htc_record {\n\tstruct ath11k_htc_record_hdr hdr;\n\tunion {\n\t\tstruct ath11k_htc_credit_report credit_report[0];\n\t\tu8 pauload[0];\n\t};\n} __packed __aligned(4);\n\n \nstruct ath11k_htc_frame {\n\tstruct ath11k_htc_hdr hdr;\n\tunion {\n\t\tstruct ath11k_htc_msg msg;\n\t\tu8 payload[0];\n\t};\n\tstruct ath11k_htc_record trailer[0];\n} __packed __aligned(4);\n\nenum ath11k_htc_svc_gid {\n\tATH11K_HTC_SVC_GRP_RSVD = 0,\n\tATH11K_HTC_SVC_GRP_WMI = 1,\n\tATH11K_HTC_SVC_GRP_NMI = 2,\n\tATH11K_HTC_SVC_GRP_HTT = 3,\n\tATH11K_HTC_SVC_GRP_CFG = 4,\n\tATH11K_HTC_SVC_GRP_IPA = 5,\n\tATH11K_HTC_SVC_GRP_PKTLOG = 6,\n\n\tATH11K_HTC_SVC_GRP_TEST = 254,\n\tATH11K_HTC_SVC_GRP_LAST = 255,\n};\n\n#define SVC(group, idx) \\\n\t(int)(((int)(group) << 8) | (int)(idx))\n\nenum ath11k_htc_svc_id {\n\t \n\tATH11K_HTC_SVC_ID_RESERVED\t= 0x0000,\n\tATH11K_HTC_SVC_ID_UNUSED\t= ATH11K_HTC_SVC_ID_RESERVED,\n\n\tATH11K_HTC_SVC_ID_RSVD_CTRL\t= SVC(ATH11K_HTC_SVC_GRP_RSVD, 1),\n\tATH11K_HTC_SVC_ID_WMI_CONTROL\t= SVC(ATH11K_HTC_SVC_GRP_WMI, 0),\n\tATH11K_HTC_SVC_ID_WMI_DATA_BE\t= SVC(ATH11K_HTC_SVC_GRP_WMI, 1),\n\tATH11K_HTC_SVC_ID_WMI_DATA_BK\t= SVC(ATH11K_HTC_SVC_GRP_WMI, 2),\n\tATH11K_HTC_SVC_ID_WMI_DATA_VI\t= SVC(ATH11K_HTC_SVC_GRP_WMI, 3),\n\tATH11K_HTC_SVC_ID_WMI_DATA_VO\t= SVC(ATH11K_HTC_SVC_GRP_WMI, 4),\n\tATH11K_HTC_SVC_ID_WMI_CONTROL_MAC1 = SVC(ATH11K_HTC_SVC_GRP_WMI, 5),\n\tATH11K_HTC_SVC_ID_WMI_CONTROL_MAC2 = SVC(ATH11K_HTC_SVC_GRP_WMI, 6),\n\n\tATH11K_HTC_SVC_ID_NMI_CONTROL\t= SVC(ATH11K_HTC_SVC_GRP_NMI, 0),\n\tATH11K_HTC_SVC_ID_NMI_DATA\t= SVC(ATH11K_HTC_SVC_GRP_NMI, 1),\n\n\tATH11K_HTC_SVC_ID_HTT_DATA_MSG\t= SVC(ATH11K_HTC_SVC_GRP_HTT, 0),\n\n\t \n\tATH11K_HTC_SVC_ID_TEST_RAW_STREAMS = SVC(ATH11K_HTC_SVC_GRP_TEST, 0),\n\tATH11K_HTC_SVC_ID_IPA_TX = SVC(ATH11K_HTC_SVC_GRP_IPA, 0),\n\tATH11K_HTC_SVC_ID_PKT_LOG = SVC(ATH11K_HTC_SVC_GRP_PKTLOG, 0),\n};\n\n#undef SVC\n\nenum ath11k_htc_ep_id {\n\tATH11K_HTC_EP_UNUSED = -1,\n\tATH11K_HTC_EP_0 = 0,\n\tATH11K_HTC_EP_1 = 1,\n\tATH11K_HTC_EP_2,\n\tATH11K_HTC_EP_3,\n\tATH11K_HTC_EP_4,\n\tATH11K_HTC_EP_5,\n\tATH11K_HTC_EP_6,\n\tATH11K_HTC_EP_7,\n\tATH11K_HTC_EP_8,\n\tATH11K_HTC_EP_COUNT,\n};\n\nstruct ath11k_htc_ep_ops {\n\tvoid (*ep_tx_complete)(struct ath11k_base *, struct sk_buff *);\n\tvoid (*ep_rx_complete)(struct ath11k_base *, struct sk_buff *);\n\tvoid (*ep_tx_credits)(struct ath11k_base *);\n};\n\n \nstruct ath11k_htc_svc_conn_req {\n\tu16 service_id;\n\tstruct ath11k_htc_ep_ops ep_ops;\n\tint max_send_queue_depth;\n};\n\n \nstruct ath11k_htc_svc_conn_resp {\n\tu8 buffer_len;\n\tu8 actual_len;\n\tenum ath11k_htc_ep_id eid;\n\tunsigned int max_msg_len;\n\tu8 connect_resp_code;\n};\n\n#define ATH11K_NUM_CONTROL_TX_BUFFERS 2\n#define ATH11K_HTC_MAX_LEN 4096\n#define ATH11K_HTC_MAX_CTRL_MSG_LEN 256\n#define ATH11K_HTC_WAIT_TIMEOUT_HZ (1 * HZ)\n#define ATH11K_HTC_CONTROL_BUFFER_SIZE (ATH11K_HTC_MAX_CTRL_MSG_LEN + \\\n\t\t\t\t\tsizeof(struct ath11k_htc_hdr))\n#define ATH11K_HTC_CONN_SVC_TIMEOUT_HZ (1 * HZ)\n#define ATH11K_HTC_MAX_SERVICE_ALLOC_ENTRIES 8\n\nstruct ath11k_htc_ep {\n\tstruct ath11k_htc *htc;\n\tenum ath11k_htc_ep_id eid;\n\tenum ath11k_htc_svc_id service_id;\n\tstruct ath11k_htc_ep_ops ep_ops;\n\n\tint max_tx_queue_depth;\n\tint max_ep_message_len;\n\tu8 ul_pipe_id;\n\tu8 dl_pipe_id;\n\n\tu8 seq_no;  \n\tint tx_credits;\n\tbool tx_credit_flow_enabled;\n};\n\nstruct ath11k_htc_svc_tx_credits {\n\tu16 service_id;\n\tu8  credit_allocation;\n};\n\nstruct ath11k_htc {\n\tstruct ath11k_base *ab;\n\tstruct ath11k_htc_ep endpoint[ATH11K_HTC_EP_COUNT];\n\n\t \n\tspinlock_t tx_lock;\n\n\tu8 control_resp_buffer[ATH11K_HTC_MAX_CTRL_MSG_LEN];\n\tint control_resp_len;\n\n\tstruct completion ctl_resp;\n\n\tint total_transmit_credits;\n\tstruct ath11k_htc_svc_tx_credits\n\t\tservice_alloc_table[ATH11K_HTC_MAX_SERVICE_ALLOC_ENTRIES];\n\tint target_credit_size;\n\tu8 wmi_ep_count;\n};\n\nint ath11k_htc_init(struct ath11k_base *ar);\nint ath11k_htc_wait_target(struct ath11k_htc *htc);\nint ath11k_htc_start(struct ath11k_htc *htc);\nint ath11k_htc_connect_service(struct ath11k_htc *htc,\n\t\t\t       struct ath11k_htc_svc_conn_req  *conn_req,\n\t\t\t       struct ath11k_htc_svc_conn_resp *conn_resp);\nint ath11k_htc_send(struct ath11k_htc *htc, enum ath11k_htc_ep_id eid,\n\t\t    struct sk_buff *packet);\nstruct sk_buff *ath11k_htc_alloc_skb(struct ath11k_base *ar, int size);\nvoid ath11k_htc_rx_completion_handler(struct ath11k_base *ar,\n\t\t\t\t      struct sk_buff *skb);\nvoid ath11k_htc_tx_completion_handler(struct ath11k_base *ab,\n\t\t\t\t      struct sk_buff *skb);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}