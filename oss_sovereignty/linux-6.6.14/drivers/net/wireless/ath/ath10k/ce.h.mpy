{
  "module_name": "ce.h",
  "hash_id": "a742c60ba281f14ea9dc7e35b9ea55772e7ce2a6fd241045e340a7132c7b41fe",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath10k/ce.h",
  "human_readable_source": " \n \n\n#ifndef _CE_H_\n#define _CE_H_\n\n#include \"hif.h\"\n\n#define CE_HTT_H2T_MSG_SRC_NENTRIES 8192\n\n \n#define CE_DESC_RING_ALIGN\t8\n#define CE_SEND_FLAG_GATHER\t0x00010000\n\n \n\nstruct ath10k_ce_pipe;\n\n#define CE_DESC_FLAGS_GATHER         (1 << 0)\n#define CE_DESC_FLAGS_BYTE_SWAP      (1 << 1)\n#define CE_WCN3990_DESC_FLAGS_GATHER BIT(31)\n\n#define CE_DESC_ADDR_MASK\t\tGENMASK_ULL(34, 0)\n#define CE_DESC_ADDR_HI_MASK\t\tGENMASK(4, 0)\n\n \n#define CE_DESC_FLAGS_HOST_INT_DIS\t(1 << 2)\n#define CE_DESC_FLAGS_TGT_INT_DIS\t(1 << 3)\n\n#define CE_DESC_FLAGS_META_DATA_MASK ar->hw_values->ce_desc_meta_data_mask\n#define CE_DESC_FLAGS_META_DATA_LSB  ar->hw_values->ce_desc_meta_data_lsb\n\n#define CE_DDR_RRI_MASK\t\t\tGENMASK(15, 0)\n#define CE_DDR_DRRI_SHIFT\t\t16\n\nstruct ce_desc {\n\t__le32 addr;\n\t__le16 nbytes;\n\t__le16 flags;  \n};\n\nstruct ce_desc_64 {\n\t__le64 addr;\n\t__le16 nbytes;  \n\t__le16 flags;  \n\t__le32 toeplitz_hash_result;\n};\n\n#define CE_DESC_SIZE sizeof(struct ce_desc)\n#define CE_DESC_SIZE_64 sizeof(struct ce_desc_64)\n\nstruct ath10k_ce_ring {\n\t \n\tunsigned int nentries;\n\tunsigned int nentries_mask;\n\n\t \n\tunsigned int sw_index;\n\t \n\tunsigned int write_index;\n\t \n\t \n\tunsigned int hw_index;\n\n\t \n\t \n\tvoid *base_addr_owner_space_unaligned;\n\t \n\tdma_addr_t base_addr_ce_space_unaligned;\n\n\t \n\t \n\tvoid *base_addr_owner_space;\n\n\t \n\tdma_addr_t base_addr_ce_space;\n\n\tchar *shadow_base_unaligned;\n\tstruct ce_desc_64 *shadow_base;\n\n\t \n\tvoid *per_transfer_context[];\n};\n\nstruct ath10k_ce_pipe {\n\tstruct ath10k *ar;\n\tunsigned int id;\n\n\tunsigned int attr_flags;\n\n\tu32 ctrl_addr;\n\n\tvoid (*send_cb)(struct ath10k_ce_pipe *);\n\tvoid (*recv_cb)(struct ath10k_ce_pipe *);\n\n\tunsigned int src_sz_max;\n\tstruct ath10k_ce_ring *src_ring;\n\tstruct ath10k_ce_ring *dest_ring;\n\tconst struct ath10k_ce_ops *ops;\n};\n\n \nstruct ce_attr;\n\nstruct ath10k_bus_ops {\n\tu32 (*read32)(struct ath10k *ar, u32 offset);\n\tvoid (*write32)(struct ath10k *ar, u32 offset, u32 value);\n\tint (*get_num_banks)(struct ath10k *ar);\n};\n\nstatic inline struct ath10k_ce *ath10k_ce_priv(struct ath10k *ar)\n{\n\treturn (struct ath10k_ce *)ar->ce_priv;\n}\n\nstruct ath10k_ce {\n\t \n\tspinlock_t ce_lock;\n\tconst struct ath10k_bus_ops *bus_ops;\n\tstruct ath10k_ce_pipe ce_states[CE_COUNT_MAX];\n\tu32 *vaddr_rri;\n\tdma_addr_t paddr_rri;\n};\n\n \n\n \n#define CE_SEND_FLAG_BYTE_SWAP 1\n\n \nint ath10k_ce_send(struct ath10k_ce_pipe *ce_state,\n\t\t   void *per_transfer_send_context,\n\t\t   dma_addr_t buffer,\n\t\t   unsigned int nbytes,\n\t\t    \n\t\t   unsigned int transfer_id,\n\t\t   unsigned int flags);\n\nint ath10k_ce_send_nolock(struct ath10k_ce_pipe *ce_state,\n\t\t\t  void *per_transfer_context,\n\t\t\t  dma_addr_t buffer,\n\t\t\t  unsigned int nbytes,\n\t\t\t  unsigned int transfer_id,\n\t\t\t  unsigned int flags);\n\nvoid __ath10k_ce_send_revert(struct ath10k_ce_pipe *pipe);\n\nint ath10k_ce_num_free_src_entries(struct ath10k_ce_pipe *pipe);\n\n \n\nint __ath10k_ce_rx_num_free_bufs(struct ath10k_ce_pipe *pipe);\nint ath10k_ce_rx_post_buf(struct ath10k_ce_pipe *pipe, void *ctx,\n\t\t\t  dma_addr_t paddr);\nvoid ath10k_ce_rx_update_write_idx(struct ath10k_ce_pipe *pipe, u32 nentries);\n\n \n \n#define CE_RECV_FLAG_SWAPPED\t1\n\n \nint ath10k_ce_completed_recv_next(struct ath10k_ce_pipe *ce_state,\n\t\t\t\t  void **per_transfer_contextp,\n\t\t\t\t  unsigned int *nbytesp);\n \nint ath10k_ce_completed_send_next(struct ath10k_ce_pipe *ce_state,\n\t\t\t\t  void **per_transfer_contextp);\n\nint ath10k_ce_completed_send_next_nolock(struct ath10k_ce_pipe *ce_state,\n\t\t\t\t\t void **per_transfer_contextp);\n\n \n\nint ath10k_ce_init_pipe(struct ath10k *ar, unsigned int ce_id,\n\t\t\tconst struct ce_attr *attr);\nvoid ath10k_ce_deinit_pipe(struct ath10k *ar, unsigned int ce_id);\nint ath10k_ce_alloc_pipe(struct ath10k *ar, int ce_id,\n\t\t\t const struct ce_attr *attr);\nvoid ath10k_ce_free_pipe(struct ath10k *ar, int ce_id);\n\n \n \nint ath10k_ce_revoke_recv_next(struct ath10k_ce_pipe *ce_state,\n\t\t\t       void **per_transfer_contextp,\n\t\t\t       dma_addr_t *bufferp);\n\nint ath10k_ce_completed_recv_next_nolock(struct ath10k_ce_pipe *ce_state,\n\t\t\t\t\t void **per_transfer_contextp,\n\t\t\t\t\t unsigned int *nbytesp);\n\n \nint ath10k_ce_cancel_send_next(struct ath10k_ce_pipe *ce_state,\n\t\t\t       void **per_transfer_contextp,\n\t\t\t       dma_addr_t *bufferp,\n\t\t\t       unsigned int *nbytesp,\n\t\t\t       unsigned int *transfer_idp);\n\n \nvoid ath10k_ce_per_engine_service_any(struct ath10k *ar);\nvoid ath10k_ce_per_engine_service(struct ath10k *ar, unsigned int ce_id);\nvoid ath10k_ce_disable_interrupt(struct ath10k *ar, int ce_id);\nvoid ath10k_ce_disable_interrupts(struct ath10k *ar);\nvoid ath10k_ce_enable_interrupt(struct ath10k *ar, int ce_id);\nvoid ath10k_ce_enable_interrupts(struct ath10k *ar);\nvoid ath10k_ce_dump_registers(struct ath10k *ar,\n\t\t\t      struct ath10k_fw_crash_data *crash_data);\n\nvoid ath10k_ce_alloc_rri(struct ath10k *ar);\nvoid ath10k_ce_free_rri(struct ath10k *ar);\n\n \n \n#define CE_ATTR_NO_SNOOP\t\tBIT(0)\n\n \n#define CE_ATTR_BYTE_SWAP_DATA\t\tBIT(1)\n\n \n#define CE_ATTR_SWIZZLE_DESCRIPTORS\tBIT(2)\n\n \n#define CE_ATTR_DIS_INTR\t\tBIT(3)\n\n \n#define CE_ATTR_POLL\t\t\tBIT(4)\n\n \nstruct ce_attr {\n\t \n\tunsigned int flags;\n\n\t \n\tunsigned int src_nentries;\n\n\t \n\tunsigned int src_sz_max;\n\n\t \n\tunsigned int dest_nentries;\n\n\tvoid (*send_cb)(struct ath10k_ce_pipe *);\n\tvoid (*recv_cb)(struct ath10k_ce_pipe *);\n};\n\nstruct ath10k_ce_ops {\n\tstruct ath10k_ce_ring *(*ce_alloc_src_ring)(struct ath10k *ar,\n\t\t\t\t\t\t    u32 ce_id,\n\t\t\t\t\t\t    const struct ce_attr *attr);\n\tstruct ath10k_ce_ring *(*ce_alloc_dst_ring)(struct ath10k *ar,\n\t\t\t\t\t\t    u32 ce_id,\n\t\t\t\t\t\t    const struct ce_attr *attr);\n\tint (*ce_rx_post_buf)(struct ath10k_ce_pipe *pipe, void *ctx,\n\t\t\t      dma_addr_t paddr);\n\tint (*ce_completed_recv_next_nolock)(struct ath10k_ce_pipe *ce_state,\n\t\t\t\t\t     void **per_transfer_contextp,\n\t\t\t\t\t     u32 *nbytesp);\n\tint (*ce_revoke_recv_next)(struct ath10k_ce_pipe *ce_state,\n\t\t\t\t   void **per_transfer_contextp,\n\t\t\t\t   dma_addr_t *nbytesp);\n\tvoid (*ce_extract_desc_data)(struct ath10k *ar,\n\t\t\t\t     struct ath10k_ce_ring *src_ring,\n\t\t\t\t     u32 sw_index, dma_addr_t *bufferp,\n\t\t\t\t     u32 *nbytesp, u32 *transfer_idp);\n\tvoid (*ce_free_pipe)(struct ath10k *ar, int ce_id);\n\tint (*ce_send_nolock)(struct ath10k_ce_pipe *pipe,\n\t\t\t      void *per_transfer_context,\n\t\t\t      dma_addr_t buffer, u32 nbytes,\n\t\t\t      u32 transfer_id, u32 flags);\n\tvoid (*ce_set_src_ring_base_addr_hi)(struct ath10k *ar,\n\t\t\t\t\t     u32 ce_ctrl_addr,\n\t\t\t\t\t     u64 addr);\n\tvoid (*ce_set_dest_ring_base_addr_hi)(struct ath10k *ar,\n\t\t\t\t\t      u32 ce_ctrl_addr,\n\t\t\t\t\t      u64 addr);\n\tint (*ce_completed_send_next_nolock)(struct ath10k_ce_pipe *ce_state,\n\t\t\t\t\t     void **per_transfer_contextp);\n};\n\nstatic inline u32 ath10k_ce_base_address(struct ath10k *ar, unsigned int ce_id)\n{\n\treturn CE0_BASE_ADDRESS + (CE1_BASE_ADDRESS - CE0_BASE_ADDRESS) * ce_id;\n}\n\n#define COPY_ENGINE_ID(COPY_ENGINE_BASE_ADDRESS) (((COPY_ENGINE_BASE_ADDRESS) \\\n\t\t- CE0_BASE_ADDRESS) / (CE1_BASE_ADDRESS - CE0_BASE_ADDRESS))\n\n#define CE_SRC_RING_TO_DESC(baddr, idx) \\\n\t(&(((struct ce_desc *)baddr)[idx]))\n\n#define CE_DEST_RING_TO_DESC(baddr, idx) \\\n\t(&(((struct ce_desc *)baddr)[idx]))\n\n#define CE_SRC_RING_TO_DESC_64(baddr, idx) \\\n\t(&(((struct ce_desc_64 *)baddr)[idx]))\n\n#define CE_DEST_RING_TO_DESC_64(baddr, idx) \\\n\t(&(((struct ce_desc_64 *)baddr)[idx]))\n\n \n#define CE_RING_DELTA(nentries_mask, fromidx, toidx) \\\n\t(((int)(toidx) - (int)(fromidx)) & (nentries_mask))\n\n#define CE_RING_IDX_INCR(nentries_mask, idx) (((idx) + 1) & (nentries_mask))\n#define CE_RING_IDX_ADD(nentries_mask, idx, num) \\\n\t\t(((idx) + (num)) & (nentries_mask))\n\n#define CE_WRAPPER_INTERRUPT_SUMMARY_HOST_MSI_LSB \\\n\t\t\t\tar->regs->ce_wrap_intr_sum_host_msi_lsb\n#define CE_WRAPPER_INTERRUPT_SUMMARY_HOST_MSI_MASK \\\n\t\t\t\tar->regs->ce_wrap_intr_sum_host_msi_mask\n#define CE_WRAPPER_INTERRUPT_SUMMARY_HOST_MSI_GET(x) \\\n\t(((x) & CE_WRAPPER_INTERRUPT_SUMMARY_HOST_MSI_MASK) >> \\\n\t\tCE_WRAPPER_INTERRUPT_SUMMARY_HOST_MSI_LSB)\n#define CE_WRAPPER_INTERRUPT_SUMMARY_ADDRESS\t\t\t0x0000\n\nstatic inline u32 ath10k_ce_interrupt_summary(struct ath10k *ar)\n{\n\tstruct ath10k_ce *ce = ath10k_ce_priv(ar);\n\n\treturn CE_WRAPPER_INTERRUPT_SUMMARY_HOST_MSI_GET(\n\t\tce->bus_ops->read32((ar), CE_WRAPPER_BASE_ADDRESS +\n\t\tCE_WRAPPER_INTERRUPT_SUMMARY_ADDRESS));\n}\n\n \n#define CE_ATTR_FLAGS 0\n\n \nstruct ce_pipe_config {\n\t__le32 pipenum;\n\t__le32 pipedir;\n\t__le32 nentries;\n\t__le32 nbytes_max;\n\t__le32 flags;\n\t__le32 reserved;\n};\n\n \n#define PIPEDIR_NONE    0\n#define PIPEDIR_IN      1   \n#define PIPEDIR_OUT     2   \n#define PIPEDIR_INOUT   3   \n\n \nstruct ce_service_to_pipe {\n\t__le32 service_id;\n\t__le32 pipedir;\n\t__le32 pipenum;\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}