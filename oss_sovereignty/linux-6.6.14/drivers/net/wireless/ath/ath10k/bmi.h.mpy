{
  "module_name": "bmi.h",
  "hash_id": "d96f368a71bb9ebacc48b4748e8417141579346501318dc85072a80f0c439edf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath10k/bmi.h",
  "human_readable_source": " \n \n\n#ifndef _BMI_H_\n#define _BMI_H_\n\n#include \"core.h\"\n\n \n\n \n#define BMI_MAX_DATA_SIZE\t256\n\n \n#define BMI_MAX_CMDBUF_SIZE (BMI_MAX_DATA_SIZE + \\\n\t\t\tsizeof(u32) + \\\n\t\t\tsizeof(u32) + \\\n\t\t\tsizeof(u32))\n\n \n#define BMI_MAX_LARGE_DATA_SIZE\t2048\n\n \n#define BMI_MAX_LARGE_CMDBUF_SIZE (BMI_MAX_LARGE_DATA_SIZE + \\\n\t\t\tsizeof(u32) + \\\n\t\t\tsizeof(u32) + \\\n\t\t\tsizeof(u32))\n\n \n\nenum bmi_cmd_id {\n\tBMI_NO_COMMAND          = 0,\n\tBMI_DONE                = 1,\n\tBMI_READ_MEMORY         = 2,\n\tBMI_WRITE_MEMORY        = 3,\n\tBMI_EXECUTE             = 4,\n\tBMI_SET_APP_START       = 5,\n\tBMI_READ_SOC_REGISTER   = 6,\n\tBMI_READ_SOC_WORD       = 6,\n\tBMI_WRITE_SOC_REGISTER  = 7,\n\tBMI_WRITE_SOC_WORD      = 7,\n\tBMI_GET_TARGET_ID       = 8,\n\tBMI_GET_TARGET_INFO     = 8,\n\tBMI_ROMPATCH_INSTALL    = 9,\n\tBMI_ROMPATCH_UNINSTALL  = 10,\n\tBMI_ROMPATCH_ACTIVATE   = 11,\n\tBMI_ROMPATCH_DEACTIVATE = 12,\n\tBMI_LZ_STREAM_START     = 13,  \n\tBMI_LZ_DATA             = 14,\n\tBMI_NVRAM_PROCESS       = 15,\n};\n\n#define BMI_NVRAM_SEG_NAME_SZ 16\n\n#define BMI_PARAM_GET_EEPROM_BOARD_ID 0x10\n#define BMI_PARAM_GET_FLASH_BOARD_ID 0x8000\n#define BMI_PARAM_FLASH_SECTION_ALL 0x10000\n\n \n#define BMI_PARAM_GET_EXT_BOARD_ID 0x40000\n#define ATH10K_BMI_EXT_BOARD_ID_SUPPORT 0x40000\n\n#define ATH10K_BMI_BOARD_ID_FROM_OTP_MASK   0x7c00\n#define ATH10K_BMI_BOARD_ID_FROM_OTP_LSB    10\n\n#define ATH10K_BMI_CHIP_ID_FROM_OTP_MASK    0x18000\n#define ATH10K_BMI_CHIP_ID_FROM_OTP_LSB     15\n\n#define ATH10K_BMI_BOARD_ID_STATUS_MASK 0xff\n#define ATH10K_BMI_EBOARD_ID_STATUS_MASK 0xff\n\nstruct bmi_cmd {\n\t__le32 id;  \n\tunion {\n\t\tstruct {\n\t\t} done;\n\t\tstruct {\n\t\t\t__le32 addr;\n\t\t\t__le32 len;\n\t\t} read_mem;\n\t\tstruct {\n\t\t\t__le32 addr;\n\t\t\t__le32 len;\n\t\t\tu8 payload[];\n\t\t} write_mem;\n\t\tstruct {\n\t\t\t__le32 addr;\n\t\t\t__le32 param;\n\t\t} execute;\n\t\tstruct {\n\t\t\t__le32 addr;\n\t\t} set_app_start;\n\t\tstruct {\n\t\t\t__le32 addr;\n\t\t} read_soc_reg;\n\t\tstruct {\n\t\t\t__le32 addr;\n\t\t\t__le32 value;\n\t\t} write_soc_reg;\n\t\tstruct {\n\t\t} get_target_info;\n\t\tstruct {\n\t\t\t__le32 rom_addr;\n\t\t\t__le32 ram_addr;  \n\t\t\t__le32 size;\n\t\t\t__le32 activate;  \n\t\t} rompatch_install;\n\t\tstruct {\n\t\t\t__le32 patch_id;\n\t\t} rompatch_uninstall;\n\t\tstruct {\n\t\t\t__le32 count;\n\t\t\t__le32 patch_ids[];  \n\t\t} rompatch_activate;\n\t\tstruct {\n\t\t\t__le32 count;\n\t\t\t__le32 patch_ids[];  \n\t\t} rompatch_deactivate;\n\t\tstruct {\n\t\t\t__le32 addr;\n\t\t} lz_start;\n\t\tstruct {\n\t\t\t__le32 len;  \n\t\t\tu8 payload[];  \n\t\t} lz_data;\n\t\tstruct {\n\t\t\tu8 name[BMI_NVRAM_SEG_NAME_SZ];\n\t\t} nvram_process;\n\t\tu8 payload[BMI_MAX_CMDBUF_SIZE];\n\t};\n} __packed;\n\nunion bmi_resp {\n\tstruct {\n\t\tDECLARE_FLEX_ARRAY(u8, payload);\n\t} read_mem;\n\tstruct {\n\t\t__le32 result;\n\t} execute;\n\tstruct {\n\t\t__le32 value;\n\t} read_soc_reg;\n\tstruct {\n\t\t__le32 len;\n\t\t__le32 version;\n\t\t__le32 type;\n\t} get_target_info;\n\tstruct {\n\t\t__le32 patch_id;\n\t} rompatch_install;\n\tstruct {\n\t\t__le32 patch_id;\n\t} rompatch_uninstall;\n\tstruct {\n\t\t \n\t\t__le32 result;\n\t} nvram_process;\n\tu8 payload[BMI_MAX_CMDBUF_SIZE];\n} __packed;\n\nstruct bmi_target_info {\n\tu32 version;\n\tu32 type;\n};\n\nstruct bmi_segmented_file_header {\n\t__le32 magic_num;\n\t__le32 file_flags;\n\tu8 data[];\n};\n\nstruct bmi_segmented_metadata {\n\t__le32 addr;\n\t__le32 length;\n\tu8 data[];\n};\n\n#define BMI_SGMTFILE_MAGIC_NUM          0x544d4753  \n#define BMI_SGMTFILE_FLAG_COMPRESS      1\n\n \n\n \n#define BMI_SGMTFILE_DONE               0xffffffff\n\n \n#define BMI_SGMTFILE_BDDATA             0xfffffffe\n\n \n#define BMI_SGMTFILE_BEGINADDR          0xfffffffd\n\n \n#define BMI_SGMTFILE_EXEC               0xfffffffc\n\n \n#define BMI_COMMUNICATION_TIMEOUT_HZ (3 * HZ)\n\n#define BMI_CE_NUM_TO_TARG 0\n#define BMI_CE_NUM_TO_HOST 1\n\nvoid ath10k_bmi_start(struct ath10k *ar);\nint ath10k_bmi_done(struct ath10k *ar);\nint ath10k_bmi_get_target_info(struct ath10k *ar,\n\t\t\t       struct bmi_target_info *target_info);\nint ath10k_bmi_get_target_info_sdio(struct ath10k *ar,\n\t\t\t\t    struct bmi_target_info *target_info);\nint ath10k_bmi_read_memory(struct ath10k *ar, u32 address,\n\t\t\t   void *buffer, u32 length);\nint ath10k_bmi_write_memory(struct ath10k *ar, u32 address,\n\t\t\t    const void *buffer, u32 length);\n\n#define ath10k_bmi_read32(ar, item, val)\t\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\tint ret;\t\t\t\t\t\t\\\n\t\tu32 addr;\t\t\t\t\t\t\\\n\t\t__le32 tmp;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\taddr = host_interest_item_address(HI_ITEM(item));\t\\\n\t\tret = ath10k_bmi_read_memory(ar, addr, (u8 *)&tmp, 4); \\\n\t\tif (!ret)\t\t\t\t\t\t\\\n\t\t\t*val = __le32_to_cpu(tmp);\t\t\t\\\n\t\tret;\t\t\t\t\t\t\t\\\n\t })\n\n#define ath10k_bmi_write32(ar, item, val)\t\t\t\t\\\n\t({\t\t\t\t\t\t\t\t\\\n\t\tint ret;\t\t\t\t\t\t\\\n\t\tu32 address;\t\t\t\t\t\t\\\n\t\t__le32 v = __cpu_to_le32(val);\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\taddress = host_interest_item_address(HI_ITEM(item));\t\\\n\t\tret = ath10k_bmi_write_memory(ar, address,\t\t\\\n\t\t\t\t\t      (u8 *)&v, sizeof(v));\t\\\n\t\tret;\t\t\t\t\t\t\t\\\n\t})\n\nint ath10k_bmi_execute(struct ath10k *ar, u32 address, u32 param, u32 *result);\nint ath10k_bmi_lz_stream_start(struct ath10k *ar, u32 address);\nint ath10k_bmi_lz_data(struct ath10k *ar, const void *buffer, u32 length);\n\nint ath10k_bmi_fast_download(struct ath10k *ar, u32 address,\n\t\t\t     const void *buffer, u32 length);\nint ath10k_bmi_read_soc_reg(struct ath10k *ar, u32 address, u32 *reg_val);\nint ath10k_bmi_write_soc_reg(struct ath10k *ar, u32 address, u32 reg_val);\nint ath10k_bmi_set_start(struct ath10k *ar, u32 address);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}