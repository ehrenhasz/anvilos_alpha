{
  "module_name": "htc.h",
  "hash_id": "a1c5f2e36abe91c98714ddc890bfbabda28b7bec6636c7f06790fde593a766da",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath10k/htc.h",
  "human_readable_source": " \n \n\n#ifndef _HTC_H_\n#define _HTC_H_\n\n#include <linux/kernel.h>\n#include <linux/list.h>\n#include <linux/bug.h>\n#include <linux/skbuff.h>\n#include <linux/timer.h>\n#include <linux/bitfield.h>\n\nstruct ath10k;\n\n \n \n \n\n \n\n#define HTC_HOST_MAX_MSG_PER_RX_BUNDLE        32\n\nenum ath10k_htc_tx_flags {\n\tATH10K_HTC_FLAG_NEED_CREDIT_UPDATE = 0x01,\n\tATH10K_HTC_FLAG_SEND_BUNDLE        = 0x02\n};\n\nenum ath10k_htc_rx_flags {\n\tATH10K_HTC_FLAGS_RECV_1MORE_BLOCK = 0x01,\n\tATH10K_HTC_FLAG_TRAILER_PRESENT = 0x02,\n};\n\n#define ATH10K_HTC_FLAG_BUNDLE_MASK GENMASK(7, 4)\n\n \n#define ATH10K_HTC_BUNDLE_EXTRA_MASK GENMASK(3, 2)\n#define ATH10K_HTC_BUNDLE_EXTRA_SHIFT 4\n\nstatic inline unsigned int ath10k_htc_get_bundle_count(u8 max_msgs, u8 flags)\n{\n\tunsigned int count, extra_count = 0;\n\n\tcount = FIELD_GET(ATH10K_HTC_FLAG_BUNDLE_MASK, flags);\n\n\tif (max_msgs > 16)\n\t\textra_count = FIELD_GET(ATH10K_HTC_BUNDLE_EXTRA_MASK, flags) <<\n\t\t\tATH10K_HTC_BUNDLE_EXTRA_SHIFT;\n\n\treturn count + extra_count;\n}\n\nstruct ath10k_htc_hdr {\n\tu8 eid;  \n\tu8 flags;  \n\t__le16 len;\n\tunion {\n\t\tu8 trailer_len;  \n\t\tu8 control_byte0;\n\t} __packed;\n\tunion {\n\t\tu8 seq_no;  \n\t\tu8 control_byte1;\n\t} __packed;\n\tunion {\n\t\t__le16 pad_len;\n\t\tstruct {\n\t\t\tu8 pad0;\n\t\t\tu8 pad1;\n\t\t} __packed;\n\t} __packed;\n\n} __packed __aligned(4);\n\nenum ath10k_ath10k_htc_msg_id {\n\tATH10K_HTC_MSG_READY_ID                = 1,\n\tATH10K_HTC_MSG_CONNECT_SERVICE_ID      = 2,\n\tATH10K_HTC_MSG_CONNECT_SERVICE_RESP_ID = 3,\n\tATH10K_HTC_MSG_SETUP_COMPLETE_ID       = 4,\n\tATH10K_HTC_MSG_SETUP_COMPLETE_EX_ID    = 5,\n\tATH10K_HTC_MSG_SEND_SUSPEND_COMPLETE   = 6\n};\n\nenum ath10k_htc_version {\n\tATH10K_HTC_VERSION_2P0 = 0x00,  \n\tATH10K_HTC_VERSION_2P1 = 0x01,  \n};\n\nenum ath10k_htc_conn_flags {\n\tATH10K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_ONE_FOURTH    = 0x0,\n\tATH10K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_ONE_HALF      = 0x1,\n\tATH10K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_THREE_FOURTHS = 0x2,\n\tATH10K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_UNITY         = 0x3,\n#define ATH10K_HTC_CONN_FLAGS_THRESHOLD_LEVEL_MASK 0x3\n\tATH10K_HTC_CONN_FLAGS_REDUCE_CREDIT_DRIBBLE    = 1 << 2,\n\tATH10K_HTC_CONN_FLAGS_DISABLE_CREDIT_FLOW_CTRL = 1 << 3\n#define ATH10K_HTC_CONN_FLAGS_RECV_ALLOC_MASK 0xFF00\n#define ATH10K_HTC_CONN_FLAGS_RECV_ALLOC_LSB  8\n};\n\n#define ATH10K_HTC_MSG_READY_EXT_ALT_DATA_MASK 0xFFF\n\nenum ath10k_htc_conn_svc_status {\n\tATH10K_HTC_CONN_SVC_STATUS_SUCCESS      = 0,\n\tATH10K_HTC_CONN_SVC_STATUS_NOT_FOUND    = 1,\n\tATH10K_HTC_CONN_SVC_STATUS_FAILED       = 2,\n\tATH10K_HTC_CONN_SVC_STATUS_NO_RESOURCES = 3,\n\tATH10K_HTC_CONN_SVC_STATUS_NO_MORE_EP   = 4\n};\n\n#define ATH10K_MAX_MSG_PER_HTC_TX_BUNDLE        32\n#define ATH10K_MIN_MSG_PER_HTC_TX_BUNDLE        2\n#define ATH10K_MIN_CREDIT_PER_HTC_TX_BUNDLE     2\n\nenum ath10k_htc_setup_complete_flags {\n\tATH10K_HTC_SETUP_COMPLETE_FLAGS_RX_BNDL_EN = 1\n};\n\nstruct ath10k_ath10k_htc_msg_hdr {\n\t__le16 message_id;  \n} __packed;\n\nstruct ath10k_htc_unknown {\n\tu8 pad0;\n\tu8 pad1;\n} __packed;\n\nstruct ath10k_htc_ready {\n\t__le16 credit_count;\n\t__le16 credit_size;\n\tu8 max_endpoints;\n\tu8 pad0;\n} __packed;\n\nstruct ath10k_htc_ready_extended {\n\tstruct ath10k_htc_ready base;\n\tu8 htc_version;  \n\tu8 max_msgs_per_htc_bundle;\n\tunion {\n\t\t__le16 reserved;\n\t\tstruct {\n\t\t\tu8 pad0;\n\t\t\tu8 pad1;\n\t\t} __packed;\n\t} __packed;\n\n} __packed;\n\nstruct ath10k_htc_conn_svc {\n\t__le16 service_id;\n\t__le16 flags;  \n\tu8 pad0;\n\tu8 pad1;\n} __packed;\n\nstruct ath10k_htc_conn_svc_response {\n\t__le16 service_id;\n\tu8 status;  \n\tu8 eid;\n\t__le16 max_msg_size;\n} __packed;\n\nstruct ath10k_htc_setup_complete_extended {\n\tu8 pad0;\n\tu8 pad1;\n\t__le32 flags;  \n\tu8 max_msgs_per_bundled_recv;\n\tu8 pad2;\n\tu8 pad3;\n\tu8 pad4;\n} __packed;\n\nstruct ath10k_htc_msg {\n\tstruct ath10k_ath10k_htc_msg_hdr hdr;\n\tunion {\n\t\t \n\t\tstruct ath10k_htc_conn_svc connect_service;\n\t\tstruct ath10k_htc_ready ready;\n\t\tstruct ath10k_htc_ready_extended ready_ext;\n\t\tstruct ath10k_htc_unknown unknown;\n\t\tstruct ath10k_htc_setup_complete_extended setup_complete_ext;\n\n\t\t \n\t\tstruct ath10k_htc_conn_svc_response connect_service_response;\n\t};\n} __packed __aligned(4);\n\nenum ath10k_ath10k_htc_record_id {\n\tATH10K_HTC_RECORD_NULL             = 0,\n\tATH10K_HTC_RECORD_CREDITS          = 1,\n\tATH10K_HTC_RECORD_LOOKAHEAD        = 2,\n\tATH10K_HTC_RECORD_LOOKAHEAD_BUNDLE = 3,\n};\n\nstruct ath10k_ath10k_htc_record_hdr {\n\tu8 id;  \n\tu8 len;\n\tu8 pad0;\n\tu8 pad1;\n} __packed;\n\nstruct ath10k_htc_credit_report {\n\tu8 eid;  \n\tu8 credits;\n\tu8 pad0;\n\tu8 pad1;\n} __packed;\n\nstruct ath10k_htc_lookahead_report {\n\tu8 pre_valid;\n\tu8 pad0;\n\tu8 pad1;\n\tu8 pad2;\n\tu8 lookahead[4];\n\tu8 post_valid;\n\tu8 pad3;\n\tu8 pad4;\n\tu8 pad5;\n} __packed;\n\nstruct ath10k_htc_lookahead_bundle {\n\tu8 lookahead[4];\n} __packed;\n\nstruct ath10k_htc_record {\n\tstruct ath10k_ath10k_htc_record_hdr hdr;\n\tunion {\n\t\tstruct ath10k_htc_credit_report credit_report[0];\n\t\tstruct ath10k_htc_lookahead_report lookahead_report[0];\n\t\tstruct ath10k_htc_lookahead_bundle lookahead_bundle[0];\n\t\tu8 pauload[0];\n\t};\n} __packed __aligned(4);\n\n \nstruct ath10k_htc_frame {\n\tstruct ath10k_htc_hdr hdr;\n\tunion {\n\t\tstruct ath10k_htc_msg msg;\n\t\tu8 payload[0];\n\t};\n\tstruct ath10k_htc_record trailer[0];\n} __packed __aligned(4);\n\n \n \n \n\nenum ath10k_htc_svc_gid {\n\tATH10K_HTC_SVC_GRP_RSVD = 0,\n\tATH10K_HTC_SVC_GRP_WMI = 1,\n\tATH10K_HTC_SVC_GRP_NMI = 2,\n\tATH10K_HTC_SVC_GRP_HTT = 3,\n\tATH10K_LOG_SERVICE_GROUP = 6,\n\n\tATH10K_HTC_SVC_GRP_TEST = 254,\n\tATH10K_HTC_SVC_GRP_LAST = 255,\n};\n\n#define SVC(group, idx) \\\n\t(int)(((int)(group) << 8) | (int)(idx))\n\nenum ath10k_htc_svc_id {\n\t \n\tATH10K_HTC_SVC_ID_RESERVED\t= 0x0000,\n\tATH10K_HTC_SVC_ID_UNUSED\t= ATH10K_HTC_SVC_ID_RESERVED,\n\n\tATH10K_HTC_SVC_ID_RSVD_CTRL\t= SVC(ATH10K_HTC_SVC_GRP_RSVD, 1),\n\tATH10K_HTC_SVC_ID_WMI_CONTROL\t= SVC(ATH10K_HTC_SVC_GRP_WMI, 0),\n\tATH10K_HTC_SVC_ID_WMI_DATA_BE\t= SVC(ATH10K_HTC_SVC_GRP_WMI, 1),\n\tATH10K_HTC_SVC_ID_WMI_DATA_BK\t= SVC(ATH10K_HTC_SVC_GRP_WMI, 2),\n\tATH10K_HTC_SVC_ID_WMI_DATA_VI\t= SVC(ATH10K_HTC_SVC_GRP_WMI, 3),\n\tATH10K_HTC_SVC_ID_WMI_DATA_VO\t= SVC(ATH10K_HTC_SVC_GRP_WMI, 4),\n\n\tATH10K_HTC_SVC_ID_NMI_CONTROL\t= SVC(ATH10K_HTC_SVC_GRP_NMI, 0),\n\tATH10K_HTC_SVC_ID_NMI_DATA\t= SVC(ATH10K_HTC_SVC_GRP_NMI, 1),\n\n\tATH10K_HTC_SVC_ID_HTT_DATA_MSG\t= SVC(ATH10K_HTC_SVC_GRP_HTT, 0),\n\n\tATH10K_HTC_SVC_ID_HTT_DATA2_MSG = SVC(ATH10K_HTC_SVC_GRP_HTT, 1),\n\tATH10K_HTC_SVC_ID_HTT_DATA3_MSG = SVC(ATH10K_HTC_SVC_GRP_HTT, 2),\n\tATH10K_HTC_SVC_ID_HTT_LOG_MSG = SVC(ATH10K_LOG_SERVICE_GROUP, 0),\n\t \n\tATH10K_HTC_SVC_ID_TEST_RAW_STREAMS = SVC(ATH10K_HTC_SVC_GRP_TEST, 0),\n};\n\n#undef SVC\n\nenum ath10k_htc_ep_id {\n\tATH10K_HTC_EP_UNUSED = -1,\n\tATH10K_HTC_EP_0 = 0,\n\tATH10K_HTC_EP_1 = 1,\n\tATH10K_HTC_EP_2,\n\tATH10K_HTC_EP_3,\n\tATH10K_HTC_EP_4,\n\tATH10K_HTC_EP_5,\n\tATH10K_HTC_EP_6,\n\tATH10K_HTC_EP_7,\n\tATH10K_HTC_EP_8,\n\tATH10K_HTC_EP_COUNT,\n};\n\nstruct ath10k_htc_ops {\n\tvoid (*target_send_suspend_complete)(struct ath10k *ar);\n};\n\nstruct ath10k_htc_ep_ops {\n\tvoid (*ep_tx_complete)(struct ath10k *, struct sk_buff *);\n\tvoid (*ep_rx_complete)(struct ath10k *, struct sk_buff *);\n\tvoid (*ep_tx_credits)(struct ath10k *);\n};\n\n \nstruct ath10k_htc_svc_conn_req {\n\tu16 service_id;\n\tstruct ath10k_htc_ep_ops ep_ops;\n\tint max_send_queue_depth;\n};\n\n \nstruct ath10k_htc_svc_conn_resp {\n\tu8 buffer_len;\n\tu8 actual_len;\n\tenum ath10k_htc_ep_id eid;\n\tunsigned int max_msg_len;\n\tu8 connect_resp_code;\n};\n\n#define ATH10K_NUM_CONTROL_TX_BUFFERS 2\n#define ATH10K_HTC_MAX_LEN 4096\n#define ATH10K_HTC_MAX_CTRL_MSG_LEN 256\n#define ATH10K_HTC_WAIT_TIMEOUT_HZ (1 * HZ)\n#define ATH10K_HTC_CONTROL_BUFFER_SIZE (ATH10K_HTC_MAX_CTRL_MSG_LEN + \\\n\t\t\t\t\tsizeof(struct ath10k_htc_hdr))\n#define ATH10K_HTC_CONN_SVC_TIMEOUT_HZ (1 * HZ)\n\nstruct ath10k_htc_ep {\n\tstruct ath10k_htc *htc;\n\tenum ath10k_htc_ep_id eid;\n\tenum ath10k_htc_svc_id service_id;\n\tstruct ath10k_htc_ep_ops ep_ops;\n\n\tint max_tx_queue_depth;\n\tint max_ep_message_len;\n\tu8 ul_pipe_id;\n\tu8 dl_pipe_id;\n\n\tu8 seq_no;  \n\tint tx_credits;\n\tint tx_credit_size;\n\tbool tx_credit_flow_enabled;\n\tbool bundle_tx;\n\tstruct sk_buff_head tx_req_head;\n\tstruct sk_buff_head tx_complete_head;\n\n};\n\nstruct ath10k_htc_svc_tx_credits {\n\tu16 service_id;\n\tu8  credit_allocation;\n};\n\nstruct ath10k_htc {\n\tstruct ath10k *ar;\n\tstruct ath10k_htc_ep endpoint[ATH10K_HTC_EP_COUNT];\n\n\t \n\tspinlock_t tx_lock;\n\n\tstruct ath10k_htc_ops htc_ops;\n\n\tu8 control_resp_buffer[ATH10K_HTC_MAX_CTRL_MSG_LEN];\n\tint control_resp_len;\n\n\tstruct completion ctl_resp;\n\n\tint total_transmit_credits;\n\tint target_credit_size;\n\tu8 max_msgs_per_htc_bundle;\n\tint alt_data_credit_size;\n};\n\nint ath10k_htc_init(struct ath10k *ar);\nint ath10k_htc_wait_target(struct ath10k_htc *htc);\nvoid ath10k_htc_setup_tx_req(struct ath10k_htc_ep *ep);\nint ath10k_htc_start(struct ath10k_htc *htc);\nint ath10k_htc_connect_service(struct ath10k_htc *htc,\n\t\t\t       struct ath10k_htc_svc_conn_req  *conn_req,\n\t\t\t       struct ath10k_htc_svc_conn_resp *conn_resp);\nvoid ath10k_htc_change_tx_credit_flow(struct ath10k_htc *htc,\n\t\t\t\t      enum ath10k_htc_ep_id eid,\n\t\t\t\t      bool enable);\nint ath10k_htc_send(struct ath10k_htc *htc, enum ath10k_htc_ep_id eid,\n\t\t    struct sk_buff *packet);\nvoid ath10k_htc_stop_hl(struct ath10k *ar);\n\nint ath10k_htc_send_hl(struct ath10k_htc *htc, enum ath10k_htc_ep_id eid,\n\t\t       struct sk_buff *packet);\nstruct sk_buff *ath10k_htc_alloc_skb(struct ath10k *ar, int size);\nvoid ath10k_htc_tx_completion_handler(struct ath10k *ar, struct sk_buff *skb);\nvoid ath10k_htc_rx_completion_handler(struct ath10k *ar, struct sk_buff *skb);\nvoid ath10k_htc_notify_tx_completion(struct ath10k_htc_ep *ep,\n\t\t\t\t     struct sk_buff *skb);\nint ath10k_htc_process_trailer(struct ath10k_htc *htc,\n\t\t\t       u8 *buffer,\n\t\t\t       int length,\n\t\t\t       enum ath10k_htc_ep_id src_eid,\n\t\t\t       void *next_lookaheads,\n\t\t\t       int *next_lookaheads_len);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}