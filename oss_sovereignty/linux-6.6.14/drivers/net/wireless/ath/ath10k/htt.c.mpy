{
  "module_name": "htt.c",
  "hash_id": "9ff6fec4ab56c94a62d629fa64f287263d0137829d227469fbda9d54e9733471",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath10k/htt.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n#include <linux/if_ether.h>\n\n#include \"htt.h\"\n#include \"core.h\"\n#include \"debug.h\"\n#include \"hif.h\"\n\nstatic const enum htt_t2h_msg_type htt_main_t2h_msg_types[] = {\n\t[HTT_MAIN_T2H_MSG_TYPE_VERSION_CONF] = HTT_T2H_MSG_TYPE_VERSION_CONF,\n\t[HTT_MAIN_T2H_MSG_TYPE_RX_IND] = HTT_T2H_MSG_TYPE_RX_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_RX_FLUSH] = HTT_T2H_MSG_TYPE_RX_FLUSH,\n\t[HTT_MAIN_T2H_MSG_TYPE_PEER_MAP] = HTT_T2H_MSG_TYPE_PEER_MAP,\n\t[HTT_MAIN_T2H_MSG_TYPE_PEER_UNMAP] = HTT_T2H_MSG_TYPE_PEER_UNMAP,\n\t[HTT_MAIN_T2H_MSG_TYPE_RX_ADDBA] = HTT_T2H_MSG_TYPE_RX_ADDBA,\n\t[HTT_MAIN_T2H_MSG_TYPE_RX_DELBA] = HTT_T2H_MSG_TYPE_RX_DELBA,\n\t[HTT_MAIN_T2H_MSG_TYPE_TX_COMPL_IND] = HTT_T2H_MSG_TYPE_TX_COMPL_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_PKTLOG] = HTT_T2H_MSG_TYPE_PKTLOG,\n\t[HTT_MAIN_T2H_MSG_TYPE_STATS_CONF] = HTT_T2H_MSG_TYPE_STATS_CONF,\n\t[HTT_MAIN_T2H_MSG_TYPE_RX_FRAG_IND] = HTT_T2H_MSG_TYPE_RX_FRAG_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_SEC_IND] = HTT_T2H_MSG_TYPE_SEC_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_TX_INSPECT_IND] =\n\t\tHTT_T2H_MSG_TYPE_TX_INSPECT_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_MGMT_TX_COMPL_IND] =\n\t\tHTT_T2H_MSG_TYPE_MGMT_TX_COMPLETION,\n\t[HTT_MAIN_T2H_MSG_TYPE_TX_CREDIT_UPDATE_IND] =\n\t\tHTT_T2H_MSG_TYPE_TX_CREDIT_UPDATE_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_RX_PN_IND] = HTT_T2H_MSG_TYPE_RX_PN_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_RX_OFFLOAD_DELIVER_IND] =\n\t\tHTT_T2H_MSG_TYPE_RX_OFFLOAD_DELIVER_IND,\n\t[HTT_MAIN_T2H_MSG_TYPE_TEST] = HTT_T2H_MSG_TYPE_TEST,\n};\n\nstatic const enum htt_t2h_msg_type htt_10x_t2h_msg_types[] = {\n\t[HTT_10X_T2H_MSG_TYPE_VERSION_CONF] = HTT_T2H_MSG_TYPE_VERSION_CONF,\n\t[HTT_10X_T2H_MSG_TYPE_RX_IND] = HTT_T2H_MSG_TYPE_RX_IND,\n\t[HTT_10X_T2H_MSG_TYPE_RX_FLUSH] = HTT_T2H_MSG_TYPE_RX_FLUSH,\n\t[HTT_10X_T2H_MSG_TYPE_PEER_MAP] = HTT_T2H_MSG_TYPE_PEER_MAP,\n\t[HTT_10X_T2H_MSG_TYPE_PEER_UNMAP] = HTT_T2H_MSG_TYPE_PEER_UNMAP,\n\t[HTT_10X_T2H_MSG_TYPE_RX_ADDBA] = HTT_T2H_MSG_TYPE_RX_ADDBA,\n\t[HTT_10X_T2H_MSG_TYPE_RX_DELBA] = HTT_T2H_MSG_TYPE_RX_DELBA,\n\t[HTT_10X_T2H_MSG_TYPE_TX_COMPL_IND] = HTT_T2H_MSG_TYPE_TX_COMPL_IND,\n\t[HTT_10X_T2H_MSG_TYPE_PKTLOG] = HTT_T2H_MSG_TYPE_PKTLOG,\n\t[HTT_10X_T2H_MSG_TYPE_STATS_CONF] = HTT_T2H_MSG_TYPE_STATS_CONF,\n\t[HTT_10X_T2H_MSG_TYPE_RX_FRAG_IND] = HTT_T2H_MSG_TYPE_RX_FRAG_IND,\n\t[HTT_10X_T2H_MSG_TYPE_SEC_IND] = HTT_T2H_MSG_TYPE_SEC_IND,\n\t[HTT_10X_T2H_MSG_TYPE_RC_UPDATE_IND] = HTT_T2H_MSG_TYPE_RC_UPDATE_IND,\n\t[HTT_10X_T2H_MSG_TYPE_TX_INSPECT_IND] = HTT_T2H_MSG_TYPE_TX_INSPECT_IND,\n\t[HTT_10X_T2H_MSG_TYPE_TEST] = HTT_T2H_MSG_TYPE_TEST,\n\t[HTT_10X_T2H_MSG_TYPE_CHAN_CHANGE] = HTT_T2H_MSG_TYPE_CHAN_CHANGE,\n\t[HTT_10X_T2H_MSG_TYPE_AGGR_CONF] = HTT_T2H_MSG_TYPE_AGGR_CONF,\n\t[HTT_10X_T2H_MSG_TYPE_STATS_NOUPLOAD] = HTT_T2H_MSG_TYPE_STATS_NOUPLOAD,\n\t[HTT_10X_T2H_MSG_TYPE_MGMT_TX_COMPL_IND] =\n\t\tHTT_T2H_MSG_TYPE_MGMT_TX_COMPLETION,\n};\n\nstatic const enum htt_t2h_msg_type htt_tlv_t2h_msg_types[] = {\n\t[HTT_TLV_T2H_MSG_TYPE_VERSION_CONF] = HTT_T2H_MSG_TYPE_VERSION_CONF,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_IND] = HTT_T2H_MSG_TYPE_RX_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_FLUSH] = HTT_T2H_MSG_TYPE_RX_FLUSH,\n\t[HTT_TLV_T2H_MSG_TYPE_PEER_MAP] = HTT_T2H_MSG_TYPE_PEER_MAP,\n\t[HTT_TLV_T2H_MSG_TYPE_PEER_UNMAP] = HTT_T2H_MSG_TYPE_PEER_UNMAP,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_ADDBA] = HTT_T2H_MSG_TYPE_RX_ADDBA,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_DELBA] = HTT_T2H_MSG_TYPE_RX_DELBA,\n\t[HTT_TLV_T2H_MSG_TYPE_TX_COMPL_IND] = HTT_T2H_MSG_TYPE_TX_COMPL_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_PKTLOG] = HTT_T2H_MSG_TYPE_PKTLOG,\n\t[HTT_TLV_T2H_MSG_TYPE_STATS_CONF] = HTT_T2H_MSG_TYPE_STATS_CONF,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_FRAG_IND] = HTT_T2H_MSG_TYPE_RX_FRAG_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_SEC_IND] = HTT_T2H_MSG_TYPE_SEC_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_RC_UPDATE_IND] = HTT_T2H_MSG_TYPE_RC_UPDATE_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_TX_INSPECT_IND] = HTT_T2H_MSG_TYPE_TX_INSPECT_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_MGMT_TX_COMPL_IND] =\n\t\tHTT_T2H_MSG_TYPE_MGMT_TX_COMPLETION,\n\t[HTT_TLV_T2H_MSG_TYPE_TX_CREDIT_UPDATE_IND] =\n\t\tHTT_T2H_MSG_TYPE_TX_CREDIT_UPDATE_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_PN_IND] = HTT_T2H_MSG_TYPE_RX_PN_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_OFFLOAD_DELIVER_IND] =\n\t\tHTT_T2H_MSG_TYPE_RX_OFFLOAD_DELIVER_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_IN_ORD_PADDR_IND] =\n\t\tHTT_T2H_MSG_TYPE_RX_IN_ORD_PADDR_IND,\n\t[HTT_TLV_T2H_MSG_TYPE_WDI_IPA_OP_RESPONSE] =\n\t\tHTT_T2H_MSG_TYPE_WDI_IPA_OP_RESPONSE,\n\t[HTT_TLV_T2H_MSG_TYPE_CHAN_CHANGE] = HTT_T2H_MSG_TYPE_CHAN_CHANGE,\n\t[HTT_TLV_T2H_MSG_TYPE_RX_OFLD_PKT_ERR] =\n\t\tHTT_T2H_MSG_TYPE_RX_OFLD_PKT_ERR,\n\t[HTT_TLV_T2H_MSG_TYPE_TEST] = HTT_T2H_MSG_TYPE_TEST,\n};\n\nstatic const enum htt_t2h_msg_type htt_10_4_t2h_msg_types[] = {\n\t[HTT_10_4_T2H_MSG_TYPE_VERSION_CONF] = HTT_T2H_MSG_TYPE_VERSION_CONF,\n\t[HTT_10_4_T2H_MSG_TYPE_RX_IND] = HTT_T2H_MSG_TYPE_RX_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_RX_FLUSH] = HTT_T2H_MSG_TYPE_RX_FLUSH,\n\t[HTT_10_4_T2H_MSG_TYPE_PEER_MAP] = HTT_T2H_MSG_TYPE_PEER_MAP,\n\t[HTT_10_4_T2H_MSG_TYPE_PEER_UNMAP] = HTT_T2H_MSG_TYPE_PEER_UNMAP,\n\t[HTT_10_4_T2H_MSG_TYPE_RX_ADDBA] = HTT_T2H_MSG_TYPE_RX_ADDBA,\n\t[HTT_10_4_T2H_MSG_TYPE_RX_DELBA] = HTT_T2H_MSG_TYPE_RX_DELBA,\n\t[HTT_10_4_T2H_MSG_TYPE_TX_COMPL_IND] = HTT_T2H_MSG_TYPE_TX_COMPL_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_PKTLOG] = HTT_T2H_MSG_TYPE_PKTLOG,\n\t[HTT_10_4_T2H_MSG_TYPE_STATS_CONF] = HTT_T2H_MSG_TYPE_STATS_CONF,\n\t[HTT_10_4_T2H_MSG_TYPE_RX_FRAG_IND] = HTT_T2H_MSG_TYPE_RX_FRAG_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_SEC_IND] = HTT_T2H_MSG_TYPE_SEC_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_RC_UPDATE_IND] = HTT_T2H_MSG_TYPE_RC_UPDATE_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_TX_INSPECT_IND] =\n\t\t\t\tHTT_T2H_MSG_TYPE_TX_INSPECT_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_MGMT_TX_COMPL_IND] =\n\t\t\t\tHTT_T2H_MSG_TYPE_MGMT_TX_COMPLETION,\n\t[HTT_10_4_T2H_MSG_TYPE_CHAN_CHANGE] = HTT_T2H_MSG_TYPE_CHAN_CHANGE,\n\t[HTT_10_4_T2H_MSG_TYPE_TX_CREDIT_UPDATE_IND] =\n\t\t\t\tHTT_T2H_MSG_TYPE_TX_CREDIT_UPDATE_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_RX_PN_IND] = HTT_T2H_MSG_TYPE_RX_PN_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_RX_OFFLOAD_DELIVER_IND] =\n\t\t\t\tHTT_T2H_MSG_TYPE_RX_OFFLOAD_DELIVER_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_TEST] = HTT_T2H_MSG_TYPE_TEST,\n\t[HTT_10_4_T2H_MSG_TYPE_EN_STATS] = HTT_T2H_MSG_TYPE_EN_STATS,\n\t[HTT_10_4_T2H_MSG_TYPE_AGGR_CONF] = HTT_T2H_MSG_TYPE_AGGR_CONF,\n\t[HTT_10_4_T2H_MSG_TYPE_TX_FETCH_IND] =\n\t\t\t\tHTT_T2H_MSG_TYPE_TX_FETCH_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_TX_FETCH_CONFIRM] =\n\t\t\t\tHTT_T2H_MSG_TYPE_TX_FETCH_CONFIRM,\n\t[HTT_10_4_T2H_MSG_TYPE_STATS_NOUPLOAD] =\n\t\t\t\tHTT_T2H_MSG_TYPE_STATS_NOUPLOAD,\n\t[HTT_10_4_T2H_MSG_TYPE_TX_MODE_SWITCH_IND] =\n\t\t\t\tHTT_T2H_MSG_TYPE_TX_MODE_SWITCH_IND,\n\t[HTT_10_4_T2H_MSG_TYPE_PEER_STATS] =\n\t\t\t\tHTT_T2H_MSG_TYPE_PEER_STATS,\n};\n\nconst struct ath10k_htt_rx_desc_ops qca988x_rx_desc_ops = {\n\t.rx_desc_size = sizeof(struct htt_rx_desc_v1),\n\t.rx_desc_msdu_payload_offset = offsetof(struct htt_rx_desc_v1, msdu_payload)\n};\n\nstatic int ath10k_qca99x0_rx_desc_get_l3_pad_bytes(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v1 *rx_desc = container_of(rxd,\n\t\t\t\t\t\t      struct htt_rx_desc_v1,\n\t\t\t\t\t\t      base);\n\n\treturn MS(__le32_to_cpu(rx_desc->msdu_end.qca99x0.info1),\n\t\t  RX_MSDU_END_INFO1_L3_HDR_PAD);\n}\n\nstatic bool ath10k_qca99x0_rx_desc_msdu_limit_error(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v1 *rx_desc = container_of(rxd,\n\t\t\t\t\t\t      struct htt_rx_desc_v1,\n\t\t\t\t\t\t      base);\n\n\treturn !!(rx_desc->msdu_end.common.info0 &\n\t\t  __cpu_to_le32(RX_MSDU_END_INFO0_MSDU_LIMIT_ERR));\n}\n\nconst struct ath10k_htt_rx_desc_ops qca99x0_rx_desc_ops = {\n\t.rx_desc_size = sizeof(struct htt_rx_desc_v1),\n\t.rx_desc_msdu_payload_offset = offsetof(struct htt_rx_desc_v1, msdu_payload),\n\n\t.rx_desc_get_l3_pad_bytes = ath10k_qca99x0_rx_desc_get_l3_pad_bytes,\n\t.rx_desc_get_msdu_limit_error = ath10k_qca99x0_rx_desc_msdu_limit_error,\n};\n\nstatic void ath10k_rx_desc_wcn3990_get_offsets(struct htt_rx_ring_rx_desc_offsets *off)\n{\n#define desc_offset(x) (offsetof(struct htt_rx_desc_v2, x) / 4)\n\toff->mac80211_hdr_offset = __cpu_to_le16(desc_offset(rx_hdr_status));\n\toff->msdu_payload_offset = __cpu_to_le16(desc_offset(msdu_payload));\n\toff->ppdu_start_offset = __cpu_to_le16(desc_offset(ppdu_start));\n\toff->ppdu_end_offset = __cpu_to_le16(desc_offset(ppdu_end));\n\toff->mpdu_start_offset = __cpu_to_le16(desc_offset(mpdu_start));\n\toff->mpdu_end_offset = __cpu_to_le16(desc_offset(mpdu_end));\n\toff->msdu_start_offset = __cpu_to_le16(desc_offset(msdu_start));\n\toff->msdu_end_offset = __cpu_to_le16(desc_offset(msdu_end));\n\toff->rx_attention_offset = __cpu_to_le16(desc_offset(attention));\n\toff->frag_info_offset = __cpu_to_le16(desc_offset(frag_info));\n#undef desc_offset\n}\n\nstatic struct htt_rx_desc *\nath10k_rx_desc_wcn3990_from_raw_buffer(void *buff)\n{\n\treturn &((struct htt_rx_desc_v2 *)buff)->base;\n}\n\nstatic struct rx_attention *\nath10k_rx_desc_wcn3990_get_attention(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->attention;\n}\n\nstatic struct rx_frag_info_common *\nath10k_rx_desc_wcn3990_get_frag_info(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->frag_info.common;\n}\n\nstatic struct rx_mpdu_start *\nath10k_rx_desc_wcn3990_get_mpdu_start(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->mpdu_start;\n}\n\nstatic struct rx_mpdu_end *\nath10k_rx_desc_wcn3990_get_mpdu_end(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->mpdu_end;\n}\n\nstatic struct rx_msdu_start_common *\nath10k_rx_desc_wcn3990_get_msdu_start(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->msdu_start.common;\n}\n\nstatic struct rx_msdu_end_common *\nath10k_rx_desc_wcn3990_get_msdu_end(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->msdu_end.common;\n}\n\nstatic struct rx_ppdu_start *\nath10k_rx_desc_wcn3990_get_ppdu_start(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->ppdu_start;\n}\n\nstatic struct rx_ppdu_end_common *\nath10k_rx_desc_wcn3990_get_ppdu_end(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn &rx_desc->ppdu_end.common;\n}\n\nstatic u8 *\nath10k_rx_desc_wcn3990_get_rx_hdr_status(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn rx_desc->rx_hdr_status;\n}\n\nstatic u8 *\nath10k_rx_desc_wcn3990_get_msdu_payload(struct htt_rx_desc *rxd)\n{\n\tstruct htt_rx_desc_v2 *rx_desc = container_of(rxd, struct htt_rx_desc_v2, base);\n\n\treturn rx_desc->msdu_payload;\n}\n\nconst struct ath10k_htt_rx_desc_ops wcn3990_rx_desc_ops = {\n\t.rx_desc_size = sizeof(struct htt_rx_desc_v2),\n\t.rx_desc_msdu_payload_offset = offsetof(struct htt_rx_desc_v2, msdu_payload),\n\n\t.rx_desc_from_raw_buffer = ath10k_rx_desc_wcn3990_from_raw_buffer,\n\t.rx_desc_get_offsets = ath10k_rx_desc_wcn3990_get_offsets,\n\t.rx_desc_get_attention = ath10k_rx_desc_wcn3990_get_attention,\n\t.rx_desc_get_frag_info = ath10k_rx_desc_wcn3990_get_frag_info,\n\t.rx_desc_get_mpdu_start = ath10k_rx_desc_wcn3990_get_mpdu_start,\n\t.rx_desc_get_mpdu_end = ath10k_rx_desc_wcn3990_get_mpdu_end,\n\t.rx_desc_get_msdu_start = ath10k_rx_desc_wcn3990_get_msdu_start,\n\t.rx_desc_get_msdu_end = ath10k_rx_desc_wcn3990_get_msdu_end,\n\t.rx_desc_get_ppdu_start = ath10k_rx_desc_wcn3990_get_ppdu_start,\n\t.rx_desc_get_ppdu_end = ath10k_rx_desc_wcn3990_get_ppdu_end,\n\t.rx_desc_get_rx_hdr_status = ath10k_rx_desc_wcn3990_get_rx_hdr_status,\n\t.rx_desc_get_msdu_payload = ath10k_rx_desc_wcn3990_get_msdu_payload,\n};\n\nint ath10k_htt_connect(struct ath10k_htt *htt)\n{\n\tstruct ath10k_htc_svc_conn_req conn_req;\n\tstruct ath10k_htc_svc_conn_resp conn_resp;\n\tstruct ath10k *ar = htt->ar;\n\tstruct ath10k_htc_ep *ep;\n\tint status;\n\n\tmemset(&conn_req, 0, sizeof(conn_req));\n\tmemset(&conn_resp, 0, sizeof(conn_resp));\n\n\tconn_req.ep_ops.ep_tx_complete = ath10k_htt_htc_tx_complete;\n\tconn_req.ep_ops.ep_rx_complete = ath10k_htt_htc_t2h_msg_handler;\n\tconn_req.ep_ops.ep_tx_credits = ath10k_htt_op_ep_tx_credits;\n\n\t \n\tconn_req.service_id = ATH10K_HTC_SVC_ID_HTT_DATA_MSG;\n\n\tstatus = ath10k_htc_connect_service(&htt->ar->htc, &conn_req,\n\t\t\t\t\t    &conn_resp);\n\n\tif (status)\n\t\treturn status;\n\n\thtt->eid = conn_resp.eid;\n\n\tif (ar->bus_param.dev_type == ATH10K_DEV_TYPE_HL) {\n\t\tep = &ar->htc.endpoint[htt->eid];\n\t\tath10k_htc_setup_tx_req(ep);\n\t}\n\n\thtt->disable_tx_comp = ath10k_hif_get_htt_tx_complete(htt->ar);\n\tif (htt->disable_tx_comp)\n\t\tath10k_htc_change_tx_credit_flow(&htt->ar->htc, htt->eid, true);\n\n\treturn 0;\n}\n\nint ath10k_htt_init(struct ath10k *ar)\n{\n\tstruct ath10k_htt *htt = &ar->htt;\n\n\thtt->ar = ar;\n\n\t \n\thtt->prefetch_len =\n\t\t36 +  \n\t\t4 +  \n\t\t8 +  \n\t\t2;  \n\n\tswitch (ar->running_fw->fw_file.htt_op_version) {\n\tcase ATH10K_FW_HTT_OP_VERSION_10_4:\n\t\tar->htt.t2h_msg_types = htt_10_4_t2h_msg_types;\n\t\tar->htt.t2h_msg_types_max = HTT_10_4_T2H_NUM_MSGS;\n\t\tbreak;\n\tcase ATH10K_FW_HTT_OP_VERSION_10_1:\n\t\tar->htt.t2h_msg_types = htt_10x_t2h_msg_types;\n\t\tar->htt.t2h_msg_types_max = HTT_10X_T2H_NUM_MSGS;\n\t\tbreak;\n\tcase ATH10K_FW_HTT_OP_VERSION_TLV:\n\t\tar->htt.t2h_msg_types = htt_tlv_t2h_msg_types;\n\t\tar->htt.t2h_msg_types_max = HTT_TLV_T2H_NUM_MSGS;\n\t\tbreak;\n\tcase ATH10K_FW_HTT_OP_VERSION_MAIN:\n\t\tar->htt.t2h_msg_types = htt_main_t2h_msg_types;\n\t\tar->htt.t2h_msg_types_max = HTT_MAIN_T2H_NUM_MSGS;\n\t\tbreak;\n\tcase ATH10K_FW_HTT_OP_VERSION_MAX:\n\tcase ATH10K_FW_HTT_OP_VERSION_UNSET:\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\tath10k_htt_set_tx_ops(htt);\n\tath10k_htt_set_rx_ops(htt);\n\n\treturn 0;\n}\n\n#define HTT_TARGET_VERSION_TIMEOUT_HZ (3 * HZ)\n\nstatic int ath10k_htt_verify_version(struct ath10k_htt *htt)\n{\n\tstruct ath10k *ar = htt->ar;\n\n\tath10k_dbg(ar, ATH10K_DBG_BOOT, \"htt target version %d.%d\\n\",\n\t\t   htt->target_version_major, htt->target_version_minor);\n\n\tif (htt->target_version_major != 2 &&\n\t    htt->target_version_major != 3) {\n\t\tath10k_err(ar, \"unsupported htt major version %d. supported versions are 2 and 3\\n\",\n\t\t\t   htt->target_version_major);\n\t\treturn -ENOTSUPP;\n\t}\n\n\treturn 0;\n}\n\nint ath10k_htt_setup(struct ath10k_htt *htt)\n{\n\tstruct ath10k *ar = htt->ar;\n\tint status;\n\n\tinit_completion(&htt->target_version_received);\n\n\tstatus = ath10k_htt_h2t_ver_req_msg(htt);\n\tif (status)\n\t\treturn status;\n\n\tstatus = wait_for_completion_timeout(&htt->target_version_received,\n\t\t\t\t\t     HTT_TARGET_VERSION_TIMEOUT_HZ);\n\tif (status == 0) {\n\t\tath10k_warn(ar, \"htt version request timed out\\n\");\n\t\treturn -ETIMEDOUT;\n\t}\n\n\tstatus = ath10k_htt_verify_version(htt);\n\tif (status) {\n\t\tath10k_warn(ar, \"failed to verify htt version: %d\\n\",\n\t\t\t    status);\n\t\treturn status;\n\t}\n\n\tstatus = ath10k_htt_send_frag_desc_bank_cfg(htt);\n\tif (status)\n\t\treturn status;\n\n\tstatus = ath10k_htt_send_rx_ring_cfg(htt);\n\tif (status) {\n\t\tath10k_warn(ar, \"failed to setup rx ring: %d\\n\",\n\t\t\t    status);\n\t\treturn status;\n\t}\n\n\tstatus = ath10k_htt_h2t_aggr_cfg_msg(htt,\n\t\t\t\t\t     htt->max_num_ampdu,\n\t\t\t\t\t     htt->max_num_amsdu);\n\tif (status) {\n\t\tath10k_warn(ar, \"failed to setup amsdu/ampdu limit: %d\\n\",\n\t\t\t    status);\n\t\treturn status;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}