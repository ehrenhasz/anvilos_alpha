{
  "module_name": "testmode.c",
  "hash_id": "6358c1ff75e4e9b4f3d3a6b00b072f8a4afe42bcdcacf4617e342406fe17d7e0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath6kl/testmode.c",
  "human_readable_source": " \n\n#include \"testmode.h\"\n#include \"debug.h\"\n\n#include <net/netlink.h>\n\nenum ath6kl_tm_attr {\n\t__ATH6KL_TM_ATTR_INVALID\t= 0,\n\tATH6KL_TM_ATTR_CMD\t\t= 1,\n\tATH6KL_TM_ATTR_DATA\t\t= 2,\n\n\t \n\t__ATH6KL_TM_ATTR_AFTER_LAST,\n\tATH6KL_TM_ATTR_MAX\t\t= __ATH6KL_TM_ATTR_AFTER_LAST - 1,\n};\n\nenum ath6kl_tm_cmd {\n\tATH6KL_TM_CMD_TCMD\t\t= 0,\n\tATH6KL_TM_CMD_RX_REPORT\t\t= 1,\t \n};\n\n#define ATH6KL_TM_DATA_MAX_LEN\t\t5000\n\nstatic const struct nla_policy ath6kl_tm_policy[ATH6KL_TM_ATTR_MAX + 1] = {\n\t[ATH6KL_TM_ATTR_CMD]\t\t= { .type = NLA_U32 },\n\t[ATH6KL_TM_ATTR_DATA]\t\t= { .type = NLA_BINARY,\n\t\t\t\t\t    .len = ATH6KL_TM_DATA_MAX_LEN },\n};\n\nvoid ath6kl_tm_rx_event(struct ath6kl *ar, void *buf, size_t buf_len)\n{\n\tstruct sk_buff *skb;\n\n\tif (!buf || buf_len == 0)\n\t\treturn;\n\n\tskb = cfg80211_testmode_alloc_event_skb(ar->wiphy, buf_len, GFP_KERNEL);\n\tif (!skb) {\n\t\tath6kl_warn(\"failed to allocate testmode rx skb!\\n\");\n\t\treturn;\n\t}\n\tif (nla_put_u32(skb, ATH6KL_TM_ATTR_CMD, ATH6KL_TM_CMD_TCMD) ||\n\t    nla_put(skb, ATH6KL_TM_ATTR_DATA, buf_len, buf))\n\t\tgoto nla_put_failure;\n\tcfg80211_testmode_event(skb, GFP_KERNEL);\n\treturn;\n\nnla_put_failure:\n\tkfree_skb(skb);\n\tath6kl_warn(\"nla_put failed on testmode rx skb!\\n\");\n}\n\nint ath6kl_tm_cmd(struct wiphy *wiphy, struct wireless_dev *wdev,\n\t\t  void *data, int len)\n{\n\tstruct ath6kl *ar = wiphy_priv(wiphy);\n\tstruct nlattr *tb[ATH6KL_TM_ATTR_MAX + 1];\n\tint err, buf_len;\n\tvoid *buf;\n\n\terr = nla_parse_deprecated(tb, ATH6KL_TM_ATTR_MAX, data, len,\n\t\t\t\t   ath6kl_tm_policy, NULL);\n\tif (err)\n\t\treturn err;\n\n\tif (!tb[ATH6KL_TM_ATTR_CMD])\n\t\treturn -EINVAL;\n\n\tswitch (nla_get_u32(tb[ATH6KL_TM_ATTR_CMD])) {\n\tcase ATH6KL_TM_CMD_TCMD:\n\t\tif (!tb[ATH6KL_TM_ATTR_DATA])\n\t\t\treturn -EINVAL;\n\n\t\tbuf = nla_data(tb[ATH6KL_TM_ATTR_DATA]);\n\t\tbuf_len = nla_len(tb[ATH6KL_TM_ATTR_DATA]);\n\n\t\tath6kl_wmi_test_cmd(ar->wmi, buf, buf_len);\n\n\t\treturn 0;\n\n\tcase ATH6KL_TM_CMD_RX_REPORT:\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}