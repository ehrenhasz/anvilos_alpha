{
  "module_name": "htc.h",
  "hash_id": "7ffcc9cbad1b46bedcdda7fd16034d4189bf46fcd49f379d38998eb56599545d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath6kl/htc.h",
  "human_readable_source": " \n\n#ifndef HTC_H\n#define HTC_H\n\n#include \"common.h\"\n\n \n\n \n#define HTC_FLAGS_NEED_CREDIT_UPDATE (1 << 0)\n#define HTC_FLAGS_SEND_BUNDLE        (1 << 1)\n#define HTC_FLAGS_TX_FIXUP_NETBUF    (1 << 2)\n\n \n#define HTC_FLG_RX_UNUSED        (1 << 0)\n#define HTC_FLG_RX_TRAILER       (1 << 1)\n \n#define HTC_FLG_RX_BNDL_CNT\t (0xF0)\n#define HTC_FLG_RX_BNDL_CNT_S\t 4\n\n#define HTC_HDR_LENGTH  (sizeof(struct htc_frame_hdr))\n#define HTC_MAX_PAYLOAD_LENGTH   (4096 - sizeof(struct htc_frame_hdr))\n\n \n\n#define HTC_MSG_READY_ID\t\t1\n#define HTC_MSG_CONN_SVC_ID\t\t2\n#define HTC_MSG_CONN_SVC_RESP_ID\t3\n#define HTC_MSG_SETUP_COMPLETE_ID\t4\n#define HTC_MSG_SETUP_COMPLETE_EX_ID\t5\n\n#define HTC_MAX_CTRL_MSG_LEN  256\n\n#define HTC_VERSION_2P0  0x00\n#define HTC_VERSION_2P1  0x01\n\n#define HTC_SERVICE_META_DATA_MAX_LENGTH 128\n\n#define HTC_CONN_FLGS_THRESH_LVL_QUAT\t\t0x0\n#define HTC_CONN_FLGS_THRESH_LVL_HALF\t\t0x1\n#define HTC_CONN_FLGS_THRESH_LVL_THREE_QUAT\t0x2\n#define HTC_CONN_FLGS_REDUCE_CRED_DRIB\t\t0x4\n#define HTC_CONN_FLGS_THRESH_MASK\t\t0x3\n \n#define HTC_CONN_FLGS_DISABLE_CRED_FLOW_CTRL          (1 << 3)\n#define HTC_CONN_FLGS_SET_RECV_ALLOC_SHIFT    8\n#define HTC_CONN_FLGS_SET_RECV_ALLOC_MASK     0xFF00U\n\n \n#define HTC_SERVICE_SUCCESS      0\n#define HTC_SERVICE_NOT_FOUND    1\n#define HTC_SERVICE_FAILED       2\n\n \n#define HTC_SERVICE_NO_RESOURCES 3\n\n \n#define HTC_SERVICE_NO_MORE_EP   4\n\n \n#define HTC_RECORD_NULL             0\n#define HTC_RECORD_CREDITS          1\n#define HTC_RECORD_LOOKAHEAD        2\n#define HTC_RECORD_LOOKAHEAD_BUNDLE 3\n\n#define HTC_SETUP_COMP_FLG_RX_BNDL_EN     (1 << 0)\n#define HTC_SETUP_COMP_FLG_DISABLE_TX_CREDIT_FLOW (1 << 1)\n\n#define MAKE_SERVICE_ID(group, index) \\\n\t(int)(((int)group << 8) | (int)(index))\n\n \n#define HTC_CTRL_RSVD_SVC MAKE_SERVICE_ID(RSVD_SERVICE_GROUP, 1)\n#define WMI_CONTROL_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 0)\n#define WMI_DATA_BE_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 1)\n#define WMI_DATA_BK_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 2)\n#define WMI_DATA_VI_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 3)\n#define WMI_DATA_VO_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 4)\n#define WMI_MAX_SERVICES  5\n\n#define WMM_NUM_AC  4\n\n \n#define HTC_TX_PACKET_TAG_ALL          0\n#define HTC_SERVICE_TX_PACKET_TAG      1\n#define HTC_TX_PACKET_TAG_USER_DEFINED (HTC_SERVICE_TX_PACKET_TAG + 9)\n\n \n#define HTC_RX_FLAGS_INDICATE_MORE_PKTS  (1 << 0)\n\n \n#define ENDPOINT1 0\n \n#define HTC_MAILBOX_NUM_MAX    4\n\n \n#define HTC_FLGS_TX_BNDL_PAD_EN\t (1 << 0)\n#define HTC_EP_ACTIVE                            ((u32) (1u << 31))\n\n \n#define HTC_TARGET_RESPONSE_TIMEOUT        2000\t \n#define HTC_TARGET_RESPONSE_POLL_WAIT      10\n#define HTC_TARGET_RESPONSE_POLL_COUNT     200\n#define HTC_TARGET_DEBUG_INTR_MASK         0x01\n#define HTC_TARGET_CREDIT_INTR_MASK        0xF0\n\n#define HTC_HOST_MAX_MSG_PER_BUNDLE        8\n#define HTC_MIN_HTC_MSGS_TO_BUNDLE         2\n\n \n\n#define HTC_RX_PKT_IGNORE_LOOKAHEAD      (1 << 0)\n#define HTC_RX_PKT_REFRESH_HDR           (1 << 1)\n#define HTC_RX_PKT_PART_OF_BUNDLE        (1 << 2)\n#define HTC_RX_PKT_NO_RECYCLE            (1 << 3)\n\n#define NUM_CONTROL_BUFFERS     8\n#define NUM_CONTROL_TX_BUFFERS  2\n#define NUM_CONTROL_RX_BUFFERS  (NUM_CONTROL_BUFFERS - NUM_CONTROL_TX_BUFFERS)\n\n#define HTC_RECV_WAIT_BUFFERS        (1 << 0)\n#define HTC_OP_STATE_STOPPING        (1 << 0)\n#define HTC_OP_STATE_SETUP_COMPLETE  (1 << 1)\n\n \n\n \nstruct htc_frame_hdr {\n\tstruct_group_tagged(htc_frame_look_ahead, header,\n\t\tunion {\n\t\t\tstruct {\n\t\t\t\tu8 eid;\n\t\t\t\tu8 flags;\n\n\t\t\t\t \n\t\t\t\t__le16 payld_len;\n\n\t\t\t};\n\t\t\tu32 word;\n\t\t};\n\t);\n\t \n\n\tu8 ctrl[2];\n} __packed;\n\n \nstruct htc_ready_msg {\n\t__le16 msg_id;\n\t__le16 cred_cnt;\n\t__le16 cred_sz;\n\tu8 max_ep;\n\tu8 pad;\n} __packed;\n\n \nstruct htc_ready_ext_msg {\n\tstruct htc_ready_msg ver2_0_info;\n\tu8 htc_ver;\n\tu8 msg_per_htc_bndl;\n} __packed;\n\n \nstruct htc_conn_service_msg {\n\t__le16 msg_id;\n\t__le16 svc_id;\n\t__le16 conn_flags;\n\tu8 svc_meta_len;\n\tu8 pad;\n} __packed;\n\n \nstruct htc_conn_service_resp {\n\t__le16 msg_id;\n\t__le16 svc_id;\n\tu8 status;\n\tu8 eid;\n\t__le16 max_msg_sz;\n\tu8 svc_meta_len;\n\tu8 pad;\n} __packed;\n\nstruct htc_setup_comp_msg {\n\t__le16 msg_id;\n} __packed;\n\n \nstruct htc_setup_comp_ext_msg {\n\t__le16 msg_id;\n\t__le32 flags;\n\tu8 msg_per_rxbndl;\n\tu8 Rsvd[3];\n} __packed;\n\nstruct htc_record_hdr {\n\tu8 rec_id;\n\tu8 len;\n} __packed;\n\nstruct htc_credit_report {\n\tu8 eid;\n\tu8 credits;\n} __packed;\n\n \nstruct htc_lookahead_report {\n\tu8 pre_valid;\n\tu8 lk_ahd[4];\n\tu8 post_valid;\n} __packed;\n\nstruct htc_bundle_lkahd_rpt {\n\tu8 lk_ahd[4];\n} __packed;\n\n \n\nenum htc_service_grp_ids {\n\tRSVD_SERVICE_GROUP = 0,\n\tWMI_SERVICE_GROUP = 1,\n\n\tHTC_TEST_GROUP = 254,\n\tHTC_SERVICE_GROUP_LAST = 255\n};\n\n \n\nenum htc_endpoint_id {\n\tENDPOINT_UNUSED = -1,\n\tENDPOINT_0 = 0,\n\tENDPOINT_1 = 1,\n\tENDPOINT_2 = 2,\n\tENDPOINT_3,\n\tENDPOINT_4,\n\tENDPOINT_5,\n\tENDPOINT_6,\n\tENDPOINT_7,\n\tENDPOINT_8,\n\tENDPOINT_MAX,\n};\n\nstruct htc_tx_packet_info {\n\tu16 tag;\n\tint cred_used;\n\tu8 flags;\n\tint seqno;\n};\n\nstruct htc_rx_packet_info {\n\tu32 exp_hdr;\n\tu32 rx_flags;\n\tu32 indicat_flags;\n};\n\nstruct htc_target;\n\n \nstruct htc_packet {\n\tstruct list_head list;\n\n\t \n\tvoid *pkt_cntxt;\n\n\t \n\tu8 *buf_start;\n\n\t \n\tu8 *buf;\n\tu32 buf_len;\n\n\t \n\tu32 act_len;\n\n\t \n\tenum htc_endpoint_id endpoint;\n\n\t \n\n\tint status;\n\tunion {\n\t\tstruct htc_tx_packet_info tx;\n\t\tstruct htc_rx_packet_info rx;\n\t} info;\n\n\tvoid (*completion) (struct htc_target *, struct htc_packet *);\n\tstruct htc_target *context;\n\n\t \n\tstruct sk_buff *skb;\n};\n\nenum htc_send_full_action {\n\tHTC_SEND_FULL_KEEP = 0,\n\tHTC_SEND_FULL_DROP = 1,\n};\n\nstruct htc_ep_callbacks {\n\tvoid (*tx_complete) (struct htc_target *, struct htc_packet *);\n\tvoid (*rx) (struct htc_target *, struct htc_packet *);\n\tvoid (*rx_refill) (struct htc_target *, enum htc_endpoint_id endpoint);\n\tenum htc_send_full_action (*tx_full) (struct htc_target *,\n\t\t\t\t\t      struct htc_packet *);\n\tstruct htc_packet *(*rx_allocthresh) (struct htc_target *,\n\t\t\t\t\t      enum htc_endpoint_id, int);\n\tvoid (*tx_comp_multi) (struct htc_target *, struct list_head *);\n\tint rx_alloc_thresh;\n\tint rx_refill_thresh;\n};\n\n \nstruct htc_service_connect_req {\n\tu16 svc_id;\n\tu16 conn_flags;\n\tstruct htc_ep_callbacks ep_cb;\n\tint max_txq_depth;\n\tu32 flags;\n\tunsigned int max_rxmsg_sz;\n};\n\n \nstruct htc_service_connect_resp {\n\tu8 buf_len;\n\tu8 act_len;\n\tenum htc_endpoint_id endpoint;\n\tunsigned int len_max;\n\tu8 resp_code;\n};\n\n \nstruct htc_endpoint_credit_dist {\n\tstruct list_head list;\n\n\t \n\tu16 svc_id;\n\n\t \n\tenum htc_endpoint_id endpoint;\n\n\tu32 dist_flags;\n\n\t \n\tint cred_norm;\n\n\t \n\tint cred_min;\n\n\tint cred_assngd;\n\n\t \n\tint credits;\n\n\t \n\tint cred_to_dist;\n\n\t \n\tint seek_cred;\n\n\t \n\tint cred_sz;\n\n\t \n\tint cred_per_msg;\n\n\t \n\tstruct htc_endpoint *htc_ep;\n\n\t \n\tint txq_depth;\n};\n\n \nenum htc_credit_dist_reason {\n\tHTC_CREDIT_DIST_SEND_COMPLETE = 0,\n\tHTC_CREDIT_DIST_ACTIVITY_CHANGE = 1,\n\tHTC_CREDIT_DIST_SEEK_CREDITS,\n};\n\nstruct ath6kl_htc_credit_info {\n\tint total_avail_credits;\n\tint cur_free_credits;\n\n\t \n\tstruct list_head lowestpri_ep_dist;\n};\n\n \nstruct htc_endpoint_stats {\n\t \n\tu32 cred_low_indicate;\n\n\tu32 tx_issued;\n\tu32 tx_pkt_bundled;\n\tu32 tx_bundles;\n\tu32 tx_dropped;\n\n\t \n\tu32 tx_cred_rpt;\n\n\t \n\tu32 cred_rpt_from_rx;\n\n\t \n\tu32 cred_rpt_from_other;\n\n\t \n\tu32 cred_rpt_ep0;\n\n\t \n\tu32 cred_from_rx;\n\n\t \n\tu32 cred_from_other;\n\n\t \n\tu32 cred_from_ep0;\n\n\t \n\tu32 cred_cosumd;\n\n\t \n\tu32 cred_retnd;\n\n\tu32 rx_pkts;\n\n\t \n\tu32 rx_lkahds;\n\n\t \n\tu32 rx_bundl;\n\n\t \n\tu32 rx_bundle_lkahd;\n\n\t \n\tu32 rx_bundle_from_hdr;\n\n\t \n\tu32 rx_alloc_thresh_hit;\n\n\t \n\tu32 rxalloc_thresh_byte;\n};\n\nstruct htc_endpoint {\n\tenum htc_endpoint_id eid;\n\tu16 svc_id;\n\tstruct list_head txq;\n\tstruct list_head rx_bufq;\n\tstruct htc_endpoint_credit_dist cred_dist;\n\tstruct htc_ep_callbacks ep_cb;\n\tint max_txq_depth;\n\tint len_max;\n\tint tx_proc_cnt;\n\tint rx_proc_cnt;\n\tstruct htc_target *target;\n\tu8 seqno;\n\tu32 conn_flags;\n\tstruct htc_endpoint_stats ep_st;\n\tu16 tx_drop_packet_threshold;\n\n\tstruct {\n\t\tu8 pipeid_ul;\n\t\tu8 pipeid_dl;\n\t\tstruct list_head tx_lookup_queue;\n\t\tbool tx_credit_flow_enabled;\n\t} pipe;\n};\n\nstruct htc_control_buffer {\n\tstruct htc_packet packet;\n\tu8 *buf;\n};\n\nstruct htc_pipe_txcredit_alloc {\n\tu16 service_id;\n\tu8 credit_alloc;\n};\n\nenum htc_send_queue_result {\n\tHTC_SEND_QUEUE_OK = 0,\t \n\tHTC_SEND_QUEUE_DROP = 1,\t \n};\n\nstruct ath6kl_htc_ops {\n\tvoid* (*create)(struct ath6kl *ar);\n\tint (*wait_target)(struct htc_target *target);\n\tint (*start)(struct htc_target *target);\n\tint (*conn_service)(struct htc_target *target,\n\t\t\t    struct htc_service_connect_req *req,\n\t\t\t    struct htc_service_connect_resp *resp);\n\tint  (*tx)(struct htc_target *target, struct htc_packet *packet);\n\tvoid (*stop)(struct htc_target *target);\n\tvoid (*cleanup)(struct htc_target *target);\n\tvoid (*flush_txep)(struct htc_target *target,\n\t\t\t   enum htc_endpoint_id endpoint, u16 tag);\n\tvoid (*flush_rx_buf)(struct htc_target *target);\n\tvoid (*activity_changed)(struct htc_target *target,\n\t\t\t\t enum htc_endpoint_id endpoint,\n\t\t\t\t bool active);\n\tint (*get_rxbuf_num)(struct htc_target *target,\n\t\t\t     enum htc_endpoint_id endpoint);\n\tint (*add_rxbuf_multiple)(struct htc_target *target,\n\t\t\t\t  struct list_head *pktq);\n\tint (*credit_setup)(struct htc_target *target,\n\t\t\t    struct ath6kl_htc_credit_info *cred_info);\n\tint (*tx_complete)(struct ath6kl *ar, struct sk_buff *skb);\n\tint (*rx_complete)(struct ath6kl *ar, struct sk_buff *skb, u8 pipe);\n};\n\nstruct ath6kl_device;\n\n \nstruct htc_target {\n\tstruct htc_endpoint endpoint[ENDPOINT_MAX];\n\n\t \n\tstruct list_head cred_dist_list;\n\n\tstruct list_head free_ctrl_txbuf;\n\tstruct list_head free_ctrl_rxbuf;\n\tstruct ath6kl_htc_credit_info *credit_info;\n\tint tgt_creds;\n\tunsigned int tgt_cred_sz;\n\n\t \n\tspinlock_t htc_lock;\n\n\t \n\tspinlock_t rx_lock;\n\n\t \n\tspinlock_t tx_lock;\n\n\tstruct ath6kl_device *dev;\n\tu32 htc_flags;\n\tu32 rx_st_flags;\n\tenum htc_endpoint_id ep_waiting;\n\tu8 htc_tgt_ver;\n\n\t \n\tint msg_per_bndl_max;\n\n\tu32 tx_bndl_mask;\n\tint rx_bndl_enable;\n\tint max_rx_bndl_sz;\n\tint max_tx_bndl_sz;\n\n\tu32 block_sz;\n\tu32 block_mask;\n\n\tint max_scat_entries;\n\tint max_xfer_szper_scatreq;\n\n\tint chk_irq_status_cnt;\n\n\t \n\tu32 ac_tx_count[WMM_NUM_AC];\n\n\tstruct {\n\t\tstruct htc_packet *htc_packet_pool;\n\t\tu8 ctrl_response_buf[HTC_MAX_CTRL_MSG_LEN];\n\t\tint ctrl_response_len;\n\t\tbool ctrl_response_valid;\n\t\tstruct htc_pipe_txcredit_alloc txcredit_alloc[ENDPOINT_MAX];\n\t} pipe;\n};\n\nint ath6kl_htc_rxmsg_pending_handler(struct htc_target *target,\n\t\t\t\t     u32 msg_look_ahead, int *n_pkts);\n\nstatic inline void set_htc_pkt_info(struct htc_packet *packet, void *context,\n\t\t\t\t    u8 *buf, unsigned int len,\n\t\t\t\t    enum htc_endpoint_id eid, u16 tag)\n{\n\tpacket->pkt_cntxt = context;\n\tpacket->buf = buf;\n\tpacket->act_len = len;\n\tpacket->endpoint = eid;\n\tpacket->info.tx.tag = tag;\n}\n\nstatic inline void htc_rxpkt_reset(struct htc_packet *packet)\n{\n\tpacket->buf = packet->buf_start;\n\tpacket->act_len = 0;\n}\n\nstatic inline void set_htc_rxpkt_info(struct htc_packet *packet, void *context,\n\t\t\t\t      u8 *buf, unsigned long len,\n\t\t\t\t      enum htc_endpoint_id eid)\n{\n\tpacket->pkt_cntxt = context;\n\tpacket->buf = buf;\n\tpacket->buf_start = buf;\n\tpacket->buf_len = len;\n\tpacket->endpoint = eid;\n}\n\nstatic inline int get_queue_depth(struct list_head *queue)\n{\n\tstruct list_head *tmp_list;\n\tint depth = 0;\n\n\tlist_for_each(tmp_list, queue)\n\t    depth++;\n\n\treturn depth;\n}\n\nvoid ath6kl_htc_pipe_attach(struct ath6kl *ar);\nvoid ath6kl_htc_mbox_attach(struct ath6kl *ar);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}