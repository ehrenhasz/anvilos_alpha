{
  "module_name": "cmd.h",
  "hash_id": "0475ef45bbf2694032bb905fd36d23ada35efe2a8a6d2215e1fae6e4f5af1e2d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/carl9170/cmd.h",
  "human_readable_source": " \n#ifndef __CMD_H\n#define __CMD_H\n\n#include \"carl9170.h\"\n\n \nint carl9170_write_reg(struct ar9170 *ar, const u32 reg, const u32 val);\nint carl9170_read_reg(struct ar9170 *ar, const u32 reg, u32 *val);\nint carl9170_read_mreg(struct ar9170 *ar, const int nregs,\n\t\t       const u32 *regs, u32 *out);\nint carl9170_echo_test(struct ar9170 *ar, u32 v);\nint carl9170_reboot(struct ar9170 *ar);\nint carl9170_mac_reset(struct ar9170 *ar);\nint carl9170_powersave(struct ar9170 *ar, const bool power_on);\nint carl9170_collect_tally(struct ar9170 *ar);\nint carl9170_bcn_ctrl(struct ar9170 *ar, const unsigned int vif_id,\n\t\t       const u32 mode, const u32 addr, const u32 len);\n\nstatic inline int carl9170_flush_cab(struct ar9170 *ar,\n\t\t\t\t     const unsigned int vif_id)\n{\n\treturn carl9170_bcn_ctrl(ar, vif_id, CARL9170_BCN_CTRL_DRAIN, 0, 0);\n}\n\nstatic inline int carl9170_rx_filter(struct ar9170 *ar,\n\t\t\t\t     const unsigned int _rx_filter)\n{\n\t__le32 rx_filter = cpu_to_le32(_rx_filter);\n\n\treturn carl9170_exec_cmd(ar, CARL9170_CMD_RX_FILTER,\n\t\t\t\tsizeof(rx_filter), (u8 *)&rx_filter,\n\t\t\t\t0, NULL);\n}\n\nstruct carl9170_cmd *carl9170_cmd_buf(struct ar9170 *ar,\n\tconst enum carl9170_cmd_oids cmd, const unsigned int len);\n\n \n#define carl9170_regwrite_begin(ar)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tint __nreg = 0, __err = 0;\t\t\t\t\t\\\n\tstruct ar9170 *__ar = ar;\n\n#define carl9170_regwrite(r, v) do {\t\t\t\t\t\\\n\t__ar->cmd_buf[2 * __nreg + 1] = cpu_to_le32(r);\t\t\t\\\n\t__ar->cmd_buf[2 * __nreg + 2] = cpu_to_le32(v);\t\t\t\\\n\t__nreg++;\t\t\t\t\t\t\t\\\n\tif ((__nreg >= PAYLOAD_MAX / 2)) {\t\t\t\t\\\n\t\tif (IS_ACCEPTING_CMD(__ar))\t\t\t\t\\\n\t\t\t__err = carl9170_exec_cmd(__ar,\t\t\t\\\n\t\t\t\tCARL9170_CMD_WREG, 8 * __nreg,\t\t\\\n\t\t\t\t(u8 *) &__ar->cmd_buf[1], 0, NULL);\t\\\n\t\telse\t\t\t\t\t\t\t\\\n\t\t\tgoto __regwrite_out;\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\t\t__nreg = 0;\t\t\t\t\t\t\\\n\t\tif (__err)\t\t\t\t\t\t\\\n\t\t\tgoto __regwrite_out;\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#define carl9170_regwrite_finish()\t\t\t\t\t\\\n__regwrite_out :\t\t\t\t\t\t\t\\\n\tif (__err == 0 && __nreg) {\t\t\t\t\t\\\n\t\tif (IS_ACCEPTING_CMD(__ar))\t\t\t\t\\\n\t\t\t__err = carl9170_exec_cmd(__ar,\t\t\t\\\n\t\t\t\tCARL9170_CMD_WREG, 8 * __nreg,\t\t\\\n\t\t\t\t(u8 *) &__ar->cmd_buf[1], 0, NULL);\t\\\n\t\t__nreg = 0;\t\t\t\t\t\t\\\n\t}\n\n#define carl9170_regwrite_result()\t\t\t\t\t\\\n\t__err;\t\t\t\t\t\t\t\t\\\n} while (0)\n\n\n#define carl9170_async_regwrite_get_buf()\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\t__nreg = 0;\t\t\t\t\t\t\t\\\n\t__cmd = carl9170_cmd_buf(__carl, CARL9170_CMD_WREG_ASYNC,\t\\\n\t\t\t\t CARL9170_MAX_CMD_PAYLOAD_LEN);\t\t\\\n\tif (__cmd == NULL) {\t\t\t\t\t\t\\\n\t\t__err = -ENOMEM;\t\t\t\t\t\\\n\t\tgoto __async_regwrite_out;\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#define carl9170_async_regwrite_begin(carl)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tstruct ar9170 *__carl = carl;\t\t\t\t\t\\\n\tstruct carl9170_cmd *__cmd;\t\t\t\t\t\\\n\tunsigned int __nreg;\t\t\t\t\t\t\\\n\tint  __err = 0;\t\t\t\t\t\t\t\\\n\tcarl9170_async_regwrite_get_buf();\t\t\t\t\\\n\n#define carl9170_async_regwrite_flush()\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (__cmd == NULL || __nreg == 0)\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\n\tif (IS_ACCEPTING_CMD(__carl) && __nreg) {\t\t\t\\\n\t\t__cmd->hdr.len = 8 * __nreg;\t\t\t\t\\\n\t\t__err = __carl9170_exec_cmd(__carl, __cmd, true);\t\\\n\t\t__cmd = NULL;\t\t\t\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\tgoto __async_regwrite_out;\t\t\t\t\t\\\n} while (0)\n\n#define carl9170_async_regwrite(r, v) do {\t\t\t\t\\\n\tif (__cmd == NULL)\t\t\t\t\t\t\\\n\t\tcarl9170_async_regwrite_get_buf();\t\t\t\\\n\t__cmd->wreg.regs[__nreg].addr = cpu_to_le32(r);\t\t\t\\\n\t__cmd->wreg.regs[__nreg].val = cpu_to_le32(v);\t\t\t\\\n\t__nreg++;\t\t\t\t\t\t\t\\\n\tif ((__nreg >= PAYLOAD_MAX / 2))\t\t\t\t\\\n\t\tcarl9170_async_regwrite_flush();\t\t\t\\\n} while (0)\n\n#define carl9170_async_regwrite_finish() do {\t\t\t\t\\\n__async_regwrite_out:\t\t\t\t\t\t\t\\\n\tif (__cmd != NULL && __err == 0)\t\t\t\t\\\n\t\tcarl9170_async_regwrite_flush();\t\t\t\\\n\tkfree(__cmd);\t\t\t\t\t\t\t\\\n} while (0)\t\t\t\t\t\t\t\t\\\n\n#define carl9170_async_regwrite_result()\t\t\t\t\\\n\t__err;\t\t\t\t\t\t\t\t\\\n} while (0)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}