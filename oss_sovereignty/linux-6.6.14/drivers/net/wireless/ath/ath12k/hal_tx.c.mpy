{
  "module_name": "hal_tx.c",
  "hash_id": "913993f1e43b03f45a43cb742578a25d40ee7e03fe3cebb81fe0d0b0b91e2583",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath12k/hal_tx.c",
  "human_readable_source": "\n \n\n#include \"hal_desc.h\"\n#include \"hal.h\"\n#include \"hal_tx.h\"\n#include \"hif.h\"\n\n#define DSCP_TID_MAP_TBL_ENTRY_SIZE 64\n\n \nstatic inline u8 dscp2tid(u8 dscp)\n{\n\treturn dscp >> 3;\n}\n\nvoid ath12k_hal_tx_cmd_desc_setup(struct ath12k_base *ab,\n\t\t\t\t  struct hal_tcl_data_cmd *tcl_cmd,\n\t\t\t\t  struct hal_tx_info *ti)\n{\n\ttcl_cmd->buf_addr_info.info0 =\n\t\tle32_encode_bits(ti->paddr, BUFFER_ADDR_INFO0_ADDR);\n\ttcl_cmd->buf_addr_info.info1 =\n\t\tle32_encode_bits(((uint64_t)ti->paddr >> HAL_ADDR_MSB_REG_SHIFT),\n\t\t\t\t BUFFER_ADDR_INFO1_ADDR);\n\ttcl_cmd->buf_addr_info.info1 |=\n\t\tle32_encode_bits((ti->rbm_id), BUFFER_ADDR_INFO1_RET_BUF_MGR) |\n\t\tle32_encode_bits(ti->desc_id, BUFFER_ADDR_INFO1_SW_COOKIE);\n\n\ttcl_cmd->info0 =\n\t\tle32_encode_bits(ti->type, HAL_TCL_DATA_CMD_INFO0_DESC_TYPE) |\n\t\tle32_encode_bits(ti->bank_id, HAL_TCL_DATA_CMD_INFO0_BANK_ID);\n\n\ttcl_cmd->info1 =\n\t\tle32_encode_bits(ti->meta_data_flags,\n\t\t\t\t HAL_TCL_DATA_CMD_INFO1_CMD_NUM);\n\n\ttcl_cmd->info2 = cpu_to_le32(ti->flags0) |\n\t\tle32_encode_bits(ti->data_len, HAL_TCL_DATA_CMD_INFO2_DATA_LEN) |\n\t\tle32_encode_bits(ti->pkt_offset, HAL_TCL_DATA_CMD_INFO2_PKT_OFFSET);\n\n\ttcl_cmd->info3 = cpu_to_le32(ti->flags1) |\n\t\tle32_encode_bits(ti->tid, HAL_TCL_DATA_CMD_INFO3_TID) |\n\t\tle32_encode_bits(ti->lmac_id, HAL_TCL_DATA_CMD_INFO3_PMAC_ID) |\n\t\tle32_encode_bits(ti->vdev_id, HAL_TCL_DATA_CMD_INFO3_VDEV_ID);\n\n\ttcl_cmd->info4 = le32_encode_bits(ti->bss_ast_idx,\n\t\t\t\t\t  HAL_TCL_DATA_CMD_INFO4_SEARCH_INDEX) |\n\t\t\t le32_encode_bits(ti->bss_ast_hash,\n\t\t\t\t\t  HAL_TCL_DATA_CMD_INFO4_CACHE_SET_NUM);\n\ttcl_cmd->info5 = 0;\n}\n\nvoid ath12k_hal_tx_set_dscp_tid_map(struct ath12k_base *ab, int id)\n{\n\tu32 ctrl_reg_val;\n\tu32 addr;\n\tu8 hw_map_val[HAL_DSCP_TID_TBL_SIZE], dscp, tid;\n\tint i;\n\tu32 value;\n\n\tctrl_reg_val = ath12k_hif_read32(ab, HAL_SEQ_WCSS_UMAC_TCL_REG +\n\t\t\t\t\t HAL_TCL1_RING_CMN_CTRL_REG);\n\t \n\tctrl_reg_val |= HAL_TCL1_RING_CMN_CTRL_DSCP_TID_MAP_PROG_EN;\n\tath12k_hif_write32(ab, HAL_SEQ_WCSS_UMAC_TCL_REG +\n\t\t\t   HAL_TCL1_RING_CMN_CTRL_REG, ctrl_reg_val);\n\n\taddr = HAL_SEQ_WCSS_UMAC_TCL_REG + HAL_TCL1_RING_DSCP_TID_MAP +\n\t       (4 * id * (HAL_DSCP_TID_TBL_SIZE / 4));\n\n\t \n\tfor (i = 0, dscp = 0; i < HAL_DSCP_TID_TBL_SIZE; i += 3) {\n\t\ttid = dscp2tid(dscp);\n\t\tvalue = u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP0);\n\t\tdscp++;\n\n\t\ttid = dscp2tid(dscp);\n\t\tvalue |= u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP1);\n\t\tdscp++;\n\n\t\ttid = dscp2tid(dscp);\n\t\tvalue |= u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP2);\n\t\tdscp++;\n\n\t\ttid = dscp2tid(dscp);\n\t\tvalue |= u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP3);\n\t\tdscp++;\n\n\t\ttid = dscp2tid(dscp);\n\t\tvalue |= u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP4);\n\t\tdscp++;\n\n\t\ttid = dscp2tid(dscp);\n\t\tvalue |= u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP5);\n\t\tdscp++;\n\n\t\ttid = dscp2tid(dscp);\n\t\tvalue |= u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP6);\n\t\tdscp++;\n\n\t\ttid = dscp2tid(dscp);\n\t\tvalue |= u32_encode_bits(tid, HAL_TCL1_RING_FIELD_DSCP_TID_MAP7);\n\t\tdscp++;\n\n\t\tmemcpy(&hw_map_val[i], &value, 3);\n\t}\n\n\tfor (i = 0; i < HAL_DSCP_TID_TBL_SIZE; i += 4) {\n\t\tath12k_hif_write32(ab, addr, *(u32 *)&hw_map_val[i]);\n\t\taddr += 4;\n\t}\n\n\t \n\tctrl_reg_val = ath12k_hif_read32(ab, HAL_SEQ_WCSS_UMAC_TCL_REG +\n\t\t\t\t\t HAL_TCL1_RING_CMN_CTRL_REG);\n\tctrl_reg_val &= ~HAL_TCL1_RING_CMN_CTRL_DSCP_TID_MAP_PROG_EN;\n\tath12k_hif_write32(ab, HAL_SEQ_WCSS_UMAC_TCL_REG +\n\t\t\t   HAL_TCL1_RING_CMN_CTRL_REG,\n\t\t\t   ctrl_reg_val);\n}\n\nvoid ath12k_hal_tx_configure_bank_register(struct ath12k_base *ab, u32 bank_config,\n\t\t\t\t\t   u8 bank_id)\n{\n\tath12k_hif_write32(ab, HAL_TCL_SW_CONFIG_BANK_ADDR + 4 * bank_id,\n\t\t\t   bank_config);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}