{
  "module_name": "ethtool.c",
  "hash_id": "78a4d35021f2f36b81df34fa364c96442ed6b866490c76ecbf8fa52dbef8da9a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/wil6210/ethtool.c",
  "human_readable_source": "\n \n\n#include <linux/etherdevice.h>\n#include <linux/pci.h>\n#include <linux/rtnetlink.h>\n#include <net/cfg80211.h>\n\n#include \"wil6210.h\"\n\nstatic int\nwil_ethtoolops_get_coalesce(struct net_device *ndev,\n\t\t\t    struct ethtool_coalesce *cp,\n\t\t\t    struct kernel_ethtool_coalesce *kernel_coal,\n\t\t\t    struct netlink_ext_ack *extack)\n{\n\tstruct wil6210_priv *wil = ndev_to_wil(ndev);\n\tu32 tx_itr_en, tx_itr_val = 0;\n\tu32 rx_itr_en, rx_itr_val = 0;\n\tint ret;\n\n\tmutex_lock(&wil->mutex);\n\twil_dbg_misc(wil, \"ethtoolops_get_coalesce\\n\");\n\n\tret = wil_pm_runtime_get(wil);\n\tif (ret < 0)\n\t\tgoto out;\n\n\ttx_itr_en = wil_r(wil, RGF_DMA_ITR_TX_CNT_CTL);\n\tif (tx_itr_en & BIT_DMA_ITR_TX_CNT_CTL_EN)\n\t\ttx_itr_val = wil_r(wil, RGF_DMA_ITR_TX_CNT_TRSH);\n\n\trx_itr_en = wil_r(wil, RGF_DMA_ITR_RX_CNT_CTL);\n\tif (rx_itr_en & BIT_DMA_ITR_RX_CNT_CTL_EN)\n\t\trx_itr_val = wil_r(wil, RGF_DMA_ITR_RX_CNT_TRSH);\n\n\twil_pm_runtime_put(wil);\n\n\tcp->tx_coalesce_usecs = tx_itr_val;\n\tcp->rx_coalesce_usecs = rx_itr_val;\n\tret = 0;\n\nout:\n\tmutex_unlock(&wil->mutex);\n\treturn ret;\n}\n\nstatic int\nwil_ethtoolops_set_coalesce(struct net_device *ndev,\n\t\t\t    struct ethtool_coalesce *cp,\n\t\t\t    struct kernel_ethtool_coalesce *kernel_coal,\n\t\t\t    struct netlink_ext_ack *extack)\n{\n\tstruct wil6210_priv *wil = ndev_to_wil(ndev);\n\tstruct wireless_dev *wdev = ndev->ieee80211_ptr;\n\tint ret;\n\n\tmutex_lock(&wil->mutex);\n\twil_dbg_misc(wil, \"ethtoolops_set_coalesce: rx %d usec, tx %d usec\\n\",\n\t\t     cp->rx_coalesce_usecs, cp->tx_coalesce_usecs);\n\n\tif (wdev->iftype == NL80211_IFTYPE_MONITOR) {\n\t\twil_dbg_misc(wil, \"No IRQ coalescing in monitor mode\\n\");\n\t\tret = -EINVAL;\n\t\tgoto out;\n\t}\n\n\t \n\n\tif (cp->rx_coalesce_usecs > WIL6210_ITR_TRSH_MAX ||\n\t    cp->tx_coalesce_usecs > WIL6210_ITR_TRSH_MAX)\n\t\tgoto out_bad;\n\n\twil->tx_max_burst_duration = cp->tx_coalesce_usecs;\n\twil->rx_max_burst_duration = cp->rx_coalesce_usecs;\n\n\tret = wil_pm_runtime_get(wil);\n\tif (ret < 0)\n\t\tgoto out;\n\n\twil->txrx_ops.configure_interrupt_moderation(wil);\n\n\twil_pm_runtime_put(wil);\n\tret = 0;\n\nout:\n\tmutex_unlock(&wil->mutex);\n\treturn ret;\n\nout_bad:\n\twil_dbg_misc(wil, \"Unsupported coalescing params. Raw command:\\n\");\n\tprint_hex_dump_debug(\"DBG[MISC] coal \", DUMP_PREFIX_OFFSET, 16, 4,\n\t\t\t     cp, sizeof(*cp), false);\n\tmutex_unlock(&wil->mutex);\n\treturn -EINVAL;\n}\n\nstatic const struct ethtool_ops wil_ethtool_ops = {\n\t.supported_coalesce_params = ETHTOOL_COALESCE_USECS,\n\t.get_drvinfo\t= cfg80211_get_drvinfo,\n\t.get_coalesce\t= wil_ethtoolops_get_coalesce,\n\t.set_coalesce\t= wil_ethtoolops_set_coalesce,\n};\n\nvoid wil_set_ethtoolops(struct net_device *ndev)\n{\n\tndev->ethtool_ops = &wil_ethtool_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}