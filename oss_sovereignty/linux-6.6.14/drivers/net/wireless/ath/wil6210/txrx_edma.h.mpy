{
  "module_name": "txrx_edma.h",
  "hash_id": "b625b6f8a4c1b68316026267a9e6e5f543186ffb1b83a8029de206ef78fbbbce",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/wil6210/txrx_edma.h",
  "human_readable_source": " \n \n\n#ifndef WIL6210_TXRX_EDMA_H\n#define WIL6210_TXRX_EDMA_H\n\n#include \"wil6210.h\"\n\n \n#define WIL_SRING_SIZE_ORDER_MIN\t(WIL_RING_SIZE_ORDER_MIN)\n#define WIL_SRING_SIZE_ORDER_MAX\t(WIL_RING_SIZE_ORDER_MAX)\n \n#define WIL_RX_SRING_SIZE_ORDER_DEFAULT\t(12)\n#define WIL_TX_SRING_SIZE_ORDER_DEFAULT\t(14)\n#define WIL_RX_BUFF_ARR_SIZE_DEFAULT (2600)\n\n#define WIL_DEFAULT_RX_STATUS_RING_ID 0\n#define WIL_RX_DESC_RING_ID 0\n#define WIL_RX_STATUS_IRQ_IDX 0\n#define WIL_TX_STATUS_IRQ_IDX 1\n\n#define WIL_EDMA_AGG_WATERMARK (0xffff)\n#define WIL_EDMA_AGG_WATERMARK_POS (16)\n\n#define WIL_EDMA_IDLE_TIME_LIMIT_USEC (50)\n#define WIL_EDMA_TIME_UNIT_CLK_CYCLES (330)  \n\n \n#define WIL_RX_EDMA_ERROR_MIC\t(1)\n#define WIL_RX_EDMA_ERROR_KEY\t(2)  \n#define WIL_RX_EDMA_ERROR_REPLAY\t(3)\n#define WIL_RX_EDMA_ERROR_AMSDU\t(4)\n#define WIL_RX_EDMA_ERROR_FCS\t(7)\n\n#define WIL_RX_EDMA_ERROR_L3_ERR\t(BIT(0) | BIT(1))\n#define WIL_RX_EDMA_ERROR_L4_ERR\t(BIT(0) | BIT(1))\n\n#define WIL_RX_EDMA_DLPF_LU_MISS_BIT\t\tBIT(11)\n#define WIL_RX_EDMA_DLPF_LU_MISS_CID_TID_MASK\t0x7\n#define WIL_RX_EDMA_DLPF_LU_HIT_CID_TID_MASK\t0xf\n\n#define WIL_RX_EDMA_DLPF_LU_MISS_CID_POS\t2\n#define WIL_RX_EDMA_DLPF_LU_HIT_CID_POS\t\t4\n\n#define WIL_RX_EDMA_DLPF_LU_MISS_TID_POS\t5\n\n#define WIL_RX_EDMA_MID_VALID_BIT\t\tBIT(20)\n\n#define WIL_EDMA_DESC_TX_MAC_CFG_0_QID_POS 16\n#define WIL_EDMA_DESC_TX_MAC_CFG_0_QID_LEN 6\n\n#define WIL_EDMA_DESC_TX_CFG_EOP_POS 0\n#define WIL_EDMA_DESC_TX_CFG_EOP_LEN 1\n\n#define WIL_EDMA_DESC_TX_CFG_TSO_DESC_TYPE_POS 3\n#define WIL_EDMA_DESC_TX_CFG_TSO_DESC_TYPE_LEN 2\n\n#define WIL_EDMA_DESC_TX_CFG_SEG_EN_POS 5\n#define WIL_EDMA_DESC_TX_CFG_SEG_EN_LEN 1\n\n#define WIL_EDMA_DESC_TX_CFG_INSERT_IP_CHKSUM_POS 6\n#define WIL_EDMA_DESC_TX_CFG_INSERT_IP_CHKSUM_LEN 1\n\n#define WIL_EDMA_DESC_TX_CFG_INSERT_TCP_CHKSUM_POS 7\n#define WIL_EDMA_DESC_TX_CFG_INSERT_TCP_CHKSUM_LEN 1\n\n#define WIL_EDMA_DESC_TX_CFG_L4_TYPE_POS 15\n#define WIL_EDMA_DESC_TX_CFG_L4_TYPE_LEN 1\n\n#define WIL_EDMA_DESC_TX_CFG_PSEUDO_HEADER_CALC_EN_POS 5\n#define WIL_EDMA_DESC_TX_CFG_PSEUDO_HEADER_CALC_EN_LEN 1\n\n \nstruct wil_ring_rx_enhanced_mac {\n\tu32 d[3];\n\t__le16 buff_id;\n\tu16 reserved;\n} __packed;\n\n \nstruct wil_ring_rx_enhanced_dma {\n\tu32 d0;\n\tstruct wil_ring_dma_addr addr;\n\tu16 w5;\n\t__le16 addr_high_high;\n\t__le16 length;\n} __packed;\n\nstruct wil_rx_enhanced_desc {\n\tstruct wil_ring_rx_enhanced_mac mac;\n\tstruct wil_ring_rx_enhanced_dma dma;\n} __packed;\n\n \nstruct wil_ring_tx_enhanced_dma {\n\tu8 l4_hdr_len;\n\tu8 cmd;\n\tu16 w1;\n\tstruct wil_ring_dma_addr addr;\n\tu8  ip_length;\n\tu8  b11;        \n\t__le16 addr_high_high;\n\t__le16 length;\n} __packed;\n\n \nstruct wil_ring_tx_enhanced_mac {\n\tu32 d[3];\n\t__le16 tso_mss;\n\tu16 scratchpad;\n} __packed;\n\nstruct wil_tx_enhanced_desc {\n\tstruct wil_ring_tx_enhanced_mac mac;\n\tstruct wil_ring_tx_enhanced_dma dma;\n} __packed;\n\n#define TX_STATUS_DESC_READY_POS 7\n\n \nstruct wil_ring_tx_status {\n\tu8 num_descriptors;\n\tu8 ring_id;\n\tu8 status;\n\tu8 desc_ready;  \n\tu32 timestamp;\n\tu32 d2;\n\tu16 seq_number;  \n\tu16 w7;\n} __packed;\n\n \nstruct wil_rx_status_compressed {\n\tu32 d0;\n\tu32 d1;\n\t__le16 buff_id;\n\t__le16 length;\n\tu32 timestamp;\n} __packed;\n\n \nstruct wil_rx_status_extension {\n\tu32 d0;\n\tu32 d1;\n\t__le16 seq_num;  \n\tstruct_group_attr(pn, __packed,\n\t\tu16 pn_15_0;\n\t\tu32 pn_47_16;\n\t);\n} __packed;\n\nstruct wil_rx_status_extended {\n\tstruct wil_rx_status_compressed comp;\n\tstruct wil_rx_status_extension ext;\n} __packed;\n\nstatic inline void *wil_skb_rxstatus(struct sk_buff *skb)\n{\n\treturn (void *)skb->cb;\n}\n\nstatic inline __le16 wil_rx_status_get_length(void *msg)\n{\n\treturn ((struct wil_rx_status_compressed *)msg)->length;\n}\n\nstatic inline u8 wil_rx_status_get_mcs(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d1,\n\t\t\t    16, 21);\n}\n\nstatic inline u8 wil_rx_status_get_cb_mode(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d1,\n\t\t\t    22, 23);\n}\n\nstatic inline u16 wil_rx_status_get_flow_id(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    8, 19);\n}\n\nstatic inline u8 wil_rx_status_get_mcast(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    26, 26);\n}\n\n \n\nstatic inline u8 wil_rx_status_get_cid(void *msg)\n{\n\tu16 val = wil_rx_status_get_flow_id(msg);\n\n\tif (val & WIL_RX_EDMA_DLPF_LU_MISS_BIT)\n\t\t \n\t\treturn (val >> WIL_RX_EDMA_DLPF_LU_MISS_CID_POS) &\n\t\t\tWIL_RX_EDMA_DLPF_LU_MISS_CID_TID_MASK;\n\telse\n\t\t \n\t\treturn (val >> WIL_RX_EDMA_DLPF_LU_HIT_CID_POS) &\n\t\t\tWIL_RX_EDMA_DLPF_LU_HIT_CID_TID_MASK;\n}\n\nstatic inline u8 wil_rx_status_get_tid(void *msg)\n{\n\tu16 val = wil_rx_status_get_flow_id(msg);\n\n\tif (val & WIL_RX_EDMA_DLPF_LU_MISS_BIT)\n\t\t \n\t\treturn (val >> WIL_RX_EDMA_DLPF_LU_MISS_TID_POS) &\n\t\t\tWIL_RX_EDMA_DLPF_LU_MISS_CID_TID_MASK;\n\telse\n\t\t \n\t\treturn val & WIL_RX_EDMA_DLPF_LU_MISS_CID_TID_MASK;\n}\n\nstatic inline int wil_rx_status_get_eop(void *msg)  \n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    30, 30);\n}\n\nstatic inline void wil_rx_status_reset_buff_id(struct wil_status_ring *s)\n{\n\t((struct wil_rx_status_compressed *)\n\t\t(s->va + (s->elem_size * s->swhead)))->buff_id = 0;\n}\n\nstatic inline __le16 wil_rx_status_get_buff_id(void *msg)\n{\n\treturn ((struct wil_rx_status_compressed *)msg)->buff_id;\n}\n\nstatic inline u8 wil_rx_status_get_data_offset(void *msg)\n{\n\tu8 val = WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d1,\n\t\t\t      24, 27);\n\n\tswitch (val) {\n\tcase 0: return 0;\n\tcase 3: return 2;\n\tdefault: return 0xFF;\n\t}\n}\n\nstatic inline int wil_rx_status_get_frame_type(struct wil6210_priv *wil,\n\t\t\t\t\t       void *msg)\n{\n\tif (wil->use_compressed_rx_status)\n\t\treturn IEEE80211_FTYPE_DATA;\n\n\treturn WIL_GET_BITS(((struct wil_rx_status_extended *)msg)->ext.d1,\n\t\t\t    0, 1) << 2;\n}\n\nstatic inline int wil_rx_status_get_fc1(struct wil6210_priv *wil, void *msg)\n{\n\tif (wil->use_compressed_rx_status)\n\t\treturn 0;\n\n\treturn WIL_GET_BITS(((struct wil_rx_status_extended *)msg)->ext.d1,\n\t\t\t    0, 5) << 2;\n}\n\nstatic inline __le16 wil_rx_status_get_seq(struct wil6210_priv *wil, void *msg)\n{\n\tif (wil->use_compressed_rx_status)\n\t\treturn 0;\n\n\treturn ((struct wil_rx_status_extended *)msg)->ext.seq_num;\n}\n\nstatic inline u8 wil_rx_status_get_retry(void *msg)\n{\n\t \n\treturn 1;\n}\n\nstatic inline int wil_rx_status_get_mid(void *msg)\n{\n\tif (!(((struct wil_rx_status_compressed *)msg)->d0 &\n\t    WIL_RX_EDMA_MID_VALID_BIT))\n\t\treturn 0;  \n\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    21, 22);\n}\n\nstatic inline int wil_rx_status_get_error(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    29, 29);\n}\n\nstatic inline int wil_rx_status_get_l2_rx_status(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    0, 2);\n}\n\nstatic inline int wil_rx_status_get_l3_rx_status(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    3, 4);\n}\n\nstatic inline int wil_rx_status_get_l4_rx_status(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    5, 6);\n}\n\n \nstatic inline int wil_rx_status_get_checksum(void *msg,\n\t\t\t\t\t     struct wil_net_stats *stats)\n{\n\tint l3_rx_status = wil_rx_status_get_l3_rx_status(msg);\n\tint l4_rx_status = wil_rx_status_get_l4_rx_status(msg);\n\n\tif (l4_rx_status == 1)\n\t\treturn CHECKSUM_UNNECESSARY;\n\n\tif (l4_rx_status == 0 && l3_rx_status == 1)\n\t\treturn CHECKSUM_UNNECESSARY;\n\n\tif (l3_rx_status == 0 && l4_rx_status == 0)\n\t\t \n\t\treturn CHECKSUM_NONE;\n\n\t \n\tstats->rx_csum_err++;\n\treturn CHECKSUM_NONE;\n}\n\nstatic inline int wil_rx_status_get_security(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d0,\n\t\t\t    28, 28);\n}\n\nstatic inline u8 wil_rx_status_get_key_id(void *msg)\n{\n\treturn WIL_GET_BITS(((struct wil_rx_status_compressed *)msg)->d1,\n\t\t\t    31, 31);\n}\n\nstatic inline u8 wil_tx_status_get_mcs(struct wil_ring_tx_status *msg)\n{\n\treturn WIL_GET_BITS(msg->d2, 0, 4);\n}\n\nstatic inline u32 wil_ring_next_head(struct wil_ring *ring)\n{\n\treturn (ring->swhead + 1) % ring->size;\n}\n\nstatic inline void wil_desc_set_addr_edma(struct wil_ring_dma_addr *addr,\n\t\t\t\t\t  __le16 *addr_high_high,\n\t\t\t\t\t  dma_addr_t pa)\n{\n\taddr->addr_low = cpu_to_le32(lower_32_bits(pa));\n\taddr->addr_high = cpu_to_le16((u16)upper_32_bits(pa));\n\t*addr_high_high = cpu_to_le16((u16)(upper_32_bits(pa) >> 16));\n}\n\nstatic inline\ndma_addr_t wil_tx_desc_get_addr_edma(struct wil_ring_tx_enhanced_dma *dma)\n{\n\treturn le32_to_cpu(dma->addr.addr_low) |\n\t\t\t   ((u64)le16_to_cpu(dma->addr.addr_high) << 32) |\n\t\t\t   ((u64)le16_to_cpu(dma->addr_high_high) << 48);\n}\n\nstatic inline\ndma_addr_t wil_rx_desc_get_addr_edma(struct wil_ring_rx_enhanced_dma *dma)\n{\n\treturn le32_to_cpu(dma->addr.addr_low) |\n\t\t\t   ((u64)le16_to_cpu(dma->addr.addr_high) << 32) |\n\t\t\t   ((u64)le16_to_cpu(dma->addr_high_high) << 48);\n}\n\nvoid wil_configure_interrupt_moderation_edma(struct wil6210_priv *wil);\nint wil_tx_sring_handler(struct wil6210_priv *wil,\n\t\t\t struct wil_status_ring *sring);\nvoid wil_rx_handle_edma(struct wil6210_priv *wil, int *quota);\nvoid wil_init_txrx_ops_edma(struct wil6210_priv *wil);\n\n#endif  \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}