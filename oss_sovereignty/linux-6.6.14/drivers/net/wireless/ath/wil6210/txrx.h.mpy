{
  "module_name": "txrx.h",
  "hash_id": "26fc8a895ad06663644cf3f63949c1081b86c333fbd21092c5e54bb669e423da",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/wil6210/txrx.h",
  "human_readable_source": " \n \n\n#ifndef WIL6210_TXRX_H\n#define WIL6210_TXRX_H\n\n#include \"wil6210.h\"\n#include \"txrx_edma.h\"\n\n#define BUF_SW_OWNED    (1)\n#define BUF_HW_OWNED    (0)\n\n \n#define TXRX_BUF_LEN_DEFAULT (2048)\n\n \n#define WIL6210_RTAP_SIZE (128)\n\n \n\nstatic inline dma_addr_t wil_desc_addr(struct wil_ring_dma_addr *addr)\n{\n\treturn le32_to_cpu(addr->addr_low) |\n\t\t\t   ((u64)le16_to_cpu(addr->addr_high) << 32);\n}\n\nstatic inline void wil_desc_addr_set(struct wil_ring_dma_addr *addr,\n\t\t\t\t     dma_addr_t pa)\n{\n\taddr->addr_low = cpu_to_le32(lower_32_bits(pa));\n\taddr->addr_high = cpu_to_le16((u16)upper_32_bits(pa));\n}\n\n \nstruct vring_tx_mac {\n\tu32 d[3];\n\tu32 ucode_cmd;\n} __packed;\n\n \n#define MAC_CFG_DESC_TX_0_LIFETIME_EXPIRY_VALUE_POS 0\n#define MAC_CFG_DESC_TX_0_LIFETIME_EXPIRY_VALUE_LEN 10\n#define MAC_CFG_DESC_TX_0_LIFETIME_EXPIRY_VALUE_MSK 0x3FF\n\n#define MAC_CFG_DESC_TX_0_INTERRUP_EN_POS 10\n#define MAC_CFG_DESC_TX_0_INTERRUP_EN_LEN 1\n#define MAC_CFG_DESC_TX_0_INTERRUP_EN_MSK 0x400\n\n#define MAC_CFG_DESC_TX_0_STATUS_EN_POS 11\n#define MAC_CFG_DESC_TX_0_STATUS_EN_LEN 1\n#define MAC_CFG_DESC_TX_0_STATUS_EN_MSK 0x800\n\n#define MAC_CFG_DESC_TX_0_TXSS_OVERRIDE_POS 12\n#define MAC_CFG_DESC_TX_0_TXSS_OVERRIDE_LEN 2\n#define MAC_CFG_DESC_TX_0_TXSS_OVERRIDE_MSK 0x3000\n\n#define MAC_CFG_DESC_TX_0_TIMESTAMP_INSERTION_POS 14\n#define MAC_CFG_DESC_TX_0_TIMESTAMP_INSERTION_LEN 1\n#define MAC_CFG_DESC_TX_0_TIMESTAMP_INSERTION_MSK 0x4000\n\n#define MAC_CFG_DESC_TX_0_DURATION_PRESERVE_POS 15\n#define MAC_CFG_DESC_TX_0_DURATION_PRESERVE_LEN 1\n#define MAC_CFG_DESC_TX_0_DURATION_PRESERVE_MSK 0x8000\n\n#define MAC_CFG_DESC_TX_0_MCS_INDEX_POS 22\n#define MAC_CFG_DESC_TX_0_MCS_INDEX_LEN 5\n#define MAC_CFG_DESC_TX_0_MCS_INDEX_MSK 0x7C00000\n\n#define MAC_CFG_DESC_TX_0_MCS_EN_POS 27\n#define MAC_CFG_DESC_TX_0_MCS_EN_LEN 1\n#define MAC_CFG_DESC_TX_0_MCS_EN_MSK 0x8000000\n\n#define MAC_CFG_DESC_TX_0_SN_PRESERVED_POS 31\n#define MAC_CFG_DESC_TX_0_SN_PRESERVED_LEN 1\n#define MAC_CFG_DESC_TX_0_SN_PRESERVED_MSK 0x80000000\n\n \n#define MAC_CFG_DESC_TX_1_PKT_MODE_POS 0\n#define MAC_CFG_DESC_TX_1_PKT_MODE_LEN 4\n#define MAC_CFG_DESC_TX_1_PKT_MODE_MSK 0xF\n\n#define MAC_CFG_DESC_TX_1_PKT_MODE_EN_POS 4\n#define MAC_CFG_DESC_TX_1_PKT_MODE_EN_LEN 1\n#define MAC_CFG_DESC_TX_1_PKT_MODE_EN_MSK 0x10\n\n#define MAC_CFG_DESC_TX_1_MAC_ID_EN_POS 5\n#define MAC_CFG_DESC_TX_1_MAC_ID_EN_LEN 1\n#define MAC_CFG_DESC_TX_1_MAC_ID_EN_MSK 0x20\n\n#define MAC_CFG_DESC_TX_1_MAC_ID_POS 6\n#define MAC_CFG_DESC_TX_1_MAC_ID_LEN 2\n#define MAC_CFG_DESC_TX_1_MAC_ID_MSK 0xc0\n\n#define MAC_CFG_DESC_TX_1_ACK_POLICY_EN_POS 15\n#define MAC_CFG_DESC_TX_1_ACK_POLICY_EN_LEN 1\n#define MAC_CFG_DESC_TX_1_ACK_POLICY_EN_MSK 0x8000\n\n#define MAC_CFG_DESC_TX_1_DST_INDEX_POS 16\n#define MAC_CFG_DESC_TX_1_DST_INDEX_LEN 4\n#define MAC_CFG_DESC_TX_1_DST_INDEX_MSK 0xF0000\n\n#define MAC_CFG_DESC_TX_1_DST_INDEX_EN_POS 20\n#define MAC_CFG_DESC_TX_1_DST_INDEX_EN_LEN 1\n#define MAC_CFG_DESC_TX_1_DST_INDEX_EN_MSK 0x100000\n\n#define MAC_CFG_DESC_TX_1_ACK_POLICY_POS 21\n#define MAC_CFG_DESC_TX_1_ACK_POLICY_LEN 2\n#define MAC_CFG_DESC_TX_1_ACK_POLICY_MSK 0x600000\n\n#define MAC_CFG_DESC_TX_1_LIFETIME_EN_POS 23\n#define MAC_CFG_DESC_TX_1_LIFETIME_EN_LEN 1\n#define MAC_CFG_DESC_TX_1_LIFETIME_EN_MSK 0x800000\n\n#define MAC_CFG_DESC_TX_1_MAX_RETRY_POS 24\n#define MAC_CFG_DESC_TX_1_MAX_RETRY_LEN 7\n#define MAC_CFG_DESC_TX_1_MAX_RETRY_MSK 0x7F000000\n\n#define MAC_CFG_DESC_TX_1_MAX_RETRY_EN_POS 31\n#define MAC_CFG_DESC_TX_1_MAX_RETRY_EN_LEN 1\n#define MAC_CFG_DESC_TX_1_MAX_RETRY_EN_MSK 0x80000000\n\n \n#define MAC_CFG_DESC_TX_2_NUM_OF_DESCRIPTORS_POS 0\n#define MAC_CFG_DESC_TX_2_NUM_OF_DESCRIPTORS_LEN 8\n#define MAC_CFG_DESC_TX_2_NUM_OF_DESCRIPTORS_MSK 0xFF\n\n#define MAC_CFG_DESC_TX_2_RESERVED_POS 8\n#define MAC_CFG_DESC_TX_2_RESERVED_LEN 10\n#define MAC_CFG_DESC_TX_2_RESERVED_MSK 0x3FF00\n\n#define MAC_CFG_DESC_TX_2_L2_TRANSLATION_TYPE_POS 18\n#define MAC_CFG_DESC_TX_2_L2_TRANSLATION_TYPE_LEN 2\n#define MAC_CFG_DESC_TX_2_L2_TRANSLATION_TYPE_MSK 0xC0000\n\n#define MAC_CFG_DESC_TX_2_SNAP_HDR_INSERTION_EN_POS 20\n#define MAC_CFG_DESC_TX_2_SNAP_HDR_INSERTION_EN_LEN 1\n#define MAC_CFG_DESC_TX_2_SNAP_HDR_INSERTION_EN_MSK 0x100000\n\n#define MAC_CFG_DESC_TX_2_VLAN_REMOVAL_EN_POS 21\n#define MAC_CFG_DESC_TX_2_VLAN_REMOVAL_EN_LEN 1\n#define MAC_CFG_DESC_TX_2_VLAN_REMOVAL_EN_MSK 0x200000\n\n \n#define MAC_CFG_DESC_TX_3_UCODE_CMD_POS 0\n#define MAC_CFG_DESC_TX_3_UCODE_CMD_LEN 32\n#define MAC_CFG_DESC_TX_3_UCODE_CMD_MSK 0xFFFFFFFF\n\n \n#define DMA_CFG_DESC_TX_0_L4_LENGTH_POS 0\n#define DMA_CFG_DESC_TX_0_L4_LENGTH_LEN 8\n#define DMA_CFG_DESC_TX_0_L4_LENGTH_MSK 0xFF\n\n#define DMA_CFG_DESC_TX_0_CMD_EOP_POS 8\n#define DMA_CFG_DESC_TX_0_CMD_EOP_LEN 1\n#define DMA_CFG_DESC_TX_0_CMD_EOP_MSK 0x100\n\n#define DMA_CFG_DESC_TX_0_CMD_MARK_WB_POS 9\n#define DMA_CFG_DESC_TX_0_CMD_MARK_WB_LEN 1\n#define DMA_CFG_DESC_TX_0_CMD_MARK_WB_MSK 0x200\n\n#define DMA_CFG_DESC_TX_0_CMD_DMA_IT_POS 10\n#define DMA_CFG_DESC_TX_0_CMD_DMA_IT_LEN 1\n#define DMA_CFG_DESC_TX_0_CMD_DMA_IT_MSK 0x400\n\n#define DMA_CFG_DESC_TX_0_SEGMENT_BUF_DETAILS_POS 11\n#define DMA_CFG_DESC_TX_0_SEGMENT_BUF_DETAILS_LEN 2\n#define DMA_CFG_DESC_TX_0_SEGMENT_BUF_DETAILS_MSK 0x1800\n\n#define DMA_CFG_DESC_TX_0_TCP_SEG_EN_POS 13\n#define DMA_CFG_DESC_TX_0_TCP_SEG_EN_LEN 1\n#define DMA_CFG_DESC_TX_0_TCP_SEG_EN_MSK 0x2000\n\n#define DMA_CFG_DESC_TX_0_IPV4_CHECKSUM_EN_POS 14\n#define DMA_CFG_DESC_TX_0_IPV4_CHECKSUM_EN_LEN 1\n#define DMA_CFG_DESC_TX_0_IPV4_CHECKSUM_EN_MSK 0x4000\n\n#define DMA_CFG_DESC_TX_0_TCP_UDP_CHECKSUM_EN_POS 15\n#define DMA_CFG_DESC_TX_0_TCP_UDP_CHECKSUM_EN_LEN 1\n#define DMA_CFG_DESC_TX_0_TCP_UDP_CHECKSUM_EN_MSK 0x8000\n\n#define DMA_CFG_DESC_TX_0_QID_POS 16\n#define DMA_CFG_DESC_TX_0_QID_LEN 5\n#define DMA_CFG_DESC_TX_0_QID_MSK 0x1F0000\n\n#define DMA_CFG_DESC_TX_0_PSEUDO_HEADER_CALC_EN_POS 21\n#define DMA_CFG_DESC_TX_0_PSEUDO_HEADER_CALC_EN_LEN 1\n#define DMA_CFG_DESC_TX_0_PSEUDO_HEADER_CALC_EN_MSK 0x200000\n\n#define DMA_CFG_DESC_TX_0_L4_TYPE_POS 30\n#define DMA_CFG_DESC_TX_0_L4_TYPE_LEN 2\n#define DMA_CFG_DESC_TX_0_L4_TYPE_MSK 0xC0000000  \n\n#define DMA_CFG_DESC_TX_OFFLOAD_CFG_MAC_LEN_POS 0\n#define DMA_CFG_DESC_TX_OFFLOAD_CFG_MAC_LEN_LEN 7\n#define DMA_CFG_DESC_TX_OFFLOAD_CFG_MAC_LEN_MSK 0x7F  \n\n#define DMA_CFG_DESC_TX_OFFLOAD_CFG_L3T_IPV4_POS 7\n#define DMA_CFG_DESC_TX_OFFLOAD_CFG_L3T_IPV4_LEN 1\n#define DMA_CFG_DESC_TX_OFFLOAD_CFG_L3T_IPV4_MSK 0x80  \n\n#define TX_DMA_STATUS_DU         BIT(0)\n\n \nstruct vring_tx_dma {\n\tu32 d0;\n\tstruct wil_ring_dma_addr addr;\n\tu8  ip_length;\n\tu8  b11;        \n\tu8  error;      \n\tu8  status;     \n\t__le16 length;\n} __packed;\n\n \nenum {\n\twil_tso_type_hdr = 0,\n\twil_tso_type_first = 1,\n\twil_tso_type_mid  = 2,\n\twil_tso_type_lst  = 3,\n};\n\n \nstruct vring_rx_mac {\n\tu32 d0;\n\tu32 d1;\n\tu16 w4;\n\tstruct_group_attr(pn, __packed,\n\t\tu16 pn_15_0;\n\t\tu32 pn_47_16;\n\t);\n} __packed;\n\n \n\n#define RX_DMA_D0_CMD_DMA_EOP\tBIT(8)\n#define RX_DMA_D0_CMD_DMA_RT\tBIT(9)   \n#define RX_DMA_D0_CMD_DMA_IT\tBIT(10)  \n#define RX_MAC_D0_MAC_ID_VALID\tBIT(7)\n\n \n#define RX_DMA_ERROR_FCS\tBIT(0)\n#define RX_DMA_ERROR_MIC\tBIT(1)\n#define RX_DMA_ERROR_KEY\tBIT(2)  \n#define RX_DMA_ERROR_REPLAY\tBIT(3)\n#define RX_DMA_ERROR_L3_ERR\tBIT(4)\n#define RX_DMA_ERROR_L4_ERR\tBIT(5)\n\n \n#define RX_DMA_STATUS_DU\tBIT(0)\n#define RX_DMA_STATUS_EOP\tBIT(1)\n#define RX_DMA_STATUS_ERROR\tBIT(2)\n#define RX_DMA_STATUS_MI\tBIT(3)  \n#define RX_DMA_STATUS_L3I\tBIT(4)\n#define RX_DMA_STATUS_L4I\tBIT(5)\n#define RX_DMA_STATUS_PHY_INFO\tBIT(6)\n#define RX_DMA_STATUS_FFM\tBIT(7)  \n\n \n#define WIL_KEY_INFO_KEY_TYPE BIT(3)  \n\n#define WIL_KEY_INFO_MIC BIT(8)\n#define WIL_KEY_INFO_ENCR_KEY_DATA BIT(12)  \n\n#define WIL_EAP_NONCE_LEN 32\n#define WIL_EAP_KEY_RSC_LEN 8\n#define WIL_EAP_REPLAY_COUNTER_LEN 8\n#define WIL_EAP_KEY_IV_LEN 16\n#define WIL_EAP_KEY_ID_LEN 8\n\nenum {\n\tWIL_1X_TYPE_EAP_PACKET = 0,\n\tWIL_1X_TYPE_EAPOL_START = 1,\n\tWIL_1X_TYPE_EAPOL_LOGOFF = 2,\n\tWIL_1X_TYPE_EAPOL_KEY = 3,\n};\n\n#define WIL_EAPOL_KEY_TYPE_RSN 2\n#define WIL_EAPOL_KEY_TYPE_WPA 254\n\nstruct wil_1x_hdr {\n\tu8 version;\n\tu8 type;\n\t__be16 length;\n\t \n} __packed;\n\nstruct wil_eapol_key {\n\tu8 type;\n\t__be16 key_info;\n\t__be16 key_length;\n\tu8 replay_counter[WIL_EAP_REPLAY_COUNTER_LEN];\n\tu8 key_nonce[WIL_EAP_NONCE_LEN];\n\tu8 key_iv[WIL_EAP_KEY_IV_LEN];\n\tu8 key_rsc[WIL_EAP_KEY_RSC_LEN];\n\tu8 key_id[WIL_EAP_KEY_ID_LEN];\n} __packed;\n\nstruct vring_rx_dma {\n\tu32 d0;\n\tstruct wil_ring_dma_addr addr;\n\tu8  ip_length;\n\tu8  b11;\n\tu8  error;\n\tu8  status;\n\t__le16 length;\n} __packed;\n\nstruct vring_tx_desc {\n\tstruct vring_tx_mac mac;\n\tstruct vring_tx_dma dma;\n} __packed;\n\nunion wil_tx_desc {\n\tstruct vring_tx_desc legacy;\n\tstruct wil_tx_enhanced_desc enhanced;\n} __packed;\n\nstruct vring_rx_desc {\n\tstruct vring_rx_mac mac;\n\tstruct vring_rx_dma dma;\n} __packed;\n\nunion wil_rx_desc {\n\tstruct vring_rx_desc legacy;\n\tstruct wil_rx_enhanced_desc enhanced;\n} __packed;\n\nunion wil_ring_desc {\n\tunion wil_tx_desc tx;\n\tunion wil_rx_desc rx;\n} __packed;\n\nstruct packet_rx_info {\n\tu8 cid;\n};\n\n \nstruct skb_rx_info {\n\tstruct vring_rx_desc rx_desc;\n\tstruct packet_rx_info rx_info;\n};\n\nstatic inline int wil_rxdesc_tid(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d0, 0, 3);\n}\n\nstatic inline int wil_rxdesc_cid(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d0, 4, 6);\n}\n\nstatic inline int wil_rxdesc_mid(struct vring_rx_desc *d)\n{\n\treturn (d->mac.d0 & RX_MAC_D0_MAC_ID_VALID) ?\n\t\tWIL_GET_BITS(d->mac.d0, 8, 9) : 0;\n}\n\nstatic inline int wil_rxdesc_ftype(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d0, 10, 11);\n}\n\nstatic inline int wil_rxdesc_subtype(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d0, 12, 15);\n}\n\n \nstatic inline u8 wil_rxdesc_fc1(struct vring_rx_desc *d)\n{\n\treturn (u8)(WIL_GET_BITS(d->mac.d0, 10, 15) << 2);\n}\n\nstatic inline int wil_rxdesc_seq(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d0, 16, 27);\n}\n\nstatic inline int wil_rxdesc_ext_subtype(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d0, 28, 31);\n}\n\nstatic inline int wil_rxdesc_retry(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d0, 31, 31);\n}\n\nstatic inline int wil_rxdesc_key_id(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d1, 4, 5);\n}\n\nstatic inline int wil_rxdesc_security(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d1, 7, 7);\n}\n\nstatic inline int wil_rxdesc_ds_bits(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d1, 8, 9);\n}\n\nstatic inline int wil_rxdesc_mcs(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d1, 21, 24);\n}\n\nstatic inline int wil_rxdesc_mcast(struct vring_rx_desc *d)\n{\n\treturn WIL_GET_BITS(d->mac.d1, 13, 14);\n}\n\nstatic inline struct vring_rx_desc *wil_skb_rxdesc(struct sk_buff *skb)\n{\n\treturn (void *)skb->cb;\n}\n\nstatic inline int wil_ring_is_empty(struct wil_ring *ring)\n{\n\treturn ring->swhead == ring->swtail;\n}\n\nstatic inline u32 wil_ring_next_tail(struct wil_ring *ring)\n{\n\treturn (ring->swtail + 1) % ring->size;\n}\n\nstatic inline void wil_ring_advance_head(struct wil_ring *ring, int n)\n{\n\tring->swhead = (ring->swhead + n) % ring->size;\n}\n\nstatic inline int wil_ring_is_full(struct wil_ring *ring)\n{\n\treturn wil_ring_next_tail(ring) == ring->swhead;\n}\n\nstatic inline u8 *wil_skb_get_da(struct sk_buff *skb)\n{\n\tstruct ethhdr *eth = (void *)skb->data;\n\n\treturn eth->h_dest;\n}\n\nstatic inline u8 *wil_skb_get_sa(struct sk_buff *skb)\n{\n\tstruct ethhdr *eth = (void *)skb->data;\n\n\treturn eth->h_source;\n}\n\nstatic inline bool wil_need_txstat(struct sk_buff *skb)\n{\n\tconst u8 *da = wil_skb_get_da(skb);\n\n\treturn is_unicast_ether_addr(da) && skb->sk &&\n\t       (skb_shinfo(skb)->tx_flags & SKBTX_WIFI_STATUS);\n}\n\nstatic inline void wil_consume_skb(struct sk_buff *skb, bool acked)\n{\n\tif (unlikely(wil_need_txstat(skb)))\n\t\tskb_complete_wifi_ack(skb, acked);\n\telse\n\t\tacked ? dev_consume_skb_any(skb) : dev_kfree_skb_any(skb);\n}\n\n \nstatic inline int wil_ring_used_tx(struct wil_ring *ring)\n{\n\tu32 swhead = ring->swhead;\n\tu32 swtail = ring->swtail;\n\n\treturn (ring->size + swhead - swtail) % ring->size;\n}\n\n \nstatic inline int wil_ring_avail_tx(struct wil_ring *ring)\n{\n\treturn ring->size - wil_ring_used_tx(ring) - 1;\n}\n\nstatic inline int wil_get_min_tx_ring_id(struct wil6210_priv *wil)\n{\n\t \n\treturn wil->use_enhanced_dma_hw ? 1 : 0;\n}\n\n \nstatic inline int wil_is_back_req(u8 fc)\n{\n\treturn (fc & (IEEE80211_FCTL_FTYPE | IEEE80211_FCTL_STYPE)) ==\n\t       (IEEE80211_FTYPE_CTL | IEEE80211_STYPE_BACK_REQ);\n}\n\n \nstatic inline bool wil_val_in_range(int val, int min, int max)\n{\n\treturn val >= min && val < max;\n}\n\nstatic inline u8 wil_skb_get_cid(struct sk_buff *skb)\n{\n\tstruct skb_rx_info *skb_rx_info = (void *)skb->cb;\n\n\treturn skb_rx_info->rx_info.cid;\n}\n\nstatic inline void wil_skb_set_cid(struct sk_buff *skb, u8 cid)\n{\n\tstruct skb_rx_info *skb_rx_info = (void *)skb->cb;\n\n\tskb_rx_info->rx_info.cid = cid;\n}\n\nvoid wil_netif_rx_any(struct sk_buff *skb, struct net_device *ndev);\nvoid wil_netif_rx(struct sk_buff *skb, struct net_device *ndev, int cid,\n\t\t  struct wil_net_stats *stats, bool gro);\nvoid wil_rx_reorder(struct wil6210_priv *wil, struct sk_buff *skb);\nvoid wil_rx_bar(struct wil6210_priv *wil, struct wil6210_vif *vif,\n\t\tu8 cid, u8 tid, u16 seq);\nstruct wil_tid_ampdu_rx *wil_tid_ampdu_rx_alloc(struct wil6210_priv *wil,\n\t\t\t\t\t\tint size, u16 ssn);\nvoid wil_tid_ampdu_rx_free(struct wil6210_priv *wil,\n\t\t\t   struct wil_tid_ampdu_rx *r);\nvoid wil_tx_data_init(struct wil_ring_tx_data *txdata);\nvoid wil_init_txrx_ops_legacy_dma(struct wil6210_priv *wil);\nvoid wil_tx_latency_calc(struct wil6210_priv *wil, struct sk_buff *skb,\n\t\t\t struct wil_sta_info *sta);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}