{
  "module_name": "led.c",
  "hash_id": "3042a0bdea27b27c7bade1b135cf83e31fcb3c4223a92266fdf6bfc55182cacf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath5k/led.c",
  "human_readable_source": " \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/pci.h>\n#include \"ath5k.h\"\n\n#define ATH_SDEVICE(subv, subd) \\\n\t.vendor = PCI_ANY_ID, .device = PCI_ANY_ID, \\\n\t.subvendor = (subv), .subdevice = (subd)\n\n#define ATH_LED(pin, polarity) .driver_data = (((pin) << 8) | (polarity))\n#define ATH_PIN(data) ((data) >> 8)\n#define ATH_POLARITY(data) ((data) & 0xff)\n\n \nstatic const struct pci_device_id ath5k_led_devices[] = {\n\t \n\t{ PCI_VDEVICE(ATHEROS, PCI_DEVICE_ID_ATHEROS_AR5211), ATH_LED(0, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_COMPAQ, PCI_ANY_ID), ATH_LED(1, 1) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_FOXCONN, 0xe008), ATH_LED(3, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_FOXCONN, 0xe00d), ATH_LED(3, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_AMBIT, 0x0422), ATH_LED(1, 1) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_AMBIT, 0x0428), ATH_LED(3, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_QMI, 0x0100), ATH_LED(1, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_QMI, 0x0105), ATH_LED(3, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_AZWAVE, 0x1026), ATH_LED(3, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_IBM, 0x058a), ATH_LED(1, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_HP, 0x0137a), ATH_LED(3, 1) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_HP, 0x0137b), ATH_LED(3, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_ATHEROS, 0x3067), ATH_LED(3, 0) },\n\t \n\t{ PCI_VDEVICE(ATHEROS, PCI_DEVICE_ID_ATHEROS_AR5212_IBM), ATH_LED(0, 0) },\n\t \n\t{ ATH_SDEVICE(PCI_VENDOR_ID_QMI, 0x0112), ATH_LED(3, 0) },\n\t{ }\n};\n\nvoid ath5k_led_enable(struct ath5k_hw *ah)\n{\n\tif (IS_ENABLED(CONFIG_MAC80211_LEDS) &&\n\t    test_bit(ATH_STAT_LEDSOFT, ah->status)) {\n\t\tath5k_hw_set_gpio_output(ah, ah->led_pin);\n\t\tath5k_led_off(ah);\n\t}\n}\n\nstatic void ath5k_led_on(struct ath5k_hw *ah)\n{\n\tif (!test_bit(ATH_STAT_LEDSOFT, ah->status))\n\t\treturn;\n\tath5k_hw_set_gpio(ah, ah->led_pin, ah->led_on);\n}\n\nvoid ath5k_led_off(struct ath5k_hw *ah)\n{\n\tif (!IS_ENABLED(CONFIG_MAC80211_LEDS) ||\n\t    !test_bit(ATH_STAT_LEDSOFT, ah->status))\n\t\treturn;\n\tath5k_hw_set_gpio(ah, ah->led_pin, !ah->led_on);\n}\n\nstatic void\nath5k_led_brightness_set(struct led_classdev *led_dev,\n\tenum led_brightness brightness)\n{\n\tstruct ath5k_led *led = container_of(led_dev, struct ath5k_led,\n\t\tled_dev);\n\n\tif (brightness == LED_OFF)\n\t\tath5k_led_off(led->ah);\n\telse\n\t\tath5k_led_on(led->ah);\n}\n\nstatic int\nath5k_register_led(struct ath5k_hw *ah, struct ath5k_led *led,\n\t\t   const char *name, const char *trigger)\n{\n\tint err;\n\n\tled->ah = ah;\n\tstrncpy(led->name, name, sizeof(led->name));\n\tled->name[sizeof(led->name)-1] = 0;\n\tled->led_dev.name = led->name;\n\tled->led_dev.default_trigger = trigger;\n\tled->led_dev.brightness_set = ath5k_led_brightness_set;\n\n\terr = led_classdev_register(ah->dev, &led->led_dev);\n\tif (err) {\n\t\tATH5K_WARN(ah, \"could not register LED %s\\n\", name);\n\t\tled->ah = NULL;\n\t}\n\treturn err;\n}\n\nstatic void\nath5k_unregister_led(struct ath5k_led *led)\n{\n\tif (!IS_ENABLED(CONFIG_MAC80211_LEDS) || !led->ah)\n\t\treturn;\n\tled_classdev_unregister(&led->led_dev);\n\tath5k_led_off(led->ah);\n\tled->ah = NULL;\n}\n\nvoid ath5k_unregister_leds(struct ath5k_hw *ah)\n{\n\tath5k_unregister_led(&ah->rx_led);\n\tath5k_unregister_led(&ah->tx_led);\n}\n\nint ath5k_init_leds(struct ath5k_hw *ah)\n{\n\tint ret = 0;\n\tstruct ieee80211_hw *hw = ah->hw;\n#ifndef CONFIG_ATH5K_AHB\n\tstruct pci_dev *pdev = ah->pdev;\n#endif\n\tchar name[ATH5K_LED_MAX_NAME_LEN + 1];\n\tconst struct pci_device_id *match;\n\n\tif (!IS_ENABLED(CONFIG_MAC80211_LEDS) || !ah->pdev)\n\t\treturn 0;\n\n#ifdef CONFIG_ATH5K_AHB\n\tmatch = NULL;\n#else\n\tmatch = pci_match_id(&ath5k_led_devices[0], pdev);\n#endif\n\tif (match) {\n\t\t__set_bit(ATH_STAT_LEDSOFT, ah->status);\n\t\tah->led_pin = ATH_PIN(match->driver_data);\n\t\tah->led_on = ATH_POLARITY(match->driver_data);\n\t}\n\n\tif (!test_bit(ATH_STAT_LEDSOFT, ah->status))\n\t\tgoto out;\n\n\tath5k_led_enable(ah);\n\n\tsnprintf(name, sizeof(name), \"ath5k-%s::rx\", wiphy_name(hw->wiphy));\n\tret = ath5k_register_led(ah, &ah->rx_led, name,\n\t\tieee80211_get_rx_led_name(hw));\n\tif (ret)\n\t\tgoto out;\n\n\tsnprintf(name, sizeof(name), \"ath5k-%s::tx\", wiphy_name(hw->wiphy));\n\tret = ath5k_register_led(ah, &ah->tx_led, name,\n\t\tieee80211_get_tx_led_name(hw));\nout:\n\treturn ret;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}