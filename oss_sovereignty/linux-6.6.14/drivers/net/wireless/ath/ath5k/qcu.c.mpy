{
  "module_name": "qcu.c",
  "hash_id": "e079ba4d437bbc469a581d735c5405501a5a2a01496b3ef9baa11749001c474a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath5k/qcu.c",
  "human_readable_source": " \n\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include \"ath5k.h\"\n#include \"reg.h\"\n#include \"debug.h\"\n#include <linux/log2.h>\n\n \n\n\n \n\n \nu32\nath5k_hw_num_tx_pending(struct ath5k_hw *ah, unsigned int queue)\n{\n\tu32 pending;\n\tAR5K_ASSERT_ENTRY(queue, ah->ah_capabilities.cap_queues.q_tx_num);\n\n\t \n\tif (ah->ah_txq[queue].tqi_type == AR5K_TX_QUEUE_INACTIVE)\n\t\treturn false;\n\n\t \n\tif (ah->ah_version == AR5K_AR5210)\n\t\treturn false;\n\n\tpending = ath5k_hw_reg_read(ah, AR5K_QUEUE_STATUS(queue));\n\tpending &= AR5K_QCU_STS_FRMPENDCNT;\n\n\t \n\tif (!pending && AR5K_REG_READ_Q(ah, AR5K_QCU_TXE, queue))\n\t\treturn true;\n\n\treturn pending;\n}\n\n \nvoid\nath5k_hw_release_tx_queue(struct ath5k_hw *ah, unsigned int queue)\n{\n\tif (WARN_ON(queue >= ah->ah_capabilities.cap_queues.q_tx_num))\n\t\treturn;\n\n\t \n\tah->ah_txq[queue].tqi_type = AR5K_TX_QUEUE_INACTIVE;\n\t \n\tAR5K_Q_DISABLE_BITS(ah->ah_txq_status, queue);\n}\n\n \nstatic u16\nath5k_cw_validate(u16 cw_req)\n{\n\tcw_req = min(cw_req, (u16)1023);\n\n\t \n\tif (is_power_of_2(cw_req + 1))\n\t\treturn cw_req;\n\n\t \n\tif (is_power_of_2(cw_req))\n\t\treturn cw_req - 1;\n\n\t \n\tcw_req = (u16) roundup_pow_of_two(cw_req) - 1;\n\n\treturn cw_req;\n}\n\n \nint\nath5k_hw_get_tx_queueprops(struct ath5k_hw *ah, int queue,\n\t\tstruct ath5k_txq_info *queue_info)\n{\n\tmemcpy(queue_info, &ah->ah_txq[queue], sizeof(struct ath5k_txq_info));\n\treturn 0;\n}\n\n \nint\nath5k_hw_set_tx_queueprops(struct ath5k_hw *ah, int queue,\n\t\t\t\tconst struct ath5k_txq_info *qinfo)\n{\n\tstruct ath5k_txq_info *qi;\n\n\tAR5K_ASSERT_ENTRY(queue, ah->ah_capabilities.cap_queues.q_tx_num);\n\n\tqi = &ah->ah_txq[queue];\n\n\tif (qi->tqi_type == AR5K_TX_QUEUE_INACTIVE)\n\t\treturn -EIO;\n\n\t \n\tqi->tqi_type = qinfo->tqi_type;\n\tqi->tqi_subtype = qinfo->tqi_subtype;\n\tqi->tqi_flags = qinfo->tqi_flags;\n\t \n\tqi->tqi_aifs = min(qinfo->tqi_aifs, (u8)0xFC);\n\tqi->tqi_cw_min = ath5k_cw_validate(qinfo->tqi_cw_min);\n\tqi->tqi_cw_max = ath5k_cw_validate(qinfo->tqi_cw_max);\n\tqi->tqi_cbr_period = qinfo->tqi_cbr_period;\n\tqi->tqi_cbr_overflow_limit = qinfo->tqi_cbr_overflow_limit;\n\tqi->tqi_burst_time = qinfo->tqi_burst_time;\n\tqi->tqi_ready_time = qinfo->tqi_ready_time;\n\n\t \n\t \n\tif ((qinfo->tqi_type == AR5K_TX_QUEUE_DATA &&\n\t\t((qinfo->tqi_subtype == AR5K_WME_AC_VI) ||\n\t\t (qinfo->tqi_subtype == AR5K_WME_AC_VO))) ||\n\t     qinfo->tqi_type == AR5K_TX_QUEUE_UAPSD)\n\t\tqi->tqi_flags |= AR5K_TXQ_FLAG_POST_FR_BKOFF_DIS;\n\n\treturn 0;\n}\n\n \nint\nath5k_hw_setup_tx_queue(struct ath5k_hw *ah, enum ath5k_tx_queue queue_type,\n\t\tstruct ath5k_txq_info *queue_info)\n{\n\tunsigned int queue;\n\tint ret;\n\n\t \n\t \n\tif (ah->ah_capabilities.cap_queues.q_tx_num == 2) {\n\t\tswitch (queue_type) {\n\t\tcase AR5K_TX_QUEUE_DATA:\n\t\t\tqueue = AR5K_TX_QUEUE_ID_NOQCU_DATA;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_BEACON:\n\t\tcase AR5K_TX_QUEUE_CAB:\n\t\t\tqueue = AR5K_TX_QUEUE_ID_NOQCU_BEACON;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t} else {\n\t\tswitch (queue_type) {\n\t\tcase AR5K_TX_QUEUE_DATA:\n\t\t\tqueue = queue_info->tqi_subtype;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_UAPSD:\n\t\t\tqueue = AR5K_TX_QUEUE_ID_UAPSD;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_BEACON:\n\t\t\tqueue = AR5K_TX_QUEUE_ID_BEACON;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_CAB:\n\t\t\tqueue = AR5K_TX_QUEUE_ID_CAB;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t}\n\n\t \n\tmemset(&ah->ah_txq[queue], 0, sizeof(struct ath5k_txq_info));\n\tah->ah_txq[queue].tqi_type = queue_type;\n\n\tif (queue_info != NULL) {\n\t\tqueue_info->tqi_type = queue_type;\n\t\tret = ath5k_hw_set_tx_queueprops(ah, queue, queue_info);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\t \n\tAR5K_Q_ENABLE_BITS(ah->ah_txq_status, queue);\n\n\treturn queue;\n}\n\n\n \n\n \nvoid\nath5k_hw_set_tx_retry_limits(struct ath5k_hw *ah,\n\t\t\t\t  unsigned int queue)\n{\n\t \n\tif (ah->ah_version == AR5K_AR5210) {\n\t\tstruct ath5k_txq_info *tq = &ah->ah_txq[queue];\n\n\t\tif (queue > 0)\n\t\t\treturn;\n\n\t\tath5k_hw_reg_write(ah,\n\t\t\t(tq->tqi_cw_min << AR5K_NODCU_RETRY_LMT_CW_MIN_S)\n\t\t\t| AR5K_REG_SM(ah->ah_retry_long,\n\t\t\t\t      AR5K_NODCU_RETRY_LMT_SLG_RETRY)\n\t\t\t| AR5K_REG_SM(ah->ah_retry_short,\n\t\t\t\t      AR5K_NODCU_RETRY_LMT_SSH_RETRY)\n\t\t\t| AR5K_REG_SM(ah->ah_retry_long,\n\t\t\t\t      AR5K_NODCU_RETRY_LMT_LG_RETRY)\n\t\t\t| AR5K_REG_SM(ah->ah_retry_short,\n\t\t\t\t      AR5K_NODCU_RETRY_LMT_SH_RETRY),\n\t\t\tAR5K_NODCU_RETRY_LMT);\n\t \n\t} else {\n\t\tath5k_hw_reg_write(ah,\n\t\t\tAR5K_REG_SM(ah->ah_retry_long,\n\t\t\t\t    AR5K_DCU_RETRY_LMT_RTS)\n\t\t\t| AR5K_REG_SM(ah->ah_retry_long,\n\t\t\t\t      AR5K_DCU_RETRY_LMT_STA_RTS)\n\t\t\t| AR5K_REG_SM(max(ah->ah_retry_long, ah->ah_retry_short),\n\t\t\t\t      AR5K_DCU_RETRY_LMT_STA_DATA),\n\t\t\tAR5K_QUEUE_DFS_RETRY_LIMIT(queue));\n\t}\n}\n\n \nint\nath5k_hw_reset_tx_queue(struct ath5k_hw *ah, unsigned int queue)\n{\n\tstruct ath5k_txq_info *tq = &ah->ah_txq[queue];\n\n\tAR5K_ASSERT_ENTRY(queue, ah->ah_capabilities.cap_queues.q_tx_num);\n\n\t \n\tif ((ah->ah_version == AR5K_AR5210) ||\n\t(tq->tqi_type == AR5K_TX_QUEUE_INACTIVE))\n\t\treturn 0;\n\n\t \n\tath5k_hw_reg_write(ah,\n\t\tAR5K_REG_SM(tq->tqi_cw_min, AR5K_DCU_LCL_IFS_CW_MIN) |\n\t\tAR5K_REG_SM(tq->tqi_cw_max, AR5K_DCU_LCL_IFS_CW_MAX) |\n\t\tAR5K_REG_SM(tq->tqi_aifs, AR5K_DCU_LCL_IFS_AIFS),\n\t\tAR5K_QUEUE_DFS_LOCAL_IFS(queue));\n\n\t \n\tath5k_hw_set_tx_retry_limits(ah, queue);\n\n\n\t \n\n\t \n\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_DFS_MISC(queue),\n\t\t\t\tAR5K_DCU_MISC_FRAG_WAIT);\n\n\t \n\tif (ah->ah_mac_version < AR5K_SREV_AR5211)\n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_DFS_MISC(queue),\n\t\t\t\t\tAR5K_DCU_MISC_SEQNUM_CTL);\n\n\t \n\tif (tq->tqi_cbr_period) {\n\t\tath5k_hw_reg_write(ah, AR5K_REG_SM(tq->tqi_cbr_period,\n\t\t\t\t\tAR5K_QCU_CBRCFG_INTVAL) |\n\t\t\t\t\tAR5K_REG_SM(tq->tqi_cbr_overflow_limit,\n\t\t\t\t\tAR5K_QCU_CBRCFG_ORN_THRES),\n\t\t\t\t\tAR5K_QUEUE_CBRCFG(queue));\n\n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\t\tAR5K_QCU_MISC_FRSHED_CBR);\n\n\t\tif (tq->tqi_cbr_overflow_limit)\n\t\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\t\tAR5K_QCU_MISC_CBR_THRES_ENABLE);\n\t}\n\n\t \n\tif (tq->tqi_ready_time && (tq->tqi_type != AR5K_TX_QUEUE_CAB))\n\t\tath5k_hw_reg_write(ah, AR5K_REG_SM(tq->tqi_ready_time,\n\t\t\t\t\tAR5K_QCU_RDYTIMECFG_INTVAL) |\n\t\t\t\t\tAR5K_QCU_RDYTIMECFG_ENABLE,\n\t\t\t\t\tAR5K_QUEUE_RDYTIMECFG(queue));\n\n\tif (tq->tqi_burst_time) {\n\t\tath5k_hw_reg_write(ah, AR5K_REG_SM(tq->tqi_burst_time,\n\t\t\t\t\tAR5K_DCU_CHAN_TIME_DUR) |\n\t\t\t\t\tAR5K_DCU_CHAN_TIME_ENABLE,\n\t\t\t\t\tAR5K_QUEUE_DFS_CHANNEL_TIME(queue));\n\n\t\tif (tq->tqi_flags & AR5K_TXQ_FLAG_RDYTIME_EXP_POLICY_ENABLE)\n\t\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\t\tAR5K_QCU_MISC_RDY_VEOL_POLICY);\n\t}\n\n\t \n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_BACKOFF_DISABLE)\n\t\tath5k_hw_reg_write(ah, AR5K_DCU_MISC_POST_FR_BKOFF_DIS,\n\t\t\t\t\tAR5K_QUEUE_DFS_MISC(queue));\n\n\t \n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_FRAG_BURST_BACKOFF_ENABLE)\n\t\tath5k_hw_reg_write(ah, AR5K_DCU_MISC_BACKOFF_FRAG,\n\t\t\t\t\tAR5K_QUEUE_DFS_MISC(queue));\n\n\t \n\tswitch (tq->tqi_type) {\n\tcase AR5K_TX_QUEUE_BEACON:\n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\tAR5K_QCU_MISC_FRSHED_DBA_GT |\n\t\t\t\tAR5K_QCU_MISC_CBREXP_BCN_DIS |\n\t\t\t\tAR5K_QCU_MISC_BCN_ENABLE);\n\n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_DFS_MISC(queue),\n\t\t\t\t(AR5K_DCU_MISC_ARBLOCK_CTL_GLOBAL <<\n\t\t\t\tAR5K_DCU_MISC_ARBLOCK_CTL_S) |\n\t\t\t\tAR5K_DCU_MISC_ARBLOCK_IGNORE |\n\t\t\t\tAR5K_DCU_MISC_POST_FR_BKOFF_DIS |\n\t\t\t\tAR5K_DCU_MISC_BCN_ENABLE);\n\t\tbreak;\n\n\tcase AR5K_TX_QUEUE_CAB:\n\t\t \n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\t\tAR5K_QCU_MISC_FRSHED_DBA_GT |\n\t\t\t\t\tAR5K_QCU_MISC_CBREXP_DIS |\n\t\t\t\t\tAR5K_QCU_MISC_CBREXP_BCN_DIS);\n\n\t\tath5k_hw_reg_write(ah, ((tq->tqi_ready_time -\n\t\t\t\t\t(AR5K_TUNE_SW_BEACON_RESP -\n\t\t\t\t\tAR5K_TUNE_DMA_BEACON_RESP) -\n\t\t\t\tAR5K_TUNE_ADDITIONAL_SWBA_BACKOFF) * 1024) |\n\t\t\t\t\tAR5K_QCU_RDYTIMECFG_ENABLE,\n\t\t\t\t\tAR5K_QUEUE_RDYTIMECFG(queue));\n\n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_DFS_MISC(queue),\n\t\t\t\t\t(AR5K_DCU_MISC_ARBLOCK_CTL_GLOBAL <<\n\t\t\t\t\tAR5K_DCU_MISC_ARBLOCK_CTL_S));\n\t\tbreak;\n\n\tcase AR5K_TX_QUEUE_UAPSD:\n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\t\tAR5K_QCU_MISC_CBREXP_DIS);\n\t\tbreak;\n\n\tcase AR5K_TX_QUEUE_DATA:\n\tdefault:\n\t\t\tbreak;\n\t}\n\n\t \n\n\t \n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_TXOKINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_txok, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_TXERRINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_txerr, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_TXURNINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_txurn, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_TXDESCINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_txdesc, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_TXEOLINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_txeol, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_CBRORNINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_cbrorn, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_CBRURNINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_cbrurn, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_QTRIGINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_qtrig, queue);\n\n\tif (tq->tqi_flags & AR5K_TXQ_FLAG_TXNOFRMINT_ENABLE)\n\t\tAR5K_Q_ENABLE_BITS(ah->ah_txq_imr_nofrm, queue);\n\n\t \n\n\t \n\tah->ah_txq_imr_txok &= ah->ah_txq_status;\n\tah->ah_txq_imr_txerr &= ah->ah_txq_status;\n\tah->ah_txq_imr_txurn &= ah->ah_txq_status;\n\tah->ah_txq_imr_txdesc &= ah->ah_txq_status;\n\tah->ah_txq_imr_txeol &= ah->ah_txq_status;\n\tah->ah_txq_imr_cbrorn &= ah->ah_txq_status;\n\tah->ah_txq_imr_cbrurn &= ah->ah_txq_status;\n\tah->ah_txq_imr_qtrig &= ah->ah_txq_status;\n\tah->ah_txq_imr_nofrm &= ah->ah_txq_status;\n\n\tath5k_hw_reg_write(ah, AR5K_REG_SM(ah->ah_txq_imr_txok,\n\t\t\t\t\tAR5K_SIMR0_QCU_TXOK) |\n\t\t\t\t\tAR5K_REG_SM(ah->ah_txq_imr_txdesc,\n\t\t\t\t\tAR5K_SIMR0_QCU_TXDESC),\n\t\t\t\t\tAR5K_SIMR0);\n\n\tath5k_hw_reg_write(ah, AR5K_REG_SM(ah->ah_txq_imr_txerr,\n\t\t\t\t\tAR5K_SIMR1_QCU_TXERR) |\n\t\t\t\t\tAR5K_REG_SM(ah->ah_txq_imr_txeol,\n\t\t\t\t\tAR5K_SIMR1_QCU_TXEOL),\n\t\t\t\t\tAR5K_SIMR1);\n\n\t \n\tAR5K_REG_DISABLE_BITS(ah, AR5K_SIMR2, AR5K_SIMR2_QCU_TXURN);\n\tAR5K_REG_ENABLE_BITS(ah, AR5K_SIMR2,\n\t\t\t\tAR5K_REG_SM(ah->ah_txq_imr_txurn,\n\t\t\t\tAR5K_SIMR2_QCU_TXURN));\n\n\tath5k_hw_reg_write(ah, AR5K_REG_SM(ah->ah_txq_imr_cbrorn,\n\t\t\t\tAR5K_SIMR3_QCBRORN) |\n\t\t\t\tAR5K_REG_SM(ah->ah_txq_imr_cbrurn,\n\t\t\t\tAR5K_SIMR3_QCBRURN),\n\t\t\t\tAR5K_SIMR3);\n\n\tath5k_hw_reg_write(ah, AR5K_REG_SM(ah->ah_txq_imr_qtrig,\n\t\t\t\tAR5K_SIMR4_QTRIG), AR5K_SIMR4);\n\n\t \n\tath5k_hw_reg_write(ah, AR5K_REG_SM(ah->ah_txq_imr_nofrm,\n\t\t\t\tAR5K_TXNOFRM_QCU), AR5K_TXNOFRM);\n\n\t \n\tif (ah->ah_txq_imr_nofrm == 0)\n\t\tath5k_hw_reg_write(ah, 0, AR5K_TXNOFRM);\n\n\t \n\tAR5K_REG_WRITE_Q(ah, AR5K_QUEUE_QCUMASK(queue), queue);\n\n\treturn 0;\n}\n\n\n \n\n \nint ath5k_hw_set_ifs_intervals(struct ath5k_hw *ah, unsigned int slot_time)\n{\n\tstruct ieee80211_channel *channel = ah->ah_current_channel;\n\tenum nl80211_band band;\n\tstruct ieee80211_supported_band *sband;\n\tstruct ieee80211_rate *rate;\n\tu32 ack_tx_time, eifs, eifs_clock, sifs, sifs_clock;\n\tu32 slot_time_clock = ath5k_hw_htoclock(ah, slot_time);\n\tu32 rate_flags, i;\n\n\tif (slot_time < 6 || slot_time_clock > AR5K_SLOT_TIME_MAX)\n\t\treturn -EINVAL;\n\n\tsifs = ath5k_hw_get_default_sifs(ah);\n\tsifs_clock = ath5k_hw_htoclock(ah, sifs - 2);\n\n\t \n\tif (channel->band == NL80211_BAND_5GHZ)\n\t\tband = NL80211_BAND_5GHZ;\n\telse\n\t\tband = NL80211_BAND_2GHZ;\n\n\tswitch (ah->ah_bwmode) {\n\tcase AR5K_BWMODE_5MHZ:\n\t\trate_flags = IEEE80211_RATE_SUPPORTS_5MHZ;\n\t\tbreak;\n\tcase AR5K_BWMODE_10MHZ:\n\t\trate_flags = IEEE80211_RATE_SUPPORTS_10MHZ;\n\t\tbreak;\n\tdefault:\n\t\trate_flags = 0;\n\t\tbreak;\n\t}\n\tsband = &ah->sbands[band];\n\trate = NULL;\n\tfor (i = 0; i < sband->n_bitrates; i++) {\n\t\tif ((rate_flags & sband->bitrates[i].flags) != rate_flags)\n\t\t\tcontinue;\n\t\trate = &sband->bitrates[i];\n\t\tbreak;\n\t}\n\tif (WARN_ON(!rate))\n\t\treturn -EINVAL;\n\n\tack_tx_time = ath5k_hw_get_frame_duration(ah, band, 10, rate, false);\n\n\t \n\teifs = ack_tx_time + sifs + 2 * slot_time;\n\teifs_clock = ath5k_hw_htoclock(ah, eifs);\n\n\t \n\tif (ah->ah_version == AR5K_AR5210) {\n\t\tu32 pifs, pifs_clock, difs, difs_clock;\n\n\t\t \n\t\tath5k_hw_reg_write(ah, slot_time_clock, AR5K_SLOT_TIME);\n\n\t\t \n\t\teifs_clock = AR5K_REG_SM(eifs_clock, AR5K_IFS1_EIFS);\n\n\t\t \n\t\tpifs = slot_time + sifs;\n\t\tpifs_clock = ath5k_hw_htoclock(ah, pifs);\n\t\tpifs_clock = AR5K_REG_SM(pifs_clock, AR5K_IFS1_PIFS);\n\n\t\t \n\t\tdifs = sifs + 2 * slot_time;\n\t\tdifs_clock = ath5k_hw_htoclock(ah, difs);\n\n\t\t \n\t\tath5k_hw_reg_write(ah, (difs_clock <<\n\t\t\t\tAR5K_IFS0_DIFS_S) | sifs_clock,\n\t\t\t\tAR5K_IFS0);\n\n\t\t \n\t\tath5k_hw_reg_write(ah, pifs_clock | eifs_clock |\n\t\t\t\t(AR5K_INIT_CARR_SENSE_EN << AR5K_IFS1_CS_EN_S),\n\t\t\t\tAR5K_IFS1);\n\n\t\treturn 0;\n\t}\n\n\t \n\tath5k_hw_reg_write(ah, slot_time_clock, AR5K_DCU_GBL_IFS_SLOT);\n\n\t \n\tath5k_hw_reg_write(ah, eifs_clock, AR5K_DCU_GBL_IFS_EIFS);\n\n\t \n\tAR5K_REG_WRITE_BITS(ah, AR5K_DCU_GBL_IFS_MISC,\n\t\t\t\tAR5K_DCU_GBL_IFS_MISC_SIFS_DUR_USEC,\n\t\t\t\tsifs);\n\n\t \n\tath5k_hw_reg_write(ah, sifs_clock, AR5K_DCU_GBL_IFS_SIFS);\n\n\treturn 0;\n}\n\n\n \nint\nath5k_hw_init_queues(struct ath5k_hw *ah)\n{\n\tint i, ret;\n\n\t \n\t \n\n\t \n\tif (ah->ah_version != AR5K_AR5210)\n\t\tfor (i = 0; i < ah->ah_capabilities.cap_queues.q_tx_num; i++) {\n\t\t\tret = ath5k_hw_reset_tx_queue(ah, i);\n\t\t\tif (ret) {\n\t\t\t\tATH5K_ERR(ah,\n\t\t\t\t\t\"failed to reset TX queue #%d\\n\", i);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\telse\n\t\t \n\t\tath5k_hw_set_tx_retry_limits(ah, 0);\n\n\t \n\tif (ah->ah_bwmode == AR5K_BWMODE_40MHZ)\n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_DCU_GBL_IFS_MISC,\n\t\t\t\tAR5K_DCU_GBL_IFS_MISC_TURBO_MODE);\n\n\t \n\tif (!ah->ah_coverage_class) {\n\t\tunsigned int slot_time = ath5k_hw_get_default_slottime(ah);\n\t\tath5k_hw_set_ifs_intervals(ah, slot_time);\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}