{
  "module_name": "desc.c",
  "hash_id": "5bec3e7a9e2f1bc98682d8d425215304726c1e4adebcd12cfe307564086a6864",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath5k/desc.c",
  "human_readable_source": " \n\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include \"ath5k.h\"\n#include \"reg.h\"\n#include \"debug.h\"\n\n\n \n\n\n \n\n \nstatic int\nath5k_hw_setup_2word_tx_desc(struct ath5k_hw *ah,\n\t\t\tstruct ath5k_desc *desc,\n\t\t\tunsigned int pkt_len, unsigned int hdr_len,\n\t\t\tint padsize,\n\t\t\tenum ath5k_pkt_type type,\n\t\t\tunsigned int tx_power,\n\t\t\tunsigned int tx_rate0, unsigned int tx_tries0,\n\t\t\tunsigned int key_index,\n\t\t\tunsigned int antenna_mode,\n\t\t\tunsigned int flags,\n\t\t\tunsigned int rtscts_rate, unsigned int rtscts_duration)\n{\n\tu32 frame_type;\n\tstruct ath5k_hw_2w_tx_ctl *tx_ctl;\n\tunsigned int frame_len;\n\n\ttx_ctl = &desc->ud.ds_tx5210.tx_ctl;\n\n\t \n\tif (unlikely(tx_tries0 == 0)) {\n\t\tATH5K_ERR(ah, \"zero retries\\n\");\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\tif (unlikely(tx_rate0 == 0)) {\n\t\tATH5K_ERR(ah, \"zero rate\\n\");\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tmemset(&desc->ud.ds_tx5210, 0, sizeof(struct ath5k_hw_5210_tx_desc));\n\n\t \n\n\t \n\n\t \n\tframe_len = pkt_len - padsize + FCS_LEN;\n\n\tif (frame_len & ~AR5K_2W_TX_DESC_CTL0_FRAME_LEN)\n\t\treturn -EINVAL;\n\n\ttx_ctl->tx_control_0 = frame_len & AR5K_2W_TX_DESC_CTL0_FRAME_LEN;\n\n\t \n\n\t \n\tif (type == AR5K_PKT_TYPE_BEACON)\n\t\tpkt_len = roundup(pkt_len, 4);\n\n\tif (pkt_len & ~AR5K_2W_TX_DESC_CTL1_BUF_LEN)\n\t\treturn -EINVAL;\n\n\ttx_ctl->tx_control_1 = pkt_len & AR5K_2W_TX_DESC_CTL1_BUF_LEN;\n\n\t \n\tif (ah->ah_version == AR5K_AR5210) {\n\t\tif (hdr_len & ~AR5K_2W_TX_DESC_CTL0_HEADER_LEN_5210)\n\t\t\treturn -EINVAL;\n\t\ttx_ctl->tx_control_0 |=\n\t\t\tAR5K_REG_SM(hdr_len, AR5K_2W_TX_DESC_CTL0_HEADER_LEN_5210);\n\t}\n\n\t \n\tif (ah->ah_version == AR5K_AR5210) {\n\t\tswitch (type) {\n\t\tcase AR5K_PKT_TYPE_BEACON:\n\t\tcase AR5K_PKT_TYPE_PROBE_RESP:\n\t\t\tframe_type = AR5K_AR5210_TX_DESC_FRAME_TYPE_NO_DELAY;\n\t\t\tbreak;\n\t\tcase AR5K_PKT_TYPE_PIFS:\n\t\t\tframe_type = AR5K_AR5210_TX_DESC_FRAME_TYPE_PIFS;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tframe_type = type;\n\t\t\tbreak;\n\t\t}\n\n\t\ttx_ctl->tx_control_0 |=\n\t\tAR5K_REG_SM(frame_type, AR5K_2W_TX_DESC_CTL0_FRAME_TYPE_5210) |\n\t\tAR5K_REG_SM(tx_rate0, AR5K_2W_TX_DESC_CTL0_XMIT_RATE);\n\n\t} else {\n\t\ttx_ctl->tx_control_0 |=\n\t\t\tAR5K_REG_SM(tx_rate0, AR5K_2W_TX_DESC_CTL0_XMIT_RATE) |\n\t\t\tAR5K_REG_SM(antenna_mode,\n\t\t\t\tAR5K_2W_TX_DESC_CTL0_ANT_MODE_XMIT);\n\t\ttx_ctl->tx_control_1 |=\n\t\t\tAR5K_REG_SM(type, AR5K_2W_TX_DESC_CTL1_FRAME_TYPE_5211);\n\t}\n\n#define _TX_FLAGS(_c, _flag)\t\t\t\t\t\\\n\tif (flags & AR5K_TXDESC_##_flag) {\t\t\t\\\n\t\ttx_ctl->tx_control_##_c |=\t\t\t\\\n\t\t\tAR5K_2W_TX_DESC_CTL##_c##_##_flag;\t\\\n\t}\n#define _TX_FLAGS_5211(_c, _flag)\t\t\t\t\t\\\n\tif (flags & AR5K_TXDESC_##_flag) {\t\t\t\t\\\n\t\ttx_ctl->tx_control_##_c |=\t\t\t\t\\\n\t\t\tAR5K_2W_TX_DESC_CTL##_c##_##_flag##_5211;\t\\\n\t}\n\t_TX_FLAGS(0, CLRDMASK);\n\t_TX_FLAGS(0, INTREQ);\n\t_TX_FLAGS(0, RTSENA);\n\n\tif (ah->ah_version == AR5K_AR5211) {\n\t\t_TX_FLAGS_5211(0, VEOL);\n\t\t_TX_FLAGS_5211(1, NOACK);\n\t}\n\n#undef _TX_FLAGS\n#undef _TX_FLAGS_5211\n\n\t \n\tif (key_index != AR5K_TXKEYIX_INVALID) {\n\t\ttx_ctl->tx_control_0 |=\n\t\t\tAR5K_2W_TX_DESC_CTL0_ENCRYPT_KEY_VALID;\n\t\ttx_ctl->tx_control_1 |=\n\t\t\tAR5K_REG_SM(key_index,\n\t\t\tAR5K_2W_TX_DESC_CTL1_ENC_KEY_IDX);\n\t}\n\n\t \n\tif ((ah->ah_version == AR5K_AR5210) &&\n\t\t\t(flags & (AR5K_TXDESC_RTSENA | AR5K_TXDESC_CTSENA)))\n\t\ttx_ctl->tx_control_1 |= rtscts_duration &\n\t\t\t\tAR5K_2W_TX_DESC_CTL1_RTS_DURATION_5210;\n\n\treturn 0;\n}\n\n \nstatic int\nath5k_hw_setup_4word_tx_desc(struct ath5k_hw *ah,\n\t\t\tstruct ath5k_desc *desc,\n\t\t\tunsigned int pkt_len, unsigned int hdr_len,\n\t\t\tint padsize,\n\t\t\tenum ath5k_pkt_type type,\n\t\t\tunsigned int tx_power,\n\t\t\tunsigned int tx_rate0, unsigned int tx_tries0,\n\t\t\tunsigned int key_index,\n\t\t\tunsigned int antenna_mode,\n\t\t\tunsigned int flags,\n\t\t\tunsigned int rtscts_rate, unsigned int rtscts_duration)\n{\n\tstruct ath5k_hw_4w_tx_ctl *tx_ctl;\n\tunsigned int frame_len;\n\n\t \n\tu32 txctl0 = 0, txctl1 = 0, txctl2 = 0, txctl3 = 0;\n\n\ttx_ctl = &desc->ud.ds_tx5212.tx_ctl;\n\n\t \n\tif (unlikely(tx_tries0 == 0)) {\n\t\tATH5K_ERR(ah, \"zero retries\\n\");\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\tif (unlikely(tx_rate0 == 0)) {\n\t\tATH5K_ERR(ah, \"zero rate\\n\");\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\n\ttx_power += ah->ah_txpower.txp_offset;\n\tif (tx_power > AR5K_TUNE_MAX_TXPOWER)\n\t\ttx_power = AR5K_TUNE_MAX_TXPOWER;\n\n\t \n\tmemset(&desc->ud.ds_tx5212.tx_stat, 0,\n\t       sizeof(desc->ud.ds_tx5212.tx_stat));\n\n\t \n\n\t \n\n\t \n\tframe_len = pkt_len - padsize + FCS_LEN;\n\n\tif (frame_len & ~AR5K_4W_TX_DESC_CTL0_FRAME_LEN)\n\t\treturn -EINVAL;\n\n\ttxctl0 = frame_len & AR5K_4W_TX_DESC_CTL0_FRAME_LEN;\n\n\t \n\n\t \n\tif (type == AR5K_PKT_TYPE_BEACON)\n\t\tpkt_len = roundup(pkt_len, 4);\n\n\tif (pkt_len & ~AR5K_4W_TX_DESC_CTL1_BUF_LEN)\n\t\treturn -EINVAL;\n\n\ttxctl1 = pkt_len & AR5K_4W_TX_DESC_CTL1_BUF_LEN;\n\n\ttxctl0 |= AR5K_REG_SM(tx_power, AR5K_4W_TX_DESC_CTL0_XMIT_POWER) |\n\t\t  AR5K_REG_SM(antenna_mode, AR5K_4W_TX_DESC_CTL0_ANT_MODE_XMIT);\n\ttxctl1 |= AR5K_REG_SM(type, AR5K_4W_TX_DESC_CTL1_FRAME_TYPE);\n\ttxctl2 = AR5K_REG_SM(tx_tries0, AR5K_4W_TX_DESC_CTL2_XMIT_TRIES0);\n\ttxctl3 = tx_rate0 & AR5K_4W_TX_DESC_CTL3_XMIT_RATE0;\n\n#define _TX_FLAGS(_c, _flag)\t\t\t\t\t\\\n\tif (flags & AR5K_TXDESC_##_flag) {\t\t\t\\\n\t\ttxctl##_c |= AR5K_4W_TX_DESC_CTL##_c##_##_flag;\t\\\n\t}\n\n\t_TX_FLAGS(0, CLRDMASK);\n\t_TX_FLAGS(0, VEOL);\n\t_TX_FLAGS(0, INTREQ);\n\t_TX_FLAGS(0, RTSENA);\n\t_TX_FLAGS(0, CTSENA);\n\t_TX_FLAGS(1, NOACK);\n\n#undef _TX_FLAGS\n\n\t \n\tif (key_index != AR5K_TXKEYIX_INVALID) {\n\t\ttxctl0 |= AR5K_4W_TX_DESC_CTL0_ENCRYPT_KEY_VALID;\n\t\ttxctl1 |= AR5K_REG_SM(key_index,\n\t\t\t\tAR5K_4W_TX_DESC_CTL1_ENCRYPT_KEY_IDX);\n\t}\n\n\t \n\tif (flags & (AR5K_TXDESC_RTSENA | AR5K_TXDESC_CTSENA)) {\n\t\tif ((flags & AR5K_TXDESC_RTSENA) &&\n\t\t\t\t(flags & AR5K_TXDESC_CTSENA))\n\t\t\treturn -EINVAL;\n\t\ttxctl2 |= rtscts_duration & AR5K_4W_TX_DESC_CTL2_RTS_DURATION;\n\t\ttxctl3 |= AR5K_REG_SM(rtscts_rate,\n\t\t\t\tAR5K_4W_TX_DESC_CTL3_RTS_CTS_RATE);\n\t}\n\n\ttx_ctl->tx_control_0 = txctl0;\n\ttx_ctl->tx_control_1 = txctl1;\n\ttx_ctl->tx_control_2 = txctl2;\n\ttx_ctl->tx_control_3 = txctl3;\n\n\treturn 0;\n}\n\n \nint\nath5k_hw_setup_mrr_tx_desc(struct ath5k_hw *ah,\n\t\t\tstruct ath5k_desc *desc,\n\t\t\tu_int tx_rate1, u_int tx_tries1,\n\t\t\tu_int tx_rate2, u_int tx_tries2,\n\t\t\tu_int tx_rate3, u_int tx_tries3)\n{\n\tstruct ath5k_hw_4w_tx_ctl *tx_ctl;\n\n\t \n\tif (ah->ah_version < AR5K_AR5212)\n\t\treturn 0;\n\n\t \n\tif (unlikely((tx_rate1 == 0 && tx_tries1 != 0) ||\n\t\t     (tx_rate2 == 0 && tx_tries2 != 0) ||\n\t\t     (tx_rate3 == 0 && tx_tries3 != 0))) {\n\t\tATH5K_ERR(ah, \"zero rate\\n\");\n\t\tWARN_ON(1);\n\t\treturn -EINVAL;\n\t}\n\n\tif (ah->ah_version == AR5K_AR5212) {\n\t\ttx_ctl = &desc->ud.ds_tx5212.tx_ctl;\n\n#define _XTX_TRIES(_n)\t\t\t\t\t\t\t\\\n\tif (tx_tries##_n) {\t\t\t\t\t\t\\\n\t\ttx_ctl->tx_control_2 |=\t\t\t\t\t\\\n\t\t    AR5K_REG_SM(tx_tries##_n,\t\t\t\t\\\n\t\t    AR5K_4W_TX_DESC_CTL2_XMIT_TRIES##_n);\t\t\\\n\t\ttx_ctl->tx_control_3 |=\t\t\t\t\t\\\n\t\t    AR5K_REG_SM(tx_rate##_n,\t\t\t\t\\\n\t\t    AR5K_4W_TX_DESC_CTL3_XMIT_RATE##_n);\t\t\\\n\t}\n\n\t\t_XTX_TRIES(1);\n\t\t_XTX_TRIES(2);\n\t\t_XTX_TRIES(3);\n\n#undef _XTX_TRIES\n\n\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\n\n \n\n \nstatic int\nath5k_hw_proc_2word_tx_status(struct ath5k_hw *ah,\n\t\t\t\tstruct ath5k_desc *desc,\n\t\t\t\tstruct ath5k_tx_status *ts)\n{\n\tstruct ath5k_hw_tx_status *tx_status;\n\n\ttx_status = &desc->ud.ds_tx5210.tx_stat;\n\n\t \n\tif (unlikely((tx_status->tx_status_1 & AR5K_DESC_TX_STATUS1_DONE) == 0))\n\t\treturn -EINPROGRESS;\n\n\t \n\tts->ts_tstamp = AR5K_REG_MS(tx_status->tx_status_0,\n\t\tAR5K_DESC_TX_STATUS0_SEND_TIMESTAMP);\n\tts->ts_shortretry = AR5K_REG_MS(tx_status->tx_status_0,\n\t\tAR5K_DESC_TX_STATUS0_SHORT_RETRY_COUNT);\n\tts->ts_final_retry = AR5K_REG_MS(tx_status->tx_status_0,\n\t\tAR5K_DESC_TX_STATUS0_LONG_RETRY_COUNT);\n\t \n\tts->ts_seqnum = AR5K_REG_MS(tx_status->tx_status_1,\n\t\tAR5K_DESC_TX_STATUS1_SEQ_NUM);\n\tts->ts_rssi = AR5K_REG_MS(tx_status->tx_status_1,\n\t\tAR5K_DESC_TX_STATUS1_ACK_SIG_STRENGTH);\n\tts->ts_antenna = 1;\n\tts->ts_status = 0;\n\tts->ts_final_idx = 0;\n\n\tif (!(tx_status->tx_status_0 & AR5K_DESC_TX_STATUS0_FRAME_XMIT_OK)) {\n\t\tif (tx_status->tx_status_0 &\n\t\t\t\tAR5K_DESC_TX_STATUS0_EXCESSIVE_RETRIES)\n\t\t\tts->ts_status |= AR5K_TXERR_XRETRY;\n\n\t\tif (tx_status->tx_status_0 & AR5K_DESC_TX_STATUS0_FIFO_UNDERRUN)\n\t\t\tts->ts_status |= AR5K_TXERR_FIFO;\n\n\t\tif (tx_status->tx_status_0 & AR5K_DESC_TX_STATUS0_FILTERED)\n\t\t\tts->ts_status |= AR5K_TXERR_FILT;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int\nath5k_hw_proc_4word_tx_status(struct ath5k_hw *ah,\n\t\t\t\tstruct ath5k_desc *desc,\n\t\t\t\tstruct ath5k_tx_status *ts)\n{\n\tstruct ath5k_hw_tx_status *tx_status;\n\tu32 txstat0, txstat1;\n\n\ttx_status = &desc->ud.ds_tx5212.tx_stat;\n\n\ttxstat1 = READ_ONCE(tx_status->tx_status_1);\n\n\t \n\tif (unlikely(!(txstat1 & AR5K_DESC_TX_STATUS1_DONE)))\n\t\treturn -EINPROGRESS;\n\n\ttxstat0 = READ_ONCE(tx_status->tx_status_0);\n\n\t \n\tts->ts_tstamp = AR5K_REG_MS(txstat0,\n\t\tAR5K_DESC_TX_STATUS0_SEND_TIMESTAMP);\n\tts->ts_shortretry = AR5K_REG_MS(txstat0,\n\t\tAR5K_DESC_TX_STATUS0_SHORT_RETRY_COUNT);\n\tts->ts_final_retry = AR5K_REG_MS(txstat0,\n\t\tAR5K_DESC_TX_STATUS0_LONG_RETRY_COUNT);\n\tts->ts_seqnum = AR5K_REG_MS(txstat1,\n\t\tAR5K_DESC_TX_STATUS1_SEQ_NUM);\n\tts->ts_rssi = AR5K_REG_MS(txstat1,\n\t\tAR5K_DESC_TX_STATUS1_ACK_SIG_STRENGTH);\n\tts->ts_antenna = (txstat1 &\n\t\tAR5K_DESC_TX_STATUS1_XMIT_ANTENNA_5212) ? 2 : 1;\n\tts->ts_status = 0;\n\n\tts->ts_final_idx = AR5K_REG_MS(txstat1,\n\t\t\tAR5K_DESC_TX_STATUS1_FINAL_TS_IX_5212);\n\n\t \n\tif (!(txstat0 & AR5K_DESC_TX_STATUS0_FRAME_XMIT_OK)) {\n\t\tif (txstat0 & AR5K_DESC_TX_STATUS0_EXCESSIVE_RETRIES)\n\t\t\tts->ts_status |= AR5K_TXERR_XRETRY;\n\n\t\tif (txstat0 & AR5K_DESC_TX_STATUS0_FIFO_UNDERRUN)\n\t\t\tts->ts_status |= AR5K_TXERR_FIFO;\n\n\t\tif (txstat0 & AR5K_DESC_TX_STATUS0_FILTERED)\n\t\t\tts->ts_status |= AR5K_TXERR_FILT;\n\t}\n\n\treturn 0;\n}\n\n\n \n\n \nint\nath5k_hw_setup_rx_desc(struct ath5k_hw *ah,\n\t\t\tstruct ath5k_desc *desc,\n\t\t\tu32 size, unsigned int flags)\n{\n\tstruct ath5k_hw_rx_ctl *rx_ctl;\n\n\trx_ctl = &desc->ud.ds_rx.rx_ctl;\n\n\t \n\tmemset(&desc->ud.ds_rx, 0, sizeof(struct ath5k_hw_all_rx_desc));\n\n\tif (unlikely(size & ~AR5K_DESC_RX_CTL1_BUF_LEN))\n\t\treturn -EINVAL;\n\n\t \n\trx_ctl->rx_control_1 = size & AR5K_DESC_RX_CTL1_BUF_LEN;\n\n\tif (flags & AR5K_RXDESC_INTREQ)\n\t\trx_ctl->rx_control_1 |= AR5K_DESC_RX_CTL1_INTREQ;\n\n\treturn 0;\n}\n\n \nstatic int\nath5k_hw_proc_5210_rx_status(struct ath5k_hw *ah,\n\t\t\t\tstruct ath5k_desc *desc,\n\t\t\t\tstruct ath5k_rx_status *rs)\n{\n\tstruct ath5k_hw_rx_status *rx_status;\n\n\trx_status = &desc->ud.ds_rx.rx_stat;\n\n\t \n\tif (unlikely(!(rx_status->rx_status_1 &\n\t\t\tAR5K_5210_RX_DESC_STATUS1_DONE)))\n\t\treturn -EINPROGRESS;\n\n\tmemset(rs, 0, sizeof(struct ath5k_rx_status));\n\n\t \n\trs->rs_datalen = rx_status->rx_status_0 &\n\t\tAR5K_5210_RX_DESC_STATUS0_DATA_LEN;\n\trs->rs_rssi = AR5K_REG_MS(rx_status->rx_status_0,\n\t\tAR5K_5210_RX_DESC_STATUS0_RECEIVE_SIGNAL);\n\trs->rs_rate = AR5K_REG_MS(rx_status->rx_status_0,\n\t\tAR5K_5210_RX_DESC_STATUS0_RECEIVE_RATE);\n\trs->rs_more = !!(rx_status->rx_status_0 &\n\t\tAR5K_5210_RX_DESC_STATUS0_MORE);\n\t \n\trs->rs_tstamp = AR5K_REG_MS(rx_status->rx_status_1,\n\t\tAR5K_5210_RX_DESC_STATUS1_RECEIVE_TIMESTAMP);\n\n\tif (ah->ah_version == AR5K_AR5211)\n\t\trs->rs_antenna = AR5K_REG_MS(rx_status->rx_status_0,\n\t\t\t\tAR5K_5210_RX_DESC_STATUS0_RECEIVE_ANT_5211);\n\telse\n\t\trs->rs_antenna = (rx_status->rx_status_0 &\n\t\t\t\tAR5K_5210_RX_DESC_STATUS0_RECEIVE_ANT_5210)\n\t\t\t\t? 2 : 1;\n\n\t \n\tif (rx_status->rx_status_1 & AR5K_5210_RX_DESC_STATUS1_KEY_INDEX_VALID)\n\t\trs->rs_keyix = AR5K_REG_MS(rx_status->rx_status_1,\n\t\t\tAR5K_5210_RX_DESC_STATUS1_KEY_INDEX);\n\telse\n\t\trs->rs_keyix = AR5K_RXKEYIX_INVALID;\n\n\t \n\tif (!(rx_status->rx_status_1 &\n\t\t\tAR5K_5210_RX_DESC_STATUS1_FRAME_RECEIVE_OK)) {\n\t\tif (rx_status->rx_status_1 &\n\t\t\t\tAR5K_5210_RX_DESC_STATUS1_CRC_ERROR)\n\t\t\trs->rs_status |= AR5K_RXERR_CRC;\n\n\t\t \n\t\tif ((ah->ah_version == AR5K_AR5210) &&\n\t\t    (rx_status->rx_status_1 &\n\t\t\t\tAR5K_5210_RX_DESC_STATUS1_FIFO_OVERRUN_5210))\n\t\t\trs->rs_status |= AR5K_RXERR_FIFO;\n\n\t\tif (rx_status->rx_status_1 &\n\t\t\t\tAR5K_5210_RX_DESC_STATUS1_PHY_ERROR) {\n\t\t\trs->rs_status |= AR5K_RXERR_PHY;\n\t\t\trs->rs_phyerr = AR5K_REG_MS(rx_status->rx_status_1,\n\t\t\t\tAR5K_5210_RX_DESC_STATUS1_PHY_ERROR);\n\t\t}\n\n\t\tif (rx_status->rx_status_1 &\n\t\t\t\tAR5K_5210_RX_DESC_STATUS1_DECRYPT_CRC_ERROR)\n\t\t\trs->rs_status |= AR5K_RXERR_DECRYPT;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int\nath5k_hw_proc_5212_rx_status(struct ath5k_hw *ah,\n\t\t\t\tstruct ath5k_desc *desc,\n\t\t\t\tstruct ath5k_rx_status *rs)\n{\n\tstruct ath5k_hw_rx_status *rx_status;\n\tu32 rxstat0, rxstat1;\n\n\trx_status = &desc->ud.ds_rx.rx_stat;\n\trxstat1 = READ_ONCE(rx_status->rx_status_1);\n\n\t \n\tif (unlikely(!(rxstat1 & AR5K_5212_RX_DESC_STATUS1_DONE)))\n\t\treturn -EINPROGRESS;\n\n\tmemset(rs, 0, sizeof(struct ath5k_rx_status));\n\trxstat0 = READ_ONCE(rx_status->rx_status_0);\n\n\t \n\trs->rs_datalen = rxstat0 & AR5K_5212_RX_DESC_STATUS0_DATA_LEN;\n\trs->rs_rssi = AR5K_REG_MS(rxstat0,\n\t\tAR5K_5212_RX_DESC_STATUS0_RECEIVE_SIGNAL);\n\trs->rs_rate = AR5K_REG_MS(rxstat0,\n\t\tAR5K_5212_RX_DESC_STATUS0_RECEIVE_RATE);\n\trs->rs_antenna = AR5K_REG_MS(rxstat0,\n\t\tAR5K_5212_RX_DESC_STATUS0_RECEIVE_ANTENNA);\n\trs->rs_more = !!(rxstat0 & AR5K_5212_RX_DESC_STATUS0_MORE);\n\trs->rs_tstamp = AR5K_REG_MS(rxstat1,\n\t\tAR5K_5212_RX_DESC_STATUS1_RECEIVE_TIMESTAMP);\n\n\t \n\tif (rxstat1 & AR5K_5212_RX_DESC_STATUS1_KEY_INDEX_VALID)\n\t\trs->rs_keyix = AR5K_REG_MS(rxstat1,\n\t\t\t\t\t   AR5K_5212_RX_DESC_STATUS1_KEY_INDEX);\n\telse\n\t\trs->rs_keyix = AR5K_RXKEYIX_INVALID;\n\n\t \n\tif (!(rxstat1 & AR5K_5212_RX_DESC_STATUS1_FRAME_RECEIVE_OK)) {\n\t\tif (rxstat1 & AR5K_5212_RX_DESC_STATUS1_CRC_ERROR)\n\t\t\trs->rs_status |= AR5K_RXERR_CRC;\n\n\t\tif (rxstat1 & AR5K_5212_RX_DESC_STATUS1_PHY_ERROR) {\n\t\t\trs->rs_status |= AR5K_RXERR_PHY;\n\t\t\trs->rs_phyerr = AR5K_REG_MS(rxstat1,\n\t\t\t\tAR5K_5212_RX_DESC_STATUS1_PHY_ERROR_CODE);\n\t\t\tif (!ah->ah_capabilities.cap_has_phyerr_counters)\n\t\t\t\tath5k_ani_phy_error_report(ah, rs->rs_phyerr);\n\t\t}\n\n\t\tif (rxstat1 & AR5K_5212_RX_DESC_STATUS1_DECRYPT_CRC_ERROR)\n\t\t\trs->rs_status |= AR5K_RXERR_DECRYPT;\n\n\t\tif (rxstat1 & AR5K_5212_RX_DESC_STATUS1_MIC_ERROR)\n\t\t\trs->rs_status |= AR5K_RXERR_MIC;\n\t}\n\treturn 0;\n}\n\n\n \n\n \nint\nath5k_hw_init_desc_functions(struct ath5k_hw *ah)\n{\n\tif (ah->ah_version == AR5K_AR5212) {\n\t\tah->ah_setup_tx_desc = ath5k_hw_setup_4word_tx_desc;\n\t\tah->ah_proc_tx_desc = ath5k_hw_proc_4word_tx_status;\n\t\tah->ah_proc_rx_desc = ath5k_hw_proc_5212_rx_status;\n\t} else if (ah->ah_version <= AR5K_AR5211) {\n\t\tah->ah_setup_tx_desc = ath5k_hw_setup_2word_tx_desc;\n\t\tah->ah_proc_tx_desc = ath5k_hw_proc_2word_tx_status;\n\t\tah->ah_proc_rx_desc = ath5k_hw_proc_5210_rx_status;\n\t} else\n\t\treturn -ENOTSUPP;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}