{
  "module_name": "dma.c",
  "hash_id": "f45854097c20f563019cc71e245c7a5b38350b559e7e63708b413b9f497d2293",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ath/ath5k/dma.c",
  "human_readable_source": " \n\n \n\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include \"ath5k.h\"\n#include \"reg.h\"\n#include \"debug.h\"\n\n\n \n\n \nvoid\nath5k_hw_start_rx_dma(struct ath5k_hw *ah)\n{\n\tath5k_hw_reg_write(ah, AR5K_CR_RXE, AR5K_CR);\n\tath5k_hw_reg_read(ah, AR5K_CR);\n}\n\n \nstatic int\nath5k_hw_stop_rx_dma(struct ath5k_hw *ah)\n{\n\tunsigned int i;\n\n\tath5k_hw_reg_write(ah, AR5K_CR_RXD, AR5K_CR);\n\n\t \n\tfor (i = 1000; i > 0 &&\n\t\t\t(ath5k_hw_reg_read(ah, AR5K_CR) & AR5K_CR_RXE) != 0;\n\t\t\ti--)\n\t\tudelay(100);\n\n\tif (!i)\n\t\tATH5K_DBG(ah, ATH5K_DEBUG_DMA,\n\t\t\t\t\"failed to stop RX DMA !\\n\");\n\n\treturn i ? 0 : -EBUSY;\n}\n\n \nu32\nath5k_hw_get_rxdp(struct ath5k_hw *ah)\n{\n\treturn ath5k_hw_reg_read(ah, AR5K_RXDP);\n}\n\n \nint\nath5k_hw_set_rxdp(struct ath5k_hw *ah, u32 phys_addr)\n{\n\tif (ath5k_hw_reg_read(ah, AR5K_CR) & AR5K_CR_RXE) {\n\t\tATH5K_DBG(ah, ATH5K_DEBUG_DMA,\n\t\t\t\t\"tried to set RXDP while rx was active !\\n\");\n\t\treturn -EIO;\n\t}\n\n\tath5k_hw_reg_write(ah, phys_addr, AR5K_RXDP);\n\treturn 0;\n}\n\n\n \n\n \nint\nath5k_hw_start_tx_dma(struct ath5k_hw *ah, unsigned int queue)\n{\n\tu32 tx_queue;\n\n\tAR5K_ASSERT_ENTRY(queue, ah->ah_capabilities.cap_queues.q_tx_num);\n\n\t \n\tif (ah->ah_txq[queue].tqi_type == AR5K_TX_QUEUE_INACTIVE)\n\t\treturn -EINVAL;\n\n\tif (ah->ah_version == AR5K_AR5210) {\n\t\ttx_queue = ath5k_hw_reg_read(ah, AR5K_CR);\n\n\t\t \n\t\tswitch (ah->ah_txq[queue].tqi_type) {\n\t\tcase AR5K_TX_QUEUE_DATA:\n\t\t\ttx_queue |= AR5K_CR_TXE0 & ~AR5K_CR_TXD0;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_BEACON:\n\t\t\ttx_queue |= AR5K_CR_TXE1 & ~AR5K_CR_TXD1;\n\t\t\tath5k_hw_reg_write(ah, AR5K_BCR_TQ1V | AR5K_BCR_BDMAE,\n\t\t\t\t\tAR5K_BSR);\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_CAB:\n\t\t\ttx_queue |= AR5K_CR_TXE1 & ~AR5K_CR_TXD1;\n\t\t\tath5k_hw_reg_write(ah, AR5K_BCR_TQ1FV | AR5K_BCR_TQ1V |\n\t\t\t\tAR5K_BCR_BDMAE, AR5K_BSR);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t\t \n\t\tath5k_hw_reg_write(ah, tx_queue, AR5K_CR);\n\t\tath5k_hw_reg_read(ah, AR5K_CR);\n\t} else {\n\t\t \n\t\tif (AR5K_REG_READ_Q(ah, AR5K_QCU_TXD, queue))\n\t\t\treturn -EIO;\n\n\t\t \n\t\tAR5K_REG_WRITE_Q(ah, AR5K_QCU_TXE, queue);\n\t}\n\n\treturn 0;\n}\n\n \nstatic int\nath5k_hw_stop_tx_dma(struct ath5k_hw *ah, unsigned int queue)\n{\n\tunsigned int i = 40;\n\tu32 tx_queue, pending;\n\n\tAR5K_ASSERT_ENTRY(queue, ah->ah_capabilities.cap_queues.q_tx_num);\n\n\t \n\tif (ah->ah_txq[queue].tqi_type == AR5K_TX_QUEUE_INACTIVE)\n\t\treturn -EINVAL;\n\n\tif (ah->ah_version == AR5K_AR5210) {\n\t\ttx_queue = ath5k_hw_reg_read(ah, AR5K_CR);\n\n\t\t \n\t\tswitch (ah->ah_txq[queue].tqi_type) {\n\t\tcase AR5K_TX_QUEUE_DATA:\n\t\t\ttx_queue |= AR5K_CR_TXD0 & ~AR5K_CR_TXE0;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_BEACON:\n\t\tcase AR5K_TX_QUEUE_CAB:\n\t\t\t \n\t\t\ttx_queue |= AR5K_CR_TXD1 & ~AR5K_CR_TXD1;\n\t\t\tath5k_hw_reg_write(ah, 0, AR5K_BSR);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\t \n\t\tath5k_hw_reg_write(ah, tx_queue, AR5K_CR);\n\t\tath5k_hw_reg_read(ah, AR5K_CR);\n\t} else {\n\n\t\t \n\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\t\tAR5K_QCU_MISC_DCU_EARLY);\n\n\t\t \n\t\tAR5K_REG_WRITE_Q(ah, AR5K_QCU_TXD, queue);\n\n\t\t \n\t\tfor (i = 1000; i > 0 &&\n\t\t(AR5K_REG_READ_Q(ah, AR5K_QCU_TXE, queue) != 0);\n\t\ti--)\n\t\t\tudelay(100);\n\n\t\tif (AR5K_REG_READ_Q(ah, AR5K_QCU_TXE, queue))\n\t\t\tATH5K_DBG(ah, ATH5K_DEBUG_DMA,\n\t\t\t\t\"queue %i didn't stop !\\n\", queue);\n\n\t\t \n\t\ti = 1000;\n\t\tdo {\n\t\t\tpending = ath5k_hw_reg_read(ah,\n\t\t\t\tAR5K_QUEUE_STATUS(queue)) &\n\t\t\t\tAR5K_QCU_STS_FRMPENDCNT;\n\t\t\tudelay(100);\n\t\t} while (--i && pending);\n\n\t\t \n\t\tif (ah->ah_mac_version >= (AR5K_SREV_AR2414 >> 4) &&\n\t\t    pending) {\n\t\t\t \n\t\t\tath5k_hw_reg_write(ah,\n\t\t\t\tAR5K_REG_SM(100, AR5K_QUIET_CTL2_QT_PER)|\n\t\t\t\tAR5K_REG_SM(10, AR5K_QUIET_CTL2_QT_DUR),\n\t\t\t\tAR5K_QUIET_CTL2);\n\n\t\t\t \n\t\t\tath5k_hw_reg_write(ah,\n\t\t\t\tAR5K_QUIET_CTL1_QT_EN |\n\t\t\t\tAR5K_REG_SM(ath5k_hw_reg_read(ah,\n\t\t\t\t\t\tAR5K_TSF_L32_5211) >> 10,\n\t\t\t\t\t\tAR5K_QUIET_CTL1_NEXT_QT_TSF),\n\t\t\t\tAR5K_QUIET_CTL1);\n\n\t\t\t \n\t\t\tAR5K_REG_ENABLE_BITS(ah, AR5K_DIAG_SW_5211,\n\t\t\t\t\tAR5K_DIAG_SW_CHANNEL_IDLE_HIGH);\n\n\t\t\t \n\t\t\tudelay(400);\n\t\t\tAR5K_REG_DISABLE_BITS(ah, AR5K_QUIET_CTL1,\n\t\t\t\t\t\tAR5K_QUIET_CTL1_QT_EN);\n\n\t\t\t \n\t\t\ti = 100;\n\t\t\tdo {\n\t\t\t\tpending = ath5k_hw_reg_read(ah,\n\t\t\t\t\tAR5K_QUEUE_STATUS(queue)) &\n\t\t\t\t\tAR5K_QCU_STS_FRMPENDCNT;\n\t\t\t\tudelay(100);\n\t\t\t} while (--i && pending);\n\n\t\t\tAR5K_REG_DISABLE_BITS(ah, AR5K_DIAG_SW_5211,\n\t\t\t\t\tAR5K_DIAG_SW_CHANNEL_IDLE_HIGH);\n\n\t\t\tif (pending)\n\t\t\t\tATH5K_DBG(ah, ATH5K_DEBUG_DMA,\n\t\t\t\t\t\"quiet mechanism didn't work q:%i !\\n\",\n\t\t\t\t\tqueue);\n\t\t}\n\n\t\t \n\t\tAR5K_REG_DISABLE_BITS(ah, AR5K_QUEUE_MISC(queue),\n\t\t\t\t\tAR5K_QCU_MISC_DCU_EARLY);\n\n\t\t \n\t\tath5k_hw_reg_write(ah, 0, AR5K_QCU_TXD);\n\t\tif (pending) {\n\t\t\tATH5K_DBG(ah, ATH5K_DEBUG_DMA,\n\t\t\t\t\t\"tx dma didn't stop (q:%i, frm:%i) !\\n\",\n\t\t\t\t\tqueue, pending);\n\t\t\treturn -EBUSY;\n\t\t}\n\t}\n\n\t \n\treturn 0;\n}\n\n \nint\nath5k_hw_stop_beacon_queue(struct ath5k_hw *ah, unsigned int queue)\n{\n\tint ret;\n\tret = ath5k_hw_stop_tx_dma(ah, queue);\n\tif (ret) {\n\t\tATH5K_DBG(ah, ATH5K_DEBUG_DMA,\n\t\t\t\t\"beacon queue didn't stop !\\n\");\n\t\treturn -EIO;\n\t}\n\treturn 0;\n}\n\n \nu32\nath5k_hw_get_txdp(struct ath5k_hw *ah, unsigned int queue)\n{\n\tu16 tx_reg;\n\n\tAR5K_ASSERT_ENTRY(queue, ah->ah_capabilities.cap_queues.q_tx_num);\n\n\t \n\t \n\tif (ah->ah_version == AR5K_AR5210) {\n\t\tswitch (ah->ah_txq[queue].tqi_type) {\n\t\tcase AR5K_TX_QUEUE_DATA:\n\t\t\ttx_reg = AR5K_NOQCU_TXDP0;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_BEACON:\n\t\tcase AR5K_TX_QUEUE_CAB:\n\t\t\ttx_reg = AR5K_NOQCU_TXDP1;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn 0xffffffff;\n\t\t}\n\t} else {\n\t\ttx_reg = AR5K_QUEUE_TXDP(queue);\n\t}\n\n\treturn ath5k_hw_reg_read(ah, tx_reg);\n}\n\n \nint\nath5k_hw_set_txdp(struct ath5k_hw *ah, unsigned int queue, u32 phys_addr)\n{\n\tu16 tx_reg;\n\n\tAR5K_ASSERT_ENTRY(queue, ah->ah_capabilities.cap_queues.q_tx_num);\n\n\t \n\tif (ah->ah_version == AR5K_AR5210) {\n\t\tswitch (ah->ah_txq[queue].tqi_type) {\n\t\tcase AR5K_TX_QUEUE_DATA:\n\t\t\ttx_reg = AR5K_NOQCU_TXDP0;\n\t\t\tbreak;\n\t\tcase AR5K_TX_QUEUE_BEACON:\n\t\tcase AR5K_TX_QUEUE_CAB:\n\t\t\ttx_reg = AR5K_NOQCU_TXDP1;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\t} else {\n\t\t \n\t\tif (AR5K_REG_READ_Q(ah, AR5K_QCU_TXE, queue))\n\t\t\treturn -EIO;\n\n\t\ttx_reg = AR5K_QUEUE_TXDP(queue);\n\t}\n\n\t \n\tath5k_hw_reg_write(ah, phys_addr, tx_reg);\n\n\treturn 0;\n}\n\n \nint\nath5k_hw_update_tx_triglevel(struct ath5k_hw *ah, bool increase)\n{\n\tu32 trigger_level, imr;\n\tint ret = -EIO;\n\n\t \n\timr = ath5k_hw_set_imr(ah, ah->ah_imr & ~AR5K_INT_GLOBAL);\n\n\ttrigger_level = AR5K_REG_MS(ath5k_hw_reg_read(ah, AR5K_TXCFG),\n\t\t\tAR5K_TXCFG_TXFULL);\n\n\tif (!increase) {\n\t\tif (--trigger_level < AR5K_TUNE_MIN_TX_FIFO_THRES)\n\t\t\tgoto done;\n\t} else\n\t\ttrigger_level +=\n\t\t\t((AR5K_TUNE_MAX_TX_FIFO_THRES - trigger_level) / 2);\n\n\t \n\tif (ah->ah_version == AR5K_AR5210)\n\t\tath5k_hw_reg_write(ah, trigger_level, AR5K_TRIG_LVL);\n\telse\n\t\tAR5K_REG_WRITE_BITS(ah, AR5K_TXCFG,\n\t\t\t\tAR5K_TXCFG_TXFULL, trigger_level);\n\n\tret = 0;\n\ndone:\n\t \n\tath5k_hw_set_imr(ah, imr);\n\n\treturn ret;\n}\n\n\n \n\n \nbool\nath5k_hw_is_intr_pending(struct ath5k_hw *ah)\n{\n\treturn ath5k_hw_reg_read(ah, AR5K_INTPEND) == 1 ? 1 : 0;\n}\n\n \nint\nath5k_hw_get_isr(struct ath5k_hw *ah, enum ath5k_int *interrupt_mask)\n{\n\tu32 data = 0;\n\n\t \n\tif (ah->ah_version == AR5K_AR5210) {\n\t\tu32 isr = 0;\n\t\tisr = ath5k_hw_reg_read(ah, AR5K_ISR);\n\t\tif (unlikely(isr == AR5K_INT_NOCARD)) {\n\t\t\t*interrupt_mask = isr;\n\t\t\treturn -ENODEV;\n\t\t}\n\n\t\t \n\t\t*interrupt_mask = (isr & AR5K_INT_COMMON) & ah->ah_imr;\n\n\t\t \n\t\tif (unlikely(isr & (AR5K_ISR_SSERR | AR5K_ISR_MCABT\n\t\t\t\t\t\t| AR5K_ISR_DPERR)))\n\t\t\t*interrupt_mask |= AR5K_INT_FATAL;\n\n\t\t \n\n\t\tdata = isr;\n\t} else {\n\t\tu32 pisr = 0;\n\t\tu32 pisr_clear = 0;\n\t\tu32 sisr0 = 0;\n\t\tu32 sisr1 = 0;\n\t\tu32 sisr2 = 0;\n\t\tu32 sisr3 = 0;\n\t\tu32 sisr4 = 0;\n\n\t\t \n\t\tpisr = ath5k_hw_reg_read(ah, AR5K_PISR);\n\t\tif (unlikely(pisr == AR5K_INT_NOCARD)) {\n\t\t\t*interrupt_mask = pisr;\n\t\t\treturn -ENODEV;\n\t\t}\n\n\t\tsisr0 = ath5k_hw_reg_read(ah, AR5K_SISR0);\n\t\tsisr1 = ath5k_hw_reg_read(ah, AR5K_SISR1);\n\t\tsisr2 = ath5k_hw_reg_read(ah, AR5K_SISR2);\n\t\tsisr3 = ath5k_hw_reg_read(ah, AR5K_SISR3);\n\t\tsisr4 = ath5k_hw_reg_read(ah, AR5K_SISR4);\n\n\t\t \n\n\t\t \n\t\tpisr_clear = (pisr & ~AR5K_ISR_BITS_FROM_SISRS) |\n\t\t\t\t\t(pisr & AR5K_INT_TX_ALL);\n\n\t\t \n\t\tath5k_hw_reg_write(ah, sisr0, AR5K_SISR0);\n\t\tath5k_hw_reg_write(ah, sisr1, AR5K_SISR1);\n\t\tath5k_hw_reg_write(ah, sisr2, AR5K_SISR2);\n\t\tath5k_hw_reg_write(ah, sisr3, AR5K_SISR3);\n\t\tath5k_hw_reg_write(ah, sisr4, AR5K_SISR4);\n\t\tath5k_hw_reg_write(ah, pisr_clear, AR5K_PISR);\n\t\t \n\t\tath5k_hw_reg_read(ah, AR5K_PISR);\n\n\t\t \n\t\t*interrupt_mask = (pisr & AR5K_INT_COMMON) & ah->ah_imr;\n\n\t\tah->ah_txq_isr_txok_all = 0;\n\n\t\t \n\t\tif (pisr & AR5K_ISR_TXOK)\n\t\t\tah->ah_txq_isr_txok_all |= AR5K_REG_MS(sisr0,\n\t\t\t\t\t\tAR5K_SISR0_QCU_TXOK);\n\n\t\tif (pisr & AR5K_ISR_TXDESC)\n\t\t\tah->ah_txq_isr_txok_all |= AR5K_REG_MS(sisr0,\n\t\t\t\t\t\tAR5K_SISR0_QCU_TXDESC);\n\n\t\tif (pisr & AR5K_ISR_TXERR)\n\t\t\tah->ah_txq_isr_txok_all |= AR5K_REG_MS(sisr1,\n\t\t\t\t\t\tAR5K_SISR1_QCU_TXERR);\n\n\t\tif (pisr & AR5K_ISR_TXEOL)\n\t\t\tah->ah_txq_isr_txok_all |= AR5K_REG_MS(sisr1,\n\t\t\t\t\t\tAR5K_SISR1_QCU_TXEOL);\n\n\t\t \n\n\t\t \n\t\tif (pisr & AR5K_ISR_TIM)\n\t\t\t*interrupt_mask |= AR5K_INT_TIM;\n\n\t\t \n\t\tif (pisr & AR5K_ISR_BCNMISC) {\n\t\t\tif (sisr2 & AR5K_SISR2_TIM)\n\t\t\t\t*interrupt_mask |= AR5K_INT_TIM;\n\t\t\tif (sisr2 & AR5K_SISR2_DTIM)\n\t\t\t\t*interrupt_mask |= AR5K_INT_DTIM;\n\t\t\tif (sisr2 & AR5K_SISR2_DTIM_SYNC)\n\t\t\t\t*interrupt_mask |= AR5K_INT_DTIM_SYNC;\n\t\t\tif (sisr2 & AR5K_SISR2_BCN_TIMEOUT)\n\t\t\t\t*interrupt_mask |= AR5K_INT_BCN_TIMEOUT;\n\t\t\tif (sisr2 & AR5K_SISR2_CAB_TIMEOUT)\n\t\t\t\t*interrupt_mask |= AR5K_INT_CAB_TIMEOUT;\n\t\t}\n\n\t\t \n\n\t\t \n\t\tif (unlikely(pisr & (AR5K_ISR_HIUERR)))\n\t\t\t*interrupt_mask |= AR5K_INT_FATAL;\n\n\t\t \n\t\tif (unlikely(pisr & (AR5K_ISR_BNR)))\n\t\t\t*interrupt_mask |= AR5K_INT_BNR;\n\n\t\t \n\t\tif (unlikely(pisr & (AR5K_ISR_QCBRORN)))\n\t\t\t*interrupt_mask |= AR5K_INT_QCBRORN;\n\n\t\t \n\t\tif (unlikely(pisr & (AR5K_ISR_QCBRURN)))\n\t\t\t*interrupt_mask |= AR5K_INT_QCBRURN;\n\n\t\t \n\t\tif (unlikely(pisr & (AR5K_ISR_QTRIG)))\n\t\t\t*interrupt_mask |= AR5K_INT_QTRIG;\n\n\t\tdata = pisr;\n\t}\n\n\t \n\tif (unlikely(*interrupt_mask == 0 && net_ratelimit()))\n\t\tATH5K_PRINTF(\"ISR: 0x%08x IMR: 0x%08x\\n\", data, ah->ah_imr);\n\n\treturn 0;\n}\n\n \nenum ath5k_int\nath5k_hw_set_imr(struct ath5k_hw *ah, enum ath5k_int new_mask)\n{\n\tenum ath5k_int old_mask, int_mask;\n\n\told_mask = ah->ah_imr;\n\n\t \n\tif (old_mask & AR5K_INT_GLOBAL) {\n\t\tath5k_hw_reg_write(ah, AR5K_IER_DISABLE, AR5K_IER);\n\t\tath5k_hw_reg_read(ah, AR5K_IER);\n\t}\n\n\t \n\tint_mask = new_mask & AR5K_INT_COMMON;\n\n\tif (ah->ah_version != AR5K_AR5210) {\n\t\t \n\t\tu32 simr2 = ath5k_hw_reg_read(ah, AR5K_SIMR2)\n\t\t\t\t& AR5K_SIMR2_QCU_TXURN;\n\n\t\t \n\t\tif (new_mask & AR5K_INT_FATAL) {\n\t\t\tint_mask |= AR5K_IMR_HIUERR;\n\t\t\tsimr2 |= (AR5K_SIMR2_MCABT | AR5K_SIMR2_SSERR\n\t\t\t\t| AR5K_SIMR2_DPERR);\n\t\t}\n\n\t\t \n\t\tif (new_mask & AR5K_INT_TIM)\n\t\t\tint_mask |= AR5K_IMR_TIM;\n\n\t\tif (new_mask & AR5K_INT_TIM)\n\t\t\tsimr2 |= AR5K_SISR2_TIM;\n\t\tif (new_mask & AR5K_INT_DTIM)\n\t\t\tsimr2 |= AR5K_SISR2_DTIM;\n\t\tif (new_mask & AR5K_INT_DTIM_SYNC)\n\t\t\tsimr2 |= AR5K_SISR2_DTIM_SYNC;\n\t\tif (new_mask & AR5K_INT_BCN_TIMEOUT)\n\t\t\tsimr2 |= AR5K_SISR2_BCN_TIMEOUT;\n\t\tif (new_mask & AR5K_INT_CAB_TIMEOUT)\n\t\t\tsimr2 |= AR5K_SISR2_CAB_TIMEOUT;\n\n\t\t \n\t\tif (new_mask & AR5K_INT_BNR)\n\t\t\tint_mask |= AR5K_INT_BNR;\n\n\t\t \n\t\tath5k_hw_reg_write(ah, int_mask, AR5K_PIMR);\n\t\tath5k_hw_reg_write(ah, simr2, AR5K_SIMR2);\n\n\t} else {\n\t\t \n\t\tif (new_mask & AR5K_INT_FATAL)\n\t\t\tint_mask |= (AR5K_IMR_SSERR | AR5K_IMR_MCABT\n\t\t\t\t| AR5K_IMR_HIUERR | AR5K_IMR_DPERR);\n\n\t\t \n\t\tath5k_hw_reg_write(ah, int_mask, AR5K_IMR);\n\t}\n\n\t \n\tif (!(new_mask & AR5K_INT_RXNOFRM))\n\t\tath5k_hw_reg_write(ah, 0, AR5K_RXNOFRM);\n\n\t \n\tah->ah_imr = new_mask;\n\n\t \n\tif (new_mask & AR5K_INT_GLOBAL) {\n\t\tath5k_hw_reg_write(ah, AR5K_IER_ENABLE, AR5K_IER);\n\t\tath5k_hw_reg_read(ah, AR5K_IER);\n\t}\n\n\treturn old_mask;\n}\n\n\n \n\n \nvoid\nath5k_hw_dma_init(struct ath5k_hw *ah)\n{\n\t \n\tif (ah->ah_version != AR5K_AR5210) {\n\t\tAR5K_REG_WRITE_BITS(ah, AR5K_TXCFG,\n\t\t\tAR5K_TXCFG_SDMAMR, AR5K_DMASIZE_128B);\n\t\tAR5K_REG_WRITE_BITS(ah, AR5K_RXCFG,\n\t\t\tAR5K_RXCFG_SDMAMW, AR5K_DMASIZE_128B);\n\t}\n\n\t \n\tif (ah->ah_version != AR5K_AR5210)\n\t\tath5k_hw_set_imr(ah, ah->ah_imr);\n\n}\n\n \nint\nath5k_hw_dma_stop(struct ath5k_hw *ah)\n{\n\tint i, qmax, err;\n\terr = 0;\n\n\t \n\tath5k_hw_set_imr(ah, 0);\n\n\t \n\terr = ath5k_hw_stop_rx_dma(ah);\n\tif (err)\n\t\treturn err;\n\n\t \n\tif (ah->ah_version != AR5K_AR5210) {\n\t\tath5k_hw_reg_write(ah, 0xffffffff, AR5K_PISR);\n\t\tqmax = AR5K_NUM_TX_QUEUES;\n\t} else {\n\t\t \n\t\tath5k_hw_reg_read(ah, AR5K_ISR);\n\t\tqmax = AR5K_NUM_TX_QUEUES_NOQCU;\n\t}\n\n\tfor (i = 0; i < qmax; i++) {\n\t\terr = ath5k_hw_stop_tx_dma(ah, i);\n\t\t \n\t\tif (err && err != -EINVAL)\n\t\t\treturn err;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}