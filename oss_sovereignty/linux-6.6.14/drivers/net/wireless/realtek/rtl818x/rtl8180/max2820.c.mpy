{
  "module_name": "max2820.c",
  "hash_id": "db356da6c708f398f57e415b163cb44904b0254543caaaf7c1be07ba46c9b0e4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtl818x/rtl8180/max2820.c",
  "human_readable_source": "\n \n\n#include <linux/pci.h>\n#include <linux/delay.h>\n#include <net/mac80211.h>\n\n#include \"rtl8180.h\"\n#include \"max2820.h\"\n\nstatic const u32 max2820_chan[] = {\n\t12,  \n\t17,\n\t22,\n\t27,\n\t32,\n\t37,\n\t42,\n\t47,\n\t52,\n\t57,\n\t62,\n\t67,\n\t72,\n\t84,  \n};\n\nstatic void write_max2820(struct ieee80211_hw *dev, u8 addr, u32 data)\n{\n\tstruct rtl8180_priv *priv = dev->priv;\n\tu32 phy_config;\n\n\tphy_config = 0x90 + (data & 0xf);\n\tphy_config <<= 16;\n\tphy_config += addr;\n\tphy_config <<= 8;\n\tphy_config += (data >> 4) & 0xff;\n\n\trtl818x_iowrite32(priv,\n\t\t(__le32 __iomem *) &priv->map->RFPinsOutput, phy_config);\n\n\tmsleep(1);\n}\n\nstatic void max2820_write_phy_antenna(struct ieee80211_hw *dev, short chan)\n{\n\tstruct rtl8180_priv *priv = dev->priv;\n\tu8 ant;\n\n\tant = MAXIM_ANTENNA;\n\tif (priv->rfparam & RF_PARAM_ANTBDEFAULT)\n\t\tant |= BB_ANTENNA_B;\n\tif (chan == 14)\n\t\tant |= BB_ANTATTEN_CHAN14;\n\n\trtl8180_write_phy(dev, 0x10, ant);\n}\n\nstatic u8 max2820_rf_calc_rssi(u8 agc, u8 sq)\n{\n\tbool odd;\n\n\todd = !!(agc & 1);\n\n\tagc >>= 1;\n\tif (odd)\n\t\tagc += 76;\n\telse\n\t\tagc += 66;\n\n\t \n\treturn 65 * agc / 100;\n}\n\nstatic void max2820_rf_set_channel(struct ieee80211_hw *dev,\n\t\t\t\t   struct ieee80211_conf *conf)\n{\n\tstruct rtl8180_priv *priv = dev->priv;\n\tint channel = conf ?\n\t\tieee80211_frequency_to_channel(conf->chandef.chan->center_freq) : 1;\n\tunsigned int chan_idx = channel - 1;\n\tu32 txpw = priv->channels[chan_idx].hw_value & 0xFF;\n\tu32 chan = max2820_chan[chan_idx];\n\n\t \n\trtl8180_write_phy(dev, 3, txpw);\n\n\tmax2820_write_phy_antenna(dev, channel);\n\twrite_max2820(dev, 3, chan);\n}\n\nstatic void max2820_rf_stop(struct ieee80211_hw *dev)\n{\n\trtl8180_write_phy(dev, 3, 0x8);\n\twrite_max2820(dev, 1, 0);\n}\n\n\nstatic void max2820_rf_init(struct ieee80211_hw *dev)\n{\n\tstruct rtl8180_priv *priv = dev->priv;\n\n\t \n\twrite_max2820(dev, 0, 0x007);  \n\twrite_max2820(dev, 1, 0x01e);  \n\twrite_max2820(dev, 2, 0x001);  \n\n\tmax2820_rf_set_channel(dev, NULL);\n\n\twrite_max2820(dev, 4, 0x313);  \n\n\t \n\twrite_max2820(dev, 5, 0x00f);\n\n\t \n\trtl8180_write_phy(dev, 0, 0x88);  \n\trtl8180_write_phy(dev, 3, 0x08);  \n\trtl8180_write_phy(dev, 4, 0xf8);  \n\trtl8180_write_phy(dev, 5, 0x90);  \n\trtl8180_write_phy(dev, 6, 0x1a);  \n\trtl8180_write_phy(dev, 7, 0x64);  \n\n\tmax2820_write_phy_antenna(dev, 1);\n\n\trtl8180_write_phy(dev, 0x11, 0x88);  \n\n\tif (rtl818x_ioread8(priv, &priv->map->CONFIG2) &\n\t    RTL818X_CONFIG2_ANTENNA_DIV)\n\t\trtl8180_write_phy(dev, 0x12, 0xc7);\n\telse\n\t\trtl8180_write_phy(dev, 0x12, 0x47);\n\n\trtl8180_write_phy(dev, 0x13, 0x9b);\n\n\trtl8180_write_phy(dev, 0x19, 0x0);   \n\trtl8180_write_phy(dev, 0x1a, 0x9f);  \n\n\tmax2820_rf_set_channel(dev, NULL);\n}\n\nconst struct rtl818x_rf_ops max2820_rf_ops = {\n\t.name\t\t= \"Maxim\",\n\t.init\t\t= max2820_rf_init,\n\t.stop\t\t= max2820_rf_stop,\n\t.set_chan\t= max2820_rf_set_channel,\n\t.calc_rssi\t= max2820_rf_calc_rssi,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}