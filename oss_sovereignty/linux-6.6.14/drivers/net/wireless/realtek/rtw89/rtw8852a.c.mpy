{
  "module_name": "rtw8852a.c",
  "hash_id": "cdd1ce3bafd9347daf6afd6d400385c2de46da081c7929f61006a72b9a71efd9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtw89/rtw8852a.c",
  "human_readable_source": "\n \n\n#include \"coex.h\"\n#include \"fw.h\"\n#include \"mac.h\"\n#include \"phy.h\"\n#include \"reg.h\"\n#include \"rtw8852a.h\"\n#include \"rtw8852a_rfk.h\"\n#include \"rtw8852a_table.h\"\n#include \"txrx.h\"\n\n#define RTW8852A_FW_FORMAT_MAX 0\n#define RTW8852A_FW_BASENAME \"rtw89/rtw8852a_fw\"\n#define RTW8852A_MODULE_FIRMWARE \\\n\tRTW8852A_FW_BASENAME \".bin\"\n\nstatic const struct rtw89_hfc_ch_cfg rtw8852a_hfc_chcfg_pcie[] = {\n\t{128, 1896, grp_0},  \n\t{128, 1896, grp_0},  \n\t{128, 1896, grp_0},  \n\t{128, 1896, grp_0},  \n\t{128, 1896, grp_1},  \n\t{128, 1896, grp_1},  \n\t{128, 1896, grp_1},  \n\t{128, 1896, grp_1},  \n\t{32, 1896, grp_0},  \n\t{128, 1896, grp_0},  \n\t{32, 1896, grp_1},  \n\t{128, 1896, grp_1},  \n\t{40, 0, 0}  \n};\n\nstatic const struct rtw89_hfc_pub_cfg rtw8852a_hfc_pubcfg_pcie = {\n\t1896,  \n\t1896,  \n\t3792,  \n\t0  \n};\n\nstatic const struct rtw89_hfc_param_ini rtw8852a_hfc_param_ini_pcie[] = {\n\t[RTW89_QTA_SCC] = {rtw8852a_hfc_chcfg_pcie, &rtw8852a_hfc_pubcfg_pcie,\n\t\t\t   &rtw89_mac_size.hfc_preccfg_pcie, RTW89_HCIFC_POH},\n\t[RTW89_QTA_DLFW] = {NULL, NULL, &rtw89_mac_size.hfc_preccfg_pcie,\n\t\t\t    RTW89_HCIFC_POH},\n\t[RTW89_QTA_INVALID] = {NULL},\n};\n\nstatic const struct rtw89_dle_mem rtw8852a_dle_mem_pcie[] = {\n\t[RTW89_QTA_SCC] = {RTW89_QTA_SCC, &rtw89_mac_size.wde_size0,\n\t\t\t   &rtw89_mac_size.ple_size0, &rtw89_mac_size.wde_qt0,\n\t\t\t   &rtw89_mac_size.wde_qt0, &rtw89_mac_size.ple_qt4,\n\t\t\t   &rtw89_mac_size.ple_qt5},\n\t[RTW89_QTA_WOW] = {RTW89_QTA_WOW, &rtw89_mac_size.wde_size0,\n\t\t\t   &rtw89_mac_size.ple_size0, &rtw89_mac_size.wde_qt0,\n\t\t\t   &rtw89_mac_size.wde_qt0, &rtw89_mac_size.ple_qt4,\n\t\t\t   &rtw89_mac_size.ple_qt_52a_wow},\n\t[RTW89_QTA_DLFW] = {RTW89_QTA_DLFW, &rtw89_mac_size.wde_size4,\n\t\t\t    &rtw89_mac_size.ple_size4, &rtw89_mac_size.wde_qt4,\n\t\t\t    &rtw89_mac_size.wde_qt4, &rtw89_mac_size.ple_qt13,\n\t\t\t    &rtw89_mac_size.ple_qt13},\n\t[RTW89_QTA_INVALID] = {RTW89_QTA_INVALID, NULL, NULL, NULL, NULL, NULL,\n\t\t\t       NULL},\n};\n\nstatic const struct rtw89_reg2_def  rtw8852a_pmac_ht20_mcs7_tbl[] = {\n\t{0x44AC, 0x00000000},\n\t{0x44B0, 0x00000000},\n\t{0x44B4, 0x00000000},\n\t{0x44B8, 0x00000000},\n\t{0x44BC, 0x00000000},\n\t{0x44C0, 0x00000000},\n\t{0x44C4, 0x00000000},\n\t{0x44C8, 0x00000000},\n\t{0x44CC, 0x00000000},\n\t{0x44D0, 0x00000000},\n\t{0x44D4, 0x00000000},\n\t{0x44D8, 0x00000000},\n\t{0x44DC, 0x00000000},\n\t{0x44E0, 0x00000000},\n\t{0x44E4, 0x00000000},\n\t{0x44E8, 0x00000000},\n\t{0x44EC, 0x00000000},\n\t{0x44F0, 0x00000000},\n\t{0x44F4, 0x00000000},\n\t{0x44F8, 0x00000000},\n\t{0x44FC, 0x00000000},\n\t{0x4500, 0x00000000},\n\t{0x4504, 0x00000000},\n\t{0x4508, 0x00000000},\n\t{0x450C, 0x00000000},\n\t{0x4510, 0x00000000},\n\t{0x4514, 0x00000000},\n\t{0x4518, 0x00000000},\n\t{0x451C, 0x00000000},\n\t{0x4520, 0x00000000},\n\t{0x4524, 0x00000000},\n\t{0x4528, 0x00000000},\n\t{0x452C, 0x00000000},\n\t{0x4530, 0x4E1F3E81},\n\t{0x4534, 0x00000000},\n\t{0x4538, 0x0000005A},\n\t{0x453C, 0x00000000},\n\t{0x4540, 0x00000000},\n\t{0x4544, 0x00000000},\n\t{0x4548, 0x00000000},\n\t{0x454C, 0x00000000},\n\t{0x4550, 0x00000000},\n\t{0x4554, 0x00000000},\n\t{0x4558, 0x00000000},\n\t{0x455C, 0x00000000},\n\t{0x4560, 0x4060001A},\n\t{0x4564, 0x40000000},\n\t{0x4568, 0x00000000},\n\t{0x456C, 0x00000000},\n\t{0x4570, 0x04000007},\n\t{0x4574, 0x0000DC87},\n\t{0x4578, 0x00000BAB},\n\t{0x457C, 0x03E00000},\n\t{0x4580, 0x00000048},\n\t{0x4584, 0x00000000},\n\t{0x4588, 0x000003E8},\n\t{0x458C, 0x30000000},\n\t{0x4590, 0x00000000},\n\t{0x4594, 0x10000000},\n\t{0x4598, 0x00000001},\n\t{0x459C, 0x00030000},\n\t{0x45A0, 0x01000000},\n\t{0x45A4, 0x03000200},\n\t{0x45A8, 0xC00001C0},\n\t{0x45AC, 0x78018000},\n\t{0x45B0, 0x80000000},\n\t{0x45B4, 0x01C80600},\n\t{0x45B8, 0x00000002},\n\t{0x4594, 0x10000000}\n};\n\nstatic const struct rtw89_reg3_def rtw8852a_btc_preagc_en_defs[] = {\n\t{0x4624, GENMASK(20, 14), 0x40},\n\t{0x46f8, GENMASK(20, 14), 0x40},\n\t{0x4674, GENMASK(20, 19), 0x2},\n\t{0x4748, GENMASK(20, 19), 0x2},\n\t{0x4650, GENMASK(14, 10), 0x18},\n\t{0x4724, GENMASK(14, 10), 0x18},\n\t{0x4688, GENMASK(1, 0), 0x3},\n\t{0x475c, GENMASK(1, 0), 0x3},\n};\n\nstatic DECLARE_PHY_REG3_TBL(rtw8852a_btc_preagc_en_defs);\n\nstatic const struct rtw89_reg3_def rtw8852a_btc_preagc_dis_defs[] = {\n\t{0x4624, GENMASK(20, 14), 0x1a},\n\t{0x46f8, GENMASK(20, 14), 0x1a},\n\t{0x4674, GENMASK(20, 19), 0x1},\n\t{0x4748, GENMASK(20, 19), 0x1},\n\t{0x4650, GENMASK(14, 10), 0x12},\n\t{0x4724, GENMASK(14, 10), 0x12},\n\t{0x4688, GENMASK(1, 0), 0x0},\n\t{0x475c, GENMASK(1, 0), 0x0},\n};\n\nstatic DECLARE_PHY_REG3_TBL(rtw8852a_btc_preagc_dis_defs);\n\nstatic const struct rtw89_pwr_cfg rtw8852a_pwron[] = {\n\t{0x00C6,\n\t PWR_CV_MSK_B,\n\t PWR_INTF_MSK_PCIE,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(6), BIT(6)},\n\t{0x1086,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_SDIO,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), 0},\n\t{0x1086,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_SDIO,\n\t PWR_BASE_MAC,\n\t PWR_CMD_POLL, BIT(1), BIT(1)},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(4) | BIT(3), 0},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(7), 0},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(2), 0},\n\t{0x0006,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_POLL, BIT(1), BIT(1)},\n\t{0x0006,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), BIT(0)},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), BIT(0)},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_POLL, BIT(0), 0},\n\t{0x106D,\n\t PWR_CV_MSK_B | PWR_CV_MSK_C,\n\t PWR_INTF_MSK_USB,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(6), 0},\n\t{0x0088,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), BIT(0)},\n\t{0x0088,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), 0},\n\t{0x0088,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), BIT(0)},\n\t{0x0088,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), 0},\n\t{0x0088,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), BIT(0)},\n\t{0x0083,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(6), 0},\n\t{0x0080,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(5), BIT(5)},\n\t{0x0024,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(4) | BIT(3) | BIT(2) | BIT(1) | BIT(0), 0},\n\t{0x02A0,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(1), BIT(1)},\n\t{0x02A2,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(7) | BIT(6) | BIT(5), 0},\n\t{0x0071,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_PCIE,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(4), 0},\n\t{0x0010,\n\t PWR_CV_MSK_A,\n\t PWR_INTF_MSK_PCIE,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(2), BIT(2)},\n\t{0x02A0,\n\t PWR_CV_MSK_A,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(7) | BIT(6), 0},\n\t{0xFFFF,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t 0,\n\t PWR_CMD_END, 0, 0},\n};\n\nstatic const struct rtw89_pwr_cfg rtw8852a_pwroff[] = {\n\t{0x02F0,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, 0xFF, 0},\n\t{0x02F1,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, 0xFF, 0},\n\t{0x0006,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), BIT(0)},\n\t{0x0002,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(1) | BIT(0), 0},\n\t{0x0082,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(1) | BIT(0), 0},\n\t{0x106D,\n\t PWR_CV_MSK_B | PWR_CV_MSK_C,\n\t PWR_INTF_MSK_USB,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(6), BIT(6)},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(1), BIT(1)},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t PWR_BASE_MAC,\n\t PWR_CMD_POLL, BIT(1), 0},\n\t{0x0091,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_PCIE,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), 0},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_PCIE,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(2), BIT(2)},\n\t{0x0007,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_USB,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(4), 0},\n\t{0x0007,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_SDIO,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(6) | BIT(4), 0},\n\t{0x0005,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_SDIO,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(4) | BIT(3), BIT(3)},\n\t{0x0005,\n\t PWR_CV_MSK_C | PWR_CV_MSK_D | PWR_CV_MSK_E | PWR_CV_MSK_F |\n\t PWR_CV_MSK_G,\n\t PWR_INTF_MSK_USB,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(4) | BIT(3), BIT(3)},\n\t{0x1086,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_SDIO,\n\t PWR_BASE_MAC,\n\t PWR_CMD_WRITE, BIT(0), BIT(0)},\n\t{0x1086,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_SDIO,\n\t PWR_BASE_MAC,\n\t PWR_CMD_POLL, BIT(1), 0},\n\t{0xFFFF,\n\t PWR_CV_MSK_ALL,\n\t PWR_INTF_MSK_ALL,\n\t 0,\n\t PWR_CMD_END, 0, 0},\n};\n\nstatic const struct rtw89_pwr_cfg * const pwr_on_seq_8852a[] = {\n\trtw8852a_pwron, NULL\n};\n\nstatic const struct rtw89_pwr_cfg * const pwr_off_seq_8852a[] = {\n\trtw8852a_pwroff, NULL\n};\n\nstatic const u32 rtw8852a_h2c_regs[RTW89_H2CREG_MAX] = {\n\tR_AX_H2CREG_DATA0, R_AX_H2CREG_DATA1,  R_AX_H2CREG_DATA2,\n\tR_AX_H2CREG_DATA3\n};\n\nstatic const u32 rtw8852a_c2h_regs[RTW89_C2HREG_MAX] = {\n\tR_AX_C2HREG_DATA0, R_AX_C2HREG_DATA1, R_AX_C2HREG_DATA2,\n\tR_AX_C2HREG_DATA3\n};\n\nstatic const struct rtw89_page_regs rtw8852a_page_regs = {\n\t.hci_fc_ctrl\t= R_AX_HCI_FC_CTRL,\n\t.ch_page_ctrl\t= R_AX_CH_PAGE_CTRL,\n\t.ach_page_ctrl\t= R_AX_ACH0_PAGE_CTRL,\n\t.ach_page_info\t= R_AX_ACH0_PAGE_INFO,\n\t.pub_page_info3\t= R_AX_PUB_PAGE_INFO3,\n\t.pub_page_ctrl1\t= R_AX_PUB_PAGE_CTRL1,\n\t.pub_page_ctrl2\t= R_AX_PUB_PAGE_CTRL2,\n\t.pub_page_info1\t= R_AX_PUB_PAGE_INFO1,\n\t.pub_page_info2 = R_AX_PUB_PAGE_INFO2,\n\t.wp_page_ctrl1\t= R_AX_WP_PAGE_CTRL1,\n\t.wp_page_ctrl2\t= R_AX_WP_PAGE_CTRL2,\n\t.wp_page_info1\t= R_AX_WP_PAGE_INFO1,\n};\n\nstatic const struct rtw89_reg_def rtw8852a_dcfo_comp = {\n\tR_DCFO_COMP_S0, B_DCFO_COMP_S0_MSK\n};\n\nstatic const struct rtw89_imr_info rtw8852a_imr_info = {\n\t.wdrls_imr_set\t\t= B_AX_WDRLS_IMR_SET,\n\t.wsec_imr_reg\t\t= R_AX_SEC_DEBUG,\n\t.wsec_imr_set\t\t= B_AX_IMR_ERROR,\n\t.mpdu_tx_imr_set\t= 0,\n\t.mpdu_rx_imr_set\t= 0,\n\t.sta_sch_imr_set\t= B_AX_STA_SCHEDULER_IMR_SET,\n\t.txpktctl_imr_b0_reg\t= R_AX_TXPKTCTL_ERR_IMR_ISR,\n\t.txpktctl_imr_b0_clr\t= B_AX_TXPKTCTL_IMR_B0_CLR,\n\t.txpktctl_imr_b0_set\t= B_AX_TXPKTCTL_IMR_B0_SET,\n\t.txpktctl_imr_b1_reg\t= R_AX_TXPKTCTL_ERR_IMR_ISR_B1,\n\t.txpktctl_imr_b1_clr\t= B_AX_TXPKTCTL_IMR_B1_CLR,\n\t.txpktctl_imr_b1_set\t= B_AX_TXPKTCTL_IMR_B1_SET,\n\t.wde_imr_clr\t\t= B_AX_WDE_IMR_CLR,\n\t.wde_imr_set\t\t= B_AX_WDE_IMR_SET,\n\t.ple_imr_clr\t\t= B_AX_PLE_IMR_CLR,\n\t.ple_imr_set\t\t= B_AX_PLE_IMR_SET,\n\t.host_disp_imr_clr\t= B_AX_HOST_DISP_IMR_CLR,\n\t.host_disp_imr_set\t= B_AX_HOST_DISP_IMR_SET,\n\t.cpu_disp_imr_clr\t= B_AX_CPU_DISP_IMR_CLR,\n\t.cpu_disp_imr_set\t= B_AX_CPU_DISP_IMR_SET,\n\t.other_disp_imr_clr\t= B_AX_OTHER_DISP_IMR_CLR,\n\t.other_disp_imr_set\t= 0,\n\t.bbrpt_com_err_imr_reg\t= R_AX_BBRPT_COM_ERR_IMR_ISR,\n\t.bbrpt_chinfo_err_imr_reg = R_AX_BBRPT_CHINFO_ERR_IMR_ISR,\n\t.bbrpt_err_imr_set\t= 0,\n\t.bbrpt_dfs_err_imr_reg\t= R_AX_BBRPT_DFS_ERR_IMR_ISR,\n\t.ptcl_imr_clr\t\t= B_AX_PTCL_IMR_CLR,\n\t.ptcl_imr_set\t\t= B_AX_PTCL_IMR_SET,\n\t.cdma_imr_0_reg\t\t= R_AX_DLE_CTRL,\n\t.cdma_imr_0_clr\t\t= B_AX_DLE_IMR_CLR,\n\t.cdma_imr_0_set\t\t= B_AX_DLE_IMR_SET,\n\t.cdma_imr_1_reg\t\t= 0,\n\t.cdma_imr_1_clr\t\t= 0,\n\t.cdma_imr_1_set\t\t= 0,\n\t.phy_intf_imr_reg\t= R_AX_PHYINFO_ERR_IMR,\n\t.phy_intf_imr_clr\t= 0,\n\t.phy_intf_imr_set\t= 0,\n\t.rmac_imr_reg\t\t= R_AX_RMAC_ERR_ISR,\n\t.rmac_imr_clr\t\t= B_AX_RMAC_IMR_CLR,\n\t.rmac_imr_set\t\t= B_AX_RMAC_IMR_SET,\n\t.tmac_imr_reg\t\t= R_AX_TMAC_ERR_IMR_ISR,\n\t.tmac_imr_clr\t\t= B_AX_TMAC_IMR_CLR,\n\t.tmac_imr_set\t\t= B_AX_TMAC_IMR_SET,\n};\n\nstatic const struct rtw89_xtal_info rtw8852a_xtal_info = {\n\t.xcap_reg\t\t= R_AX_XTAL_ON_CTRL0,\n\t.sc_xo_mask\t\t= B_AX_XTAL_SC_XO_MASK,\n\t.sc_xi_mask\t\t= B_AX_XTAL_SC_XI_MASK,\n};\n\nstatic const struct rtw89_rrsr_cfgs rtw8852a_rrsr_cfgs = {\n\t.ref_rate = {R_AX_TRXPTCL_RRSR_CTL_0, B_AX_WMAC_RESP_REF_RATE_SEL, 0},\n\t.rsc = {R_AX_TRXPTCL_RRSR_CTL_0, B_AX_WMAC_RESP_RSC_MASK, 2},\n};\n\nstatic const struct rtw89_dig_regs rtw8852a_dig_regs = {\n\t.seg0_pd_reg = R_SEG0R_PD,\n\t.pd_lower_bound_mask = B_SEG0R_PD_LOWER_BOUND_MSK,\n\t.pd_spatial_reuse_en = B_SEG0R_PD_SPATIAL_REUSE_EN_MSK,\n\t.bmode_pd_reg = R_BMODE_PDTH_EN_V1,\n\t.bmode_cca_rssi_limit_en = B_BMODE_PDTH_LIMIT_EN_MSK_V1,\n\t.bmode_pd_lower_bound_reg = R_BMODE_PDTH_V1,\n\t.bmode_rssi_nocca_low_th_mask = B_BMODE_PDTH_LOWER_BOUND_MSK_V1,\n\t.p0_lna_init = {R_PATH0_LNA_INIT, B_PATH0_LNA_INIT_IDX_MSK},\n\t.p1_lna_init = {R_PATH1_LNA_INIT, B_PATH1_LNA_INIT_IDX_MSK},\n\t.p0_tia_init = {R_PATH0_TIA_INIT, B_PATH0_TIA_INIT_IDX_MSK},\n\t.p1_tia_init = {R_PATH1_TIA_INIT, B_PATH1_TIA_INIT_IDX_MSK},\n\t.p0_rxb_init = {R_PATH0_RXB_INIT, B_PATH0_RXB_INIT_IDX_MSK},\n\t.p1_rxb_init = {R_PATH1_RXB_INIT, B_PATH1_RXB_INIT_IDX_MSK},\n\t.p0_p20_pagcugc_en = {R_PATH0_P20_FOLLOW_BY_PAGCUGC,\n\t\t\t      B_PATH0_P20_FOLLOW_BY_PAGCUGC_EN_MSK},\n\t.p0_s20_pagcugc_en = {R_PATH0_S20_FOLLOW_BY_PAGCUGC,\n\t\t\t      B_PATH0_S20_FOLLOW_BY_PAGCUGC_EN_MSK},\n\t.p1_p20_pagcugc_en = {R_PATH1_P20_FOLLOW_BY_PAGCUGC,\n\t\t\t      B_PATH1_P20_FOLLOW_BY_PAGCUGC_EN_MSK},\n\t.p1_s20_pagcugc_en = {R_PATH1_S20_FOLLOW_BY_PAGCUGC,\n\t\t\t      B_PATH1_S20_FOLLOW_BY_PAGCUGC_EN_MSK},\n};\n\nstatic void rtw8852ae_efuse_parsing(struct rtw89_efuse *efuse,\n\t\t\t\t    struct rtw8852a_efuse *map)\n{\n\tether_addr_copy(efuse->addr, map->e.mac_addr);\n\tefuse->rfe_type = map->rfe_type;\n\tefuse->xtal_cap = map->xtal_k;\n}\n\nstatic void rtw8852a_efuse_parsing_tssi(struct rtw89_dev *rtwdev,\n\t\t\t\t\tstruct rtw8852a_efuse *map)\n{\n\tstruct rtw89_tssi_info *tssi = &rtwdev->tssi;\n\tstruct rtw8852a_tssi_offset *ofst[] = {&map->path_a_tssi, &map->path_b_tssi};\n\tu8 i, j;\n\n\ttssi->thermal[RF_PATH_A] = map->path_a_therm;\n\ttssi->thermal[RF_PATH_B] = map->path_b_therm;\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++) {\n\t\tmemcpy(tssi->tssi_cck[i], ofst[i]->cck_tssi,\n\t\t       sizeof(ofst[i]->cck_tssi));\n\n\t\tfor (j = 0; j < TSSI_CCK_CH_GROUP_NUM; j++)\n\t\t\trtw89_debug(rtwdev, RTW89_DBG_TSSI,\n\t\t\t\t    \"[TSSI][EFUSE] path=%d cck[%d]=0x%x\\n\",\n\t\t\t\t    i, j, tssi->tssi_cck[i][j]);\n\n\t\tmemcpy(tssi->tssi_mcs[i], ofst[i]->bw40_tssi,\n\t\t       sizeof(ofst[i]->bw40_tssi));\n\t\tmemcpy(tssi->tssi_mcs[i] + TSSI_MCS_2G_CH_GROUP_NUM,\n\t\t       ofst[i]->bw40_1s_tssi_5g, sizeof(ofst[i]->bw40_1s_tssi_5g));\n\n\t\tfor (j = 0; j < TSSI_MCS_CH_GROUP_NUM; j++)\n\t\t\trtw89_debug(rtwdev, RTW89_DBG_TSSI,\n\t\t\t\t    \"[TSSI][EFUSE] path=%d mcs[%d]=0x%x\\n\",\n\t\t\t\t    i, j, tssi->tssi_mcs[i][j]);\n\t}\n}\n\nstatic int rtw8852a_read_efuse(struct rtw89_dev *rtwdev, u8 *log_map)\n{\n\tstruct rtw89_efuse *efuse = &rtwdev->efuse;\n\tstruct rtw8852a_efuse *map;\n\n\tmap = (struct rtw8852a_efuse *)log_map;\n\n\tefuse->country_code[0] = map->country_code[0];\n\tefuse->country_code[1] = map->country_code[1];\n\trtw8852a_efuse_parsing_tssi(rtwdev, map);\n\n\tswitch (rtwdev->hci.type) {\n\tcase RTW89_HCI_TYPE_PCIE:\n\t\trtw8852ae_efuse_parsing(efuse, map);\n\t\tbreak;\n\tdefault:\n\t\treturn -ENOTSUPP;\n\t}\n\n\trtw89_info(rtwdev, \"chip rfe_type is %d\\n\", efuse->rfe_type);\n\n\treturn 0;\n}\n\nstatic void rtw8852a_phycap_parsing_tssi(struct rtw89_dev *rtwdev, u8 *phycap_map)\n{\n\tstruct rtw89_tssi_info *tssi = &rtwdev->tssi;\n\tstatic const u32 tssi_trim_addr[RF_PATH_NUM_8852A] = {0x5D6, 0x5AB};\n\tu32 addr = rtwdev->chip->phycap_addr;\n\tbool pg = false;\n\tu32 ofst;\n\tu8 i, j;\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++) {\n\t\tfor (j = 0; j < TSSI_TRIM_CH_GROUP_NUM; j++) {\n\t\t\t \n\t\t\tofst = tssi_trim_addr[i] - addr - j;\n\t\t\ttssi->tssi_trim[i][j] = phycap_map[ofst];\n\n\t\t\tif (phycap_map[ofst] != 0xff)\n\t\t\t\tpg = true;\n\t\t}\n\t}\n\n\tif (!pg) {\n\t\tmemset(tssi->tssi_trim, 0, sizeof(tssi->tssi_trim));\n\t\trtw89_debug(rtwdev, RTW89_DBG_TSSI,\n\t\t\t    \"[TSSI][TRIM] no PG, set all trim info to 0\\n\");\n\t}\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++)\n\t\tfor (j = 0; j < TSSI_TRIM_CH_GROUP_NUM; j++)\n\t\t\trtw89_debug(rtwdev, RTW89_DBG_TSSI,\n\t\t\t\t    \"[TSSI] path=%d idx=%d trim=0x%x addr=0x%x\\n\",\n\t\t\t\t    i, j, tssi->tssi_trim[i][j],\n\t\t\t\t    tssi_trim_addr[i] - j);\n}\n\nstatic void rtw8852a_phycap_parsing_thermal_trim(struct rtw89_dev *rtwdev,\n\t\t\t\t\t\t u8 *phycap_map)\n{\n\tstruct rtw89_power_trim_info *info = &rtwdev->pwr_trim;\n\tstatic const u32 thm_trim_addr[RF_PATH_NUM_8852A] = {0x5DF, 0x5DC};\n\tu32 addr = rtwdev->chip->phycap_addr;\n\tu8 i;\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++) {\n\t\tinfo->thermal_trim[i] = phycap_map[thm_trim_addr[i] - addr];\n\n\t\trtw89_debug(rtwdev, RTW89_DBG_RFK,\n\t\t\t    \"[THERMAL][TRIM] path=%d thermal_trim=0x%x\\n\",\n\t\t\t    i, info->thermal_trim[i]);\n\n\t\tif (info->thermal_trim[i] != 0xff)\n\t\t\tinfo->pg_thermal_trim = true;\n\t}\n}\n\nstatic void rtw8852a_thermal_trim(struct rtw89_dev *rtwdev)\n{\n#define __thm_setting(raw)\t\t\t\t\\\n({\t\t\t\t\t\t\t\\\n\tu8 __v = (raw);\t\t\t\t\t\\\n\t((__v & 0x1) << 3) | ((__v & 0x1f) >> 1);\t\\\n})\n\tstruct rtw89_power_trim_info *info = &rtwdev->pwr_trim;\n\tu8 i, val;\n\n\tif (!info->pg_thermal_trim) {\n\t\trtw89_debug(rtwdev, RTW89_DBG_RFK,\n\t\t\t    \"[THERMAL][TRIM] no PG, do nothing\\n\");\n\n\t\treturn;\n\t}\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++) {\n\t\tval = __thm_setting(info->thermal_trim[i]);\n\t\trtw89_write_rf(rtwdev, i, RR_TM2, RR_TM2_OFF, val);\n\n\t\trtw89_debug(rtwdev, RTW89_DBG_RFK,\n\t\t\t    \"[THERMAL][TRIM] path=%d thermal_setting=0x%x\\n\",\n\t\t\t    i, val);\n\t}\n#undef __thm_setting\n}\n\nstatic void rtw8852a_phycap_parsing_pa_bias_trim(struct rtw89_dev *rtwdev,\n\t\t\t\t\t\t u8 *phycap_map)\n{\n\tstruct rtw89_power_trim_info *info = &rtwdev->pwr_trim;\n\tstatic const u32 pabias_trim_addr[RF_PATH_NUM_8852A] = {0x5DE, 0x5DB};\n\tu32 addr = rtwdev->chip->phycap_addr;\n\tu8 i;\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++) {\n\t\tinfo->pa_bias_trim[i] = phycap_map[pabias_trim_addr[i] - addr];\n\n\t\trtw89_debug(rtwdev, RTW89_DBG_RFK,\n\t\t\t    \"[PA_BIAS][TRIM] path=%d pa_bias_trim=0x%x\\n\",\n\t\t\t    i, info->pa_bias_trim[i]);\n\n\t\tif (info->pa_bias_trim[i] != 0xff)\n\t\t\tinfo->pg_pa_bias_trim = true;\n\t}\n}\n\nstatic void rtw8852a_pa_bias_trim(struct rtw89_dev *rtwdev)\n{\n\tstruct rtw89_power_trim_info *info = &rtwdev->pwr_trim;\n\tu8 pabias_2g, pabias_5g;\n\tu8 i;\n\n\tif (!info->pg_pa_bias_trim) {\n\t\trtw89_debug(rtwdev, RTW89_DBG_RFK,\n\t\t\t    \"[PA_BIAS][TRIM] no PG, do nothing\\n\");\n\n\t\treturn;\n\t}\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++) {\n\t\tpabias_2g = FIELD_GET(GENMASK(3, 0), info->pa_bias_trim[i]);\n\t\tpabias_5g = FIELD_GET(GENMASK(7, 4), info->pa_bias_trim[i]);\n\n\t\trtw89_debug(rtwdev, RTW89_DBG_RFK,\n\t\t\t    \"[PA_BIAS][TRIM] path=%d 2G=0x%x 5G=0x%x\\n\",\n\t\t\t    i, pabias_2g, pabias_5g);\n\n\t\trtw89_write_rf(rtwdev, i, RR_BIASA, RR_BIASA_TXG, pabias_2g);\n\t\trtw89_write_rf(rtwdev, i, RR_BIASA, RR_BIASA_TXA, pabias_5g);\n\t}\n}\n\nstatic int rtw8852a_read_phycap(struct rtw89_dev *rtwdev, u8 *phycap_map)\n{\n\trtw8852a_phycap_parsing_tssi(rtwdev, phycap_map);\n\trtw8852a_phycap_parsing_thermal_trim(rtwdev, phycap_map);\n\trtw8852a_phycap_parsing_pa_bias_trim(rtwdev, phycap_map);\n\n\treturn 0;\n}\n\nstatic void rtw8852a_power_trim(struct rtw89_dev *rtwdev)\n{\n\trtw8852a_thermal_trim(rtwdev);\n\trtw8852a_pa_bias_trim(rtwdev);\n}\n\nstatic void rtw8852a_set_channel_mac(struct rtw89_dev *rtwdev,\n\t\t\t\t     const struct rtw89_chan *chan,\n\t\t\t\t     u8 mac_idx)\n{\n\tu32 rf_mod = rtw89_mac_reg_by_idx(rtwdev, R_AX_WMAC_RFMOD, mac_idx);\n\tu32 sub_carr = rtw89_mac_reg_by_idx(rtwdev, R_AX_TX_SUB_CARRIER_VALUE, mac_idx);\n\tu32 chk_rate = rtw89_mac_reg_by_idx(rtwdev, R_AX_TXRATE_CHK, mac_idx);\n\tu8 txsc20 = 0, txsc40 = 0;\n\n\tswitch (chan->band_width) {\n\tcase RTW89_CHANNEL_WIDTH_80:\n\t\ttxsc40 = rtw89_phy_get_txsc(rtwdev, chan,\n\t\t\t\t\t    RTW89_CHANNEL_WIDTH_40);\n\t\tfallthrough;\n\tcase RTW89_CHANNEL_WIDTH_40:\n\t\ttxsc20 = rtw89_phy_get_txsc(rtwdev, chan,\n\t\t\t\t\t    RTW89_CHANNEL_WIDTH_20);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\tswitch (chan->band_width) {\n\tcase RTW89_CHANNEL_WIDTH_80:\n\t\trtw89_write8_mask(rtwdev, rf_mod, B_AX_WMAC_RFMOD_MASK, BIT(1));\n\t\trtw89_write32(rtwdev, sub_carr, txsc20 | (txsc40 << 4));\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_40:\n\t\trtw89_write8_mask(rtwdev, rf_mod, B_AX_WMAC_RFMOD_MASK, BIT(0));\n\t\trtw89_write32(rtwdev, sub_carr, txsc20);\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_20:\n\t\trtw89_write8_clr(rtwdev, rf_mod, B_AX_WMAC_RFMOD_MASK);\n\t\trtw89_write32(rtwdev, sub_carr, 0);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\tif (chan->channel > 14)\n\t\trtw89_write8_set(rtwdev, chk_rate,\n\t\t\t\t B_AX_CHECK_CCK_EN | B_AX_RTS_LIMIT_IN_OFDM6);\n\telse\n\t\trtw89_write8_clr(rtwdev, chk_rate,\n\t\t\t\t B_AX_CHECK_CCK_EN | B_AX_RTS_LIMIT_IN_OFDM6);\n}\n\nstatic const u32 rtw8852a_sco_barker_threshold[14] = {\n\t0x1cfea, 0x1d0e1, 0x1d1d7, 0x1d2cd, 0x1d3c3, 0x1d4b9, 0x1d5b0, 0x1d6a6,\n\t0x1d79c, 0x1d892, 0x1d988, 0x1da7f, 0x1db75, 0x1ddc4\n};\n\nstatic const u32 rtw8852a_sco_cck_threshold[14] = {\n\t0x27de3, 0x27f35, 0x28088, 0x281da, 0x2832d, 0x2847f, 0x285d2, 0x28724,\n\t0x28877, 0x289c9, 0x28b1c, 0x28c6e, 0x28dc1, 0x290ed\n};\n\nstatic int rtw8852a_ctrl_sco_cck(struct rtw89_dev *rtwdev, u8 central_ch,\n\t\t\t\t u8 primary_ch, enum rtw89_bandwidth bw)\n{\n\tu8 ch_element;\n\n\tif (bw == RTW89_CHANNEL_WIDTH_20) {\n\t\tch_element = central_ch - 1;\n\t} else if (bw == RTW89_CHANNEL_WIDTH_40) {\n\t\tif (primary_ch == 1)\n\t\t\tch_element = central_ch - 1 + 2;\n\t\telse\n\t\t\tch_element = central_ch - 1 - 2;\n\t} else {\n\t\trtw89_warn(rtwdev, \"Invalid BW:%d for CCK\\n\", bw);\n\t\treturn -EINVAL;\n\t}\n\trtw89_phy_write32_mask(rtwdev, R_RXSCOBC, B_RXSCOBC_TH,\n\t\t\t       rtw8852a_sco_barker_threshold[ch_element]);\n\trtw89_phy_write32_mask(rtwdev, R_RXSCOCCK, B_RXSCOCCK_TH,\n\t\t\t       rtw8852a_sco_cck_threshold[ch_element]);\n\n\treturn 0;\n}\n\nstatic void rtw8852a_ch_setting(struct rtw89_dev *rtwdev, u8 central_ch,\n\t\t\t\tu8 path)\n{\n\tu32 val;\n\n\tval = rtw89_read_rf(rtwdev, path, RR_CFGCH, RFREG_MASK);\n\tif (val == INV_RF_DATA) {\n\t\trtw89_warn(rtwdev, \"Invalid RF_0x18 for Path-%d\\n\", path);\n\t\treturn;\n\t}\n\tval &= ~0x303ff;\n\tval |= central_ch;\n\tif (central_ch > 14)\n\t\tval |= (BIT(16) | BIT(8));\n\trtw89_write_rf(rtwdev, path, RR_CFGCH, RFREG_MASK, val);\n}\n\nstatic u8 rtw8852a_sco_mapping(u8 central_ch)\n{\n\tif (central_ch == 1)\n\t\treturn 109;\n\telse if (central_ch >= 2 && central_ch <= 6)\n\t\treturn 108;\n\telse if (central_ch >= 7 && central_ch <= 10)\n\t\treturn 107;\n\telse if (central_ch >= 11 && central_ch <= 14)\n\t\treturn 106;\n\telse if (central_ch == 36 || central_ch == 38)\n\t\treturn 51;\n\telse if (central_ch >= 40 && central_ch <= 58)\n\t\treturn 50;\n\telse if (central_ch >= 60 && central_ch <= 64)\n\t\treturn 49;\n\telse if (central_ch == 100 || central_ch == 102)\n\t\treturn 48;\n\telse if (central_ch >= 104 && central_ch <= 126)\n\t\treturn 47;\n\telse if (central_ch >= 128 && central_ch <= 151)\n\t\treturn 46;\n\telse if (central_ch >= 153 && central_ch <= 177)\n\t\treturn 45;\n\telse\n\t\treturn 0;\n}\n\nstatic void rtw8852a_ctrl_ch(struct rtw89_dev *rtwdev, u8 central_ch,\n\t\t\t     enum rtw89_phy_idx phy_idx)\n{\n\tu8 sco_comp;\n\tbool is_2g = central_ch <= 14;\n\n\tif (phy_idx == RTW89_PHY_0) {\n\t\t \n\t\trtw8852a_ch_setting(rtwdev, central_ch, RF_PATH_A);\n\t\tif (is_2g)\n\t\t\trtw89_phy_write32_idx(rtwdev, R_PATH0_TIA_ERR_G1,\n\t\t\t\t\t      B_PATH0_TIA_ERR_G1_SEL, 1,\n\t\t\t\t\t      phy_idx);\n\t\telse\n\t\t\trtw89_phy_write32_idx(rtwdev, R_PATH0_TIA_ERR_G1,\n\t\t\t\t\t      B_PATH0_TIA_ERR_G1_SEL, 0,\n\t\t\t\t\t      phy_idx);\n\n\t\t \n\t\tif (!rtwdev->dbcc_en) {\n\t\t\trtw8852a_ch_setting(rtwdev, central_ch, RF_PATH_B);\n\t\t\tif (is_2g)\n\t\t\t\trtw89_phy_write32_idx(rtwdev, R_P1_MODE,\n\t\t\t\t\t\t      B_P1_MODE_SEL,\n\t\t\t\t\t\t      1, phy_idx);\n\t\t\telse\n\t\t\t\trtw89_phy_write32_idx(rtwdev, R_P1_MODE,\n\t\t\t\t\t\t      B_P1_MODE_SEL,\n\t\t\t\t\t\t      0, phy_idx);\n\t\t} else {\n\t\t\tif (is_2g)\n\t\t\t\trtw89_phy_write32_clr(rtwdev, R_2P4G_BAND,\n\t\t\t\t\t\t      B_2P4G_BAND_SEL);\n\t\t\telse\n\t\t\t\trtw89_phy_write32_set(rtwdev, R_2P4G_BAND,\n\t\t\t\t\t\t      B_2P4G_BAND_SEL);\n\t\t}\n\t\t \n\t\tsco_comp = rtw8852a_sco_mapping(central_ch);\n\t\trtw89_phy_write32_idx(rtwdev, R_FC0_BW, B_FC0_BW_INV,\n\t\t\t\t      sco_comp, phy_idx);\n\t} else {\n\t\t \n\t\trtw8852a_ch_setting(rtwdev, central_ch, RF_PATH_B);\n\t\tif (is_2g)\n\t\t\trtw89_phy_write32_idx(rtwdev, R_P1_MODE,\n\t\t\t\t\t      B_P1_MODE_SEL,\n\t\t\t\t\t      1, phy_idx);\n\t\telse\n\t\t\trtw89_phy_write32_idx(rtwdev, R_P1_MODE,\n\t\t\t\t\t      B_P1_MODE_SEL,\n\t\t\t\t\t      0, phy_idx);\n\t\t \n\t\tsco_comp = rtw8852a_sco_mapping(central_ch);\n\t\trtw89_phy_write32_idx(rtwdev, R_FC0_BW, B_FC0_BW_INV,\n\t\t\t\t      sco_comp, phy_idx);\n\t}\n\n\t \n\tif (is_2g)\n\t\trtw89_phy_write32_idx(rtwdev, R_BANDEDGE, B_BANDEDGE_EN, 1,\n\t\t\t\t      phy_idx);\n\telse\n\t\trtw89_phy_write32_idx(rtwdev, R_BANDEDGE, B_BANDEDGE_EN, 0,\n\t\t\t\t      phy_idx);\n\n\t \n\tif (central_ch == 14) {\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR0, B_TXFIR_C01,\n\t\t\t\t       0x3b13ff);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR2, B_TXFIR_C23,\n\t\t\t\t       0x1c42de);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR4, B_TXFIR_C45,\n\t\t\t\t       0xfdb0ad);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR6, B_TXFIR_C67,\n\t\t\t\t       0xf60f6e);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR8, B_TXFIR_C89,\n\t\t\t\t       0xfd8f92);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIRA, B_TXFIR_CAB, 0x2d011);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIRC, B_TXFIR_CCD, 0x1c02c);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIRE, B_TXFIR_CEF,\n\t\t\t\t       0xfff00a);\n\t} else {\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR0, B_TXFIR_C01,\n\t\t\t\t       0x3d23ff);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR2, B_TXFIR_C23,\n\t\t\t\t       0x29b354);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR4, B_TXFIR_C45, 0xfc1c8);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR6, B_TXFIR_C67,\n\t\t\t\t       0xfdb053);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIR8, B_TXFIR_C89,\n\t\t\t\t       0xf86f9a);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIRA, B_TXFIR_CAB,\n\t\t\t\t       0xfaef92);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIRC, B_TXFIR_CCD,\n\t\t\t\t       0xfe5fcc);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXFIRE, B_TXFIR_CEF,\n\t\t\t\t       0xffdff5);\n\t}\n}\n\nstatic void rtw8852a_bw_setting(struct rtw89_dev *rtwdev, u8 bw, u8 path)\n{\n\tu32 val = 0;\n\tu32 adc_sel[2] = {0x12d0, 0x32d0};\n\tu32 wbadc_sel[2] = {0x12ec, 0x32ec};\n\n\tval = rtw89_read_rf(rtwdev, path, RR_CFGCH, RFREG_MASK);\n\tif (val == INV_RF_DATA) {\n\t\trtw89_warn(rtwdev, \"Invalid RF_0x18 for Path-%d\\n\", path);\n\t\treturn;\n\t}\n\tval &= ~(BIT(11) | BIT(10));\n\tswitch (bw) {\n\tcase RTW89_CHANNEL_WIDTH_5:\n\t\trtw89_phy_write32_mask(rtwdev, adc_sel[path], 0x6000, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, wbadc_sel[path], 0x30, 0x0);\n\t\tval |= (BIT(11) | BIT(10));\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_10:\n\t\trtw89_phy_write32_mask(rtwdev, adc_sel[path], 0x6000, 0x2);\n\t\trtw89_phy_write32_mask(rtwdev, wbadc_sel[path], 0x30, 0x1);\n\t\tval |= (BIT(11) | BIT(10));\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_20:\n\t\trtw89_phy_write32_mask(rtwdev, adc_sel[path], 0x6000, 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, wbadc_sel[path], 0x30, 0x2);\n\t\tval |= (BIT(11) | BIT(10));\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_40:\n\t\trtw89_phy_write32_mask(rtwdev, adc_sel[path], 0x6000, 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, wbadc_sel[path], 0x30, 0x2);\n\t\tval |= BIT(11);\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_80:\n\t\trtw89_phy_write32_mask(rtwdev, adc_sel[path], 0x6000, 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, wbadc_sel[path], 0x30, 0x2);\n\t\tval |= BIT(10);\n\t\tbreak;\n\tdefault:\n\t\trtw89_warn(rtwdev, \"Fail to set ADC\\n\");\n\t}\n\n\trtw89_write_rf(rtwdev, path, RR_CFGCH, RFREG_MASK, val);\n}\n\nstatic void\nrtw8852a_ctrl_bw(struct rtw89_dev *rtwdev, u8 pri_ch, u8 bw,\n\t\t enum rtw89_phy_idx phy_idx)\n{\n\t \n\tswitch (bw) {\n\tcase RTW89_CHANNEL_WIDTH_5:\n\t\trtw89_phy_write32_idx(rtwdev, R_FC0_BW, B_FC0_BW_SET, 0x0,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_SBW, 0x1,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_PRICH,\n\t\t\t\t      0x0, phy_idx);\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_10:\n\t\trtw89_phy_write32_idx(rtwdev, R_FC0_BW, B_FC0_BW_SET, 0x0,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_SBW, 0x2,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_PRICH,\n\t\t\t\t      0x0, phy_idx);\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_20:\n\t\trtw89_phy_write32_idx(rtwdev, R_FC0_BW, B_FC0_BW_SET, 0x0,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_SBW, 0x0,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_PRICH,\n\t\t\t\t      0x0, phy_idx);\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_40:\n\t\trtw89_phy_write32_idx(rtwdev, R_FC0_BW, B_FC0_BW_SET, 0x1,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_SBW, 0x0,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_PRICH,\n\t\t\t\t      pri_ch,\n\t\t\t\t      phy_idx);\n\t\tif (pri_ch == RTW89_SC_20_UPPER)\n\t\t\trtw89_phy_write32_mask(rtwdev, R_RXSC, B_RXSC_EN, 1);\n\t\telse\n\t\t\trtw89_phy_write32_mask(rtwdev, R_RXSC, B_RXSC_EN, 0);\n\t\tbreak;\n\tcase RTW89_CHANNEL_WIDTH_80:\n\t\trtw89_phy_write32_idx(rtwdev, R_FC0_BW, B_FC0_BW_SET, 0x2,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_SBW, 0x0,\n\t\t\t\t      phy_idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_CHBW_MOD, B_CHBW_MOD_PRICH,\n\t\t\t\t      pri_ch,\n\t\t\t\t      phy_idx);\n\t\tbreak;\n\tdefault:\n\t\trtw89_warn(rtwdev, \"Fail to switch bw (bw:%d, pri ch:%d)\\n\", bw,\n\t\t\t   pri_ch);\n\t}\n\n\tif (phy_idx == RTW89_PHY_0) {\n\t\trtw8852a_bw_setting(rtwdev, bw, RF_PATH_A);\n\t\tif (!rtwdev->dbcc_en)\n\t\t\trtw8852a_bw_setting(rtwdev, bw, RF_PATH_B);\n\t} else {\n\t\trtw8852a_bw_setting(rtwdev, bw, RF_PATH_B);\n\t}\n}\n\nstatic void rtw8852a_spur_elimination(struct rtw89_dev *rtwdev, u8 central_ch)\n{\n\tif (central_ch == 153) {\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_NBIIDX, B_P0_NBIIDX_VAL,\n\t\t\t\t       0x210);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_NBIIDX, B_P1_NBIIDX_VAL,\n\t\t\t\t       0x210);\n\t\trtw89_phy_write32_mask(rtwdev, R_SEG0CSI, B_SEG0CSI_IDX, 0x7c0);\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_NBIIDX,\n\t\t\t\t       B_P0_NBIIDX_NOTCH_EN, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_NBIIDX,\n\t\t\t\t       B_P1_NBIIDX_NOTCH_EN, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, R_SEG0CSI_EN, B_SEG0CSI_EN,\n\t\t\t\t       0x1);\n\t} else if (central_ch == 151) {\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_NBIIDX, B_P0_NBIIDX_VAL,\n\t\t\t\t       0x210);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_NBIIDX, B_P1_NBIIDX_VAL,\n\t\t\t\t       0x210);\n\t\trtw89_phy_write32_mask(rtwdev, R_SEG0CSI, B_SEG0CSI_IDX, 0x40);\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_NBIIDX,\n\t\t\t\t       B_P0_NBIIDX_NOTCH_EN, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_NBIIDX,\n\t\t\t\t       B_P1_NBIIDX_NOTCH_EN, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, R_SEG0CSI_EN, B_SEG0CSI_EN,\n\t\t\t\t       0x1);\n\t} else if (central_ch == 155) {\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_NBIIDX, B_P0_NBIIDX_VAL,\n\t\t\t\t       0x2d0);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_NBIIDX, B_P1_NBIIDX_VAL,\n\t\t\t\t       0x2d0);\n\t\trtw89_phy_write32_mask(rtwdev, R_SEG0CSI, B_SEG0CSI_IDX, 0x740);\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_NBIIDX,\n\t\t\t\t       B_P0_NBIIDX_NOTCH_EN, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_NBIIDX,\n\t\t\t\t       B_P1_NBIIDX_NOTCH_EN, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, R_SEG0CSI_EN, B_SEG0CSI_EN,\n\t\t\t\t       0x1);\n\t} else {\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_NBIIDX,\n\t\t\t\t       B_P0_NBIIDX_NOTCH_EN, 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_NBIIDX,\n\t\t\t\t       B_P1_NBIIDX_NOTCH_EN, 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, R_SEG0CSI_EN, B_SEG0CSI_EN,\n\t\t\t\t       0x0);\n\t}\n}\n\nstatic void rtw8852a_bb_reset_all(struct rtw89_dev *rtwdev,\n\t\t\t\t  enum rtw89_phy_idx phy_idx)\n{\n\trtw89_phy_write32_idx(rtwdev, R_RSTB_ASYNC, B_RSTB_ASYNC_ALL, 1,\n\t\t\t      phy_idx);\n\trtw89_phy_write32_idx(rtwdev, R_RSTB_ASYNC, B_RSTB_ASYNC_ALL, 0,\n\t\t\t      phy_idx);\n\trtw89_phy_write32_idx(rtwdev, R_RSTB_ASYNC, B_RSTB_ASYNC_ALL, 1,\n\t\t\t      phy_idx);\n}\n\nstatic void rtw8852a_bb_reset_en(struct rtw89_dev *rtwdev,\n\t\t\t\t enum rtw89_phy_idx phy_idx, bool en)\n{\n\tif (en)\n\t\trtw89_phy_write32_idx(rtwdev, R_RSTB_ASYNC, B_RSTB_ASYNC_ALL,\n\t\t\t\t      1,\n\t\t\t\t      phy_idx);\n\telse\n\t\trtw89_phy_write32_idx(rtwdev, R_RSTB_ASYNC, B_RSTB_ASYNC_ALL,\n\t\t\t\t      0,\n\t\t\t\t      phy_idx);\n}\n\nstatic void rtw8852a_bb_reset(struct rtw89_dev *rtwdev,\n\t\t\t      enum rtw89_phy_idx phy_idx)\n{\n\trtw89_phy_write32_set(rtwdev, R_P0_TXPW_RSTB, B_P0_TXPW_RSTB_MANON);\n\trtw89_phy_write32_set(rtwdev, R_P0_TSSI_TRK, B_P0_TSSI_TRK_EN);\n\trtw89_phy_write32_set(rtwdev, R_P1_TXPW_RSTB, B_P1_TXPW_RSTB_MANON);\n\trtw89_phy_write32_set(rtwdev, R_P1_TSSI_TRK, B_P1_TSSI_TRK_EN);\n\trtw8852a_bb_reset_all(rtwdev, phy_idx);\n\trtw89_phy_write32_clr(rtwdev, R_P0_TXPW_RSTB, B_P0_TXPW_RSTB_MANON);\n\trtw89_phy_write32_clr(rtwdev, R_P0_TSSI_TRK, B_P0_TSSI_TRK_EN);\n\trtw89_phy_write32_clr(rtwdev, R_P1_TXPW_RSTB, B_P1_TXPW_RSTB_MANON);\n\trtw89_phy_write32_clr(rtwdev, R_P1_TSSI_TRK, B_P1_TSSI_TRK_EN);\n}\n\nstatic void rtw8852a_bb_macid_ctrl_init(struct rtw89_dev *rtwdev,\n\t\t\t\t\tenum rtw89_phy_idx phy_idx)\n{\n\tu32 addr;\n\n\tfor (addr = R_AX_PWR_MACID_LMT_TABLE0;\n\t     addr <= R_AX_PWR_MACID_LMT_TABLE127; addr += 4)\n\t\trtw89_mac_txpwr_write32(rtwdev, phy_idx, addr, 0);\n}\n\nstatic void rtw8852a_bb_sethw(struct rtw89_dev *rtwdev)\n{\n\trtw89_phy_write32_clr(rtwdev, R_P0_EN_SOUND_WO_NDP, B_P0_EN_SOUND_WO_NDP);\n\trtw89_phy_write32_clr(rtwdev, R_P1_EN_SOUND_WO_NDP, B_P1_EN_SOUND_WO_NDP);\n\n\tif (rtwdev->hal.cv <= CHIP_CCV) {\n\t\trtw89_phy_write32_set(rtwdev, R_RSTB_WATCH_DOG, B_P0_RSTB_WATCH_DOG);\n\t\trtw89_phy_write32(rtwdev, R_BRK_ASYNC_RST_EN_1, 0x864FA000);\n\t\trtw89_phy_write32(rtwdev, R_BRK_ASYNC_RST_EN_2, 0x43F);\n\t\trtw89_phy_write32(rtwdev, R_BRK_ASYNC_RST_EN_3, 0x7FFF);\n\t\trtw89_phy_write32_set(rtwdev, R_SPOOF_ASYNC_RST, B_SPOOF_ASYNC_RST);\n\t\trtw89_phy_write32_set(rtwdev, R_P0_TXPW_RSTB, B_P0_TXPW_RSTB_MANON);\n\t\trtw89_phy_write32_set(rtwdev, R_P1_TXPW_RSTB, B_P1_TXPW_RSTB_MANON);\n\t\trtw89_phy_write32_set(rtwdev, R_PLCP_HISTOGRAM, B_STS_PARSING_TIME);\n\t}\n\trtw89_phy_write32_mask(rtwdev, R_CFO_TRK0, B_CFO_TRK_MSK, 0x1f);\n\trtw89_phy_write32_mask(rtwdev, R_CFO_TRK1, B_CFO_TRK_MSK, 0x0c);\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_MOD, 0x0, RTW89_PHY_0);\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_MOD, 0x0, RTW89_PHY_1);\n\trtw89_phy_write32_clr(rtwdev, R_NDP_BRK0, B_NDP_RU_BRK);\n\trtw89_phy_write32_set(rtwdev, R_NDP_BRK1, B_NDP_RU_BRK);\n\n\trtw8852a_bb_macid_ctrl_init(rtwdev, RTW89_PHY_0);\n}\n\nstatic void rtw8852a_bbrst_for_rfk(struct rtw89_dev *rtwdev,\n\t\t\t\t   enum rtw89_phy_idx phy_idx)\n{\n\trtw89_phy_write32_set(rtwdev, R_P0_TSSI_TRK, B_P0_TSSI_TRK_EN);\n\trtw89_phy_write32_set(rtwdev, R_P1_TSSI_TRK, B_P1_TSSI_TRK_EN);\n\trtw8852a_bb_reset_all(rtwdev, phy_idx);\n\trtw89_phy_write32_clr(rtwdev, R_P0_TSSI_TRK, B_P0_TSSI_TRK_EN);\n\trtw89_phy_write32_clr(rtwdev, R_P1_TSSI_TRK, B_P1_TSSI_TRK_EN);\n\tudelay(1);\n}\n\nstatic void rtw8852a_set_channel_bb(struct rtw89_dev *rtwdev,\n\t\t\t\t    const struct rtw89_chan *chan,\n\t\t\t\t    enum rtw89_phy_idx phy_idx)\n{\n\tbool cck_en = chan->channel <= 14;\n\tu8 pri_ch_idx = chan->pri_ch_idx;\n\n\tif (cck_en)\n\t\trtw8852a_ctrl_sco_cck(rtwdev, chan->channel,\n\t\t\t\t      chan->primary_channel,\n\t\t\t\t      chan->band_width);\n\n\trtw8852a_ctrl_ch(rtwdev, chan->channel, phy_idx);\n\trtw8852a_ctrl_bw(rtwdev, pri_ch_idx, chan->band_width, phy_idx);\n\tif (cck_en) {\n\t\trtw89_phy_write32_mask(rtwdev, R_RXCCA, B_RXCCA_DIS, 0);\n\t} else {\n\t\trtw89_phy_write32_mask(rtwdev, R_RXCCA, B_RXCCA_DIS, 1);\n\t\trtw8852a_bbrst_for_rfk(rtwdev, phy_idx);\n\t}\n\trtw8852a_spur_elimination(rtwdev, chan->channel);\n\trtw89_phy_write32_mask(rtwdev, R_MAC_PIN_SEL, B_CH_IDX_SEG0,\n\t\t\t       chan->primary_channel);\n\trtw8852a_bb_reset_all(rtwdev, phy_idx);\n}\n\nstatic void rtw8852a_set_channel(struct rtw89_dev *rtwdev,\n\t\t\t\t const struct rtw89_chan *chan,\n\t\t\t\t enum rtw89_mac_idx mac_idx,\n\t\t\t\t enum rtw89_phy_idx phy_idx)\n{\n\trtw8852a_set_channel_mac(rtwdev, chan, mac_idx);\n\trtw8852a_set_channel_bb(rtwdev, chan, phy_idx);\n}\n\nstatic void rtw8852a_dfs_en(struct rtw89_dev *rtwdev, bool en)\n{\n\tif (en)\n\t\trtw89_phy_write32_mask(rtwdev, R_UPD_P0, B_UPD_P0_EN, 1);\n\telse\n\t\trtw89_phy_write32_mask(rtwdev, R_UPD_P0, B_UPD_P0_EN, 0);\n}\n\nstatic void rtw8852a_tssi_cont_en(struct rtw89_dev *rtwdev, bool en,\n\t\t\t\t  enum rtw89_rf_path path)\n{\n\tstatic const u32 tssi_trk[2] = {0x5818, 0x7818};\n\tstatic const u32 ctrl_bbrst[2] = {0x58dc, 0x78dc};\n\n\tif (en) {\n\t\trtw89_phy_write32_mask(rtwdev, ctrl_bbrst[path], BIT(30), 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, tssi_trk[path], BIT(30), 0x0);\n\t} else {\n\t\trtw89_phy_write32_mask(rtwdev, ctrl_bbrst[path], BIT(30), 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, tssi_trk[path], BIT(30), 0x1);\n\t}\n}\n\nstatic void rtw8852a_tssi_cont_en_phyidx(struct rtw89_dev *rtwdev, bool en,\n\t\t\t\t\t u8 phy_idx)\n{\n\tif (!rtwdev->dbcc_en) {\n\t\trtw8852a_tssi_cont_en(rtwdev, en, RF_PATH_A);\n\t\trtw8852a_tssi_cont_en(rtwdev, en, RF_PATH_B);\n\t} else {\n\t\tif (phy_idx == RTW89_PHY_0)\n\t\t\trtw8852a_tssi_cont_en(rtwdev, en, RF_PATH_A);\n\t\telse\n\t\t\trtw8852a_tssi_cont_en(rtwdev, en, RF_PATH_B);\n\t}\n}\n\nstatic void rtw8852a_adc_en(struct rtw89_dev *rtwdev, bool en)\n{\n\tif (en)\n\t\trtw89_phy_write32_mask(rtwdev, R_ADC_FIFO, B_ADC_FIFO_RST,\n\t\t\t\t       0x0);\n\telse\n\t\trtw89_phy_write32_mask(rtwdev, R_ADC_FIFO, B_ADC_FIFO_RST,\n\t\t\t\t       0xf);\n}\n\nstatic void rtw8852a_set_channel_help(struct rtw89_dev *rtwdev, bool enter,\n\t\t\t\t      struct rtw89_channel_help_params *p,\n\t\t\t\t      const struct rtw89_chan *chan,\n\t\t\t\t      enum rtw89_mac_idx mac_idx,\n\t\t\t\t      enum rtw89_phy_idx phy_idx)\n{\n\tif (enter) {\n\t\trtw89_chip_stop_sch_tx(rtwdev, mac_idx, &p->tx_en,\n\t\t\t\t       RTW89_SCH_TX_SEL_ALL);\n\t\trtw89_mac_cfg_ppdu_status(rtwdev, mac_idx, false);\n\t\trtw8852a_dfs_en(rtwdev, false);\n\t\trtw8852a_tssi_cont_en_phyidx(rtwdev, false, phy_idx);\n\t\trtw8852a_adc_en(rtwdev, false);\n\t\tfsleep(40);\n\t\trtw8852a_bb_reset_en(rtwdev, phy_idx, false);\n\t} else {\n\t\trtw89_mac_cfg_ppdu_status(rtwdev, mac_idx, true);\n\t\trtw8852a_adc_en(rtwdev, true);\n\t\trtw8852a_dfs_en(rtwdev, true);\n\t\trtw8852a_tssi_cont_en_phyidx(rtwdev, true, phy_idx);\n\t\trtw8852a_bb_reset_en(rtwdev, phy_idx, true);\n\t\trtw89_chip_resume_sch_tx(rtwdev, mac_idx, p->tx_en);\n\t}\n}\n\nstatic void rtw8852a_fem_setup(struct rtw89_dev *rtwdev)\n{\n\tstruct rtw89_efuse *efuse = &rtwdev->efuse;\n\n\tswitch (efuse->rfe_type) {\n\tcase 11:\n\tcase 12:\n\tcase 17:\n\tcase 18:\n\tcase 51:\n\tcase 53:\n\t\trtwdev->fem.epa_2g = true;\n\t\trtwdev->fem.elna_2g = true;\n\t\tfallthrough;\n\tcase 9:\n\tcase 10:\n\tcase 15:\n\tcase 16:\n\t\trtwdev->fem.epa_5g = true;\n\t\trtwdev->fem.elna_5g = true;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void rtw8852a_rfk_init(struct rtw89_dev *rtwdev)\n{\n\trtwdev->is_tssi_mode[RF_PATH_A] = false;\n\trtwdev->is_tssi_mode[RF_PATH_B] = false;\n\n\trtw8852a_rck(rtwdev);\n\trtw8852a_dack(rtwdev);\n\trtw8852a_rx_dck(rtwdev, RTW89_PHY_0, true);\n}\n\nstatic void rtw8852a_rfk_channel(struct rtw89_dev *rtwdev)\n{\n\tenum rtw89_phy_idx phy_idx = RTW89_PHY_0;\n\n\trtw8852a_rx_dck(rtwdev, phy_idx, true);\n\trtw8852a_iqk(rtwdev, phy_idx);\n\trtw8852a_tssi(rtwdev, phy_idx);\n\trtw8852a_dpk(rtwdev, phy_idx);\n}\n\nstatic void rtw8852a_rfk_band_changed(struct rtw89_dev *rtwdev,\n\t\t\t\t      enum rtw89_phy_idx phy_idx)\n{\n\trtw8852a_tssi_scan(rtwdev, phy_idx);\n}\n\nstatic void rtw8852a_rfk_scan(struct rtw89_dev *rtwdev, bool start)\n{\n\trtw8852a_wifi_scan_notify(rtwdev, start, RTW89_PHY_0);\n}\n\nstatic void rtw8852a_rfk_track(struct rtw89_dev *rtwdev)\n{\n\trtw8852a_dpk_track(rtwdev);\n\trtw8852a_tssi_track(rtwdev);\n}\n\nstatic u32 rtw8852a_bb_cal_txpwr_ref(struct rtw89_dev *rtwdev,\n\t\t\t\t     enum rtw89_phy_idx phy_idx, s16 ref)\n{\n\ts8 ofst_int = 0;\n\tu8 base_cw_0db = 0x27;\n\tu16 tssi_16dbm_cw = 0x12c;\n\ts16 pwr_s10_3 = 0;\n\ts16 rf_pwr_cw = 0;\n\tu16 bb_pwr_cw = 0;\n\tu32 pwr_cw = 0;\n\tu32 tssi_ofst_cw = 0;\n\n\tpwr_s10_3 = (ref << 1) + (s16)(ofst_int) + (s16)(base_cw_0db << 3);\n\tbb_pwr_cw = FIELD_GET(GENMASK(2, 0), pwr_s10_3);\n\trf_pwr_cw = FIELD_GET(GENMASK(8, 3), pwr_s10_3);\n\trf_pwr_cw = clamp_t(s16, rf_pwr_cw, 15, 63);\n\tpwr_cw = (rf_pwr_cw << 3) | bb_pwr_cw;\n\n\ttssi_ofst_cw = (u32)((s16)tssi_16dbm_cw + (ref << 1) - (16 << 3));\n\trtw89_debug(rtwdev, RTW89_DBG_TXPWR,\n\t\t    \"[TXPWR] tssi_ofst_cw=%d rf_cw=0x%x bb_cw=0x%x\\n\",\n\t\t    tssi_ofst_cw, rf_pwr_cw, bb_pwr_cw);\n\n\treturn (tssi_ofst_cw << 18) | (pwr_cw << 9) | (ref & GENMASK(8, 0));\n}\n\nstatic\nvoid rtw8852a_set_txpwr_ul_tb_offset(struct rtw89_dev *rtwdev,\n\t\t\t\t     s8 pw_ofst, enum rtw89_mac_idx mac_idx)\n{\n\ts8 val_1t = 0;\n\ts8 val_2t = 0;\n\tu32 reg;\n\n\tif (pw_ofst < -16 || pw_ofst > 15) {\n\t\trtw89_debug(rtwdev, RTW89_DBG_TXPWR, \"[ULTB] Err pwr_offset=%d\\n\",\n\t\t\t    pw_ofst);\n\t\treturn;\n\t}\n\treg = rtw89_mac_reg_by_idx(rtwdev, R_AX_PWR_UL_TB_CTRL, mac_idx);\n\trtw89_write32_set(rtwdev, reg, B_AX_PWR_UL_TB_CTRL_EN);\n\tval_1t = pw_ofst;\n\treg = rtw89_mac_reg_by_idx(rtwdev, R_AX_PWR_UL_TB_1T, mac_idx);\n\trtw89_write32_mask(rtwdev, reg, B_AX_PWR_UL_TB_1T_MASK, val_1t);\n\tval_2t = max(val_1t - 3, -16);\n\treg = rtw89_mac_reg_by_idx(rtwdev, R_AX_PWR_UL_TB_2T, mac_idx);\n\trtw89_write32_mask(rtwdev, reg, B_AX_PWR_UL_TB_2T_MASK, val_2t);\n\trtw89_debug(rtwdev, RTW89_DBG_TXPWR, \"[ULTB] Set TB pwr_offset=(%d, %d)\\n\",\n\t\t    val_1t, val_2t);\n}\n\nstatic void rtw8852a_set_txpwr_ref(struct rtw89_dev *rtwdev,\n\t\t\t\t   enum rtw89_phy_idx phy_idx)\n{\n\tstatic const u32 addr[RF_PATH_NUM_8852A] = {0x5800, 0x7800};\n\tconst u32 mask = 0x7FFFFFF;\n\tconst u8 ofst_ofdm = 0x4;\n\tconst u8 ofst_cck = 0x8;\n\ts16 ref_ofdm = 0;\n\ts16 ref_cck = 0;\n\tu32 val;\n\tu8 i;\n\n\trtw89_debug(rtwdev, RTW89_DBG_TXPWR, \"[TXPWR] set txpwr reference\\n\");\n\n\trtw89_mac_txpwr_write32_mask(rtwdev, phy_idx, R_AX_PWR_RATE_CTRL,\n\t\t\t\t     GENMASK(27, 10), 0x0);\n\n\trtw89_debug(rtwdev, RTW89_DBG_TXPWR, \"[TXPWR] set bb ofdm txpwr ref\\n\");\n\tval = rtw8852a_bb_cal_txpwr_ref(rtwdev, phy_idx, ref_ofdm);\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++)\n\t\trtw89_phy_write32_idx(rtwdev, addr[i] + ofst_ofdm, mask, val,\n\t\t\t\t      phy_idx);\n\n\trtw89_debug(rtwdev, RTW89_DBG_TXPWR, \"[TXPWR] set bb cck txpwr ref\\n\");\n\tval = rtw8852a_bb_cal_txpwr_ref(rtwdev, phy_idx, ref_cck);\n\n\tfor (i = 0; i < RF_PATH_NUM_8852A; i++)\n\t\trtw89_phy_write32_idx(rtwdev, addr[i] + ofst_cck, mask, val,\n\t\t\t\t      phy_idx);\n}\n\nstatic void rtw8852a_set_txpwr(struct rtw89_dev *rtwdev,\n\t\t\t       const struct rtw89_chan *chan,\n\t\t\t       enum rtw89_phy_idx phy_idx)\n{\n\trtw89_phy_set_txpwr_byrate(rtwdev, chan, phy_idx);\n\trtw89_phy_set_txpwr_offset(rtwdev, chan, phy_idx);\n\trtw89_phy_set_txpwr_limit(rtwdev, chan, phy_idx);\n\trtw89_phy_set_txpwr_limit_ru(rtwdev, chan, phy_idx);\n}\n\nstatic void rtw8852a_set_txpwr_ctrl(struct rtw89_dev *rtwdev,\n\t\t\t\t    enum rtw89_phy_idx phy_idx)\n{\n\trtw8852a_set_txpwr_ref(rtwdev, phy_idx);\n}\n\nstatic int\nrtw8852a_init_txpwr_unit(struct rtw89_dev *rtwdev, enum rtw89_phy_idx phy_idx)\n{\n\tint ret;\n\n\tret = rtw89_mac_txpwr_write32(rtwdev, phy_idx, R_AX_PWR_UL_CTRL2, 0x07763333);\n\tif (ret)\n\t\treturn ret;\n\n\tret = rtw89_mac_txpwr_write32(rtwdev, phy_idx, R_AX_PWR_COEXT_CTRL, 0x01ebf004);\n\tif (ret)\n\t\treturn ret;\n\n\tret = rtw89_mac_txpwr_write32(rtwdev, phy_idx, R_AX_PWR_UL_CTRL0, 0x0002f8ff);\n\tif (ret)\n\t\treturn ret;\n\n\treturn 0;\n}\n\nvoid rtw8852a_bb_set_plcp_tx(struct rtw89_dev *rtwdev)\n{\n\tu8 i = 0;\n\tu32 addr, val;\n\n\tfor (i = 0; i < ARRAY_SIZE(rtw8852a_pmac_ht20_mcs7_tbl); i++) {\n\t\taddr = rtw8852a_pmac_ht20_mcs7_tbl[i].addr;\n\t\tval = rtw8852a_pmac_ht20_mcs7_tbl[i].data;\n\t\trtw89_phy_write32(rtwdev, addr, val);\n\t}\n}\n\nstatic void rtw8852a_stop_pmac_tx(struct rtw89_dev *rtwdev,\n\t\t\t\t  struct rtw8852a_bb_pmac_info *tx_info,\n\t\t\t\t  enum rtw89_phy_idx idx)\n{\n\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"PMAC Stop Tx\");\n\tif (tx_info->mode == CONT_TX)\n\t\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_PRD, B_PMAC_CTX_EN, 0,\n\t\t\t\t      idx);\n\telse if (tx_info->mode == PKTS_TX)\n\t\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_PRD, B_PMAC_PTX_EN, 0,\n\t\t\t\t      idx);\n}\n\nstatic void rtw8852a_start_pmac_tx(struct rtw89_dev *rtwdev,\n\t\t\t\t   struct rtw8852a_bb_pmac_info *tx_info,\n\t\t\t\t   enum rtw89_phy_idx idx)\n{\n\tenum rtw8852a_pmac_mode mode = tx_info->mode;\n\tu32 pkt_cnt = tx_info->tx_cnt;\n\tu16 period = tx_info->period;\n\n\tif (mode == CONT_TX && !tx_info->is_cck) {\n\t\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_PRD, B_PMAC_CTX_EN, 1,\n\t\t\t\t      idx);\n\t\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"PMAC CTx Start\");\n\t} else if (mode == PKTS_TX) {\n\t\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_PRD, B_PMAC_PTX_EN, 1,\n\t\t\t\t      idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_PRD,\n\t\t\t\t      B_PMAC_TX_PRD_MSK, period, idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_CNT, B_PMAC_TX_CNT_MSK,\n\t\t\t\t      pkt_cnt, idx);\n\t\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"PMAC PTx Start\");\n\t}\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_CTRL, B_PMAC_TXEN_DIS, 1, idx);\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_TX_CTRL, B_PMAC_TXEN_DIS, 0, idx);\n}\n\nvoid rtw8852a_bb_set_pmac_tx(struct rtw89_dev *rtwdev,\n\t\t\t     struct rtw8852a_bb_pmac_info *tx_info,\n\t\t\t     enum rtw89_phy_idx idx)\n{\n\tconst struct rtw89_chan *chan = rtw89_chan_get(rtwdev, RTW89_SUB_ENTITY_0);\n\n\tif (!tx_info->en_pmac_tx) {\n\t\trtw8852a_stop_pmac_tx(rtwdev, tx_info, idx);\n\t\trtw89_phy_write32_idx(rtwdev, R_PD_CTRL, B_PD_HIT_DIS, 0, idx);\n\t\tif (chan->band_type == RTW89_BAND_2G)\n\t\t\trtw89_phy_write32_clr(rtwdev, R_RXCCA, B_RXCCA_DIS);\n\t\treturn;\n\t}\n\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"PMAC Tx Enable\");\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_GNT, B_PMAC_GNT_TXEN, 1, idx);\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_GNT, B_PMAC_GNT_RXEN, 1, idx);\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_RX_CFG1, B_PMAC_OPT1_MSK, 0x3f,\n\t\t\t      idx);\n\trtw89_phy_write32_idx(rtwdev, R_RSTB_ASYNC, B_RSTB_ASYNC_ALL, 0, idx);\n\trtw89_phy_write32_idx(rtwdev, R_PD_CTRL, B_PD_HIT_DIS, 1, idx);\n\trtw89_phy_write32_set(rtwdev, R_RXCCA, B_RXCCA_DIS);\n\trtw89_phy_write32_idx(rtwdev, R_RSTB_ASYNC, B_RSTB_ASYNC_ALL, 1, idx);\n\trtw8852a_start_pmac_tx(rtwdev, tx_info, idx);\n}\n\nvoid rtw8852a_bb_set_pmac_pkt_tx(struct rtw89_dev *rtwdev, u8 enable,\n\t\t\t\t u16 tx_cnt, u16 period, u16 tx_time,\n\t\t\t\t enum rtw89_phy_idx idx)\n{\n\tstruct rtw8852a_bb_pmac_info tx_info = {0};\n\n\ttx_info.en_pmac_tx = enable;\n\ttx_info.is_cck = 0;\n\ttx_info.mode = PKTS_TX;\n\ttx_info.tx_cnt = tx_cnt;\n\ttx_info.period = period;\n\ttx_info.tx_time = tx_time;\n\trtw8852a_bb_set_pmac_tx(rtwdev, &tx_info, idx);\n}\n\nvoid rtw8852a_bb_set_power(struct rtw89_dev *rtwdev, s16 pwr_dbm,\n\t\t\t   enum rtw89_phy_idx idx)\n{\n\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"PMAC CFG Tx PWR = %d\", pwr_dbm);\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_PWR_EN, 1, idx);\n\trtw89_phy_write32_idx(rtwdev, R_TXPWR, B_TXPWR_MSK, pwr_dbm, idx);\n}\n\nvoid rtw8852a_bb_cfg_tx_path(struct rtw89_dev *rtwdev, u8 tx_path)\n{\n\tu32 rst_mask0 = 0;\n\tu32 rst_mask1 = 0;\n\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_MOD, 7, RTW89_PHY_0);\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_MOD, 7, RTW89_PHY_1);\n\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"PMAC CFG Tx Path = %d\", tx_path);\n\tif (!rtwdev->dbcc_en) {\n\t\tif (tx_path == RF_PATH_A) {\n\t\t\trtw89_phy_write32_mask(rtwdev, R_TXPATH_SEL,\n\t\t\t\t\t       B_TXPATH_SEL_MSK, 1);\n\t\t\trtw89_phy_write32_mask(rtwdev, R_TXNSS_MAP,\n\t\t\t\t\t       B_TXNSS_MAP_MSK, 0);\n\t\t} else if (tx_path == RF_PATH_B) {\n\t\t\trtw89_phy_write32_mask(rtwdev, R_TXPATH_SEL,\n\t\t\t\t\t       B_TXPATH_SEL_MSK, 2);\n\t\t\trtw89_phy_write32_mask(rtwdev, R_TXNSS_MAP,\n\t\t\t\t\t       B_TXNSS_MAP_MSK, 0);\n\t\t} else if (tx_path == RF_PATH_AB) {\n\t\t\trtw89_phy_write32_mask(rtwdev, R_TXPATH_SEL,\n\t\t\t\t\t       B_TXPATH_SEL_MSK, 3);\n\t\t\trtw89_phy_write32_mask(rtwdev, R_TXNSS_MAP,\n\t\t\t\t\t       B_TXNSS_MAP_MSK, 4);\n\t\t} else {\n\t\t\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"Error Tx Path\");\n\t\t}\n\t} else {\n\t\trtw89_phy_write32_mask(rtwdev, R_TXPATH_SEL, B_TXPATH_SEL_MSK,\n\t\t\t\t       1);\n\t\trtw89_phy_write32_idx(rtwdev, R_TXPATH_SEL, B_TXPATH_SEL_MSK, 2,\n\t\t\t\t      RTW89_PHY_1);\n\t\trtw89_phy_write32_mask(rtwdev, R_TXNSS_MAP, B_TXNSS_MAP_MSK,\n\t\t\t\t       0);\n\t\trtw89_phy_write32_idx(rtwdev, R_TXNSS_MAP, B_TXNSS_MAP_MSK, 4,\n\t\t\t\t      RTW89_PHY_1);\n\t}\n\trst_mask0 = B_P0_TXPW_RSTB_MANON | B_P0_TXPW_RSTB_TSSI;\n\trst_mask1 = B_P1_TXPW_RSTB_MANON | B_P1_TXPW_RSTB_TSSI;\n\tif (tx_path == RF_PATH_A) {\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_TXPW_RSTB, rst_mask0, 1);\n\t\trtw89_phy_write32_mask(rtwdev, R_P0_TXPW_RSTB, rst_mask0, 3);\n\t} else {\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_TXPW_RSTB, rst_mask1, 1);\n\t\trtw89_phy_write32_mask(rtwdev, R_P1_TXPW_RSTB, rst_mask1, 3);\n\t}\n}\n\nvoid rtw8852a_bb_tx_mode_switch(struct rtw89_dev *rtwdev,\n\t\t\t\tenum rtw89_phy_idx idx, u8 mode)\n{\n\tif (mode != 0)\n\t\treturn;\n\trtw89_debug(rtwdev, RTW89_DBG_TSSI, \"Tx mode switch\");\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_GNT, B_PMAC_GNT_TXEN, 0, idx);\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_GNT, B_PMAC_GNT_RXEN, 0, idx);\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_RX_CFG1, B_PMAC_OPT1_MSK, 0, idx);\n\trtw89_phy_write32_idx(rtwdev, R_PMAC_RXMOD, B_PMAC_RXMOD_MSK, 0, idx);\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_DPD_EN, 0, idx);\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_MOD, 0, idx);\n\trtw89_phy_write32_idx(rtwdev, R_MAC_SEL, B_MAC_SEL_PWR_EN, 0, idx);\n}\n\nstatic void rtw8852a_bb_ctrl_btc_preagc(struct rtw89_dev *rtwdev, bool bt_en)\n{\n\trtw89_phy_write_reg3_tbl(rtwdev, bt_en ? &rtw8852a_btc_preagc_en_defs_tbl :\n\t\t\t\t\t\t &rtw8852a_btc_preagc_dis_defs_tbl);\n}\n\nstatic u8 rtw8852a_get_thermal(struct rtw89_dev *rtwdev, enum rtw89_rf_path rf_path)\n{\n\tif (rtwdev->is_tssi_mode[rf_path]) {\n\t\tu32 addr = 0x1c10 + (rf_path << 13);\n\n\t\treturn (u8)rtw89_phy_read32_mask(rtwdev, addr, 0x3F000000);\n\t}\n\n\trtw89_write_rf(rtwdev, rf_path, RR_TM, RR_TM_TRI, 0x1);\n\trtw89_write_rf(rtwdev, rf_path, RR_TM, RR_TM_TRI, 0x0);\n\trtw89_write_rf(rtwdev, rf_path, RR_TM, RR_TM_TRI, 0x1);\n\n\tfsleep(200);\n\n\treturn (u8)rtw89_read_rf(rtwdev, rf_path, RR_TM, RR_TM_VAL);\n}\n\nstatic void rtw8852a_btc_set_rfe(struct rtw89_dev *rtwdev)\n{\n\tstruct rtw89_btc *btc = &rtwdev->btc;\n\tstruct rtw89_btc_module *module = &btc->mdinfo;\n\n\tmodule->rfe_type = rtwdev->efuse.rfe_type;\n\tmodule->cv = rtwdev->hal.cv;\n\tmodule->bt_solo = 0;\n\tmodule->switch_type = BTC_SWITCH_INTERNAL;\n\n\tif (module->rfe_type > 0)\n\t\tmodule->ant.num = (module->rfe_type % 2 ? 2 : 3);\n\telse\n\t\tmodule->ant.num = 2;\n\n\tmodule->ant.diversity = 0;\n\tmodule->ant.isolation = 10;\n\n\tif (module->ant.num == 3) {\n\t\tmodule->ant.type = BTC_ANT_DEDICATED;\n\t\tmodule->bt_pos = BTC_BT_ALONE;\n\t} else {\n\t\tmodule->ant.type = BTC_ANT_SHARED;\n\t\tmodule->bt_pos = BTC_BT_BTG;\n\t}\n}\n\nstatic\nvoid rtw8852a_set_trx_mask(struct rtw89_dev *rtwdev, u8 path, u8 group, u32 val)\n{\n\trtw89_write_rf(rtwdev, path, RR_LUTWE, 0xfffff, 0x20000);\n\trtw89_write_rf(rtwdev, path, RR_LUTWA, 0xfffff, group);\n\trtw89_write_rf(rtwdev, path, RR_LUTWD0, 0xfffff, val);\n\trtw89_write_rf(rtwdev, path, RR_LUTWE, 0xfffff, 0x0);\n}\n\nstatic void rtw8852a_ctrl_btg(struct rtw89_dev *rtwdev, bool btg)\n{\n\tif (btg) {\n\t\trtw89_phy_write32_mask(rtwdev, R_PATH0_BTG, B_PATH0_BTG_SHEN, 0x1);\n\t\trtw89_phy_write32_mask(rtwdev, R_PATH1_BTG, B_PATH1_BTG_SHEN, 0x3);\n\t\trtw89_phy_write32_mask(rtwdev, R_PMAC_GNT, B_PMAC_GNT_P1, 0x0);\n\t} else {\n\t\trtw89_phy_write32_mask(rtwdev, R_PATH0_BTG, B_PATH0_BTG_SHEN, 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, R_PATH1_BTG, B_PATH1_BTG_SHEN, 0x0);\n\t\trtw89_phy_write32_mask(rtwdev, R_PMAC_GNT, B_PMAC_GNT_P1, 0xf);\n\t\trtw89_phy_write32_mask(rtwdev, R_PMAC_GNT, B_PMAC_GNT_P2, 0x4);\n\t}\n}\n\nstatic void rtw8852a_btc_init_cfg(struct rtw89_dev *rtwdev)\n{\n\tstruct rtw89_btc *btc = &rtwdev->btc;\n\tstruct rtw89_btc_module *module = &btc->mdinfo;\n\tconst struct rtw89_chip_info *chip = rtwdev->chip;\n\tconst struct rtw89_mac_ax_coex coex_params = {\n\t\t.pta_mode = RTW89_MAC_AX_COEX_RTK_MODE,\n\t\t.direction = RTW89_MAC_AX_COEX_INNER,\n\t};\n\n\t \n\trtw89_mac_coex_init(rtwdev, &coex_params);\n\n\t \n\tchip->ops->btc_set_wl_pri(rtwdev, BTC_PRI_MASK_TX_RESP, true);\n\tchip->ops->btc_set_wl_pri(rtwdev, BTC_PRI_MASK_BEACON, true);\n\n\t \n\trtw89_write_rf(rtwdev, RF_PATH_A, RR_WLSEL, 0xfffff, 0x0);\n\trtw89_write_rf(rtwdev, RF_PATH_B, RR_WLSEL, 0xfffff, 0x0);\n\n\t \n\tif (module->ant.type == BTC_ANT_SHARED) {\n\t\trtw8852a_set_trx_mask(rtwdev,\n\t\t\t\t      RF_PATH_A, BTC_BT_SS_GROUP, 0x5ff);\n\t\trtw8852a_set_trx_mask(rtwdev,\n\t\t\t\t      RF_PATH_B, BTC_BT_SS_GROUP, 0x5ff);\n\t\t \n\t\trtw8852a_set_trx_mask(rtwdev,\n\t\t\t\t      RF_PATH_A, BTC_BT_TX_GROUP, 0x5ff);\n\t} else {  \n\t\trtw8852a_set_trx_mask(rtwdev,\n\t\t\t\t      RF_PATH_A, BTC_BT_SS_GROUP, 0x5df);\n\t\trtw8852a_set_trx_mask(rtwdev,\n\t\t\t\t      RF_PATH_B, BTC_BT_SS_GROUP, 0x5df);\n\t}\n\n\t \n\trtw89_write32(rtwdev, R_BTC_BREAK_TABLE, BTC_BREAK_PARAM);\n\n\t  \n\trtw89_write32_set(rtwdev,\n\t\t\t  R_AX_CSR_MODE, B_AX_BT_CNT_RST | B_AX_STATIS_BT_EN);\n\tbtc->cx.wl.status.map.init_ok = true;\n}\n\nstatic\nvoid rtw8852a_btc_set_wl_pri(struct rtw89_dev *rtwdev, u8 map, bool state)\n{\n\tu32 bitmap = 0;\n\tu32 reg = 0;\n\n\tswitch (map) {\n\tcase BTC_PRI_MASK_TX_RESP:\n\t\treg = R_BTC_BT_COEX_MSK_TABLE;\n\t\tbitmap = B_BTC_PRI_MASK_TX_RESP_V1;\n\t\tbreak;\n\tcase BTC_PRI_MASK_BEACON:\n\t\treg = R_AX_WL_PRI_MSK;\n\t\tbitmap = B_AX_PTA_WL_PRI_MASK_BCNQ;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\tif (state)\n\t\trtw89_write32_set(rtwdev, reg, bitmap);\n\telse\n\t\trtw89_write32_clr(rtwdev, reg, bitmap);\n}\n\nstatic inline u32 __btc_ctrl_val_all_time(u32 ctrl)\n{\n\treturn FIELD_GET(GENMASK(15, 0), ctrl);\n}\n\nstatic inline u32 __btc_ctrl_rst_all_time(u32 cur)\n{\n\treturn cur & ~B_AX_FORCE_PWR_BY_RATE_EN;\n}\n\nstatic inline u32 __btc_ctrl_gen_all_time(u32 cur, u32 val)\n{\n\tu32 hv = cur & ~B_AX_FORCE_PWR_BY_RATE_VALUE_MASK;\n\tu32 lv = val & B_AX_FORCE_PWR_BY_RATE_VALUE_MASK;\n\n\treturn hv | lv | B_AX_FORCE_PWR_BY_RATE_EN;\n}\n\nstatic inline u32 __btc_ctrl_val_gnt_bt(u32 ctrl)\n{\n\treturn FIELD_GET(GENMASK(31, 16), ctrl);\n}\n\nstatic inline u32 __btc_ctrl_rst_gnt_bt(u32 cur)\n{\n\treturn cur & ~B_AX_TXAGC_BT_EN;\n}\n\nstatic inline u32 __btc_ctrl_gen_gnt_bt(u32 cur, u32 val)\n{\n\tu32 ov = cur & ~B_AX_TXAGC_BT_MASK;\n\tu32 iv = FIELD_PREP(B_AX_TXAGC_BT_MASK, val);\n\n\treturn ov | iv | B_AX_TXAGC_BT_EN;\n}\n\nstatic void\nrtw8852a_btc_set_wl_txpwr_ctrl(struct rtw89_dev *rtwdev, u32 txpwr_val)\n{\n\tconst u32 __btc_cr_all_time = R_AX_PWR_RATE_CTRL;\n\tconst u32 __btc_cr_gnt_bt = R_AX_PWR_COEXT_CTRL;\n\n#define __do_clr(_chk) ((_chk) == GENMASK(15, 0))\n#define __handle(_case)\t\t\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\t\t\t\\\n\t\tconst u32 _reg = __btc_cr_ ## _case;\t\t\t\\\n\t\tu32 _val = __btc_ctrl_val_ ## _case(txpwr_val);\t\t\\\n\t\tu32 _cur, _wrt;\t\t\t\t\t\t\\\n\t\trtw89_debug(rtwdev, RTW89_DBG_TXPWR,\t\t\t\\\n\t\t\t    \"btc ctrl %s: 0x%x\\n\", #_case, _val);\t\\\n\t\tif (rtw89_mac_txpwr_read32(rtwdev, RTW89_PHY_0, _reg, &_cur))\\\n\t\t\tbreak;\t\t\t\t\t\t\\\n\t\trtw89_debug(rtwdev, RTW89_DBG_TXPWR,\t\t\t\\\n\t\t\t    \"btc ctrl ori 0x%x: 0x%x\\n\", _reg, _cur);\t\\\n\t\t_wrt = __do_clr(_val) ?\t\t\t\t\t\\\n\t\t\t__btc_ctrl_rst_ ## _case(_cur) :\t\t\\\n\t\t\t__btc_ctrl_gen_ ## _case(_cur, _val);\t\t\\\n\t\trtw89_mac_txpwr_write32(rtwdev, RTW89_PHY_0, _reg, _wrt);\\\n\t\trtw89_debug(rtwdev, RTW89_DBG_TXPWR,\t\t\t\\\n\t\t\t    \"btc ctrl set 0x%x: 0x%x\\n\", _reg, _wrt);\t\\\n\t} while (0)\n\n\t__handle(all_time);\n\t__handle(gnt_bt);\n\n#undef __handle\n#undef __do_clr\n}\n\nstatic\ns8 rtw8852a_btc_get_bt_rssi(struct rtw89_dev *rtwdev, s8 val)\n{\n\t \n\treturn clamp_t(s8, val + 6, -100, 0) + 100;\n}\n\nstatic struct rtw89_btc_rf_trx_para rtw89_btc_8852a_rf_ul[] = {\n\t{255, 0, 0, 7},  \n\t{255, 2, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{6, 1, 0, 7},\n\t{13, 1, 0, 7},\n\t{13, 1, 0, 7}\n};\n\nstatic struct rtw89_btc_rf_trx_para rtw89_btc_8852a_rf_dl[] = {\n\t{255, 0, 0, 7},  \n\t{255, 2, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{255, 0, 0, 7},  \n\t{255, 1, 0, 7},\n\t{255, 1, 0, 7},\n\t{255, 1, 0, 7}\n};\n\nstatic const\nu8 rtw89_btc_8852a_wl_rssi_thres[BTC_WL_RSSI_THMAX] = {60, 50, 40, 30};\nstatic const\nu8 rtw89_btc_8852a_bt_rssi_thres[BTC_BT_RSSI_THMAX] = {40, 36, 31, 28};\n\nstatic struct rtw89_btc_fbtc_mreg rtw89_btc_8852a_mon_reg[] = {\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda24),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda28),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda2c),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda30),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda4c),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda10),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda20),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xda34),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0xcef4),\n\tRTW89_DEF_FBTC_MREG(REG_MAC, 4, 0x8424),\n\tRTW89_DEF_FBTC_MREG(REG_BB, 4, 0x980),\n\tRTW89_DEF_FBTC_MREG(REG_BT_MODEM, 4, 0x178),\n};\n\nstatic\nvoid rtw8852a_btc_update_bt_cnt(struct rtw89_dev *rtwdev)\n{\n\tstruct rtw89_btc *btc = &rtwdev->btc;\n\tconst struct rtw89_btc_ver *ver = btc->ver;\n\tstruct rtw89_btc_cx *cx = &btc->cx;\n\tu32 val;\n\n\tif (ver->fcxbtcrpt != 1)\n\t\treturn;\n\n\tval = rtw89_read32(rtwdev, R_AX_BT_STAST_HIGH);\n\tcx->cnt_bt[BTC_BCNT_HIPRI_TX] = FIELD_GET(B_AX_STATIS_BT_HI_TX_MASK, val);\n\tcx->cnt_bt[BTC_BCNT_HIPRI_RX] = FIELD_GET(B_AX_STATIS_BT_HI_RX_MASK, val);\n\n\tval = rtw89_read32(rtwdev, R_AX_BT_STAST_LOW);\n\tcx->cnt_bt[BTC_BCNT_LOPRI_TX] = FIELD_GET(B_AX_STATIS_BT_LO_TX_1_MASK, val);\n\tcx->cnt_bt[BTC_BCNT_LOPRI_RX] = FIELD_GET(B_AX_STATIS_BT_LO_RX_1_MASK, val);\n\n\t \n\trtw89_write32_set(rtwdev, R_AX_BTC_CFG, B_AX_DIS_BTC_CLK_G);\n\trtw89_write32_clr(rtwdev, R_AX_CSR_MODE, B_AX_BT_CNT_RST);\n\trtw89_write32_set(rtwdev, R_AX_CSR_MODE, B_AX_BT_CNT_RST);\n\trtw89_write32_clr(rtwdev, R_AX_BTC_CFG, B_AX_DIS_BTC_CLK_G);\n}\n\nstatic\nvoid rtw8852a_btc_wl_s1_standby(struct rtw89_dev *rtwdev, bool state)\n{\n\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWE, RFREG_MASK, 0x80000);\n\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWA, RFREG_MASK, 0x1);\n\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWD1, RFREG_MASK, 0x1);\n\n\t \n\tif (state)\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWD0,\n\t\t\t       RFREG_MASK, 0xa2d7c);\n\telse\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWD0,\n\t\t\t       RFREG_MASK, 0xa2020);\n\n\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWE, RFREG_MASK, 0x0);\n}\n\nstatic void rtw8852a_set_wl_lna2(struct rtw89_dev *rtwdev, u8 level)\n{\n\t \n\n\tswitch (level) {\n\tcase 0:  \n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWE, RFREG_MASK, 0x1000);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWA, RFREG_MASK, 0x3);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWD0, RFREG_MASK, 0x17);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWA, RFREG_MASK, 0x2);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWD0, RFREG_MASK, 0x15);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWE, RFREG_MASK, 0x0);\n\t\tbreak;\n\tcase 1:  \n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWE, RFREG_MASK, 0x1000);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWA, RFREG_MASK, 0x3);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWD0, RFREG_MASK, 0x5);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWA, RFREG_MASK, 0x2);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWD0, RFREG_MASK, 0x15);\n\t\trtw89_write_rf(rtwdev, RF_PATH_B, RR_LUTWE, RFREG_MASK, 0x0);\n\t\tbreak;\n\t}\n}\n\nstatic void rtw8852a_btc_set_wl_rx_gain(struct rtw89_dev *rtwdev, u32 level)\n{\n\tstruct rtw89_btc *btc = &rtwdev->btc;\n\n\tswitch (level) {\n\tcase 0:  \n\tdefault:\n\t\trtw8852a_bb_ctrl_btc_preagc(rtwdev, false);\n\t\tbtc->dm.wl_lna2 = 0;\n\t\tbreak;\n\tcase 1:  \n\t\trtw8852a_bb_ctrl_btc_preagc(rtwdev, true);\n\t\tbtc->dm.wl_lna2 = 0;\n\t\tbreak;\n\tcase 2:  \n\t\trtw8852a_bb_ctrl_btc_preagc(rtwdev, false);\n\t\tbtc->dm.wl_lna2 = 1;\n\t\tbreak;\n\t}\n\n\trtw8852a_set_wl_lna2(rtwdev, btc->dm.wl_lna2);\n}\n\nstatic void rtw8852a_fill_freq_with_ppdu(struct rtw89_dev *rtwdev,\n\t\t\t\t\t struct rtw89_rx_phy_ppdu *phy_ppdu,\n\t\t\t\t\t struct ieee80211_rx_status *status)\n{\n\tu16 chan = phy_ppdu->chan_idx;\n\tu8 band;\n\n\tif (chan == 0)\n\t\treturn;\n\n\tband = chan <= 14 ? NL80211_BAND_2GHZ : NL80211_BAND_5GHZ;\n\tstatus->freq = ieee80211_channel_to_frequency(chan, band);\n\tstatus->band = band;\n}\n\nstatic void rtw8852a_query_ppdu(struct rtw89_dev *rtwdev,\n\t\t\t\tstruct rtw89_rx_phy_ppdu *phy_ppdu,\n\t\t\t\tstruct ieee80211_rx_status *status)\n{\n\tu8 path;\n\tu8 *rx_power = phy_ppdu->rssi;\n\n\tstatus->signal = RTW89_RSSI_RAW_TO_DBM(max(rx_power[RF_PATH_A], rx_power[RF_PATH_B]));\n\tfor (path = 0; path < rtwdev->chip->rf_path_num; path++) {\n\t\tstatus->chains |= BIT(path);\n\t\tstatus->chain_signal[path] = RTW89_RSSI_RAW_TO_DBM(rx_power[path]);\n\t}\n\tif (phy_ppdu->valid)\n\t\trtw8852a_fill_freq_with_ppdu(rtwdev, phy_ppdu, status);\n}\n\n#ifdef CONFIG_PM\nstatic const struct wiphy_wowlan_support rtw_wowlan_stub_8852a = {\n\t.flags = WIPHY_WOWLAN_MAGIC_PKT | WIPHY_WOWLAN_DISCONNECT,\n\t.n_patterns = RTW89_MAX_PATTERN_NUM,\n\t.pattern_max_len = RTW89_MAX_PATTERN_SIZE,\n\t.pattern_min_len = 1,\n};\n#endif\n\nstatic const struct rtw89_chip_ops rtw8852a_chip_ops = {\n\t.enable_bb_rf\t\t= rtw89_mac_enable_bb_rf,\n\t.disable_bb_rf\t\t= rtw89_mac_disable_bb_rf,\n\t.bb_reset\t\t= rtw8852a_bb_reset,\n\t.bb_sethw\t\t= rtw8852a_bb_sethw,\n\t.read_rf\t\t= rtw89_phy_read_rf,\n\t.write_rf\t\t= rtw89_phy_write_rf,\n\t.set_channel\t\t= rtw8852a_set_channel,\n\t.set_channel_help\t= rtw8852a_set_channel_help,\n\t.read_efuse\t\t= rtw8852a_read_efuse,\n\t.read_phycap\t\t= rtw8852a_read_phycap,\n\t.fem_setup\t\t= rtw8852a_fem_setup,\n\t.rfe_gpio\t\t= NULL,\n\t.rfk_init\t\t= rtw8852a_rfk_init,\n\t.rfk_channel\t\t= rtw8852a_rfk_channel,\n\t.rfk_band_changed\t= rtw8852a_rfk_band_changed,\n\t.rfk_scan\t\t= rtw8852a_rfk_scan,\n\t.rfk_track\t\t= rtw8852a_rfk_track,\n\t.power_trim\t\t= rtw8852a_power_trim,\n\t.set_txpwr\t\t= rtw8852a_set_txpwr,\n\t.set_txpwr_ctrl\t\t= rtw8852a_set_txpwr_ctrl,\n\t.init_txpwr_unit\t= rtw8852a_init_txpwr_unit,\n\t.get_thermal\t\t= rtw8852a_get_thermal,\n\t.ctrl_btg\t\t= rtw8852a_ctrl_btg,\n\t.query_ppdu\t\t= rtw8852a_query_ppdu,\n\t.bb_ctrl_btc_preagc\t= rtw8852a_bb_ctrl_btc_preagc,\n\t.cfg_txrx_path\t\t= NULL,\n\t.set_txpwr_ul_tb_offset\t= rtw8852a_set_txpwr_ul_tb_offset,\n\t.pwr_on_func\t\t= NULL,\n\t.pwr_off_func\t\t= NULL,\n\t.query_rxdesc\t\t= rtw89_core_query_rxdesc,\n\t.fill_txdesc\t\t= rtw89_core_fill_txdesc,\n\t.fill_txdesc_fwcmd\t= rtw89_core_fill_txdesc,\n\t.cfg_ctrl_path\t\t= rtw89_mac_cfg_ctrl_path,\n\t.mac_cfg_gnt\t\t= rtw89_mac_cfg_gnt,\n\t.stop_sch_tx\t\t= rtw89_mac_stop_sch_tx,\n\t.resume_sch_tx\t\t= rtw89_mac_resume_sch_tx,\n\t.h2c_dctl_sec_cam\t= NULL,\n\n\t.btc_set_rfe\t\t= rtw8852a_btc_set_rfe,\n\t.btc_init_cfg\t\t= rtw8852a_btc_init_cfg,\n\t.btc_set_wl_pri\t\t= rtw8852a_btc_set_wl_pri,\n\t.btc_set_wl_txpwr_ctrl\t= rtw8852a_btc_set_wl_txpwr_ctrl,\n\t.btc_get_bt_rssi\t= rtw8852a_btc_get_bt_rssi,\n\t.btc_update_bt_cnt\t= rtw8852a_btc_update_bt_cnt,\n\t.btc_wl_s1_standby\t= rtw8852a_btc_wl_s1_standby,\n\t.btc_set_wl_rx_gain\t= rtw8852a_btc_set_wl_rx_gain,\n\t.btc_set_policy\t\t= rtw89_btc_set_policy,\n};\n\nconst struct rtw89_chip_info rtw8852a_chip_info = {\n\t.chip_id\t\t= RTL8852A,\n\t.chip_gen\t\t= RTW89_CHIP_AX,\n\t.ops\t\t\t= &rtw8852a_chip_ops,\n\t.mac_def\t\t= &rtw89_mac_gen_ax,\n\t.phy_def\t\t= &rtw89_phy_gen_ax,\n\t.fw_basename\t\t= RTW8852A_FW_BASENAME,\n\t.fw_format_max\t\t= RTW8852A_FW_FORMAT_MAX,\n\t.try_ce_fw\t\t= false,\n\t.needed_fw_elms\t\t= 0,\n\t.fifo_size\t\t= 458752,\n\t.small_fifo_size\t= false,\n\t.dle_scc_rsvd_size\t= 0,\n\t.max_amsdu_limit\t= 3500,\n\t.dis_2g_40m_ul_ofdma\t= true,\n\t.rsvd_ple_ofst\t\t= 0x6f800,\n\t.hfc_param_ini\t\t= rtw8852a_hfc_param_ini_pcie,\n\t.dle_mem\t\t= rtw8852a_dle_mem_pcie,\n\t.wde_qempty_acq_num\t= 16,\n\t.wde_qempty_mgq_sel\t= 16,\n\t.rf_base_addr\t\t= {0xc000, 0xd000},\n\t.pwr_on_seq\t\t= pwr_on_seq_8852a,\n\t.pwr_off_seq\t\t= pwr_off_seq_8852a,\n\t.bb_table\t\t= &rtw89_8852a_phy_bb_table,\n\t.bb_gain_table\t\t= NULL,\n\t.rf_table\t\t= {&rtw89_8852a_phy_radioa_table,\n\t\t\t\t   &rtw89_8852a_phy_radiob_table,},\n\t.nctl_table\t\t= &rtw89_8852a_phy_nctl_table,\n\t.nctl_post_table\t= NULL,\n\t.byr_table\t\t= &rtw89_8852a_byr_table,\n\t.dflt_parms\t\t= &rtw89_8852a_dflt_parms,\n\t.rfe_parms_conf\t\t= NULL,\n\t.txpwr_factor_rf\t= 2,\n\t.txpwr_factor_mac\t= 1,\n\t.dig_table\t\t= &rtw89_8852a_phy_dig_table,\n\t.dig_regs\t\t= &rtw8852a_dig_regs,\n\t.tssi_dbw_table\t\t= NULL,\n\t.support_chanctx_num\t= 1,\n\t.support_bands\t\t= BIT(NL80211_BAND_2GHZ) |\n\t\t\t\t  BIT(NL80211_BAND_5GHZ),\n\t.support_bw160\t\t= false,\n\t.support_unii4\t\t= false,\n\t.support_ul_tb_ctrl     = false,\n\t.hw_sec_hdr\t\t= false,\n\t.rf_path_num\t\t= 2,\n\t.tx_nss\t\t\t= 2,\n\t.rx_nss\t\t\t= 2,\n\t.acam_num\t\t= 128,\n\t.bcam_num\t\t= 10,\n\t.scam_num\t\t= 128,\n\t.bacam_num\t\t= 2,\n\t.bacam_dynamic_num\t= 4,\n\t.bacam_ver\t\t= RTW89_BACAM_V0,\n\t.sec_ctrl_efuse_size\t= 4,\n\t.physical_efuse_size\t= 1216,\n\t.logical_efuse_size\t= 1536,\n\t.limit_efuse_size\t= 1152,\n\t.dav_phy_efuse_size\t= 0,\n\t.dav_log_efuse_size\t= 0,\n\t.phycap_addr\t\t= 0x580,\n\t.phycap_size\t\t= 128,\n\t.para_ver\t\t= 0x0,\n\t.wlcx_desired\t\t= 0x06000000,\n\t.btcx_desired\t\t= 0x7,\n\t.scbd\t\t\t= 0x1,\n\t.mailbox\t\t= 0x1,\n\n\t.afh_guard_ch\t\t= 6,\n\t.wl_rssi_thres\t\t= rtw89_btc_8852a_wl_rssi_thres,\n\t.bt_rssi_thres\t\t= rtw89_btc_8852a_bt_rssi_thres,\n\t.rssi_tol\t\t= 2,\n\t.mon_reg_num\t\t= ARRAY_SIZE(rtw89_btc_8852a_mon_reg),\n\t.mon_reg\t\t= rtw89_btc_8852a_mon_reg,\n\t.rf_para_ulink_num\t= ARRAY_SIZE(rtw89_btc_8852a_rf_ul),\n\t.rf_para_ulink\t\t= rtw89_btc_8852a_rf_ul,\n\t.rf_para_dlink_num\t= ARRAY_SIZE(rtw89_btc_8852a_rf_dl),\n\t.rf_para_dlink\t\t= rtw89_btc_8852a_rf_dl,\n\t.ps_mode_supported\t= BIT(RTW89_PS_MODE_RFOFF) |\n\t\t\t\t  BIT(RTW89_PS_MODE_CLK_GATED) |\n\t\t\t\t  BIT(RTW89_PS_MODE_PWR_GATED),\n\t.low_power_hci_modes\t= 0,\n\t.h2c_cctl_func_id\t= H2C_FUNC_MAC_CCTLINFO_UD,\n\t.hci_func_en_addr\t= R_AX_HCI_FUNC_EN,\n\t.h2c_desc_size\t\t= sizeof(struct rtw89_txwd_body),\n\t.txwd_body_size\t\t= sizeof(struct rtw89_txwd_body),\n\t.h2c_ctrl_reg\t\t= R_AX_H2CREG_CTRL,\n\t.h2c_counter_reg\t= {R_AX_UDM1 + 1, B_AX_UDM1_HALMAC_H2C_DEQ_CNT_MASK >> 8},\n\t.h2c_regs\t\t= rtw8852a_h2c_regs,\n\t.c2h_ctrl_reg\t\t= R_AX_C2HREG_CTRL,\n\t.c2h_regs\t\t= rtw8852a_c2h_regs,\n\t.c2h_counter_reg\t= {R_AX_UDM1 + 1, B_AX_UDM1_HALMAC_C2H_ENQ_CNT_MASK >> 8},\n\t.page_regs\t\t= &rtw8852a_page_regs,\n\t.cfo_src_fd\t\t= false,\n\t.cfo_hw_comp            = false,\n\t.dcfo_comp\t\t= &rtw8852a_dcfo_comp,\n\t.dcfo_comp_sft\t\t= 10,\n\t.imr_info\t\t= &rtw8852a_imr_info,\n\t.rrsr_cfgs\t\t= &rtw8852a_rrsr_cfgs,\n\t.bss_clr_map_reg\t= R_BSS_CLR_MAP,\n\t.dma_ch_mask\t\t= 0,\n\t.edcca_lvl_reg\t\t= R_SEG0R_EDCCA_LVL,\n#ifdef CONFIG_PM\n\t.wowlan_stub\t\t= &rtw_wowlan_stub_8852a,\n#endif\n\t.xtal_info\t\t= &rtw8852a_xtal_info,\n};\nEXPORT_SYMBOL(rtw8852a_chip_info);\n\nMODULE_FIRMWARE(RTW8852A_MODULE_FIRMWARE);\nMODULE_AUTHOR(\"Realtek Corporation\");\nMODULE_DESCRIPTION(\"Realtek 802.11ax wireless 8852A driver\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}