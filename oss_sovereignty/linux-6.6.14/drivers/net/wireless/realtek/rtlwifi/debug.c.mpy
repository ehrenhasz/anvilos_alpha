{
  "module_name": "debug.c",
  "hash_id": "345bbf8961feca24ce67712cb73fd0b01dc49923372582e09cb5f1a5b1484e31",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtlwifi/debug.c",
  "human_readable_source": "\n \n\n#include \"wifi.h\"\n#include \"cam.h\"\n\n#include <linux/moduleparam.h>\n#include <linux/vmalloc.h>\n\n#ifdef CONFIG_RTLWIFI_DEBUG\nvoid _rtl_dbg_print(struct rtl_priv *rtlpriv, u64 comp, int level,\n\t\t    const char *fmt, ...)\n{\n\tif (unlikely((comp & rtlpriv->cfg->mod_params->debug_mask) &&\n\t\t     level <= rtlpriv->cfg->mod_params->debug_level)) {\n\t\tstruct va_format vaf;\n\t\tva_list args;\n\n\t\tva_start(args, fmt);\n\n\t\tvaf.fmt = fmt;\n\t\tvaf.va = &args;\n\n\t\tpr_info(\"%pV\", &vaf);\n\n\t\tva_end(args);\n\t}\n}\nEXPORT_SYMBOL_GPL(_rtl_dbg_print);\n\nvoid _rtl_dbg_print_data(struct rtl_priv *rtlpriv, u64 comp, int level,\n\t\t\t const char *titlestring,\n\t\t\t const void *hexdata, int hexdatalen)\n{\n\tif (unlikely(((comp) & rtlpriv->cfg->mod_params->debug_mask) &&\n\t\t     ((level) <= rtlpriv->cfg->mod_params->debug_level))) {\n\t\tpr_info(\"In process \\\"%s\\\" (pid %i): %s\\n\",\n\t\t\tcurrent->comm, current->pid, titlestring);\n\t\tprint_hex_dump_bytes(\"\", DUMP_PREFIX_NONE,\n\t\t\t\t     hexdata, hexdatalen);\n\t}\n}\nEXPORT_SYMBOL_GPL(_rtl_dbg_print_data);\n\nstruct rtl_debugfs_priv {\n\tstruct rtl_priv *rtlpriv;\n\tint (*cb_read)(struct seq_file *m, void *v);\n\tssize_t (*cb_write)(struct file *filp, const char __user *buffer,\n\t\t\t    size_t count, loff_t *loff);\n\tu32 cb_data;\n};\n\nstatic struct dentry *debugfs_topdir;\n\nstatic int rtl_debug_get_common(struct seq_file *m, void *v)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = m->private;\n\n\treturn debugfs_priv->cb_read(m, v);\n}\n\nstatic int dl_debug_open_common(struct inode *inode, struct file *file)\n{\n\treturn single_open(file, rtl_debug_get_common, inode->i_private);\n}\n\nstatic const struct file_operations file_ops_common = {\n\t.open = dl_debug_open_common,\n\t.read = seq_read,\n\t.llseek = seq_lseek,\n\t.release = single_release,\n};\n\nstatic int rtl_debug_get_mac_page(struct seq_file *m, void *v)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = m->private;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\tu32 page = debugfs_priv->cb_data;\n\tint i, n;\n\tint max = 0xff;\n\n\tfor (n = 0; n <= max; ) {\n\t\tseq_printf(m, \"\\n%8.8x  \", n + page);\n\t\tfor (i = 0; i < 4 && n <= max; i++, n += 4)\n\t\t\tseq_printf(m, \"%8.8x    \",\n\t\t\t\t   rtl_read_dword(rtlpriv, (page | n)));\n\t}\n\tseq_puts(m, \"\\n\");\n\treturn 0;\n}\n\n#define RTL_DEBUG_IMPL_MAC_SERIES(page, addr)\t\t\t\\\nstatic struct rtl_debugfs_priv rtl_debug_priv_mac_ ##page = {\t\\\n\t.cb_read = rtl_debug_get_mac_page,\t\t\t\\\n\t.cb_data = addr,\t\t\t\t\t\\\n}\n\nRTL_DEBUG_IMPL_MAC_SERIES(0, 0x0000);\nRTL_DEBUG_IMPL_MAC_SERIES(1, 0x0100);\nRTL_DEBUG_IMPL_MAC_SERIES(2, 0x0200);\nRTL_DEBUG_IMPL_MAC_SERIES(3, 0x0300);\nRTL_DEBUG_IMPL_MAC_SERIES(4, 0x0400);\nRTL_DEBUG_IMPL_MAC_SERIES(5, 0x0500);\nRTL_DEBUG_IMPL_MAC_SERIES(6, 0x0600);\nRTL_DEBUG_IMPL_MAC_SERIES(7, 0x0700);\nRTL_DEBUG_IMPL_MAC_SERIES(10, 0x1000);\nRTL_DEBUG_IMPL_MAC_SERIES(11, 0x1100);\nRTL_DEBUG_IMPL_MAC_SERIES(12, 0x1200);\nRTL_DEBUG_IMPL_MAC_SERIES(13, 0x1300);\nRTL_DEBUG_IMPL_MAC_SERIES(14, 0x1400);\nRTL_DEBUG_IMPL_MAC_SERIES(15, 0x1500);\nRTL_DEBUG_IMPL_MAC_SERIES(16, 0x1600);\nRTL_DEBUG_IMPL_MAC_SERIES(17, 0x1700);\n\nstatic int rtl_debug_get_bb_page(struct seq_file *m, void *v)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = m->private;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\tstruct ieee80211_hw *hw = rtlpriv->hw;\n\tu32 page = debugfs_priv->cb_data;\n\tint i, n;\n\tint max = 0xff;\n\n\tfor (n = 0; n <= max; ) {\n\t\tseq_printf(m, \"\\n%8.8x  \", n + page);\n\t\tfor (i = 0; i < 4 && n <= max; i++, n += 4)\n\t\t\tseq_printf(m, \"%8.8x    \",\n\t\t\t\t   rtl_get_bbreg(hw, (page | n), 0xffffffff));\n\t}\n\tseq_puts(m, \"\\n\");\n\treturn 0;\n}\n\n#define RTL_DEBUG_IMPL_BB_SERIES(page, addr)\t\t\t\\\nstatic struct rtl_debugfs_priv rtl_debug_priv_bb_ ##page = {\t\\\n\t.cb_read = rtl_debug_get_bb_page,\t\t\t\\\n\t.cb_data = addr,\t\t\t\t\t\\\n}\n\nRTL_DEBUG_IMPL_BB_SERIES(8, 0x0800);\nRTL_DEBUG_IMPL_BB_SERIES(9, 0x0900);\nRTL_DEBUG_IMPL_BB_SERIES(a, 0x0a00);\nRTL_DEBUG_IMPL_BB_SERIES(b, 0x0b00);\nRTL_DEBUG_IMPL_BB_SERIES(c, 0x0c00);\nRTL_DEBUG_IMPL_BB_SERIES(d, 0x0d00);\nRTL_DEBUG_IMPL_BB_SERIES(e, 0x0e00);\nRTL_DEBUG_IMPL_BB_SERIES(f, 0x0f00);\nRTL_DEBUG_IMPL_BB_SERIES(18, 0x1800);\nRTL_DEBUG_IMPL_BB_SERIES(19, 0x1900);\nRTL_DEBUG_IMPL_BB_SERIES(1a, 0x1a00);\nRTL_DEBUG_IMPL_BB_SERIES(1b, 0x1b00);\nRTL_DEBUG_IMPL_BB_SERIES(1c, 0x1c00);\nRTL_DEBUG_IMPL_BB_SERIES(1d, 0x1d00);\nRTL_DEBUG_IMPL_BB_SERIES(1e, 0x1e00);\nRTL_DEBUG_IMPL_BB_SERIES(1f, 0x1f00);\n\nstatic int rtl_debug_get_reg_rf(struct seq_file *m, void *v)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = m->private;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\tstruct ieee80211_hw *hw = rtlpriv->hw;\n\tenum radio_path rfpath = debugfs_priv->cb_data;\n\tint i, n;\n\tint max = 0x40;\n\n\tif (IS_HARDWARE_TYPE_8822B(rtlpriv))\n\t\tmax = 0xff;\n\n\tseq_printf(m, \"\\nPATH(%d)\", rfpath);\n\n\tfor (n = 0; n <= max; ) {\n\t\tseq_printf(m, \"\\n%8.8x  \", n);\n\t\tfor (i = 0; i < 4 && n <= max; n += 1, i++)\n\t\t\tseq_printf(m, \"%8.8x    \",\n\t\t\t\t   rtl_get_rfreg(hw, rfpath, n, 0xffffffff));\n\t}\n\tseq_puts(m, \"\\n\");\n\treturn 0;\n}\n\n#define RTL_DEBUG_IMPL_RF_SERIES(page, addr)\t\t\t\\\nstatic struct rtl_debugfs_priv rtl_debug_priv_rf_ ##page = {\t\\\n\t.cb_read = rtl_debug_get_reg_rf,\t\t\t\\\n\t.cb_data = addr,\t\t\t\t\t\\\n}\n\nRTL_DEBUG_IMPL_RF_SERIES(a, RF90_PATH_A);\nRTL_DEBUG_IMPL_RF_SERIES(b, RF90_PATH_B);\n\nstatic int rtl_debug_get_cam_register(struct seq_file *m, void *v)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = m->private;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\tint start = debugfs_priv->cb_data;\n\tu32 target_cmd = 0;\n\tu32 target_val = 0;\n\tu8 entry_i = 0;\n\tu32 ulstatus;\n\tint i = 100, j = 0;\n\tint end = (start + 11 > TOTAL_CAM_ENTRY ? TOTAL_CAM_ENTRY : start + 11);\n\n\t \n\tseq_printf(m,\n\t\t   \"\\n#################### SECURITY CAM (%d-%d) ##################\\n\",\n\t\t   start, end - 1);\n\n\tfor (j = start; j < end; j++) {\n\t\tseq_printf(m, \"\\nD:  %2x > \", j);\n\t\tfor (entry_i = 0; entry_i < CAM_CONTENT_COUNT; entry_i++) {\n\t\t\t \n\t\t\ttarget_cmd = entry_i + CAM_CONTENT_COUNT * j;\n\t\t\ttarget_cmd = target_cmd | BIT(31);\n\n\t\t\t \n\t\t\twhile ((i--) >= 0) {\n\t\t\t\tulstatus =\n\t\t\t\t    rtl_read_dword(rtlpriv,\n\t\t\t\t\t\t   rtlpriv->cfg->maps[RWCAM]);\n\t\t\t\tif (ulstatus & BIT(31))\n\t\t\t\t\tcontinue;\n\t\t\t\telse\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\trtl_write_dword(rtlpriv, rtlpriv->cfg->maps[RWCAM],\n\t\t\t\t\ttarget_cmd);\n\t\t\ttarget_val = rtl_read_dword(rtlpriv,\n\t\t\t\t\t\t    rtlpriv->cfg->maps[RCAMO]);\n\t\t\tseq_printf(m, \"%8.8x \", target_val);\n\t\t}\n\t}\n\tseq_puts(m, \"\\n\");\n\treturn 0;\n}\n\n#define RTL_DEBUG_IMPL_CAM_SERIES(page, addr)\t\t\t\\\nstatic struct rtl_debugfs_priv rtl_debug_priv_cam_ ##page = {\t\\\n\t.cb_read = rtl_debug_get_cam_register,\t\t\t\\\n\t.cb_data = addr,\t\t\t\t\t\\\n}\n\nRTL_DEBUG_IMPL_CAM_SERIES(1, 0);\nRTL_DEBUG_IMPL_CAM_SERIES(2, 11);\nRTL_DEBUG_IMPL_CAM_SERIES(3, 22);\n\nstatic int rtl_debug_get_btcoex(struct seq_file *m, void *v)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = m->private;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\n\tif (rtlpriv->cfg->ops->get_btc_status())\n\t\trtlpriv->btcoexist.btc_ops->btc_display_bt_coex_info(rtlpriv,\n\t\t\t\t\t\t\t\t     m);\n\n\tseq_puts(m, \"\\n\");\n\n\treturn 0;\n}\n\nstatic struct rtl_debugfs_priv rtl_debug_priv_btcoex = {\n\t.cb_read = rtl_debug_get_btcoex,\n\t.cb_data = 0,\n};\n\nstatic ssize_t rtl_debugfs_set_write_reg(struct file *filp,\n\t\t\t\t\t const char __user *buffer,\n\t\t\t\t\t size_t count, loff_t *loff)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = filp->private_data;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\tchar tmp[32 + 1];\n\tint tmp_len;\n\tu32 addr, val, len;\n\tint num;\n\n\tif (count < 3)\n\t\treturn -EFAULT;\n\n\ttmp_len = (count > sizeof(tmp) - 1 ? sizeof(tmp) - 1 : count);\n\n\tif (copy_from_user(tmp, buffer, tmp_len))\n\t\treturn -EFAULT;\n\n\ttmp[tmp_len] = '\\0';\n\n\t \n\tnum = sscanf(tmp, \"%x %x %x\", &addr, &val, &len);\n\n\tif (num !=  3)\n\t\treturn -EINVAL;\n\n\tswitch (len) {\n\tcase 1:\n\t\trtl_write_byte(rtlpriv, addr, (u8)val);\n\t\tbreak;\n\tcase 2:\n\t\trtl_write_word(rtlpriv, addr, (u16)val);\n\t\tbreak;\n\tcase 4:\n\t\trtl_write_dword(rtlpriv, addr, val);\n\t\tbreak;\n\tdefault:\n\t\t \n\t\tbreak;\n\t}\n\n\treturn count;\n}\n\nstatic struct rtl_debugfs_priv rtl_debug_priv_write_reg = {\n\t.cb_write = rtl_debugfs_set_write_reg,\n};\n\nstatic ssize_t rtl_debugfs_set_write_h2c(struct file *filp,\n\t\t\t\t\t const char __user *buffer,\n\t\t\t\t\t size_t count, loff_t *loff)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = filp->private_data;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\tstruct ieee80211_hw *hw = rtlpriv->hw;\n\tchar tmp[32 + 1];\n\tint tmp_len;\n\tu8 h2c_len, h2c_data_packed[8];\n\tint h2c_data[8];\t \n\tint i;\n\n\tif (count < 3)\n\t\treturn -EFAULT;\n\n\ttmp_len = (count > sizeof(tmp) - 1 ? sizeof(tmp) - 1 : count);\n\n\tif (copy_from_user(tmp, buffer, tmp_len))\n\t\treturn -EFAULT;\n\n\ttmp[tmp_len] = '\\0';\n\n\th2c_len = sscanf(tmp, \"%X %X %X %X %X %X %X %X\",\n\t\t\t &h2c_data[0], &h2c_data[1],\n\t\t\t &h2c_data[2], &h2c_data[3],\n\t\t\t &h2c_data[4], &h2c_data[5],\n\t\t\t &h2c_data[6], &h2c_data[7]);\n\n\tif (h2c_len == 0)\n\t\treturn -EINVAL;\n\n\tfor (i = 0; i < h2c_len; i++)\n\t\th2c_data_packed[i] = (u8)h2c_data[i];\n\n\trtlpriv->cfg->ops->fill_h2c_cmd(hw, h2c_data_packed[0],\n\t\t\t\t\th2c_len - 1,\n\t\t\t\t\t&h2c_data_packed[1]);\n\n\treturn count;\n}\n\nstatic struct rtl_debugfs_priv rtl_debug_priv_write_h2c = {\n\t.cb_write = rtl_debugfs_set_write_h2c,\n};\n\nstatic ssize_t rtl_debugfs_set_write_rfreg(struct file *filp,\n\t\t\t\t\t   const char __user *buffer,\n\t\t\t\t\t    size_t count, loff_t *loff)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = filp->private_data;\n\tstruct rtl_priv *rtlpriv = debugfs_priv->rtlpriv;\n\tstruct ieee80211_hw *hw = rtlpriv->hw;\n\tchar tmp[32 + 1];\n\tint tmp_len;\n\tint num;\n\tint path;\n\tu32 addr, bitmask, data;\n\n\tif (count < 3)\n\t\treturn -EFAULT;\n\n\ttmp_len = (count > sizeof(tmp) - 1 ? sizeof(tmp) - 1 : count);\n\n\tif (copy_from_user(tmp, buffer, tmp_len))\n\t\treturn -EFAULT;\n\n\ttmp[tmp_len] = '\\0';\n\n\tnum = sscanf(tmp, \"%X %X %X %X\",\n\t\t     &path, &addr, &bitmask, &data);\n\n\tif (num != 4) {\n\t\trtl_dbg(rtlpriv, COMP_ERR, DBG_DMESG,\n\t\t\t\"Format is <path> <addr> <mask> <data>\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\trtl_set_rfreg(hw, path, addr, bitmask, data);\n\n\treturn count;\n}\n\nstatic struct rtl_debugfs_priv rtl_debug_priv_write_rfreg = {\n\t.cb_write = rtl_debugfs_set_write_rfreg,\n};\n\nstatic int rtl_debugfs_close(struct inode *inode, struct file *filp)\n{\n\treturn 0;\n}\n\nstatic ssize_t rtl_debugfs_common_write(struct file *filp,\n\t\t\t\t\tconst char __user *buffer,\n\t\t\t\t\tsize_t count, loff_t *loff)\n{\n\tstruct rtl_debugfs_priv *debugfs_priv = filp->private_data;\n\n\treturn debugfs_priv->cb_write(filp, buffer, count, loff);\n}\n\nstatic const struct file_operations file_ops_common_write = {\n\t.owner = THIS_MODULE,\n\t.write = rtl_debugfs_common_write,\n\t.open = simple_open,\n\t.release = rtl_debugfs_close,\n};\n\n#define RTL_DEBUGFS_ADD_CORE(name, mode, fopname)\t\t\t   \\\n\tdo {\t\t\t\t\t\t\t\t   \\\n\t\trtl_debug_priv_ ##name.rtlpriv = rtlpriv;\t\t   \\\n\t\tdebugfs_create_file(#name, mode, parent,\t\t   \\\n\t\t\t\t    &rtl_debug_priv_ ##name,\t\t   \\\n\t\t\t\t    &file_ops_ ##fopname);\t\t   \\\n\t} while (0)\n\n#define RTL_DEBUGFS_ADD(name)\t\t\t\t\t\t   \\\n\t\tRTL_DEBUGFS_ADD_CORE(name, S_IFREG | 0444, common)\n#define RTL_DEBUGFS_ADD_W(name)\t\t\t\t\t\t   \\\n\t\tRTL_DEBUGFS_ADD_CORE(name, S_IFREG | 0222, common_write)\n\nvoid rtl_debug_add_one(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_efuse *rtlefuse = rtl_efuse(rtl_priv(hw));\n\tstruct dentry *parent;\n\n\tsnprintf(rtlpriv->dbg.debugfs_name, 18, \"%pMF\", rtlefuse->dev_addr);\n\n\trtlpriv->dbg.debugfs_dir =\n\t\tdebugfs_create_dir(rtlpriv->dbg.debugfs_name, debugfs_topdir);\n\n\tparent = rtlpriv->dbg.debugfs_dir;\n\n\tRTL_DEBUGFS_ADD(mac_0);\n\tRTL_DEBUGFS_ADD(mac_1);\n\tRTL_DEBUGFS_ADD(mac_2);\n\tRTL_DEBUGFS_ADD(mac_3);\n\tRTL_DEBUGFS_ADD(mac_4);\n\tRTL_DEBUGFS_ADD(mac_5);\n\tRTL_DEBUGFS_ADD(mac_6);\n\tRTL_DEBUGFS_ADD(mac_7);\n\tRTL_DEBUGFS_ADD(bb_8);\n\tRTL_DEBUGFS_ADD(bb_9);\n\tRTL_DEBUGFS_ADD(bb_a);\n\tRTL_DEBUGFS_ADD(bb_b);\n\tRTL_DEBUGFS_ADD(bb_c);\n\tRTL_DEBUGFS_ADD(bb_d);\n\tRTL_DEBUGFS_ADD(bb_e);\n\tRTL_DEBUGFS_ADD(bb_f);\n\tRTL_DEBUGFS_ADD(mac_10);\n\tRTL_DEBUGFS_ADD(mac_11);\n\tRTL_DEBUGFS_ADD(mac_12);\n\tRTL_DEBUGFS_ADD(mac_13);\n\tRTL_DEBUGFS_ADD(mac_14);\n\tRTL_DEBUGFS_ADD(mac_15);\n\tRTL_DEBUGFS_ADD(mac_16);\n\tRTL_DEBUGFS_ADD(mac_17);\n\tRTL_DEBUGFS_ADD(bb_18);\n\tRTL_DEBUGFS_ADD(bb_19);\n\tRTL_DEBUGFS_ADD(bb_1a);\n\tRTL_DEBUGFS_ADD(bb_1b);\n\tRTL_DEBUGFS_ADD(bb_1c);\n\tRTL_DEBUGFS_ADD(bb_1d);\n\tRTL_DEBUGFS_ADD(bb_1e);\n\tRTL_DEBUGFS_ADD(bb_1f);\n\tRTL_DEBUGFS_ADD(rf_a);\n\tRTL_DEBUGFS_ADD(rf_b);\n\n\tRTL_DEBUGFS_ADD(cam_1);\n\tRTL_DEBUGFS_ADD(cam_2);\n\tRTL_DEBUGFS_ADD(cam_3);\n\n\tRTL_DEBUGFS_ADD(btcoex);\n\n\tRTL_DEBUGFS_ADD_W(write_reg);\n\tRTL_DEBUGFS_ADD_W(write_h2c);\n\tRTL_DEBUGFS_ADD_W(write_rfreg);\n}\nEXPORT_SYMBOL_GPL(rtl_debug_add_one);\n\nvoid rtl_debug_remove_one(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\tdebugfs_remove_recursive(rtlpriv->dbg.debugfs_dir);\n\trtlpriv->dbg.debugfs_dir = NULL;\n}\nEXPORT_SYMBOL_GPL(rtl_debug_remove_one);\n\nvoid rtl_debugfs_add_topdir(void)\n{\n\tdebugfs_topdir = debugfs_create_dir(\"rtlwifi\", NULL);\n}\n\nvoid rtl_debugfs_remove_topdir(void)\n{\n\tdebugfs_remove_recursive(debugfs_topdir);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}