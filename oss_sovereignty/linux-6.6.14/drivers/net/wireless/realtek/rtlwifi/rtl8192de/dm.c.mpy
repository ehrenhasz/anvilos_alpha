{
  "module_name": "dm.c",
  "hash_id": "f4a2654e8501d3672bacbdc0bca9fa8f05241eeb634c48349f4bfe2ec092a5db",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtlwifi/rtl8192de/dm.c",
  "human_readable_source": "\n \n\n#include \"../wifi.h\"\n#include \"../base.h\"\n#include \"../core.h\"\n#include \"reg.h\"\n#include \"def.h\"\n#include \"phy.h\"\n#include \"dm.h\"\n#include \"fw.h\"\n\n#define UNDEC_SM_PWDB\tentry_min_undec_sm_pwdb\n\nstatic const u32 ofdmswing_table[OFDM_TABLE_SIZE_92D] = {\n\t0x7f8001fe,\t\t \n\t0x788001e2,\t\t \n\t0x71c001c7,\t\t \n\t0x6b8001ae,\t\t \n\t0x65400195,\t\t \n\t0x5fc0017f,\t\t \n\t0x5a400169,\t\t \n\t0x55400155,\t\t \n\t0x50800142,\t\t \n\t0x4c000130,\t\t \n\t0x47c0011f,\t\t \n\t0x43c0010f,\t\t \n\t0x40000100,\t\t \n\t0x3c8000f2,\t\t \n\t0x390000e4,\t\t \n\t0x35c000d7,\t\t \n\t0x32c000cb,\t\t \n\t0x300000c0,\t\t \n\t0x2d4000b5,\t\t \n\t0x2ac000ab,\t\t \n\t0x288000a2,\t\t \n\t0x26000098,\t\t \n\t0x24000090,\t\t \n\t0x22000088,\t\t \n\t0x20000080,\t\t \n\t0x1e400079,\t\t \n\t0x1c800072,\t\t \n\t0x1b00006c,\t\t \n\t0x19800066,\t\t \n\t0x18000060,\t\t \n\t0x16c0005b,\t\t \n\t0x15800056,\t\t \n\t0x14400051,\t\t \n\t0x1300004c,\t\t \n\t0x12000048,\t\t \n\t0x11000044,\t\t \n\t0x10000040,\t\t \n\t0x0f00003c,\t\t \n\t0x0e400039,\t\t \n\t0x0d800036,\t\t \n\t0x0cc00033,\t\t \n\t0x0c000030,\t\t \n\t0x0b40002d,\t\t \n};\n\nstatic const u8 cckswing_table_ch1ch13[CCK_TABLE_SIZE][8] = {\n\t{0x36, 0x35, 0x2e, 0x25, 0x1c, 0x12, 0x09, 0x04},     \n\t{0x33, 0x32, 0x2b, 0x23, 0x1a, 0x11, 0x08, 0x04},     \n\t{0x30, 0x2f, 0x29, 0x21, 0x19, 0x10, 0x08, 0x03},     \n\t{0x2d, 0x2d, 0x27, 0x1f, 0x18, 0x0f, 0x08, 0x03},     \n\t{0x2b, 0x2a, 0x25, 0x1e, 0x16, 0x0e, 0x07, 0x03},     \n\t{0x28, 0x28, 0x22, 0x1c, 0x15, 0x0d, 0x07, 0x03},     \n\t{0x26, 0x25, 0x21, 0x1b, 0x14, 0x0d, 0x06, 0x03},     \n\t{0x24, 0x23, 0x1f, 0x19, 0x13, 0x0c, 0x06, 0x03},     \n\t{0x22, 0x21, 0x1d, 0x18, 0x11, 0x0b, 0x06, 0x02},     \n\t{0x20, 0x20, 0x1b, 0x16, 0x11, 0x08, 0x05, 0x02},     \n\t{0x1f, 0x1e, 0x1a, 0x15, 0x10, 0x0a, 0x05, 0x02},     \n\t{0x1d, 0x1c, 0x18, 0x14, 0x0f, 0x0a, 0x05, 0x02},     \n\t{0x1b, 0x1a, 0x17, 0x13, 0x0e, 0x09, 0x04, 0x02},     \n\t{0x1a, 0x19, 0x16, 0x12, 0x0d, 0x09, 0x04, 0x02},     \n\t{0x18, 0x17, 0x15, 0x11, 0x0c, 0x08, 0x04, 0x02},     \n\t{0x17, 0x16, 0x13, 0x10, 0x0c, 0x08, 0x04, 0x02},     \n\t{0x16, 0x15, 0x12, 0x0f, 0x0b, 0x07, 0x04, 0x01},     \n\t{0x14, 0x14, 0x11, 0x0e, 0x0b, 0x07, 0x03, 0x02},     \n\t{0x13, 0x13, 0x10, 0x0d, 0x0a, 0x06, 0x03, 0x01},     \n\t{0x12, 0x12, 0x0f, 0x0c, 0x09, 0x06, 0x03, 0x01},     \n\t{0x11, 0x11, 0x0f, 0x0c, 0x09, 0x06, 0x03, 0x01},     \n\t{0x10, 0x10, 0x0e, 0x0b, 0x08, 0x05, 0x03, 0x01},     \n\t{0x0f, 0x0f, 0x0d, 0x0b, 0x08, 0x05, 0x03, 0x01},     \n\t{0x0e, 0x0e, 0x0c, 0x0a, 0x08, 0x05, 0x02, 0x01},     \n\t{0x0d, 0x0d, 0x0c, 0x0a, 0x07, 0x05, 0x02, 0x01},     \n\t{0x0d, 0x0c, 0x0b, 0x09, 0x07, 0x04, 0x02, 0x01},     \n\t{0x0c, 0x0c, 0x0a, 0x09, 0x06, 0x04, 0x02, 0x01},     \n\t{0x0b, 0x0b, 0x0a, 0x08, 0x06, 0x04, 0x02, 0x01},     \n\t{0x0b, 0x0a, 0x09, 0x08, 0x06, 0x04, 0x02, 0x01},     \n\t{0x0a, 0x0a, 0x09, 0x07, 0x05, 0x03, 0x02, 0x01},     \n\t{0x0a, 0x09, 0x08, 0x07, 0x05, 0x03, 0x02, 0x01},     \n\t{0x09, 0x09, 0x08, 0x06, 0x05, 0x03, 0x01, 0x01},     \n\t{0x09, 0x08, 0x07, 0x06, 0x04, 0x03, 0x01, 0x01}      \n};\n\nstatic const u8 cckswing_table_ch14[CCK_TABLE_SIZE][8] = {\n\t{0x36, 0x35, 0x2e, 0x1b, 0x00, 0x00, 0x00, 0x00},     \n\t{0x33, 0x32, 0x2b, 0x19, 0x00, 0x00, 0x00, 0x00},     \n\t{0x30, 0x2f, 0x29, 0x18, 0x00, 0x00, 0x00, 0x00},     \n\t{0x2d, 0x2d, 0x17, 0x17, 0x00, 0x00, 0x00, 0x00},     \n\t{0x2b, 0x2a, 0x25, 0x15, 0x00, 0x00, 0x00, 0x00},     \n\t{0x28, 0x28, 0x24, 0x14, 0x00, 0x00, 0x00, 0x00},     \n\t{0x26, 0x25, 0x21, 0x13, 0x00, 0x00, 0x00, 0x00},     \n\t{0x24, 0x23, 0x1f, 0x12, 0x00, 0x00, 0x00, 0x00},     \n\t{0x22, 0x21, 0x1d, 0x11, 0x00, 0x00, 0x00, 0x00},     \n\t{0x20, 0x20, 0x1b, 0x10, 0x00, 0x00, 0x00, 0x00},     \n\t{0x1f, 0x1e, 0x1a, 0x0f, 0x00, 0x00, 0x00, 0x00},     \n\t{0x1d, 0x1c, 0x18, 0x0e, 0x00, 0x00, 0x00, 0x00},     \n\t{0x1b, 0x1a, 0x17, 0x0e, 0x00, 0x00, 0x00, 0x00},     \n\t{0x1a, 0x19, 0x16, 0x0d, 0x00, 0x00, 0x00, 0x00},     \n\t{0x18, 0x17, 0x15, 0x0c, 0x00, 0x00, 0x00, 0x00},     \n\t{0x17, 0x16, 0x13, 0x0b, 0x00, 0x00, 0x00, 0x00},     \n\t{0x16, 0x15, 0x12, 0x0b, 0x00, 0x00, 0x00, 0x00},     \n\t{0x14, 0x14, 0x11, 0x0a, 0x00, 0x00, 0x00, 0x00},     \n\t{0x13, 0x13, 0x10, 0x0a, 0x00, 0x00, 0x00, 0x00},     \n\t{0x12, 0x12, 0x0f, 0x09, 0x00, 0x00, 0x00, 0x00},     \n\t{0x11, 0x11, 0x0f, 0x09, 0x00, 0x00, 0x00, 0x00},     \n\t{0x10, 0x10, 0x0e, 0x08, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0f, 0x0f, 0x0d, 0x08, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0e, 0x0e, 0x0c, 0x07, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0d, 0x0d, 0x0c, 0x07, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0d, 0x0c, 0x0b, 0x06, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0c, 0x0c, 0x0a, 0x06, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0b, 0x0b, 0x0a, 0x06, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0b, 0x0a, 0x09, 0x05, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0a, 0x0a, 0x09, 0x05, 0x00, 0x00, 0x00, 0x00},     \n\t{0x0a, 0x09, 0x08, 0x05, 0x00, 0x00, 0x00, 0x00},     \n\t{0x09, 0x09, 0x08, 0x05, 0x00, 0x00, 0x00, 0x00},     \n\t{0x09, 0x08, 0x07, 0x04, 0x00, 0x00, 0x00, 0x00}      \n};\n\nstatic void rtl92d_dm_false_alarm_counter_statistics(struct ieee80211_hw *hw)\n{\n\tu32 ret_value;\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct false_alarm_statistics *falsealm_cnt = &(rtlpriv->falsealm_cnt);\n\tunsigned long flag = 0;\n\n\t \n\trtl_set_bbreg(hw, ROFDM0_LSTF, BIT(31), 1);  \n\trtl_set_bbreg(hw, ROFDM1_LSTF, BIT(31), 1);  \n\n\tret_value = rtl_get_bbreg(hw, ROFDM0_FRAMESYNC, MASKDWORD);\n\tfalsealm_cnt->cnt_fast_fsync_fail = (ret_value & 0xffff);\n\tfalsealm_cnt->cnt_sb_search_fail = ((ret_value & 0xffff0000) >> 16);\n\tret_value = rtl_get_bbreg(hw, ROFDM_PHYCOUNTER1, MASKDWORD);\n\tfalsealm_cnt->cnt_parity_fail = ((ret_value & 0xffff0000) >> 16);\n\tret_value = rtl_get_bbreg(hw, ROFDM_PHYCOUNTER2, MASKDWORD);\n\tfalsealm_cnt->cnt_rate_illegal = (ret_value & 0xffff);\n\tfalsealm_cnt->cnt_crc8_fail = ((ret_value & 0xffff0000) >> 16);\n\tret_value = rtl_get_bbreg(hw, ROFDM_PHYCOUNTER3, MASKDWORD);\n\tfalsealm_cnt->cnt_mcs_fail = (ret_value & 0xffff);\n\tfalsealm_cnt->cnt_ofdm_fail = falsealm_cnt->cnt_parity_fail +\n\t\t\t\t      falsealm_cnt->cnt_rate_illegal +\n\t\t\t\t      falsealm_cnt->cnt_crc8_fail +\n\t\t\t\t      falsealm_cnt->cnt_mcs_fail +\n\t\t\t\t      falsealm_cnt->cnt_fast_fsync_fail +\n\t\t\t\t      falsealm_cnt->cnt_sb_search_fail;\n\n\tif (rtlpriv->rtlhal.current_bandtype != BAND_ON_5G) {\n\t\t \n\t\trtl92d_acquire_cckandrw_pagea_ctl(hw, &flag);\n\t\tret_value = rtl_get_bbreg(hw, RCCK0_FACOUNTERLOWER, MASKBYTE0);\n\t\tfalsealm_cnt->cnt_cck_fail = ret_value;\n\t\tret_value = rtl_get_bbreg(hw, RCCK0_FACOUNTERUPPER, MASKBYTE3);\n\t\tfalsealm_cnt->cnt_cck_fail += (ret_value & 0xff) << 8;\n\t\trtl92d_release_cckandrw_pagea_ctl(hw, &flag);\n\t} else {\n\t\tfalsealm_cnt->cnt_cck_fail = 0;\n\t}\n\n\t \n\tfalsealm_cnt->cnt_all = falsealm_cnt->cnt_fast_fsync_fail +\n\t\t\t\tfalsealm_cnt->cnt_sb_search_fail +\n\t\t\t\tfalsealm_cnt->cnt_parity_fail +\n\t\t\t\tfalsealm_cnt->cnt_rate_illegal +\n\t\t\t\tfalsealm_cnt->cnt_crc8_fail +\n\t\t\t\tfalsealm_cnt->cnt_mcs_fail +\n\t\t\t\tfalsealm_cnt->cnt_cck_fail;\n\n\trtl_set_bbreg(hw, ROFDM1_LSTF, 0x08000000, 1);\n\t \n\trtl_set_bbreg(hw, ROFDM1_LSTF, 0x08000000, 0);\n\t \n\trtl_set_bbreg(hw, ROFDM0_LSTF, BIT(31), 0);\n\t \n\trtl_set_bbreg(hw, ROFDM1_LSTF, BIT(31), 0);\n\tif (rtlpriv->rtlhal.current_bandtype != BAND_ON_5G) {\n\t\t \n\t\trtl92d_acquire_cckandrw_pagea_ctl(hw, &flag);\n\t\trtl_set_bbreg(hw, RCCK0_FALSEALARMREPORT, 0x0000c000, 0);\n\t\t \n\t\trtl_set_bbreg(hw, RCCK0_FALSEALARMREPORT, 0x0000c000, 2);\n\t\trtl92d_release_cckandrw_pagea_ctl(hw, &flag);\n\t}\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"Cnt_Fast_Fsync_fail = %x, Cnt_SB_Search_fail = %x\\n\",\n\t\tfalsealm_cnt->cnt_fast_fsync_fail,\n\t\tfalsealm_cnt->cnt_sb_search_fail);\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"Cnt_Parity_Fail = %x, Cnt_Rate_Illegal = %x, Cnt_Crc8_fail = %x, Cnt_Mcs_fail = %x\\n\",\n\t\tfalsealm_cnt->cnt_parity_fail,\n\t\tfalsealm_cnt->cnt_rate_illegal,\n\t\tfalsealm_cnt->cnt_crc8_fail,\n\t\tfalsealm_cnt->cnt_mcs_fail);\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"Cnt_Ofdm_fail = %x, Cnt_Cck_fail = %x, Cnt_all = %x\\n\",\n\t\tfalsealm_cnt->cnt_ofdm_fail,\n\t\tfalsealm_cnt->cnt_cck_fail,\n\t\tfalsealm_cnt->cnt_all);\n}\n\nstatic void rtl92d_dm_find_minimum_rssi(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct dig_t *de_digtable = &rtlpriv->dm_digtable;\n\tstruct rtl_mac *mac = rtl_mac(rtlpriv);\n\n\t \n\tif ((mac->link_state < MAC80211_LINKED) &&\n\t    (rtlpriv->dm.UNDEC_SM_PWDB == 0)) {\n\t\tde_digtable->min_undec_pwdb_for_dm = 0;\n\t\trtl_dbg(rtlpriv, COMP_BB_POWERSAVING, DBG_LOUD,\n\t\t\t\"Not connected to any\\n\");\n\t}\n\tif (mac->link_state >= MAC80211_LINKED) {\n\t\tif (mac->opmode == NL80211_IFTYPE_AP ||\n\t\t    mac->opmode == NL80211_IFTYPE_ADHOC) {\n\t\t\tde_digtable->min_undec_pwdb_for_dm =\n\t\t\t    rtlpriv->dm.UNDEC_SM_PWDB;\n\t\t\trtl_dbg(rtlpriv, COMP_BB_POWERSAVING, DBG_LOUD,\n\t\t\t\t\"AP Client PWDB = 0x%lx\\n\",\n\t\t\t\t rtlpriv->dm.UNDEC_SM_PWDB);\n\t\t} else {\n\t\t\tde_digtable->min_undec_pwdb_for_dm =\n\t\t\t    rtlpriv->dm.undec_sm_pwdb;\n\t\t\trtl_dbg(rtlpriv, COMP_BB_POWERSAVING, DBG_LOUD,\n\t\t\t\t\"STA Default Port PWDB = 0x%x\\n\",\n\t\t\t\tde_digtable->min_undec_pwdb_for_dm);\n\t\t}\n\t} else {\n\t\tde_digtable->min_undec_pwdb_for_dm = rtlpriv->dm.UNDEC_SM_PWDB;\n\t\trtl_dbg(rtlpriv, COMP_BB_POWERSAVING, DBG_LOUD,\n\t\t\t\"AP Ext Port or disconnect PWDB = 0x%x\\n\",\n\t\t\tde_digtable->min_undec_pwdb_for_dm);\n\t}\n\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"MinUndecoratedPWDBForDM =%d\\n\",\n\t\tde_digtable->min_undec_pwdb_for_dm);\n}\n\nstatic void rtl92d_dm_cck_packet_detection_thresh(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct dig_t *de_digtable = &rtlpriv->dm_digtable;\n\tunsigned long flag = 0;\n\n\tif (de_digtable->cursta_cstate == DIG_STA_CONNECT) {\n\t\tif (de_digtable->pre_cck_pd_state == CCK_PD_STAGE_LOWRSSI) {\n\t\t\tif (de_digtable->min_undec_pwdb_for_dm <= 25)\n\t\t\t\tde_digtable->cur_cck_pd_state =\n\t\t\t\t\t\t\t CCK_PD_STAGE_LOWRSSI;\n\t\t\telse\n\t\t\t\tde_digtable->cur_cck_pd_state =\n\t\t\t\t\t\t\t CCK_PD_STAGE_HIGHRSSI;\n\t\t} else {\n\t\t\tif (de_digtable->min_undec_pwdb_for_dm <= 20)\n\t\t\t\tde_digtable->cur_cck_pd_state =\n\t\t\t\t\t\t\t CCK_PD_STAGE_LOWRSSI;\n\t\t\telse\n\t\t\t\tde_digtable->cur_cck_pd_state =\n\t\t\t\t\t\t\t CCK_PD_STAGE_HIGHRSSI;\n\t\t}\n\t} else {\n\t\tde_digtable->cur_cck_pd_state = CCK_PD_STAGE_LOWRSSI;\n\t}\n\tif (de_digtable->pre_cck_pd_state != de_digtable->cur_cck_pd_state) {\n\t\tif (de_digtable->cur_cck_pd_state == CCK_PD_STAGE_LOWRSSI) {\n\t\t\trtl92d_acquire_cckandrw_pagea_ctl(hw, &flag);\n\t\t\trtl_set_bbreg(hw, RCCK0_CCA, MASKBYTE2, 0x83);\n\t\t\trtl92d_release_cckandrw_pagea_ctl(hw, &flag);\n\t\t} else {\n\t\t\trtl92d_acquire_cckandrw_pagea_ctl(hw, &flag);\n\t\t\trtl_set_bbreg(hw, RCCK0_CCA, MASKBYTE2, 0xcd);\n\t\t\trtl92d_release_cckandrw_pagea_ctl(hw, &flag);\n\t\t}\n\t\tde_digtable->pre_cck_pd_state = de_digtable->cur_cck_pd_state;\n\t}\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"CurSTAConnectState=%s\\n\",\n\t\tde_digtable->cursta_cstate == DIG_STA_CONNECT ?\n\t\t\"DIG_STA_CONNECT \" : \"DIG_STA_DISCONNECT\");\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"CCKPDStage=%s\\n\",\n\t\tde_digtable->cur_cck_pd_state == CCK_PD_STAGE_LOWRSSI ?\n\t\t\"Low RSSI \" : \"High RSSI \");\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"is92d single phy =%x\\n\",\n\t\tIS_92D_SINGLEPHY(rtlpriv->rtlhal.version));\n\n}\n\nvoid rtl92d_dm_write_dig(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct dig_t *de_digtable = &rtlpriv->dm_digtable;\n\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"cur_igvalue = 0x%x, pre_igvalue = 0x%x, back_val = %d\\n\",\n\t\tde_digtable->cur_igvalue, de_digtable->pre_igvalue,\n\t\tde_digtable->back_val);\n\tif (de_digtable->dig_enable_flag == false) {\n\t\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"DIG is disabled\\n\");\n\t\tde_digtable->pre_igvalue = 0x17;\n\t\treturn;\n\t}\n\tif (de_digtable->pre_igvalue != de_digtable->cur_igvalue) {\n\t\trtl_set_bbreg(hw, ROFDM0_XAAGCCORE1, 0x7f,\n\t\t\t      de_digtable->cur_igvalue);\n\t\trtl_set_bbreg(hw, ROFDM0_XBAGCCORE1, 0x7f,\n\t\t\t      de_digtable->cur_igvalue);\n\t\tde_digtable->pre_igvalue = de_digtable->cur_igvalue;\n\t}\n}\n\nstatic void rtl92d_early_mode_enabled(struct rtl_priv *rtlpriv)\n{\n\tstruct dig_t *de_digtable = &rtlpriv->dm_digtable;\n\n\tif ((rtlpriv->mac80211.link_state >= MAC80211_LINKED) &&\n\t    (rtlpriv->mac80211.vendor == PEER_CISCO)) {\n\t\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"IOT_PEER = CISCO\\n\");\n\t\tif (de_digtable->last_min_undec_pwdb_for_dm >= 50\n\t\t    && de_digtable->min_undec_pwdb_for_dm < 50) {\n\t\t\trtl_write_byte(rtlpriv, REG_EARLY_MODE_CONTROL, 0x00);\n\t\t\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\t\t\"Early Mode Off\\n\");\n\t\t} else if (de_digtable->last_min_undec_pwdb_for_dm <= 55 &&\n\t\t\t   de_digtable->min_undec_pwdb_for_dm > 55) {\n\t\t\trtl_write_byte(rtlpriv, REG_EARLY_MODE_CONTROL, 0x0f);\n\t\t\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\t\t\"Early Mode On\\n\");\n\t\t}\n\t} else if (!(rtl_read_byte(rtlpriv, REG_EARLY_MODE_CONTROL) & 0xf)) {\n\t\trtl_write_byte(rtlpriv, REG_EARLY_MODE_CONTROL, 0x0f);\n\t\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"Early Mode On\\n\");\n\t}\n}\n\nstatic void rtl92d_dm_dig(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct dig_t *de_digtable = &rtlpriv->dm_digtable;\n\tu8 value_igi = de_digtable->cur_igvalue;\n\tstruct false_alarm_statistics *falsealm_cnt = &(rtlpriv->falsealm_cnt);\n\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"==>\\n\");\n\tif (rtlpriv->rtlhal.earlymode_enable) {\n\t\trtl92d_early_mode_enabled(rtlpriv);\n\t\tde_digtable->last_min_undec_pwdb_for_dm =\n\t\t\t\t de_digtable->min_undec_pwdb_for_dm;\n\t}\n\tif (!rtlpriv->dm.dm_initialgain_enable)\n\t\treturn;\n\n\t \n\t \n\n\t \n\tif (rtlpriv->mac80211.opmode != NL80211_IFTYPE_STATION)\n\t\treturn;\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"progress\\n\");\n\t \n\tif (rtlpriv->mac80211.link_state >= MAC80211_LINKED)\n\t\tde_digtable->cursta_cstate = DIG_STA_CONNECT;\n\telse\n\t\tde_digtable->cursta_cstate = DIG_STA_DISCONNECT;\n\n\t \n\tif (falsealm_cnt->cnt_all < DM_DIG_FA_TH0)\n\t\tvalue_igi--;\n\telse if (falsealm_cnt->cnt_all < DM_DIG_FA_TH1)\n\t\tvalue_igi += 0;\n\telse if (falsealm_cnt->cnt_all < DM_DIG_FA_TH2)\n\t\tvalue_igi++;\n\telse if (falsealm_cnt->cnt_all >= DM_DIG_FA_TH2)\n\t\tvalue_igi += 2;\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"dm_DIG() Before: large_fa_hit=%d, forbidden_igi=%x\\n\",\n\t\tde_digtable->large_fa_hit, de_digtable->forbidden_igi);\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"dm_DIG() Before: Recover_cnt=%d, rx_gain_min=%x\\n\",\n\t\tde_digtable->recover_cnt, de_digtable->rx_gain_min);\n\n\t \n\tif (falsealm_cnt->cnt_all > 10000) {\n\t\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\t\"dm_DIG(): Abnormally false alarm case\\n\");\n\n\t\tde_digtable->large_fa_hit++;\n\t\tif (de_digtable->forbidden_igi < de_digtable->cur_igvalue) {\n\t\t\tde_digtable->forbidden_igi = de_digtable->cur_igvalue;\n\t\t\tde_digtable->large_fa_hit = 1;\n\t\t}\n\t\tif (de_digtable->large_fa_hit >= 3) {\n\t\t\tif ((de_digtable->forbidden_igi + 1) > DM_DIG_MAX)\n\t\t\t\tde_digtable->rx_gain_min = DM_DIG_MAX;\n\t\t\telse\n\t\t\t\tde_digtable->rx_gain_min =\n\t\t\t\t    (de_digtable->forbidden_igi + 1);\n\t\t\tde_digtable->recover_cnt = 3600;\t \n\t\t}\n\t} else {\n\t\t \n\t\tif (de_digtable->recover_cnt != 0) {\n\t\t\tde_digtable->recover_cnt--;\n\t\t} else {\n\t\t\tif (de_digtable->large_fa_hit == 0) {\n\t\t\t\tif ((de_digtable->forbidden_igi - 1) <\n\t\t\t\t    DM_DIG_FA_LOWER) {\n\t\t\t\t\tde_digtable->forbidden_igi =\n\t\t\t\t\t\t\t DM_DIG_FA_LOWER;\n\t\t\t\t\tde_digtable->rx_gain_min =\n\t\t\t\t\t\t\t DM_DIG_FA_LOWER;\n\n\t\t\t\t} else {\n\t\t\t\t\tde_digtable->forbidden_igi--;\n\t\t\t\t\tde_digtable->rx_gain_min =\n\t\t\t\t\t    (de_digtable->forbidden_igi + 1);\n\t\t\t\t}\n\t\t\t} else if (de_digtable->large_fa_hit == 3) {\n\t\t\t\tde_digtable->large_fa_hit = 0;\n\t\t\t}\n\t\t}\n\t}\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"dm_DIG() After: large_fa_hit=%d, forbidden_igi=%x\\n\",\n\t\tde_digtable->large_fa_hit, de_digtable->forbidden_igi);\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD,\n\t\t\"dm_DIG() After: recover_cnt=%d, rx_gain_min=%x\\n\",\n\t\tde_digtable->recover_cnt, de_digtable->rx_gain_min);\n\n\tif (value_igi > DM_DIG_MAX)\n\t\tvalue_igi = DM_DIG_MAX;\n\telse if (value_igi < de_digtable->rx_gain_min)\n\t\tvalue_igi = de_digtable->rx_gain_min;\n\tde_digtable->cur_igvalue = value_igi;\n\trtl92d_dm_write_dig(hw);\n\tif (rtlpriv->rtlhal.current_bandtype != BAND_ON_5G)\n\t\trtl92d_dm_cck_packet_detection_thresh(hw);\n\trtl_dbg(rtlpriv, COMP_DIG, DBG_LOUD, \"<<==\\n\");\n}\n\nstatic void rtl92d_dm_init_dynamic_txpower(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\trtlpriv->dm.dynamic_txpower_enable = true;\n\trtlpriv->dm.last_dtp_lvl = TXHIGHPWRLEVEL_NORMAL;\n\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_NORMAL;\n}\n\nstatic void rtl92d_dm_dynamic_txpower(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tstruct rtl_hal *rtlhal = rtl_hal(rtlpriv);\n\tstruct rtl_mac *mac = rtl_mac(rtl_priv(hw));\n\tlong undec_sm_pwdb;\n\n\tif ((!rtlpriv->dm.dynamic_txpower_enable)\n\t    || rtlpriv->dm.dm_flag & HAL_DM_HIPWR_DISABLE) {\n\t\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_NORMAL;\n\t\treturn;\n\t}\n\tif ((mac->link_state < MAC80211_LINKED) &&\n\t    (rtlpriv->dm.UNDEC_SM_PWDB == 0)) {\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_TRACE,\n\t\t\t\"Not connected to any\\n\");\n\t\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_NORMAL;\n\t\trtlpriv->dm.last_dtp_lvl = TXHIGHPWRLEVEL_NORMAL;\n\t\treturn;\n\t}\n\tif (mac->link_state >= MAC80211_LINKED) {\n\t\tif (mac->opmode == NL80211_IFTYPE_ADHOC) {\n\t\t\tundec_sm_pwdb =\n\t\t\t    rtlpriv->dm.UNDEC_SM_PWDB;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\t\"IBSS Client PWDB = 0x%lx\\n\",\n\t\t\t\tundec_sm_pwdb);\n\t\t} else {\n\t\t\tundec_sm_pwdb =\n\t\t\t    rtlpriv->dm.undec_sm_pwdb;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\t\"STA Default Port PWDB = 0x%lx\\n\",\n\t\t\t\tundec_sm_pwdb);\n\t\t}\n\t} else {\n\t\tundec_sm_pwdb =\n\t\t    rtlpriv->dm.UNDEC_SM_PWDB;\n\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\"AP Ext Port PWDB = 0x%lx\\n\",\n\t\t\tundec_sm_pwdb);\n\t}\n\tif (rtlhal->current_bandtype == BAND_ON_5G) {\n\t\tif (undec_sm_pwdb >= 0x33) {\n\t\t\trtlpriv->dm.dynamic_txhighpower_lvl =\n\t\t\t\t\t\t TXHIGHPWRLEVEL_LEVEL2;\n\t\t\trtl_dbg(rtlpriv, COMP_HIPWR, DBG_LOUD,\n\t\t\t\t\"5G:TxHighPwrLevel_Level2 (TxPwr=0x0)\\n\");\n\t\t} else if ((undec_sm_pwdb < 0x33)\n\t\t\t   && (undec_sm_pwdb >= 0x2b)) {\n\t\t\trtlpriv->dm.dynamic_txhighpower_lvl =\n\t\t\t\t\t\t TXHIGHPWRLEVEL_LEVEL1;\n\t\t\trtl_dbg(rtlpriv, COMP_HIPWR, DBG_LOUD,\n\t\t\t\t\"5G:TxHighPwrLevel_Level1 (TxPwr=0x10)\\n\");\n\t\t} else if (undec_sm_pwdb < 0x2b) {\n\t\t\trtlpriv->dm.dynamic_txhighpower_lvl =\n\t\t\t\t\t\t TXHIGHPWRLEVEL_NORMAL;\n\t\t\trtl_dbg(rtlpriv, COMP_HIPWR, DBG_LOUD,\n\t\t\t\t\"5G:TxHighPwrLevel_Normal\\n\");\n\t\t}\n\t} else {\n\t\tif (undec_sm_pwdb >=\n\t\t    TX_POWER_NEAR_FIELD_THRESH_LVL2) {\n\t\t\trtlpriv->dm.dynamic_txhighpower_lvl =\n\t\t\t\t\t\t TXHIGHPWRLEVEL_LEVEL2;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\t\"TXHIGHPWRLEVEL_LEVEL1 (TxPwr=0x0)\\n\");\n\t\t} else\n\t\t    if ((undec_sm_pwdb <\n\t\t\t (TX_POWER_NEAR_FIELD_THRESH_LVL2 - 3))\n\t\t\t&& (undec_sm_pwdb >=\n\t\t\t    TX_POWER_NEAR_FIELD_THRESH_LVL1)) {\n\n\t\t\trtlpriv->dm.dynamic_txhighpower_lvl =\n\t\t\t\t\t\t TXHIGHPWRLEVEL_LEVEL1;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\t\"TXHIGHPWRLEVEL_LEVEL1 (TxPwr=0x10)\\n\");\n\t\t} else if (undec_sm_pwdb <\n\t\t\t   (TX_POWER_NEAR_FIELD_THRESH_LVL1 - 5)) {\n\t\t\trtlpriv->dm.dynamic_txhighpower_lvl =\n\t\t\t\t\t\t TXHIGHPWRLEVEL_NORMAL;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\t\"TXHIGHPWRLEVEL_NORMAL\\n\");\n\t\t}\n\t}\n\tif ((rtlpriv->dm.dynamic_txhighpower_lvl != rtlpriv->dm.last_dtp_lvl)) {\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\"PHY_SetTxPowerLevel8192S() Channel = %d\\n\",\n\t\t\trtlphy->current_channel);\n\t\trtl92d_phy_set_txpower_level(hw, rtlphy->current_channel);\n\t}\n\trtlpriv->dm.last_dtp_lvl = rtlpriv->dm.dynamic_txhighpower_lvl;\n}\n\nstatic void rtl92d_dm_pwdb_monitor(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\t \n\tif (rtlpriv->mac80211.opmode != NL80211_IFTYPE_STATION)\n\t\treturn;\n\t \n\tif (rtlpriv->dm.useramask) {\n\t\tu32 temp = rtlpriv->dm.undec_sm_pwdb;\n\n\t\ttemp <<= 16;\n\t\ttemp |= 0x100;\n\t\t \n\t\trtl92d_fill_h2c_cmd(hw, H2C_RSSI_REPORT, 3, (u8 *) (&temp));\n\t} else {\n\t\trtl_write_byte(rtlpriv, 0x4fe,\n\t\t\t       (u8) rtlpriv->dm.undec_sm_pwdb);\n\t}\n}\n\nvoid rtl92d_dm_init_edca_turbo(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\trtlpriv->dm.current_turbo_edca = false;\n\trtlpriv->dm.is_any_nonbepkts = false;\n\trtlpriv->dm.is_cur_rdlstate = false;\n}\n\nstatic void rtl92d_dm_check_edca_turbo(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_mac *mac = rtl_mac(rtl_priv(hw));\n\tstatic u64 last_txok_cnt;\n\tstatic u64 last_rxok_cnt;\n\tu64 cur_txok_cnt;\n\tu64 cur_rxok_cnt;\n\tu32 edca_be_ul = 0x5ea42b;\n\tu32 edca_be_dl = 0x5ea42b;\n\n\tif (mac->link_state != MAC80211_LINKED) {\n\t\trtlpriv->dm.current_turbo_edca = false;\n\t\tgoto exit;\n\t}\n\n\t \n\t \n\tif ((!rtlpriv->dm.disable_framebursting) &&\n\t    (rtlpriv->sec.pairwise_enc_algorithm == WEP40_ENCRYPTION ||\n\t    rtlpriv->sec.pairwise_enc_algorithm == WEP104_ENCRYPTION ||\n\t    rtlpriv->sec.pairwise_enc_algorithm == TKIP_ENCRYPTION)) {\n\t\t \n\t\tif (!(edca_be_ul & 0xffff0000))\n\t\t\tedca_be_ul |= 0x005e0000;\n\t\t \n\t\tif (!(edca_be_dl & 0xffff0000))\n\t\t\tedca_be_dl |= 0x005e0000;\n\t}\n\n\tif ((!rtlpriv->dm.is_any_nonbepkts) &&\n\t    (!rtlpriv->dm.disable_framebursting)) {\n\t\tcur_txok_cnt = rtlpriv->stats.txbytesunicast - last_txok_cnt;\n\t\tcur_rxok_cnt = rtlpriv->stats.rxbytesunicast - last_rxok_cnt;\n\t\tif (cur_rxok_cnt > 4 * cur_txok_cnt) {\n\t\t\tif (!rtlpriv->dm.is_cur_rdlstate ||\n\t\t\t    !rtlpriv->dm.current_turbo_edca) {\n\t\t\t\trtl_write_dword(rtlpriv, REG_EDCA_BE_PARAM,\n\t\t\t\t\t\tedca_be_dl);\n\t\t\t\trtlpriv->dm.is_cur_rdlstate = true;\n\t\t\t}\n\t\t} else {\n\t\t\tif (rtlpriv->dm.is_cur_rdlstate ||\n\t\t\t    !rtlpriv->dm.current_turbo_edca) {\n\t\t\t\trtl_write_dword(rtlpriv, REG_EDCA_BE_PARAM,\n\t\t\t\t\t\tedca_be_ul);\n\t\t\t\trtlpriv->dm.is_cur_rdlstate = false;\n\t\t\t}\n\t\t}\n\t\trtlpriv->dm.current_turbo_edca = true;\n\t} else {\n\t\tif (rtlpriv->dm.current_turbo_edca) {\n\t\t\tu8 tmp = AC0_BE;\n\t\t\trtlpriv->cfg->ops->set_hw_reg(hw, HW_VAR_AC_PARAM,\n\t\t\t\t\t\t      &tmp);\n\t\t\trtlpriv->dm.current_turbo_edca = false;\n\t\t}\n\t}\n\nexit:\n\trtlpriv->dm.is_any_nonbepkts = false;\n\tlast_txok_cnt = rtlpriv->stats.txbytesunicast;\n\tlast_rxok_cnt = rtlpriv->stats.rxbytesunicast;\n}\n\nstatic void rtl92d_dm_rxgain_tracking_thermalmeter(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tu8 index_mapping[RX_INDEX_MAPPING_NUM] = {\n\t\t0x0f, 0x0f, 0x0d, 0x0c, 0x0b,\n\t\t0x0a, 0x09, 0x08, 0x07, 0x06,\n\t\t0x05, 0x04, 0x04, 0x03, 0x02\n\t};\n\tint i;\n\tu32 u4tmp;\n\n\tu4tmp = (index_mapping[(rtlpriv->efuse.eeprom_thermalmeter -\n\t\t\t\trtlpriv->dm.thermalvalue_rxgain)]) << 12;\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\"===> Rx Gain %x\\n\", u4tmp);\n\tfor (i = RF90_PATH_A; i < rtlpriv->phy.num_total_rfpath; i++)\n\t\trtl_set_rfreg(hw, i, 0x3C, RFREG_OFFSET_MASK,\n\t\t\t      (rtlpriv->phy.reg_rf3c[i] & (~(0xF000))) | u4tmp);\n}\n\nstatic void rtl92d_bandtype_2_4G(struct ieee80211_hw *hw, long *temp_cckg,\n\t\t\t\t u8 *cck_index_old)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tint i;\n\tunsigned long flag = 0;\n\tlong temp_cck;\n\tconst u8 *cckswing;\n\n\t \n\trtl92d_acquire_cckandrw_pagea_ctl(hw, &flag);\n\ttemp_cck = rtl_get_bbreg(hw, RCCK0_TXFILTER2,\n\t\t\t\t MASKDWORD) & MASKCCK;\n\trtl92d_release_cckandrw_pagea_ctl(hw, &flag);\n\tfor (i = 0; i < CCK_TABLE_LENGTH; i++) {\n\t\tif (rtlpriv->dm.cck_inch14)\n\t\t\tcckswing = &cckswing_table_ch14[i][2];\n\t\telse\n\t\t\tcckswing = &cckswing_table_ch1ch13[i][2];\n\n\t\tif (temp_cck == le32_to_cpu(*((__le32 *)cckswing))) {\n\t\t\t*cck_index_old = (u8)i;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\t\"Initial reg0x%x = 0x%lx, cck_index = 0x%x, ch14 %d\\n\",\n\t\t\t\tRCCK0_TXFILTER2, temp_cck,\n\t\t\t\t*cck_index_old,\n\t\t\t\trtlpriv->dm.cck_inch14);\n\t\t\tbreak;\n\t\t}\n\t}\n\t*temp_cckg = temp_cck;\n}\n\nstatic void rtl92d_bandtype_5G(struct rtl_hal *rtlhal, u8 *ofdm_index,\n\t\t\t       bool *internal_pa, u8 thermalvalue, u8 delta,\n\t\t\t       u8 rf, struct rtl_efuse *rtlefuse,\n\t\t\t       struct rtl_priv *rtlpriv, struct rtl_phy *rtlphy,\n\t\t\t       const u8 index_mapping[5][INDEX_MAPPING_NUM],\n\t\t\t       const u8 index_mapping_pa[8][INDEX_MAPPING_NUM])\n{\n\tint i;\n\tu8 index;\n\tu8 offset = 0;\n\n\tfor (i = 0; i < rf; i++) {\n\t\tif (rtlhal->macphymode == DUALMAC_DUALPHY &&\n\t\t    rtlhal->interfaceindex == 1)\t \n\t\t\t*internal_pa = rtlefuse->internal_pa_5g[1];\n\t\telse\n\t\t\t*internal_pa = rtlefuse->internal_pa_5g[i];\n\t\tif (*internal_pa) {\n\t\t\tif (rtlhal->interfaceindex == 1 || i == rf)\n\t\t\t\toffset = 4;\n\t\t\telse\n\t\t\t\toffset = 0;\n\t\t\tif (rtlphy->current_channel >= 100 &&\n\t\t\t\trtlphy->current_channel <= 165)\n\t\t\t\toffset += 2;\n\t\t} else {\n\t\t\tif (rtlhal->interfaceindex == 1 || i == rf)\n\t\t\t\toffset = 2;\n\t\t\telse\n\t\t\t\toffset = 0;\n\t\t}\n\t\tif (thermalvalue > rtlefuse->eeprom_thermalmeter)\n\t\t\toffset++;\n\t\tif (*internal_pa) {\n\t\t\tif (delta > INDEX_MAPPING_NUM - 1)\n\t\t\t\tindex = index_mapping_pa[offset]\n\t\t\t\t\t\t    [INDEX_MAPPING_NUM - 1];\n\t\t\telse\n\t\t\t\tindex =\n\t\t\t\t     index_mapping_pa[offset][delta];\n\t\t} else {\n\t\t\tif (delta > INDEX_MAPPING_NUM - 1)\n\t\t\t\tindex =\n\t\t\t\t   index_mapping[offset][INDEX_MAPPING_NUM - 1];\n\t\t\telse\n\t\t\t\tindex = index_mapping[offset][delta];\n\t\t}\n\t\tif (thermalvalue > rtlefuse->eeprom_thermalmeter) {\n\t\t\tif (*internal_pa && thermalvalue > 0x12) {\n\t\t\t\tofdm_index[i] = rtlpriv->dm.ofdm_index[i] -\n\t\t\t\t\t\t((delta / 2) * 3 + (delta % 2));\n\t\t\t} else {\n\t\t\t\tofdm_index[i] -= index;\n\t\t\t}\n\t\t} else {\n\t\t\tofdm_index[i] += index;\n\t\t}\n\t}\n}\n\nstatic void rtl92d_dm_txpower_tracking_callback_thermalmeter(\n\t\t\tstruct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_hal *rtlhal = rtl_hal(rtl_priv(hw));\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tstruct rtl_efuse *rtlefuse = rtl_efuse(rtl_priv(hw));\n\tu8 thermalvalue, delta, delta_lck, delta_iqk, delta_rxgain;\n\tu8 offset, thermalvalue_avg_count = 0;\n\tu32 thermalvalue_avg = 0;\n\tbool internal_pa = false;\n\tlong ele_a = 0, ele_d, temp_cck, val_x, value32;\n\tlong val_y, ele_c = 0;\n\tu8 ofdm_index[2];\n\ts8 cck_index = 0;\n\tu8 ofdm_index_old[2] = {0, 0};\n\ts8 cck_index_old = 0;\n\tu8 index;\n\tint i;\n\tbool is2t = IS_92D_SINGLEPHY(rtlhal->version);\n\tu8 ofdm_min_index = 6, ofdm_min_index_internal_pa = 3, rf;\n\tu8 indexforchannel =\n\t    rtl92d_get_rightchnlplace_for_iqk(rtlphy->current_channel);\n\tstatic const u8 index_mapping[5][INDEX_MAPPING_NUM] = {\n\t\t \n\t\t{0, 1, 3, 6, 8, 9,\t11, 13, 14, 16, 17, 18, 18},\n\t\t \n\t\t{0, 2, 4, 5, 7, 10,\t12, 14, 16, 18, 18, 18, 18},\n\t\t \n\t\t{0, 2, 3, 6, 8, 9,\t11, 13, 14, 16, 17, 18, 18},\n\t\t \n\t\t{0, 2, 4, 5, 7, 10,\t13, 16, 16, 18, 18, 18, 18},\n\t\t \n\t\t{0, 1, 2, 3, 4, 5,\t6, 7, 7, 8, 9, 10, 10},\n\t};\n\tstatic const u8 index_mapping_internal_pa[8][INDEX_MAPPING_NUM] = {\n\t\t \n\t\t{0, 1, 2, 4, 6, 7,\t9, 11, 12, 14, 15, 16, 16},\n\t\t \n\t\t{0, 2, 4, 5, 7, 10,\t12, 14, 16, 18, 18, 18, 18},\n\t\t \n\t\t{0, 1, 2, 3, 5, 6,\t8, 10, 11, 13, 14, 15, 15},\n\t\t \n\t\t{0, 2, 4, 5, 7, 10,\t12, 14, 16, 18, 18, 18, 18},\n\t\t \n\t\t{0, 1, 2, 4, 6, 7,\t9, 11, 12, 14, 15, 16, 16},\n\t\t \n\t\t{0, 2, 4, 5, 7, 10,\t13, 16, 16, 18, 18, 18, 18},\n\t\t \n\t\t{0, 1, 2, 3, 5, 6,\t8, 9, 10, 12, 13, 14, 14},\n\t\t \n\t\t{0, 2, 4, 5, 7, 10,\t13, 16, 16, 18, 18, 18, 18},\n\t};\n\n\trtlpriv->dm.txpower_trackinginit = true;\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD, \"\\n\");\n\tthermalvalue = (u8) rtl_get_rfreg(hw, RF90_PATH_A, RF_T_METER, 0xf800);\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\"Readback Thermal Meter = 0x%x pre thermal meter 0x%x eeprom_thermalmeter 0x%x\\n\",\n\t\tthermalvalue,\n\t\trtlpriv->dm.thermalvalue, rtlefuse->eeprom_thermalmeter);\n\trtl92d_phy_ap_calibrate(hw, (thermalvalue -\n\t\t\t\t     rtlefuse->eeprom_thermalmeter));\n\n\tif (!thermalvalue)\n\t\tgoto exit;\n\n\tif (is2t)\n\t\trf = 2;\n\telse\n\t\trf = 1;\n\n\tif (rtlpriv->dm.thermalvalue && !rtlhal->reloadtxpowerindex)\n\t\tgoto old_index_done;\n\n\tele_d = rtl_get_bbreg(hw, ROFDM0_XATXIQIMBALANCE,  MASKDWORD) & MASKOFDM_D;\n\tfor (i = 0; i < OFDM_TABLE_SIZE_92D; i++) {\n\t\tif (ele_d == (ofdmswing_table[i] & MASKOFDM_D)) {\n\t\t\tofdm_index_old[0] = (u8)i;\n\n\t\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\t\"Initial pathA ele_d reg0x%x = 0x%lx, ofdm_index=0x%x\\n\",\n\t\t\t\tROFDM0_XATXIQIMBALANCE,\n\t\t\t\tele_d, ofdm_index_old[0]);\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (is2t) {\n\t\tele_d = rtl_get_bbreg(hw, ROFDM0_XBTXIQIMBALANCE,\n\t\t\t\t      MASKDWORD) & MASKOFDM_D;\n\t\tfor (i = 0; i < OFDM_TABLE_SIZE_92D; i++) {\n\t\t\tif (ele_d ==\n\t\t\t    (ofdmswing_table[i] & MASKOFDM_D)) {\n\t\t\t\tofdm_index_old[1] = (u8)i;\n\t\t\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING,\n\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\"Initial pathB ele_d reg 0x%x = 0x%lx, ofdm_index = 0x%x\\n\",\n\t\t\t\t\tROFDM0_XBTXIQIMBALANCE, ele_d,\n\t\t\t\t\tofdm_index_old[1]);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (rtlhal->current_bandtype == BAND_ON_2_4G) {\n\t\trtl92d_bandtype_2_4G(hw, &temp_cck, &cck_index_old);\n\t} else {\n\t\ttemp_cck = 0x090e1317;\n\t\tcck_index_old = 12;\n\t}\n\n\tif (!rtlpriv->dm.thermalvalue) {\n\t\trtlpriv->dm.thermalvalue = rtlefuse->eeprom_thermalmeter;\n\t\trtlpriv->dm.thermalvalue_lck = thermalvalue;\n\t\trtlpriv->dm.thermalvalue_iqk = thermalvalue;\n\t\trtlpriv->dm.thermalvalue_rxgain = rtlefuse->eeprom_thermalmeter;\n\t\tfor (i = 0; i < rf; i++)\n\t\t\trtlpriv->dm.ofdm_index[i] = ofdm_index_old[i];\n\t\trtlpriv->dm.cck_index = cck_index_old;\n\t}\n\tif (rtlhal->reloadtxpowerindex) {\n\t\tfor (i = 0; i < rf; i++)\n\t\t\trtlpriv->dm.ofdm_index[i] = ofdm_index_old[i];\n\t\trtlpriv->dm.cck_index = cck_index_old;\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"reload ofdm index for band switch\\n\");\n\t}\nold_index_done:\n\tfor (i = 0; i < rf; i++)\n\t\tofdm_index[i] = rtlpriv->dm.ofdm_index[i];\n\n\trtlpriv->dm.thermalvalue_avg\n\t\t    [rtlpriv->dm.thermalvalue_avg_index] = thermalvalue;\n\trtlpriv->dm.thermalvalue_avg_index++;\n\tif (rtlpriv->dm.thermalvalue_avg_index == AVG_THERMAL_NUM)\n\t\trtlpriv->dm.thermalvalue_avg_index = 0;\n\tfor (i = 0; i < AVG_THERMAL_NUM; i++) {\n\t\tif (rtlpriv->dm.thermalvalue_avg[i]) {\n\t\t\tthermalvalue_avg += rtlpriv->dm.thermalvalue_avg[i];\n\t\t\tthermalvalue_avg_count++;\n\t\t}\n\t}\n\tif (thermalvalue_avg_count)\n\t\tthermalvalue = (u8)(thermalvalue_avg / thermalvalue_avg_count);\n\tif (rtlhal->reloadtxpowerindex) {\n\t\tdelta = (thermalvalue > rtlefuse->eeprom_thermalmeter) ?\n\t\t    (thermalvalue - rtlefuse->eeprom_thermalmeter) :\n\t\t    (rtlefuse->eeprom_thermalmeter - thermalvalue);\n\t\trtlhal->reloadtxpowerindex = false;\n\t\trtlpriv->dm.done_txpower = false;\n\t} else if (rtlpriv->dm.done_txpower) {\n\t\tdelta = (thermalvalue > rtlpriv->dm.thermalvalue) ?\n\t\t    (thermalvalue - rtlpriv->dm.thermalvalue) :\n\t\t    (rtlpriv->dm.thermalvalue - thermalvalue);\n\t} else {\n\t\tdelta = (thermalvalue > rtlefuse->eeprom_thermalmeter) ?\n\t\t    (thermalvalue - rtlefuse->eeprom_thermalmeter) :\n\t\t    (rtlefuse->eeprom_thermalmeter - thermalvalue);\n\t}\n\tdelta_lck = (thermalvalue > rtlpriv->dm.thermalvalue_lck) ?\n\t    (thermalvalue - rtlpriv->dm.thermalvalue_lck) :\n\t    (rtlpriv->dm.thermalvalue_lck - thermalvalue);\n\tdelta_iqk = (thermalvalue > rtlpriv->dm.thermalvalue_iqk) ?\n\t    (thermalvalue - rtlpriv->dm.thermalvalue_iqk) :\n\t    (rtlpriv->dm.thermalvalue_iqk - thermalvalue);\n\tdelta_rxgain =\n\t\t(thermalvalue > rtlpriv->dm.thermalvalue_rxgain) ?\n\t\t(thermalvalue - rtlpriv->dm.thermalvalue_rxgain) :\n\t\t(rtlpriv->dm.thermalvalue_rxgain - thermalvalue);\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\"Readback Thermal Meter = 0x%x pre thermal meter 0x%x eeprom_thermalmeter 0x%x delta 0x%x delta_lck 0x%x delta_iqk 0x%x\\n\",\n\t\tthermalvalue, rtlpriv->dm.thermalvalue,\n\t\trtlefuse->eeprom_thermalmeter, delta, delta_lck,\n\t\tdelta_iqk);\n\tif (delta_lck > rtlefuse->delta_lck && rtlefuse->delta_lck != 0) {\n\t\trtlpriv->dm.thermalvalue_lck = thermalvalue;\n\t\trtl92d_phy_lc_calibrate(hw);\n\t}\n\n\tif (delta == 0 || !rtlpriv->dm.txpower_track_control)\n\t\tgoto check_delta;\n\n\trtlpriv->dm.done_txpower = true;\n\tdelta = (thermalvalue > rtlefuse->eeprom_thermalmeter) ?\n\t    (thermalvalue - rtlefuse->eeprom_thermalmeter) :\n\t    (rtlefuse->eeprom_thermalmeter - thermalvalue);\n\tif (rtlhal->current_bandtype == BAND_ON_2_4G) {\n\t\toffset = 4;\n\t\tif (delta > INDEX_MAPPING_NUM - 1)\n\t\t\tindex = index_mapping[offset][INDEX_MAPPING_NUM - 1];\n\t\telse\n\t\t\tindex = index_mapping[offset][delta];\n\t\tif (thermalvalue > rtlpriv->dm.thermalvalue) {\n\t\t\tfor (i = 0; i < rf; i++)\n\t\t\t\tofdm_index[i] -= delta;\n\t\t\tcck_index -= delta;\n\t\t} else {\n\t\t\tfor (i = 0; i < rf; i++)\n\t\t\t\tofdm_index[i] += index;\n\t\t\tcck_index += index;\n\t\t}\n\t} else if (rtlhal->current_bandtype == BAND_ON_5G) {\n\t\trtl92d_bandtype_5G(rtlhal, ofdm_index,\n\t\t\t\t   &internal_pa, thermalvalue,\n\t\t\t\t   delta, rf, rtlefuse, rtlpriv,\n\t\t\t\t   rtlphy, index_mapping,\n\t\t\t\t   index_mapping_internal_pa);\n\t}\n\tif (is2t) {\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"temp OFDM_A_index=0x%x, OFDM_B_index = 0x%x,cck_index=0x%x\\n\",\n\t\t\trtlpriv->dm.ofdm_index[0],\n\t\t\trtlpriv->dm.ofdm_index[1],\n\t\t\trtlpriv->dm.cck_index);\n\t} else {\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"temp OFDM_A_index=0x%x,cck_index = 0x%x\\n\",\n\t\t\trtlpriv->dm.ofdm_index[0],\n\t\t\trtlpriv->dm.cck_index);\n\t}\n\tfor (i = 0; i < rf; i++) {\n\t\tif (ofdm_index[i] > OFDM_TABLE_SIZE_92D - 1) {\n\t\t\tofdm_index[i] = OFDM_TABLE_SIZE_92D - 1;\n\t\t} else if (internal_pa ||\n\t\t\t   rtlhal->current_bandtype == BAND_ON_2_4G) {\n\t\t\tif (ofdm_index[i] < ofdm_min_index_internal_pa)\n\t\t\t\tofdm_index[i] = ofdm_min_index_internal_pa;\n\t\t} else if (ofdm_index[i] < ofdm_min_index) {\n\t\t\tofdm_index[i] = ofdm_min_index;\n\t\t}\n\t}\n\tif (rtlhal->current_bandtype == BAND_ON_2_4G) {\n\t\tif (cck_index > CCK_TABLE_SIZE - 1) {\n\t\t\tcck_index = CCK_TABLE_SIZE - 1;\n\t\t} else if (cck_index < 0) {\n\t\t\tcck_index = 0;\n\t\t}\n\t}\n\tif (is2t) {\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"new OFDM_A_index=0x%x, OFDM_B_index = 0x%x, cck_index=0x%x\\n\",\n\t\t\tofdm_index[0], ofdm_index[1],\n\t\t\tcck_index);\n\t} else {\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"new OFDM_A_index=0x%x,cck_index = 0x%x\\n\",\n\t\t\tofdm_index[0], cck_index);\n\t}\n\tele_d = (ofdmswing_table[ofdm_index[0]] & 0xFFC00000) >> 22;\n\tval_x = rtlphy->iqk_matrix[indexforchannel].value[0][0];\n\tval_y = rtlphy->iqk_matrix[indexforchannel].value[0][1];\n\tif (val_x != 0) {\n\t\tif ((val_x & 0x00000200) != 0)\n\t\t\tval_x = val_x | 0xFFFFFC00;\n\t\tele_a = ((val_x * ele_d) >> 8) & 0x000003FF;\n\n\t\t \n\t\tif ((val_y & 0x00000200) != 0)\n\t\t\tval_y = val_y | 0xFFFFFC00;\n\t\tele_c = ((val_y * ele_d) >> 8) & 0x000003FF;\n\n\t\t \n\t\tvalue32 = (ele_d << 22) | ((ele_c & 0x3F) << 16) | ele_a;\n\t\trtl_set_bbreg(hw, ROFDM0_XATXIQIMBALANCE,\n\t\t\t      MASKDWORD, value32);\n\n\t\tvalue32 = (ele_c & 0x000003C0) >> 6;\n\t\trtl_set_bbreg(hw, ROFDM0_XCTXAFE, MASKH4BITS,\n\t\t\t      value32);\n\n\t\tvalue32 = ((val_x * ele_d) >> 7) & 0x01;\n\t\trtl_set_bbreg(hw, ROFDM0_ECCATHRESHOLD, BIT(24),\n\t\t\t      value32);\n\n\t} else {\n\t\trtl_set_bbreg(hw, ROFDM0_XATXIQIMBALANCE,\n\t\t\t      MASKDWORD,\n\t\t\t      ofdmswing_table[(u8)ofdm_index[0]]);\n\t\trtl_set_bbreg(hw, ROFDM0_XCTXAFE, MASKH4BITS,\n\t\t\t      0x00);\n\t\trtl_set_bbreg(hw, ROFDM0_ECCATHRESHOLD,\n\t\t\t      BIT(24), 0x00);\n\t}\n\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\"TxPwrTracking for interface %d path A: X = 0x%lx, Y = 0x%lx ele_A = 0x%lx ele_C = 0x%lx ele_D = 0x%lx 0xe94 = 0x%lx 0xe9c = 0x%lx\\n\",\n\t\trtlhal->interfaceindex,\n\t\tval_x, val_y, ele_a, ele_c, ele_d,\n\t\tval_x, val_y);\n\n\tif (cck_index >= CCK_TABLE_SIZE)\n\t\tcck_index = CCK_TABLE_SIZE - 1;\n\tif (cck_index < 0)\n\t\tcck_index = 0;\n\tif (rtlhal->current_bandtype == BAND_ON_2_4G) {\n\t\t \n\t\tif (!rtlpriv->dm.cck_inch14) {\n\t\t\trtl_write_byte(rtlpriv, 0xa22,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][0]);\n\t\t\trtl_write_byte(rtlpriv, 0xa23,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][1]);\n\t\t\trtl_write_byte(rtlpriv, 0xa24,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][2]);\n\t\t\trtl_write_byte(rtlpriv, 0xa25,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][3]);\n\t\t\trtl_write_byte(rtlpriv, 0xa26,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][4]);\n\t\t\trtl_write_byte(rtlpriv, 0xa27,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][5]);\n\t\t\trtl_write_byte(rtlpriv, 0xa28,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][6]);\n\t\t\trtl_write_byte(rtlpriv, 0xa29,\n\t\t\t\t       cckswing_table_ch1ch13[cck_index][7]);\n\t\t} else {\n\t\t\trtl_write_byte(rtlpriv, 0xa22,\n\t\t\t\t       cckswing_table_ch14[cck_index][0]);\n\t\t\trtl_write_byte(rtlpriv, 0xa23,\n\t\t\t\t       cckswing_table_ch14[cck_index][1]);\n\t\t\trtl_write_byte(rtlpriv, 0xa24,\n\t\t\t\t       cckswing_table_ch14[cck_index][2]);\n\t\t\trtl_write_byte(rtlpriv, 0xa25,\n\t\t\t\t       cckswing_table_ch14[cck_index][3]);\n\t\t\trtl_write_byte(rtlpriv, 0xa26,\n\t\t\t\t       cckswing_table_ch14[cck_index][4]);\n\t\t\trtl_write_byte(rtlpriv, 0xa27,\n\t\t\t\t       cckswing_table_ch14[cck_index][5]);\n\t\t\trtl_write_byte(rtlpriv, 0xa28,\n\t\t\t\t       cckswing_table_ch14[cck_index][6]);\n\t\t\trtl_write_byte(rtlpriv, 0xa29,\n\t\t\t\t       cckswing_table_ch14[cck_index][7]);\n\t\t}\n\t}\n\tif (is2t) {\n\t\tele_d = (ofdmswing_table[ofdm_index[1]] & 0xFFC00000) >> 22;\n\t\tval_x = rtlphy->iqk_matrix[indexforchannel].value[0][4];\n\t\tval_y = rtlphy->iqk_matrix[indexforchannel].value[0][5];\n\t\tif (val_x != 0) {\n\t\t\tif ((val_x & 0x00000200) != 0)\n\t\t\t\t \n\t\t\t\tval_x = val_x | 0xFFFFFC00;\n\t\t\tele_a = ((val_x * ele_d) >> 8) & 0x000003FF;\n\t\t\t \n\t\t\tif ((val_y & 0x00000200) != 0)\n\t\t\t\tval_y = val_y | 0xFFFFFC00;\n\t\t\tele_c = ((val_y * ele_d) >> 8) & 0x00003FF;\n\t\t\t \n\t\t\tvalue32 = (ele_d << 22) | ((ele_c & 0x3F) << 16) | ele_a;\n\t\t\trtl_set_bbreg(hw,\n\t\t\t\t      ROFDM0_XBTXIQIMBALANCE,\n\t\t\t\t      MASKDWORD, value32);\n\t\t\tvalue32 = (ele_c & 0x000003C0) >> 6;\n\t\t\trtl_set_bbreg(hw, ROFDM0_XDTXAFE,\n\t\t\t\t      MASKH4BITS, value32);\n\t\t\tvalue32 = ((val_x * ele_d) >> 7) & 0x01;\n\t\t\trtl_set_bbreg(hw, ROFDM0_ECCATHRESHOLD,\n\t\t\t\t      BIT(28), value32);\n\t\t} else {\n\t\t\trtl_set_bbreg(hw,\n\t\t\t\t      ROFDM0_XBTXIQIMBALANCE,\n\t\t\t\t      MASKDWORD,\n\t\t\t\t      ofdmswing_table[ofdm_index[1]]);\n\t\t\trtl_set_bbreg(hw, ROFDM0_XDTXAFE,\n\t\t\t\t      MASKH4BITS, 0x00);\n\t\t\trtl_set_bbreg(hw, ROFDM0_ECCATHRESHOLD,\n\t\t\t\t      BIT(28), 0x00);\n\t\t}\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"TxPwrTracking path B: X = 0x%lx, Y = 0x%lx ele_A = 0x%lx ele_C = 0x%lx ele_D = 0x%lx 0xeb4 = 0x%lx 0xebc = 0x%lx\\n\",\n\t\t\tval_x, val_y, ele_a, ele_c,\n\t\t\tele_d, val_x, val_y);\n\t}\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\"TxPwrTracking 0xc80 = 0x%x, 0xc94 = 0x%x RF 0x24 = 0x%x\\n\",\n\t\trtl_get_bbreg(hw, 0xc80, MASKDWORD),\n\t\trtl_get_bbreg(hw, 0xc94, MASKDWORD),\n\t\trtl_get_rfreg(hw, RF90_PATH_A, 0x24,\n\t\t\t      RFREG_OFFSET_MASK));\n\ncheck_delta:\n\tif (delta_iqk > rtlefuse->delta_iqk && rtlefuse->delta_iqk != 0) {\n\t\trtl92d_phy_reset_iqk_result(hw);\n\t\trtlpriv->dm.thermalvalue_iqk = thermalvalue;\n\t\trtl92d_phy_iq_calibrate(hw);\n\t}\n\tif (delta_rxgain > 0 && rtlhal->current_bandtype == BAND_ON_5G &&\n\t    thermalvalue <= rtlefuse->eeprom_thermalmeter) {\n\t\trtlpriv->dm.thermalvalue_rxgain = thermalvalue;\n\t\trtl92d_dm_rxgain_tracking_thermalmeter(hw);\n\t}\n\tif (rtlpriv->dm.txpower_track_control)\n\t\trtlpriv->dm.thermalvalue = thermalvalue;\n\nexit:\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD, \"<===\\n\");\n}\n\nstatic void rtl92d_dm_initialize_txpower_tracking(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\trtlpriv->dm.txpower_tracking = true;\n\trtlpriv->dm.txpower_trackinginit = false;\n\trtlpriv->dm.txpower_track_control = true;\n\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\"pMgntInfo->txpower_tracking = %d\\n\",\n\t\trtlpriv->dm.txpower_tracking);\n}\n\nvoid rtl92d_dm_check_txpower_tracking_thermal_meter(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\tif (!rtlpriv->dm.txpower_tracking)\n\t\treturn;\n\n\tif (!rtlpriv->dm.tm_trigger) {\n\t\trtl_set_rfreg(hw, RF90_PATH_A, RF_T_METER, BIT(17) |\n\t\t\t      BIT(16), 0x03);\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"Trigger 92S Thermal Meter!!\\n\");\n\t\trtlpriv->dm.tm_trigger = 1;\n\t\treturn;\n\t} else {\n\t\trtl_dbg(rtlpriv, COMP_POWER_TRACKING, DBG_LOUD,\n\t\t\t\"Schedule TxPowerTracking direct call!!\\n\");\n\t\trtl92d_dm_txpower_tracking_callback_thermalmeter(hw);\n\t\trtlpriv->dm.tm_trigger = 0;\n\t}\n}\n\nvoid rtl92d_dm_init_rate_adaptive_mask(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rate_adaptive *ra = &(rtlpriv->ra);\n\n\tra->ratr_state = DM_RATR_STA_INIT;\n\tra->pre_ratr_state = DM_RATR_STA_INIT;\n\tif (rtlpriv->dm.dm_type == DM_TYPE_BYDRIVER)\n\t\trtlpriv->dm.useramask = true;\n\telse\n\t\trtlpriv->dm.useramask = false;\n}\n\nvoid rtl92d_dm_init(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\trtlpriv->dm.dm_type = DM_TYPE_BYDRIVER;\n\trtl_dm_diginit(hw, 0x20);\n\trtlpriv->dm_digtable.rx_gain_max = DM_DIG_FA_UPPER;\n\trtlpriv->dm_digtable.rx_gain_min = DM_DIG_FA_LOWER;\n\trtl92d_dm_init_dynamic_txpower(hw);\n\trtl92d_dm_init_edca_turbo(hw);\n\trtl92d_dm_init_rate_adaptive_mask(hw);\n\trtl92d_dm_initialize_txpower_tracking(hw);\n}\n\nvoid rtl92d_dm_watchdog(struct ieee80211_hw *hw)\n{\n\tstruct rtl_ps_ctl *ppsc = rtl_psc(rtl_priv(hw));\n\tbool fw_current_inpsmode = false;\n\tbool fwps_awake = true;\n\n\t \n\n\tif ((ppsc->rfpwr_state == ERFON) && ((!fw_current_inpsmode) &&\n\t    fwps_awake) && (!ppsc->rfchange_inprogress)) {\n\t\trtl92d_dm_pwdb_monitor(hw);\n\t\trtl92d_dm_false_alarm_counter_statistics(hw);\n\t\trtl92d_dm_find_minimum_rssi(hw);\n\t\trtl92d_dm_dig(hw);\n\t\t \n\t\trtl92d_dm_dynamic_txpower(hw);\n\t\t \n\t\t \n\t\t \n\t\trtl92d_dm_check_edca_turbo(hw);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}