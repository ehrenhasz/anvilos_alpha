{
  "module_name": "rf.c",
  "hash_id": "1ec4e7c59169850e62d25e50c0cdaf29bf5d1167aa13d363f62b606e5bcb1d46",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtlwifi/rtl8192de/rf.c",
  "human_readable_source": "\n \n\n#include \"../wifi.h\"\n#include \"reg.h\"\n#include \"def.h\"\n#include \"phy.h\"\n#include \"rf.h\"\n#include \"dm.h\"\n#include \"hw.h\"\n\nvoid rtl92d_phy_rf6052_set_bandwidth(struct ieee80211_hw *hw, u8 bandwidth)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tu8 rfpath;\n\n\tswitch (bandwidth) {\n\tcase HT_CHANNEL_WIDTH_20:\n\t\tfor (rfpath = 0; rfpath < rtlphy->num_total_rfpath; rfpath++) {\n\t\t\trtlphy->rfreg_chnlval[rfpath] = ((rtlphy->rfreg_chnlval\n\t\t\t\t\t[rfpath] & 0xfffff3ff) | 0x0400);\n\t\t\trtl_set_rfreg(hw, rfpath, RF_CHNLBW, BIT(10) |\n\t\t\t\t      BIT(11), 0x01);\n\n\t\t\trtl_dbg(rtlpriv, COMP_RF, DBG_LOUD,\n\t\t\t\t\"20M RF 0x18 = 0x%x\\n\",\n\t\t\t\trtlphy->rfreg_chnlval[rfpath]);\n\t\t}\n\n\t\tbreak;\n\tcase HT_CHANNEL_WIDTH_20_40:\n\t\tfor (rfpath = 0; rfpath < rtlphy->num_total_rfpath; rfpath++) {\n\t\t\trtlphy->rfreg_chnlval[rfpath] =\n\t\t\t    ((rtlphy->rfreg_chnlval[rfpath] & 0xfffff3ff));\n\t\t\trtl_set_rfreg(hw, rfpath, RF_CHNLBW, BIT(10) | BIT(11),\n\t\t\t\t      0x00);\n\t\t\trtl_dbg(rtlpriv, COMP_RF, DBG_LOUD,\n\t\t\t\t\"40M RF 0x18 = 0x%x\\n\",\n\t\t\t\trtlphy->rfreg_chnlval[rfpath]);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"unknown bandwidth: %#X\\n\", bandwidth);\n\t\tbreak;\n\t}\n}\n\nvoid rtl92d_phy_rf6052_set_cck_txpower(struct ieee80211_hw *hw,\n\t\t\t\t       u8 *ppowerlevel)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tstruct rtl_mac *mac = rtl_mac(rtl_priv(hw));\n\tstruct rtl_efuse *rtlefuse = rtl_efuse(rtl_priv(hw));\n\tu32 tx_agc[2] = {0, 0}, tmpval;\n\tbool turbo_scanoff = false;\n\tu8 idx1, idx2;\n\tu8 *ptr;\n\n\tif (rtlefuse->eeprom_regulatory != 0)\n\t\tturbo_scanoff = true;\n\tif (mac->act_scanning) {\n\t\ttx_agc[RF90_PATH_A] = 0x3f3f3f3f;\n\t\ttx_agc[RF90_PATH_B] = 0x3f3f3f3f;\n\t\tif (turbo_scanoff) {\n\t\t\tfor (idx1 = RF90_PATH_A; idx1 <= RF90_PATH_B; idx1++) {\n\t\t\t\ttx_agc[idx1] = ppowerlevel[idx1] |\n\t\t\t\t    (ppowerlevel[idx1] << 8) |\n\t\t\t\t    (ppowerlevel[idx1] << 16) |\n\t\t\t\t    (ppowerlevel[idx1] << 24);\n\t\t\t}\n\t\t}\n\t} else {\n\t\tfor (idx1 = RF90_PATH_A; idx1 <= RF90_PATH_B; idx1++) {\n\t\t\ttx_agc[idx1] = ppowerlevel[idx1] |\n\t\t\t    (ppowerlevel[idx1] << 8) |\n\t\t\t    (ppowerlevel[idx1] << 16) |\n\t\t\t    (ppowerlevel[idx1] << 24);\n\t\t}\n\t\tif (rtlefuse->eeprom_regulatory == 0) {\n\t\t\ttmpval = (rtlphy->mcs_offset[0][6]) +\n\t\t\t    (rtlphy->mcs_offset[0][7] << 8);\n\t\t\ttx_agc[RF90_PATH_A] += tmpval;\n\t\t\ttmpval = (rtlphy->mcs_offset[0][14]) +\n\t\t\t    (rtlphy->mcs_offset[0][15] << 24);\n\t\t\ttx_agc[RF90_PATH_B] += tmpval;\n\t\t}\n\t}\n\n\tfor (idx1 = RF90_PATH_A; idx1 <= RF90_PATH_B; idx1++) {\n\t\tptr = (u8 *) (&(tx_agc[idx1]));\n\t\tfor (idx2 = 0; idx2 < 4; idx2++) {\n\t\t\tif (*ptr > RF6052_MAX_TX_PWR)\n\t\t\t\t*ptr = RF6052_MAX_TX_PWR;\n\t\t\tptr++;\n\t\t}\n\t}\n\n\ttmpval = tx_agc[RF90_PATH_A] & 0xff;\n\trtl_set_bbreg(hw, RTXAGC_A_CCK1_MCS32, MASKBYTE1, tmpval);\n\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\"CCK PWR 1M (rf-A) = 0x%x (reg 0x%x)\\n\",\n\t\ttmpval, RTXAGC_A_CCK1_MCS32);\n\ttmpval = tx_agc[RF90_PATH_A] >> 8;\n\trtl_set_bbreg(hw, RTXAGC_B_CCK11_A_CCK2_11, 0xffffff00, tmpval);\n\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\"CCK PWR 2~11M (rf-A) = 0x%x (reg 0x%x)\\n\",\n\t\ttmpval, RTXAGC_B_CCK11_A_CCK2_11);\n\ttmpval = tx_agc[RF90_PATH_B] >> 24;\n\trtl_set_bbreg(hw, RTXAGC_B_CCK11_A_CCK2_11, MASKBYTE0, tmpval);\n\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\"CCK PWR 11M (rf-B) = 0x%x (reg 0x%x)\\n\",\n\t\ttmpval, RTXAGC_B_CCK11_A_CCK2_11);\n\ttmpval = tx_agc[RF90_PATH_B] & 0x00ffffff;\n\trtl_set_bbreg(hw, RTXAGC_B_CCK1_55_MCS32, 0xffffff00, tmpval);\n\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\"CCK PWR 1~5.5M (rf-B) = 0x%x (reg 0x%x)\\n\",\n\t\ttmpval, RTXAGC_B_CCK1_55_MCS32);\n}\n\nstatic void _rtl92d_phy_get_power_base(struct ieee80211_hw *hw,\n\t\t\t\t       u8 *ppowerlevel, u8 channel,\n\t\t\t\t       u32 *ofdmbase, u32 *mcsbase)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tstruct rtl_efuse *rtlefuse = rtl_efuse(rtl_priv(hw));\n\tu32 powerbase0, powerbase1;\n\tu8 legacy_pwrdiff, ht20_pwrdiff;\n\tu8 i, powerlevel[2];\n\n\tfor (i = 0; i < 2; i++) {\n\t\tpowerlevel[i] = ppowerlevel[i];\n\t\tlegacy_pwrdiff = rtlefuse->txpwr_legacyhtdiff[i][channel - 1];\n\t\tpowerbase0 = powerlevel[i] + legacy_pwrdiff;\n\t\tpowerbase0 = (powerbase0 << 24) | (powerbase0 << 16) |\n\t\t    (powerbase0 << 8) | powerbase0;\n\t\t*(ofdmbase + i) = powerbase0;\n\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\" [OFDM power base index rf(%c) = 0x%x]\\n\",\n\t\t\ti == 0 ? 'A' : 'B', *(ofdmbase + i));\n\t}\n\n\tfor (i = 0; i < 2; i++) {\n\t\tif (rtlphy->current_chan_bw == HT_CHANNEL_WIDTH_20) {\n\t\t\tht20_pwrdiff = rtlefuse->txpwr_ht20diff[i][channel - 1];\n\t\t\tpowerlevel[i] += ht20_pwrdiff;\n\t\t}\n\t\tpowerbase1 = powerlevel[i];\n\t\tpowerbase1 = (powerbase1 << 24) | (powerbase1 << 16) |\n\t\t\t     (powerbase1 << 8) | powerbase1;\n\t\t*(mcsbase + i) = powerbase1;\n\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\" [MCS power base index rf(%c) = 0x%x]\\n\",\n\t\t\ti == 0 ? 'A' : 'B', *(mcsbase + i));\n\t}\n}\n\nstatic u8 _rtl92d_phy_get_chnlgroup_bypg(u8 chnlindex)\n{\n\tu8 group;\n\tu8 channel_info[59] = {\n\t\t1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,\n\t\t36, 38, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58,\n\t\t60, 62, 64, 100, 102, 104, 106, 108, 110, 112,\n\t\t114, 116, 118, 120, 122, 124, 126, 128,\t130, 132,\n\t\t134, 136, 138, 140, 149, 151, 153, 155, 157, 159,\n\t\t161, 163, 165\n\t};\n\n\tif (channel_info[chnlindex] <= 3)\t \n\t\tgroup = 0;\n\telse if (channel_info[chnlindex] <= 9)\t \n\t\tgroup = 1;\n\telse if (channel_info[chnlindex] <= 14)\t \n\t\tgroup = 2;\n\telse if (channel_info[chnlindex] <= 64)\n\t\tgroup = 6;\n\telse if (channel_info[chnlindex] <= 140)\n\t\tgroup = 7;\n\telse\n\t\tgroup = 8;\n\treturn group;\n}\n\nstatic void _rtl92d_get_txpower_writeval_by_regulatory(struct ieee80211_hw *hw,\n\t\t\t\t\t\t       u8 channel, u8 index,\n\t\t\t\t\t\t       u32 *powerbase0,\n\t\t\t\t\t\t       u32 *powerbase1,\n\t\t\t\t\t\t       u32 *p_outwriteval)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tstruct rtl_efuse *rtlefuse = rtl_efuse(rtl_priv(hw));\n\tu8 i, chnlgroup = 0, pwr_diff_limit[4];\n\tu32 writeval = 0, customer_limit, rf;\n\n\tfor (rf = 0; rf < 2; rf++) {\n\t\tswitch (rtlefuse->eeprom_regulatory) {\n\t\tcase 0:\n\t\t\tchnlgroup = 0;\n\t\t\twriteval = rtlphy->mcs_offset\n\t\t\t\t\t[chnlgroup][index +\n\t\t\t\t\t(rf ? 8 : 0)] + ((index < 2) ?\n\t\t\t\t\tpowerbase0[rf] :\n\t\t\t\t\tpowerbase1[rf]);\n\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\"RTK better performance, writeval(%c) = 0x%x\\n\",\n\t\t\t\trf == 0 ? 'A' : 'B', writeval);\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tif (rtlphy->pwrgroup_cnt == 1)\n\t\t\t\tchnlgroup = 0;\n\t\t\tif (rtlphy->pwrgroup_cnt >= MAX_PG_GROUP) {\n\t\t\t\tchnlgroup = _rtl92d_phy_get_chnlgroup_bypg(\n\t\t\t\t\t\t\t\tchannel - 1);\n\t\t\t\tif (rtlphy->current_chan_bw ==\n\t\t\t\t    HT_CHANNEL_WIDTH_20)\n\t\t\t\t\tchnlgroup++;\n\t\t\t\telse\n\t\t\t\t\tchnlgroup += 4;\n\t\t\t\twriteval = rtlphy->mcs_offset\n\t\t\t\t\t\t[chnlgroup][index +\n\t\t\t\t\t\t(rf ? 8 : 0)] + ((index < 2) ?\n\t\t\t\t\t\tpowerbase0[rf] :\n\t\t\t\t\t\tpowerbase1[rf]);\n\t\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\t\"Realtek regulatory, 20MHz, writeval(%c) = 0x%x\\n\",\n\t\t\t\t\trf == 0 ? 'A' : 'B', writeval);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\twriteval = ((index < 2) ? powerbase0[rf] :\n\t\t\t\t   powerbase1[rf]);\n\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\"Better regulatory, writeval(%c) = 0x%x\\n\",\n\t\t\t\trf == 0 ? 'A' : 'B', writeval);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tchnlgroup = 0;\n\t\t\tif (rtlphy->current_chan_bw == HT_CHANNEL_WIDTH_20_40) {\n\t\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\t\"customer's limit, 40MHz rf(%c) = 0x%x\\n\",\n\t\t\t\t\trf == 0 ? 'A' : 'B',\n\t\t\t\t\trtlefuse->pwrgroup_ht40[rf]\n\t\t\t\t\t[channel - 1]);\n\t\t\t} else {\n\t\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\t\"customer's limit, 20MHz rf(%c) = 0x%x\\n\",\n\t\t\t\t\trf == 0 ? 'A' : 'B',\n\t\t\t\t\trtlefuse->pwrgroup_ht20[rf]\n\t\t\t\t\t[channel - 1]);\n\t\t\t}\n\t\t\tfor (i = 0; i < 4; i++) {\n\t\t\t\tpwr_diff_limit[i] = (u8)((rtlphy->mcs_offset\n\t\t\t\t\t[chnlgroup][index + (rf ? 8 : 0)] &\n\t\t\t\t\t(0x7f << (i * 8))) >> (i * 8));\n\t\t\t\tif (rtlphy->current_chan_bw ==\n\t\t\t\t    HT_CHANNEL_WIDTH_20_40) {\n\t\t\t\t\tif (pwr_diff_limit[i] >\n\t\t\t\t\t    rtlefuse->pwrgroup_ht40[rf]\n\t\t\t\t\t   [channel - 1])\n\t\t\t\t\t\tpwr_diff_limit[i] =\n\t\t\t\t\t\t\trtlefuse->pwrgroup_ht40\n\t\t\t\t\t\t\t[rf][channel - 1];\n\t\t\t\t} else {\n\t\t\t\t\tif (pwr_diff_limit[i] >\n\t\t\t\t\t    rtlefuse->pwrgroup_ht20[rf][\n\t\t\t\t\t\tchannel - 1])\n\t\t\t\t\t\tpwr_diff_limit[i] =\n\t\t\t\t\t\t   rtlefuse->pwrgroup_ht20[rf]\n\t\t\t\t\t\t   [channel - 1];\n\t\t\t\t}\n\t\t\t}\n\t\t\tcustomer_limit = (pwr_diff_limit[3] << 24) |\n\t\t\t\t\t (pwr_diff_limit[2] << 16) |\n\t\t\t\t\t (pwr_diff_limit[1] << 8) |\n\t\t\t\t\t (pwr_diff_limit[0]);\n\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\"Customer's limit rf(%c) = 0x%x\\n\",\n\t\t\t\trf == 0 ? 'A' : 'B', customer_limit);\n\t\t\twriteval = customer_limit + ((index < 2) ?\n\t\t\t\t   powerbase0[rf] : powerbase1[rf]);\n\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\"Customer, writeval rf(%c)= 0x%x\\n\",\n\t\t\t\trf == 0 ? 'A' : 'B', writeval);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tchnlgroup = 0;\n\t\t\twriteval = rtlphy->mcs_offset[chnlgroup][index +\n\t\t\t\t   (rf ? 8 : 0)] + ((index < 2) ?\n\t\t\t\t   powerbase0[rf] : powerbase1[rf]);\n\t\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\t\"RTK better performance, writeval rf(%c) = 0x%x\\n\",\n\t\t\t\trf == 0 ? 'A' : 'B', writeval);\n\t\t\tbreak;\n\t\t}\n\t\t*(p_outwriteval + rf) = writeval;\n\t}\n}\n\nstatic void _rtl92d_write_ofdm_power_reg(struct ieee80211_hw *hw,\n\t\t\t\t\t u8 index, u32 *pvalue)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tstatic u16 regoffset_a[6] = {\n\t\tRTXAGC_A_RATE18_06, RTXAGC_A_RATE54_24,\n\t\tRTXAGC_A_MCS03_MCS00, RTXAGC_A_MCS07_MCS04,\n\t\tRTXAGC_A_MCS11_MCS08, RTXAGC_A_MCS15_MCS12\n\t};\n\tstatic u16 regoffset_b[6] = {\n\t\tRTXAGC_B_RATE18_06, RTXAGC_B_RATE54_24,\n\t\tRTXAGC_B_MCS03_MCS00, RTXAGC_B_MCS07_MCS04,\n\t\tRTXAGC_B_MCS11_MCS08, RTXAGC_B_MCS15_MCS12\n\t};\n\tu8 i, rf, pwr_val[4];\n\tu32 writeval;\n\tu16 regoffset;\n\n\tfor (rf = 0; rf < 2; rf++) {\n\t\twriteval = pvalue[rf];\n\t\tfor (i = 0; i < 4; i++) {\n\t\t\tpwr_val[i] = (u8) ((writeval & (0x7f <<\n\t\t\t\t     (i * 8))) >> (i * 8));\n\t\t\tif (pwr_val[i] > RF6052_MAX_TX_PWR)\n\t\t\t\tpwr_val[i] = RF6052_MAX_TX_PWR;\n\t\t}\n\t\twriteval = (pwr_val[3] << 24) | (pwr_val[2] << 16) |\n\t\t\t   (pwr_val[1] << 8) | pwr_val[0];\n\t\tif (rf == 0)\n\t\t\tregoffset = regoffset_a[index];\n\t\telse\n\t\t\tregoffset = regoffset_b[index];\n\t\trtl_set_bbreg(hw, regoffset, MASKDWORD, writeval);\n\t\tRTPRINT(rtlpriv, FPHY, PHY_TXPWR,\n\t\t\t\"Set 0x%x = %08x\\n\", regoffset, writeval);\n\t\tif (((get_rf_type(rtlphy) == RF_2T2R) &&\n\t\t    (regoffset == RTXAGC_A_MCS15_MCS12 ||\n\t\t    regoffset == RTXAGC_B_MCS15_MCS12)) ||\n\t\t    ((get_rf_type(rtlphy) != RF_2T2R) &&\n\t\t    (regoffset == RTXAGC_A_MCS07_MCS04 ||\n\t\t    regoffset == RTXAGC_B_MCS07_MCS04))) {\n\t\t\twriteval = pwr_val[3];\n\t\t\tif (regoffset == RTXAGC_A_MCS15_MCS12 ||\n\t\t\t    regoffset == RTXAGC_A_MCS07_MCS04)\n\t\t\t\tregoffset = 0xc90;\n\t\t\tif (regoffset == RTXAGC_B_MCS15_MCS12 ||\n\t\t\t    regoffset == RTXAGC_B_MCS07_MCS04)\n\t\t\t\tregoffset = 0xc98;\n\t\t\tfor (i = 0; i < 3; i++) {\n\t\t\t\tif (i != 2)\n\t\t\t\t\twriteval = (writeval > 8) ?\n\t\t\t\t\t\t   (writeval - 8) : 0;\n\t\t\t\telse\n\t\t\t\t\twriteval = (writeval > 6) ?\n\t\t\t\t\t\t   (writeval - 6) : 0;\n\t\t\t\trtl_write_byte(rtlpriv, (u32) (regoffset + i),\n\t\t\t\t\t       (u8) writeval);\n\t\t\t}\n\t\t}\n\t}\n}\n\nvoid rtl92d_phy_rf6052_set_ofdm_txpower(struct ieee80211_hw *hw,\n\t\t\t\t\tu8 *ppowerlevel, u8 channel)\n{\n\tu32 writeval[2], powerbase0[2], powerbase1[2];\n\tu8 index;\n\n\t_rtl92d_phy_get_power_base(hw, ppowerlevel, channel,\n\t\t\t&powerbase0[0],\t&powerbase1[0]);\n\tfor (index = 0; index < 6; index++) {\n\t\t_rtl92d_get_txpower_writeval_by_regulatory(hw,\n\t\t\t\tchannel, index,\t&powerbase0[0],\n\t\t\t\t&powerbase1[0],\t&writeval[0]);\n\t\t_rtl92d_write_ofdm_power_reg(hw, index, &writeval[0]);\n\t}\n}\n\nbool rtl92d_phy_enable_anotherphy(struct ieee80211_hw *hw, bool bmac0)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_hal *rtlhal = &(rtlpriv->rtlhal);\n\tu8 u1btmp;\n\tu8 direct = bmac0 ? BIT(3) | BIT(2) : BIT(3);\n\tu8 mac_reg = bmac0 ? REG_MAC1 : REG_MAC0;\n\tu8 mac_on_bit = bmac0 ? MAC1_ON : MAC0_ON;\n\tbool bresult = true;  \n\n\trtlhal->during_mac0init_radiob = false;\n\trtlhal->during_mac1init_radioa = false;\n\trtl_dbg(rtlpriv, COMP_RF, DBG_LOUD, \"===>\\n\");\n\t \n\tu1btmp = rtl_read_byte(rtlpriv, mac_reg);\n\tif (!(u1btmp & mac_on_bit)) {\n\t\trtl_dbg(rtlpriv, COMP_INIT, DBG_LOUD, \"enable BB & RF\\n\");\n\t\t \n\t\trtl92de_write_dword_dbi(hw, REG_SYS_ISO_CTRL,\n\t\t\trtl92de_read_dword_dbi(hw, REG_SYS_ISO_CTRL, direct) |\n\t\t\t\tBIT(29) | BIT(16) | BIT(17), direct);\n\t} else {\n\t\t \n\t\tbresult = false;\n\t}\n\trtl_dbg(rtlpriv, COMP_RF, DBG_LOUD, \"<===\\n\");\n\treturn bresult;\n\n}\n\nvoid rtl92d_phy_powerdown_anotherphy(struct ieee80211_hw *hw, bool bmac0)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_hal *rtlhal = &(rtlpriv->rtlhal);\n\tu8 u1btmp;\n\tu8 direct = bmac0 ? BIT(3) | BIT(2) : BIT(3);\n\tu8 mac_reg = bmac0 ? REG_MAC1 : REG_MAC0;\n\tu8 mac_on_bit = bmac0 ? MAC1_ON : MAC0_ON;\n\n\trtlhal->during_mac0init_radiob = false;\n\trtlhal->during_mac1init_radioa = false;\n\trtl_dbg(rtlpriv, COMP_RF, DBG_LOUD, \"====>\\n\");\n\t \n\tu1btmp = rtl_read_byte(rtlpriv, mac_reg);\n\tif (!(u1btmp & mac_on_bit)) {\n\t\trtl_dbg(rtlpriv, COMP_INIT, DBG_LOUD, \"power down\\n\");\n\t\t \n\t\trtl92de_write_dword_dbi(hw, RFPGA0_XA_LSSIPARAMETER,\n\t\t\t\t\t0x00000000, direct);\n\t}\n\trtl_dbg(rtlpriv, COMP_RF, DBG_LOUD, \"<====\\n\");\n}\n\nbool rtl92d_phy_rf6052_config(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tbool rtstatus = true;\n\tstruct rtl_hal *rtlhal = &(rtlpriv->rtlhal);\n\tu32 u4_regvalue = 0;\n\tu8 rfpath;\n\tstruct bb_reg_def *pphyreg;\n\tbool mac1_initradioa_first = false, mac0_initradiob_first = false;\n\tbool need_pwrdown_radioa = false, need_pwrdown_radiob = false;\n\tbool true_bpath = false;\n\n\tif (rtlphy->rf_type == RF_1T1R)\n\t\trtlphy->num_total_rfpath = 1;\n\telse\n\t\trtlphy->num_total_rfpath = 2;\n\n\t \n\t \n\t \n\t \n\t \n\tif (rtlhal->macphymode == DUALMAC_DUALPHY) {\n\t\tif (rtlhal->current_bandtype == BAND_ON_2_4G &&\n\t\t    rtlhal->interfaceindex == 0) {\n\t\t\t \n\t\t\tif (rtl92d_phy_enable_anotherphy(hw, true)) {\n\t\t\t\trtlphy->num_total_rfpath = 2;\n\t\t\t\tmac0_initradiob_first = true;\n\t\t\t} else {\n\t\t\t\t \n\t\t\t\treturn rtstatus;\n\t\t\t}\n\t\t} else if (rtlhal->current_bandtype == BAND_ON_5G &&\n\t\t\t   rtlhal->interfaceindex == 1) {\n\t\t\t \n\t\t\tif (rtl92d_phy_enable_anotherphy(hw, false)) {\n\t\t\t\trtlphy->num_total_rfpath = 2;\n\t\t\t\tmac1_initradioa_first = true;\n\t\t\t} else {\n\t\t\t\t \n\t\t\t\treturn rtstatus;\n\t\t\t}\n\t\t} else if (rtlhal->interfaceindex == 1) {\n\t\t\t \n\t\t\ttrue_bpath = true;\n\t\t}\n\t}\n\n\tfor (rfpath = 0; rfpath < rtlphy->num_total_rfpath; rfpath++) {\n\t\t \n\t\tif (mac1_initradioa_first) {\n\t\t\tif (rfpath == RF90_PATH_A) {\n\t\t\t\trtlhal->during_mac1init_radioa = true;\n\t\t\t\tneed_pwrdown_radioa = true;\n\t\t\t} else if (rfpath == RF90_PATH_B) {\n\t\t\t\trtlhal->during_mac1init_radioa = false;\n\t\t\t\tmac1_initradioa_first = false;\n\t\t\t\trfpath = RF90_PATH_A;\n\t\t\t\ttrue_bpath = true;\n\t\t\t\trtlphy->num_total_rfpath = 1;\n\t\t\t}\n\t\t} else if (mac0_initradiob_first) {\n\t\t\t \n\t\t\tif (rfpath == RF90_PATH_A)\n\t\t\t\trtlhal->during_mac0init_radiob = false;\n\t\t\tif (rfpath == RF90_PATH_B) {\n\t\t\t\trtlhal->during_mac0init_radiob = true;\n\t\t\t\tmac0_initradiob_first = false;\n\t\t\t\tneed_pwrdown_radiob = true;\n\t\t\t\trfpath = RF90_PATH_A;\n\t\t\t\ttrue_bpath = true;\n\t\t\t\trtlphy->num_total_rfpath = 1;\n\t\t\t}\n\t\t}\n\t\tpphyreg = &rtlphy->phyreg_def[rfpath];\n\t\tswitch (rfpath) {\n\t\tcase RF90_PATH_A:\n\t\tcase RF90_PATH_C:\n\t\t\tu4_regvalue = rtl_get_bbreg(hw, pphyreg->rfintfs,\n\t\t\t\t\t\t    BRFSI_RFENV);\n\t\t\tbreak;\n\t\tcase RF90_PATH_B:\n\t\tcase RF90_PATH_D:\n\t\t\tu4_regvalue = rtl_get_bbreg(hw, pphyreg->rfintfs,\n\t\t\t\tBRFSI_RFENV << 16);\n\t\t\tbreak;\n\t\t}\n\t\trtl_set_bbreg(hw, pphyreg->rfintfe, BRFSI_RFENV << 16, 0x1);\n\t\tudelay(1);\n\t\trtl_set_bbreg(hw, pphyreg->rfintfo, BRFSI_RFENV, 0x1);\n\t\tudelay(1);\n\t\t \n\t\t \n\t\trtl_set_bbreg(hw, pphyreg->rfhssi_para2,\n\t\t\t      B3WIREADDRESSLENGTH, 0x0);\n\t\tudelay(1);\n\t\t \n\t\trtl_set_bbreg(hw, pphyreg->rfhssi_para2, B3WIREDATALENGTH, 0x0);\n\t\tudelay(1);\n\t\tswitch (rfpath) {\n\t\tcase RF90_PATH_A:\n\t\t\tif (true_bpath)\n\t\t\t\trtstatus = rtl92d_phy_config_rf_with_headerfile(\n\t\t\t\t\t\thw, radiob_txt,\n\t\t\t\t\t\t(enum radio_path)rfpath);\n\t\t\telse\n\t\t\t\trtstatus = rtl92d_phy_config_rf_with_headerfile(\n\t\t\t\t\t     hw, radioa_txt,\n\t\t\t\t\t     (enum radio_path)rfpath);\n\t\t\tbreak;\n\t\tcase RF90_PATH_B:\n\t\t\trtstatus =\n\t\t\t    rtl92d_phy_config_rf_with_headerfile(hw, radiob_txt,\n\t\t\t\t\t\t(enum radio_path) rfpath);\n\t\t\tbreak;\n\t\tcase RF90_PATH_C:\n\t\t\tbreak;\n\t\tcase RF90_PATH_D:\n\t\t\tbreak;\n\t\t}\n\t\tswitch (rfpath) {\n\t\tcase RF90_PATH_A:\n\t\tcase RF90_PATH_C:\n\t\t\trtl_set_bbreg(hw, pphyreg->rfintfs, BRFSI_RFENV,\n\t\t\t\t      u4_regvalue);\n\t\t\tbreak;\n\t\tcase RF90_PATH_B:\n\t\tcase RF90_PATH_D:\n\t\t\trtl_set_bbreg(hw, pphyreg->rfintfs, BRFSI_RFENV << 16,\n\t\t\t\t      u4_regvalue);\n\t\t\tbreak;\n\t\t}\n\t\tif (!rtstatus) {\n\t\t\trtl_dbg(rtlpriv, COMP_INIT, DBG_TRACE,\n\t\t\t\t\"Radio[%d] Fail!!\\n\", rfpath);\n\t\t\tgoto phy_rf_cfg_fail;\n\t\t}\n\n\t}\n\n\t \n\t \n\tif (need_pwrdown_radioa)\n\t\trtl92d_phy_powerdown_anotherphy(hw, false);\n\telse if (need_pwrdown_radiob)\n\t\trtl92d_phy_powerdown_anotherphy(hw, true);\n\trtl_dbg(rtlpriv, COMP_INIT, DBG_TRACE, \"<---\\n\");\n\treturn rtstatus;\n\nphy_rf_cfg_fail:\n\treturn rtstatus;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}