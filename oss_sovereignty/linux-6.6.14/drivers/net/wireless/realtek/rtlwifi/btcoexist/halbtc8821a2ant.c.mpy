{
  "module_name": "halbtc8821a2ant.c",
  "hash_id": "f5e0cec8e57f396b29fc1462b1dbe6b26e5960aafc9c3ee86c05d7c34324c188",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtlwifi/btcoexist/halbtc8821a2ant.c",
  "human_readable_source": "\n \n\n \n\n \n#include \"halbt_precomp.h\"\n \nstatic struct coex_dm_8821a_2ant glcoex_dm_8821a_2ant;\nstatic struct coex_dm_8821a_2ant *coex_dm = &glcoex_dm_8821a_2ant;\nstatic struct coex_sta_8821a_2ant glcoex_sta_8821a_2ant;\nstatic struct coex_sta_8821a_2ant *coex_sta = &glcoex_sta_8821a_2ant;\n\nstatic const char *const glbt_info_src_8821a_2ant[] = {\n\t\"BT Info[wifi fw]\",\n\t\"BT Info[bt rsp]\",\n\t\"BT Info[bt auto report]\",\n};\n\nstatic u32 glcoex_ver_date_8821a_2ant = 20130618;\nstatic u32 glcoex_ver_8821a_2ant = 0x5050;\n\n \nstatic u8 btc8821a2ant_bt_rssi_state(struct btc_coexist *btcoexist,\n\t\t\t\t     u8 level_num, u8 rssi_thresh,\n\t\t\t\t     u8 rssi_thresh1)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tlong bt_rssi = 0;\n\tu8 bt_rssi_state = coex_sta->pre_bt_rssi_state;\n\n\tbt_rssi = coex_sta->bt_rssi;\n\n\tif (level_num == 2) {\n\t\tif ((coex_sta->pre_bt_rssi_state == BTC_RSSI_STATE_LOW) ||\n\t\t    (coex_sta->pre_bt_rssi_state == BTC_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (bt_rssi >=\n\t\t\t    rssi_thresh + BTC_RSSI_COEX_THRESH_TOL_8821A_2ANT) {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state switch to High\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state stay at Low\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (bt_rssi < rssi_thresh) {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t} else if (level_num == 3) {\n\t\tif (rssi_thresh > rssi_thresh1) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], BT Rssi thresh error!!\\n\");\n\t\t\treturn coex_sta->pre_bt_rssi_state;\n\t\t}\n\n\t\tif ((coex_sta->pre_bt_rssi_state == BTC_RSSI_STATE_LOW) ||\n\t\t    (coex_sta->pre_bt_rssi_state == BTC_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (bt_rssi >=\n\t\t\t    (rssi_thresh +\n\t\t\t     BTC_RSSI_COEX_THRESH_TOL_8821A_2ANT)) {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state stay at Low\\n\");\n\t\t\t}\n\t\t} else if ((coex_sta->pre_bt_rssi_state ==\n\t\t\t   BTC_RSSI_STATE_MEDIUM) ||\n\t\t\t   (coex_sta->pre_bt_rssi_state ==\n\t\t\t    BTC_RSSI_STATE_STAY_MEDIUM)) {\n\t\t\tif (bt_rssi >=\n\t\t\t    (rssi_thresh1 +\n\t\t\t     BTC_RSSI_COEX_THRESH_TOL_8821A_2ANT)) {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state switch to High\\n\");\n\t\t\t} else if (bt_rssi < rssi_thresh) {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_STAY_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state stay at Medium\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (bt_rssi < rssi_thresh1) {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT Rssi state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t}\n\n\tcoex_sta->pre_bt_rssi_state = bt_rssi_state;\n\n\treturn bt_rssi_state;\n}\n\nstatic u8 btc8821a2ant_wifi_rssi_state(struct btc_coexist *btcoexist,\n\t\t\t\t       u8 index, u8 level_num,\n\t\t\t\t       u8 rssi_thresh, u8 rssi_thresh1)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tlong wifi_rssi = 0;\n\tu8 wifi_rssi_state = coex_sta->pre_wifi_rssi_state[index];\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_S4_WIFI_RSSI, &wifi_rssi);\n\n\tif (level_num == 2) {\n\t\tif ((coex_sta->pre_wifi_rssi_state[index] ==\n\t\t     BTC_RSSI_STATE_LOW) ||\n\t\t    (coex_sta->pre_wifi_rssi_state[index] ==\n\t\t     BTC_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (wifi_rssi >=\n\t\t\t    (rssi_thresh+BTC_RSSI_COEX_THRESH_TOL_8821A_2ANT)) {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state switch to High\\n\");\n\t\t\t} else {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state stay at Low\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (wifi_rssi < rssi_thresh) {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t} else if (level_num == 3) {\n\t\tif (rssi_thresh > rssi_thresh1) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], wifi RSSI thresh error!!\\n\");\n\t\t\treturn coex_sta->pre_wifi_rssi_state[index];\n\t\t}\n\n\t\tif ((coex_sta->pre_wifi_rssi_state[index] ==\n\t\t    BTC_RSSI_STATE_LOW) ||\n\t\t    (coex_sta->pre_wifi_rssi_state[index] ==\n\t\t     BTC_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (wifi_rssi >=\n\t\t\t    (rssi_thresh +\n\t\t\t     BTC_RSSI_COEX_THRESH_TOL_8821A_2ANT)) {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state stay at Low\\n\");\n\t\t\t}\n\t\t} else if ((coex_sta->pre_wifi_rssi_state[index] ==\n\t\t\t   BTC_RSSI_STATE_MEDIUM) ||\n\t\t\t   (coex_sta->pre_wifi_rssi_state[index] ==\n\t\t\t    BTC_RSSI_STATE_STAY_MEDIUM)) {\n\t\t\tif (wifi_rssi >= (rssi_thresh1 +\n\t\t\t    BTC_RSSI_COEX_THRESH_TOL_8821A_2ANT)) {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state switch to High\\n\");\n\t\t\t} else if (wifi_rssi < rssi_thresh) {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_STAY_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state stay at Medium\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (wifi_rssi < rssi_thresh1) {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\twifi_rssi_state = BTC_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], wifi RSSI state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t}\n\tcoex_sta->pre_wifi_rssi_state[index] = wifi_rssi_state;\n\n\treturn wifi_rssi_state;\n}\n\nstatic\nvoid btc8821a2ant_limited_rx(struct btc_coexist *btcoexist, bool force_exec,\n\t\t\t     bool rej_ap_agg_pkt, bool bt_ctrl_agg_buf_size,\n\t\t\t     u8 agg_buf_size)\n{\n\tbool reject_rx_agg = rej_ap_agg_pkt;\n\tbool bt_ctrl_rx_agg_size = bt_ctrl_agg_buf_size;\n\tu8 rx_agg_size = agg_buf_size;\n\n\t \n\tbtcoexist->btc_set(btcoexist, BTC_SET_BL_TO_REJ_AP_AGG_PKT,\n\t\t\t   &reject_rx_agg);\n\t \n\tbtcoexist->btc_set(btcoexist, BTC_SET_BL_BT_CTRL_AGG_SIZE,\n\t\t\t   &bt_ctrl_rx_agg_size);\n\t \n\tbtcoexist->btc_set(btcoexist, BTC_SET_U1_AGG_BUF_SIZE, &rx_agg_size);\n\t \n\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_AGGREGATE_CTRL, NULL);\n}\n\nstatic void btc8821a2ant_monitor_bt_ctr(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tstruct btc_bt_link_info *bt_link_info = &btcoexist->bt_link_info;\n\tu32 reg_hp_txrx, reg_lp_txrx, u4tmp;\n\tu32 reg_hp_tx = 0, reg_hp_rx = 0, reg_lp_tx = 0, reg_lp_rx = 0;\n\n\treg_hp_txrx = 0x770;\n\treg_lp_txrx = 0x774;\n\n\tu4tmp = btcoexist->btc_read_4byte(btcoexist, reg_hp_txrx);\n\treg_hp_tx = u4tmp & MASKLWORD;\n\treg_hp_rx = (u4tmp & MASKHWORD) >> 16;\n\n\tu4tmp = btcoexist->btc_read_4byte(btcoexist, reg_lp_txrx);\n\treg_lp_tx = u4tmp & MASKLWORD;\n\treg_lp_rx = (u4tmp & MASKHWORD) >> 16;\n\n\tcoex_sta->high_priority_tx = reg_hp_tx;\n\tcoex_sta->high_priority_rx = reg_hp_rx;\n\tcoex_sta->low_priority_tx = reg_lp_tx;\n\tcoex_sta->low_priority_rx = reg_lp_rx;\n\n\tif ((coex_sta->low_priority_rx >= 950) &&\n\t    (coex_sta->low_priority_rx >= coex_sta->low_priority_tx) &&\n\t    (!coex_sta->under_ips))\n\t\tbt_link_info->slave_role = true;\n\telse\n\t\tbt_link_info->slave_role = false;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], High Priority Tx/Rx (reg 0x%x) = 0x%x(%d)/0x%x(%d)\\n\",\n\t\treg_hp_txrx, reg_hp_tx, reg_hp_tx, reg_hp_rx, reg_hp_rx);\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Low Priority Tx/Rx (reg 0x%x) = 0x%x(%d)/0x%x(%d)\\n\",\n\t\treg_lp_txrx, reg_lp_tx, reg_lp_tx, reg_lp_rx, reg_lp_rx);\n\n\t \n\tbtcoexist->btc_write_1byte(btcoexist, 0x76e, 0xc);\n}\n\nstatic void btc8821a2ant_monitor_wifi_ctr(struct btc_coexist *btcoexist)\n{\n\tif (coex_sta->under_ips) {\n\t\tcoex_sta->crc_ok_cck = 0;\n\t\tcoex_sta->crc_ok_11g = 0;\n\t\tcoex_sta->crc_ok_11n = 0;\n\t\tcoex_sta->crc_ok_11n_agg = 0;\n\n\t\tcoex_sta->crc_err_cck = 0;\n\t\tcoex_sta->crc_err_11g = 0;\n\t\tcoex_sta->crc_err_11n = 0;\n\t\tcoex_sta->crc_err_11n_agg = 0;\n\t} else {\n\t\tcoex_sta->crc_ok_cck =\n\t\t\tbtcoexist->btc_read_4byte(btcoexist, 0xf88);\n\t\tcoex_sta->crc_ok_11g =\n\t\t\tbtcoexist->btc_read_2byte(btcoexist, 0xf94);\n\t\tcoex_sta->crc_ok_11n =\n\t\t\tbtcoexist->btc_read_2byte(btcoexist, 0xf90);\n\t\tcoex_sta->crc_ok_11n_agg =\n\t\t\tbtcoexist->btc_read_2byte(btcoexist, 0xfb8);\n\n\t\tcoex_sta->crc_err_cck =\n\t\t\tbtcoexist->btc_read_4byte(btcoexist, 0xf84);\n\t\tcoex_sta->crc_err_11g =\n\t\t\tbtcoexist->btc_read_2byte(btcoexist, 0xf96);\n\t\tcoex_sta->crc_err_11n =\n\t\t\tbtcoexist->btc_read_2byte(btcoexist, 0xf92);\n\t\tcoex_sta->crc_err_11n_agg =\n\t\t\tbtcoexist->btc_read_2byte(btcoexist, 0xfba);\n\t}\n\n\t \n\tbtcoexist->btc_write_1byte_bitmask(btcoexist, 0xf16, 0x1, 0x1);\n\tbtcoexist->btc_write_1byte_bitmask(btcoexist, 0xf16, 0x1, 0x0);\n}\n\nstatic void btc8821a2ant_query_bt_info(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 h2c_parameter[1] = {0};\n\n\tcoex_sta->c2h_bt_info_req_sent = true;\n\n\th2c_parameter[0] |= BIT0;  \n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Query Bt Info, FW write 0x61 = 0x%x\\n\",\n\t\th2c_parameter[0]);\n\n\tbtcoexist->btc_fill_h2c(btcoexist, 0x61, 1, h2c_parameter);\n}\n\nstatic bool btc8821a2ant_is_wifi_status_changed(struct btc_coexist *btcoexist)\n{\n\tstatic bool pre_wifi_busy = true;\n\tstatic bool pre_under_4way = true;\n\tstatic bool pre_bt_hs_on = true;\n\tbool wifi_busy = false, under_4way = false, bt_hs_on = false;\n\tbool wifi_connected = false;\n\tu8 wifi_rssi_state = BTC_RSSI_STATE_HIGH;\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_CONNECTED,\n\t\t\t   &wifi_connected);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_BUSY, &wifi_busy);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_HS_OPERATION, &bt_hs_on);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_4_WAY_PROGRESS,\n\t\t\t   &under_4way);\n\n\tif (wifi_connected) {\n\t\tif (wifi_busy != pre_wifi_busy) {\n\t\t\tpre_wifi_busy = wifi_busy;\n\t\t\treturn true;\n\t\t}\n\t\tif (under_4way != pre_under_4way) {\n\t\t\tpre_under_4way = under_4way;\n\t\t\treturn true;\n\t\t}\n\t\tif (bt_hs_on != pre_bt_hs_on) {\n\t\t\tpre_bt_hs_on = bt_hs_on;\n\t\t\treturn true;\n\t\t}\n\n\t\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 3, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_LOW))\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nstatic void btc8821a2ant_update_bt_link_info(struct btc_coexist *btcoexist)\n{\n\tstruct btc_bt_link_info *bt_link_info = &btcoexist->bt_link_info;\n\tbool bt_hs_on = false;\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_HS_OPERATION, &bt_hs_on);\n\n\tbt_link_info->bt_link_exist = coex_sta->bt_link_exist;\n\tbt_link_info->sco_exist = coex_sta->sco_exist;\n\tbt_link_info->a2dp_exist = coex_sta->a2dp_exist;\n\tbt_link_info->pan_exist = coex_sta->pan_exist;\n\tbt_link_info->hid_exist = coex_sta->hid_exist;\n\n\t \n\tif (bt_hs_on) {\n\t\tbt_link_info->pan_exist = true;\n\t\tbt_link_info->bt_link_exist = true;\n\t}\n\n\t \n\tif (bt_link_info->sco_exist && !bt_link_info->a2dp_exist &&\n\t    !bt_link_info->pan_exist && !bt_link_info->hid_exist)\n\t\tbt_link_info->sco_only = true;\n\telse\n\t\tbt_link_info->sco_only = false;\n\n\t \n\tif (!bt_link_info->sco_exist && bt_link_info->a2dp_exist &&\n\t    !bt_link_info->pan_exist && !bt_link_info->hid_exist)\n\t\tbt_link_info->a2dp_only = true;\n\telse\n\t\tbt_link_info->a2dp_only = false;\n\n\t \n\tif (!bt_link_info->sco_exist && !bt_link_info->a2dp_exist &&\n\t    bt_link_info->pan_exist && !bt_link_info->hid_exist)\n\t\tbt_link_info->pan_only = true;\n\telse\n\t\tbt_link_info->pan_only = false;\n\n\t \n\tif (!bt_link_info->sco_exist && !bt_link_info->a2dp_exist &&\n\t    !bt_link_info->pan_exist && bt_link_info->hid_exist)\n\t\tbt_link_info->hid_only = true;\n\telse\n\t\tbt_link_info->hid_only = false;\n}\n\nstatic u8 btc8821a2ant_action_algorithm(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tstruct btc_bt_link_info *bt_link_info = &btcoexist->bt_link_info;\n\tbool bt_hs_on = false;\n\tu8 algorithm = BT_8821A_2ANT_COEX_ALGO_UNDEFINED;\n\tu8 num_of_diff_profile = 0;\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_HS_OPERATION, &bt_hs_on);\n\n\tif (!bt_link_info->bt_link_exist) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], No BT link exists!!!\\n\");\n\t\treturn algorithm;\n\t}\n\n\tif (bt_link_info->sco_exist)\n\t\tnum_of_diff_profile++;\n\tif (bt_link_info->hid_exist)\n\t\tnum_of_diff_profile++;\n\tif (bt_link_info->pan_exist)\n\t\tnum_of_diff_profile++;\n\tif (bt_link_info->a2dp_exist)\n\t\tnum_of_diff_profile++;\n\n\tif (num_of_diff_profile == 1) {\n\t\tif (bt_link_info->sco_exist) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], SCO only\\n\");\n\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t} else {\n\t\t\tif (bt_link_info->hid_exist) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], HID only\\n\");\n\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_HID;\n\t\t\t} else if (bt_link_info->a2dp_exist) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], A2DP only\\n\");\n\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_A2DP;\n\t\t\t} else if (bt_link_info->pan_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], PAN(HS) only\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_PANHS;\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], PAN(EDR) only\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_PANEDR;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (num_of_diff_profile == 2) {\n\t\tif (bt_link_info->sco_exist) {\n\t\t\tif (bt_link_info->hid_exist) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], SCO + HID\\n\");\n\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t} else if (bt_link_info->a2dp_exist) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], SCO + A2DP ==> SCO\\n\");\n\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t} else if (bt_link_info->pan_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], SCO + PAN(HS)\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], SCO + PAN(EDR)\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (bt_link_info->hid_exist &&\n\t\t\t    bt_link_info->a2dp_exist) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], HID + A2DP\\n\");\n\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_HID_A2DP;\n\t\t\t} else if (bt_link_info->hid_exist &&\n\t\t\t\tbt_link_info->pan_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], HID + PAN(HS)\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_HID;\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], HID + PAN(EDR)\\n\");\n\t\t\t\t\talgorithm =\n\t\t\t\t\t    BT_8821A_2ANT_COEX_ALGO_PANEDR_HID;\n\t\t\t\t}\n\t\t\t} else if (bt_link_info->pan_exist &&\n\t\t\t\tbt_link_info->a2dp_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], A2DP + PAN(HS)\\n\");\n\t\t\t\t\talgorithm =\n\t\t\t\t\t    BT_8821A_2ANT_COEX_ALGO_A2DP_PANHS;\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], A2DP + PAN(EDR)\\n\");\n\t\t\t\t\talgorithm =\n\t\t\t\t\t    BT_8821A_2ANT_COEX_ALGO_PANEDR_A2DP;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (num_of_diff_profile == 3) {\n\t\tif (bt_link_info->sco_exist) {\n\t\t\tif (bt_link_info->hid_exist &&\n\t\t\t    bt_link_info->a2dp_exist) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], SCO + HID + A2DP ==> HID\\n\");\n\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t} else if (bt_link_info->hid_exist &&\n\t\t\t\tbt_link_info->pan_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], SCO + HID + PAN(HS)\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], SCO + HID + PAN(EDR)\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t\t}\n\t\t\t} else if (bt_link_info->pan_exist &&\n\t\t\t\t   bt_link_info->a2dp_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], SCO + A2DP + PAN(HS)\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], SCO + A2DP + PAN(EDR) ==> HID\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (bt_link_info->hid_exist &&\n\t\t\t    bt_link_info->pan_exist &&\n\t\t\t    bt_link_info->a2dp_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], HID + A2DP + PAN(HS)\\n\");\n\t\t\t\t\talgorithm =\n\t\t\t\t\t    BT_8821A_2ANT_COEX_ALGO_HID_A2DP;\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], HID + A2DP + PAN(EDR)\\n\");\n\t\t\t\t\talgorithm =\n\t\t\t\t\tBT_8821A_2ANT_COEX_ALGO_HID_A2DP_PANEDR;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else if (num_of_diff_profile >= 3) {\n\t\tif (bt_link_info->sco_exist) {\n\t\t\tif (bt_link_info->hid_exist &&\n\t\t\t    bt_link_info->pan_exist &&\n\t\t\t    bt_link_info->a2dp_exist) {\n\t\t\t\tif (bt_hs_on) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], Error!!! SCO + HID + A2DP + PAN(HS)\\n\");\n\n\t\t\t\t} else {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], SCO + HID + A2DP + PAN(EDR)==>PAN(EDR)+HID\\n\");\n\t\t\t\t\talgorithm = BT_8821A_2ANT_COEX_ALGO_SCO;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn algorithm;\n}\n\nstatic void btc8821a2ant_set_fw_dac_swing_lvl(struct btc_coexist *btcoexist,\n\t\t\t\t\t      u8 dac_swing_lvl)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 h2c_parameter[1] = {0};\n\n\t \n\th2c_parameter[0] = dac_swing_lvl;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Set Dac Swing Level = 0x%x\\n\", dac_swing_lvl);\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], FW write 0x64 = 0x%x\\n\", h2c_parameter[0]);\n\n\tbtcoexist->btc_fill_h2c(btcoexist, 0x64, 1, h2c_parameter);\n}\n\nstatic void btc8821a2ant_set_fw_dec_bt_pwr(struct btc_coexist *btcoexist,\n\t\t\t\t\t   u8 dec_bt_pwr_lvl)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 h2c_parameter[1] = {0};\n\n\th2c_parameter[0] = dec_bt_pwr_lvl;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], decrease Bt Power Level : %u, FW write 0x62 = 0x%x\\n\",\n\t\tdec_bt_pwr_lvl, h2c_parameter[0]);\n\n\tbtcoexist->btc_fill_h2c(btcoexist, 0x62, 1, h2c_parameter);\n}\n\nstatic void btc8821a2ant_dec_bt_pwr(struct btc_coexist *btcoexist,\n\t\t\t\t    bool force_exec, u8 dec_bt_pwr_lvl)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], %s Dec BT power level = %u\\n\",\n\t\t(force_exec ? \"force to\" : \"\"), dec_bt_pwr_lvl);\n\tcoex_dm->cur_dec_bt_pwr_lvl = dec_bt_pwr_lvl;\n\n\tif (!force_exec) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_dec_bt_pwr_lvl = %d, cur_dec_bt_pwr_lvl = %d\\n\",\n\t\t\tcoex_dm->pre_dec_bt_pwr_lvl,\n\t\t\t    coex_dm->cur_dec_bt_pwr_lvl);\n\n\t\tif (coex_dm->pre_dec_bt_pwr_lvl == coex_dm->cur_dec_bt_pwr_lvl)\n\t\t\treturn;\n\t}\n\tbtc8821a2ant_set_fw_dec_bt_pwr(btcoexist, coex_dm->cur_dec_bt_pwr_lvl);\n\n\tcoex_dm->pre_dec_bt_pwr_lvl = coex_dm->cur_dec_bt_pwr_lvl;\n}\n\nstatic void btc8821a2ant_fw_dac_swing_lvl(struct btc_coexist *btcoexist,\n\t\t\t\t\t  bool force_exec, u8 fw_dac_swing_lvl)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], %s set FW Dac Swing level = %d\\n\",\n\t\t(force_exec ? \"force to\" : \"\"), fw_dac_swing_lvl);\n\tcoex_dm->cur_fw_dac_swing_lvl = fw_dac_swing_lvl;\n\n\tif (!force_exec) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_fw_dac_swing_lvl = %d, cur_fw_dac_swing_lvl = %d\\n\",\n\t\t\tcoex_dm->pre_fw_dac_swing_lvl,\n\t\t\tcoex_dm->cur_fw_dac_swing_lvl);\n\n\t\tif (coex_dm->pre_fw_dac_swing_lvl ==\n\t\t    coex_dm->cur_fw_dac_swing_lvl)\n\t\t\treturn;\n\t}\n\n\tbtc8821a2ant_set_fw_dac_swing_lvl(btcoexist,\n\t\t\t\t\t  coex_dm->cur_fw_dac_swing_lvl);\n\n\tcoex_dm->pre_fw_dac_swing_lvl = coex_dm->cur_fw_dac_swing_lvl;\n}\n\nstatic void btc8821a2ant_set_sw_penalty_tx_rate_adaptive(\n\t\tstruct btc_coexist *btcoexist, bool low_penalty_ra)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 h2c_parameter[6] = {0};\n\n\th2c_parameter[0] = 0x6;\t \n\n\tif (low_penalty_ra) {\n\t\th2c_parameter[1] |= BIT0;\n\t\t \n\t\th2c_parameter[2] = 0x00;\n\t\t \n\t\th2c_parameter[3] = 0xf5;\n\t\t \n\t\th2c_parameter[4] = 0xa0;\n\t\t \n\t\th2c_parameter[5] = 0xa0;\n\t}\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], set WiFi Low-Penalty Retry: %s\",\n\t\t(low_penalty_ra ? \"ON!!\" : \"OFF!!\"));\n\n\tbtcoexist->btc_fill_h2c(btcoexist, 0x69, 6, h2c_parameter);\n}\n\nstatic void btc8821a2ant_low_penalty_ra(struct btc_coexist *btcoexist,\n\t\t\t\t\tbool force_exec, bool low_penalty_ra)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], %s turn LowPenaltyRA = %s\\n\",\n\t\t(force_exec ? \"force to\" : \"\"),\n\t\t((low_penalty_ra) ? \"ON\" : \"OFF\"));\n\tcoex_dm->cur_low_penalty_ra = low_penalty_ra;\n\n\tif (!force_exec) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_low_penalty_ra = %d, cur_low_penalty_ra = %d\\n\",\n\t\t\tcoex_dm->pre_low_penalty_ra,\n\t\t\tcoex_dm->cur_low_penalty_ra);\n\n\t\tif (coex_dm->pre_low_penalty_ra == coex_dm->cur_low_penalty_ra)\n\t\t\treturn;\n\t}\n\tbtc8821a2ant_set_sw_penalty_tx_rate_adaptive(btcoexist,\n\t\t\t\t\t coex_dm->cur_low_penalty_ra);\n\n\tcoex_dm->pre_low_penalty_ra = coex_dm->cur_low_penalty_ra;\n}\n\nstatic void btc8821a2ant_set_dac_swing_reg(struct btc_coexist *btcoexist,\n\t\t\t\t\t   u32 level)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 val = (u8)level;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Write SwDacSwing = 0x%x\\n\", level);\n\tbtcoexist->btc_write_1byte_bitmask(btcoexist, 0xc5b, 0x3e, val);\n}\n\nstatic void btc8821a2ant_set_sw_full_dac_swing(struct btc_coexist *btcoexist,\n\t\t\t\t\t       bool sw_dac_swing_on,\n\t\t\t\t\t       u32 sw_dac_swing_lvl)\n{\n\tif (sw_dac_swing_on)\n\t\tbtc8821a2ant_set_dac_swing_reg(btcoexist, sw_dac_swing_lvl);\n\telse\n\t\tbtc8821a2ant_set_dac_swing_reg(btcoexist, 0x18);\n}\n\nstatic void btc8821a2ant_dac_swing(struct btc_coexist *btcoexist,\n\t\t\t\t   bool force_exec, bool dac_swing_on,\n\t\t\t\t   u32 dac_swing_lvl)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], %s turn DacSwing = %s, dac_swing_lvl = 0x%x\\n\",\n\t\t(force_exec ? \"force to\" : \"\"),\n\t\t((dac_swing_on) ? \"ON\" : \"OFF\"),\n\t\tdac_swing_lvl);\n\tcoex_dm->cur_dac_swing_on = dac_swing_on;\n\tcoex_dm->cur_dac_swing_lvl = dac_swing_lvl;\n\n\tif (!force_exec) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_dac_swing_on = %d, pre_dac_swing_lvl = 0x%x, cur_dac_swing_on = %d, cur_dac_swing_lvl = 0x%x\\n\",\n\t\t\tcoex_dm->pre_dac_swing_on,\n\t\t\tcoex_dm->pre_dac_swing_lvl,\n\t\t\tcoex_dm->cur_dac_swing_on,\n\t\t\tcoex_dm->cur_dac_swing_lvl);\n\n\t\tif ((coex_dm->pre_dac_swing_on == coex_dm->cur_dac_swing_on) &&\n\t\t    (coex_dm->pre_dac_swing_lvl ==\n\t\t     coex_dm->cur_dac_swing_lvl))\n\t\t\treturn;\n\t}\n\tmdelay(30);\n\tbtc8821a2ant_set_sw_full_dac_swing(btcoexist, dac_swing_on,\n\t\t\t\t\t   dac_swing_lvl);\n\n\tcoex_dm->pre_dac_swing_on = coex_dm->cur_dac_swing_on;\n\tcoex_dm->pre_dac_swing_lvl = coex_dm->cur_dac_swing_lvl;\n}\n\nstatic void btc8821a2ant_set_coex_table(struct btc_coexist *btcoexist,\n\t\t\t\t\tu32 val0x6c0, u32 val0x6c4,\n\t\t\t\t\tu32 val0x6c8, u8 val0x6cc)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], set coex table, set 0x6c0 = 0x%x\\n\", val0x6c0);\n\tbtcoexist->btc_write_4byte(btcoexist, 0x6c0, val0x6c0);\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], set coex table, set 0x6c4 = 0x%x\\n\", val0x6c4);\n\tbtcoexist->btc_write_4byte(btcoexist, 0x6c4, val0x6c4);\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], set coex table, set 0x6c8 = 0x%x\\n\", val0x6c8);\n\tbtcoexist->btc_write_4byte(btcoexist, 0x6c8, val0x6c8);\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], set coex table, set 0x6cc = 0x%x\\n\", val0x6cc);\n\tbtcoexist->btc_write_1byte(btcoexist, 0x6cc, val0x6cc);\n}\n\nstatic void btc8821a2ant_coex_table(struct btc_coexist *btcoexist,\n\t\t\t\t    bool force_exec, u32 val0x6c0,\n\t\t\t\t    u32 val0x6c4, u32 val0x6c8, u8 val0x6cc)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], %s write Coex Table 0x6c0 = 0x%x, 0x6c4 = 0x%x, 0x6c8 = 0x%x, 0x6cc = 0x%x\\n\",\n\t\t(force_exec ? \"force to\" : \"\"),\n\t\tval0x6c0, val0x6c4, val0x6c8, val0x6cc);\n\tcoex_dm->cur_val0x6c0 = val0x6c0;\n\tcoex_dm->cur_val0x6c4 = val0x6c4;\n\tcoex_dm->cur_val0x6c8 = val0x6c8;\n\tcoex_dm->cur_val0x6cc = val0x6cc;\n\n\tif (!force_exec) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_val0x6c0 = 0x%x, pre_val0x6c4 = 0x%x, pre_val0x6c8 = 0x%x, pre_val0x6cc = 0x%x !!\\n\",\n\t\t\tcoex_dm->pre_val0x6c0,\n\t\t\tcoex_dm->pre_val0x6c4,\n\t\t\tcoex_dm->pre_val0x6c8,\n\t\t\tcoex_dm->pre_val0x6cc);\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], cur_val0x6c0 = 0x%x, cur_val0x6c4 = 0x%x, cur_val0x6c8 = 0x%x, cur_val0x6cc = 0x%x !!\\n\",\n\t\t\tcoex_dm->cur_val0x6c0,\n\t\t\tcoex_dm->cur_val0x6c4,\n\t\t\tcoex_dm->cur_val0x6c8,\n\t\t\tcoex_dm->cur_val0x6cc);\n\n\t\tif ((coex_dm->pre_val0x6c0 == coex_dm->cur_val0x6c0) &&\n\t\t    (coex_dm->pre_val0x6c4 == coex_dm->cur_val0x6c4) &&\n\t\t    (coex_dm->pre_val0x6c8 == coex_dm->cur_val0x6c8) &&\n\t\t    (coex_dm->pre_val0x6cc == coex_dm->cur_val0x6cc))\n\t\t\treturn;\n\t}\n\tbtc8821a2ant_set_coex_table(btcoexist, val0x6c0, val0x6c4, val0x6c8,\n\t\t\t\t    val0x6cc);\n\n\tcoex_dm->pre_val0x6c0 = coex_dm->cur_val0x6c0;\n\tcoex_dm->pre_val0x6c4 = coex_dm->cur_val0x6c4;\n\tcoex_dm->pre_val0x6c8 = coex_dm->cur_val0x6c8;\n\tcoex_dm->pre_val0x6cc = coex_dm->cur_val0x6cc;\n}\n\nstatic void btc8821a2ant_coex_table_with_type(struct btc_coexist *btcoexist,\n\t\t\t\t\t      bool force_exec, u8 type)\n{\n\tcoex_sta->coex_table_type = type;\n\n\tswitch (type) {\n\tcase 0:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55555555,\n\t\t\t\t\t0x55555555, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 1:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55555555,\n\t\t\t\t\t0x5afa5afa, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 2:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x5ada5ada,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 3:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0xaaaaaaaa,\n\t\t\t\t\t0xaaaaaaaa, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 4:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0xffffffff,\n\t\t\t\t\t0xffffffff, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 5:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x5fff5fff,\n\t\t\t\t\t0x5fff5fff, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 6:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55ff55ff,\n\t\t\t\t\t0x5a5a5a5a, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 7:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55dd55dd,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 8:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55dd55dd,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 9:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55dd55dd,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 10:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55dd55dd,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 11:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55dd55dd,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 12:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55dd55dd,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 13:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x5fff5fff,\n\t\t\t\t\t0xaaaaaaaa, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 14:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x5fff5fff,\n\t\t\t\t\t0x5ada5ada, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 15:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x55dd55dd,\n\t\t\t\t\t0xaaaaaaaa, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 16:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0x5fdf5fdf,\n\t\t\t\t\t0x5fdb5fdb, 0xffffff, 0x3);\n\t\tbreak;\n\tcase 17:\n\t\tbtc8821a2ant_coex_table(btcoexist, force_exec, 0xfafafafa,\n\t\t\t\t\t0xfafafafa, 0xffffff, 0x3);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void btc8821a2ant_set_fw_ignore_wlan_act(struct btc_coexist *btcoex,\n\t\t\t\t\t\tbool enable)\n{\n\tstruct rtl_priv *rtlpriv = btcoex->adapter;\n\tu8 h2c_parameter[1] = {0};\n\n\tif (enable)\n\t\th2c_parameter[0] |= BIT0;  \n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], set FW for BT Ignore Wlan_Act, FW write 0x63 = 0x%x\\n\",\n\t\th2c_parameter[0]);\n\n\tbtcoex->btc_fill_h2c(btcoex, 0x63, 1, h2c_parameter);\n}\n\nstatic void btc8821a2ant_set_lps_rpwm(struct btc_coexist *btcoexist, u8 lps_val,\n\t\t\t\t      u8 rpwm_val)\n{\n\tu8 lps = lps_val;\n\tu8 rpwm = rpwm_val;\n\n\tbtcoexist->btc_set(btcoexist, BTC_SET_U1_LPS_VAL, &lps);\n\tbtcoexist->btc_set(btcoexist, BTC_SET_U1_RPWM_VAL, &rpwm);\n}\n\nstatic void btc8821a2ant_lps_rpwm(struct btc_coexist *btcoexist,\n\t\t\t\t  bool force_exec, u8 lps_val, u8 rpwm_val)\n{\n\tcoex_dm->cur_lps = lps_val;\n\tcoex_dm->cur_rpwm = rpwm_val;\n\n\tif (!force_exec) {\n\t\tif ((coex_dm->pre_lps == coex_dm->cur_lps) &&\n\t\t    (coex_dm->pre_rpwm == coex_dm->cur_rpwm))\n\t\t\treturn;\n\t}\n\tbtc8821a2ant_set_lps_rpwm(btcoexist, lps_val, rpwm_val);\n\n\tcoex_dm->pre_lps = coex_dm->cur_lps;\n\tcoex_dm->pre_rpwm = coex_dm->cur_rpwm;\n}\n\nstatic void btc8821a2ant_ignore_wlan_act(struct btc_coexist *btcoexist,\n\t\t\t\t\t bool force_exec, bool enable)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], %s turn Ignore WlanAct %s\\n\",\n\t\t(force_exec ? \"force to\" : \"\"), (enable ? \"ON\" : \"OFF\"));\n\tcoex_dm->cur_ignore_wlan_act = enable;\n\n\tif (!force_exec) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_ignore_wlan_act = %d, cur_ignore_wlan_act = %d!!\\n\",\n\t\t\tcoex_dm->pre_ignore_wlan_act,\n\t\t\t coex_dm->cur_ignore_wlan_act);\n\n\t\tif (coex_dm->pre_ignore_wlan_act ==\n\t\t    coex_dm->cur_ignore_wlan_act)\n\t\t\treturn;\n\t}\n\tbtc8821a2ant_set_fw_ignore_wlan_act(btcoexist, enable);\n\n\tcoex_dm->pre_ignore_wlan_act = coex_dm->cur_ignore_wlan_act;\n}\n\nstatic void btc8821a2ant_set_fw_ps_tdma(struct btc_coexist *btcoexist,\n\t\t\t\t\tu8 byte1, u8 byte2, u8 byte3,\n\t\t\t\t\tu8 byte4, u8 byte5)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 h2c_parameter[5];\n\n\th2c_parameter[0] = byte1;\n\th2c_parameter[1] = byte2;\n\th2c_parameter[2] = byte3;\n\th2c_parameter[3] = byte4;\n\th2c_parameter[4] = byte5;\n\n\tcoex_dm->ps_tdma_para[0] = byte1;\n\tcoex_dm->ps_tdma_para[1] = byte2;\n\tcoex_dm->ps_tdma_para[2] = byte3;\n\tcoex_dm->ps_tdma_para[3] = byte4;\n\tcoex_dm->ps_tdma_para[4] = byte5;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], FW write 0x60(5bytes) = 0x%x%08x\\n\",\n\t\th2c_parameter[0],\n\t\th2c_parameter[1] << 24 |\n\t\th2c_parameter[2] << 16 |\n\t\th2c_parameter[3] << 8 |\n\t\th2c_parameter[4]);\n\n\tbtcoexist->btc_fill_h2c(btcoexist, 0x60, 5, h2c_parameter);\n}\n\nstatic void btc8821a2ant_sw_mechanism1(struct btc_coexist *btcoexist,\n\t\t\t\t       bool shrink_rx_lpf, bool low_penalty_ra,\n\t\t\t\t       bool limited_dig, bool bt_lna_constrain)\n{\n\tbtc8821a2ant_low_penalty_ra(btcoexist, NORMAL_EXEC, low_penalty_ra);\n}\n\nstatic void btc8821a2ant_sw_mechanism2(struct btc_coexist *btcoexist,\n\t\t\t\t       bool agc_table_shift, bool adc_back_off,\n\t\t\t\t       bool sw_dac_swing, u32 dac_swing_lvl)\n{\n\tbtc8821a2ant_dac_swing(btcoexist, NORMAL_EXEC, sw_dac_swing,\n\t\t\t       dac_swing_lvl);\n}\n\nstatic void btc8821a2ant_set_ant_path(struct btc_coexist *btcoexist,\n\t\t\t\t      u8 ant_pos_type, bool init_hw_cfg,\n\t\t\t\t      bool wifi_off)\n{\n\tstruct btc_board_info *board_info = &btcoexist->board_info;\n\tu32 u4tmp = 0;\n\tu8 h2c_parameter[2] = {0};\n\n\tif (init_hw_cfg) {\n\t\t \n\t\tu4tmp = btcoexist->btc_read_4byte(btcoexist, 0x4c);\n\t\tu4tmp &= ~BIT23;\n\t\tu4tmp |= BIT24;\n\t\tbtcoexist->btc_write_4byte(btcoexist, 0x4c, u4tmp);\n\n\t\tbtcoexist->btc_write_4byte(btcoexist, 0x974, 0x3ff);\n\n\t\tif (board_info->btdm_ant_pos == BTC_ANTENNA_AT_MAIN_PORT) {\n\t\t\t \n\t\t\th2c_parameter[0] = 1;\n\t\t\th2c_parameter[1] = 1;\n\t\t\tbtcoexist->btc_fill_h2c(btcoexist, 0x65, 2,\n\t\t\t\t\t\th2c_parameter);\n\t\t} else {\n\t\t\t \n\t\t\th2c_parameter[0] = 0;\n\t\t\th2c_parameter[1] = 1;\n\t\t\tbtcoexist->btc_fill_h2c(btcoexist, 0x65, 2,\n\t\t\t\t\t\th2c_parameter);\n\t\t}\n\t}\n\n\t \n\tswitch (ant_pos_type) {\n\tcase BTC_ANT_WIFI_AT_MAIN:\n\t\tbtcoexist->btc_write_1byte_bitmask(btcoexist, 0xcb7, 0x30, 0x1);\n\t\tbreak;\n\tcase BTC_ANT_WIFI_AT_AUX:\n\t\tbtcoexist->btc_write_1byte_bitmask(btcoexist, 0xcb7, 0x30, 0x2);\n\t\tbreak;\n\t}\n}\n\nstatic void btc8821a2ant_ps_tdma(struct btc_coexist *btcoexist,\n\t\t\t\t bool force_exec, bool turn_on, u8 type)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\tu8 wifi_rssi_state, bt_rssi_state;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist, 2,\n\t\t\t\tBT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tif (!(BTC_RSSI_HIGH(wifi_rssi_state) &&\n\t      BTC_RSSI_HIGH(bt_rssi_state)) &&\n\t    turn_on) {\n\t\t \n\t\ttype = type + 100;\n\t}\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], %s turn %s PS TDMA, type = %d\\n\",\n\t\t(force_exec ? \"force to\" : \"\"), (turn_on ? \"ON\" : \"OFF\"),\n\t\ttype);\n\tcoex_dm->cur_ps_tdma_on = turn_on;\n\tcoex_dm->cur_ps_tdma = type;\n\n\tif (!force_exec) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_ps_tdma_on = %d, cur_ps_tdma_on = %d!!\\n\",\n\t\t\tcoex_dm->pre_ps_tdma_on, coex_dm->cur_ps_tdma_on);\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], pre_ps_tdma = %d, cur_ps_tdma = %d!!\\n\",\n\t\t\tcoex_dm->pre_ps_tdma, coex_dm->cur_ps_tdma);\n\n\t\tif ((coex_dm->pre_ps_tdma_on == coex_dm->cur_ps_tdma_on) &&\n\t\t    (coex_dm->pre_ps_tdma == coex_dm->cur_ps_tdma))\n\t\t\treturn;\n\t}\n\tif (turn_on) {\n\t\tswitch (type) {\n\t\tcase 1:\n\t\tdefault:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x3c,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x2d,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x1c,\n\t\t\t\t\t\t    0x3, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 4:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x10,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 5:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x3c,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 6:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x2d,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 7:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x1c,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 8:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xa3, 0x10,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 9:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x3c,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 10:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x2d,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 11:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x1c,\n\t\t\t\t\t\t    0x3, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 12:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x10,\n\t\t\t\t\t\t    0x3, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 13:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x3c,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 14:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x2d,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 15:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x1c,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 16:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x10,\n\t\t\t\t\t\t    0x3, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 17:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xa3, 0x2f,\n\t\t\t\t\t\t    0x2f, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 18:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x5, 0x5,\n\t\t\t\t\t\t    0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 19:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x25,\n\t\t\t\t\t\t    0x25, 0xe1, 0x90);\n\t\t\tbreak;\n\t\tcase 20:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x25,\n\t\t\t\t\t\t    0x25, 0x60, 0x90);\n\t\t\tbreak;\n\t\tcase 21:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x15,\n\t\t\t\t\t\t    0x03, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 23:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x1e,\n\t\t\t\t\t\t    0x03, 0xf0, 0x14);\n\t\t\tbreak;\n\t\tcase 24:\n\t\tcase 124:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x3c,\n\t\t\t\t\t\t    0x03, 0x70, 0x50);\n\t\t\tbreak;\n\t\tcase 25:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x14,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 26:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x30,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 71:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x3c,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 101:\n\t\tcase 105:\n\t\tcase 171:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x3a,\n\t\t\t\t\t\t    0x03, 0x70, 0x50);\n\t\t\tbreak;\n\t\tcase 102:\n\t\tcase 106:\n\t\tcase 110:\n\t\tcase 114:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x2d,\n\t\t\t\t\t\t    0x03, 0x70, 0x50);\n\t\t\tbreak;\n\t\tcase 103:\n\t\tcase 107:\n\t\tcase 111:\n\t\tcase 115:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x1c,\n\t\t\t\t\t\t    0x03, 0x70, 0x50);\n\t\t\tbreak;\n\t\tcase 104:\n\t\tcase 108:\n\t\tcase 112:\n\t\tcase 116:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x10,\n\t\t\t\t\t\t    0x03, 0x70, 0x50);\n\t\t\tbreak;\n\t\tcase 109:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x3c,\n\t\t\t\t\t\t    0x03, 0xf1, 0x90);\n\t\t\tbreak;\n\t\tcase 113:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x3c,\n\t\t\t\t\t\t    0x03, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 121:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x15,\n\t\t\t\t\t\t    0x03, 0x70, 0x90);\n\t\t\tbreak;\n\t\tcase 22:\n\t\tcase 122:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xe3, 0x35,\n\t\t\t\t\t\t    0x03, 0x71, 0x11);\n\t\t\tbreak;\n\t\tcase 123:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x1c,\n\t\t\t\t\t\t    0x03, 0x70, 0x54);\n\t\t\tbreak;\n\t\tcase 125:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x14,\n\t\t\t\t\t\t    0x03, 0x70, 0x50);\n\t\t\tbreak;\n\t\tcase 126:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0xd3, 0x30,\n\t\t\t\t\t\t    0x03, 0x70, 0x50);\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\t \n\t\tswitch (type) {\n\t\tcase 0:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0x0, 0x0, 0x0,\n\t\t\t\t\t\t    0x40, 0x0);\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0x0, 0x0, 0x0,\n\t\t\t\t\t\t    0x48, 0x0);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tbtc8821a2ant_set_fw_ps_tdma(btcoexist, 0x0, 0x0, 0x0,\n\t\t\t\t\t\t    0x40, 0x0);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\tcoex_dm->pre_ps_tdma_on = coex_dm->cur_ps_tdma_on;\n\tcoex_dm->pre_ps_tdma = coex_dm->cur_ps_tdma;\n}\n\nstatic void\nbtc8821a2ant_ps_tdma_check_for_power_save_state(struct btc_coexist *btcoexist,\n\t\t\t\t\t\tbool new_ps_state)\n{\n\tu8 lps_mode = 0x0;\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U1_LPS_MODE, &lps_mode);\n\n\tif (lps_mode) {\n\t\t \n\t\tif (new_ps_state) {\n\t\t\t \n\t\t} else {\n\t\t\t \n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\t\t}\n\t} else {\n\t\t \n\t\tif (new_ps_state) {\n\t\t\t \n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\t\t} else {\n\t\t\t \n\t\t}\n\t}\n}\n\nstatic void btc8821a2ant_power_save_state(struct btc_coexist *btcoexist,\n\t\t\t\t\t  u8 ps_type, u8 lps_val, u8 rpwm_val)\n{\n\tbool low_pwr_disable = false;\n\n\tswitch (ps_type) {\n\tcase BTC_PS_WIFI_NATIVE:\n\t\t \n\t\tlow_pwr_disable = false;\n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_DISABLE_LOW_POWER,\n\t\t\t\t   &low_pwr_disable);\n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_NORMAL_LPS, NULL);\n\t\tcoex_sta->force_lps_on = false;\n\t\tbreak;\n\tcase BTC_PS_LPS_ON:\n\t\tbtc8821a2ant_ps_tdma_check_for_power_save_state(btcoexist,\n\t\t\t\t\t\t\t\ttrue);\n\t\tbtc8821a2ant_lps_rpwm(btcoexist, NORMAL_EXEC, lps_val,\n\t\t\t\t      rpwm_val);\n\t\t \n\t\tlow_pwr_disable = true;\n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_DISABLE_LOW_POWER,\n\t\t\t\t   &low_pwr_disable);\n\t\t \n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_ENTER_LPS, NULL);\n\t\tcoex_sta->force_lps_on = true;\n\t\tbreak;\n\tcase BTC_PS_LPS_OFF:\n\t\tbtc8821a2ant_ps_tdma_check_for_power_save_state(btcoexist,\n\t\t\t\t\t\t\t\tfalse);\n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_LEAVE_LPS, NULL);\n\t\tcoex_sta->force_lps_on = false;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void btc8821a2ant_coex_all_off(struct btc_coexist *btcoexist)\n{\n\t \n\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\t \n\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false, false);\n\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false, 0x18);\n\n\t \n\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n}\n\nstatic void btc8821a2ant_coex_under_5g(struct btc_coexist *btcoexist)\n{\n\tbtc8821a2ant_coex_all_off(btcoexist);\n\tbtc8821a2ant_ignore_wlan_act(btcoexist, NORMAL_EXEC, true);\n}\n\nstatic void btc8821a2ant_init_coex_dm(struct btc_coexist *btcoexist)\n{\n\t \n\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n\n\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\tbtc8821a2ant_ps_tdma(btcoexist, FORCE_EXEC, false, 1);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, FORCE_EXEC, 6);\n\tbtc8821a2ant_dec_bt_pwr(btcoexist, FORCE_EXEC, 0);\n\n\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false, false);\n\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false, 0x18);\n}\n\nstatic void btc8821a2ant_action_bt_inquiry(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tbool wifi_connected = false;\n\tbool low_pwr_disable = true;\n\tbool scan = false, link = false, roam = false;\n\n\tbtc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\tbtc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbtc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_DISABLE_LOW_POWER,\n\t\t\t   &low_pwr_disable);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_CONNECTED,\n\t\t\t   &wifi_connected);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_SCAN, &scan);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_LINK, &link);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_ROAM, &roam);\n\n\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\n\tif (scan || link || roam) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Wifi link process + BT Inq/Page!!\\n\");\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 15);\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 22);\n\t} else if (wifi_connected) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Wifi connected + BT Inq/Page!!\\n\");\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 15);\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 22);\n\t} else {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Wifi no-link + BT Inq/Page!!\\n\");\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\t}\n\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, FORCE_EXEC, 6);\n\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false, false);\n\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false, 0x18);\n}\n\nstatic void btc8821a2ant_action_wifi_link_process(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 u8tmpa, u8tmpb;\n\n\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 15);\n\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 22);\n\n\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false, false);\n\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false, 0x18);\n\n\tu8tmpa = btcoexist->btc_read_1byte(btcoexist, 0x765);\n\tu8tmpb = btcoexist->btc_read_1byte(btcoexist, 0x76e);\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], 0x765=0x%x, 0x76e=0x%x\\n\", u8tmpa, u8tmpb);\n}\n\nstatic bool btc8821a2ant_action_wifi_idle_process(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 wifi_rssi_state1;\n\tu8 ap_num = 0;\n\n\tbtc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\twifi_rssi_state1 = btc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES - 20, 0);\n\tbtc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U1_AP_NUM, &ap_num);\n\n\t \n\tif (BTC_RSSI_HIGH(wifi_rssi_state1) && (coex_sta->hid_exist) &&\n\t    (coex_sta->a2dp_exist)) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Wifi  idle process for BT HID+A2DP exist!!\\n\");\n\n\t\tbtc8821a2ant_dac_swing(btcoexist, NORMAL_EXEC, true, 0x6);\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\t\t \n\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false,\n\t\t\t\t\t   false);\n\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false,\n\t\t\t\t\t   0x18);\n\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\n\t\treturn true;\n\t} else if (coex_sta->pan_exist) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Wifi  idle process for BT PAN exist!!\\n\");\n\n\t\tbtc8821a2ant_dac_swing(btcoexist, NORMAL_EXEC, true, 0x6);\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\t\t \n\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false,\n\t\t\t\t\t   false);\n\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false,\n\t\t\t\t\t   0x18);\n\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\n\t\treturn true;\n\t}\n\tbtc8821a2ant_dac_swing(btcoexist, NORMAL_EXEC, true, 0x18);\n\treturn false;\n}\n\nstatic bool btc8821a2ant_is_common_action(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tbool common = false, wifi_connected = false, wifi_busy = false;\n\tbool low_pwr_disable = false;\n\tbool bt_hs_on = false;\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_HS_OPERATION, &bt_hs_on);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_CONNECTED,\n\t\t\t   &wifi_connected);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_BUSY, &wifi_busy);\n\n\tif (!wifi_connected) {\n\t\tlow_pwr_disable = false;\n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_ACT_DISABLE_LOW_POWER,\n\t\t\t\t   &low_pwr_disable);\n\t\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false,\n\t\t\t\t\t0x8);\n\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Wifi non-connected idle!!\\n\");\n\n\t\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff,\n\t\t\t\t\t  0x0);\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\t\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false,\n\t\t\t\t\t   false);\n\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false,\n\t\t\t\t\t   0x18);\n\n\t\tcommon = true;\n\t} else {\n\t\tif (BT_8821A_2ANT_BT_STATUS_IDLE ==\n\t\t    coex_dm->bt_status) {\n\t\t\tlow_pwr_disable = false;\n\t\t\tbtcoexist->btc_set(btcoexist,\n\t\t\t\t\t   BTC_SET_ACT_DISABLE_LOW_POWER,\n\t\t\t\t\t   &low_pwr_disable);\n\t\t\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC,\n\t\t\t\t\t\tfalse, false, 0x8);\n\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Wifi connected + BT non connected-idle!!\\n\");\n\n\t\t\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1,\n\t\t\t\t\t\t  0xfffff, 0x0);\n\t\t\tbtc8821a2ant_coex_table_with_type(btcoexist,\n\t\t\t\t\t\t\t  NORMAL_EXEC, 0);\n\n\t\t\tbtc8821a2ant_power_save_state(\n\t\t\t\tbtcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\t\t\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t      0xb);\n\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\n\t\t\tcommon = true;\n\t\t} else if (BT_8821A_2ANT_BT_STATUS_CON_IDLE ==\n\t\t\t   coex_dm->bt_status) {\n\t\t\tlow_pwr_disable = true;\n\t\t\tbtcoexist->btc_set(btcoexist,\n\t\t\t\t\t   BTC_SET_ACT_DISABLE_LOW_POWER,\n\t\t\t\t\t   &low_pwr_disable);\n\n\t\t\tif (bt_hs_on)\n\t\t\t\treturn false;\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Wifi connected + BT connected-idle!!\\n\");\n\t\t\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC,\n\t\t\t\t\t\tfalse, false, 0x8);\n\n\t\t\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1,\n\t\t\t\t\t\t  0xfffff, 0x0);\n\t\t\tbtc8821a2ant_coex_table_with_type(btcoexist,\n\t\t\t\t\t\t\t  NORMAL_EXEC, 0);\n\n\t\t\tbtc8821a2ant_power_save_state(\n\t\t\t\tbtcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\t\t\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t      0xb);\n\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t\tcommon = true;\n\t\t} else {\n\t\t\tlow_pwr_disable = true;\n\t\t\tbtcoexist->btc_set(btcoexist,\n\t\t\t\t\t   BTC_SET_ACT_DISABLE_LOW_POWER,\n\t\t\t\t\t   &low_pwr_disable);\n\n\t\t\tif (wifi_busy) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], Wifi Connected-Busy + BT Busy!!\\n\");\n\t\t\t\tcommon = false;\n\t\t\t} else {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], Wifi Connected-Idle + BT Busy!!\\n\");\n\t\t\t\tcommon =\n\t\t\t\t    btc8821a2ant_action_wifi_idle_process(\n\t\t\t\t\t     btcoexist);\n\t\t\t}\n\t\t}\n\t}\n\treturn common;\n}\n\nstatic void btc8821a2ant_tdma_duration_adjust(struct btc_coexist *btcoexist,\n\t\t\t\t\t      bool sco_hid, bool tx_pause,\n\t\t\t\t\t      u8 max_interval)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tstatic long up, dn, m, n, wait_count;\n\t  \n\tint result;\n\tu8 retry_count = 0;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], TdmaDurationAdjust()\\n\");\n\n\tif (coex_dm->auto_tdma_adjust) {\n\t\tcoex_dm->auto_tdma_adjust = false;\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], first run TdmaDurationAdjust()!!\\n\");\n\t\tif (sco_hid) {\n\t\t\tif (tx_pause) {\n\t\t\t\tif (max_interval == 1) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 13);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 13;\n\t\t\t\t} else if (max_interval == 2) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 14);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 14;\n\t\t\t\t} else {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 15);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 15;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (max_interval == 1) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 9);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 9;\n\t\t\t\t} else if (max_interval == 2) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 10);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 10;\n\t\t\t\t} else {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 11);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 11;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (tx_pause) {\n\t\t\t\tif (max_interval == 1) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 5);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 5;\n\t\t\t\t} else if (max_interval == 2) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 6);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 6;\n\t\t\t\t} else {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 7);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 7;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (max_interval == 1) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 1);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 1;\n\t\t\t\t} else if (max_interval == 2) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 2);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 2;\n\t\t\t\t} else {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 3);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 3;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tup = 0;\n\t\tdn = 0;\n\t\tm = 1;\n\t\tn = 3;\n\t\tresult = 0;\n\t\twait_count = 0;\n\t} else {\n\t\t \n\t\tretry_count = coex_sta->bt_retry_cnt;\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], retry_count = %d\\n\", retry_count);\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], up = %d, dn = %d, m = %d, n = %d, wait_count = %d\\n\",\n\t\t\t(int)up, (int)dn, (int)m, (int)n, (int)wait_count);\n\t\tresult = 0;\n\t\twait_count++;\n\n\t\tif (retry_count == 0) {\n\t\t\t \n\t\t\tup++;\n\t\t\tdn--;\n\n\t\t\tif (dn <= 0)\n\t\t\t\tdn = 0;\n\n\t\t\tif (up >= n) {\n\t\t\t\t \n\t\t\t\twait_count = 0;\n\t\t\t\tn = 3;\n\t\t\t\tup = 0;\n\t\t\t\tdn = 0;\n\t\t\t\tresult = 1;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], Increase wifi duration!!\\n\");\n\t\t\t}\n\t\t} else if (retry_count <= 3) {\n\t\t\t \n\t\t\tup--;\n\t\t\tdn++;\n\n\t\t\tif (up <= 0)\n\t\t\t\tup = 0;\n\n\t\t\tif (dn == 2) {\n\t\t\t\t \n\t\t\t\tif (wait_count <= 2)\n\t\t\t\t\tm++;  \n\t\t\t\telse\n\t\t\t\t\tm = 1;\n\t\t\t\t \n\t\t\t\tif (m >= 20)\n\t\t\t\t\tm = 20;\n\n\t\t\t\tn = 3 * m;\n\t\t\t\tup = 0;\n\t\t\t\tdn = 0;\n\t\t\t\twait_count = 0;\n\t\t\t\tresult = -1;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], Decrease wifi duration for retryCounter<3!!\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\t \n\t\t\tif (wait_count == 1)\n\t\t\t\tm++;  \n\t\t\telse\n\t\t\t\tm = 1;\n\t\t\t \n\t\t\tif (m >= 20)\n\t\t\t\tm = 20;\n\n\t\t\tn = 3 * m;\n\t\t\tup = 0;\n\t\t\tdn = 0;\n\t\t\twait_count = 0;\n\t\t\tresult = -1;\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Decrease wifi duration for retryCounter>3!!\\n\");\n\t\t}\n\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], max Interval = %d\\n\", max_interval);\n\n\t\tif (max_interval == 1) {\n\t\t\tif (tx_pause) {\n\t\t\t\tif (coex_dm->cur_ps_tdma == 71) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 5);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 5;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 1) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 5);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 5;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 6);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 6;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 7);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 7;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 4) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 8);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 8;\n\t\t\t\t}\n\t\t\t\tif (coex_dm->cur_ps_tdma == 9) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 13);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 13;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 14);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 14;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 15);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 15;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 12) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 16);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 16;\n\t\t\t\t}\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 5) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 6);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t6;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 8);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t8;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 13) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 14);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t14;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 16);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t16;\n\t\t\t\t\t}\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 8) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 6);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t6;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 5);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t5;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 16) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 14);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t14;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 13);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t13;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (coex_dm->cur_ps_tdma == 5) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 71);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 71;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 2);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 2;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 3);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 3;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 8) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 4);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 4;\n\t\t\t\t}\n\t\t\t\tif (coex_dm->cur_ps_tdma == 13) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 9);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 9;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 10);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 10;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 11);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 11;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 16) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 12);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 12;\n\t\t\t\t}\n\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 71) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 1);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t1;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 1) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 2);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t2;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 4);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t4;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 9) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 10);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t10;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 12);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t12;\n\t\t\t\t\t}\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 4) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 2);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t2;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 1);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t1;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 1) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 71);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t71;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 12) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 10);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t10;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 9);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t9;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (max_interval == 2) {\n\t\t\tif (tx_pause) {\n\t\t\t\tif (coex_dm->cur_ps_tdma == 1) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 6);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 6;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 6);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 6;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 7);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 7;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 4) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 8);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 8;\n\t\t\t\t}\n\t\t\t\tif (coex_dm->cur_ps_tdma == 9) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 14);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 14;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 14);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 14;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 15);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 15;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 12) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 16);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 16;\n\t\t\t\t}\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 5) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 6);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t6;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 8);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t8;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 13) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 14);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t14;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 16);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t16;\n\t\t\t\t\t}\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 8) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 6);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t6;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 6);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t6;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 16) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 14);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t14;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 14);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t14;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (coex_dm->cur_ps_tdma == 5) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 2);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 2;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 2);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 2;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 3);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 3;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 8) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 4);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 4;\n\t\t\t\t}\n\t\t\t\tif (coex_dm->cur_ps_tdma == 13) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 10);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 10;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 10);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 10;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 11);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 11;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 16) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 12);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 12;\n\t\t\t\t}\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 1) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 2);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t2;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 4);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t4;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 9) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 10);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t10;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 12);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t12;\n\t\t\t\t\t}\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 4) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 2);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t2;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 2);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t2;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 12) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 10);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t10;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 10);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t10;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (max_interval == 3) {\n\t\t\tif (tx_pause) {\n\t\t\t\tif (coex_dm->cur_ps_tdma == 1) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 7);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 7;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 7);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 7;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 7);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 7;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 4) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 8);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 8;\n\t\t\t\t}\n\t\t\t\tif (coex_dm->cur_ps_tdma == 9) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 15);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 15;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 15);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 15;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 15);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 15;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 12) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 16);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 16;\n\t\t\t\t}\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 5) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 8);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t8;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 13) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 16);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t16;\n\t\t\t\t\t}\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 8) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 7);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t7;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 16) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 15);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t15;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (coex_dm->cur_ps_tdma == 5) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 3);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 3;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 6) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 3);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 3;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 7) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 3);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 3;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 8) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 4);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 4;\n\t\t\t\t}\n\t\t\t\tif (coex_dm->cur_ps_tdma == 13) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 11);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 11;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 14) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 11);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 11;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 15) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 11);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 11;\n\t\t\t\t} else if (coex_dm->cur_ps_tdma == 16) {\n\t\t\t\t\tbtc8821a2ant_ps_tdma(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, true, 12);\n\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type = 12;\n\t\t\t\t}\n\t\t\t\tif (result == -1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 1) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 4);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t4;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 9) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 12);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t12;\n\t\t\t\t\t}\n\t\t\t\t} else if (result == 1) {\n\t\t\t\t\tif (coex_dm->cur_ps_tdma == 4) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 3) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 2) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 3);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t3;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 12) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 11) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t} else if (coex_dm->cur_ps_tdma == 10) {\n\t\t\t\t\t\tbtc8821a2ant_ps_tdma(\n\t\t\t\t\t\t\tbtcoexist, NORMAL_EXEC,\n\t\t\t\t\t\t\ttrue, 11);\n\t\t\t\t\t\tcoex_dm->ps_tdma_du_adj_type =\n\t\t\t\t\t\t\t11;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t \n\tif (coex_dm->cur_ps_tdma != coex_dm->ps_tdma_du_adj_type) {\n\t\tbool scan = false, link = false, roam = false;\n\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], PsTdma type mismatch!!!, cur_ps_tdma = %d, recordPsTdma = %d\\n\",\n\t\t\tcoex_dm->cur_ps_tdma, coex_dm->ps_tdma_du_adj_type);\n\n\t\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_SCAN, &scan);\n\t\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_LINK, &link);\n\t\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_ROAM, &roam);\n\n\t\tif (!scan && !link && !roam) {\n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true,\n\t\t\t\t\t     coex_dm->ps_tdma_du_adj_type);\n\t\t} else {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], roaming/link/scan is under progress, will adjust next time!!!\\n\");\n\t\t}\n\t}\n}\n\n \nstatic void btc8821a2ant_action_sco(struct btc_coexist *btcoexist)\n{\n\tstruct btc_bt_link_info *bt_link_info = &btcoexist->bt_link_info;\n\tu8 wifi_rssi_state, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist, 2, 35, 0);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 4);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, true);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, false);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\n\tif (wifi_bw == BTC_WIFI_BW_LEGACY) {\n\t\t \n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 2);\n\t} else {\n\t\t \n\t\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\t\tbtc8821a2ant_coex_table_with_type(btcoexist,\n\t\t\t\t\t\t\t  NORMAL_EXEC, 8);\n\t\t} else {\n\t\t\tif (bt_link_info->sco_only)\n\t\t\t\tbtc8821a2ant_coex_table_with_type(\n\t\t\t\t\tbtcoexist, NORMAL_EXEC, 17);\n\t\t\telse\n\t\t\t\tbtc8821a2ant_coex_table_with_type(\n\t\t\t\t\tbtcoexist, NORMAL_EXEC, 12);\n\t\t}\n\t}\n\n\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\t \n\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 0);\n\n\t \n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   true, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   true, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   true, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   true, 0x18);\n\t\t}\n\t}\n}\n\nstatic void btc8821a2ant_action_hid(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, true);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, false);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\n\tif (wifi_bw == BTC_WIFI_BW_LEGACY) {\n\t\t \n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 7);\n\t} else {\n\t\t \n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 2);\n\t}\n\n\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 24);\n\n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\t \n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\t \n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\n \nstatic void btc8821a2ant_action_a2dp(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, wifi_rssi_state1, bt_rssi_state;\n\tu8 ap_num = 0;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\twifi_rssi_state1 = btc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tif ((ap_num >= 10) && BTC_RSSI_HIGH(wifi_rssi_state1) &&\n\t    BTC_RSSI_HIGH(bt_rssi_state)) {\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\n\t\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff,\n\t\t\t\t\t  0x0);\n\t\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false,\n\t\t\t\t\t0x8);\n\t\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 23);\n\n\t\t \n\t\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\t\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   true, 0x6);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   true, 0x6);\n\t\t}\n\t\treturn;\n\t}\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\tif (BTC_RSSI_HIGH(wifi_rssi_state1) && BTC_RSSI_HIGH(bt_rssi_state)) {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 7);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t} else {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 13);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_LPS_ON, 0x50,\n\t\t\t\t\t      0x4);\n\t}\n\n\t \n\tif ((bt_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t    (bt_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 23);\n\t} else {\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 23);\n\t}\n\n\t \n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void btc8821a2ant_action_a2dp_pan_hs(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, wifi_rssi_state1, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\twifi_rssi_state1 = btc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\tif (BTC_RSSI_HIGH(wifi_rssi_state1) && BTC_RSSI_HIGH(bt_rssi_state)) {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 7);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t} else {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 13);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_LPS_ON, 0x50,\n\t\t\t\t\t      0x4);\n\t}\n\n\tbtc8821a2ant_tdma_duration_adjust(btcoexist, false, true, 2);\n\n\t \n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void btc8821a2ant_action_pan_edr(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, wifi_rssi_state1, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\twifi_rssi_state1 = btc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, true);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, false);\n\n\tif (BTC_RSSI_HIGH(wifi_rssi_state1) && BTC_RSSI_HIGH(bt_rssi_state)) {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 10);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t} else {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 13);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_LPS_ON, 0x50,\n\t\t\t\t\t      0x4);\n\t}\n\n\t \n\tif ((bt_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t    (bt_rssi_state == BTC_RSSI_STATE_STAY_HIGH))\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 26);\n\telse\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 26);\n\n\t \n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\n \nstatic void btc8821a2ant_action_pan_hs(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\tbtc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 7);\n\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\n \nstatic void btc8821a2ant_action_pan_edr_a2dp(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, wifi_rssi_state1, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\twifi_rssi_state1 = btc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\tif (BTC_RSSI_HIGH(wifi_rssi_state1) && BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\telse\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_LPS_ON, 0x50,\n\t\t\t\t\t      0x4);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\n\tif ((bt_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t    (bt_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 12);\n\n\t\tif (wifi_bw == BTC_WIFI_BW_HT40)\n\t\t\tbtc8821a2ant_tdma_duration_adjust(btcoexist, false,\n\t\t\t\t\t\t\t  true, 3);\n\t\telse\n\t\t\tbtc8821a2ant_tdma_duration_adjust(btcoexist, false,\n\t\t\t\t\t\t\t  false, 3);\n\t} else {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 13);\n\t\tbtc8821a2ant_tdma_duration_adjust(btcoexist, false, true, 3);\n\t}\n\n\t \n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void btc8821a2ant_action_pan_edr_hid(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, true);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, false);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\n\t \n\tif (wifi_bw == BTC_WIFI_BW_LEGACY) {\n\t\t \n\t\tbtc8821a2ant_coex_table(btcoexist, NORMAL_EXEC, 0x55ff55ff,\n\t\t\t\t\t0x5a5f5a5f, 0xffff, 0x3);\n\t} else {\n\t\t \n\t\tbtc8821a2ant_coex_table(btcoexist, NORMAL_EXEC, 0x55ff55ff,\n\t\t\t\t\t0x5a5f5a5f, 0xffff, 0x3);\n\t}\n\n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 3);\n\t\t \n\t\tif ((bt_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (bt_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC,\n\t\t\t\t\t     true, 10);\n\t\t} else {\n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 14);\n\t\t}\n\n\t\t \n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\t\t \n\t\tif ((bt_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (bt_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 10);\n\t\t} else {\n\t\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 14);\n\t\t}\n\n\t\t \n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\n \nstatic void btc8821a2ant_act_hid_a2dp_pan_edr(struct btc_coexist *btcoexist)\n{\n\tu8 wifi_rssi_state, wifi_rssi_state1, bt_rssi_state;\n\tu32 wifi_bw;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\twifi_rssi_state1 = btc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t2, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 0);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, false, 0x8);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\telse\n\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\tif (BTC_RSSI_HIGH(wifi_rssi_state1) && BTC_RSSI_HIGH(bt_rssi_state)) {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 7);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t} else {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 14);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_LPS_ON, 0x50,\n\t\t\t\t\t      0x4);\n\t}\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\n\tif ((bt_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t    (bt_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\tif (wifi_bw == BTC_WIFI_BW_HT40)\n\t\t\tbtc8821a2ant_tdma_duration_adjust(btcoexist, true,\n\t\t\t\t\t\t\t  true, 3);\n\t\telse\n\t\t\tbtc8821a2ant_tdma_duration_adjust(btcoexist, true,\n\t\t\t\t\t\t\t  false, 3);\n\t} else {\n\t\tbtc8821a2ant_tdma_duration_adjust(btcoexist, true, true, 3);\n\t}\n\n\t \n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void btc8821a2ant_action_hid_a2dp(struct btc_coexist *btcoexist)\n{\n\tu32 wifi_bw;\n\tu8 wifi_rssi_state, bt_rssi_state;\n\tu8 ap_num = 0;\n\n\twifi_rssi_state = btc8821a2ant_wifi_rssi_state(btcoexist, 0, 2, 15, 0);\n\tbtc8821a2ant_wifi_rssi_state(btcoexist, 1, 2,\n\t\t\t\tBT_8821A_2ANT_WIFI_RSSI_COEXSWITCH_THRES, 0);\n\tbt_rssi_state = btc8821a2ant_bt_rssi_state(btcoexist,\n\t\t\t\t3, BT_8821A_2ANT_BT_RSSI_COEXSWITCH_THRES, 37);\n\n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x0);\n\n\tbtc8821a2ant_limited_rx(btcoexist, NORMAL_EXEC, false, true, 0x5);\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\tif (wifi_bw == BTC_WIFI_BW_LEGACY) {\n\t\tif (BTC_RSSI_HIGH(bt_rssi_state))\n\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\t\telse if (BTC_RSSI_MEDIUM(bt_rssi_state))\n\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\t\telse\n\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\t} else {\n\t\t \n\t\tif (BTC_RSSI_HIGH(bt_rssi_state)) {\n\t\t\tbtcoexist->btc_get(btcoexist, BTC_GET_U1_AP_NUM,\n\t\t\t\t\t   &ap_num);\n\t\t\tif (ap_num < 10)\n\t\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, 4);\n\t\t\telse\n\t\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist,\n\t\t\t\t\t\t\tNORMAL_EXEC, 2);\n\t\t} else if (BTC_RSSI_MEDIUM(bt_rssi_state)) {\n\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 2);\n\t\t} else {\n\t\t\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\t\t}\n\t}\n\n\tif (wifi_bw == BTC_WIFI_BW_LEGACY) {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 7);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE,\n\t\t\t\t\t      0x0, 0x0);\n\t} else {\n\t\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 14);\n\t\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_LPS_ON, 0x50,\n\t\t\t\t\t      0x4);\n\t}\n\n\t \n\tif ((bt_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t    (bt_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 23);\n\t} else {\n\t\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, true, 23);\n\t}\n\n\t \n\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, true, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t} else {\n\t\tif ((wifi_rssi_state == BTC_RSSI_STATE_HIGH) ||\n\t\t    (wifi_rssi_state == BTC_RSSI_STATE_STAY_HIGH)) {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, true, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t} else {\n\t\t\tbtc8821a2ant_sw_mechanism1(btcoexist, false, true,\n\t\t\t\t\t\t   false, false);\n\t\t\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false,\n\t\t\t\t\t\t   false, 0x18);\n\t\t}\n\t}\n}\n\nstatic void btc8821a2ant_action_wifi_multi_port(struct btc_coexist *btcoexist)\n{\n\tbtc8821a2ant_fw_dac_swing_lvl(btcoexist, NORMAL_EXEC, 6);\n\tbtc8821a2ant_dec_bt_pwr(btcoexist, NORMAL_EXEC, 0);\n\n\t \n\tbtc8821a2ant_sw_mechanism1(btcoexist, false, false, false, false);\n\tbtc8821a2ant_sw_mechanism2(btcoexist, false, false, false, 0x18);\n\n\t \n\tbtc8821a2ant_coex_table_with_type(btcoexist, NORMAL_EXEC, 0);\n\n\tbtc8821a2ant_power_save_state(btcoexist, BTC_PS_WIFI_NATIVE, 0x0, 0x0);\n\tbtc8821a2ant_ps_tdma(btcoexist, NORMAL_EXEC, false, 1);\n}\n\nstatic void btc8821a2ant_run_coexist_mechanism(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tstruct btc_bt_link_info *bt_link_info = &btcoexist->bt_link_info;\n\tbool wifi_under_5g = false;\n\tu8 algorithm = 0;\n\tu32 num_of_wifi_link = 0;\n\tu32 wifi_link_status = 0;\n\tbool miracast_plus_bt = false;\n\tbool scan = false, link = false, roam = false;\n\n\tif (btcoexist->manual_control) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Manual control!!!\\n\");\n\t\treturn;\n\t}\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_UNDER_5G, &wifi_under_5g);\n\n\tif (wifi_under_5g) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], RunCoexistMechanism(), run 5G coex setting!!<===\\n\");\n\t\tbtc8821a2ant_coex_under_5g(btcoexist);\n\t\treturn;\n\t}\n\n\tif (coex_sta->under_ips) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], wifi is under IPS !!!\\n\");\n\t\treturn;\n\t}\n\n\talgorithm = btc8821a2ant_action_algorithm(btcoexist);\n\tif (coex_sta->c2h_bt_inquiry_page &&\n\t    (BT_8821A_2ANT_COEX_ALGO_PANHS != algorithm)) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], BT is under inquiry/page scan !!\\n\");\n\t\tbtc8821a2ant_action_bt_inquiry(btcoexist);\n\t\treturn;\n\t}\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_SCAN, &scan);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_LINK, &link);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_ROAM, &roam);\n\n\tif (scan || link || roam) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], WiFi is under Link Process !!\\n\");\n\t\tbtc8821a2ant_action_wifi_link_process(btcoexist);\n\t\treturn;\n\t}\n\n\t \n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_LINK_STATUS,\n\t\t\t   &wifi_link_status);\n\tnum_of_wifi_link = wifi_link_status >> 16;\n\n\tif ((num_of_wifi_link >= 2) ||\n\t    (wifi_link_status & WIFI_P2P_GO_CONNECTED)) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"############# [BTCoex],  Multi-Port num_of_wifi_link = %d, wifi_link_status = 0x%x\\n\",\n\t\t\tnum_of_wifi_link, wifi_link_status);\n\n\t\tif (bt_link_info->bt_link_exist)\n\t\t\tmiracast_plus_bt = true;\n\t\telse\n\t\t\tmiracast_plus_bt = false;\n\n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_BL_MIRACAST_PLUS_BT,\n\t\t\t\t   &miracast_plus_bt);\n\t\tbtc8821a2ant_action_wifi_multi_port(btcoexist);\n\n\t\treturn;\n\t}\n\n\tmiracast_plus_bt = false;\n\tbtcoexist->btc_set(btcoexist, BTC_SET_BL_MIRACAST_PLUS_BT,\n\t\t\t   &miracast_plus_bt);\n\n\tcoex_dm->cur_algorithm = algorithm;\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Algorithm = %d\\n\", coex_dm->cur_algorithm);\n\n\tif (btc8821a2ant_is_common_action(btcoexist)) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Action 2-Ant common\\n\");\n\t\tcoex_dm->auto_tdma_adjust = true;\n\t} else {\n\t\tif (coex_dm->cur_algorithm != coex_dm->pre_algorithm) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], pre_algorithm = %d, cur_algorithm = %d\\n\",\n\t\t\t\tcoex_dm->pre_algorithm,\n\t\t\t\tcoex_dm->cur_algorithm);\n\t\t\tcoex_dm->auto_tdma_adjust = false;\n\t\t}\n\t\tswitch (coex_dm->cur_algorithm) {\n\t\tcase BT_8821A_2ANT_COEX_ALGO_SCO:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = SCO\\n\");\n\t\t\tbtc8821a2ant_action_sco(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_HID:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = HID\\n\");\n\t\t\tbtc8821a2ant_action_hid(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_A2DP:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = A2DP\\n\");\n\t\t\tbtc8821a2ant_action_a2dp(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_A2DP_PANHS:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = A2DP+PAN(HS)\\n\");\n\t\t\tbtc8821a2ant_action_a2dp_pan_hs(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_PANEDR:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = PAN(EDR)\\n\");\n\t\t\tbtc8821a2ant_action_pan_edr(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_PANHS:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = HS mode\\n\");\n\t\t\tbtc8821a2ant_action_pan_hs(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_PANEDR_A2DP:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = PAN+A2DP\\n\");\n\t\t\tbtc8821a2ant_action_pan_edr_a2dp(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_PANEDR_HID:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = PAN(EDR)+HID\\n\");\n\t\t\tbtc8821a2ant_action_pan_edr_hid(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_HID_A2DP_PANEDR:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = HID+A2DP+PAN\\n\");\n\t\t\tbtc8821a2ant_act_hid_a2dp_pan_edr(btcoexist);\n\t\t\tbreak;\n\t\tcase BT_8821A_2ANT_COEX_ALGO_HID_A2DP:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = HID+A2DP\\n\");\n\t\t\tbtc8821a2ant_action_hid_a2dp(btcoexist);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Action 2-Ant, algorithm = coexist All Off!!\\n\");\n\t\t\tbtc8821a2ant_coex_all_off(btcoexist);\n\t\t\tbreak;\n\t\t}\n\t\tcoex_dm->pre_algorithm = coex_dm->cur_algorithm;\n\t}\n}\n\nstatic void btc8821a2ant_wifi_off_hw_cfg(struct btc_coexist *btcoexist)\n{\n\tu8 h2c_parameter[2] = {0};\n\tu32 fw_ver = 0;\n\n\t \n\tbtcoexist->btc_write_1byte(btcoexist, 0x76e, 0x4);\n\n\t \n\tbtcoexist->btc_set_rf_reg(btcoexist, BTC_RF_A, 0x1, 0xfffff, 0x780);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_FW_VER, &fw_ver);\n\tif (fw_ver >= 0x180000) {\n\t\t \n\t\th2c_parameter[0] = 1;\n\t\tbtcoexist->btc_fill_h2c(btcoexist, 0x6E, 1, h2c_parameter);\n\t} else {\n\t\tbtcoexist->btc_write_1byte(btcoexist, 0x765, 0x18);\n\t}\n}\n\n \nvoid ex_btc8821a2ant_init_hwconfig(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 u1tmp = 0;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], 2Ant Init HW Config!!\\n\");\n\n\t \n\tcoex_dm->bt_rf0x1e_backup =\n\t\tbtcoexist->btc_get_rf_reg(btcoexist, BTC_RF_A, 0x1e, 0xfffff);\n\n\t \n\tu1tmp = btcoexist->btc_read_1byte(btcoexist, 0x790);\n\tu1tmp &= 0xc0;\n\tu1tmp |= 0x5;\n\tbtcoexist->btc_write_1byte(btcoexist, 0x790, u1tmp);\n\n\t \n\tbtc8821a2ant_set_ant_path(btcoexist, BTC_ANT_WIFI_AT_MAIN, true, false);\n\tcoex_sta->dis_ver_info_cnt = 0;\n\n\t \n\tbtc8821a2ant_coex_table_with_type(btcoexist, FORCE_EXEC, 0);\n\n\t \n\t \n\tbtcoexist->btc_write_1byte(btcoexist, 0x76e, 0x4);\n\tbtcoexist->btc_write_1byte(btcoexist, 0x778, 0x3);\n\tbtcoexist->btc_write_1byte_bitmask(btcoexist, 0x40, 0x20, 0x1);\n}\n\nvoid ex_btc8821a2ant_pre_load_firmware(struct btc_coexist *btcoexist)\n{\n\tstruct btc_board_info *board_info = &btcoexist->board_info;\n\tu8 u8tmp = 0x4;  \n\n\t \n\tif (btcoexist->chip_interface == BTC_INTF_USB) {\n\t\t \n\t\tu8tmp |= 0x1;  \n\t\tbtcoexist->btc_write_local_reg_1byte(btcoexist, 0xfe08, u8tmp);\n\t} else {\n\t\t \n\t\tif (board_info->single_ant_path == 0) {\n\t\t} else if (board_info->single_ant_path == 1) {\n\t\t\t \n\t\t\tu8tmp |= 0x1;  \n\t\t}\n\n\t\tif (btcoexist->chip_interface == BTC_INTF_PCI)\n\t\t\tbtcoexist->btc_write_local_reg_1byte(btcoexist, 0x384,\n\t\t\t\t\t\t\t     u8tmp);\n\t\telse if (btcoexist->chip_interface == BTC_INTF_SDIO)\n\t\t\tbtcoexist->btc_write_local_reg_1byte(btcoexist, 0x60,\n\t\t\t\t\t\t\t     u8tmp);\n\t}\n}\n\nvoid ex_btc8821a2ant_init_coex_dm(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Coex Mechanism Init!!\\n\");\n\n\tbtc8821a2ant_init_coex_dm(btcoexist);\n}\n\nvoid ex_btc8821a2ant_display_coex_info(struct btc_coexist *btcoexist,\n\t\t\t\t       struct seq_file *m)\n{\n\tstruct btc_board_info *board_info = &btcoexist->board_info;\n\tstruct btc_stack_info *stack_info = &btcoexist->stack_info;\n\tu8 u1tmp[4], i, bt_info_ext, ps_tdma_case = 0;\n\tu32 u4tmp[4];\n\tbool roam = false, scan = false, link = false, wifi_under_5g = false;\n\tbool bt_hs_on = false, wifi_busy = false;\n\tlong wifi_rssi = 0, bt_hs_rssi = 0;\n\tu32 wifi_bw, wifi_traffic_dir;\n\tu8 wifi_dot_11_chnl, wifi_hs_chnl;\n\tu32 fw_ver = 0, bt_patch_ver = 0;\n\n\tseq_puts(m, \"\\n ============[BT Coexist info]============\");\n\n\tseq_printf(m, \"\\n %-35s = %d/ %d \", \"Ant PG number/ Ant mechanism:\",\n\t\t   board_info->pg_ant_num, board_info->btdm_ant_num);\n\n\tif (btcoexist->manual_control) {\n\t\tseq_printf(m, \"\\n %-35s\", \"[Action Manual control]!!\");\n\t}\n\n\tseq_printf(m, \"\\n %-35s = %s / %d\", \"BT stack/ hci ext ver\",\n\t\t   ((stack_info->profile_notified) ? \"Yes\" : \"No\"),\n\t\t   stack_info->hci_version);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_BT_PATCH_VER, &bt_patch_ver);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_FW_VER, &fw_ver);\n\tseq_printf(m, \"\\n %-35s = %d_%d/ 0x%x/ 0x%x(%d)\",\n\t\t   \"CoexVer/ FwVer/ PatchVer\",\n\t\t   glcoex_ver_date_8821a_2ant, glcoex_ver_8821a_2ant,\n\t\t   fw_ver, bt_patch_ver, bt_patch_ver);\n\n\tbtcoexist->btc_get(btcoexist,\n\t\tBTC_GET_BL_HS_OPERATION, &bt_hs_on);\n\tbtcoexist->btc_get(btcoexist,\n\t\tBTC_GET_U1_WIFI_DOT11_CHNL, &wifi_dot_11_chnl);\n\tbtcoexist->btc_get(btcoexist,\n\t\tBTC_GET_U1_WIFI_HS_CHNL, &wifi_hs_chnl);\n\tseq_printf(m, \"\\n %-35s = %d / %d(%d)\",\n\t\t   \"Dot11 channel / HsMode(HsChnl)\",\n\t\t   wifi_dot_11_chnl, bt_hs_on, wifi_hs_chnl);\n\n\tseq_printf(m, \"\\n %-35s = %3ph \",\n\t\t   \"H2C Wifi inform bt chnl Info\",\n\t\t   coex_dm->wifi_chnl_info);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_S4_WIFI_RSSI, &wifi_rssi);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_S4_HS_RSSI, &bt_hs_rssi);\n\tseq_printf(m, \"\\n %-35s = %ld/ %ld\", \"Wifi rssi/ HS rssi\",\n\t\t   wifi_rssi, bt_hs_rssi);\n\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_SCAN, &scan);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_LINK, &link);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_ROAM, &roam);\n\tseq_printf(m, \"\\n %-35s = %d/ %d/ %d \", \"Wifi link/ roam/ scan\",\n\t\t   link, roam, scan);\n\n\tbtcoexist->btc_get(btcoexist,\n\t\tBTC_GET_BL_WIFI_UNDER_5G, &wifi_under_5g);\n\tbtcoexist->btc_get(btcoexist,\n\t\tBTC_GET_U4_WIFI_BW, &wifi_bw);\n\tbtcoexist->btc_get(btcoexist,\n\t\tBTC_GET_BL_WIFI_BUSY, &wifi_busy);\n\tbtcoexist->btc_get(btcoexist,\n\t\tBTC_GET_U4_WIFI_TRAFFIC_DIRECTION, &wifi_traffic_dir);\n\tseq_printf(m, \"\\n %-35s = %s / %s/ %s \", \"Wifi status\",\n\t\t   (wifi_under_5g ? \"5G\" : \"2.4G\"),\n\t\t   ((BTC_WIFI_BW_LEGACY == wifi_bw) ? \"Legacy\" :\n\t\t    (((BTC_WIFI_BW_HT40 == wifi_bw) ? \"HT40\" : \"HT20\"))),\n\t\t   ((!wifi_busy) ? \"idle\" :\n\t\t    ((BTC_WIFI_TRAFFIC_TX == wifi_traffic_dir) ?\n\t\t     \"uplink\" : \"downlink\")));\n\n\tif (stack_info->profile_notified) {\n\t\tseq_printf(m, \"\\n %-35s = %d / %d / %d / %d\",\n\t\t\t   \"SCO/HID/PAN/A2DP\",\n\t\t\t   stack_info->sco_exist, stack_info->hid_exist,\n\t\t\t   stack_info->pan_exist, stack_info->a2dp_exist);\n\n\t\tbtcoexist->btc_disp_dbg_msg(btcoexist,\n\t\t\t\t\t    BTC_DBG_DISP_BT_LINK_INFO,\n\t\t\t\t\t    m);\n\t}\n\n\tbt_info_ext = coex_sta->bt_info_ext;\n\tseq_printf(m, \"\\n %-35s = %s\", \"BT Info A2DP rate\",\n\t\t   (bt_info_ext&BIT0) ? \"Basic rate\" : \"EDR rate\");\n\n\tfor (i = 0; i < BT_INFO_SRC_8821A_2ANT_MAX; i++) {\n\t\tif (coex_sta->bt_info_c2h_cnt[i]) {\n\t\t\tseq_printf(m, \"\\n %-35s = %7ph(%d)\",\n\t\t\t\t   glbt_info_src_8821a_2ant[i],\n\t\t\t\t   coex_sta->bt_info_c2h[i],\n\t\t\t\t   coex_sta->bt_info_c2h_cnt[i]);\n\t\t}\n\t}\n\n\tseq_printf(m, \"\\n %-35s = %s/%s\",\n\t\t   \"PS state, IPS/LPS\",\n\t\t   ((coex_sta->under_ips ? \"IPS ON\" : \"IPS OFF\")),\n\t\t   ((coex_sta->under_lps ? \"LPS ON\" : \"LPS OFF\")));\n\tbtcoexist->btc_disp_dbg_msg(btcoexist, BTC_DBG_DISP_FW_PWR_MODE_CMD, m);\n\n\t \n\tseq_printf(m, \"\\n %-35s\",\n\t\t   \"============[Sw mechanism]============\");\n\tseq_printf(m, \"\\n %-35s = %d/ %d/ %d(0x%x) \",\n\t\t   \"SM2[AgcT/ AdcB/ SwDacSwing(lvl)]\",\n\t\t   coex_dm->cur_agc_table_en, coex_dm->cur_adc_back_off,\n\t\t   coex_dm->cur_dac_swing_on, coex_dm->cur_dac_swing_lvl);\n\n\t \n\tseq_printf(m, \"\\n %-35s\",\n\t\t   \"============[Fw mechanism]============\");\n\n\tif (!btcoexist->manual_control) {\n\t\tps_tdma_case = coex_dm->cur_ps_tdma;\n\t\tseq_printf(m, \"\\n %-35s = %5ph case-%d\",\n\t\t\t   \"PS TDMA\",\n\t\t\t   coex_dm->ps_tdma_para, ps_tdma_case);\n\n\t\tseq_printf(m, \"\\n %-35s = %d/ %d \", \"DecBtPwr/ IgnWlanAct\",\n\t\t\t   coex_dm->cur_dec_bt_pwr_lvl,\n\t\t\t   coex_dm->cur_ignore_wlan_act);\n\t}\n\n\t \n\tseq_printf(m, \"\\n %-35s\", \"============[Hw setting]============\");\n\n\tseq_printf(m, \"\\n %-35s = 0x%x\", \"RF-A, 0x1e initVal\",\n\t\t   coex_dm->bt_rf0x1e_backup);\n\n\tu1tmp[0] = btcoexist->btc_read_1byte(btcoexist, 0x778);\n\tu1tmp[1] = btcoexist->btc_read_1byte(btcoexist, 0x6cc);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x \",\n\t\t   \"0x778 (W_Act)/ 0x6cc (CoTab Sel)\",\n\t\t   u1tmp[0], u1tmp[1]);\n\n\tu1tmp[0] = btcoexist->btc_read_1byte(btcoexist, 0x8db);\n\tu1tmp[1] = btcoexist->btc_read_1byte(btcoexist, 0xc5b);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x\",\n\t\t   \"0x8db(ADC)/0xc5b[29:25](DAC)\",\n\t\t   ((u1tmp[0] & 0x60) >> 5), ((u1tmp[1] & 0x3e) >> 1));\n\n\tu4tmp[0] = btcoexist->btc_read_4byte(btcoexist, 0xcb4);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x\",\n\t\t   \"0xcb4[7:0](ctrl)/ 0xcb4[29:28](val)\",\n\t\t   u4tmp[0] & 0xff, ((u4tmp[0] & 0x30000000) >> 28));\n\n\tu1tmp[0] = btcoexist->btc_read_1byte(btcoexist, 0x40);\n\tu4tmp[0] = btcoexist->btc_read_4byte(btcoexist, 0x4c);\n\tu4tmp[1] = btcoexist->btc_read_4byte(btcoexist, 0x974);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x/ 0x%x\",\n\t\t   \"0x40/ 0x4c[24:23]/ 0x974\",\n\t\t   u1tmp[0], ((u4tmp[0] & 0x01800000) >> 23), u4tmp[1]);\n\n\tu4tmp[0] = btcoexist->btc_read_4byte(btcoexist, 0x550);\n\tu1tmp[0] = btcoexist->btc_read_1byte(btcoexist, 0x522);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x\",\n\t\t   \"0x550(bcn ctrl)/0x522\",\n\t\t   u4tmp[0], u1tmp[0]);\n\n\tu4tmp[0] = btcoexist->btc_read_4byte(btcoexist, 0xc50);\n\tu1tmp[0] = btcoexist->btc_read_1byte(btcoexist, 0xa0a);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x\",\n\t\t   \"0xc50(DIG)/0xa0a(CCK-TH)\",\n\t\t   u4tmp[0], u1tmp[0]);\n\n\tu4tmp[0] = btcoexist->btc_read_4byte(btcoexist, 0xf48);\n\tu1tmp[0] = btcoexist->btc_read_1byte(btcoexist, 0xa5b);\n\tu1tmp[1] = btcoexist->btc_read_1byte(btcoexist, 0xa5c);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x\",\n\t\t   \"OFDM-FA/ CCK-FA\",\n\t\t   u4tmp[0], (u1tmp[0] << 8) + u1tmp[1]);\n\n\tu4tmp[0] = btcoexist->btc_read_4byte(btcoexist, 0x6c0);\n\tu4tmp[1] = btcoexist->btc_read_4byte(btcoexist, 0x6c4);\n\tu4tmp[2] = btcoexist->btc_read_4byte(btcoexist, 0x6c8);\n\tseq_printf(m, \"\\n %-35s = 0x%x/ 0x%x/ 0x%x\",\n\t\t   \"0x6c0/0x6c4/0x6c8\",\n\t\t   u4tmp[0], u4tmp[1], u4tmp[2]);\n\n\tseq_printf(m, \"\\n %-35s = %d/ %d\",\n\t\t   \"0x770 (hi-pri Rx/Tx)\",\n\t\t   coex_sta->high_priority_rx, coex_sta->high_priority_tx);\n\tseq_printf(m, \"\\n %-35s = %d/ %d\",\n\t\t   \"0x774(low-pri Rx/Tx)\",\n\t\t   coex_sta->low_priority_rx, coex_sta->low_priority_tx);\n\n\t \n\tu1tmp[0] = btcoexist->btc_read_1byte(btcoexist, 0x41b);\n\tseq_printf(m, \"\\n %-35s = 0x%x\",\n\t\t   \"0x41b (mgntQ hang chk == 0xf)\",\n\t\t   u1tmp[0]);\n\n\tbtcoexist->btc_disp_dbg_msg(btcoexist, BTC_DBG_DISP_COEX_STATISTICS, m);\n}\n\nvoid ex_btc8821a2ant_ips_notify(struct btc_coexist *btcoexist, u8 type)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\tif (BTC_IPS_ENTER == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], IPS ENTER notify\\n\");\n\t\tcoex_sta->under_ips = true;\n\t\tbtc8821a2ant_wifi_off_hw_cfg(btcoexist);\n\t\tbtc8821a2ant_ignore_wlan_act(btcoexist, FORCE_EXEC, true);\n\t\tbtc8821a2ant_coex_all_off(btcoexist);\n\t} else if (BTC_IPS_LEAVE == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], IPS LEAVE notify\\n\");\n\t\tcoex_sta->under_ips = false;\n\t\tex_btc8821a2ant_init_hwconfig(btcoexist);\n\t\tbtc8821a2ant_init_coex_dm(btcoexist);\n\t\tbtc8821a2ant_query_bt_info(btcoexist);\n\t}\n}\n\nvoid ex_btc8821a2ant_lps_notify(struct btc_coexist *btcoexist, u8 type)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\tif (BTC_LPS_ENABLE == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], LPS ENABLE notify\\n\");\n\t\tcoex_sta->under_lps = true;\n\t} else if (BTC_LPS_DISABLE == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], LPS DISABLE notify\\n\");\n\t\tcoex_sta->under_lps = false;\n\t}\n}\n\nvoid ex_btc8821a2ant_scan_notify(struct btc_coexist *btcoexist, u8 type)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\tif (BTC_SCAN_START == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], SCAN START notify\\n\");\n\t} else if (BTC_SCAN_FINISH == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], SCAN FINISH notify\\n\");\n\t}\n}\n\nvoid ex_btc8821a2ant_connect_notify(struct btc_coexist *btcoexist, u8 type)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\tif (BTC_ASSOCIATE_START == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], CONNECT START notify\\n\");\n\t} else if (BTC_ASSOCIATE_FINISH == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], CONNECT FINISH notify\\n\");\n\t}\n}\n\nvoid ex_btc8821a2ant_media_status_notify(struct btc_coexist *btcoexist,\n\t\t\t\t\t u8 type)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 h2c_parameter[3] = {0};\n\tu32 wifi_bw;\n\tu8 wifi_central_chnl;\n\tu8 ap_num = 0;\n\n\tif (BTC_MEDIA_CONNECT == type) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], MEDIA connect notify\\n\");\n\t} else {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], MEDIA disconnect notify\\n\");\n\t}\n\n\t \n\tbtcoexist->btc_get(btcoexist, BTC_GET_U1_WIFI_CENTRAL_CHNL,\n\t\t\t   &wifi_central_chnl);\n\tif ((BTC_MEDIA_CONNECT == type) &&\n\t    (wifi_central_chnl <= 14)) {\n\t\th2c_parameter[0] = 0x1;\n\t\th2c_parameter[1] = wifi_central_chnl;\n\t\tbtcoexist->btc_get(btcoexist, BTC_GET_U4_WIFI_BW, &wifi_bw);\n\t\tif (wifi_bw == BTC_WIFI_BW_HT40) {\n\t\t\th2c_parameter[2] = 0x30;\n\t\t} else {\n\t\t\th2c_parameter[2] = 0x20;\n\t\t\tif (ap_num < 10)\n\t\t\t\th2c_parameter[2] = 0x30;\n\t\t\telse\n\t\t\t\th2c_parameter[2] = 0x20;\n\t\t}\n\t}\n\n\tcoex_dm->wifi_chnl_info[0] = h2c_parameter[0];\n\tcoex_dm->wifi_chnl_info[1] = h2c_parameter[1];\n\tcoex_dm->wifi_chnl_info[2] = h2c_parameter[2];\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], FW write 0x66 = 0x%x\\n\",\n\t\th2c_parameter[0] << 16 |\n\t\th2c_parameter[1] << 8 |\n\t\th2c_parameter[2]);\n\n\tbtcoexist->btc_fill_h2c(btcoexist, 0x66, 3, h2c_parameter);\n}\n\nvoid ex_btc8821a2ant_special_packet_notify(struct btc_coexist *btcoexist,\n\t\t\t\t\t   u8 type)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\tif (type == BTC_PACKET_DHCP) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], DHCP Packet notify\\n\");\n\t}\n}\n\nvoid ex_btc8821a2ant_bt_info_notify(struct btc_coexist *btcoexist,\n\t\t\t\t    u8 *tmp_buf, u8 length)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\tu8 bt_info = 0;\n\tu8 i, rsp_source = 0;\n\tbool bt_busy = false, limited_dig = false;\n\tbool wifi_connected = false, wifi_under_5g = false;\n\n\tcoex_sta->c2h_bt_info_req_sent = false;\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_UNDER_5G, &wifi_under_5g);\n\tbtcoexist->btc_get(btcoexist, BTC_GET_BL_WIFI_CONNECTED,\n\t\t\t   &wifi_connected);\n\n\trsp_source = tmp_buf[0] & 0xf;\n\tif (rsp_source >= BT_INFO_SRC_8821A_2ANT_MAX)\n\t\trsp_source = BT_INFO_SRC_8821A_2ANT_WIFI_FW;\n\tcoex_sta->bt_info_c2h_cnt[rsp_source]++;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Bt info[%d], length = %d, hex data = [\",\n\t\trsp_source, length);\n\tfor (i = 0; i < length; i++) {\n\t\tcoex_sta->bt_info_c2h[rsp_source][i] = tmp_buf[i];\n\t\tif (i == 1)\n\t\t\tbt_info = tmp_buf[i];\n\t\tif (i == length - 1) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"0x%02x]\\n\", tmp_buf[i]);\n\t\t} else {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"0x%02x, \", tmp_buf[i]);\n\t\t}\n\t}\n\n\tif (btcoexist->manual_control) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], BtInfoNotify(), return for Manual CTRL<===\\n\");\n\t\treturn;\n\t}\n\n\tif (BT_INFO_SRC_8821A_2ANT_WIFI_FW != rsp_source) {\n\t\t \n\t\tcoex_sta->bt_retry_cnt =\n\t\t\tcoex_sta->bt_info_c2h[rsp_source][2]&0xf;\n\n\t\tcoex_sta->bt_rssi =\n\t\t\tcoex_sta->bt_info_c2h[rsp_source][3] * 2 + 10;\n\n\t\tcoex_sta->bt_info_ext = coex_sta->bt_info_c2h[rsp_source][4];\n\n\t\tcoex_sta->bt_tx_rx_mask =\n\t\t\t(coex_sta->bt_info_c2h[rsp_source][2] & 0x40);\n\t\tbtcoexist->btc_set(btcoexist, BTC_SET_BL_BT_TX_RX_MASK,\n\t\t\t\t   &coex_sta->bt_tx_rx_mask);\n\t\tif (coex_sta->bt_tx_rx_mask) {\n\t\t\t \n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Switch BT TRx Mask since BT RF REG 0x3C != 0x01\\n\");\n\t\t\tbtcoexist->btc_set_bt_reg(btcoexist, BTC_BT_REG_RF,\n\t\t\t\t\t\t  0x3c, 0x01);\n\t\t}\n\n\t\t \n\t\tif ((coex_sta->bt_info_ext & BIT1)) {\n\t\t\tbtcoexist->btc_get(btcoexist,\n\t\t\t\tBTC_GET_BL_WIFI_CONNECTED, &wifi_connected);\n\t\t\tif (wifi_connected) {\n\t\t\t\tex_btc8821a2ant_media_status_notify(btcoexist,\n\t\t\t\t\tBTC_MEDIA_CONNECT);\n\t\t\t} else {\n\t\t\t\tex_btc8821a2ant_media_status_notify(btcoexist,\n\t\t\t\t\tBTC_MEDIA_DISCONNECT);\n\t\t\t}\n\n\t\t}\n\n\t\tif (!btcoexist->manual_control && !wifi_under_5g) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], BT ext info = 0x%x!!\\n\",\n\t\t\t\tcoex_sta->bt_info_ext);\n\t\t\tif ((coex_sta->bt_info_ext & BIT(3))) {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT ext info bit3=1, wifi_connected=%d\\n\",\n\t\t\t\t\twifi_connected);\n\t\t\t\tif (wifi_connected) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], BT ext info bit3 check, set BT NOT to ignore Wlan active!!\\n\");\n\t\t\t\t\tbtc8821a2ant_ignore_wlan_act(btcoexist,\n\t\t\t\t\t\t\t\t     FORCE_EXEC,\n\t\t\t\t\t\t\t\t     false);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\t\"[BTCoex], BT ext info bit3=0, wifi_connected=%d\\n\",\n\t\t\t\t\twifi_connected);\n\t\t\t\t \n\t\t\t\tif (!wifi_connected) {\n\t\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST,\n\t\t\t\t\t\tDBG_LOUD,\n\t\t\t\t\t\t\"[BTCoex], BT ext info bit3 check, set BT to ignore Wlan active!!\\n\");\n\t\t\t\t\tbtc8821a2ant_ignore_wlan_act(\n\t\t\t\t\t\tbtcoexist, FORCE_EXEC, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t \n\tif (bt_info & BT_INFO_8821A_2ANT_B_INQ_PAGE) {\n\t\tcoex_sta->c2h_bt_inquiry_page = true;\n\t} else {\n\t\tcoex_sta->c2h_bt_inquiry_page = false;\n\t}\n\t \n\tif (!(bt_info & BT_INFO_8821A_2ANT_B_CONNECTION)) {\n\t\tcoex_sta->bt_link_exist = false;\n\t\tcoex_sta->pan_exist = false;\n\t\tcoex_sta->a2dp_exist = false;\n\t\tcoex_sta->hid_exist = false;\n\t\tcoex_sta->sco_exist = false;\n\t} else {  \n\t\tcoex_sta->bt_link_exist = true;\n\t\tif (bt_info & BT_INFO_8821A_2ANT_B_FTP)\n\t\t\tcoex_sta->pan_exist = true;\n\t\telse\n\t\t\tcoex_sta->pan_exist = false;\n\t\tif (bt_info & BT_INFO_8821A_2ANT_B_A2DP)\n\t\t\tcoex_sta->a2dp_exist = true;\n\t\telse\n\t\t\tcoex_sta->a2dp_exist = false;\n\t\tif (bt_info & BT_INFO_8821A_2ANT_B_HID)\n\t\t\tcoex_sta->hid_exist = true;\n\t\telse\n\t\t\tcoex_sta->hid_exist = false;\n\t\tif (bt_info & BT_INFO_8821A_2ANT_B_SCO_ESCO)\n\t\t\tcoex_sta->sco_exist = true;\n\t\telse\n\t\t\tcoex_sta->sco_exist = false;\n\n\t\tif ((!coex_sta->hid_exist) &&\n\t\t    (!coex_sta->c2h_bt_inquiry_page) &&\n\t\t    (!coex_sta->sco_exist)) {\n\t\t\tif (coex_sta->high_priority_tx +\n\t\t\t\t    coex_sta->high_priority_rx >= 160)\n\t\t\t\tcoex_sta->hid_exist = true;\n\t\t}\n\t}\n\n\tbtc8821a2ant_update_bt_link_info(btcoexist);\n\n\tif (!(bt_info & BT_INFO_8821A_2ANT_B_CONNECTION)) {\n\t\tcoex_dm->bt_status = BT_8821A_2ANT_BT_STATUS_IDLE;\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], BtInfoNotify(), BT Non-Connected idle!!!\\n\");\n\t} else if (bt_info == BT_INFO_8821A_2ANT_B_CONNECTION) {\n\t\t \n\t\tcoex_dm->bt_status = BT_8821A_2ANT_BT_STATUS_CON_IDLE;\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], BtInfoNotify(), BT Connected-idle!!!\\n\");\n\t} else if ((bt_info & BT_INFO_8821A_2ANT_B_SCO_ESCO) ||\n\t\t   (bt_info & BT_INFO_8821A_2ANT_B_SCO_BUSY)) {\n\t\tcoex_dm->bt_status = BT_8821A_2ANT_BT_STATUS_SCO_BUSY;\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], BtInfoNotify(), BT SCO busy!!!\\n\");\n\t} else if (bt_info & BT_INFO_8821A_2ANT_B_ACL_BUSY) {\n\t\tcoex_dm->bt_status = BT_8821A_2ANT_BT_STATUS_ACL_BUSY;\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], BtInfoNotify(), BT ACL busy!!!\\n\");\n\t} else {\n\t\tcoex_dm->bt_status = BT_8821A_2ANT_BT_STATUS_MAX;\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], BtInfoNotify(), BT Non-Defined state!!!\\n\");\n\t}\n\n\tif ((coex_dm->bt_status == BT_8821A_2ANT_BT_STATUS_ACL_BUSY) ||\n\t    (coex_dm->bt_status == BT_8821A_2ANT_BT_STATUS_SCO_BUSY) ||\n\t    (coex_dm->bt_status == BT_8821A_2ANT_BT_STATUS_ACL_SCO_BUSY)) {\n\t\tbt_busy = true;\n\t\tlimited_dig = true;\n\t} else {\n\t\tbt_busy = false;\n\t\tlimited_dig = false;\n\t}\n\n\tbtcoexist->btc_set(btcoexist, BTC_SET_BL_BT_TRAFFIC_BUSY, &bt_busy);\n\n\tcoex_dm->limited_dig = limited_dig;\n\tbtcoexist->btc_set(btcoexist, BTC_SET_BL_BT_LIMITED_DIG, &limited_dig);\n\n\tbtc8821a2ant_run_coexist_mechanism(btcoexist);\n}\n\nvoid ex_btc8821a2ant_halt_notify(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], Halt notify\\n\");\n\n\tbtc8821a2ant_wifi_off_hw_cfg(btcoexist);\n\tbtc8821a2ant_ignore_wlan_act(btcoexist, FORCE_EXEC, true);\n\tex_btc8821a2ant_media_status_notify(btcoexist, BTC_MEDIA_DISCONNECT);\n}\n\nvoid ex_btc8821a2ant_pnp_notify(struct btc_coexist *btcoexist, u8 pnp_state)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD, \"[BTCoex], Pnp notify\\n\");\n\n\tif (pnp_state == BTC_WIFI_PNP_SLEEP) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Pnp notify to SLEEP\\n\");\n\t} else if (pnp_state == BTC_WIFI_PNP_WAKE_UP) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\"[BTCoex], Pnp notify to WAKE UP\\n\");\n\t\tex_btc8821a2ant_init_hwconfig(btcoexist);\n\t\tbtc8821a2ant_init_coex_dm(btcoexist);\n\t\tbtc8821a2ant_query_bt_info(btcoexist);\n\t}\n}\n\nvoid ex_btc8821a2ant_periodical(struct btc_coexist *btcoexist)\n{\n\tstruct rtl_priv *rtlpriv = btcoexist->adapter;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\"[BTCoex], ==========================Periodical===========================\\n\");\n\n\tif (coex_sta->dis_ver_info_cnt <= 5) {\n\t\tcoex_sta->dis_ver_info_cnt += 1;\n\t\tif (coex_sta->dis_ver_info_cnt == 3) {\n\t\t\t \n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_LOUD,\n\t\t\t\t\"[BTCoex], Set GNT_BT control by PTA\\n\");\n\t\t\tbtc8821a2ant_set_ant_path(btcoexist,\n\t\t\t\t\tBTC_ANT_WIFI_AT_MAIN, false, false);\n\t\t}\n\t}\n\n\tif (btcoexist->auto_report_2ant) {\n\t\tbtc8821a2ant_query_bt_info(btcoexist);\n\t} else {\n\t\tbtc8821a2ant_monitor_bt_ctr(btcoexist);\n\t\tbtc8821a2ant_monitor_wifi_ctr(btcoexist);\n\n\t\tif (btc8821a2ant_is_wifi_status_changed(btcoexist) ||\n\t\t    coex_dm->auto_tdma_adjust)\n\t\t\tbtc8821a2ant_run_coexist_mechanism(btcoexist);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}