{
  "module_name": "dm.c",
  "hash_id": "1d6d4526fa9e279b198dea4f1afe96cf7b26f2b9f29aa1fc4f4c16a22ea25ff4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtlwifi/rtl8192cu/dm.c",
  "human_readable_source": "\n \n\n#include \"../wifi.h\"\n#include \"../base.h\"\n#include \"reg.h\"\n#include \"def.h\"\n#include \"phy.h\"\n#include \"dm.h\"\n\nvoid rtl92cu_dm_dynamic_txpower(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\tstruct rtl_mac *mac = rtl_mac(rtl_priv(hw));\n\tlong undec_sm_pwdb;\n\n\tif (!rtlpriv->dm.dynamic_txpower_enable)\n\t\treturn;\n\n\tif (rtlpriv->dm.dm_flag & HAL_DM_HIPWR_DISABLE) {\n\t\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_NORMAL;\n\t\treturn;\n\t}\n\n\tif ((mac->link_state < MAC80211_LINKED) &&\n\t    (rtlpriv->dm.entry_min_undec_sm_pwdb == 0)) {\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_TRACE,\n\t\t\t\"Not connected to any\\n\");\n\n\t\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_NORMAL;\n\n\t\trtlpriv->dm.last_dtp_lvl = TXHIGHPWRLEVEL_NORMAL;\n\t\treturn;\n\t}\n\n\tif (mac->link_state >= MAC80211_LINKED) {\n\t\tif (mac->opmode == NL80211_IFTYPE_ADHOC) {\n\t\t\tundec_sm_pwdb = rtlpriv->dm.entry_min_undec_sm_pwdb;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\t\"AP Client PWDB = 0x%lx\\n\",\n\t\t\t\tundec_sm_pwdb);\n\t\t} else {\n\t\t\tundec_sm_pwdb = rtlpriv->dm.undec_sm_pwdb;\n\t\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\t\"STA Default Port PWDB = 0x%lx\\n\",\n\t\t\t\tundec_sm_pwdb);\n\t\t}\n\t} else {\n\t\tundec_sm_pwdb = rtlpriv->dm.entry_min_undec_sm_pwdb;\n\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\"AP Ext Port PWDB = 0x%lx\\n\",\n\t\t\tundec_sm_pwdb);\n\t}\n\n\tif (undec_sm_pwdb >= TX_POWER_NEAR_FIELD_THRESH_LVL2) {\n\t\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_LEVEL1;\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\"TXHIGHPWRLEVEL_LEVEL1 (TxPwr=0x0)\\n\");\n\t} else if ((undec_sm_pwdb < (TX_POWER_NEAR_FIELD_THRESH_LVL2 - 3)) &&\n\t\t   (undec_sm_pwdb >= TX_POWER_NEAR_FIELD_THRESH_LVL1)) {\n\n\t\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_LEVEL1;\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\"TXHIGHPWRLEVEL_LEVEL1 (TxPwr=0x10)\\n\");\n\t} else if (undec_sm_pwdb < (TX_POWER_NEAR_FIELD_THRESH_LVL1 - 5)) {\n\t\trtlpriv->dm.dynamic_txhighpower_lvl = TXHIGHPWRLEVEL_NORMAL;\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\"TXHIGHPWRLEVEL_NORMAL\\n\");\n\t}\n\n\tif ((rtlpriv->dm.dynamic_txhighpower_lvl != rtlpriv->dm.last_dtp_lvl)) {\n\t\trtl_dbg(rtlpriv, COMP_POWER, DBG_LOUD,\n\t\t\t\"PHY_SetTxPowerLevel8192S() Channel = %d\\n\",\n\t\t\t rtlphy->current_channel);\n\t\trtl92c_phy_set_txpower_level(hw, rtlphy->current_channel);\n\t\tif (rtlpriv->dm.dynamic_txhighpower_lvl ==\n\t\t    TXHIGHPWRLEVEL_NORMAL)\n\t\t\tdm_restorepowerindex(hw);\n\t\telse if (rtlpriv->dm.dynamic_txhighpower_lvl ==\n\t\t\t TXHIGHPWRLEVEL_LEVEL1)\n\t\t\tdm_writepowerindex(hw, 0x14);\n\t\telse if (rtlpriv->dm.dynamic_txhighpower_lvl ==\n\t\t\t TXHIGHPWRLEVEL_LEVEL2)\n\t\t\tdm_writepowerindex(hw, 0x10);\n\t}\n\n\trtlpriv->dm.last_dtp_lvl = rtlpriv->dm.dynamic_txhighpower_lvl;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}