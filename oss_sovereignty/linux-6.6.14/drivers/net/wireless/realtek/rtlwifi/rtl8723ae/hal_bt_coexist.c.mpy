{
  "module_name": "hal_bt_coexist.c",
  "hash_id": "116685b3cdb9cd760ed62943cd7f79bbca6bcb990972cad4fb44ff3cdf52da35",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/realtek/rtlwifi/rtl8723ae/hal_bt_coexist.c",
  "human_readable_source": "\n \n\n#include \"hal_bt_coexist.h\"\n#include \"../pci.h\"\n#include \"dm.h\"\n#include \"fw.h\"\n#include \"phy.h\"\n#include \"reg.h\"\n#include \"hal_btc.h\"\n\nstatic bool bt_operation_on;\n\nvoid rtl8723e_dm_bt_reject_ap_aggregated_packet(struct ieee80211_hw *hw,\n\t\t\t\t\t\tbool b_reject)\n{\n}\n\nvoid _rtl8723_dm_bt_check_wifi_state(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tstruct rtl_phy *rtlphy = &(rtlpriv->phy);\n\n\tif (rtlpriv->link_info.busytraffic) {\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_IDLE;\n\n\t\tif (rtlpriv->link_info.tx_busy_traffic)\n\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\tBT_COEX_STATE_WIFI_UPLINK;\n\t\telse\n\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t~BT_COEX_STATE_WIFI_UPLINK;\n\n\t\tif (rtlpriv->link_info.rx_busy_traffic)\n\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\tBT_COEX_STATE_WIFI_DOWNLINK;\n\t\telse\n\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t~BT_COEX_STATE_WIFI_DOWNLINK;\n\t} else {\n\t\trtlpriv->btcoexist.cstate |= BT_COEX_STATE_WIFI_IDLE;\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_UPLINK;\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_DOWNLINK;\n\t}\n\n\tif (rtlpriv->mac80211.mode == WIRELESS_MODE_G ||\n\t    rtlpriv->mac80211.mode == WIRELESS_MODE_B) {\n\t\trtlpriv->btcoexist.cstate |=\n\t\t\tBT_COEX_STATE_WIFI_LEGACY;\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_HT20;\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_HT40;\n\t} else {\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_LEGACY;\n\t\tif (rtlphy->current_chan_bw == HT_CHANNEL_WIDTH_20_40) {\n\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\tBT_COEX_STATE_WIFI_HT40;\n\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t~BT_COEX_STATE_WIFI_HT20;\n\t\t} else {\n\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\tBT_COEX_STATE_WIFI_HT20;\n\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t~BT_COEX_STATE_WIFI_HT40;\n\t\t}\n\t}\n\n\tif (bt_operation_on)\n\t\trtlpriv->btcoexist.cstate |= BT_COEX_STATE_BT30;\n\telse\n\t\trtlpriv->btcoexist.cstate &= ~BT_COEX_STATE_BT30;\n}\n\nu8 rtl8723e_dm_bt_check_coex_rssi_state1(struct ieee80211_hw *hw,\n\t\t\t\t\t u8 level_num, u8 rssi_thresh,\n\t\t\t\t\t u8 rssi_thresh1)\n\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tlong undecoratedsmoothed_pwdb;\n\tu8 bt_rssi_state = 0;\n\n\tundecoratedsmoothed_pwdb = rtl8723e_dm_bt_get_rx_ss(hw);\n\n\tif (level_num == 2) {\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_MEDIUM;\n\n\t\tif ((rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_LOW) ||\n\t\t    (rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (undecoratedsmoothed_pwdb >=\n\t\t\t    (rssi_thresh + BT_FW_COEX_THRESH_TOL)) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\t\tBT_COEX_STATE_WIFI_RSSI_1_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state switch to High\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state stay at Low\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (undecoratedsmoothed_pwdb < rssi_thresh) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\t\tBT_COEX_STATE_WIFI_RSSI_1_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t} else if (level_num == 3) {\n\t\tif (rssi_thresh > rssi_thresh1) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\"[DM][BT], RSSI_1 thresh error!!\\n\");\n\t\t\treturn rtlpriv->btcoexist.bt_pre_rssi_state;\n\t\t}\n\n\t\tif ((rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_LOW) ||\n\t\t    (rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (undecoratedsmoothed_pwdb >=\n\t\t\t    (rssi_thresh+BT_FW_COEX_THRESH_TOL)) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\t\tBT_COEX_STATE_WIFI_RSSI_1_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state stay at Low\\n\");\n\t\t\t}\n\t\t} else if ((rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t\t    BT_RSSI_STATE_MEDIUM) ||\n\t\t\t   (rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t\t    BT_RSSI_STATE_STAY_MEDIUM)) {\n\t\t\tif (undecoratedsmoothed_pwdb >=\n\t\t\t    (rssi_thresh1 + BT_FW_COEX_THRESH_TOL)) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\t\tBT_COEX_STATE_WIFI_RSSI_1_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state switch to High\\n\");\n\t\t\t} else if (undecoratedsmoothed_pwdb < rssi_thresh) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\t\tBT_COEX_STATE_WIFI_RSSI_1_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state stay at Medium\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (undecoratedsmoothed_pwdb < rssi_thresh1) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate |=\n\t\t\t\t\tBT_COEX_STATE_WIFI_RSSI_1_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate &=\n\t\t\t\t\t~BT_COEX_STATE_WIFI_RSSI_1_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI_1 state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t}\n\trtlpriv->btcoexist.bt_pre_rssi_state1 = bt_rssi_state;\n\n\treturn bt_rssi_state;\n}\n\nu8 rtl8723e_dm_bt_check_coex_rssi_state(struct ieee80211_hw *hw,\n\t\t\t\t\tu8 level_num,\n\t\t\t\t\tu8 rssi_thresh,\n\t\t\t\t\tu8 rssi_thresh1)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tlong undecoratedsmoothed_pwdb = 0;\n\tu8 bt_rssi_state = 0;\n\n\tundecoratedsmoothed_pwdb = rtl8723e_dm_bt_get_rx_ss(hw);\n\n\tif (level_num == 2) {\n\t\trtlpriv->btcoexist.cstate &=\n\t\t\t~BT_COEX_STATE_WIFI_RSSI_MEDIUM;\n\n\t\tif ((rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_LOW) ||\n\t\t    (rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (undecoratedsmoothed_pwdb >=\n\t\t\t    (rssi_thresh + BT_FW_COEX_THRESH_TOL)) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t|= BT_COEX_STATE_WIFI_RSSI_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state switch to High\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state stay at Low\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (undecoratedsmoothed_pwdb < rssi_thresh) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t|= BT_COEX_STATE_WIFI_RSSI_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t} else if (level_num == 3) {\n\t\tif (rssi_thresh > rssi_thresh1) {\n\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\"[DM][BT], RSSI thresh error!!\\n\");\n\t\t\treturn rtlpriv->btcoexist.bt_pre_rssi_state;\n\t\t}\n\t\tif ((rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_LOW) ||\n\t\t    (rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t     BT_RSSI_STATE_STAY_LOW)) {\n\t\t\tif (undecoratedsmoothed_pwdb >=\n\t\t\t    (rssi_thresh + BT_FW_COEX_THRESH_TOL)) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t|= BT_COEX_STATE_WIFI_RSSI_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state stay at Low\\n\");\n\t\t\t}\n\t\t} else if ((rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t\t\tBT_RSSI_STATE_MEDIUM) ||\n\t\t\t(rtlpriv->btcoexist.bt_pre_rssi_state ==\n\t\t\t\tBT_RSSI_STATE_STAY_MEDIUM)) {\n\t\t\tif (undecoratedsmoothed_pwdb >=\n\t\t\t    (rssi_thresh1 + BT_FW_COEX_THRESH_TOL)) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t|= BT_COEX_STATE_WIFI_RSSI_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state switch to High\\n\");\n\t\t\t} else if (undecoratedsmoothed_pwdb < rssi_thresh) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t|= BT_COEX_STATE_WIFI_RSSI_LOW;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state switch to Low\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_MEDIUM;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state stay at Medium\\n\");\n\t\t\t}\n\t\t} else {\n\t\t\tif (undecoratedsmoothed_pwdb < rssi_thresh1) {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t|= BT_COEX_STATE_WIFI_RSSI_MEDIUM;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_HIGH;\n\t\t\t\trtlpriv->btcoexist.cstate\n\t\t\t\t\t&= ~BT_COEX_STATE_WIFI_RSSI_LOW;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state switch to Medium\\n\");\n\t\t\t} else {\n\t\t\t\tbt_rssi_state = BT_RSSI_STATE_STAY_HIGH;\n\t\t\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\t\t\"[DM][BT], RSSI state stay at High\\n\");\n\t\t\t}\n\t\t}\n\t}\n\trtlpriv->btcoexist.bt_pre_rssi_state = bt_rssi_state;\n\treturn bt_rssi_state;\n}\n\nlong rtl8723e_dm_bt_get_rx_ss(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tlong undecoratedsmoothed_pwdb = 0;\n\n\tif (rtlpriv->mac80211.link_state >= MAC80211_LINKED) {\n\t\tundecoratedsmoothed_pwdb =\n\t\t\tGET_UNDECORATED_AVERAGE_RSSI(rtlpriv);\n\t} else {\n\t\tundecoratedsmoothed_pwdb\n\t\t\t= rtlpriv->dm.entry_min_undec_sm_pwdb;\n\t}\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"%s = %ld\\n\", __func__,\n\t\tundecoratedsmoothed_pwdb);\n\n\treturn undecoratedsmoothed_pwdb;\n}\n\nvoid rtl8723e_dm_bt_balance(struct ieee80211_hw *hw,\n\t\t\t    bool balance_on, u8 ms0, u8 ms1)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\tu8 h2c_parameter[3] = {0};\n\n\tif (balance_on) {\n\t\th2c_parameter[2] = 1;\n\t\th2c_parameter[1] = ms1;\n\t\th2c_parameter[0] = ms0;\n\t\trtlpriv->btcoexist.fw_coexist_all_off = false;\n\t} else {\n\t\th2c_parameter[2] = 0;\n\t\th2c_parameter[1] = 0;\n\t\th2c_parameter[0] = 0;\n\t}\n\trtlpriv->btcoexist.balance_on = balance_on;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"[DM][BT], Balance=[%s:%dms:%dms], write 0xc=0x%x\\n\",\n\t\tbalance_on ? \"ON\" : \"OFF\", ms0, ms1, h2c_parameter[0] << 16 |\n\t\th2c_parameter[1] << 8 | h2c_parameter[2]);\n\n\trtl8723e_fill_h2c_cmd(hw, 0xc, 3, h2c_parameter);\n}\n\n\nvoid rtl8723e_dm_bt_agc_table(struct ieee80211_hw *hw, u8 type)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\tif (type == BT_AGCTABLE_OFF) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\"[BT]AGCTable Off!\\n\");\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x641c0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x631d0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x621e0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x611f0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x60200001);\n\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0x32000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0x71000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0xb0000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0xfc000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_G1, 0xfffff, 0x30355);\n\t} else if (type == BT_AGCTABLE_ON) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\"[BT]AGCTable On!\\n\");\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x4e1c0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x4d1d0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x4c1e0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x4b1f0001);\n\t\trtl_write_dword(rtlpriv, 0xc78, 0x4a200001);\n\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0xdc000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0x90000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0x51000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_AGC_HP, 0xfffff, 0x12000);\n\t\trtl8723e_phy_set_rf_reg(hw, RF90_PATH_A,\n\t\t\t\t\tRF_RX_G1, 0xfffff, 0x00355);\n\n\t\trtlpriv->btcoexist.sw_coexist_all_off = false;\n\t}\n}\n\nvoid rtl8723e_dm_bt_bb_back_off_level(struct ieee80211_hw *hw, u8 type)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\tif (type == BT_BB_BACKOFF_OFF) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\"[BT]BBBackOffLevel Off!\\n\");\n\t\trtl_write_dword(rtlpriv, 0xc04, 0x3a05611);\n\t} else if (type == BT_BB_BACKOFF_ON) {\n\t\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\t\"[BT]BBBackOffLevel On!\\n\");\n\t\trtl_write_dword(rtlpriv, 0xc04, 0x3a07611);\n\t\trtlpriv->btcoexist.sw_coexist_all_off = false;\n\t}\n}\n\nvoid rtl8723e_dm_bt_fw_coex_all_off(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"rtl8723e_dm_bt_fw_coex_all_off()\\n\");\n\n\tif (rtlpriv->btcoexist.fw_coexist_all_off)\n\t\treturn;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"rtl8723e_dm_bt_fw_coex_all_off(), real Do\\n\");\n\trtl8723e_dm_bt_fw_coex_all_off_8723a(hw);\n\trtlpriv->btcoexist.fw_coexist_all_off = true;\n}\n\nvoid rtl8723e_dm_bt_sw_coex_all_off(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"%s\\n\", __func__);\n\n\tif (rtlpriv->btcoexist.sw_coexist_all_off)\n\t\treturn;\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"%s, real Do\\n\", __func__);\n\trtl8723e_dm_bt_sw_coex_all_off_8723a(hw);\n\trtlpriv->btcoexist.sw_coexist_all_off = true;\n}\n\nvoid rtl8723e_dm_bt_hw_coex_all_off(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"%s\\n\", __func__);\n\n\tif (rtlpriv->btcoexist.hw_coexist_all_off)\n\t\treturn;\n\trtl_dbg(rtlpriv, COMP_BT_COEXIST, DBG_TRACE,\n\t\t\"%s, real Do\\n\", __func__);\n\n\trtl8723e_dm_bt_hw_coex_all_off_8723a(hw);\n\n\trtlpriv->btcoexist.hw_coexist_all_off = true;\n}\n\nvoid rtl8723e_btdm_coex_all_off(struct ieee80211_hw *hw)\n{\n\trtl8723e_dm_bt_fw_coex_all_off(hw);\n\trtl8723e_dm_bt_sw_coex_all_off(hw);\n\trtl8723e_dm_bt_hw_coex_all_off(hw);\n}\n\nbool rtl8723e_dm_bt_is_coexist_state_changed(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\tif ((rtlpriv->btcoexist.previous_state == rtlpriv->btcoexist.cstate) &&\n\t    (rtlpriv->btcoexist.previous_state_h ==\n\t     rtlpriv->btcoexist.cstate_h))\n\t\treturn false;\n\treturn true;\n}\n\nbool rtl8723e_dm_bt_is_wifi_up_link(struct ieee80211_hw *hw)\n{\n\tstruct rtl_priv *rtlpriv = rtl_priv(hw);\n\n\tif (rtlpriv->link_info.tx_busy_traffic)\n\t\treturn true;\n\treturn false;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}