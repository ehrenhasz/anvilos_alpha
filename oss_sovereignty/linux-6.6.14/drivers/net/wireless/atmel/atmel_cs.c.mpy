{
  "module_name": "atmel_cs.c",
  "hash_id": "a8b960525355b836352ffda894f768be054faaed81a86b118c192da41d260f78",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/atmel/atmel_cs.c",
  "human_readable_source": " \n\n#ifdef __IN_PCMCIA_PACKAGE__\n#include <pcmcia/k_compat.h>\n#endif\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/ptrace.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/netdevice.h>\n#include <linux/moduleparam.h>\n#include <linux/device.h>\n\n#include <pcmcia/cistpl.h>\n#include <pcmcia/cisreg.h>\n#include <pcmcia/ds.h>\n#include <pcmcia/ciscode.h>\n\n#include <asm/io.h>\n#include <linux/wireless.h>\n\n#include \"atmel.h\"\n\n\n \n\nMODULE_AUTHOR(\"Simon Kelley\");\nMODULE_DESCRIPTION(\"Support for Atmel at76c50x 802.11 wireless ethernet cards.\");\nMODULE_LICENSE(\"GPL\");\n\n \n\nstatic int atmel_config(struct pcmcia_device *link);\nstatic void atmel_release(struct pcmcia_device *link);\n\nstatic void atmel_detach(struct pcmcia_device *p_dev);\n\nstruct local_info {\n\tstruct net_device *eth_dev;\n};\n\nstatic int atmel_probe(struct pcmcia_device *p_dev)\n{\n\tstruct local_info *local;\n\tint ret;\n\n\tdev_dbg(&p_dev->dev, \"atmel_attach()\\n\");\n\n\t \n\tlocal = kzalloc(sizeof(*local), GFP_KERNEL);\n\tif (!local)\n\t\treturn -ENOMEM;\n\n\tp_dev->priv = local;\n\n\tret = atmel_config(p_dev);\n\tif (ret)\n\t\tgoto err_free_priv;\n\n\treturn 0;\n\nerr_free_priv:\n\tkfree(p_dev->priv);\n\treturn ret;\n}\n\nstatic void atmel_detach(struct pcmcia_device *link)\n{\n\tdev_dbg(&link->dev, \"atmel_detach\\n\");\n\n\tatmel_release(link);\n\n\tkfree(link->priv);\n}\n\n \nstatic int card_present(void *arg)\n{\n\tstruct pcmcia_device *link = (struct pcmcia_device *)arg;\n\n\tif (pcmcia_dev_present(link))\n\t\treturn 1;\n\n\treturn 0;\n}\n\nstatic int atmel_config_check(struct pcmcia_device *p_dev, void *priv_data)\n{\n\tif (p_dev->config_index == 0)\n\t\treturn -EINVAL;\n\n\treturn pcmcia_request_io(p_dev);\n}\n\nstatic int atmel_config(struct pcmcia_device *link)\n{\n\tint ret;\n\tconst struct pcmcia_device_id *did;\n\n\tdid = dev_get_drvdata(&link->dev);\n\n\tdev_dbg(&link->dev, \"atmel_config\\n\");\n\n\tlink->config_flags |= CONF_ENABLE_IRQ | CONF_AUTO_SET_VPP |\n\t\tCONF_AUTO_AUDIO | CONF_AUTO_SET_IO;\n\n\tif (pcmcia_loop_config(link, atmel_config_check, NULL))\n\t\tgoto failed;\n\n\tif (!link->irq) {\n\t\tdev_err(&link->dev, \"atmel: cannot assign IRQ: check that CONFIG_ISA is set in kernel config.\");\n\t\tgoto failed;\n\t}\n\n\tret = pcmcia_enable_device(link);\n\tif (ret)\n\t\tgoto failed;\n\n\t((struct local_info *)link->priv)->eth_dev =\n\t\tinit_atmel_card(link->irq,\n\t\t\t\tlink->resource[0]->start,\n\t\t\t\tdid ? did->driver_info : ATMEL_FW_TYPE_NONE,\n\t\t\t\t&link->dev,\n\t\t\t\tcard_present,\n\t\t\t\tlink);\n\tif (!((struct local_info *)link->priv)->eth_dev)\n\t\t\tgoto failed;\n\n\n\treturn 0;\n\n failed:\n\tatmel_release(link);\n\treturn -ENODEV;\n}\n\nstatic void atmel_release(struct pcmcia_device *link)\n{\n\tstruct net_device *dev = ((struct local_info *)link->priv)->eth_dev;\n\n\tdev_dbg(&link->dev, \"atmel_release\\n\");\n\n\tif (dev)\n\t\tstop_atmel_card(dev);\n\t((struct local_info *)link->priv)->eth_dev = NULL;\n\n\tpcmcia_disable_device(link);\n}\n\nstatic int atmel_suspend(struct pcmcia_device *link)\n{\n\tstruct local_info *local = link->priv;\n\n\tnetif_device_detach(local->eth_dev);\n\n\treturn 0;\n}\n\nstatic int atmel_resume(struct pcmcia_device *link)\n{\n\tstruct local_info *local = link->priv;\n\n\tatmel_open(local->eth_dev);\n\tnetif_device_attach(local->eth_dev);\n\n\treturn 0;\n}\n\n \n \n\n#define PCMCIA_DEVICE_MANF_CARD_INFO(manf, card, info) { \\\n\t.match_flags = PCMCIA_DEV_ID_MATCH_MANF_ID| \\\n\t\t\tPCMCIA_DEV_ID_MATCH_CARD_ID, \\\n\t.manf_id = (manf), \\\n\t.card_id = (card), \\\n        .driver_info = (kernel_ulong_t)(info), }\n\n#define PCMCIA_DEVICE_PROD_ID12_INFO(v1, v2, vh1, vh2, info) { \\\n\t.match_flags = PCMCIA_DEV_ID_MATCH_PROD_ID1| \\\n\t\t\tPCMCIA_DEV_ID_MATCH_PROD_ID2, \\\n\t.prod_id = { (v1), (v2), NULL, NULL }, \\\n\t.prod_id_hash = { (vh1), (vh2), 0, 0 }, \\\n        .driver_info = (kernel_ulong_t)(info), }\n\nstatic const struct pcmcia_device_id atmel_ids[] = {\n\tPCMCIA_DEVICE_MANF_CARD_INFO(0x0101, 0x0620, ATMEL_FW_TYPE_502_3COM),\n\tPCMCIA_DEVICE_MANF_CARD_INFO(0x0101, 0x0696, ATMEL_FW_TYPE_502_3COM),\n\tPCMCIA_DEVICE_MANF_CARD_INFO(0x01bf, 0x3302, ATMEL_FW_TYPE_502E),\n\tPCMCIA_DEVICE_MANF_CARD_INFO(0xd601, 0x0007, ATMEL_FW_TYPE_502),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"11WAVE\", \"11WP611AL-E\", 0x9eb2da1f, 0xc9a0d3f9, ATMEL_FW_TYPE_502E),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"ATMEL\", \"AT76C502AR\", 0xabda4164, 0x41b37e1f, ATMEL_FW_TYPE_502),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"ATMEL\", \"AT76C502AR_D\", 0xabda4164, 0x3675d704, ATMEL_FW_TYPE_502D),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"ATMEL\", \"AT76C502AR_E\", 0xabda4164, 0x4172e792, ATMEL_FW_TYPE_502E),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"ATMEL\", \"AT76C504_R\", 0xabda4164, 0x917f3d72, ATMEL_FW_TYPE_504_2958),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"ATMEL\", \"AT76C504\", 0xabda4164, 0x5040670a, ATMEL_FW_TYPE_504),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"ATMEL\", \"AT76C504A\", 0xabda4164, 0xe15ed87f, ATMEL_FW_TYPE_504A_2958),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"BT\", \"Voyager 1020 Laptop Adapter\", 0xae49b86a, 0x1e957cd5, ATMEL_FW_TYPE_502),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"CNet\", \"CNWLC 11Mbps Wireless PC Card V-5\", 0xbc477dde, 0x502fae6b, ATMEL_FW_TYPE_502E),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"IEEE 802.11b\", \"Wireless LAN PC Card\", 0x5b878724, 0x122f1df6, ATMEL_FW_TYPE_502),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"IEEE 802.11b\", \"Wireless LAN Card S\", 0x5b878724, 0x5fba533a, ATMEL_FW_TYPE_504_2958),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"OEM\", \"11Mbps Wireless LAN PC Card V-3\", 0xfea54c90, 0x1c5b0f68, ATMEL_FW_TYPE_502),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"SMC\", \"2632W\", 0xc4f8b18b, 0x30f38774, ATMEL_FW_TYPE_502D),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"SMC\", \"2632W-V2\", 0xc4f8b18b, 0x172d1377, ATMEL_FW_TYPE_502),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"Wireless\", \"PC_CARD\", 0xa407ecdd, 0x119f6314, ATMEL_FW_TYPE_502D),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"WLAN\", \"802.11b PC CARD\", 0x575c516c, 0xb1f6dbc4, ATMEL_FW_TYPE_502D),\n\tPCMCIA_DEVICE_PROD_ID12_INFO(\"LG\", \"LW2100N\", 0xb474d43a, 0x6b1fec94, ATMEL_FW_TYPE_502E),\n\tPCMCIA_DEVICE_NULL\n};\n\nMODULE_DEVICE_TABLE(pcmcia, atmel_ids);\n\nstatic struct pcmcia_driver atmel_driver = {\n\t.owner\t\t= THIS_MODULE,\n\t.name\t\t= \"atmel_cs\",\n\t.probe          = atmel_probe,\n\t.remove\t\t= atmel_detach,\n\t.id_table\t= atmel_ids,\n\t.suspend\t= atmel_suspend,\n\t.resume\t\t= atmel_resume,\n};\nmodule_pcmcia_driver(atmel_driver);\n\n \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}