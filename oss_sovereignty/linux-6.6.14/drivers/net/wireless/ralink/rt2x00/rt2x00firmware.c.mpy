{
  "module_name": "rt2x00firmware.c",
  "hash_id": "52ce0b6d428a6b5593a643e5c3c669219b916b2c7a040b3fdd0dc0e818c734bc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/ralink/rt2x00/rt2x00firmware.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n\n#include \"rt2x00.h\"\n#include \"rt2x00lib.h\"\n\nstatic int rt2x00lib_request_firmware(struct rt2x00_dev *rt2x00dev)\n{\n\tstruct device *device = wiphy_dev(rt2x00dev->hw->wiphy);\n\tconst struct firmware *fw;\n\tchar *fw_name;\n\tint retval;\n\n\t \n\tfw_name = rt2x00dev->ops->lib->get_firmware_name(rt2x00dev);\n\tif (!fw_name) {\n\t\trt2x00_err(rt2x00dev,\n\t\t\t   \"Invalid firmware filename\\n\"\n\t\t\t   \"Please file bug report to %s\\n\", DRV_PROJECT);\n\t\treturn -EINVAL;\n\t}\n\n\trt2x00_info(rt2x00dev, \"Loading firmware file '%s'\\n\", fw_name);\n\n\tretval = request_firmware(&fw, fw_name, device);\n\tif (retval) {\n\t\trt2x00_err(rt2x00dev, \"Failed to request Firmware\\n\");\n\t\treturn retval;\n\t}\n\n\tif (!fw || !fw->size || !fw->data) {\n\t\trt2x00_err(rt2x00dev, \"Failed to read Firmware\\n\");\n\t\trelease_firmware(fw);\n\t\treturn -ENOENT;\n\t}\n\n\trt2x00_info(rt2x00dev, \"Firmware detected - version: %d.%d\\n\",\n\t\t    fw->data[fw->size - 4], fw->data[fw->size - 3]);\n\tsnprintf(rt2x00dev->hw->wiphy->fw_version,\n\t\t\tsizeof(rt2x00dev->hw->wiphy->fw_version), \"%d.%d\",\n\t\t\tfw->data[fw->size - 4], fw->data[fw->size - 3]);\n\n\tretval = rt2x00dev->ops->lib->check_firmware(rt2x00dev, fw->data, fw->size);\n\tswitch (retval) {\n\tcase FW_OK:\n\t\tbreak;\n\tcase FW_BAD_CRC:\n\t\trt2x00_err(rt2x00dev, \"Firmware checksum error\\n\");\n\t\tgoto exit;\n\tcase FW_BAD_LENGTH:\n\t\trt2x00_err(rt2x00dev, \"Invalid firmware file length (len=%zu)\\n\",\n\t\t\t   fw->size);\n\t\tgoto exit;\n\tcase FW_BAD_VERSION:\n\t\trt2x00_err(rt2x00dev, \"Current firmware does not support detected chipset\\n\");\n\t\tgoto exit;\n\t}\n\n\trt2x00dev->fw = fw;\n\n\treturn 0;\n\nexit:\n\trelease_firmware(fw);\n\n\treturn -ENOENT;\n}\n\nint rt2x00lib_load_firmware(struct rt2x00_dev *rt2x00dev)\n{\n\tint retval;\n\n\tif (!rt2x00_has_cap_flag(rt2x00dev, REQUIRE_FIRMWARE))\n\t\treturn 0;\n\n\tif (!rt2x00dev->fw) {\n\t\tretval = rt2x00lib_request_firmware(rt2x00dev);\n\t\tif (retval)\n\t\t\treturn retval;\n\t}\n\n\t \n\tretval = rt2x00dev->ops->lib->load_firmware(rt2x00dev,\n\t\t\t\t\t\t    rt2x00dev->fw->data,\n\t\t\t\t\t\t    rt2x00dev->fw->size);\n\n\t \n\trt2x00leds_led_assoc(rt2x00dev, false);\n\n\treturn retval;\n}\n\nvoid rt2x00lib_free_firmware(struct rt2x00_dev *rt2x00dev)\n{\n\trelease_firmware(rt2x00dev->fw);\n\trt2x00dev->fw = NULL;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}