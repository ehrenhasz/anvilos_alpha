{
  "module_name": "pcie.h",
  "hash_id": "82d09b690a68472692b5ba9371064bb0f2308281281925b98ada0d4e6e8493d2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/marvell/mwifiex/pcie.h",
  "human_readable_source": " \n \n\n#ifndef\t_MWIFIEX_PCIE_H\n#define\t_MWIFIEX_PCIE_H\n\n#include    <linux/completion.h>\n#include    <linux/pci.h>\n#include    <linux/interrupt.h>\n\n#include    \"decl.h\"\n#include    \"main.h\"\n\n#define PCIE8766_DEFAULT_FW_NAME \"mrvl/pcie8766_uapsta.bin\"\n#define PCIE8897_DEFAULT_FW_NAME \"mrvl/pcie8897_uapsta.bin\"\n#define PCIE8897_A0_FW_NAME \"mrvl/pcie8897_uapsta_a0.bin\"\n#define PCIE8897_B0_FW_NAME \"mrvl/pcie8897_uapsta.bin\"\n#define PCIEUART8997_FW_NAME_V4 \"mrvl/pcieuart8997_combo_v4.bin\"\n#define PCIEUSB8997_FW_NAME_V4 \"mrvl/pcieusb8997_combo_v4.bin\"\n\n#define PCIE_VENDOR_ID_MARVELL              (0x11ab)\n#define PCIE_VENDOR_ID_V2_MARVELL           (0x1b4b)\n#define PCIE_DEVICE_ID_MARVELL_88W8766P\t\t(0x2b30)\n#define PCIE_DEVICE_ID_MARVELL_88W8897\t\t(0x2b38)\n#define PCIE_DEVICE_ID_MARVELL_88W8997\t\t(0x2b42)\n\n#define PCIE8897_A0\t0x1100\n#define PCIE8897_B0\t0x1200\n#define PCIE8997_A0\t0x10\n#define PCIE8997_A1\t0x11\n#define CHIP_VER_PCIEUART\t0x3\n#define CHIP_MAGIC_VALUE\t0x24\n\n \n#define MWIFIEX_MAX_TXRX_BD\t\t\t0x20\n#define MWIFIEX_TXBD_MASK\t\t\t0x3F\n#define MWIFIEX_RXBD_MASK\t\t\t0x3F\n\n#define MWIFIEX_MAX_EVT_BD\t\t\t0x08\n#define MWIFIEX_EVTBD_MASK\t\t\t0x0f\n\n \n#define PCIE_SCRATCH_0_REG\t\t\t\t0xC10\n#define PCIE_SCRATCH_1_REG\t\t\t\t0xC14\n#define PCIE_CPU_INT_EVENT\t\t\t\t0xC18\n#define PCIE_CPU_INT_STATUS\t\t\t\t0xC1C\n#define PCIE_HOST_INT_STATUS\t\t\t\t0xC30\n#define PCIE_HOST_INT_MASK\t\t\t\t0xC34\n#define PCIE_HOST_INT_STATUS_MASK\t\t\t0xC3C\n#define PCIE_SCRATCH_2_REG\t\t\t\t0xC40\n#define PCIE_SCRATCH_3_REG\t\t\t\t0xC44\n#define PCIE_SCRATCH_4_REG\t\t\t\t0xCD0\n#define PCIE_SCRATCH_5_REG\t\t\t\t0xCD4\n#define PCIE_SCRATCH_6_REG\t\t\t\t0xCD8\n#define PCIE_SCRATCH_7_REG\t\t\t\t0xCDC\n#define PCIE_SCRATCH_8_REG\t\t\t\t0xCE0\n#define PCIE_SCRATCH_9_REG\t\t\t\t0xCE4\n#define PCIE_SCRATCH_10_REG\t\t\t\t0xCE8\n#define PCIE_SCRATCH_11_REG\t\t\t\t0xCEC\n#define PCIE_SCRATCH_12_REG\t\t\t\t0xCF0\n#define PCIE_SCRATCH_13_REG\t\t\t\t0xCF4\n#define PCIE_SCRATCH_14_REG\t\t\t\t0xCF8\n#define PCIE_SCRATCH_15_REG\t\t\t\t0xCFC\n#define PCIE_RD_DATA_PTR_Q0_Q1                          0xC08C\n#define PCIE_WR_DATA_PTR_Q0_Q1                          0xC05C\n\n#define CPU_INTR_DNLD_RDY\t\t\t\tBIT(0)\n#define CPU_INTR_DOOR_BELL\t\t\t\tBIT(1)\n#define CPU_INTR_SLEEP_CFM_DONE\t\t\tBIT(2)\n#define CPU_INTR_RESET\t\t\t\t\tBIT(3)\n#define CPU_INTR_EVENT_DONE\t\t\t\tBIT(5)\n\n#define HOST_INTR_DNLD_DONE\t\t\t\tBIT(0)\n#define HOST_INTR_UPLD_RDY\t\t\t\tBIT(1)\n#define HOST_INTR_CMD_DONE\t\t\t\tBIT(2)\n#define HOST_INTR_EVENT_RDY\t\t\t\tBIT(3)\n#define HOST_INTR_MASK\t\t\t\t\t(HOST_INTR_DNLD_DONE | \\\n\t\t\t\t\t\t\t HOST_INTR_UPLD_RDY  | \\\n\t\t\t\t\t\t\t HOST_INTR_CMD_DONE  | \\\n\t\t\t\t\t\t\t HOST_INTR_EVENT_RDY)\n\n#define MWIFIEX_BD_FLAG_ROLLOVER_IND\t\t\tBIT(7)\n#define MWIFIEX_BD_FLAG_FIRST_DESC\t\t\tBIT(0)\n#define MWIFIEX_BD_FLAG_LAST_DESC\t\t\tBIT(1)\n#define MWIFIEX_BD_FLAG_SOP\t\t\t\tBIT(0)\n#define MWIFIEX_BD_FLAG_EOP\t\t\t\tBIT(1)\n#define MWIFIEX_BD_FLAG_XS_SOP\t\t\t\tBIT(2)\n#define MWIFIEX_BD_FLAG_XS_EOP\t\t\t\tBIT(3)\n#define MWIFIEX_BD_FLAG_EVT_ROLLOVER_IND\t\tBIT(7)\n#define MWIFIEX_BD_FLAG_RX_ROLLOVER_IND\t\t\tBIT(10)\n#define MWIFIEX_BD_FLAG_TX_START_PTR\t\t\tBIT(16)\n#define MWIFIEX_BD_FLAG_TX_ROLLOVER_IND\t\t\tBIT(26)\n\n \n#define MAX_WRITE_IOMEM_RETRY\t\t\t\t2\n \n#define MWIFIEX_PCIE_BLOCK_SIZE_FW_DNLD\t\t256\n \n#define FW_AWAKE_COOKIE\t\t\t\t\t\t(0xAA55AA55)\n#define MWIFIEX_DEF_SLEEP_COOKIE\t\t\t0xBEEFBEEF\n#define MWIFIEX_SLEEP_COOKIE_SIZE\t\t\t4\n#define MWIFIEX_MAX_DELAY_COUNT\t\t\t\t100\n\n#define MWIFIEX_PCIE_FLR_HAPPENS 0xFEDCBABA\n\nstruct mwifiex_pcie_card_reg {\n\tu16 cmd_addr_lo;\n\tu16 cmd_addr_hi;\n\tu16 fw_status;\n\tu16 cmd_size;\n\tu16 cmdrsp_addr_lo;\n\tu16 cmdrsp_addr_hi;\n\tu16 tx_rdptr;\n\tu16 tx_wrptr;\n\tu16 rx_rdptr;\n\tu16 rx_wrptr;\n\tu16 evt_rdptr;\n\tu16 evt_wrptr;\n\tu16 drv_rdy;\n\tu16 tx_start_ptr;\n\tu32 tx_mask;\n\tu32 tx_wrap_mask;\n\tu32 rx_mask;\n\tu32 rx_wrap_mask;\n\tu32 tx_rollover_ind;\n\tu32 rx_rollover_ind;\n\tu32 evt_rollover_ind;\n\tu8 ring_flag_sop;\n\tu8 ring_flag_eop;\n\tu8 ring_flag_xs_sop;\n\tu8 ring_flag_xs_eop;\n\tu32 ring_tx_start_ptr;\n\tu8 pfu_enabled;\n\tu8 sleep_cookie;\n\tu16 fw_dump_ctrl;\n\tu16 fw_dump_start;\n\tu16 fw_dump_end;\n\tu8 fw_dump_host_ready;\n\tu8 fw_dump_read_done;\n\tu8 msix_support;\n};\n\nstruct mwifiex_pcie_device {\n\tconst struct mwifiex_pcie_card_reg *reg;\n\tu16 blksz_fw_dl;\n\tu16 tx_buf_size;\n\tbool can_dump_fw;\n\tstruct memory_type_mapping *mem_type_mapping_tbl;\n\tu8 num_mem_types;\n\tbool can_ext_scan;\n};\n\nstruct mwifiex_evt_buf_desc {\n\tu64 paddr;\n\tu16 len;\n\tu16 flags;\n} __packed;\n\nstruct mwifiex_pcie_buf_desc {\n\tu64 paddr;\n\tu16 len;\n\tu16 flags;\n} __packed;\n\nstruct mwifiex_pfu_buf_desc {\n\tu16 flags;\n\tu16 offset;\n\tu16 frag_len;\n\tu16 len;\n\tu64 paddr;\n\tu32 reserved;\n} __packed;\n\n#define MWIFIEX_NUM_MSIX_VECTORS   4\n\nstruct mwifiex_msix_context {\n\tstruct pci_dev *dev;\n\tu16 msg_id;\n};\n\nstruct pcie_service_card {\n\tstruct pci_dev *dev;\n\tstruct mwifiex_adapter *adapter;\n\tstruct mwifiex_pcie_device pcie;\n\tstruct completion fw_done;\n\n\tu8 txbd_flush;\n\tu32 txbd_wrptr;\n\tu32 txbd_rdptr;\n\tu32 txbd_ring_size;\n\tu8 *txbd_ring_vbase;\n\tdma_addr_t txbd_ring_pbase;\n\tvoid *txbd_ring[MWIFIEX_MAX_TXRX_BD];\n\tstruct sk_buff *tx_buf_list[MWIFIEX_MAX_TXRX_BD];\n\n\tu32 rxbd_wrptr;\n\tu32 rxbd_rdptr;\n\tu32 rxbd_ring_size;\n\tu8 *rxbd_ring_vbase;\n\tdma_addr_t rxbd_ring_pbase;\n\tvoid *rxbd_ring[MWIFIEX_MAX_TXRX_BD];\n\tstruct sk_buff *rx_buf_list[MWIFIEX_MAX_TXRX_BD];\n\n\tu32 evtbd_wrptr;\n\tu32 evtbd_rdptr;\n\tu32 evtbd_ring_size;\n\tu8 *evtbd_ring_vbase;\n\tdma_addr_t evtbd_ring_pbase;\n\tvoid *evtbd_ring[MWIFIEX_MAX_EVT_BD];\n\tstruct sk_buff *evt_buf_list[MWIFIEX_MAX_EVT_BD];\n\n\tstruct sk_buff *cmd_buf;\n\tstruct sk_buff *cmdrsp_buf;\n\tu8 *sleep_cookie_vbase;\n\tdma_addr_t sleep_cookie_pbase;\n\tvoid __iomem *pci_mmap;\n\tvoid __iomem *pci_mmap1;\n\tint msi_enable;\n\tint msix_enable;\n#ifdef CONFIG_PCI\n\tstruct msix_entry msix_entries[MWIFIEX_NUM_MSIX_VECTORS];\n#endif\n\tstruct mwifiex_msix_context msix_ctx[MWIFIEX_NUM_MSIX_VECTORS];\n\tstruct mwifiex_msix_context share_irq_ctx;\n\tstruct work_struct work;\n\tunsigned long work_flags;\n\n\tbool pci_reset_ongoing;\n\tunsigned long quirks;\n};\n\nstatic inline int\nmwifiex_pcie_txbd_empty(struct pcie_service_card *card, u32 rdptr)\n{\n\tconst struct mwifiex_pcie_card_reg *reg = card->pcie.reg;\n\n\tswitch (card->dev->device) {\n\tcase PCIE_DEVICE_ID_MARVELL_88W8766P:\n\t\tif (((card->txbd_wrptr & reg->tx_mask) ==\n\t\t     (rdptr & reg->tx_mask)) &&\n\t\t    ((card->txbd_wrptr & reg->tx_rollover_ind) !=\n\t\t     (rdptr & reg->tx_rollover_ind)))\n\t\t\treturn 1;\n\t\tbreak;\n\tcase PCIE_DEVICE_ID_MARVELL_88W8897:\n\tcase PCIE_DEVICE_ID_MARVELL_88W8997:\n\t\tif (((card->txbd_wrptr & reg->tx_mask) ==\n\t\t     (rdptr & reg->tx_mask)) &&\n\t\t    ((card->txbd_wrptr & reg->tx_rollover_ind) ==\n\t\t\t(rdptr & reg->tx_rollover_ind)))\n\t\t\treturn 1;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic inline int\nmwifiex_pcie_txbd_not_full(struct pcie_service_card *card)\n{\n\tconst struct mwifiex_pcie_card_reg *reg = card->pcie.reg;\n\n\tswitch (card->dev->device) {\n\tcase PCIE_DEVICE_ID_MARVELL_88W8766P:\n\t\tif (((card->txbd_wrptr & reg->tx_mask) !=\n\t\t     (card->txbd_rdptr & reg->tx_mask)) ||\n\t\t    ((card->txbd_wrptr & reg->tx_rollover_ind) !=\n\t\t     (card->txbd_rdptr & reg->tx_rollover_ind)))\n\t\t\treturn 1;\n\t\tbreak;\n\tcase PCIE_DEVICE_ID_MARVELL_88W8897:\n\tcase PCIE_DEVICE_ID_MARVELL_88W8997:\n\t\tif (((card->txbd_wrptr & reg->tx_mask) !=\n\t\t     (card->txbd_rdptr & reg->tx_mask)) ||\n\t\t    ((card->txbd_wrptr & reg->tx_rollover_ind) ==\n\t\t     (card->txbd_rdptr & reg->tx_rollover_ind)))\n\t\t\treturn 1;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}