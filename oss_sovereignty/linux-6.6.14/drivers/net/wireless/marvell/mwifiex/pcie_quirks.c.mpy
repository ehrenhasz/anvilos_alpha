{
  "module_name": "pcie_quirks.c",
  "hash_id": "ff9a8959af642623f620ed3dd1f46832491787056b442f04a5ff8a54fd127be4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/marvell/mwifiex/pcie_quirks.c",
  "human_readable_source": "\n\n\n#include <linux/dmi.h>\n\n#include \"pcie_quirks.h\"\n\n \nstatic const struct dmi_system_id mwifiex_quirk_table[] = {\n\t{\n\t\t.ident = \"Surface Pro 4\",\n\t\t.matches = {\n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_NAME, \"Surface Pro 4\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{\n\t\t.ident = \"Surface Pro 5\",\n\t\t.matches = {\n\t\t\t \n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_SKU, \"Surface_Pro_1796\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{\n\t\t.ident = \"Surface Pro 5 (LTE)\",\n\t\t.matches = {\n\t\t\t \n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_SKU, \"Surface_Pro_1807\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{\n\t\t.ident = \"Surface Pro 6\",\n\t\t.matches = {\n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_NAME, \"Surface Pro 6\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{\n\t\t.ident = \"Surface Book 1\",\n\t\t.matches = {\n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_NAME, \"Surface Book\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{\n\t\t.ident = \"Surface Book 2\",\n\t\t.matches = {\n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_NAME, \"Surface Book 2\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{\n\t\t.ident = \"Surface Laptop 1\",\n\t\t.matches = {\n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_NAME, \"Surface Laptop\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{\n\t\t.ident = \"Surface Laptop 2\",\n\t\t.matches = {\n\t\t\tDMI_EXACT_MATCH(DMI_SYS_VENDOR, \"Microsoft Corporation\"),\n\t\t\tDMI_EXACT_MATCH(DMI_PRODUCT_NAME, \"Surface Laptop 2\"),\n\t\t},\n\t\t.driver_data = (void *)QUIRK_FW_RST_D3COLD,\n\t},\n\t{}\n};\n\nvoid mwifiex_initialize_quirks(struct pcie_service_card *card)\n{\n\tstruct pci_dev *pdev = card->dev;\n\tconst struct dmi_system_id *dmi_id;\n\n\tdmi_id = dmi_first_match(mwifiex_quirk_table);\n\tif (dmi_id)\n\t\tcard->quirks = (uintptr_t)dmi_id->driver_data;\n\n\tif (!card->quirks)\n\t\tdev_info(&pdev->dev, \"no quirks enabled\\n\");\n\tif (card->quirks & QUIRK_FW_RST_D3COLD)\n\t\tdev_info(&pdev->dev, \"quirk reset_d3cold enabled\\n\");\n}\n\nstatic void mwifiex_pcie_set_power_d3cold(struct pci_dev *pdev)\n{\n\tdev_info(&pdev->dev, \"putting into D3cold...\\n\");\n\n\tpci_save_state(pdev);\n\tif (pci_is_enabled(pdev))\n\t\tpci_disable_device(pdev);\n\tpci_set_power_state(pdev, PCI_D3cold);\n}\n\nstatic int mwifiex_pcie_set_power_d0(struct pci_dev *pdev)\n{\n\tint ret;\n\n\tdev_info(&pdev->dev, \"putting into D0...\\n\");\n\n\tpci_set_power_state(pdev, PCI_D0);\n\tret = pci_enable_device(pdev);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"pci_enable_device failed\\n\");\n\t\treturn ret;\n\t}\n\tpci_restore_state(pdev);\n\n\treturn 0;\n}\n\nint mwifiex_pcie_reset_d3cold_quirk(struct pci_dev *pdev)\n{\n\tstruct pci_dev *parent_pdev = pci_upstream_bridge(pdev);\n\tint ret;\n\n\t \n\tdev_info(&pdev->dev, \"Using reset_d3cold quirk to perform FW reset\\n\");\n\n\t \n\tmwifiex_pcie_set_power_d3cold(pdev);\n\tmwifiex_pcie_set_power_d3cold(parent_pdev);\n\n\tret = mwifiex_pcie_set_power_d0(parent_pdev);\n\tif (ret)\n\t\treturn ret;\n\tret = mwifiex_pcie_set_power_d0(pdev);\n\tif (ret)\n\t\treturn ret;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}