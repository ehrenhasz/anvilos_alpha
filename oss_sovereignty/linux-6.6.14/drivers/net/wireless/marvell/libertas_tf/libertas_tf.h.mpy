{
  "module_name": "libertas_tf.h",
  "hash_id": "5c67116151de471cd829f534b3f8c7a3c0fe6017bf2c5497b51f9dc194fbf3e3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/marvell/libertas_tf/libertas_tf.h",
  "human_readable_source": " \n \n#include <linux/spinlock.h>\n#include <linux/device.h>\n#include <linux/kthread.h>\n#include <net/mac80211.h>\n\n#include \"deb_defs.h\"\n\n#ifndef DRV_NAME\n#define DRV_NAME \"libertas_tf\"\n#endif\n\n#define\tMRVL_DEFAULT_RETRIES\t\t\t9\n#define MRVL_PER_PACKET_RATE\t\t\t0x10\n#define MRVL_MAX_BCN_SIZE\t\t\t440\n#define CMD_OPTION_WAITFORRSP\t\t\t0x0002\n\n \n#define CMD_RET(cmd)\t\t\t(0x8000 | cmd)\n\n \n#define CMD_GET_HW_SPEC\t\t\t\t0x0003\n#define CMD_802_11_RESET\t\t\t0x0005\n#define CMD_MAC_MULTICAST_ADR\t\t\t0x0010\n#define CMD_802_11_RADIO_CONTROL\t\t0x001c\n#define CMD_802_11_RF_CHANNEL\t\t\t0x001d\n#define CMD_802_11_RF_TX_POWER\t\t\t0x001e\n#define CMD_MAC_CONTROL\t\t\t\t0x0028\n#define CMD_802_11_MAC_ADDRESS\t\t\t0x004d\n#define\tCMD_SET_BOOT2_VER\t\t\t0x00a5\n#define CMD_802_11_BEACON_CTRL\t\t\t0x00b0\n#define CMD_802_11_BEACON_SET\t\t\t0x00cb\n#define CMD_802_11_SET_MODE\t\t\t0x00cc\n#define CMD_802_11_SET_BSSID\t\t\t0x00cd\n\n#define CMD_ACT_GET\t\t\t0x0000\n#define CMD_ACT_SET\t\t\t0x0001\n\n \n#define CMD_ACT_HALT\t\t\t0x0003\n\n \n#define CMD_ACT_MAC_RX_ON\t\t\t0x0001\n#define CMD_ACT_MAC_TX_ON\t\t\t0x0002\n#define CMD_ACT_MAC_MULTICAST_ENABLE\t\t0x0020\n#define CMD_ACT_MAC_BROADCAST_ENABLE\t\t0x0040\n#define CMD_ACT_MAC_PROMISCUOUS_ENABLE\t\t0x0080\n#define CMD_ACT_MAC_ALL_MULTICAST_ENABLE\t0x0100\n\n \n#define CMD_TYPE_AUTO_PREAMBLE\t\t0x0001\n#define CMD_TYPE_SHORT_PREAMBLE\t\t0x0002\n#define CMD_TYPE_LONG_PREAMBLE\t\t0x0003\n\n#define TURN_ON_RF\t\t\t0x01\n#define RADIO_ON\t\t\t0x01\n#define RADIO_OFF\t\t\t0x00\n\n#define SET_AUTO_PREAMBLE\t\t0x05\n#define SET_SHORT_PREAMBLE\t\t0x03\n#define SET_LONG_PREAMBLE\t\t0x01\n\n \n#define CMD_OPT_802_11_RF_CHANNEL_GET\t0x00\n#define CMD_OPT_802_11_RF_CHANNEL_SET\t0x01\n\n \nenum lbtf_mode {\n\tLBTF_PASSIVE_MODE,\n\tLBTF_STA_MODE,\n\tLBTF_AP_MODE,\n};\n\n \n#define MACREG_INT_CODE_FIRMWARE_READY\t\t48\n \n\n \n\n#define MRVDRV_MAX_MULTICAST_LIST_SIZE\t32\n#define LBS_NUM_CMD_BUFFERS             10\n#define LBS_CMD_BUFFER_SIZE             (2 * 1024)\n#define MRVDRV_MAX_CHANNEL_SIZE\t\t14\n#define MRVDRV_SNAP_HEADER_LEN          8\n\n#define\tLBS_UPLD_SIZE\t\t\t2312\n#define DEV_NAME_LEN\t\t\t32\n\n \n \n\n#define MRVDRV_MAX_REGION_CODE\t\t\t6\n \n#define LBTF_REGDOMAIN_US\t0x10\n#define LBTF_REGDOMAIN_CA\t0x20\n#define LBTF_REGDOMAIN_EU\t0x30\n#define LBTF_REGDOMAIN_SP\t0x31\n#define LBTF_REGDOMAIN_FR\t0x32\n#define LBTF_REGDOMAIN_JP\t0x40\n\n#define SBI_EVENT_CAUSE_SHIFT\t\t3\n\n \n\n#define MRVDRV_RXPD_STATUS_OK                0x0001\n\n\n \n#define EXTRA_LEN\t36\n\n#define MRVDRV_ETH_TX_PACKET_BUFFER_SIZE \\\n\t(ETH_FRAME_LEN + sizeof(struct txpd) + EXTRA_LEN)\n\n#define MRVDRV_ETH_RX_PACKET_BUFFER_SIZE \\\n\t(ETH_FRAME_LEN + sizeof(struct rxpd) \\\n\t + MRVDRV_SNAP_HEADER_LEN + EXTRA_LEN)\n\n#define\tCMD_F_HOSTCMD\t\t(1 << 0)\n#define FW_CAPINFO_WPA  \t(1 << 0)\n\n#define RF_ANTENNA_1\t\t0x1\n#define RF_ANTENNA_2\t\t0x2\n#define RF_ANTENNA_AUTO\t\t0xFFFF\n\n#define LBTF_EVENT_BCN_SENT\t55\n\n \n \nenum mv_ms_type {\n\tMVMS_DAT = 0,\n\tMVMS_CMD = 1,\n\tMVMS_TXDONE = 2,\n\tMVMS_EVENT\n};\n\nextern struct workqueue_struct *lbtf_wq;\n\nstruct lbtf_private;\n\nstruct lbtf_offset_value {\n\tu32 offset;\n\tu32 value;\n};\n\nstruct channel_range {\n\tu8 regdomain;\n\tu8 start;\n\tu8 end;  \n};\n\nstruct if_usb_card;\n\nstruct lbtf_ops {\n\t \n\tint (*hw_host_to_card)(struct lbtf_private *priv, u8 type,\n\t\t\t       u8 *payload, u16 nb);\n\tint (*hw_prog_firmware)(struct lbtf_private *priv);\n\tint (*hw_reset_device)(struct lbtf_private *priv);\n};\n\n \nstruct lbtf_private {\n\tvoid *card;\n\tstruct ieee80211_hw *hw;\n\tconst struct lbtf_ops *ops;\n\n\t \n\tu8 cmd_resp_buff[LBS_UPLD_SIZE];\n\t \n\tstruct ieee80211_vif *vif;\n\n\tstruct work_struct cmd_work;\n\tstruct work_struct tx_work;\n\n\t \n\t \n\tu32 fwrelease;\n\tu32 fwcapinfo;\n\t \n\n\tstruct mutex lock;\n\n\t \n\tu16 seqnum;\n\t \n\n\tstruct cmd_ctrl_node *cmd_array;\n\t \n\tstruct cmd_ctrl_node *cur_cmd;\n\t \n\t \n\tstruct list_head cmdfreeq;\n\t \n\tstruct list_head cmdpendingq;\n\n\t \n\tspinlock_t driver_lock;\n\n\t \n\tstruct timer_list command_timer;\n\tint nr_retries;\n\tint cmd_timed_out;\n\n\tu8 cmd_response_rxed;\n\n\t \n\tu16 capability;\n\n\t \n\tu8 current_addr[ETH_ALEN];\n\tu8 multicastlist[MRVDRV_MAX_MULTICAST_LIST_SIZE][ETH_ALEN];\n\tu32 nr_of_multicastmacaddr;\n\tint cur_freq;\n\n\tstruct sk_buff *skb_to_tx;\n\tstruct sk_buff *tx_skb;\n\n\t \n\tu16 mac_control;\n\tu16 regioncode;\n\tstruct channel_range range;\n\n\tu8 radioon;\n\tu32 preamble;\n\n\tstruct ieee80211_channel channels[14];\n\tstruct ieee80211_rate rates[12];\n\tstruct ieee80211_supported_band band;\n\tstruct lbtf_offset_value offsetvalue;\n\n\tu8 surpriseremoved;\n\tstruct sk_buff_head bc_ps_buf;\n\n\t \n\ts8 noise;\n};\n\n \n\n \nstruct txpd {\n\t \n\t__le32 tx_status;\n\t \n\t__le32 tx_control;\n\t__le32 tx_packet_location;\n\t \n\t__le16 tx_packet_length;\n\tstruct_group_attr(tx_dest_addr, __packed,\n\t\t \n\t\tu8 tx_dest_addr_high[2];\n\t\t \n\t\tu8 tx_dest_addr_low[4];\n\t);\n\t \n\tu8 priority;\n\t \n\tu8 powermgmt;\n\t \n\tu8 pktdelay_2ms;\n\t \n\tu8 reserved1;\n} __packed;\n\n \nstruct rxpd {\n\t \n\t__le16 status;\n\n\t \n\tu8 snr;\n\n\t \n\tu8 rx_control;\n\n\t \n\t__le16 pkt_len;\n\n\t \n\tu8 nf;\n\n\t \n\tu8 rx_rate;\n\n\t \n\t__le32 pkt_ptr;\n\n\t \n\t__le32 next_rxpd_ptr;\n\n\t \n\tu8 priority;\n\tu8 reserved[3];\n} __packed;\n\nstruct cmd_header {\n\t__le16 command;\n\t__le16 size;\n\t__le16 seqnum;\n\t__le16 result;\n} __packed;\n\nstruct cmd_ctrl_node {\n\tstruct list_head list;\n\tint result;\n\t \n\tint (*callback)(struct lbtf_private *,\n\t\t\tunsigned long, struct cmd_header *);\n\tunsigned long callback_arg;\n\t \n\tstruct cmd_header *cmdbuf;\n\t \n\tu16 cmdwaitqwoken;\n\twait_queue_head_t cmdwait_q;\n};\n\n \nstruct cmd_ds_get_hw_spec {\n\tstruct cmd_header hdr;\n\n\t \n\t__le16 hwifversion;\n\t \n\t__le16 version;\n\t \n\t__le16 nr_txpd;\n\t \n\t__le16 nr_mcast_adr;\n\t \n\tu8 permanentaddr[6];\n\n\t \n\t__le16 regioncode;\n\n\t \n\t__le16 nr_antenna;\n\n\t \n\t__le32 fwrelease;\n\n\t \n\t__le32 wcb_base;\n\t \n\t__le32 rxpd_rdptr;\n\n\t \n\t__le32 rxpd_wrptr;\n\n\t \n\t__le32 fwcapinfo;\n} __packed;\n\nstruct cmd_ds_mac_control {\n\tstruct cmd_header hdr;\n\t__le16 action;\n\tu16 reserved;\n} __packed;\n\nstruct cmd_ds_802_11_mac_address {\n\tstruct cmd_header hdr;\n\n\t__le16 action;\n\tuint8_t macadd[ETH_ALEN];\n} __packed;\n\nstruct cmd_ds_mac_multicast_addr {\n\tstruct cmd_header hdr;\n\n\t__le16 action;\n\t__le16 nr_of_adrs;\n\tu8 maclist[ETH_ALEN * MRVDRV_MAX_MULTICAST_LIST_SIZE];\n} __packed;\n\nstruct cmd_ds_set_mode {\n\tstruct cmd_header hdr;\n\n\t__le16 mode;\n} __packed;\n\nstruct cmd_ds_set_bssid {\n\tstruct cmd_header hdr;\n\n\tu8 bssid[6];\n\tu8 activate;\n} __packed;\n\nstruct cmd_ds_802_11_radio_control {\n\tstruct cmd_header hdr;\n\n\t__le16 action;\n\t__le16 control;\n} __packed;\n\n\nstruct cmd_ds_802_11_rf_channel {\n\tstruct cmd_header hdr;\n\n\t__le16 action;\n\t__le16 channel;\n\t__le16 rftype;       \n\t__le16 reserved;     \n\tu8 channellist[32];  \n} __packed;\n\nstruct cmd_ds_set_boot2_ver {\n\tstruct cmd_header hdr;\n\n\t__le16 action;\n\t__le16 version;\n} __packed;\n\nstruct cmd_ds_802_11_reset {\n\tstruct cmd_header hdr;\n\n\t__le16 action;\n} __packed;\n\nstruct cmd_ds_802_11_beacon_control {\n\tstruct cmd_header hdr;\n\n\t__le16 action;\n\t__le16 beacon_enable;\n\t__le16 beacon_period;\n} __packed;\n\nstruct cmd_ds_802_11_beacon_set {\n\tstruct cmd_header hdr;\n\n\t__le16 len;\n\tu8 beacon[MRVL_MAX_BCN_SIZE];\n} __packed;\n\nstruct cmd_ctrl_node;\n\n \nvoid lbtf_set_mac_control(struct lbtf_private *priv);\n\nint lbtf_free_cmd_buffer(struct lbtf_private *priv);\n\nint lbtf_allocate_cmd_buffer(struct lbtf_private *priv);\nint lbtf_execute_next_command(struct lbtf_private *priv);\nint lbtf_set_radio_control(struct lbtf_private *priv);\nint lbtf_update_hw_spec(struct lbtf_private *priv);\nint lbtf_cmd_set_mac_multicast_addr(struct lbtf_private *priv);\nvoid lbtf_set_mode(struct lbtf_private *priv, enum lbtf_mode mode);\nvoid lbtf_set_bssid(struct lbtf_private *priv, bool activate, const u8 *bssid);\nint lbtf_set_mac_address(struct lbtf_private *priv, uint8_t *mac_addr);\n\nint lbtf_set_channel(struct lbtf_private *priv, u8 channel);\n\nint lbtf_beacon_set(struct lbtf_private *priv, struct sk_buff *beacon);\nint lbtf_beacon_ctrl(struct lbtf_private *priv, bool beacon_enable,\n\t\t     int beacon_int);\n\n\nint lbtf_process_rx_command(struct lbtf_private *priv);\nvoid lbtf_complete_command(struct lbtf_private *priv, struct cmd_ctrl_node *cmd,\n\t\t\t  int result);\nvoid lbtf_cmd_response_rx(struct lbtf_private *priv);\n\n \nstruct chan_freq_power *lbtf_get_region_cfp_table(u8 region,\n\tint *cfp_no);\nstruct lbtf_private *lbtf_add_card(void *card, struct device *dmdev,\n\t\t\t\t   const struct lbtf_ops *ops);\nint lbtf_remove_card(struct lbtf_private *priv);\nint lbtf_start_card(struct lbtf_private *priv);\nint lbtf_rx(struct lbtf_private *priv, struct sk_buff *skb);\nvoid lbtf_send_tx_feedback(struct lbtf_private *priv, u8 retrycnt, u8 fail);\nvoid lbtf_bcn_sent(struct lbtf_private *priv);\n\n \n \n#define lbtf_cmd(priv, cmdnr, cmd, cb, cb_arg)\t({\t\t\\\n\tuint16_t __sz = le16_to_cpu((cmd)->hdr.size);\t\t\\\n\t(cmd)->hdr.size = cpu_to_le16(sizeof(*(cmd)));\t\t\\\n\t__lbtf_cmd(priv, cmdnr, &(cmd)->hdr, __sz, cb, cb_arg);\t\\\n})\n\n#define lbtf_cmd_with_response(priv, cmdnr, cmd)\t\\\n\tlbtf_cmd(priv, cmdnr, cmd, lbtf_cmd_copyback, (unsigned long) (cmd))\n\nvoid lbtf_cmd_async(struct lbtf_private *priv, uint16_t command,\n\tstruct cmd_header *in_cmd, int in_cmd_size);\n\nint __lbtf_cmd(struct lbtf_private *priv, uint16_t command,\n\t      struct cmd_header *in_cmd, int in_cmd_size,\n\t      int (*callback)(struct lbtf_private *, unsigned long,\n\t\t\t      struct cmd_header *),\n\t      unsigned long callback_arg);\n\nint lbtf_cmd_copyback(struct lbtf_private *priv, unsigned long extra,\n\t\t     struct cmd_header *resp);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}