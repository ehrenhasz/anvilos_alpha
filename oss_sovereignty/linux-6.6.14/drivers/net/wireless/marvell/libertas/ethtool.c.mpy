{
  "module_name": "ethtool.c",
  "hash_id": "417c3e66314f32f999e20fb225317f6025fa5edf8bf14a81b01041e142b5904f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/marvell/libertas/ethtool.c",
  "human_readable_source": "\n#include <linux/hardirq.h>\n#include <linux/netdevice.h>\n#include <linux/ethtool.h>\n#include <linux/delay.h>\n\n#include \"decl.h\"\n#include \"cmd.h\"\n#include \"mesh.h\"\n\n\nstatic void lbs_ethtool_get_drvinfo(struct net_device *dev,\n\t\t\t\t\t struct ethtool_drvinfo *info)\n{\n\tstruct lbs_private *priv = dev->ml_priv;\n\n\tsnprintf(info->fw_version, sizeof(info->fw_version),\n\t\t\"%u.%u.%u.p%u\",\n\t\tpriv->fwrelease >> 24 & 0xff,\n\t\tpriv->fwrelease >> 16 & 0xff,\n\t\tpriv->fwrelease >>  8 & 0xff,\n\t\tpriv->fwrelease       & 0xff);\n\tstrscpy(info->driver, \"libertas\", sizeof(info->driver));\n\tstrscpy(info->version, lbs_driver_version, sizeof(info->version));\n}\n\n \n#define LBS_EEPROM_LEN 16384\n\nstatic int lbs_ethtool_get_eeprom_len(struct net_device *dev)\n{\n\treturn LBS_EEPROM_LEN;\n}\n\nstatic int lbs_ethtool_get_eeprom(struct net_device *dev,\n                                  struct ethtool_eeprom *eeprom, u8 * bytes)\n{\n\tstruct lbs_private *priv = dev->ml_priv;\n\tstruct cmd_ds_802_11_eeprom_access cmd;\n\tint ret;\n\n\tif (eeprom->offset + eeprom->len > LBS_EEPROM_LEN ||\n\t    eeprom->len > LBS_EEPROM_READ_LEN)\n\t\treturn -EINVAL;\n\n\tcmd.hdr.size = cpu_to_le16(sizeof(struct cmd_ds_802_11_eeprom_access) -\n\t\tLBS_EEPROM_READ_LEN + eeprom->len);\n\tcmd.action = cpu_to_le16(CMD_ACT_GET);\n\tcmd.offset = cpu_to_le16(eeprom->offset);\n\tcmd.len    = cpu_to_le16(eeprom->len);\n\tret = lbs_cmd_with_response(priv, CMD_802_11_EEPROM_ACCESS, &cmd);\n\tif (!ret)\n\t\tmemcpy(bytes, cmd.value, eeprom->len);\n\n\treturn ret;\n}\n\nstatic void lbs_ethtool_get_wol(struct net_device *dev,\n\t\t\t\tstruct ethtool_wolinfo *wol)\n{\n\tstruct lbs_private *priv = dev->ml_priv;\n\n\twol->supported = WAKE_UCAST|WAKE_MCAST|WAKE_BCAST|WAKE_PHY;\n\n\tif (priv->wol_criteria == EHS_REMOVE_WAKEUP)\n\t\treturn;\n\n\tif (priv->wol_criteria & EHS_WAKE_ON_UNICAST_DATA)\n\t\twol->wolopts |= WAKE_UCAST;\n\tif (priv->wol_criteria & EHS_WAKE_ON_MULTICAST_DATA)\n\t\twol->wolopts |= WAKE_MCAST;\n\tif (priv->wol_criteria & EHS_WAKE_ON_BROADCAST_DATA)\n\t\twol->wolopts |= WAKE_BCAST;\n\tif (priv->wol_criteria & EHS_WAKE_ON_MAC_EVENT)\n\t\twol->wolopts |= WAKE_PHY;\n}\n\nstatic int lbs_ethtool_set_wol(struct net_device *dev,\n\t\t\t       struct ethtool_wolinfo *wol)\n{\n\tstruct lbs_private *priv = dev->ml_priv;\n\n\tif (wol->wolopts & ~(WAKE_UCAST|WAKE_MCAST|WAKE_BCAST|WAKE_PHY))\n\t\treturn -EOPNOTSUPP;\n\n\tpriv->wol_criteria = 0;\n\tif (wol->wolopts & WAKE_UCAST)\n\t\tpriv->wol_criteria |= EHS_WAKE_ON_UNICAST_DATA;\n\tif (wol->wolopts & WAKE_MCAST)\n\t\tpriv->wol_criteria |= EHS_WAKE_ON_MULTICAST_DATA;\n\tif (wol->wolopts & WAKE_BCAST)\n\t\tpriv->wol_criteria |= EHS_WAKE_ON_BROADCAST_DATA;\n\tif (wol->wolopts & WAKE_PHY)\n\t\tpriv->wol_criteria |= EHS_WAKE_ON_MAC_EVENT;\n\tif (wol->wolopts == 0)\n\t\tpriv->wol_criteria |= EHS_REMOVE_WAKEUP;\n\treturn 0;\n}\n\nconst struct ethtool_ops lbs_ethtool_ops = {\n\t.get_drvinfo = lbs_ethtool_get_drvinfo,\n\t.get_eeprom =  lbs_ethtool_get_eeprom,\n\t.get_eeprom_len = lbs_ethtool_get_eeprom_len,\n#ifdef CONFIG_LIBERTAS_MESH\n\t.get_sset_count = lbs_mesh_ethtool_get_sset_count,\n\t.get_ethtool_stats = lbs_mesh_ethtool_get_stats,\n\t.get_strings = lbs_mesh_ethtool_get_strings,\n#endif\n\t.get_wol = lbs_ethtool_get_wol,\n\t.set_wol = lbs_ethtool_set_wol,\n};\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}