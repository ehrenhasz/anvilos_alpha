{
  "module_name": "3945.h",
  "hash_id": "9b4c6ed858fef06baf3aeae6f77abfbee5b80ac0cd1a7687a51300a966b2c164",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/intel/iwlegacy/3945.h",
  "human_readable_source": " \n \n\n#ifndef __il_3945_h__\n#define __il_3945_h__\n\n#include <linux/pci.h>\t\t \n#include <linux/kernel.h>\n#include <net/ieee80211_radiotap.h>\n\n \nextern const struct pci_device_id il3945_hw_card_ids[];\n\n#include \"common.h\"\n\nextern const struct il_ops il3945_ops;\n\n \n#define IL3945_UCODE_API_MAX 2\n\n \n#define IL3945_UCODE_API_MIN 1\n\n#define IL3945_FW_PRE\t\"iwlwifi-3945-\"\n#define _IL3945_MODULE_FIRMWARE(api) IL3945_FW_PRE #api \".ucode\"\n#define IL3945_MODULE_FIRMWARE(api) _IL3945_MODULE_FIRMWARE(api)\n\n \n#define IL_NOISE_MEAS_NOT_AVAILABLE (-127)\n\n \nextern struct il_mod_params il3945_mod_params;\n\nstruct il3945_rate_scale_data {\n\tu64 data;\n\ts32 success_counter;\n\ts32 success_ratio;\n\ts32 counter;\n\ts32 average_tpt;\n\tunsigned long stamp;\n};\n\nstruct il3945_rs_sta {\n\tspinlock_t lock;\n\tstruct il_priv *il;\n\ts32 *expected_tpt;\n\tunsigned long last_partial_flush;\n\tunsigned long last_flush;\n\tu32 flush_time;\n\tu32 last_tx_packets;\n\tu32 tx_packets;\n\tu8 tgg;\n\tu8 flush_pending;\n\tu8 start_rate;\n\tstruct timer_list rate_scale_flush;\n\tstruct il3945_rate_scale_data win[RATE_COUNT_3945];\n\n\t \n\tint last_txrate_idx;\n};\n\n \nstruct il3945_sta_priv {\n\tstruct il_station_priv_common common;\n\tstruct il3945_rs_sta rs_sta;\n};\n\nenum il3945_antenna {\n\tIL_ANTENNA_DIVERSITY,\n\tIL_ANTENNA_MAIN,\n\tIL_ANTENNA_AUX\n};\n\n \n#define DEFAULT_RTS_THRESHOLD     2347U\n#define MIN_RTS_THRESHOLD         0U\n#define MAX_RTS_THRESHOLD         2347U\n#define MAX_MSDU_SIZE\t\t  2304U\n#define MAX_MPDU_SIZE\t\t  2346U\n#define DEFAULT_BEACON_INTERVAL   100U\n#define\tDEFAULT_SHORT_RETRY_LIMIT 7U\n#define\tDEFAULT_LONG_RETRY_LIMIT  4U\n\n#define IL_TX_FIFO_AC0\t0\n#define IL_TX_FIFO_AC1\t1\n#define IL_TX_FIFO_AC2\t2\n#define IL_TX_FIFO_AC3\t3\n#define IL_TX_FIFO_HCCA_1\t5\n#define IL_TX_FIFO_HCCA_2\t6\n#define IL_TX_FIFO_NONE\t7\n\n#define IEEE80211_DATA_LEN              2304\n#define IEEE80211_4ADDR_LEN             30\n#define IEEE80211_HLEN                  (IEEE80211_4ADDR_LEN)\n#define IEEE80211_FRAME_LEN             (IEEE80211_DATA_LEN + IEEE80211_HLEN)\n\nstruct il3945_frame {\n\tunion {\n\t\tstruct ieee80211_hdr frame;\n\t\tstruct il3945_tx_beacon_cmd beacon;\n\t\tu8 raw[IEEE80211_FRAME_LEN];\n\t\tu8 cmd[360];\n\t} u;\n\tstruct list_head list;\n};\n\n#define SUP_RATE_11A_MAX_NUM_CHANNELS  8\n#define SUP_RATE_11B_MAX_NUM_CHANNELS  4\n#define SUP_RATE_11G_MAX_NUM_CHANNELS  12\n\n#define IL_SUPPORTED_RATES_IE_LEN         8\n\n#define SCAN_INTERVAL 100\n\n#define MAX_TID_COUNT        9\n\n#define IL_INVALID_RATE     0xFF\n#define IL_INVALID_VALUE    -1\n\n#define STA_PS_STATUS_WAKE             0\n#define STA_PS_STATUS_SLEEP            1\n\nstruct il3945_ibss_seq {\n\tu8 mac[ETH_ALEN];\n\tu16 seq_num;\n\tu16 frag_num;\n\tunsigned long packet_time;\n\tstruct list_head list;\n};\n\n#define IL_RX_HDR(x) ((struct il3945_rx_frame_hdr *)(\\\n\t\t       x->u.rx_frame.stats.payload + \\\n\t\t       x->u.rx_frame.stats.phy_count))\n#define IL_RX_END(x) ((struct il3945_rx_frame_end *)(\\\n\t\t       IL_RX_HDR(x)->payload + \\\n\t\t       le16_to_cpu(IL_RX_HDR(x)->len)))\n#define IL_RX_STATS(x) (&x->u.rx_frame.stats)\n#define IL_RX_DATA(x) (IL_RX_HDR(x)->payload)\n\n \nint il3945_calc_db_from_ratio(int sig_ratio);\nvoid il3945_rx_replenish(void *data);\nvoid il3945_rx_queue_reset(struct il_priv *il, struct il_rx_queue *rxq);\nunsigned int il3945_fill_beacon_frame(struct il_priv *il,\n\t\t\t\t      struct ieee80211_hdr *hdr, int left);\nint il3945_dump_nic_event_log(struct il_priv *il, bool full_log, char **buf,\n\t\t\t      bool display);\nvoid il3945_dump_nic_error_log(struct il_priv *il);\n\n \nvoid il3945_hw_handler_setup(struct il_priv *il);\nvoid il3945_hw_setup_deferred_work(struct il_priv *il);\nvoid il3945_hw_cancel_deferred_work(struct il_priv *il);\nint il3945_hw_rxq_stop(struct il_priv *il);\nint il3945_hw_set_hw_params(struct il_priv *il);\nint il3945_hw_nic_init(struct il_priv *il);\nint il3945_hw_nic_stop_master(struct il_priv *il);\nvoid il3945_hw_txq_ctx_free(struct il_priv *il);\nvoid il3945_hw_txq_ctx_stop(struct il_priv *il);\nint il3945_hw_nic_reset(struct il_priv *il);\nint il3945_hw_txq_attach_buf_to_tfd(struct il_priv *il, struct il_tx_queue *txq,\n\t\t\t\t    dma_addr_t addr, u16 len, u8 reset, u8 pad);\nvoid il3945_hw_txq_free_tfd(struct il_priv *il, struct il_tx_queue *txq);\nint il3945_hw_get_temperature(struct il_priv *il);\nint il3945_hw_tx_queue_init(struct il_priv *il, struct il_tx_queue *txq);\nunsigned int il3945_hw_get_beacon_cmd(struct il_priv *il,\n\t\t\t\t      struct il3945_frame *frame, u8 rate);\nvoid il3945_hw_build_tx_cmd_rate(struct il_priv *il, struct il_device_cmd *cmd,\n\t\t\t\t struct ieee80211_tx_info *info,\n\t\t\t\t struct ieee80211_hdr *hdr, int sta_id);\nint il3945_hw_reg_send_txpower(struct il_priv *il);\nint il3945_hw_reg_set_txpower(struct il_priv *il, s8 power);\nvoid il3945_hdl_stats(struct il_priv *il, struct il_rx_buf *rxb);\nvoid il3945_hdl_c_stats(struct il_priv *il, struct il_rx_buf *rxb);\nvoid il3945_disable_events(struct il_priv *il);\nint il4965_get_temperature(const struct il_priv *il);\nvoid il3945_post_associate(struct il_priv *il);\nvoid il3945_config_ap(struct il_priv *il);\n\nint il3945_commit_rxon(struct il_priv *il);\n\n \nu8 il3945_hw_find_station(struct il_priv *il, const u8 *bssid);\n\n__le32 il3945_get_antenna_flags(const struct il_priv *il);\nint il3945_init_hw_rate_table(struct il_priv *il);\nvoid il3945_reg_txpower_periodic(struct il_priv *il);\nint il3945_txpower_set_from_eeprom(struct il_priv *il);\n\nint il3945_rs_next_rate(struct il_priv *il, int rate);\n\n \nint il3945_request_scan(struct il_priv *il, struct ieee80211_vif *vif);\nvoid il3945_post_scan(struct il_priv *il);\n\n \nextern const struct il3945_rate_info il3945_rates[RATE_COUNT_3945];\n\n \n#define IL39_RSSI_OFFSET\t95\n\n \n#define EEPROM_SKU_CAP_OP_MODE_MRC                      (1 << 7)\n\n \nstruct il3945_eeprom_txpower_sample {\n\tu8 gain_idx;\t\t \n\ts8 power;\t\t \n\tu16 v_det;\t\t \n} __packed;\n\n \nstruct il3945_eeprom_txpower_group {\n\tstruct il3945_eeprom_txpower_sample samples[5];\t \n\ts32 a, b, c, d, e;\t \n\ts32 Fa, Fb, Fc, Fd, Fe;\t \n\ts8 saturation_power;\t \n\tu8 group_channel;\t \n\ts16 temperature;\t \n} __packed;\n\n \nstruct il3945_eeprom_temperature_corr {\n\tu32 Ta;\n\tu32 Tb;\n\tu32 Tc;\n\tu32 Td;\n\tu32 Te;\n} __packed;\n\n \nstruct il3945_eeprom {\n\tu8 reserved0[16];\n\tu16 device_id;\t\t \n\tu8 reserved1[2];\n\tu16 pmc;\t\t \n\tu8 reserved2[20];\n\tu8 mac_address[6];\t \n\tu8 reserved3[58];\n\tu16 board_revision;\t \n\tu8 reserved4[11];\n\tu8 board_pba_number[9];\t \n\tu8 reserved5[8];\n\tu16 version;\t\t \n\tu8 sku_cap;\t\t \n\tu8 leds_mode;\t\t \n\tu16 oem_mode;\n\tu16 wowlan_mode;\t \n\tu16 leds_time_interval;\t \n\tu8 leds_off_time;\t \n\tu8 leds_on_time;\t \n\tu8 almgor_m_version;\t \n\tu8 antenna_switch_type;\t \n\tu8 reserved6[42];\n\tu8 sku_id[4];\t\t \n\n \n\tu16 band_1_count;\t \n\tstruct il_eeprom_channel band_1_channels[14];\t \n\n \n\tu16 band_2_count;\t \n\tstruct il_eeprom_channel band_2_channels[13];\t \n\n \n\tu16 band_3_count;\t \n\tstruct il_eeprom_channel band_3_channels[12];\t \n\n \n\tu16 band_4_count;\t \n\tstruct il_eeprom_channel band_4_channels[11];\t \n\n \n\tu16 band_5_count;\t \n\tstruct il_eeprom_channel band_5_channels[6];\t \n\n\tu8 reserved9[194];\n\n \n#define IL_NUM_TX_CALIB_GROUPS 5\n\tstruct il3945_eeprom_txpower_group groups[IL_NUM_TX_CALIB_GROUPS];\n \n\tstruct il3945_eeprom_temperature_corr corrections;\t \n\tu8 reserved16[172];\t \n} __packed;\n\n#define IL3945_EEPROM_IMG_SIZE 1024\n\n \n\n#define PCI_CFG_REV_ID_BIT_BASIC_SKU                (0x40)\t \n#define PCI_CFG_REV_ID_BIT_RTP                      (0x80)\t \n\n \n#define IL39_NUM_QUEUES        5\n#define IL39_CMD_QUEUE_NUM\t4\n\n#define IL_DEFAULT_TX_RETRY  15\n\n \n\n#define RFD_SIZE                              4\n#define NUM_TFD_CHUNKS                        4\n\n#define TFD_CTL_COUNT_SET(n)       (n << 24)\n#define TFD_CTL_COUNT_GET(ctl)     ((ctl >> 24) & 7)\n#define TFD_CTL_PAD_SET(n)         (n << 28)\n#define TFD_CTL_PAD_GET(ctl)       (ctl >> 28)\n\n \n#define IL39_RTC_INST_LOWER_BOUND\t\t(0x000000)\n#define IL39_RTC_INST_UPPER_BOUND\t\t(0x014000)\n\n#define IL39_RTC_DATA_LOWER_BOUND\t\t(0x800000)\n#define IL39_RTC_DATA_UPPER_BOUND\t\t(0x808000)\n\n#define IL39_RTC_INST_SIZE (IL39_RTC_INST_UPPER_BOUND - \\\n\t\t\t\tIL39_RTC_INST_LOWER_BOUND)\n#define IL39_RTC_DATA_SIZE (IL39_RTC_DATA_UPPER_BOUND - \\\n\t\t\t\tIL39_RTC_DATA_LOWER_BOUND)\n\n#define IL39_MAX_INST_SIZE IL39_RTC_INST_SIZE\n#define IL39_MAX_DATA_SIZE IL39_RTC_DATA_SIZE\n\n \n#define IL39_MAX_BSM_SIZE IL39_RTC_INST_SIZE\n\nstatic inline int\nil3945_hw_valid_rtc_data_addr(u32 addr)\n{\n\treturn (addr >= IL39_RTC_DATA_LOWER_BOUND &&\n\t\taddr < IL39_RTC_DATA_UPPER_BOUND);\n}\n\n \nstruct il3945_shared {\n\t__le32 tx_base_ptr[8];\n} __packed;\n\n \n \n \n\n \n#define FH39_MEM_LOWER_BOUND                   (0x0800)\n#define FH39_MEM_UPPER_BOUND                   (0x1000)\n\n#define FH39_CBCC_TBL\t\t(FH39_MEM_LOWER_BOUND + 0x140)\n#define FH39_TFDB_TBL\t\t(FH39_MEM_LOWER_BOUND + 0x180)\n#define FH39_RCSR_TBL\t\t(FH39_MEM_LOWER_BOUND + 0x400)\n#define FH39_RSSR_TBL\t\t(FH39_MEM_LOWER_BOUND + 0x4c0)\n#define FH39_TCSR_TBL\t\t(FH39_MEM_LOWER_BOUND + 0x500)\n#define FH39_TSSR_TBL\t\t(FH39_MEM_LOWER_BOUND + 0x680)\n\n \n#define FH39_TFDB(_ch, buf)\t\t\t(FH39_TFDB_TBL + \\\n\t\t\t\t\t\t ((_ch) * 2 + (buf)) * 0x28)\n#define FH39_TFDB_CHNL_BUF_CTRL_REG(_ch)\t(FH39_TFDB_TBL + 0x50 * (_ch))\n\n \n#define FH39_CBCC(_ch)\t\t(FH39_CBCC_TBL + (_ch) * 0x8)\n#define FH39_CBCC_CTRL(_ch)\t(FH39_CBCC(_ch) + 0x00)\n#define FH39_CBCC_BASE(_ch)\t(FH39_CBCC(_ch) + 0x04)\n\n \n#define FH39_RCSR(_ch)\t\t\t(FH39_RCSR_TBL + (_ch) * 0x40)\n#define FH39_RCSR_CONFIG(_ch)\t\t(FH39_RCSR(_ch) + 0x00)\n#define FH39_RCSR_RBD_BASE(_ch)\t\t(FH39_RCSR(_ch) + 0x04)\n#define FH39_RCSR_WPTR(_ch)\t\t(FH39_RCSR(_ch) + 0x20)\n#define FH39_RCSR_RPTR_ADDR(_ch)\t(FH39_RCSR(_ch) + 0x24)\n\n#define FH39_RSCSR_CHNL0_WPTR\t\t(FH39_RCSR_WPTR(0))\n\n \n#define FH39_RSSR_CTRL\t\t\t(FH39_RSSR_TBL + 0x000)\n#define FH39_RSSR_STATUS\t\t(FH39_RSSR_TBL + 0x004)\n\n \n#define FH39_TCSR(_ch)\t\t\t(FH39_TCSR_TBL + (_ch) * 0x20)\n#define FH39_TCSR_CONFIG(_ch)\t\t(FH39_TCSR(_ch) + 0x00)\n#define FH39_TCSR_CREDIT(_ch)\t\t(FH39_TCSR(_ch) + 0x04)\n#define FH39_TCSR_BUFF_STTS(_ch)\t(FH39_TCSR(_ch) + 0x08)\n\n \n#define FH39_TSSR_CBB_BASE        (FH39_TSSR_TBL + 0x000)\n#define FH39_TSSR_MSG_CONFIG      (FH39_TSSR_TBL + 0x008)\n#define FH39_TSSR_TX_STATUS       (FH39_TSSR_TBL + 0x010)\n\n \n\n#define FH39_SRVC_CHNL                            (6)\n\n#define FH39_RCSR_RX_CONFIG_REG_POS_RBDC_SIZE     (20)\n#define FH39_RCSR_RX_CONFIG_REG_POS_IRQ_RBTH      (4)\n\n#define FH39_RCSR_RX_CONFIG_REG_BIT_WR_STTS_EN    (0x08000000)\n\n#define FH39_RCSR_RX_CONFIG_REG_VAL_DMA_CHNL_EN_ENABLE        (0x80000000)\n\n#define FH39_RCSR_RX_CONFIG_REG_VAL_RDRBD_EN_ENABLE           (0x20000000)\n\n#define FH39_RCSR_RX_CONFIG_REG_VAL_MAX_FRAG_SIZE_128\t\t(0x01000000)\n\n#define FH39_RCSR_RX_CONFIG_REG_VAL_IRQ_DEST_INT_HOST\t\t(0x00001000)\n\n#define FH39_RCSR_RX_CONFIG_REG_VAL_MSG_MODE_FH\t\t\t(0x00000000)\n\n#define FH39_TCSR_TX_CONFIG_REG_VAL_MSG_MODE_TXF\t\t(0x00000000)\n#define FH39_TCSR_TX_CONFIG_REG_VAL_MSG_MODE_DRIVER\t\t(0x00000001)\n\n#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_DISABLE_VAL\t(0x00000000)\n#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CREDIT_ENABLE_VAL\t(0x00000008)\n\n#define FH39_TCSR_TX_CONFIG_REG_VAL_CIRQ_HOST_IFTFD\t\t(0x00200000)\n\n#define FH39_TCSR_TX_CONFIG_REG_VAL_CIRQ_RTC_NOINT\t\t(0x00000000)\n\n#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_PAUSE\t\t(0x00000000)\n#define FH39_TCSR_TX_CONFIG_REG_VAL_DMA_CHNL_ENABLE\t\t(0x80000000)\n\n#define FH39_TCSR_CHNL_TX_BUF_STS_REG_VAL_TFDB_VALID\t\t(0x00004000)\n\n#define FH39_TCSR_CHNL_TX_BUF_STS_REG_BIT_TFDB_WPTR\t\t(0x00000001)\n\n#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_SNOOP_RD_TXPD_ON\t(0xFF000000)\n#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_ORDER_RD_TXPD_ON\t(0x00FF0000)\n\n#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_MAX_FRAG_SIZE_128B\t(0x00000400)\n\n#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_SNOOP_RD_TFD_ON\t\t(0x00000100)\n#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_ORDER_RD_CBB_ON\t\t(0x00000080)\n\n#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_ORDER_RSP_WAIT_TH\t(0x00000020)\n#define FH39_TSSR_TX_MSG_CONFIG_REG_VAL_RSP_WAIT_TH\t\t(0x00000005)\n\n#define FH39_TSSR_TX_STATUS_REG_BIT_BUFS_EMPTY(_ch)\t(BIT(_ch) << 24)\n#define FH39_TSSR_TX_STATUS_REG_BIT_NO_PEND_REQ(_ch)\t(BIT(_ch) << 16)\n\n#define FH39_TSSR_TX_STATUS_REG_MSK_CHNL_IDLE(_ch) \\\n\t(FH39_TSSR_TX_STATUS_REG_BIT_BUFS_EMPTY(_ch) | \\\n\t FH39_TSSR_TX_STATUS_REG_BIT_NO_PEND_REQ(_ch))\n\n#define FH39_RSSR_CHNL0_RX_STATUS_CHNL_IDLE\t\t\t(0x01000000)\n\nstruct il3945_tfd_tb {\n\t__le32 addr;\n\t__le32 len;\n} __packed;\n\nstruct il3945_tfd {\n\t__le32 control_flags;\n\tstruct il3945_tfd_tb tbs[4];\n\tu8 __pad[28];\n} __packed;\n\n#ifdef CONFIG_IWLEGACY_DEBUGFS\nextern const struct il_debugfs_ops il3945_debugfs_ops;\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}