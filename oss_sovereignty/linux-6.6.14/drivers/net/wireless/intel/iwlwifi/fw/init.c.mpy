{
  "module_name": "init.c",
  "hash_id": "a6898bb77f61a8ce5cf42135a31c5fc2867f3da90f072bcf0e7a3f9cf63fe43b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/intel/iwlwifi/fw/init.c",
  "human_readable_source": "\n \n#include \"iwl-drv.h\"\n#include \"runtime.h\"\n#include \"dbg.h\"\n#include \"debugfs.h\"\n\n#include \"fw/api/system.h\"\n#include \"fw/api/commands.h\"\n#include \"fw/api/rx.h\"\n#include \"fw/api/datapath.h\"\n\nvoid iwl_fw_runtime_init(struct iwl_fw_runtime *fwrt, struct iwl_trans *trans,\n\t\t\tconst struct iwl_fw *fw,\n\t\t\tconst struct iwl_fw_runtime_ops *ops, void *ops_ctx,\n\t\t\tconst struct iwl_dump_sanitize_ops *sanitize_ops,\n\t\t\tvoid *sanitize_ctx,\n\t\t\tstruct dentry *dbgfs_dir)\n{\n\tint i;\n\n\tmemset(fwrt, 0, sizeof(*fwrt));\n\tfwrt->trans = trans;\n\tfwrt->fw = fw;\n\tfwrt->dev = trans->dev;\n\tfwrt->dump.conf = FW_DBG_INVALID;\n\tfwrt->ops = ops;\n\tfwrt->sanitize_ops = sanitize_ops;\n\tfwrt->sanitize_ctx = sanitize_ctx;\n\tfwrt->ops_ctx = ops_ctx;\n\tfor (i = 0; i < IWL_FW_RUNTIME_DUMP_WK_NUM; i++) {\n\t\tfwrt->dump.wks[i].idx = i;\n\t\tINIT_DELAYED_WORK(&fwrt->dump.wks[i].wk, iwl_fw_error_dump_wk);\n\t}\n\tiwl_fwrt_dbgfs_register(fwrt, dbgfs_dir);\n}\nIWL_EXPORT_SYMBOL(iwl_fw_runtime_init);\n\nvoid iwl_fw_runtime_suspend(struct iwl_fw_runtime *fwrt)\n{\n\tiwl_fw_suspend_timestamp(fwrt);\n\tiwl_dbg_tlv_time_point(fwrt, IWL_FW_INI_TIME_POINT_HOST_D3_START, NULL);\n}\nIWL_EXPORT_SYMBOL(iwl_fw_runtime_suspend);\n\nvoid iwl_fw_runtime_resume(struct iwl_fw_runtime *fwrt)\n{\n\tiwl_dbg_tlv_time_point(fwrt, IWL_FW_INI_TIME_POINT_HOST_D3_END, NULL);\n\tiwl_fw_resume_timestamp(fwrt);\n}\nIWL_EXPORT_SYMBOL(iwl_fw_runtime_resume);\n\n \nint iwl_set_soc_latency(struct iwl_fw_runtime *fwrt)\n{\n\tstruct iwl_soc_configuration_cmd cmd = {};\n\tstruct iwl_host_cmd hcmd = {\n\t\t.id = WIDE_ID(SYSTEM_GROUP, SOC_CONFIGURATION_CMD),\n\t\t.data[0] = &cmd,\n\t\t.len[0] = sizeof(cmd),\n\t};\n\tint ret;\n\n\t \n\tif (!fwrt->trans->trans_cfg->integrated)\n\t\tcmd.flags = cpu_to_le32(SOC_CONFIG_CMD_FLAGS_DISCRETE);\n\n\tBUILD_BUG_ON(IWL_CFG_TRANS_LTR_DELAY_NONE !=\n\t\t     SOC_FLAGS_LTR_APPLY_DELAY_NONE);\n\tBUILD_BUG_ON(IWL_CFG_TRANS_LTR_DELAY_200US !=\n\t\t     SOC_FLAGS_LTR_APPLY_DELAY_200);\n\tBUILD_BUG_ON(IWL_CFG_TRANS_LTR_DELAY_2500US !=\n\t\t     SOC_FLAGS_LTR_APPLY_DELAY_2500);\n\tBUILD_BUG_ON(IWL_CFG_TRANS_LTR_DELAY_1820US !=\n\t\t     SOC_FLAGS_LTR_APPLY_DELAY_1820);\n\n\tif (fwrt->trans->trans_cfg->ltr_delay != IWL_CFG_TRANS_LTR_DELAY_NONE &&\n\t    !WARN_ON(!fwrt->trans->trans_cfg->integrated))\n\t\tcmd.flags |= le32_encode_bits(fwrt->trans->trans_cfg->ltr_delay,\n\t\t\t\t\t      SOC_FLAGS_LTR_APPLY_DELAY_MASK);\n\n\tif (iwl_fw_lookup_cmd_ver(fwrt->fw, SCAN_REQ_UMAC,\n\t\t\t\t  IWL_FW_CMD_VER_UNKNOWN) >= 2 &&\n\t    fwrt->trans->trans_cfg->low_latency_xtal)\n\t\tcmd.flags |= cpu_to_le32(SOC_CONFIG_CMD_FLAGS_LOW_LATENCY);\n\n\tcmd.latency = cpu_to_le32(fwrt->trans->trans_cfg->xtal_latency);\n\n\tret = iwl_trans_send_cmd(fwrt->trans, &hcmd);\n\tif (ret)\n\t\tIWL_ERR(fwrt, \"Failed to set soc latency: %d\\n\", ret);\n\treturn ret;\n}\nIWL_EXPORT_SYMBOL(iwl_set_soc_latency);\n\nint iwl_configure_rxq(struct iwl_fw_runtime *fwrt)\n{\n\tint i, num_queues, size, ret;\n\tstruct iwl_rfh_queue_config *cmd;\n\tstruct iwl_host_cmd hcmd = {\n\t\t.id = WIDE_ID(DATA_PATH_GROUP, RFH_QUEUE_CONFIG_CMD),\n\t\t.dataflags[0] = IWL_HCMD_DFL_NOCOPY,\n\t};\n\n\t \n\tif (fwrt->trans->num_rx_queues == 1)\n\t\treturn 0;\n\n\tif (fwrt->trans->trans_cfg->device_family < IWL_DEVICE_FAMILY_22000)\n\t\treturn 0;\n\n\t \n\tnum_queues = fwrt->trans->num_rx_queues - 1;\n\n\tsize = struct_size(cmd, data, num_queues);\n\n\tcmd = kzalloc(size, GFP_KERNEL);\n\tif (!cmd)\n\t\treturn -ENOMEM;\n\n\tcmd->num_queues = num_queues;\n\n\tfor (i = 0; i < num_queues; i++) {\n\t\tstruct iwl_trans_rxq_dma_data data;\n\n\t\tcmd->data[i].q_num = i + 1;\n\t\tiwl_trans_get_rxq_dma_data(fwrt->trans, i + 1, &data);\n\n\t\tcmd->data[i].fr_bd_cb = cpu_to_le64(data.fr_bd_cb);\n\t\tcmd->data[i].urbd_stts_wrptr =\n\t\t\tcpu_to_le64(data.urbd_stts_wrptr);\n\t\tcmd->data[i].ur_bd_cb = cpu_to_le64(data.ur_bd_cb);\n\t\tcmd->data[i].fr_bd_wid = cpu_to_le32(data.fr_bd_wid);\n\t}\n\n\thcmd.data[0] = cmd;\n\thcmd.len[0] = size;\n\n\tret = iwl_trans_send_cmd(fwrt->trans, &hcmd);\n\n\tkfree(cmd);\n\n\tif (ret)\n\t\tIWL_ERR(fwrt, \"Failed to configure RX queues: %d\\n\", ret);\n\n\treturn ret;\n}\nIWL_EXPORT_SYMBOL(iwl_configure_rxq);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}