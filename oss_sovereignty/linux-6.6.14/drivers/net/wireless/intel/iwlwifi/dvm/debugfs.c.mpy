{
  "module_name": "debugfs.c",
  "hash_id": "80677b62ee1a2e9ff7cb7d8062735de332915baf0811ba2d0846defc491c308b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/intel/iwlwifi/dvm/debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/slab.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/debugfs.h>\n#include <linux/ieee80211.h>\n#include <net/mac80211.h>\n\n#include \"iwl-debug.h\"\n#include \"iwl-trans.h\"\n#include \"iwl-io.h\"\n#include \"dev.h\"\n#include \"agn.h\"\n\n \n#define DEBUGFS_ADD_FILE(name, parent, mode) do {\t\t\t\\\n\tdebugfs_create_file(#name, mode, parent, priv,\t\t\t\\\n\t\t\t    &iwl_dbgfs_##name##_ops);\t\t\t\\\n} while (0)\n\n \n#define DEBUGFS_READ_FILE_OPS(name)                                     \\\nstatic const struct file_operations iwl_dbgfs_##name##_ops = {          \\\n\t.read = iwl_dbgfs_##name##_read,\t\t\t\t\\\n\t.open = simple_open,\t\t\t\t\t\t\\\n\t.llseek = generic_file_llseek,\t\t\t\t\t\\\n};\n\n#define DEBUGFS_WRITE_FILE_OPS(name)                                    \\\nstatic const struct file_operations iwl_dbgfs_##name##_ops = {          \\\n\t.write = iwl_dbgfs_##name##_write,                              \\\n\t.open = simple_open,\t\t\t\t\t\t\\\n\t.llseek = generic_file_llseek,\t\t\t\t\t\\\n};\n\n\n#define DEBUGFS_READ_WRITE_FILE_OPS(name)                               \\\nstatic const struct file_operations iwl_dbgfs_##name##_ops = {          \\\n\t.write = iwl_dbgfs_##name##_write,                              \\\n\t.read = iwl_dbgfs_##name##_read,                                \\\n\t.open = simple_open,\t\t\t\t\t\t\\\n\t.llseek = generic_file_llseek,\t\t\t\t\t\\\n};\n\nstatic ssize_t iwl_dbgfs_sram_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tu32 val = 0;\n\tchar *buf;\n\tssize_t ret;\n\tint i = 0;\n\tbool device_format = false;\n\tint offset = 0;\n\tint len = 0;\n\tint pos = 0;\n\tint sram;\n\tstruct iwl_priv *priv = file->private_data;\n\tconst struct fw_img *img;\n\tsize_t bufsz;\n\n\tif (!iwl_is_ready_rf(priv))\n\t\treturn -EAGAIN;\n\n\t \n\tif (!priv->dbgfs_sram_offset && !priv->dbgfs_sram_len) {\n\t\tpriv->dbgfs_sram_offset = 0x800000;\n\t\tif (!priv->ucode_loaded)\n\t\t\treturn -EINVAL;\n\t\timg = &priv->fw->img[priv->cur_ucode];\n\t\tpriv->dbgfs_sram_len = img->sec[IWL_UCODE_SECTION_DATA].len;\n\t}\n\tlen = priv->dbgfs_sram_len;\n\n\tif (len == -4) {\n\t\tdevice_format = true;\n\t\tlen = 4;\n\t}\n\n\tbufsz =  50 + len * 4;\n\tbuf = kmalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"sram_len: 0x%x\\n\",\n\t\t\t len);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"sram_offset: 0x%x\\n\",\n\t\t\tpriv->dbgfs_sram_offset);\n\n\t \n\toffset = priv->dbgfs_sram_offset & 0x3;\n\tsram = priv->dbgfs_sram_offset & ~0x3;\n\n\t \n\tval = iwl_trans_read_mem32(priv->trans, sram);\n\n\tfor (; len; len--) {\n\t\t \n\t\tif (i == 0)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"%08X: \", sram + offset);\n\n\t\tif (device_format)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"%02x\", (val >> (8 * (3 - offset))) & 0xff);\n\t\telse\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"%02x \", (val >> (8 * offset)) & 0xff);\n\n\t\t \n\t\tif (++offset == 4) {\n\t\t\tsram += 4;\n\t\t\toffset = 0;\n\t\t\tval = iwl_trans_read_mem32(priv->trans, sram);\n\t\t}\n\n\t\t \n\t\tif (++i == 16) {\n\t\t\ti = 0;\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\t\t} else if (!(i & 7)) {\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos, \"   \");\n\t\t} else if (!(i & 3)) {\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos, \" \");\n\t\t}\n\t}\n\tif (i)\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_sram_write(struct file *file,\n\t\t\t\t\tconst char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[64];\n\tint buf_size;\n\tu32 offset, len;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\n\tif (sscanf(buf, \"%x,%x\", &offset, &len) == 2) {\n\t\tpriv->dbgfs_sram_offset = offset;\n\t\tpriv->dbgfs_sram_len = len;\n\t} else if (sscanf(buf, \"%x\", &offset) == 1) {\n\t\tpriv->dbgfs_sram_offset = offset;\n\t\tpriv->dbgfs_sram_len = -4;\n\t} else {\n\t\tpriv->dbgfs_sram_offset = 0;\n\t\tpriv->dbgfs_sram_len = 0;\n\t}\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_wowlan_sram_read(struct file *file,\n\t\t\t\t\t  char __user *user_buf,\n\t\t\t\t\t  size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tconst struct fw_img *img = &priv->fw->img[IWL_UCODE_WOWLAN];\n\n\tif (!priv->wowlan_sram)\n\t\treturn -ENODATA;\n\n\treturn simple_read_from_buffer(user_buf, count, ppos,\n\t\t\t\t       priv->wowlan_sram,\n\t\t\t\t       img->sec[IWL_UCODE_SECTION_DATA].len);\n}\nstatic ssize_t iwl_dbgfs_stations_read(struct file *file, char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tstruct iwl_station_entry *station;\n\tstruct iwl_tid_data *tid_data;\n\tchar *buf;\n\tint i, j, pos = 0;\n\tssize_t ret;\n\t \n\tconst size_t bufsz = 30 + sizeof(char) * 500 * (priv->num_stations);\n\n\tbuf = kmalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"num of stations: %d\\n\\n\",\n\t\t\tpriv->num_stations);\n\n\tfor (i = 0; i < IWLAGN_STATION_COUNT; i++) {\n\t\tstation = &priv->stations[i];\n\t\tif (!station->used)\n\t\t\tcontinue;\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t \"station %d - addr: %pM, flags: %#x\\n\",\n\t\t\t\t i, station->sta.sta.addr,\n\t\t\t\t station->sta.station_flags_msk);\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"TID seqno  next_rclmd \"\n\t\t\t\t\"rate_n_flags state txq\\n\");\n\n\t\tfor (j = 0; j < IWL_MAX_TID_COUNT; j++) {\n\t\t\ttid_data = &priv->tid_data[i][j];\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"%d:  0x%.4x 0x%.4x     0x%.8x   \"\n\t\t\t\t\"%d     %.2d\",\n\t\t\t\tj, tid_data->seq_number,\n\t\t\t\ttid_data->next_reclaimed,\n\t\t\t\ttid_data->agg.rate_n_flags,\n\t\t\t\ttid_data->agg.state,\n\t\t\t\ttid_data->agg.txq_id);\n\n\t\t\tif (tid_data->agg.wait_for_ba)\n\t\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\t\t \" - waitforba\");\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\t\t}\n\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\t}\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_nvm_read(struct file *file,\n\t\t\t\t       char __user *user_buf,\n\t\t\t\t       size_t count,\n\t\t\t\t       loff_t *ppos)\n{\n\tssize_t ret;\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0, ofs = 0, buf_size = 0;\n\tconst u8 *ptr;\n\tchar *buf;\n\tu16 nvm_ver;\n\tsize_t eeprom_len = priv->eeprom_blob_size;\n\tbuf_size = 4 * eeprom_len + 256;\n\n\tif (eeprom_len % 16)\n\t\treturn -ENODATA;\n\n\tptr = priv->eeprom_blob;\n\tif (!ptr)\n\t\treturn -ENOMEM;\n\n\t \n\tbuf = kzalloc(buf_size, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tnvm_ver = priv->nvm_data->nvm_version;\n\tpos += scnprintf(buf + pos, buf_size - pos,\n\t\t\t \"NVM version: 0x%x\\n\", nvm_ver);\n\tfor (ofs = 0 ; ofs < eeprom_len ; ofs += 16) {\n\t\tpos += scnprintf(buf + pos, buf_size - pos, \"0x%.4x %16ph\\n\",\n\t\t\t\t ofs, ptr + ofs);\n\t}\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_channels_read(struct file *file, char __user *user_buf,\n\t\t\t\t       size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tstruct ieee80211_channel *channels = NULL;\n\tconst struct ieee80211_supported_band *supp_band = NULL;\n\tint pos = 0, i, bufsz = PAGE_SIZE;\n\tchar *buf;\n\tssize_t ret;\n\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tsupp_band = iwl_get_hw_mode(priv, NL80211_BAND_2GHZ);\n\tif (supp_band) {\n\t\tchannels = supp_band->channels;\n\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"Displaying %d channels in 2.4GHz band 802.11bg):\\n\",\n\t\t\t\tsupp_band->n_channels);\n\n\t\tfor (i = 0; i < supp_band->n_channels; i++)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\t\"%d: %ddBm: BSS%s%s, %s.\\n\",\n\t\t\t\t\tchannels[i].hw_value,\n\t\t\t\t\tchannels[i].max_power,\n\t\t\t\t\tchannels[i].flags & IEEE80211_CHAN_RADAR ?\n\t\t\t\t\t\" (IEEE 802.11h required)\" : \"\",\n\t\t\t\t\t((channels[i].flags & IEEE80211_CHAN_NO_IR)\n\t\t\t\t\t|| (channels[i].flags &\n\t\t\t\t\tIEEE80211_CHAN_RADAR)) ? \"\" :\n\t\t\t\t\t\", IBSS\",\n\t\t\t\t\tchannels[i].flags &\n\t\t\t\t\tIEEE80211_CHAN_NO_IR ?\n\t\t\t\t\t\"passive only\" : \"active/passive\");\n\t}\n\tsupp_band = iwl_get_hw_mode(priv, NL80211_BAND_5GHZ);\n\tif (supp_band) {\n\t\tchannels = supp_band->channels;\n\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"Displaying %d channels in 5.2GHz band (802.11a)\\n\",\n\t\t\t\tsupp_band->n_channels);\n\n\t\tfor (i = 0; i < supp_band->n_channels; i++)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\t\"%d: %ddBm: BSS%s%s, %s.\\n\",\n\t\t\t\t\tchannels[i].hw_value,\n\t\t\t\t\tchannels[i].max_power,\n\t\t\t\t\tchannels[i].flags & IEEE80211_CHAN_RADAR ?\n\t\t\t\t\t\" (IEEE 802.11h required)\" : \"\",\n\t\t\t\t\t((channels[i].flags & IEEE80211_CHAN_NO_IR)\n\t\t\t\t\t|| (channels[i].flags &\n\t\t\t\t\tIEEE80211_CHAN_RADAR)) ? \"\" :\n\t\t\t\t\t\", IBSS\",\n\t\t\t\t\tchannels[i].flags &\n\t\t\t\t\tIEEE80211_CHAN_NO_IR ?\n\t\t\t\t\t\"passive only\" : \"active/passive\");\n\t}\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_status_read(struct file *file,\n\t\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[512];\n\tint pos = 0;\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_RF_KILL_HW:\\t %d\\n\",\n\t\ttest_bit(STATUS_RF_KILL_HW, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_CT_KILL:\\t\\t %d\\n\",\n\t\ttest_bit(STATUS_CT_KILL, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_ALIVE:\\t\\t %d\\n\",\n\t\ttest_bit(STATUS_ALIVE, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_READY:\\t\\t %d\\n\",\n\t\ttest_bit(STATUS_READY, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_EXIT_PENDING:\\t %d\\n\",\n\t\ttest_bit(STATUS_EXIT_PENDING, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_STATISTICS:\\t %d\\n\",\n\t\ttest_bit(STATUS_STATISTICS, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_SCANNING:\\t %d\\n\",\n\t\ttest_bit(STATUS_SCANNING, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_SCAN_ABORTING:\\t %d\\n\",\n\t\ttest_bit(STATUS_SCAN_ABORTING, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_SCAN_HW:\\t\\t %d\\n\",\n\t\ttest_bit(STATUS_SCAN_HW, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_POWER_PMI:\\t %d\\n\",\n\t\ttest_bit(STATUS_POWER_PMI, &priv->status));\n\tpos += scnprintf(buf + pos, bufsz - pos, \"STATUS_FW_ERROR:\\t %d\\n\",\n\t\ttest_bit(STATUS_FW_ERROR, &priv->status));\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_rx_handlers_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\n\tint pos = 0;\n\tint cnt = 0;\n\tchar *buf;\n\tint bufsz = 24 * 64;  \n\tssize_t ret;\n\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tfor (cnt = 0; cnt < REPLY_MAX; cnt++) {\n\t\tif (priv->rx_handlers_stats[cnt] > 0)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"\\tRx handler[%36s]:\\t\\t %u\\n\",\n\t\t\t\tiwl_get_cmd_string(priv->trans, (u32)cnt),\n\t\t\t\tpriv->rx_handlers_stats[cnt]);\n\t}\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_rx_handlers_write(struct file *file,\n\t\t\t\t\t const char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\n\tchar buf[8];\n\tint buf_size;\n\tu32 reset_flag;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%x\", &reset_flag) != 1)\n\t\treturn -EFAULT;\n\tif (reset_flag == 0)\n\t\tmemset(&priv->rx_handlers_stats[0], 0,\n\t\t\tsizeof(priv->rx_handlers_stats));\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_qos_read(struct file *file, char __user *user_buf,\n\t\t\t\t       size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tstruct iwl_rxon_context *ctx;\n\tint pos = 0, i;\n\tchar buf[256 * NUM_IWL_RXON_CTX];\n\tconst size_t bufsz = sizeof(buf);\n\n\tfor_each_context(priv, ctx) {\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"context %d:\\n\",\n\t\t\t\t ctx->ctxid);\n\t\tfor (i = 0; i < AC_NUM; i++) {\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"\\tcw_min\\tcw_max\\taifsn\\ttxop\\n\");\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"AC[%d]\\t%u\\t%u\\t%u\\t%u\\n\", i,\n\t\t\t\tctx->qos_data.def_qos_parm.ac[i].cw_min,\n\t\t\t\tctx->qos_data.def_qos_parm.ac[i].cw_max,\n\t\t\t\tctx->qos_data.def_qos_parm.ac[i].aifsn,\n\t\t\t\tctx->qos_data.def_qos_parm.ac[i].edca_txop);\n\t\t}\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\t}\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_thermal_throttling_read(struct file *file,\n\t\t\t\tchar __user *user_buf,\n\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tstruct iwl_tt_mgmt *tt = &priv->thermal_throttle;\n\tstruct iwl_tt_restriction *restriction;\n\tchar buf[100];\n\tint pos = 0;\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"Thermal Throttling Mode: %s\\n\",\n\t\t\ttt->advanced_tt ? \"Advance\" : \"Legacy\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"Thermal Throttling State: %d\\n\",\n\t\t\ttt->state);\n\tif (tt->advanced_tt) {\n\t\trestriction = tt->restriction + tt->state;\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"Tx mode: %d\\n\",\n\t\t\t\trestriction->tx_stream);\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"Rx mode: %d\\n\",\n\t\t\t\trestriction->rx_stream);\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\"HT mode: %d\\n\",\n\t\t\t\trestriction->is_ht);\n\t}\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_disable_ht40_write(struct file *file,\n\t\t\t\t\t const char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint ht40;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%d\", &ht40) != 1)\n\t\treturn -EFAULT;\n\tif (!iwl_is_any_associated(priv))\n\t\tpriv->disable_ht40 = ht40 ? true : false;\n\telse\n\t\treturn -EINVAL;\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_disable_ht40_read(struct file *file,\n\t\t\t\t\t char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[100];\n\tint pos = 0;\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"11n 40MHz Mode: %s\\n\",\n\t\t\tpriv->disable_ht40 ? \"Disabled\" : \"Enabled\");\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_temperature_read(struct file *file,\n\t\t\t\t\t char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint pos = 0;\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%d\\n\", priv->temperature);\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\n\nstatic ssize_t iwl_dbgfs_sleep_level_override_write(struct file *file,\n\t\t\t\t\t\t    const char __user *user_buf,\n\t\t\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint value;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\n\tif (sscanf(buf, \"%d\", &value) != 1)\n\t\treturn -EINVAL;\n\n\t \n\tif (value == 0)\n\t\treturn -EINVAL;\n\telse if (value > 0)\n\t\tvalue -= 1;\n\n\tif (value != -1 && (value < 0 || value >= IWL_POWER_NUM))\n\t\treturn -EINVAL;\n\n\tif (!iwl_is_ready_rf(priv))\n\t\treturn -EAGAIN;\n\n\tpriv->power_data.debug_sleep_level_override = value;\n\n\tmutex_lock(&priv->mutex);\n\tiwl_power_update_mode(priv, true);\n\tmutex_unlock(&priv->mutex);\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_sleep_level_override_read(struct file *file,\n\t\t\t\t\t\t   char __user *user_buf,\n\t\t\t\t\t\t   size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[10];\n\tint pos, value;\n\tconst size_t bufsz = sizeof(buf);\n\n\t \n\tvalue = priv->power_data.debug_sleep_level_override;\n\tif (value >= 0)\n\t\tvalue += 1;\n\n\tpos = scnprintf(buf, bufsz, \"%d\\n\", value);\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_current_sleep_command_read(struct file *file,\n\t\t\t\t\t\t    char __user *user_buf,\n\t\t\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[200];\n\tint pos = 0, i;\n\tconst size_t bufsz = sizeof(buf);\n\tstruct iwl_powertable_cmd *cmd = &priv->power_data.sleep_cmd;\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"flags: %#.2x\\n\", le16_to_cpu(cmd->flags));\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"RX/TX timeout: %d/%d usec\\n\",\n\t\t\t le32_to_cpu(cmd->rx_data_timeout),\n\t\t\t le32_to_cpu(cmd->tx_data_timeout));\n\tfor (i = 0; i < IWL_POWER_VEC_SIZE; i++)\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t \"sleep_interval[%d]: %d\\n\", i,\n\t\t\t\t le32_to_cpu(cmd->sleep_interval[i]));\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nDEBUGFS_READ_WRITE_FILE_OPS(sram);\nDEBUGFS_READ_FILE_OPS(wowlan_sram);\nDEBUGFS_READ_FILE_OPS(nvm);\nDEBUGFS_READ_FILE_OPS(stations);\nDEBUGFS_READ_FILE_OPS(channels);\nDEBUGFS_READ_FILE_OPS(status);\nDEBUGFS_READ_WRITE_FILE_OPS(rx_handlers);\nDEBUGFS_READ_FILE_OPS(qos);\nDEBUGFS_READ_FILE_OPS(thermal_throttling);\nDEBUGFS_READ_WRITE_FILE_OPS(disable_ht40);\nDEBUGFS_READ_FILE_OPS(temperature);\nDEBUGFS_READ_WRITE_FILE_OPS(sleep_level_override);\nDEBUGFS_READ_FILE_OPS(current_sleep_command);\n\n#define fmt_value\t\"  %-30s %10u\\n\"\n#define fmt_hex\t\t\"  %-30s       0x%02X\\n\"\n#define fmt_table\t\"  %-30s %10u  %10u  %10u  %10u\\n\"\n#define fmt_header\t\"%-32s    current  cumulative       delta         max\\n\"\n\nstatic int iwl_statistics_flag(struct iwl_priv *priv, char *buf, int bufsz)\n{\n\tint p = 0;\n\tu32 flag;\n\n\tlockdep_assert_held(&priv->statistics.lock);\n\n\tflag = le32_to_cpu(priv->statistics.flag);\n\n\tp += scnprintf(buf + p, bufsz - p, \"Statistics Flag(0x%X):\\n\", flag);\n\tif (flag & UCODE_STATISTICS_CLEAR_MSK)\n\t\tp += scnprintf(buf + p, bufsz - p,\n\t\t\"\\tStatistics have been cleared\\n\");\n\tp += scnprintf(buf + p, bufsz - p, \"\\tOperational Frequency: %s\\n\",\n\t\t(flag & UCODE_STATISTICS_FREQUENCY_MSK)\n\t\t? \"2.4 GHz\" : \"5.2 GHz\");\n\tp += scnprintf(buf + p, bufsz - p, \"\\tTGj Narrow Band: %s\\n\",\n\t\t(flag & UCODE_STATISTICS_NARROW_BAND_MSK)\n\t\t ? \"enabled\" : \"disabled\");\n\n\treturn p;\n}\n\nstatic ssize_t iwl_dbgfs_ucode_rx_stats_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tchar *buf;\n\tint bufsz = sizeof(struct statistics_rx_phy) * 40 +\n\t\t    sizeof(struct statistics_rx_non_phy) * 40 +\n\t\t    sizeof(struct statistics_rx_ht_phy) * 40 + 400;\n\tssize_t ret;\n\tstruct statistics_rx_phy *ofdm, *accum_ofdm, *delta_ofdm, *max_ofdm;\n\tstruct statistics_rx_phy *cck, *accum_cck, *delta_cck, *max_cck;\n\tstruct statistics_rx_non_phy *general, *accum_general;\n\tstruct statistics_rx_non_phy *delta_general, *max_general;\n\tstruct statistics_rx_ht_phy *ht, *accum_ht, *delta_ht, *max_ht;\n\n\tif (!iwl_is_alive(priv))\n\t\treturn -EAGAIN;\n\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\t \n\tspin_lock_bh(&priv->statistics.lock);\n\tofdm = &priv->statistics.rx_ofdm;\n\tcck = &priv->statistics.rx_cck;\n\tgeneral = &priv->statistics.rx_non_phy;\n\tht = &priv->statistics.rx_ofdm_ht;\n\taccum_ofdm = &priv->accum_stats.rx_ofdm;\n\taccum_cck = &priv->accum_stats.rx_cck;\n\taccum_general = &priv->accum_stats.rx_non_phy;\n\taccum_ht = &priv->accum_stats.rx_ofdm_ht;\n\tdelta_ofdm = &priv->delta_stats.rx_ofdm;\n\tdelta_cck = &priv->delta_stats.rx_cck;\n\tdelta_general = &priv->delta_stats.rx_non_phy;\n\tdelta_ht = &priv->delta_stats.rx_ofdm_ht;\n\tmax_ofdm = &priv->max_delta_stats.rx_ofdm;\n\tmax_cck = &priv->max_delta_stats.rx_cck;\n\tmax_general = &priv->max_delta_stats.rx_non_phy;\n\tmax_ht = &priv->max_delta_stats.rx_ofdm_ht;\n\n\tpos += iwl_statistics_flag(priv, buf, bufsz);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_header, \"Statistics_Rx - OFDM:\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"ina_cnt:\",\n\t\t\t le32_to_cpu(ofdm->ina_cnt),\n\t\t\t accum_ofdm->ina_cnt,\n\t\t\t delta_ofdm->ina_cnt, max_ofdm->ina_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"fina_cnt:\",\n\t\t\t le32_to_cpu(ofdm->fina_cnt), accum_ofdm->fina_cnt,\n\t\t\t delta_ofdm->fina_cnt, max_ofdm->fina_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"plcp_err:\",\n\t\t\t le32_to_cpu(ofdm->plcp_err), accum_ofdm->plcp_err,\n\t\t\t delta_ofdm->plcp_err, max_ofdm->plcp_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"crc32_err:\",\n\t\t\t le32_to_cpu(ofdm->crc32_err), accum_ofdm->crc32_err,\n\t\t\t delta_ofdm->crc32_err, max_ofdm->crc32_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"overrun_err:\",\n\t\t\t le32_to_cpu(ofdm->overrun_err),\n\t\t\t accum_ofdm->overrun_err, delta_ofdm->overrun_err,\n\t\t\t max_ofdm->overrun_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"early_overrun_err:\",\n\t\t\t le32_to_cpu(ofdm->early_overrun_err),\n\t\t\t accum_ofdm->early_overrun_err,\n\t\t\t delta_ofdm->early_overrun_err,\n\t\t\t max_ofdm->early_overrun_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"crc32_good:\",\n\t\t\t le32_to_cpu(ofdm->crc32_good),\n\t\t\t accum_ofdm->crc32_good, delta_ofdm->crc32_good,\n\t\t\t max_ofdm->crc32_good);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"false_alarm_cnt:\",\n\t\t\t le32_to_cpu(ofdm->false_alarm_cnt),\n\t\t\t accum_ofdm->false_alarm_cnt,\n\t\t\t delta_ofdm->false_alarm_cnt,\n\t\t\t max_ofdm->false_alarm_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"fina_sync_err_cnt:\",\n\t\t\t le32_to_cpu(ofdm->fina_sync_err_cnt),\n\t\t\t accum_ofdm->fina_sync_err_cnt,\n\t\t\t delta_ofdm->fina_sync_err_cnt,\n\t\t\t max_ofdm->fina_sync_err_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sfd_timeout:\",\n\t\t\t le32_to_cpu(ofdm->sfd_timeout),\n\t\t\t accum_ofdm->sfd_timeout, delta_ofdm->sfd_timeout,\n\t\t\t max_ofdm->sfd_timeout);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"fina_timeout:\",\n\t\t\t le32_to_cpu(ofdm->fina_timeout),\n\t\t\t accum_ofdm->fina_timeout, delta_ofdm->fina_timeout,\n\t\t\t max_ofdm->fina_timeout);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"unresponded_rts:\",\n\t\t\t le32_to_cpu(ofdm->unresponded_rts),\n\t\t\t accum_ofdm->unresponded_rts,\n\t\t\t delta_ofdm->unresponded_rts,\n\t\t\t max_ofdm->unresponded_rts);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"rxe_frame_lmt_ovrun:\",\n\t\t\t le32_to_cpu(ofdm->rxe_frame_limit_overrun),\n\t\t\t accum_ofdm->rxe_frame_limit_overrun,\n\t\t\t delta_ofdm->rxe_frame_limit_overrun,\n\t\t\t max_ofdm->rxe_frame_limit_overrun);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sent_ack_cnt:\",\n\t\t\t le32_to_cpu(ofdm->sent_ack_cnt),\n\t\t\t accum_ofdm->sent_ack_cnt, delta_ofdm->sent_ack_cnt,\n\t\t\t max_ofdm->sent_ack_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sent_cts_cnt:\",\n\t\t\t le32_to_cpu(ofdm->sent_cts_cnt),\n\t\t\t accum_ofdm->sent_cts_cnt, delta_ofdm->sent_cts_cnt,\n\t\t\t max_ofdm->sent_cts_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sent_ba_rsp_cnt:\",\n\t\t\t le32_to_cpu(ofdm->sent_ba_rsp_cnt),\n\t\t\t accum_ofdm->sent_ba_rsp_cnt,\n\t\t\t delta_ofdm->sent_ba_rsp_cnt,\n\t\t\t max_ofdm->sent_ba_rsp_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"dsp_self_kill:\",\n\t\t\t le32_to_cpu(ofdm->dsp_self_kill),\n\t\t\t accum_ofdm->dsp_self_kill,\n\t\t\t delta_ofdm->dsp_self_kill,\n\t\t\t max_ofdm->dsp_self_kill);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"mh_format_err:\",\n\t\t\t le32_to_cpu(ofdm->mh_format_err),\n\t\t\t accum_ofdm->mh_format_err,\n\t\t\t delta_ofdm->mh_format_err,\n\t\t\t max_ofdm->mh_format_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"re_acq_main_rssi_sum:\",\n\t\t\t le32_to_cpu(ofdm->re_acq_main_rssi_sum),\n\t\t\t accum_ofdm->re_acq_main_rssi_sum,\n\t\t\t delta_ofdm->re_acq_main_rssi_sum,\n\t\t\t max_ofdm->re_acq_main_rssi_sum);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_header, \"Statistics_Rx - CCK:\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"ina_cnt:\",\n\t\t\t le32_to_cpu(cck->ina_cnt), accum_cck->ina_cnt,\n\t\t\t delta_cck->ina_cnt, max_cck->ina_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"fina_cnt:\",\n\t\t\t le32_to_cpu(cck->fina_cnt), accum_cck->fina_cnt,\n\t\t\t delta_cck->fina_cnt, max_cck->fina_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"plcp_err:\",\n\t\t\t le32_to_cpu(cck->plcp_err), accum_cck->plcp_err,\n\t\t\t delta_cck->plcp_err, max_cck->plcp_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"crc32_err:\",\n\t\t\t le32_to_cpu(cck->crc32_err), accum_cck->crc32_err,\n\t\t\t delta_cck->crc32_err, max_cck->crc32_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"overrun_err:\",\n\t\t\t le32_to_cpu(cck->overrun_err),\n\t\t\t accum_cck->overrun_err, delta_cck->overrun_err,\n\t\t\t max_cck->overrun_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"early_overrun_err:\",\n\t\t\t le32_to_cpu(cck->early_overrun_err),\n\t\t\t accum_cck->early_overrun_err,\n\t\t\t delta_cck->early_overrun_err,\n\t\t\t max_cck->early_overrun_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"crc32_good:\",\n\t\t\t le32_to_cpu(cck->crc32_good), accum_cck->crc32_good,\n\t\t\t delta_cck->crc32_good, max_cck->crc32_good);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"false_alarm_cnt:\",\n\t\t\t le32_to_cpu(cck->false_alarm_cnt),\n\t\t\t accum_cck->false_alarm_cnt,\n\t\t\t delta_cck->false_alarm_cnt, max_cck->false_alarm_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"fina_sync_err_cnt:\",\n\t\t\t le32_to_cpu(cck->fina_sync_err_cnt),\n\t\t\t accum_cck->fina_sync_err_cnt,\n\t\t\t delta_cck->fina_sync_err_cnt,\n\t\t\t max_cck->fina_sync_err_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sfd_timeout:\",\n\t\t\t le32_to_cpu(cck->sfd_timeout),\n\t\t\t accum_cck->sfd_timeout, delta_cck->sfd_timeout,\n\t\t\t max_cck->sfd_timeout);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"fina_timeout:\",\n\t\t\t le32_to_cpu(cck->fina_timeout),\n\t\t\t accum_cck->fina_timeout, delta_cck->fina_timeout,\n\t\t\t max_cck->fina_timeout);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"unresponded_rts:\",\n\t\t\t le32_to_cpu(cck->unresponded_rts),\n\t\t\t accum_cck->unresponded_rts, delta_cck->unresponded_rts,\n\t\t\t max_cck->unresponded_rts);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"rxe_frame_lmt_ovrun:\",\n\t\t\t le32_to_cpu(cck->rxe_frame_limit_overrun),\n\t\t\t accum_cck->rxe_frame_limit_overrun,\n\t\t\t delta_cck->rxe_frame_limit_overrun,\n\t\t\t max_cck->rxe_frame_limit_overrun);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sent_ack_cnt:\",\n\t\t\t le32_to_cpu(cck->sent_ack_cnt),\n\t\t\t accum_cck->sent_ack_cnt, delta_cck->sent_ack_cnt,\n\t\t\t max_cck->sent_ack_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sent_cts_cnt:\",\n\t\t\t le32_to_cpu(cck->sent_cts_cnt),\n\t\t\t accum_cck->sent_cts_cnt, delta_cck->sent_cts_cnt,\n\t\t\t max_cck->sent_cts_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sent_ba_rsp_cnt:\",\n\t\t\t le32_to_cpu(cck->sent_ba_rsp_cnt),\n\t\t\t accum_cck->sent_ba_rsp_cnt,\n\t\t\t delta_cck->sent_ba_rsp_cnt,\n\t\t\t max_cck->sent_ba_rsp_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"dsp_self_kill:\",\n\t\t\t le32_to_cpu(cck->dsp_self_kill),\n\t\t\t accum_cck->dsp_self_kill, delta_cck->dsp_self_kill,\n\t\t\t max_cck->dsp_self_kill);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"mh_format_err:\",\n\t\t\t le32_to_cpu(cck->mh_format_err),\n\t\t\t accum_cck->mh_format_err, delta_cck->mh_format_err,\n\t\t\t max_cck->mh_format_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"re_acq_main_rssi_sum:\",\n\t\t\t le32_to_cpu(cck->re_acq_main_rssi_sum),\n\t\t\t accum_cck->re_acq_main_rssi_sum,\n\t\t\t delta_cck->re_acq_main_rssi_sum,\n\t\t\t max_cck->re_acq_main_rssi_sum);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_header, \"Statistics_Rx - GENERAL:\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"bogus_cts:\",\n\t\t\t le32_to_cpu(general->bogus_cts),\n\t\t\t accum_general->bogus_cts, delta_general->bogus_cts,\n\t\t\t max_general->bogus_cts);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"bogus_ack:\",\n\t\t\t le32_to_cpu(general->bogus_ack),\n\t\t\t accum_general->bogus_ack, delta_general->bogus_ack,\n\t\t\t max_general->bogus_ack);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"non_bssid_frames:\",\n\t\t\t le32_to_cpu(general->non_bssid_frames),\n\t\t\t accum_general->non_bssid_frames,\n\t\t\t delta_general->non_bssid_frames,\n\t\t\t max_general->non_bssid_frames);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"filtered_frames:\",\n\t\t\t le32_to_cpu(general->filtered_frames),\n\t\t\t accum_general->filtered_frames,\n\t\t\t delta_general->filtered_frames,\n\t\t\t max_general->filtered_frames);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"non_channel_beacons:\",\n\t\t\t le32_to_cpu(general->non_channel_beacons),\n\t\t\t accum_general->non_channel_beacons,\n\t\t\t delta_general->non_channel_beacons,\n\t\t\t max_general->non_channel_beacons);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"channel_beacons:\",\n\t\t\t le32_to_cpu(general->channel_beacons),\n\t\t\t accum_general->channel_beacons,\n\t\t\t delta_general->channel_beacons,\n\t\t\t max_general->channel_beacons);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"num_missed_bcon:\",\n\t\t\t le32_to_cpu(general->num_missed_bcon),\n\t\t\t accum_general->num_missed_bcon,\n\t\t\t delta_general->num_missed_bcon,\n\t\t\t max_general->num_missed_bcon);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"adc_rx_saturation_time:\",\n\t\t\t le32_to_cpu(general->adc_rx_saturation_time),\n\t\t\t accum_general->adc_rx_saturation_time,\n\t\t\t delta_general->adc_rx_saturation_time,\n\t\t\t max_general->adc_rx_saturation_time);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"ina_detect_search_tm:\",\n\t\t\t le32_to_cpu(general->ina_detection_search_time),\n\t\t\t accum_general->ina_detection_search_time,\n\t\t\t delta_general->ina_detection_search_time,\n\t\t\t max_general->ina_detection_search_time);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_silence_rssi_a:\",\n\t\t\t le32_to_cpu(general->beacon_silence_rssi_a),\n\t\t\t accum_general->beacon_silence_rssi_a,\n\t\t\t delta_general->beacon_silence_rssi_a,\n\t\t\t max_general->beacon_silence_rssi_a);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_silence_rssi_b:\",\n\t\t\t le32_to_cpu(general->beacon_silence_rssi_b),\n\t\t\t accum_general->beacon_silence_rssi_b,\n\t\t\t delta_general->beacon_silence_rssi_b,\n\t\t\t max_general->beacon_silence_rssi_b);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_silence_rssi_c:\",\n\t\t\t le32_to_cpu(general->beacon_silence_rssi_c),\n\t\t\t accum_general->beacon_silence_rssi_c,\n\t\t\t delta_general->beacon_silence_rssi_c,\n\t\t\t max_general->beacon_silence_rssi_c);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"interference_data_flag:\",\n\t\t\t le32_to_cpu(general->interference_data_flag),\n\t\t\t accum_general->interference_data_flag,\n\t\t\t delta_general->interference_data_flag,\n\t\t\t max_general->interference_data_flag);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"channel_load:\",\n\t\t\t le32_to_cpu(general->channel_load),\n\t\t\t accum_general->channel_load,\n\t\t\t delta_general->channel_load,\n\t\t\t max_general->channel_load);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"dsp_false_alarms:\",\n\t\t\t le32_to_cpu(general->dsp_false_alarms),\n\t\t\t accum_general->dsp_false_alarms,\n\t\t\t delta_general->dsp_false_alarms,\n\t\t\t max_general->dsp_false_alarms);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_rssi_a:\",\n\t\t\t le32_to_cpu(general->beacon_rssi_a),\n\t\t\t accum_general->beacon_rssi_a,\n\t\t\t delta_general->beacon_rssi_a,\n\t\t\t max_general->beacon_rssi_a);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_rssi_b:\",\n\t\t\t le32_to_cpu(general->beacon_rssi_b),\n\t\t\t accum_general->beacon_rssi_b,\n\t\t\t delta_general->beacon_rssi_b,\n\t\t\t max_general->beacon_rssi_b);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_rssi_c:\",\n\t\t\t le32_to_cpu(general->beacon_rssi_c),\n\t\t\t accum_general->beacon_rssi_c,\n\t\t\t delta_general->beacon_rssi_c,\n\t\t\t max_general->beacon_rssi_c);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_energy_a:\",\n\t\t\t le32_to_cpu(general->beacon_energy_a),\n\t\t\t accum_general->beacon_energy_a,\n\t\t\t delta_general->beacon_energy_a,\n\t\t\t max_general->beacon_energy_a);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_energy_b:\",\n\t\t\t le32_to_cpu(general->beacon_energy_b),\n\t\t\t accum_general->beacon_energy_b,\n\t\t\t delta_general->beacon_energy_b,\n\t\t\t max_general->beacon_energy_b);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"beacon_energy_c:\",\n\t\t\t le32_to_cpu(general->beacon_energy_c),\n\t\t\t accum_general->beacon_energy_c,\n\t\t\t delta_general->beacon_energy_c,\n\t\t\t max_general->beacon_energy_c);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_header, \"Statistics_Rx - OFDM_HT:\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"plcp_err:\",\n\t\t\t le32_to_cpu(ht->plcp_err), accum_ht->plcp_err,\n\t\t\t delta_ht->plcp_err, max_ht->plcp_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"overrun_err:\",\n\t\t\t le32_to_cpu(ht->overrun_err), accum_ht->overrun_err,\n\t\t\t delta_ht->overrun_err, max_ht->overrun_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"early_overrun_err:\",\n\t\t\t le32_to_cpu(ht->early_overrun_err),\n\t\t\t accum_ht->early_overrun_err,\n\t\t\t delta_ht->early_overrun_err,\n\t\t\t max_ht->early_overrun_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"crc32_good:\",\n\t\t\t le32_to_cpu(ht->crc32_good), accum_ht->crc32_good,\n\t\t\t delta_ht->crc32_good, max_ht->crc32_good);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"crc32_err:\",\n\t\t\t le32_to_cpu(ht->crc32_err), accum_ht->crc32_err,\n\t\t\t delta_ht->crc32_err, max_ht->crc32_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"mh_format_err:\",\n\t\t\t le32_to_cpu(ht->mh_format_err),\n\t\t\t accum_ht->mh_format_err,\n\t\t\t delta_ht->mh_format_err, max_ht->mh_format_err);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg_crc32_good:\",\n\t\t\t le32_to_cpu(ht->agg_crc32_good),\n\t\t\t accum_ht->agg_crc32_good,\n\t\t\t delta_ht->agg_crc32_good, max_ht->agg_crc32_good);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg_mpdu_cnt:\",\n\t\t\t le32_to_cpu(ht->agg_mpdu_cnt),\n\t\t\t accum_ht->agg_mpdu_cnt,\n\t\t\t delta_ht->agg_mpdu_cnt, max_ht->agg_mpdu_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg_cnt:\",\n\t\t\t le32_to_cpu(ht->agg_cnt), accum_ht->agg_cnt,\n\t\t\t delta_ht->agg_cnt, max_ht->agg_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"unsupport_mcs:\",\n\t\t\t le32_to_cpu(ht->unsupport_mcs),\n\t\t\t accum_ht->unsupport_mcs,\n\t\t\t delta_ht->unsupport_mcs, max_ht->unsupport_mcs);\n\n\tspin_unlock_bh(&priv->statistics.lock);\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_ucode_tx_stats_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tchar *buf;\n\tint bufsz = (sizeof(struct statistics_tx) * 48) + 250;\n\tssize_t ret;\n\tstruct statistics_tx *tx, *accum_tx, *delta_tx, *max_tx;\n\n\tif (!iwl_is_alive(priv))\n\t\treturn -EAGAIN;\n\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\t \n\tspin_lock_bh(&priv->statistics.lock);\n\n\ttx = &priv->statistics.tx;\n\taccum_tx = &priv->accum_stats.tx;\n\tdelta_tx = &priv->delta_stats.tx;\n\tmax_tx = &priv->max_delta_stats.tx;\n\n\tpos += iwl_statistics_flag(priv, buf, bufsz);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_header, \"Statistics_Tx:\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"preamble:\",\n\t\t\t le32_to_cpu(tx->preamble_cnt),\n\t\t\t accum_tx->preamble_cnt,\n\t\t\t delta_tx->preamble_cnt, max_tx->preamble_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"rx_detected_cnt:\",\n\t\t\t le32_to_cpu(tx->rx_detected_cnt),\n\t\t\t accum_tx->rx_detected_cnt,\n\t\t\t delta_tx->rx_detected_cnt, max_tx->rx_detected_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"bt_prio_defer_cnt:\",\n\t\t\t le32_to_cpu(tx->bt_prio_defer_cnt),\n\t\t\t accum_tx->bt_prio_defer_cnt,\n\t\t\t delta_tx->bt_prio_defer_cnt,\n\t\t\t max_tx->bt_prio_defer_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"bt_prio_kill_cnt:\",\n\t\t\t le32_to_cpu(tx->bt_prio_kill_cnt),\n\t\t\t accum_tx->bt_prio_kill_cnt,\n\t\t\t delta_tx->bt_prio_kill_cnt,\n\t\t\t max_tx->bt_prio_kill_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"few_bytes_cnt:\",\n\t\t\t le32_to_cpu(tx->few_bytes_cnt),\n\t\t\t accum_tx->few_bytes_cnt,\n\t\t\t delta_tx->few_bytes_cnt, max_tx->few_bytes_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"cts_timeout:\",\n\t\t\t le32_to_cpu(tx->cts_timeout), accum_tx->cts_timeout,\n\t\t\t delta_tx->cts_timeout, max_tx->cts_timeout);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"ack_timeout:\",\n\t\t\t le32_to_cpu(tx->ack_timeout),\n\t\t\t accum_tx->ack_timeout,\n\t\t\t delta_tx->ack_timeout, max_tx->ack_timeout);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"expected_ack_cnt:\",\n\t\t\t le32_to_cpu(tx->expected_ack_cnt),\n\t\t\t accum_tx->expected_ack_cnt,\n\t\t\t delta_tx->expected_ack_cnt,\n\t\t\t max_tx->expected_ack_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"actual_ack_cnt:\",\n\t\t\t le32_to_cpu(tx->actual_ack_cnt),\n\t\t\t accum_tx->actual_ack_cnt,\n\t\t\t delta_tx->actual_ack_cnt,\n\t\t\t max_tx->actual_ack_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"dump_msdu_cnt:\",\n\t\t\t le32_to_cpu(tx->dump_msdu_cnt),\n\t\t\t accum_tx->dump_msdu_cnt,\n\t\t\t delta_tx->dump_msdu_cnt,\n\t\t\t max_tx->dump_msdu_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"abort_nxt_frame_mismatch:\",\n\t\t\t le32_to_cpu(tx->burst_abort_next_frame_mismatch_cnt),\n\t\t\t accum_tx->burst_abort_next_frame_mismatch_cnt,\n\t\t\t delta_tx->burst_abort_next_frame_mismatch_cnt,\n\t\t\t max_tx->burst_abort_next_frame_mismatch_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"abort_missing_nxt_frame:\",\n\t\t\t le32_to_cpu(tx->burst_abort_missing_next_frame_cnt),\n\t\t\t accum_tx->burst_abort_missing_next_frame_cnt,\n\t\t\t delta_tx->burst_abort_missing_next_frame_cnt,\n\t\t\t max_tx->burst_abort_missing_next_frame_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"cts_timeout_collision:\",\n\t\t\t le32_to_cpu(tx->cts_timeout_collision),\n\t\t\t accum_tx->cts_timeout_collision,\n\t\t\t delta_tx->cts_timeout_collision,\n\t\t\t max_tx->cts_timeout_collision);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"ack_ba_timeout_collision:\",\n\t\t\t le32_to_cpu(tx->ack_or_ba_timeout_collision),\n\t\t\t accum_tx->ack_or_ba_timeout_collision,\n\t\t\t delta_tx->ack_or_ba_timeout_collision,\n\t\t\t max_tx->ack_or_ba_timeout_collision);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg ba_timeout:\",\n\t\t\t le32_to_cpu(tx->agg.ba_timeout),\n\t\t\t accum_tx->agg.ba_timeout,\n\t\t\t delta_tx->agg.ba_timeout,\n\t\t\t max_tx->agg.ba_timeout);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg ba_resched_frames:\",\n\t\t\t le32_to_cpu(tx->agg.ba_reschedule_frames),\n\t\t\t accum_tx->agg.ba_reschedule_frames,\n\t\t\t delta_tx->agg.ba_reschedule_frames,\n\t\t\t max_tx->agg.ba_reschedule_frames);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg scd_query_agg_frame:\",\n\t\t\t le32_to_cpu(tx->agg.scd_query_agg_frame_cnt),\n\t\t\t accum_tx->agg.scd_query_agg_frame_cnt,\n\t\t\t delta_tx->agg.scd_query_agg_frame_cnt,\n\t\t\t max_tx->agg.scd_query_agg_frame_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg scd_query_no_agg:\",\n\t\t\t le32_to_cpu(tx->agg.scd_query_no_agg),\n\t\t\t accum_tx->agg.scd_query_no_agg,\n\t\t\t delta_tx->agg.scd_query_no_agg,\n\t\t\t max_tx->agg.scd_query_no_agg);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg scd_query_agg:\",\n\t\t\t le32_to_cpu(tx->agg.scd_query_agg),\n\t\t\t accum_tx->agg.scd_query_agg,\n\t\t\t delta_tx->agg.scd_query_agg,\n\t\t\t max_tx->agg.scd_query_agg);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg scd_query_mismatch:\",\n\t\t\t le32_to_cpu(tx->agg.scd_query_mismatch),\n\t\t\t accum_tx->agg.scd_query_mismatch,\n\t\t\t delta_tx->agg.scd_query_mismatch,\n\t\t\t max_tx->agg.scd_query_mismatch);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg frame_not_ready:\",\n\t\t\t le32_to_cpu(tx->agg.frame_not_ready),\n\t\t\t accum_tx->agg.frame_not_ready,\n\t\t\t delta_tx->agg.frame_not_ready,\n\t\t\t max_tx->agg.frame_not_ready);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg underrun:\",\n\t\t\t le32_to_cpu(tx->agg.underrun),\n\t\t\t accum_tx->agg.underrun,\n\t\t\t delta_tx->agg.underrun, max_tx->agg.underrun);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg bt_prio_kill:\",\n\t\t\t le32_to_cpu(tx->agg.bt_prio_kill),\n\t\t\t accum_tx->agg.bt_prio_kill,\n\t\t\t delta_tx->agg.bt_prio_kill,\n\t\t\t max_tx->agg.bt_prio_kill);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"agg rx_ba_rsp_cnt:\",\n\t\t\t le32_to_cpu(tx->agg.rx_ba_rsp_cnt),\n\t\t\t accum_tx->agg.rx_ba_rsp_cnt,\n\t\t\t delta_tx->agg.rx_ba_rsp_cnt,\n\t\t\t max_tx->agg.rx_ba_rsp_cnt);\n\n\tif (tx->tx_power.ant_a || tx->tx_power.ant_b || tx->tx_power.ant_c) {\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"tx power: (1/2 dB step)\\n\");\n\t\tif ((priv->nvm_data->valid_tx_ant & ANT_A) &&\n\t\t    tx->tx_power.ant_a)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\tfmt_hex, \"antenna A:\",\n\t\t\t\t\ttx->tx_power.ant_a);\n\t\tif ((priv->nvm_data->valid_tx_ant & ANT_B) &&\n\t\t    tx->tx_power.ant_b)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\tfmt_hex, \"antenna B:\",\n\t\t\t\t\ttx->tx_power.ant_b);\n\t\tif ((priv->nvm_data->valid_tx_ant & ANT_C) &&\n\t\t    tx->tx_power.ant_c)\n\t\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\t\tfmt_hex, \"antenna C:\",\n\t\t\t\t\ttx->tx_power.ant_c);\n\t}\n\n\tspin_unlock_bh(&priv->statistics.lock);\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_ucode_general_stats_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tchar *buf;\n\tint bufsz = sizeof(struct statistics_general) * 10 + 300;\n\tssize_t ret;\n\tstruct statistics_general_common *general, *accum_general;\n\tstruct statistics_general_common *delta_general, *max_general;\n\tstruct statistics_dbg *dbg, *accum_dbg, *delta_dbg, *max_dbg;\n\tstruct statistics_div *div, *accum_div, *delta_div, *max_div;\n\n\tif (!iwl_is_alive(priv))\n\t\treturn -EAGAIN;\n\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\t \n\n\tspin_lock_bh(&priv->statistics.lock);\n\n\tgeneral = &priv->statistics.common;\n\tdbg = &priv->statistics.common.dbg;\n\tdiv = &priv->statistics.common.div;\n\taccum_general = &priv->accum_stats.common;\n\taccum_dbg = &priv->accum_stats.common.dbg;\n\taccum_div = &priv->accum_stats.common.div;\n\tdelta_general = &priv->delta_stats.common;\n\tmax_general = &priv->max_delta_stats.common;\n\tdelta_dbg = &priv->delta_stats.common.dbg;\n\tmax_dbg = &priv->max_delta_stats.common.dbg;\n\tdelta_div = &priv->delta_stats.common.div;\n\tmax_div = &priv->max_delta_stats.common.div;\n\n\tpos += iwl_statistics_flag(priv, buf, bufsz);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_header, \"Statistics_General:\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_value, \"temperature:\",\n\t\t\t le32_to_cpu(general->temperature));\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_value, \"temperature_m:\",\n\t\t\t le32_to_cpu(general->temperature_m));\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_value, \"ttl_timestamp:\",\n\t\t\t le32_to_cpu(general->ttl_timestamp));\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"burst_check:\",\n\t\t\t le32_to_cpu(dbg->burst_check),\n\t\t\t accum_dbg->burst_check,\n\t\t\t delta_dbg->burst_check, max_dbg->burst_check);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"burst_count:\",\n\t\t\t le32_to_cpu(dbg->burst_count),\n\t\t\t accum_dbg->burst_count,\n\t\t\t delta_dbg->burst_count, max_dbg->burst_count);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"wait_for_silence_timeout_count:\",\n\t\t\t le32_to_cpu(dbg->wait_for_silence_timeout_cnt),\n\t\t\t accum_dbg->wait_for_silence_timeout_cnt,\n\t\t\t delta_dbg->wait_for_silence_timeout_cnt,\n\t\t\t max_dbg->wait_for_silence_timeout_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"sleep_time:\",\n\t\t\t le32_to_cpu(general->sleep_time),\n\t\t\t accum_general->sleep_time,\n\t\t\t delta_general->sleep_time, max_general->sleep_time);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"slots_out:\",\n\t\t\t le32_to_cpu(general->slots_out),\n\t\t\t accum_general->slots_out,\n\t\t\t delta_general->slots_out, max_general->slots_out);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"slots_idle:\",\n\t\t\t le32_to_cpu(general->slots_idle),\n\t\t\t accum_general->slots_idle,\n\t\t\t delta_general->slots_idle, max_general->slots_idle);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"tx_on_a:\",\n\t\t\t le32_to_cpu(div->tx_on_a), accum_div->tx_on_a,\n\t\t\t delta_div->tx_on_a, max_div->tx_on_a);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"tx_on_b:\",\n\t\t\t le32_to_cpu(div->tx_on_b), accum_div->tx_on_b,\n\t\t\t delta_div->tx_on_b, max_div->tx_on_b);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"exec_time:\",\n\t\t\t le32_to_cpu(div->exec_time), accum_div->exec_time,\n\t\t\t delta_div->exec_time, max_div->exec_time);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"probe_time:\",\n\t\t\t le32_to_cpu(div->probe_time), accum_div->probe_time,\n\t\t\t delta_div->probe_time, max_div->probe_time);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"rx_enable_counter:\",\n\t\t\t le32_to_cpu(general->rx_enable_counter),\n\t\t\t accum_general->rx_enable_counter,\n\t\t\t delta_general->rx_enable_counter,\n\t\t\t max_general->rx_enable_counter);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t fmt_table, \"num_of_sos_states:\",\n\t\t\t le32_to_cpu(general->num_of_sos_states),\n\t\t\t accum_general->num_of_sos_states,\n\t\t\t delta_general->num_of_sos_states,\n\t\t\t max_general->num_of_sos_states);\n\n\tspin_unlock_bh(&priv->statistics.lock);\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_ucode_bt_stats_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = (struct iwl_priv *)file->private_data;\n\tint pos = 0;\n\tchar *buf;\n\tint bufsz = (sizeof(struct statistics_bt_activity) * 24) + 200;\n\tssize_t ret;\n\tstruct statistics_bt_activity *bt, *accum_bt;\n\n\tif (!iwl_is_alive(priv))\n\t\treturn -EAGAIN;\n\n\tif (!priv->bt_enable_flag)\n\t\treturn -EINVAL;\n\n\t \n\tmutex_lock(&priv->mutex);\n\tret = iwl_send_statistics_request(priv, 0, false);\n\tmutex_unlock(&priv->mutex);\n\n\tif (ret)\n\t\treturn -EAGAIN;\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\t \n\n\tspin_lock_bh(&priv->statistics.lock);\n\n\tbt = &priv->statistics.bt_activity;\n\taccum_bt = &priv->accum_stats.bt_activity;\n\n\tpos += iwl_statistics_flag(priv, buf, bufsz);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"Statistics_BT:\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"\\t\\t\\tcurrent\\t\\t\\taccumulative\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"hi_priority_tx_req_cnt:\\t\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->hi_priority_tx_req_cnt),\n\t\t\t accum_bt->hi_priority_tx_req_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"hi_priority_tx_denied_cnt:\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->hi_priority_tx_denied_cnt),\n\t\t\t accum_bt->hi_priority_tx_denied_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"lo_priority_tx_req_cnt:\\t\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->lo_priority_tx_req_cnt),\n\t\t\t accum_bt->lo_priority_tx_req_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"lo_priority_tx_denied_cnt:\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->lo_priority_tx_denied_cnt),\n\t\t\t accum_bt->lo_priority_tx_denied_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"hi_priority_rx_req_cnt:\\t\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->hi_priority_rx_req_cnt),\n\t\t\t accum_bt->hi_priority_rx_req_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"hi_priority_rx_denied_cnt:\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->hi_priority_rx_denied_cnt),\n\t\t\t accum_bt->hi_priority_rx_denied_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"lo_priority_rx_req_cnt:\\t\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->lo_priority_rx_req_cnt),\n\t\t\t accum_bt->lo_priority_rx_req_cnt);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"lo_priority_rx_denied_cnt:\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(bt->lo_priority_rx_denied_cnt),\n\t\t\t accum_bt->lo_priority_rx_denied_cnt);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"(rx)num_bt_kills:\\t\\t%u\\t\\t\\t%u\\n\",\n\t\t\t le32_to_cpu(priv->statistics.num_bt_kills),\n\t\t\t priv->statistics.accum_num_bt_kills);\n\n\tspin_unlock_bh(&priv->statistics.lock);\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_reply_tx_error_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = (struct iwl_priv *)file->private_data;\n\tint pos = 0;\n\tchar *buf;\n\tint bufsz = (sizeof(struct reply_tx_error_statistics) * 24) +\n\t\t(sizeof(struct reply_agg_tx_error_statistics) * 24) + 200;\n\tssize_t ret;\n\n\tif (!iwl_is_alive(priv))\n\t\treturn -EAGAIN;\n\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"Statistics_TX_Error:\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_POSTPONE_DELAY),\n\t\t\t priv->reply_tx_stats.pp_delay);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_POSTPONE_FEW_BYTES),\n\t\t\t priv->reply_tx_stats.pp_few_bytes);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_POSTPONE_BT_PRIO),\n\t\t\t priv->reply_tx_stats.pp_bt_prio);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_POSTPONE_QUIET_PERIOD),\n\t\t\t priv->reply_tx_stats.pp_quiet_period);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_POSTPONE_CALC_TTAK),\n\t\t\t priv->reply_tx_stats.pp_calc_ttak);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(\n\t\t\t\tTX_STATUS_FAIL_INTERNAL_CROSSED_RETRY),\n\t\t\t priv->reply_tx_stats.int_crossed_retry);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_SHORT_LIMIT),\n\t\t\t priv->reply_tx_stats.short_limit);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_LONG_LIMIT),\n\t\t\t priv->reply_tx_stats.long_limit);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_FIFO_UNDERRUN),\n\t\t\t priv->reply_tx_stats.fifo_underrun);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_DRAIN_FLOW),\n\t\t\t priv->reply_tx_stats.drain_flow);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_RFKILL_FLUSH),\n\t\t\t priv->reply_tx_stats.rfkill_flush);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_LIFE_EXPIRE),\n\t\t\t priv->reply_tx_stats.life_expire);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_DEST_PS),\n\t\t\t priv->reply_tx_stats.dest_ps);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_HOST_ABORTED),\n\t\t\t priv->reply_tx_stats.host_abort);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_BT_RETRY),\n\t\t\t priv->reply_tx_stats.pp_delay);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_STA_INVALID),\n\t\t\t priv->reply_tx_stats.sta_invalid);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_FRAG_DROPPED),\n\t\t\t priv->reply_tx_stats.frag_drop);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_TID_DISABLE),\n\t\t\t priv->reply_tx_stats.tid_disable);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_FIFO_FLUSHED),\n\t\t\t priv->reply_tx_stats.fifo_flush);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(\n\t\t\t\tTX_STATUS_FAIL_INSUFFICIENT_CF_POLL),\n\t\t\t priv->reply_tx_stats.insuff_cf_poll);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(TX_STATUS_FAIL_PASSIVE_NO_RX),\n\t\t\t priv->reply_tx_stats.fail_hw_drop);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t%u\\n\",\n\t\t\t iwl_get_tx_fail_reason(\n\t\t\t\tTX_STATUS_FAIL_NO_BEACON_ON_RADAR),\n\t\t\t priv->reply_tx_stats.sta_color_mismatch);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"UNKNOWN:\\t\\t\\t%u\\n\",\n\t\t\t priv->reply_tx_stats.unknown);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"\\nStatistics_Agg_TX_Error:\\n\");\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_UNDERRUN_MSK),\n\t\t\t priv->reply_agg_tx_stats.underrun);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_BT_PRIO_MSK),\n\t\t\t priv->reply_agg_tx_stats.bt_prio);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_FEW_BYTES_MSK),\n\t\t\t priv->reply_agg_tx_stats.few_bytes);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_ABORT_MSK),\n\t\t\t priv->reply_agg_tx_stats.abort);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(\n\t\t\t\tAGG_TX_STATE_LAST_SENT_TTL_MSK),\n\t\t\t priv->reply_agg_tx_stats.last_sent_ttl);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(\n\t\t\t\tAGG_TX_STATE_LAST_SENT_TRY_CNT_MSK),\n\t\t\t priv->reply_agg_tx_stats.last_sent_try);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(\n\t\t\t\tAGG_TX_STATE_LAST_SENT_BT_KILL_MSK),\n\t\t\t priv->reply_agg_tx_stats.last_sent_bt_kill);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_SCD_QUERY_MSK),\n\t\t\t priv->reply_agg_tx_stats.scd_query);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(\n\t\t\t\tAGG_TX_STATE_TEST_BAD_CRC32_MSK),\n\t\t\t priv->reply_agg_tx_stats.bad_crc32);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_RESPONSE_MSK),\n\t\t\t priv->reply_agg_tx_stats.response);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_DUMP_TX_MSK),\n\t\t\t priv->reply_agg_tx_stats.dump_tx);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s:\\t\\t\\t%u\\n\",\n\t\t\t iwl_get_agg_tx_fail_reason(AGG_TX_STATE_DELAY_TX_MSK),\n\t\t\t priv->reply_agg_tx_stats.delay_tx);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"UNKNOWN:\\t\\t\\t%u\\n\",\n\t\t\t priv->reply_agg_tx_stats.unknown);\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_sensitivity_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tint cnt = 0;\n\tchar *buf;\n\tint bufsz = sizeof(struct iwl_sensitivity_data) * 4 + 100;\n\tssize_t ret;\n\tstruct iwl_sensitivity_data *data;\n\n\tdata = &priv->sensitivity_data;\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"auto_corr_ofdm:\\t\\t\\t %u\\n\",\n\t\t\tdata->auto_corr_ofdm);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"auto_corr_ofdm_mrc:\\t\\t %u\\n\",\n\t\t\tdata->auto_corr_ofdm_mrc);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"auto_corr_ofdm_x1:\\t\\t %u\\n\",\n\t\t\tdata->auto_corr_ofdm_x1);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"auto_corr_ofdm_mrc_x1:\\t\\t %u\\n\",\n\t\t\tdata->auto_corr_ofdm_mrc_x1);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"auto_corr_cck:\\t\\t\\t %u\\n\",\n\t\t\tdata->auto_corr_cck);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"auto_corr_cck_mrc:\\t\\t %u\\n\",\n\t\t\tdata->auto_corr_cck_mrc);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"last_bad_plcp_cnt_ofdm:\\t\\t %u\\n\",\n\t\t\tdata->last_bad_plcp_cnt_ofdm);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"last_fa_cnt_ofdm:\\t\\t %u\\n\",\n\t\t\tdata->last_fa_cnt_ofdm);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"last_bad_plcp_cnt_cck:\\t\\t %u\\n\",\n\t\t\tdata->last_bad_plcp_cnt_cck);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"last_fa_cnt_cck:\\t\\t %u\\n\",\n\t\t\tdata->last_fa_cnt_cck);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_curr_state:\\t\\t\\t %u\\n\",\n\t\t\tdata->nrg_curr_state);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_prev_state:\\t\\t\\t %u\\n\",\n\t\t\tdata->nrg_prev_state);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_value:\\t\\t\\t\");\n\tfor (cnt = 0; cnt < 10; cnt++) {\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \" %u\",\n\t\t\t\tdata->nrg_value[cnt]);\n\t}\n\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_silence_rssi:\\t\\t\");\n\tfor (cnt = 0; cnt < NRG_NUM_PREV_STAT_L; cnt++) {\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \" %u\",\n\t\t\t\tdata->nrg_silence_rssi[cnt]);\n\t}\n\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_silence_ref:\\t\\t %u\\n\",\n\t\t\tdata->nrg_silence_ref);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_energy_idx:\\t\\t\\t %u\\n\",\n\t\t\tdata->nrg_energy_idx);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_silence_idx:\\t\\t %u\\n\",\n\t\t\tdata->nrg_silence_idx);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_th_cck:\\t\\t\\t %u\\n\",\n\t\t\tdata->nrg_th_cck);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"nrg_auto_corr_silence_diff:\\t %u\\n\",\n\t\t\tdata->nrg_auto_corr_silence_diff);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"num_in_cck_no_fa:\\t\\t %u\\n\",\n\t\t\tdata->num_in_cck_no_fa);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"nrg_th_ofdm:\\t\\t\\t %u\\n\",\n\t\t\tdata->nrg_th_ofdm);\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\n\nstatic ssize_t iwl_dbgfs_chain_noise_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tint cnt = 0;\n\tchar *buf;\n\tint bufsz = sizeof(struct iwl_chain_noise_data) * 4 + 100;\n\tssize_t ret;\n\tstruct iwl_chain_noise_data *data;\n\n\tdata = &priv->chain_noise_data;\n\tbuf = kzalloc(bufsz, GFP_KERNEL);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"active_chains:\\t\\t\\t %u\\n\",\n\t\t\tdata->active_chains);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"chain_noise_a:\\t\\t\\t %u\\n\",\n\t\t\tdata->chain_noise_a);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"chain_noise_b:\\t\\t\\t %u\\n\",\n\t\t\tdata->chain_noise_b);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"chain_noise_c:\\t\\t\\t %u\\n\",\n\t\t\tdata->chain_noise_c);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"chain_signal_a:\\t\\t\\t %u\\n\",\n\t\t\tdata->chain_signal_a);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"chain_signal_b:\\t\\t\\t %u\\n\",\n\t\t\tdata->chain_signal_b);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"chain_signal_c:\\t\\t\\t %u\\n\",\n\t\t\tdata->chain_signal_c);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"beacon_count:\\t\\t\\t %u\\n\",\n\t\t\tdata->beacon_count);\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"disconn_array:\\t\\t\\t\");\n\tfor (cnt = 0; cnt < NUM_RX_CHAINS; cnt++) {\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \" %u\",\n\t\t\t\tdata->disconn_array[cnt]);\n\t}\n\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"delta_gain_code:\\t\\t\");\n\tfor (cnt = 0; cnt < NUM_RX_CHAINS; cnt++) {\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \" %u\",\n\t\t\t\tdata->delta_gain_code[cnt]);\n\t}\n\tpos += scnprintf(buf + pos, bufsz - pos, \"\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"radio_write:\\t\\t\\t %u\\n\",\n\t\t\tdata->radio_write);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"state:\\t\\t\\t\\t %u\\n\",\n\t\t\tdata->state);\n\n\tret = simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_power_save_status_read(struct file *file,\n\t\t\t\t\t\t    char __user *user_buf,\n\t\t\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[60];\n\tint pos = 0;\n\tconst size_t bufsz = sizeof(buf);\n\tu32 pwrsave_status;\n\n\tpwrsave_status = iwl_read32(priv->trans, CSR_GP_CNTRL) &\n\t\t\tCSR_GP_REG_POWER_SAVE_STATUS_MSK;\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"Power Save Status: \");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%s\\n\",\n\t\t(pwrsave_status == CSR_GP_REG_NO_POWER_SAVE) ? \"none\" :\n\t\t(pwrsave_status == CSR_GP_REG_MAC_POWER_SAVE) ? \"MAC\" :\n\t\t(pwrsave_status == CSR_GP_REG_PHY_POWER_SAVE) ? \"PHY\" :\n\t\t\"error\");\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_clear_ucode_statistics_write(struct file *file,\n\t\t\t\t\t const char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint clear;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%d\", &clear) != 1)\n\t\treturn -EFAULT;\n\n\t \n\tmutex_lock(&priv->mutex);\n\tiwl_send_statistics_request(priv, 0, true);\n\tmutex_unlock(&priv->mutex);\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_ucode_tracing_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tchar buf[128];\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"ucode trace timer is %s\\n\",\n\t\t\tpriv->event_log.ucode_trace ? \"On\" : \"Off\");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"non_wraps_count:\\t\\t %u\\n\",\n\t\t\tpriv->event_log.non_wraps_count);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"wraps_once_count:\\t\\t %u\\n\",\n\t\t\tpriv->event_log.wraps_once_count);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"wraps_more_count:\\t\\t %u\\n\",\n\t\t\tpriv->event_log.wraps_more_count);\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_ucode_tracing_write(struct file *file,\n\t\t\t\t\t const char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint trace;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%d\", &trace) != 1)\n\t\treturn -EFAULT;\n\n\tif (trace) {\n\t\tpriv->event_log.ucode_trace = true;\n\t\tif (iwl_is_alive(priv)) {\n\t\t\t \n\t\t\tmod_timer(&priv->ucode_trace, jiffies);\n\t\t}\n\t} else {\n\t\tpriv->event_log.ucode_trace = false;\n\t\tdel_timer_sync(&priv->ucode_trace);\n\t}\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_rxon_flags_read(struct file *file,\n\t\t\t\t\t char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint len = 0;\n\tchar buf[20];\n\n\tlen = sprintf(buf, \"0x%04X\\n\",\n\t\tle32_to_cpu(priv->contexts[IWL_RXON_CTX_BSS].active.flags));\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, len);\n}\n\nstatic ssize_t iwl_dbgfs_rxon_filter_flags_read(struct file *file,\n\t\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint len = 0;\n\tchar buf[20];\n\n\tlen = sprintf(buf, \"0x%04X\\n\",\n\t\tle32_to_cpu(priv->contexts[IWL_RXON_CTX_BSS].active.filter_flags));\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, len);\n}\n\nstatic ssize_t iwl_dbgfs_missed_beacon_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tchar buf[12];\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%d\\n\",\n\t\t\tpriv->missed_beacon_threshold);\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_missed_beacon_write(struct file *file,\n\t\t\t\t\t const char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint missed;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%d\", &missed) != 1)\n\t\treturn -EINVAL;\n\n\tif (missed < IWL_MISSED_BEACON_THRESHOLD_MIN ||\n\t    missed > IWL_MISSED_BEACON_THRESHOLD_MAX)\n\t\tpriv->missed_beacon_threshold =\n\t\t\tIWL_MISSED_BEACON_THRESHOLD_DEF;\n\telse\n\t\tpriv->missed_beacon_threshold = missed;\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_plcp_delta_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tchar buf[12];\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"%u\\n\",\n\t\t\tpriv->plcp_delta_threshold);\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_plcp_delta_write(struct file *file,\n\t\t\t\t\tconst char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint plcp;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%d\", &plcp) != 1)\n\t\treturn -EINVAL;\n\tif ((plcp < IWL_MAX_PLCP_ERR_THRESHOLD_MIN) ||\n\t\t(plcp > IWL_MAX_PLCP_ERR_THRESHOLD_MAX))\n\t\tpriv->plcp_delta_threshold =\n\t\t\tIWL_MAX_PLCP_ERR_THRESHOLD_DISABLE;\n\telse\n\t\tpriv->plcp_delta_threshold = plcp;\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_rf_reset_read(struct file *file,\n\t\t\t\t       char __user *user_buf,\n\t\t\t\t       size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tint pos = 0;\n\tchar buf[300];\n\tconst size_t bufsz = sizeof(buf);\n\tstruct iwl_rf_reset *rf_reset = &priv->rf_reset;\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"RF reset statistics\\n\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"\\tnumber of reset request: %d\\n\",\n\t\t\trf_reset->reset_request_count);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"\\tnumber of reset request success: %d\\n\",\n\t\t\trf_reset->reset_success_count);\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t\"\\tnumber of reset request reject: %d\\n\",\n\t\t\trf_reset->reset_reject_count);\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_rf_reset_write(struct file *file,\n\t\t\t\t\tconst char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tint ret;\n\n\tret = iwl_force_rf_reset(priv, true);\n\treturn ret ? ret : count;\n}\n\nstatic ssize_t iwl_dbgfs_txfifo_flush_write(struct file *file,\n\t\t\t\t\tconst char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint flush;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%d\", &flush) != 1)\n\t\treturn -EINVAL;\n\n\tif (iwl_is_rfkill(priv))\n\t\treturn -EFAULT;\n\n\tiwlagn_dev_txfifo_flush(priv);\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_bt_traffic_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = (struct iwl_priv *)file->private_data;\n\tint pos = 0;\n\tchar buf[200];\n\tconst size_t bufsz = sizeof(buf);\n\n\tif (!priv->bt_enable_flag) {\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"BT coex disabled\\n\");\n\t\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n\t}\n\tpos += scnprintf(buf + pos, bufsz - pos, \"BT enable flag: 0x%x\\n\",\n\t\tpriv->bt_enable_flag);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"BT in %s mode\\n\",\n\t\tpriv->bt_full_concurrent ? \"full concurrency\" : \"3-wire\");\n\tpos += scnprintf(buf + pos, bufsz - pos, \"BT status: %s, \"\n\t\t\t \"last traffic notif: %d\\n\",\n\t\tpriv->bt_status ? \"On\" : \"Off\", priv->last_bt_traffic_load);\n\tpos += scnprintf(buf + pos, bufsz - pos, \"ch_announcement: %d, \"\n\t\t\t \"kill_ack_mask: %x, kill_cts_mask: %x\\n\",\n\t\tpriv->bt_ch_announce, priv->kill_ack_mask,\n\t\tpriv->kill_cts_mask);\n\n\tpos += scnprintf(buf + pos, bufsz - pos, \"bluetooth traffic load: \");\n\tswitch (priv->bt_traffic_load) {\n\tcase IWL_BT_COEX_TRAFFIC_LOAD_CONTINUOUS:\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"Continuous\\n\");\n\t\tbreak;\n\tcase IWL_BT_COEX_TRAFFIC_LOAD_HIGH:\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"High\\n\");\n\t\tbreak;\n\tcase IWL_BT_COEX_TRAFFIC_LOAD_LOW:\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"Low\\n\");\n\t\tbreak;\n\tcase IWL_BT_COEX_TRAFFIC_LOAD_NONE:\n\tdefault:\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"None\\n\");\n\t\tbreak;\n\t}\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_protection_mode_read(struct file *file,\n\t\t\t\t\tchar __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = (struct iwl_priv *)file->private_data;\n\n\tint pos = 0;\n\tchar buf[40];\n\tconst size_t bufsz = sizeof(buf);\n\n\tif (priv->cfg->ht_params)\n\t\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"use %s for aggregation\\n\",\n\t\t\t (priv->hw_params.use_rts_for_aggregation) ?\n\t\t\t\t\"rts/cts\" : \"cts-to-self\");\n\telse\n\t\tpos += scnprintf(buf + pos, bufsz - pos, \"N/A\");\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_protection_mode_write(struct file *file,\n\t\t\t\t\tconst char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos) {\n\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\tint rts;\n\n\tif (!priv->cfg->ht_params)\n\t\treturn -EINVAL;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%d\", &rts) != 1)\n\t\treturn -EINVAL;\n\tif (rts)\n\t\tpriv->hw_params.use_rts_for_aggregation = true;\n\telse\n\t\tpriv->hw_params.use_rts_for_aggregation = false;\n\treturn count;\n}\n\nstatic int iwl_cmd_echo_test(struct iwl_priv *priv)\n{\n\tint ret;\n\tstruct iwl_host_cmd cmd = {\n\t\t.id = REPLY_ECHO,\n\t\t.len = { 0 },\n\t};\n\n\tret = iwl_dvm_send_cmd(priv, &cmd);\n\tif (ret)\n\t\tIWL_ERR(priv, \"echo testing fail: 0X%x\\n\", ret);\n\telse\n\t\tIWL_DEBUG_INFO(priv, \"echo testing pass\\n\");\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_echo_test_write(struct file *file,\n\t\t\t\t\tconst char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tint buf_size;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\n\tiwl_cmd_echo_test(priv);\n\treturn count;\n}\n\n#ifdef CONFIG_IWLWIFI_DEBUG\nstatic ssize_t iwl_dbgfs_log_event_read(struct file *file,\n\t\t\t\t\t char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar *buf = NULL;\n\tssize_t ret;\n\n\tret = iwl_dump_nic_event_log(priv, true, &buf);\n\tif (ret > 0)\n\t\tret = simple_read_from_buffer(user_buf, count, ppos, buf, ret);\n\tkfree(buf);\n\treturn ret;\n}\n\nstatic ssize_t iwl_dbgfs_log_event_write(struct file *file,\n\t\t\t\t\tconst char __user *user_buf,\n\t\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tu32 event_log_flag;\n\tchar buf[8];\n\tint buf_size;\n\n\t \n\tif (!iwl_is_ready(priv))\n\t\treturn -EAGAIN;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) -  1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%u\", &event_log_flag) != 1)\n\t\treturn -EFAULT;\n\tif (event_log_flag == 1)\n\t\tiwl_dump_nic_event_log(priv, true, NULL);\n\n\treturn count;\n}\n#endif\n\nstatic ssize_t iwl_dbgfs_calib_disabled_read(struct file *file,\n\t\t\t\t\t char __user *user_buf,\n\t\t\t\t\t size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[120];\n\tint pos = 0;\n\tconst size_t bufsz = sizeof(buf);\n\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"Sensitivity calibrations %s\\n\",\n\t\t\t (priv->calib_disabled &\n\t\t\t\t\tIWL_SENSITIVITY_CALIB_DISABLED) ?\n\t\t\t \"DISABLED\" : \"ENABLED\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"Chain noise calibrations %s\\n\",\n\t\t\t (priv->calib_disabled &\n\t\t\t\t\tIWL_CHAIN_NOISE_CALIB_DISABLED) ?\n\t\t\t \"DISABLED\" : \"ENABLED\");\n\tpos += scnprintf(buf + pos, bufsz - pos,\n\t\t\t \"Tx power calibrations %s\\n\",\n\t\t\t (priv->calib_disabled &\n\t\t\t\t\tIWL_TX_POWER_CALIB_DISABLED) ?\n\t\t\t \"DISABLED\" : \"ENABLED\");\n\n\treturn simple_read_from_buffer(user_buf, count, ppos, buf, pos);\n}\n\nstatic ssize_t iwl_dbgfs_calib_disabled_write(struct file *file,\n\t\t\t\t\t      const char __user *user_buf,\n\t\t\t\t\t      size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tchar buf[8];\n\tu32 calib_disabled;\n\tint buf_size;\n\n\tmemset(buf, 0, sizeof(buf));\n\tbuf_size = min(count, sizeof(buf) - 1);\n\tif (copy_from_user(buf, user_buf, buf_size))\n\t\treturn -EFAULT;\n\tif (sscanf(buf, \"%x\", &calib_disabled) != 1)\n\t\treturn -EFAULT;\n\n\tpriv->calib_disabled = calib_disabled;\n\n\treturn count;\n}\n\nstatic ssize_t iwl_dbgfs_fw_restart_write(struct file *file,\n\t\t\t\t\t  const char __user *user_buf,\n\t\t\t\t\t  size_t count, loff_t *ppos)\n{\n\tstruct iwl_priv *priv = file->private_data;\n\tbool fw_restart = iwlwifi_mod_params.fw_restart;\n\tint __maybe_unused ret;\n\n\tiwlwifi_mod_params.fw_restart = true;\n\n\tmutex_lock(&priv->mutex);\n\n\t \n\tret = iwl_dvm_send_cmd_pdu(priv, REPLY_ERROR, 0, 0, NULL);\n\n\tmutex_unlock(&priv->mutex);\n\n\tiwlwifi_mod_params.fw_restart = fw_restart;\n\n\treturn count;\n}\n\nDEBUGFS_READ_FILE_OPS(ucode_rx_stats);\nDEBUGFS_READ_FILE_OPS(ucode_tx_stats);\nDEBUGFS_READ_FILE_OPS(ucode_general_stats);\nDEBUGFS_READ_FILE_OPS(sensitivity);\nDEBUGFS_READ_FILE_OPS(chain_noise);\nDEBUGFS_READ_FILE_OPS(power_save_status);\nDEBUGFS_WRITE_FILE_OPS(clear_ucode_statistics);\nDEBUGFS_READ_WRITE_FILE_OPS(ucode_tracing);\nDEBUGFS_READ_WRITE_FILE_OPS(missed_beacon);\nDEBUGFS_READ_WRITE_FILE_OPS(plcp_delta);\nDEBUGFS_READ_WRITE_FILE_OPS(rf_reset);\nDEBUGFS_READ_FILE_OPS(rxon_flags);\nDEBUGFS_READ_FILE_OPS(rxon_filter_flags);\nDEBUGFS_WRITE_FILE_OPS(txfifo_flush);\nDEBUGFS_READ_FILE_OPS(ucode_bt_stats);\nDEBUGFS_READ_FILE_OPS(bt_traffic);\nDEBUGFS_READ_WRITE_FILE_OPS(protection_mode);\nDEBUGFS_READ_FILE_OPS(reply_tx_error);\nDEBUGFS_WRITE_FILE_OPS(echo_test);\nDEBUGFS_WRITE_FILE_OPS(fw_restart);\n#ifdef CONFIG_IWLWIFI_DEBUG\nDEBUGFS_READ_WRITE_FILE_OPS(log_event);\n#endif\nDEBUGFS_READ_WRITE_FILE_OPS(calib_disabled);\n\n \nvoid iwl_dbgfs_register(struct iwl_priv *priv, struct dentry *dbgfs_dir)\n{\n\tstruct dentry *dir_data, *dir_rf, *dir_debug;\n\n\tpriv->debugfs_dir = dbgfs_dir;\n\n\tdir_data = debugfs_create_dir(\"data\", dbgfs_dir);\n\tdir_rf = debugfs_create_dir(\"rf\", dbgfs_dir);\n\tdir_debug = debugfs_create_dir(\"debug\", dbgfs_dir);\n\n\tDEBUGFS_ADD_FILE(nvm, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(sram, dir_data, 0600);\n\tDEBUGFS_ADD_FILE(wowlan_sram, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(stations, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(channels, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(status, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(rx_handlers, dir_data, 0600);\n\tDEBUGFS_ADD_FILE(qos, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(sleep_level_override, dir_data, 0600);\n\tDEBUGFS_ADD_FILE(current_sleep_command, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(thermal_throttling, dir_data, 0400);\n\tDEBUGFS_ADD_FILE(disable_ht40, dir_data, 0600);\n\tDEBUGFS_ADD_FILE(temperature, dir_data, 0400);\n\n\tDEBUGFS_ADD_FILE(power_save_status, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(clear_ucode_statistics, dir_debug, 0200);\n\tDEBUGFS_ADD_FILE(missed_beacon, dir_debug, 0200);\n\tDEBUGFS_ADD_FILE(plcp_delta, dir_debug, 0600);\n\tDEBUGFS_ADD_FILE(rf_reset, dir_debug, 0600);\n\tDEBUGFS_ADD_FILE(ucode_rx_stats, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(ucode_tx_stats, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(ucode_general_stats, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(txfifo_flush, dir_debug, 0200);\n\tDEBUGFS_ADD_FILE(protection_mode, dir_debug, 0600);\n\tDEBUGFS_ADD_FILE(sensitivity, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(chain_noise, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(ucode_tracing, dir_debug, 0600);\n\tDEBUGFS_ADD_FILE(ucode_bt_stats, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(reply_tx_error, dir_debug, 0400);\n\tDEBUGFS_ADD_FILE(rxon_flags, dir_debug, 0200);\n\tDEBUGFS_ADD_FILE(rxon_filter_flags, dir_debug, 0200);\n\tDEBUGFS_ADD_FILE(echo_test, dir_debug, 0200);\n\tDEBUGFS_ADD_FILE(fw_restart, dir_debug, 0200);\n#ifdef CONFIG_IWLWIFI_DEBUG\n\tDEBUGFS_ADD_FILE(log_event, dir_debug, 0600);\n#endif\n\n\tif (iwl_advanced_bt_coexist(priv))\n\t\tDEBUGFS_ADD_FILE(bt_traffic, dir_debug, 0400);\n\n\t \n\tDEBUGFS_ADD_FILE(calib_disabled, dir_rf, 0600);\n\n\t \n\tif (priv->mac80211_registered) {\n\t\tchar buf[100];\n\t\tstruct dentry *mac80211_dir, *dev_dir;\n\n\t\tdev_dir = dbgfs_dir->d_parent;\n\t\tmac80211_dir = priv->hw->wiphy->debugfsdir;\n\n\t\tsnprintf(buf, 100, \"../../%pd2\", dev_dir);\n\n\t\tdebugfs_create_symlink(\"iwlwifi\", mac80211_dir, buf);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}