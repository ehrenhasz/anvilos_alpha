{
  "module_name": "rs.h",
  "hash_id": "fd073d3e0b1615fe71c634af8cc9c52169cd075d0222e6dee21275342ce0fd04",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/intel/iwlwifi/mvm/rs.h",
  "human_readable_source": " \n \n\n#ifndef __rs_h__\n#define __rs_h__\n\n#include <net/mac80211.h>\n\n#include \"iwl-config.h\"\n\n#include \"fw-api.h\"\n#include \"iwl-trans.h\"\n\n#define RS_NAME \"iwl-mvm-rs\"\n\nstruct iwl_rs_rate_info {\n\tu8 plcp;\t   \n\tu8 plcp_ht_siso;   \n\tu8 plcp_ht_mimo2;  \n\tu8 plcp_vht_siso;\n\tu8 plcp_vht_mimo2;\n\tu8 prev_rs;       \n\tu8 next_rs;       \n};\n\n#define IWL_RATE_60M_PLCP 3\n\n#define LINK_QUAL_MAX_RETRY_NUM 16\n\nenum {\n\tIWL_RATE_6M_INDEX_TABLE = 0,\n\tIWL_RATE_9M_INDEX_TABLE,\n\tIWL_RATE_12M_INDEX_TABLE,\n\tIWL_RATE_18M_INDEX_TABLE,\n\tIWL_RATE_24M_INDEX_TABLE,\n\tIWL_RATE_36M_INDEX_TABLE,\n\tIWL_RATE_48M_INDEX_TABLE,\n\tIWL_RATE_54M_INDEX_TABLE,\n\tIWL_RATE_1M_INDEX_TABLE,\n\tIWL_RATE_2M_INDEX_TABLE,\n\tIWL_RATE_5M_INDEX_TABLE,\n\tIWL_RATE_11M_INDEX_TABLE,\n\tIWL_RATE_INVM_INDEX_TABLE = IWL_RATE_INVM_INDEX - 1,\n};\n\n \n#define\tIWL_RATE_6M_MASK   (1 << IWL_RATE_6M_INDEX)\n#define\tIWL_RATE_9M_MASK   (1 << IWL_RATE_9M_INDEX)\n#define\tIWL_RATE_12M_MASK  (1 << IWL_RATE_12M_INDEX)\n#define\tIWL_RATE_18M_MASK  (1 << IWL_RATE_18M_INDEX)\n#define\tIWL_RATE_24M_MASK  (1 << IWL_RATE_24M_INDEX)\n#define\tIWL_RATE_36M_MASK  (1 << IWL_RATE_36M_INDEX)\n#define\tIWL_RATE_48M_MASK  (1 << IWL_RATE_48M_INDEX)\n#define\tIWL_RATE_54M_MASK  (1 << IWL_RATE_54M_INDEX)\n#define IWL_RATE_60M_MASK  (1 << IWL_RATE_60M_INDEX)\n#define\tIWL_RATE_1M_MASK   (1 << IWL_RATE_1M_INDEX)\n#define\tIWL_RATE_2M_MASK   (1 << IWL_RATE_2M_INDEX)\n#define\tIWL_RATE_5M_MASK   (1 << IWL_RATE_5M_INDEX)\n#define\tIWL_RATE_11M_MASK  (1 << IWL_RATE_11M_INDEX)\n\n\n \nenum {\n\tIWL_RATE_HT_SISO_MCS_0_PLCP = 0,\n\tIWL_RATE_HT_SISO_MCS_1_PLCP = 1,\n\tIWL_RATE_HT_SISO_MCS_2_PLCP = 2,\n\tIWL_RATE_HT_SISO_MCS_3_PLCP = 3,\n\tIWL_RATE_HT_SISO_MCS_4_PLCP = 4,\n\tIWL_RATE_HT_SISO_MCS_5_PLCP = 5,\n\tIWL_RATE_HT_SISO_MCS_6_PLCP = 6,\n\tIWL_RATE_HT_SISO_MCS_7_PLCP = 7,\n\tIWL_RATE_HT_MIMO2_MCS_0_PLCP = 0x8,\n\tIWL_RATE_HT_MIMO2_MCS_1_PLCP = 0x9,\n\tIWL_RATE_HT_MIMO2_MCS_2_PLCP = 0xA,\n\tIWL_RATE_HT_MIMO2_MCS_3_PLCP = 0xB,\n\tIWL_RATE_HT_MIMO2_MCS_4_PLCP = 0xC,\n\tIWL_RATE_HT_MIMO2_MCS_5_PLCP = 0xD,\n\tIWL_RATE_HT_MIMO2_MCS_6_PLCP = 0xE,\n\tIWL_RATE_HT_MIMO2_MCS_7_PLCP = 0xF,\n\tIWL_RATE_VHT_SISO_MCS_0_PLCP = 0,\n\tIWL_RATE_VHT_SISO_MCS_1_PLCP = 1,\n\tIWL_RATE_VHT_SISO_MCS_2_PLCP = 2,\n\tIWL_RATE_VHT_SISO_MCS_3_PLCP = 3,\n\tIWL_RATE_VHT_SISO_MCS_4_PLCP = 4,\n\tIWL_RATE_VHT_SISO_MCS_5_PLCP = 5,\n\tIWL_RATE_VHT_SISO_MCS_6_PLCP = 6,\n\tIWL_RATE_VHT_SISO_MCS_7_PLCP = 7,\n\tIWL_RATE_VHT_SISO_MCS_8_PLCP = 8,\n\tIWL_RATE_VHT_SISO_MCS_9_PLCP = 9,\n\tIWL_RATE_VHT_MIMO2_MCS_0_PLCP = 0x10,\n\tIWL_RATE_VHT_MIMO2_MCS_1_PLCP = 0x11,\n\tIWL_RATE_VHT_MIMO2_MCS_2_PLCP = 0x12,\n\tIWL_RATE_VHT_MIMO2_MCS_3_PLCP = 0x13,\n\tIWL_RATE_VHT_MIMO2_MCS_4_PLCP = 0x14,\n\tIWL_RATE_VHT_MIMO2_MCS_5_PLCP = 0x15,\n\tIWL_RATE_VHT_MIMO2_MCS_6_PLCP = 0x16,\n\tIWL_RATE_VHT_MIMO2_MCS_7_PLCP = 0x17,\n\tIWL_RATE_VHT_MIMO2_MCS_8_PLCP = 0x18,\n\tIWL_RATE_VHT_MIMO2_MCS_9_PLCP = 0x19,\n\tIWL_RATE_HT_SISO_MCS_INV_PLCP,\n\tIWL_RATE_HT_MIMO2_MCS_INV_PLCP = IWL_RATE_HT_SISO_MCS_INV_PLCP,\n\tIWL_RATE_VHT_SISO_MCS_INV_PLCP = IWL_RATE_HT_SISO_MCS_INV_PLCP,\n\tIWL_RATE_VHT_MIMO2_MCS_INV_PLCP = IWL_RATE_HT_SISO_MCS_INV_PLCP,\n\tIWL_RATE_HT_SISO_MCS_8_PLCP = IWL_RATE_HT_SISO_MCS_INV_PLCP,\n\tIWL_RATE_HT_SISO_MCS_9_PLCP = IWL_RATE_HT_SISO_MCS_INV_PLCP,\n\tIWL_RATE_HT_MIMO2_MCS_8_PLCP = IWL_RATE_HT_SISO_MCS_INV_PLCP,\n\tIWL_RATE_HT_MIMO2_MCS_9_PLCP = IWL_RATE_HT_SISO_MCS_INV_PLCP,\n};\n\n#define IWL_RATES_MASK ((1 << IWL_RATE_COUNT) - 1)\n\n#define IWL_INVALID_VALUE    -1\n\n#define TPC_MAX_REDUCTION\t\t15\n#define TPC_NO_REDUCTION\t\t0\n#define TPC_INVALID\t\t\t0xff\n\n#define LINK_QUAL_AGG_FRAME_LIMIT_DEF\t(63)\n#define LINK_QUAL_AGG_FRAME_LIMIT_MAX\t(63)\n \n#define LINK_QUAL_AGG_FRAME_LIMIT_GEN2_DEF\t(255)\n#define LINK_QUAL_AGG_FRAME_LIMIT_GEN2_MAX\t(255)\n#define LINK_QUAL_AGG_FRAME_LIMIT_MIN\t(0)\n\n#define LQ_SIZE\t\t2\t \n\n \n#define IWL_AGG_TPT_THREHOLD\t0\n#define IWL_AGG_ALL_TID\t\t0xff\n\nenum iwl_table_type {\n\tLQ_NONE,\n\tLQ_LEGACY_G,\t \n\tLQ_LEGACY_A,\n\tLQ_HT_SISO,\t \n\tLQ_HT_MIMO2,\n\tLQ_VHT_SISO,     \n\tLQ_VHT_MIMO2,\n\tLQ_HE_SISO,      \n\tLQ_HE_MIMO2,\n\tLQ_MAX,\n};\n\nstruct rs_rate {\n\tint index;\n\tenum iwl_table_type type;\n\tu8 ant;\n\tu32 bw;\n\tbool sgi;\n\tbool ldpc;\n\tbool stbc;\n\tbool bfer;\n};\n\n\n#define is_type_legacy(type) (((type) == LQ_LEGACY_G) || \\\n\t\t\t      ((type) == LQ_LEGACY_A))\n#define is_type_ht_siso(type) ((type) == LQ_HT_SISO)\n#define is_type_ht_mimo2(type) ((type) == LQ_HT_MIMO2)\n#define is_type_vht_siso(type) ((type) == LQ_VHT_SISO)\n#define is_type_vht_mimo2(type) ((type) == LQ_VHT_MIMO2)\n#define is_type_he_siso(type) ((type) == LQ_HE_SISO)\n#define is_type_he_mimo2(type) ((type) == LQ_HE_MIMO2)\n#define is_type_siso(type) (is_type_ht_siso(type) || is_type_vht_siso(type) || \\\n\t\t\t    is_type_he_siso(type))\n#define is_type_mimo2(type) (is_type_ht_mimo2(type) || \\\n\t\t\t     is_type_vht_mimo2(type) || is_type_he_mimo2(type))\n#define is_type_mimo(type) (is_type_mimo2(type))\n#define is_type_ht(type) (is_type_ht_siso(type) || is_type_ht_mimo2(type))\n#define is_type_vht(type) (is_type_vht_siso(type) || is_type_vht_mimo2(type))\n#define is_type_he(type) (is_type_he_siso(type) || is_type_he_mimo2(type))\n#define is_type_a_band(type) ((type) == LQ_LEGACY_A)\n#define is_type_g_band(type) ((type) == LQ_LEGACY_G)\n\n#define is_legacy(rate)       is_type_legacy((rate)->type)\n#define is_ht_siso(rate)      is_type_ht_siso((rate)->type)\n#define is_ht_mimo2(rate)     is_type_ht_mimo2((rate)->type)\n#define is_vht_siso(rate)     is_type_vht_siso((rate)->type)\n#define is_vht_mimo2(rate)    is_type_vht_mimo2((rate)->type)\n#define is_siso(rate)         is_type_siso((rate)->type)\n#define is_mimo2(rate)        is_type_mimo2((rate)->type)\n#define is_mimo(rate)         is_type_mimo((rate)->type)\n#define is_ht(rate)           is_type_ht((rate)->type)\n#define is_vht(rate)          is_type_vht((rate)->type)\n#define is_he(rate)           is_type_he((rate)->type)\n#define is_a_band(rate)       is_type_a_band((rate)->type)\n#define is_g_band(rate)       is_type_g_band((rate)->type)\n\n#define is_ht20(rate)         ((rate)->bw == RATE_MCS_CHAN_WIDTH_20)\n#define is_ht40(rate)         ((rate)->bw == RATE_MCS_CHAN_WIDTH_40)\n#define is_ht80(rate)         ((rate)->bw == RATE_MCS_CHAN_WIDTH_80)\n#define is_ht160(rate)        ((rate)->bw == RATE_MCS_CHAN_WIDTH_160)\n\n \n\nstruct iwl_lq_sta_rs_fw {\n\t \n\tu32 last_rate_n_flags;\n\n\t \n\tstruct lq_sta_pers_rs_fw {\n\t\tu32 sta_id;\n#ifdef CONFIG_MAC80211_DEBUGFS\n\t\tu32 dbg_fixed_rate;\n\t\tu16 dbg_agg_frame_count_lim;\n#endif\n\t\tu8 chains;\n\t\ts8 chain_signal[IEEE80211_MAX_CHAINS];\n\t\ts8 last_rssi;\n\t\tstruct iwl_mvm *drv;\n\t} pers;\n};\n\n \nstruct iwl_rate_scale_data {\n\tu64 data;\t\t \n\ts32 success_counter;\t \n\ts32 success_ratio;\t \n\ts32 counter;\t\t \n\ts32 average_tpt;\t \n};\n\n \nenum rs_column {\n\tRS_COLUMN_LEGACY_ANT_A = 0,\n\tRS_COLUMN_LEGACY_ANT_B,\n\tRS_COLUMN_SISO_ANT_A,\n\tRS_COLUMN_SISO_ANT_B,\n\tRS_COLUMN_SISO_ANT_A_SGI,\n\tRS_COLUMN_SISO_ANT_B_SGI,\n\tRS_COLUMN_MIMO2,\n\tRS_COLUMN_MIMO2_SGI,\n\n\tRS_COLUMN_LAST = RS_COLUMN_MIMO2_SGI,\n\tRS_COLUMN_COUNT = RS_COLUMN_LAST + 1,\n\tRS_COLUMN_INVALID,\n};\n\nenum rs_ss_force_opt {\n\tRS_SS_FORCE_NONE = 0,\n\tRS_SS_FORCE_STBC,\n\tRS_SS_FORCE_BFER,\n\tRS_SS_FORCE_SISO,\n};\n\n \nstruct rs_rate_stats {\n\tu64 success;\n\tu64 total;\n};\n\n \nstruct iwl_scale_tbl_info {\n\tstruct rs_rate rate;\n\tenum rs_column column;\n\tconst u16 *expected_tpt;\t \n\tstruct iwl_rate_scale_data win[IWL_RATE_COUNT];  \n\t \n\tstruct iwl_rate_scale_data tpc_win[TPC_MAX_REDUCTION + 1];\n};\n\nenum {\n\tRS_STATE_SEARCH_CYCLE_STARTED,\n\tRS_STATE_SEARCH_CYCLE_ENDED,\n\tRS_STATE_STAY_IN_COLUMN,\n};\n\n \nstruct iwl_lq_sta {\n\tu8 active_tbl;\t\t \n\tu8 rs_state;             \n\tu8 search_better_tbl;\t \n\ts32 last_tpt;\n\n\t \n\tu32 table_count_limit;\n\tu32 max_failure_limit;\t \n\tu32 max_success_limit;\t \n\tu32 table_count;\n\tu32 total_failed;\t \n\tu32 total_success;\t \n\tu64 flush_timer;\t \n\n\tu32 visited_columns;     \n\tu64 last_tx;\n\tbool is_vht;\n\tbool ldpc;               \n\tbool stbc_capable;       \n\tbool bfer_capable;       \n\n\tenum nl80211_band band;\n\n\t \n\tunsigned long active_legacy_rate;\n\tunsigned long active_siso_rate;\n\tunsigned long active_mimo2_rate;\n\n\t \n\tu8 max_legacy_rate_idx;\n\tu8 max_siso_rate_idx;\n\tu8 max_mimo2_rate_idx;\n\n\t \n\tstruct rs_rate optimal_rate;\n\tunsigned long optimal_rate_mask;\n\tconst struct rs_init_rate_info *optimal_rates;\n\tint optimal_nentries;\n\n\tu8 missed_rate_counter;\n\n\tstruct iwl_lq_cmd lq;\n\tstruct iwl_scale_tbl_info lq_info[LQ_SIZE];  \n\tu8 tx_agg_tid_en;\n\n\t \n\tu32 last_rate_n_flags;\n\n\t \n\tu8 is_agg;\n\n\t \n\tint tpc_reduce;\n\n\t \n\tstruct lq_sta_pers {\n#ifdef CONFIG_MAC80211_DEBUGFS\n\t\tu32 dbg_fixed_rate;\n\t\tu8 dbg_fixed_txp_reduction;\n\n\t\t \n\t\tenum rs_ss_force_opt ss_force;\n#endif\n\t\tu8 chains;\n\t\ts8 chain_signal[IEEE80211_MAX_CHAINS];\n\t\ts8 last_rssi;\n\t\tu16 max_agg_bufsize;\n\t\tstruct rs_rate_stats tx_stats[RS_COLUMN_COUNT][IWL_RATE_COUNT];\n\t\tstruct iwl_mvm *drv;\n\t\tspinlock_t lock;  \n\t} pers;\n};\n\n \n#define RS_DRV_DATA_TXP_MSK 0xff\n#define RS_DRV_DATA_LQ_COLOR_POS 8\n#define RS_DRV_DATA_LQ_COLOR_MSK (7 << RS_DRV_DATA_LQ_COLOR_POS)\n#define RS_DRV_DATA_LQ_COLOR_GET(_f) (((_f) & RS_DRV_DATA_LQ_COLOR_MSK) >>\\\n\t\t\t\t      RS_DRV_DATA_LQ_COLOR_POS)\n#define RS_DRV_DATA_PACK(_c, _p) ((void *)(uintptr_t)\\\n\t\t\t\t  (((uintptr_t)_p) |\\\n\t\t\t\t   ((_c) << RS_DRV_DATA_LQ_COLOR_POS)))\n\n \nvoid iwl_mvm_rs_rate_init(struct iwl_mvm *mvm,\n\t\t\t  struct ieee80211_vif *vif,\n\t\t\t  struct ieee80211_sta *sta,\n\t\t\t  struct ieee80211_bss_conf *link_conf,\n\t\t\t  struct ieee80211_link_sta *link_sta,\n\t\t\t  enum nl80211_band band);\n\n \nvoid iwl_mvm_rs_tx_status(struct iwl_mvm *mvm, struct ieee80211_sta *sta,\n\t\t\t  int tid, struct ieee80211_tx_info *info, bool ndp);\n\n \nint iwl_mvm_rate_control_register(void);\n\n \nvoid iwl_mvm_rate_control_unregister(void);\n\nstruct iwl_mvm_sta;\n\nint iwl_mvm_tx_protection(struct iwl_mvm *mvm, struct iwl_mvm_sta *mvmsta,\n\t\t\t  bool enable);\n\n#ifdef CONFIG_IWLWIFI_DEBUGFS\nvoid iwl_mvm_reset_frame_stats(struct iwl_mvm *mvm);\n#endif\n\nstruct iwl_mvm_link_sta;\n\nvoid iwl_mvm_rs_add_sta(struct iwl_mvm *mvm, struct iwl_mvm_sta *mvmsta);\nvoid iwl_mvm_rs_add_sta_link(struct iwl_mvm *mvm,\n\t\t\t     struct iwl_mvm_link_sta *link_sta);\n\nvoid iwl_mvm_rs_fw_rate_init(struct iwl_mvm *mvm,\n\t\t\t     struct ieee80211_vif *vif,\n\t\t\t     struct ieee80211_sta *sta,\n\t\t\t     struct ieee80211_bss_conf *link_conf,\n\t\t\t     struct ieee80211_link_sta *link_sta,\n\t\t\t     enum nl80211_band band);\nint rs_fw_tx_protection(struct iwl_mvm *mvm, struct iwl_mvm_sta *mvmsta,\n\t\t\tbool enable);\nvoid iwl_mvm_tlc_update_notif(struct iwl_mvm *mvm,\n\t\t\t      struct iwl_rx_cmd_buffer *rxb);\n\nu16 rs_fw_get_max_amsdu_len(struct ieee80211_sta *sta,\n\t\t\t    struct ieee80211_bss_conf *link_conf,\n\t\t\t    struct ieee80211_link_sta *link_sta);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}