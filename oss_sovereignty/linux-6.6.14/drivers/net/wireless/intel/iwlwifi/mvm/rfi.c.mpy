{
  "module_name": "rfi.c",
  "hash_id": "50a0e325c65c22cf9d425d37301e555ccce5af59823509e64131dcb05b880146",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/intel/iwlwifi/mvm/rfi.c",
  "human_readable_source": "\n \n\n#include \"mvm.h\"\n#include \"fw/api/commands.h\"\n#include \"fw/api/phy-ctxt.h\"\n\n \nstatic const struct iwl_rfi_lut_entry iwl_rfi_table[IWL_RFI_LUT_SIZE] = {\n\t \n\t{cpu_to_le16(160), {50, 58, 60, 62, 64, 52, 54, 56},\n\t      {PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,\n\t       PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,}},\n\n\t \n\t{cpu_to_le16(176), {149, 151, 153, 157, 159, 161, 165, 163, 167, 169,\n\t\t\t    171, 173, 175},\n\t      {PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,\n\t       PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,\n\t       PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,}},\n\n\t \n\t{cpu_to_le16(192), {79, 81, 83, 85, 87, 89, 91, 93},\n\t      {PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,\n\t       PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,}},\n\n\t \n\t{cpu_to_le16(223), {114, 116, 118, 120, 122, 106, 110, 124, 126},\n\t      {PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,\n\t       PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,}},\n\n\t \n\t{cpu_to_le16(240), {114, 151, 155, 157, 159, 161, 165},\n\t      {PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,\n\t       PHY_BAND_5, PHY_BAND_5,}},\n\n\t \n\t{cpu_to_le16(256), {79, 83, 85, 87, 89, 91, 93,},\n\t       {PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,\n\t\tPHY_BAND_6, PHY_BAND_6,}},\n\n\t \n\t{cpu_to_le16(264), {111, 119, 123, 125, 129, 131, 133, 135, 143,},\n\t      {PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,\n\t       PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,}},\n\n\t \n\t{cpu_to_le16(312), {36, 38, 40, 42, 44, 46, 50,},\n\t       {PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,\n\t\tPHY_BAND_5, PHY_BAND_5,}},\n\n\t \n\t{cpu_to_le16(336), {106, 110, 112, 114, 116, 118, 120, 122},\n\t       {PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5, PHY_BAND_5,\n\t\tPHY_BAND_5, PHY_BAND_5, PHY_BAND_5,}},\n\n\t \n\t{cpu_to_le16(360), {3, 5, 7, 9, 11, 13, 15,},\n\t       {PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,\n\t\tPHY_BAND_6, PHY_BAND_6,}},\n\n\t \n\t{cpu_to_le16(384), {79, 83, 85, 87, 89, 91, 93,},\n\t       {PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6, PHY_BAND_6,\n\t\tPHY_BAND_6, PHY_BAND_6,}},\n};\n\nbool iwl_rfi_supported(struct iwl_mvm *mvm)\n{\n\t \n\treturn false;\n}\n\nint iwl_rfi_send_config_cmd(struct iwl_mvm *mvm, struct iwl_rfi_lut_entry *rfi_table)\n{\n\tint ret;\n\tstruct iwl_rfi_config_cmd cmd;\n\tstruct iwl_host_cmd hcmd = {\n\t\t.id = WIDE_ID(SYSTEM_GROUP, RFI_CONFIG_CMD),\n\t\t.dataflags[0] = IWL_HCMD_DFL_DUP,\n\t\t.data[0] = &cmd,\n\t\t.len[0] = sizeof(cmd),\n\t};\n\n\tif (!iwl_rfi_supported(mvm))\n\t\treturn -EOPNOTSUPP;\n\n\tlockdep_assert_held(&mvm->mutex);\n\n\t \n\tif (!rfi_table) {\n\t\tmemcpy(cmd.table, iwl_rfi_table, sizeof(cmd.table));\n\t} else {\n\t\tmemcpy(cmd.table, rfi_table, sizeof(cmd.table));\n\t\t \n\t\tcmd.oem = 1;\n\t}\n\n\tret = iwl_mvm_send_cmd(mvm, &hcmd);\n\n\tif (ret)\n\t\tIWL_ERR(mvm, \"Failed to send RFI config cmd %d\\n\", ret);\n\n\treturn ret;\n}\n\nstruct iwl_rfi_freq_table_resp_cmd *iwl_rfi_get_freq_table(struct iwl_mvm *mvm)\n{\n\tstruct iwl_rfi_freq_table_resp_cmd *resp;\n\tint resp_size = sizeof(*resp);\n\tint ret;\n\tstruct iwl_host_cmd cmd = {\n\t\t.id = WIDE_ID(SYSTEM_GROUP, RFI_GET_FREQ_TABLE_CMD),\n\t\t.flags = CMD_WANT_SKB,\n\t};\n\n\tif (!iwl_rfi_supported(mvm))\n\t\treturn ERR_PTR(-EOPNOTSUPP);\n\n\tmutex_lock(&mvm->mutex);\n\tret = iwl_mvm_send_cmd(mvm, &cmd);\n\tmutex_unlock(&mvm->mutex);\n\tif (ret)\n\t\treturn ERR_PTR(ret);\n\n\tif (WARN_ON_ONCE(iwl_rx_packet_payload_len(cmd.resp_pkt) != resp_size))\n\t\treturn ERR_PTR(-EIO);\n\n\tresp = kmemdup(cmd.resp_pkt->data, resp_size, GFP_KERNEL);\n\tif (!resp)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tiwl_free_resp(&cmd);\n\treturn resp;\n}\n\nvoid iwl_rfi_deactivate_notif_handler(struct iwl_mvm *mvm,\n\t\t\t\t      struct iwl_rx_cmd_buffer *rxb)\n{\n\tstruct iwl_rx_packet *pkt = rxb_addr(rxb);\n\tstruct iwl_rfi_deactivate_notif *notif = (void *)pkt->data;\n\n\tIWL_INFO(mvm, \"RFIm is deactivated, reason = %d\\n\", notif->reason);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}