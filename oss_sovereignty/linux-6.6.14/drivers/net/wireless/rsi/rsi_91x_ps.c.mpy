{
  "module_name": "rsi_91x_ps.c",
  "hash_id": "0f89f48cae5dadd16ca58efe25acbb8a2d31c5460d494b09a5a1881e6e3e3ae5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/rsi/rsi_91x_ps.c",
  "human_readable_source": " \n\n#include <linux/etherdevice.h>\n#include <linux/if.h>\n#include \"rsi_debugfs.h\"\n#include \"rsi_mgmt.h\"\n#include \"rsi_common.h\"\n#include \"rsi_ps.h\"\n\nchar *str_psstate(enum ps_state state)\n{\n\tswitch (state) {\n\tcase PS_NONE:\n\t\treturn \"PS_NONE\";\n\tcase PS_DISABLE_REQ_SENT:\n\t\treturn \"PS_DISABLE_REQ_SENT\";\n\tcase PS_ENABLE_REQ_SENT:\n\t\treturn \"PS_ENABLE_REQ_SENT\";\n\tcase PS_ENABLED:\n\t\treturn \"PS_ENABLED\";\n\tdefault:\n\t\treturn \"INVALID_STATE\";\n\t}\n}\n\nstatic inline void rsi_modify_ps_state(struct rsi_hw *adapter,\n\t\t\t\t       enum ps_state nstate)\n{\n\trsi_dbg(INFO_ZONE, \"PS state changed %s => %s\\n\",\n\t\tstr_psstate(adapter->ps_state),\n\t\tstr_psstate(nstate));\n\n\tadapter->ps_state = nstate;\n}\n\nvoid rsi_default_ps_params(struct rsi_hw *adapter)\n{\n\tstruct rsi_ps_info *ps_info = &adapter->ps_info;\n\n\tps_info->enabled = true;\n\tps_info->sleep_type = RSI_SLEEP_TYPE_LP;\n\tps_info->tx_threshold = 0;\n\tps_info->rx_threshold = 0;\n\tps_info->tx_hysterisis = 0;\n\tps_info->rx_hysterisis = 0;\n\tps_info->monitor_interval = 0;\n\tps_info->listen_interval = RSI_DEF_LISTEN_INTERVAL;\n\tps_info->num_bcns_per_lis_int = 0;\n\tps_info->dtim_interval_duration = 0;\n\tps_info->num_dtims_per_sleep = 0;\n\tps_info->deep_sleep_wakeup_period = RSI_DEF_DS_WAKEUP_PERIOD;\n}\n\nvoid rsi_enable_ps(struct rsi_hw *adapter, struct ieee80211_vif *vif)\n{\n\tif (adapter->ps_state != PS_NONE) {\n\t\trsi_dbg(ERR_ZONE,\n\t\t\t\"%s: Cannot accept enable PS in %s state\\n\",\n\t\t\t__func__, str_psstate(adapter->ps_state));\n\t\treturn;\n\t}\n\n\tif (rsi_send_ps_request(adapter, true, vif)) {\n\t\trsi_dbg(ERR_ZONE,\n\t\t\t\"%s: Failed to send PS request to device\\n\",\n\t\t\t__func__);\n\t\treturn;\n\t}\n\n\trsi_modify_ps_state(adapter, PS_ENABLE_REQ_SENT);\n}\n\n \nvoid rsi_disable_ps(struct rsi_hw *adapter, struct ieee80211_vif *vif)\n{\n\tif (adapter->ps_state != PS_ENABLED) {\n\t\trsi_dbg(ERR_ZONE,\n\t\t\t\"%s: Cannot accept disable PS in %s state\\n\",\n\t\t\t__func__, str_psstate(adapter->ps_state));\n\t\treturn;\n\t}\n\n\tif (rsi_send_ps_request(adapter, false, vif)) {\n\t\trsi_dbg(ERR_ZONE,\n\t\t\t\"%s: Failed to send PS request to device\\n\",\n\t\t\t__func__);\n\t\treturn;\n\t}\n\n\trsi_modify_ps_state(adapter, PS_DISABLE_REQ_SENT);\n}\n\nvoid rsi_conf_uapsd(struct rsi_hw *adapter, struct ieee80211_vif *vif)\n{\n\tint ret;\n\n\tif (adapter->ps_state != PS_ENABLED)\n\t\treturn;\n\n\tret = rsi_send_ps_request(adapter, false, vif);\n\tif (!ret)\n\t\tret = rsi_send_ps_request(adapter, true, vif);\n\tif (ret)\n\t\trsi_dbg(ERR_ZONE,\n\t\t\t\"%s: Failed to send PS request to device\\n\",\n\t\t\t__func__);\n}\n\nint rsi_handle_ps_confirm(struct rsi_hw *adapter, u8 *msg)\n{\n\tu16 cfm_type = get_unaligned_le16(msg + PS_CONFIRM_INDEX);\n\n\tswitch (cfm_type) {\n\tcase RSI_SLEEP_REQUEST:\n\t\tif (adapter->ps_state == PS_ENABLE_REQ_SENT)\n\t\t\trsi_modify_ps_state(adapter, PS_ENABLED);\n\t\tbreak;\n\tcase RSI_WAKEUP_REQUEST:\n\t\tif (adapter->ps_state == PS_DISABLE_REQ_SENT)\n\t\t\trsi_modify_ps_state(adapter, PS_NONE);\n\t\tbreak;\n\tdefault:\n\t\trsi_dbg(ERR_ZONE,\n\t\t\t\"Invalid PS confirm type %x in state %s\\n\",\n\t\t\tcfm_type, str_psstate(adapter->ps_state));\n\t\treturn -1;\n\t}\n\n\treturn 0;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}