{
  "module_name": "zd_rf_al7230b.c",
  "hash_id": "d98c5bbb2c73160eec0a9d1556c330eb6374fe1d94e6bb6807028060c4f5fc93",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/zydas/zd1211rw/zd_rf_al7230b.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n\n#include \"zd_rf.h\"\n#include \"zd_usb.h\"\n#include \"zd_chip.h\"\n\nstatic const u32 chan_rv[][2] = {\n\tRF_CHANNEL( 1) = { 0x09ec00, 0x8cccc8 },\n\tRF_CHANNEL( 2) = { 0x09ec00, 0x8cccd8 },\n\tRF_CHANNEL( 3) = { 0x09ec00, 0x8cccc0 },\n\tRF_CHANNEL( 4) = { 0x09ec00, 0x8cccd0 },\n\tRF_CHANNEL( 5) = { 0x05ec00, 0x8cccc8 },\n\tRF_CHANNEL( 6) = { 0x05ec00, 0x8cccd8 },\n\tRF_CHANNEL( 7) = { 0x05ec00, 0x8cccc0 },\n\tRF_CHANNEL( 8) = { 0x05ec00, 0x8cccd0 },\n\tRF_CHANNEL( 9) = { 0x0dec00, 0x8cccc8 },\n\tRF_CHANNEL(10) = { 0x0dec00, 0x8cccd8 },\n\tRF_CHANNEL(11) = { 0x0dec00, 0x8cccc0 },\n\tRF_CHANNEL(12) = { 0x0dec00, 0x8cccd0 },\n\tRF_CHANNEL(13) = { 0x03ec00, 0x8cccc8 },\n\tRF_CHANNEL(14) = { 0x03ec00, 0x866660 },\n};\n\nstatic const u32 std_rv[] = {\n\t0x4ff821,\n\t0xc5fbfc,\n\t0x21ebfe,\n\t0xafd401,  \n\t0x6cf56a,\n\t0xe04073,\n\t0x193d76,\n\t0x9dd844,\n\t0x500007,\n\t0xd8c010,\n};\n\nstatic const u32 rv_init1[] = {\n\t0x3c9000,\n\t0xbfffff,\n\t0x700000,\n\t0xf15d58,\n};\n\nstatic const u32 rv_init2[] = {\n\t0xf15d59,\n\t0xf15d5c,\n\t0xf15d58,\n};\n\nstatic const struct zd_ioreq16 ioreqs_sw[] = {\n\t{ ZD_CR128, 0x14 }, { ZD_CR129, 0x12 }, { ZD_CR130, 0x10 },\n\t{ ZD_CR38,  0x38 }, { ZD_CR136, 0xdf },\n};\n\nstatic int zd1211b_al7230b_finalize(struct zd_chip *chip)\n{\n\tint r;\n\tstatic const struct zd_ioreq16 ioreqs[] = {\n\t\t{ ZD_CR80,  0x30 }, { ZD_CR81,  0x30 }, { ZD_CR79,  0x58 },\n\t\t{ ZD_CR12,  0xf0 }, { ZD_CR77,  0x1b }, { ZD_CR78,  0x58 },\n\t\t{ ZD_CR203, 0x04 },\n\t\t{ },\n\t\t{ ZD_CR240, 0x80 },\n\t};\n\n\tr = zd_iowrite16a_locked(chip, ioreqs, ARRAY_SIZE(ioreqs));\n\tif (r)\n\t\treturn r;\n\n\tif (chip->new_phy_layout) {\n\t\t \n\t\tr = zd_iowrite16_locked(chip, 0xe5, ZD_CR9);\n\t\tif (r)\n\t\t\treturn r;\n\t}\n\n\treturn zd_iowrite16_locked(chip, 0x04, ZD_CR203);\n}\n\nstatic int zd1211_al7230b_init_hw(struct zd_rf *rf)\n{\n\tint r;\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\n\t \n\tstatic const struct zd_ioreq16 ioreqs_1[] = {\n\t\t \n\t\t{ ZD_CR240,  0x57 },\n\t\t{ },\n\n\t\t{ ZD_CR15,   0x20 }, { ZD_CR23,   0x40 }, { ZD_CR24,  0x20 },\n\t\t{ ZD_CR26,   0x11 }, { ZD_CR28,   0x3e }, { ZD_CR29,  0x00 },\n\t\t{ ZD_CR44,   0x33 },\n\t\t \n\t\t{ ZD_CR106,  0x22 },\n\t\t{ ZD_CR107,  0x1a }, { ZD_CR109,  0x09 }, { ZD_CR110,  0x27 },\n\t\t{ ZD_CR111,  0x2b }, { ZD_CR112,  0x2b }, { ZD_CR119,  0x0a },\n\t\t \n\t\t{ ZD_CR122,  0xfc },\n\t\t{ ZD_CR10,   0x89 },\n\t\t \n\t\t{ ZD_CR17,   0x28 },\n\t\t{ ZD_CR26,   0x93 }, { ZD_CR34,   0x30 },\n\t\t \n\t\t{ ZD_CR35,   0x3e },\n\t\t{ ZD_CR41,   0x24 }, { ZD_CR44,   0x32 },\n\t\t \n\t\t{ ZD_CR46,   0x96 },\n\t\t{ ZD_CR47,   0x1e }, { ZD_CR79,   0x58 }, { ZD_CR80,  0x30 },\n\t\t{ ZD_CR81,   0x30 }, { ZD_CR87,   0x0a }, { ZD_CR89,  0x04 },\n\t\t{ ZD_CR92,   0x0a }, { ZD_CR99,   0x28 },\n\t\t \n\t\t{ ZD_CR100,  0x02 },\n\t\t{ ZD_CR101,  0x13 }, { ZD_CR102,  0x27 },\n\t\t \n\t\t{ ZD_CR106,  0x22 },\n\t\t \n\t\t{ ZD_CR107,  0x3f },\n\t\t{ ZD_CR109,  0x09 },\n\t\t \n\t\t{ ZD_CR110,  0x1f },\n\t\t{ ZD_CR111,  0x1f }, { ZD_CR112,  0x1f }, { ZD_CR113, 0x27 },\n\t\t{ ZD_CR114,  0x27 },\n\t\t \n\t\t{ ZD_CR115,  0x24 },\n\t\t \n\t\t{ ZD_CR116,  0x3f },\n\t\t \n\t\t{ ZD_CR117,  0xfa },\n\t\t{ ZD_CR118,  0xfc }, { ZD_CR119,  0x10 }, { ZD_CR120, 0x4f },\n\t\t{ ZD_CR121,  0x77 }, { ZD_CR137,  0x88 },\n\t\t \n\t\t{ ZD_CR138,  0xa8 },\n\t\t \n\t\t{ ZD_CR252,  0x34 },\n\t\t \n\t\t{ ZD_CR253,  0x34 },\n\n\t\t \n\t\t{ ZD_CR251, 0x2f },\n\t};\n\n\tstatic const struct zd_ioreq16 ioreqs_2[] = {\n\t\t{ ZD_CR251, 0x3f },  \n\t\t{ ZD_CR128, 0x14 }, { ZD_CR129, 0x12 }, { ZD_CR130, 0x10 },\n\t\t{ ZD_CR38,  0x38 }, { ZD_CR136, 0xdf },\n\t};\n\n\tr = zd_iowrite16a_locked(chip, ioreqs_1, ARRAY_SIZE(ioreqs_1));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, chan_rv[0], ARRAY_SIZE(chan_rv[0]));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, std_rv, ARRAY_SIZE(std_rv));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, rv_init1, ARRAY_SIZE(rv_init1));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_iowrite16a_locked(chip, ioreqs_2, ARRAY_SIZE(ioreqs_2));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, rv_init2, ARRAY_SIZE(rv_init2));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_iowrite16_locked(chip, 0x06, ZD_CR203);\n\tif (r)\n\t\treturn r;\n\tr = zd_iowrite16_locked(chip, 0x80, ZD_CR240);\n\tif (r)\n\t\treturn r;\n\n\treturn 0;\n}\n\nstatic int zd1211b_al7230b_init_hw(struct zd_rf *rf)\n{\n\tint r;\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\n\tstatic const struct zd_ioreq16 ioreqs_1[] = {\n\t\t{ ZD_CR240, 0x57 }, { ZD_CR9,   0x9 },\n\t\t{ },\n\t\t{ ZD_CR10,  0x8b }, { ZD_CR15,  0x20 },\n\t\t{ ZD_CR17,  0x2B },  \n\t\t{ ZD_CR20,  0x10 },  \n\t\t{ ZD_CR23,  0x40 }, { ZD_CR24,  0x20 }, { ZD_CR26,  0x93 },\n\t\t{ ZD_CR28,  0x3e }, { ZD_CR29,  0x00 },\n\t\t{ ZD_CR33,  0x28 },  \n\t\t{ ZD_CR34,  0x30 },\n\t\t{ ZD_CR35,  0x3e },  \n\t\t{ ZD_CR41,  0x24 }, { ZD_CR44,  0x32 },\n\t\t{ ZD_CR46,  0x99 },  \n\t\t{ ZD_CR47,  0x1e },\n\n\t\t \n\t\t{ ZD_CR48,  0x00 }, { ZD_CR49,  0x00 }, { ZD_CR51,  0x01 },\n\t\t{ ZD_CR52,  0x80 }, { ZD_CR53,  0x7e }, { ZD_CR65,  0x00 },\n\t\t{ ZD_CR66,  0x00 }, { ZD_CR67,  0x00 }, { ZD_CR68,  0x00 },\n\t\t{ ZD_CR69,  0x28 },\n\n\t\t{ ZD_CR79,  0x58 }, { ZD_CR80,  0x30 }, { ZD_CR81,  0x30 },\n\t\t{ ZD_CR87,  0x0A }, { ZD_CR89,  0x04 },\n\t\t{ ZD_CR90,  0x58 },  \n\t\t{ ZD_CR91,  0x00 },  \n\t\t{ ZD_CR92,  0x0a },\n\t\t{ ZD_CR98,  0x8d },  \n\t\t{ ZD_CR99,  0x00 }, { ZD_CR100, 0x02 }, { ZD_CR101, 0x13 },\n\t\t{ ZD_CR102, 0x27 },\n\t\t{ ZD_CR106, 0x20 },  \n\t\t{ ZD_CR109, 0x13 },  \n\t\t{ ZD_CR112, 0x1f },\n\t};\n\n\tstatic const struct zd_ioreq16 ioreqs_new_phy[] = {\n\t\t{ ZD_CR107, 0x28 },\n\t\t{ ZD_CR110, 0x1f },  \n\t\t{ ZD_CR111, 0x1f },  \n\t\t{ ZD_CR116, 0x2a }, { ZD_CR118, 0xfa }, { ZD_CR119, 0x12 },\n\t\t{ ZD_CR121, 0x6c },  \n\t};\n\n\tstatic const struct zd_ioreq16 ioreqs_old_phy[] = {\n\t\t{ ZD_CR107, 0x24 },\n\t\t{ ZD_CR110, 0x13 },  \n\t\t{ ZD_CR111, 0x13 },  \n\t\t{ ZD_CR116, 0x24 }, { ZD_CR118, 0xfc }, { ZD_CR119, 0x11 },\n\t\t{ ZD_CR121, 0x6a },  \n\t};\n\n\tstatic const struct zd_ioreq16 ioreqs_2[] = {\n\t\t{ ZD_CR113, 0x27 }, { ZD_CR114, 0x27 }, { ZD_CR115, 0x24 },\n\t\t{ ZD_CR117, 0xfa }, { ZD_CR120, 0x4f },\n\t\t{ ZD_CR122, 0xfc },  \n\t\t{ ZD_CR123, 0x57 },  \n\t\t{ ZD_CR125, 0xad },  \n\t\t{ ZD_CR126, 0x6c },  \n\t\t{ ZD_CR127, 0x03 },  \n\t\t{ ZD_CR130, 0x10 },\n\t\t{ ZD_CR131, 0x00 },  \n\t\t{ ZD_CR137, 0x50 },  \n\t\t{ ZD_CR138, 0xa8 },  \n\t\t{ ZD_CR144, 0xac },  \n\t\t{ ZD_CR148, 0x40 },  \n\t\t{ ZD_CR149, 0x40 },  \n\t\t{ ZD_CR150, 0x1a },  \n\t\t{ ZD_CR252, 0x34 }, { ZD_CR253, 0x34 },\n\t\t{ ZD_CR251, 0x2f },  \n\t};\n\n\tstatic const struct zd_ioreq16 ioreqs_3[] = {\n\t\t{ ZD_CR251, 0x7f },  \n\t\t{ ZD_CR128, 0x14 }, { ZD_CR129, 0x12 }, { ZD_CR130, 0x10 },\n\t\t{ ZD_CR38,  0x38 }, { ZD_CR136, 0xdf },\n\t};\n\n\tr = zd_iowrite16a_locked(chip, ioreqs_1, ARRAY_SIZE(ioreqs_1));\n\tif (r)\n\t\treturn r;\n\n\tif (chip->new_phy_layout)\n\t\tr = zd_iowrite16a_locked(chip, ioreqs_new_phy,\n\t\t\tARRAY_SIZE(ioreqs_new_phy));\n\telse\n\t\tr = zd_iowrite16a_locked(chip, ioreqs_old_phy,\n\t\t\tARRAY_SIZE(ioreqs_old_phy));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_iowrite16a_locked(chip, ioreqs_2, ARRAY_SIZE(ioreqs_2));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, chan_rv[0], ARRAY_SIZE(chan_rv[0]));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, std_rv, ARRAY_SIZE(std_rv));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, rv_init1, ARRAY_SIZE(rv_init1));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_iowrite16a_locked(chip, ioreqs_3, ARRAY_SIZE(ioreqs_3));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, rv_init2, ARRAY_SIZE(rv_init2));\n\tif (r)\n\t\treturn r;\n\n\treturn zd1211b_al7230b_finalize(chip);\n}\n\nstatic int zd1211_al7230b_set_channel(struct zd_rf *rf, u8 channel)\n{\n\tint r;\n\tconst u32 *rv = chan_rv[channel-1];\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\n\tstatic const struct zd_ioreq16 ioreqs[] = {\n\t\t \n\t\t{ ZD_CR251, 0x3f },\n\t\t{ ZD_CR203, 0x06 }, { ZD_CR240, 0x08 },\n\t};\n\n\tr = zd_iowrite16_locked(chip, 0x57, ZD_CR240);\n\tif (r)\n\t\treturn r;\n\n\t \n\tr = zd_iowrite16_locked(chip, 0x2f, ZD_CR251);\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, std_rv, ARRAY_SIZE(std_rv));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwrite_cr_locked(chip, 0x3c9000);\n\tif (r)\n\t\treturn r;\n\tr = zd_rfwrite_cr_locked(chip, 0xf15d58);\n\tif (r)\n\t\treturn r;\n\n\tr = zd_iowrite16a_locked(chip, ioreqs_sw, ARRAY_SIZE(ioreqs_sw));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, rv, 2);\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwrite_cr_locked(chip, 0x3c9000);\n\tif (r)\n\t\treturn r;\n\n\treturn zd_iowrite16a_locked(chip, ioreqs, ARRAY_SIZE(ioreqs));\n}\n\nstatic int zd1211b_al7230b_set_channel(struct zd_rf *rf, u8 channel)\n{\n\tint r;\n\tconst u32 *rv = chan_rv[channel-1];\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\n\tr = zd_iowrite16_locked(chip, 0x57, ZD_CR240);\n\tif (r)\n\t\treturn r;\n\tr = zd_iowrite16_locked(chip, 0xe4, ZD_CR9);\n\tif (r)\n\t\treturn r;\n\n\t \n\tr = zd_iowrite16_locked(chip, 0x2f, ZD_CR251);\n\tif (r)\n\t\treturn r;\n\tr = zd_rfwritev_cr_locked(chip, std_rv, ARRAY_SIZE(std_rv));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwrite_cr_locked(chip, 0x3c9000);\n\tif (r)\n\t\treturn r;\n\tr = zd_rfwrite_cr_locked(chip, 0xf15d58);\n\tif (r)\n\t\treturn r;\n\n\tr = zd_iowrite16a_locked(chip, ioreqs_sw, ARRAY_SIZE(ioreqs_sw));\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwritev_cr_locked(chip, rv, 2);\n\tif (r)\n\t\treturn r;\n\n\tr = zd_rfwrite_cr_locked(chip, 0x3c9000);\n\tif (r)\n\t\treturn r;\n\n\tr = zd_iowrite16_locked(chip, 0x7f, ZD_CR251);\n\tif (r)\n\t\treturn r;\n\n\treturn zd1211b_al7230b_finalize(chip);\n}\n\nstatic int zd1211_al7230b_switch_radio_on(struct zd_rf *rf)\n{\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\tstatic const struct zd_ioreq16 ioreqs[] = {\n\t\t{ ZD_CR11,  0x00 },\n\t\t{ ZD_CR251, 0x3f },\n\t};\n\n\treturn zd_iowrite16a_locked(chip, ioreqs, ARRAY_SIZE(ioreqs));\n}\n\nstatic int zd1211b_al7230b_switch_radio_on(struct zd_rf *rf)\n{\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\tstatic const struct zd_ioreq16 ioreqs[] = {\n\t\t{ ZD_CR11,  0x00 },\n\t\t{ ZD_CR251, 0x7f },\n\t};\n\n\treturn zd_iowrite16a_locked(chip, ioreqs, ARRAY_SIZE(ioreqs));\n}\n\nstatic int al7230b_switch_radio_off(struct zd_rf *rf)\n{\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\tstatic const struct zd_ioreq16 ioreqs[] = {\n\t\t{ ZD_CR11,  0x04 },\n\t\t{ ZD_CR251, 0x2f },\n\t};\n\n\treturn zd_iowrite16a_locked(chip, ioreqs, ARRAY_SIZE(ioreqs));\n}\n\n \nstatic int zd1211b_al7230b_patch_6m(struct zd_rf *rf, u8 channel)\n{\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\tstruct zd_ioreq16 ioreqs[] = {\n\t\t{ ZD_CR128, 0x14 }, { ZD_CR129, 0x12 },\n\t};\n\n\t \n\tif (channel == 1) {\n\t\tioreqs[0].value = 0x0e;\n\t\tioreqs[1].value = 0x10;\n\t} else if (channel == 11) {\n\t\tioreqs[0].value = 0x10;\n\t\tioreqs[1].value = 0x10;\n\t}\n\n\tdev_dbg_f(zd_chip_dev(chip), \"patching for channel %d\\n\", channel);\n\treturn zd_iowrite16a_locked(chip, ioreqs, ARRAY_SIZE(ioreqs));\n}\n\nint zd_rf_init_al7230b(struct zd_rf *rf)\n{\n\tstruct zd_chip *chip = zd_rf_to_chip(rf);\n\n\tif (zd_chip_is_zd1211b(chip)) {\n\t\trf->init_hw = zd1211b_al7230b_init_hw;\n\t\trf->switch_radio_on = zd1211b_al7230b_switch_radio_on;\n\t\trf->set_channel = zd1211b_al7230b_set_channel;\n\t\trf->patch_6m_band_edge = zd1211b_al7230b_patch_6m;\n\t} else {\n\t\trf->init_hw = zd1211_al7230b_init_hw;\n\t\trf->switch_radio_on = zd1211_al7230b_switch_radio_on;\n\t\trf->set_channel = zd1211_al7230b_set_channel;\n\t\trf->patch_6m_band_edge = zd_rf_generic_patch_6m;\n\t\trf->patch_cck_gain = 1;\n\t}\n\n\trf->switch_radio_off = al7230b_switch_radio_off;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}