{
  "module_name": "orinoco_cs.c",
  "hash_id": "3e925d5511a5467185e45bfe308b88b89f3ac8c51de5b743346175f35c0a379d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/intersil/orinoco/orinoco_cs.c",
  "human_readable_source": " \n\n#define DRIVER_NAME \"orinoco_cs\"\n#define PFX DRIVER_NAME \": \"\n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/delay.h>\n#include <pcmcia/cistpl.h>\n#include <pcmcia/cisreg.h>\n#include <pcmcia/ds.h>\n\n#include \"orinoco.h\"\n\n \n \n \n\nMODULE_AUTHOR(\"David Gibson <hermes@gibson.dropbear.id.au>\");\nMODULE_DESCRIPTION(\"Driver for PCMCIA Lucent Orinoco,\"\n\t\t   \" Prism II based and similar wireless cards\");\nMODULE_LICENSE(\"Dual MPL/GPL\");\n\n \n\n \nstatic int ignore_cis_vcc;  \nmodule_param(ignore_cis_vcc, int, 0);\nMODULE_PARM_DESC(ignore_cis_vcc, \"Allow voltage mismatch between card and socket\");\n\n \n \n \n\n \nstruct orinoco_pccard {\n\tstruct pcmcia_device\t*p_dev;\n\n\t \n\t \n\tunsigned long hard_reset_in_progress;\n};\n\n\n \n \n \n\nstatic int orinoco_cs_config(struct pcmcia_device *link);\nstatic void orinoco_cs_release(struct pcmcia_device *link);\nstatic void orinoco_cs_detach(struct pcmcia_device *p_dev);\n\n \n \n \n\nstatic int\norinoco_cs_hard_reset(struct orinoco_private *priv)\n{\n\tstruct orinoco_pccard *card = priv->card;\n\tstruct pcmcia_device *link = card->p_dev;\n\tint err;\n\n\t \n\tset_bit(0, &card->hard_reset_in_progress);\n\n\terr = pcmcia_reset_card(link->socket);\n\tif (err)\n\t\treturn err;\n\n\tmsleep(100);\n\tclear_bit(0, &card->hard_reset_in_progress);\n\n\treturn 0;\n}\n\n \n \n \n\nstatic int\norinoco_cs_probe(struct pcmcia_device *link)\n{\n\tstruct orinoco_private *priv;\n\tstruct orinoco_pccard *card;\n\tint ret;\n\n\tpriv = alloc_orinocodev(sizeof(*card), &link->dev,\n\t\t\t\torinoco_cs_hard_reset, NULL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\tcard = priv->card;\n\n\t \n\tcard->p_dev = link;\n\tlink->priv = priv;\n\n\tret = orinoco_cs_config(link);\n\tif (ret)\n\t\tgoto err_free_orinocodev;\n\n\treturn 0;\n\nerr_free_orinocodev:\n\tfree_orinocodev(priv);\n\treturn ret;\n}\n\nstatic void orinoco_cs_detach(struct pcmcia_device *link)\n{\n\tstruct orinoco_private *priv = link->priv;\n\n\torinoco_if_del(priv);\n\n\torinoco_cs_release(link);\n\n\twiphy_unregister(priv_to_wiphy(priv));\n\tfree_orinocodev(priv);\n}\t\t\t\t \n\nstatic int orinoco_cs_config_check(struct pcmcia_device *p_dev, void *priv_data)\n{\n\tif (p_dev->config_index == 0)\n\t\treturn -EINVAL;\n\n\treturn pcmcia_request_io(p_dev);\n};\n\nstatic int\norinoco_cs_config(struct pcmcia_device *link)\n{\n\tstruct orinoco_private *priv = link->priv;\n\tstruct hermes *hw = &priv->hw;\n\tint ret;\n\tvoid __iomem *mem;\n\n\tlink->config_flags |= CONF_AUTO_SET_VPP | CONF_AUTO_CHECK_VCC |\n\t\tCONF_AUTO_SET_IO | CONF_ENABLE_IRQ;\n\tif (ignore_cis_vcc)\n\t\tlink->config_flags &= ~CONF_AUTO_CHECK_VCC;\n\tret = pcmcia_loop_config(link, orinoco_cs_config_check, NULL);\n\tif (ret) {\n\t\tif (!ignore_cis_vcc)\n\t\t\tprintk(KERN_ERR PFX \"GetNextTuple(): No matching \"\n\t\t\t       \"CIS configuration.  Maybe you need the \"\n\t\t\t       \"ignore_cis_vcc=1 parameter.\\n\");\n\t\tgoto failed;\n\t}\n\n\tmem = ioport_map(link->resource[0]->start,\n\t\t\tresource_size(link->resource[0]));\n\tif (!mem)\n\t\tgoto failed;\n\n\t \n\thermes_struct_init(hw, mem, HERMES_16BIT_REGSPACING);\n\n\tret = pcmcia_request_irq(link, orinoco_interrupt);\n\tif (ret)\n\t\tgoto failed;\n\n\tret = pcmcia_enable_device(link);\n\tif (ret)\n\t\tgoto failed;\n\n\t \n\tif (orinoco_init(priv) != 0) {\n\t\tprintk(KERN_ERR PFX \"orinoco_init() failed\\n\");\n\t\tgoto failed;\n\t}\n\n\t \n\tif (orinoco_if_add(priv, link->resource[0]->start,\n\t\t\t   link->irq, NULL) != 0) {\n\t\tprintk(KERN_ERR PFX \"orinoco_if_add() failed\\n\");\n\t\tgoto failed;\n\t}\n\n\treturn 0;\n\n failed:\n\torinoco_cs_release(link);\n\treturn -ENODEV;\n}\t\t\t\t \n\nstatic void\norinoco_cs_release(struct pcmcia_device *link)\n{\n\tstruct orinoco_private *priv = link->priv;\n\tunsigned long flags;\n\n\t \n\tpriv->hw.ops->lock_irqsave(&priv->lock, &flags);\n\tpriv->hw_unavailable++;\n\tpriv->hw.ops->unlock_irqrestore(&priv->lock, &flags);\n\n\tpcmcia_disable_device(link);\n\tif (priv->hw.iobase)\n\t\tioport_unmap(priv->hw.iobase);\n}\t\t\t\t \n\nstatic int orinoco_cs_suspend(struct pcmcia_device *link)\n{\n\tstruct orinoco_private *priv = link->priv;\n\tstruct orinoco_pccard *card = priv->card;\n\n\t \n\tif (!test_bit(0, &card->hard_reset_in_progress))\n\t\torinoco_down(priv);\n\n\treturn 0;\n}\n\nstatic int orinoco_cs_resume(struct pcmcia_device *link)\n{\n\tstruct orinoco_private *priv = link->priv;\n\tstruct orinoco_pccard *card = priv->card;\n\tint err = 0;\n\n\tif (!test_bit(0, &card->hard_reset_in_progress))\n\t\terr = orinoco_up(priv);\n\n\treturn err;\n}\n\n\n \n \n \n\nstatic const struct pcmcia_device_id orinoco_cs_ids[] = {\n\tPCMCIA_DEVICE_MANF_CARD(0x0101, 0x0777),  \n\tPCMCIA_DEVICE_MANF_CARD(0x016b, 0x0001),  \n\tPCMCIA_DEVICE_MANF_CARD(0x01eb, 0x080a),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0261, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0268, 0x0001),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0268, 0x0003),  \n\tPCMCIA_DEVICE_MANF_CARD(0x026f, 0x0305),  \n\tPCMCIA_DEVICE_MANF_CARD(0x02aa, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0x02ac, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0x02ac, 0x3021),  \n\tPCMCIA_DEVICE_MANF_CARD(0x14ea, 0xb001),  \n\tPCMCIA_DEVICE_PROD_ID12(\"3Com\", \"3CRWE737A AirConnect Wireless LAN PC Card\", 0x41240e5b, 0x56010af3),\n\tPCMCIA_DEVICE_PROD_ID12(\"Allied Telesyn\", \"AT-WCL452 Wireless PCMCIA Radio\", 0x5cd01705, 0x4271660f),\n\tPCMCIA_DEVICE_PROD_ID12(\"ASUS\", \"802_11B_CF_CARD_25\", 0x78fc06ee, 0x45a50c1e),\n\tPCMCIA_DEVICE_PROD_ID12(\"ASUS\", \"802_11b_PC_CARD_25\", 0x78fc06ee, 0xdb9aa842),\n\tPCMCIA_DEVICE_PROD_ID12(\"Avaya Communication\", \"Avaya Wireless PC Card\", 0xd8a43b78, 0x0d341169),\n\tPCMCIA_DEVICE_PROD_ID12(\"BENQ\", \"AWL100 PCMCIA ADAPTER\", 0x35dadc74, 0x01f7fedb),\n\tPCMCIA_DEVICE_PROD_ID12(\"Cabletron\", \"RoamAbout 802.11 DS\", 0x32d445f5, 0xedeffd90),\n\tPCMCIA_DEVICE_PROD_ID12(\"D-Link Corporation\", \"D-Link DWL-650H 11Mbps WLAN Adapter\", 0xef544d24, 0xcd8ea916),\n\tPCMCIA_DEVICE_PROD_ID12(\"ELSA\", \"AirLancer MC-11\", 0x4507a33a, 0xef54f0e3),\n\tPCMCIA_DEVICE_PROD_ID12(\"HyperLink\", \"Wireless PC Card 11Mbps\", 0x56cc3f1a, 0x0bcf220c),\n\tPCMCIA_DEVICE_PROD_ID12(\"Intel\", \"PRO/Wireless 2011 LAN PC Card\", 0x816cc815, 0x07f58077),\n\tPCMCIA_DEVICE_PROD_ID12(\"LeArtery\", \"SYNCBYAIR 11Mbps Wireless LAN PC Card\", 0x7e3b326a, 0x49893e92),\n\tPCMCIA_DEVICE_PROD_ID12(\"Lucent Technologies\", \"WaveLAN/IEEE\", 0x23eb9949, 0xc562e72a),\n\tPCMCIA_DEVICE_PROD_ID12(\"MELCO\", \"WLI-PCM-L11\", 0x481e0094, 0x7360e410),\n\tPCMCIA_DEVICE_PROD_ID12(\"MELCO\", \"WLI-PCM-L11G\", 0x481e0094, 0xf57ca4b3),\n\tPCMCIA_DEVICE_PROD_ID12(\"NCR\", \"WaveLAN/IEEE\", 0x24358cd4, 0xc562e72a),\n\tPCMCIA_DEVICE_PROD_ID12(\"Nortel Networks\", \"emobility 802.11 Wireless LAN PC Card\", 0x2d617ea0, 0x88cd5767),\n\tPCMCIA_DEVICE_PROD_ID12(\"OTC\", \"Wireless AirEZY 2411-PCC WLAN Card\", 0x4ac44287, 0x235a6bed),\n\tPCMCIA_DEVICE_PROD_ID12(\"PROXIM\", \"LAN PC CARD HARMONY 80211B\", 0xc6536a5e, 0x090c3cd9),\n\tPCMCIA_DEVICE_PROD_ID12(\"PROXIM\", \"LAN PCI CARD HARMONY 80211B\", 0xc6536a5e, 0x9f494e26),\n\tPCMCIA_DEVICE_PROD_ID12(\"SAMSUNG\", \"11Mbps WLAN Card\", 0x43d74cb4, 0x579bd91b),\n\tPCMCIA_DEVICE_PROD_ID12(\"Symbol Technologies\", \"LA4111 Spectrum24 Wireless LAN PC Card\", 0x3f02b4d6, 0x3663cb0e),\n\tPCMCIA_DEVICE_MANF_CARD_PROD_ID3(0x0156, 0x0002, \"Version 01.01\", 0xd27deb1a),  \n#ifdef CONFIG_HERMES_PRISM\n\t \n\tPCMCIA_DEVICE_MANF_CARD(0x000b, 0x7100),  \n\tPCMCIA_DEVICE_MANF_CARD(0x000b, 0x7300),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0089, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0126, 0x8000),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0138, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0x01ff, 0x0008),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0250, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0274, 0x1612),  \n\tPCMCIA_DEVICE_MANF_CARD(0x0274, 0x1613),  \n\tPCMCIA_DEVICE_MANF_CARD(0x028a, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0x028a, 0x0673),  \n\tPCMCIA_DEVICE_MANF_CARD(0x50c2, 0x7300),  \n\tPCMCIA_DEVICE_MANF_CARD(0x9005, 0x0021),  \n\tPCMCIA_DEVICE_MANF_CARD(0xc001, 0x0008),  \n\tPCMCIA_DEVICE_MANF_CARD(0xc250, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0xd601, 0x0002),  \n\tPCMCIA_DEVICE_MANF_CARD(0xd601, 0x0005),  \n\tPCMCIA_DEVICE_PROD_ID123(\"Instant Wireless \", \" Network PC CARD\", \"Version 01.02\", 0x11d901af, 0x6e9bd926, 0x4b74baa0),\n\tPCMCIA_DEVICE_PROD_ID12(\"ACTIONTEC\", \"PRISM Wireless LAN PC Card\", 0x393089da, 0xa71e69d5),\n\tPCMCIA_DEVICE_PROD_ID12(\"Addtron\", \"AWP-100 Wireless PCMCIA\", 0xe6ec52ce, 0x08649af2),\n\tPCMCIA_DEVICE_PROD_ID12(\"BUFFALO\", \"WLI-CF-S11G\", 0x2decece3, 0x82067c18),\n\tPCMCIA_DEVICE_PROD_ID12(\"BUFFALO\", \"WLI-PCM-L11G\", 0x2decece3, 0xf57ca4b3),\n\tPCMCIA_DEVICE_PROD_ID12(\"Compaq\", \"WL200_11Mbps_Wireless_PCI_Card\", 0x54f7c49c, 0x15a75e5b),\n\tPCMCIA_DEVICE_PROD_ID12(\"corega K.K.\", \"Wireless LAN PCC-11\", 0x5261440f, 0xa6405584),\n\tPCMCIA_DEVICE_PROD_ID12(\"corega K.K.\", \"Wireless LAN PCCA-11\", 0x5261440f, 0xdf6115f9),\n\tPCMCIA_DEVICE_PROD_ID12(\"corega_K.K.\", \"Wireless_LAN_PCCB-11\", 0x29e33311, 0xee7a27ae),\n\tPCMCIA_DEVICE_PROD_ID12(\"Digital Data Communications\", \"WPC-0100\", 0xfdd73470, 0xe0b6f146),\n\tPCMCIA_DEVICE_PROD_ID12(\"D\", \"Link DRC-650 11Mbps WLAN Card\", 0x71b18589, 0xf144e3ac),\n\tPCMCIA_DEVICE_PROD_ID12(\"D\", \"Link DWL-650 11Mbps WLAN Card\", 0x71b18589, 0xb6f1b0ab),\n\tPCMCIA_DEVICE_PROD_ID12(\" \", \"IEEE 802.11 Wireless LAN/PC Card\", 0x3b6e20c8, 0xefccafe9),\n\tPCMCIA_DEVICE_PROD_ID12(\"INTERSIL\", \"HFA384x/IEEE\", 0x74c5e40d, 0xdb472a18),\n\tPCMCIA_DEVICE_PROD_ID12(\"INTERSIL\", \"I-GATE 11M PC Card / PC Card plus\", 0x74c5e40d, 0x8304ff77),\n\tPCMCIA_DEVICE_PROD_ID12(\"Intersil\", \"PRISM 2_5 PCMCIA ADAPTER\", 0x4b801a17, 0x6345a0bf),\n\tPCMCIA_DEVICE_PROD_ID12(\"Linksys\", \"Wireless CompactFlash Card\", 0x0733cc81, 0x0c52f395),\n\tPCMCIA_DEVICE_PROD_ID12(\"Microsoft\", \"Wireless Notebook Adapter MN-520\", 0x5961bf85, 0x6eec8c01),\n\tPCMCIA_DEVICE_PROD_ID12(\"NETGEAR MA401RA Wireless PC\", \"Card\", 0x0306467f, 0x9762e8f1),\n\tPCMCIA_DEVICE_PROD_ID12(\"NETGEAR MA401 Wireless PC\", \"Card\", 0xa37434e9, 0x9762e8f1),\n\tPCMCIA_DEVICE_PROD_ID12(\"OEM\", \"PRISM2 IEEE 802.11 PC-Card\", 0xfea54c90, 0x48f2bdd6),\n\tPCMCIA_DEVICE_PROD_ID12(\"PLANEX\", \"GeoWave/GW-CF110\", 0x209f40ab, 0xd9715264),\n\tPCMCIA_DEVICE_PROD_ID12(\"PLANEX\", \"GeoWave/GW-NS110\", 0x209f40ab, 0x46263178),\n\tPCMCIA_DEVICE_PROD_ID12(\"SMC\", \"SMC2532W-B EliteConnect Wireless Adapter\", 0xc4f8b18b, 0x196bd757),\n\tPCMCIA_DEVICE_PROD_ID12(\"SMC\", \"SMC2632W\", 0xc4f8b18b, 0x474a1f2a),\n\tPCMCIA_DEVICE_PROD_ID12(\"ZoomAir 11Mbps High\", \"Rate wireless Networking\", 0x273fe3db, 0x32a1eaee),\n\tPCMCIA_DEVICE_PROD_ID3(\"HFA3863\", 0x355cb092),\n\tPCMCIA_DEVICE_PROD_ID3(\"ISL37100P\", 0x630d52b2),\n\tPCMCIA_DEVICE_PROD_ID3(\"ISL37101P-10\", 0xdd97a26b),\n\tPCMCIA_DEVICE_PROD_ID3(\"ISL37300P\", 0xc9049a39),\n\n\t \n\tPCMCIA_DEVICE_MANF_CARD(0x0156, 0x0002),\n#endif\n\tPCMCIA_DEVICE_NULL,\n};\nMODULE_DEVICE_TABLE(pcmcia, orinoco_cs_ids);\n\nstatic struct pcmcia_driver orinoco_driver = {\n\t.owner\t\t= THIS_MODULE,\n\t.name\t\t= DRIVER_NAME,\n\t.probe\t\t= orinoco_cs_probe,\n\t.remove\t\t= orinoco_cs_detach,\n\t.id_table       = orinoco_cs_ids,\n\t.suspend\t= orinoco_cs_suspend,\n\t.resume\t\t= orinoco_cs_resume,\n};\nmodule_pcmcia_driver(orinoco_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}