{
  "module_name": "debug.c",
  "hash_id": "933e8b751012c361ef074a4e576a6a4bb13efebf46249ad4a8afd0dcc3e21628",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/brcm80211/brcmsmac/debug.c",
  "human_readable_source": " \n#include <linux/debugfs.h>\n#include <linux/if_ether.h>\n#include <linux/if.h>\n#include <linux/net.h>\n#include <linux/netdevice.h>\n#include <linux/ieee80211.h>\n#include <linux/module.h>\n#include <net/mac80211.h>\n\n#include <defs.h>\n#include <brcmu_wifi.h>\n#include <brcmu_utils.h>\n#include \"types.h\"\n#include \"main.h\"\n#include \"debug.h\"\n#include \"brcms_trace_events.h\"\n#include \"phy/phy_int.h\"\n\nstatic struct dentry *root_folder;\n\nvoid brcms_debugfs_init(void)\n{\n\troot_folder = debugfs_create_dir(KBUILD_MODNAME, NULL);\n}\n\nvoid brcms_debugfs_exit(void)\n{\n\tdebugfs_remove_recursive(root_folder);\n\troot_folder = NULL;\n}\n\nvoid brcms_debugfs_attach(struct brcms_pub *drvr)\n{\n\tdrvr->dbgfs_dir = debugfs_create_dir(\n\t\t dev_name(&drvr->wlc->hw->d11core->dev), root_folder);\n}\n\nvoid brcms_debugfs_detach(struct brcms_pub *drvr)\n{\n\tdebugfs_remove_recursive(drvr->dbgfs_dir);\n}\n\nstruct dentry *brcms_debugfs_get_devdir(struct brcms_pub *drvr)\n{\n\treturn drvr->dbgfs_dir;\n}\n\nstatic\nint brcms_debugfs_hardware_read(struct seq_file *s, void *data)\n{\n\tstruct brcms_pub *drvr = s->private;\n\tstruct brcms_hardware *hw = drvr->wlc->hw;\n\tstruct bcma_device *core = hw->d11core;\n\tstruct bcma_bus *bus = core->bus;\n\tchar boardrev[BRCMU_BOARDREV_LEN];\n\n\tseq_printf(s, \"chipnum 0x%x\\n\"\n\t\t   \"chiprev 0x%x\\n\"\n\t\t   \"chippackage 0x%x\\n\"\n\t\t   \"corerev 0x%x\\n\"\n\t\t   \"boardid 0x%x\\n\"\n\t\t   \"boardvendor 0x%x\\n\"\n\t\t   \"boardrev %s\\n\"\n\t\t   \"boardflags 0x%x\\n\"\n\t\t   \"boardflags2 0x%x\\n\"\n\t\t   \"ucoderev 0x%x\\n\"\n\t\t   \"radiorev 0x%x\\n\"\n\t\t   \"phytype 0x%x\\n\"\n\t\t   \"phyrev 0x%x\\n\"\n\t\t   \"anarev 0x%x\\n\"\n\t\t   \"nvramrev %d\\n\",\n\t\t   bus->chipinfo.id, bus->chipinfo.rev, bus->chipinfo.pkg,\n\t\t   core->id.rev, bus->boardinfo.type, bus->boardinfo.vendor,\n\t\t   brcmu_boardrev_str(hw->boardrev, boardrev),\n\t\t   drvr->wlc->hw->boardflags, drvr->wlc->hw->boardflags2,\n\t\t   drvr->wlc->ucode_rev, hw->band->radiorev,\n\t\t   hw->band->phytype, hw->band->phyrev, hw->band->pi->ana_rev,\n\t\t   hw->sromrev);\n\treturn 0;\n}\n\nstatic int brcms_debugfs_macstat_read(struct seq_file *s, void *data)\n{\n\tstruct brcms_pub *drvr = s->private;\n\tstruct brcms_info *wl = drvr->ieee_hw->priv;\n\tstruct macstat stats;\n\tint i;\n\n\tspin_lock_bh(&wl->lock);\n\tstats = *(drvr->wlc->core->macstat_snapshot);\n\tspin_unlock_bh(&wl->lock);\n\n\tseq_printf(s, \"txallfrm: %d\\n\", stats.txallfrm);\n\tseq_printf(s, \"txrtsfrm: %d\\n\", stats.txrtsfrm);\n\tseq_printf(s, \"txctsfrm: %d\\n\", stats.txctsfrm);\n\tseq_printf(s, \"txackfrm: %d\\n\", stats.txackfrm);\n\tseq_printf(s, \"txdnlfrm: %d\\n\", stats.txdnlfrm);\n\tseq_printf(s, \"txbcnfrm: %d\\n\", stats.txbcnfrm);\n\tseq_printf(s, \"txfunfl[8]:\");\n\tfor (i = 0; i < ARRAY_SIZE(stats.txfunfl); i++)\n\t\tseq_printf(s, \" %d\", stats.txfunfl[i]);\n\tseq_printf(s, \"\\ntxtplunfl: %d\\n\", stats.txtplunfl);\n\tseq_printf(s, \"txphyerr: %d\\n\", stats.txphyerr);\n\tseq_printf(s, \"pktengrxducast: %d\\n\", stats.pktengrxducast);\n\tseq_printf(s, \"pktengrxdmcast: %d\\n\", stats.pktengrxdmcast);\n\tseq_printf(s, \"rxfrmtoolong: %d\\n\", stats.rxfrmtoolong);\n\tseq_printf(s, \"rxfrmtooshrt: %d\\n\", stats.rxfrmtooshrt);\n\tseq_printf(s, \"rxinvmachdr: %d\\n\", stats.rxinvmachdr);\n\tseq_printf(s, \"rxbadfcs: %d\\n\", stats.rxbadfcs);\n\tseq_printf(s, \"rxbadplcp: %d\\n\", stats.rxbadplcp);\n\tseq_printf(s, \"rxcrsglitch: %d\\n\", stats.rxcrsglitch);\n\tseq_printf(s, \"rxstrt: %d\\n\", stats.rxstrt);\n\tseq_printf(s, \"rxdfrmucastmbss: %d\\n\", stats.rxdfrmucastmbss);\n\tseq_printf(s, \"rxmfrmucastmbss: %d\\n\", stats.rxmfrmucastmbss);\n\tseq_printf(s, \"rxcfrmucast: %d\\n\", stats.rxcfrmucast);\n\tseq_printf(s, \"rxrtsucast: %d\\n\", stats.rxrtsucast);\n\tseq_printf(s, \"rxctsucast: %d\\n\", stats.rxctsucast);\n\tseq_printf(s, \"rxackucast: %d\\n\", stats.rxackucast);\n\tseq_printf(s, \"rxdfrmocast: %d\\n\", stats.rxdfrmocast);\n\tseq_printf(s, \"rxmfrmocast: %d\\n\", stats.rxmfrmocast);\n\tseq_printf(s, \"rxcfrmocast: %d\\n\", stats.rxcfrmocast);\n\tseq_printf(s, \"rxrtsocast: %d\\n\", stats.rxrtsocast);\n\tseq_printf(s, \"rxctsocast: %d\\n\", stats.rxctsocast);\n\tseq_printf(s, \"rxdfrmmcast: %d\\n\", stats.rxdfrmmcast);\n\tseq_printf(s, \"rxmfrmmcast: %d\\n\", stats.rxmfrmmcast);\n\tseq_printf(s, \"rxcfrmmcast: %d\\n\", stats.rxcfrmmcast);\n\tseq_printf(s, \"rxbeaconmbss: %d\\n\", stats.rxbeaconmbss);\n\tseq_printf(s, \"rxdfrmucastobss: %d\\n\", stats.rxdfrmucastobss);\n\tseq_printf(s, \"rxbeaconobss: %d\\n\", stats.rxbeaconobss);\n\tseq_printf(s, \"rxrsptmout: %d\\n\", stats.rxrsptmout);\n\tseq_printf(s, \"bcntxcancl: %d\\n\", stats.bcntxcancl);\n\tseq_printf(s, \"rxf0ovfl: %d\\n\", stats.rxf0ovfl);\n\tseq_printf(s, \"rxf1ovfl: %d\\n\", stats.rxf1ovfl);\n\tseq_printf(s, \"rxf2ovfl: %d\\n\", stats.rxf2ovfl);\n\tseq_printf(s, \"txsfovfl: %d\\n\", stats.txsfovfl);\n\tseq_printf(s, \"pmqovfl: %d\\n\", stats.pmqovfl);\n\tseq_printf(s, \"rxcgprqfrm: %d\\n\", stats.rxcgprqfrm);\n\tseq_printf(s, \"rxcgprsqovfl: %d\\n\", stats.rxcgprsqovfl);\n\tseq_printf(s, \"txcgprsfail: %d\\n\", stats.txcgprsfail);\n\tseq_printf(s, \"txcgprssuc: %d\\n\", stats.txcgprssuc);\n\tseq_printf(s, \"prs_timeout: %d\\n\", stats.prs_timeout);\n\tseq_printf(s, \"rxnack: %d\\n\", stats.rxnack);\n\tseq_printf(s, \"frmscons: %d\\n\", stats.frmscons);\n\tseq_printf(s, \"txnack: %d\\n\", stats.txnack);\n\tseq_printf(s, \"txglitch_nack: %d\\n\", stats.txglitch_nack);\n\tseq_printf(s, \"txburst: %d\\n\", stats.txburst);\n\tseq_printf(s, \"bphy_rxcrsglitch: %d\\n\", stats.bphy_rxcrsglitch);\n\tseq_printf(s, \"phywatchdog: %d\\n\", stats.phywatchdog);\n\tseq_printf(s, \"bphy_badplcp: %d\\n\", stats.bphy_badplcp);\n\treturn 0;\n}\n\nstruct brcms_debugfs_entry {\n\tint (*read)(struct seq_file *seq, void *data);\n\tstruct brcms_pub *drvr;\n};\n\nstatic int brcms_debugfs_entry_open(struct inode *inode, struct file *f)\n{\n\tstruct brcms_debugfs_entry *entry = inode->i_private;\n\n\treturn single_open(f, entry->read, entry->drvr);\n}\n\nstatic const struct file_operations brcms_debugfs_def_ops = {\n\t.owner = THIS_MODULE,\n\t.open = brcms_debugfs_entry_open,\n\t.release = single_release,\n\t.read = seq_read,\n\t.llseek = seq_lseek\n};\n\nstatic void\nbrcms_debugfs_add_entry(struct brcms_pub *drvr, const char *fn,\n\t\t\tint (*read_fn)(struct seq_file *seq, void *data))\n{\n\tstruct device *dev = &drvr->wlc->hw->d11core->dev;\n\tstruct dentry *dentry =  drvr->dbgfs_dir;\n\tstruct brcms_debugfs_entry *entry;\n\n\tentry = devm_kzalloc(dev, sizeof(*entry), GFP_KERNEL);\n\tif (!entry)\n\t\treturn;\n\n\tentry->read = read_fn;\n\tentry->drvr = drvr;\n\n\tdebugfs_create_file(fn, 0444, dentry, entry, &brcms_debugfs_def_ops);\n}\n\nvoid brcms_debugfs_create_files(struct brcms_pub *drvr)\n{\n\tbrcms_debugfs_add_entry(drvr, \"hardware\", brcms_debugfs_hardware_read);\n\tbrcms_debugfs_add_entry(drvr, \"macstat\", brcms_debugfs_macstat_read);\n}\n\n#define __brcms_fn(fn)\t\t\t\t\t\t\\\nvoid __brcms_ ##fn(struct device *dev, const char *fmt, ...)\t\\\n{\t\t\t\t\t\t\t\t\\\n\tstruct va_format vaf = {\t\t\t\t\\\n\t\t.fmt = fmt,\t\t\t\t\t\\\n\t};\t\t\t\t\t\t\t\\\n\tva_list args;\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\\\n\tva_start(args, fmt);\t\t\t\t\t\\\n\tvaf.va = &args;\t\t\t\t\t\t\\\n\tdev_ ##fn(dev, \"%pV\", &vaf);\t\t\t\t\\\n\ttrace_brcms_ ##fn(&vaf);\t\t\t\t\\\n\tva_end(args);\t\t\t\t\t\t\\\n}\n\n__brcms_fn(info)\n__brcms_fn(warn)\n__brcms_fn(err)\n__brcms_fn(crit)\n\n#if defined(CONFIG_BRCMDBG) || defined(CONFIG_BRCM_TRACING)\nvoid __brcms_dbg(struct device *dev, u32 level, const char *func,\n\t\t const char *fmt, ...)\n{\n\tstruct va_format vaf = {\n\t\t.fmt = fmt,\n\t};\n\tva_list args;\n\n\tva_start(args, fmt);\n\tvaf.va = &args;\n#ifdef CONFIG_BRCMDBG\n\tif ((brcm_msg_level & level) && net_ratelimit())\n\t\tdev_err(dev, \"%s %pV\", func, &vaf);\n#endif\n\ttrace_brcms_dbg(level, func, &vaf);\n\tva_end(args);\n}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}