{
  "module_name": "pmu.c",
  "hash_id": "12ea86dd2476b2ee9645cef303c55011135332b09f17e1931fa2ed8ecf358729",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/brcm80211/brcmsmac/pmu.c",
  "human_readable_source": " \n\n#include <linux/delay.h>\n#include <linux/io.h>\n\n#include <brcm_hw_ids.h>\n#include <chipcommon.h>\n#include <brcmu_utils.h>\n#include \"pub.h\"\n#include \"aiutils.h\"\n#include \"pmu.h\"\n#include \"soc.h\"\n\n \n#define EXT_ILP_HZ 32768\n\n \n#define ILP_CALC_DUR\t10\n\n \n#define\tPCTL_ILP_DIV_MASK\t0xffff0000\n#define\tPCTL_ILP_DIV_SHIFT\t16\n#define PCTL_PLL_PLLCTL_UPD\t0x00000400\t \n#define PCTL_NOILP_ON_WAIT\t0x00000200\t \n#define\tPCTL_HT_REQ_EN\t\t0x00000100\n#define\tPCTL_ALP_REQ_EN\t\t0x00000080\n#define\tPCTL_XTALFREQ_MASK\t0x0000007c\n#define\tPCTL_XTALFREQ_SHIFT\t2\n#define\tPCTL_ILP_DIV_EN\t\t0x00000002\n#define\tPCTL_LPO_SEL\t\t0x00000001\n\n \n#define\tILP_CLOCK\t\t32000\n\n \n#define\tALP_CLOCK\t\t20000000\n\n \n#define PST_EXTLPOAVAIL\t0x0100\n#define PST_WDRESET\t0x0080\n#define\tPST_INTPEND\t0x0040\n#define\tPST_SBCLKST\t0x0030\n#define\tPST_SBCLKST_ILP\t0x0010\n#define\tPST_SBCLKST_ALP\t0x0020\n#define\tPST_SBCLKST_HT\t0x0030\n#define\tPST_ALPAVAIL\t0x0008\n#define\tPST_HTAVAIL\t0x0004\n#define\tPST_RESINIT\t0x0003\n\n \n#define PMURES_BIT(bit)\t(1 << (bit))\n\n \n\n \n#define\tPMU_XTALFREQ_REG_ILPCTR_MASK\t0x00001FFF\n#define\tPMU_XTALFREQ_REG_MEASURE_MASK\t0x80000000\n#define\tPMU_XTALFREQ_REG_MEASURE_SHIFT\t31\n\n \n#define\tRES4313_BB_PU_RSRC\t\t0\n#define\tRES4313_ILP_REQ_RSRC\t\t1\n#define\tRES4313_XTAL_PU_RSRC\t\t2\n#define\tRES4313_ALP_AVAIL_RSRC\t\t3\n#define\tRES4313_RADIO_PU_RSRC\t\t4\n#define\tRES4313_BG_PU_RSRC\t\t5\n#define\tRES4313_VREG1P4_PU_RSRC\t\t6\n#define\tRES4313_AFE_PWRSW_RSRC\t\t7\n#define\tRES4313_RX_PWRSW_RSRC\t\t8\n#define\tRES4313_TX_PWRSW_RSRC\t\t9\n#define\tRES4313_BB_PWRSW_RSRC\t\t10\n#define\tRES4313_SYNTH_PWRSW_RSRC\t11\n#define\tRES4313_MISC_PWRSW_RSRC\t\t12\n#define\tRES4313_BB_PLL_PWRSW_RSRC\t13\n#define\tRES4313_HT_AVAIL_RSRC\t\t14\n#define\tRES4313_MACPHY_CLK_AVAIL_RSRC\t15\n\nu16 si_pmu_fast_pwrup_delay(struct si_pub *sih)\n{\n\tuint delay = PMU_MAX_TRANSITION_DLY;\n\n\tswitch (ai_get_chip_id(sih)) {\n\tcase BCMA_CHIP_ID_BCM43224:\n\tcase BCMA_CHIP_ID_BCM43225:\n\tcase BCMA_CHIP_ID_BCM4313:\n\t\tdelay = 3700;\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn (u16) delay;\n}\n\nu32 si_pmu_measure_alpclk(struct si_pub *sih)\n{\n\tstruct si_info *sii = container_of(sih, struct si_info, pub);\n\tstruct bcma_device *core;\n\tu32 alp_khz;\n\n\tif (ai_get_pmurev(sih) < 10)\n\t\treturn 0;\n\n\t \n\tcore = sii->icbus->drv_cc.core;\n\n\tif (bcma_read32(core, CHIPCREGOFFS(pmustatus)) & PST_EXTLPOAVAIL) {\n\t\tu32 ilp_ctr, alp_hz;\n\n\t\t \n\t\tbcma_write32(core, CHIPCREGOFFS(pmu_xtalfreq),\n\t\t\t    1U << PMU_XTALFREQ_REG_MEASURE_SHIFT);\n\n\t\t \n\t\tudelay(1000);\n\n\t\t \n\t\tilp_ctr = bcma_read32(core, CHIPCREGOFFS(pmu_xtalfreq)) &\n\t\t\t  PMU_XTALFREQ_REG_ILPCTR_MASK;\n\n\t\t \n\t\tbcma_write32(core, CHIPCREGOFFS(pmu_xtalfreq), 0);\n\n\t\t \n\t\talp_hz = (ilp_ctr * EXT_ILP_HZ) / 4;\n\n\t\t \n\t\talp_khz = (alp_hz + 50000) / 100000 * 100;\n\t} else\n\t\talp_khz = 0;\n\n\treturn alp_khz;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}