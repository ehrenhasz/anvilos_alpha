{
  "module_name": "d11.c",
  "hash_id": "27ad4792c617b836eaed6cf89a1de9084aa0af95db4f20cc0b14c32729c6996f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/brcm80211/brcmutil/d11.c",
  "human_readable_source": "\n \n \n\n#include <linux/module.h>\n\n#include <brcmu_utils.h>\n#include <brcmu_wifi.h>\n#include <brcmu_d11.h>\n\nstatic u16 d11n_sb(enum brcmu_chan_sb sb)\n{\n\tswitch (sb) {\n\tcase BRCMU_CHAN_SB_NONE:\n\t\treturn BRCMU_CHSPEC_D11N_SB_N;\n\tcase BRCMU_CHAN_SB_L:\n\t\treturn BRCMU_CHSPEC_D11N_SB_L;\n\tcase BRCMU_CHAN_SB_U:\n\t\treturn BRCMU_CHSPEC_D11N_SB_U;\n\tdefault:\n\t\tWARN_ON(1);\n\t}\n\treturn 0;\n}\n\nstatic u16 d11n_bw(enum brcmu_chan_bw bw)\n{\n\tswitch (bw) {\n\tcase BRCMU_CHAN_BW_20:\n\t\treturn BRCMU_CHSPEC_D11N_BW_20;\n\tcase BRCMU_CHAN_BW_40:\n\t\treturn BRCMU_CHSPEC_D11N_BW_40;\n\tdefault:\n\t\tWARN_ON(1);\n\t}\n\treturn 0;\n}\n\nstatic void brcmu_d11n_encchspec(struct brcmu_chan *ch)\n{\n\tif (ch->bw == BRCMU_CHAN_BW_20)\n\t\tch->sb = BRCMU_CHAN_SB_NONE;\n\n\tch->chspec = 0;\n\tbrcmu_maskset16(&ch->chspec, BRCMU_CHSPEC_CH_MASK,\n\t\t\tBRCMU_CHSPEC_CH_SHIFT, ch->chnum);\n\tbrcmu_maskset16(&ch->chspec, BRCMU_CHSPEC_D11N_SB_MASK,\n\t\t\t0, d11n_sb(ch->sb));\n\tbrcmu_maskset16(&ch->chspec, BRCMU_CHSPEC_D11N_BW_MASK,\n\t\t\t0, d11n_bw(ch->bw));\n\n\tif (ch->chnum <= CH_MAX_2G_CHANNEL)\n\t\tch->chspec |= BRCMU_CHSPEC_D11N_BND_2G;\n\telse\n\t\tch->chspec |= BRCMU_CHSPEC_D11N_BND_5G;\n}\n\nstatic u16 d11ac_bw(enum brcmu_chan_bw bw)\n{\n\tswitch (bw) {\n\tcase BRCMU_CHAN_BW_20:\n\t\treturn BRCMU_CHSPEC_D11AC_BW_20;\n\tcase BRCMU_CHAN_BW_40:\n\t\treturn BRCMU_CHSPEC_D11AC_BW_40;\n\tcase BRCMU_CHAN_BW_80:\n\t\treturn BRCMU_CHSPEC_D11AC_BW_80;\n\tcase BRCMU_CHAN_BW_160:\n\t\treturn BRCMU_CHSPEC_D11AC_BW_160;\n\tdefault:\n\t\tWARN_ON(1);\n\t}\n\treturn 0;\n}\n\nstatic void brcmu_d11ac_encchspec(struct brcmu_chan *ch)\n{\n\tif (ch->bw == BRCMU_CHAN_BW_20 || ch->sb == BRCMU_CHAN_SB_NONE)\n\t\tch->sb = BRCMU_CHAN_SB_L;\n\n\tbrcmu_maskset16(&ch->chspec, BRCMU_CHSPEC_CH_MASK,\n\t\t\tBRCMU_CHSPEC_CH_SHIFT, ch->chnum);\n\tbrcmu_maskset16(&ch->chspec, BRCMU_CHSPEC_D11AC_SB_MASK,\n\t\t\tBRCMU_CHSPEC_D11AC_SB_SHIFT, ch->sb);\n\tbrcmu_maskset16(&ch->chspec, BRCMU_CHSPEC_D11AC_BW_MASK,\n\t\t\t0, d11ac_bw(ch->bw));\n\n\tch->chspec &= ~BRCMU_CHSPEC_D11AC_BND_MASK;\n\tif (ch->chnum <= CH_MAX_2G_CHANNEL)\n\t\tch->chspec |= BRCMU_CHSPEC_D11AC_BND_2G;\n\telse\n\t\tch->chspec |= BRCMU_CHSPEC_D11AC_BND_5G;\n}\n\nstatic void brcmu_d11n_decchspec(struct brcmu_chan *ch)\n{\n\tu16 val;\n\n\tch->chnum = (u8)(ch->chspec & BRCMU_CHSPEC_CH_MASK);\n\tch->control_ch_num = ch->chnum;\n\n\tswitch (ch->chspec & BRCMU_CHSPEC_D11N_BW_MASK) {\n\tcase BRCMU_CHSPEC_D11N_BW_20:\n\t\tch->bw = BRCMU_CHAN_BW_20;\n\t\tch->sb = BRCMU_CHAN_SB_NONE;\n\t\tbreak;\n\tcase BRCMU_CHSPEC_D11N_BW_40:\n\t\tch->bw = BRCMU_CHAN_BW_40;\n\t\tval = ch->chspec & BRCMU_CHSPEC_D11N_SB_MASK;\n\t\tif (val == BRCMU_CHSPEC_D11N_SB_L) {\n\t\t\tch->sb = BRCMU_CHAN_SB_L;\n\t\t\tch->control_ch_num -= CH_10MHZ_APART;\n\t\t} else {\n\t\t\tch->sb = BRCMU_CHAN_SB_U;\n\t\t\tch->control_ch_num += CH_10MHZ_APART;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tWARN_ONCE(1, \"Invalid chanspec 0x%04x\\n\", ch->chspec);\n\t\tbreak;\n\t}\n\n\tswitch (ch->chspec & BRCMU_CHSPEC_D11N_BND_MASK) {\n\tcase BRCMU_CHSPEC_D11N_BND_5G:\n\t\tch->band = BRCMU_CHAN_BAND_5G;\n\t\tbreak;\n\tcase BRCMU_CHSPEC_D11N_BND_2G:\n\t\tch->band = BRCMU_CHAN_BAND_2G;\n\t\tbreak;\n\tdefault:\n\t\tWARN_ONCE(1, \"Invalid chanspec 0x%04x\\n\", ch->chspec);\n\t\tbreak;\n\t}\n}\n\nstatic void brcmu_d11ac_decchspec(struct brcmu_chan *ch)\n{\n\tu16 val;\n\n\tch->chnum = (u8)(ch->chspec & BRCMU_CHSPEC_CH_MASK);\n\tch->control_ch_num = ch->chnum;\n\n\tswitch (ch->chspec & BRCMU_CHSPEC_D11AC_BW_MASK) {\n\tcase BRCMU_CHSPEC_D11AC_BW_20:\n\t\tch->bw = BRCMU_CHAN_BW_20;\n\t\tch->sb = BRCMU_CHAN_SB_NONE;\n\t\tbreak;\n\tcase BRCMU_CHSPEC_D11AC_BW_40:\n\t\tch->bw = BRCMU_CHAN_BW_40;\n\t\tval = ch->chspec & BRCMU_CHSPEC_D11AC_SB_MASK;\n\t\tif (val == BRCMU_CHSPEC_D11AC_SB_L) {\n\t\t\tch->sb = BRCMU_CHAN_SB_L;\n\t\t\tch->control_ch_num -= CH_10MHZ_APART;\n\t\t} else if (val == BRCMU_CHSPEC_D11AC_SB_U) {\n\t\t\tch->sb = BRCMU_CHAN_SB_U;\n\t\t\tch->control_ch_num += CH_10MHZ_APART;\n\t\t} else {\n\t\t\tWARN_ONCE(1, \"Invalid chanspec 0x%04x\\n\", ch->chspec);\n\t\t}\n\t\tbreak;\n\tcase BRCMU_CHSPEC_D11AC_BW_80:\n\t\tch->bw = BRCMU_CHAN_BW_80;\n\t\tch->sb = brcmu_maskget16(ch->chspec, BRCMU_CHSPEC_D11AC_SB_MASK,\n\t\t\t\t\t BRCMU_CHSPEC_D11AC_SB_SHIFT);\n\t\tswitch (ch->sb) {\n\t\tcase BRCMU_CHAN_SB_LL:\n\t\t\tch->control_ch_num -= CH_30MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_LU:\n\t\t\tch->control_ch_num -= CH_10MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_UL:\n\t\t\tch->control_ch_num += CH_10MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_UU:\n\t\t\tch->control_ch_num += CH_30MHZ_APART;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tWARN_ONCE(1, \"Invalid chanspec 0x%04x\\n\", ch->chspec);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tcase BRCMU_CHSPEC_D11AC_BW_160:\n\t\tch->bw = BRCMU_CHAN_BW_160;\n\t\tch->sb = brcmu_maskget16(ch->chspec, BRCMU_CHSPEC_D11AC_SB_MASK,\n\t\t\t\t\t BRCMU_CHSPEC_D11AC_SB_SHIFT);\n\t\tswitch (ch->sb) {\n\t\tcase BRCMU_CHAN_SB_LLL:\n\t\t\tch->control_ch_num -= CH_70MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_LLU:\n\t\t\tch->control_ch_num -= CH_50MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_LUL:\n\t\t\tch->control_ch_num -= CH_30MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_LUU:\n\t\t\tch->control_ch_num -= CH_10MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_ULL:\n\t\t\tch->control_ch_num += CH_10MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_ULU:\n\t\t\tch->control_ch_num += CH_30MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_UUL:\n\t\t\tch->control_ch_num += CH_50MHZ_APART;\n\t\t\tbreak;\n\t\tcase BRCMU_CHAN_SB_UUU:\n\t\t\tch->control_ch_num += CH_70MHZ_APART;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tWARN_ONCE(1, \"Invalid chanspec 0x%04x\\n\", ch->chspec);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tcase BRCMU_CHSPEC_D11AC_BW_8080:\n\tdefault:\n\t\tWARN_ONCE(1, \"Invalid chanspec 0x%04x\\n\", ch->chspec);\n\t\tbreak;\n\t}\n\n\tswitch (ch->chspec & BRCMU_CHSPEC_D11AC_BND_MASK) {\n\tcase BRCMU_CHSPEC_D11AC_BND_5G:\n\t\tch->band = BRCMU_CHAN_BAND_5G;\n\t\tbreak;\n\tcase BRCMU_CHSPEC_D11AC_BND_2G:\n\t\tch->band = BRCMU_CHAN_BAND_2G;\n\t\tbreak;\n\tdefault:\n\t\tWARN_ONCE(1, \"Invalid chanspec 0x%04x\\n\", ch->chspec);\n\t\tbreak;\n\t}\n}\n\nvoid brcmu_d11_attach(struct brcmu_d11inf *d11inf)\n{\n\tif (d11inf->io_type == BRCMU_D11N_IOTYPE) {\n\t\td11inf->encchspec = brcmu_d11n_encchspec;\n\t\td11inf->decchspec = brcmu_d11n_decchspec;\n\t} else {\n\t\td11inf->encchspec = brcmu_d11ac_encchspec;\n\t\td11inf->decchspec = brcmu_d11ac_decchspec;\n\t}\n}\nEXPORT_SYMBOL(brcmu_d11_attach);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}