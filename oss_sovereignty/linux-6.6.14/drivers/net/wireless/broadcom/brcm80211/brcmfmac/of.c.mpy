{
  "module_name": "of.c",
  "hash_id": "e19b17f78569eb18c3e3fa306633ca519b85540caf4eb4ce9284b9374727bde9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/brcm80211/brcmfmac/of.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/of.h>\n#include <linux/of_irq.h>\n#include <linux/of_net.h>\n\n#include <defs.h>\n#include \"debug.h\"\n#include \"core.h\"\n#include \"common.h\"\n#include \"of.h\"\n\nstatic int brcmf_of_get_country_codes(struct device *dev,\n\t\t\t\t      struct brcmf_mp_device *settings)\n{\n\tstruct device_node *np = dev->of_node;\n\tstruct brcmfmac_pd_cc_entry *cce;\n\tstruct brcmfmac_pd_cc *cc;\n\tint count;\n\tint i;\n\n\tcount = of_property_count_strings(np, \"brcm,ccode-map\");\n\tif (count < 0) {\n\t\t \n\t\tsettings->trivial_ccode_map =\n\t\t\tof_property_read_bool(np, \"brcm,ccode-map-trivial\");\n\n\t\t \n\t\treturn (count == -EINVAL) ? 0 : count;\n\t}\n\n\tcc = devm_kzalloc(dev, struct_size(cc, table, count), GFP_KERNEL);\n\tif (!cc)\n\t\treturn -ENOMEM;\n\n\tcc->table_size = count;\n\n\tfor (i = 0; i < count; i++) {\n\t\tconst char *map;\n\n\t\tcce = &cc->table[i];\n\n\t\tif (of_property_read_string_index(np, \"brcm,ccode-map\",\n\t\t\t\t\t\t  i, &map))\n\t\t\tcontinue;\n\n\t\t \n\t\tif (sscanf(map, \"%2c-%2c-%d\", cce->iso3166, cce->cc,\n\t\t\t   &cce->rev) != 3)\n\t\t\tbrcmf_err(\"failed to read country map %s\\n\", map);\n\t\telse\n\t\t\tbrcmf_dbg(INFO, \"%s-%s-%d\\n\", cce->iso3166, cce->cc,\n\t\t\t\t  cce->rev);\n\t}\n\n\tsettings->country_codes = cc;\n\n\treturn 0;\n}\n\nvoid brcmf_of_probe(struct device *dev, enum brcmf_bus_type bus_type,\n\t\t    struct brcmf_mp_device *settings)\n{\n\tstruct brcmfmac_sdio_pd *sdio = &settings->bus.sdio;\n\tstruct device_node *root, *np = dev->of_node;\n\tconst char *prop;\n\tint irq;\n\tint err;\n\tu32 irqf;\n\tu32 val;\n\n\t \n\terr = of_property_read_string(np, \"brcm,board-type\", &prop);\n\tif (!err)\n\t\tsettings->board_type = prop;\n\n\tif (!of_property_read_string(np, \"apple,antenna-sku\", &prop))\n\t\tsettings->antenna_sku = prop;\n\n\t \n\tprop = of_get_property(np, \"brcm,cal-blob\", &settings->cal_size);\n\tif (prop && settings->cal_size)\n\t\tsettings->cal_blob = prop;\n\n\t \n\troot = of_find_node_by_path(\"/\");\n\tif (root && err) {\n\t\tchar *board_type;\n\t\tconst char *tmp;\n\n\t\tof_property_read_string_index(root, \"compatible\", 0, &tmp);\n\n\t\t \n\t\tboard_type = devm_kstrdup(dev, tmp, GFP_KERNEL);\n\t\tif (!board_type) {\n\t\t\tof_node_put(root);\n\t\t\treturn;\n\t\t}\n\t\tstrreplace(board_type, '/', '-');\n\t\tsettings->board_type = board_type;\n\n\t\tof_node_put(root);\n\t}\n\n\tif (!np || !of_device_is_compatible(np, \"brcm,bcm4329-fmac\"))\n\t\treturn;\n\n\terr = brcmf_of_get_country_codes(dev, settings);\n\tif (err)\n\t\tbrcmf_err(\"failed to get OF country code map (err=%d)\\n\", err);\n\n\tof_get_mac_address(np, settings->mac);\n\n\tif (bus_type != BRCMF_BUSTYPE_SDIO)\n\t\treturn;\n\n\tif (of_property_read_u32(np, \"brcm,drive-strength\", &val) == 0)\n\t\tsdio->drive_strength = val;\n\n\t \n\tif (!of_property_present(np, \"interrupts\"))\n\t\treturn;\n\n\tirq = irq_of_parse_and_map(np, 0);\n\tif (!irq) {\n\t\tbrcmf_err(\"interrupt could not be mapped\\n\");\n\t\treturn;\n\t}\n\tirqf = irqd_get_trigger_type(irq_get_irq_data(irq));\n\n\tsdio->oob_irq_supported = true;\n\tsdio->oob_irq_nr = irq;\n\tsdio->oob_irq_flags = irqf;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}