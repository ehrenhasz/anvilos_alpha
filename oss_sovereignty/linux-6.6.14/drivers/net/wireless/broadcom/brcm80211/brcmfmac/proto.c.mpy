{
  "module_name": "proto.c",
  "hash_id": "9d68f619109f764f4bd1b441110521f25ae253971ae6b7bb7c7422b6a47484bd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/brcm80211/brcmfmac/proto.c",
  "human_readable_source": "\n \n\n\n #include <linux/types.h>\n#include <linux/slab.h>\n#include <linux/netdevice.h>\n\n#include <brcmu_wifi.h>\n#include \"core.h\"\n#include \"bus.h\"\n#include \"debug.h\"\n#include \"proto.h\"\n#include \"bcdc.h\"\n#include \"msgbuf.h\"\n\n\nint brcmf_proto_attach(struct brcmf_pub *drvr)\n{\n\tstruct brcmf_proto *proto;\n\n\tbrcmf_dbg(TRACE, \"Enter\\n\");\n\n\tproto = kzalloc(sizeof(*proto), GFP_ATOMIC);\n\tif (!proto)\n\t\tgoto fail;\n\n\tdrvr->proto = proto;\n\n\tif (drvr->bus_if->proto_type == BRCMF_PROTO_BCDC) {\n\t\tif (brcmf_proto_bcdc_attach(drvr))\n\t\t\tgoto fail;\n\t} else if (drvr->bus_if->proto_type == BRCMF_PROTO_MSGBUF) {\n\t\tif (brcmf_proto_msgbuf_attach(drvr))\n\t\t\tgoto fail;\n\t} else {\n\t\tbphy_err(drvr, \"Unsupported proto type %d\\n\",\n\t\t\t drvr->bus_if->proto_type);\n\t\tgoto fail;\n\t}\n\tif (!proto->tx_queue_data || (proto->hdrpull == NULL) ||\n\t    (proto->query_dcmd == NULL) || (proto->set_dcmd == NULL) ||\n\t    (proto->configure_addr_mode == NULL) ||\n\t    (proto->delete_peer == NULL) || (proto->add_tdls_peer == NULL) ||\n\t    (proto->debugfs_create == NULL)) {\n\t\tbphy_err(drvr, \"Not all proto handlers have been installed\\n\");\n\t\tgoto fail;\n\t}\n\treturn 0;\n\nfail:\n\tkfree(proto);\n\tdrvr->proto = NULL;\n\treturn -ENOMEM;\n}\n\nvoid brcmf_proto_detach(struct brcmf_pub *drvr)\n{\n\tbrcmf_dbg(TRACE, \"Enter\\n\");\n\n\tif (drvr->proto) {\n\t\tif (drvr->bus_if->proto_type == BRCMF_PROTO_BCDC)\n\t\t\tbrcmf_proto_bcdc_detach(drvr);\n\t\telse if (drvr->bus_if->proto_type == BRCMF_PROTO_MSGBUF)\n\t\t\tbrcmf_proto_msgbuf_detach(drvr);\n\t\tkfree(drvr->proto);\n\t\tdrvr->proto = NULL;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}