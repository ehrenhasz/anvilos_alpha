{
  "module_name": "xtlv.c",
  "hash_id": "a358eb251e1c806c5f50ac906efc62483249002470b0005eff4f589ce3ed8451",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/brcm80211/brcmfmac/xtlv.c",
  "human_readable_source": "\n \n\n#include <asm/unaligned.h>\n\n#include <linux/math.h>\n#include <linux/string.h>\n#include <linux/bug.h>\n\n#include \"xtlv.h\"\n\nstatic int brcmf_xtlv_header_size(u16 opts)\n{\n\tint len = (int)offsetof(struct brcmf_xtlv, data);\n\n\tif (opts & BRCMF_XTLV_OPTION_IDU8)\n\t\t--len;\n\tif (opts & BRCMF_XTLV_OPTION_LENU8)\n\t\t--len;\n\n\treturn len;\n}\n\nint brcmf_xtlv_data_size(int dlen, u16 opts)\n{\n\tint hsz;\n\n\thsz = brcmf_xtlv_header_size(opts);\n\tif (opts & BRCMF_XTLV_OPTION_ALIGN32)\n\t\treturn roundup(dlen + hsz, 4);\n\n\treturn dlen + hsz;\n}\n\nvoid brcmf_xtlv_pack_header(struct brcmf_xtlv *xtlv, u16 id, u16 len,\n\t\t\t    const u8 *data, u16 opts)\n{\n\tu8 *data_buf;\n\tu16 mask = BRCMF_XTLV_OPTION_IDU8 | BRCMF_XTLV_OPTION_LENU8;\n\n\tif (!(opts & mask)) {\n\t\tu8 *idp = (u8 *)xtlv;\n\t\tu8 *lenp = idp + sizeof(xtlv->id);\n\n\t\tput_unaligned_le16(id, idp);\n\t\tput_unaligned_le16(len, lenp);\n\t\tdata_buf = lenp + sizeof(u16);\n\t} else if ((opts & mask) == mask) {  \n\t\tu8 *idp = (u8 *)xtlv;\n\t\tu8 *lenp = idp + 1;\n\n\t\t*idp = (u8)id;\n\t\t*lenp = (u8)len;\n\t\tdata_buf = lenp + sizeof(u8);\n\t} else if (opts & BRCMF_XTLV_OPTION_IDU8) {  \n\t\tu8 *idp = (u8 *)xtlv;\n\t\tu8 *lenp = idp + 1;\n\n\t\t*idp = (u8)id;\n\t\tput_unaligned_le16(len, lenp);\n\t\tdata_buf = lenp + sizeof(u16);\n\t} else if (opts & BRCMF_XTLV_OPTION_LENU8) {  \n\t\tu8 *idp = (u8 *)xtlv;\n\t\tu8 *lenp = idp + sizeof(u16);\n\n\t\tput_unaligned_le16(id, idp);\n\t\t*lenp = (u8)len;\n\t\tdata_buf = lenp + sizeof(u8);\n\t} else {\n\t\tWARN(true, \"Unexpected xtlv option\");\n\t\treturn;\n\t}\n\n\tif (opts & BRCMF_XTLV_OPTION_LENU8) {\n\t\tWARN_ON(len > 0x00ff);\n\t\tlen &= 0xff;\n\t}\n\n\tif (data)\n\t\tmemcpy(data_buf, data, len);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}