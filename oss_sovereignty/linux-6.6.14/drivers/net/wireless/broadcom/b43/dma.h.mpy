{
  "module_name": "dma.h",
  "hash_id": "d58564f65ec46d735896c0161a84a99eb571e985fb702f85350086be9375ca4d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/b43/dma.h",
  "human_readable_source": " \n#ifndef B43_DMA_H_\n#define B43_DMA_H_\n\n#include <linux/err.h>\n\n#include \"b43.h\"\n\n\n \n#define B43_DMAIRQ_FATALMASK\t((1 << 10) | (1 << 11) | (1 << 12) \\\n\t\t\t\t\t | (1 << 14) | (1 << 15))\n#define B43_DMAIRQ_RDESC_UFLOW\t\t(1 << 13)\n#define B43_DMAIRQ_RX_DONE\t\t(1 << 16)\n\n \n\n \n#define B43_DMA32_TXCTL\t\t\t\t0x00\n#define\t\tB43_DMA32_TXENABLE\t\t\t0x00000001\n#define\t\tB43_DMA32_TXSUSPEND\t\t\t0x00000002\n#define\t\tB43_DMA32_TXLOOPBACK\t\t0x00000004\n#define\t\tB43_DMA32_TXFLUSH\t\t\t0x00000010\n#define\t\tB43_DMA32_TXPARITYDISABLE\t\t0x00000800\n#define\t\tB43_DMA32_TXADDREXT_MASK\t\t0x00030000\n#define\t\tB43_DMA32_TXADDREXT_SHIFT\t\t16\n#define B43_DMA32_TXRING\t\t\t\t0x04\n#define B43_DMA32_TXINDEX\t\t\t\t0x08\n#define B43_DMA32_TXSTATUS\t\t\t\t0x0C\n#define\t\tB43_DMA32_TXDPTR\t\t\t0x00000FFF\n#define\t\tB43_DMA32_TXSTATE\t\t\t0x0000F000\n#define\t\t\tB43_DMA32_TXSTAT_DISABLED\t0x00000000\n#define\t\t\tB43_DMA32_TXSTAT_ACTIVE\t0x00001000\n#define\t\t\tB43_DMA32_TXSTAT_IDLEWAIT\t0x00002000\n#define\t\t\tB43_DMA32_TXSTAT_STOPPED\t0x00003000\n#define\t\t\tB43_DMA32_TXSTAT_SUSP\t0x00004000\n#define\t\tB43_DMA32_TXERROR\t\t\t0x000F0000\n#define\t\t\tB43_DMA32_TXERR_NOERR\t0x00000000\n#define\t\t\tB43_DMA32_TXERR_PROT\t0x00010000\n#define\t\t\tB43_DMA32_TXERR_UNDERRUN\t0x00020000\n#define\t\t\tB43_DMA32_TXERR_BUFREAD\t0x00030000\n#define\t\t\tB43_DMA32_TXERR_DESCREAD\t0x00040000\n#define\t\tB43_DMA32_TXACTIVE\t\t\t0xFFF00000\n#define B43_DMA32_RXCTL\t\t\t\t0x10\n#define\t\tB43_DMA32_RXENABLE\t\t\t0x00000001\n#define\t\tB43_DMA32_RXFROFF_MASK\t\t0x000000FE\n#define\t\tB43_DMA32_RXFROFF_SHIFT\t\t1\n#define\t\tB43_DMA32_RXDIRECTFIFO\t\t0x00000100\n#define\t\tB43_DMA32_RXPARITYDISABLE\t\t0x00000800\n#define\t\tB43_DMA32_RXADDREXT_MASK\t\t0x00030000\n#define\t\tB43_DMA32_RXADDREXT_SHIFT\t\t16\n#define B43_DMA32_RXRING\t\t\t\t0x14\n#define B43_DMA32_RXINDEX\t\t\t\t0x18\n#define B43_DMA32_RXSTATUS\t\t\t\t0x1C\n#define\t\tB43_DMA32_RXDPTR\t\t\t0x00000FFF\n#define\t\tB43_DMA32_RXSTATE\t\t\t0x0000F000\n#define\t\t\tB43_DMA32_RXSTAT_DISABLED\t0x00000000\n#define\t\t\tB43_DMA32_RXSTAT_ACTIVE\t0x00001000\n#define\t\t\tB43_DMA32_RXSTAT_IDLEWAIT\t0x00002000\n#define\t\t\tB43_DMA32_RXSTAT_STOPPED\t0x00003000\n#define\t\tB43_DMA32_RXERROR\t\t\t0x000F0000\n#define\t\t\tB43_DMA32_RXERR_NOERR\t0x00000000\n#define\t\t\tB43_DMA32_RXERR_PROT\t0x00010000\n#define\t\t\tB43_DMA32_RXERR_OVERFLOW\t0x00020000\n#define\t\t\tB43_DMA32_RXERR_BUFWRITE\t0x00030000\n#define\t\t\tB43_DMA32_RXERR_DESCREAD\t0x00040000\n#define\t\tB43_DMA32_RXACTIVE\t\t\t0xFFF00000\n\n \nstruct b43_dmadesc32 {\n\t__le32 control;\n\t__le32 address;\n} __packed;\n#define B43_DMA32_DCTL_BYTECNT\t\t0x00001FFF\n#define B43_DMA32_DCTL_ADDREXT_MASK\t\t0x00030000\n#define B43_DMA32_DCTL_ADDREXT_SHIFT\t16\n#define B43_DMA32_DCTL_DTABLEEND\t\t0x10000000\n#define B43_DMA32_DCTL_IRQ\t\t\t0x20000000\n#define B43_DMA32_DCTL_FRAMEEND\t\t0x40000000\n#define B43_DMA32_DCTL_FRAMESTART\t\t0x80000000\n\n \n\n \n#define B43_DMA64_TXCTL\t\t\t\t0x00\n#define\t\tB43_DMA64_TXENABLE\t\t\t0x00000001\n#define\t\tB43_DMA64_TXSUSPEND\t\t\t0x00000002\n#define\t\tB43_DMA64_TXLOOPBACK\t\t0x00000004\n#define\t\tB43_DMA64_TXFLUSH\t\t\t0x00000010\n#define\t\tB43_DMA64_TXPARITYDISABLE\t\t0x00000800\n#define\t\tB43_DMA64_TXADDREXT_MASK\t\t0x00030000\n#define\t\tB43_DMA64_TXADDREXT_SHIFT\t\t16\n#define B43_DMA64_TXINDEX\t\t\t\t0x04\n#define B43_DMA64_TXRINGLO\t\t\t\t0x08\n#define B43_DMA64_TXRINGHI\t\t\t\t0x0C\n#define B43_DMA64_TXSTATUS\t\t\t\t0x10\n#define\t\tB43_DMA64_TXSTATDPTR\t\t0x00001FFF\n#define\t\tB43_DMA64_TXSTAT\t\t\t0xF0000000\n#define\t\t\tB43_DMA64_TXSTAT_DISABLED\t0x00000000\n#define\t\t\tB43_DMA64_TXSTAT_ACTIVE\t0x10000000\n#define\t\t\tB43_DMA64_TXSTAT_IDLEWAIT\t0x20000000\n#define\t\t\tB43_DMA64_TXSTAT_STOPPED\t0x30000000\n#define\t\t\tB43_DMA64_TXSTAT_SUSP\t0x40000000\n#define B43_DMA64_TXERROR\t\t\t\t0x14\n#define\t\tB43_DMA64_TXERRDPTR\t\t\t0x0001FFFF\n#define\t\tB43_DMA64_TXERR\t\t\t0xF0000000\n#define\t\t\tB43_DMA64_TXERR_NOERR\t0x00000000\n#define\t\t\tB43_DMA64_TXERR_PROT\t0x10000000\n#define\t\t\tB43_DMA64_TXERR_UNDERRUN\t0x20000000\n#define\t\t\tB43_DMA64_TXERR_TRANSFER\t0x30000000\n#define\t\t\tB43_DMA64_TXERR_DESCREAD\t0x40000000\n#define\t\t\tB43_DMA64_TXERR_CORE\t0x50000000\n#define B43_DMA64_RXCTL\t\t\t\t0x20\n#define\t\tB43_DMA64_RXENABLE\t\t\t0x00000001\n#define\t\tB43_DMA64_RXFROFF_MASK\t\t0x000000FE\n#define\t\tB43_DMA64_RXFROFF_SHIFT\t\t1\n#define\t\tB43_DMA64_RXDIRECTFIFO\t\t0x00000100\n#define\t\tB43_DMA64_RXPARITYDISABLE\t\t0x00000800\n#define\t\tB43_DMA64_RXADDREXT_MASK\t\t0x00030000\n#define\t\tB43_DMA64_RXADDREXT_SHIFT\t\t16\n#define B43_DMA64_RXINDEX\t\t\t\t0x24\n#define B43_DMA64_RXRINGLO\t\t\t\t0x28\n#define B43_DMA64_RXRINGHI\t\t\t\t0x2C\n#define B43_DMA64_RXSTATUS\t\t\t\t0x30\n#define\t\tB43_DMA64_RXSTATDPTR\t\t0x00001FFF\n#define\t\tB43_DMA64_RXSTAT\t\t\t0xF0000000\n#define\t\t\tB43_DMA64_RXSTAT_DISABLED\t0x00000000\n#define\t\t\tB43_DMA64_RXSTAT_ACTIVE\t0x10000000\n#define\t\t\tB43_DMA64_RXSTAT_IDLEWAIT\t0x20000000\n#define\t\t\tB43_DMA64_RXSTAT_STOPPED\t0x30000000\n#define\t\t\tB43_DMA64_RXSTAT_SUSP\t0x40000000\n#define B43_DMA64_RXERROR\t\t\t\t0x34\n#define\t\tB43_DMA64_RXERRDPTR\t\t\t0x0001FFFF\n#define\t\tB43_DMA64_RXERR\t\t\t0xF0000000\n#define\t\t\tB43_DMA64_RXERR_NOERR\t0x00000000\n#define\t\t\tB43_DMA64_RXERR_PROT\t0x10000000\n#define\t\t\tB43_DMA64_RXERR_UNDERRUN\t0x20000000\n#define\t\t\tB43_DMA64_RXERR_TRANSFER\t0x30000000\n#define\t\t\tB43_DMA64_RXERR_DESCREAD\t0x40000000\n#define\t\t\tB43_DMA64_RXERR_CORE\t0x50000000\n\n \nstruct b43_dmadesc64 {\n\t__le32 control0;\n\t__le32 control1;\n\t__le32 address_low;\n\t__le32 address_high;\n} __packed;\n#define B43_DMA64_DCTL0_DTABLEEND\t\t0x10000000\n#define B43_DMA64_DCTL0_IRQ\t\t\t0x20000000\n#define B43_DMA64_DCTL0_FRAMEEND\t\t0x40000000\n#define B43_DMA64_DCTL0_FRAMESTART\t\t0x80000000\n#define B43_DMA64_DCTL1_BYTECNT\t\t0x00001FFF\n#define B43_DMA64_DCTL1_ADDREXT_MASK\t0x00030000\n#define B43_DMA64_DCTL1_ADDREXT_SHIFT\t16\n\nstruct b43_dmadesc_generic {\n\tunion {\n\t\tstruct b43_dmadesc32 dma32;\n\t\tstruct b43_dmadesc64 dma64;\n\t} __packed;\n} __packed;\n\n \n#define B43_DMA32_RINGMEMSIZE\t\t4096\n#define B43_DMA64_RINGMEMSIZE\t\t8192\n \n#define B43_DMA0_RX_FW598_FO\t\t38\n#define B43_DMA0_RX_FW351_FO\t\t30\n\n \n#define B43_TXRING_SLOTS\t\t256\n#define B43_RXRING_SLOTS\t\t256\n#define B43_DMA0_RX_FW598_BUFSIZE\t(B43_DMA0_RX_FW598_FO + IEEE80211_MAX_FRAME_LEN)\n#define B43_DMA0_RX_FW351_BUFSIZE\t(B43_DMA0_RX_FW351_FO + IEEE80211_MAX_FRAME_LEN)\n\n \n#define B43_DMA_PTR_POISON\t\t((void *)ERR_PTR(-ENOMEM))\n#define b43_dma_ptr_is_poisoned(ptr)\t(unlikely((ptr) == B43_DMA_PTR_POISON))\n\n\nstruct sk_buff;\nstruct b43_private;\nstruct b43_txstatus;\n\nstruct b43_dmadesc_meta {\n\t \n\tstruct sk_buff *skb;\n\t \n\tdma_addr_t dmaaddr;\n\t \n\tbool is_last_fragment;\n};\n\nstruct b43_dmaring;\n\n \nstruct b43_dma_ops {\n\tstruct b43_dmadesc_generic *(*idx2desc) (struct b43_dmaring * ring,\n\t\t\t\t\t\t int slot,\n\t\t\t\t\t\t struct b43_dmadesc_meta **\n\t\t\t\t\t\t meta);\n\tvoid (*fill_descriptor) (struct b43_dmaring * ring,\n\t\t\t\t struct b43_dmadesc_generic * desc,\n\t\t\t\t dma_addr_t dmaaddr, u16 bufsize, int start,\n\t\t\t\t int end, int irq);\n\tvoid (*poke_tx) (struct b43_dmaring * ring, int slot);\n\tvoid (*tx_suspend) (struct b43_dmaring * ring);\n\tvoid (*tx_resume) (struct b43_dmaring * ring);\n\tint (*get_current_rxslot) (struct b43_dmaring * ring);\n\tvoid (*set_current_rxslot) (struct b43_dmaring * ring, int slot);\n};\n\nenum b43_dmatype {\n\tB43_DMA_30BIT\t= 30,\n\tB43_DMA_32BIT\t= 32,\n\tB43_DMA_64BIT\t= 64,\n};\n\nenum b43_addrtype {\n\tB43_DMA_ADDR_LOW,\n\tB43_DMA_ADDR_HIGH,\n\tB43_DMA_ADDR_EXT,\n};\n\nstruct b43_dmaring {\n\t \n\tconst struct b43_dma_ops *ops;\n\t \n\tvoid *descbase;\n\t \n\tstruct b43_dmadesc_meta *meta;\n\t \n\tu8 *txhdr_cache;\n\t \n\tdma_addr_t dmabase;\n\t \n\tint nr_slots;\n\t \n\tint used_slots;\n\t \n\tint current_slot;\n\t \n\tu32 frameoffset;\n\t \n\tu16 rx_buffersize;\n\t \n\tu16 mmio_base;\n\t \n\tint index;\n\t \n\tbool tx;\n\t \n\tenum b43_dmatype type;\n\t \n\tbool stopped;\n\t \n\tu8 queue_prio;\n\tstruct b43_wldev *dev;\n#ifdef CONFIG_B43_DEBUG\n\t \n\tint max_used_slots;\n\t \n\tunsigned long last_injected_overflow;\n\t \n\tu64 nr_succeed_tx_packets;\n\t \n\tu64 nr_failed_tx_packets;\n\t \n\tu64 nr_total_packet_tries;\n#endif  \n};\n\nstatic inline u32 b43_dma_read(struct b43_dmaring *ring, u16 offset)\n{\n\treturn b43_read32(ring->dev, ring->mmio_base + offset);\n}\n\nstatic inline void b43_dma_write(struct b43_dmaring *ring, u16 offset, u32 value)\n{\n\tb43_write32(ring->dev, ring->mmio_base + offset, value);\n}\n\nint b43_dma_init(struct b43_wldev *dev);\nvoid b43_dma_free(struct b43_wldev *dev);\n\nvoid b43_dma_tx_suspend(struct b43_wldev *dev);\nvoid b43_dma_tx_resume(struct b43_wldev *dev);\n\nint b43_dma_tx(struct b43_wldev *dev,\n\t       struct sk_buff *skb);\nvoid b43_dma_handle_txstatus(struct b43_wldev *dev,\n\t\t\t     const struct b43_txstatus *status);\n\nvoid b43_dma_handle_rx_overflow(struct b43_dmaring *ring);\n\nvoid b43_dma_rx(struct b43_dmaring *ring);\n\nvoid b43_dma_direct_fifo_rx(struct b43_wldev *dev,\n\t\t\t    unsigned int engine_index, bool enable);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}