{
  "module_name": "rfkill.c",
  "hash_id": "86149037e0f67564eea0d2502c8ee44dbedaf8f9d8358afeb8d33213029ce426",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireless/broadcom/b43legacy/rfkill.c",
  "human_readable_source": "\n \n\n#include \"radio.h\"\n#include \"b43legacy.h\"\n\n\n \nbool b43legacy_is_hw_radio_enabled(struct b43legacy_wldev *dev)\n{\n\tif (dev->dev->id.revision >= 3) {\n\t\tif (!(b43legacy_read32(dev, B43legacy_MMIO_RADIO_HWENABLED_HI)\n\t\t      & B43legacy_MMIO_RADIO_HWENABLED_HI_MASK))\n\t\t\treturn true;\n\t} else {\n\t\t \n\t\tif (b43legacy_status(dev) < B43legacy_STAT_STARTED)\n\t\t\treturn true;\n\t\tif (b43legacy_read16(dev, B43legacy_MMIO_RADIO_HWENABLED_LO)\n\t\t    & B43legacy_MMIO_RADIO_HWENABLED_LO_MASK)\n\t\t\treturn true;\n\t}\n\treturn false;\n}\n\n \nvoid b43legacy_rfkill_poll(struct ieee80211_hw *hw)\n{\n\tstruct b43legacy_wl *wl = hw_to_b43legacy_wl(hw);\n\tstruct b43legacy_wldev *dev = wl->current_dev;\n\tstruct ssb_bus *bus = dev->dev->bus;\n\tbool enabled;\n\tbool brought_up = false;\n\n\tmutex_lock(&wl->mutex);\n\tif (unlikely(b43legacy_status(dev) < B43legacy_STAT_INITIALIZED)) {\n\t\tif (ssb_bus_powerup(bus, 0)) {\n\t\t\tmutex_unlock(&wl->mutex);\n\t\t\treturn;\n\t\t}\n\t\tssb_device_enable(dev->dev, 0);\n\t\tbrought_up = true;\n\t}\n\n\tenabled = b43legacy_is_hw_radio_enabled(dev);\n\n\tif (unlikely(enabled != dev->radio_hw_enable)) {\n\t\tdev->radio_hw_enable = enabled;\n\t\tb43legacyinfo(wl, \"Radio hardware status changed to %s\\n\",\n\t\t\tenabled ? \"ENABLED\" : \"DISABLED\");\n\t\twiphy_rfkill_set_hw_state(hw->wiphy, !enabled);\n\t\tif (enabled != dev->phy.radio_on) {\n\t\t\tif (enabled)\n\t\t\t\tb43legacy_radio_turn_on(dev);\n\t\t\telse\n\t\t\t\tb43legacy_radio_turn_off(dev, 0);\n\t\t}\n\t}\n\n\tif (brought_up) {\n\t\tssb_device_disable(dev->dev, 0);\n\t\tssb_bus_may_powerdown(bus);\n\t}\n\n\tmutex_unlock(&wl->mutex);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}