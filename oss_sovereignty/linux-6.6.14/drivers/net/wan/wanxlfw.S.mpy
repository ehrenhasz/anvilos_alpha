{
  "module_name": "wanxlfw.S",
  "hash_id": "b948ce9b1a72b57d8572ccd2208994e219657da25cf7c9f210caa30e5ab21d69",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wan/wanxlfw.S",
  "human_readable_source": " \n.psize 0\n \n\n#include <linux/hdlc.h>\n#include <linux/hdlc/ioctl.h>\n#include \"wanxl.h\"\n\n \n\nMAX_RAM_SIZE\t= 16 * 1024 * 1024\t \n\nPCI9060_VECTOR\t= 0x0000006C\nCPM_IRQ_BASE\t= 0x40\nERROR_VECTOR\t= CPM_IRQ_BASE * 4\nSCC1_VECTOR\t= (CPM_IRQ_BASE + 0x1E) * 4\nSCC2_VECTOR\t= (CPM_IRQ_BASE + 0x1D) * 4\nSCC3_VECTOR\t= (CPM_IRQ_BASE + 0x1C) * 4\nSCC4_VECTOR\t= (CPM_IRQ_BASE + 0x1B) * 4\nCPM_IRQ_LEVEL\t= 4\nTIMER_IRQ\t= 128\nTIMER_IRQ_LEVEL = 4\nPITR_CONST\t= 0x100 + 16\t\t \n\nMBAR\t\t= 0x0003FF00\n\nVALUE_WINDOW\t= 0x40000000\nORDER_WINDOW\t= 0xC0000000\n\nPLX\t\t= 0xFFF90000\n\nCSRA\t\t= 0xFFFB0000\nCSRB\t\t= 0xFFFB0002\nCSRC\t\t= 0xFFFB0004\nCSRD\t\t= 0xFFFB0006\nSTATUS_CABLE_LL\t\t= 0x2000\nSTATUS_CABLE_DTR\t= 0x1000\n\nDPRBASE\t\t= 0xFFFC0000\n\nSCC1_BASE\t= DPRBASE + 0xC00\nMISC_BASE\t= DPRBASE + 0xCB0\nSCC2_BASE\t= DPRBASE + 0xD00\nSCC3_BASE\t= DPRBASE + 0xE00\nSCC4_BASE\t= DPRBASE + 0xF00\n\n \n \nSCC_RBASE\t= 0\t\t \nSCC_TBASE\t= 2\t\t \nSCC_RFCR\t= 4\t\t \nSCC_TFCR\t= 5\t\t \nSCC_MRBLR\t= 6\t\t \nSCC_C_MASK\t= 0x34\t\t \nSCC_C_PRES\t= 0x38\t\t \nSCC_MFLR\t= 0x46\t\t \n\nREGBASE\t\t= DPRBASE + 0x1000\nPICR\t\t= REGBASE + 0x026\t \nPITR\t\t= REGBASE + 0x02A\t \nOR1\t\t= REGBASE + 0x064\t \nCICR\t\t= REGBASE + 0x540\t \nCIMR\t\t= REGBASE + 0x548\t \nCISR\t\t= REGBASE + 0x54C\t \nPADIR\t\t= REGBASE + 0x550\t \nPAPAR\t\t= REGBASE + 0x552\t \nPAODR\t\t= REGBASE + 0x554\t \nPADAT\t\t= REGBASE + 0x556\t \n\nPCDIR\t\t= REGBASE + 0x560\t \nPCPAR\t\t= REGBASE + 0x562\t \nPCSO\t\t= REGBASE + 0x564\t \nPCDAT\t\t= REGBASE + 0x566\t \nPCINT\t\t= REGBASE + 0x568\t \nCR\t\t= REGBASE + 0x5C0\t \n\nSCC1_REGS\t= REGBASE + 0x600\nSCC2_REGS\t= REGBASE + 0x620\nSCC3_REGS\t= REGBASE + 0x640\nSCC4_REGS\t= REGBASE + 0x660\nSICR\t\t= REGBASE + 0x6EC\t \n\n \nSCC_GSMR_L\t= 0x00\t \nSCC_GSMR_H\t= 0x04\t \nSCC_PSMR\t= 0x08\t \nSCC_TODR\t= 0x0C\t \nSCC_DSR\t\t= 0x0E\t \nSCC_SCCE\t= 0x10\t \nSCC_SCCM\t= 0x14\t \nSCC_SCCS\t= 0x17\t \n\n#if QUICC_MEMCPY_USES_PLX\n\t.macro memcpy_from_pci src, dest, len  \n\taddl #3, \\len\n\tandl #0xFFFFFFFC, \\len\t\t \n\tmovel \\src, PLX_DMA_0_PCI\n\tmovel \\dest, PLX_DMA_0_LOCAL\n\tmovel \\len, PLX_DMA_0_LENGTH\n\tmovel #0x0103, PLX_DMA_CMD_STS\t \n\tbsr memcpy_from_pci_run\n\t.endm\n\n\t.macro memcpy_to_pci src, dest, len\n\taddl #3, \\len\n\tandl #0xFFFFFFFC, \\len\t\t \n\tmovel \\src, PLX_DMA_1_LOCAL\n\tmovel \\dest, PLX_DMA_1_PCI\n\tmovel \\len, PLX_DMA_1_LENGTH\n\tmovel #0x0301, PLX_DMA_CMD_STS\t \n\tbsr memcpy_to_pci_run\n\t.endm\n\n#else\n\n\t.macro memcpy src, dest, len\t \n\tmovel %d7, -(%sp)\t\t \n\tmovel \\len, %d7\t\t\t \n\tlsrl #2, \\len\n\tandl \\len, \\len\n\tbeq 99f\t\t\t\t \n\tsubl #1, \\len\t\t\t \n98:\tmovel (\\src)+, (\\dest)+\n\tdbfw \\len, 98b\n99:\tmovel %d7, \\len\n\tbtstl #1, \\len\n\tbeq 99f\n\tmovew (\\src)+, (\\dest)+\n99:\tbtstl #0, \\len\n\tbeq 99f\n\tmoveb (\\src)+, (\\dest)+\n99:\n\tmovel (%sp)+, %d7\n\t.endm\n\n\t.macro memcpy_from_pci src, dest, len\n\taddl #VALUE_WINDOW, \\src\n\tmemcpy \\src, \\dest, \\len\n\t.endm\n\n\t.macro memcpy_to_pci src, dest, len\n\taddl #VALUE_WINDOW, \\dest\n\tmemcpy \\src, \\dest, \\len\n\t.endm\n#endif\n\n\n\t.macro wait_for_command\n99:\tbtstl #0, CR\n\tbne 99b\n\t.endm\n\n\n\n\n \n\t.text\n\t.global _start\n_start:\tbra init\n\n\t.org _start + 4\nch_status_addr:\t.long 0, 0, 0, 0\nrx_descs_addr:\t.long 0\n\ninit:\n#if DETECT_RAM\n\tmovel OR1, %d0\n\tandl #0xF00007FF, %d0\t\t \n\torl #0xFFFF800 & ~(MAX_RAM_SIZE - 1), %d0  \n\tmovel %d0, OR1\n#endif\n\n\taddl #VALUE_WINDOW, rx_descs_addr  \n\tclrl %d0\t\t\t \ninit_1:\ttstl ch_status_addr(%d0)\n\tbeq init_2\n\taddl #VALUE_WINDOW, ch_status_addr(%d0)\ninit_2:\taddl #4, %d0\n\tcmpl #4 * 4, %d0\n\tbne init_1\n\n\tmovel #pci9060_interrupt, PCI9060_VECTOR\n\tmovel #error_interrupt, ERROR_VECTOR\n\tmovel #port_interrupt_1, SCC1_VECTOR\n\tmovel #port_interrupt_2, SCC2_VECTOR\n\tmovel #port_interrupt_3, SCC3_VECTOR\n\tmovel #port_interrupt_4, SCC4_VECTOR\n\tmovel #timer_interrupt, TIMER_IRQ * 4\n\n\tmovel #0x78000000, CIMR\t\t \n\tmovew #(TIMER_IRQ_LEVEL << 8) + TIMER_IRQ, PICR\t \n\tmovew #PITR_CONST, PITR\n\n\t \n\tmovel #0xD41F40 + (CPM_IRQ_LEVEL << 13), CICR\n\tmovel #0x543, PLX_DMA_0_MODE\t \n\tmovel #0x543, PLX_DMA_1_MODE\n\tmovel #0x0, PLX_DMA_0_DESC\t \n\tmovel #0x8, PLX_DMA_1_DESC\t \n\tmovel #0x101, PLX_DMA_CMD_STS\t \n\t \n\torl #0x000F0300, PLX_INTERRUPT_CS\n\n#if DETECT_RAM\n\tbsr ram_test\n#else\n\tmovel #1, PLX_MAILBOX_5\t\t \n#endif\n\tbsr check_csr\n\n\tmovew #0xFFFF, PAPAR\t\t \n\tclrw PADIR\t\t\t \n\tclrw PCSO\t\t\t \n\n\n \n\nmain:\tmovel channel_stats, %d7\t \n\tclrl channel_stats\n\n\ttstl %d7\n\tbne main_1\n\t \n\tstop #0x2200\t\t\t \n\tmovew #0x2700, %sr\t\t \n\tbra main\n\nmain_1:\tclrl %d0\t\t\t \n\tclrl %d6\t\t\t \n\nmain_l: btstl #DOORBELL_TO_CARD_CLOSE_0, %d7\n\tbeq main_op\n\tbclrl #DOORBELL_TO_CARD_OPEN_0, %d7  \n\tbsr close_port\nmain_op:\n\tbtstl #DOORBELL_TO_CARD_OPEN_0, %d7\n\tbeq main_cl\n\tbsr open_port\nmain_cl:\n\tbtstl #DOORBELL_TO_CARD_TX_0, %d7\n\tbeq main_txend\n\tbsr tx\nmain_txend:\n\tbtstl #TASK_SCC_0, %d7\n\tbeq main_next\n\tbsr tx_end\n\tbsr rx\n\nmain_next:\n\tlsrl #1, %d7\t\t\t \n\taddl #4, %d0\t\t\t \n\tcmpl #4 * 4, %d0\n\tbne main_l\n\tmovel %d6, PLX_DOORBELL_FROM_CARD  \n\tbra main\n\n\n \n\nopen_port:\t\t\t\t \n\tmovel ch_status_addr(%d0), %a0\t \n\ttstl STATUS_OPEN(%a0)\n\tbne open_port_ret\t\t \n\tmovel #1, STATUS_OPEN(%a0)\t \n \n\tclrl tx_in(%d0)\n\tclrl tx_out(%d0)\n\tclrl tx_count(%d0)\n\tclrl rx_in(%d0)\n\n\tmovel SICR, %d1\t\t\t \n\tandl clocking_mask(%d0), %d1\n\tcmpl #CLOCK_TXFROMRX, STATUS_CLOCKING(%a0)\n\tbne open_port_clock_ext\n\torl clocking_txfromrx(%d0), %d1\n\tbra open_port_set_clock\n\nopen_port_clock_ext:\n\torl clocking_ext(%d0), %d1\nopen_port_set_clock:\n\tmovel %d1, SICR\t\t\t \n\n\torw #STATUS_CABLE_DTR, csr_output(%d0)\t \n\tbsr check_csr\t\t\t \n\n \n\tmovel first_buffer(%d0), %d1\t \n\tmovel tx_first_bd(%d0), %a1\t \n\tmovel #TX_BUFFERS - 2, %d2\t \n\tmovel #0x18000000, %d3\t\t \n\tcmpl #PARITY_NONE, STATUS_PARITY(%a0)\n\tbeq open_port_tx_loop\n\tbsetl #26, %d3\t\t\t \nopen_port_tx_loop:\n\tmovel %d3, (%a1)+\t\t \n\tmovel %d1, (%a1)+\t\t \n\taddl #BUFFER_LENGTH, %d1\n\tdbfw %d2, open_port_tx_loop\n\n\tbsetl #29, %d3\t\t\t \n\tmovel %d3, (%a1)+\t\t \n\tmovel %d1, (%a1)+\t\t \n\n \n\tmovel #RX_BUFFERS - 2, %d2\t \nopen_port_rx_loop:\n\tmovel #0x90000000, (%a1)+\t \n\tmovel %d1, (%a1)+\t\t \n\taddl #BUFFER_LENGTH, %d1\n\tdbfw %d2, open_port_rx_loop\n\n\tmovel #0xB0000000, (%a1)+\t \n\tmovel %d1, (%a1)+\t\t \n\n \n\tmovel scc_base_addr(%d0), %a1\t \n\tmovel scc_reg_addr(%d0), %a2\t \n\n\tmovel #0xFFFF, SCC_SCCE(%a2)\t \n\tmovel #0x0000, SCC_SCCM(%a2)\t \n\n\tmovel tx_first_bd(%d0), %d1\n\tmovew %d1, SCC_TBASE(%a1)\t \n\taddl #TX_BUFFERS * 8, %d1\n\tmovew %d1, SCC_RBASE(%a1)\t \n\tmoveb #0x8, SCC_RFCR(%a1)\t \n\tmoveb #0x8, SCC_TFCR(%a1)\n\n \n\tcmpl #PARITY_CRC16_PR1_CCITT, STATUS_PARITY(%a0)\n\tbne open_port_parity_1\n\tclrw SCC_PSMR(%a2)\t\t \n\tmovel #0xF0B8, SCC_C_MASK(%a1)\n\tmovel #0xFFFF, SCC_C_PRES(%a1)\n\tmovew #HDLC_MAX_MRU + 2, SCC_MFLR(%a1)  \n\tmovew #2, parity_bytes(%d0)\n\tbra open_port_2\n\nopen_port_parity_1:\n\tcmpl #PARITY_CRC32_PR1_CCITT, STATUS_PARITY(%a0)\n\tbne open_port_parity_2\n\tmovew #0x0800, SCC_PSMR(%a2)\t \n\tmovel #0xDEBB20E3, SCC_C_MASK(%a1)\n\tmovel #0xFFFFFFFF, SCC_C_PRES(%a1)\n\tmovew #HDLC_MAX_MRU + 4, SCC_MFLR(%a1)  \n\tmovew #4, parity_bytes(%d0)\n\tbra open_port_2\n\nopen_port_parity_2:\n\tcmpl #PARITY_CRC16_PR0_CCITT, STATUS_PARITY(%a0)\n\tbne open_port_parity_3\n\tclrw SCC_PSMR(%a2)\t\t \n\tmovel #0xF0B8, SCC_C_MASK(%a1)\n\tclrl SCC_C_PRES(%a1)\n\tmovew #HDLC_MAX_MRU + 2, SCC_MFLR(%a1)  \n\tmovew #2, parity_bytes(%d0)\n\tbra open_port_2\n\nopen_port_parity_3:\n\tcmpl #PARITY_CRC32_PR0_CCITT, STATUS_PARITY(%a0)\n\tbne open_port_parity_4\n\tmovew #0x0800, SCC_PSMR(%a2)\t \n\tmovel #0xDEBB20E3, SCC_C_MASK(%a1)\n\tclrl SCC_C_PRES(%a1)\n\tmovew #HDLC_MAX_MRU + 4, SCC_MFLR(%a1)  \n\tmovew #4, parity_bytes(%d0)\n\tbra open_port_2\n\nopen_port_parity_4:\n\tclrw SCC_PSMR(%a2)\t\t \n\tmovel #0xF0B8, SCC_C_MASK(%a1)\n\tmovel #0xFFFF, SCC_C_PRES(%a1)\n\tmovew #HDLC_MAX_MRU, SCC_MFLR(%a1)  \n\tclrw parity_bytes(%d0)\n\nopen_port_2:\n\tmovel #0x00000003, SCC_GSMR_H(%a2)  \n\tcmpl #ENCODING_NRZI, STATUS_ENCODING(%a0)\n\tbne open_port_nrz\n\tmovel #0x10040900, SCC_GSMR_L(%a2)  \n\tbra open_port_3\n\nopen_port_nrz:\n\tmovel #0x10040000, SCC_GSMR_L(%a2)  \nopen_port_3:\n\tmovew #BUFFER_LENGTH, SCC_MRBLR(%a1)\n\tmovel %d0, %d1\n\tlsll #4, %d1\t\t\t \n\torl #1, %d1\n\tmovew %d1, CR\t\t\t \n\twait_for_command\n\n\t \n\tmovew #0x001F, SCC_SCCM(%a2)\t \n\torl #0x00000030, SCC_GSMR_L(%a2)  \nopen_port_ret:\n\trts\n\n\n \n\nclose_port:\t\t\t\t \n\tmovel scc_reg_addr(%d0), %a0\t \n\tclrw SCC_SCCM(%a0)\t\t \n\tandl #0xFFFFFFCF, SCC_GSMR_L(%a0)  \n\n\tandw #~STATUS_CABLE_DTR, csr_output(%d0)  \n\tbsr check_csr\t\t\t \n\n\tmovel ch_status_addr(%d0), %d1\n\tclrl STATUS_OPEN(%d1)\t\t \n\trts\n\n\n \n \ntx:\t\t\t\t\t \n\tcmpl #TX_BUFFERS, tx_count(%d0)\n\tbeq tx_ret\t\t\t \n\n\tmovel tx_out(%d0), %d1\n\tmovel %d1, %d2\t\t\t \n\tmulul #DESC_LENGTH, %d2\t\t \n\taddl ch_status_addr(%d0), %d2\n\taddl #STATUS_TX_DESCS, %d2\t \n\tcmpl #PACKET_FULL, (%d2)\t \n\tbne tx_ret\n\n \n\tmovel 4(%d2), %a0\t\t \n\tlsll #3, %d1\t\t\t \n\taddl tx_first_bd(%d0), %d1\t \n\n\tmovel 4(%d1), %a1\t\t \n\tmovel 8(%d2), %d2\t\t \n\tmovew %d2, 2(%d1)\t\t \n\tmemcpy_from_pci %a0, %a1, %d2\n\tbsetl #31, (%d1)\t\t \n\n \n\tmovel tx_out(%d0), %d1\n\taddl #1, %d1\n\tcmpl #TX_BUFFERS, %d1\n\tbne tx_1\n\tclrl %d1\ntx_1:\tmovel %d1, tx_out(%d0)\n\n\taddl #1, tx_count(%d0)\n\tbra tx\n\ntx_ret: rts\n\n\n \n\n \nrx:\tmovel rx_in(%d0), %d1\t\t \n\tlsll #3, %d1\t\t\t \n\taddl rx_first_bd(%d0), %d1\t \n\tmovew (%d1), %d2\t\t \n\tbtstl #15, %d2\n\tbne rx_ret\t\t\t \n\n\tbtstl #1, %d2\n\tbne rx_overrun\n\n\ttstw parity_bytes(%d0)\n\tbne rx_parity\n\tbclrl #2, %d2\t\t\t \nrx_parity:\n\tandw #0x0CBC, %d2\t\t \n\tcmpw #0x0C00, %d2\t\t \n\tbne rx_bad_frame\n\tclrl %d3\n\tmovew 2(%d1), %d3\n\tsubw parity_bytes(%d0), %d3\t \n\tcmpw #HDLC_MAX_MRU, %d3\n\tbgt rx_bad_frame\n\nrx_good_frame:\n\tmovel rx_out, %d2\n\tmulul #DESC_LENGTH, %d2\n\taddl rx_descs_addr, %d2\t\t \n\tcmpl #PACKET_EMPTY, (%d2)\t \n\tbne rx_overrun\n\n\tmovel %d3, 8(%d2)\n\tmovel 4(%d1), %a0\t\t \n\tmovel 4(%d2), %a1\n\ttstl %a1\n\tbeq rx_ignore_data\n\tmemcpy_to_pci %a0, %a1, %d3\nrx_ignore_data:\n\tmovel packet_full(%d0), (%d2)\t \n\n \n\tbsetl #DOORBELL_FROM_CARD_RX, %d6  \n\tmovel rx_out, %d2\n\taddl #1, %d2\n\tcmpl #RX_QUEUE_LENGTH, %d2\n\tbne rx_1\n\tclrl %d2\nrx_1:\tmovel %d2, rx_out\n\nrx_free_bd:\n\tandw #0xF000, (%d1)\t\t \n\tbsetl #31, (%d1)\t\t \n \n\tmovel rx_in(%d0), %d1\n\taddl #1, %d1\n\tcmpl #RX_BUFFERS, %d1\n\tbne rx_2\n\tclrl %d1\nrx_2:\tmovel %d1, rx_in(%d0)\n\tbra rx\n\nrx_overrun:\n\tmovel ch_status_addr(%d0), %d2\n\taddl #1, STATUS_RX_OVERRUNS(%d2)\n\tbra rx_free_bd\n\nrx_bad_frame:\n\tmovel ch_status_addr(%d0), %d2\n\taddl #1, STATUS_RX_FRAME_ERRORS(%d2)\n\tbra rx_free_bd\n\nrx_ret: rts\n\n\n \n\n \ntx_end:\ttstl tx_count(%d0)\n\tbeq tx_end_ret\t\t\t \n\n\tmovel tx_in(%d0), %d1\n\tmovel %d1, %d2\t\t\t \n\tlsll #3, %d1\t\t\t \n\taddl tx_first_bd(%d0), %d1\t \n\tmovew (%d1), %d3\t\t \n\tbtstl #15, %d3\n\tbne tx_end_ret\t\t\t \n\n \n\torl bell_tx(%d0), %d6\t\t \n\tsubl #1, tx_count(%d0)\n\tmovel tx_in(%d0), %d1\n\taddl #1, %d1\n\tcmpl #TX_BUFFERS, %d1\n\tbne tx_end_1\n\tclrl %d1\ntx_end_1:\n\tmovel %d1, tx_in(%d0)\n\n \n\tmulul #DESC_LENGTH, %d2\t\t \n\taddl ch_status_addr(%d0), %d2\n\taddl #STATUS_TX_DESCS, %d2\t \n\tbtstl #1, %d3\n\tbne tx_end_underrun\n\tmovel #PACKET_SENT, (%d2)\n\tbra tx_end\n\ntx_end_underrun:\n\tmovel #PACKET_UNDERRUN, (%d2)\n\tbra tx_end\n\ntx_end_ret: rts\n\n\n \n\n#if QUICC_MEMCPY_USES_PLX\n \nmemcpy_from_pci_run:\n\tmovel %d0, -(%sp)\n\tmovew %sr, -(%sp)\nmemcpy_1:\n\tmovel PLX_DMA_CMD_STS, %d0\t \n\tbtstl #4, %d0\t\t\t \n\tbne memcpy_end\n\tstop #0x2200\t\t\t \n\tmovew #0x2700, %sr\t\t \n\tbra memcpy_1\n\nmemcpy_to_pci_run:\n\tmovel %d0, -(%sp)\n\tmovew %sr, -(%sp)\nmemcpy_2:\n\tmovel PLX_DMA_CMD_STS, %d0\t \n\tbtstl #12, %d0\t\t\t \n\tbne memcpy_end\n\tstop #0x2200\t\t\t \n\tmovew #0x2700, %sr\t\t \n\tbra memcpy_2\n\nmemcpy_end:\n\tmovew (%sp)+, %sr\n\tmovel (%sp)+, %d0\n\trts\n#endif\n\n\n\n\n\n\n \n\npci9060_interrupt:\n\tmovel %d0, -(%sp)\n\n\tmovel PLX_DOORBELL_TO_CARD, %d0\n\tmovel %d0, PLX_DOORBELL_TO_CARD\t \n\torl %d0, channel_stats\n\n\tmovel #0x0909, PLX_DMA_CMD_STS\t \n\n\tmovel (%sp)+, %d0\n\trte\n\n \n\nport_interrupt_1:\n\torl #0, SCC1_REGS + SCC_SCCE;  \n\torl #1 << TASK_SCC_0, channel_stats\n\tmovel #0x40000000, CISR\n\trte\n\nport_interrupt_2:\n\torl #0, SCC2_REGS + SCC_SCCE;  \n\torl #1 << TASK_SCC_1, channel_stats\n\tmovel #0x20000000, CISR\n\trte\n\nport_interrupt_3:\n\torl #0, SCC3_REGS + SCC_SCCE;  \n\torl #1 << TASK_SCC_2, channel_stats\n\tmovel #0x10000000, CISR\n\trte\n\nport_interrupt_4:\n\torl #0, SCC4_REGS + SCC_SCCE;  \n\torl #1 << TASK_SCC_3, channel_stats\n\tmovel #0x08000000, CISR\n\trte\n\nerror_interrupt:\n\trte\n\n\n \n \ncheck_csr:\n\tmovel %d0, -(%sp)\n\tmovel %d1, -(%sp)\n\tmovel %d2, -(%sp)\n\tmovel %a0, -(%sp)\n\tmovel %a1, -(%sp)\n\n\tclrl %d0\t\t\t \n\tmovel #CSRA, %a0\t\t \n\ncheck_csr_loop:\n\tmovew (%a0), %d1\t\t \n\tandl #0xE7, %d1\t\t\t \n\tcmpw #STATUS_CABLE_V35 * (1 + 1 << STATUS_CABLE_PM_SHIFT), %d1\n\tbne check_csr_1\n\tmovew #0x0E08, %d1\n\tbra check_csr_valid\n\ncheck_csr_1:\n\tcmpw #STATUS_CABLE_X21 * (1 + 1 << STATUS_CABLE_PM_SHIFT), %d1\n\tbne check_csr_2\n\tmovew #0x0408, %d1\n\tbra check_csr_valid\n\ncheck_csr_2:\n\tcmpw #STATUS_CABLE_V24 * (1 + 1 << STATUS_CABLE_PM_SHIFT), %d1\n\tbne check_csr_3\n\tmovew #0x0208, %d1\n\tbra check_csr_valid\n\ncheck_csr_3:\n\tcmpw #STATUS_CABLE_EIA530 * (1 + 1 << STATUS_CABLE_PM_SHIFT), %d1\n\tbne check_csr_disable\n\tmovew #0x0D08, %d1\n\tbra check_csr_valid\n\ncheck_csr_disable:\n\tmovew #0x0008, %d1\t\t \n\tmovew #0x80E7, %d2\t\t \n\tbra check_csr_write\n\ncheck_csr_valid:\t\t\t \n\tmovew csr_output(%d0), %d2\n\tandw #0x3000, %d2\t\t \n\torw %d2, %d1\t\t\t \n\tmovew #0x80FF, %d2\t\t \n\ncheck_csr_write:\n\tcmpw old_csr_output(%d0), %d1\n\tbeq check_csr_input\n\tmovew %d1, old_csr_output(%d0)\n\tmovew %d1, (%a0)\t\t \n\ncheck_csr_input:\n\tmovew (PCDAT), %d1\n\tandw dcd_mask(%d0), %d1\n\tbeq check_csr_dcd_on\t\t \n\tmovew (%a0), %d1\t\t \n\tandw #~STATUS_CABLE_DCD, %d1\t \n\tbra check_csr_previous\n\ncheck_csr_dcd_on:\n\tmovew (%a0), %d1\t\t \n\torw #STATUS_CABLE_DCD, %d1\t \ncheck_csr_previous:\n\tandw %d2, %d1\t\t\t \n\tmovel ch_status_addr(%d0), %a1\n\tcmpl STATUS_CABLE(%a1), %d1\t \n\tbeq check_csr_next\n\tmovel %d1, STATUS_CABLE(%a1)\t \n\tmovel bell_cable(%d0), PLX_DOORBELL_FROM_CARD\t \n\ncheck_csr_next:\n\taddl #2, %a0\t\t\t \n\taddl #4, %d0\t\t\t \n\tcmpl #4 * 4, %d0\n\tbne check_csr_loop\n\n\tmovel (%sp)+, %a1\n\tmovel (%sp)+, %a0\n\tmovel (%sp)+, %d2\n\tmovel (%sp)+, %d1\n\tmovel (%sp)+, %d0\n\trts\n\n\n \n\ntimer_interrupt:\n\tbsr check_csr\n\trte\n\n\n \n#if DETECT_RAM\nram_test:\n\tmovel #0x12345678, %d1\t\t \n\tmovel %d1, (128 * 1024 - 4)\n\tmovel #128 * 1024, %d0\t\t \nram_test_size:\n\tcmpl #MAX_RAM_SIZE, %d0\n\tbeq ram_test_size_found\n\tmovel %d0, %a0\n\taddl #128 * 1024 - 4, %a0\n\tcmpl (%a0), %d1\n\tbeq ram_test_size_check\nram_test_next_size:\n\tlsll #1, %d0\n\tbra ram_test_size\n\nram_test_size_check:\n\teorl #0xFFFFFFFF, %d1\n\tmovel %d1, (128 * 1024 - 4)\n\tcmpl (%a0), %d1\n\tbne ram_test_next_size\n\nram_test_size_found:\t\t\t \n\tmovel %d0, %a0\t\t\t \n\tsubl #firmware_end + 4, %d0\n\tlsrl #2, %d0\n\tmovel %d0, %d1\t\t\t \nram_test_fill:\n\tmovel %a0, -(%a0)\n\tdbfw %d1, ram_test_fill\n\tsubl #0x10000, %d1\n\tcmpl #0xFFFFFFFF, %d1\n\tbne ram_test_fill\n\nram_test_loop:\t\t\t\t \n\tcmpl (%a0)+, %a0\n\tdbnew %d0, ram_test_loop\n\tbne ram_test_found_bad\n\tsubl #0x10000, %d0\n\tcmpl #0xFFFFFFFF, %d0\n\tbne ram_test_loop\n\tbra ram_test_all_ok\n\nram_test_found_bad:\n\tsubl #4, %a0\nram_test_all_ok:\n\tmovel %a0, PLX_MAILBOX_5\n\trts\n#endif\n\n\n \n\nscc_reg_addr:\n\t.long SCC1_REGS, SCC2_REGS, SCC3_REGS, SCC4_REGS\nscc_base_addr:\n\t.long SCC1_BASE, SCC2_BASE, SCC3_BASE, SCC4_BASE\n\ntx_first_bd:\n\t.long DPRBASE\n\t.long DPRBASE + (TX_BUFFERS + RX_BUFFERS) * 8\n\t.long DPRBASE + (TX_BUFFERS + RX_BUFFERS) * 8 * 2\n\t.long DPRBASE + (TX_BUFFERS + RX_BUFFERS) * 8 * 3\n\nrx_first_bd:\n\t.long DPRBASE + TX_BUFFERS * 8\n\t.long DPRBASE + TX_BUFFERS * 8 + (TX_BUFFERS + RX_BUFFERS) * 8\n\t.long DPRBASE + TX_BUFFERS * 8 + (TX_BUFFERS + RX_BUFFERS) * 8 * 2\n\t.long DPRBASE + TX_BUFFERS * 8 + (TX_BUFFERS + RX_BUFFERS) * 8 * 3\n\nfirst_buffer:\n\t.long BUFFERS_ADDR\n\t.long BUFFERS_ADDR + (TX_BUFFERS + RX_BUFFERS) * BUFFER_LENGTH\n\t.long BUFFERS_ADDR + (TX_BUFFERS + RX_BUFFERS) * BUFFER_LENGTH * 2\n\t.long BUFFERS_ADDR + (TX_BUFFERS + RX_BUFFERS) * BUFFER_LENGTH * 3\n\nbell_tx:\n\t.long 1 << DOORBELL_FROM_CARD_TX_0, 1 << DOORBELL_FROM_CARD_TX_1\n\t.long 1 << DOORBELL_FROM_CARD_TX_2, 1 << DOORBELL_FROM_CARD_TX_3\n\nbell_cable:\n\t.long 1 << DOORBELL_FROM_CARD_CABLE_0, 1 << DOORBELL_FROM_CARD_CABLE_1\n\t.long 1 << DOORBELL_FROM_CARD_CABLE_2, 1 << DOORBELL_FROM_CARD_CABLE_3\n\npacket_full:\n\t.long PACKET_FULL, PACKET_FULL + 1, PACKET_FULL + 2, PACKET_FULL + 3\n\nclocking_ext:\n\t.long 0x0000002C, 0x00003E00, 0x002C0000, 0x3E000000\nclocking_txfromrx:\n\t.long 0x0000002D, 0x00003F00, 0x002D0000, 0x3F000000\nclocking_mask:\n\t.long 0x000000FF, 0x0000FF00, 0x00FF0000, 0xFF000000\ndcd_mask:\n\t.word 0x020, 0, 0x080, 0, 0x200, 0, 0x800\n\n\t.ascii \"wanXL firmware\\n\"\n\t.asciz \"Copyright (C) 2003 Krzysztof Halasa <khc@pm.waw.pl>\\n\"\n\n\n \n\n\t\t.align 4\nchannel_stats:\t.long 0\n\ntx_in:\t\t.long 0, 0, 0, 0\t \ntx_out:\t\t.long 0, 0, 0, 0\t \ntx_count:\t.long 0, 0, 0, 0\t \n\nrx_in:\t\t.long 0, 0, 0, 0\t \nrx_out:\t\t.long 0\t\t\t \nparity_bytes:\t.word 0, 0, 0, 0, 0, 0, 0  \n\ncsr_output:\t.word 0\nold_csr_output:\t.word 0, 0, 0, 0, 0, 0, 0\n\t\t.align 4\nfirmware_end:\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}