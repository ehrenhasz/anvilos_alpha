{
  "module_name": "noise.h",
  "hash_id": "9a7325ab7a7ba46e8833dbc60c882bf66734eb0e051de1b60619328d5ebbb2d8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/wireguard/noise.h",
  "human_readable_source": " \n \n#ifndef _WG_NOISE_H\n#define _WG_NOISE_H\n\n#include \"messages.h\"\n#include \"peerlookup.h\"\n\n#include <linux/types.h>\n#include <linux/spinlock.h>\n#include <linux/atomic.h>\n#include <linux/rwsem.h>\n#include <linux/mutex.h>\n#include <linux/kref.h>\n\nstruct noise_replay_counter {\n\tu64 counter;\n\tspinlock_t lock;\n\tunsigned long backtrack[COUNTER_BITS_TOTAL / BITS_PER_LONG];\n};\n\nstruct noise_symmetric_key {\n\tu8 key[NOISE_SYMMETRIC_KEY_LEN];\n\tu64 birthdate;\n\tbool is_valid;\n};\n\nstruct noise_keypair {\n\tstruct index_hashtable_entry entry;\n\tstruct noise_symmetric_key sending;\n\tatomic64_t sending_counter;\n\tstruct noise_symmetric_key receiving;\n\tstruct noise_replay_counter receiving_counter;\n\t__le32 remote_index;\n\tbool i_am_the_initiator;\n\tstruct kref refcount;\n\tstruct rcu_head rcu;\n\tu64 internal_id;\n};\n\nstruct noise_keypairs {\n\tstruct noise_keypair __rcu *current_keypair;\n\tstruct noise_keypair __rcu *previous_keypair;\n\tstruct noise_keypair __rcu *next_keypair;\n\tspinlock_t keypair_update_lock;\n};\n\nstruct noise_static_identity {\n\tu8 static_public[NOISE_PUBLIC_KEY_LEN];\n\tu8 static_private[NOISE_PUBLIC_KEY_LEN];\n\tstruct rw_semaphore lock;\n\tbool has_identity;\n};\n\nenum noise_handshake_state {\n\tHANDSHAKE_ZEROED,\n\tHANDSHAKE_CREATED_INITIATION,\n\tHANDSHAKE_CONSUMED_INITIATION,\n\tHANDSHAKE_CREATED_RESPONSE,\n\tHANDSHAKE_CONSUMED_RESPONSE\n};\n\nstruct noise_handshake {\n\tstruct index_hashtable_entry entry;\n\n\tenum noise_handshake_state state;\n\tu64 last_initiation_consumption;\n\n\tstruct noise_static_identity *static_identity;\n\n\tu8 ephemeral_private[NOISE_PUBLIC_KEY_LEN];\n\tu8 remote_static[NOISE_PUBLIC_KEY_LEN];\n\tu8 remote_ephemeral[NOISE_PUBLIC_KEY_LEN];\n\tu8 precomputed_static_static[NOISE_PUBLIC_KEY_LEN];\n\n\tu8 preshared_key[NOISE_SYMMETRIC_KEY_LEN];\n\n\tu8 hash[NOISE_HASH_LEN];\n\tu8 chaining_key[NOISE_HASH_LEN];\n\n\tu8 latest_timestamp[NOISE_TIMESTAMP_LEN];\n\t__le32 remote_index;\n\n\t \n\tstruct rw_semaphore lock;\n};\n\nstruct wg_device;\n\nvoid wg_noise_init(void);\nvoid wg_noise_handshake_init(struct noise_handshake *handshake,\n\t\t\t     struct noise_static_identity *static_identity,\n\t\t\t     const u8 peer_public_key[NOISE_PUBLIC_KEY_LEN],\n\t\t\t     const u8 peer_preshared_key[NOISE_SYMMETRIC_KEY_LEN],\n\t\t\t     struct wg_peer *peer);\nvoid wg_noise_handshake_clear(struct noise_handshake *handshake);\nstatic inline void wg_noise_reset_last_sent_handshake(atomic64_t *handshake_ns)\n{\n\tatomic64_set(handshake_ns, ktime_get_coarse_boottime_ns() -\n\t\t\t\t       (u64)(REKEY_TIMEOUT + 1) * NSEC_PER_SEC);\n}\n\nvoid wg_noise_keypair_put(struct noise_keypair *keypair, bool unreference_now);\nstruct noise_keypair *wg_noise_keypair_get(struct noise_keypair *keypair);\nvoid wg_noise_keypairs_clear(struct noise_keypairs *keypairs);\nbool wg_noise_received_with_keypair(struct noise_keypairs *keypairs,\n\t\t\t\t    struct noise_keypair *received_keypair);\nvoid wg_noise_expire_current_peer_keypairs(struct wg_peer *peer);\n\nvoid wg_noise_set_static_identity_private_key(\n\tstruct noise_static_identity *static_identity,\n\tconst u8 private_key[NOISE_PUBLIC_KEY_LEN]);\nvoid wg_noise_precompute_static_static(struct wg_peer *peer);\n\nbool\nwg_noise_handshake_create_initiation(struct message_handshake_initiation *dst,\n\t\t\t\t     struct noise_handshake *handshake);\nstruct wg_peer *\nwg_noise_handshake_consume_initiation(struct message_handshake_initiation *src,\n\t\t\t\t      struct wg_device *wg);\n\nbool wg_noise_handshake_create_response(struct message_handshake_response *dst,\n\t\t\t\t\tstruct noise_handshake *handshake);\nstruct wg_peer *\nwg_noise_handshake_consume_response(struct message_handshake_response *src,\n\t\t\t\t    struct wg_device *wg);\n\nbool wg_noise_handshake_begin_session(struct noise_handshake *handshake,\n\t\t\t\t      struct noise_keypairs *keypairs);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}