{
  "module_name": "timer.c",
  "hash_id": "6780f8717e1f05dd54593dae2d0f5d92f8a3dba0f4330210006a68fdb7dd67b7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/dec/tulip/timer.c",
  "human_readable_source": " \n\n\n#include \"tulip.h\"\n\n\nvoid tulip_media_task(struct work_struct *work)\n{\n\tstruct tulip_private *tp =\n\t\tcontainer_of(work, struct tulip_private, media_work);\n\tstruct net_device *dev = tp->dev;\n\tvoid __iomem *ioaddr = tp->base_addr;\n\tu32 csr12 = ioread32(ioaddr + CSR12);\n\tint next_tick = 2*HZ;\n\tunsigned long flags;\n\n\tif (tulip_debug > 2) {\n\t\tnetdev_dbg(dev, \"Media selection tick, %s, status %08x mode %08x SIA %08x %08x %08x %08x\\n\",\n\t\t\t   medianame[dev->if_port],\n\t\t\t   ioread32(ioaddr + CSR5), ioread32(ioaddr + CSR6),\n\t\t\t   csr12, ioread32(ioaddr + CSR13),\n\t\t\t   ioread32(ioaddr + CSR14), ioread32(ioaddr + CSR15));\n\t}\n\tswitch (tp->chip_id) {\n\tcase DC21140:\n\tcase DC21142:\n\tcase MX98713:\n\tcase COMPEX9881:\n\tcase DM910X:\n\tdefault: {\n\t\tstruct medialeaf *mleaf;\n\t\tunsigned char *p;\n\t\tif (tp->mtable == NULL) {\t \n\t\t\t \n\t\t\tnext_tick = 60*HZ;\n\t\t\tif (tulip_debug > 2)\n\t\t\t\tnetdev_dbg(dev, \"network media monitor CSR6 %08x CSR12 0x%02x\\n\",\n\t\t\t\t\t   ioread32(ioaddr + CSR6),\n\t\t\t\t\t   csr12 & 0xff);\n\t\t\tbreak;\n\t\t}\n\t\tmleaf = &tp->mtable->mleaf[tp->cur_index];\n\t\tp = mleaf->leafdata;\n\t\tswitch (mleaf->type) {\n\t\tcase 0: case 4: {\n\t\t\t \n\t\t\tint offset = mleaf->type == 4 ? 5 : 2;\n\t\t\ts8 bitnum = p[offset];\n\t\t\tif (p[offset+1] & 0x80) {\n\t\t\t\tif (tulip_debug > 1)\n\t\t\t\t\tnetdev_dbg(dev, \"Transceiver monitor tick CSR12=%#02x, no media sense\\n\",\n\t\t\t\t\t\t   csr12);\n\t\t\t\tif (mleaf->type == 4) {\n\t\t\t\t\tif (mleaf->media == 3 && (csr12 & 0x02))\n\t\t\t\t\t\tgoto select_next_media;\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (tulip_debug > 2)\n\t\t\t\tnetdev_dbg(dev, \"Transceiver monitor tick: CSR12=%#02x bit %d is %d, expecting %d\\n\",\n\t\t\t\t\t   csr12, (bitnum >> 1) & 7,\n\t\t\t\t\t   (csr12 & (1 << ((bitnum >> 1) & 7))) != 0,\n\t\t\t\t\t   (bitnum >= 0));\n\t\t\t \n\t\t\tif ((bitnum < 0) !=\n\t\t\t\t((csr12 & (1 << ((bitnum >> 1) & 7))) != 0)) {\n\t\t\t\tif (tulip_debug > 2)\n\t\t\t\t\tnetdev_dbg(dev, \"Link beat detected for %s\\n\",\n\t\t\t\t\t\t   medianame[mleaf->media & MEDIA_MASK]);\n\t\t\t\tif ((p[2] & 0x61) == 0x01)\t \n\t\t\t\t\tgoto actually_mii;\n\t\t\t\tnetif_carrier_on(dev);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tnetif_carrier_off(dev);\n\t\t\tif (tp->medialock)\n\t\t\t\tbreak;\n\t  select_next_media:\n\t\t\tif (--tp->cur_index < 0) {\n\t\t\t\t \n\t\t\t\ttp->cur_index = tp->mtable->leafcount - 1;\n\t\t\t}\n\t\t\tdev->if_port = tp->mtable->mleaf[tp->cur_index].media;\n\t\t\tif (tulip_media_cap[dev->if_port] & MediaIsFD)\n\t\t\t\tgoto select_next_media;  \n\t\t\tif (tulip_debug > 1)\n\t\t\t\tnetdev_dbg(dev, \"No link beat on media %s, trying transceiver type %s\\n\",\n\t\t\t\t\t   medianame[mleaf->media & MEDIA_MASK],\n\t\t\t\t\t   medianame[tp->mtable->mleaf[tp->cur_index].media]);\n\t\t\ttulip_select_media(dev, 0);\n\t\t\t \n\t\t\ttulip_restart_rxtx(tp);\n\t\t\tnext_tick = (24*HZ)/10;\n\t\t\tbreak;\n\t\t}\n\t\tcase 1:  case 3:\t\t \n\t\tactually_mii:\n\t\t\tif (tulip_check_duplex(dev) < 0) {\n\t\t\t\tnetif_carrier_off(dev);\n\t\t\t\tnext_tick = 3*HZ;\n\t\t\t} else {\n\t\t\t\tnetif_carrier_on(dev);\n\t\t\t\tnext_tick = 60*HZ;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 2:\t\t\t\t\t \n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t}\n\tbreak;\n\t}\n\n\n\tspin_lock_irqsave(&tp->lock, flags);\n\tif (tp->timeout_recovery) {\n\t\ttulip_tx_timeout_complete(tp, ioaddr);\n\t\ttp->timeout_recovery = 0;\n\t}\n\tspin_unlock_irqrestore(&tp->lock, flags);\n\n\t \n\tmod_timer(&tp->timer, RUN_AT(next_tick));\n}\n\n\nvoid mxic_timer(struct timer_list *t)\n{\n\tstruct tulip_private *tp = from_timer(tp, t, timer);\n\tstruct net_device *dev = tp->dev;\n\tvoid __iomem *ioaddr = tp->base_addr;\n\tint next_tick = 60*HZ;\n\n\tif (tulip_debug > 3) {\n\t\tdev_info(&dev->dev, \"MXIC negotiation status %08x\\n\",\n\t\t\t ioread32(ioaddr + CSR12));\n\t}\n\tif (next_tick) {\n\t\tmod_timer(&tp->timer, RUN_AT(next_tick));\n\t}\n}\n\n\nvoid comet_timer(struct timer_list *t)\n{\n\tstruct tulip_private *tp = from_timer(tp, t, timer);\n\tstruct net_device *dev = tp->dev;\n\tint next_tick = 2*HZ;\n\n\tif (tulip_debug > 1)\n\t\tnetdev_dbg(dev, \"Comet link status %04x partner capability %04x\\n\",\n\t\t\t   tulip_mdio_read(dev, tp->phys[0], 1),\n\t\t\t   tulip_mdio_read(dev, tp->phys[0], 5));\n\t \n\tif (tulip_check_duplex(dev) < 0)\n\t\t{ netif_carrier_off(dev); }\n\telse\n\t\t{ netif_carrier_on(dev); }\n\tmod_timer(&tp->timer, RUN_AT(next_tick));\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}