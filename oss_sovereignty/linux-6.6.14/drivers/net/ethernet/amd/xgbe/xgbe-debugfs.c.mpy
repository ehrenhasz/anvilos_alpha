{
  "module_name": "xgbe-debugfs.c",
  "hash_id": "0bb15cf75a1d7f04a0936dd70a6ccf531ae7911b0534caf8f8d27a1c87a51447",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/amd/xgbe/xgbe-debugfs.c",
  "human_readable_source": " \n\n#include <linux/debugfs.h>\n#include <linux/module.h>\n#include <linux/slab.h>\n\n#include \"xgbe.h\"\n#include \"xgbe-common.h\"\n\nstatic ssize_t xgbe_common_read(char __user *buffer, size_t count,\n\t\t\t\tloff_t *ppos, unsigned int value)\n{\n\tchar *buf;\n\tssize_t len;\n\n\tif (*ppos != 0)\n\t\treturn 0;\n\n\tbuf = kasprintf(GFP_KERNEL, \"0x%08x\\n\", value);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\n\tif (count < strlen(buf)) {\n\t\tkfree(buf);\n\t\treturn -ENOSPC;\n\t}\n\n\tlen = simple_read_from_buffer(buffer, count, ppos, buf, strlen(buf));\n\tkfree(buf);\n\n\treturn len;\n}\n\nstatic ssize_t xgbe_common_write(const char __user *buffer, size_t count,\n\t\t\t\t loff_t *ppos, unsigned int *value)\n{\n\tchar workarea[32];\n\tssize_t len;\n\tint ret;\n\n\tif (*ppos != 0)\n\t\treturn -EINVAL;\n\n\tif (count >= sizeof(workarea))\n\t\treturn -ENOSPC;\n\n\tlen = simple_write_to_buffer(workarea, sizeof(workarea) - 1, ppos,\n\t\t\t\t     buffer, count);\n\tif (len < 0)\n\t\treturn len;\n\n\tworkarea[len] = '\\0';\n\tret = kstrtouint(workarea, 16, value);\n\tif (ret)\n\t\treturn -EIO;\n\n\treturn len;\n}\n\nstatic ssize_t xgmac_reg_addr_read(struct file *filp, char __user *buffer,\n\t\t\t\t   size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_read(buffer, count, ppos, pdata->debugfs_xgmac_reg);\n}\n\nstatic ssize_t xgmac_reg_addr_write(struct file *filp,\n\t\t\t\t    const char __user *buffer,\n\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_write(buffer, count, ppos,\n\t\t\t\t &pdata->debugfs_xgmac_reg);\n}\n\nstatic ssize_t xgmac_reg_value_read(struct file *filp, char __user *buffer,\n\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\n\tvalue = XGMAC_IOREAD(pdata, pdata->debugfs_xgmac_reg);\n\n\treturn xgbe_common_read(buffer, count, ppos, value);\n}\n\nstatic ssize_t xgmac_reg_value_write(struct file *filp,\n\t\t\t\t     const char __user *buffer,\n\t\t\t\t     size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\tssize_t len;\n\n\tlen = xgbe_common_write(buffer, count, ppos, &value);\n\tif (len < 0)\n\t\treturn len;\n\n\tXGMAC_IOWRITE(pdata, pdata->debugfs_xgmac_reg, value);\n\n\treturn len;\n}\n\nstatic const struct file_operations xgmac_reg_addr_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xgmac_reg_addr_read,\n\t.write = xgmac_reg_addr_write,\n};\n\nstatic const struct file_operations xgmac_reg_value_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xgmac_reg_value_read,\n\t.write = xgmac_reg_value_write,\n};\n\nstatic ssize_t xpcs_mmd_read(struct file *filp, char __user *buffer,\n\t\t\t     size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_read(buffer, count, ppos, pdata->debugfs_xpcs_mmd);\n}\n\nstatic ssize_t xpcs_mmd_write(struct file *filp, const char __user *buffer,\n\t\t\t      size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_write(buffer, count, ppos,\n\t\t\t\t &pdata->debugfs_xpcs_mmd);\n}\n\nstatic ssize_t xpcs_reg_addr_read(struct file *filp, char __user *buffer,\n\t\t\t\t  size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_read(buffer, count, ppos, pdata->debugfs_xpcs_reg);\n}\n\nstatic ssize_t xpcs_reg_addr_write(struct file *filp, const char __user *buffer,\n\t\t\t\t   size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_write(buffer, count, ppos,\n\t\t\t\t &pdata->debugfs_xpcs_reg);\n}\n\nstatic ssize_t xpcs_reg_value_read(struct file *filp, char __user *buffer,\n\t\t\t\t   size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\n\tvalue = XMDIO_READ(pdata, pdata->debugfs_xpcs_mmd,\n\t\t\t   pdata->debugfs_xpcs_reg);\n\n\treturn xgbe_common_read(buffer, count, ppos, value);\n}\n\nstatic ssize_t xpcs_reg_value_write(struct file *filp,\n\t\t\t\t    const char __user *buffer,\n\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\tssize_t len;\n\n\tlen = xgbe_common_write(buffer, count, ppos, &value);\n\tif (len < 0)\n\t\treturn len;\n\n\tXMDIO_WRITE(pdata, pdata->debugfs_xpcs_mmd, pdata->debugfs_xpcs_reg,\n\t\t    value);\n\n\treturn len;\n}\n\nstatic const struct file_operations xpcs_mmd_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xpcs_mmd_read,\n\t.write = xpcs_mmd_write,\n};\n\nstatic const struct file_operations xpcs_reg_addr_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xpcs_reg_addr_read,\n\t.write = xpcs_reg_addr_write,\n};\n\nstatic const struct file_operations xpcs_reg_value_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xpcs_reg_value_read,\n\t.write = xpcs_reg_value_write,\n};\n\nstatic ssize_t xprop_reg_addr_read(struct file *filp, char __user *buffer,\n\t\t\t\t   size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_read(buffer, count, ppos, pdata->debugfs_xprop_reg);\n}\n\nstatic ssize_t xprop_reg_addr_write(struct file *filp,\n\t\t\t\t    const char __user *buffer,\n\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_write(buffer, count, ppos,\n\t\t\t\t &pdata->debugfs_xprop_reg);\n}\n\nstatic ssize_t xprop_reg_value_read(struct file *filp, char __user *buffer,\n\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\n\tvalue = XP_IOREAD(pdata, pdata->debugfs_xprop_reg);\n\n\treturn xgbe_common_read(buffer, count, ppos, value);\n}\n\nstatic ssize_t xprop_reg_value_write(struct file *filp,\n\t\t\t\t     const char __user *buffer,\n\t\t\t\t     size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\tssize_t len;\n\n\tlen = xgbe_common_write(buffer, count, ppos, &value);\n\tif (len < 0)\n\t\treturn len;\n\n\tXP_IOWRITE(pdata, pdata->debugfs_xprop_reg, value);\n\n\treturn len;\n}\n\nstatic const struct file_operations xprop_reg_addr_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xprop_reg_addr_read,\n\t.write = xprop_reg_addr_write,\n};\n\nstatic const struct file_operations xprop_reg_value_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xprop_reg_value_read,\n\t.write = xprop_reg_value_write,\n};\n\nstatic ssize_t xi2c_reg_addr_read(struct file *filp, char __user *buffer,\n\t\t\t\t  size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_read(buffer, count, ppos, pdata->debugfs_xi2c_reg);\n}\n\nstatic ssize_t xi2c_reg_addr_write(struct file *filp,\n\t\t\t\t   const char __user *buffer,\n\t\t\t\t   size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\n\treturn xgbe_common_write(buffer, count, ppos,\n\t\t\t\t &pdata->debugfs_xi2c_reg);\n}\n\nstatic ssize_t xi2c_reg_value_read(struct file *filp, char __user *buffer,\n\t\t\t\t   size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\n\tvalue = XI2C_IOREAD(pdata, pdata->debugfs_xi2c_reg);\n\n\treturn xgbe_common_read(buffer, count, ppos, value);\n}\n\nstatic ssize_t xi2c_reg_value_write(struct file *filp,\n\t\t\t\t    const char __user *buffer,\n\t\t\t\t    size_t count, loff_t *ppos)\n{\n\tstruct xgbe_prv_data *pdata = filp->private_data;\n\tunsigned int value;\n\tssize_t len;\n\n\tlen = xgbe_common_write(buffer, count, ppos, &value);\n\tif (len < 0)\n\t\treturn len;\n\n\tXI2C_IOWRITE(pdata, pdata->debugfs_xi2c_reg, value);\n\n\treturn len;\n}\n\nstatic const struct file_operations xi2c_reg_addr_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xi2c_reg_addr_read,\n\t.write = xi2c_reg_addr_write,\n};\n\nstatic const struct file_operations xi2c_reg_value_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read =  xi2c_reg_value_read,\n\t.write = xi2c_reg_value_write,\n};\n\nvoid xgbe_debugfs_init(struct xgbe_prv_data *pdata)\n{\n\tchar *buf;\n\n\t \n\tpdata->debugfs_xgmac_reg = 0;\n\tpdata->debugfs_xpcs_mmd = 1;\n\tpdata->debugfs_xpcs_reg = 0;\n\n\tbuf = kasprintf(GFP_KERNEL, \"amd-xgbe-%s\", pdata->netdev->name);\n\tif (!buf)\n\t\treturn;\n\n\tpdata->xgbe_debugfs = debugfs_create_dir(buf, NULL);\n\n\tdebugfs_create_file(\"xgmac_register\", 0600, pdata->xgbe_debugfs, pdata,\n\t\t\t    &xgmac_reg_addr_fops);\n\n\tdebugfs_create_file(\"xgmac_register_value\", 0600, pdata->xgbe_debugfs,\n\t\t\t    pdata, &xgmac_reg_value_fops);\n\n\tdebugfs_create_file(\"xpcs_mmd\", 0600, pdata->xgbe_debugfs, pdata,\n\t\t\t    &xpcs_mmd_fops);\n\n\tdebugfs_create_file(\"xpcs_register\", 0600, pdata->xgbe_debugfs, pdata,\n\t\t\t    &xpcs_reg_addr_fops);\n\n\tdebugfs_create_file(\"xpcs_register_value\", 0600, pdata->xgbe_debugfs,\n\t\t\t    pdata, &xpcs_reg_value_fops);\n\n\tif (pdata->xprop_regs) {\n\t\tdebugfs_create_file(\"xprop_register\", 0600, pdata->xgbe_debugfs,\n\t\t\t\t    pdata, &xprop_reg_addr_fops);\n\n\t\tdebugfs_create_file(\"xprop_register_value\", 0600,\n\t\t\t\t    pdata->xgbe_debugfs, pdata,\n\t\t\t\t    &xprop_reg_value_fops);\n\t}\n\n\tif (pdata->xi2c_regs) {\n\t\tdebugfs_create_file(\"xi2c_register\", 0600, pdata->xgbe_debugfs,\n\t\t\t\t    pdata, &xi2c_reg_addr_fops);\n\n\t\tdebugfs_create_file(\"xi2c_register_value\", 0600,\n\t\t\t\t    pdata->xgbe_debugfs, pdata,\n\t\t\t\t    &xi2c_reg_value_fops);\n\t}\n\n\tif (pdata->vdata->an_cdr_workaround) {\n\t\tdebugfs_create_bool(\"an_cdr_workaround\", 0600,\n\t\t\t\t    pdata->xgbe_debugfs,\n\t\t\t\t    &pdata->debugfs_an_cdr_workaround);\n\n\t\tdebugfs_create_bool(\"an_cdr_track_early\", 0600,\n\t\t\t\t    pdata->xgbe_debugfs,\n\t\t\t\t    &pdata->debugfs_an_cdr_track_early);\n\t}\n\n\tkfree(buf);\n}\n\nvoid xgbe_debugfs_exit(struct xgbe_prv_data *pdata)\n{\n\tdebugfs_remove_recursive(pdata->xgbe_debugfs);\n\tpdata->xgbe_debugfs = NULL;\n}\n\nvoid xgbe_debugfs_rename(struct xgbe_prv_data *pdata)\n{\n\tchar *buf;\n\n\tif (!pdata->xgbe_debugfs)\n\t\treturn;\n\n\tbuf = kasprintf(GFP_KERNEL, \"amd-xgbe-%s\", pdata->netdev->name);\n\tif (!buf)\n\t\treturn;\n\n\tif (!strcmp(pdata->xgbe_debugfs->d_name.name, buf))\n\t\tgoto out;\n\n\tdebugfs_rename(pdata->xgbe_debugfs->d_parent, pdata->xgbe_debugfs,\n\t\t       pdata->xgbe_debugfs->d_parent, buf);\n\nout:\n\tkfree(buf);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}