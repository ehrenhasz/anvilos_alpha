{
  "module_name": "nic.h",
  "hash_id": "ae45833f04fb965cc9483f8118fa47fa89f7bc5ecd87c3c1132a80033ab43212",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/cavium/thunder/nic.h",
  "human_readable_source": " \n \n\n#ifndef NIC_H\n#define\tNIC_H\n\n#include <linux/netdevice.h>\n#include <linux/interrupt.h>\n#include <linux/pci.h>\n#include \"thunder_bgx.h\"\n\n \n#define\tPCI_DEVICE_ID_THUNDER_NIC_PF\t\t0xA01E\n#define\tPCI_DEVICE_ID_THUNDER_PASS1_NIC_VF\t0x0011\n#define\tPCI_DEVICE_ID_THUNDER_NIC_VF\t\t0xA034\n#define\tPCI_DEVICE_ID_THUNDER_BGX\t\t0xA026\n\n \n#define PCI_SUBSYS_DEVID_88XX_NIC_PF\t\t0xA11E\n#define PCI_SUBSYS_DEVID_81XX_NIC_PF\t\t0xA21E\n#define PCI_SUBSYS_DEVID_83XX_NIC_PF\t\t0xA31E\n\n#define PCI_SUBSYS_DEVID_88XX_PASS1_NIC_VF\t0xA11E\n#define PCI_SUBSYS_DEVID_88XX_NIC_VF\t\t0xA134\n#define PCI_SUBSYS_DEVID_81XX_NIC_VF\t\t0xA234\n#define PCI_SUBSYS_DEVID_83XX_NIC_VF\t\t0xA334\n\n\n \n#define\tPCI_CFG_REG_BAR_NUM\t\t0\n#define\tPCI_MSIX_REG_BAR_NUM\t\t4\n\n \n#define\tMAX_NUM_VFS_SUPPORTED\t\t128\n#define\tDEFAULT_NUM_VF_ENABLED\t\t8\n\n#define\tNIC_TNS_BYPASS_MODE\t\t0\n#define\tNIC_TNS_MODE\t\t\t1\n\n \n#define\tNIC_SRIOV_ENABLED\t\tBIT(0)\n\n \n#define\tNIC_HW_MIN_FRS\t\t\t64\n#define\tNIC_HW_MAX_FRS\t\t\t9190  \n\n \n#define\tNIC_MAX_PKIND\t\t\t16\n\n \n#define\tNIC_MAX_CPI_PER_LMAC\t\t64\n\n \n#define\tNICVF_INTR_CQ\t\t\t0\n#define\tNICVF_INTR_SQ\t\t\t1\n#define\tNICVF_INTR_RBDR\t\t\t2\n#define\tNICVF_INTR_PKT_DROP\t\t3\n#define\tNICVF_INTR_TCP_TIMER\t\t4\n#define\tNICVF_INTR_MBOX\t\t\t5\n#define\tNICVF_INTR_QS_ERR\t\t6\n\n#define\tNICVF_INTR_CQ_SHIFT\t\t0\n#define\tNICVF_INTR_SQ_SHIFT\t\t8\n#define\tNICVF_INTR_RBDR_SHIFT\t\t16\n#define\tNICVF_INTR_PKT_DROP_SHIFT\t20\n#define\tNICVF_INTR_TCP_TIMER_SHIFT\t21\n#define\tNICVF_INTR_MBOX_SHIFT\t\t22\n#define\tNICVF_INTR_QS_ERR_SHIFT\t\t23\n\n#define\tNICVF_INTR_CQ_MASK\t\t(0xFF << NICVF_INTR_CQ_SHIFT)\n#define\tNICVF_INTR_SQ_MASK\t\t(0xFF << NICVF_INTR_SQ_SHIFT)\n#define\tNICVF_INTR_RBDR_MASK\t\t(0x03 << NICVF_INTR_RBDR_SHIFT)\n#define\tNICVF_INTR_PKT_DROP_MASK\tBIT(NICVF_INTR_PKT_DROP_SHIFT)\n#define\tNICVF_INTR_TCP_TIMER_MASK\tBIT(NICVF_INTR_TCP_TIMER_SHIFT)\n#define\tNICVF_INTR_MBOX_MASK\t\tBIT(NICVF_INTR_MBOX_SHIFT)\n#define\tNICVF_INTR_QS_ERR_MASK\t\tBIT(NICVF_INTR_QS_ERR_SHIFT)\n\n \n#define\tNIC_PF_MSIX_VECTORS\t\t10\n#define\tNIC_VF_MSIX_VECTORS\t\t20\n\n#define NIC_PF_INTR_ID_ECC0_SBE\t\t0\n#define NIC_PF_INTR_ID_ECC0_DBE\t\t1\n#define NIC_PF_INTR_ID_ECC1_SBE\t\t2\n#define NIC_PF_INTR_ID_ECC1_DBE\t\t3\n#define NIC_PF_INTR_ID_ECC2_SBE\t\t4\n#define NIC_PF_INTR_ID_ECC2_DBE\t\t5\n#define NIC_PF_INTR_ID_ECC3_SBE\t\t6\n#define NIC_PF_INTR_ID_ECC3_DBE\t\t7\n#define NIC_PF_INTR_ID_MBOX0\t\t8\n#define NIC_PF_INTR_ID_MBOX1\t\t9\n\n \n#define NICPF_CQM_MIN_DROP_LEVEL       0x100\n\n \n#define NICPF_CLK_PER_INT_TICK\t\t1\n\n \n#define\tNICVF_TX_TIMEOUT\t\t(50 * HZ)\n\nstruct nicvf_cq_poll {\n\tstruct  nicvf *nicvf;\n\tu8\tcq_idx;\t\t \n\tstruct\tnapi_struct napi;\n};\n\n#define NIC_MAX_RSS_HASH_BITS\t\t8\n#define NIC_MAX_RSS_IDR_TBL_SIZE\t(1 << NIC_MAX_RSS_HASH_BITS)\n#define RSS_HASH_KEY_SIZE\t\t5  \n\nstruct nicvf_rss_info {\n\tbool enable;\n#define\tRSS_L2_EXTENDED_HASH_ENA\tBIT(0)\n#define\tRSS_IP_HASH_ENA\t\t\tBIT(1)\n#define\tRSS_TCP_HASH_ENA\t\tBIT(2)\n#define\tRSS_TCP_SYN_DIS\t\t\tBIT(3)\n#define\tRSS_UDP_HASH_ENA\t\tBIT(4)\n#define RSS_L4_EXTENDED_HASH_ENA\tBIT(5)\n#define\tRSS_ROCE_ENA\t\t\tBIT(6)\n#define\tRSS_L3_BI_DIRECTION_ENA\t\tBIT(7)\n#define\tRSS_L4_BI_DIRECTION_ENA\t\tBIT(8)\n\tu64 cfg;\n\tu8  hash_bits;\n\tu16 rss_size;\n\tu8  ind_tbl[NIC_MAX_RSS_IDR_TBL_SIZE];\n\tu64 key[RSS_HASH_KEY_SIZE];\n} ____cacheline_aligned_in_smp;\n\nstruct nicvf_pfc {\n\tu8    autoneg;\n\tu8    fc_rx;\n\tu8    fc_tx;\n};\n\nenum rx_stats_reg_offset {\n\tRX_OCTS = 0x0,\n\tRX_UCAST = 0x1,\n\tRX_BCAST = 0x2,\n\tRX_MCAST = 0x3,\n\tRX_RED = 0x4,\n\tRX_RED_OCTS = 0x5,\n\tRX_ORUN = 0x6,\n\tRX_ORUN_OCTS = 0x7,\n\tRX_FCS = 0x8,\n\tRX_L2ERR = 0x9,\n\tRX_DRP_BCAST = 0xa,\n\tRX_DRP_MCAST = 0xb,\n\tRX_DRP_L3BCAST = 0xc,\n\tRX_DRP_L3MCAST = 0xd,\n\tRX_STATS_ENUM_LAST,\n};\n\nenum tx_stats_reg_offset {\n\tTX_OCTS = 0x0,\n\tTX_UCAST = 0x1,\n\tTX_BCAST = 0x2,\n\tTX_MCAST = 0x3,\n\tTX_DROP = 0x4,\n\tTX_STATS_ENUM_LAST,\n};\n\nstruct nicvf_hw_stats {\n\tu64 rx_bytes;\n\tu64 rx_frames;\n\tu64 rx_ucast_frames;\n\tu64 rx_bcast_frames;\n\tu64 rx_mcast_frames;\n\tu64 rx_drops;\n\tu64 rx_drop_red;\n\tu64 rx_drop_red_bytes;\n\tu64 rx_drop_overrun;\n\tu64 rx_drop_overrun_bytes;\n\tu64 rx_drop_bcast;\n\tu64 rx_drop_mcast;\n\tu64 rx_drop_l3_bcast;\n\tu64 rx_drop_l3_mcast;\n\tu64 rx_fcs_errors;\n\tu64 rx_l2_errors;\n\n\tu64 tx_bytes;\n\tu64 tx_frames;\n\tu64 tx_ucast_frames;\n\tu64 tx_bcast_frames;\n\tu64 tx_mcast_frames;\n\tu64 tx_drops;\n};\n\nstruct nicvf_drv_stats {\n\t \n\tu64 rx_bgx_truncated_pkts;\n\tu64 rx_jabber_errs;\n\tu64 rx_fcs_errs;\n\tu64 rx_bgx_errs;\n\tu64 rx_prel2_errs;\n\tu64 rx_l2_hdr_malformed;\n\tu64 rx_oversize;\n\tu64 rx_undersize;\n\tu64 rx_l2_len_mismatch;\n\tu64 rx_l2_pclp;\n\tu64 rx_ip_ver_errs;\n\tu64 rx_ip_csum_errs;\n\tu64 rx_ip_hdr_malformed;\n\tu64 rx_ip_payload_malformed;\n\tu64 rx_ip_ttl_errs;\n\tu64 rx_l3_pclp;\n\tu64 rx_l4_malformed;\n\tu64 rx_l4_csum_errs;\n\tu64 rx_udp_len_errs;\n\tu64 rx_l4_port_errs;\n\tu64 rx_tcp_flag_errs;\n\tu64 rx_tcp_offset_errs;\n\tu64 rx_l4_pclp;\n\tu64 rx_truncated_pkts;\n\n\t \n\tu64 tx_desc_fault;\n\tu64 tx_hdr_cons_err;\n\tu64 tx_subdesc_err;\n\tu64 tx_max_size_exceeded;\n\tu64 tx_imm_size_oflow;\n\tu64 tx_data_seq_err;\n\tu64 tx_mem_seq_err;\n\tu64 tx_lock_viol;\n\tu64 tx_data_fault;\n\tu64 tx_tstmp_conflict;\n\tu64 tx_tstmp_timeout;\n\tu64 tx_mem_fault;\n\tu64 tx_csum_overlap;\n\tu64 tx_csum_overflow;\n\n\t \n\tu64 tx_tso;\n\tu64 tx_timeout;\n\tu64 txq_stop;\n\tu64 txq_wake;\n\n\tu64 rcv_buffer_alloc_failures;\n\tu64 page_alloc;\n\n\tstruct u64_stats_sync   syncp;\n};\n\nstruct cavium_ptp;\n\nstruct xcast_addr_list {\n\tint              count;\n\tu64              mc[];\n};\n\nstruct nicvf_work {\n\tstruct work_struct     work;\n\tu8                     mode;\n\tstruct xcast_addr_list *mc;\n};\n\nstruct nicvf {\n\tstruct nicvf\t\t*pnicvf;\n\tstruct net_device\t*netdev;\n\tstruct pci_dev\t\t*pdev;\n\tvoid __iomem\t\t*reg_base;\n\tstruct bpf_prog         *xdp_prog;\n#define\tMAX_QUEUES_PER_QSET\t\t\t8\n\tstruct queue_set\t*qs;\n\tvoid\t\t\t*iommu_domain;\n\tu8\t\t\tvf_id;\n\tu8\t\t\tsqs_id;\n\tbool                    sqs_mode;\n\tbool\t\t\thw_tso;\n\tbool\t\t\tt88;\n\n\t \n\tu32\t\t\trb_page_offset;\n\tu16\t\t\trb_pageref;\n\tbool\t\t\trb_alloc_fail;\n\tbool\t\t\trb_work_scheduled;\n\tstruct page\t\t*rb_page;\n\tstruct delayed_work\trbdr_work;\n\tstruct tasklet_struct\trbdr_task;\n\n\t \n\tu8\t\t\tsqs_count;\n#define\tMAX_SQS_PER_VF_SINGLE_NODE\t\t5\n#define\tMAX_SQS_PER_VF\t\t\t\t11\n\tstruct nicvf\t\t*snicvf[MAX_SQS_PER_VF];\n\n\t \n\tu8\t\t\trx_queues;\n\tu8\t\t\ttx_queues;\n\tu8\t\t\txdp_tx_queues;\n\tu8\t\t\tmax_queues;\n\n\tu8\t\t\tnode;\n\tu8\t\t\tcpi_alg;\n\tbool\t\t\tlink_up;\n\tu8\t\t\tmac_type;\n\tu8\t\t\tduplex;\n\tu32\t\t\tspeed;\n\tbool\t\t\ttns_mode;\n\tbool\t\t\tloopback_supported;\n\tstruct nicvf_rss_info\trss_info;\n\tstruct nicvf_pfc\tpfc;\n\tstruct tasklet_struct\tqs_err_task;\n\tstruct work_struct\treset_task;\n\tstruct nicvf_work       rx_mode_work;\n\t \n\tspinlock_t              rx_mode_wq_lock;\n\t \n\tstruct workqueue_struct *nicvf_rx_mode_wq;\n\t \n\tstruct mutex            rx_mode_mtx;\n\tstruct delayed_work\tlink_change_work;\n\t \n\tstruct cavium_ptp\t*ptp_clock;\n\t \n\tbool\t\t\thw_rx_tstamp;\n\t \n\tstruct sk_buff\t\t*ptp_skb;\n\t \n\tatomic_t\t\ttx_ptp_skbs;\n\n\t \n\tu32\t\t\tcq_coalesce_usecs;\n\tu32\t\t\tmsg_enable;\n\n\t \n\tstruct nicvf_hw_stats   hw_stats;\n\tstruct nicvf_drv_stats  __percpu *drv_stats;\n\tstruct bgx_stats\tbgx_stats;\n\n\t \n\tstruct nicvf_cq_poll\t*napi[8];\n\n\t \n\tu8\t\t\tnum_vec;\n\tchar\t\t\tirq_name[NIC_VF_MSIX_VECTORS][IFNAMSIZ + 15];\n\tbool\t\t\tirq_allocated[NIC_VF_MSIX_VECTORS];\n\tcpumask_var_t\t\taffinity_mask[NIC_VF_MSIX_VECTORS];\n\n\t \n\tbool\t\t\tpf_acked;\n\tbool\t\t\tpf_nacked;\n\tbool\t\t\tset_mac_pending;\n} ____cacheline_aligned_in_smp;\n\n \n\n \n#define\tNIC_PF_VF_MAILBOX_SIZE\t\t2\n#define\tNIC_MBOX_MSG_TIMEOUT\t\t2000  \n\n \n#define\tNIC_MBOX_MSG_READY\t\t0x01\t \n#define\tNIC_MBOX_MSG_ACK\t\t0x02\t \n#define\tNIC_MBOX_MSG_NACK\t\t0x03\t \n#define\tNIC_MBOX_MSG_QS_CFG\t\t0x04\t \n#define\tNIC_MBOX_MSG_RQ_CFG\t\t0x05\t \n#define\tNIC_MBOX_MSG_SQ_CFG\t\t0x06\t \n#define\tNIC_MBOX_MSG_RQ_DROP_CFG\t0x07\t \n#define\tNIC_MBOX_MSG_SET_MAC\t\t0x08\t \n#define\tNIC_MBOX_MSG_SET_MAX_FRS\t0x09\t \n#define\tNIC_MBOX_MSG_CPI_CFG\t\t0x0A\t \n#define\tNIC_MBOX_MSG_RSS_SIZE\t\t0x0B\t \n#define\tNIC_MBOX_MSG_RSS_CFG\t\t0x0C\t \n#define\tNIC_MBOX_MSG_RSS_CFG_CONT\t0x0D\t \n#define\tNIC_MBOX_MSG_RQ_BP_CFG\t\t0x0E\t \n#define\tNIC_MBOX_MSG_RQ_SW_SYNC\t\t0x0F\t \n#define\tNIC_MBOX_MSG_BGX_STATS\t\t0x10\t \n#define\tNIC_MBOX_MSG_BGX_LINK_CHANGE\t0x11\t \n#define\tNIC_MBOX_MSG_ALLOC_SQS\t\t0x12\t \n#define\tNIC_MBOX_MSG_NICVF_PTR\t\t0x13\t \n#define\tNIC_MBOX_MSG_PNICVF_PTR\t\t0x14\t \n#define\tNIC_MBOX_MSG_SNICVF_PTR\t\t0x15\t \n#define\tNIC_MBOX_MSG_LOOPBACK\t\t0x16\t \n#define\tNIC_MBOX_MSG_RESET_STAT_COUNTER 0x17\t \n#define\tNIC_MBOX_MSG_PFC\t\t0x18\t \n#define\tNIC_MBOX_MSG_PTP_CFG\t\t0x19\t \n#define\tNIC_MBOX_MSG_CFG_DONE\t\t0xF0\t \n#define\tNIC_MBOX_MSG_SHUTDOWN\t\t0xF1\t \n#define\tNIC_MBOX_MSG_RESET_XCAST\t0xF2     \n#define\tNIC_MBOX_MSG_ADD_MCAST\t\t0xF3     \n#define\tNIC_MBOX_MSG_SET_XCAST\t\t0xF4     \n\nstruct nic_cfg_msg {\n\tu8    msg;\n\tu8    vf_id;\n\tu8    node_id;\n\tu8    tns_mode:1;\n\tu8    sqs_mode:1;\n\tu8    loopback_supported:1;\n\tu8    mac_addr[ETH_ALEN];\n};\n\n \nstruct qs_cfg_msg {\n\tu8    msg;\n\tu8    num;\n\tu8    sqs_count;\n\tu64   cfg;\n};\n\n \nstruct rq_cfg_msg {\n\tu8    msg;\n\tu8    qs_num;\n\tu8    rq_num;\n\tu64   cfg;\n};\n\n \nstruct sq_cfg_msg {\n\tu8    msg;\n\tu8    qs_num;\n\tu8    sq_num;\n\tbool  sqs_mode;\n\tu64   cfg;\n};\n\n \nstruct set_mac_msg {\n\tu8    msg;\n\tu8    vf_id;\n\tu8    mac_addr[ETH_ALEN];\n};\n\n \nstruct set_frs_msg {\n\tu8    msg;\n\tu8    vf_id;\n\tu16   max_frs;\n};\n\n \nstruct cpi_cfg_msg {\n\tu8    msg;\n\tu8    vf_id;\n\tu8    rq_cnt;\n\tu8    cpi_alg;\n};\n\n \nstruct rss_sz_msg {\n\tu8    msg;\n\tu8    vf_id;\n\tu16   ind_tbl_size;\n};\n\n \nstruct rss_cfg_msg {\n\tu8    msg;\n\tu8    vf_id;\n\tu8    hash_bits;\n\tu8    tbl_len;\n\tu8    tbl_offset;\n#define RSS_IND_TBL_LEN_PER_MBX_MSG\t8\n\tu8    ind_tbl[RSS_IND_TBL_LEN_PER_MBX_MSG];\n};\n\nstruct bgx_stats_msg {\n\tu8    msg;\n\tu8    vf_id;\n\tu8    rx;\n\tu8    idx;\n\tu64   stats;\n};\n\n \nstruct bgx_link_status {\n\tu8    msg;\n\tu8    mac_type;\n\tu8    link_up;\n\tu8    duplex;\n\tu32   speed;\n};\n\n \nstruct sqs_alloc {\n\tu8    msg;\n\tu8    vf_id;\n\tu8    qs_count;\n};\n\nstruct nicvf_ptr {\n\tu8    msg;\n\tu8    vf_id;\n\tbool  sqs_mode;\n\tu8    sqs_id;\n\tu64   nicvf;\n};\n\n \nstruct set_loopback {\n\tu8    msg;\n\tu8    vf_id;\n\tbool  enable;\n};\n\n \nstruct reset_stat_cfg {\n\tu8    msg;\n\t \n\tu16   rx_stat_mask;\n\t \n\tu8    tx_stat_mask;\n\t \n\tu16   rq_stat_mask;\n\t \n\tu16   sq_stat_mask;\n};\n\nstruct pfc {\n\tu8    msg;\n\tu8    get;  \n\tu8    autoneg;\n\tu8    fc_rx;\n\tu8    fc_tx;\n};\n\nstruct set_ptp {\n\tu8    msg;\n\tbool  enable;\n};\n\nstruct xcast {\n\tu8    msg;\n\tu8    mode;\n\tu64   mac:48;\n};\n\n \nunion nic_mbx {\n\tstruct { u8 msg; }\tmsg;\n\tstruct nic_cfg_msg\tnic_cfg;\n\tstruct qs_cfg_msg\tqs;\n\tstruct rq_cfg_msg\trq;\n\tstruct sq_cfg_msg\tsq;\n\tstruct set_mac_msg\tmac;\n\tstruct set_frs_msg\tfrs;\n\tstruct cpi_cfg_msg\tcpi_cfg;\n\tstruct rss_sz_msg\trss_size;\n\tstruct rss_cfg_msg\trss_cfg;\n\tstruct bgx_stats_msg    bgx_stats;\n\tstruct bgx_link_status  link_status;\n\tstruct sqs_alloc        sqs_alloc;\n\tstruct nicvf_ptr\tnicvf;\n\tstruct set_loopback\tlbk;\n\tstruct reset_stat_cfg\treset_stat;\n\tstruct pfc\t\tpfc;\n\tstruct set_ptp\t\tptp;\n\tstruct xcast            xcast;\n};\n\n#define NIC_NODE_ID_MASK\t0x03\n#define NIC_NODE_ID_SHIFT\t44\n\nstatic inline int nic_get_node_id(struct pci_dev *pdev)\n{\n\tu64 addr = pci_resource_start(pdev, PCI_CFG_REG_BAR_NUM);\n\treturn ((addr >> NIC_NODE_ID_SHIFT) & NIC_NODE_ID_MASK);\n}\n\nstatic inline bool pass1_silicon(struct pci_dev *pdev)\n{\n\treturn (pdev->revision < 8) &&\n\t\t(pdev->subsystem_device == PCI_SUBSYS_DEVID_88XX_NIC_PF);\n}\n\nstatic inline bool pass2_silicon(struct pci_dev *pdev)\n{\n\treturn (pdev->revision >= 8) &&\n\t\t(pdev->subsystem_device == PCI_SUBSYS_DEVID_88XX_NIC_PF);\n}\n\nint nicvf_set_real_num_queues(struct net_device *netdev,\n\t\t\t      int tx_queues, int rx_queues);\nint nicvf_open(struct net_device *netdev);\nint nicvf_stop(struct net_device *netdev);\nint nicvf_send_msg_to_pf(struct nicvf *vf, union nic_mbx *mbx);\nvoid nicvf_config_rss(struct nicvf *nic);\nvoid nicvf_set_rss_key(struct nicvf *nic);\nvoid nicvf_set_ethtool_ops(struct net_device *netdev);\nvoid nicvf_update_stats(struct nicvf *nic);\nvoid nicvf_update_lmac_stats(struct nicvf *nic);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}