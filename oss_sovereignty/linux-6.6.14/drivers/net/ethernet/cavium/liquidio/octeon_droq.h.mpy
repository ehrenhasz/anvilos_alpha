{
  "module_name": "octeon_droq.h",
  "hash_id": "44151bdce47beee1e2d64544bd7380398c97ef1ef52bb8e12bed4d7e4e630149",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/cavium/liquidio/octeon_droq.h",
  "human_readable_source": " \n \n\n#ifndef __OCTEON_DROQ_H__\n#define __OCTEON_DROQ_H__\n\n \n#define MAX_PACKET_BUDGET 0xFFFFFFFF\n\n \nstruct octeon_droq_desc {\n\t \n\tu64 buffer_ptr;\n\n\t \n\tu64 info_ptr;\n};\n\n#define OCT_DROQ_DESC_SIZE    (sizeof(struct octeon_droq_desc))\n\n \nstruct octeon_droq_info {\n\t \n\tu64 length;\n\n\t \n\tunion octeon_rh rh;\n};\n\n#define OCT_DROQ_INFO_SIZE   (sizeof(struct octeon_droq_info))\n\nstruct octeon_skb_page_info {\n\t \n\tdma_addr_t dma;\n\n\t \n\tstruct page *page;\n\n\t \n\tunsigned int page_offset;\n};\n\n \nstruct octeon_recv_buffer {\n\t \n\tvoid *buffer;\n\n\t \n\tu8 *data;\n\n\t \n\tstruct octeon_skb_page_info pg_info;\n};\n\n#define OCT_DROQ_RECVBUF_SIZE    (sizeof(struct octeon_recv_buffer))\n\n \nstruct oct_droq_stats {\n\t \n\tu64 pkts_received;\n\n\t \n\tu64 bytes_received;\n\n\t \n\tu64 dropped_nodispatch;\n\n\t \n\tu64 dropped_nomem;\n\n\t \n\tu64 dropped_toomany;\n\n\t \n\tu64 rx_pkts_received;\n\n\t \n\tu64 rx_bytes_received;\n\n\t \n\tu64 rx_dropped;\n\n\tu64 rx_vxlan;\n\n\t \n\tu64 rx_alloc_failure;\n\n};\n\n \n#define    MAX_RECV_BUFS    64\n\n \nstruct octeon_recv_pkt {\n\t \n\tu16 buffer_count;\n\n\t \n\tu16 octeon_id;\n\n\t \n\tu32 length;\n\n\t \n\tunion octeon_rh rh;\n\n\t \n\tvoid *buffer_ptr[MAX_RECV_BUFS];\n\n\t \n\tu32 buffer_size[MAX_RECV_BUFS];\n};\n\n#define OCT_RECV_PKT_SIZE    (sizeof(struct octeon_recv_pkt))\n\n \nstruct octeon_recv_info {\n\tvoid *rsvd;\n\tstruct octeon_recv_pkt *recv_pkt;\n};\n\n#define  OCT_RECV_INFO_SIZE    (sizeof(struct octeon_recv_info))\n\n \nstatic inline struct octeon_recv_info *octeon_alloc_recv_info(int extra_bytes)\n{\n\tstruct octeon_recv_info *recv_info;\n\tu8 *buf;\n\n\tbuf = kmalloc(OCT_RECV_PKT_SIZE + OCT_RECV_INFO_SIZE +\n\t\t      extra_bytes, GFP_ATOMIC);\n\tif (!buf)\n\t\treturn NULL;\n\n\trecv_info = (struct octeon_recv_info *)buf;\n\trecv_info->recv_pkt =\n\t\t(struct octeon_recv_pkt *)(buf + OCT_RECV_INFO_SIZE);\n\trecv_info->rsvd = NULL;\n\tif (extra_bytes)\n\t\trecv_info->rsvd = buf + OCT_RECV_INFO_SIZE + OCT_RECV_PKT_SIZE;\n\n\treturn recv_info;\n}\n\n \nstatic inline void octeon_free_recv_info(struct octeon_recv_info *recv_info)\n{\n\tkfree(recv_info);\n}\n\ntypedef int (*octeon_dispatch_fn_t)(struct octeon_recv_info *, void *);\n\n \nstruct octeon_droq_ops {\n\t \n\tvoid (*fptr)(u32, void *, u32, union octeon_rh *, void *, void *);\n\tvoid *farg;\n\n\t \n\tvoid (*napi_fn)(void *);\n\n\tu32 poll_mode;\n\n\t \n\tu32 drop_on_max;\n};\n\n \nstruct octeon_droq {\n\tu32 q_no;\n\n\tu32 pkt_count;\n\n\tstruct octeon_droq_ops ops;\n\n\tstruct octeon_device *oct_dev;\n\n\t \n\tstruct octeon_droq_desc *desc_ring;\n\n\t \n\tu32 read_idx;\n\n\t \n\tu32 write_idx;\n\n\t \n\tu32 refill_idx;\n\n\t \n\tatomic_t pkts_pending;\n\n\t \n\tu32 max_count;\n\n\t \n\tu32 refill_count;\n\n\tu32 pkts_per_intr;\n\tu32 refill_threshold;\n\n\t \n\tu32 max_empty_descs;\n\n\t \n\tstruct octeon_recv_buffer *recv_buf_list;\n\n\t \n\tu32 buffer_size;\n\n\t \n\tvoid  __iomem *pkts_credit_reg;\n\n\t \n\tvoid __iomem *pkts_sent_reg;\n\n\tstruct list_head dispatch_list;\n\n\t \n\tstruct oct_droq_stats stats;\n\n\t \n\tsize_t desc_ring_dma;\n\n\t \n\tvoid *app_ctx;\n\n\tstruct napi_struct napi;\n\n\tu32 cpu_id;\n\n\tcall_single_data_t csd;\n};\n\n#define OCT_DROQ_SIZE   (sizeof(struct octeon_droq))\n\n \nint octeon_init_droq(struct octeon_device *oct_dev,\n\t\t     u32 q_no,\n\t\t     u32 num_descs,\n\t\t     u32 desc_size,\n\t\t     void *app_ctx);\n\n \nint octeon_delete_droq(struct octeon_device *oct_dev, u32 q_no);\n\n \nint\nocteon_register_droq_ops(struct octeon_device *oct,\n\t\t\t u32 q_no,\n\t\t\t struct octeon_droq_ops *ops);\n\n \nint octeon_unregister_droq_ops(struct octeon_device *oct, u32 q_no);\n\n \nint octeon_register_dispatch_fn(struct octeon_device *oct,\n\t\t\t\tu16 opcode,\n\t\t\t\tu16 subcode,\n\t\t\t\tocteon_dispatch_fn_t fn, void *fn_arg);\n\nvoid *octeon_get_dispatch_arg(struct octeon_device *oct,\n\t\t\t      u16 opcode, u16 subcode);\n\nvoid octeon_droq_print_stats(void);\n\nu32 octeon_droq_check_hw_for_pkts(struct octeon_droq *droq);\n\nint octeon_create_droq(struct octeon_device *oct, u32 q_no,\n\t\t       u32 num_descs, u32 desc_size, void *app_ctx);\n\nint octeon_droq_process_packets(struct octeon_device *oct,\n\t\t\t\tstruct octeon_droq *droq,\n\t\t\t\tu32 budget);\n\nint octeon_droq_process_poll_pkts(struct octeon_device *oct,\n\t\t\t\t  struct octeon_droq *droq, u32 budget);\n\nint octeon_enable_irq(struct octeon_device *oct, u32 q_no);\n\nint octeon_retry_droq_refill(struct octeon_droq *droq);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}