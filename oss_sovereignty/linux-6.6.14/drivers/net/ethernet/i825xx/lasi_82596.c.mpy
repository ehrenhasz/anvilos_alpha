{
  "module_name": "lasi_82596.c",
  "hash_id": "93072a3b9ae28e920dfdc6c93bedcb431ddb662861aa40f8b92e5853efa08205",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/i825xx/lasi_82596.c",
  "human_readable_source": "\n \n\n \n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/ptrace.h>\n#include <linux/errno.h>\n#include <linux/ioport.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/netdevice.h>\n#include <linux/etherdevice.h>\n#include <linux/skbuff.h>\n#include <linux/types.h>\n#include <linux/bitops.h>\n#include <linux/dma-mapping.h>\n\n#include <asm/io.h>\n#include <asm/irq.h>\n#include <asm/pdc.h>\n#include <asm/parisc-device.h>\n\n#define LASI_82596_DRIVER_VERSION \"LASI 82596 driver - Revision: 1.30\"\n\n#define PA_I82596_RESET\t\t0\t \n#define PA_CPU_PORT_L_ACCESS\t4\n#define PA_CHANNEL_ATTENTION\t8\n\n#define OPT_SWAP_PORT\t0x0001\t \n\n#define SYSBUS      0x0000006c\n\n \n#define SWAP32(x)   (((u32)(x)<<16) | ((((u32)(x)))>>16))\n#define SWAP16(x)   (x)\n\n#define NONCOHERENT_DMA 1\n\n#include \"lib82596.c\"\n\nMODULE_AUTHOR(\"Richard Hirst\");\nMODULE_DESCRIPTION(\"i82596 driver\");\nMODULE_LICENSE(\"GPL\");\nmodule_param(i596_debug, int, 0);\nMODULE_PARM_DESC(i596_debug, \"lasi_82596 debug mask\");\n\nstatic inline void ca(struct net_device *dev)\n{\n\tgsc_writel(0, dev->base_addr + PA_CHANNEL_ATTENTION);\n}\n\n\nstatic void mpu_port(struct net_device *dev, int c, dma_addr_t x)\n{\n\tstruct i596_private *lp = netdev_priv(dev);\n\n\tu32 v = (u32) (c) | (u32) (x);\n\tu16 a, b;\n\n\tif (lp->options & OPT_SWAP_PORT) {\n\t\ta = v >> 16;\n\t\tb = v & 0xffff;\n\t} else {\n\t\ta = v & 0xffff;\n\t\tb = v >> 16;\n\t}\n\n\tgsc_writel(a, dev->base_addr + PA_CPU_PORT_L_ACCESS);\n\tif (!running_on_qemu)\n\t\tudelay(1);\n\tgsc_writel(b, dev->base_addr + PA_CPU_PORT_L_ACCESS);\n}\n\n#define LAN_PROM_ADDR\t0xF0810000\n\nstatic int __init\nlan_init_chip(struct parisc_device *dev)\n{\n\tstruct\tnet_device *netdevice;\n\tstruct i596_private *lp;\n\tint retval = -ENOMEM;\n\tu8 addr[ETH_ALEN];\n\tint i;\n\n\tif (!dev->irq) {\n\t\tprintk(KERN_ERR \"%s: IRQ not found for i82596 at 0x%lx\\n\",\n\t\t\t__FILE__, (unsigned long)dev->hpa.start);\n\t\treturn -ENODEV;\n\t}\n\n\tprintk(KERN_INFO \"Found i82596 at 0x%lx, IRQ %d\\n\",\n\t\t\t(unsigned long)dev->hpa.start, dev->irq);\n\n\tnetdevice = alloc_etherdev(sizeof(struct i596_private));\n\tif (!netdevice)\n\t\treturn -ENOMEM;\n\tSET_NETDEV_DEV(netdevice, &dev->dev);\n\tparisc_set_drvdata (dev, netdevice);\n\n\tnetdevice->base_addr = dev->hpa.start;\n\tnetdevice->irq = dev->irq;\n\n\tif (pdc_lan_station_id(addr, netdevice->base_addr)) {\n\t\tfor (i = 0; i < 6; i++) {\n\t\t\taddr[i] = gsc_readb(LAN_PROM_ADDR + i);\n\t\t}\n\t\tprintk(KERN_INFO\n\t\t       \"%s: MAC of HP700 LAN read from EEPROM\\n\", __FILE__);\n\t}\n\teth_hw_addr_set(netdevice, addr);\n\n\tlp = netdev_priv(netdevice);\n\tlp->options = dev->id.sversion == 0x72 ? OPT_SWAP_PORT : 0;\n\tlp->dma = dma_alloc_noncoherent(&dev->dev,\n\t\t\tsizeof(struct i596_dma), &lp->dma_addr,\n\t\t\tDMA_BIDIRECTIONAL, GFP_KERNEL);\n\tif (!lp->dma)\n\t\tgoto out_free_netdev;\n\n\tretval = i82596_probe(netdevice);\n\tif (retval)\n\t\tgoto out_free_dma;\n\treturn 0;\n\nout_free_dma:\n\tdma_free_noncoherent(&dev->dev, sizeof(struct i596_dma),\n\t\t       lp->dma, lp->dma_addr, DMA_BIDIRECTIONAL);\nout_free_netdev:\n\tfree_netdev(netdevice);\n\treturn retval;\n}\n\nstatic void __exit lan_remove_chip(struct parisc_device *pdev)\n{\n\tstruct net_device *dev = parisc_get_drvdata(pdev);\n\tstruct i596_private *lp = netdev_priv(dev);\n\n\tunregister_netdev (dev);\n\tdma_free_noncoherent(&pdev->dev, sizeof(struct i596_private), lp->dma,\n\t\t       lp->dma_addr, DMA_BIDIRECTIONAL);\n\tfree_netdev (dev);\n}\n\nstatic const struct parisc_device_id lan_tbl[] __initconst = {\n\t{ HPHW_FIO, HVERSION_REV_ANY_ID, HVERSION_ANY_ID, 0x0008a },\n\t{ HPHW_FIO, HVERSION_REV_ANY_ID, HVERSION_ANY_ID, 0x00072 },\n\t{ 0, }\n};\n\nMODULE_DEVICE_TABLE(parisc, lan_tbl);\n\nstatic struct parisc_driver lan_driver __refdata = {\n\t.name\t\t= \"lasi_82596\",\n\t.id_table\t= lan_tbl,\n\t.probe\t\t= lan_init_chip,\n\t.remove         = __exit_p(lan_remove_chip),\n};\n\nstatic int lasi_82596_init(void)\n{\n\tprintk(KERN_INFO LASI_82596_DRIVER_VERSION \"\\n\");\n\treturn register_parisc_driver(&lan_driver);\n}\n\nmodule_init(lasi_82596_init);\n\nstatic void __exit lasi_82596_exit(void)\n{\n\tunregister_parisc_driver(&lan_driver);\n}\n\nmodule_exit(lasi_82596_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}