{
  "module_name": "sni_82596.c",
  "hash_id": "cd595be2faf952d8c67a898c383edd004aec72f7d7bb1e4e574c547d1b369fea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/i825xx/sni_82596.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/errno.h>\n#include <linux/ioport.h>\n#include <linux/interrupt.h>\n#include <linux/delay.h>\n#include <linux/netdevice.h>\n#include <linux/etherdevice.h>\n#include <linux/skbuff.h>\n#include <linux/types.h>\n#include <linux/bitops.h>\n#include <linux/platform_device.h>\n#include <linux/io.h>\n#include <linux/irq.h>\n\n#define SNI_82596_DRIVER_VERSION \"SNI RM 82596 driver - Revision: 0.01\"\n\nstatic const char sni_82596_string[] = \"snirm_82596\";\n\n#define SYSBUS      0x00004400\n\n \n#define SWAP32(x)   cpu_to_le32((u32)(x))\n#define SWAP16(x)   cpu_to_le16((u16)(x))\n\n#define OPT_MPU_16BIT    0x01\n\n#include \"lib82596.c\"\n\nMODULE_AUTHOR(\"Thomas Bogendoerfer\");\nMODULE_DESCRIPTION(\"i82596 driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:snirm_82596\");\nmodule_param(i596_debug, int, 0);\nMODULE_PARM_DESC(i596_debug, \"82596 debug mask\");\n\nstatic inline void ca(struct net_device *dev)\n{\n\tstruct i596_private *lp = netdev_priv(dev);\n\n\twritel(0, lp->ca);\n}\n\n\nstatic void mpu_port(struct net_device *dev, int c, dma_addr_t x)\n{\n\tstruct i596_private *lp = netdev_priv(dev);\n\n\tu32 v = (u32) (c) | (u32) (x);\n\n\tif (lp->options & OPT_MPU_16BIT) {\n\t\twritew(v & 0xffff, lp->mpu_port);\n\t\twmb();   \n\t\tudelay(1);\n\t\twritew(v >> 16, lp->mpu_port);\n\t} else {\n\t\twritel(v, lp->mpu_port);\n\t\twmb();   \n\t\tudelay(1);\n\t\twritel(v, lp->mpu_port);\n\t}\n}\n\n\nstatic int sni_82596_probe(struct platform_device *dev)\n{\n\tstruct\tnet_device *netdevice;\n\tstruct i596_private *lp;\n\tstruct  resource *res, *ca, *idprom, *options;\n\tint\tretval = -ENOMEM;\n\tvoid __iomem *mpu_addr;\n\tvoid __iomem *ca_addr;\n\tu8 __iomem *eth_addr;\n\tu8 mac[ETH_ALEN];\n\n\tres = platform_get_resource(dev, IORESOURCE_MEM, 0);\n\tca = platform_get_resource(dev, IORESOURCE_MEM, 1);\n\toptions = platform_get_resource(dev, 0, 0);\n\tidprom = platform_get_resource(dev, IORESOURCE_MEM, 2);\n\tif (!res || !ca || !options || !idprom)\n\t\treturn -ENODEV;\n\tmpu_addr = ioremap(res->start, 4);\n\tif (!mpu_addr)\n\t\treturn -ENOMEM;\n\tca_addr = ioremap(ca->start, 4);\n\tif (!ca_addr)\n\t\tgoto probe_failed_free_mpu;\n\n\tprintk(KERN_INFO \"Found i82596 at 0x%x\\n\", res->start);\n\n\tnetdevice = alloc_etherdev(sizeof(struct i596_private));\n\tif (!netdevice)\n\t\tgoto probe_failed_free_ca;\n\n\tSET_NETDEV_DEV(netdevice, &dev->dev);\n\tplatform_set_drvdata (dev, netdevice);\n\n\tnetdevice->base_addr = res->start;\n\tnetdevice->irq = platform_get_irq(dev, 0);\n\n\teth_addr = ioremap(idprom->start, 0x10);\n\tif (!eth_addr)\n\t\tgoto probe_failed;\n\n\t \n\tmac[0] = readb(eth_addr + 0x0b);\n\tmac[1] = readb(eth_addr + 0x0a);\n\tmac[2] = readb(eth_addr + 0x09);\n\tmac[3] = readb(eth_addr + 0x08);\n\tmac[4] = readb(eth_addr + 0x07);\n\tmac[5] = readb(eth_addr + 0x06);\n\teth_hw_addr_set(netdevice, mac);\n\tiounmap(eth_addr);\n\n\tif (netdevice->irq < 0) {\n\t\tprintk(KERN_ERR \"%s: IRQ not found for i82596 at 0x%lx\\n\",\n\t\t\t__FILE__, netdevice->base_addr);\n\t\tretval = netdevice->irq;\n\t\tgoto probe_failed;\n\t}\n\n\tlp = netdev_priv(netdevice);\n\tlp->options = options->flags & IORESOURCE_BITS;\n\tlp->ca = ca_addr;\n\tlp->mpu_port = mpu_addr;\n\n\tlp->dma = dma_alloc_coherent(&dev->dev, sizeof(struct i596_dma),\n\t\t\t\t     &lp->dma_addr, GFP_KERNEL);\n\tif (!lp->dma)\n\t\tgoto probe_failed;\n\n\tretval = i82596_probe(netdevice);\n\tif (retval)\n\t\tgoto probe_failed_free_dma;\n\treturn 0;\n\nprobe_failed_free_dma:\n\tdma_free_coherent(&dev->dev, sizeof(struct i596_dma), lp->dma,\n\t\t\t  lp->dma_addr);\nprobe_failed:\n\tfree_netdev(netdevice);\nprobe_failed_free_ca:\n\tiounmap(ca_addr);\nprobe_failed_free_mpu:\n\tiounmap(mpu_addr);\n\treturn retval;\n}\n\nstatic int sni_82596_driver_remove(struct platform_device *pdev)\n{\n\tstruct net_device *dev = platform_get_drvdata(pdev);\n\tstruct i596_private *lp = netdev_priv(dev);\n\n\tunregister_netdev(dev);\n\tdma_free_coherent(&pdev->dev, sizeof(struct i596_private), lp->dma,\n\t\t\t  lp->dma_addr);\n\tiounmap(lp->ca);\n\tiounmap(lp->mpu_port);\n\tfree_netdev (dev);\n\treturn 0;\n}\n\nstatic struct platform_driver sni_82596_driver = {\n\t.probe\t= sni_82596_probe,\n\t.remove\t= sni_82596_driver_remove,\n\t.driver\t= {\n\t\t.name\t= sni_82596_string,\n\t},\n};\n\nstatic int sni_82596_init(void)\n{\n\tprintk(KERN_INFO SNI_82596_DRIVER_VERSION \"\\n\");\n\treturn platform_driver_register(&sni_82596_driver);\n}\n\n\nstatic void __exit sni_82596_exit(void)\n{\n\tplatform_driver_unregister(&sni_82596_driver);\n}\n\nmodule_init(sni_82596_init);\nmodule_exit(sni_82596_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}