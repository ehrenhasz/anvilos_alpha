{
  "module_name": "ionic_devlink.c",
  "hash_id": "483f7794218a7d48124cb638151def802bb0817434fde8629bad2121e80ee9f5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/pensando/ionic/ionic_devlink.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/netdevice.h>\n\n#include \"ionic.h\"\n#include \"ionic_bus.h\"\n#include \"ionic_lif.h\"\n#include \"ionic_devlink.h\"\n\nstatic int ionic_dl_flash_update(struct devlink *dl,\n\t\t\t\t struct devlink_flash_update_params *params,\n\t\t\t\t struct netlink_ext_ack *extack)\n{\n\tstruct ionic *ionic = devlink_priv(dl);\n\n\treturn ionic_firmware_update(ionic->lif, params->fw, extack);\n}\n\nstatic int ionic_dl_info_get(struct devlink *dl, struct devlink_info_req *req,\n\t\t\t     struct netlink_ext_ack *extack)\n{\n\tstruct ionic *ionic = devlink_priv(dl);\n\tstruct ionic_dev *idev = &ionic->idev;\n\tchar buf[16];\n\tint err = 0;\n\n\terr = devlink_info_version_running_put(req,\n\t\t\t\t\t       DEVLINK_INFO_VERSION_GENERIC_FW,\n\t\t\t\t\t       idev->dev_info.fw_version);\n\tif (err)\n\t\treturn err;\n\n\tsnprintf(buf, sizeof(buf), \"0x%x\", idev->dev_info.asic_type);\n\terr = devlink_info_version_fixed_put(req,\n\t\t\t\t\t     DEVLINK_INFO_VERSION_GENERIC_ASIC_ID,\n\t\t\t\t\t     buf);\n\tif (err)\n\t\treturn err;\n\n\tsnprintf(buf, sizeof(buf), \"0x%x\", idev->dev_info.asic_rev);\n\terr = devlink_info_version_fixed_put(req,\n\t\t\t\t\t     DEVLINK_INFO_VERSION_GENERIC_ASIC_REV,\n\t\t\t\t\t     buf);\n\tif (err)\n\t\treturn err;\n\n\terr = devlink_info_serial_number_put(req, idev->dev_info.serial_num);\n\n\treturn err;\n}\n\nstatic const struct devlink_ops ionic_dl_ops = {\n\t.info_get\t= ionic_dl_info_get,\n\t.flash_update\t= ionic_dl_flash_update,\n};\n\nstruct ionic *ionic_devlink_alloc(struct device *dev)\n{\n\tstruct devlink *dl;\n\n\tdl = devlink_alloc(&ionic_dl_ops, sizeof(struct ionic), dev);\n\tif (!dl)\n\t\treturn NULL;\n\n\treturn devlink_priv(dl);\n}\n\nvoid ionic_devlink_free(struct ionic *ionic)\n{\n\tstruct devlink *dl = priv_to_devlink(ionic);\n\n\tdevlink_free(dl);\n}\n\nint ionic_devlink_register(struct ionic *ionic)\n{\n\tstruct devlink *dl = priv_to_devlink(ionic);\n\tstruct devlink_port_attrs attrs = {};\n\tint err;\n\n\tattrs.flavour = DEVLINK_PORT_FLAVOUR_PHYSICAL;\n\tdevlink_port_attrs_set(&ionic->dl_port, &attrs);\n\terr = devlink_port_register(dl, &ionic->dl_port, 0);\n\tif (err) {\n\t\tdev_err(ionic->dev, \"devlink_port_register failed: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\tSET_NETDEV_DEVLINK_PORT(ionic->lif->netdev, &ionic->dl_port);\n\tdevlink_register(dl);\n\treturn 0;\n}\n\nvoid ionic_devlink_unregister(struct ionic *ionic)\n{\n\tstruct devlink *dl = priv_to_devlink(ionic);\n\n\tdevlink_unregister(dl);\n\tdevlink_port_unregister(&ionic->dl_port);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}