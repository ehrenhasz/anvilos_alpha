{
  "module_name": "mtk_wed_wo.h",
  "hash_id": "0c492ea18e4aba406c87776b97fbbf2e2d943af2ffe2eb0c89e3ab7d0134d29a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mediatek/mtk_wed_wo.h",
  "human_readable_source": " \n \n\n#ifndef __MTK_WED_WO_H\n#define __MTK_WED_WO_H\n\n#include <linux/skbuff.h>\n#include <linux/netdevice.h>\n\nstruct mtk_wed_hw;\n\nstruct mtk_wed_mcu_hdr {\n\t \n\tu8 version;\n\tu8 cmd;\n\t__le16 length;\n\n\t \n\t__le16 seq;\n\t__le16 flag;\n\n\t \n\t__le32 status;\n\n\t \n\tu8 rsv[20];\n};\n\nstruct mtk_wed_wo_log_info {\n\t__le32 sn;\n\t__le32 total;\n\t__le32 rro;\n\t__le32 mod;\n};\n\nenum mtk_wed_wo_event {\n\tMTK_WED_WO_EVT_LOG_DUMP\t\t= 0x1,\n\tMTK_WED_WO_EVT_PROFILING\t= 0x2,\n\tMTK_WED_WO_EVT_RXCNT_INFO\t= 0x3,\n};\n\n#define MTK_WED_MODULE_ID_WO\t\t1\n#define MTK_FW_DL_TIMEOUT\t\t4000000  \n#define MTK_WOCPU_TIMEOUT\t\t2000000  \n\nenum {\n\tMTK_WED_WARP_CMD_FLAG_RSP\t\t= BIT(0),\n\tMTK_WED_WARP_CMD_FLAG_NEED_RSP\t\t= BIT(1),\n\tMTK_WED_WARP_CMD_FLAG_FROM_TO_WO\t= BIT(2),\n};\n\n#define MTK_WED_WO_CPU_MCUSYS_RESET_ADDR\t0x15194050\n#define MTK_WED_WO_CPU_WO0_MCUSYS_RESET_MASK\t0x20\n#define MTK_WED_WO_CPU_WO1_MCUSYS_RESET_MASK\t0x1\n\nenum {\n\tMTK_WED_WO_REGION_EMI,\n\tMTK_WED_WO_REGION_ILM,\n\tMTK_WED_WO_REGION_DATA,\n\tMTK_WED_WO_REGION_BOOT,\n\t__MTK_WED_WO_REGION_MAX,\n};\n\nenum mtk_wed_wo_state {\n\tMTK_WED_WO_STATE_UNDEFINED,\n\tMTK_WED_WO_STATE_INIT,\n\tMTK_WED_WO_STATE_ENABLE,\n\tMTK_WED_WO_STATE_DISABLE,\n\tMTK_WED_WO_STATE_HALT,\n\tMTK_WED_WO_STATE_GATING,\n\tMTK_WED_WO_STATE_SER_RESET,\n\tMTK_WED_WO_STATE_WF_RESET,\n};\n\nenum mtk_wed_wo_done_state {\n\tMTK_WED_WOIF_UNDEFINED,\n\tMTK_WED_WOIF_DISABLE_DONE,\n\tMTK_WED_WOIF_TRIGGER_ENABLE,\n\tMTK_WED_WOIF_ENABLE_DONE,\n\tMTK_WED_WOIF_TRIGGER_GATING,\n\tMTK_WED_WOIF_GATING_DONE,\n\tMTK_WED_WOIF_TRIGGER_HALT,\n\tMTK_WED_WOIF_HALT_DONE,\n};\n\nenum mtk_wed_dummy_cr_idx {\n\tMTK_WED_DUMMY_CR_FWDL,\n\tMTK_WED_DUMMY_CR_WO_STATUS,\n};\n\n#define MT7981_FIRMWARE_WO\t\"mediatek/mt7981_wo.bin\"\n#define MT7986_FIRMWARE_WO0\t\"mediatek/mt7986_wo_0.bin\"\n#define MT7986_FIRMWARE_WO1\t\"mediatek/mt7986_wo_1.bin\"\n\n#define MTK_WO_MCU_CFG_LS_BASE\t\t\t\t0\n#define MTK_WO_MCU_CFG_LS_HW_VER_ADDR\t\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x000)\n#define MTK_WO_MCU_CFG_LS_FW_VER_ADDR\t\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x004)\n#define MTK_WO_MCU_CFG_LS_CFG_DBG1_ADDR\t\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x00c)\n#define MTK_WO_MCU_CFG_LS_CFG_DBG2_ADDR\t\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x010)\n#define MTK_WO_MCU_CFG_LS_WF_MCCR_ADDR\t\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x014)\n#define MTK_WO_MCU_CFG_LS_WF_MCCR_SET_ADDR\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x018)\n#define MTK_WO_MCU_CFG_LS_WF_MCCR_CLR_ADDR\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x01c)\n#define MTK_WO_MCU_CFG_LS_WF_MCU_CFG_WM_WA_ADDR\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x050)\n#define MTK_WO_MCU_CFG_LS_WM_BOOT_ADDR_ADDR\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x060)\n#define MTK_WO_MCU_CFG_LS_WA_BOOT_ADDR_ADDR\t\t(MTK_WO_MCU_CFG_LS_BASE + 0x064)\n\n#define MTK_WO_MCU_CFG_LS_WF_WM_WA_WM_CPU_RSTB_MASK\tBIT(5)\n#define MTK_WO_MCU_CFG_LS_WF_WM_WA_WA_CPU_RSTB_MASK\tBIT(0)\n\n#define MTK_WED_WO_RING_SIZE\t256\n#define MTK_WED_WO_CMD_LEN\t1504\n\n#define MTK_WED_WO_TXCH_NUM\t\t0\n#define MTK_WED_WO_RXCH_NUM\t\t1\n#define MTK_WED_WO_RXCH_WO_EXCEPTION\t7\n\n#define MTK_WED_WO_TXCH_INT_MASK\tBIT(0)\n#define MTK_WED_WO_RXCH_INT_MASK\tBIT(1)\n#define MTK_WED_WO_EXCEPTION_INT_MASK\tBIT(7)\n#define MTK_WED_WO_ALL_INT_MASK\t\t(MTK_WED_WO_RXCH_INT_MASK | \\\n\t\t\t\t\t MTK_WED_WO_EXCEPTION_INT_MASK)\n\n#define MTK_WED_WO_CCIF_BUSY\t\t0x004\n#define MTK_WED_WO_CCIF_START\t\t0x008\n#define MTK_WED_WO_CCIF_TCHNUM\t\t0x00c\n#define MTK_WED_WO_CCIF_RCHNUM\t\t0x010\n#define MTK_WED_WO_CCIF_RCHNUM_MASK\tGENMASK(7, 0)\n\n#define MTK_WED_WO_CCIF_ACK\t\t0x014\n#define MTK_WED_WO_CCIF_IRQ0_MASK\t0x018\n#define MTK_WED_WO_CCIF_IRQ1_MASK\t0x01c\n#define MTK_WED_WO_CCIF_DUMMY1\t\t0x020\n#define MTK_WED_WO_CCIF_DUMMY2\t\t0x024\n#define MTK_WED_WO_CCIF_DUMMY3\t\t0x028\n#define MTK_WED_WO_CCIF_DUMMY4\t\t0x02c\n#define MTK_WED_WO_CCIF_SHADOW1\t\t0x030\n#define MTK_WED_WO_CCIF_SHADOW2\t\t0x034\n#define MTK_WED_WO_CCIF_SHADOW3\t\t0x038\n#define MTK_WED_WO_CCIF_SHADOW4\t\t0x03c\n#define MTK_WED_WO_CCIF_DUMMY5\t\t0x050\n#define MTK_WED_WO_CCIF_DUMMY6\t\t0x054\n#define MTK_WED_WO_CCIF_DUMMY7\t\t0x058\n#define MTK_WED_WO_CCIF_DUMMY8\t\t0x05c\n#define MTK_WED_WO_CCIF_SHADOW5\t\t0x060\n#define MTK_WED_WO_CCIF_SHADOW6\t\t0x064\n#define MTK_WED_WO_CCIF_SHADOW7\t\t0x068\n#define MTK_WED_WO_CCIF_SHADOW8\t\t0x06c\n\n#define MTK_WED_WO_CTL_SD_LEN1\t\tGENMASK(13, 0)\n#define MTK_WED_WO_CTL_LAST_SEC1\tBIT(14)\n#define MTK_WED_WO_CTL_BURST\t\tBIT(15)\n#define MTK_WED_WO_CTL_SD_LEN0_SHIFT\t16\n#define MTK_WED_WO_CTL_SD_LEN0\t\tGENMASK(29, 16)\n#define MTK_WED_WO_CTL_LAST_SEC0\tBIT(30)\n#define MTK_WED_WO_CTL_DMA_DONE\t\tBIT(31)\n#define MTK_WED_WO_INFO_WINFO\t\tGENMASK(15, 0)\n\nstruct mtk_wed_wo_memory_region {\n\tconst char *name;\n\tvoid __iomem *addr;\n\tphys_addr_t phy_addr;\n\tu32 size;\n\tbool shared:1;\n\tbool consumed:1;\n};\n\nstruct mtk_wed_fw_region {\n\t__le32 decomp_crc;\n\t__le32 decomp_len;\n\t__le32 decomp_blk_sz;\n\tu8 rsv0[4];\n\t__le32 addr;\n\t__le32 len;\n\tu8 feature_set;\n\tu8 rsv1[15];\n} __packed;\n\nstruct mtk_wed_fw_trailer {\n\tu8 chip_id;\n\tu8 eco_code;\n\tu8 num_region;\n\tu8 format_ver;\n\tu8 format_flag;\n\tu8 rsv[2];\n\tchar fw_ver[10];\n\tchar build_date[15];\n\tu32 crc;\n};\n\nstruct mtk_wed_wo_queue_regs {\n\tu32 desc_base;\n\tu32 ring_size;\n\tu32 cpu_idx;\n\tu32 dma_idx;\n};\n\nstruct mtk_wed_wo_queue_desc {\n\t__le32 buf0;\n\t__le32 ctrl;\n\t__le32 buf1;\n\t__le32 info;\n\t__le32 reserved[4];\n} __packed __aligned(32);\n\nstruct mtk_wed_wo_queue_entry {\n\tdma_addr_t addr;\n\tvoid *buf;\n\tu32 len;\n};\n\nstruct mtk_wed_wo_queue {\n\tstruct mtk_wed_wo_queue_regs regs;\n\n\tstruct page_frag_cache cache;\n\n\tstruct mtk_wed_wo_queue_desc *desc;\n\tdma_addr_t desc_dma;\n\n\tstruct mtk_wed_wo_queue_entry *entry;\n\n\tu16 head;\n\tu16 tail;\n\tint n_desc;\n\tint queued;\n\tint buf_size;\n\n};\n\nstruct mtk_wed_wo {\n\tstruct mtk_wed_hw *hw;\n\tstruct mtk_wed_wo_memory_region boot;\n\n\tstruct mtk_wed_wo_queue q_tx;\n\tstruct mtk_wed_wo_queue q_rx;\n\n\tstruct {\n\t\tstruct mutex mutex;\n\t\tint timeout;\n\t\tu16 seq;\n\n\t\tstruct sk_buff_head res_q;\n\t\twait_queue_head_t wait;\n\t} mcu;\n\n\tstruct {\n\t\tstruct regmap *regs;\n\n\t\tspinlock_t lock;\n\t\tstruct tasklet_struct irq_tasklet;\n\t\tint irq;\n\t\tu32 irq_mask;\n\t} mmio;\n};\n\nstatic inline int\nmtk_wed_mcu_check_msg(struct mtk_wed_wo *wo, struct sk_buff *skb)\n{\n\tstruct mtk_wed_mcu_hdr *hdr = (struct mtk_wed_mcu_hdr *)skb->data;\n\n\tif (hdr->version)\n\t\treturn -EINVAL;\n\n\tif (skb->len < sizeof(*hdr) || skb->len != le16_to_cpu(hdr->length))\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nvoid mtk_wed_mcu_rx_event(struct mtk_wed_wo *wo, struct sk_buff *skb);\nvoid mtk_wed_mcu_rx_unsolicited_event(struct mtk_wed_wo *wo,\n\t\t\t\t      struct sk_buff *skb);\nint mtk_wed_mcu_send_msg(struct mtk_wed_wo *wo, int id, int cmd,\n\t\t\t const void *data, int len, bool wait_resp);\nint mtk_wed_mcu_msg_update(struct mtk_wed_device *dev, int id, void *data,\n\t\t\t   int len);\nint mtk_wed_mcu_init(struct mtk_wed_wo *wo);\nint mtk_wed_wo_init(struct mtk_wed_hw *hw);\nvoid mtk_wed_wo_deinit(struct mtk_wed_hw *hw);\nint mtk_wed_wo_queue_tx_skb(struct mtk_wed_wo *dev, struct mtk_wed_wo_queue *q,\n\t\t\t    struct sk_buff *skb);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}