{
  "module_name": "mtk_wed_debugfs.c",
  "hash_id": "e7f09c1b044f00b7781070a2e0771d55e08221a868b3758bfec7cf23d236d97d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mediatek/mtk_wed_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/seq_file.h>\n#include <linux/soc/mediatek/mtk_wed.h>\n#include \"mtk_wed.h\"\n#include \"mtk_wed_regs.h\"\n\nstruct reg_dump {\n\tconst char *name;\n\tu16 offset;\n\tu8 type;\n\tu8 base;\n};\n\nenum {\n\tDUMP_TYPE_STRING,\n\tDUMP_TYPE_WED,\n\tDUMP_TYPE_WDMA,\n\tDUMP_TYPE_WPDMA_TX,\n\tDUMP_TYPE_WPDMA_TXFREE,\n\tDUMP_TYPE_WPDMA_RX,\n\tDUMP_TYPE_WED_RRO,\n};\n\n#define DUMP_STR(_str) { _str, 0, DUMP_TYPE_STRING }\n#define DUMP_REG(_reg, ...) { #_reg, MTK_##_reg, __VA_ARGS__ }\n#define DUMP_RING(_prefix, _base, ...)\t\t\t\t\\\n\t{ _prefix \" BASE\", _base, __VA_ARGS__ },\t\t\\\n\t{ _prefix \" CNT\",  _base + 0x4, __VA_ARGS__ },\t\\\n\t{ _prefix \" CIDX\", _base + 0x8, __VA_ARGS__ },\t\\\n\t{ _prefix \" DIDX\", _base + 0xc, __VA_ARGS__ }\n\n#define DUMP_WED(_reg) DUMP_REG(_reg, DUMP_TYPE_WED)\n#define DUMP_WED_RING(_base) DUMP_RING(#_base, MTK_##_base, DUMP_TYPE_WED)\n\n#define DUMP_WDMA(_reg) DUMP_REG(_reg, DUMP_TYPE_WDMA)\n#define DUMP_WDMA_RING(_base) DUMP_RING(#_base, MTK_##_base, DUMP_TYPE_WDMA)\n\n#define DUMP_WPDMA_TX_RING(_n) DUMP_RING(\"WPDMA_TX\" #_n, 0, DUMP_TYPE_WPDMA_TX, _n)\n#define DUMP_WPDMA_TXFREE_RING DUMP_RING(\"WPDMA_RX1\", 0, DUMP_TYPE_WPDMA_TXFREE)\n#define DUMP_WPDMA_RX_RING(_n)\tDUMP_RING(\"WPDMA_RX\" #_n, 0, DUMP_TYPE_WPDMA_RX, _n)\n#define DUMP_WED_RRO_RING(_base)DUMP_RING(\"WED_RRO_MIOD\", MTK_##_base, DUMP_TYPE_WED_RRO)\n#define DUMP_WED_RRO_FDBK(_base)DUMP_RING(\"WED_RRO_FDBK\", MTK_##_base, DUMP_TYPE_WED_RRO)\n\nstatic void\nprint_reg_val(struct seq_file *s, const char *name, u32 val)\n{\n\tseq_printf(s, \"%-32s %08x\\n\", name, val);\n}\n\nstatic void\ndump_wed_regs(struct seq_file *s, struct mtk_wed_device *dev,\n\t      const struct reg_dump *regs, int n_regs)\n{\n\tconst struct reg_dump *cur;\n\tu32 val;\n\n\tfor (cur = regs; cur < &regs[n_regs]; cur++) {\n\t\tswitch (cur->type) {\n\t\tcase DUMP_TYPE_STRING:\n\t\t\tseq_printf(s, \"%s======== %s:\\n\",\n\t\t\t\t   cur > regs ? \"\\n\" : \"\",\n\t\t\t\t   cur->name);\n\t\t\tcontinue;\n\t\tcase DUMP_TYPE_WED_RRO:\n\t\tcase DUMP_TYPE_WED:\n\t\t\tval = wed_r32(dev, cur->offset);\n\t\t\tbreak;\n\t\tcase DUMP_TYPE_WDMA:\n\t\t\tval = wdma_r32(dev, cur->offset);\n\t\t\tbreak;\n\t\tcase DUMP_TYPE_WPDMA_TX:\n\t\t\tval = wpdma_tx_r32(dev, cur->base, cur->offset);\n\t\t\tbreak;\n\t\tcase DUMP_TYPE_WPDMA_TXFREE:\n\t\t\tval = wpdma_txfree_r32(dev, cur->offset);\n\t\t\tbreak;\n\t\tcase DUMP_TYPE_WPDMA_RX:\n\t\t\tval = wpdma_rx_r32(dev, cur->base, cur->offset);\n\t\t\tbreak;\n\t\t}\n\t\tprint_reg_val(s, cur->name, val);\n\t}\n}\n\nstatic int\nwed_txinfo_show(struct seq_file *s, void *data)\n{\n\tstatic const struct reg_dump regs[] = {\n\t\tDUMP_STR(\"WED TX\"),\n\t\tDUMP_WED(WED_TX_MIB(0)),\n\t\tDUMP_WED_RING(WED_RING_TX(0)),\n\n\t\tDUMP_WED(WED_TX_MIB(1)),\n\t\tDUMP_WED_RING(WED_RING_TX(1)),\n\n\t\tDUMP_STR(\"WPDMA TX\"),\n\t\tDUMP_WED(WED_WPDMA_TX_MIB(0)),\n\t\tDUMP_WED_RING(WED_WPDMA_RING_TX(0)),\n\t\tDUMP_WED(WED_WPDMA_TX_COHERENT_MIB(0)),\n\n\t\tDUMP_WED(WED_WPDMA_TX_MIB(1)),\n\t\tDUMP_WED_RING(WED_WPDMA_RING_TX(1)),\n\t\tDUMP_WED(WED_WPDMA_TX_COHERENT_MIB(1)),\n\n\t\tDUMP_STR(\"WPDMA TX\"),\n\t\tDUMP_WPDMA_TX_RING(0),\n\t\tDUMP_WPDMA_TX_RING(1),\n\n\t\tDUMP_STR(\"WED WDMA RX\"),\n\t\tDUMP_WED(WED_WDMA_RX_MIB(0)),\n\t\tDUMP_WED_RING(WED_WDMA_RING_RX(0)),\n\t\tDUMP_WED(WED_WDMA_RX_THRES(0)),\n\t\tDUMP_WED(WED_WDMA_RX_RECYCLE_MIB(0)),\n\t\tDUMP_WED(WED_WDMA_RX_PROCESSED_MIB(0)),\n\n\t\tDUMP_WED(WED_WDMA_RX_MIB(1)),\n\t\tDUMP_WED_RING(WED_WDMA_RING_RX(1)),\n\t\tDUMP_WED(WED_WDMA_RX_THRES(1)),\n\t\tDUMP_WED(WED_WDMA_RX_RECYCLE_MIB(1)),\n\t\tDUMP_WED(WED_WDMA_RX_PROCESSED_MIB(1)),\n\n\t\tDUMP_STR(\"WDMA RX\"),\n\t\tDUMP_WDMA(WDMA_GLO_CFG),\n\t\tDUMP_WDMA_RING(WDMA_RING_RX(0)),\n\t\tDUMP_WDMA_RING(WDMA_RING_RX(1)),\n\n\t\tDUMP_STR(\"WED TX FREE\"),\n\t\tDUMP_WED(WED_RX_MIB(0)),\n\t\tDUMP_WED_RING(WED_RING_RX(0)),\n\t\tDUMP_WED(WED_WPDMA_RX_COHERENT_MIB(0)),\n\t\tDUMP_WED(WED_RX_MIB(1)),\n\t\tDUMP_WED_RING(WED_RING_RX(1)),\n\t\tDUMP_WED(WED_WPDMA_RX_COHERENT_MIB(1)),\n\n\t\tDUMP_STR(\"WED WPDMA TX FREE\"),\n\t\tDUMP_WED_RING(WED_WPDMA_RING_RX(0)),\n\t\tDUMP_WED_RING(WED_WPDMA_RING_RX(1)),\n\t};\n\tstruct mtk_wed_hw *hw = s->private;\n\tstruct mtk_wed_device *dev = hw->wed_dev;\n\n\tif (dev)\n\t\tdump_wed_regs(s, dev, regs, ARRAY_SIZE(regs));\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(wed_txinfo);\n\nstatic int\nwed_rxinfo_show(struct seq_file *s, void *data)\n{\n\tstatic const struct reg_dump regs[] = {\n\t\tDUMP_STR(\"WPDMA RX\"),\n\t\tDUMP_WPDMA_RX_RING(0),\n\t\tDUMP_WPDMA_RX_RING(1),\n\n\t\tDUMP_STR(\"WPDMA RX\"),\n\t\tDUMP_WED(WED_WPDMA_RX_D_MIB(0)),\n\t\tDUMP_WED_RING(WED_WPDMA_RING_RX_DATA(0)),\n\t\tDUMP_WED(WED_WPDMA_RX_D_PROCESSED_MIB(0)),\n\t\tDUMP_WED(WED_WPDMA_RX_D_MIB(1)),\n\t\tDUMP_WED_RING(WED_WPDMA_RING_RX_DATA(1)),\n\t\tDUMP_WED(WED_WPDMA_RX_D_PROCESSED_MIB(1)),\n\t\tDUMP_WED(WED_WPDMA_RX_D_COHERENT_MIB),\n\n\t\tDUMP_STR(\"WED RX\"),\n\t\tDUMP_WED_RING(WED_RING_RX_DATA(0)),\n\t\tDUMP_WED_RING(WED_RING_RX_DATA(1)),\n\n\t\tDUMP_STR(\"WED RRO\"),\n\t\tDUMP_WED_RRO_RING(WED_RROQM_MIOD_CTRL0),\n\t\tDUMP_WED(WED_RROQM_MID_MIB),\n\t\tDUMP_WED(WED_RROQM_MOD_MIB),\n\t\tDUMP_WED(WED_RROQM_MOD_COHERENT_MIB),\n\t\tDUMP_WED_RRO_FDBK(WED_RROQM_FDBK_CTRL0),\n\t\tDUMP_WED(WED_RROQM_FDBK_IND_MIB),\n\t\tDUMP_WED(WED_RROQM_FDBK_ENQ_MIB),\n\t\tDUMP_WED(WED_RROQM_FDBK_ANC_MIB),\n\t\tDUMP_WED(WED_RROQM_FDBK_ANC2H_MIB),\n\n\t\tDUMP_STR(\"WED Route QM\"),\n\t\tDUMP_WED(WED_RTQM_R2H_MIB(0)),\n\t\tDUMP_WED(WED_RTQM_R2Q_MIB(0)),\n\t\tDUMP_WED(WED_RTQM_Q2H_MIB(0)),\n\t\tDUMP_WED(WED_RTQM_R2H_MIB(1)),\n\t\tDUMP_WED(WED_RTQM_R2Q_MIB(1)),\n\t\tDUMP_WED(WED_RTQM_Q2H_MIB(1)),\n\t\tDUMP_WED(WED_RTQM_Q2N_MIB),\n\t\tDUMP_WED(WED_RTQM_Q2B_MIB),\n\t\tDUMP_WED(WED_RTQM_PFDBK_MIB),\n\n\t\tDUMP_STR(\"WED WDMA TX\"),\n\t\tDUMP_WED(WED_WDMA_TX_MIB),\n\t\tDUMP_WED_RING(WED_WDMA_RING_TX),\n\n\t\tDUMP_STR(\"WDMA TX\"),\n\t\tDUMP_WDMA(WDMA_GLO_CFG),\n\t\tDUMP_WDMA_RING(WDMA_RING_TX(0)),\n\t\tDUMP_WDMA_RING(WDMA_RING_TX(1)),\n\n\t\tDUMP_STR(\"WED RX BM\"),\n\t\tDUMP_WED(WED_RX_BM_BASE),\n\t\tDUMP_WED(WED_RX_BM_RX_DMAD),\n\t\tDUMP_WED(WED_RX_BM_PTR),\n\t\tDUMP_WED(WED_RX_BM_TKID_MIB),\n\t\tDUMP_WED(WED_RX_BM_BLEN),\n\t\tDUMP_WED(WED_RX_BM_STS),\n\t\tDUMP_WED(WED_RX_BM_INTF2),\n\t\tDUMP_WED(WED_RX_BM_INTF),\n\t\tDUMP_WED(WED_RX_BM_ERR_STS),\n\t};\n\tstruct mtk_wed_hw *hw = s->private;\n\tstruct mtk_wed_device *dev = hw->wed_dev;\n\n\tif (dev)\n\t\tdump_wed_regs(s, dev, regs, ARRAY_SIZE(regs));\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(wed_rxinfo);\n\nstatic int\nmtk_wed_reg_set(void *data, u64 val)\n{\n\tstruct mtk_wed_hw *hw = data;\n\n\tregmap_write(hw->regs, hw->debugfs_reg, val);\n\n\treturn 0;\n}\n\nstatic int\nmtk_wed_reg_get(void *data, u64 *val)\n{\n\tstruct mtk_wed_hw *hw = data;\n\tunsigned int regval;\n\tint ret;\n\n\tret = regmap_read(hw->regs, hw->debugfs_reg, &regval);\n\tif (ret)\n\t\treturn ret;\n\n\t*val = regval;\n\n\treturn 0;\n}\n\nDEFINE_DEBUGFS_ATTRIBUTE(fops_regval, mtk_wed_reg_get, mtk_wed_reg_set,\n             \"0x%08llx\\n\");\n\nvoid mtk_wed_hw_add_debugfs(struct mtk_wed_hw *hw)\n{\n\tstruct dentry *dir;\n\n\tsnprintf(hw->dirname, sizeof(hw->dirname), \"wed%d\", hw->index);\n\tdir = debugfs_create_dir(hw->dirname, NULL);\n\n\thw->debugfs_dir = dir;\n\tdebugfs_create_u32(\"regidx\", 0600, dir, &hw->debugfs_reg);\n\tdebugfs_create_file_unsafe(\"regval\", 0600, dir, hw, &fops_regval);\n\tdebugfs_create_file_unsafe(\"txinfo\", 0400, dir, hw, &wed_txinfo_fops);\n\tif (hw->version != 1)\n\t\tdebugfs_create_file_unsafe(\"rxinfo\", 0400, dir, hw,\n\t\t\t\t\t   &wed_rxinfo_fops);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}