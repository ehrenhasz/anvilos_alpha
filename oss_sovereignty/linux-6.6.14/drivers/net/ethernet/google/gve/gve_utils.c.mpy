{
  "module_name": "gve_utils.c",
  "hash_id": "7ab1cab6ec300c2b920b018821a5bd05ddeb0eecefea52670275a546fc0170ed",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/google/gve/gve_utils.c",
  "human_readable_source": "\n \n\n#include \"gve.h\"\n#include \"gve_adminq.h\"\n#include \"gve_utils.h\"\n\nvoid gve_tx_remove_from_block(struct gve_priv *priv, int queue_idx)\n{\n\tstruct gve_notify_block *block =\n\t\t\t&priv->ntfy_blocks[gve_tx_idx_to_ntfy(priv, queue_idx)];\n\n\tblock->tx = NULL;\n}\n\nvoid gve_tx_add_to_block(struct gve_priv *priv, int queue_idx)\n{\n\tunsigned int active_cpus = min_t(int, priv->num_ntfy_blks / 2,\n\t\t\t\t\t num_online_cpus());\n\tint ntfy_idx = gve_tx_idx_to_ntfy(priv, queue_idx);\n\tstruct gve_notify_block *block = &priv->ntfy_blocks[ntfy_idx];\n\tstruct gve_tx_ring *tx = &priv->tx[queue_idx];\n\n\tblock->tx = tx;\n\ttx->ntfy_id = ntfy_idx;\n\tnetif_set_xps_queue(priv->dev, get_cpu_mask(ntfy_idx % active_cpus),\n\t\t\t    queue_idx);\n}\n\nvoid gve_rx_remove_from_block(struct gve_priv *priv, int queue_idx)\n{\n\tstruct gve_notify_block *block =\n\t\t\t&priv->ntfy_blocks[gve_rx_idx_to_ntfy(priv, queue_idx)];\n\n\tblock->rx = NULL;\n}\n\nvoid gve_rx_add_to_block(struct gve_priv *priv, int queue_idx)\n{\n\tu32 ntfy_idx = gve_rx_idx_to_ntfy(priv, queue_idx);\n\tstruct gve_notify_block *block = &priv->ntfy_blocks[ntfy_idx];\n\tstruct gve_rx_ring *rx = &priv->rx[queue_idx];\n\n\tblock->rx = rx;\n\trx->ntfy_id = ntfy_idx;\n}\n\nstruct sk_buff *gve_rx_copy(struct net_device *dev, struct napi_struct *napi,\n\t\t\t    struct gve_rx_slot_page_info *page_info, u16 len)\n{\n\tvoid *va = page_info->page_address + page_info->page_offset +\n\t\tpage_info->pad;\n\tstruct sk_buff *skb;\n\n\tskb = napi_alloc_skb(napi, len);\n\tif (unlikely(!skb))\n\t\treturn NULL;\n\n\t__skb_put(skb, len);\n\tskb_copy_to_linear_data_offset(skb, 0, va, len);\n\tskb->protocol = eth_type_trans(skb, dev);\n\n\treturn skb;\n}\n\nvoid gve_dec_pagecnt_bias(struct gve_rx_slot_page_info *page_info)\n{\n\tpage_info->pagecnt_bias--;\n\tif (page_info->pagecnt_bias == 0) {\n\t\tint pagecount = page_count(page_info->page);\n\n\t\t \n\t\tpage_info->pagecnt_bias = INT_MAX - pagecount;\n\n\t\t \n\t\tpage_ref_add(page_info->page, INT_MAX - pagecount);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}