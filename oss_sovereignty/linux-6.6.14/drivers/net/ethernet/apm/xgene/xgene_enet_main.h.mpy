{
  "module_name": "xgene_enet_main.h",
  "hash_id": "e56097ac044a33a4a50a5d1de3810c4729c92e84a61748ec5e703a03f64c65ed",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/apm/xgene/xgene_enet_main.h",
  "human_readable_source": " \n \n\n#ifndef __XGENE_ENET_MAIN_H__\n#define __XGENE_ENET_MAIN_H__\n\n#include <linux/acpi.h>\n#include <linux/clk.h>\n#include <linux/efi.h>\n#include <linux/irq.h>\n#include <linux/io.h>\n#include <linux/of_platform.h>\n#include <linux/of_net.h>\n#include <linux/of_mdio.h>\n#include <linux/mdio/mdio-xgene.h>\n#include <linux/module.h>\n#include <net/ip.h>\n#include <linux/prefetch.h>\n#include <linux/if_vlan.h>\n#include <linux/phy.h>\n#include \"xgene_enet_hw.h\"\n#include \"xgene_enet_cle.h\"\n#include \"xgene_enet_ring2.h\"\n\n#define ETHER_MIN_PACKET\t64\n#define ETHER_STD_PACKET\t1518\n#define XGENE_ENET_STD_MTU\t1536\n#define XGENE_ENET_MAX_MTU\t9600\n#define SKB_BUFFER_SIZE\t\t(XGENE_ENET_STD_MTU - NET_IP_ALIGN)\n\n#define BUFLEN_16K\t(16 * 1024)\n#define NUM_PKT_BUF\t1024\n#define NUM_BUFPOOL\t32\n#define NUM_NXTBUFPOOL\t8\n#define MAX_EXP_BUFFS\t256\n#define NUM_MSS_REG\t4\n#define XGENE_MIN_ENET_FRAME_SIZE\t60\n\n#define XGENE_MAX_ENET_IRQ\t16\n#define XGENE_NUM_RX_RING\t8\n#define XGENE_NUM_TX_RING\t8\n#define XGENE_NUM_TXC_RING\t8\n\n#define START_CPU_BUFNUM_0\t0\n#define START_ETH_BUFNUM_0\t2\n#define START_BP_BUFNUM_0\t0x22\n#define START_RING_NUM_0\t8\n#define START_CPU_BUFNUM_1\t12\n#define START_ETH_BUFNUM_1\t10\n#define START_BP_BUFNUM_1\t0x2A\n#define START_RING_NUM_1\t264\n\n#define XG_START_CPU_BUFNUM_1\t12\n#define XG_START_ETH_BUFNUM_1\t2\n#define XG_START_BP_BUFNUM_1\t0x22\n#define XG_START_RING_NUM_1\t264\n\n#define X2_START_CPU_BUFNUM_0\t0\n#define X2_START_ETH_BUFNUM_0\t0\n#define X2_START_BP_BUFNUM_0\t0x20\n#define X2_START_RING_NUM_0\t0\n#define X2_START_CPU_BUFNUM_1\t0xc\n#define X2_START_ETH_BUFNUM_1\t0\n#define X2_START_BP_BUFNUM_1\t0x20\n#define X2_START_RING_NUM_1\t256\n\n#define IRQ_ID_SIZE\t\t16\n\n#define PHY_POLL_LINK_ON\t(10 * HZ)\n#define PHY_POLL_LINK_OFF\t(PHY_POLL_LINK_ON / 5)\n\nenum xgene_enet_id {\n\tXGENE_ENET1 = 1,\n\tXGENE_ENET2\n};\n\nenum xgene_enet_buf_len {\n\tSIZE_2K = 2048,\n\tSIZE_4K = 4096,\n\tSIZE_16K = 16384\n};\n\n \nstruct xgene_enet_desc_ring {\n\tstruct net_device *ndev;\n\tu16 id;\n\tu16 num;\n\tu16 head;\n\tu16 tail;\n\tu16 exp_buf_tail;\n\tu16 slots;\n\tu16 irq;\n\tchar irq_name[IRQ_ID_SIZE];\n\tu32 size;\n\tu32 state[X2_NUM_RING_CONFIG];\n\tvoid __iomem *cmd_base;\n\tvoid __iomem *cmd;\n\tdma_addr_t dma;\n\tdma_addr_t irq_mbox_dma;\n\tvoid *irq_mbox_addr;\n\tu16 dst_ring_num;\n\tu16 nbufpool;\n\tint npagepool;\n\tu8 index;\n\tu32 flags;\n\tstruct sk_buff *(*rx_skb);\n\tstruct sk_buff *(*cp_skb);\n\tdma_addr_t *frag_dma_addr;\n\tstruct page *(*frag_page);\n\tenum xgene_enet_ring_cfgsize cfgsize;\n\tstruct xgene_enet_desc_ring *cp_ring;\n\tstruct xgene_enet_desc_ring *buf_pool;\n\tstruct xgene_enet_desc_ring *page_pool;\n\tstruct napi_struct napi;\n\tunion {\n\t\tvoid *desc_addr;\n\t\tstruct xgene_enet_raw_desc *raw_desc;\n\t\tstruct xgene_enet_raw_desc16 *raw_desc16;\n\t};\n\t__le64 *exp_bufs;\n\tu64 tx_packets;\n\tu64 tx_bytes;\n\tu64 tx_dropped;\n\tu64 tx_errors;\n\tu64 rx_packets;\n\tu64 rx_bytes;\n\tu64 rx_dropped;\n\tu64 rx_errors;\n\tu64 rx_length_errors;\n\tu64 rx_crc_errors;\n\tu64 rx_frame_errors;\n\tu64 rx_fifo_errors;\n};\n\nstruct xgene_mac_ops {\n\tvoid (*init)(struct xgene_enet_pdata *pdata);\n\tvoid (*reset)(struct xgene_enet_pdata *pdata);\n\tvoid (*tx_enable)(struct xgene_enet_pdata *pdata);\n\tvoid (*rx_enable)(struct xgene_enet_pdata *pdata);\n\tvoid (*tx_disable)(struct xgene_enet_pdata *pdata);\n\tvoid (*rx_disable)(struct xgene_enet_pdata *pdata);\n\tvoid (*get_drop_cnt)(struct xgene_enet_pdata *pdata, u32 *rx, u32 *tx);\n\tvoid (*set_speed)(struct xgene_enet_pdata *pdata);\n\tvoid (*set_mac_addr)(struct xgene_enet_pdata *pdata);\n\tvoid (*set_framesize)(struct xgene_enet_pdata *pdata, int framesize);\n\tvoid (*set_mss)(struct xgene_enet_pdata *pdata, u16 mss, u8 index);\n\tvoid (*link_state)(struct work_struct *work);\n\tvoid (*enable_tx_pause)(struct xgene_enet_pdata *pdata, bool enable);\n\tvoid (*flowctl_rx)(struct xgene_enet_pdata *pdata, bool enable);\n\tvoid (*flowctl_tx)(struct xgene_enet_pdata *pdata, bool enable);\n};\n\nstruct xgene_port_ops {\n\tint (*reset)(struct xgene_enet_pdata *pdata);\n\tvoid (*clear)(struct xgene_enet_pdata *pdata,\n\t\t      struct xgene_enet_desc_ring *ring);\n\tvoid (*cle_bypass)(struct xgene_enet_pdata *pdata,\n\t\t\t   u32 dst_ring_num, u16 bufpool_id, u16 nxtbufpool_id);\n\tvoid (*shutdown)(struct xgene_enet_pdata *pdata);\n};\n\nstruct xgene_ring_ops {\n\tu8 num_ring_config;\n\tu8 num_ring_id_shift;\n\tstruct xgene_enet_desc_ring * (*setup)(struct xgene_enet_desc_ring *);\n\tvoid (*clear)(struct xgene_enet_desc_ring *);\n\tvoid (*wr_cmd)(struct xgene_enet_desc_ring *, int);\n\tu32 (*len)(struct xgene_enet_desc_ring *);\n\tvoid (*coalesce)(struct xgene_enet_desc_ring *);\n};\n\nstruct xgene_cle_ops {\n\tint (*cle_init)(struct xgene_enet_pdata *pdata);\n};\n\n \nstruct xgene_enet_pdata {\n\tstruct net_device *ndev;\n\tstruct mii_bus *mdio_bus;\n\tint phy_speed;\n\tstruct clk *clk;\n\tstruct platform_device *pdev;\n\tenum xgene_enet_id enet_id;\n\tstruct xgene_enet_desc_ring *tx_ring[XGENE_NUM_TX_RING];\n\tstruct xgene_enet_desc_ring *rx_ring[XGENE_NUM_RX_RING];\n\tu16 tx_level[XGENE_NUM_TX_RING];\n\tu16 txc_level[XGENE_NUM_TX_RING];\n\tchar *dev_name;\n\tu32 rx_buff_cnt;\n\tu32 tx_qcnt_hi;\n\tu32 irqs[XGENE_MAX_ENET_IRQ];\n\tu8 rxq_cnt;\n\tu8 txq_cnt;\n\tu8 cq_cnt;\n\tvoid __iomem *eth_csr_addr;\n\tvoid __iomem *eth_ring_if_addr;\n\tvoid __iomem *eth_diag_csr_addr;\n\tvoid __iomem *mcx_mac_addr;\n\tvoid __iomem *mcx_mac_csr_addr;\n\tvoid __iomem *mcx_stats_addr;\n\tvoid __iomem *base_addr;\n\tvoid __iomem *pcs_addr;\n\tvoid __iomem *ring_csr_addr;\n\tvoid __iomem *ring_cmd_addr;\n\tint phy_mode;\n\tenum xgene_enet_rm rm;\n\tstruct xgene_enet_cle cle;\n\tu64 *extd_stats;\n\tu64 false_rflr;\n\tu64 vlan_rjbr;\n\tspinlock_t stats_lock;  \n\tconst struct xgene_mac_ops *mac_ops;\n\tspinlock_t mac_lock;  \n\tconst struct xgene_port_ops *port_ops;\n\tstruct xgene_ring_ops *ring_ops;\n\tconst struct xgene_cle_ops *cle_ops;\n\tstruct delayed_work link_work;\n\tu32 port_id;\n\tu8 cpu_bufnum;\n\tu8 eth_bufnum;\n\tu8 bp_bufnum;\n\tu16 ring_num;\n\tu32 mss[NUM_MSS_REG];\n\tu32 mss_refcnt[NUM_MSS_REG];\n\tspinlock_t mss_lock;   \n\tu8 tx_delay;\n\tu8 rx_delay;\n\tbool mdio_driver;\n\tstruct gpio_desc *sfp_rdy;\n\tbool sfp_gpio_en;\n\tu32 pause_autoneg;\n\tbool tx_pause;\n\tbool rx_pause;\n};\n\nstruct xgene_indirect_ctl {\n\tvoid __iomem *addr;\n\tvoid __iomem *ctl;\n\tvoid __iomem *cmd;\n\tvoid __iomem *cmd_done;\n};\n\nstatic inline struct device *ndev_to_dev(struct net_device *ndev)\n{\n\treturn ndev->dev.parent;\n}\n\nstatic inline u16 xgene_enet_dst_ring_num(struct xgene_enet_desc_ring *ring)\n{\n\tstruct xgene_enet_pdata *pdata = netdev_priv(ring->ndev);\n\n\treturn ((u16)pdata->rm << 10) | ring->num;\n}\n\nvoid xgene_enet_set_ethtool_ops(struct net_device *netdev);\nint xgene_extd_stats_init(struct xgene_enet_pdata *pdata);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}