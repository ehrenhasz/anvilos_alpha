{
  "module_name": "mac.c",
  "hash_id": "609509475775e5da42f1f38f00ed8361890de4e3daf6a699099a43180efb07d5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/apm/xgene-v2/mac.c",
  "human_readable_source": "\n \n\n#include \"main.h\"\n\nvoid xge_mac_reset(struct xge_pdata *pdata)\n{\n\txge_wr_csr(pdata, MAC_CONFIG_1, SOFT_RESET);\n\txge_wr_csr(pdata, MAC_CONFIG_1, 0);\n}\n\nvoid xge_mac_set_speed(struct xge_pdata *pdata)\n{\n\tu32 icm0, icm2, ecm0, mc2;\n\tu32 intf_ctrl, rgmii;\n\n\ticm0 = xge_rd_csr(pdata, ICM_CONFIG0_REG_0);\n\ticm2 = xge_rd_csr(pdata, ICM_CONFIG2_REG_0);\n\tecm0 = xge_rd_csr(pdata, ECM_CONFIG0_REG_0);\n\trgmii = xge_rd_csr(pdata, RGMII_REG_0);\n\tmc2 = xge_rd_csr(pdata, MAC_CONFIG_2);\n\tintf_ctrl = xge_rd_csr(pdata, INTERFACE_CONTROL);\n\ticm2 |= CFG_WAITASYNCRD_EN;\n\n\tswitch (pdata->phy_speed) {\n\tcase SPEED_10:\n\t\tSET_REG_BITS(&mc2, INTF_MODE, 1);\n\t\tSET_REG_BITS(&intf_ctrl, HD_MODE, 0);\n\t\tSET_REG_BITS(&icm0, CFG_MACMODE, 0);\n\t\tSET_REG_BITS(&icm2, CFG_WAITASYNCRD, 500);\n\t\tSET_REG_BIT(&rgmii, CFG_SPEED_125, 0);\n\t\tbreak;\n\tcase SPEED_100:\n\t\tSET_REG_BITS(&mc2, INTF_MODE, 1);\n\t\tSET_REG_BITS(&intf_ctrl, HD_MODE, 1);\n\t\tSET_REG_BITS(&icm0, CFG_MACMODE, 1);\n\t\tSET_REG_BITS(&icm2, CFG_WAITASYNCRD, 80);\n\t\tSET_REG_BIT(&rgmii, CFG_SPEED_125, 0);\n\t\tbreak;\n\tdefault:\n\t\tSET_REG_BITS(&mc2, INTF_MODE, 2);\n\t\tSET_REG_BITS(&intf_ctrl, HD_MODE, 2);\n\t\tSET_REG_BITS(&icm0, CFG_MACMODE, 2);\n\t\tSET_REG_BITS(&icm2, CFG_WAITASYNCRD, 16);\n\t\tSET_REG_BIT(&rgmii, CFG_SPEED_125, 1);\n\t\tbreak;\n\t}\n\n\tmc2 |= FULL_DUPLEX | CRC_EN | PAD_CRC;\n\tSET_REG_BITS(&ecm0, CFG_WFIFOFULLTHR, 0x32);\n\n\txge_wr_csr(pdata, MAC_CONFIG_2, mc2);\n\txge_wr_csr(pdata, INTERFACE_CONTROL, intf_ctrl);\n\txge_wr_csr(pdata, RGMII_REG_0, rgmii);\n\txge_wr_csr(pdata, ICM_CONFIG0_REG_0, icm0);\n\txge_wr_csr(pdata, ICM_CONFIG2_REG_0, icm2);\n\txge_wr_csr(pdata, ECM_CONFIG0_REG_0, ecm0);\n}\n\nvoid xge_mac_set_station_addr(struct xge_pdata *pdata)\n{\n\tconst u8 *dev_addr = pdata->ndev->dev_addr;\n\tu32 addr0, addr1;\n\n\taddr0 = (dev_addr[3] << 24) | (dev_addr[2] << 16) |\n\t\t(dev_addr[1] << 8) | dev_addr[0];\n\taddr1 = (dev_addr[5] << 24) | (dev_addr[4] << 16);\n\n\txge_wr_csr(pdata, STATION_ADDR0, addr0);\n\txge_wr_csr(pdata, STATION_ADDR1, addr1);\n}\n\nvoid xge_mac_init(struct xge_pdata *pdata)\n{\n\txge_mac_reset(pdata);\n\txge_mac_set_speed(pdata);\n\txge_mac_set_station_addr(pdata);\n}\n\nvoid xge_mac_enable(struct xge_pdata *pdata)\n{\n\tu32 data;\n\n\tdata = xge_rd_csr(pdata, MAC_CONFIG_1);\n\tdata |= TX_EN | RX_EN;\n\txge_wr_csr(pdata, MAC_CONFIG_1, data);\n\n\tdata = xge_rd_csr(pdata, MAC_CONFIG_1);\n}\n\nvoid xge_mac_disable(struct xge_pdata *pdata)\n{\n\tu32 data;\n\n\tdata = xge_rd_csr(pdata, MAC_CONFIG_1);\n\tdata &= ~(TX_EN | RX_EN);\n\txge_wr_csr(pdata, MAC_CONFIG_1, data);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}