{
  "module_name": "ethtool.c",
  "hash_id": "479c750a347d292479d962b6fa4b30eefffc29b6c57f03a6c3423f7767c71efe",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/apm/xgene-v2/ethtool.c",
  "human_readable_source": "\n \n\n#include \"main.h\"\n\n#define XGE_STAT(m)\t\t{ #m, offsetof(struct xge_pdata, stats.m) }\n#define XGE_EXTD_STAT(m, n)\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t#m,\t\t\t\t\t\t\\\n\t\tn,\t\t\t\t\t\t\\\n\t\t0\t\t\t\t\t\t\\\n\t}\n\nstatic const struct xge_gstrings_stats gstrings_stats[] = {\n\tXGE_STAT(rx_packets),\n\tXGE_STAT(tx_packets),\n\tXGE_STAT(rx_bytes),\n\tXGE_STAT(tx_bytes),\n\tXGE_STAT(rx_errors)\n};\n\nstatic struct xge_gstrings_extd_stats gstrings_extd_stats[] = {\n\tXGE_EXTD_STAT(tx_rx_64b_frame_cntr, TR64),\n\tXGE_EXTD_STAT(tx_rx_127b_frame_cntr, TR127),\n\tXGE_EXTD_STAT(tx_rx_255b_frame_cntr, TR255),\n\tXGE_EXTD_STAT(tx_rx_511b_frame_cntr, TR511),\n\tXGE_EXTD_STAT(tx_rx_1023b_frame_cntr, TR1K),\n\tXGE_EXTD_STAT(tx_rx_1518b_frame_cntr, TRMAX),\n\tXGE_EXTD_STAT(tx_rx_1522b_frame_cntr, TRMGV),\n\tXGE_EXTD_STAT(rx_fcs_error_cntr, RFCS),\n\tXGE_EXTD_STAT(rx_multicast_pkt_cntr, RMCA),\n\tXGE_EXTD_STAT(rx_broadcast_pkt_cntr, RBCA),\n\tXGE_EXTD_STAT(rx_ctrl_frame_pkt_cntr, RXCF),\n\tXGE_EXTD_STAT(rx_pause_frame_pkt_cntr, RXPF),\n\tXGE_EXTD_STAT(rx_unk_opcode_cntr, RXUO),\n\tXGE_EXTD_STAT(rx_align_err_cntr, RALN),\n\tXGE_EXTD_STAT(rx_frame_len_err_cntr, RFLR),\n\tXGE_EXTD_STAT(rx_code_err_cntr, RCDE),\n\tXGE_EXTD_STAT(rx_carrier_sense_err_cntr, RCSE),\n\tXGE_EXTD_STAT(rx_undersize_pkt_cntr, RUND),\n\tXGE_EXTD_STAT(rx_oversize_pkt_cntr, ROVR),\n\tXGE_EXTD_STAT(rx_fragments_cntr, RFRG),\n\tXGE_EXTD_STAT(rx_jabber_cntr, RJBR),\n\tXGE_EXTD_STAT(rx_dropped_pkt_cntr, RDRP),\n\tXGE_EXTD_STAT(tx_multicast_pkt_cntr, TMCA),\n\tXGE_EXTD_STAT(tx_broadcast_pkt_cntr, TBCA),\n\tXGE_EXTD_STAT(tx_pause_ctrl_frame_cntr, TXPF),\n\tXGE_EXTD_STAT(tx_defer_pkt_cntr, TDFR),\n\tXGE_EXTD_STAT(tx_excv_defer_pkt_cntr, TEDF),\n\tXGE_EXTD_STAT(tx_single_col_pkt_cntr, TSCL),\n\tXGE_EXTD_STAT(tx_multi_col_pkt_cntr, TMCL),\n\tXGE_EXTD_STAT(tx_late_col_pkt_cntr, TLCL),\n\tXGE_EXTD_STAT(tx_excv_col_pkt_cntr, TXCL),\n\tXGE_EXTD_STAT(tx_total_col_cntr, TNCL),\n\tXGE_EXTD_STAT(tx_pause_frames_hnrd_cntr, TPFH),\n\tXGE_EXTD_STAT(tx_drop_frame_cntr, TDRP),\n\tXGE_EXTD_STAT(tx_jabber_frame_cntr, TJBR),\n\tXGE_EXTD_STAT(tx_fcs_error_cntr, TFCS),\n\tXGE_EXTD_STAT(tx_ctrl_frame_cntr, TXCF),\n\tXGE_EXTD_STAT(tx_oversize_frame_cntr, TOVR),\n\tXGE_EXTD_STAT(tx_undersize_frame_cntr, TUND),\n\tXGE_EXTD_STAT(tx_fragments_cntr, TFRG)\n};\n\n#define XGE_STATS_LEN\t\tARRAY_SIZE(gstrings_stats)\n#define XGE_EXTD_STATS_LEN\tARRAY_SIZE(gstrings_extd_stats)\n\nstatic void xge_mac_get_extd_stats(struct xge_pdata *pdata)\n{\n\tu32 data;\n\tint i;\n\n\tfor (i = 0; i < XGE_EXTD_STATS_LEN; i++) {\n\t\tdata = xge_rd_csr(pdata, gstrings_extd_stats[i].addr);\n\t\tgstrings_extd_stats[i].value += data;\n\t}\n}\n\nstatic void xge_get_drvinfo(struct net_device *ndev,\n\t\t\t    struct ethtool_drvinfo *info)\n{\n\tstruct xge_pdata *pdata = netdev_priv(ndev);\n\tstruct platform_device *pdev = pdata->pdev;\n\n\tstrcpy(info->driver, \"xgene-enet-v2\");\n\tsprintf(info->bus_info, \"%s\", pdev->name);\n}\n\nstatic void xge_get_strings(struct net_device *ndev, u32 stringset, u8 *data)\n{\n\tu8 *p = data;\n\tint i;\n\n\tif (stringset != ETH_SS_STATS)\n\t\treturn;\n\n\tfor (i = 0; i < XGE_STATS_LEN; i++) {\n\t\tmemcpy(p, gstrings_stats[i].name, ETH_GSTRING_LEN);\n\t\tp += ETH_GSTRING_LEN;\n\t}\n\n\tfor (i = 0; i < XGE_EXTD_STATS_LEN; i++) {\n\t\tmemcpy(p, gstrings_extd_stats[i].name, ETH_GSTRING_LEN);\n\t\tp += ETH_GSTRING_LEN;\n\t}\n}\n\nstatic int xge_get_sset_count(struct net_device *ndev, int sset)\n{\n\tif (sset != ETH_SS_STATS)\n\t\treturn -EINVAL;\n\n\treturn XGE_STATS_LEN + XGE_EXTD_STATS_LEN;\n}\n\nstatic void xge_get_ethtool_stats(struct net_device *ndev,\n\t\t\t\t  struct ethtool_stats *dummy,\n\t\t\t\t  u64 *data)\n{\n\tvoid *pdata = netdev_priv(ndev);\n\tint i;\n\n\tfor (i = 0; i < XGE_STATS_LEN; i++)\n\t\t*data++ = *(u64 *)(pdata + gstrings_stats[i].offset);\n\n\txge_mac_get_extd_stats(pdata);\n\n\tfor (i = 0; i < XGE_EXTD_STATS_LEN; i++)\n\t\t*data++ = gstrings_extd_stats[i].value;\n}\n\nstatic int xge_get_link_ksettings(struct net_device *ndev,\n\t\t\t\t  struct ethtool_link_ksettings *cmd)\n{\n\tstruct phy_device *phydev = ndev->phydev;\n\n\tif (!phydev)\n\t\treturn -ENODEV;\n\n\tphy_ethtool_ksettings_get(phydev, cmd);\n\n\treturn 0;\n}\n\nstatic int xge_set_link_ksettings(struct net_device *ndev,\n\t\t\t\t  const struct ethtool_link_ksettings *cmd)\n{\n\tstruct phy_device *phydev = ndev->phydev;\n\n\tif (!phydev)\n\t\treturn -ENODEV;\n\n\treturn phy_ethtool_ksettings_set(phydev, cmd);\n}\n\nstatic const struct ethtool_ops xge_ethtool_ops = {\n\t.get_drvinfo = xge_get_drvinfo,\n\t.get_link = ethtool_op_get_link,\n\t.get_strings = xge_get_strings,\n\t.get_sset_count = xge_get_sset_count,\n\t.get_ethtool_stats = xge_get_ethtool_stats,\n\t.get_link_ksettings = xge_get_link_ksettings,\n\t.set_link_ksettings = xge_set_link_ksettings,\n};\n\nvoid xge_set_ethtool_ops(struct net_device *ndev)\n{\n\tndev->ethtool_ops = &xge_ethtool_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}