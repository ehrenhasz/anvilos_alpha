{
  "module_name": "pasemi_mac_ethtool.c",
  "hash_id": "6df0d878597f114d72d9467cbbff4a0cf94e22d09169e0f94a83e411e3807a7f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/pasemi/pasemi_mac_ethtool.c",
  "human_readable_source": "\n \n\n\n#include <linux/netdevice.h>\n#include <linux/ethtool.h>\n#include <linux/pci.h>\n\n#include <asm/pasemi_dma.h>\n#include \"pasemi_mac.h\"\n\nstatic struct {\n\tconst char str[ETH_GSTRING_LEN];\n} ethtool_stats_keys[] = {\n\t{ \"rx-drops\" },\n\t{ \"rx-bytes\" },\n\t{ \"rx-packets\" },\n\t{ \"rx-broadcast-packets\" },\n\t{ \"rx-multicast-packets\" },\n\t{ \"rx-crc-errors\" },\n\t{ \"rx-undersize-errors\" },\n\t{ \"rx-oversize-errors\" },\n\t{ \"rx-short-fragment-errors\" },\n\t{ \"rx-jabber-errors\" },\n\t{ \"rx-64-byte-packets\" },\n\t{ \"rx-65-127-byte-packets\" },\n\t{ \"rx-128-255-byte-packets\" },\n\t{ \"rx-256-511-byte-packets\" },\n\t{ \"rx-512-1023-byte-packets\" },\n\t{ \"rx-1024-1518-byte-packets\" },\n\t{ \"rx-pause-frames\" },\n\t{ \"tx-bytes\" },\n\t{ \"tx-packets\" },\n\t{ \"tx-broadcast-packets\" },\n\t{ \"tx-multicast-packets\" },\n\t{ \"tx-collisions\" },\n\t{ \"tx-late-collisions\" },\n\t{ \"tx-excessive-collisions\" },\n\t{ \"tx-crc-errors\" },\n\t{ \"tx-undersize-errors\" },\n\t{ \"tx-oversize-errors\" },\n\t{ \"tx-64-byte-packets\" },\n\t{ \"tx-65-127-byte-packets\" },\n\t{ \"tx-128-255-byte-packets\" },\n\t{ \"tx-256-511-byte-packets\" },\n\t{ \"tx-512-1023-byte-packets\" },\n\t{ \"tx-1024-1518-byte-packets\" },\n};\n\nstatic u32\npasemi_mac_ethtool_get_msglevel(struct net_device *netdev)\n{\n\tstruct pasemi_mac *mac = netdev_priv(netdev);\n\treturn mac->msg_enable;\n}\n\nstatic void\npasemi_mac_ethtool_set_msglevel(struct net_device *netdev,\n\t\t\t\tu32 level)\n{\n\tstruct pasemi_mac *mac = netdev_priv(netdev);\n\tmac->msg_enable = level;\n}\n\n\nstatic void\npasemi_mac_ethtool_get_ringparam(struct net_device *netdev,\n\t\t\t\t struct ethtool_ringparam *ering,\n\t\t\t\t struct kernel_ethtool_ringparam *kernel_ering,\n\t\t\t\t struct netlink_ext_ack *extack)\n{\n\tstruct pasemi_mac *mac = netdev_priv(netdev);\n\n\tering->tx_max_pending = TX_RING_SIZE/2;\n\tering->tx_pending = RING_USED(mac->tx)/2;\n\tering->rx_max_pending = RX_RING_SIZE/4;\n\tering->rx_pending = RING_USED(mac->rx)/4;\n}\n\nstatic int pasemi_mac_get_sset_count(struct net_device *netdev, int sset)\n{\n\tswitch (sset) {\n\tcase ETH_SS_STATS:\n\t\treturn ARRAY_SIZE(ethtool_stats_keys);\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n\nstatic void pasemi_mac_get_ethtool_stats(struct net_device *netdev,\n\t\tstruct ethtool_stats *stats, u64 *data)\n{\n\tstruct pasemi_mac *mac = netdev_priv(netdev);\n\tint i;\n\n\tdata[0] = pasemi_read_dma_reg(PAS_DMA_RXINT_RCMDSTA(mac->dma_if))\n\t\t\t>> PAS_DMA_RXINT_RCMDSTA_DROPS_S;\n\tfor (i = 0; i < 32; i++)\n\t\tdata[1+i] = pasemi_read_mac_reg(mac->dma_if, PAS_MAC_RMON(i));\n}\n\nstatic void pasemi_mac_get_strings(struct net_device *netdev, u32 stringset,\n\t\t\t\t   u8 *data)\n{\n\tmemcpy(data, ethtool_stats_keys, sizeof(ethtool_stats_keys));\n}\n\nconst struct ethtool_ops pasemi_mac_ethtool_ops = {\n\t.get_msglevel\t\t= pasemi_mac_ethtool_get_msglevel,\n\t.set_msglevel\t\t= pasemi_mac_ethtool_set_msglevel,\n\t.get_link\t\t= ethtool_op_get_link,\n\t.get_ringparam          = pasemi_mac_ethtool_get_ringparam,\n\t.get_strings\t\t= pasemi_mac_get_strings,\n\t.get_sset_count\t\t= pasemi_mac_get_sset_count,\n\t.get_ethtool_stats\t= pasemi_mac_get_ethtool_stats,\n\t.get_link_ksettings\t= phy_ethtool_get_link_ksettings,\n\t.set_link_ksettings\t= phy_ethtool_set_link_ksettings,\n};\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}