{
  "module_name": "ef100_sriov.c",
  "hash_id": "22ba7f277167d121310cc961a27fd9441b83019b4daed47c74f8344678762ea0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/sfc/ef100_sriov.c",
  "human_readable_source": "\n \n\n#include \"ef100_sriov.h\"\n#include \"ef100_nic.h\"\n#include \"ef100_rep.h\"\n\nstatic int efx_ef100_pci_sriov_enable(struct efx_nic *efx, int num_vfs)\n{\n\tstruct ef100_nic_data *nic_data = efx->nic_data;\n\tstruct pci_dev *dev = efx->pci_dev;\n\tstruct efx_rep *efv, *next;\n\tint rc, i;\n\n\tefx->vf_count = num_vfs;\n\trc = pci_enable_sriov(dev, num_vfs);\n\tif (rc)\n\t\tgoto fail1;\n\n\tif (!nic_data->grp_mae)\n\t\treturn 0;\n\n\tfor (i = 0; i < num_vfs; i++) {\n\t\trc = efx_ef100_vfrep_create(efx, i);\n\t\tif (rc)\n\t\t\tgoto fail2;\n\t}\n\treturn 0;\n\nfail2:\n\tlist_for_each_entry_safe(efv, next, &efx->vf_reps, list)\n\t\tefx_ef100_vfrep_destroy(efx, efv);\n\tpci_disable_sriov(dev);\nfail1:\n\tnetif_err(efx, probe, efx->net_dev, \"Failed to enable SRIOV VFs\\n\");\n\tefx->vf_count = 0;\n\treturn rc;\n}\n\nint efx_ef100_pci_sriov_disable(struct efx_nic *efx, bool force)\n{\n\tstruct pci_dev *dev = efx->pci_dev;\n\tunsigned int vfs_assigned;\n\n\tvfs_assigned = pci_vfs_assigned(dev);\n\tif (vfs_assigned && !force) {\n\t\tnetif_info(efx, drv, efx->net_dev, \"VFs are assigned to guests; \"\n\t\t\t   \"please detach them before disabling SR-IOV\\n\");\n\t\treturn -EBUSY;\n\t}\n\n\tefx_ef100_fini_vfreps(efx);\n\tif (!vfs_assigned)\n\t\tpci_disable_sriov(dev);\n\treturn 0;\n}\n\nint efx_ef100_sriov_configure(struct efx_nic *efx, int num_vfs)\n{\n\tif (num_vfs == 0)\n\t\treturn efx_ef100_pci_sriov_disable(efx, false);\n\telse\n\t\treturn efx_ef100_pci_sriov_enable(efx, num_vfs);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}