{
  "module_name": "mcdi_port.c",
  "hash_id": "7a0f13c47d7eb9c428b6c462add2b59b5cf5d310a85c68262c852f68a4e74960",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/sfc/siena/mcdi_port.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/slab.h>\n#include \"efx.h\"\n#include \"mcdi_port.h\"\n#include \"mcdi.h\"\n#include \"mcdi_pcol.h\"\n#include \"nic.h\"\n#include \"selftest.h\"\n#include \"mcdi_port_common.h\"\n\nstatic int efx_mcdi_mdio_read(struct net_device *net_dev,\n\t\t\t      int prtad, int devad, u16 addr)\n{\n\tstruct efx_nic *efx = netdev_priv(net_dev);\n\tMCDI_DECLARE_BUF(inbuf, MC_CMD_MDIO_READ_IN_LEN);\n\tMCDI_DECLARE_BUF(outbuf, MC_CMD_MDIO_READ_OUT_LEN);\n\tsize_t outlen;\n\tint rc;\n\n\tMCDI_SET_DWORD(inbuf, MDIO_READ_IN_BUS, efx->mdio_bus);\n\tMCDI_SET_DWORD(inbuf, MDIO_READ_IN_PRTAD, prtad);\n\tMCDI_SET_DWORD(inbuf, MDIO_READ_IN_DEVAD, devad);\n\tMCDI_SET_DWORD(inbuf, MDIO_READ_IN_ADDR, addr);\n\n\trc = efx_siena_mcdi_rpc(efx, MC_CMD_MDIO_READ, inbuf, sizeof(inbuf),\n\t\t\t\toutbuf, sizeof(outbuf), &outlen);\n\tif (rc)\n\t\treturn rc;\n\n\tif (MCDI_DWORD(outbuf, MDIO_READ_OUT_STATUS) !=\n\t    MC_CMD_MDIO_STATUS_GOOD)\n\t\treturn -EIO;\n\n\treturn (u16)MCDI_DWORD(outbuf, MDIO_READ_OUT_VALUE);\n}\n\nstatic int efx_mcdi_mdio_write(struct net_device *net_dev,\n\t\t\t       int prtad, int devad, u16 addr, u16 value)\n{\n\tstruct efx_nic *efx = netdev_priv(net_dev);\n\tMCDI_DECLARE_BUF(inbuf, MC_CMD_MDIO_WRITE_IN_LEN);\n\tMCDI_DECLARE_BUF(outbuf, MC_CMD_MDIO_WRITE_OUT_LEN);\n\tsize_t outlen;\n\tint rc;\n\n\tMCDI_SET_DWORD(inbuf, MDIO_WRITE_IN_BUS, efx->mdio_bus);\n\tMCDI_SET_DWORD(inbuf, MDIO_WRITE_IN_PRTAD, prtad);\n\tMCDI_SET_DWORD(inbuf, MDIO_WRITE_IN_DEVAD, devad);\n\tMCDI_SET_DWORD(inbuf, MDIO_WRITE_IN_ADDR, addr);\n\tMCDI_SET_DWORD(inbuf, MDIO_WRITE_IN_VALUE, value);\n\n\trc = efx_siena_mcdi_rpc(efx, MC_CMD_MDIO_WRITE, inbuf, sizeof(inbuf),\n\t\t\t\toutbuf, sizeof(outbuf), &outlen);\n\tif (rc)\n\t\treturn rc;\n\n\tif (MCDI_DWORD(outbuf, MDIO_WRITE_OUT_STATUS) !=\n\t    MC_CMD_MDIO_STATUS_GOOD)\n\t\treturn -EIO;\n\n\treturn 0;\n}\n\nbool efx_siena_mcdi_mac_check_fault(struct efx_nic *efx)\n{\n\tMCDI_DECLARE_BUF(outbuf, MC_CMD_GET_LINK_OUT_LEN);\n\tsize_t outlength;\n\tint rc;\n\n\tBUILD_BUG_ON(MC_CMD_GET_LINK_IN_LEN != 0);\n\n\trc = efx_siena_mcdi_rpc(efx, MC_CMD_GET_LINK, NULL, 0,\n\t\t\t\toutbuf, sizeof(outbuf), &outlength);\n\tif (rc)\n\t\treturn true;\n\n\treturn MCDI_DWORD(outbuf, GET_LINK_OUT_MAC_FAULT) != 0;\n}\n\nint efx_siena_mcdi_port_probe(struct efx_nic *efx)\n{\n\tint rc;\n\n\t \n\tefx->mdio.mode_support = MDIO_SUPPORTS_C45 | MDIO_EMULATE_C22;\n\tefx->mdio.mdio_read = efx_mcdi_mdio_read;\n\tefx->mdio.mdio_write = efx_mcdi_mdio_write;\n\n\t \n\trc = efx_siena_mcdi_phy_probe(efx);\n\tif (rc != 0)\n\t\treturn rc;\n\n\treturn efx_siena_mcdi_mac_init_stats(efx);\n}\n\nvoid efx_siena_mcdi_port_remove(struct efx_nic *efx)\n{\n\tefx_siena_mcdi_phy_remove(efx);\n\tefx_siena_mcdi_mac_fini_stats(efx);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}