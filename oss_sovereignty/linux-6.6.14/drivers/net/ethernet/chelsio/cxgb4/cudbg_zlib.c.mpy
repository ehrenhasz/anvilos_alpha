{
  "module_name": "cudbg_zlib.c",
  "hash_id": "a559404f29de7caf8826b9bc82893cd37c145738652c425aa759b33acbc546ea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/chelsio/cxgb4/cudbg_zlib.c",
  "human_readable_source": "\n \n\n#include <linux/zlib.h>\n\n#include \"cxgb4.h\"\n#include \"cudbg_if.h\"\n#include \"cudbg_lib_common.h\"\n#include \"cudbg_zlib.h\"\n\nstatic int cudbg_get_compress_hdr(struct cudbg_buffer *pdbg_buff,\n\t\t\t\t  struct cudbg_buffer *pin_buff)\n{\n\tif (pdbg_buff->offset + sizeof(struct cudbg_compress_hdr) >\n\t    pdbg_buff->size)\n\t\treturn CUDBG_STATUS_NO_MEM;\n\n\tpin_buff->data = (char *)pdbg_buff->data + pdbg_buff->offset;\n\tpin_buff->offset = 0;\n\tpin_buff->size = sizeof(struct cudbg_compress_hdr);\n\tpdbg_buff->offset += sizeof(struct cudbg_compress_hdr);\n\treturn 0;\n}\n\nint cudbg_compress_buff(struct cudbg_init *pdbg_init,\n\t\t\tstruct cudbg_buffer *pin_buff,\n\t\t\tstruct cudbg_buffer *pout_buff)\n{\n\tstruct cudbg_buffer temp_buff = { 0 };\n\tstruct z_stream_s compress_stream;\n\tstruct cudbg_compress_hdr *c_hdr;\n\tint rc;\n\n\t \n\trc = cudbg_get_compress_hdr(pout_buff, &temp_buff);\n\tif (rc)\n\t\treturn rc;\n\n\tc_hdr = (struct cudbg_compress_hdr *)temp_buff.data;\n\tc_hdr->compress_id = CUDBG_ZLIB_COMPRESS_ID;\n\n\tmemset(&compress_stream, 0, sizeof(struct z_stream_s));\n\tcompress_stream.workspace = pdbg_init->workspace;\n\trc = zlib_deflateInit2(&compress_stream, Z_DEFAULT_COMPRESSION,\n\t\t\t       Z_DEFLATED, CUDBG_ZLIB_WIN_BITS,\n\t\t\t       CUDBG_ZLIB_MEM_LVL, Z_DEFAULT_STRATEGY);\n\tif (rc != Z_OK)\n\t\treturn CUDBG_SYSTEM_ERROR;\n\n\tcompress_stream.next_in = pin_buff->data;\n\tcompress_stream.avail_in = pin_buff->size;\n\tcompress_stream.next_out = pout_buff->data + pout_buff->offset;\n\tcompress_stream.avail_out = pout_buff->size - pout_buff->offset;\n\n\trc = zlib_deflate(&compress_stream, Z_FINISH);\n\tif (rc != Z_STREAM_END)\n\t\treturn CUDBG_SYSTEM_ERROR;\n\n\trc = zlib_deflateEnd(&compress_stream);\n\tif (rc != Z_OK)\n\t\treturn CUDBG_SYSTEM_ERROR;\n\n\tc_hdr->compress_size = compress_stream.total_out;\n\tc_hdr->decompress_size = pin_buff->size;\n\tpout_buff->offset += compress_stream.total_out;\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}