{
  "module_name": "cxgb4_fcoe.c",
  "hash_id": "bc1df17c4b47688492609056fbd27e017a9145616b053b5e4afc7bfe56cd0a6e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/chelsio/cxgb4/cxgb4_fcoe.c",
  "human_readable_source": " \n\n#ifdef CONFIG_CHELSIO_T4_FCOE\n\n#include <scsi/fc/fc_fs.h>\n#include <scsi/libfcoe.h>\n#include \"cxgb4.h\"\n\nbool cxgb_fcoe_sof_eof_supported(struct adapter *adap, struct sk_buff *skb)\n{\n\tstruct fcoe_hdr *fcoeh = (struct fcoe_hdr *)skb_network_header(skb);\n\tu8 sof = fcoeh->fcoe_sof;\n\tu8 eof = 0;\n\n\tif ((sof != FC_SOF_I3) && (sof != FC_SOF_N3)) {\n\t\tdev_err(adap->pdev_dev, \"Unsupported SOF 0x%x\\n\", sof);\n\t\treturn false;\n\t}\n\n\tskb_copy_bits(skb, skb->len - 4, &eof, 1);\n\n\tif ((eof != FC_EOF_N) && (eof != FC_EOF_T)) {\n\t\tdev_err(adap->pdev_dev, \"Unsupported EOF 0x%x\\n\", eof);\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n \nint cxgb_fcoe_enable(struct net_device *netdev)\n{\n\tstruct port_info *pi = netdev_priv(netdev);\n\tstruct adapter *adap = pi->adapter;\n\tstruct cxgb_fcoe *fcoe = &pi->fcoe;\n\n\tif (is_t4(adap->params.chip))\n\t\treturn -EINVAL;\n\n\tif (!(adap->flags & CXGB4_FULL_INIT_DONE))\n\t\treturn -EINVAL;\n\n\tdev_info(adap->pdev_dev, \"Enabling FCoE offload features\\n\");\n\n\tnetdev->features |= NETIF_F_FCOE_CRC;\n\tnetdev->vlan_features |= NETIF_F_FCOE_CRC;\n\tnetdev->features |= NETIF_F_FCOE_MTU;\n\tnetdev->vlan_features |= NETIF_F_FCOE_MTU;\n\n\tnetdev_features_change(netdev);\n\n\tfcoe->flags |= CXGB_FCOE_ENABLED;\n\n\treturn 0;\n}\n\n \nint cxgb_fcoe_disable(struct net_device *netdev)\n{\n\tstruct port_info *pi = netdev_priv(netdev);\n\tstruct adapter *adap = pi->adapter;\n\tstruct cxgb_fcoe *fcoe = &pi->fcoe;\n\n\tif (!(fcoe->flags & CXGB_FCOE_ENABLED))\n\t\treturn -EINVAL;\n\n\tdev_info(adap->pdev_dev, \"Disabling FCoE offload features\\n\");\n\n\tfcoe->flags &= ~CXGB_FCOE_ENABLED;\n\n\tnetdev->features &= ~NETIF_F_FCOE_CRC;\n\tnetdev->vlan_features &= ~NETIF_F_FCOE_CRC;\n\tnetdev->features &= ~NETIF_F_FCOE_MTU;\n\tnetdev->vlan_features &= ~NETIF_F_FCOE_MTU;\n\n\tnetdev_features_change(netdev);\n\n\treturn 0;\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}