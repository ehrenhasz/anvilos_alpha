{
  "module_name": "adapter.h",
  "hash_id": "79cd3c0a6aa55a0fd3dd29f2b1b25d379890f4470a263340d9abdc70a4026ac8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/chelsio/cxgb3/adapter.h",
  "human_readable_source": " \n\n \n\n#ifndef __T3_ADAPTER_H__\n#define __T3_ADAPTER_H__\n\n#include <linux/pci.h>\n#include <linux/spinlock.h>\n#include <linux/interrupt.h>\n#include <linux/timer.h>\n#include <linux/cache.h>\n#include <linux/mutex.h>\n#include <linux/bitops.h>\n#include \"t3cdev.h\"\n#include <asm/io.h>\n\nstruct adapter;\nstruct sge_qset;\nstruct port_info;\n\nenum mac_idx_types {\n\tLAN_MAC_IDX\t= 0,\n\tSAN_MAC_IDX,\n\n\tMAX_MAC_IDX\n};\n\nstruct iscsi_config {\n\t__u8\tmac_addr[ETH_ALEN];\n\t__u32\tflags;\n\tint (*send)(struct port_info *pi, struct sk_buff **skb);\n\tint (*recv)(struct port_info *pi, struct sk_buff *skb);\n};\n\nstruct port_info {\n\tstruct adapter *adapter;\n\tstruct sge_qset *qs;\n\tu8 port_id;\n\tu8 nqsets;\n\tu8 first_qset;\n\tstruct cphy phy;\n\tstruct cmac mac;\n\tstruct link_config link_config;\n\tint activity;\n\t__be32 iscsi_ipv4addr;\n\tstruct iscsi_config iscsic;\n\n\tint link_fault;  \n};\n\nenum {\t\t\t\t \n\tFULL_INIT_DONE = (1 << 0),\n\tUSING_MSI = (1 << 1),\n\tUSING_MSIX = (1 << 2),\n\tQUEUES_BOUND = (1 << 3),\n\tTP_PARITY_INIT = (1 << 4),\n\tNAPI_INIT = (1 << 5),\n};\n\nstruct fl_pg_chunk {\n\tstruct page *page;\n\tvoid *va;\n\tunsigned int offset;\n\tunsigned long *p_cnt;\n\tdma_addr_t mapping;\n};\n\nstruct rx_desc;\nstruct rx_sw_desc;\n\nstruct sge_fl {                      \n\tunsigned int buf_size;       \n\tunsigned int credits;        \n\tunsigned int pend_cred;      \n\tunsigned int size;           \n\tunsigned int cidx;           \n\tunsigned int pidx;           \n\tunsigned int gen;            \n\tstruct fl_pg_chunk pg_chunk; \n\tunsigned int use_pages;      \n\tunsigned int order;\t     \n\tunsigned int alloc_size;     \n\tstruct rx_desc *desc;        \n\tstruct rx_sw_desc *sdesc;    \n\tdma_addr_t   phys_addr;      \n\tunsigned int cntxt_id;       \n\tunsigned long empty;         \n\tunsigned long alloc_failed;  \n};\n\n \n# define RX_BUNDLE_SIZE 8\n\nstruct rsp_desc;\n\nstruct sge_rspq {\t\t \n\tunsigned int credits;\t \n\tunsigned int size;\t \n\tunsigned int cidx;\t \n\tunsigned int gen;\t \n\tunsigned int polling;\t \n\tunsigned int holdoff_tmr;\t \n\tunsigned int next_holdoff;\t \n\tunsigned int rx_recycle_buf;  \n\tstruct rsp_desc *desc;\t \n\tdma_addr_t phys_addr;\t \n\tunsigned int cntxt_id;\t \n\tspinlock_t lock;\t \n\tstruct sk_buff_head rx_queue;  \n\tstruct sk_buff *pg_skb;  \n\n\tunsigned long offload_pkts;\n\tunsigned long offload_bundles;\n\tunsigned long eth_pkts;\t \n\tunsigned long pure_rsps;\t \n\tunsigned long imm_data;\t \n\tunsigned long rx_drops;\t \n\tunsigned long async_notif;  \n\tunsigned long empty;\t \n\tunsigned long nomem;\t \n\tunsigned long unhandled_irqs;\t \n\tunsigned long starved;\n\tunsigned long restarted;\n};\n\nstruct tx_desc;\nstruct tx_sw_desc;\n\nstruct sge_txq {\t\t \n\tunsigned long flags;\t \n\tunsigned int in_use;\t \n\tunsigned int size;\t \n\tunsigned int processed;\t \n\tunsigned int cleaned;\t \n\tunsigned int stop_thres;\t \n\tunsigned int cidx;\t \n\tunsigned int pidx;\t \n\tunsigned int gen;\t \n\tunsigned int unacked;\t \n\tstruct tx_desc *desc;\t \n\tstruct tx_sw_desc *sdesc;\t \n\tspinlock_t lock;\t \n\tunsigned int token;\t \n\tdma_addr_t phys_addr;\t \n\tstruct sk_buff_head sendq;\t \n\tstruct work_struct qresume_task;\t \n\tunsigned int cntxt_id;\t \n\tunsigned long stops;\t \n\tunsigned long restarts;\t \n};\n\nenum {\t\t\t\t \n\tSGE_PSTAT_TSO,\t\t \n\tSGE_PSTAT_RX_CSUM_GOOD,\t \n\tSGE_PSTAT_TX_CSUM,\t \n\tSGE_PSTAT_VLANEX,\t \n\tSGE_PSTAT_VLANINS,\t \n\n\tSGE_PSTAT_MAX\t\t \n};\n\nstruct napi_gro_fraginfo;\n\nstruct sge_qset {\t\t \n\tstruct adapter *adap;\n\tstruct napi_struct napi;\n\tstruct sge_rspq rspq;\n\tstruct sge_fl fl[SGE_RXQ_PER_SET];\n\tstruct sge_txq txq[SGE_TXQ_PER_SET];\n\tint nomem;\n\tvoid *lro_va;\n\tstruct net_device *netdev;\n\tstruct netdev_queue *tx_q;\t \n\tunsigned long txq_stopped;\t \n\tstruct timer_list tx_reclaim_timer;\t \n\tstruct timer_list rx_reclaim_timer;\t \n\tunsigned long port_stats[SGE_PSTAT_MAX];\n} ____cacheline_aligned;\n\nstruct sge {\n\tstruct sge_qset qs[SGE_QSETS];\n\tspinlock_t reg_lock;\t \n};\n\nstruct adapter {\n\tstruct t3cdev tdev;\n\tstruct list_head adapter_list;\n\tvoid __iomem *regs;\n\tstruct pci_dev *pdev;\n\tunsigned long registered_device_map;\n\tunsigned long open_device_map;\n\tunsigned long flags;\n\n\tconst char *name;\n\tint msg_enable;\n\tunsigned int mmio_len;\n\n\tstruct adapter_params params;\n\tunsigned int slow_intr_mask;\n\tunsigned long irq_stats[IRQ_NUM_STATS];\n\n\tint msix_nvectors;\n\tstruct {\n\t\tunsigned short vec;\n\t\tchar desc[22];\n\t} msix_info[SGE_QSETS + 1];\n\n\t \n\tstruct sge sge;\n\tstruct mc7 pmrx;\n\tstruct mc7 pmtx;\n\tstruct mc7 cm;\n\tstruct mc5 mc5;\n\n\tstruct net_device *port[MAX_NPORTS];\n\tunsigned int check_task_cnt;\n\tstruct delayed_work adap_check_task;\n\tstruct work_struct ext_intr_handler_task;\n\tstruct work_struct fatal_error_handler_task;\n\tstruct work_struct link_fault_handler_task;\n\n\tstruct work_struct db_full_task;\n\tstruct work_struct db_empty_task;\n\tstruct work_struct db_drop_task;\n\n\tstruct dentry *debugfs_root;\n\n\tstruct mutex mdio_lock;\n\tspinlock_t stats_lock;\n\tspinlock_t work_lock;\n\n\tstruct sk_buff *nofail_skb;\n};\n\nstatic inline u32 t3_read_reg(struct adapter *adapter, u32 reg_addr)\n{\n\tu32 val = readl(adapter->regs + reg_addr);\n\n\tCH_DBG(adapter, MMIO, \"read register 0x%x value 0x%x\\n\", reg_addr, val);\n\treturn val;\n}\n\nstatic inline void t3_write_reg(struct adapter *adapter, u32 reg_addr, u32 val)\n{\n\tCH_DBG(adapter, MMIO, \"setting register 0x%x to 0x%x\\n\", reg_addr, val);\n\twritel(val, adapter->regs + reg_addr);\n}\n\nstatic inline struct port_info *adap2pinfo(struct adapter *adap, int idx)\n{\n\treturn netdev_priv(adap->port[idx]);\n}\n\nstatic inline int phy2portid(struct cphy *phy)\n{\n\tstruct adapter *adap = phy->adapter;\n\tstruct port_info *port0 = adap2pinfo(adap, 0);\n\n\treturn &port0->phy == phy ? 0 : 1;\n}\n\n#define OFFLOAD_DEVMAP_BIT 15\n\n#define tdev2adap(d) container_of(d, struct adapter, tdev)\n\nstatic inline int offload_running(struct adapter *adapter)\n{\n\treturn test_bit(OFFLOAD_DEVMAP_BIT, &adapter->open_device_map);\n}\n\nint t3_offload_tx(struct t3cdev *tdev, struct sk_buff *skb);\n\nvoid t3_os_ext_intr_handler(struct adapter *adapter);\nvoid t3_os_link_changed(struct adapter *adapter, int port_id, int link_status,\n\t\t\tint speed, int duplex, int fc);\nvoid t3_os_phymod_changed(struct adapter *adap, int port_id);\nvoid t3_os_link_fault(struct adapter *adapter, int port_id, int state);\nvoid t3_os_link_fault_handler(struct adapter *adapter, int port_id);\n\nvoid t3_sge_start(struct adapter *adap);\nvoid t3_sge_stop_dma(struct adapter *adap);\nvoid t3_sge_stop(struct adapter *adap);\nvoid t3_start_sge_timers(struct adapter *adap);\nvoid t3_stop_sge_timers(struct adapter *adap);\nvoid t3_free_sge_resources(struct adapter *adap);\nvoid t3_sge_err_intr_handler(struct adapter *adapter);\nirq_handler_t t3_intr_handler(struct adapter *adap, int polling);\nnetdev_tx_t t3_eth_xmit(struct sk_buff *skb, struct net_device *dev);\nint t3_mgmt_tx(struct adapter *adap, struct sk_buff *skb);\nvoid t3_update_qset_coalesce(struct sge_qset *qs, const struct qset_params *p);\nint t3_sge_alloc_qset(struct adapter *adapter, unsigned int id, int nports,\n\t\t      int irq_vec_idx, const struct qset_params *p,\n\t\t      int ntxq, struct net_device *dev,\n\t\t      struct netdev_queue *netdevq);\nextern struct workqueue_struct *cxgb3_wq;\n\nint t3_get_edc_fw(struct cphy *phy, int edc_idx, int size);\n\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}