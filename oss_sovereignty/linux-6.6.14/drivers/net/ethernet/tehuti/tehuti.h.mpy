{
  "module_name": "tehuti.h",
  "hash_id": "dc5f0b3dd0b8229e8e5d02f659e7e00995a8b225a4e6509c84709152b9dec5a4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/tehuti/tehuti.h",
  "human_readable_source": " \n \n\n#ifndef _TEHUTI_H\n#define _TEHUTI_H\n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/netdevice.h>\n#include <linux/etherdevice.h>\n#include <linux/pci.h>\n#include <linux/delay.h>\n#include <linux/ethtool.h>\n#include <linux/mii.h>\n#include <linux/crc32.h>\n#include <linux/uaccess.h>\n#include <linux/in.h>\n#include <linux/ip.h>\n#include <linux/tcp.h>\n#include <linux/sched.h>\n#include <linux/tty.h>\n#include <linux/if_vlan.h>\n#include <linux/interrupt.h>\n#include <linux/vmalloc.h>\n#include <linux/firmware.h>\n#include <asm/byteorder.h>\n#include <linux/dma-mapping.h>\n#include <linux/slab.h>\n\n \n \n#define BDX_TSO\n#define BDX_LLTX\n#define BDX_DELAY_WPTR\n \n \n\n#if !defined CONFIG_PCI_MSI\n#   undef BDX_MSI\n#endif\n\n#define BDX_DEF_MSG_ENABLE\t(NETIF_MSG_DRV          | \\\n\t\t\t\tNETIF_MSG_PROBE        | \\\n\t\t\t\tNETIF_MSG_LINK)\n\n \n#define BDX_OP_READ  1\n#define BDX_OP_WRITE 2\n\n \n#define BDX_COPYBREAK    257\n\n#define DRIVER_AUTHOR     \"Tehuti Networks(R)\"\n#define BDX_DRV_DESC      \"Tehuti Networks(R) Network Driver\"\n#define BDX_DRV_NAME      \"tehuti\"\n#define BDX_NIC_NAME      \"Tehuti 10 Giga TOE SmartNIC\"\n#define BDX_NIC2PORT_NAME \"Tehuti 2-Port 10 Giga TOE SmartNIC\"\n#define BDX_DRV_VERSION   \"7.29.3\"\n\n#ifdef BDX_MSI\n#    define BDX_MSI_STRING \"msi \"\n#else\n#    define BDX_MSI_STRING \"\"\n#endif\n\n \n#define BDX_NDEV_TXQ_LEN 3000\n\n \n#define BDX_MAX_MTU\t(16 * 1024)\n\n#define FIFO_SIZE  4096\n#define FIFO_EXTRA_SPACE            1024\n\n#if BITS_PER_LONG == 64\n#    define H32_64(x)  (u32) ((u64)(x) >> 32)\n#    define L32_64(x)  (u32) ((u64)(x) & 0xffffffff)\n#elif BITS_PER_LONG == 32\n#    define H32_64(x)  0\n#    define L32_64(x)  ((u32) (x))\n#else\t\t\t\t \n#    error BITS_PER_LONG is undefined. Must be 64 or 32\n#endif\t\t\t\t \n\n#ifdef __BIG_ENDIAN\n#   define CPU_CHIP_SWAP32(x) swab32(x)\n#   define CPU_CHIP_SWAP16(x) swab16(x)\n#else\n#   define CPU_CHIP_SWAP32(x) (x)\n#   define CPU_CHIP_SWAP16(x) (x)\n#endif\n\n#define READ_REG(pp, reg)         readl(pp->pBdxRegs + reg)\n#define WRITE_REG(pp, reg, val)   writel(val, pp->pBdxRegs + reg)\n\n#ifndef NET_IP_ALIGN\n#   define NET_IP_ALIGN 2\n#endif\n\n#ifndef NETDEV_TX_OK\n#   define NETDEV_TX_OK 0\n#endif\n\n#define LUXOR_MAX_PORT     2\n#define BDX_MAX_RX_DONE    150\n#define BDX_TXF_DESC_SZ    16\n#define BDX_MAX_TX_LEVEL   (priv->txd_fifo0.m.memsz - 16)\n#define BDX_MIN_TX_LEVEL   256\n#define BDX_NO_UPD_PACKETS 40\n\nstruct pci_nic {\n\tint port_num;\n\tvoid __iomem *regs;\n\tint irq_type;\n\tstruct bdx_priv *priv[LUXOR_MAX_PORT];\n};\n\nenum { IRQ_INTX, IRQ_MSI, IRQ_MSIX };\n\n#define PCK_TH_MULT   128\n#define INT_COAL_MULT 2\n\n#define BITS_MASK(nbits)\t\t\t((1<<nbits)-1)\n#define GET_BITS_SHIFT(x, nbits, nshift)\t(((x)>>nshift)&BITS_MASK(nbits))\n#define BITS_SHIFT_MASK(nbits, nshift)\t\t(BITS_MASK(nbits)<<nshift)\n#define BITS_SHIFT_VAL(x, nbits, nshift)\t(((x)&BITS_MASK(nbits))<<nshift)\n#define BITS_SHIFT_CLEAR(x, nbits, nshift)\t\\\n\t((x)&(~BITS_SHIFT_MASK(nbits, nshift)))\n\n#define GET_INT_COAL(x)\t\t\t\tGET_BITS_SHIFT(x, 15, 0)\n#define GET_INT_COAL_RC(x)\t\t\tGET_BITS_SHIFT(x, 1, 15)\n#define GET_RXF_TH(x)\t\t\t\tGET_BITS_SHIFT(x, 4, 16)\n#define GET_PCK_TH(x)\t\t\t\tGET_BITS_SHIFT(x, 4, 20)\n\n#define INT_REG_VAL(coal, coal_rc, rxf_th, pck_th)\t\\\n\t((coal)|((coal_rc)<<15)|((rxf_th)<<16)|((pck_th)<<20))\n\nstruct fifo {\n\tdma_addr_t da;\t\t \n\tchar *va;\t\t \n\tu32 rptr, wptr;\t\t \n\tu16 reg_CFG0, reg_CFG1;\n\tu16 reg_RPTR, reg_WPTR;\n\tu16 memsz;\t\t \n\tu16 size_mask;\n\tu16 pktsz;\t\t \n\tu16 rcvno;\t\t \n};\n\nstruct txf_fifo {\n\tstruct fifo m;\t\t \n};\n\nstruct txd_fifo {\n\tstruct fifo m;\t\t \n};\n\nstruct rxf_fifo {\n\tstruct fifo m;\t\t \n};\n\nstruct rxd_fifo {\n\tstruct fifo m;\t\t \n};\n\nstruct rx_map {\n\tu64 dma;\n\tstruct sk_buff *skb;\n};\n\nstruct rxdb {\n\tint *stack;\n\tstruct rx_map *elems;\n\tint nelem;\n\tint top;\n};\n\nunion bdx_dma_addr {\n\tdma_addr_t dma;\n\tstruct sk_buff *skb;\n};\n\n \nstruct tx_map {\n\tunion bdx_dma_addr addr;\n\tint len;\n};\n\n \nstruct txdb {\n\tstruct tx_map *start;\t \n\tstruct tx_map *end;\t \n\tstruct tx_map *rptr;\t \n\tstruct tx_map *wptr;\t \n\tint size;\t\t \n};\n\n \nstruct bdx_stats {\n\tu64 InUCast;\t\t\t \n\tu64 InMCast;\t\t\t \n\tu64 InBCast;\t\t\t \n\tu64 InPkts;\t\t\t \n\tu64 InErrors;\t\t\t \n\tu64 InDropped;\t\t\t \n\tu64 FrameTooLong;\t\t \n\tu64 FrameSequenceErrors;\t \n\tu64 InVLAN;\t\t\t \n\tu64 InDroppedDFE;\t\t \n\tu64 InDroppedIntFull;\t\t \n\tu64 InFrameAlignErrors;\t\t \n\n\t \n\n\tu64 OutUCast;\t\t\t \n\tu64 OutMCast;\t\t\t \n\tu64 OutBCast;\t\t\t \n\tu64 OutPkts;\t\t\t \n\n\t \n\n\tu64 OutVLAN;\t\t\t \n\tu64 InUCastOctects;\t\t \n\tu64 OutUCastOctects;\t\t \n\n\t \n\n\tu64 InBCastOctects;\t\t \n\tu64 OutBCastOctects;\t\t \n\tu64 InOctects;\t\t\t \n\tu64 OutOctects;\t\t\t \n};\n\nstruct bdx_priv {\n\tvoid __iomem *pBdxRegs;\n\tstruct net_device *ndev;\n\n\tstruct napi_struct napi;\n\n\t \n\tstruct rxd_fifo rxd_fifo0;\n\tstruct rxf_fifo rxf_fifo0;\n\tstruct rxdb *rxdb;\t \n\tint napi_stop;\n\n\t \n\tstruct txd_fifo txd_fifo0;\n\tstruct txf_fifo txf_fifo0;\n\n\tstruct txdb txdb;\n\tint tx_level;\n#ifdef BDX_DELAY_WPTR\n\tint tx_update_mark;\n\tint tx_noupd;\n#endif\n\tspinlock_t tx_lock;\t \n\n\t \n\tu8 port;\n\tu32 msg_enable;\n\tint stats_flag;\n\tstruct bdx_stats hw_stats;\n\tstruct pci_dev *pdev;\n\n\tstruct pci_nic *nic;\n\n\tu8 txd_size;\n\tu8 txf_size;\n\tu8 rxd_size;\n\tu8 rxf_size;\n\tu32 rdintcm;\n\tu32 tdintcm;\n};\n\n \nstruct rxf_desc {\n\tu32 info;\t\t \n\tu32 va_lo;\t\t \n\tu32 va_hi;\t\t \n\tu32 pa_lo;\t\t \n\tu32 pa_hi;\t\t \n\tu32 len;\t\t \n};\n\n#define GET_RXD_BC(x)\t\t\tGET_BITS_SHIFT((x), 5, 0)\n#define GET_RXD_RXFQ(x)\t\t\tGET_BITS_SHIFT((x), 2, 8)\n#define GET_RXD_TO(x)\t\t\tGET_BITS_SHIFT((x), 1, 15)\n#define GET_RXD_TYPE(x)\t\t\tGET_BITS_SHIFT((x), 4, 16)\n#define GET_RXD_ERR(x)\t\t\tGET_BITS_SHIFT((x), 6, 21)\n#define GET_RXD_RXP(x)\t\t\tGET_BITS_SHIFT((x), 1, 27)\n#define GET_RXD_PKT_ID(x)\t\tGET_BITS_SHIFT((x), 3, 28)\n#define GET_RXD_VTAG(x)\t\t\tGET_BITS_SHIFT((x), 1, 31)\n#define GET_RXD_VLAN_ID(x)\t\tGET_BITS_SHIFT((x), 12, 0)\n#define GET_RXD_VLAN_TCI(x)\t\tGET_BITS_SHIFT((x), 16, 0)\n#define GET_RXD_CFI(x)\t\t\tGET_BITS_SHIFT((x), 1, 12)\n#define GET_RXD_PRIO(x)\t\t\tGET_BITS_SHIFT((x), 3, 13)\n\nstruct rxd_desc {\n\tu32 rxd_val1;\n\tu16 len;\n\tu16 rxd_vlan;\n\tu32 va_lo;\n\tu32 va_hi;\n};\n\n \n \nstruct pbl {\n\tu32 pa_lo;\n\tu32 pa_hi;\n\tu32 len;\n};\n\n \n#define TXD_W1_VAL(bc, checksum, vtag, lgsnd, vlan_id)\t\\\n\t((bc) | ((checksum)<<5) | ((vtag)<<8) | \\\n\t((lgsnd)<<9) | (0x30000) | ((vlan_id)<<20))\n\nstruct txd_desc {\n\tu32 txd_val1;\n\tu16 mss;\n\tu16 length;\n\tu32 va_lo;\n\tu32 va_hi;\n\tstruct pbl pbl[];\t \n} __packed;\n\n \n#define BDX_REGS_SIZE\t  0x1000\n\n \n#define regTXD_CFG1_0   0x4000\n#define regRXF_CFG1_0   0x4010\n#define regRXD_CFG1_0   0x4020\n#define regTXF_CFG1_0   0x4030\n#define regTXD_CFG0_0   0x4040\n#define regRXF_CFG0_0   0x4050\n#define regRXD_CFG0_0   0x4060\n#define regTXF_CFG0_0   0x4070\n#define regTXD_WPTR_0   0x4080\n#define regRXF_WPTR_0   0x4090\n#define regRXD_WPTR_0   0x40A0\n#define regTXF_WPTR_0   0x40B0\n#define regTXD_RPTR_0   0x40C0\n#define regRXF_RPTR_0   0x40D0\n#define regRXD_RPTR_0   0x40E0\n#define regTXF_RPTR_0   0x40F0\n#define regTXF_RPTR_3   0x40FC\n\n \n#define  FW_VER         0x5010\n#define  SROM_VER       0x5020\n#define  FPGA_VER       0x5030\n#define  FPGA_SEED      0x5040\n\n \n#define regISR regISR0\n#define regISR0          0x5100\n\n#define regIMR regIMR0\n#define regIMR0          0x5110\n\n#define regRDINTCM0      0x5120\n#define regRDINTCM2      0x5128\n\n#define regTDINTCM0      0x5130\n\n#define regISR_MSK0      0x5140\n\n#define regINIT_SEMAPHORE 0x5170\n#define regINIT_STATUS    0x5180\n\n#define regMAC_LNK_STAT  0x0200\n#define MAC_LINK_STAT    0x4\t \n\n#define regGMAC_RXF_A   0x1240\n\n#define regUNC_MAC0_A   0x1250\n#define regUNC_MAC1_A   0x1260\n#define regUNC_MAC2_A   0x1270\n\n#define regVLAN_0       0x1800\n\n#define regMAX_FRAME_A  0x12C0\n\n#define regRX_MAC_MCST0    0x1A80\n#define regRX_MAC_MCST1    0x1A84\n#define MAC_MCST_NUM       15\n#define regRX_MCST_HASH0   0x1A00\n#define MAC_MCST_HASH_NUM  8\n\n#define regVPC                  0x2300\n#define regVIC                  0x2320\n#define regVGLB                 0x2340\n\n#define regCLKPLL               0x5000\n\n \n#define regREVISION        0x6000\n#define regSCRATCH         0x6004\n#define regCTRLST          0x6008\n#define regMAC_ADDR_0      0x600C\n#define regMAC_ADDR_1      0x6010\n#define regFRM_LENGTH      0x6014\n#define regPAUSE_QUANT     0x6018\n#define regRX_FIFO_SECTION 0x601C\n#define regTX_FIFO_SECTION 0x6020\n#define regRX_FULLNESS     0x6024\n#define regTX_FULLNESS     0x6028\n#define regHASHTABLE       0x602C\n#define regMDIO_ST         0x6030\n#define regMDIO_CTL        0x6034\n#define regMDIO_DATA       0x6038\n#define regMDIO_ADDR       0x603C\n\n#define regRST_PORT        0x7000\n#define regDIS_PORT        0x7010\n#define regRST_QU          0x7020\n#define regDIS_QU          0x7030\n\n#define regCTRLST_TX_ENA   0x0001\n#define regCTRLST_RX_ENA   0x0002\n#define regCTRLST_PRM_ENA  0x0010\n#define regCTRLST_PAD_ENA  0x0020\n\n#define regCTRLST_BASE     (regCTRLST_PAD_ENA|regCTRLST_PRM_ENA)\n\n#define regRX_FLT   0x1400\n\n \n#define  TX_RX_CFG1_BASE          0xffffffff\t \n#define  TX_RX_CFG0_BASE          0xfffff000\t \n#define  TX_RX_CFG0_RSVD          0x0ffc\t \n#define  TX_RX_CFG0_SIZE          0x0003\t \n\n \n#define  TXF_WPTR_WR_PTR        0x7ff8\t \n\n \n#define  TXF_RPTR_RD_PTR        0x7ff8\t \n\n#define TXF_WPTR_MASK 0x7ff0\t \n\n \n \n#define  IMR_INPROG   0x80000000\t \n#define  IR_LNKCHG1   0x10000000\t \n#define  IR_LNKCHG0   0x08000000\t \n#define  IR_GPIO      0x04000000\t \n#define  IR_RFRSH     0x02000000\t \n#define  IR_RSVD      0x01000000\t \n#define  IR_SWI       0x00800000\t \n#define  IR_RX_FREE_3 0x00400000\t \n#define  IR_RX_FREE_2 0x00200000\t \n#define  IR_RX_FREE_1 0x00100000\t \n#define  IR_RX_FREE_0 0x00080000\t \n#define  IR_TX_FREE_3 0x00040000\t \n#define  IR_TX_FREE_2 0x00020000\t \n#define  IR_TX_FREE_1 0x00010000\t \n#define  IR_TX_FREE_0 0x00008000\t \n#define  IR_RX_DESC_3 0x00004000\t \n#define  IR_RX_DESC_2 0x00002000\t \n#define  IR_RX_DESC_1 0x00001000\t \n#define  IR_RX_DESC_0 0x00000800\t \n#define  IR_PSE       0x00000400\t \n#define  IR_TMR3      0x00000200\t \n#define  IR_TMR2      0x00000100\t \n#define  IR_TMR1      0x00000080\t \n#define  IR_TMR0      0x00000040\t \n#define  IR_VNT       0x00000020\t \n#define  IR_RxFL      0x00000010\t \n#define  IR_SDPERR    0x00000008\t \n#define  IR_TR        0x00000004\t \n#define  IR_PCIE_LINK 0x00000002\t \n#define  IR_PCIE_TOUT 0x00000001\t \n\n#define  IR_EXTRA (IR_RX_FREE_0 | IR_LNKCHG0 | IR_PSE | \\\n    IR_TMR0 | IR_PCIE_LINK | IR_PCIE_TOUT)\n#define  IR_RUN (IR_EXTRA | IR_RX_DESC_0 | IR_TX_FREE_0)\n#define  IR_ALL 0xfdfffff7\n\n#define  IR_LNKCHG0_ofst        27\n\n#define  GMAC_RX_FILTER_OSEN  0x1000\t \n#define  GMAC_RX_FILTER_TXFC  0x0400\t \n#define  GMAC_RX_FILTER_RSV0  0x0200\t \n#define  GMAC_RX_FILTER_FDA   0x0100\t \n#define  GMAC_RX_FILTER_AOF   0x0080\t \n#define  GMAC_RX_FILTER_ACF   0x0040\t \n#define  GMAC_RX_FILTER_ARUNT 0x0020\t \n#define  GMAC_RX_FILTER_ACRC  0x0010\t \n#define  GMAC_RX_FILTER_AM    0x0008\t \n#define  GMAC_RX_FILTER_AB    0x0004\t \n#define  GMAC_RX_FILTER_PRM   0x0001\t \n\n#define  MAX_FRAME_AB_VAL       0x3fff\t \n\n#define  CLKPLL_PLLLKD          0x0200\t \n#define  CLKPLL_RSTEND          0x0100\t \n#define  CLKPLL_SFTRST          0x0001\t \n\n#define  CLKPLL_LKD             (CLKPLL_PLLLKD|CLKPLL_RSTEND)\n\n \n#define PCI_DEV_CTRL_REG 0x88\n#define GET_DEV_CTRL_MAXPL(x)           GET_BITS_SHIFT(x, 3, 5)\n#define GET_DEV_CTRL_MRRS(x)            GET_BITS_SHIFT(x, 3, 12)\n\n \n#define PCI_LINK_STATUS_REG 0x92\n#define GET_LINK_STATUS_LANES(x)\t\tGET_BITS_SHIFT(x, 6, 4)\n\n \n\n#define DBG2(fmt, args...)\t\t\t\t\t\\\n\tpr_err(\"%s:%-5d: \" fmt, __func__, __LINE__, ## args)\n\n#define BDX_ASSERT(x) BUG_ON(x)\n\n#ifdef DEBUG\n\n#define ENTER\t\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\\\n\tpr_err(\"%s:%-5d: ENTER\\n\", __func__, __LINE__); \\\n} while (0)\n\n#define RET(args...)\t\t\t\t\t \\\ndo {\t\t\t\t\t\t\t \\\n\tpr_err(\"%s:%-5d: RETURN\\n\", __func__, __LINE__); \\\n\treturn args;\t\t\t\t\t \\\n} while (0)\n\n#define DBG(fmt, args...)\t\t\t\t\t\\\n\tpr_err(\"%s:%-5d: \" fmt, __func__, __LINE__, ## args)\n#else\n#define ENTER do {  } while (0)\n#define RET(args...)   return args\n#define DBG(fmt, args...)\t\t\t\\\ndo {\t\t\t\t\t\t\\\n\tif (0)\t\t\t\t\t\\\n\t\tpr_err(fmt, ##args);\t\t\\\n} while (0)\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}