{
  "module_name": "fun_queue.h",
  "hash_id": "d3c51813374ac9743bcf755c1f0141a9b991a3d656d56acf8290f17c1de3e339",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/fungible/funcore/fun_queue.h",
  "human_readable_source": " \n\n#ifndef _FUN_QEUEUE_H\n#define _FUN_QEUEUE_H\n\n#include <linux/interrupt.h>\n#include <linux/io.h>\n\nstruct device;\nstruct fun_dev;\nstruct fun_queue;\nstruct fun_cqe_info;\nstruct fun_rsp_common;\n\ntypedef void (*cq_callback_t)(struct fun_queue *funq, void *data, void *msg,\n\t\t\t      const struct fun_cqe_info *info);\n\nstruct fun_rq_info {\n\tdma_addr_t dma;\n\tstruct page *page;\n};\n\n \nstruct fun_queue {\n\tstruct fun_dev *fdev;\n\tspinlock_t sq_lock;\n\n\tdma_addr_t cq_dma_addr;\n\tdma_addr_t sq_dma_addr;\n\tdma_addr_t rq_dma_addr;\n\n\tu32 __iomem *cq_db;\n\tu32 __iomem *sq_db;\n\tu32 __iomem *rq_db;\n\n\tvoid *cqes;\n\tvoid *sq_cmds;\n\tstruct fun_eprq_rqbuf *rqes;\n\tstruct fun_rq_info *rq_info;\n\n\tu32 cqid;\n\tu32 sqid;\n\tu32 rqid;\n\n\tu32 cq_depth;\n\tu32 sq_depth;\n\tu32 rq_depth;\n\n\tu16 cq_head;\n\tu16 sq_tail;\n\tu16 rq_tail;\n\n\tu8 cqe_size_log2;\n\tu8 sqe_size_log2;\n\n\tu16 cqe_info_offset;\n\n\tu16 rq_buf_idx;\n\tint rq_buf_offset;\n\tu16 num_rqe_to_fill;\n\n\tu8 cq_intcoal_usec;\n\tu8 cq_intcoal_nentries;\n\tu8 sq_intcoal_usec;\n\tu8 sq_intcoal_nentries;\n\n\tu16 cq_flags;\n\tu16 sq_flags;\n\tu16 rq_flags;\n\n\t \n\tu16 sq_comp;\n\n\tvolatile __be64 *sq_head;\n\n\tcq_callback_t cq_cb;\n\tvoid *cb_data;\n\n\tirq_handler_t irq_handler;\n\tvoid *irq_data;\n\ts16 cq_vector;\n\tu8 cq_phase;\n\n\t \n\tu16 qid;\n\n\tchar irqname[24];\n};\n\nstatic inline void *fun_sqe_at(const struct fun_queue *funq, unsigned int pos)\n{\n\treturn funq->sq_cmds + (pos << funq->sqe_size_log2);\n}\n\nstatic inline void funq_sq_post_tail(struct fun_queue *funq, u16 tail)\n{\n\tif (++tail == funq->sq_depth)\n\t\ttail = 0;\n\tfunq->sq_tail = tail;\n\twritel(tail, funq->sq_db);\n}\n\nstatic inline struct fun_cqe_info *funq_cqe_info(const struct fun_queue *funq,\n\t\t\t\t\t\t void *cqe)\n{\n\treturn cqe + funq->cqe_info_offset;\n}\n\nstatic inline void funq_rq_post(struct fun_queue *funq)\n{\n\twritel(funq->rq_tail, funq->rq_db);\n}\n\nstruct fun_queue_alloc_req {\n\tu8  cqe_size_log2;\n\tu8  sqe_size_log2;\n\n\tu16 cq_flags;\n\tu16 sq_flags;\n\tu16 rq_flags;\n\n\tu32 cq_depth;\n\tu32 sq_depth;\n\tu32 rq_depth;\n\n\tu8 cq_intcoal_usec;\n\tu8 cq_intcoal_nentries;\n\tu8 sq_intcoal_usec;\n\tu8 sq_intcoal_nentries;\n};\n\nint fun_sq_create(struct fun_dev *fdev, u16 flags, u32 sqid, u32 cqid,\n\t\t  u8 sqe_size_log2, u32 sq_depth, dma_addr_t dma_addr,\n\t\t  u8 coal_nentries, u8 coal_usec, u32 irq_num,\n\t\t  u32 scan_start_id, u32 scan_end_id,\n\t\t  u32 rq_buf_size_log2, u32 *sqidp, u32 __iomem **dbp);\nint fun_cq_create(struct fun_dev *fdev, u16 flags, u32 cqid, u32 rqid,\n\t\t  u8 cqe_size_log2, u32 cq_depth, dma_addr_t dma_addr,\n\t\t  u16 headroom, u16 tailroom, u8 coal_nentries, u8 coal_usec,\n\t\t  u32 irq_num, u32 scan_start_id, u32 scan_end_id,\n\t\t  u32 *cqidp, u32 __iomem **dbp);\nvoid *fun_alloc_ring_mem(struct device *dma_dev, size_t depth,\n\t\t\t size_t hw_desc_sz, size_t sw_desc_size, bool wb,\n\t\t\t int numa_node, dma_addr_t *dma_addr, void **sw_va,\n\t\t\t volatile __be64 **wb_va);\nvoid fun_free_ring_mem(struct device *dma_dev, size_t depth, size_t hw_desc_sz,\n\t\t       bool wb, void *hw_va, dma_addr_t dma_addr, void *sw_va);\n\n#define fun_destroy_sq(fdev, sqid) \\\n\tfun_res_destroy((fdev), FUN_ADMIN_OP_EPSQ, 0, (sqid))\n#define fun_destroy_cq(fdev, cqid) \\\n\tfun_res_destroy((fdev), FUN_ADMIN_OP_EPCQ, 0, (cqid))\n\nstruct fun_queue *fun_alloc_queue(struct fun_dev *fdev, int qid,\n\t\t\t\t  const struct fun_queue_alloc_req *req);\nvoid fun_free_queue(struct fun_queue *funq);\n\nstatic inline void fun_set_cq_callback(struct fun_queue *funq, cq_callback_t cb,\n\t\t\t\t       void *cb_data)\n{\n\tfunq->cq_cb = cb;\n\tfunq->cb_data = cb_data;\n}\n\nint fun_create_rq(struct fun_queue *funq);\nint fun_create_queue(struct fun_queue *funq);\n\nvoid fun_free_irq(struct fun_queue *funq);\nint fun_request_irq(struct fun_queue *funq, const char *devname,\n\t\t    irq_handler_t handler, void *data);\n\nunsigned int __fun_process_cq(struct fun_queue *funq, unsigned int max);\nunsigned int fun_process_cq(struct fun_queue *funq, unsigned int max);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}