{
  "module_name": "fun_dev.h",
  "hash_id": "2e8c5cfcf125bd05084cbb4a8a88a9b95f3584d9db737d0685491e336d9160fc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/fungible/funcore/fun_dev.h",
  "human_readable_source": " \n\n#ifndef _FUNDEV_H\n#define _FUNDEV_H\n\n#include <linux/sbitmap.h>\n#include <linux/spinlock_types.h>\n#include <linux/workqueue.h>\n#include \"fun_hci.h\"\n\nstruct pci_dev;\nstruct fun_dev;\nstruct fun_queue;\nstruct fun_cmd_ctx;\nstruct fun_queue_alloc_req;\n\n \nenum {\n\tFUN_DB_QIDX_S = 0,\n\tFUN_DB_INTCOAL_ENTRIES_S = 16,\n\tFUN_DB_INTCOAL_ENTRIES_M = 0x7f,\n\tFUN_DB_INTCOAL_USEC_S = 23,\n\tFUN_DB_INTCOAL_USEC_M = 0x7f,\n\tFUN_DB_IRQ_S = 30,\n\tFUN_DB_IRQ_F = 1 << FUN_DB_IRQ_S,\n\tFUN_DB_IRQ_ARM_S = 31,\n\tFUN_DB_IRQ_ARM_F = 1U << FUN_DB_IRQ_ARM_S\n};\n\n \ntypedef void (*fun_admin_callback_t)(struct fun_dev *fdev, void *rsp,\n\t\t\t\t     void *cb_data);\n\n \ntypedef void (*fun_admin_event_cb)(struct fun_dev *fdev, void *cqe);\n\n \ntypedef void (*fun_serv_cb)(struct fun_dev *fd);\n\n \nenum {\n\tFUN_SERV_DISABLED,     \n\tFUN_SERV_FIRST_AVAIL\n};\n\n \nstruct fun_dev {\n\tstruct device *dev;\n\n\tvoid __iomem *bar;             \n\tu32 __iomem *dbs;              \n\n\t \n\tstruct fun_queue *admin_q;\n\tstruct sbitmap_queue admin_sbq;\n\tstruct fun_cmd_ctx *cmd_ctx;\n\tfun_admin_event_cb adminq_cb;\n\tbool suppress_cmds;            \n\n\t \n\tunsigned int db_stride;\n\n\t \n\tu32 cc_reg;          \n\tu64 cap_reg;         \n\n\tunsigned int q_depth;     \n\tunsigned int max_qid;     \n\tunsigned int kern_end_qid;  \n\n\tunsigned int fw_handle;\n\n\t \n\tunsigned int num_irqs;\n\tunsigned int irqs_avail;\n\tspinlock_t irqmgr_lock;\n\tunsigned long *irq_map;\n\n\t \n\tstruct work_struct service_task;\n\tunsigned long service_flags;\n\tfun_serv_cb serv_cb;\n};\n\nstruct fun_dev_params {\n\tu8  cqe_size_log2;  \n\tu8  sqe_size_log2;  \n\n\t \n\tu16 cq_depth;\n\tu16 sq_depth;\n\tu16 rq_depth;\n\n\tu16 min_msix;  \n\n\tfun_admin_event_cb event_cb;\n\tfun_serv_cb serv_cb;\n};\n\n \nstatic inline u32 __iomem *fun_db_addr(const struct fun_dev *fdev,\n\t\t\t\t       unsigned int db_index)\n{\n\treturn &fdev->dbs[db_index * fdev->db_stride];\n}\n\n \nstatic inline u32 __iomem *fun_sq_db_addr(const struct fun_dev *fdev,\n\t\t\t\t\t  unsigned int sqid)\n{\n\treturn fun_db_addr(fdev, sqid * 2);\n}\n\nstatic inline u32 __iomem *fun_cq_db_addr(const struct fun_dev *fdev,\n\t\t\t\t\t  unsigned int cqid)\n{\n\treturn fun_db_addr(fdev, cqid * 2 + 1);\n}\n\nint fun_get_res_count(struct fun_dev *fdev, enum fun_admin_op res);\nint fun_res_destroy(struct fun_dev *fdev, enum fun_admin_op res,\n\t\t    unsigned int flags, u32 id);\nint fun_bind(struct fun_dev *fdev, enum fun_admin_bind_type type0,\n\t     unsigned int id0, enum fun_admin_bind_type type1,\n\t     unsigned int id1);\n\nint fun_submit_admin_cmd(struct fun_dev *fdev, struct fun_admin_req_common *cmd,\n\t\t\t fun_admin_callback_t cb, void *cb_data, bool wait_ok);\nint fun_submit_admin_sync_cmd(struct fun_dev *fdev,\n\t\t\t      struct fun_admin_req_common *cmd, void *rsp,\n\t\t\t      size_t rspsize, unsigned int timeout);\n\nint fun_dev_enable(struct fun_dev *fdev, struct pci_dev *pdev,\n\t\t   const struct fun_dev_params *areq, const char *name);\nvoid fun_dev_disable(struct fun_dev *fdev);\n\nint fun_reserve_irqs(struct fun_dev *fdev, unsigned int nirqs,\n\t\t     u16 *irq_indices);\nvoid fun_release_irqs(struct fun_dev *fdev, unsigned int nirqs,\n\t\t      u16 *irq_indices);\n\nvoid fun_serv_stop(struct fun_dev *fd);\nvoid fun_serv_restart(struct fun_dev *fd);\nvoid fun_serv_sched(struct fun_dev *fd);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}