{
  "module_name": "aq_hw_utils.c",
  "hash_id": "f4905edeb3854ec2307fcd9141010bb114ee3982b358d5d1bdc5ffda7ef999a8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/aquantia/atlantic/aq_hw_utils.c",
  "human_readable_source": "\n \n\n \n\n#include \"aq_hw_utils.h\"\n\n#include <linux/io-64-nonatomic-lo-hi.h>\n\n#include \"aq_hw.h\"\n#include \"aq_nic.h\"\n\nvoid aq_hw_write_reg_bit(struct aq_hw_s *aq_hw, u32 addr, u32 msk,\n\t\t\t u32 shift, u32 val)\n{\n\tif (msk ^ ~0) {\n\t\tu32 reg_old, reg_new;\n\n\t\treg_old = aq_hw_read_reg(aq_hw, addr);\n\t\treg_new = (reg_old & (~msk)) | (val << shift);\n\n\t\tif (reg_old != reg_new)\n\t\t\taq_hw_write_reg(aq_hw, addr, reg_new);\n\t} else {\n\t\taq_hw_write_reg(aq_hw, addr, val);\n\t}\n}\n\nu32 aq_hw_read_reg_bit(struct aq_hw_s *aq_hw, u32 addr, u32 msk, u32 shift)\n{\n\treturn ((aq_hw_read_reg(aq_hw, addr) & msk) >> shift);\n}\n\nu32 aq_hw_read_reg(struct aq_hw_s *hw, u32 reg)\n{\n\tu32 value = readl(hw->mmio + reg);\n\n\tif (value == U32_MAX &&\n\t    readl(hw->mmio + hw->aq_nic_cfg->aq_hw_caps->hw_alive_check_addr) == U32_MAX)\n\t\taq_utils_obj_set(&hw->flags, AQ_HW_FLAG_ERR_UNPLUG);\n\n\treturn value;\n}\n\nvoid aq_hw_write_reg(struct aq_hw_s *hw, u32 reg, u32 value)\n{\n\twritel(value, hw->mmio + reg);\n}\n\n \nu64 aq_hw_read_reg64(struct aq_hw_s *hw, u32 reg)\n{\n\tu64 value = U64_MAX;\n\n\tif (hw->aq_nic_cfg->aq_hw_caps->op64bit)\n\t\tvalue = readq(hw->mmio + reg);\n\telse\n\t\tvalue = lo_hi_readq(hw->mmio + reg);\n\n\tif (value == U64_MAX &&\n\t    readl(hw->mmio + hw->aq_nic_cfg->aq_hw_caps->hw_alive_check_addr) == U32_MAX)\n\t\taq_utils_obj_set(&hw->flags, AQ_HW_FLAG_ERR_UNPLUG);\n\n\treturn value;\n}\n\nvoid aq_hw_write_reg64(struct aq_hw_s *hw, u32 reg, u64 value)\n{\n\tif (hw->aq_nic_cfg->aq_hw_caps->op64bit)\n\t\twriteq(value, hw->mmio + reg);\n\telse\n\t\tlo_hi_writeq(value, hw->mmio + reg);\n}\n\nint aq_hw_err_from_flags(struct aq_hw_s *hw)\n{\n\tint err = 0;\n\n\tif (aq_utils_obj_test(&hw->flags, AQ_HW_FLAG_ERR_UNPLUG)) {\n\t\terr = -ENXIO;\n\t\tgoto err_exit;\n\t}\n\tif (aq_utils_obj_test(&hw->flags, AQ_HW_FLAG_ERR_HW)) {\n\t\terr = -EIO;\n\t\tgoto err_exit;\n\t}\n\nerr_exit:\n\treturn err;\n}\n\nint aq_hw_num_tcs(struct aq_hw_s *hw)\n{\n\tswitch (hw->aq_nic_cfg->tc_mode) {\n\tcase AQ_TC_MODE_8TCS:\n\t\treturn 8;\n\tcase AQ_TC_MODE_4TCS:\n\t\treturn 4;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn 1;\n}\n\nint aq_hw_q_per_tc(struct aq_hw_s *hw)\n{\n\tswitch (hw->aq_nic_cfg->tc_mode) {\n\tcase AQ_TC_MODE_8TCS:\n\t\treturn 4;\n\tcase AQ_TC_MODE_4TCS:\n\t\treturn 8;\n\tdefault:\n\t\treturn 4;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}