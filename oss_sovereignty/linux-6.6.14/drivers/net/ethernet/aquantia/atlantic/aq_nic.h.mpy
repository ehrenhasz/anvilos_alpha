{
  "module_name": "aq_nic.h",
  "hash_id": "099a6dc3048121b1ffd383ecea8346114a306cd6f77aeff38dba35ee9e37f30d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/aquantia/atlantic/aq_nic.h",
  "human_readable_source": " \n \n\n \n\n#ifndef AQ_NIC_H\n#define AQ_NIC_H\n\n#include <linux/ethtool.h>\n#include <net/xdp.h>\n#include <linux/bpf.h>\n\n#include \"aq_common.h\"\n#include \"aq_rss.h\"\n#include \"aq_hw.h\"\n\nstruct aq_ring_s;\nstruct aq_hw_ops;\nstruct aq_fw_s;\nstruct aq_vec_s;\nstruct aq_macsec_cfg;\nstruct aq_ptp_s;\nenum aq_rx_filter_type;\n\nenum aq_fc_mode {\n\tAQ_NIC_FC_OFF = 0,\n\tAQ_NIC_FC_TX,\n\tAQ_NIC_FC_RX,\n\tAQ_NIC_FC_FULL,\n};\n\nstruct aq_fc_info {\n\tenum aq_fc_mode req;\n\tenum aq_fc_mode cur;\n};\n\nstruct aq_nic_cfg_s {\n\tconst struct aq_hw_caps_s *aq_hw_caps;\n\tu64 features;\n\tu32 rxds;\t\t \n\tu32 txds;\t\t \n\tu32 vecs;\t\t \n\tu32 link_irq_vec;\n\tu32 irq_type;\n\tu32 itr;\n\tu16 rx_itr;\n\tu16 tx_itr;\n\tu32 rxpageorder;\n\tu32 num_rss_queues;\n\tu32 mtu;\n\tstruct aq_fc_info fc;\n\tu32 link_speed_msk;\n\tu32 wol;\n\tu8 is_vlan_rx_strip;\n\tu8 is_vlan_tx_insert;\n\tbool is_vlan_force_promisc;\n\tu16 is_mc_list_enabled;\n\tu16 mc_list_count;\n\tbool is_autoneg;\n\tbool is_polling;\n\tbool is_rss;\n\tbool is_lro;\n\tbool is_qos;\n\tbool is_ptp;\n\tbool is_media_detect;\n\tint downshift_counter;\n\tenum aq_tc_mode tc_mode;\n\tu32 priv_flags;\n\tu8  tcs;\n\tu8 prio_tc_map[8];\n\tu32 tc_max_rate[AQ_CFG_TCS_MAX];\n\tunsigned long tc_min_rate_msk;\n\tu32 tc_min_rate[AQ_CFG_TCS_MAX];\n\tstruct aq_rss_parameters aq_rss;\n\tu32 eee_speeds;\n};\n\n#define AQ_NIC_FLAG_STARTED     0x00000004U\n#define AQ_NIC_FLAG_STOPPING    0x00000008U\n#define AQ_NIC_FLAG_RESETTING   0x00000010U\n#define AQ_NIC_FLAG_CLOSING     0x00000020U\n#define AQ_NIC_PTP_DPATH_UP     0x02000000U\n#define AQ_NIC_LINK_DOWN        0x04000000U\n#define AQ_NIC_FLAG_ERR_UNPLUG  0x40000000U\n#define AQ_NIC_FLAG_ERR_HW      0x80000000U\n\n#define AQ_NIC_QUIRK_BAD_PTP    BIT(0)\n\n#define AQ_NIC_WOL_MODES        (WAKE_MAGIC |\\\n\t\t\t\t WAKE_PHY)\n\n#define AQ_NIC_CFG_RING_PER_TC(_NIC_CFG_) \\\n\t(((_NIC_CFG_)->tc_mode == AQ_TC_MODE_4TCS) ? 8 : 4)\n\n#define AQ_NIC_CFG_TCVEC2RING(_NIC_CFG_, _TC_, _VEC_) \\\n\t((_TC_) * AQ_NIC_CFG_RING_PER_TC(_NIC_CFG_) + (_VEC_))\n\n#define AQ_NIC_RING2QMAP(_NIC_, _ID_) \\\n\t((_ID_) / AQ_NIC_CFG_RING_PER_TC(&(_NIC_)->aq_nic_cfg) * \\\n\t\t(_NIC_)->aq_vecs + \\\n\t((_ID_) % AQ_NIC_CFG_RING_PER_TC(&(_NIC_)->aq_nic_cfg)))\n\nstruct aq_hw_rx_fl2 {\n\tstruct aq_rx_filter_vlan aq_vlans[AQ_VLAN_MAX_FILTERS];\n};\n\nstruct aq_hw_rx_fl3l4 {\n\tu8 active_ipv4;\n\tu8 active_ipv6:2;\n\tu8 is_ipv6;\n\tu8 reserved_count;\n};\n\nstruct aq_hw_rx_fltrs_s {\n\tstruct hlist_head     filter_list;\n\tu16                   active_filters;\n\tstruct aq_hw_rx_fl2   fl2;\n\tstruct aq_hw_rx_fl3l4 fl3l4;\n\t \n\tu8 fet_reserved_count;\n};\n\nstruct aq_nic_s {\n\tatomic_t flags;\n\tu32 msg_enable;\n\tstruct aq_vec_s *aq_vec[AQ_CFG_VECS_MAX];\n\tstruct aq_ring_s *aq_ring_tx[AQ_HW_QUEUES_MAX];\n\tstruct aq_hw_s *aq_hw;\n\tstruct bpf_prog *xdp_prog;\n\tstruct net_device *ndev;\n\tunsigned int aq_vecs;\n\tunsigned int packet_filter;\n\tunsigned int power_state;\n\tu8 port;\n\tconst struct aq_hw_ops *aq_hw_ops;\n\tconst struct aq_fw_ops *aq_fw_ops;\n\tstruct aq_nic_cfg_s aq_nic_cfg;\n\tstruct timer_list service_timer;\n\tstruct work_struct service_task;\n\tstruct timer_list polling_timer;\n\tstruct aq_hw_link_status_s link_status;\n\tstruct {\n\t\tu32 count;\n\t\tu8 ar[AQ_HW_MULTICAST_ADDRESS_MAX][ETH_ALEN];\n\t} mc_list;\n\t \n\tunsigned long active_vlans[BITS_TO_LONGS(VLAN_N_VID)];\n\n\tstruct pci_dev *pdev;\n\tunsigned int msix_entry_mask;\n\tu32 irqvecs;\n\t \n\tstruct mutex fwreq_mutex;\n#if IS_ENABLED(CONFIG_MACSEC)\n\tstruct aq_macsec_cfg *macsec_cfg;\n\t \n\tstruct mutex macsec_mutex;\n#endif\n\t \n\tstruct aq_ptp_s *aq_ptp;\n\tstruct aq_hw_rx_fltrs_s aq_hw_rx_fltrs;\n};\n\nstatic inline struct device *aq_nic_get_dev(struct aq_nic_s *self)\n{\n\treturn self->ndev->dev.parent;\n}\n\nvoid aq_nic_ndev_init(struct aq_nic_s *self);\nstruct aq_nic_s *aq_nic_alloc_hot(struct net_device *ndev);\nvoid aq_nic_set_tx_ring(struct aq_nic_s *self, unsigned int idx,\n\t\t\tstruct aq_ring_s *ring);\nstruct net_device *aq_nic_get_ndev(struct aq_nic_s *self);\nint aq_nic_init(struct aq_nic_s *self);\nvoid aq_nic_cfg_start(struct aq_nic_s *self);\nint aq_nic_ndev_register(struct aq_nic_s *self);\nvoid aq_nic_ndev_free(struct aq_nic_s *self);\nint aq_nic_start(struct aq_nic_s *self);\nunsigned int aq_nic_map_skb(struct aq_nic_s *self, struct sk_buff *skb,\n\t\t\t    struct aq_ring_s *ring);\nint aq_nic_xmit_xdpf(struct aq_nic_s *aq_nic, struct aq_ring_s *tx_ring,\n\t\t     struct xdp_frame *xdpf);\nint aq_nic_xmit(struct aq_nic_s *self, struct sk_buff *skb);\nint aq_nic_get_regs(struct aq_nic_s *self, struct ethtool_regs *regs, void *p);\nint aq_nic_get_regs_count(struct aq_nic_s *self);\nu64 *aq_nic_get_stats(struct aq_nic_s *self, u64 *data);\nint aq_nic_stop(struct aq_nic_s *self);\nvoid aq_nic_deinit(struct aq_nic_s *self, bool link_down);\nvoid aq_nic_set_power(struct aq_nic_s *self);\nvoid aq_nic_free_hot_resources(struct aq_nic_s *self);\nvoid aq_nic_free_vectors(struct aq_nic_s *self);\nint aq_nic_realloc_vectors(struct aq_nic_s *self);\nint aq_nic_set_mtu(struct aq_nic_s *self, int new_mtu);\nint aq_nic_set_mac(struct aq_nic_s *self, struct net_device *ndev);\nint aq_nic_set_packet_filter(struct aq_nic_s *self, unsigned int flags);\nint aq_nic_set_multicast_list(struct aq_nic_s *self, struct net_device *ndev);\nunsigned int aq_nic_get_link_speed(struct aq_nic_s *self);\nvoid aq_nic_get_link_ksettings(struct aq_nic_s *self,\n\t\t\t       struct ethtool_link_ksettings *cmd);\nint aq_nic_set_link_ksettings(struct aq_nic_s *self,\n\t\t\t      const struct ethtool_link_ksettings *cmd);\nstruct aq_nic_cfg_s *aq_nic_get_cfg(struct aq_nic_s *self);\nu32 aq_nic_get_fw_version(struct aq_nic_s *self);\nint aq_nic_set_loopback(struct aq_nic_s *self);\nint aq_nic_set_downshift(struct aq_nic_s *self, int val);\nint aq_nic_set_media_detect(struct aq_nic_s *self, int val);\nint aq_nic_update_interrupt_moderation_settings(struct aq_nic_s *self);\nvoid aq_nic_shutdown(struct aq_nic_s *self);\nu8 aq_nic_reserve_filter(struct aq_nic_s *self, enum aq_rx_filter_type type);\nvoid aq_nic_release_filter(struct aq_nic_s *self, enum aq_rx_filter_type type,\n\t\t\t   u32 location);\nint aq_nic_setup_tc_mqprio(struct aq_nic_s *self, u32 tcs, u8 *prio_tc_map);\nint aq_nic_setup_tc_max_rate(struct aq_nic_s *self, const unsigned int tc,\n\t\t\t     const u32 max_rate);\nint aq_nic_setup_tc_min_rate(struct aq_nic_s *self, const unsigned int tc,\n\t\t\t     const u32 min_rate);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}