{
  "module_name": "aq_ring.h",
  "hash_id": "dc2203d3cc28f003d1e6d47edff517b1c5e7e17f482f972a8dc4fc6496c2c8c7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/aquantia/atlantic/aq_ring.h",
  "human_readable_source": " \n \n\n \n\n#ifndef AQ_RING_H\n#define AQ_RING_H\n\n#include \"aq_common.h\"\n#include \"aq_vec.h\"\n\n#define AQ_XDP_HEADROOM\t\tALIGN(max(NET_SKB_PAD, XDP_PACKET_HEADROOM), 8)\n#define AQ_XDP_TAILROOM\t\tSKB_DATA_ALIGN(sizeof(struct skb_shared_info))\n\nstruct page;\nstruct aq_nic_cfg_s;\n\nstruct aq_rxpage {\n\tstruct page *page;\n\tdma_addr_t daddr;\n\tunsigned int order;\n\tunsigned int pg_off;\n};\n\n \nstruct __packed aq_ring_buff_s {\n\tunion {\n\t\t \n\t\tdma_addr_t pa;\n\t\t \n\t\tstruct {\n\t\t\tu32 rss_hash;\n\t\t\tu16 next;\n\t\t\tu8 is_hash_l4;\n\t\t\tu8 rsvd1;\n\t\t\tstruct aq_rxpage rxdata;\n\t\t\tu16 vlan_rx_tag;\n\t\t};\n\t\t \n\t\tstruct {\n\t\t\tdma_addr_t pa_eop;\n\t\t\tstruct sk_buff *skb;\n\t\t\tstruct xdp_frame *xdpf;\n\t\t};\n\t\t \n\t\tstruct {\n\t\t\tu32 mss;\n\t\t\tu8 len_l2;\n\t\t\tu8 len_l3;\n\t\t\tu8 len_l4;\n\t\t\tu8 is_ipv6:1;\n\t\t\tu8 rsvd2:7;\n\t\t\tu32 len_pkt;\n\t\t\tu16 vlan_tx_tag;\n\t\t};\n\t};\n\tunion {\n\t\tstruct {\n\t\t\tu32 len:16;\n\t\t\tu32 is_ip_cso:1;\n\t\t\tu32 is_udp_cso:1;\n\t\t\tu32 is_tcp_cso:1;\n\t\t\tu32 is_cso_err:1;\n\t\t\tu32 is_sop:1;\n\t\t\tu32 is_eop:1;\n\t\t\tu32 is_gso_tcp:1;\n\t\t\tu32 is_gso_udp:1;\n\t\t\tu32 is_mapped:1;\n\t\t\tu32 is_cleaned:1;\n\t\t\tu32 is_error:1;\n\t\t\tu32 is_vlan:1;\n\t\t\tu32 is_lro:1;\n\t\t\tu32 rsvd3:3;\n\t\t\tu16 eop_index;\n\t\t\tu16 rsvd4;\n\t\t};\n\t\tu64 flags;\n\t};\n};\n\nstruct aq_ring_stats_rx_s {\n\tstruct u64_stats_sync syncp;\t \n\tu64 errors;\n\tu64 packets;\n\tu64 bytes;\n\tu64 lro_packets;\n\tu64 jumbo_packets;\n\tu64 alloc_fails;\n\tu64 skb_alloc_fails;\n\tu64 polls;\n\tu64 pg_losts;\n\tu64 pg_flips;\n\tu64 pg_reuses;\n\tu64 xdp_aborted;\n\tu64 xdp_drop;\n\tu64 xdp_pass;\n\tu64 xdp_tx;\n\tu64 xdp_invalid;\n\tu64 xdp_redirect;\n};\n\nstruct aq_ring_stats_tx_s {\n\tstruct u64_stats_sync syncp;\t \n\tu64 errors;\n\tu64 packets;\n\tu64 bytes;\n\tu64 queue_restarts;\n};\n\nunion aq_ring_stats_s {\n\tstruct aq_ring_stats_rx_s rx;\n\tstruct aq_ring_stats_tx_s tx;\n};\n\nenum atl_ring_type {\n\tATL_RING_TX,\n\tATL_RING_RX,\n};\n\nstruct aq_ring_s {\n\tstruct aq_ring_buff_s *buff_ring;\n\tu8 *dx_ring;\t\t \n\tstruct aq_nic_s *aq_nic;\n\tunsigned int idx;\t \n\tunsigned int hw_head;\n\tunsigned int sw_head;\n\tunsigned int sw_tail;\n\tunsigned int size;\t \n\tunsigned int dx_size;\t \n\t\t\t\t \n\tu16 page_order;\n\tu16 page_offset;\n\tu16 frame_max;\n\tu16 tail_size;\n\tunion aq_ring_stats_s stats;\n\tdma_addr_t dx_ring_pa;\n\tstruct bpf_prog *xdp_prog;\n\tenum atl_ring_type ring_type;\n\tstruct xdp_rxq_info xdp_rxq;\n};\n\nstruct aq_ring_param_s {\n\tunsigned int vec_idx;\n\tunsigned int cpu;\n\tcpumask_t affinity_mask;\n};\n\nstatic inline void *aq_buf_vaddr(struct aq_rxpage *rxpage)\n{\n\treturn page_to_virt(rxpage->page) + rxpage->pg_off;\n}\n\nstatic inline dma_addr_t aq_buf_daddr(struct aq_rxpage *rxpage)\n{\n\treturn rxpage->daddr + rxpage->pg_off;\n}\n\nstatic inline unsigned int aq_ring_next_dx(struct aq_ring_s *self,\n\t\t\t\t\t   unsigned int dx)\n{\n\treturn (++dx >= self->size) ? 0U : dx;\n}\n\nstatic inline unsigned int aq_ring_avail_dx(struct aq_ring_s *self)\n{\n\treturn (((self->sw_tail >= self->sw_head)) ?\n\t\t(self->size - 1) - self->sw_tail + self->sw_head :\n\t\tself->sw_head - self->sw_tail - 1);\n}\n\nstruct aq_ring_s *aq_ring_tx_alloc(struct aq_ring_s *self,\n\t\t\t\t   struct aq_nic_s *aq_nic,\n\t\t\t\t   unsigned int idx,\n\t\t\t\t   struct aq_nic_cfg_s *aq_nic_cfg);\nstruct aq_ring_s *aq_ring_rx_alloc(struct aq_ring_s *self,\n\t\t\t\t   struct aq_nic_s *aq_nic,\n\t\t\t\t   unsigned int idx,\n\t\t\t\t   struct aq_nic_cfg_s *aq_nic_cfg);\n\nint aq_ring_init(struct aq_ring_s *self, const enum atl_ring_type ring_type);\nvoid aq_ring_rx_deinit(struct aq_ring_s *self);\nvoid aq_ring_free(struct aq_ring_s *self);\nvoid aq_ring_update_queue_state(struct aq_ring_s *ring);\nvoid aq_ring_queue_wake(struct aq_ring_s *ring);\nvoid aq_ring_queue_stop(struct aq_ring_s *ring);\nbool aq_ring_tx_clean(struct aq_ring_s *self);\nint aq_xdp_xmit(struct net_device *dev, int num_frames,\n\t\tstruct xdp_frame **frames, u32 flags);\nint aq_ring_rx_clean(struct aq_ring_s *self,\n\t\t     struct napi_struct *napi,\n\t\t     int *work_done,\n\t\t     int budget);\nint aq_ring_rx_fill(struct aq_ring_s *self);\n\nstruct aq_ring_s *aq_ring_hwts_rx_alloc(struct aq_ring_s *self,\n\t\tstruct aq_nic_s *aq_nic, unsigned int idx,\n\t\tunsigned int size, unsigned int dx_size);\nvoid aq_ring_hwts_rx_clean(struct aq_ring_s *self, struct aq_nic_s *aq_nic);\n\nunsigned int aq_ring_fill_stats_data(struct aq_ring_s *self, u64 *data);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}