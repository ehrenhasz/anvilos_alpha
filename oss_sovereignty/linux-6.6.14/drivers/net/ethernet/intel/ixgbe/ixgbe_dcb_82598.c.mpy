{
  "module_name": "ixgbe_dcb_82598.c",
  "hash_id": "fd76db3a9ce5c9cbbc4e7950d3a7a9a5b7c0a1e9b4a4f6712f80985befe86595",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/intel/ixgbe/ixgbe_dcb_82598.c",
  "human_readable_source": "\n \n\n#include \"ixgbe.h\"\n#include \"ixgbe_type.h\"\n#include \"ixgbe_dcb.h\"\n#include \"ixgbe_dcb_82598.h\"\n\n \ns32 ixgbe_dcb_config_rx_arbiter_82598(struct ixgbe_hw *hw,\n\t\t\t\t\tu16 *refill,\n\t\t\t\t\tu16 *max,\n\t\t\t\t\tu8 *prio_type)\n{\n\tu32    reg           = 0;\n\tu32    credit_refill = 0;\n\tu32    credit_max    = 0;\n\tu8     i             = 0;\n\n\treg = IXGBE_READ_REG(hw, IXGBE_RUPPBMR) | IXGBE_RUPPBMR_MQA;\n\tIXGBE_WRITE_REG(hw, IXGBE_RUPPBMR, reg);\n\n\treg = IXGBE_READ_REG(hw, IXGBE_RMCS);\n\t \n\treg &= ~IXGBE_RMCS_ARBDIS;\n\t \n\treg |= IXGBE_RMCS_RRM;\n\t \n\treg |= IXGBE_RMCS_DFP;\n\n\tIXGBE_WRITE_REG(hw, IXGBE_RMCS, reg);\n\n\t \n\tfor (i = 0; i < MAX_TRAFFIC_CLASS; i++) {\n\t\tcredit_refill = refill[i];\n\t\tcredit_max    = max[i];\n\n\t\treg = credit_refill | (credit_max << IXGBE_RT2CR_MCL_SHIFT);\n\n\t\tif (prio_type[i] == prio_link)\n\t\t\treg |= IXGBE_RT2CR_LSP;\n\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RT2CR(i), reg);\n\t}\n\n\treg = IXGBE_READ_REG(hw, IXGBE_RDRXCTL);\n\treg |= IXGBE_RDRXCTL_RDMTS_1_2;\n\treg |= IXGBE_RDRXCTL_MPBEN;\n\treg |= IXGBE_RDRXCTL_MCEN;\n\tIXGBE_WRITE_REG(hw, IXGBE_RDRXCTL, reg);\n\n\treg = IXGBE_READ_REG(hw, IXGBE_RXCTRL);\n\t \n\treg &= ~IXGBE_RXCTRL_DMBYPS;\n\tIXGBE_WRITE_REG(hw, IXGBE_RXCTRL, reg);\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_config_tx_desc_arbiter_82598(struct ixgbe_hw *hw,\n\t\t\t\t\t\tu16 *refill,\n\t\t\t\t\t\tu16 *max,\n\t\t\t\t\t\tu8 *bwg_id,\n\t\t\t\t\t\tu8 *prio_type)\n{\n\tu32    reg, max_credits;\n\tu8     i;\n\n\treg = IXGBE_READ_REG(hw, IXGBE_DPMCS);\n\n\t \n\treg &= ~IXGBE_DPMCS_ARBDIS;\n\treg |= IXGBE_DPMCS_TSOEF;\n\n\t \n\treg |= (0x4 << IXGBE_DPMCS_MTSOS_SHIFT);\n\n\tIXGBE_WRITE_REG(hw, IXGBE_DPMCS, reg);\n\n\t \n\tfor (i = 0; i < MAX_TRAFFIC_CLASS; i++) {\n\t\tmax_credits = max[i];\n\t\treg = max_credits << IXGBE_TDTQ2TCCR_MCL_SHIFT;\n\t\treg |= refill[i];\n\t\treg |= (u32)(bwg_id[i]) << IXGBE_TDTQ2TCCR_BWG_SHIFT;\n\n\t\tif (prio_type[i] == prio_group)\n\t\t\treg |= IXGBE_TDTQ2TCCR_GSP;\n\n\t\tif (prio_type[i] == prio_link)\n\t\t\treg |= IXGBE_TDTQ2TCCR_LSP;\n\n\t\tIXGBE_WRITE_REG(hw, IXGBE_TDTQ2TCCR(i), reg);\n\t}\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_config_tx_data_arbiter_82598(struct ixgbe_hw *hw,\n\t\t\t\t\t\tu16 *refill,\n\t\t\t\t\t\tu16 *max,\n\t\t\t\t\t\tu8 *bwg_id,\n\t\t\t\t\t\tu8 *prio_type)\n{\n\tu32 reg;\n\tu8 i;\n\n\treg = IXGBE_READ_REG(hw, IXGBE_PDPMCS);\n\t \n\treg &= ~IXGBE_PDPMCS_ARBDIS;\n\t \n\treg |= (IXGBE_PDPMCS_TPPAC | IXGBE_PDPMCS_TRM);\n\n\tIXGBE_WRITE_REG(hw, IXGBE_PDPMCS, reg);\n\n\t \n\tfor (i = 0; i < MAX_TRAFFIC_CLASS; i++) {\n\t\treg = refill[i];\n\t\treg |= (u32)(max[i]) << IXGBE_TDPT2TCCR_MCL_SHIFT;\n\t\treg |= (u32)(bwg_id[i]) << IXGBE_TDPT2TCCR_BWG_SHIFT;\n\n\t\tif (prio_type[i] == prio_group)\n\t\t\treg |= IXGBE_TDPT2TCCR_GSP;\n\n\t\tif (prio_type[i] == prio_link)\n\t\t\treg |= IXGBE_TDPT2TCCR_LSP;\n\n\t\tIXGBE_WRITE_REG(hw, IXGBE_TDPT2TCCR(i), reg);\n\t}\n\n\t \n\treg = IXGBE_READ_REG(hw, IXGBE_DTXCTL);\n\treg |= IXGBE_DTXCTL_ENDBUBD;\n\tIXGBE_WRITE_REG(hw, IXGBE_DTXCTL, reg);\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_config_pfc_82598(struct ixgbe_hw *hw, u8 pfc_en)\n{\n\tu32 fcrtl, reg;\n\tu8  i;\n\n\t \n\treg = IXGBE_READ_REG(hw, IXGBE_RMCS);\n\treg &= ~IXGBE_RMCS_TFCE_802_3X;\n\treg |= IXGBE_RMCS_TFCE_PRIORITY;\n\tIXGBE_WRITE_REG(hw, IXGBE_RMCS, reg);\n\n\t \n\treg = IXGBE_READ_REG(hw, IXGBE_FCTRL);\n\treg &= ~(IXGBE_FCTRL_RPFCE | IXGBE_FCTRL_RFCE);\n\n\tif (pfc_en)\n\t\treg |= IXGBE_FCTRL_RPFCE;\n\n\tIXGBE_WRITE_REG(hw, IXGBE_FCTRL, reg);\n\n\t \n\tfor (i = 0; i < MAX_TRAFFIC_CLASS; i++) {\n\t\tif (!(pfc_en & BIT(i))) {\n\t\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTL(i), 0);\n\t\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTH(i), 0);\n\t\t\tcontinue;\n\t\t}\n\n\t\tfcrtl = (hw->fc.low_water[i] << 10) | IXGBE_FCRTL_XONE;\n\t\treg = (hw->fc.high_water[i] << 10) | IXGBE_FCRTH_FCEN;\n\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTL(i), fcrtl);\n\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTH(i), reg);\n\t}\n\n\t \n\treg = hw->fc.pause_time * 0x00010001;\n\tfor (i = 0; i < (MAX_TRAFFIC_CLASS / 2); i++)\n\t\tIXGBE_WRITE_REG(hw, IXGBE_FCTTV(i), reg);\n\n\t \n\tIXGBE_WRITE_REG(hw, IXGBE_FCRTV, hw->fc.pause_time / 2);\n\n\n\treturn 0;\n}\n\n \nstatic s32 ixgbe_dcb_config_tc_stats_82598(struct ixgbe_hw *hw)\n{\n\tu32 reg = 0;\n\tu8  i   = 0;\n\tu8  j   = 0;\n\n\t \n\tfor (i = 0, j = 0; i < 15 && j < 8; i = i + 2, j++) {\n\t\treg = IXGBE_READ_REG(hw, IXGBE_RQSMR(i));\n\t\treg |= ((0x1010101) * j);\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RQSMR(i), reg);\n\t\treg = IXGBE_READ_REG(hw, IXGBE_RQSMR(i + 1));\n\t\treg |= ((0x1010101) * j);\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RQSMR(i + 1), reg);\n\t}\n\t \n\tfor (i = 0; i < 8; i++) {\n\t\treg = IXGBE_READ_REG(hw, IXGBE_TQSMR(i));\n\t\treg |= ((0x1010101) * i);\n\t\tIXGBE_WRITE_REG(hw, IXGBE_TQSMR(i), reg);\n\t}\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_hw_config_82598(struct ixgbe_hw *hw, u8 pfc_en, u16 *refill,\n\t\t\t      u16 *max, u8 *bwg_id, u8 *prio_type)\n{\n\tixgbe_dcb_config_rx_arbiter_82598(hw, refill, max, prio_type);\n\tixgbe_dcb_config_tx_desc_arbiter_82598(hw, refill, max,\n\t\t\t\t\t       bwg_id, prio_type);\n\tixgbe_dcb_config_tx_data_arbiter_82598(hw, refill, max,\n\t\t\t\t\t       bwg_id, prio_type);\n\tixgbe_dcb_config_pfc_82598(hw, pfc_en);\n\tixgbe_dcb_config_tc_stats_82598(hw);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}