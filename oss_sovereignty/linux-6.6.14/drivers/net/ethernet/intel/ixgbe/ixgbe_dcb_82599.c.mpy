{
  "module_name": "ixgbe_dcb_82599.c",
  "hash_id": "5cbea233020def2b9b05ebf46b76ab481315f02bfe4c297c4c954763ae64e853",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/intel/ixgbe/ixgbe_dcb_82599.c",
  "human_readable_source": "\n \n\n#include \"ixgbe.h\"\n#include \"ixgbe_type.h\"\n#include \"ixgbe_dcb.h\"\n#include \"ixgbe_dcb_82599.h\"\n\n \ns32 ixgbe_dcb_config_rx_arbiter_82599(struct ixgbe_hw *hw,\n\t\t\t\t      u16 *refill,\n\t\t\t\t      u16 *max,\n\t\t\t\t      u8 *bwg_id,\n\t\t\t\t      u8 *prio_type,\n\t\t\t\t      u8 *prio_tc)\n{\n\tu32    reg           = 0;\n\tu32    credit_refill = 0;\n\tu32    credit_max    = 0;\n\tu8     i             = 0;\n\n\t \n\treg = IXGBE_RTRPCS_RRM | IXGBE_RTRPCS_RAC | IXGBE_RTRPCS_ARBDIS;\n\tIXGBE_WRITE_REG(hw, IXGBE_RTRPCS, reg);\n\n\t \n\treg = 0;\n\tfor (i = 0; i < MAX_USER_PRIORITY; i++)\n\t\treg |= (prio_tc[i] << (i * IXGBE_RTRUP2TC_UP_SHIFT));\n\tIXGBE_WRITE_REG(hw, IXGBE_RTRUP2TC, reg);\n\n\t \n\tfor (i = 0; i < MAX_TRAFFIC_CLASS; i++) {\n\t\tcredit_refill = refill[i];\n\t\tcredit_max    = max[i];\n\t\treg = credit_refill | (credit_max << IXGBE_RTRPT4C_MCL_SHIFT);\n\n\t\treg |= (u32)(bwg_id[i]) << IXGBE_RTRPT4C_BWG_SHIFT;\n\n\t\tif (prio_type[i] == prio_link)\n\t\t\treg |= IXGBE_RTRPT4C_LSP;\n\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RTRPT4C(i), reg);\n\t}\n\n\t \n\treg = IXGBE_RTRPCS_RRM | IXGBE_RTRPCS_RAC;\n\tIXGBE_WRITE_REG(hw, IXGBE_RTRPCS, reg);\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_config_tx_desc_arbiter_82599(struct ixgbe_hw *hw,\n\t\t\t\t\t   u16 *refill,\n\t\t\t\t\t   u16 *max,\n\t\t\t\t\t   u8 *bwg_id,\n\t\t\t\t\t   u8 *prio_type)\n{\n\tu32    reg, max_credits;\n\tu8     i;\n\n\t \n\tfor (i = 0; i < 128; i++) {\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RTTDQSEL, i);\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RTTDT1C, 0);\n\t}\n\n\t \n\tfor (i = 0; i < MAX_TRAFFIC_CLASS; i++) {\n\t\tmax_credits = max[i];\n\t\treg = max_credits << IXGBE_RTTDT2C_MCL_SHIFT;\n\t\treg |= refill[i];\n\t\treg |= (u32)(bwg_id[i]) << IXGBE_RTTDT2C_BWG_SHIFT;\n\n\t\tif (prio_type[i] == prio_group)\n\t\t\treg |= IXGBE_RTTDT2C_GSP;\n\n\t\tif (prio_type[i] == prio_link)\n\t\t\treg |= IXGBE_RTTDT2C_LSP;\n\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RTTDT2C(i), reg);\n\t}\n\n\t \n\treg = IXGBE_RTTDCS_TDPAC | IXGBE_RTTDCS_TDRM;\n\tIXGBE_WRITE_REG(hw, IXGBE_RTTDCS, reg);\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_config_tx_data_arbiter_82599(struct ixgbe_hw *hw,\n\t\t\t\t\t   u16 *refill,\n\t\t\t\t\t   u16 *max,\n\t\t\t\t\t   u8 *bwg_id,\n\t\t\t\t\t   u8 *prio_type,\n\t\t\t\t\t   u8 *prio_tc)\n{\n\tu32 reg;\n\tu8 i;\n\n\t \n\treg = IXGBE_RTTPCS_TPPAC | IXGBE_RTTPCS_TPRM |\n\t      (IXGBE_RTTPCS_ARBD_DCB << IXGBE_RTTPCS_ARBD_SHIFT) |\n\t      IXGBE_RTTPCS_ARBDIS;\n\tIXGBE_WRITE_REG(hw, IXGBE_RTTPCS, reg);\n\n\t \n\treg = 0;\n\tfor (i = 0; i < MAX_USER_PRIORITY; i++)\n\t\treg |= (prio_tc[i] << (i * IXGBE_RTTUP2TC_UP_SHIFT));\n\tIXGBE_WRITE_REG(hw, IXGBE_RTTUP2TC, reg);\n\n\t \n\tfor (i = 0; i < MAX_TRAFFIC_CLASS; i++) {\n\t\treg = refill[i];\n\t\treg |= (u32)(max[i]) << IXGBE_RTTPT2C_MCL_SHIFT;\n\t\treg |= (u32)(bwg_id[i]) << IXGBE_RTTPT2C_BWG_SHIFT;\n\n\t\tif (prio_type[i] == prio_group)\n\t\t\treg |= IXGBE_RTTPT2C_GSP;\n\n\t\tif (prio_type[i] == prio_link)\n\t\t\treg |= IXGBE_RTTPT2C_LSP;\n\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RTTPT2C(i), reg);\n\t}\n\n\t \n\treg = IXGBE_RTTPCS_TPPAC | IXGBE_RTTPCS_TPRM |\n\t      (IXGBE_RTTPCS_ARBD_DCB << IXGBE_RTTPCS_ARBD_SHIFT);\n\tIXGBE_WRITE_REG(hw, IXGBE_RTTPCS, reg);\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_config_pfc_82599(struct ixgbe_hw *hw, u8 pfc_en, u8 *prio_tc)\n{\n\tu32 i, j, fcrtl, reg;\n\tu8 max_tc = 0;\n\n\t \n\tIXGBE_WRITE_REG(hw, IXGBE_FCCFG, IXGBE_FCCFG_TFCE_PRIORITY);\n\n\t \n\treg = IXGBE_READ_REG(hw, IXGBE_MFLCN);\n\treg |= IXGBE_MFLCN_DPF;\n\n\t \n\treg &= ~(IXGBE_MFLCN_RPFCE_MASK | IXGBE_MFLCN_RFCE);\n\n\tif (hw->mac.type >= ixgbe_mac_X540)\n\t\treg |= pfc_en << IXGBE_MFLCN_RPFCE_SHIFT;\n\n\tif (pfc_en)\n\t\treg |= IXGBE_MFLCN_RPFCE;\n\n\tIXGBE_WRITE_REG(hw, IXGBE_MFLCN, reg);\n\n\tfor (i = 0; i < MAX_USER_PRIORITY; i++) {\n\t\tif (prio_tc[i] > max_tc)\n\t\t\tmax_tc = prio_tc[i];\n\t}\n\n\n\t \n\tfor (i = 0; i <= max_tc; i++) {\n\t\tint enabled = 0;\n\n\t\tfor (j = 0; j < MAX_USER_PRIORITY; j++) {\n\t\t\tif ((prio_tc[j] == i) && (pfc_en & BIT(j))) {\n\t\t\t\tenabled = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (enabled) {\n\t\t\treg = (hw->fc.high_water[i] << 10) | IXGBE_FCRTH_FCEN;\n\t\t\tfcrtl = (hw->fc.low_water[i] << 10) | IXGBE_FCRTL_XONE;\n\t\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTL_82599(i), fcrtl);\n\t\t} else {\n\t\t\t \n\t\t\treg = IXGBE_READ_REG(hw, IXGBE_RXPBSIZE(i)) - 24576;\n\t\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTL_82599(i), 0);\n\t\t}\n\n\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTH_82599(i), reg);\n\t}\n\n\tfor (; i < MAX_TRAFFIC_CLASS; i++) {\n\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTL_82599(i), 0);\n\t\tIXGBE_WRITE_REG(hw, IXGBE_FCRTH_82599(i), 0);\n\t}\n\n\t \n\treg = hw->fc.pause_time * 0x00010001;\n\tfor (i = 0; i < (MAX_TRAFFIC_CLASS / 2); i++)\n\t\tIXGBE_WRITE_REG(hw, IXGBE_FCTTV(i), reg);\n\n\t \n\tIXGBE_WRITE_REG(hw, IXGBE_FCRTV, hw->fc.pause_time / 2);\n\n\treturn 0;\n}\n\n \nstatic s32 ixgbe_dcb_config_tc_stats_82599(struct ixgbe_hw *hw)\n{\n\tu32 reg = 0;\n\tu8  i   = 0;\n\n\t \n\tfor (i = 0; i < 32; i++) {\n\t\treg = 0x01010101 * (i / 4);\n\t\tIXGBE_WRITE_REG(hw, IXGBE_RQSMR(i), reg);\n\t}\n\t \n\tfor (i = 0; i < 32; i++) {\n\t\tif (i < 8)\n\t\t\treg = 0x00000000;\n\t\telse if (i < 16)\n\t\t\treg = 0x01010101;\n\t\telse if (i < 20)\n\t\t\treg = 0x02020202;\n\t\telse if (i < 24)\n\t\t\treg = 0x03030303;\n\t\telse if (i < 26)\n\t\t\treg = 0x04040404;\n\t\telse if (i < 28)\n\t\t\treg = 0x05050505;\n\t\telse if (i < 30)\n\t\t\treg = 0x06060606;\n\t\telse\n\t\t\treg = 0x07070707;\n\t\tIXGBE_WRITE_REG(hw, IXGBE_TQSM(i), reg);\n\t}\n\n\treturn 0;\n}\n\n \ns32 ixgbe_dcb_hw_config_82599(struct ixgbe_hw *hw, u8 pfc_en, u16 *refill,\n\t\t\t      u16 *max, u8 *bwg_id, u8 *prio_type, u8 *prio_tc)\n{\n\tixgbe_dcb_config_rx_arbiter_82599(hw, refill, max, bwg_id,\n\t\t\t\t\t  prio_type, prio_tc);\n\tixgbe_dcb_config_tx_desc_arbiter_82599(hw, refill, max,\n\t\t\t\t\t       bwg_id, prio_type);\n\tixgbe_dcb_config_tx_data_arbiter_82599(hw, refill, max,\n\t\t\t\t\t       bwg_id, prio_type, prio_tc);\n\tixgbe_dcb_config_pfc_82599(hw, pfc_en, prio_tc);\n\tixgbe_dcb_config_tc_stats_82599(hw);\n\n\treturn 0;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}