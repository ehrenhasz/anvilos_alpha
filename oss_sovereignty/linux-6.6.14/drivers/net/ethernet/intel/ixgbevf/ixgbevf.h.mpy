{
  "module_name": "ixgbevf.h",
  "hash_id": "1a151ee75acbcc57aed0822e4e2ccd4637495b68202195e923b84650cd88d35b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/intel/ixgbevf/ixgbevf.h",
  "human_readable_source": " \n \n\n#ifndef _IXGBEVF_H_\n#define _IXGBEVF_H_\n\n#include <linux/types.h>\n#include <linux/bitops.h>\n#include <linux/timer.h>\n#include <linux/io.h>\n#include <linux/netdevice.h>\n#include <linux/if_vlan.h>\n#include <linux/u64_stats_sync.h>\n#include <net/xdp.h>\n\n#include \"vf.h\"\n#include \"ipsec.h\"\n\n#define IXGBE_MAX_TXD_PWR\t14\n#define IXGBE_MAX_DATA_PER_TXD\tBIT(IXGBE_MAX_TXD_PWR)\n\n \n#define TXD_USE_COUNT(S) DIV_ROUND_UP((S), IXGBE_MAX_DATA_PER_TXD)\n#define DESC_NEEDED (MAX_SKB_FRAGS + 4)\n\n \nstruct ixgbevf_tx_buffer {\n\tunion ixgbe_adv_tx_desc *next_to_watch;\n\tunsigned long time_stamp;\n\tunion {\n\t\tstruct sk_buff *skb;\n\t\t \n\t\tvoid *data;\n\t};\n\tunsigned int bytecount;\n\tunsigned short gso_segs;\n\t__be16 protocol;\n\tDEFINE_DMA_UNMAP_ADDR(dma);\n\tDEFINE_DMA_UNMAP_LEN(len);\n\tu32 tx_flags;\n};\n\nstruct ixgbevf_rx_buffer {\n\tdma_addr_t dma;\n\tstruct page *page;\n#if (BITS_PER_LONG > 32) || (PAGE_SIZE >= 65536)\n\t__u32 page_offset;\n#else\n\t__u16 page_offset;\n#endif\n\t__u16 pagecnt_bias;\n};\n\nstruct ixgbevf_stats {\n\tu64 packets;\n\tu64 bytes;\n};\n\nstruct ixgbevf_tx_queue_stats {\n\tu64 restart_queue;\n\tu64 tx_busy;\n\tu64 tx_done_old;\n};\n\nstruct ixgbevf_rx_queue_stats {\n\tu64 alloc_rx_page_failed;\n\tu64 alloc_rx_buff_failed;\n\tu64 alloc_rx_page;\n\tu64 csum_err;\n};\n\nenum ixgbevf_ring_state_t {\n\t__IXGBEVF_RX_3K_BUFFER,\n\t__IXGBEVF_RX_BUILD_SKB_ENABLED,\n\t__IXGBEVF_TX_DETECT_HANG,\n\t__IXGBEVF_HANG_CHECK_ARMED,\n\t__IXGBEVF_TX_XDP_RING,\n\t__IXGBEVF_TX_XDP_RING_PRIMED,\n};\n\n#define ring_is_xdp(ring) \\\n\t\ttest_bit(__IXGBEVF_TX_XDP_RING, &(ring)->state)\n#define set_ring_xdp(ring) \\\n\t\tset_bit(__IXGBEVF_TX_XDP_RING, &(ring)->state)\n#define clear_ring_xdp(ring) \\\n\t\tclear_bit(__IXGBEVF_TX_XDP_RING, &(ring)->state)\n\nstruct ixgbevf_ring {\n\tstruct ixgbevf_ring *next;\n\tstruct ixgbevf_q_vector *q_vector;\t \n\tstruct net_device *netdev;\n\tstruct bpf_prog *xdp_prog;\n\tstruct device *dev;\n\tvoid *desc;\t\t\t \n\tdma_addr_t dma;\t\t\t \n\tunsigned int size;\t\t \n\tu16 count;\t\t\t \n\tu16 next_to_use;\n\tu16 next_to_clean;\n\tu16 next_to_alloc;\n\n\tunion {\n\t\tstruct ixgbevf_tx_buffer *tx_buffer_info;\n\t\tstruct ixgbevf_rx_buffer *rx_buffer_info;\n\t};\n\tunsigned long state;\n\tstruct ixgbevf_stats stats;\n\tstruct u64_stats_sync syncp;\n\tunion {\n\t\tstruct ixgbevf_tx_queue_stats tx_stats;\n\t\tstruct ixgbevf_rx_queue_stats rx_stats;\n\t};\n\tstruct xdp_rxq_info xdp_rxq;\n\tu64 hw_csum_rx_error;\n\tu8 __iomem *tail;\n\tstruct sk_buff *skb;\n\n\t \n\tu16 reg_idx;\n\tint queue_index;  \n} ____cacheline_internodealigned_in_smp;\n\n \n#define IXGBEVF_RX_BUFFER_WRITE\t16\t \n\n#define MAX_RX_QUEUES IXGBE_VF_MAX_RX_QUEUES\n#define MAX_TX_QUEUES IXGBE_VF_MAX_TX_QUEUES\n#define MAX_XDP_QUEUES IXGBE_VF_MAX_TX_QUEUES\n#define IXGBEVF_MAX_RSS_QUEUES\t\t2\n#define IXGBEVF_82599_RETA_SIZE\t\t128\t \n#define IXGBEVF_X550_VFRETA_SIZE\t64\t \n#define IXGBEVF_RSS_HASH_KEY_SIZE\t40\n#define IXGBEVF_VFRSSRK_REGS\t\t10\t \n\n#define IXGBEVF_DEFAULT_TXD\t1024\n#define IXGBEVF_DEFAULT_RXD\t512\n#define IXGBEVF_MAX_TXD\t\t4096\n#define IXGBEVF_MIN_TXD\t\t64\n#define IXGBEVF_MAX_RXD\t\t4096\n#define IXGBEVF_MIN_RXD\t\t64\n\n \n#define IXGBEVF_RXBUFFER_256\t256     \n#define IXGBEVF_RXBUFFER_2048\t2048\n#define IXGBEVF_RXBUFFER_3072\t3072\n\n#define IXGBEVF_RX_HDR_SIZE\tIXGBEVF_RXBUFFER_256\n\n#define MAXIMUM_ETHERNET_VLAN_SIZE (VLAN_ETH_FRAME_LEN + ETH_FCS_LEN)\n\n#define IXGBEVF_SKB_PAD\t\t(NET_SKB_PAD + NET_IP_ALIGN)\n#if (PAGE_SIZE < 8192)\n#define IXGBEVF_MAX_FRAME_BUILD_SKB \\\n\t(SKB_WITH_OVERHEAD(IXGBEVF_RXBUFFER_2048) - IXGBEVF_SKB_PAD)\n#else\n#define IXGBEVF_MAX_FRAME_BUILD_SKB\tIXGBEVF_RXBUFFER_2048\n#endif\n\n#define IXGBE_TX_FLAGS_CSUM\t\tBIT(0)\n#define IXGBE_TX_FLAGS_VLAN\t\tBIT(1)\n#define IXGBE_TX_FLAGS_TSO\t\tBIT(2)\n#define IXGBE_TX_FLAGS_IPV4\t\tBIT(3)\n#define IXGBE_TX_FLAGS_IPSEC\t\tBIT(4)\n#define IXGBE_TX_FLAGS_VLAN_MASK\t0xffff0000\n#define IXGBE_TX_FLAGS_VLAN_PRIO_MASK\t0x0000e000\n#define IXGBE_TX_FLAGS_VLAN_SHIFT\t16\n\n#define ring_uses_large_buffer(ring) \\\n\ttest_bit(__IXGBEVF_RX_3K_BUFFER, &(ring)->state)\n#define set_ring_uses_large_buffer(ring) \\\n\tset_bit(__IXGBEVF_RX_3K_BUFFER, &(ring)->state)\n#define clear_ring_uses_large_buffer(ring) \\\n\tclear_bit(__IXGBEVF_RX_3K_BUFFER, &(ring)->state)\n\n#define ring_uses_build_skb(ring) \\\n\ttest_bit(__IXGBEVF_RX_BUILD_SKB_ENABLED, &(ring)->state)\n#define set_ring_build_skb_enabled(ring) \\\n\tset_bit(__IXGBEVF_RX_BUILD_SKB_ENABLED, &(ring)->state)\n#define clear_ring_build_skb_enabled(ring) \\\n\tclear_bit(__IXGBEVF_RX_BUILD_SKB_ENABLED, &(ring)->state)\n\nstatic inline unsigned int ixgbevf_rx_bufsz(struct ixgbevf_ring *ring)\n{\n#if (PAGE_SIZE < 8192)\n\tif (ring_uses_large_buffer(ring))\n\t\treturn IXGBEVF_RXBUFFER_3072;\n\n\tif (ring_uses_build_skb(ring))\n\t\treturn IXGBEVF_MAX_FRAME_BUILD_SKB;\n#endif\n\treturn IXGBEVF_RXBUFFER_2048;\n}\n\nstatic inline unsigned int ixgbevf_rx_pg_order(struct ixgbevf_ring *ring)\n{\n#if (PAGE_SIZE < 8192)\n\tif (ring_uses_large_buffer(ring))\n\t\treturn 1;\n#endif\n\treturn 0;\n}\n\n#define ixgbevf_rx_pg_size(_ring) (PAGE_SIZE << ixgbevf_rx_pg_order(_ring))\n\n#define check_for_tx_hang(ring) \\\n\ttest_bit(__IXGBEVF_TX_DETECT_HANG, &(ring)->state)\n#define set_check_for_tx_hang(ring) \\\n\tset_bit(__IXGBEVF_TX_DETECT_HANG, &(ring)->state)\n#define clear_check_for_tx_hang(ring) \\\n\tclear_bit(__IXGBEVF_TX_DETECT_HANG, &(ring)->state)\n\nstruct ixgbevf_ring_container {\n\tstruct ixgbevf_ring *ring;\t \n\tunsigned int total_bytes;\t \n\tunsigned int total_packets;\t \n\tu8 count;\t\t\t \n\tu8 itr;\t\t\t\t \n};\n\n \n#define ixgbevf_for_each_ring(pos, head) \\\n\tfor (pos = (head).ring; pos != NULL; pos = pos->next)\n\n \nstruct ixgbevf_q_vector {\n\tstruct ixgbevf_adapter *adapter;\n\t \n\tu16 v_idx;\n\tu16 itr;  \n\tstruct napi_struct napi;\n\tstruct ixgbevf_ring_container rx, tx;\n\tstruct rcu_head rcu;     \n\tchar name[IFNAMSIZ + 9];\n\n\t \n\tstruct ixgbevf_ring ring[0] ____cacheline_internodealigned_in_smp;\n#ifdef CONFIG_NET_RX_BUSY_POLL\n\tunsigned int state;\n#define IXGBEVF_QV_STATE_IDLE\t\t0\n#define IXGBEVF_QV_STATE_NAPI\t\t1     \n#define IXGBEVF_QV_STATE_POLL\t\t2     \n#define IXGBEVF_QV_STATE_DISABLED\t4     \n#define IXGBEVF_QV_OWNED\t(IXGBEVF_QV_STATE_NAPI | IXGBEVF_QV_STATE_POLL)\n#define IXGBEVF_QV_LOCKED\t(IXGBEVF_QV_OWNED | IXGBEVF_QV_STATE_DISABLED)\n#define IXGBEVF_QV_STATE_NAPI_YIELD\t8     \n#define IXGBEVF_QV_STATE_POLL_YIELD\t16    \n#define IXGBEVF_QV_YIELD\t(IXGBEVF_QV_STATE_NAPI_YIELD | \\\n\t\t\t\t IXGBEVF_QV_STATE_POLL_YIELD)\n#define IXGBEVF_QV_USER_PEND\t(IXGBEVF_QV_STATE_POLL | \\\n\t\t\t\t IXGBEVF_QV_STATE_POLL_YIELD)\n\tspinlock_t lock;\n#endif  \n};\n\n \n#define IXGBE_MIN_RSC_ITR\t24\n#define IXGBE_100K_ITR\t\t40\n#define IXGBE_20K_ITR\t\t200\n#define IXGBE_12K_ITR\t\t336\n\n \n#define EITR_INTS_PER_SEC_TO_REG(_eitr) \\\n\t((_eitr) ? (1000000000 / ((_eitr) * 256)) : 8)\n#define EITR_REG_TO_INTS_PER_SEC EITR_INTS_PER_SEC_TO_REG\n\n \nstatic inline __le32 ixgbevf_test_staterr(union ixgbe_adv_rx_desc *rx_desc,\n\t\t\t\t\t  const u32 stat_err_bits)\n{\n\treturn rx_desc->wb.upper.status_error & cpu_to_le32(stat_err_bits);\n}\n\nstatic inline u16 ixgbevf_desc_unused(struct ixgbevf_ring *ring)\n{\n\tu16 ntc = ring->next_to_clean;\n\tu16 ntu = ring->next_to_use;\n\n\treturn ((ntc > ntu) ? 0 : ring->count) + ntc - ntu - 1;\n}\n\nstatic inline void ixgbevf_write_tail(struct ixgbevf_ring *ring, u32 value)\n{\n\twritel(value, ring->tail);\n}\n\n#define IXGBEVF_RX_DESC(R, i)\t\\\n\t(&(((union ixgbe_adv_rx_desc *)((R)->desc))[i]))\n#define IXGBEVF_TX_DESC(R, i)\t\\\n\t(&(((union ixgbe_adv_tx_desc *)((R)->desc))[i]))\n#define IXGBEVF_TX_CTXTDESC(R, i)\t\\\n\t(&(((struct ixgbe_adv_tx_context_desc *)((R)->desc))[i]))\n\n#define IXGBE_MAX_JUMBO_FRAME_SIZE\t9728  \n\n#define OTHER_VECTOR\t1\n#define NON_Q_VECTORS\t(OTHER_VECTOR)\n\n#define MAX_MSIX_Q_VECTORS\t2\n\n#define MIN_MSIX_Q_VECTORS\t1\n#define MIN_MSIX_COUNT\t\t(MIN_MSIX_Q_VECTORS + NON_Q_VECTORS)\n\n#define IXGBEVF_RX_DMA_ATTR \\\n\t(DMA_ATTR_SKIP_CPU_SYNC | DMA_ATTR_WEAK_ORDERING)\n\n \nstruct ixgbevf_adapter {\n\t \n\tunsigned long active_vlans[BITS_TO_LONGS(VLAN_N_VID)];\n\n\tstruct ixgbevf_q_vector *q_vector[MAX_MSIX_Q_VECTORS];\n\n\t \n\tu16 rx_itr_setting;\n\tu16 tx_itr_setting;\n\n\t \n\tu32 eims_enable_mask;\n\tu32 eims_other;\n\n\t \n\tint num_xdp_queues;\n\tstruct ixgbevf_ring *xdp_ring[MAX_XDP_QUEUES];\n\n\t \n\tint num_tx_queues;\n\tstruct ixgbevf_ring *tx_ring[MAX_TX_QUEUES];  \n\tu64 restart_queue;\n\tu32 tx_timeout_count;\n\tu64 tx_ipsec;\n\n\t \n\tint num_rx_queues;\n\tstruct ixgbevf_ring *rx_ring[MAX_TX_QUEUES];  \n\tu64 hw_csum_rx_error;\n\tu64 hw_rx_no_dma_resources;\n\tint num_msix_vectors;\n\tu64 alloc_rx_page_failed;\n\tu64 alloc_rx_buff_failed;\n\tu64 alloc_rx_page;\n\tu64 rx_ipsec;\n\n\tstruct msix_entry *msix_entries;\n\n\t \n\tstruct net_device *netdev;\n\tstruct bpf_prog *xdp_prog;\n\tstruct pci_dev *pdev;\n\n\t \n\tstruct ixgbe_hw hw;\n\tu16 msg_enable;\n\t \n\tu32 eitr_param;\n\n\tstruct ixgbevf_hw_stats stats;\n\n\tunsigned long state;\n\tu64 tx_busy;\n\tunsigned int tx_ring_count;\n\tunsigned int xdp_ring_count;\n\tunsigned int rx_ring_count;\n\n\tu8 __iomem *io_addr;  \n\tu32 link_speed;\n\tbool link_up;\n\n\tstruct timer_list service_timer;\n\tstruct work_struct service_task;\n\n\tspinlock_t mbx_lock;\n\tunsigned long last_reset;\n\n\tu32 *rss_key;\n\tu8 rss_indir_tbl[IXGBEVF_X550_VFRETA_SIZE];\n\tu32 flags;\n\tbool link_state;\n\n#define IXGBEVF_FLAGS_LEGACY_RX\t\tBIT(1)\n\n#ifdef CONFIG_XFRM\n\tstruct ixgbevf_ipsec *ipsec;\n#endif  \n};\n\nenum ixbgevf_state_t {\n\t__IXGBEVF_TESTING,\n\t__IXGBEVF_RESETTING,\n\t__IXGBEVF_DOWN,\n\t__IXGBEVF_DISABLED,\n\t__IXGBEVF_REMOVING,\n\t__IXGBEVF_SERVICE_SCHED,\n\t__IXGBEVF_SERVICE_INITED,\n\t__IXGBEVF_RESET_REQUESTED,\n\t__IXGBEVF_QUEUE_RESET_REQUESTED,\n};\n\nenum ixgbevf_boards {\n\tboard_82599_vf,\n\tboard_82599_vf_hv,\n\tboard_X540_vf,\n\tboard_X540_vf_hv,\n\tboard_X550_vf,\n\tboard_X550_vf_hv,\n\tboard_X550EM_x_vf,\n\tboard_X550EM_x_vf_hv,\n\tboard_x550em_a_vf,\n};\n\nenum ixgbevf_xcast_modes {\n\tIXGBEVF_XCAST_MODE_NONE = 0,\n\tIXGBEVF_XCAST_MODE_MULTI,\n\tIXGBEVF_XCAST_MODE_ALLMULTI,\n\tIXGBEVF_XCAST_MODE_PROMISC,\n};\n\nextern const struct ixgbevf_info ixgbevf_82599_vf_info;\nextern const struct ixgbevf_info ixgbevf_X540_vf_info;\nextern const struct ixgbevf_info ixgbevf_X550_vf_info;\nextern const struct ixgbevf_info ixgbevf_X550EM_x_vf_info;\nextern const struct ixgbe_mbx_operations ixgbevf_mbx_ops;\nextern const struct ixgbe_mbx_operations ixgbevf_mbx_ops_legacy;\nextern const struct ixgbevf_info ixgbevf_x550em_a_vf_info;\n\nextern const struct ixgbevf_info ixgbevf_82599_vf_hv_info;\nextern const struct ixgbevf_info ixgbevf_X540_vf_hv_info;\nextern const struct ixgbevf_info ixgbevf_X550_vf_hv_info;\nextern const struct ixgbevf_info ixgbevf_X550EM_x_vf_hv_info;\nextern const struct ixgbe_mbx_operations ixgbevf_hv_mbx_ops;\n\n \nextern const char ixgbevf_driver_name[];\n\nint ixgbevf_open(struct net_device *netdev);\nint ixgbevf_close(struct net_device *netdev);\nvoid ixgbevf_up(struct ixgbevf_adapter *adapter);\nvoid ixgbevf_down(struct ixgbevf_adapter *adapter);\nvoid ixgbevf_reinit_locked(struct ixgbevf_adapter *adapter);\nvoid ixgbevf_reset(struct ixgbevf_adapter *adapter);\nvoid ixgbevf_set_ethtool_ops(struct net_device *netdev);\nint ixgbevf_setup_rx_resources(struct ixgbevf_adapter *adapter,\n\t\t\t       struct ixgbevf_ring *rx_ring);\nint ixgbevf_setup_tx_resources(struct ixgbevf_ring *);\nvoid ixgbevf_free_rx_resources(struct ixgbevf_ring *);\nvoid ixgbevf_free_tx_resources(struct ixgbevf_ring *);\nvoid ixgbevf_update_stats(struct ixgbevf_adapter *adapter);\nint ethtool_ioctl(struct ifreq *ifr);\n\nextern void ixgbevf_write_eitr(struct ixgbevf_q_vector *q_vector);\n\n#ifdef CONFIG_IXGBEVF_IPSEC\nvoid ixgbevf_init_ipsec_offload(struct ixgbevf_adapter *adapter);\nvoid ixgbevf_stop_ipsec_offload(struct ixgbevf_adapter *adapter);\nvoid ixgbevf_ipsec_restore(struct ixgbevf_adapter *adapter);\nvoid ixgbevf_ipsec_rx(struct ixgbevf_ring *rx_ring,\n\t\t      union ixgbe_adv_rx_desc *rx_desc,\n\t\t      struct sk_buff *skb);\nint ixgbevf_ipsec_tx(struct ixgbevf_ring *tx_ring,\n\t\t     struct ixgbevf_tx_buffer *first,\n\t\t     struct ixgbevf_ipsec_tx_data *itd);\n#else\nstatic inline void ixgbevf_init_ipsec_offload(struct ixgbevf_adapter *adapter)\n{ }\nstatic inline void ixgbevf_stop_ipsec_offload(struct ixgbevf_adapter *adapter)\n{ }\nstatic inline void ixgbevf_ipsec_restore(struct ixgbevf_adapter *adapter) { }\nstatic inline void ixgbevf_ipsec_rx(struct ixgbevf_ring *rx_ring,\n\t\t\t\t    union ixgbe_adv_rx_desc *rx_desc,\n\t\t\t\t    struct sk_buff *skb) { }\nstatic inline int ixgbevf_ipsec_tx(struct ixgbevf_ring *tx_ring,\n\t\t\t\t   struct ixgbevf_tx_buffer *first,\n\t\t\t\t   struct ixgbevf_ipsec_tx_data *itd)\n{ return 0; }\n#endif  \n\n#define ixgbevf_hw_to_netdev(hw) \\\n\t(((struct ixgbevf_adapter *)(hw)->back)->netdev)\n\n#define hw_dbg(hw, format, arg...) \\\n\tnetdev_dbg(ixgbevf_hw_to_netdev(hw), format, ## arg)\n\ns32 ixgbevf_poll_mbx(struct ixgbe_hw *hw, u32 *msg, u16 size);\ns32 ixgbevf_write_mbx(struct ixgbe_hw *hw, u32 *msg, u16 size);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}