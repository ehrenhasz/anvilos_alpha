{
  "module_name": "iavf_adv_rss.c",
  "hash_id": "acf02f57fb6d980376fe6f913858b20c79c090026681b9dd91f0f695a8d651e3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/intel/iavf/iavf_adv_rss.c",
  "human_readable_source": "\n \n\n \n\n#include \"iavf.h\"\n\n \nstatic void\niavf_fill_adv_rss_ip4_hdr(struct virtchnl_proto_hdr *hdr, u64 hash_flds)\n{\n\tVIRTCHNL_SET_PROTO_HDR_TYPE(hdr, IPV4);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_IPV4_SA)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, IPV4, SRC);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_IPV4_DA)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, IPV4, DST);\n}\n\n \nstatic void\niavf_fill_adv_rss_ip6_hdr(struct virtchnl_proto_hdr *hdr, u64 hash_flds)\n{\n\tVIRTCHNL_SET_PROTO_HDR_TYPE(hdr, IPV6);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_IPV6_SA)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, IPV6, SRC);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_IPV6_DA)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, IPV6, DST);\n}\n\n \nstatic void\niavf_fill_adv_rss_tcp_hdr(struct virtchnl_proto_hdr *hdr, u64 hash_flds)\n{\n\tVIRTCHNL_SET_PROTO_HDR_TYPE(hdr, TCP);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_TCP_SRC_PORT)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, TCP, SRC_PORT);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_TCP_DST_PORT)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, TCP, DST_PORT);\n}\n\n \nstatic void\niavf_fill_adv_rss_udp_hdr(struct virtchnl_proto_hdr *hdr, u64 hash_flds)\n{\n\tVIRTCHNL_SET_PROTO_HDR_TYPE(hdr, UDP);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_UDP_SRC_PORT)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, UDP, SRC_PORT);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_UDP_DST_PORT)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, UDP, DST_PORT);\n}\n\n \nstatic void\niavf_fill_adv_rss_sctp_hdr(struct virtchnl_proto_hdr *hdr, u64 hash_flds)\n{\n\tVIRTCHNL_SET_PROTO_HDR_TYPE(hdr, SCTP);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_SCTP_SRC_PORT)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, SCTP, SRC_PORT);\n\n\tif (hash_flds & IAVF_ADV_RSS_HASH_FLD_SCTP_DST_PORT)\n\t\tVIRTCHNL_ADD_PROTO_HDR_FIELD_BIT(hdr, SCTP, DST_PORT);\n}\n\n \nint\niavf_fill_adv_rss_cfg_msg(struct virtchnl_rss_cfg *rss_cfg,\n\t\t\t  u32 packet_hdrs, u64 hash_flds)\n{\n\tstruct virtchnl_proto_hdrs *proto_hdrs = &rss_cfg->proto_hdrs;\n\tstruct virtchnl_proto_hdr *hdr;\n\n\trss_cfg->rss_algorithm = VIRTCHNL_RSS_ALG_TOEPLITZ_ASYMMETRIC;\n\n\tproto_hdrs->tunnel_level = 0;\t \n\n\thdr = &proto_hdrs->proto_hdr[proto_hdrs->count++];\n\tswitch (packet_hdrs & IAVF_ADV_RSS_FLOW_SEG_HDR_L3) {\n\tcase IAVF_ADV_RSS_FLOW_SEG_HDR_IPV4:\n\t\tiavf_fill_adv_rss_ip4_hdr(hdr, hash_flds);\n\t\tbreak;\n\tcase IAVF_ADV_RSS_FLOW_SEG_HDR_IPV6:\n\t\tiavf_fill_adv_rss_ip6_hdr(hdr, hash_flds);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\thdr = &proto_hdrs->proto_hdr[proto_hdrs->count++];\n\tswitch (packet_hdrs & IAVF_ADV_RSS_FLOW_SEG_HDR_L4) {\n\tcase IAVF_ADV_RSS_FLOW_SEG_HDR_TCP:\n\t\tiavf_fill_adv_rss_tcp_hdr(hdr, hash_flds);\n\t\tbreak;\n\tcase IAVF_ADV_RSS_FLOW_SEG_HDR_UDP:\n\t\tiavf_fill_adv_rss_udp_hdr(hdr, hash_flds);\n\t\tbreak;\n\tcase IAVF_ADV_RSS_FLOW_SEG_HDR_SCTP:\n\t\tiavf_fill_adv_rss_sctp_hdr(hdr, hash_flds);\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n \nstruct iavf_adv_rss *\niavf_find_adv_rss_cfg_by_hdrs(struct iavf_adapter *adapter, u32 packet_hdrs)\n{\n\tstruct iavf_adv_rss *rss;\n\n\tlist_for_each_entry(rss, &adapter->adv_rss_list_head, list)\n\t\tif (rss->packet_hdrs == packet_hdrs)\n\t\t\treturn rss;\n\n\treturn NULL;\n}\n\n \nvoid\niavf_print_adv_rss_cfg(struct iavf_adapter *adapter, struct iavf_adv_rss *rss,\n\t\t       const char *action, const char *result)\n{\n\tu32 packet_hdrs = rss->packet_hdrs;\n\tu64 hash_flds = rss->hash_flds;\n\tstatic char hash_opt[300];\n\tconst char *proto;\n\n\tif (packet_hdrs & IAVF_ADV_RSS_FLOW_SEG_HDR_TCP)\n\t\tproto = \"TCP\";\n\telse if (packet_hdrs & IAVF_ADV_RSS_FLOW_SEG_HDR_UDP)\n\t\tproto = \"UDP\";\n\telse if (packet_hdrs & IAVF_ADV_RSS_FLOW_SEG_HDR_SCTP)\n\t\tproto = \"SCTP\";\n\telse\n\t\treturn;\n\n\tmemset(hash_opt, 0, sizeof(hash_opt));\n\n\tstrcat(hash_opt, proto);\n\tif (packet_hdrs & IAVF_ADV_RSS_FLOW_SEG_HDR_IPV4)\n\t\tstrcat(hash_opt, \"v4 \");\n\telse\n\t\tstrcat(hash_opt, \"v6 \");\n\n\tif (hash_flds & (IAVF_ADV_RSS_HASH_FLD_IPV4_SA |\n\t\t\t IAVF_ADV_RSS_HASH_FLD_IPV6_SA))\n\t\tstrcat(hash_opt, \"IP SA,\");\n\tif (hash_flds & (IAVF_ADV_RSS_HASH_FLD_IPV4_DA |\n\t\t\t IAVF_ADV_RSS_HASH_FLD_IPV6_DA))\n\t\tstrcat(hash_opt, \"IP DA,\");\n\tif (hash_flds & (IAVF_ADV_RSS_HASH_FLD_TCP_SRC_PORT |\n\t\t\t IAVF_ADV_RSS_HASH_FLD_UDP_SRC_PORT |\n\t\t\t IAVF_ADV_RSS_HASH_FLD_SCTP_SRC_PORT))\n\t\tstrcat(hash_opt, \"src port,\");\n\tif (hash_flds & (IAVF_ADV_RSS_HASH_FLD_TCP_DST_PORT |\n\t\t\t IAVF_ADV_RSS_HASH_FLD_UDP_DST_PORT |\n\t\t\t IAVF_ADV_RSS_HASH_FLD_SCTP_DST_PORT))\n\t\tstrcat(hash_opt, \"dst port,\");\n\n\tif (!action)\n\t\taction = \"\";\n\n\tif (!result)\n\t\tresult = \"\";\n\n\tdev_info(&adapter->pdev->dev, \"%s %s %s\\n\", action, hash_opt, result);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}