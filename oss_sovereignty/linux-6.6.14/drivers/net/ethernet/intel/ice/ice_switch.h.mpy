{
  "module_name": "ice_switch.h",
  "hash_id": "a6fbe200d14a038aad7ee0e5c6fd45e5a087858804cc870edd307733f96f675a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/intel/ice/ice_switch.h",
  "human_readable_source": " \n \n\n#ifndef _ICE_SWITCH_H_\n#define _ICE_SWITCH_H_\n\n#include \"ice_common.h\"\n\n#define ICE_SW_CFG_MAX_BUF_LEN 2048\n#define ICE_DFLT_VSI_INVAL 0xff\n#define ICE_FLTR_RX BIT(0)\n#define ICE_FLTR_TX BIT(1)\n#define ICE_VSI_INVAL_ID 0xffff\n#define ICE_INVAL_Q_HANDLE 0xFFFF\n\n \n#define ICE_PROFID_IPV4_GTPC_TEID\t\t\t41\n#define ICE_PROFID_IPV4_GTPC_NO_TEID\t\t\t42\n#define ICE_PROFID_IPV4_GTPU_TEID\t\t\t43\n#define ICE_PROFID_IPV6_GTPC_TEID\t\t\t44\n#define ICE_PROFID_IPV6_GTPC_NO_TEID\t\t\t45\n#define ICE_PROFID_IPV6_GTPU_TEID\t\t\t46\n#define ICE_PROFID_IPV6_GTPU_IPV6_TCP_INNER\t\t70\n\n#define ICE_SW_RULE_VSI_LIST_SIZE(s, n)\t\tstruct_size((s), vsi, (n))\n#define ICE_SW_RULE_RX_TX_HDR_SIZE(s, l)\tstruct_size((s), hdr_data, (l))\n#define ICE_SW_RULE_RX_TX_ETH_HDR_SIZE(s)\t\\\n\tICE_SW_RULE_RX_TX_HDR_SIZE((s), DUMMY_ETH_HDR_LEN)\n#define ICE_SW_RULE_RX_TX_NO_HDR_SIZE(s)\t\\\n\tICE_SW_RULE_RX_TX_HDR_SIZE((s), 0)\n#define ICE_SW_RULE_LG_ACT_SIZE(s, n)\t\tstruct_size((s), act, (n))\n\n#define DUMMY_ETH_HDR_LEN\t\t16\n\n \nstruct ice_vsi_ctx {\n\tu16 vsi_num;\n\tu16 vsis_allocd;\n\tu16 vsis_unallocated;\n\tu16 flags;\n\tstruct ice_aqc_vsi_props info;\n\tstruct ice_sched_vsi_info sched;\n\tu8 alloc_from_pool;\n\tu8 vf_num;\n\tu16 num_lan_q_entries[ICE_MAX_TRAFFIC_CLASS];\n\tstruct ice_q_ctx *lan_q_ctx[ICE_MAX_TRAFFIC_CLASS];\n\tu16 num_rdma_q_entries[ICE_MAX_TRAFFIC_CLASS];\n\tstruct ice_q_ctx *rdma_q_ctx[ICE_MAX_TRAFFIC_CLASS];\n};\n\n \nenum ice_sw_lkup_type {\n\tICE_SW_LKUP_ETHERTYPE = 0,\n\tICE_SW_LKUP_MAC = 1,\n\tICE_SW_LKUP_MAC_VLAN = 2,\n\tICE_SW_LKUP_PROMISC = 3,\n\tICE_SW_LKUP_VLAN = 4,\n\tICE_SW_LKUP_DFLT = 5,\n\tICE_SW_LKUP_ETHERTYPE_MAC = 8,\n\tICE_SW_LKUP_PROMISC_VLAN = 9,\n\tICE_SW_LKUP_LAST\n};\n\n \nenum ice_src_id {\n\tICE_SRC_ID_UNKNOWN = 0,\n\tICE_SRC_ID_VSI,\n\tICE_SRC_ID_QUEUE,\n\tICE_SRC_ID_LPORT,\n};\n\nstruct ice_fltr_info {\n\t \n\tenum ice_sw_lkup_type lkup_type;\n\t \n\tenum ice_sw_fwd_act_type fltr_act;\n\t \n\tu16 fltr_rule_id;\n\tu16 flag;\n\n\t \n\tu16 src;\n\tenum ice_src_id src_id;\n\n\tunion {\n\t\tstruct {\n\t\t\tu8 mac_addr[ETH_ALEN];\n\t\t} mac;\n\t\tstruct {\n\t\t\tu8 mac_addr[ETH_ALEN];\n\t\t\tu16 vlan_id;\n\t\t} mac_vlan;\n\t\tstruct {\n\t\t\tu16 vlan_id;\n\t\t\tu16 tpid;\n\t\t\tu8 tpid_valid;\n\t\t} vlan;\n\t\t \n\t\tstruct {\n\t\t\tu16 ethertype;\n\t\t\tu8 mac_addr[ETH_ALEN];  \n\t\t} ethertype_mac;\n\t} l_data;  \n\n\t \n\tunion {\n\t\t \n\t\tu16 q_id:11;\n\t\tu16 hw_vsi_id:10;\n\t\tu16 vsi_list_id:10;\n\t} fwd_id;\n\n\t \n\tu16 vsi_handle;\n\n\t \n\tu8 qgrp_size;\n\n\t \n\tu8 lb_en;\t \n\tu8 lan_en;\t \n};\n\nstruct ice_update_recipe_lkup_idx_params {\n\tu16 rid;\n\tu16 fv_idx;\n\tbool ignore_valid;\n\tu16 mask;\n\tbool mask_valid;\n\tu8 lkup_idx;\n};\n\nstruct ice_adv_lkup_elem {\n\tenum ice_protocol_type type;\n\tunion {\n\t\tunion ice_prot_hdr h_u;\t \n\t\t \n\t\tu16 h_raw[sizeof(union ice_prot_hdr) / sizeof(u16)];\n\t};\n\tunion {\n\t\tunion ice_prot_hdr m_u;\t \n\t\t \n\t\tu16 m_raw[sizeof(union ice_prot_hdr) / sizeof(u16)];\n\t};\n};\n\nstruct ice_sw_act_ctrl {\n\t \n\tu16 src;\n\tu16 flag;\n\tenum ice_sw_fwd_act_type fltr_act;\n\t \n\tunion {\n\t\t \n\t\tu16 q_id:11;\n\t\tu16 vsi_id:10;\n\t\tu16 hw_vsi_id:10;\n\t\tu16 vsi_list_id:10;\n\t} fwd_id;\n\t \n\tu16 vsi_handle;\n\tu8 qgrp_size;\n};\n\nstruct ice_rule_query_data {\n\t \n\tu16 rid;\n\t \n\tu16 rule_id;\n\t \n\tu16 vsi_handle;\n};\n\n \nstruct ice_adv_rule_flags_info {\n\tu32 act;\n\tu8 act_valid;\t\t \n};\n\nstruct ice_adv_rule_info {\n\t \n\tenum ice_sw_tunnel_type tun_type;\n\tu16 vlan_type;\n\tu16 fltr_rule_id;\n\tu32 priority;\n\tu16 need_pass_l2:1;\n\tu16 allow_pass_l2:1;\n\tu16 src_vsi;\n\tstruct ice_sw_act_ctrl sw_act;\n\tstruct ice_adv_rule_flags_info flags_info;\n};\n\n \nstruct ice_sw_recipe {\n\t \n\tu8 is_root;\n\tu8 root_rid;\n\tu8 recp_created;\n\n\t \n\tu8 n_ext_words;\n\t \n\tstruct ice_fv_word ext_words[ICE_MAX_CHAIN_WORDS];\n\tu16 word_masks[ICE_MAX_CHAIN_WORDS];\n\n\t \n\tu8 big_recp;\n\n\t \n\tu8 chain_idx;\n\n\t \n\tu8 n_grp_count;\n\n\t \n\tDECLARE_BITMAP(r_bitmap, ICE_MAX_NUM_RECIPES);\n\n\tenum ice_sw_tunnel_type tun_type;\n\n\t \n\tu8 adv_rule;\n\tstruct list_head filt_rules;\n\tstruct list_head filt_replay_rules;\n\n\tstruct mutex filt_rule_lock;\t \n\n\t \n\tstruct list_head fv_list;\n\n\t \n\tu8 num_profs, *prof_ids;\n\n\t \n\tDECLARE_BITMAP(res_idxs, ICE_MAX_FV_WORDS);\n\n\t \n\tu8 priority;\n\n\tu8 need_pass_l2:1;\n\tu8 allow_pass_l2:1;\n\n\tstruct list_head rg_list;\n\n\t \n\tstruct ice_aqc_recipe_data_elem *root_buf;\n\t \n\tstruct ice_prot_lkup_ext lkup_exts;\n};\n\n \nstruct ice_vsi_list_map_info {\n\tstruct list_head list_entry;\n\tDECLARE_BITMAP(vsi_map, ICE_MAX_VSI);\n\tu16 vsi_list_id;\n\t \n\tu16 ref_cnt;\n};\n\nstruct ice_fltr_list_entry {\n\tstruct list_head list_entry;\n\tint status;\n\tstruct ice_fltr_info fltr_info;\n};\n\n \nstruct ice_fltr_mgmt_list_entry {\n\t \n\tstruct ice_vsi_list_map_info *vsi_list_info;\n\tu16 vsi_count;\n#define ICE_INVAL_LG_ACT_INDEX 0xffff\n\tu16 lg_act_idx;\n#define ICE_INVAL_SW_MARKER_ID 0xffff\n\tu16 sw_marker_id;\n\tstruct list_head list_entry;\n\tstruct ice_fltr_info fltr_info;\n#define ICE_INVAL_COUNTER_ID 0xff\n\tu8 counter_index;\n};\n\nstruct ice_adv_fltr_mgmt_list_entry {\n\tstruct list_head list_entry;\n\n\tstruct ice_adv_lkup_elem *lkups;\n\tstruct ice_adv_rule_info rule_info;\n\tu16 lkups_cnt;\n\tstruct ice_vsi_list_map_info *vsi_list_info;\n\tu16 vsi_count;\n};\n\nenum ice_promisc_flags {\n\tICE_PROMISC_UCAST_RX = 0x1,\n\tICE_PROMISC_UCAST_TX = 0x2,\n\tICE_PROMISC_MCAST_RX = 0x4,\n\tICE_PROMISC_MCAST_TX = 0x8,\n\tICE_PROMISC_BCAST_RX = 0x10,\n\tICE_PROMISC_BCAST_TX = 0x20,\n\tICE_PROMISC_VLAN_RX = 0x40,\n\tICE_PROMISC_VLAN_TX = 0x80,\n};\n\n \nint\nice_add_vsi(struct ice_hw *hw, u16 vsi_handle, struct ice_vsi_ctx *vsi_ctx,\n\t    struct ice_sq_cd *cd);\nint\nice_free_vsi(struct ice_hw *hw, u16 vsi_handle, struct ice_vsi_ctx *vsi_ctx,\n\t     bool keep_vsi_alloc, struct ice_sq_cd *cd);\nint\nice_update_vsi(struct ice_hw *hw, u16 vsi_handle, struct ice_vsi_ctx *vsi_ctx,\n\t       struct ice_sq_cd *cd);\nbool ice_is_vsi_valid(struct ice_hw *hw, u16 vsi_handle);\nstruct ice_vsi_ctx *ice_get_vsi_ctx(struct ice_hw *hw, u16 vsi_handle);\nvoid ice_clear_all_vsi_ctx(struct ice_hw *hw);\n \nint ice_get_initial_sw_cfg(struct ice_hw *hw);\n\nint\nice_alloc_res_cntr(struct ice_hw *hw, u8 type, u8 alloc_shared, u16 num_items,\n\t\t   u16 *counter_id);\nint\nice_free_res_cntr(struct ice_hw *hw, u8 type, u8 alloc_shared, u16 num_items,\n\t\t  u16 counter_id);\nint ice_share_res(struct ice_hw *hw, u16 type, u8 shared, u16 res_id);\n\n \nvoid ice_rule_add_tunnel_metadata(struct ice_adv_lkup_elem *lkup);\nvoid ice_rule_add_direction_metadata(struct ice_adv_lkup_elem *lkup);\nvoid ice_rule_add_vlan_metadata(struct ice_adv_lkup_elem *lkup);\nvoid ice_rule_add_src_vsi_metadata(struct ice_adv_lkup_elem *lkup);\nint\nice_add_adv_rule(struct ice_hw *hw, struct ice_adv_lkup_elem *lkups,\n\t\t u16 lkups_cnt, struct ice_adv_rule_info *rinfo,\n\t\t struct ice_rule_query_data *added_entry);\nint ice_update_sw_rule_bridge_mode(struct ice_hw *hw);\nint ice_add_vlan(struct ice_hw *hw, struct list_head *m_list);\nint ice_remove_vlan(struct ice_hw *hw, struct list_head *v_list);\nint ice_add_mac(struct ice_hw *hw, struct list_head *m_lst);\nint ice_remove_mac(struct ice_hw *hw, struct list_head *m_lst);\nbool ice_vlan_fltr_exist(struct ice_hw *hw, u16 vlan_id, u16 vsi_handle);\nint ice_add_eth_mac(struct ice_hw *hw, struct list_head *em_list);\nint ice_remove_eth_mac(struct ice_hw *hw, struct list_head *em_list);\nint ice_cfg_rdma_fltr(struct ice_hw *hw, u16 vsi_handle, bool enable);\nvoid ice_remove_vsi_fltr(struct ice_hw *hw, u16 vsi_handle);\n\n \nint\nice_cfg_dflt_vsi(struct ice_port_info *pi, u16 vsi_handle, bool set,\n\t\t u8 direction);\nbool\nice_check_if_dflt_vsi(struct ice_port_info *pi, u16 vsi_handle,\n\t\t      bool *rule_exists);\n\nint\nice_set_vsi_promisc(struct ice_hw *hw, u16 vsi_handle, u8 promisc_mask,\n\t\t    u16 vid);\nint\nice_clear_vsi_promisc(struct ice_hw *hw, u16 vsi_handle, u8 promisc_mask,\n\t\t      u16 vid);\nint\nice_set_vlan_vsi_promisc(struct ice_hw *hw, u16 vsi_handle, u8 promisc_mask,\n\t\t\t bool rm_vlan_promisc);\n\nint\nice_rem_adv_rule_by_id(struct ice_hw *hw,\n\t\t       struct ice_rule_query_data *remove_entry);\n\nint ice_init_def_sw_recp(struct ice_hw *hw);\nu16 ice_get_hw_vsi_num(struct ice_hw *hw, u16 vsi_handle);\n\nint ice_replay_vsi_all_fltr(struct ice_hw *hw, u16 vsi_handle);\nvoid ice_rm_all_sw_replay_rule_info(struct ice_hw *hw);\nvoid ice_fill_eth_hdr(u8 *eth_hdr);\n\nint\nice_aq_sw_rules(struct ice_hw *hw, void *rule_list, u16 rule_list_sz,\n\t\tu8 num_rules, enum ice_adminq_opc opc, struct ice_sq_cd *cd);\nint\nice_update_recipe_lkup_idx(struct ice_hw *hw,\n\t\t\t   struct ice_update_recipe_lkup_idx_params *params);\nvoid ice_change_proto_id_to_dvm(void);\nstruct ice_vsi_list_map_info *\nice_find_vsi_list_entry(struct ice_hw *hw, u8 recp_id, u16 vsi_handle,\n\t\t\tu16 *vsi_list_id);\nint ice_alloc_recipe(struct ice_hw *hw, u16 *rid);\nint ice_aq_get_recipe(struct ice_hw *hw,\n\t\t      struct ice_aqc_recipe_data_elem *s_recipe_list,\n\t\t      u16 *num_recipes, u16 recipe_root, struct ice_sq_cd *cd);\nint ice_aq_add_recipe(struct ice_hw *hw,\n\t\t      struct ice_aqc_recipe_data_elem *s_recipe_list,\n\t\t      u16 num_recipes, struct ice_sq_cd *cd);\nint\nice_aq_get_recipe_to_profile(struct ice_hw *hw, u32 profile_id, u8 *r_bitmap,\n\t\t\t     struct ice_sq_cd *cd);\nint\nice_aq_map_recipe_to_profile(struct ice_hw *hw, u32 profile_id, u8 *r_bitmap,\n\t\t\t     struct ice_sq_cd *cd);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}