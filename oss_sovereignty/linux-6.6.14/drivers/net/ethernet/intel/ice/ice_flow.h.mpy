{
  "module_name": "ice_flow.h",
  "hash_id": "c6a8726bc41bbada4f44d1d43b49c084dfb31679353ed417ba09c6c7656fe8e0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/intel/ice/ice_flow.h",
  "human_readable_source": " \n \n\n#ifndef _ICE_FLOW_H_\n#define _ICE_FLOW_H_\n\n#include \"ice_flex_type.h\"\n\n#define ICE_FLOW_ENTRY_HANDLE_INVAL\t0\n#define ICE_FLOW_FLD_OFF_INVAL\t\t0xffff\n\n \n#define ICE_FLOW_HASH_ETH\t\\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_ETH_DA) | \\\n\t BIT_ULL(ICE_FLOW_FIELD_IDX_ETH_SA))\n#define ICE_FLOW_HASH_IPV4\t\\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_IPV4_SA) | \\\n\t BIT_ULL(ICE_FLOW_FIELD_IDX_IPV4_DA))\n#define ICE_FLOW_HASH_IPV6\t\\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_IPV6_SA) | \\\n\t BIT_ULL(ICE_FLOW_FIELD_IDX_IPV6_DA))\n#define ICE_FLOW_HASH_TCP_PORT\t\\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_TCP_SRC_PORT) | \\\n\t BIT_ULL(ICE_FLOW_FIELD_IDX_TCP_DST_PORT))\n#define ICE_FLOW_HASH_UDP_PORT\t\\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_UDP_SRC_PORT) | \\\n\t BIT_ULL(ICE_FLOW_FIELD_IDX_UDP_DST_PORT))\n#define ICE_FLOW_HASH_SCTP_PORT\t\\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_SCTP_SRC_PORT) | \\\n\t BIT_ULL(ICE_FLOW_FIELD_IDX_SCTP_DST_PORT))\n\n#define ICE_HASH_INVALID\t0\n#define ICE_HASH_TCP_IPV4\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_TCP_PORT)\n#define ICE_HASH_TCP_IPV6\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_TCP_PORT)\n#define ICE_HASH_UDP_IPV4\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_UDP_PORT)\n#define ICE_HASH_UDP_IPV6\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_UDP_PORT)\n\n#define ICE_FLOW_HASH_GTP_TEID \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_GTPC_TEID))\n\n#define ICE_FLOW_HASH_GTP_IPV4_TEID \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_GTP_TEID)\n#define ICE_FLOW_HASH_GTP_IPV6_TEID \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_GTP_TEID)\n\n#define ICE_FLOW_HASH_GTP_U_TEID \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_GTPU_IP_TEID))\n\n#define ICE_FLOW_HASH_GTP_U_IPV4_TEID \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_GTP_U_TEID)\n#define ICE_FLOW_HASH_GTP_U_IPV6_TEID \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_GTP_U_TEID)\n\n#define ICE_FLOW_HASH_GTP_U_EH_TEID \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_GTPU_EH_TEID))\n\n#define ICE_FLOW_HASH_GTP_U_EH_QFI \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_GTPU_EH_QFI))\n\n#define ICE_FLOW_HASH_GTP_U_IPV4_EH \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_GTP_U_EH_TEID | \\\n\t ICE_FLOW_HASH_GTP_U_EH_QFI)\n#define ICE_FLOW_HASH_GTP_U_IPV6_EH \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_GTP_U_EH_TEID | \\\n\t ICE_FLOW_HASH_GTP_U_EH_QFI)\n\n#define ICE_FLOW_HASH_PPPOE_SESS_ID \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_PPPOE_SESS_ID))\n\n#define ICE_FLOW_HASH_PPPOE_SESS_ID_ETH \\\n\t(ICE_FLOW_HASH_ETH | ICE_FLOW_HASH_PPPOE_SESS_ID)\n#define ICE_FLOW_HASH_PPPOE_TCP_ID \\\n\t(ICE_FLOW_HASH_TCP_PORT | ICE_FLOW_HASH_PPPOE_SESS_ID)\n#define ICE_FLOW_HASH_PPPOE_UDP_ID \\\n\t(ICE_FLOW_HASH_UDP_PORT | ICE_FLOW_HASH_PPPOE_SESS_ID)\n\n#define ICE_FLOW_HASH_PFCP_SEID \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_PFCP_SEID))\n#define ICE_FLOW_HASH_PFCP_IPV4_SEID \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_PFCP_SEID)\n#define ICE_FLOW_HASH_PFCP_IPV6_SEID \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_PFCP_SEID)\n\n#define ICE_FLOW_HASH_L2TPV3_SESS_ID \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_L2TPV3_SESS_ID))\n#define ICE_FLOW_HASH_L2TPV3_IPV4_SESS_ID \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_L2TPV3_SESS_ID)\n#define ICE_FLOW_HASH_L2TPV3_IPV6_SESS_ID \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_L2TPV3_SESS_ID)\n\n#define ICE_FLOW_HASH_ESP_SPI \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_ESP_SPI))\n#define ICE_FLOW_HASH_ESP_IPV4_SPI \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_ESP_SPI)\n#define ICE_FLOW_HASH_ESP_IPV6_SPI \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_ESP_SPI)\n\n#define ICE_FLOW_HASH_AH_SPI \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_AH_SPI))\n#define ICE_FLOW_HASH_AH_IPV4_SPI \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_AH_SPI)\n#define ICE_FLOW_HASH_AH_IPV6_SPI \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_AH_SPI)\n\n#define ICE_FLOW_HASH_NAT_T_ESP_SPI \\\n\t(BIT_ULL(ICE_FLOW_FIELD_IDX_NAT_T_ESP_SPI))\n#define ICE_FLOW_HASH_NAT_T_ESP_IPV4_SPI \\\n\t(ICE_FLOW_HASH_IPV4 | ICE_FLOW_HASH_NAT_T_ESP_SPI)\n#define ICE_FLOW_HASH_NAT_T_ESP_IPV6_SPI \\\n\t(ICE_FLOW_HASH_IPV6 | ICE_FLOW_HASH_NAT_T_ESP_SPI)\n\n \nenum ice_flow_seg_hdr {\n\tICE_FLOW_SEG_HDR_NONE\t\t= 0x00000000,\n\tICE_FLOW_SEG_HDR_ETH\t\t= 0x00000001,\n\tICE_FLOW_SEG_HDR_VLAN\t\t= 0x00000002,\n\tICE_FLOW_SEG_HDR_IPV4\t\t= 0x00000004,\n\tICE_FLOW_SEG_HDR_IPV6\t\t= 0x00000008,\n\tICE_FLOW_SEG_HDR_ARP\t\t= 0x00000010,\n\tICE_FLOW_SEG_HDR_ICMP\t\t= 0x00000020,\n\tICE_FLOW_SEG_HDR_TCP\t\t= 0x00000040,\n\tICE_FLOW_SEG_HDR_UDP\t\t= 0x00000080,\n\tICE_FLOW_SEG_HDR_SCTP\t\t= 0x00000100,\n\tICE_FLOW_SEG_HDR_GRE\t\t= 0x00000200,\n\tICE_FLOW_SEG_HDR_GTPC\t\t= 0x00000400,\n\tICE_FLOW_SEG_HDR_GTPC_TEID\t= 0x00000800,\n\tICE_FLOW_SEG_HDR_GTPU_IP\t= 0x00001000,\n\tICE_FLOW_SEG_HDR_GTPU_EH\t= 0x00002000,\n\tICE_FLOW_SEG_HDR_GTPU_DWN\t= 0x00004000,\n\tICE_FLOW_SEG_HDR_GTPU_UP\t= 0x00008000,\n\tICE_FLOW_SEG_HDR_PPPOE\t\t= 0x00010000,\n\tICE_FLOW_SEG_HDR_PFCP_NODE\t= 0x00020000,\n\tICE_FLOW_SEG_HDR_PFCP_SESSION\t= 0x00040000,\n\tICE_FLOW_SEG_HDR_L2TPV3\t\t= 0x00080000,\n\tICE_FLOW_SEG_HDR_ESP\t\t= 0x00100000,\n\tICE_FLOW_SEG_HDR_AH\t\t= 0x00200000,\n\tICE_FLOW_SEG_HDR_NAT_T_ESP\t= 0x00400000,\n\tICE_FLOW_SEG_HDR_ETH_NON_IP\t= 0x00800000,\n\t \n\tICE_FLOW_SEG_HDR_IPV_OTHER      = 0x20000000,\n};\n\n \n#define ICE_FLOW_SEG_HDR_GTPU (ICE_FLOW_SEG_HDR_GTPU_IP | \\\n\t\t\t       ICE_FLOW_SEG_HDR_GTPU_EH | \\\n\t\t\t       ICE_FLOW_SEG_HDR_GTPU_DWN | \\\n\t\t\t       ICE_FLOW_SEG_HDR_GTPU_UP)\n#define ICE_FLOW_SEG_HDR_PFCP (ICE_FLOW_SEG_HDR_PFCP_NODE | \\\n\t\t\t       ICE_FLOW_SEG_HDR_PFCP_SESSION)\n\nenum ice_flow_field {\n\t \n\tICE_FLOW_FIELD_IDX_ETH_DA,\n\tICE_FLOW_FIELD_IDX_ETH_SA,\n\tICE_FLOW_FIELD_IDX_S_VLAN,\n\tICE_FLOW_FIELD_IDX_C_VLAN,\n\tICE_FLOW_FIELD_IDX_ETH_TYPE,\n\t \n\tICE_FLOW_FIELD_IDX_IPV4_DSCP,\n\tICE_FLOW_FIELD_IDX_IPV6_DSCP,\n\tICE_FLOW_FIELD_IDX_IPV4_TTL,\n\tICE_FLOW_FIELD_IDX_IPV4_PROT,\n\tICE_FLOW_FIELD_IDX_IPV6_TTL,\n\tICE_FLOW_FIELD_IDX_IPV6_PROT,\n\tICE_FLOW_FIELD_IDX_IPV4_SA,\n\tICE_FLOW_FIELD_IDX_IPV4_DA,\n\tICE_FLOW_FIELD_IDX_IPV6_SA,\n\tICE_FLOW_FIELD_IDX_IPV6_DA,\n\t \n\tICE_FLOW_FIELD_IDX_TCP_SRC_PORT,\n\tICE_FLOW_FIELD_IDX_TCP_DST_PORT,\n\tICE_FLOW_FIELD_IDX_UDP_SRC_PORT,\n\tICE_FLOW_FIELD_IDX_UDP_DST_PORT,\n\tICE_FLOW_FIELD_IDX_SCTP_SRC_PORT,\n\tICE_FLOW_FIELD_IDX_SCTP_DST_PORT,\n\tICE_FLOW_FIELD_IDX_TCP_FLAGS,\n\t \n\tICE_FLOW_FIELD_IDX_ARP_SIP,\n\tICE_FLOW_FIELD_IDX_ARP_DIP,\n\tICE_FLOW_FIELD_IDX_ARP_SHA,\n\tICE_FLOW_FIELD_IDX_ARP_DHA,\n\tICE_FLOW_FIELD_IDX_ARP_OP,\n\t \n\tICE_FLOW_FIELD_IDX_ICMP_TYPE,\n\tICE_FLOW_FIELD_IDX_ICMP_CODE,\n\t \n\tICE_FLOW_FIELD_IDX_GRE_KEYID,\n\t \n\tICE_FLOW_FIELD_IDX_GTPC_TEID,\n\t \n\tICE_FLOW_FIELD_IDX_GTPU_IP_TEID,\n\t \n\tICE_FLOW_FIELD_IDX_GTPU_EH_TEID,\n\tICE_FLOW_FIELD_IDX_GTPU_EH_QFI,\n\t \n\tICE_FLOW_FIELD_IDX_GTPU_UP_TEID,\n\t \n\tICE_FLOW_FIELD_IDX_GTPU_DWN_TEID,\n\t \n\tICE_FLOW_FIELD_IDX_PPPOE_SESS_ID,\n\t \n\tICE_FLOW_FIELD_IDX_PFCP_SEID,\n\t \n\tICE_FLOW_FIELD_IDX_L2TPV3_SESS_ID,\n\t \n\tICE_FLOW_FIELD_IDX_ESP_SPI,\n\t \n\tICE_FLOW_FIELD_IDX_AH_SPI,\n\t \n\tICE_FLOW_FIELD_IDX_NAT_T_ESP_SPI,\n\t  \n\tICE_FLOW_FIELD_IDX_MAX\n};\n\n \nenum ice_flow_avf_hdr_field {\n\t \n\tICE_AVF_FLOW_FIELD_INVALID\t\t= 0,\n\tICE_AVF_FLOW_FIELD_UNICAST_IPV4_UDP\t= 29,\n\tICE_AVF_FLOW_FIELD_MULTICAST_IPV4_UDP,\n\tICE_AVF_FLOW_FIELD_IPV4_UDP,\n\tICE_AVF_FLOW_FIELD_IPV4_TCP_SYN_NO_ACK,\n\tICE_AVF_FLOW_FIELD_IPV4_TCP,\n\tICE_AVF_FLOW_FIELD_IPV4_SCTP,\n\tICE_AVF_FLOW_FIELD_IPV4_OTHER,\n\tICE_AVF_FLOW_FIELD_FRAG_IPV4,\n\t \n\tICE_AVF_FLOW_FIELD_UNICAST_IPV6_UDP\t= 39,\n\tICE_AVF_FLOW_FIELD_MULTICAST_IPV6_UDP,\n\tICE_AVF_FLOW_FIELD_IPV6_UDP,\n\tICE_AVF_FLOW_FIELD_IPV6_TCP_SYN_NO_ACK,\n\tICE_AVF_FLOW_FIELD_IPV6_TCP,\n\tICE_AVF_FLOW_FIELD_IPV6_SCTP,\n\tICE_AVF_FLOW_FIELD_IPV6_OTHER,\n\tICE_AVF_FLOW_FIELD_FRAG_IPV6,\n\tICE_AVF_FLOW_FIELD_RSVD47,\n\tICE_AVF_FLOW_FIELD_FCOE_OX,\n\tICE_AVF_FLOW_FIELD_FCOE_RX,\n\tICE_AVF_FLOW_FIELD_FCOE_OTHER,\n\t \n\tICE_AVF_FLOW_FIELD_L2_PAYLOAD\t\t= 63,\n\tICE_AVF_FLOW_FIELD_MAX\n};\n\n \n#define ICE_DEFAULT_RSS_HENA ( \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV4_UDP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV4_SCTP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV4_TCP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV4_OTHER) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_FRAG_IPV4) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV6_UDP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV6_TCP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV6_SCTP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV6_OTHER) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_FRAG_IPV6) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV4_TCP_SYN_NO_ACK) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_UNICAST_IPV4_UDP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_MULTICAST_IPV4_UDP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_IPV6_TCP_SYN_NO_ACK) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_UNICAST_IPV6_UDP) | \\\n\tBIT_ULL(ICE_AVF_FLOW_FIELD_MULTICAST_IPV6_UDP))\n\nenum ice_flow_dir {\n\tICE_FLOW_RX\t\t= 0x02,\n};\n\nenum ice_flow_priority {\n\tICE_FLOW_PRIO_LOW,\n\tICE_FLOW_PRIO_NORMAL,\n\tICE_FLOW_PRIO_HIGH\n};\n\n#define ICE_FLOW_SEG_MAX\t\t2\n#define ICE_FLOW_SEG_RAW_FLD_MAX\t2\n#define ICE_FLOW_FV_EXTRACT_SZ\t\t2\n\n#define ICE_FLOW_SET_HDRS(seg, val)\t((seg)->hdrs |= (u32)(val))\n\nstruct ice_flow_seg_xtrct {\n\tu8 prot_id;\t \n\tu16 off;\t \n\tu8 idx;\t\t \n\tu8 disp;\t \n\tu16 mask;\t \n};\n\nenum ice_flow_fld_match_type {\n\tICE_FLOW_FLD_TYPE_REG,\t\t \n\tICE_FLOW_FLD_TYPE_RANGE,\t \n\tICE_FLOW_FLD_TYPE_PREFIX,\t \n\tICE_FLOW_FLD_TYPE_SIZE,\t\t \n};\n\nstruct ice_flow_fld_loc {\n\t \n\tu16 val;\t \n\tu16 mask;\t \n\tu16 last;\t \n};\n\nstruct ice_flow_fld_info {\n\tenum ice_flow_fld_match_type type;\n\t \n\tstruct ice_flow_fld_loc src;\n\t \n\tstruct ice_flow_fld_loc entry;\n\tstruct ice_flow_seg_xtrct xtrct;\n};\n\nstruct ice_flow_seg_fld_raw {\n\tstruct ice_flow_fld_info info;\n\tu16 off;\t \n};\n\nstruct ice_flow_seg_info {\n\tu32 hdrs;\t \n\tu64 match;\t \n\tu64 range;\t \n\n\tstruct ice_flow_fld_info fields[ICE_FLOW_FIELD_IDX_MAX];\n\n\tu8 raws_cnt;\t \n\tstruct ice_flow_seg_fld_raw raws[ICE_FLOW_SEG_RAW_FLD_MAX];\n};\n\n \nstruct ice_flow_entry {\n\tstruct list_head l_entry;\n\n\tu64 id;\n\tstruct ice_flow_prof *prof;\n\t \n\tvoid *entry;\n\tenum ice_flow_priority priority;\n\tu16 vsi_handle;\n\tu16 entry_sz;\n};\n\n#define ICE_FLOW_ENTRY_HNDL(e)\t((u64)(uintptr_t)e)\n#define ICE_FLOW_ENTRY_PTR(h)\t((struct ice_flow_entry *)(uintptr_t)(h))\n\nstruct ice_flow_prof {\n\tstruct list_head l_entry;\n\n\tu64 id;\n\tenum ice_flow_dir dir;\n\tu8 segs_cnt;\n\n\t \n\tstruct mutex entries_lock;\n\tstruct list_head entries;\n\n\tstruct ice_flow_seg_info segs[ICE_FLOW_SEG_MAX];\n\n\t \n\tDECLARE_BITMAP(vsis, ICE_MAX_VSI);\n};\n\nstruct ice_rss_cfg {\n\tstruct list_head l_entry;\n\t \n\tDECLARE_BITMAP(vsis, ICE_MAX_VSI);\n\tu64 hashed_flds;\n\tu32 packet_hdr;\n};\n\nint\nice_flow_add_prof(struct ice_hw *hw, enum ice_block blk, enum ice_flow_dir dir,\n\t\t  u64 prof_id, struct ice_flow_seg_info *segs, u8 segs_cnt,\n\t\t  struct ice_flow_prof **prof);\nint ice_flow_rem_prof(struct ice_hw *hw, enum ice_block blk, u64 prof_id);\nint\nice_flow_add_entry(struct ice_hw *hw, enum ice_block blk, u64 prof_id,\n\t\t   u64 entry_id, u16 vsi, enum ice_flow_priority prio,\n\t\t   void *data, u64 *entry_h);\nint ice_flow_rem_entry(struct ice_hw *hw, enum ice_block blk, u64 entry_h);\nvoid\nice_flow_set_fld(struct ice_flow_seg_info *seg, enum ice_flow_field fld,\n\t\t u16 val_loc, u16 mask_loc, u16 last_loc, bool range);\nvoid\nice_flow_add_fld_raw(struct ice_flow_seg_info *seg, u16 off, u8 len,\n\t\t     u16 val_loc, u16 mask_loc);\nint ice_flow_rem_vsi_prof(struct ice_hw *hw, u16 vsi_handle, u64 prof_id);\nvoid ice_rem_vsi_rss_list(struct ice_hw *hw, u16 vsi_handle);\nint ice_replay_rss_cfg(struct ice_hw *hw, u16 vsi_handle);\nint ice_add_avf_rss_cfg(struct ice_hw *hw, u16 vsi_handle, u64 hashed_flds);\nint ice_rem_vsi_rss_cfg(struct ice_hw *hw, u16 vsi_handle);\nint\nice_add_rss_cfg(struct ice_hw *hw, u16 vsi_handle, u64 hashed_flds,\n\t\tu32 addl_hdrs);\nint\nice_rem_rss_cfg(struct ice_hw *hw, u16 vsi_handle, u64 hashed_flds,\n\t\tu32 addl_hdrs);\nu64 ice_get_rss_cfg(struct ice_hw *hw, u16 vsi_handle, u32 hdrs);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}