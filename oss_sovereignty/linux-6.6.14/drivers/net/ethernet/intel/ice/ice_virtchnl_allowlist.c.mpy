{
  "module_name": "ice_virtchnl_allowlist.c",
  "hash_id": "ea7be479ca3e7f888704de4810321974b85b4b46e2e72c0fa0f2a7be707598d1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/intel/ice/ice_virtchnl_allowlist.c",
  "human_readable_source": "\n \n\n#include \"ice_virtchnl_allowlist.h\"\n\n \n\n \nstatic const u32 default_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_GET_VF_RESOURCES, VIRTCHNL_OP_VERSION, VIRTCHNL_OP_RESET_VF,\n};\n\n \nstatic const u32 working_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_CONFIG_TX_QUEUE, VIRTCHNL_OP_CONFIG_RX_QUEUE,\n\tVIRTCHNL_OP_CONFIG_VSI_QUEUES, VIRTCHNL_OP_CONFIG_IRQ_MAP,\n\tVIRTCHNL_OP_ENABLE_QUEUES, VIRTCHNL_OP_DISABLE_QUEUES,\n\tVIRTCHNL_OP_GET_STATS, VIRTCHNL_OP_EVENT,\n};\n\n \nstatic const u32 l2_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_ADD_ETH_ADDR, VIRTCHNL_OP_DEL_ETH_ADDR,\n\tVIRTCHNL_OP_CONFIG_PROMISCUOUS_MODE,\n};\n\n \nstatic const u32 req_queues_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_REQUEST_QUEUES,\n};\n\n \nstatic const u32 vlan_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_ADD_VLAN, VIRTCHNL_OP_DEL_VLAN,\n\tVIRTCHNL_OP_ENABLE_VLAN_STRIPPING, VIRTCHNL_OP_DISABLE_VLAN_STRIPPING,\n};\n\n \nstatic const u32 vlan_v2_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_GET_OFFLOAD_VLAN_V2_CAPS, VIRTCHNL_OP_ADD_VLAN_V2,\n\tVIRTCHNL_OP_DEL_VLAN_V2, VIRTCHNL_OP_ENABLE_VLAN_STRIPPING_V2,\n\tVIRTCHNL_OP_DISABLE_VLAN_STRIPPING_V2,\n\tVIRTCHNL_OP_ENABLE_VLAN_INSERTION_V2,\n\tVIRTCHNL_OP_DISABLE_VLAN_INSERTION_V2,\n};\n\n \nstatic const u32 rss_pf_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_CONFIG_RSS_KEY, VIRTCHNL_OP_CONFIG_RSS_LUT,\n\tVIRTCHNL_OP_GET_RSS_HENA_CAPS, VIRTCHNL_OP_SET_RSS_HENA,\n};\n\n \nstatic const u32 rx_flex_desc_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_GET_SUPPORTED_RXDIDS,\n};\n\n \nstatic const u32 adv_rss_pf_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_ADD_RSS_CFG, VIRTCHNL_OP_DEL_RSS_CFG,\n};\n\n \nstatic const u32 fdir_pf_allowlist_opcodes[] = {\n\tVIRTCHNL_OP_ADD_FDIR_FILTER, VIRTCHNL_OP_DEL_FDIR_FILTER,\n};\n\nstruct allowlist_opcode_info {\n\tconst u32 *opcodes;\n\tsize_t size;\n};\n\n#define BIT_INDEX(caps) (HWEIGHT((caps) - 1))\n#define ALLOW_ITEM(caps, list) \\\n\t[BIT_INDEX(caps)] = { \\\n\t\t.opcodes = list, \\\n\t\t.size = ARRAY_SIZE(list) \\\n\t}\nstatic const struct allowlist_opcode_info allowlist_opcodes[] = {\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_L2, l2_allowlist_opcodes),\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_REQ_QUEUES, req_queues_allowlist_opcodes),\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_VLAN, vlan_allowlist_opcodes),\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_RSS_PF, rss_pf_allowlist_opcodes),\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_RX_FLEX_DESC, rx_flex_desc_allowlist_opcodes),\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_ADV_RSS_PF, adv_rss_pf_allowlist_opcodes),\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_FDIR_PF, fdir_pf_allowlist_opcodes),\n\tALLOW_ITEM(VIRTCHNL_VF_OFFLOAD_VLAN_V2, vlan_v2_allowlist_opcodes),\n};\n\n \nbool ice_vc_is_opcode_allowed(struct ice_vf *vf, u32 opcode)\n{\n\tif (opcode >= VIRTCHNL_OP_MAX)\n\t\treturn false;\n\n\treturn test_bit(opcode, vf->opcodes_allowlist);\n}\n\n \nstatic void\nice_vc_allowlist_opcodes(struct ice_vf *vf, const u32 *opcodes, size_t size)\n{\n\tunsigned int i;\n\n\tfor (i = 0; i < size; i++)\n\t\tset_bit(opcodes[i], vf->opcodes_allowlist);\n}\n\n \nstatic void ice_vc_clear_allowlist(struct ice_vf *vf)\n{\n\tbitmap_zero(vf->opcodes_allowlist, VIRTCHNL_OP_MAX);\n}\n\n \nvoid ice_vc_set_default_allowlist(struct ice_vf *vf)\n{\n\tice_vc_clear_allowlist(vf);\n\tice_vc_allowlist_opcodes(vf, default_allowlist_opcodes,\n\t\t\t\t ARRAY_SIZE(default_allowlist_opcodes));\n}\n\n \nvoid ice_vc_set_working_allowlist(struct ice_vf *vf)\n{\n\tice_vc_allowlist_opcodes(vf, working_allowlist_opcodes,\n\t\t\t\t ARRAY_SIZE(working_allowlist_opcodes));\n}\n\n \nvoid ice_vc_set_caps_allowlist(struct ice_vf *vf)\n{\n\tunsigned long caps = vf->driver_caps;\n\tunsigned int i;\n\n\tfor_each_set_bit(i, &caps, ARRAY_SIZE(allowlist_opcodes))\n\t\tice_vc_allowlist_opcodes(vf, allowlist_opcodes[i].opcodes,\n\t\t\t\t\t allowlist_opcodes[i].size);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}