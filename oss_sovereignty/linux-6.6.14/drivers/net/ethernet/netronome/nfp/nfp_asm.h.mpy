{
  "module_name": "nfp_asm.h",
  "hash_id": "a28dc89fd2b5daf03b38a5b9540b459e0117e2850db2fb42c54b7dedb5bc009e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/netronome/nfp/nfp_asm.h",
  "human_readable_source": " \n \n\n#ifndef __NFP_ASM_H__\n#define __NFP_ASM_H__ 1\n\n#include <linux/bitfield.h>\n#include <linux/bug.h>\n#include <linux/types.h>\n\n#define REG_NONE\t0\n#define REG_WIDTH\t4\n\n#define RE_REG_NO_DST\t0x020\n#define RE_REG_IMM\t0x020\n#define RE_REG_IMM_encode(x)\t\t\t\t\t\\\n\t(RE_REG_IMM | ((x) & 0x1f) | (((x) & 0x60) << 1))\n#define RE_REG_IMM_MAX\t 0x07fULL\n#define RE_REG_LM\t0x050\n#define RE_REG_LM_IDX\t0x008\n#define RE_REG_LM_IDX_MAX\t0x7\n#define RE_REG_XFR\t0x080\n\n#define UR_REG_XFR\t0x180\n#define UR_REG_LM\t0x200\n#define UR_REG_LM_IDX\t0x020\n#define UR_REG_LM_POST_MOD\t0x010\n#define UR_REG_LM_POST_MOD_DEC\t0x001\n#define UR_REG_LM_IDX_MAX\t0xf\n#define UR_REG_NN\t0x280\n#define UR_REG_NO_DST\t0x300\n#define UR_REG_IMM\tUR_REG_NO_DST\n#define UR_REG_IMM_encode(x) (UR_REG_IMM | (x))\n#define UR_REG_IMM_MAX\t 0x0ffULL\n\n#define OP_BR_BASE\t\t0x0d800000020ULL\n#define OP_BR_BASE_MASK\t\t0x0f8000c3ce0ULL\n#define OP_BR_MASK\t\t0x0000000001fULL\n#define OP_BR_EV_PIP\t\t0x00000000300ULL\n#define OP_BR_CSS\t\t0x0000003c000ULL\n#define OP_BR_DEFBR\t\t0x00000300000ULL\n#define OP_BR_ADDR_LO\t\t0x007ffc00000ULL\n#define OP_BR_ADDR_HI\t\t0x10000000000ULL\n\n#define OP_BR_BIT_BASE\t\t0x0d000000000ULL\n#define OP_BR_BIT_BASE_MASK\t0x0f800080300ULL\n#define OP_BR_BIT_A_SRC\t\t0x000000000ffULL\n#define OP_BR_BIT_B_SRC\t\t0x0000003fc00ULL\n#define OP_BR_BIT_BV\t\t0x00000040000ULL\n#define OP_BR_BIT_SRC_LMEXTN\t0x40000000000ULL\n#define OP_BR_BIT_DEFBR\t\tOP_BR_DEFBR\n#define OP_BR_BIT_ADDR_LO\tOP_BR_ADDR_LO\n#define OP_BR_BIT_ADDR_HI\tOP_BR_ADDR_HI\n\n#define OP_BR_ALU_BASE\t\t0x0e800000000ULL\n#define OP_BR_ALU_BASE_MASK\t0x0ff80000000ULL\n#define OP_BR_ALU_A_SRC\t\t0x000000003ffULL\n#define OP_BR_ALU_B_SRC\t\t0x000000ffc00ULL\n#define OP_BR_ALU_DEFBR\t\t0x00000300000ULL\n#define OP_BR_ALU_IMM_HI\t0x0007fc00000ULL\n#define OP_BR_ALU_SRC_LMEXTN\t0x40000000000ULL\n#define OP_BR_ALU_DST_LMEXTN\t0x80000000000ULL\n\nstatic inline bool nfp_is_br(u64 insn)\n{\n\treturn (insn & OP_BR_BASE_MASK) == OP_BR_BASE ||\n\t       (insn & OP_BR_BIT_BASE_MASK) == OP_BR_BIT_BASE;\n}\n\nenum br_mask {\n\tBR_BEQ = 0x00,\n\tBR_BNE = 0x01,\n\tBR_BMI = 0x02,\n\tBR_BHS = 0x04,\n\tBR_BCC = 0x05,\n\tBR_BLO = 0x05,\n\tBR_BGE = 0x08,\n\tBR_BLT = 0x09,\n\tBR_UNC = 0x18,\n};\n\nenum br_ev_pip {\n\tBR_EV_PIP_UNCOND = 0,\n\tBR_EV_PIP_COND = 1,\n};\n\nenum br_ctx_signal_state {\n\tBR_CSS_NONE = 2,\n};\n\nu16 br_get_offset(u64 instr);\nvoid br_set_offset(u64 *instr, u16 offset);\nvoid br_add_offset(u64 *instr, u16 offset);\n\n#define OP_BBYTE_BASE\t\t0x0c800000000ULL\n#define OP_BB_A_SRC\t\t0x000000000ffULL\n#define OP_BB_BYTE\t\t0x00000000300ULL\n#define OP_BB_B_SRC\t\t0x0000003fc00ULL\n#define OP_BB_I8\t\t0x00000040000ULL\n#define OP_BB_EQ\t\t0x00000080000ULL\n#define OP_BB_DEFBR\t\t0x00000300000ULL\n#define OP_BB_ADDR_LO\t\t0x007ffc00000ULL\n#define OP_BB_ADDR_HI\t\t0x10000000000ULL\n#define OP_BB_SRC_LMEXTN\t0x40000000000ULL\n\n#define OP_BALU_BASE\t\t0x0e800000000ULL\n#define OP_BA_A_SRC\t\t0x000000003ffULL\n#define OP_BA_B_SRC\t\t0x000000ffc00ULL\n#define OP_BA_DEFBR\t\t0x00000300000ULL\n#define OP_BA_ADDR_HI\t\t0x0007fc00000ULL\n\n#define OP_IMMED_A_SRC\t\t0x000000003ffULL\n#define OP_IMMED_B_SRC\t\t0x000000ffc00ULL\n#define OP_IMMED_IMM\t\t0x0000ff00000ULL\n#define OP_IMMED_WIDTH\t\t0x00060000000ULL\n#define OP_IMMED_INV\t\t0x00080000000ULL\n#define OP_IMMED_SHIFT\t\t0x00600000000ULL\n#define OP_IMMED_BASE\t\t0x0f000000000ULL\n#define OP_IMMED_WR_AB\t\t0x20000000000ULL\n#define OP_IMMED_SRC_LMEXTN\t0x40000000000ULL\n#define OP_IMMED_DST_LMEXTN\t0x80000000000ULL\n\nenum immed_width {\n\tIMMED_WIDTH_ALL = 0,\n\tIMMED_WIDTH_BYTE = 1,\n\tIMMED_WIDTH_WORD = 2,\n};\n\nenum immed_shift {\n\tIMMED_SHIFT_0B = 0,\n\tIMMED_SHIFT_1B = 1,\n\tIMMED_SHIFT_2B = 2,\n};\n\nu16 immed_get_value(u64 instr);\nvoid immed_set_value(u64 *instr, u16 immed);\nvoid immed_add_value(u64 *instr, u16 offset);\n\n#define OP_SHF_BASE\t\t0x08000000000ULL\n#define OP_SHF_A_SRC\t\t0x000000000ffULL\n#define OP_SHF_SC\t\t0x00000000300ULL\n#define OP_SHF_B_SRC\t\t0x0000003fc00ULL\n#define OP_SHF_I8\t\t0x00000040000ULL\n#define OP_SHF_SW\t\t0x00000080000ULL\n#define OP_SHF_DST\t\t0x0000ff00000ULL\n#define OP_SHF_SHIFT\t\t0x001f0000000ULL\n#define OP_SHF_OP\t\t0x00e00000000ULL\n#define OP_SHF_DST_AB\t\t0x01000000000ULL\n#define OP_SHF_WR_AB\t\t0x20000000000ULL\n#define OP_SHF_SRC_LMEXTN\t0x40000000000ULL\n#define OP_SHF_DST_LMEXTN\t0x80000000000ULL\n\nenum shf_op {\n\tSHF_OP_NONE = 0,\n\tSHF_OP_AND = 2,\n\tSHF_OP_OR = 5,\n\tSHF_OP_ASHR = 6,\n};\n\nenum shf_sc {\n\tSHF_SC_R_ROT = 0,\n\tSHF_SC_NONE = SHF_SC_R_ROT,\n\tSHF_SC_R_SHF = 1,\n\tSHF_SC_L_SHF = 2,\n\tSHF_SC_R_DSHF = 3,\n};\n\n#define OP_ALU_A_SRC\t\t0x000000003ffULL\n#define OP_ALU_B_SRC\t\t0x000000ffc00ULL\n#define OP_ALU_DST\t\t0x0003ff00000ULL\n#define OP_ALU_SW\t\t0x00040000000ULL\n#define OP_ALU_OP\t\t0x00f80000000ULL\n#define OP_ALU_DST_AB\t\t0x01000000000ULL\n#define OP_ALU_BASE\t\t0x0a000000000ULL\n#define OP_ALU_WR_AB\t\t0x20000000000ULL\n#define OP_ALU_SRC_LMEXTN\t0x40000000000ULL\n#define OP_ALU_DST_LMEXTN\t0x80000000000ULL\n\nenum alu_op {\n\tALU_OP_NONE\t\t= 0x00,\n\tALU_OP_ADD\t\t= 0x01,\n\tALU_OP_NOT\t\t= 0x04,\n\tALU_OP_ADD_2B\t\t= 0x05,\n\tALU_OP_AND\t\t= 0x08,\n\tALU_OP_AND_NOT_A\t= 0x0c,\n\tALU_OP_SUB_C\t\t= 0x0d,\n\tALU_OP_AND_NOT_B\t= 0x10,\n\tALU_OP_ADD_C\t\t= 0x11,\n\tALU_OP_OR\t\t= 0x14,\n\tALU_OP_SUB\t\t= 0x15,\n\tALU_OP_XOR\t\t= 0x18,\n};\n\nenum alu_dst_ab {\n\tALU_DST_A = 0,\n\tALU_DST_B = 1,\n};\n\n#define OP_LDF_BASE\t\t0x0c000000000ULL\n#define OP_LDF_A_SRC\t\t0x000000000ffULL\n#define OP_LDF_SC\t\t0x00000000300ULL\n#define OP_LDF_B_SRC\t\t0x0000003fc00ULL\n#define OP_LDF_I8\t\t0x00000040000ULL\n#define OP_LDF_SW\t\t0x00000080000ULL\n#define OP_LDF_ZF\t\t0x00000100000ULL\n#define OP_LDF_BMASK\t\t0x0000f000000ULL\n#define OP_LDF_SHF\t\t0x001f0000000ULL\n#define OP_LDF_WR_AB\t\t0x20000000000ULL\n#define OP_LDF_SRC_LMEXTN\t0x40000000000ULL\n#define OP_LDF_DST_LMEXTN\t0x80000000000ULL\n\n#define OP_CMD_A_SRC\t\t0x000000000ffULL\n#define OP_CMD_CTX\t\t0x00000000300ULL\n#define OP_CMD_B_SRC\t\t0x0000003fc00ULL\n#define OP_CMD_TOKEN\t\t0x000000c0000ULL\n#define OP_CMD_XFER\t\t0x00001f00000ULL\n#define OP_CMD_CNT\t\t0x0000e000000ULL\n#define OP_CMD_SIG\t\t0x000f0000000ULL\n#define OP_CMD_TGT_CMD\t\t0x07f00000000ULL\n#define OP_CMD_INDIR\t\t0x20000000000ULL\n#define OP_CMD_MODE\t       0x1c0000000000ULL\n\nstruct cmd_tgt_act {\n\tu8 token;\n\tu8 tgt_cmd;\n};\n\nenum cmd_tgt_map {\n\tCMD_TGT_READ8,\n\tCMD_TGT_WRITE8_SWAP,\n\tCMD_TGT_WRITE32_SWAP,\n\tCMD_TGT_READ32,\n\tCMD_TGT_READ32_LE,\n\tCMD_TGT_READ32_SWAP,\n\tCMD_TGT_READ_LE,\n\tCMD_TGT_READ_SWAP_LE,\n\tCMD_TGT_ADD,\n\tCMD_TGT_ADD_IMM,\n\t__CMD_TGT_MAP_SIZE,\n};\n\nextern const struct cmd_tgt_act cmd_tgt_act[__CMD_TGT_MAP_SIZE];\n\nenum cmd_mode {\n\tCMD_MODE_40b_AB\t= 0,\n\tCMD_MODE_40b_BA\t= 1,\n\tCMD_MODE_32b\t= 4,\n};\n\nenum cmd_ctx_swap {\n\tCMD_CTX_SWAP = 0,\n\tCMD_CTX_SWAP_DEFER1 = 1,\n\tCMD_CTX_SWAP_DEFER2 = 2,\n\tCMD_CTX_NO_SWAP = 3,\n};\n\n#define CMD_OVE_DATA\tGENMASK(5, 3)\n#define CMD_OVE_LEN\tBIT(7)\n#define CMD_OV_LEN\tGENMASK(12, 8)\n\n#define OP_LCSR_BASE\t\t0x0fc00000000ULL\n#define OP_LCSR_A_SRC\t\t0x000000003ffULL\n#define OP_LCSR_B_SRC\t\t0x000000ffc00ULL\n#define OP_LCSR_WRITE\t\t0x00000200000ULL\n#define OP_LCSR_ADDR\t\t0x001ffc00000ULL\n#define OP_LCSR_SRC_LMEXTN\t0x40000000000ULL\n#define OP_LCSR_DST_LMEXTN\t0x80000000000ULL\n\nenum lcsr_wr_src {\n\tLCSR_WR_AREG,\n\tLCSR_WR_BREG,\n\tLCSR_WR_IMM,\n};\n\n#define OP_CARB_BASE\t\t0x0e000000000ULL\n#define OP_CARB_OR\t\t0x00000010000ULL\n\n#define NFP_CSR_CTX_PTR\t\t0x20\n#define NFP_CSR_ACT_LM_ADDR0\t0x64\n#define NFP_CSR_ACT_LM_ADDR1\t0x6c\n#define NFP_CSR_ACT_LM_ADDR2\t0x94\n#define NFP_CSR_ACT_LM_ADDR3\t0x9c\n#define NFP_CSR_PSEUDO_RND_NUM\t0x148\n\n \n#define NN_REG_TYPE\tGENMASK(31, 24)\n#define NN_REG_LM_IDX\tGENMASK(23, 22)\n#define NN_REG_LM_IDX_HI\tBIT(23)\n#define NN_REG_LM_IDX_LO\tBIT(22)\n#define NN_REG_LM_MOD\tGENMASK(21, 20)\n#define NN_REG_VAL\tGENMASK(7, 0)\n\nenum nfp_bpf_reg_type {\n\tNN_REG_GPR_A =\tBIT(0),\n\tNN_REG_GPR_B =\tBIT(1),\n\tNN_REG_GPR_BOTH = NN_REG_GPR_A | NN_REG_GPR_B,\n\tNN_REG_NNR =\tBIT(2),\n\tNN_REG_XFER =\tBIT(3),\n\tNN_REG_IMM =\tBIT(4),\n\tNN_REG_NONE =\tBIT(5),\n\tNN_REG_LMEM =\tBIT(6),\n};\n\nenum nfp_bpf_lm_mode {\n\tNN_LM_MOD_NONE = 0,\n\tNN_LM_MOD_INC,\n\tNN_LM_MOD_DEC,\n};\n\n#define reg_both(x)\t__enc_swreg((x), NN_REG_GPR_BOTH)\n#define reg_a(x)\t__enc_swreg((x), NN_REG_GPR_A)\n#define reg_b(x)\t__enc_swreg((x), NN_REG_GPR_B)\n#define reg_nnr(x)\t__enc_swreg((x), NN_REG_NNR)\n#define reg_xfer(x)\t__enc_swreg((x), NN_REG_XFER)\n#define reg_imm(x)\t__enc_swreg((x), NN_REG_IMM)\n#define reg_none()\t__enc_swreg(0, NN_REG_NONE)\n#define reg_lm(x, off)\t__enc_swreg_lm((x), NN_LM_MOD_NONE, (off))\n#define reg_lm_inc(x)\t__enc_swreg_lm((x), NN_LM_MOD_INC, 0)\n#define reg_lm_dec(x)\t__enc_swreg_lm((x), NN_LM_MOD_DEC, 0)\n#define __reg_lm(x, mod, off)\t__enc_swreg_lm((x), (mod), (off))\n\ntypedef __u32 __bitwise swreg;\n\nstatic inline swreg __enc_swreg(u16 id, u8 type)\n{\n\treturn (__force swreg)(id | FIELD_PREP(NN_REG_TYPE, type));\n}\n\nstatic inline swreg __enc_swreg_lm(u8 id, enum nfp_bpf_lm_mode mode, u8 off)\n{\n\tWARN_ON(id > 3 || (off && mode != NN_LM_MOD_NONE));\n\n\treturn (__force swreg)(FIELD_PREP(NN_REG_TYPE, NN_REG_LMEM) |\n\t\t\t       FIELD_PREP(NN_REG_LM_IDX, id) |\n\t\t\t       FIELD_PREP(NN_REG_LM_MOD, mode) |\n\t\t\t       off);\n}\n\nstatic inline u32 swreg_raw(swreg reg)\n{\n\treturn (__force u32)reg;\n}\n\nstatic inline enum nfp_bpf_reg_type swreg_type(swreg reg)\n{\n\treturn FIELD_GET(NN_REG_TYPE, swreg_raw(reg));\n}\n\nstatic inline u16 swreg_value(swreg reg)\n{\n\treturn FIELD_GET(NN_REG_VAL, swreg_raw(reg));\n}\n\nstatic inline bool swreg_lm_idx(swreg reg)\n{\n\treturn FIELD_GET(NN_REG_LM_IDX_LO, swreg_raw(reg));\n}\n\nstatic inline bool swreg_lmextn(swreg reg)\n{\n\treturn FIELD_GET(NN_REG_LM_IDX_HI, swreg_raw(reg));\n}\n\nstatic inline enum nfp_bpf_lm_mode swreg_lm_mode(swreg reg)\n{\n\treturn FIELD_GET(NN_REG_LM_MOD, swreg_raw(reg));\n}\n\nstruct nfp_insn_ur_regs {\n\tenum alu_dst_ab dst_ab;\n\tu16 dst;\n\tu16 areg, breg;\n\tbool swap;\n\tbool wr_both;\n\tbool dst_lmextn;\n\tbool src_lmextn;\n};\n\nstruct nfp_insn_re_regs {\n\tenum alu_dst_ab dst_ab;\n\tu8 dst;\n\tu8 areg, breg;\n\tbool swap;\n\tbool wr_both;\n\tbool i8;\n\tbool dst_lmextn;\n\tbool src_lmextn;\n};\n\nint swreg_to_unrestricted(swreg dst, swreg lreg, swreg rreg,\n\t\t\t  struct nfp_insn_ur_regs *reg);\nint swreg_to_restricted(swreg dst, swreg lreg, swreg rreg,\n\t\t\tstruct nfp_insn_re_regs *reg, bool has_imm8);\n\n#define NFP_USTORE_PREFETCH_WINDOW\t8\n\nint nfp_ustore_check_valid_no_ecc(u64 insn);\nu64 nfp_ustore_calc_ecc_insn(u64 insn);\n\n#define NFP_IND_ME_REFL_WR_SIG_INIT\t3\n#define NFP_IND_ME_CTX_PTR_BASE_MASK\tGENMASK(9, 0)\n#define NFP_IND_NUM_CONTEXTS\t\t8\n\nstatic inline u32 nfp_get_ind_csr_ctx_ptr_offs(u32 read_offset)\n{\n\treturn (read_offset & ~NFP_IND_ME_CTX_PTR_BASE_MASK) | NFP_CSR_CTX_PTR;\n}\n\nenum mul_type {\n\tMUL_TYPE_START\t\t= 0x00,\n\tMUL_TYPE_STEP_24x8\t= 0x01,\n\tMUL_TYPE_STEP_16x16\t= 0x02,\n\tMUL_TYPE_STEP_32x32\t= 0x03,\n};\n\nenum mul_step {\n\tMUL_STEP_1\t\t= 0x00,\n\tMUL_STEP_NONE\t\t= MUL_STEP_1,\n\tMUL_STEP_2\t\t= 0x01,\n\tMUL_STEP_3\t\t= 0x02,\n\tMUL_STEP_4\t\t= 0x03,\n\tMUL_LAST\t\t= 0x04,\n\tMUL_LAST_2\t\t= 0x05,\n};\n\n#define OP_MUL_BASE\t\t0x0f800000000ULL\n#define OP_MUL_A_SRC\t\t0x000000003ffULL\n#define OP_MUL_B_SRC\t\t0x000000ffc00ULL\n#define OP_MUL_STEP\t\t0x00000700000ULL\n#define OP_MUL_DST_AB\t\t0x00000800000ULL\n#define OP_MUL_SW\t\t0x00040000000ULL\n#define OP_MUL_TYPE\t\t0x00180000000ULL\n#define OP_MUL_WR_AB\t\t0x20000000000ULL\n#define OP_MUL_SRC_LMEXTN\t0x40000000000ULL\n#define OP_MUL_DST_LMEXTN\t0x80000000000ULL\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}