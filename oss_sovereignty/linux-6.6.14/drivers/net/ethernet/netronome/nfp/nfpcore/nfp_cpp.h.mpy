{
  "module_name": "nfp_cpp.h",
  "hash_id": "d108eb0fb239b05c93b03097f181b0122ac38cecf26adc3478d226b0d4d866d1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_cpp.h",
  "human_readable_source": " \n \n\n \n#ifndef __NFP_CPP_H__\n#define __NFP_CPP_H__\n\n#include <linux/ctype.h>\n#include <linux/types.h>\n#include <linux/sizes.h>\n\n#ifndef NFP_SUBSYS\n#define NFP_SUBSYS \"nfp\"\n#endif\n\n#define nfp_err(cpp, fmt, args...) \\\n\tdev_err(nfp_cpp_device(cpp)->parent, NFP_SUBSYS \": \" fmt, ## args)\n#define nfp_warn(cpp, fmt, args...) \\\n\tdev_warn(nfp_cpp_device(cpp)->parent, NFP_SUBSYS \": \" fmt, ## args)\n#define nfp_info(cpp, fmt, args...) \\\n\tdev_info(nfp_cpp_device(cpp)->parent, NFP_SUBSYS \": \" fmt, ## args)\n#define nfp_dbg(cpp, fmt, args...) \\\n\tdev_dbg(nfp_cpp_device(cpp)->parent, NFP_SUBSYS \": \" fmt, ## args)\n#define nfp_printk(level, cpp, fmt, args...) \\\n\tdev_printk(level, nfp_cpp_device(cpp)->parent,\t\\\n\t\t   NFP_SUBSYS \": \" fmt,\t## args)\n\n#define PCI_64BIT_BAR_COUNT             3\n\n#define NFP_CPP_NUM_TARGETS             16\n \n#define NFP_CPP_SAFE_AREA_SIZE\t\tSZ_2M\n\n \n#define NFP_MUTEX_WAIT_FIRST_WARN\t15\n#define NFP_MUTEX_WAIT_NEXT_WARN\t5\n#define NFP_MUTEX_WAIT_ERROR\t\t60\n\nstruct device;\n\nstruct nfp_cpp_area;\nstruct nfp_cpp;\nstruct resource;\n\n \n#define NFP_CPP_ACTION_RW               32\n\n#define NFP_CPP_TARGET_ID_MASK          0x1f\n\n#define NFP_CPP_ATOMIC_RD(target, island) \\\n\tNFP_CPP_ISLAND_ID((target), 3, 0, (island))\n#define NFP_CPP_ATOMIC_WR(target, island) \\\n\tNFP_CPP_ISLAND_ID((target), 4, 0, (island))\n\n \n#define NFP_CPP_ID(target, action, token)\t\t\t \\\n\t((((target) & 0x7f) << 24) | (((token)  & 0xff) << 16) | \\\n\t (((action) & 0xff) <<  8))\n\n \n#define NFP_CPP_ISLAND_ID(target, action, token, island)\t \\\n\t((((target) & 0x7f) << 24) | (((token)  & 0xff) << 16) | \\\n\t (((action) & 0xff) <<  8) | (((island) & 0xff) << 0))\n\n \nstatic inline u8 NFP_CPP_ID_TARGET_of(u32 id)\n{\n\treturn (id >> 24) & NFP_CPP_TARGET_ID_MASK;\n}\n\n \nstatic inline u8 NFP_CPP_ID_TOKEN_of(u32 id)\n{\n\treturn (id >> 16) & 0xff;\n}\n\n \nstatic inline u8 NFP_CPP_ID_ACTION_of(u32 id)\n{\n\treturn (id >> 8) & 0xff;\n}\n\n \nstatic inline u8 NFP_CPP_ID_ISLAND_of(u32 id)\n{\n\treturn (id >> 0) & 0xff;\n}\n\n \n#define NFP_CPP_INTERFACE_TYPE_INVALID      0x0\n#define NFP_CPP_INTERFACE_TYPE_PCI          0x1\n#define NFP_CPP_INTERFACE_TYPE_ARM          0x2\n#define NFP_CPP_INTERFACE_TYPE_RPC          0x3\n#define NFP_CPP_INTERFACE_TYPE_ILA          0x4\n\n \n#define NFP_CPP_INTERFACE(type, unit, channel)\t\\\n\t((((type) & 0xf) << 12) |\t\t\\\n\t (((unit) & 0xf) <<  8) |\t\t\\\n\t (((channel) & 0xff) << 0))\n\n \n#define NFP_CPP_INTERFACE_TYPE_of(interface)   (((interface) >> 12) & 0xf)\n\n \n#define NFP_CPP_INTERFACE_UNIT_of(interface)   (((interface) >>  8) & 0xf)\n\n \n#define NFP_CPP_INTERFACE_CHANNEL_of(interface)   (((interface) >>  0) & 0xff)\n\n \nvoid nfp_cpp_free(struct nfp_cpp *cpp);\nu32 nfp_cpp_model(struct nfp_cpp *cpp);\nu16 nfp_cpp_interface(struct nfp_cpp *cpp);\nint nfp_cpp_serial(struct nfp_cpp *cpp, const u8 **serial);\nunsigned int nfp_cpp_mu_locality_lsb(struct nfp_cpp *cpp);\n\nstruct nfp_cpp_area *nfp_cpp_area_alloc_with_name(struct nfp_cpp *cpp,\n\t\t\t\t\t\t  u32 cpp_id,\n\t\t\t\t\t\t  const char *name,\n\t\t\t\t\t\t  unsigned long long address,\n\t\t\t\t\t\t  unsigned long size);\nstruct nfp_cpp_area *nfp_cpp_area_alloc(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t\t\t\tunsigned long long address,\n\t\t\t\t\tunsigned long size);\nstruct nfp_cpp_area *\nnfp_cpp_area_alloc_acquire(struct nfp_cpp *cpp, const char *name, u32 cpp_id,\n\t\t\t   unsigned long long address, unsigned long size);\nvoid nfp_cpp_area_free(struct nfp_cpp_area *area);\nint nfp_cpp_area_acquire(struct nfp_cpp_area *area);\nint nfp_cpp_area_acquire_nonblocking(struct nfp_cpp_area *area);\nvoid nfp_cpp_area_release(struct nfp_cpp_area *area);\nvoid nfp_cpp_area_release_free(struct nfp_cpp_area *area);\nint nfp_cpp_area_read(struct nfp_cpp_area *area, unsigned long offset,\n\t\t      void *buffer, size_t length);\nint nfp_cpp_area_write(struct nfp_cpp_area *area, unsigned long offset,\n\t\t       const void *buffer, size_t length);\nsize_t nfp_cpp_area_size(struct nfp_cpp_area *area);\nconst char *nfp_cpp_area_name(struct nfp_cpp_area *cpp_area);\nvoid *nfp_cpp_area_priv(struct nfp_cpp_area *cpp_area);\nstruct nfp_cpp *nfp_cpp_area_cpp(struct nfp_cpp_area *cpp_area);\nstruct resource *nfp_cpp_area_resource(struct nfp_cpp_area *area);\nphys_addr_t nfp_cpp_area_phys(struct nfp_cpp_area *area);\nvoid __iomem *nfp_cpp_area_iomem(struct nfp_cpp_area *area);\n\nint nfp_cpp_area_readl(struct nfp_cpp_area *area, unsigned long offset,\n\t\t       u32 *value);\nint nfp_cpp_area_writel(struct nfp_cpp_area *area, unsigned long offset,\n\t\t\tu32 value);\nint nfp_cpp_area_readq(struct nfp_cpp_area *area, unsigned long offset,\n\t\t       u64 *value);\nint nfp_cpp_area_writeq(struct nfp_cpp_area *area, unsigned long offset,\n\t\t\tu64 value);\nint nfp_cpp_area_fill(struct nfp_cpp_area *area, unsigned long offset,\n\t\t      u32 value, size_t length);\n\nint nfp_xpb_readl(struct nfp_cpp *cpp, u32 xpb_tgt, u32 *value);\nint nfp_xpb_writel(struct nfp_cpp *cpp, u32 xpb_tgt, u32 value);\nint nfp_xpb_writelm(struct nfp_cpp *cpp, u32 xpb_tgt, u32 mask, u32 value);\n\n \nint nfp_cpp_read(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t unsigned long long address, void *kernel_vaddr, size_t length);\nint nfp_cpp_write(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t  unsigned long long address, const void *kernel_vaddr,\n\t\t  size_t length);\nint nfp_cpp_readl(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t  unsigned long long address, u32 *value);\nint nfp_cpp_writel(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t   unsigned long long address, u32 value);\nint nfp_cpp_readq(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t  unsigned long long address, u64 *value);\nint nfp_cpp_writeq(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t   unsigned long long address, u64 value);\n\nu8 __iomem *\nnfp_cpp_map_area(struct nfp_cpp *cpp, const char *name, u32 cpp_id, u64 addr,\n\t\t unsigned long size, struct nfp_cpp_area **area);\n\nstruct nfp_cpp_mutex;\n\nint nfp_cpp_mutex_init(struct nfp_cpp *cpp, int target,\n\t\t       unsigned long long address, u32 key_id);\nstruct nfp_cpp_mutex *nfp_cpp_mutex_alloc(struct nfp_cpp *cpp, int target,\n\t\t\t\t\t  unsigned long long address,\n\t\t\t\t\t  u32 key_id);\nvoid nfp_cpp_mutex_free(struct nfp_cpp_mutex *mutex);\nint nfp_cpp_mutex_lock(struct nfp_cpp_mutex *mutex);\nint nfp_cpp_mutex_unlock(struct nfp_cpp_mutex *mutex);\nint nfp_cpp_mutex_trylock(struct nfp_cpp_mutex *mutex);\nint nfp_cpp_mutex_reclaim(struct nfp_cpp *cpp, int target,\n\t\t\t  unsigned long long address);\n\n \nstatic inline u8 nfp_cppcore_pcie_unit(struct nfp_cpp *cpp)\n{\n\treturn NFP_CPP_INTERFACE_UNIT_of(nfp_cpp_interface(cpp));\n}\n\nstruct nfp_cpp_explicit;\n\nstruct nfp_cpp_explicit_command {\n\tu32 cpp_id;\n\tu16 data_ref;\n\tu8  data_master;\n\tu8  len;\n\tu8  byte_mask;\n\tu8  signal_master;\n\tu8  signal_ref;\n\tu8  posted;\n\tu8  siga;\n\tu8  sigb;\n\ts8   siga_mode;\n\ts8   sigb_mode;\n};\n\n#define NFP_SERIAL_LEN\t\t6\n\n \nstruct nfp_cpp_operations {\n\tsize_t area_priv_size;\n\tstruct module *owner;\n\n\tint (*init)(struct nfp_cpp *cpp);\n\tvoid (*free)(struct nfp_cpp *cpp);\n\n\tint (*read_serial)(struct device *dev, u8 *serial);\n\tint (*get_interface)(struct device *dev);\n\n\tint (*area_init)(struct nfp_cpp_area *area,\n\t\t\t u32 dest, unsigned long long address,\n\t\t\t unsigned long size);\n\tvoid (*area_cleanup)(struct nfp_cpp_area *area);\n\tint (*area_acquire)(struct nfp_cpp_area *area);\n\tvoid (*area_release)(struct nfp_cpp_area *area);\n\tstruct resource *(*area_resource)(struct nfp_cpp_area *area);\n\tphys_addr_t (*area_phys)(struct nfp_cpp_area *area);\n\tvoid __iomem *(*area_iomem)(struct nfp_cpp_area *area);\n\tint (*area_read)(struct nfp_cpp_area *area, void *kernel_vaddr,\n\t\t\t unsigned long offset, unsigned int length);\n\tint (*area_write)(struct nfp_cpp_area *area, const void *kernel_vaddr,\n\t\t\t  unsigned long offset, unsigned int length);\n\n\tsize_t explicit_priv_size;\n\tint (*explicit_acquire)(struct nfp_cpp_explicit *expl);\n\tvoid (*explicit_release)(struct nfp_cpp_explicit *expl);\n\tint (*explicit_put)(struct nfp_cpp_explicit *expl,\n\t\t\t    const void *buff, size_t len);\n\tint (*explicit_get)(struct nfp_cpp_explicit *expl,\n\t\t\t    void *buff, size_t len);\n\tint (*explicit_do)(struct nfp_cpp_explicit *expl,\n\t\t\t   const struct nfp_cpp_explicit_command *cmd,\n\t\t\t   u64 address);\n};\n\nstruct nfp_cpp *\nnfp_cpp_from_operations(const struct nfp_cpp_operations *ops,\n\t\t\tstruct device *parent, void *priv);\nvoid *nfp_cpp_priv(struct nfp_cpp *priv);\n\nint nfp_cpp_area_cache_add(struct nfp_cpp *cpp, size_t size);\n\n \n\n \n#define NFP_CPP_INTERFACE_CHANNEL_PEROPENER\t255\nstruct device *nfp_cpp_device(struct nfp_cpp *cpp);\n\n \n#define NFP_SIGNAL_MASK_A\tBIT(0)\t \n#define NFP_SIGNAL_MASK_B\tBIT(1)\t \n\nenum nfp_cpp_explicit_signal_mode {\n\tNFP_SIGNAL_NONE = 0,\n\tNFP_SIGNAL_PUSH = 1,\n\tNFP_SIGNAL_PUSH_OPTIONAL = -1,\n\tNFP_SIGNAL_PULL = 2,\n\tNFP_SIGNAL_PULL_OPTIONAL = -2,\n};\n\nstruct nfp_cpp_explicit *nfp_cpp_explicit_acquire(struct nfp_cpp *cpp);\nint nfp_cpp_explicit_set_target(struct nfp_cpp_explicit *expl, u32 cpp_id,\n\t\t\t\tu8 len, u8 mask);\nint nfp_cpp_explicit_set_data(struct nfp_cpp_explicit *expl,\n\t\t\t      u8 data_master, u16 data_ref);\nint nfp_cpp_explicit_set_signal(struct nfp_cpp_explicit *expl,\n\t\t\t\tu8 signal_master, u8 signal_ref);\nint nfp_cpp_explicit_set_posted(struct nfp_cpp_explicit *expl, int posted,\n\t\t\t\tu8 siga,\n\t\t\t\tenum nfp_cpp_explicit_signal_mode siga_mode,\n\t\t\t\tu8 sigb,\n\t\t\t\tenum nfp_cpp_explicit_signal_mode sigb_mode);\nint nfp_cpp_explicit_put(struct nfp_cpp_explicit *expl,\n\t\t\t const void *buff, size_t len);\nint nfp_cpp_explicit_do(struct nfp_cpp_explicit *expl, u64 address);\nint nfp_cpp_explicit_get(struct nfp_cpp_explicit *expl, void *buff, size_t len);\nvoid nfp_cpp_explicit_release(struct nfp_cpp_explicit *expl);\nstruct nfp_cpp *nfp_cpp_explicit_cpp(struct nfp_cpp_explicit *expl);\nvoid *nfp_cpp_explicit_priv(struct nfp_cpp_explicit *cpp_explicit);\n\n \n\nint nfp_cpp_model_autodetect(struct nfp_cpp *cpp, u32 *model);\n\nint nfp_cpp_explicit_read(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t\t  u64 addr, void *buff, size_t len,\n\t\t\t  int width_read);\n\nint nfp_cpp_explicit_write(struct nfp_cpp *cpp, u32 cpp_id,\n\t\t\t   u64 addr, const void *buff, size_t len,\n\t\t\t   int width_write);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}