{
  "module_name": "nfp_mip.c",
  "hash_id": "3ef2c2aab6ea00d8afbf8643dad7f9234ef90ddae8db3aa279722fd6953fe893",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/netronome/nfp/nfpcore/nfp_mip.c",
  "human_readable_source": "\n \n\n \n#include <linux/kernel.h>\n#include <linux/slab.h>\n\n#include \"nfp.h\"\n#include \"nfp_cpp.h\"\n#include \"nfp_nffw.h\"\n\n#define NFP_MIP_SIGNATURE\tcpu_to_le32(0x0050494d)   \n#define NFP_MIP_VERSION\t\tcpu_to_le32(1)\n#define NFP_MIP_MAX_OFFSET\t(256 * 1024)\n\nstruct nfp_mip {\n\t__le32 signature;\n\t__le32 mip_version;\n\t__le32 mip_size;\n\t__le32 first_entry;\n\n\t__le32 version;\n\t__le32 buildnum;\n\t__le32 buildtime;\n\t__le32 loadtime;\n\n\t__le32 symtab_addr;\n\t__le32 symtab_size;\n\t__le32 strtab_addr;\n\t__le32 strtab_size;\n\n\tchar name[16];\n\tchar toolchain[32];\n};\n\n \nstatic int\nnfp_mip_try_read(struct nfp_cpp *cpp, u32 cpp_id, u64 addr, struct nfp_mip *mip)\n{\n\tint ret;\n\n\tret = nfp_cpp_read(cpp, cpp_id, addr, mip, sizeof(*mip));\n\tif (ret != sizeof(*mip)) {\n\t\tnfp_err(cpp, \"Failed to read MIP data (%d, %zu)\\n\",\n\t\t\tret, sizeof(*mip));\n\t\treturn -EIO;\n\t}\n\tif (mip->signature != NFP_MIP_SIGNATURE) {\n\t\tnfp_warn(cpp, \"Incorrect MIP signature (0x%08x)\\n\",\n\t\t\t le32_to_cpu(mip->signature));\n\t\treturn -EINVAL;\n\t}\n\tif (mip->mip_version != NFP_MIP_VERSION) {\n\t\tnfp_warn(cpp, \"Unsupported MIP version (%d)\\n\",\n\t\t\t le32_to_cpu(mip->mip_version));\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int nfp_mip_read_resource(struct nfp_cpp *cpp, struct nfp_mip *mip)\n{\n\tstruct nfp_nffw_info *nffw_info;\n\tu32 cpp_id;\n\tu64 addr;\n\tint err;\n\n\tnffw_info = nfp_nffw_info_open(cpp);\n\tif (IS_ERR(nffw_info))\n\t\treturn PTR_ERR(nffw_info);\n\n\terr = nfp_nffw_info_mip_first(nffw_info, &cpp_id, &addr);\n\tif (err)\n\t\tgoto exit_close_nffw;\n\n\terr = nfp_mip_try_read(cpp, cpp_id, addr, mip);\nexit_close_nffw:\n\tnfp_nffw_info_close(nffw_info);\n\treturn err;\n}\n\n \nconst struct nfp_mip *nfp_mip_open(struct nfp_cpp *cpp)\n{\n\tstruct nfp_mip *mip;\n\tint err;\n\n\tmip = kmalloc(sizeof(*mip), GFP_KERNEL);\n\tif (!mip)\n\t\treturn NULL;\n\n\terr = nfp_mip_read_resource(cpp, mip);\n\tif (err) {\n\t\tkfree(mip);\n\t\treturn NULL;\n\t}\n\n\tmip->name[sizeof(mip->name) - 1] = 0;\n\n\treturn mip;\n}\n\nvoid nfp_mip_close(const struct nfp_mip *mip)\n{\n\tkfree(mip);\n}\n\nconst char *nfp_mip_name(const struct nfp_mip *mip)\n{\n\treturn mip->name;\n}\n\n \nvoid nfp_mip_symtab(const struct nfp_mip *mip, u32 *addr, u32 *size)\n{\n\t*addr = le32_to_cpu(mip->symtab_addr);\n\t*size = le32_to_cpu(mip->symtab_size);\n}\n\n \nvoid nfp_mip_strtab(const struct nfp_mip *mip, u32 *addr, u32 *size)\n{\n\t*addr = le32_to_cpu(mip->strtab_addr);\n\t*size = le32_to_cpu(mip->strtab_size);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}