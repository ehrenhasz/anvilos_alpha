{
  "module_name": "nfp_net_dp.h",
  "hash_id": "3957a29c7a6bb952f0094b6b4a644349f37e227d43259d96750dd4640b7345dc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/netronome/nfp/nfp_net_dp.h",
  "human_readable_source": " \n \n\n#ifndef _NFP_NET_DP_\n#define _NFP_NET_DP_\n\n#include \"nfp_net.h\"\n\nstatic inline dma_addr_t nfp_net_dma_map_rx(struct nfp_net_dp *dp, void *frag)\n{\n\treturn dma_map_single_attrs(dp->dev, frag + NFP_NET_RX_BUF_HEADROOM,\n\t\t\t\t    dp->fl_bufsz - NFP_NET_RX_BUF_NON_DATA,\n\t\t\t\t    dp->rx_dma_dir, DMA_ATTR_SKIP_CPU_SYNC);\n}\n\nstatic inline void\nnfp_net_dma_sync_dev_rx(const struct nfp_net_dp *dp, dma_addr_t dma_addr)\n{\n\tdma_sync_single_for_device(dp->dev, dma_addr,\n\t\t\t\t   dp->fl_bufsz - NFP_NET_RX_BUF_NON_DATA,\n\t\t\t\t   dp->rx_dma_dir);\n}\n\nstatic inline void nfp_net_dma_unmap_rx(struct nfp_net_dp *dp,\n\t\t\t\t\tdma_addr_t dma_addr)\n{\n\tdma_unmap_single_attrs(dp->dev, dma_addr,\n\t\t\t       dp->fl_bufsz - NFP_NET_RX_BUF_NON_DATA,\n\t\t\t       dp->rx_dma_dir, DMA_ATTR_SKIP_CPU_SYNC);\n}\n\nstatic inline void nfp_net_dma_sync_cpu_rx(struct nfp_net_dp *dp,\n\t\t\t\t\t   dma_addr_t dma_addr,\n\t\t\t\t\t   unsigned int len)\n{\n\tdma_sync_single_for_cpu(dp->dev, dma_addr - NFP_NET_RX_BUF_HEADROOM,\n\t\t\t\tlen, dp->rx_dma_dir);\n}\n\n \nstatic inline int nfp_net_tx_full(struct nfp_net_tx_ring *tx_ring, int dcnt)\n{\n\treturn (tx_ring->wr_p - tx_ring->rd_p) >= (tx_ring->cnt - dcnt);\n}\n\nstatic inline void nfp_net_tx_xmit_more_flush(struct nfp_net_tx_ring *tx_ring)\n{\n\twmb();  \n\tnfp_qcp_wr_ptr_add(tx_ring->qcp_q, tx_ring->wr_ptr_add);\n\ttx_ring->wr_ptr_add = 0;\n}\n\nstatic inline u32\nnfp_net_read_tx_cmpl(struct nfp_net_tx_ring *tx_ring, struct nfp_net_dp *dp)\n{\n\tif (tx_ring->txrwb)\n\t\treturn *tx_ring->txrwb;\n\treturn nfp_qcp_rd_ptr_read(tx_ring->qcp_q);\n}\n\nstatic inline void nfp_net_free_frag(void *frag, bool xdp)\n{\n\tif (!xdp)\n\t\tskb_free_frag(frag);\n\telse\n\t\t__free_page(virt_to_page(frag));\n}\n\n \nstatic inline void nfp_net_irq_unmask(struct nfp_net *nn, unsigned int entry_nr)\n{\n\tnn_writeb(nn, NFP_NET_CFG_ICR(entry_nr), NFP_NET_CFG_ICR_UNMASKED);\n\tnn_pci_flush(nn);\n}\n\nstruct seq_file;\n\n \nvoid\nnfp_net_rx_ring_hw_cfg_write(struct nfp_net *nn,\n\t\t\t     struct nfp_net_rx_ring *rx_ring, unsigned int idx);\nvoid\nnfp_net_tx_ring_hw_cfg_write(struct nfp_net *nn,\n\t\t\t     struct nfp_net_tx_ring *tx_ring, unsigned int idx);\nvoid nfp_net_vec_clear_ring_data(struct nfp_net *nn, unsigned int idx);\n\nvoid *nfp_net_rx_alloc_one(struct nfp_net_dp *dp, dma_addr_t *dma_addr);\nint nfp_net_rx_rings_prepare(struct nfp_net *nn, struct nfp_net_dp *dp);\nint nfp_net_tx_rings_prepare(struct nfp_net *nn, struct nfp_net_dp *dp);\nvoid nfp_net_rx_rings_free(struct nfp_net_dp *dp);\nvoid nfp_net_tx_rings_free(struct nfp_net_dp *dp);\nvoid nfp_net_rx_ring_reset(struct nfp_net_rx_ring *rx_ring);\nbool nfp_net_vlan_strip(struct sk_buff *skb, const struct nfp_net_rx_desc *rxd,\n\t\t\tconst struct nfp_meta_parsed *meta);\n\nenum nfp_nfd_version {\n\tNFP_NFD_VER_NFD3,\n\tNFP_NFD_VER_NFDK,\n};\n\n \nstruct nfp_dp_ops {\n\tenum nfp_nfd_version version;\n\tunsigned int tx_min_desc_per_pkt;\n\tu32 cap_mask;\n\tu64 dma_mask;\n\n\tint (*poll)(struct napi_struct *napi, int budget);\n\tint (*xsk_poll)(struct napi_struct *napi, int budget);\n\tvoid (*ctrl_poll)(struct tasklet_struct *t);\n\tnetdev_tx_t (*xmit)(struct sk_buff *skb, struct net_device *netdev);\n\tbool (*ctrl_tx_one)(struct nfp_net *nn, struct nfp_net_r_vector *r_vec,\n\t\t\t    struct sk_buff *skb, bool old);\n\tvoid (*rx_ring_fill_freelist)(struct nfp_net_dp *dp,\n\t\t\t\t      struct nfp_net_rx_ring *rx_ring);\n\tint (*tx_ring_alloc)(struct nfp_net_dp *dp,\n\t\t\t     struct nfp_net_tx_ring *tx_ring);\n\tvoid (*tx_ring_reset)(struct nfp_net_dp *dp,\n\t\t\t      struct nfp_net_tx_ring *tx_ring);\n\tvoid (*tx_ring_free)(struct nfp_net_tx_ring *tx_ring);\n\tint (*tx_ring_bufs_alloc)(struct nfp_net_dp *dp,\n\t\t\t\t  struct nfp_net_tx_ring *tx_ring);\n\tvoid (*tx_ring_bufs_free)(struct nfp_net_dp *dp,\n\t\t\t\t  struct nfp_net_tx_ring *tx_ring);\n\n\tvoid (*print_tx_descs)(struct seq_file *file,\n\t\t\t       struct nfp_net_r_vector *r_vec,\n\t\t\t       struct nfp_net_tx_ring *tx_ring,\n\t\t\t       u32 d_rd_p, u32 d_wr_p);\n};\n\nstatic inline void\nnfp_net_tx_ring_reset(struct nfp_net_dp *dp, struct nfp_net_tx_ring *tx_ring)\n{\n\treturn dp->ops->tx_ring_reset(dp, tx_ring);\n}\n\nstatic inline void\nnfp_net_rx_ring_fill_freelist(struct nfp_net_dp *dp,\n\t\t\t      struct nfp_net_rx_ring *rx_ring)\n{\n\tdp->ops->rx_ring_fill_freelist(dp, rx_ring);\n}\n\nstatic inline int\nnfp_net_tx_ring_alloc(struct nfp_net_dp *dp, struct nfp_net_tx_ring *tx_ring)\n{\n\treturn dp->ops->tx_ring_alloc(dp, tx_ring);\n}\n\nstatic inline void\nnfp_net_tx_ring_free(struct nfp_net_dp *dp, struct nfp_net_tx_ring *tx_ring)\n{\n\tdp->ops->tx_ring_free(tx_ring);\n}\n\nstatic inline int\nnfp_net_tx_ring_bufs_alloc(struct nfp_net_dp *dp,\n\t\t\t   struct nfp_net_tx_ring *tx_ring)\n{\n\treturn dp->ops->tx_ring_bufs_alloc(dp, tx_ring);\n}\n\nstatic inline void\nnfp_net_tx_ring_bufs_free(struct nfp_net_dp *dp,\n\t\t\t  struct nfp_net_tx_ring *tx_ring)\n{\n\tdp->ops->tx_ring_bufs_free(dp, tx_ring);\n}\n\nstatic inline void\nnfp_net_debugfs_print_tx_descs(struct seq_file *file, struct nfp_net_dp *dp,\n\t\t\t       struct nfp_net_r_vector *r_vec,\n\t\t\t       struct nfp_net_tx_ring *tx_ring,\n\t\t\t       u32 d_rd_p, u32 d_wr_p)\n{\n\tdp->ops->print_tx_descs(file, r_vec, tx_ring, d_rd_p, d_wr_p);\n}\n\nextern const struct nfp_dp_ops nfp_nfd3_ops;\nextern const struct nfp_dp_ops nfp_nfdk_ops;\n\nnetdev_tx_t nfp_net_tx(struct sk_buff *skb, struct net_device *netdev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}