{
  "module_name": "main.h",
  "hash_id": "75f94f279c6c5f8edaee429e795dd41ecf7d7ff463f2092813016b25ddd9cea9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/netronome/nfp/abm/main.h",
  "human_readable_source": " \n \n\n#ifndef __NFP_ABM_H__\n#define __NFP_ABM_H__ 1\n\n#include <linux/bits.h>\n#include <linux/list.h>\n#include <linux/radix-tree.h>\n#include <net/devlink.h>\n#include <net/pkt_cls.h>\n#include <net/pkt_sched.h>\n\n \n#define NFP_ABM_STATS_REFRESH_IVAL\t(2500 * 1000)  \n\n#define NFP_ABM_LVL_INFINITY\t\tS32_MAX\n\nstruct nfp_app;\nstruct nfp_net;\n\n#define NFP_ABM_PORTID_TYPE\tGENMASK(23, 16)\n#define NFP_ABM_PORTID_ID\tGENMASK(7, 0)\n\n \nenum nfp_abm_q_action {\n\t \n\tNFP_ABM_ACT_MARK_DROP\t\t= 0,\n\t \n\tNFP_ABM_ACT_MARK_QUEUE\t\t= 1,\n\tNFP_ABM_ACT_DROP\t\t= 2,\n\tNFP_ABM_ACT_QUEUE\t\t= 3,\n\tNFP_ABM_ACT_NOQUEUE\t\t= 4,\n};\n\n \nstruct nfp_abm {\n\tstruct nfp_app *app;\n\tunsigned int pf_id;\n\n\tunsigned int red_support;\n\tunsigned int num_prios;\n\tunsigned int num_bands;\n\tunsigned int action_mask;\n\n\tu32 *thresholds;\n\tunsigned long *threshold_undef;\n\tu8 *actions;\n\tsize_t num_thresholds;\n\n\tunsigned int prio_map_len;\n\tu8 dscp_mask;\n\n\tenum devlink_eswitch_mode eswitch_mode;\n\n\tconst struct nfp_rtsym *q_lvls;\n\tconst struct nfp_rtsym *qm_stats;\n\tconst struct nfp_rtsym *q_stats;\n};\n\n \nstruct nfp_alink_stats {\n\tu64 tx_pkts;\n\tu64 tx_bytes;\n\tu64 backlog_pkts;\n\tu64 backlog_bytes;\n\tu64 overlimits;\n\tu64 drops;\n};\n\n \nstruct nfp_alink_xstats {\n\tu64 ecn_marked;\n\tu64 pdrop;\n};\n\nenum nfp_qdisc_type {\n\tNFP_QDISC_NONE = 0,\n\tNFP_QDISC_MQ,\n\tNFP_QDISC_RED,\n\tNFP_QDISC_GRED,\n};\n\n#define NFP_QDISC_UNTRACKED\t((struct nfp_qdisc *)1UL)\n\n \nstruct nfp_qdisc {\n\tstruct net_device *netdev;\n\tenum nfp_qdisc_type type;\n\tu32 handle;\n\tu32 parent_handle;\n\tunsigned int use_cnt;\n\tunsigned int num_children;\n\tstruct nfp_qdisc **children;\n\n\tbool params_ok;\n\tbool offload_mark;\n\tbool offloaded;\n\n\tunion {\n\t\t \n\t\tstruct {\n\t\t\tstruct nfp_alink_stats stats;\n\t\t\tstruct nfp_alink_stats prev_stats;\n\t\t} mq;\n\t\t \n\t\tstruct {\n\t\t\tunsigned int num_bands;\n\n\t\t\tstruct {\n\t\t\t\tbool ecn;\n\t\t\t\tu32 threshold;\n\t\t\t\tstruct nfp_alink_stats stats;\n\t\t\t\tstruct nfp_alink_stats prev_stats;\n\t\t\t\tstruct nfp_alink_xstats xstats;\n\t\t\t\tstruct nfp_alink_xstats prev_xstats;\n\t\t\t} band[MAX_DPs];\n\t\t} red;\n\t};\n};\n\n \nstruct nfp_abm_link {\n\tstruct nfp_abm *abm;\n\tstruct nfp_net *vnic;\n\tunsigned int id;\n\tunsigned int queue_base;\n\tunsigned int total_queues;\n\n\tu64 last_stats_update;\n\n\tu32 *prio_map;\n\tbool has_prio;\n\n\tu8 def_band;\n\tstruct list_head dscp_map;\n\n\tstruct nfp_qdisc *root_qdisc;\n\tstruct radix_tree_root qdiscs;\n};\n\nstatic inline bool nfp_abm_has_prio(struct nfp_abm *abm)\n{\n\treturn abm->num_bands > 1;\n}\n\nstatic inline bool nfp_abm_has_drop(struct nfp_abm *abm)\n{\n\treturn abm->action_mask & BIT(NFP_ABM_ACT_DROP);\n}\n\nstatic inline bool nfp_abm_has_mark(struct nfp_abm *abm)\n{\n\treturn abm->action_mask & BIT(NFP_ABM_ACT_MARK_DROP);\n}\n\nvoid nfp_abm_qdisc_offload_update(struct nfp_abm_link *alink);\nint nfp_abm_setup_root(struct net_device *netdev, struct nfp_abm_link *alink,\n\t\t       struct tc_root_qopt_offload *opt);\nint nfp_abm_setup_tc_red(struct net_device *netdev, struct nfp_abm_link *alink,\n\t\t\t struct tc_red_qopt_offload *opt);\nint nfp_abm_setup_tc_mq(struct net_device *netdev, struct nfp_abm_link *alink,\n\t\t\tstruct tc_mq_qopt_offload *opt);\nint nfp_abm_setup_tc_gred(struct net_device *netdev, struct nfp_abm_link *alink,\n\t\t\t  struct tc_gred_qopt_offload *opt);\nint nfp_abm_setup_cls_block(struct net_device *netdev, struct nfp_repr *repr,\n\t\t\t    struct flow_block_offload *opt);\n\nint nfp_abm_ctrl_read_params(struct nfp_abm_link *alink);\nint nfp_abm_ctrl_find_addrs(struct nfp_abm *abm);\nint __nfp_abm_ctrl_set_q_lvl(struct nfp_abm *abm, unsigned int id, u32 val);\nint nfp_abm_ctrl_set_q_lvl(struct nfp_abm_link *alink, unsigned int band,\n\t\t\t   unsigned int queue, u32 val);\nint __nfp_abm_ctrl_set_q_act(struct nfp_abm *abm, unsigned int id,\n\t\t\t     enum nfp_abm_q_action act);\nint nfp_abm_ctrl_set_q_act(struct nfp_abm_link *alink, unsigned int band,\n\t\t\t   unsigned int queue, enum nfp_abm_q_action act);\nint nfp_abm_ctrl_read_q_stats(struct nfp_abm_link *alink,\n\t\t\t      unsigned int band, unsigned int queue,\n\t\t\t      struct nfp_alink_stats *stats);\nint nfp_abm_ctrl_read_q_xstats(struct nfp_abm_link *alink,\n\t\t\t       unsigned int band, unsigned int queue,\n\t\t\t       struct nfp_alink_xstats *xstats);\nu64 nfp_abm_ctrl_stat_non_sto(struct nfp_abm_link *alink, unsigned int i);\nu64 nfp_abm_ctrl_stat_sto(struct nfp_abm_link *alink, unsigned int i);\nint nfp_abm_ctrl_qm_enable(struct nfp_abm *abm);\nint nfp_abm_ctrl_qm_disable(struct nfp_abm *abm);\nvoid nfp_abm_prio_map_update(struct nfp_abm *abm);\nint nfp_abm_ctrl_prio_map_update(struct nfp_abm_link *alink, u32 *packed);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}