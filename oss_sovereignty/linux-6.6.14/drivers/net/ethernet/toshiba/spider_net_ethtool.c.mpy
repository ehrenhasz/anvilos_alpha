{
  "module_name": "spider_net_ethtool.c",
  "hash_id": "d2a1069b423421312ec0688bb4a648ca61c223ee87dfea3652b13f2895f92586",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/toshiba/spider_net_ethtool.c",
  "human_readable_source": "\n \n\n#include <linux/netdevice.h>\n#include <linux/ethtool.h>\n#include <linux/pci.h>\n\n#include \"spider_net.h\"\n\n\nstatic struct {\n\tconst char str[ETH_GSTRING_LEN];\n} ethtool_stats_keys[] = {\n\t{ \"tx_packets\" },\n\t{ \"tx_bytes\" },\n\t{ \"rx_packets\" },\n\t{ \"rx_bytes\" },\n\t{ \"tx_errors\" },\n\t{ \"tx_dropped\" },\n\t{ \"rx_dropped\" },\n\t{ \"rx_descriptor_error\" },\n\t{ \"tx_timeouts\" },\n\t{ \"alloc_rx_skb_error\" },\n\t{ \"rx_iommu_map_error\" },\n\t{ \"tx_iommu_map_error\" },\n\t{ \"rx_desc_unk_state\" },\n};\n\nstatic int\nspider_net_ethtool_get_link_ksettings(struct net_device *netdev,\n\t\t\t\t      struct ethtool_link_ksettings *cmd)\n{\n\tstruct spider_net_card *card;\n\tcard = netdev_priv(netdev);\n\n\tethtool_link_ksettings_zero_link_mode(cmd, supported);\n\tethtool_link_ksettings_add_link_mode(cmd, supported, 1000baseT_Full);\n\tethtool_link_ksettings_add_link_mode(cmd, supported, FIBRE);\n\n\tethtool_link_ksettings_zero_link_mode(cmd, advertising);\n\tethtool_link_ksettings_add_link_mode(cmd, advertising, 1000baseT_Full);\n\tethtool_link_ksettings_add_link_mode(cmd, advertising, FIBRE);\n\n\tcmd->base.port = PORT_FIBRE;\n\tcmd->base.speed = card->phy.speed;\n\tcmd->base.duplex = DUPLEX_FULL;\n\n\treturn 0;\n}\n\nstatic void\nspider_net_ethtool_get_drvinfo(struct net_device *netdev,\n\t\t\t       struct ethtool_drvinfo *drvinfo)\n{\n\tstruct spider_net_card *card;\n\tcard = netdev_priv(netdev);\n\n\t \n\tstrscpy(drvinfo->driver, spider_net_driver_name,\n\t\tsizeof(drvinfo->driver));\n\tstrscpy(drvinfo->version, VERSION, sizeof(drvinfo->version));\n\tstrscpy(drvinfo->fw_version, \"no information\",\n\t\tsizeof(drvinfo->fw_version));\n\tstrscpy(drvinfo->bus_info, pci_name(card->pdev),\n\t\tsizeof(drvinfo->bus_info));\n}\n\nstatic void\nspider_net_ethtool_get_wol(struct net_device *netdev,\n\t\t\t   struct ethtool_wolinfo *wolinfo)\n{\n\t \n\twolinfo->supported = 0;\n\twolinfo->wolopts = 0;\n}\n\nstatic u32\nspider_net_ethtool_get_msglevel(struct net_device *netdev)\n{\n\tstruct spider_net_card *card;\n\tcard = netdev_priv(netdev);\n\treturn card->msg_enable;\n}\n\nstatic void\nspider_net_ethtool_set_msglevel(struct net_device *netdev,\n\t\t\t\tu32 level)\n{\n\tstruct spider_net_card *card;\n\tcard = netdev_priv(netdev);\n\tcard->msg_enable = level;\n}\n\nstatic int\nspider_net_ethtool_nway_reset(struct net_device *netdev)\n{\n\tif (netif_running(netdev)) {\n\t\tspider_net_stop(netdev);\n\t\tspider_net_open(netdev);\n\t}\n\treturn 0;\n}\n\nstatic void\nspider_net_ethtool_get_ringparam(struct net_device *netdev,\n\t\t\t\t struct ethtool_ringparam *ering,\n\t\t\t\t struct kernel_ethtool_ringparam *kernel_ering,\n\t\t\t\t struct netlink_ext_ack *extack)\n{\n\tstruct spider_net_card *card = netdev_priv(netdev);\n\n\tering->tx_max_pending = SPIDER_NET_TX_DESCRIPTORS_MAX;\n\tering->tx_pending = card->tx_chain.num_desc;\n\tering->rx_max_pending = SPIDER_NET_RX_DESCRIPTORS_MAX;\n\tering->rx_pending = card->rx_chain.num_desc;\n}\n\nstatic int spider_net_get_sset_count(struct net_device *netdev, int sset)\n{\n\tswitch (sset) {\n\tcase ETH_SS_STATS:\n\t\treturn ARRAY_SIZE(ethtool_stats_keys);\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n\nstatic void spider_net_get_ethtool_stats(struct net_device *netdev,\n\t\tstruct ethtool_stats *stats, u64 *data)\n{\n\tstruct spider_net_card *card = netdev_priv(netdev);\n\n\tdata[0] = netdev->stats.tx_packets;\n\tdata[1] = netdev->stats.tx_bytes;\n\tdata[2] = netdev->stats.rx_packets;\n\tdata[3] = netdev->stats.rx_bytes;\n\tdata[4] = netdev->stats.tx_errors;\n\tdata[5] = netdev->stats.tx_dropped;\n\tdata[6] = netdev->stats.rx_dropped;\n\tdata[7] = card->spider_stats.rx_desc_error;\n\tdata[8] = card->spider_stats.tx_timeouts;\n\tdata[9] = card->spider_stats.alloc_rx_skb_error;\n\tdata[10] = card->spider_stats.rx_iommu_map_error;\n\tdata[11] = card->spider_stats.tx_iommu_map_error;\n\tdata[12] = card->spider_stats.rx_desc_unk_state;\n}\n\nstatic void spider_net_get_strings(struct net_device *netdev, u32 stringset,\n\t\t\t\t   u8 *data)\n{\n\tmemcpy(data, ethtool_stats_keys, sizeof(ethtool_stats_keys));\n}\n\nconst struct ethtool_ops spider_net_ethtool_ops = {\n\t.get_drvinfo\t\t= spider_net_ethtool_get_drvinfo,\n\t.get_wol\t\t= spider_net_ethtool_get_wol,\n\t.get_msglevel\t\t= spider_net_ethtool_get_msglevel,\n\t.set_msglevel\t\t= spider_net_ethtool_set_msglevel,\n\t.get_link\t\t= ethtool_op_get_link,\n\t.nway_reset\t\t= spider_net_ethtool_nway_reset,\n\t.get_ringparam          = spider_net_ethtool_get_ringparam,\n\t.get_strings\t\t= spider_net_get_strings,\n\t.get_sset_count\t\t= spider_net_get_sset_count,\n\t.get_ethtool_stats\t= spider_net_get_ethtool_stats,\n\t.get_link_ksettings\t= spider_net_ethtool_get_link_ksettings,\n};\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}