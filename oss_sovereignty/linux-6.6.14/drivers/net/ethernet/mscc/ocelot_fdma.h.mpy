{
  "module_name": "ocelot_fdma.h",
  "hash_id": "6b2d1d633be8b46933078667f420c3c0831c22d1f449c24a0f806ab452bcf5cc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mscc/ocelot_fdma.h",
  "human_readable_source": " \n \n#ifndef _MSCC_OCELOT_FDMA_H_\n#define _MSCC_OCELOT_FDMA_H_\n\n#include \"ocelot.h\"\n\n#define MSCC_FDMA_DCB_STAT_BLOCKO(x)\t(((x) << 20) & GENMASK(31, 20))\n#define MSCC_FDMA_DCB_STAT_BLOCKO_M\tGENMASK(31, 20)\n#define MSCC_FDMA_DCB_STAT_BLOCKO_X(x)\t(((x) & GENMASK(31, 20)) >> 20)\n#define MSCC_FDMA_DCB_STAT_PD\t\tBIT(19)\n#define MSCC_FDMA_DCB_STAT_ABORT\tBIT(18)\n#define MSCC_FDMA_DCB_STAT_EOF\t\tBIT(17)\n#define MSCC_FDMA_DCB_STAT_SOF\t\tBIT(16)\n#define MSCC_FDMA_DCB_STAT_BLOCKL_M\tGENMASK(15, 0)\n#define MSCC_FDMA_DCB_STAT_BLOCKL(x)\t((x) & GENMASK(15, 0))\n\n#define MSCC_FDMA_DCB_LLP(x)\t\t((x) * 4 + 0x0)\n#define MSCC_FDMA_DCB_LLP_PREV(x)\t((x) * 4 + 0xA0)\n#define MSCC_FDMA_CH_SAFE\t\t0xcc\n#define MSCC_FDMA_CH_ACTIVATE\t\t0xd0\n#define MSCC_FDMA_CH_DISABLE\t\t0xd4\n#define MSCC_FDMA_CH_FORCEDIS\t\t0xd8\n#define MSCC_FDMA_EVT_ERR\t\t0x164\n#define MSCC_FDMA_EVT_ERR_CODE\t\t0x168\n#define MSCC_FDMA_INTR_LLP\t\t0x16c\n#define MSCC_FDMA_INTR_LLP_ENA\t\t0x170\n#define MSCC_FDMA_INTR_FRM\t\t0x174\n#define MSCC_FDMA_INTR_FRM_ENA\t\t0x178\n#define MSCC_FDMA_INTR_ENA\t\t0x184\n#define MSCC_FDMA_INTR_IDENT\t\t0x188\n\n#define MSCC_FDMA_INJ_CHAN\t\t2\n#define MSCC_FDMA_XTR_CHAN\t\t0\n\n#define OCELOT_FDMA_WEIGHT\t\t32\n\n#define OCELOT_FDMA_CH_SAFE_TIMEOUT_US\t10\n\n#define OCELOT_FDMA_RX_RING_SIZE\t512\n#define OCELOT_FDMA_TX_RING_SIZE\t128\n\n#define OCELOT_FDMA_RX_DCB_SIZE\t\t(OCELOT_FDMA_RX_RING_SIZE * \\\n\t\t\t\t\t sizeof(struct ocelot_fdma_dcb))\n#define OCELOT_FDMA_TX_DCB_SIZE\t\t(OCELOT_FDMA_TX_RING_SIZE * \\\n\t\t\t\t\t sizeof(struct ocelot_fdma_dcb))\n \n#define OCELOT_DCBS_HW_ALLOC_SIZE\t(OCELOT_FDMA_RX_DCB_SIZE + \\\n\t\t\t\t\t OCELOT_FDMA_TX_DCB_SIZE + \\\n\t\t\t\t\t 4)\n\n#define OCELOT_FDMA_RX_SIZE\t\t(PAGE_SIZE / 2)\n\n#define OCELOT_FDMA_SKBFRAG_OVR\t\t(4 + SKB_DATA_ALIGN(sizeof(struct skb_shared_info)))\n#define OCELOT_FDMA_RXB_SIZE\t\tALIGN_DOWN(OCELOT_FDMA_RX_SIZE - OCELOT_FDMA_SKBFRAG_OVR, 4)\n#define OCELOT_FDMA_SKBFRAG_SIZE\t(OCELOT_FDMA_RXB_SIZE + OCELOT_FDMA_SKBFRAG_OVR)\n\nDECLARE_STATIC_KEY_FALSE(ocelot_fdma_enabled);\n\nstruct ocelot_fdma_dcb {\n\tu32 llp;\n\tu32 datap;\n\tu32 datal;\n\tu32 stat;\n} __packed;\n\n \nstruct ocelot_fdma_tx_buf {\n\tstruct sk_buff *skb;\n\tDEFINE_DMA_UNMAP_ADDR(dma_addr);\n};\n\n \nstruct ocelot_fdma_tx_ring {\n\tstruct ocelot_fdma_dcb *dcbs;\n\tdma_addr_t dcbs_dma;\n\tstruct ocelot_fdma_tx_buf bufs[OCELOT_FDMA_TX_RING_SIZE];\n\t \n\tspinlock_t xmit_lock;\n\tu16 next_to_clean;\n\tu16 next_to_use;\n};\n\n \nstruct ocelot_fdma_rx_buf {\n\tstruct page *page;\n\tu32 page_offset;\n\tdma_addr_t dma_addr;\n};\n\n \nstruct ocelot_fdma_rx_ring {\n\tstruct ocelot_fdma_dcb *dcbs;\n\tdma_addr_t dcbs_dma;\n\tstruct ocelot_fdma_rx_buf bufs[OCELOT_FDMA_RX_RING_SIZE];\n\tstruct sk_buff *skb;\n\tu16 next_to_clean;\n\tu16 next_to_use;\n\tu16 next_to_alloc;\n};\n\n \nstruct ocelot_fdma {\n\tint irq;\n\tstruct net_device *ndev;\n\tstruct ocelot_fdma_dcb *dcbs_base;\n\tdma_addr_t dcbs_dma_base;\n\tstruct ocelot_fdma_tx_ring tx_ring;\n\tstruct ocelot_fdma_rx_ring rx_ring;\n\tstruct napi_struct napi;\n\tstruct ocelot *ocelot;\n};\n\nvoid ocelot_fdma_init(struct platform_device *pdev, struct ocelot *ocelot);\nvoid ocelot_fdma_start(struct ocelot *ocelot);\nvoid ocelot_fdma_deinit(struct ocelot *ocelot);\nint ocelot_fdma_inject_frame(struct ocelot *fdma, int port, u32 rew_op,\n\t\t\t     struct sk_buff *skb, struct net_device *dev);\nvoid ocelot_fdma_netdev_init(struct ocelot *ocelot, struct net_device *dev);\nvoid ocelot_fdma_netdev_deinit(struct ocelot *ocelot,\n\t\t\t       struct net_device *dev);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}