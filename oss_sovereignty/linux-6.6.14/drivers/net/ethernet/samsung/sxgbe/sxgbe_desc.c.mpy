{
  "module_name": "sxgbe_desc.c",
  "hash_id": "0abcdc76bcf20b6b766fcd9380792223ffe8ef2228d45d0b80c739f8e6ed4774",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/samsung/sxgbe/sxgbe_desc.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/bitops.h>\n#include <linux/export.h>\n#include <linux/io.h>\n#include <linux/netdevice.h>\n#include <linux/phy.h>\n\n#include \"sxgbe_common.h\"\n#include \"sxgbe_dma.h\"\n#include \"sxgbe_desc.h\"\n\n \nstatic void sxgbe_init_tx_desc(struct sxgbe_tx_norm_desc *p)\n{\n\tp->tdes23.tx_rd_des23.own_bit = 0;\n}\n\nstatic void sxgbe_tx_desc_enable_tse(struct sxgbe_tx_norm_desc *p, u8 is_tse,\n\t\t\t\t     u32 total_hdr_len, u32 tcp_hdr_len,\n\t\t\t\t     u32 tcp_payload_len)\n{\n\tp->tdes23.tx_rd_des23.tse_bit = is_tse;\n\tp->tdes23.tx_rd_des23.buf1_size = total_hdr_len;\n\tp->tdes23.tx_rd_des23.tcp_hdr_len = tcp_hdr_len / 4;\n\tp->tdes23.tx_rd_des23.tx_pkt_len.tcp_payload_len  = tcp_payload_len;\n}\n\n \nstatic void sxgbe_prepare_tx_desc(struct sxgbe_tx_norm_desc *p, u8 is_fd,\n\t\t\t\t  int buf1_len, int pkt_len, int cksum)\n{\n\tp->tdes23.tx_rd_des23.first_desc = is_fd;\n\tp->tdes23.tx_rd_des23.buf1_size = buf1_len;\n\n\tp->tdes23.tx_rd_des23.tx_pkt_len.pkt_len.total_pkt_len = pkt_len;\n\n\tif (cksum)\n\t\tp->tdes23.tx_rd_des23.cksum_ctl = cic_full;\n}\n\n \nstatic void sxgbe_tx_vlanctl_desc(struct sxgbe_tx_norm_desc *p, int vlan_ctl)\n{\n\tp->tdes23.tx_rd_des23.vlan_tag_ctl = vlan_ctl;\n}\n\n \nstatic void sxgbe_set_tx_owner(struct sxgbe_tx_norm_desc *p)\n{\n\tp->tdes23.tx_rd_des23.own_bit = 1;\n}\n\n \nstatic int sxgbe_get_tx_owner(struct sxgbe_tx_norm_desc *p)\n{\n\treturn p->tdes23.tx_rd_des23.own_bit;\n}\n\n \nstatic void sxgbe_close_tx_desc(struct sxgbe_tx_norm_desc *p)\n{\n\tp->tdes23.tx_rd_des23.last_desc = 1;\n\tp->tdes23.tx_rd_des23.int_on_com = 1;\n}\n\n \nstatic void sxgbe_release_tx_desc(struct sxgbe_tx_norm_desc *p)\n{\n\tmemset(p, 0, sizeof(*p));\n}\n\n \nstatic void sxgbe_clear_tx_ic(struct sxgbe_tx_norm_desc *p)\n{\n\tp->tdes23.tx_rd_des23.int_on_com = 0;\n}\n\n \nstatic int sxgbe_get_tx_ls(struct sxgbe_tx_norm_desc *p)\n{\n\treturn p->tdes23.tx_rd_des23.last_desc;\n}\n\n \nstatic int sxgbe_get_tx_len(struct sxgbe_tx_norm_desc *p)\n{\n\treturn p->tdes23.tx_rd_des23.buf1_size;\n}\n\n \nstatic void sxgbe_tx_enable_tstamp(struct sxgbe_tx_norm_desc *p)\n{\n\tp->tdes23.tx_rd_des23.timestmp_enable = 1;\n}\n\n \nstatic int sxgbe_get_tx_timestamp_status(struct sxgbe_tx_norm_desc *p)\n{\n\treturn p->tdes23.tx_rd_des23.timestmp_enable;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_set_ctxt(struct sxgbe_tx_ctxt_desc *p)\n{\n\tp->ctxt_bit = 1;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_set_owner(struct sxgbe_tx_ctxt_desc *p)\n{\n\tp->own_bit = 1;\n}\n\n \nstatic int sxgbe_tx_ctxt_desc_get_owner(struct sxgbe_tx_ctxt_desc *p)\n{\n\treturn p->own_bit;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_set_mss(struct sxgbe_tx_ctxt_desc *p, u16 mss)\n{\n\tp->maxseg_size = mss;\n}\n\n \nstatic int sxgbe_tx_ctxt_desc_get_mss(struct sxgbe_tx_ctxt_desc *p)\n{\n\treturn p->maxseg_size;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_set_tcmssv(struct sxgbe_tx_ctxt_desc *p)\n{\n\tp->tcmssv = 1;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_reset_ostc(struct sxgbe_tx_ctxt_desc *p)\n{\n\tp->ostc = 0;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_set_ivlantag(struct sxgbe_tx_ctxt_desc *p,\n\t\t\t\t\t    int is_ivlanvalid, int ivlan_tag,\n\t\t\t\t\t    int ivlan_ctl)\n{\n\tif (is_ivlanvalid) {\n\t\tp->ivlan_tag_valid = is_ivlanvalid;\n\t\tp->ivlan_tag = ivlan_tag;\n\t\tp->ivlan_tag_ctl = ivlan_ctl;\n\t}\n}\n\n \nstatic int sxgbe_tx_ctxt_desc_get_ivlantag(struct sxgbe_tx_ctxt_desc *p)\n{\n\treturn p->ivlan_tag;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_set_vlantag(struct sxgbe_tx_ctxt_desc *p,\n\t\t\t\t\t   int is_vlanvalid, int vlan_tag)\n{\n\tif (is_vlanvalid) {\n\t\tp->vltag_valid = is_vlanvalid;\n\t\tp->vlan_tag = vlan_tag;\n\t}\n}\n\n \nstatic int sxgbe_tx_ctxt_desc_get_vlantag(struct sxgbe_tx_ctxt_desc *p)\n{\n\treturn p->vlan_tag;\n}\n\n \nstatic void sxgbe_tx_ctxt_desc_set_tstamp(struct sxgbe_tx_ctxt_desc *p,\n\t\t\t\t\t  u8 ostc_enable, u64 tstamp)\n{\n\tif (ostc_enable) {\n\t\tp->ostc = ostc_enable;\n\t\tp->tstamp_lo = (u32) tstamp;\n\t\tp->tstamp_hi = (u32) (tstamp>>32);\n\t}\n}\n \nstatic void sxgbe_tx_ctxt_desc_close(struct sxgbe_tx_ctxt_desc *p)\n{\n\tp->own_bit = 1;\n}\n\n \nstatic int sxgbe_tx_ctxt_desc_get_cde(struct sxgbe_tx_ctxt_desc *p)\n{\n\treturn p->ctxt_desc_err;\n}\n\n \nstatic void sxgbe_init_rx_desc(struct sxgbe_rx_norm_desc *p, int disable_rx_ic,\n\t\t\t       int mode, int end)\n{\n\tp->rdes23.rx_rd_des23.own_bit = 1;\n\tif (disable_rx_ic)\n\t\tp->rdes23.rx_rd_des23.int_on_com = disable_rx_ic;\n}\n\n \nstatic int sxgbe_get_rx_owner(struct sxgbe_rx_norm_desc *p)\n{\n\treturn p->rdes23.rx_rd_des23.own_bit;\n}\n\n \nstatic void sxgbe_set_rx_owner(struct sxgbe_rx_norm_desc *p)\n{\n\tp->rdes23.rx_rd_des23.own_bit = 1;\n}\n\n \nstatic void sxgbe_set_rx_int_on_com(struct sxgbe_rx_norm_desc *p)\n{\n\tp->rdes23.rx_rd_des23.int_on_com = 1;\n}\n\n \nstatic int sxgbe_get_rx_frame_len(struct sxgbe_rx_norm_desc *p)\n{\n\treturn p->rdes23.rx_wb_des23.pkt_len;\n}\n\n \nstatic int sxgbe_get_rx_fd_status(struct sxgbe_rx_norm_desc *p)\n{\n\treturn p->rdes23.rx_wb_des23.first_desc;\n}\n\n \nstatic int sxgbe_get_rx_ld_status(struct sxgbe_rx_norm_desc *p)\n{\n\treturn p->rdes23.rx_wb_des23.last_desc;\n}\n\n\n \nstatic int sxgbe_rx_wbstatus(struct sxgbe_rx_norm_desc *p,\n\t\t\t     struct sxgbe_extra_stats *x, int *checksum)\n{\n\tint status = 0;\n\n\t*checksum = CHECKSUM_UNNECESSARY;\n\tif (p->rdes23.rx_wb_des23.err_summary) {\n\t\tswitch (p->rdes23.rx_wb_des23.err_l2_type) {\n\t\tcase RX_GMII_ERR:\n\t\t\tstatus = -EINVAL;\n\t\t\tx->rx_code_gmii_err++;\n\t\t\tbreak;\n\t\tcase RX_WATCHDOG_ERR:\n\t\t\tstatus = -EINVAL;\n\t\t\tx->rx_watchdog_err++;\n\t\t\tbreak;\n\t\tcase RX_CRC_ERR:\n\t\t\tstatus = -EINVAL;\n\t\t\tx->rx_crc_err++;\n\t\t\tbreak;\n\t\tcase RX_GAINT_ERR:\n\t\t\tstatus = -EINVAL;\n\t\t\tx->rx_gaint_pkt_err++;\n\t\t\tbreak;\n\t\tcase RX_IP_HDR_ERR:\n\t\t\t*checksum = CHECKSUM_NONE;\n\t\t\tx->ip_hdr_err++;\n\t\t\tbreak;\n\t\tcase RX_PAYLOAD_ERR:\n\t\t\t*checksum = CHECKSUM_NONE;\n\t\t\tx->ip_payload_err++;\n\t\t\tbreak;\n\t\tcase RX_OVERFLOW_ERR:\n\t\t\tstatus = -EINVAL;\n\t\t\tx->overflow_error++;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tpr_err(\"Invalid Error type\\n\");\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tswitch (p->rdes23.rx_wb_des23.err_l2_type) {\n\t\tcase RX_LEN_PKT:\n\t\t\tx->len_pkt++;\n\t\t\tbreak;\n\t\tcase RX_MACCTL_PKT:\n\t\t\tx->mac_ctl_pkt++;\n\t\t\tbreak;\n\t\tcase RX_DCBCTL_PKT:\n\t\t\tx->dcb_ctl_pkt++;\n\t\t\tbreak;\n\t\tcase RX_ARP_PKT:\n\t\t\tx->arp_pkt++;\n\t\t\tbreak;\n\t\tcase RX_OAM_PKT:\n\t\t\tx->oam_pkt++;\n\t\t\tbreak;\n\t\tcase RX_UNTAG_PKT:\n\t\t\tx->untag_okt++;\n\t\t\tbreak;\n\t\tcase RX_OTHER_PKT:\n\t\t\tx->other_pkt++;\n\t\t\tbreak;\n\t\tcase RX_SVLAN_PKT:\n\t\t\tx->svlan_tag_pkt++;\n\t\t\tbreak;\n\t\tcase RX_CVLAN_PKT:\n\t\t\tx->cvlan_tag_pkt++;\n\t\t\tbreak;\n\t\tcase RX_DVLAN_OCVLAN_ICVLAN_PKT:\n\t\t\tx->dvlan_ocvlan_icvlan_pkt++;\n\t\t\tbreak;\n\t\tcase RX_DVLAN_OSVLAN_ISVLAN_PKT:\n\t\t\tx->dvlan_osvlan_isvlan_pkt++;\n\t\t\tbreak;\n\t\tcase RX_DVLAN_OSVLAN_ICVLAN_PKT:\n\t\t\tx->dvlan_osvlan_icvlan_pkt++;\n\t\t\tbreak;\n\t\tcase RX_DVLAN_OCVLAN_ISVLAN_PKT:\n\t\t\tx->dvlan_ocvlan_icvlan_pkt++;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tpr_err(\"Invalid L2 Packet type\\n\");\n\t\t\tbreak;\n\t\t}\n\t}\n\n\t \n\tswitch (p->rdes23.rx_wb_des23.layer34_pkt_type) {\n\tcase RX_NOT_IP_PKT:\n\t\tx->not_ip_pkt++;\n\t\tbreak;\n\tcase RX_IPV4_TCP_PKT:\n\t\tx->ip4_tcp_pkt++;\n\t\tbreak;\n\tcase RX_IPV4_UDP_PKT:\n\t\tx->ip4_udp_pkt++;\n\t\tbreak;\n\tcase RX_IPV4_ICMP_PKT:\n\t\tx->ip4_icmp_pkt++;\n\t\tbreak;\n\tcase RX_IPV4_UNKNOWN_PKT:\n\t\tx->ip4_unknown_pkt++;\n\t\tbreak;\n\tcase RX_IPV6_TCP_PKT:\n\t\tx->ip6_tcp_pkt++;\n\t\tbreak;\n\tcase RX_IPV6_UDP_PKT:\n\t\tx->ip6_udp_pkt++;\n\t\tbreak;\n\tcase RX_IPV6_ICMP_PKT:\n\t\tx->ip6_icmp_pkt++;\n\t\tbreak;\n\tcase RX_IPV6_UNKNOWN_PKT:\n\t\tx->ip6_unknown_pkt++;\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"Invalid L3/L4 Packet type\\n\");\n\t\tbreak;\n\t}\n\n\t \n\tif (p->rdes23.rx_wb_des23.vlan_filter_match)\n\t\tx->vlan_filter_match++;\n\n\tif (p->rdes23.rx_wb_des23.sa_filter_fail) {\n\t\tstatus = -EINVAL;\n\t\tx->sa_filter_fail++;\n\t}\n\tif (p->rdes23.rx_wb_des23.da_filter_fail) {\n\t\tstatus = -EINVAL;\n\t\tx->da_filter_fail++;\n\t}\n\tif (p->rdes23.rx_wb_des23.hash_filter_pass)\n\t\tx->hash_filter_pass++;\n\n\tif (p->rdes23.rx_wb_des23.l3_filter_match)\n\t\tx->l3_filter_match++;\n\n\tif (p->rdes23.rx_wb_des23.l4_filter_match)\n\t\tx->l4_filter_match++;\n\n\treturn status;\n}\n\n \nstatic int sxgbe_get_rx_ctxt_owner(struct sxgbe_rx_ctxt_desc *p)\n{\n\treturn p->own_bit;\n}\n\n \nstatic void sxgbe_set_ctxt_rx_owner(struct sxgbe_rx_ctxt_desc *p)\n{\n\tp->own_bit = 1;\n}\n\n\n \nstatic void sxgbe_rx_ctxt_wbstatus(struct sxgbe_rx_ctxt_desc *p,\n\t\t\t\t   struct sxgbe_extra_stats *x)\n{\n\tif (p->tstamp_dropped)\n\t\tx->timestamp_dropped++;\n\n\t \n\tif (p->ptp_msgtype == RX_NO_PTP)\n\t\tx->rx_msg_type_no_ptp++;\n\telse if (p->ptp_msgtype == RX_PTP_SYNC)\n\t\tx->rx_ptp_type_sync++;\n\telse if (p->ptp_msgtype == RX_PTP_FOLLOW_UP)\n\t\tx->rx_ptp_type_follow_up++;\n\telse if (p->ptp_msgtype == RX_PTP_DELAY_REQ)\n\t\tx->rx_ptp_type_delay_req++;\n\telse if (p->ptp_msgtype == RX_PTP_DELAY_RESP)\n\t\tx->rx_ptp_type_delay_resp++;\n\telse if (p->ptp_msgtype == RX_PTP_PDELAY_REQ)\n\t\tx->rx_ptp_type_pdelay_req++;\n\telse if (p->ptp_msgtype == RX_PTP_PDELAY_RESP)\n\t\tx->rx_ptp_type_pdelay_resp++;\n\telse if (p->ptp_msgtype == RX_PTP_PDELAY_FOLLOW_UP)\n\t\tx->rx_ptp_type_pdelay_follow_up++;\n\telse if (p->ptp_msgtype == RX_PTP_ANNOUNCE)\n\t\tx->rx_ptp_announce++;\n\telse if (p->ptp_msgtype == RX_PTP_MGMT)\n\t\tx->rx_ptp_mgmt++;\n\telse if (p->ptp_msgtype == RX_PTP_SIGNAL)\n\t\tx->rx_ptp_signal++;\n\telse if (p->ptp_msgtype == RX_PTP_RESV_MSG)\n\t\tx->rx_ptp_resv_msg_type++;\n}\n\n \nstatic int sxgbe_get_rx_ctxt_tstamp_status(struct sxgbe_rx_ctxt_desc *p)\n{\n\tif ((p->tstamp_hi == 0xffffffff) && (p->tstamp_lo == 0xffffffff)) {\n\t\tpr_err(\"Time stamp corrupted\\n\");\n\t\treturn 0;\n\t}\n\n\treturn p->tstamp_available;\n}\n\n\nstatic u64 sxgbe_get_rx_timestamp(struct sxgbe_rx_ctxt_desc *p)\n{\n\tu64 ns;\n\n\tns = p->tstamp_lo;\n\tns |= ((u64)p->tstamp_hi) << 32;\n\n\treturn ns;\n}\n\nstatic const struct sxgbe_desc_ops desc_ops = {\n\t.init_tx_desc\t\t\t= sxgbe_init_tx_desc,\n\t.tx_desc_enable_tse\t\t= sxgbe_tx_desc_enable_tse,\n\t.prepare_tx_desc\t\t= sxgbe_prepare_tx_desc,\n\t.tx_vlanctl_desc\t\t= sxgbe_tx_vlanctl_desc,\n\t.set_tx_owner\t\t\t= sxgbe_set_tx_owner,\n\t.get_tx_owner\t\t\t= sxgbe_get_tx_owner,\n\t.close_tx_desc\t\t\t= sxgbe_close_tx_desc,\n\t.release_tx_desc\t\t= sxgbe_release_tx_desc,\n\t.clear_tx_ic\t\t\t= sxgbe_clear_tx_ic,\n\t.get_tx_ls\t\t\t= sxgbe_get_tx_ls,\n\t.get_tx_len\t\t\t= sxgbe_get_tx_len,\n\t.tx_enable_tstamp\t\t= sxgbe_tx_enable_tstamp,\n\t.get_tx_timestamp_status\t= sxgbe_get_tx_timestamp_status,\n\t.tx_ctxt_desc_set_ctxt\t\t= sxgbe_tx_ctxt_desc_set_ctxt,\n\t.tx_ctxt_desc_set_owner\t\t= sxgbe_tx_ctxt_desc_set_owner,\n\t.get_tx_ctxt_owner\t\t= sxgbe_tx_ctxt_desc_get_owner,\n\t.tx_ctxt_desc_set_mss\t\t= sxgbe_tx_ctxt_desc_set_mss,\n\t.tx_ctxt_desc_get_mss\t\t= sxgbe_tx_ctxt_desc_get_mss,\n\t.tx_ctxt_desc_set_tcmssv\t= sxgbe_tx_ctxt_desc_set_tcmssv,\n\t.tx_ctxt_desc_reset_ostc\t= sxgbe_tx_ctxt_desc_reset_ostc,\n\t.tx_ctxt_desc_set_ivlantag\t= sxgbe_tx_ctxt_desc_set_ivlantag,\n\t.tx_ctxt_desc_get_ivlantag\t= sxgbe_tx_ctxt_desc_get_ivlantag,\n\t.tx_ctxt_desc_set_vlantag\t= sxgbe_tx_ctxt_desc_set_vlantag,\n\t.tx_ctxt_desc_get_vlantag\t= sxgbe_tx_ctxt_desc_get_vlantag,\n\t.tx_ctxt_set_tstamp\t\t= sxgbe_tx_ctxt_desc_set_tstamp,\n\t.close_tx_ctxt_desc\t\t= sxgbe_tx_ctxt_desc_close,\n\t.get_tx_ctxt_cde\t\t= sxgbe_tx_ctxt_desc_get_cde,\n\t.init_rx_desc\t\t\t= sxgbe_init_rx_desc,\n\t.get_rx_owner\t\t\t= sxgbe_get_rx_owner,\n\t.set_rx_owner\t\t\t= sxgbe_set_rx_owner,\n\t.set_rx_int_on_com\t\t= sxgbe_set_rx_int_on_com,\n\t.get_rx_frame_len\t\t= sxgbe_get_rx_frame_len,\n\t.get_rx_fd_status\t\t= sxgbe_get_rx_fd_status,\n\t.get_rx_ld_status\t\t= sxgbe_get_rx_ld_status,\n\t.rx_wbstatus\t\t\t= sxgbe_rx_wbstatus,\n\t.get_rx_ctxt_owner\t\t= sxgbe_get_rx_ctxt_owner,\n\t.set_rx_ctxt_owner\t\t= sxgbe_set_ctxt_rx_owner,\n\t.rx_ctxt_wbstatus\t\t= sxgbe_rx_ctxt_wbstatus,\n\t.get_rx_ctxt_tstamp_status\t= sxgbe_get_rx_ctxt_tstamp_status,\n\t.get_timestamp\t\t\t= sxgbe_get_rx_timestamp,\n};\n\nconst struct sxgbe_desc_ops *sxgbe_get_desc_ops(void)\n{\n\treturn &desc_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}