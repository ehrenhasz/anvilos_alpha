{
  "module_name": "sxgbe_mtl.c",
  "hash_id": "b3053c1881b3d4854917757aa2c88f723e2026b116d90f7d04dab57d50dbfd8a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/samsung/sxgbe/sxgbe_mtl.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/io.h>\n#include <linux/errno.h>\n#include <linux/export.h>\n#include <linux/jiffies.h>\n\n#include \"sxgbe_mtl.h\"\n#include \"sxgbe_reg.h\"\n\nstatic void sxgbe_mtl_init(void __iomem *ioaddr, unsigned int etsalg,\n\t\t\t   unsigned int raa)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_OP_MODE_REG);\n\treg_val &= ETS_RST;\n\n\t \n\tswitch (etsalg & SXGBE_MTL_OPMODE_ESTMASK) {\n\tcase ETS_WRR:\n\t\treg_val &= ETS_WRR;\n\t\tbreak;\n\tcase ETS_WFQ:\n\t\treg_val |= ETS_WFQ;\n\t\tbreak;\n\tcase ETS_DWRR:\n\t\treg_val |= ETS_DWRR;\n\t\tbreak;\n\t}\n\twritel(reg_val, ioaddr + SXGBE_MTL_OP_MODE_REG);\n\n\tswitch (raa & SXGBE_MTL_OPMODE_RAAMASK) {\n\tcase RAA_SP:\n\t\treg_val &= RAA_SP;\n\t\tbreak;\n\tcase RAA_WSP:\n\t\treg_val |= RAA_WSP;\n\t\tbreak;\n\t}\n\twritel(reg_val, ioaddr + SXGBE_MTL_OP_MODE_REG);\n}\n\n \nstatic void sxgbe_mtl_dma_dm_rxqueue(void __iomem *ioaddr)\n{\n\twritel(RX_QUEUE_DYNAMIC, ioaddr + SXGBE_MTL_RXQ_DMAMAP0_REG);\n\twritel(RX_QUEUE_DYNAMIC, ioaddr + SXGBE_MTL_RXQ_DMAMAP1_REG);\n\twritel(RX_QUEUE_DYNAMIC, ioaddr + SXGBE_MTL_RXQ_DMAMAP2_REG);\n}\n\nstatic void sxgbe_mtl_set_txfifosize(void __iomem *ioaddr, int queue_num,\n\t\t\t\t     int queue_fifo)\n{\n\tu32 fifo_bits, reg_val;\n\n\t \n\tfifo_bits = (queue_fifo / SXGBE_MTL_TX_FIFO_DIV) - 1;\n\treg_val = readl(ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n\treg_val |= (fifo_bits << SXGBE_MTL_FIFO_LSHIFT);\n\twritel(reg_val, ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_set_rxfifosize(void __iomem *ioaddr, int queue_num,\n\t\t\t\t     int queue_fifo)\n{\n\tu32 fifo_bits, reg_val;\n\n\t \n\tfifo_bits = (queue_fifo / SXGBE_MTL_RX_FIFO_DIV)-1;\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val |= (fifo_bits << SXGBE_MTL_FIFO_LSHIFT);\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_enable_txqueue(void __iomem *ioaddr, int queue_num)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n\treg_val |= SXGBE_MTL_ENABLE_QUEUE;\n\twritel(reg_val, ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_disable_txqueue(void __iomem *ioaddr, int queue_num)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n\treg_val &= ~SXGBE_MTL_ENABLE_QUEUE;\n\twritel(reg_val, ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_fc_active(void __iomem *ioaddr, int queue_num,\n\t\t\t\tint threshold)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val &= ~(SXGBE_MTL_FCMASK << RX_FC_ACTIVE);\n\treg_val |= (threshold << RX_FC_ACTIVE);\n\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_fc_enable(void __iomem *ioaddr, int queue_num)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val |= SXGBE_MTL_ENABLE_FC;\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_fc_deactive(void __iomem *ioaddr, int queue_num,\n\t\t\t\t  int threshold)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val &= ~(SXGBE_MTL_FCMASK << RX_FC_DEACTIVE);\n\treg_val |= (threshold << RX_FC_DEACTIVE);\n\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_fep_enable(void __iomem *ioaddr, int queue_num)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val |= SXGBE_MTL_RXQ_OP_FEP;\n\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_fep_disable(void __iomem *ioaddr, int queue_num)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val &= ~(SXGBE_MTL_RXQ_OP_FEP);\n\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_fup_enable(void __iomem *ioaddr, int queue_num)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val |= SXGBE_MTL_RXQ_OP_FUP;\n\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_mtl_fup_disable(void __iomem *ioaddr, int queue_num)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\treg_val &= ~(SXGBE_MTL_RXQ_OP_FUP);\n\n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\n\nstatic void sxgbe_set_tx_mtl_mode(void __iomem *ioaddr, int queue_num,\n\t\t\t\t  int tx_mode)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n\t \n\tif (tx_mode == SXGBE_MTL_SFMODE) {\n\t\treg_val |= SXGBE_MTL_SFMODE;\n\t} else {\n\t\t \n\t\tif (tx_mode <= 64)\n\t\t\treg_val |= MTL_CONTROL_TTC_64;\n\t\telse if (tx_mode <= 96)\n\t\t\treg_val |= MTL_CONTROL_TTC_96;\n\t\telse if (tx_mode <= 128)\n\t\t\treg_val |= MTL_CONTROL_TTC_128;\n\t\telse if (tx_mode <= 192)\n\t\t\treg_val |= MTL_CONTROL_TTC_192;\n\t\telse if (tx_mode <= 256)\n\t\t\treg_val |= MTL_CONTROL_TTC_256;\n\t\telse if (tx_mode <= 384)\n\t\t\treg_val |= MTL_CONTROL_TTC_384;\n\t\telse\n\t\t\treg_val |= MTL_CONTROL_TTC_512;\n\t}\n\n\t \n\twritel(reg_val, ioaddr + SXGBE_MTL_TXQ_OPMODE_REG(queue_num));\n}\n\nstatic void sxgbe_set_rx_mtl_mode(void __iomem *ioaddr, int queue_num,\n\t\t\t\t  int rx_mode)\n{\n\tu32 reg_val;\n\n\treg_val = readl(ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n\t \n\tif (rx_mode == SXGBE_RX_MTL_SFMODE) {\n\t\treg_val |= SXGBE_RX_MTL_SFMODE;\n\t} else {\n\t\tif (rx_mode <= 64)\n\t\t\treg_val |= MTL_CONTROL_RTC_64;\n\t\telse if (rx_mode <= 96)\n\t\t\treg_val |= MTL_CONTROL_RTC_96;\n\t\telse if (rx_mode <= 128)\n\t\t\treg_val |= MTL_CONTROL_RTC_128;\n\t}\n\n\t \n\twritel(reg_val, ioaddr + SXGBE_MTL_RXQ_OPMODE_REG(queue_num));\n}\n\nstatic const struct sxgbe_mtl_ops mtl_ops = {\n\t.mtl_set_txfifosize\t\t= sxgbe_mtl_set_txfifosize,\n\t.mtl_set_rxfifosize\t\t= sxgbe_mtl_set_rxfifosize,\n\t.mtl_enable_txqueue\t\t= sxgbe_mtl_enable_txqueue,\n\t.mtl_disable_txqueue\t\t= sxgbe_mtl_disable_txqueue,\n\t.mtl_dynamic_dma_rxqueue\t= sxgbe_mtl_dma_dm_rxqueue,\n\t.set_tx_mtl_mode\t\t= sxgbe_set_tx_mtl_mode,\n\t.set_rx_mtl_mode\t\t= sxgbe_set_rx_mtl_mode,\n\t.mtl_init\t\t\t= sxgbe_mtl_init,\n\t.mtl_fc_active\t\t\t= sxgbe_mtl_fc_active,\n\t.mtl_fc_deactive\t\t= sxgbe_mtl_fc_deactive,\n\t.mtl_fc_enable\t\t\t= sxgbe_mtl_fc_enable,\n\t.mtl_fep_enable\t\t\t= sxgbe_mtl_fep_enable,\n\t.mtl_fep_disable\t\t= sxgbe_mtl_fep_disable,\n\t.mtl_fup_enable\t\t\t= sxgbe_mtl_fup_enable,\n\t.mtl_fup_disable\t\t= sxgbe_mtl_fup_disable\n};\n\nconst struct sxgbe_mtl_ops *sxgbe_get_mtl_ops(void)\n{\n\treturn &mtl_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}