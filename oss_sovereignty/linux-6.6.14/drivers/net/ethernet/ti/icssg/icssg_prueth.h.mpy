{
  "module_name": "icssg_prueth.h",
  "hash_id": "652e5e02c1db35599c8de86f9868bdd5426ede27e9ce829f8868f2e1b24f620f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ti/icssg/icssg_prueth.h",
  "human_readable_source": " \n \n\n#ifndef __NET_TI_ICSSG_PRUETH_H\n#define __NET_TI_ICSSG_PRUETH_H\n\n#include <linux/etherdevice.h>\n#include <linux/genalloc.h>\n#include <linux/if_vlan.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/mfd/syscon.h>\n#include <linux/module.h>\n#include <linux/mutex.h>\n#include <linux/net_tstamp.h>\n#include <linux/of.h>\n#include <linux/of_irq.h>\n#include <linux/of_mdio.h>\n#include <linux/of_net.h>\n#include <linux/of_platform.h>\n#include <linux/phy.h>\n#include <linux/remoteproc/pruss.h>\n#include <linux/pruss_driver.h>\n#include <linux/ptp_clock_kernel.h>\n#include <linux/remoteproc.h>\n\n#include <linux/dma-mapping.h>\n#include <linux/dma/ti-cppi5.h>\n#include <linux/dma/k3-udma-glue.h>\n\n#include <net/devlink.h>\n\n#include \"icssg_config.h\"\n#include \"icss_iep.h\"\n#include \"icssg_switch_map.h\"\n\n#define PRUETH_MAX_MTU          (2000 - ETH_HLEN - ETH_FCS_LEN)\n#define PRUETH_MIN_PKT_SIZE     (VLAN_ETH_ZLEN)\n#define PRUETH_MAX_PKT_SIZE     (PRUETH_MAX_MTU + ETH_HLEN + ETH_FCS_LEN)\n\n#define ICSS_SLICE0\t0\n#define ICSS_SLICE1\t1\n\n#define ICSS_FW_PRU\t0\n#define ICSS_FW_RTU\t1\n\n#define ICSSG_MAX_RFLOWS\t8\t \n\n \n#define ICSSG_NUM_STATS 60\n#define ICSSG_NUM_STANDARD_STATS 31\n#define ICSSG_NUM_ETHTOOL_STATS (ICSSG_NUM_STATS - ICSSG_NUM_STANDARD_STATS)\n\n \n#define ICSS_HS_FW_READY 0x55555555\n#define ICSS_HS_FW_DEAD 0xDEAD0000\t \n\n \n#define ICSS_HS_CMD_BUSY 0x40000000\n#define ICSS_HS_CMD_DONE 0x80000000\n#define ICSS_HS_CMD_CANCEL 0x10000000\n\n \n#define ICSS_CMD_SPAD 0x20\n#define ICSS_CMD_RXTX 0x10\n#define ICSS_CMD_ADD_FDB 0x1\n#define ICSS_CMD_DEL_FDB 0x2\n#define ICSS_CMD_SET_RUN 0x4\n#define ICSS_CMD_GET_FDB_SLOT 0x5\n#define ICSS_CMD_ENABLE_VLAN 0x5\n#define ICSS_CMD_DISABLE_VLAN 0x6\n#define ICSS_CMD_ADD_FILTER 0x7\n#define ICSS_CMD_ADD_MAC 0x8\n\n \nenum prueth_port {\n\tPRUETH_PORT_HOST = 0,\t \n\tPRUETH_PORT_MII0,\t \n\tPRUETH_PORT_MII1,\t \n\tPRUETH_PORT_INVALID,\t \n};\n\nenum prueth_mac {\n\tPRUETH_MAC0 = 0,\n\tPRUETH_MAC1,\n\tPRUETH_NUM_MACS,\n\tPRUETH_MAC_INVALID,\n};\n\nstruct prueth_tx_chn {\n\tstruct device *dma_dev;\n\tstruct napi_struct napi_tx;\n\tstruct k3_cppi_desc_pool *desc_pool;\n\tstruct k3_udma_glue_tx_channel *tx_chn;\n\tstruct prueth_emac *emac;\n\tu32 id;\n\tu32 descs_num;\n\tunsigned int irq;\n\tchar name[32];\n};\n\nstruct prueth_rx_chn {\n\tstruct device *dev;\n\tstruct device *dma_dev;\n\tstruct k3_cppi_desc_pool *desc_pool;\n\tstruct k3_udma_glue_rx_channel *rx_chn;\n\tu32 descs_num;\n\tunsigned int irq[ICSSG_MAX_RFLOWS];\t \n\tchar name[32];\n};\n\n \n#define PRUETH_MAX_TX_QUEUES\t4\n\n#define PRUETH_MAX_TX_TS_REQUESTS\t50  \n\n \nstruct prueth_emac {\n\tbool fw_running;\n\tstruct prueth *prueth;\n\tstruct net_device *ndev;\n\tu8 mac_addr[6];\n\tstruct napi_struct napi_rx;\n\tu32 msg_enable;\n\n\tint link;\n\tint speed;\n\tint duplex;\n\n\tconst char *phy_id;\n\tstruct device_node *phy_node;\n\tphy_interface_t phy_if;\n\tenum prueth_port port_id;\n\tstruct icss_iep *iep;\n\tunsigned int rx_ts_enabled : 1;\n\tunsigned int tx_ts_enabled : 1;\n\n\t \n\tstruct prueth_tx_chn tx_chns[PRUETH_MAX_TX_QUEUES];\n\tstruct completion tdown_complete;\n\tatomic_t tdown_cnt;\n\tstruct prueth_rx_chn rx_chns;\n\tint rx_flow_id_base;\n\tint tx_ch_num;\n\n\tspinlock_t lock;\t \n\n\t \n\t \n\tstruct sk_buff *tx_ts_skb[PRUETH_MAX_TX_TS_REQUESTS];\n\tatomic_t tx_ts_pending;\n\tint tx_ts_irq;\n\n\tu8 cmd_seq;\n\t \n\tu32 cmd_data[4];\n\tstruct completion cmd_complete;\n\t \n\tstruct mutex cmd_lock;\n\tstruct work_struct rx_mode_work;\n\tstruct workqueue_struct\t*cmd_wq;\n\n\tstruct pruss_mem_region dram;\n\n\tstruct delayed_work stats_work;\n\tu64 stats[ICSSG_NUM_STATS];\n};\n\n \nstruct prueth_pdata {\n\tenum k3_ring_mode fdqring_mode;\n\tu32\tquirk_10m_link_issue:1;\n};\n\n \nstruct prueth {\n\tstruct device *dev;\n\tstruct pruss *pruss;\n\tstruct rproc *pru[PRUSS_NUM_PRUS];\n\tstruct rproc *rtu[PRUSS_NUM_PRUS];\n\tstruct rproc *txpru[PRUSS_NUM_PRUS];\n\tstruct pruss_mem_region shram;\n\tstruct gen_pool *sram_pool;\n\tstruct pruss_mem_region msmcram;\n\n\tstruct device_node *eth_node[PRUETH_NUM_MACS];\n\tstruct prueth_emac *emac[PRUETH_NUM_MACS];\n\tstruct net_device *registered_netdevs[PRUETH_NUM_MACS];\n\tstruct regmap *miig_rt;\n\tstruct regmap *mii_rt;\n\n\tenum pruss_pru_id pru_id[PRUSS_NUM_PRUS];\n\tstruct platform_device *pdev;\n\tstruct prueth_pdata pdata;\n\tu8 icssg_hwcmdseq;\n\tint emacs_initialized;\n\tstruct icss_iep *iep0;\n\tstruct icss_iep *iep1;\n};\n\nstruct emac_tx_ts_response {\n\tu32 reserved[2];\n\tu32 cookie;\n\tu32 lo_ts;\n\tu32 hi_ts;\n};\n\n \nstatic inline int prueth_emac_slice(struct prueth_emac *emac)\n{\n\tswitch (emac->port_id) {\n\tcase PRUETH_PORT_MII0:\n\t\treturn ICSS_SLICE0;\n\tcase PRUETH_PORT_MII1:\n\t\treturn ICSS_SLICE1;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nextern const struct ethtool_ops icssg_ethtool_ops;\n\n \nvoid icssg_class_set_mac_addr(struct regmap *miig_rt, int slice, u8 *mac);\nvoid icssg_class_set_host_mac_addr(struct regmap *miig_rt, const u8 *mac);\nvoid icssg_class_disable(struct regmap *miig_rt, int slice);\nvoid icssg_class_default(struct regmap *miig_rt, int slice, bool allmulti);\nvoid icssg_ft1_set_mac_addr(struct regmap *miig_rt, int slice, u8 *mac_addr);\n\n \nvoid icssg_config_ipg(struct prueth_emac *emac);\nint icssg_config(struct prueth *prueth, struct prueth_emac *emac,\n\t\t int slice);\nint emac_set_port_state(struct prueth_emac *emac,\n\t\t\tenum icssg_port_state_cmd state);\nvoid icssg_config_set_speed(struct prueth_emac *emac);\n\n \nint icssg_queue_pop(struct prueth *prueth, u8 queue);\nvoid icssg_queue_push(struct prueth *prueth, int queue, u16 addr);\nu32 icssg_queue_level(struct prueth *prueth, int queue);\n\n#define prueth_napi_to_tx_chn(pnapi) \\\n\tcontainer_of(pnapi, struct prueth_tx_chn, napi_tx)\n\nvoid emac_stats_work_handler(struct work_struct *work);\nvoid emac_update_hardware_stats(struct prueth_emac *emac);\nint emac_get_stat_by_name(struct prueth_emac *emac, char *stat_name);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}