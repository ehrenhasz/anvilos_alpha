{
  "module_name": "icssg_ethtool.c",
  "hash_id": "d1d5676e28fc5019c427106f9c0192c23032a4d075192de439f77196971a14ee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ti/icssg/icssg_ethtool.c",
  "human_readable_source": "\n \n\n#include \"icssg_prueth.h\"\n#include \"icssg_stats.h\"\n\nstatic void emac_get_drvinfo(struct net_device *ndev,\n\t\t\t     struct ethtool_drvinfo *info)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\tstruct prueth *prueth = emac->prueth;\n\n\tstrscpy(info->driver, dev_driver_string(prueth->dev),\n\t\tsizeof(info->driver));\n\tstrscpy(info->bus_info, dev_name(prueth->dev), sizeof(info->bus_info));\n}\n\nstatic u32 emac_get_msglevel(struct net_device *ndev)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\n\treturn emac->msg_enable;\n}\n\nstatic void emac_set_msglevel(struct net_device *ndev, u32 value)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\n\temac->msg_enable = value;\n}\n\nstatic int emac_get_link_ksettings(struct net_device *ndev,\n\t\t\t\t   struct ethtool_link_ksettings *ecmd)\n{\n\treturn phy_ethtool_get_link_ksettings(ndev, ecmd);\n}\n\nstatic int emac_set_link_ksettings(struct net_device *ndev,\n\t\t\t\t   const struct ethtool_link_ksettings *ecmd)\n{\n\treturn phy_ethtool_set_link_ksettings(ndev, ecmd);\n}\n\nstatic int emac_get_eee(struct net_device *ndev, struct ethtool_eee *edata)\n{\n\tif (!ndev->phydev)\n\t\treturn -EOPNOTSUPP;\n\n\treturn phy_ethtool_get_eee(ndev->phydev, edata);\n}\n\nstatic int emac_set_eee(struct net_device *ndev, struct ethtool_eee *edata)\n{\n\tif (!ndev->phydev)\n\t\treturn -EOPNOTSUPP;\n\n\treturn phy_ethtool_set_eee(ndev->phydev, edata);\n}\n\nstatic int emac_nway_reset(struct net_device *ndev)\n{\n\treturn phy_ethtool_nway_reset(ndev);\n}\n\nstatic int emac_get_sset_count(struct net_device *ndev, int stringset)\n{\n\tswitch (stringset) {\n\tcase ETH_SS_STATS:\n\t\treturn ICSSG_NUM_ETHTOOL_STATS;\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n\nstatic void emac_get_strings(struct net_device *ndev, u32 stringset, u8 *data)\n{\n\tu8 *p = data;\n\tint i;\n\n\tswitch (stringset) {\n\tcase ETH_SS_STATS:\n\t\tfor (i = 0; i < ARRAY_SIZE(icssg_all_stats); i++) {\n\t\t\tif (!icssg_all_stats[i].standard_stats) {\n\t\t\t\tmemcpy(p, icssg_all_stats[i].name,\n\t\t\t\t       ETH_GSTRING_LEN);\n\t\t\t\tp += ETH_GSTRING_LEN;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic void emac_get_ethtool_stats(struct net_device *ndev,\n\t\t\t\t   struct ethtool_stats *stats, u64 *data)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\tint i;\n\n\temac_update_hardware_stats(emac);\n\n\tfor (i = 0; i < ARRAY_SIZE(icssg_all_stats); i++)\n\t\tif (!icssg_all_stats[i].standard_stats)\n\t\t\t*(data++) = emac->stats[i];\n}\n\nstatic int emac_get_ts_info(struct net_device *ndev,\n\t\t\t    struct ethtool_ts_info *info)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\n\tinfo->so_timestamping =\n\t\tSOF_TIMESTAMPING_TX_HARDWARE |\n\t\tSOF_TIMESTAMPING_TX_SOFTWARE |\n\t\tSOF_TIMESTAMPING_RX_HARDWARE |\n\t\tSOF_TIMESTAMPING_RX_SOFTWARE |\n\t\tSOF_TIMESTAMPING_SOFTWARE |\n\t\tSOF_TIMESTAMPING_RAW_HARDWARE;\n\n\tinfo->phc_index = icss_iep_get_ptp_clock_idx(emac->iep);\n\tinfo->tx_types = BIT(HWTSTAMP_TX_OFF) | BIT(HWTSTAMP_TX_ON);\n\tinfo->rx_filters = BIT(HWTSTAMP_FILTER_NONE) | BIT(HWTSTAMP_FILTER_ALL);\n\n\treturn 0;\n}\n\nstatic int emac_set_channels(struct net_device *ndev,\n\t\t\t     struct ethtool_channels *ch)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\n\t \n\tif (netif_running(emac->ndev))\n\t\treturn -EBUSY;\n\n\temac->tx_ch_num = ch->tx_count;\n\n\treturn 0;\n}\n\nstatic void emac_get_channels(struct net_device *ndev,\n\t\t\t      struct ethtool_channels *ch)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\n\tch->max_rx = 1;\n\tch->max_tx = PRUETH_MAX_TX_QUEUES;\n\tch->rx_count = 1;\n\tch->tx_count = emac->tx_ch_num;\n}\n\nstatic const struct ethtool_rmon_hist_range emac_rmon_ranges[] = {\n\t{    0,   64},\n\t{   65,  128},\n\t{  129,  256},\n\t{  257,  512},\n\t{  513, PRUETH_MAX_PKT_SIZE},\n\t{}\n};\n\nstatic void emac_get_rmon_stats(struct net_device *ndev,\n\t\t\t\tstruct ethtool_rmon_stats *rmon_stats,\n\t\t\t\tconst struct ethtool_rmon_hist_range **ranges)\n{\n\tstruct prueth_emac *emac = netdev_priv(ndev);\n\n\t*ranges = emac_rmon_ranges;\n\n\trmon_stats->undersize_pkts = emac_get_stat_by_name(emac, \"rx_bucket1_frames\") -\n\t\t\t\t     emac_get_stat_by_name(emac, \"rx_64B_frames\");\n\n\trmon_stats->hist[0] = emac_get_stat_by_name(emac, \"rx_bucket1_frames\");\n\trmon_stats->hist[1] = emac_get_stat_by_name(emac, \"rx_bucket2_frames\");\n\trmon_stats->hist[2] = emac_get_stat_by_name(emac, \"rx_bucket3_frames\");\n\trmon_stats->hist[3] = emac_get_stat_by_name(emac, \"rx_bucket4_frames\");\n\trmon_stats->hist[4] = emac_get_stat_by_name(emac, \"rx_bucket5_frames\");\n\n\trmon_stats->hist_tx[0] = emac_get_stat_by_name(emac, \"tx_bucket1_frames\");\n\trmon_stats->hist_tx[1] = emac_get_stat_by_name(emac, \"tx_bucket2_frames\");\n\trmon_stats->hist_tx[2] = emac_get_stat_by_name(emac, \"tx_bucket3_frames\");\n\trmon_stats->hist_tx[3] = emac_get_stat_by_name(emac, \"tx_bucket4_frames\");\n\trmon_stats->hist_tx[4] = emac_get_stat_by_name(emac, \"tx_bucket5_frames\");\n}\n\nconst struct ethtool_ops icssg_ethtool_ops = {\n\t.get_drvinfo = emac_get_drvinfo,\n\t.get_msglevel = emac_get_msglevel,\n\t.set_msglevel = emac_set_msglevel,\n\t.get_sset_count = emac_get_sset_count,\n\t.get_ethtool_stats = emac_get_ethtool_stats,\n\t.get_strings = emac_get_strings,\n\t.get_ts_info = emac_get_ts_info,\n\t.get_channels = emac_get_channels,\n\t.set_channels = emac_set_channels,\n\t.get_link_ksettings = emac_get_link_ksettings,\n\t.set_link_ksettings = emac_set_link_ksettings,\n\t.get_link = ethtool_op_get_link,\n\t.get_eee = emac_get_eee,\n\t.set_eee = emac_set_eee,\n\t.nway_reset = emac_nway_reset,\n\t.get_rmon_stats = emac_get_rmon_stats,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}