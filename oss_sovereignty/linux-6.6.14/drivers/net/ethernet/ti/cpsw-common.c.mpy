{
  "module_name": "cpsw-common.c",
  "hash_id": "e203cf864c897aa5ade14d39f3120f5dc6a84393ea012ceb4ac3f36cbffdc170",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ti/cpsw-common.c",
  "human_readable_source": "\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/regmap.h>\n#include <linux/mfd/syscon.h>\n\n#include \"cpsw.h\"\n\n#define CTRL_MAC_LO_REG(offset, id) ((offset) + 0x8 * (id))\n#define CTRL_MAC_HI_REG(offset, id) ((offset) + 0x8 * (id) + 0x4)\n\nstatic int davinci_emac_3517_get_macid(struct device *dev, u16 offset,\n\t\t\t\t       int slave, u8 *mac_addr)\n{\n\tu32 macid_lsb;\n\tu32 macid_msb;\n\tstruct regmap *syscon;\n\n\tsyscon = syscon_regmap_lookup_by_phandle(dev->of_node, \"syscon\");\n\tif (IS_ERR(syscon)) {\n\t\tif (PTR_ERR(syscon) == -ENODEV)\n\t\t\treturn 0;\n\t\treturn PTR_ERR(syscon);\n\t}\n\n\tregmap_read(syscon, CTRL_MAC_LO_REG(offset, slave), &macid_lsb);\n\tregmap_read(syscon, CTRL_MAC_HI_REG(offset, slave), &macid_msb);\n\n\tmac_addr[0] = (macid_msb >> 16) & 0xff;\n\tmac_addr[1] = (macid_msb >> 8)  & 0xff;\n\tmac_addr[2] = macid_msb & 0xff;\n\tmac_addr[3] = (macid_lsb >> 16) & 0xff;\n\tmac_addr[4] = (macid_lsb >> 8)  & 0xff;\n\tmac_addr[5] = macid_lsb & 0xff;\n\n\treturn 0;\n}\n\nstatic int cpsw_am33xx_cm_get_macid(struct device *dev, u16 offset, int slave,\n\t\t\t\t    u8 *mac_addr)\n{\n\tu32 macid_lo;\n\tu32 macid_hi;\n\tstruct regmap *syscon;\n\n\tsyscon = syscon_regmap_lookup_by_phandle(dev->of_node, \"syscon\");\n\tif (IS_ERR(syscon)) {\n\t\tif (PTR_ERR(syscon) == -ENODEV)\n\t\t\treturn 0;\n\t\treturn PTR_ERR(syscon);\n\t}\n\n\tregmap_read(syscon, CTRL_MAC_LO_REG(offset, slave), &macid_lo);\n\tregmap_read(syscon, CTRL_MAC_HI_REG(offset, slave), &macid_hi);\n\n\tmac_addr[5] = (macid_lo >> 8) & 0xff;\n\tmac_addr[4] = macid_lo & 0xff;\n\tmac_addr[3] = (macid_hi >> 24) & 0xff;\n\tmac_addr[2] = (macid_hi >> 16) & 0xff;\n\tmac_addr[1] = (macid_hi >> 8) & 0xff;\n\tmac_addr[0] = macid_hi & 0xff;\n\n\treturn 0;\n}\n\nint ti_cm_get_macid(struct device *dev, int slave, u8 *mac_addr)\n{\n\tif (of_machine_is_compatible(\"ti,dm8148\"))\n\t\treturn cpsw_am33xx_cm_get_macid(dev, 0x630, slave, mac_addr);\n\n\tif (of_machine_is_compatible(\"ti,am33xx\"))\n\t\treturn cpsw_am33xx_cm_get_macid(dev, 0x630, slave, mac_addr);\n\n\tif (of_device_is_compatible(dev->of_node, \"ti,am3517-emac\"))\n\t\treturn davinci_emac_3517_get_macid(dev, 0x110, slave, mac_addr);\n\n\tif (of_device_is_compatible(dev->of_node, \"ti,dm816-emac\"))\n\t\treturn cpsw_am33xx_cm_get_macid(dev, 0x30, slave, mac_addr);\n\n\tif (of_machine_is_compatible(\"ti,am43\"))\n\t\treturn cpsw_am33xx_cm_get_macid(dev, 0x630, slave, mac_addr);\n\n\tif (of_machine_is_compatible(\"ti,dra7\"))\n\t\treturn davinci_emac_3517_get_macid(dev, 0x514, slave, mac_addr);\n\n\tdev_info(dev, \"incompatible machine/device type for reading mac address\\n\");\n\treturn -ENOENT;\n}\nEXPORT_SYMBOL_GPL(ti_cm_get_macid);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}