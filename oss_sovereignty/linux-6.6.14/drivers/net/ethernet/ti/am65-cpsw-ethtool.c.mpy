{
  "module_name": "am65-cpsw-ethtool.c",
  "hash_id": "99092e1bb11271082c542f0ade590210de368308a64373eb8cac9fedd50aa7ea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ti/am65-cpsw-ethtool.c",
  "human_readable_source": "\n \n\n#include <linux/net_tstamp.h>\n#include <linux/phylink.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n\n#include \"am65-cpsw-nuss.h\"\n#include \"cpsw_ale.h\"\n#include \"am65-cpts.h\"\n\n#define AM65_CPSW_REGDUMP_VER 0x1\n\nenum {\n\tAM65_CPSW_REGDUMP_MOD_NUSS = 1,\n\tAM65_CPSW_REGDUMP_MOD_RGMII_STATUS = 2,\n\tAM65_CPSW_REGDUMP_MOD_MDIO = 3,\n\tAM65_CPSW_REGDUMP_MOD_CPSW = 4,\n\tAM65_CPSW_REGDUMP_MOD_CPSW_P0 = 5,\n\tAM65_CPSW_REGDUMP_MOD_CPSW_P1 = 6,\n\tAM65_CPSW_REGDUMP_MOD_CPSW_CPTS = 7,\n\tAM65_CPSW_REGDUMP_MOD_CPSW_ALE = 8,\n\tAM65_CPSW_REGDUMP_MOD_CPSW_ALE_TBL = 9,\n\tAM65_CPSW_REGDUMP_MOD_LAST,\n};\n\n \n\nstruct am65_cpsw_regdump_hdr {\n\tu32 module_id;\n\tu32 len;\n};\n\n \nstruct am65_cpsw_regdump_item {\n\tstruct am65_cpsw_regdump_hdr hdr;\n\tu32 start_ofs;\n\tu32 end_ofs;\n};\n\n#define AM65_CPSW_REGDUMP_REC(mod, start, end) { \\\n\t.hdr.module_id = (mod), \\\n\t.hdr.len = (end + 4 - start) * 2 + \\\n\t\t   sizeof(struct am65_cpsw_regdump_hdr), \\\n\t.start_ofs = (start), \\\n\t.end_ofs = end, \\\n}\n\nstatic const struct am65_cpsw_regdump_item am65_cpsw_regdump[] = {\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_NUSS, 0x0, 0x1c),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_RGMII_STATUS, 0x30, 0x4c),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_MDIO, 0xf00, 0xffc),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_CPSW, 0x20000, 0x2011c),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_CPSW_P0, 0x21000, 0x21320),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_CPSW_P1, 0x22000, 0x223a4),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_CPSW_CPTS,\n\t\t\t      0x3d000, 0x3d048),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_CPSW_ALE, 0x3e000, 0x3e13c),\n\tAM65_CPSW_REGDUMP_REC(AM65_CPSW_REGDUMP_MOD_CPSW_ALE_TBL, 0, 0),\n};\n\nstruct am65_cpsw_stats_regs {\n\tu32\trx_good_frames;\n\tu32\trx_broadcast_frames;\n\tu32\trx_multicast_frames;\n\tu32\trx_pause_frames;\t\t \n\tu32\trx_crc_errors;\n\tu32\trx_align_code_errors;\t\t \n\tu32\trx_oversized_frames;\n\tu32\trx_jabber_frames;\t\t \n\tu32\trx_undersized_frames;\n\tu32\trx_fragments;\t\t\t \n\tu32\tale_drop;\n\tu32\tale_overrun_drop;\n\tu32\trx_octets;\n\tu32\ttx_good_frames;\n\tu32\ttx_broadcast_frames;\n\tu32\ttx_multicast_frames;\n\tu32\ttx_pause_frames;\t\t \n\tu32\ttx_deferred_frames;\t\t \n\tu32\ttx_collision_frames;\t\t \n\tu32\ttx_single_coll_frames;\t\t \n\tu32\ttx_mult_coll_frames;\t\t \n\tu32\ttx_excessive_collisions;\t \n\tu32\ttx_late_collisions;\t\t \n\tu32\trx_ipg_error;\t\t\t \n\tu32\ttx_carrier_sense_errors;\t \n\tu32\ttx_octets;\n\tu32\ttx_64B_frames;\n\tu32\ttx_65_to_127B_frames;\n\tu32\ttx_128_to_255B_frames;\n\tu32\ttx_256_to_511B_frames;\n\tu32\ttx_512_to_1023B_frames;\n\tu32\ttx_1024B_frames;\n\tu32\tnet_octets;\n\tu32\trx_bottom_fifo_drop;\n\tu32\trx_port_mask_drop;\n\tu32\trx_top_fifo_drop;\n\tu32\tale_rate_limit_drop;\n\tu32\tale_vid_ingress_drop;\n\tu32\tale_da_eq_sa_drop;\n\tu32\tale_block_drop;\t\t\t \n\tu32\tale_secure_drop;\t\t \n\tu32\tale_auth_drop;\t\t\t \n\tu32\tale_unknown_ucast;\n\tu32\tale_unknown_ucast_bytes;\n\tu32\tale_unknown_mcast;\n\tu32\tale_unknown_mcast_bytes;\n\tu32\tale_unknown_bcast;\n\tu32\tale_unknown_bcast_bytes;\n\tu32\tale_pol_match;\n\tu32\tale_pol_match_red;\n\tu32\tale_pol_match_yellow;\n\tu32\tale_mcast_sa_drop;\t\t \n\tu32\tale_dual_vlan_drop;\t\t \n\tu32\tale_len_err_drop;\t\t \n\tu32\tale_ip_next_hdr_drop;\t\t \n\tu32\tale_ipv4_frag_drop;\t\t \n\tu32\t__rsvd_1[24];\n\tu32\tiet_rx_assembly_err;\t\t \n\tu32\tiet_rx_assembly_ok;\t\t \n\tu32\tiet_rx_smd_err;\t\t\t \n\tu32\tiet_rx_frag;\t\t\t \n\tu32\tiet_tx_hold;\t\t\t \n\tu32\tiet_tx_frag;\t\t\t \n\tu32\t__rsvd_2[9];\n\tu32\ttx_mem_protect_err;\n\t \n\tu32\ttx_pri0;\n\tu32\ttx_pri1;\n\tu32\ttx_pri2;\n\tu32\ttx_pri3;\n\tu32\ttx_pri4;\n\tu32\ttx_pri5;\n\tu32\ttx_pri6;\n\tu32\ttx_pri7;\n\tu32\ttx_pri0_bcnt;\n\tu32\ttx_pri1_bcnt;\n\tu32\ttx_pri2_bcnt;\n\tu32\ttx_pri3_bcnt;\n\tu32\ttx_pri4_bcnt;\n\tu32\ttx_pri5_bcnt;\n\tu32\ttx_pri6_bcnt;\n\tu32\ttx_pri7_bcnt;\n\tu32\ttx_pri0_drop;\n\tu32\ttx_pri1_drop;\n\tu32\ttx_pri2_drop;\n\tu32\ttx_pri3_drop;\n\tu32\ttx_pri4_drop;\n\tu32\ttx_pri5_drop;\n\tu32\ttx_pri6_drop;\n\tu32\ttx_pri7_drop;\n\tu32\ttx_pri0_drop_bcnt;\n\tu32\ttx_pri1_drop_bcnt;\n\tu32\ttx_pri2_drop_bcnt;\n\tu32\ttx_pri3_drop_bcnt;\n\tu32\ttx_pri4_drop_bcnt;\n\tu32\ttx_pri5_drop_bcnt;\n\tu32\ttx_pri6_drop_bcnt;\n\tu32\ttx_pri7_drop_bcnt;\n};\n\nstruct am65_cpsw_ethtool_stat {\n\tchar desc[ETH_GSTRING_LEN];\n\tint offset;\n};\n\n#define AM65_CPSW_STATS(prefix, field)\t\t\t\\\n{\t\t\t\t\t\t\t\\\n\t#prefix#field,\t\t\t\t\t\\\n\toffsetof(struct am65_cpsw_stats_regs, field)\t\\\n}\n\nstatic const struct am65_cpsw_ethtool_stat am65_host_stats[] = {\n\tAM65_CPSW_STATS(p0_, rx_good_frames),\n\tAM65_CPSW_STATS(p0_, rx_broadcast_frames),\n\tAM65_CPSW_STATS(p0_, rx_multicast_frames),\n\tAM65_CPSW_STATS(p0_, rx_crc_errors),\n\tAM65_CPSW_STATS(p0_, rx_oversized_frames),\n\tAM65_CPSW_STATS(p0_, rx_undersized_frames),\n\tAM65_CPSW_STATS(p0_, ale_drop),\n\tAM65_CPSW_STATS(p0_, ale_overrun_drop),\n\tAM65_CPSW_STATS(p0_, rx_octets),\n\tAM65_CPSW_STATS(p0_, tx_good_frames),\n\tAM65_CPSW_STATS(p0_, tx_broadcast_frames),\n\tAM65_CPSW_STATS(p0_, tx_multicast_frames),\n\tAM65_CPSW_STATS(p0_, tx_octets),\n\tAM65_CPSW_STATS(p0_, tx_64B_frames),\n\tAM65_CPSW_STATS(p0_, tx_65_to_127B_frames),\n\tAM65_CPSW_STATS(p0_, tx_128_to_255B_frames),\n\tAM65_CPSW_STATS(p0_, tx_256_to_511B_frames),\n\tAM65_CPSW_STATS(p0_, tx_512_to_1023B_frames),\n\tAM65_CPSW_STATS(p0_, tx_1024B_frames),\n\tAM65_CPSW_STATS(p0_, net_octets),\n\tAM65_CPSW_STATS(p0_, rx_bottom_fifo_drop),\n\tAM65_CPSW_STATS(p0_, rx_port_mask_drop),\n\tAM65_CPSW_STATS(p0_, rx_top_fifo_drop),\n\tAM65_CPSW_STATS(p0_, ale_rate_limit_drop),\n\tAM65_CPSW_STATS(p0_, ale_vid_ingress_drop),\n\tAM65_CPSW_STATS(p0_, ale_da_eq_sa_drop),\n\tAM65_CPSW_STATS(p0_, ale_block_drop),\n\tAM65_CPSW_STATS(p0_, ale_secure_drop),\n\tAM65_CPSW_STATS(p0_, ale_auth_drop),\n\tAM65_CPSW_STATS(p0_, ale_unknown_ucast),\n\tAM65_CPSW_STATS(p0_, ale_unknown_ucast_bytes),\n\tAM65_CPSW_STATS(p0_, ale_unknown_mcast),\n\tAM65_CPSW_STATS(p0_, ale_unknown_mcast_bytes),\n\tAM65_CPSW_STATS(p0_, ale_unknown_bcast),\n\tAM65_CPSW_STATS(p0_, ale_unknown_bcast_bytes),\n\tAM65_CPSW_STATS(p0_, ale_pol_match),\n\tAM65_CPSW_STATS(p0_, ale_pol_match_red),\n\tAM65_CPSW_STATS(p0_, ale_pol_match_yellow),\n\tAM65_CPSW_STATS(p0_, ale_mcast_sa_drop),\n\tAM65_CPSW_STATS(p0_, ale_dual_vlan_drop),\n\tAM65_CPSW_STATS(p0_, ale_len_err_drop),\n\tAM65_CPSW_STATS(p0_, ale_ip_next_hdr_drop),\n\tAM65_CPSW_STATS(p0_, ale_ipv4_frag_drop),\n\tAM65_CPSW_STATS(p0_, tx_mem_protect_err),\n\tAM65_CPSW_STATS(p0_, tx_pri0),\n\tAM65_CPSW_STATS(p0_, tx_pri1),\n\tAM65_CPSW_STATS(p0_, tx_pri2),\n\tAM65_CPSW_STATS(p0_, tx_pri3),\n\tAM65_CPSW_STATS(p0_, tx_pri4),\n\tAM65_CPSW_STATS(p0_, tx_pri5),\n\tAM65_CPSW_STATS(p0_, tx_pri6),\n\tAM65_CPSW_STATS(p0_, tx_pri7),\n\tAM65_CPSW_STATS(p0_, tx_pri0_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri1_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri2_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri3_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri4_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri5_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri6_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri7_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri0_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri1_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri2_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri3_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri4_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri5_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri6_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri7_drop),\n\tAM65_CPSW_STATS(p0_, tx_pri0_drop_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri1_drop_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri2_drop_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri3_drop_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri4_drop_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri5_drop_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri6_drop_bcnt),\n\tAM65_CPSW_STATS(p0_, tx_pri7_drop_bcnt),\n};\n\nstatic const struct am65_cpsw_ethtool_stat am65_slave_stats[] = {\n\tAM65_CPSW_STATS(, rx_good_frames),\n\tAM65_CPSW_STATS(, rx_broadcast_frames),\n\tAM65_CPSW_STATS(, rx_multicast_frames),\n\tAM65_CPSW_STATS(, rx_pause_frames),\n\tAM65_CPSW_STATS(, rx_crc_errors),\n\tAM65_CPSW_STATS(, rx_align_code_errors),\n\tAM65_CPSW_STATS(, rx_oversized_frames),\n\tAM65_CPSW_STATS(, rx_jabber_frames),\n\tAM65_CPSW_STATS(, rx_undersized_frames),\n\tAM65_CPSW_STATS(, rx_fragments),\n\tAM65_CPSW_STATS(, ale_drop),\n\tAM65_CPSW_STATS(, ale_overrun_drop),\n\tAM65_CPSW_STATS(, rx_octets),\n\tAM65_CPSW_STATS(, tx_good_frames),\n\tAM65_CPSW_STATS(, tx_broadcast_frames),\n\tAM65_CPSW_STATS(, tx_multicast_frames),\n\tAM65_CPSW_STATS(, tx_pause_frames),\n\tAM65_CPSW_STATS(, tx_deferred_frames),\n\tAM65_CPSW_STATS(, tx_collision_frames),\n\tAM65_CPSW_STATS(, tx_single_coll_frames),\n\tAM65_CPSW_STATS(, tx_mult_coll_frames),\n\tAM65_CPSW_STATS(, tx_excessive_collisions),\n\tAM65_CPSW_STATS(, tx_late_collisions),\n\tAM65_CPSW_STATS(, rx_ipg_error),\n\tAM65_CPSW_STATS(, tx_carrier_sense_errors),\n\tAM65_CPSW_STATS(, tx_octets),\n\tAM65_CPSW_STATS(, tx_64B_frames),\n\tAM65_CPSW_STATS(, tx_65_to_127B_frames),\n\tAM65_CPSW_STATS(, tx_128_to_255B_frames),\n\tAM65_CPSW_STATS(, tx_256_to_511B_frames),\n\tAM65_CPSW_STATS(, tx_512_to_1023B_frames),\n\tAM65_CPSW_STATS(, tx_1024B_frames),\n\tAM65_CPSW_STATS(, net_octets),\n\tAM65_CPSW_STATS(, rx_bottom_fifo_drop),\n\tAM65_CPSW_STATS(, rx_port_mask_drop),\n\tAM65_CPSW_STATS(, rx_top_fifo_drop),\n\tAM65_CPSW_STATS(, ale_rate_limit_drop),\n\tAM65_CPSW_STATS(, ale_vid_ingress_drop),\n\tAM65_CPSW_STATS(, ale_da_eq_sa_drop),\n\tAM65_CPSW_STATS(, ale_block_drop),\n\tAM65_CPSW_STATS(, ale_secure_drop),\n\tAM65_CPSW_STATS(, ale_auth_drop),\n\tAM65_CPSW_STATS(, ale_unknown_ucast),\n\tAM65_CPSW_STATS(, ale_unknown_ucast_bytes),\n\tAM65_CPSW_STATS(, ale_unknown_mcast),\n\tAM65_CPSW_STATS(, ale_unknown_mcast_bytes),\n\tAM65_CPSW_STATS(, ale_unknown_bcast),\n\tAM65_CPSW_STATS(, ale_unknown_bcast_bytes),\n\tAM65_CPSW_STATS(, ale_pol_match),\n\tAM65_CPSW_STATS(, ale_pol_match_red),\n\tAM65_CPSW_STATS(, ale_pol_match_yellow),\n\tAM65_CPSW_STATS(, ale_mcast_sa_drop),\n\tAM65_CPSW_STATS(, ale_dual_vlan_drop),\n\tAM65_CPSW_STATS(, ale_len_err_drop),\n\tAM65_CPSW_STATS(, ale_ip_next_hdr_drop),\n\tAM65_CPSW_STATS(, ale_ipv4_frag_drop),\n\tAM65_CPSW_STATS(, iet_rx_assembly_err),\n\tAM65_CPSW_STATS(, iet_rx_assembly_ok),\n\tAM65_CPSW_STATS(, iet_rx_smd_err),\n\tAM65_CPSW_STATS(, iet_rx_frag),\n\tAM65_CPSW_STATS(, iet_tx_hold),\n\tAM65_CPSW_STATS(, iet_tx_frag),\n\tAM65_CPSW_STATS(, tx_mem_protect_err),\n\tAM65_CPSW_STATS(, tx_pri0),\n\tAM65_CPSW_STATS(, tx_pri1),\n\tAM65_CPSW_STATS(, tx_pri2),\n\tAM65_CPSW_STATS(, tx_pri3),\n\tAM65_CPSW_STATS(, tx_pri4),\n\tAM65_CPSW_STATS(, tx_pri5),\n\tAM65_CPSW_STATS(, tx_pri6),\n\tAM65_CPSW_STATS(, tx_pri7),\n\tAM65_CPSW_STATS(, tx_pri0_bcnt),\n\tAM65_CPSW_STATS(, tx_pri1_bcnt),\n\tAM65_CPSW_STATS(, tx_pri2_bcnt),\n\tAM65_CPSW_STATS(, tx_pri3_bcnt),\n\tAM65_CPSW_STATS(, tx_pri4_bcnt),\n\tAM65_CPSW_STATS(, tx_pri5_bcnt),\n\tAM65_CPSW_STATS(, tx_pri6_bcnt),\n\tAM65_CPSW_STATS(, tx_pri7_bcnt),\n\tAM65_CPSW_STATS(, tx_pri0_drop),\n\tAM65_CPSW_STATS(, tx_pri1_drop),\n\tAM65_CPSW_STATS(, tx_pri2_drop),\n\tAM65_CPSW_STATS(, tx_pri3_drop),\n\tAM65_CPSW_STATS(, tx_pri4_drop),\n\tAM65_CPSW_STATS(, tx_pri5_drop),\n\tAM65_CPSW_STATS(, tx_pri6_drop),\n\tAM65_CPSW_STATS(, tx_pri7_drop),\n\tAM65_CPSW_STATS(, tx_pri0_drop_bcnt),\n\tAM65_CPSW_STATS(, tx_pri1_drop_bcnt),\n\tAM65_CPSW_STATS(, tx_pri2_drop_bcnt),\n\tAM65_CPSW_STATS(, tx_pri3_drop_bcnt),\n\tAM65_CPSW_STATS(, tx_pri4_drop_bcnt),\n\tAM65_CPSW_STATS(, tx_pri5_drop_bcnt),\n\tAM65_CPSW_STATS(, tx_pri6_drop_bcnt),\n\tAM65_CPSW_STATS(, tx_pri7_drop_bcnt),\n};\n\n \nstatic const char am65_cpsw_ethtool_priv_flags[][ETH_GSTRING_LEN] = {\n#define\tAM65_CPSW_PRIV_P0_RX_PTYPE_RROBIN\tBIT(0)\n\t\"p0-rx-ptype-rrobin\",\n};\n\nstatic int am65_cpsw_ethtool_op_begin(struct net_device *ndev)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\tint ret;\n\n\tret = pm_runtime_resume_and_get(common->dev);\n\tif (ret < 0)\n\t\tdev_err(common->dev, \"ethtool begin failed %d\\n\", ret);\n\n\treturn ret;\n}\n\nstatic void am65_cpsw_ethtool_op_complete(struct net_device *ndev)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\tint ret;\n\n\tret = pm_runtime_put(common->dev);\n\tif (ret < 0 && ret != -EBUSY)\n\t\tdev_err(common->dev, \"ethtool complete failed %d\\n\", ret);\n}\n\nstatic void am65_cpsw_get_drvinfo(struct net_device *ndev,\n\t\t\t\t  struct ethtool_drvinfo *info)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\n\tstrscpy(info->driver, dev_driver_string(common->dev),\n\t\tsizeof(info->driver));\n\tstrscpy(info->bus_info, dev_name(common->dev), sizeof(info->bus_info));\n}\n\nstatic u32 am65_cpsw_get_msglevel(struct net_device *ndev)\n{\n\tstruct am65_cpsw_ndev_priv *priv = am65_ndev_to_priv(ndev);\n\n\treturn priv->msg_enable;\n}\n\nstatic void am65_cpsw_set_msglevel(struct net_device *ndev, u32 value)\n{\n\tstruct am65_cpsw_ndev_priv *priv = am65_ndev_to_priv(ndev);\n\n\tpriv->msg_enable = value;\n}\n\nstatic void am65_cpsw_get_channels(struct net_device *ndev,\n\t\t\t\t   struct ethtool_channels *ch)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\n\tch->max_rx = AM65_CPSW_MAX_RX_QUEUES;\n\tch->max_tx = AM65_CPSW_MAX_TX_QUEUES;\n\tch->rx_count = AM65_CPSW_MAX_RX_QUEUES;\n\tch->tx_count = common->tx_ch_num;\n}\n\nstatic int am65_cpsw_set_channels(struct net_device *ndev,\n\t\t\t\t  struct ethtool_channels *chs)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\n\tif (!chs->rx_count || !chs->tx_count)\n\t\treturn -EINVAL;\n\n\t \n\tif (common->usage_count)\n\t\treturn -EBUSY;\n\n\tam65_cpsw_nuss_remove_tx_chns(common);\n\n\treturn am65_cpsw_nuss_update_tx_chns(common, chs->tx_count);\n}\n\nstatic void\nam65_cpsw_get_ringparam(struct net_device *ndev,\n\t\t\tstruct ethtool_ringparam *ering,\n\t\t\tstruct kernel_ethtool_ringparam *kernel_ering,\n\t\t\tstruct netlink_ext_ack *extack)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\n\t \n\tering->tx_pending = common->tx_chns[0].descs_num;\n\tering->rx_pending = common->rx_chns.descs_num;\n}\n\nstatic void am65_cpsw_get_pauseparam(struct net_device *ndev,\n\t\t\t\t     struct ethtool_pauseparam *pause)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\tphylink_ethtool_get_pauseparam(salve->phylink, pause);\n}\n\nstatic int am65_cpsw_set_pauseparam(struct net_device *ndev,\n\t\t\t\t    struct ethtool_pauseparam *pause)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\treturn phylink_ethtool_set_pauseparam(salve->phylink, pause);\n}\n\nstatic void am65_cpsw_get_wol(struct net_device *ndev,\n\t\t\t      struct ethtool_wolinfo *wol)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\tphylink_ethtool_get_wol(salve->phylink, wol);\n}\n\nstatic int am65_cpsw_set_wol(struct net_device *ndev,\n\t\t\t     struct ethtool_wolinfo *wol)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\treturn phylink_ethtool_set_wol(salve->phylink, wol);\n}\n\nstatic int am65_cpsw_get_link_ksettings(struct net_device *ndev,\n\t\t\t\t\tstruct ethtool_link_ksettings *ecmd)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\treturn phylink_ethtool_ksettings_get(salve->phylink, ecmd);\n}\n\nstatic int\nam65_cpsw_set_link_ksettings(struct net_device *ndev,\n\t\t\t     const struct ethtool_link_ksettings *ecmd)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\treturn phylink_ethtool_ksettings_set(salve->phylink, ecmd);\n}\n\nstatic int am65_cpsw_get_eee(struct net_device *ndev, struct ethtool_eee *edata)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\treturn phylink_ethtool_get_eee(salve->phylink, edata);\n}\n\nstatic int am65_cpsw_set_eee(struct net_device *ndev, struct ethtool_eee *edata)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\treturn phylink_ethtool_set_eee(salve->phylink, edata);\n}\n\nstatic int am65_cpsw_nway_reset(struct net_device *ndev)\n{\n\tstruct am65_cpsw_slave_data *salve = am65_ndev_to_slave(ndev);\n\n\treturn phylink_ethtool_nway_reset(salve->phylink);\n}\n\nstatic int am65_cpsw_get_regs_len(struct net_device *ndev)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\tu32 ale_entries, i, regdump_len = 0;\n\n\tale_entries = cpsw_ale_get_num_entries(common->ale);\n\tfor (i = 0; i < ARRAY_SIZE(am65_cpsw_regdump); i++) {\n\t\tif (am65_cpsw_regdump[i].hdr.module_id ==\n\t\t    AM65_CPSW_REGDUMP_MOD_CPSW_ALE_TBL) {\n\t\t\tregdump_len += sizeof(struct am65_cpsw_regdump_hdr);\n\t\t\tregdump_len += ale_entries *\n\t\t\t\t       ALE_ENTRY_WORDS * sizeof(u32);\n\t\t\tcontinue;\n\t\t}\n\t\tregdump_len += am65_cpsw_regdump[i].hdr.len;\n\t}\n\n\treturn regdump_len;\n}\n\nstatic void am65_cpsw_get_regs(struct net_device *ndev,\n\t\t\t       struct ethtool_regs *regs, void *p)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\tu32 ale_entries, i, j, pos, *reg = p;\n\n\t \n\tregs->version = AM65_CPSW_REGDUMP_VER;\n\tale_entries = cpsw_ale_get_num_entries(common->ale);\n\n\tpos = 0;\n\tfor (i = 0; i < ARRAY_SIZE(am65_cpsw_regdump); i++) {\n\t\treg[pos++] = am65_cpsw_regdump[i].hdr.module_id;\n\n\t\tif (am65_cpsw_regdump[i].hdr.module_id ==\n\t\t    AM65_CPSW_REGDUMP_MOD_CPSW_ALE_TBL) {\n\t\t\tu32 ale_tbl_len = ale_entries *\n\t\t\t\t\t  ALE_ENTRY_WORDS * sizeof(u32) +\n\t\t\t\t\t  sizeof(struct am65_cpsw_regdump_hdr);\n\t\t\treg[pos++] = ale_tbl_len;\n\t\t\tcpsw_ale_dump(common->ale, &reg[pos]);\n\t\t\tpos += ale_tbl_len;\n\t\t\tcontinue;\n\t\t}\n\n\t\treg[pos++] = am65_cpsw_regdump[i].hdr.len;\n\n\t\tj = am65_cpsw_regdump[i].start_ofs;\n\t\tdo {\n\t\t\treg[pos++] = j;\n\t\t\treg[pos++] = readl_relaxed(common->ss_base + j);\n\t\t\tj += sizeof(u32);\n\t\t} while (j <= am65_cpsw_regdump[i].end_ofs);\n\t}\n}\n\nstatic int am65_cpsw_get_sset_count(struct net_device *ndev, int sset)\n{\n\tswitch (sset) {\n\tcase ETH_SS_STATS:\n\t\treturn ARRAY_SIZE(am65_host_stats) +\n\t\t       ARRAY_SIZE(am65_slave_stats);\n\tcase ETH_SS_PRIV_FLAGS:\n\t\treturn ARRAY_SIZE(am65_cpsw_ethtool_priv_flags);\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n\nstatic void am65_cpsw_get_strings(struct net_device *ndev,\n\t\t\t\t  u32 stringset, u8 *data)\n{\n\tconst struct am65_cpsw_ethtool_stat *hw_stats;\n\tu32 i, num_stats;\n\tu8 *p = data;\n\n\tswitch (stringset) {\n\tcase ETH_SS_STATS:\n\t\tnum_stats = ARRAY_SIZE(am65_host_stats);\n\t\thw_stats = am65_host_stats;\n\t\tfor (i = 0; i < num_stats; i++) {\n\t\t\tmemcpy(p, hw_stats[i].desc, ETH_GSTRING_LEN);\n\t\t\tp += ETH_GSTRING_LEN;\n\t\t}\n\n\t\tnum_stats = ARRAY_SIZE(am65_slave_stats);\n\t\thw_stats = am65_slave_stats;\n\t\tfor (i = 0; i < num_stats; i++) {\n\t\t\tmemcpy(p, hw_stats[i].desc, ETH_GSTRING_LEN);\n\t\t\tp += ETH_GSTRING_LEN;\n\t\t}\n\t\tbreak;\n\tcase ETH_SS_PRIV_FLAGS:\n\t\tnum_stats = ARRAY_SIZE(am65_cpsw_ethtool_priv_flags);\n\n\t\tfor (i = 0; i < num_stats; i++) {\n\t\t\tmemcpy(p, am65_cpsw_ethtool_priv_flags[i],\n\t\t\t       ETH_GSTRING_LEN);\n\t\t\tp += ETH_GSTRING_LEN;\n\t\t}\n\t\tbreak;\n\t}\n}\n\nstatic void am65_cpsw_get_ethtool_stats(struct net_device *ndev,\n\t\t\t\t\tstruct ethtool_stats *stats, u64 *data)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\tconst struct am65_cpsw_ethtool_stat *hw_stats;\n\tstruct am65_cpsw_host *host_p;\n\tstruct am65_cpsw_port *port;\n\tu32 i, num_stats;\n\n\thost_p = am65_common_get_host(common);\n\tport = am65_ndev_to_port(ndev);\n\tnum_stats = ARRAY_SIZE(am65_host_stats);\n\thw_stats = am65_host_stats;\n\tfor (i = 0; i < num_stats; i++)\n\t\t*data++ = readl_relaxed(host_p->stat_base +\n\t\t\t\t\thw_stats[i].offset);\n\n\tnum_stats = ARRAY_SIZE(am65_slave_stats);\n\thw_stats = am65_slave_stats;\n\tfor (i = 0; i < num_stats; i++)\n\t\t*data++ = readl_relaxed(port->stat_base +\n\t\t\t\t\thw_stats[i].offset);\n}\n\nstatic int am65_cpsw_get_ethtool_ts_info(struct net_device *ndev,\n\t\t\t\t\t struct ethtool_ts_info *info)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\n\tif (!IS_ENABLED(CONFIG_TI_K3_AM65_CPTS))\n\t\treturn ethtool_op_get_ts_info(ndev, info);\n\n\tinfo->so_timestamping =\n\t\tSOF_TIMESTAMPING_TX_HARDWARE |\n\t\tSOF_TIMESTAMPING_TX_SOFTWARE |\n\t\tSOF_TIMESTAMPING_RX_HARDWARE |\n\t\tSOF_TIMESTAMPING_RX_SOFTWARE |\n\t\tSOF_TIMESTAMPING_SOFTWARE |\n\t\tSOF_TIMESTAMPING_RAW_HARDWARE;\n\tinfo->phc_index = am65_cpts_phc_index(common->cpts);\n\tinfo->tx_types = BIT(HWTSTAMP_TX_OFF) | BIT(HWTSTAMP_TX_ON);\n\tinfo->rx_filters = BIT(HWTSTAMP_FILTER_NONE) | BIT(HWTSTAMP_FILTER_ALL);\n\treturn 0;\n}\n\nstatic u32 am65_cpsw_get_ethtool_priv_flags(struct net_device *ndev)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\tu32 priv_flags = 0;\n\n\tif (common->pf_p0_rx_ptype_rrobin)\n\t\tpriv_flags |= AM65_CPSW_PRIV_P0_RX_PTYPE_RROBIN;\n\n\treturn priv_flags;\n}\n\nstatic int am65_cpsw_set_ethtool_priv_flags(struct net_device *ndev, u32 flags)\n{\n\tstruct am65_cpsw_common *common = am65_ndev_to_common(ndev);\n\tint rrobin;\n\n\trrobin = !!(flags & AM65_CPSW_PRIV_P0_RX_PTYPE_RROBIN);\n\n\tif (common->usage_count)\n\t\treturn -EBUSY;\n\n\tif (common->est_enabled && rrobin) {\n\t\tnetdev_err(ndev,\n\t\t\t   \"p0-rx-ptype-rrobin flag conflicts with QOS\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tcommon->pf_p0_rx_ptype_rrobin = rrobin;\n\n\treturn 0;\n}\n\nconst struct ethtool_ops am65_cpsw_ethtool_ops_slave = {\n\t.begin\t\t\t= am65_cpsw_ethtool_op_begin,\n\t.complete\t\t= am65_cpsw_ethtool_op_complete,\n\t.get_drvinfo\t\t= am65_cpsw_get_drvinfo,\n\t.get_msglevel\t\t= am65_cpsw_get_msglevel,\n\t.set_msglevel\t\t= am65_cpsw_set_msglevel,\n\t.get_channels\t\t= am65_cpsw_get_channels,\n\t.set_channels\t\t= am65_cpsw_set_channels,\n\t.get_ringparam\t\t= am65_cpsw_get_ringparam,\n\t.get_regs_len\t\t= am65_cpsw_get_regs_len,\n\t.get_regs\t\t= am65_cpsw_get_regs,\n\t.get_sset_count\t\t= am65_cpsw_get_sset_count,\n\t.get_strings\t\t= am65_cpsw_get_strings,\n\t.get_ethtool_stats\t= am65_cpsw_get_ethtool_stats,\n\t.get_ts_info\t\t= am65_cpsw_get_ethtool_ts_info,\n\t.get_priv_flags\t\t= am65_cpsw_get_ethtool_priv_flags,\n\t.set_priv_flags\t\t= am65_cpsw_set_ethtool_priv_flags,\n\n\t.get_link\t\t= ethtool_op_get_link,\n\t.get_link_ksettings\t= am65_cpsw_get_link_ksettings,\n\t.set_link_ksettings\t= am65_cpsw_set_link_ksettings,\n\t.get_pauseparam\t\t= am65_cpsw_get_pauseparam,\n\t.set_pauseparam\t\t= am65_cpsw_set_pauseparam,\n\t.get_wol\t\t= am65_cpsw_get_wol,\n\t.set_wol\t\t= am65_cpsw_set_wol,\n\t.get_eee\t\t= am65_cpsw_get_eee,\n\t.set_eee\t\t= am65_cpsw_set_eee,\n\t.nway_reset\t\t= am65_cpsw_nway_reset,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}