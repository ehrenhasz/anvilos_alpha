{
  "module_name": "am65-cpsw-nuss.h",
  "hash_id": "c22d3befb7e73f3e7d7e4b1e14dfefa970e23727068e3372132d799e5cdf3f1f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ti/am65-cpsw-nuss.h",
  "human_readable_source": " \n \n\n#ifndef AM65_CPSW_NUSS_H_\n#define AM65_CPSW_NUSS_H_\n\n#include <linux/if_ether.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/netdevice.h>\n#include <linux/phylink.h>\n#include <linux/platform_device.h>\n#include <linux/soc/ti/k3-ringacc.h>\n#include <net/devlink.h>\n#include \"am65-cpsw-qos.h\"\n\nstruct am65_cpts;\n\n#define HOST_PORT_NUM\t\t0\n\n#define AM65_CPSW_MAX_TX_QUEUES\t8\n#define AM65_CPSW_MAX_RX_QUEUES\t1\n#define AM65_CPSW_MAX_RX_FLOWS\t1\n\n#define AM65_CPSW_PORT_VLAN_REG_OFFSET\t0x014\n\nstruct am65_cpsw_slave_data {\n\tbool\t\t\t\tmac_only;\n\tstruct cpsw_sl\t\t\t*mac_sl;\n\tstruct device_node\t\t*phy_node;\n\tphy_interface_t\t\t\tphy_if;\n\tstruct phy\t\t\t*ifphy;\n\tstruct phy\t\t\t*serdes_phy;\n\tbool\t\t\t\trx_pause;\n\tbool\t\t\t\ttx_pause;\n\tu8\t\t\t\tmac_addr[ETH_ALEN];\n\tint\t\t\t\tport_vlan;\n\tstruct phylink\t\t\t*phylink;\n\tstruct phylink_config\t\tphylink_config;\n};\n\nstruct am65_cpsw_port {\n\tstruct am65_cpsw_common\t\t*common;\n\tstruct net_device\t\t*ndev;\n\tconst char\t\t\t*name;\n\tu32\t\t\t\tport_id;\n\tvoid __iomem\t\t\t*port_base;\n\tvoid __iomem\t\t\t*sgmii_base;\n\tvoid __iomem\t\t\t*stat_base;\n\tvoid __iomem\t\t\t*fetch_ram_base;\n\tbool\t\t\t\tdisabled;\n\tstruct am65_cpsw_slave_data\tslave;\n\tbool\t\t\t\ttx_ts_enabled;\n\tbool\t\t\t\trx_ts_enabled;\n\tstruct am65_cpsw_qos\t\tqos;\n\tstruct devlink_port\t\tdevlink_port;\n\t \n\tu32\t\t\t\tvid_context;\n};\n\nstruct am65_cpsw_host {\n\tstruct am65_cpsw_common\t\t*common;\n\tvoid __iomem\t\t\t*port_base;\n\tvoid __iomem\t\t\t*stat_base;\n\t \n\tu32\t\t\t\tvid_context;\n};\n\nstruct am65_cpsw_tx_chn {\n\tstruct device *dma_dev;\n\tstruct napi_struct napi_tx;\n\tstruct am65_cpsw_common\t*common;\n\tstruct k3_cppi_desc_pool *desc_pool;\n\tstruct k3_udma_glue_tx_channel *tx_chn;\n\tspinlock_t lock;  \n\tint irq;\n\tu32 id;\n\tu32 descs_num;\n\tchar tx_chn_name[128];\n\tu32 rate_mbps;\n};\n\nstruct am65_cpsw_rx_chn {\n\tstruct device *dev;\n\tstruct device *dma_dev;\n\tstruct k3_cppi_desc_pool *desc_pool;\n\tstruct k3_udma_glue_rx_channel *rx_chn;\n\tu32 descs_num;\n\tint irq;\n};\n\n#define AM65_CPSW_QUIRK_I2027_NO_TX_CSUM BIT(0)\n#define AM64_CPSW_QUIRK_DMA_RX_TDOWN_IRQ BIT(1)\n\nstruct am65_cpsw_pdata {\n\tu32\tquirks;\n\tu64\textra_modes;\n\tenum k3_ring_mode fdqring_mode;\n\tconst char\t*ale_dev_id;\n};\n\nenum cpsw_devlink_param_id {\n\tAM65_CPSW_DEVLINK_PARAM_ID_BASE = DEVLINK_PARAM_GENERIC_ID_MAX,\n\tAM65_CPSW_DL_PARAM_SWITCH_MODE,\n};\n\nstruct am65_cpsw_devlink {\n\tstruct am65_cpsw_common *common;\n};\n\nstruct am65_cpsw_common {\n\tstruct device\t\t*dev;\n\tstruct device\t\t*mdio_dev;\n\tstruct am65_cpsw_pdata\tpdata;\n\n\tvoid __iomem\t\t*ss_base;\n\tvoid __iomem\t\t*cpsw_base;\n\n\tu32\t\t\tport_num;\n\tstruct am65_cpsw_host   host;\n\tstruct am65_cpsw_port\t*ports;\n\tu32\t\t\tdisabled_ports_mask;\n\tstruct net_device\t*dma_ndev;\n\n\tint\t\t\tusage_count;  \n\tstruct cpsw_ale\t\t*ale;\n\tint\t\t\ttx_ch_num;\n\tu32\t\t\ttx_ch_rate_msk;\n\tu32\t\t\trx_flow_id_base;\n\n\tstruct am65_cpsw_tx_chn\ttx_chns[AM65_CPSW_MAX_TX_QUEUES];\n\tstruct completion\ttdown_complete;\n\tatomic_t\t\ttdown_cnt;\n\n\tstruct am65_cpsw_rx_chn\trx_chns;\n\tstruct napi_struct\tnapi_rx;\n\n\tbool\t\t\trx_irq_disabled;\n\n\tu32\t\t\tnuss_ver;\n\tu32\t\t\tcpsw_ver;\n\tunsigned long\t\tbus_freq;\n\tbool\t\t\tpf_p0_rx_ptype_rrobin;\n\tstruct am65_cpts\t*cpts;\n\tint\t\t\test_enabled;\n\n\tbool\t\tis_emac_mode;\n\tu16\t\t\tbr_members;\n\tint\t\t\tdefault_vlan;\n\tstruct devlink *devlink;\n\tstruct net_device *hw_bridge_dev;\n\tstruct notifier_block am65_cpsw_netdevice_nb;\n\tunsigned char switch_id[MAX_PHYS_ITEM_ID_LEN];\n\t \n\tu32\t\t\t*ale_context;\n};\n\nstruct am65_cpsw_ndev_stats {\n\tu64 tx_packets;\n\tu64 tx_bytes;\n\tu64 rx_packets;\n\tu64 rx_bytes;\n\tstruct u64_stats_sync syncp;\n};\n\nstruct am65_cpsw_ndev_priv {\n\tu32\t\t\tmsg_enable;\n\tstruct am65_cpsw_port\t*port;\n\tstruct am65_cpsw_ndev_stats __percpu *stats;\n\tbool offload_fwd_mark;\n};\n\n#define am65_ndev_to_priv(ndev) \\\n\t((struct am65_cpsw_ndev_priv *)netdev_priv(ndev))\n#define am65_ndev_to_port(ndev) (am65_ndev_to_priv(ndev)->port)\n#define am65_ndev_to_common(ndev) (am65_ndev_to_port(ndev)->common)\n#define am65_ndev_to_slave(ndev) (&am65_ndev_to_port(ndev)->slave)\n\n#define am65_common_get_host(common) (&(common)->host)\n#define am65_common_get_port(common, id) (&(common)->ports[(id) - 1])\n\n#define am65_cpsw_napi_to_common(pnapi) \\\n\tcontainer_of(pnapi, struct am65_cpsw_common, napi_rx)\n#define am65_cpsw_napi_to_tx_chn(pnapi) \\\n\tcontainer_of(pnapi, struct am65_cpsw_tx_chn, napi_tx)\n\n#define AM65_CPSW_DRV_NAME \"am65-cpsw-nuss\"\n\n#define AM65_CPSW_IS_CPSW2G(common) ((common)->port_num == 1)\n\nextern const struct ethtool_ops am65_cpsw_ethtool_ops_slave;\n\nvoid am65_cpsw_nuss_set_p0_ptype(struct am65_cpsw_common *common);\nvoid am65_cpsw_nuss_remove_tx_chns(struct am65_cpsw_common *common);\nint am65_cpsw_nuss_update_tx_chns(struct am65_cpsw_common *common, int num_tx);\n\nbool am65_cpsw_port_dev_check(const struct net_device *dev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}