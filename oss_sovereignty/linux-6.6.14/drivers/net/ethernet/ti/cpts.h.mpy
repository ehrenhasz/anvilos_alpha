{
  "module_name": "cpts.h",
  "hash_id": "b0677888dbf9ca498a02d0b501ff204d2d38ad20a032d8069539c117c51f5dac",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ti/cpts.h",
  "human_readable_source": " \n \n#ifndef _TI_CPTS_H_\n#define _TI_CPTS_H_\n\n#if IS_ENABLED(CONFIG_TI_CPTS)\n\n#include <linux/clk.h>\n#include <linux/clkdev.h>\n#include <linux/clocksource.h>\n#include <linux/device.h>\n#include <linux/list.h>\n#include <linux/of.h>\n#include <linux/ptp_clock_kernel.h>\n#include <linux/skbuff.h>\n#include <linux/ptp_classify.h>\n#include <linux/timecounter.h>\n\nstruct cpsw_cpts {\n\tu32 idver;                 \n\tu32 control;               \n\tu32 rftclk_sel;\t\t   \n\tu32 ts_push;               \n\tu32 ts_load_val;           \n\tu32 ts_load_en;            \n\tu32 res2[2];\n\tu32 intstat_raw;           \n\tu32 intstat_masked;        \n\tu32 int_enable;            \n\tu32 res3;\n\tu32 event_pop;             \n\tu32 event_low;             \n\tu32 event_high;            \n};\n\n \n#define TX_IDENT_SHIFT       (16)     \n#define TX_IDENT_MASK        (0xffff)\n#define RTL_VER_SHIFT        (11)     \n#define RTL_VER_MASK         (0x1f)\n#define MAJOR_VER_SHIFT      (8)      \n#define MAJOR_VER_MASK       (0x7)\n#define MINOR_VER_SHIFT      (0)      \n#define MINOR_VER_MASK       (0xff)\n\n \n#define HW4_TS_PUSH_EN       (1<<11)  \n#define HW3_TS_PUSH_EN       (1<<10)  \n#define HW2_TS_PUSH_EN       (1<<9)   \n#define HW1_TS_PUSH_EN       (1<<8)   \n#define INT_TEST             (1<<1)   \n#define CPTS_EN              (1<<0)   \n\n \n#define TS_PUSH             (1<<0)   \n#define TS_LOAD_EN          (1<<0)   \n#define TS_PEND_RAW         (1<<0)   \n#define TS_PEND             (1<<0)   \n#define TS_PEND_EN          (1<<0)   \n#define EVENT_POP           (1<<0)   \n\n \n#define PORT_NUMBER_SHIFT    (24)     \n#define PORT_NUMBER_MASK     (0x1f)\n#define EVENT_TYPE_SHIFT     (20)     \n#define EVENT_TYPE_MASK      (0xf)\n#define MESSAGE_TYPE_SHIFT   (16)     \n#define MESSAGE_TYPE_MASK    (0xf)\n#define SEQUENCE_ID_SHIFT    (0)      \n#define SEQUENCE_ID_MASK     (0xffff)\n\nenum {\n\tCPTS_EV_PUSH,  \n\tCPTS_EV_ROLL,  \n\tCPTS_EV_HALF,  \n\tCPTS_EV_HW,    \n\tCPTS_EV_RX,    \n\tCPTS_EV_TX,    \n};\n\n#define CPTS_FIFO_DEPTH 16\n#define CPTS_MAX_EVENTS 32\n\nstruct cpts_event {\n\tstruct list_head list;\n\tunsigned long tmo;\n\tu32 high;\n\tu32 low;\n\tu64 timestamp;\n};\n\nstruct cpts {\n\tstruct device *dev;\n\tstruct cpsw_cpts __iomem *reg;\n\tint tx_enable;\n\tint rx_enable;\n\tstruct ptp_clock_info info;\n\tstruct ptp_clock *clock;\n\tspinlock_t lock;  \n\tu32 cc_mult;  \n\tstruct cyclecounter cc;\n\tstruct timecounter tc;\n\tint phc_index;\n\tstruct clk *refclk;\n\tstruct list_head events;\n\tstruct list_head pool;\n\tstruct cpts_event pool_data[CPTS_MAX_EVENTS];\n\tunsigned long ov_check_period;\n\tstruct sk_buff_head txq;\n\tu64 cur_timestamp;\n\tu32 mult_new;\n\tstruct mutex ptp_clk_mutex;  \n\tbool irq_poll;\n\tstruct completion\tts_push_complete;\n\tu32 hw_ts_enable;\n};\n\nvoid cpts_rx_timestamp(struct cpts *cpts, struct sk_buff *skb);\nvoid cpts_tx_timestamp(struct cpts *cpts, struct sk_buff *skb);\nint cpts_register(struct cpts *cpts);\nvoid cpts_unregister(struct cpts *cpts);\nstruct cpts *cpts_create(struct device *dev, void __iomem *regs,\n\t\t\t struct device_node *node, u32 n_ext_ts);\nvoid cpts_release(struct cpts *cpts);\nvoid cpts_misc_interrupt(struct cpts *cpts);\n\nstatic inline bool cpts_can_timestamp(struct cpts *cpts, struct sk_buff *skb)\n{\n\tunsigned int class = ptp_classify_raw(skb);\n\n\tif (class == PTP_CLASS_NONE)\n\t\treturn false;\n\n\treturn true;\n}\n\nstatic inline void cpts_set_irqpoll(struct cpts *cpts, bool en)\n{\n\tcpts->irq_poll = en;\n}\n\n#else\nstruct cpts;\n\nstatic inline void cpts_rx_timestamp(struct cpts *cpts, struct sk_buff *skb)\n{\n}\nstatic inline void cpts_tx_timestamp(struct cpts *cpts, struct sk_buff *skb)\n{\n}\n\nstatic inline\nstruct cpts *cpts_create(struct device *dev, void __iomem *regs,\n\t\t\t struct device_node *node, u32 n_ext_ts)\n{\n\treturn NULL;\n}\n\nstatic inline void cpts_release(struct cpts *cpts)\n{\n}\n\nstatic inline int\ncpts_register(struct cpts *cpts)\n{\n\treturn 0;\n}\n\nstatic inline void cpts_unregister(struct cpts *cpts)\n{\n}\n\nstatic inline bool cpts_can_timestamp(struct cpts *cpts, struct sk_buff *skb)\n{\n\treturn false;\n}\n\nstatic inline void cpts_misc_interrupt(struct cpts *cpts)\n{\n}\n\nstatic inline void cpts_set_irqpoll(struct cpts *cpts, bool en)\n{\n}\n#endif\n\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}