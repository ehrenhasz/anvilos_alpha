{
  "module_name": "via-velocity.h",
  "hash_id": "b5ad1730adf0a4e55a50cbc76a579b7a56cb66d568af4d579b75cabe68db771f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/via/via-velocity.h",
  "human_readable_source": " \n \n\n\n#ifndef VELOCITY_H\n#define VELOCITY_H\n\n#define VELOCITY_TX_CSUM_SUPPORT\n\n#define VELOCITY_NAME          \"via-velocity\"\n#define VELOCITY_FULL_DRV_NAM  \"VIA Networking Velocity Family Gigabit Ethernet Adapter Driver\"\n#define VELOCITY_VERSION       \"1.15\"\n\n#define VELOCITY_IO_SIZE\t256\n\n#define PKT_BUF_SZ          1540\n\n#define MAX_UNITS           8\n#define OPTION_DEFAULT      { [0 ... MAX_UNITS-1] = -1}\n\n#define REV_ID_VT6110       (0)\n\n#define BYTE_REG_BITS_ON(x,p)       do { writeb(readb((p))|(x),(p));} while (0)\n#define WORD_REG_BITS_ON(x,p)       do { writew(readw((p))|(x),(p));} while (0)\n#define DWORD_REG_BITS_ON(x,p)      do { writel(readl((p))|(x),(p));} while (0)\n\n#define BYTE_REG_BITS_IS_ON(x,p)    (readb((p)) & (x))\n#define WORD_REG_BITS_IS_ON(x,p)    (readw((p)) & (x))\n#define DWORD_REG_BITS_IS_ON(x,p)   (readl((p)) & (x))\n\n#define BYTE_REG_BITS_OFF(x,p)      do { writeb(readb((p)) & (~(x)),(p));} while (0)\n#define WORD_REG_BITS_OFF(x,p)      do { writew(readw((p)) & (~(x)),(p));} while (0)\n#define DWORD_REG_BITS_OFF(x,p)     do { writel(readl((p)) & (~(x)),(p));} while (0)\n\n#define BYTE_REG_BITS_SET(x,m,p)    do { writeb( (readb((p)) & (~(m))) |(x),(p));} while (0)\n#define WORD_REG_BITS_SET(x,m,p)    do { writew( (readw((p)) & (~(m))) |(x),(p));} while (0)\n#define DWORD_REG_BITS_SET(x,m,p)   do { writel( (readl((p)) & (~(m)))|(x),(p));}  while (0)\n\n#define VAR_USED(p)     do {(p)=(p);} while (0)\n\n \n\n\n#define B_OWNED_BY_CHIP     1\n#define B_OWNED_BY_HOST     0\n\n \n\n#define RSR_DETAG\tcpu_to_le16(0x0080)\n#define RSR_SNTAG\tcpu_to_le16(0x0040)\n#define RSR_RXER\tcpu_to_le16(0x0020)\n#define RSR_RL\t\tcpu_to_le16(0x0010)\n#define RSR_CE\t\tcpu_to_le16(0x0008)\n#define RSR_FAE\t\tcpu_to_le16(0x0004)\n#define RSR_CRC\t\tcpu_to_le16(0x0002)\n#define RSR_VIDM\tcpu_to_le16(0x0001)\n\n \n\n#define RSR_RXOK\tcpu_to_le16(0x8000) \n#define RSR_PFT\t\tcpu_to_le16(0x4000) \n#define RSR_MAR\t\tcpu_to_le16(0x2000) \n#define RSR_BAR\t\tcpu_to_le16(0x1000) \n#define RSR_PHY\t\tcpu_to_le16(0x0800) \n#define RSR_VTAG\tcpu_to_le16(0x0400) \n#define RSR_STP\t\tcpu_to_le16(0x0200) \n#define RSR_EDP\t\tcpu_to_le16(0x0100) \n\n \n\n#define CSM_IPOK            0x40\t\n#define CSM_TUPOK           0x20\t\n#define CSM_FRAG            0x10\t\n#define CSM_IPKT            0x04\t\n#define CSM_TCPKT           0x02\t\n#define CSM_UDPKT           0x01\t\n\n \n\n#define TSR0_ABT\tcpu_to_le16(0x0080) \n#define TSR0_OWT\tcpu_to_le16(0x0040) \n#define TSR0_OWC\tcpu_to_le16(0x0020) \n#define TSR0_COLS\tcpu_to_le16(0x0010) \n#define TSR0_NCR3\tcpu_to_le16(0x0008) \n#define TSR0_NCR2\tcpu_to_le16(0x0004) \n#define TSR0_NCR1\tcpu_to_le16(0x0002) \n#define TSR0_NCR0\tcpu_to_le16(0x0001) \n#define TSR0_TERR\tcpu_to_le16(0x8000) \n#define TSR0_FDX\tcpu_to_le16(0x4000) \n#define TSR0_GMII\tcpu_to_le16(0x2000) \n#define TSR0_LNKFL\tcpu_to_le16(0x1000) \n#define TSR0_SHDN\tcpu_to_le16(0x0400) \n#define TSR0_CRS\tcpu_to_le16(0x0200) \n#define TSR0_CDH\tcpu_to_le16(0x0100) \n\n\n\n\n#define TCR0_TIC            0x80\t\n#define TCR0_PIC            0x40\t\n#define TCR0_VETAG          0x20\t\n#define TCR0_IPCK           0x10\t\n#define TCR0_UDPCK          0x08\t\n#define TCR0_TCPCK          0x04\t\n#define TCR0_JMBO           0x02\t\n#define TCR0_CRC            0x01\t\n\n#define TCPLS_NORMAL        3\n#define TCPLS_START         2\n#define TCPLS_END           1\n#define TCPLS_MED           0\n\n\n\n#define CB_RX_BUF_SIZE     2048UL\t\n\t\t\t\t\t\n\n#define CB_MAX_RD_NUM       512\t\n#define CB_MAX_TD_NUM       256\t\n\n#define CB_INIT_RD_NUM_3119 128\t\n#define CB_INIT_TD_NUM_3119 64\t\n\n#define CB_INIT_RD_NUM      128\t\n#define CB_INIT_TD_NUM      64\t\n\n\n#define CB_TD_RING_NUM      4\t\n#define CB_MAX_SEG_PER_PKT  7\t\n\n\n \n\n#define CB_MAX_TX_ABORT_RETRY   3\n\n \n\nstruct rdesc0 {\n\t__le16 RSR;\t\t \n\t__le16 len;\t\t \n};\n\nstruct rdesc1 {\n\t__le16 PQTAG;\n\tu8 CSM;\n\tu8 IPKT;\n};\n\nenum {\n\tRX_INTEN = cpu_to_le16(0x8000)\n};\n\nstruct rx_desc {\n\tstruct rdesc0 rdesc0;\n\tstruct rdesc1 rdesc1;\n\t__le32 pa_low;\t\t \n\t__le16 pa_high;\t\t \n\t__le16 size;\t\t \n} __packed;\n\n \n\nstruct tdesc0 {\n\t__le16 TSR;\t\t \n\t__le16 len;\t\t \n};\n\nstruct tdesc1 {\n\t__le16 vlan;\n\tu8 TCR;\n\tu8 cmd;\t\t\t \n} __packed;\n\nenum {\n\tTD_QUEUE = cpu_to_le16(0x8000)\n};\n\nstruct td_buf {\n\t__le32 pa_low;\n\t__le16 pa_high;\n\t__le16 size;\t\t \n} __packed;\n\nstruct tx_desc {\n\tstruct tdesc0 tdesc0;\n\tstruct tdesc1 tdesc1;\n\tstruct td_buf td_buf[7];\n};\n\nstruct velocity_rd_info {\n\tstruct sk_buff *skb;\n\tdma_addr_t skb_dma;\n};\n\n \n\nstruct velocity_td_info {\n\tstruct sk_buff *skb;\n\tint nskb_dma;\n\tdma_addr_t skb_dma[7];\n};\n\nenum  velocity_owner {\n\tOWNED_BY_HOST = 0,\n\tOWNED_BY_NIC = cpu_to_le16(0x8000)\n};\n\n\n \n\n\n#define MCAM_SIZE           64\n#define VCAM_SIZE           64\n#define TX_QUEUE_NO         4\n\n#define MAX_HW_MIB_COUNTER  32\n#define VELOCITY_MIN_MTU    (64)\n#define VELOCITY_MAX_MTU    (9000)\n\n \n\n#define MAC_REG_PAR         0x00\t\n#define MAC_REG_RCR         0x06\n#define MAC_REG_TCR         0x07\n#define MAC_REG_CR0_SET     0x08\n#define MAC_REG_CR1_SET     0x09\n#define MAC_REG_CR2_SET     0x0A\n#define MAC_REG_CR3_SET     0x0B\n#define MAC_REG_CR0_CLR     0x0C\n#define MAC_REG_CR1_CLR     0x0D\n#define MAC_REG_CR2_CLR     0x0E\n#define MAC_REG_CR3_CLR     0x0F\n#define MAC_REG_MAR         0x10\n#define MAC_REG_CAM         0x10\n#define MAC_REG_DEC_BASE_HI 0x18\n#define MAC_REG_DBF_BASE_HI 0x1C\n#define MAC_REG_ISR_CTL     0x20\n#define MAC_REG_ISR_HOTMR   0x20\n#define MAC_REG_ISR_TSUPTHR 0x20\n#define MAC_REG_ISR_RSUPTHR 0x20\n#define MAC_REG_ISR_CTL1    0x21\n#define MAC_REG_TXE_SR      0x22\n#define MAC_REG_RXE_SR      0x23\n#define MAC_REG_ISR         0x24\n#define MAC_REG_ISR0        0x24\n#define MAC_REG_ISR1        0x25\n#define MAC_REG_ISR2        0x26\n#define MAC_REG_ISR3        0x27\n#define MAC_REG_IMR         0x28\n#define MAC_REG_IMR0        0x28\n#define MAC_REG_IMR1        0x29\n#define MAC_REG_IMR2        0x2A\n#define MAC_REG_IMR3        0x2B\n#define MAC_REG_TDCSR_SET   0x30\n#define MAC_REG_RDCSR_SET   0x32\n#define MAC_REG_TDCSR_CLR   0x34\n#define MAC_REG_RDCSR_CLR   0x36\n#define MAC_REG_RDBASE_LO   0x38\n#define MAC_REG_RDINDX      0x3C\n#define MAC_REG_TDBASE_LO   0x40\n#define MAC_REG_RDCSIZE     0x50\n#define MAC_REG_TDCSIZE     0x52\n#define MAC_REG_TDINDX      0x54\n#define MAC_REG_TDIDX0      0x54\n#define MAC_REG_TDIDX1      0x56\n#define MAC_REG_TDIDX2      0x58\n#define MAC_REG_TDIDX3      0x5A\n#define MAC_REG_PAUSE_TIMER 0x5C\n#define MAC_REG_RBRDU       0x5E\n#define MAC_REG_FIFO_TEST0  0x60\n#define MAC_REG_FIFO_TEST1  0x64\n#define MAC_REG_CAMADDR     0x68\n#define MAC_REG_CAMCR       0x69\n#define MAC_REG_GFTEST      0x6A\n#define MAC_REG_FTSTCMD     0x6B\n#define MAC_REG_MIICFG      0x6C\n#define MAC_REG_MIISR       0x6D\n#define MAC_REG_PHYSR0      0x6E\n#define MAC_REG_PHYSR1      0x6F\n#define MAC_REG_MIICR       0x70\n#define MAC_REG_MIIADR      0x71\n#define MAC_REG_MIIDATA     0x72\n#define MAC_REG_SOFT_TIMER0 0x74\n#define MAC_REG_SOFT_TIMER1 0x76\n#define MAC_REG_CFGA        0x78\n#define MAC_REG_CFGB        0x79\n#define MAC_REG_CFGC        0x7A\n#define MAC_REG_CFGD        0x7B\n#define MAC_REG_DCFG0       0x7C\n#define MAC_REG_DCFG1       0x7D\n#define MAC_REG_MCFG0       0x7E\n#define MAC_REG_MCFG1       0x7F\n\n#define MAC_REG_TBIST       0x80\n#define MAC_REG_RBIST       0x81\n#define MAC_REG_PMCC        0x82\n#define MAC_REG_STICKHW     0x83\n#define MAC_REG_MIBCR       0x84\n#define MAC_REG_EERSV       0x85\n#define MAC_REG_REVID       0x86\n#define MAC_REG_MIBREAD     0x88\n#define MAC_REG_BPMA        0x8C\n#define MAC_REG_EEWR_DATA   0x8C\n#define MAC_REG_BPMD_WR     0x8F\n#define MAC_REG_BPCMD       0x90\n#define MAC_REG_BPMD_RD     0x91\n#define MAC_REG_EECHKSUM    0x92\n#define MAC_REG_EECSR       0x93\n#define MAC_REG_EERD_DATA   0x94\n#define MAC_REG_EADDR       0x96\n#define MAC_REG_EMBCMD      0x97\n#define MAC_REG_JMPSR0      0x98\n#define MAC_REG_JMPSR1      0x99\n#define MAC_REG_JMPSR2      0x9A\n#define MAC_REG_JMPSR3      0x9B\n#define MAC_REG_CHIPGSR     0x9C\n#define MAC_REG_TESTCFG     0x9D\n#define MAC_REG_DEBUG       0x9E\n#define MAC_REG_CHIPGCR     0x9F\t \n#define MAC_REG_WOLCR0_SET  0xA0\n#define MAC_REG_WOLCR1_SET  0xA1\n#define MAC_REG_PWCFG_SET   0xA2\n#define MAC_REG_WOLCFG_SET  0xA3\n#define MAC_REG_WOLCR0_CLR  0xA4\n#define MAC_REG_WOLCR1_CLR  0xA5\n#define MAC_REG_PWCFG_CLR   0xA6\n#define MAC_REG_WOLCFG_CLR  0xA7\n#define MAC_REG_WOLSR0_SET  0xA8\n#define MAC_REG_WOLSR1_SET  0xA9\n#define MAC_REG_WOLSR0_CLR  0xAC\n#define MAC_REG_WOLSR1_CLR  0xAD\n#define MAC_REG_PATRN_CRC0  0xB0\n#define MAC_REG_PATRN_CRC1  0xB2\n#define MAC_REG_PATRN_CRC2  0xB4\n#define MAC_REG_PATRN_CRC3  0xB6\n#define MAC_REG_PATRN_CRC4  0xB8\n#define MAC_REG_PATRN_CRC5  0xBA\n#define MAC_REG_PATRN_CRC6  0xBC\n#define MAC_REG_PATRN_CRC7  0xBE\n#define MAC_REG_BYTEMSK0_0  0xC0\n#define MAC_REG_BYTEMSK0_1  0xC4\n#define MAC_REG_BYTEMSK0_2  0xC8\n#define MAC_REG_BYTEMSK0_3  0xCC\n#define MAC_REG_BYTEMSK1_0  0xD0\n#define MAC_REG_BYTEMSK1_1  0xD4\n#define MAC_REG_BYTEMSK1_2  0xD8\n#define MAC_REG_BYTEMSK1_3  0xDC\n#define MAC_REG_BYTEMSK2_0  0xE0\n#define MAC_REG_BYTEMSK2_1  0xE4\n#define MAC_REG_BYTEMSK2_2  0xE8\n#define MAC_REG_BYTEMSK2_3  0xEC\n#define MAC_REG_BYTEMSK3_0  0xF0\n#define MAC_REG_BYTEMSK3_1  0xF4\n#define MAC_REG_BYTEMSK3_2  0xF8\n#define MAC_REG_BYTEMSK3_3  0xFC\n\n \n\n#define RCR_AS              0x80\n#define RCR_AP              0x40\n#define RCR_AL              0x20\n#define RCR_PROM            0x10\n#define RCR_AB              0x08\n#define RCR_AM              0x04\n#define RCR_AR              0x02\n#define RCR_SEP             0x01\n\n \n\n#define TCR_TB2BDIS         0x80\n#define TCR_COLTMC1         0x08\n#define TCR_COLTMC0         0x04\n#define TCR_LB1             0x02\t \n#define TCR_LB0             0x01\t \n\n \n\n#define CR0_TXON            0x00000008UL\n#define CR0_RXON            0x00000004UL\n#define CR0_STOP            0x00000002UL\t \n#define CR0_STRT            0x00000001UL\t \n#define CR0_SFRST           0x00008000UL\t \n#define CR0_TM1EN           0x00004000UL\n#define CR0_TM0EN           0x00002000UL\n#define CR0_DPOLL           0x00000800UL\t \n#define CR0_DISAU           0x00000100UL\n#define CR0_XONEN           0x00800000UL\n#define CR0_FDXTFCEN        0x00400000UL\t \n#define CR0_FDXRFCEN        0x00200000UL\t \n#define CR0_HDXFCEN         0x00100000UL\t \n#define CR0_XHITH1          0x00080000UL\t \n#define CR0_XHITH0          0x00040000UL\t \n#define CR0_XLTH1           0x00020000UL\t \n#define CR0_XLTH0           0x00010000UL\t \n#define CR0_GSPRST          0x80000000UL\n#define CR0_FORSRST         0x40000000UL\n#define CR0_FPHYRST         0x20000000UL\n#define CR0_DIAG            0x10000000UL\n#define CR0_INTPCTL         0x04000000UL\n#define CR0_GINTMSK1        0x02000000UL\n#define CR0_GINTMSK0        0x01000000UL\n\n \n\n#define CR1_SFRST           0x80\t \n#define CR1_TM1EN           0x40\n#define CR1_TM0EN           0x20\n#define CR1_DPOLL           0x08\t \n#define CR1_DISAU           0x01\n\n \n\n#define CR2_XONEN           0x80\n#define CR2_FDXTFCEN        0x40\t \n#define CR2_FDXRFCEN        0x20\t \n#define CR2_HDXFCEN         0x10\t \n#define CR2_XHITH1          0x08\t \n#define CR2_XHITH0          0x04\t \n#define CR2_XLTH1           0x02\t \n#define CR2_XLTH0           0x01\t \n\n \n\n#define CR3_GSPRST          0x80\n#define CR3_FORSRST         0x40\n#define CR3_FPHYRST         0x20\n#define CR3_DIAG            0x10\n#define CR3_INTPCTL         0x04\n#define CR3_GINTMSK1        0x02\n#define CR3_GINTMSK0        0x01\n\n#define ISRCTL_UDPINT       0x8000\n#define ISRCTL_TSUPDIS      0x4000\n#define ISRCTL_RSUPDIS      0x2000\n#define ISRCTL_PMSK1        0x1000\n#define ISRCTL_PMSK0        0x0800\n#define ISRCTL_INTPD        0x0400\n#define ISRCTL_HCRLD        0x0200\n#define ISRCTL_SCRLD        0x0100\n\n \n\n#define ISRCTL1_UDPINT      0x80\n#define ISRCTL1_TSUPDIS     0x40\n#define ISRCTL1_RSUPDIS     0x20\n#define ISRCTL1_PMSK1       0x10\n#define ISRCTL1_PMSK0       0x08\n#define ISRCTL1_INTPD       0x04\n#define ISRCTL1_HCRLD       0x02\n#define ISRCTL1_SCRLD       0x01\n\n \n\n#define TXESR_TFDBS         0x08\n#define TXESR_TDWBS         0x04\n#define TXESR_TDRBS         0x02\n#define TXESR_TDSTR         0x01\n\n \n\n#define RXESR_RFDBS         0x08\n#define RXESR_RDWBS         0x04\n#define RXESR_RDRBS         0x02\n#define RXESR_RDSTR         0x01\n\n \n\n#define ISR_ISR3            0x80000000UL\n#define ISR_ISR2            0x40000000UL\n#define ISR_ISR1            0x20000000UL\n#define ISR_ISR0            0x10000000UL\n#define ISR_TXSTLI          0x02000000UL\n#define ISR_RXSTLI          0x01000000UL\n#define ISR_HFLD            0x00800000UL\n#define ISR_UDPI            0x00400000UL\n#define ISR_MIBFI           0x00200000UL\n#define ISR_SHDNI           0x00100000UL\n#define ISR_PHYI            0x00080000UL\n#define ISR_PWEI            0x00040000UL\n#define ISR_TMR1I           0x00020000UL\n#define ISR_TMR0I           0x00010000UL\n#define ISR_SRCI            0x00008000UL\n#define ISR_LSTPEI          0x00004000UL\n#define ISR_LSTEI           0x00002000UL\n#define ISR_OVFI            0x00001000UL\n#define ISR_FLONI           0x00000800UL\n#define ISR_RACEI           0x00000400UL\n#define ISR_TXWB1I          0x00000200UL\n#define ISR_TXWB0I          0x00000100UL\n#define ISR_PTX3I           0x00000080UL\n#define ISR_PTX2I           0x00000040UL\n#define ISR_PTX1I           0x00000020UL\n#define ISR_PTX0I           0x00000010UL\n#define ISR_PTXI            0x00000008UL\n#define ISR_PRXI            0x00000004UL\n#define ISR_PPTXI           0x00000002UL\n#define ISR_PPRXI           0x00000001UL\n\n \n\n#define IMR_TXSTLM          0x02000000UL\n#define IMR_UDPIM           0x00400000UL\n#define IMR_MIBFIM          0x00200000UL\n#define IMR_SHDNIM          0x00100000UL\n#define IMR_PHYIM           0x00080000UL\n#define IMR_PWEIM           0x00040000UL\n#define IMR_TMR1IM          0x00020000UL\n#define IMR_TMR0IM          0x00010000UL\n\n#define IMR_SRCIM           0x00008000UL\n#define IMR_LSTPEIM         0x00004000UL\n#define IMR_LSTEIM          0x00002000UL\n#define IMR_OVFIM           0x00001000UL\n#define IMR_FLONIM          0x00000800UL\n#define IMR_RACEIM          0x00000400UL\n#define IMR_TXWB1IM         0x00000200UL\n#define IMR_TXWB0IM         0x00000100UL\n\n#define IMR_PTX3IM          0x00000080UL\n#define IMR_PTX2IM          0x00000040UL\n#define IMR_PTX1IM          0x00000020UL\n#define IMR_PTX0IM          0x00000010UL\n#define IMR_PTXIM           0x00000008UL\n#define IMR_PRXIM           0x00000004UL\n#define IMR_PPTXIM          0x00000002UL\n#define IMR_PPRXIM          0x00000001UL\n\n \n\n#define INT_MASK_DEF        (IMR_PPTXIM|IMR_PPRXIM|IMR_PTXIM|IMR_PRXIM|\\\n                            IMR_PWEIM|IMR_TXWB0IM|IMR_TXWB1IM|IMR_FLONIM|\\\n                            IMR_OVFIM|IMR_LSTEIM|IMR_LSTPEIM|IMR_SRCIM|IMR_MIBFIM|\\\n                            IMR_SHDNIM|IMR_TMR1IM|IMR_TMR0IM|IMR_TXSTLM)\n\n \n\n#define TRDCSR_DEAD         0x0008\n#define TRDCSR_WAK          0x0004\n#define TRDCSR_ACT          0x0002\n#define TRDCSR_RUN\t    0x0001\n\n \n\n#define CAMADDR_CAMEN       0x80\n#define CAMADDR_VCAMSL      0x40\n\n \n\n#define CAMCR_PS1           0x80\n#define CAMCR_PS0           0x40\n#define CAMCR_AITRPKT       0x20\n#define CAMCR_AITR16        0x10\n#define CAMCR_CAMRD         0x08\n#define CAMCR_CAMWR         0x04\n#define CAMCR_PS_CAM_MASK   0x40\n#define CAMCR_PS_CAM_DATA   0x80\n#define CAMCR_PS_MAR        0x00\n\n \n\n#define MIICFG_MPO1         0x80\n#define MIICFG_MPO0         0x40\n#define MIICFG_MFDC         0x20\n\n \n\n#define MIISR_MIDLE         0x80\n\n \n\n#define PHYSR0_PHYRST       0x80\n#define PHYSR0_LINKGD       0x40\n#define PHYSR0_FDPX         0x10\n#define PHYSR0_SPDG         0x08\n#define PHYSR0_SPD10        0x04\n#define PHYSR0_RXFLC        0x02\n#define PHYSR0_TXFLC        0x01\n\n \n\n#define PHYSR1_PHYTBI       0x01\n\n \n\n#define MIICR_MAUTO         0x80\n#define MIICR_RCMD          0x40\n#define MIICR_WCMD          0x20\n#define MIICR_MDPM          0x10\n#define MIICR_MOUT          0x08\n#define MIICR_MDO           0x04\n#define MIICR_MDI           0x02\n#define MIICR_MDC           0x01\n\n \n\n#define MIIADR_SWMPL        0x80\n\n \n\n#define CFGA_PMHCTG         0x08\n#define CFGA_GPIO1PD        0x04\n#define CFGA_ABSHDN         0x02\n#define CFGA_PACPI          0x01\n\n \n\n#define CFGB_GTCKOPT        0x80\n#define CFGB_MIIOPT         0x40\n#define CFGB_CRSEOPT        0x20\n#define CFGB_OFSET          0x10\n#define CFGB_CRANDOM        0x08\n#define CFGB_CAP            0x04\n#define CFGB_MBA            0x02\n#define CFGB_BAKOPT         0x01\n\n \n\n#define CFGC_EELOAD         0x80\n#define CFGC_BROPT          0x40\n#define CFGC_DLYEN          0x20\n#define CFGC_DTSEL          0x10\n#define CFGC_BTSEL          0x08\n#define CFGC_BPS2           0x04\t \n#define CFGC_BPS1           0x02\t \n#define CFGC_BPS0           0x01\t \n\n \n\n#define CFGD_IODIS          0x80\n#define CFGD_MSLVDACEN      0x40\n#define CFGD_CFGDACEN       0x20\n#define CFGD_PCI64EN        0x10\n#define CFGD_HTMRL4         0x08\n\n \n\n#define DCFG_XMWI           0x8000\n#define DCFG_XMRM           0x4000\n#define DCFG_XMRL           0x2000\n#define DCFG_PERDIS         0x1000\n#define DCFG_MRWAIT         0x0400\n#define DCFG_MWWAIT         0x0200\n#define DCFG_LATMEN         0x0100\n\n \n\n#define MCFG_RXARB          0x0080\n#define MCFG_RFT1           0x0020\n#define MCFG_RFT0           0x0010\n#define MCFG_LOWTHOPT       0x0008\n#define MCFG_PQEN           0x0004\n#define MCFG_RTGOPT         0x0002\n#define MCFG_VIDFR          0x0001\n\n \n\n#define MCFG_TXARB          0x8000\n#define MCFG_TXQBK1         0x0800\n#define MCFG_TXQBK0         0x0400\n#define MCFG_TXQNOBK        0x0200\n#define MCFG_SNAPOPT        0x0100\n\n \n\n#define PMCC_DSI            0x80\n#define PMCC_D2_DIS         0x40\n#define PMCC_D1_DIS         0x20\n#define PMCC_D3C_EN         0x10\n#define PMCC_D3H_EN         0x08\n#define PMCC_D2_EN          0x04\n#define PMCC_D1_EN          0x02\n#define PMCC_D0_EN          0x01\n\n \n\n#define STICKHW_SWPTAG      0x10\n#define STICKHW_WOLSR       0x08\n#define STICKHW_WOLEN       0x04\n#define STICKHW_DS1         0x02\t \n#define STICKHW_DS0         0x01\t \n\n \n\n#define MIBCR_MIBISTOK      0x80\n#define MIBCR_MIBISTGO      0x40\n#define MIBCR_MIBINC        0x20\n#define MIBCR_MIBHI         0x10\n#define MIBCR_MIBFRZ        0x08\n#define MIBCR_MIBFLSH       0x04\n#define MIBCR_MPTRINI       0x02\n#define MIBCR_MIBCLR        0x01\n\n \n\n#define EERSV_BOOT_RPL      ((u8) 0x01)\t  \n\n#define EERSV_BOOT_MASK     ((u8) 0x06)\n#define EERSV_BOOT_INT19    ((u8) 0x00)\n#define EERSV_BOOT_INT18    ((u8) 0x02)\n#define EERSV_BOOT_LOCAL    ((u8) 0x04)\n#define EERSV_BOOT_BEV      ((u8) 0x06)\n\n\n \n\n#define BPCMD_BPDNE         0x80\n#define BPCMD_EBPWR         0x02\n#define BPCMD_EBPRD         0x01\n\n \n\n#define EECSR_EMBP          0x40\t \n#define EECSR_RELOAD        0x20\t \n#define EECSR_DPM           0x10\t \n#define EECSR_ECS           0x08\t \n#define EECSR_ECK           0x04\t \n#define EECSR_EDI           0x02\t \n#define EECSR_EDO           0x01\t \n\n \n\n#define EMBCMD_EDONE        0x80\n#define EMBCMD_EWDIS        0x08\n#define EMBCMD_EWEN         0x04\n#define EMBCMD_EWR          0x02\n#define EMBCMD_ERD          0x01\n\n \n\n#define TESTCFG_HBDIS       0x80\n\n \n\n#define CHIPGCR_FCGMII      0x80\t \n#define CHIPGCR_FCFDX       0x40\t \n#define CHIPGCR_FCRESV      0x20\n#define CHIPGCR_FCMODE      0x10\t \n#define CHIPGCR_LPSOPT      0x08\n#define CHIPGCR_TM1US       0x04\n#define CHIPGCR_TM0US       0x02\n#define CHIPGCR_PHYINTEN    0x01\n\n \n\n#define WOLCR_MSWOLEN7      0x0080\t \n#define WOLCR_MSWOLEN6      0x0040\n#define WOLCR_MSWOLEN5      0x0020\n#define WOLCR_MSWOLEN4      0x0010\n#define WOLCR_MSWOLEN3      0x0008\n#define WOLCR_MSWOLEN2      0x0004\n#define WOLCR_MSWOLEN1      0x0002\n#define WOLCR_MSWOLEN0      0x0001\n#define WOLCR_ARP_EN        0x0001\n\n \n\n#define WOLCR_LINKOFF_EN      0x0800\t \n#define WOLCR_LINKON_EN       0x0400\t \n#define WOLCR_MAGIC_EN        0x0200\t \n#define WOLCR_UNICAST_EN      0x0100\t \n\n\n \n\n#define PWCFG_PHYPWOPT          0x80\t \n#define PWCFG_PCISTICK          0x40\t \n#define PWCFG_WOLTYPE           0x20\t \n#define PWCFG_LEGCY_WOL         0x10\n#define PWCFG_PMCSR_PME_SR      0x08\n#define PWCFG_PMCSR_PME_EN      0x04\t \n#define PWCFG_LEGACY_WOLSR      0x02\t \n#define PWCFG_LEGACY_WOLEN      0x01\t \n\n \n\n#define WOLCFG_PMEOVR           0x80\t \n#define WOLCFG_SAM              0x20\t \n#define WOLCFG_SAB              0x10\t \n#define WOLCFG_SMIIACC          0x08\t \n#define WOLCFG_SGENWH           0x02\n#define WOLCFG_PHYINTEN         0x01\t \n \n\n#define WOLSR_LINKOFF_INT      0x0800\n#define WOLSR_LINKON_INT       0x0400\n#define WOLSR_MAGIC_INT        0x0200\n#define WOLSR_UNICAST_INT      0x0100\n\n \n\n#define PKT_TYPE_NONE               0x0000\t \n#define PKT_TYPE_DIRECTED           0x0001\t \n#define PKT_TYPE_MULTICAST          0x0002\n#define PKT_TYPE_ALL_MULTICAST      0x0004\n#define PKT_TYPE_BROADCAST          0x0008\n#define PKT_TYPE_PROMISCUOUS        0x0020\n#define PKT_TYPE_LONG               0x2000\t \n#define PKT_TYPE_RUNT               0x4000\n#define PKT_TYPE_ERROR              0x8000\t \n\n \n\n#define MAC_LB_NONE         0x00\n#define MAC_LB_INTERNAL     0x01\n#define MAC_LB_EXTERNAL     0x02\n\n \n\n#if defined(_SIM)\n#define IMR_MASK_VALUE      0x0033FF0FUL\t \n\n#else\n#define IMR_MASK_VALUE      0x0013FB0FUL\t \n#endif\n\n \n\n#define REV_ID_VT3119_A0\t0x00\n#define REV_ID_VT3119_A1\t0x01\n#define REV_ID_VT3216_A0\t0x10\n\n \n\n#define W_MAX_TIMEOUT       0x0FFFU\n\n\n \n\nstruct mac_regs {\n\tvolatile u8 PAR[6];\t\t \n\tvolatile u8 RCR;\n\tvolatile u8 TCR;\n\n\tvolatile __le32 CR0Set;\t\t \n\tvolatile __le32 CR0Clr;\t\t \n\n\tvolatile u8 MARCAM[8];\t\t \n\n\tvolatile __le32 DecBaseHi;\t \n\tvolatile __le16 DbfBaseHi;\t \n\tvolatile __le16 reserved_1E;\n\n\tvolatile __le16 ISRCTL;\t\t \n\tvolatile u8 TXESR;\n\tvolatile u8 RXESR;\n\n\tvolatile __le32 ISR;\t\t \n\tvolatile __le32 IMR;\n\n\tvolatile __le32 TDStatusPort;\t \n\n\tvolatile __le16 TDCSRSet;\t \n\tvolatile u8 RDCSRSet;\n\tvolatile u8 reserved_33;\n\tvolatile __le16 TDCSRClr;\n\tvolatile u8 RDCSRClr;\n\tvolatile u8 reserved_37;\n\n\tvolatile __le32 RDBaseLo;\t \n\tvolatile __le16 RDIdx;\t\t \n\tvolatile u8 TQETMR;\t\t \n\tvolatile u8 RQETMR;\t\t \n\n\tvolatile __le32 TDBaseLo[4];\t \n\n\tvolatile __le16 RDCSize;\t \n\tvolatile __le16 TDCSize;\t \n\tvolatile __le16 TDIdx[4];\t \n\tvolatile __le16 tx_pause_timer;\t \n\tvolatile __le16 RBRDU;\t\t \n\n\tvolatile __le32 FIFOTest0;\t \n\tvolatile __le32 FIFOTest1;\t \n\n\tvolatile u8 CAMADDR;\t\t \n\tvolatile u8 CAMCR;\t\t \n\tvolatile u8 GFTEST;\t\t \n\tvolatile u8 FTSTCMD;\t\t \n\n\tvolatile u8 MIICFG;\t\t \n\tvolatile u8 MIISR;\n\tvolatile u8 PHYSR0;\n\tvolatile u8 PHYSR1;\n\tvolatile u8 MIICR;\n\tvolatile u8 MIIADR;\n\tvolatile __le16 MIIDATA;\n\n\tvolatile __le16 SoftTimer0;\t \n\tvolatile __le16 SoftTimer1;\n\n\tvolatile u8 CFGA;\t\t \n\tvolatile u8 CFGB;\n\tvolatile u8 CFGC;\n\tvolatile u8 CFGD;\n\n\tvolatile __le16 DCFG;\t\t \n\tvolatile __le16 MCFG;\n\n\tvolatile u8 TBIST;\t\t \n\tvolatile u8 RBIST;\n\tvolatile u8 PMCPORT;\n\tvolatile u8 STICKHW;\n\n\tvolatile u8 MIBCR;\t\t \n\tvolatile u8 reserved_85;\n\tvolatile u8 rev_id;\n\tvolatile u8 PORSTS;\n\n\tvolatile __le32 MIBData;\t \n\n\tvolatile __le16 EEWrData;\n\n\tvolatile u8 reserved_8E;\n\tvolatile u8 BPMDWr;\n\tvolatile u8 BPCMD;\n\tvolatile u8 BPMDRd;\n\n\tvolatile u8 EECHKSUM;\t\t \n\tvolatile u8 EECSR;\n\n\tvolatile __le16 EERdData;\t \n\tvolatile u8 EADDR;\n\tvolatile u8 EMBCMD;\n\n\n\tvolatile u8 JMPSR0;\t\t \n\tvolatile u8 JMPSR1;\n\tvolatile u8 JMPSR2;\n\tvolatile u8 JMPSR3;\n\tvolatile u8 CHIPGSR;\t\t \n\tvolatile u8 TESTCFG;\n\tvolatile u8 DEBUG;\n\tvolatile u8 CHIPGCR;\n\n\tvolatile __le16 WOLCRSet;\t \n\tvolatile u8 PWCFGSet;\n\tvolatile u8 WOLCFGSet;\n\n\tvolatile __le16 WOLCRClr;\t \n\tvolatile u8 PWCFGCLR;\n\tvolatile u8 WOLCFGClr;\n\n\tvolatile __le16 WOLSRSet;\t \n\tvolatile __le16 reserved_AA;\n\n\tvolatile __le16 WOLSRClr;\t \n\tvolatile __le16 reserved_AE;\n\n\tvolatile __le16 PatternCRC[8];\t \n\tvolatile __le32 ByteMask[4][4];\t \n};\n\n\nenum hw_mib {\n\tHW_MIB_ifRxAllPkts = 0,\n\tHW_MIB_ifRxOkPkts,\n\tHW_MIB_ifTxOkPkts,\n\tHW_MIB_ifRxErrorPkts,\n\tHW_MIB_ifRxRuntOkPkt,\n\tHW_MIB_ifRxRuntErrPkt,\n\tHW_MIB_ifRx64Pkts,\n\tHW_MIB_ifTx64Pkts,\n\tHW_MIB_ifRx65To127Pkts,\n\tHW_MIB_ifTx65To127Pkts,\n\tHW_MIB_ifRx128To255Pkts,\n\tHW_MIB_ifTx128To255Pkts,\n\tHW_MIB_ifRx256To511Pkts,\n\tHW_MIB_ifTx256To511Pkts,\n\tHW_MIB_ifRx512To1023Pkts,\n\tHW_MIB_ifTx512To1023Pkts,\n\tHW_MIB_ifRx1024To1518Pkts,\n\tHW_MIB_ifTx1024To1518Pkts,\n\tHW_MIB_ifTxEtherCollisions,\n\tHW_MIB_ifRxPktCRCE,\n\tHW_MIB_ifRxJumboPkts,\n\tHW_MIB_ifTxJumboPkts,\n\tHW_MIB_ifRxMacControlFrames,\n\tHW_MIB_ifTxMacControlFrames,\n\tHW_MIB_ifRxPktFAE,\n\tHW_MIB_ifRxLongOkPkt,\n\tHW_MIB_ifRxLongPktErrPkt,\n\tHW_MIB_ifTXSQEErrors,\n\tHW_MIB_ifRxNobuf,\n\tHW_MIB_ifRxSymbolErrors,\n\tHW_MIB_ifInRangeLengthErrors,\n\tHW_MIB_ifLateCollisions,\n\tHW_MIB_SIZE\n};\n\nenum chip_type {\n\tCHIP_TYPE_VT6110 = 1,\n};\n\nstruct velocity_info_tbl {\n\tenum chip_type chip_id;\n\tconst char *name;\n\tint txqueue;\n\tu32 flags;\n};\n\n#define mac_hw_mibs_init(regs) {\\\n\tBYTE_REG_BITS_ON(MIBCR_MIBFRZ,&((regs)->MIBCR));\\\n\tBYTE_REG_BITS_ON(MIBCR_MIBCLR,&((regs)->MIBCR));\\\n\tdo {}\\\n\t\twhile (BYTE_REG_BITS_IS_ON(MIBCR_MIBCLR,&((regs)->MIBCR)));\\\n\tBYTE_REG_BITS_OFF(MIBCR_MIBFRZ,&((regs)->MIBCR));\\\n}\n\n#define mac_read_isr(regs)  \t\treadl(&((regs)->ISR))\n#define mac_write_isr(regs, x)  \twritel((x),&((regs)->ISR))\n#define mac_clear_isr(regs) \t\twritel(0xffffffffL,&((regs)->ISR))\n\n#define mac_write_int_mask(mask, regs) \twritel((mask),&((regs)->IMR));\n#define mac_disable_int(regs)       \twritel(CR0_GINTMSK1,&((regs)->CR0Clr))\n#define mac_enable_int(regs)    \twritel(CR0_GINTMSK1,&((regs)->CR0Set))\n\n#define mac_set_dma_length(regs, n) {\\\n\tBYTE_REG_BITS_SET((n),0x07,&((regs)->DCFG));\\\n}\n\n#define mac_set_rx_thresh(regs, n) {\\\n\tBYTE_REG_BITS_SET((n),(MCFG_RFT0|MCFG_RFT1),&((regs)->MCFG));\\\n}\n\n#define mac_rx_queue_run(regs) {\\\n\twriteb(TRDCSR_RUN, &((regs)->RDCSRSet));\\\n}\n\n#define mac_rx_queue_wake(regs) {\\\n\twriteb(TRDCSR_WAK, &((regs)->RDCSRSet));\\\n}\n\n#define mac_tx_queue_run(regs, n) {\\\n\twritew(TRDCSR_RUN<<((n)*4),&((regs)->TDCSRSet));\\\n}\n\n#define mac_tx_queue_wake(regs, n) {\\\n\twritew(TRDCSR_WAK<<(n*4),&((regs)->TDCSRSet));\\\n}\n\nstatic inline void mac_eeprom_reload(struct mac_regs __iomem * regs) {\n\tint i=0;\n\n\tBYTE_REG_BITS_ON(EECSR_RELOAD,&(regs->EECSR));\n\tdo {\n\t\tudelay(10);\n\t\tif (i++>0x1000)\n\t\t\tbreak;\n\t} while (BYTE_REG_BITS_IS_ON(EECSR_RELOAD,&(regs->EECSR)));\n}\n\n \n\ntypedef u8 MCAM_ADDR[ETH_ALEN];\n\nstruct arp_packet {\n\tu8 dest_mac[ETH_ALEN];\n\tu8 src_mac[ETH_ALEN];\n\t__be16 type;\n\t__be16 ar_hrd;\n\t__be16 ar_pro;\n\tu8 ar_hln;\n\tu8 ar_pln;\n\t__be16 ar_op;\n\tu8 ar_sha[ETH_ALEN];\n\tu8 ar_sip[4];\n\tu8 ar_tha[ETH_ALEN];\n\tu8 ar_tip[4];\n} __packed;\n\nstruct _magic_packet {\n\tu8 dest_mac[6];\n\tu8 src_mac[6];\n\t__be16 type;\n\tu8 MAC[16][6];\n\tu8 password[6];\n} __packed;\n\n \n\nstruct velocity_context {\n\tu8 mac_reg[256];\n\tMCAM_ADDR cam_addr[MCAM_SIZE];\n\tu16 vcam[VCAM_SIZE];\n\tu32 cammask[2];\n\tu32 patcrc[2];\n\tu32 pattern[8];\n};\n\n \n\n\n#define MII_REG_PSCR        0x10\t\n\n\n\n\n\n#define TCSR_ECHODIS        0x2000\t\n#define AUXCR_MDPPS         0x0004\t\n\n\n#define PLED_LALBE\t\t\t0x0004\t\n\n\n#define PSCR_ACRSTX         0x0800\t\n\n#define PHYID_CICADA_CS8201 0x000FC410UL\n#define PHYID_VT3216_32BIT  0x000FC610UL\n#define PHYID_VT3216_64BIT  0x000FC600UL\n#define PHYID_MARVELL_1000  0x01410C50UL\n#define PHYID_MARVELL_1000S 0x01410C40UL\n#define PHYID_ICPLUS_IP101A 0x02430C54UL\n#define PHYID_REV_ID_MASK   0x0000000FUL\n\n#define PHYID_GET_PHY_ID(i)         ((i) & ~PHYID_REV_ID_MASK)\n\n#define MII_REG_BITS_ON(x,i,p) do {\\\n    u16 w;\\\n    velocity_mii_read((p),(i),&(w));\\\n    (w)|=(x);\\\n    velocity_mii_write((p),(i),(w));\\\n} while (0)\n\n#define MII_REG_BITS_OFF(x,i,p) do {\\\n    u16 w;\\\n    velocity_mii_read((p),(i),&(w));\\\n    (w)&=(~(x));\\\n    velocity_mii_write((p),(i),(w));\\\n} while (0)\n\n#define MII_REG_BITS_IS_ON(x,i,p) ({\\\n    u16 w;\\\n    velocity_mii_read((p),(i),&(w));\\\n    ((int) ((w) & (x)));})\n\n#define MII_GET_PHY_ID(p) ({\\\n    u32 id;\\\n    velocity_mii_read((p),MII_PHYSID2,(u16 *) &id);\\\n    velocity_mii_read((p),MII_PHYSID1,((u16 *) &id)+1);\\\n    (id);})\n\n#define     VELOCITY_WOL_MAGIC             0x00000000UL\n#define     VELOCITY_WOL_PHY               0x00000001UL\n#define     VELOCITY_WOL_ARP               0x00000002UL\n#define     VELOCITY_WOL_UCAST             0x00000004UL\n#define     VELOCITY_WOL_BCAST             0x00000010UL\n#define     VELOCITY_WOL_MCAST             0x00000020UL\n#define     VELOCITY_WOL_MAGIC_SEC         0x00000040UL\n\n \n\n#define     VELOCITY_FLAGS_TAGGING         0x00000001UL\n#define     VELOCITY_FLAGS_RX_CSUM         0x00000004UL\n#define     VELOCITY_FLAGS_IP_ALIGN        0x00000008UL\n#define     VELOCITY_FLAGS_VAL_PKT_LEN     0x00000010UL\n\n#define     VELOCITY_FLAGS_FLOW_CTRL       0x01000000UL\n\n \n\n#define     VELOCITY_FLAGS_OPENED          0x00010000UL\n#define     VELOCITY_FLAGS_VMNS_CONNECTED  0x00020000UL\n#define     VELOCITY_FLAGS_VMNS_COMMITTED  0x00040000UL\n#define     VELOCITY_FLAGS_WOL_ENABLED     0x00080000UL\n\n \n\n#define     VELOCITY_LINK_FAIL             0x00000001UL\n#define     VELOCITY_SPEED_10              0x00000002UL\n#define     VELOCITY_SPEED_100             0x00000004UL\n#define     VELOCITY_SPEED_1000            0x00000008UL\n#define     VELOCITY_DUPLEX_FULL           0x00000010UL\n#define     VELOCITY_AUTONEG_ENABLE        0x00000020UL\n#define     VELOCITY_FORCED_BY_EEPROM      0x00000040UL\n\n \n\n#define     VELOCITY_LINK_CHANGE           0x00000001UL\n\nenum speed_opt {\n\tSPD_DPX_AUTO = 0,\n\tSPD_DPX_100_HALF = 1,\n\tSPD_DPX_100_FULL = 2,\n\tSPD_DPX_10_HALF = 3,\n\tSPD_DPX_10_FULL = 4,\n\tSPD_DPX_1000_FULL = 5\n};\n\nenum velocity_init_type {\n\tVELOCITY_INIT_COLD = 0,\n\tVELOCITY_INIT_RESET,\n\tVELOCITY_INIT_WOL\n};\n\nenum velocity_flow_cntl_type {\n\tFLOW_CNTL_DEFAULT = 1,\n\tFLOW_CNTL_TX,\n\tFLOW_CNTL_RX,\n\tFLOW_CNTL_TX_RX,\n\tFLOW_CNTL_DISABLE,\n};\n\nstruct velocity_opt {\n\tint numrx;\t\t\t \n\tint numtx;\t\t\t \n\tenum speed_opt spd_dpx;\t\t \n\n\tint DMA_length;\t\t\t \n\tint rx_thresh;\t\t\t \n\tint flow_cntl;\n\tint wol_opts;\t\t\t \n\tint td_int_count;\n\tint int_works;\n\tint rx_bandwidth_hi;\n\tint rx_bandwidth_lo;\n\tint rx_bandwidth_en;\n\tint rxqueue_timer;\n\tint txqueue_timer;\n\tint tx_intsup;\n\tint rx_intsup;\n\tu32 flags;\n};\n\n#define AVAIL_TD(p,q)   ((p)->options.numtx-((p)->tx.used[(q)]))\n\n#define GET_RD_BY_IDX(vptr, idx)   (vptr->rd_ring[idx])\n\nstruct velocity_info {\n\tstruct device *dev;\n\tstruct pci_dev *pdev;\n\tstruct net_device *netdev;\n\tbool no_eeprom;\n\n\tunsigned long active_vlans[BITS_TO_LONGS(VLAN_N_VID)];\n\tu8 ip_addr[4];\n\tenum chip_type chip_id;\n\n\tstruct mac_regs __iomem * mac_regs;\n\tunsigned long memaddr;\n\tunsigned long ioaddr;\n\n\tstruct tx_info {\n\t\tint numq;\n\n\t\t \n\t\tint used[TX_QUEUE_NO];\n\t\tint curr[TX_QUEUE_NO];\n\t\tint tail[TX_QUEUE_NO];\n\t\tstruct tx_desc *rings[TX_QUEUE_NO];\n\t\tstruct velocity_td_info *infos[TX_QUEUE_NO];\n\t\tdma_addr_t pool_dma[TX_QUEUE_NO];\n\t} tx;\n\n\tstruct rx_info {\n\t\tint buf_sz;\n\n\t\tint dirty;\n\t\tint curr;\n\t\tu32 filled;\n\t\tstruct rx_desc *ring;\n\t\tstruct velocity_rd_info *info;\t \n\t\tdma_addr_t pool_dma;\n\t} rx;\n\n\tu32 mib_counter[MAX_HW_MIB_COUNTER];\n\tstruct velocity_opt options;\n\n\tu32 int_mask;\n\n\tu32 flags;\n\n\tu32 mii_status;\n\tu32 phy_id;\n\tint multicast_limit;\n\n\tu8 vCAMmask[(VCAM_SIZE / 8)];\n\tu8 mCAMmask[(MCAM_SIZE / 8)];\n\n\tspinlock_t lock;\n\n\tint wol_opts;\n\tu8 wol_passwd[6];\n\n\tstruct velocity_context context;\n\n\tu32 ticks;\n\tu32 ethtool_ops_nesting;\n\n\tu8 rev_id;\n\n\tstruct napi_struct napi;\n};\n\n \n\nstatic inline int velocity_get_ip(struct velocity_info *vptr)\n{\n\tstruct in_device *in_dev;\n\tstruct in_ifaddr *ifa;\n\tint res = -ENOENT;\n\n\trcu_read_lock();\n\tin_dev = __in_dev_get_rcu(vptr->netdev);\n\tif (in_dev != NULL) {\n\t\tifa = rcu_dereference(in_dev->ifa_list);\n\t\tif (ifa != NULL) {\n\t\t\tmemcpy(vptr->ip_addr, &ifa->ifa_address, 4);\n\t\t\tres = 0;\n\t\t}\n\t}\n\trcu_read_unlock();\n\treturn res;\n}\n\n \n\nstatic inline void velocity_update_hw_mibs(struct velocity_info *vptr)\n{\n\tu32 tmp;\n\tint i;\n\tBYTE_REG_BITS_ON(MIBCR_MIBFLSH, &(vptr->mac_regs->MIBCR));\n\n\twhile (BYTE_REG_BITS_IS_ON(MIBCR_MIBFLSH, &(vptr->mac_regs->MIBCR)));\n\n\tBYTE_REG_BITS_ON(MIBCR_MPTRINI, &(vptr->mac_regs->MIBCR));\n\tfor (i = 0; i < HW_MIB_SIZE; i++) {\n\t\ttmp = readl(&(vptr->mac_regs->MIBData)) & 0x00FFFFFFUL;\n\t\tvptr->mib_counter[i] += tmp;\n\t}\n}\n\n \n\nstatic inline void init_flow_control_register(struct velocity_info *vptr)\n{\n\tstruct mac_regs __iomem * regs = vptr->mac_regs;\n\n\t \n\twritel((CR0_XONEN | CR0_XHITH1 | CR0_XLTH1 | CR0_XLTH0), &regs->CR0Set);\n\twritel((CR0_FDXTFCEN | CR0_FDXRFCEN | CR0_HDXFCEN | CR0_XHITH0), &regs->CR0Clr);\n\n\t \n\twritew(0xFFFF, &regs->tx_pause_timer);\n\n\t \n\twritew(vptr->options.numrx, &regs->RBRDU);\n}\n\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}