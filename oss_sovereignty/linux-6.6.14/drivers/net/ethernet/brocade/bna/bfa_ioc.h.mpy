{
  "module_name": "bfa_ioc.h",
  "hash_id": "ef913ee9c5d943e052f9e7b6b30b7d54b81096e60b9be314e0089ad286da122f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/brocade/bna/bfa_ioc.h",
  "human_readable_source": " \n \n \n\n#ifndef __BFA_IOC_H__\n#define __BFA_IOC_H__\n\n#include \"bfa_cs.h\"\n#include \"bfi.h\"\n#include \"cna.h\"\n\n#define BFA_IOC_TOV\t\t3000\t \n#define BFA_IOC_HWSEM_TOV\t500\t \n#define BFA_IOC_HB_TOV\t\t500\t \n#define BFA_IOC_POLL_TOV\t200\t \n#define BNA_DBG_FWTRC_LEN      (BFI_IOC_TRC_ENTS * BFI_IOC_TRC_ENT_SZ + \\\n\t\t\t\tBFI_IOC_TRC_HDR_SZ)\n\n \nstruct bfa_pcidev {\n\tint\tpci_slot;\n\tu8\tpci_func;\n\tu16\tdevice_id;\n\tu16\tssid;\n\tvoid\t__iomem *pci_bar_kva;\n};\n\n \nstruct bfa_dma {\n\tvoid\t*kva;\t \n\tu64\tpa;\t \n};\n\n#define BFA_DMA_ALIGN_SZ\t256\n\n \n#define BFI_SMEM_CB_SIZE\t0x200000U\t \n#define BFI_SMEM_CT_SIZE\t0x280000U\t \n\n \n#define bfa_dma_be_addr_set(dma_addr, pa)\t\\\n\t\t__bfa_dma_be_addr_set(&dma_addr, (u64)pa)\nstatic inline void\n__bfa_dma_be_addr_set(union bfi_addr_u *dma_addr, u64 pa)\n{\n\tdma_addr->a32.addr_lo = (u32) htonl(pa);\n\tdma_addr->a32.addr_hi = (u32) htonl(upper_32_bits(pa));\n}\n\n#define bfa_alen_set(__alen, __len, __pa)\t\\\n\t__bfa_alen_set(__alen, __len, (u64)__pa)\n\nstatic inline void\n__bfa_alen_set(struct bfi_alen *alen, u32 len, u64 pa)\n{\n\talen->al_len = cpu_to_be32(len);\n\tbfa_dma_be_addr_set(alen->al_addr, pa);\n}\n\nstruct bfa_ioc_regs {\n\tvoid __iomem *hfn_mbox_cmd;\n\tvoid __iomem *hfn_mbox;\n\tvoid __iomem *lpu_mbox_cmd;\n\tvoid __iomem *lpu_mbox;\n\tvoid __iomem *lpu_read_stat;\n\tvoid __iomem *pss_ctl_reg;\n\tvoid __iomem *pss_err_status_reg;\n\tvoid __iomem *app_pll_fast_ctl_reg;\n\tvoid __iomem *app_pll_slow_ctl_reg;\n\tvoid __iomem *ioc_sem_reg;\n\tvoid __iomem *ioc_usage_sem_reg;\n\tvoid __iomem *ioc_init_sem_reg;\n\tvoid __iomem *ioc_usage_reg;\n\tvoid __iomem *host_page_num_fn;\n\tvoid __iomem *heartbeat;\n\tvoid __iomem *ioc_fwstate;\n\tvoid __iomem *alt_ioc_fwstate;\n\tvoid __iomem *ll_halt;\n\tvoid __iomem *alt_ll_halt;\n\tvoid __iomem *err_set;\n\tvoid __iomem *ioc_fail_sync;\n\tvoid __iomem *shirq_isr_next;\n\tvoid __iomem *shirq_msk_next;\n\tvoid __iomem *smem_page_start;\n\tu32\tsmem_pg0;\n};\n\n \ntypedef void (*bfa_mbox_cmd_cbfn_t)(void *cbarg);\nstruct bfa_mbox_cmd {\n\tstruct list_head\tqe;\n\tbfa_mbox_cmd_cbfn_t     cbfn;\n\tvoid\t\t    *cbarg;\n\tu32     msg[BFI_IOC_MSGSZ];\n};\n\n \ntypedef void (*bfa_ioc_mbox_mcfunc_t)(void *cbarg, struct bfi_mbmsg *m);\nstruct bfa_ioc_mbox_mod {\n\tstruct list_head\tcmd_q;\t\t \n\tint\t\t\tnmclass;\t \n\tstruct {\n\t\tbfa_ioc_mbox_mcfunc_t\tcbfn;\t \n\t\tvoid\t\t\t*cbarg;\n\t} mbhdlr[BFI_MC_MAX];\n};\n\n \ntypedef void (*bfa_ioc_enable_cbfn_t)(void *bfa, enum bfa_status status);\ntypedef void (*bfa_ioc_disable_cbfn_t)(void *bfa);\ntypedef void (*bfa_ioc_hbfail_cbfn_t)(void *bfa);\ntypedef void (*bfa_ioc_reset_cbfn_t)(void *bfa);\nstruct bfa_ioc_cbfn {\n\tbfa_ioc_enable_cbfn_t\tenable_cbfn;\n\tbfa_ioc_disable_cbfn_t\tdisable_cbfn;\n\tbfa_ioc_hbfail_cbfn_t\thbfail_cbfn;\n\tbfa_ioc_reset_cbfn_t\treset_cbfn;\n};\n\n \nenum bfa_ioc_event {\n\tBFA_IOC_E_ENABLED\t= 1,\n\tBFA_IOC_E_DISABLED\t= 2,\n\tBFA_IOC_E_FAILED\t= 3,\n};\n\ntypedef void (*bfa_ioc_notify_cbfn_t)(void *, enum bfa_ioc_event);\n\nstruct bfa_ioc_notify {\n\tstruct list_head\tqe;\n\tbfa_ioc_notify_cbfn_t\tcbfn;\n\tvoid\t\t\t*cbarg;\n};\n\n \n#define bfa_ioc_notify_init(__notify, __cbfn, __cbarg) do {\t\\\n\t(__notify)->cbfn = (__cbfn);\t\t\t\t\\\n\t(__notify)->cbarg = (__cbarg);\t\t\t\t\\\n} while (0)\n\nenum iocpf_event;\n\nstruct bfa_iocpf {\n\tvoid (*fsm)(struct bfa_iocpf *s, enum iocpf_event e);\n\tstruct bfa_ioc\t\t*ioc;\n\tbool\t\t\tfw_mismatch_notified;\n\tbool\t\t\tauto_recover;\n\tu32\t\t\tpoll_time;\n};\n\nenum ioc_event;\n\nstruct bfa_ioc {\n\tvoid (*fsm)(struct bfa_ioc *s, enum ioc_event e);\n\tstruct bfa\t\t*bfa;\n\tstruct bfa_pcidev\tpcidev;\n\tstruct timer_list\tioc_timer;\n\tstruct timer_list\tiocpf_timer;\n\tstruct timer_list\tsem_timer;\n\tstruct timer_list\thb_timer;\n\tu32\t\t\thb_count;\n\tstruct list_head\tnotify_q;\n\tvoid\t\t\t*dbg_fwsave;\n\tint\t\t\tdbg_fwsave_len;\n\tbool\t\t\tdbg_fwsave_once;\n\tenum bfi_pcifn_class\tclscode;\n\tstruct bfa_ioc_regs\tioc_regs;\n\tstruct bfa_ioc_drv_stats stats;\n\tbool\t\t\tfcmode;\n\tbool\t\t\tpllinit;\n\tbool\t\t\tstats_busy;\t \n\tu8\t\t\tport_id;\n\n\tstruct bfa_dma\t\tattr_dma;\n\tstruct bfi_ioc_attr\t*attr;\n\tstruct bfa_ioc_cbfn\t*cbfn;\n\tstruct bfa_ioc_mbox_mod\tmbox_mod;\n\tconst struct bfa_ioc_hwif *ioc_hwif;\n\tstruct bfa_iocpf\tiocpf;\n\tenum bfi_asic_gen\tasic_gen;\n\tenum bfi_asic_mode\tasic_mode;\n\tenum bfi_port_mode\tport0_mode;\n\tenum bfi_port_mode\tport1_mode;\n\tenum bfa_mode\t\tport_mode;\n\tu8\t\t\tad_cap_bm;\t \n\tu8\t\t\tport_mode_cfg;\t \n};\n\nstruct bfa_ioc_hwif {\n\tenum bfa_status (*ioc_pll_init) (void __iomem *rb,\n\t\t\t\t\t\tenum bfi_asic_mode m);\n\tbool\t\t(*ioc_firmware_lock)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_firmware_unlock)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_reg_init)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_map_port)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_isr_mode_set)\t(struct bfa_ioc *ioc,\n\t\t\t\t\tbool msix);\n\tvoid\t\t(*ioc_notify_fail)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_ownership_reset)\t(struct bfa_ioc *ioc);\n\tbool\t\t(*ioc_sync_start)       (struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_sync_join)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_sync_leave)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_sync_ack)\t\t(struct bfa_ioc *ioc);\n\tbool\t\t(*ioc_sync_complete)\t(struct bfa_ioc *ioc);\n\tbool\t\t(*ioc_lpu_read_stat)\t(struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_set_fwstate)\t(struct bfa_ioc *ioc,\n\t\t\t\t\tenum bfi_ioc_state fwstate);\n\tenum bfi_ioc_state (*ioc_get_fwstate) (struct bfa_ioc *ioc);\n\tvoid\t\t(*ioc_set_alt_fwstate)\t(struct bfa_ioc *ioc,\n\t\t\t\t\tenum bfi_ioc_state fwstate);\n\tenum bfi_ioc_state (*ioc_get_alt_fwstate) (struct bfa_ioc *ioc);\n\n};\n\n#define bfa_ioc_pcifn(__ioc)\t\t((__ioc)->pcidev.pci_func)\n#define bfa_ioc_devid(__ioc)\t\t((__ioc)->pcidev.device_id)\n#define bfa_ioc_bar0(__ioc)\t\t((__ioc)->pcidev.pci_bar_kva)\n#define bfa_ioc_portid(__ioc)\t\t((__ioc)->port_id)\n#define bfa_ioc_asic_gen(__ioc)\t\t((__ioc)->asic_gen)\n#define bfa_ioc_is_default(__ioc)\t\\\n\t(bfa_ioc_pcifn(__ioc) == bfa_ioc_portid(__ioc))\n#define bfa_ioc_speed_sup(__ioc)\t\\\n\tBFI_ADAPTER_GETP(SPEED, (__ioc)->attr->adapter_prop)\n#define bfa_ioc_get_nports(__ioc)\t\\\n\tBFI_ADAPTER_GETP(NPORTS, (__ioc)->attr->adapter_prop)\n\n#define bfa_ioc_stats(_ioc, _stats)\t((_ioc)->stats._stats++)\n#define bfa_ioc_stats_hb_count(_ioc, _hb_count)\t\\\n\t((_ioc)->stats.hb_count = (_hb_count))\n#define BFA_IOC_FWIMG_MINSZ\t(16 * 1024)\n#define BFA_IOC_FW_SMEM_SIZE(__ioc)\t\t\t\t\t\\\n\t((bfa_ioc_asic_gen(__ioc) == BFI_ASIC_GEN_CB)\t\t\t\\\n\t? BFI_SMEM_CB_SIZE : BFI_SMEM_CT_SIZE)\n#define BFA_IOC_FLASH_CHUNK_NO(off)\t\t(off / BFI_FLASH_CHUNK_SZ_WORDS)\n#define BFA_IOC_FLASH_OFFSET_IN_CHUNK(off)\t(off % BFI_FLASH_CHUNK_SZ_WORDS)\n#define BFA_IOC_FLASH_CHUNK_ADDR(chunkno)  (chunkno * BFI_FLASH_CHUNK_SZ_WORDS)\n\n \nbool bfa_nw_ioc_mbox_queue(struct bfa_ioc *ioc,\n\t\t\tstruct bfa_mbox_cmd *cmd,\n\t\t\tbfa_mbox_cmd_cbfn_t cbfn, void *cbarg);\nvoid bfa_nw_ioc_mbox_isr(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_mbox_regisr(struct bfa_ioc *ioc, enum bfi_mclass mc,\n\t\tbfa_ioc_mbox_mcfunc_t cbfn, void *cbarg);\n\n \n\n#define bfa_ioc_pll_init_asic(__ioc) \\\n\t((__ioc)->ioc_hwif->ioc_pll_init((__ioc)->pcidev.pci_bar_kva, \\\n\t\t\t   (__ioc)->asic_mode))\n\n#define bfa_ioc_lpu_read_stat(__ioc) do {\t\t\t\t\\\n\t\tif ((__ioc)->ioc_hwif->ioc_lpu_read_stat)\t\t\\\n\t\t\t((__ioc)->ioc_hwif->ioc_lpu_read_stat(__ioc));\t\\\n} while (0)\n\nvoid bfa_nw_ioc_set_ct_hwif(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_set_ct2_hwif(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_ct2_poweron(struct bfa_ioc *ioc);\n\nvoid bfa_nw_ioc_attach(struct bfa_ioc *ioc, void *bfa,\n\t\tstruct bfa_ioc_cbfn *cbfn);\nvoid bfa_nw_ioc_auto_recover(bool auto_recover);\nvoid bfa_nw_ioc_detach(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_pci_init(struct bfa_ioc *ioc, struct bfa_pcidev *pcidev,\n\t\tenum bfi_pcifn_class clscode);\nu32 bfa_nw_ioc_meminfo(void);\nvoid bfa_nw_ioc_mem_claim(struct bfa_ioc *ioc,  u8 *dm_kva, u64 dm_pa);\nvoid bfa_nw_ioc_enable(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_disable(struct bfa_ioc *ioc);\n\nvoid bfa_nw_ioc_error_isr(struct bfa_ioc *ioc);\nbool bfa_nw_ioc_is_disabled(struct bfa_ioc *ioc);\nbool bfa_nw_ioc_is_operational(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_get_attr(struct bfa_ioc *ioc, struct bfa_ioc_attr *ioc_attr);\nenum bfa_status bfa_nw_ioc_fwsig_invalidate(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_notify_register(struct bfa_ioc *ioc,\n\tstruct bfa_ioc_notify *notify);\nbool bfa_nw_ioc_sem_get(void __iomem *sem_reg);\nvoid bfa_nw_ioc_sem_release(void __iomem *sem_reg);\nvoid bfa_nw_ioc_hw_sem_release(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_fwver_get(struct bfa_ioc *ioc,\n\t\t\tstruct bfi_ioc_image_hdr *fwhdr);\nbool bfa_nw_ioc_fwver_cmp(struct bfa_ioc *ioc,\n\t\t\tstruct bfi_ioc_image_hdr *fwhdr);\nvoid bfa_nw_ioc_get_mac(struct bfa_ioc *ioc, u8 *mac);\nvoid bfa_nw_ioc_debug_memclaim(struct bfa_ioc *ioc, void *dbg_fwsave);\nint bfa_nw_ioc_debug_fwtrc(struct bfa_ioc *ioc, void *trcdata, int *trclen);\nint bfa_nw_ioc_debug_fwsave(struct bfa_ioc *ioc, void *trcdata, int *trclen);\n\n \nvoid bfa_nw_ioc_timeout(struct bfa_ioc *ioc);\nvoid bfa_nw_ioc_hb_check(struct bfa_ioc *ioc);\nvoid bfa_nw_iocpf_timeout(struct bfa_ioc *ioc);\nvoid bfa_nw_iocpf_sem_timeout(struct bfa_ioc *ioc);\n\n \nu32 *bfa_cb_image_get_chunk(enum bfi_asic_gen asic_gen, u32 off);\nu32 bfa_cb_image_get_size(enum bfi_asic_gen asic_gen);\n\n \ntypedef void\t(*bfa_cb_flash) (void *cbarg, enum bfa_status status);\n\nstruct bfa_flash {\n\tstruct bfa_ioc *ioc;\t\t \n\tu32\t\ttype;\t\t \n\tu8\t\tinstance;\t \n\tu8\t\trsv[3];\n\tu32\t\top_busy;\t \n\tu32\t\tresidue;\t \n\tu32\t\toffset;\t\t \n\tenum bfa_status\tstatus;\t\t \n\tu8\t\t*dbuf_kva;\t \n\tu64\t\tdbuf_pa;\t \n\tbfa_cb_flash\tcbfn;\t\t \n\tvoid\t\t*cbarg;\t\t \n\tu8\t\t*ubuf;\t\t \n\tu32\t\taddr_off;\t \n\tstruct bfa_mbox_cmd mb;\t\t \n\tstruct bfa_ioc_notify ioc_notify;  \n};\n\nenum bfa_status bfa_nw_flash_get_attr(struct bfa_flash *flash,\n\t\t\tstruct bfa_flash_attr *attr,\n\t\t\tbfa_cb_flash cbfn, void *cbarg);\nenum bfa_status bfa_nw_flash_update_part(struct bfa_flash *flash,\n\t\t\tu32 type, u8 instance, void *buf, u32 len, u32 offset,\n\t\t\tbfa_cb_flash cbfn, void *cbarg);\nenum bfa_status bfa_nw_flash_read_part(struct bfa_flash *flash,\n\t\t\tu32 type, u8 instance, void *buf, u32 len, u32 offset,\n\t\t\tbfa_cb_flash cbfn, void *cbarg);\nu32\tbfa_nw_flash_meminfo(void);\nvoid\tbfa_nw_flash_attach(struct bfa_flash *flash,\n\t\t\t    struct bfa_ioc *ioc, void *dev);\nvoid\tbfa_nw_flash_memclaim(struct bfa_flash *flash, u8 *dm_kva, u64 dm_pa);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}