{
  "module_name": "bnad.h",
  "hash_id": "2b1571a3567130d620494f48a4acd4a859f5e129e7cd79746fa73f3829fa4886",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/brocade/bna/bnad.h",
  "human_readable_source": " \n \n \n#ifndef __BNAD_H__\n#define __BNAD_H__\n\n#include <linux/rtnetlink.h>\n#include <linux/workqueue.h>\n#include <linux/ipv6.h>\n#include <linux/etherdevice.h>\n#include <linux/mutex.h>\n#include <linux/firmware.h>\n#include <linux/if_vlan.h>\n\n \n#include <asm/checksum.h>\n#include <net/ip6_checksum.h>\n\n#include <net/ip.h>\n#include <net/tcp.h>\n\n#include \"bna.h\"\n\n#define BNAD_TXQ_DEPTH\t\t2048\n#define BNAD_RXQ_DEPTH\t\t2048\n\n#define BNAD_MAX_TX\t\t1\n#define BNAD_MAX_TXQ_PER_TX\t8\t \n#define BNAD_TXQ_NUM\t\t1\n\n#define BNAD_MAX_RX\t\t1\n#define BNAD_MAX_RXP_PER_RX\t16\n#define BNAD_MAX_RXQ_PER_RXP\t2\n\n \nstruct bnad_rx_ctrl {\n\tstruct bna_ccb *ccb;\n\tstruct bnad *bnad;\n\tunsigned long  flags;\n\tstruct napi_struct\tnapi;\n\tu64\t\trx_intr_ctr;\n\tu64\t\trx_poll_ctr;\n\tu64\t\trx_schedule;\n\tu64\t\trx_keep_poll;\n\tu64\t\trx_complete;\n};\n\n#define BNAD_RXMODE_PROMISC_DEFAULT\tBNA_RXMODE_PROMISC\n\n \n#define BNAD_NAME\t\t\t\"bna\"\n#define BNAD_NAME_LEN\t\t\t64\n\n#define BNAD_MAILBOX_MSIX_INDEX\t\t0\n#define BNAD_MAILBOX_MSIX_VECTORS\t1\n#define BNAD_INTX_TX_IB_BITMASK\t\t0x1\n#define BNAD_INTX_RX_IB_BITMASK\t\t0x2\n\n#define BNAD_STATS_TIMER_FREQ\t\t1000\t \n#define BNAD_DIM_TIMER_FREQ\t\t1000\t \n\n#define BNAD_IOCETH_TIMEOUT\t     10000\n\n#define BNAD_MIN_Q_DEPTH\t\t512\n#define BNAD_MAX_RXQ_DEPTH\t\t16384\n#define BNAD_MAX_TXQ_DEPTH\t\t2048\n\n#define BNAD_JUMBO_MTU\t\t\t9000\n\n#define BNAD_NETIF_WAKE_THRESHOLD\t8\n\n#define BNAD_RXQ_REFILL_THRESHOLD_SHIFT\t3\n\n \n#define BNAD_TXQ_FREE_SENT\t\t0\n#define BNAD_TXQ_TX_STARTED\t\t1\n\n \n#define BNAD_RXQ_STARTED\t\t0\n#define BNAD_RXQ_POST_OK\t\t1\n\n \n#define BNAD_NUM_TXQ\t\t\t(bnad->num_tx * bnad->num_txq_per_tx)\n#define BNAD_NUM_RXP\t\t\t(bnad->num_rx * bnad->num_rxp_per_rx)\n\n#define BNAD_FRAME_SIZE(_mtu) \\\n\t(ETH_HLEN + VLAN_HLEN + (_mtu) + ETH_FCS_LEN)\n\n \n\n \nenum bnad_intr_source {\n\tBNAD_INTR_TX\t\t= 1,\n\tBNAD_INTR_RX\t\t= 2\n};\n\nenum bnad_link_state {\n\tBNAD_LS_DOWN\t\t= 0,\n\tBNAD_LS_UP\t\t= 1\n};\n\nstruct bnad_iocmd_comp {\n\tstruct bnad\t\t*bnad;\n\tstruct completion\tcomp;\n\tint\t\t\tcomp_status;\n};\n\nstruct bnad_completion {\n\tstruct completion\tioc_comp;\n\tstruct completion\tucast_comp;\n\tstruct completion\tmcast_comp;\n\tstruct completion\ttx_comp;\n\tstruct completion\trx_comp;\n\tstruct completion\tstats_comp;\n\tstruct completion\tenet_comp;\n\tstruct completion\tmtu_comp;\n\n\tu8\t\t\tioc_comp_status;\n\tu8\t\t\tucast_comp_status;\n\tu8\t\t\tmcast_comp_status;\n\tu8\t\t\ttx_comp_status;\n\tu8\t\t\trx_comp_status;\n\tu8\t\t\tstats_comp_status;\n\tu8\t\t\tport_comp_status;\n\tu8\t\t\tmtu_comp_status;\n};\n\n \nstruct bnad_drv_stats {\n\tu64\t\tnetif_queue_stop;\n\tu64\t\tnetif_queue_wakeup;\n\tu64\t\tnetif_queue_stopped;\n\tu64\t\ttso4;\n\tu64\t\ttso6;\n\tu64\t\ttso_err;\n\tu64\t\ttcpcsum_offload;\n\tu64\t\tudpcsum_offload;\n\tu64\t\tcsum_help;\n\tu64\t\ttx_skb_too_short;\n\tu64\t\ttx_skb_stopping;\n\tu64\t\ttx_skb_max_vectors;\n\tu64\t\ttx_skb_mss_too_long;\n\tu64\t\ttx_skb_tso_too_short;\n\tu64\t\ttx_skb_tso_prepare;\n\tu64\t\ttx_skb_non_tso_too_long;\n\tu64\t\ttx_skb_tcp_hdr;\n\tu64\t\ttx_skb_udp_hdr;\n\tu64\t\ttx_skb_csum_err;\n\tu64\t\ttx_skb_headlen_too_long;\n\tu64\t\ttx_skb_headlen_zero;\n\tu64\t\ttx_skb_frag_zero;\n\tu64\t\ttx_skb_len_mismatch;\n\tu64\t\ttx_skb_map_failed;\n\n\tu64\t\thw_stats_updates;\n\tu64\t\tnetif_rx_dropped;\n\n\tu64\t\tlink_toggle;\n\tu64\t\tcee_toggle;\n\n\tu64\t\trxp_info_alloc_failed;\n\tu64\t\tmbox_intr_disabled;\n\tu64\t\tmbox_intr_enabled;\n\tu64\t\ttx_unmap_q_alloc_failed;\n\tu64\t\trx_unmap_q_alloc_failed;\n\n\tu64\t\trxbuf_alloc_failed;\n\tu64\t\trxbuf_map_failed;\n};\n\n \nstruct bnad_stats {\n\tstruct bnad_drv_stats drv_stats;\n\tstruct bna_stats *bna_stats;\n};\n\n \nstruct bnad_tx_res_info {\n\tstruct bna_res_info res_info[BNA_TX_RES_T_MAX];\n};\n\nstruct bnad_rx_res_info {\n\tstruct bna_res_info res_info[BNA_RX_RES_T_MAX];\n};\n\nstruct bnad_tx_info {\n\tstruct bna_tx *tx;  \n\tstruct bna_tcb *tcb[BNAD_MAX_TXQ_PER_TX];\n\tu32 tx_id;\n\tstruct delayed_work tx_cleanup_work;\n} ____cacheline_aligned;\n\nstruct bnad_rx_info {\n\tstruct bna_rx *rx;  \n\n\tstruct bnad_rx_ctrl rx_ctrl[BNAD_MAX_RXP_PER_RX];\n\tu32 rx_id;\n\tstruct work_struct rx_cleanup_work;\n} ____cacheline_aligned;\n\nstruct bnad_tx_vector {\n\tDEFINE_DMA_UNMAP_ADDR(dma_addr);\n\tDEFINE_DMA_UNMAP_LEN(dma_len);\n};\n\nstruct bnad_tx_unmap {\n\tstruct sk_buff\t\t*skb;\n\tu32\t\t\tnvecs;\n\tstruct bnad_tx_vector\tvectors[BFI_TX_MAX_VECTORS_PER_WI];\n};\n\nstruct bnad_rx_vector {\n\tDEFINE_DMA_UNMAP_ADDR(dma_addr);\n\tu32\t\t\tlen;\n};\n\nstruct bnad_rx_unmap {\n\tstruct page\t\t*page;\n\tstruct sk_buff\t\t*skb;\n\tstruct bnad_rx_vector\tvector;\n\tu32\t\t\tpage_offset;\n};\n\nenum bnad_rxbuf_type {\n\tBNAD_RXBUF_NONE\t\t= 0,\n\tBNAD_RXBUF_SK_BUFF\t= 1,\n\tBNAD_RXBUF_PAGE\t\t= 2,\n\tBNAD_RXBUF_MULTI_BUFF\t= 3\n};\n\n#define BNAD_RXBUF_IS_SK_BUFF(_type)\t((_type) == BNAD_RXBUF_SK_BUFF)\n#define BNAD_RXBUF_IS_MULTI_BUFF(_type)\t((_type) == BNAD_RXBUF_MULTI_BUFF)\n\nstruct bnad_rx_unmap_q {\n\tint\t\t\treuse_pi;\n\tint\t\t\talloc_order;\n\tu32\t\t\tmap_size;\n\tenum bnad_rxbuf_type\ttype;\n\tstruct bnad_rx_unmap\tunmap[] ____cacheline_aligned;\n};\n\n#define BNAD_PCI_DEV_IS_CAT2(_bnad) \\\n\t((_bnad)->pcidev->device == BFA_PCI_DEVICE_ID_CT2)\n\n \n#define\tBNAD_CF_DIM_ENABLED\t\t0x01\t \n#define\tBNAD_CF_PROMISC\t\t\t0x02\n#define BNAD_CF_ALLMULTI\t\t0x04\n#define\tBNAD_CF_DEFAULT\t\t\t0x08\n#define\tBNAD_CF_MSIX\t\t\t0x10\t \n\n \n \n \n#define BNAD_RF_CEE_RUNNING\t\t0\n#define BNAD_RF_MTU_SET\t\t1\n#define BNAD_RF_MBOX_IRQ_DISABLED\t2\n#define BNAD_RF_NETDEV_REGISTERED\t3\n#define BNAD_RF_DIM_TIMER_RUNNING\t4\n#define BNAD_RF_STATS_TIMER_RUNNING\t5\n#define BNAD_RF_TX_PRIO_SET\t\t6\n\nstruct bnad {\n\tstruct net_device\t*netdev;\n\tu32\t\t\tid;\n\n\t \n\tstruct bnad_tx_info tx_info[BNAD_MAX_TX];\n\tstruct bnad_rx_info rx_info[BNAD_MAX_RX];\n\n\tunsigned long active_vlans[BITS_TO_LONGS(VLAN_N_VID)];\n\t \n\tu32\t\tnum_tx;\n\tu32\t\tnum_rx;\n\tu32\t\tnum_txq_per_tx;\n\tu32\t\tnum_rxp_per_rx;\n\n\tu32\t\ttxq_depth;\n\tu32\t\trxq_depth;\n\n\tu8\t\t\ttx_coalescing_timeo;\n\tu8\t\t\trx_coalescing_timeo;\n\n\tstruct bna_rx_config rx_config[BNAD_MAX_RX] ____cacheline_aligned;\n\tstruct bna_tx_config tx_config[BNAD_MAX_TX] ____cacheline_aligned;\n\n\tvoid __iomem\t\t*bar0;\t \n\n\tstruct bna bna;\n\n\tu32\t\tcfg_flags;\n\tunsigned long\t\trun_flags;\n\n\tstruct pci_dev\t\t*pcidev;\n\tu64\t\tmmio_start;\n\tu64\t\tmmio_len;\n\n\tu32\t\tmsix_num;\n\tstruct msix_entry\t*msix_table;\n\n\tstruct mutex\t\tconf_mutex;\n\tspinlock_t\t\tbna_lock ____cacheline_aligned;\n\n\t \n\tstruct timer_list\tioc_timer;\n\tstruct timer_list\tdim_timer;\n\tstruct timer_list\tstats_timer;\n\n\t \n\tstruct bna_res_info res_info[BNA_RES_T_MAX];\n\tstruct bna_res_info mod_res_info[BNA_MOD_RES_T_MAX];\n\tstruct bnad_tx_res_info tx_res_info[BNAD_MAX_TX];\n\tstruct bnad_rx_res_info rx_res_info[BNAD_MAX_RX];\n\n\tstruct bnad_completion bnad_completions;\n\n\t \n\tu8\t\t\tperm_addr[ETH_ALEN];\n\n\tstruct workqueue_struct *work_q;\n\n\t \n\tstruct bnad_stats stats;\n\n\tstruct bnad_diag *diag;\n\n\tchar\t\t\tadapter_name[BNAD_NAME_LEN];\n\tchar\t\t\tport_name[BNAD_NAME_LEN];\n\tchar\t\t\tmbox_irq_name[BNAD_NAME_LEN];\n\tchar\t\t\twq_name[BNAD_NAME_LEN];\n\n\t \n\tchar\t*regdata;\n\tu32\treglen;\n\tstruct dentry *bnad_dentry_files[5];\n\tstruct dentry *port_debugfs_root;\n};\n\nstruct bnad_drvinfo {\n\tstruct bfa_ioc_attr  ioc_attr;\n\tstruct bfa_cee_attr  cee_attr;\n\tstruct bfa_flash_attr flash_attr;\n\tu32\tcee_status;\n\tu32\tflash_status;\n};\n\n \nextern const struct firmware *bfi_fw;\n\n \nu32 *cna_get_firmware_buf(struct pci_dev *pdev);\n \nvoid bnad_set_rx_mode(struct net_device *netdev);\nstruct net_device_stats *bnad_get_netdev_stats(struct net_device *netdev);\nint bnad_mac_addr_set_locked(struct bnad *bnad, const u8 *mac_addr);\nint bnad_enable_default_bcast(struct bnad *bnad);\nvoid bnad_restore_vlans(struct bnad *bnad, u32 rx_id);\nvoid bnad_set_ethtool_ops(struct net_device *netdev);\nvoid bnad_cb_completion(void *arg, enum bfa_status status);\n\n \nvoid bnad_tx_coalescing_timeo_set(struct bnad *bnad);\nvoid bnad_rx_coalescing_timeo_set(struct bnad *bnad);\n\nint bnad_setup_rx(struct bnad *bnad, u32 rx_id);\nint bnad_setup_tx(struct bnad *bnad, u32 tx_id);\nvoid bnad_destroy_tx(struct bnad *bnad, u32 tx_id);\nvoid bnad_destroy_rx(struct bnad *bnad, u32 rx_id);\n\n \nvoid bnad_dim_timer_start(struct bnad *bnad);\n\n \nvoid bnad_netdev_qstats_fill(struct bnad *bnad,\n\t\t\t     struct rtnl_link_stats64 *stats);\nvoid bnad_netdev_hwstats_fill(struct bnad *bnad,\n\t\t\t      struct rtnl_link_stats64 *stats);\n\n \nvoid bnad_debugfs_init(struct bnad *bnad);\nvoid bnad_debugfs_uninit(struct bnad *bnad);\n\n \n \n#define BNAD_UPDATE_CTR(_bnad, _ctr)\t\t\t\t\\\n\t\t\t\t(((_bnad)->stats.drv_stats._ctr)++)\n\n#define BNAD_GET_CTR(_bnad, _ctr) ((_bnad)->stats.drv_stats._ctr)\n\n#define bnad_enable_rx_irq_unsafe(_ccb)\t\t\t\\\n{\t\t\t\t\t\t\t\\\n\tif (likely(test_bit(BNAD_RXQ_STARTED, &(_ccb)->rcb[0]->flags))) {\\\n\t\tbna_ib_coalescing_timer_set((_ccb)->i_dbell,\t\\\n\t\t\t(_ccb)->rx_coalescing_timeo);\t\t\\\n\t\tbna_ib_ack((_ccb)->i_dbell, 0);\t\t\t\\\n\t}\t\t\t\t\t\t\t\\\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}