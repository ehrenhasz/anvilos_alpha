{
  "module_name": "qlcnic_sriov.h",
  "hash_id": "8f9bca01f84cf5884cdbc21ec1f5d7788748aef6cbdccf9747db3629d8f44f8a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/qlogic/qlcnic/qlcnic_sriov.h",
  "human_readable_source": " \n \n\n#ifndef _QLCNIC_83XX_SRIOV_H_\n#define _QLCNIC_83XX_SRIOV_H_\n\n#include <linux/types.h>\n#include <linux/pci.h>\n\n#include \"qlcnic.h\"\n\nextern const u32 qlcnic_83xx_reg_tbl[];\nextern const u32 qlcnic_83xx_ext_reg_tbl[];\n\nstruct qlcnic_bc_payload {\n\tu64 payload[126];\n};\n\nstruct qlcnic_bc_hdr {\n#if defined(__LITTLE_ENDIAN)\n\tu8\tversion;\n\tu8\tmsg_type:4;\n\tu8\trsvd1:3;\n\tu8\top_type:1;\n\tu8\tnum_cmds;\n\tu8\tnum_frags;\n\tu8\tfrag_num;\n\tu8\tcmd_op;\n\tu16\tseq_id;\n\tu64\trsvd3;\n#elif defined(__BIG_ENDIAN)\n\tu8\tnum_frags;\n\tu8\tnum_cmds;\n\tu8\top_type:1;\n\tu8\trsvd1:3;\n\tu8\tmsg_type:4;\n\tu8\tversion;\n\tu16\tseq_id;\n\tu8\tcmd_op;\n\tu8\tfrag_num;\n\tu64\trsvd3;\n#endif\n};\n\nenum qlcnic_bc_commands {\n\tQLCNIC_BC_CMD_CHANNEL_INIT = 0x0,\n\tQLCNIC_BC_CMD_CHANNEL_TERM = 0x1,\n\tQLCNIC_BC_CMD_GET_ACL = 0x2,\n\tQLCNIC_BC_CMD_CFG_GUEST_VLAN = 0x3,\n};\n\n#define QLCNIC_83XX_SRIOV_VF_MAX_MAC 2\n#define QLC_BC_CMD 1\n\nstruct qlcnic_trans_list {\n\t \n\tspinlock_t\t\tlock;\n\tstruct list_head\twait_list;\n\tint\t\t\tcount;\n};\n\nenum qlcnic_trans_state {\n\tQLC_INIT = 0,\n\tQLC_WAIT_FOR_CHANNEL_FREE,\n\tQLC_WAIT_FOR_RESP,\n\tQLC_ABORT,\n\tQLC_END,\n};\n\nstruct qlcnic_bc_trans {\n\tu8\t\t\t\tfunc_id;\n\tu8\t\t\t\tactive;\n\tu8\t\t\t\tcurr_rsp_frag;\n\tu8\t\t\t\tcurr_req_frag;\n\tu16\t\t\t\tcmd_id;\n\tu16\t\t\t\treq_pay_size;\n\tu16\t\t\t\trsp_pay_size;\n\tu32\t\t\t\ttrans_id;\n\tenum qlcnic_trans_state\t\ttrans_state;\n\tstruct list_head\t\tlist;\n\tstruct qlcnic_bc_hdr\t\t*req_hdr;\n\tstruct qlcnic_bc_hdr\t\t*rsp_hdr;\n\tstruct qlcnic_bc_payload\t*req_pay;\n\tstruct qlcnic_bc_payload\t*rsp_pay;\n\tstruct completion\t\tresp_cmpl;\n\tstruct qlcnic_vf_info\t\t*vf;\n};\n\nenum qlcnic_vf_state {\n\tQLC_BC_VF_SEND = 0,\n\tQLC_BC_VF_RECV,\n\tQLC_BC_VF_CHANNEL,\n\tQLC_BC_VF_STATE,\n\tQLC_BC_VF_FLR,\n\tQLC_BC_VF_SOFT_FLR,\n};\n\nenum qlcnic_vlan_mode {\n\tQLC_NO_VLAN_MODE = 0,\n\tQLC_PVID_MODE,\n\tQLC_GUEST_VLAN_MODE,\n};\n\nstruct qlcnic_resources {\n\tu16 num_tx_mac_filters;\n\tu16 num_rx_ucast_mac_filters;\n\tu16 num_rx_mcast_mac_filters;\n\n\tu16 num_txvlan_keys;\n\n\tu16 num_rx_queues;\n\tu16 num_tx_queues;\n\n\tu16 num_rx_buf_rings;\n\tu16 num_rx_status_rings;\n\n\tu16 num_destip;\n\tu32 num_lro_flows_supported;\n\tu16 max_local_ipv6_addrs;\n\tu16 max_remote_ipv6_addrs;\n};\n\nstruct qlcnic_vport {\n\tu16\t\t\thandle;\n\tu16\t\t\tmax_tx_bw;\n\tu16\t\t\tmin_tx_bw;\n\tu16\t\t\tpvid;\n\tu8\t\t\tvlan_mode;\n\tu8\t\t\tqos;\n\tbool\t\t\tspoofchk;\n\tu8\t\t\tmac[6];\n};\n\nstruct qlcnic_vf_info {\n\tu8\t\t\t\tpci_func;\n\tu16\t\t\t\trx_ctx_id;\n\tu16\t\t\t\ttx_ctx_id;\n\tu16\t\t\t\t*sriov_vlans;\n\tint\t\t\t\tnum_vlan;\n\tunsigned long\t\t\tstate;\n\tstruct completion\t\tch_free_cmpl;\n\tstruct work_struct\t\ttrans_work;\n\tstruct work_struct\t\tflr_work;\n\t \n\tstruct mutex\t\t\tsend_cmd_lock;\n\tstruct qlcnic_bc_trans\t\t*send_cmd;\n\tstruct qlcnic_bc_trans\t\t*flr_trans;\n\tstruct qlcnic_trans_list\trcv_act;\n\tstruct qlcnic_trans_list\trcv_pend;\n\tstruct qlcnic_adapter\t\t*adapter;\n\tstruct qlcnic_vport\t\t*vp;\n\tspinlock_t\t\t\tvlan_list_lock;\t \n};\n\nstruct qlcnic_async_cmd {\n\tstruct list_head\tlist;\n\tstruct qlcnic_cmd_args\t*cmd;\n};\n\nstruct qlcnic_back_channel {\n\tu16\t\t\ttrans_counter;\n\tstruct workqueue_struct *bc_trans_wq;\n\tstruct workqueue_struct *bc_async_wq;\n\tstruct workqueue_struct *bc_flr_wq;\n\tstruct qlcnic_adapter\t*adapter;\n\tstruct list_head\tasync_cmd_list;\n\tstruct work_struct\tvf_async_work;\n\tspinlock_t\t\tqueue_lock;  \n};\n\nstruct qlcnic_sriov {\n\tu16\t\t\t\tvp_handle;\n\tu8\t\t\t\tnum_vfs;\n\tu8\t\t\t\tany_vlan;\n\tu8\t\t\t\tvlan_mode;\n\tu16\t\t\t\tnum_allowed_vlans;\n\tu16\t\t\t\t*allowed_vlans;\n\tu16\t\t\t\tvlan;\n\tstruct qlcnic_resources\t\tff_max;\n\tstruct qlcnic_back_channel\tbc;\n\tstruct qlcnic_vf_info\t\t*vf_info;\n};\n\nint qlcnic_sriov_init(struct qlcnic_adapter *, int);\nvoid qlcnic_sriov_cleanup(struct qlcnic_adapter *);\nvoid __qlcnic_sriov_cleanup(struct qlcnic_adapter *);\nvoid qlcnic_sriov_vf_register_map(struct qlcnic_hardware_context *);\nint qlcnic_sriov_vf_init(struct qlcnic_adapter *);\nvoid qlcnic_sriov_vf_set_ops(struct qlcnic_adapter *);\nint qlcnic_sriov_func_to_index(struct qlcnic_adapter *, u8);\nvoid qlcnic_sriov_handle_bc_event(struct qlcnic_adapter *, u32);\nint qlcnic_sriov_cfg_bc_intr(struct qlcnic_adapter *, u8);\nvoid qlcnic_sriov_cleanup_async_list(struct qlcnic_back_channel *);\nvoid qlcnic_sriov_cleanup_list(struct qlcnic_trans_list *);\nint __qlcnic_sriov_add_act_list(struct qlcnic_sriov *, struct qlcnic_vf_info *,\n\t\t\t\tstruct qlcnic_bc_trans *);\nint qlcnic_sriov_get_vf_vport_info(struct qlcnic_adapter *,\n\t\t\t\t   struct qlcnic_info *, u16);\nint qlcnic_sriov_cfg_vf_guest_vlan(struct qlcnic_adapter *, u16, u8);\nvoid qlcnic_sriov_free_vlans(struct qlcnic_adapter *);\nint qlcnic_sriov_alloc_vlans(struct qlcnic_adapter *);\nbool qlcnic_sriov_check_any_vlan(struct qlcnic_vf_info *);\nvoid qlcnic_sriov_del_vlan_id(struct qlcnic_sriov *,\n\t\t\t      struct qlcnic_vf_info *, u16);\nvoid qlcnic_sriov_add_vlan_id(struct qlcnic_sriov *,\n\t\t\t      struct qlcnic_vf_info *, u16);\n\nstatic inline bool qlcnic_sriov_enable_check(struct qlcnic_adapter *adapter)\n{\n\treturn test_bit(__QLCNIC_SRIOV_ENABLE, &adapter->state) ? true : false;\n}\n\n#ifdef CONFIG_QLCNIC_SRIOV\nvoid qlcnic_sriov_pf_process_bc_cmd(struct qlcnic_adapter *,\n\t\t\t\t    struct qlcnic_bc_trans *,\n\t\t\t\t    struct qlcnic_cmd_args *);\nvoid qlcnic_sriov_pf_disable(struct qlcnic_adapter *);\nvoid qlcnic_sriov_pf_cleanup(struct qlcnic_adapter *);\nint qlcnic_pci_sriov_configure(struct pci_dev *, int);\nvoid qlcnic_pf_set_interface_id_create_rx_ctx(struct qlcnic_adapter *, u32 *);\nvoid qlcnic_pf_set_interface_id_create_tx_ctx(struct qlcnic_adapter *, u32 *);\nvoid qlcnic_pf_set_interface_id_del_rx_ctx(struct qlcnic_adapter *, u32 *);\nvoid qlcnic_pf_set_interface_id_del_tx_ctx(struct qlcnic_adapter *, u32 *);\nvoid qlcnic_pf_set_interface_id_promisc(struct qlcnic_adapter *, u32 *);\nvoid qlcnic_pf_set_interface_id_ipaddr(struct qlcnic_adapter *, u32 *);\nvoid qlcnic_pf_set_interface_id_macaddr(struct qlcnic_adapter *, u32 *);\nvoid qlcnic_sriov_pf_handle_flr(struct qlcnic_sriov *, struct qlcnic_vf_info *);\nbool qlcnic_sriov_soft_flr_check(struct qlcnic_adapter *,\n\t\t\t\t struct qlcnic_bc_trans *,\n\t\t\t\t struct qlcnic_vf_info *);\nvoid qlcnic_sriov_pf_reset(struct qlcnic_adapter *);\nint qlcnic_sriov_pf_reinit(struct qlcnic_adapter *);\nint qlcnic_sriov_set_vf_mac(struct net_device *, int, u8 *);\nint qlcnic_sriov_set_vf_tx_rate(struct net_device *, int, int, int);\nint qlcnic_sriov_get_vf_config(struct net_device *, int ,\n\t\t\t       struct ifla_vf_info *);\nint qlcnic_sriov_set_vf_vlan(struct net_device *, int, u16, u8, __be16);\nint qlcnic_sriov_set_vf_spoofchk(struct net_device *, int, bool);\n#else\nstatic inline void qlcnic_sriov_pf_disable(struct qlcnic_adapter *adapter) {}\nstatic inline void qlcnic_sriov_pf_cleanup(struct qlcnic_adapter *adapter) {}\nstatic inline void\nqlcnic_pf_set_interface_id_create_rx_ctx(struct qlcnic_adapter *adapter,\n\t\t\t\t\t u32 *int_id) {}\nstatic inline void\nqlcnic_pf_set_interface_id_create_tx_ctx(struct qlcnic_adapter *adapter,\n\t\t\t\t\t u32 *int_id) {}\nstatic inline void\nqlcnic_pf_set_interface_id_del_rx_ctx(struct qlcnic_adapter *adapter,\n\t\t\t\t      u32 *int_id) {}\nstatic inline void\nqlcnic_pf_set_interface_id_del_tx_ctx(struct qlcnic_adapter *adapter,\n\t\t\t\t      u32 *int_id) {}\nstatic inline void\nqlcnic_pf_set_interface_id_ipaddr(struct qlcnic_adapter *adapter, u32 *int_id)\n{}\nstatic inline void\nqlcnic_pf_set_interface_id_macaddr(struct qlcnic_adapter *adapter, u32 *int_id)\n{}\nstatic inline void\nqlcnic_pf_set_interface_id_promisc(struct qlcnic_adapter *adapter, u32 *int_id)\n{}\nstatic inline void qlcnic_sriov_pf_handle_flr(struct qlcnic_sriov *sriov,\n\t\t\t\t\t      struct qlcnic_vf_info *vf) {}\nstatic inline bool qlcnic_sriov_soft_flr_check(struct qlcnic_adapter *adapter,\n\t\t\t\t\t       struct qlcnic_bc_trans *trans,\n\t\t\t\t\t       struct qlcnic_vf_info *vf)\n{ return false; }\nstatic inline void qlcnic_sriov_pf_reset(struct qlcnic_adapter *adapter) {}\nstatic inline int qlcnic_sriov_pf_reinit(struct qlcnic_adapter *adapter)\n{ return 0; }\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}