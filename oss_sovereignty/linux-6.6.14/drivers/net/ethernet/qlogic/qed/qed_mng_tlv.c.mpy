{
  "module_name": "qed_mng_tlv.c",
  "hash_id": "9593da90c0151487f1a40895e7104d50a0f72885dff7577616ed815c554ea864",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/qlogic/qed/qed_mng_tlv.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <asm/byteorder.h>\n#include <linux/bug.h>\n#include <linux/errno.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/vmalloc.h>\n#include \"qed.h\"\n#include \"qed_hw.h\"\n#include \"qed_mcp.h\"\n#include \"qed_reg_addr.h\"\n\n#define TLV_TYPE(p)     (p[0])\n#define TLV_LENGTH(p)   (p[1])\n#define TLV_FLAGS(p)    (p[3])\n\n#define QED_TLV_DATA_MAX (14)\nstruct qed_tlv_parsed_buf {\n\t \n\tvoid *p_val;\n\n\t \n\tu8 data[QED_TLV_DATA_MAX];\n};\n\nstatic int qed_mfw_get_tlv_group(u8 tlv_type, u8 *tlv_group)\n{\n\tswitch (tlv_type) {\n\tcase DRV_TLV_FEATURE_FLAGS:\n\tcase DRV_TLV_LOCAL_ADMIN_ADDR:\n\tcase DRV_TLV_ADDITIONAL_MAC_ADDR_1:\n\tcase DRV_TLV_ADDITIONAL_MAC_ADDR_2:\n\tcase DRV_TLV_OS_DRIVER_STATES:\n\tcase DRV_TLV_PXE_BOOT_PROGRESS:\n\tcase DRV_TLV_RX_FRAMES_RECEIVED:\n\tcase DRV_TLV_RX_BYTES_RECEIVED:\n\tcase DRV_TLV_TX_FRAMES_SENT:\n\tcase DRV_TLV_TX_BYTES_SENT:\n\tcase DRV_TLV_NPIV_ENABLED:\n\tcase DRV_TLV_PCIE_BUS_RX_UTILIZATION:\n\tcase DRV_TLV_PCIE_BUS_TX_UTILIZATION:\n\tcase DRV_TLV_DEVICE_CPU_CORES_UTILIZATION:\n\tcase DRV_TLV_LAST_VALID_DCC_TLV_RECEIVED:\n\tcase DRV_TLV_NCSI_RX_BYTES_RECEIVED:\n\tcase DRV_TLV_NCSI_TX_BYTES_SENT:\n\t\t*tlv_group |= QED_MFW_TLV_GENERIC;\n\t\tbreak;\n\tcase DRV_TLV_LSO_MAX_OFFLOAD_SIZE:\n\tcase DRV_TLV_LSO_MIN_SEGMENT_COUNT:\n\tcase DRV_TLV_PROMISCUOUS_MODE:\n\tcase DRV_TLV_TX_DESCRIPTORS_QUEUE_SIZE:\n\tcase DRV_TLV_RX_DESCRIPTORS_QUEUE_SIZE:\n\tcase DRV_TLV_NUM_OF_NET_QUEUE_VMQ_CFG:\n\tcase DRV_TLV_NUM_OFFLOADED_CONNECTIONS_TCP_IPV4:\n\tcase DRV_TLV_NUM_OFFLOADED_CONNECTIONS_TCP_IPV6:\n\tcase DRV_TLV_TX_DESCRIPTOR_QUEUE_AVG_DEPTH:\n\tcase DRV_TLV_RX_DESCRIPTORS_QUEUE_AVG_DEPTH:\n\tcase DRV_TLV_IOV_OFFLOAD:\n\tcase DRV_TLV_TX_QUEUES_EMPTY:\n\tcase DRV_TLV_RX_QUEUES_EMPTY:\n\tcase DRV_TLV_TX_QUEUES_FULL:\n\tcase DRV_TLV_RX_QUEUES_FULL:\n\t\t*tlv_group |= QED_MFW_TLV_ETH;\n\t\tbreak;\n\tcase DRV_TLV_SCSI_TO:\n\tcase DRV_TLV_R_T_TOV:\n\tcase DRV_TLV_R_A_TOV:\n\tcase DRV_TLV_E_D_TOV:\n\tcase DRV_TLV_CR_TOV:\n\tcase DRV_TLV_BOOT_TYPE:\n\tcase DRV_TLV_NPIV_STATE:\n\tcase DRV_TLV_NUM_OF_NPIV_IDS:\n\tcase DRV_TLV_SWITCH_NAME:\n\tcase DRV_TLV_SWITCH_PORT_NUM:\n\tcase DRV_TLV_SWITCH_PORT_ID:\n\tcase DRV_TLV_VENDOR_NAME:\n\tcase DRV_TLV_SWITCH_MODEL:\n\tcase DRV_TLV_SWITCH_FW_VER:\n\tcase DRV_TLV_QOS_PRIORITY_PER_802_1P:\n\tcase DRV_TLV_PORT_ALIAS:\n\tcase DRV_TLV_PORT_STATE:\n\tcase DRV_TLV_FIP_TX_DESCRIPTORS_QUEUE_SIZE:\n\tcase DRV_TLV_FCOE_RX_DESCRIPTORS_QUEUE_SIZE:\n\tcase DRV_TLV_LINK_FAILURE_COUNT:\n\tcase DRV_TLV_FCOE_BOOT_PROGRESS:\n\tcase DRV_TLV_RX_BROADCAST_PACKETS:\n\tcase DRV_TLV_TX_BROADCAST_PACKETS:\n\tcase DRV_TLV_FCOE_TX_DESCRIPTOR_QUEUE_AVG_DEPTH:\n\tcase DRV_TLV_FCOE_RX_DESCRIPTORS_QUEUE_AVG_DEPTH:\n\tcase DRV_TLV_FCOE_RX_FRAMES_RECEIVED:\n\tcase DRV_TLV_FCOE_RX_BYTES_RECEIVED:\n\tcase DRV_TLV_FCOE_TX_FRAMES_SENT:\n\tcase DRV_TLV_FCOE_TX_BYTES_SENT:\n\tcase DRV_TLV_CRC_ERROR_COUNT:\n\tcase DRV_TLV_CRC_ERROR_1_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_1_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_2_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_2_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_3_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_3_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_4_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_4_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_5_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_5_TIMESTAMP:\n\tcase DRV_TLV_LOSS_OF_SYNC_ERROR_COUNT:\n\tcase DRV_TLV_LOSS_OF_SIGNAL_ERRORS:\n\tcase DRV_TLV_PRIMITIVE_SEQUENCE_PROTOCOL_ERROR_COUNT:\n\tcase DRV_TLV_DISPARITY_ERROR_COUNT:\n\tcase DRV_TLV_CODE_VIOLATION_ERROR_COUNT:\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_1:\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_2:\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_3:\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_4:\n\tcase DRV_TLV_LAST_FLOGI_TIMESTAMP:\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_1:\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_2:\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_3:\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_4:\n\tcase DRV_TLV_LAST_FLOGI_ACC_TIMESTAMP:\n\tcase DRV_TLV_LAST_FLOGI_RJT:\n\tcase DRV_TLV_LAST_FLOGI_RJT_TIMESTAMP:\n\tcase DRV_TLV_FDISCS_SENT_COUNT:\n\tcase DRV_TLV_FDISC_ACCS_RECEIVED:\n\tcase DRV_TLV_FDISC_RJTS_RECEIVED:\n\tcase DRV_TLV_PLOGI_SENT_COUNT:\n\tcase DRV_TLV_PLOGI_ACCS_RECEIVED:\n\tcase DRV_TLV_PLOGI_RJTS_RECEIVED:\n\tcase DRV_TLV_PLOGI_1_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_1_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_2_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_2_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_3_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_3_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_4_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_4_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_5_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_5_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_1_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_1_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_2_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_2_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_3_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_3_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_4_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_4_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_5_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_5_ACC_TIMESTAMP:\n\tcase DRV_TLV_LOGOS_ISSUED:\n\tcase DRV_TLV_LOGO_ACCS_RECEIVED:\n\tcase DRV_TLV_LOGO_RJTS_RECEIVED:\n\tcase DRV_TLV_LOGO_1_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_1_TIMESTAMP:\n\tcase DRV_TLV_LOGO_2_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_2_TIMESTAMP:\n\tcase DRV_TLV_LOGO_3_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_3_TIMESTAMP:\n\tcase DRV_TLV_LOGO_4_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_4_TIMESTAMP:\n\tcase DRV_TLV_LOGO_5_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_5_TIMESTAMP:\n\tcase DRV_TLV_LOGOS_RECEIVED:\n\tcase DRV_TLV_ACCS_ISSUED:\n\tcase DRV_TLV_PRLIS_ISSUED:\n\tcase DRV_TLV_ACCS_RECEIVED:\n\tcase DRV_TLV_ABTS_SENT_COUNT:\n\tcase DRV_TLV_ABTS_ACCS_RECEIVED:\n\tcase DRV_TLV_ABTS_RJTS_RECEIVED:\n\tcase DRV_TLV_ABTS_1_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_1_TIMESTAMP:\n\tcase DRV_TLV_ABTS_2_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_2_TIMESTAMP:\n\tcase DRV_TLV_ABTS_3_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_3_TIMESTAMP:\n\tcase DRV_TLV_ABTS_4_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_4_TIMESTAMP:\n\tcase DRV_TLV_ABTS_5_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_5_TIMESTAMP:\n\tcase DRV_TLV_RSCNS_RECEIVED:\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_1:\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_2:\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_3:\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_4:\n\tcase DRV_TLV_LUN_RESETS_ISSUED:\n\tcase DRV_TLV_ABORT_TASK_SETS_ISSUED:\n\tcase DRV_TLV_TPRLOS_SENT:\n\tcase DRV_TLV_NOS_SENT_COUNT:\n\tcase DRV_TLV_NOS_RECEIVED_COUNT:\n\tcase DRV_TLV_OLS_COUNT:\n\tcase DRV_TLV_LR_COUNT:\n\tcase DRV_TLV_LRR_COUNT:\n\tcase DRV_TLV_LIP_SENT_COUNT:\n\tcase DRV_TLV_LIP_RECEIVED_COUNT:\n\tcase DRV_TLV_EOFA_COUNT:\n\tcase DRV_TLV_EOFNI_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_CHECK_CONDITION_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_CONDITION_MET_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_BUSY_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_INTERMEDIATE_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_INTERMEDIATE_CONDITION_MET_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_RESERVATION_CONFLICT_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_TASK_SET_FULL_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_ACA_ACTIVE_COUNT:\n\tcase DRV_TLV_SCSI_STATUS_TASK_ABORTED_COUNT:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_1_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_1_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_2_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_2_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_3_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_3_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_4_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_4_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_5_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_5_TIMESTAMP:\n\t\t*tlv_group = QED_MFW_TLV_FCOE;\n\t\tbreak;\n\tcase DRV_TLV_TARGET_LLMNR_ENABLED:\n\tcase DRV_TLV_HEADER_DIGEST_FLAG_ENABLED:\n\tcase DRV_TLV_DATA_DIGEST_FLAG_ENABLED:\n\tcase DRV_TLV_AUTHENTICATION_METHOD:\n\tcase DRV_TLV_ISCSI_BOOT_TARGET_PORTAL:\n\tcase DRV_TLV_MAX_FRAME_SIZE:\n\tcase DRV_TLV_PDU_TX_DESCRIPTORS_QUEUE_SIZE:\n\tcase DRV_TLV_PDU_RX_DESCRIPTORS_QUEUE_SIZE:\n\tcase DRV_TLV_ISCSI_BOOT_PROGRESS:\n\tcase DRV_TLV_PDU_TX_DESCRIPTOR_QUEUE_AVG_DEPTH:\n\tcase DRV_TLV_PDU_RX_DESCRIPTORS_QUEUE_AVG_DEPTH:\n\tcase DRV_TLV_ISCSI_PDU_RX_FRAMES_RECEIVED:\n\tcase DRV_TLV_ISCSI_PDU_RX_BYTES_RECEIVED:\n\tcase DRV_TLV_ISCSI_PDU_TX_FRAMES_SENT:\n\tcase DRV_TLV_ISCSI_PDU_TX_BYTES_SENT:\n\t\t*tlv_group |= QED_MFW_TLV_ISCSI;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int\nqed_mfw_get_gen_tlv_value(struct qed_drv_tlv_hdr *p_tlv,\n\t\t\t  struct qed_mfw_tlv_generic *p_drv_buf,\n\t\t\t  struct qed_tlv_parsed_buf *p_buf)\n{\n\tswitch (p_tlv->tlv_type) {\n\tcase DRV_TLV_FEATURE_FLAGS:\n\t\tif (p_drv_buf->flags.b_set) {\n\t\t\tmemset(p_buf->data, 0, sizeof(u8) * QED_TLV_DATA_MAX);\n\t\t\tp_buf->data[0] = p_drv_buf->flags.ipv4_csum_offload ?\n\t\t\t    1 : 0;\n\t\t\tp_buf->data[0] |= (p_drv_buf->flags.lso_supported ?\n\t\t\t\t\t   1 : 0) << 1;\n\t\t\tp_buf->p_val = p_buf->data;\n\t\t\treturn QED_MFW_TLV_FLAGS_SIZE;\n\t\t}\n\t\tbreak;\n\n\tcase DRV_TLV_LOCAL_ADMIN_ADDR:\n\tcase DRV_TLV_ADDITIONAL_MAC_ADDR_1:\n\tcase DRV_TLV_ADDITIONAL_MAC_ADDR_2:\n\t\t{\n\t\t\tint idx = p_tlv->tlv_type - DRV_TLV_LOCAL_ADMIN_ADDR;\n\n\t\t\tif (p_drv_buf->mac_set[idx]) {\n\t\t\t\tp_buf->p_val = p_drv_buf->mac[idx];\n\t\t\t\treturn ETH_ALEN;\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\n\tcase DRV_TLV_RX_FRAMES_RECEIVED:\n\t\tif (p_drv_buf->rx_frames_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_frames;\n\t\t\treturn sizeof(p_drv_buf->rx_frames);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_RX_BYTES_RECEIVED:\n\t\tif (p_drv_buf->rx_bytes_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_bytes;\n\t\t\treturn sizeof(p_drv_buf->rx_bytes);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TX_FRAMES_SENT:\n\t\tif (p_drv_buf->tx_frames_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_frames;\n\t\t\treturn sizeof(p_drv_buf->tx_frames);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TX_BYTES_SENT:\n\t\tif (p_drv_buf->tx_bytes_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_bytes;\n\t\t\treturn sizeof(p_drv_buf->tx_bytes);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn -1;\n}\n\nstatic int\nqed_mfw_get_eth_tlv_value(struct qed_drv_tlv_hdr *p_tlv,\n\t\t\t  struct qed_mfw_tlv_eth *p_drv_buf,\n\t\t\t  struct qed_tlv_parsed_buf *p_buf)\n{\n\tswitch (p_tlv->tlv_type) {\n\tcase DRV_TLV_LSO_MAX_OFFLOAD_SIZE:\n\t\tif (p_drv_buf->lso_maxoff_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->lso_maxoff_size;\n\t\t\treturn sizeof(p_drv_buf->lso_maxoff_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LSO_MIN_SEGMENT_COUNT:\n\t\tif (p_drv_buf->lso_minseg_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->lso_minseg_size;\n\t\t\treturn sizeof(p_drv_buf->lso_minseg_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PROMISCUOUS_MODE:\n\t\tif (p_drv_buf->prom_mode_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->prom_mode;\n\t\t\treturn sizeof(p_drv_buf->prom_mode);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TX_DESCRIPTORS_QUEUE_SIZE:\n\t\tif (p_drv_buf->tx_descr_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_descr_size;\n\t\t\treturn sizeof(p_drv_buf->tx_descr_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_RX_DESCRIPTORS_QUEUE_SIZE:\n\t\tif (p_drv_buf->rx_descr_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_descr_size;\n\t\t\treturn sizeof(p_drv_buf->rx_descr_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_NUM_OF_NET_QUEUE_VMQ_CFG:\n\t\tif (p_drv_buf->netq_count_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->netq_count;\n\t\t\treturn sizeof(p_drv_buf->netq_count);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_NUM_OFFLOADED_CONNECTIONS_TCP_IPV4:\n\t\tif (p_drv_buf->tcp4_offloads_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tcp4_offloads;\n\t\t\treturn sizeof(p_drv_buf->tcp4_offloads);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_NUM_OFFLOADED_CONNECTIONS_TCP_IPV6:\n\t\tif (p_drv_buf->tcp6_offloads_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tcp6_offloads;\n\t\t\treturn sizeof(p_drv_buf->tcp6_offloads);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TX_DESCRIPTOR_QUEUE_AVG_DEPTH:\n\t\tif (p_drv_buf->tx_descr_qdepth_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_descr_qdepth;\n\t\t\treturn sizeof(p_drv_buf->tx_descr_qdepth);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_RX_DESCRIPTORS_QUEUE_AVG_DEPTH:\n\t\tif (p_drv_buf->rx_descr_qdepth_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_descr_qdepth;\n\t\t\treturn sizeof(p_drv_buf->rx_descr_qdepth);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_IOV_OFFLOAD:\n\t\tif (p_drv_buf->iov_offload_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->iov_offload;\n\t\t\treturn sizeof(p_drv_buf->iov_offload);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TX_QUEUES_EMPTY:\n\t\tif (p_drv_buf->txqs_empty_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->txqs_empty;\n\t\t\treturn sizeof(p_drv_buf->txqs_empty);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_RX_QUEUES_EMPTY:\n\t\tif (p_drv_buf->rxqs_empty_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rxqs_empty;\n\t\t\treturn sizeof(p_drv_buf->rxqs_empty);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TX_QUEUES_FULL:\n\t\tif (p_drv_buf->num_txqs_full_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->num_txqs_full;\n\t\t\treturn sizeof(p_drv_buf->num_txqs_full);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_RX_QUEUES_FULL:\n\t\tif (p_drv_buf->num_rxqs_full_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->num_rxqs_full;\n\t\t\treturn sizeof(p_drv_buf->num_rxqs_full);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn -1;\n}\n\nstatic int\nqed_mfw_get_tlv_time_value(struct qed_mfw_tlv_time *p_time,\n\t\t\t   struct qed_tlv_parsed_buf *p_buf)\n{\n\tif (!p_time->b_set)\n\t\treturn -1;\n\n\t \n\tif (p_time->month > 12)\n\t\tp_time->month = 0;\n\tif (p_time->day > 31)\n\t\tp_time->day = 0;\n\tif (p_time->hour > 23)\n\t\tp_time->hour = 0;\n\tif (p_time->min > 59)\n\t\tp_time->min = 0;\n\tif (p_time->msec > 999)\n\t\tp_time->msec = 0;\n\tif (p_time->usec > 999)\n\t\tp_time->usec = 0;\n\n\tmemset(p_buf->data, 0, sizeof(u8) * QED_TLV_DATA_MAX);\n\tsnprintf(p_buf->data, 14, \"%d%d%d%d%d%d\",\n\t\t p_time->month, p_time->day,\n\t\t p_time->hour, p_time->min, p_time->msec, p_time->usec);\n\n\tp_buf->p_val = p_buf->data;\n\n\treturn QED_MFW_TLV_TIME_SIZE;\n}\n\nstatic int\nqed_mfw_get_fcoe_tlv_value(struct qed_drv_tlv_hdr *p_tlv,\n\t\t\t   struct qed_mfw_tlv_fcoe *p_drv_buf,\n\t\t\t   struct qed_tlv_parsed_buf *p_buf)\n{\n\tstruct qed_mfw_tlv_time *p_time;\n\tu8 idx;\n\n\tswitch (p_tlv->tlv_type) {\n\tcase DRV_TLV_SCSI_TO:\n\t\tif (p_drv_buf->scsi_timeout_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_timeout;\n\t\t\treturn sizeof(p_drv_buf->scsi_timeout);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_R_T_TOV:\n\t\tif (p_drv_buf->rt_tov_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rt_tov;\n\t\t\treturn sizeof(p_drv_buf->rt_tov);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_R_A_TOV:\n\t\tif (p_drv_buf->ra_tov_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->ra_tov;\n\t\t\treturn sizeof(p_drv_buf->ra_tov);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_E_D_TOV:\n\t\tif (p_drv_buf->ed_tov_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->ed_tov;\n\t\t\treturn sizeof(p_drv_buf->ed_tov);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_CR_TOV:\n\t\tif (p_drv_buf->cr_tov_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->cr_tov;\n\t\t\treturn sizeof(p_drv_buf->cr_tov);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_BOOT_TYPE:\n\t\tif (p_drv_buf->boot_type_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->boot_type;\n\t\t\treturn sizeof(p_drv_buf->boot_type);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_NPIV_STATE:\n\t\tif (p_drv_buf->npiv_state_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->npiv_state;\n\t\t\treturn sizeof(p_drv_buf->npiv_state);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_NUM_OF_NPIV_IDS:\n\t\tif (p_drv_buf->num_npiv_ids_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->num_npiv_ids;\n\t\t\treturn sizeof(p_drv_buf->num_npiv_ids);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SWITCH_NAME:\n\t\tif (p_drv_buf->switch_name_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->switch_name;\n\t\t\treturn sizeof(p_drv_buf->switch_name);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SWITCH_PORT_NUM:\n\t\tif (p_drv_buf->switch_portnum_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->switch_portnum;\n\t\t\treturn sizeof(p_drv_buf->switch_portnum);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SWITCH_PORT_ID:\n\t\tif (p_drv_buf->switch_portid_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->switch_portid;\n\t\t\treturn sizeof(p_drv_buf->switch_portid);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_VENDOR_NAME:\n\t\tif (p_drv_buf->vendor_name_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->vendor_name;\n\t\t\treturn sizeof(p_drv_buf->vendor_name);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SWITCH_MODEL:\n\t\tif (p_drv_buf->switch_model_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->switch_model;\n\t\t\treturn sizeof(p_drv_buf->switch_model);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SWITCH_FW_VER:\n\t\tif (p_drv_buf->switch_fw_version_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->switch_fw_version;\n\t\t\treturn sizeof(p_drv_buf->switch_fw_version);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_QOS_PRIORITY_PER_802_1P:\n\t\tif (p_drv_buf->qos_pri_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->qos_pri;\n\t\t\treturn sizeof(p_drv_buf->qos_pri);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PORT_ALIAS:\n\t\tif (p_drv_buf->port_alias_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->port_alias;\n\t\t\treturn sizeof(p_drv_buf->port_alias);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PORT_STATE:\n\t\tif (p_drv_buf->port_state_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->port_state;\n\t\t\treturn sizeof(p_drv_buf->port_state);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FIP_TX_DESCRIPTORS_QUEUE_SIZE:\n\t\tif (p_drv_buf->fip_tx_descr_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fip_tx_descr_size;\n\t\t\treturn sizeof(p_drv_buf->fip_tx_descr_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_RX_DESCRIPTORS_QUEUE_SIZE:\n\t\tif (p_drv_buf->fip_rx_descr_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fip_rx_descr_size;\n\t\t\treturn sizeof(p_drv_buf->fip_rx_descr_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LINK_FAILURE_COUNT:\n\t\tif (p_drv_buf->link_failures_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->link_failures;\n\t\t\treturn sizeof(p_drv_buf->link_failures);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_BOOT_PROGRESS:\n\t\tif (p_drv_buf->fcoe_boot_progress_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fcoe_boot_progress;\n\t\t\treturn sizeof(p_drv_buf->fcoe_boot_progress);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_RX_BROADCAST_PACKETS:\n\t\tif (p_drv_buf->rx_bcast_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_bcast;\n\t\t\treturn sizeof(p_drv_buf->rx_bcast);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TX_BROADCAST_PACKETS:\n\t\tif (p_drv_buf->tx_bcast_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_bcast;\n\t\t\treturn sizeof(p_drv_buf->tx_bcast);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_TX_DESCRIPTOR_QUEUE_AVG_DEPTH:\n\t\tif (p_drv_buf->fcoe_txq_depth_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fcoe_txq_depth;\n\t\t\treturn sizeof(p_drv_buf->fcoe_txq_depth);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_RX_DESCRIPTORS_QUEUE_AVG_DEPTH:\n\t\tif (p_drv_buf->fcoe_rxq_depth_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fcoe_rxq_depth;\n\t\t\treturn sizeof(p_drv_buf->fcoe_rxq_depth);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_RX_FRAMES_RECEIVED:\n\t\tif (p_drv_buf->fcoe_rx_frames_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fcoe_rx_frames;\n\t\t\treturn sizeof(p_drv_buf->fcoe_rx_frames);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_RX_BYTES_RECEIVED:\n\t\tif (p_drv_buf->fcoe_rx_bytes_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fcoe_rx_bytes;\n\t\t\treturn sizeof(p_drv_buf->fcoe_rx_bytes);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_TX_FRAMES_SENT:\n\t\tif (p_drv_buf->fcoe_tx_frames_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fcoe_tx_frames;\n\t\t\treturn sizeof(p_drv_buf->fcoe_tx_frames);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FCOE_TX_BYTES_SENT:\n\t\tif (p_drv_buf->fcoe_tx_bytes_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fcoe_tx_bytes;\n\t\t\treturn sizeof(p_drv_buf->fcoe_tx_bytes);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_CRC_ERROR_COUNT:\n\t\tif (p_drv_buf->crc_count_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->crc_count;\n\t\t\treturn sizeof(p_drv_buf->crc_count);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_CRC_ERROR_1_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_2_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_3_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_4_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_CRC_ERROR_5_RECEIVED_SOURCE_FC_ID:\n\t\tidx = (p_tlv->tlv_type -\n\t\t       DRV_TLV_CRC_ERROR_1_RECEIVED_SOURCE_FC_ID) / 2;\n\n\t\tif (p_drv_buf->crc_err_src_fcid_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->crc_err_src_fcid[idx];\n\t\t\treturn sizeof(p_drv_buf->crc_err_src_fcid[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_CRC_ERROR_1_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_2_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_3_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_4_TIMESTAMP:\n\tcase DRV_TLV_CRC_ERROR_5_TIMESTAMP:\n\t\tidx = (p_tlv->tlv_type - DRV_TLV_CRC_ERROR_1_TIMESTAMP) / 2;\n\n\t\treturn qed_mfw_get_tlv_time_value(&p_drv_buf->crc_err[idx],\n\t\t\t\t\t\t  p_buf);\n\tcase DRV_TLV_LOSS_OF_SYNC_ERROR_COUNT:\n\t\tif (p_drv_buf->losync_err_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->losync_err;\n\t\t\treturn sizeof(p_drv_buf->losync_err);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LOSS_OF_SIGNAL_ERRORS:\n\t\tif (p_drv_buf->losig_err_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->losig_err;\n\t\t\treturn sizeof(p_drv_buf->losig_err);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PRIMITIVE_SEQUENCE_PROTOCOL_ERROR_COUNT:\n\t\tif (p_drv_buf->primtive_err_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->primtive_err;\n\t\t\treturn sizeof(p_drv_buf->primtive_err);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_DISPARITY_ERROR_COUNT:\n\t\tif (p_drv_buf->disparity_err_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->disparity_err;\n\t\t\treturn sizeof(p_drv_buf->disparity_err);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_CODE_VIOLATION_ERROR_COUNT:\n\t\tif (p_drv_buf->code_violation_err_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->code_violation_err;\n\t\t\treturn sizeof(p_drv_buf->code_violation_err);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_1:\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_2:\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_3:\n\tcase DRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_4:\n\t\tidx = p_tlv->tlv_type -\n\t\t\tDRV_TLV_LAST_FLOGI_ISSUED_COMMON_PARAMETERS_WORD_1;\n\t\tif (p_drv_buf->flogi_param_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->flogi_param[idx];\n\t\t\treturn sizeof(p_drv_buf->flogi_param[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LAST_FLOGI_TIMESTAMP:\n\t\treturn qed_mfw_get_tlv_time_value(&p_drv_buf->flogi_tstamp,\n\t\t\t\t\t\t  p_buf);\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_1:\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_2:\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_3:\n\tcase DRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_4:\n\t\tidx = p_tlv->tlv_type -\n\t\t\tDRV_TLV_LAST_FLOGI_ACC_COMMON_PARAMETERS_WORD_1;\n\n\t\tif (p_drv_buf->flogi_acc_param_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->flogi_acc_param[idx];\n\t\t\treturn sizeof(p_drv_buf->flogi_acc_param[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LAST_FLOGI_ACC_TIMESTAMP:\n\t\treturn qed_mfw_get_tlv_time_value(&p_drv_buf->flogi_acc_tstamp,\n\t\t\t\t\t\t  p_buf);\n\tcase DRV_TLV_LAST_FLOGI_RJT:\n\t\tif (p_drv_buf->flogi_rjt_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->flogi_rjt;\n\t\t\treturn sizeof(p_drv_buf->flogi_rjt);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LAST_FLOGI_RJT_TIMESTAMP:\n\t\treturn qed_mfw_get_tlv_time_value(&p_drv_buf->flogi_rjt_tstamp,\n\t\t\t\t\t\t  p_buf);\n\tcase DRV_TLV_FDISCS_SENT_COUNT:\n\t\tif (p_drv_buf->fdiscs_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fdiscs;\n\t\t\treturn sizeof(p_drv_buf->fdiscs);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FDISC_ACCS_RECEIVED:\n\t\tif (p_drv_buf->fdisc_acc_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fdisc_acc;\n\t\t\treturn sizeof(p_drv_buf->fdisc_acc);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_FDISC_RJTS_RECEIVED:\n\t\tif (p_drv_buf->fdisc_rjt_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->fdisc_rjt;\n\t\t\treturn sizeof(p_drv_buf->fdisc_rjt);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PLOGI_SENT_COUNT:\n\t\tif (p_drv_buf->plogi_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogi;\n\t\t\treturn sizeof(p_drv_buf->plogi);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PLOGI_ACCS_RECEIVED:\n\t\tif (p_drv_buf->plogi_acc_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogi_acc;\n\t\t\treturn sizeof(p_drv_buf->plogi_acc);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PLOGI_RJTS_RECEIVED:\n\t\tif (p_drv_buf->plogi_rjt_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogi_rjt;\n\t\t\treturn sizeof(p_drv_buf->plogi_rjt);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PLOGI_1_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_2_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_3_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_4_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_PLOGI_5_SENT_DESTINATION_FC_ID:\n\t\tidx = (p_tlv->tlv_type -\n\t\t       DRV_TLV_PLOGI_1_SENT_DESTINATION_FC_ID) / 2;\n\n\t\tif (p_drv_buf->plogi_dst_fcid_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogi_dst_fcid[idx];\n\t\t\treturn sizeof(p_drv_buf->plogi_dst_fcid[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PLOGI_1_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_2_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_3_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_4_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_5_TIMESTAMP:\n\t\tidx = (p_tlv->tlv_type - DRV_TLV_PLOGI_1_TIMESTAMP) / 2;\n\n\t\treturn qed_mfw_get_tlv_time_value(&p_drv_buf->plogi_tstamp[idx],\n\t\t\t\t\t\t  p_buf);\n\tcase DRV_TLV_PLOGI_1_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_2_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_3_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_4_ACC_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_PLOGI_5_ACC_RECEIVED_SOURCE_FC_ID:\n\t\tidx = (p_tlv->tlv_type -\n\t\t       DRV_TLV_PLOGI_1_ACC_RECEIVED_SOURCE_FC_ID) / 2;\n\n\t\tif (p_drv_buf->plogi_acc_src_fcid_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogi_acc_src_fcid[idx];\n\t\t\treturn sizeof(p_drv_buf->plogi_acc_src_fcid[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PLOGI_1_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_2_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_3_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_4_ACC_TIMESTAMP:\n\tcase DRV_TLV_PLOGI_5_ACC_TIMESTAMP:\n\t\tidx = (p_tlv->tlv_type - DRV_TLV_PLOGI_1_ACC_TIMESTAMP) / 2;\n\t\tp_time = &p_drv_buf->plogi_acc_tstamp[idx];\n\n\t\treturn qed_mfw_get_tlv_time_value(p_time, p_buf);\n\tcase DRV_TLV_LOGOS_ISSUED:\n\t\tif (p_drv_buf->tx_plogos_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_plogos;\n\t\t\treturn sizeof(p_drv_buf->tx_plogos);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LOGO_ACCS_RECEIVED:\n\t\tif (p_drv_buf->plogo_acc_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogo_acc;\n\t\t\treturn sizeof(p_drv_buf->plogo_acc);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LOGO_RJTS_RECEIVED:\n\t\tif (p_drv_buf->plogo_rjt_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogo_rjt;\n\t\t\treturn sizeof(p_drv_buf->plogo_rjt);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LOGO_1_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_2_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_3_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_4_RECEIVED_SOURCE_FC_ID:\n\tcase DRV_TLV_LOGO_5_RECEIVED_SOURCE_FC_ID:\n\t\tidx = (p_tlv->tlv_type - DRV_TLV_LOGO_1_RECEIVED_SOURCE_FC_ID) /\n\t\t\t2;\n\n\t\tif (p_drv_buf->plogo_src_fcid_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->plogo_src_fcid[idx];\n\t\t\treturn sizeof(p_drv_buf->plogo_src_fcid[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LOGO_1_TIMESTAMP:\n\tcase DRV_TLV_LOGO_2_TIMESTAMP:\n\tcase DRV_TLV_LOGO_3_TIMESTAMP:\n\tcase DRV_TLV_LOGO_4_TIMESTAMP:\n\tcase DRV_TLV_LOGO_5_TIMESTAMP:\n\t\tidx = (p_tlv->tlv_type - DRV_TLV_LOGO_1_TIMESTAMP) / 2;\n\n\t\treturn qed_mfw_get_tlv_time_value(&p_drv_buf->plogo_tstamp[idx],\n\t\t\t\t\t\t  p_buf);\n\tcase DRV_TLV_LOGOS_RECEIVED:\n\t\tif (p_drv_buf->rx_logos_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_logos;\n\t\t\treturn sizeof(p_drv_buf->rx_logos);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ACCS_ISSUED:\n\t\tif (p_drv_buf->tx_accs_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_accs;\n\t\t\treturn sizeof(p_drv_buf->tx_accs);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PRLIS_ISSUED:\n\t\tif (p_drv_buf->tx_prlis_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_prlis;\n\t\t\treturn sizeof(p_drv_buf->tx_prlis);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ACCS_RECEIVED:\n\t\tif (p_drv_buf->rx_accs_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_accs;\n\t\t\treturn sizeof(p_drv_buf->rx_accs);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ABTS_SENT_COUNT:\n\t\tif (p_drv_buf->tx_abts_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_abts;\n\t\t\treturn sizeof(p_drv_buf->tx_abts);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ABTS_ACCS_RECEIVED:\n\t\tif (p_drv_buf->rx_abts_acc_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_abts_acc;\n\t\t\treturn sizeof(p_drv_buf->rx_abts_acc);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ABTS_RJTS_RECEIVED:\n\t\tif (p_drv_buf->rx_abts_rjt_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_abts_rjt;\n\t\t\treturn sizeof(p_drv_buf->rx_abts_rjt);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ABTS_1_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_2_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_3_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_4_SENT_DESTINATION_FC_ID:\n\tcase DRV_TLV_ABTS_5_SENT_DESTINATION_FC_ID:\n\t\tidx = (p_tlv->tlv_type -\n\t\t       DRV_TLV_ABTS_1_SENT_DESTINATION_FC_ID) / 2;\n\n\t\tif (p_drv_buf->abts_dst_fcid_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->abts_dst_fcid[idx];\n\t\t\treturn sizeof(p_drv_buf->abts_dst_fcid[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ABTS_1_TIMESTAMP:\n\tcase DRV_TLV_ABTS_2_TIMESTAMP:\n\tcase DRV_TLV_ABTS_3_TIMESTAMP:\n\tcase DRV_TLV_ABTS_4_TIMESTAMP:\n\tcase DRV_TLV_ABTS_5_TIMESTAMP:\n\t\tidx = (p_tlv->tlv_type - DRV_TLV_ABTS_1_TIMESTAMP) / 2;\n\n\t\treturn qed_mfw_get_tlv_time_value(&p_drv_buf->abts_tstamp[idx],\n\t\t\t\t\t\t  p_buf);\n\tcase DRV_TLV_RSCNS_RECEIVED:\n\t\tif (p_drv_buf->rx_rscn_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_rscn;\n\t\t\treturn sizeof(p_drv_buf->rx_rscn);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_1:\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_2:\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_3:\n\tcase DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_4:\n\t\tidx = p_tlv->tlv_type - DRV_TLV_LAST_RSCN_RECEIVED_N_PORT_1;\n\n\t\tif (p_drv_buf->rx_rscn_nport_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_rscn_nport[idx];\n\t\t\treturn sizeof(p_drv_buf->rx_rscn_nport[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LUN_RESETS_ISSUED:\n\t\tif (p_drv_buf->tx_lun_rst_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_lun_rst;\n\t\t\treturn sizeof(p_drv_buf->tx_lun_rst);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ABORT_TASK_SETS_ISSUED:\n\t\tif (p_drv_buf->abort_task_sets_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->abort_task_sets;\n\t\t\treturn sizeof(p_drv_buf->abort_task_sets);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_TPRLOS_SENT:\n\t\tif (p_drv_buf->tx_tprlos_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_tprlos;\n\t\t\treturn sizeof(p_drv_buf->tx_tprlos);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_NOS_SENT_COUNT:\n\t\tif (p_drv_buf->tx_nos_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_nos;\n\t\t\treturn sizeof(p_drv_buf->tx_nos);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_NOS_RECEIVED_COUNT:\n\t\tif (p_drv_buf->rx_nos_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_nos;\n\t\t\treturn sizeof(p_drv_buf->rx_nos);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_OLS_COUNT:\n\t\tif (p_drv_buf->ols_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->ols;\n\t\t\treturn sizeof(p_drv_buf->ols);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LR_COUNT:\n\t\tif (p_drv_buf->lr_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->lr;\n\t\t\treturn sizeof(p_drv_buf->lr);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LRR_COUNT:\n\t\tif (p_drv_buf->lrr_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->lrr;\n\t\t\treturn sizeof(p_drv_buf->lrr);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LIP_SENT_COUNT:\n\t\tif (p_drv_buf->tx_lip_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_lip;\n\t\t\treturn sizeof(p_drv_buf->tx_lip);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_LIP_RECEIVED_COUNT:\n\t\tif (p_drv_buf->rx_lip_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_lip;\n\t\t\treturn sizeof(p_drv_buf->rx_lip);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_EOFA_COUNT:\n\t\tif (p_drv_buf->eofa_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->eofa;\n\t\t\treturn sizeof(p_drv_buf->eofa);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_EOFNI_COUNT:\n\t\tif (p_drv_buf->eofni_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->eofni;\n\t\t\treturn sizeof(p_drv_buf->eofni);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_CHECK_CONDITION_COUNT:\n\t\tif (p_drv_buf->scsi_chks_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_chks;\n\t\t\treturn sizeof(p_drv_buf->scsi_chks);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_CONDITION_MET_COUNT:\n\t\tif (p_drv_buf->scsi_cond_met_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_cond_met;\n\t\t\treturn sizeof(p_drv_buf->scsi_cond_met);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_BUSY_COUNT:\n\t\tif (p_drv_buf->scsi_busy_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_busy;\n\t\t\treturn sizeof(p_drv_buf->scsi_busy);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_INTERMEDIATE_COUNT:\n\t\tif (p_drv_buf->scsi_inter_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_inter;\n\t\t\treturn sizeof(p_drv_buf->scsi_inter);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_INTERMEDIATE_CONDITION_MET_COUNT:\n\t\tif (p_drv_buf->scsi_inter_cond_met_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_inter_cond_met;\n\t\t\treturn sizeof(p_drv_buf->scsi_inter_cond_met);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_RESERVATION_CONFLICT_COUNT:\n\t\tif (p_drv_buf->scsi_rsv_conflicts_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_rsv_conflicts;\n\t\t\treturn sizeof(p_drv_buf->scsi_rsv_conflicts);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_TASK_SET_FULL_COUNT:\n\t\tif (p_drv_buf->scsi_tsk_full_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_tsk_full;\n\t\t\treturn sizeof(p_drv_buf->scsi_tsk_full);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_ACA_ACTIVE_COUNT:\n\t\tif (p_drv_buf->scsi_aca_active_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_aca_active;\n\t\t\treturn sizeof(p_drv_buf->scsi_aca_active);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_STATUS_TASK_ABORTED_COUNT:\n\t\tif (p_drv_buf->scsi_tsk_abort_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_tsk_abort;\n\t\t\treturn sizeof(p_drv_buf->scsi_tsk_abort);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_1_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_2_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_3_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_4_RECEIVED_SK_ASC_ASCQ:\n\tcase DRV_TLV_SCSI_CHECK_CONDITION_5_RECEIVED_SK_ASC_ASCQ:\n\t\tidx = (p_tlv->tlv_type -\n\t\t       DRV_TLV_SCSI_CHECK_CONDITION_1_RECEIVED_SK_ASC_ASCQ) / 2;\n\n\t\tif (p_drv_buf->scsi_rx_chk_set[idx]) {\n\t\t\tp_buf->p_val = &p_drv_buf->scsi_rx_chk[idx];\n\t\t\treturn sizeof(p_drv_buf->scsi_rx_chk[idx]);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_SCSI_CHECK_1_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_2_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_3_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_4_TIMESTAMP:\n\tcase DRV_TLV_SCSI_CHECK_5_TIMESTAMP:\n\t\tidx = (p_tlv->tlv_type - DRV_TLV_SCSI_CHECK_1_TIMESTAMP) / 2;\n\t\tp_time = &p_drv_buf->scsi_chk_tstamp[idx];\n\n\t\treturn qed_mfw_get_tlv_time_value(p_time, p_buf);\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn -1;\n}\n\nstatic int\nqed_mfw_get_iscsi_tlv_value(struct qed_drv_tlv_hdr *p_tlv,\n\t\t\t    struct qed_mfw_tlv_iscsi *p_drv_buf,\n\t\t\t    struct qed_tlv_parsed_buf *p_buf)\n{\n\tswitch (p_tlv->tlv_type) {\n\tcase DRV_TLV_TARGET_LLMNR_ENABLED:\n\t\tif (p_drv_buf->target_llmnr_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->target_llmnr;\n\t\t\treturn sizeof(p_drv_buf->target_llmnr);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_HEADER_DIGEST_FLAG_ENABLED:\n\t\tif (p_drv_buf->header_digest_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->header_digest;\n\t\t\treturn sizeof(p_drv_buf->header_digest);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_DATA_DIGEST_FLAG_ENABLED:\n\t\tif (p_drv_buf->data_digest_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->data_digest;\n\t\t\treturn sizeof(p_drv_buf->data_digest);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_AUTHENTICATION_METHOD:\n\t\tif (p_drv_buf->auth_method_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->auth_method;\n\t\t\treturn sizeof(p_drv_buf->auth_method);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ISCSI_BOOT_TARGET_PORTAL:\n\t\tif (p_drv_buf->boot_taget_portal_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->boot_taget_portal;\n\t\t\treturn sizeof(p_drv_buf->boot_taget_portal);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_MAX_FRAME_SIZE:\n\t\tif (p_drv_buf->frame_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->frame_size;\n\t\t\treturn sizeof(p_drv_buf->frame_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PDU_TX_DESCRIPTORS_QUEUE_SIZE:\n\t\tif (p_drv_buf->tx_desc_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_desc_size;\n\t\t\treturn sizeof(p_drv_buf->tx_desc_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PDU_RX_DESCRIPTORS_QUEUE_SIZE:\n\t\tif (p_drv_buf->rx_desc_size_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_desc_size;\n\t\t\treturn sizeof(p_drv_buf->rx_desc_size);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ISCSI_BOOT_PROGRESS:\n\t\tif (p_drv_buf->boot_progress_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->boot_progress;\n\t\t\treturn sizeof(p_drv_buf->boot_progress);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PDU_TX_DESCRIPTOR_QUEUE_AVG_DEPTH:\n\t\tif (p_drv_buf->tx_desc_qdepth_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_desc_qdepth;\n\t\t\treturn sizeof(p_drv_buf->tx_desc_qdepth);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_PDU_RX_DESCRIPTORS_QUEUE_AVG_DEPTH:\n\t\tif (p_drv_buf->rx_desc_qdepth_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_desc_qdepth;\n\t\t\treturn sizeof(p_drv_buf->rx_desc_qdepth);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ISCSI_PDU_RX_FRAMES_RECEIVED:\n\t\tif (p_drv_buf->rx_frames_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_frames;\n\t\t\treturn sizeof(p_drv_buf->rx_frames);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ISCSI_PDU_RX_BYTES_RECEIVED:\n\t\tif (p_drv_buf->rx_bytes_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->rx_bytes;\n\t\t\treturn sizeof(p_drv_buf->rx_bytes);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ISCSI_PDU_TX_FRAMES_SENT:\n\t\tif (p_drv_buf->tx_frames_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_frames;\n\t\t\treturn sizeof(p_drv_buf->tx_frames);\n\t\t}\n\t\tbreak;\n\tcase DRV_TLV_ISCSI_PDU_TX_BYTES_SENT:\n\t\tif (p_drv_buf->tx_bytes_set) {\n\t\t\tp_buf->p_val = &p_drv_buf->tx_bytes;\n\t\t\treturn sizeof(p_drv_buf->tx_bytes);\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn -1;\n}\n\nstatic int qed_mfw_update_tlvs(struct qed_hwfn *p_hwfn,\n\t\t\t       u8 tlv_group, u8 *p_mfw_buf, u32 size)\n{\n\tunion qed_mfw_tlv_data *p_tlv_data;\n\tstruct qed_tlv_parsed_buf buffer;\n\tstruct qed_drv_tlv_hdr tlv;\n\tint len = 0;\n\tu32 offset;\n\tu8 *p_tlv;\n\n\tp_tlv_data = vzalloc(sizeof(*p_tlv_data));\n\tif (!p_tlv_data)\n\t\treturn -ENOMEM;\n\n\tif (qed_mfw_fill_tlv_data(p_hwfn, tlv_group, p_tlv_data)) {\n\t\tvfree(p_tlv_data);\n\t\treturn -EINVAL;\n\t}\n\n\tmemset(&tlv, 0, sizeof(tlv));\n\tfor (offset = 0; offset < size;\n\t     offset += sizeof(tlv) + sizeof(u32) * tlv.tlv_length) {\n\t\tp_tlv = &p_mfw_buf[offset];\n\t\ttlv.tlv_type = TLV_TYPE(p_tlv);\n\t\ttlv.tlv_length = TLV_LENGTH(p_tlv);\n\t\ttlv.tlv_flags = TLV_FLAGS(p_tlv);\n\n\t\tDP_VERBOSE(p_hwfn, QED_MSG_SP,\n\t\t\t   \"Type %d length = %d flags = 0x%x\\n\", tlv.tlv_type,\n\t\t\t   tlv.tlv_length, tlv.tlv_flags);\n\n\t\tif (tlv_group == QED_MFW_TLV_GENERIC)\n\t\t\tlen = qed_mfw_get_gen_tlv_value(&tlv,\n\t\t\t\t\t\t\t&p_tlv_data->generic,\n\t\t\t\t\t\t\t&buffer);\n\t\telse if (tlv_group == QED_MFW_TLV_ETH)\n\t\t\tlen = qed_mfw_get_eth_tlv_value(&tlv,\n\t\t\t\t\t\t\t&p_tlv_data->eth,\n\t\t\t\t\t\t\t&buffer);\n\t\telse if (tlv_group == QED_MFW_TLV_FCOE)\n\t\t\tlen = qed_mfw_get_fcoe_tlv_value(&tlv,\n\t\t\t\t\t\t\t &p_tlv_data->fcoe,\n\t\t\t\t\t\t\t &buffer);\n\t\telse\n\t\t\tlen = qed_mfw_get_iscsi_tlv_value(&tlv,\n\t\t\t\t\t\t\t  &p_tlv_data->iscsi,\n\t\t\t\t\t\t\t  &buffer);\n\n\t\tif (len > 0) {\n\t\t\tWARN(len > 4 * tlv.tlv_length,\n\t\t\t     \"Incorrect MFW TLV length %d, it shouldn't be greater than %d\\n\",\n\t\t\t     len, 4 * tlv.tlv_length);\n\t\t\tlen = min_t(int, len, 4 * tlv.tlv_length);\n\t\t\ttlv.tlv_flags |= QED_DRV_TLV_FLAGS_CHANGED;\n\t\t\tTLV_FLAGS(p_tlv) = tlv.tlv_flags;\n\t\t\tmemcpy(p_mfw_buf + offset + sizeof(tlv),\n\t\t\t       buffer.p_val, len);\n\t\t}\n\t}\n\n\tvfree(p_tlv_data);\n\n\treturn 0;\n}\n\nint qed_mfw_process_tlv_req(struct qed_hwfn *p_hwfn, struct qed_ptt *p_ptt)\n{\n\tu32 addr, size, offset, resp, param, val, global_offsize, global_addr;\n\tu8 tlv_group = 0, id, *p_mfw_buf = NULL, *p_temp;\n\tstruct qed_drv_tlv_hdr tlv;\n\tint rc;\n\n\taddr = SECTION_OFFSIZE_ADDR(p_hwfn->mcp_info->public_base,\n\t\t\t\t    PUBLIC_GLOBAL);\n\tglobal_offsize = qed_rd(p_hwfn, p_ptt, addr);\n\tglobal_addr = SECTION_ADDR(global_offsize, 0);\n\taddr = global_addr + offsetof(struct public_global, data_ptr);\n\taddr = qed_rd(p_hwfn, p_ptt, addr);\n\tsize = qed_rd(p_hwfn, p_ptt, global_addr +\n\t\t      offsetof(struct public_global, data_size));\n\n\tif (!size) {\n\t\tDP_NOTICE(p_hwfn, \"Invalid TLV req size = %d\\n\", size);\n\t\tgoto drv_done;\n\t}\n\n\tp_mfw_buf = vzalloc(size);\n\tif (!p_mfw_buf) {\n\t\tDP_NOTICE(p_hwfn, \"Failed allocate memory for p_mfw_buf\\n\");\n\t\tgoto drv_done;\n\t}\n\n\t \n\tfor (offset = 0; offset < size; offset += sizeof(u32)) {\n\t\tval = qed_rd(p_hwfn, p_ptt, addr + offset);\n\t\tval = be32_to_cpu((__force __be32)val);\n\t\tmemcpy(&p_mfw_buf[offset], &val, sizeof(u32));\n\t}\n\n\t \n\tfor (offset = 0; offset < size;\n\t     offset += sizeof(tlv) + sizeof(u32) * tlv.tlv_length) {\n\t\tp_temp = &p_mfw_buf[offset];\n\t\ttlv.tlv_type = TLV_TYPE(p_temp);\n\t\ttlv.tlv_length = TLV_LENGTH(p_temp);\n\t\tif (qed_mfw_get_tlv_group(tlv.tlv_type, &tlv_group))\n\t\t\tDP_VERBOSE(p_hwfn, NETIF_MSG_DRV,\n\t\t\t\t   \"Un recognized TLV %d\\n\", tlv.tlv_type);\n\t}\n\n\t \n\tif ((tlv_group & QED_MFW_TLV_ETH) && !QED_IS_L2_PERSONALITY(p_hwfn)) {\n\t\tDP_VERBOSE(p_hwfn, QED_MSG_SP,\n\t\t\t   \"Skipping L2 TLVs for non-L2 function\\n\");\n\t\ttlv_group &= ~QED_MFW_TLV_ETH;\n\t}\n\n\tif ((tlv_group & QED_MFW_TLV_FCOE) &&\n\t    p_hwfn->hw_info.personality != QED_PCI_FCOE) {\n\t\tDP_VERBOSE(p_hwfn, QED_MSG_SP,\n\t\t\t   \"Skipping FCoE TLVs for non-FCoE function\\n\");\n\t\ttlv_group &= ~QED_MFW_TLV_FCOE;\n\t}\n\n\tif ((tlv_group & QED_MFW_TLV_ISCSI) &&\n\t    p_hwfn->hw_info.personality != QED_PCI_ISCSI &&\n\t\tp_hwfn->hw_info.personality != QED_PCI_NVMETCP) {\n\t\tDP_VERBOSE(p_hwfn, QED_MSG_SP,\n\t\t\t   \"Skipping iSCSI TLVs for non-iSCSI function\\n\");\n\t\ttlv_group &= ~QED_MFW_TLV_ISCSI;\n\t}\n\n\t \n\tfor (id = QED_MFW_TLV_GENERIC; id < QED_MFW_TLV_MAX; id <<= 1) {\n\t\tif (tlv_group & id)\n\t\t\tif (qed_mfw_update_tlvs(p_hwfn, id, p_mfw_buf, size))\n\t\t\t\tgoto drv_done;\n\t}\n\n\t \n\tfor (offset = 0; offset < size; offset += sizeof(u32)) {\n\t\tmemcpy(&val, &p_mfw_buf[offset], sizeof(u32));\n\t\tval = (__force u32)cpu_to_be32(val);\n\t\tqed_wr(p_hwfn, p_ptt, addr + offset, val);\n\t}\n\ndrv_done:\n\trc = qed_mcp_cmd(p_hwfn, p_ptt, DRV_MSG_CODE_GET_TLV_DONE, 0, &resp,\n\t\t\t &param);\n\n\tvfree(p_mfw_buf);\n\n\treturn rc;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}