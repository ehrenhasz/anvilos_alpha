{
  "module_name": "qca_7k.c",
  "hash_id": "f37e17202b9383173be25c9c4da5b149f47c6f7db570db540bd0ac68df1004e0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/qualcomm/qca_7k.c",
  "human_readable_source": " \n\n \n\n#include <linux/kernel.h>\n#include <linux/netdevice.h>\n#include <linux/spi/spi.h>\n\n#include \"qca_7k.h\"\n\nvoid\nqcaspi_spi_error(struct qcaspi *qca)\n{\n\tif (qca->sync != QCASPI_SYNC_READY)\n\t\treturn;\n\n\tnetdev_err(qca->net_dev, \"spi error\\n\");\n\tqca->sync = QCASPI_SYNC_UNKNOWN;\n\tqca->stats.spi_err++;\n}\n\nint\nqcaspi_read_register(struct qcaspi *qca, u16 reg, u16 *result)\n{\n\t__be16 rx_data;\n\t__be16 tx_data;\n\tstruct spi_transfer transfer[2];\n\tstruct spi_message msg;\n\tint ret;\n\n\tmemset(transfer, 0, sizeof(transfer));\n\n\tspi_message_init(&msg);\n\n\ttx_data = cpu_to_be16(QCA7K_SPI_READ | QCA7K_SPI_INTERNAL | reg);\n\t*result = 0;\n\n\ttransfer[0].tx_buf = &tx_data;\n\ttransfer[0].len = QCASPI_CMD_LEN;\n\ttransfer[1].rx_buf = &rx_data;\n\ttransfer[1].len = QCASPI_CMD_LEN;\n\n\tspi_message_add_tail(&transfer[0], &msg);\n\n\tif (qca->legacy_mode) {\n\t\tspi_sync(qca->spi_dev, &msg);\n\t\tspi_message_init(&msg);\n\t}\n\tspi_message_add_tail(&transfer[1], &msg);\n\tret = spi_sync(qca->spi_dev, &msg);\n\n\tif (!ret)\n\t\tret = msg.status;\n\n\tif (ret)\n\t\tqcaspi_spi_error(qca);\n\telse\n\t\t*result = be16_to_cpu(rx_data);\n\n\treturn ret;\n}\n\nstatic int\n__qcaspi_write_register(struct qcaspi *qca, u16 reg, u16 value)\n{\n\t__be16 tx_data[2];\n\tstruct spi_transfer transfer[2];\n\tstruct spi_message msg;\n\tint ret;\n\n\tmemset(&transfer, 0, sizeof(transfer));\n\n\tspi_message_init(&msg);\n\n\ttx_data[0] = cpu_to_be16(QCA7K_SPI_WRITE | QCA7K_SPI_INTERNAL | reg);\n\ttx_data[1] = cpu_to_be16(value);\n\n\ttransfer[0].tx_buf = &tx_data[0];\n\ttransfer[0].len = QCASPI_CMD_LEN;\n\ttransfer[1].tx_buf = &tx_data[1];\n\ttransfer[1].len = QCASPI_CMD_LEN;\n\n\tspi_message_add_tail(&transfer[0], &msg);\n\tif (qca->legacy_mode) {\n\t\tspi_sync(qca->spi_dev, &msg);\n\t\tspi_message_init(&msg);\n\t}\n\tspi_message_add_tail(&transfer[1], &msg);\n\tret = spi_sync(qca->spi_dev, &msg);\n\n\tif (!ret)\n\t\tret = msg.status;\n\n\tif (ret)\n\t\tqcaspi_spi_error(qca);\n\n\treturn ret;\n}\n\nint\nqcaspi_write_register(struct qcaspi *qca, u16 reg, u16 value, int retry)\n{\n\tint ret, i = 0;\n\tu16 confirmed;\n\n\tdo {\n\t\tret = __qcaspi_write_register(qca, reg, value);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (!retry)\n\t\t\treturn 0;\n\n\t\tret = qcaspi_read_register(qca, reg, &confirmed);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tret = confirmed != value;\n\t\tif (!ret)\n\t\t\treturn 0;\n\n\t\ti++;\n\t\tqca->stats.write_verify_failed++;\n\n\t} while (i <= retry);\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}