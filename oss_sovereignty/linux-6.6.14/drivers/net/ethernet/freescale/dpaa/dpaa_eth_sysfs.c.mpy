{
  "module_name": "dpaa_eth_sysfs.c",
  "hash_id": "a61954be06b69ff1483bd6d9ec8c42553797464e571af9a9fe1db8829cddb553",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/freescale/dpaa/dpaa_eth_sysfs.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/io.h>\n#include <linux/of_net.h>\n#include \"dpaa_eth.h\"\n#include \"mac.h\"\n\nstatic ssize_t dpaa_eth_show_addr(struct device *dev,\n\t\t\t\t  struct device_attribute *attr, char *buf)\n{\n\tstruct dpaa_priv *priv = netdev_priv(to_net_dev(dev));\n\tstruct mac_device *mac_dev = priv->mac_dev;\n\n\tif (mac_dev)\n\t\treturn sprintf(buf, \"%llx\",\n\t\t\t\t(unsigned long long)mac_dev->res->start);\n\telse\n\t\treturn sprintf(buf, \"none\");\n}\n\nstatic ssize_t dpaa_eth_show_fqids(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf)\n{\n\tstruct dpaa_priv *priv = netdev_priv(to_net_dev(dev));\n\tstruct dpaa_fq *prev = NULL;\n\tchar *prevstr = NULL;\n\tstruct dpaa_fq *tmp;\n\tstruct dpaa_fq *fq;\n\tu32 first_fqid = 0;\n\tu32 last_fqid = 0;\n\tssize_t bytes = 0;\n\tchar *str;\n\tint i = 0;\n\n\tlist_for_each_entry_safe(fq, tmp, &priv->dpaa_fq_list, list) {\n\t\tswitch (fq->fq_type) {\n\t\tcase FQ_TYPE_RX_DEFAULT:\n\t\t\tstr = \"Rx default\";\n\t\t\tbreak;\n\t\tcase FQ_TYPE_RX_ERROR:\n\t\t\tstr = \"Rx error\";\n\t\t\tbreak;\n\t\tcase FQ_TYPE_RX_PCD:\n\t\t\tstr = \"Rx PCD\";\n\t\t\tbreak;\n\t\tcase FQ_TYPE_TX_CONFIRM:\n\t\t\tstr = \"Tx default confirmation\";\n\t\t\tbreak;\n\t\tcase FQ_TYPE_TX_CONF_MQ:\n\t\t\tstr = \"Tx confirmation (mq)\";\n\t\t\tbreak;\n\t\tcase FQ_TYPE_TX_ERROR:\n\t\t\tstr = \"Tx error\";\n\t\t\tbreak;\n\t\tcase FQ_TYPE_TX:\n\t\t\tstr = \"Tx\";\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tstr = \"Unknown\";\n\t\t}\n\n\t\tif (prev && (abs(fq->fqid - prev->fqid) != 1 ||\n\t\t\t     str != prevstr)) {\n\t\t\tif (last_fqid == first_fqid)\n\t\t\t\tbytes += sprintf(buf + bytes,\n\t\t\t\t\t\"%s: %d\\n\", prevstr, prev->fqid);\n\t\t\telse\n\t\t\t\tbytes += sprintf(buf + bytes,\n\t\t\t\t\t\"%s: %d - %d\\n\", prevstr,\n\t\t\t\t\tfirst_fqid, last_fqid);\n\t\t}\n\n\t\tif (prev && abs(fq->fqid - prev->fqid) == 1 &&\n\t\t    str == prevstr) {\n\t\t\tlast_fqid = fq->fqid;\n\t\t} else {\n\t\t\tfirst_fqid = fq->fqid;\n\t\t\tlast_fqid = fq->fqid;\n\t\t}\n\n\t\tprev = fq;\n\t\tprevstr = str;\n\t\ti++;\n\t}\n\n\tif (prev) {\n\t\tif (last_fqid == first_fqid)\n\t\t\tbytes += sprintf(buf + bytes, \"%s: %d\\n\", prevstr,\n\t\t\t\t\tprev->fqid);\n\t\telse\n\t\t\tbytes += sprintf(buf + bytes, \"%s: %d - %d\\n\", prevstr,\n\t\t\t\t\tfirst_fqid, last_fqid);\n\t}\n\n\treturn bytes;\n}\n\nstatic ssize_t dpaa_eth_show_bpids(struct device *dev,\n\t\t\t\t   struct device_attribute *attr, char *buf)\n{\n\tstruct dpaa_priv *priv = netdev_priv(to_net_dev(dev));\n\tssize_t bytes = 0;\n\n\tbytes += snprintf(buf + bytes, PAGE_SIZE - bytes, \"%u\\n\",\n\t\t\t\t  priv->dpaa_bp->bpid);\n\n\treturn bytes;\n}\n\nstatic struct device_attribute dpaa_eth_attrs[] = {\n\t__ATTR(device_addr, 0444, dpaa_eth_show_addr, NULL),\n\t__ATTR(fqids, 0444, dpaa_eth_show_fqids, NULL),\n\t__ATTR(bpids, 0444, dpaa_eth_show_bpids, NULL),\n};\n\nvoid dpaa_eth_sysfs_init(struct device *dev)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(dpaa_eth_attrs); i++)\n\t\tif (device_create_file(dev, &dpaa_eth_attrs[i])) {\n\t\t\tdev_err(dev, \"Error creating sysfs file\\n\");\n\t\t\twhile (i > 0)\n\t\t\t\tdevice_remove_file(dev, &dpaa_eth_attrs[--i]);\n\t\t\treturn;\n\t\t}\n}\n\nvoid dpaa_eth_sysfs_remove(struct device *dev)\n{\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(dpaa_eth_attrs); i++)\n\t\tdevice_remove_file(dev, &dpaa_eth_attrs[i]);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}