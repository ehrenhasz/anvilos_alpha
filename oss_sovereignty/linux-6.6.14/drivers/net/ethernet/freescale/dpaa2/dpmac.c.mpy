{
  "module_name": "dpmac.c",
  "hash_id": "5b47ee248ca0a4b603f463aa9b22dfa648a41945a37f332b543eb72dd615b488",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/freescale/dpaa2/dpmac.c",
  "human_readable_source": "\n \n#include <linux/fsl/mc.h>\n#include \"dpmac.h\"\n#include \"dpmac-cmd.h\"\n\n \nint dpmac_open(struct fsl_mc_io *mc_io,\n\t       u32 cmd_flags,\n\t       int dpmac_id,\n\t       u16 *token)\n{\n\tstruct dpmac_cmd_open *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPMAC_CMDID_OPEN,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  0);\n\tcmd_params = (struct dpmac_cmd_open *)cmd.params;\n\tcmd_params->dpmac_id = cpu_to_le32(dpmac_id);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\t*token = mc_cmd_hdr_read_token(&cmd);\n\n\treturn err;\n}\n\n \nint dpmac_close(struct fsl_mc_io *mc_io,\n\t\tu32 cmd_flags,\n\t\tu16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPMAC_CMDID_CLOSE, cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpmac_get_attributes(struct fsl_mc_io *mc_io,\n\t\t\t u32 cmd_flags,\n\t\t\t u16 token,\n\t\t\t struct dpmac_attr *attr)\n{\n\tstruct dpmac_rsp_get_attributes *rsp_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPMAC_CMDID_GET_ATTR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpmac_rsp_get_attributes *)cmd.params;\n\tattr->eth_if = rsp_params->eth_if;\n\tattr->link_type = rsp_params->link_type;\n\tattr->id = le16_to_cpu(rsp_params->id);\n\tattr->max_rate = le32_to_cpu(rsp_params->max_rate);\n\n\treturn 0;\n}\n\n \nint dpmac_set_link_state(struct fsl_mc_io *mc_io,\n\t\t\t u32 cmd_flags,\n\t\t\t u16 token,\n\t\t\t struct dpmac_link_state *link_state)\n{\n\tstruct dpmac_cmd_set_link_state *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPMAC_CMDID_SET_LINK_STATE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpmac_cmd_set_link_state *)cmd.params;\n\tcmd_params->options = cpu_to_le64(link_state->options);\n\tcmd_params->rate = cpu_to_le32(link_state->rate);\n\tdpmac_set_field(cmd_params->state, STATE, link_state->up);\n\tdpmac_set_field(cmd_params->state, STATE_VALID,\n\t\t\tlink_state->state_valid);\n\tcmd_params->supported = cpu_to_le64(link_state->supported);\n\tcmd_params->advertising = cpu_to_le64(link_state->advertising);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpmac_get_counter(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t      enum dpmac_counter_id id, u64 *value)\n{\n\tstruct dpmac_cmd_get_counter *dpmac_cmd;\n\tstruct dpmac_rsp_get_counter *dpmac_rsp;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err = 0;\n\n\tcmd.header = mc_encode_cmd_header(DPMAC_CMDID_GET_COUNTER,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tdpmac_cmd = (struct dpmac_cmd_get_counter *)cmd.params;\n\tdpmac_cmd->id = id;\n\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\tdpmac_rsp = (struct dpmac_rsp_get_counter *)cmd.params;\n\t*value = le64_to_cpu(dpmac_rsp->counter);\n\n\treturn 0;\n}\n\n \nint dpmac_get_api_version(struct fsl_mc_io *mc_io, u32 cmd_flags,\n\t\t\t  u16 *major_ver, u16 *minor_ver)\n{\n\tstruct dpmac_rsp_get_api_version *rsp_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPMAC_CMDID_GET_API_VERSION,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  0);\n\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpmac_rsp_get_api_version *)cmd.params;\n\t*major_ver = le16_to_cpu(rsp_params->major);\n\t*minor_ver = le16_to_cpu(rsp_params->minor);\n\n\treturn 0;\n}\n\n \nint dpmac_set_protocol(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t       enum dpmac_eth_if protocol)\n{\n\tstruct dpmac_cmd_set_protocol *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\tcmd.header = mc_encode_cmd_header(DPMAC_CMDID_SET_PROTOCOL,\n\t\t\t\t\t  cmd_flags, token);\n\tcmd_params = (struct dpmac_cmd_set_protocol *)cmd.params;\n\tcmd_params->eth_if = protocol;\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}