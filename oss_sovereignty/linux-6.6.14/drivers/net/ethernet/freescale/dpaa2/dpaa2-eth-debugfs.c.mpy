{
  "module_name": "dpaa2-eth-debugfs.c",
  "hash_id": "851be919187dde7176f15f45fc63920dd001ebe7934bc42559e0a16ad9b19080",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/freescale/dpaa2/dpaa2-eth-debugfs.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/debugfs.h>\n#include \"dpaa2-eth.h\"\n#include \"dpaa2-eth-debugfs.h\"\n\n#define DPAA2_ETH_DBG_ROOT \"dpaa2-eth\"\n\nstatic struct dentry *dpaa2_dbg_root;\n\nstatic int dpaa2_dbg_cpu_show(struct seq_file *file, void *offset)\n{\n\tstruct dpaa2_eth_priv *priv = (struct dpaa2_eth_priv *)file->private;\n\tstruct rtnl_link_stats64 *stats;\n\tstruct dpaa2_eth_drv_stats *extras;\n\tint i;\n\n\tseq_printf(file, \"Per-CPU stats for %s\\n\", priv->net_dev->name);\n\tseq_printf(file, \"%s%16s%16s%16s%16s%16s%16s%16s%16s%16s\\n\",\n\t\t   \"CPU\", \"Rx\", \"Rx Err\", \"Rx SG\", \"Tx\", \"Tx Err\", \"Tx conf\",\n\t\t   \"Tx SG\", \"Tx converted to SG\", \"Enq busy\");\n\n\tfor_each_online_cpu(i) {\n\t\tstats = per_cpu_ptr(priv->percpu_stats, i);\n\t\textras = per_cpu_ptr(priv->percpu_extras, i);\n\t\tseq_printf(file, \"%3d%16llu%16llu%16llu%16llu%16llu%16llu%16llu%16llu%16llu\\n\",\n\t\t\t   i,\n\t\t\t   stats->rx_packets,\n\t\t\t   stats->rx_errors,\n\t\t\t   extras->rx_sg_frames,\n\t\t\t   stats->tx_packets,\n\t\t\t   stats->tx_errors,\n\t\t\t   extras->tx_conf_frames,\n\t\t\t   extras->tx_sg_frames,\n\t\t\t   extras->tx_converted_sg_frames,\n\t\t\t   extras->tx_portal_busy);\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(dpaa2_dbg_cpu);\n\nstatic char *fq_type_to_str(struct dpaa2_eth_fq *fq)\n{\n\tswitch (fq->type) {\n\tcase DPAA2_RX_FQ:\n\t\treturn \"Rx\";\n\tcase DPAA2_TX_CONF_FQ:\n\t\treturn \"Tx conf\";\n\tdefault:\n\t\treturn \"N/A\";\n\t}\n}\n\nstatic int dpaa2_dbg_fqs_show(struct seq_file *file, void *offset)\n{\n\tstruct dpaa2_eth_priv *priv = (struct dpaa2_eth_priv *)file->private;\n\tstruct dpaa2_eth_fq *fq;\n\tu32 fcnt, bcnt;\n\tint i, err;\n\n\tseq_printf(file, \"FQ stats for %s:\\n\", priv->net_dev->name);\n\tseq_printf(file, \"%s%16s%16s%16s%16s%16s\\n\",\n\t\t   \"VFQID\", \"CPU\", \"TC\", \"Type\", \"Frames\", \"Pending frames\");\n\n\tfor (i = 0; i <  priv->num_fqs; i++) {\n\t\tfq = &priv->fq[i];\n\t\terr = dpaa2_io_query_fq_count(NULL, fq->fqid, &fcnt, &bcnt);\n\t\tif (err)\n\t\t\tfcnt = 0;\n\n\t\t \n\t\tif (!fq->stats.frames && !fcnt)\n\t\t\tcontinue;\n\n\t\tseq_printf(file, \"%5d%16d%16d%16s%16llu%16u\\n\",\n\t\t\t   fq->fqid,\n\t\t\t   fq->target_cpu,\n\t\t\t   fq->tc,\n\t\t\t   fq_type_to_str(fq),\n\t\t\t   fq->stats.frames,\n\t\t\t   fcnt);\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(dpaa2_dbg_fqs);\n\nstatic int dpaa2_dbg_ch_show(struct seq_file *file, void *offset)\n{\n\tstruct dpaa2_eth_priv *priv = (struct dpaa2_eth_priv *)file->private;\n\tstruct dpaa2_eth_channel *ch;\n\tint i;\n\n\tseq_printf(file, \"Channel stats for %s:\\n\", priv->net_dev->name);\n\tseq_printf(file, \"%s  %5s%16s%16s%16s%16s%16s%16s\\n\",\n\t\t   \"IDX\", \"CHID\", \"CPU\", \"Deq busy\", \"Frames\", \"CDANs\",\n\t\t   \"Avg Frm/CDAN\", \"Buf count\");\n\n\tfor (i = 0; i < priv->num_channels; i++) {\n\t\tch = priv->channel[i];\n\t\tseq_printf(file, \"%3s%d%6d%16d%16llu%16llu%16llu%16llu%16d\\n\",\n\t\t\t   \"CH#\", i, ch->ch_id,\n\t\t\t   ch->nctx.desired_cpu,\n\t\t\t   ch->stats.dequeue_portal_busy,\n\t\t\t   ch->stats.frames,\n\t\t\t   ch->stats.cdan,\n\t\t\t   div64_u64(ch->stats.frames, ch->stats.cdan),\n\t\t\t   ch->buf_count);\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(dpaa2_dbg_ch);\n\nstatic int dpaa2_dbg_bp_show(struct seq_file *file, void *offset)\n{\n\tstruct dpaa2_eth_priv *priv = (struct dpaa2_eth_priv *)file->private;\n\tint i, j, num_queues, buf_cnt;\n\tstruct dpaa2_eth_bp *bp;\n\tchar ch_name[10];\n\tint err;\n\n\t \n\tseq_printf(file, \"Buffer pool info for %s:\\n\", priv->net_dev->name);\n\tseq_printf(file, \"%s  %10s%15s\", \"IDX\", \"BPID\", \"Buf count\");\n\tnum_queues = dpaa2_eth_queue_count(priv);\n\tfor (i = 0; i < num_queues; i++) {\n\t\tsnprintf(ch_name, sizeof(ch_name), \"CH#%d\", i);\n\t\tseq_printf(file, \"%10s\", ch_name);\n\t}\n\tseq_printf(file, \"\\n\");\n\n\t \n\tfor (i = 0; i < priv->num_bps; i++) {\n\t\tbp = priv->bp[i];\n\n\t\terr = dpaa2_io_query_bp_count(NULL, bp->bpid, &buf_cnt);\n\t\tif (err) {\n\t\t\tnetdev_warn(priv->net_dev, \"Buffer count query error %d\\n\", err);\n\t\t\treturn err;\n\t\t}\n\n\t\tseq_printf(file, \"%3s%d%10d%15d\", \"BP#\", i, bp->bpid, buf_cnt);\n\t\tfor (j = 0; j < num_queues; j++) {\n\t\t\tif (priv->channel[j]->bp == bp)\n\t\t\t\tseq_printf(file, \"%10s\", \"x\");\n\t\t\telse\n\t\t\t\tseq_printf(file, \"%10s\", \"\");\n\t\t}\n\t\tseq_printf(file, \"\\n\");\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(dpaa2_dbg_bp);\n\nvoid dpaa2_dbg_add(struct dpaa2_eth_priv *priv)\n{\n\tstruct fsl_mc_device *dpni_dev;\n\tstruct dentry *dir;\n\tchar name[10];\n\n\t \n\tdpni_dev = to_fsl_mc_device(priv->net_dev->dev.parent);\n\tsnprintf(name, 10, \"dpni.%d\", dpni_dev->obj_desc.id);\n\tdir = debugfs_create_dir(name, dpaa2_dbg_root);\n\tpriv->dbg.dir = dir;\n\n\t \n\tdebugfs_create_file(\"cpu_stats\", 0444, dir, priv, &dpaa2_dbg_cpu_fops);\n\n\t \n\tdebugfs_create_file(\"fq_stats\", 0444, dir, priv, &dpaa2_dbg_fqs_fops);\n\n\t \n\tdebugfs_create_file(\"ch_stats\", 0444, dir, priv, &dpaa2_dbg_ch_fops);\n\n\t \n\tdebugfs_create_file(\"bp_stats\", 0444, dir, priv, &dpaa2_dbg_bp_fops);\n\n}\n\nvoid dpaa2_dbg_remove(struct dpaa2_eth_priv *priv)\n{\n\tdebugfs_remove_recursive(priv->dbg.dir);\n}\n\nvoid dpaa2_eth_dbg_init(void)\n{\n\tdpaa2_dbg_root = debugfs_create_dir(DPAA2_ETH_DBG_ROOT, NULL);\n\tpr_debug(\"DPAA2-ETH: debugfs created\\n\");\n}\n\nvoid dpaa2_eth_dbg_exit(void)\n{\n\tdebugfs_remove(dpaa2_dbg_root);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}