{
  "module_name": "dpni.c",
  "hash_id": "f93170a8f978e22f1b6e7a06e842d6a09a10899b2c4c88d79dcbbc8dec7d8a3f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/freescale/dpaa2/dpni.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/fsl/mc.h>\n#include \"dpni.h\"\n#include \"dpni-cmd.h\"\n\n \nint dpni_prepare_key_cfg(const struct dpkg_profile_cfg *cfg, u8 *key_cfg_buf)\n{\n\tint i, j;\n\tstruct dpni_ext_set_rx_tc_dist *dpni_ext;\n\tstruct dpni_dist_extract *extr;\n\n\tif (cfg->num_extracts > DPKG_MAX_NUM_OF_EXTRACTS)\n\t\treturn -EINVAL;\n\n\tdpni_ext = (struct dpni_ext_set_rx_tc_dist *)key_cfg_buf;\n\tdpni_ext->num_extracts = cfg->num_extracts;\n\n\tfor (i = 0; i < cfg->num_extracts; i++) {\n\t\textr = &dpni_ext->extracts[i];\n\n\t\tswitch (cfg->extracts[i].type) {\n\t\tcase DPKG_EXTRACT_FROM_HDR:\n\t\t\textr->prot = cfg->extracts[i].extract.from_hdr.prot;\n\t\t\tdpni_set_field(extr->efh_type, EFH_TYPE,\n\t\t\t\t       cfg->extracts[i].extract.from_hdr.type);\n\t\t\textr->size = cfg->extracts[i].extract.from_hdr.size;\n\t\t\textr->offset = cfg->extracts[i].extract.from_hdr.offset;\n\t\t\textr->field = cpu_to_le32(\n\t\t\t\tcfg->extracts[i].extract.from_hdr.field);\n\t\t\textr->hdr_index =\n\t\t\t\tcfg->extracts[i].extract.from_hdr.hdr_index;\n\t\t\tbreak;\n\t\tcase DPKG_EXTRACT_FROM_DATA:\n\t\t\textr->size = cfg->extracts[i].extract.from_data.size;\n\t\t\textr->offset =\n\t\t\t\tcfg->extracts[i].extract.from_data.offset;\n\t\t\tbreak;\n\t\tcase DPKG_EXTRACT_FROM_PARSE:\n\t\t\textr->size = cfg->extracts[i].extract.from_parse.size;\n\t\t\textr->offset =\n\t\t\t\tcfg->extracts[i].extract.from_parse.offset;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\textr->num_of_byte_masks = cfg->extracts[i].num_of_byte_masks;\n\t\tdpni_set_field(extr->extract_type, EXTRACT_TYPE,\n\t\t\t       cfg->extracts[i].type);\n\n\t\tfor (j = 0; j < DPKG_NUM_OF_MASKS; j++) {\n\t\t\textr->masks[j].mask = cfg->extracts[i].masks[j].mask;\n\t\t\textr->masks[j].offset =\n\t\t\t\tcfg->extracts[i].masks[j].offset;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\n \nint dpni_open(struct fsl_mc_io *mc_io,\n\t      u32 cmd_flags,\n\t      int dpni_id,\n\t      u16 *token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_open *cmd_params;\n\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_OPEN,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  0);\n\tcmd_params = (struct dpni_cmd_open *)cmd.params;\n\tcmd_params->dpni_id = cpu_to_le32(dpni_id);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\t*token = mc_cmd_hdr_read_token(&cmd);\n\n\treturn 0;\n}\n\n \nint dpni_close(struct fsl_mc_io *mc_io,\n\t       u32 cmd_flags,\n\t       u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_CLOSE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_pools(struct fsl_mc_io *mc_io,\n\t\t   u32 cmd_flags,\n\t\t   u16 token,\n\t\t   const struct dpni_pools_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_pools *cmd_params;\n\tint i;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_POOLS,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_pools *)cmd.params;\n\tcmd_params->num_dpbp = cfg->num_dpbp;\n\tcmd_params->pool_options = cfg->pool_options;\n\tfor (i = 0; i < DPNI_MAX_DPBP; i++) {\n\t\tcmd_params->pool[i].dpbp_id =\n\t\t\tcpu_to_le16(cfg->pools[i].dpbp_id);\n\t\tcmd_params->pool[i].priority_mask =\n\t\t\tcfg->pools[i].priority_mask;\n\t\tcmd_params->buffer_size[i] =\n\t\t\tcpu_to_le16(cfg->pools[i].buffer_size);\n\t\tcmd_params->backup_pool_mask |=\n\t\t\tDPNI_BACKUP_POOL(cfg->pools[i].backup_pool, i);\n\t}\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_enable(struct fsl_mc_io *mc_io,\n\t\tu32 cmd_flags,\n\t\tu16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_ENABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_disable(struct fsl_mc_io *mc_io,\n\t\t u32 cmd_flags,\n\t\t u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_DISABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_is_enabled(struct fsl_mc_io *mc_io,\n\t\t    u32 cmd_flags,\n\t\t    u16 token,\n\t\t    int *en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_is_enabled *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_IS_ENABLED,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_is_enabled *)cmd.params;\n\t*en = dpni_get_field(rsp_params->enabled, ENABLE);\n\n\treturn 0;\n}\n\n \nint dpni_reset(struct fsl_mc_io *mc_io,\n\t       u32 cmd_flags,\n\t       u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_RESET,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_irq_enable(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tu8 irq_index,\n\t\t\tu8 en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_irq_enable *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_IRQ_ENABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_irq_enable *)cmd.params;\n\tdpni_set_field(cmd_params->enable, ENABLE, en);\n\tcmd_params->irq_index = irq_index;\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_irq_enable(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tu8 irq_index,\n\t\t\tu8 *en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_irq_enable *cmd_params;\n\tstruct dpni_rsp_get_irq_enable *rsp_params;\n\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_IRQ_ENABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_irq_enable *)cmd.params;\n\tcmd_params->irq_index = irq_index;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_irq_enable *)cmd.params;\n\t*en = dpni_get_field(rsp_params->enabled, ENABLE);\n\n\treturn 0;\n}\n\n \nint dpni_set_irq_mask(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      u8 irq_index,\n\t\t      u32 mask)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_irq_mask *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_IRQ_MASK,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_irq_mask *)cmd.params;\n\tcmd_params->mask = cpu_to_le32(mask);\n\tcmd_params->irq_index = irq_index;\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_irq_mask(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      u8 irq_index,\n\t\t      u32 *mask)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_irq_mask *cmd_params;\n\tstruct dpni_rsp_get_irq_mask *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_IRQ_MASK,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_irq_mask *)cmd.params;\n\tcmd_params->irq_index = irq_index;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_irq_mask *)cmd.params;\n\t*mask = le32_to_cpu(rsp_params->mask);\n\n\treturn 0;\n}\n\n \nint dpni_get_irq_status(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tu8 irq_index,\n\t\t\tu32 *status)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_irq_status *cmd_params;\n\tstruct dpni_rsp_get_irq_status *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_IRQ_STATUS,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_irq_status *)cmd.params;\n\tcmd_params->status = cpu_to_le32(*status);\n\tcmd_params->irq_index = irq_index;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_irq_status *)cmd.params;\n\t*status = le32_to_cpu(rsp_params->status);\n\n\treturn 0;\n}\n\n \nint dpni_clear_irq_status(struct fsl_mc_io *mc_io,\n\t\t\t  u32 cmd_flags,\n\t\t\t  u16 token,\n\t\t\t  u8 irq_index,\n\t\t\t  u32 status)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_clear_irq_status *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_CLEAR_IRQ_STATUS,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_clear_irq_status *)cmd.params;\n\tcmd_params->irq_index = irq_index;\n\tcmd_params->status = cpu_to_le32(status);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_attributes(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tstruct dpni_attr *attr)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_attr *rsp_params;\n\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_ATTR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_attr *)cmd.params;\n\tattr->options = le32_to_cpu(rsp_params->options);\n\tattr->num_queues = rsp_params->num_queues;\n\tattr->num_tcs = rsp_params->num_tcs;\n\tattr->mac_filter_entries = rsp_params->mac_filter_entries;\n\tattr->vlan_filter_entries = rsp_params->vlan_filter_entries;\n\tattr->qos_entries = rsp_params->qos_entries;\n\tattr->fs_entries = le16_to_cpu(rsp_params->fs_entries);\n\tattr->qos_key_size = rsp_params->qos_key_size;\n\tattr->fs_key_size = rsp_params->fs_key_size;\n\tattr->wriop_version = le16_to_cpu(rsp_params->wriop_version);\n\n\treturn 0;\n}\n\n \nint dpni_set_errors_behavior(struct fsl_mc_io *mc_io,\n\t\t\t     u32 cmd_flags,\n\t\t\t     u16 token,\n\t\t\t     struct dpni_error_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_errors_behavior *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_ERRORS_BEHAVIOR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_errors_behavior *)cmd.params;\n\tcmd_params->errors = cpu_to_le32(cfg->errors);\n\tdpni_set_field(cmd_params->flags, ERROR_ACTION, cfg->error_action);\n\tdpni_set_field(cmd_params->flags, FRAME_ANN, cfg->set_frame_annotation);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_buffer_layout(struct fsl_mc_io *mc_io,\n\t\t\t   u32 cmd_flags,\n\t\t\t   u16 token,\n\t\t\t   enum dpni_queue_type qtype,\n\t\t\t   struct dpni_buffer_layout *layout)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_buffer_layout *cmd_params;\n\tstruct dpni_rsp_get_buffer_layout *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_BUFFER_LAYOUT,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_buffer_layout *)cmd.params;\n\tcmd_params->qtype = qtype;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_buffer_layout *)cmd.params;\n\tlayout->pass_timestamp = dpni_get_field(rsp_params->flags, PASS_TS);\n\tlayout->pass_parser_result = dpni_get_field(rsp_params->flags, PASS_PR);\n\tlayout->pass_frame_status = dpni_get_field(rsp_params->flags, PASS_FS);\n\tlayout->private_data_size = le16_to_cpu(rsp_params->private_data_size);\n\tlayout->data_align = le16_to_cpu(rsp_params->data_align);\n\tlayout->data_head_room = le16_to_cpu(rsp_params->head_room);\n\tlayout->data_tail_room = le16_to_cpu(rsp_params->tail_room);\n\n\treturn 0;\n}\n\n \nint dpni_set_buffer_layout(struct fsl_mc_io *mc_io,\n\t\t\t   u32 cmd_flags,\n\t\t\t   u16 token,\n\t\t\t   enum dpni_queue_type qtype,\n\t\t\t   const struct dpni_buffer_layout *layout)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_buffer_layout *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_BUFFER_LAYOUT,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_buffer_layout *)cmd.params;\n\tcmd_params->qtype = qtype;\n\tcmd_params->options = cpu_to_le16(layout->options);\n\tdpni_set_field(cmd_params->flags, PASS_TS, layout->pass_timestamp);\n\tdpni_set_field(cmd_params->flags, PASS_PR, layout->pass_parser_result);\n\tdpni_set_field(cmd_params->flags, PASS_FS, layout->pass_frame_status);\n\tcmd_params->private_data_size = cpu_to_le16(layout->private_data_size);\n\tcmd_params->data_align = cpu_to_le16(layout->data_align);\n\tcmd_params->head_room = cpu_to_le16(layout->data_head_room);\n\tcmd_params->tail_room = cpu_to_le16(layout->data_tail_room);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \n\nint dpni_set_offload(struct fsl_mc_io *mc_io,\n\t\t     u32 cmd_flags,\n\t\t     u16 token,\n\t\t     enum dpni_offload type,\n\t\t     u32 config)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_offload *cmd_params;\n\n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_OFFLOAD,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_offload *)cmd.params;\n\tcmd_params->dpni_offload = type;\n\tcmd_params->config = cpu_to_le32(config);\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\nint dpni_get_offload(struct fsl_mc_io *mc_io,\n\t\t     u32 cmd_flags,\n\t\t     u16 token,\n\t\t     enum dpni_offload type,\n\t\t     u32 *config)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_offload *cmd_params;\n\tstruct dpni_rsp_get_offload *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_OFFLOAD,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_offload *)cmd.params;\n\tcmd_params->dpni_offload = type;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_offload *)cmd.params;\n\t*config = le32_to_cpu(rsp_params->config);\n\n\treturn 0;\n}\n\n \nint dpni_get_qdid(struct fsl_mc_io *mc_io,\n\t\t  u32 cmd_flags,\n\t\t  u16 token,\n\t\t  enum dpni_queue_type qtype,\n\t\t  u16 *qdid)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_qdid *cmd_params;\n\tstruct dpni_rsp_get_qdid *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_QDID,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_qdid *)cmd.params;\n\tcmd_params->qtype = qtype;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_qdid *)cmd.params;\n\t*qdid = le16_to_cpu(rsp_params->qdid);\n\n\treturn 0;\n}\n\n \nint dpni_get_tx_data_offset(struct fsl_mc_io *mc_io,\n\t\t\t    u32 cmd_flags,\n\t\t\t    u16 token,\n\t\t\t    u16 *data_offset)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_tx_data_offset *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_TX_DATA_OFFSET,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_tx_data_offset *)cmd.params;\n\t*data_offset = le16_to_cpu(rsp_params->data_offset);\n\n\treturn 0;\n}\n\n \nint dpni_set_link_cfg(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      const struct dpni_link_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_link_cfg *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_LINK_CFG,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_link_cfg *)cmd.params;\n\tcmd_params->rate = cpu_to_le32(cfg->rate);\n\tcmd_params->options = cpu_to_le64(cfg->options);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_link_cfg(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      struct dpni_link_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_link_cfg *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_LINK_CFG,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_cmd_link_cfg *)cmd.params;\n\tcfg->rate = le32_to_cpu(rsp_params->rate);\n\tcfg->options = le64_to_cpu(rsp_params->options);\n\n\treturn err;\n}\n\n \nint dpni_get_link_state(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tstruct dpni_link_state *state)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_link_state *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_LINK_STATE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_link_state *)cmd.params;\n\tstate->up = dpni_get_field(rsp_params->flags, LINK_STATE);\n\tstate->rate = le32_to_cpu(rsp_params->rate);\n\tstate->options = le64_to_cpu(rsp_params->options);\n\n\treturn 0;\n}\n\n \nint dpni_set_max_frame_length(struct fsl_mc_io *mc_io,\n\t\t\t      u32 cmd_flags,\n\t\t\t      u16 token,\n\t\t\t      u16 max_frame_length)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_max_frame_length *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_MAX_FRAME_LENGTH,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_max_frame_length *)cmd.params;\n\tcmd_params->max_frame_length = cpu_to_le16(max_frame_length);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_max_frame_length(struct fsl_mc_io *mc_io,\n\t\t\t      u32 cmd_flags,\n\t\t\t      u16 token,\n\t\t\t      u16 *max_frame_length)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_max_frame_length *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_MAX_FRAME_LENGTH,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_max_frame_length *)cmd.params;\n\t*max_frame_length = le16_to_cpu(rsp_params->max_frame_length);\n\n\treturn 0;\n}\n\n \nint dpni_set_multicast_promisc(struct fsl_mc_io *mc_io,\n\t\t\t       u32 cmd_flags,\n\t\t\t       u16 token,\n\t\t\t       int en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_multicast_promisc *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_MCAST_PROMISC,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_multicast_promisc *)cmd.params;\n\tdpni_set_field(cmd_params->enable, ENABLE, en);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_multicast_promisc(struct fsl_mc_io *mc_io,\n\t\t\t       u32 cmd_flags,\n\t\t\t       u16 token,\n\t\t\t       int *en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_multicast_promisc *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_MCAST_PROMISC,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_multicast_promisc *)cmd.params;\n\t*en = dpni_get_field(rsp_params->enabled, ENABLE);\n\n\treturn 0;\n}\n\n \nint dpni_set_unicast_promisc(struct fsl_mc_io *mc_io,\n\t\t\t     u32 cmd_flags,\n\t\t\t     u16 token,\n\t\t\t     int en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_unicast_promisc *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_UNICAST_PROMISC,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_unicast_promisc *)cmd.params;\n\tdpni_set_field(cmd_params->enable, ENABLE, en);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_unicast_promisc(struct fsl_mc_io *mc_io,\n\t\t\t     u32 cmd_flags,\n\t\t\t     u16 token,\n\t\t\t     int *en)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_unicast_promisc *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_UNICAST_PROMISC,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_unicast_promisc *)cmd.params;\n\t*en = dpni_get_field(rsp_params->enabled, ENABLE);\n\n\treturn 0;\n}\n\n \nint dpni_set_primary_mac_addr(struct fsl_mc_io *mc_io,\n\t\t\t      u32 cmd_flags,\n\t\t\t      u16 token,\n\t\t\t      const u8 mac_addr[6])\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_primary_mac_addr *cmd_params;\n\tint i;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_PRIM_MAC,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_primary_mac_addr *)cmd.params;\n\tfor (i = 0; i < 6; i++)\n\t\tcmd_params->mac_addr[i] = mac_addr[5 - i];\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_primary_mac_addr(struct fsl_mc_io *mc_io,\n\t\t\t      u32 cmd_flags,\n\t\t\t      u16 token,\n\t\t\t      u8 mac_addr[6])\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_primary_mac_addr *rsp_params;\n\tint i, err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_PRIM_MAC,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_primary_mac_addr *)cmd.params;\n\tfor (i = 0; i < 6; i++)\n\t\tmac_addr[5 - i] = rsp_params->mac_addr[i];\n\n\treturn 0;\n}\n\n \nint dpni_get_port_mac_addr(struct fsl_mc_io *mc_io,\n\t\t\t   u32 cmd_flags,\n\t\t\t   u16 token,\n\t\t\t   u8 mac_addr[6])\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_rsp_get_port_mac_addr *rsp_params;\n\tint i, err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_PORT_MAC_ADDR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_port_mac_addr *)cmd.params;\n\tfor (i = 0; i < 6; i++)\n\t\tmac_addr[5 - i] = rsp_params->mac_addr[i];\n\n\treturn 0;\n}\n\n \nint dpni_enable_vlan_filter(struct fsl_mc_io *mc_io,\n\t\t\t    u32 cmd_flags,\n\t\t\t    u16 token,\n\t\t\t    u32 en)\n{\n\tstruct dpni_cmd_enable_vlan_filter *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_ENABLE_VLAN_FILTER,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_enable_vlan_filter *)cmd.params;\n\tdpni_set_field(cmd_params->en, ENABLE, en);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_add_vlan_id(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t     u16 vlan_id, u8 flags, u8 tc_id, u8 flow_id)\n{\n\tstruct dpni_cmd_vlan_id *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_ADD_VLAN_ID,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_vlan_id *)cmd.params;\n\tcmd_params->flags = flags;\n\tcmd_params->tc_id = tc_id;\n\tcmd_params->flow_id =  flow_id;\n\tcmd_params->vlan_id = cpu_to_le16(vlan_id);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_remove_vlan_id(struct fsl_mc_io *mc_io, u32 cmd_flags, u16 token,\n\t\t\tu16 vlan_id)\n{\n\tstruct dpni_cmd_vlan_id *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_REMOVE_VLAN_ID,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_vlan_id *)cmd.params;\n\tcmd_params->vlan_id = cpu_to_le16(vlan_id);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_add_mac_addr(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      const u8 mac_addr[6])\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_add_mac_addr *cmd_params;\n\tint i;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_ADD_MAC_ADDR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_add_mac_addr *)cmd.params;\n\tfor (i = 0; i < 6; i++)\n\t\tcmd_params->mac_addr[i] = mac_addr[5 - i];\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_remove_mac_addr(struct fsl_mc_io *mc_io,\n\t\t\t u32 cmd_flags,\n\t\t\t u16 token,\n\t\t\t const u8 mac_addr[6])\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_remove_mac_addr *cmd_params;\n\tint i;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_REMOVE_MAC_ADDR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_remove_mac_addr *)cmd.params;\n\tfor (i = 0; i < 6; i++)\n\t\tcmd_params->mac_addr[i] = mac_addr[5 - i];\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_clear_mac_filters(struct fsl_mc_io *mc_io,\n\t\t\t   u32 cmd_flags,\n\t\t\t   u16 token,\n\t\t\t   int unicast,\n\t\t\t   int multicast)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_clear_mac_filters *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_CLR_MAC_FILTERS,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_clear_mac_filters *)cmd.params;\n\tdpni_set_field(cmd_params->flags, UNICAST_FILTERS, unicast);\n\tdpni_set_field(cmd_params->flags, MULTICAST_FILTERS, multicast);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_rx_tc_dist(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tu8 tc_id,\n\t\t\tconst struct dpni_rx_tc_dist_cfg *cfg)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_rx_tc_dist *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_RX_TC_DIST,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_rx_tc_dist *)cmd.params;\n\tcmd_params->dist_size = cpu_to_le16(cfg->dist_size);\n\tcmd_params->tc_id = tc_id;\n\tdpni_set_field(cmd_params->flags, DIST_MODE, cfg->dist_mode);\n\tdpni_set_field(cmd_params->flags, MISS_ACTION, cfg->fs_cfg.miss_action);\n\tcmd_params->default_flow_id = cpu_to_le16(cfg->fs_cfg.default_flow_id);\n\tcmd_params->key_cfg_iova = cpu_to_le64(cfg->key_cfg_iova);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_congestion_notification(\n\t\t\tstruct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tenum dpni_queue_type qtype,\n\t\t\tu8 tc_id,\n\t\t\tconst struct dpni_congestion_notification_cfg *cfg)\n{\n\tstruct dpni_cmd_set_congestion_notification *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header =\n\t\tmc_encode_cmd_header(DPNI_CMDID_SET_CONGESTION_NOTIFICATION,\n\t\t\t\t     cmd_flags,\n\t\t\t\t     token);\n\tcmd_params = (struct dpni_cmd_set_congestion_notification *)cmd.params;\n\tcmd_params->qtype = qtype;\n\tcmd_params->tc = tc_id;\n\tcmd_params->dest_id = cpu_to_le32(cfg->dest_cfg.dest_id);\n\tcmd_params->notification_mode = cpu_to_le16(cfg->notification_mode);\n\tcmd_params->dest_priority = cfg->dest_cfg.priority;\n\tdpni_set_field(cmd_params->type_units, DEST_TYPE,\n\t\t       cfg->dest_cfg.dest_type);\n\tdpni_set_field(cmd_params->type_units, CONG_UNITS, cfg->units);\n\tcmd_params->message_iova = cpu_to_le64(cfg->message_iova);\n\tcmd_params->message_ctx = cpu_to_le64(cfg->message_ctx);\n\tcmd_params->threshold_entry = cpu_to_le32(cfg->threshold_entry);\n\tcmd_params->threshold_exit = cpu_to_le32(cfg->threshold_exit);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_queue(struct fsl_mc_io *mc_io,\n\t\t   u32 cmd_flags,\n\t\t   u16 token,\n\t\t   enum dpni_queue_type qtype,\n\t\t   u8 tc,\n\t\t   u8 index,\n\t\t   u8 options,\n\t\t   const struct dpni_queue *queue)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_queue *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_QUEUE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_queue *)cmd.params;\n\tcmd_params->qtype = qtype;\n\tcmd_params->tc = tc;\n\tcmd_params->index = index;\n\tcmd_params->options = options;\n\tcmd_params->dest_id = cpu_to_le32(queue->destination.id);\n\tcmd_params->dest_prio = queue->destination.priority;\n\tdpni_set_field(cmd_params->flags, DEST_TYPE, queue->destination.type);\n\tdpni_set_field(cmd_params->flags, STASH_CTRL, queue->flc.stash_control);\n\tdpni_set_field(cmd_params->flags, HOLD_ACTIVE,\n\t\t       queue->destination.hold_active);\n\tcmd_params->flc = cpu_to_le64(queue->flc.value);\n\tcmd_params->user_context = cpu_to_le64(queue->user_context);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_queue(struct fsl_mc_io *mc_io,\n\t\t   u32 cmd_flags,\n\t\t   u16 token,\n\t\t   enum dpni_queue_type qtype,\n\t\t   u8 tc,\n\t\t   u8 index,\n\t\t   struct dpni_queue *queue,\n\t\t   struct dpni_queue_id *qid)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_queue *cmd_params;\n\tstruct dpni_rsp_get_queue *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_QUEUE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_queue *)cmd.params;\n\tcmd_params->qtype = qtype;\n\tcmd_params->tc = tc;\n\tcmd_params->index = index;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_queue *)cmd.params;\n\tqueue->destination.id = le32_to_cpu(rsp_params->dest_id);\n\tqueue->destination.priority = rsp_params->dest_prio;\n\tqueue->destination.type = dpni_get_field(rsp_params->flags,\n\t\t\t\t\t\t DEST_TYPE);\n\tqueue->flc.stash_control = dpni_get_field(rsp_params->flags,\n\t\t\t\t\t\t  STASH_CTRL);\n\tqueue->destination.hold_active = dpni_get_field(rsp_params->flags,\n\t\t\t\t\t\t\tHOLD_ACTIVE);\n\tqueue->flc.value = le64_to_cpu(rsp_params->flc);\n\tqueue->user_context = le64_to_cpu(rsp_params->user_context);\n\tqid->fqid = le32_to_cpu(rsp_params->fqid);\n\tqid->qdbin = le16_to_cpu(rsp_params->qdbin);\n\n\treturn 0;\n}\n\n \nint dpni_get_statistics(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tu8 page,\n\t\t\tunion dpni_statistics *stat)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_statistics *cmd_params;\n\tstruct dpni_rsp_get_statistics *rsp_params;\n\tint i, err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_STATISTICS,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_statistics *)cmd.params;\n\tcmd_params->page_number = page;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_statistics *)cmd.params;\n\tfor (i = 0; i < DPNI_STATISTICS_CNT; i++)\n\t\tstat->raw.counter[i] = le64_to_cpu(rsp_params->counter[i]);\n\n\treturn 0;\n}\n\n \nint dpni_set_taildrop(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      enum dpni_congestion_point cg_point,\n\t\t      enum dpni_queue_type qtype,\n\t\t      u8 tc,\n\t\t      u8 index,\n\t\t      struct dpni_taildrop *taildrop)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_set_taildrop *cmd_params;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_TAILDROP,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_taildrop *)cmd.params;\n\tcmd_params->congestion_point = cg_point;\n\tcmd_params->qtype = qtype;\n\tcmd_params->tc = tc;\n\tcmd_params->index = index;\n\tdpni_set_field(cmd_params->enable, ENABLE, taildrop->enable);\n\tcmd_params->units = taildrop->units;\n\tcmd_params->threshold = cpu_to_le32(taildrop->threshold);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_taildrop(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      enum dpni_congestion_point cg_point,\n\t\t      enum dpni_queue_type qtype,\n\t\t      u8 tc,\n\t\t      u8 index,\n\t\t      struct dpni_taildrop *taildrop)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpni_cmd_get_taildrop *cmd_params;\n\tstruct dpni_rsp_get_taildrop *rsp_params;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_TAILDROP,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_get_taildrop *)cmd.params;\n\tcmd_params->congestion_point = cg_point;\n\tcmd_params->qtype = qtype;\n\tcmd_params->tc = tc;\n\tcmd_params->index = index;\n\n\t \n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_get_taildrop *)cmd.params;\n\ttaildrop->enable = dpni_get_field(rsp_params->enable, ENABLE);\n\ttaildrop->units = rsp_params->units;\n\ttaildrop->threshold = le32_to_cpu(rsp_params->threshold);\n\n\treturn 0;\n}\n\n \nint dpni_get_api_version(struct fsl_mc_io *mc_io,\n\t\t\t u32 cmd_flags,\n\t\t\t u16 *major_ver,\n\t\t\t u16 *minor_ver)\n{\n\tstruct dpni_rsp_get_api_version *rsp_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_API_VERSION,\n\t\t\t\t\t  cmd_flags, 0);\n\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\trsp_params = (struct dpni_rsp_get_api_version *)cmd.params;\n\t*major_ver = le16_to_cpu(rsp_params->major);\n\t*minor_ver = le16_to_cpu(rsp_params->minor);\n\n\treturn 0;\n}\n\n \nint dpni_set_rx_fs_dist(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tconst struct dpni_rx_dist_cfg *cfg)\n{\n\tstruct dpni_cmd_set_rx_fs_dist *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_RX_FS_DIST,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_rx_fs_dist *)cmd.params;\n\tcmd_params->dist_size = cpu_to_le16(cfg->dist_size);\n\tdpni_set_field(cmd_params->enable, RX_FS_DIST_ENABLE, cfg->enable);\n\tcmd_params->tc = cfg->tc;\n\tcmd_params->miss_flow_id = cpu_to_le16(cfg->fs_miss_flow_id);\n\tcmd_params->key_cfg_iova = cpu_to_le64(cfg->key_cfg_iova);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_rx_hash_dist(struct fsl_mc_io *mc_io,\n\t\t\t  u32 cmd_flags,\n\t\t\t  u16 token,\n\t\t\t  const struct dpni_rx_dist_cfg *cfg)\n{\n\tstruct dpni_cmd_set_rx_hash_dist *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_RX_HASH_DIST,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_rx_hash_dist *)cmd.params;\n\tcmd_params->dist_size = cpu_to_le16(cfg->dist_size);\n\tdpni_set_field(cmd_params->enable, RX_HASH_DIST_ENABLE, cfg->enable);\n\tcmd_params->tc = cfg->tc;\n\tcmd_params->key_cfg_iova = cpu_to_le64(cfg->key_cfg_iova);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_add_fs_entry(struct fsl_mc_io *mc_io,\n\t\t      u32 cmd_flags,\n\t\t      u16 token,\n\t\t      u8 tc_id,\n\t\t      u16 index,\n\t\t      const struct dpni_rule_cfg *cfg,\n\t\t      const struct dpni_fs_action_cfg *action)\n{\n\tstruct dpni_cmd_add_fs_entry *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_ADD_FS_ENT,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_add_fs_entry *)cmd.params;\n\tcmd_params->tc_id = tc_id;\n\tcmd_params->key_size = cfg->key_size;\n\tcmd_params->index = cpu_to_le16(index);\n\tcmd_params->key_iova = cpu_to_le64(cfg->key_iova);\n\tcmd_params->mask_iova = cpu_to_le64(cfg->mask_iova);\n\tcmd_params->options = cpu_to_le16(action->options);\n\tcmd_params->flow_id = cpu_to_le16(action->flow_id);\n\tcmd_params->flc = cpu_to_le64(action->flc);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_remove_fs_entry(struct fsl_mc_io *mc_io,\n\t\t\t u32 cmd_flags,\n\t\t\t u16 token,\n\t\t\t u8 tc_id,\n\t\t\t const struct dpni_rule_cfg *cfg)\n{\n\tstruct dpni_cmd_remove_fs_entry *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_REMOVE_FS_ENT,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_remove_fs_entry *)cmd.params;\n\tcmd_params->tc_id = tc_id;\n\tcmd_params->key_size = cfg->key_size;\n\tcmd_params->key_iova = cpu_to_le64(cfg->key_iova);\n\tcmd_params->mask_iova = cpu_to_le64(cfg->mask_iova);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_qos_table(struct fsl_mc_io *mc_io,\n\t\t       u32 cmd_flags,\n\t\t       u16 token,\n\t\t       const struct dpni_qos_tbl_cfg *cfg)\n{\n\tstruct dpni_cmd_set_qos_table *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_QOS_TBL,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_qos_table *)cmd.params;\n\tcmd_params->default_tc = cfg->default_tc;\n\tcmd_params->key_cfg_iova = cpu_to_le64(cfg->key_cfg_iova);\n\tdpni_set_field(cmd_params->discard_on_miss, DISCARD_ON_MISS,\n\t\t       cfg->discard_on_miss);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_add_qos_entry(struct fsl_mc_io *mc_io,\n\t\t       u32 cmd_flags,\n\t\t       u16 token,\n\t\t       const struct dpni_rule_cfg *cfg,\n\t\t       u8 tc_id,\n\t\t       u16 index)\n{\n\tstruct dpni_cmd_add_qos_entry *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_ADD_QOS_ENT,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_add_qos_entry *)cmd.params;\n\tcmd_params->tc_id = tc_id;\n\tcmd_params->key_size = cfg->key_size;\n\tcmd_params->index = cpu_to_le16(index);\n\tcmd_params->key_iova = cpu_to_le64(cfg->key_iova);\n\tcmd_params->mask_iova = cpu_to_le64(cfg->mask_iova);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_remove_qos_entry(struct fsl_mc_io *mc_io,\n\t\t\t  u32 cmd_flags,\n\t\t\t  u16 token,\n\t\t\t  const struct dpni_rule_cfg *cfg)\n{\n\tstruct dpni_cmd_remove_qos_entry *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_REMOVE_QOS_ENT,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_remove_qos_entry *)cmd.params;\n\tcmd_params->key_size = cfg->key_size;\n\tcmd_params->key_iova = cpu_to_le64(cfg->key_iova);\n\tcmd_params->mask_iova = cpu_to_le64(cfg->mask_iova);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_clear_qos_table(struct fsl_mc_io *mc_io,\n\t\t\t u32 cmd_flags,\n\t\t\t u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_CLR_QOS_TBL,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_set_tx_shaping(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tconst struct dpni_tx_shaping_cfg *tx_cr_shaper,\n\t\t\tconst struct dpni_tx_shaping_cfg *tx_er_shaper,\n\t\t\tint coupled)\n{\n\tstruct dpni_cmd_set_tx_shaping *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_TX_SHAPING,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\tcmd_params = (struct dpni_cmd_set_tx_shaping *)cmd.params;\n\tcmd_params->tx_cr_max_burst_size = cpu_to_le16(tx_cr_shaper->max_burst_size);\n\tcmd_params->tx_er_max_burst_size = cpu_to_le16(tx_er_shaper->max_burst_size);\n\tcmd_params->tx_cr_rate_limit = cpu_to_le32(tx_cr_shaper->rate_limit);\n\tcmd_params->tx_er_rate_limit = cpu_to_le32(tx_er_shaper->rate_limit);\n\tdpni_set_field(cmd_params->coupled, COUPLED, coupled);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpni_get_single_step_cfg(struct fsl_mc_io *mc_io,\n\t\t\t     u32 cmd_flags,\n\t\t\t     u16 token,\n\t\t\t     struct dpni_single_step_cfg *ptp_cfg)\n{\n\tstruct dpni_rsp_single_step_cfg *rsp_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_GET_SINGLE_STEP_CFG,\n\t\t\t\t\t  cmd_flags, token);\n\t \n\terr =  mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\trsp_params = (struct dpni_rsp_single_step_cfg *)cmd.params;\n\tptp_cfg->offset = le16_to_cpu(rsp_params->offset);\n\tptp_cfg->en = dpni_get_field(le16_to_cpu(rsp_params->flags),\n\t\t\t\t     PTP_ENABLE) ? 1 : 0;\n\tptp_cfg->ch_update = dpni_get_field(le16_to_cpu(rsp_params->flags),\n\t\t\t\t\t    PTP_CH_UPDATE) ? 1 : 0;\n\tptp_cfg->peer_delay = le32_to_cpu(rsp_params->peer_delay);\n\tptp_cfg->ptp_onestep_reg_base =\n\t\t\t\t  le32_to_cpu(rsp_params->ptp_onestep_reg_base);\n\n\treturn err;\n}\n\n \nint dpni_set_single_step_cfg(struct fsl_mc_io *mc_io,\n\t\t\t     u32 cmd_flags,\n\t\t\t     u16 token,\n\t\t\t     struct dpni_single_step_cfg *ptp_cfg)\n{\n\tstruct dpni_cmd_single_step_cfg *cmd_params;\n\tstruct fsl_mc_command cmd = { 0 };\n\tu16 flags;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPNI_CMDID_SET_SINGLE_STEP_CFG,\n\t\t\t\t\t  cmd_flags, token);\n\tcmd_params = (struct dpni_cmd_single_step_cfg *)cmd.params;\n\tcmd_params->offset = cpu_to_le16(ptp_cfg->offset);\n\tcmd_params->peer_delay = cpu_to_le32(ptp_cfg->peer_delay);\n\n\tflags = le16_to_cpu(cmd_params->flags);\n\tdpni_set_field(flags, PTP_ENABLE, !!ptp_cfg->en);\n\tdpni_set_field(flags, PTP_CH_UPDATE, !!ptp_cfg->ch_update);\n\tcmd_params->flags = cpu_to_le16(flags);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}