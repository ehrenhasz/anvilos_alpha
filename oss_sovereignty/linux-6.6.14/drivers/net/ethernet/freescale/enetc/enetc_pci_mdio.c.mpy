{
  "module_name": "enetc_pci_mdio.c",
  "hash_id": "9e4713cf5ff9dc0a326499bac90ca2b3fcf3eea7df6ad47a53bdc0c29712f5e4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/freescale/enetc/enetc_pci_mdio.c",
  "human_readable_source": "\n \n#include <linux/fsl/enetc_mdio.h>\n#include <linux/of_mdio.h>\n#include \"enetc_pf.h\"\n\n#define ENETC_MDIO_DEV_ID\t0xee01\n#define ENETC_MDIO_DEV_NAME\t\"FSL PCIe IE Central MDIO\"\n#define ENETC_MDIO_BUS_NAME\tENETC_MDIO_DEV_NAME \" Bus\"\n#define ENETC_MDIO_DRV_NAME\tENETC_MDIO_DEV_NAME \" driver\"\n\nstatic int enetc_pci_mdio_probe(struct pci_dev *pdev,\n\t\t\t\tconst struct pci_device_id *ent)\n{\n\tstruct enetc_mdio_priv *mdio_priv;\n\tstruct device *dev = &pdev->dev;\n\tvoid __iomem *port_regs;\n\tstruct enetc_hw *hw;\n\tstruct mii_bus *bus;\n\tint err;\n\n\tport_regs = pci_iomap(pdev, 0, 0);\n\tif (!port_regs) {\n\t\tdev_err(dev, \"iomap failed\\n\");\n\t\terr = -ENXIO;\n\t\tgoto err_ioremap;\n\t}\n\n\thw = enetc_hw_alloc(dev, port_regs);\n\tif (IS_ERR(hw)) {\n\t\terr = PTR_ERR(hw);\n\t\tgoto err_hw_alloc;\n\t}\n\n\tbus = devm_mdiobus_alloc_size(dev, sizeof(*mdio_priv));\n\tif (!bus) {\n\t\terr = -ENOMEM;\n\t\tgoto err_mdiobus_alloc;\n\t}\n\n\tbus->name = ENETC_MDIO_BUS_NAME;\n\tbus->read = enetc_mdio_read_c22;\n\tbus->write = enetc_mdio_write_c22;\n\tbus->read_c45 = enetc_mdio_read_c45;\n\tbus->write_c45 = enetc_mdio_write_c45;\n\tbus->parent = dev;\n\tmdio_priv = bus->priv;\n\tmdio_priv->hw = hw;\n\tmdio_priv->mdio_base = ENETC_EMDIO_BASE;\n\tsnprintf(bus->id, MII_BUS_ID_SIZE, \"%s\", dev_name(dev));\n\n\tpcie_flr(pdev);\n\terr = pci_enable_device_mem(pdev);\n\tif (err) {\n\t\tdev_err(dev, \"device enable failed\\n\");\n\t\tgoto err_pci_enable;\n\t}\n\n\terr = pci_request_region(pdev, 0, KBUILD_MODNAME);\n\tif (err) {\n\t\tdev_err(dev, \"pci_request_region failed\\n\");\n\t\tgoto err_pci_mem_reg;\n\t}\n\n\terr = of_mdiobus_register(bus, dev->of_node);\n\tif (err)\n\t\tgoto err_mdiobus_reg;\n\n\tpci_set_drvdata(pdev, bus);\n\n\treturn 0;\n\nerr_mdiobus_reg:\n\tpci_release_region(pdev, 0);\nerr_pci_mem_reg:\n\tpci_disable_device(pdev);\nerr_pci_enable:\nerr_mdiobus_alloc:\nerr_hw_alloc:\n\tiounmap(port_regs);\nerr_ioremap:\n\treturn err;\n}\n\nstatic void enetc_pci_mdio_remove(struct pci_dev *pdev)\n{\n\tstruct mii_bus *bus = pci_get_drvdata(pdev);\n\tstruct enetc_mdio_priv *mdio_priv;\n\n\tmdiobus_unregister(bus);\n\tmdio_priv = bus->priv;\n\tiounmap(mdio_priv->hw->port);\n\tpci_release_region(pdev, 0);\n\tpci_disable_device(pdev);\n}\n\nstatic const struct pci_device_id enetc_pci_mdio_id_table[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_FREESCALE, ENETC_MDIO_DEV_ID) },\n\t{ 0, }  \n};\nMODULE_DEVICE_TABLE(pci, enetc_pci_mdio_id_table);\n\nstatic struct pci_driver enetc_pci_mdio_driver = {\n\t.name = KBUILD_MODNAME,\n\t.id_table = enetc_pci_mdio_id_table,\n\t.probe = enetc_pci_mdio_probe,\n\t.remove = enetc_pci_mdio_remove,\n};\nmodule_pci_driver(enetc_pci_mdio_driver);\n\nMODULE_DESCRIPTION(ENETC_MDIO_DRV_NAME);\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}