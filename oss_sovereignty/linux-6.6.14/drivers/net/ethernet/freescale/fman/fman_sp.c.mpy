{
  "module_name": "fman_sp.c",
  "hash_id": "8662a257ad48a489772e2a31d1871f0cbbd07674649f512922c50a8a9da38b59",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/freescale/fman/fman_sp.c",
  "human_readable_source": "\n \n\n#include \"fman_sp.h\"\n#include \"fman.h\"\n\nvoid fman_sp_set_buf_pools_in_asc_order_of_buf_sizes(struct fman_ext_pools\n\t\t\t\t\t\t     *fm_ext_pools,\n\t\t\t\t\t\t     u8 *ordered_array,\n\t\t\t\t\t\t     u16 *sizes_array)\n{\n\tu16 buf_size = 0;\n\tint i = 0, j = 0, k = 0;\n\n\t \n\tfor (i = 0; i < fm_ext_pools->num_of_pools_used; i++) {\n\t\t \n\t\tbuf_size = fm_ext_pools->ext_buf_pool[i].size;\n\n\t\t \n\t\tsizes_array[fm_ext_pools->ext_buf_pool[i].id] = buf_size;\n\n\t\t \n\t\tfor (j = 0; j <= i; j++) {\n\t\t\t \n\t\t\tif (j == i)\n\t\t\t\tordered_array[i] =\n\t\t\t\t    fm_ext_pools->ext_buf_pool[i].id;\n\t\t\telse {\n\t\t\t\t \n\t\t\t\tif (buf_size < sizes_array[ordered_array[j]]) {\n\t\t\t\t\t \n\t\t\t\t\tfor (k = i; k > j; k--)\n\t\t\t\t\t\tordered_array[k] =\n\t\t\t\t\t\t    ordered_array[k - 1];\n\n\t\t\t\t\t \n\t\t\t\t\tordered_array[k] =\n\t\t\t\t\t    fm_ext_pools->ext_buf_pool[i].id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\nEXPORT_SYMBOL(fman_sp_set_buf_pools_in_asc_order_of_buf_sizes);\n\nint fman_sp_build_buffer_struct(struct fman_sp_int_context_data_copy *\n\t\t\t\tint_context_data_copy,\n\t\t\t\tstruct fman_buffer_prefix_content *\n\t\t\t\tbuffer_prefix_content,\n\t\t\t\tstruct fman_sp_buf_margins *buf_margins,\n\t\t\t\tstruct fman_sp_buffer_offsets *buffer_offsets,\n\t\t\t\tu8 *internal_buf_offset)\n{\n\tu32 tmp;\n\n\t \n\tint_context_data_copy->ext_buf_offset = (u16)\n\t\t((buffer_prefix_content->priv_data_size & (OFFSET_UNITS - 1)) ?\n\t\t((buffer_prefix_content->priv_data_size + OFFSET_UNITS) &\n\t\t\t~(u16)(OFFSET_UNITS - 1)) :\n\t\tbuffer_prefix_content->priv_data_size);\n\n\t \n\t \n\tbuffer_offsets->prs_result_offset = (u32)ILLEGAL_BASE;\n\tbuffer_offsets->time_stamp_offset = (u32)ILLEGAL_BASE;\n\tbuffer_offsets->hash_result_offset = (u32)ILLEGAL_BASE;\n\n\t \n\n\t \n\t \n\tint_context_data_copy->size =\n\t    (u16)((buffer_prefix_content->pass_prs_result ? 32 : 0) +\n\t\t  ((buffer_prefix_content->pass_time_stamp ||\n\t\t  buffer_prefix_content->pass_hash_result) ? 16 : 0));\n\n\t \n\tint_context_data_copy->int_context_offset =\n\t    (u8)(buffer_prefix_content->pass_prs_result ? 32 :\n\t\t ((buffer_prefix_content->pass_time_stamp ||\n\t\t buffer_prefix_content->pass_hash_result) ? 64 : 0));\n\n\tif (buffer_prefix_content->pass_prs_result)\n\t\tbuffer_offsets->prs_result_offset =\n\t\t    int_context_data_copy->ext_buf_offset;\n\tif (buffer_prefix_content->pass_time_stamp)\n\t\tbuffer_offsets->time_stamp_offset =\n\t\t    buffer_prefix_content->pass_prs_result ?\n\t\t    (int_context_data_copy->ext_buf_offset +\n\t\t\tsizeof(struct fman_prs_result)) :\n\t\t    int_context_data_copy->ext_buf_offset;\n\tif (buffer_prefix_content->pass_hash_result)\n\t\t \n\t\tbuffer_offsets->hash_result_offset =\n\t\tbuffer_prefix_content->pass_prs_result ?\n\t\t\t(int_context_data_copy->ext_buf_offset +\n\t\t\t\tsizeof(struct fman_prs_result) + 8) :\n\t\t\tint_context_data_copy->ext_buf_offset + 8;\n\n\tif (int_context_data_copy->size)\n\t\tbuf_margins->start_margins =\n\t\t    (u16)(int_context_data_copy->ext_buf_offset +\n\t\t\t  int_context_data_copy->size);\n\telse\n\t\t \n\t\tbuf_margins->start_margins =\n\t\t    buffer_prefix_content->priv_data_size;\n\n\t \n\ttmp = (u32)(buf_margins->start_margins %\n\t\t    buffer_prefix_content->data_align);\n\tif (tmp)\n\t\tbuf_margins->start_margins +=\n\t\t    (buffer_prefix_content->data_align - tmp);\n\tbuffer_offsets->data_offset = buf_margins->start_margins;\n\n\treturn 0;\n}\nEXPORT_SYMBOL(fman_sp_build_buffer_struct);\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}