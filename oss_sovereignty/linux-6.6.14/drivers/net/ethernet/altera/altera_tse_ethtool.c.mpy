{
  "module_name": "altera_tse_ethtool.c",
  "hash_id": "bca09d5edee3344020ddd25c3359678242dab51adf82b7c61960550603aa8864",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/altera/altera_tse_ethtool.c",
  "human_readable_source": "\n \n\n#include <linux/ethtool.h>\n#include <linux/kernel.h>\n#include <linux/netdevice.h>\n#include <linux/phy.h>\n\n#include \"altera_tse.h\"\n\n#define TSE_STATS_LEN\t31\n#define TSE_NUM_REGS\t128\n\nstatic char const stat_gstrings[][ETH_GSTRING_LEN] = {\n\t\"tx_packets\",\n\t\"rx_packets\",\n\t\"rx_crc_errors\",\n\t\"rx_align_errors\",\n\t\"tx_bytes\",\n\t\"rx_bytes\",\n\t\"tx_pause\",\n\t\"rx_pause\",\n\t\"rx_errors\",\n\t\"tx_errors\",\n\t\"rx_unicast\",\n\t\"rx_multicast\",\n\t\"rx_broadcast\",\n\t\"tx_discards\",\n\t\"tx_unicast\",\n\t\"tx_multicast\",\n\t\"tx_broadcast\",\n\t\"ether_drops\",\n\t\"rx_total_bytes\",\n\t\"rx_total_packets\",\n\t\"rx_undersize\",\n\t\"rx_oversize\",\n\t\"rx_64_bytes\",\n\t\"rx_65_127_bytes\",\n\t\"rx_128_255_bytes\",\n\t\"rx_256_511_bytes\",\n\t\"rx_512_1023_bytes\",\n\t\"rx_1024_1518_bytes\",\n\t\"rx_gte_1519_bytes\",\n\t\"rx_jabbers\",\n\t\"rx_runts\",\n};\n\nstatic void tse_get_drvinfo(struct net_device *dev,\n\t\t\t    struct ethtool_drvinfo *info)\n{\n\tstruct altera_tse_private *priv = netdev_priv(dev);\n\tu32 rev = ioread32(&priv->mac_dev->megacore_revision);\n\n\tstrcpy(info->driver, \"altera_tse\");\n\tsnprintf(info->fw_version, ETHTOOL_FWVERS_LEN, \"v%d.%d\",\n\t\t rev & 0xFFFF, (rev & 0xFFFF0000) >> 16);\n\tsprintf(info->bus_info, \"platform\");\n}\n\n \nstatic void tse_gstrings(struct net_device *dev, u32 stringset, u8 *buf)\n{\n\tmemcpy(buf, stat_gstrings, TSE_STATS_LEN * ETH_GSTRING_LEN);\n}\n\nstatic void tse_fill_stats(struct net_device *dev, struct ethtool_stats *dummy,\n\t\t\t   u64 *buf)\n{\n\tstruct altera_tse_private *priv = netdev_priv(dev);\n\tu64 ext;\n\n\tbuf[0] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(frames_transmitted_ok));\n\tbuf[1] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(frames_received_ok));\n\tbuf[2] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(frames_check_sequence_errors));\n\tbuf[3] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(alignment_errors));\n\n\t \n\text = (u64) csrrd32(priv->mac_dev,\n\t\t\t    tse_csroffs(msb_octets_transmitted_ok)) << 32;\n\n\text |= csrrd32(priv->mac_dev,\n\t\t       tse_csroffs(octets_transmitted_ok));\n\tbuf[4] = ext;\n\n\t \n\text = (u64) csrrd32(priv->mac_dev,\n\t\t\t    tse_csroffs(msb_octets_received_ok)) << 32;\n\n\text |= csrrd32(priv->mac_dev,\n\t\t       tse_csroffs(octets_received_ok));\n\tbuf[5] = ext;\n\n\tbuf[6] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(tx_pause_mac_ctrl_frames));\n\tbuf[7] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(rx_pause_mac_ctrl_frames));\n\tbuf[8] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(if_in_errors));\n\tbuf[9] = csrrd32(priv->mac_dev,\n\t\t\t tse_csroffs(if_out_errors));\n\tbuf[10] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(if_in_ucast_pkts));\n\tbuf[11] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(if_in_multicast_pkts));\n\tbuf[12] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(if_in_broadcast_pkts));\n\tbuf[13] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(if_out_discards));\n\tbuf[14] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(if_out_ucast_pkts));\n\tbuf[15] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(if_out_multicast_pkts));\n\tbuf[16] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(if_out_broadcast_pkts));\n\tbuf[17] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_drop_events));\n\n\t \n\text = (u64) csrrd32(priv->mac_dev,\n\t\t\t    tse_csroffs(msb_ether_stats_octets)) << 32;\n\text |= csrrd32(priv->mac_dev,\n\t\t       tse_csroffs(ether_stats_octets));\n\tbuf[18] = ext;\n\n\tbuf[19] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts));\n\tbuf[20] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_undersize_pkts));\n\tbuf[21] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_oversize_pkts));\n\tbuf[22] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts_64_octets));\n\tbuf[23] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts_65to127_octets));\n\tbuf[24] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts_128to255_octets));\n\tbuf[25] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts_256to511_octets));\n\tbuf[26] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts_512to1023_octets));\n\tbuf[27] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts_1024to1518_octets));\n\tbuf[28] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_pkts_1519tox_octets));\n\tbuf[29] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_jabbers));\n\tbuf[30] = csrrd32(priv->mac_dev,\n\t\t\t  tse_csroffs(ether_stats_fragments));\n}\n\nstatic int tse_sset_count(struct net_device *dev, int sset)\n{\n\tswitch (sset) {\n\tcase ETH_SS_STATS:\n\t\treturn TSE_STATS_LEN;\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n\nstatic u32 tse_get_msglevel(struct net_device *dev)\n{\n\tstruct altera_tse_private *priv = netdev_priv(dev);\n\treturn priv->msg_enable;\n}\n\nstatic void tse_set_msglevel(struct net_device *dev, uint32_t data)\n{\n\tstruct altera_tse_private *priv = netdev_priv(dev);\n\tpriv->msg_enable = data;\n}\n\nstatic int tse_reglen(struct net_device *dev)\n{\n\treturn TSE_NUM_REGS * sizeof(u32);\n}\n\nstatic void tse_get_regs(struct net_device *dev, struct ethtool_regs *regs,\n\t\t\t void *regbuf)\n{\n\tstruct altera_tse_private *priv = netdev_priv(dev);\n\tu32 *buf = regbuf;\n\tint i;\n\n\t \n\n\tregs->version = 1;\n\n\tfor (i = 0; i < TSE_NUM_REGS; i++)\n\t\tbuf[i] = csrrd32(priv->mac_dev, i * 4);\n}\n\nstatic int tse_ethtool_set_link_ksettings(struct net_device *dev,\n\t\t\t\t\t  const struct ethtool_link_ksettings *cmd)\n{\n\tstruct altera_tse_private *priv = netdev_priv(dev);\n\n\treturn phylink_ethtool_ksettings_set(priv->phylink, cmd);\n}\n\nstatic int tse_ethtool_get_link_ksettings(struct net_device *dev,\n\t\t\t\t\t  struct ethtool_link_ksettings *cmd)\n{\n\tstruct altera_tse_private *priv = netdev_priv(dev);\n\n\treturn phylink_ethtool_ksettings_get(priv->phylink, cmd);\n}\n\nstatic const struct ethtool_ops tse_ethtool_ops = {\n\t.get_drvinfo = tse_get_drvinfo,\n\t.get_regs_len = tse_reglen,\n\t.get_regs = tse_get_regs,\n\t.get_link = ethtool_op_get_link,\n\t.get_strings = tse_gstrings,\n\t.get_sset_count = tse_sset_count,\n\t.get_ethtool_stats = tse_fill_stats,\n\t.get_msglevel = tse_get_msglevel,\n\t.set_msglevel = tse_set_msglevel,\n\t.get_link_ksettings = tse_ethtool_get_link_ksettings,\n\t.set_link_ksettings = tse_ethtool_set_link_ksettings,\n\t.get_ts_info = ethtool_op_get_ts_info,\n};\n\nvoid altera_tse_set_ethtool_ops(struct net_device *netdev)\n{\n\tnetdev->ethtool_ops = &tse_ethtool_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}