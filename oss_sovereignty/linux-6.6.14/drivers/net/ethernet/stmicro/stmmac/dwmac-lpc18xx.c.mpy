{
  "module_name": "dwmac-lpc18xx.c",
  "hash_id": "c978560d73955d8f09b7c50bb8a3cabecbca2ab594203d7e199723456da8312d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/stmicro/stmmac/dwmac-lpc18xx.c",
  "human_readable_source": " \n\n#include <linux/mfd/syscon.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_net.h>\n#include <linux/phy.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/stmmac.h>\n\n#include \"stmmac_platform.h\"\n\n \n#define LPC18XX_CREG_CREG6\t\t\t0x12c\n# define LPC18XX_CREG_CREG6_ETHMODE_MASK\t0x7\n# define LPC18XX_CREG_CREG6_ETHMODE_MII\t\t0x0\n# define LPC18XX_CREG_CREG6_ETHMODE_RMII\t0x4\n\nstatic int lpc18xx_dwmac_probe(struct platform_device *pdev)\n{\n\tstruct plat_stmmacenet_data *plat_dat;\n\tstruct stmmac_resources stmmac_res;\n\tstruct regmap *reg;\n\tu8 ethmode;\n\tint ret;\n\n\tret = stmmac_get_platform_resources(pdev, &stmmac_res);\n\tif (ret)\n\t\treturn ret;\n\n\tplat_dat = stmmac_probe_config_dt(pdev, stmmac_res.mac);\n\tif (IS_ERR(plat_dat))\n\t\treturn PTR_ERR(plat_dat);\n\n\tplat_dat->has_gmac = true;\n\n\treg = syscon_regmap_lookup_by_compatible(\"nxp,lpc1850-creg\");\n\tif (IS_ERR(reg)) {\n\t\tdev_err(&pdev->dev, \"syscon lookup failed\\n\");\n\t\tret = PTR_ERR(reg);\n\t\tgoto err_remove_config_dt;\n\t}\n\n\tif (plat_dat->mac_interface == PHY_INTERFACE_MODE_MII) {\n\t\tethmode = LPC18XX_CREG_CREG6_ETHMODE_MII;\n\t} else if (plat_dat->mac_interface == PHY_INTERFACE_MODE_RMII) {\n\t\tethmode = LPC18XX_CREG_CREG6_ETHMODE_RMII;\n\t} else {\n\t\tdev_err(&pdev->dev, \"Only MII and RMII mode supported\\n\");\n\t\tret = -EINVAL;\n\t\tgoto err_remove_config_dt;\n\t}\n\n\tregmap_update_bits(reg, LPC18XX_CREG_CREG6,\n\t\t\t   LPC18XX_CREG_CREG6_ETHMODE_MASK, ethmode);\n\n\tret = stmmac_dvr_probe(&pdev->dev, plat_dat, &stmmac_res);\n\tif (ret)\n\t\tgoto err_remove_config_dt;\n\n\treturn 0;\n\nerr_remove_config_dt:\n\tstmmac_remove_config_dt(pdev, plat_dat);\n\n\treturn ret;\n}\n\nstatic const struct of_device_id lpc18xx_dwmac_match[] = {\n\t{ .compatible = \"nxp,lpc1850-dwmac\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, lpc18xx_dwmac_match);\n\nstatic struct platform_driver lpc18xx_dwmac_driver = {\n\t.probe  = lpc18xx_dwmac_probe,\n\t.remove_new = stmmac_pltfr_remove,\n\t.driver = {\n\t\t.name           = \"lpc18xx-dwmac\",\n\t\t.pm\t\t= &stmmac_pltfr_pm_ops,\n\t\t.of_match_table = lpc18xx_dwmac_match,\n\t},\n};\nmodule_platform_driver(lpc18xx_dwmac_driver);\n\nMODULE_AUTHOR(\"Joachim Eastwood <manabian@gmail.com>\");\nMODULE_DESCRIPTION(\"DWMAC glue for LPC18xx/43xx Ethernet\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}