{
  "module_name": "dwmac-meson.c",
  "hash_id": "8518cd105444fc69bb5bd49b23d822766db1eb25dcd477dd784d02beee65d44f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/stmicro/stmmac/dwmac-meson.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/ethtool.h>\n#include <linux/io.h>\n#include <linux/ioport.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/stmmac.h>\n\n#include \"stmmac_platform.h\"\n\n#define ETHMAC_SPEED_100\tBIT(1)\n\nstruct meson_dwmac {\n\tstruct device\t*dev;\n\tvoid __iomem\t*reg;\n};\n\nstatic void meson6_dwmac_fix_mac_speed(void *priv, unsigned int speed, unsigned int mode)\n{\n\tstruct meson_dwmac *dwmac = priv;\n\tunsigned int val;\n\n\tval = readl(dwmac->reg);\n\n\tswitch (speed) {\n\tcase SPEED_10:\n\t\tval &= ~ETHMAC_SPEED_100;\n\t\tbreak;\n\tcase SPEED_100:\n\t\tval |= ETHMAC_SPEED_100;\n\t\tbreak;\n\t}\n\n\twritel(val, dwmac->reg);\n}\n\nstatic int meson6_dwmac_probe(struct platform_device *pdev)\n{\n\tstruct plat_stmmacenet_data *plat_dat;\n\tstruct stmmac_resources stmmac_res;\n\tstruct meson_dwmac *dwmac;\n\tint ret;\n\n\tret = stmmac_get_platform_resources(pdev, &stmmac_res);\n\tif (ret)\n\t\treturn ret;\n\n\tplat_dat = stmmac_probe_config_dt(pdev, stmmac_res.mac);\n\tif (IS_ERR(plat_dat))\n\t\treturn PTR_ERR(plat_dat);\n\n\tdwmac = devm_kzalloc(&pdev->dev, sizeof(*dwmac), GFP_KERNEL);\n\tif (!dwmac) {\n\t\tret = -ENOMEM;\n\t\tgoto err_remove_config_dt;\n\t}\n\n\tdwmac->reg = devm_platform_ioremap_resource(pdev, 1);\n\tif (IS_ERR(dwmac->reg)) {\n\t\tret = PTR_ERR(dwmac->reg);\n\t\tgoto err_remove_config_dt;\n\t}\n\n\tplat_dat->bsp_priv = dwmac;\n\tplat_dat->fix_mac_speed = meson6_dwmac_fix_mac_speed;\n\n\tret = stmmac_dvr_probe(&pdev->dev, plat_dat, &stmmac_res);\n\tif (ret)\n\t\tgoto err_remove_config_dt;\n\n\treturn 0;\n\nerr_remove_config_dt:\n\tstmmac_remove_config_dt(pdev, plat_dat);\n\n\treturn ret;\n}\n\nstatic const struct of_device_id meson6_dwmac_match[] = {\n\t{ .compatible = \"amlogic,meson6-dwmac\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, meson6_dwmac_match);\n\nstatic struct platform_driver meson6_dwmac_driver = {\n\t.probe  = meson6_dwmac_probe,\n\t.remove_new = stmmac_pltfr_remove,\n\t.driver = {\n\t\t.name           = \"meson6-dwmac\",\n\t\t.pm\t\t= &stmmac_pltfr_pm_ops,\n\t\t.of_match_table = meson6_dwmac_match,\n\t},\n};\nmodule_platform_driver(meson6_dwmac_driver);\n\nMODULE_AUTHOR(\"Beniamino Galvani <b.galvani@gmail.com>\");\nMODULE_DESCRIPTION(\"Amlogic Meson6 and Meson8 DWMAC glue layer\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}