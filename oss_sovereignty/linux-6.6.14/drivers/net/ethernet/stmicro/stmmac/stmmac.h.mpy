{
  "module_name": "stmmac.h",
  "hash_id": "7013d8c1d2efcb3331fe948ec17edcf5d25df5305179ee25bafce8dbddf65b95",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/stmicro/stmmac/stmmac.h",
  "human_readable_source": " \n \n\n#ifndef __STMMAC_H__\n#define __STMMAC_H__\n\n#define STMMAC_RESOURCE_NAME   \"stmmaceth\"\n\n#include <linux/clk.h>\n#include <linux/hrtimer.h>\n#include <linux/if_vlan.h>\n#include <linux/stmmac.h>\n#include <linux/phylink.h>\n#include <linux/pci.h>\n#include \"common.h\"\n#include <linux/ptp_clock_kernel.h>\n#include <linux/net_tstamp.h>\n#include <linux/reset.h>\n#include <net/page_pool/types.h>\n#include <net/xdp.h>\n#include <uapi/linux/bpf.h>\n\nstruct stmmac_resources {\n\tvoid __iomem *addr;\n\tu8 mac[ETH_ALEN];\n\tint wol_irq;\n\tint lpi_irq;\n\tint irq;\n\tint sfty_ce_irq;\n\tint sfty_ue_irq;\n\tint rx_irq[MTL_MAX_RX_QUEUES];\n\tint tx_irq[MTL_MAX_TX_QUEUES];\n};\n\nenum stmmac_txbuf_type {\n\tSTMMAC_TXBUF_T_SKB,\n\tSTMMAC_TXBUF_T_XDP_TX,\n\tSTMMAC_TXBUF_T_XDP_NDO,\n\tSTMMAC_TXBUF_T_XSK_TX,\n};\n\nstruct stmmac_tx_info {\n\tdma_addr_t buf;\n\tbool map_as_page;\n\tunsigned len;\n\tbool last_segment;\n\tbool is_jumbo;\n\tenum stmmac_txbuf_type buf_type;\n};\n\n#define STMMAC_TBS_AVAIL\tBIT(0)\n#define STMMAC_TBS_EN\t\tBIT(1)\n\n \nstruct stmmac_tx_queue {\n\tu32 tx_count_frames;\n\tint tbs;\n\tstruct hrtimer txtimer;\n\tu32 queue_index;\n\tstruct stmmac_priv *priv_data;\n\tstruct dma_extended_desc *dma_etx ____cacheline_aligned_in_smp;\n\tstruct dma_edesc *dma_entx;\n\tstruct dma_desc *dma_tx;\n\tunion {\n\t\tstruct sk_buff **tx_skbuff;\n\t\tstruct xdp_frame **xdpf;\n\t};\n\tstruct stmmac_tx_info *tx_skbuff_dma;\n\tstruct xsk_buff_pool *xsk_pool;\n\tu32 xsk_frames_done;\n\tunsigned int cur_tx;\n\tunsigned int dirty_tx;\n\tdma_addr_t dma_tx_phy;\n\tdma_addr_t tx_tail_addr;\n\tu32 mss;\n};\n\nstruct stmmac_rx_buffer {\n\tunion {\n\t\tstruct {\n\t\t\tstruct page *page;\n\t\t\tdma_addr_t addr;\n\t\t\t__u32 page_offset;\n\t\t};\n\t\tstruct xdp_buff *xdp;\n\t};\n\tstruct page *sec_page;\n\tdma_addr_t sec_addr;\n};\n\nstruct stmmac_xdp_buff {\n\tstruct xdp_buff xdp;\n\tstruct stmmac_priv *priv;\n\tstruct dma_desc *desc;\n\tstruct dma_desc *ndesc;\n};\n\nstruct stmmac_rx_queue {\n\tu32 rx_count_frames;\n\tu32 queue_index;\n\tstruct xdp_rxq_info xdp_rxq;\n\tstruct xsk_buff_pool *xsk_pool;\n\tstruct page_pool *page_pool;\n\tstruct stmmac_rx_buffer *buf_pool;\n\tstruct stmmac_priv *priv_data;\n\tstruct dma_extended_desc *dma_erx;\n\tstruct dma_desc *dma_rx ____cacheline_aligned_in_smp;\n\tunsigned int cur_rx;\n\tunsigned int dirty_rx;\n\tunsigned int buf_alloc_num;\n\tu32 rx_zeroc_thresh;\n\tdma_addr_t dma_rx_phy;\n\tu32 rx_tail_addr;\n\tunsigned int state_saved;\n\tstruct {\n\t\tstruct sk_buff *skb;\n\t\tunsigned int len;\n\t\tunsigned int error;\n\t} state;\n};\n\nstruct stmmac_channel {\n\tstruct napi_struct rx_napi ____cacheline_aligned_in_smp;\n\tstruct napi_struct tx_napi ____cacheline_aligned_in_smp;\n\tstruct napi_struct rxtx_napi ____cacheline_aligned_in_smp;\n\tstruct stmmac_priv *priv_data;\n\tspinlock_t lock;\n\tu32 index;\n};\n\nstruct stmmac_tc_entry {\n\tbool in_use;\n\tbool in_hw;\n\tbool is_last;\n\tbool is_frag;\n\tvoid *frag_ptr;\n\tunsigned int table_pos;\n\tu32 handle;\n\tu32 prio;\n\tstruct {\n\t\tu32 match_data;\n\t\tu32 match_en;\n\t\tu8 af:1;\n\t\tu8 rf:1;\n\t\tu8 im:1;\n\t\tu8 nc:1;\n\t\tu8 res1:4;\n\t\tu8 frame_offset;\n\t\tu8 ok_index;\n\t\tu8 dma_ch_no;\n\t\tu32 res2;\n\t} __packed val;\n};\n\n#define STMMAC_PPS_MAX\t\t4\nstruct stmmac_pps_cfg {\n\tbool available;\n\tstruct timespec64 start;\n\tstruct timespec64 period;\n};\n\nstruct stmmac_rss {\n\tint enable;\n\tu8 key[STMMAC_RSS_HASH_KEY_SIZE];\n\tu32 table[STMMAC_RSS_MAX_TABLE_SIZE];\n};\n\n#define STMMAC_FLOW_ACTION_DROP\t\tBIT(0)\nstruct stmmac_flow_entry {\n\tunsigned long cookie;\n\tunsigned long action;\n\tu8 ip_proto;\n\tint in_use;\n\tint idx;\n\tint is_l4;\n};\n\n \nenum stmmac_rfs_type {\n\tSTMMAC_RFS_T_VLAN,\n\tSTMMAC_RFS_T_LLDP,\n\tSTMMAC_RFS_T_1588,\n\tSTMMAC_RFS_T_MAX,\n};\n\nstruct stmmac_rfs_entry {\n\tunsigned long cookie;\n\tu16 etype;\n\tint in_use;\n\tint type;\n\tint tc;\n};\n\nstruct stmmac_dma_conf {\n\tunsigned int dma_buf_sz;\n\n\t \n\tstruct stmmac_rx_queue rx_queue[MTL_MAX_RX_QUEUES];\n\tunsigned int dma_rx_size;\n\n\t \n\tstruct stmmac_tx_queue tx_queue[MTL_MAX_TX_QUEUES];\n\tunsigned int dma_tx_size;\n};\n\nstruct stmmac_priv {\n\t \n\tu32 tx_coal_frames[MTL_MAX_TX_QUEUES];\n\tu32 tx_coal_timer[MTL_MAX_TX_QUEUES];\n\tu32 rx_coal_frames[MTL_MAX_TX_QUEUES];\n\n\tint hwts_tx_en;\n\tbool tx_path_in_lpi_mode;\n\tbool tso;\n\tint sph;\n\tint sph_cap;\n\tu32 sarc_type;\n\n\tunsigned int rx_copybreak;\n\tu32 rx_riwt[MTL_MAX_TX_QUEUES];\n\tint hwts_rx_en;\n\n\tvoid __iomem *ioaddr;\n\tstruct net_device *dev;\n\tstruct device *device;\n\tstruct mac_device_info *hw;\n\tint (*hwif_quirks)(struct stmmac_priv *priv);\n\tstruct mutex lock;\n\n\tstruct stmmac_dma_conf dma_conf;\n\n\t \n\tstruct stmmac_channel channel[STMMAC_CH_MAX];\n\n\tint speed;\n\tunsigned int flow_ctrl;\n\tunsigned int pause;\n\tstruct mii_bus *mii;\n\n\tstruct phylink_config phylink_config;\n\tstruct phylink *phylink;\n\n\tstruct stmmac_extra_stats xstats ____cacheline_aligned_in_smp;\n\tstruct stmmac_safety_stats sstats;\n\tstruct plat_stmmacenet_data *plat;\n\tstruct dma_features dma_cap;\n\tstruct stmmac_counters mmc;\n\tint hw_cap_support;\n\tint synopsys_id;\n\tu32 msg_enable;\n\tint wolopts;\n\tint wol_irq;\n\tbool wol_irq_disabled;\n\tint clk_csr;\n\tstruct timer_list eee_ctrl_timer;\n\tint lpi_irq;\n\tint eee_enabled;\n\tint eee_active;\n\tint tx_lpi_timer;\n\tint tx_lpi_enabled;\n\tint eee_tw_timer;\n\tbool eee_sw_timer_en;\n\tunsigned int mode;\n\tunsigned int chain_mode;\n\tint extend_desc;\n\tstruct hwtstamp_config tstamp_config;\n\tstruct ptp_clock *ptp_clock;\n\tstruct ptp_clock_info ptp_clock_ops;\n\tunsigned int default_addend;\n\tu32 sub_second_inc;\n\tu32 systime_flags;\n\tu32 adv_ts;\n\tint use_riwt;\n\tint irq_wake;\n\trwlock_t ptp_lock;\n\t \n\tstruct mutex aux_ts_lock;\n\twait_queue_head_t tstamp_busy_wait;\n\n\tvoid __iomem *mmcaddr;\n\tvoid __iomem *ptpaddr;\n\tunsigned long active_vlans[BITS_TO_LONGS(VLAN_N_VID)];\n\tint sfty_ce_irq;\n\tint sfty_ue_irq;\n\tint rx_irq[MTL_MAX_RX_QUEUES];\n\tint tx_irq[MTL_MAX_TX_QUEUES];\n\t \n\tchar int_name_mac[IFNAMSIZ + 9];\n\tchar int_name_wol[IFNAMSIZ + 9];\n\tchar int_name_lpi[IFNAMSIZ + 9];\n\tchar int_name_sfty_ce[IFNAMSIZ + 10];\n\tchar int_name_sfty_ue[IFNAMSIZ + 10];\n\tchar int_name_rx_irq[MTL_MAX_TX_QUEUES][IFNAMSIZ + 14];\n\tchar int_name_tx_irq[MTL_MAX_TX_QUEUES][IFNAMSIZ + 18];\n\n#ifdef CONFIG_DEBUG_FS\n\tstruct dentry *dbgfs_dir;\n#endif\n\n\tunsigned long state;\n\tstruct workqueue_struct *wq;\n\tstruct work_struct service_task;\n\n\t \n\tunsigned long fpe_task_state;\n\tstruct workqueue_struct *fpe_wq;\n\tstruct work_struct fpe_task;\n\tchar wq_name[IFNAMSIZ + 4];\n\n\t \n\tunsigned int tc_entries_max;\n\tunsigned int tc_off_max;\n\tstruct stmmac_tc_entry *tc_entries;\n\tunsigned int flow_entries_max;\n\tstruct stmmac_flow_entry *flow_entries;\n\tunsigned int rfs_entries_max[STMMAC_RFS_T_MAX];\n\tunsigned int rfs_entries_cnt[STMMAC_RFS_T_MAX];\n\tunsigned int rfs_entries_total;\n\tstruct stmmac_rfs_entry *rfs_entries;\n\n\t \n\tstruct stmmac_pps_cfg pps[STMMAC_PPS_MAX];\n\n\t \n\tstruct stmmac_rss rss;\n\n\t \n\tunsigned long *af_xdp_zc_qps;\n\tstruct bpf_prog *xdp_prog;\n};\n\nenum stmmac_state {\n\tSTMMAC_DOWN,\n\tSTMMAC_RESET_REQUESTED,\n\tSTMMAC_RESETING,\n\tSTMMAC_SERVICE_SCHED,\n};\n\nint stmmac_mdio_unregister(struct net_device *ndev);\nint stmmac_mdio_register(struct net_device *ndev);\nint stmmac_mdio_reset(struct mii_bus *mii);\nint stmmac_xpcs_setup(struct mii_bus *mii);\nvoid stmmac_set_ethtool_ops(struct net_device *netdev);\n\nint stmmac_init_tstamp_counter(struct stmmac_priv *priv, u32 systime_flags);\nvoid stmmac_ptp_register(struct stmmac_priv *priv);\nvoid stmmac_ptp_unregister(struct stmmac_priv *priv);\nint stmmac_xdp_open(struct net_device *dev);\nvoid stmmac_xdp_release(struct net_device *dev);\nint stmmac_resume(struct device *dev);\nint stmmac_suspend(struct device *dev);\nvoid stmmac_dvr_remove(struct device *dev);\nint stmmac_dvr_probe(struct device *device,\n\t\t     struct plat_stmmacenet_data *plat_dat,\n\t\t     struct stmmac_resources *res);\nvoid stmmac_disable_eee_mode(struct stmmac_priv *priv);\nbool stmmac_eee_init(struct stmmac_priv *priv);\nint stmmac_reinit_queues(struct net_device *dev, u32 rx_cnt, u32 tx_cnt);\nint stmmac_reinit_ringparam(struct net_device *dev, u32 rx_size, u32 tx_size);\nint stmmac_bus_clks_config(struct stmmac_priv *priv, bool enabled);\nvoid stmmac_fpe_handshake(struct stmmac_priv *priv, bool enable);\n\nstatic inline bool stmmac_xdp_is_enabled(struct stmmac_priv *priv)\n{\n\treturn !!priv->xdp_prog;\n}\n\nstatic inline unsigned int stmmac_rx_offset(struct stmmac_priv *priv)\n{\n\tif (stmmac_xdp_is_enabled(priv))\n\t\treturn XDP_PACKET_HEADROOM;\n\n\treturn 0;\n}\n\nvoid stmmac_disable_rx_queue(struct stmmac_priv *priv, u32 queue);\nvoid stmmac_enable_rx_queue(struct stmmac_priv *priv, u32 queue);\nvoid stmmac_disable_tx_queue(struct stmmac_priv *priv, u32 queue);\nvoid stmmac_enable_tx_queue(struct stmmac_priv *priv, u32 queue);\nint stmmac_xsk_wakeup(struct net_device *dev, u32 queue, u32 flags);\nstruct timespec64 stmmac_calc_tas_basetime(ktime_t old_base_time,\n\t\t\t\t\t   ktime_t current_time,\n\t\t\t\t\t   u64 cycle_time);\n\n#if IS_ENABLED(CONFIG_STMMAC_SELFTESTS)\nvoid stmmac_selftest_run(struct net_device *dev,\n\t\t\t struct ethtool_test *etest, u64 *buf);\nvoid stmmac_selftest_get_strings(struct stmmac_priv *priv, u8 *data);\nint stmmac_selftest_get_count(struct stmmac_priv *priv);\n#else\nstatic inline void stmmac_selftest_run(struct net_device *dev,\n\t\t\t\t       struct ethtool_test *etest, u64 *buf)\n{\n\t \n}\nstatic inline void stmmac_selftest_get_strings(struct stmmac_priv *priv,\n\t\t\t\t\t       u8 *data)\n{\n\t \n}\nstatic inline int stmmac_selftest_get_count(struct stmmac_priv *priv)\n{\n\treturn -EOPNOTSUPP;\n}\n#endif  \n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}