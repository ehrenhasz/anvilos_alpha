{
  "module_name": "octep_main.h",
  "hash_id": "0ae2058db20e99d62dc7d5bd2b30a151d646210432e7a563a0b8010960f09554",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/marvell/octeon_ep/octep_main.h",
  "human_readable_source": " \n \n\n#ifndef _OCTEP_MAIN_H_\n#define _OCTEP_MAIN_H_\n\n#include \"octep_tx.h\"\n#include \"octep_rx.h\"\n#include \"octep_ctrl_mbox.h\"\n\n#define OCTEP_DRV_NAME\t\t\"octeon_ep\"\n#define OCTEP_DRV_STRING\t\"Marvell Octeon EndPoint NIC Driver\"\n\n#define  OCTEP_PCIID_CN93_PF  0xB200177d\n#define  OCTEP_PCIID_CN93_VF  0xB203177d\n\n#define  OCTEP_PCI_DEVICE_ID_CN93_PF 0xB200\n#define  OCTEP_PCI_DEVICE_ID_CN93_VF 0xB203\n\n#define  OCTEP_PCI_DEVICE_ID_CNF95N_PF 0xB400    \n\n#define  OCTEP_MAX_QUEUES   63\n#define  OCTEP_MAX_IQ       OCTEP_MAX_QUEUES\n#define  OCTEP_MAX_OQ       OCTEP_MAX_QUEUES\n#define  OCTEP_MAX_VF       64\n\n#define OCTEP_MAX_MSIX_VECTORS OCTEP_MAX_OQ\n\n \n#define  OCTEP_INPUT_INTR    (1)\n#define  OCTEP_OUTPUT_INTR   (2)\n#define  OCTEP_MBOX_INTR     (4)\n#define  OCTEP_ALL_INTR      0xff\n\n#define  OCTEP_IQ_INTR_RESEND_BIT  59\n#define  OCTEP_OQ_INTR_RESEND_BIT  59\n\n#define  OCTEP_MMIO_REGIONS     3\n \nstruct octep_mmio {\n\t \n\tu8 __iomem *hw_addr;\n\n\t \n\tint mapped;\n};\n\nstruct octep_pci_win_regs {\n\tu8 __iomem *pci_win_wr_addr;\n\tu8 __iomem *pci_win_rd_addr;\n\tu8 __iomem *pci_win_wr_data;\n\tu8 __iomem *pci_win_rd_data;\n};\n\nstruct octep_hw_ops {\n\tvoid (*setup_iq_regs)(struct octep_device *oct, int q);\n\tvoid (*setup_oq_regs)(struct octep_device *oct, int q);\n\tvoid (*setup_mbox_regs)(struct octep_device *oct, int mbox);\n\n\tirqreturn_t (*non_ioq_intr_handler)(void *ioq_vector);\n\tirqreturn_t (*ioq_intr_handler)(void *ioq_vector);\n\tint (*soft_reset)(struct octep_device *oct);\n\tvoid (*reinit_regs)(struct octep_device *oct);\n\tu32  (*update_iq_read_idx)(struct octep_iq *iq);\n\n\tvoid (*enable_interrupts)(struct octep_device *oct);\n\tvoid (*disable_interrupts)(struct octep_device *oct);\n\tbool (*poll_non_ioq_interrupts)(struct octep_device *oct);\n\n\tvoid (*enable_io_queues)(struct octep_device *oct);\n\tvoid (*disable_io_queues)(struct octep_device *oct);\n\tvoid (*enable_iq)(struct octep_device *oct, int q);\n\tvoid (*disable_iq)(struct octep_device *oct, int q);\n\tvoid (*enable_oq)(struct octep_device *oct, int q);\n\tvoid (*disable_oq)(struct octep_device *oct, int q);\n\tvoid (*reset_io_queues)(struct octep_device *oct);\n\tvoid (*dump_registers)(struct octep_device *oct);\n};\n\n \nstruct octep_mbox_data {\n\tu32 cmd;\n\tu32 total_len;\n\tu32 recv_len;\n\tu32 rsvd;\n\tu64 *data;\n};\n\n \nstruct octep_mbox {\n\t \n\tspinlock_t lock;\n\n\tu32 q_no;\n\tu32 state;\n\n\t \n\tu8 __iomem *mbox_int_reg;\n\n\t \n\tu8 __iomem *mbox_write_reg;\n\n\t \n\tu8 __iomem *mbox_read_reg;\n\n\tstruct octep_mbox_data mbox_data;\n};\n\n \nstruct octep_ioq_vector {\n\tchar name[OCTEP_MSIX_NAME_SIZE];\n\tstruct napi_struct napi;\n\tstruct octep_device *octep_dev;\n\tstruct octep_iq *iq;\n\tstruct octep_oq *oq;\n\tcpumask_t affinity_mask;\n};\n\n \n#define OCTEP_CAP_TX_CHECKSUM BIT(0)\n#define OCTEP_CAP_RX_CHECKSUM BIT(1)\n#define OCTEP_CAP_TSO         BIT(2)\n\n \nenum octep_link_mode_bit_indices {\n\tOCTEP_LINK_MODE_10GBASE_T    = 0,\n\tOCTEP_LINK_MODE_10GBASE_R,\n\tOCTEP_LINK_MODE_10GBASE_CR,\n\tOCTEP_LINK_MODE_10GBASE_KR,\n\tOCTEP_LINK_MODE_10GBASE_LR,\n\tOCTEP_LINK_MODE_10GBASE_SR,\n\tOCTEP_LINK_MODE_25GBASE_CR,\n\tOCTEP_LINK_MODE_25GBASE_KR,\n\tOCTEP_LINK_MODE_25GBASE_SR,\n\tOCTEP_LINK_MODE_40GBASE_CR4,\n\tOCTEP_LINK_MODE_40GBASE_KR4,\n\tOCTEP_LINK_MODE_40GBASE_LR4,\n\tOCTEP_LINK_MODE_40GBASE_SR4,\n\tOCTEP_LINK_MODE_50GBASE_CR2,\n\tOCTEP_LINK_MODE_50GBASE_KR2,\n\tOCTEP_LINK_MODE_50GBASE_SR2,\n\tOCTEP_LINK_MODE_50GBASE_CR,\n\tOCTEP_LINK_MODE_50GBASE_KR,\n\tOCTEP_LINK_MODE_50GBASE_LR,\n\tOCTEP_LINK_MODE_50GBASE_SR,\n\tOCTEP_LINK_MODE_100GBASE_CR4,\n\tOCTEP_LINK_MODE_100GBASE_KR4,\n\tOCTEP_LINK_MODE_100GBASE_LR4,\n\tOCTEP_LINK_MODE_100GBASE_SR4,\n\tOCTEP_LINK_MODE_NBITS\n};\n\n \nstruct octep_iface_link_info {\n\t \n\tu64 supported_modes;\n\n\t \n\tu64 advertised_modes;\n\n\t \n\tu32 speed;\n\n\t \n\tu16 mtu;\n\n\t \n#define OCTEP_LINK_MODE_AUTONEG_SUPPORTED   BIT(0)\n#define OCTEP_LINK_MODE_AUTONEG_ADVERTISED  BIT(1)\n\tu8 autoneg;\n\n\t \n#define OCTEP_LINK_MODE_PAUSE_SUPPORTED   BIT(0)\n#define OCTEP_LINK_MODE_PAUSE_ADVERTISED  BIT(1)\n\tu8 pause;\n\n\t \n\tu8  admin_up;\n\n\t \n\tu8  oper_up;\n};\n\n \nstruct octep_device {\n\tstruct octep_config *conf;\n\n\t \n\tu16 chip_id;\n\tu16 rev_id;\n\n\t \n\tu64 caps_enabled;\n\t \n\tu64 caps_supported;\n\n\t \n\tstruct device *dev;\n\t \n\tstruct pci_dev *pdev;\n\t \n\tstruct net_device *netdev;\n\n\t \n\tstruct octep_mmio mmio[OCTEP_MMIO_REGIONS];\n\n\t \n\tu8 mac_addr[ETH_ALEN];\n\n\t \n\tu16 num_iqs;\n\t \n\tu8 pkind;\n\t \n\tstruct octep_iq *iq[OCTEP_MAX_IQ];\n\n\t \n\tu16 num_oqs;\n\t \n\tstruct octep_oq *oq[OCTEP_MAX_OQ];\n\n\t \n\tu16 pcie_port;\n\n\t \n\tstruct octep_pci_win_regs pci_win_regs;\n\t \n\tstruct octep_hw_ops hw_ops;\n\n\t \n\tu16 num_irqs;\n\tu16 num_non_ioq_irqs;\n\tchar *non_ioq_irq_names;\n\tstruct msix_entry *msix_entries;\n\t \n\tstruct octep_ioq_vector *ioq_vector[OCTEP_MAX_QUEUES];\n\n\t \n\tstruct octep_iface_tx_stats iface_tx_stats;\n\t \n\tstruct octep_iface_rx_stats iface_rx_stats;\n\n\t \n\tstruct octep_iface_link_info link_info;\n\n\t \n\tstruct octep_mbox *mbox[OCTEP_MAX_VF];\n\n\t \n\tstruct work_struct tx_timeout_task;\n\n\t \n\tstruct octep_ctrl_mbox ctrl_mbox;\n\n\t \n\tu32 ctrl_mbox_ifstats_offset;\n\n\t \n\tstruct work_struct ctrl_mbox_task;\n\t \n\twait_queue_head_t ctrl_req_wait_q;\n\t \n\tstruct list_head ctrl_req_wait_list;\n\n\t \n\tbool poll_non_ioq_intr;\n\t \n\tstruct delayed_work intr_poll_task;\n\n\t \n\tstruct timer_list hb_timer;\n\t \n\tatomic_t hb_miss_cnt;\n\t \n\tstruct delayed_work hb_task;\n};\n\nstatic inline u16 OCTEP_MAJOR_REV(struct octep_device *oct)\n{\n\tu16 rev = (oct->rev_id & 0xC) >> 2;\n\n\treturn (rev == 0) ? 1 : rev;\n}\n\nstatic inline u16 OCTEP_MINOR_REV(struct octep_device *oct)\n{\n\treturn (oct->rev_id & 0x3);\n}\n\n \n#define octep_write_csr(octep_dev, reg_off, value) \\\n\twritel(value, (octep_dev)->mmio[0].hw_addr + (reg_off))\n\n#define octep_write_csr64(octep_dev, reg_off, val64) \\\n\twriteq(val64, (octep_dev)->mmio[0].hw_addr + (reg_off))\n\n#define octep_read_csr(octep_dev, reg_off)         \\\n\treadl((octep_dev)->mmio[0].hw_addr + (reg_off))\n\n#define octep_read_csr64(octep_dev, reg_off)         \\\n\treadq((octep_dev)->mmio[0].hw_addr + (reg_off))\n\n \nstatic inline u64\nOCTEP_PCI_WIN_READ(struct octep_device *oct, u64 addr)\n{\n\tu64 val64;\n\n\taddr |= 1ull << 53;  \n\twriteq(addr, oct->pci_win_regs.pci_win_rd_addr);\n\tval64 = readq(oct->pci_win_regs.pci_win_rd_data);\n\n\tdev_dbg(&oct->pdev->dev,\n\t\t\"%s: reg: 0x%016llx val: 0x%016llx\\n\", __func__, addr, val64);\n\n\treturn val64;\n}\n\n \nstatic inline void\nOCTEP_PCI_WIN_WRITE(struct octep_device *oct, u64 addr, u64 val)\n{\n\twriteq(addr, oct->pci_win_regs.pci_win_wr_addr);\n\twriteq(val, oct->pci_win_regs.pci_win_wr_data);\n\n\tdev_dbg(&oct->pdev->dev,\n\t\t\"%s: reg: 0x%016llx val: 0x%016llx\\n\", __func__, addr, val);\n}\n\nextern struct workqueue_struct *octep_wq;\n\nint octep_device_setup(struct octep_device *oct);\nint octep_setup_iqs(struct octep_device *oct);\nvoid octep_free_iqs(struct octep_device *oct);\nvoid octep_clean_iqs(struct octep_device *oct);\nint octep_setup_oqs(struct octep_device *oct);\nvoid octep_free_oqs(struct octep_device *oct);\nvoid octep_oq_dbell_init(struct octep_device *oct);\nvoid octep_device_setup_cn93_pf(struct octep_device *oct);\nint octep_iq_process_completions(struct octep_iq *iq, u16 budget);\nint octep_oq_process_rx(struct octep_oq *oq, int budget);\nvoid octep_set_ethtool_ops(struct net_device *netdev);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}