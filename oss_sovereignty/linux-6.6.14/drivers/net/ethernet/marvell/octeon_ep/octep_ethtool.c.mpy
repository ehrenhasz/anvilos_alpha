{
  "module_name": "octep_ethtool.c",
  "hash_id": "bd87c552b8dc76931ce7a09c34e343826651f4250d2231b5b42ef662a120d692",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/marvell/octeon_ep/octep_ethtool.c",
  "human_readable_source": "\n \n\n#include <linux/pci.h>\n#include <linux/netdevice.h>\n#include <linux/ethtool.h>\n\n#include \"octep_config.h\"\n#include \"octep_main.h\"\n#include \"octep_ctrl_net.h\"\n\nstatic const char octep_gstrings_global_stats[][ETH_GSTRING_LEN] = {\n\t\"rx_packets\",\n\t\"tx_packets\",\n\t\"rx_bytes\",\n\t\"tx_bytes\",\n\t\"rx_alloc_errors\",\n\t\"tx_busy_errors\",\n\t\"rx_dropped\",\n\t\"tx_dropped\",\n\t\"tx_hw_pkts\",\n\t\"tx_hw_octs\",\n\t\"tx_hw_bcast\",\n\t\"tx_hw_mcast\",\n\t\"tx_hw_underflow\",\n\t\"tx_hw_control\",\n\t\"tx_less_than_64\",\n\t\"tx_equal_64\",\n\t\"tx_equal_65_to_127\",\n\t\"tx_equal_128_to_255\",\n\t\"tx_equal_256_to_511\",\n\t\"tx_equal_512_to_1023\",\n\t\"tx_equal_1024_to_1518\",\n\t\"tx_greater_than_1518\",\n\t\"rx_hw_pkts\",\n\t\"rx_hw_bytes\",\n\t\"rx_hw_bcast\",\n\t\"rx_hw_mcast\",\n\t\"rx_pause_pkts\",\n\t\"rx_pause_bytes\",\n\t\"rx_dropped_pkts_fifo_full\",\n\t\"rx_dropped_bytes_fifo_full\",\n\t\"rx_err_pkts\",\n};\n\n#define OCTEP_GLOBAL_STATS_CNT (sizeof(octep_gstrings_global_stats) / ETH_GSTRING_LEN)\n\nstatic const char octep_gstrings_tx_q_stats[][ETH_GSTRING_LEN] = {\n\t\"tx_packets_posted[Q-%u]\",\n\t\"tx_packets_completed[Q-%u]\",\n\t\"tx_bytes[Q-%u]\",\n\t\"tx_busy[Q-%u]\",\n};\n\n#define OCTEP_TX_Q_STATS_CNT (sizeof(octep_gstrings_tx_q_stats) / ETH_GSTRING_LEN)\n\nstatic const char octep_gstrings_rx_q_stats[][ETH_GSTRING_LEN] = {\n\t\"rx_packets[Q-%u]\",\n\t\"rx_bytes[Q-%u]\",\n\t\"rx_alloc_errors[Q-%u]\",\n};\n\n#define OCTEP_RX_Q_STATS_CNT (sizeof(octep_gstrings_rx_q_stats) / ETH_GSTRING_LEN)\n\nstatic void octep_get_drvinfo(struct net_device *netdev,\n\t\t\t      struct ethtool_drvinfo *info)\n{\n\tstruct octep_device *oct = netdev_priv(netdev);\n\n\tstrscpy(info->driver, OCTEP_DRV_NAME, sizeof(info->driver));\n\tstrscpy(info->bus_info, pci_name(oct->pdev), sizeof(info->bus_info));\n}\n\nstatic void octep_get_strings(struct net_device *netdev,\n\t\t\t      u32 stringset, u8 *data)\n{\n\tstruct octep_device *oct = netdev_priv(netdev);\n\tu16 num_queues = CFG_GET_PORTS_ACTIVE_IO_RINGS(oct->conf);\n\tchar *strings = (char *)data;\n\tint i, j;\n\n\tswitch (stringset) {\n\tcase ETH_SS_STATS:\n\t\tfor (i = 0; i < OCTEP_GLOBAL_STATS_CNT; i++) {\n\t\t\tsnprintf(strings, ETH_GSTRING_LEN,\n\t\t\t\t octep_gstrings_global_stats[i]);\n\t\t\tstrings += ETH_GSTRING_LEN;\n\t\t}\n\n\t\tfor (i = 0; i < num_queues; i++) {\n\t\t\tfor (j = 0; j < OCTEP_TX_Q_STATS_CNT; j++) {\n\t\t\t\tsnprintf(strings, ETH_GSTRING_LEN,\n\t\t\t\t\t octep_gstrings_tx_q_stats[j], i);\n\t\t\t\tstrings += ETH_GSTRING_LEN;\n\t\t\t}\n\t\t}\n\n\t\tfor (i = 0; i < num_queues; i++) {\n\t\t\tfor (j = 0; j < OCTEP_RX_Q_STATS_CNT; j++) {\n\t\t\t\tsnprintf(strings, ETH_GSTRING_LEN,\n\t\t\t\t\t octep_gstrings_rx_q_stats[j], i);\n\t\t\t\tstrings += ETH_GSTRING_LEN;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n}\n\nstatic int octep_get_sset_count(struct net_device *netdev, int sset)\n{\n\tstruct octep_device *oct = netdev_priv(netdev);\n\tu16 num_queues = CFG_GET_PORTS_ACTIVE_IO_RINGS(oct->conf);\n\n\tswitch (sset) {\n\tcase ETH_SS_STATS:\n\t\treturn OCTEP_GLOBAL_STATS_CNT + (num_queues *\n\t\t       (OCTEP_TX_Q_STATS_CNT + OCTEP_RX_Q_STATS_CNT));\n\t\tbreak;\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n}\n\nstatic void\noctep_get_ethtool_stats(struct net_device *netdev,\n\t\t\tstruct ethtool_stats *stats, u64 *data)\n{\n\tstruct octep_device *oct = netdev_priv(netdev);\n\tstruct octep_iface_tx_stats *iface_tx_stats;\n\tstruct octep_iface_rx_stats *iface_rx_stats;\n\tu64 rx_packets, rx_bytes;\n\tu64 tx_packets, tx_bytes;\n\tu64 rx_alloc_errors, tx_busy_errors;\n\tint q, i;\n\n\trx_packets = 0;\n\trx_bytes = 0;\n\ttx_packets = 0;\n\ttx_bytes = 0;\n\trx_alloc_errors = 0;\n\ttx_busy_errors = 0;\n\ttx_packets = 0;\n\ttx_bytes = 0;\n\trx_packets = 0;\n\trx_bytes = 0;\n\n\tiface_tx_stats = &oct->iface_tx_stats;\n\tiface_rx_stats = &oct->iface_rx_stats;\n\toctep_ctrl_net_get_if_stats(oct,\n\t\t\t\t    OCTEP_CTRL_NET_INVALID_VFID,\n\t\t\t\t    iface_rx_stats,\n\t\t\t\t    iface_tx_stats);\n\n\tfor (q = 0; q < oct->num_oqs; q++) {\n\t\tstruct octep_iq *iq = oct->iq[q];\n\t\tstruct octep_oq *oq = oct->oq[q];\n\n\t\ttx_packets += iq->stats.instr_completed;\n\t\ttx_bytes += iq->stats.bytes_sent;\n\t\ttx_busy_errors += iq->stats.tx_busy;\n\n\t\trx_packets += oq->stats.packets;\n\t\trx_bytes += oq->stats.bytes;\n\t\trx_alloc_errors += oq->stats.alloc_failures;\n\t}\n\ti = 0;\n\tdata[i++] = rx_packets;\n\tdata[i++] = tx_packets;\n\tdata[i++] = rx_bytes;\n\tdata[i++] = tx_bytes;\n\tdata[i++] = rx_alloc_errors;\n\tdata[i++] = tx_busy_errors;\n\tdata[i++] = iface_rx_stats->dropped_pkts_fifo_full +\n\t\t    iface_rx_stats->err_pkts;\n\tdata[i++] = iface_tx_stats->xscol +\n\t\t    iface_tx_stats->xsdef;\n\tdata[i++] = iface_tx_stats->pkts;\n\tdata[i++] = iface_tx_stats->octs;\n\tdata[i++] = iface_tx_stats->bcst;\n\tdata[i++] = iface_tx_stats->mcst;\n\tdata[i++] = iface_tx_stats->undflw;\n\tdata[i++] = iface_tx_stats->ctl;\n\tdata[i++] = iface_tx_stats->hist_lt64;\n\tdata[i++] = iface_tx_stats->hist_eq64;\n\tdata[i++] = iface_tx_stats->hist_65to127;\n\tdata[i++] = iface_tx_stats->hist_128to255;\n\tdata[i++] = iface_tx_stats->hist_256to511;\n\tdata[i++] = iface_tx_stats->hist_512to1023;\n\tdata[i++] = iface_tx_stats->hist_1024to1518;\n\tdata[i++] = iface_tx_stats->hist_gt1518;\n\tdata[i++] = iface_rx_stats->pkts;\n\tdata[i++] = iface_rx_stats->octets;\n\tdata[i++] = iface_rx_stats->mcast_pkts;\n\tdata[i++] = iface_rx_stats->bcast_pkts;\n\tdata[i++] = iface_rx_stats->pause_pkts;\n\tdata[i++] = iface_rx_stats->pause_octets;\n\tdata[i++] = iface_rx_stats->dropped_pkts_fifo_full;\n\tdata[i++] = iface_rx_stats->dropped_octets_fifo_full;\n\tdata[i++] = iface_rx_stats->err_pkts;\n\n\t \n\tfor (q = 0; q < oct->num_iqs; q++) {\n\t\tstruct octep_iq *iq = oct->iq[q];\n\n\t\tdata[i++] = iq->stats.instr_posted;\n\t\tdata[i++] = iq->stats.instr_completed;\n\t\tdata[i++] = iq->stats.bytes_sent;\n\t\tdata[i++] = iq->stats.tx_busy;\n\t}\n\n\t \n\tfor (q = 0; q < oct->num_oqs; q++) {\n\t\tstruct octep_oq *oq = oct->oq[q];\n\n\t\tdata[i++] = oq->stats.packets;\n\t\tdata[i++] = oq->stats.bytes;\n\t\tdata[i++] = oq->stats.alloc_failures;\n\t}\n}\n\n#define OCTEP_SET_ETHTOOL_LINK_MODES_BITMAP(octep_speeds, ksettings, name) \\\n{ \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_10GBASE_T)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 10000baseT_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_10GBASE_R)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 10000baseR_FEC); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_10GBASE_CR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 10000baseCR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_10GBASE_KR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 10000baseKR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_10GBASE_LR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 10000baseLR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_10GBASE_SR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 10000baseSR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_25GBASE_CR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 25000baseCR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_25GBASE_KR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 25000baseKR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_25GBASE_SR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 25000baseSR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_40GBASE_CR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 40000baseCR4_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_40GBASE_KR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 40000baseKR4_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_40GBASE_LR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 40000baseLR4_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_40GBASE_SR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 40000baseSR4_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_50GBASE_CR2)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 50000baseCR2_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_50GBASE_KR2)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 50000baseKR2_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_50GBASE_SR2)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 50000baseSR2_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_50GBASE_CR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 50000baseCR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_50GBASE_KR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 50000baseKR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_50GBASE_LR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 50000baseLR_ER_FR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_50GBASE_SR)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 50000baseSR_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_100GBASE_CR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 100000baseCR4_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_100GBASE_KR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 100000baseKR4_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_100GBASE_LR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 100000baseLR4_ER4_Full); \\\n\tif ((octep_speeds) & BIT(OCTEP_LINK_MODE_100GBASE_SR4)) \\\n\t\tethtool_link_ksettings_add_link_mode(ksettings, name, 100000baseSR4_Full); \\\n}\n\nstatic int octep_get_link_ksettings(struct net_device *netdev,\n\t\t\t\t    struct ethtool_link_ksettings *cmd)\n{\n\tstruct octep_device *oct = netdev_priv(netdev);\n\tstruct octep_iface_link_info *link_info;\n\tu32 advertised_modes, supported_modes;\n\n\tethtool_link_ksettings_zero_link_mode(cmd, supported);\n\tethtool_link_ksettings_zero_link_mode(cmd, advertising);\n\n\tlink_info = &oct->link_info;\n\toctep_ctrl_net_get_link_info(oct, OCTEP_CTRL_NET_INVALID_VFID, link_info);\n\n\tadvertised_modes = oct->link_info.advertised_modes;\n\tsupported_modes = oct->link_info.supported_modes;\n\n\tOCTEP_SET_ETHTOOL_LINK_MODES_BITMAP(supported_modes, cmd, supported);\n\tOCTEP_SET_ETHTOOL_LINK_MODES_BITMAP(advertised_modes, cmd, advertising);\n\n\tif (link_info->autoneg) {\n\t\tif (link_info->autoneg & OCTEP_LINK_MODE_AUTONEG_SUPPORTED)\n\t\t\tethtool_link_ksettings_add_link_mode(cmd, supported, Autoneg);\n\t\tif (link_info->autoneg & OCTEP_LINK_MODE_AUTONEG_ADVERTISED) {\n\t\t\tethtool_link_ksettings_add_link_mode(cmd, advertising, Autoneg);\n\t\t\tcmd->base.autoneg = AUTONEG_ENABLE;\n\t\t} else {\n\t\t\tcmd->base.autoneg = AUTONEG_DISABLE;\n\t\t}\n\t} else {\n\t\tcmd->base.autoneg = AUTONEG_DISABLE;\n\t}\n\n\tif (link_info->pause) {\n\t\tif (link_info->pause & OCTEP_LINK_MODE_PAUSE_SUPPORTED)\n\t\t\tethtool_link_ksettings_add_link_mode(cmd, supported, Pause);\n\t\tif (link_info->pause & OCTEP_LINK_MODE_PAUSE_ADVERTISED)\n\t\t\tethtool_link_ksettings_add_link_mode(cmd, advertising, Pause);\n\t}\n\n\tcmd->base.port = PORT_FIBRE;\n\tethtool_link_ksettings_add_link_mode(cmd, supported, FIBRE);\n\tethtool_link_ksettings_add_link_mode(cmd, advertising, FIBRE);\n\n\tif (netif_carrier_ok(netdev)) {\n\t\tcmd->base.speed = link_info->speed;\n\t\tcmd->base.duplex = DUPLEX_FULL;\n\t} else {\n\t\tcmd->base.speed = SPEED_UNKNOWN;\n\t\tcmd->base.duplex = DUPLEX_UNKNOWN;\n\t}\n\treturn 0;\n}\n\nstatic int octep_set_link_ksettings(struct net_device *netdev,\n\t\t\t\t    const struct ethtool_link_ksettings *cmd)\n{\n\tstruct octep_device *oct = netdev_priv(netdev);\n\tstruct octep_iface_link_info link_info_new;\n\tstruct octep_iface_link_info *link_info;\n\tu64 advertised = 0;\n\tu8 autoneg = 0;\n\tint err;\n\n\tlink_info = &oct->link_info;\n\tmemcpy(&link_info_new, link_info, sizeof(struct octep_iface_link_info));\n\n\t \n\tif (cmd->base.duplex != DUPLEX_FULL &&\n\t    cmd->base.duplex != DUPLEX_UNKNOWN)\n\t\treturn -EOPNOTSUPP;\n\n\tif (cmd->base.autoneg == AUTONEG_ENABLE) {\n\t\tif (!(link_info->autoneg & OCTEP_LINK_MODE_AUTONEG_SUPPORTED))\n\t\t\treturn -EOPNOTSUPP;\n\t\tautoneg = 1;\n\t}\n\n\tif (!bitmap_subset(cmd->link_modes.advertising,\n\t\t\t   cmd->link_modes.supported,\n\t\t\t   __ETHTOOL_LINK_MODE_MASK_NBITS))\n\t\treturn -EINVAL;\n\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  10000baseT_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_10GBASE_T);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  10000baseR_FEC))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_10GBASE_R);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  10000baseCR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_10GBASE_CR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  10000baseKR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_10GBASE_KR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  10000baseLR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_10GBASE_LR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  10000baseSR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_10GBASE_SR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  25000baseCR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_25GBASE_CR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  25000baseKR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_25GBASE_KR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  25000baseSR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_25GBASE_SR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  40000baseCR4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_40GBASE_CR4);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  40000baseKR4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_40GBASE_KR4);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  40000baseLR4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_40GBASE_LR4);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  40000baseSR4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_40GBASE_SR4);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  50000baseCR2_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_50GBASE_CR2);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  50000baseKR2_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_50GBASE_KR2);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  50000baseSR2_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_50GBASE_SR2);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  50000baseCR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_50GBASE_CR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  50000baseKR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_50GBASE_KR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  50000baseLR_ER_FR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_50GBASE_LR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  50000baseSR_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_50GBASE_SR);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  100000baseCR4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_100GBASE_CR4);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  100000baseKR4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_100GBASE_KR4);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  100000baseLR4_ER4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_100GBASE_LR4);\n\tif (ethtool_link_ksettings_test_link_mode(cmd, advertising,\n\t\t\t\t\t\t  100000baseSR4_Full))\n\t\tadvertised |= BIT(OCTEP_LINK_MODE_100GBASE_SR4);\n\n\tif (advertised == link_info->advertised_modes &&\n\t    cmd->base.speed == link_info->speed &&\n\t    cmd->base.autoneg == link_info->autoneg)\n\t\treturn 0;\n\n\tlink_info_new.advertised_modes = advertised;\n\tlink_info_new.speed = cmd->base.speed;\n\tlink_info_new.autoneg = autoneg;\n\n\terr = octep_ctrl_net_set_link_info(oct, OCTEP_CTRL_NET_INVALID_VFID,\n\t\t\t\t\t   &link_info_new, true);\n\tif (err)\n\t\treturn err;\n\n\tmemcpy(link_info, &link_info_new, sizeof(struct octep_iface_link_info));\n\treturn 0;\n}\n\nstatic const struct ethtool_ops octep_ethtool_ops = {\n\t.get_drvinfo = octep_get_drvinfo,\n\t.get_link = ethtool_op_get_link,\n\t.get_strings = octep_get_strings,\n\t.get_sset_count = octep_get_sset_count,\n\t.get_ethtool_stats = octep_get_ethtool_stats,\n\t.get_link_ksettings = octep_get_link_ksettings,\n\t.set_link_ksettings = octep_set_link_ksettings,\n};\n\nvoid octep_set_ethtool_ops(struct net_device *netdev)\n{\n\tnetdev->ethtool_ops = &octep_ethtool_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}