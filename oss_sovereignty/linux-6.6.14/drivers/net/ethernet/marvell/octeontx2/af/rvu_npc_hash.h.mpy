{
  "module_name": "rvu_npc_hash.h",
  "hash_id": "4c593dbd8e359fcbdaeb0ad07ff960905ef9af62ff3bb211f9c3161c32fe1513",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/marvell/octeontx2/af/rvu_npc_hash.h",
  "human_readable_source": " \n \n\n#ifndef __RVU_NPC_HASH_H\n#define __RVU_NPC_HASH_H\n\n#define RVU_NPC_HASH_SECRET_KEY0 0xa9d5af4c9fbc76b1\n#define RVU_NPC_HASH_SECRET_KEY1 0xa9d5af4c9fbc87b4\n#define RVU_NPC_HASH_SECRET_KEY2 0x5954c9e7\n\n#define NPC_MAX_HASH 2\n#define NPC_MAX_HASH_MASK 2\n\n#define KEX_LD_CFG_USE_HASH(use_hash, bytesm1, hdr_ofs, ena, flags_ena, key_ofs) \\\n\t\t\t    ((use_hash) << 20 | ((bytesm1) << 16) | ((hdr_ofs) << 8) | \\\n\t\t\t     ((ena) << 7) | ((flags_ena) << 6) | ((key_ofs) & 0x3F))\n#define KEX_LD_CFG_HASH(hdr_ofs, bytesm1, lt_en, lid_en, lid, ltype_match, ltype_mask)\t\\\n\t\t\t(((hdr_ofs) << 32) | ((bytesm1) << 16) | \\\n\t\t\t ((lt_en) << 12) | ((lid_en) << 11) | ((lid) << 8) | \\\n\t\t\t ((ltype_match) << 4) | ((ltype_mask) & 0xF))\n\n#define SET_KEX_LD_HASH(intf, ld, cfg) \\\n\trvu_write64(rvu, blkaddr,\t\\\n\t\t    NPC_AF_INTFX_HASHX_CFG(intf, ld), cfg)\n\n#define SET_KEX_LD_HASH_MASK(intf, ld, mask_idx, cfg) \\\n\trvu_write64(rvu, blkaddr,\t\\\n\t\t    NPC_AF_INTFX_HASHX_MASKX(intf, ld, mask_idx), cfg)\n\n#define GET_KEX_LD_HASH_CTRL(intf, ld)\t\\\n\trvu_read64(rvu, blkaddr, NPC_AF_INTFX_HASHX_RESULT_CTRL(intf, ld))\n\n#define GET_KEX_LD_HASH_MASK(intf, ld, mask_idx)\t\\\n\trvu_read64(rvu, blkaddr, NPC_AF_INTFX_HASHX_MASKX(intf, ld, mask_idx))\n\n#define SET_KEX_LD_HASH_CTRL(intf, ld, cfg) \\\n\trvu_write64(rvu, blkaddr,\t\\\n\t\t    NPC_AF_INTFX_HASHX_RESULT_CTRL(intf, ld), cfg)\n\nstruct npc_mcam_kex_hash {\n\t \n\tbool lid_lt_ld_hash_en[NPC_MAX_INTF][NPC_MAX_LID][NPC_MAX_LT][NPC_MAX_LD];\n\t \n\tu64 hash[NPC_MAX_INTF][NPC_MAX_HASH];\n\t \n\tu64 hash_mask[NPC_MAX_INTF][NPC_MAX_HASH][NPC_MAX_HASH_MASK];\n\t \n\tu64 hash_ctrl[NPC_MAX_INTF][NPC_MAX_HASH];\n} __packed;\n\nvoid npc_update_field_hash(struct rvu *rvu, u8 intf,\n\t\t\t   struct mcam_entry *entry,\n\t\t\t   int blkaddr,\n\t\t\t   u64 features,\n\t\t\t   struct flow_msg *pkt,\n\t\t\t   struct flow_msg *mask,\n\t\t\t   struct flow_msg *opkt,\n\t\t\t   struct flow_msg *omask);\nvoid npc_config_secret_key(struct rvu *rvu, int blkaddr);\nvoid npc_program_mkex_hash(struct rvu *rvu, int blkaddr);\nu32 npc_field_hash_calc(u64 *ldata, struct npc_get_field_hash_info_rsp rsp,\n\t\t\tu8 intf, u8 hash_idx);\n\nstatic struct npc_mcam_kex_hash npc_mkex_hash_default __maybe_unused = {\n\t.lid_lt_ld_hash_en = {\n\t[NIX_INTF_RX] = {\n\t\t[NPC_LID_LC] = {\n\t\t\t[NPC_LT_LC_IP6] = {\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t},\n\t\t},\n\t},\n\n\t[NIX_INTF_TX] = {\n\t\t[NPC_LID_LC] = {\n\t\t\t[NPC_LT_LC_IP6] = {\n\t\t\t\tfalse,\n\t\t\t\tfalse,\n\t\t\t},\n\t\t},\n\t},\n\t},\n\n\t.hash = {\n\t[NIX_INTF_RX] = {\n\t\tKEX_LD_CFG_HASH(0x8ULL, 0xf, 0x1, 0x1, NPC_LID_LC, NPC_LT_LC_IP6, 0xf),\n\t\tKEX_LD_CFG_HASH(0x18ULL, 0xf, 0x1, 0x1, NPC_LID_LC, NPC_LT_LC_IP6, 0xf),\n\t},\n\n\t[NIX_INTF_TX] = {\n\t\tKEX_LD_CFG_HASH(0x8ULL, 0xf, 0x1, 0x1, NPC_LID_LC, NPC_LT_LC_IP6, 0xf),\n\t\tKEX_LD_CFG_HASH(0x18ULL, 0xf, 0x1, 0x1, NPC_LID_LC, NPC_LT_LC_IP6, 0xf),\n\t},\n\t},\n\n\t.hash_mask = {\n\t[NIX_INTF_RX] = {\n\t\t[0] = {\n\t\t\tGENMASK_ULL(63, 0),\n\t\t\tGENMASK_ULL(63, 0),\n\t\t},\n\t\t[1] = {\n\t\t\tGENMASK_ULL(63, 0),\n\t\t\tGENMASK_ULL(63, 0),\n\t\t},\n\t},\n\n\t[NIX_INTF_TX] = {\n\t\t[0] = {\n\t\t\tGENMASK_ULL(63, 0),\n\t\t\tGENMASK_ULL(63, 0),\n\t\t},\n\t\t[1] = {\n\t\t\tGENMASK_ULL(63, 0),\n\t\t\tGENMASK_ULL(63, 0),\n\t\t},\n\t},\n\t},\n\n\t.hash_ctrl = {\n\t[NIX_INTF_RX] = {\n\t\t[0] = GENMASK_ULL(63, 32),  \n\t\t[1] = GENMASK_ULL(63, 32),  \n\t},\n\n\t[NIX_INTF_TX] = {\n\t\t[0] = GENMASK_ULL(63, 32),  \n\t\t[1] = GENMASK_ULL(63, 32),  \n\t},\n\t},\n};\n\n \n#define NPC_MCAM_DROP_RULE_MAX 30\n#define NPC_MCAM_SDP_DROP_RULE_IDX 0\n\n#define RVU_PFFUNC(pf, func)\t\\\n\t((((pf) & RVU_PFVF_PF_MASK) << RVU_PFVF_PF_SHIFT) | \\\n\t(((func) & RVU_PFVF_FUNC_MASK) << RVU_PFVF_FUNC_SHIFT))\n\nenum npc_exact_opc_type {\n\tNPC_EXACT_OPC_MEM,\n\tNPC_EXACT_OPC_CAM,\n};\n\nstruct npc_exact_table_entry {\n\tstruct list_head list;\n\tstruct list_head glist;\n\tu32 seq_id;\t \n\tu32 index;\t \n\tu32 mcam_idx;\n\t\t \n\tenum npc_exact_opc_type opc_type;\n\tu16 chan;\n\tu16 pcifunc;\n\tu8 ways;\n\tu8 mac[ETH_ALEN];\n\tu8 ctype;\n\tu8 cgx_id;\n\tu8 lmac_id;\n\tbool cmd;\t \n};\n\nstruct npc_exact_table {\n\tstruct mutex lock;\t \n\tunsigned long *id_bmap;\n\tint num_drop_rules;\n\tu32 tot_ids;\n\tu16 cnt_cmd_rules[NPC_MCAM_DROP_RULE_MAX];\n\tu16 counter_idx[NPC_MCAM_DROP_RULE_MAX];\n\tbool promisc_mode[NPC_MCAM_DROP_RULE_MAX];\n\tstruct {\n\t\tint ways;\n\t\tint depth;\n\t\tunsigned long *bmap;\n\t\tu64 mask;\t\n\t\tu16 hash_mask;\t\n\t\tu16 hash_offset; \n\t} mem_table;\n\n\tstruct {\n\t\tint depth;\n\t\tunsigned long *bmap;\n\t} cam_table;\n\n\tstruct {\n\t\tbool valid;\n\t\tu16 chan_val;\n\t\tu16 chan_mask;\n\t\tu16 pcifunc;\n\t\tu8 drop_rule_idx;\n\t} drop_rule_map[NPC_MCAM_DROP_RULE_MAX];\n\n#define NPC_EXACT_TBL_MAX_WAYS 4\n\n\tstruct list_head lhead_mem_tbl_entry[NPC_EXACT_TBL_MAX_WAYS];\n\tint mem_tbl_entry_cnt;\n\n\tstruct list_head lhead_cam_tbl_entry;\n\tint cam_tbl_entry_cnt;\n\n\tstruct list_head lhead_gbl;\n};\n\nbool rvu_npc_exact_has_match_table(struct rvu *rvu);\nu32 rvu_npc_exact_get_max_entries(struct rvu *rvu);\nint rvu_npc_exact_init(struct rvu *rvu);\nint rvu_npc_exact_mac_addr_reset(struct rvu *rvu, struct cgx_mac_addr_reset_req *req,\n\t\t\t\t struct msg_rsp *rsp);\n\nint rvu_npc_exact_mac_addr_update(struct rvu *rvu,\n\t\t\t\t  struct cgx_mac_addr_update_req *req,\n\t\t\t\t  struct cgx_mac_addr_update_rsp *rsp);\n\nint rvu_npc_exact_mac_addr_add(struct rvu *rvu,\n\t\t\t       struct cgx_mac_addr_add_req *req,\n\t\t\t       struct cgx_mac_addr_add_rsp *rsp);\n\nint rvu_npc_exact_mac_addr_del(struct rvu *rvu,\n\t\t\t       struct cgx_mac_addr_del_req *req,\n\t\t\t       struct msg_rsp *rsp);\n\nint rvu_npc_exact_mac_addr_set(struct rvu *rvu, struct cgx_mac_addr_set_or_get *req,\n\t\t\t       struct cgx_mac_addr_set_or_get *rsp);\n\nvoid rvu_npc_exact_reset(struct rvu *rvu, u16 pcifunc);\n\nbool rvu_npc_exact_can_disable_feature(struct rvu *rvu);\nvoid rvu_npc_exact_disable_feature(struct rvu *rvu);\nvoid rvu_npc_exact_reset(struct rvu *rvu, u16 pcifunc);\nu16 rvu_npc_exact_drop_rule_to_pcifunc(struct rvu *rvu, u32 drop_rule_idx);\nint rvu_npc_exact_promisc_disable(struct rvu *rvu, u16 pcifunc);\nint rvu_npc_exact_promisc_enable(struct rvu *rvu, u16 pcifunc);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}