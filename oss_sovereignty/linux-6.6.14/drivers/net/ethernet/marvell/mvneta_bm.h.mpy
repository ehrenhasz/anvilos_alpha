{
  "module_name": "mvneta_bm.h",
  "hash_id": "04ed74442963f0f4c63593663be36b126c3e45905ea02cec7401f27ac5f72ef4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/marvell/mvneta_bm.h",
  "human_readable_source": " \n\n#ifndef _MVNETA_BM_H_\n#define _MVNETA_BM_H_\n\n \n#define MVNETA_BM_CONFIG_REG\t\t\t0x0\n#define    MVNETA_BM_STATUS_MASK\t\t0x30\n#define    MVNETA_BM_ACTIVE_MASK\t\tBIT(4)\n#define    MVNETA_BM_MAX_IN_BURST_SIZE_MASK\t0x60000\n#define    MVNETA_BM_MAX_IN_BURST_SIZE_16BP\tBIT(18)\n#define    MVNETA_BM_EMPTY_LIMIT_MASK\t\tBIT(19)\n\n \n#define MVNETA_BM_COMMAND_REG\t\t\t0x4\n#define    MVNETA_BM_START_MASK\t\t\tBIT(0)\n#define    MVNETA_BM_STOP_MASK\t\t\tBIT(1)\n#define    MVNETA_BM_PAUSE_MASK\t\t\tBIT(2)\n\n \n#define MVNETA_BM_XBAR_01_REG\t\t\t0x8\n#define MVNETA_BM_XBAR_23_REG\t\t\t0xc\n#define MVNETA_BM_XBAR_POOL_REG(pool)\t\t\\\n\t\t(((pool) < 2) ? MVNETA_BM_XBAR_01_REG : MVNETA_BM_XBAR_23_REG)\n#define     MVNETA_BM_TARGET_ID_OFFS(pool)\t(((pool) & 1) ? 16 : 0)\n#define     MVNETA_BM_TARGET_ID_MASK(pool)\t\\\n\t\t(0xf << MVNETA_BM_TARGET_ID_OFFS(pool))\n#define     MVNETA_BM_TARGET_ID_VAL(pool, id)\t\\\n\t\t((id) << MVNETA_BM_TARGET_ID_OFFS(pool))\n#define     MVNETA_BM_XBAR_ATTR_OFFS(pool)\t(((pool) & 1) ? 20 : 4)\n#define     MVNETA_BM_XBAR_ATTR_MASK(pool)\t\\\n\t\t(0xff << MVNETA_BM_XBAR_ATTR_OFFS(pool))\n#define     MVNETA_BM_XBAR_ATTR_VAL(pool, attr)\t\\\n\t\t((attr) << MVNETA_BM_XBAR_ATTR_OFFS(pool))\n\n \n#define MVNETA_BM_POOL_BASE_REG(pool)\t\t(0x10 + ((pool) << 4))\n#define     MVNETA_BM_POOL_ENABLE_MASK\t\tBIT(0)\n\n \n#define MVNETA_BM_POOL_READ_PTR_REG(pool)\t(0x14 + ((pool) << 4))\n#define     MVNETA_BM_POOL_SET_READ_PTR_MASK\t0xfffc\n#define     MVNETA_BM_POOL_GET_READ_PTR_OFFS\t16\n#define     MVNETA_BM_POOL_GET_READ_PTR_MASK\t0xfffc0000\n\n \n#define MVNETA_BM_POOL_WRITE_PTR_REG(pool)\t(0x18 + ((pool) << 4))\n#define     MVNETA_BM_POOL_SET_WRITE_PTR_OFFS\t0\n#define     MVNETA_BM_POOL_SET_WRITE_PTR_MASK\t0xfffc\n#define     MVNETA_BM_POOL_GET_WRITE_PTR_OFFS\t16\n#define     MVNETA_BM_POOL_GET_WRITE_PTR_MASK\t0xfffc0000\n\n \n#define MVNETA_BM_POOL_SIZE_REG(pool)\t\t(0x1c + ((pool) << 4))\n#define     MVNETA_BM_POOL_SIZE_MASK\t\t0x3fff\n\n \n#define MVNETA_BM_INTR_CAUSE_REG\t\t(0x50)\n\n \n#define MVNETA_BM_INTR_MASK_REG\t\t\t(0x54)\n\n \n#define MVNETA_BM_SHORT_PKT_SIZE\t\t256\n#define MVNETA_BM_POOLS_NUM\t\t\t4\n#define MVNETA_BM_POOL_CAP_MIN\t\t\t128\n#define MVNETA_BM_POOL_CAP_DEF\t\t\t2048\n#define MVNETA_BM_POOL_CAP_MAX\t\t\t\\\n\t\t(16 * 1024 - MVNETA_BM_POOL_CAP_ALIGN)\n#define MVNETA_BM_POOL_CAP_ALIGN\t\t32\n#define MVNETA_BM_POOL_PTR_ALIGN\t\t32\n\n#define MVNETA_BM_POOL_ACCESS_OFFS\t\t8\n\n#define MVNETA_BM_BPPI_SIZE\t\t\t0x100000\n\n#define MVNETA_RX_BUF_SIZE(pkt_size)   ((pkt_size) + NET_SKB_PAD)\n\nenum mvneta_bm_type {\n\tMVNETA_BM_FREE,\n\tMVNETA_BM_LONG,\n\tMVNETA_BM_SHORT\n};\n\nstruct mvneta_bm {\n\tvoid __iomem *reg_base;\n\tstruct clk *clk;\n\tstruct platform_device *pdev;\n\n\tstruct gen_pool *bppi_pool;\n\t \n\tvoid __iomem *bppi_virt_addr;\n\t \n\tdma_addr_t bppi_phys_addr;\n\n\t \n\tstruct mvneta_bm_pool *bm_pools;\n};\n\nstruct mvneta_bm_pool {\n\tstruct hwbm_pool hwbm_pool;\n\t \n\tu8 id;\n\tenum mvneta_bm_type type;\n\n\t \n\tint pkt_size;\n\t \n\tu32 buf_size;\n\n\t \n\tu32 *virt_addr;\n\t \n\tdma_addr_t phys_addr;\n\n\t \n\tu8 port_map;\n\n\tstruct mvneta_bm *priv;\n};\n\n \n#if IS_ENABLED(CONFIG_MVNETA_BM)\nstruct mvneta_bm *mvneta_bm_get(struct device_node *node);\nvoid mvneta_bm_put(struct mvneta_bm *priv);\n\nvoid mvneta_bm_pool_destroy(struct mvneta_bm *priv,\n\t\t\t    struct mvneta_bm_pool *bm_pool, u8 port_map);\nvoid mvneta_bm_bufs_free(struct mvneta_bm *priv, struct mvneta_bm_pool *bm_pool,\n\t\t\t u8 port_map);\nint mvneta_bm_construct(struct hwbm_pool *hwbm_pool, void *buf);\nint mvneta_bm_pool_refill(struct mvneta_bm *priv,\n\t\t\t  struct mvneta_bm_pool *bm_pool);\nstruct mvneta_bm_pool *mvneta_bm_pool_use(struct mvneta_bm *priv, u8 pool_id,\n\t\t\t\t\t  enum mvneta_bm_type type, u8 port_id,\n\t\t\t\t\t  int pkt_size);\n\nstatic inline void mvneta_bm_pool_put_bp(struct mvneta_bm *priv,\n\t\t\t\t\t struct mvneta_bm_pool *bm_pool,\n\t\t\t\t\t dma_addr_t buf_phys_addr)\n{\n\twritel_relaxed(buf_phys_addr, priv->bppi_virt_addr +\n\t\t       (bm_pool->id << MVNETA_BM_POOL_ACCESS_OFFS));\n}\n\nstatic inline u32 mvneta_bm_pool_get_bp(struct mvneta_bm *priv,\n\t\t\t\t\tstruct mvneta_bm_pool *bm_pool)\n{\n\treturn readl_relaxed(priv->bppi_virt_addr +\n\t\t\t     (bm_pool->id << MVNETA_BM_POOL_ACCESS_OFFS));\n}\n#else\nstatic inline void mvneta_bm_pool_destroy(struct mvneta_bm *priv,\n\t\t\t\t\t  struct mvneta_bm_pool *bm_pool,\n\t\t\t\t\t  u8 port_map) {}\nstatic inline void mvneta_bm_bufs_free(struct mvneta_bm *priv,\n\t\t\t\t       struct mvneta_bm_pool *bm_pool,\n\t\t\t\t       u8 port_map) {}\nstatic inline int mvneta_bm_construct(struct hwbm_pool *hwbm_pool, void *buf)\n{ return 0; }\nstatic inline int mvneta_bm_pool_refill(struct mvneta_bm *priv,\n\t\t\t\t\tstruct mvneta_bm_pool *bm_pool)\n{ return 0; }\nstatic inline struct mvneta_bm_pool *mvneta_bm_pool_use(struct mvneta_bm *priv,\n\t\t\t\t\t\t\tu8 pool_id,\n\t\t\t\t\t\t\tenum mvneta_bm_type type,\n\t\t\t\t\t\t\tu8 port_id,\n\t\t\t\t\t\t\tint pkt_size)\n{ return NULL; }\n\nstatic inline void mvneta_bm_pool_put_bp(struct mvneta_bm *priv,\n\t\t\t\t\t struct mvneta_bm_pool *bm_pool,\n\t\t\t\t\t dma_addr_t buf_phys_addr) {}\n\nstatic inline u32 mvneta_bm_pool_get_bp(struct mvneta_bm *priv,\n\t\t\t\t\tstruct mvneta_bm_pool *bm_pool)\n{ return 0; }\nstatic inline struct mvneta_bm *mvneta_bm_get(struct device_node *node)\n{ return NULL; }\nstatic inline void mvneta_bm_put(struct mvneta_bm *priv) {}\n#endif  \n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}