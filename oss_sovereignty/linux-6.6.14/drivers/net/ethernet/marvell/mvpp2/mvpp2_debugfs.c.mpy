{
  "module_name": "mvpp2_debugfs.c",
  "hash_id": "a61f5b1be6edc680203a443fddb87cc467312ac9de0d96d8d71bd3adcb534461",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/marvell/mvpp2/mvpp2_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/debugfs.h>\n\n#include \"mvpp2.h\"\n#include \"mvpp2_prs.h\"\n#include \"mvpp2_cls.h\"\n\nstruct mvpp2_dbgfs_prs_entry {\n\tint tid;\n\tstruct mvpp2 *priv;\n};\n\nstruct mvpp2_dbgfs_c2_entry {\n\tint id;\n\tstruct mvpp2 *priv;\n};\n\nstruct mvpp2_dbgfs_flow_entry {\n\tint flow;\n\tstruct mvpp2 *priv;\n};\n\nstruct mvpp2_dbgfs_flow_tbl_entry {\n\tint id;\n\tstruct mvpp2 *priv;\n};\n\nstruct mvpp2_dbgfs_port_flow_entry {\n\tstruct mvpp2_port *port;\n\tstruct mvpp2_dbgfs_flow_entry *dbg_fe;\n};\n\nstruct mvpp2_dbgfs_entries {\n\t \n\tstruct mvpp2_dbgfs_prs_entry prs_entries[MVPP2_PRS_TCAM_SRAM_SIZE];\n\n\t \n\tstruct mvpp2_dbgfs_c2_entry c2_entries[MVPP22_CLS_C2_N_ENTRIES];\n\n\t \n\tstruct mvpp2_dbgfs_flow_tbl_entry flt_entries[MVPP2_CLS_FLOWS_TBL_SIZE];\n\n\t \n\tstruct mvpp2_dbgfs_flow_entry flow_entries[MVPP2_N_PRS_FLOWS];\n\n\t \n\tstruct mvpp2_dbgfs_port_flow_entry port_flow_entries[MVPP2_MAX_PORTS];\n};\n\nstatic int mvpp2_dbgfs_flow_flt_hits_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_flow_tbl_entry *entry = s->private;\n\n\tu32 hits = mvpp2_cls_flow_hits(entry->priv, entry->id);\n\n\tseq_printf(s, \"%u\\n\", hits);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_flow_flt_hits);\n\nstatic int mvpp2_dbgfs_flow_dec_hits_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_flow_entry *entry = s->private;\n\n\tu32 hits = mvpp2_cls_lookup_hits(entry->priv, entry->flow);\n\n\tseq_printf(s, \"%u\\n\", hits);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_flow_dec_hits);\n\nstatic int mvpp2_dbgfs_flow_type_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_flow_entry *entry = s->private;\n\tconst struct mvpp2_cls_flow *f;\n\tconst char *flow_name;\n\n\tf = mvpp2_cls_flow_get(entry->flow);\n\tif (!f)\n\t\treturn -EINVAL;\n\n\tswitch (f->flow_type) {\n\tcase IPV4_FLOW:\n\t\tflow_name = \"ipv4\";\n\t\tbreak;\n\tcase IPV6_FLOW:\n\t\tflow_name = \"ipv6\";\n\t\tbreak;\n\tcase TCP_V4_FLOW:\n\t\tflow_name = \"tcp4\";\n\t\tbreak;\n\tcase TCP_V6_FLOW:\n\t\tflow_name = \"tcp6\";\n\t\tbreak;\n\tcase UDP_V4_FLOW:\n\t\tflow_name = \"udp4\";\n\t\tbreak;\n\tcase UDP_V6_FLOW:\n\t\tflow_name = \"udp6\";\n\t\tbreak;\n\tdefault:\n\t\tflow_name = \"other\";\n\t}\n\n\tseq_printf(s, \"%s\\n\", flow_name);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_flow_type);\n\nstatic int mvpp2_dbgfs_flow_id_show(struct seq_file *s, void *unused)\n{\n\tconst struct mvpp2_dbgfs_flow_entry *entry = s->private;\n\tconst struct mvpp2_cls_flow *f;\n\n\tf = mvpp2_cls_flow_get(entry->flow);\n\tif (!f)\n\t\treturn -EINVAL;\n\n\tseq_printf(s, \"%d\\n\", f->flow_id);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_flow_id);\n\nstatic int mvpp2_dbgfs_port_flow_hash_opt_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_port_flow_entry *entry = s->private;\n\tstruct mvpp2_port *port = entry->port;\n\tstruct mvpp2_cls_flow_entry fe;\n\tconst struct mvpp2_cls_flow *f;\n\tint flow_index;\n\tu16 hash_opts;\n\n\tf = mvpp2_cls_flow_get(entry->dbg_fe->flow);\n\tif (!f)\n\t\treturn -EINVAL;\n\n\tflow_index = MVPP2_CLS_FLT_HASH_ENTRY(entry->port->id, f->flow_id);\n\n\tmvpp2_cls_flow_read(port->priv, flow_index, &fe);\n\n\thash_opts = mvpp2_flow_get_hek_fields(&fe);\n\n\tseq_printf(s, \"0x%04x\\n\", hash_opts);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_port_flow_hash_opt);\n\nstatic int mvpp2_dbgfs_port_flow_engine_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_port_flow_entry *entry = s->private;\n\tstruct mvpp2_port *port = entry->port;\n\tstruct mvpp2_cls_flow_entry fe;\n\tconst struct mvpp2_cls_flow *f;\n\tint flow_index, engine;\n\n\tf = mvpp2_cls_flow_get(entry->dbg_fe->flow);\n\tif (!f)\n\t\treturn -EINVAL;\n\n\tflow_index = MVPP2_CLS_FLT_HASH_ENTRY(entry->port->id, f->flow_id);\n\n\tmvpp2_cls_flow_read(port->priv, flow_index, &fe);\n\n\tengine = mvpp2_cls_flow_eng_get(&fe);\n\n\tseq_printf(s, \"%d\\n\", engine);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_port_flow_engine);\n\nstatic int mvpp2_dbgfs_flow_c2_hits_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_c2_entry *entry = s->private;\n\tu32 hits;\n\n\thits = mvpp2_cls_c2_hit_count(entry->priv, entry->id);\n\n\tseq_printf(s, \"%u\\n\", hits);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_flow_c2_hits);\n\nstatic int mvpp2_dbgfs_flow_c2_rxq_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_c2_entry *entry = s->private;\n\tstruct mvpp2_cls_c2_entry c2;\n\tu8 qh, ql;\n\n\tmvpp2_cls_c2_read(entry->priv, entry->id, &c2);\n\n\tqh = (c2.attr[0] >> MVPP22_CLS_C2_ATTR0_QHIGH_OFFS) &\n\t     MVPP22_CLS_C2_ATTR0_QHIGH_MASK;\n\n\tql = (c2.attr[0] >> MVPP22_CLS_C2_ATTR0_QLOW_OFFS) &\n\t     MVPP22_CLS_C2_ATTR0_QLOW_MASK;\n\n\tseq_printf(s, \"%d\\n\", (qh << 3 | ql));\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_flow_c2_rxq);\n\nstatic int mvpp2_dbgfs_flow_c2_enable_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_c2_entry *entry = s->private;\n\tstruct mvpp2_cls_c2_entry c2;\n\tint enabled;\n\n\tmvpp2_cls_c2_read(entry->priv, entry->id, &c2);\n\n\tenabled = !!(c2.attr[2] & MVPP22_CLS_C2_ATTR2_RSS_EN);\n\n\tseq_printf(s, \"%d\\n\", enabled);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_flow_c2_enable);\n\nstatic int mvpp2_dbgfs_port_vid_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_port *port = s->private;\n\tunsigned char byte[2], enable[2];\n\tstruct mvpp2 *priv = port->priv;\n\tstruct mvpp2_prs_entry pe;\n\tunsigned long pmap;\n\tu16 rvid;\n\tint tid;\n\n\tfor (tid = MVPP2_PRS_VID_PORT_FIRST(port->id);\n\t     tid <= MVPP2_PRS_VID_PORT_LAST(port->id); tid++) {\n\t\tmvpp2_prs_init_from_hw(priv, &pe, tid);\n\n\t\tpmap = mvpp2_prs_tcam_port_map_get(&pe);\n\n\t\tif (!priv->prs_shadow[tid].valid)\n\t\t\tcontinue;\n\n\t\tif (!test_bit(port->id, &pmap))\n\t\t\tcontinue;\n\n\t\tmvpp2_prs_tcam_data_byte_get(&pe, 2, &byte[0], &enable[0]);\n\t\tmvpp2_prs_tcam_data_byte_get(&pe, 3, &byte[1], &enable[1]);\n\n\t\trvid = ((byte[0] & 0xf) << 8) + byte[1];\n\n\t\tseq_printf(s, \"%u\\n\", rvid);\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_port_vid);\n\nstatic int mvpp2_dbgfs_port_parser_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_port *port = s->private;\n\tstruct mvpp2 *priv = port->priv;\n\tstruct mvpp2_prs_entry pe;\n\tunsigned long pmap;\n\tint i;\n\n\tfor (i = 0; i < MVPP2_PRS_TCAM_SRAM_SIZE; i++) {\n\t\tmvpp2_prs_init_from_hw(port->priv, &pe, i);\n\n\t\tpmap = mvpp2_prs_tcam_port_map_get(&pe);\n\t\tif (priv->prs_shadow[i].valid && test_bit(port->id, &pmap))\n\t\t\tseq_printf(s, \"%03d\\n\", i);\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_port_parser);\n\nstatic int mvpp2_dbgfs_filter_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_port *port = s->private;\n\tstruct mvpp2 *priv = port->priv;\n\tstruct mvpp2_prs_entry pe;\n\tunsigned long pmap;\n\tint index, tid;\n\n\tfor (tid = MVPP2_PE_MAC_RANGE_START;\n\t     tid <= MVPP2_PE_MAC_RANGE_END; tid++) {\n\t\tunsigned char da[ETH_ALEN], da_mask[ETH_ALEN];\n\n\t\tif (!priv->prs_shadow[tid].valid ||\n\t\t    priv->prs_shadow[tid].lu != MVPP2_PRS_LU_MAC ||\n\t\t    priv->prs_shadow[tid].udf != MVPP2_PRS_UDF_MAC_DEF)\n\t\t\tcontinue;\n\n\t\tmvpp2_prs_init_from_hw(priv, &pe, tid);\n\n\t\tpmap = mvpp2_prs_tcam_port_map_get(&pe);\n\n\t\t \n\t\tif (!test_bit(port->id, &pmap))\n\t\t\tcontinue;\n\n\t\t \n\t\tfor (index = 0; index < ETH_ALEN; index++)\n\t\t\tmvpp2_prs_tcam_data_byte_get(&pe, index, &da[index],\n\t\t\t\t\t\t     &da_mask[index]);\n\n\t\tseq_printf(s, \"%pM\\n\", da);\n\t}\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_filter);\n\nstatic int mvpp2_dbgfs_prs_lu_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry = s->private;\n\tstruct mvpp2 *priv = entry->priv;\n\n\tseq_printf(s, \"%x\\n\", priv->prs_shadow[entry->tid].lu);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_prs_lu);\n\nstatic int mvpp2_dbgfs_prs_pmap_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry = s->private;\n\tstruct mvpp2_prs_entry pe;\n\tunsigned int pmap;\n\n\tmvpp2_prs_init_from_hw(entry->priv, &pe, entry->tid);\n\n\tpmap = mvpp2_prs_tcam_port_map_get(&pe);\n\tpmap &= MVPP2_PRS_PORT_MASK;\n\n\tseq_printf(s, \"%02x\\n\", pmap);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_prs_pmap);\n\nstatic int mvpp2_dbgfs_prs_ai_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry = s->private;\n\tstruct mvpp2_prs_entry pe;\n\tunsigned char ai, ai_mask;\n\n\tmvpp2_prs_init_from_hw(entry->priv, &pe, entry->tid);\n\n\tai = pe.tcam[MVPP2_PRS_TCAM_AI_WORD] & MVPP2_PRS_AI_MASK;\n\tai_mask = (pe.tcam[MVPP2_PRS_TCAM_AI_WORD] >> 16) & MVPP2_PRS_AI_MASK;\n\n\tseq_printf(s, \"%02x %02x\\n\", ai, ai_mask);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_prs_ai);\n\nstatic int mvpp2_dbgfs_prs_hdata_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry = s->private;\n\tstruct mvpp2_prs_entry pe;\n\tunsigned char data[8], mask[8];\n\tint i;\n\n\tmvpp2_prs_init_from_hw(entry->priv, &pe, entry->tid);\n\n\tfor (i = 0; i < 8; i++)\n\t\tmvpp2_prs_tcam_data_byte_get(&pe, i, &data[i], &mask[i]);\n\n\tseq_printf(s, \"%*phN %*phN\\n\", 8, data, 8, mask);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_prs_hdata);\n\nstatic int mvpp2_dbgfs_prs_sram_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry = s->private;\n\tstruct mvpp2_prs_entry pe;\n\n\tmvpp2_prs_init_from_hw(entry->priv, &pe, entry->tid);\n\n\tseq_printf(s, \"%*phN\\n\", 14, pe.sram);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_prs_sram);\n\nstatic int mvpp2_dbgfs_prs_hits_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry = s->private;\n\tint val;\n\n\tval = mvpp2_prs_hits(entry->priv, entry->tid);\n\tif (val < 0)\n\t\treturn val;\n\n\tseq_printf(s, \"%d\\n\", val);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_prs_hits);\n\nstatic int mvpp2_dbgfs_prs_valid_show(struct seq_file *s, void *unused)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry = s->private;\n\tstruct mvpp2 *priv = entry->priv;\n\tint tid = entry->tid;\n\n\tseq_printf(s, \"%d\\n\", priv->prs_shadow[tid].valid ? 1 : 0);\n\n\treturn 0;\n}\n\nDEFINE_SHOW_ATTRIBUTE(mvpp2_dbgfs_prs_valid);\n\nstatic int mvpp2_dbgfs_flow_port_init(struct dentry *parent,\n\t\t\t\t      struct mvpp2_port *port,\n\t\t\t\t      struct mvpp2_dbgfs_flow_entry *entry)\n{\n\tstruct mvpp2_dbgfs_port_flow_entry *port_entry;\n\tstruct dentry *port_dir;\n\n\tport_dir = debugfs_create_dir(port->dev->name, parent);\n\n\tport_entry = &port->priv->dbgfs_entries->port_flow_entries[port->id];\n\n\tport_entry->port = port;\n\tport_entry->dbg_fe = entry;\n\n\tdebugfs_create_file(\"hash_opts\", 0444, port_dir, port_entry,\n\t\t\t    &mvpp2_dbgfs_port_flow_hash_opt_fops);\n\n\tdebugfs_create_file(\"engine\", 0444, port_dir, port_entry,\n\t\t\t    &mvpp2_dbgfs_port_flow_engine_fops);\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_flow_entry_init(struct dentry *parent,\n\t\t\t\t       struct mvpp2 *priv, int flow)\n{\n\tstruct mvpp2_dbgfs_flow_entry *entry;\n\tstruct dentry *flow_entry_dir;\n\tchar flow_entry_name[10];\n\tint i, ret;\n\n\tsprintf(flow_entry_name, \"%02d\", flow);\n\n\tflow_entry_dir = debugfs_create_dir(flow_entry_name, parent);\n\n\tentry = &priv->dbgfs_entries->flow_entries[flow];\n\n\tentry->flow = flow;\n\tentry->priv = priv;\n\n\tdebugfs_create_file(\"dec_hits\", 0444, flow_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_flow_dec_hits_fops);\n\n\tdebugfs_create_file(\"type\", 0444, flow_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_flow_type_fops);\n\n\tdebugfs_create_file(\"id\", 0444, flow_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_flow_id_fops);\n\n\t \n\tfor (i = 0; i < priv->port_count; i++) {\n\t\tret = mvpp2_dbgfs_flow_port_init(flow_entry_dir,\n\t\t\t\t\t\t priv->port_list[i], entry);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_flow_init(struct dentry *parent, struct mvpp2 *priv)\n{\n\tstruct dentry *flow_dir;\n\tint i, ret;\n\n\tflow_dir = debugfs_create_dir(\"flows\", parent);\n\n\tfor (i = 0; i < MVPP2_N_PRS_FLOWS; i++) {\n\t\tret = mvpp2_dbgfs_flow_entry_init(flow_dir, priv, i);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_prs_entry_init(struct dentry *parent,\n\t\t\t\t      struct mvpp2 *priv, int tid)\n{\n\tstruct mvpp2_dbgfs_prs_entry *entry;\n\tstruct dentry *prs_entry_dir;\n\tchar prs_entry_name[10];\n\n\tif (tid >= MVPP2_PRS_TCAM_SRAM_SIZE)\n\t\treturn -EINVAL;\n\n\tsprintf(prs_entry_name, \"%03d\", tid);\n\n\tprs_entry_dir = debugfs_create_dir(prs_entry_name, parent);\n\n\tentry = &priv->dbgfs_entries->prs_entries[tid];\n\n\tentry->tid = tid;\n\tentry->priv = priv;\n\n\t \n\tdebugfs_create_file(\"sram\", 0444, prs_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_prs_sram_fops);\n\n\tdebugfs_create_file(\"valid\", 0644, prs_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_prs_valid_fops);\n\n\tdebugfs_create_file(\"lookup_id\", 0644, prs_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_prs_lu_fops);\n\n\tdebugfs_create_file(\"ai\", 0644, prs_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_prs_ai_fops);\n\n\tdebugfs_create_file(\"header_data\", 0644, prs_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_prs_hdata_fops);\n\n\tdebugfs_create_file(\"hits\", 0444, prs_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_prs_hits_fops);\n\n\tdebugfs_create_file(\"pmap\", 0444, prs_entry_dir, entry,\n\t\t\t     &mvpp2_dbgfs_prs_pmap_fops);\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_prs_init(struct dentry *parent, struct mvpp2 *priv)\n{\n\tstruct dentry *prs_dir;\n\tint i, ret;\n\n\tprs_dir = debugfs_create_dir(\"parser\", parent);\n\n\tfor (i = 0; i < MVPP2_PRS_TCAM_SRAM_SIZE; i++) {\n\t\tret = mvpp2_dbgfs_prs_entry_init(prs_dir, priv, i);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_c2_entry_init(struct dentry *parent,\n\t\t\t\t     struct mvpp2 *priv, int id)\n{\n\tstruct mvpp2_dbgfs_c2_entry *entry;\n\tstruct dentry *c2_entry_dir;\n\tchar c2_entry_name[10];\n\n\tif (id >= MVPP22_CLS_C2_N_ENTRIES)\n\t\treturn -EINVAL;\n\n\tsprintf(c2_entry_name, \"%03d\", id);\n\n\tc2_entry_dir = debugfs_create_dir(c2_entry_name, parent);\n\n\tentry = &priv->dbgfs_entries->c2_entries[id];\n\n\tentry->id = id;\n\tentry->priv = priv;\n\n\tdebugfs_create_file(\"hits\", 0444, c2_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_flow_c2_hits_fops);\n\n\tdebugfs_create_file(\"default_rxq\", 0444, c2_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_flow_c2_rxq_fops);\n\n\tdebugfs_create_file(\"rss_enable\", 0444, c2_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_flow_c2_enable_fops);\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_flow_tbl_entry_init(struct dentry *parent,\n\t\t\t\t\t   struct mvpp2 *priv, int id)\n{\n\tstruct mvpp2_dbgfs_flow_tbl_entry *entry;\n\tstruct dentry *flow_tbl_entry_dir;\n\tchar flow_tbl_entry_name[10];\n\n\tif (id >= MVPP2_CLS_FLOWS_TBL_SIZE)\n\t\treturn -EINVAL;\n\n\tsprintf(flow_tbl_entry_name, \"%03d\", id);\n\n\tflow_tbl_entry_dir = debugfs_create_dir(flow_tbl_entry_name, parent);\n\n\tentry = &priv->dbgfs_entries->flt_entries[id];\n\n\tentry->id = id;\n\tentry->priv = priv;\n\n\tdebugfs_create_file(\"hits\", 0444, flow_tbl_entry_dir, entry,\n\t\t\t    &mvpp2_dbgfs_flow_flt_hits_fops);\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_cls_init(struct dentry *parent, struct mvpp2 *priv)\n{\n\tstruct dentry *cls_dir, *c2_dir, *flow_tbl_dir;\n\tint i, ret;\n\n\tcls_dir = debugfs_create_dir(\"classifier\", parent);\n\n\tc2_dir = debugfs_create_dir(\"c2\", cls_dir);\n\n\tfor (i = 0; i < MVPP22_CLS_C2_N_ENTRIES; i++) {\n\t\tret = mvpp2_dbgfs_c2_entry_init(c2_dir, priv, i);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tflow_tbl_dir = debugfs_create_dir(\"flow_table\", cls_dir);\n\n\tfor (i = 0; i < MVPP2_CLS_FLOWS_TBL_SIZE; i++) {\n\t\tret = mvpp2_dbgfs_flow_tbl_entry_init(flow_tbl_dir, priv, i);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int mvpp2_dbgfs_port_init(struct dentry *parent,\n\t\t\t\t struct mvpp2_port *port)\n{\n\tstruct dentry *port_dir;\n\n\tport_dir = debugfs_create_dir(port->dev->name, parent);\n\n\tdebugfs_create_file(\"parser_entries\", 0444, port_dir, port,\n\t\t\t    &mvpp2_dbgfs_port_parser_fops);\n\n\tdebugfs_create_file(\"mac_filter\", 0444, port_dir, port,\n\t\t\t    &mvpp2_dbgfs_filter_fops);\n\n\tdebugfs_create_file(\"vid_filter\", 0444, port_dir, port,\n\t\t\t    &mvpp2_dbgfs_port_vid_fops);\n\n\treturn 0;\n}\n\nstatic struct dentry *mvpp2_root;\n\nvoid mvpp2_dbgfs_exit(void)\n{\n\tdebugfs_remove(mvpp2_root);\n}\n\nvoid mvpp2_dbgfs_cleanup(struct mvpp2 *priv)\n{\n\tdebugfs_remove_recursive(priv->dbgfs_dir);\n\n\tkfree(priv->dbgfs_entries);\n}\n\nvoid mvpp2_dbgfs_init(struct mvpp2 *priv, const char *name)\n{\n\tstruct dentry *mvpp2_dir;\n\tint ret, i;\n\n\tif (!mvpp2_root)\n\t\tmvpp2_root = debugfs_create_dir(MVPP2_DRIVER_NAME, NULL);\n\n\tmvpp2_dir = debugfs_create_dir(name, mvpp2_root);\n\n\tpriv->dbgfs_dir = mvpp2_dir;\n\tpriv->dbgfs_entries = kzalloc(sizeof(*priv->dbgfs_entries), GFP_KERNEL);\n\tif (!priv->dbgfs_entries)\n\t\tgoto err;\n\n\tret = mvpp2_dbgfs_prs_init(mvpp2_dir, priv);\n\tif (ret)\n\t\tgoto err;\n\n\tret = mvpp2_dbgfs_cls_init(mvpp2_dir, priv);\n\tif (ret)\n\t\tgoto err;\n\n\tfor (i = 0; i < priv->port_count; i++) {\n\t\tret = mvpp2_dbgfs_port_init(mvpp2_dir, priv->port_list[i]);\n\t\tif (ret)\n\t\t\tgoto err;\n\t}\n\n\tret = mvpp2_dbgfs_flow_init(mvpp2_dir, priv);\n\tif (ret)\n\t\tgoto err;\n\n\treturn;\nerr:\n\tmvpp2_dbgfs_cleanup(priv);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}