{
  "module_name": "prestera.h",
  "hash_id": "27182fc07db5de0116dea2aede706d7c66c5b592c84a4b05dc0871cd33bdc79c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/marvell/prestera/prestera.h",
  "human_readable_source": " \n \n\n#ifndef _PRESTERA_H_\n#define _PRESTERA_H_\n\n#include <linux/notifier.h>\n#include <linux/skbuff.h>\n#include <linux/workqueue.h>\n#include <linux/phylink.h>\n#include <net/devlink.h>\n#include <uapi/linux/if_ether.h>\n\n#define PRESTERA_DRV_NAME\t\"prestera\"\n\n#define PRESTERA_DEFAULT_VID    1\n\nstruct prestera_fw_rev {\n\tu16 maj;\n\tu16 min;\n\tu16 sub;\n};\n\nstruct prestera_flood_domain {\n\tstruct prestera_switch *sw;\n\tstruct list_head flood_domain_port_list;\n\tu32 idx;\n};\n\nstruct prestera_mdb_entry {\n\tstruct prestera_switch *sw;\n\tstruct prestera_flood_domain *flood_domain;\n\tunsigned char addr[ETH_ALEN];\n\tu16 vid;\n};\n\nstruct prestera_flood_domain_port {\n\tstruct prestera_flood_domain *flood_domain;\n\tstruct net_device *dev;\n\tstruct list_head flood_domain_port_node;\n\tu16 vid;\n};\n\nstruct prestera_port_stats {\n\tu64 good_octets_received;\n\tu64 bad_octets_received;\n\tu64 mac_trans_error;\n\tu64 broadcast_frames_received;\n\tu64 multicast_frames_received;\n\tu64 frames_64_octets;\n\tu64 frames_65_to_127_octets;\n\tu64 frames_128_to_255_octets;\n\tu64 frames_256_to_511_octets;\n\tu64 frames_512_to_1023_octets;\n\tu64 frames_1024_to_max_octets;\n\tu64 excessive_collision;\n\tu64 multicast_frames_sent;\n\tu64 broadcast_frames_sent;\n\tu64 fc_sent;\n\tu64 fc_received;\n\tu64 buffer_overrun;\n\tu64 undersize;\n\tu64 fragments;\n\tu64 oversize;\n\tu64 jabber;\n\tu64 rx_error_frame_received;\n\tu64 bad_crc;\n\tu64 collisions;\n\tu64 late_collision;\n\tu64 unicast_frames_received;\n\tu64 unicast_frames_sent;\n\tu64 sent_multiple;\n\tu64 sent_deferred;\n\tu64 good_octets_sent;\n};\n\n#define PRESTERA_AP_PORT_MAX   (10)\n\nstruct prestera_port_caps {\n\tu64 supp_link_modes;\n\tu8 supp_fec;\n\tu8 type;\n\tu8 transceiver;\n};\n\nstruct prestera_lag {\n\tstruct net_device *dev;\n\tstruct list_head members;\n\tu16 member_count;\n\tu16 lag_id;\n};\n\nstruct prestera_flow_block;\n\nstruct prestera_port_mac_state {\n\tbool valid;\n\tu32 mode;\n\tu32 speed;\n\tbool oper;\n\tu8 duplex;\n\tu8 fc;\n\tu8 fec;\n};\n\nstruct prestera_port_phy_state {\n\tu64 lmode_bmap;\n\tstruct {\n\t\tbool pause;\n\t\tbool asym_pause;\n\t} remote_fc;\n\tu8 mdix;\n};\n\nstruct prestera_port_mac_config {\n\tu32 mode;\n\tu32 speed;\n\tbool admin;\n\tu8 inband;\n\tu8 duplex;\n\tu8 fec;\n};\n\nstruct prestera_port_phy_config {\n\tu32 mode;\n\tbool admin;\n\tu8 mdix;\n};\n\nstruct prestera_port {\n\tstruct net_device *dev;\n\tstruct prestera_switch *sw;\n\tstruct prestera_flow_block *ingress_flow_block;\n\tstruct prestera_flow_block *egress_flow_block;\n\tstruct devlink_port dl_port;\n\tstruct list_head lag_member;\n\tstruct prestera_lag *lag;\n\tu32 id;\n\tu32 hw_id;\n\tu32 dev_id;\n\tu16 fp_id;\n\tu16 pvid;\n\tbool autoneg;\n\tu64 adver_link_modes;\n\tu8 adver_fec;\n\tstruct prestera_port_caps caps;\n\tstruct list_head list;\n\tstruct list_head vlans_list;\n\tstruct {\n\t\tstruct prestera_port_stats stats;\n\t\tstruct delayed_work caching_dw;\n\t} cached_hw_stats;\n\tstruct prestera_port_mac_config cfg_mac;\n\tstruct prestera_port_phy_config cfg_phy;\n\tstruct prestera_port_mac_state state_mac;\n\tstruct prestera_port_phy_state state_phy;\n\n\tstruct phylink_config phy_config;\n\tstruct phylink *phy_link;\n\tstruct phylink_pcs phylink_pcs;\n\n\t \n\tspinlock_t state_mac_lock;\n};\n\nstruct prestera_device {\n\tstruct device *dev;\n\tu8 __iomem *ctl_regs;\n\tu8 __iomem *pp_regs;\n\tstruct prestera_fw_rev fw_rev;\n\tvoid *priv;\n\n\t \n\tvoid (*recv_pkt)(struct prestera_device *dev);\n\n\t \n\tint (*recv_msg)(struct prestera_device *dev, void *msg, size_t size);\n\n\t \n\tint (*send_req)(struct prestera_device *dev, int qid, void *in_msg,\n\t\t\tsize_t in_size, void *out_msg, size_t out_size,\n\t\t\tunsigned int wait);\n};\n\nenum prestera_event_type {\n\tPRESTERA_EVENT_TYPE_UNSPEC,\n\n\tPRESTERA_EVENT_TYPE_PORT,\n\tPRESTERA_EVENT_TYPE_FDB,\n\tPRESTERA_EVENT_TYPE_RXTX,\n\n\tPRESTERA_EVENT_TYPE_MAX\n};\n\nenum prestera_rxtx_event_id {\n\tPRESTERA_RXTX_EVENT_UNSPEC,\n\tPRESTERA_RXTX_EVENT_RCV_PKT,\n};\n\nenum prestera_port_event_id {\n\tPRESTERA_PORT_EVENT_UNSPEC,\n\tPRESTERA_PORT_EVENT_MAC_STATE_CHANGED,\n};\n\nstruct prestera_port_event {\n\tu32 port_id;\n\tunion {\n\t\tstruct {\n\t\t\tu32 mode;\n\t\t\tu32 speed;\n\t\t\tu8 oper;\n\t\t\tu8 duplex;\n\t\t\tu8 fc;\n\t\t\tu8 fec;\n\t\t} mac;\n\t\tstruct {\n\t\t\tu64 lmode_bmap;\n\t\t\tstruct {\n\t\t\t\tbool pause;\n\t\t\t\tbool asym_pause;\n\t\t\t} remote_fc;\n\t\t\tu8 mdix;\n\t\t} phy;\n\t} data;\n};\n\nenum prestera_fdb_entry_type {\n\tPRESTERA_FDB_ENTRY_TYPE_REG_PORT,\n\tPRESTERA_FDB_ENTRY_TYPE_LAG,\n\tPRESTERA_FDB_ENTRY_TYPE_MAX\n};\n\nenum prestera_fdb_event_id {\n\tPRESTERA_FDB_EVENT_UNSPEC,\n\tPRESTERA_FDB_EVENT_LEARNED,\n\tPRESTERA_FDB_EVENT_AGED,\n};\n\nstruct prestera_fdb_event {\n\tenum prestera_fdb_entry_type type;\n\tunion {\n\t\tu32 port_id;\n\t\tu16 lag_id;\n\t} dest;\n\tu32 vid;\n\tunion {\n\t\tu8 mac[ETH_ALEN];\n\t} data;\n};\n\nstruct prestera_event {\n\tu16 id;\n\tunion {\n\t\tstruct prestera_port_event port_evt;\n\t\tstruct prestera_fdb_event fdb_evt;\n\t};\n};\n\nenum prestera_if_type {\n\t \n\tPRESTERA_IF_PORT_E = 0,\n\n\t \n\tPRESTERA_IF_LAG_E = 1,\n\n\t \n\tPRESTERA_IF_VID_E = 3,\n};\n\nstruct prestera_iface {\n\tenum prestera_if_type type;\n\tstruct {\n\t\tu32 hw_dev_num;\n\t\tu32 port_num;\n\t} dev_port;\n\tu32 hw_dev_num;\n\tu16 vr_id;\n\tu16 lag_id;\n\tu16 vlan_id;\n};\n\nstruct prestera_switchdev;\nstruct prestera_span;\nstruct prestera_rxtx;\nstruct prestera_trap_data;\nstruct prestera_acl;\n\nstruct prestera_switch {\n\tstruct prestera_device *dev;\n\tstruct prestera_switchdev *swdev;\n\tstruct prestera_rxtx *rxtx;\n\tstruct prestera_acl *acl;\n\tstruct prestera_span *span;\n\tstruct list_head event_handlers;\n\tstruct notifier_block netdev_nb;\n\tstruct prestera_trap_data *trap_data;\n\tchar base_mac[ETH_ALEN];\n\tstruct list_head port_list;\n\trwlock_t port_list_lock;\n\tu32 port_count;\n\tu32 mtu_min;\n\tu32 mtu_max;\n\tu8 id;\n\tstruct device_node *np;\n\tstruct prestera_router *router;\n\tstruct prestera_lag *lags;\n\tstruct prestera_counter *counter;\n\tu8 lag_member_max;\n\tu8 lag_max;\n\tu32 size_tbl_router_nexthop;\n};\n\nstruct prestera_router {\n\tstruct prestera_switch *sw;\n\tstruct list_head vr_list;\n\tstruct list_head rif_entry_list;\n\tstruct rhashtable nh_neigh_ht;\n\tstruct rhashtable nexthop_group_ht;\n\tstruct rhashtable fib_ht;\n\tstruct rhashtable kern_neigh_cache_ht;\n\tstruct rhashtable kern_fib_cache_ht;\n\tstruct notifier_block inetaddr_nb;\n\tstruct notifier_block inetaddr_valid_nb;\n\tstruct notifier_block fib_nb;\n\tstruct notifier_block netevent_nb;\n\tu8 *nhgrp_hw_state_cache;  \n\tunsigned long nhgrp_hw_cache_kick;  \n\tstruct {\n\t\tstruct delayed_work dw;\n\t} neighs_update;\n};\n\nstruct prestera_rxtx_params {\n\tbool use_sdma;\n\tu32 map_addr;\n};\n\n#define prestera_dev(sw)\t\t((sw)->dev->dev)\n\nstatic inline void prestera_write(const struct prestera_switch *sw,\n\t\t\t\t  unsigned int reg, u32 val)\n{\n\twritel(val, sw->dev->pp_regs + reg);\n}\n\nstatic inline u32 prestera_read(const struct prestera_switch *sw,\n\t\t\t\tunsigned int reg)\n{\n\treturn readl(sw->dev->pp_regs + reg);\n}\n\nint prestera_device_register(struct prestera_device *dev);\nvoid prestera_device_unregister(struct prestera_device *dev);\n\nstruct prestera_port *prestera_port_find_by_hwid(struct prestera_switch *sw,\n\t\t\t\t\t\t u32 dev_id, u32 hw_id);\n\nint prestera_port_autoneg_set(struct prestera_port *port, u64 link_modes);\n\nint prestera_router_init(struct prestera_switch *sw);\nvoid prestera_router_fini(struct prestera_switch *sw);\n\nstruct prestera_port *prestera_find_port(struct prestera_switch *sw, u32 id);\n\nstruct prestera_switch *prestera_switch_get(struct net_device *dev);\n\nint prestera_port_cfg_mac_read(struct prestera_port *port,\n\t\t\t       struct prestera_port_mac_config *cfg);\n\nint prestera_port_cfg_mac_write(struct prestera_port *port,\n\t\t\t\tstruct prestera_port_mac_config *cfg);\n\nstruct prestera_port *prestera_port_dev_lower_find(struct net_device *dev);\n\nvoid prestera_queue_work(struct work_struct *work);\nvoid prestera_queue_delayed_work(struct delayed_work *work, unsigned long delay);\nvoid prestera_queue_drain(void);\n\nint prestera_port_learning_set(struct prestera_port *port, bool learn_enable);\nint prestera_port_uc_flood_set(struct prestera_port *port, bool flood);\nint prestera_port_mc_flood_set(struct prestera_port *port, bool flood);\n\nint prestera_port_br_locked_set(struct prestera_port *port, bool br_locked);\n\nint prestera_port_pvid_set(struct prestera_port *port, u16 vid);\n\nbool prestera_netdev_check(const struct net_device *dev);\n\nint prestera_is_valid_mac_addr(struct prestera_port *port, const u8 *addr);\n\nbool prestera_port_is_lag_member(const struct prestera_port *port);\nint prestera_lag_id(struct prestera_switch *sw,\n\t\t    struct net_device *lag_dev, u16 *lag_id);\n\nstruct prestera_lag *prestera_lag_by_id(struct prestera_switch *sw, u16 id);\n\nu16 prestera_port_lag_id(const struct prestera_port *port);\n\nstruct prestera_mdb_entry *\nprestera_mdb_entry_create(struct prestera_switch *sw,\n\t\t\t  const unsigned char *addr, u16 vid);\nvoid prestera_mdb_entry_destroy(struct prestera_mdb_entry *mdb_entry);\n\nstruct prestera_flood_domain *\nprestera_flood_domain_create(struct prestera_switch *sw);\nvoid prestera_flood_domain_destroy(struct prestera_flood_domain *flood_domain);\n\nint\nprestera_flood_domain_port_create(struct prestera_flood_domain *flood_domain,\n\t\t\t\t  struct net_device *dev,\n\t\t\t\t  u16 vid);\nvoid\nprestera_flood_domain_port_destroy(struct prestera_flood_domain_port *port);\nstruct prestera_flood_domain_port *\nprestera_flood_domain_port_find(struct prestera_flood_domain *flood_domain,\n\t\t\t\tstruct net_device *dev, u16 vid);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}