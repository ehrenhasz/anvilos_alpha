{
  "module_name": "prestera_acl.h",
  "hash_id": "96a809f721c808acef2607815f7e7b08abd0f001c85d149b0646cee937731807",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/marvell/prestera/prestera_acl.h",
  "human_readable_source": " \n \n\n#ifndef _PRESTERA_ACL_H_\n#define _PRESTERA_ACL_H_\n\n#include <linux/types.h>\n#include \"prestera_counter.h\"\n\n#define PRESTERA_ACL_KEYMASK_PCL_ID\t\t0x3FF\n#define PRESTERA_ACL_KEYMASK_PCL_ID_USER\t\t\t\\\n\t(PRESTERA_ACL_KEYMASK_PCL_ID & 0x00FF)\n#define PRESTERA_ACL_KEYMASK_PCL_ID_CHAIN\t\t\t\\\n\t(PRESTERA_ACL_KEYMASK_PCL_ID & 0xFF00)\n#define PRESTERA_ACL_CHAIN_MASK\t\t\t\t\t\\\n\t(PRESTERA_ACL_KEYMASK_PCL_ID >> 8)\n\n#define PRESTERA_ACL_PCL_ID_MAKE(uid, chain_id)\t\t\t\\\n\t(((uid) & PRESTERA_ACL_KEYMASK_PCL_ID_USER) |\t\t\\\n\t(((chain_id) << 8) & PRESTERA_ACL_KEYMASK_PCL_ID_CHAIN))\n\n#define rule_match_set_n(match_p, type, val_p, size)\t\t\\\n\tmemcpy(&(match_p)[PRESTERA_ACL_RULE_MATCH_TYPE_##type],\t\\\n\t       val_p, size)\n#define rule_match_set(match_p, type, val)\t\t\t\\\n\tmemcpy(&(match_p)[PRESTERA_ACL_RULE_MATCH_TYPE_##type],\t\\\n\t       &(val), sizeof(val))\n\nenum prestera_acl_match_type {\n\tPRESTERA_ACL_RULE_MATCH_TYPE_PCL_ID,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_ETH_TYPE,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_ETH_DMAC_0,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_ETH_DMAC_1,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_ETH_SMAC_0,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_ETH_SMAC_1,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_IP_PROTO,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_SYS_PORT,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_SYS_DEV,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_IP_SRC,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_IP_DST,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_L4_PORT_SRC,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_L4_PORT_DST,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_L4_PORT_RANGE_SRC,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_L4_PORT_RANGE_DST,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_VLAN_ID,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_VLAN_TPID,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_ICMP_TYPE,\n\tPRESTERA_ACL_RULE_MATCH_TYPE_ICMP_CODE,\n\n\t__PRESTERA_ACL_RULE_MATCH_TYPE_MAX\n};\n\nenum prestera_acl_rule_action {\n\tPRESTERA_ACL_RULE_ACTION_ACCEPT = 0,\n\tPRESTERA_ACL_RULE_ACTION_DROP = 1,\n\tPRESTERA_ACL_RULE_ACTION_TRAP = 2,\n\tPRESTERA_ACL_RULE_ACTION_JUMP = 5,\n\tPRESTERA_ACL_RULE_ACTION_COUNT = 7,\n\tPRESTERA_ACL_RULE_ACTION_POLICE = 8,\n\n\tPRESTERA_ACL_RULE_ACTION_MAX\n};\n\nenum {\n\tPRESTERA_ACL_IFACE_TYPE_PORT,\n\tPRESTERA_ACL_IFACE_TYPE_INDEX\n};\n\nstruct prestera_acl_match {\n\t__be32 key[__PRESTERA_ACL_RULE_MATCH_TYPE_MAX];\n\t__be32 mask[__PRESTERA_ACL_RULE_MATCH_TYPE_MAX];\n};\n\nstruct prestera_acl_action_jump {\n\tu32 index;\n};\n\nstruct prestera_acl_action_police {\n\tu32 id;\n};\n\nstruct prestera_acl_action_count {\n\tu32 id;\n};\n\nstruct prestera_acl_rule_entry_key {\n\tu32 prio;\n\tstruct prestera_acl_match match;\n};\n\nstruct prestera_acl_hw_action_info {\n\tenum prestera_acl_rule_action id;\n\tunion {\n\t\tstruct prestera_acl_action_police police;\n\t\tstruct prestera_acl_action_count count;\n\t\tstruct prestera_acl_action_jump jump;\n\t};\n};\n\n \nstruct prestera_acl_rule_entry_arg {\n\tu32 vtcam_id;\n\tstruct {\n\t\tstruct {\n\t\t\tu8 valid:1;\n\t\t} accept, drop, trap;\n\t\tstruct {\n\t\t\tstruct prestera_acl_action_jump i;\n\t\t\tu8 valid:1;\n\t\t} jump;\n\t\tstruct {\n\t\t\tu8 valid:1;\n\t\t\tu64 rate;\n\t\t\tu64 burst;\n\t\t\tbool ingress;\n\t\t} police;\n\t\tstruct {\n\t\t\tu8 valid:1;\n\t\t\tu32 client;\n\t\t} count;\n\t};\n};\n\nstruct prestera_acl_rule {\n\tstruct rhash_head ht_node;  \n\tstruct list_head list;\n\tstruct prestera_acl_ruleset *ruleset;\n\tstruct prestera_acl_ruleset *jump_ruleset;\n\tunsigned long cookie;\n\tu32 chain_index;\n\tu32 priority;\n\tstruct prestera_acl_rule_entry_key re_key;\n\tstruct prestera_acl_rule_entry_arg re_arg;\n\tstruct prestera_acl_rule_entry *re;\n};\n\nstruct prestera_acl_iface {\n\tunion {\n\t\tstruct prestera_port *port;\n\t\tu32 index;\n\t};\n\tu8 type;\n};\n\nstruct prestera_acl;\nstruct prestera_switch;\nstruct prestera_flow_block;\n\nint prestera_acl_init(struct prestera_switch *sw);\nvoid prestera_acl_fini(struct prestera_switch *sw);\n\nstruct prestera_acl_rule *\nprestera_acl_rule_create(struct prestera_acl_ruleset *ruleset,\n\t\t\t unsigned long cookie, u32 chain_index);\nvoid prestera_acl_rule_priority_set(struct prestera_acl_rule *rule,\n\t\t\t\t    u32 priority);\nvoid prestera_acl_rule_destroy(struct prestera_acl_rule *rule);\nstruct prestera_acl_rule *\nprestera_acl_rule_lookup(struct prestera_acl_ruleset *ruleset,\n\t\t\t unsigned long cookie);\nint prestera_acl_rule_add(struct prestera_switch *sw,\n\t\t\t  struct prestera_acl_rule *rule);\nvoid prestera_acl_rule_del(struct prestera_switch *sw,\n\t\t\t   struct prestera_acl_rule *rule);\nint prestera_acl_rule_get_stats(struct prestera_acl *acl,\n\t\t\t\tstruct prestera_acl_rule *rule,\n\t\t\t\tu64 *packets, u64 *bytes, u64 *last_use);\nstruct prestera_acl_rule_entry *\nprestera_acl_rule_entry_find(struct prestera_acl *acl,\n\t\t\t     struct prestera_acl_rule_entry_key *key);\nvoid prestera_acl_rule_entry_destroy(struct prestera_acl *acl,\n\t\t\t\t     struct prestera_acl_rule_entry *e);\nstruct prestera_acl_rule_entry *\nprestera_acl_rule_entry_create(struct prestera_acl *acl,\n\t\t\t       struct prestera_acl_rule_entry_key *key,\n\t\t\t       struct prestera_acl_rule_entry_arg *arg);\nstruct prestera_acl_ruleset *\nprestera_acl_ruleset_get(struct prestera_acl *acl,\n\t\t\t struct prestera_flow_block *block,\n\t\t\t u32 chain_index);\nstruct prestera_acl_ruleset *\nprestera_acl_ruleset_lookup(struct prestera_acl *acl,\n\t\t\t    struct prestera_flow_block *block,\n\t\t\t    u32 chain_index);\nint prestera_acl_ruleset_keymask_set(struct prestera_acl_ruleset *ruleset,\n\t\t\t\t     void *keymask);\nbool prestera_acl_ruleset_is_offload(struct prestera_acl_ruleset *ruleset);\nint prestera_acl_ruleset_offload(struct prestera_acl_ruleset *ruleset);\nvoid prestera_acl_ruleset_put(struct prestera_acl_ruleset *ruleset);\nint prestera_acl_ruleset_bind(struct prestera_acl_ruleset *ruleset,\n\t\t\t      struct prestera_port *port);\nint prestera_acl_ruleset_unbind(struct prestera_acl_ruleset *ruleset,\n\t\t\t\tstruct prestera_port *port);\nu32 prestera_acl_ruleset_index_get(const struct prestera_acl_ruleset *ruleset);\nvoid prestera_acl_ruleset_prio_get(struct prestera_acl_ruleset *ruleset,\n\t\t\t\t   u32 *prio_min, u32 *prio_max);\nvoid\nprestera_acl_rule_keymask_pcl_id_set(struct prestera_acl_rule *rule,\n\t\t\t\t     u16 pcl_id);\n\nint prestera_acl_vtcam_id_get(struct prestera_acl *acl, u8 lookup, u8 dir,\n\t\t\t      void *keymask, u32 *vtcam_id);\nint prestera_acl_vtcam_id_put(struct prestera_acl *acl, u32 vtcam_id);\nint prestera_acl_chain_to_client(u32 chain_index, bool ingress, u32 *client);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}