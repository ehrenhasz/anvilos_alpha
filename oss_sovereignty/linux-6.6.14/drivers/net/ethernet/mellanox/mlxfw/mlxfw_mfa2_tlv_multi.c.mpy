{
  "module_name": "mlxfw_mfa2_tlv_multi.c",
  "hash_id": "57fdac2839ea3f90f8baf78fe152130b6daf23f4c271d5bec284808dc7d577f7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxfw/mlxfw_mfa2_tlv_multi.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) \"MFA2: \" fmt\n\n#include \"mlxfw_mfa2_tlv_multi.h\"\n#include <uapi/linux/netlink.h>\n\n#define MLXFW_MFA2_TLV_TOTAL_SIZE(tlv) \\\n\tNLA_ALIGN(sizeof(*(tlv)) + be16_to_cpu((tlv)->len))\n\nconst struct mlxfw_mfa2_tlv *\nmlxfw_mfa2_tlv_multi_child(const struct mlxfw_mfa2_file *mfa2_file,\n\t\t\t   const struct mlxfw_mfa2_tlv_multi *multi)\n{\n\tsize_t multi_len;\n\n\tmulti_len = NLA_ALIGN(sizeof(struct mlxfw_mfa2_tlv_multi));\n\treturn mlxfw_mfa2_tlv_get(mfa2_file, (void *) multi + multi_len);\n}\n\nconst struct mlxfw_mfa2_tlv *\nmlxfw_mfa2_tlv_next(const struct mlxfw_mfa2_file *mfa2_file,\n\t\t    const struct mlxfw_mfa2_tlv *tlv)\n{\n\tconst struct mlxfw_mfa2_tlv_multi *multi;\n\tu16 tlv_len;\n\tvoid *next;\n\n\ttlv_len = MLXFW_MFA2_TLV_TOTAL_SIZE(tlv);\n\n\tif (tlv->type == MLXFW_MFA2_TLV_MULTI_PART) {\n\t\tmulti = mlxfw_mfa2_tlv_multi_get(mfa2_file, tlv);\n\t\tif (!multi)\n\t\t\treturn NULL;\n\t\ttlv_len = NLA_ALIGN(tlv_len + be16_to_cpu(multi->total_len));\n\t}\n\n\tnext = (void *) tlv + tlv_len;\n\treturn mlxfw_mfa2_tlv_get(mfa2_file, next);\n}\n\nconst struct mlxfw_mfa2_tlv *\nmlxfw_mfa2_tlv_advance(const struct mlxfw_mfa2_file *mfa2_file,\n\t\t       const struct mlxfw_mfa2_tlv *from_tlv, u16 count)\n{\n\tconst struct mlxfw_mfa2_tlv *tlv;\n\tu16 idx;\n\n\tmlxfw_mfa2_tlv_foreach(mfa2_file, tlv, idx, from_tlv, count)\n\t\tif (!tlv)\n\t\t\treturn NULL;\n\treturn tlv;\n}\n\nconst struct mlxfw_mfa2_tlv *\nmlxfw_mfa2_tlv_multi_child_find(const struct mlxfw_mfa2_file *mfa2_file,\n\t\t\t\tconst struct mlxfw_mfa2_tlv_multi *multi,\n\t\t\t\tenum mlxfw_mfa2_tlv_type type, u16 index)\n{\n\tconst struct mlxfw_mfa2_tlv *tlv;\n\tu16 skip = 0;\n\tu16 idx;\n\n\tmlxfw_mfa2_tlv_multi_foreach(mfa2_file, tlv, idx, multi) {\n\t\tif (!tlv) {\n\t\t\tpr_err(\"TLV parsing error\\n\");\n\t\t\treturn NULL;\n\t\t}\n\t\tif (tlv->type == type)\n\t\t\tif (skip++ == index)\n\t\t\t\treturn tlv;\n\t}\n\treturn NULL;\n}\n\nint mlxfw_mfa2_tlv_multi_child_count(const struct mlxfw_mfa2_file *mfa2_file,\n\t\t\t\t     const struct mlxfw_mfa2_tlv_multi *multi,\n\t\t\t\t     enum mlxfw_mfa2_tlv_type type,\n\t\t\t\t     u16 *p_count)\n{\n\tconst struct mlxfw_mfa2_tlv *tlv;\n\tu16 count = 0;\n\tu16 idx;\n\n\tmlxfw_mfa2_tlv_multi_foreach(mfa2_file, tlv, idx, multi) {\n\t\tif (!tlv) {\n\t\t\tpr_err(\"TLV parsing error\\n\");\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\tif (tlv->type == type)\n\t\t\tcount++;\n\t}\n\t*p_count = count;\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}