{
  "module_name": "fs.h",
  "hash_id": "74b7fd4a335d23ca7cc3db90dbb5d97945c8f4c228ee0729d6784f5967856414",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/en/fs.h",
  "human_readable_source": " \n \n\n#ifndef __MLX5E_FLOW_STEER_H__\n#define __MLX5E_FLOW_STEER_H__\n\n#include \"mod_hdr.h\"\n#include \"lib/fs_ttc.h\"\n\nstruct mlx5e_post_act;\nstruct mlx5e_tc_table;\n\nenum {\n\tMLX5E_TC_FT_LEVEL = 0,\n\tMLX5E_TC_TTC_FT_LEVEL,\n\tMLX5E_TC_MISS_LEVEL,\n};\n\nenum {\n\tMLX5E_TC_PRIO = 0,\n\tMLX5E_NIC_PRIO\n};\n\nstruct mlx5e_flow_table {\n\tint num_groups;\n\tstruct mlx5_flow_table *t;\n\tstruct mlx5_flow_group **g;\n};\n\nstruct mlx5e_l2_rule {\n\tu8  addr[ETH_ALEN + 2];\n\tstruct mlx5_flow_handle *rule;\n};\n\n#define MLX5E_L2_ADDR_HASH_SIZE BIT(BITS_PER_BYTE)\n\nstruct mlx5e_promisc_table {\n\tstruct mlx5e_flow_table\tft;\n\tstruct mlx5_flow_handle\t*rule;\n};\n\n \nstruct mlx5e_vlan_table;\nunsigned long *mlx5e_vlan_get_active_svlans(struct mlx5e_vlan_table *vlan);\nstruct mlx5_flow_table *mlx5e_vlan_get_flowtable(struct mlx5e_vlan_table *vlan);\n\nstruct mlx5e_l2_table {\n\tstruct mlx5e_flow_table    ft;\n\tstruct hlist_head          netdev_uc[MLX5E_L2_ADDR_HASH_SIZE];\n\tstruct hlist_head          netdev_mc[MLX5E_L2_ADDR_HASH_SIZE];\n\tstruct mlx5e_l2_rule\t   broadcast;\n\tstruct mlx5e_l2_rule\t   allmulti;\n\tstruct mlx5_flow_handle    *trap_rule;\n\tbool                       broadcast_enabled;\n\tbool                       allmulti_enabled;\n\tbool                       promisc_enabled;\n};\n\n#define MLX5E_NUM_INDIR_TIRS (MLX5_NUM_TT - 1)\n\n#define MLX5_HASH_IP\t\t(MLX5_HASH_FIELD_SEL_SRC_IP   |\\\n\t\t\t\t MLX5_HASH_FIELD_SEL_DST_IP)\n#define MLX5_HASH_IP_L4PORTS\t(MLX5_HASH_FIELD_SEL_SRC_IP   |\\\n\t\t\t\t MLX5_HASH_FIELD_SEL_DST_IP   |\\\n\t\t\t\t MLX5_HASH_FIELD_SEL_L4_SPORT |\\\n\t\t\t\t MLX5_HASH_FIELD_SEL_L4_DPORT)\n#define MLX5_HASH_IP_IPSEC_SPI\t(MLX5_HASH_FIELD_SEL_SRC_IP   |\\\n\t\t\t\t MLX5_HASH_FIELD_SEL_DST_IP   |\\\n\t\t\t\t MLX5_HASH_FIELD_SEL_IPSEC_SPI)\n\n \nenum {\n\tMLX5E_PROMISC_FT_LEVEL,\n\tMLX5E_VLAN_FT_LEVEL,\n\tMLX5E_L2_FT_LEVEL,\n\tMLX5E_TTC_FT_LEVEL,\n\tMLX5E_INNER_TTC_FT_LEVEL,\n\tMLX5E_FS_TT_UDP_FT_LEVEL = MLX5E_INNER_TTC_FT_LEVEL + 1,\n\tMLX5E_FS_TT_ANY_FT_LEVEL = MLX5E_INNER_TTC_FT_LEVEL + 1,\n#ifdef CONFIG_MLX5_EN_TLS\n\tMLX5E_ACCEL_FS_TCP_FT_LEVEL = MLX5E_INNER_TTC_FT_LEVEL + 1,\n#endif\n#ifdef CONFIG_MLX5_EN_ARFS\n\tMLX5E_ARFS_FT_LEVEL = MLX5E_INNER_TTC_FT_LEVEL + 1,\n#endif\n#ifdef CONFIG_MLX5_EN_IPSEC\n\tMLX5E_ACCEL_FS_POL_FT_LEVEL = MLX5E_INNER_TTC_FT_LEVEL + 1,\n\tMLX5E_ACCEL_FS_ESP_FT_LEVEL,\n\tMLX5E_ACCEL_FS_ESP_FT_ERR_LEVEL,\n\tMLX5E_ACCEL_FS_ESP_FT_ROCE_LEVEL,\n#endif\n};\n\nstruct mlx5e_flow_steering;\nstruct mlx5e_rx_res;\n\n#ifdef CONFIG_MLX5_EN_ARFS\nstruct mlx5e_arfs_tables;\n\nint mlx5e_arfs_create_tables(struct mlx5e_flow_steering *fs,\n\t\t\t     struct mlx5e_rx_res *rx_res, bool ntuple);\nvoid mlx5e_arfs_destroy_tables(struct mlx5e_flow_steering *fs, bool ntuple);\nint mlx5e_arfs_enable(struct mlx5e_flow_steering *fs);\nint mlx5e_arfs_disable(struct mlx5e_flow_steering *fs);\nint mlx5e_rx_flow_steer(struct net_device *dev, const struct sk_buff *skb,\n\t\t\tu16 rxq_index, u32 flow_id);\n#else\nstatic inline int mlx5e_arfs_create_tables(struct mlx5e_flow_steering *fs,\n\t\t\t\t\t   struct mlx5e_rx_res *rx_res, bool ntuple)\n{ return 0; }\nstatic inline void mlx5e_arfs_destroy_tables(struct mlx5e_flow_steering *fs, bool ntuple) {}\nstatic inline int mlx5e_arfs_enable(struct mlx5e_flow_steering *fs)\n{ return -EOPNOTSUPP; }\nstatic inline int mlx5e_arfs_disable(struct mlx5e_flow_steering *fs)\n{ return -EOPNOTSUPP; }\n#endif\n\n#ifdef CONFIG_MLX5_EN_TLS\nstruct mlx5e_accel_fs_tcp;\n#endif\n\nstruct mlx5e_profile;\nstruct mlx5e_fs_udp;\nstruct mlx5e_fs_any;\nstruct mlx5e_ptp_fs;\n\nvoid mlx5e_set_ttc_params(struct mlx5e_flow_steering *fs,\n\t\t\t  struct mlx5e_rx_res *rx_res,\n\t\t\t  struct ttc_params *ttc_params, bool tunnel);\n\nvoid mlx5e_destroy_ttc_table(struct mlx5e_flow_steering *fs);\nint mlx5e_create_ttc_table(struct mlx5e_flow_steering  *fs,\n\t\t\t   struct mlx5e_rx_res *rx_res);\n\nvoid mlx5e_destroy_flow_table(struct mlx5e_flow_table *ft);\n\nvoid mlx5e_enable_cvlan_filter(struct mlx5e_flow_steering *fs, bool promisc);\nvoid mlx5e_disable_cvlan_filter(struct mlx5e_flow_steering *fs, bool promisc);\n\nint mlx5e_create_flow_steering(struct mlx5e_flow_steering *fs,\n\t\t\t       struct mlx5e_rx_res *rx_res,\n\t\t\t       const struct mlx5e_profile *profile,\n\t\t\t       struct net_device *netdev);\nvoid mlx5e_destroy_flow_steering(struct mlx5e_flow_steering *fs, bool ntuple,\n\t\t\t\t const struct mlx5e_profile *profile);\n\nstruct mlx5e_flow_steering *mlx5e_fs_init(const struct mlx5e_profile *profile,\n\t\t\t\t\t  struct mlx5_core_dev *mdev,\n\t\t\t\t\t  bool state_destroy,\n\t\t\t\t\t  struct dentry *dfs_root);\nvoid mlx5e_fs_cleanup(struct mlx5e_flow_steering *fs);\nstruct mlx5e_vlan_table *mlx5e_fs_get_vlan(struct mlx5e_flow_steering *fs);\nvoid mlx5e_fs_set_tc(struct mlx5e_flow_steering *fs, struct mlx5e_tc_table *tc);\nstruct mlx5e_tc_table *mlx5e_fs_get_tc(struct mlx5e_flow_steering *fs);\nstruct mlx5e_l2_table *mlx5e_fs_get_l2(struct mlx5e_flow_steering *fs);\nstruct mlx5_flow_namespace *mlx5e_fs_get_ns(struct mlx5e_flow_steering *fs, bool egress);\nvoid mlx5e_fs_set_ns(struct mlx5e_flow_steering *fs, struct mlx5_flow_namespace *ns, bool egress);\n#ifdef CONFIG_MLX5_EN_RXNFC\nstruct mlx5e_ethtool_steering *mlx5e_fs_get_ethtool(struct mlx5e_flow_steering *fs);\n#endif\nstruct mlx5_ttc_table *mlx5e_fs_get_ttc(struct mlx5e_flow_steering *fs, bool inner);\nvoid mlx5e_fs_set_ttc(struct mlx5e_flow_steering *fs, struct mlx5_ttc_table *ttc, bool inner);\n#ifdef CONFIG_MLX5_EN_ARFS\nstruct mlx5e_arfs_tables *mlx5e_fs_get_arfs(struct mlx5e_flow_steering *fs);\nvoid mlx5e_fs_set_arfs(struct mlx5e_flow_steering *fs, struct mlx5e_arfs_tables *arfs);\n#endif\nstruct mlx5e_ptp_fs *mlx5e_fs_get_ptp(struct mlx5e_flow_steering *fs);\nvoid mlx5e_fs_set_ptp(struct mlx5e_flow_steering *fs, struct mlx5e_ptp_fs *ptp_fs);\nstruct mlx5e_fs_any *mlx5e_fs_get_any(struct mlx5e_flow_steering *fs);\nvoid mlx5e_fs_set_any(struct mlx5e_flow_steering *fs, struct mlx5e_fs_any *any);\nstruct mlx5e_fs_udp *mlx5e_fs_get_udp(struct mlx5e_flow_steering *fs);\nvoid mlx5e_fs_set_udp(struct mlx5e_flow_steering *fs, struct mlx5e_fs_udp *udp);\n#ifdef CONFIG_MLX5_EN_TLS\nstruct mlx5e_accel_fs_tcp *mlx5e_fs_get_accel_tcp(struct mlx5e_flow_steering *fs);\nvoid mlx5e_fs_set_accel_tcp(struct mlx5e_flow_steering *fs, struct mlx5e_accel_fs_tcp *accel_tcp);\n#endif\nvoid mlx5e_fs_set_state_destroy(struct mlx5e_flow_steering *fs, bool state_destroy);\nvoid mlx5e_fs_set_vlan_strip_disable(struct mlx5e_flow_steering *fs, bool vlan_strip_disable);\n\nstruct mlx5_core_dev *mlx5e_fs_get_mdev(struct mlx5e_flow_steering *fs);\nint mlx5e_add_vlan_trap(struct mlx5e_flow_steering *fs, int  trap_id, int tir_num);\nvoid mlx5e_remove_vlan_trap(struct mlx5e_flow_steering *fs);\nint mlx5e_add_mac_trap(struct mlx5e_flow_steering *fs, int  trap_id, int tir_num);\nvoid mlx5e_remove_mac_trap(struct mlx5e_flow_steering *fs);\nvoid mlx5e_fs_set_rx_mode_work(struct mlx5e_flow_steering *fs, struct net_device *netdev);\nint mlx5e_fs_vlan_rx_add_vid(struct mlx5e_flow_steering *fs,\n\t\t\t     struct net_device *netdev,\n\t\t\t     __be16 proto, u16 vid);\nint mlx5e_fs_vlan_rx_kill_vid(struct mlx5e_flow_steering *fs,\n\t\t\t      struct net_device *netdev,\n\t\t\t      __be16 proto, u16 vid);\nvoid mlx5e_fs_init_l2_addr(struct mlx5e_flow_steering *fs, struct net_device *netdev);\n\nstruct dentry *mlx5e_fs_get_debugfs_root(struct mlx5e_flow_steering *fs);\n\n#define fs_err(fs, fmt, ...) \\\n\tmlx5_core_err(mlx5e_fs_get_mdev(fs), fmt, ##__VA_ARGS__)\n\n#define fs_dbg(fs, fmt, ...) \\\n\tmlx5_core_dbg(mlx5e_fs_get_mdev(fs), fmt, ##__VA_ARGS__)\n\n#define fs_warn(fs, fmt, ...) \\\n\tmlx5_core_warn(mlx5e_fs_get_mdev(fs), fmt, ##__VA_ARGS__)\n\n#define fs_warn_once(fs, fmt, ...) \\\n\tmlx5_core_warn_once(mlx5e_fs_get_mdev(fs), fmt, ##__VA_ARGS__)\n\n#endif  \n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}