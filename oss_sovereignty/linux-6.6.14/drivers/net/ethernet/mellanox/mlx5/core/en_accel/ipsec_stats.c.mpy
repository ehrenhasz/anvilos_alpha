{
  "module_name": "ipsec_stats.c",
  "hash_id": "1b637516637fec0c0eb1dac4174a8b5ad9ceffe7606f2ee845dc38f3bd6b65fd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/en_accel/ipsec_stats.c",
  "human_readable_source": " \n\n#include <linux/ethtool.h>\n#include <net/sock.h>\n\n#include \"en.h\"\n#include \"ipsec.h\"\n\nstatic const struct counter_desc mlx5e_ipsec_hw_stats_desc[] = {\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_rx_pkts) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_rx_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_rx_drop_pkts) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_rx_drop_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_tx_pkts) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_tx_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_tx_drop_pkts) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_hw_stats, ipsec_tx_drop_bytes) },\n};\n\nstatic const struct counter_desc mlx5e_ipsec_sw_stats_desc[] = {\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_sw_stats, ipsec_rx_drop_sp_alloc) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_sw_stats, ipsec_rx_drop_sadb_miss) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_sw_stats, ipsec_rx_drop_syndrome) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_sw_stats, ipsec_tx_drop_bundle) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_sw_stats, ipsec_tx_drop_no_state) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_sw_stats, ipsec_tx_drop_not_ip) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_ipsec_sw_stats, ipsec_tx_drop_trailer) },\n};\n\n#define MLX5E_READ_CTR_ATOMIC64(ptr, dsc, i) \\\n\tatomic64_read((atomic64_t *)((char *)(ptr) + (dsc)[i].offset))\n\n#define NUM_IPSEC_HW_COUNTERS ARRAY_SIZE(mlx5e_ipsec_hw_stats_desc)\n#define NUM_IPSEC_SW_COUNTERS ARRAY_SIZE(mlx5e_ipsec_sw_stats_desc)\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(ipsec_hw)\n{\n\tif (!priv->ipsec)\n\t\treturn 0;\n\n\treturn NUM_IPSEC_HW_COUNTERS;\n}\n\nstatic inline MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(ipsec_hw) {}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(ipsec_hw)\n{\n\tunsigned int i;\n\n\tif (!priv->ipsec)\n\t\treturn idx;\n\n\tfor (i = 0; i < NUM_IPSEC_HW_COUNTERS; i++)\n\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t       mlx5e_ipsec_hw_stats_desc[i].format);\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(ipsec_hw)\n{\n\tint i;\n\n\tif (!priv->ipsec)\n\t\treturn idx;\n\n\tmlx5e_accel_ipsec_fs_read_stats(priv, &priv->ipsec->hw_stats);\n\tfor (i = 0; i < NUM_IPSEC_HW_COUNTERS; i++)\n\t\tdata[idx++] = MLX5E_READ_CTR_ATOMIC64(&priv->ipsec->hw_stats,\n\t\t\t\t\t\t      mlx5e_ipsec_hw_stats_desc, i);\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(ipsec_sw)\n{\n\treturn priv->ipsec ? NUM_IPSEC_SW_COUNTERS : 0;\n}\n\nstatic inline MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(ipsec_sw) {}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(ipsec_sw)\n{\n\tunsigned int i;\n\n\tif (priv->ipsec)\n\t\tfor (i = 0; i < NUM_IPSEC_SW_COUNTERS; i++)\n\t\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t       mlx5e_ipsec_sw_stats_desc[i].format);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(ipsec_sw)\n{\n\tint i;\n\n\tif (priv->ipsec)\n\t\tfor (i = 0; i < NUM_IPSEC_SW_COUNTERS; i++)\n\t\t\tdata[idx++] = MLX5E_READ_CTR_ATOMIC64(&priv->ipsec->sw_stats,\n\t\t\t\t\t\t\t      mlx5e_ipsec_sw_stats_desc, i);\n\treturn idx;\n}\n\nMLX5E_DEFINE_STATS_GRP(ipsec_hw, 0);\nMLX5E_DEFINE_STATS_GRP(ipsec_sw, 0);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}