{
  "module_name": "tc_priv.h",
  "hash_id": "1722bba5eb2b20a90ce380615c595951422ffda13095445b8992b9e884bcd656",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/en/tc_priv.h",
  "human_readable_source": " \n \n\n#ifndef __MLX5_EN_TC_PRIV_H__\n#define __MLX5_EN_TC_PRIV_H__\n\n#include \"en_tc.h\"\n#include \"en/tc/act/act.h\"\n\n#define MLX5E_TC_FLOW_BASE (MLX5E_TC_FLAG_LAST_EXPORTED_BIT + 1)\n\n#define MLX5E_TC_MAX_SPLITS 1\n\n\nenum {\n\tMLX5E_TC_FLOW_FLAG_INGRESS               = MLX5E_TC_FLAG_INGRESS_BIT,\n\tMLX5E_TC_FLOW_FLAG_EGRESS                = MLX5E_TC_FLAG_EGRESS_BIT,\n\tMLX5E_TC_FLOW_FLAG_ESWITCH               = MLX5E_TC_FLAG_ESW_OFFLOAD_BIT,\n\tMLX5E_TC_FLOW_FLAG_FT                    = MLX5E_TC_FLAG_FT_OFFLOAD_BIT,\n\tMLX5E_TC_FLOW_FLAG_NIC                   = MLX5E_TC_FLAG_NIC_OFFLOAD_BIT,\n\tMLX5E_TC_FLOW_FLAG_OFFLOADED             = MLX5E_TC_FLOW_BASE,\n\tMLX5E_TC_FLOW_FLAG_HAIRPIN               = MLX5E_TC_FLOW_BASE + 1,\n\tMLX5E_TC_FLOW_FLAG_HAIRPIN_RSS           = MLX5E_TC_FLOW_BASE + 2,\n\tMLX5E_TC_FLOW_FLAG_SLOW                  = MLX5E_TC_FLOW_BASE + 3,\n\tMLX5E_TC_FLOW_FLAG_DUP                   = MLX5E_TC_FLOW_BASE + 4,\n\tMLX5E_TC_FLOW_FLAG_NOT_READY             = MLX5E_TC_FLOW_BASE + 5,\n\tMLX5E_TC_FLOW_FLAG_DELETED               = MLX5E_TC_FLOW_BASE + 6,\n\tMLX5E_TC_FLOW_FLAG_L3_TO_L2_DECAP        = MLX5E_TC_FLOW_BASE + 7,\n\tMLX5E_TC_FLOW_FLAG_TUN_RX                = MLX5E_TC_FLOW_BASE + 8,\n\tMLX5E_TC_FLOW_FLAG_FAILED                = MLX5E_TC_FLOW_BASE + 9,\n\tMLX5E_TC_FLOW_FLAG_SAMPLE                = MLX5E_TC_FLOW_BASE + 10,\n\tMLX5E_TC_FLOW_FLAG_USE_ACT_STATS         = MLX5E_TC_FLOW_BASE + 11,\n};\n\nstruct mlx5e_tc_flow_parse_attr {\n\tconst struct ip_tunnel_info *tun_info[MLX5_MAX_FLOW_FWD_VPORTS];\n\tstruct mlx5e_mpls_info mpls_info[MLX5_MAX_FLOW_FWD_VPORTS];\n\tstruct net_device *filter_dev;\n\tstruct mlx5_flow_spec spec;\n\tstruct pedit_headers_action hdrs[__PEDIT_CMD_MAX];\n\tstruct mlx5e_tc_mod_hdr_acts mod_hdr_acts;\n\tint mirred_ifindex[MLX5_MAX_FLOW_FWD_VPORTS];\n\tstruct mlx5e_tc_act_parse_state parse_state;\n};\n\nstruct mlx5_fs_chains *mlx5e_nic_chains(struct mlx5e_tc_table *tc);\n\n \nstruct encap_flow_item {\n\tstruct mlx5e_encap_entry *e;  \n\tstruct list_head list;\n\tint index;\n};\n\nstruct encap_route_flow_item {\n\tstruct mlx5e_route_entry *r;  \n\tint index;\n};\n\nstruct mlx5e_tc_flow {\n\tstruct rhash_head node;\n\tstruct mlx5e_priv *priv;\n\tu64 cookie;\n\tunsigned long flags;\n\tstruct mlx5_flow_handle *rule[MLX5E_TC_MAX_SPLITS + 1];\n\n\t \n\tstruct list_head l3_to_l2_reformat;\n\tstruct mlx5e_decap_entry *decap_reformat;\n\n\t \n\tstruct list_head decap_routes;\n\tstruct mlx5e_route_entry *decap_route;\n\tstruct encap_route_flow_item encap_routes[MLX5_MAX_FLOW_FWD_VPORTS];\n\n\t \n\tstruct encap_flow_item encaps[MLX5_MAX_FLOW_FWD_VPORTS];\n\tstruct mlx5e_hairpin_entry *hpe;  \n\tstruct list_head hairpin;  \n\tstruct list_head peer[MLX5_MAX_PORTS];     \n\tstruct list_head unready;  \n\tstruct list_head peer_flows;  \n\tstruct net_device *orig_dev;  \n\tint tmp_entry_index;\n\tstruct list_head tmp_list;  \n\trefcount_t refcnt;\n\tstruct rcu_head rcu_head;\n\tstruct completion init_done;\n\tstruct completion del_hw_done;\n\tstruct mlx5_flow_attr *attr;\n\tstruct list_head attrs;\n\tu32 chain_mapping;\n};\n\nstruct mlx5_flow_handle *\nmlx5e_tc_rule_offload(struct mlx5e_priv *priv,\n\t\t      struct mlx5_flow_spec *spec,\n\t\t      struct mlx5_flow_attr *attr);\n\nvoid\nmlx5e_tc_rule_unoffload(struct mlx5e_priv *priv,\n\t\t\tstruct mlx5_flow_handle *rule,\n\t\t\tstruct mlx5_flow_attr *attr);\n\nu8 mlx5e_tc_get_ip_version(struct mlx5_flow_spec *spec, bool outer);\n\nstruct mlx5_flow_handle *\nmlx5e_tc_offload_fdb_rules(struct mlx5_eswitch *esw,\n\t\t\t   struct mlx5e_tc_flow *flow,\n\t\t\t   struct mlx5_flow_spec *spec,\n\t\t\t   struct mlx5_flow_attr *attr);\n\nstruct mlx5_flow_attr *\nmlx5e_tc_get_encap_attr(struct mlx5e_tc_flow *flow);\n\nvoid mlx5e_tc_unoffload_flow_post_acts(struct mlx5e_tc_flow *flow);\nint mlx5e_tc_offload_flow_post_acts(struct mlx5e_tc_flow *flow);\n\nbool mlx5e_is_eswitch_flow(struct mlx5e_tc_flow *flow);\nbool mlx5e_is_ft_flow(struct mlx5e_tc_flow *flow);\nbool mlx5e_is_offloaded_flow(struct mlx5e_tc_flow *flow);\nint mlx5e_get_flow_namespace(struct mlx5e_tc_flow *flow);\nbool mlx5e_same_hw_devs(struct mlx5e_priv *priv, struct mlx5e_priv *peer_priv);\n\nstatic inline void __flow_flag_set(struct mlx5e_tc_flow *flow, unsigned long flag)\n{\n\t \n\tsmp_mb__before_atomic();\n\tset_bit(flag, &flow->flags);\n}\n\n#define flow_flag_set(flow, flag) __flow_flag_set(flow, MLX5E_TC_FLOW_FLAG_##flag)\n\nstatic inline bool __flow_flag_test_and_set(struct mlx5e_tc_flow *flow,\n\t\t\t\t\t    unsigned long flag)\n{\n\t \n\treturn test_and_set_bit(flag, &flow->flags);\n}\n\n#define flow_flag_test_and_set(flow, flag)\t\t\t\\\n\t__flow_flag_test_and_set(flow,\t\t\t\t\\\n\t\t\t\t MLX5E_TC_FLOW_FLAG_##flag)\n\nstatic inline void __flow_flag_clear(struct mlx5e_tc_flow *flow, unsigned long flag)\n{\n\t \n\tsmp_mb__before_atomic();\n\tclear_bit(flag, &flow->flags);\n}\n\n#define flow_flag_clear(flow, flag) __flow_flag_clear(flow,\t\t\\\n\t\t\t\t\t\t      MLX5E_TC_FLOW_FLAG_##flag)\n\nstatic inline bool __flow_flag_test(struct mlx5e_tc_flow *flow, unsigned long flag)\n{\n\tbool ret = test_bit(flag, &flow->flags);\n\n\t \n\tsmp_mb__after_atomic();\n\treturn ret;\n}\n\n#define flow_flag_test(flow, flag) __flow_flag_test(flow,\t\t\\\n\t\t\t\t\t\t    MLX5E_TC_FLOW_FLAG_##flag)\n\nvoid mlx5e_tc_unoffload_from_slow_path(struct mlx5_eswitch *esw,\n\t\t\t\t       struct mlx5e_tc_flow *flow);\nstruct mlx5_flow_handle *\nmlx5e_tc_offload_to_slow_path(struct mlx5_eswitch *esw,\n\t\t\t      struct mlx5e_tc_flow *flow,\n\t\t\t      struct mlx5_flow_spec *spec);\n\nvoid mlx5e_tc_unoffload_fdb_rules(struct mlx5_eswitch *esw,\n\t\t\t\t  struct mlx5e_tc_flow *flow,\n\t\t\t\t  struct mlx5_flow_attr *attr);\n\nstruct mlx5e_tc_flow *mlx5e_flow_get(struct mlx5e_tc_flow *flow);\nvoid mlx5e_flow_put(struct mlx5e_priv *priv, struct mlx5e_tc_flow *flow);\n\nstruct mlx5_fc *mlx5e_tc_get_counter(struct mlx5e_tc_flow *flow);\n\nstruct mlx5e_tc_int_port_priv *\nmlx5e_get_int_port_priv(struct mlx5e_priv *priv);\n\nstruct mlx5e_flow_meters *mlx5e_get_flow_meters(struct mlx5_core_dev *dev);\n\nvoid *mlx5e_get_match_headers_value(u32 flags, struct mlx5_flow_spec *spec);\nvoid *mlx5e_get_match_headers_criteria(u32 flags, struct mlx5_flow_spec *spec);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}