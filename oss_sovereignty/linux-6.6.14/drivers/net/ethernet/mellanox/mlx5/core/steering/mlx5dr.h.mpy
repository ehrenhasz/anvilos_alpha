{
  "module_name": "mlx5dr.h",
  "hash_id": "b462c270b947683a111ccf7381731f36e750b481691e97c7421961e7a31131e3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/steering/mlx5dr.h",
  "human_readable_source": " \n \n\n#ifndef _MLX5DR_H_\n#define _MLX5DR_H_\n\nstruct mlx5dr_domain;\nstruct mlx5dr_table;\nstruct mlx5dr_matcher;\nstruct mlx5dr_rule;\nstruct mlx5dr_action;\n\nenum mlx5dr_domain_type {\n\tMLX5DR_DOMAIN_TYPE_NIC_RX,\n\tMLX5DR_DOMAIN_TYPE_NIC_TX,\n\tMLX5DR_DOMAIN_TYPE_FDB,\n};\n\nenum mlx5dr_domain_sync_flags {\n\tMLX5DR_DOMAIN_SYNC_FLAGS_SW = 1 << 0,\n\tMLX5DR_DOMAIN_SYNC_FLAGS_HW = 1 << 1,\n};\n\nenum mlx5dr_action_reformat_type {\n\tDR_ACTION_REFORMAT_TYP_TNL_L2_TO_L2,\n\tDR_ACTION_REFORMAT_TYP_L2_TO_TNL_L2,\n\tDR_ACTION_REFORMAT_TYP_TNL_L3_TO_L2,\n\tDR_ACTION_REFORMAT_TYP_L2_TO_TNL_L3,\n\tDR_ACTION_REFORMAT_TYP_INSERT_HDR,\n\tDR_ACTION_REFORMAT_TYP_REMOVE_HDR,\n};\n\nstruct mlx5dr_match_parameters {\n\tsize_t match_sz;\n\tu64 *match_buf;  \n};\n\nstruct mlx5dr_action_dest {\n\tstruct mlx5dr_action *dest;\n\tstruct mlx5dr_action *reformat;\n};\n\nstruct mlx5dr_domain *\nmlx5dr_domain_create(struct mlx5_core_dev *mdev, enum mlx5dr_domain_type type);\n\nint mlx5dr_domain_destroy(struct mlx5dr_domain *domain);\n\nint mlx5dr_domain_sync(struct mlx5dr_domain *domain, u32 flags);\n\nvoid mlx5dr_domain_set_peer(struct mlx5dr_domain *dmn,\n\t\t\t    struct mlx5dr_domain *peer_dmn,\n\t\t\t    u16 peer_vhca_id);\n\nstruct mlx5dr_table *\nmlx5dr_table_create(struct mlx5dr_domain *domain, u32 level, u32 flags,\n\t\t    u16 uid);\n\nstruct mlx5dr_table *\nmlx5dr_table_get_from_fs_ft(struct mlx5_flow_table *ft);\n\nint mlx5dr_table_destroy(struct mlx5dr_table *table);\n\nu32 mlx5dr_table_get_id(struct mlx5dr_table *table);\n\nstruct mlx5dr_matcher *\nmlx5dr_matcher_create(struct mlx5dr_table *table,\n\t\t      u32 priority,\n\t\t      u8 match_criteria_enable,\n\t\t      struct mlx5dr_match_parameters *mask);\n\nint mlx5dr_matcher_destroy(struct mlx5dr_matcher *matcher);\n\nstruct mlx5dr_rule *\nmlx5dr_rule_create(struct mlx5dr_matcher *matcher,\n\t\t   struct mlx5dr_match_parameters *value,\n\t\t   size_t num_actions,\n\t\t   struct mlx5dr_action *actions[],\n\t\t   u32 flow_source);\n\nint mlx5dr_rule_destroy(struct mlx5dr_rule *rule);\n\nint mlx5dr_table_set_miss_action(struct mlx5dr_table *tbl,\n\t\t\t\t struct mlx5dr_action *action);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_dest_table_num(struct mlx5dr_domain *dmn, u32 table_num);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_dest_table(struct mlx5dr_table *table);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_dest_flow_fw_table(struct mlx5dr_domain *domain,\n\t\t\t\t\tstruct mlx5_flow_table *ft);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_dest_vport(struct mlx5dr_domain *domain,\n\t\t\t\tu16 vport, u8 vhca_id_valid,\n\t\t\t\tu16 vhca_id);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_mult_dest_tbl(struct mlx5dr_domain *dmn,\n\t\t\t\t   struct mlx5dr_action_dest *dests,\n\t\t\t\t   u32 num_of_dests,\n\t\t\t\t   bool ignore_flow_level,\n\t\t\t\t   u32 flow_source);\n\nstruct mlx5dr_action *mlx5dr_action_create_drop(void);\n\nstruct mlx5dr_action *mlx5dr_action_create_tag(u32 tag_value);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_flow_sampler(struct mlx5dr_domain *dmn, u32 sampler_id);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_flow_counter(u32 counter_id);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_packet_reformat(struct mlx5dr_domain *dmn,\n\t\t\t\t     enum mlx5dr_action_reformat_type reformat_type,\n\t\t\t\t     u8 reformat_param_0,\n\t\t\t\t     u8 reformat_param_1,\n\t\t\t\t     size_t data_sz,\n\t\t\t\t     void *data);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_modify_header(struct mlx5dr_domain *domain,\n\t\t\t\t   u32 flags,\n\t\t\t\t   size_t actions_sz,\n\t\t\t\t   __be64 actions[]);\n\nstruct mlx5dr_action *mlx5dr_action_create_pop_vlan(void);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_push_vlan(struct mlx5dr_domain *domain, __be32 vlan_hdr);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_aso(struct mlx5dr_domain *dmn,\n\t\t\t u32 obj_id,\n\t\t\t u8 return_reg_id,\n\t\t\t u8 aso_type,\n\t\t\t u8 init_color,\n\t\t\t u8 meter_id);\n\nstruct mlx5dr_action *\nmlx5dr_action_create_dest_match_range(struct mlx5dr_domain *dmn,\n\t\t\t\t      u32 field,\n\t\t\t\t      struct mlx5_flow_table *hit_ft,\n\t\t\t\t      struct mlx5_flow_table *miss_ft,\n\t\t\t\t      u32 min,\n\t\t\t\t      u32 max);\n\nint mlx5dr_action_destroy(struct mlx5dr_action *action);\n\nu32 mlx5dr_action_get_pkt_reformat_id(struct mlx5dr_action *action);\n\nint mlx5dr_definer_get(struct mlx5dr_domain *dmn, u16 format_id,\n\t\t       u8 *dw_selectors, u8 *byte_selectors,\n\t\t       u8 *match_mask, u32 *definer_id);\nvoid mlx5dr_definer_put(struct mlx5dr_domain *dmn, u32 definer_id);\n\nstatic inline bool\nmlx5dr_is_supported(struct mlx5_core_dev *dev)\n{\n\treturn MLX5_CAP_GEN(dev, roce) &&\n\t       (MLX5_CAP_ESW_FLOWTABLE_FDB(dev, sw_owner) ||\n\t\t(MLX5_CAP_ESW_FLOWTABLE_FDB(dev, sw_owner_v2) &&\n\t\t (MLX5_CAP_GEN(dev, steering_format_version) <=\n\t\t  MLX5_STEERING_FORMAT_CONNECTX_7)));\n}\n\n \n\nstruct mlx5dr_icm_mr;\n\nstruct mlx5dr_icm_buddy_mem {\n\tunsigned long\t\t**bitmap;\n\tunsigned int\t\t*num_free;\n\tu32\t\t\tmax_order;\n\tstruct list_head\tlist_node;\n\tstruct mlx5dr_icm_mr\t*icm_mr;\n\tstruct mlx5dr_icm_pool\t*pool;\n\n\t \n\tu64\t\t\tused_memory;\n\n\t \n\tstruct mlx5dr_ste\t*ste_arr;\n\tstruct list_head\t*miss_list;\n\tu8\t\t\t*hw_ste_arr;\n};\n\nint mlx5dr_buddy_init(struct mlx5dr_icm_buddy_mem *buddy,\n\t\t      unsigned int max_order);\nvoid mlx5dr_buddy_cleanup(struct mlx5dr_icm_buddy_mem *buddy);\nint mlx5dr_buddy_alloc_mem(struct mlx5dr_icm_buddy_mem *buddy,\n\t\t\t   unsigned int order,\n\t\t\t   unsigned int *segment);\nvoid mlx5dr_buddy_free_mem(struct mlx5dr_icm_buddy_mem *buddy,\n\t\t\t   unsigned int seg, unsigned int order);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}