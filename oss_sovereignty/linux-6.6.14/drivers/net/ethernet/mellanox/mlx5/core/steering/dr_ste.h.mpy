{
  "module_name": "dr_ste.h",
  "hash_id": "87e04b738fc1a051ab79c3875d6bb6d922521c89f3fd4c4e3e50307083371622",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/steering/dr_ste.h",
  "human_readable_source": " \n \n\n#ifndef\t_DR_STE_\n#define\t_DR_STE_\n\n#include \"dr_types.h\"\n\n#define STE_IPV4 0x1\n#define STE_IPV6 0x2\n#define STE_TCP 0x1\n#define STE_UDP 0x2\n#define STE_SPI 0x3\n#define IP_VERSION_IPV4 0x4\n#define IP_VERSION_IPV6 0x6\n#define STE_SVLAN 0x1\n#define STE_CVLAN 0x2\n#define HDR_LEN_L2_MACS   0xC\n#define HDR_LEN_L2_VLAN   0x4\n#define HDR_LEN_L2_ETHER  0x2\n#define HDR_LEN_L2        (HDR_LEN_L2_MACS + HDR_LEN_L2_ETHER)\n#define HDR_LEN_L2_W_VLAN (HDR_LEN_L2 + HDR_LEN_L2_VLAN)\n\n \n#define DR_STE_SET_VAL(lookup_type, tag, t_fname, spec, s_fname, value) do { \\\n\tif ((spec)->s_fname) { \\\n\t\tMLX5_SET(ste_##lookup_type, tag, t_fname, value); \\\n\t\t(spec)->s_fname = 0; \\\n\t} \\\n} while (0)\n\n \n#define DR_STE_SET_TAG(lookup_type, tag, t_fname, spec, s_fname) \\\n\tDR_STE_SET_VAL(lookup_type, tag, t_fname, spec, s_fname, spec->s_fname)\n\n \n#define DR_STE_SET_ONES(lookup_type, tag, t_fname, spec, s_fname) \\\n\tDR_STE_SET_VAL(lookup_type, tag, t_fname, spec, s_fname, -1)\n\n#define DR_STE_SET_TCP_FLAGS(lookup_type, tag, spec) do { \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_ns, !!((spec)->tcp_flags & (1 << 8))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_cwr, !!((spec)->tcp_flags & (1 << 7))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_ece, !!((spec)->tcp_flags & (1 << 6))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_urg, !!((spec)->tcp_flags & (1 << 5))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_ack, !!((spec)->tcp_flags & (1 << 4))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_psh, !!((spec)->tcp_flags & (1 << 3))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_rst, !!((spec)->tcp_flags & (1 << 2))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_syn, !!((spec)->tcp_flags & (1 << 1))); \\\n\tMLX5_SET(ste_##lookup_type, tag, tcp_fin, !!((spec)->tcp_flags & (1 << 0))); \\\n} while (0)\n\n#define DR_STE_SET_MPLS(lookup_type, mask, in_out, tag) do { \\\n\tstruct mlx5dr_match_misc2 *_mask = mask; \\\n\tu8 *_tag = tag; \\\n\tDR_STE_SET_TAG(lookup_type, _tag, mpls0_label, _mask, \\\n\t\t       in_out##_first_mpls_label);\\\n\tDR_STE_SET_TAG(lookup_type, _tag, mpls0_s_bos, _mask, \\\n\t\t       in_out##_first_mpls_s_bos); \\\n\tDR_STE_SET_TAG(lookup_type, _tag, mpls0_exp, _mask, \\\n\t\t       in_out##_first_mpls_exp); \\\n\tDR_STE_SET_TAG(lookup_type, _tag, mpls0_ttl, _mask, \\\n\t\t       in_out##_first_mpls_ttl); \\\n} while (0)\n\n#define DR_STE_SET_FLEX_PARSER_FIELD(tag, fname, caps, spec) do { \\\n\tu8 parser_id = (caps)->flex_parser_id_##fname; \\\n\tu8 *parser_ptr = dr_ste_calc_flex_parser_offset(tag, parser_id); \\\n\t*(__be32 *)parser_ptr = cpu_to_be32((spec)->fname);\\\n\t(spec)->fname = 0;\\\n} while (0)\n\n#define DR_STE_IS_OUTER_MPLS_OVER_GRE_SET(_misc) (\\\n\t(_misc)->outer_first_mpls_over_gre_label || \\\n\t(_misc)->outer_first_mpls_over_gre_exp || \\\n\t(_misc)->outer_first_mpls_over_gre_s_bos || \\\n\t(_misc)->outer_first_mpls_over_gre_ttl)\n\n#define DR_STE_IS_OUTER_MPLS_OVER_UDP_SET(_misc) (\\\n\t(_misc)->outer_first_mpls_over_udp_label || \\\n\t(_misc)->outer_first_mpls_over_udp_exp || \\\n\t(_misc)->outer_first_mpls_over_udp_s_bos || \\\n\t(_misc)->outer_first_mpls_over_udp_ttl)\n\nenum dr_ste_action_modify_type_l3 {\n\tDR_STE_ACTION_MDFY_TYPE_L3_NONE\t= 0x0,\n\tDR_STE_ACTION_MDFY_TYPE_L3_IPV4\t= 0x1,\n\tDR_STE_ACTION_MDFY_TYPE_L3_IPV6\t= 0x2,\n};\n\nenum dr_ste_action_modify_type_l4 {\n\tDR_STE_ACTION_MDFY_TYPE_L4_NONE\t= 0x0,\n\tDR_STE_ACTION_MDFY_TYPE_L4_TCP\t= 0x1,\n\tDR_STE_ACTION_MDFY_TYPE_L4_UDP\t= 0x2,\n};\n\nenum {\n\tHDR_MPLS_OFFSET_LABEL\t= 12,\n\tHDR_MPLS_OFFSET_EXP\t= 9,\n\tHDR_MPLS_OFFSET_S_BOS\t= 8,\n\tHDR_MPLS_OFFSET_TTL\t= 0,\n};\n\nu16 mlx5dr_ste_conv_bit_to_byte_mask(u8 *bit_mask);\n\nstatic inline u8 *\ndr_ste_calc_flex_parser_offset(u8 *tag, u8 parser_id)\n{\n\t \n\treturn tag + 4 * (3 - (parser_id % 4));\n}\n\n#define DR_STE_CTX_BUILDER(fname) \\\n\t((*build_##fname##_init)(struct mlx5dr_ste_build *sb, \\\n\t\t\t\t struct mlx5dr_match_param *mask))\n\nstruct mlx5dr_ste_ctx {\n\t \n\tvoid DR_STE_CTX_BUILDER(eth_l2_src_dst);\n\tvoid DR_STE_CTX_BUILDER(eth_l3_ipv6_src);\n\tvoid DR_STE_CTX_BUILDER(eth_l3_ipv6_dst);\n\tvoid DR_STE_CTX_BUILDER(eth_l3_ipv4_5_tuple);\n\tvoid DR_STE_CTX_BUILDER(eth_l2_src);\n\tvoid DR_STE_CTX_BUILDER(eth_l2_dst);\n\tvoid DR_STE_CTX_BUILDER(eth_l2_tnl);\n\tvoid DR_STE_CTX_BUILDER(eth_l3_ipv4_misc);\n\tvoid DR_STE_CTX_BUILDER(eth_ipv6_l3_l4);\n\tvoid DR_STE_CTX_BUILDER(mpls);\n\tvoid DR_STE_CTX_BUILDER(tnl_gre);\n\tvoid DR_STE_CTX_BUILDER(tnl_mpls);\n\tvoid DR_STE_CTX_BUILDER(tnl_mpls_over_gre);\n\tvoid DR_STE_CTX_BUILDER(tnl_mpls_over_udp);\n\tvoid DR_STE_CTX_BUILDER(icmp);\n\tvoid DR_STE_CTX_BUILDER(general_purpose);\n\tvoid DR_STE_CTX_BUILDER(eth_l4_misc);\n\tvoid DR_STE_CTX_BUILDER(tnl_vxlan_gpe);\n\tvoid DR_STE_CTX_BUILDER(tnl_geneve);\n\tvoid DR_STE_CTX_BUILDER(tnl_geneve_tlv_opt);\n\tvoid DR_STE_CTX_BUILDER(tnl_geneve_tlv_opt_exist);\n\tvoid DR_STE_CTX_BUILDER(register_0);\n\tvoid DR_STE_CTX_BUILDER(register_1);\n\tvoid DR_STE_CTX_BUILDER(src_gvmi_qpn);\n\tvoid DR_STE_CTX_BUILDER(flex_parser_0);\n\tvoid DR_STE_CTX_BUILDER(flex_parser_1);\n\tvoid DR_STE_CTX_BUILDER(tnl_gtpu);\n\tvoid DR_STE_CTX_BUILDER(tnl_header_0_1);\n\tvoid DR_STE_CTX_BUILDER(tnl_gtpu_flex_parser_0);\n\tvoid DR_STE_CTX_BUILDER(tnl_gtpu_flex_parser_1);\n\n\t \n\tvoid (*ste_init)(u8 *hw_ste_p, u16 lu_type,\n\t\t\t bool is_rx, u16 gvmi);\n\tvoid (*set_next_lu_type)(u8 *hw_ste_p, u16 lu_type);\n\tu16  (*get_next_lu_type)(u8 *hw_ste_p);\n\tbool (*is_miss_addr_set)(u8 *hw_ste_p);\n\tvoid (*set_miss_addr)(u8 *hw_ste_p, u64 miss_addr);\n\tu64  (*get_miss_addr)(u8 *hw_ste_p);\n\tvoid (*set_hit_addr)(u8 *hw_ste_p, u64 icm_addr, u32 ht_size);\n\tvoid (*set_byte_mask)(u8 *hw_ste_p, u16 byte_mask);\n\tu16  (*get_byte_mask)(u8 *hw_ste_p);\n\n\t \n\tu32 actions_caps;\n\tvoid (*set_actions_rx)(struct mlx5dr_domain *dmn,\n\t\t\t       u8 *action_type_set,\n\t\t\t       u32 actions_caps,\n\t\t\t       u8 *hw_ste_arr,\n\t\t\t       struct mlx5dr_ste_actions_attr *attr,\n\t\t\t       u32 *added_stes);\n\tvoid (*set_actions_tx)(struct mlx5dr_domain *dmn,\n\t\t\t       u8 *action_type_set,\n\t\t\t       u32 actions_caps,\n\t\t\t       u8 *hw_ste_arr,\n\t\t\t       struct mlx5dr_ste_actions_attr *attr,\n\t\t\t       u32 *added_stes);\n\tu32 modify_field_arr_sz;\n\tconst struct mlx5dr_ste_action_modify_field *modify_field_arr;\n\tvoid (*set_action_set)(u8 *hw_action,\n\t\t\t       u8 hw_field,\n\t\t\t       u8 shifter,\n\t\t\t       u8 length,\n\t\t\t       u32 data);\n\tvoid (*set_action_add)(u8 *hw_action,\n\t\t\t       u8 hw_field,\n\t\t\t       u8 shifter,\n\t\t\t       u8 length,\n\t\t\t       u32 data);\n\tvoid (*set_action_copy)(u8 *hw_action,\n\t\t\t\tu8 dst_hw_field,\n\t\t\t\tu8 dst_shifter,\n\t\t\t\tu8 dst_len,\n\t\t\t\tu8 src_hw_field,\n\t\t\t\tu8 src_shifter);\n\tint (*set_action_decap_l3_list)(void *data,\n\t\t\t\t\tu32 data_sz,\n\t\t\t\t\tu8 *hw_action,\n\t\t\t\t\tu32 hw_action_sz,\n\t\t\t\t\tu16 *used_hw_action_num);\n\tint (*alloc_modify_hdr_chunk)(struct mlx5dr_action *action);\n\tvoid (*dealloc_modify_hdr_chunk)(struct mlx5dr_action *action);\n\n\t \n\tvoid (*prepare_for_postsend)(u8 *hw_ste_p, u32 ste_size);\n};\n\nstruct mlx5dr_ste_ctx *mlx5dr_ste_get_ctx_v0(void);\nstruct mlx5dr_ste_ctx *mlx5dr_ste_get_ctx_v1(void);\nstruct mlx5dr_ste_ctx *mlx5dr_ste_get_ctx_v2(void);\n\n#endif   \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}