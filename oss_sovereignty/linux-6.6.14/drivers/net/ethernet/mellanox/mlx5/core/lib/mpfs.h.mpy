{
  "module_name": "mpfs.h",
  "hash_id": "3b7e6ea97cd8e2d909c9f2078519dce58bf78ad310f391c807e7324544d3ad68",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/lib/mpfs.h",
  "human_readable_source": " \n\n#ifndef __MLX5_MPFS_H__\n#define __MLX5_MPFS_H__\n\n#include <linux/if_ether.h>\n#include <linux/mlx5/device.h>\n\n \n#define MLX5_L2_ADDR_HASH_SIZE (BIT(BITS_PER_BYTE))\n#define MLX5_L2_ADDR_HASH(addr) (addr[5])\n\nstruct l2addr_node {\n\tstruct hlist_node hlist;\n\tu8                addr[ETH_ALEN];\n};\n\n#define for_each_l2hash_node(hn, tmp, hash, i) \\\n\tfor (i = 0; i < MLX5_L2_ADDR_HASH_SIZE; i++) \\\n\t\thlist_for_each_entry_safe(hn, tmp, &(hash)[i], hlist)\n\n#define l2addr_hash_find(hash, mac, type) ({                \\\n\tint ix = MLX5_L2_ADDR_HASH(mac);                    \\\n\tbool found = false;                                 \\\n\ttype *ptr = NULL;                                   \\\n\t\t\t\t\t\t\t    \\\n\thlist_for_each_entry(ptr, &(hash)[ix], node.hlist)  \\\n\t\tif (ether_addr_equal(ptr->node.addr, mac)) {\\\n\t\t\tfound = true;                       \\\n\t\t\tbreak;                              \\\n\t\t}                                           \\\n\tif (!found)                                         \\\n\t\tptr = NULL;                                 \\\n\tptr;                                                \\\n})\n\n#define l2addr_hash_add(hash, mac, type, gfp) ({            \\\n\tint ix = MLX5_L2_ADDR_HASH(mac);                    \\\n\ttype *ptr = NULL;                                   \\\n\t\t\t\t\t\t\t    \\\n\tptr = kzalloc(sizeof(type), gfp);                   \\\n\tif (ptr) {                                          \\\n\t\tether_addr_copy(ptr->node.addr, mac);       \\\n\t\thlist_add_head(&ptr->node.hlist, &(hash)[ix]);\\\n\t}                                                   \\\n\tptr;                                                \\\n})\n\n#define l2addr_hash_del(ptr) ({                             \\\n\thlist_del(&(ptr)->node.hlist);                      \\\n\tkfree(ptr);                                         \\\n})\n\n#ifdef CONFIG_MLX5_MPFS\nint  mlx5_mpfs_init(struct mlx5_core_dev *dev);\nvoid mlx5_mpfs_cleanup(struct mlx5_core_dev *dev);\n#else  \nstatic inline int  mlx5_mpfs_init(struct mlx5_core_dev *dev) { return 0; }\nstatic inline void mlx5_mpfs_cleanup(struct mlx5_core_dev *dev) {}\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}