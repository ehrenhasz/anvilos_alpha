{
  "module_name": "bridge_priv.h",
  "hash_id": "1602f7b06fce1ba31910b863daa0a607e2d37a5b7e1834989b5011dbc7e9f324",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/esw/bridge_priv.h",
  "human_readable_source": " \n \n\n#ifndef _MLX5_ESW_BRIDGE_PRIVATE_\n#define _MLX5_ESW_BRIDGE_PRIVATE_\n\n#include <linux/netdevice.h>\n#include <linux/if_bridge.h>\n#include <linux/if_vlan.h>\n#include <linux/if_ether.h>\n#include <linux/rhashtable.h>\n#include <linux/xarray.h>\n#include \"fs_core.h\"\n\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_IGMP_GRP_SIZE 1\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_MLD_GRP_SIZE 3\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_SIZE 131072\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_UNTAGGED_GRP_SIZE\t\t\t\\\n\t(524288 - MLX5_ESW_BRIDGE_INGRESS_TABLE_IGMP_GRP_SIZE -\t\t\\\n\t MLX5_ESW_BRIDGE_INGRESS_TABLE_MLD_GRP_SIZE)\n\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_IGMP_GRP_IDX_FROM 0\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_IGMP_GRP_IDX_TO\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_IGMP_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_MLD_GRP_IDX_FROM\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_IGMP_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_MLD_GRP_IDX_TO\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_MLD_GRP_IDX_FROM +\t\\\n\t MLX5_ESW_BRIDGE_INGRESS_TABLE_MLD_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_IDX_FROM\t\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_MLD_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_IDX_FROM +\t\t\\\n\t MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_FILTER_GRP_IDX_FROM\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_FILTER_GRP_IDX_TO\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_FILTER_GRP_IDX_FROM +\t\\\n\t MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_GRP_IDX_FROM\t\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_FILTER_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_GRP_IDX_FROM +\t\t\\\n\t MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_FILTER_GRP_IDX_FROM\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_FILTER_GRP_IDX_TO\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_FILTER_GRP_IDX_FROM +\t\\\n\t MLX5_ESW_BRIDGE_INGRESS_TABLE_VLAN_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_MAC_GRP_IDX_FROM\t\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_QINQ_FILTER_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_MAC_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_MAC_GRP_IDX_FROM +\t\t\\\n\t MLX5_ESW_BRIDGE_INGRESS_TABLE_UNTAGGED_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_INGRESS_TABLE_SIZE\t\t\t\\\n\t(MLX5_ESW_BRIDGE_INGRESS_TABLE_MAC_GRP_IDX_TO + 1)\nstatic_assert(MLX5_ESW_BRIDGE_INGRESS_TABLE_SIZE == 1048576);\n\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_VLAN_GRP_SIZE 131072\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_MAC_GRP_SIZE (262144 - 1)\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_VLAN_GRP_IDX_FROM 0\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_VLAN_GRP_IDX_TO\t\t\\\n\t(MLX5_ESW_BRIDGE_EGRESS_TABLE_VLAN_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_QINQ_GRP_IDX_FROM\t\t\\\n\t(MLX5_ESW_BRIDGE_EGRESS_TABLE_VLAN_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_QINQ_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_EGRESS_TABLE_QINQ_GRP_IDX_FROM +\t\t\\\n\t MLX5_ESW_BRIDGE_EGRESS_TABLE_VLAN_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_MAC_GRP_IDX_FROM \\\n\t(MLX5_ESW_BRIDGE_EGRESS_TABLE_QINQ_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_MAC_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_EGRESS_TABLE_MAC_GRP_IDX_FROM +\t\t\\\n\t MLX5_ESW_BRIDGE_EGRESS_TABLE_MAC_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_MISS_GRP_IDX_FROM \\\n\t(MLX5_ESW_BRIDGE_EGRESS_TABLE_MAC_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_MISS_GRP_IDX_TO\t\\\n\tMLX5_ESW_BRIDGE_EGRESS_TABLE_MISS_GRP_IDX_FROM\n#define MLX5_ESW_BRIDGE_EGRESS_TABLE_SIZE\t\t\t\\\n\t(MLX5_ESW_BRIDGE_EGRESS_TABLE_MISS_GRP_IDX_TO + 1)\nstatic_assert(MLX5_ESW_BRIDGE_EGRESS_TABLE_SIZE == 524288);\n\n#define MLX5_ESW_BRIDGE_SKIP_TABLE_SIZE 0\n\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_FILTER_GRP_SIZE 1\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_FWD_GRP_SIZE 1\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_VLAN_GRP_SIZE 4095\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_QINQ_GRP_SIZE MLX5_ESW_BRIDGE_MCAST_TABLE_VLAN_GRP_SIZE\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_FILTER_GRP_IDX_FROM 0\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_FILTER_GRP_IDX_TO\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_FILTER_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_VLAN_GRP_IDX_FROM\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_FILTER_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_VLAN_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_VLAN_GRP_IDX_FROM +\t\t\\\n\t MLX5_ESW_BRIDGE_MCAST_TABLE_VLAN_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_QINQ_GRP_IDX_FROM\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_VLAN_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_QINQ_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_QINQ_GRP_IDX_FROM +\t\t\\\n\t MLX5_ESW_BRIDGE_MCAST_TABLE_QINQ_GRP_SIZE - 1)\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_FWD_GRP_IDX_FROM\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_QINQ_GRP_IDX_TO + 1)\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_FWD_GRP_IDX_TO\t\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_FWD_GRP_IDX_FROM +\t\t\t\\\n\t MLX5_ESW_BRIDGE_MCAST_TABLE_FWD_GRP_SIZE - 1)\n\n#define MLX5_ESW_BRIDGE_MCAST_TABLE_SIZE\t\t\t\\\n\t(MLX5_ESW_BRIDGE_MCAST_TABLE_FWD_GRP_IDX_TO + 1)\nstatic_assert(MLX5_ESW_BRIDGE_MCAST_TABLE_SIZE == 8192);\n\nenum {\n\tMLX5_ESW_BRIDGE_LEVEL_INGRESS_TABLE,\n\tMLX5_ESW_BRIDGE_LEVEL_EGRESS_TABLE,\n\tMLX5_ESW_BRIDGE_LEVEL_MCAST_TABLE,\n\tMLX5_ESW_BRIDGE_LEVEL_SKIP_TABLE,\n};\n\nenum {\n\tMLX5_ESW_BRIDGE_VLAN_FILTERING_FLAG = BIT(0),\n\tMLX5_ESW_BRIDGE_MCAST_FLAG = BIT(1),\n};\n\nstruct mlx5_esw_bridge_fdb_key {\n\tunsigned char addr[ETH_ALEN];\n\tu16 vid;\n};\n\nstruct mlx5_esw_bridge_mdb_key {\n\tunsigned char addr[ETH_ALEN];\n\tu16 vid;\n};\n\nenum {\n\tMLX5_ESW_BRIDGE_FLAG_ADDED_BY_USER = BIT(0),\n\tMLX5_ESW_BRIDGE_FLAG_PEER = BIT(1),\n\tMLX5_ESW_BRIDGE_FLAG_DELETED = BIT(2),\n};\n\nenum {\n\tMLX5_ESW_BRIDGE_PORT_FLAG_PEER = BIT(0),\n};\n\nstruct mlx5_esw_bridge_fdb_entry {\n\tstruct mlx5_esw_bridge_fdb_key key;\n\tstruct rhash_head ht_node;\n\tstruct net_device *dev;\n\tstruct list_head list;\n\tstruct list_head vlan_list;\n\tu16 vport_num;\n\tu16 esw_owner_vhca_id;\n\tu16 flags;\n\n\tstruct mlx5_flow_handle *ingress_handle;\n\tstruct mlx5_fc *ingress_counter;\n\tunsigned long lastuse;\n\tstruct mlx5_flow_handle *egress_handle;\n\tstruct mlx5_flow_handle *filter_handle;\n};\n\nstruct mlx5_esw_bridge_mdb_entry {\n\tstruct mlx5_esw_bridge_mdb_key key;\n\tstruct rhash_head ht_node;\n\tstruct list_head list;\n\tstruct xarray ports;\n\tint num_ports;\n\n\tstruct mlx5_flow_handle *egress_handle;\n};\n\nstruct mlx5_esw_bridge_vlan {\n\tu16 vid;\n\tu16 flags;\n\tstruct list_head fdb_list;\n\tstruct mlx5_pkt_reformat *pkt_reformat_push;\n\tstruct mlx5_pkt_reformat *pkt_reformat_pop;\n\tstruct mlx5_modify_hdr *pkt_mod_hdr_push_mark;\n\tstruct mlx5_flow_handle *mcast_handle;\n};\n\nstruct mlx5_esw_bridge_port {\n\tu16 vport_num;\n\tu16 esw_owner_vhca_id;\n\tu16 flags;\n\tstruct mlx5_esw_bridge *bridge;\n\tstruct xarray vlans;\n\tstruct {\n\t\tstruct mlx5_flow_table *ft;\n\t\tstruct mlx5_flow_group *filter_fg;\n\t\tstruct mlx5_flow_group *vlan_fg;\n\t\tstruct mlx5_flow_group *qinq_fg;\n\t\tstruct mlx5_flow_group *fwd_fg;\n\n\t\tstruct mlx5_flow_handle *filter_handle;\n\t\tstruct mlx5_flow_handle *fwd_handle;\n\t} mcast;\n};\n\nstruct mlx5_esw_bridge {\n\tint ifindex;\n\tint refcnt;\n\tstruct list_head list;\n\tstruct mlx5_esw_bridge_offloads *br_offloads;\n\tstruct dentry *debugfs_dir;\n\n\tstruct list_head fdb_list;\n\tstruct rhashtable fdb_ht;\n\n\tstruct list_head mdb_list;\n\tstruct rhashtable mdb_ht;\n\n\tstruct mlx5_flow_table *egress_ft;\n\tstruct mlx5_flow_group *egress_vlan_fg;\n\tstruct mlx5_flow_group *egress_qinq_fg;\n\tstruct mlx5_flow_group *egress_mac_fg;\n\tstruct mlx5_flow_group *egress_miss_fg;\n\tstruct mlx5_pkt_reformat *egress_miss_pkt_reformat;\n\tstruct mlx5_flow_handle *egress_miss_handle;\n\tunsigned long ageing_time;\n\tu32 flags;\n\tu16 vlan_proto;\n};\n\nstruct mlx5_flow_table *mlx5_esw_bridge_table_create(int max_fte, u32 level,\n\t\t\t\t\t\t     struct mlx5_eswitch *esw);\nunsigned long mlx5_esw_bridge_port_key(struct mlx5_esw_bridge_port *port);\n\nint mlx5_esw_bridge_port_mcast_init(struct mlx5_esw_bridge_port *port);\nvoid mlx5_esw_bridge_port_mcast_cleanup(struct mlx5_esw_bridge_port *port);\nint mlx5_esw_bridge_vlan_mcast_init(u16 vlan_proto, struct mlx5_esw_bridge_port *port,\n\t\t\t\t    struct mlx5_esw_bridge_vlan *vlan);\nvoid mlx5_esw_bridge_vlan_mcast_cleanup(struct mlx5_esw_bridge_vlan *vlan);\n\nint mlx5_esw_bridge_mcast_enable(struct mlx5_esw_bridge *bridge);\nvoid mlx5_esw_bridge_mcast_disable(struct mlx5_esw_bridge *bridge);\n\nint mlx5_esw_bridge_mdb_init(struct mlx5_esw_bridge *bridge);\nvoid mlx5_esw_bridge_mdb_cleanup(struct mlx5_esw_bridge *bridge);\nint mlx5_esw_bridge_port_mdb_attach(struct net_device *dev, struct mlx5_esw_bridge_port *port,\n\t\t\t\t    const unsigned char *addr, u16 vid);\nvoid mlx5_esw_bridge_port_mdb_detach(struct net_device *dev, struct mlx5_esw_bridge_port *port,\n\t\t\t\t     const unsigned char *addr, u16 vid);\nvoid mlx5_esw_bridge_port_mdb_vlan_flush(struct mlx5_esw_bridge_port *port,\n\t\t\t\t\t struct mlx5_esw_bridge_vlan *vlan);\nvoid mlx5_esw_bridge_mdb_flush(struct mlx5_esw_bridge *bridge);\n\nvoid mlx5_esw_bridge_debugfs_offloads_init(struct mlx5_esw_bridge_offloads *br_offloads);\nvoid mlx5_esw_bridge_debugfs_offloads_cleanup(struct mlx5_esw_bridge_offloads *br_offloads);\nvoid mlx5_esw_bridge_debugfs_init(struct net_device *br_netdev, struct mlx5_esw_bridge *bridge);\nvoid mlx5_esw_bridge_debugfs_cleanup(struct mlx5_esw_bridge *bridge);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}