{
  "module_name": "en_stats.c",
  "hash_id": "1c9b163ff8f0037d2dd1e5907fcc56c852328d359e9ac172731ebe0054a8b9eb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/en_stats.c",
  "human_readable_source": " \n\n#include \"lib/events.h\"\n#include \"en.h\"\n#include \"en_accel/ktls.h\"\n#include \"en_accel/en_accel.h\"\n#include \"en/ptp.h\"\n#include \"en/port.h\"\n\n#ifdef CONFIG_PAGE_POOL_STATS\n#include <net/page_pool/helpers.h>\n#endif\n\nstatic unsigned int stats_grps_num(struct mlx5e_priv *priv)\n{\n\treturn !priv->profile->stats_grps_num ? 0 :\n\t\tpriv->profile->stats_grps_num(priv);\n}\n\nunsigned int mlx5e_stats_total_num(struct mlx5e_priv *priv)\n{\n\tmlx5e_stats_grp_t *stats_grps = priv->profile->stats_grps;\n\tconst unsigned int num_stats_grps = stats_grps_num(priv);\n\tunsigned int total = 0;\n\tint i;\n\n\tfor (i = 0; i < num_stats_grps; i++)\n\t\ttotal += stats_grps[i]->get_num_stats(priv);\n\n\treturn total;\n}\n\nvoid mlx5e_stats_update_ndo_stats(struct mlx5e_priv *priv)\n{\n\tmlx5e_stats_grp_t *stats_grps = priv->profile->stats_grps;\n\tconst unsigned int num_stats_grps = stats_grps_num(priv);\n\tint i;\n\n\tfor (i = num_stats_grps - 1; i >= 0; i--)\n\t\tif (stats_grps[i]->update_stats &&\n\t\t    stats_grps[i]->update_stats_mask & MLX5E_NDO_UPDATE_STATS)\n\t\t\tstats_grps[i]->update_stats(priv);\n}\n\nvoid mlx5e_stats_update(struct mlx5e_priv *priv)\n{\n\tmlx5e_stats_grp_t *stats_grps = priv->profile->stats_grps;\n\tconst unsigned int num_stats_grps = stats_grps_num(priv);\n\tint i;\n\n\tfor (i = num_stats_grps - 1; i >= 0; i--)\n\t\tif (stats_grps[i]->update_stats)\n\t\t\tstats_grps[i]->update_stats(priv);\n}\n\nvoid mlx5e_stats_fill(struct mlx5e_priv *priv, u64 *data, int idx)\n{\n\tmlx5e_stats_grp_t *stats_grps = priv->profile->stats_grps;\n\tconst unsigned int num_stats_grps = stats_grps_num(priv);\n\tint i;\n\n\tfor (i = 0; i < num_stats_grps; i++)\n\t\tidx = stats_grps[i]->fill_stats(priv, data, idx);\n}\n\nvoid mlx5e_stats_fill_strings(struct mlx5e_priv *priv, u8 *data)\n{\n\tmlx5e_stats_grp_t *stats_grps = priv->profile->stats_grps;\n\tconst unsigned int num_stats_grps = stats_grps_num(priv);\n\tint i, idx = 0;\n\n\tfor (i = 0; i < num_stats_grps; i++)\n\t\tidx = stats_grps[i]->fill_strings(priv, data, idx);\n}\n\n \n\nstatic const struct counter_desc sw_stats_desc[] = {\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tso_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tso_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tso_inner_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tso_inner_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_added_vlan_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_nop) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_mpwqe_blks) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_mpwqe_pkts) },\n\n#ifdef CONFIG_MLX5_EN_TLS\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_encrypted_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_encrypted_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_ooo) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_dump_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_dump_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_resync_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_skip_no_sync_data) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_drop_no_sync_data) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_tls_drop_bypass_req) },\n#endif\n\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_lro_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_lro_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_gro_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_gro_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_gro_skbs) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_gro_match_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_gro_large_hds) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_ecn_mark) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_removed_vlan_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_csum_unnecessary) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_csum_none) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_csum_complete) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_csum_complete_tail) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_csum_complete_tail_slow) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_csum_unnecessary_inner) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_drop) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_redirect) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_tx_xmit) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_tx_mpwqe) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_tx_inlnw) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_tx_nops) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_tx_full) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_tx_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xdp_tx_cqe) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_csum_none) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_csum_partial) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_csum_partial_inner) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_queue_stopped) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_queue_dropped) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xmit_more) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_recover) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_cqes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_queue_wake) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_cqe_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xdp_xmit) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xdp_mpwqe) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xdp_inlnw) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xdp_nops) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xdp_full) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xdp_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xdp_cqes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_wqe_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_mpwqe_filler_cqes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_mpwqe_filler_strides) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_oversize_pkts_sw_drop) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_buff_alloc_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_cqe_compress_blks) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_cqe_compress_pkts) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_congst_umr) },\n#ifdef CONFIG_MLX5_EN_ARFS\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_arfs_add) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_arfs_request_in) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_arfs_request_out) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_arfs_expired) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_arfs_err) },\n#endif\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_recover) },\n#ifdef CONFIG_PAGE_POOL_STATS\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_alloc_fast) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_alloc_slow) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_alloc_slow_high_order) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_alloc_empty) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_alloc_refill) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_alloc_waive) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_recycle_cached) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_recycle_cache_full) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_recycle_ring) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_recycle_ring_full) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_pp_recycle_released_ref) },\n#endif\n#ifdef CONFIG_MLX5_EN_TLS\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_decrypted_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_decrypted_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_resync_req_pkt) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_resync_req_start) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_resync_req_end) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_resync_req_skip) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_resync_res_ok) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_resync_res_retry) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_resync_res_skip) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_tls_err) },\n#endif\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, ch_events) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, ch_poll) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, ch_arm) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, ch_aff_change) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, ch_force_irq) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, ch_eq_rearm) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_bytes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_csum_complete) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_csum_unnecessary) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_csum_unnecessary_inner) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_csum_none) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_ecn_mark) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_removed_vlan_packets) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_xdp_drop) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_xdp_redirect) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_wqe_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_mpwqe_filler_cqes) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_mpwqe_filler_strides) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_oversize_pkts_sw_drop) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_buff_alloc_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_cqe_compress_blks) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_cqe_compress_pkts) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, rx_xsk_congst_umr) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xsk_xmit) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xsk_mpwqe) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xsk_inlnw) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xsk_full) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xsk_err) },\n\t{ MLX5E_DECLARE_STAT(struct mlx5e_sw_stats, tx_xsk_cqes) },\n};\n\n#define NUM_SW_COUNTERS\t\t\tARRAY_SIZE(sw_stats_desc)\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(sw)\n{\n\treturn NUM_SW_COUNTERS;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(sw)\n{\n\tint i;\n\n\tfor (i = 0; i < NUM_SW_COUNTERS; i++)\n\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN, sw_stats_desc[i].format);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(sw)\n{\n\tint i;\n\n\tfor (i = 0; i < NUM_SW_COUNTERS; i++)\n\t\tdata[idx++] = MLX5E_READ_CTR64_CPU(&priv->stats.sw, sw_stats_desc, i);\n\treturn idx;\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_xdp_red(struct mlx5e_sw_stats *s,\n\t\t\t\t\t\t    struct mlx5e_xdpsq_stats *xdpsq_red_stats)\n{\n\ts->tx_xdp_xmit  += xdpsq_red_stats->xmit;\n\ts->tx_xdp_mpwqe += xdpsq_red_stats->mpwqe;\n\ts->tx_xdp_inlnw += xdpsq_red_stats->inlnw;\n\ts->tx_xdp_nops  += xdpsq_red_stats->nops;\n\ts->tx_xdp_full  += xdpsq_red_stats->full;\n\ts->tx_xdp_err   += xdpsq_red_stats->err;\n\ts->tx_xdp_cqes  += xdpsq_red_stats->cqes;\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_xdpsq(struct mlx5e_sw_stats *s,\n\t\t\t\t\t\t  struct mlx5e_xdpsq_stats *xdpsq_stats)\n{\n\ts->rx_xdp_tx_xmit  += xdpsq_stats->xmit;\n\ts->rx_xdp_tx_mpwqe += xdpsq_stats->mpwqe;\n\ts->rx_xdp_tx_inlnw += xdpsq_stats->inlnw;\n\ts->rx_xdp_tx_nops  += xdpsq_stats->nops;\n\ts->rx_xdp_tx_full  += xdpsq_stats->full;\n\ts->rx_xdp_tx_err   += xdpsq_stats->err;\n\ts->rx_xdp_tx_cqe   += xdpsq_stats->cqes;\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_xsksq(struct mlx5e_sw_stats *s,\n\t\t\t\t\t\t  struct mlx5e_xdpsq_stats *xsksq_stats)\n{\n\ts->tx_xsk_xmit  += xsksq_stats->xmit;\n\ts->tx_xsk_mpwqe += xsksq_stats->mpwqe;\n\ts->tx_xsk_inlnw += xsksq_stats->inlnw;\n\ts->tx_xsk_full  += xsksq_stats->full;\n\ts->tx_xsk_err   += xsksq_stats->err;\n\ts->tx_xsk_cqes  += xsksq_stats->cqes;\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_xskrq(struct mlx5e_sw_stats *s,\n\t\t\t\t\t\t  struct mlx5e_rq_stats *xskrq_stats)\n{\n\ts->rx_xsk_packets                += xskrq_stats->packets;\n\ts->rx_xsk_bytes                  += xskrq_stats->bytes;\n\ts->rx_xsk_csum_complete          += xskrq_stats->csum_complete;\n\ts->rx_xsk_csum_unnecessary       += xskrq_stats->csum_unnecessary;\n\ts->rx_xsk_csum_unnecessary_inner += xskrq_stats->csum_unnecessary_inner;\n\ts->rx_xsk_csum_none              += xskrq_stats->csum_none;\n\ts->rx_xsk_ecn_mark               += xskrq_stats->ecn_mark;\n\ts->rx_xsk_removed_vlan_packets   += xskrq_stats->removed_vlan_packets;\n\ts->rx_xsk_xdp_drop               += xskrq_stats->xdp_drop;\n\ts->rx_xsk_xdp_redirect           += xskrq_stats->xdp_redirect;\n\ts->rx_xsk_wqe_err                += xskrq_stats->wqe_err;\n\ts->rx_xsk_mpwqe_filler_cqes      += xskrq_stats->mpwqe_filler_cqes;\n\ts->rx_xsk_mpwqe_filler_strides   += xskrq_stats->mpwqe_filler_strides;\n\ts->rx_xsk_oversize_pkts_sw_drop  += xskrq_stats->oversize_pkts_sw_drop;\n\ts->rx_xsk_buff_alloc_err         += xskrq_stats->buff_alloc_err;\n\ts->rx_xsk_cqe_compress_blks      += xskrq_stats->cqe_compress_blks;\n\ts->rx_xsk_cqe_compress_pkts      += xskrq_stats->cqe_compress_pkts;\n\ts->rx_xsk_congst_umr             += xskrq_stats->congst_umr;\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_rq_stats(struct mlx5e_sw_stats *s,\n\t\t\t\t\t\t     struct mlx5e_rq_stats *rq_stats)\n{\n\ts->rx_packets                 += rq_stats->packets;\n\ts->rx_bytes                   += rq_stats->bytes;\n\ts->rx_lro_packets             += rq_stats->lro_packets;\n\ts->rx_lro_bytes               += rq_stats->lro_bytes;\n\ts->rx_gro_packets             += rq_stats->gro_packets;\n\ts->rx_gro_bytes               += rq_stats->gro_bytes;\n\ts->rx_gro_skbs                += rq_stats->gro_skbs;\n\ts->rx_gro_match_packets       += rq_stats->gro_match_packets;\n\ts->rx_gro_large_hds           += rq_stats->gro_large_hds;\n\ts->rx_ecn_mark                += rq_stats->ecn_mark;\n\ts->rx_removed_vlan_packets    += rq_stats->removed_vlan_packets;\n\ts->rx_csum_none               += rq_stats->csum_none;\n\ts->rx_csum_complete           += rq_stats->csum_complete;\n\ts->rx_csum_complete_tail      += rq_stats->csum_complete_tail;\n\ts->rx_csum_complete_tail_slow += rq_stats->csum_complete_tail_slow;\n\ts->rx_csum_unnecessary        += rq_stats->csum_unnecessary;\n\ts->rx_csum_unnecessary_inner  += rq_stats->csum_unnecessary_inner;\n\ts->rx_xdp_drop                += rq_stats->xdp_drop;\n\ts->rx_xdp_redirect            += rq_stats->xdp_redirect;\n\ts->rx_wqe_err                 += rq_stats->wqe_err;\n\ts->rx_mpwqe_filler_cqes       += rq_stats->mpwqe_filler_cqes;\n\ts->rx_mpwqe_filler_strides    += rq_stats->mpwqe_filler_strides;\n\ts->rx_oversize_pkts_sw_drop   += rq_stats->oversize_pkts_sw_drop;\n\ts->rx_buff_alloc_err          += rq_stats->buff_alloc_err;\n\ts->rx_cqe_compress_blks       += rq_stats->cqe_compress_blks;\n\ts->rx_cqe_compress_pkts       += rq_stats->cqe_compress_pkts;\n\ts->rx_congst_umr              += rq_stats->congst_umr;\n#ifdef CONFIG_MLX5_EN_ARFS\n\ts->rx_arfs_add                += rq_stats->arfs_add;\n\ts->rx_arfs_request_in         += rq_stats->arfs_request_in;\n\ts->rx_arfs_request_out        += rq_stats->arfs_request_out;\n\ts->rx_arfs_expired            += rq_stats->arfs_expired;\n\ts->rx_arfs_err                += rq_stats->arfs_err;\n#endif\n\ts->rx_recover                 += rq_stats->recover;\n#ifdef CONFIG_PAGE_POOL_STATS\n\ts->rx_pp_alloc_fast          += rq_stats->pp_alloc_fast;\n\ts->rx_pp_alloc_slow          += rq_stats->pp_alloc_slow;\n\ts->rx_pp_alloc_empty         += rq_stats->pp_alloc_empty;\n\ts->rx_pp_alloc_refill        += rq_stats->pp_alloc_refill;\n\ts->rx_pp_alloc_waive         += rq_stats->pp_alloc_waive;\n\ts->rx_pp_alloc_slow_high_order\t\t+= rq_stats->pp_alloc_slow_high_order;\n\ts->rx_pp_recycle_cached\t\t\t+= rq_stats->pp_recycle_cached;\n\ts->rx_pp_recycle_cache_full\t\t+= rq_stats->pp_recycle_cache_full;\n\ts->rx_pp_recycle_ring\t\t\t+= rq_stats->pp_recycle_ring;\n\ts->rx_pp_recycle_ring_full\t\t+= rq_stats->pp_recycle_ring_full;\n\ts->rx_pp_recycle_released_ref\t\t+= rq_stats->pp_recycle_released_ref;\n#endif\n#ifdef CONFIG_MLX5_EN_TLS\n\ts->rx_tls_decrypted_packets   += rq_stats->tls_decrypted_packets;\n\ts->rx_tls_decrypted_bytes     += rq_stats->tls_decrypted_bytes;\n\ts->rx_tls_resync_req_pkt      += rq_stats->tls_resync_req_pkt;\n\ts->rx_tls_resync_req_start    += rq_stats->tls_resync_req_start;\n\ts->rx_tls_resync_req_end      += rq_stats->tls_resync_req_end;\n\ts->rx_tls_resync_req_skip     += rq_stats->tls_resync_req_skip;\n\ts->rx_tls_resync_res_ok       += rq_stats->tls_resync_res_ok;\n\ts->rx_tls_resync_res_retry    += rq_stats->tls_resync_res_retry;\n\ts->rx_tls_resync_res_skip     += rq_stats->tls_resync_res_skip;\n\ts->rx_tls_err                 += rq_stats->tls_err;\n#endif\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_ch_stats(struct mlx5e_sw_stats *s,\n\t\t\t\t\t\t     struct mlx5e_ch_stats *ch_stats)\n{\n\ts->ch_events      += ch_stats->events;\n\ts->ch_poll        += ch_stats->poll;\n\ts->ch_arm         += ch_stats->arm;\n\ts->ch_aff_change  += ch_stats->aff_change;\n\ts->ch_force_irq   += ch_stats->force_irq;\n\ts->ch_eq_rearm    += ch_stats->eq_rearm;\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_sq(struct mlx5e_sw_stats *s,\n\t\t\t\t\t       struct mlx5e_sq_stats *sq_stats)\n{\n\ts->tx_packets               += sq_stats->packets;\n\ts->tx_bytes                 += sq_stats->bytes;\n\ts->tx_tso_packets           += sq_stats->tso_packets;\n\ts->tx_tso_bytes             += sq_stats->tso_bytes;\n\ts->tx_tso_inner_packets     += sq_stats->tso_inner_packets;\n\ts->tx_tso_inner_bytes       += sq_stats->tso_inner_bytes;\n\ts->tx_added_vlan_packets    += sq_stats->added_vlan_packets;\n\ts->tx_nop                   += sq_stats->nop;\n\ts->tx_mpwqe_blks            += sq_stats->mpwqe_blks;\n\ts->tx_mpwqe_pkts            += sq_stats->mpwqe_pkts;\n\ts->tx_queue_stopped         += sq_stats->stopped;\n\ts->tx_queue_wake            += sq_stats->wake;\n\ts->tx_queue_dropped         += sq_stats->dropped;\n\ts->tx_cqe_err               += sq_stats->cqe_err;\n\ts->tx_recover               += sq_stats->recover;\n\ts->tx_xmit_more             += sq_stats->xmit_more;\n\ts->tx_csum_partial_inner    += sq_stats->csum_partial_inner;\n\ts->tx_csum_none             += sq_stats->csum_none;\n\ts->tx_csum_partial          += sq_stats->csum_partial;\n#ifdef CONFIG_MLX5_EN_TLS\n\ts->tx_tls_encrypted_packets += sq_stats->tls_encrypted_packets;\n\ts->tx_tls_encrypted_bytes   += sq_stats->tls_encrypted_bytes;\n\ts->tx_tls_ooo               += sq_stats->tls_ooo;\n\ts->tx_tls_dump_bytes        += sq_stats->tls_dump_bytes;\n\ts->tx_tls_dump_packets      += sq_stats->tls_dump_packets;\n\ts->tx_tls_resync_bytes      += sq_stats->tls_resync_bytes;\n\ts->tx_tls_skip_no_sync_data += sq_stats->tls_skip_no_sync_data;\n\ts->tx_tls_drop_no_sync_data += sq_stats->tls_drop_no_sync_data;\n\ts->tx_tls_drop_bypass_req   += sq_stats->tls_drop_bypass_req;\n#endif\n\ts->tx_cqes                  += sq_stats->cqes;\n}\n\nstatic void mlx5e_stats_grp_sw_update_stats_ptp(struct mlx5e_priv *priv,\n\t\t\t\t\t\tstruct mlx5e_sw_stats *s)\n{\n\tint i;\n\n\tif (!priv->tx_ptp_opened && !priv->rx_ptp_opened)\n\t\treturn;\n\n\tmlx5e_stats_grp_sw_update_stats_ch_stats(s, &priv->ptp_stats.ch);\n\n\tif (priv->tx_ptp_opened) {\n\t\tfor (i = 0; i < priv->max_opened_tc; i++) {\n\t\t\tmlx5e_stats_grp_sw_update_stats_sq(s, &priv->ptp_stats.sq[i]);\n\n\t\t\t \n\tmax_qos_sqs = smp_load_acquire(&priv->htb_max_qos_sqs);\n\tstats = READ_ONCE(priv->htb_qos_sq_stats);\n\n\tfor (i = 0; i < max_qos_sqs; i++) {\n\t\tmlx5e_stats_grp_sw_update_stats_sq(s, READ_ONCE(stats[i]));\n\n\t\t \n\t\tmlx5e_stats_update_stats_rq_page_pool(priv->channels.c[i]);\n\n\tfor (i = 0; i < priv->stats_nch; i++) {\n\t\tstruct mlx5e_channel_stats *channel_stats =\n\t\t\tpriv->channel_stats[i];\n\n\t\tint j;\n\n\t\tmlx5e_stats_grp_sw_update_stats_rq_stats(s, &channel_stats->rq);\n\t\tmlx5e_stats_grp_sw_update_stats_xdpsq(s, &channel_stats->rq_xdpsq);\n\t\tmlx5e_stats_grp_sw_update_stats_ch_stats(s, &channel_stats->ch);\n\t\t \n\t\tmlx5e_stats_grp_sw_update_stats_xdp_red(s, &channel_stats->xdpsq);\n\t\t \n\t\tmlx5e_stats_grp_sw_update_stats_xskrq(s, &channel_stats->xskrq);\n\t\tmlx5e_stats_grp_sw_update_stats_xsksq(s, &channel_stats->xsksq);\n\n\t\tfor (j = 0; j < priv->max_opened_tc; j++) {\n\t\t\tmlx5e_stats_grp_sw_update_stats_sq(s, &channel_stats->sq[j]);\n\n\t\t\t \n\tnum_stats = 1;\n\n\tnum_stats += MLX5_CAP_PCAM_FEATURE(mdev, ppcnt_statistical_group) ?\n\t\t     NUM_PPORT_PHY_STATISTICAL_COUNTERS : 0;\n\n\tnum_stats += MLX5_CAP_PCAM_FEATURE(mdev, per_lane_error_counters) ?\n\t\t     NUM_PPORT_PHY_STATISTICAL_PER_LANE_COUNTERS : 0;\n\n\treturn num_stats;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(phy)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tint i;\n\n\tstrcpy(data + (idx++) * ETH_GSTRING_LEN, \"link_down_events_phy\");\n\n\tif (!MLX5_CAP_PCAM_FEATURE(mdev, ppcnt_statistical_group))\n\t\treturn idx;\n\n\tfor (i = 0; i < NUM_PPORT_PHY_STATISTICAL_COUNTERS; i++)\n\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t       pport_phy_statistical_stats_desc[i].format);\n\n\tif (MLX5_CAP_PCAM_FEATURE(mdev, per_lane_error_counters))\n\t\tfor (i = 0; i < NUM_PPORT_PHY_STATISTICAL_PER_LANE_COUNTERS; i++)\n\t\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t       pport_phy_statistical_err_lanes_stats_desc[i].format);\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(phy)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tint i;\n\n\t \n\tdata[idx++] = MLX5_GET(ppcnt_reg, priv->stats.pport.phy_counters,\n\t\t\t       counter_set.phys_layer_cntrs.link_down_events);\n\n\tif (!MLX5_CAP_PCAM_FEATURE(mdev, ppcnt_statistical_group))\n\t\treturn idx;\n\n\tfor (i = 0; i < NUM_PPORT_PHY_STATISTICAL_COUNTERS; i++)\n\t\tdata[idx++] =\n\t\t\tMLX5E_READ_CTR64_BE(&priv->stats.pport.phy_statistical_counters,\n\t\t\t\t\t    pport_phy_statistical_stats_desc, i);\n\n\tif (MLX5_CAP_PCAM_FEATURE(mdev, per_lane_error_counters))\n\t\tfor (i = 0; i < NUM_PPORT_PHY_STATISTICAL_PER_LANE_COUNTERS; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&priv->stats.pport.phy_statistical_counters,\n\t\t\t\t\t\t    pport_phy_statistical_err_lanes_stats_desc,\n\t\t\t\t\t\t    i);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(phy)\n{\n\tstruct mlx5e_pport_stats *pstats = &priv->stats.pport;\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {0};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\tvoid *out;\n\n\tMLX5_SET(ppcnt_reg, in, local_port, 1);\n\tout = pstats->phy_counters;\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PHYSICAL_LAYER_COUNTERS_GROUP);\n\tmlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_PPCNT, 0, 0);\n\n\tif (!MLX5_CAP_PCAM_FEATURE(mdev, ppcnt_statistical_group))\n\t\treturn;\n\n\tout = pstats->phy_statistical_counters;\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PHYSICAL_LAYER_STATISTICAL_GROUP);\n\tmlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_PPCNT, 0, 0);\n}\n\nvoid mlx5e_get_link_ext_stats(struct net_device *dev,\n\t\t\t      struct ethtool_link_ext_stats *stats)\n{\n\tstruct mlx5e_priv *priv = netdev_priv(dev);\n\tu32 out[MLX5_ST_SZ_DW(ppcnt_reg)] = {};\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\n\tMLX5_SET(ppcnt_reg, in, local_port, 1);\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PHYSICAL_LAYER_COUNTERS_GROUP);\n\tmlx5_core_access_reg(priv->mdev, in, sz, out,\n\t\t\t     MLX5_ST_SZ_BYTES(ppcnt_reg), MLX5_REG_PPCNT, 0, 0);\n\n\tstats->link_down_events = MLX5_GET(ppcnt_reg, out,\n\t\t\t\t\t   counter_set.phys_layer_cntrs.link_down_events);\n}\n\nstatic int fec_num_lanes(struct mlx5_core_dev *dev)\n{\n\tu32 out[MLX5_ST_SZ_DW(pmlp_reg)] = {};\n\tu32 in[MLX5_ST_SZ_DW(pmlp_reg)] = {};\n\tint err;\n\n\tMLX5_SET(pmlp_reg, in, local_port, 1);\n\terr = mlx5_core_access_reg(dev, in, sizeof(in), out, sizeof(out),\n\t\t\t\t   MLX5_REG_PMLP, 0, 0);\n\tif (err)\n\t\treturn 0;\n\n\treturn MLX5_GET(pmlp_reg, out, width);\n}\n\nstatic int fec_active_mode(struct mlx5_core_dev *mdev)\n{\n\tunsigned long fec_active_long;\n\tu32 fec_active;\n\n\tif (mlx5e_get_fec_mode(mdev, &fec_active, NULL))\n\t\treturn MLX5E_FEC_NOFEC;\n\n\tfec_active_long = fec_active;\n\treturn find_first_bit(&fec_active_long, sizeof(unsigned long) * BITS_PER_BYTE);\n}\n\n#define MLX5E_STATS_SET_FEC_BLOCK(idx) ({ \\\n\tfec_stats->corrected_blocks.lanes[(idx)] = \\\n\t\tMLX5E_READ_CTR64_BE_F(ppcnt, phys_layer_cntrs, \\\n\t\t\t\t      fc_fec_corrected_blocks_lane##idx); \\\n\tfec_stats->uncorrectable_blocks.lanes[(idx)] = \\\n\t\tMLX5E_READ_CTR64_BE_F(ppcnt, phys_layer_cntrs, \\\n\t\t\t\t      fc_fec_uncorrectable_blocks_lane##idx); \\\n})\n\nstatic void fec_set_fc_stats(struct ethtool_fec_stats *fec_stats,\n\t\t\t     u32 *ppcnt, u8 lanes)\n{\n\tif (lanes > 3) {  \n\t\tMLX5E_STATS_SET_FEC_BLOCK(3);\n\t\tMLX5E_STATS_SET_FEC_BLOCK(2);\n\t}\n\tif (lanes > 1)  \n\t\tMLX5E_STATS_SET_FEC_BLOCK(1);\n\tif (lanes > 0)  \n\t\tMLX5E_STATS_SET_FEC_BLOCK(0);\n}\n\nstatic void fec_set_rs_stats(struct ethtool_fec_stats *fec_stats, u32 *ppcnt)\n{\n\tfec_stats->corrected_blocks.total =\n\t\tMLX5E_READ_CTR64_BE_F(ppcnt, phys_layer_cntrs,\n\t\t\t\t      rs_fec_corrected_blocks);\n\tfec_stats->uncorrectable_blocks.total =\n\t\tMLX5E_READ_CTR64_BE_F(ppcnt, phys_layer_cntrs,\n\t\t\t\t      rs_fec_uncorrectable_blocks);\n}\n\nstatic void fec_set_block_stats(struct mlx5e_priv *priv,\n\t\t\t\tstruct ethtool_fec_stats *fec_stats)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 out[MLX5_ST_SZ_DW(ppcnt_reg)] = {};\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\tint mode = fec_active_mode(mdev);\n\n\tif (mode == MLX5E_FEC_NOFEC)\n\t\treturn;\n\n\tMLX5_SET(ppcnt_reg, in, local_port, 1);\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PHYSICAL_LAYER_COUNTERS_GROUP);\n\tif (mlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_PPCNT, 0, 0))\n\t\treturn;\n\n\tswitch (mode) {\n\tcase MLX5E_FEC_RS_528_514:\n\tcase MLX5E_FEC_RS_544_514:\n\tcase MLX5E_FEC_LLRS_272_257_1:\n\t\tfec_set_rs_stats(fec_stats, out);\n\t\treturn;\n\tcase MLX5E_FEC_FIRECODE:\n\t\tfec_set_fc_stats(fec_stats, out, fec_num_lanes(mdev));\n\t}\n}\n\nstatic void fec_set_corrected_bits_total(struct mlx5e_priv *priv,\n\t\t\t\t\t struct ethtool_fec_stats *fec_stats)\n{\n\tu32 ppcnt_phy_statistical[MLX5_ST_SZ_DW(ppcnt_reg)];\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\n\tMLX5_SET(ppcnt_reg, in, local_port, 1);\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PHYSICAL_LAYER_STATISTICAL_GROUP);\n\tif (mlx5_core_access_reg(mdev, in, sz, ppcnt_phy_statistical,\n\t\t\t\t sz, MLX5_REG_PPCNT, 0, 0))\n\t\treturn;\n\n\tfec_stats->corrected_bits.total =\n\t\tMLX5E_READ_CTR64_BE_F(ppcnt_phy_statistical,\n\t\t\t\t      phys_layer_statistical_cntrs,\n\t\t\t\t      phy_corrected_bits);\n}\n\nvoid mlx5e_stats_fec_get(struct mlx5e_priv *priv,\n\t\t\t struct ethtool_fec_stats *fec_stats)\n{\n\tif (!MLX5_CAP_PCAM_FEATURE(priv->mdev, ppcnt_statistical_group))\n\t\treturn;\n\n\tfec_set_corrected_bits_total(priv, fec_stats);\n\tfec_set_block_stats(priv, fec_stats);\n}\n\n#define PPORT_ETH_EXT_OFF(c) \\\n\tMLX5_BYTE_OFF(ppcnt_reg, \\\n\t\t      counter_set.eth_extended_cntrs_grp_data_layout.c##_high)\nstatic const struct counter_desc pport_eth_ext_stats_desc[] = {\n\t{ \"rx_buffer_passed_thres_phy\", PPORT_ETH_EXT_OFF(rx_buffer_almost_full) },\n};\n\n#define NUM_PPORT_ETH_EXT_COUNTERS\tARRAY_SIZE(pport_eth_ext_stats_desc)\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(eth_ext)\n{\n\tif (MLX5_CAP_PCAM_FEATURE((priv)->mdev, rx_buffer_fullness_counters))\n\t\treturn NUM_PPORT_ETH_EXT_COUNTERS;\n\n\treturn 0;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(eth_ext)\n{\n\tint i;\n\n\tif (MLX5_CAP_PCAM_FEATURE((priv)->mdev, rx_buffer_fullness_counters))\n\t\tfor (i = 0; i < NUM_PPORT_ETH_EXT_COUNTERS; i++)\n\t\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t       pport_eth_ext_stats_desc[i].format);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(eth_ext)\n{\n\tint i;\n\n\tif (MLX5_CAP_PCAM_FEATURE((priv)->mdev, rx_buffer_fullness_counters))\n\t\tfor (i = 0; i < NUM_PPORT_ETH_EXT_COUNTERS; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&priv->stats.pport.eth_ext_counters,\n\t\t\t\t\t\t    pport_eth_ext_stats_desc, i);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(eth_ext)\n{\n\tstruct mlx5e_pport_stats *pstats = &priv->stats.pport;\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {0};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\tvoid *out;\n\n\tif (!MLX5_CAP_PCAM_FEATURE(mdev, rx_buffer_fullness_counters))\n\t\treturn;\n\n\tMLX5_SET(ppcnt_reg, in, local_port, 1);\n\tout = pstats->eth_ext_counters;\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_ETHERNET_EXTENDED_COUNTERS_GROUP);\n\tmlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_PPCNT, 0, 0);\n}\n\n#define PCIE_PERF_OFF(c) \\\n\tMLX5_BYTE_OFF(mpcnt_reg, counter_set.pcie_perf_cntrs_grp_data_layout.c)\nstatic const struct counter_desc pcie_perf_stats_desc[] = {\n\t{ \"rx_pci_signal_integrity\", PCIE_PERF_OFF(rx_errors) },\n\t{ \"tx_pci_signal_integrity\", PCIE_PERF_OFF(tx_errors) },\n};\n\n#define PCIE_PERF_OFF64(c) \\\n\tMLX5_BYTE_OFF(mpcnt_reg, counter_set.pcie_perf_cntrs_grp_data_layout.c##_high)\nstatic const struct counter_desc pcie_perf_stats_desc64[] = {\n\t{ \"outbound_pci_buffer_overflow\", PCIE_PERF_OFF64(tx_overflow_buffer_pkt) },\n};\n\nstatic const struct counter_desc pcie_perf_stall_stats_desc[] = {\n\t{ \"outbound_pci_stalled_rd\", PCIE_PERF_OFF(outbound_stalled_reads) },\n\t{ \"outbound_pci_stalled_wr\", PCIE_PERF_OFF(outbound_stalled_writes) },\n\t{ \"outbound_pci_stalled_rd_events\", PCIE_PERF_OFF(outbound_stalled_reads_events) },\n\t{ \"outbound_pci_stalled_wr_events\", PCIE_PERF_OFF(outbound_stalled_writes_events) },\n};\n\n#define NUM_PCIE_PERF_COUNTERS\t\tARRAY_SIZE(pcie_perf_stats_desc)\n#define NUM_PCIE_PERF_COUNTERS64\tARRAY_SIZE(pcie_perf_stats_desc64)\n#define NUM_PCIE_PERF_STALL_COUNTERS\tARRAY_SIZE(pcie_perf_stall_stats_desc)\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(pcie)\n{\n\tint num_stats = 0;\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, pcie_performance_group))\n\t\tnum_stats += NUM_PCIE_PERF_COUNTERS;\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, tx_overflow_buffer_pkt))\n\t\tnum_stats += NUM_PCIE_PERF_COUNTERS64;\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, pcie_outbound_stalled))\n\t\tnum_stats += NUM_PCIE_PERF_STALL_COUNTERS;\n\n\treturn num_stats;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(pcie)\n{\n\tint i;\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, pcie_performance_group))\n\t\tfor (i = 0; i < NUM_PCIE_PERF_COUNTERS; i++)\n\t\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t       pcie_perf_stats_desc[i].format);\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, tx_overflow_buffer_pkt))\n\t\tfor (i = 0; i < NUM_PCIE_PERF_COUNTERS64; i++)\n\t\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t       pcie_perf_stats_desc64[i].format);\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, pcie_outbound_stalled))\n\t\tfor (i = 0; i < NUM_PCIE_PERF_STALL_COUNTERS; i++)\n\t\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t       pcie_perf_stall_stats_desc[i].format);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(pcie)\n{\n\tint i;\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, pcie_performance_group))\n\t\tfor (i = 0; i < NUM_PCIE_PERF_COUNTERS; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR32_BE(&priv->stats.pcie.pcie_perf_counters,\n\t\t\t\t\t\t    pcie_perf_stats_desc, i);\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, tx_overflow_buffer_pkt))\n\t\tfor (i = 0; i < NUM_PCIE_PERF_COUNTERS64; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&priv->stats.pcie.pcie_perf_counters,\n\t\t\t\t\t\t    pcie_perf_stats_desc64, i);\n\n\tif (MLX5_CAP_MCAM_FEATURE((priv)->mdev, pcie_outbound_stalled))\n\t\tfor (i = 0; i < NUM_PCIE_PERF_STALL_COUNTERS; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR32_BE(&priv->stats.pcie.pcie_perf_counters,\n\t\t\t\t\t\t    pcie_perf_stall_stats_desc, i);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(pcie)\n{\n\tstruct mlx5e_pcie_stats *pcie_stats = &priv->stats.pcie;\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 in[MLX5_ST_SZ_DW(mpcnt_reg)] = {0};\n\tint sz = MLX5_ST_SZ_BYTES(mpcnt_reg);\n\tvoid *out;\n\n\tif (!MLX5_CAP_MCAM_FEATURE(mdev, pcie_performance_group))\n\t\treturn;\n\n\tout = pcie_stats->pcie_perf_counters;\n\tMLX5_SET(mpcnt_reg, in, grp, MLX5_PCIE_PERFORMANCE_COUNTERS_GROUP);\n\tmlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_MPCNT, 0, 0);\n}\n\n#define PPORT_PER_TC_PRIO_OFF(c) \\\n\tMLX5_BYTE_OFF(ppcnt_reg, \\\n\t\t      counter_set.eth_per_tc_prio_grp_data_layout.c##_high)\n\nstatic const struct counter_desc pport_per_tc_prio_stats_desc[] = {\n\t{ \"rx_prio%d_buf_discard\", PPORT_PER_TC_PRIO_OFF(no_buffer_discard_uc) },\n};\n\n#define NUM_PPORT_PER_TC_PRIO_COUNTERS\tARRAY_SIZE(pport_per_tc_prio_stats_desc)\n\n#define PPORT_PER_TC_CONGEST_PRIO_OFF(c) \\\n\tMLX5_BYTE_OFF(ppcnt_reg, \\\n\t\t      counter_set.eth_per_tc_congest_prio_grp_data_layout.c##_high)\n\nstatic const struct counter_desc pport_per_tc_congest_prio_stats_desc[] = {\n\t{ \"rx_prio%d_cong_discard\", PPORT_PER_TC_CONGEST_PRIO_OFF(wred_discard) },\n\t{ \"rx_prio%d_marked\", PPORT_PER_TC_CONGEST_PRIO_OFF(ecn_marked_tc) },\n};\n\n#define NUM_PPORT_PER_TC_CONGEST_PRIO_COUNTERS \\\n\tARRAY_SIZE(pport_per_tc_congest_prio_stats_desc)\n\nstatic int mlx5e_grp_per_tc_prio_get_num_stats(struct mlx5e_priv *priv)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\n\tif (!MLX5_CAP_GEN(mdev, sbcam_reg))\n\t\treturn 0;\n\n\treturn NUM_PPORT_PER_TC_PRIO_COUNTERS * NUM_PPORT_PRIO;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(per_port_buff_congest)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tint i, prio;\n\n\tif (!MLX5_CAP_GEN(mdev, sbcam_reg))\n\t\treturn idx;\n\n\tfor (prio = 0; prio < NUM_PPORT_PRIO; prio++) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_TC_PRIO_COUNTERS; i++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tpport_per_tc_prio_stats_desc[i].format, prio);\n\t\tfor (i = 0; i < NUM_PPORT_PER_TC_CONGEST_PRIO_COUNTERS; i++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tpport_per_tc_congest_prio_stats_desc[i].format, prio);\n\t}\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(per_port_buff_congest)\n{\n\tstruct mlx5e_pport_stats *pport = &priv->stats.pport;\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tint i, prio;\n\n\tif (!MLX5_CAP_GEN(mdev, sbcam_reg))\n\t\treturn idx;\n\n\tfor (prio = 0; prio < NUM_PPORT_PRIO; prio++) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_TC_PRIO_COUNTERS; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&pport->per_tc_prio_counters[prio],\n\t\t\t\t\t\t    pport_per_tc_prio_stats_desc, i);\n\t\tfor (i = 0; i < NUM_PPORT_PER_TC_CONGEST_PRIO_COUNTERS ; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&pport->per_tc_congest_prio_counters[prio],\n\t\t\t\t\t\t    pport_per_tc_congest_prio_stats_desc, i);\n\t}\n\n\treturn idx;\n}\n\nstatic void mlx5e_grp_per_tc_prio_update_stats(struct mlx5e_priv *priv)\n{\n\tstruct mlx5e_pport_stats *pstats = &priv->stats.pport;\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\tvoid *out;\n\tint prio;\n\n\tif (!MLX5_CAP_GEN(mdev, sbcam_reg))\n\t\treturn;\n\n\tMLX5_SET(ppcnt_reg, in, pnat, 2);\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PER_TRAFFIC_CLASS_COUNTERS_GROUP);\n\tfor (prio = 0; prio < NUM_PPORT_PRIO; prio++) {\n\t\tout = pstats->per_tc_prio_counters[prio];\n\t\tMLX5_SET(ppcnt_reg, in, prio_tc, prio);\n\t\tmlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_PPCNT, 0, 0);\n\t}\n}\n\nstatic int mlx5e_grp_per_tc_congest_prio_get_num_stats(struct mlx5e_priv *priv)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\n\tif (!MLX5_CAP_GEN(mdev, sbcam_reg))\n\t\treturn 0;\n\n\treturn NUM_PPORT_PER_TC_CONGEST_PRIO_COUNTERS * NUM_PPORT_PRIO;\n}\n\nstatic void mlx5e_grp_per_tc_congest_prio_update_stats(struct mlx5e_priv *priv)\n{\n\tstruct mlx5e_pport_stats *pstats = &priv->stats.pport;\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\tvoid *out;\n\tint prio;\n\n\tif (!MLX5_CAP_GEN(mdev, sbcam_reg))\n\t\treturn;\n\n\tMLX5_SET(ppcnt_reg, in, pnat, 2);\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PER_TRAFFIC_CLASS_CONGESTION_GROUP);\n\tfor (prio = 0; prio < NUM_PPORT_PRIO; prio++) {\n\t\tout = pstats->per_tc_congest_prio_counters[prio];\n\t\tMLX5_SET(ppcnt_reg, in, prio_tc, prio);\n\t\tmlx5_core_access_reg(mdev, in, sz, out, sz, MLX5_REG_PPCNT, 0, 0);\n\t}\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(per_port_buff_congest)\n{\n\treturn mlx5e_grp_per_tc_prio_get_num_stats(priv) +\n\t\tmlx5e_grp_per_tc_congest_prio_get_num_stats(priv);\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(per_port_buff_congest)\n{\n\tmlx5e_grp_per_tc_prio_update_stats(priv);\n\tmlx5e_grp_per_tc_congest_prio_update_stats(priv);\n}\n\n#define PPORT_PER_PRIO_OFF(c) \\\n\tMLX5_BYTE_OFF(ppcnt_reg, \\\n\t\t      counter_set.eth_per_prio_grp_data_layout.c##_high)\nstatic const struct counter_desc pport_per_prio_traffic_stats_desc[] = {\n\t{ \"rx_prio%d_bytes\", PPORT_PER_PRIO_OFF(rx_octets) },\n\t{ \"rx_prio%d_packets\", PPORT_PER_PRIO_OFF(rx_frames) },\n\t{ \"rx_prio%d_discards\", PPORT_PER_PRIO_OFF(rx_discards) },\n\t{ \"tx_prio%d_bytes\", PPORT_PER_PRIO_OFF(tx_octets) },\n\t{ \"tx_prio%d_packets\", PPORT_PER_PRIO_OFF(tx_frames) },\n};\n\n#define NUM_PPORT_PER_PRIO_TRAFFIC_COUNTERS\tARRAY_SIZE(pport_per_prio_traffic_stats_desc)\n\nstatic int mlx5e_grp_per_prio_traffic_get_num_stats(void)\n{\n\treturn NUM_PPORT_PER_PRIO_TRAFFIC_COUNTERS * NUM_PPORT_PRIO;\n}\n\nstatic int mlx5e_grp_per_prio_traffic_fill_strings(struct mlx5e_priv *priv,\n\t\t\t\t\t\t   u8 *data,\n\t\t\t\t\t\t   int idx)\n{\n\tint i, prio;\n\n\tfor (prio = 0; prio < NUM_PPORT_PRIO; prio++) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_PRIO_TRAFFIC_COUNTERS; i++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tpport_per_prio_traffic_stats_desc[i].format, prio);\n\t}\n\n\treturn idx;\n}\n\nstatic int mlx5e_grp_per_prio_traffic_fill_stats(struct mlx5e_priv *priv,\n\t\t\t\t\t\t u64 *data,\n\t\t\t\t\t\t int idx)\n{\n\tint i, prio;\n\n\tfor (prio = 0; prio < NUM_PPORT_PRIO; prio++) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_PRIO_TRAFFIC_COUNTERS; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&priv->stats.pport.per_prio_counters[prio],\n\t\t\t\t\t\t    pport_per_prio_traffic_stats_desc, i);\n\t}\n\n\treturn idx;\n}\n\nstatic const struct counter_desc pport_per_prio_pfc_stats_desc[] = {\n\t \n\t{ \"rx_%s_pause\", PPORT_PER_PRIO_OFF(rx_pause) },\n\t{ \"rx_%s_pause_duration\", PPORT_PER_PRIO_OFF(rx_pause_duration) },\n\t{ \"tx_%s_pause\", PPORT_PER_PRIO_OFF(tx_pause) },\n\t{ \"tx_%s_pause_duration\", PPORT_PER_PRIO_OFF(tx_pause_duration) },\n\t{ \"rx_%s_pause_transition\", PPORT_PER_PRIO_OFF(rx_pause_transition) },\n};\n\nstatic const struct counter_desc pport_pfc_stall_stats_desc[] = {\n\t{ \"tx_pause_storm_warning_events\", PPORT_PER_PRIO_OFF(device_stall_minor_watermark_cnt) },\n\t{ \"tx_pause_storm_error_events\", PPORT_PER_PRIO_OFF(device_stall_critical_watermark_cnt) },\n};\n\n#define NUM_PPORT_PER_PRIO_PFC_COUNTERS\t\tARRAY_SIZE(pport_per_prio_pfc_stats_desc)\n#define NUM_PPORT_PFC_STALL_COUNTERS(priv)\t(ARRAY_SIZE(pport_pfc_stall_stats_desc) * \\\n\t\t\t\t\t\t MLX5_CAP_PCAM_FEATURE((priv)->mdev, pfcc_mask) * \\\n\t\t\t\t\t\t MLX5_CAP_DEBUG((priv)->mdev, stall_detect))\n\nstatic unsigned long mlx5e_query_pfc_combined(struct mlx5e_priv *priv)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu8 pfc_en_tx;\n\tu8 pfc_en_rx;\n\tint err;\n\n\tif (MLX5_CAP_GEN(mdev, port_type) != MLX5_CAP_PORT_TYPE_ETH)\n\t\treturn 0;\n\n\terr = mlx5_query_port_pfc(mdev, &pfc_en_tx, &pfc_en_rx);\n\n\treturn err ? 0 : pfc_en_tx | pfc_en_rx;\n}\n\nstatic bool mlx5e_query_global_pause_combined(struct mlx5e_priv *priv)\n{\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 rx_pause;\n\tu32 tx_pause;\n\tint err;\n\n\tif (MLX5_CAP_GEN(mdev, port_type) != MLX5_CAP_PORT_TYPE_ETH)\n\t\treturn false;\n\n\terr = mlx5_query_port_pause(mdev, &rx_pause, &tx_pause);\n\n\treturn err ? false : rx_pause | tx_pause;\n}\n\nstatic int mlx5e_grp_per_prio_pfc_get_num_stats(struct mlx5e_priv *priv)\n{\n\treturn (mlx5e_query_global_pause_combined(priv) +\n\t\thweight8(mlx5e_query_pfc_combined(priv))) *\n\t\tNUM_PPORT_PER_PRIO_PFC_COUNTERS +\n\t\tNUM_PPORT_PFC_STALL_COUNTERS(priv);\n}\n\nstatic int mlx5e_grp_per_prio_pfc_fill_strings(struct mlx5e_priv *priv,\n\t\t\t\t\t       u8 *data,\n\t\t\t\t\t       int idx)\n{\n\tunsigned long pfc_combined;\n\tint i, prio;\n\n\tpfc_combined = mlx5e_query_pfc_combined(priv);\n\tfor_each_set_bit(prio, &pfc_combined, NUM_PPORT_PRIO) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_PRIO_PFC_COUNTERS; i++) {\n\t\t\tchar pfc_string[ETH_GSTRING_LEN];\n\n\t\t\tsnprintf(pfc_string, sizeof(pfc_string), \"prio%d\", prio);\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tpport_per_prio_pfc_stats_desc[i].format, pfc_string);\n\t\t}\n\t}\n\n\tif (mlx5e_query_global_pause_combined(priv)) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_PRIO_PFC_COUNTERS; i++) {\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tpport_per_prio_pfc_stats_desc[i].format, \"global\");\n\t\t}\n\t}\n\n\tfor (i = 0; i < NUM_PPORT_PFC_STALL_COUNTERS(priv); i++)\n\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN,\n\t\t       pport_pfc_stall_stats_desc[i].format);\n\n\treturn idx;\n}\n\nstatic int mlx5e_grp_per_prio_pfc_fill_stats(struct mlx5e_priv *priv,\n\t\t\t\t\t     u64 *data,\n\t\t\t\t\t     int idx)\n{\n\tunsigned long pfc_combined;\n\tint i, prio;\n\n\tpfc_combined = mlx5e_query_pfc_combined(priv);\n\tfor_each_set_bit(prio, &pfc_combined, NUM_PPORT_PRIO) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_PRIO_PFC_COUNTERS; i++) {\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&priv->stats.pport.per_prio_counters[prio],\n\t\t\t\t\t\t    pport_per_prio_pfc_stats_desc, i);\n\t\t}\n\t}\n\n\tif (mlx5e_query_global_pause_combined(priv)) {\n\t\tfor (i = 0; i < NUM_PPORT_PER_PRIO_PFC_COUNTERS; i++) {\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_BE(&priv->stats.pport.per_prio_counters[0],\n\t\t\t\t\t\t    pport_per_prio_pfc_stats_desc, i);\n\t\t}\n\t}\n\n\tfor (i = 0; i < NUM_PPORT_PFC_STALL_COUNTERS(priv); i++)\n\t\tdata[idx++] = MLX5E_READ_CTR64_BE(&priv->stats.pport.per_prio_counters[0],\n\t\t\t\t\t\t  pport_pfc_stall_stats_desc, i);\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(per_prio)\n{\n\treturn mlx5e_grp_per_prio_traffic_get_num_stats() +\n\t\tmlx5e_grp_per_prio_pfc_get_num_stats(priv);\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(per_prio)\n{\n\tidx = mlx5e_grp_per_prio_traffic_fill_strings(priv, data, idx);\n\tidx = mlx5e_grp_per_prio_pfc_fill_strings(priv, data, idx);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(per_prio)\n{\n\tidx = mlx5e_grp_per_prio_traffic_fill_stats(priv, data, idx);\n\tidx = mlx5e_grp_per_prio_pfc_fill_stats(priv, data, idx);\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(per_prio)\n{\n\tstruct mlx5e_pport_stats *pstats = &priv->stats.pport;\n\tstruct mlx5_core_dev *mdev = priv->mdev;\n\tu32 in[MLX5_ST_SZ_DW(ppcnt_reg)] = {0};\n\tint sz = MLX5_ST_SZ_BYTES(ppcnt_reg);\n\tint prio;\n\tvoid *out;\n\n\tif (!MLX5_BASIC_PPCNT_SUPPORTED(mdev))\n\t\treturn;\n\n\tMLX5_SET(ppcnt_reg, in, local_port, 1);\n\tMLX5_SET(ppcnt_reg, in, grp, MLX5_PER_PRIORITY_COUNTERS_GROUP);\n\tfor (prio = 0; prio < NUM_PPORT_PRIO; prio++) {\n\t\tout = pstats->per_prio_counters[prio];\n\t\tMLX5_SET(ppcnt_reg, in, prio_tc, prio);\n\t\tmlx5_core_access_reg(mdev, in, sz, out, sz,\n\t\t\t\t     MLX5_REG_PPCNT, 0, 0);\n\t}\n}\n\nstatic const struct counter_desc mlx5e_pme_status_desc[] = {\n\t{ \"module_unplug\",       sizeof(u64) * MLX5_MODULE_STATUS_UNPLUGGED },\n};\n\nstatic const struct counter_desc mlx5e_pme_error_desc[] = {\n\t{ \"module_bus_stuck\",    sizeof(u64) * MLX5_MODULE_EVENT_ERROR_BUS_STUCK },\n\t{ \"module_high_temp\",    sizeof(u64) * MLX5_MODULE_EVENT_ERROR_HIGH_TEMPERATURE },\n\t{ \"module_bad_shorted\",  sizeof(u64) * MLX5_MODULE_EVENT_ERROR_BAD_CABLE },\n};\n\n#define NUM_PME_STATUS_STATS\t\tARRAY_SIZE(mlx5e_pme_status_desc)\n#define NUM_PME_ERR_STATS\t\tARRAY_SIZE(mlx5e_pme_error_desc)\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(pme)\n{\n\treturn NUM_PME_STATUS_STATS + NUM_PME_ERR_STATS;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(pme)\n{\n\tint i;\n\n\tfor (i = 0; i < NUM_PME_STATUS_STATS; i++)\n\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN, mlx5e_pme_status_desc[i].format);\n\n\tfor (i = 0; i < NUM_PME_ERR_STATS; i++)\n\t\tstrcpy(data + (idx++) * ETH_GSTRING_LEN, mlx5e_pme_error_desc[i].format);\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(pme)\n{\n\tstruct mlx5_pme_stats pme_stats;\n\tint i;\n\n\tmlx5_get_pme_stats(priv->mdev, &pme_stats);\n\n\tfor (i = 0; i < NUM_PME_STATUS_STATS; i++)\n\t\tdata[idx++] = MLX5E_READ_CTR64_CPU(pme_stats.status_counters,\n\t\t\t\t\t\t   mlx5e_pme_status_desc, i);\n\n\tfor (i = 0; i < NUM_PME_ERR_STATS; i++)\n\t\tdata[idx++] = MLX5E_READ_CTR64_CPU(pme_stats.error_counters,\n\t\t\t\t\t\t   mlx5e_pme_error_desc, i);\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(pme) { return; }\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(tls)\n{\n\treturn mlx5e_ktls_get_count(priv);\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(tls)\n{\n\treturn idx + mlx5e_ktls_get_strings(priv, data + idx * ETH_GSTRING_LEN);\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(tls)\n{\n\treturn idx + mlx5e_ktls_get_stats(priv, data + idx);\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(tls) { return; }\n\nstatic const struct counter_desc rq_stats_desc[] = {\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, packets) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, bytes) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, csum_complete) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, csum_complete_tail) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, csum_complete_tail_slow) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, csum_unnecessary) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, csum_unnecessary_inner) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, csum_none) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, xdp_drop) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, xdp_redirect) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, lro_packets) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, lro_bytes) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, gro_packets) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, gro_bytes) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, gro_skbs) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, gro_match_packets) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, gro_large_hds) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, ecn_mark) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, removed_vlan_packets) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, wqe_err) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, mpwqe_filler_cqes) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, mpwqe_filler_strides) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, oversize_pkts_sw_drop) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, buff_alloc_err) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, cqe_compress_blks) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, cqe_compress_pkts) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, congst_umr) },\n#ifdef CONFIG_MLX5_EN_ARFS\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, arfs_add) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, arfs_request_in) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, arfs_request_out) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, arfs_expired) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, arfs_err) },\n#endif\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, recover) },\n#ifdef CONFIG_PAGE_POOL_STATS\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_alloc_fast) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_alloc_slow) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_alloc_slow_high_order) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_alloc_empty) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_alloc_refill) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_alloc_waive) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_recycle_cached) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_recycle_cache_full) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_recycle_ring) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_recycle_ring_full) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, pp_recycle_released_ref) },\n#endif\n#ifdef CONFIG_MLX5_EN_TLS\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_decrypted_packets) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_decrypted_bytes) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_resync_req_pkt) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_resync_req_start) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_resync_req_end) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_resync_req_skip) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_resync_res_ok) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_resync_res_retry) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_resync_res_skip) },\n\t{ MLX5E_DECLARE_RX_STAT(struct mlx5e_rq_stats, tls_err) },\n#endif\n};\n\nstatic const struct counter_desc sq_stats_desc[] = {\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, packets) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, bytes) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tso_packets) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tso_bytes) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tso_inner_packets) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tso_inner_bytes) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, csum_partial) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, csum_partial_inner) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, added_vlan_packets) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, nop) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, mpwqe_blks) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, mpwqe_pkts) },\n#ifdef CONFIG_MLX5_EN_TLS\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_encrypted_packets) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_encrypted_bytes) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_ooo) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_dump_packets) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_dump_bytes) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_resync_bytes) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_skip_no_sync_data) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_drop_no_sync_data) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, tls_drop_bypass_req) },\n#endif\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, csum_none) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, stopped) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, dropped) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, xmit_more) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, recover) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, cqes) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, wake) },\n\t{ MLX5E_DECLARE_TX_STAT(struct mlx5e_sq_stats, cqe_err) },\n};\n\nstatic const struct counter_desc rq_xdpsq_stats_desc[] = {\n\t{ MLX5E_DECLARE_RQ_XDPSQ_STAT(struct mlx5e_xdpsq_stats, xmit) },\n\t{ MLX5E_DECLARE_RQ_XDPSQ_STAT(struct mlx5e_xdpsq_stats, mpwqe) },\n\t{ MLX5E_DECLARE_RQ_XDPSQ_STAT(struct mlx5e_xdpsq_stats, inlnw) },\n\t{ MLX5E_DECLARE_RQ_XDPSQ_STAT(struct mlx5e_xdpsq_stats, nops) },\n\t{ MLX5E_DECLARE_RQ_XDPSQ_STAT(struct mlx5e_xdpsq_stats, full) },\n\t{ MLX5E_DECLARE_RQ_XDPSQ_STAT(struct mlx5e_xdpsq_stats, err) },\n\t{ MLX5E_DECLARE_RQ_XDPSQ_STAT(struct mlx5e_xdpsq_stats, cqes) },\n};\n\nstatic const struct counter_desc xdpsq_stats_desc[] = {\n\t{ MLX5E_DECLARE_XDPSQ_STAT(struct mlx5e_xdpsq_stats, xmit) },\n\t{ MLX5E_DECLARE_XDPSQ_STAT(struct mlx5e_xdpsq_stats, mpwqe) },\n\t{ MLX5E_DECLARE_XDPSQ_STAT(struct mlx5e_xdpsq_stats, inlnw) },\n\t{ MLX5E_DECLARE_XDPSQ_STAT(struct mlx5e_xdpsq_stats, nops) },\n\t{ MLX5E_DECLARE_XDPSQ_STAT(struct mlx5e_xdpsq_stats, full) },\n\t{ MLX5E_DECLARE_XDPSQ_STAT(struct mlx5e_xdpsq_stats, err) },\n\t{ MLX5E_DECLARE_XDPSQ_STAT(struct mlx5e_xdpsq_stats, cqes) },\n};\n\nstatic const struct counter_desc xskrq_stats_desc[] = {\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, packets) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, bytes) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, csum_complete) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, csum_unnecessary) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, csum_unnecessary_inner) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, csum_none) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, ecn_mark) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, removed_vlan_packets) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, xdp_drop) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, xdp_redirect) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, wqe_err) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, mpwqe_filler_cqes) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, mpwqe_filler_strides) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, oversize_pkts_sw_drop) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, buff_alloc_err) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, cqe_compress_blks) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, cqe_compress_pkts) },\n\t{ MLX5E_DECLARE_XSKRQ_STAT(struct mlx5e_rq_stats, congst_umr) },\n};\n\nstatic const struct counter_desc xsksq_stats_desc[] = {\n\t{ MLX5E_DECLARE_XSKSQ_STAT(struct mlx5e_xdpsq_stats, xmit) },\n\t{ MLX5E_DECLARE_XSKSQ_STAT(struct mlx5e_xdpsq_stats, mpwqe) },\n\t{ MLX5E_DECLARE_XSKSQ_STAT(struct mlx5e_xdpsq_stats, inlnw) },\n\t{ MLX5E_DECLARE_XSKSQ_STAT(struct mlx5e_xdpsq_stats, full) },\n\t{ MLX5E_DECLARE_XSKSQ_STAT(struct mlx5e_xdpsq_stats, err) },\n\t{ MLX5E_DECLARE_XSKSQ_STAT(struct mlx5e_xdpsq_stats, cqes) },\n};\n\nstatic const struct counter_desc ch_stats_desc[] = {\n\t{ MLX5E_DECLARE_CH_STAT(struct mlx5e_ch_stats, events) },\n\t{ MLX5E_DECLARE_CH_STAT(struct mlx5e_ch_stats, poll) },\n\t{ MLX5E_DECLARE_CH_STAT(struct mlx5e_ch_stats, arm) },\n\t{ MLX5E_DECLARE_CH_STAT(struct mlx5e_ch_stats, aff_change) },\n\t{ MLX5E_DECLARE_CH_STAT(struct mlx5e_ch_stats, force_irq) },\n\t{ MLX5E_DECLARE_CH_STAT(struct mlx5e_ch_stats, eq_rearm) },\n};\n\nstatic const struct counter_desc ptp_sq_stats_desc[] = {\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, packets) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, bytes) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, csum_partial) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, csum_partial_inner) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, added_vlan_packets) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, nop) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, csum_none) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, stopped) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, dropped) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, xmit_more) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, recover) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, cqes) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, wake) },\n\t{ MLX5E_DECLARE_PTP_TX_STAT(struct mlx5e_sq_stats, cqe_err) },\n};\n\nstatic const struct counter_desc ptp_ch_stats_desc[] = {\n\t{ MLX5E_DECLARE_PTP_CH_STAT(struct mlx5e_ch_stats, events) },\n\t{ MLX5E_DECLARE_PTP_CH_STAT(struct mlx5e_ch_stats, poll) },\n\t{ MLX5E_DECLARE_PTP_CH_STAT(struct mlx5e_ch_stats, arm) },\n\t{ MLX5E_DECLARE_PTP_CH_STAT(struct mlx5e_ch_stats, eq_rearm) },\n};\n\nstatic const struct counter_desc ptp_cq_stats_desc[] = {\n\t{ MLX5E_DECLARE_PTP_CQ_STAT(struct mlx5e_ptp_cq_stats, cqe) },\n\t{ MLX5E_DECLARE_PTP_CQ_STAT(struct mlx5e_ptp_cq_stats, err_cqe) },\n\t{ MLX5E_DECLARE_PTP_CQ_STAT(struct mlx5e_ptp_cq_stats, abort) },\n\t{ MLX5E_DECLARE_PTP_CQ_STAT(struct mlx5e_ptp_cq_stats, abort_abs_diff_ns) },\n\t{ MLX5E_DECLARE_PTP_CQ_STAT(struct mlx5e_ptp_cq_stats, late_cqe) },\n};\n\nstatic const struct counter_desc ptp_rq_stats_desc[] = {\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, packets) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, bytes) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, csum_complete) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, csum_complete_tail) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, csum_complete_tail_slow) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, csum_unnecessary) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, csum_unnecessary_inner) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, csum_none) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, xdp_drop) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, xdp_redirect) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, lro_packets) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, lro_bytes) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, ecn_mark) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, removed_vlan_packets) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, wqe_err) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, mpwqe_filler_cqes) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, mpwqe_filler_strides) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, oversize_pkts_sw_drop) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, buff_alloc_err) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, cqe_compress_blks) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, cqe_compress_pkts) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, congst_umr) },\n\t{ MLX5E_DECLARE_PTP_RQ_STAT(struct mlx5e_rq_stats, recover) },\n};\n\nstatic const struct counter_desc qos_sq_stats_desc[] = {\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, packets) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, bytes) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tso_packets) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tso_bytes) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tso_inner_packets) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tso_inner_bytes) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, csum_partial) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, csum_partial_inner) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, added_vlan_packets) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, nop) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, mpwqe_blks) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, mpwqe_pkts) },\n#ifdef CONFIG_MLX5_EN_TLS\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_encrypted_packets) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_encrypted_bytes) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_ooo) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_dump_packets) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_dump_bytes) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_resync_bytes) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_skip_no_sync_data) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_drop_no_sync_data) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, tls_drop_bypass_req) },\n#endif\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, csum_none) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, stopped) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, dropped) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, xmit_more) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, recover) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, cqes) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, wake) },\n\t{ MLX5E_DECLARE_QOS_TX_STAT(struct mlx5e_sq_stats, cqe_err) },\n};\n\n#define NUM_RQ_STATS\t\t\tARRAY_SIZE(rq_stats_desc)\n#define NUM_SQ_STATS\t\t\tARRAY_SIZE(sq_stats_desc)\n#define NUM_XDPSQ_STATS\t\t\tARRAY_SIZE(xdpsq_stats_desc)\n#define NUM_RQ_XDPSQ_STATS\t\tARRAY_SIZE(rq_xdpsq_stats_desc)\n#define NUM_XSKRQ_STATS\t\t\tARRAY_SIZE(xskrq_stats_desc)\n#define NUM_XSKSQ_STATS\t\t\tARRAY_SIZE(xsksq_stats_desc)\n#define NUM_CH_STATS\t\t\tARRAY_SIZE(ch_stats_desc)\n#define NUM_PTP_SQ_STATS\t\tARRAY_SIZE(ptp_sq_stats_desc)\n#define NUM_PTP_CH_STATS\t\tARRAY_SIZE(ptp_ch_stats_desc)\n#define NUM_PTP_CQ_STATS\t\tARRAY_SIZE(ptp_cq_stats_desc)\n#define NUM_PTP_RQ_STATS                ARRAY_SIZE(ptp_rq_stats_desc)\n#define NUM_QOS_SQ_STATS\t\tARRAY_SIZE(qos_sq_stats_desc)\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(qos)\n{\n\t \n\treturn NUM_QOS_SQ_STATS * smp_load_acquire(&priv->htb_max_qos_sqs);\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(qos)\n{\n\t \n\tu16 max_qos_sqs = smp_load_acquire(&priv->htb_max_qos_sqs);\n\tint i, qid;\n\n\tfor (qid = 0; qid < max_qos_sqs; qid++)\n\t\tfor (i = 0; i < NUM_QOS_SQ_STATS; i++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tqos_sq_stats_desc[i].format, qid);\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(qos)\n{\n\tstruct mlx5e_sq_stats **stats;\n\tu16 max_qos_sqs;\n\tint i, qid;\n\n\t \n\tmax_qos_sqs = smp_load_acquire(&priv->htb_max_qos_sqs);\n\tstats = READ_ONCE(priv->htb_qos_sq_stats);\n\n\tfor (qid = 0; qid < max_qos_sqs; qid++) {\n\t\tstruct mlx5e_sq_stats *s = READ_ONCE(stats[qid]);\n\n\t\tfor (i = 0; i < NUM_QOS_SQ_STATS; i++)\n\t\t\tdata[idx++] = MLX5E_READ_CTR64_CPU(s, qos_sq_stats_desc, i);\n\t}\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(qos) { return; }\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(ptp)\n{\n\tint num = NUM_PTP_CH_STATS;\n\n\tif (!priv->tx_ptp_opened && !priv->rx_ptp_opened)\n\t\treturn 0;\n\n\tif (priv->tx_ptp_opened)\n\t\tnum += (NUM_PTP_SQ_STATS + NUM_PTP_CQ_STATS) * priv->max_opened_tc;\n\tif (priv->rx_ptp_opened)\n\t\tnum += NUM_PTP_RQ_STATS;\n\n\treturn num;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(ptp)\n{\n\tint i, tc;\n\n\tif (!priv->tx_ptp_opened && !priv->rx_ptp_opened)\n\t\treturn idx;\n\n\tfor (i = 0; i < NUM_PTP_CH_STATS; i++)\n\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\"%s\", ptp_ch_stats_desc[i].format);\n\n\tif (priv->tx_ptp_opened) {\n\t\tfor (tc = 0; tc < priv->max_opened_tc; tc++)\n\t\t\tfor (i = 0; i < NUM_PTP_SQ_STATS; i++)\n\t\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\t\tptp_sq_stats_desc[i].format, tc);\n\n\t\tfor (tc = 0; tc < priv->max_opened_tc; tc++)\n\t\t\tfor (i = 0; i < NUM_PTP_CQ_STATS; i++)\n\t\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\t\tptp_cq_stats_desc[i].format, tc);\n\t}\n\tif (priv->rx_ptp_opened) {\n\t\tfor (i = 0; i < NUM_PTP_RQ_STATS; i++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tptp_rq_stats_desc[i].format, MLX5E_PTP_CHANNEL_IX);\n\t}\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(ptp)\n{\n\tint i, tc;\n\n\tif (!priv->tx_ptp_opened && !priv->rx_ptp_opened)\n\t\treturn idx;\n\n\tfor (i = 0; i < NUM_PTP_CH_STATS; i++)\n\t\tdata[idx++] =\n\t\t\tMLX5E_READ_CTR64_CPU(&priv->ptp_stats.ch,\n\t\t\t\t\t     ptp_ch_stats_desc, i);\n\n\tif (priv->tx_ptp_opened) {\n\t\tfor (tc = 0; tc < priv->max_opened_tc; tc++)\n\t\t\tfor (i = 0; i < NUM_PTP_SQ_STATS; i++)\n\t\t\t\tdata[idx++] =\n\t\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->ptp_stats.sq[tc],\n\t\t\t\t\t\t\t     ptp_sq_stats_desc, i);\n\n\t\tfor (tc = 0; tc < priv->max_opened_tc; tc++)\n\t\t\tfor (i = 0; i < NUM_PTP_CQ_STATS; i++)\n\t\t\t\tdata[idx++] =\n\t\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->ptp_stats.cq[tc],\n\t\t\t\t\t\t\t     ptp_cq_stats_desc, i);\n\t}\n\tif (priv->rx_ptp_opened) {\n\t\tfor (i = 0; i < NUM_PTP_RQ_STATS; i++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->ptp_stats.rq,\n\t\t\t\t\t\t     ptp_rq_stats_desc, i);\n\t}\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(ptp) { return; }\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_NUM_STATS(channels)\n{\n\tint max_nch = priv->stats_nch;\n\n\treturn (NUM_RQ_STATS * max_nch) +\n\t       (NUM_CH_STATS * max_nch) +\n\t       (NUM_SQ_STATS * max_nch * priv->max_opened_tc) +\n\t       (NUM_RQ_XDPSQ_STATS * max_nch) +\n\t       (NUM_XDPSQ_STATS * max_nch) +\n\t       (NUM_XSKRQ_STATS * max_nch * priv->xsk.ever_used) +\n\t       (NUM_XSKSQ_STATS * max_nch * priv->xsk.ever_used);\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STRS(channels)\n{\n\tbool is_xsk = priv->xsk.ever_used;\n\tint max_nch = priv->stats_nch;\n\tint i, j, tc;\n\n\tfor (i = 0; i < max_nch; i++)\n\t\tfor (j = 0; j < NUM_CH_STATS; j++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\tch_stats_desc[j].format, i);\n\n\tfor (i = 0; i < max_nch; i++) {\n\t\tfor (j = 0; j < NUM_RQ_STATS; j++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\trq_stats_desc[j].format, i);\n\t\tfor (j = 0; j < NUM_XSKRQ_STATS * is_xsk; j++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\txskrq_stats_desc[j].format, i);\n\t\tfor (j = 0; j < NUM_RQ_XDPSQ_STATS; j++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\trq_xdpsq_stats_desc[j].format, i);\n\t}\n\n\tfor (tc = 0; tc < priv->max_opened_tc; tc++)\n\t\tfor (i = 0; i < max_nch; i++)\n\t\t\tfor (j = 0; j < NUM_SQ_STATS; j++)\n\t\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\t\tsq_stats_desc[j].format,\n\t\t\t\t\ti + tc * max_nch);\n\n\tfor (i = 0; i < max_nch; i++) {\n\t\tfor (j = 0; j < NUM_XSKSQ_STATS * is_xsk; j++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\txsksq_stats_desc[j].format, i);\n\t\tfor (j = 0; j < NUM_XDPSQ_STATS; j++)\n\t\t\tsprintf(data + (idx++) * ETH_GSTRING_LEN,\n\t\t\t\txdpsq_stats_desc[j].format, i);\n\t}\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_FILL_STATS(channels)\n{\n\tbool is_xsk = priv->xsk.ever_used;\n\tint max_nch = priv->stats_nch;\n\tint i, j, tc;\n\n\tfor (i = 0; i < max_nch; i++)\n\t\tfor (j = 0; j < NUM_CH_STATS; j++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->channel_stats[i]->ch,\n\t\t\t\t\t\t     ch_stats_desc, j);\n\n\tfor (i = 0; i < max_nch; i++) {\n\t\tfor (j = 0; j < NUM_RQ_STATS; j++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->channel_stats[i]->rq,\n\t\t\t\t\t\t     rq_stats_desc, j);\n\t\tfor (j = 0; j < NUM_XSKRQ_STATS * is_xsk; j++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->channel_stats[i]->xskrq,\n\t\t\t\t\t\t     xskrq_stats_desc, j);\n\t\tfor (j = 0; j < NUM_RQ_XDPSQ_STATS; j++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->channel_stats[i]->rq_xdpsq,\n\t\t\t\t\t\t     rq_xdpsq_stats_desc, j);\n\t}\n\n\tfor (tc = 0; tc < priv->max_opened_tc; tc++)\n\t\tfor (i = 0; i < max_nch; i++)\n\t\t\tfor (j = 0; j < NUM_SQ_STATS; j++)\n\t\t\t\tdata[idx++] =\n\t\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->channel_stats[i]->sq[tc],\n\t\t\t\t\t\t\t     sq_stats_desc, j);\n\n\tfor (i = 0; i < max_nch; i++) {\n\t\tfor (j = 0; j < NUM_XSKSQ_STATS * is_xsk; j++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->channel_stats[i]->xsksq,\n\t\t\t\t\t\t     xsksq_stats_desc, j);\n\t\tfor (j = 0; j < NUM_XDPSQ_STATS; j++)\n\t\t\tdata[idx++] =\n\t\t\t\tMLX5E_READ_CTR64_CPU(&priv->channel_stats[i]->xdpsq,\n\t\t\t\t\t\t     xdpsq_stats_desc, j);\n\t}\n\n\treturn idx;\n}\n\nstatic MLX5E_DECLARE_STATS_GRP_OP_UPDATE_STATS(channels) { return; }\n\nMLX5E_DEFINE_STATS_GRP(sw, 0);\nMLX5E_DEFINE_STATS_GRP(qcnt, MLX5E_NDO_UPDATE_STATS);\nMLX5E_DEFINE_STATS_GRP(vnic_env, 0);\nMLX5E_DEFINE_STATS_GRP(vport, MLX5E_NDO_UPDATE_STATS);\nMLX5E_DEFINE_STATS_GRP(802_3, MLX5E_NDO_UPDATE_STATS);\nMLX5E_DEFINE_STATS_GRP(2863, 0);\nMLX5E_DEFINE_STATS_GRP(2819, 0);\nMLX5E_DEFINE_STATS_GRP(phy, 0);\nMLX5E_DEFINE_STATS_GRP(pcie, 0);\nMLX5E_DEFINE_STATS_GRP(per_prio, 0);\nMLX5E_DEFINE_STATS_GRP(pme, 0);\nMLX5E_DEFINE_STATS_GRP(channels, 0);\nMLX5E_DEFINE_STATS_GRP(per_port_buff_congest, 0);\nMLX5E_DEFINE_STATS_GRP(eth_ext, 0);\nstatic MLX5E_DEFINE_STATS_GRP(tls, 0);\nMLX5E_DEFINE_STATS_GRP(ptp, 0);\nstatic MLX5E_DEFINE_STATS_GRP(qos, 0);\n\n \nmlx5e_stats_grp_t mlx5e_nic_stats_grps[] = {\n\t&MLX5E_STATS_GRP(sw),\n\t&MLX5E_STATS_GRP(qcnt),\n\t&MLX5E_STATS_GRP(vnic_env),\n\t&MLX5E_STATS_GRP(vport),\n\t&MLX5E_STATS_GRP(802_3),\n\t&MLX5E_STATS_GRP(2863),\n\t&MLX5E_STATS_GRP(2819),\n\t&MLX5E_STATS_GRP(phy),\n\t&MLX5E_STATS_GRP(eth_ext),\n\t&MLX5E_STATS_GRP(pcie),\n\t&MLX5E_STATS_GRP(per_prio),\n\t&MLX5E_STATS_GRP(pme),\n#ifdef CONFIG_MLX5_EN_IPSEC\n\t&MLX5E_STATS_GRP(ipsec_hw),\n\t&MLX5E_STATS_GRP(ipsec_sw),\n#endif\n\t&MLX5E_STATS_GRP(tls),\n\t&MLX5E_STATS_GRP(channels),\n\t&MLX5E_STATS_GRP(per_port_buff_congest),\n\t&MLX5E_STATS_GRP(ptp),\n\t&MLX5E_STATS_GRP(qos),\n#ifdef CONFIG_MLX5_MACSEC\n\t&MLX5E_STATS_GRP(macsec_hw),\n#endif\n};\n\nunsigned int mlx5e_nic_stats_grps_num(struct mlx5e_priv *priv)\n{\n\treturn ARRAY_SIZE(mlx5e_nic_stats_grps);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}