{
  "module_name": "fw_tracer.h",
  "hash_id": "610cf4c8e30b6ccc2179b19492ec24a98680b0a4bc18e6db16107524dae943bf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/diag/fw_tracer.h",
  "human_readable_source": " \n\n#ifndef __LIB_TRACER_H__\n#define __LIB_TRACER_H__\n\n#include <linux/mlx5/driver.h>\n#include \"mlx5_core.h\"\n\n#define STRINGS_DB_SECTIONS_NUM 8\n#define STRINGS_DB_READ_SIZE_BYTES 256\n#define STRINGS_DB_LEFTOVER_SIZE_BYTES 64\n#define TRACER_BUFFER_PAGE_NUM 64\n#define TRACER_BUFFER_CHUNK 4096\n#define TRACE_BUFFER_SIZE_BYTE (TRACER_BUFFER_PAGE_NUM * TRACER_BUFFER_CHUNK)\n\n#define TRACER_BLOCK_SIZE_BYTE 256\n#define TRACES_PER_BLOCK 32\n\n#define TRACE_STR_MSG 256\n#define SAVED_TRACES_NUM 8192\n\n#define TRACER_MAX_PARAMS 7\n#define MESSAGE_HASH_BITS 6\n#define MESSAGE_HASH_SIZE BIT(MESSAGE_HASH_BITS)\n\n#define MASK_52_7 (0x1FFFFFFFFFFF80)\n#define MASK_6_0  (0x7F)\n\nstruct mlx5_fw_trace_data {\n\tu64 timestamp;\n\tbool lost;\n\tu8 event_id;\n\tchar msg[TRACE_STR_MSG];\n};\n\nenum mlx5_fw_tracer_state {\n\tMLX5_TRACER_STATE_UP = BIT(0),\n\tMLX5_TRACER_RECREATE_DB = BIT(1),\n};\n\nstruct mlx5_fw_tracer {\n\tstruct mlx5_core_dev *dev;\n\tstruct mlx5_nb        nb;\n\tbool owner;\n\tu8   trc_ver;\n\tstruct workqueue_struct *work_queue;\n\tstruct work_struct ownership_change_work;\n\tstruct work_struct read_fw_strings_work;\n\n\t \n\tstruct {\n\t\tu8 first_string_trace;\n\t\tu8 num_string_trace;\n\t\tu32 num_string_db;\n\t\tu32 base_address_out[STRINGS_DB_SECTIONS_NUM];\n\t\tu32 size_out[STRINGS_DB_SECTIONS_NUM];\n\t\tvoid *buffer[STRINGS_DB_SECTIONS_NUM];\n\t\tbool loaded;\n\t} str_db;\n\n\t \n\tstruct {\n\t\tu32 pdn;\n\t\tvoid *log_buf;\n\t\tdma_addr_t dma;\n\t\tu32 size;\n\t\tu32 mkey;\n\t\tu32 consumer_index;\n\t} buff;\n\n\t \n\tstruct {\n\t\tstruct mlx5_fw_trace_data straces[SAVED_TRACES_NUM];\n\t\tu32 saved_traces_index;\n\t\tstruct mutex lock;  \n\t} st_arr;\n\n\tu64 last_timestamp;\n\tstruct work_struct handle_traces_work;\n\tstruct hlist_head hash[MESSAGE_HASH_SIZE];\n\tstruct list_head ready_strings_list;\n\tstruct work_struct update_db_work;\n\tstruct mutex state_lock;  \n\tunsigned long state;\n};\n\nstruct tracer_string_format {\n\tchar *string;\n\tint params[TRACER_MAX_PARAMS];\n\tint num_of_params;\n\tint last_param_num;\n\tu8 event_id;\n\tu32 tmsn;\n\tstruct hlist_node hlist;\n\tstruct list_head list;\n\tu32 timestamp;\n\tbool lost;\n};\n\nenum mlx5_fw_tracer_ownership_state {\n\tMLX5_FW_TRACER_RELEASE_OWNERSHIP,\n\tMLX5_FW_TRACER_ACQUIRE_OWNERSHIP,\n};\n\nenum tracer_ctrl_fields_select {\n\tTRACE_STATUS = 1 << 0,\n};\n\nenum tracer_event_type {\n\tTRACER_EVENT_TYPE_STRING,\n\tTRACER_EVENT_TYPE_TIMESTAMP = 0xFF,\n\tTRACER_EVENT_TYPE_UNRECOGNIZED,\n};\n\nenum tracing_mode {\n\tTRACE_TO_MEMORY = 1 << 0,\n};\n\nstruct tracer_timestamp_event {\n\tu64        timestamp;\n\tu8         unreliable;\n};\n\nstruct tracer_string_event {\n\tu32        timestamp;\n\tu32        tmsn;\n\tu32        tdsn;\n\tu32        string_param;\n};\n\nstruct tracer_event {\n\tbool      lost_event;\n\tu32       type;\n\tu8        event_id;\n\tunion {\n\t\tstruct tracer_string_event string_event;\n\t\tstruct tracer_timestamp_event timestamp_event;\n\t};\n\tu64 *out;\n};\n\nstruct mlx5_ifc_tracer_event_bits {\n\tu8         lost[0x1];\n\tu8         timestamp[0x7];\n\tu8         event_id[0x8];\n\tu8         event_data[0x30];\n};\n\nstruct mlx5_ifc_tracer_string_event_bits {\n\tu8         lost[0x1];\n\tu8         timestamp[0x7];\n\tu8         event_id[0x8];\n\tu8         tmsn[0xd];\n\tu8         tdsn[0x3];\n\tu8         string_param[0x20];\n};\n\nstruct mlx5_ifc_tracer_timestamp_event_bits {\n\tu8         timestamp7_0[0x8];\n\tu8         event_id[0x8];\n\tu8         urts[0x3];\n\tu8         timestamp52_40[0xd];\n\tu8         timestamp39_8[0x20];\n};\n\nstruct mlx5_fw_tracer *mlx5_fw_tracer_create(struct mlx5_core_dev *dev);\nint mlx5_fw_tracer_init(struct mlx5_fw_tracer *tracer);\nvoid mlx5_fw_tracer_cleanup(struct mlx5_fw_tracer *tracer);\nvoid mlx5_fw_tracer_destroy(struct mlx5_fw_tracer *tracer);\nint mlx5_fw_tracer_trigger_core_dump_general(struct mlx5_core_dev *dev);\nint mlx5_fw_tracer_get_saved_traces_objects(struct mlx5_fw_tracer *tracer,\n\t\t\t\t\t    struct devlink_fmsg *fmsg);\nint mlx5_fw_tracer_reload(struct mlx5_fw_tracer *tracer);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}