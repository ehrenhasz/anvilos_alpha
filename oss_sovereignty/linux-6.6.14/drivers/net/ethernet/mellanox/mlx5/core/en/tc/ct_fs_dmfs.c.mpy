{
  "module_name": "ct_fs_dmfs.c",
  "hash_id": "ca7480a8345951e4bed22db4dfe9d7e78af70a35b05037b548dc12c2deaea4f2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/en/tc/ct_fs_dmfs.c",
  "human_readable_source": "\n \n\n#include \"en_tc.h\"\n#include \"en/tc_ct.h\"\n#include \"en/tc/ct_fs.h\"\n\n#define ct_dbg(fmt, args...)\\\n\tnetdev_dbg(fs->netdev, \"ct_fs_dmfs debug: \" fmt \"\\n\", ##args)\n\nstruct mlx5_ct_fs_dmfs_rule {\n\tstruct mlx5_ct_fs_rule fs_rule;\n\tstruct mlx5_flow_handle *rule;\n\tstruct mlx5_flow_attr *attr;\n};\n\nstatic int\nmlx5_ct_fs_dmfs_init(struct mlx5_ct_fs *fs, struct mlx5_flow_table *ct,\n\t\t     struct mlx5_flow_table *ct_nat, struct mlx5_flow_table *post_ct)\n{\n\treturn 0;\n}\n\nstatic void\nmlx5_ct_fs_dmfs_destroy(struct mlx5_ct_fs *fs)\n{\n}\n\nstatic struct mlx5_ct_fs_rule *\nmlx5_ct_fs_dmfs_ct_rule_add(struct mlx5_ct_fs *fs, struct mlx5_flow_spec *spec,\n\t\t\t    struct mlx5_flow_attr *attr, struct flow_rule *flow_rule)\n{\n\tstruct mlx5e_priv *priv = netdev_priv(fs->netdev);\n\tstruct mlx5_ct_fs_dmfs_rule *dmfs_rule;\n\tint err;\n\n\tdmfs_rule = kzalloc(sizeof(*dmfs_rule), GFP_KERNEL);\n\tif (!dmfs_rule)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tdmfs_rule->rule = mlx5_tc_rule_insert(priv, spec, attr);\n\tif (IS_ERR(dmfs_rule->rule)) {\n\t\terr = PTR_ERR(dmfs_rule->rule);\n\t\tct_dbg(\"Failed to add ct entry fs rule\");\n\t\tgoto err_insert;\n\t}\n\n\tdmfs_rule->attr = attr;\n\n\treturn &dmfs_rule->fs_rule;\n\nerr_insert:\n\tkfree(dmfs_rule);\n\treturn ERR_PTR(err);\n}\n\nstatic void\nmlx5_ct_fs_dmfs_ct_rule_del(struct mlx5_ct_fs *fs, struct mlx5_ct_fs_rule *fs_rule)\n{\n\tstruct mlx5_ct_fs_dmfs_rule *dmfs_rule = container_of(fs_rule,\n\t\t\t\t\t\t\t      struct mlx5_ct_fs_dmfs_rule,\n\t\t\t\t\t\t\t      fs_rule);\n\n\tmlx5_tc_rule_delete(netdev_priv(fs->netdev), dmfs_rule->rule, dmfs_rule->attr);\n\tkfree(dmfs_rule);\n}\n\nstatic struct mlx5_ct_fs_ops dmfs_ops = {\n\t.ct_rule_add = mlx5_ct_fs_dmfs_ct_rule_add,\n\t.ct_rule_del = mlx5_ct_fs_dmfs_ct_rule_del,\n\n\t.init = mlx5_ct_fs_dmfs_init,\n\t.destroy = mlx5_ct_fs_dmfs_destroy,\n};\n\nstruct mlx5_ct_fs_ops *mlx5_ct_fs_dmfs_ops_get(void)\n{\n\treturn &dmfs_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}