{
  "module_name": "sdk.c",
  "hash_id": "ca6eb1607efc9f51a80df1604968990a266d52e8eb3ea6fa6b7b90a87a505665",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/fpga/sdk.c",
  "human_readable_source": " \n\n#include <linux/mlx5/device.h>\n\n#include \"fpga/core.h\"\n#include \"fpga/conn.h\"\n#include \"fpga/sdk.h\"\n\nstruct mlx5_fpga_conn *\nmlx5_fpga_sbu_conn_create(struct mlx5_fpga_device *fdev,\n\t\t\t  struct mlx5_fpga_conn_attr *attr)\n{\n\treturn mlx5_fpga_conn_create(fdev, attr, MLX5_FPGA_QPC_QP_TYPE_SANDBOX_QP);\n}\nEXPORT_SYMBOL(mlx5_fpga_sbu_conn_create);\n\nvoid mlx5_fpga_sbu_conn_destroy(struct mlx5_fpga_conn *conn)\n{\n\tmlx5_fpga_conn_destroy(conn);\n}\nEXPORT_SYMBOL(mlx5_fpga_sbu_conn_destroy);\n\nint mlx5_fpga_sbu_conn_sendmsg(struct mlx5_fpga_conn *conn,\n\t\t\t       struct mlx5_fpga_dma_buf *buf)\n{\n\treturn mlx5_fpga_conn_send(conn, buf);\n}\nEXPORT_SYMBOL(mlx5_fpga_sbu_conn_sendmsg);\n\nstatic int mlx5_fpga_mem_read_i2c(struct mlx5_fpga_device *fdev, size_t size,\n\t\t\t\t  u64 addr, u8 *buf)\n{\n\tsize_t max_size = MLX5_FPGA_ACCESS_REG_SIZE_MAX;\n\tsize_t bytes_done = 0;\n\tu8 actual_size;\n\tint err;\n\n\tif (!size)\n\t\treturn -EINVAL;\n\n\tif (!fdev->mdev)\n\t\treturn -ENOTCONN;\n\n\twhile (bytes_done < size) {\n\t\tactual_size = min(max_size, (size - bytes_done));\n\n\t\terr = mlx5_fpga_access_reg(fdev->mdev, actual_size,\n\t\t\t\t\t   addr + bytes_done,\n\t\t\t\t\t   buf + bytes_done, false);\n\t\tif (err) {\n\t\t\tmlx5_fpga_err(fdev, \"Failed to read over I2C: %d\\n\",\n\t\t\t\t      err);\n\t\t\tbreak;\n\t\t}\n\n\t\tbytes_done += actual_size;\n\t}\n\n\treturn err;\n}\n\nstatic int mlx5_fpga_mem_write_i2c(struct mlx5_fpga_device *fdev, size_t size,\n\t\t\t\t   u64 addr, u8 *buf)\n{\n\tsize_t max_size = MLX5_FPGA_ACCESS_REG_SIZE_MAX;\n\tsize_t bytes_done = 0;\n\tu8 actual_size;\n\tint err;\n\n\tif (!size)\n\t\treturn -EINVAL;\n\n\tif (!fdev->mdev)\n\t\treturn -ENOTCONN;\n\n\twhile (bytes_done < size) {\n\t\tactual_size = min(max_size, (size - bytes_done));\n\n\t\terr = mlx5_fpga_access_reg(fdev->mdev, actual_size,\n\t\t\t\t\t   addr + bytes_done,\n\t\t\t\t\t   buf + bytes_done, true);\n\t\tif (err) {\n\t\t\tmlx5_fpga_err(fdev, \"Failed to write FPGA crspace\\n\");\n\t\t\tbreak;\n\t\t}\n\n\t\tbytes_done += actual_size;\n\t}\n\n\treturn err;\n}\n\nint mlx5_fpga_mem_read(struct mlx5_fpga_device *fdev, size_t size, u64 addr,\n\t\t       void *buf, enum mlx5_fpga_access_type access_type)\n{\n\tint ret;\n\n\tswitch (access_type) {\n\tcase MLX5_FPGA_ACCESS_TYPE_I2C:\n\t\tret = mlx5_fpga_mem_read_i2c(fdev, size, addr, buf);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\tdefault:\n\t\tmlx5_fpga_warn(fdev, \"Unexpected read access_type %u\\n\",\n\t\t\t       access_type);\n\t\treturn -EACCES;\n\t}\n\n\treturn size;\n}\nEXPORT_SYMBOL(mlx5_fpga_mem_read);\n\nint mlx5_fpga_mem_write(struct mlx5_fpga_device *fdev, size_t size, u64 addr,\n\t\t\tvoid *buf, enum mlx5_fpga_access_type access_type)\n{\n\tint ret;\n\n\tswitch (access_type) {\n\tcase MLX5_FPGA_ACCESS_TYPE_I2C:\n\t\tret = mlx5_fpga_mem_write_i2c(fdev, size, addr, buf);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\tdefault:\n\t\tmlx5_fpga_warn(fdev, \"Unexpected write access_type %u\\n\",\n\t\t\t       access_type);\n\t\treturn -EACCES;\n\t}\n\n\treturn size;\n}\nEXPORT_SYMBOL(mlx5_fpga_mem_write);\n\nint mlx5_fpga_get_sbu_caps(struct mlx5_fpga_device *fdev, int size, void *buf)\n{\n\treturn mlx5_fpga_sbu_caps(fdev->mdev, buf, size);\n}\nEXPORT_SYMBOL(mlx5_fpga_get_sbu_caps);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}