{
  "module_name": "tc_tun.h",
  "hash_id": "2813a18350a3cf6d276ec83d3730ec899eeb5218829c50d375d4c6fcf1944433",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/en/tc_tun.h",
  "human_readable_source": " \n \n\n#ifndef __MLX5_EN_TC_TUNNEL_H__\n#define __MLX5_EN_TC_TUNNEL_H__\n\n#include <linux/netdevice.h>\n#include <linux/mlx5/fs.h>\n#include <net/pkt_cls.h>\n#include <linux/netlink.h>\n#include \"en.h\"\n#include \"en_rep.h\"\n\n#ifdef CONFIG_MLX5_ESWITCH\n\nenum {\n\tMLX5E_TC_TUNNEL_TYPE_UNKNOWN,\n\tMLX5E_TC_TUNNEL_TYPE_VXLAN,\n\tMLX5E_TC_TUNNEL_TYPE_GENEVE,\n\tMLX5E_TC_TUNNEL_TYPE_GRETAP,\n\tMLX5E_TC_TUNNEL_TYPE_MPLSOUDP,\n};\n\nstruct mlx5e_encap_key {\n\tconst struct ip_tunnel_key *ip_tun_key;\n\tstruct mlx5e_tc_tunnel     *tc_tunnel;\n};\n\nstruct mlx5e_tc_tunnel {\n\tint tunnel_type;\n\tenum mlx5_flow_match_level match_level;\n\n\tbool (*can_offload)(struct mlx5e_priv *priv);\n\tint (*calc_hlen)(struct mlx5e_encap_entry *e);\n\tint (*init_encap_attr)(struct net_device *tunnel_dev,\n\t\t\t       struct mlx5e_priv *priv,\n\t\t\t       struct mlx5e_encap_entry *e,\n\t\t\t       struct netlink_ext_ack *extack);\n\tint (*generate_ip_tun_hdr)(char buf[],\n\t\t\t\t   __u8 *ip_proto,\n\t\t\t\t   struct mlx5e_encap_entry *e);\n\tint (*parse_udp_ports)(struct mlx5e_priv *priv,\n\t\t\t       struct mlx5_flow_spec *spec,\n\t\t\t       struct flow_cls_offload *f,\n\t\t\t       void *headers_c,\n\t\t\t       void *headers_v);\n\tint (*parse_tunnel)(struct mlx5e_priv *priv,\n\t\t\t    struct mlx5_flow_spec *spec,\n\t\t\t    struct flow_cls_offload *f,\n\t\t\t    void *headers_c,\n\t\t\t    void *headers_v);\n\tbool (*encap_info_equal)(struct mlx5e_encap_key *a,\n\t\t\t\t struct mlx5e_encap_key *b);\n\tint (*get_remote_ifindex)(struct net_device *mirred_dev);\n};\n\nextern struct mlx5e_tc_tunnel vxlan_tunnel;\nextern struct mlx5e_tc_tunnel geneve_tunnel;\nextern struct mlx5e_tc_tunnel gre_tunnel;\nextern struct mlx5e_tc_tunnel mplsoudp_tunnel;\n\nstruct mlx5e_tc_tunnel *mlx5e_get_tc_tun(struct net_device *tunnel_dev);\n\nint mlx5e_tc_tun_init_encap_attr(struct net_device *tunnel_dev,\n\t\t\t\t struct mlx5e_priv *priv,\n\t\t\t\t struct mlx5e_encap_entry *e,\n\t\t\t\t struct netlink_ext_ack *extack);\n\nint mlx5e_tc_tun_create_header_ipv4(struct mlx5e_priv *priv,\n\t\t\t\t    struct net_device *mirred_dev,\n\t\t\t\t    struct mlx5e_encap_entry *e);\nint mlx5e_tc_tun_update_header_ipv4(struct mlx5e_priv *priv,\n\t\t\t\t    struct net_device *mirred_dev,\n\t\t\t\t    struct mlx5e_encap_entry *e);\n\n#if IS_ENABLED(CONFIG_INET) && IS_ENABLED(CONFIG_IPV6)\nint mlx5e_tc_tun_create_header_ipv6(struct mlx5e_priv *priv,\n\t\t\t\t    struct net_device *mirred_dev,\n\t\t\t\t    struct mlx5e_encap_entry *e);\nint mlx5e_tc_tun_update_header_ipv6(struct mlx5e_priv *priv,\n\t\t\t\t    struct net_device *mirred_dev,\n\t\t\t\t    struct mlx5e_encap_entry *e);\n#else\nstatic inline int\nmlx5e_tc_tun_create_header_ipv6(struct mlx5e_priv *priv,\n\t\t\t\tstruct net_device *mirred_dev,\n\t\t\t\tstruct mlx5e_encap_entry *e)\n{ return -EOPNOTSUPP; }\nstatic inline int\nmlx5e_tc_tun_update_header_ipv6(struct mlx5e_priv *priv,\n\t\t\t\tstruct net_device *mirred_dev,\n\t\t\t\tstruct mlx5e_encap_entry *e)\n{ return -EOPNOTSUPP; }\n#endif\nint mlx5e_tc_tun_route_lookup(struct mlx5e_priv *priv,\n\t\t\t      struct mlx5_flow_spec *spec,\n\t\t\t      struct mlx5_flow_attr *attr,\n\t\t\t      struct net_device *filter_dev);\n\nbool mlx5e_tc_tun_device_to_offload(struct mlx5e_priv *priv,\n\t\t\t\t    struct net_device *netdev);\n\nint mlx5e_tc_tun_parse(struct net_device *filter_dev,\n\t\t       struct mlx5e_priv *priv,\n\t\t       struct mlx5_flow_spec *spec,\n\t\t       struct flow_cls_offload *f,\n\t\t       u8 *match_level);\n\nint mlx5e_tc_tun_parse_udp_ports(struct mlx5e_priv *priv,\n\t\t\t\t struct mlx5_flow_spec *spec,\n\t\t\t\t struct flow_cls_offload *f,\n\t\t\t\t void *headers_c,\n\t\t\t\t void *headers_v);\n\nbool mlx5e_tc_tun_encap_info_equal_generic(struct mlx5e_encap_key *a,\n\t\t\t\t\t   struct mlx5e_encap_key *b);\n\nbool mlx5e_tc_tun_encap_info_equal_options(struct mlx5e_encap_key *a,\n\t\t\t\t\t   struct mlx5e_encap_key *b,\n\t\t\t\t\t   __be16 tun_flags);\n#endif  \n\n#endif \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}