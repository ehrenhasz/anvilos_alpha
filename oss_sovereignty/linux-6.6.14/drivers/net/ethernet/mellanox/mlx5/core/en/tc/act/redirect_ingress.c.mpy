{
  "module_name": "redirect_ingress.c",
  "hash_id": "6cbbcb3dfc39ce3a90fe151276a3f7ab8e0184bc11bc78c07bba953008e22a4b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/en/tc/act/redirect_ingress.c",
  "human_readable_source": "\n\n\n#include \"act.h\"\n#include \"en/tc_priv.h\"\n\nstatic bool\ntc_act_can_offload_redirect_ingress(struct mlx5e_tc_act_parse_state *parse_state,\n\t\t\t\t    const struct flow_action_entry *act,\n\t\t\t\t    int act_index,\n\t\t\t\t    struct mlx5_flow_attr *attr)\n{\n\tstruct netlink_ext_ack *extack = parse_state->extack;\n\tstruct mlx5e_tc_flow_parse_attr *parse_attr;\n\tstruct net_device *out_dev = act->dev;\n\tstruct mlx5_esw_flow_attr *esw_attr;\n\n\tparse_attr = attr->parse_attr;\n\tesw_attr = attr->esw_attr;\n\n\tif (!out_dev)\n\t\treturn false;\n\n\tif (!netif_is_ovs_master(out_dev)) {\n\t\tNL_SET_ERR_MSG_MOD(extack,\n\t\t\t\t   \"redirect to ingress is supported only for OVS internal ports\");\n\t\treturn false;\n\t}\n\n\tif (netif_is_ovs_master(parse_attr->filter_dev)) {\n\t\tNL_SET_ERR_MSG_MOD(extack,\n\t\t\t\t   \"redirect to ingress is not supported from internal port\");\n\t\treturn false;\n\t}\n\n\tif (!parse_state->ptype_host) {\n\t\tNL_SET_ERR_MSG_MOD(extack,\n\t\t\t\t   \"redirect to int port ingress requires ptype=host action\");\n\t\treturn false;\n\t}\n\n\tif (esw_attr->out_count) {\n\t\tNL_SET_ERR_MSG_MOD(extack,\n\t\t\t\t   \"redirect to int port ingress is supported only as single destination\");\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nstatic int\ntc_act_parse_redirect_ingress(struct mlx5e_tc_act_parse_state *parse_state,\n\t\t\t      const struct flow_action_entry *act,\n\t\t\t      struct mlx5e_priv *priv,\n\t\t\t      struct mlx5_flow_attr *attr)\n{\n\tstruct mlx5_esw_flow_attr *esw_attr = attr->esw_attr;\n\tstruct net_device *out_dev = act->dev;\n\tint err;\n\n\tattr->action |= MLX5_FLOW_CONTEXT_ACTION_FWD_DEST;\n\n\terr = mlx5e_set_fwd_to_int_port_actions(priv, attr, out_dev->ifindex,\n\t\t\t\t\t\tMLX5E_TC_INT_PORT_INGRESS,\n\t\t\t\t\t\t&attr->action, esw_attr->out_count);\n\tif (err)\n\t\treturn err;\n\n\tparse_state->if_count = 0;\n\tesw_attr->out_count++;\n\n\treturn 0;\n}\n\nstruct mlx5e_tc_act mlx5e_tc_act_redirect_ingress = {\n\t.can_offload = tc_act_can_offload_redirect_ingress,\n\t.parse_action = tc_act_parse_redirect_ingress,\n};\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}