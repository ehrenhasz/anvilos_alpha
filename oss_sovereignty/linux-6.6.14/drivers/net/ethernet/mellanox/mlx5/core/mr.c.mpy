{
  "module_name": "mr.c",
  "hash_id": "1604350f6fcf41c323b2cfb9c1bf4fd12985bfe8fdbc317bf76dcaf4ae07ca67",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/mr.c",
  "human_readable_source": " \n\n#include <linux/kernel.h>\n#include <linux/mlx5/driver.h>\n#include <linux/mlx5/qp.h>\n#include \"mlx5_core.h\"\n\nint mlx5_core_create_mkey(struct mlx5_core_dev *dev, u32 *mkey, u32 *in,\n\t\t\t  int inlen)\n{\n\tu32 lout[MLX5_ST_SZ_DW(create_mkey_out)] = {};\n\tu32 mkey_index;\n\tint err;\n\n\tMLX5_SET(create_mkey_in, in, opcode, MLX5_CMD_OP_CREATE_MKEY);\n\n\terr = mlx5_cmd_exec(dev, in, inlen, lout, sizeof(lout));\n\tif (err)\n\t\treturn err;\n\n\tmkey_index = MLX5_GET(create_mkey_out, lout, mkey_index);\n\t*mkey = MLX5_GET(create_mkey_in, in, memory_key_mkey_entry.mkey_7_0) |\n\t\tmlx5_idx_to_mkey(mkey_index);\n\n\tmlx5_core_dbg(dev, \"out 0x%x, mkey 0x%x\\n\", mkey_index, *mkey);\n\treturn 0;\n}\nEXPORT_SYMBOL(mlx5_core_create_mkey);\n\nint mlx5_core_destroy_mkey(struct mlx5_core_dev *dev, u32 mkey)\n{\n\tu32 in[MLX5_ST_SZ_DW(destroy_mkey_in)] = {};\n\n\tMLX5_SET(destroy_mkey_in, in, opcode, MLX5_CMD_OP_DESTROY_MKEY);\n\tMLX5_SET(destroy_mkey_in, in, mkey_index, mlx5_mkey_to_idx(mkey));\n\treturn mlx5_cmd_exec_in(dev, destroy_mkey, in);\n}\nEXPORT_SYMBOL(mlx5_core_destroy_mkey);\n\nint mlx5_core_query_mkey(struct mlx5_core_dev *dev, u32 mkey, u32 *out,\n\t\t\t int outlen)\n{\n\tu32 in[MLX5_ST_SZ_DW(query_mkey_in)] = {};\n\n\tmemset(out, 0, outlen);\n\tMLX5_SET(query_mkey_in, in, opcode, MLX5_CMD_OP_QUERY_MKEY);\n\tMLX5_SET(query_mkey_in, in, mkey_index, mlx5_mkey_to_idx(mkey));\n\treturn mlx5_cmd_exec(dev, in, sizeof(in), out, outlen);\n}\nEXPORT_SYMBOL(mlx5_core_query_mkey);\n\nstatic inline u32 mlx5_get_psv(u32 *out, int psv_index)\n{\n\tswitch (psv_index) {\n\tcase 1: return MLX5_GET(create_psv_out, out, psv1_index);\n\tcase 2: return MLX5_GET(create_psv_out, out, psv2_index);\n\tcase 3: return MLX5_GET(create_psv_out, out, psv3_index);\n\tdefault: return MLX5_GET(create_psv_out, out, psv0_index);\n\t}\n}\n\nint mlx5_core_create_psv(struct mlx5_core_dev *dev, u32 pdn,\n\t\t\t int npsvs, u32 *sig_index)\n{\n\tu32 out[MLX5_ST_SZ_DW(create_psv_out)] = {};\n\tu32 in[MLX5_ST_SZ_DW(create_psv_in)] = {};\n\tint i, err;\n\n\tif (npsvs > MLX5_MAX_PSVS)\n\t\treturn -EINVAL;\n\n\tMLX5_SET(create_psv_in, in, opcode, MLX5_CMD_OP_CREATE_PSV);\n\tMLX5_SET(create_psv_in, in, pd, pdn);\n\tMLX5_SET(create_psv_in, in, num_psv, npsvs);\n\n\terr = mlx5_cmd_exec_inout(dev, create_psv, in, out);\n\tif (err)\n\t\treturn err;\n\n\tfor (i = 0; i < npsvs; i++)\n\t\tsig_index[i] = mlx5_get_psv(out, i);\n\n\treturn err;\n}\nEXPORT_SYMBOL(mlx5_core_create_psv);\n\nint mlx5_core_destroy_psv(struct mlx5_core_dev *dev, int psv_num)\n{\n\tu32 in[MLX5_ST_SZ_DW(destroy_psv_in)] = {};\n\n\tMLX5_SET(destroy_psv_in, in, opcode, MLX5_CMD_OP_DESTROY_PSV);\n\tMLX5_SET(destroy_psv_in, in, psvn, psv_num);\n\treturn mlx5_cmd_exec_in(dev, destroy_psv, in);\n}\nEXPORT_SYMBOL(mlx5_core_destroy_psv);\n\n__be32 mlx5_core_get_terminate_scatter_list_mkey(struct mlx5_core_dev *dev)\n{\n\tu32 out[MLX5_ST_SZ_DW(query_special_contexts_out)] = {};\n\tu32 in[MLX5_ST_SZ_DW(query_special_contexts_in)] = {};\n\tu32 mkey;\n\n\tif (!MLX5_CAP_GEN(dev, terminate_scatter_list_mkey))\n\t\treturn MLX5_TERMINATE_SCATTER_LIST_LKEY;\n\n\tMLX5_SET(query_special_contexts_in, in, opcode,\n\t\t MLX5_CMD_OP_QUERY_SPECIAL_CONTEXTS);\n\tif (mlx5_cmd_exec_inout(dev, query_special_contexts, in, out))\n\t\treturn MLX5_TERMINATE_SCATTER_LIST_LKEY;\n\n\tmkey = MLX5_GET(query_special_contexts_out, out,\n\t\t\tterminate_scatter_list_mkey);\n\treturn cpu_to_be32(mkey);\n}\nEXPORT_SYMBOL(mlx5_core_get_terminate_scatter_list_mkey);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}