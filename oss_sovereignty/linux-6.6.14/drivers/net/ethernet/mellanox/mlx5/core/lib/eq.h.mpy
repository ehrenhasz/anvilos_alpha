{
  "module_name": "eq.h",
  "hash_id": "2402239a005f44905fa4bdc8c3864716f9dd01848ce19ce658690bbe478c27af",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx5/core/lib/eq.h",
  "human_readable_source": " \n \n\n#ifndef __LIB_MLX5_EQ_H__\n#define __LIB_MLX5_EQ_H__\n#include <linux/mlx5/driver.h>\n#include <linux/mlx5/eq.h>\n#include <linux/mlx5/cq.h>\n\n#define MLX5_EQE_SIZE       (sizeof(struct mlx5_eqe))\n\nstruct mlx5_eq_tasklet {\n\tstruct list_head      list;\n\tstruct list_head      process_list;\n\tstruct tasklet_struct task;\n\tspinlock_t            lock;  \n};\n\nstruct mlx5_cq_table {\n\tspinlock_t              lock;\t \n\tstruct radix_tree_root  tree;\n};\n\nstruct mlx5_eq {\n\tstruct mlx5_frag_buf_ctrl fbc;\n\tstruct mlx5_frag_buf    frag_buf;\n\tstruct mlx5_core_dev    *dev;\n\tstruct mlx5_cq_table    cq_table;\n\t__be32 __iomem\t        *doorbell;\n\tu32                     cons_index;\n\tunsigned int            vecidx;\n\tunsigned int            irqn;\n\tu8                      eqn;\n\tstruct mlx5_rsc_debug   *dbg;\n\tstruct mlx5_irq         *irq;\n};\n\nstruct mlx5_eq_async {\n\tstruct mlx5_eq          core;\n\tstruct notifier_block   irq_nb;\n\tspinlock_t              lock;  \n};\n\nstruct mlx5_eq_comp {\n\tstruct mlx5_eq          core;\n\tstruct notifier_block   irq_nb;\n\tstruct mlx5_eq_tasklet  tasklet_ctx;\n\tstruct list_head        list;\n};\n\nstatic inline u32 eq_get_size(struct mlx5_eq *eq)\n{\n\treturn eq->fbc.sz_m1 + 1;\n}\n\nstatic inline struct mlx5_eqe *get_eqe(struct mlx5_eq *eq, u32 entry)\n{\n\treturn mlx5_frag_buf_get_wqe(&eq->fbc, entry);\n}\n\nstatic inline struct mlx5_eqe *next_eqe_sw(struct mlx5_eq *eq)\n{\n\tstruct mlx5_eqe *eqe = get_eqe(eq, eq->cons_index & eq->fbc.sz_m1);\n\n\treturn (eqe->owner ^ (eq->cons_index >> eq->fbc.log_sz)) & 1 ? NULL : eqe;\n}\n\nstatic inline void eq_update_ci(struct mlx5_eq *eq, int arm)\n{\n\t__be32 __iomem *addr = eq->doorbell + (arm ? 0 : 2);\n\tu32 val = (eq->cons_index & 0xffffff) | (eq->eqn << 24);\n\n\t__raw_writel((__force u32)cpu_to_be32(val), addr);\n\t \n\tmb();\n}\n\nint mlx5_eq_table_init(struct mlx5_core_dev *dev);\nvoid mlx5_eq_table_cleanup(struct mlx5_core_dev *dev);\nint mlx5_eq_table_create(struct mlx5_core_dev *dev);\nvoid mlx5_eq_table_destroy(struct mlx5_core_dev *dev);\n\nint mlx5_eq_add_cq(struct mlx5_eq *eq, struct mlx5_core_cq *cq);\nvoid mlx5_eq_del_cq(struct mlx5_eq *eq, struct mlx5_core_cq *cq);\nstruct mlx5_eq_comp *mlx5_eqn2comp_eq(struct mlx5_core_dev *dev, int eqn);\nstruct mlx5_eq *mlx5_get_async_eq(struct mlx5_core_dev *dev);\nvoid mlx5_cq_tasklet_cb(struct tasklet_struct *t);\nstruct cpumask *mlx5_eq_comp_cpumask(struct mlx5_core_dev *dev, int ix);\n\nu32 mlx5_eq_poll_irq_disabled(struct mlx5_eq_comp *eq);\nvoid mlx5_cmd_eq_recover(struct mlx5_core_dev *dev);\nvoid mlx5_eq_synchronize_async_irq(struct mlx5_core_dev *dev);\nvoid mlx5_eq_synchronize_cmd_irq(struct mlx5_core_dev *dev);\n\nint mlx5_debug_eq_add(struct mlx5_core_dev *dev, struct mlx5_eq *eq);\nvoid mlx5_debug_eq_remove(struct mlx5_core_dev *dev, struct mlx5_eq *eq);\nvoid mlx5_eq_debugfs_init(struct mlx5_core_dev *dev);\nvoid mlx5_eq_debugfs_cleanup(struct mlx5_core_dev *dev);\n\n \nvoid mlx5_core_eq_free_irqs(struct mlx5_core_dev *dev);\n\n#ifdef CONFIG_RFS_ACCEL\nstruct cpu_rmap *mlx5_eq_table_get_rmap(struct mlx5_core_dev *dev);\n#endif\n\nint mlx5_comp_irqn_get(struct mlx5_core_dev *dev, int vector, unsigned int *irqn);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}