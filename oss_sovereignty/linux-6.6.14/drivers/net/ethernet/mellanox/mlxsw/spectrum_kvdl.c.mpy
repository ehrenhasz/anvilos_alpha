{
  "module_name": "spectrum_kvdl.c",
  "hash_id": "24e677e8cf69ffb01fa7b89304db328000e3d92a4db7a430e3248a94a78d54a7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxsw/spectrum_kvdl.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/mutex.h>\n#include <linux/slab.h>\n\n#include \"spectrum.h\"\n\nstruct mlxsw_sp_kvdl {\n\tconst struct mlxsw_sp_kvdl_ops *kvdl_ops;\n\tstruct mutex kvdl_lock;  \n\tunsigned long priv[];\n\t \n};\n\nint mlxsw_sp_kvdl_init(struct mlxsw_sp *mlxsw_sp)\n{\n\tconst struct mlxsw_sp_kvdl_ops *kvdl_ops = mlxsw_sp->kvdl_ops;\n\tstruct mlxsw_sp_kvdl *kvdl;\n\tint err;\n\n\tkvdl = kzalloc(sizeof(*mlxsw_sp->kvdl) + kvdl_ops->priv_size,\n\t\t       GFP_KERNEL);\n\tif (!kvdl)\n\t\treturn -ENOMEM;\n\tmutex_init(&kvdl->kvdl_lock);\n\tkvdl->kvdl_ops = kvdl_ops;\n\tmlxsw_sp->kvdl = kvdl;\n\n\terr = kvdl_ops->init(mlxsw_sp, kvdl->priv);\n\tif (err)\n\t\tgoto err_init;\n\treturn 0;\n\nerr_init:\n\tmutex_destroy(&kvdl->kvdl_lock);\n\tkfree(kvdl);\n\treturn err;\n}\n\nvoid mlxsw_sp_kvdl_fini(struct mlxsw_sp *mlxsw_sp)\n{\n\tstruct mlxsw_sp_kvdl *kvdl = mlxsw_sp->kvdl;\n\n\tkvdl->kvdl_ops->fini(mlxsw_sp, kvdl->priv);\n\tmutex_destroy(&kvdl->kvdl_lock);\n\tkfree(kvdl);\n}\n\nint mlxsw_sp_kvdl_alloc(struct mlxsw_sp *mlxsw_sp,\n\t\t\tenum mlxsw_sp_kvdl_entry_type type,\n\t\t\tunsigned int entry_count, u32 *p_entry_index)\n{\n\tstruct mlxsw_sp_kvdl *kvdl = mlxsw_sp->kvdl;\n\tint err;\n\n\tmutex_lock(&kvdl->kvdl_lock);\n\terr = kvdl->kvdl_ops->alloc(mlxsw_sp, kvdl->priv, type,\n\t\t\t\t    entry_count, p_entry_index);\n\tmutex_unlock(&kvdl->kvdl_lock);\n\n\treturn err;\n}\n\nvoid mlxsw_sp_kvdl_free(struct mlxsw_sp *mlxsw_sp,\n\t\t\tenum mlxsw_sp_kvdl_entry_type type,\n\t\t\tunsigned int entry_count, int entry_index)\n{\n\tstruct mlxsw_sp_kvdl *kvdl = mlxsw_sp->kvdl;\n\n\tmutex_lock(&kvdl->kvdl_lock);\n\tkvdl->kvdl_ops->free(mlxsw_sp, kvdl->priv, type,\n\t\t\t     entry_count, entry_index);\n\tmutex_unlock(&kvdl->kvdl_lock);\n}\n\nint mlxsw_sp_kvdl_alloc_count_query(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t    enum mlxsw_sp_kvdl_entry_type type,\n\t\t\t\t    unsigned int entry_count,\n\t\t\t\t    unsigned int *p_alloc_count)\n{\n\tstruct mlxsw_sp_kvdl *kvdl = mlxsw_sp->kvdl;\n\n\treturn kvdl->kvdl_ops->alloc_size_query(mlxsw_sp, kvdl->priv, type,\n\t\t\t\t\t\tentry_count, p_alloc_count);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}