{
  "module_name": "spectrum_acl_tcam.h",
  "hash_id": "2b49dc343f763ac88a81adff4cadf4a59ddaee2954a6096f0143519a0ce4958e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.h",
  "human_readable_source": " \n \n\n#ifndef _MLXSW_SPECTRUM_ACL_TCAM_H\n#define _MLXSW_SPECTRUM_ACL_TCAM_H\n\n#include <linux/list.h>\n#include <linux/parman.h>\n\n#include \"reg.h\"\n#include \"spectrum.h\"\n#include \"core_acl_flex_keys.h\"\n\nstruct mlxsw_sp_acl_tcam {\n\tunsigned long *used_regions;  \n\tunsigned int max_regions;\n\tunsigned long *used_groups;   \n\tunsigned int max_groups;\n\tunsigned int max_group_size;\n\tstruct mutex lock;  \n\tstruct list_head vregion_list;\n\tu32 vregion_rehash_intrvl;    \n\tunsigned long priv[];\n\t \n};\n\nsize_t mlxsw_sp_acl_tcam_priv_size(struct mlxsw_sp *mlxsw_sp);\nint mlxsw_sp_acl_tcam_init(struct mlxsw_sp *mlxsw_sp,\n\t\t\t   struct mlxsw_sp_acl_tcam *tcam);\nvoid mlxsw_sp_acl_tcam_fini(struct mlxsw_sp *mlxsw_sp,\n\t\t\t    struct mlxsw_sp_acl_tcam *tcam);\nint mlxsw_sp_acl_tcam_priority_get(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t   struct mlxsw_sp_acl_rule_info *rulei,\n\t\t\t\t   u32 *priority, bool fillup_priority);\n\nstruct mlxsw_sp_acl_profile_ops {\n\tsize_t ruleset_priv_size;\n\tint (*ruleset_add)(struct mlxsw_sp *mlxsw_sp,\n\t\t\t   struct mlxsw_sp_acl_tcam *tcam, void *ruleset_priv,\n\t\t\t   struct mlxsw_afk_element_usage *tmplt_elusage,\n\t\t\t   unsigned int *p_min_prio, unsigned int *p_max_prio);\n\tvoid (*ruleset_del)(struct mlxsw_sp *mlxsw_sp, void *ruleset_priv);\n\tint (*ruleset_bind)(struct mlxsw_sp *mlxsw_sp, void *ruleset_priv,\n\t\t\t    struct mlxsw_sp_port *mlxsw_sp_port,\n\t\t\t    bool ingress);\n\tvoid (*ruleset_unbind)(struct mlxsw_sp *mlxsw_sp, void *ruleset_priv,\n\t\t\t       struct mlxsw_sp_port *mlxsw_sp_port,\n\t\t\t       bool ingress);\n\tu16 (*ruleset_group_id)(void *ruleset_priv);\n\tsize_t rule_priv_size;\n\tint (*rule_add)(struct mlxsw_sp *mlxsw_sp,\n\t\t\tvoid *ruleset_priv, void *rule_priv,\n\t\t\tstruct mlxsw_sp_acl_rule_info *rulei);\n\tvoid (*rule_del)(struct mlxsw_sp *mlxsw_sp, void *rule_priv);\n\tint (*rule_action_replace)(struct mlxsw_sp *mlxsw_sp, void *rule_priv,\n\t\t\t\t   struct mlxsw_sp_acl_rule_info *rulei);\n\tint (*rule_activity_get)(struct mlxsw_sp *mlxsw_sp, void *rule_priv,\n\t\t\t\t bool *activity);\n};\n\nconst struct mlxsw_sp_acl_profile_ops *\nmlxsw_sp_acl_tcam_profile_ops(struct mlxsw_sp *mlxsw_sp,\n\t\t\t      enum mlxsw_sp_acl_profile profile);\n\n#define MLXSW_SP_ACL_TCAM_REGION_BASE_COUNT 16\n#define MLXSW_SP_ACL_TCAM_REGION_RESIZE_STEP 16\n\n#define MLXSW_SP_ACL_TCAM_CATCHALL_PRIO (~0U)\n\n#define MLXSW_SP_ACL_TCAM_MASK_LEN \\\n\t(MLXSW_REG_PTCEX_FLEX_KEY_BLOCKS_LEN * BITS_PER_BYTE)\n\nstruct mlxsw_sp_acl_tcam_group;\nstruct mlxsw_sp_acl_tcam_vregion;\n\nstruct mlxsw_sp_acl_tcam_region {\n\tstruct mlxsw_sp_acl_tcam_vregion *vregion;\n\tstruct mlxsw_sp_acl_tcam_group *group;\n\tstruct list_head list;  \n\tenum mlxsw_reg_ptar_key_type key_type;\n\tu16 id;  \n\tchar tcam_region_info[MLXSW_REG_PXXX_TCAM_REGION_INFO_LEN];\n\tstruct mlxsw_afk_key_info *key_info;\n\tstruct mlxsw_sp *mlxsw_sp;\n\tunsigned long priv[];\n\t \n};\n\nstruct mlxsw_sp_acl_ctcam_region {\n\tstruct parman *parman;\n\tconst struct mlxsw_sp_acl_ctcam_region_ops *ops;\n\tstruct mlxsw_sp_acl_tcam_region *region;\n};\n\nstruct mlxsw_sp_acl_ctcam_chunk {\n\tstruct parman_prio parman_prio;\n};\n\nstruct mlxsw_sp_acl_ctcam_entry {\n\tstruct parman_item parman_item;\n};\n\nstruct mlxsw_sp_acl_ctcam_region_ops {\n\tint (*entry_insert)(struct mlxsw_sp_acl_ctcam_region *cregion,\n\t\t\t    struct mlxsw_sp_acl_ctcam_entry *centry,\n\t\t\t    const char *mask);\n\tvoid (*entry_remove)(struct mlxsw_sp_acl_ctcam_region *cregion,\n\t\t\t     struct mlxsw_sp_acl_ctcam_entry *centry);\n};\n\nint\nmlxsw_sp_acl_ctcam_region_init(struct mlxsw_sp *mlxsw_sp,\n\t\t\t       struct mlxsw_sp_acl_ctcam_region *cregion,\n\t\t\t       struct mlxsw_sp_acl_tcam_region *region,\n\t\t\t       const struct mlxsw_sp_acl_ctcam_region_ops *ops);\nvoid mlxsw_sp_acl_ctcam_region_fini(struct mlxsw_sp_acl_ctcam_region *cregion);\nvoid mlxsw_sp_acl_ctcam_chunk_init(struct mlxsw_sp_acl_ctcam_region *cregion,\n\t\t\t\t   struct mlxsw_sp_acl_ctcam_chunk *cchunk,\n\t\t\t\t   unsigned int priority);\nvoid mlxsw_sp_acl_ctcam_chunk_fini(struct mlxsw_sp_acl_ctcam_chunk *cchunk);\nint mlxsw_sp_acl_ctcam_entry_add(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t struct mlxsw_sp_acl_ctcam_region *cregion,\n\t\t\t\t struct mlxsw_sp_acl_ctcam_chunk *cchunk,\n\t\t\t\t struct mlxsw_sp_acl_ctcam_entry *centry,\n\t\t\t\t struct mlxsw_sp_acl_rule_info *rulei,\n\t\t\t\t bool fillup_priority);\nvoid mlxsw_sp_acl_ctcam_entry_del(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t  struct mlxsw_sp_acl_ctcam_region *cregion,\n\t\t\t\t  struct mlxsw_sp_acl_ctcam_chunk *cchunk,\n\t\t\t\t  struct mlxsw_sp_acl_ctcam_entry *centry);\nint mlxsw_sp_acl_ctcam_entry_action_replace(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t\t    struct mlxsw_sp_acl_ctcam_region *cregion,\n\t\t\t\t\t    struct mlxsw_sp_acl_ctcam_entry *centry,\n\t\t\t\t\t    struct mlxsw_sp_acl_rule_info *rulei);\nstatic inline unsigned int\nmlxsw_sp_acl_ctcam_entry_offset(struct mlxsw_sp_acl_ctcam_entry *centry)\n{\n\treturn centry->parman_item.index;\n}\n\nenum mlxsw_sp_acl_atcam_region_type {\n\tMLXSW_SP_ACL_ATCAM_REGION_TYPE_2KB,\n\tMLXSW_SP_ACL_ATCAM_REGION_TYPE_4KB,\n\tMLXSW_SP_ACL_ATCAM_REGION_TYPE_8KB,\n\tMLXSW_SP_ACL_ATCAM_REGION_TYPE_12KB,\n\t__MLXSW_SP_ACL_ATCAM_REGION_TYPE_MAX,\n};\n\n#define MLXSW_SP_ACL_ATCAM_REGION_TYPE_MAX \\\n\t(__MLXSW_SP_ACL_ATCAM_REGION_TYPE_MAX - 1)\n\nstruct mlxsw_sp_acl_atcam {\n\tstruct mlxsw_sp_acl_erp_core *erp_core;\n};\n\nstruct mlxsw_sp_acl_atcam_region {\n\tstruct rhashtable entries_ht;  \n\tstruct list_head entries_list;  \n\tstruct mlxsw_sp_acl_ctcam_region cregion;\n\tconst struct mlxsw_sp_acl_atcam_region_ops *ops;\n\tstruct mlxsw_sp_acl_tcam_region *region;\n\tstruct mlxsw_sp_acl_atcam *atcam;\n\tenum mlxsw_sp_acl_atcam_region_type type;\n\tstruct mlxsw_sp_acl_erp_table *erp_table;\n\tvoid *priv;\n};\n\nstruct mlxsw_sp_acl_atcam_entry_ht_key {\n\tchar full_enc_key[MLXSW_REG_PTCEX_FLEX_KEY_BLOCKS_LEN];  \n\tu8 erp_id;\n};\n\nstruct mlxsw_sp_acl_atcam_chunk {\n\tstruct mlxsw_sp_acl_ctcam_chunk cchunk;\n};\n\nstruct mlxsw_sp_acl_atcam_entry {\n\tstruct rhash_head ht_node;\n\tstruct list_head list;  \n\tstruct mlxsw_sp_acl_atcam_entry_ht_key ht_key;\n\tchar enc_key[MLXSW_REG_PTCEX_FLEX_KEY_BLOCKS_LEN];  \n\tstruct {\n\t\tu16 start;\n\t\tu8 mask;\n\t\tu8 value;\n\t} delta_info;\n\tstruct mlxsw_sp_acl_ctcam_entry centry;\n\tstruct mlxsw_sp_acl_atcam_lkey_id *lkey_id;\n\tstruct mlxsw_sp_acl_erp_mask *erp_mask;\n};\n\nstatic inline struct mlxsw_sp_acl_atcam_region *\nmlxsw_sp_acl_tcam_cregion_aregion(struct mlxsw_sp_acl_ctcam_region *cregion)\n{\n\treturn container_of(cregion, struct mlxsw_sp_acl_atcam_region, cregion);\n}\n\nstatic inline struct mlxsw_sp_acl_atcam_entry *\nmlxsw_sp_acl_tcam_centry_aentry(struct mlxsw_sp_acl_ctcam_entry *centry)\n{\n\treturn container_of(centry, struct mlxsw_sp_acl_atcam_entry, centry);\n}\n\nint mlxsw_sp_acl_atcam_region_associate(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t\tu16 region_id);\nint\nmlxsw_sp_acl_atcam_region_init(struct mlxsw_sp *mlxsw_sp,\n\t\t\t       struct mlxsw_sp_acl_atcam *atcam,\n\t\t\t       struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t       struct mlxsw_sp_acl_tcam_region *region,\n\t\t\t       void *hints_priv,\n\t\t\t       const struct mlxsw_sp_acl_ctcam_region_ops *ops);\nvoid mlxsw_sp_acl_atcam_region_fini(struct mlxsw_sp_acl_atcam_region *aregion);\nvoid mlxsw_sp_acl_atcam_chunk_init(struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t\t   struct mlxsw_sp_acl_atcam_chunk *achunk,\n\t\t\t\t   unsigned int priority);\nvoid mlxsw_sp_acl_atcam_chunk_fini(struct mlxsw_sp_acl_atcam_chunk *achunk);\nint mlxsw_sp_acl_atcam_entry_add(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t\t struct mlxsw_sp_acl_atcam_chunk *achunk,\n\t\t\t\t struct mlxsw_sp_acl_atcam_entry *aentry,\n\t\t\t\t struct mlxsw_sp_acl_rule_info *rulei);\nvoid mlxsw_sp_acl_atcam_entry_del(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t  struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t\t  struct mlxsw_sp_acl_atcam_chunk *achunk,\n\t\t\t\t  struct mlxsw_sp_acl_atcam_entry *aentry);\nint mlxsw_sp_acl_atcam_entry_action_replace(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\t\t    struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t\t\t    struct mlxsw_sp_acl_atcam_entry *aentry,\n\t\t\t\t\t    struct mlxsw_sp_acl_rule_info *rulei);\nint mlxsw_sp_acl_atcam_init(struct mlxsw_sp *mlxsw_sp,\n\t\t\t    struct mlxsw_sp_acl_atcam *atcam);\nvoid mlxsw_sp_acl_atcam_fini(struct mlxsw_sp *mlxsw_sp,\n\t\t\t     struct mlxsw_sp_acl_atcam *atcam);\nvoid *\nmlxsw_sp_acl_atcam_rehash_hints_get(struct mlxsw_sp_acl_atcam_region *aregion);\nvoid mlxsw_sp_acl_atcam_rehash_hints_put(void *hints_priv);\n\nstruct mlxsw_sp_acl_erp_delta;\n\nu16 mlxsw_sp_acl_erp_delta_start(const struct mlxsw_sp_acl_erp_delta *delta);\nu8 mlxsw_sp_acl_erp_delta_mask(const struct mlxsw_sp_acl_erp_delta *delta);\nu8 mlxsw_sp_acl_erp_delta_value(const struct mlxsw_sp_acl_erp_delta *delta,\n\t\t\t\tconst char *enc_key);\nvoid mlxsw_sp_acl_erp_delta_clear(const struct mlxsw_sp_acl_erp_delta *delta,\n\t\t\t\t  const char *enc_key);\n\nstruct mlxsw_sp_acl_erp_mask;\n\nbool\nmlxsw_sp_acl_erp_mask_is_ctcam(const struct mlxsw_sp_acl_erp_mask *erp_mask);\nu8 mlxsw_sp_acl_erp_mask_erp_id(const struct mlxsw_sp_acl_erp_mask *erp_mask);\nconst struct mlxsw_sp_acl_erp_delta *\nmlxsw_sp_acl_erp_delta(const struct mlxsw_sp_acl_erp_mask *erp_mask);\nstruct mlxsw_sp_acl_erp_mask *\nmlxsw_sp_acl_erp_mask_get(struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t  const char *mask, bool ctcam);\nvoid mlxsw_sp_acl_erp_mask_put(struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t       struct mlxsw_sp_acl_erp_mask *erp_mask);\nint mlxsw_sp_acl_erp_bf_insert(struct mlxsw_sp *mlxsw_sp,\n\t\t\t       struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t       struct mlxsw_sp_acl_erp_mask *erp_mask,\n\t\t\t       struct mlxsw_sp_acl_atcam_entry *aentry);\nvoid mlxsw_sp_acl_erp_bf_remove(struct mlxsw_sp *mlxsw_sp,\n\t\t\t\tstruct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t\tstruct mlxsw_sp_acl_erp_mask *erp_mask,\n\t\t\t\tstruct mlxsw_sp_acl_atcam_entry *aentry);\nvoid *\nmlxsw_sp_acl_erp_rehash_hints_get(struct mlxsw_sp_acl_atcam_region *aregion);\nvoid mlxsw_sp_acl_erp_rehash_hints_put(void *hints_priv);\nint mlxsw_sp_acl_erp_region_init(struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t\t void *hints_priv);\nvoid mlxsw_sp_acl_erp_region_fini(struct mlxsw_sp_acl_atcam_region *aregion);\nint mlxsw_sp_acl_erps_init(struct mlxsw_sp *mlxsw_sp,\n\t\t\t   struct mlxsw_sp_acl_atcam *atcam);\nvoid mlxsw_sp_acl_erps_fini(struct mlxsw_sp *mlxsw_sp,\n\t\t\t    struct mlxsw_sp_acl_atcam *atcam);\n\nstruct mlxsw_sp_acl_bf;\n\nstruct mlxsw_sp_acl_bf_ops {\n\tunsigned int (*index_get)(struct mlxsw_sp_acl_bf *bf,\n\t\t\t\t  struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t\t  struct mlxsw_sp_acl_atcam_entry *aentry);\n};\n\nint\nmlxsw_sp_acl_bf_entry_add(struct mlxsw_sp *mlxsw_sp,\n\t\t\t  struct mlxsw_sp_acl_bf *bf,\n\t\t\t  struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t  unsigned int erp_bank,\n\t\t\t  struct mlxsw_sp_acl_atcam_entry *aentry);\nvoid\nmlxsw_sp_acl_bf_entry_del(struct mlxsw_sp *mlxsw_sp,\n\t\t\t  struct mlxsw_sp_acl_bf *bf,\n\t\t\t  struct mlxsw_sp_acl_atcam_region *aregion,\n\t\t\t  unsigned int erp_bank,\n\t\t\t  struct mlxsw_sp_acl_atcam_entry *aentry);\nstruct mlxsw_sp_acl_bf *\nmlxsw_sp_acl_bf_init(struct mlxsw_sp *mlxsw_sp, unsigned int num_erp_banks);\nvoid mlxsw_sp_acl_bf_fini(struct mlxsw_sp_acl_bf *bf);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}