{
  "module_name": "spectrum_acl_flex_keys.c",
  "hash_id": "072c0e161c204bb6bf6cf00eab8ca8c793a1900578e55846ffb283c5ecf1626d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_flex_keys.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include \"spectrum.h\"\n#include \"item.h\"\n#include \"core_acl_flex_keys.h\"\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_l2_dmac[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DMAC_32_47, 0x00, 2),\n\tMLXSW_AFK_ELEMENT_INST_BUF(DMAC_0_31, 0x02, 4),\n\tMLXSW_AFK_ELEMENT_INST_U32(PCP, 0x08, 13, 3),\n\tMLXSW_AFK_ELEMENT_INST_U32(VID, 0x08, 0, 12),\n\tMLXSW_AFK_ELEMENT_INST_U32(SRC_SYS_PORT, 0x0C, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_l2_smac[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SMAC_32_47, 0x00, 2),\n\tMLXSW_AFK_ELEMENT_INST_BUF(SMAC_0_31, 0x02, 4),\n\tMLXSW_AFK_ELEMENT_INST_U32(PCP, 0x08, 13, 3),\n\tMLXSW_AFK_ELEMENT_INST_U32(VID, 0x08, 0, 12),\n\tMLXSW_AFK_ELEMENT_INST_U32(SRC_SYS_PORT, 0x0C, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_l2_smac_ex[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SMAC_32_47, 0x02, 2),\n\tMLXSW_AFK_ELEMENT_INST_BUF(SMAC_0_31, 0x04, 4),\n\tMLXSW_AFK_ELEMENT_INST_U32(ETHERTYPE, 0x0C, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_sip[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_0_31, 0x00, 4),\n\tMLXSW_AFK_ELEMENT_INST_U32(L4_PORT_RANGE, 0x04, 16, 16),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_PROTO, 0x08, 0, 8),\n\tMLXSW_AFK_ELEMENT_INST_U32(SRC_SYS_PORT, 0x0C, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_dip[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_0_31, 0x00, 4),\n\tMLXSW_AFK_ELEMENT_INST_U32(L4_PORT_RANGE, 0x04, 16, 16),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_PROTO, 0x08, 0, 8),\n\tMLXSW_AFK_ELEMENT_INST_U32(SRC_SYS_PORT, 0x0C, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_0_31, 0x00, 4),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_ECN, 0x04, 4, 2),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_TTL_, 0x04, 24, 8),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_DSCP, 0x08, 0, 6),\n\tMLXSW_AFK_ELEMENT_INST_U32(TCP_FLAGS, 0x08, 8, 9),  \n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_ex[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(VID, 0x00, 0, 12),\n\tMLXSW_AFK_ELEMENT_INST_U32(PCP, 0x08, 29, 3),\n\tMLXSW_AFK_ELEMENT_INST_U32(SRC_L4_PORT, 0x08, 0, 16),\n\tMLXSW_AFK_ELEMENT_INST_U32(DST_L4_PORT, 0x0C, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_dip[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_32_63, 0x00, 4),\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_0_31, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_ex1[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_96_127, 0x00, 4),\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_64_95, 0x04, 4),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_PROTO, 0x08, 0, 8),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_sip[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_32_63, 0x00, 4),\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_0_31, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_sip_ex[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_96_127, 0x00, 4),\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_64_95, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_packet_type[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(ETHERTYPE, 0x00, 0, 16),\n};\n\nstatic const struct mlxsw_afk_block mlxsw_sp1_afk_blocks[] = {\n\tMLXSW_AFK_BLOCK(0x10, mlxsw_sp_afk_element_info_l2_dmac),\n\tMLXSW_AFK_BLOCK(0x11, mlxsw_sp_afk_element_info_l2_smac),\n\tMLXSW_AFK_BLOCK(0x12, mlxsw_sp_afk_element_info_l2_smac_ex),\n\tMLXSW_AFK_BLOCK(0x30, mlxsw_sp_afk_element_info_ipv4_sip),\n\tMLXSW_AFK_BLOCK(0x31, mlxsw_sp_afk_element_info_ipv4_dip),\n\tMLXSW_AFK_BLOCK(0x32, mlxsw_sp_afk_element_info_ipv4),\n\tMLXSW_AFK_BLOCK(0x33, mlxsw_sp_afk_element_info_ipv4_ex),\n\tMLXSW_AFK_BLOCK(0x60, mlxsw_sp_afk_element_info_ipv6_dip),\n\tMLXSW_AFK_BLOCK(0x65, mlxsw_sp_afk_element_info_ipv6_ex1),\n\tMLXSW_AFK_BLOCK(0x62, mlxsw_sp_afk_element_info_ipv6_sip),\n\tMLXSW_AFK_BLOCK(0x63, mlxsw_sp_afk_element_info_ipv6_sip_ex),\n\tMLXSW_AFK_BLOCK(0xB0, mlxsw_sp_afk_element_info_packet_type),\n};\n\n#define MLXSW_SP1_AFK_KEY_BLOCK_SIZE 16\n\nstatic void mlxsw_sp1_afk_encode_block(char *output, int block_index,\n\t\t\t\t       char *block)\n{\n\tunsigned int offset = block_index * MLXSW_SP1_AFK_KEY_BLOCK_SIZE;\n\tchar *output_indexed = output + offset;\n\n\tmemcpy(output_indexed, block, MLXSW_SP1_AFK_KEY_BLOCK_SIZE);\n}\n\nstatic void mlxsw_sp1_afk_clear_block(char *output, int block_index)\n{\n\tunsigned int offset = block_index * MLXSW_SP1_AFK_KEY_BLOCK_SIZE;\n\tchar *output_indexed = output + offset;\n\n\tmemset(output_indexed, 0, MLXSW_SP1_AFK_KEY_BLOCK_SIZE);\n}\n\nconst struct mlxsw_afk_ops mlxsw_sp1_afk_ops = {\n\t.blocks\t\t= mlxsw_sp1_afk_blocks,\n\t.blocks_count\t= ARRAY_SIZE(mlxsw_sp1_afk_blocks),\n\t.encode_block\t= mlxsw_sp1_afk_encode_block,\n\t.clear_block\t= mlxsw_sp1_afk_clear_block,\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_mac_0[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(FDB_MISS, 0x00, 3, 1),\n\tMLXSW_AFK_ELEMENT_INST_BUF(DMAC_0_31, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_mac_1[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(FDB_MISS, 0x00, 3, 1),\n\tMLXSW_AFK_ELEMENT_INST_BUF(SMAC_0_31, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_mac_2[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SMAC_32_47, 0x04, 2),\n\tMLXSW_AFK_ELEMENT_INST_BUF(DMAC_32_47, 0x06, 2),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_mac_3[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(PCP, 0x00, 0, 3),\n\tMLXSW_AFK_ELEMENT_INST_U32(VID, 0x04, 16, 12),\n\tMLXSW_AFK_ELEMENT_INST_BUF(DMAC_32_47, 0x06, 2),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_mac_4[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(PCP, 0x00, 0, 3),\n\tMLXSW_AFK_ELEMENT_INST_U32(VID, 0x04, 16, 12),\n\tMLXSW_AFK_ELEMENT_INST_U32(ETHERTYPE, 0x04, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_mac_5[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(VID, 0x04, 16, 12),\n\tMLXSW_AFK_ELEMENT_INST_EXT_U32(SRC_SYS_PORT, 0x04, 0, 8, -1, true),  \n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_0[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_0_31, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_1[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_0_31, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_2[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_DSCP, 0x04, 0, 6),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_ECN, 0x04, 6, 2),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_TTL_, 0x04, 8, 8),\n\tMLXSW_AFK_ELEMENT_INST_U32(IP_PROTO, 0x04, 16, 8),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_4[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(VIRT_ROUTER_LSB, 0x04, 24, 8),\n\tMLXSW_AFK_ELEMENT_INST_EXT_U32(VIRT_ROUTER_MSB, 0x00, 0, 3, 0, true),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_0[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_32_63, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_1[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_64_95, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_2[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_96_127, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_3[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_32_63, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_4[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_64_95, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_5[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(SRC_IP_96_127, 0x04, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_l4_0[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(SRC_L4_PORT, 0x04, 16, 16),\n\tMLXSW_AFK_ELEMENT_INST_U32(DST_L4_PORT, 0x04, 0, 16),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_l4_2[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(TCP_FLAGS, 0x04, 16, 9),  \n\tMLXSW_AFK_ELEMENT_INST_U32(L4_PORT_RANGE, 0x04, 0, 16),\n};\n\nstatic const struct mlxsw_afk_block mlxsw_sp2_afk_blocks[] = {\n\tMLXSW_AFK_BLOCK(0x10, mlxsw_sp_afk_element_info_mac_0),\n\tMLXSW_AFK_BLOCK(0x11, mlxsw_sp_afk_element_info_mac_1),\n\tMLXSW_AFK_BLOCK(0x12, mlxsw_sp_afk_element_info_mac_2),\n\tMLXSW_AFK_BLOCK(0x13, mlxsw_sp_afk_element_info_mac_3),\n\tMLXSW_AFK_BLOCK(0x14, mlxsw_sp_afk_element_info_mac_4),\n\tMLXSW_AFK_BLOCK(0x15, mlxsw_sp_afk_element_info_mac_5),\n\tMLXSW_AFK_BLOCK(0x38, mlxsw_sp_afk_element_info_ipv4_0),\n\tMLXSW_AFK_BLOCK(0x39, mlxsw_sp_afk_element_info_ipv4_1),\n\tMLXSW_AFK_BLOCK(0x3A, mlxsw_sp_afk_element_info_ipv4_2),\n\tMLXSW_AFK_BLOCK(0x3C, mlxsw_sp_afk_element_info_ipv4_4),\n\tMLXSW_AFK_BLOCK(0x40, mlxsw_sp_afk_element_info_ipv6_0),\n\tMLXSW_AFK_BLOCK(0x41, mlxsw_sp_afk_element_info_ipv6_1),\n\tMLXSW_AFK_BLOCK(0x42, mlxsw_sp_afk_element_info_ipv6_2),\n\tMLXSW_AFK_BLOCK(0x43, mlxsw_sp_afk_element_info_ipv6_3),\n\tMLXSW_AFK_BLOCK(0x44, mlxsw_sp_afk_element_info_ipv6_4),\n\tMLXSW_AFK_BLOCK(0x45, mlxsw_sp_afk_element_info_ipv6_5),\n\tMLXSW_AFK_BLOCK(0x90, mlxsw_sp_afk_element_info_l4_0),\n\tMLXSW_AFK_BLOCK(0x92, mlxsw_sp_afk_element_info_l4_2),\n};\n\n#define MLXSW_SP2_AFK_BITS_PER_BLOCK 36\n\n \nMLXSW_ITEM64(sp2_afk, block, value, 0x00, 0, MLXSW_SP2_AFK_BITS_PER_BLOCK);\n\n \n\nstruct mlxsw_sp2_afk_block_layout {\n\tunsigned short offset;\n\tstruct mlxsw_item item;\n};\n\n#define MLXSW_SP2_AFK_BLOCK_LAYOUT(_block, _offset, _shift)\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\t\\\n\t\t.offset = _offset,\t\t\t\t\t\t\\\n\t\t{\t\t\t\t\t\t\t\t\\\n\t\t\t.shift = _shift,\t\t\t\t\t\\\n\t\t\t.size = {.bits = MLXSW_SP2_AFK_BITS_PER_BLOCK},\t\t\\\n\t\t\t.name = #_block,\t\t\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n\nstatic const struct mlxsw_sp2_afk_block_layout mlxsw_sp2_afk_blocks_layout[] = {\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block0, 0x30, 0),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block1, 0x2C, 4),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block2, 0x28, 8),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block3, 0x24, 12),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block4, 0x20, 16),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block5, 0x1C, 20),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block6, 0x18, 24),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block7, 0x14, 28),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block8, 0x0C, 0),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block9, 0x08, 4),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block10, 0x04, 8),\n\tMLXSW_SP2_AFK_BLOCK_LAYOUT(block11, 0x00, 12),\n};\n\nstatic void __mlxsw_sp2_afk_block_value_set(char *output, int block_index,\n\t\t\t\t\t    u64 block_value)\n{\n\tconst struct mlxsw_sp2_afk_block_layout *block_layout;\n\n\tif (WARN_ON(block_index < 0 ||\n\t\t    block_index >= ARRAY_SIZE(mlxsw_sp2_afk_blocks_layout)))\n\t\treturn;\n\n\tblock_layout = &mlxsw_sp2_afk_blocks_layout[block_index];\n\t__mlxsw_item_set64(output + block_layout->offset,\n\t\t\t   &block_layout->item, 0, block_value);\n}\n\nstatic void mlxsw_sp2_afk_encode_block(char *output, int block_index,\n\t\t\t\t       char *block)\n{\n\tu64 block_value = mlxsw_sp2_afk_block_value_get(block);\n\n\t__mlxsw_sp2_afk_block_value_set(output, block_index, block_value);\n}\n\nstatic void mlxsw_sp2_afk_clear_block(char *output, int block_index)\n{\n\t__mlxsw_sp2_afk_block_value_set(output, block_index, 0);\n}\n\nconst struct mlxsw_afk_ops mlxsw_sp2_afk_ops = {\n\t.blocks\t\t= mlxsw_sp2_afk_blocks,\n\t.blocks_count\t= ARRAY_SIZE(mlxsw_sp2_afk_blocks),\n\t.encode_block\t= mlxsw_sp2_afk_encode_block,\n\t.clear_block\t= mlxsw_sp2_afk_clear_block,\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_mac_5b[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(VID, 0x04, 18, 12),\n\tMLXSW_AFK_ELEMENT_INST_EXT_U32(SRC_SYS_PORT, 0x04, 0, 9, -1, true),  \n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv4_4b[] = {\n\tMLXSW_AFK_ELEMENT_INST_U32(VIRT_ROUTER_LSB, 0x04, 13, 8),\n\tMLXSW_AFK_ELEMENT_INST_U32(VIRT_ROUTER_MSB, 0x04, 21, 4),\n};\n\nstatic struct mlxsw_afk_element_inst mlxsw_sp_afk_element_info_ipv6_2b[] = {\n\tMLXSW_AFK_ELEMENT_INST_BUF(DST_IP_96_127, 0x04, 4),\n};\n\nstatic const struct mlxsw_afk_block mlxsw_sp4_afk_blocks[] = {\n\tMLXSW_AFK_BLOCK(0x10, mlxsw_sp_afk_element_info_mac_0),\n\tMLXSW_AFK_BLOCK(0x11, mlxsw_sp_afk_element_info_mac_1),\n\tMLXSW_AFK_BLOCK(0x12, mlxsw_sp_afk_element_info_mac_2),\n\tMLXSW_AFK_BLOCK(0x13, mlxsw_sp_afk_element_info_mac_3),\n\tMLXSW_AFK_BLOCK(0x14, mlxsw_sp_afk_element_info_mac_4),\n\tMLXSW_AFK_BLOCK(0x1A, mlxsw_sp_afk_element_info_mac_5b),\n\tMLXSW_AFK_BLOCK(0x38, mlxsw_sp_afk_element_info_ipv4_0),\n\tMLXSW_AFK_BLOCK(0x39, mlxsw_sp_afk_element_info_ipv4_1),\n\tMLXSW_AFK_BLOCK(0x3A, mlxsw_sp_afk_element_info_ipv4_2),\n\tMLXSW_AFK_BLOCK(0x35, mlxsw_sp_afk_element_info_ipv4_4b),\n\tMLXSW_AFK_BLOCK(0x40, mlxsw_sp_afk_element_info_ipv6_0),\n\tMLXSW_AFK_BLOCK(0x41, mlxsw_sp_afk_element_info_ipv6_1),\n\tMLXSW_AFK_BLOCK(0x47, mlxsw_sp_afk_element_info_ipv6_2b),\n\tMLXSW_AFK_BLOCK(0x43, mlxsw_sp_afk_element_info_ipv6_3),\n\tMLXSW_AFK_BLOCK(0x44, mlxsw_sp_afk_element_info_ipv6_4),\n\tMLXSW_AFK_BLOCK(0x45, mlxsw_sp_afk_element_info_ipv6_5),\n\tMLXSW_AFK_BLOCK(0x90, mlxsw_sp_afk_element_info_l4_0),\n\tMLXSW_AFK_BLOCK(0x92, mlxsw_sp_afk_element_info_l4_2),\n};\n\nconst struct mlxsw_afk_ops mlxsw_sp4_afk_ops = {\n\t.blocks\t\t= mlxsw_sp4_afk_blocks,\n\t.blocks_count\t= ARRAY_SIZE(mlxsw_sp4_afk_blocks),\n\t.encode_block\t= mlxsw_sp2_afk_encode_block,\n\t.clear_block\t= mlxsw_sp2_afk_clear_block,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}