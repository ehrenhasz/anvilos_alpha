{
  "module_name": "pci_hw.h",
  "hash_id": "142d61f93e7aff7a8d29ef630a5c68bc65597f5457c20e291e25bc06bcd82d87",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxsw/pci_hw.h",
  "human_readable_source": " \n \n\n#ifndef _MLXSW_PCI_HW_H\n#define _MLXSW_PCI_HW_H\n\n#include <linux/bitops.h>\n\n#include \"item.h\"\n\n#define MLXSW_PCI_BAR0_SIZE\t\t(1024 * 1024)  \n#define MLXSW_PCI_PAGE_SIZE\t\t4096\n\n#define MLXSW_PCI_CIR_BASE\t\t\t0x71000\n#define MLXSW_PCI_CIR_IN_PARAM_HI\t\tMLXSW_PCI_CIR_BASE\n#define MLXSW_PCI_CIR_IN_PARAM_LO\t\t(MLXSW_PCI_CIR_BASE + 0x04)\n#define MLXSW_PCI_CIR_IN_MODIFIER\t\t(MLXSW_PCI_CIR_BASE + 0x08)\n#define MLXSW_PCI_CIR_OUT_PARAM_HI\t\t(MLXSW_PCI_CIR_BASE + 0x0C)\n#define MLXSW_PCI_CIR_OUT_PARAM_LO\t\t(MLXSW_PCI_CIR_BASE + 0x10)\n#define MLXSW_PCI_CIR_TOKEN\t\t\t(MLXSW_PCI_CIR_BASE + 0x14)\n#define MLXSW_PCI_CIR_CTRL\t\t\t(MLXSW_PCI_CIR_BASE + 0x18)\n#define MLXSW_PCI_CIR_CTRL_GO_BIT\t\tBIT(23)\n#define MLXSW_PCI_CIR_CTRL_EVREQ_BIT\t\tBIT(22)\n#define MLXSW_PCI_CIR_CTRL_OPCODE_MOD_SHIFT\t12\n#define MLXSW_PCI_CIR_CTRL_STATUS_SHIFT\t\t24\n#define MLXSW_PCI_CIR_TIMEOUT_MSECS\t\t1000\n\n#define MLXSW_PCI_SW_RESET_TIMEOUT_MSECS\t900000\n#define MLXSW_PCI_SW_RESET_WAIT_MSECS\t\t400\n#define MLXSW_PCI_FW_READY\t\t\t0xA1844\n#define MLXSW_PCI_FW_READY_MASK\t\t\t0xFFFF\n#define MLXSW_PCI_FW_READY_MAGIC\t\t0x5E\n\n#define MLXSW_PCI_DOORBELL_SDQ_OFFSET\t\t0x000\n#define MLXSW_PCI_DOORBELL_RDQ_OFFSET\t\t0x200\n#define MLXSW_PCI_DOORBELL_CQ_OFFSET\t\t0x400\n#define MLXSW_PCI_DOORBELL_EQ_OFFSET\t\t0x600\n#define MLXSW_PCI_DOORBELL_ARM_CQ_OFFSET\t0x800\n#define MLXSW_PCI_DOORBELL_ARM_EQ_OFFSET\t0xA00\n\n#define MLXSW_PCI_DOORBELL(offset, type_offset, num)\t\\\n\t((offset) + (type_offset) + (num) * 4)\n\n#define MLXSW_PCI_CQS_MAX\t96\n#define MLXSW_PCI_EQS_COUNT\t2\n#define MLXSW_PCI_EQ_ASYNC_NUM\t0\n#define MLXSW_PCI_EQ_COMP_NUM\t1\n\n#define MLXSW_PCI_SDQS_MIN\t2  \n#define MLXSW_PCI_SDQ_EMAD_INDEX\t0\n#define MLXSW_PCI_SDQ_EMAD_TC\t0\n#define MLXSW_PCI_SDQ_CTL_TC\t3\n\n#define MLXSW_PCI_AQ_PAGES\t8\n#define MLXSW_PCI_AQ_SIZE\t(MLXSW_PCI_PAGE_SIZE * MLXSW_PCI_AQ_PAGES)\n#define MLXSW_PCI_WQE_SIZE\t32  \n#define MLXSW_PCI_CQE01_SIZE\t16  \n#define MLXSW_PCI_CQE2_SIZE\t32  \n#define MLXSW_PCI_CQE_SIZE_MAX\tMLXSW_PCI_CQE2_SIZE\n#define MLXSW_PCI_EQE_SIZE\t16  \n#define MLXSW_PCI_WQE_COUNT\t(MLXSW_PCI_AQ_SIZE / MLXSW_PCI_WQE_SIZE)\n#define MLXSW_PCI_CQE01_COUNT\t(MLXSW_PCI_AQ_SIZE / MLXSW_PCI_CQE01_SIZE)\n#define MLXSW_PCI_CQE2_COUNT\t(MLXSW_PCI_AQ_SIZE / MLXSW_PCI_CQE2_SIZE)\n#define MLXSW_PCI_EQE_COUNT\t(MLXSW_PCI_AQ_SIZE / MLXSW_PCI_EQE_SIZE)\n#define MLXSW_PCI_EQE_UPDATE_COUNT\t0x80\n\n#define MLXSW_PCI_WQE_SG_ENTRIES\t3\n#define MLXSW_PCI_WQE_TYPE_ETHERNET\t0xA\n\n \nMLXSW_ITEM32(pci, wqe, c, 0x00, 31, 1);\n\n \nMLXSW_ITEM32(pci, wqe, lp, 0x00, 30, 1);\n\n \nMLXSW_ITEM32(pci, wqe, type, 0x00, 23, 4);\n\n \nMLXSW_ITEM16_INDEXED(pci, wqe, byte_count, 0x02, 0, 14, 0x02, 0x00, false);\n\n \nMLXSW_ITEM64_INDEXED(pci, wqe, address, 0x08, 0, 64, 0x8, 0x0, false);\n\nenum mlxsw_pci_cqe_v {\n\tMLXSW_PCI_CQE_V0,\n\tMLXSW_PCI_CQE_V1,\n\tMLXSW_PCI_CQE_V2,\n};\n\n#define mlxsw_pci_cqe_item_helpers(name, v0, v1, v2)\t\t\t\t\\\nstatic inline u32 mlxsw_pci_cqe_##name##_get(enum mlxsw_pci_cqe_v v, char *cqe)\t\\\n{\t\t\t\t\t\t\t\t\t\t\\\n\tswitch (v) {\t\t\t\t\t\t\t\t\\\n\tdefault:\t\t\t\t\t\t\t\t\\\n\tcase MLXSW_PCI_CQE_V0:\t\t\t\t\t\t\t\\\n\t\treturn mlxsw_pci_cqe##v0##_##name##_get(cqe);\t\t\t\\\n\tcase MLXSW_PCI_CQE_V1:\t\t\t\t\t\t\t\\\n\t\treturn mlxsw_pci_cqe##v1##_##name##_get(cqe);\t\t\t\\\n\tcase MLXSW_PCI_CQE_V2:\t\t\t\t\t\t\t\\\n\t\treturn mlxsw_pci_cqe##v2##_##name##_get(cqe);\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n}\t\t\t\t\t\t\t\t\t\t\\\nstatic inline void mlxsw_pci_cqe_##name##_set(enum mlxsw_pci_cqe_v v,\t\t\\\n\t\t\t\t\t      char *cqe, u32 val)\t\t\\\n{\t\t\t\t\t\t\t\t\t\t\\\n\tswitch (v) {\t\t\t\t\t\t\t\t\\\n\tdefault:\t\t\t\t\t\t\t\t\\\n\tcase MLXSW_PCI_CQE_V0:\t\t\t\t\t\t\t\\\n\t\tmlxsw_pci_cqe##v0##_##name##_set(cqe, val);\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\t\\\n\tcase MLXSW_PCI_CQE_V1:\t\t\t\t\t\t\t\\\n\t\tmlxsw_pci_cqe##v1##_##name##_set(cqe, val);\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\t\\\n\tcase MLXSW_PCI_CQE_V2:\t\t\t\t\t\t\t\\\n\t\tmlxsw_pci_cqe##v2##_##name##_set(cqe, val);\t\t\t\\\n\t\tbreak;\t\t\t\t\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\t\\\n}\n\n \nMLXSW_ITEM32(pci, cqe0, lag, 0x00, 23, 1);\nMLXSW_ITEM32(pci, cqe12, lag, 0x00, 24, 1);\nmlxsw_pci_cqe_item_helpers(lag, 0, 12, 12);\n\n \nMLXSW_ITEM32(pci, cqe, system_port, 0x00, 0, 16);\nMLXSW_ITEM32(pci, cqe0, lag_id, 0x00, 4, 12);\nMLXSW_ITEM32(pci, cqe12, lag_id, 0x00, 0, 16);\nmlxsw_pci_cqe_item_helpers(lag_id, 0, 12, 12);\nMLXSW_ITEM32(pci, cqe0, lag_subport, 0x00, 0, 4);\nMLXSW_ITEM32(pci, cqe12, lag_subport, 0x00, 16, 8);\nmlxsw_pci_cqe_item_helpers(lag_subport, 0, 12, 12);\n\n \nMLXSW_ITEM32(pci, cqe, wqe_counter, 0x04, 16, 16);\n\n \nMLXSW_ITEM32(pci, cqe, byte_count, 0x04, 0, 14);\n\n#define MLXSW_PCI_CQE2_MIRROR_CONG_INVALID\t0xFFFF\n\n \nMLXSW_ITEM32(pci, cqe2, mirror_cong_high, 0x08, 16, 4);\n\n \nMLXSW_ITEM32(pci, cqe, trap_id, 0x08, 0, 10);\n\n \nMLXSW_ITEM32(pci, cqe0, crc, 0x0C, 8, 1);\nMLXSW_ITEM32(pci, cqe12, crc, 0x0C, 9, 1);\nmlxsw_pci_cqe_item_helpers(crc, 0, 12, 12);\n\n \nMLXSW_ITEM32(pci, cqe0, e, 0x0C, 7, 1);\nMLXSW_ITEM32(pci, cqe12, e, 0x00, 27, 1);\nmlxsw_pci_cqe_item_helpers(e, 0, 12, 12);\n\n \nMLXSW_ITEM32(pci, cqe0, sr, 0x0C, 6, 1);\nMLXSW_ITEM32(pci, cqe12, sr, 0x00, 26, 1);\nmlxsw_pci_cqe_item_helpers(sr, 0, 12, 12);\n\n \nMLXSW_ITEM32(pci, cqe0, dqn, 0x0C, 1, 5);\nMLXSW_ITEM32(pci, cqe12, dqn, 0x0C, 1, 6);\nmlxsw_pci_cqe_item_helpers(dqn, 0, 12, 12);\n\n \nMLXSW_ITEM32(pci, cqe2, time_stamp_low, 0x0C, 16, 16);\n\n#define MLXSW_PCI_CQE2_MIRROR_TCLASS_INVALID\t0x1F\n\n \nMLXSW_ITEM32(pci, cqe2, mirror_tclass, 0x10, 27, 5);\n\n \nMLXSW_ITEM32(pci, cqe2, tx_lag, 0x10, 24, 1);\n\n \nMLXSW_ITEM32(pci, cqe2, tx_lag_subport, 0x10, 16, 8);\n\n#define MLXSW_PCI_CQE2_TX_PORT_MULTI_PORT\t0xFFFE\n#define MLXSW_PCI_CQE2_TX_PORT_INVALID\t\t0xFFFF\n\n \nMLXSW_ITEM32(pci, cqe2, tx_lag_id, 0x10, 0, 16);\n\n \nMLXSW_ITEM32(pci, cqe2, tx_system_port, 0x10, 0, 16);\n\n \nMLXSW_ITEM32(pci, cqe2, mirror_cong_low, 0x14, 20, 12);\n\n#define MLXSW_PCI_CQE2_MIRROR_CONG_SHIFT\t13\t \n\nstatic inline u16 mlxsw_pci_cqe2_mirror_cong_get(const char *cqe)\n{\n\tu16 cong_high = mlxsw_pci_cqe2_mirror_cong_high_get(cqe);\n\tu16 cong_low = mlxsw_pci_cqe2_mirror_cong_low_get(cqe);\n\n\treturn cong_high << 12 | cong_low;\n}\n\n \nMLXSW_ITEM32(pci, cqe2, user_def_val_orig_pkt_len, 0x14, 0, 20);\n\n \nMLXSW_ITEM32(pci, cqe2, mirror_reason, 0x18, 24, 8);\n\nenum mlxsw_pci_cqe_time_stamp_type {\n\tMLXSW_PCI_CQE_TIME_STAMP_TYPE_USEC,\n\tMLXSW_PCI_CQE_TIME_STAMP_TYPE_FRC,\n\tMLXSW_PCI_CQE_TIME_STAMP_TYPE_UTC,\n\tMLXSW_PCI_CQE_TIME_STAMP_TYPE_MIRROR_UTC,\n};\n\n \nMLXSW_ITEM32(pci, cqe2, time_stamp_type, 0x18, 22, 2);\n\n#define MLXSW_PCI_CQE2_MIRROR_LATENCY_INVALID\t0xFFFFFF\n\n \nMLXSW_ITEM32(pci, cqe2, time_stamp_high, 0x18, 0, 22);\n\nstatic inline u64 mlxsw_pci_cqe2_time_stamp_get(const char *cqe)\n{\n\tu64 ts_high = mlxsw_pci_cqe2_time_stamp_high_get(cqe);\n\tu64 ts_low = mlxsw_pci_cqe2_time_stamp_low_get(cqe);\n\n\treturn ts_high << 16 | ts_low;\n}\n\nstatic inline u8 mlxsw_pci_cqe2_time_stamp_sec_get(const char *cqe)\n{\n\tu64 full_ts = mlxsw_pci_cqe2_time_stamp_get(cqe);\n\n\treturn full_ts >> 30 & 0xFF;\n}\n\nstatic inline u32 mlxsw_pci_cqe2_time_stamp_nsec_get(const char *cqe)\n{\n\tu64 full_ts = mlxsw_pci_cqe2_time_stamp_get(cqe);\n\n\treturn full_ts & 0x3FFFFFFF;\n}\n\n \nMLXSW_ITEM32(pci, cqe2, mirror_latency, 0x1C, 8, 24);\n\n \nMLXSW_ITEM32(pci, cqe01, owner, 0x0C, 0, 1);\nMLXSW_ITEM32(pci, cqe2, owner, 0x1C, 0, 1);\nmlxsw_pci_cqe_item_helpers(owner, 01, 01, 2);\n\n \nMLXSW_ITEM32(pci, eqe, event_type, 0x0C, 24, 8);\n#define MLXSW_PCI_EQE_EVENT_TYPE_COMP\t0x00\n#define MLXSW_PCI_EQE_EVENT_TYPE_CMD\t0x0A\n\n \nMLXSW_ITEM32(pci, eqe, event_sub_type, 0x0C, 16, 8);\n\n \nMLXSW_ITEM32(pci, eqe, cqn, 0x0C, 8, 7);\n\n \nMLXSW_ITEM32(pci, eqe, owner, 0x0C, 0, 1);\n\n \nMLXSW_ITEM32(pci, eqe, cmd_token, 0x00, 16, 16);\n\n \nMLXSW_ITEM32(pci, eqe, cmd_status, 0x00, 0, 8);\n\n \nMLXSW_ITEM32(pci, eqe, cmd_out_param_h, 0x04, 0, 32);\n\n \nMLXSW_ITEM32(pci, eqe, cmd_out_param_l, 0x08, 0, 32);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}