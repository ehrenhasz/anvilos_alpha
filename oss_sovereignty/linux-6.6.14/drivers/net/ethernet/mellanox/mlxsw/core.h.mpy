{
  "module_name": "core.h",
  "hash_id": "b94b1bf16f2c94bb4daf7337aeb1d503c8078351a694e8d7780198575718a995",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxsw/core.h",
  "human_readable_source": " \n \n\n#ifndef _MLXSW_CORE_H\n#define _MLXSW_CORE_H\n\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/slab.h>\n#include <linux/gfp.h>\n#include <linux/types.h>\n#include <linux/skbuff.h>\n#include <linux/workqueue.h>\n#include <linux/net_namespace.h>\n#include <linux/auxiliary_bus.h>\n#include <net/devlink.h>\n\n#include \"trap.h\"\n#include \"reg.h\"\n#include \"cmd.h\"\n#include \"resources.h\"\n#include \"../mlxfw/mlxfw.h\"\n\nenum mlxsw_core_resource_id {\n\tMLXSW_CORE_RESOURCE_PORTS = 1,\n\tMLXSW_CORE_RESOURCE_MAX,\n};\n\nstruct mlxsw_core;\nstruct mlxsw_core_port;\nstruct mlxsw_driver;\nstruct mlxsw_bus;\nstruct mlxsw_bus_info;\nstruct mlxsw_fw_rev;\n\nunsigned int mlxsw_core_max_ports(const struct mlxsw_core *mlxsw_core);\n\nint mlxsw_core_max_lag(struct mlxsw_core *mlxsw_core, u16 *p_max_lag);\n\nvoid *mlxsw_core_driver_priv(struct mlxsw_core *mlxsw_core);\n\nstruct mlxsw_linecards *mlxsw_core_linecards(struct mlxsw_core *mlxsw_core);\n\nvoid mlxsw_core_linecards_set(struct mlxsw_core *mlxsw_core,\n\t\t\t      struct mlxsw_linecards *linecard);\n\nbool\nmlxsw_core_fw_rev_minor_subminor_validate(const struct mlxsw_fw_rev *rev,\n\t\t\t\t\t  const struct mlxsw_fw_rev *req_rev);\n\nint mlxsw_core_driver_register(struct mlxsw_driver *mlxsw_driver);\nvoid mlxsw_core_driver_unregister(struct mlxsw_driver *mlxsw_driver);\n\nint mlxsw_core_fw_flash(struct mlxsw_core *mlxsw_core,\n\t\t\tstruct mlxfw_dev *mlxfw_dev,\n\t\t\tconst struct firmware *firmware,\n\t\t\tstruct netlink_ext_ack *extack);\n\nint mlxsw_core_bus_device_register(const struct mlxsw_bus_info *mlxsw_bus_info,\n\t\t\t\t   const struct mlxsw_bus *mlxsw_bus,\n\t\t\t\t   void *bus_priv, bool reload,\n\t\t\t\t   struct devlink *devlink,\n\t\t\t\t   struct netlink_ext_ack *extack);\nvoid mlxsw_core_bus_device_unregister(struct mlxsw_core *mlxsw_core, bool reload);\n\nstruct mlxsw_tx_info {\n\tu16 local_port;\n\tbool is_emad;\n};\n\nstruct mlxsw_rx_md_info {\n\tu32 cookie_index;\n\tu32 latency;\n\tu32 tx_congestion;\n\tunion {\n\t\t \n\t\tu16 tx_sys_port;\n\t\tu16 tx_lag_id;\n\t};\n\tu16 tx_lag_port_index;  \n\tu8 tx_tc;\n\tu8 latency_valid:1,\n\t   tx_congestion_valid:1,\n\t   tx_tc_valid:1,\n\t   tx_port_valid:1,\n\t   tx_port_is_lag:1,\n\t   unused:3;\n};\n\nbool mlxsw_core_skb_transmit_busy(struct mlxsw_core *mlxsw_core,\n\t\t\t\t  const struct mlxsw_tx_info *tx_info);\nint mlxsw_core_skb_transmit(struct mlxsw_core *mlxsw_core, struct sk_buff *skb,\n\t\t\t    const struct mlxsw_tx_info *tx_info);\nvoid mlxsw_core_ptp_transmitted(struct mlxsw_core *mlxsw_core,\n\t\t\t\tstruct sk_buff *skb, u16 local_port);\n\nstruct mlxsw_rx_listener {\n\tvoid (*func)(struct sk_buff *skb, u16 local_port, void *priv);\n\tu16 local_port;\n\tu8 mirror_reason;\n\tu16 trap_id;\n};\n\nstruct mlxsw_event_listener {\n\tvoid (*func)(const struct mlxsw_reg_info *reg,\n\t\t     char *payload, void *priv);\n\tenum mlxsw_event_trap_id trap_id;\n};\n\nstruct mlxsw_listener {\n\tu16 trap_id;\n\tunion {\n\t\tstruct mlxsw_rx_listener rx_listener;\n\t\tstruct mlxsw_event_listener event_listener;\n\t};\n\tenum mlxsw_reg_hpkt_action en_action;  \n\tenum mlxsw_reg_hpkt_action dis_action;  \n\tu8 en_trap_group;  \n\tu8 dis_trap_group;  \n\tu8 is_ctrl:1,  \n\t   is_event:1,\n\t   enabled_on_register:1;  \n};\n\n#define __MLXSW_RXL(_func, _trap_id, _en_action, _is_ctrl, _en_trap_group,\t\\\n\t\t    _dis_action, _enabled_on_register, _dis_trap_group,\t\t\\\n\t\t    _mirror_reason)\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\t\\\n\t\t.trap_id = MLXSW_TRAP_ID_##_trap_id,\t\t\t\t\\\n\t\t.rx_listener =\t\t\t\t\t\t\t\\\n\t\t{\t\t\t\t\t\t\t\t\\\n\t\t\t.func = _func,\t\t\t\t\t\t\\\n\t\t\t.local_port = MLXSW_PORT_DONT_CARE,\t\t\t\\\n\t\t\t.mirror_reason = _mirror_reason,\t\t\t\\\n\t\t\t.trap_id = MLXSW_TRAP_ID_##_trap_id,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\t\\\n\t\t.en_action = MLXSW_REG_HPKT_ACTION_##_en_action,\t\t\\\n\t\t.dis_action = MLXSW_REG_HPKT_ACTION_##_dis_action,\t\t\\\n\t\t.en_trap_group = MLXSW_REG_HTGT_TRAP_GROUP_##_en_trap_group,\t\\\n\t\t.dis_trap_group = MLXSW_REG_HTGT_TRAP_GROUP_##_dis_trap_group,\t\\\n\t\t.is_ctrl = _is_ctrl,\t\t\t\t\t\t\\\n\t\t.enabled_on_register = _enabled_on_register,\t\t\t\\\n\t}\n\n#define MLXSW_RXL(_func, _trap_id, _en_action, _is_ctrl, _trap_group,\t\t\\\n\t\t  _dis_action)\t\t\t\t\t\t\t\\\n\t__MLXSW_RXL(_func, _trap_id, _en_action, _is_ctrl, _trap_group,\t\t\\\n\t\t    _dis_action, true, _trap_group, 0)\n\n#define MLXSW_RXL_DIS(_func, _trap_id, _en_action, _is_ctrl, _en_trap_group,\t\\\n\t\t      _dis_action, _dis_trap_group)\t\t\t\t\\\n\t__MLXSW_RXL(_func, _trap_id, _en_action, _is_ctrl, _en_trap_group,\t\\\n\t\t    _dis_action, false, _dis_trap_group, 0)\n\n#define MLXSW_RXL_MIRROR(_func, _session_id, _trap_group, _mirror_reason)\t\\\n\t__MLXSW_RXL(_func, MIRROR_SESSION##_session_id,\tTRAP_TO_CPU, false,\t\\\n\t\t    _trap_group, TRAP_TO_CPU, true, _trap_group,\t\t\\\n\t\t    _mirror_reason)\n\n#define MLXSW_EVENTL(_func, _trap_id, _trap_group)\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\t\\\n\t\t.trap_id = MLXSW_TRAP_ID_##_trap_id,\t\t\t\t\\\n\t\t.event_listener =\t\t\t\t\t\t\\\n\t\t{\t\t\t\t\t\t\t\t\\\n\t\t\t.func = _func,\t\t\t\t\t\t\\\n\t\t\t.trap_id = MLXSW_TRAP_ID_##_trap_id,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\t\\\n\t\t.en_action = MLXSW_REG_HPKT_ACTION_TRAP_TO_CPU,\t\t\t\\\n\t\t.en_trap_group = MLXSW_REG_HTGT_TRAP_GROUP_##_trap_group,\t\\\n\t\t.is_event = true,\t\t\t\t\t\t\\\n\t\t.enabled_on_register = true,\t\t\t\t\t\\\n\t}\n\n#define MLXSW_CORE_EVENTL(_func, _trap_id)\t\t\\\n\tMLXSW_EVENTL(_func, _trap_id, CORE_EVENT)\n\nint mlxsw_core_rx_listener_register(struct mlxsw_core *mlxsw_core,\n\t\t\t\t    const struct mlxsw_rx_listener *rxl,\n\t\t\t\t    void *priv, bool enabled);\nvoid mlxsw_core_rx_listener_unregister(struct mlxsw_core *mlxsw_core,\n\t\t\t\t       const struct mlxsw_rx_listener *rxl);\n\nint mlxsw_core_event_listener_register(struct mlxsw_core *mlxsw_core,\n\t\t\t\t       const struct mlxsw_event_listener *el,\n\t\t\t\t       void *priv);\nvoid mlxsw_core_event_listener_unregister(struct mlxsw_core *mlxsw_core,\n\t\t\t\t\t  const struct mlxsw_event_listener *el);\n\nint mlxsw_core_trap_register(struct mlxsw_core *mlxsw_core,\n\t\t\t     const struct mlxsw_listener *listener,\n\t\t\t     void *priv);\nvoid mlxsw_core_trap_unregister(struct mlxsw_core *mlxsw_core,\n\t\t\t\tconst struct mlxsw_listener *listener,\n\t\t\t\tvoid *priv);\nint mlxsw_core_traps_register(struct mlxsw_core *mlxsw_core,\n\t\t\t      const struct mlxsw_listener *listeners,\n\t\t\t      size_t listeners_count, void *priv);\nvoid mlxsw_core_traps_unregister(struct mlxsw_core *mlxsw_core,\n\t\t\t\t const struct mlxsw_listener *listeners,\n\t\t\t\t size_t listeners_count, void *priv);\nint mlxsw_core_trap_state_set(struct mlxsw_core *mlxsw_core,\n\t\t\t      const struct mlxsw_listener *listener,\n\t\t\t      bool enabled);\n\ntypedef void mlxsw_reg_trans_cb_t(struct mlxsw_core *mlxsw_core, char *payload,\n\t\t\t\t  size_t payload_len, unsigned long cb_priv);\n\nint mlxsw_reg_trans_query(struct mlxsw_core *mlxsw_core,\n\t\t\t  const struct mlxsw_reg_info *reg, char *payload,\n\t\t\t  struct list_head *bulk_list,\n\t\t\t  mlxsw_reg_trans_cb_t *cb, unsigned long cb_priv);\nint mlxsw_reg_trans_write(struct mlxsw_core *mlxsw_core,\n\t\t\t  const struct mlxsw_reg_info *reg, char *payload,\n\t\t\t  struct list_head *bulk_list,\n\t\t\t  mlxsw_reg_trans_cb_t *cb, unsigned long cb_priv);\nint mlxsw_reg_trans_bulk_wait(struct list_head *bulk_list);\n\ntypedef void mlxsw_irq_event_cb_t(struct mlxsw_core *mlxsw_core);\n\nint mlxsw_core_irq_event_handler_register(struct mlxsw_core *mlxsw_core,\n\t\t\t\t\t  mlxsw_irq_event_cb_t cb);\nvoid mlxsw_core_irq_event_handler_unregister(struct mlxsw_core *mlxsw_core,\n\t\t\t\t\t     mlxsw_irq_event_cb_t cb);\nvoid mlxsw_core_irq_event_handlers_call(struct mlxsw_core *mlxsw_core);\n\nint mlxsw_reg_query(struct mlxsw_core *mlxsw_core,\n\t\t    const struct mlxsw_reg_info *reg, char *payload);\nint mlxsw_reg_write(struct mlxsw_core *mlxsw_core,\n\t\t    const struct mlxsw_reg_info *reg, char *payload);\n\nstruct mlxsw_rx_info {\n\tbool is_lag;\n\tunion {\n\t\tu16 sys_port;\n\t\tu16 lag_id;\n\t} u;\n\tu16 lag_port_index;\n\tu8 mirror_reason;\n\tint trap_id;\n};\n\nvoid mlxsw_core_skb_receive(struct mlxsw_core *mlxsw_core, struct sk_buff *skb,\n\t\t\t    struct mlxsw_rx_info *rx_info);\n\nvoid mlxsw_core_lag_mapping_set(struct mlxsw_core *mlxsw_core,\n\t\t\t\tu16 lag_id, u8 port_index, u16 local_port);\nu16 mlxsw_core_lag_mapping_get(struct mlxsw_core *mlxsw_core,\n\t\t\t       u16 lag_id, u8 port_index);\nvoid mlxsw_core_lag_mapping_clear(struct mlxsw_core *mlxsw_core,\n\t\t\t\t  u16 lag_id, u16 local_port);\n\nvoid *mlxsw_core_port_driver_priv(struct mlxsw_core_port *mlxsw_core_port);\nint mlxsw_core_port_init(struct mlxsw_core *mlxsw_core, u16 local_port,\n\t\t\t u8 slot_index, u32 port_number, bool split,\n\t\t\t u32 split_port_subnumber,\n\t\t\t bool splittable, u32 lanes,\n\t\t\t const unsigned char *switch_id,\n\t\t\t unsigned char switch_id_len);\nvoid mlxsw_core_port_fini(struct mlxsw_core *mlxsw_core, u16 local_port);\nint mlxsw_core_cpu_port_init(struct mlxsw_core *mlxsw_core,\n\t\t\t     void *port_driver_priv,\n\t\t\t     const unsigned char *switch_id,\n\t\t\t     unsigned char switch_id_len);\nvoid mlxsw_core_cpu_port_fini(struct mlxsw_core *mlxsw_core);\nvoid mlxsw_core_port_netdev_link(struct mlxsw_core *mlxsw_core, u16 local_port,\n\t\t\t\t void *port_driver_priv,\n\t\t\t\t struct net_device *dev);\nstruct devlink_port *\nmlxsw_core_port_devlink_port_get(struct mlxsw_core *mlxsw_core,\n\t\t\t\t u16 local_port);\nstruct mlxsw_linecard *\nmlxsw_core_port_linecard_get(struct mlxsw_core *mlxsw_core,\n\t\t\t     u16 local_port);\nvoid mlxsw_core_ports_remove_selected(struct mlxsw_core *mlxsw_core,\n\t\t\t\t      bool (*selector)(void *priv,\n\t\t\t\t\t\t       u16 local_port),\n\t\t\t\t      void *priv);\nstruct mlxsw_env *mlxsw_core_env(const struct mlxsw_core *mlxsw_core);\n\nint mlxsw_core_schedule_dw(struct delayed_work *dwork, unsigned long delay);\nbool mlxsw_core_schedule_work(struct work_struct *work);\nvoid mlxsw_core_flush_owq(void);\nint mlxsw_core_resources_query(struct mlxsw_core *mlxsw_core, char *mbox,\n\t\t\t       struct mlxsw_res *res);\n\n#define MLXSW_CONFIG_PROFILE_SWID_COUNT 8\n\nstruct mlxsw_swid_config {\n\tu8\tused_type:1,\n\t\tused_properties:1;\n\tu8\ttype;\n\tu8\tproperties;\n};\n\nstruct mlxsw_config_profile {\n\tu16\tused_max_vepa_channels:1,\n\t\tused_max_lag:1,\n\t\tused_max_mid:1,\n\t\tused_max_pgt:1,\n\t\tused_max_system_port:1,\n\t\tused_max_vlan_groups:1,\n\t\tused_max_regions:1,\n\t\tused_flood_tables:1,\n\t\tused_flood_mode:1,\n\t\tused_max_ib_mc:1,\n\t\tused_max_pkey:1,\n\t\tused_ar_sec:1,\n\t\tused_adaptive_routing_group_cap:1,\n\t\tused_ubridge:1,\n\t\tused_kvd_sizes:1,\n\t\tused_cqe_time_stamp_type:1;\n\tu8\tmax_vepa_channels;\n\tu16\tmax_lag;\n\tu16\tmax_mid;\n\tu16\tmax_pgt;\n\tu16\tmax_system_port;\n\tu16\tmax_vlan_groups;\n\tu16\tmax_regions;\n\tu8\tmax_flood_tables;\n\tu8\tmax_vid_flood_tables;\n\tu8\tflood_mode;\n\tu8\tmax_fid_offset_flood_tables;\n\tu16\tfid_offset_flood_table_size;\n\tu8\tmax_fid_flood_tables;\n\tu16\tfid_flood_table_size;\n\tu16\tmax_ib_mc;\n\tu16\tmax_pkey;\n\tu8\tar_sec;\n\tu16\tadaptive_routing_group_cap;\n\tu8\tarn;\n\tu8\tubridge;\n\tu32\tkvd_linear_size;\n\tu8\tkvd_hash_single_parts;\n\tu8\tkvd_hash_double_parts;\n\tu8\tcqe_time_stamp_type;\n\tstruct mlxsw_swid_config swid_config[MLXSW_CONFIG_PROFILE_SWID_COUNT];\n};\n\nstruct mlxsw_driver {\n\tstruct list_head list;\n\tconst char *kind;\n\tsize_t priv_size;\n\tconst struct mlxsw_fw_rev *fw_req_rev;\n\tconst char *fw_filename;\n\tint (*init)(struct mlxsw_core *mlxsw_core,\n\t\t    const struct mlxsw_bus_info *mlxsw_bus_info,\n\t\t    struct netlink_ext_ack *extack);\n\tvoid (*fini)(struct mlxsw_core *mlxsw_core);\n\tint (*port_split)(struct mlxsw_core *mlxsw_core, u16 local_port,\n\t\t\t  unsigned int count, struct netlink_ext_ack *extack);\n\tint (*port_unsplit)(struct mlxsw_core *mlxsw_core, u16 local_port,\n\t\t\t    struct netlink_ext_ack *extack);\n\tvoid (*ports_remove_selected)(struct mlxsw_core *mlxsw_core,\n\t\t\t\t      bool (*selector)(void *priv,\n\t\t\t\t\t\t       u16 local_port),\n\t\t\t\t      void *priv);\n\tint (*sb_pool_get)(struct mlxsw_core *mlxsw_core,\n\t\t\t   unsigned int sb_index, u16 pool_index,\n\t\t\t   struct devlink_sb_pool_info *pool_info);\n\tint (*sb_pool_set)(struct mlxsw_core *mlxsw_core,\n\t\t\t   unsigned int sb_index, u16 pool_index, u32 size,\n\t\t\t   enum devlink_sb_threshold_type threshold_type,\n\t\t\t   struct netlink_ext_ack *extack);\n\tint (*sb_port_pool_get)(struct mlxsw_core_port *mlxsw_core_port,\n\t\t\t\tunsigned int sb_index, u16 pool_index,\n\t\t\t\tu32 *p_threshold);\n\tint (*sb_port_pool_set)(struct mlxsw_core_port *mlxsw_core_port,\n\t\t\t\tunsigned int sb_index, u16 pool_index,\n\t\t\t\tu32 threshold, struct netlink_ext_ack *extack);\n\tint (*sb_tc_pool_bind_get)(struct mlxsw_core_port *mlxsw_core_port,\n\t\t\t\t   unsigned int sb_index, u16 tc_index,\n\t\t\t\t   enum devlink_sb_pool_type pool_type,\n\t\t\t\t   u16 *p_pool_index, u32 *p_threshold);\n\tint (*sb_tc_pool_bind_set)(struct mlxsw_core_port *mlxsw_core_port,\n\t\t\t\t   unsigned int sb_index, u16 tc_index,\n\t\t\t\t   enum devlink_sb_pool_type pool_type,\n\t\t\t\t   u16 pool_index, u32 threshold,\n\t\t\t\t   struct netlink_ext_ack *extack);\n\tint (*sb_occ_snapshot)(struct mlxsw_core *mlxsw_core,\n\t\t\t       unsigned int sb_index);\n\tint (*sb_occ_max_clear)(struct mlxsw_core *mlxsw_core,\n\t\t\t\tunsigned int sb_index);\n\tint (*sb_occ_port_pool_get)(struct mlxsw_core_port *mlxsw_core_port,\n\t\t\t\t    unsigned int sb_index, u16 pool_index,\n\t\t\t\t    u32 *p_cur, u32 *p_max);\n\tint (*sb_occ_tc_port_bind_get)(struct mlxsw_core_port *mlxsw_core_port,\n\t\t\t\t       unsigned int sb_index, u16 tc_index,\n\t\t\t\t       enum devlink_sb_pool_type pool_type,\n\t\t\t\t       u32 *p_cur, u32 *p_max);\n\tint (*trap_init)(struct mlxsw_core *mlxsw_core,\n\t\t\t const struct devlink_trap *trap, void *trap_ctx);\n\tvoid (*trap_fini)(struct mlxsw_core *mlxsw_core,\n\t\t\t  const struct devlink_trap *trap, void *trap_ctx);\n\tint (*trap_action_set)(struct mlxsw_core *mlxsw_core,\n\t\t\t       const struct devlink_trap *trap,\n\t\t\t       enum devlink_trap_action action,\n\t\t\t       struct netlink_ext_ack *extack);\n\tint (*trap_group_init)(struct mlxsw_core *mlxsw_core,\n\t\t\t       const struct devlink_trap_group *group);\n\tint (*trap_group_set)(struct mlxsw_core *mlxsw_core,\n\t\t\t      const struct devlink_trap_group *group,\n\t\t\t      const struct devlink_trap_policer *policer,\n\t\t\t      struct netlink_ext_ack *extack);\n\tint (*trap_policer_init)(struct mlxsw_core *mlxsw_core,\n\t\t\t\t const struct devlink_trap_policer *policer);\n\tvoid (*trap_policer_fini)(struct mlxsw_core *mlxsw_core,\n\t\t\t\t  const struct devlink_trap_policer *policer);\n\tint (*trap_policer_set)(struct mlxsw_core *mlxsw_core,\n\t\t\t\tconst struct devlink_trap_policer *policer,\n\t\t\t\tu64 rate, u64 burst,\n\t\t\t\tstruct netlink_ext_ack *extack);\n\tint (*trap_policer_counter_get)(struct mlxsw_core *mlxsw_core,\n\t\t\t\t\tconst struct devlink_trap_policer *policer,\n\t\t\t\t\tu64 *p_drops);\n\tvoid (*txhdr_construct)(struct sk_buff *skb,\n\t\t\t\tconst struct mlxsw_tx_info *tx_info);\n\tint (*resources_register)(struct mlxsw_core *mlxsw_core);\n\tint (*kvd_sizes_get)(struct mlxsw_core *mlxsw_core,\n\t\t\t     const struct mlxsw_config_profile *profile,\n\t\t\t     u64 *p_single_size, u64 *p_double_size,\n\t\t\t     u64 *p_linear_size);\n\n\t \n\tvoid (*ptp_transmitted)(struct mlxsw_core *mlxsw_core,\n\t\t\t\tstruct sk_buff *skb, u16 local_port);\n\n\tu8 txhdr_len;\n\tconst struct mlxsw_config_profile *profile;\n\tbool sdq_supports_cqe_v2;\n};\n\nint mlxsw_core_kvd_sizes_get(struct mlxsw_core *mlxsw_core,\n\t\t\t     const struct mlxsw_config_profile *profile,\n\t\t\t     u64 *p_single_size, u64 *p_double_size,\n\t\t\t     u64 *p_linear_size);\n\nu32 mlxsw_core_read_frc_h(struct mlxsw_core *mlxsw_core);\nu32 mlxsw_core_read_frc_l(struct mlxsw_core *mlxsw_core);\n\nu32 mlxsw_core_read_utc_sec(struct mlxsw_core *mlxsw_core);\nu32 mlxsw_core_read_utc_nsec(struct mlxsw_core *mlxsw_core);\n\nbool mlxsw_core_sdq_supports_cqe_v2(struct mlxsw_core *mlxsw_core);\n\nbool mlxsw_core_res_valid(struct mlxsw_core *mlxsw_core,\n\t\t\t  enum mlxsw_res_id res_id);\n\n#define MLXSW_CORE_RES_VALID(mlxsw_core, short_res_id)\t\t\t\\\n\tmlxsw_core_res_valid(mlxsw_core, MLXSW_RES_ID_##short_res_id)\n\nu64 mlxsw_core_res_get(struct mlxsw_core *mlxsw_core,\n\t\t       enum mlxsw_res_id res_id);\n\n#define MLXSW_CORE_RES_GET(mlxsw_core, short_res_id)\t\t\t\\\n\tmlxsw_core_res_get(mlxsw_core, MLXSW_RES_ID_##short_res_id)\n\nstatic inline struct net *mlxsw_core_net(struct mlxsw_core *mlxsw_core)\n{\n\treturn devlink_net(priv_to_devlink(mlxsw_core));\n}\n\n#define MLXSW_BUS_F_TXRX\tBIT(0)\n#define MLXSW_BUS_F_RESET\tBIT(1)\n\nstruct mlxsw_bus {\n\tconst char *kind;\n\tint (*init)(void *bus_priv, struct mlxsw_core *mlxsw_core,\n\t\t    const struct mlxsw_config_profile *profile,\n\t\t    struct mlxsw_res *res);\n\tvoid (*fini)(void *bus_priv);\n\tbool (*skb_transmit_busy)(void *bus_priv,\n\t\t\t\t  const struct mlxsw_tx_info *tx_info);\n\tint (*skb_transmit)(void *bus_priv, struct sk_buff *skb,\n\t\t\t    const struct mlxsw_tx_info *tx_info);\n\tint (*cmd_exec)(void *bus_priv, u16 opcode, u8 opcode_mod,\n\t\t\tu32 in_mod, bool out_mbox_direct,\n\t\t\tchar *in_mbox, size_t in_mbox_size,\n\t\t\tchar *out_mbox, size_t out_mbox_size,\n\t\t\tu8 *p_status);\n\tu32 (*read_frc_h)(void *bus_priv);\n\tu32 (*read_frc_l)(void *bus_priv);\n\tu32 (*read_utc_sec)(void *bus_priv);\n\tu32 (*read_utc_nsec)(void *bus_priv);\n\tu8 features;\n};\n\nstruct mlxsw_fw_rev {\n\tu16 major;\n\tu16 minor;\n\tu16 subminor;\n\tu16 can_reset_minor;\n};\n\nstruct mlxsw_bus_info {\n\tconst char *device_kind;\n\tconst char *device_name;\n\tstruct device *dev;\n\tstruct mlxsw_fw_rev fw_rev;\n\tu8 vsd[MLXSW_CMD_BOARDINFO_VSD_LEN];\n\tu8 psid[MLXSW_CMD_BOARDINFO_PSID_LEN];\n\tu8 low_frequency:1,\n\t   read_clock_capable:1;\n};\n\nstruct mlxsw_hwmon;\n\n#ifdef CONFIG_MLXSW_CORE_HWMON\n\nint mlxsw_hwmon_init(struct mlxsw_core *mlxsw_core,\n\t\t     const struct mlxsw_bus_info *mlxsw_bus_info,\n\t\t     struct mlxsw_hwmon **p_hwmon);\nvoid mlxsw_hwmon_fini(struct mlxsw_hwmon *mlxsw_hwmon);\n\n#else\n\nstatic inline int mlxsw_hwmon_init(struct mlxsw_core *mlxsw_core,\n\t\t\t\t   const struct mlxsw_bus_info *mlxsw_bus_info,\n\t\t\t\t   struct mlxsw_hwmon **p_hwmon)\n{\n\treturn 0;\n}\n\nstatic inline void mlxsw_hwmon_fini(struct mlxsw_hwmon *mlxsw_hwmon)\n{\n}\n\n#endif\n\nstruct mlxsw_thermal;\n\n#ifdef CONFIG_MLXSW_CORE_THERMAL\n\nint mlxsw_thermal_init(struct mlxsw_core *mlxsw_core,\n\t\t       const struct mlxsw_bus_info *mlxsw_bus_info,\n\t\t       struct mlxsw_thermal **p_thermal);\nvoid mlxsw_thermal_fini(struct mlxsw_thermal *thermal);\n\n#else\n\nstatic inline int mlxsw_thermal_init(struct mlxsw_core *mlxsw_core,\n\t\t\t\t     const struct mlxsw_bus_info *mlxsw_bus_info,\n\t\t\t\t     struct mlxsw_thermal **p_thermal)\n{\n\treturn 0;\n}\n\nstatic inline void mlxsw_thermal_fini(struct mlxsw_thermal *thermal)\n{\n}\n\n#endif\n\nenum mlxsw_devlink_param_id {\n\tMLXSW_DEVLINK_PARAM_ID_BASE = DEVLINK_PARAM_GENERIC_ID_MAX,\n\tMLXSW_DEVLINK_PARAM_ID_ACL_REGION_REHASH_INTERVAL,\n};\n\nstruct mlxsw_cqe_ts {\n\tu8 sec;\n\tu32 nsec;\n};\n\nstruct mlxsw_skb_cb {\n\tunion {\n\t\tstruct mlxsw_tx_info tx_info;\n\t\tstruct mlxsw_rx_md_info rx_md_info;\n\t};\n\tstruct mlxsw_cqe_ts cqe_ts;\n};\n\nstatic inline struct mlxsw_skb_cb *mlxsw_skb_cb(struct sk_buff *skb)\n{\n\tBUILD_BUG_ON(sizeof(mlxsw_skb_cb) > sizeof(skb->cb));\n\treturn (struct mlxsw_skb_cb *) skb->cb;\n}\n\nstruct mlxsw_linecards;\n\nenum mlxsw_linecard_status_event_type {\n\tMLXSW_LINECARD_STATUS_EVENT_TYPE_PROVISION,\n\tMLXSW_LINECARD_STATUS_EVENT_TYPE_UNPROVISION,\n};\n\nstruct mlxsw_linecard_bdev;\n\nstruct mlxsw_linecard_device_info {\n\tu16 fw_major;\n\tu16 fw_minor;\n\tu16 fw_sub_minor;\n\tchar psid[MLXSW_REG_MGIR_FW_INFO_PSID_SIZE];\n};\n\nstruct mlxsw_linecard {\n\tu8 slot_index;\n\tstruct mlxsw_linecards *linecards;\n\tstruct devlink_linecard *devlink_linecard;\n\tstruct mutex lock;  \n\tchar name[MLXSW_REG_MDDQ_SLOT_ASCII_NAME_LEN];\n\tchar mbct_pl[MLXSW_REG_MBCT_LEN];  \n\tenum mlxsw_linecard_status_event_type status_event_type_to;\n\tstruct delayed_work status_event_to_dw;\n\tu8 provisioned:1,\n\t   ready:1,\n\t   active:1;\n\tu16 hw_revision;\n\tu16 ini_version;\n\tstruct mlxsw_linecard_bdev *bdev;\n\tstruct {\n\t\tstruct mlxsw_linecard_device_info info;\n\t\tu8 index;\n\t} device;\n};\n\nstruct mlxsw_linecard_types_info;\n\nstruct mlxsw_linecards {\n\tstruct mlxsw_core *mlxsw_core;\n\tconst struct mlxsw_bus_info *bus_info;\n\tu8 count;\n\tstruct mlxsw_linecard_types_info *types_info;\n\tstruct list_head event_ops_list;\n\tstruct mutex event_ops_list_lock;  \n\tstruct mlxsw_linecard linecards[];\n};\n\nstatic inline struct mlxsw_linecard *\nmlxsw_linecard_get(struct mlxsw_linecards *linecards, u8 slot_index)\n{\n\treturn &linecards->linecards[slot_index - 1];\n}\n\nint mlxsw_linecard_devlink_info_get(struct mlxsw_linecard *linecard,\n\t\t\t\t    struct devlink_info_req *req,\n\t\t\t\t    struct netlink_ext_ack *extack);\nint mlxsw_linecard_flash_update(struct devlink *linecard_devlink,\n\t\t\t\tstruct mlxsw_linecard *linecard,\n\t\t\t\tconst struct firmware *firmware,\n\t\t\t\tstruct netlink_ext_ack *extack);\n\nint mlxsw_linecards_init(struct mlxsw_core *mlxsw_core,\n\t\t\t const struct mlxsw_bus_info *bus_info);\nvoid mlxsw_linecards_fini(struct mlxsw_core *mlxsw_core);\n\ntypedef void mlxsw_linecards_event_op_t(struct mlxsw_core *mlxsw_core,\n\t\t\t\t\tu8 slot_index, void *priv);\n\nstruct mlxsw_linecards_event_ops {\n\tmlxsw_linecards_event_op_t *got_active;\n\tmlxsw_linecards_event_op_t *got_inactive;\n};\n\nint mlxsw_linecards_event_ops_register(struct mlxsw_core *mlxsw_core,\n\t\t\t\t       struct mlxsw_linecards_event_ops *ops,\n\t\t\t\t       void *priv);\nvoid mlxsw_linecards_event_ops_unregister(struct mlxsw_core *mlxsw_core,\n\t\t\t\t\t  struct mlxsw_linecards_event_ops *ops,\n\t\t\t\t\t  void *priv);\n\nint mlxsw_linecard_bdev_add(struct mlxsw_linecard *linecard);\nvoid mlxsw_linecard_bdev_del(struct mlxsw_linecard *linecard);\n\nint mlxsw_linecard_driver_register(void);\nvoid mlxsw_linecard_driver_unregister(void);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}