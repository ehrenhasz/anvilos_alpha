{
  "module_name": "mlxbf_gige_ethtool.c",
  "hash_id": "a0ade8aec86f23e598e4296a0f308bb73a015d607a87a2829b6f1b284b33db04",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxbf_gige/mlxbf_gige_ethtool.c",
  "human_readable_source": "\n\n \n\n#include <linux/phy.h>\n\n#include \"mlxbf_gige.h\"\n#include \"mlxbf_gige_regs.h\"\n\n \nstatic int mlxbf_gige_get_regs_len(struct net_device *netdev)\n{\n\treturn MLXBF_GIGE_MMIO_REG_SZ;\n}\n\nstatic void mlxbf_gige_get_regs(struct net_device *netdev,\n\t\t\t\tstruct ethtool_regs *regs, void *p)\n{\n\tstruct mlxbf_gige *priv = netdev_priv(netdev);\n\n\tregs->version = MLXBF_GIGE_REGS_VERSION;\n\n\t \n\tmemcpy_fromio(p, priv->base, MLXBF_GIGE_MMIO_REG_SZ);\n}\n\nstatic void\nmlxbf_gige_get_ringparam(struct net_device *netdev,\n\t\t\t struct ethtool_ringparam *ering,\n\t\t\t struct kernel_ethtool_ringparam *kernel_ering,\n\t\t\t struct netlink_ext_ack *extack)\n{\n\tstruct mlxbf_gige *priv = netdev_priv(netdev);\n\n\tering->rx_max_pending = MLXBF_GIGE_MAX_RXQ_SZ;\n\tering->tx_max_pending = MLXBF_GIGE_MAX_TXQ_SZ;\n\tering->rx_pending = priv->rx_q_entries;\n\tering->tx_pending = priv->tx_q_entries;\n}\n\nstatic const struct {\n\tconst char string[ETH_GSTRING_LEN];\n} mlxbf_gige_ethtool_stats_keys[] = {\n\t{ \"hw_access_errors\" },\n\t{ \"tx_invalid_checksums\" },\n\t{ \"tx_small_frames\" },\n\t{ \"tx_index_errors\" },\n\t{ \"sw_config_errors\" },\n\t{ \"sw_access_errors\" },\n\t{ \"rx_truncate_errors\" },\n\t{ \"rx_mac_errors\" },\n\t{ \"rx_din_dropped_pkts\" },\n\t{ \"tx_fifo_full\" },\n\t{ \"rx_filter_passed_pkts\" },\n\t{ \"rx_filter_discard_pkts\" },\n};\n\nstatic int mlxbf_gige_get_sset_count(struct net_device *netdev, int stringset)\n{\n\tif (stringset != ETH_SS_STATS)\n\t\treturn -EOPNOTSUPP;\n\treturn ARRAY_SIZE(mlxbf_gige_ethtool_stats_keys);\n}\n\nstatic void mlxbf_gige_get_strings(struct net_device *netdev, u32 stringset,\n\t\t\t\t   u8 *buf)\n{\n\tif (stringset != ETH_SS_STATS)\n\t\treturn;\n\tmemcpy(buf, &mlxbf_gige_ethtool_stats_keys,\n\t       sizeof(mlxbf_gige_ethtool_stats_keys));\n}\n\nstatic void mlxbf_gige_get_ethtool_stats(struct net_device *netdev,\n\t\t\t\t\t struct ethtool_stats *estats,\n\t\t\t\t\t u64 *data)\n{\n\tstruct mlxbf_gige *priv = netdev_priv(netdev);\n\n\t \n\t*data++ = priv->stats.hw_access_errors;\n\t*data++ = priv->stats.tx_invalid_checksums;\n\t*data++ = priv->stats.tx_small_frames;\n\t*data++ = priv->stats.tx_index_errors;\n\t*data++ = priv->stats.sw_config_errors;\n\t*data++ = priv->stats.sw_access_errors;\n\t*data++ = priv->stats.rx_truncate_errors;\n\t*data++ = priv->stats.rx_mac_errors;\n\t*data++ = (priv->stats.rx_din_dropped_pkts +\n\t\t   readq(priv->base + MLXBF_GIGE_RX_DIN_DROP_COUNTER));\n\t*data++ = priv->stats.tx_fifo_full;\n\t*data++ = (priv->stats.rx_filter_passed_pkts +\n\t\t   readq(priv->base + MLXBF_GIGE_RX_PASS_COUNTER_ALL));\n\t*data++ = (priv->stats.rx_filter_discard_pkts +\n\t\t   readq(priv->base + MLXBF_GIGE_RX_DISC_COUNTER_ALL));\n}\n\nstatic void mlxbf_gige_get_pauseparam(struct net_device *netdev,\n\t\t\t\t      struct ethtool_pauseparam *pause)\n{\n\tpause->autoneg = AUTONEG_DISABLE;\n\tpause->rx_pause = 1;\n\tpause->tx_pause = 1;\n}\n\nconst struct ethtool_ops mlxbf_gige_ethtool_ops = {\n\t.get_link\t\t= ethtool_op_get_link,\n\t.get_ringparam\t\t= mlxbf_gige_get_ringparam,\n\t.get_regs_len           = mlxbf_gige_get_regs_len,\n\t.get_regs               = mlxbf_gige_get_regs,\n\t.get_strings            = mlxbf_gige_get_strings,\n\t.get_sset_count         = mlxbf_gige_get_sset_count,\n\t.get_ethtool_stats      = mlxbf_gige_get_ethtool_stats,\n\t.nway_reset\t\t= phy_ethtool_nway_reset,\n\t.get_pauseparam\t\t= mlxbf_gige_get_pauseparam,\n\t.get_link_ksettings\t= phy_ethtool_get_link_ksettings,\n\t.set_link_ksettings\t= phy_ethtool_set_link_ksettings,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}