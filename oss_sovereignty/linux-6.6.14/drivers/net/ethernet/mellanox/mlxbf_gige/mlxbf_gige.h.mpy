{
  "module_name": "mlxbf_gige.h",
  "hash_id": "0ea46010541255f660a442e7ead7e788305769b1726c296b9d920e04efb6e93b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlxbf_gige/mlxbf_gige.h",
  "human_readable_source": " \n\n \n\n#ifndef __MLXBF_GIGE_H__\n#define __MLXBF_GIGE_H__\n\n#include <linux/io-64-nonatomic-lo-hi.h>\n#include <linux/irqreturn.h>\n#include <linux/netdevice.h>\n#include <linux/irq.h>\n#include <linux/phy.h>\n\n \n#define MLXBF_GIGE_MIN_RXQ_SZ     32\n#define MLXBF_GIGE_MAX_RXQ_SZ     1024\n#define MLXBF_GIGE_DEFAULT_RXQ_SZ 128\n\n#define MLXBF_GIGE_MIN_TXQ_SZ     4\n#define MLXBF_GIGE_MAX_TXQ_SZ     256\n#define MLXBF_GIGE_DEFAULT_TXQ_SZ 128\n\n#define MLXBF_GIGE_DEFAULT_BUF_SZ 2048\n\n#define MLXBF_GIGE_DMA_PAGE_SZ    4096\n#define MLXBF_GIGE_DMA_PAGE_SHIFT 12\n\n \n#define MLXBF_GIGE_BCAST_MAC_FILTER_IDX 0\n#define MLXBF_GIGE_LOCAL_MAC_FILTER_IDX 1\n\n \n#define BCAST_MAC_ADDR 0xFFFFFFFFFFFF\n\n \n#define MLXBF_GIGE_ERROR_INTR_IDX       0\n#define MLXBF_GIGE_RECEIVE_PKT_INTR_IDX 1\n#define MLXBF_GIGE_LLU_PLU_INTR_IDX     2\n\nstruct mlxbf_gige_stats {\n\tu64 hw_access_errors;\n\tu64 tx_invalid_checksums;\n\tu64 tx_small_frames;\n\tu64 tx_index_errors;\n\tu64 sw_config_errors;\n\tu64 sw_access_errors;\n\tu64 rx_truncate_errors;\n\tu64 rx_mac_errors;\n\tu64 rx_din_dropped_pkts;\n\tu64 tx_fifo_full;\n\tu64 rx_filter_passed_pkts;\n\tu64 rx_filter_discard_pkts;\n};\n\nstruct mlxbf_gige_reg_param {\n\tu32 mask;\n\tu32 shift;\n};\n\nstruct mlxbf_gige_mdio_gw {\n\tu32 gw_address;\n\tu32 read_data_address;\n\tstruct mlxbf_gige_reg_param busy;\n\tstruct mlxbf_gige_reg_param write_data;\n\tstruct mlxbf_gige_reg_param read_data;\n\tstruct mlxbf_gige_reg_param devad;\n\tstruct mlxbf_gige_reg_param partad;\n\tstruct mlxbf_gige_reg_param opcode;\n\tstruct mlxbf_gige_reg_param st1;\n};\n\nstruct mlxbf_gige_link_cfg {\n\tvoid (*set_phy_link_mode)(struct phy_device *phydev);\n\tvoid (*adjust_link)(struct net_device *netdev);\n\tphy_interface_t phy_mode;\n};\n\nstruct mlxbf_gige {\n\tvoid __iomem *base;\n\tvoid __iomem *llu_base;\n\tvoid __iomem *plu_base;\n\tstruct device *dev;\n\tstruct net_device *netdev;\n\tstruct platform_device *pdev;\n\tvoid __iomem *mdio_io;\n\tvoid __iomem *clk_io;\n\tstruct mii_bus *mdiobus;\n\tspinlock_t lock;       \n\tu16 rx_q_entries;\n\tu16 tx_q_entries;\n\tu64 *tx_wqe_base;\n\tdma_addr_t tx_wqe_base_dma;\n\tu64 *tx_wqe_next;\n\tu64 *tx_cc;\n\tdma_addr_t tx_cc_dma;\n\tdma_addr_t *rx_wqe_base;\n\tdma_addr_t rx_wqe_base_dma;\n\tu64 *rx_cqe_base;\n\tdma_addr_t rx_cqe_base_dma;\n\tu16 tx_pi;\n\tu16 prev_tx_ci;\n\tstruct sk_buff *rx_skb[MLXBF_GIGE_MAX_RXQ_SZ];\n\tstruct sk_buff *tx_skb[MLXBF_GIGE_MAX_TXQ_SZ];\n\tint error_irq;\n\tint rx_irq;\n\tint llu_plu_irq;\n\tint phy_irq;\n\tint hw_phy_irq;\n\tbool promisc_enabled;\n\tu8 valid_polarity;\n\tstruct napi_struct napi;\n\tstruct mlxbf_gige_stats stats;\n\tu8 hw_version;\n\tstruct mlxbf_gige_mdio_gw *mdio_gw;\n\tint prev_speed;\n};\n\n \n#define MLXBF_GIGE_RX_WQE_SZ                   8\n\n \n#define MLXBF_GIGE_RX_CQE_SZ                   8\n#define MLXBF_GIGE_RX_CQE_PKT_LEN_MASK         GENMASK(10, 0)\n#define MLXBF_GIGE_RX_CQE_VALID_MASK           GENMASK(11, 11)\n#define MLXBF_GIGE_RX_CQE_PKT_STATUS_MASK      GENMASK(15, 12)\n#define MLXBF_GIGE_RX_CQE_PKT_STATUS_MAC_ERR   GENMASK(12, 12)\n#define MLXBF_GIGE_RX_CQE_PKT_STATUS_TRUNCATED GENMASK(13, 13)\n#define MLXBF_GIGE_RX_CQE_CHKSUM_MASK          GENMASK(31, 16)\n\n \n#define MLXBF_GIGE_TX_WQE_SZ_QWORDS            2\n#define MLXBF_GIGE_TX_WQE_SZ                   16\n#define MLXBF_GIGE_TX_WQE_PKT_LEN_MASK         GENMASK(10, 0)\n#define MLXBF_GIGE_TX_WQE_UPDATE_MASK          GENMASK(31, 31)\n#define MLXBF_GIGE_TX_WQE_CHKSUM_LEN_MASK      GENMASK(42, 32)\n#define MLXBF_GIGE_TX_WQE_CHKSUM_START_MASK    GENMASK(55, 48)\n#define MLXBF_GIGE_TX_WQE_CHKSUM_OFFSET_MASK   GENMASK(63, 56)\n\n \n#define MLXBF_GIGE_TX_WQE_PKT_LEN(tx_wqe_addr) \\\n\t(*((tx_wqe_addr) + 1) & MLXBF_GIGE_TX_WQE_PKT_LEN_MASK)\n\n \n#define MLXBF_GIGE_TX_CC_SZ                    8\n\n \nenum mlxbf_gige_res {\n\tMLXBF_GIGE_RES_MAC,\n\tMLXBF_GIGE_RES_MDIO9,\n\tMLXBF_GIGE_RES_GPIO0,\n\tMLXBF_GIGE_RES_LLU,\n\tMLXBF_GIGE_RES_PLU,\n\tMLXBF_GIGE_RES_CLK\n};\n\n \n#define MLXBF_GIGE_REGS_VERSION 1\n\nint mlxbf_gige_mdio_probe(struct platform_device *pdev,\n\t\t\t  struct mlxbf_gige *priv);\nvoid mlxbf_gige_mdio_remove(struct mlxbf_gige *priv);\nvoid mlxbf_gige_set_mac_rx_filter(struct mlxbf_gige *priv,\n\t\t\t\t  unsigned int index, u64 dmac);\nvoid mlxbf_gige_get_mac_rx_filter(struct mlxbf_gige *priv,\n\t\t\t\t  unsigned int index, u64 *dmac);\nvoid mlxbf_gige_enable_promisc(struct mlxbf_gige *priv);\nvoid mlxbf_gige_disable_promisc(struct mlxbf_gige *priv);\nint mlxbf_gige_rx_init(struct mlxbf_gige *priv);\nvoid mlxbf_gige_rx_deinit(struct mlxbf_gige *priv);\nint mlxbf_gige_tx_init(struct mlxbf_gige *priv);\nvoid mlxbf_gige_tx_deinit(struct mlxbf_gige *priv);\nbool mlxbf_gige_handle_tx_complete(struct mlxbf_gige *priv);\nnetdev_tx_t mlxbf_gige_start_xmit(struct sk_buff *skb,\n\t\t\t\t  struct net_device *netdev);\nstruct sk_buff *mlxbf_gige_alloc_skb(struct mlxbf_gige *priv,\n\t\t\t\t     unsigned int map_len,\n\t\t\t\t     dma_addr_t *buf_dma,\n\t\t\t\t     enum dma_data_direction dir);\nint mlxbf_gige_request_irqs(struct mlxbf_gige *priv);\nvoid mlxbf_gige_free_irqs(struct mlxbf_gige *priv);\nint mlxbf_gige_poll(struct napi_struct *napi, int budget);\nextern const struct ethtool_ops mlxbf_gige_ethtool_ops;\nvoid mlxbf_gige_update_tx_wqe_next(struct mlxbf_gige *priv);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}