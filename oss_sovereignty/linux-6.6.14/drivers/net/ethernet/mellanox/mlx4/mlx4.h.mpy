{
  "module_name": "mlx4.h",
  "hash_id": "e7ddc1f17819238552371656ca68a077973ecb24d01e05e2a362488ccab4e232",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx4/mlx4.h",
  "human_readable_source": " \n\n#ifndef MLX4_H\n#define MLX4_H\n\n#include <linux/mutex.h>\n#include <linux/radix-tree.h>\n#include <linux/rbtree.h>\n#include <linux/timer.h>\n#include <linux/semaphore.h>\n#include <linux/workqueue.h>\n#include <linux/interrupt.h>\n#include <linux/spinlock.h>\n#include <net/devlink.h>\n#include <linux/rwsem.h>\n#include <linux/auxiliary_bus.h>\n#include <linux/notifier.h>\n\n#include <linux/mlx4/device.h>\n#include <linux/mlx4/driver.h>\n#include <linux/mlx4/doorbell.h>\n#include <linux/mlx4/cmd.h>\n#include \"fw_qos.h\"\n\n#define DRV_NAME\t\"mlx4_core\"\n#define DRV_VERSION\t\"4.0-0\"\n#define DRV_NAME_FOR_FW\t\t\"Linux,\" DRV_NAME \",\" DRV_VERSION\n\n#define MLX4_FS_UDP_UC_EN\t\t(1 << 1)\n#define MLX4_FS_TCP_UC_EN\t\t(1 << 2)\n#define MLX4_FS_NUM_OF_L2_ADDR\t\t8\n#define MLX4_FS_MGM_LOG_ENTRY_SIZE\t7\n#define MLX4_FS_NUM_MCG\t\t\t(1 << 17)\n\n#define INIT_HCA_TPT_MW_ENABLE          (1 << 7)\n\n#define MLX4_QUERY_IF_STAT_RESET\tBIT(31)\n\nenum {\n\tMLX4_HCR_BASE\t\t= 0x80680,\n\tMLX4_HCR_SIZE\t\t= 0x0001c,\n\tMLX4_CLR_INT_SIZE\t= 0x00008,\n\tMLX4_SLAVE_COMM_BASE\t= 0x0,\n\tMLX4_COMM_PAGESIZE\t= 0x1000,\n\tMLX4_CLOCK_SIZE\t\t= 0x00008,\n\tMLX4_COMM_CHAN_CAPS\t= 0x8,\n\tMLX4_COMM_CHAN_FLAGS\t= 0xc\n};\n\nenum {\n\tMLX4_DEFAULT_MGM_LOG_ENTRY_SIZE = 10,\n\tMLX4_MIN_MGM_LOG_ENTRY_SIZE = 7,\n\tMLX4_MAX_MGM_LOG_ENTRY_SIZE = 12,\n\tMLX4_MAX_QP_PER_MGM = 4 * ((1 << MLX4_MAX_MGM_LOG_ENTRY_SIZE) / 16 - 2),\n};\n\nenum {\n\tMLX4_NUM_PDS\t\t= 1 << 15\n};\n\nenum {\n\tMLX4_CMPT_TYPE_QP\t= 0,\n\tMLX4_CMPT_TYPE_SRQ\t= 1,\n\tMLX4_CMPT_TYPE_CQ\t= 2,\n\tMLX4_CMPT_TYPE_EQ\t= 3,\n\tMLX4_CMPT_NUM_TYPE\n};\n\nenum {\n\tMLX4_CMPT_SHIFT\t\t= 24,\n\tMLX4_NUM_CMPTS\t\t= MLX4_CMPT_NUM_TYPE << MLX4_CMPT_SHIFT\n};\n\nenum mlx4_mpt_state {\n\tMLX4_MPT_DISABLED = 0,\n\tMLX4_MPT_EN_HW,\n\tMLX4_MPT_EN_SW\n};\n\n#define MLX4_COMM_TIME\t\t10000\n#define MLX4_COMM_OFFLINE_TIME_OUT 30000\n#define MLX4_COMM_CMD_NA_OP    0x0\n\n\nenum {\n\tMLX4_COMM_CMD_RESET,\n\tMLX4_COMM_CMD_VHCR0,\n\tMLX4_COMM_CMD_VHCR1,\n\tMLX4_COMM_CMD_VHCR2,\n\tMLX4_COMM_CMD_VHCR_EN,\n\tMLX4_COMM_CMD_VHCR_POST,\n\tMLX4_COMM_CMD_FLR = 254\n};\n\nenum {\n\tMLX4_VF_SMI_DISABLED,\n\tMLX4_VF_SMI_ENABLED\n};\n\n \n#define MLX4_DELAY_RESET_SLAVE 0xbbbbbbb\n \n#define NUM_OF_RESET_RETRIES\t10\n#define SLEEP_TIME_IN_RESET\t(2 * 1000)\nenum mlx4_resource {\n\tRES_QP,\n\tRES_CQ,\n\tRES_SRQ,\n\tRES_XRCD,\n\tRES_MPT,\n\tRES_MTT,\n\tRES_MAC,\n\tRES_VLAN,\n\tRES_NPORT_ID,\n\tRES_COUNTER,\n\tRES_FS_RULE,\n\tRES_EQ,\n\tMLX4_NUM_OF_RESOURCE_TYPE\n};\n\nenum mlx4_alloc_mode {\n\tRES_OP_RESERVE,\n\tRES_OP_RESERVE_AND_MAP,\n\tRES_OP_MAP_ICM,\n};\n\nenum mlx4_res_tracker_free_type {\n\tRES_TR_FREE_ALL,\n\tRES_TR_FREE_SLAVES_ONLY,\n\tRES_TR_FREE_STRUCTS_ONLY,\n};\n\n \nstruct mlx4_vhcr {\n\tu64\tin_param;\n\tu64\tout_param;\n\tu32\tin_modifier;\n\tu32\terrno;\n\tu16\top;\n\tu16\ttoken;\n\tu8\top_modifier;\n\tu8\te_bit;\n};\n\nstruct mlx4_vhcr_cmd {\n\t__be64 in_param;\n\t__be32 in_modifier;\n\tu32 reserved1;\n\t__be64 out_param;\n\t__be16 token;\n\tu16 reserved;\n\tu8 status;\n\tu8 flags;\n\t__be16 opcode;\n};\n\nstruct mlx4_cmd_info {\n\tu16 opcode;\n\tbool has_inbox;\n\tbool has_outbox;\n\tbool out_is_imm;\n\tbool encode_slave_id;\n\tint (*verify)(struct mlx4_dev *dev, int slave, struct mlx4_vhcr *vhcr,\n\t\t      struct mlx4_cmd_mailbox *inbox);\n\tint (*wrapper)(struct mlx4_dev *dev, int slave, struct mlx4_vhcr *vhcr,\n\t\t       struct mlx4_cmd_mailbox *inbox,\n\t\t       struct mlx4_cmd_mailbox *outbox,\n\t\t       struct mlx4_cmd_info *cmd);\n};\n\n#ifdef CONFIG_MLX4_DEBUG\nextern int mlx4_debug_level;\n#else  \n#define mlx4_debug_level\t(0)\n#endif  \n\n#define mlx4_dbg(mdev, format, ...)\t\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (mlx4_debug_level)\t\t\t\t\t\t\\\n\t\tdev_printk(KERN_DEBUG,\t\t\t\t\t\\\n\t\t\t   &(mdev)->persist->pdev->dev, format,\t\t\\\n\t\t\t   ##__VA_ARGS__);\t\t\t\t\\\n} while (0)\n\n#define mlx4_err(mdev, format, ...)\t\t\t\t\t\\\n\tdev_err(&(mdev)->persist->pdev->dev, format, ##__VA_ARGS__)\n#define mlx4_info(mdev, format, ...)\t\t\t\t\t\\\n\tdev_info(&(mdev)->persist->pdev->dev, format, ##__VA_ARGS__)\n#define mlx4_warn(mdev, format, ...)\t\t\t\t\t\\\n\tdev_warn(&(mdev)->persist->pdev->dev, format, ##__VA_ARGS__)\n\nextern int log_mtts_per_seg;\nextern int mlx4_internal_err_reset;\n\n#define MLX4_MAX_NUM_SLAVES\t(min(MLX4_MAX_NUM_PF + MLX4_MAX_NUM_VF, \\\n\t\t\t\t     MLX4_MFUNC_MAX))\n#define ALL_SLAVES 0xff\n\nstruct mlx4_bitmap {\n\tu32\t\t\tlast;\n\tu32\t\t\ttop;\n\tu32\t\t\tmax;\n\tu32                     reserved_top;\n\tu32\t\t\tmask;\n\tu32\t\t\tavail;\n\tu32\t\t\teffective_len;\n\tspinlock_t\t\tlock;\n\tunsigned long\t       *table;\n};\n\nstruct mlx4_buddy {\n\tunsigned long\t      **bits;\n\tunsigned int\t       *num_free;\n\tu32\t\t\tmax_order;\n\tspinlock_t\t\tlock;\n};\n\nstruct mlx4_icm;\n\nstruct mlx4_icm_table {\n\tu64\t\t\tvirt;\n\tint\t\t\tnum_icm;\n\tu32\t\t\tnum_obj;\n\tint\t\t\tobj_size;\n\tint\t\t\tlowmem;\n\tint\t\t\tcoherent;\n\tstruct mutex\t\tmutex;\n\tstruct mlx4_icm\t      **icm;\n};\n\n#define MLX4_MPT_FLAG_SW_OWNS\t    (0xfUL << 28)\n#define MLX4_MPT_FLAG_FREE\t    (0x3UL << 28)\n#define MLX4_MPT_FLAG_MIO\t    (1 << 17)\n#define MLX4_MPT_FLAG_BIND_ENABLE   (1 << 15)\n#define MLX4_MPT_FLAG_PHYSICAL\t    (1 <<  9)\n#define MLX4_MPT_FLAG_REGION\t    (1 <<  8)\n\n#define MLX4_MPT_PD_MASK\t    (0x1FFFFUL)\n#define MLX4_MPT_PD_VF_MASK\t    (0xFE0000UL)\n#define MLX4_MPT_PD_FLAG_FAST_REG   (1 << 27)\n#define MLX4_MPT_PD_FLAG_RAE\t    (1 << 28)\n#define MLX4_MPT_PD_FLAG_EN_INV\t    (3 << 24)\n\n#define MLX4_MPT_QP_FLAG_BOUND_QP   (1 << 7)\n\n#define MLX4_MPT_STATUS_SW\t\t0xF0\n#define MLX4_MPT_STATUS_HW\t\t0x00\n\n#define MLX4_CQE_SIZE_MASK_STRIDE\t0x3\n#define MLX4_EQE_SIZE_MASK_STRIDE\t0x30\n\n#define MLX4_EQ_ASYNC\t\t\t0\n#define MLX4_EQ_TO_CQ_VECTOR(vector)\t((vector) - \\\n\t\t\t\t\t !!((int)(vector) >= MLX4_EQ_ASYNC))\n#define MLX4_CQ_TO_EQ_VECTOR(vector)\t((vector) + \\\n\t\t\t\t\t !!((int)(vector) >= MLX4_EQ_ASYNC))\n\n \nstruct mlx4_mpt_entry {\n\t__be32 flags;\n\t__be32 qpn;\n\t__be32 key;\n\t__be32 pd_flags;\n\t__be64 start;\n\t__be64 length;\n\t__be32 lkey;\n\t__be32 win_cnt;\n\tu8\treserved1[3];\n\tu8\tmtt_rep;\n\t__be64 mtt_addr;\n\t__be32 mtt_sz;\n\t__be32 entity_size;\n\t__be32 first_byte_offset;\n} __packed;\n\n \nstruct mlx4_eq_context {\n\t__be32\t\t\tflags;\n\tu16\t\t\treserved1[3];\n\t__be16\t\t\tpage_offset;\n\tu8\t\t\tlog_eq_size;\n\tu8\t\t\treserved2[4];\n\tu8\t\t\teq_period;\n\tu8\t\t\treserved3;\n\tu8\t\t\teq_max_count;\n\tu8\t\t\treserved4[3];\n\tu8\t\t\tintr;\n\tu8\t\t\tlog_page_size;\n\tu8\t\t\treserved5[2];\n\tu8\t\t\tmtt_base_addr_h;\n\t__be32\t\t\tmtt_base_addr_l;\n\tu32\t\t\treserved6[2];\n\t__be32\t\t\tconsumer_index;\n\t__be32\t\t\tproducer_index;\n\tu32\t\t\treserved7[4];\n};\n\nstruct mlx4_cq_context {\n\t__be32\t\t\tflags;\n\tu16\t\t\treserved1[3];\n\t__be16\t\t\tpage_offset;\n\t__be32\t\t\tlogsize_usrpage;\n\t__be16\t\t\tcq_period;\n\t__be16\t\t\tcq_max_count;\n\tu8\t\t\treserved2[3];\n\tu8\t\t\tcomp_eqn;\n\tu8\t\t\tlog_page_size;\n\tu8\t\t\treserved3[2];\n\tu8\t\t\tmtt_base_addr_h;\n\t__be32\t\t\tmtt_base_addr_l;\n\t__be32\t\t\tlast_notified_index;\n\t__be32\t\t\tsolicit_producer_index;\n\t__be32\t\t\tconsumer_index;\n\t__be32\t\t\tproducer_index;\n\tu32\t\t\treserved4[2];\n\t__be64\t\t\tdb_rec_addr;\n};\n\nstruct mlx4_srq_context {\n\t__be32\t\t\tstate_logsize_srqn;\n\tu8\t\t\tlogstride;\n\tu8\t\t\treserved1;\n\t__be16\t\t\txrcd;\n\t__be32\t\t\tpg_offset_cqn;\n\tu32\t\t\treserved2;\n\tu8\t\t\tlog_page_size;\n\tu8\t\t\treserved3[2];\n\tu8\t\t\tmtt_base_addr_h;\n\t__be32\t\t\tmtt_base_addr_l;\n\t__be32\t\t\tpd;\n\t__be16\t\t\tlimit_watermark;\n\t__be16\t\t\twqe_cnt;\n\tu16\t\t\treserved4;\n\t__be16\t\t\twqe_counter;\n\tu32\t\t\treserved5;\n\t__be64\t\t\tdb_rec_addr;\n};\n\nstruct mlx4_eq_tasklet {\n\tstruct list_head list;\n\tstruct list_head process_list;\n\tstruct tasklet_struct task;\n\t \n\tspinlock_t lock;\n};\n\nstruct mlx4_eq {\n\tstruct mlx4_dev\t       *dev;\n\tvoid __iomem\t       *doorbell;\n\tint\t\t\teqn;\n\tu32\t\t\tcons_index;\n\tu16\t\t\tirq;\n\tu16\t\t\thave_irq;\n\tint\t\t\tnent;\n\tstruct mlx4_buf_list   *page_list;\n\tstruct mlx4_mtt\t\tmtt;\n\tstruct mlx4_eq_tasklet\ttasklet_ctx;\n\tstruct mlx4_active_ports actv_ports;\n\tu32\t\t\tref_count;\n\tcpumask_var_t\t\taffinity_mask;\n};\n\nstruct mlx4_slave_eqe {\n\tu8 type;\n\tu8 port;\n\tu32 param;\n};\n\nstruct mlx4_slave_event_eq_info {\n\tint eqn;\n\tu16 token;\n};\n\nstruct mlx4_profile {\n\tint\t\t\tnum_qp;\n\tint\t\t\trdmarc_per_qp;\n\tint\t\t\tnum_srq;\n\tint\t\t\tnum_cq;\n\tint\t\t\tnum_mcg;\n\tint\t\t\tnum_mpt;\n\tunsigned\t\tnum_mtt;\n};\n\nstruct mlx4_fw {\n\tu64\t\t\tclr_int_base;\n\tu64\t\t\tcatas_offset;\n\tu64\t\t\tcomm_base;\n\tu64\t\t\tclock_offset;\n\tstruct mlx4_icm\t       *fw_icm;\n\tstruct mlx4_icm\t       *aux_icm;\n\tu32\t\t\tcatas_size;\n\tu16\t\t\tfw_pages;\n\tu8\t\t\tclr_int_bar;\n\tu8\t\t\tcatas_bar;\n\tu8\t\t\tcomm_bar;\n\tu8\t\t\tclock_bar;\n};\n\nstruct mlx4_comm {\n\tu32\t\t\tslave_write;\n\tu32\t\t\tslave_read;\n};\n\nenum {\n\tMLX4_MCAST_CONFIG       = 0,\n\tMLX4_MCAST_DISABLE      = 1,\n\tMLX4_MCAST_ENABLE       = 2,\n};\n\n#define VLAN_FLTR_SIZE\t128\n\nstruct mlx4_vlan_fltr {\n\t__be32 entry[VLAN_FLTR_SIZE];\n};\n\nstruct mlx4_mcast_entry {\n\tstruct list_head list;\n\tu64 addr;\n};\n\nstruct mlx4_promisc_qp {\n\tstruct list_head list;\n\tu32 qpn;\n};\n\nstruct mlx4_steer_index {\n\tstruct list_head list;\n\tunsigned int index;\n\tstruct list_head duplicates;\n};\n\n#define MLX4_EVENT_TYPES_NUM 64\n\nstruct mlx4_slave_state {\n\tu8 comm_toggle;\n\tu8 last_cmd;\n\tu8 init_port_mask;\n\tbool active;\n\tbool old_vlan_api;\n\tbool vst_qinq_supported;\n\tu8 function;\n\tdma_addr_t vhcr_dma;\n\tu16 user_mtu[MLX4_MAX_PORTS + 1];\n\tu16 mtu[MLX4_MAX_PORTS + 1];\n\t__be32 ib_cap_mask[MLX4_MAX_PORTS + 1];\n\tstruct mlx4_slave_eqe eq[MLX4_MFUNC_MAX_EQES];\n\tstruct list_head mcast_filters[MLX4_MAX_PORTS + 1];\n\tstruct mlx4_vlan_fltr *vlan_filter[MLX4_MAX_PORTS + 1];\n\t \n\tstruct mlx4_slave_event_eq_info event_eq[MLX4_EVENT_TYPES_NUM];\n\tu16 eq_pi;\n\tu16 eq_ci;\n\tspinlock_t lock;\n\t \n\tu8 is_slave_going_down;\n\tu32 cookie;\n\tenum slave_port_state port_state[MLX4_MAX_PORTS + 1];\n};\n\n#define MLX4_VGT 4095\n#define NO_INDX  (-1)\n\nstruct mlx4_vport_state {\n\tu64 mac;\n\tu16 default_vlan;\n\tu8  default_qos;\n\t__be16 vlan_proto;\n\tu32 tx_rate;\n\tbool spoofchk;\n\tu32 link_state;\n\tu8 qos_vport;\n\t__be64 guid;\n};\n\nstruct mlx4_vf_admin_state {\n\tstruct mlx4_vport_state vport[MLX4_MAX_PORTS + 1];\n\tu8 enable_smi[MLX4_MAX_PORTS + 1];\n};\n\nstruct mlx4_vport_oper_state {\n\tstruct mlx4_vport_state state;\n\tint mac_idx;\n\tint vlan_idx;\n};\n\nstruct mlx4_vf_oper_state {\n\tstruct mlx4_vport_oper_state vport[MLX4_MAX_PORTS + 1];\n\tu8 smi_enabled[MLX4_MAX_PORTS + 1];\n};\n\nstruct slave_list {\n\tstruct mutex mutex;\n\tstruct list_head res_list[MLX4_NUM_OF_RESOURCE_TYPE];\n};\n\nstruct resource_allocator {\n\tspinlock_t alloc_lock;  \n\tunion {\n\t\tunsigned int res_reserved;\n\t\tunsigned int res_port_rsvd[MLX4_MAX_PORTS];\n\t};\n\tunion {\n\t\tint res_free;\n\t\tint res_port_free[MLX4_MAX_PORTS];\n\t};\n\tint *quota;\n\tint *allocated;\n\tint *guaranteed;\n};\n\nstruct mlx4_resource_tracker {\n\tspinlock_t lock;\n\t \n\tstruct rb_root res_tree[MLX4_NUM_OF_RESOURCE_TYPE];\n\t \n\tstruct slave_list *slave_list;\n\tstruct resource_allocator res_alloc[MLX4_NUM_OF_RESOURCE_TYPE];\n};\n\n#define SLAVE_EVENT_EQ_SIZE\t128\nstruct mlx4_slave_event_eq {\n\tu32 eqn;\n\tu32 cons;\n\tu32 prod;\n\tspinlock_t event_lock;\n\tstruct mlx4_eqe event_eqe[SLAVE_EVENT_EQ_SIZE];\n};\n\nstruct mlx4_qos_manager {\n\tint num_of_qos_vfs;\n\tDECLARE_BITMAP(priority_bm, MLX4_NUM_UP);\n};\n\nstruct mlx4_master_qp0_state {\n\tint proxy_qp0_active;\n\tint qp0_active;\n\tint port_active;\n};\n\nstruct mlx4_mfunc_master_ctx {\n\tstruct mlx4_slave_state *slave_state;\n\tstruct mlx4_vf_admin_state *vf_admin;\n\tstruct mlx4_vf_oper_state *vf_oper;\n\tstruct mlx4_master_qp0_state qp0_state[MLX4_MAX_PORTS + 1];\n\tint\t\t\tinit_port_ref[MLX4_MAX_PORTS + 1];\n\tu16\t\t\tmax_mtu[MLX4_MAX_PORTS + 1];\n\tu16\t\t\tmax_user_mtu[MLX4_MAX_PORTS + 1];\n\tu8\t\t\tpptx;\n\tu8\t\t\tpprx;\n\tint\t\t\tdisable_mcast_ref[MLX4_MAX_PORTS + 1];\n\tstruct mlx4_resource_tracker res_tracker;\n\tstruct workqueue_struct *comm_wq;\n\tstruct work_struct\tcomm_work;\n\tstruct work_struct\tslave_event_work;\n\tstruct work_struct\tslave_flr_event_work;\n\tspinlock_t\t\tslave_state_lock;\n\t__be32\t\t\tcomm_arm_bit_vector[4];\n\tstruct mlx4_eqe\t\tcmd_eqe;\n\tstruct mlx4_slave_event_eq slave_eq;\n\tstruct mutex\t\tgen_eqe_mutex[MLX4_MFUNC_MAX];\n\tstruct mlx4_qos_manager qos_ctl[MLX4_MAX_PORTS + 1];\n\tu32\t\t\tnext_slave;  \n};\n\nstruct mlx4_mfunc {\n\tstruct mlx4_comm __iomem       *comm;\n\tstruct mlx4_vhcr_cmd\t       *vhcr;\n\tdma_addr_t\t\t\tvhcr_dma;\n\n\tstruct mlx4_mfunc_master_ctx\tmaster;\n};\n\n#define MGM_QPN_MASK       0x00FFFFFF\n#define MGM_BLCK_LB_BIT    30\n\nstruct mlx4_mgm {\n\t__be32\t\t\tnext_gid_index;\n\t__be32\t\t\tmembers_count;\n\tu32\t\t\treserved[2];\n\tu8\t\t\tgid[16];\n\t__be32\t\t\tqp[MLX4_MAX_QP_PER_MGM];\n};\n\nstruct mlx4_cmd {\n\tstruct dma_pool\t       *pool;\n\tvoid __iomem\t       *hcr;\n\tstruct mutex\t\tslave_cmd_mutex;\n\tstruct semaphore\tpoll_sem;\n\tstruct semaphore\tevent_sem;\n\tstruct rw_semaphore\tswitch_sem;\n\tint\t\t\tmax_cmds;\n\tspinlock_t\t\tcontext_lock;\n\tint\t\t\tfree_head;\n\tstruct mlx4_cmd_context *context;\n\tu16\t\t\ttoken_mask;\n\tu8\t\t\tuse_events;\n\tu8\t\t\ttoggle;\n\tu8\t\t\tcomm_toggle;\n\tu8\t\t\tinitialized;\n};\n\nenum {\n\tMLX4_VF_IMMED_VLAN_FLAG_VLAN = 1 << 0,\n\tMLX4_VF_IMMED_VLAN_FLAG_QOS = 1 << 1,\n\tMLX4_VF_IMMED_VLAN_FLAG_LINK_DISABLE = 1 << 2,\n};\nstruct mlx4_vf_immed_vlan_work {\n\tstruct work_struct\twork;\n\tstruct mlx4_priv\t*priv;\n\tint\t\t\tflags;\n\tint\t\t\tslave;\n\tint\t\t\tvlan_ix;\n\tint\t\t\torig_vlan_ix;\n\tu8\t\t\tport;\n\tu8\t\t\tqos;\n\tu8                      qos_vport;\n\tu16\t\t\tvlan_id;\n\tu16\t\t\torig_vlan_id;\n\t__be16\t\t\tvlan_proto;\n};\n\n\nstruct mlx4_uar_table {\n\tstruct mlx4_bitmap\tbitmap;\n};\n\nstruct mlx4_mr_table {\n\tstruct mlx4_bitmap\tmpt_bitmap;\n\tstruct mlx4_buddy\tmtt_buddy;\n\tu64\t\t\tmtt_base;\n\tu64\t\t\tmpt_base;\n\tstruct mlx4_icm_table\tmtt_table;\n\tstruct mlx4_icm_table\tdmpt_table;\n};\n\nstruct mlx4_cq_table {\n\tstruct mlx4_bitmap\tbitmap;\n\tspinlock_t\t\tlock;\n\tstruct radix_tree_root\ttree;\n\tstruct mlx4_icm_table\ttable;\n\tstruct mlx4_icm_table\tcmpt_table;\n};\n\nstruct mlx4_eq_table {\n\tstruct mlx4_bitmap\tbitmap;\n\tchar\t\t       *irq_names;\n\tvoid __iomem\t       *clr_int;\n\tvoid __iomem\t      **uar_map;\n\tu32\t\t\tclr_mask;\n\tstruct mlx4_eq\t       *eq;\n\tstruct mlx4_icm_table\ttable;\n\tstruct mlx4_icm_table\tcmpt_table;\n\tint\t\t\thave_irq;\n\tu8\t\t\tinta_pin;\n};\n\nstruct mlx4_srq_table {\n\tstruct mlx4_bitmap\tbitmap;\n\tspinlock_t\t\tlock;\n\tstruct radix_tree_root\ttree;\n\tstruct mlx4_icm_table\ttable;\n\tstruct mlx4_icm_table\tcmpt_table;\n};\n\nenum mlx4_qp_table_zones {\n\tMLX4_QP_TABLE_ZONE_GENERAL,\n\tMLX4_QP_TABLE_ZONE_RSS,\n\tMLX4_QP_TABLE_ZONE_RAW_ETH,\n\tMLX4_QP_TABLE_ZONE_NUM\n};\n\nstruct mlx4_qp_table {\n\tstruct mlx4_bitmap\t*bitmap_gen;\n\tstruct mlx4_zone_allocator *zones;\n\tu32\t\t\tzones_uids[MLX4_QP_TABLE_ZONE_NUM];\n\tu32\t\t\trdmarc_base;\n\tint\t\t\trdmarc_shift;\n\tspinlock_t\t\tlock;\n\tstruct mlx4_icm_table\tqp_table;\n\tstruct mlx4_icm_table\tauxc_table;\n\tstruct mlx4_icm_table\taltc_table;\n\tstruct mlx4_icm_table\trdmarc_table;\n\tstruct mlx4_icm_table\tcmpt_table;\n};\n\nstruct mlx4_mcg_table {\n\tstruct mutex\t\tmutex;\n\tstruct mlx4_bitmap\tbitmap;\n\tstruct mlx4_icm_table\ttable;\n};\n\nstruct mlx4_catas_err {\n\tu32 __iomem\t       *map;\n\tstruct timer_list\ttimer;\n\tstruct list_head\tlist;\n};\n\n#define MLX4_MAX_MAC_NUM\t128\n#define MLX4_MAC_TABLE_SIZE\t(MLX4_MAX_MAC_NUM << 3)\n\nstruct mlx4_mac_table {\n\t__be64\t\t\tentries[MLX4_MAX_MAC_NUM];\n\tint\t\t\trefs[MLX4_MAX_MAC_NUM];\n\tbool\t\t\tis_dup[MLX4_MAX_MAC_NUM];\n\tstruct mutex\t\tmutex;\n\tint\t\t\ttotal;\n\tint\t\t\tmax;\n};\n\n#define MLX4_ROCE_GID_ENTRY_SIZE\t16\n\nstruct mlx4_roce_gid_entry {\n\tu8 raw[MLX4_ROCE_GID_ENTRY_SIZE];\n};\n\nstruct mlx4_roce_gid_table {\n\tstruct mlx4_roce_gid_entry\troce_gids[MLX4_ROCE_MAX_GIDS];\n\tstruct mutex\t\t\tmutex;\n};\n\n#define MLX4_MAX_VLAN_NUM\t128\n#define MLX4_VLAN_TABLE_SIZE\t(MLX4_MAX_VLAN_NUM << 2)\n\nstruct mlx4_vlan_table {\n\t__be32\t\t\tentries[MLX4_MAX_VLAN_NUM];\n\tint\t\t\trefs[MLX4_MAX_VLAN_NUM];\n\tint\t\t\tis_dup[MLX4_MAX_VLAN_NUM];\n\tstruct mutex\t\tmutex;\n\tint\t\t\ttotal;\n\tint\t\t\tmax;\n};\n\n#define SET_PORT_GEN_ALL_VALID\t(MLX4_FLAG_V_MTU_MASK\t| \\\n\t\t\t\t MLX4_FLAG_V_PPRX_MASK\t| \\\n\t\t\t\t MLX4_FLAG_V_PPTX_MASK)\n#define SET_PORT_PROMISC_SHIFT\t\t31\n#define SET_PORT_MC_PROMISC_SHIFT\t30\n\nenum {\n\tMCAST_DIRECT_ONLY\t= 0,\n\tMCAST_DIRECT\t\t= 1,\n\tMCAST_DEFAULT\t\t= 2\n};\n\n\nstruct mlx4_set_port_general_context {\n\tu16 reserved1;\n\tu8 flags2;\n\tu8 flags;\n\tunion {\n\t\tu8 ignore_fcs;\n\t\tu8 roce_mode;\n\t};\n\tu8 reserved2;\n\t__be16 mtu;\n\tu8 pptx;\n\tu8 pfctx;\n\tu16 reserved3;\n\tu8 pprx;\n\tu8 pfcrx;\n\tu16 reserved4;\n\tu32 reserved5;\n\tu8 phv_en;\n\tu8 reserved6[5];\n\t__be16 user_mtu;\n\tu16 reserved7;\n\tu8 user_mac[6];\n};\n\nstruct mlx4_set_port_rqp_calc_context {\n\t__be32 base_qpn;\n\tu8 rererved;\n\tu8 n_mac;\n\tu8 n_vlan;\n\tu8 n_prio;\n\tu8 reserved2[3];\n\tu8 mac_miss;\n\tu8 intra_no_vlan;\n\tu8 no_vlan;\n\tu8 intra_vlan_miss;\n\tu8 vlan_miss;\n\tu8 reserved3[3];\n\tu8 no_vlan_prio;\n\t__be32 promisc;\n\t__be32 mcast;\n};\n\nstruct mlx4_port_info {\n\tstruct mlx4_dev\t       *dev;\n\tint\t\t\tport;\n\tchar\t\t\tdev_name[16];\n\tstruct device_attribute port_attr;\n\tenum mlx4_port_type\ttmp_type;\n\tchar\t\t\tdev_mtu_name[16];\n\tstruct device_attribute port_mtu_attr;\n\tstruct mlx4_mac_table\tmac_table;\n\tstruct mlx4_vlan_table\tvlan_table;\n\tstruct mlx4_roce_gid_table gid_table;\n\tint\t\t\tbase_qpn;\n\tstruct cpu_rmap\t\t*rmap;\n\tstruct devlink_port\tdevlink_port;\n};\n\nstruct mlx4_sense {\n\tstruct mlx4_dev\t\t*dev;\n\tu8\t\t\tdo_sense_port[MLX4_MAX_PORTS + 1];\n\tu8\t\t\tsense_allowed[MLX4_MAX_PORTS + 1];\n\tstruct delayed_work\tsense_poll;\n};\n\nstruct mlx4_msix_ctl {\n\tDECLARE_BITMAP(pool_bm, MAX_MSIX);\n\tstruct mutex\tpool_lock;\n};\n\nstruct mlx4_steer {\n\tstruct list_head promisc_qps[MLX4_NUM_STEERS];\n\tstruct list_head steer_entries[MLX4_NUM_STEERS];\n};\n\nstruct mlx4_port_map {\n\tu8\tport1;\n\tu8\tport2;\n};\n\nenum {\n\tMLX4_PCI_DEV_IS_VF\t\t= 1 << 0,\n\tMLX4_PCI_DEV_FORCE_SENSE_PORT\t= 1 << 1,\n};\n\nenum {\n\tMLX4_NO_RR\t= 0,\n\tMLX4_USE_RR\t= 1,\n};\n\nstruct mlx4_priv {\n\tstruct mlx4_dev\t\tdev;\n\n\tstruct mlx4_adev\t**adev;\n\tint\t\t\tadev_idx;\n\tstruct atomic_notifier_head event_nh;\n\n\tint\t\t\tpci_dev_data;\n\tint                     removed;\n\n\tstruct list_head        pgdir_list;\n\tstruct mutex            pgdir_mutex;\n\n\tstruct mlx4_fw\t\tfw;\n\tstruct mlx4_cmd\t\tcmd;\n\tstruct mlx4_mfunc\tmfunc;\n\n\tstruct mlx4_bitmap\tpd_bitmap;\n\tstruct mlx4_bitmap\txrcd_bitmap;\n\tstruct mlx4_uar_table\tuar_table;\n\tstruct mlx4_mr_table\tmr_table;\n\tstruct mlx4_cq_table\tcq_table;\n\tstruct mlx4_eq_table\teq_table;\n\tstruct mlx4_srq_table\tsrq_table;\n\tstruct mlx4_qp_table\tqp_table;\n\tstruct mlx4_mcg_table\tmcg_table;\n\tstruct mlx4_bitmap\tcounters_bitmap;\n\tint\t\t\tdef_counter[MLX4_MAX_PORTS];\n\n\tstruct mlx4_catas_err\tcatas_err;\n\n\tvoid __iomem\t       *clr_base;\n\n\tstruct mlx4_uar\t\tdriver_uar;\n\tvoid __iomem\t       *kar;\n\tstruct mlx4_port_info\tport[MLX4_MAX_PORTS + 1];\n\tstruct mlx4_sense       sense;\n\tstruct mutex\t\tport_mutex;\n\tstruct mlx4_msix_ctl\tmsix_ctl;\n\tstruct mlx4_steer\t*steer;\n\tstruct list_head\tbf_list;\n\tstruct mutex\t\tbf_mutex;\n\tstruct io_mapping\t*bf_mapping;\n\tvoid __iomem            *clock_mapping;\n\tint\t\t\treserved_mtts;\n\tint\t\t\tfs_hash_mode;\n\tu8 virt2phys_pkey[MLX4_MFUNC_MAX][MLX4_MAX_PORTS][MLX4_MAX_PORT_PKEYS];\n\tstruct mlx4_port_map\tv2p;  \n\tstruct mutex\t\tbond_mutex;  \n\t__be64\t\t\tslave_node_guids[MLX4_MFUNC_MAX];\n\n\tatomic_t\t\topreq_count;\n\tstruct work_struct\topreq_task;\n};\n\nstatic inline struct mlx4_priv *mlx4_priv(struct mlx4_dev *dev)\n{\n\treturn container_of(dev, struct mlx4_priv, dev);\n}\n\n#define MLX4_SENSE_RANGE\t(HZ * 3)\n\nextern struct workqueue_struct *mlx4_wq;\n\nu32 mlx4_bitmap_alloc(struct mlx4_bitmap *bitmap);\nvoid mlx4_bitmap_free(struct mlx4_bitmap *bitmap, u32 obj, int use_rr);\nu32 mlx4_bitmap_alloc_range(struct mlx4_bitmap *bitmap, int cnt,\n\t\t\t    int align, u32 skip_mask);\nvoid mlx4_bitmap_free_range(struct mlx4_bitmap *bitmap, u32 obj, int cnt,\n\t\t\t    int use_rr);\nu32 mlx4_bitmap_avail(struct mlx4_bitmap *bitmap);\nint mlx4_bitmap_init(struct mlx4_bitmap *bitmap, u32 num, u32 mask,\n\t\t     u32 reserved_bot, u32 resetrved_top);\nvoid mlx4_bitmap_cleanup(struct mlx4_bitmap *bitmap);\n\nint mlx4_reset(struct mlx4_dev *dev);\n\nint mlx4_alloc_eq_table(struct mlx4_dev *dev);\nvoid mlx4_free_eq_table(struct mlx4_dev *dev);\n\nint mlx4_init_pd_table(struct mlx4_dev *dev);\nint mlx4_init_xrcd_table(struct mlx4_dev *dev);\nint mlx4_init_uar_table(struct mlx4_dev *dev);\nint mlx4_init_mr_table(struct mlx4_dev *dev);\nint mlx4_init_eq_table(struct mlx4_dev *dev);\nint mlx4_init_cq_table(struct mlx4_dev *dev);\nint mlx4_init_qp_table(struct mlx4_dev *dev);\nint mlx4_init_srq_table(struct mlx4_dev *dev);\nint mlx4_init_mcg_table(struct mlx4_dev *dev);\n\nvoid mlx4_cleanup_pd_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_xrcd_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_uar_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_mr_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_eq_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_cq_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_qp_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_srq_table(struct mlx4_dev *dev);\nvoid mlx4_cleanup_mcg_table(struct mlx4_dev *dev);\nint __mlx4_qp_alloc_icm(struct mlx4_dev *dev, int qpn);\nvoid __mlx4_qp_free_icm(struct mlx4_dev *dev, int qpn);\nint __mlx4_cq_alloc_icm(struct mlx4_dev *dev, int *cqn);\nvoid __mlx4_cq_free_icm(struct mlx4_dev *dev, int cqn);\nint __mlx4_srq_alloc_icm(struct mlx4_dev *dev, int *srqn);\nvoid __mlx4_srq_free_icm(struct mlx4_dev *dev, int srqn);\nint __mlx4_mpt_reserve(struct mlx4_dev *dev);\nvoid __mlx4_mpt_release(struct mlx4_dev *dev, u32 index);\nint __mlx4_mpt_alloc_icm(struct mlx4_dev *dev, u32 index);\nvoid __mlx4_mpt_free_icm(struct mlx4_dev *dev, u32 index);\nu32 __mlx4_alloc_mtt_range(struct mlx4_dev *dev, int order);\nvoid __mlx4_free_mtt_range(struct mlx4_dev *dev, u32 first_seg, int order);\n\nint mlx4_WRITE_MTT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_SYNC_TPT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_SW2HW_MPT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_HW2SW_MPT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_MPT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_SW2HW_EQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_CONFIG_DEV_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_DMA_wrapper(struct mlx4_dev *dev, int slave,\n\t\t     struct mlx4_vhcr *vhcr,\n\t\t     struct mlx4_cmd_mailbox *inbox,\n\t\t     struct mlx4_cmd_mailbox *outbox,\n\t\t     struct mlx4_cmd_info *cmd);\nint __mlx4_qp_reserve_range(struct mlx4_dev *dev, int cnt, int align,\n\t\t\t    int *base, u8 flags);\nvoid __mlx4_qp_release_range(struct mlx4_dev *dev, int base_qpn, int cnt);\nint __mlx4_register_mac(struct mlx4_dev *dev, u8 port, u64 mac);\nvoid __mlx4_unregister_mac(struct mlx4_dev *dev, u8 port, u64 mac);\nint __mlx4_write_mtt(struct mlx4_dev *dev, struct mlx4_mtt *mtt,\n\t\t     int start_index, int npages, u64 *page_list);\nint __mlx4_counter_alloc(struct mlx4_dev *dev, u32 *idx);\nvoid __mlx4_counter_free(struct mlx4_dev *dev, u32 idx);\nint mlx4_calc_vf_counters(struct mlx4_dev *dev, int slave, int port,\n\t\t\t  struct mlx4_counter *data);\nint __mlx4_xrcd_alloc(struct mlx4_dev *dev, u32 *xrcdn);\nvoid __mlx4_xrcd_free(struct mlx4_dev *dev, u32 xrcdn);\n\nvoid mlx4_start_catas_poll(struct mlx4_dev *dev);\nvoid mlx4_stop_catas_poll(struct mlx4_dev *dev);\nint mlx4_catas_init(struct mlx4_dev *dev);\nvoid mlx4_catas_end(struct mlx4_dev *dev);\nint mlx4_crdump_init(struct mlx4_dev *dev);\nvoid mlx4_crdump_end(struct mlx4_dev *dev);\nint mlx4_restart_one(struct pci_dev *pdev);\n\nint mlx4_adev_init(struct mlx4_dev *dev);\nvoid mlx4_adev_cleanup(struct mlx4_dev *dev);\nint mlx4_register_device(struct mlx4_dev *dev);\nvoid mlx4_unregister_device(struct mlx4_dev *dev);\nvoid mlx4_dispatch_event(struct mlx4_dev *dev, enum mlx4_dev_event type,\n\t\t\t void *param);\n\nstruct mlx4_dev_cap;\nstruct mlx4_init_hca_param;\n\nu64 mlx4_make_profile(struct mlx4_dev *dev,\n\t\t      struct mlx4_profile *request,\n\t\t      struct mlx4_dev_cap *dev_cap,\n\t\t      struct mlx4_init_hca_param *init_hca);\nvoid mlx4_master_comm_channel(struct work_struct *work);\nvoid mlx4_gen_slave_eqe(struct work_struct *work);\nvoid mlx4_master_handle_slave_flr(struct work_struct *work);\n\nint mlx4_ALLOC_RES_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_FREE_RES_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_MAP_EQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\tstruct mlx4_vhcr *vhcr, struct mlx4_cmd_mailbox *inbox,\n\t\t\tstruct mlx4_cmd_mailbox *outbox,\n\t\t\tstruct mlx4_cmd_info *cmd);\nint mlx4_COMM_INT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_HW2SW_EQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_EQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_SW2HW_CQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_HW2SW_CQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_CQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_MODIFY_CQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_SW2HW_SRQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_HW2SW_SRQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_SRQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_ARM_SRQ_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t struct mlx4_vhcr *vhcr,\n\t\t\t struct mlx4_cmd_mailbox *inbox,\n\t\t\t struct mlx4_cmd_mailbox *outbox,\n\t\t\t struct mlx4_cmd_info *cmd);\nint mlx4_GEN_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\tstruct mlx4_vhcr *vhcr,\n\t\t\tstruct mlx4_cmd_mailbox *inbox,\n\t\t\tstruct mlx4_cmd_mailbox *outbox,\n\t\t\tstruct mlx4_cmd_info *cmd);\nint mlx4_RST2INIT_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t     struct mlx4_vhcr *vhcr,\n\t\t\t     struct mlx4_cmd_mailbox *inbox,\n\t\t\t     struct mlx4_cmd_mailbox *outbox,\n\t\t\t     struct mlx4_cmd_info *cmd);\nint mlx4_INIT2INIT_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t      struct mlx4_vhcr *vhcr,\n\t\t\t      struct mlx4_cmd_mailbox *inbox,\n\t\t\t      struct mlx4_cmd_mailbox *outbox,\n\t\t\t      struct mlx4_cmd_info *cmd);\nint mlx4_INIT2RTR_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t     struct mlx4_vhcr *vhcr,\n\t\t\t     struct mlx4_cmd_mailbox *inbox,\n\t\t\t     struct mlx4_cmd_mailbox *outbox,\n\t\t\t     struct mlx4_cmd_info *cmd);\nint mlx4_RTR2RTS_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_RTS2RTS_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_SQERR2RTS_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t      struct mlx4_vhcr *vhcr,\n\t\t\t      struct mlx4_cmd_mailbox *inbox,\n\t\t\t      struct mlx4_cmd_mailbox *outbox,\n\t\t\t      struct mlx4_cmd_info *cmd);\nint mlx4_2ERR_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t struct mlx4_vhcr *vhcr,\n\t\t\t struct mlx4_cmd_mailbox *inbox,\n\t\t\t struct mlx4_cmd_mailbox *outbox,\n\t\t\t struct mlx4_cmd_info *cmd);\nint mlx4_RTS2SQD_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_SQD2SQD_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_SQD2RTS_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_2RST_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t struct mlx4_vhcr *vhcr,\n\t\t\t struct mlx4_cmd_mailbox *inbox,\n\t\t\t struct mlx4_cmd_mailbox *outbox,\n\t\t\t struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\n\nint mlx4_GEN_EQE(struct mlx4_dev *dev, int slave, struct mlx4_eqe *eqe);\n\nenum {\n\tMLX4_CMD_CLEANUP_STRUCT = 1UL << 0,\n\tMLX4_CMD_CLEANUP_POOL\t= 1UL << 1,\n\tMLX4_CMD_CLEANUP_HCR\t= 1UL << 2,\n\tMLX4_CMD_CLEANUP_VHCR\t= 1UL << 3,\n\tMLX4_CMD_CLEANUP_ALL\t= (MLX4_CMD_CLEANUP_VHCR << 1) - 1\n};\n\nint mlx4_cmd_init(struct mlx4_dev *dev);\nvoid mlx4_cmd_cleanup(struct mlx4_dev *dev, int cleanup_mask);\nint mlx4_multi_func_init(struct mlx4_dev *dev);\nint mlx4_ARM_COMM_CHANNEL(struct mlx4_dev *dev);\nvoid mlx4_multi_func_cleanup(struct mlx4_dev *dev);\nvoid mlx4_cmd_event(struct mlx4_dev *dev, u16 token, u8 status, u64 out_param);\nint mlx4_cmd_use_events(struct mlx4_dev *dev);\nvoid mlx4_cmd_use_polling(struct mlx4_dev *dev);\n\nint mlx4_comm_cmd(struct mlx4_dev *dev, u8 cmd, u16 param,\n\t\t  u16 op, unsigned long timeout);\n\nvoid mlx4_cq_tasklet_cb(struct tasklet_struct *t);\nvoid mlx4_cq_completion(struct mlx4_dev *dev, u32 cqn);\nvoid mlx4_cq_event(struct mlx4_dev *dev, u32 cqn, int event_type);\n\nvoid mlx4_qp_event(struct mlx4_dev *dev, u32 qpn, int event_type);\n\nvoid mlx4_srq_event(struct mlx4_dev *dev, u32 srqn, int event_type);\n\nvoid mlx4_enter_error_state(struct mlx4_dev_persistent *persist);\nint mlx4_comm_internal_err(u32 slave_read);\n\nint mlx4_crdump_collect(struct mlx4_dev *dev);\n\nint mlx4_SENSE_PORT(struct mlx4_dev *dev, int port,\n\t\t    enum mlx4_port_type *type);\nvoid mlx4_do_sense_ports(struct mlx4_dev *dev,\n\t\t\t enum mlx4_port_type *stype,\n\t\t\t enum mlx4_port_type *defaults);\nvoid mlx4_start_sense(struct mlx4_dev *dev);\nvoid mlx4_stop_sense(struct mlx4_dev *dev);\nvoid mlx4_sense_init(struct mlx4_dev *dev);\nint mlx4_check_port_params(struct mlx4_dev *dev,\n\t\t\t   enum mlx4_port_type *port_type);\nint mlx4_change_port_types(struct mlx4_dev *dev,\n\t\t\t   enum mlx4_port_type *port_types);\n\nvoid mlx4_init_mac_table(struct mlx4_dev *dev, struct mlx4_mac_table *table);\nvoid mlx4_init_vlan_table(struct mlx4_dev *dev, struct mlx4_vlan_table *table);\nvoid mlx4_init_roce_gid_table(struct mlx4_dev *dev,\n\t\t\t      struct mlx4_roce_gid_table *table);\nvoid __mlx4_unregister_vlan(struct mlx4_dev *dev, u8 port, u16 vlan);\nint __mlx4_register_vlan(struct mlx4_dev *dev, u8 port, u16 vlan, int *index);\nint mlx4_bond_vlan_table(struct mlx4_dev *dev);\nint mlx4_unbond_vlan_table(struct mlx4_dev *dev);\nint mlx4_bond_mac_table(struct mlx4_dev *dev);\nint mlx4_unbond_mac_table(struct mlx4_dev *dev);\n\nint mlx4_SET_PORT(struct mlx4_dev *dev, u8 port, int pkey_tbl_sz);\n \nint mlx4_get_slave_from_resource_id(struct mlx4_dev *dev,\n\t\t\t\t    enum mlx4_resource resource_type,\n\t\t\t\t    u64 resource_id, int *slave);\nvoid mlx4_delete_all_resources_for_slave(struct mlx4_dev *dev, int slave_id);\nvoid mlx4_reset_roce_gids(struct mlx4_dev *dev, int slave);\nint mlx4_init_resource_tracker(struct mlx4_dev *dev);\n\nvoid mlx4_free_resource_tracker(struct mlx4_dev *dev,\n\t\t\t\tenum mlx4_res_tracker_free_type type);\n\nint mlx4_QUERY_FW_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_SET_PORT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t  struct mlx4_vhcr *vhcr,\n\t\t\t  struct mlx4_cmd_mailbox *inbox,\n\t\t\t  struct mlx4_cmd_mailbox *outbox,\n\t\t\t  struct mlx4_cmd_info *cmd);\nint mlx4_INIT_PORT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\nint mlx4_CLOSE_PORT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_DEV_CAP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t       struct mlx4_vhcr *vhcr,\n\t\t\t       struct mlx4_cmd_mailbox *inbox,\n\t\t\t       struct mlx4_cmd_mailbox *outbox,\n\t\t\t       struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_PORT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_get_port_ib_caps(struct mlx4_dev *dev, u8 port, __be32 *caps);\n\nint mlx4_get_slave_pkey_gid_tbl_len(struct mlx4_dev *dev, u8 port,\n\t\t\t\t    int *gid_tbl_len, int *pkey_tbl_len);\n\nint mlx4_QP_ATTACH_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\n\nint mlx4_UPDATE_QP_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t   struct mlx4_cmd_info *cmd);\n\nint mlx4_PROMISC_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t struct mlx4_vhcr *vhcr,\n\t\t\t struct mlx4_cmd_mailbox *inbox,\n\t\t\t struct mlx4_cmd_mailbox *outbox,\n\t\t\t struct mlx4_cmd_info *cmd);\nint mlx4_qp_detach_common(struct mlx4_dev *dev, struct mlx4_qp *qp, u8 gid[16],\n\t\t\t  enum mlx4_protocol prot, enum mlx4_steer_type steer);\nint mlx4_qp_attach_common(struct mlx4_dev *dev, struct mlx4_qp *qp, u8 gid[16],\n\t\t\t  int block_mcast_loopback, enum mlx4_protocol prot,\n\t\t\t  enum mlx4_steer_type steer);\nint mlx4_trans_to_dmfs_attach(struct mlx4_dev *dev, struct mlx4_qp *qp,\n\t\t\t      u8 gid[16], u8 port,\n\t\t\t      int block_mcast_loopback,\n\t\t\t      enum mlx4_protocol prot, u64 *reg_id);\nint mlx4_SET_MCAST_FLTR_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t\tstruct mlx4_vhcr *vhcr,\n\t\t\t\tstruct mlx4_cmd_mailbox *inbox,\n\t\t\t\tstruct mlx4_cmd_mailbox *outbox,\n\t\t\t\tstruct mlx4_cmd_info *cmd);\nint mlx4_SET_VLAN_FLTR_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t       struct mlx4_vhcr *vhcr,\n\t\t\t       struct mlx4_cmd_mailbox *inbox,\n\t\t\t       struct mlx4_cmd_mailbox *outbox,\n\t\t\t       struct mlx4_cmd_info *cmd);\nint mlx4_common_set_vlan_fltr(struct mlx4_dev *dev, int function,\n\t\t\t\t     int port, void *buf);\nint mlx4_DUMP_ETH_STATS_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t\t   struct mlx4_vhcr *vhcr,\n\t\t\t\t   struct mlx4_cmd_mailbox *inbox,\n\t\t\t\t   struct mlx4_cmd_mailbox *outbox,\n\t\t\t\tstruct mlx4_cmd_info *cmd);\nint mlx4_PKEY_TABLE_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\nint mlx4_QUERY_IF_STAT_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t       struct mlx4_vhcr *vhcr,\n\t\t\t       struct mlx4_cmd_mailbox *inbox,\n\t\t\t       struct mlx4_cmd_mailbox *outbox,\n\t\t\t       struct mlx4_cmd_info *cmd);\nint mlx4_QP_FLOW_STEERING_ATTACH_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t\t\t struct mlx4_vhcr *vhcr,\n\t\t\t\t\t struct mlx4_cmd_mailbox *inbox,\n\t\t\t\t\t struct mlx4_cmd_mailbox *outbox,\n\t\t\t\t\t struct mlx4_cmd_info *cmd);\nint mlx4_QP_FLOW_STEERING_DETACH_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t\t\t struct mlx4_vhcr *vhcr,\n\t\t\t\t\t struct mlx4_cmd_mailbox *inbox,\n\t\t\t\t\t struct mlx4_cmd_mailbox *outbox,\n\t\t\t\t\t struct mlx4_cmd_info *cmd);\nint mlx4_ACCESS_REG_wrapper(struct mlx4_dev *dev, int slave,\n\t\t\t    struct mlx4_vhcr *vhcr,\n\t\t\t    struct mlx4_cmd_mailbox *inbox,\n\t\t\t    struct mlx4_cmd_mailbox *outbox,\n\t\t\t    struct mlx4_cmd_info *cmd);\n\nint mlx4_get_mgm_entry_size(struct mlx4_dev *dev);\nint mlx4_get_qp_per_mgm(struct mlx4_dev *dev);\n\nstatic inline void set_param_l(u64 *arg, u32 val)\n{\n\t*arg = (*arg & 0xffffffff00000000ULL) | (u64) val;\n}\n\nstatic inline void set_param_h(u64 *arg, u32 val)\n{\n\t*arg = (*arg & 0xffffffff) | ((u64) val << 32);\n}\n\nstatic inline u32 get_param_l(u64 *arg)\n{\n\treturn (u32) (*arg & 0xffffffff);\n}\n\nstatic inline u32 get_param_h(u64 *arg)\n{\n\treturn (u32)(*arg >> 32);\n}\n\nstatic inline spinlock_t *mlx4_tlock(struct mlx4_dev *dev)\n{\n\treturn &mlx4_priv(dev)->mfunc.master.res_tracker.lock;\n}\n\n#define NOT_MASKED_PD_BITS 17\n\nvoid mlx4_vf_immed_vlan_work_handler(struct work_struct *_work);\n\nvoid mlx4_init_quotas(struct mlx4_dev *dev);\n\n \nvoid mlx4_replace_zero_macs(struct mlx4_dev *dev);\nint mlx4_get_slave_num_gids(struct mlx4_dev *dev, int slave, int port);\n \nint mlx4_get_vf_indx(struct mlx4_dev *dev, int slave);\nint mlx4_config_mad_demux(struct mlx4_dev *dev);\nint mlx4_do_bond(struct mlx4_dev *dev, bool enable);\nint mlx4_bond_fs_rules(struct mlx4_dev *dev);\nint mlx4_unbond_fs_rules(struct mlx4_dev *dev);\n\nenum mlx4_zone_flags {\n\tMLX4_ZONE_ALLOW_ALLOC_FROM_LOWER_PRIO\t= 1UL << 0,\n\tMLX4_ZONE_ALLOW_ALLOC_FROM_EQ_PRIO\t= 1UL << 1,\n\tMLX4_ZONE_FALLBACK_TO_HIGHER_PRIO\t= 1UL << 2,\n\tMLX4_ZONE_USE_RR\t\t\t= 1UL << 3,\n};\n\nenum mlx4_zone_alloc_flags {\n\t \n\tMLX4_ZONE_ALLOC_FLAGS_NO_OVERLAP\t= 1UL << 0,\n};\n\nstruct mlx4_zone_allocator;\n\n \nstruct mlx4_zone_allocator *mlx4_zone_allocator_create(enum mlx4_zone_alloc_flags flags);\n\n \nint mlx4_zone_add_one(struct mlx4_zone_allocator *zone_alloc,\n\t\t      struct mlx4_bitmap *bitmap,\n\t\t      u32 flags,\n\t\t      int priority,\n\t\t      int offset,\n\t\t      u32 *puid);\n\n \nint mlx4_zone_remove_one(struct mlx4_zone_allocator *zone_alloc, u32 uid);\n\n \nvoid mlx4_zone_allocator_destroy(struct mlx4_zone_allocator *zone_alloc);\n\n \nu32 mlx4_zone_alloc_entries(struct mlx4_zone_allocator *zones, u32 uid, int count,\n\t\t\t    int align, u32 skip_mask, u32 *puid);\n\n \nu32 mlx4_zone_free_entries(struct mlx4_zone_allocator *zones,\n\t\t\t   u32 uid, u32 obj, u32 count);\n\n \nu32 mlx4_zone_free_entries_unique(struct mlx4_zone_allocator *zones, u32 obj, u32 count);\n\n \nstruct mlx4_bitmap *mlx4_zone_get_bitmap(struct mlx4_zone_allocator *zones, u32 uid);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}