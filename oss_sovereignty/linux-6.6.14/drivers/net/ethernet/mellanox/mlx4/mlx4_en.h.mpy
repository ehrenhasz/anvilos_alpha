{
  "module_name": "mlx4_en.h",
  "hash_id": "127df40445cc404726ceabc88a7a694a8c79468502d9fb06ac9901b7c580fd89",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/mellanox/mlx4/mlx4_en.h",
  "human_readable_source": " \n\n#ifndef _MLX4_EN_H_\n#define _MLX4_EN_H_\n\n#include <linux/bitops.h>\n#include <linux/compiler.h>\n#include <linux/ethtool.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/netdevice.h>\n#include <linux/if_vlan.h>\n#include <linux/net_tstamp.h>\n#ifdef CONFIG_MLX4_EN_DCB\n#include <linux/dcbnl.h>\n#endif\n#include <linux/cpu_rmap.h>\n#include <linux/ptp_clock_kernel.h>\n#include <linux/irq.h>\n#include <net/xdp.h>\n#include <linux/notifier.h>\n\n#include <linux/mlx4/device.h>\n#include <linux/mlx4/qp.h>\n#include <linux/mlx4/cq.h>\n#include <linux/mlx4/srq.h>\n#include <linux/mlx4/doorbell.h>\n#include <linux/mlx4/cmd.h>\n\n#include \"en_port.h\"\n#include \"mlx4_stats.h\"\n\n#define DRV_NAME\t\"mlx4_en\"\n#define DRV_VERSION\t\"4.0-0\"\n\n#define MLX4_EN_MSG_LEVEL\t(NETIF_MSG_LINK | NETIF_MSG_IFDOWN)\n\n \n\n\n#define MLX4_EN_PAGE_SHIFT\t12\n#define MLX4_EN_PAGE_SIZE\t(1 << MLX4_EN_PAGE_SHIFT)\n#define DEF_RX_RINGS\t\t16\n#define MAX_RX_RINGS\t\t128\n#define MIN_RX_RINGS\t\t1\n#define LOG_TXBB_SIZE\t\t6\n#define TXBB_SIZE\t\tBIT(LOG_TXBB_SIZE)\n#define HEADROOM\t\t(2048 / TXBB_SIZE + 1)\n#define STAMP_STRIDE\t\t64\n#define STAMP_DWORDS\t\t(STAMP_STRIDE / 4)\n#define STAMP_SHIFT\t\t31\n#define STAMP_VAL\t\t0x7fffffff\n#define STATS_DELAY\t\t(HZ / 4)\n#define SERVICE_TASK_DELAY\t(HZ / 4)\n#define MAX_NUM_OF_FS_RULES\t256\n\n#define MLX4_EN_FILTER_HASH_SHIFT 4\n#define MLX4_EN_FILTER_EXPIRY_QUOTA 60\n\n#define CTRL_SIZE\tsizeof(struct mlx4_wqe_ctrl_seg)\n#define DS_SIZE\t\tsizeof(struct mlx4_wqe_data_seg)\n\n \n#define MLX4_TX_BOUNCE_BUFFER_SIZE \\\n\tALIGN(256 + CTRL_SIZE + DS_SIZE + MAX_SKB_FRAGS * DS_SIZE, TXBB_SIZE)\n\n#define MLX4_MAX_DESC_TXBBS\t   (MLX4_TX_BOUNCE_BUFFER_SIZE / TXBB_SIZE)\n\n \n\n#define MLX4_EN_PRIV_FLAGS_BLUEFLAME 1\n#define MLX4_EN_PRIV_FLAGS_PHV\t     2\n\n#define MLX4_EN_WATCHDOG_TIMEOUT\t(15 * HZ)\n\n \n#define MLX4_EN_ALLOC_SIZE\tPAGE_ALIGN(16384)\n\n#define MLX4_EN_MAX_RX_FRAGS\t4\n\n \n#define MLX4_EN_MAX_TX_SIZE\t8192\n#define MLX4_EN_MAX_RX_SIZE\t8192\n\n \n#define MLX4_EN_MIN_RX_SIZE\t(MLX4_EN_ALLOC_SIZE / SMP_CACHE_BYTES)\n#define MLX4_EN_MIN_TX_SIZE\t(4096 / TXBB_SIZE)\n\n#define MLX4_EN_SMALL_PKT_SIZE\t\t64\n#define MLX4_EN_MIN_TX_RING_P_UP\t1\n#define MLX4_EN_MAX_TX_RING_P_UP\t32\n#define MLX4_EN_NUM_UP_LOW\t\t1\n#define MLX4_EN_NUM_UP_HIGH\t\t8\n#define MLX4_EN_DEF_RX_RING_SIZE  \t1024\n#define MLX4_EN_DEF_TX_RING_SIZE\tMLX4_EN_DEF_RX_RING_SIZE\n#define MAX_TX_RINGS\t\t\t(MLX4_EN_MAX_TX_RING_P_UP * \\\n\t\t\t\t\t MLX4_EN_NUM_UP_HIGH)\n\n#define MLX4_EN_DEFAULT_TX_WORK\t\t256\n\n \n#define MLX4_EN_RX_COAL_TARGET\t44\n#define MLX4_EN_RX_COAL_TIME\t0x10\n\n#define MLX4_EN_TX_COAL_PKTS\t16\n#define MLX4_EN_TX_COAL_TIME\t0x10\n\n#define MLX4_EN_MAX_COAL_PKTS\tU16_MAX\n#define MLX4_EN_MAX_COAL_TIME\tU16_MAX\n\n#define MLX4_EN_RX_RATE_LOW\t\t400000\n#define MLX4_EN_RX_COAL_TIME_LOW\t0\n#define MLX4_EN_RX_RATE_HIGH\t\t450000\n#define MLX4_EN_RX_COAL_TIME_HIGH\t128\n#define MLX4_EN_RX_SIZE_THRESH\t\t1024\n#define MLX4_EN_RX_RATE_THRESH\t\t(1000000 / MLX4_EN_RX_COAL_TIME_HIGH)\n#define MLX4_EN_SAMPLE_INTERVAL\t\t0\n#define MLX4_EN_AVG_PKT_SMALL\t\t256\n\n#define MLX4_EN_AUTO_CONF\t0xffff\n\n#define MLX4_EN_DEF_RX_PAUSE\t1\n#define MLX4_EN_DEF_TX_PAUSE\t1\n\n \n#define MLX4_EN_TX_POLL_MODER\t16\n#define MLX4_EN_TX_POLL_TIMEOUT\t(HZ / 4)\n\n#define SMALL_PACKET_SIZE      (256 - NET_IP_ALIGN)\n#define HEADER_COPY_SIZE       (128 - NET_IP_ALIGN)\n#define MLX4_LOOPBACK_TEST_PAYLOAD (HEADER_COPY_SIZE - ETH_HLEN)\n#define PREAMBLE_LEN           8\n#define MLX4_SELFTEST_LB_MIN_MTU (MLX4_LOOPBACK_TEST_PAYLOAD + NET_IP_ALIGN + \\\n\t\t\t\t  ETH_HLEN + PREAMBLE_LEN)\n\n \n#define MLX4_EN_EFF_MTU(mtu)\t((mtu) + ETH_HLEN + (2 * VLAN_HLEN))\n#define ETH_BCAST\t\t0xffffffffffffULL\n\n#define MLX4_EN_LOOPBACK_RETRIES\t5\n#define MLX4_EN_LOOPBACK_TIMEOUT\t100\n\n \nenum {\n\tMAX_INLINE = 104,  \n\tMAX_BF = 256,\n\tMIN_PKT_LEN = 17,\n};\n\n \n\nenum cq_type {\n\t \n\tTX,\n\tTX_XDP,\n#define MLX4_EN_NUM_TX_TYPES (TX_XDP + 1)\n\tRX,\n};\n\n\n \n#define ROUNDUP_LOG2(x)\t\tilog2(roundup_pow_of_two(x))\n#define XNOR(x, y)\t\t(!(x) == !(y))\n\n\nstruct mlx4_en_tx_info {\n\tunion {\n\t\tstruct sk_buff *skb;\n\t\tstruct page *page;\n\t};\n\tdma_addr_t\tmap0_dma;\n\tu32\t\tmap0_byte_count;\n\tu32\t\tnr_txbb;\n\tu32\t\tnr_bytes;\n\tu8\t\tlinear;\n\tu8\t\tdata_offset;\n\tu8\t\tinl;\n\tu8\t\tts_requested;\n\tu8\t\tnr_maps;\n} ____cacheline_aligned_in_smp;\n\n\n#define MLX4_EN_BIT_DESC_OWN\t0x80000000\n#define MLX4_EN_MEMTYPE_PAD\t0x100\n\n\nstruct mlx4_en_tx_desc {\n\tstruct mlx4_wqe_ctrl_seg ctrl;\n\tunion {\n\t\tstruct mlx4_wqe_data_seg data;  \n\t\tstruct mlx4_wqe_lso_seg lso;\n\t\tstruct mlx4_wqe_inline_seg inl;\n\t};\n};\n\n#define MLX4_EN_USE_SRQ\t\t0x01000000\n\n#define MLX4_EN_CX3_LOW_ID\t0x1000\n#define MLX4_EN_CX3_HIGH_ID\t0x1005\n\nstruct mlx4_en_rx_alloc {\n\tstruct page\t*page;\n\tdma_addr_t\tdma;\n\tu32\t\tpage_offset;\n};\n\n#define MLX4_EN_CACHE_SIZE (2 * NAPI_POLL_WEIGHT)\n\nstruct mlx4_en_page_cache {\n\tu32 index;\n\tstruct {\n\t\tstruct page\t*page;\n\t\tdma_addr_t\tdma;\n\t} buf[MLX4_EN_CACHE_SIZE];\n};\n\nenum {\n\tMLX4_EN_TX_RING_STATE_RECOVERING,\n};\n\nstruct mlx4_en_priv;\n\nstruct mlx4_en_tx_ring {\n\t \n\tu32\t\t\tlast_nr_txbb;\n\tu32\t\t\tcons;\n\tunsigned long\t\twake_queue;\n\tstruct netdev_queue\t*tx_queue;\n\tu32\t\t\t(*free_tx_desc)(struct mlx4_en_priv *priv,\n\t\t\t\t\t\tstruct mlx4_en_tx_ring *ring,\n\t\t\t\t\t\tint index,\n\t\t\t\t\t\tu64 timestamp, int napi_mode);\n\tstruct mlx4_en_rx_ring\t*recycle_ring;\n\n\t \n\tu32\t\t\tprod ____cacheline_aligned_in_smp;\n\tunsigned int\t\ttx_dropped;\n\tunsigned long\t\tbytes;\n\tunsigned long\t\tpackets;\n\tunsigned long\t\ttx_csum;\n\tunsigned long\t\ttso_packets;\n\tunsigned long\t\txmit_more;\n\tstruct mlx4_bf\t\tbf;\n\n\t \n\tvoid __iomem\t\t*doorbell_address;\n\t__be32\t\t\tdoorbell_qpn;\n\t__be32\t\t\tmr_key;\n\tu32\t\t\tsize;  \n\tu32\t\t\tsize_mask;\n\tu32\t\t\tfull_size;\n\tu32\t\t\tbuf_size;\n\tvoid\t\t\t*buf;\n\tstruct mlx4_en_tx_info\t*tx_info;\n\tint\t\t\tqpn;\n\tu8\t\t\tqueue_index;\n\tbool\t\t\tbf_enabled;\n\tbool\t\t\tbf_alloced;\n\tu8\t\t\thwtstamp_tx_type;\n\tu8\t\t\t*bounce_buf;\n\n\t \n\tunsigned long\t\tqueue_stopped;\n\tunsigned long\t\tstate;\n\tstruct mlx4_hwq_resources sp_wqres;\n\tstruct mlx4_qp\t\tsp_qp;\n\tstruct mlx4_qp_context\tsp_context;\n\tcpumask_t\t\tsp_affinity_mask;\n\tenum mlx4_qp_state\tsp_qp_state;\n\tu16\t\t\tsp_stride;\n\tu16\t\t\tsp_cqn;\t \n} ____cacheline_aligned_in_smp;\n\nstruct mlx4_en_rx_desc {\n\t \n\tDECLARE_FLEX_ARRAY(struct mlx4_wqe_data_seg, data);\n};\n\nstruct mlx4_en_rx_ring {\n\tstruct mlx4_hwq_resources wqres;\n\tu32 size ;\t \n\tu32 actual_size;\n\tu32 size_mask;\n\tu16 stride;\n\tu16 log_stride;\n\tu16 cqn;\t \n\tu32 prod;\n\tu32 cons;\n\tu32 buf_size;\n\tu8  fcs_del;\n\tvoid *buf;\n\tvoid *rx_info;\n\tstruct bpf_prog __rcu *xdp_prog;\n\tstruct mlx4_en_page_cache page_cache;\n\tunsigned long bytes;\n\tunsigned long packets;\n\tunsigned long csum_ok;\n\tunsigned long csum_none;\n\tunsigned long csum_complete;\n\tunsigned long rx_alloc_pages;\n\tunsigned long xdp_drop;\n\tunsigned long xdp_redirect;\n\tunsigned long xdp_redirect_fail;\n\tunsigned long xdp_tx;\n\tunsigned long xdp_tx_full;\n\tunsigned long dropped;\n\tint hwtstamp_rx_filter;\n\tcpumask_var_t affinity_mask;\n\tstruct xdp_rxq_info xdp_rxq;\n};\n\nstruct mlx4_en_cq {\n\tstruct mlx4_cq          mcq;\n\tstruct mlx4_hwq_resources wqres;\n\tint                     ring;\n\tstruct net_device      *dev;\n\tunion {\n\t\tstruct napi_struct napi;\n\t\tbool               xdp_busy;\n\t};\n\tint size;\n\tint buf_size;\n\tint vector;\n\tenum cq_type type;\n\tu16 moder_time;\n\tu16 moder_cnt;\n\tstruct mlx4_cqe *buf;\n#define MLX4_EN_OPCODE_ERROR\t0x1e\n\n\tconst struct cpumask *aff_mask;\n};\n\nstruct mlx4_en_port_profile {\n\tu32 flags;\n\tu32 tx_ring_num[MLX4_EN_NUM_TX_TYPES];\n\tu32 rx_ring_num;\n\tu32 tx_ring_size;\n\tu32 rx_ring_size;\n\tu8 num_tx_rings_p_up;\n\tu8 rx_pause;\n\tu8 rx_ppp;\n\tu8 tx_pause;\n\tu8 tx_ppp;\n\tu8 num_up;\n\tint rss_rings;\n\tint inline_thold;\n\tstruct hwtstamp_config hwtstamp_config;\n};\n\nstruct mlx4_en_profile {\n\tint udp_rss;\n\tu8 rss_mask;\n\tu32 active_ports;\n\tu32 small_pkt_int;\n\tu8 no_reset;\n\tu8 max_num_tx_rings_p_up;\n\tstruct mlx4_en_port_profile prof[MLX4_MAX_PORTS + 1];\n};\n\nstruct mlx4_en_dev {\n\tstruct mlx4_dev         *dev;\n\tstruct pci_dev\t\t*pdev;\n\tstruct mutex\t\tstate_lock;\n\tstruct net_device       *pndev[MLX4_MAX_PORTS + 1];\n\tstruct net_device       *upper[MLX4_MAX_PORTS + 1];\n\tu32                     port_cnt;\n\tbool\t\t\tdevice_up;\n\tstruct mlx4_en_profile  profile;\n\tu32\t\t\tLSO_support;\n\tstruct workqueue_struct *workqueue;\n\tstruct device           *dma_device;\n\tvoid __iomem            *uar_map;\n\tstruct mlx4_uar         priv_uar;\n\tstruct mlx4_mr\t\tmr;\n\tu32                     priv_pdn;\n\tspinlock_t              uar_lock;\n\tu8\t\t\tmac_removed[MLX4_MAX_PORTS + 1];\n\tu32\t\t\tnominal_c_mult;\n\tstruct cyclecounter\tcycles;\n\tseqlock_t\t\tclock_lock;\n\tstruct timecounter\tclock;\n\tunsigned long\t\tlast_overflow_check;\n\tstruct ptp_clock\t*ptp_clock;\n\tstruct ptp_clock_info\tptp_clock_info;\n\tstruct notifier_block\tnetdev_nb;\n\tstruct notifier_block\tmlx_nb;\n};\n\n\nstruct mlx4_en_rss_map {\n\tint base_qpn;\n\tstruct mlx4_qp qps[MAX_RX_RINGS];\n\tenum mlx4_qp_state state[MAX_RX_RINGS];\n\tstruct mlx4_qp *indir_qp;\n\tenum mlx4_qp_state indir_state;\n};\n\nenum mlx4_en_port_flag {\n\tMLX4_EN_PORT_ANC = 1<<0,  \n\tMLX4_EN_PORT_ANE = 1<<1,  \n};\n\nstruct mlx4_en_port_state {\n\tint link_state;\n\tint link_speed;\n\tint transceiver;\n\tu32 flags;\n};\n\nenum mlx4_en_mclist_act {\n\tMCLIST_NONE,\n\tMCLIST_REM,\n\tMCLIST_ADD,\n};\n\nstruct mlx4_en_mc_list {\n\tstruct list_head\tlist;\n\tenum mlx4_en_mclist_act\taction;\n\tu8\t\t\taddr[ETH_ALEN];\n\tu64\t\t\treg_id;\n\tu64\t\t\ttunnel_reg_id;\n};\n\nstruct mlx4_en_frag_info {\n\tu16 frag_size;\n\tu32 frag_stride;\n};\n\n#ifdef CONFIG_MLX4_EN_DCB\n \n#define MLX4_EN_BW_MIN 1\n#define MLX4_EN_BW_MAX 100  \n\n#define MLX4_EN_TC_VENDOR 0\n#define MLX4_EN_TC_ETS 7\n\nenum dcb_pfc_type {\n\tpfc_disabled = 0,\n\tpfc_enabled_full,\n\tpfc_enabled_tx,\n\tpfc_enabled_rx\n};\n\nstruct mlx4_en_cee_config {\n\tbool\tpfc_state;\n\tenum\tdcb_pfc_type dcb_pfc[MLX4_EN_NUM_UP_HIGH];\n};\n#endif\n\nstruct ethtool_flow_id {\n\tstruct list_head list;\n\tstruct ethtool_rx_flow_spec flow_spec;\n\tu64 id;\n};\n\nenum {\n\tMLX4_EN_FLAG_PROMISC\t\t= (1 << 0),\n\tMLX4_EN_FLAG_MC_PROMISC\t\t= (1 << 1),\n\t \n\tMLX4_EN_FLAG_ENABLE_HW_LOOPBACK\t= (1 << 2),\n\t \n\tMLX4_EN_FLAG_RX_FILTER_NEEDED\t= (1 << 3),\n\tMLX4_EN_FLAG_FORCE_PROMISC\t= (1 << 4),\n\tMLX4_EN_FLAG_RX_CSUM_NON_TCP_UDP\t= (1 << 5),\n#ifdef CONFIG_MLX4_EN_DCB\n\tMLX4_EN_FLAG_DCB_ENABLED        = (1 << 6),\n#endif\n};\n\n#define PORT_BEACON_MAX_LIMIT (65535)\n#define MLX4_EN_MAC_HASH_SIZE (1 << BITS_PER_BYTE)\n#define MLX4_EN_MAC_HASH_IDX 5\n\nstruct mlx4_en_stats_bitmap {\n\tDECLARE_BITMAP(bitmap, NUM_ALL_STATS);\n\tstruct mutex mutex;  \n};\n\nenum {\n\tMLX4_EN_STATE_FLAG_RESTARTING,\n};\n\nstruct mlx4_en_priv {\n\tstruct mlx4_en_dev *mdev;\n\tstruct mlx4_en_port_profile *prof;\n\tstruct net_device *dev;\n\tunsigned long active_vlans[BITS_TO_LONGS(VLAN_N_VID)];\n\tstruct mlx4_en_port_state port_state;\n\tspinlock_t stats_lock;\n\tstruct ethtool_flow_id ethtool_rules[MAX_NUM_OF_FS_RULES];\n\t \n\tstruct list_head ethtool_list;\n\n\tunsigned long last_moder_packets[MAX_RX_RINGS];\n\tunsigned long last_moder_tx_packets;\n\tunsigned long last_moder_bytes[MAX_RX_RINGS];\n\tunsigned long last_moder_jiffies;\n\tint last_moder_time[MAX_RX_RINGS];\n\tu16 rx_usecs;\n\tu16 rx_frames;\n\tu16 tx_usecs;\n\tu16 tx_frames;\n\tu32 pkt_rate_low;\n\tu16 rx_usecs_low;\n\tu32 pkt_rate_high;\n\tu16 rx_usecs_high;\n\tu32 sample_interval;\n\tu32 adaptive_rx_coal;\n\tu32 msg_enable;\n\tu32 loopback_ok;\n\tu32 validate_loopback;\n\n\tstruct mlx4_hwq_resources res;\n\tint link_state;\n\tbool port_up;\n\tint port;\n\tint registered;\n\tint allocated;\n\tint stride;\n\tunsigned char current_mac[ETH_ALEN + 2];\n\tint mac_index;\n\tunsigned max_mtu;\n\tint base_qpn;\n\tint cqe_factor;\n\tint cqe_size;\n\n\tstruct mlx4_en_rss_map rss_map;\n\t__be32 ctrl_flags;\n\tu32 flags;\n\tu8 num_tx_rings_p_up;\n\tu32 tx_work_limit;\n\tu32 tx_ring_num[MLX4_EN_NUM_TX_TYPES];\n\tu32 rx_ring_num;\n\tu32 rx_skb_size;\n\tstruct mlx4_en_frag_info frag_info[MLX4_EN_MAX_RX_FRAGS];\n\tu8 num_frags;\n\tu8 log_rx_info;\n\tu8 dma_dir;\n\tu16 rx_headroom;\n\n\tstruct mlx4_en_tx_ring **tx_ring[MLX4_EN_NUM_TX_TYPES];\n\tstruct mlx4_en_rx_ring *rx_ring[MAX_RX_RINGS];\n\tstruct mlx4_en_cq **tx_cq[MLX4_EN_NUM_TX_TYPES];\n\tstruct mlx4_en_cq *rx_cq[MAX_RX_RINGS];\n\tstruct mlx4_qp drop_qp;\n\tstruct work_struct rx_mode_task;\n\tstruct work_struct restart_task;\n\tstruct work_struct linkstate_task;\n\tstruct delayed_work stats_task;\n\tstruct delayed_work service_task;\n\tstruct mlx4_en_pkt_stats pkstats;\n\tstruct mlx4_en_counter_stats pf_stats;\n\tstruct mlx4_en_flow_stats_rx rx_priority_flowstats[MLX4_NUM_PRIORITIES];\n\tstruct mlx4_en_flow_stats_tx tx_priority_flowstats[MLX4_NUM_PRIORITIES];\n\tstruct mlx4_en_flow_stats_rx rx_flowstats;\n\tstruct mlx4_en_flow_stats_tx tx_flowstats;\n\tstruct mlx4_en_port_stats port_stats;\n\tstruct mlx4_en_xdp_stats xdp_stats;\n\tstruct mlx4_en_phy_stats phy_stats;\n\tstruct mlx4_en_stats_bitmap stats_bitmap;\n\tstruct list_head mc_list;\n\tstruct list_head curr_list;\n\tu64 broadcast_id;\n\tstruct mlx4_en_stat_out_mbox hw_stats;\n\tint vids[128];\n\tbool wol;\n\tstruct device *ddev;\n\tstruct hlist_head mac_hash[MLX4_EN_MAC_HASH_SIZE];\n\tstruct hwtstamp_config hwtstamp_config;\n\tu32 counter_index;\n\n#ifdef CONFIG_MLX4_EN_DCB\n#define MLX4_EN_DCB_ENABLED\t0x3\n\tstruct ieee_ets ets;\n\tu16 maxrate[IEEE_8021QAZ_MAX_TCS];\n\tenum dcbnl_cndd_states cndd_state[IEEE_8021QAZ_MAX_TCS];\n\tstruct mlx4_en_cee_config cee_config;\n\tu8 dcbx_cap;\n#endif\n#ifdef CONFIG_RFS_ACCEL\n\tspinlock_t filters_lock;\n\tint last_filter_id;\n\tstruct list_head filters;\n\tstruct hlist_head filter_hash[1 << MLX4_EN_FILTER_HASH_SHIFT];\n#endif\n\tu64 tunnel_reg_id;\n\t__be16 vxlan_port;\n\n\tu32 pflags;\n\tu8 rss_key[MLX4_EN_RSS_KEY_SIZE];\n\tu8 rss_hash_fn;\n\tunsigned long state;\n};\n\nenum mlx4_en_wol {\n\tMLX4_EN_WOL_MAGIC = (1ULL << 61),\n\tMLX4_EN_WOL_ENABLED = (1ULL << 62),\n};\n\nstruct mlx4_mac_entry {\n\tstruct hlist_node hlist;\n\tunsigned char mac[ETH_ALEN + 2];\n\tu64 reg_id;\n\tstruct rcu_head rcu;\n};\n\nstatic inline struct mlx4_cqe *mlx4_en_get_cqe(void *buf, int idx, int cqe_sz)\n{\n\treturn buf + idx * cqe_sz;\n}\n\n#define MLX4_EN_WOL_DO_MODIFY (1ULL << 63)\n\nvoid mlx4_en_init_ptys2ethtool_map(void);\nvoid mlx4_en_update_loopback_state(struct net_device *dev,\n\t\t\t\t   netdev_features_t features);\n\nvoid mlx4_en_destroy_netdev(struct net_device *dev);\nint mlx4_en_init_netdev(struct mlx4_en_dev *mdev, int port,\n\t\t\tstruct mlx4_en_port_profile *prof);\n\nint mlx4_en_start_port(struct net_device *dev);\nvoid mlx4_en_stop_port(struct net_device *dev, int detach);\n\nvoid mlx4_en_set_stats_bitmap(struct mlx4_dev *dev,\n\t\t\t      struct mlx4_en_stats_bitmap *stats_bitmap,\n\t\t\t      u8 rx_ppp, u8 rx_pause,\n\t\t\t      u8 tx_ppp, u8 tx_pause);\n\nint mlx4_en_try_alloc_resources(struct mlx4_en_priv *priv,\n\t\t\t\tstruct mlx4_en_priv *tmp,\n\t\t\t\tstruct mlx4_en_port_profile *prof,\n\t\t\t\tbool carry_xdp_prog);\nvoid mlx4_en_safe_replace_resources(struct mlx4_en_priv *priv,\n\t\t\t\t    struct mlx4_en_priv *tmp);\n\nint mlx4_en_create_cq(struct mlx4_en_priv *priv, struct mlx4_en_cq **pcq,\n\t\t      int entries, int ring, enum cq_type mode, int node);\nvoid mlx4_en_destroy_cq(struct mlx4_en_priv *priv, struct mlx4_en_cq **pcq);\nint mlx4_en_activate_cq(struct mlx4_en_priv *priv, struct mlx4_en_cq *cq,\n\t\t\tint cq_idx);\nvoid mlx4_en_deactivate_cq(struct mlx4_en_priv *priv, struct mlx4_en_cq *cq);\nint mlx4_en_set_cq_moder(struct mlx4_en_priv *priv, struct mlx4_en_cq *cq);\nvoid mlx4_en_arm_cq(struct mlx4_en_priv *priv, struct mlx4_en_cq *cq);\n\nvoid mlx4_en_tx_irq(struct mlx4_cq *mcq);\nu16 mlx4_en_select_queue(struct net_device *dev, struct sk_buff *skb,\n\t\t\t struct net_device *sb_dev);\nnetdev_tx_t mlx4_en_xmit(struct sk_buff *skb, struct net_device *dev);\nnetdev_tx_t mlx4_en_xmit_frame(struct mlx4_en_rx_ring *rx_ring,\n\t\t\t       struct mlx4_en_rx_alloc *frame,\n\t\t\t       struct mlx4_en_priv *priv, unsigned int length,\n\t\t\t       int tx_ind, bool *doorbell_pending);\nvoid mlx4_en_xmit_doorbell(struct mlx4_en_tx_ring *ring);\nbool mlx4_en_rx_recycle(struct mlx4_en_rx_ring *ring,\n\t\t\tstruct mlx4_en_rx_alloc *frame);\n\nint mlx4_en_create_tx_ring(struct mlx4_en_priv *priv,\n\t\t\t   struct mlx4_en_tx_ring **pring,\n\t\t\t   u32 size, u16 stride,\n\t\t\t   int node, int queue_index);\nvoid mlx4_en_destroy_tx_ring(struct mlx4_en_priv *priv,\n\t\t\t     struct mlx4_en_tx_ring **pring);\nvoid mlx4_en_init_tx_xdp_ring_descs(struct mlx4_en_priv *priv,\n\t\t\t\t    struct mlx4_en_tx_ring *ring);\nint mlx4_en_activate_tx_ring(struct mlx4_en_priv *priv,\n\t\t\t     struct mlx4_en_tx_ring *ring,\n\t\t\t     int cq, int user_prio);\nvoid mlx4_en_deactivate_tx_ring(struct mlx4_en_priv *priv,\n\t\t\t\tstruct mlx4_en_tx_ring *ring);\nvoid mlx4_en_set_num_rx_rings(struct mlx4_en_dev *mdev);\nvoid mlx4_en_recover_from_oom(struct mlx4_en_priv *priv);\nint mlx4_en_create_rx_ring(struct mlx4_en_priv *priv,\n\t\t\t   struct mlx4_en_rx_ring **pring,\n\t\t\t   u32 size, u16 stride, int node, int queue_index);\nvoid mlx4_en_destroy_rx_ring(struct mlx4_en_priv *priv,\n\t\t\t     struct mlx4_en_rx_ring **pring,\n\t\t\t     u32 size, u16 stride);\nint mlx4_en_activate_rx_rings(struct mlx4_en_priv *priv);\nvoid mlx4_en_deactivate_rx_ring(struct mlx4_en_priv *priv,\n\t\t\t\tstruct mlx4_en_rx_ring *ring);\nint mlx4_en_process_rx_cq(struct net_device *dev,\n\t\t\t  struct mlx4_en_cq *cq,\n\t\t\t  int budget);\nint mlx4_en_poll_rx_cq(struct napi_struct *napi, int budget);\nint mlx4_en_poll_tx_cq(struct napi_struct *napi, int budget);\nint mlx4_en_process_tx_cq(struct net_device *dev,\n\t\t\t  struct mlx4_en_cq *cq, int napi_budget);\nu32 mlx4_en_free_tx_desc(struct mlx4_en_priv *priv,\n\t\t\t struct mlx4_en_tx_ring *ring,\n\t\t\t int index, u64 timestamp,\n\t\t\t int napi_mode);\nu32 mlx4_en_recycle_tx_desc(struct mlx4_en_priv *priv,\n\t\t\t    struct mlx4_en_tx_ring *ring,\n\t\t\t    int index, u64 timestamp,\n\t\t\t    int napi_mode);\nvoid mlx4_en_fill_qp_context(struct mlx4_en_priv *priv, int size, int stride,\n\t\tint is_tx, int rss, int qpn, int cqn, int user_prio,\n\t\tstruct mlx4_qp_context *context);\nvoid mlx4_en_sqp_event(struct mlx4_qp *qp, enum mlx4_event event);\nint mlx4_en_change_mcast_lb(struct mlx4_en_priv *priv, struct mlx4_qp *qp,\n\t\t\t    int loopback);\nvoid mlx4_en_calc_rx_buf(struct net_device *dev);\nint mlx4_en_config_rss_steer(struct mlx4_en_priv *priv);\nvoid mlx4_en_release_rss_steer(struct mlx4_en_priv *priv);\nint mlx4_en_create_drop_qp(struct mlx4_en_priv *priv);\nvoid mlx4_en_destroy_drop_qp(struct mlx4_en_priv *priv);\nint mlx4_en_free_tx_buf(struct net_device *dev, struct mlx4_en_tx_ring *ring);\nvoid mlx4_en_rx_irq(struct mlx4_cq *mcq);\n\nint mlx4_SET_MCAST_FLTR(struct mlx4_dev *dev, u8 port, u64 mac, u64 clear, u8 mode);\nint mlx4_SET_VLAN_FLTR(struct mlx4_dev *dev, struct mlx4_en_priv *priv);\n\nvoid mlx4_en_fold_software_stats(struct net_device *dev);\nint mlx4_en_DUMP_ETH_STATS(struct mlx4_en_dev *mdev, u8 port, u8 reset);\nint mlx4_en_QUERY_PORT(struct mlx4_en_dev *mdev, u8 port);\n\n#ifdef CONFIG_MLX4_EN_DCB\nextern const struct dcbnl_rtnl_ops mlx4_en_dcbnl_ops;\nextern const struct dcbnl_rtnl_ops mlx4_en_dcbnl_pfc_ops;\n#endif\n\nint mlx4_en_setup_tc(struct net_device *dev, u8 up);\nint mlx4_en_alloc_tx_queue_per_tc(struct net_device *dev, u8 tc);\n\n#ifdef CONFIG_RFS_ACCEL\nvoid mlx4_en_cleanup_filters(struct mlx4_en_priv *priv);\n#endif\n\n#define MLX4_EN_NUM_SELF_TEST\t5\nvoid mlx4_en_ex_selftest(struct net_device *dev, u32 *flags, u64 *buf);\nvoid mlx4_en_ptp_overflow_check(struct mlx4_en_dev *mdev);\n\n#define DEV_FEATURE_CHANGED(dev, new_features, feature) \\\n\t((dev->features & feature) ^ (new_features & feature))\n\nint mlx4_en_moderation_update(struct mlx4_en_priv *priv);\nint mlx4_en_reset_config(struct net_device *dev,\n\t\t\t struct hwtstamp_config ts_config,\n\t\t\t netdev_features_t new_features);\nvoid mlx4_en_update_pfc_stats_bitmap(struct mlx4_dev *dev,\n\t\t\t\t     struct mlx4_en_stats_bitmap *stats_bitmap,\n\t\t\t\t     u8 rx_ppp, u8 rx_pause,\n\t\t\t\t     u8 tx_ppp, u8 tx_pause);\nint mlx4_en_netdev_event(struct notifier_block *this,\n\t\t\t unsigned long event, void *ptr);\n\nstruct xdp_md;\nint mlx4_en_xdp_rx_timestamp(const struct xdp_md *ctx, u64 *timestamp);\nint mlx4_en_xdp_rx_hash(const struct xdp_md *ctx, u32 *hash,\n\t\t\tenum xdp_rss_hash_type *rss_type);\n\n \nu64 mlx4_en_get_cqe_ts(struct mlx4_cqe *cqe);\nu64 mlx4_en_get_hwtstamp(struct mlx4_en_dev *mdev, u64 timestamp);\nvoid mlx4_en_fill_hwtstamps(struct mlx4_en_dev *mdev,\n\t\t\t    struct skb_shared_hwtstamps *hwts,\n\t\t\t    u64 timestamp);\nvoid mlx4_en_init_timestamp(struct mlx4_en_dev *mdev);\nvoid mlx4_en_remove_timestamp(struct mlx4_en_dev *mdev);\n\n \nextern const struct ethtool_ops mlx4_en_ethtool_ops;\n\n\n\n \n\n__printf(3, 4)\nvoid en_print(const char *level, const struct mlx4_en_priv *priv,\n\t      const char *format, ...);\n\n#define en_dbg(mlevel, priv, format, ...)\t\t\t\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (NETIF_MSG_##mlevel & (priv)->msg_enable)\t\t\t\\\n\t\ten_print(KERN_DEBUG, priv, format, ##__VA_ARGS__);\t\\\n} while (0)\n#define en_warn(priv, format, ...)\t\t\t\t\t\\\n\ten_print(KERN_WARNING, priv, format, ##__VA_ARGS__)\n#define en_err(priv, format, ...)\t\t\t\t\t\\\n\ten_print(KERN_ERR, priv, format, ##__VA_ARGS__)\n#define en_info(priv, format, ...)\t\t\t\t\t\\\n\ten_print(KERN_INFO, priv, format, ##__VA_ARGS__)\n\n#define mlx4_err(mdev, format, ...)\t\t\t\t\t\\\n\tpr_err(DRV_NAME \" %s: \" format,\t\t\t\t\t\\\n\t       dev_name(&(mdev)->pdev->dev), ##__VA_ARGS__)\n#define mlx4_info(mdev, format, ...)\t\t\t\t\t\\\n\tpr_info(DRV_NAME \" %s: \" format,\t\t\t\t\\\n\t\tdev_name(&(mdev)->pdev->dev), ##__VA_ARGS__)\n#define mlx4_warn(mdev, format, ...)\t\t\t\t\t\\\n\tpr_warn(DRV_NAME \" %s: \" format,\t\t\t\t\\\n\t\tdev_name(&(mdev)->pdev->dev), ##__VA_ARGS__)\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}