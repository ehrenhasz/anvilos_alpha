{
  "module_name": "sparx5_ethtool.c",
  "hash_id": "2d66e83602fefa321d9220053579e90b19d0b71cc07c302fa7c024b82e6286f4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/microchip/sparx5/sparx5_ethtool.c",
  "human_readable_source": "\n \n\n#include <linux/ethtool.h>\n\n#include \"sparx5_main_regs.h\"\n#include \"sparx5_main.h\"\n#include \"sparx5_port.h\"\n\n \n#define SPX5_PORT_POLICER_DROPS 0\n\n \nstatic void sparx5_update_counter(u64 *cnt, u32 val)\n{\n\tif (val < (*cnt & U32_MAX))\n\t\t*cnt += (u64)1 << 32;  \n\t*cnt = (*cnt & ~(u64)U32_MAX) + val;\n}\n\nenum sparx5_stats_entry {\n\tspx5_stats_rx_symbol_err_cnt = 0,\n\tspx5_stats_pmac_rx_symbol_err_cnt = 1,\n\tspx5_stats_tx_uc_cnt = 2,\n\tspx5_stats_pmac_tx_uc_cnt = 3,\n\tspx5_stats_tx_mc_cnt = 4,\n\tspx5_stats_tx_bc_cnt = 5,\n\tspx5_stats_tx_backoff1_cnt = 6,\n\tspx5_stats_tx_multi_coll_cnt = 7,\n\tspx5_stats_rx_uc_cnt = 8,\n\tspx5_stats_pmac_rx_uc_cnt = 9,\n\tspx5_stats_rx_mc_cnt = 10,\n\tspx5_stats_rx_bc_cnt = 11,\n\tspx5_stats_rx_crc_err_cnt = 12,\n\tspx5_stats_pmac_rx_crc_err_cnt = 13,\n\tspx5_stats_rx_alignment_lost_cnt = 14,\n\tspx5_stats_pmac_rx_alignment_lost_cnt = 15,\n\tspx5_stats_tx_ok_bytes_cnt = 16,\n\tspx5_stats_pmac_tx_ok_bytes_cnt = 17,\n\tspx5_stats_tx_defer_cnt = 18,\n\tspx5_stats_tx_late_coll_cnt = 19,\n\tspx5_stats_tx_xcoll_cnt = 20,\n\tspx5_stats_tx_csense_cnt = 21,\n\tspx5_stats_rx_ok_bytes_cnt = 22,\n\tspx5_stats_pmac_rx_ok_bytes_cnt = 23,\n\tspx5_stats_pmac_tx_mc_cnt = 24,\n\tspx5_stats_pmac_tx_bc_cnt = 25,\n\tspx5_stats_tx_xdefer_cnt = 26,\n\tspx5_stats_pmac_rx_mc_cnt = 27,\n\tspx5_stats_pmac_rx_bc_cnt = 28,\n\tspx5_stats_rx_in_range_len_err_cnt = 29,\n\tspx5_stats_pmac_rx_in_range_len_err_cnt = 30,\n\tspx5_stats_rx_out_of_range_len_err_cnt = 31,\n\tspx5_stats_pmac_rx_out_of_range_len_err_cnt = 32,\n\tspx5_stats_rx_oversize_cnt = 33,\n\tspx5_stats_pmac_rx_oversize_cnt = 34,\n\tspx5_stats_tx_pause_cnt = 35,\n\tspx5_stats_pmac_tx_pause_cnt = 36,\n\tspx5_stats_rx_pause_cnt = 37,\n\tspx5_stats_pmac_rx_pause_cnt = 38,\n\tspx5_stats_rx_unsup_opcode_cnt = 39,\n\tspx5_stats_pmac_rx_unsup_opcode_cnt = 40,\n\tspx5_stats_rx_undersize_cnt = 41,\n\tspx5_stats_pmac_rx_undersize_cnt = 42,\n\tspx5_stats_rx_fragments_cnt = 43,\n\tspx5_stats_pmac_rx_fragments_cnt = 44,\n\tspx5_stats_rx_jabbers_cnt = 45,\n\tspx5_stats_pmac_rx_jabbers_cnt = 46,\n\tspx5_stats_rx_size64_cnt = 47,\n\tspx5_stats_pmac_rx_size64_cnt = 48,\n\tspx5_stats_rx_size65to127_cnt = 49,\n\tspx5_stats_pmac_rx_size65to127_cnt = 50,\n\tspx5_stats_rx_size128to255_cnt = 51,\n\tspx5_stats_pmac_rx_size128to255_cnt = 52,\n\tspx5_stats_rx_size256to511_cnt = 53,\n\tspx5_stats_pmac_rx_size256to511_cnt = 54,\n\tspx5_stats_rx_size512to1023_cnt = 55,\n\tspx5_stats_pmac_rx_size512to1023_cnt = 56,\n\tspx5_stats_rx_size1024to1518_cnt = 57,\n\tspx5_stats_pmac_rx_size1024to1518_cnt = 58,\n\tspx5_stats_rx_size1519tomax_cnt = 59,\n\tspx5_stats_pmac_rx_size1519tomax_cnt = 60,\n\tspx5_stats_tx_size64_cnt = 61,\n\tspx5_stats_pmac_tx_size64_cnt = 62,\n\tspx5_stats_tx_size65to127_cnt = 63,\n\tspx5_stats_pmac_tx_size65to127_cnt = 64,\n\tspx5_stats_tx_size128to255_cnt = 65,\n\tspx5_stats_pmac_tx_size128to255_cnt = 66,\n\tspx5_stats_tx_size256to511_cnt = 67,\n\tspx5_stats_pmac_tx_size256to511_cnt = 68,\n\tspx5_stats_tx_size512to1023_cnt = 69,\n\tspx5_stats_pmac_tx_size512to1023_cnt = 70,\n\tspx5_stats_tx_size1024to1518_cnt = 71,\n\tspx5_stats_pmac_tx_size1024to1518_cnt = 72,\n\tspx5_stats_tx_size1519tomax_cnt = 73,\n\tspx5_stats_pmac_tx_size1519tomax_cnt = 74,\n\tspx5_stats_mm_rx_assembly_err_cnt = 75,\n\tspx5_stats_mm_rx_assembly_ok_cnt = 76,\n\tspx5_stats_mm_rx_merge_frag_cnt = 77,\n\tspx5_stats_mm_rx_smd_err_cnt = 78,\n\tspx5_stats_mm_tx_pfragment_cnt = 79,\n\tspx5_stats_rx_bad_bytes_cnt = 80,\n\tspx5_stats_pmac_rx_bad_bytes_cnt = 81,\n\tspx5_stats_rx_in_bytes_cnt = 82,\n\tspx5_stats_rx_ipg_shrink_cnt = 83,\n\tspx5_stats_rx_sync_lost_err_cnt = 84,\n\tspx5_stats_rx_tagged_frms_cnt = 85,\n\tspx5_stats_rx_untagged_frms_cnt = 86,\n\tspx5_stats_tx_out_bytes_cnt = 87,\n\tspx5_stats_tx_tagged_frms_cnt = 88,\n\tspx5_stats_tx_untagged_frms_cnt = 89,\n\tspx5_stats_rx_hih_cksm_err_cnt = 90,\n\tspx5_stats_pmac_rx_hih_cksm_err_cnt = 91,\n\tspx5_stats_rx_xgmii_prot_err_cnt = 92,\n\tspx5_stats_pmac_rx_xgmii_prot_err_cnt = 93,\n\tspx5_stats_ana_ac_port_stat_lsb_cnt = 94,\n\tspx5_stats_green_p0_rx_fwd = 95,\n\tspx5_stats_green_p0_rx_port_drop = 111,\n\tspx5_stats_green_p0_tx_port = 127,\n\tspx5_stats_rx_local_drop = 143,\n\tspx5_stats_tx_local_drop = 144,\n\tspx5_stats_count = 145,\n};\n\nstatic const char *const sparx5_stats_layout[] = {\n\t\"mm_rx_assembly_err_cnt\",\n\t\"mm_rx_assembly_ok_cnt\",\n\t\"mm_rx_merge_frag_cnt\",\n\t\"mm_rx_smd_err_cnt\",\n\t\"mm_tx_pfragment_cnt\",\n\t\"rx_bad_bytes_cnt\",\n\t\"pmac_rx_bad_bytes_cnt\",\n\t\"rx_in_bytes_cnt\",\n\t\"rx_ipg_shrink_cnt\",\n\t\"rx_sync_lost_err_cnt\",\n\t\"rx_tagged_frms_cnt\",\n\t\"rx_untagged_frms_cnt\",\n\t\"tx_out_bytes_cnt\",\n\t\"tx_tagged_frms_cnt\",\n\t\"tx_untagged_frms_cnt\",\n\t\"rx_hih_cksm_err_cnt\",\n\t\"pmac_rx_hih_cksm_err_cnt\",\n\t\"rx_xgmii_prot_err_cnt\",\n\t\"pmac_rx_xgmii_prot_err_cnt\",\n\t\"rx_port_policer_drop\",\n\t\"rx_fwd_green_p0\",\n\t\"rx_fwd_green_p1\",\n\t\"rx_fwd_green_p2\",\n\t\"rx_fwd_green_p3\",\n\t\"rx_fwd_green_p4\",\n\t\"rx_fwd_green_p5\",\n\t\"rx_fwd_green_p6\",\n\t\"rx_fwd_green_p7\",\n\t\"rx_fwd_yellow_p0\",\n\t\"rx_fwd_yellow_p1\",\n\t\"rx_fwd_yellow_p2\",\n\t\"rx_fwd_yellow_p3\",\n\t\"rx_fwd_yellow_p4\",\n\t\"rx_fwd_yellow_p5\",\n\t\"rx_fwd_yellow_p6\",\n\t\"rx_fwd_yellow_p7\",\n\t\"rx_port_drop_green_p0\",\n\t\"rx_port_drop_green_p1\",\n\t\"rx_port_drop_green_p2\",\n\t\"rx_port_drop_green_p3\",\n\t\"rx_port_drop_green_p4\",\n\t\"rx_port_drop_green_p5\",\n\t\"rx_port_drop_green_p6\",\n\t\"rx_port_drop_green_p7\",\n\t\"rx_port_drop_yellow_p0\",\n\t\"rx_port_drop_yellow_p1\",\n\t\"rx_port_drop_yellow_p2\",\n\t\"rx_port_drop_yellow_p3\",\n\t\"rx_port_drop_yellow_p4\",\n\t\"rx_port_drop_yellow_p5\",\n\t\"rx_port_drop_yellow_p6\",\n\t\"rx_port_drop_yellow_p7\",\n\t\"tx_port_green_p0\",\n\t\"tx_port_green_p1\",\n\t\"tx_port_green_p2\",\n\t\"tx_port_green_p3\",\n\t\"tx_port_green_p4\",\n\t\"tx_port_green_p5\",\n\t\"tx_port_green_p6\",\n\t\"tx_port_green_p7\",\n\t\"tx_port_yellow_p0\",\n\t\"tx_port_yellow_p1\",\n\t\"tx_port_yellow_p2\",\n\t\"tx_port_yellow_p3\",\n\t\"tx_port_yellow_p4\",\n\t\"tx_port_yellow_p5\",\n\t\"tx_port_yellow_p6\",\n\t\"tx_port_yellow_p7\",\n\t\"rx_local_drop\",\n\t\"tx_local_drop\",\n};\n\nstatic void sparx5_get_queue_sys_stats(struct sparx5 *sparx5, int portno)\n{\n\tu64 *portstats;\n\tu64 *stats;\n\tu32 addr;\n\tint idx;\n\n\tportstats = &sparx5->stats[portno * sparx5->num_stats];\n\tmutex_lock(&sparx5->queue_stats_lock);\n\tspx5_wr(XQS_STAT_CFG_STAT_VIEW_SET(portno), sparx5, XQS_STAT_CFG);\n\taddr = 0;\n\tstats = &portstats[spx5_stats_green_p0_rx_fwd];\n\tfor (idx = 0; idx < 2 * SPX5_PRIOS; ++idx, ++addr, ++stats)\n\t\tsparx5_update_counter(stats, spx5_rd(sparx5, XQS_CNT(addr)));\n\taddr = 16;\n\tstats = &portstats[spx5_stats_green_p0_rx_port_drop];\n\tfor (idx = 0; idx < 2 * SPX5_PRIOS; ++idx, ++addr, ++stats)\n\t\tsparx5_update_counter(stats, spx5_rd(sparx5, XQS_CNT(addr)));\n\taddr = 256;\n\tstats = &portstats[spx5_stats_green_p0_tx_port];\n\tfor (idx = 0; idx < 2 * SPX5_PRIOS; ++idx, ++addr, ++stats)\n\t\tsparx5_update_counter(stats, spx5_rd(sparx5, XQS_CNT(addr)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_local_drop],\n\t\t\t      spx5_rd(sparx5, XQS_CNT(32)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_local_drop],\n\t\t\t      spx5_rd(sparx5, XQS_CNT(272)));\n\tmutex_unlock(&sparx5->queue_stats_lock);\n}\n\nstatic void sparx5_get_ana_ac_stats_stats(struct sparx5 *sparx5, int portno)\n{\n\tu64 *portstats = &sparx5->stats[portno * sparx5->num_stats];\n\n\tsparx5_update_counter(&portstats[spx5_stats_ana_ac_port_stat_lsb_cnt],\n\t\t\t      spx5_rd(sparx5, ANA_AC_PORT_STAT_LSB_CNT(portno,\n\t\t\t\t\t\t\t\t       SPX5_PORT_POLICER_DROPS)));\n}\n\nstatic void sparx5_get_dev_phy_stats(u64 *portstats, void __iomem *inst, u32\n\t\t\t\t     tinst)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_rx_symbol_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_SYMBOL_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_symbol_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SYMBOL_ERR_CNT(tinst)));\n}\n\nstatic void sparx5_get_dev_mac_stats(u64 *portstats, void __iomem *inst, u32\n\t\t\t\t     tinst)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_tx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_TX_UC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_PMAC_TX_UC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_TX_MC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_TX_BC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_UC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_PMAC_RX_UC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_MC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_BC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_crc_err_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_CRC_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_crc_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_CRC_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_alignment_lost_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_ALIGNMENT_LOST_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_alignment_lost_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_ALIGNMENT_LOST_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_TX_OK_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_OK_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_OK_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_OK_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_PMAC_TX_MC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_PMAC_TX_BC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_PMAC_RX_MC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_PMAC_RX_BC_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_in_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_IN_RANGE_LEN_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_in_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_IN_RANGE_LEN_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_out_of_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_OUT_OF_RANGE_LEN_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_out_of_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_OUT_OF_RANGE_LEN_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_OVERSIZE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_OVERSIZE_CNT(tinst)));\n}\n\nstatic void sparx5_get_dev_mac_ctrl_stats(u64 *portstats, void __iomem *inst,\n\t\t\t\t\t  u32 tinst)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_tx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_TX_PAUSE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_PAUSE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_PAUSE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_PAUSE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_unsup_opcode_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_UNSUP_OPCODE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_unsup_opcode_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_UNSUP_OPCODE_CNT(tinst)));\n}\n\nstatic void sparx5_get_dev_rmon_stats(u64 *portstats, void __iomem *inst, u32\n\t\t\t\t      tinst)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_rx_undersize_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_UNDERSIZE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_undersize_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_UNDERSIZE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_OVERSIZE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_OVERSIZE_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_fragments_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_FRAGMENTS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_fragments_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_FRAGMENTS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_jabbers_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_JABBERS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_jabbers_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_JABBERS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_SIZE64_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SIZE64_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_SIZE65TO127_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SIZE65TO127_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_SIZE128TO255_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SIZE128TO255_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_SIZE256TO511_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SIZE256TO511_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_SIZE512TO1023_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SIZE512TO1023_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_SIZE1024TO1518_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SIZE1024TO1518_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_SIZE1519TOMAX_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_SIZE1519TOMAX_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_TX_SIZE64_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_SIZE64_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_SIZE65TO127_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_SIZE65TO127_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_SIZE128TO255_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_SIZE128TO255_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_SIZE256TO511_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_SIZE256TO511_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_SIZE512TO1023_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_SIZE512TO1023_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_SIZE1024TO1518_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_SIZE1024TO1518_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_SIZE1519TOMAX_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_TX_SIZE1519TOMAX_CNT(tinst)));\n}\n\nstatic void sparx5_get_dev_misc_stats(u64 *portstats, void __iomem *inst, u32\n\t\t\t\t      tinst)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_assembly_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_MM_RX_ASSEMBLY_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_assembly_ok_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_MM_RX_ASSEMBLY_OK_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_merge_frag_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_MM_RX_MERGE_FRAG_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_smd_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_MM_RX_SMD_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_tx_pfragment_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_MM_TX_PFRAGMENT_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_bad_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_BAD_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_bad_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_BAD_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_in_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, DEV5G_RX_IN_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_ipg_shrink_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_IPG_SHRINK_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_tagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_TAGGED_FRMS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_untagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_UNTAGGED_FRMS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_out_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_OUT_BYTES_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_tagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_TAGGED_FRMS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_untagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_TX_UNTAGGED_FRMS_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_hih_cksm_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_HIH_CKSM_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_hih_cksm_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_HIH_CKSM_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_xgmii_prot_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_RX_XGMII_PROT_ERR_CNT(tinst)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_xgmii_prot_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   DEV5G_PMAC_RX_XGMII_PROT_ERR_CNT(tinst)));\n}\n\nstatic void sparx5_get_device_stats(struct sparx5 *sparx5, int portno)\n{\n\tu64 *portstats = &sparx5->stats[portno * sparx5->num_stats];\n\tu32 tinst = sparx5_port_dev_index(portno);\n\tu32 dev = sparx5_to_high_dev(portno);\n\tvoid __iomem *inst;\n\n\tinst = spx5_inst_get(sparx5, dev, tinst);\n\tsparx5_get_dev_phy_stats(portstats, inst, tinst);\n\tsparx5_get_dev_mac_stats(portstats, inst, tinst);\n\tsparx5_get_dev_mac_ctrl_stats(portstats, inst, tinst);\n\tsparx5_get_dev_rmon_stats(portstats, inst, tinst);\n\tsparx5_get_dev_misc_stats(portstats, inst, tinst);\n}\n\nstatic void sparx5_get_asm_phy_stats(u64 *portstats, void __iomem *inst, int\n\t\t\t\t     portno)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_rx_symbol_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SYMBOL_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_symbol_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SYMBOL_ERR_CNT(portno)));\n}\n\nstatic void sparx5_get_asm_mac_stats(u64 *portstats, void __iomem *inst, int\n\t\t\t\t     portno)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_tx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_UC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_PMAC_TX_UC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_MC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_BC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_backoff1_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_BACKOFF1_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_multi_coll_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_MULTI_COLL_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_UC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_uc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_PMAC_RX_UC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_MC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_BC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_crc_err_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_CRC_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_crc_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_CRC_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_alignment_lost_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_ALIGNMENT_LOST_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_alignment_lost_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_ALIGNMENT_LOST_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_OK_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_OK_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_defer_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_DEFER_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_late_coll_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_LATE_COLL_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_xcoll_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_XCOLL_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_csense_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_CSENSE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_OK_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_ok_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_OK_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_PMAC_TX_MC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_PMAC_TX_BC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_xdefer_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_XDEFER_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_mc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_PMAC_RX_MC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_bc_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_PMAC_RX_BC_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_in_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_IN_RANGE_LEN_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_in_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_IN_RANGE_LEN_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_out_of_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_OUT_OF_RANGE_LEN_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_out_of_range_len_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_OUT_OF_RANGE_LEN_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_OVERSIZE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_OVERSIZE_CNT(portno)));\n}\n\nstatic void sparx5_get_asm_mac_ctrl_stats(u64 *portstats, void __iomem *inst,\n\t\t\t\t\t  int portno)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_tx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_PAUSE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_PAUSE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_PAUSE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_pause_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_PAUSE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_unsup_opcode_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_UNSUP_OPCODE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_unsup_opcode_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_UNSUP_OPCODE_CNT(portno)));\n}\n\nstatic void sparx5_get_asm_rmon_stats(u64 *portstats, void __iomem *inst, int\n\t\t\t\t      portno)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_rx_undersize_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_UNDERSIZE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_undersize_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_UNDERSIZE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_OVERSIZE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_oversize_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_OVERSIZE_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_fragments_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_FRAGMENTS_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_fragments_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_FRAGMENTS_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_jabbers_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_JABBERS_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_jabbers_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_JABBERS_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_SIZE64_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SIZE64_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SIZE65TO127_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SIZE65TO127_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SIZE128TO255_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SIZE128TO255_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SIZE256TO511_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SIZE256TO511_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SIZE512TO1023_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SIZE512TO1023_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SIZE1024TO1518_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SIZE1024TO1518_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SIZE1519TOMAX_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_SIZE1519TOMAX_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_SIZE64_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size64_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_SIZE64_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_SIZE65TO127_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size65to127_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_SIZE65TO127_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_SIZE128TO255_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size128to255_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_SIZE128TO255_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_SIZE256TO511_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size256to511_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_SIZE256TO511_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_SIZE512TO1023_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size512to1023_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_SIZE512TO1023_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_SIZE1024TO1518_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size1024to1518_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_SIZE1024TO1518_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_SIZE1519TOMAX_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_tx_size1519tomax_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_TX_SIZE1519TOMAX_CNT(portno)));\n}\n\nstatic void sparx5_get_asm_misc_stats(u64 *portstats, void __iomem *inst, int\n\t\t\t\t      portno)\n{\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_assembly_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_MM_RX_ASSEMBLY_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_assembly_ok_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_MM_RX_ASSEMBLY_OK_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_merge_frag_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_MM_RX_MERGE_FRAG_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_rx_smd_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_MM_RX_SMD_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_mm_tx_pfragment_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_MM_TX_PFRAGMENT_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_bad_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_BAD_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_pmac_rx_bad_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_PMAC_RX_BAD_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_in_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_RX_IN_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_ipg_shrink_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_IPG_SHRINK_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_sync_lost_err_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_SYNC_LOST_ERR_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_tagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_TAGGED_FRMS_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_rx_untagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_RX_UNTAGGED_FRMS_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_out_bytes_cnt],\n\t\t\t      spx5_inst_rd(inst, ASM_TX_OUT_BYTES_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_tagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_TAGGED_FRMS_CNT(portno)));\n\tsparx5_update_counter(&portstats[spx5_stats_tx_untagged_frms_cnt],\n\t\t\t      spx5_inst_rd(inst,\n\t\t\t\t\t   ASM_TX_UNTAGGED_FRMS_CNT(portno)));\n}\n\nstatic void sparx5_get_asm_stats(struct sparx5 *sparx5, int portno)\n{\n\tu64 *portstats = &sparx5->stats[portno * sparx5->num_stats];\n\tvoid __iomem *inst = spx5_inst_get(sparx5, TARGET_ASM, 0);\n\n\tsparx5_get_asm_phy_stats(portstats, inst, portno);\n\tsparx5_get_asm_mac_stats(portstats, inst, portno);\n\tsparx5_get_asm_mac_ctrl_stats(portstats, inst, portno);\n\tsparx5_get_asm_rmon_stats(portstats, inst, portno);\n\tsparx5_get_asm_misc_stats(portstats, inst, portno);\n}\n\nstatic const struct ethtool_rmon_hist_range sparx5_rmon_ranges[] = {\n\t{    0,    64 },\n\t{   65,   127 },\n\t{  128,   255 },\n\t{  256,   511 },\n\t{  512,  1023 },\n\t{ 1024,  1518 },\n\t{ 1519, 10239 },\n\t{}\n};\n\nstatic void sparx5_get_eth_phy_stats(struct net_device *ndev,\n\t\t\t\t     struct ethtool_eth_phy_stats *phy_stats)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5 *sparx5 = port->sparx5;\n\tint portno = port->portno;\n\tvoid __iomem *inst;\n\tu64 *portstats;\n\n\tportstats = &sparx5->stats[portno * sparx5->num_stats];\n\tif (sparx5_is_baser(port->conf.portmode)) {\n\t\tu32 tinst = sparx5_port_dev_index(portno);\n\t\tu32 dev = sparx5_to_high_dev(portno);\n\n\t\tinst = spx5_inst_get(sparx5, dev, tinst);\n\t\tsparx5_get_dev_phy_stats(portstats, inst, tinst);\n\t} else {\n\t\tinst = spx5_inst_get(sparx5, TARGET_ASM, 0);\n\t\tsparx5_get_asm_phy_stats(portstats, inst, portno);\n\t}\n\tphy_stats->SymbolErrorDuringCarrier =\n\t\tportstats[spx5_stats_rx_symbol_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_symbol_err_cnt];\n}\n\nstatic void sparx5_get_eth_mac_stats(struct net_device *ndev,\n\t\t\t\t     struct ethtool_eth_mac_stats *mac_stats)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5 *sparx5 = port->sparx5;\n\tint portno = port->portno;\n\tvoid __iomem *inst;\n\tu64 *portstats;\n\n\tportstats = &sparx5->stats[portno * sparx5->num_stats];\n\tif (sparx5_is_baser(port->conf.portmode)) {\n\t\tu32 tinst = sparx5_port_dev_index(portno);\n\t\tu32 dev = sparx5_to_high_dev(portno);\n\n\t\tinst = spx5_inst_get(sparx5, dev, tinst);\n\t\tsparx5_get_dev_mac_stats(portstats, inst, tinst);\n\t} else {\n\t\tinst = spx5_inst_get(sparx5, TARGET_ASM, 0);\n\t\tsparx5_get_asm_mac_stats(portstats, inst, portno);\n\t}\n\tmac_stats->FramesTransmittedOK = portstats[spx5_stats_tx_uc_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_uc_cnt] +\n\t\tportstats[spx5_stats_tx_mc_cnt] +\n\t\tportstats[spx5_stats_tx_bc_cnt];\n\tmac_stats->SingleCollisionFrames =\n\t\tportstats[spx5_stats_tx_backoff1_cnt];\n\tmac_stats->MultipleCollisionFrames =\n\t\tportstats[spx5_stats_tx_multi_coll_cnt];\n\tmac_stats->FramesReceivedOK = portstats[spx5_stats_rx_uc_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_uc_cnt] +\n\t\tportstats[spx5_stats_rx_mc_cnt] +\n\t\tportstats[spx5_stats_rx_bc_cnt];\n\tmac_stats->FrameCheckSequenceErrors =\n\t\tportstats[spx5_stats_rx_crc_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_crc_err_cnt];\n\tmac_stats->AlignmentErrors = portstats[spx5_stats_rx_alignment_lost_cnt]\n\t\t+ portstats[spx5_stats_pmac_rx_alignment_lost_cnt];\n\tmac_stats->OctetsTransmittedOK = portstats[spx5_stats_tx_ok_bytes_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_ok_bytes_cnt];\n\tmac_stats->FramesWithDeferredXmissions =\n\t\tportstats[spx5_stats_tx_defer_cnt];\n\tmac_stats->LateCollisions =\n\t\tportstats[spx5_stats_tx_late_coll_cnt];\n\tmac_stats->FramesAbortedDueToXSColls =\n\t\tportstats[spx5_stats_tx_xcoll_cnt];\n\tmac_stats->CarrierSenseErrors = portstats[spx5_stats_tx_csense_cnt];\n\tmac_stats->OctetsReceivedOK = portstats[spx5_stats_rx_ok_bytes_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_ok_bytes_cnt];\n\tmac_stats->MulticastFramesXmittedOK = portstats[spx5_stats_tx_mc_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_mc_cnt];\n\tmac_stats->BroadcastFramesXmittedOK = portstats[spx5_stats_tx_bc_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_bc_cnt];\n\tmac_stats->FramesWithExcessiveDeferral =\n\t\tportstats[spx5_stats_tx_xdefer_cnt];\n\tmac_stats->MulticastFramesReceivedOK = portstats[spx5_stats_rx_mc_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_mc_cnt];\n\tmac_stats->BroadcastFramesReceivedOK = portstats[spx5_stats_rx_bc_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_bc_cnt];\n\tmac_stats->InRangeLengthErrors =\n\t\tportstats[spx5_stats_rx_in_range_len_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_in_range_len_err_cnt];\n\tmac_stats->OutOfRangeLengthField =\n\t\tportstats[spx5_stats_rx_out_of_range_len_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_out_of_range_len_err_cnt];\n\tmac_stats->FrameTooLongErrors = portstats[spx5_stats_rx_oversize_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_oversize_cnt];\n}\n\nstatic void sparx5_get_eth_mac_ctrl_stats(struct net_device *ndev,\n\t\t\t\t\t  struct ethtool_eth_ctrl_stats *mac_ctrl_stats)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5 *sparx5 = port->sparx5;\n\tint portno = port->portno;\n\tvoid __iomem *inst;\n\tu64 *portstats;\n\n\tportstats = &sparx5->stats[portno * sparx5->num_stats];\n\tif (sparx5_is_baser(port->conf.portmode)) {\n\t\tu32 tinst = sparx5_port_dev_index(portno);\n\t\tu32 dev = sparx5_to_high_dev(portno);\n\n\t\tinst = spx5_inst_get(sparx5, dev, tinst);\n\t\tsparx5_get_dev_mac_ctrl_stats(portstats, inst, tinst);\n\t} else {\n\t\tinst = spx5_inst_get(sparx5, TARGET_ASM, 0);\n\t\tsparx5_get_asm_mac_ctrl_stats(portstats, inst, portno);\n\t}\n\tmac_ctrl_stats->MACControlFramesTransmitted =\n\t\tportstats[spx5_stats_tx_pause_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_pause_cnt];\n\tmac_ctrl_stats->MACControlFramesReceived =\n\t\tportstats[spx5_stats_rx_pause_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_pause_cnt];\n\tmac_ctrl_stats->UnsupportedOpcodesReceived =\n\t\tportstats[spx5_stats_rx_unsup_opcode_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_unsup_opcode_cnt];\n}\n\nstatic void sparx5_get_eth_rmon_stats(struct net_device *ndev,\n\t\t\t\t      struct ethtool_rmon_stats *rmon_stats,\n\t\t\t\t      const struct ethtool_rmon_hist_range **ranges)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5 *sparx5 = port->sparx5;\n\tint portno = port->portno;\n\tvoid __iomem *inst;\n\tu64 *portstats;\n\n\tportstats = &sparx5->stats[portno * sparx5->num_stats];\n\tif (sparx5_is_baser(port->conf.portmode)) {\n\t\tu32 tinst = sparx5_port_dev_index(portno);\n\t\tu32 dev = sparx5_to_high_dev(portno);\n\n\t\tinst = spx5_inst_get(sparx5, dev, tinst);\n\t\tsparx5_get_dev_rmon_stats(portstats, inst, tinst);\n\t} else {\n\t\tinst = spx5_inst_get(sparx5, TARGET_ASM, 0);\n\t\tsparx5_get_asm_rmon_stats(portstats, inst, portno);\n\t}\n\trmon_stats->undersize_pkts = portstats[spx5_stats_rx_undersize_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_undersize_cnt];\n\trmon_stats->oversize_pkts = portstats[spx5_stats_rx_oversize_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_oversize_cnt];\n\trmon_stats->fragments = portstats[spx5_stats_rx_fragments_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_fragments_cnt];\n\trmon_stats->jabbers = portstats[spx5_stats_rx_jabbers_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_jabbers_cnt];\n\trmon_stats->hist[0] = portstats[spx5_stats_rx_size64_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_size64_cnt];\n\trmon_stats->hist[1] = portstats[spx5_stats_rx_size65to127_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_size65to127_cnt];\n\trmon_stats->hist[2] = portstats[spx5_stats_rx_size128to255_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_size128to255_cnt];\n\trmon_stats->hist[3] = portstats[spx5_stats_rx_size256to511_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_size256to511_cnt];\n\trmon_stats->hist[4] = portstats[spx5_stats_rx_size512to1023_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_size512to1023_cnt];\n\trmon_stats->hist[5] = portstats[spx5_stats_rx_size1024to1518_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_size1024to1518_cnt];\n\trmon_stats->hist[6] = portstats[spx5_stats_rx_size1519tomax_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_size1519tomax_cnt];\n\trmon_stats->hist_tx[0] = portstats[spx5_stats_tx_size64_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_size64_cnt];\n\trmon_stats->hist_tx[1] = portstats[spx5_stats_tx_size65to127_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_size65to127_cnt];\n\trmon_stats->hist_tx[2] = portstats[spx5_stats_tx_size128to255_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_size128to255_cnt];\n\trmon_stats->hist_tx[3] = portstats[spx5_stats_tx_size256to511_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_size256to511_cnt];\n\trmon_stats->hist_tx[4] = portstats[spx5_stats_tx_size512to1023_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_size512to1023_cnt];\n\trmon_stats->hist_tx[5] = portstats[spx5_stats_tx_size1024to1518_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_size1024to1518_cnt];\n\trmon_stats->hist_tx[6] = portstats[spx5_stats_tx_size1519tomax_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_size1519tomax_cnt];\n\t*ranges = sparx5_rmon_ranges;\n}\n\nstatic int sparx5_get_sset_count(struct net_device *ndev, int sset)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5  *sparx5 = port->sparx5;\n\n\tif (sset != ETH_SS_STATS)\n\t\treturn -EOPNOTSUPP;\n\treturn sparx5->num_ethtool_stats;\n}\n\nstatic void sparx5_get_sset_strings(struct net_device *ndev, u32 sset, u8 *data)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5  *sparx5 = port->sparx5;\n\tint idx;\n\n\tif (sset != ETH_SS_STATS)\n\t\treturn;\n\n\tfor (idx = 0; idx < sparx5->num_ethtool_stats; idx++)\n\t\tstrncpy(data + idx * ETH_GSTRING_LEN,\n\t\t\tsparx5->stats_layout[idx], ETH_GSTRING_LEN);\n}\n\nstatic void sparx5_get_sset_data(struct net_device *ndev,\n\t\t\t\t struct ethtool_stats *stats, u64 *data)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5 *sparx5 = port->sparx5;\n\tint portno = port->portno;\n\tvoid __iomem *inst;\n\tu64 *portstats;\n\tint idx;\n\n\tportstats = &sparx5->stats[portno * sparx5->num_stats];\n\tif (sparx5_is_baser(port->conf.portmode)) {\n\t\tu32 tinst = sparx5_port_dev_index(portno);\n\t\tu32 dev = sparx5_to_high_dev(portno);\n\n\t\tinst = spx5_inst_get(sparx5, dev, tinst);\n\t\tsparx5_get_dev_misc_stats(portstats, inst, tinst);\n\t} else {\n\t\tinst = spx5_inst_get(sparx5, TARGET_ASM, 0);\n\t\tsparx5_get_asm_misc_stats(portstats, inst, portno);\n\t}\n\tsparx5_get_ana_ac_stats_stats(sparx5, portno);\n\tsparx5_get_queue_sys_stats(sparx5, portno);\n\t \n\tfor (idx = spx5_stats_mm_rx_assembly_err_cnt;\n\t     idx < spx5_stats_mm_rx_assembly_err_cnt +\n\t     sparx5->num_ethtool_stats; idx++)\n\t\t*data++ = portstats[idx];\n}\n\nvoid sparx5_get_stats64(struct net_device *ndev,\n\t\t\tstruct rtnl_link_stats64 *stats)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\tstruct sparx5 *sparx5 = port->sparx5;\n\tu64 *portstats;\n\tint idx;\n\n\tif (!sparx5->stats)\n\t\treturn;  \n\n\tportstats = &sparx5->stats[port->portno * sparx5->num_stats];\n\n\tstats->rx_packets = portstats[spx5_stats_rx_uc_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_uc_cnt] +\n\t\tportstats[spx5_stats_rx_mc_cnt] +\n\t\tportstats[spx5_stats_rx_bc_cnt];\n\tstats->tx_packets = portstats[spx5_stats_tx_uc_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_uc_cnt] +\n\t\tportstats[spx5_stats_tx_mc_cnt] +\n\t\tportstats[spx5_stats_tx_bc_cnt];\n\tstats->rx_bytes = portstats[spx5_stats_rx_ok_bytes_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_ok_bytes_cnt];\n\tstats->tx_bytes = portstats[spx5_stats_tx_ok_bytes_cnt] +\n\t\tportstats[spx5_stats_pmac_tx_ok_bytes_cnt];\n\tstats->rx_errors = portstats[spx5_stats_rx_in_range_len_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_in_range_len_err_cnt] +\n\t\tportstats[spx5_stats_rx_out_of_range_len_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_out_of_range_len_err_cnt] +\n\t\tportstats[spx5_stats_rx_oversize_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_oversize_cnt] +\n\t\tportstats[spx5_stats_rx_crc_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_crc_err_cnt] +\n\t\tportstats[spx5_stats_rx_alignment_lost_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_alignment_lost_cnt];\n\tstats->tx_errors = portstats[spx5_stats_tx_xcoll_cnt] +\n\t\tportstats[spx5_stats_tx_csense_cnt] +\n\t\tportstats[spx5_stats_tx_late_coll_cnt];\n\tstats->multicast = portstats[spx5_stats_rx_mc_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_mc_cnt];\n\tstats->collisions = portstats[spx5_stats_tx_late_coll_cnt] +\n\t\tportstats[spx5_stats_tx_xcoll_cnt] +\n\t\tportstats[spx5_stats_tx_backoff1_cnt];\n\tstats->rx_length_errors = portstats[spx5_stats_rx_in_range_len_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_in_range_len_err_cnt] +\n\t\tportstats[spx5_stats_rx_out_of_range_len_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_out_of_range_len_err_cnt] +\n\t\tportstats[spx5_stats_rx_oversize_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_oversize_cnt];\n\tstats->rx_crc_errors = portstats[spx5_stats_rx_crc_err_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_crc_err_cnt];\n\tstats->rx_frame_errors = portstats[spx5_stats_rx_alignment_lost_cnt] +\n\t\tportstats[spx5_stats_pmac_rx_alignment_lost_cnt];\n\tstats->tx_aborted_errors = portstats[spx5_stats_tx_xcoll_cnt];\n\tstats->tx_carrier_errors = portstats[spx5_stats_tx_csense_cnt];\n\tstats->tx_window_errors = portstats[spx5_stats_tx_late_coll_cnt];\n\tstats->rx_dropped = portstats[spx5_stats_ana_ac_port_stat_lsb_cnt];\n\tfor (idx = 0; idx < 2 * SPX5_PRIOS; ++idx)\n\t\tstats->rx_dropped += portstats[spx5_stats_green_p0_rx_port_drop\n\t\t\t\t\t       + idx];\n\tstats->tx_dropped = portstats[spx5_stats_tx_local_drop];\n}\n\nstatic void sparx5_update_port_stats(struct sparx5 *sparx5, int portno)\n{\n\tif (sparx5_is_baser(sparx5->ports[portno]->conf.portmode))\n\t\tsparx5_get_device_stats(sparx5, portno);\n\telse\n\t\tsparx5_get_asm_stats(sparx5, portno);\n\tsparx5_get_ana_ac_stats_stats(sparx5, portno);\n\tsparx5_get_queue_sys_stats(sparx5, portno);\n}\n\nstatic void sparx5_update_stats(struct sparx5 *sparx5)\n{\n\tint idx;\n\n\tfor (idx = 0; idx < SPX5_PORTS; idx++)\n\t\tif (sparx5->ports[idx])\n\t\t\tsparx5_update_port_stats(sparx5, idx);\n}\n\nstatic void sparx5_check_stats_work(struct work_struct *work)\n{\n\tstruct delayed_work *dwork = to_delayed_work(work);\n\tstruct sparx5 *sparx5 = container_of(dwork,\n\t\t\t\t\t     struct sparx5,\n\t\t\t\t\t     stats_work);\n\n\tsparx5_update_stats(sparx5);\n\n\tqueue_delayed_work(sparx5->stats_queue, &sparx5->stats_work,\n\t\t\t   SPX5_STATS_CHECK_DELAY);\n}\n\nstatic int sparx5_get_link_settings(struct net_device *ndev,\n\t\t\t\t    struct ethtool_link_ksettings *cmd)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\n\treturn phylink_ethtool_ksettings_get(port->phylink, cmd);\n}\n\nstatic int sparx5_set_link_settings(struct net_device *ndev,\n\t\t\t\t    const struct ethtool_link_ksettings *cmd)\n{\n\tstruct sparx5_port *port = netdev_priv(ndev);\n\n\treturn phylink_ethtool_ksettings_set(port->phylink, cmd);\n}\n\nstatic void sparx5_config_stats(struct sparx5 *sparx5)\n{\n\t \n\tspx5_rmw(ANA_AC_PORT_SGE_CFG_MASK_SET(0xf0f0),\n\t\t ANA_AC_PORT_SGE_CFG_MASK,\n\t\t sparx5,\n\t\t ANA_AC_PORT_SGE_CFG(SPX5_PORT_POLICER_DROPS));\n}\n\nstatic void sparx5_config_port_stats(struct sparx5 *sparx5, int portno)\n{\n\t \n\tspx5_wr(XQS_STAT_CFG_STAT_VIEW_SET(portno) |\n\t\tXQS_STAT_CFG_STAT_CLEAR_SHOT_SET(3), sparx5,\n\t\tXQS_STAT_CFG);\n\n\t \n\tspx5_rmw(ANA_AC_PORT_STAT_CFG_CFG_CNT_FRM_TYPE_SET(1) |\n\t\t ANA_AC_PORT_STAT_CFG_CFG_CNT_BYTE_SET(0) |\n\t\t ANA_AC_PORT_STAT_CFG_CFG_PRIO_MASK_SET(0xff),\n\t\t ANA_AC_PORT_STAT_CFG_CFG_CNT_FRM_TYPE |\n\t\t ANA_AC_PORT_STAT_CFG_CFG_CNT_BYTE |\n\t\t ANA_AC_PORT_STAT_CFG_CFG_PRIO_MASK,\n\t\t sparx5, ANA_AC_PORT_STAT_CFG(portno, SPX5_PORT_POLICER_DROPS));\n}\n\nstatic int sparx5_get_ts_info(struct net_device *dev,\n\t\t\t      struct ethtool_ts_info *info)\n{\n\tstruct sparx5_port *port = netdev_priv(dev);\n\tstruct sparx5 *sparx5 = port->sparx5;\n\tstruct sparx5_phc *phc;\n\n\tif (!sparx5->ptp)\n\t\treturn ethtool_op_get_ts_info(dev, info);\n\n\tphc = &sparx5->phc[SPARX5_PHC_PORT];\n\n\tinfo->phc_index = phc->clock ? ptp_clock_index(phc->clock) : -1;\n\tif (info->phc_index == -1) {\n\t\tinfo->so_timestamping |= SOF_TIMESTAMPING_TX_SOFTWARE |\n\t\t\t\t\t SOF_TIMESTAMPING_RX_SOFTWARE |\n\t\t\t\t\t SOF_TIMESTAMPING_SOFTWARE;\n\t\treturn 0;\n\t}\n\tinfo->so_timestamping |= SOF_TIMESTAMPING_TX_SOFTWARE |\n\t\t\t\t SOF_TIMESTAMPING_RX_SOFTWARE |\n\t\t\t\t SOF_TIMESTAMPING_SOFTWARE |\n\t\t\t\t SOF_TIMESTAMPING_TX_HARDWARE |\n\t\t\t\t SOF_TIMESTAMPING_RX_HARDWARE |\n\t\t\t\t SOF_TIMESTAMPING_RAW_HARDWARE;\n\tinfo->tx_types = BIT(HWTSTAMP_TX_OFF) | BIT(HWTSTAMP_TX_ON) |\n\t\t\t BIT(HWTSTAMP_TX_ONESTEP_SYNC);\n\tinfo->rx_filters = BIT(HWTSTAMP_FILTER_NONE) |\n\t\t\t   BIT(HWTSTAMP_FILTER_ALL);\n\n\treturn 0;\n}\n\nconst struct ethtool_ops sparx5_ethtool_ops = {\n\t.get_sset_count         = sparx5_get_sset_count,\n\t.get_strings            = sparx5_get_sset_strings,\n\t.get_ethtool_stats      = sparx5_get_sset_data,\n\t.get_link_ksettings\t= sparx5_get_link_settings,\n\t.set_link_ksettings\t= sparx5_set_link_settings,\n\t.get_link               = ethtool_op_get_link,\n\t.get_eth_phy_stats      = sparx5_get_eth_phy_stats,\n\t.get_eth_mac_stats      = sparx5_get_eth_mac_stats,\n\t.get_eth_ctrl_stats     = sparx5_get_eth_mac_ctrl_stats,\n\t.get_rmon_stats         = sparx5_get_eth_rmon_stats,\n\t.get_ts_info            = sparx5_get_ts_info,\n};\n\nint sparx_stats_init(struct sparx5 *sparx5)\n{\n\tchar queue_name[32];\n\tint portno;\n\n\tsparx5->stats_layout = sparx5_stats_layout;\n\tsparx5->num_stats = spx5_stats_count;\n\tsparx5->num_ethtool_stats = ARRAY_SIZE(sparx5_stats_layout);\n\tsparx5->stats = devm_kcalloc(sparx5->dev,\n\t\t\t\t     SPX5_PORTS_ALL * sparx5->num_stats,\n\t\t\t\t     sizeof(u64), GFP_KERNEL);\n\tif (!sparx5->stats)\n\t\treturn -ENOMEM;\n\n\tmutex_init(&sparx5->queue_stats_lock);\n\tsparx5_config_stats(sparx5);\n\tfor (portno = 0; portno < SPX5_PORTS; portno++)\n\t\tif (sparx5->ports[portno])\n\t\t\tsparx5_config_port_stats(sparx5, portno);\n\n\tsnprintf(queue_name, sizeof(queue_name), \"%s-stats\",\n\t\t dev_name(sparx5->dev));\n\tsparx5->stats_queue = create_singlethread_workqueue(queue_name);\n\tif (!sparx5->stats_queue)\n\t\treturn -ENOMEM;\n\n\tINIT_DELAYED_WORK(&sparx5->stats_work, sparx5_check_stats_work);\n\tqueue_delayed_work(sparx5->stats_queue, &sparx5->stats_work,\n\t\t\t   SPX5_STATS_CHECK_DELAY);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}