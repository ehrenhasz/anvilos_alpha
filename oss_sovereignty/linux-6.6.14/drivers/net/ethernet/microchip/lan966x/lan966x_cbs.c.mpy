{
  "module_name": "lan966x_cbs.c",
  "hash_id": "0190a0c86662c4648042ea1613d1a1cc35f6fbaeeace2719821b071df5ab6edb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/microchip/lan966x/lan966x_cbs.c",
  "human_readable_source": "\n\n#include \"lan966x_main.h\"\n\nint lan966x_cbs_add(struct lan966x_port *port,\n\t\t    struct tc_cbs_qopt_offload *qopt)\n{\n\tstruct lan966x *lan966x = port->lan966x;\n\tu32 cir, cbs;\n\tu8 se_idx;\n\n\t \n\tif (qopt->idleslope <= 0 ||\n\t    qopt->sendslope >= 0 ||\n\t    qopt->locredit >= qopt->hicredit)\n\t\treturn -EINVAL;\n\n\tse_idx = SE_IDX_QUEUE + port->chip_port * NUM_PRIO_QUEUES + qopt->queue;\n\tcir = qopt->idleslope;\n\tcbs = (qopt->idleslope - qopt->sendslope) *\n\t\t(qopt->hicredit - qopt->locredit) /\n\t\t-qopt->sendslope;\n\n\t \n\tcir = DIV_ROUND_UP(cir, 100);\n\t \n\tcir = cir ?: 1;\n\t \n\tcbs = DIV_ROUND_UP(cbs, 4096);\n\t \n\tcbs = cbs ?: 1;\n\n\t \n\tif (cir > GENMASK(15, 0) ||\n\t    cbs > GENMASK(6, 0))\n\t\treturn -EINVAL;\n\n\tlan_rmw(QSYS_SE_CFG_SE_AVB_ENA_SET(1) |\n\t\tQSYS_SE_CFG_SE_FRM_MODE_SET(1),\n\t\tQSYS_SE_CFG_SE_AVB_ENA |\n\t\tQSYS_SE_CFG_SE_FRM_MODE,\n\t\tlan966x, QSYS_SE_CFG(se_idx));\n\n\tlan_wr(QSYS_CIR_CFG_CIR_RATE_SET(cir) |\n\t       QSYS_CIR_CFG_CIR_BURST_SET(cbs),\n\t       lan966x, QSYS_CIR_CFG(se_idx));\n\n\treturn 0;\n}\n\nint lan966x_cbs_del(struct lan966x_port *port,\n\t\t    struct tc_cbs_qopt_offload *qopt)\n{\n\tstruct lan966x *lan966x = port->lan966x;\n\tu8 se_idx;\n\n\tse_idx = SE_IDX_QUEUE + port->chip_port * NUM_PRIO_QUEUES + qopt->queue;\n\n\tlan_rmw(QSYS_SE_CFG_SE_AVB_ENA_SET(1) |\n\t\tQSYS_SE_CFG_SE_FRM_MODE_SET(0),\n\t\tQSYS_SE_CFG_SE_AVB_ENA |\n\t\tQSYS_SE_CFG_SE_FRM_MODE,\n\t\tlan966x, QSYS_SE_CFG(se_idx));\n\n\tlan_wr(QSYS_CIR_CFG_CIR_RATE_SET(0) |\n\t       QSYS_CIR_CFG_CIR_BURST_SET(0),\n\t       lan966x, QSYS_CIR_CFG(se_idx));\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}