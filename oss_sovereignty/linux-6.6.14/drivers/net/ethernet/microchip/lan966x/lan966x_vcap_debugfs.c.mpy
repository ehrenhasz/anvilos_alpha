{
  "module_name": "lan966x_vcap_debugfs.c",
  "hash_id": "aa7c256fb185e893c61721a9a1cb2dde5ef42f09927c7f2136f776e1900e6694",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/microchip/lan966x/lan966x_vcap_debugfs.c",
  "human_readable_source": "\n\n#include \"lan966x_main.h\"\n#include \"lan966x_vcap_ag_api.h\"\n#include \"vcap_api.h\"\n#include \"vcap_api_client.h\"\n\nstatic void lan966x_vcap_is1_port_keys(struct lan966x_port *port,\n\t\t\t\t       struct vcap_admin *admin,\n\t\t\t\t       struct vcap_output_print *out)\n{\n\tstruct lan966x *lan966x = port->lan966x;\n\tu32 val;\n\n\tout->prf(out->dst, \"  port[%d] (%s): \", port->chip_port,\n\t\t netdev_name(port->dev));\n\n\tval = lan_rd(lan966x, ANA_VCAP_CFG(port->chip_port));\n\tout->prf(out->dst, \"\\n    state: \");\n\tif (ANA_VCAP_CFG_S1_ENA_GET(val))\n\t\tout->prf(out->dst, \"on\");\n\telse\n\t\tout->prf(out->dst, \"off\");\n\n\tfor (int l = 0; l < admin->lookups; ++l) {\n\t\tout->prf(out->dst, \"\\n    Lookup %d: \", l);\n\n\t\tout->prf(out->dst, \"\\n      other: \");\n\t\tswitch (ANA_VCAP_S1_CFG_KEY_OTHER_CFG_GET(val)) {\n\t\tcase VCAP_IS1_PS_OTHER_NORMAL:\n\t\t\tout->prf(out->dst, \"normal\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_OTHER_7TUPLE:\n\t\t\tout->prf(out->dst, \"7tuple\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_OTHER_DBL_VID:\n\t\t\tout->prf(out->dst, \"dbl_vid\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_OTHER_DMAC_VID:\n\t\t\tout->prf(out->dst, \"dmac_vid\");\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tout->prf(out->dst, \"-\");\n\t\t\tbreak;\n\t\t}\n\n\t\tout->prf(out->dst, \"\\n      ipv4: \");\n\t\tswitch (ANA_VCAP_S1_CFG_KEY_IP4_CFG_GET(val)) {\n\t\tcase VCAP_IS1_PS_IPV4_NORMAL:\n\t\t\tout->prf(out->dst, \"normal\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV4_7TUPLE:\n\t\t\tout->prf(out->dst, \"7tuple\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV4_5TUPLE_IP4:\n\t\t\tout->prf(out->dst, \"5tuple_ipv4\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV4_DBL_VID:\n\t\t\tout->prf(out->dst, \"dbl_vid\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV4_DMAC_VID:\n\t\t\tout->prf(out->dst, \"dmac_vid\");\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tout->prf(out->dst, \"-\");\n\t\t\tbreak;\n\t\t}\n\n\t\tout->prf(out->dst, \"\\n      ipv6: \");\n\t\tswitch (ANA_VCAP_S1_CFG_KEY_IP6_CFG_GET(val)) {\n\t\tcase VCAP_IS1_PS_IPV6_NORMAL:\n\t\t\tout->prf(out->dst, \"normal\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV6_7TUPLE:\n\t\t\tout->prf(out->dst, \"7tuple\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV6_5TUPLE_IP4:\n\t\t\tout->prf(out->dst, \"5tuple_ip4\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV6_NORMAL_IP6:\n\t\t\tout->prf(out->dst, \"normal_ip6\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV6_5TUPLE_IP6:\n\t\t\tout->prf(out->dst, \"5tuple_ip6\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV6_DBL_VID:\n\t\t\tout->prf(out->dst, \"dbl_vid\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_IPV6_DMAC_VID:\n\t\t\tout->prf(out->dst, \"dmac_vid\");\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tout->prf(out->dst, \"-\");\n\t\t\tbreak;\n\t\t}\n\n\t\tout->prf(out->dst, \"\\n      rt: \");\n\t\tswitch (ANA_VCAP_S1_CFG_KEY_RT_CFG_GET(val)) {\n\t\tcase VCAP_IS1_PS_RT_NORMAL:\n\t\t\tout->prf(out->dst, \"normal\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_RT_7TUPLE:\n\t\t\tout->prf(out->dst, \"7tuple\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_RT_DBL_VID:\n\t\t\tout->prf(out->dst, \"dbl_vid\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_RT_DMAC_VID:\n\t\t\tout->prf(out->dst, \"dmac_vid\");\n\t\t\tbreak;\n\t\tcase VCAP_IS1_PS_RT_FOLLOW_OTHER:\n\t\t\tout->prf(out->dst, \"follow_other\");\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tout->prf(out->dst, \"-\");\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tout->prf(out->dst, \"\\n\");\n}\n\nstatic void lan966x_vcap_is2_port_keys(struct lan966x_port *port,\n\t\t\t\t       struct vcap_admin *admin,\n\t\t\t\t       struct vcap_output_print *out)\n{\n\tstruct lan966x *lan966x = port->lan966x;\n\tu32 val;\n\n\tout->prf(out->dst, \"  port[%d] (%s): \", port->chip_port,\n\t\t netdev_name(port->dev));\n\n\tval = lan_rd(lan966x, ANA_VCAP_S2_CFG(port->chip_port));\n\tout->prf(out->dst, \"\\n    state: \");\n\tif (ANA_VCAP_S2_CFG_ENA_GET(val))\n\t\tout->prf(out->dst, \"on\");\n\telse\n\t\tout->prf(out->dst, \"off\");\n\n\tfor (int l = 0; l < admin->lookups; ++l) {\n\t\tout->prf(out->dst, \"\\n    Lookup %d: \", l);\n\n\t\tout->prf(out->dst, \"\\n      snap: \");\n\t\tif (ANA_VCAP_S2_CFG_SNAP_DIS_GET(val) & (BIT(0) << l))\n\t\t\tout->prf(out->dst, \"mac_llc\");\n\t\telse\n\t\t\tout->prf(out->dst, \"mac_snap\");\n\n\t\tout->prf(out->dst, \"\\n      oam: \");\n\t\tif (ANA_VCAP_S2_CFG_OAM_DIS_GET(val) & (BIT(0) << l))\n\t\t\tout->prf(out->dst, \"mac_etype\");\n\t\telse\n\t\t\tout->prf(out->dst, \"mac_oam\");\n\n\t\tout->prf(out->dst, \"\\n      arp: \");\n\t\tif (ANA_VCAP_S2_CFG_ARP_DIS_GET(val) & (BIT(0) << l))\n\t\t\tout->prf(out->dst, \"mac_etype\");\n\t\telse\n\t\t\tout->prf(out->dst, \"mac_arp\");\n\n\t\tout->prf(out->dst, \"\\n      ipv4_other: \");\n\t\tif (ANA_VCAP_S2_CFG_IP_OTHER_DIS_GET(val) & (BIT(0) << l))\n\t\t\tout->prf(out->dst, \"mac_etype\");\n\t\telse\n\t\t\tout->prf(out->dst, \"ip4_other\");\n\n\t\tout->prf(out->dst, \"\\n      ipv4_tcp_udp: \");\n\t\tif (ANA_VCAP_S2_CFG_IP_TCPUDP_DIS_GET(val) & (BIT(0) << l))\n\t\t\tout->prf(out->dst, \"mac_etype\");\n\t\telse\n\t\t\tout->prf(out->dst, \"ipv4_tcp_udp\");\n\n\t\tout->prf(out->dst, \"\\n      ipv6: \");\n\t\tswitch (ANA_VCAP_S2_CFG_IP6_CFG_GET(val) & (0x3 << l)) {\n\t\tcase VCAP_IS2_PS_IPV6_TCPUDP_OTHER:\n\t\t\tout->prf(out->dst, \"ipv6_tcp_udp ipv6_tcp_udp\");\n\t\t\tbreak;\n\t\tcase VCAP_IS2_PS_IPV6_STD:\n\t\t\tout->prf(out->dst, \"ipv6_std\");\n\t\t\tbreak;\n\t\tcase VCAP_IS2_PS_IPV6_IP4_TCPUDP_IP4_OTHER:\n\t\t\tout->prf(out->dst, \"ipv4_tcp_udp ipv4_tcp_udp\");\n\t\t\tbreak;\n\t\tcase VCAP_IS2_PS_IPV6_MAC_ETYPE:\n\t\t\tout->prf(out->dst, \"mac_etype\");\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tout->prf(out->dst, \"\\n\");\n}\n\nstatic void lan966x_vcap_es0_port_keys(struct lan966x_port *port,\n\t\t\t\t       struct vcap_admin *admin,\n\t\t\t\t       struct vcap_output_print *out)\n{\n\tstruct lan966x *lan966x = port->lan966x;\n\tu32 val;\n\n\tout->prf(out->dst, \"  port[%d] (%s): \", port->chip_port,\n\t\t netdev_name(port->dev));\n\n\tval = lan_rd(lan966x, REW_PORT_CFG(port->chip_port));\n\tout->prf(out->dst, \"\\n    state: \");\n\tif (REW_PORT_CFG_ES0_EN_GET(val))\n\t\tout->prf(out->dst, \"on\");\n\telse\n\t\tout->prf(out->dst, \"off\");\n\n\tout->prf(out->dst, \"\\n\");\n}\n\nint lan966x_vcap_port_info(struct net_device *dev,\n\t\t\t   struct vcap_admin *admin,\n\t\t\t   struct vcap_output_print *out)\n{\n\tstruct lan966x_port *port = netdev_priv(dev);\n\tstruct lan966x *lan966x = port->lan966x;\n\tconst struct vcap_info *vcap;\n\tstruct vcap_control *vctrl;\n\n\tvctrl = lan966x->vcap_ctrl;\n\tvcap = &vctrl->vcaps[admin->vtype];\n\n\tout->prf(out->dst, \"%s:\\n\", vcap->name);\n\tswitch (admin->vtype) {\n\tcase VCAP_TYPE_IS2:\n\t\tlan966x_vcap_is2_port_keys(port, admin, out);\n\t\tbreak;\n\tcase VCAP_TYPE_IS1:\n\t\tlan966x_vcap_is1_port_keys(port, admin, out);\n\t\tbreak;\n\tcase VCAP_TYPE_ES0:\n\t\tlan966x_vcap_es0_port_keys(port, admin, out);\n\t\tbreak;\n\tdefault:\n\t\tout->prf(out->dst, \"  no info\\n\");\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}