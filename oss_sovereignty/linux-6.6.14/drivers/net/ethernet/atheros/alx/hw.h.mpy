{
  "module_name": "hw.h",
  "hash_id": "9669f617835da19059621d1c01e49793c90a2122b96aa75be593d70b28a53683",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/atheros/alx/hw.h",
  "human_readable_source": " \n\n#ifndef ALX_HW_H_\n#define ALX_HW_H_\n#include <linux/types.h>\n#include <linux/mdio.h>\n#include <linux/pci.h>\n#include <linux/if_vlan.h>\n#include \"reg.h\"\n\n \nstruct alx_txd {\n\t__le16 len;\n\t__le16 vlan_tag;\n\t__le32 word1;\n\tunion {\n\t\t__le64 addr;\n\t\tstruct {\n\t\t\t__le32 pkt_len;\n\t\t\t__le32 resvd;\n\t\t} l;\n\t} adrl;\n} __packed;\n\n \n#define TPD_CXSUMSTART_MASK\t\t0x00FF\n#define TPD_CXSUMSTART_SHIFT\t\t0\n#define TPD_L4HDROFFSET_MASK\t\t0x00FF\n#define TPD_L4HDROFFSET_SHIFT\t\t0\n#define TPD_CXSUM_EN_MASK\t\t0x0001\n#define TPD_CXSUM_EN_SHIFT\t\t8\n#define TPD_IP_XSUM_MASK\t\t0x0001\n#define TPD_IP_XSUM_SHIFT\t\t9\n#define TPD_TCP_XSUM_MASK\t\t0x0001\n#define TPD_TCP_XSUM_SHIFT\t\t10\n#define TPD_UDP_XSUM_MASK\t\t0x0001\n#define TPD_UDP_XSUM_SHIFT\t\t11\n#define TPD_LSO_EN_MASK\t\t\t0x0001\n#define TPD_LSO_EN_SHIFT\t\t12\n#define TPD_LSO_V2_MASK\t\t\t0x0001\n#define TPD_LSO_V2_SHIFT\t\t13\n#define TPD_VLTAGGED_MASK\t\t0x0001\n#define TPD_VLTAGGED_SHIFT\t\t14\n#define TPD_INS_VLTAG_MASK\t\t0x0001\n#define TPD_INS_VLTAG_SHIFT\t\t15\n#define TPD_IPV4_MASK\t\t\t0x0001\n#define TPD_IPV4_SHIFT\t\t\t16\n#define TPD_ETHTYPE_MASK\t\t0x0001\n#define TPD_ETHTYPE_SHIFT\t\t17\n#define TPD_CXSUMOFFSET_MASK\t\t0x00FF\n#define TPD_CXSUMOFFSET_SHIFT\t\t18\n#define TPD_MSS_MASK\t\t\t0x1FFF\n#define TPD_MSS_SHIFT\t\t\t18\n#define TPD_EOP_MASK\t\t\t0x0001\n#define TPD_EOP_SHIFT\t\t\t31\n\n#define DESC_GET(_x, _name) ((_x) >> _name##SHIFT & _name##MASK)\n\n \nstruct alx_rfd {\n\t__le64 addr;\t\t \n} __packed;\n\n \nstruct alx_rrd {\n\t__le32 word0;\n\t__le32 rss_hash;\n\t__le32 word2;\n\t__le32 word3;\n} __packed;\n\n \n#define RRD_XSUM_MASK\t\t0xFFFF\n#define RRD_XSUM_SHIFT\t\t0\n#define RRD_NOR_MASK\t\t0x000F\n#define RRD_NOR_SHIFT\t\t16\n#define RRD_SI_MASK\t\t0x0FFF\n#define RRD_SI_SHIFT\t\t20\n\n \n#define RRD_VLTAG_MASK\t\t0xFFFF\n#define RRD_VLTAG_SHIFT\t\t0\n#define RRD_PID_MASK\t\t0x00FF\n#define RRD_PID_SHIFT\t\t16\n \n#define RRD_PID_NONIP\t\t0\n \n#define RRD_PID_IPV4\t\t1\n \n#define RRD_PID_IPV6TCP\t\t2\n \n#define RRD_PID_IPV4TCP\t\t3\n \n#define RRD_PID_IPV6UDP\t\t4\n \n#define RRD_PID_IPV4UDP\t\t5\n \n#define RRD_PID_IPV6\t\t6\n \n#define RRD_PID_LLDP\t\t7\n \n#define RRD_PID_1588\t\t8\n#define RRD_RSSQ_MASK\t\t0x0007\n#define RRD_RSSQ_SHIFT\t\t25\n#define RRD_RSSALG_MASK\t\t0x000F\n#define RRD_RSSALG_SHIFT\t28\n#define RRD_RSSALG_TCPV6\t0x1\n#define RRD_RSSALG_IPV6\t\t0x2\n#define RRD_RSSALG_TCPV4\t0x4\n#define RRD_RSSALG_IPV4\t\t0x8\n\n \n#define RRD_PKTLEN_MASK\t\t0x3FFF\n#define RRD_PKTLEN_SHIFT\t0\n#define RRD_ERR_L4_MASK\t\t0x0001\n#define RRD_ERR_L4_SHIFT\t14\n#define RRD_ERR_IPV4_MASK\t0x0001\n#define RRD_ERR_IPV4_SHIFT\t15\n#define RRD_VLTAGGED_MASK\t0x0001\n#define RRD_VLTAGGED_SHIFT\t16\n#define RRD_OLD_PID_MASK\t0x0007\n#define RRD_OLD_PID_SHIFT\t17\n#define RRD_ERR_RES_MASK\t0x0001\n#define RRD_ERR_RES_SHIFT\t20\n#define RRD_ERR_FCS_MASK\t0x0001\n#define RRD_ERR_FCS_SHIFT\t21\n#define RRD_ERR_FAE_MASK\t0x0001\n#define RRD_ERR_FAE_SHIFT\t22\n#define RRD_ERR_TRUNC_MASK\t0x0001\n#define RRD_ERR_TRUNC_SHIFT\t23\n#define RRD_ERR_RUNT_MASK\t0x0001\n#define RRD_ERR_RUNT_SHIFT\t24\n#define RRD_ERR_ICMP_MASK\t0x0001\n#define RRD_ERR_ICMP_SHIFT\t25\n#define RRD_BCAST_MASK\t\t0x0001\n#define RRD_BCAST_SHIFT\t\t26\n#define RRD_MCAST_MASK\t\t0x0001\n#define RRD_MCAST_SHIFT\t\t27\n#define RRD_ETHTYPE_MASK\t0x0001\n#define RRD_ETHTYPE_SHIFT\t28\n#define RRD_ERR_FIFOV_MASK\t0x0001\n#define RRD_ERR_FIFOV_SHIFT\t29\n#define RRD_ERR_LEN_MASK\t0x0001\n#define RRD_ERR_LEN_SHIFT\t30\n#define RRD_UPDATED_MASK\t0x0001\n#define RRD_UPDATED_SHIFT\t31\n\n\n#define ALX_MAX_SETUP_LNK_CYCLE\t50\n\n \n#define ALX_FC_RX\t\t0x01\n#define ALX_FC_TX\t\t0x02\n#define ALX_FC_ANEG\t\t0x04\n\n \n#define ALX_SLEEP_WOL_PHY\t0x00000001\n#define ALX_SLEEP_WOL_MAGIC\t0x00000002\n#define ALX_SLEEP_CIFS\t\t0x00000004\n#define ALX_SLEEP_ACTIVE\t(ALX_SLEEP_WOL_PHY | \\\n\t\t\t\t ALX_SLEEP_WOL_MAGIC | \\\n\t\t\t\t ALX_SLEEP_CIFS)\n\n \n#define ALX_RSS_HASH_TYPE_IPV4\t\t0x1\n#define ALX_RSS_HASH_TYPE_IPV4_TCP\t0x2\n#define ALX_RSS_HASH_TYPE_IPV6\t\t0x4\n#define ALX_RSS_HASH_TYPE_IPV6_TCP\t0x8\n#define ALX_RSS_HASH_TYPE_ALL\t\t(ALX_RSS_HASH_TYPE_IPV4 | \\\n\t\t\t\t\t ALX_RSS_HASH_TYPE_IPV4_TCP | \\\n\t\t\t\t\t ALX_RSS_HASH_TYPE_IPV6 | \\\n\t\t\t\t\t ALX_RSS_HASH_TYPE_IPV6_TCP)\n#define ALX_FRAME_PAD\t\t16\n#define ALX_RAW_MTU(_mtu)\t(_mtu + ETH_HLEN + ETH_FCS_LEN + VLAN_HLEN)\n#define ALX_MAX_FRAME_LEN(_mtu)\t(ALIGN((ALX_RAW_MTU(_mtu) + ALX_FRAME_PAD), 8))\n#define ALX_DEF_RXBUF_SIZE\tALX_MAX_FRAME_LEN(1500)\n#define ALX_MAX_JUMBO_PKT_SIZE\t(9*1024)\n#define ALX_MAX_TSO_PKT_SIZE\t(7*1024)\n#define ALX_MAX_FRAME_SIZE\tALX_MAX_JUMBO_PKT_SIZE\n\n#define ALX_MAX_RX_QUEUES\t8\n#define ALX_MAX_TX_QUEUES\t4\n#define ALX_MAX_HANDLED_INTRS\t5\n\n#define ALX_ISR_MISC\t\t(ALX_ISR_PCIE_LNKDOWN | \\\n\t\t\t\t ALX_ISR_DMAW | \\\n\t\t\t\t ALX_ISR_DMAR | \\\n\t\t\t\t ALX_ISR_SMB | \\\n\t\t\t\t ALX_ISR_MANU | \\\n\t\t\t\t ALX_ISR_TIMER)\n\n#define ALX_ISR_FATAL\t\t(ALX_ISR_PCIE_LNKDOWN | \\\n\t\t\t\t ALX_ISR_DMAW | ALX_ISR_DMAR)\n\n#define ALX_ISR_ALERT\t\t(ALX_ISR_RXF_OV | \\\n\t\t\t\t ALX_ISR_TXF_UR | \\\n\t\t\t\t ALX_ISR_RFD_UR)\n\n#define ALX_ISR_ALL_QUEUES\t(ALX_ISR_TX_Q0 | \\\n\t\t\t\t ALX_ISR_TX_Q1 | \\\n\t\t\t\t ALX_ISR_TX_Q2 | \\\n\t\t\t\t ALX_ISR_TX_Q3 | \\\n\t\t\t\t ALX_ISR_RX_Q0 | \\\n\t\t\t\t ALX_ISR_RX_Q1 | \\\n\t\t\t\t ALX_ISR_RX_Q2 | \\\n\t\t\t\t ALX_ISR_RX_Q3 | \\\n\t\t\t\t ALX_ISR_RX_Q4 | \\\n\t\t\t\t ALX_ISR_RX_Q5 | \\\n\t\t\t\t ALX_ISR_RX_Q6 | \\\n\t\t\t\t ALX_ISR_RX_Q7)\n\n \nstruct alx_hw_stats {\n\t \n\tu64 rx_ok;\t\t \n\tu64 rx_bcast;\t\t \n\tu64 rx_mcast;\t\t \n\tu64 rx_pause;\t\t \n\tu64 rx_ctrl;\t\t \n\tu64 rx_fcs_err;\t\t \n\tu64 rx_len_err;\t\t \n\tu64 rx_byte_cnt;\t \n\tu64 rx_runt;\t\t \n\tu64 rx_frag;\t\t \n\tu64 rx_sz_64B;\t\t \n\tu64 rx_sz_127B;\t\t \n\tu64 rx_sz_255B;\t\t \n\tu64 rx_sz_511B;\t\t \n\tu64 rx_sz_1023B;\t \n\tu64 rx_sz_1518B;\t \n\tu64 rx_sz_max;\t\t \n\tu64 rx_ov_sz;\t\t \n\tu64 rx_ov_rxf;\t\t \n\tu64 rx_ov_rrd;\t\t \n\tu64 rx_align_err;\t \n\tu64 rx_bc_byte_cnt;\t \n\tu64 rx_mc_byte_cnt;\t \n\tu64 rx_err_addr;\t \n\n\t \n\tu64 tx_ok;\t\t \n\tu64 tx_bcast;\t\t \n\tu64 tx_mcast;\t\t \n\tu64 tx_pause;\t\t \n\tu64 tx_exc_defer;\t \n\tu64 tx_ctrl;\t\t \n\tu64 tx_defer;\t\t \n\tu64 tx_byte_cnt;\t \n\tu64 tx_sz_64B;\t\t \n\tu64 tx_sz_127B;\t\t \n\tu64 tx_sz_255B;\t\t \n\tu64 tx_sz_511B;\t\t \n\tu64 tx_sz_1023B;\t \n\tu64 tx_sz_1518B;\t \n\tu64 tx_sz_max;\t\t \n\tu64 tx_single_col;\t \n\tu64 tx_multi_col;\t \n\tu64 tx_late_col;\t \n\tu64 tx_abort_col;\t \n\tu64 tx_underrun;\t \n\tu64 tx_trd_eop;\t\t \n\tu64 tx_len_err;\t\t \n\tu64 tx_trunc;\t\t \n\tu64 tx_bc_byte_cnt;\t \n\tu64 tx_mc_byte_cnt;\t \n\tu64 update;\n};\n\n\n \n#define ALX_MAX_MSIX_INTRS\t16\n\n#define ALX_GET_FIELD(_data, _field)\t\t\t\t\t\\\n\t(((_data) >> _field ## _SHIFT) & _field ## _MASK)\n\n#define ALX_SET_FIELD(_data, _field, _value)\tdo {\t\t\t\\\n\t\t(_data) &= ~(_field ## _MASK << _field ## _SHIFT);\t\\\n\t\t(_data) |= ((_value) & _field ## _MASK) << _field ## _SHIFT;\\\n\t} while (0)\n\nstruct alx_hw {\n\tstruct pci_dev *pdev;\n\tu8 __iomem *hw_addr;\n\n\t \n\tu8 mac_addr[ETH_ALEN];\n\tu8 perm_addr[ETH_ALEN];\n\n\tu16 mtu;\n\tu16 imt;\n\tu8 dma_chnl;\n\tu8 max_dma_chnl;\n\t \n\tu32 ith_tpd;\n\tu32 rx_ctrl;\n\tu32 mc_hash[2];\n\n\tu32 smb_timer;\n\t \n\tint link_speed;\n\tu8 duplex;\n\n\t \n\tu8 flowctrl;\n\tu32 adv_cfg;\n\n\tspinlock_t mdio_lock;\n\tstruct mdio_if_info mdio;\n\tu16 phy_id[2];\n\n\t \n\tbool lnk_patch;\n\n\t \n\tstruct alx_hw_stats stats;\n};\n\nstatic inline int alx_hw_revision(struct alx_hw *hw)\n{\n\treturn hw->pdev->revision >> ALX_PCI_REVID_SHIFT;\n}\n\nstatic inline bool alx_hw_with_cr(struct alx_hw *hw)\n{\n\treturn hw->pdev->revision & 1;\n}\n\nstatic inline bool alx_hw_giga(struct alx_hw *hw)\n{\n\treturn hw->pdev->device & 1;\n}\n\nstatic inline void alx_write_mem8(struct alx_hw *hw, u32 reg, u8 val)\n{\n\twriteb(val, hw->hw_addr + reg);\n}\n\nstatic inline void alx_write_mem16(struct alx_hw *hw, u32 reg, u16 val)\n{\n\twritew(val, hw->hw_addr + reg);\n}\n\nstatic inline u16 alx_read_mem16(struct alx_hw *hw, u32 reg)\n{\n\treturn readw(hw->hw_addr + reg);\n}\n\nstatic inline void alx_write_mem32(struct alx_hw *hw, u32 reg, u32 val)\n{\n\twritel(val, hw->hw_addr + reg);\n}\n\nstatic inline u32 alx_read_mem32(struct alx_hw *hw, u32 reg)\n{\n\treturn readl(hw->hw_addr + reg);\n}\n\nstatic inline void alx_post_write(struct alx_hw *hw)\n{\n\treadl(hw->hw_addr);\n}\n\nint alx_get_perm_macaddr(struct alx_hw *hw, u8 *addr);\nvoid alx_reset_phy(struct alx_hw *hw);\nvoid alx_reset_pcie(struct alx_hw *hw);\nvoid alx_enable_aspm(struct alx_hw *hw, bool l0s_en, bool l1_en);\nint alx_setup_speed_duplex(struct alx_hw *hw, u32 ethadv, u8 flowctrl);\nvoid alx_post_phy_link(struct alx_hw *hw);\nint alx_read_phy_reg(struct alx_hw *hw, u16 reg, u16 *phy_data);\nint alx_write_phy_reg(struct alx_hw *hw, u16 reg, u16 phy_data);\nint alx_read_phy_ext(struct alx_hw *hw, u8 dev, u16 reg, u16 *pdata);\nint alx_write_phy_ext(struct alx_hw *hw, u8 dev, u16 reg, u16 data);\nint alx_read_phy_link(struct alx_hw *hw);\nint alx_clear_phy_intr(struct alx_hw *hw);\nvoid alx_cfg_mac_flowcontrol(struct alx_hw *hw, u8 fc);\nvoid alx_start_mac(struct alx_hw *hw);\nint alx_reset_mac(struct alx_hw *hw);\nvoid alx_set_macaddr(struct alx_hw *hw, const u8 *addr);\nbool alx_phy_configured(struct alx_hw *hw);\nvoid alx_configure_basic(struct alx_hw *hw);\nvoid alx_mask_msix(struct alx_hw *hw, int index, bool mask);\nvoid alx_disable_rss(struct alx_hw *hw);\nbool alx_get_phy_info(struct alx_hw *hw);\nvoid alx_update_hw_stats(struct alx_hw *hw);\n\nstatic inline u32 alx_speed_to_ethadv(int speed, u8 duplex)\n{\n\tif (speed == SPEED_1000 && duplex == DUPLEX_FULL)\n\t\treturn ADVERTISED_1000baseT_Full;\n\tif (speed == SPEED_100 && duplex == DUPLEX_FULL)\n\t\treturn ADVERTISED_100baseT_Full;\n\tif (speed == SPEED_100 && duplex== DUPLEX_HALF)\n\t\treturn ADVERTISED_100baseT_Half;\n\tif (speed == SPEED_10 && duplex == DUPLEX_FULL)\n\t\treturn ADVERTISED_10baseT_Full;\n\tif (speed == SPEED_10 && duplex == DUPLEX_HALF)\n\t\treturn ADVERTISED_10baseT_Half;\n\treturn 0;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}