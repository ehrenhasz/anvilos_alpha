{
  "module_name": "atl2.h",
  "hash_id": "40ba72ef583e834591c721a21f969ea49729b74f9d04496f8e1e75df8c101cf6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/atheros/atlx/atl2.h",
  "human_readable_source": " \n \n\n#ifndef _ATL2_H_\n#define _ATL2_H_\n\n#include <linux/atomic.h>\n#include <linux/netdevice.h>\n\n#ifndef _ATL2_HW_H_\n#define _ATL2_HW_H_\n\n#ifndef _ATL2_OSDEP_H_\n#define _ATL2_OSDEP_H_\n\n#include <linux/pci.h>\n#include <linux/delay.h>\n#include <linux/interrupt.h>\n#include <linux/if_ether.h>\n\n#include \"atlx.h\"\n\n#ifdef ETHTOOL_OPS_COMPAT\nint ethtool_ioctl(struct ifreq *ifr);\n#endif\n\n#define PCI_COMMAND_REGISTER\tPCI_COMMAND\n#define CMD_MEM_WRT_INVALIDATE\tPCI_COMMAND_INVALIDATE\n\n#define ATL2_WRITE_REG(a, reg, value) (iowrite32((value), \\\n\t((a)->hw_addr + (reg))))\n\n#define ATL2_WRITE_FLUSH(a) (ioread32((a)->hw_addr))\n\n#define ATL2_READ_REG(a, reg) (ioread32((a)->hw_addr + (reg)))\n\n#define ATL2_WRITE_REGB(a, reg, value) (iowrite8((value), \\\n\t((a)->hw_addr + (reg))))\n\n#define ATL2_READ_REGB(a, reg) (ioread8((a)->hw_addr + (reg)))\n\n#define ATL2_WRITE_REGW(a, reg, value) (iowrite16((value), \\\n\t((a)->hw_addr + (reg))))\n\n#define ATL2_READ_REGW(a, reg) (ioread16((a)->hw_addr + (reg)))\n\n#define ATL2_WRITE_REG_ARRAY(a, reg, offset, value) \\\n\t(iowrite32((value), (((a)->hw_addr + (reg)) + ((offset) << 2))))\n\n#define ATL2_READ_REG_ARRAY(a, reg, offset) \\\n\t(ioread32(((a)->hw_addr + (reg)) + ((offset) << 2)))\n\n#endif  \n\nstruct atl2_adapter;\nstruct atl2_hw;\n\n \nstatic s32 atl2_reset_hw(struct atl2_hw *hw);\nstatic s32 atl2_read_mac_addr(struct atl2_hw *hw);\nstatic s32 atl2_init_hw(struct atl2_hw *hw);\nstatic s32 atl2_get_speed_and_duplex(struct atl2_hw *hw, u16 *speed,\n\tu16 *duplex);\nstatic u32 atl2_hash_mc_addr(struct atl2_hw *hw, u8 *mc_addr);\nstatic void atl2_hash_set(struct atl2_hw *hw, u32 hash_value);\nstatic s32 atl2_read_phy_reg(struct atl2_hw *hw, u16 reg_addr, u16 *phy_data);\nstatic s32 atl2_write_phy_reg(struct atl2_hw *hw, u32 reg_addr, u16 phy_data);\nstatic void atl2_read_pci_cfg(struct atl2_hw *hw, u32 reg, u16 *value);\nstatic void atl2_write_pci_cfg(struct atl2_hw *hw, u32 reg, u16 *value);\nstatic void atl2_set_mac_addr(struct atl2_hw *hw);\nstatic bool atl2_read_eeprom(struct atl2_hw *hw, u32 Offset, u32 *pValue);\nstatic bool atl2_write_eeprom(struct atl2_hw *hw, u32 offset, u32 value);\nstatic s32 atl2_phy_init(struct atl2_hw *hw);\nstatic int atl2_check_eeprom_exist(struct atl2_hw *hw);\nstatic void atl2_force_ps(struct atl2_hw *hw);\n\n \n\n \n#define IDLE_STATUS_RXMAC\t1\t \n#define IDLE_STATUS_TXMAC\t2\t \n#define IDLE_STATUS_DMAR\t8\t \n#define IDLE_STATUS_DMAW\t4\t \n\n \n#define MDIO_WAIT_TIMES\t\t10\n\n \n#define MAC_CTRL_DBG_TX_BKPRESURE\t0x100000\t \n#define MAC_CTRL_MACLP_CLK_PHY\t\t0x8000000\t \n#define MAC_CTRL_HALF_LEFT_BUF_SHIFT\t28\n#define MAC_CTRL_HALF_LEFT_BUF_MASK\t0xF\t\t \n\n \n#define REG_SRAM_TXRAM_END\t0x1500\t \n#define REG_SRAM_RXRAM_END\t0x1502\t \n\n \n#define REG_TXD_BASE_ADDR_LO\t0x1544\t \n#define REG_TXD_MEM_SIZE\t0x1548\t \n#define REG_TXS_BASE_ADDR_LO\t0x154C\t \n#define REG_TXS_MEM_SIZE\t0x1550\t \n#define REG_RXD_BASE_ADDR_LO\t0x1554\t \n#define REG_RXD_BUF_NUM\t\t0x1558\t \n\n \n#define REG_DMAR\t0x1580\n#define     DMAR_EN\t0x1\t \n\n \n#define REG_TX_CUT_THRESH\t0x1590\t \n\n \n#define REG_DMAW\t0x15A0\n#define     DMAW_EN\t0x1\n\n \n#define REG_PAUSE_ON_TH\t\t0x15A8\t \n#define REG_PAUSE_OFF_TH\t0x15AA\t \n\n \n#define REG_MB_TXD_WR_IDX\t0x15f0\t \n#define REG_MB_RXD_RD_IDX\t0x15F4\t \n\n \n#define ISR_TIMER\t1\t \n#define ISR_MANUAL\t2\t \n#define ISR_RXF_OV\t4\t \n#define ISR_TXF_UR\t8\t \n#define ISR_TXS_OV\t0x10\t \n#define ISR_RXS_OV\t0x20\t \n#define ISR_LINK_CHG\t0x40\t \n#define ISR_HOST_TXD_UR\t0x80\n#define ISR_HOST_RXD_OV\t0x100\t \n#define ISR_DMAR_TO_RST\t0x200\t \n#define ISR_DMAW_TO_RST\t0x400\n#define ISR_PHY\t\t0x800\t \n#define ISR_TS_UPDATE\t0x10000\t \n#define ISR_RS_UPDATE\t0x20000\t \n#define ISR_TX_EARLY\t0x40000\t \n\n#define ISR_TX_EVENT (ISR_TXF_UR | ISR_TXS_OV | ISR_HOST_TXD_UR |\\\n\tISR_TS_UPDATE | ISR_TX_EARLY)\n#define ISR_RX_EVENT (ISR_RXF_OV | ISR_RXS_OV | ISR_HOST_RXD_OV |\\\n\t ISR_RS_UPDATE)\n\n#define IMR_NORMAL_MASK\t\t(\\\n\t \\\n\tISR_MANUAL\t\t|\\\n\tISR_DMAR_TO_RST\t\t|\\\n\tISR_DMAW_TO_RST\t\t|\\\n\tISR_PHY\t\t\t|\\\n\tISR_PHY_LINKDOWN\t|\\\n\tISR_TS_UPDATE\t\t|\\\n\tISR_RS_UPDATE)\n\n \n#define REG_STS_RX_PAUSE\t0x1700\t \n#define REG_STS_RXD_OV\t\t0x1704\t \n#define REG_STS_RXS_OV\t\t0x1708\t \n#define REG_STS_RX_FILTER\t0x170C\t \n\n \n\n \n#define MII_SMARTSPEED\t0x14\n#define MII_DBG_ADDR\t0x1D\n#define MII_DBG_DATA\t0x1E\n\n \n#define PCI_REG_COMMAND\t\t0x04\n#define CMD_IO_SPACE\t\t0x0001\n#define CMD_MEMORY_SPACE\t0x0002\n#define CMD_BUS_MASTER\t\t0x0004\n\n#define MEDIA_TYPE_100M_FULL\t1\n#define MEDIA_TYPE_100M_HALF\t2\n#define MEDIA_TYPE_10M_FULL\t3\n#define MEDIA_TYPE_10M_HALF\t4\n\n#define AUTONEG_ADVERTISE_SPEED_DEFAULT\t0x000F\t \n\n \n#define MAXIMUM_ETHERNET_FRAME_SIZE\t1518\t \n#define MINIMUM_ETHERNET_FRAME_SIZE\t64\t \n#define MAX_JUMBO_FRAME_SIZE\t\t0x2000\n\nstruct tx_pkt_header {\n\tunsigned pkt_size:11;\n\tunsigned:4;\t\t\t \n\tunsigned ins_vlan:1;\t\t \n\tunsigned short vlan;\t\t \n};\n \n#define TX_PKT_HEADER_SIZE_MASK\t\t0x7FF\n#define TX_PKT_HEADER_SIZE_SHIFT\t0\n#define TX_PKT_HEADER_INS_VLAN_MASK\t0x1\n#define TX_PKT_HEADER_INS_VLAN_SHIFT\t15\n#define TX_PKT_HEADER_VLAN_TAG_MASK\t0xFFFF\n#define TX_PKT_HEADER_VLAN_TAG_SHIFT\t16\n\nstruct tx_pkt_status {\n\tunsigned pkt_size:11;\n\tunsigned:5;\t\t \n\tunsigned ok:1;\t\t \n\tunsigned bcast:1;\t \n\tunsigned mcast:1;\t \n\tunsigned pause:1;\t \n\tunsigned ctrl:1;\n\tunsigned defer:1;    \t \n\tunsigned exc_defer:1;\n\tunsigned single_col:1;\n\tunsigned multi_col:1;\n\tunsigned late_col:1;\n\tunsigned abort_col:1;\n\tunsigned underrun:1;\t \n\tunsigned:3;\t\t \n\tunsigned update:1;\t \n};\n \n#define TX_PKT_STATUS_SIZE_MASK\t\t0x7FF\n#define TX_PKT_STATUS_SIZE_SHIFT\t0\n#define TX_PKT_STATUS_OK_MASK\t\t0x1\n#define TX_PKT_STATUS_OK_SHIFT\t\t16\n#define TX_PKT_STATUS_BCAST_MASK\t0x1\n#define TX_PKT_STATUS_BCAST_SHIFT\t17\n#define TX_PKT_STATUS_MCAST_MASK\t0x1\n#define TX_PKT_STATUS_MCAST_SHIFT\t18\n#define TX_PKT_STATUS_PAUSE_MASK\t0x1\n#define TX_PKT_STATUS_PAUSE_SHIFT\t19\n#define TX_PKT_STATUS_CTRL_MASK\t\t0x1\n#define TX_PKT_STATUS_CTRL_SHIFT\t20\n#define TX_PKT_STATUS_DEFER_MASK\t0x1\n#define TX_PKT_STATUS_DEFER_SHIFT\t21\n#define TX_PKT_STATUS_EXC_DEFER_MASK\t0x1\n#define TX_PKT_STATUS_EXC_DEFER_SHIFT\t22\n#define TX_PKT_STATUS_SINGLE_COL_MASK\t0x1\n#define TX_PKT_STATUS_SINGLE_COL_SHIFT\t23\n#define TX_PKT_STATUS_MULTI_COL_MASK\t0x1\n#define TX_PKT_STATUS_MULTI_COL_SHIFT\t24\n#define TX_PKT_STATUS_LATE_COL_MASK\t0x1\n#define TX_PKT_STATUS_LATE_COL_SHIFT\t25\n#define TX_PKT_STATUS_ABORT_COL_MASK\t0x1\n#define TX_PKT_STATUS_ABORT_COL_SHIFT\t26\n#define TX_PKT_STATUS_UNDERRUN_MASK\t0x1\n#define TX_PKT_STATUS_UNDERRUN_SHIFT\t27\n#define TX_PKT_STATUS_UPDATE_MASK\t0x1\n#define TX_PKT_STATUS_UPDATE_SHIFT\t31\n\nstruct rx_pkt_status {\n\tunsigned pkt_size:11;\t \n\tunsigned:5;\t\t \n\tunsigned ok:1;\t\t \n\tunsigned bcast:1;\t \n\tunsigned mcast:1;\t \n\tunsigned pause:1;\n\tunsigned ctrl:1;\n\tunsigned crc:1;\t\t \n\tunsigned code:1;\t \n\tunsigned runt:1;\t \n\tunsigned frag:1;\t \n\tunsigned trunc:1;\t \n\tunsigned align:1;\t \n\tunsigned vlan:1;\t \n\tunsigned:3;\t\t \n\tunsigned update:1;\n\tunsigned short vtag;\t \n\tunsigned:16;\n};\n \n#define RX_PKT_STATUS_SIZE_MASK\t\t0x7FF\n#define RX_PKT_STATUS_SIZE_SHIFT\t0\n#define RX_PKT_STATUS_OK_MASK\t\t0x1\n#define RX_PKT_STATUS_OK_SHIFT\t\t16\n#define RX_PKT_STATUS_BCAST_MASK\t0x1\n#define RX_PKT_STATUS_BCAST_SHIFT\t17\n#define RX_PKT_STATUS_MCAST_MASK\t0x1\n#define RX_PKT_STATUS_MCAST_SHIFT\t18\n#define RX_PKT_STATUS_PAUSE_MASK\t0x1\n#define RX_PKT_STATUS_PAUSE_SHIFT\t19\n#define RX_PKT_STATUS_CTRL_MASK\t\t0x1\n#define RX_PKT_STATUS_CTRL_SHIFT\t20\n#define RX_PKT_STATUS_CRC_MASK\t\t0x1\n#define RX_PKT_STATUS_CRC_SHIFT\t\t21\n#define RX_PKT_STATUS_CODE_MASK\t\t0x1\n#define RX_PKT_STATUS_CODE_SHIFT\t22\n#define RX_PKT_STATUS_RUNT_MASK\t\t0x1\n#define RX_PKT_STATUS_RUNT_SHIFT\t23\n#define RX_PKT_STATUS_FRAG_MASK\t\t0x1\n#define RX_PKT_STATUS_FRAG_SHIFT\t24\n#define RX_PKT_STATUS_TRUNK_MASK\t0x1\n#define RX_PKT_STATUS_TRUNK_SHIFT\t25\n#define RX_PKT_STATUS_ALIGN_MASK\t0x1\n#define RX_PKT_STATUS_ALIGN_SHIFT\t26\n#define RX_PKT_STATUS_VLAN_MASK\t\t0x1\n#define RX_PKT_STATUS_VLAN_SHIFT\t27\n#define RX_PKT_STATUS_UPDATE_MASK\t0x1\n#define RX_PKT_STATUS_UPDATE_SHIFT\t31\n#define RX_PKT_STATUS_VLAN_TAG_MASK\t0xFFFF\n#define RX_PKT_STATUS_VLAN_TAG_SHIFT\t32\n\nstruct rx_desc {\n\tstruct rx_pkt_status\tstatus;\n\tunsigned char     \tpacket[1536-sizeof(struct rx_pkt_status)];\n};\n\nenum atl2_speed_duplex {\n\tatl2_10_half = 0,\n\tatl2_10_full = 1,\n\tatl2_100_half = 2,\n\tatl2_100_full = 3\n};\n\nstruct atl2_spi_flash_dev {\n\tconst char *manu_name;\t \n\t \n\tu8 cmdWRSR;\n\tu8 cmdREAD;\n\tu8 cmdPROGRAM;\n\tu8 cmdWREN;\n\tu8 cmdWRDI;\n\tu8 cmdRDSR;\n\tu8 cmdRDID;\n\tu8 cmdSECTOR_ERASE;\n\tu8 cmdCHIP_ERASE;\n};\n\n \nstruct atl2_hw {\n\tu8 __iomem *hw_addr;\n\tvoid *back;\n\n\tu8 preamble_len;\n\tu8 max_retry;           \n\tu8 jam_ipg;             \n\tu8 ipgt;                \n\tu8 min_ifg;             \n\tu8 ipgr1;               \n\tu8 ipgr2;               \n\tu8 retry_buf;           \n\n\tu16 fc_rxd_hi;\n\tu16 fc_rxd_lo;\n\tu16 lcol;               \n\tu16 max_frame_size;\n\n\tu16 MediaType;\n\tu16 autoneg_advertised;\n\tu16 pci_cmd_word;\n\n\tu16 mii_autoneg_adv_reg;\n\n\tu32 mem_rang;\n\tu32 txcw;\n\tu32 mc_filter_type;\n\tu32 num_mc_addrs;\n\tu32 collision_delta;\n\tu32 tx_packet_delta;\n\tu16 phy_spd_default;\n\n\tu16 device_id;\n\tu16 vendor_id;\n\tu16 subsystem_id;\n\tu16 subsystem_vendor_id;\n\tu8 revision_id;\n\n\t \n\tu8 flash_vendor;\n\n\tu8 dma_fairness;\n\tu8 mac_addr[ETH_ALEN];\n\tu8 perm_mac_addr[ETH_ALEN];\n\n\t \n\t \n\tbool phy_configured;\n};\n\n#endif  \n\nstruct atl2_ring_header {\n     \n    void *desc;\n     \n    dma_addr_t dma;\n     \n    unsigned int size;\n};\n\n \nstruct atl2_adapter {\n\t \n\tstruct net_device *netdev;\n\tstruct pci_dev *pdev;\n\tu32 wol;\n\tu16 link_speed;\n\tu16 link_duplex;\n\n\tspinlock_t stats_lock;\n\n\tstruct work_struct reset_task;\n\tstruct work_struct link_chg_task;\n\tstruct timer_list watchdog_timer;\n\tstruct timer_list phy_config_timer;\n\n\tunsigned long cfg_phy;\n\tbool mac_disabled;\n\n\t \n\tdma_addr_t\tring_dma;\n\tvoid\t\t*ring_vir_addr;\n\tint\t\tring_size;\n\n\tstruct tx_pkt_header\t*txd_ring;\n\tdma_addr_t\ttxd_dma;\n\n\tstruct tx_pkt_status\t*txs_ring;\n\tdma_addr_t\ttxs_dma;\n\n\tstruct rx_desc\t*rxd_ring;\n\tdma_addr_t\trxd_dma;\n\n\tu32 txd_ring_size;          \n\tu32 txs_ring_size;          \n\tu32 rxd_ring_size;          \n\n\t \n\t \n\tu32 txd_write_ptr;\n\tu32 txs_next_clear;\n\tu32 rxd_read_ptr;\n\n\t \n\tatomic_t txd_read_ptr;\n\tatomic_t txs_write_ptr;\n\tu32 rxd_write_ptr;\n\n\t \n\tu16 imt;\n\t \n\tu16 ict;\n\n\tunsigned long flags;\n\t \n\tu32 bd_number;      \n\tbool pci_using_64;\n\tbool have_msi;\n\tstruct atl2_hw hw;\n\n\tu32 usr_cmd;\n\t \n\t \n\tu32 pci_state[16];\n\n\tu32 *config_space;\n};\n\nenum atl2_state_t {\n\t__ATL2_TESTING,\n\t__ATL2_RESETTING,\n\t__ATL2_DOWN\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}