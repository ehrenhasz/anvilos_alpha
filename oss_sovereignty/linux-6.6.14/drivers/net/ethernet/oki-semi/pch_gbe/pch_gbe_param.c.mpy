{
  "module_name": "pch_gbe_param.c",
  "hash_id": "ace1ceef6682274329587a69733409927a00967915ad5f973a7110d06fd17aa9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/oki-semi/pch_gbe/pch_gbe_param.c",
  "human_readable_source": "\n \n\n#include \"pch_gbe.h\"\n#include <linux/module.h>\t \n\n#define OPTION_UNSET   -1\n#define OPTION_DISABLED 0\n#define OPTION_ENABLED  1\n\n \nstatic int TxDescriptors = OPTION_UNSET;\nmodule_param(TxDescriptors, int, 0);\nMODULE_PARM_DESC(TxDescriptors, \"Number of transmit descriptors\");\n\n \nstatic int RxDescriptors = OPTION_UNSET;\nmodule_param(RxDescriptors, int, 0);\nMODULE_PARM_DESC(RxDescriptors, \"Number of receive descriptors\");\n\n \nstatic int Speed = OPTION_UNSET;\nmodule_param(Speed, int, 0);\nMODULE_PARM_DESC(Speed, \"Speed setting\");\n\n \nstatic int Duplex = OPTION_UNSET;\nmodule_param(Duplex, int, 0);\nMODULE_PARM_DESC(Duplex, \"Duplex setting\");\n\n#define HALF_DUPLEX 1\n#define FULL_DUPLEX 2\n\n \nstatic int AutoNeg = OPTION_UNSET;\nmodule_param(AutoNeg, int, 0);\nMODULE_PARM_DESC(AutoNeg, \"Advertised auto-negotiation setting\");\n\n#define PHY_ADVERTISE_10_HALF      0x0001\n#define PHY_ADVERTISE_10_FULL      0x0002\n#define PHY_ADVERTISE_100_HALF     0x0004\n#define PHY_ADVERTISE_100_FULL     0x0008\n#define PHY_ADVERTISE_1000_HALF    0x0010  \n#define PHY_ADVERTISE_1000_FULL    0x0020\n#define PCH_AUTONEG_ADVERTISE_DEFAULT   0x2F\n\n \nstatic int FlowControl = OPTION_UNSET;\nmodule_param(FlowControl, int, 0);\nMODULE_PARM_DESC(FlowControl, \"Flow Control setting\");\n\n \nstatic int XsumRX = OPTION_UNSET;\nmodule_param(XsumRX, int, 0);\nMODULE_PARM_DESC(XsumRX, \"Disable or enable Receive Checksum offload\");\n\n#define PCH_GBE_DEFAULT_RX_CSUM             true\t \n\n \nstatic int XsumTX = OPTION_UNSET;\nmodule_param(XsumTX, int, 0);\nMODULE_PARM_DESC(XsumTX, \"Disable or enable Transmit Checksum offload\");\n\n#define PCH_GBE_DEFAULT_TX_CSUM             true\t \n\n \nstruct pch_gbe_option {\n\tenum { enable_option, range_option, list_option } type;\n\tchar *name;\n\tchar *err;\n\tint  def;\n\tunion {\n\t\tstruct {  \n\t\t\tint min;\n\t\t\tint max;\n\t\t} r;\n\t\tstruct {  \n\t\t\tint nr;\n\t\t\tconst struct pch_gbe_opt_list { int i; char *str; } *p;\n\t\t} l;\n\t} arg;\n};\n\nstatic const struct pch_gbe_opt_list speed_list[] = {\n\t{ 0, \"\" },\n\t{ SPEED_10, \"\" },\n\t{ SPEED_100, \"\" },\n\t{ SPEED_1000, \"\" }\n};\n\nstatic const struct pch_gbe_opt_list dplx_list[] = {\n\t{ 0, \"\" },\n\t{ HALF_DUPLEX, \"\" },\n\t{ FULL_DUPLEX, \"\" }\n};\n\nstatic const struct pch_gbe_opt_list an_list[] =\n\t#define AA \"AutoNeg advertising \"\n\t{{ 0x01, AA \"10/HD\" },\n\t { 0x02, AA \"10/FD\" },\n\t { 0x03, AA \"10/FD, 10/HD\" },\n\t { 0x04, AA \"100/HD\" },\n\t { 0x05, AA \"100/HD, 10/HD\" },\n\t { 0x06, AA \"100/HD, 10/FD\" },\n\t { 0x07, AA \"100/HD, 10/FD, 10/HD\" },\n\t { 0x08, AA \"100/FD\" },\n\t { 0x09, AA \"100/FD, 10/HD\" },\n\t { 0x0a, AA \"100/FD, 10/FD\" },\n\t { 0x0b, AA \"100/FD, 10/FD, 10/HD\" },\n\t { 0x0c, AA \"100/FD, 100/HD\" },\n\t { 0x0d, AA \"100/FD, 100/HD, 10/HD\" },\n\t { 0x0e, AA \"100/FD, 100/HD, 10/FD\" },\n\t { 0x0f, AA \"100/FD, 100/HD, 10/FD, 10/HD\" },\n\t { 0x20, AA \"1000/FD\" },\n\t { 0x21, AA \"1000/FD, 10/HD\" },\n\t { 0x22, AA \"1000/FD, 10/FD\" },\n\t { 0x23, AA \"1000/FD, 10/FD, 10/HD\" },\n\t { 0x24, AA \"1000/FD, 100/HD\" },\n\t { 0x25, AA \"1000/FD, 100/HD, 10/HD\" },\n\t { 0x26, AA \"1000/FD, 100/HD, 10/FD\" },\n\t { 0x27, AA \"1000/FD, 100/HD, 10/FD, 10/HD\" },\n\t { 0x28, AA \"1000/FD, 100/FD\" },\n\t { 0x29, AA \"1000/FD, 100/FD, 10/HD\" },\n\t { 0x2a, AA \"1000/FD, 100/FD, 10/FD\" },\n\t { 0x2b, AA \"1000/FD, 100/FD, 10/FD, 10/HD\" },\n\t { 0x2c, AA \"1000/FD, 100/FD, 100/HD\" },\n\t { 0x2d, AA \"1000/FD, 100/FD, 100/HD, 10/HD\" },\n\t { 0x2e, AA \"1000/FD, 100/FD, 100/HD, 10/FD\" },\n\t { 0x2f, AA \"1000/FD, 100/FD, 100/HD, 10/FD, 10/HD\" }\n};\n\nstatic const struct pch_gbe_opt_list fc_list[] = {\n\t{ PCH_GBE_FC_NONE, \"Flow Control Disabled\" },\n\t{ PCH_GBE_FC_RX_PAUSE, \"Flow Control Receive Only\" },\n\t{ PCH_GBE_FC_TX_PAUSE, \"Flow Control Transmit Only\" },\n\t{ PCH_GBE_FC_FULL, \"Flow Control Enabled\" }\n};\n\n \nstatic int pch_gbe_validate_option(int *value,\n\t\t\t\t    const struct pch_gbe_option *opt,\n\t\t\t\t    struct pch_gbe_adapter *adapter)\n{\n\tif (*value == OPTION_UNSET) {\n\t\t*value = opt->def;\n\t\treturn 0;\n\t}\n\n\tswitch (opt->type) {\n\tcase enable_option:\n\t\tswitch (*value) {\n\t\tcase OPTION_ENABLED:\n\t\t\tnetdev_dbg(adapter->netdev, \"%s Enabled\\n\", opt->name);\n\t\t\treturn 0;\n\t\tcase OPTION_DISABLED:\n\t\t\tnetdev_dbg(adapter->netdev, \"%s Disabled\\n\", opt->name);\n\t\t\treturn 0;\n\t\t}\n\t\tbreak;\n\tcase range_option:\n\t\tif (*value >= opt->arg.r.min && *value <= opt->arg.r.max) {\n\t\t\tnetdev_dbg(adapter->netdev, \"%s set to %i\\n\",\n\t\t\t\t   opt->name, *value);\n\t\t\treturn 0;\n\t\t}\n\t\tbreak;\n\tcase list_option: {\n\t\tint i;\n\t\tconst struct pch_gbe_opt_list *ent;\n\n\t\tfor (i = 0; i < opt->arg.l.nr; i++) {\n\t\t\tent = &opt->arg.l.p[i];\n\t\t\tif (*value == ent->i) {\n\t\t\t\tif (ent->str[0] != '\\0')\n\t\t\t\t\tnetdev_dbg(adapter->netdev, \"%s\\n\",\n\t\t\t\t\t\t   ent->str);\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t}\n\t}\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n\n\tnetdev_dbg(adapter->netdev, \"Invalid %s value specified (%i) %s\\n\",\n\t\t   opt->name, *value, opt->err);\n\t*value = opt->def;\n\treturn -1;\n}\n\n \nstatic void pch_gbe_check_copper_options(struct pch_gbe_adapter *adapter)\n{\n\tstruct pch_gbe_hw *hw = &adapter->hw;\n\tint speed, dplx;\n\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = list_option,\n\t\t\t.name = \"Speed\",\n\t\t\t.err  = \"parameter ignored\",\n\t\t\t.def  = 0,\n\t\t\t.arg  = { .l = { .nr = (int)ARRAY_SIZE(speed_list),\n\t\t\t\t\t .p = speed_list } }\n\t\t};\n\t\tspeed = Speed;\n\t\tpch_gbe_validate_option(&speed, &opt, adapter);\n\t}\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = list_option,\n\t\t\t.name = \"Duplex\",\n\t\t\t.err  = \"parameter ignored\",\n\t\t\t.def  = 0,\n\t\t\t.arg  = { .l = { .nr = (int)ARRAY_SIZE(dplx_list),\n\t\t\t\t\t .p = dplx_list } }\n\t\t};\n\t\tdplx = Duplex;\n\t\tpch_gbe_validate_option(&dplx, &opt, adapter);\n\t}\n\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = list_option,\n\t\t\t.name = \"AutoNeg\",\n\t\t\t.err  = \"parameter ignored\",\n\t\t\t.def  = PCH_AUTONEG_ADVERTISE_DEFAULT,\n\t\t\t.arg  = { .l = { .nr = (int)ARRAY_SIZE(an_list),\n\t\t\t\t\t .p = an_list} }\n\t\t};\n\t\tif (speed || dplx) {\n\t\t\tnetdev_dbg(adapter->netdev,\n\t\t\t\t   \"AutoNeg specified along with Speed or Duplex, AutoNeg parameter ignored\\n\");\n\t\t\thw->phy.autoneg_advertised = opt.def;\n\t\t} else {\n\t\t\tint tmp = AutoNeg;\n\n\t\t\tpch_gbe_validate_option(&tmp, &opt, adapter);\n\t\t\thw->phy.autoneg_advertised = tmp;\n\t\t}\n\t}\n\n\tswitch (speed + dplx) {\n\tcase 0:\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 1;\n\t\tif ((speed || dplx))\n\t\t\tnetdev_dbg(adapter->netdev,\n\t\t\t\t   \"Speed and duplex autonegotiation enabled\\n\");\n\t\thw->mac.link_speed = SPEED_10;\n\t\thw->mac.link_duplex = DUPLEX_HALF;\n\t\tbreak;\n\tcase HALF_DUPLEX:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Half Duplex specified without Speed\\n\");\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Using Autonegotiation at Half Duplex only\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 1;\n\t\thw->phy.autoneg_advertised = PHY_ADVERTISE_10_HALF |\n\t\t\t\t\t\tPHY_ADVERTISE_100_HALF;\n\t\thw->mac.link_speed = SPEED_10;\n\t\thw->mac.link_duplex = DUPLEX_HALF;\n\t\tbreak;\n\tcase FULL_DUPLEX:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Full Duplex specified without Speed\\n\");\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Using Autonegotiation at Full Duplex only\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 1;\n\t\thw->phy.autoneg_advertised = PHY_ADVERTISE_10_FULL |\n\t\t\t\t\t\tPHY_ADVERTISE_100_FULL |\n\t\t\t\t\t\tPHY_ADVERTISE_1000_FULL;\n\t\thw->mac.link_speed = SPEED_10;\n\t\thw->mac.link_duplex = DUPLEX_FULL;\n\t\tbreak;\n\tcase SPEED_10:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"10 Mbps Speed specified without Duplex\\n\");\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Using Autonegotiation at 10 Mbps only\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 1;\n\t\thw->phy.autoneg_advertised = PHY_ADVERTISE_10_HALF |\n\t\t\t\t\t\tPHY_ADVERTISE_10_FULL;\n\t\thw->mac.link_speed = SPEED_10;\n\t\thw->mac.link_duplex = DUPLEX_HALF;\n\t\tbreak;\n\tcase SPEED_10 + HALF_DUPLEX:\n\t\tnetdev_dbg(adapter->netdev, \"Forcing to 10 Mbps Half Duplex\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 0;\n\t\thw->phy.autoneg_advertised = 0;\n\t\thw->mac.link_speed = SPEED_10;\n\t\thw->mac.link_duplex = DUPLEX_HALF;\n\t\tbreak;\n\tcase SPEED_10 + FULL_DUPLEX:\n\t\tnetdev_dbg(adapter->netdev, \"Forcing to 10 Mbps Full Duplex\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 0;\n\t\thw->phy.autoneg_advertised = 0;\n\t\thw->mac.link_speed = SPEED_10;\n\t\thw->mac.link_duplex = DUPLEX_FULL;\n\t\tbreak;\n\tcase SPEED_100:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"100 Mbps Speed specified without Duplex\\n\");\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Using Autonegotiation at 100 Mbps only\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 1;\n\t\thw->phy.autoneg_advertised = PHY_ADVERTISE_100_HALF |\n\t\t\t\t\t\tPHY_ADVERTISE_100_FULL;\n\t\thw->mac.link_speed = SPEED_100;\n\t\thw->mac.link_duplex = DUPLEX_HALF;\n\t\tbreak;\n\tcase SPEED_100 + HALF_DUPLEX:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Forcing to 100 Mbps Half Duplex\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 0;\n\t\thw->phy.autoneg_advertised = 0;\n\t\thw->mac.link_speed = SPEED_100;\n\t\thw->mac.link_duplex = DUPLEX_HALF;\n\t\tbreak;\n\tcase SPEED_100 + FULL_DUPLEX:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Forcing to 100 Mbps Full Duplex\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 0;\n\t\thw->phy.autoneg_advertised = 0;\n\t\thw->mac.link_speed = SPEED_100;\n\t\thw->mac.link_duplex = DUPLEX_FULL;\n\t\tbreak;\n\tcase SPEED_1000:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"1000 Mbps Speed specified without Duplex\\n\");\n\t\tgoto full_duplex_only;\n\tcase SPEED_1000 + HALF_DUPLEX:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Half Duplex is not supported at 1000 Mbps\\n\");\n\t\tfallthrough;\n\tcase SPEED_1000 + FULL_DUPLEX:\nfull_duplex_only:\n\t\tnetdev_dbg(adapter->netdev,\n\t\t\t   \"Using Autonegotiation at 1000 Mbps Full Duplex only\\n\");\n\t\thw->mac.autoneg = hw->mac.fc_autoneg = 1;\n\t\thw->phy.autoneg_advertised = PHY_ADVERTISE_1000_FULL;\n\t\thw->mac.link_speed = SPEED_1000;\n\t\thw->mac.link_duplex = DUPLEX_FULL;\n\t\tbreak;\n\tdefault:\n\t\tBUG();\n\t}\n}\n\n \nvoid pch_gbe_check_options(struct pch_gbe_adapter *adapter)\n{\n\tstruct pch_gbe_hw *hw = &adapter->hw;\n\tstruct net_device *dev = adapter->netdev;\n\tint val;\n\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = range_option,\n\t\t\t.name = \"Transmit Descriptors\",\n\t\t\t.err  = \"using default of \"\n\t\t\t\t__MODULE_STRING(PCH_GBE_DEFAULT_TXD),\n\t\t\t.def  = PCH_GBE_DEFAULT_TXD,\n\t\t\t.arg  = { .r = { .min = PCH_GBE_MIN_TXD,\n\t\t\t\t\t .max = PCH_GBE_MAX_TXD } }\n\t\t};\n\t\tstruct pch_gbe_tx_ring *tx_ring = adapter->tx_ring;\n\t\ttx_ring->count = TxDescriptors;\n\t\tpch_gbe_validate_option(&tx_ring->count, &opt, adapter);\n\t\ttx_ring->count = roundup(tx_ring->count,\n\t\t\t\t\tPCH_GBE_TX_DESC_MULTIPLE);\n\t}\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = range_option,\n\t\t\t.name = \"Receive Descriptors\",\n\t\t\t.err  = \"using default of \"\n\t\t\t\t__MODULE_STRING(PCH_GBE_DEFAULT_RXD),\n\t\t\t.def  = PCH_GBE_DEFAULT_RXD,\n\t\t\t.arg  = { .r = { .min = PCH_GBE_MIN_RXD,\n\t\t\t\t\t .max = PCH_GBE_MAX_RXD } }\n\t\t};\n\t\tstruct pch_gbe_rx_ring *rx_ring = adapter->rx_ring;\n\t\trx_ring->count = RxDescriptors;\n\t\tpch_gbe_validate_option(&rx_ring->count, &opt, adapter);\n\t\trx_ring->count = roundup(rx_ring->count,\n\t\t\t\tPCH_GBE_RX_DESC_MULTIPLE);\n\t}\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = enable_option,\n\t\t\t.name = \"Checksum Offload\",\n\t\t\t.err  = \"defaulting to Enabled\",\n\t\t\t.def  = PCH_GBE_DEFAULT_RX_CSUM\n\t\t};\n\t\tval = XsumRX;\n\t\tpch_gbe_validate_option(&val, &opt, adapter);\n\t\tif (!val)\n\t\t\tdev->features &= ~NETIF_F_RXCSUM;\n\t}\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = enable_option,\n\t\t\t.name = \"Checksum Offload\",\n\t\t\t.err  = \"defaulting to Enabled\",\n\t\t\t.def  = PCH_GBE_DEFAULT_TX_CSUM\n\t\t};\n\t\tval = XsumTX;\n\t\tpch_gbe_validate_option(&val, &opt, adapter);\n\t\tif (!val)\n\t\t\tdev->features &= ~NETIF_F_CSUM_MASK;\n\t}\n\t{  \n\t\tstatic const struct pch_gbe_option opt = {\n\t\t\t.type = list_option,\n\t\t\t.name = \"Flow Control\",\n\t\t\t.err  = \"reading default settings from EEPROM\",\n\t\t\t.def  = PCH_GBE_FC_DEFAULT,\n\t\t\t.arg  = { .l = { .nr = (int)ARRAY_SIZE(fc_list),\n\t\t\t\t\t .p = fc_list } }\n\t\t};\n\t\tint tmp = FlowControl;\n\n\t\tpch_gbe_validate_option(&tmp, &opt, adapter);\n\t\thw->mac.fc = tmp;\n\t}\n\n\tpch_gbe_check_copper_options(adapter);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}