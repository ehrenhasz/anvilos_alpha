{
  "module_name": "mal.h",
  "hash_id": "384d340570b80785e1fce2a9dd671a4de7ccfe936224487d4350889061331dbb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ibm/emac/mal.h",
  "human_readable_source": " \n \n#ifndef __IBM_NEWEMAC_MAL_H\n#define __IBM_NEWEMAC_MAL_H\n\n \n\n \n#define\tMAL_CFG\t\t\t0x00\n#define\t  MAL_CFG_SR\t\t0x80000000\n#define   MAL_CFG_PLBB\t\t0x00004000\n#define   MAL_CFG_OPBBL\t\t0x00000080\n#define   MAL_CFG_EOPIE\t\t0x00000004\n#define   MAL_CFG_LEA\t\t0x00000002\n#define   MAL_CFG_SD\t\t0x00000001\n\n \n#define   MAL1_CFG_PLBP_MASK\t0x00c00000\n#define   MAL1_CFG_PLBP_10\t0x00800000\n#define   MAL1_CFG_GA\t\t0x00200000\n#define   MAL1_CFG_OA\t\t0x00100000\n#define   MAL1_CFG_PLBLE\t0x00080000\n#define   MAL1_CFG_PLBT_MASK\t0x00078000\n#define   MAL1_CFG_DEFAULT\t(MAL1_CFG_PLBP_10 | MAL1_CFG_PLBT_MASK)\n\n \n#define   MAL2_CFG_RPP_MASK\t0x00c00000\n#define   MAL2_CFG_RPP_10\t0x00800000\n#define   MAL2_CFG_RMBS_MASK\t0x00300000\n#define   MAL2_CFG_WPP_MASK\t0x000c0000\n#define   MAL2_CFG_WPP_10\t0x00080000\n#define   MAL2_CFG_WMBS_MASK\t0x00030000\n#define   MAL2_CFG_PLBLE\t0x00008000\n#define   MAL2_CFG_DEFAULT\t(MAL2_CFG_RMBS_MASK | MAL2_CFG_WMBS_MASK | \\\n\t\t\t\t MAL2_CFG_RPP_10 | MAL2_CFG_WPP_10)\n\n#define MAL_ESR\t\t\t0x01\n#define   MAL_ESR_EVB\t\t0x80000000\n#define   MAL_ESR_CIDT\t\t0x40000000\n#define   MAL_ESR_CID_MASK\t0x3e000000\n#define   MAL_ESR_CID_SHIFT\t25\n#define   MAL_ESR_DE\t\t0x00100000\n#define   MAL_ESR_OTE\t\t0x00040000\n#define   MAL_ESR_OSE\t\t0x00020000\n#define   MAL_ESR_PEIN\t\t0x00010000\n#define   MAL_ESR_DEI\t\t0x00000010\n#define   MAL_ESR_OTEI\t\t0x00000004\n#define   MAL_ESR_OSEI\t\t0x00000002\n#define   MAL_ESR_PBEI\t\t0x00000001\n\n \n#define   MAL1_ESR_ONE\t\t0x00080000\n#define   MAL1_ESR_ONEI\t\t0x00000008\n\n \n#define   MAL2_ESR_PTE\t\t0x00800000\n#define   MAL2_ESR_PRE\t\t0x00400000\n#define   MAL2_ESR_PWE\t\t0x00200000\n#define   MAL2_ESR_PTEI\t\t0x00000080\n#define   MAL2_ESR_PREI\t\t0x00000040\n#define   MAL2_ESR_PWEI\t\t0x00000020\n\n\n#define MAL_IER\t\t\t0x02\n \n#define   MAL_IER_DE\t\t0x00000010\n#define   MAL_IER_OTE\t\t0x00000004\n#define   MAL_IER_OE\t\t0x00000002\n#define   MAL_IER_PE\t\t0x00000001\n\n \n#define   MAL_IER_PTE\t\t0x00000080\n#define   MAL_IER_PRE\t\t0x00000040\n#define   MAL_IER_PWE\t\t0x00000020\n\n#define   MAL_IER_SOC_EVENTS\t(MAL_IER_PTE | MAL_IER_PRE | MAL_IER_PWE)\n#define   MAL_IER_EVENTS\t(MAL_IER_SOC_EVENTS | MAL_IER_DE | \\\n\t\t\t\t MAL_IER_OTE | MAL_IER_OE | MAL_IER_PE)\n\n#define MAL_TXCASR\t\t0x04\n#define MAL_TXCARR\t\t0x05\n#define MAL_TXEOBISR\t\t0x06\n#define MAL_TXDEIR\t\t0x07\n#define MAL_RXCASR\t\t0x10\n#define MAL_RXCARR\t\t0x11\n#define MAL_RXEOBISR\t\t0x12\n#define MAL_RXDEIR\t\t0x13\n#define MAL_TXCTPR(n)\t\t((n) + 0x20)\n#define MAL_RXCTPR(n)\t\t((n) + 0x40)\n#define MAL_RCBS(n)\t\t((n) + 0x60)\n\n \n#define MAL_MAX_TX_SIZE\t\t4080\n#define MAL_MAX_RX_SIZE\t\t4080\n\nstatic inline int mal_rx_size(int len)\n{\n\tlen = (len + 0xf) & ~0xf;\n\treturn len > MAL_MAX_RX_SIZE ? MAL_MAX_RX_SIZE : len;\n}\n\nstatic inline int mal_tx_chunks(int len)\n{\n\treturn DIV_ROUND_UP(len, MAL_MAX_TX_SIZE);\n}\n\n#define MAL_CHAN_MASK(n)\t(0x80000000 >> (n))\n\n \nstruct mal_descriptor {\n\tu16 ctrl;\t\t \n\tu16 data_len;\t\t \n\tu32 data_ptr;\t\t \n};\n\n \n \n#define MAL_RX_CTRL_EMPTY\t0x8000\n#define MAL_RX_CTRL_WRAP\t0x4000\n#define MAL_RX_CTRL_CM\t\t0x2000\n#define MAL_RX_CTRL_LAST\t0x1000\n#define MAL_RX_CTRL_FIRST\t0x0800\n#define MAL_RX_CTRL_INTR\t0x0400\n#define MAL_RX_CTRL_SINGLE\t(MAL_RX_CTRL_LAST | MAL_RX_CTRL_FIRST)\n#define MAL_IS_SINGLE_RX(ctrl)\t(((ctrl) & MAL_RX_CTRL_SINGLE) == MAL_RX_CTRL_SINGLE)\n\n#define MAL_TX_CTRL_READY\t0x8000\n#define MAL_TX_CTRL_WRAP\t0x4000\n#define MAL_TX_CTRL_CM\t\t0x2000\n#define MAL_TX_CTRL_LAST\t0x1000\n#define MAL_TX_CTRL_INTR\t0x0400\n\nstruct mal_commac_ops {\n\tvoid\t(*poll_tx) (void *dev);\n\tint\t(*poll_rx) (void *dev, int budget);\n\tint\t(*peek_rx) (void *dev);\n\tvoid\t(*rxde) (void *dev);\n};\n\nstruct mal_commac {\n\tstruct mal_commac_ops\t*ops;\n\tvoid\t\t\t*dev;\n\tstruct list_head\tpoll_list;\n\tlong       \t\tflags;\n#define MAL_COMMAC_RX_STOPPED\t\t0\n#define MAL_COMMAC_POLL_DISABLED\t1\n\tu32\t\t\ttx_chan_mask;\n\tu32\t\t\trx_chan_mask;\n\tstruct list_head\tlist;\n};\n\nstruct mal_instance {\n\tint\t\t\tversion;\n\tdcr_host_t\t\tdcr_host;\n\n\tint\t\t\tnum_tx_chans;\t \n\tint\t\t\tnum_rx_chans;\t \n\tint \t\t\ttxeob_irq;\t \n\tint \t\t\trxeob_irq;\t \n\tint\t\t\ttxde_irq;\t \n\tint\t\t\trxde_irq;\t \n\tint\t\t\tserr_irq;\t \n\n\tstruct list_head\tpoll_list;\n\tstruct napi_struct\tnapi;\n\n\tstruct list_head\tlist;\n\tu32\t\t\ttx_chan_mask;\n\tu32\t\t\trx_chan_mask;\n\n\tdma_addr_t\t\tbd_dma;\n\tstruct mal_descriptor\t*bd_virt;\n\n\tstruct platform_device\t*ofdev;\n\tint\t\t\tindex;\n\tspinlock_t\t\tlock;\n\n\tstruct net_device\tdummy_dev;\n\n\tunsigned int features;\n};\n\nstatic inline u32 get_mal_dcrn(struct mal_instance *mal, int reg)\n{\n\treturn dcr_read(mal->dcr_host, reg);\n}\n\nstatic inline void set_mal_dcrn(struct mal_instance *mal, int reg, u32 val)\n{\n\tdcr_write(mal->dcr_host, reg, val);\n}\n\n \n\n \n#define MAL_FTR_CLEAR_ICINTSTAT\t0x00000001\n\n \n#define MAL_FTR_COMMON_ERR_INT\t0x00000002\n\nenum {\n\tMAL_FTRS_ALWAYS = 0,\n\n\tMAL_FTRS_POSSIBLE =\n#ifdef CONFIG_IBM_EMAC_MAL_CLR_ICINTSTAT\n\t\tMAL_FTR_CLEAR_ICINTSTAT |\n#endif\n#ifdef CONFIG_IBM_EMAC_MAL_COMMON_ERR\n\t\tMAL_FTR_COMMON_ERR_INT |\n#endif\n\t\t0,\n};\n\nstatic inline int mal_has_feature(struct mal_instance *dev,\n\t\tunsigned long feature)\n{\n\treturn (MAL_FTRS_ALWAYS & feature) ||\n\t\t(MAL_FTRS_POSSIBLE & dev->features & feature);\n}\n\n \nint mal_init(void);\nvoid mal_exit(void);\n\nint mal_register_commac(struct mal_instance *mal,\n\t\t\tstruct mal_commac *commac);\nvoid mal_unregister_commac(struct mal_instance *mal,\n\t\t\t   struct mal_commac *commac);\nint mal_set_rcbs(struct mal_instance *mal, int channel, unsigned long size);\n\n \nint mal_tx_bd_offset(struct mal_instance *mal, int channel);\nint mal_rx_bd_offset(struct mal_instance *mal, int channel);\n\nvoid mal_enable_tx_channel(struct mal_instance *mal, int channel);\nvoid mal_disable_tx_channel(struct mal_instance *mal, int channel);\nvoid mal_enable_rx_channel(struct mal_instance *mal, int channel);\nvoid mal_disable_rx_channel(struct mal_instance *mal, int channel);\n\nvoid mal_poll_disable(struct mal_instance *mal, struct mal_commac *commac);\nvoid mal_poll_enable(struct mal_instance *mal, struct mal_commac *commac);\n\n \nvoid mal_poll_add(struct mal_instance *mal, struct mal_commac *commac);\nvoid mal_poll_del(struct mal_instance *mal, struct mal_commac *commac);\n\n \nstruct mal_regs {\n\tu32 tx_count;\n\tu32 rx_count;\n\n\tu32 cfg;\n\tu32 esr;\n\tu32 ier;\n\tu32 tx_casr;\n\tu32 tx_carr;\n\tu32 tx_eobisr;\n\tu32 tx_deir;\n\tu32 rx_casr;\n\tu32 rx_carr;\n\tu32 rx_eobisr;\n\tu32 rx_deir;\n\tu32 tx_ctpr[32];\n\tu32 rx_ctpr[32];\n\tu32 rcbs[32];\n};\n\nint mal_get_regs_len(struct mal_instance *mal);\nvoid *mal_dump_regs(struct mal_instance *mal, void *buf);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}