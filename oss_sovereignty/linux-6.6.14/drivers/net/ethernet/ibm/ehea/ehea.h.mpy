{
  "module_name": "ehea.h",
  "hash_id": "ffdeab7e661463057507bd583656edfc583635d3eeae9a25a19d490b54255ae0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/ibm/ehea/ehea.h",
  "human_readable_source": " \n \n\n#ifndef __EHEA_H__\n#define __EHEA_H__\n\n#include <linux/module.h>\n#include <linux/ethtool.h>\n#include <linux/vmalloc.h>\n#include <linux/if_vlan.h>\n#include <linux/platform_device.h>\n\n#include <asm/ibmebus.h>\n#include <asm/io.h>\n\n#define DRV_NAME\t\"ehea\"\n#define DRV_VERSION\t\"EHEA_0107\"\n\n \n#define DLPAR_PORT_ADD_REM 1\n#define DLPAR_MEM_ADD      2\n#define DLPAR_MEM_REM      4\n#define EHEA_CAPABILITIES  (DLPAR_PORT_ADD_REM | DLPAR_MEM_ADD | DLPAR_MEM_REM)\n\n#define EHEA_MSG_DEFAULT (NETIF_MSG_LINK | NETIF_MSG_TIMER \\\n\t| NETIF_MSG_RX_ERR | NETIF_MSG_TX_ERR)\n\n#define EHEA_MAX_ENTRIES_RQ1 32767\n#define EHEA_MAX_ENTRIES_RQ2 16383\n#define EHEA_MAX_ENTRIES_RQ3 16383\n#define EHEA_MAX_ENTRIES_SQ  32767\n#define EHEA_MIN_ENTRIES_QP  127\n\n#define EHEA_SMALL_QUEUES\n\n#ifdef EHEA_SMALL_QUEUES\n#define EHEA_MAX_CQE_COUNT      1023\n#define EHEA_DEF_ENTRIES_SQ     1023\n#define EHEA_DEF_ENTRIES_RQ1    1023\n#define EHEA_DEF_ENTRIES_RQ2    1023\n#define EHEA_DEF_ENTRIES_RQ3    511\n#else\n#define EHEA_MAX_CQE_COUNT      4080\n#define EHEA_DEF_ENTRIES_SQ     4080\n#define EHEA_DEF_ENTRIES_RQ1    8160\n#define EHEA_DEF_ENTRIES_RQ2    2040\n#define EHEA_DEF_ENTRIES_RQ3    2040\n#endif\n\n#define EHEA_MAX_ENTRIES_EQ 20\n\n#define EHEA_SG_SQ  2\n#define EHEA_SG_RQ1 1\n#define EHEA_SG_RQ2 0\n#define EHEA_SG_RQ3 0\n\n#define EHEA_MAX_PACKET_SIZE    9022\t \n#define EHEA_RQ2_PKT_SIZE       2048\n#define EHEA_L_PKT_SIZE         256\t \n\n \n\n \n#define EHEA_PD_ID        0xaabcdeff\n\n#define EHEA_RQ2_THRESHOLD \t   1\n#define EHEA_RQ3_THRESHOLD\t   4\t \n\n#define EHEA_SPEED_10G         10000\n#define EHEA_SPEED_1G           1000\n#define EHEA_SPEED_100M          100\n#define EHEA_SPEED_10M            10\n#define EHEA_SPEED_AUTONEG         0\n\n \n#define EHEA_BCMC_SCOPE_ALL\t0x08\n#define EHEA_BCMC_SCOPE_SINGLE\t0x00\n#define EHEA_BCMC_MULTICAST\t0x04\n#define EHEA_BCMC_BROADCAST\t0x00\n#define EHEA_BCMC_UNTAGGED\t0x02\n#define EHEA_BCMC_TAGGED\t0x00\n#define EHEA_BCMC_VLANID_ALL\t0x01\n#define EHEA_BCMC_VLANID_SINGLE\t0x00\n\n#define EHEA_CACHE_LINE          128\n\n \n#define EHEA_MR_ACC_CTRL       0x00800000\n\n#define EHEA_BUSMAP_START      0x8000000000000000ULL\n#define EHEA_INVAL_ADDR        0xFFFFFFFFFFFFFFFFULL\n#define EHEA_DIR_INDEX_SHIFT 13                    \n#define EHEA_TOP_INDEX_SHIFT (EHEA_DIR_INDEX_SHIFT * 2)\n#define EHEA_MAP_ENTRIES (1 << EHEA_DIR_INDEX_SHIFT)\n#define EHEA_MAP_SIZE (0x10000)                    \n#define EHEA_INDEX_MASK (EHEA_MAP_ENTRIES - 1)\n\n\n#define EHEA_WATCH_DOG_TIMEOUT 10*HZ\n\n \n\nvoid ehea_dump(void *adr, int len, char *msg);\n\n#define EHEA_BMASK(pos, length) (((pos) << 16) + (length))\n\n#define EHEA_BMASK_IBM(from, to) (((63 - to) << 16) + ((to) - (from) + 1))\n\n#define EHEA_BMASK_SHIFTPOS(mask) (((mask) >> 16) & 0xffff)\n\n#define EHEA_BMASK_MASK(mask) \\\n\t(0xffffffffffffffffULL >> ((64 - (mask)) & 0xffff))\n\n#define EHEA_BMASK_SET(mask, value) \\\n\t((EHEA_BMASK_MASK(mask) & ((u64)(value))) << EHEA_BMASK_SHIFTPOS(mask))\n\n#define EHEA_BMASK_GET(mask, value) \\\n\t(EHEA_BMASK_MASK(mask) & (((u64)(value)) >> EHEA_BMASK_SHIFTPOS(mask)))\n\n \nstruct ehea_page {\n\tu8 entries[PAGE_SIZE];\n};\n\n \nstruct hw_queue {\n\tu64 current_q_offset;\t\t \n\tstruct ehea_page **queue_pages;\t \n\tu32 qe_size;\t\t\t \n\tu32 queue_length;      \t\t \n\tu32 pagesize;\n\tu32 toggle_state;\t\t \n\tu32 reserved;\t\t\t \n};\n\n \nstruct h_epa {\n\tvoid __iomem *addr;\n};\n\nstruct h_epa_user {\n\tu64 addr;\n};\n\nstruct h_epas {\n\tstruct h_epa kernel;\t \n\tstruct h_epa_user user;\t \n};\n\n \nstruct ehea_dir_bmap\n{\n\tu64 ent[EHEA_MAP_ENTRIES];\n};\nstruct ehea_top_bmap\n{\n\tstruct ehea_dir_bmap *dir[EHEA_MAP_ENTRIES];\n};\nstruct ehea_bmap\n{\n\tstruct ehea_top_bmap *top[EHEA_MAP_ENTRIES];\n};\n\nstruct ehea_qp;\nstruct ehea_cq;\nstruct ehea_eq;\nstruct ehea_port;\nstruct ehea_av;\n\n \nstruct ehea_qp_init_attr {\n\t \n\tu32 qp_token;            \n\tu8 low_lat_rq1;\n\tu8 signalingtype;        \n\tu8 rq_count;             \n\tu8 eqe_gen;              \n\tu16 max_nr_send_wqes;    \n\tu16 max_nr_rwqes_rq1;    \n\tu16 max_nr_rwqes_rq2;\n\tu16 max_nr_rwqes_rq3;\n\tu8 wqe_size_enc_sq;\n\tu8 wqe_size_enc_rq1;\n\tu8 wqe_size_enc_rq2;\n\tu8 wqe_size_enc_rq3;\n\tu8 swqe_imm_data_len;    \n\tu16 port_nr;\n\tu16 rq2_threshold;\n\tu16 rq3_threshold;\n\tu64 send_cq_handle;\n\tu64 recv_cq_handle;\n\tu64 aff_eq_handle;\n\n\t \n\tu32 qp_nr;\n\tu16 act_nr_send_wqes;\n\tu16 act_nr_rwqes_rq1;\n\tu16 act_nr_rwqes_rq2;\n\tu16 act_nr_rwqes_rq3;\n\tu8 act_wqe_size_enc_sq;\n\tu8 act_wqe_size_enc_rq1;\n\tu8 act_wqe_size_enc_rq2;\n\tu8 act_wqe_size_enc_rq3;\n\tu32 nr_sq_pages;\n\tu32 nr_rq1_pages;\n\tu32 nr_rq2_pages;\n\tu32 nr_rq3_pages;\n\tu32 liobn_sq;\n\tu32 liobn_rq1;\n\tu32 liobn_rq2;\n\tu32 liobn_rq3;\n};\n\n \nstruct ehea_eq_attr {\n\tu32 type;\n\tu32 max_nr_of_eqes;\n\tu8 eqe_gen;         \n\tu64 eq_handle;\n\tu32 act_nr_of_eqes;\n\tu32 nr_pages;\n\tu32 ist1;           \n\tu32 ist2;\n\tu32 ist3;\n\tu32 ist4;\n};\n\n\n \nstruct ehea_eq {\n\tstruct ehea_adapter *adapter;\n\tstruct hw_queue hw_queue;\n\tu64 fw_handle;\n\tstruct h_epas epas;\n\tspinlock_t spinlock;\n\tstruct ehea_eq_attr attr;\n};\n\n \nstruct ehea_qp {\n\tstruct ehea_adapter *adapter;\n\tu64 fw_handle;\t\t\t \n\tstruct hw_queue hw_squeue;\n\tstruct hw_queue hw_rqueue1;\n\tstruct hw_queue hw_rqueue2;\n\tstruct hw_queue hw_rqueue3;\n\tstruct h_epas epas;\n\tstruct ehea_qp_init_attr init_attr;\n};\n\n \nstruct ehea_cq_attr {\n\t \n\tu32 max_nr_of_cqes;\n\tu32 cq_token;\n\tu64 eq_handle;\n\n\t \n\tu32 act_nr_of_cqes;\n\tu32 nr_pages;\n};\n\n \nstruct ehea_cq {\n\tstruct ehea_adapter *adapter;\n\tu64 fw_handle;\n\tstruct hw_queue hw_queue;\n\tstruct h_epas epas;\n\tstruct ehea_cq_attr attr;\n};\n\n \nstruct ehea_mr {\n\tstruct ehea_adapter *adapter;\n\tu64 handle;\n\tu64 vaddr;\n\tu32 lkey;\n};\n\n \nstruct port_stats {\n\tint poll_receive_errors;\n\tint queue_stopped;\n\tint err_tcp_cksum;\n\tint err_ip_cksum;\n\tint err_frame_crc;\n};\n\n#define EHEA_IRQ_NAME_SIZE 20\n\n \nstruct ehea_q_skb_arr {\n\tstruct sk_buff **arr;\t\t \n\tint len;                \t \n\tint index;\t\t\t \n\tint os_skbs;\t\t\t \n};\n\n \nstruct ehea_port_res {\n\tstruct napi_struct napi;\n\tstruct port_stats p_stats;\n\tstruct ehea_mr send_mr;       \t \n\tstruct ehea_mr recv_mr;       \t \n\tstruct ehea_port *port;\n\tchar int_recv_name[EHEA_IRQ_NAME_SIZE];\n\tchar int_send_name[EHEA_IRQ_NAME_SIZE];\n\tstruct ehea_qp *qp;\n\tstruct ehea_cq *send_cq;\n\tstruct ehea_cq *recv_cq;\n\tstruct ehea_eq *eq;\n\tstruct ehea_q_skb_arr rq1_skba;\n\tstruct ehea_q_skb_arr rq2_skba;\n\tstruct ehea_q_skb_arr rq3_skba;\n\tstruct ehea_q_skb_arr sq_skba;\n\tint sq_skba_size;\n\tint swqe_refill_th;\n\tatomic_t swqe_avail;\n\tint swqe_ll_count;\n\tu32 swqe_id_counter;\n\tu64 tx_packets;\n\tu64 tx_bytes;\n\tu64 rx_packets;\n\tu64 rx_bytes;\n\tint sq_restart_flag;\n};\n\n\n#define EHEA_MAX_PORTS 16\n\n#define EHEA_NUM_PORTRES_FW_HANDLES    6   \n#define EHEA_NUM_PORT_FW_HANDLES       1   \n#define EHEA_NUM_ADAPTER_FW_HANDLES    2   \n\nstruct ehea_adapter {\n\tu64 handle;\n\tstruct platform_device *ofdev;\n\tstruct ehea_port *port[EHEA_MAX_PORTS];\n\tstruct ehea_eq *neq;        \n\tstruct tasklet_struct neq_tasklet;\n\tstruct ehea_mr mr;\n\tu32 pd;                     \n\tu64 max_mc_mac;             \n\tint active_ports;\n\tstruct list_head list;\n};\n\n\nstruct ehea_mc_list {\n\tstruct list_head list;\n\tu64 macaddr;\n};\n\n \nstruct ehea_fw_handle_entry {\n\tu64 adh;                \n\tu64 fwh;                \n};\n\nstruct ehea_fw_handle_array {\n\tstruct ehea_fw_handle_entry *arr;\n\tint num_entries;\n\tstruct mutex lock;\n};\n\nstruct ehea_bcmc_reg_entry {\n\tu64 adh;                \n\tu32 port_id;            \n\tu8 reg_type;            \n\tu64 macaddr;\n};\n\nstruct ehea_bcmc_reg_array {\n\tstruct ehea_bcmc_reg_entry *arr;\n\tint num_entries;\n\tspinlock_t lock;\n};\n\n#define EHEA_PORT_UP 1\n#define EHEA_PORT_DOWN 0\n#define EHEA_PHY_LINK_UP 1\n#define EHEA_PHY_LINK_DOWN 0\n#define EHEA_MAX_PORT_RES 16\nstruct ehea_port {\n\tstruct ehea_adapter *adapter;\t  \n\tstruct net_device *netdev;\n\tstruct rtnl_link_stats64 stats;\n\tstruct ehea_port_res port_res[EHEA_MAX_PORT_RES];\n\tstruct platform_device  ofdev;  \n\tstruct ehea_mc_list *mc_list;\t  \n\tstruct ehea_eq *qp_eq;\n\tstruct work_struct reset_task;\n\tstruct delayed_work stats_work;\n\tstruct mutex port_lock;\n\tchar int_aff_name[EHEA_IRQ_NAME_SIZE];\n\tint allmulti;\t\t\t  \n\tint promisc;\t\t \t  \n\tint num_mcs;\n\tint resets;\n\tunsigned long flags;\n\tu64 mac_addr;\n\tu32 logical_port_id;\n\tu32 port_speed;\n\tu32 msg_enable;\n\tu32 sig_comp_iv;\n\tu32 state;\n\tu8 phy_link;\n\tu8 full_duplex;\n\tu8 autoneg;\n\tu8 num_def_qps;\n\twait_queue_head_t swqe_avail_wq;\n\twait_queue_head_t restart_wq;\n};\n\nstruct port_res_cfg {\n\tint max_entries_rcq;\n\tint max_entries_scq;\n\tint max_entries_sq;\n\tint max_entries_rq1;\n\tint max_entries_rq2;\n\tint max_entries_rq3;\n};\n\nenum ehea_flag_bits {\n\t__EHEA_STOP_XFER,\n\t__EHEA_DISABLE_PORT_RESET\n};\n\nvoid ehea_set_ethtool_ops(struct net_device *netdev);\nint ehea_sense_port_attr(struct ehea_port *port);\nint ehea_set_portspeed(struct ehea_port *port, u32 port_speed);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}