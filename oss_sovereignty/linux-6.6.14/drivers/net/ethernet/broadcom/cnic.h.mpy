{
  "module_name": "cnic.h",
  "hash_id": "1ebd28598dd718336f365de586b9b5ce6f178e83bb1f126c60da17cce23c8961",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/broadcom/cnic.h",
  "human_readable_source": " \n\n\n#ifndef CNIC_H\n#define CNIC_H\n\n#define HC_INDEX_ISCSI_EQ_CONS\t\t\t6\n\n#define HC_INDEX_FCOE_EQ_CONS\t\t\t3\n\n#define HC_SP_INDEX_ETH_ISCSI_CQ_CONS\t\t5\n#define HC_SP_INDEX_ETH_ISCSI_RX_CQ_CONS\t1\n\n#define KWQ_PAGE_CNT\t4\n#define KCQ_PAGE_CNT\t16\n\n#define KWQ_CID \t\t24\n#define KCQ_CID \t\t25\n\n \n#define L5_KRNLQ_FLAGS\t0x00000000\n#define L5_KRNLQ_SIZE\t0x00000000\n#define L5_KRNLQ_TYPE\t0x00000000\n#define KRNLQ_FLAGS_PG_SZ\t\t\t\t\t(0xf<<0)\n#define KRNLQ_FLAGS_PG_SZ_256\t\t\t\t\t(0<<0)\n#define KRNLQ_FLAGS_PG_SZ_512\t\t\t\t\t(1<<0)\n#define KRNLQ_FLAGS_PG_SZ_1K\t\t\t\t\t(2<<0)\n#define KRNLQ_FLAGS_PG_SZ_2K\t\t\t\t\t(3<<0)\n#define KRNLQ_FLAGS_PG_SZ_4K\t\t\t\t\t(4<<0)\n#define KRNLQ_FLAGS_PG_SZ_8K\t\t\t\t\t(5<<0)\n#define KRNLQ_FLAGS_PG_SZ_16K\t\t\t\t\t(6<<0)\n#define KRNLQ_FLAGS_PG_SZ_32K\t\t\t\t\t(7<<0)\n#define KRNLQ_FLAGS_PG_SZ_64K\t\t\t\t\t(8<<0)\n#define KRNLQ_FLAGS_PG_SZ_128K\t\t\t\t\t(9<<0)\n#define KRNLQ_FLAGS_PG_SZ_256K\t\t\t\t\t(10<<0)\n#define KRNLQ_FLAGS_PG_SZ_512K\t\t\t\t\t(11<<0)\n#define KRNLQ_FLAGS_PG_SZ_1M\t\t\t\t\t(12<<0)\n#define KRNLQ_FLAGS_PG_SZ_2M\t\t\t\t\t(13<<0)\n#define KRNLQ_FLAGS_QE_SELF_SEQ\t\t\t\t\t(1<<15)\n#define KRNLQ_SIZE_TYPE_SIZE\t((((0x28 + 0x1f) & ~0x1f) / 0x20) << 16)\n#define KRNLQ_TYPE_TYPE\t\t\t\t\t\t(0xf<<28)\n#define KRNLQ_TYPE_TYPE_EMPTY\t\t\t\t\t(0<<28)\n#define KRNLQ_TYPE_TYPE_KRNLQ\t\t\t\t\t(6<<28)\n\n#define L5_KRNLQ_HOST_QIDX\t\t0x00000004\n#define L5_KRNLQ_HOST_FW_QIDX\t\t0x00000008\n#define L5_KRNLQ_NX_QE_SELF_SEQ \t0x0000000c\n#define L5_KRNLQ_QE_SELF_SEQ_MAX\t0x0000000c\n#define L5_KRNLQ_NX_QE_HADDR_HI \t0x00000010\n#define L5_KRNLQ_NX_QE_HADDR_LO \t0x00000014\n#define L5_KRNLQ_PGTBL_PGIDX\t\t0x00000018\n#define L5_KRNLQ_NX_PG_QIDX \t\t0x00000018\n#define L5_KRNLQ_PGTBL_NPAGES\t\t0x0000001c\n#define L5_KRNLQ_QIDX_INCR\t\t0x0000001c\n#define L5_KRNLQ_PGTBL_HADDR_HI \t0x00000020\n#define L5_KRNLQ_PGTBL_HADDR_LO \t0x00000024\n\n#define BNX2_PG_CTX_MAP\t\t\t0x1a0034\n#define BNX2_ISCSI_CTX_MAP\t\t0x1a0074\n\n#define MAX_COMPLETED_KCQE\t64\n\n#define MAX_CNIC_L5_CONTEXT\t256\n\n#define MAX_CM_SK_TBL_SZ\tMAX_CNIC_L5_CONTEXT\n\n#define MAX_ISCSI_TBL_SZ\t256\n\n#define CNIC_LOCAL_PORT_MIN\t60000\n#define CNIC_LOCAL_PORT_MAX\t61024\n#define CNIC_LOCAL_PORT_RANGE\t(CNIC_LOCAL_PORT_MAX - CNIC_LOCAL_PORT_MIN)\n\n#define KWQE_CNT (BNX2_PAGE_SIZE / sizeof(struct kwqe))\n#define KCQE_CNT (BNX2_PAGE_SIZE / sizeof(struct kcqe))\n#define MAX_KWQE_CNT (KWQE_CNT - 1)\n#define MAX_KCQE_CNT (KCQE_CNT - 1)\n\n#define MAX_KWQ_IDX\t((KWQ_PAGE_CNT * KWQE_CNT) - 1)\n#define MAX_KCQ_IDX\t((KCQ_PAGE_CNT * KCQE_CNT) - 1)\n\n#define KWQ_PG(x) (((x) & ~MAX_KWQE_CNT) >> (BNX2_PAGE_BITS - 5))\n#define KWQ_IDX(x) ((x) & MAX_KWQE_CNT)\n\n#define KCQ_PG(x) (((x) & ~MAX_KCQE_CNT) >> (BNX2_PAGE_BITS - 5))\n#define KCQ_IDX(x) ((x) & MAX_KCQE_CNT)\n\n#define BNX2X_NEXT_KCQE(x) (((x) & (MAX_KCQE_CNT - 1)) ==\t\t\\\n\t\t(MAX_KCQE_CNT - 1)) ?\t\t\t\t\t\\\n\t\t(x) + 2 : (x) + 1\n\n#define BNX2X_KWQ_DATA_PG(cp, x) ((x) / (cp)->kwq_16_data_pp)\n#define BNX2X_KWQ_DATA_IDX(cp, x) ((x) % (cp)->kwq_16_data_pp)\n#define BNX2X_KWQ_DATA(cp, x)\t\t\t\t\t\t\\\n\t&(cp)->kwq_16_data[BNX2X_KWQ_DATA_PG(cp, x)][BNX2X_KWQ_DATA_IDX(cp, x)]\n\n#define DEF_IPID_START\t\t0x8000\n\n#define DEF_KA_TIMEOUT\t\t10000\n#define DEF_KA_INTERVAL\t\t300000\n#define DEF_KA_MAX_PROBE_COUNT\t3\n#define DEF_TOS\t\t\t0\n#define DEF_TTL\t\t\t0xfe\n#define DEF_SND_SEQ_SCALE\t0\n#define DEF_RCV_BUF\t\t0xffff\n#define DEF_SND_BUF\t\t0xffff\n#define DEF_SEED\t\t0\n#define DEF_MAX_RT_TIME\t\t500\n#define DEF_MAX_DA_COUNT\t2\n#define DEF_SWS_TIMER\t\t1000\n#define DEF_MAX_CWND\t\t0xffff\n\nstruct cnic_ctx {\n\tu32\t\tcid;\n\tvoid\t\t*ctx;\n\tdma_addr_t\tmapping;\n};\n\n#define BNX2_MAX_CID\t\t0x2000\n\nstruct cnic_dma {\n\tint\t\tnum_pages;\n\tvoid\t\t**pg_arr;\n\tdma_addr_t\t*pg_map_arr;\n\tint\t\tpgtbl_size;\n\tu32\t\t*pgtbl;\n\tdma_addr_t\tpgtbl_map;\n};\n\nstruct cnic_id_tbl {\n\tspinlock_t\tlock;\n\tu32\t\tstart;\n\tu32\t\tmax;\n\tu32\t\tnext;\n\tunsigned long\t*table;\n};\n\n#define CNIC_KWQ16_DATA_SIZE\t128\n\nstruct kwqe_16_data {\n\tu8\tdata[CNIC_KWQ16_DATA_SIZE];\n};\n\nstruct cnic_iscsi {\n\tstruct cnic_dma\t\ttask_array_info;\n\tstruct cnic_dma\t\tr2tq_info;\n\tstruct cnic_dma\t\thq_info;\n};\n\nstruct cnic_context {\n\tu32\t\t\tcid;\n\tstruct kwqe_16_data\t*kwqe_data;\n\tdma_addr_t\t\tkwqe_data_mapping;\n\twait_queue_head_t\twaitq;\n\tint\t\t\twait_cond;\n\tunsigned long\t\ttimestamp;\n\tunsigned long\t\tctx_flags;\n#define\tCTX_FL_OFFLD_START\t0\n#define\tCTX_FL_DELETE_WAIT\t1\n#define\tCTX_FL_CID_ERROR\t2\n\tu8\t\t\tulp_proto_id;\n\tunion {\n\t\tstruct cnic_iscsi\t*iscsi;\n\t} proto;\n};\n\nstruct kcq_info {\n\tstruct cnic_dma\tdma;\n\tstruct kcqe\t**kcq;\n\n\tu16\t\t*hw_prod_idx_ptr;\n\tu16\t\tsw_prod_idx;\n\tu16\t\t*status_idx_ptr;\n\tu32\t\tio_addr;\n\n\tu16\t\t(*next_idx)(u16);\n\tu16\t\t(*hw_idx)(u16);\n};\n\n#define UIO_USE_TX_DOORBELL 0x017855DB\n\nstruct cnic_uio_dev {\n\tstruct uio_info\t\tcnic_uinfo;\n\tu32\t\t\tuio_dev;\n\n\tint\t\t\tl2_ring_size;\n\tvoid\t\t\t*l2_ring;\n\tdma_addr_t\t\tl2_ring_map;\n\n\tint\t\t\tl2_buf_size;\n\tvoid\t\t\t*l2_buf;\n\tdma_addr_t\t\tl2_buf_map;\n\n\tstruct cnic_dev\t\t*dev;\n\tstruct pci_dev\t\t*pdev;\n\tstruct list_head\tlist;\n};\n\nstruct cnic_local {\n\n\tspinlock_t cnic_ulp_lock;\n\tvoid *ulp_handle[MAX_CNIC_ULP_TYPE];\n\tunsigned long ulp_flags[MAX_CNIC_ULP_TYPE];\n#define ULP_F_INIT\t0\n#define ULP_F_START\t1\n#define ULP_F_CALL_PENDING\t2\n\tstruct cnic_ulp_ops __rcu *ulp_ops[MAX_CNIC_ULP_TYPE];\n\n\tunsigned long cnic_local_flags;\n#define\tCNIC_LCL_FL_KWQ_INIT\t\t0x0\n#define\tCNIC_LCL_FL_L2_WAIT\t\t0x1\n#define\tCNIC_LCL_FL_RINGS_INITED\t0x2\n#define\tCNIC_LCL_FL_STOP_ISCSI\t\t0x4\n\n\tstruct cnic_dev *dev;\n\n\tstruct cnic_eth_dev *ethdev;\n\n\tstruct cnic_uio_dev *udev;\n\n\tint\t\tl2_rx_ring_size;\n\tint\t\tl2_single_buf_size;\n\n\tu16\t\t*rx_cons_ptr;\n\tu16\t\t*tx_cons_ptr;\n\tu16\t\trx_cons;\n\tu16\t\ttx_cons;\n\n\tstruct cnic_dma\t\tkwq_info;\n\tstruct kwqe\t\t**kwq;\n\n\tstruct cnic_dma\t\tkwq_16_data_info;\n\n\tu16\t\tmax_kwq_idx;\n\n\tu16\t\tkwq_prod_idx;\n\tu32\t\tkwq_io_addr;\n\n\tu16\t\t*kwq_con_idx_ptr;\n\tu16\t\tkwq_con_idx;\n\n\tstruct kcq_info\tkcq1;\n\tstruct kcq_info\tkcq2;\n\n\tunion {\n\t\tvoid\t\t\t\t*gen;\n\t\tstruct status_block_msix\t*bnx2;\n\t\tstruct host_hc_status_block_e1x\t*bnx2x_e1x;\n\t\t \n\t\t#define SM_RX_ID\t\t0\n\t\t#define SM_TX_ID\t\t1\n\t} status_blk;\n\n\tstruct host_sp_status_block\t*bnx2x_def_status_blk;\n\n\tu32\t\t\t\tstatus_blk_num;\n\tu32\t\t\t\tbnx2x_igu_sb_id;\n\tu32\t\t\t\tint_num;\n\tu32\t\t\t\tlast_status_idx;\n\tstruct tasklet_struct\t\tcnic_irq_task;\n\n\tstruct kcqe\t\t*completed_kcq[MAX_COMPLETED_KCQE];\n\n\tstruct cnic_sock\t*csk_tbl;\n\tstruct cnic_id_tbl\tcsk_port_tbl;\n\n\tstruct cnic_dma\t\tgbl_buf_info;\n\n\tstruct cnic_iscsi\t*iscsi_tbl;\n\tstruct cnic_context\t*ctx_tbl;\n\tstruct cnic_id_tbl\tcid_tbl;\n\tatomic_t\t\tiscsi_conn;\n\tu32\t\t\tiscsi_start_cid;\n\n\tu32\t\t\tfcoe_init_cid;\n\tu32\t\t\tfcoe_start_cid;\n\tstruct cnic_id_tbl\tfcoe_cid_tbl;\n\n\tu32\t\t\tmax_cid_space;\n\n\t \n\tint\t\t\tnum_iscsi_tasks;\n\tint\t\t\tnum_ccells;\n\tint\t\t\ttask_array_size;\n\tint\t\t\tr2tq_size;\n\tint\t\t\thq_size;\n\tint\t\t\tnum_cqs;\n\n\tstruct delayed_work\tdelete_task;\n\n\tstruct cnic_ctx\t\t*ctx_arr;\n\tint\t\t\tctx_blks;\n\tint\t\t\tctx_blk_size;\n\tunsigned long\t\tctx_align;\n\tint\t\t\tcids_per_blk;\n\n\tu32\t\t\tchip_id;\n\tint\t\t\tfunc;\n\n\tu32\t\t\tshmem_base;\n\n\tstruct cnic_ops\t\t*cnic_ops;\n\tint\t\t\t(*start_hw)(struct cnic_dev *);\n\tvoid\t\t\t(*stop_hw)(struct cnic_dev *);\n\tvoid\t\t\t(*setup_pgtbl)(struct cnic_dev *,\n\t\t\t\t\t       struct cnic_dma *);\n\tint\t\t\t(*alloc_resc)(struct cnic_dev *);\n\tvoid\t\t\t(*free_resc)(struct cnic_dev *);\n\tint\t\t\t(*start_cm)(struct cnic_dev *);\n\tvoid\t\t\t(*stop_cm)(struct cnic_dev *);\n\tvoid\t\t\t(*enable_int)(struct cnic_dev *);\n\tvoid\t\t\t(*disable_int_sync)(struct cnic_dev *);\n\tvoid\t\t\t(*ack_int)(struct cnic_dev *);\n\tvoid\t\t\t(*arm_int)(struct cnic_dev *, u32 index);\n\tvoid\t\t\t(*close_conn)(struct cnic_sock *, u32 opcode);\n};\n\nstruct bnx2x_bd_chain_next {\n\tu32\taddr_lo;\n\tu32\taddr_hi;\n\tu8\treserved[8];\n};\n\n#define ISCSI_DEFAULT_MAX_OUTSTANDING_R2T \t(1)\n\n#define ISCSI_RAMROD_CMD_ID_UPDATE_CONN\t\t(ISCSI_KCQE_OPCODE_UPDATE_CONN)\n#define ISCSI_RAMROD_CMD_ID_INIT\t\t(ISCSI_KCQE_OPCODE_INIT)\n\n#define CDU_REGION_NUMBER_XCM_AG 2\n#define CDU_REGION_NUMBER_UCM_AG 4\n\n#define CDU_VALID_DATA(_cid, _region, _type)\t\\\n\t(((_cid) << 8) | (((_region)&0xf)<<4) | (((_type)&0xf)))\n\n#define CDU_CRC8(_cid, _region, _type)\t\\\n\t(calc_crc8(CDU_VALID_DATA(_cid, _region, _type), 0xff))\n\n#define CDU_RSRVD_VALUE_TYPE_A(_cid, _region, _type)\t\\\n\t(0x80 | ((CDU_CRC8(_cid, _region, _type)) & 0x7f))\n\n#define BNX2X_CONTEXT_MEM_SIZE\t\t1024\n#define BNX2X_FCOE_CID\t\t\t16\n\n#define BNX2X_ISCSI_START_CID\t\t18\n#define BNX2X_ISCSI_NUM_CONNECTIONS\t128\n#define BNX2X_ISCSI_TASK_CONTEXT_SIZE\t128\n#define BNX2X_ISCSI_MAX_PENDING_R2TS\t4\n#define BNX2X_ISCSI_R2TQE_SIZE\t\t8\n#define BNX2X_ISCSI_HQ_BD_SIZE\t\t64\n#define BNX2X_ISCSI_GLB_BUF_SIZE\t64\n#define BNX2X_ISCSI_PBL_NOT_CACHED\t0xff\n#define BNX2X_ISCSI_PDU_HEADER_NOT_CACHED\t0xff\n\n#define BNX2X_FCOE_NUM_CONNECTIONS\t1024\n\n#define BNX2X_FCOE_L5_CID_BASE\t\tMAX_ISCSI_TBL_SZ\n\n#define BNX2X_CHIP_IS_E2_PLUS(bp) (CHIP_IS_E2(bp) || CHIP_IS_E3(bp))\n\n#define BNX2X_RX_DESC_CNT\t\t(BNX2_PAGE_SIZE / \\\n\t\t\t\t\t sizeof(struct eth_rx_bd))\n#define BNX2X_MAX_RX_DESC_CNT\t\t(BNX2X_RX_DESC_CNT - 2)\n#define BNX2X_RCQ_DESC_CNT\t\t(BNX2_PAGE_SIZE / \\\n\t\t\t\t\t sizeof(union eth_rx_cqe))\n#define BNX2X_MAX_RCQ_DESC_CNT\t\t(BNX2X_RCQ_DESC_CNT - 1)\n\n#define BNX2X_NEXT_RCQE(x) (((x) & BNX2X_MAX_RCQ_DESC_CNT) ==\t\t\\\n\t\t(BNX2X_MAX_RCQ_DESC_CNT - 1)) ?\t\t\t\t\\\n\t\t((x) + 2) : ((x) + 1)\n\n#define BNX2X_DEF_SB_ID\t\t\tHC_SP_SB_ID\n\n#define BNX2X_SHMEM_MF_BLK_OFFSET\t0x7e4\n\n#define BNX2X_SHMEM_ADDR(base, field)\t(base + \\\n\t\t\t\t\t offsetof(struct shmem_region, field))\n\n#define BNX2X_SHMEM2_ADDR(base, field)\t(base + \\\n\t\t\t\t\t offsetof(struct shmem2_region, field))\n\n#define BNX2X_SHMEM2_HAS(base, field)\t\t\t\t\\\n\t\t((base) &&\t\t\t\t\t\\\n\t\t (CNIC_RD(dev, BNX2X_SHMEM2_ADDR(base, size)) >\t\\\n\t\t  offsetof(struct shmem2_region, field)))\n\n#define BNX2X_MF_CFG_ADDR(base, field)\t\t\t\t\\\n\t\t\t((base) + offsetof(struct mf_cfg, field))\n\n#ifndef ETH_MAX_RX_CLIENTS_E2\n#define ETH_MAX_RX_CLIENTS_E2 \t\tETH_MAX_RX_CLIENTS_E1H\n#endif\n\n#define CNIC_FUNC(cp)\t\t\t((cp)->func)\n\n#define BNX2X_HW_CID(bp, x)\t\t((BP_PORT(bp) << 23) | \\\n\t\t\t\t\t (BP_VN(bp) << 17) | (x))\n\n#define BNX2X_SW_CID(x)\t\t\t(x & 0x1ffff)\n\n#define BNX2X_CL_QZONE_ID(bp, cli)\t\t\t\t\t\\\n\t\t(BNX2X_CHIP_IS_E2_PLUS(bp) ? cli :\t\t\t\\\n\t\t cli + (BP_PORT(bp) * ETH_MAX_RX_CLIENTS_E1H))\n\n#ifndef MAX_STAT_COUNTER_ID\n#define MAX_STAT_COUNTER_ID\t\t\t\t\t\t\\\n\t(CHIP_IS_E1H(bp) ? MAX_STAT_COUNTER_ID_E1H :\t\t\t\\\n\t ((BNX2X_CHIP_IS_E2_PLUS(bp)) ? MAX_STAT_COUNTER_ID_E2 :\t\\\n\t  MAX_STAT_COUNTER_ID_E1))\n#endif\n\n#define CNIC_SUPPORTS_FCOE(cp)\t\t\t\t\t\t\\\n\t(BNX2X_CHIP_IS_E2_PLUS(bp) && !NO_FCOE(bp))\n\n#define CNIC_RAMROD_TMO\t\t\t(HZ / 4)\n\n#endif\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}