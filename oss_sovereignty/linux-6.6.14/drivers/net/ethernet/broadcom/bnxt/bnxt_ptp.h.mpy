{
  "module_name": "bnxt_ptp.h",
  "hash_id": "7e56bb51ab7c7f0d89762beb6466afe5ad44d305be754d506889c7ec2856cb70",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/broadcom/bnxt/bnxt_ptp.h",
  "human_readable_source": " \n\n#ifndef BNXT_PTP_H\n#define BNXT_PTP_H\n\n#include <linux/ptp_clock_kernel.h>\n#include <linux/timecounter.h>\n\n#define BNXT_PTP_GRC_WIN\t6\n#define BNXT_PTP_GRC_WIN_BASE\t0x6000\n\n#define BNXT_MAX_PHC_DRIFT\t31000000\n#define BNXT_CYCLES_SHIFT\t23\n#define BNXT_DEVCLK_FREQ\t1000000\n#define BNXT_LO_TIMER_MASK\t0x0000ffffffffUL\n#define BNXT_HI_TIMER_MASK\t0xffff00000000UL\n\n#define BNXT_PTP_QTS_TIMEOUT\t1000\n#define BNXT_PTP_QTS_TX_ENABLES\t(PORT_TS_QUERY_REQ_ENABLES_PTP_SEQ_ID |\t\\\n\t\t\t\t PORT_TS_QUERY_REQ_ENABLES_TS_REQ_TIMEOUT | \\\n\t\t\t\t PORT_TS_QUERY_REQ_ENABLES_PTP_HDR_OFFSET)\n\nstruct pps_pin {\n\tu8 event;\n\tu8 usage;\n\tu8 state;\n};\n\n#define TSIO_PIN_VALID(pin) ((pin) >= 0 && (pin) < (BNXT_MAX_TSIO_PINS))\n\n#define EVENT_DATA2_PPS_EVENT_TYPE(data2)\t\t\t\t\\\n\t((data2) & ASYNC_EVENT_CMPL_PPS_TIMESTAMP_EVENT_DATA2_EVENT_TYPE)\n\n#define EVENT_DATA2_PPS_PIN_NUM(data2)\t\t\t\t\t\\\n\t(((data2) &\t\t\t\t\t\t\t\\\n\t  ASYNC_EVENT_CMPL_PPS_TIMESTAMP_EVENT_DATA2_PIN_NUMBER_MASK) >>\\\n\t ASYNC_EVENT_CMPL_PPS_TIMESTAMP_EVENT_DATA2_PIN_NUMBER_SFT)\n\n#define BNXT_DATA2_UPPER_MSK\t\t\t\t\t\t\\\n\tASYNC_EVENT_CMPL_PPS_TIMESTAMP_EVENT_DATA2_PPS_TIMESTAMP_UPPER_MASK\n\n#define BNXT_DATA2_UPPER_SFT\t\t\t\t\t\t\\\n\t(32 -\t\t\t\t\t\t\t\t\\\n\t ASYNC_EVENT_CMPL_PPS_TIMESTAMP_EVENT_DATA2_PPS_TIMESTAMP_UPPER_SFT)\n\n#define BNXT_DATA1_LOWER_MSK\t\t\t\t\t\t\\\n\tASYNC_EVENT_CMPL_PPS_TIMESTAMP_EVENT_DATA1_PPS_TIMESTAMP_LOWER_MASK\n\n#define BNXT_DATA1_LOWER_SFT\t\t\t\t\t\t\\\n\t  ASYNC_EVENT_CMPL_PPS_TIMESTAMP_EVENT_DATA1_PPS_TIMESTAMP_LOWER_SFT\n\n#define EVENT_PPS_TS(data2, data1)\t\t\t\t\t\\\n\t(((u64)((data2) & BNXT_DATA2_UPPER_MSK) << BNXT_DATA2_UPPER_SFT) |\\\n\t (((data1) & BNXT_DATA1_LOWER_MSK) >> BNXT_DATA1_LOWER_SFT))\n\n#define BNXT_PPS_PIN_DISABLE\t0\n#define BNXT_PPS_PIN_ENABLE\t1\n#define BNXT_PPS_PIN_NONE\t0\n#define BNXT_PPS_PIN_PPS_IN\t1\n#define BNXT_PPS_PIN_PPS_OUT\t2\n#define BNXT_PPS_PIN_SYNC_IN\t3\n#define BNXT_PPS_PIN_SYNC_OUT\t4\n\n#define BNXT_PPS_EVENT_INTERNAL\t1\n#define BNXT_PPS_EVENT_EXTERNAL\t2\n\nstruct bnxt_pps {\n\tu8 num_pins;\n#define BNXT_MAX_TSIO_PINS\t4\n\tstruct pps_pin pins[BNXT_MAX_TSIO_PINS];\n};\n\nstruct bnxt_ptp_cfg {\n\tstruct ptp_clock_info\tptp_info;\n\tstruct ptp_clock\t*ptp_clock;\n\tstruct cyclecounter\tcc;\n\tstruct timecounter\ttc;\n\tstruct bnxt_pps\t\tpps_info;\n\t \n\tspinlock_t\t\tptp_lock;\n\tstruct sk_buff\t\t*tx_skb;\n\tu64\t\t\tcurrent_time;\n\tu64\t\t\told_time;\n\tunsigned long\t\tnext_period;\n\tunsigned long\t\tnext_overflow_check;\n\tu32\t\t\tcmult;\n\t \n\t#define BNXT_PHC_OVERFLOW_PERIOD\t(18 * 60 * HZ)\n\n\tu16\t\t\ttx_seqid;\n\tu16\t\t\ttx_hdr_off;\n\tstruct bnxt\t\t*bp;\n\tatomic_t\t\ttx_avail;\n#define BNXT_MAX_TX_TS\t1\n\tu16\t\t\trxctl;\n#define BNXT_PTP_MSG_SYNC\t\t\t(1 << 0)\n#define BNXT_PTP_MSG_DELAY_REQ\t\t\t(1 << 1)\n#define BNXT_PTP_MSG_PDELAY_REQ\t\t\t(1 << 2)\n#define BNXT_PTP_MSG_PDELAY_RESP\t\t(1 << 3)\n#define BNXT_PTP_MSG_FOLLOW_UP\t\t\t(1 << 8)\n#define BNXT_PTP_MSG_DELAY_RESP\t\t\t(1 << 9)\n#define BNXT_PTP_MSG_PDELAY_RESP_FOLLOW_UP\t(1 << 10)\n#define BNXT_PTP_MSG_ANNOUNCE\t\t\t(1 << 11)\n#define BNXT_PTP_MSG_SIGNALING\t\t\t(1 << 12)\n#define BNXT_PTP_MSG_MANAGEMENT\t\t\t(1 << 13)\n#define BNXT_PTP_MSG_EVENTS\t\t(BNXT_PTP_MSG_SYNC |\t\t\\\n\t\t\t\t\t BNXT_PTP_MSG_DELAY_REQ |\t\\\n\t\t\t\t\t BNXT_PTP_MSG_PDELAY_REQ |\t\\\n\t\t\t\t\t BNXT_PTP_MSG_PDELAY_RESP)\n\tu8\t\t\ttx_tstamp_en:1;\n\tint\t\t\trx_filter;\n\tu32\t\t\ttstamp_filters;\n\n\tu32\t\t\trefclk_regs[2];\n\tu32\t\t\trefclk_mapped_regs[2];\n};\n\n#if BITS_PER_LONG == 32\n#define BNXT_READ_TIME64(ptp, dst, src)\t\t\\\ndo {\t\t\t\t\t\t\\\n\tspin_lock_bh(&(ptp)->ptp_lock);\t\t\\\n\t(dst) = (src);\t\t\t\t\\\n\tspin_unlock_bh(&(ptp)->ptp_lock);\t\\\n} while (0)\n#else\n#define BNXT_READ_TIME64(ptp, dst, src)\t\t\\\n\t((dst) = READ_ONCE(src))\n#endif\n\nint bnxt_ptp_parse(struct sk_buff *skb, u16 *seq_id, u16 *hdr_off);\nvoid bnxt_ptp_update_current_time(struct bnxt *bp);\nvoid bnxt_ptp_pps_event(struct bnxt *bp, u32 data1, u32 data2);\nvoid bnxt_ptp_cfg_tstamp_filters(struct bnxt *bp);\nvoid bnxt_ptp_reapply_pps(struct bnxt *bp);\nint bnxt_hwtstamp_set(struct net_device *dev, struct ifreq *ifr);\nint bnxt_hwtstamp_get(struct net_device *dev, struct ifreq *ifr);\nint bnxt_get_tx_ts_p5(struct bnxt *bp, struct sk_buff *skb);\nint bnxt_get_rx_ts_p5(struct bnxt *bp, u64 *ts, u32 pkt_ts);\nvoid bnxt_ptp_rtc_timecounter_init(struct bnxt_ptp_cfg *ptp, u64 ns);\nint bnxt_ptp_init_rtc(struct bnxt *bp, bool phc_cfg);\nint bnxt_ptp_init(struct bnxt *bp, bool phc_cfg);\nvoid bnxt_ptp_clear(struct bnxt *bp);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}