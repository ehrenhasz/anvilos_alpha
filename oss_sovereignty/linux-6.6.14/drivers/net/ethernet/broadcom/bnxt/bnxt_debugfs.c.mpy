{
  "module_name": "bnxt_debugfs.c",
  "hash_id": "e4e7fa84cc01c1f806ca03a0c7bbb0866ccb012f4c6cd3655f58ba147f634529",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/broadcom/bnxt/bnxt_debugfs.c",
  "human_readable_source": " \n\n#include <linux/debugfs.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include \"bnxt_hsi.h\"\n#include <linux/dim.h>\n#include \"bnxt.h\"\n#include \"bnxt_debugfs.h\"\n\nstatic struct dentry *bnxt_debug_mnt;\n\nstatic ssize_t debugfs_dim_read(struct file *filep,\n\t\t\t\tchar __user *buffer,\n\t\t\t\tsize_t count, loff_t *ppos)\n{\n\tstruct dim *dim = filep->private_data;\n\tint len;\n\tchar *buf;\n\n\tif (*ppos)\n\t\treturn 0;\n\tif (!dim)\n\t\treturn -ENODEV;\n\tbuf = kasprintf(GFP_KERNEL,\n\t\t\t\"state = %d\\n\" \\\n\t\t\t\"profile_ix = %d\\n\" \\\n\t\t\t\"mode = %d\\n\" \\\n\t\t\t\"tune_state = %d\\n\" \\\n\t\t\t\"steps_right = %d\\n\" \\\n\t\t\t\"steps_left = %d\\n\" \\\n\t\t\t\"tired = %d\\n\",\n\t\t\tdim->state,\n\t\t\tdim->profile_ix,\n\t\t\tdim->mode,\n\t\t\tdim->tune_state,\n\t\t\tdim->steps_right,\n\t\t\tdim->steps_left,\n\t\t\tdim->tired);\n\tif (!buf)\n\t\treturn -ENOMEM;\n\tif (count < strlen(buf)) {\n\t\tkfree(buf);\n\t\treturn -ENOSPC;\n\t}\n\tlen = simple_read_from_buffer(buffer, count, ppos, buf, strlen(buf));\n\tkfree(buf);\n\treturn len;\n}\n\nstatic const struct file_operations debugfs_dim_fops = {\n\t.owner = THIS_MODULE,\n\t.open = simple_open,\n\t.read = debugfs_dim_read,\n};\n\nstatic void debugfs_dim_ring_init(struct dim *dim, int ring_idx,\n\t\t\t\t  struct dentry *dd)\n{\n\tstatic char qname[16];\n\n\tsnprintf(qname, 10, \"%d\", ring_idx);\n\tdebugfs_create_file(qname, 0600, dd, dim, &debugfs_dim_fops);\n}\n\nvoid bnxt_debug_dev_init(struct bnxt *bp)\n{\n\tconst char *pname = pci_name(bp->pdev);\n\tstruct dentry *dir;\n\tint i;\n\n\tbp->debugfs_pdev = debugfs_create_dir(pname, bnxt_debug_mnt);\n\tdir = debugfs_create_dir(\"dim\", bp->debugfs_pdev);\n\n\t \n\tfor (i = 0; i < bp->cp_nr_rings; i++) {\n\t\tstruct bnxt_cp_ring_info *cpr = &bp->bnapi[i]->cp_ring;\n\n\t\tif (cpr && bp->bnapi[i]->rx_ring)\n\t\t\tdebugfs_dim_ring_init(&cpr->dim, i, dir);\n\t}\n}\n\nvoid bnxt_debug_dev_exit(struct bnxt *bp)\n{\n\tif (bp) {\n\t\tdebugfs_remove_recursive(bp->debugfs_pdev);\n\t\tbp->debugfs_pdev = NULL;\n\t}\n}\n\nvoid bnxt_debug_init(void)\n{\n\tbnxt_debug_mnt = debugfs_create_dir(\"bnxt_en\", NULL);\n}\n\nvoid bnxt_debug_exit(void)\n{\n\tdebugfs_remove_recursive(bnxt_debug_mnt);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}