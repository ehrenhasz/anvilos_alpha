{
  "module_name": "hinic_hw_mgmt.h",
  "hash_id": "d1b884be94c2374d4a1b872f5452ce8afd651f0fbca046e486f215bfe4dcce12",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/huawei/hinic/hinic_hw_mgmt.h",
  "human_readable_source": " \n \n\n#ifndef HINIC_HW_MGMT_H\n#define HINIC_HW_MGMT_H\n\n#include <linux/types.h>\n#include <linux/semaphore.h>\n#include <linux/completion.h>\n#include <linux/bitops.h>\n\n#include \"hinic_hw_if.h\"\n#include \"hinic_hw_api_cmd.h\"\n\n#define HINIC_MSG_HEADER_MSG_LEN_SHIFT                          0\n#define HINIC_MSG_HEADER_MODULE_SHIFT                           11\n#define HINIC_MSG_HEADER_SEG_LEN_SHIFT                          16\n#define HINIC_MSG_HEADER_NO_ACK_SHIFT                           22\n#define HINIC_MSG_HEADER_ASYNC_MGMT_TO_PF_SHIFT                 23\n#define HINIC_MSG_HEADER_SEQID_SHIFT                            24\n#define HINIC_MSG_HEADER_LAST_SHIFT                             30\n#define HINIC_MSG_HEADER_DIRECTION_SHIFT                        31\n#define HINIC_MSG_HEADER_CMD_SHIFT                              32\n#define HINIC_MSG_HEADER_ZEROS_SHIFT                            40\n#define HINIC_MSG_HEADER_PCI_INTF_SHIFT                         48\n#define HINIC_MSG_HEADER_PF_IDX_SHIFT                           50\n#define HINIC_MSG_HEADER_MSG_ID_SHIFT                           54\n\n#define HINIC_MSG_HEADER_MSG_LEN_MASK                           0x7FF\n#define HINIC_MSG_HEADER_MODULE_MASK                            0x1F\n#define HINIC_MSG_HEADER_SEG_LEN_MASK                           0x3F\n#define HINIC_MSG_HEADER_NO_ACK_MASK                            0x1\n#define HINIC_MSG_HEADER_ASYNC_MGMT_TO_PF_MASK                  0x1\n#define HINIC_MSG_HEADER_SEQID_MASK                             0x3F\n#define HINIC_MSG_HEADER_LAST_MASK                              0x1\n#define HINIC_MSG_HEADER_DIRECTION_MASK                         0x1\n#define HINIC_MSG_HEADER_CMD_MASK                               0xFF\n#define HINIC_MSG_HEADER_ZEROS_MASK                             0xFF\n#define HINIC_MSG_HEADER_PCI_INTF_MASK                          0x3\n#define HINIC_MSG_HEADER_PF_IDX_MASK                            0xF\n#define HINIC_MSG_HEADER_MSG_ID_MASK                            0x3FF\n\n#define HINIC_MSG_HEADER_SET(val, member)                       \\\n\t\t((u64)((val) & HINIC_MSG_HEADER_##member##_MASK) << \\\n\t\t HINIC_MSG_HEADER_##member##_SHIFT)\n\n#define HINIC_MSG_HEADER_GET(val, member)                       \\\n\t\t(((val) >> HINIC_MSG_HEADER_##member##_SHIFT) & \\\n\t\t HINIC_MSG_HEADER_##member##_MASK)\n\nenum hinic_mgmt_msg_type {\n\tHINIC_MGMT_MSG_SYNC = 1,\n};\n\nenum hinic_cfg_cmd {\n\tHINIC_CFG_NIC_CAP = 0,\n};\n\nenum hinic_comm_cmd {\n\tHINIC_COMM_CMD_START_FLR          = 0x1,\n\tHINIC_COMM_CMD_IO_STATUS_GET    = 0x3,\n\tHINIC_COMM_CMD_DMA_ATTR_SET\t    = 0x4,\n\n\tHINIC_COMM_CMD_CMDQ_CTXT_SET    = 0x10,\n\tHINIC_COMM_CMD_CMDQ_CTXT_GET    = 0x11,\n\n\tHINIC_COMM_CMD_HWCTXT_SET       = 0x12,\n\tHINIC_COMM_CMD_HWCTXT_GET       = 0x13,\n\n\tHINIC_COMM_CMD_SQ_HI_CI_SET     = 0x14,\n\n\tHINIC_COMM_CMD_RES_STATE_SET    = 0x24,\n\n\tHINIC_COMM_CMD_IO_RES_CLEAR     = 0x29,\n\n\tHINIC_COMM_CMD_CEQ_CTRL_REG_WR_BY_UP = 0x33,\n\n\tHINIC_COMM_CMD_MSI_CTRL_REG_WR_BY_UP,\n\tHINIC_COMM_CMD_MSI_CTRL_REG_RD_BY_UP,\n\n\tHINIC_COMM_CMD_FAULT_REPORT\t= 0x37,\n\n\tHINIC_COMM_CMD_SET_LED_STATUS\t= 0x4a,\n\n\tHINIC_COMM_CMD_L2NIC_RESET\t= 0x4b,\n\n\tHINIC_COMM_CMD_PAGESIZE_SET\t= 0x50,\n\n\tHINIC_COMM_CMD_GET_BOARD_INFO\t= 0x52,\n\n\tHINIC_COMM_CMD_WATCHDOG_INFO\t= 0x56,\n\n\tHINIC_MGMT_CMD_SET_VF_RANDOM_ID = 0x61,\n\n\tHINIC_COMM_CMD_MAX,\n};\n\nenum hinic_mgmt_cb_state {\n\tHINIC_MGMT_CB_ENABLED = BIT(0),\n\tHINIC_MGMT_CB_RUNNING = BIT(1),\n};\n\nstruct hinic_recv_msg {\n\tu8                      *msg;\n\tu8                      *buf_out;\n\n\tstruct completion       recv_done;\n\n\tu16                     cmd;\n\tenum hinic_mod_type     mod;\n\tint                     async_mgmt_to_pf;\n\n\tu16                     msg_len;\n\tu16                     msg_id;\n};\n\nstruct hinic_mgmt_cb {\n\tvoid    (*cb)(void *handle, u8 cmd,\n\t\t      void *buf_in, u16 in_size,\n\t\t      void *buf_out, u16 *out_size);\n\n\tvoid            *handle;\n\tunsigned long   state;\n};\n\nstruct hinic_pf_to_mgmt {\n\tstruct hinic_hwif               *hwif;\n\tstruct hinic_hwdev\t\t*hwdev;\n\tstruct semaphore                sync_msg_lock;\n\tu16                             sync_msg_id;\n\tu8                              *sync_msg_buf;\n\tvoid\t\t\t\t*mgmt_ack_buf;\n\n\tstruct hinic_recv_msg           recv_resp_msg_from_mgmt;\n\tstruct hinic_recv_msg           recv_msg_from_mgmt;\n\n\tstruct hinic_api_cmd_chain      *cmd_chain[HINIC_API_CMD_MAX];\n\n\tstruct hinic_mgmt_cb            mgmt_cb[HINIC_MOD_MAX];\n\n\tstruct workqueue_struct\t\t*workq;\n};\n\nstruct hinic_mgmt_msg_handle_work {\n\tstruct work_struct work;\n\tstruct hinic_pf_to_mgmt *pf_to_mgmt;\n\n\tvoid\t\t\t*msg;\n\tu16\t\t\tmsg_len;\n\n\tenum hinic_mod_type\tmod;\n\tu8\t\t\tcmd;\n\tu16\t\t\tmsg_id;\n\tint\t\t\tasync_mgmt_to_pf;\n};\n\nvoid hinic_register_mgmt_msg_cb(struct hinic_pf_to_mgmt *pf_to_mgmt,\n\t\t\t\tenum hinic_mod_type mod,\n\t\t\t\tvoid *handle,\n\t\t\t\tvoid (*callback)(void *handle,\n\t\t\t\t\t\t u8 cmd, void *buf_in,\n\t\t\t\t\t\t u16 in_size, void *buf_out,\n\t\t\t\t\t\t u16 *out_size));\n\nvoid hinic_unregister_mgmt_msg_cb(struct hinic_pf_to_mgmt *pf_to_mgmt,\n\t\t\t\t  enum hinic_mod_type mod);\n\nint hinic_msg_to_mgmt(struct hinic_pf_to_mgmt *pf_to_mgmt,\n\t\t      enum hinic_mod_type mod, u8 cmd,\n\t\t      void *buf_in, u16 in_size, void *buf_out, u16 *out_size,\n\t\t      enum hinic_mgmt_msg_type sync);\n\nint hinic_pf_to_mgmt_init(struct hinic_pf_to_mgmt *pf_to_mgmt,\n\t\t\t  struct hinic_hwif *hwif);\n\nvoid hinic_pf_to_mgmt_free(struct hinic_pf_to_mgmt *pf_to_mgmt);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}