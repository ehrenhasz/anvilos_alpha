{
  "module_name": "hinic_hw_mbox.h",
  "hash_id": "26b6ab779dedaa08f7da46d2cdd6bf3db3ec9cbfbfdf17fa20c7bdc694f28376",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/huawei/hinic/hinic_hw_mbox.h",
  "human_readable_source": " \n \n\n#ifndef HINIC_MBOX_H_\n#define HINIC_MBOX_H_\n\n#define HINIC_MBOX_PF_SEND_ERR\t\t0x1\n#define HINIC_MBOX_PF_BUSY_ACTIVE_FW\t0x2\n#define HINIC_MBOX_VF_CMD_ERROR\t\t0x3\n\n#define HINIC_MAX_FUNCTIONS\t\t512\n\n#define HINIC_MAX_PF_FUNCS\t\t16\n\n#define HINIC_MBOX_WQ_NAME\t\t\"hinic_mbox\"\n\n#define HINIC_FUNC_CSR_MAILBOX_DATA_OFF\t\t\t0x80\n#define HINIC_FUNC_CSR_MAILBOX_CONTROL_OFF\t\t0x0100\n#define HINIC_FUNC_CSR_MAILBOX_INT_OFFSET_OFF\t\t0x0104\n#define HINIC_FUNC_CSR_MAILBOX_RESULT_H_OFF\t\t0x0108\n#define HINIC_FUNC_CSR_MAILBOX_RESULT_L_OFF\t\t0x010C\n\n#define MAX_FUNCTION_NUM\t\t512\n\nstruct vf_cmd_check_handle {\n\tu8 cmd;\n\tbool (*check_cmd)(struct hinic_hwdev *hwdev, u16 src_func_idx,\n\t\t\t  void *buf_in, u16 in_size);\n};\n\nenum hinic_mbox_ack_type {\n\tMBOX_ACK,\n\tMBOX_NO_ACK,\n};\n\nstruct mbox_msg_info {\n\tu8 msg_id;\n\tu8 status;\n};\n\nstruct hinic_recv_mbox {\n\tstruct completion\trecv_done;\n\tvoid\t\t\t*mbox;\n\tu8\t\t\tcmd;\n\tenum hinic_mod_type\tmod;\n\tu16\t\t\tmbox_len;\n\tvoid\t\t\t*buf_out;\n\tenum hinic_mbox_ack_type ack_type;\n\tstruct mbox_msg_info\tmsg_info;\n\tu8\t\t\tseq_id;\n\tatomic_t\t\tmsg_cnt;\n};\n\nstruct hinic_send_mbox {\n\tstruct completion\tsend_done;\n\tu8\t\t\t*data;\n\n\tu64\t\t\t*wb_status;\n\tvoid\t\t\t*wb_vaddr;\n\tdma_addr_t\t\twb_paddr;\n};\n\ntypedef void (*hinic_vf_mbox_cb)(void *handle, u8 cmd, void *buf_in,\n\t\t\t\tu16 in_size, void *buf_out, u16 *out_size);\ntypedef int (*hinic_pf_mbox_cb)(void *handle, u16 vf_id, u8 cmd, void *buf_in,\n\t\t\t\tu16 in_size, void *buf_out, u16 *out_size);\n\nenum mbox_event_state {\n\tEVENT_START = 0,\n\tEVENT_FAIL,\n\tEVENT_TIMEOUT,\n\tEVENT_END,\n};\n\nenum hinic_mbox_cb_state {\n\tHINIC_VF_MBOX_CB_REG = 0,\n\tHINIC_VF_MBOX_CB_RUNNING,\n\tHINIC_PF_MBOX_CB_REG,\n\tHINIC_PF_MBOX_CB_RUNNING,\n\tHINIC_PPF_MBOX_CB_REG,\n\tHINIC_PPF_MBOX_CB_RUNNING,\n\tHINIC_PPF_TO_PF_MBOX_CB_REG,\n\tHINIC_PPF_TO_PF_MBOX_CB_RUNNIG,\n};\n\nstruct hinic_mbox_func_to_func {\n\tstruct hinic_hwdev\t*hwdev;\n\tstruct hinic_hwif\t\t*hwif;\n\n\tstruct semaphore\tmbox_send_sem;\n\tstruct semaphore\tmsg_send_sem;\n\tstruct hinic_send_mbox\tsend_mbox;\n\n\tstruct workqueue_struct *workq;\n\n\tstruct hinic_recv_mbox\tmbox_resp[HINIC_MAX_FUNCTIONS];\n\tstruct hinic_recv_mbox\tmbox_send[HINIC_MAX_FUNCTIONS];\n\n\thinic_vf_mbox_cb\tvf_mbox_cb[HINIC_MOD_MAX];\n\thinic_pf_mbox_cb\tpf_mbox_cb[HINIC_MOD_MAX];\n\tunsigned long\t\tpf_mbox_cb_state[HINIC_MOD_MAX];\n\tunsigned long\t\tvf_mbox_cb_state[HINIC_MOD_MAX];\n\n\tu8 send_msg_id;\n\tenum mbox_event_state event_flag;\n\n\t \n\tspinlock_t mbox_lock;\n\n\tu32 vf_mbx_old_rand_id[MAX_FUNCTION_NUM];\n\tu32 vf_mbx_rand_id[MAX_FUNCTION_NUM];\n\tbool support_vf_random;\n};\n\nstruct hinic_mbox_work {\n\tstruct work_struct work;\n\tu16 src_func_idx;\n\tstruct hinic_mbox_func_to_func *func_to_func;\n\tstruct hinic_recv_mbox *recv_mbox;\n};\n\nstruct vf_cmd_msg_handle {\n\tu8 cmd;\n\tint (*cmd_msg_handler)(void *hwdev, u16 vf_id,\n\t\t\t       void *buf_in, u16 in_size,\n\t\t\t       void *buf_out, u16 *out_size);\n};\n\nbool hinic_mbox_check_func_id_8B(struct hinic_hwdev *hwdev, u16 func_idx,\n\t\t\t\t void *buf_in, u16 in_size);\n\nbool hinic_mbox_check_cmd_valid(struct hinic_hwdev *hwdev,\n\t\t\t\tstruct vf_cmd_check_handle *cmd_handle,\n\t\t\t\tu16 vf_id, u8 cmd, void *buf_in,\n\t\t\t\tu16 in_size, u8 size);\n\nint hinic_register_pf_mbox_cb(struct hinic_hwdev *hwdev,\n\t\t\t      enum hinic_mod_type mod,\n\t\t\t      hinic_pf_mbox_cb callback);\n\nint hinic_register_vf_mbox_cb(struct hinic_hwdev *hwdev,\n\t\t\t      enum hinic_mod_type mod,\n\t\t\t      hinic_vf_mbox_cb callback);\n\nvoid hinic_unregister_pf_mbox_cb(struct hinic_hwdev *hwdev,\n\t\t\t\t enum hinic_mod_type mod);\n\nvoid hinic_unregister_vf_mbox_cb(struct hinic_hwdev *hwdev,\n\t\t\t\t enum hinic_mod_type mod);\n\nint hinic_func_to_func_init(struct hinic_hwdev *hwdev);\n\nvoid hinic_func_to_func_free(struct hinic_hwdev *hwdev);\n\nint hinic_mbox_to_pf(struct hinic_hwdev *hwdev, enum hinic_mod_type mod,\n\t\t     u8 cmd, void *buf_in, u16 in_size, void *buf_out,\n\t\t     u16 *out_size, u32 timeout);\n\nint hinic_mbox_to_func(struct hinic_mbox_func_to_func *func_to_func,\n\t\t       enum hinic_mod_type mod, u16 cmd, u16 dst_func,\n\t\t       void *buf_in, u16 in_size, void *buf_out,\n\t\t       u16 *out_size, u32 timeout);\n\nint hinic_mbox_to_vf(struct hinic_hwdev *hwdev,\n\t\t     enum hinic_mod_type mod, u16 vf_id, u8 cmd, void *buf_in,\n\t\t     u16 in_size, void *buf_out, u16 *out_size, u32 timeout);\n\nint hinic_vf_mbox_random_id_init(struct hinic_hwdev *hwdev);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}