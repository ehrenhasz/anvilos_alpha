{
  "module_name": "hinic_hw_qp.h",
  "hash_id": "32d1463b25af1c838babb1b028d46ad4db9776f23d192c086e73b3d3b91f39a7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/huawei/hinic/hinic_hw_qp.h",
  "human_readable_source": " \n \n\n#ifndef HINIC_HW_QP_H\n#define HINIC_HW_QP_H\n\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/sizes.h>\n#include <linux/pci.h>\n#include <linux/skbuff.h>\n\n#include \"hinic_common.h\"\n#include \"hinic_hw_if.h\"\n#include \"hinic_hw_wqe.h\"\n#include \"hinic_hw_wq.h\"\n#include \"hinic_hw_qp_ctxt.h\"\n\n#define HINIC_SQ_DB_INFO_PI_HI_SHIFT            0\n#define HINIC_SQ_DB_INFO_QID_SHIFT              8\n#define HINIC_SQ_DB_INFO_PATH_SHIFT             23\n#define HINIC_SQ_DB_INFO_COS_SHIFT              24\n#define HINIC_SQ_DB_INFO_TYPE_SHIFT             27\n\n#define HINIC_SQ_DB_INFO_PI_HI_MASK             0xFF\n#define HINIC_SQ_DB_INFO_QID_MASK               0x3FF\n#define HINIC_SQ_DB_INFO_PATH_MASK              0x1\n#define HINIC_SQ_DB_INFO_COS_MASK               0x7\n#define HINIC_SQ_DB_INFO_TYPE_MASK              0x1F\n\n#define HINIC_SQ_DB_INFO_SET(val, member)       \\\n\t\t(((u32)(val) & HINIC_SQ_DB_INFO_##member##_MASK) \\\n\t\t << HINIC_SQ_DB_INFO_##member##_SHIFT)\n\n#define HINIC_SQ_WQEBB_SIZE                     64\n#define HINIC_RQ_WQEBB_SIZE                     32\n\n#define HINIC_SQ_PAGE_SIZE                      SZ_256K\n#define HINIC_RQ_PAGE_SIZE                      SZ_256K\n\n#define HINIC_SQ_DEPTH                          SZ_4K\n#define HINIC_RQ_DEPTH                          SZ_4K\n\n#define HINIC_MAX_QUEUE_DEPTH\t\t\tSZ_4K\n#define HINIC_MIN_QUEUE_DEPTH\t\t\t128\n\n \n#define HINIC_RX_BUF_SZ                         2048\n#define HINIC_RX_BUF_SZ_IDX\t\t\tHINIC_RX_BUF_SZ_2048_IDX\n\n#define HINIC_MIN_TX_WQE_SIZE(wq)               \\\n\t\tALIGN(HINIC_SQ_WQE_SIZE(1), (wq)->wqebb_size)\n\n#define HINIC_MIN_TX_NUM_WQEBBS(sq)             \\\n\t\t(HINIC_MIN_TX_WQE_SIZE((sq)->wq) / (sq)->wq->wqebb_size)\n\nenum hinic_rx_buf_sz_idx {\n\tHINIC_RX_BUF_SZ_32_IDX,\n\tHINIC_RX_BUF_SZ_64_IDX,\n\tHINIC_RX_BUF_SZ_96_IDX,\n\tHINIC_RX_BUF_SZ_128_IDX,\n\tHINIC_RX_BUF_SZ_192_IDX,\n\tHINIC_RX_BUF_SZ_256_IDX,\n\tHINIC_RX_BUF_SZ_384_IDX,\n\tHINIC_RX_BUF_SZ_512_IDX,\n\tHINIC_RX_BUF_SZ_768_IDX,\n\tHINIC_RX_BUF_SZ_1024_IDX,\n\tHINIC_RX_BUF_SZ_1536_IDX,\n\tHINIC_RX_BUF_SZ_2048_IDX,\n\tHINIC_RX_BUF_SZ_3072_IDX,\n\tHINIC_RX_BUF_SZ_4096_IDX,\n\tHINIC_RX_BUF_SZ_8192_IDX,\n\tHINIC_RX_BUF_SZ_16384_IDX,\n};\n\nstruct hinic_sq {\n\tstruct hinic_hwif       *hwif;\n\n\tstruct hinic_wq         *wq;\n\n\tu16\t\t\tqid;\n\n\tu32                     irq;\n\tu16                     msix_entry;\n\n\tvoid                    *hw_ci_addr;\n\tdma_addr_t              hw_ci_dma_addr;\n\n\tvoid __iomem            *db_base;\n\n\tstruct sk_buff          **saved_skb;\n\tstruct hinic_debug_priv\t*dbg;\n};\n\nstruct hinic_rq {\n\tstruct hinic_hwif       *hwif;\n\n\tstruct hinic_wq         *wq;\n\n\tu16\t\t\tqid;\n\n\tstruct cpumask\t\taffinity_mask;\n\tu32                     irq;\n\tu16                     msix_entry;\n\n\tsize_t                  buf_sz;\n\n\tstruct sk_buff          **saved_skb;\n\n\tstruct hinic_rq_cqe     **cqe;\n\tdma_addr_t              *cqe_dma;\n\n\tu16                     *pi_virt_addr;\n\tdma_addr_t              pi_dma_addr;\n\tstruct hinic_debug_priv\t*dbg;\n};\n\nstruct hinic_qp {\n\tstruct hinic_sq         sq;\n\tstruct hinic_rq         rq;\n\n\tu16     q_id;\n};\n\nvoid hinic_qp_prepare_header(struct hinic_qp_ctxt_header *qp_ctxt_hdr,\n\t\t\t     enum hinic_qp_ctxt_type ctxt_type,\n\t\t\t     u16 num_queues, u16 max_queues);\n\nvoid hinic_sq_prepare_ctxt(struct hinic_sq_ctxt *sq_ctxt,\n\t\t\t   struct hinic_sq *sq, u16 global_qid);\n\nvoid hinic_rq_prepare_ctxt(struct hinic_rq_ctxt *rq_ctxt,\n\t\t\t   struct hinic_rq *rq, u16 global_qid);\n\nint hinic_init_sq(struct hinic_sq *sq, struct hinic_hwif *hwif,\n\t\t  struct hinic_wq *wq, struct msix_entry *entry, void *ci_addr,\n\t\t  dma_addr_t ci_dma_addr, void __iomem *db_base);\n\nvoid hinic_clean_sq(struct hinic_sq *sq);\n\nint hinic_init_rq(struct hinic_rq *rq, struct hinic_hwif *hwif,\n\t\t  struct hinic_wq *wq, struct msix_entry *entry);\n\nvoid hinic_clean_rq(struct hinic_rq *rq);\n\nint hinic_get_sq_free_wqebbs(struct hinic_sq *sq);\n\nint hinic_get_rq_free_wqebbs(struct hinic_rq *rq);\n\nvoid hinic_task_set_l2hdr(struct hinic_sq_task *task, u32 len);\n\nvoid hinic_task_set_outter_l3(struct hinic_sq_task *task,\n\t\t\t      enum hinic_l3_offload_type l3_type,\n\t\t\t      u32 network_len);\n\nvoid hinic_task_set_inner_l3(struct hinic_sq_task *task,\n\t\t\t     enum hinic_l3_offload_type l3_type,\n\t\t\t     u32 network_len);\n\nvoid hinic_task_set_tunnel_l4(struct hinic_sq_task *task,\n\t\t\t      enum hinic_l4_tunnel_type l4_type,\n\t\t\t      u32 tunnel_len);\n\nvoid hinic_set_cs_inner_l4(struct hinic_sq_task *task,\n\t\t\t   u32 *queue_info,\n\t\t\t   enum hinic_l4_offload_type l4_offload,\n\t\t\t   u32 l4_len, u32 offset);\n\nvoid hinic_set_tso_inner_l4(struct hinic_sq_task *task,\n\t\t\t    u32 *queue_info,\n\t\t\t    enum hinic_l4_offload_type l4_offload,\n\t\t\t    u32 l4_len,\n\t\t\t    u32 offset, u32 ip_ident, u32 mss);\n\nvoid hinic_sq_prepare_wqe(struct hinic_sq *sq, struct hinic_sq_wqe *wqe,\n\t\t\t  struct hinic_sge *sges, int nr_sges);\n\nvoid hinic_sq_write_db(struct hinic_sq *sq, u16 prod_idx, unsigned int wqe_size,\n\t\t       unsigned int cos);\n\nstruct hinic_sq_wqe *hinic_sq_get_wqe(struct hinic_sq *sq,\n\t\t\t\t      unsigned int wqe_size, u16 *prod_idx);\n\nvoid hinic_sq_return_wqe(struct hinic_sq *sq, unsigned int wqe_size);\n\nvoid hinic_sq_write_wqe(struct hinic_sq *sq, u16 prod_idx,\n\t\t\tstruct hinic_sq_wqe *wqe, struct sk_buff *skb,\n\t\t\tunsigned int wqe_size);\n\nstruct hinic_sq_wqe *hinic_sq_read_wqe(struct hinic_sq *sq,\n\t\t\t\t       struct sk_buff **skb,\n\t\t\t\t       unsigned int wqe_size, u16 *cons_idx);\n\nstruct hinic_sq_wqe *hinic_sq_read_wqebb(struct hinic_sq *sq,\n\t\t\t\t\t struct sk_buff **skb,\n\t\t\t\t\t unsigned int *wqe_size, u16 *cons_idx);\n\nvoid hinic_sq_put_wqe(struct hinic_sq *sq, unsigned int wqe_size);\n\nvoid hinic_sq_get_sges(struct hinic_sq_wqe *wqe, struct hinic_sge *sges,\n\t\t       int nr_sges);\n\nstruct hinic_rq_wqe *hinic_rq_get_wqe(struct hinic_rq *rq,\n\t\t\t\t      unsigned int wqe_size, u16 *prod_idx);\n\nvoid hinic_rq_write_wqe(struct hinic_rq *rq, u16 prod_idx,\n\t\t\tstruct hinic_rq_wqe *wqe, struct sk_buff *skb);\n\nstruct hinic_rq_wqe *hinic_rq_read_wqe(struct hinic_rq *rq,\n\t\t\t\t       unsigned int wqe_size,\n\t\t\t\t       struct sk_buff **skb, u16 *cons_idx);\n\nstruct hinic_rq_wqe *hinic_rq_read_next_wqe(struct hinic_rq *rq,\n\t\t\t\t\t    unsigned int wqe_size,\n\t\t\t\t\t    struct sk_buff **skb,\n\t\t\t\t\t    u16 *cons_idx);\n\nvoid hinic_rq_put_wqe(struct hinic_rq *rq, u16 cons_idx,\n\t\t      unsigned int wqe_size);\n\nvoid hinic_rq_get_sge(struct hinic_rq *rq, struct hinic_rq_wqe *wqe,\n\t\t      u16 cons_idx, struct hinic_sge *sge);\n\nvoid hinic_rq_prepare_wqe(struct hinic_rq *rq, u16 prod_idx,\n\t\t\t  struct hinic_rq_wqe *wqe, struct hinic_sge *sge);\n\nvoid hinic_rq_update(struct hinic_rq *rq, u16 prod_idx);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}