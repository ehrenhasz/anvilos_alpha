{
  "module_name": "hinic_hw_eqs.h",
  "hash_id": "f850a42bff020f4b18790f4377e658f7e1e8d42c3cb96e2a9b811b3849885ead",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/huawei/hinic/hinic_hw_eqs.h",
  "human_readable_source": " \n \n\n#ifndef HINIC_HW_EQS_H\n#define HINIC_HW_EQS_H\n\n#include <linux/types.h>\n#include <linux/workqueue.h>\n#include <linux/pci.h>\n#include <linux/sizes.h>\n#include <linux/bitops.h>\n#include <linux/interrupt.h>\n\n#include \"hinic_hw_if.h\"\n\n#define HINIC_AEQ_CTRL_0_INT_IDX_SHIFT          0\n#define HINIC_AEQ_CTRL_0_DMA_ATTR_SHIFT         12\n#define HINIC_AEQ_CTRL_0_PCI_INTF_IDX_SHIFT     20\n#define HINIC_AEQ_CTRL_0_INT_MODE_SHIFT         31\n\n#define HINIC_AEQ_CTRL_0_INT_IDX_MASK           0x3FF\n#define HINIC_AEQ_CTRL_0_DMA_ATTR_MASK          0x3F\n#define HINIC_AEQ_CTRL_0_PCI_INTF_IDX_MASK      0x3\n#define HINIC_AEQ_CTRL_0_INT_MODE_MASK          0x1\n\n#define HINIC_AEQ_CTRL_0_SET(val, member)       \\\n\t\t\t(((u32)(val) & HINIC_AEQ_CTRL_0_##member##_MASK) << \\\n\t\t\t HINIC_AEQ_CTRL_0_##member##_SHIFT)\n\n#define HINIC_AEQ_CTRL_0_CLEAR(val, member)     \\\n\t\t\t((val) & (~(HINIC_AEQ_CTRL_0_##member##_MASK \\\n\t\t\t << HINIC_AEQ_CTRL_0_##member##_SHIFT)))\n\n#define HINIC_AEQ_CTRL_1_LEN_SHIFT              0\n#define HINIC_AEQ_CTRL_1_ELEM_SIZE_SHIFT        24\n#define HINIC_AEQ_CTRL_1_PAGE_SIZE_SHIFT        28\n\n#define HINIC_AEQ_CTRL_1_LEN_MASK               0x1FFFFF\n#define HINIC_AEQ_CTRL_1_ELEM_SIZE_MASK         0x3\n#define HINIC_AEQ_CTRL_1_PAGE_SIZE_MASK         0xF\n\n#define HINIC_AEQ_CTRL_1_SET(val, member)       \\\n\t\t\t(((u32)(val) & HINIC_AEQ_CTRL_1_##member##_MASK) << \\\n\t\t\t HINIC_AEQ_CTRL_1_##member##_SHIFT)\n\n#define HINIC_AEQ_CTRL_1_CLEAR(val, member)     \\\n\t\t\t((val) & (~(HINIC_AEQ_CTRL_1_##member##_MASK \\\n\t\t\t << HINIC_AEQ_CTRL_1_##member##_SHIFT)))\n\n#define HINIC_CEQ_CTRL_0_INTR_IDX_SHIFT         0\n#define HINIC_CEQ_CTRL_0_DMA_ATTR_SHIFT         12\n#define HINIC_CEQ_CTRL_0_KICK_THRESH_SHIFT      20\n#define HINIC_CEQ_CTRL_0_PCI_INTF_IDX_SHIFT     24\n#define HINIC_CEQ_CTRL_0_INTR_MODE_SHIFT        31\n\n#define HINIC_CEQ_CTRL_0_INTR_IDX_MASK          0x3FF\n#define HINIC_CEQ_CTRL_0_DMA_ATTR_MASK          0x3F\n#define HINIC_CEQ_CTRL_0_KICK_THRESH_MASK       0xF\n#define HINIC_CEQ_CTRL_0_PCI_INTF_IDX_MASK      0x3\n#define HINIC_CEQ_CTRL_0_INTR_MODE_MASK         0x1\n\n#define HINIC_CEQ_CTRL_0_SET(val, member)       \\\n\t\t\t(((u32)(val) & HINIC_CEQ_CTRL_0_##member##_MASK) << \\\n\t\t\t HINIC_CEQ_CTRL_0_##member##_SHIFT)\n\n#define HINIC_CEQ_CTRL_0_CLEAR(val, member)     \\\n\t\t\t((val) & (~(HINIC_CEQ_CTRL_0_##member##_MASK \\\n\t\t\t << HINIC_CEQ_CTRL_0_##member##_SHIFT)))\n\n#define HINIC_CEQ_CTRL_1_LEN_SHIFT              0\n#define HINIC_CEQ_CTRL_1_PAGE_SIZE_SHIFT        28\n\n#define HINIC_CEQ_CTRL_1_LEN_MASK               0x1FFFFF\n#define HINIC_CEQ_CTRL_1_PAGE_SIZE_MASK         0xF\n\n#define HINIC_CEQ_CTRL_1_SET(val, member)       \\\n\t\t\t(((u32)(val) & HINIC_CEQ_CTRL_1_##member##_MASK) << \\\n\t\t\t HINIC_CEQ_CTRL_1_##member##_SHIFT)\n\n#define HINIC_CEQ_CTRL_1_CLEAR(val, member)     \\\n\t\t\t((val) & (~(HINIC_CEQ_CTRL_1_##member##_MASK \\\n\t\t\t << HINIC_CEQ_CTRL_1_##member##_SHIFT)))\n\n#define HINIC_EQ_ELEM_DESC_TYPE_SHIFT           0\n#define HINIC_EQ_ELEM_DESC_SRC_SHIFT            7\n#define HINIC_EQ_ELEM_DESC_SIZE_SHIFT           8\n#define HINIC_EQ_ELEM_DESC_WRAPPED_SHIFT        31\n\n#define HINIC_EQ_ELEM_DESC_TYPE_MASK            0x7F\n#define HINIC_EQ_ELEM_DESC_SRC_MASK             0x1\n#define HINIC_EQ_ELEM_DESC_SIZE_MASK            0xFF\n#define HINIC_EQ_ELEM_DESC_WRAPPED_MASK         0x1\n\n#define HINIC_EQ_ELEM_DESC_SET(val, member)     \\\n\t\t\t(((u32)(val) & HINIC_EQ_ELEM_DESC_##member##_MASK) << \\\n\t\t\t HINIC_EQ_ELEM_DESC_##member##_SHIFT)\n\n#define HINIC_EQ_ELEM_DESC_GET(val, member)     \\\n\t\t\t(((val) >> HINIC_EQ_ELEM_DESC_##member##_SHIFT) & \\\n\t\t\t HINIC_EQ_ELEM_DESC_##member##_MASK)\n\n#define HINIC_EQ_CI_IDX_SHIFT                   0\n#define HINIC_EQ_CI_WRAPPED_SHIFT               20\n#define HINIC_EQ_CI_XOR_CHKSUM_SHIFT            24\n#define HINIC_EQ_CI_INT_ARMED_SHIFT             31\n\n#define HINIC_EQ_CI_IDX_MASK                    0xFFFFF\n#define HINIC_EQ_CI_WRAPPED_MASK                0x1\n#define HINIC_EQ_CI_XOR_CHKSUM_MASK             0xF\n#define HINIC_EQ_CI_INT_ARMED_MASK              0x1\n\n#define HINIC_EQ_CI_SET(val, member)            \\\n\t\t\t(((u32)(val) & HINIC_EQ_CI_##member##_MASK) << \\\n\t\t\t HINIC_EQ_CI_##member##_SHIFT)\n\n#define HINIC_EQ_CI_CLEAR(val, member)          \\\n\t\t\t((val) & (~(HINIC_EQ_CI_##member##_MASK \\\n\t\t\t << HINIC_EQ_CI_##member##_SHIFT)))\n\n#define HINIC_MAX_AEQS                  4\n#define HINIC_MAX_CEQS                  32\n\n#define HINIC_AEQE_SIZE                 64\n#define HINIC_CEQE_SIZE                 4\n\n#define HINIC_AEQE_DESC_SIZE            4\n#define HINIC_AEQE_DATA_SIZE            \\\n\t\t\t(HINIC_AEQE_SIZE - HINIC_AEQE_DESC_SIZE)\n\n#define HINIC_DEFAULT_AEQ_LEN           64\n#define HINIC_DEFAULT_CEQ_LEN           1024\n\n#define HINIC_EQ_PAGE_SIZE              SZ_4K\n\n#define HINIC_CEQ_ID_CMDQ               0\n\nenum hinic_eq_type {\n\tHINIC_AEQ,\n\tHINIC_CEQ,\n};\n\nenum hinic_aeq_type {\n\tHINIC_MBX_FROM_FUNC = 1,\n\tHINIC_MSG_FROM_MGMT_CPU = 2,\n\tHINIC_MBX_SEND_RSLT = 5,\n\tHINIC_MAX_AEQ_EVENTS,\n};\n\nenum hinic_ceq_type {\n\tHINIC_CEQ_CMDQ = 3,\n\n\tHINIC_MAX_CEQ_EVENTS,\n};\n\nenum hinic_eqe_state {\n\tHINIC_EQE_ENABLED = BIT(0),\n\tHINIC_EQE_RUNNING = BIT(1),\n};\n\nstruct hinic_aeq_elem {\n\tu8      data[HINIC_AEQE_DATA_SIZE];\n\t__be32  desc;\n};\n\nstruct hinic_eq_work {\n\tstruct work_struct      work;\n\tvoid                    *data;\n};\n\nstruct hinic_eq {\n\tstruct hinic_hwif       *hwif;\n\tstruct hinic_hwdev      *hwdev;\n\tenum hinic_eq_type      type;\n\tint                     q_id;\n\tu32                     q_len;\n\tu32                     page_size;\n\n\tu32                     cons_idx;\n\tint                     wrapped;\n\n\tsize_t                  elem_size;\n\tint                     num_pages;\n\tint                     num_elem_in_pg;\n\n\tstruct msix_entry       msix_entry;\n\tchar\t\t\tirq_name[64];\n\n\tdma_addr_t              *dma_addr;\n\tvoid                    **virt_addr;\n\n\tstruct hinic_eq_work    aeq_work;\n\n\tstruct tasklet_struct   ceq_tasklet;\n};\n\nstruct hinic_hw_event_cb {\n\tvoid    (*hwe_handler)(void *handle, void *data, u8 size);\n\tvoid                    *handle;\n\tunsigned long           hwe_state;\n};\n\nstruct hinic_aeqs {\n\tstruct hinic_hwif       *hwif;\n\n\tstruct hinic_eq         aeq[HINIC_MAX_AEQS];\n\tint                     num_aeqs;\n\n\tstruct hinic_hw_event_cb hwe_cb[HINIC_MAX_AEQ_EVENTS];\n\n\tstruct workqueue_struct *workq;\n};\n\nstruct hinic_ceq_cb {\n\tvoid    (*handler)(void *handle, u32 ceqe_data);\n\tvoid                    *handle;\n\tenum hinic_eqe_state    ceqe_state;\n};\n\nstruct hinic_ceqs {\n\tstruct hinic_hwif       *hwif;\n\tstruct hinic_hwdev\t\t*hwdev;\n\tstruct hinic_eq         ceq[HINIC_MAX_CEQS];\n\tint                     num_ceqs;\n\n\tstruct hinic_ceq_cb     ceq_cb[HINIC_MAX_CEQ_EVENTS];\n};\n\nvoid hinic_aeq_register_hw_cb(struct hinic_aeqs *aeqs,\n\t\t\t      enum hinic_aeq_type event, void *handle,\n\t\t\t      void (*hwe_handler)(void *handle, void *data,\n\t\t\t\t\t\t  u8 size));\n\nvoid hinic_aeq_unregister_hw_cb(struct hinic_aeqs *aeqs,\n\t\t\t\tenum hinic_aeq_type event);\n\nvoid hinic_ceq_register_cb(struct hinic_ceqs *ceqs,\n\t\t\t   enum hinic_ceq_type event, void *handle,\n\t\t\t   void (*ceq_cb)(void *handle, u32 ceqe_data));\n\nvoid hinic_ceq_unregister_cb(struct hinic_ceqs *ceqs,\n\t\t\t     enum hinic_ceq_type event);\n\nint hinic_aeqs_init(struct hinic_aeqs *aeqs, struct hinic_hwif *hwif,\n\t\t    int num_aeqs, u32 q_len, u32 page_size,\n\t\t    struct msix_entry *msix_entries);\n\nvoid hinic_aeqs_free(struct hinic_aeqs *aeqs);\n\nint hinic_ceqs_init(struct hinic_ceqs *ceqs, struct hinic_hwif *hwif,\n\t\t    int num_ceqs, u32 q_len, u32 page_size,\n\t\t    struct msix_entry *msix_entries);\n\nvoid hinic_ceqs_free(struct hinic_ceqs *ceqs);\n\nvoid hinic_dump_ceq_info(struct hinic_hwdev *hwdev);\n\nvoid hinic_dump_aeq_info(struct hinic_hwdev *hwdev);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}