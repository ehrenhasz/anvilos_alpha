{
  "module_name": "ax88796c_spi.c",
  "hash_id": "f392fe9368048406e2d9223b8669710537e53b5e9e906fd5ab55d08435e8d35c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/asix/ax88796c_spi.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt)\t\"ax88796c: \" fmt\n\n#include <linux/string.h>\n#include <linux/spi/spi.h>\n\n#include \"ax88796c_spi.h\"\n\nconst u8 ax88796c_rx_cmd_buf[5] = {AX_SPICMD_READ_RXQ, 0xFF, 0xFF, 0xFF, 0xFF};\nconst u8 ax88796c_tx_cmd_buf[4] = {AX_SPICMD_WRITE_TXQ, 0xFF, 0xFF, 0xFF};\n\n \nint axspi_wakeup(struct axspi_data *ax_spi)\n{\n\tint ret;\n\n\tax_spi->cmd_buf[0] = AX_SPICMD_EXIT_PWD;\t \n\tret = spi_write(ax_spi->spi, ax_spi->cmd_buf, 1);\n\tif (ret)\n\t\tdev_err(&ax_spi->spi->dev, \"%s() failed: ret = %d\\n\", __func__, ret);\n\treturn ret;\n}\n\nint axspi_read_status(struct axspi_data *ax_spi, struct spi_status *status)\n{\n\tint ret;\n\n\t \n\tax_spi->cmd_buf[0] = AX_SPICMD_READ_STATUS;\n\tret = spi_write_then_read(ax_spi->spi, ax_spi->cmd_buf, 1, (u8 *)status, 3);\n\tif (ret)\n\t\tdev_err(&ax_spi->spi->dev, \"%s() failed: ret = %d\\n\", __func__, ret);\n\telse\n\t\tle16_to_cpus(&status->isr);\n\n\treturn ret;\n}\n\nint axspi_read_rxq(struct axspi_data *ax_spi, void *data, int len)\n{\n\tstruct spi_transfer *xfer = ax_spi->spi_rx_xfer;\n\tint ret;\n\n\tmemcpy(ax_spi->cmd_buf, ax88796c_rx_cmd_buf, 5);\n\n\txfer->tx_buf = ax_spi->cmd_buf;\n\txfer->rx_buf = NULL;\n\txfer->len = ax_spi->comp ? 2 : 5;\n\txfer->bits_per_word = 8;\n\tspi_message_add_tail(xfer, &ax_spi->rx_msg);\n\n\txfer++;\n\txfer->rx_buf = data;\n\txfer->tx_buf = NULL;\n\txfer->len = len;\n\txfer->bits_per_word = 8;\n\tspi_message_add_tail(xfer, &ax_spi->rx_msg);\n\tret = spi_sync(ax_spi->spi, &ax_spi->rx_msg);\n\tif (ret)\n\t\tdev_err(&ax_spi->spi->dev, \"%s() failed: ret = %d\\n\", __func__, ret);\n\n\treturn ret;\n}\n\nint axspi_write_txq(const struct axspi_data *ax_spi, void *data, int len)\n{\n\treturn spi_write(ax_spi->spi, data, len);\n}\n\nu16 axspi_read_reg(struct axspi_data *ax_spi, u8 reg)\n{\n\tint ret;\n\tint len = ax_spi->comp ? 3 : 4;\n\n\tax_spi->cmd_buf[0] = 0x03;\t \n\tax_spi->cmd_buf[1] = reg;\t \n\tax_spi->cmd_buf[2] = 0xFF;\t \n\tax_spi->cmd_buf[3] = 0xFF;\t \n\tret = spi_write_then_read(ax_spi->spi,\n\t\t\t\t  ax_spi->cmd_buf, len,\n\t\t\t\t  ax_spi->rx_buf, 2);\n\tif (ret) {\n\t\tdev_err(&ax_spi->spi->dev,\n\t\t\t\"%s() failed: ret = %d\\n\", __func__, ret);\n\t\treturn 0xFFFF;\n\t}\n\n\tle16_to_cpus((u16 *)ax_spi->rx_buf);\n\n\treturn *(u16 *)ax_spi->rx_buf;\n}\n\nint axspi_write_reg(struct axspi_data *ax_spi, u8 reg, u16 value)\n{\n\tint ret;\n\n\tmemset(ax_spi->cmd_buf, 0, sizeof(ax_spi->cmd_buf));\n\tax_spi->cmd_buf[0] = AX_SPICMD_WRITE_REG;\t \n\tax_spi->cmd_buf[1] = reg;\t\t\t \n\tax_spi->cmd_buf[2] = value;\n\tax_spi->cmd_buf[3] = value >> 8;\n\n\tret = spi_write(ax_spi->spi, ax_spi->cmd_buf, 4);\n\tif (ret)\n\t\tdev_err(&ax_spi->spi->dev, \"%s() failed: ret = %d\\n\", __func__, ret);\n\treturn ret;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}