{
  "module_name": "hclge_ptp.h",
  "hash_id": "7d7a0eac2d473619ad4c2f5f840b24d1bb1fde08c95a76b2e3f53f8d64b6dea2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/hisilicon/hns3/hns3pf/hclge_ptp.h",
  "human_readable_source": " \n\n\n#ifndef __HCLGE_PTP_H\n#define __HCLGE_PTP_H\n\n#include <linux/ptp_clock_kernel.h>\n#include <linux/net_tstamp.h>\n#include <linux/types.h>\n\nstruct hclge_dev;\nstruct ifreq;\n\n#define HCLGE_PTP_REG_OFFSET\t0x29000\n\n#define HCLGE_PTP_TX_TS_SEQID_REG\t0x0\n#define HCLGE_PTP_TX_TS_NSEC_REG\t0x4\n#define HCLGE_PTP_TX_TS_NSEC_MASK\tGENMASK(29, 0)\n#define HCLGE_PTP_TX_TS_SEC_L_REG\t0x8\n#define HCLGE_PTP_TX_TS_SEC_H_REG\t0xC\n#define HCLGE_PTP_TX_TS_SEC_H_MASK\tGENMASK(15, 0)\n#define HCLGE_PTP_TX_TS_CNT_REG\t\t0x30\n\n#define HCLGE_PTP_TIME_SEC_H_REG\t0x50\n#define HCLGE_PTP_TIME_SEC_H_MASK\tGENMASK(15, 0)\n#define HCLGE_PTP_TIME_SEC_L_REG\t0x54\n#define HCLGE_PTP_TIME_NSEC_REG\t\t0x58\n#define HCLGE_PTP_TIME_NSEC_MASK\tGENMASK(29, 0)\n#define HCLGE_PTP_TIME_NSEC_NEG\t\tBIT(31)\n#define HCLGE_PTP_TIME_SYNC_REG\t\t0x5C\n#define HCLGE_PTP_TIME_SYNC_EN\t\tBIT(0)\n#define HCLGE_PTP_TIME_ADJ_REG\t\t0x60\n#define HCLGE_PTP_TIME_ADJ_EN\t\tBIT(0)\n#define HCLGE_PTP_CYCLE_QUO_REG\t\t0x64\n#define HCLGE_PTP_CYCLE_QUO_MASK\tGENMASK(7, 0)\n#define HCLGE_PTP_CYCLE_DEN_REG\t\t0x68\n#define HCLGE_PTP_CYCLE_NUM_REG\t\t0x6C\n#define HCLGE_PTP_CYCLE_CFG_REG\t\t0x70\n#define HCLGE_PTP_CYCLE_ADJ_EN\t\tBIT(0)\n#define HCLGE_PTP_CUR_TIME_SEC_H_REG\t0x74\n#define HCLGE_PTP_CUR_TIME_SEC_L_REG\t0x78\n#define HCLGE_PTP_CUR_TIME_NSEC_REG\t0x7C\n\n#define HCLGE_PTP_CYCLE_ADJ_MAX\t\t500000000\n#define HCLGE_PTP_SEC_H_OFFSET\t\t32u\n#define HCLGE_PTP_SEC_L_MASK\t\tGENMASK(31, 0)\n\n#define HCLGE_PTP_FLAG_EN\t\t0\n#define HCLGE_PTP_FLAG_TX_EN\t\t1\n#define HCLGE_PTP_FLAG_RX_EN\t\t2\n\nstruct hclge_ptp_cycle {\n\tu32 quo;\n\tu32 numer;\n\tu32 den;\n};\n\nstruct hclge_ptp {\n\tstruct hclge_dev *hdev;\n\tstruct ptp_clock *clock;\n\tstruct sk_buff *tx_skb;\n\tunsigned long flags;\n\tvoid __iomem *io_base;\n\tstruct ptp_clock_info info;\n\tstruct hwtstamp_config ts_cfg;\n\tspinlock_t lock;\t \n\tu32 ptp_cfg;\n\tu32 last_tx_seqid;\n\tstruct hclge_ptp_cycle cycle;\n\tunsigned long tx_start;\n\tunsigned long tx_cnt;\n\tunsigned long tx_skipped;\n\tunsigned long tx_cleaned;\n\tunsigned long last_rx;\n\tunsigned long rx_cnt;\n\tunsigned long tx_timeout;\n};\n\nstruct hclge_ptp_int_cmd {\n#define HCLGE_PTP_INT_EN_B\tBIT(0)\n\n\tu8 int_en;\n\tu8 rsvd[23];\n};\n\nenum hclge_ptp_udp_type {\n\tHCLGE_PTP_UDP_NOT_TYPE,\n\tHCLGE_PTP_UDP_P13F_TYPE,\n\tHCLGE_PTP_UDP_P140_TYPE,\n\tHCLGE_PTP_UDP_FULL_TYPE,\n};\n\nenum hclge_ptp_msg_type {\n\tHCLGE_PTP_MSG_TYPE_V2_L2,\n\tHCLGE_PTP_MSG_TYPE_V2,\n\tHCLGE_PTP_MSG_TYPE_V2_EVENT,\n};\n\nenum hclge_ptp_msg0_type {\n\tHCLGE_PTP_MSG0_V2_DELAY_REQ = 1,\n\tHCLGE_PTP_MSG0_V2_PDELAY_REQ,\n\tHCLGE_PTP_MSG0_V2_DELAY_RESP,\n\tHCLGE_PTP_MSG0_V2_EVENT = 0xF,\n};\n\n#define HCLGE_PTP_MSG1_V2_DEFAULT\t1\n\nstruct hclge_ptp_cfg_cmd {\n#define HCLGE_PTP_EN_B\t\t\tBIT(0)\n#define HCLGE_PTP_TX_EN_B\t\tBIT(1)\n#define HCLGE_PTP_RX_EN_B\t\tBIT(2)\n#define HCLGE_PTP_UDP_EN_SHIFT\t\t3\n#define HCLGE_PTP_UDP_EN_MASK\t\tGENMASK(4, 3)\n#define HCLGE_PTP_MSG_TYPE_SHIFT\t8\n#define HCLGE_PTP_MSG_TYPE_MASK\t\tGENMASK(9, 8)\n#define HCLGE_PTP_MSG1_SHIFT\t\t16\n#define HCLGE_PTP_MSG1_MASK\t\tGENMASK(19, 16)\n#define HCLGE_PTP_MSG0_SHIFT\t\t24\n#define HCLGE_PTP_MSG0_MASK\t\tGENMASK(27, 24)\n\n\t__le32 cfg;\n\tu8 rsvd[20];\n};\n\nstatic inline struct hclge_dev *hclge_ptp_get_hdev(struct ptp_clock_info *info)\n{\n\tstruct hclge_ptp *ptp = container_of(info, struct hclge_ptp, info);\n\n\treturn ptp->hdev;\n}\n\nbool hclge_ptp_set_tx_info(struct hnae3_handle *handle, struct sk_buff *skb);\nvoid hclge_ptp_clean_tx_hwts(struct hclge_dev *hdev);\nvoid hclge_ptp_get_rx_hwts(struct hnae3_handle *handle, struct sk_buff *skb,\n\t\t\t   u32 nsec, u32 sec);\nint hclge_ptp_get_cfg(struct hclge_dev *hdev, struct ifreq *ifr);\nint hclge_ptp_set_cfg(struct hclge_dev *hdev, struct ifreq *ifr);\nint hclge_ptp_init(struct hclge_dev *hdev);\nvoid hclge_ptp_uninit(struct hclge_dev *hdev);\nint hclge_ptp_get_ts_info(struct hnae3_handle *handle,\n\t\t\t  struct ethtool_ts_info *info);\nint hclge_ptp_cfg_qry(struct hclge_dev *hdev, u32 *cfg);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}