{
  "module_name": "hclgevf_regs.c",
  "hash_id": "47827b31158cc53d2a86c48b67d5b7a516e33449dd069d92b1ace267b238fe19",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf_regs.c",
  "human_readable_source": "\n\n\n#include \"hclgevf_main.h\"\n#include \"hclgevf_regs.h\"\n#include \"hnae3.h\"\n\nstatic const u32 cmdq_reg_addr_list[] = {HCLGE_COMM_NIC_CSQ_BASEADDR_L_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CSQ_BASEADDR_H_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CSQ_DEPTH_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CSQ_TAIL_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CSQ_HEAD_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CRQ_BASEADDR_L_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CRQ_BASEADDR_H_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CRQ_DEPTH_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CRQ_TAIL_REG,\n\t\t\t\t\t HCLGE_COMM_NIC_CRQ_HEAD_REG,\n\t\t\t\t\t HCLGE_COMM_VECTOR0_CMDQ_SRC_REG,\n\t\t\t\t\t HCLGE_COMM_VECTOR0_CMDQ_STATE_REG,\n\t\t\t\t\t HCLGE_COMM_CMDQ_INTR_EN_REG,\n\t\t\t\t\t HCLGE_COMM_CMDQ_INTR_GEN_REG};\n\nstatic const u32 common_reg_addr_list[] = {HCLGEVF_MISC_VECTOR_REG_BASE,\n\t\t\t\t\t   HCLGEVF_RST_ING,\n\t\t\t\t\t   HCLGEVF_GRO_EN_REG};\n\nstatic const u32 ring_reg_addr_list[] = {HCLGEVF_RING_RX_ADDR_L_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_ADDR_H_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_BD_NUM_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_BD_LENGTH_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_MERGE_EN_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_TAIL_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_HEAD_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_FBD_NUM_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_OFFSET_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_FBD_OFFSET_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_STASH_REG,\n\t\t\t\t\t HCLGEVF_RING_RX_BD_ERR_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_ADDR_L_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_ADDR_H_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_BD_NUM_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_PRIORITY_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_TC_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_MERGE_EN_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_TAIL_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_HEAD_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_FBD_NUM_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_OFFSET_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_EBD_NUM_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_EBD_OFFSET_REG,\n\t\t\t\t\t HCLGEVF_RING_TX_BD_ERR_REG,\n\t\t\t\t\t HCLGEVF_RING_EN_REG};\n\nstatic const u32 tqp_intr_reg_addr_list[] = {HCLGEVF_TQP_INTR_CTRL_REG,\n\t\t\t\t\t     HCLGEVF_TQP_INTR_GL0_REG,\n\t\t\t\t\t     HCLGEVF_TQP_INTR_GL1_REG,\n\t\t\t\t\t     HCLGEVF_TQP_INTR_GL2_REG,\n\t\t\t\t\t     HCLGEVF_TQP_INTR_RL_REG};\n\nenum hclgevf_reg_tag {\n\tHCLGEVF_REG_TAG_CMDQ = 0,\n\tHCLGEVF_REG_TAG_COMMON,\n\tHCLGEVF_REG_TAG_RING,\n\tHCLGEVF_REG_TAG_TQP_INTR,\n};\n\n#pragma pack(4)\nstruct hclgevf_reg_tlv {\n\tu16 tag;\n\tu16 len;\n};\n\nstruct hclgevf_reg_header {\n\tu64 magic_number;\n\tu8 is_vf;\n\tu8 rsv[7];\n};\n\n#pragma pack()\n\n#define HCLGEVF_REG_TLV_SIZE\t\tsizeof(struct hclgevf_reg_tlv)\n#define HCLGEVF_REG_HEADER_SIZE\t\tsizeof(struct hclgevf_reg_header)\n#define HCLGEVF_REG_TLV_SPACE\t\t(sizeof(struct hclgevf_reg_tlv) / sizeof(u32))\n#define HCLGEVF_REG_HEADER_SPACE\t(sizeof(struct hclgevf_reg_header) / sizeof(u32))\n#define HCLGEVF_REG_MAGIC_NUMBER\t0x686e733372656773  \n\nstatic u32 hclgevf_reg_get_header(void *data)\n{\n\tstruct hclgevf_reg_header *header = data;\n\n\theader->magic_number = HCLGEVF_REG_MAGIC_NUMBER;\n\theader->is_vf = 0x1;\n\n\treturn HCLGEVF_REG_HEADER_SPACE;\n}\n\nstatic u32 hclgevf_reg_get_tlv(u32 tag, u32 regs_num, void *data)\n{\n\tstruct hclgevf_reg_tlv *tlv = data;\n\n\ttlv->tag = tag;\n\ttlv->len = regs_num * sizeof(u32) + HCLGEVF_REG_TLV_SIZE;\n\n\treturn HCLGEVF_REG_TLV_SPACE;\n}\n\nint hclgevf_get_regs_len(struct hnae3_handle *handle)\n{\n\tstruct hclgevf_dev *hdev = hclgevf_ae_get_hdev(handle);\n\tint cmdq_len, common_len, ring_len, tqp_intr_len;\n\n\tcmdq_len = HCLGEVF_REG_TLV_SIZE + sizeof(cmdq_reg_addr_list);\n\tcommon_len = HCLGEVF_REG_TLV_SIZE + sizeof(common_reg_addr_list);\n\tring_len = HCLGEVF_REG_TLV_SIZE + sizeof(ring_reg_addr_list);\n\ttqp_intr_len = HCLGEVF_REG_TLV_SIZE + sizeof(tqp_intr_reg_addr_list);\n\n\t \n\treturn HCLGEVF_REG_HEADER_SIZE + cmdq_len + common_len +\n\t       tqp_intr_len * (hdev->num_msi_used - 1) +\n\t       ring_len * hdev->num_tqps;\n}\n\nvoid hclgevf_get_regs(struct hnae3_handle *handle, u32 *version,\n\t\t      void *data)\n{\n#define HCLGEVF_RING_REG_OFFSET\t\t0x200\n#define HCLGEVF_RING_INT_REG_OFFSET\t0x4\n\n\tstruct hclgevf_dev *hdev = hclgevf_ae_get_hdev(handle);\n\tint i, j, reg_um;\n\tu32 *reg = data;\n\n\t*version = hdev->fw_version;\n\treg += hclgevf_reg_get_header(reg);\n\n\t \n\treg_um = sizeof(cmdq_reg_addr_list) / sizeof(u32);\n\treg += hclgevf_reg_get_tlv(HCLGEVF_REG_TAG_CMDQ, reg_um, reg);\n\tfor (i = 0; i < reg_um; i++)\n\t\t*reg++ = hclgevf_read_dev(&hdev->hw, cmdq_reg_addr_list[i]);\n\n\treg_um = sizeof(common_reg_addr_list) / sizeof(u32);\n\treg += hclgevf_reg_get_tlv(HCLGEVF_REG_TAG_COMMON, reg_um, reg);\n\tfor (i = 0; i < reg_um; i++)\n\t\t*reg++ = hclgevf_read_dev(&hdev->hw, common_reg_addr_list[i]);\n\n\treg_um = sizeof(ring_reg_addr_list) / sizeof(u32);\n\tfor (j = 0; j < hdev->num_tqps; j++) {\n\t\treg += hclgevf_reg_get_tlv(HCLGEVF_REG_TAG_RING, reg_um, reg);\n\t\tfor (i = 0; i < reg_um; i++)\n\t\t\t*reg++ = hclgevf_read_dev(&hdev->hw,\n\t\t\t\t\t\t  ring_reg_addr_list[i] +\n\t\t\t\t\t\t  HCLGEVF_RING_REG_OFFSET * j);\n\t}\n\n\treg_um = sizeof(tqp_intr_reg_addr_list) / sizeof(u32);\n\tfor (j = 0; j < hdev->num_msi_used - 1; j++) {\n\t\treg += hclgevf_reg_get_tlv(HCLGEVF_REG_TAG_TQP_INTR, reg_um, reg);\n\t\tfor (i = 0; i < reg_um; i++)\n\t\t\t*reg++ = hclgevf_read_dev(&hdev->hw,\n\t\t\t\t\t\t  tqp_intr_reg_addr_list[i] +\n\t\t\t\t\t\t  HCLGEVF_RING_INT_REG_OFFSET * j);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}