{
  "module_name": "hclgevf_main.h",
  "hash_id": "a9f67036f7467bcf2a98fe629e0c07e482693ed556cf170706acd7d0adc8f09c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/hisilicon/hns3/hns3vf/hclgevf_main.h",
  "human_readable_source": " \n \n\n#ifndef __HCLGEVF_MAIN_H\n#define __HCLGEVF_MAIN_H\n#include <linux/fs.h>\n#include <linux/if_vlan.h>\n#include <linux/types.h>\n#include <net/devlink.h>\n#include \"hclge_mbx.h\"\n#include \"hclgevf_cmd.h\"\n#include \"hnae3.h\"\n#include \"hclge_comm_rss.h\"\n#include \"hclge_comm_tqp_stats.h\"\n\n#define HCLGEVF_MOD_VERSION \"1.0\"\n#define HCLGEVF_DRIVER_NAME \"hclgevf\"\n\n#define HCLGEVF_MAX_VLAN_ID\t4095\n#define HCLGEVF_MISC_VECTOR_NUM\t\t0\n\n#define HCLGEVF_INVALID_VPORT\t\t0xffff\n#define HCLGEVF_GENERAL_TASK_INTERVAL\t  5\n#define HCLGEVF_KEEP_ALIVE_TASK_INTERVAL  2\n\n \n#define HCLGEVF_MAX_VF_VECTOR_NUM\t(32 + 1)\n\n#define HCLGEVF_VECTOR_REG_BASE\t\t0x20000\n#define HCLGEVF_MISC_VECTOR_REG_BASE\t0x20400\n#define HCLGEVF_VECTOR_REG_OFFSET\t0x4\n#define HCLGEVF_VECTOR_VF_OFFSET\t\t0x100000\n\n \n#define HCLGEVF_GRO_EN_REG\t\t\t0x28000\n#define HCLGEVF_RXD_ADV_LAYOUT_EN_REG\t\t0x28008\n\n \n#define HCLGEVF_RING_RX_ADDR_L_REG\t\t0x80000\n#define HCLGEVF_RING_RX_ADDR_H_REG\t\t0x80004\n#define HCLGEVF_RING_RX_BD_NUM_REG\t\t0x80008\n#define HCLGEVF_RING_RX_BD_LENGTH_REG\t\t0x8000C\n#define HCLGEVF_RING_RX_MERGE_EN_REG\t\t0x80014\n#define HCLGEVF_RING_RX_TAIL_REG\t\t0x80018\n#define HCLGEVF_RING_RX_HEAD_REG\t\t0x8001C\n#define HCLGEVF_RING_RX_FBD_NUM_REG\t\t0x80020\n#define HCLGEVF_RING_RX_OFFSET_REG\t\t0x80024\n#define HCLGEVF_RING_RX_FBD_OFFSET_REG\t\t0x80028\n#define HCLGEVF_RING_RX_STASH_REG\t\t0x80030\n#define HCLGEVF_RING_RX_BD_ERR_REG\t\t0x80034\n#define HCLGEVF_RING_TX_ADDR_L_REG\t\t0x80040\n#define HCLGEVF_RING_TX_ADDR_H_REG\t\t0x80044\n#define HCLGEVF_RING_TX_BD_NUM_REG\t\t0x80048\n#define HCLGEVF_RING_TX_PRIORITY_REG\t\t0x8004C\n#define HCLGEVF_RING_TX_TC_REG\t\t\t0x80050\n#define HCLGEVF_RING_TX_MERGE_EN_REG\t\t0x80054\n#define HCLGEVF_RING_TX_TAIL_REG\t\t0x80058\n#define HCLGEVF_RING_TX_HEAD_REG\t\t0x8005C\n#define HCLGEVF_RING_TX_FBD_NUM_REG\t\t0x80060\n#define HCLGEVF_RING_TX_OFFSET_REG\t\t0x80064\n#define HCLGEVF_RING_TX_EBD_NUM_REG\t\t0x80068\n#define HCLGEVF_RING_TX_EBD_OFFSET_REG\t\t0x80070\n#define HCLGEVF_RING_TX_BD_ERR_REG\t\t0x80074\n#define HCLGEVF_RING_EN_REG\t\t\t0x80090\n\n \n#define HCLGEVF_TQP_INTR_CTRL_REG\t\t0x20000\n#define HCLGEVF_TQP_INTR_GL0_REG\t\t0x20100\n#define HCLGEVF_TQP_INTR_GL1_REG\t\t0x20200\n#define HCLGEVF_TQP_INTR_GL2_REG\t\t0x20300\n#define HCLGEVF_TQP_INTR_RL_REG\t\t\t0x20900\n\n \n#define HCLGEVF_VECTOR0_RX_CMDQ_INT_B\t1\n \n#define HCLGEVF_VECTOR0_RST_INT_B\t2\n\n#define HCLGEVF_TQP_RESET_TRY_TIMES\t10\n \n#define HCLGEVF_RST_ING\t\t\t0x20C00\n#define HCLGEVF_FUN_RST_ING_BIT\t\tBIT(0)\n#define HCLGEVF_GLOBAL_RST_ING_BIT\tBIT(5)\n#define HCLGEVF_CORE_RST_ING_BIT\tBIT(6)\n#define HCLGEVF_IMP_RST_ING_BIT\t\tBIT(7)\n#define HCLGEVF_RST_ING_BITS \\\n\t(HCLGEVF_FUN_RST_ING_BIT | HCLGEVF_GLOBAL_RST_ING_BIT | \\\n\t HCLGEVF_CORE_RST_ING_BIT | HCLGEVF_IMP_RST_ING_BIT)\n\n#define HCLGEVF_VF_RST_ING\t\t0x07008\n#define HCLGEVF_VF_RST_ING_BIT\t\tBIT(16)\n\n#define HCLGEVF_WAIT_RESET_DONE\t\t100\n\n#define HCLGEVF_RSS_IND_TBL_SIZE\t\t512\n\n#define HCLGEVF_TQP_MEM_SIZE\t\t0x10000\n#define HCLGEVF_MEM_BAR\t\t\t4\n \n#define HCLGEVF_NIC_MEM_OFFSET(hdev)\t\\\n\t(pci_resource_len((hdev)->pdev, HCLGEVF_MEM_BAR) >> 1)\n#define HCLGEVF_TQP_MEM_OFFSET(hdev, i)\t\t\\\n\t(HCLGEVF_NIC_MEM_OFFSET(hdev) + HCLGEVF_TQP_MEM_SIZE * (i))\n\n#define HCLGEVF_MAC_MAX_FRAME\t\t9728\n\n#define HCLGEVF_STATS_TIMER_INTERVAL\t36U\n\n#define hclgevf_read_dev(a, reg) \\\n\thclge_comm_read_reg((a)->hw.io_base, reg)\n#define hclgevf_write_dev(a, reg, value) \\\n\thclge_comm_write_reg((a)->hw.io_base, reg, value)\n\nenum hclgevf_evt_cause {\n\tHCLGEVF_VECTOR0_EVENT_RST,\n\tHCLGEVF_VECTOR0_EVENT_MBX,\n\tHCLGEVF_VECTOR0_EVENT_OTHER,\n};\n\n \nenum hclgevf_states {\n\t \n\tHCLGEVF_STATE_DOWN,\n\tHCLGEVF_STATE_DISABLED,\n\tHCLGEVF_STATE_IRQ_INITED,\n\tHCLGEVF_STATE_REMOVING,\n\tHCLGEVF_STATE_NIC_REGISTERED,\n\tHCLGEVF_STATE_ROCE_REGISTERED,\n\tHCLGEVF_STATE_SERVICE_INITED,\n\t \n\tHCLGEVF_STATE_RST_SERVICE_SCHED,\n\tHCLGEVF_STATE_RST_HANDLING,\n\tHCLGEVF_STATE_MBX_SERVICE_SCHED,\n\tHCLGEVF_STATE_MBX_HANDLING,\n\tHCLGEVF_STATE_LINK_UPDATING,\n\tHCLGEVF_STATE_PROMISC_CHANGED,\n\tHCLGEVF_STATE_RST_FAIL,\n\tHCLGEVF_STATE_PF_PUSH_LINK_STATUS,\n};\n\nstruct hclgevf_mac {\n\tu8 media_type;\n\tu8 module_type;\n\tu8 mac_addr[ETH_ALEN];\n\tint link;\n\tu8 duplex;\n\tu32 speed;\n\tu64 supported;\n\tu64 advertising;\n};\n\nstruct hclgevf_hw {\n\tstruct hclge_comm_hw hw;\n\tint num_vec;\n\tstruct hclgevf_mac mac;\n};\n\nstruct hclgevf_cfg {\n\tu8 tc_num;\n\tu16 tqp_desc_num;\n\tu16 rx_buf_len;\n\tu8 phy_addr;\n\tu8 media_type;\n\tu8 mac_addr[ETH_ALEN];\n\tu32 numa_node_map;\n};\n\nstruct hclgevf_misc_vector {\n\tu8 __iomem *addr;\n\tint vector_irq;\n\tchar name[HNAE3_INT_NAME_LEN];\n};\n\nstruct hclgevf_rst_stats {\n\tu32 rst_cnt;\t\t\t \n\tu32 vf_func_rst_cnt;\t\t \n\tu32 flr_rst_cnt;\t\t \n\tu32 vf_rst_cnt;\t\t\t \n\tu32 rst_done_cnt;\t\t \n\tu32 hw_rst_done_cnt;\t\t \n\tu32 rst_fail_cnt;\t\t \n};\n\nenum HCLGEVF_MAC_ADDR_TYPE {\n\tHCLGEVF_MAC_ADDR_UC,\n\tHCLGEVF_MAC_ADDR_MC\n};\n\nenum HCLGEVF_MAC_NODE_STATE {\n\tHCLGEVF_MAC_TO_ADD,\n\tHCLGEVF_MAC_TO_DEL,\n\tHCLGEVF_MAC_ACTIVE\n};\n\nstruct hclgevf_mac_addr_node {\n\tstruct list_head node;\n\tenum HCLGEVF_MAC_NODE_STATE state;\n\tu8 mac_addr[ETH_ALEN];\n};\n\nstruct hclgevf_mac_table_cfg {\n\tspinlock_t mac_list_lock;  \n\tstruct list_head uc_mac_list;\n\tstruct list_head mc_mac_list;\n};\n\nstruct hclgevf_dev {\n\tstruct pci_dev *pdev;\n\tstruct hnae3_ae_dev *ae_dev;\n\tstruct hclgevf_hw hw;\n\tstruct hclgevf_misc_vector misc_vector;\n\tstruct hclge_comm_rss_cfg rss_cfg;\n\tunsigned long state;\n\tunsigned long flr_state;\n\tunsigned long default_reset_request;\n\tunsigned long last_reset_time;\n\tenum hnae3_reset_type reset_level;\n\tunsigned long reset_pending;\n\tenum hnae3_reset_type reset_type;\n\tstruct timer_list reset_timer;\n\n#define HCLGEVF_RESET_REQUESTED\t\t0\n#define HCLGEVF_RESET_PENDING\t\t1\n\tunsigned long reset_state;\t \n\tstruct hclgevf_rst_stats rst_stats;\n\tu32 reset_attempts;\n\tstruct semaphore reset_sem;\t \n\n\tu32 fw_version;\n\tu16 mbx_api_version;\n\tu16 num_tqps;\t\t \n\n\tu16 alloc_rss_size;\t \n\tu16 rss_size_max;\t \n\n\tu16 num_alloc_vport;\t \n\tu32 numa_node_mask;\n\tu16 rx_buf_len;\n\tu16 num_tx_desc;\t \n\tu16 num_rx_desc;\t \n\tu8 hw_tc_map;\n\tu8 has_pf_mac;\n\n\tu16 num_msi;\n\tu16 num_msi_left;\n\tu16 num_msi_used;\n\tu16 num_nic_msix;\t \n\tu16 num_roce_msix;\t \n\tu16 roce_base_msix_offset;\n\tu16 *vector_status;\n\tint *vector_irq;\n\n\tbool gro_en;\n\n\tunsigned long vlan_del_fail_bmap[BITS_TO_LONGS(VLAN_N_VID)];\n\n\tstruct hclgevf_mac_table_cfg mac_table;\n\n\tstruct hclgevf_mbx_resp_status mbx_resp;  \n\tstruct hclgevf_mbx_arq_ring arq;  \n\n\tstruct delayed_work service_task;\n\n\tstruct hclge_comm_tqp *htqp;\n\n\tstruct hnae3_handle nic;\n\tstruct hnae3_handle roce;\n\n\tstruct hnae3_client *nic_client;\n\tstruct hnae3_client *roce_client;\n\tu32 flag;\n\tunsigned long serv_processed_cnt;\n\tunsigned long last_serv_processed;\n\n\tstruct devlink *devlink;\n};\n\nstatic inline bool hclgevf_is_reset_pending(struct hclgevf_dev *hdev)\n{\n\treturn !!hdev->reset_pending;\n}\n\nint hclgevf_send_mbx_msg(struct hclgevf_dev *hdev,\n\t\t\t struct hclge_vf_to_pf_msg *send_msg, bool need_resp,\n\t\t\t u8 *resp_data, u16 resp_len);\nvoid hclgevf_mbx_handler(struct hclgevf_dev *hdev);\nvoid hclgevf_mbx_async_handler(struct hclgevf_dev *hdev);\n\nvoid hclgevf_update_link_status(struct hclgevf_dev *hdev, int link_state);\nvoid hclgevf_update_speed_duplex(struct hclgevf_dev *hdev, u32 speed,\n\t\t\t\t u8 duplex);\nvoid hclgevf_reset_task_schedule(struct hclgevf_dev *hdev);\nvoid hclgevf_mbx_task_schedule(struct hclgevf_dev *hdev);\nvoid hclgevf_update_port_base_vlan_info(struct hclgevf_dev *hdev, u16 state,\n\t\t\tstruct hclge_mbx_port_base_vlan *port_base_vlan);\nstruct hclgevf_dev *hclgevf_ae_get_hdev(struct hnae3_handle *handle);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}