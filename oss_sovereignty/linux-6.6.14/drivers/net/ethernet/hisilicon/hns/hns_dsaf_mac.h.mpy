{
  "module_name": "hns_dsaf_mac.h",
  "hash_id": "c3202038d49b8123579d2b947b74555224854e049819937f7d02b1b500258d8d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/hisilicon/hns/hns_dsaf_mac.h",
  "human_readable_source": " \n \n\n#ifndef _HNS_DSAF_MAC_H\n#define _HNS_DSAF_MAC_H\n\n#include <linux/if_vlan.h>\n#include <linux/kernel.h>\n#include <linux/phy.h>\n#include <linux/regmap.h>\n#include \"hns_dsaf_main.h\"\n\nstruct dsaf_device;\n\n#define MAC_GMAC_SUPPORTED \\\n\t(SUPPORTED_10baseT_Half \\\n\t| SUPPORTED_10baseT_Full \\\n\t| SUPPORTED_100baseT_Half \\\n\t| SUPPORTED_100baseT_Full \\\n\t| SUPPORTED_Autoneg)\n\n#define MAC_DEFAULT_MTU\t(ETH_HLEN + ETH_FCS_LEN + VLAN_HLEN + ETH_DATA_LEN)\n#define MAC_MAX_MTU\t\t9600\n#define MAC_MAX_MTU_V2\t\t9728\n#define MAC_MIN_MTU\t\t68\n#define MAC_MAX_MTU_DBG\t\tMAC_DEFAULT_MTU\n\n#define MAC_DEFAULT_PAUSE_TIME 0xffff\n\n#define MAC_GMAC_IDX 0\n#define MAC_XGMAC_IDX 1\n\n#define ETH_STATIC_REG\t 1\n#define ETH_DUMP_REG\t 5\n \n#define MAC_IS_BROADCAST(p)\t((*(p) == 0xff) && (*((p) + 1) == 0xff) && \\\n\t\t(*((p) + 2) == 0xff) &&  (*((p) + 3) == 0xff)  && \\\n\t\t(*((p) + 4) == 0xff) && (*((p) + 5) == 0xff))\n\n \n#define MAC_IS_L3_MULTICAST(p) ((*((p) + 0) == 0x01) && \\\n\t\t\t(*((p) + 1) == 0x00)   && \\\n\t\t\t(*((p) + 2) == 0x5e))\n\n \n#define MAC_IS_ALL_ZEROS(p)   ((*(p) == 0) && (*((p) + 1) == 0) && \\\n\t(*((p) + 2) == 0) && (*((p) + 3) == 0) && \\\n\t(*((p) + 4) == 0) && (*((p) + 5) == 0))\n\n \n#define MAC_IS_MULTICAST(p)\t((*((u8 *)((p) + 0)) & 0x01) ? (1) : (0))\n\nstruct mac_priv {\n\tvoid *mac;\n};\n\n \nenum mac_speed {\n\tMAC_SPEED_10\t= 10,\t    \n\tMAC_SPEED_100\t= 100,\t   \n\tMAC_SPEED_1000  = 1000,\t  \n\tMAC_SPEED_10000 = 10000\t  \n};\n\n \nenum mac_intf {\n\tMAC_IF_NONE  = 0x00000000,    \n\tMAC_IF_MII   = 0x00010000,    \n\tMAC_IF_RMII  = 0x00020000,    \n\tMAC_IF_SMII  = 0x00030000,    \n\tMAC_IF_GMII  = 0x00040000,    \n\tMAC_IF_RGMII = 0x00050000,    \n\tMAC_IF_TBI   = 0x00060000,    \n\tMAC_IF_RTBI  = 0x00070000,    \n\tMAC_IF_SGMII = 0x00080000,    \n\tMAC_IF_XGMII = 0x00090000,    \n\tMAC_IF_QSGMII = 0x000a0000\t \n};\n\n \nenum mac_mode {\n\t \n\tMAC_MODE_INVALID\t = 0,\n\t \n\tMAC_MODE_MII_10\t  = (MAC_IF_MII   | MAC_SPEED_10),\n\t \n\tMAC_MODE_MII_100\t = (MAC_IF_MII   | MAC_SPEED_100),\n\t \n\tMAC_MODE_RMII_10\t = (MAC_IF_RMII  | MAC_SPEED_10),\n\t \n\tMAC_MODE_RMII_100\t= (MAC_IF_RMII  | MAC_SPEED_100),\n\t \n\tMAC_MODE_SMII_10\t = (MAC_IF_SMII  | MAC_SPEED_10),\n\t \n\tMAC_MODE_SMII_100\t= (MAC_IF_SMII  | MAC_SPEED_100),\n\t \n\tMAC_MODE_GMII_1000   = (MAC_IF_GMII  | MAC_SPEED_1000),\n\t \n\tMAC_MODE_RGMII_10\t= (MAC_IF_RGMII | MAC_SPEED_10),\n\t \n\tMAC_MODE_RGMII_100   = (MAC_IF_RGMII | MAC_SPEED_100),\n\t \n\tMAC_MODE_RGMII_1000  = (MAC_IF_RGMII | MAC_SPEED_1000),\n\t \n\tMAC_MODE_TBI_1000\t= (MAC_IF_TBI   | MAC_SPEED_1000),\n\t \n\tMAC_MODE_RTBI_1000   = (MAC_IF_RTBI  | MAC_SPEED_1000),\n\t \n\tMAC_MODE_SGMII_10\t= (MAC_IF_SGMII | MAC_SPEED_10),\n\t \n\tMAC_MODE_SGMII_100   = (MAC_IF_SGMII | MAC_SPEED_100),\n\t \n\tMAC_MODE_SGMII_1000  = (MAC_IF_SGMII | MAC_SPEED_1000),\n\t \n\tMAC_MODE_XGMII_10000 = (MAC_IF_XGMII | MAC_SPEED_10000),\n\t \n\tMAC_MODE_QSGMII_1000 = (MAC_IF_QSGMII | MAC_SPEED_1000)\n};\n\n \nenum mac_commom_mode {\n\tMAC_COMM_MODE_NONE\t  = 0,  \n\tMAC_COMM_MODE_RX\t\t= 1,  \n\tMAC_COMM_MODE_TX\t\t= 2,  \n\tMAC_COMM_MODE_RX_AND_TX = 3   \n};\n\n \nstruct mac_statistics {\n\tu64  stat_pkts64;  \n\tu64  stat_pkts65to127;  \n\tu64  stat_pkts128to255;  \n\tu64  stat_pkts256to511;  \n\tu64  stat_pkts512to1023; \n\tu64  stat_pkts1024to1518;  \n\tu64  stat_pkts1519to1522;  \n\t \n\t \n\tu64  stat_fragments;\n\t \n\tu64  stat_jabbers;\n\t \n\t \n\tu64  stat_drop_events;\n\t \n\t \n\tu64  stat_crc_align_errors;\n\t \n\t \n\tu64  stat_undersize_pkts;\n\tu64  stat_oversize_pkts;   \n\n\tu64  stat_rx_pause;\t\t    \n\tu64  stat_tx_pause;\t\t    \n\n\tu64  in_octets;\t\t \n\tu64  in_pkts;\t\t \n\tu64  in_mcast_pkts;\t \n\tu64  in_bcast_pkts;\t \n\t\t\t\t \n\t\t\t\t \n\tu64  in_discards;\n\tu64  in_errors;\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\t\t\t\t \n\tu64  out_octets;  \n\tu64  out_pkts;\t \n\tu64  out_mcast_pkts;  \n\tu64  out_bcast_pkts;  \n\t \n\t \n\tu64  out_discards;\n\tu64  out_errors;\t \n\t\t\t \n\t\t\t \n\t\t\t \n};\n\n \nstruct mac_params {\n\tchar addr[ETH_ALEN];\n\tu8 __iomem *vaddr;  \n\tstruct device *dev;\n\tu8 mac_id;\n\t \n\tenum mac_mode mac_mode;\n};\n\nstruct mac_info {\n\tu16 speed; \n\t\t \n\t\t \n\t\t \n\tu8 duplex;\t\t \n\tu8 auto_neg;\t \n\tenum hnae_loop loop_mode;\n\tu8 tx_pause_en;\n\tu8 tx_pause_time;\n\tu8 rx_pause_en;\n\tu8 pad_and_crc_en;\n\tu8 promiscuous_en;\n\tu8 port_en;\t  \n};\n\nstruct mac_entry_idx {\n\tu8 addr[ETH_ALEN];\n\tu16 vlan_id:12;\n\tu16 valid:1;\n\tu16 qos:3;\n};\n\nstruct mac_hw_stats {\n\tu64 rx_good_pkts;\t \n\tu64 rx_good_bytes;\n\tu64 rx_total_pkts;\t \n\tu64 rx_total_bytes;\t \n\tu64 rx_bad_bytes;\t \n\tu64 rx_uc_pkts;\n\tu64 rx_mc_pkts;\n\tu64 rx_bc_pkts;\n\tu64 rx_fragment_err;\t \n\tu64 rx_undersize;\t \n\tu64 rx_under_min;\n\tu64 rx_minto64;\t\t \n\tu64 rx_64bytes;\n\tu64 rx_65to127;\n\tu64 rx_128to255;\n\tu64 rx_256to511;\n\tu64 rx_512to1023;\n\tu64 rx_1024to1518;\n\tu64 rx_1519tomax;\n\tu64 rx_1519tomax_good;\t \n\tu64 rx_oversize;\n\tu64 rx_jabber_err;\n\tu64 rx_fcs_err;\n\tu64 rx_vlan_pkts;\t \n\tu64 rx_data_err;\t \n\tu64 rx_align_err;\t \n\tu64 rx_long_err;\t \n\tu64 rx_pfc_tc0;\n\tu64 rx_pfc_tc1;\t\t \n\tu64 rx_pfc_tc2;\t\t \n\tu64 rx_pfc_tc3;\t\t \n\tu64 rx_pfc_tc4;\t\t \n\tu64 rx_pfc_tc5;\t\t \n\tu64 rx_pfc_tc6;\t\t \n\tu64 rx_pfc_tc7;\t\t \n\tu64 rx_unknown_ctrl;\n\tu64 rx_filter_pkts;\t \n\tu64 rx_filter_bytes;\t \n\tu64 rx_fifo_overrun_err; \n\tu64 rx_len_err;\t\t \n\tu64 rx_comma_err;\t \n\tu64 rx_symbol_err;\t \n\tu64 tx_good_to_sw;\t \n\tu64 tx_bad_to_sw;\t \n\tu64 rx_1731_pkts;\t \n\n\tu64 tx_good_bytes;\n\tu64 tx_good_pkts;\t \n\tu64 tx_total_bytes;\t \n\tu64 tx_total_pkts;\t \n\tu64 tx_bad_bytes;\t \n\tu64 tx_bad_pkts;\t \n\tu64 tx_uc_pkts;\n\tu64 tx_mc_pkts;\n\tu64 tx_bc_pkts;\n\tu64 tx_undersize;\t \n\tu64 tx_fragment_err;\t \n\tu64 tx_under_min_pkts;\t \n\tu64 tx_64bytes;\n\tu64 tx_65to127;\n\tu64 tx_128to255;\n\tu64 tx_256to511;\n\tu64 tx_512to1023;\n\tu64 tx_1024to1518;\n\tu64 tx_1519tomax;\n\tu64 tx_1519tomax_good;\t \n\tu64 tx_oversize;\t \n\tu64 tx_jabber_err;\n\tu64 tx_underrun_err;\t \n\tu64 tx_vlan;\t\t \n\tu64 tx_crc_err;\t\t \n\tu64 tx_pfc_tc0;\n\tu64 tx_pfc_tc1;\t\t \n\tu64 tx_pfc_tc2;\t\t \n\tu64 tx_pfc_tc3;\t\t \n\tu64 tx_pfc_tc4;\t\t \n\tu64 tx_pfc_tc5;\t\t \n\tu64 tx_pfc_tc6;\t\t \n\tu64 tx_pfc_tc7;\t\t \n\tu64 tx_ctrl;\t\t \n\tu64 tx_1731_pkts;\t \n\tu64 tx_1588_pkts;\t \n\tu64 rx_good_from_sw;\t \n\tu64 rx_bad_from_sw;\t \n};\n\nstruct hns_mac_cb {\n\tstruct device *dev;\n\tstruct dsaf_device *dsaf_dev;\n\tstruct mac_priv priv;\n\tstruct fwnode_handle *fw_port;\n\tu8 __iomem *vaddr;\n\tu8 __iomem *sys_ctl_vaddr;\n\tu8 __iomem *serdes_vaddr;\n\tstruct regmap *serdes_ctrl;\n\tstruct regmap *cpld_ctrl;\n\tchar mc_mask[ETH_ALEN];\n\tu32 cpld_ctrl_reg;\n\tu32 port_rst_off;\n\tu32 port_mode_off;\n\tstruct mac_entry_idx addr_entry_idx[DSAF_MAX_VM_NUM];\n\tu8 sfp_prsnt;\n\tu8 cpld_led_value;\n\tu8 mac_id;\n\n\tu8 link;\n\tu8 half_duplex;\n\tu16 speed;\n\tu16 max_speed;\n\tu16 max_frm;\n\tu16 tx_pause_frm_time;\n\tu32 if_support;\n\tu64 txpkt_for_led;\n\tu64 rxpkt_for_led;\n\tenum hnae_port_type mac_type;\n\tenum hnae_media_type media_type;\n\tphy_interface_t phy_if;\n\tenum hnae_loop loop_mode;\n\n\tstruct phy_device *phy_dev;\n\n\tstruct mac_hw_stats hw_stats;\n};\n\nstruct mac_driver {\n\t \n\tvoid (*mac_init)(void *mac_drv);\n\t \n\tvoid (*mac_free)(void *mac_drv);\n\t \n\tvoid (*mac_enable)(void *mac_drv, enum mac_commom_mode mode);\n\t \n\tvoid (*mac_disable)(void *mac_drv, enum mac_commom_mode mode);\n\t \n\tvoid (*set_mac_addr)(void *mac_drv,\tconst char *mac_addr);\n\t \n\tint (*adjust_link)(void *mac_drv, enum mac_speed speed,\n\t\t\t   u32 full_duplex);\n\t \n\tbool (*need_adjust_link)(void *mac_drv, enum mac_speed speed,\n\t\t\t\t int duplex);\n\t \n\tvoid (*set_an_mode)(void *mac_drv, u8 enable);\n\t \n\tint (*config_loopback)(void *mac_drv, enum hnae_loop loop_mode,\n\t\t\t       u8 enable);\n\t \n\tvoid (*config_max_frame_length)(void *mac_drv, u16 newval);\n\t \n\tvoid (*config_pad_and_crc)(void *mac_drv, u8 newval);\n\t \n\tvoid (*set_tx_auto_pause_frames)(void *mac_drv, u16 pause_time);\n\t \n\tvoid (*set_promiscuous)(void *mac_drv, u8 enable);\n\tvoid (*mac_pausefrm_cfg)(void *mac_drv, u32 rx_en, u32 tx_en);\n\n\tvoid (*autoneg_stat)(void *mac_drv, u32 *enable);\n\tint (*set_pause_enable)(void *mac_drv, u32 rx_en, u32 tx_en);\n\tvoid (*get_pause_enable)(void *mac_drv, u32 *rx_en, u32 *tx_en);\n\tvoid (*get_link_status)(void *mac_drv, u32 *link_stat);\n\t \n\tvoid (*get_regs)(void *mac_drv, void *data);\n\tint (*get_regs_count)(void);\n\t \n\tvoid (*get_strings)(u32 stringset, u8 *data);\n\t \n\tint (*get_sset_count)(int stringset);\n\n\t \n\tvoid (*get_ethtool_stats)(void *mac_drv, u64 *data);\n\n\t \n\tvoid (*get_info)(void *mac_drv, struct mac_info *mac_info);\n\n\tvoid (*update_stats)(void *mac_drv);\n\tint (*wait_fifo_clean)(void *mac_drv);\n\n\tenum mac_mode mac_mode;\n\tu8 mac_id;\n\tstruct hns_mac_cb *mac_cb;\n\tu8 __iomem *io_base;\n\tunsigned int mac_en_flg; \n\tunsigned int virt_dev_num;\n\tstruct device *dev;\n};\n\nstruct mac_stats_string {\n\tconst char desc[ETH_GSTRING_LEN];\n\tunsigned long offset;\n};\n\n#define MAC_MAKE_MODE(interface, speed) (enum mac_mode)((interface) | (speed))\n#define MAC_INTERFACE_FROM_MODE(mode) (enum mac_intf)((mode) & 0xFFFF0000)\n#define MAC_SPEED_FROM_MODE(mode) (enum mac_speed)((mode) & 0x0000FFFF)\n#define MAC_STATS_FIELD_OFF(field) (offsetof(struct mac_hw_stats, field))\n\nstatic inline struct mac_driver *hns_mac_get_drv(\n\tconst struct hns_mac_cb *mac_cb)\n{\n\treturn (struct mac_driver *)(mac_cb->priv.mac);\n}\n\nvoid *hns_gmac_config(struct hns_mac_cb *mac_cb,\n\t\t      struct mac_params *mac_param);\nvoid *hns_xgmac_config(struct hns_mac_cb *mac_cb,\n\t\t       struct mac_params *mac_param);\n\nint hns_mac_init(struct dsaf_device *dsaf_dev);\nbool hns_mac_need_adjust_link(struct hns_mac_cb *mac_cb, int speed, int duplex);\nvoid hns_mac_get_link_status(struct hns_mac_cb *mac_cb,\tu32 *link_status);\nint hns_mac_change_vf_addr(struct hns_mac_cb *mac_cb, u32 vmid,\n\t\t\t   const char *addr);\nint hns_mac_set_multi(struct hns_mac_cb *mac_cb,\n\t\t      u32 port_num, char *addr, bool enable);\nint hns_mac_vm_config_bc_en(struct hns_mac_cb *mac_cb, u32 vm, bool enable);\nvoid hns_mac_start(struct hns_mac_cb *mac_cb);\nvoid hns_mac_stop(struct hns_mac_cb *mac_cb);\nvoid hns_mac_uninit(struct dsaf_device *dsaf_dev);\nvoid hns_mac_adjust_link(struct hns_mac_cb *mac_cb, int speed, int duplex);\nvoid hns_mac_reset(struct hns_mac_cb *mac_cb);\nvoid hns_mac_get_autoneg(struct hns_mac_cb *mac_cb, u32 *auto_neg);\nvoid hns_mac_get_pauseparam(struct hns_mac_cb *mac_cb, u32 *rx_en, u32 *tx_en);\nint hns_mac_set_autoneg(struct hns_mac_cb *mac_cb, u8 enable);\nint hns_mac_set_pauseparam(struct hns_mac_cb *mac_cb, u32 rx_en, u32 tx_en);\nint hns_mac_set_mtu(struct hns_mac_cb *mac_cb, u32 new_mtu, u32 buf_size);\nint hns_mac_get_port_info(struct hns_mac_cb *mac_cb,\n\t\t\t  u8 *auto_neg, u16 *speed, u8 *duplex);\nint hns_mac_config_mac_loopback(struct hns_mac_cb *mac_cb,\n\t\t\t\tenum hnae_loop loop, int en);\nvoid hns_mac_update_stats(struct hns_mac_cb *mac_cb);\nvoid hns_mac_get_stats(struct hns_mac_cb *mac_cb, u64 *data);\nvoid hns_mac_get_strings(struct hns_mac_cb *mac_cb, int stringset, u8 *data);\nint hns_mac_get_sset_count(struct hns_mac_cb *mac_cb, int stringset);\nvoid hns_mac_get_regs(struct hns_mac_cb *mac_cb, void *data);\nint hns_mac_get_regs_count(struct hns_mac_cb *mac_cb);\nvoid hns_set_led_opt(struct hns_mac_cb *mac_cb);\nint hns_cpld_led_set_id(struct hns_mac_cb *mac_cb,\n\t\t\tenum hnae_led_state status);\nvoid hns_mac_set_promisc(struct hns_mac_cb *mac_cb, u8 en);\nint hns_mac_get_inner_port_num(struct hns_mac_cb *mac_cb,\n\t\t\t       u8 vmid, u8 *port_num);\nint hns_mac_add_uc_addr(struct hns_mac_cb *mac_cb, u8 vf_id,\n\t\t\tconst unsigned char *addr);\nint hns_mac_rm_uc_addr(struct hns_mac_cb *mac_cb, u8 vf_id,\n\t\t       const unsigned char *addr);\nint hns_mac_clr_multicast(struct hns_mac_cb *mac_cb, int vfn);\nvoid hns_mac_enable(struct hns_mac_cb *mac_cb, enum mac_commom_mode mode);\nvoid hns_mac_disable(struct hns_mac_cb *mac_cb, enum mac_commom_mode mode);\nint hns_mac_wait_fifo_clean(struct hns_mac_cb *mac_cb);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}