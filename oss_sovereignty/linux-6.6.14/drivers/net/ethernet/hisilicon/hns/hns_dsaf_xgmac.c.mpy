{
  "module_name": "hns_dsaf_xgmac.c",
  "hash_id": "a89b870afca7c2f9ab6c77cf7ff09159848a1e5af125a22f38d166f58904f6d2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/hisilicon/hns/hns_dsaf_xgmac.c",
  "human_readable_source": "\n \n\n#include <linux/io-64-nonatomic-hi-lo.h>\n#include <linux/of_mdio.h>\n#include \"hns_dsaf_main.h\"\n#include \"hns_dsaf_mac.h\"\n#include \"hns_dsaf_xgmac.h\"\n#include \"hns_dsaf_reg.h\"\n\nstatic const struct mac_stats_string g_xgmac_stats_string[] = {\n\t{\"xgmac_tx_bad_pkts_minto64\", MAC_STATS_FIELD_OFF(tx_fragment_err)},\n\t{\"xgmac_tx_good_pkts_minto64\", MAC_STATS_FIELD_OFF(tx_undersize)},\n\t{\"xgmac_tx_total_pkts_minto64\",\tMAC_STATS_FIELD_OFF(tx_under_min_pkts)},\n\t{\"xgmac_tx_pkts_64\", MAC_STATS_FIELD_OFF(tx_64bytes)},\n\t{\"xgmac_tx_pkts_65to127\", MAC_STATS_FIELD_OFF(tx_65to127)},\n\t{\"xgmac_tx_pkts_128to255\", MAC_STATS_FIELD_OFF(tx_128to255)},\n\t{\"xgmac_tx_pkts_256to511\", MAC_STATS_FIELD_OFF(tx_256to511)},\n\t{\"xgmac_tx_pkts_512to1023\", MAC_STATS_FIELD_OFF(tx_512to1023)},\n\t{\"xgmac_tx_pkts_1024to1518\", MAC_STATS_FIELD_OFF(tx_1024to1518)},\n\t{\"xgmac_tx_pkts_1519tomax\", MAC_STATS_FIELD_OFF(tx_1519tomax)},\n\t{\"xgmac_tx_good_pkts_1519tomax\",\n\t\tMAC_STATS_FIELD_OFF(tx_1519tomax_good)},\n\t{\"xgmac_tx_good_pkts_untralmax\", MAC_STATS_FIELD_OFF(tx_oversize)},\n\t{\"xgmac_tx_bad_pkts_untralmax\", MAC_STATS_FIELD_OFF(tx_jabber_err)},\n\t{\"xgmac_tx_good_pkts_all\", MAC_STATS_FIELD_OFF(tx_good_pkts)},\n\t{\"xgmac_tx_good_byte_all\", MAC_STATS_FIELD_OFF(tx_good_bytes)},\n\t{\"xgmac_tx_total_pkt\", MAC_STATS_FIELD_OFF(tx_total_pkts)},\n\t{\"xgmac_tx_total_byt\", MAC_STATS_FIELD_OFF(tx_total_bytes)},\n\t{\"xgmac_tx_uc_pkt\", MAC_STATS_FIELD_OFF(tx_uc_pkts)},\n\t{\"xgmac_tx_mc_pkt\", MAC_STATS_FIELD_OFF(tx_mc_pkts)},\n\t{\"xgmac_tx_bc_pkt\", MAC_STATS_FIELD_OFF(tx_bc_pkts)},\n\t{\"xgmac_tx_pause_frame_num\", MAC_STATS_FIELD_OFF(tx_pfc_tc0)},\n\t{\"xgmac_tx_pfc_per_1pause_framer\", MAC_STATS_FIELD_OFF(tx_pfc_tc1)},\n\t{\"xgmac_tx_pfc_per_2pause_framer\", MAC_STATS_FIELD_OFF(tx_pfc_tc2)},\n\t{\"xgmac_tx_pfc_per_3pause_framer\", MAC_STATS_FIELD_OFF(tx_pfc_tc3)},\n\t{\"xgmac_tx_pfc_per_4pause_framer\", MAC_STATS_FIELD_OFF(tx_pfc_tc4)},\n\t{\"xgmac_tx_pfc_per_5pause_framer\", MAC_STATS_FIELD_OFF(tx_pfc_tc5)},\n\t{\"xgmac_tx_pfc_per_6pause_framer\", MAC_STATS_FIELD_OFF(tx_pfc_tc6)},\n\t{\"xgmac_tx_pfc_per_7pause_framer\", MAC_STATS_FIELD_OFF(tx_pfc_tc7)},\n\t{\"xgmac_tx_mac_ctrol_frame\", MAC_STATS_FIELD_OFF(tx_ctrl)},\n\t{\"xgmac_tx_1731_pkts\", MAC_STATS_FIELD_OFF(tx_1731_pkts)},\n\t{\"xgmac_tx_1588_pkts\", MAC_STATS_FIELD_OFF(tx_1588_pkts)},\n\t{\"xgmac_rx_good_pkt_from_dsaf\", MAC_STATS_FIELD_OFF(rx_good_from_sw)},\n\t{\"xgmac_rx_bad_pkt_from_dsaf\", MAC_STATS_FIELD_OFF(rx_bad_from_sw)},\n\t{\"xgmac_tx_bad_pkt_64tomax\", MAC_STATS_FIELD_OFF(tx_bad_pkts)},\n\n\t{\"xgmac_rx_bad_pkts_minto64\", MAC_STATS_FIELD_OFF(rx_fragment_err)},\n\t{\"xgmac_rx_good_pkts_minto64\", MAC_STATS_FIELD_OFF(rx_undersize)},\n\t{\"xgmac_rx_total_pkts_minto64\", MAC_STATS_FIELD_OFF(rx_under_min)},\n\t{\"xgmac_rx_pkt_64\", MAC_STATS_FIELD_OFF(rx_64bytes)},\n\t{\"xgmac_rx_pkt_65to127\", MAC_STATS_FIELD_OFF(rx_65to127)},\n\t{\"xgmac_rx_pkt_128to255\", MAC_STATS_FIELD_OFF(rx_128to255)},\n\t{\"xgmac_rx_pkt_256to511\", MAC_STATS_FIELD_OFF(rx_256to511)},\n\t{\"xgmac_rx_pkt_512to1023\", MAC_STATS_FIELD_OFF(rx_512to1023)},\n\t{\"xgmac_rx_pkt_1024to1518\", MAC_STATS_FIELD_OFF(rx_1024to1518)},\n\t{\"xgmac_rx_pkt_1519tomax\", MAC_STATS_FIELD_OFF(rx_1519tomax)},\n\t{\"xgmac_rx_good_pkt_1519tomax\",\tMAC_STATS_FIELD_OFF(rx_1519tomax_good)},\n\t{\"xgmac_rx_good_pkt_untramax\", MAC_STATS_FIELD_OFF(rx_oversize)},\n\t{\"xgmac_rx_bad_pkt_untramax\", MAC_STATS_FIELD_OFF(rx_jabber_err)},\n\t{\"xgmac_rx_good_pkt\", MAC_STATS_FIELD_OFF(rx_good_pkts)},\n\t{\"xgmac_rx_good_byt\", MAC_STATS_FIELD_OFF(rx_good_bytes)},\n\t{\"xgmac_rx_pkt\", MAC_STATS_FIELD_OFF(rx_total_pkts)},\n\t{\"xgmac_rx_byt\", MAC_STATS_FIELD_OFF(rx_total_bytes)},\n\t{\"xgmac_rx_uc_pkt\", MAC_STATS_FIELD_OFF(rx_uc_pkts)},\n\t{\"xgmac_rx_mc_pkt\", MAC_STATS_FIELD_OFF(rx_mc_pkts)},\n\t{\"xgmac_rx_bc_pkt\", MAC_STATS_FIELD_OFF(rx_bc_pkts)},\n\t{\"xgmac_rx_pause_frame_num\", MAC_STATS_FIELD_OFF(rx_pfc_tc0)},\n\t{\"xgmac_rx_pfc_per_1pause_frame\", MAC_STATS_FIELD_OFF(rx_pfc_tc1)},\n\t{\"xgmac_rx_pfc_per_2pause_frame\", MAC_STATS_FIELD_OFF(rx_pfc_tc2)},\n\t{\"xgmac_rx_pfc_per_3pause_frame\", MAC_STATS_FIELD_OFF(rx_pfc_tc3)},\n\t{\"xgmac_rx_pfc_per_4pause_frame\", MAC_STATS_FIELD_OFF(rx_pfc_tc4)},\n\t{\"xgmac_rx_pfc_per_5pause_frame\", MAC_STATS_FIELD_OFF(rx_pfc_tc5)},\n\t{\"xgmac_rx_pfc_per_6pause_frame\", MAC_STATS_FIELD_OFF(rx_pfc_tc6)},\n\t{\"xgmac_rx_pfc_per_7pause_frame\", MAC_STATS_FIELD_OFF(rx_pfc_tc7)},\n\t{\"xgmac_rx_mac_control\", MAC_STATS_FIELD_OFF(rx_unknown_ctrl)},\n\t{\"xgmac_tx_good_pkt_todsaf\", MAC_STATS_FIELD_OFF(tx_good_to_sw)},\n\t{\"xgmac_tx_bad_pkt_todsaf\", MAC_STATS_FIELD_OFF(tx_bad_to_sw)},\n\t{\"xgmac_rx_1731_pkt\", MAC_STATS_FIELD_OFF(rx_1731_pkts)},\n\t{\"xgmac_rx_symbol_err_pkt\", MAC_STATS_FIELD_OFF(rx_symbol_err)},\n\t{\"xgmac_rx_fcs_pkt\", MAC_STATS_FIELD_OFF(rx_fcs_err)}\n};\n\n \nstatic void hns_xgmac_tx_enable(struct mac_driver *drv, u32 value)\n{\n\tdsaf_set_dev_bit(drv, XGMAC_MAC_ENABLE_REG, XGMAC_ENABLE_TX_B, !!value);\n}\n\n \nstatic void hns_xgmac_rx_enable(struct mac_driver *drv, u32 value)\n{\n\tdsaf_set_dev_bit(drv, XGMAC_MAC_ENABLE_REG, XGMAC_ENABLE_RX_B, !!value);\n}\n\n \nstatic void hns_xgmac_lf_rf_insert(struct mac_driver *mac_drv, u32 mode)\n{\n\tdsaf_set_dev_field(mac_drv, XGMAC_MAC_TX_LF_RF_CONTROL_REG,\n\t\t\t   XGMAC_LF_RF_INSERT_M, XGMAC_LF_RF_INSERT_S, mode);\n}\n\n \nstatic void hns_xgmac_lf_rf_control_init(struct mac_driver *mac_drv)\n{\n\tu32 val = 0;\n\n\tdsaf_set_bit(val, XGMAC_UNIDIR_EN_B, 0);\n\tdsaf_set_bit(val, XGMAC_RF_TX_EN_B, 1);\n\tdsaf_set_field(val, XGMAC_LF_RF_INSERT_M, XGMAC_LF_RF_INSERT_S, 0);\n\tdsaf_write_dev(mac_drv, XGMAC_MAC_TX_LF_RF_CONTROL_REG, val);\n}\n\n \nstatic void hns_xgmac_enable(void *mac_drv, enum mac_commom_mode mode)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\n\thns_xgmac_lf_rf_insert(drv, HNS_XGMAC_NO_LF_RF_INSERT);\n\n\t \n\tif (mode == MAC_COMM_MODE_TX) {\n\t\thns_xgmac_tx_enable(drv, 1);\n\t} else if (mode == MAC_COMM_MODE_RX) {\n\t\thns_xgmac_rx_enable(drv, 1);\n\t} else if (mode == MAC_COMM_MODE_RX_AND_TX) {\n\t\thns_xgmac_tx_enable(drv, 1);\n\t\thns_xgmac_rx_enable(drv, 1);\n\t} else {\n\t\tdev_err(drv->dev, \"error mac mode:%d\\n\", mode);\n\t}\n}\n\n \nstatic void hns_xgmac_disable(void *mac_drv, enum mac_commom_mode mode)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\n\tif (mode == MAC_COMM_MODE_TX) {\n\t\thns_xgmac_tx_enable(drv, 0);\n\t} else if (mode == MAC_COMM_MODE_RX) {\n\t\thns_xgmac_rx_enable(drv, 0);\n\t} else if (mode == MAC_COMM_MODE_RX_AND_TX) {\n\t\thns_xgmac_tx_enable(drv, 0);\n\t\thns_xgmac_rx_enable(drv, 0);\n\t}\n\thns_xgmac_lf_rf_insert(drv, HNS_XGMAC_LF_INSERT);\n}\n\n \nstatic void hns_xgmac_pma_fec_enable(struct mac_driver *drv, u32 tx_value,\n\t\t\t\t     u32 rx_value)\n{\n\tu32 origin = dsaf_read_dev(drv, XGMAC_PMA_FEC_CONTROL_REG);\n\n\tdsaf_set_bit(origin, XGMAC_PMA_FEC_CTL_TX_B, !!tx_value);\n\tdsaf_set_bit(origin, XGMAC_PMA_FEC_CTL_RX_B, !!rx_value);\n\tdsaf_write_dev(drv, XGMAC_PMA_FEC_CONTROL_REG, origin);\n}\n\n \nstatic void hns_xgmac_exc_irq_en(struct mac_driver *drv, u32 en)\n{\n\tu32 clr_vlue = 0xfffffffful;\n\tu32 msk_vlue = en ? 0xfffffffful : 0;  \n\n\tdsaf_write_dev(drv, XGMAC_INT_STATUS_REG, clr_vlue);\n\tdsaf_write_dev(drv, XGMAC_INT_ENABLE_REG, msk_vlue);\n}\n\n \nstatic void hns_xgmac_init(void *mac_drv)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tstruct dsaf_device *dsaf_dev\n\t\t= (struct dsaf_device *)dev_get_drvdata(drv->dev);\n\tu32 port = drv->mac_id;\n\n\tdsaf_dev->misc_op->xge_srst(dsaf_dev, port, 0);\n\tmsleep(100);\n\tdsaf_dev->misc_op->xge_srst(dsaf_dev, port, 1);\n\n\tmsleep(100);\n\thns_xgmac_lf_rf_control_init(drv);\n\thns_xgmac_exc_irq_en(drv, 0);\n\n\thns_xgmac_pma_fec_enable(drv, 0x0, 0x0);\n\n\thns_xgmac_disable(mac_drv, MAC_COMM_MODE_RX_AND_TX);\n}\n\n \nstatic void hns_xgmac_config_pad_and_crc(void *mac_drv, u8 newval)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tu32 origin = dsaf_read_dev(drv, XGMAC_MAC_CONTROL_REG);\n\n\tdsaf_set_bit(origin, XGMAC_CTL_TX_PAD_B, !!newval);\n\tdsaf_set_bit(origin, XGMAC_CTL_TX_FCS_B, !!newval);\n\tdsaf_set_bit(origin, XGMAC_CTL_RX_FCS_B, !!newval);\n\tdsaf_write_dev(drv, XGMAC_MAC_CONTROL_REG, origin);\n}\n\n \nstatic void hns_xgmac_pausefrm_cfg(void *mac_drv, u32 rx_en, u32 tx_en)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tu32 origin = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_CTRL_REG);\n\n\tdsaf_set_bit(origin, XGMAC_PAUSE_CTL_TX_B, !!tx_en);\n\tdsaf_set_bit(origin, XGMAC_PAUSE_CTL_RX_B, !!rx_en);\n\tdsaf_write_dev(drv, XGMAC_MAC_PAUSE_CTRL_REG, origin);\n}\n\nstatic void hns_xgmac_set_pausefrm_mac_addr(void *mac_drv, const char *mac_addr)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\n\tu32 high_val = mac_addr[1] | (mac_addr[0] << 8);\n\tu32 low_val = mac_addr[5] | (mac_addr[4] << 8)\n\t\t| (mac_addr[3] << 16) | (mac_addr[2] << 24);\n\tdsaf_write_dev(drv, XGMAC_MAC_PAUSE_LOCAL_MAC_L_REG, low_val);\n\tdsaf_write_dev(drv, XGMAC_MAC_PAUSE_LOCAL_MAC_H_REG, high_val);\n}\n\n \nstatic void hns_xgmac_set_tx_auto_pause_frames(void *mac_drv, u16 enable)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\n\tdsaf_set_dev_bit(drv, XGMAC_MAC_PAUSE_CTRL_REG,\n\t\t\t XGMAC_PAUSE_CTL_TX_B, !!enable);\n\n\t \n\tif (enable)\n\t\tdsaf_write_dev(drv, XGMAC_MAC_PAUSE_TIME_REG, enable);\n}\n\n \nstatic void hns_xgmac_config_max_frame_length(void *mac_drv, u16 newval)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\n\tdsaf_write_dev(drv, XGMAC_MAC_MAX_PKT_SIZE_REG, newval);\n}\n\nstatic void hns_xgmac_update_stats(void *mac_drv)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tstruct mac_hw_stats *hw_stats = &drv->mac_cb->hw_stats;\n\n\t \n\thw_stats->tx_fragment_err\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_FRAGMENT);\n\thw_stats->tx_undersize\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_UNDERSIZE);\n\thw_stats->tx_under_min_pkts\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_UNDERMIN);\n\thw_stats->tx_64bytes = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_64OCTETS);\n\thw_stats->tx_65to127\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_65TO127OCTETS);\n\thw_stats->tx_128to255\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_128TO255OCTETS);\n\thw_stats->tx_256to511\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_256TO511OCTETS);\n\thw_stats->tx_512to1023\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_512TO1023OCTETS);\n\thw_stats->tx_1024to1518\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_1024TO1518OCTETS);\n\thw_stats->tx_1519tomax\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_1519TOMAXOCTETS);\n\thw_stats->tx_1519tomax_good\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_PKTS_1519TOMAXOCTETSOK);\n\thw_stats->tx_oversize = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_OVERSIZE);\n\thw_stats->tx_jabber_err = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_JABBER);\n\thw_stats->tx_good_pkts = hns_mac_reg_read64(drv, XGMAC_TX_GOODPKTS);\n\thw_stats->tx_good_bytes = hns_mac_reg_read64(drv, XGMAC_TX_GOODOCTETS);\n\thw_stats->tx_total_pkts = hns_mac_reg_read64(drv, XGMAC_TX_TOTAL_PKTS);\n\thw_stats->tx_total_bytes\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_TOTALOCTETS);\n\thw_stats->tx_uc_pkts = hns_mac_reg_read64(drv, XGMAC_TX_UNICASTPKTS);\n\thw_stats->tx_mc_pkts = hns_mac_reg_read64(drv, XGMAC_TX_MULTICASTPKTS);\n\thw_stats->tx_bc_pkts = hns_mac_reg_read64(drv, XGMAC_TX_BROADCASTPKTS);\n\thw_stats->tx_pfc_tc0 = hns_mac_reg_read64(drv, XGMAC_TX_PRI0PAUSEPKTS);\n\thw_stats->tx_pfc_tc1 = hns_mac_reg_read64(drv, XGMAC_TX_PRI1PAUSEPKTS);\n\thw_stats->tx_pfc_tc2 = hns_mac_reg_read64(drv, XGMAC_TX_PRI2PAUSEPKTS);\n\thw_stats->tx_pfc_tc3 = hns_mac_reg_read64(drv, XGMAC_TX_PRI3PAUSEPKTS);\n\thw_stats->tx_pfc_tc4 = hns_mac_reg_read64(drv, XGMAC_TX_PRI4PAUSEPKTS);\n\thw_stats->tx_pfc_tc5 = hns_mac_reg_read64(drv, XGMAC_TX_PRI5PAUSEPKTS);\n\thw_stats->tx_pfc_tc6 = hns_mac_reg_read64(drv, XGMAC_TX_PRI6PAUSEPKTS);\n\thw_stats->tx_pfc_tc7 = hns_mac_reg_read64(drv, XGMAC_TX_PRI7PAUSEPKTS);\n\thw_stats->tx_ctrl = hns_mac_reg_read64(drv, XGMAC_TX_MACCTRLPKTS);\n\thw_stats->tx_1731_pkts = hns_mac_reg_read64(drv, XGMAC_TX_1731PKTS);\n\thw_stats->tx_1588_pkts = hns_mac_reg_read64(drv, XGMAC_TX_1588PKTS);\n\thw_stats->rx_good_from_sw\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_FROMAPPGOODPKTS);\n\thw_stats->rx_bad_from_sw\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_FROMAPPBADPKTS);\n\thw_stats->tx_bad_pkts = hns_mac_reg_read64(drv, XGMAC_TX_ERRALLPKTS);\n\n\t \n\thw_stats->rx_fragment_err\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_FRAGMENT);\n\thw_stats->rx_undersize\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTSUNDERSIZE);\n\thw_stats->rx_under_min\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_UNDERMIN);\n\thw_stats->rx_64bytes = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_64OCTETS);\n\thw_stats->rx_65to127\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_65TO127OCTETS);\n\thw_stats->rx_128to255\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_128TO255OCTETS);\n\thw_stats->rx_256to511\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_256TO511OCTETS);\n\thw_stats->rx_512to1023\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_512TO1023OCTETS);\n\thw_stats->rx_1024to1518\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_1024TO1518OCTETS);\n\thw_stats->rx_1519tomax\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_1519TOMAXOCTETS);\n\thw_stats->rx_1519tomax_good\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_PKTS_1519TOMAXOCTETSOK);\n\thw_stats->rx_oversize = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_OVERSIZE);\n\thw_stats->rx_jabber_err = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_JABBER);\n\thw_stats->rx_good_pkts = hns_mac_reg_read64(drv, XGMAC_RX_GOODPKTS);\n\thw_stats->rx_good_bytes = hns_mac_reg_read64(drv, XGMAC_RX_GOODOCTETS);\n\thw_stats->rx_total_pkts = hns_mac_reg_read64(drv, XGMAC_RX_TOTAL_PKTS);\n\thw_stats->rx_total_bytes\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_TOTALOCTETS);\n\thw_stats->rx_uc_pkts = hns_mac_reg_read64(drv, XGMAC_RX_UNICASTPKTS);\n\thw_stats->rx_mc_pkts = hns_mac_reg_read64(drv, XGMAC_RX_MULTICASTPKTS);\n\thw_stats->rx_bc_pkts = hns_mac_reg_read64(drv, XGMAC_RX_BROADCASTPKTS);\n\thw_stats->rx_pfc_tc0 = hns_mac_reg_read64(drv, XGMAC_RX_PRI0PAUSEPKTS);\n\thw_stats->rx_pfc_tc1 = hns_mac_reg_read64(drv, XGMAC_RX_PRI1PAUSEPKTS);\n\thw_stats->rx_pfc_tc2 = hns_mac_reg_read64(drv, XGMAC_RX_PRI2PAUSEPKTS);\n\thw_stats->rx_pfc_tc3 = hns_mac_reg_read64(drv, XGMAC_RX_PRI3PAUSEPKTS);\n\thw_stats->rx_pfc_tc4 = hns_mac_reg_read64(drv, XGMAC_RX_PRI4PAUSEPKTS);\n\thw_stats->rx_pfc_tc5 = hns_mac_reg_read64(drv, XGMAC_RX_PRI5PAUSEPKTS);\n\thw_stats->rx_pfc_tc6 = hns_mac_reg_read64(drv, XGMAC_RX_PRI6PAUSEPKTS);\n\thw_stats->rx_pfc_tc7 = hns_mac_reg_read64(drv, XGMAC_RX_PRI7PAUSEPKTS);\n\n\thw_stats->rx_unknown_ctrl\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_MACCTRLPKTS);\n\thw_stats->tx_good_to_sw\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_SENDAPPGOODPKTS);\n\thw_stats->tx_bad_to_sw\n\t\t= hns_mac_reg_read64(drv, XGMAC_TX_SENDAPPBADPKTS);\n\thw_stats->rx_1731_pkts = hns_mac_reg_read64(drv, XGMAC_RX_1731PKTS);\n\thw_stats->rx_symbol_err\n\t\t= hns_mac_reg_read64(drv, XGMAC_RX_SYMBOLERRPKTS);\n\thw_stats->rx_fcs_err = hns_mac_reg_read64(drv, XGMAC_RX_FCSERRPKTS);\n}\n\n \nstatic void hns_xgmac_free(void *mac_drv)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tstruct dsaf_device *dsaf_dev\n\t\t= (struct dsaf_device *)dev_get_drvdata(drv->dev);\n\n\tu32 mac_id = drv->mac_id;\n\n\tdsaf_dev->misc_op->xge_srst(dsaf_dev, mac_id, 0);\n}\n\n \nstatic void hns_xgmac_get_info(void *mac_drv, struct mac_info *mac_info)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tu32 pause_time, pause_ctrl, port_mode, ctrl_val;\n\n\tctrl_val = dsaf_read_dev(drv, XGMAC_MAC_CONTROL_REG);\n\tmac_info->pad_and_crc_en = dsaf_get_bit(ctrl_val, XGMAC_CTL_TX_PAD_B);\n\tmac_info->auto_neg = 0;\n\n\tpause_time = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_TIME_REG);\n\tmac_info->tx_pause_time = pause_time;\n\n\tport_mode = dsaf_read_dev(drv, XGMAC_PORT_MODE_REG);\n\tmac_info->port_en = dsaf_get_field(port_mode, XGMAC_PORT_MODE_TX_M,\n\t\t\t\t\t   XGMAC_PORT_MODE_TX_S) &&\n\t\t\t\tdsaf_get_field(port_mode, XGMAC_PORT_MODE_RX_M,\n\t\t\t\t\t       XGMAC_PORT_MODE_RX_S);\n\tmac_info->duplex = 1;\n\tmac_info->speed = MAC_SPEED_10000;\n\n\tpause_ctrl = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_CTRL_REG);\n\tmac_info->rx_pause_en = dsaf_get_bit(pause_ctrl, XGMAC_PAUSE_CTL_RX_B);\n\tmac_info->tx_pause_en = dsaf_get_bit(pause_ctrl, XGMAC_PAUSE_CTL_TX_B);\n}\n\n \nstatic void hns_xgmac_get_pausefrm_cfg(void *mac_drv, u32 *rx_en, u32 *tx_en)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tu32 pause_ctrl;\n\n\tpause_ctrl = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_CTRL_REG);\n\t*rx_en = dsaf_get_bit(pause_ctrl, XGMAC_PAUSE_CTL_RX_B);\n\t*tx_en = dsaf_get_bit(pause_ctrl, XGMAC_PAUSE_CTL_TX_B);\n}\n\n \nstatic void hns_xgmac_get_link_status(void *mac_drv, u32 *link_stat)\n{\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\n\t*link_stat = dsaf_read_dev(drv, XGMAC_LINK_STATUS_REG);\n}\n\n \nstatic void hns_xgmac_get_regs(void *mac_drv, void *data)\n{\n\tu32 i;\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tu32 *regs = data;\n\tu64 qtmp;\n\n\t \n\tregs[0] = dsaf_read_dev(drv, XGMAC_INT_STATUS_REG);\n\tregs[1] = dsaf_read_dev(drv, XGMAC_INT_ENABLE_REG);\n\tregs[2] = dsaf_read_dev(drv, XGMAC_INT_SET_REG);\n\tregs[3] = dsaf_read_dev(drv, XGMAC_IERR_U_INFO_REG);\n\tregs[4] = dsaf_read_dev(drv, XGMAC_OVF_INFO_REG);\n\tregs[5] = dsaf_read_dev(drv, XGMAC_OVF_CNT_REG);\n\tregs[6] = dsaf_read_dev(drv, XGMAC_PORT_MODE_REG);\n\tregs[7] = dsaf_read_dev(drv, XGMAC_CLK_ENABLE_REG);\n\tregs[8] = dsaf_read_dev(drv, XGMAC_RESET_REG);\n\tregs[9] = dsaf_read_dev(drv, XGMAC_LINK_CONTROL_REG);\n\tregs[10] = dsaf_read_dev(drv, XGMAC_LINK_STATUS_REG);\n\n\tregs[11] = dsaf_read_dev(drv, XGMAC_SPARE_REG);\n\tregs[12] = dsaf_read_dev(drv, XGMAC_SPARE_CNT_REG);\n\tregs[13] = dsaf_read_dev(drv, XGMAC_MAC_ENABLE_REG);\n\tregs[14] = dsaf_read_dev(drv, XGMAC_MAC_CONTROL_REG);\n\tregs[15] = dsaf_read_dev(drv, XGMAC_MAC_IPG_REG);\n\tregs[16] = dsaf_read_dev(drv, XGMAC_MAC_MSG_CRC_EN_REG);\n\tregs[17] = dsaf_read_dev(drv, XGMAC_MAC_MSG_IMG_REG);\n\tregs[18] = dsaf_read_dev(drv, XGMAC_MAC_MSG_FC_CFG_REG);\n\tregs[19] = dsaf_read_dev(drv, XGMAC_MAC_MSG_TC_CFG_REG);\n\tregs[20] = dsaf_read_dev(drv, XGMAC_MAC_PAD_SIZE_REG);\n\tregs[21] = dsaf_read_dev(drv, XGMAC_MAC_MIN_PKT_SIZE_REG);\n\tregs[22] = dsaf_read_dev(drv, XGMAC_MAC_MAX_PKT_SIZE_REG);\n\tregs[23] = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_CTRL_REG);\n\tregs[24] = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_TIME_REG);\n\tregs[25] = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_GAP_REG);\n\tregs[26] = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_LOCAL_MAC_H_REG);\n\tregs[27] = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_LOCAL_MAC_L_REG);\n\tregs[28] = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_PEER_MAC_H_REG);\n\tregs[29] = dsaf_read_dev(drv, XGMAC_MAC_PAUSE_PEER_MAC_L_REG);\n\tregs[30] = dsaf_read_dev(drv, XGMAC_MAC_PFC_PRI_EN_REG);\n\tregs[31] = dsaf_read_dev(drv, XGMAC_MAC_1588_CTRL_REG);\n\tregs[32] = dsaf_read_dev(drv, XGMAC_MAC_1588_TX_PORT_DLY_REG);\n\tregs[33] = dsaf_read_dev(drv, XGMAC_MAC_1588_RX_PORT_DLY_REG);\n\tregs[34] = dsaf_read_dev(drv, XGMAC_MAC_1588_ASYM_DLY_REG);\n\tregs[35] = dsaf_read_dev(drv, XGMAC_MAC_1588_ADJUST_CFG_REG);\n\n\tregs[36] = dsaf_read_dev(drv, XGMAC_MAC_Y1731_ETH_TYPE_REG);\n\tregs[37] = dsaf_read_dev(drv, XGMAC_MAC_MIB_CONTROL_REG);\n\tregs[38] = dsaf_read_dev(drv, XGMAC_MAC_WAN_RATE_ADJUST_REG);\n\tregs[39] = dsaf_read_dev(drv, XGMAC_MAC_TX_ERR_MARK_REG);\n\tregs[40] = dsaf_read_dev(drv, XGMAC_MAC_TX_LF_RF_CONTROL_REG);\n\tregs[41] = dsaf_read_dev(drv, XGMAC_MAC_RX_LF_RF_STATUS_REG);\n\tregs[42] = dsaf_read_dev(drv, XGMAC_MAC_TX_RUNT_PKT_CNT_REG);\n\tregs[43] = dsaf_read_dev(drv, XGMAC_MAC_RX_RUNT_PKT_CNT_REG);\n\tregs[44] = dsaf_read_dev(drv, XGMAC_MAC_RX_PREAM_ERR_PKT_CNT_REG);\n\tregs[45] = dsaf_read_dev(drv, XGMAC_MAC_TX_LF_RF_TERM_PKT_CNT_REG);\n\tregs[46] = dsaf_read_dev(drv, XGMAC_MAC_TX_SN_MISMATCH_PKT_CNT_REG);\n\tregs[47] = dsaf_read_dev(drv, XGMAC_MAC_RX_ERR_MSG_CNT_REG);\n\tregs[48] = dsaf_read_dev(drv, XGMAC_MAC_RX_ERR_EFD_CNT_REG);\n\tregs[49] = dsaf_read_dev(drv, XGMAC_MAC_ERR_INFO_REG);\n\tregs[50] = dsaf_read_dev(drv, XGMAC_MAC_DBG_INFO_REG);\n\n\tregs[51] = dsaf_read_dev(drv, XGMAC_PCS_BASER_SYNC_THD_REG);\n\tregs[52] = dsaf_read_dev(drv, XGMAC_PCS_STATUS1_REG);\n\tregs[53] = dsaf_read_dev(drv, XGMAC_PCS_BASER_STATUS1_REG);\n\tregs[54] = dsaf_read_dev(drv, XGMAC_PCS_BASER_STATUS2_REG);\n\tregs[55] = dsaf_read_dev(drv, XGMAC_PCS_BASER_SEEDA_0_REG);\n\tregs[56] = dsaf_read_dev(drv, XGMAC_PCS_BASER_SEEDA_1_REG);\n\tregs[57] = dsaf_read_dev(drv, XGMAC_PCS_BASER_SEEDB_0_REG);\n\tregs[58] = dsaf_read_dev(drv, XGMAC_PCS_BASER_SEEDB_1_REG);\n\tregs[59] = dsaf_read_dev(drv, XGMAC_PCS_BASER_TEST_CONTROL_REG);\n\tregs[60] = dsaf_read_dev(drv, XGMAC_PCS_BASER_TEST_ERR_CNT_REG);\n\tregs[61] = dsaf_read_dev(drv, XGMAC_PCS_DBG_INFO_REG);\n\tregs[62] = dsaf_read_dev(drv, XGMAC_PCS_DBG_INFO1_REG);\n\tregs[63] = dsaf_read_dev(drv, XGMAC_PCS_DBG_INFO2_REG);\n\tregs[64] = dsaf_read_dev(drv, XGMAC_PCS_DBG_INFO3_REG);\n\n\tregs[65] = dsaf_read_dev(drv, XGMAC_PMA_ENABLE_REG);\n\tregs[66] = dsaf_read_dev(drv, XGMAC_PMA_CONTROL_REG);\n\tregs[67] = dsaf_read_dev(drv, XGMAC_PMA_SIGNAL_STATUS_REG);\n\tregs[68] = dsaf_read_dev(drv, XGMAC_PMA_DBG_INFO_REG);\n\tregs[69] = dsaf_read_dev(drv, XGMAC_PMA_FEC_ABILITY_REG);\n\tregs[70] = dsaf_read_dev(drv, XGMAC_PMA_FEC_CONTROL_REG);\n\tregs[71] = dsaf_read_dev(drv, XGMAC_PMA_FEC_CORR_BLOCK_CNT__REG);\n\tregs[72] = dsaf_read_dev(drv, XGMAC_PMA_FEC_UNCORR_BLOCK_CNT__REG);\n\n\t \n#define hns_xgmac_cpy_q(p, q) \\\n\tdo {\\\n\t\t*(p) = (u32)(q);\\\n\t\t*((p) + 1) = (u32)((q) >> 32);\\\n\t} while (0)\n\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_FRAGMENT);\n\thns_xgmac_cpy_q(&regs[73], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_UNDERSIZE);\n\thns_xgmac_cpy_q(&regs[75], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_UNDERMIN);\n\thns_xgmac_cpy_q(&regs[77], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_64OCTETS);\n\thns_xgmac_cpy_q(&regs[79], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_65TO127OCTETS);\n\thns_xgmac_cpy_q(&regs[81], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_128TO255OCTETS);\n\thns_xgmac_cpy_q(&regs[83], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_256TO511OCTETS);\n\thns_xgmac_cpy_q(&regs[85], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_512TO1023OCTETS);\n\thns_xgmac_cpy_q(&regs[87], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_1024TO1518OCTETS);\n\thns_xgmac_cpy_q(&regs[89], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_1519TOMAXOCTETS);\n\thns_xgmac_cpy_q(&regs[91], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_1519TOMAXOCTETSOK);\n\thns_xgmac_cpy_q(&regs[93], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_OVERSIZE);\n\thns_xgmac_cpy_q(&regs[95], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PKTS_JABBER);\n\thns_xgmac_cpy_q(&regs[97], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_GOODPKTS);\n\thns_xgmac_cpy_q(&regs[99], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_GOODOCTETS);\n\thns_xgmac_cpy_q(&regs[101], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_TOTAL_PKTS);\n\thns_xgmac_cpy_q(&regs[103], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_TOTALOCTETS);\n\thns_xgmac_cpy_q(&regs[105], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_UNICASTPKTS);\n\thns_xgmac_cpy_q(&regs[107], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_MULTICASTPKTS);\n\thns_xgmac_cpy_q(&regs[109], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_BROADCASTPKTS);\n\thns_xgmac_cpy_q(&regs[111], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI0PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[113], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI1PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[115], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI2PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[117], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI3PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[119], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI4PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[121], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI5PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[123], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI6PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[125], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_PRI7PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[127], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_MACCTRLPKTS);\n\thns_xgmac_cpy_q(&regs[129], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_1731PKTS);\n\thns_xgmac_cpy_q(&regs[131], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_1588PKTS);\n\thns_xgmac_cpy_q(&regs[133], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_FROMAPPGOODPKTS);\n\thns_xgmac_cpy_q(&regs[135], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_FROMAPPBADPKTS);\n\thns_xgmac_cpy_q(&regs[137], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_ERRALLPKTS);\n\thns_xgmac_cpy_q(&regs[139], qtmp);\n\n\t \n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_FRAGMENT);\n\thns_xgmac_cpy_q(&regs[141], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTSUNDERSIZE);\n\thns_xgmac_cpy_q(&regs[143], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_UNDERMIN);\n\thns_xgmac_cpy_q(&regs[145], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_64OCTETS);\n\thns_xgmac_cpy_q(&regs[147], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_65TO127OCTETS);\n\thns_xgmac_cpy_q(&regs[149], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_128TO255OCTETS);\n\thns_xgmac_cpy_q(&regs[151], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_256TO511OCTETS);\n\thns_xgmac_cpy_q(&regs[153], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_512TO1023OCTETS);\n\thns_xgmac_cpy_q(&regs[155], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_1024TO1518OCTETS);\n\thns_xgmac_cpy_q(&regs[157], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_1519TOMAXOCTETS);\n\thns_xgmac_cpy_q(&regs[159], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_1519TOMAXOCTETSOK);\n\thns_xgmac_cpy_q(&regs[161], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_OVERSIZE);\n\thns_xgmac_cpy_q(&regs[163], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PKTS_JABBER);\n\thns_xgmac_cpy_q(&regs[165], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_GOODPKTS);\n\thns_xgmac_cpy_q(&regs[167], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_GOODOCTETS);\n\thns_xgmac_cpy_q(&regs[169], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_TOTAL_PKTS);\n\thns_xgmac_cpy_q(&regs[171], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_TOTALOCTETS);\n\thns_xgmac_cpy_q(&regs[173], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_UNICASTPKTS);\n\thns_xgmac_cpy_q(&regs[175], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_MULTICASTPKTS);\n\thns_xgmac_cpy_q(&regs[177], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_BROADCASTPKTS);\n\thns_xgmac_cpy_q(&regs[179], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI0PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[181], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI1PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[183], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI2PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[185], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI3PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[187], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI4PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[189], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI5PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[191], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI6PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[193], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_PRI7PAUSEPKTS);\n\thns_xgmac_cpy_q(&regs[195], qtmp);\n\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_MACCTRLPKTS);\n\thns_xgmac_cpy_q(&regs[197], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_SENDAPPGOODPKTS);\n\thns_xgmac_cpy_q(&regs[199], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_TX_SENDAPPBADPKTS);\n\thns_xgmac_cpy_q(&regs[201], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_1731PKTS);\n\thns_xgmac_cpy_q(&regs[203], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_SYMBOLERRPKTS);\n\thns_xgmac_cpy_q(&regs[205], qtmp);\n\tqtmp = hns_mac_reg_read64(drv, XGMAC_RX_FCSERRPKTS);\n\thns_xgmac_cpy_q(&regs[207], qtmp);\n\n\t \n\tfor (i = 208; i < 214; i++)\n\t\tregs[i] = 0xaaaaaaaa;\n}\n\n \nstatic void hns_xgmac_get_stats(void *mac_drv, u64 *data)\n{\n\tu32 i;\n\tu64 *buf = data;\n\tstruct mac_driver *drv = (struct mac_driver *)mac_drv;\n\tstruct mac_hw_stats *hw_stats = NULL;\n\n\thw_stats = &drv->mac_cb->hw_stats;\n\n\tfor (i = 0; i < ARRAY_SIZE(g_xgmac_stats_string); i++) {\n\t\tbuf[i] = DSAF_STATS_READ(hw_stats,\n\t\t\tg_xgmac_stats_string[i].offset);\n\t}\n}\n\n \nstatic void hns_xgmac_get_strings(u32 stringset, u8 *data)\n{\n\tu8 *buff = data;\n\tu32 i;\n\n\tif (stringset != ETH_SS_STATS)\n\t\treturn;\n\n\tfor (i = 0; i < ARRAY_SIZE(g_xgmac_stats_string); i++)\n\t\tethtool_sprintf(&buff, g_xgmac_stats_string[i].desc);\n}\n\n \nstatic int hns_xgmac_get_sset_count(int stringset)\n{\n\tif (stringset == ETH_SS_STATS || stringset == ETH_SS_PRIV_FLAGS)\n\t\treturn ARRAY_SIZE(g_xgmac_stats_string);\n\n\treturn 0;\n}\n\n \nstatic int hns_xgmac_get_regs_count(void)\n{\n\treturn HNS_XGMAC_DUMP_NUM;\n}\n\nvoid *hns_xgmac_config(struct hns_mac_cb *mac_cb, struct mac_params *mac_param)\n{\n\tstruct mac_driver *mac_drv;\n\n\tmac_drv = devm_kzalloc(mac_cb->dev, sizeof(*mac_drv), GFP_KERNEL);\n\tif (!mac_drv)\n\t\treturn NULL;\n\n\tmac_drv->mac_init = hns_xgmac_init;\n\tmac_drv->mac_enable = hns_xgmac_enable;\n\tmac_drv->mac_disable = hns_xgmac_disable;\n\n\tmac_drv->mac_id = mac_param->mac_id;\n\tmac_drv->mac_mode = mac_param->mac_mode;\n\tmac_drv->io_base = mac_param->vaddr;\n\tmac_drv->dev = mac_param->dev;\n\tmac_drv->mac_cb = mac_cb;\n\n\tmac_drv->set_mac_addr = hns_xgmac_set_pausefrm_mac_addr;\n\tmac_drv->set_an_mode = NULL;\n\tmac_drv->config_loopback = NULL;\n\tmac_drv->config_pad_and_crc = hns_xgmac_config_pad_and_crc;\n\tmac_drv->mac_free = hns_xgmac_free;\n\tmac_drv->adjust_link = NULL;\n\tmac_drv->set_tx_auto_pause_frames = hns_xgmac_set_tx_auto_pause_frames;\n\tmac_drv->config_max_frame_length = hns_xgmac_config_max_frame_length;\n\tmac_drv->mac_pausefrm_cfg = hns_xgmac_pausefrm_cfg;\n\tmac_drv->autoneg_stat = NULL;\n\tmac_drv->get_info = hns_xgmac_get_info;\n\tmac_drv->get_pause_enable = hns_xgmac_get_pausefrm_cfg;\n\tmac_drv->get_link_status = hns_xgmac_get_link_status;\n\tmac_drv->get_regs = hns_xgmac_get_regs;\n\tmac_drv->get_ethtool_stats = hns_xgmac_get_stats;\n\tmac_drv->get_sset_count = hns_xgmac_get_sset_count;\n\tmac_drv->get_regs_count = hns_xgmac_get_regs_count;\n\tmac_drv->get_strings = hns_xgmac_get_strings;\n\tmac_drv->update_stats = hns_xgmac_update_stats;\n\n\treturn (void *)mac_drv;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}