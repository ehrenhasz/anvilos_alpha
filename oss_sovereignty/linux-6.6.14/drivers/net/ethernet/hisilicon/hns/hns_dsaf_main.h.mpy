{
  "module_name": "hns_dsaf_main.h",
  "hash_id": "086b400c4b0339157e047123fcc64f3c5f9d3789ca5d60fd7646b959415cb82d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/hisilicon/hns/hns_dsaf_main.h",
  "human_readable_source": " \n \n\n#ifndef __HNS_DSAF_MAIN_H\n#define __HNS_DSAF_MAIN_H\n#include \"hnae.h\"\n\n#include \"hns_dsaf_reg.h\"\n#include \"hns_dsaf_mac.h\"\n\nstruct hns_mac_cb;\n\n#define DSAF_DRV_NAME \"hns_dsaf\"\n#define DSAF_MOD_VERSION \"v1.0\"\n#define DSAF_DEVICE_NAME \"dsaf\"\n\n#define HNS_DSAF_DEBUG_NW_REG_OFFSET 0x100000\n\n#define DSAF_BASE_INNER_PORT_NUM 127 \n\n#define DSAF_MAX_CHIP_NUM 2   \n\n#define DSAF_DEFAUTL_QUEUE_NUM_PER_PPE 22\n\n#define HNS_DSAF_MAX_DESC_CNT 1024\n#define HNS_DSAF_MIN_DESC_CNT 16\n\n#define DSAF_INVALID_ENTRY_IDX 0xffff\n\n#define DSAF_CFG_READ_CNT   30\n\n#define DSAF_DUMP_REGS_NUM 504\n#define DSAF_STATIC_NUM 28\n#define DSAF_V2_STATIC_NUM\t44\n#define DSAF_PRIO_NR\t8\n#define DSAF_REG_PER_ZONE\t3\n\n#define DSAF_ROCE_CREDIT_CHN\t8\n#define DSAF_ROCE_CHAN_MODE\t3\n\n#define HNS_MAX_WAIT_CNT 10000\n\nenum dsaf_roce_port_mode {\n\tDSAF_ROCE_6PORT_MODE,\n\tDSAF_ROCE_4PORT_MODE,\n\tDSAF_ROCE_2PORT_MODE,\n\tDSAF_ROCE_CHAN_MODE_NUM,\n};\n\nenum dsaf_roce_port_num {\n\tDSAF_ROCE_PORT_0,\n\tDSAF_ROCE_PORT_1,\n\tDSAF_ROCE_PORT_2,\n\tDSAF_ROCE_PORT_3,\n\tDSAF_ROCE_PORT_4,\n\tDSAF_ROCE_PORT_5,\n};\n\nenum dsaf_roce_qos_sl {\n\tDSAF_ROCE_SL_0,\n\tDSAF_ROCE_SL_1,\n\tDSAF_ROCE_SL_2,\n\tDSAF_ROCE_SL_3,\n};\n\n#define DSAF_STATS_READ(p, offset) (*((u64 *)((u8 *)(p) + (offset))))\n#define HNS_DSAF_IS_DEBUG(dev) ((dev)->dsaf_mode == DSAF_MODE_DISABLE_SP)\n\nenum hal_dsaf_mode {\n\tHRD_DSAF_NO_DSAF_MODE\t= 0x0,\n\tHRD_DSAF_MODE\t\t= 0x1,\n};\n\nenum hal_dsaf_tc_mode {\n\tHRD_DSAF_4TC_MODE\t\t= 0X0,\n\tHRD_DSAF_8TC_MODE\t\t= 0X1,\n};\n\nstruct dsaf_vm_def_vlan {\n\tu32 vm_def_vlan_id;\n\tu32 vm_def_vlan_cfi;\n\tu32 vm_def_vlan_pri;\n};\n\nstruct dsaf_tbl_tcam_data {\n\tu32 tbl_tcam_data_high;\n\tu32 tbl_tcam_data_low;\n};\n\n#define DSAF_PORT_MSK_NUM \\\n\t((DSAF_TOTAL_QUEUE_NUM + DSAF_SERVICE_NW_NUM - 1) / 32 + 1)\nstruct dsaf_tbl_tcam_mcast_cfg {\n\tu8 tbl_mcast_old_en;\n\tu8 tbl_mcast_item_vld;\n\tu32 tbl_mcast_port_msk[DSAF_PORT_MSK_NUM];\n};\n\nstruct dsaf_tbl_tcam_ucast_cfg {\n\tu32 tbl_ucast_old_en;\n\tu32 tbl_ucast_item_vld;\n\tu32 tbl_ucast_mac_discard;\n\tu32 tbl_ucast_dvc;\n\tu32 tbl_ucast_out_port;\n};\n\nstruct dsaf_tbl_line_cfg {\n\tu32 tbl_line_mac_discard;\n\tu32 tbl_line_dvc;\n\tu32 tbl_line_out_port;\n};\n\nenum dsaf_port_rate_mode {\n\tDSAF_PORT_RATE_1000 = 0,\n\tDSAF_PORT_RATE_2500,\n\tDSAF_PORT_RATE_10000\n};\n\nenum dsaf_stp_port_type {\n\tDSAF_STP_PORT_TYPE_DISCARD = 0,\n\tDSAF_STP_PORT_TYPE_BLOCK = 1,\n\tDSAF_STP_PORT_TYPE_LISTEN = 2,\n\tDSAF_STP_PORT_TYPE_LEARN = 3,\n\tDSAF_STP_PORT_TYPE_FORWARD = 4\n};\n\nenum dsaf_sw_port_type {\n\tDSAF_SW_PORT_TYPE_NON_VLAN = 0,\n\tDSAF_SW_PORT_TYPE_ACCESS = 1,\n\tDSAF_SW_PORT_TYPE_TRUNK = 2,\n};\n\n#define DSAF_SUB_BASE_SIZE                        (0x10000)\n\n \nenum dsaf_mode {\n\tDSAF_MODE_INVALID = 0,\t \n\tDSAF_MODE_ENABLE_FIX,\t \n\tDSAF_MODE_ENABLE_0VM,\t \n\tDSAF_MODE_ENABLE_8VM,\t \n\tDSAF_MODE_ENABLE_16VM,\t \n\tDSAF_MODE_ENABLE_32VM,\t \n\tDSAF_MODE_ENABLE_128VM,\t \n\tDSAF_MODE_ENABLE,\t\t \n\tDSAF_MODE_DISABLE_SP,\t \n\tDSAF_MODE_DISABLE_FIX,\t \n\tDSAF_MODE_DISABLE_2PORT_8VM,\t \n\tDSAF_MODE_DISABLE_2PORT_16VM,\t \n\tDSAF_MODE_DISABLE_2PORT_64VM,\t \n\tDSAF_MODE_DISABLE_6PORT_0VM,\t \n\tDSAF_MODE_DISABLE_6PORT_2VM,\t \n\tDSAF_MODE_DISABLE_6PORT_4VM,\t \n\tDSAF_MODE_DISABLE_6PORT_16VM,\t \n\tDSAF_MODE_MAX\t\t \n};\n\n#define DSAF_DEST_PORT_NUM 256\t \n#define DSAF_WORD_BIT_CNT 32   \n\n \nstruct dsaf_drv_mac_single_dest_entry {\n\t \n\tu8 addr[ETH_ALEN];\n\tu16 in_vlan_id;  \n\n\t \n\t \n\tu8 in_port_num;\n\n\tu8 port_num;  \n\tu8 rsv[6];\n};\n\n \nstruct dsaf_drv_mac_multi_dest_entry {\n\t \n\tu8 addr[ETH_ALEN];\n\tu16 in_vlan_id;\n\t \n\t \n\tu32 port_mask[DSAF_DEST_PORT_NUM / DSAF_WORD_BIT_CNT];\n\n\t \n\t \n\tu8 in_port_num;\n\tu8 rsv[7];\n};\n\nstruct dsaf_hw_stats {\n\tu64 pad_drop;\n\tu64 man_pkts;\n\tu64 rx_pkts;\n\tu64 rx_pkt_id;\n\tu64 rx_pause_frame;\n\tu64 release_buf_num;\n\tu64 sbm_drop;\n\tu64 crc_false;\n\tu64 bp_drop;\n\tu64 rslt_drop;\n\tu64 local_addr_false;\n\tu64 vlan_drop;\n\tu64 stp_drop;\n\tu64 rx_pfc[DSAF_PRIO_NR];\n\tu64 tx_pfc[DSAF_PRIO_NR];\n\tu64 tx_pkts;\n};\n\nstruct hnae_vf_cb {\n\tu8 port_index;\n\tstruct hns_mac_cb *mac_cb;\n\tstruct dsaf_device *dsaf_dev;\n\tstruct hnae_handle  ae_handle;  \n};\n\nstruct dsaf_int_xge_src {\n\tu32    xid_xge_ecc_err_int_src;\n\tu32    xid_xge_fsm_timout_int_src;\n\tu32    sbm_xge_lnk_fsm_timout_int_src;\n\tu32    sbm_xge_lnk_ecc_2bit_int_src;\n\tu32    sbm_xge_mib_req_failed_int_src;\n\tu32    sbm_xge_mib_req_fsm_timout_int_src;\n\tu32    sbm_xge_mib_rels_fsm_timout_int_src;\n\tu32    sbm_xge_sram_ecc_2bit_int_src;\n\tu32    sbm_xge_mib_buf_sum_err_int_src;\n\tu32    sbm_xge_mib_req_extra_int_src;\n\tu32    sbm_xge_mib_rels_extra_int_src;\n\tu32    voq_xge_start_to_over_0_int_src;\n\tu32    voq_xge_start_to_over_1_int_src;\n\tu32    voq_xge_ecc_err_int_src;\n};\n\nstruct dsaf_int_ppe_src {\n\tu32    xid_ppe_fsm_timout_int_src;\n\tu32    sbm_ppe_lnk_fsm_timout_int_src;\n\tu32    sbm_ppe_lnk_ecc_2bit_int_src;\n\tu32    sbm_ppe_mib_req_failed_int_src;\n\tu32    sbm_ppe_mib_req_fsm_timout_int_src;\n\tu32    sbm_ppe_mib_rels_fsm_timout_int_src;\n\tu32    sbm_ppe_sram_ecc_2bit_int_src;\n\tu32    sbm_ppe_mib_buf_sum_err_int_src;\n\tu32    sbm_ppe_mib_req_extra_int_src;\n\tu32    sbm_ppe_mib_rels_extra_int_src;\n\tu32    voq_ppe_start_to_over_0_int_src;\n\tu32    voq_ppe_ecc_err_int_src;\n\tu32    xod_ppe_fifo_rd_empty_int_src;\n\tu32    xod_ppe_fifo_wr_full_int_src;\n};\n\nstruct dsaf_int_rocee_src {\n\tu32    xid_rocee_fsm_timout_int_src;\n\tu32    sbm_rocee_lnk_fsm_timout_int_src;\n\tu32    sbm_rocee_lnk_ecc_2bit_int_src;\n\tu32    sbm_rocee_mib_req_failed_int_src;\n\tu32    sbm_rocee_mib_req_fsm_timout_int_src;\n\tu32    sbm_rocee_mib_rels_fsm_timout_int_src;\n\tu32    sbm_rocee_sram_ecc_2bit_int_src;\n\tu32    sbm_rocee_mib_buf_sum_err_int_src;\n\tu32    sbm_rocee_mib_req_extra_int_src;\n\tu32    sbm_rocee_mib_rels_extra_int_src;\n\tu32    voq_rocee_start_to_over_0_int_src;\n\tu32    voq_rocee_ecc_err_int_src;\n};\n\nstruct dsaf_int_tbl_src {\n\tu32    tbl_da0_mis_src;\n\tu32    tbl_da1_mis_src;\n\tu32    tbl_da2_mis_src;\n\tu32    tbl_da3_mis_src;\n\tu32    tbl_da4_mis_src;\n\tu32    tbl_da5_mis_src;\n\tu32    tbl_da6_mis_src;\n\tu32    tbl_da7_mis_src;\n\tu32    tbl_sa_mis_src;\n\tu32    tbl_old_sech_end_src;\n\tu32    lram_ecc_err1_src;\n\tu32    lram_ecc_err2_src;\n\tu32    tram_ecc_err1_src;\n\tu32    tram_ecc_err2_src;\n\tu32    tbl_ucast_bcast_xge0_src;\n\tu32    tbl_ucast_bcast_xge1_src;\n\tu32    tbl_ucast_bcast_xge2_src;\n\tu32    tbl_ucast_bcast_xge3_src;\n\tu32    tbl_ucast_bcast_xge4_src;\n\tu32    tbl_ucast_bcast_xge5_src;\n\tu32    tbl_ucast_bcast_ppe_src;\n\tu32    tbl_ucast_bcast_rocee_src;\n};\n\nstruct dsaf_int_stat {\n\tstruct dsaf_int_xge_src dsaf_int_xge_stat[DSAF_COMM_CHN];\n\tstruct dsaf_int_ppe_src dsaf_int_ppe_stat[DSAF_COMM_CHN];\n\tstruct dsaf_int_rocee_src dsaf_int_rocee_stat[DSAF_COMM_CHN];\n\tstruct dsaf_int_tbl_src dsaf_int_tbl_stat[1];\n\n};\n\nstruct dsaf_misc_op {\n\tvoid (*cpld_set_led)(struct hns_mac_cb *mac_cb, int link_status,\n\t\t\t     u16 speed, int data);\n\tvoid (*cpld_reset_led)(struct hns_mac_cb *mac_cb);\n\tint (*cpld_set_led_id)(struct hns_mac_cb *mac_cb,\n\t\t\t       enum hnae_led_state status);\n\t \n\tvoid (*dsaf_reset)(struct dsaf_device *dsaf_dev, bool dereset);\n\tvoid (*xge_srst)(struct dsaf_device *dsaf_dev, u32 port, bool dereset);\n\tvoid (*ge_srst)(struct dsaf_device *dsaf_dev, u32 port, bool dereset);\n\tvoid (*ppe_srst)(struct dsaf_device *dsaf_dev, u32 port, bool dereset);\n\tvoid (*ppe_comm_srst)(struct dsaf_device *dsaf_dev, bool dereset);\n\tvoid (*hns_dsaf_srst_chns)(struct dsaf_device *dsaf_dev, u32 msk,\n\t\t\t\t   bool dereset);\n\tvoid (*hns_dsaf_roce_srst)(struct dsaf_device *dsaf_dev, bool dereset);\n\n\tphy_interface_t (*get_phy_if)(struct hns_mac_cb *mac_cb);\n\tint (*get_sfp_prsnt)(struct hns_mac_cb *mac_cb, int *sfp_prsnt);\n\n\tint (*cfg_serdes_loopback)(struct hns_mac_cb *mac_cb, bool en);\n};\n\n \nstruct dsaf_device {\n\tstruct device *dev;\n\tstruct hnae_ae_dev ae_dev;\n\n\tu8 __iomem *sc_base;\n\tu8 __iomem *sds_base;\n\tu8 __iomem *ppe_base;\n\tu8 __iomem *io_base;\n\tstruct regmap *sub_ctrl;\n\tphys_addr_t ppe_paddr;\n\n\tu32 desc_num;  \n\tu32 buf_size;  \n\tu32 reset_offset;  \n\tint buf_size_type;  \n\tenum dsaf_mode dsaf_mode;\t  \n\tenum hal_dsaf_mode dsaf_en;\n\tenum hal_dsaf_tc_mode dsaf_tc_mode;\n\tu32 dsaf_ver;\n\tu16 tcam_max_num;\t \n\n\tstruct ppe_common_cb *ppe_common[DSAF_COMM_DEV_NUM];\n\tstruct rcb_common_cb *rcb_common[DSAF_COMM_DEV_NUM];\n\tstruct hns_mac_cb *mac_cb[DSAF_MAX_PORT_NUM];\n\tstruct dsaf_misc_op *misc_op;\n\n\tstruct dsaf_hw_stats hw_stats[DSAF_NODE_NUM];\n\tstruct dsaf_int_stat int_stat;\n\t \n\tspinlock_t tcam_lock;\n};\n\nstatic inline void *hns_dsaf_dev_priv(const struct dsaf_device *dsaf_dev)\n{\n\treturn (void *)((u8 *)dsaf_dev + sizeof(*dsaf_dev));\n}\n\n#define DSAF_TBL_TCAM_KEY_PORT_S 0\n#define DSAF_TBL_TCAM_KEY_PORT_M (((1ULL << 4) - 1) << 0)\n#define DSAF_TBL_TCAM_KEY_VLAN_S 4\n#define DSAF_TBL_TCAM_KEY_VLAN_M (((1ULL << 12) - 1) << 4)\n\nstruct dsaf_drv_tbl_tcam_key {\n\tunion {\n\t\tstruct {\n\t\t\tu8 mac_3;\n\t\t\tu8 mac_2;\n\t\t\tu8 mac_1;\n\t\t\tu8 mac_0;\n\t\t} bits;\n\n\t\tu32 val;\n\t} high;\n\tunion {\n\t\tstruct {\n\t\t\tu16 port_vlan;\n\t\t\tu8 mac_5;\n\t\t\tu8 mac_4;\n\t\t} bits;\n\n\t\tu32 val;\n\t} low;\n};\n\nstruct dsaf_drv_soft_mac_tbl {\n\tstruct dsaf_drv_tbl_tcam_key tcam_key;\n\tu16 index;  \n};\n\nstruct dsaf_drv_priv {\n\t \n\tstruct dsaf_drv_soft_mac_tbl *soft_mac_tbl;\n};\n\nstatic inline void hns_dsaf_tbl_tcam_addr_cfg(struct dsaf_device *dsaf_dev,\n\t\t\t\t\t      u32 tab_tcam_addr)\n{\n\tdsaf_set_dev_field(dsaf_dev, DSAF_TBL_TCAM_ADDR_0_REG,\n\t\t\t   DSAF_TBL_TCAM_ADDR_M, DSAF_TBL_TCAM_ADDR_S,\n\t\t\t   tab_tcam_addr);\n}\n\nstatic inline void hns_dsaf_tbl_tcam_load_pul(struct dsaf_device *dsaf_dev)\n{\n\tu32 o_tbl_pul;\n\n\to_tbl_pul = dsaf_read_dev(dsaf_dev, DSAF_TBL_PUL_0_REG);\n\tdsaf_set_bit(o_tbl_pul, DSAF_TBL_PUL_TCAM_LOAD_S, 1);\n\tdsaf_write_dev(dsaf_dev, DSAF_TBL_PUL_0_REG, o_tbl_pul);\n\tdsaf_set_bit(o_tbl_pul, DSAF_TBL_PUL_TCAM_LOAD_S, 0);\n\tdsaf_write_dev(dsaf_dev, DSAF_TBL_PUL_0_REG, o_tbl_pul);\n}\n\nstatic inline void hns_dsaf_tbl_line_addr_cfg(struct dsaf_device *dsaf_dev,\n\t\t\t\t\t      u32 tab_line_addr)\n{\n\tdsaf_set_dev_field(dsaf_dev, DSAF_TBL_LINE_ADDR_0_REG,\n\t\t\t   DSAF_TBL_LINE_ADDR_M, DSAF_TBL_LINE_ADDR_S,\n\t\t\t   tab_line_addr);\n}\n\nstatic inline struct hnae_vf_cb *hns_ae_get_vf_cb(\n\tstruct hnae_handle *handle)\n{\n\treturn container_of(handle, struct hnae_vf_cb, ae_handle);\n}\n\nint hns_dsaf_set_mac_uc_entry(struct dsaf_device *dsaf_dev,\n\t\t\t      struct dsaf_drv_mac_single_dest_entry *mac_entry);\nint hns_dsaf_add_mac_mc_port(struct dsaf_device *dsaf_dev,\n\t\t\t     struct dsaf_drv_mac_single_dest_entry *mac_entry);\nint hns_dsaf_del_mac_entry(struct dsaf_device *dsaf_dev, u16 vlan_id,\n\t\t\t   u8 in_port_num, u8 *addr);\nint hns_dsaf_del_mac_mc_port(struct dsaf_device *dsaf_dev,\n\t\t\t     struct dsaf_drv_mac_single_dest_entry *mac_entry);\nvoid hns_dsaf_fix_mac_mode(struct hns_mac_cb *mac_cb);\n\nint hns_dsaf_ae_init(struct dsaf_device *dsaf_dev);\nvoid hns_dsaf_ae_uninit(struct dsaf_device *dsaf_dev);\n\nvoid hns_dsaf_update_stats(struct dsaf_device *dsaf_dev, u32 inode_num);\n\nint hns_dsaf_get_sset_count(struct dsaf_device *dsaf_dev, int stringset);\nvoid hns_dsaf_get_stats(struct dsaf_device *ddev, u64 *data, int port);\nvoid hns_dsaf_get_strings(int stringset, u8 *data, int port,\n\t\t\t  struct dsaf_device *dsaf_dev);\n\nvoid hns_dsaf_get_regs(struct dsaf_device *ddev, u32 port, void *data);\nint hns_dsaf_get_regs_count(void);\nvoid hns_dsaf_set_promisc_mode(struct dsaf_device *dsaf_dev, u32 en);\nvoid hns_dsaf_set_promisc_tcam(struct dsaf_device *dsaf_dev,\n\t\t\t       u32 port, bool enable);\n\nvoid hns_dsaf_get_rx_mac_pause_en(struct dsaf_device *dsaf_dev, int mac_id,\n\t\t\t\t  u32 *en);\nint hns_dsaf_set_rx_mac_pause_en(struct dsaf_device *dsaf_dev, int mac_id,\n\t\t\t\t u32 en);\nint hns_dsaf_rm_mac_addr(\n\tstruct dsaf_device *dsaf_dev,\n\tstruct dsaf_drv_mac_single_dest_entry *mac_entry);\n\nint hns_dsaf_clr_mac_mc_port(struct dsaf_device *dsaf_dev,\n\t\t\t     u8 mac_id, u8 port_num);\nint hns_dsaf_wait_pkt_clean(struct dsaf_device *dsaf_dev, int port);\n\nint hns_dsaf_roce_reset(struct fwnode_handle *dsaf_fwnode, bool dereset);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}