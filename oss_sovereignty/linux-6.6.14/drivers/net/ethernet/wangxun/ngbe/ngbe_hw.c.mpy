{
  "module_name": "ngbe_hw.c",
  "hash_id": "00c9b712eb9f7b3ae26824fc4a06d918fff15521469cf8b60644ebf2209486f4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/wangxun/ngbe/ngbe_hw.c",
  "human_readable_source": "\n \n\n#include <linux/etherdevice.h>\n#include <linux/iopoll.h>\n#include <linux/pci.h>\n\n#include \"../libwx/wx_type.h\"\n#include \"../libwx/wx_hw.h\"\n#include \"ngbe_type.h\"\n#include \"ngbe_hw.h\"\n\nint ngbe_eeprom_chksum_hostif(struct wx *wx)\n{\n\tstruct wx_hic_read_shadow_ram buffer;\n\tint status;\n\tint tmp;\n\n\tbuffer.hdr.req.cmd = NGBE_FW_EEPROM_CHECKSUM_CMD;\n\tbuffer.hdr.req.buf_lenh = 0;\n\tbuffer.hdr.req.buf_lenl = 0;\n\tbuffer.hdr.req.checksum = NGBE_FW_CMD_DEFAULT_CHECKSUM;\n\t \n\tbuffer.address = 0;\n\t \n\tbuffer.length = 0;\n\n\tstatus = wx_host_interface_command(wx, (u32 *)&buffer, sizeof(buffer),\n\t\t\t\t\t   WX_HI_COMMAND_TIMEOUT, false);\n\n\tif (status < 0)\n\t\treturn status;\n\ttmp = rd32a(wx, WX_MNG_MBOX, 1);\n\tif (tmp == NGBE_FW_CMD_ST_PASS)\n\t\treturn 0;\n\treturn -EIO;\n}\n\nstatic int ngbe_reset_misc(struct wx *wx)\n{\n\twx_reset_misc(wx);\n\tif (wx->gpio_ctrl) {\n\t\t \n\t\twr32(wx, NGBE_GPIO_DDR, 0x1);\n\t\tngbe_sfp_modules_txrx_powerctl(wx, false);\n\t}\n\treturn 0;\n}\n\nvoid ngbe_sfp_modules_txrx_powerctl(struct wx *wx, bool swi)\n{\n\t \n\twr32(wx, NGBE_GPIO_DR, swi ? 0 : NGBE_GPIO_DR_0);\n}\n\n \nint ngbe_reset_hw(struct wx *wx)\n{\n\tu32 val = 0;\n\tint ret = 0;\n\n\t \n\tret = wx_stop_adapter(wx);\n\tif (ret != 0)\n\t\treturn ret;\n\n\tif (wx->mac_type != em_mac_type_mdi) {\n\t\tval = WX_MIS_RST_LAN_RST(wx->bus.func);\n\t\twr32(wx, WX_MIS_RST, val | rd32(wx, WX_MIS_RST));\n\n\t\tret = read_poll_timeout(rd32, val,\n\t\t\t\t\t!(val & (BIT(9) << wx->bus.func)), 1000,\n\t\t\t\t\t100000, false, wx, 0x10028);\n\t\tif (ret) {\n\t\t\twx_err(wx, \"Lan reset exceed s maximum times.\\n\");\n\t\t\treturn ret;\n\t\t}\n\t}\n\tngbe_reset_misc(wx);\n\n\t \n\twx_get_mac_addr(wx, wx->mac.perm_addr);\n\n\t \n\twx->mac.num_rar_entries = NGBE_RAR_ENTRIES;\n\twx_init_rx_addrs(wx);\n\tpci_set_master(wx->pdev);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}