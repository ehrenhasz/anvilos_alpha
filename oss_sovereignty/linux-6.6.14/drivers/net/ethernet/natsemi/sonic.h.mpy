{
  "module_name": "sonic.h",
  "hash_id": "528c3f765f87abf8cf86158db133a212ebb6d941656c998bce2b2299d9bd223f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/natsemi/sonic.h",
  "human_readable_source": " \n \n\n#ifndef SONIC_H\n#define SONIC_H\n\n\n \n\n#define SONIC_CMD              0x00\n#define SONIC_DCR              0x01\n#define SONIC_RCR              0x02\n#define SONIC_TCR              0x03\n#define SONIC_IMR              0x04\n#define SONIC_ISR              0x05\n\n#define SONIC_UTDA             0x06\n#define SONIC_CTDA             0x07\n\n#define SONIC_URDA             0x0d\n#define SONIC_CRDA             0x0e\n#define SONIC_EOBC             0x13\n#define SONIC_URRA             0x14\n#define SONIC_RSA              0x15\n#define SONIC_REA              0x16\n#define SONIC_RRP              0x17\n#define SONIC_RWP              0x18\n#define SONIC_RSC              0x2b\n\n#define SONIC_CEP              0x21\n#define SONIC_CAP2             0x22\n#define SONIC_CAP1             0x23\n#define SONIC_CAP0             0x24\n#define SONIC_CE               0x25\n#define SONIC_CDP              0x26\n#define SONIC_CDC              0x27\n\n#define SONIC_WT0              0x29\n#define SONIC_WT1              0x2a\n\n#define SONIC_SR               0x28\n\n\n \n\n#define SONIC_TPS\t\t0x08\n#define SONIC_TFC\t\t0x09\n#define SONIC_TSA0\t\t0x0a\n#define SONIC_TSA1\t\t0x0b\n#define SONIC_TFS\t\t0x0c\n\n#define SONIC_CRBA0\t\t0x0f\n#define SONIC_CRBA1\t\t0x10\n#define SONIC_RBWC0\t\t0x11\n#define SONIC_RBWC1\t\t0x12\n#define SONIC_TTDA\t\t0x20\n#define SONIC_MDT\t\t0x2f\n\n#define SONIC_TRBA0\t\t0x19\n#define SONIC_TRBA1\t\t0x1a\n#define SONIC_TBWC0\t\t0x1b\n#define SONIC_TBWC1\t\t0x1c\n#define SONIC_LLFA\t\t0x1f\n\n#define SONIC_ADDR0\t\t0x1d\n#define SONIC_ADDR1\t\t0x1e\n\n \n\n#define SONIC_CRCT              0x2c\n#define SONIC_FAET              0x2d\n#define SONIC_MPT               0x2e\n\n#define SONIC_DCR2              0x3f\n\n \n\n#define SONIC_CR_LCAM           0x0200\n#define SONIC_CR_RRRA           0x0100\n#define SONIC_CR_RST            0x0080\n#define SONIC_CR_ST             0x0020\n#define SONIC_CR_STP            0x0010\n#define SONIC_CR_RXEN           0x0008\n#define SONIC_CR_RXDIS          0x0004\n#define SONIC_CR_TXP            0x0002\n#define SONIC_CR_HTX            0x0001\n\n#define SONIC_CR_ALL (SONIC_CR_LCAM | SONIC_CR_RRRA | \\\n\t\t      SONIC_CR_RXEN | SONIC_CR_TXP)\n\n \n\n#define SONIC_DCR_EXBUS         0x8000\n#define SONIC_DCR_LBR           0x2000\n#define SONIC_DCR_PO1           0x1000\n#define SONIC_DCR_PO0           0x0800\n#define SONIC_DCR_SBUS          0x0400\n#define SONIC_DCR_USR1          0x0200\n#define SONIC_DCR_USR0          0x0100\n#define SONIC_DCR_WC1           0x0080\n#define SONIC_DCR_WC0           0x0040\n#define SONIC_DCR_DW            0x0020\n#define SONIC_DCR_BMS           0x0010\n#define SONIC_DCR_RFT1          0x0008\n#define SONIC_DCR_RFT0          0x0004\n#define SONIC_DCR_TFT1          0x0002\n#define SONIC_DCR_TFT0          0x0001\n\n \n\n#define SONIC_RCR_ERR           0x8000\n#define SONIC_RCR_RNT           0x4000\n#define SONIC_RCR_BRD           0x2000\n#define SONIC_RCR_PRO           0x1000\n#define SONIC_RCR_AMC           0x0800\n#define SONIC_RCR_LB1           0x0400\n#define SONIC_RCR_LB0           0x0200\n\n#define SONIC_RCR_MC            0x0100\n#define SONIC_RCR_BC            0x0080\n#define SONIC_RCR_LPKT          0x0040\n#define SONIC_RCR_CRS           0x0020\n#define SONIC_RCR_COL           0x0010\n#define SONIC_RCR_CRCR          0x0008\n#define SONIC_RCR_FAER          0x0004\n#define SONIC_RCR_LBK           0x0002\n#define SONIC_RCR_PRX           0x0001\n\n#define SONIC_RCR_LB_OFF        0\n#define SONIC_RCR_LB_MAC        SONIC_RCR_LB0\n#define SONIC_RCR_LB_ENDEC      SONIC_RCR_LB1\n#define SONIC_RCR_LB_TRANS      (SONIC_RCR_LB0 | SONIC_RCR_LB1)\n\n \n\n#define SONIC_RCR_DEFAULT       (SONIC_RCR_BRD)\n\n\n \n\n#define SONIC_TCR_PINTR         0x8000\n#define SONIC_TCR_POWC          0x4000\n#define SONIC_TCR_CRCI          0x2000\n#define SONIC_TCR_EXDIS         0x1000\n#define SONIC_TCR_EXD           0x0400\n#define SONIC_TCR_DEF           0x0200\n#define SONIC_TCR_NCRS          0x0100\n#define SONIC_TCR_CRLS          0x0080\n#define SONIC_TCR_EXC           0x0040\n#define SONIC_TCR_OWC           0x0020\n#define SONIC_TCR_PMB           0x0008\n#define SONIC_TCR_FU            0x0004\n#define SONIC_TCR_BCM           0x0002\n#define SONIC_TCR_PTX           0x0001\n\n#define SONIC_TCR_DEFAULT       0x0000\n\n \n\n#define SONIC_INT_BR\t\t0x4000\n#define SONIC_INT_HBL\t\t0x2000\n#define SONIC_INT_LCD\t\t0x1000\n#define SONIC_INT_PINT\t\t0x0800\n#define SONIC_INT_PKTRX\t\t0x0400\n#define SONIC_INT_TXDN\t\t0x0200\n#define SONIC_INT_TXER\t\t0x0100\n#define SONIC_INT_TC\t\t0x0080\n#define SONIC_INT_RDE\t\t0x0040\n#define SONIC_INT_RBE\t\t0x0020\n#define SONIC_INT_RBAE\t\t0x0010\n#define SONIC_INT_CRC\t\t0x0008\n#define SONIC_INT_FAE\t\t0x0004\n#define SONIC_INT_MP\t\t0x0002\n#define SONIC_INT_RFO\t\t0x0001\n\n\n \n\n#define SONIC_IMR_DEFAULT     ( SONIC_INT_BR | \\\n                                SONIC_INT_LCD | \\\n                                SONIC_INT_RFO | \\\n                                SONIC_INT_PKTRX | \\\n                                SONIC_INT_TXDN | \\\n                                SONIC_INT_TXER | \\\n                                SONIC_INT_RDE | \\\n                                SONIC_INT_RBAE | \\\n                                SONIC_INT_CRC | \\\n                                SONIC_INT_FAE | \\\n                                SONIC_INT_MP)\n\n\n#define SONIC_EOL       0x0001\n#define CAM_DESCRIPTORS 16\n\n \n\n#define SONIC_BITMODE16 0\n#define SONIC_BITMODE32 1\n#define SONIC_BUS_SCALE(bitmode) ((bitmode) ? 4 : 2)\n \n#define SIZEOF_SONIC_RR 4\n#define SONIC_RR_BUFADR_L  0\n#define SONIC_RR_BUFADR_H  1\n#define SONIC_RR_BUFSIZE_L 2\n#define SONIC_RR_BUFSIZE_H 3\n\n#define SIZEOF_SONIC_RD 7\n#define SONIC_RD_STATUS   0\n#define SONIC_RD_PKTLEN   1\n#define SONIC_RD_PKTPTR_L 2\n#define SONIC_RD_PKTPTR_H 3\n#define SONIC_RD_SEQNO    4\n#define SONIC_RD_LINK     5\n#define SONIC_RD_IN_USE   6\n\n#define SIZEOF_SONIC_TD 8\n#define SONIC_TD_STATUS       0\n#define SONIC_TD_CONFIG       1\n#define SONIC_TD_PKTSIZE      2\n#define SONIC_TD_FRAG_COUNT   3\n#define SONIC_TD_FRAG_PTR_L   4\n#define SONIC_TD_FRAG_PTR_H   5\n#define SONIC_TD_FRAG_SIZE    6\n#define SONIC_TD_LINK         7\n\n#define SIZEOF_SONIC_CD 4\n#define SONIC_CD_ENTRY_POINTER 0\n#define SONIC_CD_CAP0          1\n#define SONIC_CD_CAP1          2\n#define SONIC_CD_CAP2          3\n\n#define SIZEOF_SONIC_CDA ((CAM_DESCRIPTORS * SIZEOF_SONIC_CD) + 1)\n#define SONIC_CDA_CAM_ENABLE   (CAM_DESCRIPTORS * SIZEOF_SONIC_CD)\n\n \n#define SONIC_NUM_RRS   16             \n#define SONIC_NUM_RDS   SONIC_NUM_RRS  \n#define SONIC_NUM_TDS   16             \n\n#define SONIC_RRS_MASK  (SONIC_NUM_RRS - 1)\n#define SONIC_RDS_MASK  (SONIC_NUM_RDS - 1)\n#define SONIC_TDS_MASK  (SONIC_NUM_TDS - 1)\n\n#define SONIC_RBSIZE\t1520           \n\n \n#define SIZEOF_SONIC_DESC (SIZEOF_SONIC_CDA\t\\\n\t+ (SIZEOF_SONIC_TD * SONIC_NUM_TDS)\t\\\n\t+ (SIZEOF_SONIC_RD * SONIC_NUM_RDS)\t\\\n\t+ (SIZEOF_SONIC_RR * SONIC_NUM_RRS))\n\n \nstruct sonic_local {\n\t \n\tint dma_bitmode;\n\t \n\tint reg_offset;\n\tvoid *descriptors;\n\t \n\tvoid *cda;   \n\tvoid *tda;   \n\tvoid *rra;   \n\tvoid *rda;   \n\tstruct sk_buff* volatile rx_skb[SONIC_NUM_RRS];\t \n\tstruct sk_buff* volatile tx_skb[SONIC_NUM_TDS];\t \n\tunsigned int tx_len[SONIC_NUM_TDS];  \n\t \n\tdma_addr_t descriptors_laddr;\n\tu32 cda_laddr;               \n\tu32 tda_laddr;               \n\tu32 rra_laddr;               \n\tu32 rda_laddr;               \n\tdma_addr_t rx_laddr[SONIC_NUM_RRS];  \n\tdma_addr_t tx_laddr[SONIC_NUM_TDS];  \n\tunsigned int cur_rx;\n\tunsigned int cur_tx;            \n\tunsigned int eol_rx;\n\tunsigned int eol_tx;            \n\tint msg_enable;\n\tstruct device *device;          \n\tstruct net_device_stats stats;\n\tspinlock_t lock;\n};\n\n#define TX_TIMEOUT (3 * HZ)\n\n \n\nstatic int sonic_open(struct net_device *dev);\nstatic int sonic_send_packet(struct sk_buff *skb, struct net_device *dev);\nstatic irqreturn_t sonic_interrupt(int irq, void *dev_id);\nstatic void sonic_rx(struct net_device *dev);\nstatic int sonic_close(struct net_device *dev);\nstatic struct net_device_stats *sonic_get_stats(struct net_device *dev);\nstatic void sonic_multicast_list(struct net_device *dev);\nstatic int sonic_init(struct net_device *dev, bool may_sleep);\nstatic void sonic_tx_timeout(struct net_device *dev, unsigned int txqueue);\nstatic void sonic_msg_init(struct net_device *dev);\nstatic int sonic_alloc_descriptors(struct net_device *dev);\n\n \n \nstatic inline void sonic_buf_put(u16 *base, int bitmode,\n\t\t\t\t int offset, __u16 val)\n{\n\tif (bitmode)\n#ifdef __BIG_ENDIAN\n\t\t__raw_writew(val, base + (offset * 2) + 1);\n#else\n\t\t__raw_writew(val, base + (offset * 2) + 0);\n#endif\n\telse\n\t\t__raw_writew(val, base + (offset * 1) + 0);\n}\n\nstatic inline __u16 sonic_buf_get(u16 *base, int bitmode,\n\t\t\t\t  int offset)\n{\n\tif (bitmode)\n#ifdef __BIG_ENDIAN\n\t\treturn __raw_readw(base + (offset * 2) + 1);\n#else\n\t\treturn __raw_readw(base + (offset * 2) + 0);\n#endif\n\telse\n\t\treturn __raw_readw(base + (offset * 1) + 0);\n}\n\n \nstatic inline void sonic_cda_put(struct net_device* dev, int entry,\n\t\t\t\t int offset, __u16 val)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\tsonic_buf_put(lp->cda, lp->dma_bitmode,\n\t\t      (entry * SIZEOF_SONIC_CD) + offset, val);\n}\n\nstatic inline __u16 sonic_cda_get(struct net_device* dev, int entry,\n\t\t\t\t  int offset)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\treturn sonic_buf_get(lp->cda, lp->dma_bitmode,\n\t\t\t     (entry * SIZEOF_SONIC_CD) + offset);\n}\n\nstatic inline void sonic_set_cam_enable(struct net_device* dev, __u16 val)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\tsonic_buf_put(lp->cda, lp->dma_bitmode, SONIC_CDA_CAM_ENABLE, val);\n}\n\nstatic inline __u16 sonic_get_cam_enable(struct net_device* dev)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\treturn sonic_buf_get(lp->cda, lp->dma_bitmode, SONIC_CDA_CAM_ENABLE);\n}\n\nstatic inline void sonic_tda_put(struct net_device* dev, int entry,\n\t\t\t\t int offset, __u16 val)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\tsonic_buf_put(lp->tda, lp->dma_bitmode,\n\t\t      (entry * SIZEOF_SONIC_TD) + offset, val);\n}\n\nstatic inline __u16 sonic_tda_get(struct net_device* dev, int entry,\n\t\t\t\t  int offset)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\treturn sonic_buf_get(lp->tda, lp->dma_bitmode,\n\t\t\t     (entry * SIZEOF_SONIC_TD) + offset);\n}\n\nstatic inline void sonic_rda_put(struct net_device* dev, int entry,\n\t\t\t\t int offset, __u16 val)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\tsonic_buf_put(lp->rda, lp->dma_bitmode,\n\t\t      (entry * SIZEOF_SONIC_RD) + offset, val);\n}\n\nstatic inline __u16 sonic_rda_get(struct net_device* dev, int entry,\n\t\t\t\t  int offset)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\treturn sonic_buf_get(lp->rda, lp->dma_bitmode,\n\t\t\t     (entry * SIZEOF_SONIC_RD) + offset);\n}\n\nstatic inline void sonic_rra_put(struct net_device* dev, int entry,\n\t\t\t\t int offset, __u16 val)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\tsonic_buf_put(lp->rra, lp->dma_bitmode,\n\t\t      (entry * SIZEOF_SONIC_RR) + offset, val);\n}\n\nstatic inline __u16 sonic_rra_get(struct net_device* dev, int entry,\n\t\t\t\t  int offset)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\treturn sonic_buf_get(lp->rra, lp->dma_bitmode,\n\t\t\t     (entry * SIZEOF_SONIC_RR) + offset);\n}\n\nstatic inline u16 sonic_rr_addr(struct net_device *dev, int entry)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\n\treturn lp->rra_laddr +\n\t       entry * SIZEOF_SONIC_RR * SONIC_BUS_SCALE(lp->dma_bitmode);\n}\n\nstatic inline u16 sonic_rr_entry(struct net_device *dev, u16 addr)\n{\n\tstruct sonic_local *lp = netdev_priv(dev);\n\n\treturn (addr - (u16)lp->rra_laddr) / (SIZEOF_SONIC_RR *\n\t\t\t\t\t      SONIC_BUS_SCALE(lp->dma_bitmode));\n}\n\nstatic const char version[] =\n    \"sonic.c:v0.92 20.9.98 tsbogend@alpha.franken.de\\n\";\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}