{
  "module_name": "spl2sw_phy.c",
  "hash_id": "ab2bfb1898e30d70cf5b42d1e3c2f6c402d2f72e59e7863c34980829ef57c529",
  "original_prompt": "Ingested from linux-6.6.14/drivers/net/ethernet/sunplus/spl2sw_phy.c",
  "human_readable_source": "\n \n\n#include <linux/netdevice.h>\n#include <linux/bitfield.h>\n#include <linux/of_mdio.h>\n\n#include \"spl2sw_register.h\"\n#include \"spl2sw_define.h\"\n#include \"spl2sw_phy.h\"\n\nstatic void spl2sw_mii_link_change(struct net_device *ndev)\n{\n\tstruct spl2sw_mac *mac = netdev_priv(ndev);\n\tstruct phy_device *phydev = ndev->phydev;\n\tstruct spl2sw_common *comm = mac->comm;\n\tu32 reg;\n\n\treg = readl(comm->l2sw_reg_base + L2SW_MAC_FORCE_MODE);\n\n\tif (phydev->link) {\n\t\treg |= FIELD_PREP(MAC_FORCE_RMII_LINK, mac->lan_port);\n\n\t\tif (phydev->speed == 100) {\n\t\t\treg |= FIELD_PREP(MAC_FORCE_RMII_SPD, mac->lan_port);\n\t\t} else {\n\t\t\treg &= FIELD_PREP(MAC_FORCE_RMII_SPD, ~mac->lan_port) |\n\t\t\t       ~MAC_FORCE_RMII_SPD;\n\t\t}\n\n\t\tif (phydev->duplex) {\n\t\t\treg |= FIELD_PREP(MAC_FORCE_RMII_DPX, mac->lan_port);\n\t\t} else {\n\t\t\treg &= FIELD_PREP(MAC_FORCE_RMII_DPX, ~mac->lan_port) |\n\t\t\t       ~MAC_FORCE_RMII_DPX;\n\t\t}\n\n\t\tif (phydev->pause) {\n\t\t\treg |= FIELD_PREP(MAC_FORCE_RMII_FC, mac->lan_port);\n\t\t} else {\n\t\t\treg &= FIELD_PREP(MAC_FORCE_RMII_FC, ~mac->lan_port) |\n\t\t\t       ~MAC_FORCE_RMII_FC;\n\t\t}\n\t} else {\n\t\treg &= FIELD_PREP(MAC_FORCE_RMII_LINK, ~mac->lan_port) |\n\t\t       ~MAC_FORCE_RMII_LINK;\n\t}\n\n\twritel(reg, comm->l2sw_reg_base + L2SW_MAC_FORCE_MODE);\n\n\tphy_print_status(phydev);\n}\n\nint spl2sw_phy_connect(struct spl2sw_common *comm)\n{\n\tstruct phy_device *phydev;\n\tstruct net_device *ndev;\n\tstruct spl2sw_mac *mac;\n\tint i;\n\n\tfor (i = 0; i < MAX_NETDEV_NUM; i++)\n\t\tif (comm->ndev[i]) {\n\t\t\tndev = comm->ndev[i];\n\t\t\tmac = netdev_priv(ndev);\n\t\t\tphydev = of_phy_connect(ndev, mac->phy_node, spl2sw_mii_link_change,\n\t\t\t\t\t\t0, mac->phy_mode);\n\t\t\tif (!phydev)\n\t\t\t\treturn -ENODEV;\n\n\t\t\tphy_support_asym_pause(phydev);\n\t\t\tphy_attached_info(phydev);\n\t\t}\n\n\treturn 0;\n}\n\nvoid spl2sw_phy_remove(struct spl2sw_common *comm)\n{\n\tstruct net_device *ndev;\n\tint i;\n\n\tfor (i = 0; i < MAX_NETDEV_NUM; i++)\n\t\tif (comm->ndev[i]) {\n\t\t\tndev = comm->ndev[i];\n\t\t\tif (ndev)\n\t\t\t\tphy_disconnect(ndev->phydev);\n\t\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}