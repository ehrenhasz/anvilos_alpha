{
  "module_name": "dmx3191d.c",
  "hash_id": "b7276316cdc18ade946c84f7e24e2b9c85575eaaeec03389a4cfd254b7d22b06",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/dmx3191d.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/ioport.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/interrupt.h>\n#include <asm/io.h>\n\n#include <scsi/scsi_host.h>\n\n \n\n#define NCR5380_read(reg)\t\tinb(hostdata->base + (reg))\n#define NCR5380_write(reg, value)\toutb(value, hostdata->base + (reg))\n\n#define NCR5380_dma_xfer_len\t\tNCR5380_dma_xfer_none\n#define NCR5380_dma_recv_setup\t\tNCR5380_dma_setup_none\n#define NCR5380_dma_send_setup\t\tNCR5380_dma_setup_none\n#define NCR5380_dma_residual\t\tNCR5380_dma_residual_none\n\n#define NCR5380_implementation_fields\t \n\n#include \"NCR5380.h\"\n#include \"NCR5380.c\"\n\n#define DMX3191D_DRIVER_NAME\t\"dmx3191d\"\n#define DMX3191D_REGION_LEN\t8\n\n\nstatic const struct scsi_host_template dmx3191d_driver_template = {\n\t.module\t\t\t= THIS_MODULE,\n\t.proc_name\t\t= DMX3191D_DRIVER_NAME,\n\t.name\t\t\t= \"Domex DMX3191D\",\n\t.info\t\t\t= NCR5380_info,\n\t.queuecommand\t\t= NCR5380_queue_command,\n\t.eh_abort_handler\t= NCR5380_abort,\n\t.eh_host_reset_handler\t= NCR5380_host_reset,\n\t.can_queue\t\t= 32,\n\t.this_id\t\t= 7,\n\t.sg_tablesize\t\t= SG_ALL,\n\t.cmd_per_lun\t\t= 2,\n\t.dma_boundary\t\t= PAGE_SIZE - 1,\n\t.cmd_size\t\t= sizeof(struct NCR5380_cmd),\n};\n\nstatic int dmx3191d_probe_one(struct pci_dev *pdev,\n\t\t\t      const struct pci_device_id *id)\n{\n\tstruct Scsi_Host *shost;\n\tstruct NCR5380_hostdata *hostdata;\n\tunsigned long io;\n\tint error = -ENODEV;\n\n\tif (pci_enable_device(pdev))\n\t\tgoto out;\n\n\tio = pci_resource_start(pdev, 0);\n\tif (!request_region(io, DMX3191D_REGION_LEN, DMX3191D_DRIVER_NAME)) {\n\t\tprintk(KERN_ERR \"dmx3191: region 0x%lx-0x%lx already reserved\\n\",\n\t\t\t\tio, io + DMX3191D_REGION_LEN);\n\t\tgoto out_disable_device;\n\t}\n\n\tshost = scsi_host_alloc(&dmx3191d_driver_template,\n\t\t\tsizeof(struct NCR5380_hostdata));\n\tif (!shost)\n\t\tgoto out_release_region;       \n\n\thostdata = shost_priv(shost);\n\thostdata->base = io;\n\n\t \n\tshost->irq = NO_IRQ;\n\n\terror = NCR5380_init(shost, 0);\n\tif (error)\n\t\tgoto out_host_put;\n\n\tNCR5380_maybe_reset_bus(shost);\n\n\tpci_set_drvdata(pdev, shost);\n\n\terror = scsi_add_host(shost, &pdev->dev);\n\tif (error)\n\t\tgoto out_exit;\n\n\tscsi_scan_host(shost);\n\treturn 0;\n\nout_exit:\n\tNCR5380_exit(shost);\nout_host_put:\n\tscsi_host_put(shost);\n out_release_region:\n\trelease_region(io, DMX3191D_REGION_LEN);\n out_disable_device:\n\tpci_disable_device(pdev);\n out:\n\treturn error;\n}\n\nstatic void dmx3191d_remove_one(struct pci_dev *pdev)\n{\n\tstruct Scsi_Host *shost = pci_get_drvdata(pdev);\n\tstruct NCR5380_hostdata *hostdata = shost_priv(shost);\n\tunsigned long io = hostdata->base;\n\n\tscsi_remove_host(shost);\n\n\tNCR5380_exit(shost);\n\tscsi_host_put(shost);\n\trelease_region(io, DMX3191D_REGION_LEN);\n\tpci_disable_device(pdev);\n}\n\nstatic struct pci_device_id dmx3191d_pci_tbl[] = {\n\t{PCI_VENDOR_ID_DOMEX, PCI_DEVICE_ID_DOMEX_DMX3191D,\n\t\tPCI_ANY_ID, PCI_ANY_ID, 0, 0, 4},\n\t{ }\n};\nMODULE_DEVICE_TABLE(pci, dmx3191d_pci_tbl);\n\nstatic struct pci_driver dmx3191d_pci_driver = {\n\t.name\t\t= DMX3191D_DRIVER_NAME,\n\t.id_table\t= dmx3191d_pci_tbl,\n\t.probe\t\t= dmx3191d_probe_one,\n\t.remove\t\t= dmx3191d_remove_one,\n};\n\nmodule_pci_driver(dmx3191d_pci_driver);\n\nMODULE_AUTHOR(\"Massimo Piccioni <dafastidio@libero.it>\");\nMODULE_DESCRIPTION(\"Domex DMX3191D SCSI driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}