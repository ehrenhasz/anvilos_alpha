{
  "module_name": "qla_def.h",
  "hash_id": "6c3d3420ce7020ac5c6d4743237f628a80043c90f9284e3ddf65b538e68c1c65",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/qla2xxx/qla_def.h",
  "human_readable_source": " \n \n#ifndef __QLA_DEF_H\n#define __QLA_DEF_H\n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/types.h>\n#include <linux/module.h>\n#include <linux/list.h>\n#include <linux/pci.h>\n#include <linux/dma-mapping.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/dmapool.h>\n#include <linux/mempool.h>\n#include <linux/spinlock.h>\n#include <linux/completion.h>\n#include <linux/interrupt.h>\n#include <linux/workqueue.h>\n#include <linux/firmware.h>\n#include <linux/mutex.h>\n#include <linux/btree.h>\n\n#include <scsi/scsi.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_cmnd.h>\n#include <scsi/scsi_transport_fc.h>\n#include <scsi/scsi_bsg_fc.h>\n\n#include <uapi/scsi/fc/fc_els.h>\n\n#define QLA_DFS_DEFINE_DENTRY(_debugfs_file_name) \\\n\tstruct dentry *dfs_##_debugfs_file_name\n#define QLA_DFS_ROOT_DEFINE_DENTRY(_debugfs_file_name) \\\n\tstruct dentry *qla_dfs_##_debugfs_file_name\n\n \ntypedef struct {\n\tuint8_t domain;\n\tuint8_t area;\n\tuint8_t al_pa;\n} be_id_t;\n\n \ntypedef struct {\n\tuint8_t al_pa;\n\tuint8_t area;\n\tuint8_t domain;\n} le_id_t;\n\n \ntypedef union {\n\tuint32_t b24 : 24;\n\tstruct {\n#ifdef __BIG_ENDIAN\n\t\tuint8_t domain;\n\t\tuint8_t area;\n\t\tuint8_t al_pa;\n#elif defined(__LITTLE_ENDIAN)\n\t\tuint8_t al_pa;\n\t\tuint8_t area;\n\t\tuint8_t domain;\n#else\n#error \"__BIG_ENDIAN or __LITTLE_ENDIAN must be defined!\"\n#endif\n\t\tuint8_t rsvd_1;\n\t} b;\n} port_id_t;\n#define INVALID_PORT_ID\t0xFFFFFF\n\n#include \"qla_bsg.h\"\n#include \"qla_dsd.h\"\n#include \"qla_nx.h\"\n#include \"qla_nx2.h\"\n#include \"qla_nvme.h\"\n#define QLA2XXX_DRIVER_NAME\t\"qla2xxx\"\n#define QLA2XXX_APIDEV\t\t\"ql2xapidev\"\n#define QLA2XXX_MANUFACTURER\t\"Marvell Semiconductor, Inc.\"\n\n \n#define MAILBOX_REGISTER_COUNT_2100\t8\n#define MAILBOX_REGISTER_COUNT_2200\t24\n#define MAILBOX_REGISTER_COUNT\t\t32\n\n#define QLA2200A_RISC_ROM_VER\t4\n#define FPM_2300\t\t6\n#define FPM_2310\t\t7\n\n#include \"qla_settings.h\"\n\n#define MODE_DUAL (MODE_TARGET | MODE_INITIATOR)\n\n \n#define BIT_0\t0x1\n#define BIT_1\t0x2\n#define BIT_2\t0x4\n#define BIT_3\t0x8\n#define BIT_4\t0x10\n#define BIT_5\t0x20\n#define BIT_6\t0x40\n#define BIT_7\t0x80\n#define BIT_8\t0x100\n#define BIT_9\t0x200\n#define BIT_10\t0x400\n#define BIT_11\t0x800\n#define BIT_12\t0x1000\n#define BIT_13\t0x2000\n#define BIT_14\t0x4000\n#define BIT_15\t0x8000\n#define BIT_16\t0x10000\n#define BIT_17\t0x20000\n#define BIT_18\t0x40000\n#define BIT_19\t0x80000\n#define BIT_20\t0x100000\n#define BIT_21\t0x200000\n#define BIT_22\t0x400000\n#define BIT_23\t0x800000\n#define BIT_24\t0x1000000\n#define BIT_25\t0x2000000\n#define BIT_26\t0x4000000\n#define BIT_27\t0x8000000\n#define BIT_28\t0x10000000\n#define BIT_29\t0x20000000\n#define BIT_30\t0x40000000\n#define BIT_31\t0x80000000\n\n#define LSB(x)\t((uint8_t)(x))\n#define MSB(x)\t((uint8_t)((uint16_t)(x) >> 8))\n\n#define LSW(x)\t((uint16_t)(x))\n#define MSW(x)\t((uint16_t)((uint32_t)(x) >> 16))\n\n#define LSD(x)\t((uint32_t)((uint64_t)(x)))\n#define MSD(x)\t((uint32_t)((((uint64_t)(x)) >> 16) >> 16))\n\nstatic inline uint32_t make_handle(uint16_t x, uint16_t y)\n{\n\treturn ((uint32_t)x << 16) | y;\n}\n\n \n\nstatic inline u8 rd_reg_byte(const volatile u8 __iomem *addr)\n{\n\treturn readb(addr);\n}\n\nstatic inline u16 rd_reg_word(const volatile __le16 __iomem *addr)\n{\n\treturn readw(addr);\n}\n\nstatic inline u32 rd_reg_dword(const volatile __le32 __iomem *addr)\n{\n\treturn readl(addr);\n}\n\nstatic inline u8 rd_reg_byte_relaxed(const volatile u8 __iomem *addr)\n{\n\treturn readb_relaxed(addr);\n}\n\nstatic inline u16 rd_reg_word_relaxed(const volatile __le16 __iomem *addr)\n{\n\treturn readw_relaxed(addr);\n}\n\nstatic inline u32 rd_reg_dword_relaxed(const volatile __le32 __iomem *addr)\n{\n\treturn readl_relaxed(addr);\n}\n\nstatic inline void wrt_reg_byte(volatile u8 __iomem *addr, u8 data)\n{\n\treturn writeb(data, addr);\n}\n\nstatic inline void wrt_reg_word(volatile __le16 __iomem *addr, u16 data)\n{\n\treturn writew(data, addr);\n}\n\nstatic inline void wrt_reg_dword(volatile __le32 __iomem *addr, u32 data)\n{\n\treturn writel(data, addr);\n}\n\n \n#define QLA83XX_LED_PORT0\t\t\t0x00201320\n#define QLA83XX_LED_PORT1\t\t\t0x00201328\n#define QLA83XX_IDC_DEV_STATE\t\t0x22102384\n#define QLA83XX_IDC_MAJOR_VERSION\t0x22102380\n#define QLA83XX_IDC_MINOR_VERSION\t0x22102398\n#define QLA83XX_IDC_DRV_PRESENCE\t0x22102388\n#define QLA83XX_IDC_DRIVER_ACK\t\t0x2210238c\n#define QLA83XX_IDC_CONTROL\t\t\t0x22102390\n#define QLA83XX_IDC_AUDIT\t\t\t0x22102394\n#define QLA83XX_IDC_LOCK_RECOVERY\t0x2210239c\n#define QLA83XX_DRIVER_LOCKID\t\t0x22102104\n#define QLA83XX_DRIVER_LOCK\t\t\t0x8111c028\n#define QLA83XX_DRIVER_UNLOCK\t\t0x8111c02c\n#define QLA83XX_FLASH_LOCKID\t\t0x22102100\n#define QLA83XX_FLASH_LOCK\t\t\t0x8111c010\n#define QLA83XX_FLASH_UNLOCK\t\t0x8111c014\n#define QLA83XX_DEV_PARTINFO1\t\t0x221023e0\n#define QLA83XX_DEV_PARTINFO2\t\t0x221023e4\n#define QLA83XX_FW_HEARTBEAT\t\t0x221020b0\n#define QLA83XX_PEG_HALT_STATUS1\t0x221020a8\n#define QLA83XX_PEG_HALT_STATUS2\t0x221020ac\n\n \n#define IDC_DEVICE_STATE_CHANGE BIT_0\n#define IDC_PEG_HALT_STATUS_CHANGE BIT_1\n#define IDC_NIC_FW_REPORTED_FAILURE BIT_2\n#define IDC_HEARTBEAT_FAILURE BIT_3\n\n \n#define ERR_LEVEL_NON_FATAL 0x1\n#define ERR_LEVEL_RECOVERABLE_FATAL 0x2\n#define ERR_LEVEL_UNRECOVERABLE_FATAL 0x4\n\n \n#define QLA83XX_SUPP_IDC_MAJOR_VERSION 0x01\n#define QLA83XX_SUPP_IDC_MINOR_VERSION 0x0\n\n \n#define QLA83XX_NIC_CORE_RESET 0x1\n#define QLA83XX_IDC_STATE_HANDLER 0x2\n#define QLA83XX_NIC_CORE_UNRECOVERABLE 0x3\n\n \n#define QLA83XX_IDC_RESET_DISABLED BIT_0\n#define QLA83XX_IDC_GRACEFUL_RESET BIT_1\n\n \n#define QLA83XX_IDC_INITIALIZATION_TIMEOUT 30\n#define QLA83XX_IDC_RESET_ACK_TIMEOUT 10\n#define QLA83XX_MAX_LOCK_RECOVERY_WAIT (2 * HZ)\n\n \n#define QLA83XX_CLASS_TYPE_NONE\t\t0x0\n#define QLA83XX_CLASS_TYPE_NIC\t\t0x1\n#define QLA83XX_CLASS_TYPE_FCOE\t\t0x2\n#define QLA83XX_CLASS_TYPE_ISCSI\t0x3\n\n \n#define IDC_LOCK_RECOVERY_STAGE1\t0x1  \n#define IDC_LOCK_RECOVERY_STAGE2\t0x2  \n\n \n#define IDC_AUDIT_TIMESTAMP\t\t0x0  \n#define IDC_AUDIT_COMPLETION\t\t0x1  \n \n#define PORT_0_2031\t0x00201340\n#define PORT_1_2031\t0x00201350\n#define LASER_ON_2031\t0x01800100\n#define LASER_OFF_2031\t0x01800180\n\n \n#define RD_REG_WORD_PIO(addr)\t\t(inw((unsigned long)addr))\n#define WRT_REG_WORD_PIO(addr, data)\t(outw(data, (unsigned long)addr))\n\n \n#define WWN_SIZE\t\t8\t \n#define MAX_FIBRE_DEVICES_2100\t512\n#define MAX_FIBRE_DEVICES_2400\t2048\n#define MAX_FIBRE_DEVICES_LOOP\t128\n#define MAX_FIBRE_DEVICES_MAX\tMAX_FIBRE_DEVICES_2400\n#define LOOPID_MAP_SIZE\t\t(ha->max_fibre_devices)\n#define MAX_FIBRE_LUNS  \t0xFFFF\n#define\tMAX_HOST_COUNT\t\t16\n\n \n#define MAX_BUSES\t\t1   \n#define MIN_LUNS\t\t8\n#define MAX_LUNS\t\tMAX_FIBRE_LUNS\n#define MAX_CMDS_PER_LUN\t255\n\n \n#define SNS_LAST_LOOP_ID_2100\t0xfe\n#define SNS_LAST_LOOP_ID_2300\t0x7ff\n\n#define LAST_LOCAL_LOOP_ID\t0x7d\n#define SNS_FL_PORT\t\t0x7e\n#define FABRIC_CONTROLLER\t0x7f\n#define SIMPLE_NAME_SERVER\t0x80\n#define SNS_FIRST_LOOP_ID\t0x81\n#define MANAGEMENT_SERVER\t0xfe\n#define BROADCAST\t\t0xff\n\n \n#define NPH_LAST_HANDLE\t\t0x7ee\n#define NPH_MGMT_SERVER\t\t0x7ef\t\t \n#define NPH_SNS\t\t\t0x7fc\t\t \n#define NPH_FABRIC_CONTROLLER\t0x7fd\t\t \n#define NPH_F_PORT\t\t0x7fe\t\t \n#define NPH_IP_BROADCAST\t0x7ff\t\t \n\n#define NPH_SNS_LID(ha)\t(IS_FWI2_CAPABLE(ha) ? NPH_SNS : SIMPLE_NAME_SERVER)\n\n#define MAX_CMDSZ\t16\t\t \n#include \"qla_fw.h\"\n\nstruct name_list_extended {\n\tstruct get_name_list_extended *l;\n\tdma_addr_t\t\tldma;\n\tstruct list_head\tfcports;\n\tu32\t\t\tsize;\n\tu8\t\t\tsent;\n};\n\nstruct qla_nvme_fc_rjt {\n\tstruct fcnvme_ls_rjt *c;\n\tdma_addr_t  cdma;\n\tu16 size;\n};\n\nstruct els_reject {\n\tstruct fc_els_ls_rjt *c;\n\tdma_addr_t  cdma;\n\tu16 size;\n};\n\n \n#define PORT_RETRY_TIME\t\t\t1\n#define LOOP_DOWN_TIMEOUT\t\t60\n#define LOOP_DOWN_TIME\t\t\t255\t \n#define\tLOOP_DOWN_RESET\t\t\t(LOOP_DOWN_TIME - 30)\n\n#define DEFAULT_OUTSTANDING_COMMANDS\t4096\n#define MIN_OUTSTANDING_COMMANDS\t128\n\n \n#define REQUEST_ENTRY_CNT_2100\t\t128\t \n#define REQUEST_ENTRY_CNT_2200\t\t2048\t \n#define REQUEST_ENTRY_CNT_24XX\t\t2048\t \n#define REQUEST_ENTRY_CNT_83XX\t\t8192\t \n#define RESPONSE_ENTRY_CNT_83XX\t\t4096\t \n#define RESPONSE_ENTRY_CNT_2100\t\t64\t \n#define RESPONSE_ENTRY_CNT_2300\t\t512\t \n#define RESPONSE_ENTRY_CNT_MQ\t\t128\t \n#define ATIO_ENTRY_CNT_24XX\t\t4096\t \n#define RESPONSE_ENTRY_CNT_FX00\t\t256      \n#define FW_DEF_EXCHANGES_CNT 2048\n#define FW_MAX_EXCHANGES_CNT (32 * 1024)\n#define REDUCE_EXCHANGES_CNT  (8 * 1024)\n\n#define SET_DID_STATUS(stat_var, status) (stat_var = status << 16)\n\nstruct req_que;\nstruct qla_tgt_sess;\n\nstruct qla_buf_dsc {\n\tu16 tag;\n#define TAG_FREED 0xffff\n\tvoid *buf;\n\tdma_addr_t buf_dma;\n};\n\n \nstruct srb_cmd {\n\tstruct scsi_cmnd *cmd;\t\t \n\tuint32_t request_sense_length;\n\tuint32_t fw_sense_length;\n\tuint8_t *request_sense_ptr;\n\tstruct crc_context *crc_ctx;\n\tstruct ct6_dsd ct6_ctx;\n\tstruct qla_buf_dsc buf_dsc;\n};\n\n \n#define SRB_DMA_VALID\t\t\tBIT_0\t \n#define SRB_GOT_BUF\t\t\tBIT_1\n#define SRB_FCP_CMND_DMA_VALID\t\tBIT_12\t \n#define SRB_CRC_CTX_DMA_VALID\t\tBIT_2\t \n#define SRB_CRC_PROT_DMA_VALID\t\tBIT_4\t \n#define SRB_CRC_CTX_DSD_VALID\t\tBIT_5\t \n#define SRB_WAKEUP_ON_COMP\t\tBIT_6\n#define SRB_DIF_BUNDL_DMA_VALID\t\tBIT_7    \n#define SRB_EDIF_CLEANUP_DELETE\t\tBIT_9\n\n \n#define IS_PROT_IO(sp)\t(sp->flags & SRB_CRC_CTX_DSD_VALID)\n#define ISP_REG16_DISCONNECT 0xFFFF\n\nstatic inline le_id_t be_id_to_le(be_id_t id)\n{\n\tle_id_t res;\n\n\tres.domain = id.domain;\n\tres.area   = id.area;\n\tres.al_pa  = id.al_pa;\n\n\treturn res;\n}\n\nstatic inline be_id_t le_id_to_be(le_id_t id)\n{\n\tbe_id_t res;\n\n\tres.domain = id.domain;\n\tres.area   = id.area;\n\tres.al_pa  = id.al_pa;\n\n\treturn res;\n}\n\nstatic inline port_id_t be_to_port_id(be_id_t id)\n{\n\tport_id_t res;\n\n\tres.b.domain = id.domain;\n\tres.b.area   = id.area;\n\tres.b.al_pa  = id.al_pa;\n\tres.b.rsvd_1 = 0;\n\n\treturn res;\n}\n\nstatic inline be_id_t port_id_to_be_id(port_id_t port_id)\n{\n\tbe_id_t res;\n\n\tres.domain = port_id.b.domain;\n\tres.area   = port_id.b.area;\n\tres.al_pa  = port_id.b.al_pa;\n\n\treturn res;\n}\n\nstruct tmf_arg {\n\tstruct list_head tmf_elem;\n\tstruct qla_qpair *qpair;\n\tstruct fc_port *fcport;\n\tstruct scsi_qla_host *vha;\n\tu64 lun;\n\tu32 flags;\n\tuint8_t modifier;\n};\n\nstruct els_logo_payload {\n\tuint8_t opcode;\n\tuint8_t rsvd[3];\n\tuint8_t s_id[3];\n\tuint8_t rsvd1[1];\n\tuint8_t wwpn[WWN_SIZE];\n};\n\nstruct els_plogi_payload {\n\tuint8_t opcode;\n\tuint8_t rsvd[3];\n\t__be32\tdata[112 / 4];\n};\n\nstruct ct_arg {\n\tvoid\t\t*iocb;\n\tu16\t\tnport_handle;\n\tdma_addr_t\treq_dma;\n\tdma_addr_t\trsp_dma;\n\tu32\t\treq_size;\n\tu32\t\trsp_size;\n\tu32\t\treq_allocated_size;\n\tu32\t\trsp_allocated_size;\n\tvoid\t\t*req;\n\tvoid\t\t*rsp;\n\tport_id_t\tid;\n};\n\nstruct qla_nvme_lsrjt_pt_arg {\n\tstruct fc_port *fcport;\n\tu8 opcode;\n\tu8 vp_idx;\n\tu8 reason;\n\tu8 explanation;\n\t__le16 nport_handle;\n\tu16 control_flags;\n\t__le16 ox_id;\n\t__le32 xchg_address;\n\tu32 tx_byte_count, rx_byte_count;\n\tdma_addr_t tx_addr, rx_addr;\n};\n\n \nstruct srb_iocb {\n\tunion {\n\t\tstruct {\n\t\t\tuint16_t flags;\n#define SRB_LOGIN_RETRIED\tBIT_0\n#define SRB_LOGIN_COND_PLOGI\tBIT_1\n#define SRB_LOGIN_SKIP_PRLI\tBIT_2\n#define SRB_LOGIN_NVME_PRLI\tBIT_3\n#define SRB_LOGIN_PRLI_ONLY\tBIT_4\n#define SRB_LOGIN_FCSP\t\tBIT_5\n\t\t\tuint16_t data[2];\n\t\t\tu32 iop[2];\n\t\t} logio;\n\t\tstruct {\n#define ELS_DCMD_TIMEOUT 20\n#define ELS_DCMD_LOGO 0x5\n\t\t\tuint32_t flags;\n\t\t\tuint32_t els_cmd;\n\t\t\tstruct completion comp;\n\t\t\tstruct els_logo_payload *els_logo_pyld;\n\t\t\tdma_addr_t els_logo_pyld_dma;\n\t\t} els_logo;\n\t\tstruct els_plogi {\n#define ELS_DCMD_PLOGI 0x3\n\t\t\tuint32_t flags;\n\t\t\tuint32_t els_cmd;\n\t\t\tstruct completion comp;\n\t\t\tstruct els_plogi_payload *els_plogi_pyld;\n\t\t\tstruct els_plogi_payload *els_resp_pyld;\n\t\t\tu32 tx_size;\n\t\t\tu32 rx_size;\n\t\t\tdma_addr_t els_plogi_pyld_dma;\n\t\t\tdma_addr_t els_resp_pyld_dma;\n\t\t\t__le32\tfw_status[3];\n\t\t\t__le16\tcomp_status;\n\t\t\t__le16\tlen;\n\t\t} els_plogi;\n\t\tstruct {\n\t\t\t \n\t\t\tuint64_t lun;\n\t\t\tuint32_t flags;\n\t\t\tuint32_t data;\n\t\t\tstruct completion comp;\n\t\t\t__le16 comp_status;\n\n\t\t\tuint8_t modifier;\n\t\t\tuint8_t vp_index;\n\t\t\tuint16_t loop_id;\n\t\t} tmf;\n\t\tstruct {\n#define SRB_FXDISC_REQ_DMA_VALID\tBIT_0\n#define SRB_FXDISC_RESP_DMA_VALID\tBIT_1\n#define SRB_FXDISC_REQ_DWRD_VALID\tBIT_2\n#define SRB_FXDISC_RSP_DWRD_VALID\tBIT_3\n#define FXDISC_TIMEOUT 20\n\t\t\tuint8_t flags;\n\t\t\tuint32_t req_len;\n\t\t\tuint32_t rsp_len;\n\t\t\tvoid *req_addr;\n\t\t\tvoid *rsp_addr;\n\t\t\tdma_addr_t req_dma_handle;\n\t\t\tdma_addr_t rsp_dma_handle;\n\t\t\t__le32 adapter_id;\n\t\t\t__le32 adapter_id_hi;\n\t\t\t__le16 req_func_type;\n\t\t\t__le32 req_data;\n\t\t\t__le32 req_data_extra;\n\t\t\t__le32 result;\n\t\t\t__le32 seq_number;\n\t\t\t__le16 fw_flags;\n\t\t\tstruct completion fxiocb_comp;\n\t\t\t__le32 reserved_0;\n\t\t\tuint8_t reserved_1;\n\t\t} fxiocb;\n\t\tstruct {\n\t\t\tuint32_t cmd_hndl;\n\t\t\t__le16 comp_status;\n\t\t\t__le16 req_que_no;\n\t\t\tstruct completion comp;\n\t\t} abt;\n\t\tstruct ct_arg ctarg;\n#define MAX_IOCB_MB_REG 28\n#define SIZEOF_IOCB_MB_REG (MAX_IOCB_MB_REG * sizeof(uint16_t))\n\t\tstruct {\n\t\t\tu16 in_mb[MAX_IOCB_MB_REG];\t \n\t\t\tu16 out_mb[MAX_IOCB_MB_REG];\t \n\t\t\tvoid *out, *in;\n\t\t\tdma_addr_t out_dma, in_dma;\n\t\t\tstruct completion comp;\n\t\t\tint rc;\n\t\t} mbx;\n\t\tstruct {\n\t\t\tstruct imm_ntfy_from_isp *ntfy;\n\t\t} nack;\n\t\tstruct {\n\t\t\t__le16 comp_status;\n\t\t\t__le16 rsp_pyld_len;\n\t\t\tuint8_t\taen_op;\n\t\t\tvoid *desc;\n\n\t\t\t \n\t\t\t__le32 cmd_len;\n\t\t\t__le32 rsp_len;\n\t\t\tdma_addr_t cmd_dma;\n\t\t\tdma_addr_t rsp_dma;\n\t\t\tenum nvmefc_fcp_datadir dir;\n\t\t\tuint32_t dl;\n\t\t\tuint32_t timeout_sec;\n\t\t\t__le32 exchange_address;\n\t\t\t__le16 nport_handle;\n\t\t\t__le16 ox_id;\n\t\t\tstruct\tlist_head   entry;\n\t\t} nvme;\n\t\tstruct {\n\t\t\tu16 cmd;\n\t\t\tu16 vp_index;\n\t\t} ctrlvp;\n\t\tstruct {\n\t\t\tstruct edif_sa_ctl\t*sa_ctl;\n\t\t\tstruct qla_sa_update_frame sa_frame;\n\t\t} sa_update;\n\t} u;\n\n\tstruct timer_list timer;\n\tvoid (*timeout)(void *);\n};\n\n \n#define SRB_LOGIN_CMD\t1\n#define SRB_LOGOUT_CMD\t2\n#define SRB_ELS_CMD_RPT 3\n#define SRB_ELS_CMD_HST 4\n#define SRB_CT_CMD\t5\n#define SRB_ADISC_CMD\t6\n#define SRB_TM_CMD\t7\n#define SRB_SCSI_CMD\t8\n#define SRB_BIDI_CMD\t9\n#define SRB_FXIOCB_DCMD\t10\n#define SRB_FXIOCB_BCMD\t11\n#define SRB_ABT_CMD\t12\n#define SRB_ELS_DCMD\t13\n#define SRB_MB_IOCB\t14\n#define SRB_CT_PTHRU_CMD 15\n#define SRB_NACK_PLOGI\t16\n#define SRB_NACK_PRLI\t17\n#define SRB_NACK_LOGO\t18\n#define SRB_NVME_CMD\t19\n#define SRB_NVME_LS\t20\n#define SRB_PRLI_CMD\t21\n#define SRB_CTRL_VP\t22\n#define SRB_PRLO_CMD\t23\n#define SRB_SA_UPDATE\t25\n#define SRB_ELS_CMD_HST_NOLOGIN 26\n#define SRB_SA_REPLACE\t27\n#define SRB_MARKER\t28\n\nstruct qla_els_pt_arg {\n\tu8 els_opcode;\n\tu8 vp_idx;\n\t__le16 nport_handle;\n\tu16 control_flags, ox_id;\n\t__le32 rx_xchg_address;\n\tport_id_t did, sid;\n\tu32 tx_len, tx_byte_count, rx_len, rx_byte_count;\n\tdma_addr_t tx_addr, rx_addr;\n\n};\n\nenum {\n\tTYPE_SRB,\n\tTYPE_TGT_CMD,\n\tTYPE_TGT_TMCMD,\t\t \n};\n\nstruct iocb_resource {\n\tu8 res_type;\n\tu8  exch_cnt;\n\tu16 iocb_cnt;\n};\n\nstruct bsg_cmd {\n\tstruct bsg_job *bsg_job;\n\tunion {\n\t\tstruct qla_els_pt_arg els_arg;\n\t} u;\n};\n\ntypedef struct srb {\n\t \n\tuint8_t cmd_type;\n\tuint8_t pad[3];\n\tstruct iocb_resource iores;\n\tstruct kref cmd_kref;\t \n\tvoid *priv;\n\tstruct fc_port *fcport;\n\tstruct scsi_qla_host *vha;\n\tunsigned int start_timer:1;\n\tunsigned int abort:1;\n\tunsigned int aborted:1;\n\tunsigned int completed:1;\n\tunsigned int unsol_rsp:1;\n\n\tuint32_t handle;\n\tuint16_t flags;\n\tuint16_t type;\n\tconst char *name;\n\tint iocbs;\n\tstruct qla_qpair *qpair;\n\tstruct srb *cmd_sp;\n\tstruct list_head elem;\n\tu32 gen1;\t \n\tu32 gen2;\t \n\tint rc;\n\tint retry_count;\n\tstruct completion *comp;\n\tunion {\n\t\tstruct srb_iocb iocb_cmd;\n\t\tstruct bsg_job *bsg_job;\n\t\tstruct srb_cmd scmd;\n\t\tstruct bsg_cmd bsg_cmd;\n\t} u;\n\tstruct {\n\t\tbool remapped;\n\t\tstruct {\n\t\t\tdma_addr_t dma;\n\t\t\tvoid *buf;\n\t\t\tuint len;\n\t\t} req;\n\t\tstruct {\n\t\t\tdma_addr_t dma;\n\t\t\tvoid *buf;\n\t\t\tuint len;\n\t\t} rsp;\n\t} remap;\n\t \n\tvoid (*done)(struct srb *sp, int res);\n\t \n\tvoid (*free)(struct srb *sp);\n\t \n\tvoid (*put_fn)(struct kref *kref);\n\n\t \n\tvoid (*async_done)(struct srb *sp, int res);\n} srb_t;\n\n#define GET_CMD_SP(sp) (sp->u.scmd.cmd)\n\n#define GET_CMD_SENSE_LEN(sp) \\\n\t(sp->u.scmd.request_sense_length)\n#define SET_CMD_SENSE_LEN(sp, len) \\\n\t(sp->u.scmd.request_sense_length = len)\n#define GET_CMD_SENSE_PTR(sp) \\\n\t(sp->u.scmd.request_sense_ptr)\n#define SET_CMD_SENSE_PTR(sp, ptr) \\\n\t(sp->u.scmd.request_sense_ptr = ptr)\n#define GET_FW_SENSE_LEN(sp) \\\n\t(sp->u.scmd.fw_sense_length)\n#define SET_FW_SENSE_LEN(sp, len) \\\n\t(sp->u.scmd.fw_sense_length = len)\n\nstruct msg_echo_lb {\n\tdma_addr_t send_dma;\n\tdma_addr_t rcv_dma;\n\tuint16_t req_sg_cnt;\n\tuint16_t rsp_sg_cnt;\n\tuint16_t options;\n\tuint32_t transfer_size;\n\tuint32_t iteration_count;\n};\n\n \nstruct device_reg_2xxx {\n\t__le16\tflash_address; \t \n\t__le16\tflash_data;\t\t \n\t__le16\tunused_1[1];\t\t \n\t__le16\tctrl_status;\t\t \n#define CSR_FLASH_64K_BANK\tBIT_3\t \n#define CSR_FLASH_ENABLE\tBIT_1\t \n#define CSR_ISP_SOFT_RESET\tBIT_0\t \n\n\t__le16\tictrl;\t\t\t \n#define ICR_EN_INT\t\tBIT_15\t \n#define ICR_EN_RISC\t\tBIT_3\t \n\n\t__le16\tistatus;\t\t \n#define ISR_RISC_INT\t\tBIT_3\t \n\n\t__le16\tsemaphore;\t\t \n\t__le16\tnvram;\t\t\t \n#define NVR_DESELECT\t\t0\n#define NVR_BUSY\t\tBIT_15\n#define NVR_WRT_ENABLE\t\tBIT_14\t \n#define NVR_PR_ENABLE\t\tBIT_13\t \n#define NVR_DATA_IN\t\tBIT_3\n#define NVR_DATA_OUT\t\tBIT_2\n#define NVR_SELECT\t\tBIT_1\n#define NVR_CLOCK\t\tBIT_0\n\n#define NVR_WAIT_CNT\t\t20000\n\n\tunion {\n\t\tstruct {\n\t\t\t__le16\tmailbox0;\n\t\t\t__le16\tmailbox1;\n\t\t\t__le16\tmailbox2;\n\t\t\t__le16\tmailbox3;\n\t\t\t__le16\tmailbox4;\n\t\t\t__le16\tmailbox5;\n\t\t\t__le16\tmailbox6;\n\t\t\t__le16\tmailbox7;\n\t\t\t__le16\tunused_2[59];\t \n\t\t} __attribute__((packed)) isp2100;\n\t\tstruct {\n\t\t\t\t\t\t \n\t\t\t__le16\treq_q_in;\t \n\t\t\t__le16\treq_q_out;\t \n\t\t\t\t\t\t \n\t\t\t__le16\trsp_q_in;\t \n\t\t\t__le16\trsp_q_out;\t \n\n\t\t\t\t\t\t \n\t\t\t__le32\thost_status;\n#define HSR_RISC_INT\t\tBIT_15\t \n#define HSR_RISC_PAUSED\t\tBIT_8\t \n\n\t\t\t\t\t \n\t\t\t__le16\thost_semaphore;\n\t\t\t__le16\tunused_3[17];\t \n\t\t\t__le16\tmailbox0;\n\t\t\t__le16\tmailbox1;\n\t\t\t__le16\tmailbox2;\n\t\t\t__le16\tmailbox3;\n\t\t\t__le16\tmailbox4;\n\t\t\t__le16\tmailbox5;\n\t\t\t__le16\tmailbox6;\n\t\t\t__le16\tmailbox7;\n\t\t\t__le16\tmailbox8;\n\t\t\t__le16\tmailbox9;\n\t\t\t__le16\tmailbox10;\n\t\t\t__le16\tmailbox11;\n\t\t\t__le16\tmailbox12;\n\t\t\t__le16\tmailbox13;\n\t\t\t__le16\tmailbox14;\n\t\t\t__le16\tmailbox15;\n\t\t\t__le16\tmailbox16;\n\t\t\t__le16\tmailbox17;\n\t\t\t__le16\tmailbox18;\n\t\t\t__le16\tmailbox19;\n\t\t\t__le16\tmailbox20;\n\t\t\t__le16\tmailbox21;\n\t\t\t__le16\tmailbox22;\n\t\t\t__le16\tmailbox23;\n\t\t\t__le16\tmailbox24;\n\t\t\t__le16\tmailbox25;\n\t\t\t__le16\tmailbox26;\n\t\t\t__le16\tmailbox27;\n\t\t\t__le16\tmailbox28;\n\t\t\t__le16\tmailbox29;\n\t\t\t__le16\tmailbox30;\n\t\t\t__le16\tmailbox31;\n\t\t\t__le16\tfb_cmd;\n\t\t\t__le16\tunused_4[10];\t \n\t\t} __attribute__((packed)) isp2300;\n\t} u;\n\n\t__le16\tfpm_diag_config;\n\t__le16\tunused_5[0x4];\t\t \n\t__le16\trisc_hw;\n\t__le16\tunused_5_1;\t\t \n\t__le16\tpcr;\t\t\t \n\t__le16\tunused_6[0x5];\t\t \n\t__le16\tmctr;\t\t\t \n\t__le16\tunused_7[0x3];\t\t \n\t__le16\tfb_cmd_2100;\t\t \n\t__le16\tunused_8[0x3];\t\t \n\t__le16\thccr;\t\t\t \n#define HCCR_HOST_INT\t\tBIT_7\t \n#define HCCR_RISC_PAUSE\t\tBIT_5\t \n\t\t\t\t\t \n#define HCCR_RESET_RISC\t\t0x1000\t \n#define HCCR_PAUSE_RISC\t\t0x2000\t \n#define HCCR_RELEASE_RISC\t0x3000\t \n#define HCCR_SET_HOST_INT\t0x5000\t \n#define HCCR_CLR_HOST_INT\t0x6000\t \n#define HCCR_CLR_RISC_INT\t0x7000\t \n#define\tHCCR_DISABLE_PARITY_PAUSE 0x4001  \n#define HCCR_ENABLE_PARITY\t0xA000\t \n\n\t__le16\tunused_9[5];\t\t \n\t__le16\tgpiod;\t\t\t \n\t__le16\tgpioe;\t\t\t \n#define GPIO_LED_MASK\t\t\t0x00C0\n#define GPIO_LED_GREEN_OFF_AMBER_OFF\t0x0000\n#define GPIO_LED_GREEN_ON_AMBER_OFF\t0x0040\n#define GPIO_LED_GREEN_OFF_AMBER_ON\t0x0080\n#define GPIO_LED_GREEN_ON_AMBER_ON\t0x00C0\n#define GPIO_LED_ALL_OFF\t\t0x0000\n#define GPIO_LED_RED_ON_OTHER_OFF\t0x0001\t \n#define GPIO_LED_RGA_ON\t\t\t0x00C1\t \n\n\tunion {\n\t\tstruct {\n\t\t\t__le16\tunused_10[8];\t \n\t\t\t__le16\tmailbox8;\n\t\t\t__le16\tmailbox9;\n\t\t\t__le16\tmailbox10;\n\t\t\t__le16\tmailbox11;\n\t\t\t__le16\tmailbox12;\n\t\t\t__le16\tmailbox13;\n\t\t\t__le16\tmailbox14;\n\t\t\t__le16\tmailbox15;\n\t\t\t__le16\tmailbox16;\n\t\t\t__le16\tmailbox17;\n\t\t\t__le16\tmailbox18;\n\t\t\t__le16\tmailbox19;\n\t\t\t__le16\tmailbox20;\n\t\t\t__le16\tmailbox21;\n\t\t\t__le16\tmailbox22;\n\t\t\t__le16\tmailbox23;\t \n\t\t} __attribute__((packed)) isp2200;\n\t} u_end;\n};\n\nstruct device_reg_25xxmq {\n\t__le32\treq_q_in;\n\t__le32\treq_q_out;\n\t__le32\trsp_q_in;\n\t__le32\trsp_q_out;\n\t__le32\tatio_q_in;\n\t__le32\tatio_q_out;\n};\n\n\nstruct device_reg_fx00 {\n\t__le32\tmailbox0;\t\t \n\t__le32\tmailbox1;\t\t \n\t__le32\tmailbox2;\t\t \n\t__le32\tmailbox3;\t\t \n\t__le32\tmailbox4;\t\t \n\t__le32\tmailbox5;\t\t \n\t__le32\tmailbox6;\t\t \n\t__le32\tmailbox7;\t\t \n\t__le32\tmailbox8;\t\t \n\t__le32\tmailbox9;\t\t \n\t__le32\tmailbox10;\t\t \n\t__le32\tmailbox11;\n\t__le32\tmailbox12;\n\t__le32\tmailbox13;\n\t__le32\tmailbox14;\n\t__le32\tmailbox15;\n\t__le32\tmailbox16;\n\t__le32\tmailbox17;\n\t__le32\tmailbox18;\n\t__le32\tmailbox19;\n\t__le32\tmailbox20;\n\t__le32\tmailbox21;\n\t__le32\tmailbox22;\n\t__le32\tmailbox23;\n\t__le32\tmailbox24;\n\t__le32\tmailbox25;\n\t__le32\tmailbox26;\n\t__le32\tmailbox27;\n\t__le32\tmailbox28;\n\t__le32\tmailbox29;\n\t__le32\tmailbox30;\n\t__le32\tmailbox31;\n\t__le32\taenmailbox0;\n\t__le32\taenmailbox1;\n\t__le32\taenmailbox2;\n\t__le32\taenmailbox3;\n\t__le32\taenmailbox4;\n\t__le32\taenmailbox5;\n\t__le32\taenmailbox6;\n\t__le32\taenmailbox7;\n\t \n\t__le32\treq_q_in;\t\t \n\t__le32\treq_q_out;\t\t \n\t \n\t__le32\trsp_q_in;\t\t \n\t__le32\trsp_q_out;\t\t \n\t \n\t__le32\tinitval0;\t\t \n\t__le32\tinitval1;\t\t \n\t__le32\tinitval2;\t\t \n\t__le32\tinitval3;\t\t \n\t__le32\tinitval4;\t\t \n\t__le32\tinitval5;\t\t \n\t__le32\tinitval6;\t\t \n\t__le32\tinitval7;\t\t \n\t__le32\tfwheartbeat;\t\t \n\t__le32\tpseudoaen;\t\t \n};\n\n\n\ntypedef union {\n\t\tstruct device_reg_2xxx isp;\n\t\tstruct device_reg_24xx isp24;\n\t\tstruct device_reg_25xxmq isp25mq;\n\t\tstruct device_reg_82xx isp82;\n\t\tstruct device_reg_fx00 ispfx00;\n} __iomem device_reg_t;\n\n#define ISP_REQ_Q_IN(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox4 : \\\n\t &(reg)->u.isp2300.req_q_in)\n#define ISP_REQ_Q_OUT(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox4 : \\\n\t &(reg)->u.isp2300.req_q_out)\n#define ISP_RSP_Q_IN(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox5 : \\\n\t &(reg)->u.isp2300.rsp_q_in)\n#define ISP_RSP_Q_OUT(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->u.isp2100.mailbox5 : \\\n\t &(reg)->u.isp2300.rsp_q_out)\n\n#define ISP_ATIO_Q_IN(vha) (vha->hw->tgt.atio_q_in)\n#define ISP_ATIO_Q_OUT(vha) (vha->hw->tgt.atio_q_out)\n\n#define MAILBOX_REG(ha, reg, num) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t (num < 8 ? \\\n\t  &(reg)->u.isp2100.mailbox0 + (num) : \\\n\t  &(reg)->u_end.isp2200.mailbox8 + (num) - 8) : \\\n\t &(reg)->u.isp2300.mailbox0 + (num))\n#define RD_MAILBOX_REG(ha, reg, num) \\\n\trd_reg_word(MAILBOX_REG(ha, reg, num))\n#define WRT_MAILBOX_REG(ha, reg, num, data) \\\n\twrt_reg_word(MAILBOX_REG(ha, reg, num), data)\n\n#define FB_CMD_REG(ha, reg) \\\n\t(IS_QLA2100(ha) || IS_QLA2200(ha) ? \\\n\t &(reg)->fb_cmd_2100 : \\\n\t &(reg)->u.isp2300.fb_cmd)\n#define RD_FB_CMD_REG(ha, reg) \\\n\trd_reg_word(FB_CMD_REG(ha, reg))\n#define WRT_FB_CMD_REG(ha, reg, data) \\\n\twrt_reg_word(FB_CMD_REG(ha, reg), data)\n\ntypedef struct {\n\tuint32_t\tout_mb;\t\t \n\tuint32_t\tin_mb;\t\t\t \n\tuint16_t\tmb[MAILBOX_REGISTER_COUNT];\n\tlong\t\tbuf_size;\n\tvoid\t\t*bufp;\n\tuint32_t\ttov;\n\tuint8_t\t\tflags;\n#define MBX_DMA_IN\tBIT_0\n#define\tMBX_DMA_OUT\tBIT_1\n#define IOCTL_CMD\tBIT_2\n} mbx_cmd_t;\n\nstruct mbx_cmd_32 {\n\tuint32_t\tout_mb;\t\t \n\tuint32_t\tin_mb;\t\t\t \n\tuint32_t\tmb[MAILBOX_REGISTER_COUNT];\n\tlong\t\tbuf_size;\n\tvoid\t\t*bufp;\n\tuint32_t\ttov;\n\tuint8_t\t\tflags;\n#define MBX_DMA_IN\tBIT_0\n#define\tMBX_DMA_OUT\tBIT_1\n#define IOCTL_CMD\tBIT_2\n};\n\n\n#define\tMBX_TOV_SECONDS\t30\n\n \n#define PROD_ID_1\t\t0x4953\n#define PROD_ID_2\t\t0x0000\n#define PROD_ID_2a\t\t0x5020\n#define PROD_ID_3\t\t0x2020\n\n \n#define MBS_FRM_ALIVE\t\t0\t \n#define MBS_CHKSUM_ERR\t\t1\t \n#define MBS_BUSY\t\t4\t \n\n \n#define MBS_COMMAND_COMPLETE\t\t0x4000\n#define MBS_INVALID_COMMAND\t\t0x4001\n#define MBS_HOST_INTERFACE_ERROR\t0x4002\n#define MBS_TEST_FAILED\t\t\t0x4003\n#define MBS_COMMAND_ERROR\t\t0x4005\n#define MBS_COMMAND_PARAMETER_ERROR\t0x4006\n#define MBS_PORT_ID_USED\t\t0x4007\n#define MBS_LOOP_ID_USED\t\t0x4008\n#define MBS_ALL_IDS_IN_USE\t\t0x4009\n#define MBS_NOT_LOGGED_IN\t\t0x400A\n#define MBS_LINK_DOWN_ERROR\t\t0x400B\n#define MBS_DIAG_ECHO_TEST_ERROR\t0x400C\n\nstatic inline bool qla2xxx_is_valid_mbs(unsigned int mbs)\n{\n\treturn MBS_COMMAND_COMPLETE <= mbs && mbs <= MBS_DIAG_ECHO_TEST_ERROR;\n}\n\n \n#define MBA_ASYNC_EVENT\t\t0x8000\t \n#define MBA_RESET\t\t0x8001\t \n#define MBA_SYSTEM_ERR\t\t0x8002\t \n#define MBA_REQ_TRANSFER_ERR\t0x8003\t \n#define MBA_RSP_TRANSFER_ERR\t0x8004\t \n#define MBA_WAKEUP_THRES\t0x8005\t \n#define MBA_LIP_OCCURRED\t0x8010\t \n\t\t\t\t\t \n#define MBA_LOOP_UP\t\t0x8011\t \n#define MBA_LOOP_DOWN\t\t0x8012\t \n#define MBA_LIP_RESET\t\t0x8013\t \n#define MBA_PORT_UPDATE\t\t0x8014\t \n#define MBA_RSCN_UPDATE\t\t0x8015\t \n#define MBA_LIP_F8\t\t0x8016\t \n#define MBA_LOOP_INIT_ERR\t0x8017\t \n#define MBA_FABRIC_AUTH_REQ\t0x801b\t \n#define MBA_CONGN_NOTI_RECV\t0x801e\t \n#define MBA_SCSI_COMPLETION\t0x8020\t \n#define MBA_CTIO_COMPLETION\t0x8021\t \n#define MBA_IP_COMPLETION\t0x8022\t \n#define MBA_IP_RECEIVE\t\t0x8023\t \n#define MBA_IP_BROADCAST\t0x8024\t \n#define MBA_IP_LOW_WATER_MARK\t0x8025\t \n#define MBA_IP_RCV_BUFFER_EMPTY 0x8026\t \n#define MBA_IP_HDR_DATA_SPLIT\t0x8027\t \n\t\t\t\t\t \n#define MBA_TRACE_NOTIFICATION\t0x8028\t \n#define MBA_POINT_TO_POINT\t0x8030\t \n#define MBA_CMPLT_1_16BIT\t0x8031\t \n#define MBA_CMPLT_2_16BIT\t0x8032\t \n#define MBA_CMPLT_3_16BIT\t0x8033\t \n#define MBA_CMPLT_4_16BIT\t0x8034\t \n#define MBA_CMPLT_5_16BIT\t0x8035\t \n#define MBA_CHG_IN_CONNECTION\t0x8036\t \n#define MBA_RIO_RESPONSE\t0x8040\t \n#define MBA_ZIO_RESPONSE\t0x8040\t \n#define MBA_CMPLT_2_32BIT\t0x8042\t \n#define MBA_BYPASS_NOTIFICATION\t0x8043\t \n#define MBA_DISCARD_RND_FRAME\t0x8048\t \n#define MBA_REJECTED_FCP_CMD\t0x8049\t \n#define MBA_FW_NOT_STARTED\t0x8050\t \n#define MBA_FW_STARTING\t\t0x8051\t \n#define MBA_FW_RESTART_CMPLT\t0x8060\t \n#define MBA_INIT_REQUIRED\t0x8061\t \n#define MBA_SHUTDOWN_REQUESTED\t0x8062\t \n#define MBA_TEMPERATURE_ALERT\t0x8070\t \n#define MBA_DPORT_DIAGNOSTICS\t0x8080\t \n#define MBA_TRANS_INSERT\t0x8130\t \n#define MBA_TRANS_REMOVE\t0x8131\t \n#define MBA_FW_INIT_FAILURE\t0x8401\t \n#define MBA_MIRROR_LUN_CHANGE\t0x8402\t \n#define MBA_FW_POLL_STATE\t0x8600   \n#define MBA_FW_RESET_FCT\t0x8502\t \n#define MBA_FW_INIT_INPROGRESS\t0x8500\t \n \n#define MBA_IDC_AEN\t\t0x8200   \n\n \n#define INTR_ROM_MB_SUCCESS\t\t0x1\n#define INTR_ROM_MB_FAILED\t\t0x2\n#define INTR_MB_SUCCESS\t\t\t0x10\n#define INTR_MB_FAILED\t\t\t0x11\n#define INTR_ASYNC_EVENT\t\t0x12\n#define INTR_RSP_QUE_UPDATE\t\t0x13\n#define INTR_RSP_QUE_UPDATE_83XX\t0x14\n#define INTR_ATIO_QUE_UPDATE\t\t0x1C\n#define INTR_ATIO_RSP_QUE_UPDATE\t0x1D\n#define INTR_ATIO_QUE_UPDATE_27XX\t0x1E\n\n \n#define MBS_LB_RESET\t0x17\n\n \n#define AEN_START_DIAG_TEST\t\t0x0\t \n#define AEN_DONE_DIAG_TEST_WITH_NOERR\t0x1\t \n#define AEN_DONE_DIAG_TEST_WITH_ERR\t0x2\t \n\n \n#define FO1_AE_ON_LIPF8\t\t\tBIT_0\n#define FO1_AE_ALL_LIP_RESET\t\tBIT_1\n#define FO1_CTIO_RETRY\t\t\tBIT_3\n#define FO1_DISABLE_LIP_F7_SW\t\tBIT_4\n#define FO1_DISABLE_100MS_LOS_WAIT\tBIT_5\n#define FO1_DISABLE_GPIO6_7\t\tBIT_6\t \n#define FO1_AE_ON_LOOP_INIT_ERR\t\tBIT_7\n#define FO1_SET_EMPHASIS_SWING\t\tBIT_8\n#define FO1_AE_AUTO_BYPASS\t\tBIT_9\n#define FO1_ENABLE_PURE_IOCB\t\tBIT_10\n#define FO1_AE_PLOGI_RJT\t\tBIT_11\n#define FO1_ENABLE_ABORT_SEQUENCE\tBIT_12\n#define FO1_AE_QUEUE_FULL\t\tBIT_13\n\n#define FO2_ENABLE_ATIO_TYPE_3\t\tBIT_0\n#define FO2_REV_LOOPBACK\t\tBIT_1\n\n#define FO3_ENABLE_EMERG_IOCB\t\tBIT_0\n#define FO3_AE_RND_ERROR\t\tBIT_1\n\n \n#define ADD_FO_COUNT\t\t\t3\n#define ADD_FO1_DISABLE_GPIO_LED_CTRL\tBIT_6\t \n#define ADD_FO1_ENABLE_PUREX_IOCB\tBIT_10\n\n#define ADD_FO2_ENABLE_SEL_CLS2\t\tBIT_5\n\n#define ADD_FO3_NO_ABT_ON_LINK_DOWN\tBIT_14\n\n \n#define MBC_LOAD_RAM\t\t\t1\t \n#define MBC_EXECUTE_FIRMWARE\t\t2\t \n#define MBC_READ_RAM_WORD\t\t5\t \n#define MBC_MAILBOX_REGISTER_TEST\t6\t \n#define MBC_VERIFY_CHECKSUM\t\t7\t \n#define MBC_GET_FIRMWARE_VERSION\t8\t \n#define MBC_LOAD_RISC_RAM\t\t9\t \n#define MBC_DUMP_RISC_RAM\t\t0xa\t \n#define MBC_SECURE_FLASH_UPDATE\t\t0xa\t \n#define MBC_LOAD_RISC_RAM_EXTENDED\t0xb\t \n#define MBC_DUMP_RISC_RAM_EXTENDED\t0xc\t \n#define MBC_WRITE_RAM_WORD_EXTENDED\t0xd\t \n#define MBC_READ_RAM_EXTENDED\t\t0xf\t \n#define MBC_IOCB_COMMAND\t\t0x12\t \n#define MBC_STOP_FIRMWARE\t\t0x14\t \n#define MBC_ABORT_COMMAND\t\t0x15\t \n#define MBC_ABORT_DEVICE\t\t0x16\t \n#define MBC_ABORT_TARGET\t\t0x17\t \n#define MBC_RESET\t\t\t0x18\t \n#define MBC_GET_ADAPTER_LOOP_ID\t\t0x20\t \n#define MBC_GET_SET_ZIO_THRESHOLD\t0x21\t \n#define MBC_GET_RETRY_COUNT\t\t0x22\t \n#define MBC_DISABLE_VI\t\t\t0x24\t \n#define MBC_ENABLE_VI\t\t\t0x25\t \n#define MBC_GET_FIRMWARE_OPTION\t\t0x28\t \n#define MBC_GET_MEM_OFFLOAD_CNTRL_STAT\t0x34\t \n#define MBC_SET_FIRMWARE_OPTION\t\t0x38\t \n#define MBC_SET_GET_FC_LED_CONFIG\t0x3b\t \n#define MBC_LOOP_PORT_BYPASS\t\t0x40\t \n#define MBC_LOOP_PORT_ENABLE\t\t0x41\t \n#define MBC_GET_RESOURCE_COUNTS\t\t0x42\t \n#define MBC_NON_PARTICIPATE\t\t0x43\t \n#define MBC_DIAGNOSTIC_ECHO\t\t0x44\t \n#define MBC_DIAGNOSTIC_LOOP_BACK\t0x45\t \n#define MBC_ONLINE_SELF_TEST\t\t0x46\t \n#define MBC_ENHANCED_GET_PORT_DATABASE\t0x47\t \n#define MBC_CONFIGURE_VF\t\t0x4b\t \n#define MBC_RESET_LINK_STATUS\t\t0x52\t \n#define MBC_IOCB_COMMAND_A64\t\t0x54\t \n#define MBC_PORT_LOGOUT\t\t\t0x56\t \n#define MBC_SEND_RNID_ELS\t\t0x57\t \n#define MBC_SET_RNID_PARAMS\t\t0x59\t \n#define MBC_GET_RNID_PARAMS\t\t0x5a\t \n#define MBC_DATA_RATE\t\t\t0x5d\t \n#define MBC_INITIALIZE_FIRMWARE\t\t0x60\t \n#define MBC_INITIATE_LIP\t\t0x62\t \n\t\t\t\t\t\t \n#define MBC_GET_FC_AL_POSITION_MAP\t0x63\t \n#define MBC_GET_PORT_DATABASE\t\t0x64\t \n#define MBC_CLEAR_ACA\t\t\t0x65\t \n#define MBC_TARGET_RESET\t\t0x66\t \n#define MBC_CLEAR_TASK_SET\t\t0x67\t \n#define MBC_ABORT_TASK_SET\t\t0x68\t \n#define MBC_GET_FIRMWARE_STATE\t\t0x69\t \n#define MBC_GET_PORT_NAME\t\t0x6a\t \n#define MBC_GET_LINK_STATUS\t\t0x6b\t \n#define MBC_LIP_RESET\t\t\t0x6c\t \n#define MBC_SEND_SNS_COMMAND\t\t0x6e\t \n\t\t\t\t\t\t \n#define MBC_LOGIN_FABRIC_PORT\t\t0x6f\t \n#define MBC_SEND_CHANGE_REQUEST\t\t0x70\t \n#define MBC_LOGOUT_FABRIC_PORT\t\t0x71\t \n#define MBC_LIP_FULL_LOGIN\t\t0x72\t \n#define MBC_LOGIN_LOOP_PORT\t\t0x74\t \n#define MBC_PORT_NODE_NAME_LIST\t\t0x75\t \n#define MBC_INITIALIZE_RECEIVE_QUEUE\t0x77\t \n#define MBC_UNLOAD_IP\t\t\t0x79\t \n#define MBC_GET_ID_LIST\t\t\t0x7C\t \n#define MBC_SEND_LFA_COMMAND\t\t0x7D\t \n#define MBC_LUN_RESET\t\t\t0x7E\t \n\n \n#define MBC_MR_DRV_SHUTDOWN\t\t0x6A\n\n \n#define MBC_WRITE_SERDES\t\t0x3\t \n#define MBC_READ_SERDES\t\t\t0x4\t \n#define MBC_LOAD_DUMP_MPI_RAM\t\t0x5\t \n#define MBC_SERDES_PARAMS\t\t0x10\t \n#define MBC_GET_IOCB_STATUS\t\t0x12\t \n#define MBC_PORT_PARAMS\t\t\t0x1A\t \n#define MBC_GET_TIMEOUT_PARAMS\t\t0x22\t \n#define MBC_TRACE_CONTROL\t\t0x27\t \n#define MBC_GEN_SYSTEM_ERROR\t\t0x2a\t \n#define MBC_WRITE_SFP\t\t\t0x30\t \n#define MBC_READ_SFP\t\t\t0x31\t \n#define MBC_SET_TIMEOUT_PARAMS\t\t0x32\t \n#define MBC_DPORT_DIAGNOSTICS\t\t0x47\t \n#define MBC_MID_INITIALIZE_FIRMWARE\t0x48\t \n#define MBC_MID_GET_VP_DATABASE\t\t0x49\t \n#define MBC_MID_GET_VP_ENTRY\t\t0x4a\t \n#define MBC_HOST_MEMORY_COPY\t\t0x53\t \n#define MBC_SEND_RNFT_ELS\t\t0x5e\t \n#define MBC_GET_LINK_PRIV_STATS\t\t0x6d\t \n#define MBC_LINK_INITIALIZATION\t\t0x72\t \n#define MBC_SET_VENDOR_ID\t\t0x76\t \n#define MBC_PORT_RESET\t\t\t0x120\t \n#define MBC_SET_PORT_CONFIG\t\t0x122\t \n#define MBC_GET_PORT_CONFIG\t\t0x123\t \n\n \n#define MBC_WRITE_MPI_REGISTER\t\t0x01     \n\n \n#define MBC_SET_GET_ETH_SERDES_REG\t0x150\n#define HCS_WRITE_SERDES\t\t0x3\n#define HCS_READ_SERDES\t\t\t0x4\n\n \n#define FCAL_MAP_SIZE\t128\n\n \n#define\tMBX_31\t\tBIT_31\n#define\tMBX_30\t\tBIT_30\n#define\tMBX_29\t\tBIT_29\n#define\tMBX_28\t\tBIT_28\n#define\tMBX_27\t\tBIT_27\n#define\tMBX_26\t\tBIT_26\n#define\tMBX_25\t\tBIT_25\n#define\tMBX_24\t\tBIT_24\n#define\tMBX_23\t\tBIT_23\n#define\tMBX_22\t\tBIT_22\n#define\tMBX_21\t\tBIT_21\n#define\tMBX_20\t\tBIT_20\n#define\tMBX_19\t\tBIT_19\n#define\tMBX_18\t\tBIT_18\n#define\tMBX_17\t\tBIT_17\n#define\tMBX_16\t\tBIT_16\n#define\tMBX_15\t\tBIT_15\n#define\tMBX_14\t\tBIT_14\n#define\tMBX_13\t\tBIT_13\n#define\tMBX_12\t\tBIT_12\n#define\tMBX_11\t\tBIT_11\n#define\tMBX_10\t\tBIT_10\n#define\tMBX_9\t\tBIT_9\n#define\tMBX_8\t\tBIT_8\n#define\tMBX_7\t\tBIT_7\n#define\tMBX_6\t\tBIT_6\n#define\tMBX_5\t\tBIT_5\n#define\tMBX_4\t\tBIT_4\n#define\tMBX_3\t\tBIT_3\n#define\tMBX_2\t\tBIT_2\n#define\tMBX_1\t\tBIT_1\n#define\tMBX_0\t\tBIT_0\n\n#define RNID_TYPE_ELS_CMD\t0x5\n#define RNID_TYPE_PORT_LOGIN\t0x7\n#define RNID_BUFFER_CREDITS\t0x8\n#define RNID_TYPE_SET_VERSION\t0x9\n#define RNID_TYPE_ASIC_TEMP\t0xC\n\n#define ELS_CMD_MAP_SIZE\t32\n\n \n#define FSTATE_CONFIG_WAIT      0\n#define FSTATE_WAIT_AL_PA       1\n#define FSTATE_WAIT_LOGIN       2\n#define FSTATE_READY            3\n#define FSTATE_LOSS_OF_SYNC     4\n#define FSTATE_ERROR            5\n#define FSTATE_REINIT           6\n#define FSTATE_NON_PART         7\n\n#define FSTATE_CONFIG_CORRECT      0\n#define FSTATE_P2P_RCV_LIP         1\n#define FSTATE_P2P_CHOOSE_LOOP     2\n#define FSTATE_P2P_RCV_UNIDEN_LIP  3\n#define FSTATE_FATAL_ERROR         4\n#define FSTATE_LOOP_BACK_CONN      5\n\n#define QLA27XX_IMG_STATUS_VER_MAJOR   0x01\n#define QLA27XX_IMG_STATUS_VER_MINOR    0x00\n#define QLA27XX_IMG_STATUS_SIGN   0xFACEFADE\n#define QLA28XX_IMG_STATUS_SIGN    0xFACEFADF\n#define QLA28XX_IMG_STATUS_SIGN\t\t0xFACEFADF\n#define QLA28XX_AUX_IMG_STATUS_SIGN\t0xFACEFAED\n#define QLA27XX_DEFAULT_IMAGE\t\t0\n#define QLA27XX_PRIMARY_IMAGE  1\n#define QLA27XX_SECONDARY_IMAGE    2\n\n \n#define\tPORT_DATABASE_SIZE\t128\t \ntypedef struct {\n\tuint8_t options;\n\tuint8_t control;\n\tuint8_t master_state;\n\tuint8_t slave_state;\n\tuint8_t reserved[2];\n\tuint8_t hard_address;\n\tuint8_t reserved_1;\n\tuint8_t port_id[4];\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n\t__le16\texecution_throttle;\n\tuint16_t execution_count;\n\tuint8_t reset_count;\n\tuint8_t reserved_2;\n\tuint16_t resource_allocation;\n\tuint16_t current_allocation;\n\tuint16_t queue_head;\n\tuint16_t queue_tail;\n\tuint16_t transmit_execution_list_next;\n\tuint16_t transmit_execution_list_previous;\n\tuint16_t common_features;\n\tuint16_t total_concurrent_sequences;\n\tuint16_t RO_by_information_category;\n\tuint8_t recipient;\n\tuint8_t initiator;\n\tuint16_t receive_data_size;\n\tuint16_t concurrent_sequences;\n\tuint16_t open_sequences_per_exchange;\n\tuint16_t lun_abort_flags;\n\tuint16_t lun_stop_flags;\n\tuint16_t stop_queue_head;\n\tuint16_t stop_queue_tail;\n\tuint16_t port_retry_timer;\n\tuint16_t next_sequence_id;\n\tuint16_t frame_count;\n\tuint16_t PRLI_payload_length;\n\tuint8_t prli_svc_param_word_0[2];\t \n\t\t\t\t\t\t \n\tuint8_t prli_svc_param_word_3[2];\t \n\t\t\t\t\t\t \n\tuint16_t loop_id;\n\tuint16_t extended_lun_info_list_pointer;\n\tuint16_t extended_lun_stop_list_pointer;\n} port_database_t;\n\n \n#define PD_STATE_DISCOVERY\t\t\t0\n#define PD_STATE_WAIT_DISCOVERY_ACK\t\t1\n#define PD_STATE_PORT_LOGIN\t\t\t2\n#define PD_STATE_WAIT_PORT_LOGIN_ACK\t\t3\n#define PD_STATE_PROCESS_LOGIN\t\t\t4\n#define PD_STATE_WAIT_PROCESS_LOGIN_ACK\t\t5\n#define PD_STATE_PORT_LOGGED_IN\t\t\t6\n#define PD_STATE_PORT_UNAVAILABLE\t\t7\n#define PD_STATE_PROCESS_LOGOUT\t\t\t8\n#define PD_STATE_WAIT_PROCESS_LOGOUT_ACK\t9\n#define PD_STATE_PORT_LOGOUT\t\t\t10\n#define PD_STATE_WAIT_PORT_LOGOUT_ACK\t\t11\n\n\n#define QLA_ZIO_MODE_6\t\t(BIT_2 | BIT_1)\n#define QLA_ZIO_DISABLED\t0\n#define QLA_ZIO_DEFAULT_TIMER\t2\n\n \n#define\tICB_VERSION 1\ntypedef struct {\n\tuint8_t  version;\n\tuint8_t  reserved_1;\n\n\t \n\tuint8_t  firmware_options[2];\n\n\t__le16\tframe_payload_size;\n\t__le16\tmax_iocb_allocation;\n\t__le16\texecution_throttle;\n\tuint8_t  retry_count;\n\tuint8_t\t retry_delay;\t\t\t \n\tuint8_t\t port_name[WWN_SIZE];\t\t \n\tuint16_t hard_address;\n\tuint8_t\t inquiry_data;\n\tuint8_t\t login_timeout;\n\tuint8_t\t node_name[WWN_SIZE];\t\t \n\n\t__le16\trequest_q_outpointer;\n\t__le16\tresponse_q_inpointer;\n\t__le16\trequest_q_length;\n\t__le16\tresponse_q_length;\n\t__le64  request_q_address __packed;\n\t__le64  response_q_address __packed;\n\n\t__le16\tlun_enables;\n\tuint8_t  command_resource_count;\n\tuint8_t  immediate_notify_resource_count;\n\t__le16\ttimeout;\n\tuint8_t  reserved_2[2];\n\n\t \n\tuint8_t\t add_firmware_options[2];\n\n\tuint8_t\t response_accumulation_timer;\n\tuint8_t\t interrupt_delay_timer;\n\n\t \n\tuint8_t\t special_options[2];\n\n\tuint8_t  reserved_3[26];\n} init_cb_t;\n\n \nstruct init_sf_cb {\n\tuint8_t\tformat;\n\tuint8_t\treserved0;\n\t \n\t__le16\tflags;\n\tuint8_t\treserved1[32];\n\tuint16_t discard_OHRB_timeout_value;\n\tuint16_t remote_write_opt_queue_num;\n\tuint8_t\treserved2[40];\n\tuint8_t scm_related_parameter[16];\n\tuint8_t reserved3[32];\n};\n\n \n#define GLSO_SEND_RPS\tBIT_0\n#define GLSO_USE_DID\tBIT_3\n\nstruct link_statistics {\n\t__le32 link_fail_cnt;\n\t__le32 loss_sync_cnt;\n\t__le32 loss_sig_cnt;\n\t__le32 prim_seq_err_cnt;\n\t__le32 inval_xmit_word_cnt;\n\t__le32 inval_crc_cnt;\n\t__le32 lip_cnt;\n\t__le32 link_up_cnt;\n\t__le32 link_down_loop_init_tmo;\n\t__le32 link_down_los;\n\t__le32 link_down_loss_rcv_clk;\n\tuint32_t reserved0[5];\n\t__le32 port_cfg_chg;\n\tuint32_t reserved1[11];\n\t__le32 rsp_q_full;\n\t__le32 atio_q_full;\n\t__le32 drop_ae;\n\t__le32 els_proto_err;\n\t__le32 reserved2;\n\t__le32 tx_frames;\n\t__le32 rx_frames;\n\t__le32 discarded_frames;\n\t__le32 dropped_frames;\n\tuint32_t reserved3;\n\t__le32 nos_rcvd;\n\tuint32_t reserved4[4];\n\t__le32 tx_prjt;\n\t__le32 rcv_exfail;\n\t__le32 rcv_abts;\n\t__le32 seq_frm_miss;\n\t__le32 corr_err;\n\t__le32 mb_rqst;\n\t__le32 nport_full;\n\t__le32 eofa;\n\tuint32_t reserved5;\n\t__le64 fpm_recv_word_cnt;\n\t__le64 fpm_disc_word_cnt;\n\t__le64 fpm_xmit_word_cnt;\n\tuint32_t reserved6[70];\n};\n\n \n#define NV_START_BIT            BIT_2\n#define NV_WRITE_OP             (BIT_26+BIT_24)\n#define NV_READ_OP              (BIT_26+BIT_25)\n#define NV_ERASE_OP             (BIT_26+BIT_25+BIT_24)\n#define NV_MASK_OP              (BIT_26+BIT_25+BIT_24)\n#define NV_DELAY_COUNT          10\n\n \ntypedef struct {\n\t \n\tuint8_t\tid[4];\n\tuint8_t\tnvram_version;\n\tuint8_t\treserved_0;\n\n\t \n\tuint8_t\tparameter_block_version;\n\tuint8_t\treserved_1;\n\n\t \n\tuint8_t\t firmware_options[2];\n\n\t__le16\tframe_payload_size;\n\t__le16\tmax_iocb_allocation;\n\t__le16\texecution_throttle;\n\tuint8_t\t retry_count;\n\tuint8_t\t retry_delay;\t\t\t \n\tuint8_t\t port_name[WWN_SIZE];\t\t \n\tuint16_t hard_address;\n\tuint8_t\t inquiry_data;\n\tuint8_t\t login_timeout;\n\tuint8_t\t node_name[WWN_SIZE];\t\t \n\n\t \n\tuint8_t\t add_firmware_options[2];\n\n\tuint8_t\t response_accumulation_timer;\n\tuint8_t\t interrupt_delay_timer;\n\n\t \n\tuint8_t\t special_options[2];\n\n\t \n\tuint8_t reserved_2[22];\n\n\t \n\tuint8_t seriallink_options[4];\n\n\t \n\tuint8_t host_p[2];\n\n\tuint8_t boot_node_name[WWN_SIZE];\n\tuint8_t boot_lun_number;\n\tuint8_t reset_delay;\n\tuint8_t port_down_retry_count;\n\tuint8_t boot_id_number;\n\t__le16\tmax_luns_per_target;\n\tuint8_t fcode_boot_port_name[WWN_SIZE];\n\tuint8_t alternate_port_name[WWN_SIZE];\n\tuint8_t alternate_node_name[WWN_SIZE];\n\n\t \n\tuint8_t efi_parameters;\n\n\tuint8_t link_down_timeout;\n\n\tuint8_t adapter_id[16];\n\n\tuint8_t alt1_boot_node_name[WWN_SIZE];\n\tuint16_t alt1_boot_lun_number;\n\tuint8_t alt2_boot_node_name[WWN_SIZE];\n\tuint16_t alt2_boot_lun_number;\n\tuint8_t alt3_boot_node_name[WWN_SIZE];\n\tuint16_t alt3_boot_lun_number;\n\tuint8_t alt4_boot_node_name[WWN_SIZE];\n\tuint16_t alt4_boot_lun_number;\n\tuint8_t alt5_boot_node_name[WWN_SIZE];\n\tuint16_t alt5_boot_lun_number;\n\tuint8_t alt6_boot_node_name[WWN_SIZE];\n\tuint16_t alt6_boot_lun_number;\n\tuint8_t alt7_boot_node_name[WWN_SIZE];\n\tuint16_t alt7_boot_lun_number;\n\n\tuint8_t reserved_3[2];\n\n\t \n\tuint8_t model_number[16];\n\n\t \n\tuint8_t oem_specific[16];\n\n\t \n\tuint8_t\tadapter_features[2];\n\n\tuint8_t reserved_4[16];\n\n\t \n\tuint16_t subsystem_vendor_id_2200;\n\n\t \n\tuint16_t subsystem_device_id_2200;\n\n\tuint8_t\t reserved_5;\n\tuint8_t\t checksum;\n} nvram_t;\n\n \ntypedef struct {\n\tuint8_t\t\tentry_type;\t\t \n\tuint8_t\t\tentry_count;\t\t \n\tuint8_t\t\tsys_define;\t\t \n\tuint8_t\t\tentry_status;\t\t \n\tuint32_t\thandle;\t\t\t \n\tuint8_t\t\tdata[52];\n\tuint32_t\tsignature;\n#define RESPONSE_PROCESSED\t0xDEADDEAD\t \n} response_t;\n\n \nstruct atio {\n\tuint8_t\t\tentry_type;\t\t \n\tuint8_t\t\tentry_count;\t\t \n\t__le16\t\tattr_n_length;\n\tuint8_t\t\tdata[56];\n\tuint32_t\tsignature;\n#define ATIO_PROCESSED 0xDEADDEAD\t\t \n};\n\ntypedef union {\n\t__le16\textended;\n\tstruct {\n\t\tuint8_t reserved;\n\t\tuint8_t standard;\n\t} id;\n} target_id_t;\n\n#define SET_TARGET_ID(ha, to, from)\t\t\t\\\ndo {\t\t\t\t\t\t\t\\\n\tif (HAS_EXTENDED_IDS(ha))\t\t\t\\\n\t\tto.extended = cpu_to_le16(from);\t\\\n\telse\t\t\t\t\t\t\\\n\t\tto.id.standard = (uint8_t)from;\t\t\\\n} while (0)\n\n \n#define COMMAND_TYPE\t0x11\t\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t sys_define;\t\t \n\tuint8_t entry_status;\t\t \n\tuint32_t handle;\t\t \n\ttarget_id_t target;\t\t \n\t__le16\tlun;\t\t\t \n\t__le16\tcontrol_flags;\t\t \n#define CF_WRITE\tBIT_6\n#define CF_READ\t\tBIT_5\n#define CF_SIMPLE_TAG\tBIT_3\n#define CF_ORDERED_TAG\tBIT_2\n#define CF_HEAD_TAG\tBIT_1\n\tuint16_t reserved_1;\n\t__le16\ttimeout;\t\t \n\t__le16\tdseg_count;\t\t \n\tuint8_t scsi_cdb[MAX_CMDSZ]; \t \n\t__le32\tbyte_count;\t\t \n\tunion {\n\t\tstruct dsd32 dsd32[3];\n\t\tstruct dsd64 dsd64[2];\n\t};\n} cmd_entry_t;\n\n \n#define COMMAND_A64_TYPE\t0x19\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t sys_define;\t\t \n\tuint8_t entry_status;\t\t \n\tuint32_t handle;\t\t \n\ttarget_id_t target;\t\t \n\t__le16\tlun;\t\t\t \n\t__le16\tcontrol_flags;\t\t \n\tuint16_t reserved_1;\n\t__le16\ttimeout;\t\t \n\t__le16\tdseg_count;\t\t \n\tuint8_t scsi_cdb[MAX_CMDSZ];\t \n\tuint32_t byte_count;\t\t \n\tstruct dsd64 dsd[2];\n} cmd_a64_entry_t, request_t;\n\n \n#define CONTINUE_TYPE\t\t0x02\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t sys_define;\t\t \n\tuint8_t entry_status;\t\t \n\tuint32_t reserved;\n\tstruct dsd32 dsd[7];\n} cont_entry_t;\n\n \n#define CONTINUE_A64_TYPE\t0x0A\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t sys_define;\t\t \n\tuint8_t entry_status;\t\t \n\tstruct dsd64 dsd[5];\n} cont_a64_entry_t;\n\n#define PO_MODE_DIF_INSERT\t0\n#define PO_MODE_DIF_REMOVE\t1\n#define PO_MODE_DIF_PASS\t2\n#define PO_MODE_DIF_REPLACE\t3\n#define PO_MODE_DIF_TCP_CKSUM\t6\n#define PO_ENABLE_INCR_GUARD_SEED\tBIT_3\n#define PO_DISABLE_GUARD_CHECK\tBIT_4\n#define PO_DISABLE_INCR_REF_TAG\tBIT_5\n#define PO_DIS_HEADER_MODE\tBIT_7\n#define PO_ENABLE_DIF_BUNDLING\tBIT_8\n#define PO_DIS_FRAME_MODE\tBIT_9\n#define PO_DIS_VALD_APP_ESC\tBIT_10  \n#define PO_DIS_VALD_APP_REF_ESC BIT_11\n\n#define PO_DIS_APP_TAG_REPL\tBIT_12  \n#define PO_DIS_REF_TAG_REPL\tBIT_13\n#define PO_DIS_APP_TAG_VALD\tBIT_14  \n#define PO_DIS_REF_TAG_VALD\tBIT_15\n\n \nstruct crc_context {\n\tuint32_t handle;\t\t \n\t__le32 ref_tag;\n\t__le16 app_tag;\n\tuint8_t ref_tag_mask[4];\t \n\tuint8_t app_tag_mask[2];\t \n\t__le16 guard_seed;\t\t \n\t__le16 prot_opts;\t\t \n\t__le16 blk_size;\t\t \n\t__le16\trunt_blk_guard;\t \n\t__le32 byte_count;\t\t \n\tunion {\n\t\tstruct {\n\t\t\tuint32_t\treserved_1;\n\t\t\tuint16_t\treserved_2;\n\t\t\tuint16_t\treserved_3;\n\t\t\tuint32_t\treserved_4;\n\t\t\tstruct dsd64\tdata_dsd[1];\n\t\t\tuint32_t\treserved_5[2];\n\t\t\tuint32_t\treserved_6;\n\t\t} nobundling;\n\t\tstruct {\n\t\t\t__le32\tdif_byte_count;\t \n\t\t\tuint16_t\treserved_1;\n\t\t\t__le16\tdseg_count;\t \n\t\t\tuint32_t\treserved_2;\n\t\t\tstruct dsd64\tdata_dsd[1];\n\t\t\tstruct dsd64\tdif_dsd;\n\t\t} bundling;\n\t} u;\n\n\tstruct fcp_cmnd\tfcp_cmnd;\n\tdma_addr_t\tcrc_ctx_dma;\n\t \n\tstruct list_head dsd_list;\n\n\t \n\tstruct list_head ldif_dsd_list;\n\tu8 no_ldif_dsd;\n\n\tstruct list_head ldif_dma_hndl_list;\n\tu32 dif_bundl_len;\n\tu8 no_dif_bundl;\n\t \n};\n\n#define CRC_CONTEXT_LEN_FW\t(offsetof(struct crc_context, fcp_cmnd.lun))\n#define CRC_CONTEXT_FCPCMND_OFF\t(offsetof(struct crc_context, fcp_cmnd.lun))\n\n \n#define\tSTATUS_TYPE\t0x03\t\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t sys_define;\t\t \n\tuint8_t entry_status;\t\t \n\tuint32_t handle;\t\t \n\t__le16\tscsi_status;\t\t \n\t__le16\tcomp_status;\t\t \n\t__le16\tstate_flags;\t\t \n\t__le16\tstatus_flags;\t\t \n\t__le16\trsp_info_len;\t\t \n\t__le16\treq_sense_length;\t \n\t__le32\tresidual_length;\t \n\tuint8_t rsp_info[8];\t\t \n\tuint8_t req_sense_data[32];\t \n} sts_entry_t;\n\n \n#define RF_RQ_DMA_ERROR\tBIT_6\t\t \n#define RF_INV_E_ORDER\tBIT_5\t\t \n#define RF_INV_E_COUNT\tBIT_4\t\t \n#define RF_INV_E_PARAM\tBIT_3\t\t \n#define RF_INV_E_TYPE\tBIT_2\t\t \n#define RF_BUSY\t\tBIT_1\t\t \n#define RF_MASK\t\t(RF_RQ_DMA_ERROR | RF_INV_E_ORDER | RF_INV_E_COUNT | \\\n\t\t\t RF_INV_E_PARAM | RF_INV_E_TYPE | RF_BUSY)\n#define RF_MASK_24XX\t(RF_INV_E_ORDER | RF_INV_E_COUNT | RF_INV_E_PARAM | \\\n\t\t\t RF_INV_E_TYPE)\n\n \n#define SS_MASK\t\t\t\t0xfff\t \n#define SS_RESIDUAL_UNDER\t\tBIT_11\n#define SS_RESIDUAL_OVER\t\tBIT_10\n#define SS_SENSE_LEN_VALID\t\tBIT_9\n#define SS_RESPONSE_INFO_LEN_VALID\tBIT_8\n#define SS_SCSI_STATUS_BYTE\t0xff\n\n#define SS_RESERVE_CONFLICT\t\t(BIT_4 | BIT_3)\n#define SS_BUSY_CONDITION\t\tBIT_3\n#define SS_CONDITION_MET\t\tBIT_2\n#define SS_CHECK_CONDITION\t\tBIT_1\n\n \n#define CS_COMPLETE\t\t0x0\t \n#define CS_INCOMPLETE\t\t0x1\t \n#define CS_DMA\t\t\t0x2\t \n#define CS_TRANSPORT\t\t0x3\t \n#define CS_RESET\t\t0x4\t \n#define CS_ABORTED\t\t0x5\t \n#define CS_TIMEOUT\t\t0x6\t \n#define CS_DATA_OVERRUN\t\t0x7\t \n#define CS_DIF_ERROR\t\t0xC\t \n\n#define CS_DATA_UNDERRUN\t0x15\t \n#define CS_QUEUE_FULL\t\t0x1C\t \n#define CS_PORT_UNAVAILABLE\t0x28\t \n\t\t\t\t\t \n#define CS_PORT_LOGGED_OUT\t0x29\t \n#define CS_PORT_CONFIG_CHG\t0x2A\t \n#define CS_PORT_BUSY\t\t0x2B\t \n#define CS_COMPLETE_CHKCOND\t0x30\t \n#define CS_IOCB_ERROR\t\t0x31\t \n#define CS_REJECT_RECEIVED\t0x4E\t \n#define CS_EDIF_AUTH_ERROR\t0x63\t \n#define CS_EDIF_PAD_LEN_ERROR\t0x65\t \n#define CS_EDIF_INV_REQ\t\t0x66\t \n#define CS_EDIF_SPI_ERROR\t0x67\t \n#define CS_EDIF_HDR_ERROR\t0x69\t \n#define CS_BAD_PAYLOAD\t\t0x80\t \n#define CS_UNKNOWN\t\t0x81\t \n#define CS_RETRY\t\t0x82\t \n#define CS_LOOP_DOWN_ABORT\t0x83\t \n\n#define CS_BIDIR_RD_OVERRUN\t\t\t0x700\n#define CS_BIDIR_RD_WR_OVERRUN\t\t\t0x707\n#define CS_BIDIR_RD_OVERRUN_WR_UNDERRUN\t\t0x715\n#define CS_BIDIR_RD_UNDERRUN\t\t\t0x1500\n#define CS_BIDIR_RD_UNDERRUN_WR_OVERRUN\t\t0x1507\n#define CS_BIDIR_RD_WR_UNDERRUN\t\t\t0x1515\n#define CS_BIDIR_DMA\t\t\t\t0x200\n \n#define SF_ABTS_TERMINATED\tBIT_10\n#define SF_LOGOUT_SENT\t\tBIT_13\n\n \n#define\tSTATUS_CONT_TYPE\t0x10\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t sys_define;\t\t \n\tuint8_t entry_status;\t\t \n\tuint8_t data[60];\t\t \n} sts_cont_entry_t;\n\n \n#define\tSTATUS_TYPE_21 0x21\t\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t handle_count;\t\t \n\tuint8_t entry_status;\t\t \n\tuint32_t handle[15];\t\t \n} sts21_entry_t;\n\n \n#define\tSTATUS_TYPE_22\t0x22\t\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t handle_count;\t\t \n\tuint8_t entry_status;\t\t \n\tuint16_t handle[30];\t\t \n} sts22_entry_t;\n\n \n#define MARKER_TYPE\t0x04\t\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t handle_count;\t\t \n\tuint8_t entry_status;\t\t \n\tuint32_t sys_define_2;\t\t \n\ttarget_id_t target;\t\t \n\tuint8_t modifier;\t\t \n#define MK_SYNC_ID_LUN\t0\t\t \n#define MK_SYNC_ID\t1\t\t \n#define MK_SYNC_ALL\t2\t\t \n#define MK_SYNC_LIP\t3\t\t \n\t\t\t\t\t \n\t\t\t\t\t \n\tuint8_t reserved_1;\n\t__le16\tsequence_number;\t \n\t__le16\tlun;\t\t\t \n\tuint8_t reserved_2[48];\n} mrk_entry_t;\n\n \n#define MS_IOCB_TYPE\t\t0x29\t \ntypedef struct {\n\tuint8_t entry_type;\t\t \n\tuint8_t entry_count;\t\t \n\tuint8_t handle_count;\t\t \n\tuint8_t entry_status;\t\t \n\tuint32_t handle1;\t\t \n\ttarget_id_t loop_id;\n\t__le16\tstatus;\n\t__le16\tcontrol_flags;\t\t \n\tuint16_t reserved2;\n\t__le16\ttimeout;\n\t__le16\tcmd_dsd_count;\n\t__le16\ttotal_dsd_count;\n\tuint8_t type;\n\tuint8_t r_ctl;\n\t__le16\trx_id;\n\tuint16_t reserved3;\n\tuint32_t handle2;\n\t__le32\trsp_bytecount;\n\t__le32\treq_bytecount;\n\tstruct dsd64 req_dsd;\n\tstruct dsd64 rsp_dsd;\n} ms_iocb_entry_t;\n\n#define SCM_EDC_ACC_RECEIVED\t\tBIT_6\n#define SCM_RDF_ACC_RECEIVED\t\tBIT_7\n\n \n#define MBX_IOCB_TYPE\t0x39\nstruct mbx_entry {\n\tuint8_t entry_type;\n\tuint8_t entry_count;\n\tuint8_t sys_define1;\n\t \n#define SOURCE_SCSI\t0x00\n#define SOURCE_IP\t0x01\n#define SOURCE_VI\t0x02\n#define SOURCE_SCTP\t0x03\n#define SOURCE_MP\t0x04\n#define SOURCE_MPIOCTL\t0x05\n#define SOURCE_ASYNC_IOCB 0x07\n\n\tuint8_t entry_status;\n\n\tuint32_t handle;\n\ttarget_id_t loop_id;\n\n\t__le16\tstatus;\n\t__le16\tstate_flags;\n\t__le16\tstatus_flags;\n\n\tuint32_t sys_define2[2];\n\n\t__le16\tmb0;\n\t__le16\tmb1;\n\t__le16\tmb2;\n\t__le16\tmb3;\n\t__le16\tmb6;\n\t__le16\tmb7;\n\t__le16\tmb9;\n\t__le16\tmb10;\n\tuint32_t reserved_2[2];\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n};\n\n#ifndef IMMED_NOTIFY_TYPE\n#define IMMED_NOTIFY_TYPE 0x0D\t\t \n \nstruct imm_ntfy_from_isp {\n\tuint8_t\t entry_type;\t\t     \n\tuint8_t\t entry_count;\t\t     \n\tuint8_t\t sys_define;\t\t     \n\tuint8_t\t entry_status;\t\t     \n\tunion {\n\t\tstruct {\n\t\t\t__le32\tsys_define_2;  \n\t\t\ttarget_id_t target;\n\t\t\t__le16\tlun;\n\t\t\tuint8_t  target_id;\n\t\t\tuint8_t  reserved_1;\n\t\t\t__le16\tstatus_modifier;\n\t\t\t__le16\tstatus;\n\t\t\t__le16\ttask_flags;\n\t\t\t__le16\tseq_id;\n\t\t\t__le16\tsrr_rx_id;\n\t\t\t__le32\tsrr_rel_offs;\n\t\t\t__le16\tsrr_ui;\n#define SRR_IU_DATA_IN\t0x1\n#define SRR_IU_DATA_OUT\t0x5\n#define SRR_IU_STATUS\t0x7\n\t\t\t__le16\tsrr_ox_id;\n\t\t\tuint8_t reserved_2[28];\n\t\t} isp2x;\n\t\tstruct {\n\t\t\tuint32_t reserved;\n\t\t\t__le16\tnport_handle;\n\t\t\tuint16_t reserved_2;\n\t\t\t__le16\tflags;\n#define NOTIFY24XX_FLAGS_FCSP\t\tBIT_5\n#define NOTIFY24XX_FLAGS_GLOBAL_TPRLO   BIT_1\n#define NOTIFY24XX_FLAGS_PUREX_IOCB     BIT_0\n\t\t\t__le16\tsrr_rx_id;\n\t\t\t__le16\tstatus;\n\t\t\tuint8_t  status_subcode;\n\t\t\tuint8_t  fw_handle;\n\t\t\t__le32\texchange_address;\n\t\t\t__le32\tsrr_rel_offs;\n\t\t\t__le16\tsrr_ui;\n\t\t\t__le16\tsrr_ox_id;\n\t\t\tunion {\n\t\t\t\tstruct {\n\t\t\t\t\tuint8_t node_name[8];\n\t\t\t\t} plogi;  \n\t\t\t\tstruct {\n\t\t\t\t\t \n\t\t\t\t\t__le16\twd3_lo;\n\t\t\t\t\tuint8_t resv0[6];\n\t\t\t\t} prli;\n\t\t\t\tstruct {\n\t\t\t\t\tuint8_t port_id[3];\n\t\t\t\t\tuint8_t resv1;\n\t\t\t\t\t__le16\tnport_handle;\n\t\t\t\t\tuint16_t resv2;\n\t\t\t\t} req_els;\n\t\t\t} u;\n\t\t\tuint8_t port_name[8];\n\t\t\tuint8_t resv3[3];\n\t\t\tuint8_t  vp_index;\n\t\t\tuint32_t reserved_5;\n\t\t\tuint8_t  port_id[3];\n\t\t\tuint8_t  reserved_6;\n\t\t} isp24;\n\t} u;\n\tuint16_t reserved_7;\n\t__le16\tox_id;\n} __packed;\n#endif\n\n \n#define RESPONSE_ENTRY_SIZE\t(sizeof(response_t))\n#define REQUEST_ENTRY_SIZE\t(sizeof(request_t))\n\n\n\n \ntypedef struct {\n\tport_id_t d_id;\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n\tuint8_t fabric_port_name[WWN_SIZE];\n\tuint16_t fp_speed;\n\tuint8_t fc4_type;\n\tuint8_t fc4_features;\n} sw_info_t;\n\n \n#define FC4_TYPE_FCP_SCSI\t0x08\n#define FC4_TYPE_NVME\t\t0x28\n#define FC4_TYPE_OTHER\t\t0x0\n#define FC4_TYPE_UNKNOWN\t0xff\n\n \nstruct mbx_24xx_entry {\n\tuint8_t\t\tentry_type;\n\tuint8_t\t\tentry_count;\n\tuint8_t\t\tsys_define1;\n\tuint8_t\t\tentry_status;\n\tuint32_t\thandle;\n\tuint16_t\tmb[28];\n};\n\n#define IOCB_SIZE 64\n\n \ntypedef enum {\n\tFCT_UNKNOWN,\n\tFCT_BROADCAST = 0x01,\n\tFCT_INITIATOR = 0x02,\n\tFCT_TARGET    = 0x04,\n\tFCT_NVME_INITIATOR = 0x10,\n\tFCT_NVME_TARGET = 0x20,\n\tFCT_NVME_DISCOVERY = 0x40,\n\tFCT_NVME = 0xf0,\n} fc_port_type_t;\n\nenum qla_sess_deletion {\n\tQLA_SESS_DELETION_NONE\t\t= 0,\n\tQLA_SESS_DELETION_IN_PROGRESS,\n\tQLA_SESS_DELETED,\n};\n\nenum qlt_plogi_link_t {\n\tQLT_PLOGI_LINK_SAME_WWN,\n\tQLT_PLOGI_LINK_CONFLICT,\n\tQLT_PLOGI_LINK_MAX\n};\n\nstruct qlt_plogi_ack_t {\n\tstruct list_head\tlist;\n\tstruct imm_ntfy_from_isp iocb;\n\tport_id_t\tid;\n\tint\t\tref_count;\n\tvoid\t\t*fcport;\n};\n\nstruct ct_sns_desc {\n\tstruct ct_sns_pkt\t*ct_sns;\n\tdma_addr_t\t\tct_sns_dma;\n};\n\nenum discovery_state {\n\tDSC_DELETED,\n\tDSC_GNL,\n\tDSC_LOGIN_PEND,\n\tDSC_LOGIN_FAILED,\n\tDSC_GPDB,\n\tDSC_UPD_FCPORT,\n\tDSC_LOGIN_COMPLETE,\n\tDSC_ADISC,\n\tDSC_DELETE_PEND,\n\tDSC_LOGIN_AUTH_PEND,\n};\n\nenum login_state {\t \n\tDSC_LS_LLIOCB_SENT = 2,\n\tDSC_LS_PLOGI_PEND,\n\tDSC_LS_PLOGI_COMP,\n\tDSC_LS_PRLI_PEND,\n\tDSC_LS_PRLI_COMP,\n\tDSC_LS_PORT_UNAVAIL,\n\tDSC_LS_PRLO_PEND = 9,\n\tDSC_LS_LOGO_PEND,\n};\n\nenum rscn_addr_format {\n\tRSCN_PORT_ADDR,\n\tRSCN_AREA_ADDR,\n\tRSCN_DOM_ADDR,\n\tRSCN_FAB_ADDR,\n};\n\n \ntypedef struct fc_port {\n\tstruct list_head list;\n\tstruct scsi_qla_host *vha;\n\tstruct list_head unsol_ctx_head;\n\n\tunsigned int conf_compl_supported:1;\n\tunsigned int deleted:2;\n\tunsigned int free_pending:1;\n\tunsigned int local:1;\n\tunsigned int logout_on_delete:1;\n\tunsigned int logo_ack_needed:1;\n\tunsigned int keep_nport_handle:1;\n\tunsigned int send_els_logo:1;\n\tunsigned int login_pause:1;\n\tunsigned int login_succ:1;\n\tunsigned int query:1;\n\tunsigned int id_changed:1;\n\tunsigned int scan_needed:1;\n\tunsigned int n2n_flag:1;\n\tunsigned int explicit_logout:1;\n\tunsigned int prli_pend_timer:1;\n\tunsigned int do_prli_nvme:1;\n\n\tuint8_t nvme_flag;\n\tuint8_t node_name[WWN_SIZE];\n\tuint8_t port_name[WWN_SIZE];\n\tport_id_t d_id;\n\tuint16_t loop_id;\n\tuint16_t old_loop_id;\n\n\tstruct completion nvme_del_done;\n\tuint32_t nvme_prli_service_param;\n#define NVME_PRLI_SP_PI_CTRL\tBIT_9\n#define NVME_PRLI_SP_SLER\tBIT_8\n#define NVME_PRLI_SP_CONF       BIT_7\n#define NVME_PRLI_SP_INITIATOR  BIT_5\n#define NVME_PRLI_SP_TARGET     BIT_4\n#define NVME_PRLI_SP_DISCOVERY  BIT_3\n#define NVME_PRLI_SP_FIRST_BURST\tBIT_0\n\n\tuint32_t nvme_first_burst_size;\n#define NVME_FLAG_REGISTERED 4\n#define NVME_FLAG_DELETING 2\n#define NVME_FLAG_RESETTING 1\n\n\tstruct fc_port *conflict;\n\tunsigned char logout_completed;\n\tint generation;\n\n\tstruct se_session *se_sess;\n\tstruct list_head sess_cmd_list;\n\tspinlock_t sess_cmd_lock;\n\tstruct kref sess_kref;\n\tstruct qla_tgt *tgt;\n\tunsigned long expires;\n\tstruct list_head del_list_entry;\n\tstruct work_struct free_work;\n\tstruct work_struct reg_work;\n\tuint64_t jiffies_at_registration;\n\tunsigned long prli_expired;\n\tstruct qlt_plogi_ack_t *plogi_link[QLT_PLOGI_LINK_MAX];\n\n\tuint16_t tgt_id;\n\tuint16_t old_tgt_id;\n\tuint16_t sec_since_registration;\n\n\tuint8_t fcp_prio;\n\n\tuint8_t fabric_port_name[WWN_SIZE];\n\tuint16_t fp_speed;\n\n\tfc_port_type_t port_type;\n\n\tatomic_t state;\n\tuint32_t flags;\n\n\tint login_retry;\n\n\tstruct fc_rport *rport;\n\tu32 supported_classes;\n\n\tuint8_t fc4_type;\n\tuint8_t fc4_features;\n\tuint8_t scan_state;\n\n\tunsigned long last_queue_full;\n\tunsigned long last_ramp_up;\n\n\tuint16_t port_id;\n\n\tstruct nvme_fc_remote_port *nvme_remote_port;\n\n\tunsigned long retry_delay_timestamp;\n\tstruct qla_tgt_sess *tgt_session;\n\tstruct ct_sns_desc ct_desc;\n\tenum discovery_state disc_state;\n\tatomic_t shadow_disc_state;\n\tenum discovery_state next_disc_state;\n\tenum login_state fw_login_state;\n\tunsigned long dm_login_expire;\n\tunsigned long plogi_nack_done_deadline;\n\n\tu32 login_gen, last_login_gen;\n\tu32 rscn_gen, last_rscn_gen;\n\tu32 chip_reset;\n\tstruct list_head gnl_entry;\n\tstruct work_struct del_work;\n\tu8 iocb[IOCB_SIZE];\n\tu8 current_login_state;\n\tu8 last_login_state;\n\tu16 n2n_link_reset_cnt;\n\tu16 n2n_chip_reset;\n\n\tstruct dentry *dfs_rport_dir;\n\n\tu64 tgt_short_link_down_cnt;\n\tu64 tgt_link_down_time;\n\tu64 dev_loss_tmo;\n\t \n\tstruct {\n\t\tuint32_t\tenable:1;\t \n\t\tuint32_t\tapp_stop:2;\n\t\tuint32_t\taes_gmac:1;\n\t\tuint32_t\tapp_sess_online:1;\n\t\tuint32_t\ttx_sa_set:1;\n\t\tuint32_t\trx_sa_set:1;\n\t\tuint32_t\ttx_sa_pending:1;\n\t\tuint32_t\trx_sa_pending:1;\n\t\tuint32_t\ttx_rekey_cnt;\n\t\tuint32_t\trx_rekey_cnt;\n\t\tuint64_t\ttx_bytes;\n\t\tuint64_t\trx_bytes;\n\t\tuint8_t\t\tsess_down_acked;\n\t\tuint8_t\t\tauth_state;\n\t\tuint16_t\tauthok:1;\n\t\tuint16_t\trekey_cnt;\n\t\tstruct list_head edif_indx_list;\n\t\tspinlock_t  indx_list_lock;\n\n\t\tstruct list_head tx_sa_list;\n\t\tstruct list_head rx_sa_list;\n\t\tspinlock_t\tsa_list_lock;\n\t} edif;\n} fc_port_t;\n\nenum {\n\tFC4_PRIORITY_NVME = 1,\n\tFC4_PRIORITY_FCP  = 2,\n};\n\n#define QLA_FCPORT_SCAN\t\t1\n#define QLA_FCPORT_FOUND\t2\n\nstruct event_arg {\n\tfc_port_t\t\t*fcport;\n\tsrb_t\t\t\t*sp;\n\tport_id_t\t\tid;\n\tu16\t\t\tdata[2], rc;\n\tu8\t\t\tport_name[WWN_SIZE];\n\tu32\t\t\tiop[2];\n};\n\n#include \"qla_mr.h\"\n\n \nenum {\n\tFCS_UNKNOWN,\n\tFCS_UNCONFIGURED,\n\tFCS_DEVICE_DEAD,\n\tFCS_DEVICE_LOST,\n\tFCS_ONLINE,\n};\n\nextern const char *const port_state_str[5];\n\nstatic const char *const port_dstate_str[] = {\n\t[DSC_DELETED]\t\t= \"DELETED\",\n\t[DSC_GNL]\t\t= \"GNL\",\n\t[DSC_LOGIN_PEND]\t= \"LOGIN_PEND\",\n\t[DSC_LOGIN_FAILED]\t= \"LOGIN_FAILED\",\n\t[DSC_GPDB]\t\t= \"GPDB\",\n\t[DSC_UPD_FCPORT]\t= \"UPD_FCPORT\",\n\t[DSC_LOGIN_COMPLETE]\t= \"LOGIN_COMPLETE\",\n\t[DSC_ADISC]\t\t= \"ADISC\",\n\t[DSC_DELETE_PEND]\t= \"DELETE_PEND\",\n\t[DSC_LOGIN_AUTH_PEND]\t= \"LOGIN_AUTH_PEND\",\n};\n\n \n#define FCF_FABRIC_DEVICE\tBIT_0\n#define FCF_LOGIN_NEEDED\tBIT_1\n#define FCF_FCP2_DEVICE\t\tBIT_2\n#define FCF_ASYNC_SENT\t\tBIT_3\n#define FCF_CONF_COMP_SUPPORTED BIT_4\n#define FCF_ASYNC_ACTIVE\tBIT_5\n#define FCF_FCSP_DEVICE\t\tBIT_6\n#define FCF_EDIF_DELETE\t\tBIT_7\n\n \n#define FC_NO_LOOP_ID\t\t0x1000\n\n \n\n#define CT_REJECT_RESPONSE\t0x8001\n#define CT_ACCEPT_RESPONSE\t0x8002\n#define CT_REASON_INVALID_COMMAND_CODE\t\t0x01\n#define CT_REASON_CANNOT_PERFORM\t\t0x09\n#define CT_REASON_COMMAND_UNSUPPORTED\t\t0x0b\n#define CT_EXPL_ALREADY_REGISTERED\t\t0x10\n#define CT_EXPL_HBA_ATTR_NOT_REGISTERED\t\t0x11\n#define CT_EXPL_MULTIPLE_HBA_ATTR\t\t0x12\n#define CT_EXPL_INVALID_HBA_BLOCK_LENGTH\t0x13\n#define CT_EXPL_MISSING_REQ_HBA_ATTR\t\t0x14\n#define CT_EXPL_PORT_NOT_REGISTERED_\t\t0x15\n#define CT_EXPL_MISSING_HBA_ID_PORT_LIST\t0x16\n#define CT_EXPL_HBA_NOT_REGISTERED\t\t0x17\n#define CT_EXPL_PORT_ATTR_NOT_REGISTERED\t0x20\n#define CT_EXPL_PORT_NOT_REGISTERED\t\t0x21\n#define CT_EXPL_MULTIPLE_PORT_ATTR\t\t0x22\n#define CT_EXPL_INVALID_PORT_BLOCK_LENGTH\t0x23\n\n#define NS_N_PORT_TYPE\t0x01\n#define NS_NL_PORT_TYPE\t0x02\n#define NS_NX_PORT_TYPE\t0x7F\n\n#define\tGA_NXT_CMD\t0x100\n#define\tGA_NXT_REQ_SIZE\t(16 + 4)\n#define\tGA_NXT_RSP_SIZE\t(16 + 620)\n\n#define\tGPN_FT_CMD\t0x172\n#define\tGPN_FT_REQ_SIZE\t(16 + 4)\n#define\tGNN_FT_CMD\t0x173\n#define\tGNN_FT_REQ_SIZE\t(16 + 4)\n\n#define\tGID_PT_CMD\t0x1A1\n#define\tGID_PT_REQ_SIZE\t(16 + 4)\n\n#define\tGPN_ID_CMD\t0x112\n#define\tGPN_ID_REQ_SIZE\t(16 + 4)\n#define\tGPN_ID_RSP_SIZE\t(16 + 8)\n\n#define\tGNN_ID_CMD\t0x113\n#define\tGNN_ID_REQ_SIZE\t(16 + 4)\n#define\tGNN_ID_RSP_SIZE\t(16 + 8)\n\n#define\tGFT_ID_CMD\t0x117\n#define\tGFT_ID_REQ_SIZE\t(16 + 4)\n#define\tGFT_ID_RSP_SIZE\t(16 + 32)\n\n#define GID_PN_CMD 0x121\n#define GID_PN_REQ_SIZE (16 + 8)\n#define GID_PN_RSP_SIZE (16 + 4)\n\n#define\tRFT_ID_CMD\t0x217\n#define\tRFT_ID_REQ_SIZE\t(16 + 4 + 32)\n#define\tRFT_ID_RSP_SIZE\t16\n\n#define\tRFF_ID_CMD\t0x21F\n#define\tRFF_ID_REQ_SIZE\t(16 + 4 + 2 + 1 + 1)\n#define\tRFF_ID_RSP_SIZE\t16\n\n#define\tRNN_ID_CMD\t0x213\n#define\tRNN_ID_REQ_SIZE\t(16 + 4 + 8)\n#define\tRNN_ID_RSP_SIZE\t16\n\n#define\tRSNN_NN_CMD\t 0x239\n#define\tRSNN_NN_REQ_SIZE (16 + 8 + 1 + 255)\n#define\tRSNN_NN_RSP_SIZE 16\n\n#define\tGFPN_ID_CMD\t0x11C\n#define\tGFPN_ID_REQ_SIZE (16 + 4)\n#define\tGFPN_ID_RSP_SIZE (16 + 8)\n\n#define\tGPSC_CMD\t0x127\n#define\tGPSC_REQ_SIZE\t(16 + 8)\n#define\tGPSC_RSP_SIZE\t(16 + 2 + 2)\n\n#define GFF_ID_CMD\t0x011F\n#define GFF_ID_REQ_SIZE\t(16 + 4)\n#define GFF_ID_RSP_SIZE (16 + 128)\n\n \n#define FDMI1_HBA_ATTR_COUNT\t\t\t10\n#define FDMI2_HBA_ATTR_COUNT\t\t\t17\n\n#define FDMI_HBA_NODE_NAME\t\t\t0x1\n#define FDMI_HBA_MANUFACTURER\t\t\t0x2\n#define FDMI_HBA_SERIAL_NUMBER\t\t\t0x3\n#define FDMI_HBA_MODEL\t\t\t\t0x4\n#define FDMI_HBA_MODEL_DESCRIPTION\t\t0x5\n#define FDMI_HBA_HARDWARE_VERSION\t\t0x6\n#define FDMI_HBA_DRIVER_VERSION\t\t\t0x7\n#define FDMI_HBA_OPTION_ROM_VERSION\t\t0x8\n#define FDMI_HBA_FIRMWARE_VERSION\t\t0x9\n#define FDMI_HBA_OS_NAME_AND_VERSION\t\t0xa\n#define FDMI_HBA_MAXIMUM_CT_PAYLOAD_LENGTH\t0xb\n\n#define FDMI_HBA_NODE_SYMBOLIC_NAME\t\t0xc\n#define FDMI_HBA_VENDOR_SPECIFIC_INFO\t\t0xd\n#define FDMI_HBA_NUM_PORTS\t\t\t0xe\n#define FDMI_HBA_FABRIC_NAME\t\t\t0xf\n#define FDMI_HBA_BOOT_BIOS_NAME\t\t\t0x10\n#define FDMI_HBA_VENDOR_IDENTIFIER\t\t0xe0\n\nstruct ct_fdmi_hba_attr {\n\t__be16\ttype;\n\t__be16\tlen;\n\tunion {\n\t\tuint8_t node_name[WWN_SIZE];\n\t\tuint8_t manufacturer[64];\n\t\tuint8_t serial_num[32];\n\t\tuint8_t model[16+1];\n\t\tuint8_t model_desc[80];\n\t\tuint8_t hw_version[32];\n\t\tuint8_t driver_version[32];\n\t\tuint8_t orom_version[16];\n\t\tuint8_t fw_version[32];\n\t\tuint8_t os_version[128];\n\t\t__be32\t max_ct_len;\n\n\t\tuint8_t sym_name[256];\n\t\t__be32\t vendor_specific_info;\n\t\t__be32\t num_ports;\n\t\tuint8_t fabric_name[WWN_SIZE];\n\t\tuint8_t bios_name[32];\n\t\tuint8_t vendor_identifier[8];\n\t} a;\n};\n\nstruct ct_fdmi1_hba_attributes {\n\t__be32\tcount;\n\tstruct ct_fdmi_hba_attr entry[FDMI1_HBA_ATTR_COUNT];\n};\n\nstruct ct_fdmi2_hba_attributes {\n\t__be32\tcount;\n\tstruct ct_fdmi_hba_attr entry[FDMI2_HBA_ATTR_COUNT];\n};\n\n \n#define FDMI1_PORT_ATTR_COUNT\t\t6\n#define FDMI2_PORT_ATTR_COUNT\t\t16\n#define FDMI2_SMARTSAN_PORT_ATTR_COUNT\t23\n\n#define FDMI_PORT_FC4_TYPES\t\t0x1\n#define FDMI_PORT_SUPPORT_SPEED\t\t0x2\n#define FDMI_PORT_CURRENT_SPEED\t\t0x3\n#define FDMI_PORT_MAX_FRAME_SIZE\t0x4\n#define FDMI_PORT_OS_DEVICE_NAME\t0x5\n#define FDMI_PORT_HOST_NAME\t\t0x6\n\n#define FDMI_PORT_NODE_NAME\t\t0x7\n#define FDMI_PORT_NAME\t\t\t0x8\n#define FDMI_PORT_SYM_NAME\t\t0x9\n#define FDMI_PORT_TYPE\t\t\t0xa\n#define FDMI_PORT_SUPP_COS\t\t0xb\n#define FDMI_PORT_FABRIC_NAME\t\t0xc\n#define FDMI_PORT_FC4_TYPE\t\t0xd\n#define FDMI_PORT_STATE\t\t\t0x101\n#define FDMI_PORT_COUNT\t\t\t0x102\n#define FDMI_PORT_IDENTIFIER\t\t0x103\n\n#define FDMI_SMARTSAN_SERVICE\t\t0xF100\n#define FDMI_SMARTSAN_GUID\t\t0xF101\n#define FDMI_SMARTSAN_VERSION\t\t0xF102\n#define FDMI_SMARTSAN_PROD_NAME\t\t0xF103\n#define FDMI_SMARTSAN_PORT_INFO\t\t0xF104\n#define FDMI_SMARTSAN_QOS_SUPPORT\t0xF105\n#define FDMI_SMARTSAN_SECURITY_SUPPORT\t0xF106\n\n#define FDMI_PORT_SPEED_1GB\t\t0x1\n#define FDMI_PORT_SPEED_2GB\t\t0x2\n#define FDMI_PORT_SPEED_10GB\t\t0x4\n#define FDMI_PORT_SPEED_4GB\t\t0x8\n#define FDMI_PORT_SPEED_8GB\t\t0x10\n#define FDMI_PORT_SPEED_16GB\t\t0x20\n#define FDMI_PORT_SPEED_32GB\t\t0x40\n#define FDMI_PORT_SPEED_20GB\t\t0x80\n#define FDMI_PORT_SPEED_40GB\t\t0x100\n#define FDMI_PORT_SPEED_128GB\t\t0x200\n#define FDMI_PORT_SPEED_64GB\t\t0x400\n#define FDMI_PORT_SPEED_256GB\t\t0x800\n#define FDMI_PORT_SPEED_UNKNOWN\t\t0x8000\n\n#define FC_CLASS_2\t0x04\n#define FC_CLASS_3\t0x08\n#define FC_CLASS_2_3\t0x0C\n\nstruct ct_fdmi_port_attr {\n\t__be16\ttype;\n\t__be16\tlen;\n\tunion {\n\t\tuint8_t fc4_types[32];\n\t\t__be32\tsup_speed;\n\t\t__be32\tcur_speed;\n\t\t__be32\tmax_frame_size;\n\t\tuint8_t os_dev_name[32];\n\t\tuint8_t host_name[256];\n\n\t\tuint8_t node_name[WWN_SIZE];\n\t\tuint8_t port_name[WWN_SIZE];\n\t\tuint8_t port_sym_name[128];\n\t\t__be32\tport_type;\n\t\t__be32\tport_supported_cos;\n\t\tuint8_t fabric_name[WWN_SIZE];\n\t\tuint8_t port_fc4_type[32];\n\t\t__be32\t port_state;\n\t\t__be32\t num_ports;\n\t\t__be32\t port_id;\n\n\t\tuint8_t smartsan_service[24];\n\t\tuint8_t smartsan_guid[16];\n\t\tuint8_t smartsan_version[24];\n\t\tuint8_t smartsan_prod_name[16];\n\t\t__be32\t smartsan_port_info;\n\t\t__be32\t smartsan_qos_support;\n\t\t__be32\t smartsan_security_support;\n\t} a;\n};\n\nstruct ct_fdmi1_port_attributes {\n\t__be32\t count;\n\tstruct ct_fdmi_port_attr entry[FDMI1_PORT_ATTR_COUNT];\n};\n\nstruct ct_fdmi2_port_attributes {\n\t__be32\tcount;\n\tstruct ct_fdmi_port_attr entry[FDMI2_PORT_ATTR_COUNT];\n};\n\n#define FDMI_ATTR_TYPELEN(obj) \\\n\t(sizeof((obj)->type) + sizeof((obj)->len))\n\n#define FDMI_ATTR_ALIGNMENT(len) \\\n\t(4 - ((len) & 3))\n\n \n#define CALLOPT_FDMI1\t\t0\n#define CALLOPT_FDMI2\t\t1\n#define CALLOPT_FDMI2_SMARTSAN\t2\n\n \n#define GRHL_CMD\t0x100\n#define GHAT_CMD\t0x101\n#define GRPL_CMD\t0x102\n#define GPAT_CMD\t0x110\n\n#define RHBA_CMD\t0x200\n#define RHBA_RSP_SIZE\t16\n\n#define RHAT_CMD\t0x201\n\n#define RPRT_CMD\t0x210\n#define RPRT_RSP_SIZE\t24\n\n#define RPA_CMD\t\t0x211\n#define RPA_RSP_SIZE\t16\n#define SMARTSAN_RPA_RSP_SIZE\t24\n\n#define DHBA_CMD\t0x300\n#define DHBA_REQ_SIZE\t(16 + 8)\n#define DHBA_RSP_SIZE\t16\n\n#define DHAT_CMD\t0x301\n#define DPRT_CMD\t0x310\n#define DPA_CMD\t\t0x311\n\n \nstruct ct_cmd_hdr {\n\tuint8_t revision;\n\tuint8_t in_id[3];\n\tuint8_t gs_type;\n\tuint8_t gs_subtype;\n\tuint8_t options;\n\tuint8_t reserved;\n};\n\n \nstruct ct_sns_req {\n\tstruct ct_cmd_hdr header;\n\t__be16\tcommand;\n\t__be16\tmax_rsp_size;\n\tuint8_t fragment_id;\n\tuint8_t reserved[3];\n\n\tunion {\n\t\t \n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t} port_id;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t domain;\n\t\t\tuint8_t area;\n\t\t\tuint8_t port_type;\n\t\t} gpn_ft;\n\n\t\tstruct {\n\t\t\tuint8_t port_type;\n\t\t\tuint8_t domain;\n\t\t\tuint8_t area;\n\t\t\tuint8_t reserved;\n\t\t} gid_pt;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t\tuint8_t fc4_types[32];\n\t\t} rft_id;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t\tuint16_t reserved2;\n\t\t\tuint8_t fc4_feature;\n\t\t\tuint8_t fc4_type;\n\t\t} rff_id;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tbe_id_t port_id;\n\t\t\tuint8_t node_name[8];\n\t\t} rnn_id;\n\n\t\tstruct {\n\t\t\tuint8_t node_name[8];\n\t\t\tuint8_t name_len;\n\t\t\tuint8_t sym_node_name[255];\n\t\t} rsnn_nn;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t} ghat;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t\t__be32\tentry_count;\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi2_hba_attributes attrs;\n\t\t} rhba;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t\tstruct ct_fdmi1_hba_attributes attrs;\n\t\t} rhat;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi2_port_attributes attrs;\n\t\t} rpa;\n\n\t\tstruct {\n\t\t\tuint8_t hba_identifier[8];\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi2_port_attributes attrs;\n\t\t} rprt;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dhba;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dhat;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dprt;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} dpa;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gpsc;\n\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t port_id[3];\n\t\t} gff_id;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gid_pn;\n\t} req;\n};\n\n \nstruct ct_rsp_hdr {\n\tstruct ct_cmd_hdr header;\n\t__be16\tresponse;\n\tuint16_t residual;\n\tuint8_t fragment_id;\n\tuint8_t reason_code;\n\tuint8_t explanation_code;\n\tuint8_t vendor_unique;\n};\n\nstruct ct_sns_gid_pt_data {\n\tuint8_t control_byte;\n\tbe_id_t port_id;\n};\n\n \nstruct ct_sns_gpnft_rsp {\n\tstruct {\n\t\tstruct ct_cmd_hdr header;\n\t\tuint16_t response;\n\t\tuint16_t residual;\n\t\tuint8_t fragment_id;\n\t\tuint8_t reason_code;\n\t\tuint8_t explanation_code;\n\t\tuint8_t vendor_unique;\n\t};\n\t \n\tDECLARE_FLEX_ARRAY(struct ct_sns_gpn_ft_data {\n\t\tu8 control_byte;\n\t\tu8 port_id[3];\n\t\tu32 reserved;\n\t\tu8 port_name[8];\n\t}, entries);\n};\n\n \nstruct ct_sns_rsp {\n\tstruct ct_rsp_hdr header;\n\n\tunion {\n\t\tstruct {\n\t\t\tuint8_t port_type;\n\t\t\tbe_id_t port_id;\n\t\t\tuint8_t port_name[8];\n\t\t\tuint8_t sym_port_name_len;\n\t\t\tuint8_t sym_port_name[255];\n\t\t\tuint8_t node_name[8];\n\t\t\tuint8_t sym_node_name_len;\n\t\t\tuint8_t sym_node_name[255];\n\t\t\tuint8_t init_proc_assoc[8];\n\t\t\tuint8_t node_ip_addr[16];\n\t\t\tuint8_t class_of_service[4];\n\t\t\tuint8_t fc4_types[32];\n\t\t\tuint8_t ip_address[16];\n\t\t\tuint8_t fabric_port_name[8];\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t hard_address[3];\n\t\t} ga_nxt;\n\n\t\tstruct {\n\t\t\t \n\t\t\tstruct ct_sns_gid_pt_data\n\t\t\t    entries[MAX_FIBRE_DEVICES_MAX];\n\t\t} gid_pt;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gpn_id;\n\n\t\tstruct {\n\t\t\tuint8_t node_name[8];\n\t\t} gnn_id;\n\n\t\tstruct {\n\t\t\tuint8_t fc4_types[32];\n\t\t} gft_id;\n\n\t\tstruct {\n\t\t\tuint32_t entry_count;\n\t\t\tuint8_t port_name[8];\n\t\t\tstruct ct_fdmi1_hba_attributes attrs;\n\t\t} ghat;\n\n\t\tstruct {\n\t\t\tuint8_t port_name[8];\n\t\t} gfpn_id;\n\n\t\tstruct {\n\t\t\t__be16\tspeeds;\n\t\t\t__be16\tspeed;\n\t\t} gpsc;\n\n#define GFF_FCP_SCSI_OFFSET\t7\n#define GFF_NVME_OFFSET\t\t23  \n\t\tstruct {\n\t\t\tuint8_t fc4_features[128];\n#define FC4_FF_TARGET    BIT_0\n#define FC4_FF_INITIATOR BIT_1\n\t\t} gff_id;\n\t\tstruct {\n\t\t\tuint8_t reserved;\n\t\t\tuint8_t port_id[3];\n\t\t} gid_pn;\n\t} rsp;\n};\n\nstruct ct_sns_pkt {\n\tunion {\n\t\tstruct ct_sns_req req;\n\t\tstruct ct_sns_rsp rsp;\n\t} p;\n};\n\nstruct ct_sns_gpnft_pkt {\n\tunion {\n\t\tstruct ct_sns_req req;\n\t\tstruct ct_sns_gpnft_rsp rsp;\n\t} p;\n};\n\nenum scan_flags_t {\n\tSF_SCANNING = BIT_0,\n\tSF_QUEUED = BIT_1,\n};\n\nenum fc4type_t {\n\tFS_FC4TYPE_FCP\t= BIT_0,\n\tFS_FC4TYPE_NVME\t= BIT_1,\n\tFS_FCP_IS_N2N = BIT_7,\n};\n\nstruct fab_scan_rp {\n\tport_id_t id;\n\tenum fc4type_t fc4type;\n\tu8 port_name[8];\n\tu8 node_name[8];\n};\n\nstruct fab_scan {\n\tstruct fab_scan_rp *l;\n\tu32 size;\n\tu16 scan_retry;\n#define MAX_SCAN_RETRIES 5\n\tenum scan_flags_t scan_flags;\n\tstruct delayed_work scan_work;\n};\n\n \n#define\tRFT_ID_SNS_SCMD_LEN\t22\n#define\tRFT_ID_SNS_CMD_SIZE\t60\n#define\tRFT_ID_SNS_DATA_SIZE\t16\n\n#define\tRNN_ID_SNS_SCMD_LEN\t10\n#define\tRNN_ID_SNS_CMD_SIZE\t36\n#define\tRNN_ID_SNS_DATA_SIZE\t16\n\n#define\tGA_NXT_SNS_SCMD_LEN\t6\n#define\tGA_NXT_SNS_CMD_SIZE\t28\n#define\tGA_NXT_SNS_DATA_SIZE\t(620 + 16)\n\n#define\tGID_PT_SNS_SCMD_LEN\t6\n#define\tGID_PT_SNS_CMD_SIZE\t28\n \n#define\tGID_PT_SNS_DATA_SIZE\t(MAX_FIBRE_DEVICES_2100 * 4 + 16)\n\n#define\tGPN_ID_SNS_SCMD_LEN\t6\n#define\tGPN_ID_SNS_CMD_SIZE\t28\n#define\tGPN_ID_SNS_DATA_SIZE\t(8 + 16)\n\n#define\tGNN_ID_SNS_SCMD_LEN\t6\n#define\tGNN_ID_SNS_CMD_SIZE\t28\n#define\tGNN_ID_SNS_DATA_SIZE\t(8 + 16)\n\nstruct sns_cmd_pkt {\n\tunion {\n\t\tstruct {\n\t\t\t__le16\tbuffer_length;\n\t\t\t__le16\treserved_1;\n\t\t\t__le64\tbuffer_address __packed;\n\t\t\t__le16\tsubcommand_length;\n\t\t\t__le16\treserved_2;\n\t\t\t__le16\tsubcommand;\n\t\t\t__le16\tsize;\n\t\t\tuint32_t reserved_3;\n\t\t\tuint8_t param[36];\n\t\t} cmd;\n\n\t\tuint8_t rft_data[RFT_ID_SNS_DATA_SIZE];\n\t\tuint8_t rnn_data[RNN_ID_SNS_DATA_SIZE];\n\t\tuint8_t gan_data[GA_NXT_SNS_DATA_SIZE];\n\t\tuint8_t gid_data[GID_PT_SNS_DATA_SIZE];\n\t\tuint8_t gpn_data[GPN_ID_SNS_DATA_SIZE];\n\t\tuint8_t gnn_data[GNN_ID_SNS_DATA_SIZE];\n\t} p;\n};\n\nstruct fw_blob {\n\tchar *name;\n\tuint32_t segs[4];\n\tconst struct firmware *fw;\n};\n\n \nstruct gid_list_info {\n\tuint8_t\tal_pa;\n\tuint8_t\tarea;\n\tuint8_t\tdomain;\n\tuint8_t\tloop_id_2100;\t \n\t__le16\tloop_id;\t \n\tuint16_t reserved_1;\t \n};\n\n \ntypedef struct vport_info {\n\tuint8_t\t\tport_name[WWN_SIZE];\n\tuint8_t\t\tnode_name[WWN_SIZE];\n\tint\t\tvp_id;\n\tuint16_t\tloop_id;\n\tunsigned long\thost_no;\n\tuint8_t\t\tport_id[3];\n\tint\t\tloop_state;\n} vport_info_t;\n\ntypedef struct vport_params {\n\tuint8_t \tport_name[WWN_SIZE];\n\tuint8_t \tnode_name[WWN_SIZE];\n\tuint32_t \toptions;\n#define\tVP_OPTS_RETRY_ENABLE\tBIT_0\n#define\tVP_OPTS_VP_DISABLE\tBIT_1\n} vport_params_t;\n\n \n#define VP_RET_CODE_OK\t\t\t0\n#define VP_RET_CODE_FATAL\t\t1\n#define VP_RET_CODE_WRONG_ID\t\t2\n#define VP_RET_CODE_WWPN\t\t3\n#define VP_RET_CODE_RESOURCES\t\t4\n#define VP_RET_CODE_NO_MEM\t\t5\n#define VP_RET_CODE_NOT_FOUND\t\t6\n\nstruct qla_hw_data;\nstruct rsp_que;\n \nstruct isp_operations {\n\n\tint (*pci_config) (struct scsi_qla_host *);\n\tint (*reset_chip)(struct scsi_qla_host *);\n\tint (*chip_diag) (struct scsi_qla_host *);\n\tvoid (*config_rings) (struct scsi_qla_host *);\n\tint (*reset_adapter)(struct scsi_qla_host *);\n\tint (*nvram_config) (struct scsi_qla_host *);\n\tvoid (*update_fw_options) (struct scsi_qla_host *);\n\tint (*load_risc) (struct scsi_qla_host *, uint32_t *);\n\n\tchar * (*pci_info_str)(struct scsi_qla_host *, char *, size_t);\n\tchar * (*fw_version_str)(struct scsi_qla_host *, char *, size_t);\n\n\tirq_handler_t intr_handler;\n\tvoid (*enable_intrs) (struct qla_hw_data *);\n\tvoid (*disable_intrs) (struct qla_hw_data *);\n\n\tint (*abort_command) (srb_t *);\n\tint (*target_reset) (struct fc_port *, uint64_t, int);\n\tint (*lun_reset) (struct fc_port *, uint64_t, int);\n\tint (*fabric_login) (struct scsi_qla_host *, uint16_t, uint8_t,\n\t\tuint8_t, uint8_t, uint16_t *, uint8_t);\n\tint (*fabric_logout) (struct scsi_qla_host *, uint16_t, uint8_t,\n\t    uint8_t, uint8_t);\n\n\tuint16_t (*calc_req_entries) (uint16_t);\n\tvoid (*build_iocbs) (srb_t *, cmd_entry_t *, uint16_t);\n\tvoid *(*prep_ms_iocb) (struct scsi_qla_host *, struct ct_arg *);\n\tvoid *(*prep_ms_fdmi_iocb) (struct scsi_qla_host *, uint32_t,\n\t    uint32_t);\n\n\tuint8_t *(*read_nvram)(struct scsi_qla_host *, void *,\n\t\tuint32_t, uint32_t);\n\tint (*write_nvram)(struct scsi_qla_host *, void *, uint32_t,\n\t\tuint32_t);\n\n\tvoid (*fw_dump)(struct scsi_qla_host *vha);\n\tvoid (*mpi_fw_dump)(struct scsi_qla_host *, int);\n\n\t \n\tint (*beacon_on) (struct scsi_qla_host *);\n\tint (*beacon_off) (struct scsi_qla_host *);\n\n\tvoid (*beacon_blink) (struct scsi_qla_host *);\n\n\tvoid *(*read_optrom)(struct scsi_qla_host *, void *,\n\t\tuint32_t, uint32_t);\n\tint (*write_optrom)(struct scsi_qla_host *, void *, uint32_t,\n\t\tuint32_t);\n\n\tint (*get_flash_version) (struct scsi_qla_host *, void *);\n\tint (*start_scsi) (srb_t *);\n\tint (*start_scsi_mq) (srb_t *);\n\n\t \n\tint (*abort_isp) (struct scsi_qla_host *);\n\n\tint (*iospace_config)(struct qla_hw_data *);\n\tint (*initialize_adapter)(struct scsi_qla_host *);\n};\n\n \n\n#define QLA_MSIX_CHIP_REV_24XX\t3\n#define QLA_MSIX_FW_MODE(m)\t(((m) & (BIT_7|BIT_8|BIT_9)) >> 7)\n#define QLA_MSIX_FW_MODE_1(m)\t(QLA_MSIX_FW_MODE(m) == 1)\n\n#define QLA_BASE_VECTORS\t2  \n#define QLA_MSIX_RSP_Q\t\t\t0x01\n#define QLA_ATIO_VECTOR\t\t0x02\n#define QLA_MSIX_QPAIR_MULTIQ_RSP_Q\t0x03\n#define QLA_MSIX_QPAIR_MULTIQ_RSP_Q_HS\t0x04\n\n#define QLA_MIDX_DEFAULT\t0\n#define QLA_MIDX_RSP_Q\t\t1\n#define QLA_PCI_MSIX_CONTROL\t0xa2\n#define QLA_83XX_PCI_MSIX_CONTROL\t0x92\n\nstruct scsi_qla_host;\n\n\n#define QLA83XX_RSPQ_MSIX_ENTRY_NUMBER 1  \n\nstruct qla_msix_entry {\n\tint have_irq;\n\tint in_use;\n\tuint32_t vector;\n\tuint32_t vector_base0;\n\tuint16_t entry;\n\tchar name[30];\n\tvoid *handle;\n\tint cpuid;\n};\n\n#define\tWATCH_INTERVAL\t\t1        \n\n \nenum qla_work_type {\n\tQLA_EVT_AEN,\n\tQLA_EVT_IDC_ACK,\n\tQLA_EVT_ASYNC_LOGIN,\n\tQLA_EVT_ASYNC_LOGOUT,\n\tQLA_EVT_ASYNC_ADISC,\n\tQLA_EVT_UEVENT,\n\tQLA_EVT_AENFX,\n\tQLA_EVT_UNMAP,\n\tQLA_EVT_NEW_SESS,\n\tQLA_EVT_GPDB,\n\tQLA_EVT_PRLI,\n\tQLA_EVT_GPSC,\n\tQLA_EVT_GNL,\n\tQLA_EVT_NACK,\n\tQLA_EVT_RELOGIN,\n\tQLA_EVT_ASYNC_PRLO,\n\tQLA_EVT_ASYNC_PRLO_DONE,\n\tQLA_EVT_GPNFT,\n\tQLA_EVT_GPNFT_DONE,\n\tQLA_EVT_GNNFT_DONE,\n\tQLA_EVT_GFPNID,\n\tQLA_EVT_SP_RETRY,\n\tQLA_EVT_IIDMA,\n\tQLA_EVT_ELS_PLOGI,\n\tQLA_EVT_SA_REPLACE,\n};\n\n\nstruct qla_work_evt {\n\tstruct list_head\tlist;\n\tenum qla_work_type\ttype;\n\tu32\t\t\tflags;\n#define QLA_EVT_FLAG_FREE\t0x1\n\n\tunion {\n\t\tstruct {\n\t\t\tenum fc_host_event_code code;\n\t\t\tu32 data;\n\t\t} aen;\n\t\tstruct {\n#define QLA_IDC_ACK_REGS\t7\n\t\t\tuint16_t mb[QLA_IDC_ACK_REGS];\n\t\t} idc_ack;\n\t\tstruct {\n\t\t\tstruct fc_port *fcport;\n#define QLA_LOGIO_LOGIN_RETRIED\tBIT_0\n\t\t\tu16 data[2];\n\t\t} logio;\n\t\tstruct {\n\t\t\tu32 code;\n#define QLA_UEVENT_CODE_FW_DUMP\t0\n\t\t} uevent;\n\t\tstruct {\n\t\t\tuint32_t        evtcode;\n\t\t\tuint32_t        mbx[8];\n\t\t\tuint32_t        count;\n\t\t} aenfx;\n\t\tstruct {\n\t\t\tsrb_t *sp;\n\t\t} iosb;\n\t\tstruct {\n\t\t\tport_id_t id;\n\t\t\tu8 port_name[8];\n\t\t\tu8 node_name[8];\n\t\t\tvoid *pla;\n\t\t\tu8 fc4_type;\n\t\t} new_sess;\n\t\tstruct {  \n\t\t\tfc_port_t *fcport;\n\t\t\tu8 opt;\n\t\t} fcport;\n\t\tstruct {\n\t\t\tfc_port_t *fcport;\n\t\t\tu8 iocb[IOCB_SIZE];\n\t\t\tint type;\n\t\t} nack;\n\t\tstruct {\n\t\t\tu8 fc4_type;\n\t\t\tsrb_t *sp;\n\t\t} gpnft;\n\t\tstruct {\n\t\t\tstruct edif_sa_ctl\t*sa_ctl;\n\t\t\tfc_port_t *fcport;\n\t\t\tuint16_t nport_handle;\n\t\t} sa_update;\n\t } u;\n};\n\nstruct qla_chip_state_84xx {\n\tstruct list_head list;\n\tstruct kref kref;\n\n\tvoid *bus;\n\tspinlock_t access_lock;\n\tstruct mutex fw_update_mutex;\n\tuint32_t fw_update;\n\tuint32_t op_fw_version;\n\tuint32_t op_fw_size;\n\tuint32_t op_fw_seq_size;\n\tuint32_t diag_fw_version;\n\tuint32_t gold_fw_version;\n};\n\nstruct qla_dif_statistics {\n\tuint64_t dif_input_bytes;\n\tuint64_t dif_output_bytes;\n\tuint64_t dif_input_requests;\n\tuint64_t dif_output_requests;\n\tuint32_t dif_guard_err;\n\tuint32_t dif_ref_tag_err;\n\tuint32_t dif_app_tag_err;\n};\n\nstruct qla_statistics {\n\tuint32_t total_isp_aborts;\n\tuint64_t input_bytes;\n\tuint64_t output_bytes;\n\tuint64_t input_requests;\n\tuint64_t output_requests;\n\tuint32_t control_requests;\n\n\tuint64_t jiffies_at_last_reset;\n\tuint32_t stat_max_pend_cmds;\n\tuint32_t stat_max_qfull_cmds_alloc;\n\tuint32_t stat_max_qfull_cmds_dropped;\n\n\tstruct qla_dif_statistics qla_dif_stats;\n};\n\nstruct bidi_statistics {\n\tunsigned long long io_count;\n\tunsigned long long transfer_bytes;\n};\n\nstruct qla_tc_param {\n\tstruct scsi_qla_host *vha;\n\tuint32_t blk_sz;\n\tuint32_t bufflen;\n\tstruct scatterlist *sg;\n\tstruct scatterlist *prot_sg;\n\tstruct crc_context *ctx;\n\tuint8_t *ctx_dsd_alloced;\n};\n\n \n#define MBC_INITIALIZE_MULTIQ 0x1f\n#define QLA_QUE_PAGE 0X1000\n#define QLA_MQ_SIZE 32\n#define QLA_MAX_QUEUES 256\n#define ISP_QUE_REG(ha, id) \\\n\t((ha->mqenable || IS_QLA83XX(ha) || \\\n\t  IS_QLA27XX(ha) || IS_QLA28XX(ha)) ? \\\n\t ((void __iomem *)ha->mqiobase + (QLA_QUE_PAGE * id)) :\\\n\t ((void __iomem *)ha->iobase))\n#define QLA_REQ_QUE_ID(tag) \\\n\t((tag < QLA_MAX_QUEUES && tag > 0) ? tag : 0)\n#define QLA_DEFAULT_QUE_QOS 5\n#define QLA_PRECONFIG_VPORTS 32\n#define QLA_MAX_VPORTS_QLA24XX\t128\n#define QLA_MAX_VPORTS_QLA25XX\t256\n\nstruct qla_tgt_counters {\n\tuint64_t qla_core_sbt_cmd;\n\tuint64_t core_qla_que_buf;\n\tuint64_t qla_core_ret_ctio;\n\tuint64_t core_qla_snd_status;\n\tuint64_t qla_core_ret_sta_ctio;\n\tuint64_t core_qla_free_cmd;\n\tuint64_t num_q_full_sent;\n\tuint64_t num_alloc_iocb_failed;\n\tuint64_t num_term_xchg_sent;\n};\n\nstruct qla_counters {\n\tuint64_t input_bytes;\n\tuint64_t input_requests;\n\tuint64_t output_bytes;\n\tuint64_t output_requests;\n\n};\n\nstruct qla_qpair;\n\n \nstruct rsp_que {\n\tdma_addr_t  dma;\n\tresponse_t *ring;\n\tresponse_t *ring_ptr;\n\t__le32\t__iomem *rsp_q_in;\t \n\t__le32\t__iomem *rsp_q_out;\n\tuint16_t  ring_index;\n\tuint16_t  out_ptr;\n\tuint16_t  *in_ptr;\t\t \n\tuint16_t  length;\n\tuint16_t  options;\n\tuint16_t  rid;\n\tuint16_t  id;\n\tuint16_t  vp_idx;\n\tstruct qla_hw_data *hw;\n\tstruct qla_msix_entry *msix;\n\tstruct req_que *req;\n\tsrb_t *status_srb;  \n\tstruct qla_qpair *qpair;\n\n\tdma_addr_t  dma_fx00;\n\tresponse_t *ring_fx00;\n\tuint16_t  length_fx00;\n\tuint8_t rsp_pkt[REQUEST_ENTRY_SIZE];\n};\n\n \nstruct req_que {\n\tdma_addr_t  dma;\n\trequest_t *ring;\n\trequest_t *ring_ptr;\n\t__le32\t__iomem *req_q_in;\t \n\t__le32\t__iomem *req_q_out;\n\tuint16_t  ring_index;\n\tuint16_t  in_ptr;\n\tuint16_t  *out_ptr;\t\t \n\tuint16_t  cnt;\n\tuint16_t  length;\n\tuint16_t  options;\n\tuint16_t  rid;\n\tuint16_t  id;\n\tuint16_t  qos;\n\tuint16_t  vp_idx;\n\tstruct rsp_que *rsp;\n\tsrb_t **outstanding_cmds;\n\tuint32_t current_outstanding_cmd;\n\tuint16_t num_outstanding_cmds;\n\tint max_q_depth;\n\n\tdma_addr_t  dma_fx00;\n\trequest_t *ring_fx00;\n\tuint16_t  length_fx00;\n\tuint8_t req_pkt[REQUEST_ENTRY_SIZE];\n};\n\nstruct qla_fw_resources {\n\tu16 iocbs_total;\n\tu16 iocbs_limit;\n\tu16 iocbs_qp_limit;\n\tu16 iocbs_used;\n\tu16 exch_total;\n\tu16 exch_limit;\n\tu16 exch_used;\n\tu16 pad;\n};\n\nstruct qla_fw_res {\n\tu16      iocb_total;\n\tu16      iocb_limit;\n\tatomic_t iocb_used;\n\n\tu16      exch_total;\n\tu16      exch_limit;\n\tatomic_t exch_used;\n};\n\n#define QLA_IOCB_PCT_LIMIT 95\n\nstruct  qla_buf_pool {\n\tu16 num_bufs;\n\tu16 num_active;\n\tu16 max_used;\n\tu16 num_alloc;\n\tu16 prev_max;\n\tu16 pad;\n\tuint32_t take_snapshot:1;\n\tunsigned long *buf_map;\n\tvoid **buf_array;\n\tdma_addr_t *dma_array;\n};\n\n \nstruct qla_qpair {\n\tspinlock_t qp_lock;\n\tatomic_t ref_count;\n\tuint32_t lun_cnt;\n\t \n\tspinlock_t *qp_lock_ptr;\n\tstruct scsi_qla_host *vha;\n\tu32 chip_reset;\n\n\t \n\tuint32_t online:1;\n\t \n\tuint32_t difdix_supported:1;\n\tuint32_t delete_in_progress:1;\n\tuint32_t fw_started:1;\n\tuint32_t enable_class_2:1;\n\tuint32_t enable_explicit_conf:1;\n\tuint32_t use_shadow_reg:1;\n\tuint32_t rcv_intr:1;\n\n\tuint16_t id;\t\t\t \n\tuint16_t vp_idx;\t\t \n\n\tuint16_t dsd_inuse;\n\tuint16_t dsd_avail;\n\tstruct list_head dsd_list;\n#define NUM_DSD_CHAIN 4096\n\n\tmempool_t *srb_mempool;\n\n\tstruct pci_dev  *pdev;\n\tvoid (*reqq_start_iocbs)(struct qla_qpair *);\n\n\t \n\tstruct req_que *req;\n\tstruct rsp_que *rsp;\n\tstruct atio_que *atio;\n\tstruct qla_msix_entry *msix;  \n\tstruct qla_hw_data *hw;\n\tstruct work_struct q_work;\n\tstruct qla_counters counters;\n\n\tstruct list_head qp_list_elem;  \n\tstruct list_head hints_list;\n\n\tuint16_t retry_term_cnt;\n\t__le32\tretry_term_exchg_addr;\n\tuint64_t retry_term_jiff;\n\tstruct qla_tgt_counters tgt_counters;\n\tuint16_t cpuid;\n\tbool cpu_mapped;\n\tstruct qla_fw_resources fwres ____cacheline_aligned;\n\tstruct  qla_buf_pool buf_pool;\n\tu32\tcmd_cnt;\n\tu32\tcmd_completion_cnt;\n\tu32\tprev_completion_cnt;\n};\n\n \nstruct qlfc_fw {\n\tvoid *fw_buf;\n\tdma_addr_t fw_dma;\n\tuint32_t len;\n};\n\nstruct rdp_req_payload {\n\tuint32_t\tels_request;\n\tuint32_t\tdesc_list_len;\n\n\t \n\tstruct {\n\t\tuint32_t desc_tag;\n\t\tuint32_t desc_len;\n\t\tuint8_t  reserved;\n\t\tuint8_t  nport_id[3];\n\t} npiv_desc;\n};\n\nstruct rdp_rsp_payload {\n\tstruct {\n\t\t__be32\tcmd;\n\t\t__be32\tlen;\n\t} hdr;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\treq_payload_word_0;\n\t} ls_req_info_desc;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\treq_payload_word_0;\n\t} ls_req_info_desc2;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be16\ttemperature;\n\t\t__be16\tvcc;\n\t\t__be16\ttx_bias;\n\t\t__be16\ttx_power;\n\t\t__be16\trx_power;\n\t\t__be16\tsfp_flags;\n\t} sfp_diag_desc;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be16\tspeed_capab;\n\t\t__be16\toperating_speed;\n\t} port_speed_desc;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\tlink_fail_cnt;\n\t\t__be32\tloss_sync_cnt;\n\t\t__be32\tloss_sig_cnt;\n\t\t__be32\tprim_seq_err_cnt;\n\t\t__be32\tinval_xmit_word_cnt;\n\t\t__be32\tinval_crc_cnt;\n\t\tuint8_t  pn_port_phy_type;\n\t\tuint8_t  reserved[3];\n\t} ls_err_desc;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\tuint8_t WWNN[WWN_SIZE];\n\t\tuint8_t WWPN[WWN_SIZE];\n\t} port_name_diag_desc;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\tuint8_t WWNN[WWN_SIZE];\n\t\tuint8_t WWPN[WWN_SIZE];\n\t} port_name_direct_desc;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be32\tfcport_b2b;\n\t\t__be32\tattached_fcport_b2b;\n\t\t__be32\tfcport_rtt;\n\t} buffer_credit_desc;\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\t__be16\thigh_alarm;\n\t\t__be16\tlow_alarm;\n\t\t__be16\thigh_warn;\n\t\t__be16\tlow_warn;\n\t\t__be32\telement_flags;\n\t} optical_elmt_desc[5];\n\n\t \n\tstruct {\n\t\t__be32\tdesc_tag;\n\t\t__be32\tdesc_len;\n\t\tuint8_t  vendor_name[16];\n\t\tuint8_t  part_number[16];\n\t\tuint8_t  serial_number[16];\n\t\tuint8_t  revision[4];\n\t\tuint8_t  date[8];\n\t} optical_prod_desc;\n};\n\n#define RDP_DESC_LEN(obj) \\\n\t(sizeof(obj) - sizeof((obj).desc_tag) - sizeof((obj).desc_len))\n\n#define RDP_PORT_SPEED_1GB\t\tBIT_15\n#define RDP_PORT_SPEED_2GB\t\tBIT_14\n#define RDP_PORT_SPEED_4GB\t\tBIT_13\n#define RDP_PORT_SPEED_10GB\t\tBIT_12\n#define RDP_PORT_SPEED_8GB\t\tBIT_11\n#define RDP_PORT_SPEED_16GB\t\tBIT_10\n#define RDP_PORT_SPEED_32GB\t\tBIT_9\n#define RDP_PORT_SPEED_64GB             BIT_8\n#define RDP_PORT_SPEED_UNKNOWN\t\tBIT_0\n\nstruct scsi_qlt_host {\n\tvoid *target_lport_ptr;\n\tstruct mutex tgt_mutex;\n\tstruct mutex tgt_host_action_mutex;\n\tstruct qla_tgt *qla_tgt;\n};\n\nstruct qlt_hw_data {\n\t \n\tuint32_t node_name_set:1;\n\n\tdma_addr_t atio_dma;\t \n\tstruct atio *atio_ring;\t \n\tstruct atio *atio_ring_ptr;\t \n\tuint16_t atio_ring_index;  \n\tuint16_t atio_q_length;\n\t__le32 __iomem *atio_q_in;\n\t__le32 __iomem *atio_q_out;\n\n\tconst struct qla_tgt_func_tmpl *tgt_ops;\n\n\tint saved_set;\n\t__le16\tsaved_exchange_count;\n\t__le32\tsaved_firmware_options_1;\n\t__le32\tsaved_firmware_options_2;\n\t__le32\tsaved_firmware_options_3;\n\tuint8_t saved_firmware_options[2];\n\tuint8_t saved_add_firmware_options[2];\n\n\tuint8_t tgt_node_name[WWN_SIZE];\n\n\tstruct dentry *dfs_tgt_sess;\n\tstruct dentry *dfs_tgt_port_database;\n\tstruct dentry *dfs_naqp;\n\n\tstruct list_head q_full_list;\n\tuint32_t num_pend_cmds;\n\tuint32_t num_qfull_cmds_alloc;\n\tuint32_t num_qfull_cmds_dropped;\n\tspinlock_t q_full_lock;\n\tuint32_t leak_exchg_thresh_hold;\n\tspinlock_t sess_lock;\n\tint num_act_qpairs;\n#define DEFAULT_NAQP 2\n\tspinlock_t atio_lock ____cacheline_aligned;\n};\n\n#define MAX_QFULL_CMDS_ALLOC\t8192\n#define Q_FULL_THRESH_HOLD_PERCENT 90\n#define Q_FULL_THRESH_HOLD(ha) \\\n\t((ha->cur_fw_xcb_count/100) * Q_FULL_THRESH_HOLD_PERCENT)\n\n#define LEAK_EXCHG_THRESH_HOLD_PERCENT 75\t \n\nstruct qla_hw_data_stat {\n\tu32 num_fw_dump;\n\tu32 num_mpi_reset;\n};\n\n \ntypedef enum {\n\tQLA_PCI_RESUME,\n\tQLA_PCI_ERR_DETECTED,\n\tQLA_PCI_MMIO_ENABLED,\n\tQLA_PCI_SLOT_RESET,\n} pci_error_state_t;\n \nstruct qla_hw_data {\n\tstruct pci_dev  *pdev;\n\t \n#define SRB_MIN_REQ     128\n\tmempool_t       *srb_mempool;\n\tu8 port_name[WWN_SIZE];\n\n\tvolatile struct {\n\t\tuint32_t\tmbox_int\t\t:1;\n\t\tuint32_t\tmbox_busy\t\t:1;\n\t\tuint32_t\tdisable_risc_code_load\t:1;\n\t\tuint32_t\tenable_64bit_addressing\t:1;\n\t\tuint32_t\tenable_lip_reset\t:1;\n\t\tuint32_t\tenable_target_reset\t:1;\n\t\tuint32_t\tenable_lip_full_login\t:1;\n\t\tuint32_t\tenable_led_scheme\t:1;\n\n\t\tuint32_t\tmsi_enabled\t\t:1;\n\t\tuint32_t\tmsix_enabled\t\t:1;\n\t\tuint32_t\tdisable_serdes\t\t:1;\n\t\tuint32_t\tgpsc_supported\t\t:1;\n\t\tuint32_t\tnpiv_supported\t\t:1;\n\t\tuint32_t\tpci_channel_io_perm_failure\t:1;\n\t\tuint32_t\tfce_enabled\t\t:1;\n\t\tuint32_t\tfac_supported\t\t:1;\n\n\t\tuint32_t\tchip_reset_done\t\t:1;\n\t\tuint32_t\trunning_gold_fw\t\t:1;\n\t\tuint32_t\teeh_busy\t\t:1;\n\t\tuint32_t\tdisable_msix_handshake\t:1;\n\t\tuint32_t\tfcp_prio_enabled\t:1;\n\t\tuint32_t\tisp82xx_fw_hung:1;\n\t\tuint32_t\tnic_core_hung:1;\n\n\t\tuint32_t\tquiesce_owner:1;\n\t\tuint32_t\tnic_core_reset_hdlr_active:1;\n\t\tuint32_t\tnic_core_reset_owner:1;\n\t\tuint32_t\tisp82xx_no_md_cap:1;\n\t\tuint32_t\thost_shutting_down:1;\n\t\tuint32_t\tidc_compl_status:1;\n\t\tuint32_t        mr_reset_hdlr_active:1;\n\t\tuint32_t        mr_intr_valid:1;\n\n\t\tuint32_t        dport_enabled:1;\n\t\tuint32_t\tfawwpn_enabled:1;\n\t\tuint32_t\texlogins_enabled:1;\n\t\tuint32_t\texchoffld_enabled:1;\n\n\t\tuint32_t\tlip_ae:1;\n\t\tuint32_t\tn2n_ae:1;\n\t\tuint32_t\tfw_started:1;\n\t\tuint32_t\tfw_init_done:1;\n\n\t\tuint32_t\tlr_detected:1;\n\n\t\tuint32_t\trida_fmt2:1;\n\t\tuint32_t\tpurge_mbox:1;\n\t\tuint32_t        n2n_bigger:1;\n\t\tuint32_t\tsecure_adapter:1;\n\t\tuint32_t\tsecure_fw:1;\n\t\t\t\t \n\t\tuint32_t\tscm_supported_a:1;\n\t\t\t\t \n\t\tuint32_t\tscm_supported_f:1;\n\t\t\t\t \n\t\tuint32_t\tscm_enabled:1;\n\t\tuint32_t\tedif_hw:1;\n\t\tuint32_t\tedif_enabled:1;\n\t\tuint32_t\tn2n_fw_acc_sec:1;\n\t\tuint32_t\tplogi_template_valid:1;\n\t\tuint32_t\tport_isolated:1;\n\t\tuint32_t\teeh_flush:2;\n#define EEH_FLUSH_RDY  1\n#define EEH_FLUSH_DONE 2\n\t} flags;\n\n\tuint16_t max_exchg;\n\tuint16_t lr_distance;\t \n#define LR_DISTANCE_5K  1\n#define LR_DISTANCE_10K 0\n\n\t \n\n\tspinlock_t\thardware_lock ____cacheline_aligned;\n\tint\t\tbars;\n\tint\t\tmem_only;\n\tdevice_reg_t *iobase;            \n\tresource_size_t pio_address;\n\n#define MIN_IOBASE_LEN          0x100\n\tdma_addr_t\t\tbar0_hdl;\n\n\tvoid __iomem *cregbase;\n\tdma_addr_t\t\tbar2_hdl;\n#define BAR0_LEN_FX00\t\t\t(1024 * 1024)\n#define BAR2_LEN_FX00\t\t\t(128 * 1024)\n\n\tuint32_t\t\trqstq_intr_code;\n\tuint32_t\t\tmbx_intr_code;\n\tuint32_t\t\treq_que_len;\n\tuint32_t\t\trsp_que_len;\n\tuint32_t\t\treq_que_off;\n\tuint32_t\t\trsp_que_off;\n\tunsigned long\t\teeh_jif;\n\n\t \n\tdevice_reg_t *mqiobase;\n\tdevice_reg_t *msixbase;\n\tuint16_t        msix_count;\n\tuint8_t         mqenable;\n\tstruct req_que **req_q_map;\n\tstruct rsp_que **rsp_q_map;\n\tstruct qla_qpair **queue_pair_map;\n\tstruct qla_qpair **qp_cpu_map;\n\tunsigned long req_qid_map[(QLA_MAX_QUEUES / 8) / sizeof(unsigned long)];\n\tunsigned long rsp_qid_map[(QLA_MAX_QUEUES / 8) / sizeof(unsigned long)];\n\tunsigned long qpair_qid_map[(QLA_MAX_QUEUES / 8)\n\t\t/ sizeof(unsigned long)];\n\tuint8_t \tmax_req_queues;\n\tuint8_t \tmax_rsp_queues;\n\tuint8_t\t\tmax_qpairs;\n\tuint8_t\t\tnum_qpairs;\n\tstruct qla_qpair *base_qpair;\n\tstruct qla_npiv_entry *npiv_info;\n\tuint16_t\tnvram_npiv_size;\n\n\tuint16_t        switch_cap;\n#define FLOGI_SEQ_DEL           BIT_8\n#define FLOGI_MID_SUPPORT       BIT_10\n#define FLOGI_VSAN_SUPPORT      BIT_12\n#define FLOGI_SP_SUPPORT        BIT_13\n\n\tuint8_t\t\tport_no;\t\t \n\tuint8_t\t\texch_starvation;\n\n\t \n\tuint8_t \tloop_down_abort_time;     \n\tatomic_t\tloop_down_timer;          \n\tuint8_t\t\tlink_down_timeout;        \n\tuint16_t\tmax_loop_id;\n\tuint16_t\tmax_fibre_devices;\t \n\n\tuint16_t\tfb_rev;\n\tuint16_t\tmin_external_loopid;     \n\n#define PORT_SPEED_UNKNOWN 0xFFFF\n#define PORT_SPEED_1GB  0x00\n#define PORT_SPEED_2GB  0x01\n#define PORT_SPEED_AUTO 0x02\n#define PORT_SPEED_4GB  0x03\n#define PORT_SPEED_8GB  0x04\n#define PORT_SPEED_16GB 0x05\n#define PORT_SPEED_32GB 0x06\n#define PORT_SPEED_64GB 0x07\n#define PORT_SPEED_10GB\t0x13\n\tuint16_t\tlink_data_rate;          \n\tuint16_t\tset_data_rate;\t\t \n\n\tuint8_t\t\tcurrent_topology;\n\tuint8_t\t\tprev_topology;\n#define ISP_CFG_NL\t1\n#define ISP_CFG_N\t2\n#define ISP_CFG_FL\t4\n#define ISP_CFG_F\t8\n\n\tuint8_t\t\toperating_mode;          \n#define LOOP      0\n#define P2P       1\n#define LOOP_P2P  2\n#define P2P_LOOP  3\n\tuint8_t\t\tinterrupts_on;\n\tuint32_t\tisp_abort_cnt;\n#define PCI_DEVICE_ID_QLOGIC_ISP2532    0x2532\n#define PCI_DEVICE_ID_QLOGIC_ISP8432    0x8432\n#define PCI_DEVICE_ID_QLOGIC_ISP8001\t0x8001\n#define PCI_DEVICE_ID_QLOGIC_ISP8031\t0x8031\n#define PCI_DEVICE_ID_QLOGIC_ISP2031\t0x2031\n#define PCI_DEVICE_ID_QLOGIC_ISP2071\t0x2071\n#define PCI_DEVICE_ID_QLOGIC_ISP2271\t0x2271\n#define PCI_DEVICE_ID_QLOGIC_ISP2261\t0x2261\n#define PCI_DEVICE_ID_QLOGIC_ISP2061\t0x2061\n#define PCI_DEVICE_ID_QLOGIC_ISP2081\t0x2081\n#define PCI_DEVICE_ID_QLOGIC_ISP2089\t0x2089\n#define PCI_DEVICE_ID_QLOGIC_ISP2281\t0x2281\n#define PCI_DEVICE_ID_QLOGIC_ISP2289\t0x2289\n\n\tuint32_t\tisp_type;\n#define DT_ISP2100                      BIT_0\n#define DT_ISP2200                      BIT_1\n#define DT_ISP2300                      BIT_2\n#define DT_ISP2312                      BIT_3\n#define DT_ISP2322                      BIT_4\n#define DT_ISP6312                      BIT_5\n#define DT_ISP6322                      BIT_6\n#define DT_ISP2422                      BIT_7\n#define DT_ISP2432                      BIT_8\n#define DT_ISP5422                      BIT_9\n#define DT_ISP5432                      BIT_10\n#define DT_ISP2532                      BIT_11\n#define DT_ISP8432                      BIT_12\n#define DT_ISP8001\t\t\tBIT_13\n#define DT_ISP8021\t\t\tBIT_14\n#define DT_ISP2031\t\t\tBIT_15\n#define DT_ISP8031\t\t\tBIT_16\n#define DT_ISPFX00\t\t\tBIT_17\n#define DT_ISP8044\t\t\tBIT_18\n#define DT_ISP2071\t\t\tBIT_19\n#define DT_ISP2271\t\t\tBIT_20\n#define DT_ISP2261\t\t\tBIT_21\n#define DT_ISP2061\t\t\tBIT_22\n#define DT_ISP2081\t\t\tBIT_23\n#define DT_ISP2089\t\t\tBIT_24\n#define DT_ISP2281\t\t\tBIT_25\n#define DT_ISP2289\t\t\tBIT_26\n#define DT_ISP_LAST\t\t\t(DT_ISP2289 << 1)\n\n\tuint32_t\tdevice_type;\n#define DT_T10_PI                       BIT_25\n#define DT_IIDMA                        BIT_26\n#define DT_FWI2                         BIT_27\n#define DT_ZIO_SUPPORTED                BIT_28\n#define DT_OEM_001                      BIT_29\n#define DT_ISP2200A                     BIT_30\n#define DT_EXTENDED_IDS                 BIT_31\n\n#define DT_MASK(ha)     ((ha)->isp_type & (DT_ISP_LAST - 1))\n#define IS_QLA2100(ha)  (DT_MASK(ha) & DT_ISP2100)\n#define IS_QLA2200(ha)  (DT_MASK(ha) & DT_ISP2200)\n#define IS_QLA2300(ha)  (DT_MASK(ha) & DT_ISP2300)\n#define IS_QLA2312(ha)  (DT_MASK(ha) & DT_ISP2312)\n#define IS_QLA2322(ha)  (DT_MASK(ha) & DT_ISP2322)\n#define IS_QLA6312(ha)  (DT_MASK(ha) & DT_ISP6312)\n#define IS_QLA6322(ha)  (DT_MASK(ha) & DT_ISP6322)\n#define IS_QLA2422(ha)  (DT_MASK(ha) & DT_ISP2422)\n#define IS_QLA2432(ha)  (DT_MASK(ha) & DT_ISP2432)\n#define IS_QLA5422(ha)  (DT_MASK(ha) & DT_ISP5422)\n#define IS_QLA5432(ha)  (DT_MASK(ha) & DT_ISP5432)\n#define IS_QLA2532(ha)  (DT_MASK(ha) & DT_ISP2532)\n#define IS_QLA8432(ha)  (DT_MASK(ha) & DT_ISP8432)\n#define IS_QLA8001(ha)\t(DT_MASK(ha) & DT_ISP8001)\n#define IS_QLA81XX(ha)\t(IS_QLA8001(ha))\n#define IS_QLA82XX(ha)\t(DT_MASK(ha) & DT_ISP8021)\n#define IS_QLA8044(ha)  (DT_MASK(ha) & DT_ISP8044)\n#define IS_QLA2031(ha)\t(DT_MASK(ha) & DT_ISP2031)\n#define IS_QLA8031(ha)\t(DT_MASK(ha) & DT_ISP8031)\n#define IS_QLAFX00(ha)\t(DT_MASK(ha) & DT_ISPFX00)\n#define IS_QLA2071(ha)\t(DT_MASK(ha) & DT_ISP2071)\n#define IS_QLA2271(ha)\t(DT_MASK(ha) & DT_ISP2271)\n#define IS_QLA2261(ha)\t(DT_MASK(ha) & DT_ISP2261)\n#define IS_QLA2081(ha)\t(DT_MASK(ha) & DT_ISP2081)\n#define IS_QLA2281(ha)\t(DT_MASK(ha) & DT_ISP2281)\n\n#define IS_QLA23XX(ha)  (IS_QLA2300(ha) || IS_QLA2312(ha) || IS_QLA2322(ha) || \\\n\t\t\tIS_QLA6312(ha) || IS_QLA6322(ha))\n#define IS_QLA24XX(ha)  (IS_QLA2422(ha) || IS_QLA2432(ha))\n#define IS_QLA54XX(ha)  (IS_QLA5422(ha) || IS_QLA5432(ha))\n#define IS_QLA25XX(ha)  (IS_QLA2532(ha))\n#define IS_QLA83XX(ha)\t(IS_QLA2031(ha) || IS_QLA8031(ha))\n#define IS_QLA84XX(ha)  (IS_QLA8432(ha))\n#define IS_QLA27XX(ha)  (IS_QLA2071(ha) || IS_QLA2271(ha) || IS_QLA2261(ha))\n#define IS_QLA28XX(ha)\t(IS_QLA2081(ha) || IS_QLA2281(ha))\n#define IS_QLA24XX_TYPE(ha)     (IS_QLA24XX(ha) || IS_QLA54XX(ha) || \\\n\t\t\t\tIS_QLA84XX(ha))\n#define IS_CNA_CAPABLE(ha)\t(IS_QLA81XX(ha) || IS_QLA82XX(ha) || \\\n\t\t\t\tIS_QLA8031(ha) || IS_QLA8044(ha))\n#define IS_P3P_TYPE(ha)\t\t(IS_QLA82XX(ha) || IS_QLA8044(ha))\n#define IS_QLA2XXX_MIDTYPE(ha)\t(IS_QLA24XX(ha) || IS_QLA84XX(ha) || \\\n\t\t\t\tIS_QLA25XX(ha) || IS_QLA81XX(ha) || \\\n\t\t\t\tIS_QLA82XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA8044(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_MSIX_NACK_CAPABLE(ha) (IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_NOPOLLING_TYPE(ha)\t(IS_QLA81XX(ha) && (ha)->flags.msix_enabled)\n#define IS_FAC_REQUIRED(ha)\t(IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_NOCACHE_VPD_TYPE(ha)\t(IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t\t\t\tIS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_ALOGIO_CAPABLE(ha)\t(IS_QLA23XX(ha) || IS_FWI2_CAPABLE(ha))\n\n#define IS_T10_PI_CAPABLE(ha)   ((ha)->device_type & DT_T10_PI)\n#define IS_IIDMA_CAPABLE(ha)    ((ha)->device_type & DT_IIDMA)\n#define IS_FWI2_CAPABLE(ha)     ((ha)->device_type & DT_FWI2)\n#define IS_ZIO_SUPPORTED(ha)    ((ha)->device_type & DT_ZIO_SUPPORTED)\n#define IS_OEM_001(ha)          ((ha)->device_type & DT_OEM_001)\n#define HAS_EXTENDED_IDS(ha)    ((ha)->device_type & DT_EXTENDED_IDS)\n#define IS_CT6_SUPPORTED(ha)\t((ha)->device_type & DT_CT6_SUPPORTED)\n#define IS_MQUE_CAPABLE(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\t IS_QLA28XX(ha))\n#define IS_BIDI_CAPABLE(ha) \\\n    (IS_QLA25XX(ha) || IS_QLA2031(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n \n#define IS_MCTP_CAPABLE(ha)\t(IS_QLA2031(ha) && \\\n\t\t\t\t((ha)->fw_attributes_ext[0] & BIT_0))\n#define QLA_ABTS_FW_ENABLED(_ha)       ((_ha)->fw_attributes_ext[0] & BIT_14)\n#define QLA_SRB_NVME_LS(_sp) ((_sp)->type == SRB_NVME_LS)\n#define QLA_SRB_NVME_CMD(_sp) ((_sp)->type == SRB_NVME_CMD)\n#define QLA_NVME_IOS(_sp) (QLA_SRB_NVME_CMD(_sp) || QLA_SRB_NVME_LS(_sp))\n#define QLA_LS_ABTS_WAIT_ENABLED(_sp) \\\n\t(QLA_SRB_NVME_LS(_sp) && QLA_ABTS_FW_ENABLED(_sp->fcport->vha->hw))\n#define QLA_CMD_ABTS_WAIT_ENABLED(_sp) \\\n\t(QLA_SRB_NVME_CMD(_sp) && QLA_ABTS_FW_ENABLED(_sp->fcport->vha->hw))\n#define QLA_ABTS_WAIT_ENABLED(_sp) \\\n\t(QLA_NVME_IOS(_sp) && QLA_ABTS_FW_ENABLED(_sp->fcport->vha->hw))\n\n#define IS_PI_UNINIT_CAPABLE(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\t\t IS_QLA28XX(ha))\n#define IS_PI_IPGUARD_CAPABLE(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\t\t IS_QLA28XX(ha))\n#define IS_PI_DIFB_DIX0_CAPABLE(ha)\t(0)\n#define IS_PI_SPLIT_DET_CAPABLE_HBA(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\t\tIS_QLA28XX(ha))\n#define IS_PI_SPLIT_DET_CAPABLE(ha)\t(IS_PI_SPLIT_DET_CAPABLE_HBA(ha) && \\\n    (((ha)->fw_attributes_h << 16 | (ha)->fw_attributes) & BIT_22))\n#define IS_ATIO_MSIX_CAPABLE(ha) (IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_TGT_MODE_CAPABLE(ha)\t(ha->tgt.atio_q_length)\n#define IS_SHADOW_REG_CAPABLE(ha)  (IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_DPORT_CAPABLE(ha)  (IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_FAWWN_CAPABLE(ha)\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || \\\n\t\t\t\tIS_QLA28XX(ha))\n#define IS_EXCHG_OFFLD_CAPABLE(ha) \\\n\t(IS_QLA81XX(ha) || IS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_EXLOGIN_OFFLD_CAPABLE(ha) \\\n\t(IS_QLA25XX(ha) || IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define USE_ASYNC_SCAN(ha) (IS_QLA25XX(ha) || IS_QLA81XX(ha) ||\\\n\tIS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n\n#define IS_ZIO_THRESHOLD_CAPABLE(ha) \\\n\t((IS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha)) &&\\\n\t (ha->zio_mode == QLA_ZIO_MODE_6))\n\n\t \n\tuint8_t\t\tserial0;\n\tuint8_t\t\tserial1;\n\tuint8_t\t\tserial2;\n\n\t \n#define MAX_NVRAM_SIZE  4096\n#define VPD_OFFSET      (MAX_NVRAM_SIZE / 2)\n\tuint16_t\tnvram_size;\n\tuint16_t\tnvram_base;\n\tvoid\t\t*nvram;\n\tuint16_t\tvpd_size;\n\tuint16_t\tvpd_base;\n\tvoid\t\t*vpd;\n\n\tuint16_t\tloop_reset_delay;\n\tuint8_t\t\tretry_count;\n\tuint8_t\t\tlogin_timeout;\n\tuint16_t\tr_a_tov;\n\tint\t\tport_down_retry_count;\n\tuint8_t\t\tmbx_count;\n\tuint8_t\t\taen_mbx_count;\n\tatomic_t\tnum_pend_mbx_stage1;\n\tatomic_t\tnum_pend_mbx_stage2;\n\tuint16_t\tframe_payload_size;\n\n\tuint32_t\tlogin_retry_count;\n\t \n\tms_iocb_entry_t\t\t*ms_iocb;\n\tdma_addr_t\t\tms_iocb_dma;\n\tstruct ct_sns_pkt\t*ct_sns;\n\tdma_addr_t\t\tct_sns_dma;\n\t \n\tstruct sns_cmd_pkt\t*sns_cmd;\n\tdma_addr_t\t\tsns_cmd_dma;\n\n#define SFP_DEV_SIZE    512\n#define SFP_BLOCK_SIZE  64\n#define SFP_RTDI_LEN\tSFP_BLOCK_SIZE\n\n\tvoid\t\t*sfp_data;\n\tdma_addr_t\tsfp_data_dma;\n\n\tstruct qla_flt_header *flt;\n\tdma_addr_t\tflt_dma;\n\n#define XGMAC_DATA_SIZE\t4096\n\tvoid\t\t*xgmac_data;\n\tdma_addr_t\txgmac_data_dma;\n\n#define DCBX_TLV_DATA_SIZE 4096\n\tvoid\t\t*dcbx_tlv;\n\tdma_addr_t\tdcbx_tlv_dma;\n\n\tstruct task_struct\t*dpc_thread;\n\tuint8_t dpc_active;                   \n\n\tdma_addr_t\tgid_list_dma;\n\tstruct gid_list_info *gid_list;\n\tint\t\tgid_list_info_size;\n\n\t \n#define DMA_POOL_SIZE   256\n\tstruct dma_pool *s_dma_pool;\n\n\tdma_addr_t\tinit_cb_dma;\n\tinit_cb_t\t*init_cb;\n\tint\t\tinit_cb_size;\n\tdma_addr_t\tex_init_cb_dma;\n\tstruct ex_init_cb_81xx *ex_init_cb;\n\tdma_addr_t\tsf_init_cb_dma;\n\tstruct init_sf_cb *sf_init_cb;\n\n\tvoid\t\t*scm_fpin_els_buff;\n\tuint64_t\tscm_fpin_els_buff_size;\n\tbool\t\tscm_fpin_valid;\n\tbool\t\tscm_fpin_payload_size;\n\n\tvoid\t\t*async_pd;\n\tdma_addr_t\tasync_pd_dma;\n\n#define ENABLE_EXTENDED_LOGIN\tBIT_7\n\n\t \n\tvoid\t\t*exlogin_buf;\n\tdma_addr_t\texlogin_buf_dma;\n\tuint32_t\texlogin_size;\n\n#define ENABLE_EXCHANGE_OFFLD\tBIT_2\n\n\t \n\tvoid\t\t*exchoffld_buf;\n\tdma_addr_t\texchoffld_buf_dma;\n\tint\t\texchoffld_size;\n\tint \t\texchoffld_count;\n\n\t \n\tstruct fc_els_flogi plogi_els_payld;\n\n\tvoid            *swl;\n\n\t \n\tuint16_t mailbox_out[MAILBOX_REGISTER_COUNT];\n\tuint32_t mailbox_out32[MAILBOX_REGISTER_COUNT];\n\tuint32_t aenmb[AEN_MAILBOX_REGISTER_COUNT_FX00];\n\n\tmbx_cmd_t\t*mcp;\n\tstruct mbx_cmd_32\t*mcp32;\n\n\tunsigned long\tmbx_cmd_flags;\n#define MBX_INTERRUPT\t\t1\n#define MBX_INTR_WAIT\t\t2\n#define MBX_UPDATE_FLASH_ACTIVE\t3\n\n\tstruct mutex vport_lock;         \n\tspinlock_t vport_slock;  \n\tstruct mutex mq_lock;         \n\tstruct completion mbx_cmd_comp;  \n\tstruct completion mbx_intr_comp;   \n\tstruct completion dcbx_comp;\t \n\tstruct completion lb_portup_comp;  \n#define DCBX_COMP_TIMEOUT\t20\n#define LB_PORTUP_COMP_TIMEOUT\t10\n\n\tint notify_dcbx_comp;\n\tint notify_lb_portup_comp;\n\tstruct mutex selflogin_lock;\n\n\t \n\tuint16_t\tfw_major_version;\n\tuint16_t\tfw_minor_version;\n\tuint16_t\tfw_subminor_version;\n\tuint16_t\tfw_attributes;\n\tuint16_t\tfw_attributes_h;\n#define FW_ATTR_H_NVME_FBURST \tBIT_1\n#define FW_ATTR_H_NVME\t\tBIT_10\n#define FW_ATTR_H_NVME_UPDATED  BIT_14\n\n\t \n#define FW_ATTR_EXT0_SCM_SUPPORTED\tBIT_12\n\t \n#define FW_ATTR_EXT0_SCM_BROCADE\t0x00001000\n\t \n#define FW_ATTR_EXT0_SCM_CISCO\t\t0x00002000\n#define FW_ATTR_EXT0_NVME2\tBIT_13\n#define FW_ATTR_EXT0_EDIF\tBIT_5\n\tuint16_t\tfw_attributes_ext[2];\n\tuint32_t\tfw_memory_size;\n\tuint32_t\tfw_transfer_size;\n\tuint32_t\tfw_srisc_address;\n#define RISC_START_ADDRESS_2100 0x1000\n#define RISC_START_ADDRESS_2300 0x800\n#define RISC_START_ADDRESS_2400 0x100000\n\n\tuint16_t\torig_fw_tgt_xcb_count;\n\tuint16_t\tcur_fw_tgt_xcb_count;\n\tuint16_t\torig_fw_xcb_count;\n\tuint16_t\tcur_fw_xcb_count;\n\tuint16_t\torig_fw_iocb_count;\n\tuint16_t\tcur_fw_iocb_count;\n\tuint16_t\tfw_max_fcf_count;\n\n\tuint32_t\tfw_shared_ram_start;\n\tuint32_t\tfw_shared_ram_end;\n\tuint32_t\tfw_ddr_ram_start;\n\tuint32_t\tfw_ddr_ram_end;\n\n\tuint16_t\tfw_options[16];          \n\tuint8_t\t\tfw_seriallink_options[4];\n\t__le16\t\tfw_seriallink_options24[4];\n\n\tuint8_t\t\tserdes_version[3];\n\tuint8_t\t\tmpi_version[3];\n\tuint32_t\tmpi_capabilities;\n\tuint8_t\t\tphy_version[3];\n\tuint8_t\t\tpep_version[3];\n\n\t \n\tstruct fwdt {\n\t\tvoid *template;\n\t\tulong length;\n\t\tulong dump_size;\n\t} fwdt[2];\n\tstruct qla2xxx_fw_dump *fw_dump;\n\tuint32_t\tfw_dump_len;\n\tu32\t\tfw_dump_alloc_len;\n\tbool\t\tfw_dumped;\n\tunsigned long\tfw_dump_cap_flags;\n#define RISC_PAUSE_CMPL\t\t0\n#define DMA_SHUTDOWN_CMPL\t1\n#define ISP_RESET_CMPL\t\t2\n#define RISC_RDY_AFT_RESET\t3\n#define RISC_SRAM_DUMP_CMPL\t4\n#define RISC_EXT_MEM_DUMP_CMPL\t5\n#define ISP_MBX_RDY\t\t6\n#define ISP_SOFT_RESET_CMPL\t7\n\tint\t\tfw_dump_reading;\n\tvoid\t\t*mpi_fw_dump;\n\tu32\t\tmpi_fw_dump_len;\n\tunsigned int\tmpi_fw_dump_reading:1;\n\tunsigned int\tmpi_fw_dumped:1;\n\tint\t\tprev_minidump_failed;\n\tdma_addr_t\teft_dma;\n\tvoid\t\t*eft;\n \n#define MCTP_DUMP_SIZE  0x086064\n\tdma_addr_t\tmctp_dump_dma;\n\tvoid\t\t*mctp_dump;\n\tint\t\tmctp_dumped;\n\tint\t\tmctp_dump_reading;\n\tuint32_t\tchain_offset;\n\tstruct dentry *dfs_dir;\n\tstruct dentry *dfs_fce;\n\tstruct dentry *dfs_tgt_counters;\n\tstruct dentry *dfs_fw_resource_cnt;\n\n\tdma_addr_t\tfce_dma;\n\tvoid\t\t*fce;\n\tuint32_t\tfce_bufs;\n\tuint16_t\tfce_mb[8];\n\tuint64_t\tfce_wr, fce_rd;\n\tstruct mutex\tfce_mutex;\n\n\tuint32_t\tpci_attr;\n\tuint16_t\tchip_revision;\n\n\tuint16_t\tproduct_id[4];\n\n\tuint8_t\t\tmodel_number[16+1];\n\tchar\t\tmodel_desc[80];\n\tuint8_t\t\tadapter_id[16+1];\n\n\t \n\tchar\t\t*optrom_buffer;\n\tuint32_t\toptrom_size;\n\tint\t\toptrom_state;\n#define QLA_SWAITING\t0\n#define QLA_SREADING\t1\n#define QLA_SWRITING\t2\n\tuint32_t\toptrom_region_start;\n\tuint32_t\toptrom_region_size;\n\tstruct mutex\toptrom_mutex;\n\n \n#define ROM_CODE_TYPE_BIOS\t0\n#define ROM_CODE_TYPE_FCODE\t1\n#define ROM_CODE_TYPE_EFI\t3\n\tuint8_t \tbios_revision[2];\n\tuint8_t \tefi_revision[2];\n\tuint8_t \tfcode_revision[16];\n\tuint32_t\tfw_revision[4];\n\n\tuint32_t\tgold_fw_version[4];\n\n\t \n\tuint32_t\tflash_conf_off;\n\tuint32_t\tflash_data_off;\n\tuint32_t\tnvram_conf_off;\n\tuint32_t\tnvram_data_off;\n\n\tuint32_t\tfdt_wrt_disable;\n\tuint32_t\tfdt_wrt_enable;\n\tuint32_t\tfdt_erase_cmd;\n\tuint32_t\tfdt_block_size;\n\tuint32_t\tfdt_unprotect_sec_cmd;\n\tuint32_t\tfdt_protect_sec_cmd;\n\tuint32_t\tfdt_wrt_sts_reg_cmd;\n\n\tstruct {\n\t\tuint32_t\tflt_region_flt;\n\t\tuint32_t\tflt_region_fdt;\n\t\tuint32_t\tflt_region_boot;\n\t\tuint32_t\tflt_region_boot_sec;\n\t\tuint32_t\tflt_region_fw;\n\t\tuint32_t\tflt_region_fw_sec;\n\t\tuint32_t\tflt_region_vpd_nvram;\n\t\tuint32_t\tflt_region_vpd_nvram_sec;\n\t\tuint32_t\tflt_region_vpd;\n\t\tuint32_t\tflt_region_vpd_sec;\n\t\tuint32_t\tflt_region_nvram;\n\t\tuint32_t\tflt_region_nvram_sec;\n\t\tuint32_t\tflt_region_npiv_conf;\n\t\tuint32_t\tflt_region_gold_fw;\n\t\tuint32_t\tflt_region_fcp_prio;\n\t\tuint32_t\tflt_region_bootload;\n\t\tuint32_t\tflt_region_img_status_pri;\n\t\tuint32_t\tflt_region_img_status_sec;\n\t\tuint32_t\tflt_region_aux_img_status_pri;\n\t\tuint32_t\tflt_region_aux_img_status_sec;\n\t};\n\tuint8_t         active_image;\n\tuint8_t active_tmf;\n#define MAX_ACTIVE_TMF 8\n\n\t \n\tuint16_t        beacon_blink_led;\n\tuint8_t         beacon_color_state;\n#define QLA_LED_GRN_ON\t\t0x01\n#define QLA_LED_YLW_ON\t\t0x02\n#define QLA_LED_ABR_ON\t\t0x04\n#define QLA_LED_ALL_ON\t\t0x07\t \n\t\t\t\t\t \n\tuint16_t        zio_mode;\n\tuint16_t        zio_timer;\n\n\tstruct qla_msix_entry *msix_entries;\n\n\tstruct list_head tmf_pending;\n\tstruct list_head tmf_active;\n\tstruct list_head        vp_list;         \n\tunsigned long   vp_idx_map[(MAX_MULTI_ID_FABRIC / 8) /\n\t\t\tsizeof(unsigned long)];\n\tuint16_t        num_vhosts;      \n\tuint16_t        num_vsans;       \n\tuint16_t        max_npiv_vports;         \n\tint             cur_vport_count;\n\n\tstruct qla_chip_state_84xx *cs84xx;\n\tstruct isp_operations *isp_ops;\n\tstruct workqueue_struct *wq;\n\tstruct work_struct heartbeat_work;\n\tstruct qlfc_fw fw_buf;\n\tunsigned long last_heartbeat_run_jiffies;\n\n\t \n\tstruct qla_fcp_prio_cfg *fcp_prio_cfg;\n\n\tstruct dma_pool *dl_dma_pool;\n#define DSD_LIST_DMA_POOL_SIZE  512\n\n\tstruct dma_pool *fcp_cmnd_dma_pool;\n\tmempool_t       *ctx_mempool;\n#define FCP_CMND_DMA_POOL_SIZE 512\n\n\tvoid __iomem\t*nx_pcibase;\t\t \n\tvoid __iomem\t*nxdb_rd_ptr;\t\t \n\tvoid __iomem\t*nxdb_wr_ptr;\t\t \n\n\tuint32_t\tcrb_win;\n\tuint32_t\tcurr_window;\n\tuint32_t\tddr_mn_window;\n\tunsigned long\tmn_win_crb;\n\tunsigned long\tms_win_crb;\n\tint\t\tqdr_sn_window;\n\tuint32_t\tfcoe_dev_init_timeout;\n\tuint32_t\tfcoe_reset_timeout;\n\trwlock_t\thw_lock;\n\tuint16_t\tportnum;\t\t \n\tint\t\tlink_width;\n\tstruct fw_blob\t*hablob;\n\tstruct qla82xx_legacy_intr_set nx_legacy_intr;\n\n\tuint8_t fw_type;\n\tuint32_t file_prd_off;\t \n\n\tuint32_t\tmd_template_size;\n\tvoid\t\t*md_tmplt_hdr;\n\tdma_addr_t      md_tmplt_hdr_dma;\n\tvoid            *md_dump;\n\tuint32_t\tmd_dump_size;\n\n\tvoid\t\t*loop_id_map;\n\n\t \n\tuint32_t\tidc_audit_ts;\n\tuint32_t\tidc_extend_tmo;\n\n\t \n\tstruct workqueue_struct *dpc_lp_wq;\n\tstruct work_struct idc_aen;\n\t \n\tstruct workqueue_struct *dpc_hp_wq;\n\tstruct work_struct nic_core_reset;\n\tstruct work_struct idc_state_handler;\n\tstruct work_struct nic_core_unrecoverable;\n\tstruct work_struct board_disable;\n\n\tstruct mr_data_fx00 mr;\n\tuint32_t chip_reset;\n\n\tstruct qlt_hw_data tgt;\n\tint\tallow_cna_fw_dump;\n\tuint32_t fw_ability_mask;\n\tuint16_t min_supported_speed;\n\tuint16_t max_supported_speed;\n\n\t \n\tstruct dma_pool *dif_bundl_pool;\n\t#define DIF_BUNDLING_DMA_POOL_SIZE  1024\n\tstruct {\n\t\tstruct {\n\t\t\tstruct list_head head;\n\t\t\tuint count;\n\t\t} good;\n\t\tstruct {\n\t\t\tstruct list_head head;\n\t\t\tuint count;\n\t\t} unusable;\n\t} pool;\n\n\tunsigned long long dif_bundle_crossed_pages;\n\tunsigned long long dif_bundle_reads;\n\tunsigned long long dif_bundle_writes;\n\tunsigned long long dif_bundle_kallocs;\n\tunsigned long long dif_bundle_dma_allocs;\n\n\tatomic_t        nvme_active_aen_cnt;\n\tuint16_t        nvme_last_rptd_aen;              \n\n\tuint8_t fc4_type_priority;\n\n\tatomic_t zio_threshold;\n\tuint16_t last_zio_threshold;\n\n#define DEFAULT_ZIO_THRESHOLD 5\n\n\tstruct qla_hw_data_stat stat;\n\tpci_error_state_t pci_error_state;\n\tstruct dma_pool *purex_dma_pool;\n\tstruct btree_head32 host_map;\n\n#define EDIF_NUM_SA_INDEX\t512\n#define EDIF_TX_SA_INDEX_BASE\tEDIF_NUM_SA_INDEX\n\tvoid *edif_rx_sa_id_map;\n\tvoid *edif_tx_sa_id_map;\n\tspinlock_t sadb_fp_lock;\n\n\tstruct list_head sadb_tx_index_list;\n\tstruct list_head sadb_rx_index_list;\n\tspinlock_t sadb_lock;\t \n\tstruct els_reject elsrej;\n\tu8 edif_post_stop_cnt_down;\n\tstruct qla_vp_map *vp_map;\n\tstruct qla_nvme_fc_rjt lsrjt;\n\tstruct qla_fw_res fwres ____cacheline_aligned;\n};\n\n#define RX_ELS_SIZE (roundup(sizeof(struct enode) + ELS_MAX_PAYLOAD, SMP_CACHE_BYTES))\n\nstruct active_regions {\n\tuint8_t global;\n\tstruct {\n\t\tuint8_t board_config;\n\t\tuint8_t vpd_nvram;\n\t\tuint8_t npiv_config_0_1;\n\t\tuint8_t npiv_config_2_3;\n\t\tuint8_t nvme_params;\n\t} aux;\n};\n\n#define FW_ABILITY_MAX_SPEED_MASK\t0xFUL\n#define FW_ABILITY_MAX_SPEED_16G\t0x0\n#define FW_ABILITY_MAX_SPEED_32G\t0x1\n#define FW_ABILITY_MAX_SPEED(ha)\t\\\n\t(ha->fw_ability_mask & FW_ABILITY_MAX_SPEED_MASK)\n\n#define QLA_GET_DATA_RATE\t0\n#define QLA_SET_DATA_RATE_NOLR\t1\n#define QLA_SET_DATA_RATE_LR\t2  \n\n#define QLA_DEFAULT_PAYLOAD_SIZE\t64\n \nstruct purex_item {\n\tvoid *purls_context;\n\tstruct list_head list;\n\tstruct scsi_qla_host *vha;\n\tvoid (*process_item)(struct scsi_qla_host *vha,\n\t\t\t     struct purex_item *pkt);\n\tatomic_t in_use;\n\tuint16_t size;\n\tstruct {\n\t\tuint8_t iocb[64];\n\t} iocb;\n};\n\n#include \"qla_edif.h\"\n\n#define SCM_FLAG_RDF_REJECT\t\t0x00\n#define SCM_FLAG_RDF_COMPLETED\t\t0x01\n\n#define QLA_CON_PRIMITIVE_RECEIVED\t0x1\n#define QLA_CONGESTION_ARB_WARNING\t0x1\n#define QLA_CONGESTION_ARB_ALARM\t0X2\n\n \ntypedef struct scsi_qla_host {\n\tstruct list_head list;\n\tstruct list_head vp_fcports;\t \n\tstruct list_head work_list;\n\tspinlock_t work_lock;\n\tstruct work_struct iocb_work;\n\n\t \n\tstruct Scsi_Host *host;\n\tunsigned long\thost_no;\n\tuint8_t\t\thost_str[16];\n\n\tvolatile struct {\n\t\tuint32_t\tinit_done\t\t:1;\n\t\tuint32_t\tonline\t\t\t:1;\n\t\tuint32_t\treset_active\t\t:1;\n\n\t\tuint32_t\tmanagement_server_logged_in :1;\n\t\tuint32_t\tprocess_response_queue\t:1;\n\t\tuint32_t\tdifdix_supported:1;\n\t\tuint32_t\tdelete_progress:1;\n\n\t\tuint32_t\tfw_tgt_reported:1;\n\t\tuint32_t\tbbcr_enable:1;\n\t\tuint32_t\tqpairs_available:1;\n\t\tuint32_t\tqpairs_req_created:1;\n\t\tuint32_t\tqpairs_rsp_created:1;\n\t\tuint32_t\tnvme_enabled:1;\n\t\tuint32_t        nvme_first_burst:1;\n\t\tuint32_t        nvme2_enabled:1;\n\t} flags;\n\n\tatomic_t\tloop_state;\n#define LOOP_TIMEOUT\t1\n#define LOOP_DOWN\t2\n#define LOOP_UP\t\t3\n#define LOOP_UPDATE\t4\n#define LOOP_READY\t5\n#define LOOP_DEAD\t6\n\n\tunsigned long   buf_expired;\n\tunsigned long   relogin_jif;\n\tunsigned long   dpc_flags;\n#define RESET_MARKER_NEEDED\t0\t \n#define RESET_ACTIVE\t\t1\n#define ISP_ABORT_NEEDED\t2\t \n#define ABORT_ISP_ACTIVE\t3\t \n#define LOOP_RESYNC_NEEDED\t4\t \n#define LOOP_RESYNC_ACTIVE\t5\n#define LOCAL_LOOP_UPDATE\t6\t \n#define RSCN_UPDATE\t\t7\t \n#define RELOGIN_NEEDED\t\t8\n#define REGISTER_FC4_NEEDED\t9\t \n#define ISP_ABORT_RETRY\t\t10\t \n#define BEACON_BLINK_NEEDED\t11\n#define REGISTER_FDMI_NEEDED\t12\n#define VP_DPC_NEEDED\t\t14\t \n#define UNLOADING\t\t15\n#define NPIV_CONFIG_NEEDED\t16\n#define ISP_UNRECOVERABLE\t17\n#define FCOE_CTX_RESET_NEEDED\t18\t \n#define MPI_RESET_NEEDED\t19\t \n#define ISP_QUIESCE_NEEDED\t20\t \n#define N2N_LINK_RESET\t\t21\n#define PORT_UPDATE_NEEDED\t22\n#define FX00_RESET_RECOVERY\t23\n#define FX00_TARGET_SCAN\t24\n#define FX00_CRITEMP_RECOVERY\t25\n#define FX00_HOST_INFO_RESEND\t26\n#define QPAIR_ONLINE_CHECK_NEEDED\t27\n#define DO_EEH_RECOVERY\t\t28\n#define DETECT_SFP_CHANGE\t29\n#define N2N_LOGIN_NEEDED\t30\n#define IOCB_WORK_ACTIVE\t31\n#define SET_ZIO_THRESHOLD_NEEDED 32\n#define ISP_ABORT_TO_ROM\t33\n#define VPORT_DELETE\t\t34\n\n#define PROCESS_PUREX_IOCB\t63\n\n\tunsigned long\tpci_flags;\n#define PFLG_DISCONNECTED\t0\t \n#define PFLG_DRIVER_REMOVING\t1\t \n#define PFLG_DRIVER_PROBING\t2\t \n\n\tuint32_t\tdevice_flags;\n#define SWITCH_FOUND\t\tBIT_0\n#define DFLG_NO_CABLE\t\tBIT_1\n#define DFLG_DEV_FAILED\t\tBIT_5\n\n\t \n\tuint16_t\tloop_id;\t\t \n\tuint16_t        self_login_loop_id;      \n\tfc_port_t       bidir_fcport;\t\t \n\n\tport_id_t\td_id;\t\t\t \n\tuint8_t\t\tmarker_needed;\n\tuint16_t\tmgmt_svr_loop_id;\n\n\n\n\t \n\tuint8_t         loop_down_abort_time;     \n\tatomic_t        loop_down_timer;          \n\tuint8_t         link_down_timeout;        \n\n\tuint32_t        timer_active;\n\tstruct timer_list        timer;\n\n\tuint8_t\t\tnode_name[WWN_SIZE];\n\tuint8_t\t\tport_name[WWN_SIZE];\n\tuint8_t\t\tfabric_node_name[WWN_SIZE];\n\tuint8_t\t\tfabric_port_name[WWN_SIZE];\n\n\tstruct\t\tnvme_fc_local_port *nvme_local_port;\n\tstruct completion nvme_del_done;\n\n\tuint16_t\tfcoe_vlan_id;\n\tuint16_t\tfcoe_fcf_idx;\n\tuint8_t\t\tfcoe_vn_port_mac[6];\n\n\t \n\tstruct list_head\tqla_cmd_list;\n\tstruct list_head\tunknown_atio_list;\n\tspinlock_t\t\tcmd_list_lock;\n\tstruct delayed_work\tunknown_atio_work;\n\n\t \n\tatomic_t\t\tgeneration_tick;\n\t \n\tint\t\t\ttotal_fcport_update_gen;\n\t \n\tstruct list_head\tlogo_list;\n\t \n\tstruct list_head\tplogi_ack_list;\n\n\tstruct list_head\tqp_list;\n\n\tuint32_t\tvp_abort_cnt;\n\n\tstruct fc_vport\t*fc_vport;\t \n\tuint16_t        vp_idx;\t\t \n\tstruct qla_qpair *qpair;\t \n\n\tunsigned long\t\tvp_flags;\n#define VP_IDX_ACQUIRED\t\t0\t \n#define VP_CREATE_NEEDED\t1\n#define VP_BIND_NEEDED\t\t2\n#define VP_DELETE_NEEDED\t3\n#define VP_SCR_NEEDED\t\t4\t \n#define VP_CONFIG_OK\t\t5\t \n\tatomic_t \t\tvp_state;\n#define VP_OFFLINE\t\t0\n#define VP_ACTIVE\t\t1\n#define VP_FAILED\t\t2\n\n\tuint16_t \tvp_err_state;\n\tuint16_t\tvp_prev_err_state;\n#define VP_ERR_UNKWN\t\t0\n#define VP_ERR_PORTDWN\t\t1\n#define VP_ERR_FAB_UNSUPPORTED\t2\n#define VP_ERR_FAB_NORESOURCES\t3\n#define VP_ERR_FAB_LOGOUT\t4\n#define VP_ERR_ADAP_NORESOURCES\t5\n\tstruct qla_hw_data *hw;\n\tstruct scsi_qlt_host vha_tgt;\n\tstruct req_que *req;\n\tint\t\tfw_heartbeat_counter;\n\tint\t\tseconds_since_last_heartbeat;\n\tstruct fc_host_statistics fc_host_stat;\n\tstruct qla_statistics qla_stats;\n\tstruct bidi_statistics bidi_stats;\n\tatomic_t\tvref_count;\n\tstruct qla8044_reset_template reset_tmplt;\n\tuint16_t\tbbcr;\n\n\tuint16_t u_ql2xexchoffld;\n\tuint16_t u_ql2xiniexchg;\n\tuint16_t qlini_mode;\n\tuint16_t ql2xexchoffld;\n\tuint16_t ql2xiniexchg;\n\n\tstruct dentry *dfs_rport_root;\n\n\tstruct purex_list {\n\t\tstruct list_head head;\n\t\tspinlock_t lock;\n\t} purex_list;\n\tstruct purex_item default_item;\n\n\tstruct name_list_extended gnl;\n\t \n\tint fcport_count;\n\twait_queue_head_t fcport_waitQ;\n\twait_queue_head_t vref_waitq;\n\tuint8_t min_supported_speed;\n\tuint8_t n2n_node_name[WWN_SIZE];\n\tuint8_t n2n_port_name[WWN_SIZE];\n\tuint16_t\tn2n_id;\n\t__le16 dport_data[4];\n\tstruct fab_scan scan;\n\tuint8_t\tscm_fabric_connection_flags;\n\n\tunsigned int irq_offset;\n\n\tu64 hw_err_cnt;\n\tu64 interface_err_cnt;\n\tu64 cmd_timeout_cnt;\n\tu64 reset_cmd_err_cnt;\n\tu64 link_down_time;\n\tu64 short_link_down_cnt;\n\tstruct edif_dbell e_dbell;\n\tstruct pur_core pur_cinfo;\n\n#define DPORT_DIAG_IN_PROGRESS                 BIT_0\n#define DPORT_DIAG_CHIP_RESET_IN_PROGRESS      BIT_1\n\tuint16_t dport_status;\n} scsi_qla_host_t;\n\nstruct qla27xx_image_status {\n\tuint8_t image_status_mask;\n\t__le16\tgeneration;\n\tuint8_t ver_major;\n\tuint8_t ver_minor;\n\tuint8_t bitmap;\t\t \n\tuint8_t reserved[2];\n\t__le32\tchecksum;\n\t__le32\tsignature;\n} __packed;\n\n \n#define QLA28XX_AUX_IMG_BOARD_CONFIG\t\tBIT_0\n#define QLA28XX_AUX_IMG_VPD_NVRAM\t\tBIT_1\n#define QLA28XX_AUX_IMG_NPIV_CONFIG_0_1\t\tBIT_2\n#define QLA28XX_AUX_IMG_NPIV_CONFIG_2_3\t\tBIT_3\n#define QLA28XX_AUX_IMG_NVME_PARAMS\t\tBIT_4\n\n#define SET_VP_IDX\t1\n#define SET_AL_PA\t2\n#define RESET_VP_IDX\t3\n#define RESET_AL_PA\t4\nstruct qla_vp_map {\n\tuint8_t\tidx;\n\tscsi_qla_host_t *vha;\n};\n\nstruct qla2_sgx {\n\tdma_addr_t\t\tdma_addr;\t \n\tuint32_t\t\tdma_len;\t \n\n\tuint32_t\t\ttot_bytes;\t \n\tstruct scatterlist\t*cur_sg;\t \n\n\t \n\tuint32_t\t\tbytes_consumed;\n\tuint32_t\t\tnum_bytes;\n\tuint32_t\t\ttot_partial;\n\n\t \n\tuint32_t\t\tnum_sg;\n\tsrb_t\t\t\t*sp;\n};\n\n#define QLA_FW_STARTED(_ha) {\t\t\t\\\n\tint i;\t\t\t\t\t\\\n\t_ha->flags.fw_started = 1;\t\t\\\n\t_ha->base_qpair->fw_started = 1;\t\\\n\tfor (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\\\n\t_ha->queue_pair_map[i]->fw_started = 1;\t\\\n\t}\t\t\t\t\t\\\n}\n\n#define QLA_FW_STOPPED(_ha) {\t\t\t\\\n\tint i;\t\t\t\t\t\\\n\t_ha->flags.fw_started = 0;\t\t\\\n\t_ha->base_qpair->fw_started = 0;\t\\\n\tfor (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\\\n\t_ha->queue_pair_map[i]->fw_started = 0;\t\\\n\t}\t\t\t\t\t\\\n}\n\n\n#define SFUB_CHECKSUM_SIZE\t4\n\nstruct secure_flash_update_block {\n\tuint32_t\tblock_info;\n\tuint32_t\tsignature_lo;\n\tuint32_t\tsignature_hi;\n\tuint32_t\tsignature_upper[0x3e];\n};\n\nstruct secure_flash_update_block_pk {\n\tuint32_t\tblock_info;\n\tuint32_t\tsignature_lo;\n\tuint32_t\tsignature_hi;\n\tuint32_t\tsignature_upper[0x3e];\n\tuint32_t\tpublic_key[0x41];\n};\n\n \n#define LOOP_TRANSITION(ha) \\\n\t(test_bit(ISP_ABORT_NEEDED, &ha->dpc_flags) || \\\n\t test_bit(LOOP_RESYNC_NEEDED, &ha->dpc_flags) || \\\n\t atomic_read(&ha->loop_state) == LOOP_DOWN)\n\n#define STATE_TRANSITION(ha) \\\n\t\t(test_bit(ISP_ABORT_NEEDED, &ha->dpc_flags) || \\\n\t\t\t test_bit(LOOP_RESYNC_NEEDED, &ha->dpc_flags))\n\nstatic inline bool qla_vha_mark_busy(scsi_qla_host_t *vha)\n{\n\tatomic_inc(&vha->vref_count);\n\tmb();\n\tif (vha->flags.delete_progress) {\n\t\tatomic_dec(&vha->vref_count);\n\t\twake_up(&vha->vref_waitq);\n\t\treturn true;\n\t}\n\treturn false;\n}\n\n#define QLA_VHA_MARK_NOT_BUSY(__vha) do {\t\t\\\n\tatomic_dec(&__vha->vref_count);\t\t\t\\\n\twake_up(&__vha->vref_waitq);\t\t\t\\\n} while (0)\t\t\t\t\t\t\\\n\n#define QLA_QPAIR_MARK_BUSY(__qpair, __bail) do {\t\\\n\tatomic_inc(&__qpair->ref_count);\t\t\\\n\tmb();\t\t\t\t\t\t\\\n\tif (__qpair->delete_in_progress) {\t\t\\\n\t\tatomic_dec(&__qpair->ref_count);\t\\\n\t\t__bail = 1;\t\t\t\t\\\n\t} else {\t\t\t\t\t\\\n\t       __bail = 0;\t\t\t\t\\\n\t}\t\t\t\t\t\t\\\n} while (0)\n\n#define QLA_QPAIR_MARK_NOT_BUSY(__qpair)\t\t\\\n\tatomic_dec(&__qpair->ref_count)\n\n#define QLA_ENA_CONF(_ha) {\\\n    int i;\\\n    _ha->base_qpair->enable_explicit_conf = 1;\t\\\n    for (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\t\\\n\t    _ha->queue_pair_map[i]->enable_explicit_conf = 1; \\\n    }\t\t\t\t\t\t\\\n}\n\n#define QLA_DIS_CONF(_ha) {\\\n    int i;\\\n    _ha->base_qpair->enable_explicit_conf = 0;\t\\\n    for (i = 0; i < _ha->max_qpairs; i++) {\t\\\n\tif (_ha->queue_pair_map[i])\t\t\\\n\t    _ha->queue_pair_map[i]->enable_explicit_conf = 0; \\\n    }\t\t\t\t\t\t\\\n}\n\n \n#define MBS_MASK\t\t0x3fff\n\n#define QLA_SUCCESS\t\t(MBS_COMMAND_COMPLETE & MBS_MASK)\n#define QLA_INVALID_COMMAND\t(MBS_INVALID_COMMAND & MBS_MASK)\n#define QLA_INTERFACE_ERROR\t(MBS_HOST_INTERFACE_ERROR & MBS_MASK)\n#define QLA_TEST_FAILED\t\t(MBS_TEST_FAILED & MBS_MASK)\n#define QLA_COMMAND_ERROR\t(MBS_COMMAND_ERROR & MBS_MASK)\n#define QLA_PARAMETER_ERROR\t(MBS_COMMAND_PARAMETER_ERROR & MBS_MASK)\n#define QLA_PORT_ID_USED\t(MBS_PORT_ID_USED & MBS_MASK)\n#define QLA_LOOP_ID_USED\t(MBS_LOOP_ID_USED & MBS_MASK)\n#define QLA_ALL_IDS_IN_USE\t(MBS_ALL_IDS_IN_USE & MBS_MASK)\n#define QLA_NOT_LOGGED_IN\t(MBS_NOT_LOGGED_IN & MBS_MASK)\n\n#define QLA_FUNCTION_TIMEOUT\t\t0x100\n#define QLA_FUNCTION_PARAMETER_ERROR\t0x101\n#define QLA_FUNCTION_FAILED\t\t0x102\n#define QLA_MEMORY_ALLOC_FAILED\t\t0x103\n#define QLA_LOCK_TIMEOUT\t\t0x104\n#define QLA_ABORTED\t\t\t0x105\n#define QLA_SUSPENDED\t\t\t0x106\n#define QLA_BUSY\t\t\t0x107\n#define QLA_ALREADY_REGISTERED\t\t0x109\n#define QLA_OS_TIMER_EXPIRED\t\t0x10a\n#define QLA_ERR_NO_QPAIR\t\t0x10b\n#define QLA_ERR_NOT_FOUND\t\t0x10c\n#define QLA_ERR_FROM_FW\t\t\t0x10d\n\n#define NVRAM_DELAY()\t\tudelay(10)\n\n \n#define OPTROM_SIZE_2300\t0x20000\n#define OPTROM_SIZE_2322\t0x100000\n#define OPTROM_SIZE_24XX\t0x100000\n#define OPTROM_SIZE_25XX\t0x200000\n#define OPTROM_SIZE_81XX\t0x400000\n#define OPTROM_SIZE_82XX\t0x800000\n#define OPTROM_SIZE_83XX\t0x1000000\n#define OPTROM_SIZE_28XX\t0x2000000\n\n#define OPTROM_BURST_SIZE\t0x1000\n#define OPTROM_BURST_DWORDS\t(OPTROM_BURST_SIZE / 4)\n\n#define\tQLA_DSDS_PER_IOCB\t37\n\n#define QLA_SG_ALL\t1024\n\nenum nexus_wait_type {\n\tWAIT_HOST = 0,\n\tWAIT_TARGET,\n\tWAIT_LUN,\n};\n\n#define INVALID_EDIF_SA_INDEX\t0xffff\n#define RX_DELETE_NO_EDIF_SA_INDEX\t0xfffe\n\n#define QLA_SKIP_HANDLE QLA_TGT_SKIP_HANDLE\n\n \nstruct edif_list_entry {\n\tuint16_t handle;\t\t\t \n\tuint32_t update_sa_index;\n\tuint32_t delete_sa_index;\n\tuint32_t count;\t\t\t\t \n#define EDIF_ENTRY_FLAGS_CLEANUP\t0x01\t \n\tuint32_t flags;\t\t\t\t \n\tfc_port_t *fcport;\t\t\t \n\tstruct timer_list timer;\t\t \n\tstruct list_head next;\n};\n\n#define EDIF_TX_INDX_BASE 512\n#define EDIF_RX_INDX_BASE 0\n#define EDIF_RX_DELETE_FILTER_COUNT 3\t \n\n \n\nstruct sa_index_pair {\n\tuint16_t sa_index;\n\tuint32_t spi;\n};\n\n \nstruct edif_sa_index_entry {\n\tstruct sa_index_pair sa_pair[2];\n\tfc_port_t *fcport;\n\tuint16_t handle;\n\tstruct list_head next;\n};\n\n \nstruct sff_8247_a0 {\n\tu8 txid;\t \n\tu8 ext_txid;\n\tu8 connector;\n\t \n\tu8 eth_infi_cc3;\t \n\tu8 sonet_cc4[2];\n\tu8 eth_cc6;\n\t \n#define FC_LL_VL BIT_7\t \n#define FC_LL_S  BIT_6\t \n#define FC_LL_I  BIT_5\t \n#define FC_LL_L  BIT_4\t \n#define FC_LL_M  BIT_3\t \n#define FC_LL_SA BIT_2\t \n#define FC_LL_LC BIT_1\t \n#define FC_LL_EL BIT_0\t \n\tu8 fc_ll_cc7;\n\t \n#define FC_TEC_EL BIT_7\t \n#define FC_TEC_SN BIT_6\t \n#define FC_TEC_SL BIT_5\t \n#define FC_TEC_LL BIT_4\t \n#define FC_TEC_ACT BIT_3\t \n#define FC_TEC_PAS BIT_2\t \n\tu8 fc_tec_cc8;\n\t \n#define FC_MED_TW BIT_7\t \n#define FC_MED_TP BIT_6\t \n#define FC_MED_MI BIT_5\t \n#define FC_MED_TV BIT_4\t \n#define FC_MED_M6 BIT_3\t \n#define FC_MED_M5 BIT_2\t \n#define FC_MED_SM BIT_0\t \n\tu8 fc_med_cc9;\n\t \n#define FC_SP_12 BIT_7\n#define FC_SP_8  BIT_6\n#define FC_SP_16 BIT_5\n#define FC_SP_4  BIT_4\n#define FC_SP_32 BIT_3\n#define FC_SP_2  BIT_2\n#define FC_SP_1  BIT_0\n\tu8 fc_sp_cc10;\n\tu8 encode;\n\tu8 bitrate;\n\tu8 rate_id;\n\tu8 length_km;\t\t \n\tu8 length_100m;\n\tu8 length_50um_10m;\n\tu8 length_62um_10m;\n\tu8 length_om4_10m;\n\tu8 length_om3_10m;\n#define SFF_VEN_NAME_LEN 16\n\tu8 vendor_name[SFF_VEN_NAME_LEN];\t \n\tu8 tx_compat;\n\tu8 vendor_oui[3];\n#define SFF_PART_NAME_LEN 16\n\tu8 vendor_pn[SFF_PART_NAME_LEN];\t \n\tu8 vendor_rev[4];\n\tu8 wavelength[2];\n\tu8 resv;\n\tu8 cc_base;\n\tu8 options[2];\t \n\tu8 br_max;\n\tu8 br_min;\n\tu8 vendor_sn[16];\n\tu8 date_code[8];\n\tu8 diag;\n\tu8 enh_options;\n\tu8 sff_revision;\n\tu8 cc_ext;\n\tu8 vendor_specific[32];\n\tu8 resv2[128];\n};\n\n \n#define IS_BPM_CAPABLE(ha) \\\n\t(IS_QLA25XX(ha) || IS_QLA81XX(ha) || IS_QLA83XX(ha) || \\\n\t IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_BPM_RANGE_CAPABLE(ha) \\\n\t(IS_QLA83XX(ha) || IS_QLA27XX(ha) || IS_QLA28XX(ha))\n#define IS_BPM_ENABLED(vha) \\\n\t(ql2xautodetectsfp && !vha->vp_idx && IS_BPM_CAPABLE(vha->hw))\n\n#define FLASH_SEMAPHORE_REGISTER_ADDR   0x00101016\n\n#define USER_CTRL_IRQ(_ha) (ql2xuctrlirq && QLA_TGT_MODE_ENABLED() && \\\n\t(IS_QLA27XX(_ha) || IS_QLA28XX(_ha) || IS_QLA83XX(_ha)))\n\n#define SAVE_TOPO(_ha) { \\\n\tif (_ha->current_topology)\t\t\t\t\\\n\t\t_ha->prev_topology = _ha->current_topology;     \\\n}\n\n#define N2N_TOPO(ha) \\\n\t((ha->prev_topology == ISP_CFG_N && !ha->current_topology) || \\\n\t ha->current_topology == ISP_CFG_N || \\\n\t !ha->current_topology)\n\n#define QLA_N2N_WAIT_TIME\t5  \n\n#define NVME_TYPE(fcport) \\\n\t(fcport->fc4_type & FS_FC4TYPE_NVME) \\\n\n#define FCP_TYPE(fcport) \\\n\t(fcport->fc4_type & FS_FC4TYPE_FCP) \\\n\n#define NVME_ONLY_TARGET(fcport) \\\n\t(NVME_TYPE(fcport) && !FCP_TYPE(fcport))  \\\n\n#define NVME_FCP_TARGET(fcport) \\\n\t(FCP_TYPE(fcport) && NVME_TYPE(fcport)) \\\n\n#define NVME_PRIORITY(ha, fcport) \\\n\t(NVME_FCP_TARGET(fcport) && \\\n\t (ha->fc4_type_priority == FC4_PRIORITY_NVME))\n\n#define NVME_TARGET(ha, fcport) \\\n\t(fcport->do_prli_nvme || \\\n\tNVME_ONLY_TARGET(fcport)) \\\n\n#define PRLI_PHASE(_cls) \\\n\t((_cls == DSC_LS_PRLI_PEND) || (_cls == DSC_LS_PRLI_COMP))\n\nenum ql_vnd_host_stat_action {\n\tQLA_STOP = 0,\n\tQLA_START,\n\tQLA_CLEAR,\n};\n\nstruct ql_vnd_mng_host_stats_param {\n\tu32 stat_type;\n\tenum ql_vnd_host_stat_action action;\n} __packed;\n\nstruct ql_vnd_mng_host_stats_resp {\n\tu32 status;\n} __packed;\n\nstruct ql_vnd_stats_param {\n\tu32 stat_type;\n} __packed;\n\nstruct ql_vnd_tgt_stats_param {\n\ts32 tgt_id;\n\tu32 stat_type;\n} __packed;\n\nenum ql_vnd_host_port_action {\n\tQLA_ENABLE = 0,\n\tQLA_DISABLE,\n};\n\nstruct ql_vnd_mng_host_port_param {\n\tenum ql_vnd_host_port_action action;\n} __packed;\n\nstruct ql_vnd_mng_host_port_resp {\n\tu32 status;\n} __packed;\n\nstruct ql_vnd_stat_entry {\n\tu32 stat_type;\t \n\tu32 tgt_num;\t \n\tu64 cnt;\t \n} __packed;\n\nstruct ql_vnd_stats {\n\tu64 entry_count;  \n\tu64 rservd;\n\tstruct ql_vnd_stat_entry entry[];  \n} __packed;\n\nstruct ql_vnd_host_stats_resp {\n\tu32 status;\n\tstruct ql_vnd_stats stats;\n} __packed;\n\nstruct ql_vnd_tgt_stats_resp {\n\tu32 status;\n\tstruct ql_vnd_stats stats;\n} __packed;\n\n#include \"qla_target.h\"\n#include \"qla_gbl.h\"\n#include \"qla_dbg.h\"\n#include \"qla_inline.h\"\n\n#define IS_SESSION_DELETED(_fcport) (_fcport->disc_state == DSC_DELETE_PEND || \\\n\t\t\t\t      _fcport->disc_state == DSC_DELETED)\n\n#define DBG_FCPORT_PRFMT(_fp, _fmt, _args...) \\\n\t\"%s: %8phC: \" _fmt \" (state=%d disc_state=%d scan_state=%d loopid=0x%x deleted=%d flags=0x%x)\\n\", \\\n\t__func__, _fp->port_name, ##_args, atomic_read(&_fp->state), \\\n\t_fp->disc_state, _fp->scan_state, _fp->loop_id, _fp->deleted, \\\n\t_fp->flags\n\n#define TMF_NOT_READY(_fcport) \\\n\t(!_fcport || IS_SESSION_DELETED(_fcport) || atomic_read(&_fcport->state) != FCS_ONLINE || \\\n\t!_fcport->vha->hw->flags.fw_started)\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}