{
  "module_name": "efct_lio.h",
  "hash_id": "6e26b1301af3c01b456f7f639bbe7a1d7bf7fb46573cc9ecd013668163956a96",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/elx/efct/efct_lio.h",
  "human_readable_source": " \n \n\n#ifndef __EFCT_LIO_H__\n#define __EFCT_LIO_H__\n\n#include \"efct_scsi.h\"\n#include <target/target_core_base.h>\n\n#define efct_lio_io_printf(io, fmt, ...)\t\t\t\\\n\tefc_log_debug(io->efct,\t\t\t\t\t\\\n\t\t\"[%s] [%04x][i:%04x t:%04x h:%04x]\" fmt,\\\n\t\tio->node->display_name, io->instance_index,\t\\\n\t\tio->init_task_tag, io->tgt_task_tag, io->hw_tag,\\\n\t\t##__VA_ARGS__)\n\n#define efct_lio_tmfio_printf(io, fmt, ...)\t\t\t\\\n\tefc_log_debug(io->efct,\t\t\t\t\t\\\n\t\t\"[%s] [%04x][i:%04x t:%04x h:%04x][f:%02x]\" fmt,\\\n\t\tio->node->display_name, io->instance_index,\t\\\n\t\tio->init_task_tag, io->tgt_task_tag, io->hw_tag,\\\n\t\tio->tgt_io.tmf,  ##__VA_ARGS__)\n\n#define efct_set_lio_io_state(io, value) (io->tgt_io.state |= value)\n\nstruct efct_lio_wq_data {\n\tstruct efct\t\t*efct;\n\tvoid\t\t\t*ptr;\n\tstruct work_struct\twork;\n};\n\n \nstruct efct_scsi_tgt {\n\tu32\t\t\tmax_sge;\n\tu32\t\t\tmax_sgl;\n\n\t \n\tatomic_t\t\tinitiator_count;\n\tatomic_t\t\tios_in_use;\n\tatomic_t\t\tio_high_watermark;\n\n\tatomic_t\t\twatermark_hit;\n\tint\t\t\twatermark_min;\n\tint\t\t\twatermark_max;\n\n\tstruct efct_lio_nport\t*lio_nport;\n\tstruct efct_lio_tpg\t*tpg;\n\n\tstruct list_head\tvport_list;\n\t \n\tspinlock_t\t\tefct_lio_lock;\n\n\tu64\t\t\twwnn;\n};\n\nstruct efct_scsi_tgt_nport {\n\tstruct efct_lio_nport\t*lio_nport;\n};\n\nstruct efct_node {\n\tstruct list_head\tlist_entry;\n\tstruct kref\t\tref;\n\tvoid\t\t\t(*release)(struct kref *arg);\n\tstruct efct\t\t*efct;\n\tstruct efc_node\t\t*node;\n\tstruct se_session\t*session;\n\tspinlock_t\t\tactive_ios_lock;\n\tstruct list_head\tactive_ios;\n\tchar\t\t\tdisplay_name[EFC_NAME_LENGTH];\n\tu32\t\t\tport_fc_id;\n\tu32\t\t\tnode_fc_id;\n\tu32\t\t\tvpi;\n\tu32\t\t\trpi;\n\tu32\t\t\tabort_cnt;\n};\n\n#define EFCT_LIO_STATE_SCSI_RECV_CMD\t\t(1 << 0)\n#define EFCT_LIO_STATE_TGT_SUBMIT_CMD\t\t(1 << 1)\n#define EFCT_LIO_STATE_TFO_QUEUE_DATA_IN\t(1 << 2)\n#define EFCT_LIO_STATE_TFO_WRITE_PENDING\t(1 << 3)\n#define EFCT_LIO_STATE_TGT_EXECUTE_CMD\t\t(1 << 4)\n#define EFCT_LIO_STATE_SCSI_SEND_RD_DATA\t(1 << 5)\n#define EFCT_LIO_STATE_TFO_CHK_STOP_FREE\t(1 << 6)\n#define EFCT_LIO_STATE_SCSI_DATA_DONE\t\t(1 << 7)\n#define EFCT_LIO_STATE_TFO_QUEUE_STATUS\t\t(1 << 8)\n#define EFCT_LIO_STATE_SCSI_SEND_RSP\t\t(1 << 9)\n#define EFCT_LIO_STATE_SCSI_RSP_DONE\t\t(1 << 10)\n#define EFCT_LIO_STATE_TGT_GENERIC_FREE\t\t(1 << 11)\n#define EFCT_LIO_STATE_SCSI_RECV_TMF\t\t(1 << 12)\n#define EFCT_LIO_STATE_TGT_SUBMIT_TMR\t\t(1 << 13)\n#define EFCT_LIO_STATE_TFO_WRITE_PEND_STATUS\t(1 << 14)\n#define EFCT_LIO_STATE_TGT_GENERIC_REQ_FAILURE  (1 << 15)\n\n#define EFCT_LIO_STATE_TFO_ABORTED_TASK\t\t(1 << 29)\n#define EFCT_LIO_STATE_TFO_RELEASE_CMD\t\t(1 << 30)\n#define EFCT_LIO_STATE_SCSI_CMPL_CMD\t\t(1u << 31)\n\nstruct efct_scsi_tgt_io {\n\tstruct se_cmd\t\tcmd;\n\tunsigned char\t\tsense_buffer[TRANSPORT_SENSE_BUFFER];\n\tenum dma_data_direction\tddir;\n\tint\t\t\ttask_attr;\n\tu64\t\t\tlun;\n\n\tu32\t\t\tstate;\n\tu8\t\t\ttmf;\n\tstruct efct_io\t\t*io_to_abort;\n\tu32\t\t\tseg_map_cnt;\n\tu32\t\t\tseg_cnt;\n\tu32\t\t\tcur_seg;\n\tenum efct_scsi_io_status err;\n\tbool\t\t\taborting;\n\tbool\t\t\trsp_sent;\n\tu32\t\t\ttransferred_len;\n};\n\n \nenum {\n\tSCSI_HANDLER_DATAPHASE_STARTED = 1,\n\tSCSI_HANDLER_RESP_STARTED,\n\tSCSI_HANDLER_VALIDATED_DATAPHASE_STARTED,\n\tSCSI_CMD_NOT_SUPPORTED,\n};\n\n#define WWN_NAME_LEN\t\t32\nstruct efct_lio_vport {\n\tu64\t\t\twwpn;\n\tu64\t\t\tnpiv_wwpn;\n\tu64\t\t\tnpiv_wwnn;\n\tunsigned char\t\twwpn_str[WWN_NAME_LEN];\n\tstruct se_wwn\t\tvport_wwn;\n\tstruct efct_lio_tpg\t*tpg;\n\tstruct efct\t\t*efct;\n\tstruct Scsi_Host\t*shost;\n\tstruct fc_vport\t\t*fc_vport;\n\tatomic_t\t\tenable;\n};\n\nstruct efct_lio_nport {\n\tu64\t\t\twwpn;\n\tunsigned char\t\twwpn_str[WWN_NAME_LEN];\n\tstruct se_wwn\t\tnport_wwn;\n\tstruct efct_lio_tpg\t*tpg;\n\tstruct efct\t\t*efct;\n\tatomic_t\t\tenable;\n};\n\nstruct efct_lio_tpg_attrib {\n\tu32\t\t\tgenerate_node_acls;\n\tu32\t\t\tcache_dynamic_acls;\n\tu32\t\t\tdemo_mode_write_protect;\n\tu32\t\t\tprod_mode_write_protect;\n\tu32\t\t\tdemo_mode_login_only;\n\tbool\t\t\tsession_deletion_wait;\n};\n\nstruct efct_lio_tpg {\n\tstruct se_portal_group\ttpg;\n\tstruct efct_lio_nport\t*nport;\n\tstruct efct_lio_vport\t*vport;\n\tstruct efct_lio_tpg_attrib tpg_attrib;\n\tunsigned short\t\ttpgt;\n\tbool\t\t\tenabled;\n};\n\nstruct efct_lio_nacl {\n\tu64\t\t\tnport_wwnn;\n\tchar\t\t\tnport_name[WWN_NAME_LEN];\n\tstruct se_session\t*session;\n\tstruct se_node_acl\tse_node_acl;\n};\n\nstruct efct_lio_vport_list_t {\n\tstruct list_head\tlist_entry;\n\tstruct efct_lio_vport\t*lio_vport;\n};\n\nint efct_scsi_tgt_driver_init(void);\nint efct_scsi_tgt_driver_exit(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}