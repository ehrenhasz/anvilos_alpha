{
  "module_name": "lpfc_sli.h",
  "hash_id": "45a66c2ad3cf3e95ab8c8d5130d395c3a902dcbab79926b3bfd719f844fb981a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/lpfc/lpfc_sli.h",
  "human_readable_source": " \n\n#if defined(CONFIG_DEBUG_FS) && !defined(CONFIG_SCSI_LPFC_DEBUG_FS)\n#define CONFIG_SCSI_LPFC_DEBUG_FS\n#endif\n\n \nstruct lpfc_hba;\nstruct lpfc_vport;\n\n \ntypedef enum _lpfc_ctx_cmd {\n\tLPFC_CTX_LUN,\n\tLPFC_CTX_TGT,\n\tLPFC_CTX_HOST\n} lpfc_ctx_cmd;\n\n \nenum lpfc_mbox_ctx {\n\tMBOX_THD_UNLOCKED,\n\tMBOX_THD_LOCKED\n};\n\nunion lpfc_vmid_tag {\n\tuint32_t app_id;\n\tuint8_t cs_ctl_vmid;\n\tstruct lpfc_vmid_context *vmid_context;\t \n};\n\nstruct lpfc_cq_event {\n\tstruct list_head list;\n\tuint16_t hdwq;\n\tunion {\n\t\tstruct lpfc_mcqe\t\tmcqe_cmpl;\n\t\tstruct lpfc_acqe_link\t\tacqe_link;\n\t\tstruct lpfc_acqe_fip\t\tacqe_fip;\n\t\tstruct lpfc_acqe_dcbx\t\tacqe_dcbx;\n\t\tstruct lpfc_acqe_grp5\t\tacqe_grp5;\n\t\tstruct lpfc_acqe_fc_la\t\tacqe_fc;\n\t\tstruct lpfc_acqe_sli\t\tacqe_sli;\n\t\tstruct lpfc_rcqe\t\trcqe_cmpl;\n\t\tstruct sli4_wcqe_xri_aborted\twcqe_axri;\n\t\tstruct lpfc_wcqe_complete\twcqe_cmpl;\n\t} cqe;\n};\n\n \nstruct lpfc_iocbq {\n\t \n\tstruct list_head list;\n\tstruct list_head clist;\n\tstruct list_head dlist;\n\tuint16_t iotag;          \n\tuint16_t sli4_lxritag;   \n\tuint16_t sli4_xritag;    \n\tuint16_t hba_wqidx;      \n\tstruct lpfc_cq_event cq_event;\n\tuint64_t isr_timestamp;\n\n\tunion lpfc_wqe128 wqe;\t \n\tIOCB_t iocb;\t\t \n\tstruct lpfc_wcqe_complete wcqe_cmpl;\t \n\n\tu32 unsol_rcv_len;\t \n\n\t \n\tu8 num_bdes;\t \n\tu8 abort_bls;\t \n\tu8 abort_rctl;\t \n\tu8 priority;\t \n\tu8 retry;\t \n\tu8 rsvd1;        \n\tu8 rsvd2;        \n\tu8 rsvd3;\t \n\n\tu32 cmd_flag;\n#define LPFC_IO_LIBDFC\t\t1\t \n#define LPFC_IO_WAKE\t\t2\t \n#define LPFC_IO_WAKE_TMO\tLPFC_IO_WAKE  \n#define LPFC_IO_FCP\t\t4\t \n#define LPFC_DRIVER_ABORTED\t8\t \n#define LPFC_IO_FABRIC\t\t0x10\t \n#define LPFC_DELAY_MEM_FREE\t0x20     \n#define LPFC_EXCHANGE_BUSY\t0x40     \n#define LPFC_USE_FCPWQIDX\t0x80     \n#define DSS_SECURITY_OP\t\t0x100\t \n#define LPFC_IO_ON_TXCMPLQ\t0x200\t \n#define LPFC_IO_DIF_PASS\t0x400\t \n#define LPFC_IO_DIF_STRIP\t0x800\t \n#define LPFC_IO_DIF_INSERT\t0x1000\t \n#define LPFC_IO_CMD_OUTSTANDING\t0x2000  \n\n#define LPFC_FIP_ELS_ID_MASK\t0xc000\t \n#define LPFC_FIP_ELS_ID_SHIFT\t14\n\n#define LPFC_IO_OAS\t\t0x10000  \n#define LPFC_IO_FOF\t\t0x20000  \n#define LPFC_IO_LOOPBACK\t0x40000  \n#define LPFC_PRLI_NVME_REQ\t0x80000  \n#define LPFC_PRLI_FCP_REQ\t0x100000  \n#define LPFC_IO_NVME\t        0x200000  \n#define LPFC_IO_NVME_LS\t\t0x400000  \n#define LPFC_IO_NVMET\t\t0x800000  \n#define LPFC_IO_VMID            0x1000000  \n#define LPFC_IO_CMF\t\t0x4000000  \n\n\tuint32_t drvrTimeout;\t \n\tstruct lpfc_vport *vport; \n\tstruct lpfc_dmabuf *cmd_dmabuf;\n\tstruct lpfc_dmabuf *rsp_dmabuf;\n\tstruct lpfc_dmabuf *bpl_dmabuf;\n\tuint32_t event_tag;\t \n\tunion {\n\t\twait_queue_head_t    *wait_queue;\n\t\tstruct lpfcMboxq     *mbox;\n\t\tstruct lpfc_node_rrq *rrq;\n\t\tstruct nvmefc_ls_req *nvme_lsreq;\n\t\tstruct lpfc_async_xchg_ctx *axchg;\n\t\tstruct bsg_job_data *dd_data;\n\t} context_un;\n\n\tstruct lpfc_io_buf *io_buf;\n\tstruct lpfc_iocbq *rsp_iocb;\n\tstruct lpfc_nodelist *ndlp;\n\tunion lpfc_vmid_tag vmid_tag;\n\tvoid (*fabric_cmd_cmpl)(struct lpfc_hba *phba, struct lpfc_iocbq *cmd,\n\t\t\t\tstruct lpfc_iocbq *rsp);\n\tvoid (*wait_cmd_cmpl)(struct lpfc_hba *phba, struct lpfc_iocbq *cmd,\n\t\t\t      struct lpfc_iocbq *rsp);\n\tvoid (*cmd_cmpl)(struct lpfc_hba *phba, struct lpfc_iocbq *cmd,\n\t\t\t struct lpfc_iocbq *rsp);\n};\n\n#define SLI_IOCB_RET_IOCB      1\t \n\n#define IOCB_SUCCESS        0\n#define IOCB_BUSY           1\n#define IOCB_ERROR          2\n#define IOCB_TIMEDOUT       3\n#define IOCB_ABORTED        4\n#define IOCB_ABORTING\t    5\n#define IOCB_NORESOURCE\t    6\n\n#define SLI_WQE_RET_WQE    1     \n\n#define WQE_SUCCESS        0\n#define WQE_BUSY           1\n#define WQE_ERROR          2\n#define WQE_TIMEDOUT       3\n#define WQE_ABORTED        4\n#define WQE_ABORTING\t   5\n#define WQE_NORESOURCE\t   6\n\n#define LPFC_MBX_WAKE\t\t1\n#define LPFC_MBX_IMED_UNREG\t2\n\ntypedef struct lpfcMboxq {\n\t \n\tstruct list_head list;\t \n\tunion {\n\t\tMAILBOX_t mb;\t\t \n\t\tstruct lpfc_mqe mqe;\n\t} u;\n\tstruct lpfc_vport *vport;  \n\tvoid *ctx_ndlp;\t\t   \n\tvoid *ctx_buf;\t\t   \n\tvoid *context3;\n\n\tvoid (*mbox_cmpl) (struct lpfc_hba *, struct lpfcMboxq *);\n\tuint8_t mbox_flag;\n\tuint16_t in_ext_byte_len;\n\tuint16_t out_ext_byte_len;\n\tuint8_t  mbox_offset_word;\n\tstruct lpfc_mcqe mcqe;\n\tstruct lpfc_mbx_nembed_sge_virt *sge_array;\n} LPFC_MBOXQ_t;\n\n#define MBX_POLL        1\t \n#define MBX_NOWAIT      2\t \n\n#define LPFC_MAX_RING_MASK  5\t \n#define LPFC_SLI3_MAX_RING  4\t \n\nstruct lpfc_sli_ring;\n\nstruct lpfc_sli_ring_mask {\n\tuint8_t profile;\t \n\tuint8_t rctl;\t \n\tuint8_t type;\t \n\tuint8_t rsvd;\n\t \n\tvoid (*lpfc_sli_rcv_unsol_event) (struct lpfc_hba *,\n\t\t\t\t\t struct lpfc_sli_ring *,\n\t\t\t\t\t struct lpfc_iocbq *);\n};\n\n\n \nstruct lpfc_sli_ring_stat {\n\tuint64_t iocb_event;\t  \n\tuint64_t iocb_cmd;\t  \n\tuint64_t iocb_rsp;\t  \n\tuint64_t iocb_cmd_delay;  \n\tuint64_t iocb_cmd_full;\t  \n\tuint64_t iocb_cmd_empty;  \n\tuint64_t iocb_rsp_full;\t  \n};\n\nstruct lpfc_sli3_ring {\n\tuint32_t local_getidx;   \n\tuint32_t next_cmdidx;    \n\tuint32_t rspidx;\t \n\tuint32_t cmdidx;\t \n\tuint16_t numCiocb;\t \n\tuint16_t numRiocb;\t \n\tuint16_t sizeCiocb;\t \n\tuint16_t sizeRiocb;\t \n\tuint32_t *cmdringaddr;\t \n\tuint32_t *rspringaddr;\t \n};\n\nstruct lpfc_sli4_ring {\n\tstruct lpfc_queue *wqp;\t \n};\n\n\n \nstruct lpfc_sli_ring {\n\tuint16_t flag;\t\t \n#define LPFC_DEFERRED_RING_EVENT 0x001\t \n#define LPFC_CALL_RING_AVAILABLE 0x002\t \n#define LPFC_STOP_IOCB_EVENT     0x020\t \n\tuint16_t abtsiotag;\t \n\n\tuint8_t rsvd;\n\tuint8_t ringno;\t\t \n\n\tspinlock_t ring_lock;\t \n\n\tuint32_t fast_iotag;\t \n\tuint32_t iotag_ctr;\t \n\tuint32_t iotag_max;\t \n\tstruct list_head txq;\n\tuint16_t txq_cnt;\t \n\tuint16_t txq_max;\t \n\tstruct list_head txcmplq;\n\tuint16_t txcmplq_cnt;\t \n\tuint16_t txcmplq_max;\t \n\tuint32_t missbufcnt;\t \n\tstruct list_head postbufq;\n\tuint16_t postbufq_cnt;\t \n\tuint16_t postbufq_max;\t \n\tstruct list_head iocb_continueq;\n\tuint16_t iocb_continueq_cnt;\t \n\tuint16_t iocb_continueq_max;\t \n\tstruct list_head iocb_continue_saveq;\n\n\tstruct lpfc_sli_ring_mask prt[LPFC_MAX_RING_MASK];\n\tuint32_t num_mask;\t \n\tvoid (*lpfc_sli_rcv_async_status) (struct lpfc_hba *,\n\t\tstruct lpfc_sli_ring *, struct lpfc_iocbq *);\n\n\tstruct lpfc_sli_ring_stat stats;\t \n\n\t \n\tvoid (*lpfc_sli_cmd_available) (struct lpfc_hba *,\n\t\t\t\t\tstruct lpfc_sli_ring *);\n\tunion {\n\t\tstruct lpfc_sli3_ring sli3;\n\t\tstruct lpfc_sli4_ring sli4;\n\t} sli;\n};\n\n \nstruct lpfc_hbq_init {\n\tuint32_t rn;\t\t \n\tuint32_t entry_count;\t \n\tuint32_t headerLen;\t \n\tuint32_t logEntry;\t \n\tuint32_t profile;\t \n\tuint32_t ring_mask;\t \n\tuint32_t hbq_index;\t \n\n\tuint32_t seqlenoff;\n\tuint32_t maxlen;\n\tuint32_t seqlenbcnt;\n\tuint32_t cmdcodeoff;\n\tuint32_t cmdmatch[8];\n\tuint32_t mask_count;\t \n\tstruct hbq_mask hbqMasks[6];\n\n\t \n\tuint32_t buffer_count;\t \n\tuint32_t init_count;\t \n\tuint32_t add_count;\t \n} ;\n\n \nstruct lpfc_sli_stat {\n\tuint64_t mbox_stat_err;   \n\tuint64_t mbox_cmd;        \n\tuint64_t sli_intr;        \n\tuint64_t sli_prev_intr;   \n\tuint64_t sli_ips;         \n\tuint32_t err_attn_event;  \n\tuint32_t link_event;      \n\tuint32_t mbox_event;      \n\tuint32_t mbox_busy;\t  \n};\n\n \nstruct lpfc_lnk_stat {\n\tuint32_t link_failure_count;\n\tuint32_t loss_of_sync_count;\n\tuint32_t loss_of_signal_count;\n\tuint32_t prim_seq_protocol_err_count;\n\tuint32_t invalid_tx_word_count;\n\tuint32_t invalid_crc_count;\n\tuint32_t error_frames;\n\tuint32_t link_events;\n};\n\n \nstruct lpfc_sli {\n\tuint32_t num_rings;\n\tuint32_t sli_flag;\n\n\t \n#define LPFC_SLI_MBOX_ACTIVE      0x100\t \n#define LPFC_SLI_ACTIVE           0x200\t \n#define LPFC_PROCESS_LA           0x400\t \n#define LPFC_BLOCK_MGMT_IO        0x800\t \n#define LPFC_SLI_ASYNC_MBX_BLK    0x2000  \n#define LPFC_SLI_SUPPRESS_RSP     0x4000  \n#define LPFC_SLI_USE_EQDR         0x8000  \n#define LPFC_QUEUE_FREE_INIT\t  0x10000  \n#define LPFC_QUEUE_FREE_WAIT\t  0x20000  \n\n\tstruct lpfc_sli_ring *sli3_ring;\n\n\tstruct lpfc_sli_stat slistat;\t \n\tstruct list_head mboxq;\n\tuint16_t mboxq_cnt;\t \n\tuint16_t mboxq_max;\t \n\tLPFC_MBOXQ_t *mbox_active;\t \n\tstruct list_head mboxq_cmpl;\n\n\tstruct timer_list mbox_tmo;\t \n\n#define LPFC_IOCBQ_LOOKUP_INCREMENT  1024\n\tstruct lpfc_iocbq ** iocbq_lookup;  \n\tsize_t iocbq_lookup_len;            \n\tuint16_t  last_iotag;               \n\ttime64_t  stats_start;\t\t    \n\tstruct lpfc_lnk_stat lnk_stat_offsets;\n};\n\n \n#define LPFC_MBOX_TMO\t\t\t\t30\n \n#define LPFC_MBOX_SLI4_CONFIG_TMO\t\t60\n \n#define LPFC_MBOX_SLI4_CONFIG_EXTENDED_TMO\t300\n \n#define LPFC_MBOX_TMO_FLASH_CMD\t\t\t300\n\nstruct lpfc_io_buf {\n\t \n\tstruct list_head list;\n\tvoid *data;\n\n\tdma_addr_t dma_handle;\n\tdma_addr_t dma_phys_sgl;\n\n\tstruct sli4_sge *dma_sgl;  \n\n\t \n\tstruct list_head dma_sgl_xtra_list;\n\n\t \n\tstruct list_head dma_cmd_rsp_list;\n\n\tstruct lpfc_iocbq cur_iocbq;\n\tstruct lpfc_sli4_hdw_queue *hdwq;\n\tuint16_t hdwq_no;\n\tuint16_t cpu;\n\n\tstruct lpfc_nodelist *ndlp;\n\tuint32_t timeout;\n\tuint16_t flags;\n#define LPFC_SBUF_XBUSY\t\t0x1\t \n#define LPFC_SBUF_BUMP_QDEPTH\t0x2\t \n\t\t\t\t\t \n#define LPFC_SBUF_NORMAL_DIF\t0x4\t \n#define LPFC_SBUF_PASS_DIF\t0x8\t \n#define LPFC_SBUF_NOT_POSTED    0x10     \n\tuint16_t status;\t \n\tuint32_t result;\t \n\n\tuint32_t   seg_cnt;\t \n\tunsigned long start_time;\n\tspinlock_t buf_lock;\t \n\tbool expedite;\t\t \n\n\tunion {\n\t\t \n\t\tstruct {\n\t\t\tstruct scsi_cmnd *pCmd;\n\t\t\tstruct lpfc_rport_data *rdata;\n\t\t\tuint32_t prot_seg_cnt;   \n\n\t\t\t \n\t\t\tstruct fcp_cmnd *fcp_cmnd;\n\t\t\tstruct fcp_rsp *fcp_rsp;\n\n\t\t\twait_queue_head_t *waitq;\n\n#ifdef CONFIG_SCSI_LPFC_DEBUG_FS\n\t\t\t \n\t\t\tvoid *prot_data_segment;\n\t\t\tuint32_t prot_data;\n\t\t\tuint32_t prot_data_type;\n#define\tLPFC_INJERR_REFTAG\t1\n#define\tLPFC_INJERR_APPTAG\t2\n#define\tLPFC_INJERR_GUARD\t3\n#endif\n\t\t};\n\n\t\t \n\t\tstruct {\n\t\t\tstruct nvmefc_fcp_req *nvmeCmd;\n\t\t\tuint16_t qidx;\n\t\t};\n\t};\n#ifdef CONFIG_SCSI_LPFC_DEBUG_FS\n\tuint64_t ts_cmd_start;\n\tuint64_t ts_last_cmd;\n\tuint64_t ts_cmd_wqput;\n\tuint64_t ts_isr_cmpl;\n\tuint64_t ts_data_io;\n#endif\n\tuint64_t rx_cmd_start;\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}