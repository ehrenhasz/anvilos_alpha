{
  "module_name": "megaraid_sas_debugfs.c",
  "hash_id": "8f2e4711b8f97505748e0ec2e117f5da0cbfd9f877a61acc8bfb86e0d6a48953",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/megaraid/megaraid_sas_debugfs.c",
  "human_readable_source": " \n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/pci.h>\n#include <linux/interrupt.h>\n#include <linux/compat.h>\n#include <linux/irq_poll.h>\n\n#include <scsi/scsi.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_host.h>\n\n#include \"megaraid_sas_fusion.h\"\n#include \"megaraid_sas.h\"\n\n#ifdef CONFIG_DEBUG_FS\n#include <linux/debugfs.h>\n\nstruct dentry *megasas_debugfs_root;\n\nstatic ssize_t\nmegasas_debugfs_read(struct file *filp, char __user *ubuf, size_t cnt,\n\t\t      loff_t *ppos)\n{\n\tstruct megasas_debugfs_buffer *debug = filp->private_data;\n\n\tif (!debug || !debug->buf)\n\t\treturn 0;\n\n\treturn simple_read_from_buffer(ubuf, cnt, ppos, debug->buf, debug->len);\n}\n\nstatic int\nmegasas_debugfs_raidmap_open(struct inode *inode, struct file *file)\n{\n\tstruct megasas_instance *instance = inode->i_private;\n\tstruct megasas_debugfs_buffer *debug;\n\tstruct fusion_context *fusion;\n\n\tfusion = instance->ctrl_context;\n\n\tdebug = kzalloc(sizeof(struct megasas_debugfs_buffer), GFP_KERNEL);\n\tif (!debug)\n\t\treturn -ENOMEM;\n\n\tdebug->buf = (void *)fusion->ld_drv_map[(instance->map_id & 1)];\n\tdebug->len = fusion->drv_map_sz;\n\tfile->private_data = debug;\n\n\treturn 0;\n}\n\nstatic int\nmegasas_debugfs_release(struct inode *inode, struct file *file)\n{\n\tstruct megasas_debug_buffer *debug = file->private_data;\n\n\tif (!debug)\n\t\treturn 0;\n\n\tfile->private_data = NULL;\n\tkfree(debug);\n\treturn 0;\n}\n\nstatic const struct file_operations megasas_debugfs_raidmap_fops = {\n\t.owner\t\t= THIS_MODULE,\n\t.open           = megasas_debugfs_raidmap_open,\n\t.read           = megasas_debugfs_read,\n\t.release        = megasas_debugfs_release,\n};\n\n \nvoid megasas_init_debugfs(void)\n{\n\tmegasas_debugfs_root = debugfs_create_dir(\"megaraid_sas\", NULL);\n\tif (!megasas_debugfs_root)\n\t\tpr_info(\"Cannot create debugfs root\\n\");\n}\n\n \nvoid megasas_exit_debugfs(void)\n{\n\tdebugfs_remove_recursive(megasas_debugfs_root);\n}\n\n \nvoid\nmegasas_setup_debugfs(struct megasas_instance *instance)\n{\n\tchar name[64];\n\tstruct fusion_context *fusion;\n\n\tfusion = instance->ctrl_context;\n\n\tif (fusion) {\n\t\tsnprintf(name, sizeof(name),\n\t\t\t \"scsi_host%d\", instance->host->host_no);\n\t\tif (!instance->debugfs_root) {\n\t\t\tinstance->debugfs_root =\n\t\t\t\tdebugfs_create_dir(name, megasas_debugfs_root);\n\t\t\tif (!instance->debugfs_root) {\n\t\t\t\tdev_err(&instance->pdev->dev,\n\t\t\t\t\t\"Cannot create per adapter debugfs directory\\n\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tsnprintf(name, sizeof(name), \"raidmap_dump\");\n\t\tinstance->raidmap_dump =\n\t\t\tdebugfs_create_file(name, S_IRUGO,\n\t\t\t\t\t    instance->debugfs_root, instance,\n\t\t\t\t\t    &megasas_debugfs_raidmap_fops);\n\t\tif (!instance->raidmap_dump) {\n\t\t\tdev_err(&instance->pdev->dev,\n\t\t\t\t\"Cannot create raidmap debugfs file\\n\");\n\t\t\tdebugfs_remove(instance->debugfs_root);\n\t\t\treturn;\n\t\t}\n\t}\n\n}\n\n \nvoid megasas_destroy_debugfs(struct megasas_instance *instance)\n{\n\tdebugfs_remove_recursive(instance->debugfs_root);\n}\n\n#else\nvoid megasas_init_debugfs(void)\n{\n}\nvoid megasas_exit_debugfs(void)\n{\n}\nvoid megasas_setup_debugfs(struct megasas_instance *instance)\n{\n}\nvoid megasas_destroy_debugfs(struct megasas_instance *instance)\n{\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}