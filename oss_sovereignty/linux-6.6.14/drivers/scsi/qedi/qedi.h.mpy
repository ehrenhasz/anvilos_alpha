{
  "module_name": "qedi.h",
  "hash_id": "7f8c19ec7d7128797234e2eaac5a816c62725af93e737254e7f01e22b6f557d5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/qedi/qedi.h",
  "human_readable_source": " \n \n\n#ifndef _QEDI_H_\n#define _QEDI_H_\n\n#define __PREVENT_QED_HSI__\n\n#include <scsi/scsi_transport_iscsi.h>\n#include <scsi/libiscsi.h>\n#include <scsi/scsi_host.h>\n#include <linux/uio_driver.h>\n\n#include \"qedi_hsi.h\"\n#include <linux/qed/qed_if.h>\n#include \"qedi_dbg.h\"\n#include <linux/qed/qed_iscsi_if.h>\n#include <linux/qed/qed_ll2_if.h>\n#include \"qedi_version.h\"\n#include \"qedi_nvm_iscsi_cfg.h\"\n\n#define QEDI_MODULE_NAME\t\t\"qedi\"\n\nstruct qedi_endpoint;\n\n#ifndef GET_FIELD2\n#define GET_FIELD2(value, name) \\\n\t(((value) & (name ## _MASK)) >> (name ## _OFFSET))\n#endif\n\n \n#define QEDI_MODE_NORMAL\t0\n#define QEDI_MODE_RECOVERY\t1\n#define QEDI_MODE_SHUTDOWN\t2\n\n#define ISCSI_WQE_SET_PTU_INVALIDATE\t1\n#define QEDI_MAX_ISCSI_TASK\t\t4096\n#define QEDI_MAX_TASK_NUM\t\t0x0FFF\n#define QEDI_MAX_ISCSI_CONNS_PER_HBA\t1024\n#define QEDI_ISCSI_MAX_BDS_PER_CMD\t255\t \n#define MAX_OUTSTANDING_TASKS_PER_CON\t1024\n\n#define QEDI_MAX_BD_LEN\t\t0xffff\n#define QEDI_BD_SPLIT_SZ\t0x1000\n#define QEDI_PAGE_SIZE\t\t4096\n#define QEDI_FAST_SGE_COUNT\t4\n \n#define MAX_SGLEN_FOR_CACHESGL\t((1U << 16) - 1)\n\n#define MIN_NUM_CPUS_MSIX(x)\tmin_t(u32, x->dev_info.num_cqs, \\\n\t\t\t\t\tnum_online_cpus())\n\n#define QEDI_LOCAL_PORT_MIN     60000\n#define QEDI_LOCAL_PORT_MAX     61024\n#define QEDI_LOCAL_PORT_RANGE   (QEDI_LOCAL_PORT_MAX - QEDI_LOCAL_PORT_MIN)\n#define QEDI_LOCAL_PORT_INVALID\t0xffff\n#define TX_RX_RING\t\t16\n#define RX_RING\t\t\t(TX_RX_RING - 1)\n#define QEDI_PAGE_ALIGN(addr)\tALIGN(addr, QEDI_PAGE_SIZE)\n#define QEDI_PAGE_MASK\t\t(~((QEDI_PAGE_SIZE) - 1))\n\n#define QEDI_HW_DMA_BOUNDARY\t0xfff\n#define QEDI_PATH_HANDLE\t0xFE0000000UL\n\nenum qedi_nvm_tgts {\n\tQEDI_NVM_TGT_PRI,\n\tQEDI_NVM_TGT_SEC,\n};\n\nstruct qedi_nvm_iscsi_image {\n\tstruct nvm_iscsi_cfg iscsi_cfg;\n\tu32 crc;\n};\n\nstruct qedi_uio_ctrl {\n\t \n\tu32 uio_hsi_version;\n\n\t \n\tu32 host_tx_prod;\n\tu32 host_rx_cons;\n\tu32 host_rx_bd_cons;\n\tu32 host_tx_pkt_len;\n\tu32 host_rx_cons_cnt;\n\n\t \n\tu32 hw_tx_cons;\n\tu32 hw_rx_prod;\n\tu32 hw_rx_bd_prod;\n\tu32 hw_rx_prod_cnt;\n\n\t \n\tu8 mac_addr[6];\n\tu8 reserve[2];\n};\n\nstruct qedi_rx_bd {\n\tu32 rx_pkt_index;\n\tu32 rx_pkt_len;\n\tu16 vlan_id;\n};\n\n#define QEDI_RX_DESC_CNT\t(QEDI_PAGE_SIZE / sizeof(struct qedi_rx_bd))\n#define QEDI_MAX_RX_DESC_CNT\t(QEDI_RX_DESC_CNT - 1)\n#define QEDI_NUM_RX_BD\t\t(QEDI_RX_DESC_CNT * 1)\n#define QEDI_MAX_RX_BD\t\t(QEDI_NUM_RX_BD - 1)\n\n#define QEDI_NEXT_RX_IDX(x)\t((((x) & (QEDI_MAX_RX_DESC_CNT)) ==\t\\\n\t\t\t\t  (QEDI_MAX_RX_DESC_CNT - 1)) ?\t\t\\\n\t\t\t\t (x) + 2 : (x) + 1)\n\nstruct qedi_uio_dev {\n\tstruct uio_info\t\tqedi_uinfo;\n\tu32\t\t\tuio_dev;\n\tstruct list_head\tlist;\n\n\tu32\t\t\tll2_ring_size;\n\tvoid\t\t\t*ll2_ring;\n\n\tu32\t\t\tll2_buf_size;\n\tvoid\t\t\t*ll2_buf;\n\n\tvoid\t\t\t*rx_pkt;\n\tvoid\t\t\t*tx_pkt;\n\n\tstruct qedi_ctx\t\t*qedi;\n\tstruct pci_dev\t\t*pdev;\n\tvoid\t\t\t*uctrl;\n};\n\n \nstruct skb_work_list {\n\tstruct list_head list;\n\tstruct sk_buff *skb;\n\tu16 vlan_id;\n};\n\n \n#define QEDI_SQ_SIZE\t\tMAX_OUTSTANDING_TASKS_PER_CON\n#define QEDI_CQ_SIZE\t\t2048\n#define QEDI_CMDQ_SIZE\t\tQEDI_MAX_ISCSI_TASK\n#define QEDI_PROTO_CQ_PROD_IDX\t0\n\nstruct qedi_glbl_q_params {\n\tu64 hw_p_cq;\t \n\tu64 hw_p_rq;\t \n\tu64 hw_p_cmdq;\t \n};\n\nstruct global_queue {\n\tunion iscsi_cqe *cq;\n\tdma_addr_t cq_dma;\n\tu32 cq_mem_size;\n\tu32 cq_cons_idx;  \n\n\tvoid *cq_pbl;\n\tdma_addr_t cq_pbl_dma;\n\tu32 cq_pbl_size;\n\n};\n\nstruct qedi_fastpath {\n\tstruct qed_sb_info\t*sb_info;\n\tu16\t\t\tsb_id;\n#define QEDI_NAME_SIZE\t\t16\n\tchar\t\t\tname[QEDI_NAME_SIZE];\n\tstruct qedi_ctx         *qedi;\n};\n\n \nstruct qedi_io_work {\n\tstruct list_head list;\n\tstruct iscsi_cqe_solicited cqe;\n\tu16\tque_idx;\n};\n\n \nstruct iscsi_cid_queue {\n\tvoid *cid_que_base;\n\tu32 *cid_que;\n\tu32 cid_q_prod_idx;\n\tu32 cid_q_cons_idx;\n\tu32 cid_q_max_idx;\n\tu32 cid_free_cnt;\n\tstruct qedi_conn **conn_cid_tbl;\n};\n\nstruct qedi_portid_tbl {\n\tspinlock_t      lock;\t \n\tu16             start;\n\tu16             max;\n\tu16             next;\n\tunsigned long   *table;\n};\n\nstruct qedi_itt_map {\n\t__le32\titt;\n\tstruct qedi_cmd *p_cmd;\n};\n\n \n#define QEDI_IO_TRACE_SIZE             2048\nstruct qedi_io_log {\n#define QEDI_IO_TRACE_REQ              0\n#define QEDI_IO_TRACE_RSP              1\n\tu8 direction;\n\tu16 task_id;\n\tu32 cid;\n\tu32 port_id;\t \n\tint lun;\n\tu8 op;\t\t \n\tu8 lba[4];\n\tunsigned int bufflen;\t \n\tunsigned int sg_count;\t \n\tu8 fast_sgs;\t\t \n\tu8 slow_sgs;\t\t \n\tu8 cached_sgs;\t\t \n\tint result;\t\t \n\tunsigned long jiffies;\t \n\tint refcount;\t\t \n\tunsigned int blk_req_cpu;  \n\tunsigned int req_cpu;\t \n\tunsigned int intr_cpu;\t \n\tunsigned int blk_rsp_cpu; \n\tbool cached_sge;\n\tbool slow_sge;\n\tbool fast_sge;\n};\n\n \n#define QEDI_BDQ_NUM\t\t256\n#define QEDI_BDQ_BUF_SIZE\t256\n\n \nstruct qedi_bdq_buf {\n\tvoid *buf_addr;\n\tdma_addr_t buf_dma;\n};\n\n \nstruct qedi_ctx {\n\tstruct qedi_dbg_ctx dbg_ctx;\n\tstruct Scsi_Host *shost;\n\tstruct pci_dev *pdev;\n\tstruct qed_dev *cdev;\n\tstruct qed_dev_iscsi_info dev_info;\n\tstruct qed_int_info int_info;\n\tstruct qedi_glbl_q_params *p_cpuq;\n\tstruct global_queue **global_queues;\n\t \n\tstruct qedi_uio_dev *udev;\n\tstruct list_head ll2_skb_list;\n\tspinlock_t ll2_lock;\t \n\tspinlock_t hba_lock;\t \n\tstruct task_struct *ll2_recv_thread;\n\tunsigned long qedi_err_flags;\n#define QEDI_ERR_ATTN_CLR_EN\t0\n#define QEDI_ERR_IS_RECOVERABLE\t2\n#define QEDI_ERR_OVERRIDE_EN\t31\n\tunsigned long flags;\n#define UIO_DEV_OPENED\t\t1\n#define QEDI_IOTHREAD_WAKE\t2\n#define QEDI_IN_RECOVERY\t5\n#define QEDI_IN_OFFLINE\t\t6\n#define QEDI_IN_SHUTDOWN\t7\n#define QEDI_BLOCK_IO\t\t8\n\n\tu8 mac[ETH_ALEN];\n\tu32 src_ip[4];\n\tu8 ip_type;\n\n\t \n\tdma_addr_t hw_p_cpuq;\n\n\tstruct qedi_bdq_buf bdq[QEDI_BDQ_NUM];\n\tvoid *bdq_pbl;\n\tdma_addr_t bdq_pbl_dma;\n\tsize_t bdq_pbl_mem_size;\n\tvoid *bdq_pbl_list;\n\tdma_addr_t bdq_pbl_list_dma;\n\tu8 bdq_pbl_list_num_entries;\n\tstruct qedi_nvm_iscsi_image *iscsi_image;\n\tdma_addr_t nvm_buf_dma;\n\tvoid __iomem *bdq_primary_prod;\n\tvoid __iomem *bdq_secondary_prod;\n\tu16 bdq_prod_idx;\n\tu16 rq_num_entries;\n\n\tu32 max_sqes;\n\tu8 num_queues;\n\tu32 max_active_conns;\n\ts32 msix_count;\n\n\tstruct iscsi_cid_queue cid_que;\n\tstruct qedi_endpoint **ep_tbl;\n\tstruct qedi_portid_tbl lcl_port_tbl;\n\n\t \n\tstruct qed_sb_info\t*sb_array;\n\tstruct qedi_fastpath\t*fp_array;\n\tstruct qed_iscsi_tid\ttasks;\n\n#define QEDI_LINK_DOWN\t\t0\n#define QEDI_LINK_UP\t\t1\n\tatomic_t link_state;\n\n#define QEDI_RESERVE_TASK_ID\t0\n#define MAX_ISCSI_TASK_ENTRIES\t4096\n#define QEDI_INVALID_TASK_ID\t(MAX_ISCSI_TASK_ENTRIES + 1)\n\tunsigned long task_idx_map[MAX_ISCSI_TASK_ENTRIES / BITS_PER_LONG];\n\tstruct qedi_itt_map *itt_map;\n\tu16 tid_reuse_count[QEDI_MAX_ISCSI_TASK];\n\tstruct qed_pf_params pf_params;\n\n\tstruct workqueue_struct *tmf_thread;\n\tstruct workqueue_struct *offload_thread;\n\n\tu16 ll2_mtu;\n\n\tstruct workqueue_struct *dpc_wq;\n\tstruct delayed_work recovery_work;\n\tstruct delayed_work board_disable_work;\n\n\tspinlock_t task_idx_lock;\t \n\ts32 last_tidx_alloc;\n\ts32 last_tidx_clear;\n\n\tstruct qedi_io_log io_trace_buf[QEDI_IO_TRACE_SIZE];\n\tspinlock_t io_trace_lock;\t \n\tu16 io_trace_idx;\n\tunsigned int intr_cpu;\n\tu32 cached_sgls;\n\tbool use_cached_sge;\n\tu32 slow_sgls;\n\tbool use_slow_sge;\n\tu32 fast_sgls;\n\tbool use_fast_sge;\n\n\tatomic_t num_offloads;\n#define SYSFS_FLAG_FW_SEL_BOOT 2\n#define IPV6_LEN\t41\n#define IPV4_LEN\t17\n\tstruct iscsi_boot_kset *boot_kset;\n\n\t \n\tstruct mutex stats_lock;\n};\n\nstruct qedi_work {\n\tstruct list_head list;\n\tstruct qedi_ctx *qedi;\n\tunion iscsi_cqe cqe;\n\tu16     que_idx;\n\tbool is_solicited;\n};\n\nstruct qedi_percpu_s {\n\tstruct task_struct *iothread;\n\tstruct list_head work_list;\n\tspinlock_t p_work_lock;\t\t \n};\n\nstatic inline void *qedi_get_task_mem(struct qed_iscsi_tid *info, u32 tid)\n{\n\treturn (info->blocks[tid / info->num_tids_per_block] +\n\t\t(tid % info->num_tids_per_block) * info->size);\n}\n\n#define QEDI_U64_HI(val) ((u32)(((u64)(val)) >> 32))\n#define QEDI_U64_LO(val) ((u32)(((u64)(val)) & 0xffffffff))\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}