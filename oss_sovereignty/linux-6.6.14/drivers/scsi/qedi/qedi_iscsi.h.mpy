{
  "module_name": "qedi_iscsi.h",
  "hash_id": "805e0568d3fde142ad8d6104cc936c5e768b52eaeaf591a1b4b8e28a99522d65",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/qedi/qedi_iscsi.h",
  "human_readable_source": " \n \n\n#ifndef _QEDI_ISCSI_H_\n#define _QEDI_ISCSI_H_\n\n#include <linux/socket.h>\n#include <linux/completion.h>\n#include \"qedi.h\"\n\n#define ISCSI_MAX_SESS_PER_HBA\t4096\n\n#define DEF_KA_TIMEOUT\t\t7200000\n#define DEF_KA_INTERVAL\t\t10000\n#define DEF_KA_MAX_PROBE_COUNT\t10\n#define DEF_TOS\t\t\t0\n#define DEF_TTL\t\t\t0xfe\n#define DEF_SND_SEQ_SCALE\t0\n#define DEF_RCV_BUF\t\t0xffff\n#define DEF_SND_BUF\t\t0xffff\n#define DEF_SEED\t\t0\n#define DEF_MAX_RT_TIME\t\t8000\n#define DEF_MAX_DA_COUNT        2\n#define DEF_SWS_TIMER\t\t1000\n#define DEF_MAX_CWND\t\t2\n#define DEF_PATH_MTU\t\t1500\n#define DEF_MSS\t\t\t1460\n#define DEF_LL2_MTU\t\t1560\n#define JUMBO_MTU\t\t9000\n\n#define MIN_MTU         576  \n#define IPV4_HDR_LEN    20\n#define IPV6_HDR_LEN    40\n#define TCP_HDR_LEN     20\n#define TCP_OPTION_LEN  12\n#define VLAN_LEN         4\n\nenum {\n\tEP_STATE_IDLE                   = 0x0,\n\tEP_STATE_ACQRCONN_START         = 0x1,\n\tEP_STATE_ACQRCONN_COMPL         = 0x2,\n\tEP_STATE_OFLDCONN_START         = 0x4,\n\tEP_STATE_OFLDCONN_COMPL         = 0x8,\n\tEP_STATE_DISCONN_START          = 0x10,\n\tEP_STATE_DISCONN_COMPL          = 0x20,\n\tEP_STATE_CLEANUP_START          = 0x40,\n\tEP_STATE_CLEANUP_CMPL           = 0x80,\n\tEP_STATE_TCP_FIN_RCVD           = 0x100,\n\tEP_STATE_TCP_RST_RCVD           = 0x200,\n\tEP_STATE_LOGOUT_SENT            = 0x400,\n\tEP_STATE_LOGOUT_RESP_RCVD       = 0x800,\n\tEP_STATE_CLEANUP_FAILED         = 0x1000,\n\tEP_STATE_OFLDCONN_FAILED        = 0x2000,\n\tEP_STATE_CONNECT_FAILED         = 0x4000,\n\tEP_STATE_DISCONN_TIMEDOUT       = 0x8000,\n\tEP_STATE_OFLDCONN_NONE          = 0x10000,\n};\n\nstruct qedi_conn;\n\nstruct qedi_endpoint {\n\tstruct qedi_ctx *qedi;\n\tu32 dst_addr[4];\n\tu32 src_addr[4];\n\tu16 src_port;\n\tu16 dst_port;\n\tu16 vlan_id;\n\tu16 pmtu;\n\tu8 src_mac[ETH_ALEN];\n\tu8 dst_mac[ETH_ALEN];\n\tu8 ip_type;\n\tint state;\n\twait_queue_head_t ofld_wait;\n\twait_queue_head_t tcp_ofld_wait;\n\tu32 iscsi_cid;\n\t \n\tu32 handle;\n\tu32 fw_cid;\n\tvoid __iomem *p_doorbell;\n\tstruct iscsi_db_data db_data;\n\n\t \n\tstruct iscsi_wqe *sq;\n\tdma_addr_t sq_dma;\n\n\tu16 sq_prod_idx;\n\tu16 fw_sq_prod_idx;\n\tu16 sq_con_idx;\n\tu32 sq_mem_size;\n\n\tvoid *sq_pbl;\n\tdma_addr_t sq_pbl_dma;\n\tu32 sq_pbl_size;\n\tstruct qedi_conn *conn;\n\tstruct work_struct offload_work;\n};\n\n#define QEDI_SQ_WQES_MIN\t16\n\nstruct qedi_io_bdt {\n\tstruct scsi_sge *sge_tbl;\n\tdma_addr_t sge_tbl_dma;\n\tu16 sge_valid;\n};\n\n \nstruct generic_pdu_resc {\n\tchar *req_buf;\n\tdma_addr_t req_dma_addr;\n\tu32 req_buf_size;\n\tchar *req_wr_ptr;\n\tstruct iscsi_hdr resp_hdr;\n\tchar *resp_buf;\n\tdma_addr_t resp_dma_addr;\n\tu32 resp_buf_size;\n\tchar *resp_wr_ptr;\n\tchar *req_bd_tbl;\n\tdma_addr_t req_bd_dma;\n\tchar *resp_bd_tbl;\n\tdma_addr_t resp_bd_dma;\n};\n\nstruct qedi_conn {\n\tstruct iscsi_cls_conn *cls_conn;\n\tstruct qedi_ctx *qedi;\n\tstruct qedi_endpoint *ep;\n\tstruct iscsi_endpoint *iscsi_ep;\n\tstruct list_head active_cmd_list;\n\tspinlock_t list_lock;\t\t \n\tu32 active_cmd_count;\n\tu32 cmd_cleanup_req;\n\tatomic_t cmd_cleanup_cmpl;\n\n\tu32 iscsi_conn_id;\n\tint itt;\n\tint abrt_conn;\n#define QEDI_CID_RESERVED\t0x5AFF\n\tu32 fw_cid;\n\t \n\tstruct generic_pdu_resc gen_pdu;\n\n\tstruct list_head tmf_work_list;\n\twait_queue_head_t wait_queue;\n\tspinlock_t tmf_work_lock;\t \n\tbool ep_disconnect_starting;\n\tint fw_cleanup_works;\n};\n\nstruct qedi_cmd {\n\tstruct list_head io_cmd;\n\tbool io_cmd_in_list;\n\tstruct iscsi_hdr hdr;\n\tstruct qedi_conn *conn;\n\tstruct scsi_cmnd *scsi_cmd;\n\tstruct scatterlist *sg;\n\tstruct qedi_io_bdt io_tbl;\n\tstruct iscsi_task_context request;\n\tunsigned char *sense_buffer;\n\tdma_addr_t sense_buffer_dma;\n\tu16 task_id;\n\n\t \n\tstruct iscsi_task *task;\n\tstruct work_struct tmf_work;\n\tint state;\n#define CLEANUP_WAIT\t1\n#define CLEANUP_RECV\t2\n#define CLEANUP_WAIT_FAILED\t3\n#define CLEANUP_NOT_REQUIRED\t4\n#define LUN_RESET_RESPONSE_RECEIVED\t5\n#define RESPONSE_RECEIVED\t6\n\n\tint type;\n#define TYPEIO\t\t1\n#define TYPERESET\t2\n\n\tstruct qedi_work_map *list_tmf_work;\n\t \n\tbool use_slowpath;\n\n\tstruct iscsi_tm_rsp *tmf_resp_buf;\n\tstruct qedi_work cqe_work;\n};\n\nstruct qedi_work_map {\n\tstruct list_head list;\n\tstruct qedi_cmd *qedi_cmd;\n\tstruct iscsi_task *ctask;\n\tint rtid;\n\n\tint state;\n#define QEDI_WORK_QUEUED\t1\n#define QEDI_WORK_SCHEDULED\t2\n#define QEDI_WORK_EXIT\t\t3\n\n\tstruct work_struct *ptr_tmf_work;\n};\n\nstruct qedi_boot_target {\n\tchar ip_addr[64];\n\tchar iscsi_name[255];\n\tu32 ipv6_en;\n};\n\n#define qedi_set_itt(task_id, itt) ((u32)(((task_id) & 0xffff) | ((itt) << 16)))\n#define qedi_get_itt(cqe) (cqe.iscsi_hdr.cmd.itt >> 16)\n\n#define QEDI_OFLD_WAIT_STATE(q) ((q)->state == EP_STATE_OFLDCONN_FAILED || \\\n\t\t\t\t(q)->state == EP_STATE_OFLDCONN_COMPL)\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}