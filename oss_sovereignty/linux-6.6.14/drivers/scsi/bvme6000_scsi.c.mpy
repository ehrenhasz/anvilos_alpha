{
  "module_name": "bvme6000_scsi.c",
  "hash_id": "ac75b956c4901b3c923fa7014c6447e4f68228c8a8394e7c13a648be012a1b10",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/bvme6000_scsi.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/blkdev.h>\n#include <linux/device.h>\n#include <linux/platform_device.h>\n#include <linux/init.h>\n#include <linux/interrupt.h>\n#include <linux/slab.h>\n#include <asm/bvme6000hw.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_transport.h>\n#include <scsi/scsi_transport_spi.h>\n\n#include \"53c700.h\"\n\nMODULE_AUTHOR(\"Richard Hirst <richard@sleepie.demon.co.uk>\");\nMODULE_DESCRIPTION(\"BVME6000 NCR53C710 driver\");\nMODULE_LICENSE(\"GPL\");\n\nstatic struct scsi_host_template bvme6000_scsi_driver_template = {\n\t.name\t\t\t= \"BVME6000 NCR53c710 SCSI\",\n\t.proc_name\t\t= \"BVME6000\",\n\t.this_id\t\t= 7,\n\t.module\t\t\t= THIS_MODULE,\n};\n\nstatic struct platform_device *bvme6000_scsi_device;\n\nstatic int\nbvme6000_probe(struct platform_device *dev)\n{\n\tstruct Scsi_Host *host;\n\tstruct NCR_700_Host_Parameters *hostdata;\n\n\tif (!MACH_IS_BVME6000)\n\t\tgoto out;\n\n\thostdata = kzalloc(sizeof(struct NCR_700_Host_Parameters), GFP_KERNEL);\n\tif (!hostdata) {\n\t\tprintk(KERN_ERR \"bvme6000-scsi: \"\n\t\t\t\t\"Failed to allocate host data\\n\");\n\t\tgoto out;\n\t}\n\n\t \n\thostdata->base = (void __iomem *)BVME_NCR53C710_BASE;\n\thostdata->clock = 40;\t \n\thostdata->chip710 = 1;\n\thostdata->dmode_extra = DMODE_FC2;\n\thostdata->dcntl_extra = EA_710;\n\thostdata->ctest7_extra = CTEST7_TT1;\n\n\t \n\thost = NCR_700_detect(&bvme6000_scsi_driver_template, hostdata,\n\t\t\t      &dev->dev);\n\tif (!host) {\n\t\tprintk(KERN_ERR \"bvme6000-scsi: No host detected; \"\n\t\t\t\t\"board configuration problem?\\n\");\n\t\tgoto out_free;\n\t}\n\thost->base = BVME_NCR53C710_BASE;\n\thost->this_id = 7;\n\thost->irq = BVME_IRQ_SCSI;\n\tif (request_irq(BVME_IRQ_SCSI, NCR_700_intr, 0, \"bvme6000-scsi\",\n\t\t\thost)) {\n\t\tprintk(KERN_ERR \"bvme6000-scsi: request_irq failed\\n\");\n\t\tgoto out_put_host;\n\t}\n\n\tplatform_set_drvdata(dev, host);\n\tscsi_scan_host(host);\n\n\treturn 0;\n\n out_put_host:\n\tscsi_host_put(host);\n out_free:\n\tkfree(hostdata);\n out:\n\treturn -ENODEV;\n}\n\nstatic int\nbvme6000_device_remove(struct platform_device *dev)\n{\n\tstruct Scsi_Host *host = platform_get_drvdata(dev);\n\tstruct NCR_700_Host_Parameters *hostdata = shost_priv(host);\n\n\tscsi_remove_host(host);\n\tNCR_700_release(host);\n\tkfree(hostdata);\n\tfree_irq(host->irq, host);\n\n\treturn 0;\n}\n\nstatic struct platform_driver bvme6000_scsi_driver = {\n\t.driver = {\n\t\t.name\t\t= \"bvme6000-scsi\",\n\t},\n\t.probe\t\t= bvme6000_probe,\n\t.remove\t\t= bvme6000_device_remove,\n};\n\nstatic int __init bvme6000_scsi_init(void)\n{\n\tint err;\n\n\terr = platform_driver_register(&bvme6000_scsi_driver);\n\tif (err)\n\t\treturn err;\n\n\tbvme6000_scsi_device = platform_device_register_simple(\"bvme6000-scsi\",\n\t\t\t\t\t\t\t       -1, NULL, 0);\n\tif (IS_ERR(bvme6000_scsi_device)) {\n\t\tplatform_driver_unregister(&bvme6000_scsi_driver);\n\t\treturn PTR_ERR(bvme6000_scsi_device);\n\t}\n\n\treturn 0;\n}\n\nstatic void __exit bvme6000_scsi_exit(void)\n{\n\tplatform_device_unregister(bvme6000_scsi_device);\n\tplatform_driver_unregister(&bvme6000_scsi_driver);\n}\n\nmodule_init(bvme6000_scsi_init);\nmodule_exit(bvme6000_scsi_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}