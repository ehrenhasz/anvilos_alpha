{
  "module_name": "ipr.h",
  "hash_id": "1bcaa182af6fd48c619d9fc39d366b4a24fb5c473c29bec982320d4949a74d45",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/ipr.h",
  "human_readable_source": " \n \n\n#ifndef _IPR_H\n#define _IPR_H\n\n#include <asm/unaligned.h>\n#include <linux/types.h>\n#include <linux/completion.h>\n#include <linux/list.h>\n#include <linux/kref.h>\n#include <linux/irq_poll.h>\n#include <scsi/scsi.h>\n#include <scsi/scsi_cmnd.h>\n\n \n#define IPR_DRIVER_VERSION \"2.6.4\"\n#define IPR_DRIVER_DATE \"(March 14, 2017)\"\n\n \n#define IPR_MAX_CMD_PER_LUN\t\t\t\t6\n\n \n#define IPR_NUM_BASE_CMD_BLKS\t\t\t(ioa_cfg->max_cmds)\n\n#define PCI_DEVICE_ID_IBM_OBSIDIAN_E\t0x0339\n\n#define PCI_DEVICE_ID_IBM_CROC_FPGA_E2          0x033D\n#define PCI_DEVICE_ID_IBM_CROCODILE             0x034A\n#define PCI_DEVICE_ID_IBM_RATTLESNAKE\t\t0x04DA\n\n#define IPR_SUBS_DEV_ID_2780\t0x0264\n#define IPR_SUBS_DEV_ID_5702\t0x0266\n#define IPR_SUBS_DEV_ID_5703\t0x0278\n#define IPR_SUBS_DEV_ID_572E\t0x028D\n#define IPR_SUBS_DEV_ID_573E\t0x02D3\n#define IPR_SUBS_DEV_ID_573D\t0x02D4\n#define IPR_SUBS_DEV_ID_571A\t0x02C0\n#define IPR_SUBS_DEV_ID_571B\t0x02BE\n#define IPR_SUBS_DEV_ID_571E\t0x02BF\n#define IPR_SUBS_DEV_ID_571F\t0x02D5\n#define IPR_SUBS_DEV_ID_572A\t0x02C1\n#define IPR_SUBS_DEV_ID_572B\t0x02C2\n#define IPR_SUBS_DEV_ID_572F\t0x02C3\n#define IPR_SUBS_DEV_ID_574E\t0x030A\n#define IPR_SUBS_DEV_ID_575B\t0x030D\n#define IPR_SUBS_DEV_ID_575C\t0x0338\n#define IPR_SUBS_DEV_ID_57B3\t0x033A\n#define IPR_SUBS_DEV_ID_57B7\t0x0360\n#define IPR_SUBS_DEV_ID_57B8\t0x02C2\n\n#define IPR_SUBS_DEV_ID_57B4    0x033B\n#define IPR_SUBS_DEV_ID_57B2    0x035F\n#define IPR_SUBS_DEV_ID_57C0    0x0352\n#define IPR_SUBS_DEV_ID_57C3    0x0353\n#define IPR_SUBS_DEV_ID_57C4    0x0354\n#define IPR_SUBS_DEV_ID_57C6    0x0357\n#define IPR_SUBS_DEV_ID_57CC    0x035C\n\n#define IPR_SUBS_DEV_ID_57B5    0x033C\n#define IPR_SUBS_DEV_ID_57CE    0x035E\n#define IPR_SUBS_DEV_ID_57B1    0x0355\n\n#define IPR_SUBS_DEV_ID_574D    0x0356\n#define IPR_SUBS_DEV_ID_57C8    0x035D\n\n#define IPR_SUBS_DEV_ID_57D5    0x03FB\n#define IPR_SUBS_DEV_ID_57D6    0x03FC\n#define IPR_SUBS_DEV_ID_57D7    0x03FF\n#define IPR_SUBS_DEV_ID_57D8    0x03FE\n#define IPR_SUBS_DEV_ID_57D9    0x046D\n#define IPR_SUBS_DEV_ID_57DA    0x04CA\n#define IPR_SUBS_DEV_ID_57EB    0x0474\n#define IPR_SUBS_DEV_ID_57EC    0x0475\n#define IPR_SUBS_DEV_ID_57ED    0x0499\n#define IPR_SUBS_DEV_ID_57EE    0x049A\n#define IPR_SUBS_DEV_ID_57EF    0x049B\n#define IPR_SUBS_DEV_ID_57F0    0x049C\n#define IPR_SUBS_DEV_ID_2CCA\t0x04C7\n#define IPR_SUBS_DEV_ID_2CD2\t0x04C8\n#define IPR_SUBS_DEV_ID_2CCD\t0x04C9\n#define IPR_SUBS_DEV_ID_580A\t0x04FC\n#define IPR_SUBS_DEV_ID_580B\t0x04FB\n#define IPR_NAME\t\t\t\t\"ipr\"\n\n \n#define IPR_RC_JOB_CONTINUE\t\t1\n#define IPR_RC_JOB_RETURN\t\t2\n\n \n#define IPR_IOASC_NR_INIT_CMD_REQUIRED\t\t0x02040200\n#define IPR_IOASC_NR_IOA_RESET_REQUIRED\t\t0x02048000\n#define IPR_IOASC_SYNC_REQUIRED\t\t\t0x023f0000\n#define IPR_IOASC_MED_DO_NOT_REALLOC\t\t0x03110C00\n#define IPR_IOASC_HW_SEL_TIMEOUT\t\t\t0x04050000\n#define IPR_IOASC_HW_DEV_BUS_STATUS\t\t\t0x04448500\n#define\tIPR_IOASC_IOASC_MASK\t\t\t0xFFFFFF00\n#define\tIPR_IOASC_SCSI_STATUS_MASK\t\t0x000000FF\n#define IPR_IOASC_HW_CMD_FAILED\t\t\t0x046E0000\n#define IPR_IOASC_IR_INVALID_REQ_TYPE_OR_PKT\t0x05240000\n#define IPR_IOASC_IR_RESOURCE_HANDLE\t\t0x05250000\n#define IPR_IOASC_IR_NO_CMDS_TO_2ND_IOA\t\t0x05258100\n#define IPR_IOASA_IR_DUAL_IOA_DISABLED\t\t0x052C8000\n#define IPR_IOASC_BUS_WAS_RESET\t\t\t0x06290000\n#define IPR_IOASC_BUS_WAS_RESET_BY_OTHER\t\t0x06298000\n#define IPR_IOASC_ABORTED_CMD_TERM_BY_HOST\t0x0B5A0000\n#define IPR_IOASC_IR_NON_OPTIMIZED\t\t0x05258200\n\n#define IPR_FIRST_DRIVER_IOASC\t\t\t0x10000000\n#define IPR_IOASC_IOA_WAS_RESET\t\t\t0x10000001\n#define IPR_IOASC_PCI_ACCESS_ERROR\t\t\t0x10000002\n\n \n#define IPR_USE_LONG_TRANSOP_TIMEOUT\t\t0x00000001\n#define IPR_USE_PCI_WARM_RESET\t\t\t0x00000002\n\n#define IPR_DEFAULT_MAX_ERROR_DUMP\t\t\t984\n#define IPR_NUM_LOG_HCAMS\t\t\t\t2\n#define IPR_NUM_CFG_CHG_HCAMS\t\t\t\t2\n#define IPR_NUM_HCAM_QUEUE\t\t\t\t12\n#define IPR_NUM_HCAMS\t(IPR_NUM_LOG_HCAMS + IPR_NUM_CFG_CHG_HCAMS)\n#define IPR_MAX_HCAMS\t(IPR_NUM_HCAMS + IPR_NUM_HCAM_QUEUE)\n\n#define IPR_MAX_SIS64_TARGETS_PER_BUS\t\t\t1024\n#define IPR_MAX_SIS64_LUNS_PER_TARGET\t\t\t0xffffffff\n\n#define IPR_MAX_NUM_TARGETS_PER_BUS\t\t\t256\n#define IPR_MAX_NUM_LUNS_PER_TARGET\t\t\t256\n#define IPR_VSET_BUS\t\t\t\t\t0xff\n#define IPR_IOA_BUS\t\t\t\t\t\t0xff\n#define IPR_IOA_TARGET\t\t\t\t\t0xff\n#define IPR_IOA_LUN\t\t\t\t\t\t0xff\n#define IPR_MAX_NUM_BUSES\t\t\t\t16\n\n#define IPR_NUM_RESET_RELOAD_RETRIES\t\t3\n\n \n#define IPR_NUM_INTERNAL_CMD_BLKS\t(IPR_NUM_HCAMS + \\\n                                     ((IPR_NUM_RESET_RELOAD_RETRIES + 1) * 2) + 4)\n\n#define IPR_MAX_COMMANDS\t\t100\n#define IPR_NUM_CMD_BLKS\t\t(IPR_NUM_BASE_CMD_BLKS + \\\n\t\t\t\t\t\tIPR_NUM_INTERNAL_CMD_BLKS)\n\n#define IPR_MAX_PHYSICAL_DEVS\t\t\t\t192\n#define IPR_DEFAULT_SIS64_DEVS\t\t\t\t1024\n#define IPR_MAX_SIS64_DEVS\t\t\t\t4096\n\n#define IPR_MAX_SGLIST\t\t\t\t\t64\n#define IPR_IOA_MAX_SECTORS\t\t\t\t32767\n#define IPR_VSET_MAX_SECTORS\t\t\t\t512\n#define IPR_MAX_CDB_LEN\t\t\t\t\t16\n#define IPR_MAX_HRRQ_RETRIES\t\t\t\t3\n\n#define IPR_DEFAULT_BUS_WIDTH\t\t\t\t16\n#define IPR_80MBs_SCSI_RATE\t\t((80 * 10) / (IPR_DEFAULT_BUS_WIDTH / 8))\n#define IPR_U160_SCSI_RATE\t((160 * 10) / (IPR_DEFAULT_BUS_WIDTH / 8))\n#define IPR_U320_SCSI_RATE\t((320 * 10) / (IPR_DEFAULT_BUS_WIDTH / 8))\n#define IPR_MAX_SCSI_RATE(width) ((320 * 10) / ((width) / 8))\n\n#define IPR_IOA_RES_HANDLE\t\t\t\t0xffffffff\n#define IPR_INVALID_RES_HANDLE\t\t\t0\n#define IPR_IOA_RES_ADDR\t\t\t\t0x00ffffff\n\n \n#define IPR_CANCEL_REQUEST\t\t\t\t0xC0\n#define\tIPR_CANCEL_64BIT_IOARCB\t\t\t0x01\n#define IPR_QUERY_RSRC_STATE\t\t\t\t0xC2\n#define IPR_RESET_DEVICE\t\t\t\t0xC3\n#define\tIPR_RESET_TYPE_SELECT\t\t\t\t0x80\n#define\tIPR_LUN_RESET\t\t\t\t\t0x40\n#define\tIPR_TARGET_RESET\t\t\t\t\t0x20\n#define\tIPR_BUS_RESET\t\t\t\t\t0x10\n#define IPR_ID_HOST_RR_Q\t\t\t\t0xC4\n#define IPR_QUERY_IOA_CONFIG\t\t\t\t0xC5\n#define IPR_CANCEL_ALL_REQUESTS\t\t\t0xCE\n#define IPR_HOST_CONTROLLED_ASYNC\t\t\t0xCF\n#define\tIPR_HCAM_CDB_OP_CODE_CONFIG_CHANGE\t0x01\n#define\tIPR_HCAM_CDB_OP_CODE_LOG_DATA\t\t0x02\n#define IPR_SET_SUPPORTED_DEVICES\t\t\t0xFB\n#define IPR_SET_ALL_SUPPORTED_DEVICES\t\t\t0x80\n#define IPR_IOA_SHUTDOWN\t\t\t\t0xF7\n#define\tIPR_WR_BUF_DOWNLOAD_AND_SAVE\t\t\t0x05\n#define IPR_IOA_SERVICE_ACTION\t\t\t\t0xD2\n\n \n#define IPR_IOA_SA_CHANGE_CACHE_PARAMS\t\t\t0x14\n\n \n#define IPR_SHUTDOWN_TIMEOUT\t\t\t(ipr_fastfail ? 60 * HZ : 10 * 60 * HZ)\n#define IPR_VSET_RW_TIMEOUT\t\t\t(ipr_fastfail ? 30 * HZ : 2 * 60 * HZ)\n#define IPR_ABBREV_SHUTDOWN_TIMEOUT\t\t(10 * HZ)\n#define IPR_DUAL_IOA_ABBR_SHUTDOWN_TO\t(2 * 60 * HZ)\n#define IPR_DEVICE_RESET_TIMEOUT\t\t(ipr_fastfail ? 10 * HZ : 30 * HZ)\n#define IPR_CANCEL_TIMEOUT\t\t\t(ipr_fastfail ? 10 * HZ : 30 * HZ)\n#define IPR_CANCEL_ALL_TIMEOUT\t\t(ipr_fastfail ? 10 * HZ : 30 * HZ)\n#define IPR_ABORT_TASK_TIMEOUT\t\t(ipr_fastfail ? 10 * HZ : 30 * HZ)\n#define IPR_INTERNAL_TIMEOUT\t\t\t(ipr_fastfail ? 10 * HZ : 30 * HZ)\n#define IPR_WRITE_BUFFER_TIMEOUT\t\t(30 * 60 * HZ)\n#define IPR_SET_SUP_DEVICE_TIMEOUT\t\t(2 * 60 * HZ)\n#define IPR_REQUEST_SENSE_TIMEOUT\t\t(10 * HZ)\n#define IPR_OPERATIONAL_TIMEOUT\t\t(5 * 60)\n#define IPR_LONG_OPERATIONAL_TIMEOUT\t(12 * 60)\n#define IPR_WAIT_FOR_RESET_TIMEOUT\t\t(2 * HZ)\n#define IPR_CHECK_FOR_RESET_TIMEOUT\t\t(HZ / 10)\n#define IPR_WAIT_FOR_BIST_TIMEOUT\t\t(2 * HZ)\n#define IPR_PCI_ERROR_RECOVERY_TIMEOUT\t(120 * HZ)\n#define IPR_PCI_RESET_TIMEOUT\t\t\t(HZ / 2)\n#define IPR_SIS32_DUMP_TIMEOUT\t\t\t(15 * HZ)\n#define IPR_SIS64_DUMP_TIMEOUT\t\t\t(40 * HZ)\n#define IPR_DUMP_DELAY_SECONDS\t\t\t4\n#define IPR_DUMP_DELAY_TIMEOUT\t\t\t(IPR_DUMP_DELAY_SECONDS * HZ)\n\n \n#define IPR_VENDOR_ID_LEN\t\t\t8\n#define IPR_PROD_ID_LEN\t\t\t\t16\n#define IPR_SERIAL_NUM_LEN\t\t\t8\n\n \n#define IPR_FMT2_MBX_ADDR_MASK\t\t\t\t0x0fffffff\n#define IPR_FMT2_MBX_BAR_SEL_MASK\t\t\t0xf0000000\n#define IPR_FMT2_MKR_BAR_SEL_SHIFT\t\t\t28\n#define IPR_GET_FMT2_BAR_SEL(mbx) \\\n(((mbx) & IPR_FMT2_MBX_BAR_SEL_MASK) >> IPR_FMT2_MKR_BAR_SEL_SHIFT)\n#define IPR_SDT_FMT2_BAR0_SEL\t\t\t\t0x0\n#define IPR_SDT_FMT2_BAR1_SEL\t\t\t\t0x1\n#define IPR_SDT_FMT2_BAR2_SEL\t\t\t\t0x2\n#define IPR_SDT_FMT2_BAR3_SEL\t\t\t\t0x3\n#define IPR_SDT_FMT2_BAR4_SEL\t\t\t\t0x4\n#define IPR_SDT_FMT2_BAR5_SEL\t\t\t\t0x5\n#define IPR_SDT_FMT2_EXP_ROM_SEL\t\t\t0x8\n#define IPR_FMT2_SDT_READY_TO_USE\t\t\t0xC4D4E3F2\n#define IPR_FMT3_SDT_READY_TO_USE\t\t\t0xC4D4E3F3\n#define IPR_DOORBELL\t\t\t\t\t0x82800000\n#define IPR_RUNTIME_RESET\t\t\t\t0x40000000\n\n#define IPR_IPL_INIT_MIN_STAGE_TIME\t\t\t5\n#define IPR_IPL_INIT_DEFAULT_STAGE_TIME                 30\n#define IPR_IPL_INIT_STAGE_UNKNOWN\t\t\t0x0\n#define IPR_IPL_INIT_STAGE_TRANSOP\t\t\t0xB0000000\n#define IPR_IPL_INIT_STAGE_MASK\t\t\t\t0xff000000\n#define IPR_IPL_INIT_STAGE_TIME_MASK\t\t\t0x0000ffff\n#define IPR_PCII_IPL_STAGE_CHANGE\t\t\t(0x80000000 >> 0)\n\n#define IPR_PCII_MAILBOX_STABLE\t\t\t\t(0x80000000 >> 4)\n#define IPR_WAIT_FOR_MAILBOX\t\t\t\t(2 * HZ)\n\n#define IPR_PCII_IOA_TRANS_TO_OPER\t\t\t(0x80000000 >> 0)\n#define IPR_PCII_IOARCB_XFER_FAILED\t\t\t(0x80000000 >> 3)\n#define IPR_PCII_IOA_UNIT_CHECKED\t\t\t(0x80000000 >> 4)\n#define IPR_PCII_NO_HOST_RRQ\t\t\t\t(0x80000000 >> 5)\n#define IPR_PCII_CRITICAL_OPERATION\t\t\t(0x80000000 >> 6)\n#define IPR_PCII_IO_DEBUG_ACKNOWLEDGE\t\t(0x80000000 >> 7)\n#define IPR_PCII_IOARRIN_LOST\t\t\t\t(0x80000000 >> 27)\n#define IPR_PCII_MMIO_ERROR\t\t\t\t(0x80000000 >> 28)\n#define IPR_PCII_PROC_ERR_STATE\t\t\t(0x80000000 >> 29)\n#define IPR_PCII_HRRQ_UPDATED\t\t\t\t(0x80000000 >> 30)\n#define IPR_PCII_CORE_ISSUED_RST_REQ\t\t(0x80000000 >> 31)\n\n#define IPR_PCII_ERROR_INTERRUPTS \\\n(IPR_PCII_IOARCB_XFER_FAILED | IPR_PCII_IOA_UNIT_CHECKED | \\\nIPR_PCII_NO_HOST_RRQ | IPR_PCII_IOARRIN_LOST | IPR_PCII_MMIO_ERROR)\n\n#define IPR_PCII_OPER_INTERRUPTS \\\n(IPR_PCII_ERROR_INTERRUPTS | IPR_PCII_HRRQ_UPDATED | IPR_PCII_IOA_TRANS_TO_OPER)\n\n#define IPR_UPROCI_RESET_ALERT\t\t\t(0x80000000 >> 7)\n#define IPR_UPROCI_IO_DEBUG_ALERT\t\t\t(0x80000000 >> 9)\n#define IPR_UPROCI_SIS64_START_BIST\t\t\t(0x80000000 >> 23)\n\n#define IPR_LDUMP_MAX_LONG_ACK_DELAY_IN_USEC\t\t200000\t \n#define IPR_LDUMP_MAX_SHORT_ACK_DELAY_IN_USEC\t\t200000\t \n\n \n#define IPR_FMT2_MAX_IOA_DUMP_SIZE\t\t\t(4 * 1024 * 1024)\n#define IPR_FMT3_MAX_IOA_DUMP_SIZE\t\t\t(80 * 1024 * 1024)\n#define IPR_FMT2_NUM_SDT_ENTRIES\t\t\t511\n#define IPR_FMT3_NUM_SDT_ENTRIES\t\t\t0xFFF\n#define IPR_FMT2_MAX_NUM_DUMP_PAGES\t((IPR_FMT2_MAX_IOA_DUMP_SIZE / PAGE_SIZE) + 1)\n#define IPR_FMT3_MAX_NUM_DUMP_PAGES\t((IPR_FMT3_MAX_IOA_DUMP_SIZE / PAGE_SIZE) + 1)\n\n \n#define IPR_NUM_IOADL_ENTRIES\t\t\tIPR_MAX_SGLIST\n#define IPR_MAX_MSIX_VECTORS\t\t0x10\n#define IPR_MAX_HRRQ_NUM\t\t0x10\n#define IPR_INIT_HRRQ\t\t\t0x0\n\n \n\nstruct ipr_res_addr {\n\tu8 reserved;\n\tu8 bus;\n\tu8 target;\n\tu8 lun;\n#define IPR_GET_PHYS_LOC(res_addr) \\\n\t(((res_addr).bus << 16) | ((res_addr).target << 8) | (res_addr).lun)\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_std_inq_vpids {\n\tu8 vendor_id[IPR_VENDOR_ID_LEN];\n\tu8 product_id[IPR_PROD_ID_LEN];\n}__attribute__((packed));\n\nstruct ipr_vpd {\n\tstruct ipr_std_inq_vpids vpids;\n\tu8 sn[IPR_SERIAL_NUM_LEN];\n}__attribute__((packed));\n\nstruct ipr_ext_vpd {\n\tstruct ipr_vpd vpd;\n\t__be32 wwid[2];\n}__attribute__((packed));\n\nstruct ipr_ext_vpd64 {\n\tstruct ipr_vpd vpd;\n\t__be32 wwid[4];\n}__attribute__((packed));\n\nstruct ipr_std_inq_data {\n\tu8 peri_qual_dev_type;\n#define IPR_STD_INQ_PERI_QUAL(peri) ((peri) >> 5)\n#define IPR_STD_INQ_PERI_DEV_TYPE(peri) ((peri) & 0x1F)\n\n\tu8 removeable_medium_rsvd;\n#define IPR_STD_INQ_REMOVEABLE_MEDIUM 0x80\n\n#define IPR_IS_DASD_DEVICE(std_inq) \\\n((IPR_STD_INQ_PERI_DEV_TYPE((std_inq).peri_qual_dev_type) == TYPE_DISK) && \\\n!(((std_inq).removeable_medium_rsvd) & IPR_STD_INQ_REMOVEABLE_MEDIUM))\n\n#define IPR_IS_SES_DEVICE(std_inq) \\\n(IPR_STD_INQ_PERI_DEV_TYPE((std_inq).peri_qual_dev_type) == TYPE_ENCLOSURE)\n\n\tu8 version;\n\tu8 aen_naca_fmt;\n\tu8 additional_len;\n\tu8 sccs_rsvd;\n\tu8 bq_enc_multi;\n\tu8 sync_cmdq_flags;\n\n\tstruct ipr_std_inq_vpids vpids;\n\n\tu8 ros_rsvd_ram_rsvd[4];\n\n\tu8 serial_num[IPR_SERIAL_NUM_LEN];\n}__attribute__ ((packed));\n\n#define IPR_RES_TYPE_AF_DASD\t\t0x00\n#define IPR_RES_TYPE_GENERIC_SCSI\t0x01\n#define IPR_RES_TYPE_VOLUME_SET\t\t0x02\n#define IPR_RES_TYPE_REMOTE_AF_DASD\t0x03\n#define IPR_RES_TYPE_GENERIC_ATA\t0x04\n#define IPR_RES_TYPE_ARRAY\t\t0x05\n#define IPR_RES_TYPE_IOAFP\t\t0xff\n\nstruct ipr_config_table_entry {\n\tu8 proto;\n#define IPR_PROTO_SATA\t\t\t0x02\n#define IPR_PROTO_SATA_ATAPI\t\t0x03\n#define IPR_PROTO_SAS_STP\t\t0x06\n#define IPR_PROTO_SAS_STP_ATAPI\t\t0x07\n\tu8 array_id;\n\tu8 flags;\n#define IPR_IS_IOA_RESOURCE\t\t0x80\n\tu8 rsvd_subtype;\n\n#define IPR_QUEUEING_MODEL(res)\t((((res)->flags) & 0x70) >> 4)\n#define IPR_QUEUE_FROZEN_MODEL\t\t0\n#define IPR_QUEUE_NACA_MODEL\t\t1\n\n\tstruct ipr_res_addr res_addr;\n\t__be32 res_handle;\n\t__be32 lun_wwn[2];\n\tstruct ipr_std_inq_data std_inq_data;\n}__attribute__ ((packed, aligned (4)));\n\nstruct ipr_config_table_entry64 {\n\tu8 res_type;\n\tu8 proto;\n\tu8 vset_num;\n\tu8 array_id;\n\t__be16 flags;\n\t__be16 res_flags;\n#define IPR_QUEUEING_MODEL64(res) ((((res)->res_flags) & 0x7000) >> 12)\n\t__be32 res_handle;\n\tu8 dev_id_type;\n\tu8 reserved[3];\n\t__be64 dev_id;\n\t__be64 lun;\n\t__be64 lun_wwn[2];\n#define IPR_MAX_RES_PATH_LENGTH\t\t48\n#define IPR_RES_PATH_BYTES\t\t8\n\t__be64 res_path;\n\tstruct ipr_std_inq_data std_inq_data;\n\tu8 reserved2[4];\n\t__be64 reserved3[2];\n\tu8 reserved4[8];\n}__attribute__ ((packed, aligned (8)));\n\nstruct ipr_config_table_hdr {\n\tu8 num_entries;\n\tu8 flags;\n#define IPR_UCODE_DOWNLOAD_REQ\t0x10\n\t__be16 reserved;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_config_table_hdr64 {\n\t__be16 num_entries;\n\t__be16 reserved;\n\tu8 flags;\n\tu8 reserved2[11];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_config_table {\n\tstruct ipr_config_table_hdr hdr;\n\tstruct ipr_config_table_entry dev[];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_config_table64 {\n\tstruct ipr_config_table_hdr64 hdr64;\n\tstruct ipr_config_table_entry64 dev[];\n}__attribute__((packed, aligned (8)));\n\nstruct ipr_config_table_entry_wrapper {\n\tunion {\n\t\tstruct ipr_config_table_entry *cfgte;\n\t\tstruct ipr_config_table_entry64 *cfgte64;\n\t} u;\n};\n\nstruct ipr_hostrcb_cfg_ch_not {\n\tunion {\n\t\tstruct ipr_config_table_entry cfgte;\n\t\tstruct ipr_config_table_entry64 cfgte64;\n\t} u;\n\tu8 reserved[936];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_supported_device {\n\t__be16 data_length;\n\tu8 reserved;\n\tu8 num_records;\n\tstruct ipr_std_inq_vpids vpids;\n\tu8 reserved2[16];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hrr_queue {\n\tstruct ipr_ioa_cfg *ioa_cfg;\n\t__be32 *host_rrq;\n\tdma_addr_t host_rrq_dma;\n#define IPR_HRRQ_REQ_RESP_HANDLE_MASK\t0xfffffffc\n#define IPR_HRRQ_RESP_BIT_SET\t\t0x00000002\n#define IPR_HRRQ_TOGGLE_BIT\t\t0x00000001\n#define IPR_HRRQ_REQ_RESP_HANDLE_SHIFT\t2\n#define IPR_ID_HRRQ_SELE_ENABLE\t\t0x02\n\tvolatile __be32 *hrrq_start;\n\tvolatile __be32 *hrrq_end;\n\tvolatile __be32 *hrrq_curr;\n\n\tstruct list_head hrrq_free_q;\n\tstruct list_head hrrq_pending_q;\n\tspinlock_t _lock;\n\tspinlock_t *lock;\n\n\tvolatile u32 toggle_bit;\n\tu32 size;\n\tu32 min_cmd_id;\n\tu32 max_cmd_id;\n\tu8 allow_interrupts:1;\n\tu8 ioa_is_dead:1;\n\tu8 allow_cmds:1;\n\tu8 removing_ioa:1;\n\n\tstruct irq_poll iopoll;\n};\n\n \nstruct ipr_cmd_pkt {\n\tu8 reserved;\t\t \n\tu8 hrrq_id;\n\tu8 request_type;\n#define IPR_RQTYPE_SCSICDB\t\t0x00\n#define IPR_RQTYPE_IOACMD\t\t0x01\n#define IPR_RQTYPE_HCAM\t\t\t0x02\n#define IPR_RQTYPE_PIPE\t\t\t0x05\n\n\tu8 reserved2;\n\n\tu8 flags_hi;\n#define IPR_FLAGS_HI_WRITE_NOT_READ\t\t0x80\n#define IPR_FLAGS_HI_NO_ULEN_CHK\t\t0x20\n#define IPR_FLAGS_HI_SYNC_OVERRIDE\t\t0x10\n#define IPR_FLAGS_HI_SYNC_COMPLETE\t\t0x08\n#define IPR_FLAGS_HI_NO_LINK_DESC\t\t0x04\n\n\tu8 flags_lo;\n#define IPR_FLAGS_LO_ALIGNED_BFR\t\t0x20\n#define IPR_FLAGS_LO_DELAY_AFTER_RST\t\t0x10\n#define IPR_FLAGS_LO_UNTAGGED_TASK\t\t0x00\n#define IPR_FLAGS_LO_SIMPLE_TASK\t\t0x02\n#define IPR_FLAGS_LO_ORDERED_TASK\t\t0x04\n#define IPR_FLAGS_LO_HEAD_OF_Q_TASK\t\t0x06\n#define IPR_FLAGS_LO_ACA_TASK\t\t\t0x08\n\n\tu8 cdb[16];\n\t__be16 timeout;\n}__attribute__ ((packed, aligned(4)));\n\nstruct ipr_ioadl_desc {\n\t__be32 flags_and_data_len;\n#define IPR_IOADL_FLAGS_MASK\t\t0xff000000\n#define IPR_IOADL_GET_FLAGS(x) (be32_to_cpu(x) & IPR_IOADL_FLAGS_MASK)\n#define IPR_IOADL_DATA_LEN_MASK\t\t0x00ffffff\n#define IPR_IOADL_GET_DATA_LEN(x) (be32_to_cpu(x) & IPR_IOADL_DATA_LEN_MASK)\n#define IPR_IOADL_FLAGS_READ\t\t0x48000000\n#define IPR_IOADL_FLAGS_READ_LAST\t0x49000000\n#define IPR_IOADL_FLAGS_WRITE\t\t0x68000000\n#define IPR_IOADL_FLAGS_WRITE_LAST\t0x69000000\n#define IPR_IOADL_FLAGS_LAST\t\t0x01000000\n\n\t__be32 address;\n}__attribute__((packed, aligned (8)));\n\nstruct ipr_ioadl64_desc {\n\t__be32 flags;\n\t__be32 data_len;\n\t__be64 address;\n}__attribute__((packed, aligned (16)));\n\nstruct ipr_ioarcb_add_data {\n\tunion {\n\t\tstruct ipr_ioadl_desc ioadl[5];\n\t\t__be32 add_cmd_parms[10];\n\t} u;\n}__attribute__ ((packed, aligned (4)));\n\nstruct ipr_ioarcb_sis64_add_addr_ecb {\n\t__be64 ioasa_host_pci_addr;\n\t__be64 data_ioadl_addr;\n\t__be64 reserved;\n\t__be32 ext_control_buf[4];\n}__attribute__((packed, aligned (8)));\n\n \nstruct ipr_ioarcb {\n\tunion {\n\t\t__be32 ioarcb_host_pci_addr;\n\t\t__be64 ioarcb_host_pci_addr64;\n\t} a;\n\t__be32 res_handle;\n\t__be32 host_response_handle;\n\t__be32 reserved1;\n\t__be32 reserved2;\n\t__be32 reserved3;\n\n\t__be32 data_transfer_length;\n\t__be32 read_data_transfer_length;\n\t__be32 write_ioadl_addr;\n\t__be32 ioadl_len;\n\t__be32 read_ioadl_addr;\n\t__be32 read_ioadl_len;\n\n\t__be32 ioasa_host_pci_addr;\n\t__be16 ioasa_len;\n\t__be16 reserved4;\n\n\tstruct ipr_cmd_pkt cmd_pkt;\n\n\t__be16 add_cmd_parms_offset;\n\t__be16 add_cmd_parms_len;\n\n\tunion {\n\t\tstruct ipr_ioarcb_add_data add_data;\n\t\tstruct ipr_ioarcb_sis64_add_addr_ecb sis64_addr_data;\n\t} u;\n\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_ioasa_vset {\n\t__be32 failing_lba_hi;\n\t__be32 failing_lba_lo;\n\t__be32 reserved;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_ioasa_af_dasd {\n\t__be32 failing_lba;\n\t__be32 reserved[2];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_ioasa_gpdd {\n\tu8 end_state;\n\tu8 bus_phase;\n\t__be16 reserved;\n\t__be32 ioa_data[2];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_auto_sense {\n\t__be16 auto_sense_len;\n\t__be16 ioa_data_len;\n\t__be32 data[SCSI_SENSE_BUFFERSIZE/sizeof(__be32)];\n};\n\nstruct ipr_ioasa_hdr {\n\t__be32 ioasc;\n#define IPR_IOASC_SENSE_KEY(ioasc) ((ioasc) >> 24)\n#define IPR_IOASC_SENSE_CODE(ioasc) (((ioasc) & 0x00ff0000) >> 16)\n#define IPR_IOASC_SENSE_QUAL(ioasc) (((ioasc) & 0x0000ff00) >> 8)\n#define IPR_IOASC_SENSE_STATUS(ioasc) ((ioasc) & 0x000000ff)\n\n\t__be16 ret_stat_len;\t \n\n\t__be16 avail_stat_len;\t \n\n\t__be32 residual_data_len;\t \n\t \n\n\t__be32 ilid;\n#define IPR_NO_ILID\t\t\t0\n#define IPR_DRIVER_ILID\t\t0xffffffff\n\n\t__be32 fd_ioasc;\n\n\t__be32 fd_phys_locator;\n\n\t__be32 fd_res_handle;\n\n\t__be32 ioasc_specific;\t \n#define IPR_ADDITIONAL_STATUS_FMT\t\t0x80000000\n#define IPR_AUTOSENSE_VALID\t\t\t0x40000000\n#define IPR_IOASC_SPECIFIC_MASK\t\t0x00ffffff\n#define IPR_FIELD_POINTER_VALID\t\t(0x80000000 >> 8)\n#define IPR_FIELD_POINTER_MASK\t\t0x0000ffff\n\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_ioasa {\n\tstruct ipr_ioasa_hdr hdr;\n\n\tunion {\n\t\tstruct ipr_ioasa_vset vset;\n\t\tstruct ipr_ioasa_af_dasd dasd;\n\t\tstruct ipr_ioasa_gpdd gpdd;\n\t} u;\n\n\tstruct ipr_auto_sense auto_sense;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_ioasa64 {\n\tstruct ipr_ioasa_hdr hdr;\n\tu8 fd_res_path[8];\n\n\tunion {\n\t\tstruct ipr_ioasa_vset vset;\n\t\tstruct ipr_ioasa_af_dasd dasd;\n\t\tstruct ipr_ioasa_gpdd gpdd;\n\t} u;\n\n\tstruct ipr_auto_sense auto_sense;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_mode_parm_hdr {\n\tu8 length;\n\tu8 medium_type;\n\tu8 device_spec_parms;\n\tu8 block_desc_len;\n}__attribute__((packed));\n\nstruct ipr_mode_pages {\n\tstruct ipr_mode_parm_hdr hdr;\n\tu8 data[255 - sizeof(struct ipr_mode_parm_hdr)];\n}__attribute__((packed));\n\nstruct ipr_mode_page_hdr {\n\tu8 ps_page_code;\n#define IPR_MODE_PAGE_PS\t0x80\n#define IPR_GET_MODE_PAGE_CODE(hdr) ((hdr)->ps_page_code & 0x3F)\n\tu8 page_length;\n}__attribute__ ((packed));\n\nstruct ipr_dev_bus_entry {\n\tstruct ipr_res_addr res_addr;\n\tu8 flags;\n#define IPR_SCSI_ATTR_ENABLE_QAS\t\t\t0x80\n#define IPR_SCSI_ATTR_DISABLE_QAS\t\t\t0x40\n#define IPR_SCSI_ATTR_QAS_MASK\t\t\t\t0xC0\n#define IPR_SCSI_ATTR_ENABLE_TM\t\t\t\t0x20\n#define IPR_SCSI_ATTR_NO_TERM_PWR\t\t\t0x10\n#define IPR_SCSI_ATTR_TM_SUPPORTED\t\t\t0x08\n#define IPR_SCSI_ATTR_LVD_TO_SE_NOT_ALLOWED\t0x04\n\n\tu8 scsi_id;\n\tu8 bus_width;\n\tu8 extended_reset_delay;\n#define IPR_EXTENDED_RESET_DELAY\t7\n\n\t__be32 max_xfer_rate;\n\n\tu8 spinup_delay;\n\tu8 reserved3;\n\t__be16 reserved4;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_mode_page28 {\n\tstruct ipr_mode_page_hdr hdr;\n\tu8 num_entries;\n\tu8 entry_length;\n\tstruct ipr_dev_bus_entry bus[];\n}__attribute__((packed));\n\nstruct ipr_mode_page24 {\n\tstruct ipr_mode_page_hdr hdr;\n\tu8 flags;\n#define IPR_ENABLE_DUAL_IOA_AF 0x80\n}__attribute__((packed));\n\nstruct ipr_ioa_vpd {\n\tstruct ipr_std_inq_data std_inq_data;\n\tu8 ascii_part_num[12];\n\tu8 reserved[40];\n\tu8 ascii_plant_code[4];\n}__attribute__((packed));\n\nstruct ipr_inquiry_page3 {\n\tu8 peri_qual_dev_type;\n\tu8 page_code;\n\tu8 reserved1;\n\tu8 page_length;\n\tu8 ascii_len;\n\tu8 reserved2[3];\n\tu8 load_id[4];\n\tu8 major_release;\n\tu8 card_type;\n\tu8 minor_release[2];\n\tu8 ptf_number[4];\n\tu8 patch_number[4];\n}__attribute__((packed));\n\nstruct ipr_inquiry_cap {\n\tu8 peri_qual_dev_type;\n\tu8 page_code;\n\tu8 reserved1;\n\tu8 page_length;\n\tu8 ascii_len;\n\tu8 reserved2;\n\tu8 sis_version[2];\n\tu8 cap;\n#define IPR_CAP_DUAL_IOA_RAID\t\t0x80\n\tu8 reserved3[15];\n}__attribute__((packed));\n\n#define IPR_INQUIRY_PAGE0_ENTRIES 20\nstruct ipr_inquiry_page0 {\n\tu8 peri_qual_dev_type;\n\tu8 page_code;\n\tu8 reserved1;\n\tu8 len;\n\tu8 page[IPR_INQUIRY_PAGE0_ENTRIES];\n}__attribute__((packed));\n\nstruct ipr_inquiry_pageC4 {\n\tu8 peri_qual_dev_type;\n\tu8 page_code;\n\tu8 reserved1;\n\tu8 len;\n\tu8 cache_cap[4];\n#define IPR_CAP_SYNC_CACHE\t\t0x08\n\tu8 reserved2[20];\n} __packed;\n\nstruct ipr_hostrcb_device_data_entry {\n\tstruct ipr_vpd vpd;\n\tstruct ipr_res_addr dev_res_addr;\n\tstruct ipr_vpd new_vpd;\n\tstruct ipr_vpd ioa_last_with_dev_vpd;\n\tstruct ipr_vpd cfc_last_with_dev_vpd;\n\t__be32 ioa_data[5];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_device_data_entry_enhanced {\n\tstruct ipr_ext_vpd vpd;\n\tu8 ccin[4];\n\tstruct ipr_res_addr dev_res_addr;\n\tstruct ipr_ext_vpd new_vpd;\n\tu8 new_ccin[4];\n\tstruct ipr_ext_vpd ioa_last_with_dev_vpd;\n\tstruct ipr_ext_vpd cfc_last_with_dev_vpd;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb64_device_data_entry_enhanced {\n\tstruct ipr_ext_vpd vpd;\n\tu8 ccin[4];\n\tu8 res_path[8];\n\tstruct ipr_ext_vpd new_vpd;\n\tu8 new_ccin[4];\n\tstruct ipr_ext_vpd ioa_last_with_dev_vpd;\n\tstruct ipr_ext_vpd cfc_last_with_dev_vpd;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_array_data_entry {\n\tstruct ipr_vpd vpd;\n\tstruct ipr_res_addr expected_dev_res_addr;\n\tstruct ipr_res_addr dev_res_addr;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb64_array_data_entry {\n\tstruct ipr_ext_vpd vpd;\n\tu8 ccin[4];\n\tu8 expected_res_path[8];\n\tu8 res_path[8];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_array_data_entry_enhanced {\n\tstruct ipr_ext_vpd vpd;\n\tu8 ccin[4];\n\tstruct ipr_res_addr expected_dev_res_addr;\n\tstruct ipr_res_addr dev_res_addr;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_ff_error {\n\t__be32 ioa_data[758];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_01_error {\n\t__be32 seek_counter;\n\t__be32 read_counter;\n\tu8 sense_data[32];\n\t__be32 ioa_data[236];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_21_error {\n\t__be32 wwn[4];\n\tu8 res_path[8];\n\tu8 primary_problem_desc[32];\n\tu8 second_problem_desc[32];\n\t__be32 sense_data[8];\n\t__be32 cdb[4];\n\t__be32 residual_trans_length;\n\t__be32 length_of_error;\n\t__be32 ioa_data[236];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_02_error {\n\tstruct ipr_vpd ioa_vpd;\n\tstruct ipr_vpd cfc_vpd;\n\tstruct ipr_vpd ioa_last_attached_to_cfc_vpd;\n\tstruct ipr_vpd cfc_last_attached_to_ioa_vpd;\n\t__be32 ioa_data[3];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_12_error {\n\tstruct ipr_ext_vpd ioa_vpd;\n\tstruct ipr_ext_vpd cfc_vpd;\n\tstruct ipr_ext_vpd ioa_last_attached_to_cfc_vpd;\n\tstruct ipr_ext_vpd cfc_last_attached_to_ioa_vpd;\n\t__be32 ioa_data[3];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_03_error {\n\tstruct ipr_vpd ioa_vpd;\n\tstruct ipr_vpd cfc_vpd;\n\t__be32 errors_detected;\n\t__be32 errors_logged;\n\tu8 ioa_data[12];\n\tstruct ipr_hostrcb_device_data_entry dev[3];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_13_error {\n\tstruct ipr_ext_vpd ioa_vpd;\n\tstruct ipr_ext_vpd cfc_vpd;\n\t__be32 errors_detected;\n\t__be32 errors_logged;\n\tstruct ipr_hostrcb_device_data_entry_enhanced dev[3];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_23_error {\n\tstruct ipr_ext_vpd ioa_vpd;\n\tstruct ipr_ext_vpd cfc_vpd;\n\t__be32 errors_detected;\n\t__be32 errors_logged;\n\tstruct ipr_hostrcb64_device_data_entry_enhanced dev[3];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_04_error {\n\tstruct ipr_vpd ioa_vpd;\n\tstruct ipr_vpd cfc_vpd;\n\tu8 ioa_data[12];\n\tstruct ipr_hostrcb_array_data_entry array_member[10];\n\t__be32 exposed_mode_adn;\n\t__be32 array_id;\n\tstruct ipr_vpd incomp_dev_vpd;\n\t__be32 ioa_data2;\n\tstruct ipr_hostrcb_array_data_entry array_member2[8];\n\tstruct ipr_res_addr last_func_vset_res_addr;\n\tu8 vset_serial_num[IPR_SERIAL_NUM_LEN];\n\tu8 protection_level[8];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_14_error {\n\tstruct ipr_ext_vpd ioa_vpd;\n\tstruct ipr_ext_vpd cfc_vpd;\n\t__be32 exposed_mode_adn;\n\t__be32 array_id;\n\tstruct ipr_res_addr last_func_vset_res_addr;\n\tu8 vset_serial_num[IPR_SERIAL_NUM_LEN];\n\tu8 protection_level[8];\n\t__be32 num_entries;\n\tstruct ipr_hostrcb_array_data_entry_enhanced array_member[18];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_24_error {\n\tstruct ipr_ext_vpd ioa_vpd;\n\tstruct ipr_ext_vpd cfc_vpd;\n\tu8 reserved[2];\n\tu8 exposed_mode_adn;\n#define IPR_INVALID_ARRAY_DEV_NUM\t\t0xff\n\tu8 array_id;\n\tu8 last_res_path[8];\n\tu8 protection_level[8];\n\tstruct ipr_ext_vpd64 array_vpd;\n\tu8 description[16];\n\tu8 reserved2[3];\n\tu8 num_entries;\n\tstruct ipr_hostrcb64_array_data_entry array_member[32];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_07_error {\n\tu8 failure_reason[64];\n\tstruct ipr_vpd vpd;\n\t__be32 data[222];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_17_error {\n\tu8 failure_reason[64];\n\tstruct ipr_ext_vpd vpd;\n\t__be32 data[476];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_config_element {\n\tu8 type_status;\n#define IPR_PATH_CFG_TYPE_MASK\t0xF0\n#define IPR_PATH_CFG_NOT_EXIST\t0x00\n#define IPR_PATH_CFG_IOA_PORT\t\t0x10\n#define IPR_PATH_CFG_EXP_PORT\t\t0x20\n#define IPR_PATH_CFG_DEVICE_PORT\t0x30\n#define IPR_PATH_CFG_DEVICE_LUN\t0x40\n\n#define IPR_PATH_CFG_STATUS_MASK\t0x0F\n#define IPR_PATH_CFG_NO_PROB\t\t0x00\n#define IPR_PATH_CFG_DEGRADED\t\t0x01\n#define IPR_PATH_CFG_FAILED\t\t0x02\n#define IPR_PATH_CFG_SUSPECT\t\t0x03\n#define IPR_PATH_NOT_DETECTED\t\t0x04\n#define IPR_PATH_INCORRECT_CONN\t0x05\n\n\tu8 cascaded_expander;\n\tu8 phy;\n\tu8 link_rate;\n#define IPR_PHY_LINK_RATE_MASK\t0x0F\n\n\t__be32 wwid[2];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb64_config_element {\n\t__be16 length;\n\tu8 descriptor_id;\n#define IPR_DESCRIPTOR_MASK\t\t0xC0\n#define IPR_DESCRIPTOR_SIS64\t\t0x00\n\n\tu8 reserved;\n\tu8 type_status;\n\n\tu8 reserved2[2];\n\tu8 link_rate;\n\n\tu8 res_path[8];\n\t__be32 wwid[2];\n}__attribute__((packed, aligned (8)));\n\nstruct ipr_hostrcb_fabric_desc {\n\t__be16 length;\n\tu8 ioa_port;\n\tu8 cascaded_expander;\n\tu8 phy;\n\tu8 path_state;\n#define IPR_PATH_ACTIVE_MASK\t\t0xC0\n#define IPR_PATH_NO_INFO\t\t0x00\n#define IPR_PATH_ACTIVE\t\t\t0x40\n#define IPR_PATH_NOT_ACTIVE\t\t0x80\n\n#define IPR_PATH_STATE_MASK\t\t0x0F\n#define IPR_PATH_STATE_NO_INFO\t0x00\n#define IPR_PATH_HEALTHY\t\t0x01\n#define IPR_PATH_DEGRADED\t\t0x02\n#define IPR_PATH_FAILED\t\t\t0x03\n\n\t__be16 num_entries;\n\tstruct ipr_hostrcb_config_element elem[1];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb64_fabric_desc {\n\t__be16 length;\n\tu8 descriptor_id;\n\n\tu8 reserved[2];\n\tu8 path_state;\n\n\tu8 reserved2[2];\n\tu8 res_path[8];\n\tu8 reserved3[6];\n\t__be16 num_entries;\n\tstruct ipr_hostrcb64_config_element elem[1];\n}__attribute__((packed, aligned (8)));\n\n#define for_each_hrrq(hrrq, ioa_cfg) \\\n\t\tfor (hrrq = (ioa_cfg)->hrrq; \\\n\t\t\thrrq < ((ioa_cfg)->hrrq + (ioa_cfg)->hrrq_num); hrrq++)\n\n#define for_each_fabric_cfg(fabric, cfg) \\\n\t\tfor (cfg = (fabric)->elem; \\\n\t\t\tcfg < ((fabric)->elem + be16_to_cpu((fabric)->num_entries)); \\\n\t\t\tcfg++)\n\nstruct ipr_hostrcb_type_20_error {\n\tu8 failure_reason[64];\n\tu8 reserved[3];\n\tu8 num_entries;\n\tstruct ipr_hostrcb_fabric_desc desc[1];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_30_error {\n\tu8 failure_reason[64];\n\tu8 reserved[3];\n\tu8 num_entries;\n\tstruct ipr_hostrcb64_fabric_desc desc[1];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_type_41_error {\n\tu8 failure_reason[64];\n\t __be32 data[200];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb_error {\n\t__be32 fd_ioasc;\n\tstruct ipr_res_addr fd_res_addr;\n\t__be32 fd_res_handle;\n\t__be32 prc;\n\tunion {\n\t\tstruct ipr_hostrcb_type_ff_error type_ff_error;\n\t\tstruct ipr_hostrcb_type_01_error type_01_error;\n\t\tstruct ipr_hostrcb_type_02_error type_02_error;\n\t\tstruct ipr_hostrcb_type_03_error type_03_error;\n\t\tstruct ipr_hostrcb_type_04_error type_04_error;\n\t\tstruct ipr_hostrcb_type_07_error type_07_error;\n\t\tstruct ipr_hostrcb_type_12_error type_12_error;\n\t\tstruct ipr_hostrcb_type_13_error type_13_error;\n\t\tstruct ipr_hostrcb_type_14_error type_14_error;\n\t\tstruct ipr_hostrcb_type_17_error type_17_error;\n\t\tstruct ipr_hostrcb_type_20_error type_20_error;\n\t} u;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb64_error {\n\t__be32 fd_ioasc;\n\t__be32 ioa_fw_level;\n\t__be32 fd_res_handle;\n\t__be32 prc;\n\t__be64 fd_dev_id;\n\t__be64 fd_lun;\n\tu8 fd_res_path[8];\n\t__be64 time_stamp;\n\tu8 reserved[16];\n\tunion {\n\t\tstruct ipr_hostrcb_type_ff_error type_ff_error;\n\t\tstruct ipr_hostrcb_type_12_error type_12_error;\n\t\tstruct ipr_hostrcb_type_17_error type_17_error;\n\t\tstruct ipr_hostrcb_type_21_error type_21_error;\n\t\tstruct ipr_hostrcb_type_23_error type_23_error;\n\t\tstruct ipr_hostrcb_type_24_error type_24_error;\n\t\tstruct ipr_hostrcb_type_30_error type_30_error;\n\t\tstruct ipr_hostrcb_type_41_error type_41_error;\n\t} u;\n}__attribute__((packed, aligned (8)));\n\nstruct ipr_hostrcb_raw {\n\t__be32 data[sizeof(struct ipr_hostrcb_error)/sizeof(__be32)];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hcam {\n\tu8 op_code;\n#define IPR_HOST_RCB_OP_CODE_CONFIG_CHANGE\t\t\t0xE1\n#define IPR_HOST_RCB_OP_CODE_LOG_DATA\t\t\t\t0xE2\n\n\tu8 notify_type;\n#define IPR_HOST_RCB_NOTIF_TYPE_EXISTING_CHANGED\t0x00\n#define IPR_HOST_RCB_NOTIF_TYPE_NEW_ENTRY\t\t\t0x01\n#define IPR_HOST_RCB_NOTIF_TYPE_REM_ENTRY\t\t\t0x02\n#define IPR_HOST_RCB_NOTIF_TYPE_ERROR_LOG_ENTRY\t\t0x10\n#define IPR_HOST_RCB_NOTIF_TYPE_INFORMATION_ENTRY\t0x11\n\n\tu8 notifications_lost;\n#define IPR_HOST_RCB_NO_NOTIFICATIONS_LOST\t\t\t0\n#define IPR_HOST_RCB_NOTIFICATIONS_LOST\t\t\t\t0x80\n\n\tu8 flags;\n#define IPR_HOSTRCB_INTERNAL_OPER\t0x80\n#define IPR_HOSTRCB_ERR_RESP_SENT\t0x40\n\n\tu8 overlay_id;\n#define IPR_HOST_RCB_OVERLAY_ID_1\t\t\t\t0x01\n#define IPR_HOST_RCB_OVERLAY_ID_2\t\t\t\t0x02\n#define IPR_HOST_RCB_OVERLAY_ID_3\t\t\t\t0x03\n#define IPR_HOST_RCB_OVERLAY_ID_4\t\t\t\t0x04\n#define IPR_HOST_RCB_OVERLAY_ID_6\t\t\t\t0x06\n#define IPR_HOST_RCB_OVERLAY_ID_7\t\t\t\t0x07\n#define IPR_HOST_RCB_OVERLAY_ID_12\t\t\t\t0x12\n#define IPR_HOST_RCB_OVERLAY_ID_13\t\t\t\t0x13\n#define IPR_HOST_RCB_OVERLAY_ID_14\t\t\t\t0x14\n#define IPR_HOST_RCB_OVERLAY_ID_16\t\t\t\t0x16\n#define IPR_HOST_RCB_OVERLAY_ID_17\t\t\t\t0x17\n#define IPR_HOST_RCB_OVERLAY_ID_20\t\t\t\t0x20\n#define IPR_HOST_RCB_OVERLAY_ID_21\t\t\t\t0x21\n#define IPR_HOST_RCB_OVERLAY_ID_23\t\t\t\t0x23\n#define IPR_HOST_RCB_OVERLAY_ID_24\t\t\t\t0x24\n#define IPR_HOST_RCB_OVERLAY_ID_26\t\t\t\t0x26\n#define IPR_HOST_RCB_OVERLAY_ID_30\t\t\t\t0x30\n#define IPR_HOST_RCB_OVERLAY_ID_41\t\t\t\t0x41\n#define IPR_HOST_RCB_OVERLAY_ID_DEFAULT\t\t\t\t0xFF\n\n\tu8 reserved1[3];\n\t__be32 ilid;\n\t__be32 time_since_last_ioa_reset;\n\t__be32 reserved2;\n\t__be32 length;\n\n\tunion {\n\t\tstruct ipr_hostrcb_error error;\n\t\tstruct ipr_hostrcb64_error error64;\n\t\tstruct ipr_hostrcb_cfg_ch_not ccn;\n\t\tstruct ipr_hostrcb_raw raw;\n\t} u;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_hostrcb {\n\tstruct ipr_hcam hcam;\n\tdma_addr_t hostrcb_dma;\n\tstruct list_head queue;\n\tstruct ipr_ioa_cfg *ioa_cfg;\n\tchar rp_buffer[IPR_MAX_RES_PATH_LENGTH];\n};\n\n \nstruct ipr_sdt_entry {\n\t__be32 start_token;\n\t__be32 end_token;\n\tu8 reserved[4];\n\n\tu8 flags;\n#define IPR_SDT_ENDIAN\t\t0x80\n#define IPR_SDT_VALID_ENTRY\t0x20\n\n\tu8 resv;\n\t__be16 priority;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_sdt_header {\n\t__be32 state;\n\t__be32 num_entries;\n\t__be32 num_entries_used;\n\t__be32 dump_size;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_sdt {\n\tstruct ipr_sdt_header hdr;\n\tstruct ipr_sdt_entry entry[IPR_FMT3_NUM_SDT_ENTRIES];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_uc_sdt {\n\tstruct ipr_sdt_header hdr;\n\tstruct ipr_sdt_entry entry[1];\n}__attribute__((packed, aligned (4)));\n\n \nstruct ipr_bus_attributes {\n\tu8 bus;\n\tu8 qas_enabled;\n\tu8 bus_width;\n\tu8 reserved;\n\tu32 max_xfer_rate;\n};\n\nstruct ipr_resource_entry {\n\tu8 needs_sync_complete:1;\n\tu8 in_erp:1;\n\tu8 add_to_ml:1;\n\tu8 del_from_ml:1;\n\tu8 resetting_device:1;\n\tu8 reset_occurred:1;\n\tu8 raw_mode:1;\n\n\tu32 bus;\t\t \n\tu32 target;\t\t \n\tu32 lun;\n#define IPR_ARRAY_VIRTUAL_BUS\t\t\t0x1\n#define IPR_VSET_VIRTUAL_BUS\t\t\t0x2\n#define IPR_IOAFP_VIRTUAL_BUS\t\t\t0x3\n#define IPR_MAX_SIS64_BUSES\t\t\t0x4\n\n#define IPR_GET_RES_PHYS_LOC(res) \\\n\t(((res)->bus << 24) | ((res)->target << 8) | (res)->lun)\n\n\tu8 ata_class;\n\tu8 type;\n\n\tu16 flags;\n\tu16 res_flags;\n\n\tu8 qmodel;\n\tstruct ipr_std_inq_data std_inq_data;\n\n\t__be32 res_handle;\n\t__be64 dev_id;\n\tu64 lun_wwn;\n\tstruct scsi_lun dev_lun;\n\tu8 res_path[8];\n\n\tstruct ipr_ioa_cfg *ioa_cfg;\n\tstruct scsi_device *sdev;\n\tstruct list_head queue;\n};  \n\nstruct ipr_resource_hdr {\n\tu16 num_entries;\n\tu16 reserved;\n};\n\nstruct ipr_misc_cbs {\n\tstruct ipr_ioa_vpd ioa_vpd;\n\tstruct ipr_inquiry_page0 page0_data;\n\tstruct ipr_inquiry_page3 page3_data;\n\tstruct ipr_inquiry_cap cap;\n\tstruct ipr_inquiry_pageC4 pageC4_data;\n\tstruct ipr_mode_pages mode_pages;\n\tstruct ipr_supported_device supp_dev;\n};\n\nstruct ipr_interrupt_offsets {\n\tunsigned long set_interrupt_mask_reg;\n\tunsigned long clr_interrupt_mask_reg;\n\tunsigned long clr_interrupt_mask_reg32;\n\tunsigned long sense_interrupt_mask_reg;\n\tunsigned long sense_interrupt_mask_reg32;\n\tunsigned long clr_interrupt_reg;\n\tunsigned long clr_interrupt_reg32;\n\n\tunsigned long sense_interrupt_reg;\n\tunsigned long sense_interrupt_reg32;\n\tunsigned long ioarrin_reg;\n\tunsigned long sense_uproc_interrupt_reg;\n\tunsigned long sense_uproc_interrupt_reg32;\n\tunsigned long set_uproc_interrupt_reg;\n\tunsigned long set_uproc_interrupt_reg32;\n\tunsigned long clr_uproc_interrupt_reg;\n\tunsigned long clr_uproc_interrupt_reg32;\n\n\tunsigned long init_feedback_reg;\n\n\tunsigned long dump_addr_reg;\n\tunsigned long dump_data_reg;\n\n#define IPR_ENDIAN_SWAP_KEY\t\t0x00080800\n\tunsigned long endian_swap_reg;\n};\n\nstruct ipr_interrupts {\n\tvoid __iomem *set_interrupt_mask_reg;\n\tvoid __iomem *clr_interrupt_mask_reg;\n\tvoid __iomem *clr_interrupt_mask_reg32;\n\tvoid __iomem *sense_interrupt_mask_reg;\n\tvoid __iomem *sense_interrupt_mask_reg32;\n\tvoid __iomem *clr_interrupt_reg;\n\tvoid __iomem *clr_interrupt_reg32;\n\n\tvoid __iomem *sense_interrupt_reg;\n\tvoid __iomem *sense_interrupt_reg32;\n\tvoid __iomem *ioarrin_reg;\n\tvoid __iomem *sense_uproc_interrupt_reg;\n\tvoid __iomem *sense_uproc_interrupt_reg32;\n\tvoid __iomem *set_uproc_interrupt_reg;\n\tvoid __iomem *set_uproc_interrupt_reg32;\n\tvoid __iomem *clr_uproc_interrupt_reg;\n\tvoid __iomem *clr_uproc_interrupt_reg32;\n\n\tvoid __iomem *init_feedback_reg;\n\n\tvoid __iomem *dump_addr_reg;\n\tvoid __iomem *dump_data_reg;\n\n\tvoid __iomem *endian_swap_reg;\n};\n\nstruct ipr_chip_cfg_t {\n\tu32 mailbox;\n\tu16 max_cmds;\n\tu8 cache_line_size;\n\tu8 clear_isr;\n\tu32 iopoll_weight;\n\tstruct ipr_interrupt_offsets regs;\n};\n\nstruct ipr_chip_t {\n\tu16 vendor;\n\tu16 device;\n\tbool has_msi;\n\tu16 sis_type;\n#define IPR_SIS32\t\t\t0x00\n#define IPR_SIS64\t\t\t0x01\n\tu16 bist_method;\n#define IPR_PCI_CFG\t\t\t0x00\n#define IPR_MMIO\t\t\t0x01\n\tconst struct ipr_chip_cfg_t *cfg;\n};\n\nenum ipr_shutdown_type {\n\tIPR_SHUTDOWN_NORMAL = 0x00,\n\tIPR_SHUTDOWN_PREPARE_FOR_NORMAL = 0x40,\n\tIPR_SHUTDOWN_ABBREV = 0x80,\n\tIPR_SHUTDOWN_NONE = 0x100,\n\tIPR_SHUTDOWN_QUIESCE = 0x101,\n};\n\nstruct ipr_trace_entry {\n\tu32 time;\n\n\tu8 op_code;\n\tu8 ata_op_code;\n\tu8 type;\n#define IPR_TRACE_START\t\t\t0x00\n#define IPR_TRACE_FINISH\t\t0xff\n\tu8 cmd_index;\n\n\t__be32 res_handle;\n\tunion {\n\t\tu32 ioasc;\n\t\tu32 add_data;\n\t\tu32 res_addr;\n\t} u;\n};\n\nstruct ipr_sglist {\n\tu32 order;\n\tu32 num_sg;\n\tu32 num_dma_sg;\n\tu32 buffer_len;\n\tstruct scatterlist *scatterlist;\n};\n\nenum ipr_sdt_state {\n\tINACTIVE,\n\tWAIT_FOR_DUMP,\n\tGET_DUMP,\n\tREAD_DUMP,\n\tABORT_DUMP,\n\tDUMP_OBTAINED\n};\n\n \nstruct ipr_ioa_cfg {\n\tchar eye_catcher[8];\n#define IPR_EYECATCHER\t\t\t\"iprcfg\"\n\n\tstruct list_head queue;\n\n\tu8 in_reset_reload:1;\n\tu8 in_ioa_bringdown:1;\n\tu8 ioa_unit_checked:1;\n\tu8 dump_taken:1;\n\tu8 scan_enabled:1;\n\tu8 scan_done:1;\n\tu8 needs_hard_reset:1;\n\tu8 dual_raid:1;\n\tu8 needs_warm_reset:1;\n\tu8 msi_received:1;\n\tu8 sis64:1;\n\tu8 dump_timeout:1;\n\tu8 cfg_locked:1;\n\tu8 clear_isr:1;\n\tu8 probe_done:1;\n\tu8 scsi_unblock:1;\n\tu8 scsi_blocked:1;\n\n\tu8 revid;\n\n\t \n\tunsigned long target_ids[BITS_TO_LONGS(IPR_MAX_SIS64_DEVS)];\n\tunsigned long array_ids[BITS_TO_LONGS(IPR_MAX_SIS64_DEVS)];\n\tunsigned long vset_ids[BITS_TO_LONGS(IPR_MAX_SIS64_DEVS)];\n\n\tu16 type;  \n\n\tu8 log_level;\n#define IPR_MAX_LOG_LEVEL\t\t\t4\n#define IPR_DEFAULT_LOG_LEVEL\t\t2\n#define IPR_DEBUG_LOG_LEVEL\t\t3\n\n#define IPR_NUM_TRACE_INDEX_BITS\t8\n#define IPR_NUM_TRACE_ENTRIES\t\t(1 << IPR_NUM_TRACE_INDEX_BITS)\n#define IPR_TRACE_INDEX_MASK\t\t(IPR_NUM_TRACE_ENTRIES - 1)\n#define IPR_TRACE_SIZE\t(sizeof(struct ipr_trace_entry) * IPR_NUM_TRACE_ENTRIES)\n\tchar trace_start[8];\n#define IPR_TRACE_START_LABEL\t\t\t\"trace\"\n\tstruct ipr_trace_entry *trace;\n\tatomic_t trace_index;\n\n\tchar cfg_table_start[8];\n#define IPR_CFG_TBL_START\t\t\"cfg\"\n\tunion {\n\t\tstruct ipr_config_table *cfg_table;\n\t\tstruct ipr_config_table64 *cfg_table64;\n\t} u;\n\tdma_addr_t cfg_table_dma;\n\tu32 cfg_table_size;\n\tu32 max_devs_supported;\n\n\tchar resource_table_label[8];\n#define IPR_RES_TABLE_LABEL\t\t\"res_tbl\"\n\tstruct ipr_resource_entry *res_entries;\n\tstruct list_head free_res_q;\n\tstruct list_head used_res_q;\n\n\tchar ipr_hcam_label[8];\n#define IPR_HCAM_LABEL\t\t\t\"hcams\"\n\tstruct ipr_hostrcb *hostrcb[IPR_MAX_HCAMS];\n\tdma_addr_t hostrcb_dma[IPR_MAX_HCAMS];\n\tstruct list_head hostrcb_free_q;\n\tstruct list_head hostrcb_pending_q;\n\tstruct list_head hostrcb_report_q;\n\n\tstruct ipr_hrr_queue hrrq[IPR_MAX_HRRQ_NUM];\n\tu32 hrrq_num;\n\tatomic_t  hrrq_index;\n\tu16 identify_hrrq_index;\n\n\tstruct ipr_bus_attributes bus_attr[IPR_MAX_NUM_BUSES];\n\n\tunsigned int transop_timeout;\n\tconst struct ipr_chip_cfg_t *chip_cfg;\n\tconst struct ipr_chip_t *ipr_chip;\n\n\tvoid __iomem *hdw_dma_regs;\t \n\tunsigned long hdw_dma_regs_pci;\t \n\tvoid __iomem *ioa_mailbox;\n\tstruct ipr_interrupts regs;\n\n\tu16 saved_pcix_cmd_reg;\n\tu16 reset_retries;\n\n\tu32 errors_logged;\n\tu32 doorbell;\n\n\tstruct Scsi_Host *host;\n\tstruct pci_dev *pdev;\n\tstruct ipr_sglist *ucode_sglist;\n\tu8 saved_mode_page_len;\n\n\tstruct work_struct work_q;\n\tstruct work_struct scsi_add_work_q;\n\tstruct workqueue_struct *reset_work_q;\n\n\twait_queue_head_t reset_wait_q;\n\twait_queue_head_t msi_wait_q;\n\twait_queue_head_t eeh_wait_q;\n\n\tstruct ipr_dump *dump;\n\tenum ipr_sdt_state sdt_state;\n\n\tstruct ipr_misc_cbs *vpd_cbs;\n\tdma_addr_t vpd_cbs_dma;\n\n\tstruct dma_pool *ipr_cmd_pool;\n\n\tstruct ipr_cmnd *reset_cmd;\n\tint (*reset) (struct ipr_cmnd *);\n\n\tchar ipr_cmd_label[8];\n#define IPR_CMD_LABEL\t\t\"ipr_cmd\"\n\tu32 max_cmds;\n\tstruct ipr_cmnd **ipr_cmnd_list;\n\tdma_addr_t *ipr_cmnd_list_dma;\n\n\tunsigned int nvectors;\n\n\tstruct {\n\t\tchar desc[22];\n\t} vectors_info[IPR_MAX_MSIX_VECTORS];\n\n\tu32 iopoll_weight;\n\n};  \n\nstruct ipr_cmnd {\n\tstruct ipr_ioarcb ioarcb;\n\tunion {\n\t\tstruct ipr_ioadl_desc ioadl[IPR_NUM_IOADL_ENTRIES];\n\t\tstruct ipr_ioadl64_desc ioadl64[IPR_NUM_IOADL_ENTRIES];\n\t} i;\n\tunion {\n\t\tstruct ipr_ioasa ioasa;\n\t\tstruct ipr_ioasa64 ioasa64;\n\t} s;\n\tstruct list_head queue;\n\tstruct scsi_cmnd *scsi_cmd;\n\tstruct completion completion;\n\tstruct timer_list timer;\n\tstruct work_struct work;\n\tvoid (*fast_done) (struct ipr_cmnd *);\n\tvoid (*done) (struct ipr_cmnd *);\n\tint (*job_step) (struct ipr_cmnd *);\n\tint (*job_step_failed) (struct ipr_cmnd *);\n\tu16 cmd_index;\n\tu8 sense_buffer[SCSI_SENSE_BUFFERSIZE];\n\tdma_addr_t sense_buffer_dma;\n\tunsigned short dma_use_sg;\n\tdma_addr_t dma_addr;\n\tstruct ipr_cmnd *sibling;\n\tunion {\n\t\tenum ipr_shutdown_type shutdown_type;\n\t\tstruct ipr_hostrcb *hostrcb;\n\t\tunsigned long time_left;\n\t\tunsigned long scratch;\n\t\tstruct ipr_resource_entry *res;\n\t\tstruct scsi_device *sdev;\n\t} u;\n\n\tstruct completion *eh_comp;\n\tstruct ipr_hrr_queue *hrrq;\n\tstruct ipr_ioa_cfg *ioa_cfg;\n};\n\nstruct ipr_ses_table_entry {\n\tchar product_id[17];\n\tchar compare_product_id_byte[17];\n\tu32 max_bus_speed_limit;\t \n};\n\nstruct ipr_dump_header {\n\tu32 eye_catcher;\n#define IPR_DUMP_EYE_CATCHER\t\t0xC5D4E3F2\n\tu32 len;\n\tu32 num_entries;\n\tu32 first_entry_offset;\n\tu32 status;\n#define IPR_DUMP_STATUS_SUCCESS\t\t\t0\n#define IPR_DUMP_STATUS_QUAL_SUCCESS\t\t2\n#define IPR_DUMP_STATUS_FAILED\t\t\t0xffffffff\n\tu32 os;\n#define IPR_DUMP_OS_LINUX\t0x4C4E5558\n\tu32 driver_name;\n#define IPR_DUMP_DRIVER_NAME\t0x49505232\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_dump_entry_header {\n\tu32 eye_catcher;\n#define IPR_DUMP_EYE_CATCHER\t\t0xC5D4E3F2\n\tu32 len;\n\tu32 num_elems;\n\tu32 offset;\n\tu32 data_type;\n#define IPR_DUMP_DATA_TYPE_ASCII\t0x41534349\n#define IPR_DUMP_DATA_TYPE_BINARY\t0x42494E41\n\tu32 id;\n#define IPR_DUMP_IOA_DUMP_ID\t\t0x494F4131\n#define IPR_DUMP_LOCATION_ID\t\t0x4C4F4341\n#define IPR_DUMP_TRACE_ID\t\t0x54524143\n#define IPR_DUMP_DRIVER_VERSION_ID\t0x44525652\n#define IPR_DUMP_DRIVER_TYPE_ID\t0x54595045\n#define IPR_DUMP_IOA_CTRL_BLK\t\t0x494F4342\n#define IPR_DUMP_PEND_OPS\t\t0x414F5053\n\tu32 status;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_dump_location_entry {\n\tstruct ipr_dump_entry_header hdr;\n\tu8 location[20];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_dump_trace_entry {\n\tstruct ipr_dump_entry_header hdr;\n\tu32 trace[IPR_TRACE_SIZE / sizeof(u32)];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_dump_version_entry {\n\tstruct ipr_dump_entry_header hdr;\n\tu8 version[sizeof(IPR_DRIVER_VERSION)];\n};\n\nstruct ipr_dump_ioa_type_entry {\n\tstruct ipr_dump_entry_header hdr;\n\tu32 type;\n\tu32 fw_version;\n};\n\nstruct ipr_driver_dump {\n\tstruct ipr_dump_header hdr;\n\tstruct ipr_dump_version_entry version_entry;\n\tstruct ipr_dump_location_entry location_entry;\n\tstruct ipr_dump_ioa_type_entry ioa_type_entry;\n\tstruct ipr_dump_trace_entry trace_entry;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_ioa_dump {\n\tstruct ipr_dump_entry_header hdr;\n\tstruct ipr_sdt sdt;\n\t__be32 **ioa_data;\n\tu32 reserved;\n\tu32 next_page_index;\n\tu32 page_offset;\n\tu32 format;\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_dump {\n\tstruct kref kref;\n\tstruct ipr_ioa_cfg *ioa_cfg;\n\tstruct ipr_driver_dump driver_dump;\n\tstruct ipr_ioa_dump ioa_dump;\n};\n\nstruct ipr_error_table_t {\n\tu32 ioasc;\n\tint log_ioasa;\n\tint log_hcam;\n\tchar *error;\n};\n\nstruct ipr_software_inq_lid_info {\n\t__be32 load_id;\n\t__be32 timestamp[3];\n}__attribute__((packed, aligned (4)));\n\nstruct ipr_ucode_image_header {\n\t__be32 header_length;\n\t__be32 lid_table_offset;\n\tu8 major_release;\n\tu8 card_type;\n\tu8 minor_release[2];\n\tu8 reserved[20];\n\tchar eyecatcher[16];\n\t__be32 num_lids;\n\tstruct ipr_software_inq_lid_info lid[1];\n}__attribute__((packed, aligned (4)));\n\n \n#define IPR_DBG_CMD(CMD) if (ipr_debug) { CMD; }\n\n#ifdef CONFIG_SCSI_IPR_TRACE\n#define ipr_create_trace_file(kobj, attr) sysfs_create_bin_file(kobj, attr)\n#define ipr_remove_trace_file(kobj, attr) sysfs_remove_bin_file(kobj, attr)\n#else\n#define ipr_create_trace_file(kobj, attr) 0\n#define ipr_remove_trace_file(kobj, attr) do { } while(0)\n#endif\n\n#ifdef CONFIG_SCSI_IPR_DUMP\n#define ipr_create_dump_file(kobj, attr) sysfs_create_bin_file(kobj, attr)\n#define ipr_remove_dump_file(kobj, attr) sysfs_remove_bin_file(kobj, attr)\n#else\n#define ipr_create_dump_file(kobj, attr) 0\n#define ipr_remove_dump_file(kobj, attr) do { } while(0)\n#endif\n\n \n#define ipr_err(...) printk(KERN_ERR IPR_NAME \": \"__VA_ARGS__)\n#define ipr_info(...) printk(KERN_INFO IPR_NAME \": \"__VA_ARGS__)\n#define ipr_dbg(...) IPR_DBG_CMD(printk(KERN_INFO IPR_NAME \": \"__VA_ARGS__))\n\n#define ipr_res_printk(level, ioa_cfg, bus, target, lun, fmt, ...) \\\n\tprintk(level IPR_NAME \": %d:%d:%d:%d: \" fmt, (ioa_cfg)->host->host_no, \\\n\t\tbus, target, lun, ##__VA_ARGS__)\n\n#define ipr_res_err(ioa_cfg, res, fmt, ...) \\\n\tipr_res_printk(KERN_ERR, ioa_cfg, (res)->bus, (res)->target, (res)->lun, fmt, ##__VA_ARGS__)\n\n#define ipr_ra_printk(level, ioa_cfg, ra, fmt, ...) \\\n\tprintk(level IPR_NAME \": %d:%d:%d:%d: \" fmt, (ioa_cfg)->host->host_no, \\\n\t\t(ra).bus, (ra).target, (ra).lun, ##__VA_ARGS__)\n\n#define ipr_ra_err(ioa_cfg, ra, fmt, ...) \\\n\tipr_ra_printk(KERN_ERR, ioa_cfg, ra, fmt, ##__VA_ARGS__)\n\n#define ipr_phys_res_err(ioa_cfg, res, fmt, ...)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tif ((res).bus >= IPR_MAX_NUM_BUSES) {\t\t\t\t\\\n\t\tipr_err(fmt\": unknown\\n\", ##__VA_ARGS__);\t\t\\\n\t} else {\t\t\t\t\t\t\t\\\n\t\tipr_err(fmt\": %d:%d:%d:%d\\n\",\t\t\t\t\\\n\t\t\t##__VA_ARGS__, (ioa_cfg)->host->host_no,\t\\\n\t\t\t(res).bus, (res).target, (res).lun);\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n}\n\n#define ipr_hcam_err(hostrcb, fmt, ...)\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tif (ipr_is_device(hostrcb)) {\t\t\t\t\t\\\n\t\tif ((hostrcb)->ioa_cfg->sis64) {\t\t\t\\\n\t\t\tprintk(KERN_ERR IPR_NAME \": %s: \" fmt, \t\t\\\n\t\t\t\tipr_format_res_path(hostrcb->ioa_cfg,\t\\\n\t\t\t\t\thostrcb->hcam.u.error64.fd_res_path, \\\n\t\t\t\t\thostrcb->rp_buffer,\t\t\\\n\t\t\t\t\tsizeof(hostrcb->rp_buffer)),\t\\\n\t\t\t\t__VA_ARGS__);\t\t\t\t\\\n\t\t} else {\t\t\t\t\t\t\\\n\t\t\tipr_ra_err((hostrcb)->ioa_cfg,\t\t\t\\\n\t\t\t\t(hostrcb)->hcam.u.error.fd_res_addr,\t\\\n\t\t\t\tfmt, __VA_ARGS__);\t\t\t\\\n\t\t}\t\t\t\t\t\t\t\\\n\t} else {\t\t\t\t\t\t\t\\\n\t\tdev_err(&(hostrcb)->ioa_cfg->pdev->dev, fmt, __VA_ARGS__); \\\n\t}\t\t\t\t\t\t\t\t\\\n}\n\n#define ipr_trace ipr_dbg(\"%s: %s: Line: %d\\n\",\\\n\t__FILE__, __func__, __LINE__)\n\n#define ENTER IPR_DBG_CMD(printk(KERN_INFO IPR_NAME\": Entering %s\\n\", __func__))\n#define LEAVE IPR_DBG_CMD(printk(KERN_INFO IPR_NAME\": Leaving %s\\n\", __func__))\n\n#define ipr_err_separator \\\nipr_err(\"----------------------------------------------------------\\n\")\n\n\n \n\n \nstatic inline int ipr_is_ioa_resource(struct ipr_resource_entry *res)\n{\n\treturn res->type == IPR_RES_TYPE_IOAFP;\n}\n\n \nstatic inline int ipr_is_af_dasd_device(struct ipr_resource_entry *res)\n{\n\treturn res->type == IPR_RES_TYPE_AF_DASD ||\n\t\tres->type == IPR_RES_TYPE_REMOTE_AF_DASD;\n}\n\n \nstatic inline int ipr_is_vset_device(struct ipr_resource_entry *res)\n{\n\treturn res->type == IPR_RES_TYPE_VOLUME_SET;\n}\n\n \nstatic inline int ipr_is_gscsi(struct ipr_resource_entry *res)\n{\n\treturn res->type == IPR_RES_TYPE_GENERIC_SCSI;\n}\n\n \nstatic inline int ipr_is_scsi_disk(struct ipr_resource_entry *res)\n{\n\tif (ipr_is_af_dasd_device(res) ||\n\t    (ipr_is_gscsi(res) && IPR_IS_DASD_DEVICE(res->std_inq_data)))\n\t\treturn 1;\n\telse\n\t\treturn 0;\n}\n\n \nstatic inline int ipr_is_gata(struct ipr_resource_entry *res)\n{\n\treturn res->type == IPR_RES_TYPE_GENERIC_ATA;\n}\n\n \nstatic inline int ipr_is_naca_model(struct ipr_resource_entry *res)\n{\n\tif (ipr_is_gscsi(res) && res->qmodel == IPR_QUEUE_NACA_MODEL)\n\t\treturn 1;\n\treturn 0;\n}\n\n \nstatic inline int ipr_is_device(struct ipr_hostrcb *hostrcb)\n{\n\tstruct ipr_res_addr *res_addr;\n\tu8 *res_path;\n\n\tif (hostrcb->ioa_cfg->sis64) {\n\t\tres_path = &hostrcb->hcam.u.error64.fd_res_path[0];\n\t\tif ((res_path[0] == 0x00 || res_path[0] == 0x80 ||\n\t\t    res_path[0] == 0x81) && res_path[2] != 0xFF)\n\t\t\treturn 1;\n\t} else {\n\t\tres_addr = &hostrcb->hcam.u.error.fd_res_addr;\n\n\t\tif ((res_addr->bus < IPR_MAX_NUM_BUSES) &&\n\t\t    (res_addr->target < (IPR_MAX_NUM_TARGETS_PER_BUS - 1)))\n\t\t\treturn 1;\n\t}\n\treturn 0;\n}\n\n \nstatic inline int ipr_sdt_is_fmt2(u32 sdt_word)\n{\n\tu32 bar_sel = IPR_GET_FMT2_BAR_SEL(sdt_word);\n\n\tswitch (bar_sel) {\n\tcase IPR_SDT_FMT2_BAR0_SEL:\n\tcase IPR_SDT_FMT2_BAR1_SEL:\n\tcase IPR_SDT_FMT2_BAR2_SEL:\n\tcase IPR_SDT_FMT2_BAR3_SEL:\n\tcase IPR_SDT_FMT2_BAR4_SEL:\n\tcase IPR_SDT_FMT2_BAR5_SEL:\n\tcase IPR_SDT_FMT2_EXP_ROM_SEL:\n\t\treturn 1;\n\t};\n\n\treturn 0;\n}\n\n#ifndef writeq\nstatic inline void writeq(u64 val, void __iomem *addr)\n{\n        writel(((u32) (val >> 32)), addr);\n        writel(((u32) (val)), (addr + 4));\n}\n#endif\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}