{
  "module_name": "scsi_trace.c",
  "hash_id": "85612a13f377f8fc02c79da6f46f6a0033108b3c9495019cb4266ae5f10ab1d2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/scsi_trace.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/trace_seq.h>\n#include <asm/unaligned.h>\n#include <trace/events/scsi.h>\n\n#define SERVICE_ACTION16(cdb) (cdb[1] & 0x1f)\n#define SERVICE_ACTION32(cdb) (get_unaligned_be16(&cdb[8]))\n\nstatic const char *\nscsi_trace_misc(struct trace_seq *, unsigned char *, int);\n\nstatic const char *\nscsi_trace_rw6(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\tu32 lba, txlen;\n\n\tlba = get_unaligned_be24(&cdb[1]) & 0x1fffff;\n\t \n\ttxlen = cdb[4] ? cdb[4] : 256;\n\n\ttrace_seq_printf(p, \"lba=%u txlen=%u\", lba, txlen);\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_rw10(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\tu32 lba, txlen;\n\n\tlba = get_unaligned_be32(&cdb[2]);\n\ttxlen = get_unaligned_be16(&cdb[7]);\n\n\ttrace_seq_printf(p, \"lba=%u txlen=%u protect=%u\", lba, txlen,\n\t\t\t cdb[1] >> 5);\n\n\tif (cdb[0] == WRITE_SAME)\n\t\ttrace_seq_printf(p, \" unmap=%u\", cdb[1] >> 3 & 1);\n\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_rw12(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\tu32 lba, txlen;\n\n\tlba = get_unaligned_be32(&cdb[2]);\n\ttxlen = get_unaligned_be32(&cdb[6]);\n\n\ttrace_seq_printf(p, \"lba=%u txlen=%u protect=%u\", lba, txlen,\n\t\t\t cdb[1] >> 5);\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_rw16(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\tu64 lba;\n\tu32 txlen;\n\n\tlba = get_unaligned_be64(&cdb[2]);\n\ttxlen = get_unaligned_be32(&cdb[10]);\n\n\ttrace_seq_printf(p, \"lba=%llu txlen=%u protect=%u\", lba, txlen,\n\t\t\t cdb[1] >> 5);\n\n\tif (cdb[0] == WRITE_SAME_16)\n\t\ttrace_seq_printf(p, \" unmap=%u\", cdb[1] >> 3 & 1);\n\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_rw32(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p), *cmd;\n\tu64 lba;\n\tu32 ei_lbrt, txlen;\n\n\tswitch (SERVICE_ACTION32(cdb)) {\n\tcase READ_32:\n\t\tcmd = \"READ\";\n\t\tbreak;\n\tcase VERIFY_32:\n\t\tcmd = \"VERIFY\";\n\t\tbreak;\n\tcase WRITE_32:\n\t\tcmd = \"WRITE\";\n\t\tbreak;\n\tcase WRITE_SAME_32:\n\t\tcmd = \"WRITE_SAME\";\n\t\tbreak;\n\tdefault:\n\t\ttrace_seq_puts(p, \"UNKNOWN\");\n\t\tgoto out;\n\t}\n\n\tlba = get_unaligned_be64(&cdb[12]);\n\tei_lbrt = get_unaligned_be32(&cdb[20]);\n\ttxlen = get_unaligned_be32(&cdb[28]);\n\n\ttrace_seq_printf(p, \"%s_32 lba=%llu txlen=%u protect=%u ei_lbrt=%u\",\n\t\t\t cmd, lba, txlen, cdb[10] >> 5, ei_lbrt);\n\n\tif (SERVICE_ACTION32(cdb) == WRITE_SAME_32)\n\t\ttrace_seq_printf(p, \" unmap=%u\", cdb[10] >> 3 & 1);\n\nout:\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_unmap(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\tunsigned int regions = get_unaligned_be16(&cdb[7]);\n\n\ttrace_seq_printf(p, \"regions=%u\", (regions - 8) / 16);\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_service_action_in(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p), *cmd;\n\tu64 lba;\n\tu32 alloc_len;\n\n\tswitch (SERVICE_ACTION16(cdb)) {\n\tcase SAI_READ_CAPACITY_16:\n\t\tcmd = \"READ_CAPACITY_16\";\n\t\tbreak;\n\tcase SAI_GET_LBA_STATUS:\n\t\tcmd = \"GET_LBA_STATUS\";\n\t\tbreak;\n\tdefault:\n\t\ttrace_seq_puts(p, \"UNKNOWN\");\n\t\tgoto out;\n\t}\n\n\tlba = get_unaligned_be64(&cdb[2]);\n\talloc_len = get_unaligned_be32(&cdb[10]);\n\n\ttrace_seq_printf(p, \"%s lba=%llu alloc_len=%u\", cmd, lba, alloc_len);\n\nout:\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_maintenance_in(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p), *cmd;\n\tu32 alloc_len;\n\n\tswitch (SERVICE_ACTION16(cdb)) {\n\tcase MI_REPORT_IDENTIFYING_INFORMATION:\n\t\tcmd = \"REPORT_IDENTIFYING_INFORMATION\";\n\t\tbreak;\n\tcase MI_REPORT_TARGET_PGS:\n\t\tcmd = \"REPORT_TARGET_PORT_GROUPS\";\n\t\tbreak;\n\tcase MI_REPORT_ALIASES:\n\t\tcmd = \"REPORT_ALIASES\";\n\t\tbreak;\n\tcase MI_REPORT_SUPPORTED_OPERATION_CODES:\n\t\tcmd = \"REPORT_SUPPORTED_OPERATION_CODES\";\n\t\tbreak;\n\tcase MI_REPORT_SUPPORTED_TASK_MANAGEMENT_FUNCTIONS:\n\t\tcmd = \"REPORT_SUPPORTED_TASK_MANAGEMENT_FUNCTIONS\";\n\t\tbreak;\n\tcase MI_REPORT_PRIORITY:\n\t\tcmd = \"REPORT_PRIORITY\";\n\t\tbreak;\n\tcase MI_REPORT_TIMESTAMP:\n\t\tcmd = \"REPORT_TIMESTAMP\";\n\t\tbreak;\n\tcase MI_MANAGEMENT_PROTOCOL_IN:\n\t\tcmd = \"MANAGEMENT_PROTOCOL_IN\";\n\t\tbreak;\n\tdefault:\n\t\ttrace_seq_puts(p, \"UNKNOWN\");\n\t\tgoto out;\n\t}\n\n\talloc_len = get_unaligned_be32(&cdb[6]);\n\n\ttrace_seq_printf(p, \"%s alloc_len=%u\", cmd, alloc_len);\n\nout:\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_maintenance_out(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p), *cmd;\n\tu32 alloc_len;\n\n\tswitch (SERVICE_ACTION16(cdb)) {\n\tcase MO_SET_IDENTIFYING_INFORMATION:\n\t\tcmd = \"SET_IDENTIFYING_INFORMATION\";\n\t\tbreak;\n\tcase MO_SET_TARGET_PGS:\n\t\tcmd = \"SET_TARGET_PORT_GROUPS\";\n\t\tbreak;\n\tcase MO_CHANGE_ALIASES:\n\t\tcmd = \"CHANGE_ALIASES\";\n\t\tbreak;\n\tcase MO_SET_PRIORITY:\n\t\tcmd = \"SET_PRIORITY\";\n\t\tbreak;\n\tcase MO_SET_TIMESTAMP:\n\t\tcmd = \"SET_TIMESTAMP\";\n\t\tbreak;\n\tcase MO_MANAGEMENT_PROTOCOL_OUT:\n\t\tcmd = \"MANAGEMENT_PROTOCOL_OUT\";\n\t\tbreak;\n\tdefault:\n\t\ttrace_seq_puts(p, \"UNKNOWN\");\n\t\tgoto out;\n\t}\n\n\talloc_len = get_unaligned_be32(&cdb[6]);\n\n\ttrace_seq_printf(p, \"%s alloc_len=%u\", cmd, alloc_len);\n\nout:\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_zbc_in(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p), *cmd;\n\tu64 zone_id;\n\tu32 alloc_len;\n\tu8 options;\n\n\tswitch (SERVICE_ACTION16(cdb)) {\n\tcase ZI_REPORT_ZONES:\n\t\tcmd = \"REPORT_ZONES\";\n\t\tbreak;\n\tdefault:\n\t\ttrace_seq_puts(p, \"UNKNOWN\");\n\t\tgoto out;\n\t}\n\n\tzone_id = get_unaligned_be64(&cdb[2]);\n\talloc_len = get_unaligned_be32(&cdb[10]);\n\toptions = cdb[14] & 0x3f;\n\n\ttrace_seq_printf(p, \"%s zone=%llu alloc_len=%u options=%u partial=%u\",\n\t\t\t cmd, (unsigned long long)zone_id, alloc_len,\n\t\t\t options, (cdb[14] >> 7) & 1);\n\nout:\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_zbc_out(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p), *cmd;\n\tu64 zone_id;\n\n\tswitch (SERVICE_ACTION16(cdb)) {\n\tcase ZO_CLOSE_ZONE:\n\t\tcmd = \"CLOSE_ZONE\";\n\t\tbreak;\n\tcase ZO_FINISH_ZONE:\n\t\tcmd = \"FINISH_ZONE\";\n\t\tbreak;\n\tcase ZO_OPEN_ZONE:\n\t\tcmd = \"OPEN_ZONE\";\n\t\tbreak;\n\tcase ZO_RESET_WRITE_POINTER:\n\t\tcmd = \"RESET_WRITE_POINTER\";\n\t\tbreak;\n\tdefault:\n\t\ttrace_seq_puts(p, \"UNKNOWN\");\n\t\tgoto out;\n\t}\n\n\tzone_id = get_unaligned_be64(&cdb[2]);\n\n\ttrace_seq_printf(p, \"%s zone=%llu all=%u\", cmd,\n\t\t\t (unsigned long long)zone_id, cdb[14] & 1);\n\nout:\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nstatic const char *\nscsi_trace_varlen(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tswitch (SERVICE_ACTION32(cdb)) {\n\tcase READ_32:\n\tcase VERIFY_32:\n\tcase WRITE_32:\n\tcase WRITE_SAME_32:\n\t\treturn scsi_trace_rw32(p, cdb, len);\n\tdefault:\n\t\treturn scsi_trace_misc(p, cdb, len);\n\t}\n}\n\nstatic const char *\nscsi_trace_misc(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\n\ttrace_seq_putc(p, '-');\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nconst char *\nscsi_trace_parse_cdb(struct trace_seq *p, unsigned char *cdb, int len)\n{\n\tswitch (cdb[0]) {\n\tcase READ_6:\n\tcase WRITE_6:\n\t\treturn scsi_trace_rw6(p, cdb, len);\n\tcase READ_10:\n\tcase VERIFY:\n\tcase WRITE_10:\n\tcase WRITE_SAME:\n\t\treturn scsi_trace_rw10(p, cdb, len);\n\tcase READ_12:\n\tcase VERIFY_12:\n\tcase WRITE_12:\n\t\treturn scsi_trace_rw12(p, cdb, len);\n\tcase READ_16:\n\tcase VERIFY_16:\n\tcase WRITE_16:\n\tcase WRITE_SAME_16:\n\t\treturn scsi_trace_rw16(p, cdb, len);\n\tcase UNMAP:\n\t\treturn scsi_trace_unmap(p, cdb, len);\n\tcase SERVICE_ACTION_IN_16:\n\t\treturn scsi_trace_service_action_in(p, cdb, len);\n\tcase VARIABLE_LENGTH_CMD:\n\t\treturn scsi_trace_varlen(p, cdb, len);\n\tcase MAINTENANCE_IN:\n\t\treturn scsi_trace_maintenance_in(p, cdb, len);\n\tcase MAINTENANCE_OUT:\n\t\treturn scsi_trace_maintenance_out(p, cdb, len);\n\tcase ZBC_IN:\n\t\treturn scsi_trace_zbc_in(p, cdb, len);\n\tcase ZBC_OUT:\n\t\treturn scsi_trace_zbc_out(p, cdb, len);\n\tdefault:\n\t\treturn scsi_trace_misc(p, cdb, len);\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}