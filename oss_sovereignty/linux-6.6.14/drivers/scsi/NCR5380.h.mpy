{
  "module_name": "NCR5380.h",
  "hash_id": "0c10a323c69dc6c9cc4fcd6508582d77d98408d4acd6012852f4da366953d476",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/NCR5380.h",
  "human_readable_source": " \n \n\n#ifndef NCR5380_H\n#define NCR5380_H\n\n#include <linux/delay.h>\n#include <linux/interrupt.h>\n#include <linux/list.h>\n#include <linux/workqueue.h>\n#include <scsi/scsi_dbg.h>\n#include <scsi/scsi_eh.h>\n#include <scsi/scsi_transport_spi.h>\n\n#define NDEBUG_ARBITRATION\t0x1\n#define NDEBUG_AUTOSENSE\t0x2\n#define NDEBUG_DMA\t\t0x4\n#define NDEBUG_HANDSHAKE\t0x8\n#define NDEBUG_INFORMATION\t0x10\n#define NDEBUG_INIT\t\t0x20\n#define NDEBUG_INTR\t\t0x40\n#define NDEBUG_LINKED\t\t0x80\n#define NDEBUG_MAIN\t\t0x100\n#define NDEBUG_NO_DATAOUT\t0x200\n#define NDEBUG_NO_WRITE\t\t0x400\n#define NDEBUG_PIO\t\t0x800\n#define NDEBUG_PSEUDO_DMA\t0x1000\n#define NDEBUG_QUEUES\t\t0x2000\n#define NDEBUG_RESELECTION\t0x4000\n#define NDEBUG_SELECTION\t0x8000\n#define NDEBUG_USLEEP\t\t0x10000\n#define NDEBUG_LAST_BYTE_SENT\t0x20000\n#define NDEBUG_RESTART_SELECT\t0x40000\n#define NDEBUG_EXTENDED\t\t0x80000\n#define NDEBUG_C400_PREAD\t0x100000\n#define NDEBUG_C400_PWRITE\t0x200000\n#define NDEBUG_LISTS\t\t0x400000\n#define NDEBUG_ABORT\t\t0x800000\n#define NDEBUG_TAGS\t\t0x1000000\n#define NDEBUG_MERGING\t\t0x2000000\n\n#define NDEBUG_ANY\t\t0xFFFFFFFFUL\n\n \n\n#define OUTPUT_DATA_REG         0\t \n#define CURRENT_SCSI_DATA_REG   0\t \n\n#define INITIATOR_COMMAND_REG\t1\t \n#define ICR_ASSERT_RST\t\t0x80\t \n#define ICR_ARBITRATION_PROGRESS 0x40\t \n#define ICR_TRI_STATE\t\t0x40\t \n#define ICR_ARBITRATION_LOST\t0x20\t \n#define ICR_DIFF_ENABLE\t\t0x20\t \n#define ICR_ASSERT_ACK\t\t0x10\t \n#define ICR_ASSERT_BSY\t\t0x08\t \n#define ICR_ASSERT_SEL \t\t0x04\t \n#define ICR_ASSERT_ATN\t\t0x02\t \n#define ICR_ASSERT_DATA\t\t0x01\t \n\n#define ICR_BASE\t\t0\n\n#define MODE_REG\t\t2\n \n#define MR_BLOCK_DMA_MODE\t0x80\t \n#define MR_TARGET\t\t0x40\t \n#define MR_ENABLE_PAR_CHECK\t0x20\t \n#define MR_ENABLE_PAR_INTR\t0x10\t \n#define MR_ENABLE_EOP_INTR\t0x08\t \n#define MR_MONITOR_BSY\t\t0x04\t \n#define MR_DMA_MODE\t\t0x02\t \n#define MR_ARBITRATE\t\t0x01\t \n\n#define MR_BASE\t\t\t0\n\n#define TARGET_COMMAND_REG\t3\n#define TCR_LAST_BYTE_SENT\t0x80\t \n#define TCR_ASSERT_REQ\t\t0x08\t \n#define TCR_ASSERT_MSG\t\t0x04\t \n#define TCR_ASSERT_CD\t\t0x02\t \n#define TCR_ASSERT_IO\t\t0x01\t \n\n#define STATUS_REG\t\t4\t \n \n#define SR_RST\t\t\t0x80\n#define SR_BSY\t\t\t0x40\n#define SR_REQ\t\t\t0x20\n#define SR_MSG\t\t\t0x10\n#define SR_CD\t\t\t0x08\n#define SR_IO\t\t\t0x04\n#define SR_SEL\t\t\t0x02\n#define SR_DBP\t\t\t0x01\n\n \n#define SELECT_ENABLE_REG\t4\t \n\n#define BUS_AND_STATUS_REG\t5\t \n#define BASR_END_DMA_TRANSFER\t0x80\t \n#define BASR_DRQ\t\t0x40\t \n#define BASR_PARITY_ERROR\t0x20\t \n#define BASR_IRQ\t\t0x10\t \n#define BASR_PHASE_MATCH\t0x08\t \n#define BASR_BUSY_ERROR\t\t0x04\t \n#define BASR_ATN \t\t0x02\t \n#define BASR_ACK\t\t0x01\t \n\n \n#define START_DMA_SEND_REG\t5\t \n\n \n#define INPUT_DATA_REG\t\t\t6\t \n\n \n#define START_DMA_TARGET_RECEIVE_REG\t6\t \n\n \n#define RESET_PARITY_INTERRUPT_REG\t7\t \n\n \n#define START_DMA_INITIATOR_RECEIVE_REG 7\t \n\n \n#define CSR_RESET              0x80\t \n#define CSR_53C80_REG          0x80\t \n#define CSR_TRANS_DIR          0x40\t \n#define CSR_SCSI_BUFF_INTR     0x20\t \n#define CSR_53C80_INTR         0x10\t \n#define CSR_SHARED_INTR        0x08\t \n#define CSR_HOST_BUF_NOT_RDY   0x04\t \n#define CSR_SCSI_BUF_RDY       0x02\t \n#define CSR_GATED_53C80_IRQ    0x01\t \n\n#define CSR_BASE CSR_53C80_INTR\n\n \n#define PHASE_MASK \t(SR_MSG | SR_CD | SR_IO)\n\n#define PHASE_DATAOUT\t\t0\n#define PHASE_DATAIN\t\tSR_IO\n#define PHASE_CMDOUT\t\tSR_CD\n#define PHASE_STATIN\t\t(SR_CD | SR_IO)\n#define PHASE_MSGOUT\t\t(SR_MSG | SR_CD)\n#define PHASE_MSGIN\t\t(SR_MSG | SR_CD | SR_IO)\n#define PHASE_UNKNOWN\t\t0xff\n\n \n\n#define PHASE_SR_TO_TCR(phase) ((phase) >> 2)\n\n#ifndef NO_IRQ\n#define NO_IRQ\t\t0\n#endif\n\n#define FLAG_DMA_FIXUP\t\t\t1\t \n#define FLAG_NO_PSEUDO_DMA\t\t8\t \n#define FLAG_LATE_DMA_SETUP\t\t32\t \n#define FLAG_TOSHIBA_DELAY\t\t128\t \n\nstruct NCR5380_hostdata {\n\tNCR5380_implementation_fields;\t\t \n\tu8 __iomem *io;\t\t\t\t \n\tu8 __iomem *pdma_io;\t\t\t \n\tunsigned long poll_loops;\t\t \n\tspinlock_t lock;\t\t\t \n\tstruct scsi_cmnd *connected;\t\t \n\tstruct list_head disconnected;\t\t \n\tstruct Scsi_Host *host;\t\t\t \n\tstruct workqueue_struct *work_q;\t \n\tstruct work_struct main_task;\t\t \n\tint flags;\t\t\t\t \n\tint dma_len;\t\t\t\t \n\tint read_overruns;\t \n\tunsigned long io_port;\t\t\t \n\tunsigned long base;\t\t\t \n\tstruct list_head unissued;\t\t \n\tstruct scsi_cmnd *selecting;\t\t \n\tstruct list_head autosense;\t\t \n\tstruct scsi_cmnd *sensing;\t\t \n\tstruct scsi_eh_save ses;\t\t \n\tunsigned char busy[8];\t\t\t \n\tunsigned char id_mask;\t\t\t \n\tunsigned char id_higher_mask;\t\t \n\tunsigned char last_message;\t\t \n\tunsigned long region_size;\t\t \n\tchar info[168];\t\t\t\t \n};\n\nstruct NCR5380_cmd {\n\tchar *ptr;\n\tint this_residual;\n\tstruct scatterlist *buffer;\n\tint status;\n\tint message;\n\tint phase;\n\tstruct list_head list;\n};\n\n#define NCR5380_PIO_CHUNK_SIZE\t\t256\n\n \n#define NCR5380_REG_POLL_TIME\t\t10\n\nstatic inline struct scsi_cmnd *NCR5380_to_scmd(struct NCR5380_cmd *ncmd_ptr)\n{\n\treturn ((struct scsi_cmnd *)ncmd_ptr) - 1;\n}\n\nstatic inline struct NCR5380_cmd *NCR5380_to_ncmd(struct scsi_cmnd *cmd)\n{\n\treturn scsi_cmd_priv(cmd);\n}\n\n#ifndef NDEBUG\n#define NDEBUG (0)\n#endif\n\n#define dprintk(flg, fmt, ...) \\\n\tdo { if ((NDEBUG) & (flg)) \\\n\t\tprintk(KERN_DEBUG fmt, ## __VA_ARGS__); } while (0)\n\n#define dsprintk(flg, host, fmt, ...) \\\n\tdo { if ((NDEBUG) & (flg)) \\\n\t\tshost_printk(KERN_DEBUG, host, fmt, ## __VA_ARGS__); \\\n\t} while (0)\n\n#if NDEBUG\n#define NCR5380_dprint(flg, arg) \\\n\tdo { if ((NDEBUG) & (flg)) NCR5380_print(arg); } while (0)\n#define NCR5380_dprint_phase(flg, arg) \\\n\tdo { if ((NDEBUG) & (flg)) NCR5380_print_phase(arg); } while (0)\nstatic void NCR5380_print_phase(struct Scsi_Host *instance);\nstatic void NCR5380_print(struct Scsi_Host *instance);\n#else\n#define NCR5380_dprint(flg, arg)       do {} while (0)\n#define NCR5380_dprint_phase(flg, arg) do {} while (0)\n#endif\n\nstatic int NCR5380_init(struct Scsi_Host *instance, int flags);\nstatic int NCR5380_maybe_reset_bus(struct Scsi_Host *);\nstatic void NCR5380_exit(struct Scsi_Host *instance);\nstatic void NCR5380_information_transfer(struct Scsi_Host *instance);\nstatic irqreturn_t NCR5380_intr(int irq, void *dev_id);\nstatic void NCR5380_main(struct work_struct *work);\nstatic const char *NCR5380_info(struct Scsi_Host *instance);\nstatic void NCR5380_reselect(struct Scsi_Host *instance);\nstatic bool NCR5380_select(struct Scsi_Host *, struct scsi_cmnd *);\nstatic int NCR5380_transfer_dma(struct Scsi_Host *instance, unsigned char *phase, int *count, unsigned char **data);\nstatic int NCR5380_transfer_pio(struct Scsi_Host *instance, unsigned char *phase, int *count, unsigned char **data,\n\t\t\t\tunsigned int can_sleep);\nstatic int NCR5380_poll_politely2(struct NCR5380_hostdata *,\n                                  unsigned int, u8, u8,\n                                  unsigned int, u8, u8, unsigned long);\n\nstatic inline int NCR5380_poll_politely(struct NCR5380_hostdata *hostdata,\n                                        unsigned int reg, u8 bit, u8 val,\n                                        unsigned long wait)\n{\n\tif ((NCR5380_read(reg) & bit) == val)\n\t\treturn 0;\n\n\treturn NCR5380_poll_politely2(hostdata, reg, bit, val,\n\t\t\t\t\t\treg, bit, val, wait);\n}\n\nstatic int NCR5380_dma_xfer_len(struct NCR5380_hostdata *,\n                                struct scsi_cmnd *);\nstatic int NCR5380_dma_send_setup(struct NCR5380_hostdata *,\n                                  unsigned char *, int);\nstatic int NCR5380_dma_recv_setup(struct NCR5380_hostdata *,\n                                  unsigned char *, int);\nstatic int NCR5380_dma_residual(struct NCR5380_hostdata *);\n\nstatic inline int NCR5380_dma_xfer_none(struct NCR5380_hostdata *hostdata,\n                                        struct scsi_cmnd *cmd)\n{\n\treturn 0;\n}\n\nstatic inline int NCR5380_dma_setup_none(struct NCR5380_hostdata *hostdata,\n                                         unsigned char *data, int count)\n{\n\treturn 0;\n}\n\nstatic inline int NCR5380_dma_residual_none(struct NCR5380_hostdata *hostdata)\n{\n\treturn 0;\n}\n\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}