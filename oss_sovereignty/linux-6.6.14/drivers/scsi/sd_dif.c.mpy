{
  "module_name": "sd_dif.c",
  "hash_id": "46c57c1718f8b43fbdd2f0bdb309d3506e5471958f4403f9830ec03529ec163a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/sd_dif.c",
  "human_readable_source": "\n \n\n#include <linux/blk-integrity.h>\n#include <linux/t10-pi.h>\n\n#include <scsi/scsi.h>\n#include <scsi/scsi_cmnd.h>\n#include <scsi/scsi_dbg.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_driver.h>\n#include <scsi/scsi_eh.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_ioctl.h>\n#include <scsi/scsicam.h>\n\n#include \"sd.h\"\n\n \nvoid sd_dif_config_host(struct scsi_disk *sdkp)\n{\n\tstruct scsi_device *sdp = sdkp->device;\n\tstruct gendisk *disk = sdkp->disk;\n\tu8 type = sdkp->protection_type;\n\tstruct blk_integrity bi;\n\tint dif, dix;\n\n\tdif = scsi_host_dif_capable(sdp->host, type);\n\tdix = scsi_host_dix_capable(sdp->host, type);\n\n\tif (!dix && scsi_host_dix_capable(sdp->host, 0)) {\n\t\tdif = 0; dix = 1;\n\t}\n\n\tif (!dix) {\n\t\tblk_integrity_unregister(disk);\n\t\treturn;\n\t}\n\n\tmemset(&bi, 0, sizeof(bi));\n\n\t \n\tif (scsi_host_get_guard(sdkp->device->host) & SHOST_DIX_GUARD_IP) {\n\t\tif (type == T10_PI_TYPE3_PROTECTION)\n\t\t\tbi.profile = &t10_pi_type3_ip;\n\t\telse\n\t\t\tbi.profile = &t10_pi_type1_ip;\n\n\t\tbi.flags |= BLK_INTEGRITY_IP_CHECKSUM;\n\t} else\n\t\tif (type == T10_PI_TYPE3_PROTECTION)\n\t\t\tbi.profile = &t10_pi_type3_crc;\n\t\telse\n\t\t\tbi.profile = &t10_pi_type1_crc;\n\n\tbi.tuple_size = sizeof(struct t10_pi_tuple);\n\n\tif (dif && type) {\n\t\tbi.flags |= BLK_INTEGRITY_DEVICE_CAPABLE;\n\n\t\tif (!sdkp->ATO)\n\t\t\tgoto out;\n\n\t\tif (type == T10_PI_TYPE3_PROTECTION)\n\t\t\tbi.tag_size = sizeof(u16) + sizeof(u32);\n\t\telse\n\t\t\tbi.tag_size = sizeof(u16);\n\t}\n\n\tsd_first_printk(KERN_NOTICE, sdkp,\n\t\t\t\"Enabling DIX %s, application tag size %u bytes\\n\",\n\t\t\tbi.profile->name, bi.tag_size);\nout:\n\tblk_integrity_register(disk, &bi);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}