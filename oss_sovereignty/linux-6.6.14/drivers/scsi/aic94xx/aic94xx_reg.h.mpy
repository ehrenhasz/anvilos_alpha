{
  "module_name": "aic94xx_reg.h",
  "hash_id": "f2a57bbcb46cf1147c9d74ae929dc883fe7476b2361c5397e93fce3ff6b08281",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/aic94xx/aic94xx_reg.h",
  "human_readable_source": " \n \n\n#ifndef _AIC94XX_REG_H_\n#define _AIC94XX_REG_H_\n\n#include <asm/io.h>\n#include \"aic94xx_hwi.h\"\n\n \n#define AIC9410_DEV_REV_B0            0x8\n\n \n#define REG_BASE_ADDR                 0xB8000000\n#define REG_BASE_ADDR_CSEQCIO         0xB8002000\n#define REG_BASE_ADDR_EXSI            0xB8042800\n\n#define MBAR0_SWA_SIZE                0x58\nextern  u32    MBAR0_SWB_SIZE;\n#define MBAR0_SWC_SIZE                0x8\n\n \n#define OCM_BASE_ADDR                 0xA0000000\n#define OCM_MAX_SIZE                  0x20000\n\n \n#define ALL_BASE_ADDR                 OCM_BASE_ADDR\n\n \n#define PCI_IOBAR_OFFSET              4\n\n#define PCI_CONF_MBAR1                0x6C\n#define PCI_CONF_MBAR0_SWA            0x70\n#define PCI_CONF_MBAR0_SWB            0x74\n#define PCI_CONF_MBAR0_SWC            0x78\n#define PCI_CONF_MBAR_KEY             0x7C\n#define PCI_CONF_FLSH_BAR             0xB8\n\n#include \"aic94xx_reg_def.h\"\n\nu8  asd_read_reg_byte(struct asd_ha_struct *asd_ha, u32 reg);\nu16 asd_read_reg_word(struct asd_ha_struct *asd_ha, u32 reg);\nu32 asd_read_reg_dword(struct asd_ha_struct *asd_ha, u32 reg);\n\nvoid asd_write_reg_byte(struct asd_ha_struct *asd_ha, u32 reg, u8 val);\nvoid asd_write_reg_word(struct asd_ha_struct *asd_ha, u32 reg, u16 val);\nvoid asd_write_reg_dword(struct asd_ha_struct *asd_ha, u32 reg, u32 val);\n\nvoid asd_read_reg_string(struct asd_ha_struct *asd_ha, void *dst,\n\t\t\t u32 offs, int count);\nvoid asd_write_reg_string(struct asd_ha_struct *asd_ha, void *src,\n\t\t\t  u32 offs, int count);\n\n#define ASD_READ_OCM(type, ord, S)                                    \\\nstatic inline type asd_read_ocm_##ord (struct asd_ha_struct *asd_ha,  \\\n\t\t\t\t\t u32 offs)                    \\\n{                                                                     \\\n\tstruct asd_ha_addrspace *io_handle = &asd_ha->io_handle[1];   \\\n\ttype val = read##S (io_handle->addr + (unsigned long) offs);  \\\n\trmb();                                                        \\\n\treturn val;                                                   \\\n}\n\nASD_READ_OCM(u8, byte, b);\nASD_READ_OCM(u16,word, w);\nASD_READ_OCM(u32,dword,l);\n\n#define ASD_WRITE_OCM(type, ord, S)                                    \\\nstatic inline void asd_write_ocm_##ord (struct asd_ha_struct *asd_ha,  \\\n\t\t\t\t\t u32 offs, type val)          \\\n{                                                                     \\\n\tstruct asd_ha_addrspace *io_handle = &asd_ha->io_handle[1];   \\\n\twrite##S (val, io_handle->addr + (unsigned long) offs);       \\\n\treturn;                                                       \\\n}\n\nASD_WRITE_OCM(u8, byte, b);\nASD_WRITE_OCM(u16,word, w);\nASD_WRITE_OCM(u32,dword,l);\n\n#define ASD_DDBSITE_READ(type, ord)                                        \\\nstatic inline type asd_ddbsite_read_##ord (struct asd_ha_struct *asd_ha,   \\\n\t\t\t\t\t   u16 ddb_site_no,                \\\n\t\t\t\t\t   u16 offs)                       \\\n{                                                                          \\\n\tasd_write_reg_word(asd_ha, ALTCIOADR, MnDDB_SITE + offs);          \\\n\tasd_write_reg_word(asd_ha, ADDBPTR, ddb_site_no);                  \\\n\treturn asd_read_reg_##ord (asd_ha, CTXACCESS);                     \\\n}\n\nASD_DDBSITE_READ(u32, dword);\nASD_DDBSITE_READ(u16, word);\n\nstatic inline u8 asd_ddbsite_read_byte(struct asd_ha_struct *asd_ha,\n\t\t\t\t       u16 ddb_site_no,\n\t\t\t\t       u16 offs)\n{\n\tif (offs & 1)\n\t\treturn asd_ddbsite_read_word(asd_ha, ddb_site_no,\n\t\t\t\t\t     offs & ~1) >> 8;\n\telse\n\t\treturn asd_ddbsite_read_word(asd_ha, ddb_site_no,\n\t\t\t\t\t     offs) & 0xFF;\n}\n\n\n#define ASD_DDBSITE_WRITE(type, ord)                                       \\\nstatic inline void asd_ddbsite_write_##ord (struct asd_ha_struct *asd_ha,  \\\n\t\t\t\t\tu16 ddb_site_no,                   \\\n\t\t\t\t\tu16 offs, type val)                \\\n{                                                                          \\\n\tasd_write_reg_word(asd_ha, ALTCIOADR, MnDDB_SITE + offs);          \\\n\tasd_write_reg_word(asd_ha, ADDBPTR, ddb_site_no);                  \\\n\tasd_write_reg_##ord (asd_ha, CTXACCESS, val);                      \\\n}\n\nASD_DDBSITE_WRITE(u32, dword);\nASD_DDBSITE_WRITE(u16, word);\n\nstatic inline void asd_ddbsite_write_byte(struct asd_ha_struct *asd_ha,\n\t\t\t\t\t  u16 ddb_site_no,\n\t\t\t\t\t  u16 offs, u8 val)\n{\n\tu16 base = offs & ~1;\n\tu16 rval = asd_ddbsite_read_word(asd_ha, ddb_site_no, base);\n\tif (offs & 1)\n\t\trval = (val << 8) | (rval & 0xFF);\n\telse\n\t\trval = (rval & 0xFF00) | val;\n\tasd_ddbsite_write_word(asd_ha, ddb_site_no, base, rval);\n}\n\n\n#define ASD_SCBSITE_READ(type, ord)                                        \\\nstatic inline type asd_scbsite_read_##ord (struct asd_ha_struct *asd_ha,   \\\n\t\t\t\t\t   u16 scb_site_no,                \\\n\t\t\t\t\t   u16 offs)                       \\\n{                                                                          \\\n\tasd_write_reg_word(asd_ha, ALTCIOADR, MnSCB_SITE + offs);          \\\n\tasd_write_reg_word(asd_ha, ASCBPTR, scb_site_no);                  \\\n\treturn asd_read_reg_##ord (asd_ha, CTXACCESS);                     \\\n}\n\nASD_SCBSITE_READ(u32, dword);\nASD_SCBSITE_READ(u16, word);\n\nstatic inline u8 asd_scbsite_read_byte(struct asd_ha_struct *asd_ha,\n\t\t\t\t       u16 scb_site_no,\n\t\t\t\t       u16 offs)\n{\n\tif (offs & 1)\n\t\treturn asd_scbsite_read_word(asd_ha, scb_site_no,\n\t\t\t\t\t     offs & ~1) >> 8;\n\telse\n\t\treturn asd_scbsite_read_word(asd_ha, scb_site_no,\n\t\t\t\t\t     offs) & 0xFF;\n}\n\n\n#define ASD_SCBSITE_WRITE(type, ord)                                       \\\nstatic inline void asd_scbsite_write_##ord (struct asd_ha_struct *asd_ha,  \\\n\t\t\t\t\tu16 scb_site_no,                   \\\n\t\t\t\t\tu16 offs, type val)                \\\n{                                                                          \\\n\tasd_write_reg_word(asd_ha, ALTCIOADR, MnSCB_SITE + offs);          \\\n\tasd_write_reg_word(asd_ha, ASCBPTR, scb_site_no);                  \\\n\tasd_write_reg_##ord (asd_ha, CTXACCESS, val);                      \\\n}\n\nASD_SCBSITE_WRITE(u32, dword);\nASD_SCBSITE_WRITE(u16, word);\n\nstatic inline void asd_scbsite_write_byte(struct asd_ha_struct *asd_ha,\n\t\t\t\t\t  u16 scb_site_no,\n\t\t\t\t\t  u16 offs, u8 val)\n{\n\tu16 base = offs & ~1;\n\tu16 rval = asd_scbsite_read_word(asd_ha, scb_site_no, base);\n\tif (offs & 1)\n\t\trval = (val << 8) | (rval & 0xFF);\n\telse\n\t\trval = (rval & 0xFF00) | val;\n\tasd_scbsite_write_word(asd_ha, scb_site_no, base, rval);\n}\n\n \nstatic inline int asd_ddbsite_update_word(struct asd_ha_struct *asd_ha,\n\t\t\t\t\t  u16 ddb_site_no, u16 offs,\n\t\t\t\t\t  u16 oldval, u16 newval)\n{\n\tu8  done;\n\tu16 oval = asd_ddbsite_read_word(asd_ha, ddb_site_no, offs);\n\tif (oval != oldval)\n\t\treturn -EAGAIN;\n\tasd_write_reg_word(asd_ha, AOLDDATA, oldval);\n\tasd_write_reg_word(asd_ha, ANEWDATA, newval);\n\tdo {\n\t\tdone = asd_read_reg_byte(asd_ha, ATOMICSTATCTL);\n\t} while (!(done & ATOMICDONE));\n\tif (done & ATOMICERR)\n\t\treturn -EFAULT;\t   \n\telse if (done & ATOMICWIN)\n\t\treturn 0;\t   \n\telse\n\t\treturn -EAGAIN;\t   \n}\n\nstatic inline int asd_ddbsite_update_byte(struct asd_ha_struct *asd_ha,\n\t\t\t\t\t  u16 ddb_site_no, u16 offs,\n\t\t\t\t\t  u8 _oldval, u8 _newval)\n{\n\tu16 base = offs & ~1;\n\tu16 oval;\n\tu16 nval = asd_ddbsite_read_word(asd_ha, ddb_site_no, base);\n\tif (offs & 1) {\n\t\tif ((nval >> 8) != _oldval)\n\t\t\treturn -EAGAIN;\n\t\tnval = (_newval << 8) | (nval & 0xFF);\n\t\toval = (_oldval << 8) | (nval & 0xFF);\n\t} else {\n\t\tif ((nval & 0xFF) != _oldval)\n\t\t\treturn -EAGAIN;\n\t\tnval = (nval & 0xFF00) | _newval;\n\t\toval = (nval & 0xFF00) | _oldval;\n\t}\n\treturn asd_ddbsite_update_word(asd_ha, ddb_site_no, base, oval, nval);\n}\n\nstatic inline void asd_write_reg_addr(struct asd_ha_struct *asd_ha, u32 reg,\n\t\t\t\t      dma_addr_t dma_handle)\n{\n\tasd_write_reg_dword(asd_ha, reg,   ASD_BUSADDR_LO(dma_handle));\n\tasd_write_reg_dword(asd_ha, reg+4, ASD_BUSADDR_HI(dma_handle));\n}\n\nstatic inline u32 asd_get_cmdctx_size(struct asd_ha_struct *asd_ha)\n{\n\t \n\tu32 ctxmemsize = asd_read_reg_dword(asd_ha, LmMnINT(0,0)) & CTXMEMSIZE;\n\treturn ctxmemsize ? 65536 : 32768;\n}\n\nstatic inline u32 asd_get_devctx_size(struct asd_ha_struct *asd_ha)\n{\n\tu32 ctxmemsize = asd_read_reg_dword(asd_ha, LmMnINT(0,0)) & CTXMEMSIZE;\n\treturn ctxmemsize ? 8192 : 4096;\n}\n\nstatic inline void asd_disable_ints(struct asd_ha_struct *asd_ha)\n{\n\tasd_write_reg_dword(asd_ha, CHIMINTEN, RST_CHIMINTEN);\n}\n\nstatic inline void asd_enable_ints(struct asd_ha_struct *asd_ha)\n{\n\t \n\tasd_write_reg_dword(asd_ha, COMSTATEN,\n\t\t\t    EN_CSBUFPERR | EN_CSERR | EN_OVLYERR);\n\t \n\tasd_write_reg_dword(asd_ha, DCHSTATUS, EN_CFIFTOERR);\n\t \n\tasd_write_reg_dword(asd_ha, CHIMINTEN, SET_CHIMINTEN);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}