{
  "module_name": "request.h",
  "hash_id": "77f27c05710e5c87e158edf15945900598f04bb38f109a10b60400169ce75b80",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/isci/request.h",
  "human_readable_source": " \n\n#ifndef _ISCI_REQUEST_H_\n#define _ISCI_REQUEST_H_\n\n#include \"isci.h\"\n#include \"host.h\"\n#include \"scu_task_context.h\"\n\n \nstruct isci_stp_request {\n\tu32 pio_len;\n\tu8 status;\n\n\tstruct isci_stp_pio_sgl {\n\t\tint index;\n\t\tu8 set;\n\t\tu32 offset;\n\t} sgl;\n};\n\nstruct isci_request {\n\t#define IREQ_COMPLETE_IN_TARGET 0\n\t#define IREQ_TERMINATED 1\n\t#define IREQ_TMF 2\n\t#define IREQ_ACTIVE 3\n\t#define IREQ_PENDING_ABORT 4  \n\t#define IREQ_TC_ABORT_POSTED 5\n\t#define IREQ_ABORT_PATH_ACTIVE 6\n\t#define IREQ_NO_AUTO_FREE_TAG 7  \n\tunsigned long flags;\n\t \n\tunion ttype_ptr_union {\n\t\tstruct sas_task *io_task_ptr;    \n\t\tstruct isci_tmf *tmf_task_ptr;   \n\t} ttype_ptr;\n\tstruct isci_host *isci_host;\n\tdma_addr_t request_daddr;\n\tdma_addr_t zero_scatter_daddr;\n\tunsigned int num_sg_entries;\n\t \n\tstruct completion *io_request_completion;\n\tstruct sci_base_state_machine sm;\n\tstruct isci_host *owning_controller;\n\tstruct isci_remote_device *target_device;\n\tu16 io_tag;\n\tenum sas_protocol protocol;\n\tu32 scu_status;  \n\tu32 sci_status;  \n\tu32 post_context;\n\tstruct scu_task_context *tc;\n\t \n\t#define SCU_SGL_SIZE ((SCI_MAX_SCATTER_GATHER_ELEMENTS + 1) / 2)\n\tstruct scu_sgl_element_pair sg_table[SCU_SGL_SIZE] __attribute__ ((aligned(32)));\n\t \n\tu32 saved_rx_frame_index;\n\n\tunion {\n\t\tstruct {\n\t\t\tunion {\n\t\t\t\tstruct ssp_cmd_iu cmd;\n\t\t\t\tstruct ssp_task_iu tmf;\n\t\t\t};\n\t\t\tunion {\n\t\t\t\tstruct ssp_response_iu rsp;\n\t\t\t\tu8 rsp_buf[SSP_RESP_IU_MAX_SIZE];\n\t\t\t};\n\t\t} ssp;\n\t\tstruct {\n\t\t\tstruct isci_stp_request req;\n\t\t\tstruct host_to_dev_fis cmd;\n\t\t\tstruct dev_to_host_fis rsp;\n\t\t} stp;\n\t};\n};\n\nstatic inline struct isci_request *to_ireq(struct isci_stp_request *stp_req)\n{\n\tstruct isci_request *ireq;\n\n\tireq = container_of(stp_req, typeof(*ireq), stp.req);\n\treturn ireq;\n}\n\n \n#define REQUEST_STATES {\\\n\tC(REQ_INIT),\\\n\tC(REQ_CONSTRUCTED),\\\n\tC(REQ_STARTED),\\\n\tC(REQ_STP_UDMA_WAIT_TC_COMP),\\\n\tC(REQ_STP_UDMA_WAIT_D2H),\\\n\tC(REQ_STP_NON_DATA_WAIT_H2D),\\\n\tC(REQ_STP_NON_DATA_WAIT_D2H),\\\n\tC(REQ_STP_PIO_WAIT_H2D),\\\n\tC(REQ_STP_PIO_WAIT_FRAME),\\\n\tC(REQ_STP_PIO_DATA_IN),\\\n\tC(REQ_STP_PIO_DATA_OUT),\\\n\tC(REQ_ATAPI_WAIT_H2D),\\\n\tC(REQ_ATAPI_WAIT_PIO_SETUP),\\\n\tC(REQ_ATAPI_WAIT_D2H),\\\n\tC(REQ_ATAPI_WAIT_TC_COMP),\\\n\tC(REQ_TASK_WAIT_TC_COMP),\\\n\tC(REQ_TASK_WAIT_TC_RESP),\\\n\tC(REQ_SMP_WAIT_RESP),\\\n\tC(REQ_SMP_WAIT_TC_COMP),\\\n\tC(REQ_COMPLETED),\\\n\tC(REQ_ABORTING),\\\n\tC(REQ_FINAL),\\\n\t}\n#undef C\n#define C(a) SCI_##a\nenum sci_base_request_states REQUEST_STATES;\n#undef C\nconst char *req_state_name(enum sci_base_request_states state);\n\nenum sci_status sci_request_start(struct isci_request *ireq);\nenum sci_status sci_io_request_terminate(struct isci_request *ireq);\nenum sci_status\nsci_io_request_event_handler(struct isci_request *ireq,\n\t\t\t\t  u32 event_code);\nenum sci_status\nsci_io_request_frame_handler(struct isci_request *ireq,\n\t\t\t\t  u32 frame_index);\nenum sci_status\nsci_task_request_terminate(struct isci_request *ireq);\nextern enum sci_status\nsci_request_complete(struct isci_request *ireq);\nextern enum sci_status\nsci_io_request_tc_completion(struct isci_request *ireq, u32 code);\n\n \nstatic inline dma_addr_t\nsci_io_request_get_dma_addr(struct isci_request *ireq, void *virt_addr)\n{\n\n\tchar *requested_addr = (char *)virt_addr;\n\tchar *base_addr = (char *)ireq;\n\n\tBUG_ON(requested_addr < base_addr);\n\tBUG_ON((requested_addr - base_addr) >= sizeof(*ireq));\n\n\treturn ireq->request_daddr + (requested_addr - base_addr);\n}\n\n#define isci_request_access_task(req) ((req)->ttype_ptr.io_task_ptr)\n\n#define isci_request_access_tmf(req) ((req)->ttype_ptr.tmf_task_ptr)\n\nstruct isci_request *isci_tmf_request_from_tag(struct isci_host *ihost,\n\t\t\t\t\t       struct isci_tmf *isci_tmf,\n\t\t\t\t\t       u16 tag);\nint isci_request_execute(struct isci_host *ihost, struct isci_remote_device *idev,\n\t\t\t struct sas_task *task, struct isci_request *ireq);\nstruct isci_request *isci_io_request_from_tag(struct isci_host *ihost,\n\t\t\t\t\t      struct sas_task *task,\n\t\t\t\t\t      u16 tag);\nenum sci_status\nsci_task_request_construct(struct isci_host *ihost,\n\t\t\t    struct isci_remote_device *idev,\n\t\t\t    u16 io_tag,\n\t\t\t    struct isci_request *ireq);\nenum sci_status sci_task_request_construct_ssp(struct isci_request *ireq);\nvoid sci_smp_request_copy_response(struct isci_request *ireq);\n\nstatic inline int isci_task_is_ncq_recovery(struct sas_task *task)\n{\n\treturn (sas_protocol_ata(task->task_proto) &&\n\t\ttask->ata_task.fis.command == ATA_CMD_READ_LOG_EXT &&\n\t\ttask->ata_task.fis.lbal == ATA_LOG_SATA_NCQ);\n\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}