{
  "module_name": "host.h",
  "hash_id": "197cd6d26758cbfd17e39e6ddf81e4d53bc29ac868f0617da5eee0a6f76b3bdc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/isci/host.h",
  "human_readable_source": " \n#ifndef _SCI_HOST_H_\n#define _SCI_HOST_H_\n\n#include <scsi/sas_ata.h>\n#include \"remote_device.h\"\n#include \"phy.h\"\n#include \"isci.h\"\n#include \"remote_node_table.h\"\n#include \"registers.h\"\n#include \"unsolicited_frame_control.h\"\n#include \"probe_roms.h\"\n\nstruct isci_request;\nstruct scu_task_context;\n\n\n \nstruct sci_power_control {\n\t \n\tbool timer_started;\n\n\t \n\tstruct sci_timer timer;\n\n\t \n\tu8 phys_waiting;\n\n\t \n\tu8 phys_granted_power;\n\n\t \n\tstruct isci_phy *requesters[SCI_MAX_PHYS];\n\n};\n\nstruct sci_port_configuration_agent;\ntypedef void (*port_config_fn)(struct isci_host *,\n\t\t\t       struct sci_port_configuration_agent *,\n\t\t\t       struct isci_port *, struct isci_phy *);\nbool is_port_config_apc(struct isci_host *ihost);\nbool is_controller_start_complete(struct isci_host *ihost);\n\nstruct sci_port_configuration_agent {\n\tu16 phy_configured_mask;\n\tu16 phy_ready_mask;\n\tstruct {\n\t\tu8 min_index;\n\t\tu8 max_index;\n\t} phy_valid_port_range[SCI_MAX_PHYS];\n\tbool timer_pending;\n\tport_config_fn link_up_handler;\n\tport_config_fn link_down_handler;\n\tstruct sci_timer\ttimer;\n};\n\n \nstruct isci_host {\n\tstruct sci_base_state_machine sm;\n\t \n\tstruct sci_timer timer;\n\t \n\tstruct sci_user_parameters user_parameters;\n\t \n\tstruct sci_oem_params oem_parameters;\n\tstruct sci_port_configuration_agent port_agent;\n\tstruct isci_remote_device *device_table[SCI_MAX_REMOTE_DEVICES];\n\tstruct sci_remote_node_table available_remote_nodes;\n\tstruct sci_power_control power_control;\n\tu8 io_request_sequence[SCI_MAX_IO_REQUESTS];\n\tstruct scu_task_context *task_context_table;\n\tdma_addr_t tc_dma;\n\tunion scu_remote_node_context *remote_node_context_table;\n\tdma_addr_t rnc_dma;\n\tu32 *completion_queue;\n\tdma_addr_t cq_dma;\n\tu32 completion_queue_get;\n\tu32 logical_port_entries;\n\tu32 remote_node_entries;\n\tu32 task_context_entries;\n\tvoid *ufi_buf;\n\tdma_addr_t ufi_dma;\n\tstruct sci_unsolicited_frame_control uf_control;\n\n\t \n\tstruct sci_timer phy_timer;\n\t \n\tbool phy_startup_timer_pending;\n\tu32 next_phy_to_start;\n\t \n\tu8 invalid_phy_mask;\n\n\t \n\tu16 interrupt_coalesce_number;\n\tu32 interrupt_coalesce_timeout;\n\tstruct smu_registers __iomem *smu_registers;\n\tstruct scu_registers __iomem *scu_registers;\n\n\tu16 tci_head;\n\tu16 tci_tail;\n\tu16 tci_pool[SCI_MAX_IO_REQUESTS];\n\n\tint id;  \n\tstruct isci_phy phys[SCI_MAX_PHYS];\n\tstruct isci_port ports[SCI_MAX_PORTS + 1];  \n\tstruct asd_sas_port sas_ports[SCI_MAX_PORTS];\n\tstruct sas_ha_struct sas_ha;\n\n\tstruct pci_dev *pdev;\n\t#define IHOST_START_PENDING 0\n\t#define IHOST_STOP_PENDING 1\n\t#define IHOST_IRQ_ENABLED 2\n\tunsigned long flags;\n\twait_queue_head_t eventq;\n\tstruct tasklet_struct completion_tasklet;\n\tspinlock_t scic_lock;\n\tstruct isci_request *reqs[SCI_MAX_IO_REQUESTS];\n\tstruct isci_remote_device devices[SCI_MAX_REMOTE_DEVICES];\n};\n\n \nenum sci_controller_states {\n\t \n\tSCIC_INITIAL = 0,\n\n\t \n\tSCIC_RESET,\n\n\t \n\tSCIC_INITIALIZING,\n\n\t \n\tSCIC_INITIALIZED,\n\n\t \n\tSCIC_STARTING,\n\n\t \n\tSCIC_READY,\n\n\t \n\tSCIC_RESETTING,\n\n\t \n\tSCIC_STOPPING,\n\n\t \n\tSCIC_FAILED,\n};\n\n \n#define SCI_MAX_MSIX_INT (SCI_NUM_MSI_X_INT*SCI_MAX_CONTROLLERS)\n\nstruct isci_pci_info {\n\tstruct isci_host *hosts[SCI_MAX_CONTROLLERS];\n\tstruct isci_orom *orom;\n};\n\nstatic inline struct isci_pci_info *to_pci_info(struct pci_dev *pdev)\n{\n\treturn pci_get_drvdata(pdev);\n}\n\nstatic inline struct Scsi_Host *to_shost(struct isci_host *ihost)\n{\n\treturn ihost->sas_ha.shost;\n}\n\n#define for_each_isci_host(id, ihost, pdev) \\\n\tfor (id = 0; id < SCI_MAX_CONTROLLERS && \\\n\t     (ihost = to_pci_info(pdev)->hosts[id]); id++)\n\nstatic inline void wait_for_start(struct isci_host *ihost)\n{\n\twait_event(ihost->eventq, !test_bit(IHOST_START_PENDING, &ihost->flags));\n}\n\nstatic inline void wait_for_stop(struct isci_host *ihost)\n{\n\twait_event(ihost->eventq, !test_bit(IHOST_STOP_PENDING, &ihost->flags));\n}\n\nstatic inline void wait_for_device_start(struct isci_host *ihost, struct isci_remote_device *idev)\n{\n\twait_event(ihost->eventq, !test_bit(IDEV_START_PENDING, &idev->flags));\n}\n\nstatic inline void wait_for_device_stop(struct isci_host *ihost, struct isci_remote_device *idev)\n{\n\twait_event(ihost->eventq, !test_bit(IDEV_STOP_PENDING, &idev->flags));\n}\n\nstatic inline struct isci_host *dev_to_ihost(struct domain_device *dev)\n{\n\treturn dev->port->ha->lldd_ha;\n}\n\nstatic inline struct isci_host *idev_to_ihost(struct isci_remote_device *idev)\n{\n\treturn dev_to_ihost(idev->domain_dev);\n}\n\n \n#define ISCI_PEG 0\n\n \n#define ISCI_TAG(seq, tci) (((u16) (seq)) << 12 | tci)\n\n \n#define ISCI_TAG_SEQ(tag) (((tag) >> 12) & (SCI_MAX_SEQ-1))\n#define ISCI_TAG_TCI(tag) ((tag) & (SCI_MAX_IO_REQUESTS-1))\n\n \n#define ISCI_COALESCE_BASE 9\n\n \nstatic inline int sci_remote_device_node_count(struct isci_remote_device *idev)\n{\n\tstruct domain_device *dev = idev->domain_dev;\n\n\tif (dev_is_sata(dev) && dev->parent)\n\t\treturn SCU_STP_REMOTE_NODE_COUNT;\n\treturn SCU_SSP_REMOTE_NODE_COUNT;\n}\n\n \n#define sci_controller_clear_invalid_phy(controller, phy) \\\n\t((controller)->invalid_phy_mask &= ~(1 << (phy)->phy_index))\n\nstatic inline struct device *scirdev_to_dev(struct isci_remote_device *idev)\n{\n\tif (!idev || !idev->isci_port || !idev->isci_port->isci_host)\n\t\treturn NULL;\n\n\treturn &idev->isci_port->isci_host->pdev->dev;\n}\n\nstatic inline bool is_a2(struct pci_dev *pdev)\n{\n\tif (pdev->revision < 4)\n\t\treturn true;\n\treturn false;\n}\n\nstatic inline bool is_b0(struct pci_dev *pdev)\n{\n\tif (pdev->revision == 4)\n\t\treturn true;\n\treturn false;\n}\n\nstatic inline bool is_c0(struct pci_dev *pdev)\n{\n\tif (pdev->revision == 5)\n\t\treturn true;\n\treturn false;\n}\n\nstatic inline bool is_c1(struct pci_dev *pdev)\n{\n\tif (pdev->revision >= 6)\n\t\treturn true;\n\treturn false;\n}\n\nenum cable_selections {\n\tshort_cable     = 0,\n\tlong_cable      = 1,\n\tmedium_cable    = 2,\n\tundefined_cable = 3\n};\n\n#define CABLE_OVERRIDE_DISABLED (0x10000)\n\nstatic inline int is_cable_select_overridden(void)\n{\n\treturn cable_selection_override < CABLE_OVERRIDE_DISABLED;\n}\n\nenum cable_selections decode_cable_selection(struct isci_host *ihost, int phy);\nvoid validate_cable_selections(struct isci_host *ihost);\nchar *lookup_cable_names(enum cable_selections);\n\n \n#define SGPIO_HW_CONTROL 0x00000443\n\nstatic inline int isci_gpio_count(struct isci_host *ihost)\n{\n\treturn ARRAY_SIZE(ihost->scu_registers->peg0.sgpio.output_data_select);\n}\n\nvoid sci_controller_post_request(struct isci_host *ihost,\n\t\t\t\t      u32 request);\nvoid sci_controller_release_frame(struct isci_host *ihost,\n\t\t\t\t       u32 frame_index);\nvoid sci_controller_copy_sata_response(void *response_buffer,\n\t\t\t\t\t    void *frame_header,\n\t\t\t\t\t    void *frame_buffer);\nenum sci_status sci_controller_allocate_remote_node_context(struct isci_host *ihost,\n\t\t\t\t\t\t\t\t struct isci_remote_device *idev,\n\t\t\t\t\t\t\t\t u16 *node_id);\nvoid sci_controller_free_remote_node_context(\n\tstruct isci_host *ihost,\n\tstruct isci_remote_device *idev,\n\tu16 node_id);\n\nstruct isci_request *sci_request_by_tag(struct isci_host *ihost, u16 io_tag);\nvoid sci_controller_power_control_queue_insert(struct isci_host *ihost,\n\t\t\t\t\t       struct isci_phy *iphy);\nvoid sci_controller_power_control_queue_remove(struct isci_host *ihost,\n\t\t\t\t\t       struct isci_phy *iphy);\nvoid sci_controller_link_up(struct isci_host *ihost, struct isci_port *iport,\n\t\t\t    struct isci_phy *iphy);\nvoid sci_controller_link_down(struct isci_host *ihost, struct isci_port *iport,\n\t\t\t      struct isci_phy *iphy);\nvoid sci_controller_remote_device_stopped(struct isci_host *ihost,\n\t\t\t\t\t  struct isci_remote_device *idev);\n\nenum sci_status sci_controller_continue_io(struct isci_request *ireq);\nint isci_host_scan_finished(struct Scsi_Host *, unsigned long);\nvoid isci_host_start(struct Scsi_Host *);\nu16 isci_alloc_tag(struct isci_host *ihost);\nenum sci_status isci_free_tag(struct isci_host *ihost, u16 io_tag);\nvoid isci_tci_free(struct isci_host *ihost, u16 tci);\nvoid ireq_done(struct isci_host *ihost, struct isci_request *ireq, struct sas_task *task);\n\nint isci_host_init(struct isci_host *);\nvoid isci_host_completion_routine(unsigned long data);\nvoid isci_host_deinit(struct isci_host *);\nvoid sci_controller_disable_interrupts(struct isci_host *ihost);\nbool sci_controller_has_remote_devices_stopping(struct isci_host *ihost);\nvoid sci_controller_transition_to_ready(struct isci_host *ihost, enum sci_status status);\n\nenum sci_status sci_controller_start_io(\n\tstruct isci_host *ihost,\n\tstruct isci_remote_device *idev,\n\tstruct isci_request *ireq);\n\nenum sci_status sci_controller_start_task(\n\tstruct isci_host *ihost,\n\tstruct isci_remote_device *idev,\n\tstruct isci_request *ireq);\n\nenum sci_status sci_controller_terminate_request(\n\tstruct isci_host *ihost,\n\tstruct isci_remote_device *idev,\n\tstruct isci_request *ireq);\n\nenum sci_status sci_controller_complete_io(\n\tstruct isci_host *ihost,\n\tstruct isci_remote_device *idev,\n\tstruct isci_request *ireq);\n\nvoid sci_port_configuration_agent_construct(\n\tstruct sci_port_configuration_agent *port_agent);\n\nenum sci_status sci_port_configuration_agent_initialize(\n\tstruct isci_host *ihost,\n\tstruct sci_port_configuration_agent *port_agent);\n\nint isci_gpio_write(struct sas_ha_struct *, u8 reg_type, u8 reg_index,\n\t\t    u8 reg_count, u8 *write_data);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}