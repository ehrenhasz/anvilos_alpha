{
  "module_name": "csio_mb.h",
  "hash_id": "02493371353490f3b47e5a9a80fd1cc6a16218034f72d341475d043c78e593d2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/csiostor/csio_mb.h",
  "human_readable_source": " \n\n#ifndef __CSIO_MB_H__\n#define __CSIO_MB_H__\n\n#include <linux/timer.h>\n#include <linux/completion.h>\n\n#include \"t4fw_api.h\"\n#include \"t4fw_api_stor.h\"\n#include \"csio_defs.h\"\n\n#define CSIO_STATS_OFFSET (2)\n#define CSIO_NUM_STATS_PER_MB (6)\n\nstruct fw_fcoe_port_cmd_params {\n\tuint8_t\t\tportid;\n\tuint8_t\t\tidx;\n\tuint8_t\t\tnstats;\n};\n\n#define CSIO_DUMP_MB(__hw, __num, __mb)\t\t\t\t\t\\\n\tcsio_dbg(__hw, \"\\t%llx %llx %llx %llx %llx %llx %llx %llx\\n\",\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb),\t\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb + 8),\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb + 16),\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb + 24),\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb + 32),\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb + 40),\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb + 48),\t\\\n\t\t(unsigned long long)csio_rd_reg64(__hw, __mb + 56))\n\n#define CSIO_MB_MAX_REGS\t8\n#define CSIO_MAX_MB_SIZE\t64\n#define CSIO_MB_POLL_FREQ\t5\t\t \n#define CSIO_MB_DEFAULT_TMO\tFW_CMD_MAX_TIMEOUT\n\n \nenum csio_dev_master { CSIO_MASTER_CANT, CSIO_MASTER_MAY, CSIO_MASTER_MUST };\n\nenum csio_mb_owner { CSIO_MBOWNER_NONE, CSIO_MBOWNER_FW, CSIO_MBOWNER_PL };\n\nenum csio_dev_state {\n\tCSIO_DEV_STATE_UNINIT,\n\tCSIO_DEV_STATE_INIT,\n\tCSIO_DEV_STATE_ERR\n};\n\n#define FW_PARAM_DEV(param) \\\n\t(FW_PARAMS_MNEM_V(FW_PARAMS_MNEM_DEV) | \\\n\t FW_PARAMS_PARAM_X_V(FW_PARAMS_PARAM_DEV_##param))\n\n#define FW_PARAM_PFVF(param) \\\n\t(FW_PARAMS_MNEM_V(FW_PARAMS_MNEM_PFVF) | \\\n\t FW_PARAMS_PARAM_X_V(FW_PARAMS_PARAM_PFVF_##param)|  \\\n\t FW_PARAMS_PARAM_Y_V(0) | \\\n\t FW_PARAMS_PARAM_Z_V(0))\n\n#define CSIO_INIT_MBP(__mbp, __cp,  __tmo, __priv, __fn, __clear)\t\\\ndo {\t\t\t\t\t\t\t\t\t\\\n\tif (__clear)\t\t\t\t\t\t\t\\\n\t\tmemset((__cp), 0,\t\t\t\t\t\\\n\t\t\t    CSIO_MB_MAX_REGS * sizeof(__be64));\t\t\\\n\tINIT_LIST_HEAD(&(__mbp)->list);\t\t\t\t\t\\\n\t(__mbp)->tmo\t\t= (__tmo);\t\t\t\t\\\n\t(__mbp)->priv\t\t= (void *)(__priv);\t\t\t\\\n\t(__mbp)->mb_cbfn\t= (__fn);\t\t\t\t\\\n\t(__mbp)->mb_size\t= sizeof(*(__cp));\t\t\t\\\n} while (0)\n\nstruct csio_mbm_stats {\n\tuint32_t\tn_req;\t\t \n\tuint32_t\tn_rsp;\t\t \n\tuint32_t\tn_activeq;\t \n\tuint32_t\tn_cbfnq;\t \n\tuint32_t\tn_tmo;\t\t \n\tuint32_t\tn_cancel;\t \n\tuint32_t\tn_err;\t\t \n};\n\n \nstruct csio_mb {\n\tstruct list_head\tlist;\t\t\t \n\t\t\t\t\t\t\t \n\t__be64\t\t\tmb[CSIO_MB_MAX_REGS];\t \n\tint\t\t\tmb_size;\t\t \n\tuint32_t\t\ttmo;\t\t\t \n\tstruct completion\tcmplobj;\t\t \n\tvoid\t\t\t(*mb_cbfn) (struct csio_hw *, struct csio_mb *);\n\t\t\t\t\t\t\t \n\tvoid\t\t\t*priv;\t\t\t \n};\n\nstruct csio_mbm {\n\tuint32_t\t\ta_mbox;\t\t\t \n\tuint32_t\t\tintr_idx;\t\t \n\tstruct timer_list\ttimer;\t\t\t \n\tstruct csio_hw\t\t*hw;\t\t\t \n\tstruct list_head\treq_q;\t\t\t \n\tstruct list_head\tcbfn_q;\t\t\t \n\tstruct csio_mb\t\t*mcurrent;\t\t \n\tuint32_t\t\treq_q_cnt;\t\t \n\tstruct csio_mbm_stats\tstats;\t\t\t \n};\n\n#define csio_set_mb_intr_idx(_m, _i)\t((_m)->intr_idx = (_i))\n#define csio_get_mb_intr_idx(_m)\t((_m)->intr_idx)\n\nstruct csio_iq_params;\nstruct csio_eq_params;\n\nenum fw_retval csio_mb_fw_retval(struct csio_mb *);\n\n \nvoid csio_mb_hello(struct csio_hw *, struct csio_mb *, uint32_t,\n\t\t   uint32_t, uint32_t, enum csio_dev_master,\n\t\t   void (*)(struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_process_hello_rsp(struct csio_hw *, struct csio_mb *,\n\t\t\t       enum fw_retval *, enum csio_dev_state *,\n\t\t\t       uint8_t *);\n\nvoid csio_mb_bye(struct csio_hw *, struct csio_mb *, uint32_t,\n\t\t void (*)(struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_reset(struct csio_hw *, struct csio_mb *, uint32_t, int, int,\n\t\t   void (*)(struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_params(struct csio_hw *, struct csio_mb *, uint32_t, unsigned int,\n\t\t    unsigned int, unsigned int, const u32 *, u32 *, bool,\n\t\t    void (*)(struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_process_read_params_rsp(struct csio_hw *, struct csio_mb *,\n\t\t\t\tenum fw_retval *, unsigned int , u32 *);\n\nvoid csio_mb_ldst(struct csio_hw *hw, struct csio_mb *mbp, uint32_t tmo,\n\t\t  int reg);\n\nvoid csio_mb_caps_config(struct csio_hw *, struct csio_mb *, uint32_t,\n\t\t\t    bool, bool, bool, bool,\n\t\t\t    void (*)(struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_port(struct csio_hw *, struct csio_mb *, uint32_t,\n\t\t  uint8_t, bool, uint32_t, uint16_t,\n\t\t  void (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_process_read_port_rsp(struct csio_hw *, struct csio_mb *,\n\t\t\t\t   enum fw_retval *, uint16_t,\n\t\t\t\t   uint32_t *, uint32_t *);\n\nvoid csio_mb_initialize(struct csio_hw *, struct csio_mb *, uint32_t,\n\t\t\tvoid (*)(struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_iq_alloc_write(struct csio_hw *, struct csio_mb *, void *,\n\t\t\tuint32_t, struct csio_iq_params *,\n\t\t\tvoid (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_iq_alloc_write_rsp(struct csio_hw *, struct csio_mb *,\n\t\t\t\tenum fw_retval *, struct csio_iq_params *);\n\nvoid csio_mb_iq_free(struct csio_hw *, struct csio_mb *, void *,\n\t\t     uint32_t, struct csio_iq_params *,\n\t\t     void (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_eq_ofld_alloc_write(struct csio_hw *, struct csio_mb *, void *,\n\t\t\t\t uint32_t, struct csio_eq_params *,\n\t\t\t\t void (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_eq_ofld_alloc_write_rsp(struct csio_hw *, struct csio_mb *,\n\t\t\t\t     enum fw_retval *, struct csio_eq_params *);\n\nvoid csio_mb_eq_ofld_free(struct csio_hw *, struct csio_mb *, void *,\n\t\t\t  uint32_t , struct csio_eq_params *,\n\t\t\t  void (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_fcoe_read_res_info_init_mb(struct csio_hw *, struct csio_mb *,\n\t\t\tuint32_t,\n\t\t\tvoid (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_write_fcoe_link_cond_init_mb(struct csio_lnode *, struct csio_mb *,\n\t\t\tuint32_t, uint8_t, uint32_t, uint8_t, bool, uint32_t,\n\t\t\tvoid (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_fcoe_vnp_alloc_init_mb(struct csio_lnode *, struct csio_mb *,\n\t\t\tuint32_t, uint32_t , uint32_t , uint16_t,\n\t\t\tuint8_t [8], uint8_t [8],\n\t\t\tvoid (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_fcoe_vnp_read_init_mb(struct csio_lnode *, struct csio_mb *,\n\t\t\tuint32_t, uint32_t , uint32_t ,\n\t\t\tvoid (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_fcoe_vnp_free_init_mb(struct csio_lnode *, struct csio_mb *,\n\t\t\tuint32_t , uint32_t, uint32_t ,\n\t\t\tvoid (*) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_fcoe_read_fcf_init_mb(struct csio_lnode *, struct csio_mb *,\n\t\t\tuint32_t, uint32_t, uint32_t,\n\t\t\tvoid (*cbfn) (struct csio_hw *, struct csio_mb *));\n\nvoid csio_fcoe_read_portparams_init_mb(struct csio_hw *hw,\n\t\t\tstruct csio_mb *mbp, uint32_t mb_tmo,\n\t\t\tstruct fw_fcoe_port_cmd_params *portparams,\n\t\t\tvoid (*cbfn)(struct csio_hw *, struct csio_mb *));\n\nvoid csio_mb_process_portparams_rsp(struct csio_hw *hw, struct csio_mb *mbp,\n\t\t\t\tenum fw_retval *retval,\n\t\t\t\tstruct fw_fcoe_port_cmd_params *portparams,\n\t\t\t\tstruct fw_fcoe_port_stats *portstats);\n\n \nint csio_mbm_init(struct csio_mbm *, struct csio_hw *,\n\t\t\t    void (*)(struct timer_list *));\nvoid csio_mbm_exit(struct csio_mbm *);\nvoid csio_mb_intr_enable(struct csio_hw *);\nvoid csio_mb_intr_disable(struct csio_hw *);\n\nint csio_mb_issue(struct csio_hw *, struct csio_mb *);\nvoid csio_mb_completions(struct csio_hw *, struct list_head *);\nint csio_mb_fwevt_handler(struct csio_hw *, __be64 *);\nint csio_mb_isr_handler(struct csio_hw *);\nstruct csio_mb *csio_mb_tmo_handler(struct csio_hw *);\nvoid csio_mb_cancel_all(struct csio_hw *, struct list_head *);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}