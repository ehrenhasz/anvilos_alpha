{
  "module_name": "csio_wr.h",
  "hash_id": "814e10de003186c5f3c1e32ed84ef8999c924b8dd856340be63b79a1557ee29b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/csiostor/csio_wr.h",
  "human_readable_source": " \n\n#ifndef __CSIO_WR_H__\n#define __CSIO_WR_H__\n\n#include <linux/cache.h>\n\n#include \"csio_defs.h\"\n#include \"t4fw_api.h\"\n#include \"t4fw_api_stor.h\"\n\n \n#define X_INGPCIEBOUNDARY_32B\t\t0\n#define X_INGPCIEBOUNDARY_64B\t\t1\n#define X_INGPCIEBOUNDARY_128B\t\t2\n#define X_INGPCIEBOUNDARY_256B\t\t3\n#define X_INGPCIEBOUNDARY_512B\t\t4\n#define X_INGPCIEBOUNDARY_1024B\t\t5\n#define X_INGPCIEBOUNDARY_2048B\t\t6\n#define X_INGPCIEBOUNDARY_4096B\t\t7\n\n \n#define X_TIMERREG_COUNTER0\t\t0\n#define X_TIMERREG_COUNTER1\t\t1\n#define X_TIMERREG_COUNTER2\t\t2\n#define X_TIMERREG_COUNTER3\t\t3\n#define X_TIMERREG_COUNTER4\t\t4\n#define X_TIMERREG_COUNTER5\t\t5\n#define X_TIMERREG_RESTART_COUNTER\t6\n#define X_TIMERREG_UPDATE_CIDX\t\t7\n\n \n#define X_FETCHBURSTMIN_16B\t\t0\n#define X_FETCHBURSTMIN_32B\t\t1\n#define X_FETCHBURSTMIN_64B\t\t2\n#define X_FETCHBURSTMIN_128B\t\t3\n\n#define X_FETCHBURSTMAX_64B\t\t0\n#define X_FETCHBURSTMAX_128B\t\t1\n#define X_FETCHBURSTMAX_256B\t\t2\n#define X_FETCHBURSTMAX_512B\t\t3\n\n#define X_HOSTFCMODE_NONE\t\t0\n#define X_HOSTFCMODE_INGRESS_QUEUE\t1\n#define X_HOSTFCMODE_STATUS_PAGE\t2\n#define X_HOSTFCMODE_BOTH\t\t3\n\n \n#define X_UPDATESCHEDULING_TIMER\t0\n#define X_UPDATESCHEDULING_COUNTER_OPTTIMER\t1\n\n#define X_UPDATEDELIVERY_NONE\t\t0\n#define X_UPDATEDELIVERY_INTERRUPT\t1\n#define X_UPDATEDELIVERY_STATUS_PAGE\t2\n#define X_UPDATEDELIVERY_BOTH\t\t3\n\n#define X_INTERRUPTDESTINATION_PCIE\t0\n#define X_INTERRUPTDESTINATION_IQ\t1\n\n#define X_RSPD_TYPE_FLBUF\t\t0\n#define X_RSPD_TYPE_CPL\t\t\t1\n#define X_RSPD_TYPE_INTR\t\t2\n\n \n#define csio_wr_status(_wr)\t\t\\\n\t\t(FW_CMD_RETVAL_G(ntohl(((struct fw_cmd_hdr *)(_wr))->lo)))\n\nstruct csio_hw;\n\nextern int csio_intr_coalesce_cnt;\nextern int csio_intr_coalesce_time;\n\n \nstruct csio_iq_params {\n\n\tuint8_t\t\tiq_start:1;\n\tuint8_t\t\tiq_stop:1;\n\tuint8_t\t\tpfn:3;\n\n\tuint8_t\t\tvfn;\n\n\tuint16_t\tphysiqid;\n\tuint16_t\tiqid;\n\n\tuint16_t\tfl0id;\n\tuint16_t\tfl1id;\n\n\tuint8_t\t\tviid;\n\n\tuint8_t\t\ttype;\n\tuint8_t\t\tiqasynch;\n\tuint8_t\t\treserved4;\n\n\tuint8_t\t\tiqandst;\n\tuint8_t\t\tiqanus;\n\tuint8_t\t\tiqanud;\n\n\tuint16_t\tiqandstindex;\n\n\tuint8_t\t\tiqdroprss;\n\tuint8_t\t\tiqpciech;\n\tuint8_t\t\tiqdcaen;\n\n\tuint8_t\t\tiqdcacpu;\n\tuint8_t\t\tiqintcntthresh;\n\tuint8_t\t\tiqo;\n\n\tuint8_t\t\tiqcprio;\n\tuint8_t\t\tiqesize;\n\n\tuint16_t\tiqsize;\n\n\tuint64_t\tiqaddr;\n\n\tuint8_t\t\tiqflintiqhsen;\n\tuint8_t\t\treserved5;\n\tuint8_t\t\tiqflintcongen;\n\tuint8_t\t\tiqflintcngchmap;\n\n\tuint32_t\treserved6;\n\n\tuint8_t\t\tfl0hostfcmode;\n\tuint8_t\t\tfl0cprio;\n\tuint8_t\t\tfl0paden;\n\tuint8_t\t\tfl0packen;\n\tuint8_t\t\tfl0congen;\n\tuint8_t\t\tfl0dcaen;\n\n\tuint8_t\t\tfl0dcacpu;\n\tuint8_t\t\tfl0fbmin;\n\n\tuint8_t\t\tfl0fbmax;\n\tuint8_t\t\tfl0cidxfthresho;\n\tuint8_t\t\tfl0cidxfthresh;\n\n\tuint16_t\tfl0size;\n\n\tuint64_t\tfl0addr;\n\n\tuint64_t\treserved7;\n\n\tuint8_t\t\tfl1hostfcmode;\n\tuint8_t\t\tfl1cprio;\n\tuint8_t\t\tfl1paden;\n\tuint8_t\t\tfl1packen;\n\tuint8_t\t\tfl1congen;\n\tuint8_t\t\tfl1dcaen;\n\n\tuint8_t\t\tfl1dcacpu;\n\tuint8_t\t\tfl1fbmin;\n\n\tuint8_t\t\tfl1fbmax;\n\tuint8_t\t\tfl1cidxfthresho;\n\tuint8_t\t\tfl1cidxfthresh;\n\n\tuint16_t\tfl1size;\n\n\tuint64_t\tfl1addr;\n};\n\n \nstruct csio_eq_params {\n\n\tuint8_t\t\tpfn;\n\tuint8_t\t\tvfn;\n\n\tuint8_t\t\teqstart:1;\n\tuint8_t\t\teqstop:1;\n\n\tuint16_t        physeqid;\n\tuint32_t\teqid;\n\n\tuint8_t\t\thostfcmode:2;\n\tuint8_t\t\tcprio:1;\n\tuint8_t\t\tpciechn:3;\n\n\tuint16_t\tiqid;\n\n\tuint8_t\t\tdcaen:1;\n\tuint8_t\t\tdcacpu:5;\n\n\tuint8_t\t\tfbmin:3;\n\tuint8_t\t\tfbmax:3;\n\n\tuint8_t\t\tcidxfthresho:1;\n\tuint8_t\t\tcidxfthresh:3;\n\n\tuint16_t\teqsize;\n\n\tuint64_t\teqaddr;\n};\n\nstruct csio_dma_buf {\n\tstruct list_head\tlist;\n\tvoid\t\t\t*vaddr;\t\t \n\tdma_addr_t\t\tpaddr;\t\t \n\tuint32_t\t\tlen;\t\t \n};\n\n \nstruct csio_ioreq {\n\tstruct csio_sm\t\tsm;\t\t \n\tint\t\t\tiq_idx;\t\t \n\tint\t\t\teq_idx;\t\t \n\tuint32_t\t\tnsge;\t\t \n\tuint32_t\t\ttmo;\t\t \n\tuint32_t\t\tdatadir;\t \n\tstruct csio_dma_buf\tdma_buf;\t \n\tuint16_t\t\twr_status;\t \n\tint16_t\t\t\tdrv_status;\t \n\tstruct csio_lnode\t*lnode;\t\t \n\tstruct csio_rnode\t*rnode;\t\t \n\tvoid (*io_cbfn) (struct csio_hw *, struct csio_ioreq *);\n\t\t\t\t\t\t \n\tvoid\t\t\t*scratch1;\t \n\tvoid\t\t\t*scratch2;\t \n\tstruct list_head\tgen_list;\t \n\tuint64_t\t\tfw_handle;\t \n\tuint8_t\t\t\tdcopy;\t\t \n\tuint8_t\t\t\treserved1;\n\tuint16_t\t\treserved2;\n\tstruct completion\tcmplobj;\t \n} ____cacheline_aligned_in_smp;\n\n \nstruct csio_qstatus_page {\n\t__be32 qid;\n\t__be16 cidx;\n\t__be16 pidx;\n};\n\n\nenum {\n\tCSIO_MAX_FLBUF_PER_IQWR = 4,\n\tCSIO_QCREDIT_SZ  = 64,\t\t\t \n\tCSIO_MAX_QID = 0xFFFF,\n\tCSIO_MAX_IQ = 128,\n\n\tCSIO_SGE_NTIMERS = 6,\n\tCSIO_SGE_NCOUNTERS = 4,\n\tCSIO_SGE_FL_SIZE_REGS = 16,\n};\n\n \nenum {\n\tCSIO_EGRESS\t= 1,\n\tCSIO_INGRESS\t= 2,\n\tCSIO_FREELIST\t= 3,\n};\n\n \nstruct csio_iqwr_footer {\n\t__be32\t\t\thdrbuflen_pidx;\n\t__be32\t\t\tpldbuflen_qid;\n\tunion {\n\t\tu8\t\ttype_gen;\n\t\t__be64\t\tlast_flit;\n\t} u;\n};\n\n#define IQWRF_NEWBUF\t\t(1 << 31)\n#define IQWRF_LEN_GET(x)\t(((x) >> 0) & 0x7fffffffU)\n#define IQWRF_GEN_SHIFT\t\t7\n#define IQWRF_TYPE_GET(x)\t(((x) >> 4) & 0x3U)\n\n\n \nstruct csio_wr_pair {\n\tvoid\t\t\t*addr1;\n\tuint32_t\t\tsize1;\n\tvoid\t\t\t*addr2;\n\tuint32_t\t\tsize2;\n};\n\n \nstruct csio_fl_dma_buf {\n\tstruct csio_dma_buf\tflbufs[CSIO_MAX_FLBUF_PER_IQWR];\n\t\t\t\t\t\t \n\tint\t\t\toffset;\t\t \n\tuint32_t\t\ttotlen;\t\t \n\tuint8_t\t\t\tdefer_free;\t \n};\n\n \ntypedef void (*iq_handler_t)(struct csio_hw *, void *, uint32_t,\n\t\t\t     struct csio_fl_dma_buf *, void *);\n\nstruct csio_iq {\n\tuint16_t\t\tiqid;\t\t \n\tuint16_t\t\tphysiqid;\t \n\tuint16_t\t\tgenbit;\t\t \n\tint\t\t\tflq_idx;\t \n\tiq_handler_t\t\tiq_intx_handler;  \n};\n\nstruct csio_eq {\n\tuint16_t\t\teqid;\t\t \n\tuint16_t\t\tphyseqid;\t \n\tuint8_t\t\t\twrap[512];\t \n};\n\nstruct csio_fl {\n\tuint16_t\t\tflid;\t\t \n\tuint16_t\t\tpacken;\t\t \n\tint\t\t\toffset;\t\t \n\tint\t\t\tsreg;\t\t \n\tstruct csio_dma_buf\t*bufs;\t\t \n};\n\nstruct csio_qstats {\n\tuint32_t\tn_tot_reqs;\t\t \n\tuint32_t\tn_tot_rsps;\t\t \n\tuint32_t\tn_qwrap;\t\t \n\tuint32_t\tn_eq_wr_split;\t\t \n\tuint32_t\tn_qentry;\t\t \n\tuint32_t\tn_qempty;\t\t \n\tuint32_t\tn_qfull;\t\t \n\tuint32_t\tn_rsp_unknown;\t\t \n\tuint32_t\tn_stray_comp;\t\t \n\tuint32_t\tn_flq_refill;\t\t \n};\n\n \nstruct csio_q {\n\tuint16_t\t\ttype;\t\t \n\tuint16_t\t\tpidx;\t\t \n\tuint16_t\t\tcidx;\t\t \n\tuint16_t\t\tinc_idx;\t \n\tuint32_t\t\twr_sz;\t\t \n\tvoid\t\t\t*vstart;\t \n\tvoid\t\t\t*vwrap;\t\t \n\tuint32_t\t\tcredits;\t \n\tvoid\t\t\t*owner;\t\t \n\tunion {\t\t\t\t\t \n\t\tstruct csio_iq\tiq;\n\t\tstruct csio_eq\teq;\n\t\tstruct csio_fl\tfl;\n\t} un;\n\n\tdma_addr_t\t\tpstart;\t\t \n\tuint32_t\t\tportid;\t\t \n\tuint32_t\t\tsize;\t\t \n\tstruct csio_qstats\tstats;\t\t \n} ____cacheline_aligned_in_smp;\n\nstruct csio_sge {\n\tuint32_t\tcsio_fl_align;\t\t \n\tuint32_t\tsge_control;\t\t \n\tuint32_t\tsge_host_page_size;\t \n\tuint32_t\tsge_fl_buf_size[CSIO_SGE_FL_SIZE_REGS];\n\t\t\t\t\t\t \n\tuint16_t\ttimer_val[CSIO_SGE_NTIMERS];\n\tuint8_t\t\tcounter_val[CSIO_SGE_NCOUNTERS];\n};\n\n \nstruct csio_wrm {\n\tint\t\t\tnum_q;\t\t \n\tstruct csio_q\t\t**q_arr;\t \n\tuint32_t\t\tfw_iq_start;\t \n\tuint32_t\t\tfw_eq_start;\t \n\tstruct csio_q\t\t*intr_map[CSIO_MAX_IQ];\n\t\t\t\t\t\t \n\tint\t\t\tfree_qidx;\t \n\tstruct csio_sge\t\tsge;\t\t \n};\n\n#define csio_get_q(__hw, __idx)\t\t((__hw)->wrm.q_arr[__idx])\n#define\tcsio_q_type(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->type)\n#define\tcsio_q_pidx(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->pidx)\n#define\tcsio_q_cidx(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->cidx)\n#define\tcsio_q_inc_idx(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->inc_idx)\n#define\tcsio_q_vstart(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->vstart)\n#define\tcsio_q_pstart(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->pstart)\n#define\tcsio_q_size(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->size)\n#define\tcsio_q_credits(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->credits)\n#define\tcsio_q_portid(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->portid)\n#define\tcsio_q_wr_sz(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->wr_sz)\n#define\tcsio_q_iqid(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->un.iq.iqid)\n#define csio_q_physiqid(__hw, __idx)\t\t\t\t\t\\\n\t\t\t\t((__hw)->wrm.q_arr[(__idx)]->un.iq.physiqid)\n#define csio_q_iq_flq_idx(__hw, __idx)\t\t\t\t\t\\\n\t\t\t\t((__hw)->wrm.q_arr[(__idx)]->un.iq.flq_idx)\n#define\tcsio_q_eqid(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->un.eq.eqid)\n#define\tcsio_q_flid(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->un.fl.flid)\n\n#define csio_q_physeqid(__hw, __idx)\t\t\t\t\t\\\n\t\t\t\t((__hw)->wrm.q_arr[(__idx)]->un.eq.physeqid)\n#define csio_iq_has_fl(__iq)\t\t((__iq)->un.iq.flq_idx != -1)\n\n#define csio_q_iq_to_flid(__hw, __iq_idx)\t\t\t\t\\\n\tcsio_q_flid((__hw), (__hw)->wrm.q_arr[(__iq_qidx)]->un.iq.flq_idx)\n#define csio_q_set_intr_map(__hw, __iq_idx, __rel_iq_id)\t\t\\\n\t\t(__hw)->wrm.intr_map[__rel_iq_id] = csio_get_q(__hw, __iq_idx)\n#define\tcsio_q_eq_wrap(__hw, __idx)\t((__hw)->wrm.q_arr[(__idx)]->un.eq.wrap)\n\nstruct csio_mb;\n\nint csio_wr_alloc_q(struct csio_hw *, uint32_t, uint32_t,\n\t\t    uint16_t, void *, uint32_t, int, iq_handler_t);\nint csio_wr_iq_create(struct csio_hw *, void *, int,\n\t\t\t\tuint32_t, uint8_t, bool,\n\t\t\t\tvoid (*)(struct csio_hw *, struct csio_mb *));\nint csio_wr_eq_create(struct csio_hw *, void *, int, int, uint8_t,\n\t\t\t\tvoid (*)(struct csio_hw *, struct csio_mb *));\nint csio_wr_destroy_queues(struct csio_hw *, bool cmd);\n\n\nint csio_wr_get(struct csio_hw *, int, uint32_t,\n\t\t\t  struct csio_wr_pair *);\nvoid csio_wr_copy_to_wrp(void *, struct csio_wr_pair *, uint32_t, uint32_t);\nint csio_wr_issue(struct csio_hw *, int, bool);\nint csio_wr_process_iq(struct csio_hw *, struct csio_q *,\n\t\t\t\t void (*)(struct csio_hw *, void *,\n\t\t\t\t\t  uint32_t, struct csio_fl_dma_buf *,\n\t\t\t\t\t  void *),\n\t\t\t\t void *);\nint csio_wr_process_iq_idx(struct csio_hw *, int,\n\t\t\t\t void (*)(struct csio_hw *, void *,\n\t\t\t\t\t  uint32_t, struct csio_fl_dma_buf *,\n\t\t\t\t\t  void *),\n\t\t\t\t void *);\n\nvoid csio_wr_sge_init(struct csio_hw *);\nint csio_wrm_init(struct csio_wrm *, struct csio_hw *);\nvoid csio_wrm_exit(struct csio_wrm *, struct csio_hw *);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}