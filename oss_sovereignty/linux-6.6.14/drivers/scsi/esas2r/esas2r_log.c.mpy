{
  "module_name": "esas2r_log.c",
  "hash_id": "2ecdb94800b633cf467fedbff58af80b9cfd94805cba8c0072dcb29183481008",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/esas2r/esas2r_log.c",
  "human_readable_source": " \n\n#include \"esas2r.h\"\n\n \n\n#define EVENT_LOG_BUFF_SIZE 1024\n\nstatic long event_log_level = ESAS2R_LOG_DFLT;\n\nmodule_param(event_log_level, long, S_IRUGO | S_IRUSR);\nMODULE_PARM_DESC(event_log_level,\n\t\t \"Specifies the level of events to report to the system log.  Critical and warning level events are logged by default.\");\n\n \nstatic char event_buffer[EVENT_LOG_BUFF_SIZE];\n\n \nstatic DEFINE_SPINLOCK(event_buffer_lock);\n\n \nstatic const char *translate_esas2r_event_level_to_kernel(const long level)\n{\n\tswitch (level) {\n\tcase ESAS2R_LOG_CRIT:\n\t\treturn KERN_CRIT;\n\n\tcase ESAS2R_LOG_WARN:\n\t\treturn KERN_WARNING;\n\n\tcase ESAS2R_LOG_INFO:\n\t\treturn KERN_INFO;\n\n\tcase ESAS2R_LOG_DEBG:\n\tcase ESAS2R_LOG_TRCE:\n\tdefault:\n\t\treturn KERN_DEBUG;\n\t}\n}\n\n#pragma GCC diagnostic push\n#ifndef __clang__\n#pragma GCC diagnostic ignored \"-Wsuggest-attribute=format\"\n#endif\n\n \nstatic int esas2r_log_master(const long level,\n\t\t\t     const struct device *dev,\n\t\t\t     const char *format,\n\t\t\t     va_list args)\n{\n\tif (level <= event_log_level) {\n\t\tunsigned long flags = 0;\n\t\tint retval = 0;\n\t\tchar *buffer = event_buffer;\n\t\tsize_t buflen = EVENT_LOG_BUFF_SIZE;\n\t\tconst char *fmt_nodev = \"%s%s: \";\n\t\tconst char *fmt_dev = \"%s%s [%s, %s, %s]\";\n\t\tconst char *slevel =\n\t\t\ttranslate_esas2r_event_level_to_kernel(level);\n\n\t\tspin_lock_irqsave(&event_buffer_lock, flags);\n\n\t\tmemset(buffer, 0, buflen);\n\n\t\t \n\n\t\tif (dev == NULL) {\n\t\t\tsnprintf(buffer, buflen, fmt_nodev, slevel,\n\t\t\t\t ESAS2R_DRVR_NAME);\n\t\t} else {\n\t\t\tsnprintf(buffer, buflen, fmt_dev, slevel,\n\t\t\t\t ESAS2R_DRVR_NAME,\n\t\t\t\t (dev->driver ? dev->driver->name : \"unknown\"),\n\t\t\t\t (dev->bus ? dev->bus->name : \"unknown\"),\n\t\t\t\t dev_name(dev));\n\t\t}\n\n\t\tbuffer += strlen(event_buffer);\n\t\tbuflen -= strlen(event_buffer);\n\n\t\tretval = vsnprintf(buffer, buflen, format, args);\n\t\tif (retval < 0) {\n\t\t\tspin_unlock_irqrestore(&event_buffer_lock, flags);\n\t\t\treturn -1;\n\t\t}\n\n\t\t \n\t\tprintk(\"%s\\n\", event_buffer);\n\n\t\tspin_unlock_irqrestore(&event_buffer_lock, flags);\n\t}\n\n\treturn 0;\n}\n\n#pragma GCC diagnostic pop\n\n \nint esas2r_log(const long level, const char *format, ...)\n{\n\tint retval = 0;\n\tva_list args;\n\n\tva_start(args, format);\n\n\tretval = esas2r_log_master(level, NULL, format, args);\n\n\tva_end(args);\n\n\treturn retval;\n}\n\n \nint esas2r_log_dev(const long level,\n\t\t   const struct device *dev,\n\t\t   const char *format,\n\t\t   ...)\n{\n\tint retval = 0;\n\tva_list args;\n\n\tva_start(args, format);\n\n\tretval = esas2r_log_master(level, dev, format, args);\n\n\tva_end(args);\n\n\treturn retval;\n}\n\n \nint esas2r_log_hexdump(const long level,\n\t\t       const void *buf,\n\t\t       size_t len)\n{\n\tif (level <= event_log_level) {\n\t\tprint_hex_dump(translate_esas2r_event_level_to_kernel(level),\n\t\t\t       \"\", DUMP_PREFIX_OFFSET, 16, 1, buf,\n\t\t\t       len, true);\n\t}\n\n\treturn 1;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}