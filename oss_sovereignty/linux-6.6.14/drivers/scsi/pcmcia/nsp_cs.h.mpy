{
  "module_name": "nsp_cs.h",
  "hash_id": "ea477b8fc17010075fc786d2603b9c61f7bb6c591a719b2062e6f9a4fdc459ac",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/pcmcia/nsp_cs.h",
  "human_readable_source": " \n\n#ifndef  __nsp_cs__\n#define  __nsp_cs__\n\n \n\n\n \n\n \n\n \n#define NSP_INITIATOR_ID  7\n\n#define NSP_SELTIMEOUT 200\n\n \n \n#define\tIRQCONTROL\t0x00   \n#  define IRQCONTROL_RESELECT_CLEAR     BIT(0)\n#  define IRQCONTROL_PHASE_CHANGE_CLEAR BIT(1)\n#  define IRQCONTROL_TIMER_CLEAR        BIT(2)\n#  define IRQCONTROL_FIFO_CLEAR         BIT(3)\n#  define IRQCONTROL_ALLMASK            0xff\n#  define IRQCONTROL_ALLCLEAR           (IRQCONTROL_RESELECT_CLEAR     | \\\n\t\t\t\t\t IRQCONTROL_PHASE_CHANGE_CLEAR | \\\n\t\t\t\t\t IRQCONTROL_TIMER_CLEAR        | \\\n\t\t\t\t\t IRQCONTROL_FIFO_CLEAR          )\n#  define IRQCONTROL_IRQDISABLE         0xf0\n\n#define\tIRQSTATUS\t0x00   \n#  define IRQSTATUS_SCSI  BIT(0)\n#  define IRQSTATUS_TIMER BIT(2)\n#  define IRQSTATUS_FIFO  BIT(3)\n#  define IRQSTATUS_MASK  0x0f\n\n#define\tIFSELECT\t0x01  \n#  define IF_IFSEL    BIT(0)\n#  define IF_REGSEL   BIT(2)\n\n#define\tFIFOSTATUS\t0x01  \n#  define FIFOSTATUS_CHIP_REVISION_MASK 0x0f\n#  define FIFOSTATUS_CHIP_ID_MASK       0x70\n#  define FIFOSTATUS_FULL_EMPTY         BIT(7)\n\n#define\tINDEXREG\t0x02  \n#define\tDATAREG\t\t0x03  \n#define\tFIFODATA\t0x04  \n#define\tFIFODATA1\t0x05  \n#define\tFIFODATA2\t0x06  \n#define\tFIFODATA3\t0x07  \n\n \n#define EXTBUSCTRL\t0x10  \n\n#define CLOCKDIV\t0x11  \n#  define CLOCK_40M 0x02\n#  define CLOCK_20M 0x01\n#  define FAST_20   BIT(2)\n\n#define TERMPWRCTRL\t0x13  \n#  define POWER_ON BIT(0)\n\n#define SCSIIRQMODE\t0x15  \n#  define SCSI_PHASE_CHANGE_EI BIT(0)\n#  define RESELECT_EI          BIT(4)\n#  define FIFO_IRQ_EI          BIT(5)\n#  define SCSI_RESET_IRQ_EI    BIT(6)\n\n#define IRQPHASESENCE\t0x16  \n#  define LATCHED_MSG      BIT(0)\n#  define LATCHED_IO       BIT(1)\n#  define LATCHED_CD       BIT(2)\n#  define LATCHED_BUS_FREE BIT(3)\n#  define PHASE_CHANGE_IRQ BIT(4)\n#  define RESELECT_IRQ     BIT(5)\n#  define FIFO_IRQ         BIT(6)\n#  define SCSI_RESET_IRQ   BIT(7)\n\n#define TIMERCOUNT\t0x17  \n\n#define SCSIBUSCTRL\t0x18  \n#  define SCSI_SEL         BIT(0)\n#  define SCSI_RST         BIT(1)\n#  define SCSI_DATAOUT_ENB BIT(2)\n#  define SCSI_ATN         BIT(3)\n#  define SCSI_ACK         BIT(4)\n#  define SCSI_BSY         BIT(5)\n#  define AUTODIRECTION    BIT(6)\n#  define ACKENB           BIT(7)\n\n#define SCSIBUSMON\t0x19  \n\n#define SETARBIT\t0x1A  \n#  define ARBIT_GO         BIT(0)\n#  define ARBIT_FLAG_CLEAR BIT(1)\n\n#define ARBITSTATUS\t0x1A  \n \n#  define ARBIT_WIN        BIT(1)\n#  define ARBIT_FAIL       BIT(2)\n#  define RESELECT_FLAG    BIT(3)\n\n#define PARITYCTRL\t0x1B   \n#define PARITYSTATUS\t0x1B   \n\n#define COMMANDCTRL\t0x1C   \n#  define CLEAR_COMMAND_POINTER BIT(0)\n#  define AUTO_COMMAND_GO       BIT(1)\n\n#define RESELECTID\t0x1C   \n#define COMMANDDATA\t0x1D   \n\n#define POINTERCLR\t0x1E   \n#  define POINTER_CLEAR      BIT(0)\n#  define ACK_COUNTER_CLEAR  BIT(1)\n#  define REQ_COUNTER_CLEAR  BIT(2)\n#  define HOST_COUNTER_CLEAR BIT(3)\n#  define READ_SOURCE        (BIT(4) | BIT(5))\n#    define ACK_COUNTER        (0)\n#    define REQ_COUNTER        (BIT(4))\n#    define HOST_COUNTER       (BIT(5))\n\n#define TRANSFERCOUNT\t0x1E   \n\n#define TRANSFERMODE\t0x20   \n#  define MODE_MEM8   BIT(0)\n#  define MODE_MEM32  BIT(1)\n#  define MODE_ADR24  BIT(2)\n#  define MODE_ADR32  BIT(3)\n#  define MODE_IO8    BIT(4)\n#  define MODE_IO32   BIT(5)\n#  define TRANSFER_GO BIT(6)\n#  define BRAIND      BIT(7)\n\n#define SYNCREG\t\t0x21  \n#  define SYNCREG_OFFSET_MASK  0x0f\n#  define SYNCREG_PERIOD_MASK  0xf0\n#  define SYNCREG_PERIOD_SHIFT 4\n\n#define SCSIDATALATCH\t0x22  \n#define SCSIDATAIN\t0x22  \n#define SCSIDATAWITHACK\t0x23  \n#define SCAMCONTROL\t0x24  \n#define SCAMSTATUS\t0x24  \n#define SCAMDATA\t0x25  \n\n#define OTHERCONTROL\t0x26  \n#  define TPL_ROM_WRITE_EN BIT(0)\n#  define TPWR_OUT         BIT(1)\n#  define TPWR_SENSE       BIT(2)\n#  define RA8_CONTROL      BIT(3)\n\n#define ACKWIDTH\t0x27  \n#define CLRTESTPNT\t0x28  \n#define ACKCNTLD\t0x29  \n#define REQCNTLD\t0x2A  \n#define HSTCNTLD\t0x2B  \n#define CHECKSUM\t0x2C  \n\n \n#define S_MESSAGE\tBIT(0)     \n#define S_IO\t\tBIT(1)     \n#define S_CD\t\tBIT(2)     \n#define S_BUSY\t\tBIT(3)     \n#define S_ACK\t\tBIT(4)     \n#define S_REQUEST\tBIT(5)     \n#define S_SELECT\tBIT(6)\t   \n#define S_ATN\t\tBIT(7)\t   \n\n \n#define BUSMON_SEL         S_SELECT\n#define BUSMON_BSY         S_BUSY\n#define BUSMON_REQ         S_REQUEST\n#define BUSMON_IO          S_IO\n#define BUSMON_ACK         S_ACK\n#define BUSMON_BUS_FREE    0\n#define BUSMON_COMMAND     ( S_BUSY | S_CD |                    S_REQUEST )\n#define BUSMON_MESSAGE_IN  ( S_BUSY | S_CD | S_IO | S_MESSAGE | S_REQUEST )\n#define BUSMON_MESSAGE_OUT ( S_BUSY | S_CD |        S_MESSAGE | S_REQUEST )\n#define BUSMON_DATA_IN     ( S_BUSY |        S_IO |             S_REQUEST )\n#define BUSMON_DATA_OUT    ( S_BUSY |                           S_REQUEST )\n#define BUSMON_STATUS      ( S_BUSY | S_CD | S_IO |             S_REQUEST )\n#define BUSMON_SELECT      (                 S_IO |                        S_SELECT )\n#define BUSMON_RESELECT    (                 S_IO |                        S_SELECT )\n#define BUSMON_PHASE_MASK  (          S_CD | S_IO | S_MESSAGE |            S_SELECT )\n\n#define BUSPHASE_SELECT      ( BUSMON_SELECT      & BUSMON_PHASE_MASK )\n#define BUSPHASE_COMMAND     ( BUSMON_COMMAND     & BUSMON_PHASE_MASK )\n#define BUSPHASE_MESSAGE_IN  ( BUSMON_MESSAGE_IN  & BUSMON_PHASE_MASK )\n#define BUSPHASE_MESSAGE_OUT ( BUSMON_MESSAGE_OUT & BUSMON_PHASE_MASK )\n#define BUSPHASE_DATA_IN     ( BUSMON_DATA_IN     & BUSMON_PHASE_MASK )\n#define BUSPHASE_DATA_OUT    ( BUSMON_DATA_OUT    & BUSMON_PHASE_MASK )\n#define BUSPHASE_STATUS      ( BUSMON_STATUS      & BUSMON_PHASE_MASK )\n\n \n\ntypedef struct scsi_info_t {\n\tstruct pcmcia_device\t*p_dev;\n\tstruct Scsi_Host      *host;\n\tint                    stop;\n} scsi_info_t;\n\n\n \ntypedef struct _sync_data {\n\tunsigned int SyncNegotiation;\n#define SYNC_NOT_YET 0\n#define SYNC_OK      1\n#define SYNC_NG      2\n\n\tunsigned int  SyncPeriod;\n\tunsigned int  SyncOffset;\n\tunsigned char SyncRegister;\n\tunsigned char AckWidth;\n} sync_data;\n\ntypedef struct _nsp_hw_data {\n\tunsigned int  BaseAddress;\n\tunsigned int  NumAddress;\n\tunsigned int  IrqNumber;\n\n\tunsigned long MmioAddress;\n#define NSP_MMIO_OFFSET 0x0800\n\tunsigned long MmioLength;\n\n\tunsigned char ScsiClockDiv;\n\n\tunsigned char TransferMode;\n\n\tint           TimerCount;\n\tint           SelectionTimeOut;\n\tstruct scsi_cmnd *CurrentSC;\n\t\n\n\tint           FifoCount;\n\n#define MSGBUF_SIZE 20\n\tunsigned char MsgBuffer[MSGBUF_SIZE];\n\tint MsgLen;\n\n#define N_TARGET 8\n\tsync_data     Sync[N_TARGET];\n\n\tchar nspinfo[110];      \n\tspinlock_t Lock;\n\n\tscsi_info_t   *ScsiInfo;  \n\n\n#ifdef NSP_DEBUG\n\tint CmdId;  \n#endif\n} nsp_hw_data;\n\n \n\n \nstatic void        nsp_cs_detach (struct pcmcia_device *p_dev);\nstatic void        nsp_cs_release(struct pcmcia_device *link);\nstatic int        nsp_cs_config (struct pcmcia_device *link);\n\n \nstatic struct Scsi_Host *nsp_detect     (struct scsi_host_template *sht);\nstatic const  char      *nsp_info       (struct Scsi_Host *shpnt);\nstatic        int        nsp_show_info  (struct seq_file *m,\n\t                                 struct Scsi_Host *host);\nstatic int nsp_queuecommand(struct Scsi_Host *h, struct scsi_cmnd *SCpnt);\n\n \n \n \nstatic int nsp_eh_bus_reset    (struct scsi_cmnd *SCpnt);\nstatic int nsp_eh_host_reset   (struct scsi_cmnd *SCpnt);\nstatic int nsp_bus_reset       (nsp_hw_data *data);\n\n \nstatic void nsphw_init           (nsp_hw_data *data);\nstatic bool nsphw_start_selection(struct scsi_cmnd *SCpnt);\nstatic void nsp_start_timer      (struct scsi_cmnd *SCpnt, int time);\nstatic int  nsp_fifo_count       (struct scsi_cmnd *SCpnt);\nstatic void nsp_pio_read         (struct scsi_cmnd *SCpnt);\nstatic void nsp_pio_write        (struct scsi_cmnd *SCpnt);\nstatic int  nsp_nexus            (struct scsi_cmnd *SCpnt);\nstatic void nsp_scsi_done        (struct scsi_cmnd *SCpnt);\nstatic int  nsp_analyze_sdtr     (struct scsi_cmnd *SCpnt);\nstatic int  nsp_negate_signal    (struct scsi_cmnd *SCpnt,\n\t\t\t\t  unsigned char mask, char *str);\nstatic int  nsp_expect_signal    (struct scsi_cmnd *SCpnt,\n\t\t\t\t  unsigned char current_phase,\n\t\t\t\t  unsigned char  mask);\nstatic int  nsp_xfer             (struct scsi_cmnd *SCpnt, int phase);\nstatic int  nsp_dataphase_bypass (struct scsi_cmnd *SCpnt);\nstatic void nsp_reselected       (struct scsi_cmnd *SCpnt);\nstatic struct Scsi_Host *nsp_detect(struct scsi_host_template *sht);\n\n \n\n\n \n#ifdef NSP_DEBUG\nstatic void show_command (struct scsi_cmnd *SCpnt);\nstatic void show_phase   (struct scsi_cmnd *SCpnt);\nstatic void show_busphase(unsigned char stat);\nstatic void show_message (nsp_hw_data *data);\n#else\n# define show_command(ptr)    \n# define show_phase(SCpnt)    \n# define show_busphase(stat)  \n# define show_message(data)   \n#endif\n\n \nenum _scsi_phase {\n\tPH_UNDETERMINED ,\n\tPH_ARBSTART     ,\n\tPH_SELSTART     ,\n\tPH_SELECTED     ,\n\tPH_COMMAND      ,\n\tPH_DATA         ,\n\tPH_STATUS       ,\n\tPH_MSG_IN       ,\n\tPH_MSG_OUT      ,\n\tPH_DISCONNECT   ,\n\tPH_RESELECT     ,\n\tPH_ABORT        ,\n\tPH_RESET\n};\n\nenum _data_in_out {\n\tIO_UNKNOWN,\n\tIO_IN,\n\tIO_OUT\n};\n\nenum _burst_mode {\n\tBURST_IO8   = 0,\n\tBURST_IO32  = 1,\n\tBURST_MEM32 = 2,\n};\n\n \n#define BUFFER_ADDR(SCpnt) ((char *)(sg_virt(nsp_priv(SCpnt)->buffer)))\n\n#endif   \n \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}