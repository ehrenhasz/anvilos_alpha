{
  "module_name": "aha152x_stub.c",
  "hash_id": "d4d2165b4ba87c89952a68c23907626e2bdcf5688e8a4419c1be1c2adc5c5ba4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/pcmcia/aha152x_stub.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/ioport.h>\n#include <linux/major.h>\n#include <linux/blkdev.h>\n\n#include <scsi/scsi.h>\n#include <scsi/scsi_cmnd.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_eh.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_ioctl.h>\n#include <scsi/scsi_tcq.h>\n#include \"aha152x.h\"\n\n#include <pcmcia/cistpl.h>\n#include <pcmcia/ds.h>\n\n\n \n\n \n\n \nstatic int host_id = 7;\nstatic int reconnect = 1;\nstatic int parity = 1;\nstatic int synchronous = 1;\nstatic int reset_delay = 100;\nstatic int ext_trans = 0;\n\nmodule_param(host_id, int, 0);\nmodule_param(reconnect, int, 0);\nmodule_param(parity, int, 0);\nmodule_param(synchronous, int, 0);\nmodule_param(reset_delay, int, 0);\nmodule_param(ext_trans, int, 0);\n\nMODULE_LICENSE(\"Dual MPL/GPL\");\n\n \n\ntypedef struct scsi_info_t {\n\tstruct pcmcia_device\t*p_dev;\n    struct Scsi_Host\t*host;\n} scsi_info_t;\n\nstatic void aha152x_release_cs(struct pcmcia_device *link);\nstatic void aha152x_detach(struct pcmcia_device *p_dev);\nstatic int aha152x_config_cs(struct pcmcia_device *link);\n\nstatic int aha152x_probe(struct pcmcia_device *link)\n{\n    scsi_info_t *info;\n\n    dev_dbg(&link->dev, \"aha152x_attach()\\n\");\n\n     \n    info = kzalloc(sizeof(*info), GFP_KERNEL);\n    if (!info) return -ENOMEM;\n    info->p_dev = link;\n    link->priv = info;\n\n    link->config_flags |= CONF_ENABLE_IRQ | CONF_AUTO_SET_IO;\n    link->config_regs = PRESENT_OPTION;\n\n    return aha152x_config_cs(link);\n}  \n\n \n\nstatic void aha152x_detach(struct pcmcia_device *link)\n{\n    dev_dbg(&link->dev, \"aha152x_detach\\n\");\n\n    aha152x_release_cs(link);\n\n     \n    kfree(link->priv);\n}  \n\n \n\nstatic int aha152x_config_check(struct pcmcia_device *p_dev, void *priv_data)\n{\n\tp_dev->io_lines = 10;\n\n\t \n\tif ((p_dev->resource[0]->end < 0x20) &&\n\t\t(p_dev->resource[1]->end >= 0x20))\n\t\tp_dev->resource[0]->start = p_dev->resource[1]->start;\n\n\tif (p_dev->resource[0]->start >= 0xffff)\n\t\treturn -EINVAL;\n\n\tp_dev->resource[1]->start = p_dev->resource[1]->end = 0;\n\tp_dev->resource[0]->end = 0x20;\n\tp_dev->resource[0]->flags &= ~IO_DATA_PATH_WIDTH;\n\tp_dev->resource[0]->flags |= IO_DATA_PATH_WIDTH_AUTO;\n\n\treturn pcmcia_request_io(p_dev);\n}\n\nstatic int aha152x_config_cs(struct pcmcia_device *link)\n{\n    scsi_info_t *info = link->priv;\n    struct aha152x_setup s;\n    int ret;\n    struct Scsi_Host *host;\n\n    dev_dbg(&link->dev, \"aha152x_config\\n\");\n\n    ret = pcmcia_loop_config(link, aha152x_config_check, NULL);\n    if (ret)\n\t    goto failed;\n\n    if (!link->irq)\n\t    goto failed;\n\n    ret = pcmcia_enable_device(link);\n    if (ret)\n\t    goto failed;\n    \n     \n    memset(&s, 0, sizeof(s));\n    s.conf        = \"PCMCIA setup\";\n    s.io_port     = link->resource[0]->start;\n    s.irq         = link->irq;\n    s.scsiid      = host_id;\n    s.reconnect   = reconnect;\n    s.parity      = parity;\n    s.synchronous = synchronous;\n    s.delay       = reset_delay;\n    if (ext_trans)\n        s.ext_trans = ext_trans;\n\n    host = aha152x_probe_one(&s);\n    if (host == NULL) {\n\tprintk(KERN_INFO \"aha152x_cs: no SCSI devices found\\n\");\n\tgoto failed;\n    }\n\n    info->host = host;\n\n    return 0;\n\nfailed:\n    aha152x_release_cs(link);\n    return -ENODEV;\n}\n\nstatic void aha152x_release_cs(struct pcmcia_device *link)\n{\n\tscsi_info_t *info = link->priv;\n\n\taha152x_release(info->host);\n\tpcmcia_disable_device(link);\n}\n\nstatic int aha152x_resume(struct pcmcia_device *link)\n{\n\tscsi_info_t *info = link->priv;\n\n\taha152x_host_reset_host(info->host);\n\n\treturn 0;\n}\n\nstatic const struct pcmcia_device_id aha152x_ids[] = {\n\tPCMCIA_DEVICE_PROD_ID123(\"New Media\", \"SCSI\", \"Bus Toaster\", 0xcdf7e4cc, 0x35f26476, 0xa8851d6e),\n\tPCMCIA_DEVICE_PROD_ID123(\"NOTEWORTHY\", \"SCSI\", \"Bus Toaster\", 0xad89c6e8, 0x35f26476, 0xa8851d6e),\n\tPCMCIA_DEVICE_PROD_ID12(\"Adaptec, Inc.\", \"APA-1460 SCSI Host Adapter\", 0x24ba9738, 0x3a3c3d20),\n\tPCMCIA_DEVICE_PROD_ID12(\"New Media Corporation\", \"Multimedia Sound/SCSI\", 0x085a850b, 0x80a6535c),\n\tPCMCIA_DEVICE_PROD_ID12(\"NOTEWORTHY\", \"NWCOMB02 SCSI/AUDIO COMBO CARD\", 0xad89c6e8, 0x5f9a615b),\n\tPCMCIA_DEVICE_NULL,\n};\nMODULE_DEVICE_TABLE(pcmcia, aha152x_ids);\n\nstatic struct pcmcia_driver aha152x_cs_driver = {\n\t.owner\t\t= THIS_MODULE,\n\t.name\t\t= \"aha152x_cs\",\n\t.probe\t\t= aha152x_probe,\n\t.remove\t\t= aha152x_detach,\n\t.id_table       = aha152x_ids,\n\t.resume\t\t= aha152x_resume,\n};\nmodule_pcmcia_driver(aha152x_cs_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}