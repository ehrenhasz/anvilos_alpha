{
  "module_name": "mpt3sas_debugfs.c",
  "hash_id": "c7bd3edee5f7809ddaa75b442ae1fcb56c285efa5ed460918fd1f138133b242c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/mpt3sas/mpt3sas_debugfs.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/pci.h>\n#include <linux/interrupt.h>\n#include <linux/compat.h>\n#include <linux/uio.h>\n\n#include <scsi/scsi.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_host.h>\n#include \"mpt3sas_base.h\"\n#include <linux/debugfs.h>\n\nstatic struct dentry *mpt3sas_debugfs_root;\n\n \n\nstatic ssize_t\n_debugfs_iocdump_read(struct file *filp, char __user *ubuf, size_t cnt,\n\tloff_t *ppos)\n\n{\n\tstruct mpt3sas_debugfs_buffer *debug = filp->private_data;\n\n\tif (!debug || !debug->buf)\n\t\treturn 0;\n\n\treturn simple_read_from_buffer(ubuf, cnt, ppos, debug->buf, debug->len);\n}\n\n \nstatic int\n_debugfs_iocdump_open(struct inode *inode, struct file *file)\n{\n\tstruct MPT3SAS_ADAPTER *ioc = inode->i_private;\n\tstruct mpt3sas_debugfs_buffer *debug;\n\n\tdebug = kzalloc(sizeof(struct mpt3sas_debugfs_buffer), GFP_KERNEL);\n\tif (!debug)\n\t\treturn -ENOMEM;\n\n\tdebug->buf = (void *)ioc;\n\tdebug->len = sizeof(struct MPT3SAS_ADAPTER);\n\tfile->private_data = debug;\n\treturn 0;\n}\n\n \nstatic int\n_debugfs_iocdump_release(struct inode *inode, struct file *file)\n{\n\tstruct mpt3sas_debugfs_buffer *debug = file->private_data;\n\n\tif (!debug)\n\t\treturn 0;\n\n\tfile->private_data = NULL;\n\tkfree(debug);\n\treturn 0;\n}\n\nstatic const struct file_operations mpt3sas_debugfs_iocdump_fops = {\n\t.owner\t\t= THIS_MODULE,\n\t.open           = _debugfs_iocdump_open,\n\t.read           = _debugfs_iocdump_read,\n\t.release        = _debugfs_iocdump_release,\n};\n\n \nvoid mpt3sas_init_debugfs(void)\n{\n\tmpt3sas_debugfs_root = debugfs_create_dir(\"mpt3sas\", NULL);\n\tif (!mpt3sas_debugfs_root)\n\t\tpr_info(\"mpt3sas: Cannot create debugfs root\\n\");\n}\n\n \nvoid mpt3sas_exit_debugfs(void)\n{\n\tdebugfs_remove_recursive(mpt3sas_debugfs_root);\n}\n\n \nvoid\nmpt3sas_setup_debugfs(struct MPT3SAS_ADAPTER *ioc)\n{\n\tchar name[64];\n\n\tsnprintf(name, sizeof(name), \"scsi_host%d\", ioc->shost->host_no);\n\tif (!ioc->debugfs_root) {\n\t\tioc->debugfs_root =\n\t\t    debugfs_create_dir(name, mpt3sas_debugfs_root);\n\t\tif (!ioc->debugfs_root) {\n\t\t\tdev_err(&ioc->pdev->dev,\n\t\t\t    \"Cannot create per adapter debugfs directory\\n\");\n\t\t\treturn;\n\t\t}\n\t}\n\n\tsnprintf(name, sizeof(name), \"ioc_dump\");\n\tioc->ioc_dump =\tdebugfs_create_file(name, 0444,\n\t    ioc->debugfs_root, ioc, &mpt3sas_debugfs_iocdump_fops);\n\tif (!ioc->ioc_dump) {\n\t\tdev_err(&ioc->pdev->dev,\n\t\t    \"Cannot create ioc_dump debugfs file\\n\");\n\t\tdebugfs_remove(ioc->debugfs_root);\n\t\treturn;\n\t}\n\n\tsnprintf(name, sizeof(name), \"host_recovery\");\n\tdebugfs_create_u8(name, 0444, ioc->debugfs_root, &ioc->shost_recovery);\n\n}\n\n \nvoid mpt3sas_destroy_debugfs(struct MPT3SAS_ADAPTER *ioc)\n{\n\tdebugfs_remove_recursive(ioc->debugfs_root);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}