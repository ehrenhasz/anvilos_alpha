{
  "module_name": "snic.h",
  "hash_id": "4645347a9b8f5a5cc79453cdd06792292d5c1f0e395f793c280f4bf07157dfc9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/snic/snic.h",
  "human_readable_source": " \n \n\n#ifndef _SNIC_H_\n#define _SNIC_H_\n\n#include <linux/module.h>\n#include <linux/netdevice.h>\n#include <linux/workqueue.h>\n#include <linux/bitops.h>\n#include <linux/mempool.h>\n#include <scsi/scsi_cmnd.h>\n#include <scsi/scsi.h>\n#include <scsi/scsi_host.h>\n\n#include \"snic_disc.h\"\n#include \"snic_io.h\"\n#include \"snic_res.h\"\n#include \"snic_trc.h\"\n#include \"snic_stats.h\"\n#include \"vnic_dev.h\"\n#include \"vnic_wq.h\"\n#include \"vnic_cq.h\"\n#include \"vnic_intr.h\"\n#include \"vnic_stats.h\"\n#include \"vnic_snic.h\"\n\n#define SNIC_DRV_NAME\t\t\"snic\"\n#define SNIC_DRV_DESCRIPTION\t\"Cisco SCSI NIC Driver\"\n#define SNIC_DRV_VERSION\t\"0.0.1.18\"\n#define PFX\t\t\tSNIC_DRV_NAME \":\"\n#define DFX\t\t\tSNIC_DRV_NAME \"%d: \"\n\n#define DESC_CLEAN_LOW_WATERMARK\t8\n#define SNIC_UCSM_DFLT_THROTTLE_CNT_BLD 16  \n#define SNIC_MAX_IO_REQ\t\t\t50  \n#define SNIC_MIN_IO_REQ\t\t\t8   \n#define SNIC_IO_LOCKS\t\t\t64  \n#define SNIC_DFLT_QUEUE_DEPTH\t\t32  \n#define SNIC_MAX_QUEUE_DEPTH\t\t64  \n#define SNIC_DFLT_CMD_TIMEOUT\t\t90  \n\n \n#define SNIC_TAG_ABORT\t\tBIT(30)\t\t \n#define SNIC_TAG_DEV_RST\tBIT(29)\t\t \n#define SNIC_TAG_IOCTL_DEV_RST\tBIT(28)\t\t \n#define SNIC_TAG_MASK\t\t(BIT(24) - 1)\t \n#define SNIC_NO_TAG\t\t-1\n\n \n#define SNIC_NO_FLAGS\t\t\t0\n#define SNIC_IO_INITIALIZED\t\tBIT(0)\n#define SNIC_IO_ISSUED\t\t\tBIT(1)\n#define SNIC_IO_DONE\t\t\tBIT(2)\n#define SNIC_IO_REQ_NULL\t\tBIT(3)\n#define SNIC_IO_ABTS_PENDING\t\tBIT(4)\n#define SNIC_IO_ABORTED\t\t\tBIT(5)\n#define SNIC_IO_ABTS_ISSUED\t\tBIT(6)\n#define SNIC_IO_TERM_ISSUED\t\tBIT(7)\n#define SNIC_IO_ABTS_TIMEDOUT\t\tBIT(8)\n#define SNIC_IO_ABTS_TERM_DONE\t\tBIT(9)\n#define SNIC_IO_ABTS_TERM_REQ_NULL\tBIT(10)\n#define SNIC_IO_ABTS_TERM_TIMEDOUT\tBIT(11)\n#define SNIC_IO_INTERNAL_TERM_PENDING\tBIT(12)\n#define SNIC_IO_INTERNAL_TERM_ISSUED\tBIT(13)\n#define SNIC_DEVICE_RESET\t\tBIT(14)\n#define SNIC_DEV_RST_ISSUED\t\tBIT(15)\n#define SNIC_DEV_RST_TIMEDOUT\t\tBIT(16)\n#define SNIC_DEV_RST_ABTS_ISSUED\tBIT(17)\n#define SNIC_DEV_RST_TERM_ISSUED\tBIT(18)\n#define SNIC_DEV_RST_DONE\t\tBIT(19)\n#define SNIC_DEV_RST_REQ_NULL\t\tBIT(20)\n#define SNIC_DEV_RST_ABTS_DONE\t\tBIT(21)\n#define SNIC_DEV_RST_TERM_DONE\t\tBIT(22)\n#define SNIC_DEV_RST_ABTS_PENDING\tBIT(23)\n#define SNIC_DEV_RST_PENDING\t\tBIT(24)\n#define SNIC_DEV_RST_NOTSUP\t\tBIT(25)\n#define SNIC_SCSI_CLEANUP\t\tBIT(26)\n#define SNIC_HOST_RESET_ISSUED\t\tBIT(27)\n#define SNIC_HOST_RESET_CMD_TERM\t\\\n\t(SNIC_DEV_RST_NOTSUP | SNIC_SCSI_CLEANUP | SNIC_HOST_RESET_ISSUED)\n\n#define SNIC_ABTS_TIMEOUT\t\t30000\t\t \n#define SNIC_LUN_RESET_TIMEOUT\t\t30000\t\t \n#define SNIC_HOST_RESET_TIMEOUT\t\t30000\t\t \n\n\n \n#define CMD_SP(Cmnd)\t\t\\\n\t(((struct snic_internal_io_state *)scsi_cmd_priv(Cmnd))->rqi)\n#define CMD_STATE(Cmnd)\t\t\\\n\t(((struct snic_internal_io_state *)scsi_cmd_priv(Cmnd))->state)\n#define CMD_ABTS_STATUS(Cmnd)\t\\\n\t(((struct snic_internal_io_state *)scsi_cmd_priv(Cmnd))->abts_status)\n#define CMD_LR_STATUS(Cmnd)\t\\\n\t(((struct snic_internal_io_state *)scsi_cmd_priv(Cmnd))->lr_status)\n#define CMD_FLAGS(Cmnd)\t\\\n\t(((struct snic_internal_io_state *)scsi_cmd_priv(Cmnd))->flags)\n\n#define SNIC_INVALID_CODE 0x100\t \n\n#define SNIC_MAX_TARGET\t\t\t256\n#define SNIC_FLAGS_NONE\t\t\t(0)\n\n \nextern unsigned int snic_max_qdepth;\n\n \nextern unsigned int snic_log_level;\n\n#define SNIC_MAIN_LOGGING\t0x1\n#define SNIC_SCSI_LOGGING\t0x2\n#define SNIC_ISR_LOGGING\t0x8\n#define SNIC_DESC_LOGGING\t0x10\n\n#define SNIC_CHECK_LOGGING(LEVEL, CMD)\t\t\\\ndo {\t\t\t\t\t\t\\\n\tif (unlikely(snic_log_level & LEVEL))\t\\\n\t\tdo {\t\t\t\t\\\n\t\t\tCMD;\t\t\t\\\n\t\t} while (0);\t\t\t\\\n} while (0)\n\n#define SNIC_MAIN_DBG(host, fmt, args...)\t\\\n\tSNIC_CHECK_LOGGING(SNIC_MAIN_LOGGING,\t\t\\\n\t\tshost_printk(KERN_INFO, host, fmt, ## args);)\n\n#define SNIC_SCSI_DBG(host, fmt, args...)\t\\\n\tSNIC_CHECK_LOGGING(SNIC_SCSI_LOGGING,\t\t\\\n\t\tshost_printk(KERN_INFO, host, fmt, ##args);)\n\n#define SNIC_DISC_DBG(host, fmt, args...)\t\\\n\tSNIC_CHECK_LOGGING(SNIC_SCSI_LOGGING,\t\t\\\n\t\tshost_printk(KERN_INFO, host, fmt, ##args);)\n\n#define SNIC_ISR_DBG(host, fmt, args...)\t\\\n\tSNIC_CHECK_LOGGING(SNIC_ISR_LOGGING,\t\t\\\n\t\tshost_printk(KERN_INFO, host, fmt, ##args);)\n\n#define SNIC_HOST_ERR(host, fmt, args...)\t\t\\\n\tshost_printk(KERN_ERR, host, fmt, ##args)\n\n#define SNIC_HOST_INFO(host, fmt, args...)\t\t\\\n\tshost_printk(KERN_INFO, host, fmt, ##args)\n\n#define SNIC_INFO(fmt, args...)\t\t\t\t\\\n\tpr_info(PFX fmt, ## args)\n\n#define SNIC_DBG(fmt, args...)\t\t\t\t\\\n\tpr_info(PFX fmt, ## args)\n\n#define SNIC_ERR(fmt, args...)\t\t\t\t\\\n\tpr_err(PFX fmt, ## args)\n\n#ifdef DEBUG\n#define SNIC_BUG_ON(EXPR) \\\n\t({ \\\n\t\tif (EXPR) { \\\n\t\t\tSNIC_ERR(\"SNIC BUG(%s)\\n\", #EXPR); \\\n\t\t\tBUG_ON(EXPR); \\\n\t\t} \\\n\t})\n#else\n#define SNIC_BUG_ON(EXPR) \\\n\t({ \\\n\t\tif (EXPR) { \\\n\t\t\tSNIC_ERR(\"SNIC BUG(%s) at %s : %d\\n\", \\\n\t\t\t\t #EXPR, __func__, __LINE__); \\\n\t\t\tWARN_ON_ONCE(EXPR); \\\n\t\t} \\\n\t})\n#endif\n\n \n#define SNIC_ASSERT_NOT_IMPL(EXPR) \\\n\t({ \\\n\t\tif (EXPR) {\\\n\t\t\tSNIC_INFO(\"Functionality not impl'ed at %s:%d\\n\", \\\n\t\t\t\t  __func__, __LINE__); \\\n\t\t\tWARN_ON_ONCE(EXPR); \\\n\t\t} \\\n\t })\n\n\nextern const char *snic_state_str[];\n\nenum snic_intx_intr_index {\n\tSNIC_INTX_WQ_RQ_COPYWQ,\n\tSNIC_INTX_ERR,\n\tSNIC_INTX_NOTIFY,\n\tSNIC_INTX_INTR_MAX,\n};\n\nenum snic_msix_intr_index {\n\tSNIC_MSIX_WQ,\n\tSNIC_MSIX_IO_CMPL,\n\tSNIC_MSIX_ERR_NOTIFY,\n\tSNIC_MSIX_INTR_MAX,\n};\n\n#define SNIC_INTRHDLR_NAMSZ\t(2 * IFNAMSIZ)\nstruct snic_msix_entry {\n\tint requested;\n\tchar devname[SNIC_INTRHDLR_NAMSZ];\n\tirqreturn_t (*isr)(int, void *);\n\tvoid *devid;\n};\n\nenum snic_state {\n\tSNIC_INIT = 0,\n\tSNIC_ERROR,\n\tSNIC_ONLINE,\n\tSNIC_OFFLINE,\n\tSNIC_FWRESET,\n};\n\n#define SNIC_WQ_MAX\t\t1\n#define SNIC_CQ_IO_CMPL_MAX\t1\n#define SNIC_CQ_MAX\t\t(SNIC_WQ_MAX + SNIC_CQ_IO_CMPL_MAX)\n\n \nstruct snic_fw_info {\n\tu32\tfw_ver;\n\tu32\thid;\t\t\t \n\tu32\tmax_concur_ios;\t\t \n\tu32\tmax_sgs_per_cmd;\t \n\tu32\tmax_io_sz;\t\t \n\tu32\thba_cap;\t\t \n\tu32\tmax_tgts;\t\t \n\tu16\tio_tmo;\t\t\t \n\tstruct completion *wait;\t \n};\n\n \nstruct snic_work {\n\tstruct work_struct work;\n\tu16\tev_id;\n\tu64\t*ev_data;\n};\n\n \nstruct snic {\n\t \n\tstruct list_head list;\n\tchar name[IFNAMSIZ];\n\tatomic_t state;\n\tspinlock_t snic_lock;\n\tstruct completion *remove_wait;\n\tbool in_remove;\n\tbool stop_link_events;\t\t \n\n\t \n\tstruct snic_disc disc;\n\n\t \n\tstruct Scsi_Host *shost;\n\n\t \n\tstruct vnic_dev_bar bar0;\n\n\tstruct vnic_stats *stats;\n\tunsigned long stats_time;\n\tunsigned long stats_reset_time;\n\n\tstruct vnic_dev *vdev;\n\n\t \n\tunsigned int wq_count;\n\tunsigned int cq_count;\n\tunsigned int intr_count;\n\tunsigned int err_intr_offset;\n\n\tint link_status;  \n\tu32 link_down_cnt;\n\n\t \n\tstruct pci_dev *pdev;\n\tstruct snic_msix_entry msix[SNIC_MSIX_INTR_MAX];\n\n\t \n\tmempool_t *req_pool[SNIC_REQ_MAX_CACHES];  \n\t____cacheline_aligned spinlock_t io_req_lock[SNIC_IO_LOCKS];\n\n\t \n\t____cacheline_aligned spinlock_t spl_cmd_lock;\n\tstruct list_head spl_cmd_list;\n\n\tunsigned int max_tag_id;\n\tatomic_t ios_inflight;\t\t \n\n\tstruct vnic_snic_config config;\n\n\tstruct work_struct link_work;\n\n\t \n\tstruct snic_fw_info fwinfo;\n\n\t \n\tstruct work_struct tgt_work;\n\n\t \n\tstruct work_struct disc_work;\n\n\t \n\tunsigned int reset_stats;\n\tatomic64_t io_cmpl_skip;\n\tstruct snic_stats s_stats;\t \n\n\t \n#ifdef CONFIG_SCSI_SNIC_DEBUG_FS\n\tstruct dentry *stats_host;\t \n\tstruct dentry *stats_file;\t \n\tstruct dentry *reset_stats_file; \n#endif\n\n\t \n\t____cacheline_aligned struct vnic_cq cq[SNIC_CQ_MAX];\n\n\t \n\t____cacheline_aligned struct vnic_wq wq[SNIC_WQ_MAX];\n\tspinlock_t wq_lock[SNIC_WQ_MAX];\n\n\t \n\t____cacheline_aligned struct vnic_intr intr[SNIC_MSIX_INTR_MAX];\n};  \n\n \nstruct snic_global {\n\tstruct list_head snic_list;\n\tspinlock_t snic_list_lock;\n\n\tstruct kmem_cache *req_cache[SNIC_REQ_MAX_CACHES];\n\n\tstruct workqueue_struct *event_q;\n\n#ifdef CONFIG_SCSI_SNIC_DEBUG_FS\n\t \n\tstruct dentry *trc_root;\n\tstruct dentry *stats_root;\n\n\tstruct snic_trc trc ____cacheline_aligned;\n#endif\n};\n\nextern struct snic_global *snic_glob;\n\nint snic_glob_init(void);\nvoid snic_glob_cleanup(void);\n\nextern struct workqueue_struct *snic_event_queue;\nextern const struct attribute_group *snic_host_groups[];\n\nint snic_queuecommand(struct Scsi_Host *, struct scsi_cmnd *);\nint snic_abort_cmd(struct scsi_cmnd *);\nint snic_device_reset(struct scsi_cmnd *);\nint snic_host_reset(struct scsi_cmnd *);\nint snic_reset(struct Scsi_Host *, struct scsi_cmnd *);\nvoid snic_shutdown_scsi_cleanup(struct snic *);\n\n\nint snic_request_intr(struct snic *);\nvoid snic_free_intr(struct snic *);\nint snic_set_intr_mode(struct snic *);\nvoid snic_clear_intr_mode(struct snic *);\n\nint snic_fwcq_cmpl_handler(struct snic *, int);\nint snic_wq_cmpl_handler(struct snic *, int);\nvoid snic_free_wq_buf(struct vnic_wq *, struct vnic_wq_buf *);\n\n\nvoid snic_log_q_error(struct snic *);\nvoid snic_handle_link_event(struct snic *);\nvoid snic_handle_link(struct work_struct *);\n\nint snic_queue_exch_ver_req(struct snic *);\nvoid snic_io_exch_ver_cmpl_handler(struct snic *, struct snic_fw_req *);\n\nint snic_queue_wq_desc(struct snic *, void *os_buf, u16 len);\n\nvoid snic_handle_untagged_req(struct snic *, struct snic_req_info *);\nvoid snic_release_untagged_req(struct snic *, struct snic_req_info *);\nvoid snic_free_all_untagged_reqs(struct snic *);\nint snic_get_conf(struct snic *);\nvoid snic_set_state(struct snic *, enum snic_state);\nint snic_get_state(struct snic *);\nconst char *snic_state_to_str(unsigned int);\nvoid snic_hex_dump(char *, char *, int);\nvoid snic_print_desc(const char *fn, char *os_buf, int len);\nconst char *show_opcode_name(int val);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}