{
  "module_name": "esp_scsi.h",
  "hash_id": "624b00b751005efb54d0c351d212c1457f4b51816a6a5181fbb42de743df025a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/esp_scsi.h",
  "human_readable_source": " \n \n\n#ifndef _ESP_SCSI_H\n#define _ESP_SCSI_H\n\n\t\t\t\t\t \n#define ESP_TCLOW\t0x00UL\t\t \n#define ESP_TCMED\t0x01UL\t\t \n#define ESP_FDATA\t0x02UL\t\t \n#define ESP_CMD\t\t0x03UL\t\t \n#define ESP_STATUS\t0x04UL\t\t \n#define ESP_BUSID\tESP_STATUS\t \n#define ESP_INTRPT\t0x05UL\t\t \n#define ESP_TIMEO\tESP_INTRPT\t \n#define ESP_SSTEP\t0x06UL\t\t \n#define ESP_STP\t\tESP_SSTEP\t \n#define ESP_FFLAGS\t0x07UL\t\t \n#define ESP_SOFF\tESP_FFLAGS\t \n#define ESP_CFG1\t0x08UL\t\t \n#define ESP_CFACT\t0x09UL\t\t \n#define ESP_STATUS2\tESP_CFACT\t \n#define ESP_CTEST\t0x0aUL\t\t \n#define ESP_CFG2\t0x0bUL\t\t \n#define ESP_CFG3\t0x0cUL\t\t \n#define ESP_CFG4\t0x0dUL\t\t \n#define ESP_TCHI\t0x0eUL\t\t \n#define ESP_UID\t\tESP_TCHI\t \n#define FAS_RLO\t\tESP_TCHI\t \n#define ESP_FGRND\t0x0fUL\t\t \n#define FAS_RHI\t\tESP_FGRND\t \n\n#define SBUS_ESP_REG_SIZE\t0x40UL\n\n \n\n \n#define ESP_CONFIG1_ID        0x07       \n#define ESP_CONFIG1_CHTEST    0x08       \n#define ESP_CONFIG1_PENABLE   0x10       \n#define ESP_CONFIG1_PARTEST   0x20       \n#define ESP_CONFIG1_SRRDISAB  0x40       \n#define ESP_CONFIG1_SLCABLE   0x80       \n\n \n#define ESP_CONFIG2_DMAPARITY 0x01       \n#define ESP_CONFIG2_REGPARITY 0x02       \n#define ESP_CONFIG2_BADPARITY 0x04       \n#define ESP_CONFIG2_SCSI2ENAB 0x08       \n#define ESP_CONFIG2_HI        0x10       \n#define ESP_CONFIG2_HMEFENAB  0x10       \n#define ESP_CONFIG2_BCM       0x20       \n#define ESP_CONFIG2_DISPINT   0x20       \n#define ESP_CONFIG2_FENAB     0x40       \n#define ESP_CONFIG2_SPL       0x40       \n#define ESP_CONFIG2_MKDONE    0x40       \n#define ESP_CONFIG2_HME32     0x80       \n#define ESP_CONFIG2_MAGIC     0xe0       \n\n \n#define ESP_CONFIG3_FCLOCK    0x01      \n#define ESP_CONFIG3_TEM       0x01      \n#define ESP_CONFIG3_FAST      0x02      \n#define ESP_CONFIG3_ADMA      0x02      \n#define ESP_CONFIG3_TENB      0x04      \n#define ESP_CONFIG3_SRB       0x04      \n#define ESP_CONFIG3_TMS       0x08      \n#define ESP_CONFIG3_FCLK      0x08      \n#define ESP_CONFIG3_IDMSG     0x10      \n#define ESP_CONFIG3_FSCSI     0x10      \n#define ESP_CONFIG3_GTM       0x20      \n#define ESP_CONFIG3_IDBIT3    0x20      \n#define ESP_CONFIG3_TBMS      0x40      \n#define ESP_CONFIG3_EWIDE     0x40      \n#define ESP_CONFIG3_IMS       0x80      \n#define ESP_CONFIG3_OBPUSH    0x80      \n\n \n#define ESP_CONFIG4_BBTE      0x01      \n#define ESP_CONGIG4_TEST      0x02      \n#define ESP_CONFIG4_RADE      0x04      \n#define ESP_CONFIG4_RAE       0x08      \n#define ESP_CONFIG4_PWD       0x20      \n#define ESP_CONFIG4_GE0       0x40      \n#define ESP_CONFIG4_GE1       0x80      \n\n#define ESP_CONFIG_GE_12NS    (0)\n#define ESP_CONFIG_GE_25NS    (ESP_CONFIG_GE1)\n#define ESP_CONFIG_GE_35NS    (ESP_CONFIG_GE0)\n#define ESP_CONFIG_GE_0NS     (ESP_CONFIG_GE0 | ESP_CONFIG_GE1)\n\n \n \n#define ESP_CMD_NULL          0x00      \n#define ESP_CMD_FLUSH         0x01      \n#define ESP_CMD_RC            0x02      \n#define ESP_CMD_RS            0x03      \n\n \n#define ESP_CMD_TI            0x10      \n#define ESP_CMD_ICCSEQ        0x11      \n#define ESP_CMD_MOK           0x12      \n#define ESP_CMD_TPAD          0x18      \n#define ESP_CMD_SATN          0x1a      \n#define ESP_CMD_RATN          0x1b      \n\n \n#define ESP_CMD_SMSG          0x20      \n#define ESP_CMD_SSTAT         0x21      \n#define ESP_CMD_SDATA         0x22      \n#define ESP_CMD_DSEQ          0x23      \n#define ESP_CMD_TSEQ          0x24      \n#define ESP_CMD_TCCSEQ        0x25      \n#define ESP_CMD_DCNCT         0x27      \n#define ESP_CMD_RMSG          0x28      \n#define ESP_CMD_RCMD          0x29      \n#define ESP_CMD_RDATA         0x2a      \n#define ESP_CMD_RCSEQ         0x2b      \n\n \n#define ESP_CMD_RSEL          0x40      \n#define ESP_CMD_SEL           0x41      \n#define ESP_CMD_SELA          0x42      \n#define ESP_CMD_SELAS         0x43      \n#define ESP_CMD_ESEL          0x44      \n#define ESP_CMD_DSEL          0x45      \n#define ESP_CMD_SA3           0x46      \n#define ESP_CMD_RSEL3         0x47      \n\n \n#define ESP_CMD_DMA           0x80      \n\n \n#define ESP_STAT_PIO          0x01      \n#define ESP_STAT_PCD          0x02      \n#define ESP_STAT_PMSG         0x04      \n#define ESP_STAT_PMASK        0x07      \n#define ESP_STAT_TDONE        0x08      \n#define ESP_STAT_TCNT         0x10      \n#define ESP_STAT_PERR         0x20      \n#define ESP_STAT_SPAM         0x40      \n \n#define ESP_STAT_INTR         0x80              \n\n \n#define ESP_DOP   (0)                                        \n#define ESP_DIP   (ESP_STAT_PIO)                             \n#define ESP_CMDP  (ESP_STAT_PCD)                             \n#define ESP_STATP (ESP_STAT_PCD|ESP_STAT_PIO)                \n#define ESP_MOP   (ESP_STAT_PMSG|ESP_STAT_PCD)               \n#define ESP_MIP   (ESP_STAT_PMSG|ESP_STAT_PCD|ESP_STAT_PIO)  \n\n \n#define ESP_STAT2_SCHBIT      0x01  \n#define ESP_STAT2_FFLAGS      0x02  \n#define ESP_STAT2_XCNT        0x04  \n#define ESP_STAT2_CREGA       0x08  \n#define ESP_STAT2_WIDE        0x10  \n#define ESP_STAT2_F1BYTE      0x20  \n#define ESP_STAT2_FMSB        0x40  \n#define ESP_STAT2_FEMPTY      0x80  \n\n \n#define ESP_INTR_S            0x01      \n#define ESP_INTR_SATN         0x02      \n#define ESP_INTR_RSEL         0x04      \n#define ESP_INTR_FDONE        0x08      \n#define ESP_INTR_BSERV        0x10      \n#define ESP_INTR_DC           0x20      \n#define ESP_INTR_IC           0x40      \n#define ESP_INTR_SR           0x80      \n\n \n#define ESP_STEP_VBITS        0x07      \n#define ESP_STEP_ASEL         0x00      \n#define ESP_STEP_SID          0x01      \n#define ESP_STEP_NCMD         0x02      \n#define ESP_STEP_PPC          0x03      \n#define ESP_STEP_FINI4        0x04      \n\n \n#define ESP_STEP_FINI5        0x05\n#define ESP_STEP_FINI6        0x06\n#define ESP_STEP_FINI7        0x07\n\n \n#define ESP_TEST_TARG         0x01      \n#define ESP_TEST_INI          0x02      \n#define ESP_TEST_TS           0x04      \n\n \n#define ESP_UID_FAM           0xf8      \n\n#define ESP_FAMILY(uid) (((uid) & ESP_UID_FAM) >> 3)\n\n \n#define ESP_UID_F100A         0x00      \n#define ESP_UID_F236          0x02      \n#define ESP_UID_HME           0x0a      \n#define ESP_UID_FSC           0x14      \n\n \n \n#define ESP_FF_FBYTES         0x1f      \n#define ESP_FF_ONOTZERO       0x20      \n#define ESP_FF_SSTEP          0xe0      \n\n \n#define ESP_CCF_F0            0x00      \n#define ESP_CCF_NEVER         0x01      \n#define ESP_CCF_F2            0x02      \n#define ESP_CCF_F3            0x03      \n#define ESP_CCF_F4            0x04      \n#define ESP_CCF_F5            0x05      \n#define ESP_CCF_F6            0x06      \n#define ESP_CCF_F7            0x07      \n\n \n#define ESP_BUSID_RESELID     0x10\n#define ESP_BUSID_CTR32BIT    0x40\n\n#define ESP_BUS_TIMEOUT        250      \n#define ESP_TIMEO_CONST       8192\n#define ESP_NEG_DEFP(mhz, cfact) \\\n        ((ESP_BUS_TIMEOUT * ((mhz) / 1000)) / (8192 * (cfact)))\n#define ESP_HZ_TO_CYCLE(hertz)  ((1000000000) / ((hertz) / 1000))\n#define ESP_TICK(ccf, cycle)  ((7682 * (ccf) * (cycle) / 1000))\n\n \n#define SYNC_DEFP_SLOW            0x32    \n#define SYNC_DEFP_FAST            0x19    \n\nstruct esp_cmd_priv {\n\tint\t\t\tnum_sg;\n\tint\t\t\tcur_residue;\n\tstruct scatterlist\t*prv_sg;\n\tstruct scatterlist\t*cur_sg;\n\tint\t\t\ttot_residue;\n};\n\n#define ESP_CMD_PRIV(cmd)\t((struct esp_cmd_priv *)scsi_cmd_priv(cmd))\n\n \nenum esp_rev {\n\tESP100,   \n\tESP100A,  \n\tESP236,\n\tFAS236,\n\tPCSCSI,   \n\tFSC,      \n\tFAS100A,\n\tFAST,\n\tFASHME,\n};\n\nstruct esp_cmd_entry {\n\tstruct list_head\tlist;\n\n\tstruct scsi_cmnd\t*cmd;\n\n\tunsigned int\t\tsaved_cur_residue;\n\tstruct scatterlist\t*saved_prv_sg;\n\tstruct scatterlist\t*saved_cur_sg;\n\tunsigned int\t\tsaved_tot_residue;\n\n\tu8\t\t\tflags;\n#define ESP_CMD_FLAG_WRITE\t0x01  \n#define ESP_CMD_FLAG_AUTOSENSE\t0x04  \n#define ESP_CMD_FLAG_RESIDUAL\t0x08  \n\n\tu8\t\t\ttag[2];\n\tu8\t\t\torig_tag[2];\n\n\tu8\t\t\tstatus;\n\tu8\t\t\tmessage;\n\n\tunsigned char\t\t*sense_ptr;\n\tunsigned char\t\t*saved_sense_ptr;\n\tdma_addr_t\t\tsense_dma;\n\n\tstruct completion\t*eh_done;\n};\n\n#define ESP_DEFAULT_TAGS\t16\n\n#define ESP_MAX_TARGET\t\t16\n#define ESP_MAX_LUN\t\t8\n#define ESP_MAX_TAG\t\t256\n\nstruct esp_lun_data {\n\tstruct esp_cmd_entry\t*non_tagged_cmd;\n\tint\t\t\tnum_tagged;\n\tint\t\t\thold;\n\tstruct esp_cmd_entry\t*tagged_cmds[ESP_MAX_TAG];\n};\n\nstruct esp_target_data {\n\t \n\tu8\t\t\tesp_period;\n\tu8\t\t\tesp_offset;\n\tu8\t\t\tesp_config3;\n\n\tu8\t\t\tflags;\n#define ESP_TGT_WIDE\t\t0x01\n#define ESP_TGT_DISCONNECT\t0x02\n#define ESP_TGT_NEGO_WIDE\t0x04\n#define ESP_TGT_NEGO_SYNC\t0x08\n#define ESP_TGT_CHECK_NEGO\t0x40\n#define ESP_TGT_BROKEN\t\t0x80\n\n\t \n\tu8\t\t\tnego_goal_period;\n\tu8\t\t\tnego_goal_offset;\n\tu8\t\t\tnego_goal_width;\n\tu8\t\t\tnego_goal_tags;\n\n\tstruct scsi_target\t*starget;\n};\n\nstruct esp_event_ent {\n\tu8\t\t\ttype;\n#define ESP_EVENT_TYPE_EVENT\t0x01\n#define ESP_EVENT_TYPE_CMD\t0x02\n\tu8\t\t\tval;\n\n\tu8\t\t\tsreg;\n\tu8\t\t\tseqreg;\n\tu8\t\t\tsreg2;\n\tu8\t\t\tireg;\n\tu8\t\t\tselect_state;\n\tu8\t\t\tevent;\n\tu8\t\t\t__pad;\n};\n\nstruct esp;\nstruct esp_driver_ops {\n\t \n\tvoid (*esp_write8)(struct esp *esp, u8 val, unsigned long reg);\n\tu8 (*esp_read8)(struct esp *esp, unsigned long reg);\n\n\t \n\tint (*irq_pending)(struct esp *esp);\n\n\t \n\tu32 (*dma_length_limit)(struct esp *esp, u32 dma_addr,\n\t\t\t\tu32 dma_len);\n\n\t \n\tvoid (*reset_dma)(struct esp *esp);\n\n\t \n\tvoid (*dma_drain)(struct esp *esp);\n\n\t \n\tvoid (*dma_invalidate)(struct esp *esp);\n\n\t \n\tvoid (*send_dma_cmd)(struct esp *esp, u32 dma_addr, u32 esp_count,\n\t\t\t     u32 dma_count, int write, u8 cmd);\n\n\t \n\tint (*dma_error)(struct esp *esp);\n};\n\n#define ESP_MAX_MSG_SZ\t\t8\n#define ESP_EVENT_LOG_SZ\t32\n\n#define ESP_QUICKIRQ_LIMIT\t100\n#define ESP_RESELECT_TAG_LIMIT\t2500\n\nstruct esp {\n\tvoid __iomem\t\t*regs;\n\tvoid __iomem\t\t*dma_regs;\n\n\tconst struct esp_driver_ops *ops;\n\n\tstruct Scsi_Host\t*host;\n\tstruct device\t\t*dev;\n\n\tstruct esp_cmd_entry\t*active_cmd;\n\n\tstruct list_head\tqueued_cmds;\n\tstruct list_head\tactive_cmds;\n\n\tu8\t\t\t*command_block;\n\tdma_addr_t\t\tcommand_block_dma;\n\n\tunsigned int\t\tdata_dma_len;\n\n\t \n\tu8\t\t\tsreg;\n\tu8\t\t\tseqreg;\n\tu8\t\t\tsreg2;\n\tu8\t\t\tireg;\n\n\tu32\t\t\tprev_hme_dmacsr;\n\tu8\t\t\tprev_soff;\n\tu8\t\t\tprev_stp;\n\tu8\t\t\tprev_cfg3;\n\tu8\t\t\tnum_tags;\n\n\tstruct list_head\tesp_cmd_pool;\n\n\tstruct esp_target_data\ttarget[ESP_MAX_TARGET];\n\n\tint\t\t\tfifo_cnt;\n\tu8\t\t\tfifo[16];\n\n\tstruct esp_event_ent\tesp_event_log[ESP_EVENT_LOG_SZ];\n\tint\t\t\tesp_event_cur;\n\n\tu8\t\t\tmsg_out[ESP_MAX_MSG_SZ];\n\tint\t\t\tmsg_out_len;\n\n\tu8\t\t\tmsg_in[ESP_MAX_MSG_SZ];\n\tint\t\t\tmsg_in_len;\n\n\tu8\t\t\tbursts;\n\tu8\t\t\tconfig1;\n\tu8\t\t\tconfig2;\n\tu8\t\t\tconfig4;\n\n\tu8\t\t\tscsi_id;\n\tu32\t\t\tscsi_id_mask;\n\n\tenum esp_rev\t\trev;\n\n\tu32\t\t\tflags;\n#define ESP_FLAG_DIFFERENTIAL\t0x00000001\n#define ESP_FLAG_RESETTING\t0x00000002\n#define ESP_FLAG_WIDE_CAPABLE\t0x00000008\n#define ESP_FLAG_QUICKIRQ_CHECK\t0x00000010\n#define ESP_FLAG_DISABLE_SYNC\t0x00000020\n#define ESP_FLAG_USE_FIFO\t0x00000040\n#define ESP_FLAG_NO_DMA_MAP\t0x00000080\n\n\tu8\t\t\tselect_state;\n#define ESP_SELECT_NONE\t\t0x00  \n#define ESP_SELECT_BASIC\t0x01  \n#define ESP_SELECT_MSGOUT\t0x02  \n\n\t \n\tu8\t\t\tevent;\n#define ESP_EVENT_NONE\t\t0x00\n#define ESP_EVENT_CMD_START\t0x01\n#define ESP_EVENT_CMD_DONE\t0x02\n#define ESP_EVENT_DATA_IN\t0x03\n#define ESP_EVENT_DATA_OUT\t0x04\n#define ESP_EVENT_DATA_DONE\t0x05\n#define ESP_EVENT_MSGIN\t\t0x06\n#define ESP_EVENT_MSGIN_MORE\t0x07\n#define ESP_EVENT_MSGIN_DONE\t0x08\n#define ESP_EVENT_MSGOUT\t0x09\n#define ESP_EVENT_MSGOUT_DONE\t0x0a\n#define ESP_EVENT_STATUS\t0x0b\n#define ESP_EVENT_FREE_BUS\t0x0c\n#define ESP_EVENT_CHECK_PHASE\t0x0d\n#define ESP_EVENT_RESET\t\t0x10\n\n\t \n\tu32\t\t\tcfact;\n\tu32\t\t\tcfreq;\n\tu32\t\t\tccycle;\n\tu32\t\t\tctick;\n\tu32\t\t\tneg_defp;\n\tu32\t\t\tsync_defp;\n\n\t \n\tu32\t\t\tmax_period;\n\tu32\t\t\tmin_period;\n\tu32\t\t\tradelay;\n\n\t \n\tu8\t\t\t*cmd_bytes_ptr;\n\tint\t\t\tcmd_bytes_left;\n\n\tstruct completion\t*eh_reset;\n\n\tvoid\t\t\t*dma;\n\tint\t\t\tdmarev;\n\n\t \n\tu8 __iomem\t\t*fifo_reg;\n\tint\t\t\tsend_cmd_error;\n\tu32\t\t\tsend_cmd_residual;\n};\n\n \nextern const struct scsi_host_template scsi_esp_template;\nextern int scsi_esp_register(struct esp *);\n\nextern void scsi_esp_unregister(struct esp *);\nextern irqreturn_t scsi_esp_intr(int, void *);\nextern void scsi_esp_cmd(struct esp *, u8);\n\nextern void esp_send_pio_cmd(struct esp *esp, u32 dma_addr, u32 esp_count,\n\t\t\t     u32 dma_count, int write, u8 cmd);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}