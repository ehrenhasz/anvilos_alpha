{
  "module_name": "lasi700.c",
  "hash_id": "8b61af4d24d44ae78a989749fb99cca7e905d13e4c5c2e3a6c66245c1b993311",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/lasi700.c",
  "human_readable_source": "\n\n \n\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/types.h>\n#include <linux/stat.h>\n#include <linux/mm.h>\n#include <linux/blkdev.h>\n#include <linux/ioport.h>\n#include <linux/dma-mapping.h>\n#include <linux/slab.h>\n\n#include <asm/page.h>\n#include <asm/irq.h>\n#include <asm/hardware.h>\n#include <asm/parisc-device.h>\n#include <asm/delay.h>\n\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_transport.h>\n#include <scsi/scsi_transport_spi.h>\n\n#include \"53c700.h\"\n\nMODULE_AUTHOR(\"James Bottomley\");\nMODULE_DESCRIPTION(\"lasi700 SCSI Driver\");\nMODULE_LICENSE(\"GPL\");\n\n#define LASI_700_SVERSION 0x00071\n#define LASI_710_SVERSION 0x00082\n\n#define LASI700_ID_TABLE {\t\t\t\\\n\t.hw_type\t= HPHW_FIO,\t\t\\\n\t.sversion\t= LASI_700_SVERSION,\t\\\n\t.hversion\t= HVERSION_ANY_ID,\t\\\n\t.hversion_rev\t= HVERSION_REV_ANY_ID,\t\\\n}\n\n#define LASI710_ID_TABLE {\t\t\t\\\n\t.hw_type\t= HPHW_FIO,\t\t\\\n\t.sversion\t= LASI_710_SVERSION,\t\\\n\t.hversion\t= HVERSION_ANY_ID,\t\\\n\t.hversion_rev\t= HVERSION_REV_ANY_ID,\t\\\n}\n\n#define LASI700_CLOCK\t25\n#define LASI710_CLOCK\t40\n#define LASI_SCSI_CORE_OFFSET 0x100\n\nstatic const struct parisc_device_id lasi700_ids[] __initconst = {\n\tLASI700_ID_TABLE,\n\tLASI710_ID_TABLE,\n\t{ 0 }\n};\n\nstatic struct scsi_host_template lasi700_template = {\n\t.name\t\t= \"LASI SCSI 53c700\",\n\t.proc_name\t= \"lasi700\",\n\t.this_id\t= 7,\n\t.module\t\t= THIS_MODULE,\n};\nMODULE_DEVICE_TABLE(parisc, lasi700_ids);\n\nstatic int __init\nlasi700_probe(struct parisc_device *dev)\n{\n\tunsigned long base = dev->hpa.start + LASI_SCSI_CORE_OFFSET;\n\tstruct NCR_700_Host_Parameters *hostdata;\n\tstruct Scsi_Host *host;\n\n\thostdata = kzalloc(sizeof(*hostdata), GFP_KERNEL);\n\tif (!hostdata) {\n\t\tdev_printk(KERN_ERR, &dev->dev, \"Failed to allocate host data\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\thostdata->dev = &dev->dev;\n\tdma_set_mask(&dev->dev, DMA_BIT_MASK(32));\n\thostdata->base = ioremap(base, 0x100);\n\thostdata->differential = 0;\n\n\tif (dev->id.sversion == LASI_700_SVERSION) {\n\t\thostdata->clock = LASI700_CLOCK;\n\t\thostdata->force_le_on_be = 1;\n\t} else {\n\t\thostdata->clock = LASI710_CLOCK;\n\t\thostdata->force_le_on_be = 0;\n\t\thostdata->chip710 = 1;\n\t\thostdata->dmode_extra = DMODE_FC2;\n\t\thostdata->burst_length = 8;\n\t}\n\n\thost = NCR_700_detect(&lasi700_template, hostdata, &dev->dev);\n\tif (!host)\n\t\tgoto out_kfree;\n\thost->this_id = 7;\n\thost->base = base;\n\thost->irq = dev->irq;\n\tif(request_irq(dev->irq, NCR_700_intr, IRQF_SHARED, \"lasi700\", host)) {\n\t\tprintk(KERN_ERR \"lasi700: request_irq failed!\\n\");\n\t\tgoto out_put_host;\n\t}\n\n\tdev_set_drvdata(&dev->dev, host);\n\tscsi_scan_host(host);\n\n\treturn 0;\n\n out_put_host:\n\tscsi_host_put(host);\n out_kfree:\n\tiounmap(hostdata->base);\n\tkfree(hostdata);\n\treturn -ENODEV;\n}\n\nstatic void __exit\nlasi700_driver_remove(struct parisc_device *dev)\n{\n\tstruct Scsi_Host *host = dev_get_drvdata(&dev->dev);\n\tstruct NCR_700_Host_Parameters *hostdata = \n\t\t(struct NCR_700_Host_Parameters *)host->hostdata[0];\n\n\tscsi_remove_host(host);\n\tNCR_700_release(host);\n\tfree_irq(host->irq, host);\n\tiounmap(hostdata->base);\n\tkfree(hostdata);\n}\n\nstatic struct parisc_driver lasi700_driver __refdata = {\n\t.name =\t\t\"lasi_scsi\",\n\t.id_table =\tlasi700_ids,\n\t.probe =\tlasi700_probe,\n\t.remove =\t__exit_p(lasi700_driver_remove),\n};\n\nstatic int __init\nlasi700_init(void)\n{\n\treturn register_parisc_driver(&lasi700_driver);\n}\n\nstatic void __exit\nlasi700_exit(void)\n{\n\tunregister_parisc_driver(&lasi700_driver);\n}\n\nmodule_init(lasi700_init);\nmodule_exit(lasi700_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}