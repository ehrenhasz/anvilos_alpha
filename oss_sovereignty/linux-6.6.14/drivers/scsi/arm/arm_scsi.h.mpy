{
  "module_name": "arm_scsi.h",
  "hash_id": "50f2816c2ef3fc8f3d20444cb6be6af57b3ecc34d095b20fd10d3759d1be4b35",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/arm/arm_scsi.h",
  "human_readable_source": " \n \n\n#include <linux/scatterlist.h>\n\n#define BELT_AND_BRACES\n\nstruct arm_cmd_priv {\n\tstruct scsi_pointer scsi_pointer;\n};\n\nstatic inline struct scsi_pointer *arm_scsi_pointer(struct scsi_cmnd *cmd)\n{\n\tstruct arm_cmd_priv *acmd = scsi_cmd_priv(cmd);\n\n\treturn &acmd->scsi_pointer;\n}\n\n \n\n \nstatic inline int copy_SCp_to_sg(struct scatterlist *sg, struct scsi_pointer *SCp, int max)\n{\n\tint bufs = SCp->buffers_residual;\n\n\t \n\tBUG_ON(bufs + 1 > max);\n\n\tsg_set_buf(sg, SCp->ptr, SCp->this_residual);\n\n\tif (bufs) {\n\t\tstruct scatterlist *src_sg;\n\t\tunsigned i;\n\n\t\tfor_each_sg(sg_next(SCp->buffer), src_sg, bufs, i)\n\t\t\t*(++sg) = *src_sg;\n\t\tsg_mark_end(sg);\n\t}\n\n\treturn bufs + 1;\n}\n\nstatic inline int next_SCp(struct scsi_pointer *SCp)\n{\n\tint ret = SCp->buffers_residual;\n\tif (ret) {\n\t\tSCp->buffer = sg_next(SCp->buffer);\n\t\tSCp->buffers_residual--;\n\t\tSCp->ptr = sg_virt(SCp->buffer);\n\t\tSCp->this_residual = SCp->buffer->length;\n\t} else {\n\t\tSCp->ptr = NULL;\n\t\tSCp->this_residual = 0;\n\t}\n\treturn ret;\n}\n\nstatic inline unsigned char get_next_SCp_byte(struct scsi_pointer *SCp)\n{\n\tchar c = *SCp->ptr;\n\n\tSCp->ptr += 1;\n\tSCp->this_residual -= 1;\n\n\treturn c;\n}\n\nstatic inline void put_next_SCp_byte(struct scsi_pointer *SCp, unsigned char c)\n{\n\t*SCp->ptr = c;\n\tSCp->ptr += 1;\n\tSCp->this_residual -= 1;\n}\n\nstatic inline void init_SCp(struct scsi_cmnd *SCpnt)\n{\n\tstruct scsi_pointer *scsi_pointer = arm_scsi_pointer(SCpnt);\n\n\tmemset(scsi_pointer, 0, sizeof(struct scsi_pointer));\n\n\tif (scsi_bufflen(SCpnt)) {\n\t\tunsigned long len = 0;\n\n\t\tscsi_pointer->buffer = scsi_sglist(SCpnt);\n\t\tscsi_pointer->buffers_residual = scsi_sg_count(SCpnt) - 1;\n\t\tscsi_pointer->ptr = sg_virt(scsi_pointer->buffer);\n\t\tscsi_pointer->this_residual = scsi_pointer->buffer->length;\n\t\tscsi_pointer->phase = scsi_bufflen(SCpnt);\n\n#ifdef BELT_AND_BRACES\n\t\t{\t \n\t\t\tstruct scatterlist *sg;\n\t\t\tunsigned i, sg_count = scsi_sg_count(SCpnt);\n\n\t\t\tscsi_for_each_sg(SCpnt, sg, sg_count, i)\n\t\t\t\tlen += sg->length;\n\n\t\t\tif (scsi_bufflen(SCpnt) != len) {\n\t\t\t\tprintk(KERN_WARNING\n\t\t\t\t       \"scsi%d.%c: bad request buffer \"\n\t\t\t\t       \"length %d, should be %ld\\n\",\n\t\t\t\t\tSCpnt->device->host->host_no,\n\t\t\t\t\t'0' + SCpnt->device->id,\n\t\t\t\t\tscsi_bufflen(SCpnt), len);\n\t\t\t\t \n\t\t\t\tscsi_pointer->phase =\n\t\t\t\t\tmin_t(unsigned long, len,\n\t\t\t\t\t      scsi_bufflen(SCpnt));\n\t\t\t}\n\t\t}\n#endif\n\t} else {\n\t\tscsi_pointer->ptr = NULL;\n\t\tscsi_pointer->this_residual = 0;\n\t\tscsi_pointer->phase = 0;\n\t}\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}