{
  "module_name": "mpi3mr.h",
  "hash_id": "db4f4401ee1219094e93634f4ff5918a6a3f8f4570a4d3ec61c378b5287ea9ec",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/mpi3mr/mpi3mr.h",
  "human_readable_source": " \n \n\n#ifndef MPI3MR_H_INCLUDED\n#define MPI3MR_H_INCLUDED\n\n#include <linux/blkdev.h>\n#include <linux/blk-mq.h>\n#include <linux/blk-mq-pci.h>\n#include <linux/delay.h>\n#include <linux/dmapool.h>\n#include <linux/errno.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/miscdevice.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/poll.h>\n#include <linux/sched.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n#include <linux/uaccess.h>\n#include <linux/utsname.h>\n#include <linux/workqueue.h>\n#include <asm/unaligned.h>\n#include <scsi/scsi.h>\n#include <scsi/scsi_cmnd.h>\n#include <scsi/scsi_dbg.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_tcq.h>\n#include <uapi/scsi/scsi_bsg_mpi3mr.h>\n#include <scsi/scsi_transport_sas.h>\n\n#include \"mpi/mpi30_transport.h\"\n#include \"mpi/mpi30_cnfg.h\"\n#include \"mpi/mpi30_image.h\"\n#include \"mpi/mpi30_init.h\"\n#include \"mpi/mpi30_ioc.h\"\n#include \"mpi/mpi30_sas.h\"\n#include \"mpi/mpi30_pci.h\"\n#include \"mpi3mr_debug.h\"\n\n \nextern spinlock_t mrioc_list_lock;\nextern struct list_head mrioc_list;\nextern int prot_mask;\nextern atomic64_t event_counter;\n\n#define MPI3MR_DRIVER_VERSION\t\"8.5.0.0.0\"\n#define MPI3MR_DRIVER_RELDATE\t\"24-July-2023\"\n\n#define MPI3MR_DRIVER_NAME\t\"mpi3mr\"\n#define MPI3MR_DRIVER_LICENSE\t\"GPL\"\n#define MPI3MR_DRIVER_AUTHOR\t\"Broadcom Inc. <mpi3mr-linuxdrv.pdl@broadcom.com>\"\n#define MPI3MR_DRIVER_DESC\t\"MPI3 Storage Controller Device Driver\"\n\n#define MPI3MR_NAME_LENGTH\t32\n#define IOCNAME\t\t\t\"%s: \"\n\n#define MPI3MR_DEFAULT_MAX_IO_SIZE\t(1 * 1024 * 1024)\n\n \n#define MPI3MR_PAGE_SIZE_4K\t\t4096\n#define MPI3MR_DEFAULT_SGL_ENTRIES\t256\n#define MPI3MR_MAX_SGL_ENTRIES\t\t2048\n\n \n#define MPI3MR_MAX_CMDS_LUN\t128\n#define MPI3MR_MAX_CDB_LENGTH\t32\n\n \n#define MPI3MR_ADMIN_REQ_Q_SIZE\t\t(2 * MPI3MR_PAGE_SIZE_4K)\n#define MPI3MR_ADMIN_REPLY_Q_SIZE\t(4 * MPI3MR_PAGE_SIZE_4K)\n#define MPI3MR_ADMIN_REQ_FRAME_SZ\t128\n#define MPI3MR_ADMIN_REPLY_FRAME_SZ\t16\n\n \n#define MPI3MR_OP_REQ_Q_QD\t\t512\n#define MPI3MR_OP_REP_Q_QD\t\t1024\n#define MPI3MR_OP_REP_Q_QD4K\t\t4096\n#define MPI3MR_OP_REQ_Q_SEG_SIZE\t4096\n#define MPI3MR_OP_REP_Q_SEG_SIZE\t4096\n#define MPI3MR_MAX_SEG_LIST_SIZE\t4096\n\n \n#define MPI3MR_HOSTTAG_INVALID\t\t0xFFFF\n#define MPI3MR_HOSTTAG_INITCMDS\t\t1\n#define MPI3MR_HOSTTAG_BSG_CMDS\t\t2\n#define MPI3MR_HOSTTAG_PEL_ABORT\t3\n#define MPI3MR_HOSTTAG_PEL_WAIT\t\t4\n#define MPI3MR_HOSTTAG_BLK_TMS\t\t5\n#define MPI3MR_HOSTTAG_CFG_CMDS\t\t6\n#define MPI3MR_HOSTTAG_TRANSPORT_CMDS\t7\n\n#define MPI3MR_NUM_DEVRMCMD\t\t16\n#define MPI3MR_HOSTTAG_DEVRMCMD_MIN\t(MPI3MR_HOSTTAG_TRANSPORT_CMDS + 1)\n#define MPI3MR_HOSTTAG_DEVRMCMD_MAX\t(MPI3MR_HOSTTAG_DEVRMCMD_MIN + \\\n\t\t\t\t\t\tMPI3MR_NUM_DEVRMCMD - 1)\n\n#define MPI3MR_INTERNAL_CMDS_RESVD\tMPI3MR_HOSTTAG_DEVRMCMD_MAX\n#define MPI3MR_NUM_EVTACKCMD\t\t4\n#define MPI3MR_HOSTTAG_EVTACKCMD_MIN\t(MPI3MR_HOSTTAG_DEVRMCMD_MAX + 1)\n#define MPI3MR_HOSTTAG_EVTACKCMD_MAX\t(MPI3MR_HOSTTAG_EVTACKCMD_MIN + \\\n\t\t\t\t\tMPI3MR_NUM_EVTACKCMD - 1)\n\n \n#define MPI3MR_HOST_IOS_KDUMP\t\t128\n\n \n#define MPI3MR_INTADMCMD_TIMEOUT\t\t60\n#define MPI3MR_PORTENABLE_TIMEOUT\t\t300\n#define MPI3MR_PORTENABLE_POLL_INTERVAL\t\t5\n#define MPI3MR_ABORTTM_TIMEOUT\t\t\t60\n#define MPI3MR_RESETTM_TIMEOUT\t\t\t60\n#define MPI3MR_RESET_HOST_IOWAIT_TIMEOUT\t5\n#define MPI3MR_TSUPDATE_INTERVAL\t\t900\n#define MPI3MR_DEFAULT_SHUTDOWN_TIME\t\t120\n#define\tMPI3MR_RAID_ERRREC_RESET_TIMEOUT\t180\n#define MPI3MR_PREPARE_FOR_RESET_TIMEOUT\t180\n#define MPI3MR_RESET_ACK_TIMEOUT\t\t30\n#define MPI3MR_MUR_TIMEOUT\t\t\t120\n\n#define MPI3MR_WATCHDOG_INTERVAL\t\t1000  \n\n#define MPI3MR_DEFAULT_CFG_PAGE_SZ\t\t1024  \n\n#define MPI3MR_RESET_TOPOLOGY_SETTLE_TIME\t10\n\n#define MPI3MR_SCMD_TIMEOUT    (60 * HZ)\n#define MPI3MR_EH_SCMD_TIMEOUT (60 * HZ)\n\n \n#define MPI3MR_CMD_NOTUSED\t0x8000\n#define MPI3MR_CMD_COMPLETE\t0x0001\n#define MPI3MR_CMD_PENDING\t0x0002\n#define MPI3MR_CMD_REPLY_VALID\t0x0004\n#define MPI3MR_CMD_RESET\t0x0008\n\n \n#define MPI3MR_NUM_EVT_REPLIES\t64\n#define MPI3MR_SENSE_BUF_SZ\t256\n#define MPI3MR_SENSEBUF_FACTOR\t3\n#define MPI3MR_CHAINBUF_FACTOR\t3\n#define MPI3MR_CHAINBUFDIX_FACTOR\t2\n\n \n#define MPI3MR_INVALID_DEV_HANDLE\t0xFFFF\n\n \n#define MPI3MR_HOSTDIAG_UNLOCK_RETRY_COUNT\t5\n#define MPI3MR_MAX_RESET_RETRY_COUNT\t\t3\n\n \n#define MPI3MR_RI_MASK_RESPCODE\t\t(0x000000FF)\n#define MPI3MR_RSP_IO_QUEUED_ON_IOC \\\n\t\t\tMPI3_SCSITASKMGMT_RSPCODE_IO_QUEUED_ON_IOC\n\n#define MPI3MR_DEFAULT_MDTS\t(128 * 1024)\n#define MPI3MR_DEFAULT_PGSZEXP         (12)\n\n \n#define MPI3MR_DEV_RMHS_RETRY_COUNT 3\n#define MPI3MR_PEL_RETRY_COUNT 3\n\n \n#define MPI3MR_DEFAULT_SDEV_QD\t32\n\n \n#define MPI3MR_IRQ_POLL_SLEEP\t\t\t2\n#define MPI3MR_IRQ_POLL_TRIGGER_IOCOUNT\t\t8\n\n \n#define MPI3MR_CTLR_SECURITY_STATUS_MASK\t0x0C\n#define MPI3MR_CTLR_SECURE_DBG_STATUS_MASK\t0x02\n\n#define MPI3MR_INVALID_DEVICE\t\t\t0x00\n#define MPI3MR_CONFIG_SECURE_DEVICE\t\t0x04\n#define MPI3MR_HARD_SECURE_DEVICE\t\t0x08\n#define MPI3MR_TAMPERED_DEVICE\t\t\t0x0C\n\n \n#define MPI3MR_SGEFLAGS_SYSTEM_SIMPLE_END_OF_LIST \\\n\t(MPI3_SGE_FLAGS_ELEMENT_TYPE_SIMPLE | MPI3_SGE_FLAGS_DLAS_SYSTEM | \\\n\tMPI3_SGE_FLAGS_END_OF_LIST)\n\n \n#define REPLY_QUEUE_IDX_TO_MSIX_IDX(qidx, offset)\t(qidx + offset)\n\n \n#define MPI3MR_MAX_APP_XFER_SIZE\t(1 * 1024 * 1024)\n#define MPI3MR_MAX_APP_XFER_SEGMENTS\t512\n \n#define MPI3MR_MAX_APP_XFER_SECTORS\t(2048 + 512)\n\n#define MPI3MR_WRITE_SAME_MAX_LEN_256_BLKS 256\n#define MPI3MR_WRITE_SAME_MAX_LEN_2048_BLKS 2048\n\n \nstruct mpi3mr_nvme_pt_sge {\n\tu64 base_addr;\n\tu32 length;\n\tu16 rsvd;\n\tu8 rsvd1;\n\tu8 sgl_type;\n};\n\n \nstruct mpi3mr_buf_map {\n\tvoid *bsg_buf;\n\tu32 bsg_buf_len;\n\tvoid *kern_buf;\n\tu32 kern_buf_len;\n\tdma_addr_t kern_buf_dma;\n\tu8 data_dir;\n};\n\n \nenum mpi3mr_iocstate {\n\tMRIOC_STATE_READY = 1,\n\tMRIOC_STATE_RESET,\n\tMRIOC_STATE_FAULT,\n\tMRIOC_STATE_BECOMING_READY,\n\tMRIOC_STATE_RESET_REQUESTED,\n\tMRIOC_STATE_UNRECOVERABLE,\n};\n\n \nenum mpi3mr_reset_reason {\n\tMPI3MR_RESET_FROM_BRINGUP = 1,\n\tMPI3MR_RESET_FROM_FAULT_WATCH = 2,\n\tMPI3MR_RESET_FROM_APP = 3,\n\tMPI3MR_RESET_FROM_EH_HOS = 4,\n\tMPI3MR_RESET_FROM_TM_TIMEOUT = 5,\n\tMPI3MR_RESET_FROM_APP_TIMEOUT = 6,\n\tMPI3MR_RESET_FROM_MUR_FAILURE = 7,\n\tMPI3MR_RESET_FROM_CTLR_CLEANUP = 8,\n\tMPI3MR_RESET_FROM_CIACTIV_FAULT = 9,\n\tMPI3MR_RESET_FROM_PE_TIMEOUT = 10,\n\tMPI3MR_RESET_FROM_TSU_TIMEOUT = 11,\n\tMPI3MR_RESET_FROM_DELREQQ_TIMEOUT = 12,\n\tMPI3MR_RESET_FROM_DELREPQ_TIMEOUT = 13,\n\tMPI3MR_RESET_FROM_CREATEREPQ_TIMEOUT = 14,\n\tMPI3MR_RESET_FROM_CREATEREQQ_TIMEOUT = 15,\n\tMPI3MR_RESET_FROM_IOCFACTS_TIMEOUT = 16,\n\tMPI3MR_RESET_FROM_IOCINIT_TIMEOUT = 17,\n\tMPI3MR_RESET_FROM_EVTNOTIFY_TIMEOUT = 18,\n\tMPI3MR_RESET_FROM_EVTACK_TIMEOUT = 19,\n\tMPI3MR_RESET_FROM_CIACTVRST_TIMER = 20,\n\tMPI3MR_RESET_FROM_GETPKGVER_TIMEOUT = 21,\n\tMPI3MR_RESET_FROM_PELABORT_TIMEOUT = 22,\n\tMPI3MR_RESET_FROM_SYSFS = 23,\n\tMPI3MR_RESET_FROM_SYSFS_TIMEOUT = 24,\n\tMPI3MR_RESET_FROM_FIRMWARE = 27,\n\tMPI3MR_RESET_FROM_CFG_REQ_TIMEOUT = 29,\n\tMPI3MR_RESET_FROM_SAS_TRANSPORT_TIMEOUT = 30,\n};\n\n \nenum queue_type {\n\tMPI3MR_DEFAULT_QUEUE = 0,\n\tMPI3MR_POLL_QUEUE,\n};\n\n \nstruct mpi3mr_compimg_ver {\n\tu16 build_num;\n\tu16 cust_id;\n\tu8 ph_minor;\n\tu8 ph_major;\n\tu8 gen_minor;\n\tu8 gen_major;\n};\n\n \nstruct mpi3mr_ioc_facts {\n\tu32 ioc_capabilities;\n\tstruct mpi3mr_compimg_ver fw_ver;\n\tu32 mpi_version;\n\tu16 max_reqs;\n\tu16 product_id;\n\tu16 op_req_sz;\n\tu16 reply_sz;\n\tu16 exceptions;\n\tu16 max_perids;\n\tu16 max_pds;\n\tu16 max_sasexpanders;\n\tu32 max_data_length;\n\tu16 max_sasinitiators;\n\tu16 max_enclosures;\n\tu16 max_pcie_switches;\n\tu16 max_nvme;\n\tu16 max_vds;\n\tu16 max_hpds;\n\tu16 max_advhpds;\n\tu16 max_raid_pds;\n\tu16 min_devhandle;\n\tu16 max_devhandle;\n\tu16 max_op_req_q;\n\tu16 max_op_reply_q;\n\tu16 shutdown_timeout;\n\tu8 ioc_num;\n\tu8 who_init;\n\tu16 max_msix_vectors;\n\tu8 personality;\n\tu8 dma_mask;\n\tu8 protocol_flags;\n\tu8 sge_mod_mask;\n\tu8 sge_mod_value;\n\tu8 sge_mod_shift;\n\tu8 max_dev_per_tg;\n\tu16 max_io_throttle_group;\n\tu16 io_throttle_data_length;\n\tu16 io_throttle_low;\n\tu16 io_throttle_high;\n\n};\n\n \nstruct segments {\n\tvoid *segment;\n\tdma_addr_t segment_dma;\n};\n\n \nstruct op_req_qinfo {\n\tu16 ci;\n\tu16 pi;\n\tu16 num_requests;\n\tu16 qid;\n\tu16 reply_qid;\n\tu16 num_segments;\n\tu16 segment_qd;\n\tspinlock_t q_lock;\n\tstruct segments *q_segments;\n\tvoid *q_segment_list;\n\tdma_addr_t q_segment_list_dma;\n};\n\n \nstruct op_reply_qinfo {\n\tu16 ci;\n\tu16 qid;\n\tu16 num_replies;\n\tu16 num_segments;\n\tu16 segment_qd;\n\tstruct segments *q_segments;\n\tvoid *q_segment_list;\n\tdma_addr_t q_segment_list_dma;\n\tu8 ephase;\n\tatomic_t pend_ios;\n\tbool enable_irq_poll;\n\tatomic_t in_use;\n\tenum queue_type qtype;\n};\n\n \nstruct mpi3mr_intr_info {\n\tstruct mpi3mr_ioc *mrioc;\n\tint os_irq;\n\tu16 msix_index;\n\tstruct op_reply_qinfo *op_reply_q;\n\tchar name[MPI3MR_NAME_LENGTH];\n};\n\n \nstruct mpi3mr_throttle_group_info {\n\tu8 io_divert;\n\tu8 need_qd_reduction;\n\tu8 qd_reduction;\n\tu16 fw_qd;\n\tu16 modified_qd;\n\tu16 id;\n\tu32 high;\n\tu32 low;\n\tatomic_t pend_large_data_sz;\n};\n\n \n#define MPI3MR_HBA_PORT_FLAG_DIRTY\t0x01\n\n \nstruct mpi3mr_hba_port {\n\tstruct list_head list;\n\tu8 port_id;\n\tu8 flags;\n};\n\n \nstruct mpi3mr_sas_port {\n\tstruct list_head port_list;\n\tu8 num_phys;\n\tu8 marked_responding;\n\tint lowest_phy;\n\tu32 phy_mask;\n\tstruct mpi3mr_hba_port *hba_port;\n\tstruct sas_identify remote_identify;\n\tstruct sas_rphy *rphy;\n\tstruct sas_port *port;\n\tstruct list_head phy_list;\n};\n\n \nstruct mpi3mr_sas_phy {\n\tstruct list_head port_siblings;\n\tstruct sas_identify identify;\n\tstruct sas_identify remote_identify;\n\tstruct sas_phy *phy;\n\tu8 phy_id;\n\tu16 handle;\n\tu16 attached_handle;\n\tu8 phy_belongs_to_port;\n\tstruct mpi3mr_hba_port *hba_port;\n};\n\n \nstruct mpi3mr_sas_node {\n\tstruct list_head list;\n\tstruct device *parent_dev;\n\tu8 num_phys;\n\tu64 sas_address;\n\tu16 handle;\n\tu64 sas_address_parent;\n\tu16 enclosure_handle;\n\tu64 enclosure_logical_id;\n\tu8 non_responding;\n\tu8 host_node;\n\tstruct mpi3mr_hba_port *hba_port;\n\tstruct mpi3mr_sas_phy *phy;\n\tstruct list_head sas_port_list;\n\tstruct sas_rphy *rphy;\n};\n\n \nstruct mpi3mr_enclosure_node {\n\tstruct list_head list;\n\tstruct mpi3_enclosure_page0 pg0;\n};\n\n \nstruct tgt_dev_sas_sata {\n\tu64 sas_address;\n\tu64 sas_address_parent;\n\tu16 dev_info;\n\tu8 phy_id;\n\tu8 attached_phy_id;\n\tu8 sas_transport_attached;\n\tu8 pend_sas_rphy_add;\n\tstruct mpi3mr_hba_port *hba_port;\n\tstruct sas_rphy *rphy;\n};\n\n \nstruct tgt_dev_pcie {\n\tu32 mdts;\n\tu16 capb;\n\tu8 pgsz;\n\tu8 abort_to;\n\tu8 reset_to;\n\tu16 dev_info;\n};\n\n \nstruct tgt_dev_vd {\n\tu8 state;\n\tu8 tg_qd_reduction;\n\tu16 tg_id;\n\tu32 tg_high;\n\tu32 tg_low;\n\tstruct mpi3mr_throttle_group_info *tg;\n};\n\n\n \nunion _form_spec_inf {\n\tstruct tgt_dev_sas_sata sas_sata_inf;\n\tstruct tgt_dev_pcie pcie_inf;\n\tstruct tgt_dev_vd vd_inf;\n};\n\nenum mpi3mr_dev_state {\n\tMPI3MR_DEV_CREATED = 1,\n\tMPI3MR_DEV_REMOVE_HS_STARTED = 2,\n\tMPI3MR_DEV_DELETED = 3,\n};\n\n \nstruct mpi3mr_tgt_dev {\n\tstruct list_head list;\n\tstruct scsi_target *starget;\n\tu16 dev_handle;\n\tu16 parent_handle;\n\tu16 slot;\n\tu16 encl_handle;\n\tu16 perst_id;\n\tu16 devpg0_flag;\n\tu8 dev_type;\n\tu8 is_hidden;\n\tu8 host_exposed;\n\tu8 io_unit_port;\n\tu8 non_stl;\n\tu8 io_throttle_enabled;\n\tu16 wslen;\n\tu16 q_depth;\n\tu64 wwid;\n\tu64 enclosure_logical_id;\n\tunion _form_spec_inf dev_spec;\n\tstruct kref ref_count;\n\tenum mpi3mr_dev_state state;\n};\n\n \nstatic inline void mpi3mr_tgtdev_get(struct mpi3mr_tgt_dev *s)\n{\n\tkref_get(&s->ref_count);\n}\n\n \nstatic inline void mpi3mr_free_tgtdev(struct kref *r)\n{\n\tkfree(container_of(r, struct mpi3mr_tgt_dev, ref_count));\n}\n\n \nstatic inline void mpi3mr_tgtdev_put(struct mpi3mr_tgt_dev *s)\n{\n\tkref_put(&s->ref_count, mpi3mr_free_tgtdev);\n}\n\n\n \nstruct mpi3mr_stgt_priv_data {\n\tstruct scsi_target *starget;\n\tu16 dev_handle;\n\tu16 perst_id;\n\tu32 num_luns;\n\tatomic_t block_io;\n\tu8 dev_removed;\n\tu8 dev_removedelay;\n\tu8 dev_type;\n\tu8 dev_nvme_dif;\n\tu16 wslen;\n\tu8 io_throttle_enabled;\n\tu8 io_divert;\n\tstruct mpi3mr_throttle_group_info *throttle_group;\n\tstruct mpi3mr_tgt_dev *tgt_dev;\n\tu32 pend_count;\n};\n\n \nstruct mpi3mr_sdev_priv_data {\n\tstruct mpi3mr_stgt_priv_data *tgt_priv_data;\n\tu32 lun_id;\n\tu8 ncq_prio_enable;\n\tu32 pend_count;\n\tu16 wslen;\n};\n\n \nstruct mpi3mr_drv_cmd {\n\tstruct mutex mutex;\n\tstruct completion done;\n\tvoid *reply;\n\tu8 *sensebuf;\n\tu8 iou_rc;\n\tu16 state;\n\tu16 dev_handle;\n\tu16 ioc_status;\n\tu32 ioc_loginfo;\n\tu8 is_waiting;\n\tu8 is_sense;\n\tu8 retry_count;\n\tu16 host_tag;\n\n\tvoid (*callback)(struct mpi3mr_ioc *mrioc,\n\t    struct mpi3mr_drv_cmd *drv_cmd);\n};\n\n \nstruct dma_memory_desc {\n\tu32 size;\n\tvoid *addr;\n\tdma_addr_t dma_addr;\n};\n\n\n \nstruct chain_element {\n\tvoid *addr;\n\tdma_addr_t dma_addr;\n};\n\n \nstruct scmd_priv {\n\tu16 host_tag;\n\tu8 in_lld_scope;\n\tu8 meta_sg_valid;\n\tstruct scsi_cmnd *scmd;\n\tu16 req_q_idx;\n\tint chain_idx;\n\tint meta_chain_idx;\n\tu8 mpi3mr_scsiio_req[MPI3MR_ADMIN_REQ_FRAME_SZ];\n};\n\n \nstruct mpi3mr_ioc {\n\tstruct list_head list;\n\tstruct pci_dev *pdev;\n\tstruct Scsi_Host *shost;\n\tu8 id;\n\tint cpu_count;\n\tbool enable_segqueue;\n\tu32 irqpoll_sleep;\n\n\tchar name[MPI3MR_NAME_LENGTH];\n\tchar driver_name[MPI3MR_NAME_LENGTH];\n\n\tvolatile struct mpi3_sysif_registers __iomem *sysif_regs;\n\tresource_size_t sysif_regs_phys;\n\tint bars;\n\tu64 dma_mask;\n\n\tu16 msix_count;\n\tu8 intr_enabled;\n\n\tu16 num_admin_req;\n\tu32 admin_req_q_sz;\n\tu16 admin_req_pi;\n\tu16 admin_req_ci;\n\tvoid *admin_req_base;\n\tdma_addr_t admin_req_dma;\n\tspinlock_t admin_req_lock;\n\n\tu16 num_admin_replies;\n\tu32 admin_reply_q_sz;\n\tu16 admin_reply_ci;\n\tu8 admin_reply_ephase;\n\tvoid *admin_reply_base;\n\tdma_addr_t admin_reply_dma;\n\tatomic_t admin_reply_q_in_use;\n\n\tu32 ready_timeout;\n\n\tstruct mpi3mr_intr_info *intr_info;\n\tu16 intr_info_count;\n\tbool is_intr_info_set;\n\n\tu16 num_queues;\n\tu16 num_op_req_q;\n\tstruct op_req_qinfo *req_qinfo;\n\n\tu16 num_op_reply_q;\n\tstruct op_reply_qinfo *op_reply_qinfo;\n\n\tstruct mpi3mr_drv_cmd init_cmds;\n\tstruct mpi3mr_drv_cmd cfg_cmds;\n\tstruct mpi3mr_ioc_facts facts;\n\tu16 op_reply_desc_sz;\n\n\tu32 num_reply_bufs;\n\tstruct dma_pool *reply_buf_pool;\n\tu8 *reply_buf;\n\tdma_addr_t reply_buf_dma;\n\tdma_addr_t reply_buf_dma_max_address;\n\n\tu16 reply_free_qsz;\n\tu16 reply_sz;\n\tstruct dma_pool *reply_free_q_pool;\n\t__le64 *reply_free_q;\n\tdma_addr_t reply_free_q_dma;\n\tspinlock_t reply_free_queue_lock;\n\tu32 reply_free_queue_host_index;\n\n\tu32 num_sense_bufs;\n\tstruct dma_pool *sense_buf_pool;\n\tu8 *sense_buf;\n\tdma_addr_t sense_buf_dma;\n\n\tu16 sense_buf_q_sz;\n\tstruct dma_pool *sense_buf_q_pool;\n\t__le64 *sense_buf_q;\n\tdma_addr_t sense_buf_q_dma;\n\tspinlock_t sbq_lock;\n\tu32 sbq_host_index;\n\tu32 event_masks[MPI3_EVENT_NOTIFY_EVENTMASK_WORDS];\n\n\tchar fwevt_worker_name[MPI3MR_NAME_LENGTH];\n\tstruct workqueue_struct\t*fwevt_worker_thread;\n\tspinlock_t fwevt_lock;\n\tstruct list_head fwevt_list;\n\n\tchar watchdog_work_q_name[20];\n\tstruct workqueue_struct *watchdog_work_q;\n\tstruct delayed_work watchdog_work;\n\tspinlock_t watchdog_lock;\n\n\tu8 is_driver_loading;\n\tu8 scan_started;\n\tu16 scan_failed;\n\tu8 stop_drv_processing;\n\tu8 device_refresh_on;\n\n\tu16 max_host_ios;\n\tspinlock_t tgtdev_lock;\n\tstruct list_head tgtdev_list;\n\tu16 max_sgl_entries;\n\n\tu32 chain_buf_count;\n\tstruct dma_pool *chain_buf_pool;\n\tstruct chain_element *chain_sgl_list;\n\tunsigned long *chain_bitmap;\n\tspinlock_t chain_buf_lock;\n\n\tstruct mpi3mr_drv_cmd bsg_cmds;\n\tstruct mpi3mr_drv_cmd host_tm_cmds;\n\tstruct mpi3mr_drv_cmd dev_rmhs_cmds[MPI3MR_NUM_DEVRMCMD];\n\tstruct mpi3mr_drv_cmd evtack_cmds[MPI3MR_NUM_EVTACKCMD];\n\tunsigned long *devrem_bitmap;\n\tu16 dev_handle_bitmap_bits;\n\tunsigned long *removepend_bitmap;\n\tstruct list_head delayed_rmhs_list;\n\tunsigned long *evtack_cmds_bitmap;\n\tstruct list_head delayed_evtack_cmds_list;\n\n\tu32 ts_update_counter;\n\tu8 reset_in_progress;\n\tu8 unrecoverable;\n\tint prev_reset_result;\n\tstruct mutex reset_mutex;\n\twait_queue_head_t reset_waitq;\n\n\tu8 prepare_for_reset;\n\tu16 prepare_for_reset_timeout_counter;\n\n\tvoid *prp_list_virt;\n\tdma_addr_t prp_list_dma;\n\tu32 prp_sz;\n\n\tu16 diagsave_timeout;\n\tint logging_level;\n\tu16 flush_io_count;\n\n\tstruct mpi3mr_fwevt *current_event;\n\tstruct mpi3_driver_info_layout driver_info;\n\tu16 change_count;\n\n\tu8 pel_enabled;\n\tu8 pel_abort_requested;\n\tu8 pel_class;\n\tu16 pel_locale;\n\tstruct mpi3mr_drv_cmd pel_cmds;\n\tstruct mpi3mr_drv_cmd pel_abort_cmd;\n\n\tu32 pel_newest_seqnum;\n\tvoid *pel_seqnum_virt;\n\tdma_addr_t pel_seqnum_dma;\n\tu32 pel_seqnum_sz;\n\n\tu16 op_reply_q_offset;\n\tu16 default_qcount;\n\tu16 active_poll_qcount;\n\tu16 requested_poll_qcount;\n\n\tstruct device bsg_dev;\n\tstruct request_queue *bsg_queue;\n\tu8 stop_bsgs;\n\tu8 *logdata_buf;\n\tu16 logdata_buf_idx;\n\tu16 logdata_entry_sz;\n\n\tatomic_t pend_large_data_sz;\n\tu32 io_throttle_data_length;\n\tu32 io_throttle_high;\n\tu32 io_throttle_low;\n\tu16 num_io_throttle_group;\n\tstruct mpi3mr_throttle_group_info *throttle_groups;\n\n\tvoid *cfg_page;\n\tdma_addr_t cfg_page_dma;\n\tu16 cfg_page_sz;\n\n\tu8 sas_transport_enabled;\n\tu8 scsi_device_channel;\n\tstruct mpi3mr_drv_cmd transport_cmds;\n\tstruct mpi3mr_sas_node sas_hba;\n\tstruct list_head sas_expander_list;\n\tspinlock_t sas_node_lock;\n\tstruct list_head hba_port_table_list;\n\tstruct list_head enclosure_list;\n};\n\n \nstruct mpi3mr_fwevt {\n\tstruct list_head list;\n\tstruct work_struct work;\n\tstruct mpi3mr_ioc *mrioc;\n\tu16 event_id;\n\tbool send_ack;\n\tbool process_evt;\n\tu32 evt_ctx;\n\tu16 event_data_size;\n\tbool pending_at_sml;\n\tbool discard;\n\tstruct kref ref_count;\n\tchar event_data[] __aligned(4);\n};\n\n\n \nstruct delayed_dev_rmhs_node {\n\tstruct list_head list;\n\tu16 handle;\n\tu8 iou_rc;\n};\n\n \nstruct delayed_evt_ack_node {\n\tstruct list_head list;\n\tu8 event;\n\tu32 event_ctx;\n};\n\nint mpi3mr_setup_resources(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_cleanup_resources(struct mpi3mr_ioc *mrioc);\nint mpi3mr_init_ioc(struct mpi3mr_ioc *mrioc);\nint mpi3mr_reinit_ioc(struct mpi3mr_ioc *mrioc, u8 is_resume);\nvoid mpi3mr_cleanup_ioc(struct mpi3mr_ioc *mrioc);\nint mpi3mr_issue_port_enable(struct mpi3mr_ioc *mrioc, u8 async);\nint mpi3mr_admin_request_post(struct mpi3mr_ioc *mrioc, void *admin_req,\nu16 admin_req_sz, u8 ignore_reset);\nint mpi3mr_op_request_post(struct mpi3mr_ioc *mrioc,\n\t\t\t   struct op_req_qinfo *opreqq, u8 *req);\nvoid mpi3mr_add_sg_single(void *paddr, u8 flags, u32 length,\n\t\t\t  dma_addr_t dma_addr);\nvoid mpi3mr_build_zero_len_sge(void *paddr);\nvoid *mpi3mr_get_sensebuf_virt_addr(struct mpi3mr_ioc *mrioc,\n\t\t\t\t     dma_addr_t phys_addr);\nvoid *mpi3mr_get_reply_virt_addr(struct mpi3mr_ioc *mrioc,\n\t\t\t\t     dma_addr_t phys_addr);\nvoid mpi3mr_repost_sense_buf(struct mpi3mr_ioc *mrioc,\n\t\t\t\t     u64 sense_buf_dma);\n\nvoid mpi3mr_memset_buffers(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_free_mem(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_os_handle_events(struct mpi3mr_ioc *mrioc,\n\t\t\t     struct mpi3_event_notification_reply *event_reply);\nvoid mpi3mr_process_op_reply_desc(struct mpi3mr_ioc *mrioc,\n\t\t\t\t  struct mpi3_default_reply_descriptor *reply_desc,\n\t\t\t\t  u64 *reply_dma, u16 qidx);\nvoid mpi3mr_start_watchdog(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_stop_watchdog(struct mpi3mr_ioc *mrioc);\n\nint mpi3mr_soft_reset_handler(struct mpi3mr_ioc *mrioc,\n\t\t\t      u32 reset_reason, u8 snapdump);\nvoid mpi3mr_ioc_disable_intr(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_ioc_enable_intr(struct mpi3mr_ioc *mrioc);\n\nenum mpi3mr_iocstate mpi3mr_get_iocstate(struct mpi3mr_ioc *mrioc);\nint mpi3mr_process_event_ack(struct mpi3mr_ioc *mrioc, u8 event,\n\t\t\t  u32 event_ctx);\n\nvoid mpi3mr_wait_for_host_io(struct mpi3mr_ioc *mrioc, u32 timeout);\nvoid mpi3mr_cleanup_fwevt_list(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_flush_host_io(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_invalidate_devhandles(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_rfresh_tgtdevs(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_flush_delayed_cmd_lists(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_check_rh_fault_ioc(struct mpi3mr_ioc *mrioc, u32 reason_code);\nvoid mpi3mr_print_fault_info(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_check_rh_fault_ioc(struct mpi3mr_ioc *mrioc, u32 reason_code);\nint mpi3mr_process_op_reply_q(struct mpi3mr_ioc *mrioc,\n\tstruct op_reply_qinfo *op_reply_q);\nint mpi3mr_blk_mq_poll(struct Scsi_Host *shost, unsigned int queue_num);\nvoid mpi3mr_bsg_init(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_bsg_exit(struct mpi3mr_ioc *mrioc);\nint mpi3mr_issue_tm(struct mpi3mr_ioc *mrioc, u8 tm_type,\n\tu16 handle, uint lun, u16 htag, ulong timeout,\n\tstruct mpi3mr_drv_cmd *drv_cmd,\n\tu8 *resp_code, struct scsi_cmnd *scmd);\nstruct mpi3mr_tgt_dev *mpi3mr_get_tgtdev_by_handle(\n\tstruct mpi3mr_ioc *mrioc, u16 handle);\nvoid mpi3mr_pel_get_seqnum_complete(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3mr_drv_cmd *drv_cmd);\nint mpi3mr_pel_get_seqnum_post(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3mr_drv_cmd *drv_cmd);\nvoid mpi3mr_app_save_logdata(struct mpi3mr_ioc *mrioc, char *event_data,\n\tu16 event_data_size);\nstruct mpi3mr_enclosure_node *mpi3mr_enclosure_find_by_handle(\n\tstruct mpi3mr_ioc *mrioc, u16 handle);\nextern const struct attribute_group *mpi3mr_host_groups[];\nextern const struct attribute_group *mpi3mr_dev_groups[];\n\nextern struct sas_function_template mpi3mr_transport_functions;\nextern struct scsi_transport_template *mpi3mr_transport_template;\n\nint mpi3mr_cfg_get_dev_pg0(struct mpi3mr_ioc *mrioc, u16 *ioc_status,\n\tstruct mpi3_device_page0 *dev_pg0, u16 pg_sz, u32 form, u32 form_spec);\nint mpi3mr_cfg_get_sas_phy_pg0(struct mpi3mr_ioc *mrioc, u16 *ioc_status,\n\tstruct mpi3_sas_phy_page0 *phy_pg0, u16 pg_sz, u32 form,\n\tu32 form_spec);\nint mpi3mr_cfg_get_sas_phy_pg1(struct mpi3mr_ioc *mrioc, u16 *ioc_status,\n\tstruct mpi3_sas_phy_page1 *phy_pg1, u16 pg_sz, u32 form,\n\tu32 form_spec);\nint mpi3mr_cfg_get_sas_exp_pg0(struct mpi3mr_ioc *mrioc, u16 *ioc_status,\n\tstruct mpi3_sas_expander_page0 *exp_pg0, u16 pg_sz, u32 form,\n\tu32 form_spec);\nint mpi3mr_cfg_get_sas_exp_pg1(struct mpi3mr_ioc *mrioc, u16 *ioc_status,\n\tstruct mpi3_sas_expander_page1 *exp_pg1, u16 pg_sz, u32 form,\n\tu32 form_spec);\nint mpi3mr_cfg_get_enclosure_pg0(struct mpi3mr_ioc *mrioc, u16 *ioc_status,\n\tstruct mpi3_enclosure_page0 *encl_pg0, u16 pg_sz, u32 form,\n\tu32 form_spec);\nint mpi3mr_cfg_get_sas_io_unit_pg0(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3_sas_io_unit_page0 *sas_io_unit_pg0, u16 pg_sz);\nint mpi3mr_cfg_get_sas_io_unit_pg1(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3_sas_io_unit_page1 *sas_io_unit_pg1, u16 pg_sz);\nint mpi3mr_cfg_set_sas_io_unit_pg1(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3_sas_io_unit_page1 *sas_io_unit_pg1, u16 pg_sz);\nint mpi3mr_cfg_get_driver_pg1(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3_driver_page1 *driver_pg1, u16 pg_sz);\n\nu8 mpi3mr_is_expander_device(u16 device_info);\nint mpi3mr_expander_add(struct mpi3mr_ioc *mrioc, u16 handle);\nvoid mpi3mr_expander_remove(struct mpi3mr_ioc *mrioc, u64 sas_address,\n\tstruct mpi3mr_hba_port *hba_port);\nstruct mpi3mr_sas_node *__mpi3mr_expander_find_by_handle(struct mpi3mr_ioc\n\t*mrioc, u16 handle);\nstruct mpi3mr_hba_port *mpi3mr_get_hba_port_by_id(struct mpi3mr_ioc *mrioc,\n\tu8 port_id);\nvoid mpi3mr_sas_host_refresh(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_sas_host_add(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_update_links(struct mpi3mr_ioc *mrioc,\n\tu64 sas_address_parent, u16 handle, u8 phy_number, u8 link_rate,\n\tstruct mpi3mr_hba_port *hba_port);\nvoid mpi3mr_remove_tgtdev_from_host(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3mr_tgt_dev *tgtdev);\nint mpi3mr_report_tgtdev_to_sas_transport(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3mr_tgt_dev *tgtdev);\nvoid mpi3mr_remove_tgtdev_from_sas_transport(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3mr_tgt_dev *tgtdev);\nstruct mpi3mr_tgt_dev *__mpi3mr_get_tgtdev_by_addr_and_rphy(\n\tstruct mpi3mr_ioc *mrioc, u64 sas_address, struct sas_rphy *rphy);\nvoid mpi3mr_print_device_event_notice(struct mpi3mr_ioc *mrioc,\n\tbool device_add);\nvoid mpi3mr_refresh_sas_ports(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_refresh_expanders(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_add_event_wait_for_device_refresh(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_flush_drv_cmds(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_flush_cmds_for_unrecovered_controller(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_free_enclosure_list(struct mpi3mr_ioc *mrioc);\nint mpi3mr_process_admin_reply_q(struct mpi3mr_ioc *mrioc);\nvoid mpi3mr_expander_node_remove(struct mpi3mr_ioc *mrioc,\n\tstruct mpi3mr_sas_node *sas_expander);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}