{
  "module_name": "aic7770_osm.c",
  "hash_id": "68900ca2f639419f780006efa5f6491adde208f898e0b43752f308675015765b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/aic7xxx/aic7770_osm.c",
  "human_readable_source": " \n\n#include \"aic7xxx_osm.h\"\n\n#include <linux/device.h>\n#include <linux/eisa.h>\n\nint\naic7770_map_registers(struct ahc_softc *ahc, u_int port)\n{\n\t \n\tif (!request_region(port, AHC_EISA_IOSIZE, \"aic7xxx\"))\n\t\treturn (ENOMEM);\n\tahc->tag = BUS_SPACE_PIO;\n\tahc->bsh.ioport = port;\n\treturn (0);\n}\n\nint\naic7770_map_int(struct ahc_softc *ahc, u_int irq)\n{\n\tint error;\n\tint shared;\n\n\tshared = 0;\n\tif ((ahc->flags & AHC_EDGE_INTERRUPT) == 0)\n\t\tshared = IRQF_SHARED;\n\n\terror = request_irq(irq, ahc_linux_isr, shared, \"aic7xxx\", ahc);\n\tif (error == 0)\n\t\tahc->platform_data->irq = irq;\n\t\n\treturn (-error);\n}\n\nstatic int\naic7770_probe(struct device *dev)\n{\n\tstruct eisa_device *edev = to_eisa_device(dev);\n\tu_int eisaBase = edev->base_addr+AHC_EISA_SLOT_OFFSET;\n\tstruct\tahc_softc *ahc;\n\tchar\tbuf[80];\n\tchar   *name;\n\tint\terror;\n\n\tsprintf(buf, \"ahc_eisa:%d\", eisaBase >> 12);\n\tname = kstrdup(buf, GFP_ATOMIC);\n\tif (name == NULL)\n\t\treturn (ENOMEM);\n\tahc = ahc_alloc(&aic7xxx_driver_template, name);\n\tif (ahc == NULL)\n\t\treturn (ENOMEM);\n\tahc->dev = dev;\n\terror = aic7770_config(ahc, aic7770_ident_table + edev->id.driver_data,\n\t\t\t       eisaBase);\n\tif (error != 0) {\n\t\tahc->bsh.ioport = 0;\n\t\tahc_free(ahc);\n\t\treturn (error);\n\t}\n\n \tdev_set_drvdata(dev, ahc);\n\n\terror = ahc_linux_register_host(ahc, &aic7xxx_driver_template);\n\treturn (error);\n}\n\nstatic int\naic7770_remove(struct device *dev)\n{\n\tstruct ahc_softc *ahc = dev_get_drvdata(dev);\n\tu_long s;\n\n\tif (ahc->platform_data && ahc->platform_data->host)\n\t\t\tscsi_remove_host(ahc->platform_data->host);\n\n\tahc_lock(ahc, &s);\n\tahc_intr_enable(ahc, FALSE);\n\tahc_unlock(ahc, &s);\n\n\tahc_free(ahc);\n\treturn 0;\n}\n \nstatic struct eisa_device_id aic7770_ids[] = {\n\t{ \"ADP7771\", 0 },  \n\t{ \"ADP7756\", 1 },  \n\t{ \"ADP7757\", 2 },  \n\t{ \"ADP7782\", 3 },  \n\t{ \"ADP7783\", 4 },  \n\t{ \"ADP7770\", 5 },  \n\t{ \"\" }\n};\nMODULE_DEVICE_TABLE(eisa, aic7770_ids);\n\nstatic struct eisa_driver aic7770_driver = {\n\t.id_table\t= aic7770_ids,\n\t.driver = {\n\t\t.name   = \"aic7xxx\",\n\t\t.probe  = aic7770_probe,\n\t\t.remove = aic7770_remove,\n\t}\n};\n  \nint\nahc_linux_eisa_init(void)\n{\n\treturn eisa_driver_register(&aic7770_driver);\n}\n  \nvoid\nahc_linux_eisa_exit(void)\n{\n\teisa_driver_unregister(&aic7770_driver);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}