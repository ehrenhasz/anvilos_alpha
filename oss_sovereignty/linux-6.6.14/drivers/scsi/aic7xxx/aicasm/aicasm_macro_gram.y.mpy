{
  "module_name": "aicasm_macro_gram.y",
  "hash_id": "14a707a87953cbc4a1a8b09f2f718871e3114028c50acc1129610ae9a9e4a289",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/aic7xxx/aicasm/aicasm_macro_gram.y",
  "human_readable_source": "%{\n/*\n * Sub-parser for macro invocation in the Aic7xxx SCSI\n * Host adapter sequencer assembler.\n *\n * Copyright (c) 2001 Adaptec Inc.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions\n * are met:\n * 1. Redistributions of source code must retain the above copyright\n *    notice, this list of conditions, and the following disclaimer,\n *    without modification.\n * 2. Redistributions in binary form must reproduce at minimum a disclaimer\n *    substantially similar to the \"NO WARRANTY\" disclaimer below\n *    (\"Disclaimer\") and any redistribution must be conditioned upon\n *    including a substantially similar Disclaimer requirement for further\n *    binary redistribution.\n * 3. Neither the names of the above-listed copyright holders nor the names\n *    of any contributors may be used to endorse or promote products derived\n *    from this software without specific prior written permission.\n *\n * Alternatively, this software may be distributed under the terms of the\n * GNU General Public License (\"GPL\") version 2 as published by the Free\n * Software Foundation.\n *\n * NO WARRANTY\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n * \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTIBILITY AND FITNESS FOR\n * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n * HOLDERS OR CONTRIBUTORS BE LIABLE FOR SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS\n * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)\n * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,\n * STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING\n * IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n * POSSIBILITY OF SUCH DAMAGES.\n *\n * $Id: //depot/aic7xxx/aic7xxx/aicasm/aicasm_macro_gram.y#5 $\n *\n * $FreeBSD$\n */\n\n#include <sys/types.h>\n\n#include <inttypes.h>\n#include <regex.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sysexits.h>\n\n#include \"../queue.h\"\n\n#include \"aicasm.h\"\n#include \"aicasm_symbol.h\"\n#include \"aicasm_insformat.h\"\n\nstatic symbol_t *macro_symbol;\n\nstatic void add_macro_arg(const char *argtext, int position);\nvoid mmerror(const char *string);\n\n%}\n\n%union {\n\tint\t\tvalue;\n\tchar\t\t*str;\n\tsymbol_t\t*sym;\n}\n\n\n%token <str> T_ARG\n\n%token <sym> T_SYMBOL\n\n%type <value> macro_arglist\n\n%%\n\nmacrocall:\n\tT_SYMBOL '('\n\t{\n\t\tmacro_symbol = $1;\n\t}\n\tmacro_arglist ')'\n\t{\n\t\tif (macro_symbol->info.macroinfo->narg != $4) {\n\t\t\tprintf(\"Narg == %d\", macro_symbol->info.macroinfo->narg);\n\t\t\tstop(\"Too few arguments for macro invocation\",\n\t\t\t     EX_DATAERR);\n\t\t\t/* NOTREACHED */\n\t\t}\n\t\tmacro_symbol = NULL;\n\t\tYYACCEPT;\n\t}\n;\n\nmacro_arglist:\n\t{\n\t\t/* Macros can take 0 arguments */\n\t\t$$ = 0;\n\t}\n|\tT_ARG\n\t{\n\t\t$$ = 1;\n\t\tadd_macro_arg($1, 1);\n\t}\n|\tmacro_arglist ',' T_ARG\n\t{\n\t\tif ($1 == 0) {\n\t\t\tstop(\"Comma without preceding argument in arg list\",\n\t\t\t     EX_DATAERR);\n\t\t\t/* NOTREACHED */\n\t\t}\n\t\t$$ = $1 + 1;\n\t\tadd_macro_arg($3, $$);\n\t}\n;\n\n%%\n\nstatic void\nadd_macro_arg(const char *argtext, int argnum)\n{\n\tstruct macro_arg *marg;\n\tint i;\n\n\tif (macro_symbol == NULL || macro_symbol->type != MACRO) {\n\t\tstop(\"Invalid current symbol for adding macro arg\",\n\t\t     EX_SOFTWARE);\n\t\t/* NOTREACHED */\n\t}\n\t/*\n\t * Macro Invocation.  Find the appropriate argument and fill\n\t * in the replace ment text for this call.\n\t */\n\ti = 0;\n\tSTAILQ_FOREACH(marg, &macro_symbol->info.macroinfo->args, links) {\n\t\ti++;\n\t\tif (i == argnum)\n\t\t\tbreak;\n\t}\n\tif (marg == NULL) {\n\t\tstop(\"Too many arguments for macro invocation\", EX_DATAERR);\n\t\t/* NOTREACHED */\n\t}\n\tmarg->replacement_text = strdup(argtext);\n\tif (marg->replacement_text == NULL) {\n\t\tstop(\"Unable to replicate replacement text\", EX_SOFTWARE);\n\t\t/* NOTREACHED */\n\t}\n}\n\nvoid\nmmerror(const char *string)\n{\n\tstop(string, EX_DATAERR);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}