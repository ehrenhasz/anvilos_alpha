{
  "module_name": "ibmvfc.h",
  "hash_id": "20fac65d90e3ce2e3818d0945bee8b8da5332a2a03ff07135a8bec1d72e1bd65",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/ibmvscsi/ibmvfc.h",
  "human_readable_source": " \n \n\n#ifndef _IBMVFC_H\n#define _IBMVFC_H\n\n#include <linux/list.h>\n#include <linux/types.h>\n#include <scsi/viosrp.h>\n\n#define IBMVFC_NAME\t\"ibmvfc\"\n#define IBMVFC_DRIVER_VERSION\t\t\"1.0.11\"\n#define IBMVFC_DRIVER_DATE\t\t\"(April 12, 2013)\"\n\n#define IBMVFC_DEFAULT_TIMEOUT\t60\n#define IBMVFC_ADISC_CANCEL_TIMEOUT\t45\n#define IBMVFC_ADISC_TIMEOUT\t\t15\n#define IBMVFC_ADISC_PLUS_CANCEL_TIMEOUT\t\\\n\t\t(IBMVFC_ADISC_TIMEOUT + IBMVFC_ADISC_CANCEL_TIMEOUT)\n#define IBMVFC_INIT_TIMEOUT\t\t120\n#define IBMVFC_ABORT_TIMEOUT\t\t8\n#define IBMVFC_ABORT_WAIT_TIMEOUT\t40\n#define IBMVFC_MAX_REQUESTS_DEFAULT\t100\n\n#define IBMVFC_DEBUG\t\t\t0\n#define IBMVFC_MAX_TARGETS\t\t1024\n#define IBMVFC_MAX_LUN\t\t\t0xffffffff\n#define IBMVFC_MAX_SECTORS\t\t0xffffu\n#define IBMVFC_MAX_DISC_THREADS\t4\n#define IBMVFC_TGT_MEMPOOL_SZ\t\t64\n#define IBMVFC_MAX_CMDS_PER_LUN\t64\n#define IBMVFC_MAX_HOST_INIT_RETRIES\t6\n#define IBMVFC_MAX_TGT_INIT_RETRIES\t\t3\n#define IBMVFC_DEV_LOSS_TMO\t\t(5 * 60)\n#define IBMVFC_DEFAULT_LOG_LEVEL\t2\n#define IBMVFC_MAX_CDB_LEN\t\t16\n#define IBMVFC_CLS3_ERROR\t\t0\n#define IBMVFC_MQ\t\t\t1\n#define IBMVFC_SCSI_CHANNELS\t\t8\n#define IBMVFC_MAX_SCSI_QUEUES\t\t16\n#define IBMVFC_SCSI_HW_QUEUES\t\t8\n#define IBMVFC_MIG_NO_SUB_TO_CRQ\t0\n#define IBMVFC_MIG_NO_N_TO_M\t\t0\n\n \n#define IBMVFC_NUM_INTERNAL_REQ\t(1 + 1 + 1 + 2 + (disc_threads * 2))\n\n#define IBMVFC_MAD_SUCCESS\t\t0x00\n#define IBMVFC_MAD_NOT_SUPPORTED\t0xF1\n#define IBMVFC_MAD_VERSION_NOT_SUPP\t0xF2\n#define IBMVFC_MAD_FAILED\t\t0xF7\n#define IBMVFC_MAD_DRIVER_FAILED\t0xEE\n#define IBMVFC_MAD_CRQ_ERROR\t\t0xEF\n\nenum ibmvfc_crq_valid {\n\tIBMVFC_CRQ_CMD_RSP\t\t= 0x80,\n\tIBMVFC_CRQ_INIT_RSP\t\t= 0xC0,\n\tIBMVFC_CRQ_XPORT_EVENT\t\t= 0xFF,\n};\n\nenum ibmvfc_crq_init_msg {\n\tIBMVFC_CRQ_INIT\t\t\t= 0x01,\n\tIBMVFC_CRQ_INIT_COMPLETE\t= 0x02,\n};\n\nenum ibmvfc_crq_xport_evts {\n\tIBMVFC_PARTNER_FAILED\t\t= 0x01,\n\tIBMVFC_PARTNER_DEREGISTER\t= 0x02,\n\tIBMVFC_PARTITION_MIGRATED\t= 0x06,\n};\n\nenum ibmvfc_cmd_status_flags {\n\tIBMVFC_FABRIC_MAPPED\t\t= 0x0001,\n\tIBMVFC_VIOS_FAILURE\t\t= 0x0002,\n\tIBMVFC_FC_FAILURE\t\t\t= 0x0004,\n\tIBMVFC_FC_SCSI_ERROR\t\t= 0x0008,\n\tIBMVFC_HW_EVENT_LOGGED\t\t= 0x0010,\n\tIBMVFC_VIOS_LOGGED\t\t= 0x0020,\n};\n\nenum ibmvfc_fabric_mapped_errors {\n\tIBMVFC_UNABLE_TO_ESTABLISH\t= 0x0001,\n\tIBMVFC_XPORT_FAULT\t\t= 0x0002,\n\tIBMVFC_CMD_TIMEOUT\t\t= 0x0003,\n\tIBMVFC_ENETDOWN\t\t\t= 0x0004,\n\tIBMVFC_HW_FAILURE\t\t\t= 0x0005,\n\tIBMVFC_LINK_DOWN_ERR\t\t= 0x0006,\n\tIBMVFC_LINK_DEAD_ERR\t\t= 0x0007,\n\tIBMVFC_UNABLE_TO_REGISTER\t= 0x0008,\n\tIBMVFC_XPORT_BUSY\t\t\t= 0x000A,\n\tIBMVFC_XPORT_DEAD\t\t\t= 0x000B,\n\tIBMVFC_CONFIG_ERROR\t\t= 0x000C,\n\tIBMVFC_NAME_SERVER_FAIL\t\t= 0x000D,\n\tIBMVFC_LINK_HALTED\t\t= 0x000E,\n\tIBMVFC_XPORT_GENERAL\t\t= 0x8000,\n};\n\nenum ibmvfc_vios_errors {\n\tIBMVFC_CRQ_FAILURE\t\t\t= 0x0001,\n\tIBMVFC_SW_FAILURE\t\t\t\t= 0x0002,\n\tIBMVFC_INVALID_PARAMETER\t\t= 0x0003,\n\tIBMVFC_MISSING_PARAMETER\t\t= 0x0004,\n\tIBMVFC_HOST_IO_BUS\t\t\t= 0x0005,\n\tIBMVFC_TRANS_CANCELLED\t\t\t= 0x0006,\n\tIBMVFC_TRANS_CANCELLED_IMPLICIT\t= 0x0007,\n\tIBMVFC_INSUFFICIENT_RESOURCE\t\t= 0x0008,\n\tIBMVFC_PLOGI_REQUIRED\t\t\t= 0x0010,\n\tIBMVFC_COMMAND_FAILED\t\t\t= 0x8000,\n};\n\nenum ibmvfc_mad_types {\n\tIBMVFC_NPIV_LOGIN\t\t= 0x0001,\n\tIBMVFC_DISC_TARGETS\t= 0x0002,\n\tIBMVFC_PORT_LOGIN\t\t= 0x0004,\n\tIBMVFC_PROCESS_LOGIN\t= 0x0008,\n\tIBMVFC_QUERY_TARGET\t= 0x0010,\n\tIBMVFC_MOVE_LOGIN\t\t= 0x0020,\n\tIBMVFC_IMPLICIT_LOGOUT\t= 0x0040,\n\tIBMVFC_PASSTHRU\t\t= 0x0200,\n\tIBMVFC_TMF_MAD\t\t= 0x0100,\n\tIBMVFC_NPIV_LOGOUT\t= 0x0800,\n\tIBMVFC_CHANNEL_ENQUIRY\t= 0x1000,\n\tIBMVFC_CHANNEL_SETUP\t= 0x2000,\n\tIBMVFC_CONNECTION_INFO\t= 0x4000,\n};\n\nstruct ibmvfc_mad_common {\n\t__be32 version;\n\t__be32 reserved;\n\t__be32 opcode;\n\t__be16 status;\n\t__be16 length;\n\t__be64 tag;\n} __packed __aligned(8);\n\nstruct ibmvfc_npiv_login_mad {\n\tstruct ibmvfc_mad_common common;\n\tstruct srp_direct_buf buffer;\n} __packed __aligned(8);\n\nstruct ibmvfc_npiv_logout_mad {\n\tstruct ibmvfc_mad_common common;\n} __packed __aligned(8);\n\n#define IBMVFC_MAX_NAME 256\n\nstruct ibmvfc_npiv_login {\n\t__be32 ostype;\n#define IBMVFC_OS_LINUX\t0x02\n\t__be32 pad;\n\t__be64 max_dma_len;\n\t__be32 max_payload;\n\t__be32 max_response;\n\t__be32 partition_num;\n\t__be32 vfc_frame_version;\n\t__be16 fcp_version;\n\t__be16 flags;\n#define IBMVFC_CLIENT_MIGRATED\t0x01\n#define IBMVFC_FLUSH_ON_HALT\t\t0x02\n\t__be32 max_cmds;\n\t__be64 capabilities;\n#define IBMVFC_CAN_MIGRATE\t\t0x01\n#define IBMVFC_CAN_USE_CHANNELS\t\t0x02\n#define IBMVFC_CAN_HANDLE_FPIN\t\t0x04\n#define IBMVFC_CAN_USE_MAD_VERSION\t0x08\n#define IBMVFC_CAN_SEND_VF_WWPN\t\t0x10\n\t__be64 node_name;\n\tstruct srp_direct_buf async;\n\tu8 partition_name[IBMVFC_MAX_NAME];\n\tu8 device_name[IBMVFC_MAX_NAME];\n\tu8 drc_name[IBMVFC_MAX_NAME];\n\t__be64 reserved2[2];\n} __packed __aligned(8);\n\nstruct ibmvfc_common_svc_parms {\n\t__be16 fcph_version;\n\t__be16 b2b_credit;\n\t__be16 features;\n\t__be16 bb_rcv_sz;  \n\t__be32 ratov;\n\t__be32 edtov;\n} __packed __aligned(4);\n\nstruct ibmvfc_service_parms {\n\tstruct ibmvfc_common_svc_parms common;\n\tu8 port_name[8];\n\tu8 node_name[8];\n\t__be32 class1_parms[4];\n\t__be32 class2_parms[4];\n\t__be32 class3_parms[4];\n\t__be32 obsolete[4];\n\t__be32 vendor_version[4];\n\t__be32 services_avail[2];\n\t__be32 ext_len;\n\t__be32 reserved[30];\n\t__be32 clk_sync_qos[2];\n\t__be32 reserved2;\n} __packed __aligned(4);\n\nstruct ibmvfc_npiv_login_resp {\n\t__be32 version;\n\t__be16 status;\n\t__be16 error;\n\t__be32 flags;\n#define IBMVFC_NATIVE_FC\t\t0x01\n\t__be32 reserved;\n\t__be64 capabilities;\n#define IBMVFC_CAN_FLUSH_ON_HALT\t0x08\n#define IBMVFC_CAN_SUPPRESS_ABTS\t0x10\n#define IBMVFC_MAD_VERSION_CAP\t\t0x20\n#define IBMVFC_HANDLE_VF_WWPN\t\t0x40\n#define IBMVFC_CAN_SUPPORT_CHANNELS\t0x80\n\t__be32 max_cmds;\n\t__be32 scsi_id_sz;\n\t__be64 max_dma_len;\n\t__be64 scsi_id;\n\t__be64 port_name;\n\t__be64 node_name;\n\t__be64 link_speed;\n\tu8 partition_name[IBMVFC_MAX_NAME];\n\tu8 device_name[IBMVFC_MAX_NAME];\n\tu8 port_loc_code[IBMVFC_MAX_NAME];\n\tu8 drc_name[IBMVFC_MAX_NAME];\n\tstruct ibmvfc_service_parms service_parms;\n\t__be64 reserved2;\n} __packed __aligned(8);\n\nunion ibmvfc_npiv_login_data {\n\tstruct ibmvfc_npiv_login login;\n\tstruct ibmvfc_npiv_login_resp resp;\n} __packed __aligned(8);\n\nstruct ibmvfc_discover_targets_entry {\n\t__be32 scsi_id;\n\t__be32 pad;\n\t__be64 wwpn;\n#define IBMVFC_DISC_TGT_SCSI_ID_MASK\t0x00ffffff\n} __packed __aligned(8);\n\nstruct ibmvfc_discover_targets {\n\tstruct ibmvfc_mad_common common;\n\tstruct srp_direct_buf buffer;\n\t__be32 flags;\n#define IBMVFC_DISC_TGT_PORT_ID_WWPN_LIST\t0x02\n\t__be16 status;\n\t__be16 error;\n\t__be32 bufflen;\n\t__be32 num_avail;\n\t__be32 num_written;\n\t__be64 reserved[2];\n} __packed __aligned(8);\n\nenum ibmvfc_fc_reason {\n\tIBMVFC_INVALID_ELS_CMD_CODE\t= 0x01,\n\tIBMVFC_INVALID_VERSION\t\t= 0x02,\n\tIBMVFC_LOGICAL_ERROR\t\t= 0x03,\n\tIBMVFC_INVALID_CT_IU_SIZE\t= 0x04,\n\tIBMVFC_LOGICAL_BUSY\t\t= 0x05,\n\tIBMVFC_PROTOCOL_ERROR\t\t= 0x07,\n\tIBMVFC_UNABLE_TO_PERFORM_REQ\t= 0x09,\n\tIBMVFC_CMD_NOT_SUPPORTED\t= 0x0B,\n\tIBMVFC_SERVER_NOT_AVAIL\t\t= 0x0D,\n\tIBMVFC_CMD_IN_PROGRESS\t\t= 0x0E,\n\tIBMVFC_VENDOR_SPECIFIC\t\t= 0xFF,\n};\n\nenum ibmvfc_fc_type {\n\tIBMVFC_FABRIC_REJECT\t= 0x01,\n\tIBMVFC_PORT_REJECT\t= 0x02,\n\tIBMVFC_LS_REJECT\t\t= 0x03,\n\tIBMVFC_FABRIC_BUSY\t= 0x04,\n\tIBMVFC_PORT_BUSY\t\t= 0x05,\n\tIBMVFC_BASIC_REJECT\t= 0x06,\n};\n\nenum ibmvfc_gs_explain {\n\tIBMVFC_PORT_NAME_NOT_REG\t= 0x02,\n};\n\nstruct ibmvfc_port_login {\n\tstruct ibmvfc_mad_common common;\n\t__be64 scsi_id;\n\t__be16 reserved;\n\t__be16 fc_service_class;\n\t__be32 blksz;\n\t__be32 hdr_per_blk;\n\t__be16 status;\n\t__be16 error;\t\t \n\t__be16 fc_explain;\n\t__be16 fc_type;\n\t__be32 reserved2;\n\tstruct ibmvfc_service_parms service_parms;\n\tstruct ibmvfc_service_parms service_parms_change;\n\t__be64 target_wwpn;\n\t__be64 reserved3[2];\n} __packed __aligned(8);\n\nstruct ibmvfc_move_login {\n\tstruct ibmvfc_mad_common common;\n\t__be64 old_scsi_id;\n\t__be64 new_scsi_id;\n\t__be64 wwpn;\n\t__be64 node_name;\n\t__be32 flags;\n#define IBMVFC_MOVE_LOGIN_IMPLICIT_OLD_FAILED\t0x01\n#define IBMVFC_MOVE_LOGIN_IMPLICIT_NEW_FAILED\t0x02\n#define IBMVFC_MOVE_LOGIN_PORT_LOGIN_FAILED\t0x04\n\t__be32 reserved;\n\tstruct ibmvfc_service_parms service_parms;\n\tstruct ibmvfc_service_parms service_parms_change;\n\t__be32 reserved2;\n\t__be16 service_class;\n\t__be16 vios_flags;\n#define IBMVFC_MOVE_LOGIN_VF_NOT_SENT_ADAPTER\t0x01\n\t__be64 reserved3;\n} __packed __aligned(8);\n\nstruct ibmvfc_prli_svc_parms {\n\tu8 type;\n#define IBMVFC_SCSI_FCP_TYPE\t\t0x08\n\tu8 type_ext;\n\t__be16 flags;\n#define IBMVFC_PRLI_ORIG_PA_VALID\t\t\t0x8000\n#define IBMVFC_PRLI_RESP_PA_VALID\t\t\t0x4000\n#define IBMVFC_PRLI_EST_IMG_PAIR\t\t\t0x2000\n\t__be32 orig_pa;\n\t__be32 resp_pa;\n\t__be32 service_parms;\n#define IBMVFC_PRLI_TASK_RETRY\t\t\t0x00000200\n#define IBMVFC_PRLI_RETRY\t\t\t\t0x00000100\n#define IBMVFC_PRLI_DATA_OVERLAY\t\t\t0x00000040\n#define IBMVFC_PRLI_INITIATOR_FUNC\t\t\t0x00000020\n#define IBMVFC_PRLI_TARGET_FUNC\t\t\t0x00000010\n#define IBMVFC_PRLI_READ_FCP_XFER_RDY_DISABLED\t0x00000002\n#define IBMVFC_PRLI_WR_FCP_XFER_RDY_DISABLED\t0x00000001\n} __packed __aligned(4);\n\nstruct ibmvfc_process_login {\n\tstruct ibmvfc_mad_common common;\n\t__be64 scsi_id;\n\tstruct ibmvfc_prli_svc_parms parms;\n\tu8 reserved[48];\n\t__be16 status;\n\t__be16 error;\t\t\t \n\t__be32 reserved2;\n\t__be64 target_wwpn;\n\t__be64 reserved3[2];\n} __packed __aligned(8);\n\nstruct ibmvfc_query_tgt {\n\tstruct ibmvfc_mad_common common;\n\t__be64 wwpn;\n\t__be64 scsi_id;\n\t__be16 status;\n\t__be16 error;\n\t__be16 fc_explain;\n\t__be16 fc_type;\n\t__be64 reserved[2];\n} __packed __aligned(8);\n\nstruct ibmvfc_implicit_logout {\n\tstruct ibmvfc_mad_common common;\n\t__be64 old_scsi_id;\n\t__be64 reserved[2];\n} __packed __aligned(8);\n\nstruct ibmvfc_tmf {\n\tstruct ibmvfc_mad_common common;\n\t__be64 scsi_id;\n\tstruct scsi_lun lun;\n\t__be32 flags;\n#define IBMVFC_TMF_ABORT_TASK\t\t0x02\n#define IBMVFC_TMF_ABORT_TASK_SET\t0x04\n#define IBMVFC_TMF_LUN_RESET\t\t0x10\n#define IBMVFC_TMF_TGT_RESET\t\t0x20\n#define IBMVFC_TMF_LUA_VALID\t\t0x40\n#define IBMVFC_TMF_SUPPRESS_ABTS\t0x80\n\t__be32 cancel_key;\n\t__be32 my_cancel_key;\n\t__be32 pad;\n\t__be64 target_wwpn;\n\t__be64 task_tag;\n\t__be64 reserved[2];\n} __packed __aligned(8);\n\nenum ibmvfc_fcp_rsp_info_codes {\n\tRSP_NO_FAILURE\t\t= 0x00,\n\tRSP_TMF_REJECTED\t\t= 0x04,\n\tRSP_TMF_FAILED\t\t= 0x05,\n\tRSP_TMF_INVALID_LUN\t= 0x09,\n};\n\nstruct ibmvfc_fcp_rsp_info {\n\tu8 reserved[3];\n\tu8 rsp_code;\n\tu8 reserved2[4];\n} __packed __aligned(2);\n\nenum ibmvfc_fcp_rsp_flags {\n\tFCP_BIDI_RSP\t\t\t= 0x80,\n\tFCP_BIDI_READ_RESID_UNDER\t= 0x40,\n\tFCP_BIDI_READ_RESID_OVER\t= 0x20,\n\tFCP_CONF_REQ\t\t\t= 0x10,\n\tFCP_RESID_UNDER\t\t\t= 0x08,\n\tFCP_RESID_OVER\t\t\t= 0x04,\n\tFCP_SNS_LEN_VALID\t\t\t= 0x02,\n\tFCP_RSP_LEN_VALID\t\t\t= 0x01,\n};\n\nunion ibmvfc_fcp_rsp_data {\n\tstruct ibmvfc_fcp_rsp_info info;\n\tu8 sense[SCSI_SENSE_BUFFERSIZE + sizeof(struct ibmvfc_fcp_rsp_info)];\n} __packed __aligned(8);\n\nstruct ibmvfc_fcp_rsp {\n\t__be64 reserved;\n\t__be16 retry_delay_timer;\n\tu8 flags;\n\tu8 scsi_status;\n\t__be32 fcp_resid;\n\t__be32 fcp_sense_len;\n\t__be32 fcp_rsp_len;\n\tunion ibmvfc_fcp_rsp_data data;\n} __packed __aligned(8);\n\nenum ibmvfc_cmd_flags {\n\tIBMVFC_SCATTERLIST\t= 0x0001,\n\tIBMVFC_NO_MEM_DESC\t= 0x0002,\n\tIBMVFC_READ\t\t\t= 0x0004,\n\tIBMVFC_WRITE\t\t= 0x0008,\n\tIBMVFC_TMF\t\t\t= 0x0080,\n\tIBMVFC_CLASS_3_ERR\t= 0x0100,\n};\n\nenum ibmvfc_fc_task_attr {\n\tIBMVFC_SIMPLE_TASK\t= 0x00,\n\tIBMVFC_HEAD_OF_QUEUE\t= 0x01,\n\tIBMVFC_ORDERED_TASK\t= 0x02,\n\tIBMVFC_ACA_TASK\t\t= 0x04,\n};\n\nenum ibmvfc_fc_tmf_flags {\n\tIBMVFC_ABORT_TASK_SET\t= 0x02,\n\tIBMVFC_LUN_RESET\t\t= 0x10,\n\tIBMVFC_TARGET_RESET\t= 0x20,\n};\n\nstruct ibmvfc_fcp_cmd_iu {\n\tstruct scsi_lun lun;\n\tu8 crn;\n\tu8 pri_task_attr;\n\tu8 tmf_flags;\n\tu8 add_cdb_len;\n#define IBMVFC_RDDATA\t\t0x02\n#define IBMVFC_WRDATA\t\t0x01\n\tu8 cdb[IBMVFC_MAX_CDB_LEN];\n\t__be32 xfer_len;\n} __packed __aligned(4);\n\nstruct ibmvfc_cmd {\n\t__be64 task_tag;\n\t__be32 frame_type;\n\t__be32 payload_len;\n\t__be32 resp_len;\n\t__be32 adapter_resid;\n\t__be16 status;\n\t__be16 error;\n\t__be16 flags;\n\t__be16 response_flags;\n#define IBMVFC_ADAPTER_RESID_VALID\t0x01\n\t__be32 cancel_key;\n\t__be32 exchange_id;\n\tstruct srp_direct_buf ext_func;\n\tstruct srp_direct_buf ioba;\n\tstruct srp_direct_buf resp;\n\t__be64 correlation;\n\t__be64 tgt_scsi_id;\n\t__be64 tag;\n\t__be64 target_wwpn;\n\t__be64 reserved3;\n\tunion {\n\t\tstruct {\n\t\t\tstruct ibmvfc_fcp_cmd_iu iu;\n\t\t\tstruct ibmvfc_fcp_rsp rsp;\n\t\t} v1;\n\t\tstruct {\n\t\t\t__be64 reserved4;\n\t\t\tstruct ibmvfc_fcp_cmd_iu iu;\n\t\t\tstruct ibmvfc_fcp_rsp rsp;\n\t\t} v2;\n\t};\n} __packed __aligned(8);\n\nstruct ibmvfc_passthru_fc_iu {\n\t__be32 payload[7];\n#define IBMVFC_ADISC\t0x52000000\n\t__be32 response[7];\n};\n\nstruct ibmvfc_passthru_iu {\n\t__be64 task_tag;\n\t__be32 cmd_len;\n\t__be32 rsp_len;\n\t__be16 status;\n\t__be16 error;\n\t__be32 flags;\n#define IBMVFC_FC_ELS\t\t0x01\n#define IBMVFC_FC_CT_IU\t\t0x02\n\t__be32 cancel_key;\n#define IBMVFC_PASSTHRU_CANCEL_KEY\t0x80000000\n#define IBMVFC_INTERNAL_CANCEL_KEY\t0x80000001\n\t__be32 reserved;\n\tstruct srp_direct_buf cmd;\n\tstruct srp_direct_buf rsp;\n\t__be64 correlation;\n\t__be64 scsi_id;\n\t__be64 tag;\n\t__be64 target_wwpn;\n\t__be64 reserved2[2];\n} __packed __aligned(8);\n\nstruct ibmvfc_passthru_mad {\n\tstruct ibmvfc_mad_common common;\n\tstruct srp_direct_buf cmd_ioba;\n\tstruct ibmvfc_passthru_iu iu;\n\tstruct ibmvfc_passthru_fc_iu fc_iu;\n} __packed __aligned(8);\n\nstruct ibmvfc_channel_enquiry {\n\tstruct ibmvfc_mad_common common;\n\t__be32 flags;\n#define IBMVFC_NO_CHANNELS_TO_CRQ_SUPPORT\t0x01\n#define IBMVFC_SUPPORT_VARIABLE_SUBQ_MSG\t0x02\n#define IBMVFC_NO_N_TO_M_CHANNELS_SUPPORT\t0x04\n\t__be32 num_scsi_subq_channels;\n\t__be32 num_nvmeof_subq_channels;\n\t__be32 num_scsi_vas_channels;\n\t__be32 num_nvmeof_vas_channels;\n} __packed __aligned(8);\n\nstruct ibmvfc_channel_setup_mad {\n\tstruct ibmvfc_mad_common common;\n\tstruct srp_direct_buf buffer;\n} __packed __aligned(8);\n\n#define IBMVFC_MAX_CHANNELS\t502\n\nstruct ibmvfc_channel_setup {\n\t__be32 flags;\n#define IBMVFC_CANCEL_CHANNELS\t\t0x01\n#define IBMVFC_USE_BUFFER\t\t0x02\n#define IBMVFC_CHANNELS_CANCELED\t0x04\n\t__be32 reserved;\n\t__be32 num_scsi_subq_channels;\n\t__be32 num_nvmeof_subq_channels;\n\t__be32 num_scsi_vas_channels;\n\t__be32 num_nvmeof_vas_channels;\n\tstruct srp_direct_buf buffer;\n\t__be64 reserved2[5];\n\t__be64 channel_handles[IBMVFC_MAX_CHANNELS];\n} __packed __aligned(8);\n\nstruct ibmvfc_connection_info {\n\tstruct ibmvfc_mad_common common;\n\t__be64 information_bits;\n#define IBMVFC_NO_FC_IO_CHANNEL\t\t0x01\n#define IBMVFC_NO_PHYP_VAS\t\t0x02\n#define IBMVFC_NO_PHYP_SUBQ\t\t0x04\n#define IBMVFC_PHYP_DEPRECATED_SUBQ\t0x08\n#define IBMVFC_PHYP_PRESERVED_SUBQ\t0x10\n#define IBMVFC_PHYP_FULL_SUBQ\t\t0x20\n\t__be64 reserved[16];\n} __packed __aligned(8);\n\nstruct ibmvfc_trace_start_entry {\n\tu32 xfer_len;\n} __packed;\n\nstruct ibmvfc_trace_end_entry {\n\tu16 status;\n\tu16 error;\n\tu8 fcp_rsp_flags;\n\tu8 rsp_code;\n\tu8 scsi_status;\n\tu8 reserved;\n} __packed;\n\nstruct ibmvfc_trace_entry {\n\tstruct ibmvfc_event *evt;\n\tu32 time;\n\tu32 scsi_id;\n\tu32 lun;\n\tu8 fmt;\n\tu8 op_code;\n\tu8 tmf_flags;\n\tu8 type;\n#define IBMVFC_TRC_START\t0x00\n#define IBMVFC_TRC_END\t\t0xff\n\tunion {\n\t\tstruct ibmvfc_trace_start_entry start;\n\t\tstruct ibmvfc_trace_end_entry end;\n\t} u;\n} __packed __aligned(8);\n\nenum ibmvfc_crq_formats {\n\tIBMVFC_CMD_FORMAT\t\t= 0x01,\n\tIBMVFC_ASYNC_EVENT\t= 0x02,\n\tIBMVFC_MAD_FORMAT\t\t= 0x04,\n};\n\nenum ibmvfc_async_event {\n\tIBMVFC_AE_ELS_PLOGI\t\t= 0x0001,\n\tIBMVFC_AE_ELS_LOGO\t\t= 0x0002,\n\tIBMVFC_AE_ELS_PRLO\t\t= 0x0004,\n\tIBMVFC_AE_SCN_NPORT\t\t= 0x0008,\n\tIBMVFC_AE_SCN_GROUP\t\t= 0x0010,\n\tIBMVFC_AE_SCN_DOMAIN\t\t= 0x0020,\n\tIBMVFC_AE_SCN_FABRIC\t\t= 0x0040,\n\tIBMVFC_AE_LINK_UP\t\t\t= 0x0080,\n\tIBMVFC_AE_LINK_DOWN\t\t= 0x0100,\n\tIBMVFC_AE_LINK_DEAD\t\t= 0x0200,\n\tIBMVFC_AE_HALT\t\t\t= 0x0400,\n\tIBMVFC_AE_RESUME\t\t\t= 0x0800,\n\tIBMVFC_AE_ADAPTER_FAILED\t= 0x1000,\n\tIBMVFC_AE_FPIN\t\t\t= 0x2000,\n};\n\nstruct ibmvfc_async_desc {\n\tconst char *desc;\n\tenum ibmvfc_async_event ae;\n\tint log_level;\n};\n\nstruct ibmvfc_crq {\n\tvolatile u8 valid;\n\tvolatile u8 format;\n\tu8 reserved[6];\n\tvolatile __be64 ioba;\n} __packed __aligned(8);\n\nstruct ibmvfc_sub_crq {\n\tstruct ibmvfc_crq crq;\n\t__be64 reserved[2];\n} __packed __aligned(8);\n\nenum ibmvfc_ae_link_state {\n\tIBMVFC_AE_LS_LINK_UP\t\t= 0x01,\n\tIBMVFC_AE_LS_LINK_BOUNCED\t= 0x02,\n\tIBMVFC_AE_LS_LINK_DOWN\t\t= 0x04,\n\tIBMVFC_AE_LS_LINK_DEAD\t\t= 0x08,\n};\n\nenum ibmvfc_ae_fpin_status {\n\tIBMVFC_AE_FPIN_LINK_CONGESTED\t= 0x1,\n\tIBMVFC_AE_FPIN_PORT_CONGESTED\t= 0x2,\n\tIBMVFC_AE_FPIN_PORT_CLEARED\t= 0x3,\n\tIBMVFC_AE_FPIN_PORT_DEGRADED\t= 0x4,\n};\n\nstruct ibmvfc_async_crq {\n\tvolatile u8 valid;\n\tu8 link_state;\n\tu8 fpin_status;\n\tu8 pad;\n\t__be32 pad2;\n\tvolatile __be64 event;\n\tvolatile __be64 scsi_id;\n\tvolatile __be64 wwpn;\n\tvolatile __be64 node_name;\n\t__be64 reserved;\n} __packed __aligned(8);\n\nunion ibmvfc_iu {\n\tstruct ibmvfc_mad_common mad_common;\n\tstruct ibmvfc_npiv_login_mad npiv_login;\n\tstruct ibmvfc_npiv_logout_mad npiv_logout;\n\tstruct ibmvfc_discover_targets discover_targets;\n\tstruct ibmvfc_port_login plogi;\n\tstruct ibmvfc_process_login prli;\n\tstruct ibmvfc_move_login move_login;\n\tstruct ibmvfc_query_tgt query_tgt;\n\tstruct ibmvfc_implicit_logout implicit_logout;\n\tstruct ibmvfc_tmf tmf;\n\tstruct ibmvfc_cmd cmd;\n\tstruct ibmvfc_passthru_mad passthru;\n\tstruct ibmvfc_channel_enquiry channel_enquiry;\n\tstruct ibmvfc_channel_setup_mad channel_setup;\n\tstruct ibmvfc_connection_info connection_info;\n} __packed __aligned(8);\n\nenum ibmvfc_target_action {\n\tIBMVFC_TGT_ACTION_NONE = 0,\n\tIBMVFC_TGT_ACTION_INIT,\n\tIBMVFC_TGT_ACTION_INIT_WAIT,\n\tIBMVFC_TGT_ACTION_LOGOUT_RPORT,\n\tIBMVFC_TGT_ACTION_LOGOUT_RPORT_WAIT,\n\tIBMVFC_TGT_ACTION_DEL_RPORT,\n\tIBMVFC_TGT_ACTION_DELETED_RPORT,\n\tIBMVFC_TGT_ACTION_DEL_AND_LOGOUT_RPORT,\n\tIBMVFC_TGT_ACTION_LOGOUT_DELETED_RPORT,\n};\n\nstruct ibmvfc_target {\n\tstruct list_head queue;\n\tstruct ibmvfc_host *vhost;\n\tu64 scsi_id;\n\tu64 wwpn;\n\tu64 new_scsi_id;\n\tstruct fc_rport *rport;\n\tint target_id;\n\tenum ibmvfc_target_action action;\n\tint need_login;\n\tint add_rport;\n\tint init_retries;\n\tint logo_rcvd;\n\tint move_login;\n\tu32 cancel_key;\n\tstruct ibmvfc_service_parms service_parms;\n\tstruct ibmvfc_service_parms service_parms_change;\n\tstruct fc_rport_identifiers ids;\n\tvoid (*job_step) (struct ibmvfc_target *);\n\tstruct timer_list timer;\n\tstruct kref kref;\n};\n\n \nstruct ibmvfc_event {\n\tstruct list_head queue_list;\n\tstruct list_head cancel;\n\tstruct ibmvfc_host *vhost;\n\tstruct ibmvfc_queue *queue;\n\tstruct ibmvfc_target *tgt;\n\tstruct scsi_cmnd *cmnd;\n\tatomic_t free;\n\tatomic_t active;\n\tunion ibmvfc_iu *xfer_iu;\n\tvoid (*done)(struct ibmvfc_event *evt);\n\tvoid (*_done)(struct ibmvfc_event *evt);\n\tstruct ibmvfc_crq crq;\n\tunion ibmvfc_iu iu;\n\tunion ibmvfc_iu *sync_iu;\n\tstruct srp_direct_buf *ext_list;\n\tdma_addr_t ext_list_token;\n\tstruct completion comp;\n\tstruct completion *eh_comp;\n\tstruct timer_list timer;\n\tu16 hwq;\n};\n\n \nstruct ibmvfc_event_pool {\n\tstruct ibmvfc_event *events;\n\tu32 size;\n\tunion ibmvfc_iu *iu_storage;\n\tdma_addr_t iu_token;\n};\n\nenum ibmvfc_msg_fmt {\n\tIBMVFC_CRQ_FMT = 0,\n\tIBMVFC_ASYNC_FMT,\n\tIBMVFC_SUB_CRQ_FMT,\n};\n\nunion ibmvfc_msgs {\n\tvoid *handle;\n\tstruct ibmvfc_crq *crq;\n\tstruct ibmvfc_async_crq *async;\n\tstruct ibmvfc_sub_crq *scrq;\n};\n\nstruct ibmvfc_queue {\n\tunion ibmvfc_msgs msgs;\n\tdma_addr_t msg_token;\n\tenum ibmvfc_msg_fmt fmt;\n\tint size, cur;\n\tspinlock_t _lock;\n\tspinlock_t *q_lock;\n\n\tstruct ibmvfc_host *vhost;\n\tstruct ibmvfc_event_pool evt_pool;\n\tstruct list_head sent;\n\tstruct list_head free;\n\tspinlock_t l_lock;\n\n\tunion ibmvfc_iu cancel_rsp;\n\n\t \n\tunsigned long cookie;\n\tunsigned long vios_cookie;\n\tunsigned long hw_irq;\n\tunsigned long irq;\n\tunsigned long hwq_id;\n\tchar name[32];\n};\n\nstruct ibmvfc_scsi_channels {\n\tstruct ibmvfc_queue *scrqs;\n\tunsigned int active_queues;\n};\n\nenum ibmvfc_host_action {\n\tIBMVFC_HOST_ACTION_NONE = 0,\n\tIBMVFC_HOST_ACTION_RESET,\n\tIBMVFC_HOST_ACTION_REENABLE,\n\tIBMVFC_HOST_ACTION_LOGO,\n\tIBMVFC_HOST_ACTION_LOGO_WAIT,\n\tIBMVFC_HOST_ACTION_INIT,\n\tIBMVFC_HOST_ACTION_INIT_WAIT,\n\tIBMVFC_HOST_ACTION_QUERY,\n\tIBMVFC_HOST_ACTION_QUERY_TGTS,\n\tIBMVFC_HOST_ACTION_TGT_DEL,\n\tIBMVFC_HOST_ACTION_ALLOC_TGTS,\n\tIBMVFC_HOST_ACTION_TGT_INIT,\n\tIBMVFC_HOST_ACTION_TGT_DEL_FAILED,\n};\n\nenum ibmvfc_host_state {\n\tIBMVFC_NO_CRQ = 0,\n\tIBMVFC_INITIALIZING,\n\tIBMVFC_ACTIVE,\n\tIBMVFC_HALTED,\n\tIBMVFC_LINK_DOWN,\n\tIBMVFC_LINK_DEAD,\n\tIBMVFC_HOST_OFFLINE,\n};\n\nstruct ibmvfc_host {\n\tchar name[8];\n\tstruct list_head queue;\n\tstruct Scsi_Host *host;\n\tenum ibmvfc_host_state state;\n\tenum ibmvfc_host_action action;\n#define IBMVFC_NUM_TRACE_INDEX_BITS\t\t8\n#define IBMVFC_NUM_TRACE_ENTRIES\t\t(1 << IBMVFC_NUM_TRACE_INDEX_BITS)\n#define IBMVFC_TRACE_INDEX_MASK\t\t\t(IBMVFC_NUM_TRACE_ENTRIES - 1)\n#define IBMVFC_TRACE_SIZE\t(sizeof(struct ibmvfc_trace_entry) * IBMVFC_NUM_TRACE_ENTRIES)\n\tstruct ibmvfc_trace_entry *trace;\n\tatomic_t trace_index;\n\tint num_targets;\n\tstruct list_head targets;\n\tstruct list_head purge;\n\tstruct device *dev;\n\tstruct dma_pool *sg_pool;\n\tmempool_t *tgt_pool;\n\tstruct ibmvfc_queue crq;\n\tstruct ibmvfc_queue async_crq;\n\tstruct ibmvfc_scsi_channels scsi_scrqs;\n\tstruct ibmvfc_npiv_login login_info;\n\tunion ibmvfc_npiv_login_data *login_buf;\n\tdma_addr_t login_buf_dma;\n\tstruct ibmvfc_channel_setup *channel_setup_buf;\n\tdma_addr_t channel_setup_dma;\n\tint disc_buf_sz;\n\tint log_level;\n\tstruct ibmvfc_discover_targets_entry *disc_buf;\n\tstruct mutex passthru_mutex;\n\tint max_vios_scsi_channels;\n\tint task_set;\n\tint init_retries;\n\tint discovery_threads;\n\tint abort_threads;\n\tint client_migrated;\n\tint reinit;\n\tint delay_init;\n\tint scan_complete;\n\tint scan_timeout;\n\tint logged_in;\n\tint mq_enabled;\n\tint using_channels;\n\tint do_enquiry;\n\tint client_scsi_channels;\n\tint aborting_passthru;\n\tint events_to_log;\n#define IBMVFC_AE_LINKUP\t0x0001\n#define IBMVFC_AE_LINKDOWN\t0x0002\n#define IBMVFC_AE_RSCN\t\t0x0004\n\tdma_addr_t disc_buf_dma;\n\tunsigned int partition_number;\n\tchar partition_name[97];\n\tvoid (*job_step) (struct ibmvfc_host *);\n\tstruct task_struct *work_thread;\n\tstruct tasklet_struct tasklet;\n\tstruct work_struct rport_add_work_q;\n\twait_queue_head_t init_wait_q;\n\twait_queue_head_t work_wait_q;\n};\n\n#define DBG_CMD(CMD) do { if (ibmvfc_debug) CMD; } while (0)\n\n#define tgt_dbg(t, fmt, ...)\t\t\t\\\n\tDBG_CMD(dev_info((t)->vhost->dev, \"%llX: \" fmt, (t)->scsi_id, ##__VA_ARGS__))\n\n#define tgt_info(t, fmt, ...)\t\t\\\n\tdev_info((t)->vhost->dev, \"%llX: \" fmt, (t)->scsi_id, ##__VA_ARGS__)\n\n#define tgt_err(t, fmt, ...)\t\t\\\n\tdev_err((t)->vhost->dev, \"%llX: \" fmt, (t)->scsi_id, ##__VA_ARGS__)\n\n#define tgt_log(t, level, fmt, ...) \\\n\tdo { \\\n\t\tif ((t)->vhost->log_level >= level) \\\n\t\t\ttgt_err(t, fmt, ##__VA_ARGS__); \\\n\t} while (0)\n\n#define ibmvfc_dbg(vhost, ...) \\\n\tDBG_CMD(dev_info((vhost)->dev, ##__VA_ARGS__))\n\n#define ibmvfc_log(vhost, level, ...) \\\n\tdo { \\\n\t\tif ((vhost)->log_level >= level) \\\n\t\t\tdev_err((vhost)->dev, ##__VA_ARGS__); \\\n\t} while (0)\n\n#define ENTER DBG_CMD(printk(KERN_INFO IBMVFC_NAME\": Entering %s\\n\", __func__))\n#define LEAVE DBG_CMD(printk(KERN_INFO IBMVFC_NAME\": Leaving %s\\n\", __func__))\n\n#ifdef CONFIG_SCSI_IBMVFC_TRACE\n#define ibmvfc_create_trace_file(kobj, attr) sysfs_create_bin_file(kobj, attr)\n#define ibmvfc_remove_trace_file(kobj, attr) sysfs_remove_bin_file(kobj, attr)\n#else\n#define ibmvfc_create_trace_file(kobj, attr) 0\n#define ibmvfc_remove_trace_file(kobj, attr) do { } while (0)\n#endif\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}