{
  "module_name": "a4000t.c",
  "hash_id": "7111c857f885c792810bf43e95afc161e26a7868aa8fe4f2362ffb14173ff020",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/a4000t.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/init.h>\n#include <linux/interrupt.h>\n#include <linux/slab.h>\n#include <asm/amigahw.h>\n#include <asm/amigaints.h>\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_transport_spi.h>\n\n#include \"53c700.h\"\n\n\nstatic struct scsi_host_template a4000t_scsi_driver_template = {\n\t.name\t\t= \"A4000T builtin SCSI\",\n\t.proc_name\t= \"A4000t\",\n\t.this_id\t= 7,\n\t.module\t\t= THIS_MODULE,\n};\n\n\n#define A4000T_SCSI_OFFSET\t0x40\n\nstatic int __init amiga_a4000t_scsi_probe(struct platform_device *pdev)\n{\n\tstruct resource *res;\n\tphys_addr_t scsi_addr;\n\tstruct NCR_700_Host_Parameters *hostdata;\n\tstruct Scsi_Host *host;\n\n\tres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\tif (!res)\n\t\treturn -ENODEV;\n\n\tif (!request_mem_region(res->start, resource_size(res),\n\t\t\t\t\"A4000T builtin SCSI\"))\n\t\treturn -EBUSY;\n\n\thostdata = kzalloc(sizeof(struct NCR_700_Host_Parameters),\n\t\t\t   GFP_KERNEL);\n\tif (!hostdata) {\n\t\tdev_err(&pdev->dev, \"Failed to allocate host data\\n\");\n\t\tgoto out_release;\n\t}\n\n\tscsi_addr = res->start + A4000T_SCSI_OFFSET;\n\n\t \n\thostdata->base = ZTWO_VADDR(scsi_addr);\n\thostdata->clock = 50;\n\thostdata->chip710 = 1;\n\thostdata->dmode_extra = DMODE_FC2;\n\thostdata->dcntl_extra = EA_710;\n\n\t \n\thost = NCR_700_detect(&a4000t_scsi_driver_template, hostdata,\n\t\t\t      &pdev->dev);\n\tif (!host) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"No host detected; board configuration problem?\\n\");\n\t\tgoto out_free;\n\t}\n\n\thost->this_id = 7;\n\thost->base = scsi_addr;\n\thost->irq = IRQ_AMIGA_PORTS;\n\n\tif (request_irq(host->irq, NCR_700_intr, IRQF_SHARED, \"a4000t-scsi\",\n\t\t\thost)) {\n\t\tdev_err(&pdev->dev, \"request_irq failed\\n\");\n\t\tgoto out_put_host;\n\t}\n\n\tplatform_set_drvdata(pdev, host);\n\tscsi_scan_host(host);\n\treturn 0;\n\n out_put_host:\n\tscsi_host_put(host);\n out_free:\n\tkfree(hostdata);\n out_release:\n\trelease_mem_region(res->start, resource_size(res));\n\treturn -ENODEV;\n}\n\nstatic int __exit amiga_a4000t_scsi_remove(struct platform_device *pdev)\n{\n\tstruct Scsi_Host *host = platform_get_drvdata(pdev);\n\tstruct NCR_700_Host_Parameters *hostdata = shost_priv(host);\n\tstruct resource *res = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\n\tscsi_remove_host(host);\n\tNCR_700_release(host);\n\tkfree(hostdata);\n\tfree_irq(host->irq, host);\n\trelease_mem_region(res->start, resource_size(res));\n\treturn 0;\n}\n\nstatic struct platform_driver amiga_a4000t_scsi_driver = {\n\t.remove = __exit_p(amiga_a4000t_scsi_remove),\n\t.driver   = {\n\t\t.name\t= \"amiga-a4000t-scsi\",\n\t},\n};\n\nmodule_platform_driver_probe(amiga_a4000t_scsi_driver, amiga_a4000t_scsi_probe);\n\nMODULE_AUTHOR(\"Alan Hourihane <alanh@fairlite.demon.co.uk> / \"\n\t      \"Kars de Jong <jongk@linux-m68k.org>\");\nMODULE_DESCRIPTION(\"Amiga A4000T NCR53C710 driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:amiga-a4000t-scsi\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}