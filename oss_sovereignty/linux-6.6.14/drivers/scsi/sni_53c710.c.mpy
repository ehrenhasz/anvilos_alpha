{
  "module_name": "sni_53c710.c",
  "hash_id": "cee13c59a03b8a350b13343c90d3330dffc3ef043b7ba2efc97e1d364eba37d9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/sni_53c710.c",
  "human_readable_source": "\n\n \n\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/types.h>\n#include <linux/slab.h>\n#include <linux/stat.h>\n#include <linux/mm.h>\n#include <linux/blkdev.h>\n#include <linux/sched.h>\n#include <linux/ioport.h>\n#include <linux/dma-mapping.h>\n#include <linux/platform_device.h>\n\n#include <asm/page.h>\n#include <asm/irq.h>\n#include <asm/delay.h>\n\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_device.h>\n#include <scsi/scsi_transport.h>\n#include <scsi/scsi_transport_spi.h>\n\n#include \"53c700.h\"\n\nMODULE_AUTHOR(\"Thomas Bogend\u00f6rfer\");\nMODULE_DESCRIPTION(\"SNI RM 53c710 SCSI Driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:snirm_53c710\");\n\n#define SNIRM710_CLOCK\t32\n\nstatic struct scsi_host_template snirm710_template = {\n\t.name\t\t= \"SNI RM SCSI 53c710\",\n\t.proc_name\t= \"snirm_53c710\",\n\t.this_id\t= 7,\n\t.module\t\t= THIS_MODULE,\n};\n\nstatic int snirm710_probe(struct platform_device *dev)\n{\n\tunsigned long base;\n\tstruct NCR_700_Host_Parameters *hostdata;\n\tstruct Scsi_Host *host;\n\tstruct  resource *res;\n\tint rc;\n\n\tres = platform_get_resource(dev, IORESOURCE_MEM, 0);\n\tif (!res)\n\t\treturn -ENODEV;\n\n\tbase = res->start;\n\thostdata = kzalloc(sizeof(*hostdata), GFP_KERNEL);\n\tif (!hostdata)\n\t\treturn -ENOMEM;\n\n\thostdata->dev = &dev->dev;\n\tdma_set_mask(&dev->dev, DMA_BIT_MASK(32));\n\thostdata->base = ioremap(base, 0x100);\n\thostdata->differential = 0;\n\n\thostdata->clock = SNIRM710_CLOCK;\n\thostdata->force_le_on_be = 1;\n\thostdata->chip710 = 1;\n\thostdata->burst_length = 4;\n\n\thost = NCR_700_detect(&snirm710_template, hostdata, &dev->dev);\n\tif (!host)\n\t\tgoto out_kfree;\n\thost->this_id = 7;\n\thost->base = base;\n\thost->irq = rc = platform_get_irq(dev, 0);\n\tif (rc < 0)\n\t\tgoto out_put_host;\n\tif(request_irq(host->irq, NCR_700_intr, IRQF_SHARED, \"snirm710\", host)) {\n\t\tprintk(KERN_ERR \"snirm710: request_irq failed!\\n\");\n\t\tgoto out_put_host;\n\t}\n\n\tdev_set_drvdata(&dev->dev, host);\n\tscsi_scan_host(host);\n\n\treturn 0;\n\n out_put_host:\n\tscsi_host_put(host);\n out_kfree:\n\tiounmap(hostdata->base);\n\tkfree(hostdata);\n\treturn -ENODEV;\n}\n\nstatic int snirm710_driver_remove(struct platform_device *dev)\n{\n\tstruct Scsi_Host *host = dev_get_drvdata(&dev->dev);\n\tstruct NCR_700_Host_Parameters *hostdata =\n\t\t(struct NCR_700_Host_Parameters *)host->hostdata[0];\n\n\tscsi_remove_host(host);\n\tNCR_700_release(host);\n\tfree_irq(host->irq, host);\n\tiounmap(hostdata->base);\n\tkfree(hostdata);\n\n\treturn 0;\n}\n\nstatic struct platform_driver snirm710_driver = {\n\t.probe\t= snirm710_probe,\n\t.remove\t= snirm710_driver_remove,\n\t.driver\t= {\n\t\t.name\t= \"snirm_53c710\",\n\t},\n};\nmodule_platform_driver(snirm710_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}