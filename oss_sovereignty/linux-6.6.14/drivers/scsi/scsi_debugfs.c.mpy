{
  "module_name": "scsi_debugfs.c",
  "hash_id": "0388dc0b4b400981b48b4f6018857418f30ac3fe9890a408a2872b21cba851e0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/scsi_debugfs.c",
  "human_readable_source": "\n#include <linux/bitops.h>\n#include <linux/seq_file.h>\n#include <scsi/scsi_cmnd.h>\n#include <scsi/scsi_dbg.h>\n#include <scsi/scsi_host.h>\n#include \"scsi_debugfs.h\"\n\n#define SCSI_CMD_FLAG_NAME(name)[const_ilog2(SCMD_##name)] = #name\nstatic const char *const scsi_cmd_flags[] = {\n\tSCSI_CMD_FLAG_NAME(TAGGED),\n\tSCSI_CMD_FLAG_NAME(INITIALIZED),\n\tSCSI_CMD_FLAG_NAME(LAST),\n};\n#undef SCSI_CMD_FLAG_NAME\n\nstatic int scsi_flags_show(struct seq_file *m, const unsigned long flags,\n\t\t\t   const char *const *flag_name, int flag_name_count)\n{\n\tbool sep = false;\n\tint i;\n\n\tfor_each_set_bit(i, &flags, BITS_PER_LONG) {\n\t\tif (sep)\n\t\t\tseq_puts(m, \"|\");\n\t\tsep = true;\n\t\tif (i < flag_name_count && flag_name[i])\n\t\t\tseq_puts(m, flag_name[i]);\n\t\telse\n\t\t\tseq_printf(m, \"%d\", i);\n\t}\n\treturn 0;\n}\n\nvoid scsi_show_rq(struct seq_file *m, struct request *rq)\n{\n\tstruct scsi_cmnd *cmd = blk_mq_rq_to_pdu(rq), *cmd2;\n\tstruct Scsi_Host *shost = cmd->device->host;\n\tint alloc_ms = jiffies_to_msecs(jiffies - cmd->jiffies_at_alloc);\n\tint timeout_ms = jiffies_to_msecs(rq->timeout);\n\tconst char *list_info = NULL;\n\tchar buf[80] = \"(?)\";\n\n\tspin_lock_irq(shost->host_lock);\n\tlist_for_each_entry(cmd2, &shost->eh_abort_list, eh_entry) {\n\t\tif (cmd == cmd2) {\n\t\t\tlist_info = \"on eh_abort_list\";\n\t\t\tgoto unlock;\n\t\t}\n\t}\n\tlist_for_each_entry(cmd2, &shost->eh_cmd_q, eh_entry) {\n\t\tif (cmd == cmd2) {\n\t\t\tlist_info = \"on eh_cmd_q\";\n\t\t\tgoto unlock;\n\t\t}\n\t}\nunlock:\n\tspin_unlock_irq(shost->host_lock);\n\n\t__scsi_format_command(buf, sizeof(buf), cmd->cmnd, cmd->cmd_len);\n\tseq_printf(m, \", .cmd=%s, .retries=%d, .allowed=%d, .result = %#x, %s%s.flags=\",\n\t\t   buf, cmd->retries, cmd->allowed, cmd->result,\n\t\t   list_info ? : \"\", list_info ? \", \" : \"\");\n\tscsi_flags_show(m, cmd->flags, scsi_cmd_flags,\n\t\t\tARRAY_SIZE(scsi_cmd_flags));\n\tseq_printf(m, \", .timeout=%d.%03d, allocated %d.%03d s ago\",\n\t\t   timeout_ms / 1000, timeout_ms % 1000,\n\t\t   alloc_ms / 1000, alloc_ms % 1000);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}