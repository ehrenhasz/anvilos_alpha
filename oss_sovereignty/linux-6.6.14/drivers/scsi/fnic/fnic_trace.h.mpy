{
  "module_name": "fnic_trace.h",
  "hash_id": "a98a7904e55b6a2b3f589d7469cf4d107298c5880adfaa259c658aa13a395011",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/fnic/fnic_trace.h",
  "human_readable_source": " \n \n\n#ifndef __FNIC_TRACE_H__\n#define __FNIC_TRACE_H__\n\n#define FNIC_ENTRY_SIZE_BYTES 64\n#define FC_TRC_SIZE_BYTES 256\n#define FC_TRC_HEADER_SIZE sizeof(struct fc_trace_hdr)\n\n \n\n#define FNIC_FC_RECV 0x52  \n#define FNIC_FC_SEND 0x54  \n#define FNIC_FC_LE 0x4C  \n\nextern ssize_t simple_read_from_buffer(void __user *to,\n\t\t\t\t\t  size_t count,\n\t\t\t\t\t  loff_t *ppos,\n\t\t\t\t\t  const void *from,\n\t\t\t\t\t  size_t available);\n\nextern unsigned int fnic_trace_max_pages;\nextern int fnic_tracing_enabled;\nextern unsigned int trace_max_pages;\n\nextern unsigned int fnic_fc_trace_max_pages;\nextern int fnic_fc_tracing_enabled;\nextern int fnic_fc_trace_cleared;\n\ntypedef struct fnic_trace_dbg {\n\tint wr_idx;\n\tint rd_idx;\n\tunsigned long *page_offset;\n} fnic_trace_dbg_t;\n\ntypedef struct fnic_dbgfs {\n\tint buffer_len;\n\tchar *buffer;\n} fnic_dbgfs_t;\n\nstruct fnic_trace_data {\n\tunion {\n\t\tstruct {\n\t\t\tu32 low;\n\t\t\tu32 high;\n\t\t};\n\t\tu64 val;\n\t} timestamp, fnaddr;\n\tu32 host_no;\n\tu32 tag;\n\tu64 data[5];\n} __attribute__((__packed__));\n\ntypedef struct fnic_trace_data fnic_trace_data_t;\n\nstruct fc_trace_hdr {\n\tstruct timespec64 time_stamp;\n\tu32 host_no;\n\tu8 frame_type;\n\tu8 frame_len;\n} __attribute__((__packed__));\n\n#define FC_TRACE_ADDRESS(a) \\\n\t((unsigned long)(a) + sizeof(struct fc_trace_hdr))\n\n#define FNIC_TRACE_ENTRY_SIZE \\\n\t\t  (FNIC_ENTRY_SIZE_BYTES - sizeof(fnic_trace_data_t))\n\n#define FNIC_TRACE(_fn, _hn, _t, _a, _b, _c, _d, _e)           \\\n\tif (unlikely(fnic_tracing_enabled)) {                   \\\n\t\tfnic_trace_data_t *trace_buf = fnic_trace_get_buf(); \\\n\t\tif (trace_buf) { \\\n\t\t\tif (sizeof(unsigned long) < 8) { \\\n\t\t\t\ttrace_buf->timestamp.low = jiffies; \\\n\t\t\t\ttrace_buf->fnaddr.low = (u32)(unsigned long)_fn; \\\n\t\t\t} else { \\\n\t\t\t\ttrace_buf->timestamp.val = jiffies; \\\n\t\t\t\ttrace_buf->fnaddr.val = (u64)(unsigned long)_fn; \\\n\t\t\t} \\\n\t\t\ttrace_buf->host_no = _hn; \\\n\t\t\ttrace_buf->tag = _t; \\\n\t\t\ttrace_buf->data[0] = (u64)(unsigned long)_a; \\\n\t\t\ttrace_buf->data[1] = (u64)(unsigned long)_b; \\\n\t\t\ttrace_buf->data[2] = (u64)(unsigned long)_c; \\\n\t\t\ttrace_buf->data[3] = (u64)(unsigned long)_d; \\\n\t\t\ttrace_buf->data[4] = (u64)(unsigned long)_e; \\\n\t\t} \\\n\t}\n\nfnic_trace_data_t *fnic_trace_get_buf(void);\nint fnic_get_trace_data(fnic_dbgfs_t *);\nint fnic_trace_buf_init(void);\nvoid fnic_trace_free(void);\nint fnic_debugfs_init(void);\nvoid fnic_debugfs_terminate(void);\nvoid fnic_trace_debugfs_init(void);\nvoid fnic_trace_debugfs_terminate(void);\n\n \nint fnic_fc_trace_init(void);\nvoid fnic_fc_trace_free(void);\nint fnic_fc_trace_set_data(u32 host_no, u8 frame_type,\n\t\t\t\tchar *frame, u32 fc_frame_len);\nint fnic_fc_trace_get_data(fnic_dbgfs_t *fnic_dbgfs_prt, u8 rdata_flag);\nvoid copy_and_format_trace_data(struct fc_trace_hdr *tdata,\n\t\t\t\tfnic_dbgfs_t *fnic_dbgfs_prt,\n\t\t\t\tint *len, u8 rdata_flag);\nvoid fnic_fc_trace_debugfs_init(void);\nvoid fnic_fc_trace_debugfs_terminate(void);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}