{
  "module_name": "fnic_res.h",
  "hash_id": "dfd3868d5b88e427dac40d928c938bd3b10903af31ca125a92fac567c839e004",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/fnic/fnic_res.h",
  "human_readable_source": " \n \n#ifndef _FNIC_RES_H_\n#define _FNIC_RES_H_\n\n#include \"wq_enet_desc.h\"\n#include \"rq_enet_desc.h\"\n#include \"vnic_wq.h\"\n#include \"vnic_rq.h\"\n#include \"fnic_io.h\"\n#include \"fcpio.h\"\n#include \"vnic_wq_copy.h\"\n#include \"vnic_cq_copy.h\"\n\nstatic inline void fnic_queue_wq_desc(struct vnic_wq *wq,\n\t\t\t\t      void *os_buf, dma_addr_t dma_addr,\n\t\t\t\t      unsigned int len, unsigned int fc_eof,\n\t\t\t\t      int vlan_tag_insert,\n\t\t\t\t      unsigned int vlan_tag,\n\t\t\t\t      int cq_entry, int sop, int eop)\n{\n\tstruct wq_enet_desc *desc = vnic_wq_next_desc(wq);\n\n\twq_enet_desc_enc(desc,\n\t\t\t (u64)dma_addr | VNIC_PADDR_TARGET,\n\t\t\t (u16)len,\n\t\t\t 0,  \n\t\t\t (u16)fc_eof,\n\t\t\t 0,  \n\t\t\t (u8)eop, (u8)cq_entry,\n\t\t\t 1,  \n\t\t\t (u8)vlan_tag_insert,\n\t\t\t (u16)vlan_tag,\n\t\t\t 0  );\n\n\tvnic_wq_post(wq, os_buf, dma_addr, len, sop, eop);\n}\n\nstatic inline void fnic_queue_wq_eth_desc(struct vnic_wq *wq,\n\t\t\t\t      void *os_buf, dma_addr_t dma_addr,\n\t\t\t\t      unsigned int len,\n\t\t\t\t      int vlan_tag_insert,\n\t\t\t\t      unsigned int vlan_tag,\n\t\t\t\t      int cq_entry)\n{\n\tstruct wq_enet_desc *desc = vnic_wq_next_desc(wq);\n\n\twq_enet_desc_enc(desc,\n\t\t\t (u64)dma_addr | VNIC_PADDR_TARGET,\n\t\t\t (u16)len,\n\t\t\t 0,  \n\t\t\t 0,  \n\t\t\t 0,  \n\t\t\t 1,  \n\t\t\t (u8)cq_entry,\n\t\t\t 0,  \n\t\t\t (u8)vlan_tag_insert,\n\t\t\t (u16)vlan_tag,\n\t\t\t 0  );\n\n\tvnic_wq_post(wq, os_buf, dma_addr, len, 1, 1);\n}\n\nstatic inline void fnic_queue_wq_copy_desc_icmnd_16(struct vnic_wq_copy *wq,\n\t\t\t\t\t\t    u32 req_id,\n\t\t\t\t\t\t    u32 lunmap_id, u8 spl_flags,\n\t\t\t\t\t\t    u32 sgl_cnt, u32 sense_len,\n\t\t\t\t\t\t    u64 sgl_addr, u64 sns_addr,\n\t\t\t\t\t\t    u8 crn, u8 pri_ta,\n\t\t\t\t\t\t    u8 flags, u8 *scsi_cdb,\n\t\t\t\t\t\t    u8 cdb_len,\n\t\t\t\t\t\t    u32 data_len, u8 *lun,\n\t\t\t\t\t\t    u32 d_id, u16 mss,\n\t\t\t\t\t\t    u32 ratov, u32 edtov)\n{\n\tstruct fcpio_host_req *desc = vnic_wq_copy_next_desc(wq);\n\n\tdesc->hdr.type = FCPIO_ICMND_16;  \n\tdesc->hdr.status = 0;             \n\tdesc->hdr._resvd = 0;             \n\tdesc->hdr.tag.u.req_id = req_id;  \n\n\tdesc->u.icmnd_16.lunmap_id = lunmap_id;  \n\tdesc->u.icmnd_16.special_req_flags = spl_flags;  \n\tdesc->u.icmnd_16._resvd0[0] = 0;         \n\tdesc->u.icmnd_16._resvd0[1] = 0;         \n\tdesc->u.icmnd_16._resvd0[2] = 0;         \n\tdesc->u.icmnd_16.sgl_cnt = sgl_cnt;      \n\tdesc->u.icmnd_16.sense_len = sense_len;  \n\tdesc->u.icmnd_16.sgl_addr = sgl_addr;    \n\tdesc->u.icmnd_16.sense_addr = sns_addr;  \n\tdesc->u.icmnd_16.crn = crn;              \n\tdesc->u.icmnd_16.pri_ta = pri_ta; \t \n\tdesc->u.icmnd_16._resvd1 = 0;            \n\tdesc->u.icmnd_16.flags = flags;          \n\tmemset(desc->u.icmnd_16.scsi_cdb, 0, CDB_16);\n\tmemcpy(desc->u.icmnd_16.scsi_cdb, scsi_cdb, cdb_len);     \n\tdesc->u.icmnd_16.data_len = data_len;    \n\tmemcpy(desc->u.icmnd_16.lun, lun, LUN_ADDRESS);   \n\tdesc->u.icmnd_16._resvd2 = 0;          \t \n\thton24(desc->u.icmnd_16.d_id, d_id);\t \n\tdesc->u.icmnd_16.mss = mss;            \t \n\tdesc->u.icmnd_16.r_a_tov = ratov;  \n\tdesc->u.icmnd_16.e_d_tov = edtov;  \n\n\tvnic_wq_copy_post(wq);\n}\n\nstatic inline void fnic_queue_wq_copy_desc_itmf(struct vnic_wq_copy *wq,\n\t\t\t\t\t\tu32 req_id, u32 lunmap_id,\n\t\t\t\t\t\tu32 tm_req, u32 tm_id, u8 *lun,\n\t\t\t\t\t\tu32 d_id, u32 r_a_tov,\n\t\t\t\t\t\tu32 e_d_tov)\n{\n\tstruct fcpio_host_req *desc = vnic_wq_copy_next_desc(wq);\n\n\tdesc->hdr.type = FCPIO_ITMF;      \n\tdesc->hdr.status = 0;             \n\tdesc->hdr._resvd = 0;             \n\tdesc->hdr.tag.u.req_id = req_id;  \n\n\tdesc->u.itmf.lunmap_id = lunmap_id;  \n\tdesc->u.itmf.tm_req = tm_req;        \n\tdesc->u.itmf.t_tag = tm_id;          \n\tdesc->u.itmf._resvd = 0;\n\tmemcpy(desc->u.itmf.lun, lun, LUN_ADDRESS);   \n\tdesc->u.itmf._resvd1 = 0;\n\thton24(desc->u.itmf.d_id, d_id);     \n\tdesc->u.itmf.r_a_tov = r_a_tov;      \n\tdesc->u.itmf.e_d_tov = e_d_tov;      \n\n\tvnic_wq_copy_post(wq);\n}\n\nstatic inline void fnic_queue_wq_copy_desc_flogi_reg(struct vnic_wq_copy *wq,\n\t\t\t\t\t\t     u32 req_id, u8 format,\n\t\t\t\t\t\t     u32 s_id, u8 *gw_mac)\n{\n\tstruct fcpio_host_req *desc = vnic_wq_copy_next_desc(wq);\n\n\tdesc->hdr.type = FCPIO_FLOGI_REG;      \n\tdesc->hdr.status = 0;                  \n\tdesc->hdr._resvd = 0;                  \n\tdesc->hdr.tag.u.req_id = req_id;       \n\n\tdesc->u.flogi_reg.format = format;\n\tdesc->u.flogi_reg._resvd = 0;\n\thton24(desc->u.flogi_reg.s_id, s_id);\n\tmemcpy(desc->u.flogi_reg.gateway_mac, gw_mac, ETH_ALEN);\n\n\tvnic_wq_copy_post(wq);\n}\n\nstatic inline void fnic_queue_wq_copy_desc_fip_reg(struct vnic_wq_copy *wq,\n\t\t\t\t\t\t   u32 req_id, u32 s_id,\n\t\t\t\t\t\t   u8 *fcf_mac, u8 *ha_mac,\n\t\t\t\t\t\t   u32 r_a_tov, u32 e_d_tov)\n{\n\tstruct fcpio_host_req *desc = vnic_wq_copy_next_desc(wq);\n\n\tdesc->hdr.type = FCPIO_FLOGI_FIP_REG;  \n\tdesc->hdr.status = 0;                  \n\tdesc->hdr._resvd = 0;                  \n\tdesc->hdr.tag.u.req_id = req_id;       \n\n\tdesc->u.flogi_fip_reg._resvd0 = 0;\n\thton24(desc->u.flogi_fip_reg.s_id, s_id);\n\tmemcpy(desc->u.flogi_fip_reg.fcf_mac, fcf_mac, ETH_ALEN);\n\tdesc->u.flogi_fip_reg._resvd1 = 0;\n\tdesc->u.flogi_fip_reg.r_a_tov = r_a_tov;\n\tdesc->u.flogi_fip_reg.e_d_tov = e_d_tov;\n\tmemcpy(desc->u.flogi_fip_reg.ha_mac, ha_mac, ETH_ALEN);\n\tdesc->u.flogi_fip_reg._resvd2 = 0;\n\n\tvnic_wq_copy_post(wq);\n}\n\nstatic inline void fnic_queue_wq_copy_desc_fw_reset(struct vnic_wq_copy *wq,\n\t\t\t\t\t\t    u32 req_id)\n{\n\tstruct fcpio_host_req *desc = vnic_wq_copy_next_desc(wq);\n\n\tdesc->hdr.type = FCPIO_RESET;      \n\tdesc->hdr.status = 0;              \n\tdesc->hdr._resvd = 0;              \n\tdesc->hdr.tag.u.req_id = req_id;   \n\n\tvnic_wq_copy_post(wq);\n}\n\nstatic inline void fnic_queue_wq_copy_desc_lunmap(struct vnic_wq_copy *wq,\n\t\t\t\t\t\t  u32 req_id, u64 lunmap_addr,\n\t\t\t\t\t\t  u32 lunmap_len)\n{\n\tstruct fcpio_host_req *desc = vnic_wq_copy_next_desc(wq);\n\n\tdesc->hdr.type = FCPIO_LUNMAP_REQ;\t \n\tdesc->hdr.status = 0;\t\t\t \n\tdesc->hdr._resvd = 0;\t\t\t \n\tdesc->hdr.tag.u.req_id = req_id;\t \n\n\tdesc->u.lunmap_req.addr = lunmap_addr;\t \n\tdesc->u.lunmap_req.len = lunmap_len;\t \n\n\tvnic_wq_copy_post(wq);\n}\n\nstatic inline void fnic_queue_rq_desc(struct vnic_rq *rq,\n\t\t\t\t      void *os_buf, dma_addr_t dma_addr,\n\t\t\t\t      u16 len)\n{\n\tstruct rq_enet_desc *desc = vnic_rq_next_desc(rq);\n\n\trq_enet_desc_enc(desc,\n\t\t(u64)dma_addr | VNIC_PADDR_TARGET,\n\t\tRQ_ENET_TYPE_ONLY_SOP,\n\t\t(u16)len);\n\n\tvnic_rq_post(rq, os_buf, 0, dma_addr, len);\n}\n\n\nstruct fnic;\n\nint fnic_get_vnic_config(struct fnic *);\nint fnic_alloc_vnic_resources(struct fnic *);\nvoid fnic_free_vnic_resources(struct fnic *);\nvoid fnic_get_res_counts(struct fnic *);\nint fnic_set_nic_config(struct fnic *fnic, u8 rss_default_cpu,\n\t\t\tu8 rss_hash_type, u8 rss_hash_bits, u8 rss_base_cpu,\n\t\t\tu8 rss_enable, u8 tso_ipid_split_en,\n\t\t\tu8 ig_vlan_strip_en);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}