{
  "module_name": "pmcraid.h",
  "hash_id": "10f220f9dcb20f05356a881fe22f09982f4a06d550169a2b2bd73316525c63da",
  "original_prompt": "Ingested from linux-6.6.14/drivers/scsi/pmcraid.h",
  "human_readable_source": " \n \n\n#ifndef _PMCRAID_H\n#define _PMCRAID_H\n\n#include <linux/types.h>\n#include <linux/completion.h>\n#include <linux/list.h>\n#include <scsi/scsi.h>\n#include <scsi/scsi_cmnd.h>\n#include <linux/cdev.h>\n#include <net/netlink.h>\n#include <net/genetlink.h>\n#include <linux/connector.h>\n \n#define PMCRAID_DRIVER_NAME\t\t\"PMC MaxRAID\"\n#define PMCRAID_DEVFILE\t\t\t\"pmcsas\"\n#define PMCRAID_DRIVER_VERSION\t\t\"1.0.3\"\n\n#define PMCRAID_FW_VERSION_1\t\t0x002\n\n \n#define PMCRAID_MAX_ADAPTERS\t\t1024\n\n \n#define PMC_BIT8(n)          (1 << (7-n))\n#define PMC_BIT16(n)         (1 << (15-n))\n#define PMC_BIT32(n)         (1 << (31-n))\n\n \n#define PCI_VENDOR_ID_PMC\t\t\t0x11F8\n#define PCI_DEVICE_ID_PMC_MAXRAID\t\t0x5220\n\n \n#define PMCRAID_MAX_CMD\t\t\t\t1024\n#define PMCRAID_MAX_IO_CMD\t\t\t1020\n#define PMCRAID_MAX_HCAM_CMD\t\t\t2\n#define PMCRAID_MAX_INTERNAL_CMD\t\t2\n\n \n#define PMCRAID_IOADLS_INTERNAL\t\t\t 27\n#define PMCRAID_IOADLS_EXTERNAL\t\t\t 37\n#define PMCRAID_MAX_IOADLS\t\t\t PMCRAID_IOADLS_INTERNAL\n\n \n#define HRRQ_ENTRY_SIZE                          sizeof(__le32)\n#define PMCRAID_IOARCB_ALIGNMENT                 32\n#define PMCRAID_IOADL_ALIGNMENT                  16\n#define PMCRAID_IOASA_ALIGNMENT                  4\n#define PMCRAID_NUM_MSIX_VECTORS                 16\n\n \n#define PMCRAID_VENDOR_ID_LEN\t\t\t8\n#define PMCRAID_PRODUCT_ID_LEN\t\t\t16\n#define PMCRAID_SERIAL_NUM_LEN\t\t\t8\n#define PMCRAID_LUN_LEN\t\t\t\t8\n#define PMCRAID_MAX_CDB_LEN\t\t\t16\n#define PMCRAID_DEVICE_ID_LEN\t\t\t8\n#define PMCRAID_SENSE_DATA_LEN\t\t\t256\n#define PMCRAID_ADD_CMD_PARAM_LEN\t\t48\n\n#define PMCRAID_MAX_BUS_TO_SCAN                  1\n#define PMCRAID_MAX_NUM_TARGETS_PER_BUS          256\n#define PMCRAID_MAX_NUM_LUNS_PER_TARGET          8\n\n \n#define PMCRAID_IOA_BUS_ID                       0xfe\n#define PMCRAID_IOA_TARGET_ID                    0xff\n#define PMCRAID_IOA_LUN_ID                       0xff\n#define PMCRAID_VSET_BUS_ID                      0x1\n#define PMCRAID_VSET_LUN_ID                      0x0\n#define PMCRAID_PHYS_BUS_ID                      0x0\n#define PMCRAID_VIRTUAL_ENCL_BUS_ID              0x8\n#define PMCRAID_MAX_VSET_TARGETS                 0x7F\n#define PMCRAID_MAX_VSET_LUNS_PER_TARGET         8\n\n#define PMCRAID_IOA_MAX_SECTORS                  32767\n#define PMCRAID_VSET_MAX_SECTORS                 512\n#define PMCRAID_MAX_CMD_PER_LUN                  254\n\n \n#define PMCRAID_MAX_RESOURCES                    256\n\n \n#define PMCRAID_QUERY_RESOURCE_STATE             0xC2\n#define PMCRAID_RESET_DEVICE                     0xC3\n \n#define ENABLE_RESET_MODIFIER                    0x80\n#define RESET_DEVICE_LUN                         0x40\n#define RESET_DEVICE_TARGET                      0x20\n#define RESET_DEVICE_BUS                         0x10\n\n#define PMCRAID_IDENTIFY_HRRQ                    0xC4\n#define PMCRAID_QUERY_IOA_CONFIG                 0xC5\n#define PMCRAID_QUERY_CMD_STATUS\t\t 0xCB\n#define PMCRAID_ABORT_CMD                        0xC7\n\n \n#define PMCRAID_CANCEL_ALL_REQUESTS\t\t 0xCE\n#define PMCRAID_SYNC_COMPLETE_AFTER_CANCEL       PMC_BIT8(0)\n\n \n#define PMCRAID_HOST_CONTROLLED_ASYNC            0xCF\n#define PMCRAID_HCAM_CODE_CONFIG_CHANGE          0x01\n#define PMCRAID_HCAM_CODE_LOG_DATA               0x02\n\n \n#define PMCRAID_IOA_SHUTDOWN                     0xF7\n#define PMCRAID_SHUTDOWN_NORMAL                  0x00\n#define PMCRAID_SHUTDOWN_PREPARE_FOR_NORMAL      0x40\n#define PMCRAID_SHUTDOWN_NONE                    0x100\n#define PMCRAID_SHUTDOWN_ABBREV                  0x80\n\n \n#define PMCRAID_SET_SUPPORTED_DEVICES            0xFB\n#define ALL_DEVICES_SUPPORTED                    PMC_BIT8(0)\n\n \n#define PMCRAID_WR_BUF_DOWNLOAD_AND_SAVE         0x05\n\n \n#define PMCRAID_IOASC_SENSE_MASK                 0xFFFFFF00\n#define PMCRAID_IOASC_SENSE_KEY(ioasc)           ((ioasc) >> 24)\n#define PMCRAID_IOASC_SENSE_CODE(ioasc)          (((ioasc) & 0x00ff0000) >> 16)\n#define PMCRAID_IOASC_SENSE_QUAL(ioasc)          (((ioasc) & 0x0000ff00) >> 8)\n#define PMCRAID_IOASC_SENSE_STATUS(ioasc)        ((ioasc) & 0x000000ff)\n\n#define PMCRAID_IOASC_GOOD_COMPLETION\t\t\t0x00000000\n#define PMCRAID_IOASC_GC_IOARCB_NOTFOUND\t\t0x005A0000\n#define PMCRAID_IOASC_NR_INIT_CMD_REQUIRED\t\t0x02040200\n#define PMCRAID_IOASC_NR_IOA_RESET_REQUIRED\t\t0x02048000\n#define PMCRAID_IOASC_NR_SYNC_REQUIRED\t\t\t0x023F0000\n#define PMCRAID_IOASC_ME_READ_ERROR_NO_REALLOC\t\t0x03110C00\n#define PMCRAID_IOASC_HW_CANNOT_COMMUNICATE\t\t0x04050000\n#define PMCRAID_IOASC_HW_DEVICE_TIMEOUT\t\t\t0x04080100\n#define PMCRAID_IOASC_HW_DEVICE_BUS_STATUS_ERROR\t0x04448500\n#define PMCRAID_IOASC_HW_IOA_RESET_REQUIRED\t\t0x04448600\n#define PMCRAID_IOASC_IR_INVALID_RESOURCE_HANDLE        0x05250000\n#define PMCRAID_IOASC_AC_TERMINATED_BY_HOST\t\t0x0B5A0000\n#define PMCRAID_IOASC_UA_BUS_WAS_RESET\t\t\t0x06290000\n#define PMCRAID_IOASC_TIME_STAMP_OUT_OF_SYNC\t\t0x06908B00\n#define PMCRAID_IOASC_UA_BUS_WAS_RESET_BY_OTHER\t\t0x06298000\n\n \n#define PMCRAID_IOASC_IOA_WAS_RESET\t\t\t0x10000001\n#define PMCRAID_IOASC_PCI_ACCESS_ERROR\t\t\t0x10000002\n\n \n#define PMCRAID_PCI_DEASSERT_TIMEOUT\t\t2000\n#define PMCRAID_BIST_TIMEOUT\t\t\t2000\n#define PMCRAID_AENWAIT_TIMEOUT\t\t\t5000\n#define PMCRAID_TRANSOP_TIMEOUT\t\t\t60000\n\n#define PMCRAID_RESET_TIMEOUT\t\t\t(2 * HZ)\n#define PMCRAID_CHECK_FOR_RESET_TIMEOUT\t\t((HZ / 10))\n#define PMCRAID_VSET_IO_TIMEOUT\t\t\t(60 * HZ)\n#define PMCRAID_INTERNAL_TIMEOUT\t\t(60 * HZ)\n#define PMCRAID_SHUTDOWN_TIMEOUT\t\t(150 * HZ)\n#define PMCRAID_RESET_BUS_TIMEOUT\t\t(60 * HZ)\n#define PMCRAID_RESET_HOST_TIMEOUT\t\t(150 * HZ)\n#define PMCRAID_REQUEST_SENSE_TIMEOUT\t\t(30 * HZ)\n#define PMCRAID_SET_SUP_DEV_TIMEOUT\t\t(2 * 60 * HZ)\n\n \nstruct pmcraid_ioadl_desc {\n\t__le64 address;\n\t__le32 data_len;\n\t__u8  reserved[3];\n\t__u8  flags;\n} __attribute__((packed, aligned(PMCRAID_IOADL_ALIGNMENT)));\n\n \n#define IOADL_FLAGS_CHAINED      PMC_BIT8(0)\n#define IOADL_FLAGS_LAST_DESC    PMC_BIT8(1)\n#define IOADL_FLAGS_READ_LAST    PMC_BIT8(1)\n#define IOADL_FLAGS_WRITE_LAST   PMC_BIT8(1)\n\n\n \nstruct pmcraid_ioarcb_add_data {\n\tunion {\n\t\tstruct pmcraid_ioadl_desc ioadl[PMCRAID_IOADLS_INTERNAL];\n\t\t__u8 add_cmd_params[PMCRAID_ADD_CMD_PARAM_LEN];\n\t} u;\n};\n\n \nstruct pmcraid_ioarcb {\n\t__le64 ioarcb_bus_addr;\n\t__le32 resource_handle;\n\t__le32 response_handle;\n\t__le64 ioadl_bus_addr;\n\t__le32 ioadl_length;\n\t__le32 data_transfer_length;\n\t__le64 ioasa_bus_addr;\n\t__le16 ioasa_len;\n\t__le16 cmd_timeout;\n\t__le16 add_cmd_param_offset;\n\t__le16 add_cmd_param_length;\n\t__le32 reserved1[2];\n\t__le32 reserved2;\n\t__u8  request_type;\n\t__u8  request_flags0;\n\t__u8  request_flags1;\n\t__u8  hrrq_id;\n\t__u8  cdb[PMCRAID_MAX_CDB_LEN];\n\tstruct pmcraid_ioarcb_add_data add_data;\n};\n\n \n#define PMCRAID_IOA_RES_HANDLE        0xffffffff\n#define PMCRAID_INVALID_RES_HANDLE    0\n\n \n#define REQ_TYPE_SCSI                 0x00\n#define REQ_TYPE_IOACMD               0x01\n#define REQ_TYPE_HCAM                 0x02\n\n \n#define TRANSFER_DIR_WRITE            PMC_BIT8(0)\n#define INHIBIT_UL_CHECK              PMC_BIT8(2)\n#define SYNC_OVERRIDE                 PMC_BIT8(3)\n#define SYNC_COMPLETE                 PMC_BIT8(4)\n#define NO_LINK_DESCS                 PMC_BIT8(5)\n\n \n#define DELAY_AFTER_RESET             PMC_BIT8(0)\n#define TASK_TAG_SIMPLE               0x10\n#define TASK_TAG_ORDERED              0x20\n#define TASK_TAG_QUEUE_HEAD           0x30\n\n \n#define HRRQ_TOGGLE_BIT               0x01\n#define HRRQ_RESPONSE_BIT             0x02\n\n \nstruct pmcraid_ioasa_vset {\n\t__le32 failing_lba_hi;\n\t__le32 failing_lba_lo;\n\t__le32 reserved;\n} __attribute__((packed, aligned(4)));\n\nstruct pmcraid_ioasa {\n\t__le32 ioasc;\n\t__le16 returned_status_length;\n\t__le16 available_status_length;\n\t__le32 residual_data_length;\n\t__le32 ilid;\n\t__le32 fd_ioasc;\n\t__le32 fd_res_address;\n\t__le32 fd_res_handle;\n\t__le32 reserved;\n\n\t \n\tunion {\n\t\tstruct pmcraid_ioasa_vset vset;\n\t} u;\n\n\t \n\t__le16 auto_sense_length;\n\t__le16 error_data_length;\n\t__u8  sense_data[PMCRAID_SENSE_DATA_LEN];\n} __attribute__((packed, aligned(4)));\n\n#define PMCRAID_DRIVER_ILID           0xffffffff\n\n \nstruct pmcraid_config_table_entry {\n\t__u8  resource_type;\n\t__u8  bus_protocol;\n\t__le16 array_id;\n\t__u8  common_flags0;\n\t__u8  common_flags1;\n\t__u8  unique_flags0;\n\t__u8  unique_flags1;\t \n\t__le32 resource_handle;\n\t__le32 resource_address;\n\t__u8  device_id[PMCRAID_DEVICE_ID_LEN];\n\t__u8  lun[PMCRAID_LUN_LEN];\n} __attribute__((packed, aligned(4)));\n\n \nstruct pmcraid_config_table_entry_ext {\n\tstruct pmcraid_config_table_entry cfgte;\n};\n\n \n#define RES_TYPE_AF_DASD     0x00\n#define RES_TYPE_GSCSI       0x01\n#define RES_TYPE_VSET        0x02\n#define RES_TYPE_IOA_FP      0xFF\n\n#define RES_IS_IOA(res)      ((res).resource_type == RES_TYPE_IOA_FP)\n#define RES_IS_GSCSI(res)    ((res).resource_type == RES_TYPE_GSCSI)\n#define RES_IS_VSET(res)     ((res).resource_type == RES_TYPE_VSET)\n#define RES_IS_AFDASD(res)   ((res).resource_type == RES_TYPE_AF_DASD)\n\n \n#define RES_TYPE_VENCLOSURE  0x8\n\n \n#define MULTIPATH_RESOURCE   PMC_BIT32(0)\n\n \n#define IMPORT_MODE_MANUAL   PMC_BIT8(0)\n\n \n#define RES_HANDLE_IOA       0xFFFFFFFF\n#define RES_HANDLE_NONE      0x00000000\n\n \n#define RES_ADDRESS_IOAFP    0xFEFFFFFF\n#define RES_ADDRESS_INVALID  0xFFFFFFFF\n\n \n#define RES_BUS(res_addr)    (le32_to_cpu(res_addr) & 0xFF)\n#define RES_TARGET(res_addr) ((le32_to_cpu(res_addr) >> 16) & 0xFF)\n#define RES_LUN(res_addr)    0x0\n\n \nstruct pmcraid_config_table {\n\t__le16 num_entries;\n\t__u8  table_format;\n\t__u8  reserved1;\n\t__u8  flags;\n\t__u8  reserved2[11];\n\tunion {\n\t\tstruct pmcraid_config_table_entry\n\t\t\t\tentries[PMCRAID_MAX_RESOURCES];\n\t\tstruct pmcraid_config_table_entry_ext\n\t\t\t\tentries_ext[PMCRAID_MAX_RESOURCES];\n\t};\n} __attribute__((packed, aligned(4)));\n\n \n#define MICROCODE_UPDATE_REQUIRED\t\tPMC_BIT32(0)\n\n \n#define PMCRAID_HOSTRCB_LDNSIZE\t\t\t4056\n\n \nstruct pmcraid_hostrcb_error {\n\t__le32 fd_ioasc;\n\t__le32 fd_ra;\n\t__le32 fd_rh;\n\t__le32 prc;\n\tunion {\n\t\t__u8 data[PMCRAID_HOSTRCB_LDNSIZE];\n\t} u;\n} __attribute__ ((packed, aligned(4)));\n\nstruct pmcraid_hcam_hdr {\n\t__u8  op_code;\n\t__u8  notification_type;\n\t__u8  notification_lost;\n\t__u8  flags;\n\t__u8  overlay_id;\n\t__u8  reserved1[3];\n\t__le32 ilid;\n\t__le32 timestamp1;\n\t__le32 timestamp2;\n\t__le32 data_len;\n} __attribute__((packed, aligned(4)));\n\n#define PMCRAID_AEN_GROUP\t0x3\n\nstruct pmcraid_hcam_ccn {\n\tstruct pmcraid_hcam_hdr header;\n\tstruct pmcraid_config_table_entry cfg_entry;\n\tstruct pmcraid_config_table_entry cfg_entry_old;\n} __attribute__((packed, aligned(4)));\n\n#define PMCRAID_CCN_EXT_SIZE\t3944\nstruct pmcraid_hcam_ccn_ext {\n\tstruct pmcraid_hcam_hdr header;\n\tstruct pmcraid_config_table_entry_ext cfg_entry;\n\tstruct pmcraid_config_table_entry_ext cfg_entry_old;\n\t__u8   reserved[PMCRAID_CCN_EXT_SIZE];\n} __attribute__((packed, aligned(4)));\n\nstruct pmcraid_hcam_ldn {\n\tstruct pmcraid_hcam_hdr header;\n\tstruct pmcraid_hostrcb_error error_log;\n} __attribute__((packed, aligned(4)));\n\n \n#define HOSTRCB_TYPE_CCN\t\t\t0xE1\n#define HOSTRCB_TYPE_LDN\t\t\t0xE2\n\n \n#define NOTIFICATION_TYPE_ENTRY_CHANGED\t\t0x0\n#define NOTIFICATION_TYPE_ENTRY_NEW\t\t0x1\n#define NOTIFICATION_TYPE_ENTRY_DELETED\t\t0x2\n#define NOTIFICATION_TYPE_STATE_CHANGE\t\t0x3\n#define NOTIFICATION_TYPE_ENTRY_STATECHANGED\t0x4\n#define NOTIFICATION_TYPE_ERROR_LOG\t\t0x10\n#define NOTIFICATION_TYPE_INFORMATION_LOG\t0x11\n\n#define HOSTRCB_NOTIFICATIONS_LOST\t\tPMC_BIT8(0)\n\n \n#define HOSTRCB_INTERNAL_OP_ERROR\t\tPMC_BIT8(0)\n#define HOSTRCB_ERROR_RESPONSE_SENT\t\tPMC_BIT8(1)\n\n \n#define HOSTRCB_OVERLAY_ID_08\t\t\t0x08\n#define HOSTRCB_OVERLAY_ID_09\t\t\t0x09\n#define HOSTRCB_OVERLAY_ID_11\t\t\t0x11\n#define HOSTRCB_OVERLAY_ID_12\t\t\t0x12\n#define HOSTRCB_OVERLAY_ID_13\t\t\t0x13\n#define HOSTRCB_OVERLAY_ID_14\t\t\t0x14\n#define HOSTRCB_OVERLAY_ID_16\t\t\t0x16\n#define HOSTRCB_OVERLAY_ID_17\t\t\t0x17\n#define HOSTRCB_OVERLAY_ID_20\t\t\t0x20\n#define HOSTRCB_OVERLAY_ID_FF\t\t\t0xFF\n\n \nstruct pmcraid_chip_details {\n\t \n\tunsigned long  ioastatus;\n\tunsigned long  ioarrin;\n\tunsigned long  mailbox;\n\tunsigned long  global_intr_mask;\n\tunsigned long  ioa_host_intr;\n\tunsigned long  ioa_host_msix_intr;\n\tunsigned long  ioa_host_intr_clr;\n\tunsigned long  ioa_host_mask;\n\tunsigned long  ioa_host_mask_clr;\n\tunsigned long  host_ioa_intr;\n\tunsigned long  host_ioa_intr_clr;\n\n\t \n\tunsigned long transop_timeout;\n};\n\n \n#define INTRS_TRANSITION_TO_OPERATIONAL\t\tPMC_BIT32(0)\n#define INTRS_IOARCB_TRANSFER_FAILED\t\tPMC_BIT32(3)\n#define INTRS_IOA_UNIT_CHECK\t\t\tPMC_BIT32(4)\n#define INTRS_NO_HRRQ_FOR_CMD_RESPONSE\t\tPMC_BIT32(5)\n#define INTRS_CRITICAL_OP_IN_PROGRESS\t\tPMC_BIT32(6)\n#define INTRS_IO_DEBUG_ACK\t\t\tPMC_BIT32(7)\n#define INTRS_IOARRIN_LOST\t\t\tPMC_BIT32(27)\n#define INTRS_SYSTEM_BUS_MMIO_ERROR\t\tPMC_BIT32(28)\n#define INTRS_IOA_PROCESSOR_ERROR\t\tPMC_BIT32(29)\n#define INTRS_HRRQ_VALID\t\t\tPMC_BIT32(30)\n#define INTRS_OPERATIONAL_STATUS\t\tPMC_BIT32(0)\n#define INTRS_ALLOW_MSIX_VECTOR0\t\tPMC_BIT32(31)\n\n \n#define DOORBELL_RUNTIME_RESET\t\t\tPMC_BIT32(1)\n#define DOORBELL_IOA_RESET_ALERT\t\tPMC_BIT32(7)\n#define DOORBELL_IOA_DEBUG_ALERT\t\tPMC_BIT32(9)\n#define DOORBELL_ENABLE_DESTRUCTIVE_DIAGS\tPMC_BIT32(8)\n#define DOORBELL_IOA_START_BIST\t\t\tPMC_BIT32(23)\n#define DOORBELL_INTR_MODE_MSIX\t\t\tPMC_BIT32(25)\n#define DOORBELL_INTR_MSIX_CLR\t\t\tPMC_BIT32(26)\n#define DOORBELL_RESET_IOA\t\t\tPMC_BIT32(31)\n\n \n#define GLOBAL_INTERRUPT_MASK\t\t\t0x5ULL\n\n#define PMCRAID_ERROR_INTERRUPTS\t(INTRS_IOARCB_TRANSFER_FAILED | \\\n\t\t\t\t\t INTRS_IOA_UNIT_CHECK | \\\n\t\t\t\t\t INTRS_NO_HRRQ_FOR_CMD_RESPONSE | \\\n\t\t\t\t\t INTRS_IOARRIN_LOST | \\\n\t\t\t\t\t INTRS_SYSTEM_BUS_MMIO_ERROR | \\\n\t\t\t\t\t INTRS_IOA_PROCESSOR_ERROR)\n\n#define PMCRAID_PCI_INTERRUPTS\t\t(PMCRAID_ERROR_INTERRUPTS | \\\n\t\t\t\t\t INTRS_HRRQ_VALID | \\\n\t\t\t\t\t INTRS_TRANSITION_TO_OPERATIONAL |\\\n\t\t\t\t\t INTRS_ALLOW_MSIX_VECTOR0)\n\n \nstruct pmcraid_control_block {\n\tstruct pmcraid_ioarcb ioarcb;\n\tstruct pmcraid_ioadl_desc ioadl[PMCRAID_IOADLS_EXTERNAL + 3];\n\tstruct pmcraid_ioasa ioasa;\n} __attribute__ ((packed, aligned(PMCRAID_IOARCB_ALIGNMENT)));\n\n \nstruct pmcraid_sglist {\n\tu32 order;\n\tu32 num_sg;\n\tu32 num_dma_sg;\n\tstruct scatterlist *scatterlist;\n};\n\n \nstruct pmcraid_inquiry_data {\n\t__u8\tph_dev_type;\n\t__u8\tpage_code;\n\t__u8\treserved1;\n\t__u8\tadd_page_len;\n\t__u8\tlength;\n\t__u8\treserved2;\n\t__be16\tfw_version;\n\t__u8\treserved3[16];\n};\n\n#define PMCRAID_TIMESTAMP_LEN\t\t12\n#define PMCRAID_REQ_TM_STR_LEN\t\t6\n#define PMCRAID_SCSI_SET_TIMESTAMP\t0xA4\n#define PMCRAID_SCSI_SERVICE_ACTION\t0x0F\n\nstruct pmcraid_timestamp_data {\n\t__u8 reserved1[4];\n\t__u8 timestamp[PMCRAID_REQ_TM_STR_LEN];\t\t \n\t__u8 reserved2[2];\n};\n\n \nstruct pmcraid_cmd {\n\n\t \n\tstruct pmcraid_control_block *ioa_cb;\n\tdma_addr_t ioa_cb_bus_addr;\n\tdma_addr_t dma_handle;\n\n\t \n\tstruct scsi_cmnd *scsi_cmd;\n\n\tstruct list_head free_list;\n\tstruct completion wait_for_completion;\n\tstruct timer_list timer;\t \n\tu32 timeout;\t\t\t \n\tu32 index;\t\t\t \n\tu8 completion_req;\t\t \n\tu8 release;\t\t\t \n\n\tvoid (*cmd_done) (struct pmcraid_cmd *);\n\tstruct pmcraid_instance *drv_inst;\n\n\tstruct pmcraid_sglist *sglist;  \n\n\t \n\tunion {\n\t\t \n\t\tunsigned long time_left;\n\t\tstruct pmcraid_resource_entry *res;\n\t\tint hrrq_index;\n\n\t\t \n\t\tstruct  {\n\t\t\tu8 *sense_buffer;\n\t\t\tdma_addr_t sense_buffer_dma;\n\t\t};\n\t};\n};\n\n \nstruct pmcraid_interrupts {\n\tvoid __iomem *ioa_host_interrupt_reg;\n\tvoid __iomem *ioa_host_msix_interrupt_reg;\n\tvoid __iomem *ioa_host_interrupt_clr_reg;\n\tvoid __iomem *ioa_host_interrupt_mask_reg;\n\tvoid __iomem *ioa_host_interrupt_mask_clr_reg;\n\tvoid __iomem *global_interrupt_mask_reg;\n\tvoid __iomem *host_ioa_interrupt_reg;\n\tvoid __iomem *host_ioa_interrupt_clr_reg;\n};\n\n \nstruct pmcraid_isr_param {\n\tstruct pmcraid_instance *drv_inst;\n\tu8 hrrq_id;\t\t\t \n};\n\n\n \nstruct pmcraid_aen_msg {\n\tu32 hostno;\n\tu32 length;\n\tu8  reserved[8];\n\tu8  data[];\n};\n\n \nstruct pmcraid_state_msg {\n\tstruct pmcraid_aen_msg msg;\n\tu32 ioa_state;\n};\n\n#define PMC_DEVICE_EVENT_RESET_START\t\t0x11000000\n#define PMC_DEVICE_EVENT_RESET_SUCCESS\t\t0x11000001\n#define PMC_DEVICE_EVENT_RESET_FAILED\t\t0x11000002\n#define PMC_DEVICE_EVENT_SHUTDOWN_START\t\t0x11000003\n#define PMC_DEVICE_EVENT_SHUTDOWN_SUCCESS\t0x11000004\n#define PMC_DEVICE_EVENT_SHUTDOWN_FAILED\t0x11000005\n\nstruct pmcraid_hostrcb {\n\tstruct pmcraid_instance *drv_inst;\n\tstruct pmcraid_aen_msg *msg;\n\tstruct pmcraid_hcam_hdr *hcam;\t \n\tstruct pmcraid_cmd  *cmd;        \n\tdma_addr_t baddr;\t\t \n\tatomic_t ignore;\t\t \n};\n\n#define PMCRAID_AEN_HDR_SIZE\tsizeof(struct pmcraid_aen_msg)\n\n\n\n \nstruct pmcraid_instance {\n\t \n\tstruct pmcraid_resource_entry *res_entries;\n\n\tstruct list_head free_res_q;\t \n\tstruct list_head used_res_q;\t \n\tspinlock_t resource_lock;\t \n\n\tvoid __iomem *mapped_dma_addr;\n\tvoid __iomem *ioa_status;\t \n\tvoid __iomem *mailbox;\t\t \n\tvoid __iomem *ioarrin;\t\t \n\n\tstruct pmcraid_interrupts int_regs;\n\tstruct pmcraid_chip_details *chip_cfg;\n\n\t \n\tstruct pmcraid_hostrcb ldn;\n\tstruct pmcraid_hostrcb ccn;\n\tstruct pmcraid_state_msg scn;\t \n\n\n\t \n\tdma_addr_t hrrq_start_bus_addr[PMCRAID_NUM_MSIX_VECTORS];\n\n\t \n\t__le32 *hrrq_start[PMCRAID_NUM_MSIX_VECTORS];\n\n\t \n\t__le32 *hrrq_end[PMCRAID_NUM_MSIX_VECTORS];\n\n\t \n\t__le32 *hrrq_curr[PMCRAID_NUM_MSIX_VECTORS];\n\n\t \n\tspinlock_t hrrq_lock[PMCRAID_NUM_MSIX_VECTORS];\n\n\tstruct pmcraid_inquiry_data *inq_data;\n\tdma_addr_t  inq_data_baddr;\n\n\tstruct pmcraid_timestamp_data *timestamp_data;\n\tdma_addr_t  timestamp_data_baddr;\n\n\t \n\tu32\tconfig_table_entry_size;\n\n\t \n\tu8 host_toggle_bit[PMCRAID_NUM_MSIX_VECTORS];\n\n\n\t \n\twait_queue_head_t reset_wait_q;\n\tstruct pmcraid_cmd *reset_cmd;\n\n\t \n\tstruct fasync_struct *aen_queue;\n\tstruct mutex aen_queue_lock;\t \n\tstruct cdev cdev;\n\n\tstruct Scsi_Host *host;\t \n\tstruct pci_dev *pdev;\t \n\n\t \n\tu8 ioa_reset_attempts;\n#define PMCRAID_RESET_ATTEMPTS 3\n\n\tu8  current_log_level;\t \n\n\tu8  num_hrrq;\t\t \n\tu8  interrupt_mode;\t \n\tdev_t dev;\t\t \n\n\t \n\tstruct pmcraid_isr_param hrrq_vector[PMCRAID_NUM_MSIX_VECTORS];\n\n\t \n\tatomic_t last_message_id;\n\n\t \n\tstruct pmcraid_config_table *cfg_table;\n\tdma_addr_t cfg_table_bus_addr;\n\n\t \n\tstruct kmem_cache *cmd_cachep;\t\t \n\tstruct dma_pool *control_pool;\t\t \n\tchar   cmd_pool_name[64];\t\t \n\tchar   ctl_pool_name[64];\t\t \n\n\tstruct pmcraid_cmd *cmd_list[PMCRAID_MAX_CMD];\n\n\tstruct list_head free_cmd_pool;\n\tstruct list_head pending_cmd_pool;\n\tspinlock_t free_pool_lock;\t\t \n\tspinlock_t pending_pool_lock;\t\t \n\n\t \n\tstruct tasklet_struct isr_tasklet[PMCRAID_NUM_MSIX_VECTORS];\n\n\t \n\tstruct work_struct worker_q;\n\n\t \n\tatomic_t outstanding_cmds;\n\n\t \n\tatomic_t expose_resources;\n\n\n\n\tu32 ioa_state:4;\t \n#define IOA_STATE_OPERATIONAL       0x0\n#define IOA_STATE_UNKNOWN           0x1\n#define IOA_STATE_DEAD              0x2\n#define IOA_STATE_IN_SOFT_RESET     0x3\n#define IOA_STATE_IN_HARD_RESET     0x4\n#define IOA_STATE_IN_RESET_ALERT    0x5\n#define IOA_STATE_IN_BRINGDOWN      0x6\n#define IOA_STATE_IN_BRINGUP        0x7\n\n\tu32 ioa_reset_in_progress:1;  \n\tu32 ioa_hard_reset:1;\t \n\tu32 ioa_unit_check:1;\t \n\tu32 ioa_bringdown:1;\t \n\tu32 force_ioa_reset:1;   \n\tu32 reinit_cfg_table:1;  \n\tu32 ioa_shutdown_type:2; \n#define SHUTDOWN_NONE               0x0\n#define SHUTDOWN_NORMAL             0x1\n#define SHUTDOWN_ABBREV             0x2\n\tu32 timestamp_error:1;  \n\n};\n\n \nstruct pmcraid_resource_entry {\n\tstruct list_head queue;\t \n\tunion {\n\t\tstruct pmcraid_config_table_entry cfg_entry;\n\t\tstruct pmcraid_config_table_entry_ext cfg_entry_ext;\n\t};\n\tstruct scsi_device *scsi_dev;\t \n\tatomic_t read_failures;\t\t \n\tatomic_t write_failures;\t \n\n\t \n\tu8 change_detected;\n#define RES_CHANGE_ADD          0x1\t \n#define RES_CHANGE_DEL          0x2\t \n\n\tu8 reset_progress;       \n\n\t \n\tu8 sync_reqd;\n\n\t \n\tu8 target;\n};\n\n \nstruct pmcraid_ioasc_error {\n\tu32 ioasc_code;\t\t \n\tu8 log_level;\t\t \n\tchar *error_string;\n};\n\n \n#define IOASC_LOG_LEVEL_NONE\t    0x0  \n#define IOASC_LOG_LEVEL_MUST        0x1\t \n#define IOASC_LOG_LEVEL_HARD        0x2\t \n\n \nstatic struct pmcraid_ioasc_error pmcraid_ioasc_error_table[] = {\n\t{0x01180600, IOASC_LOG_LEVEL_HARD,\n\t \"Recovered Error, soft media error, sector reassignment suggested\"},\n\t{0x015D0000, IOASC_LOG_LEVEL_HARD,\n\t \"Recovered Error, failure prediction threshold exceeded\"},\n\t{0x015D9200, IOASC_LOG_LEVEL_HARD,\n\t \"Recovered Error, soft Cache Card Battery error threshold\"},\n\t{0x015D9200, IOASC_LOG_LEVEL_HARD,\n\t \"Recovered Error, soft Cache Card Battery error threshold\"},\n\t{0x02048000, IOASC_LOG_LEVEL_HARD,\n\t \"Not Ready, IOA Reset Required\"},\n\t{0x02408500, IOASC_LOG_LEVEL_HARD,\n\t \"Not Ready, IOA microcode download required\"},\n\t{0x03110B00, IOASC_LOG_LEVEL_HARD,\n\t \"Medium Error, data unreadable, reassignment suggested\"},\n\t{0x03110C00, IOASC_LOG_LEVEL_MUST,\n\t \"Medium Error, data unreadable do not reassign\"},\n\t{0x03310000, IOASC_LOG_LEVEL_HARD,\n\t \"Medium Error, media corrupted\"},\n\t{0x04050000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, IOA can't communicate with device\"},\n\t{0x04080000, IOASC_LOG_LEVEL_MUST,\n\t \"Hardware Error, device bus error\"},\n\t{0x04088000, IOASC_LOG_LEVEL_MUST,\n\t \"Hardware Error, device bus is not functioning\"},\n\t{0x04118000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, IOA reserved area data check\"},\n\t{0x04118100, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, IOA reserved area invalid data pattern\"},\n\t{0x04118200, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, IOA reserved area LRC error\"},\n\t{0x04320000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, reassignment space exhausted\"},\n\t{0x04330000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, data transfer underlength error\"},\n\t{0x04330000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, data transfer overlength error\"},\n\t{0x04418000, IOASC_LOG_LEVEL_MUST,\n\t \"Hardware Error, PCI bus error\"},\n\t{0x04440000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, device error\"},\n\t{0x04448200, IOASC_LOG_LEVEL_MUST,\n\t \"Hardware Error, IOA error\"},\n\t{0x04448300, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, undefined device response\"},\n\t{0x04448400, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, IOA microcode error\"},\n\t{0x04448600, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, IOA reset required\"},\n\t{0x04449200, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, hard Cache Fearuee Card Battery error\"},\n\t{0x0444A000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, failed device altered\"},\n\t{0x0444A200, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, data check after reassignment\"},\n\t{0x0444A300, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, LRC error after reassignment\"},\n\t{0x044A0000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, device bus error (msg/cmd phase)\"},\n\t{0x04670400, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, new device can't be used\"},\n\t{0x04678000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, invalid multiadapter configuration\"},\n\t{0x04678100, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, incorrect connection between enclosures\"},\n\t{0x04678200, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, connections exceed IOA design limits\"},\n\t{0x04678300, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, incorrect multipath connection\"},\n\t{0x04679000, IOASC_LOG_LEVEL_HARD,\n\t \"Hardware Error, command to LUN failed\"},\n\t{0x064C8000, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, cache exists for missing/failed device\"},\n\t{0x06670100, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, incompatible exposed mode device\"},\n\t{0x06670600, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, attachment of logical unit failed\"},\n\t{0x06678000, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, cables exceed connective design limit\"},\n\t{0x06678300, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, incomplete multipath connection between\" \\\n\t \"IOA and enclosure\"},\n\t{0x06678400, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, incomplete multipath connection between\" \\\n\t \"device and enclosure\"},\n\t{0x06678500, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, incomplete multipath connection between\" \\\n\t \"IOA and remote IOA\"},\n\t{0x06678600, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, missing remote IOA\"},\n\t{0x06679100, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, enclosure doesn't support required multipath\" \\\n\t \"function\"},\n\t{0x06698200, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, corrupt array parity detected on device\"},\n\t{0x066B0200, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, array exposed\"},\n\t{0x066B8200, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, exposed array is still protected\"},\n\t{0x066B9200, IOASC_LOG_LEVEL_HARD,\n\t \"Unit Attention, Multipath redundancy level got worse\"},\n\t{0x07270000, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, device is read/write protected by IOA\"},\n\t{0x07278000, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, IOA doesn't support device attribute\"},\n\t{0x07278100, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, NVRAM mirroring prohibited\"},\n\t{0x07278400, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, array is short 2 or more devices\"},\n\t{0x07278600, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, exposed array is short a required device\"},\n\t{0x07278700, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, array members not at required addresses\"},\n\t{0x07278800, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, exposed mode device resource address conflict\"},\n\t{0x07278900, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, incorrect resource address of exposed mode device\"},\n\t{0x07278A00, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, Array is missing a device and parity is out of sync\"},\n\t{0x07278B00, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, maximum number of arrays already exist\"},\n\t{0x07278C00, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, cannot locate cache data for device\"},\n\t{0x07278D00, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, cache data exits for a changed device\"},\n\t{0x07279100, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, detection of a device requiring format\"},\n\t{0x07279200, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, IOA exceeds maximum number of devices\"},\n\t{0x07279600, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, missing array, volume set is not functional\"},\n\t{0x07279700, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, single device for a volume set\"},\n\t{0x07279800, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, missing multiple devices for a volume set\"},\n\t{0x07279900, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, maximum number of volument sets already exists\"},\n\t{0x07279A00, IOASC_LOG_LEVEL_HARD,\n\t \"Data Protect, other volume set problem\"},\n};\n\n \n#define pmcraid_err(...)  \\\n\tprintk(KERN_ERR \"MaxRAID: \"__VA_ARGS__)\n\n#define pmcraid_info(...) \\\n\tif (pmcraid_debug_log) \\\n\t\tprintk(KERN_INFO \"MaxRAID: \"__VA_ARGS__)\n\n \n#define SCSI_READ_CMD           0x1\t \n#define SCSI_WRITE_CMD          0x2\t \n#define SCSI_CMD_TYPE(opcode) \\\n({  u8 op = opcode; u8 __type = 0;\\\n\tif (op == READ_6 || op == READ_10 || op == READ_12 || op == READ_16)\\\n\t\t__type = SCSI_READ_CMD;\\\n\telse if (op == WRITE_6 || op == WRITE_10 || op == WRITE_12 || \\\n\t\t op == WRITE_16)\\\n\t\t__type = SCSI_WRITE_CMD;\\\n\t__type;\\\n})\n\n#define IS_SCSI_READ_WRITE(opcode) \\\n({\tu8 __type = SCSI_CMD_TYPE(opcode); \\\n\t(__type == SCSI_READ_CMD || __type == SCSI_WRITE_CMD) ? 1 : 0;\\\n})\n\n\n \nstruct pmcraid_ioctl_header {\n\tu8  signature[8];\n\tu32 reserved;\n\tu32 buffer_length;\n};\n\n#define PMCRAID_IOCTL_SIGNATURE      \"PMCRAID\"\n\n \n#define PMCRAID_DRIVER_IOCTL         'D'\n\n#define DRV_IOCTL(n, size) \\\n\t_IOC(_IOC_READ|_IOC_WRITE, PMCRAID_DRIVER_IOCTL, (n), (size))\n\n \n#define _ARGSIZE(arg) (sizeof(struct pmcraid_ioctl_header) + sizeof(arg))\n\n \n\n#define PMCRAID_IOCTL_RESET_ADAPTER          \\\n\tDRV_IOCTL(5, sizeof(struct pmcraid_ioctl_header))\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}