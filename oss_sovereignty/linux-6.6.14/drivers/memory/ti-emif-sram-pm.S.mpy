{
  "module_name": "ti-emif-sram-pm.S",
  "hash_id": "97d14171939e57bde7b16de7344b95f8ac2a0ec5d8f5968685f2f62b9fc4f9dd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/memory/ti-emif-sram-pm.S",
  "human_readable_source": " \n \n\n#include <linux/linkage.h>\n#include <asm/assembler.h>\n#include <asm/page.h>\n\n#include \"emif.h\"\n#include \"ti-emif-asm-offsets.h\"\n\n#define EMIF_POWER_MGMT_WAIT_SELF_REFRESH_8192_CYCLES\t0x00a0\n#define EMIF_POWER_MGMT_SR_TIMER_MASK\t\t\t0x00f0\n#define EMIF_POWER_MGMT_SELF_REFRESH_MODE\t\t0x0200\n#define EMIF_POWER_MGMT_SELF_REFRESH_MODE_MASK\t\t0x0700\n\n#define EMIF_SDCFG_TYPE_DDR2\t\t\t\t0x2 << SDRAM_TYPE_SHIFT\n#define EMIF_SDCFG_TYPE_DDR3\t\t\t\t0x3 << SDRAM_TYPE_SHIFT\n#define EMIF_STATUS_READY\t\t\t\t0x4\n\n#define AM43XX_EMIF_PHY_CTRL_REG_COUNT                  0x120\n\n#define EMIF_AM437X_REGISTERS\t\t\t\t0x1\n\n\t.arm\n\t.align 3\n\t.arch armv7-a\n\nENTRY(ti_emif_sram)\n\n \nENTRY(ti_emif_save_context)\n\tstmfd   sp!, {r4 - r11, lr}     @ save registers on stack\n\n\tadr\tr4, ti_emif_pm_sram_data\n\tldr\tr0, [r4, #EMIF_PM_BASE_ADDR_VIRT_OFFSET]\n\tldr\tr2, [r4, #EMIF_PM_REGS_VIRT_OFFSET]\n\n\t \n\tldr\tr1, [r0, #EMIF_SDRAM_CONFIG]\n\tstr\tr1, [r2, #EMIF_SDCFG_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_SDRAM_REFRESH_CONTROL]\n\tstr\tr1, [r2, #EMIF_REF_CTRL_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_SDRAM_TIMING_1]\n\tstr     r1, [r2, #EMIF_TIMING1_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_SDRAM_TIMING_2]\n\tstr     r1, [r2, #EMIF_TIMING2_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_SDRAM_TIMING_3]\n\tstr     r1, [r2, #EMIF_TIMING3_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]\n\tstr     r1, [r2, #EMIF_PMCR_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CTRL_SHDW]\n\tstr     r1, [r2, #EMIF_PMCR_SHDW_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_SDRAM_OUTPUT_IMPEDANCE_CALIBRATION_CONFIG]\n\tstr     r1, [r2, #EMIF_ZQCFG_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_DDR_PHY_CTRL_1]\n\tstr     r1, [r2, #EMIF_DDR_PHY_CTLR_1_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_COS_CONFIG]\n\tstr     r1, [r2, #EMIF_COS_CONFIG_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_PRIORITY_TO_CLASS_OF_SERVICE_MAPPING]\n\tstr     r1, [r2, #EMIF_PRIORITY_TO_COS_MAPPING_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_CONNECTION_ID_TO_CLASS_OF_SERVICE_1_MAPPING]\n\tstr     r1, [r2, #EMIF_CONNECT_ID_SERV_1_MAP_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_CONNECTION_ID_TO_CLASS_OF_SERVICE_2_MAPPING]\n\tstr     r1, [r2, #EMIF_CONNECT_ID_SERV_2_MAP_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_OCP_CONFIG]\n\tstr     r1, [r2, #EMIF_OCP_CONFIG_VAL_OFFSET]\n\n\tldr\tr5, [r4, #EMIF_PM_CONFIG_OFFSET]\n\tcmp\tr5, #EMIF_SRAM_AM43_REG_LAYOUT\n\tbne\temif_skip_save_extra_regs\n\n\tldr\tr1, [r0, #EMIF_READ_WRITE_LEVELING_RAMP_CONTROL]\n\tstr     r1, [r2, #EMIF_RD_WR_LEVEL_RAMP_CTRL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_READ_WRITE_EXECUTION_THRESHOLD]\n\tstr     r1, [r2, #EMIF_RD_WR_EXEC_THRESH_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_LPDDR2_NVM_TIMING]\n\tstr     r1, [r2, #EMIF_LPDDR2_NVM_TIM_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_LPDDR2_NVM_TIMING_SHDW]\n\tstr     r1, [r2, #EMIF_LPDDR2_NVM_TIM_SHDW_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_DLL_CALIB_CTRL]\n\tstr     r1, [r2, #EMIF_DLL_CALIB_CTRL_VAL_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_DLL_CALIB_CTRL_SHDW]\n\tstr     r1, [r2, #EMIF_DLL_CALIB_CTRL_VAL_SHDW_OFFSET]\n\n\t \n\tmov\tr5, #0x0\n\tadd\tr4, r2, #EMIF_EXT_PHY_CTRL_VALS_OFFSET\n\tadd\tr3, r0, #EMIF_EXT_PHY_CTRL_1\nddr_phy_ctrl_save:\n\tldr\tr1, [r3, r5]\n\tstr\tr1, [r4, r5]\n\tadd\tr5, r5, #0x4\n\tcmp\tr5, #AM43XX_EMIF_PHY_CTRL_REG_COUNT\n\tbne\tddr_phy_ctrl_save\n\nemif_skip_save_extra_regs:\n\tldmfd\tsp!, {r4 - r11, pc}\t@ restore regs and return\nENDPROC(ti_emif_save_context)\n\n \nENTRY(ti_emif_restore_context)\n\tadr\tr4, ti_emif_pm_sram_data\n\tldr\tr0, [r4, #EMIF_PM_BASE_ADDR_PHYS_OFFSET]\n\tldr\tr2, [r4, #EMIF_PM_REGS_PHYS_OFFSET]\n\n\t \n\tldr     r1, [r2, #EMIF_DDR_PHY_CTLR_1_OFFSET]\n\tstr\tr1, [r0, #EMIF_DDR_PHY_CTRL_1]\n\tstr\tr1, [r0, #EMIF_DDR_PHY_CTRL_1_SHDW]\n\n\tldr     r1, [r2, #EMIF_TIMING1_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_SDRAM_TIMING_1]\n\tstr\tr1, [r0, #EMIF_SDRAM_TIMING_1_SHDW]\n\n\tldr     r1, [r2, #EMIF_TIMING2_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_SDRAM_TIMING_2]\n\tstr\tr1, [r0, #EMIF_SDRAM_TIMING_2_SHDW]\n\n\tldr     r1, [r2, #EMIF_TIMING3_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_SDRAM_TIMING_3]\n\tstr\tr1, [r0, #EMIF_SDRAM_TIMING_3_SHDW]\n\n\tldr     r1, [r2, #EMIF_REF_CTRL_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_SDRAM_REFRESH_CONTROL]\n\tstr\tr1, [r0, #EMIF_SDRAM_REFRESH_CTRL_SHDW]\n\n\tldr     r1, [r2, #EMIF_PMCR_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]\n\n\tldr     r1, [r2, #EMIF_PMCR_SHDW_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CTRL_SHDW]\n\n\tldr     r1, [r2, #EMIF_COS_CONFIG_OFFSET]\n\tstr\tr1, [r0, #EMIF_COS_CONFIG]\n\n\tldr     r1, [r2, #EMIF_PRIORITY_TO_COS_MAPPING_OFFSET]\n\tstr\tr1, [r0, #EMIF_PRIORITY_TO_CLASS_OF_SERVICE_MAPPING]\n\n\tldr\tr1, [r2, #EMIF_CONNECT_ID_SERV_1_MAP_OFFSET]\n\tstr\tr1, [r0, #EMIF_CONNECTION_ID_TO_CLASS_OF_SERVICE_1_MAPPING]\n\n\tldr     r1, [r2, #EMIF_CONNECT_ID_SERV_2_MAP_OFFSET]\n\tstr\tr1, [r0, #EMIF_CONNECTION_ID_TO_CLASS_OF_SERVICE_2_MAPPING]\n\n\tldr     r1, [r2, #EMIF_OCP_CONFIG_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_OCP_CONFIG]\n\n\tldr\tr5, [r4, #EMIF_PM_CONFIG_OFFSET]\n\tcmp\tr5, #EMIF_SRAM_AM43_REG_LAYOUT\n\tbne\temif_skip_restore_extra_regs\n\n\tldr     r1, [r2, #EMIF_RD_WR_LEVEL_RAMP_CTRL_OFFSET]\n\tstr\tr1, [r0, #EMIF_READ_WRITE_LEVELING_RAMP_CONTROL]\n\n\tldr     r1, [r2, #EMIF_RD_WR_EXEC_THRESH_OFFSET]\n\tstr\tr1, [r0, #EMIF_READ_WRITE_EXECUTION_THRESHOLD]\n\n\tldr     r1, [r2, #EMIF_LPDDR2_NVM_TIM_OFFSET]\n\tstr\tr1, [r0, #EMIF_LPDDR2_NVM_TIMING]\n\n\tldr     r1, [r2, #EMIF_LPDDR2_NVM_TIM_SHDW_OFFSET]\n\tstr\tr1, [r0, #EMIF_LPDDR2_NVM_TIMING_SHDW]\n\n\tldr     r1, [r2, #EMIF_DLL_CALIB_CTRL_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_DLL_CALIB_CTRL]\n\n\tldr     r1, [r2, #EMIF_DLL_CALIB_CTRL_VAL_SHDW_OFFSET]\n\tstr\tr1, [r0, #EMIF_DLL_CALIB_CTRL_SHDW]\n\n\tldr     r1, [r2, #EMIF_ZQCFG_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_SDRAM_OUTPUT_IMPEDANCE_CALIBRATION_CONFIG]\n\n\t \n\tmov\tr5, #0x0\n\t \n\tadd\tr3, r2, #EMIF_EXT_PHY_CTRL_VALS_OFFSET\n\tadd\tr4, r0, #EMIF_EXT_PHY_CTRL_1\nddr_phy_ctrl_restore:\n\tldr\tr1, [r3, r5]\n\tstr\tr1, [r4, r5]\n\tadd\tr5, r5, #0x4\n\tcmp\tr5, #AM43XX_EMIF_PHY_CTRL_REG_COUNT\n\tbne\tddr_phy_ctrl_restore\n\nemif_skip_restore_extra_regs:\n\t \n\tldr     r1, [r2, #EMIF_ZQCFG_VAL_OFFSET]\n\tstr\tr1, [r0, #EMIF_SDRAM_OUTPUT_IMPEDANCE_CALIBRATION_CONFIG]\n\n\t \n\tldr\tr1, [r2, #EMIF_SDCFG_VAL_OFFSET]\n\tand\tr2, r1, #SDRAM_TYPE_MASK\n\tcmp\tr2, #EMIF_SDCFG_TYPE_DDR2\n\tstreq\tr1, [r0, #EMIF_SDRAM_CONFIG]\n\n\tmov\tpc, lr\nENDPROC(ti_emif_restore_context)\n\n \nENTRY(ti_emif_run_hw_leveling)\n\tadr\tr4, ti_emif_pm_sram_data\n\tldr\tr0, [r4, #EMIF_PM_BASE_ADDR_PHYS_OFFSET]\n\n\tldr\tr3, [r0, #EMIF_READ_WRITE_LEVELING_CONTROL]\n\torr\tr3, r3, #RDWRLVLFULL_START\n\tldr\tr2, [r0, #EMIF_SDRAM_CONFIG]\n\tand\tr2, r2, #SDRAM_TYPE_MASK\n\tcmp\tr2, #EMIF_SDCFG_TYPE_DDR3\n\tbne\tskip_hwlvl\n\n\tstr\tr3, [r0, #EMIF_READ_WRITE_LEVELING_CONTROL]\n\n\t \n\tmov\tr2, #0x2000\n1:\n\tsubs\tr2, r2, #0x1\n\tbne\t1b\n\n\t \n2:\tldr     r1, [r0, #EMIF_READ_WRITE_LEVELING_CONTROL]\n\ttst     r1, #RDWRLVLFULL_START\n\tbne     2b\n\nskip_hwlvl:\n\tmov\tpc, lr\nENDPROC(ti_emif_run_hw_leveling)\n\n \nENTRY(ti_emif_enter_sr)\n\tstmfd   sp!, {r4 - r11, lr}     @ save registers on stack\n\n\tadr\tr4, ti_emif_pm_sram_data\n\tldr\tr0, [r4, #EMIF_PM_BASE_ADDR_VIRT_OFFSET]\n\tldr\tr2, [r4, #EMIF_PM_REGS_VIRT_OFFSET]\n\n\tldr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]\n\tbic\tr1, r1, #EMIF_POWER_MGMT_SELF_REFRESH_MODE_MASK\n\torr\tr1, r1, #EMIF_POWER_MGMT_SELF_REFRESH_MODE\n\tstr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]\n\n\tldmfd\tsp!, {r4 - r11, pc}\t@ restore regs and return\nENDPROC(ti_emif_enter_sr)\n\n \nENTRY(ti_emif_exit_sr)\n\tadr\tr4, ti_emif_pm_sram_data\n\tldr\tr0, [r4, #EMIF_PM_BASE_ADDR_PHYS_OFFSET]\n\tldr\tr2, [r4, #EMIF_PM_REGS_PHYS_OFFSET]\n\n\t \n\tldr\tr1, [r2, #EMIF_PMCR_VAL_OFFSET]\n\tbic\tr1, r1, #EMIF_POWER_MGMT_SELF_REFRESH_MODE_MASK\n\torr\tr1, r1, #EMIF_POWER_MGMT_SELF_REFRESH_MODE\n\tstr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]\n\tbic\tr1, r1, #EMIF_POWER_MGMT_SELF_REFRESH_MODE_MASK\n\tstr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]\n\n         \n1:\tldr     r1, [r0, #EMIF_STATUS]\n\ttst     r1, #EMIF_STATUS_READY\n\tbeq     1b\n\n\tmov\tpc, lr\nENDPROC(ti_emif_exit_sr)\n\n \nENTRY(ti_emif_abort_sr)\n\tstmfd   sp!, {r4 - r11, lr}     @ save registers on stack\n\n\tadr\tr4, ti_emif_pm_sram_data\n\tldr\tr0, [r4, #EMIF_PM_BASE_ADDR_VIRT_OFFSET]\n\tldr\tr2, [r4, #EMIF_PM_REGS_VIRT_OFFSET]\n\n\tldr\tr1, [r2, #EMIF_PMCR_VAL_OFFSET]\n\tbic\tr1, r1, #EMIF_POWER_MGMT_SELF_REFRESH_MODE_MASK\n\tstr\tr1, [r0, #EMIF_POWER_MANAGEMENT_CONTROL]\n\n\t \n1:\tldr     r1, [r0, #EMIF_STATUS]\n\ttst     r1, #EMIF_STATUS_READY\n\tbeq     1b\n\n\tldmfd\tsp!, {r4 - r11, pc}\t@ restore regs and return\nENDPROC(ti_emif_abort_sr)\n\n\t.align 3\nENTRY(ti_emif_pm_sram_data)\n\t.space EMIF_PM_DATA_SIZE\nENTRY(ti_emif_sram_sz)\n        .word   . - ti_emif_save_context\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}