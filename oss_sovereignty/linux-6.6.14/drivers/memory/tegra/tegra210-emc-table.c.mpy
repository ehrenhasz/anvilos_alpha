{
  "module_name": "tegra210-emc-table.c",
  "hash_id": "d3d98388dd6fffb7482f36c3284f0085b351f0af55dab1ccb0023812bbe07bc2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/memory/tegra/tegra210-emc-table.c",
  "human_readable_source": "\n \n\n#include <linux/of_reserved_mem.h>\n\n#include \"tegra210-emc.h\"\n\n#define TEGRA_EMC_MAX_FREQS\t\t16\n\nstatic int tegra210_emc_table_device_init(struct reserved_mem *rmem,\n\t\t\t\t\t  struct device *dev)\n{\n\tstruct tegra210_emc *emc = dev_get_drvdata(dev);\n\tstruct tegra210_emc_timing *timings;\n\tunsigned int i, count = 0;\n\n\ttimings = memremap(rmem->base, rmem->size, MEMREMAP_WB);\n\tif (!timings) {\n\t\tdev_err(dev, \"failed to map EMC table\\n\");\n\t\treturn -ENOMEM;\n\t}\n\n\tfor (i = 0; i < TEGRA_EMC_MAX_FREQS; i++) {\n\t\tif (timings[i].revision == 0)\n\t\t\tbreak;\n\n\t\tcount++;\n\t}\n\n\t \n\tif (emc->derated) {\n\t\tdev_warn(dev, \"excess EMC table '%s'\\n\", rmem->name);\n\t\tgoto out;\n\t}\n\n\tif (emc->nominal) {\n\t\tif (count != emc->num_timings) {\n\t\t\tdev_warn(dev, \"%u derated vs. %u nominal entries\\n\",\n\t\t\t\t count, emc->num_timings);\n\t\t\tmemunmap(timings);\n\t\t\treturn -EINVAL;\n\t\t}\n\n\t\temc->derated = timings;\n\t} else {\n\t\temc->num_timings = count;\n\t\temc->nominal = timings;\n\t}\n\nout:\n\t \n\trmem->priv = timings;\n\n\treturn 0;\n}\n\nstatic void tegra210_emc_table_device_release(struct reserved_mem *rmem,\n\t\t\t\t\t      struct device *dev)\n{\n\tstruct tegra210_emc_timing *timings = rmem->priv;\n\tstruct tegra210_emc *emc = dev_get_drvdata(dev);\n\n\tif ((emc->nominal && timings != emc->nominal) &&\n\t    (emc->derated && timings != emc->derated))\n\t\tdev_warn(dev, \"trying to release unassigned EMC table '%s'\\n\",\n\t\t\t rmem->name);\n\n\tmemunmap(timings);\n}\n\nstatic const struct reserved_mem_ops tegra210_emc_table_ops = {\n\t.device_init = tegra210_emc_table_device_init,\n\t.device_release = tegra210_emc_table_device_release,\n};\n\nstatic int tegra210_emc_table_init(struct reserved_mem *rmem)\n{\n\tpr_debug(\"Tegra210 EMC table at %pa, size %lu bytes\\n\", &rmem->base,\n\t\t (unsigned long)rmem->size);\n\n\trmem->ops = &tegra210_emc_table_ops;\n\n\treturn 0;\n}\nRESERVEDMEM_OF_DECLARE(tegra210_emc_table, \"nvidia,tegra210-emc-table\",\n\t\t       tegra210_emc_table_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}