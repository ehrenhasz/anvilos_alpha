{
  "module_name": "tegra30.c",
  "hash_id": "dff591c0405153ef41fb59e23fc8576a5c73bed95882057a078edaeb1628601b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/memory/tegra/tegra30.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/of.h>\n#include <linux/slab.h>\n\n#include <dt-bindings/memory/tegra30-mc.h>\n\n#include \"mc.h\"\n\nstatic const unsigned long tegra30_mc_emem_regs[] = {\n\tMC_EMEM_ARB_CFG,\n\tMC_EMEM_ARB_OUTSTANDING_REQ,\n\tMC_EMEM_ARB_TIMING_RCD,\n\tMC_EMEM_ARB_TIMING_RP,\n\tMC_EMEM_ARB_TIMING_RC,\n\tMC_EMEM_ARB_TIMING_RAS,\n\tMC_EMEM_ARB_TIMING_FAW,\n\tMC_EMEM_ARB_TIMING_RRD,\n\tMC_EMEM_ARB_TIMING_RAP2PRE,\n\tMC_EMEM_ARB_TIMING_WAP2PRE,\n\tMC_EMEM_ARB_TIMING_R2R,\n\tMC_EMEM_ARB_TIMING_W2W,\n\tMC_EMEM_ARB_TIMING_R2W,\n\tMC_EMEM_ARB_TIMING_W2R,\n\tMC_EMEM_ARB_DA_TURNS,\n\tMC_EMEM_ARB_DA_COVERS,\n\tMC_EMEM_ARB_MISC0,\n\tMC_EMEM_ARB_RING1_THROTTLE,\n};\n\nstatic const struct tegra_mc_client tegra30_mc_clients[] = {\n\t{\n\t\t.id = 0x00,\n\t\t.name = \"ptcr\",\n\t\t.swgroup = TEGRA_SWGROUP_PTC,\n\t\t.regs = {\n\t\t\t.la = {\n\t\t\t\t.reg = 0x34c,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x01,\n\t\t.name = \"display0a\",\n\t\t.swgroup = TEGRA_SWGROUP_DC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 1,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2e8,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 128,\n\t}, {\n\t\t.id = 0x02,\n\t\t.name = \"display0ab\",\n\t\t.swgroup = TEGRA_SWGROUP_DCB,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 2,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2f4,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 128,\n\t}, {\n\t\t.id = 0x03,\n\t\t.name = \"display0b\",\n\t\t.swgroup = TEGRA_SWGROUP_DC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 3,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2e8,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x04,\n\t\t.name = \"display0bb\",\n\t\t.swgroup = TEGRA_SWGROUP_DCB,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 4,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2f4,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x05,\n\t\t.name = \"display0c\",\n\t\t.swgroup = TEGRA_SWGROUP_DC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 5,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2ec,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 128,\n\t}, {\n\t\t.id = 0x06,\n\t\t.name = \"display0cb\",\n\t\t.swgroup = TEGRA_SWGROUP_DCB,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 6,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2f8,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 128,\n\t}, {\n\t\t.id = 0x07,\n\t\t.name = \"display1b\",\n\t\t.swgroup = TEGRA_SWGROUP_DC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 7,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2ec,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x08,\n\t\t.name = \"display1bb\",\n\t\t.swgroup = TEGRA_SWGROUP_DCB,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 8,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2f8,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x4e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x09,\n\t\t.name = \"eppup\",\n\t\t.swgroup = TEGRA_SWGROUP_EPP,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 9,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x300,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x17,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x0a,\n\t\t.name = \"g2pr\",\n\t\t.swgroup = TEGRA_SWGROUP_G2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 10,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x308,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x09,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x0b,\n\t\t.name = \"g2sr\",\n\t\t.swgroup = TEGRA_SWGROUP_G2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 11,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x308,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x09,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x0c,\n\t\t.name = \"mpeunifbr\",\n\t\t.swgroup = TEGRA_SWGROUP_MPE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 12,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x328,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x50,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x0d,\n\t\t.name = \"viruv\",\n\t\t.swgroup = TEGRA_SWGROUP_VI,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 13,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x364,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x2c,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x0e,\n\t\t.name = \"afir\",\n\t\t.swgroup = TEGRA_SWGROUP_AFI,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 14,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2e0,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x10,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 32,\n\t}, {\n\t\t.id = 0x0f,\n\t\t.name = \"avpcarm7r\",\n\t\t.swgroup = TEGRA_SWGROUP_AVPC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 15,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2e4,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x04,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x10,\n\t\t.name = \"displayhc\",\n\t\t.swgroup = TEGRA_SWGROUP_DC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 16,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2f0,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x11,\n\t\t.name = \"displayhcb\",\n\t\t.swgroup = TEGRA_SWGROUP_DCB,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 17,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2fc,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x12,\n\t\t.name = \"fdcdrd\",\n\t\t.swgroup = TEGRA_SWGROUP_NV,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 18,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x334,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0a,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 48,\n\t}, {\n\t\t.id = 0x13,\n\t\t.name = \"fdcdrd2\",\n\t\t.swgroup = TEGRA_SWGROUP_NV2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 19,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x33c,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0a,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 48,\n\t}, {\n\t\t.id = 0x14,\n\t\t.name = \"g2dr\",\n\t\t.swgroup = TEGRA_SWGROUP_G2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 20,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x30c,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0a,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 48,\n\t}, {\n\t\t.id = 0x15,\n\t\t.name = \"hdar\",\n\t\t.swgroup = TEGRA_SWGROUP_HDA,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 21,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x318,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 16,\n\t}, {\n\t\t.id = 0x16,\n\t\t.name = \"host1xdmar\",\n\t\t.swgroup = TEGRA_SWGROUP_HC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 22,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x310,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x05,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 16,\n\t}, {\n\t\t.id = 0x17,\n\t\t.name = \"host1xr\",\n\t\t.swgroup = TEGRA_SWGROUP_HC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 23,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x310,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x50,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x18,\n\t\t.name = \"idxsrd\",\n\t\t.swgroup = TEGRA_SWGROUP_NV,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 24,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x334,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x13,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x19,\n\t\t.name = \"idxsrd2\",\n\t\t.swgroup = TEGRA_SWGROUP_NV2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 25,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x33c,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x13,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x1a,\n\t\t.name = \"mpe_ipred\",\n\t\t.swgroup = TEGRA_SWGROUP_MPE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 26,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x328,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x80,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x1b,\n\t\t.name = \"mpeamemrd\",\n\t\t.swgroup = TEGRA_SWGROUP_MPE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 27,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x32c,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x42,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x1c,\n\t\t.name = \"mpecsrd\",\n\t\t.swgroup = TEGRA_SWGROUP_MPE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 28,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x32c,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x1d,\n\t\t.name = \"ppcsahbdmar\",\n\t\t.swgroup = TEGRA_SWGROUP_PPCS,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 29,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x344,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x10,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x1e,\n\t\t.name = \"ppcsahbslvr\",\n\t\t.swgroup = TEGRA_SWGROUP_PPCS,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 30,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x344,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x12,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x1f,\n\t\t.name = \"satar\",\n\t\t.swgroup = TEGRA_SWGROUP_SATA,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x228,\n\t\t\t\t.bit = 31,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x350,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x33,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 32,\n\t}, {\n\t\t.id = 0x20,\n\t\t.name = \"texsrd\",\n\t\t.swgroup = TEGRA_SWGROUP_NV,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 0,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x338,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x13,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x21,\n\t\t.name = \"texsrd2\",\n\t\t.swgroup = TEGRA_SWGROUP_NV2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 1,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x340,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x13,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x22,\n\t\t.name = \"vdebsevr\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 2,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x354,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x23,\n\t\t.name = \"vdember\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 3,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x354,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xd0,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 4,\n\t}, {\n\t\t.id = 0x24,\n\t\t.name = \"vdemcer\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 4,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x358,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x2a,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 16,\n\t}, {\n\t\t.id = 0x25,\n\t\t.name = \"vdetper\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 5,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x358,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x74,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 16,\n\t}, {\n\t\t.id = 0x26,\n\t\t.name = \"mpcorelpr\",\n\t\t.swgroup = TEGRA_SWGROUP_MPCORELP,\n\t\t.regs = {\n\t\t\t.la = {\n\t\t\t\t.reg = 0x324,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x04,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 14,\n\t}, {\n\t\t.id = 0x27,\n\t\t.name = \"mpcorer\",\n\t\t.swgroup = TEGRA_SWGROUP_MPCORE,\n\t\t.regs = {\n\t\t\t.la = {\n\t\t\t\t.reg = 0x320,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x04,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 14,\n\t}, {\n\t\t.id = 0x28,\n\t\t.name = \"eppu\",\n\t\t.swgroup = TEGRA_SWGROUP_EPP,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 8,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x300,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x6c,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x29,\n\t\t.name = \"eppv\",\n\t\t.swgroup = TEGRA_SWGROUP_EPP,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 9,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x304,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x6c,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x2a,\n\t\t.name = \"eppy\",\n\t\t.swgroup = TEGRA_SWGROUP_EPP,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 10,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x304,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x6c,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x2b,\n\t\t.name = \"mpeunifbw\",\n\t\t.swgroup = TEGRA_SWGROUP_MPE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 11,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x330,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x13,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x2c,\n\t\t.name = \"viwsb\",\n\t\t.swgroup = TEGRA_SWGROUP_VI,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 12,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x364,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x12,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x2d,\n\t\t.name = \"viwu\",\n\t\t.swgroup = TEGRA_SWGROUP_VI,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 13,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x368,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xb2,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x2e,\n\t\t.name = \"viwv\",\n\t\t.swgroup = TEGRA_SWGROUP_VI,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 14,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x368,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xb2,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x2f,\n\t\t.name = \"viwy\",\n\t\t.swgroup = TEGRA_SWGROUP_VI,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 15,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x36c,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x12,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x30,\n\t\t.name = \"g2dw\",\n\t\t.swgroup = TEGRA_SWGROUP_G2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 16,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x30c,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x9,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 128,\n\t}, {\n\t\t.id = 0x31,\n\t\t.name = \"afiw\",\n\t\t.swgroup = TEGRA_SWGROUP_AFI,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 17,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2e0,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0c,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 32,\n\t}, {\n\t\t.id = 0x32,\n\t\t.name = \"avpcarm7w\",\n\t\t.swgroup = TEGRA_SWGROUP_AVPC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 18,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x2e4,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x33,\n\t\t.name = \"fdcdwr\",\n\t\t.swgroup = TEGRA_SWGROUP_NV,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 19,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x338,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0a,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 48,\n\t}, {\n\t\t.id = 0x34,\n\t\t.name = \"fdcdwr2\",\n\t\t.swgroup = TEGRA_SWGROUP_NV2,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 20,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x340,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0a,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 48,\n\t}, {\n\t\t.id = 0x35,\n\t\t.name = \"hdaw\",\n\t\t.swgroup = TEGRA_SWGROUP_HDA,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 21,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x318,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 16,\n\t}, {\n\t\t.id = 0x36,\n\t\t.name = \"host1xw\",\n\t\t.swgroup = TEGRA_SWGROUP_HC,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 22,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x314,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x10,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 32,\n\t}, {\n\t\t.id = 0x37,\n\t\t.name = \"ispw\",\n\t\t.swgroup = TEGRA_SWGROUP_ISP,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 23,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x31c,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 64,\n\t}, {\n\t\t.id = 0x38,\n\t\t.name = \"mpcorelpw\",\n\t\t.swgroup = TEGRA_SWGROUP_MPCORELP,\n\t\t.regs = {\n\t\t\t.la = {\n\t\t\t\t.reg = 0x324,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 24,\n\t}, {\n\t\t.id = 0x39,\n\t\t.name = \"mpcorew\",\n\t\t.swgroup = TEGRA_SWGROUP_MPCORE,\n\t\t.regs = {\n\t\t\t.la = {\n\t\t\t\t.reg = 0x320,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x0e,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 24,\n\t}, {\n\t\t.id = 0x3a,\n\t\t.name = \"mpecswr\",\n\t\t.swgroup = TEGRA_SWGROUP_MPE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 26,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x330,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 8,\n\t}, {\n\t\t.id = 0x3b,\n\t\t.name = \"ppcsahbdmaw\",\n\t\t.swgroup = TEGRA_SWGROUP_PPCS,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 27,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x348,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x10,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x3c,\n\t\t.name = \"ppcsahbslvw\",\n\t\t.swgroup = TEGRA_SWGROUP_PPCS,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 28,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x348,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x06,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 4,\n\t}, {\n\t\t.id = 0x3d,\n\t\t.name = \"sataw\",\n\t\t.swgroup = TEGRA_SWGROUP_SATA,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 29,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x350,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x33,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 32,\n\t}, {\n\t\t.id = 0x3e,\n\t\t.name = \"vdebsevw\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 30,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x35c,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 4,\n\t}, {\n\t\t.id = 0x3f,\n\t\t.name = \"vdedbgw\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x22c,\n\t\t\t\t.bit = 31,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x35c,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0xff,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 16,\n\t}, {\n\t\t.id = 0x40,\n\t\t.name = \"vdembew\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x230,\n\t\t\t\t.bit = 0,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x360,\n\t\t\t\t.shift = 0,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x42,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 2,\n\t}, {\n\t\t.id = 0x41,\n\t\t.name = \"vdetpmw\",\n\t\t.swgroup = TEGRA_SWGROUP_VDE,\n\t\t.regs = {\n\t\t\t.smmu = {\n\t\t\t\t.reg = 0x230,\n\t\t\t\t.bit = 1,\n\t\t\t},\n\t\t\t.la = {\n\t\t\t\t.reg = 0x360,\n\t\t\t\t.shift = 16,\n\t\t\t\t.mask = 0xff,\n\t\t\t\t.def = 0x2a,\n\t\t\t},\n\t\t},\n\t\t.fifo_size = 16 * 16,\n\t},\n};\n\nstatic const struct tegra_smmu_swgroup tegra30_swgroups[] = {\n\t{ .name = \"dc\",   .swgroup = TEGRA_SWGROUP_DC,   .reg = 0x240 },\n\t{ .name = \"dcb\",  .swgroup = TEGRA_SWGROUP_DCB,  .reg = 0x244 },\n\t{ .name = \"epp\",  .swgroup = TEGRA_SWGROUP_EPP,  .reg = 0x248 },\n\t{ .name = \"g2\",   .swgroup = TEGRA_SWGROUP_G2,   .reg = 0x24c },\n\t{ .name = \"mpe\",  .swgroup = TEGRA_SWGROUP_MPE,  .reg = 0x264 },\n\t{ .name = \"vi\",   .swgroup = TEGRA_SWGROUP_VI,   .reg = 0x280 },\n\t{ .name = \"afi\",  .swgroup = TEGRA_SWGROUP_AFI,  .reg = 0x238 },\n\t{ .name = \"avpc\", .swgroup = TEGRA_SWGROUP_AVPC, .reg = 0x23c },\n\t{ .name = \"nv\",   .swgroup = TEGRA_SWGROUP_NV,   .reg = 0x268 },\n\t{ .name = \"nv2\",  .swgroup = TEGRA_SWGROUP_NV2,  .reg = 0x26c },\n\t{ .name = \"hda\",  .swgroup = TEGRA_SWGROUP_HDA,  .reg = 0x254 },\n\t{ .name = \"hc\",   .swgroup = TEGRA_SWGROUP_HC,   .reg = 0x250 },\n\t{ .name = \"ppcs\", .swgroup = TEGRA_SWGROUP_PPCS, .reg = 0x270 },\n\t{ .name = \"sata\", .swgroup = TEGRA_SWGROUP_SATA, .reg = 0x278 },\n\t{ .name = \"vde\",  .swgroup = TEGRA_SWGROUP_VDE,  .reg = 0x27c },\n\t{ .name = \"isp\",  .swgroup = TEGRA_SWGROUP_ISP,  .reg = 0x258 },\n};\n\nstatic const unsigned int tegra30_group_drm[] = {\n\tTEGRA_SWGROUP_DC,\n\tTEGRA_SWGROUP_DCB,\n\tTEGRA_SWGROUP_G2,\n\tTEGRA_SWGROUP_NV,\n\tTEGRA_SWGROUP_NV2,\n};\n\nstatic const struct tegra_smmu_group_soc tegra30_groups[] = {\n\t{\n\t\t.name = \"drm\",\n\t\t.swgroups = tegra30_group_drm,\n\t\t.num_swgroups = ARRAY_SIZE(tegra30_group_drm),\n\t},\n};\n\nstatic const struct tegra_smmu_soc tegra30_smmu_soc = {\n\t.clients = tegra30_mc_clients,\n\t.num_clients = ARRAY_SIZE(tegra30_mc_clients),\n\t.swgroups = tegra30_swgroups,\n\t.num_swgroups = ARRAY_SIZE(tegra30_swgroups),\n\t.groups = tegra30_groups,\n\t.num_groups = ARRAY_SIZE(tegra30_groups),\n\t.supports_round_robin_arbitration = false,\n\t.supports_request_limit = false,\n\t.num_tlb_lines = 16,\n\t.num_asids = 4,\n};\n\n#define TEGRA30_MC_RESET(_name, _control, _status, _bit)\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.name = #_name,\t\t\t\t\t\\\n\t\t.id = TEGRA30_MC_RESET_##_name,\t\t\t\\\n\t\t.control = _control,\t\t\t\t\\\n\t\t.status = _status,\t\t\t\t\\\n\t\t.bit = _bit,\t\t\t\t\t\\\n\t}\n\nstatic const struct tegra_mc_reset tegra30_mc_resets[] = {\n\tTEGRA30_MC_RESET(AFI,      0x200, 0x204,  0),\n\tTEGRA30_MC_RESET(AVPC,     0x200, 0x204,  1),\n\tTEGRA30_MC_RESET(DC,       0x200, 0x204,  2),\n\tTEGRA30_MC_RESET(DCB,      0x200, 0x204,  3),\n\tTEGRA30_MC_RESET(EPP,      0x200, 0x204,  4),\n\tTEGRA30_MC_RESET(2D,       0x200, 0x204,  5),\n\tTEGRA30_MC_RESET(HC,       0x200, 0x204,  6),\n\tTEGRA30_MC_RESET(HDA,      0x200, 0x204,  7),\n\tTEGRA30_MC_RESET(ISP,      0x200, 0x204,  8),\n\tTEGRA30_MC_RESET(MPCORE,   0x200, 0x204,  9),\n\tTEGRA30_MC_RESET(MPCORELP, 0x200, 0x204, 10),\n\tTEGRA30_MC_RESET(MPE,      0x200, 0x204, 11),\n\tTEGRA30_MC_RESET(3D,       0x200, 0x204, 12),\n\tTEGRA30_MC_RESET(3D2,      0x200, 0x204, 13),\n\tTEGRA30_MC_RESET(PPCS,     0x200, 0x204, 14),\n\tTEGRA30_MC_RESET(SATA,     0x200, 0x204, 15),\n\tTEGRA30_MC_RESET(VDE,      0x200, 0x204, 16),\n\tTEGRA30_MC_RESET(VI,       0x200, 0x204, 17),\n};\n\nstatic void tegra30_mc_tune_client_latency(struct tegra_mc *mc,\n\t\t\t\t\t   const struct tegra_mc_client *client,\n\t\t\t\t\t   unsigned int bandwidth_mbytes_sec)\n{\n\tu32 arb_tolerance_compensation_nsec, arb_tolerance_compensation_div;\n\tunsigned int fifo_size = client->fifo_size;\n\tu32 arb_nsec, la_ticks, value;\n\n\t \n\tif (bandwidth_mbytes_sec)\n\t\tarb_nsec = fifo_size * NSEC_PER_USEC / bandwidth_mbytes_sec;\n\telse\n\t\tarb_nsec = U32_MAX;\n\n\t \n\tswitch (client->swgroup) {\n\tcase TEGRA_SWGROUP_MPCORE:\n\tcase TEGRA_SWGROUP_PTC:\n\t\t \n\t\treturn;\n\n\tcase TEGRA_SWGROUP_DC:\n\tcase TEGRA_SWGROUP_DCB:\n\t\tarb_tolerance_compensation_nsec = 1050;\n\t\tarb_tolerance_compensation_div = 2;\n\t\tbreak;\n\n\tcase TEGRA_SWGROUP_VI:\n\t\tarb_tolerance_compensation_nsec = 1050;\n\t\tarb_tolerance_compensation_div = 1;\n\t\tbreak;\n\n\tdefault:\n\t\tarb_tolerance_compensation_nsec = 150;\n\t\tarb_tolerance_compensation_div = 1;\n\t\tbreak;\n\t}\n\n\tif (arb_nsec > arb_tolerance_compensation_nsec)\n\t\tarb_nsec -= arb_tolerance_compensation_nsec;\n\telse\n\t\tarb_nsec = 0;\n\n\tarb_nsec /= arb_tolerance_compensation_div;\n\n\t \n\tla_ticks = arb_nsec / mc->tick;\n\tla_ticks = min(la_ticks, client->regs.la.mask);\n\n\tvalue = mc_readl(mc, client->regs.la.reg);\n\tvalue &= ~(client->regs.la.mask << client->regs.la.shift);\n\tvalue |= la_ticks << client->regs.la.shift;\n\tmc_writel(mc, value, client->regs.la.reg);\n}\n\nstatic int tegra30_mc_icc_set(struct icc_node *src, struct icc_node *dst)\n{\n\tstruct tegra_mc *mc = icc_provider_to_tegra_mc(src->provider);\n\tconst struct tegra_mc_client *client = &mc->soc->clients[src->id];\n\tu64 peak_bandwidth = icc_units_to_bps(src->peak_bw);\n\n\t \n\tif (src == dst)\n\t\treturn 0;\n\n\t \n\tdo_div(peak_bandwidth, 1000000);\n\n\ttegra30_mc_tune_client_latency(mc, client, peak_bandwidth);\n\n\treturn 0;\n}\n\nstatic int tegra30_mc_icc_aggreate(struct icc_node *node, u32 tag, u32 avg_bw,\n\t\t\t\t   u32 peak_bw, u32 *agg_avg, u32 *agg_peak)\n{\n\t \n\tif (tag & TEGRA_MC_ICC_TAG_ISO)\n\t\tpeak_bw = tegra_mc_scale_percents(peak_bw, 400);\n\n\t*agg_avg += avg_bw;\n\t*agg_peak = max(*agg_peak, peak_bw);\n\n\treturn 0;\n}\n\nstatic struct icc_node_data *\ntegra30_mc_of_icc_xlate_extended(struct of_phandle_args *spec, void *data)\n{\n\tstruct tegra_mc *mc = icc_provider_to_tegra_mc(data);\n\tconst struct tegra_mc_client *client;\n\tunsigned int i, idx = spec->args[0];\n\tstruct icc_node_data *ndata;\n\tstruct icc_node *node;\n\n\tlist_for_each_entry(node, &mc->provider.nodes, node_list) {\n\t\tif (node->id != idx)\n\t\t\tcontinue;\n\n\t\tndata = kzalloc(sizeof(*ndata), GFP_KERNEL);\n\t\tif (!ndata)\n\t\t\treturn ERR_PTR(-ENOMEM);\n\n\t\tclient = &mc->soc->clients[idx];\n\t\tndata->node = node;\n\n\t\tswitch (client->swgroup) {\n\t\tcase TEGRA_SWGROUP_DC:\n\t\tcase TEGRA_SWGROUP_DCB:\n\t\tcase TEGRA_SWGROUP_PTC:\n\t\tcase TEGRA_SWGROUP_VI:\n\t\t\t \n\t\t\tndata->tag = TEGRA_MC_ICC_TAG_ISO;\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tndata->tag = TEGRA_MC_ICC_TAG_DEFAULT;\n\t\t\tbreak;\n\t\t}\n\n\t\treturn ndata;\n\t}\n\n\tfor (i = 0; i < mc->soc->num_clients; i++) {\n\t\tif (mc->soc->clients[i].id == idx)\n\t\t\treturn ERR_PTR(-EPROBE_DEFER);\n\t}\n\n\tdev_err(mc->dev, \"invalid ICC client ID %u\\n\", idx);\n\n\treturn ERR_PTR(-EINVAL);\n}\n\nstatic const struct tegra_mc_icc_ops tegra30_mc_icc_ops = {\n\t.xlate_extended = tegra30_mc_of_icc_xlate_extended,\n\t.aggregate = tegra30_mc_icc_aggreate,\n\t.set = tegra30_mc_icc_set,\n};\n\nconst struct tegra_mc_soc tegra30_mc_soc = {\n\t.clients = tegra30_mc_clients,\n\t.num_clients = ARRAY_SIZE(tegra30_mc_clients),\n\t.num_address_bits = 32,\n\t.atom_size = 16,\n\t.client_id_mask = 0x7f,\n\t.smmu = &tegra30_smmu_soc,\n\t.emem_regs = tegra30_mc_emem_regs,\n\t.num_emem_regs = ARRAY_SIZE(tegra30_mc_emem_regs),\n\t.intmask = MC_INT_INVALID_SMMU_PAGE | MC_INT_SECURITY_VIOLATION |\n\t\t   MC_INT_DECERR_EMEM,\n\t.reset_ops = &tegra_mc_reset_ops_common,\n\t.resets = tegra30_mc_resets,\n\t.num_resets = ARRAY_SIZE(tegra30_mc_resets),\n\t.icc_ops = &tegra30_mc_icc_ops,\n\t.ops = &tegra30_mc_ops,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}