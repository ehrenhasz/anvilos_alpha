{
  "module_name": "pcf50633-regulator.c",
  "hash_id": "5b8f63809314c11024f305209802db1e5866e1595c0dbcb40dad286d4030be03",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/pcf50633-regulator.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/platform_device.h>\n\n#include <linux/mfd/pcf50633/core.h>\n#include <linux/mfd/pcf50633/pmic.h>\n\n#define PCF50633_REGULATOR(_name, _id, _min_uV, _uV_step, _min_sel, _n) \\\n\t{\t\t\t\t\t\t\t\\\n\t\t.name = _name,\t\t\t\t\t\\\n\t\t.id = PCF50633_REGULATOR_##_id,\t\t\t\\\n\t\t.ops = &pcf50633_regulator_ops,\t\t\t\\\n\t\t.n_voltages = _n,\t\t\t\t\\\n\t\t.min_uV = _min_uV,\t\t\t\t\\\n\t\t.uV_step = _uV_step,\t\t\t\t\\\n\t\t.linear_min_sel = _min_sel,\t\t\t\\\n\t\t.type = REGULATOR_VOLTAGE,\t\t\t\\\n\t\t.owner = THIS_MODULE,\t\t\t\t\\\n\t\t.vsel_reg = PCF50633_REG_##_id##OUT,\t\t\\\n\t\t.vsel_mask = 0xff,\t\t\t\t\\\n\t\t.enable_reg = PCF50633_REG_##_id##OUT + 1,\t\\\n\t\t.enable_mask = PCF50633_REGULATOR_ON,\t\t\\\n\t}\n\nstatic const struct regulator_ops pcf50633_regulator_ops = {\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.list_voltage = regulator_list_voltage_linear,\n\t.map_voltage = regulator_map_voltage_linear,\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n};\n\nstatic const struct regulator_desc regulators[] = {\n\t[PCF50633_REGULATOR_AUTO] =\n\t\tPCF50633_REGULATOR(\"auto\", AUTO, 1800000, 25000, 0x2f, 128),\n\t[PCF50633_REGULATOR_DOWN1] =\n\t\tPCF50633_REGULATOR(\"down1\", DOWN1, 625000, 25000, 0, 96),\n\t[PCF50633_REGULATOR_DOWN2] =\n\t\tPCF50633_REGULATOR(\"down2\", DOWN2, 625000, 25000, 0, 96),\n\t[PCF50633_REGULATOR_LDO1] =\n\t\tPCF50633_REGULATOR(\"ldo1\", LDO1, 900000, 100000, 0, 28),\n\t[PCF50633_REGULATOR_LDO2] =\n\t\tPCF50633_REGULATOR(\"ldo2\", LDO2, 900000, 100000, 0, 28),\n\t[PCF50633_REGULATOR_LDO3] =\n\t\tPCF50633_REGULATOR(\"ldo3\", LDO3, 900000, 100000, 0, 28),\n\t[PCF50633_REGULATOR_LDO4] =\n\t\tPCF50633_REGULATOR(\"ldo4\", LDO4, 900000, 100000, 0, 28),\n\t[PCF50633_REGULATOR_LDO5] =\n\t\tPCF50633_REGULATOR(\"ldo5\", LDO5, 900000, 100000, 0, 28),\n\t[PCF50633_REGULATOR_LDO6] =\n\t\tPCF50633_REGULATOR(\"ldo6\", LDO6, 900000, 100000, 0, 28),\n\t[PCF50633_REGULATOR_HCLDO] =\n\t\tPCF50633_REGULATOR(\"hcldo\", HCLDO, 900000, 100000, 0, 28),\n\t[PCF50633_REGULATOR_MEMLDO] =\n\t\tPCF50633_REGULATOR(\"memldo\", MEMLDO, 900000, 100000, 0, 28),\n};\n\nstatic int pcf50633_regulator_probe(struct platform_device *pdev)\n{\n\tstruct regulator_dev *rdev;\n\tstruct pcf50633 *pcf;\n\tstruct regulator_config config = { };\n\n\t \n\tpcf = dev_to_pcf50633(pdev->dev.parent);\n\n\tconfig.dev = &pdev->dev;\n\tconfig.init_data = dev_get_platdata(&pdev->dev);\n\tconfig.driver_data = pcf;\n\tconfig.regmap = pcf->regmap;\n\n\trdev = devm_regulator_register(&pdev->dev, &regulators[pdev->id],\n\t\t\t\t       &config);\n\tif (IS_ERR(rdev))\n\t\treturn PTR_ERR(rdev);\n\n\tplatform_set_drvdata(pdev, rdev);\n\n\tif (pcf->pdata->regulator_registered)\n\t\tpcf->pdata->regulator_registered(pcf, pdev->id);\n\n\treturn 0;\n}\n\nstatic struct platform_driver pcf50633_regulator_driver = {\n\t.driver = {\n\t\t.name = \"pcf50633-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = pcf50633_regulator_probe,\n};\n\nstatic int __init pcf50633_regulator_init(void)\n{\n\treturn platform_driver_register(&pcf50633_regulator_driver);\n}\nsubsys_initcall(pcf50633_regulator_init);\n\nstatic void __exit pcf50633_regulator_exit(void)\n{\n\tplatform_driver_unregister(&pcf50633_regulator_driver);\n}\nmodule_exit(pcf50633_regulator_exit);\n\nMODULE_AUTHOR(\"Balaji Rao <balajirrao@openmoko.org>\");\nMODULE_DESCRIPTION(\"PCF50633 regulator driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:pcf50633-regulator\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}