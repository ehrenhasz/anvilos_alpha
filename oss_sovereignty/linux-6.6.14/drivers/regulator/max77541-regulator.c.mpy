{
  "module_name": "max77541-regulator.c",
  "hash_id": "eb535325cc1c04e1e3ccff5733203c13710ab635f330d56d9ceb34d6840c4a12",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/max77541-regulator.c",
  "human_readable_source": "\n \n\n#include <linux/mfd/max77541.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n\nstatic const struct regulator_ops max77541_buck_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_pickable_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_pickable_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_pickable_regmap,\n};\n\nstatic const struct linear_range max77540_buck_ranges[] = {\n\t \n\tREGULATOR_LINEAR_RANGE(500000, 0x00, 0x8B, 5000),\n\tREGULATOR_LINEAR_RANGE(1200000, 0x8C, 0xFF, 0),\n\t \n\tREGULATOR_LINEAR_RANGE(1200000, 0x00, 0x8B, 10000),\n\tREGULATOR_LINEAR_RANGE(2400000, 0x8C, 0xFF, 0),\n\t \n\tREGULATOR_LINEAR_RANGE(2000000, 0x00, 0x9F, 20000),\n\tREGULATOR_LINEAR_RANGE(5200000, 0xA0, 0xFF, 0),\n};\n\nstatic const struct linear_range max77541_buck_ranges[] = {\n\t \n\tREGULATOR_LINEAR_RANGE(300000, 0x00, 0xB3, 5000),\n\tREGULATOR_LINEAR_RANGE(1200000, 0xB4, 0xFF, 0),\n\t \n\tREGULATOR_LINEAR_RANGE(1200000, 0x00, 0x8B, 10000),\n\tREGULATOR_LINEAR_RANGE(2400000, 0x8C, 0xFF, 0),\n\t \n\tREGULATOR_LINEAR_RANGE(2000000, 0x00, 0x9F, 20000),\n\tREGULATOR_LINEAR_RANGE(5200000, 0xA0, 0xFF, 0),\n};\n\nstatic const unsigned int max77541_buck_volt_range_sel[] = {\n\t0x0, 0x0, 0x1, 0x1, 0x2, 0x2,\n};\n\nenum max77541_regulators {\n\tMAX77541_BUCK1 = 1,\n\tMAX77541_BUCK2,\n};\n\n#define MAX77540_BUCK(_id, _ops)\t\t\t\t\t\\\n\t{\t.id = MAX77541_BUCK ## _id,\t\t\t\t\\\n\t\t.name = \"buck\"#_id,\t\t\t\t\t\\\n\t\t.of_match = \"buck\"#_id,\t\t\t\t\t\\\n\t\t.regulators_node = \"regulators\",\t\t\t\\\n\t\t.enable_reg = MAX77541_REG_EN_CTRL,\t\t\t\\\n\t\t.enable_mask = MAX77541_BIT_M ## _id ## _EN,\t\t\\\n\t\t.ops = &(_ops),\t\t\t\t\t\t\\\n\t\t.type = REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.linear_ranges = max77540_buck_ranges,\t\t\t\\\n\t\t.n_linear_ranges = ARRAY_SIZE(max77540_buck_ranges),\t\\\n\t\t.vsel_reg = MAX77541_REG_M ## _id ## _VOUT,\t\t\\\n\t\t.vsel_mask = MAX77541_BITS_MX_VOUT,\t\t\t\\\n\t\t.vsel_range_reg = MAX77541_REG_M ## _id ## _CFG1,\t\\\n\t\t.vsel_range_mask = MAX77541_BITS_MX_CFG1_RNG,\t\t\\\n\t\t.linear_range_selectors_bitfield = max77541_buck_volt_range_sel, \\\n\t\t.owner = THIS_MODULE,\t\t\t\t\t\\\n\t}\n\n#define MAX77541_BUCK(_id, _ops)\t\t\t\t\t\\\n\t{\t.id = MAX77541_BUCK ## _id,\t\t\t\t\\\n\t\t.name = \"buck\"#_id,\t\t\t\t\t\\\n\t\t.of_match = \"buck\"#_id,\t\t\t\t\t\\\n\t\t.regulators_node = \"regulators\",\t\t\t\\\n\t\t.enable_reg = MAX77541_REG_EN_CTRL,\t\t\t\\\n\t\t.enable_mask = MAX77541_BIT_M ## _id ## _EN,\t\t\\\n\t\t.ops = &(_ops),\t\t\t\t\t\t\\\n\t\t.type = REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.linear_ranges = max77541_buck_ranges,\t\t\t\\\n\t\t.n_linear_ranges = ARRAY_SIZE(max77541_buck_ranges),\t\\\n\t\t.vsel_reg = MAX77541_REG_M ## _id ## _VOUT,\t\t\\\n\t\t.vsel_mask = MAX77541_BITS_MX_VOUT,\t\t\t\\\n\t\t.vsel_range_reg = MAX77541_REG_M ## _id ## _CFG1,\t\\\n\t\t.vsel_range_mask = MAX77541_BITS_MX_CFG1_RNG,\t\t\\\n\t\t.linear_range_selectors_bitfield = max77541_buck_volt_range_sel, \\\n\t\t.owner = THIS_MODULE,\t\t\t\t\t\\\n\t}\n\nstatic const struct regulator_desc max77540_regulators_desc[] = {\n\tMAX77540_BUCK(1, max77541_buck_ops),\n\tMAX77540_BUCK(2, max77541_buck_ops),\n};\n\nstatic const struct regulator_desc max77541_regulators_desc[] = {\n\tMAX77541_BUCK(1, max77541_buck_ops),\n\tMAX77541_BUCK(2, max77541_buck_ops),\n};\n\nstatic int max77541_regulator_probe(struct platform_device *pdev)\n{\n\tstruct regulator_config config = {};\n\tconst struct regulator_desc *desc;\n\tstruct device *dev = &pdev->dev;\n\tstruct regulator_dev *rdev;\n\tstruct max77541 *max77541 = dev_get_drvdata(dev->parent);\n\tunsigned int i;\n\n\tconfig.dev = dev->parent;\n\n\tswitch (max77541->id) {\n\tcase MAX77540:\n\t\tdesc = max77540_regulators_desc;\n\t\tbreak;\n\tcase MAX77541:\n\t\tdesc = max77541_regulators_desc;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tfor (i = 0; i < MAX77541_MAX_REGULATORS; i++) {\n\t\trdev = devm_regulator_register(dev, &desc[i], &config);\n\t\tif (IS_ERR(rdev))\n\t\t\treturn dev_err_probe(dev, PTR_ERR(rdev),\n\t\t\t\t\t     \"Failed to register regulator\\n\");\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id max77541_regulator_platform_id[] = {\n\t{ \"max77540-regulator\" },\n\t{ \"max77541-regulator\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(platform, max77541_regulator_platform_id);\n\nstatic struct platform_driver max77541_regulator_driver = {\n\t.driver = {\n\t\t.name = \"max77541-regulator\",\n\t},\n\t.probe = max77541_regulator_probe,\n\t.id_table = max77541_regulator_platform_id,\n};\nmodule_platform_driver(max77541_regulator_driver);\n\nMODULE_AUTHOR(\"Okan Sahin <Okan.Sahin@analog.com>\");\nMODULE_DESCRIPTION(\"MAX77540/MAX77541 regulator driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}