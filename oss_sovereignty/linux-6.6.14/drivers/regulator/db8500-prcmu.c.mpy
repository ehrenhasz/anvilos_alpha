{
  "module_name": "db8500-prcmu.c",
  "hash_id": "0d702dc3e71f9deb62f43d701f342caa2534f8e5f0c4afcce8a05b9f472fbd51",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/db8500-prcmu.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/err.h>\n#include <linux/spinlock.h>\n#include <linux/platform_device.h>\n#include <linux/mfd/dbx500-prcmu.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/db8500-prcmu.h>\n#include <linux/regulator/of_regulator.h>\n#include <linux/of.h>\n#include <linux/module.h>\n#include \"dbx500-prcmu.h\"\n\nstatic int db8500_regulator_enable(struct regulator_dev *rdev)\n{\n\tstruct dbx500_regulator_info *info = rdev_get_drvdata(rdev);\n\n\tif (info == NULL)\n\t\treturn -EINVAL;\n\n\tdev_vdbg(rdev_get_dev(rdev), \"regulator-%s-enable\\n\",\n\t\tinfo->desc.name);\n\n\tif (!info->is_enabled) {\n\t\tinfo->is_enabled = true;\n\t\tif (!info->exclude_from_power_state)\n\t\t\tpower_state_active_enable();\n\t}\n\n\treturn 0;\n}\n\nstatic int db8500_regulator_disable(struct regulator_dev *rdev)\n{\n\tstruct dbx500_regulator_info *info = rdev_get_drvdata(rdev);\n\tint ret = 0;\n\n\tif (info == NULL)\n\t\treturn -EINVAL;\n\n\tdev_vdbg(rdev_get_dev(rdev), \"regulator-%s-disable\\n\",\n\t\tinfo->desc.name);\n\n\tif (info->is_enabled) {\n\t\tinfo->is_enabled = false;\n\t\tif (!info->exclude_from_power_state)\n\t\t\tret = power_state_active_disable();\n\t}\n\n\treturn ret;\n}\n\nstatic int db8500_regulator_is_enabled(struct regulator_dev *rdev)\n{\n\tstruct dbx500_regulator_info *info = rdev_get_drvdata(rdev);\n\n\tif (info == NULL)\n\t\treturn -EINVAL;\n\n\tdev_vdbg(rdev_get_dev(rdev), \"regulator-%s-is_enabled (is_enabled):\"\n\t\t\" %i\\n\", info->desc.name, info->is_enabled);\n\n\treturn info->is_enabled;\n}\n\n \nstatic const struct regulator_ops db8500_regulator_ops = {\n\t.enable\t\t\t= db8500_regulator_enable,\n\t.disable\t\t= db8500_regulator_disable,\n\t.is_enabled\t\t= db8500_regulator_is_enabled,\n};\n\n \nstatic bool epod_on[NUM_EPOD_ID];\nstatic bool epod_ramret[NUM_EPOD_ID];\n\nstatic int enable_epod(u16 epod_id, bool ramret)\n{\n\tint ret;\n\n\tif (ramret) {\n\t\tif (!epod_on[epod_id]) {\n\t\t\tret = prcmu_set_epod(epod_id, EPOD_STATE_RAMRET);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t}\n\t\tepod_ramret[epod_id] = true;\n\t} else {\n\t\tret = prcmu_set_epod(epod_id, EPOD_STATE_ON);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tepod_on[epod_id] = true;\n\t}\n\n\treturn 0;\n}\n\nstatic int disable_epod(u16 epod_id, bool ramret)\n{\n\tint ret;\n\n\tif (ramret) {\n\t\tif (!epod_on[epod_id]) {\n\t\t\tret = prcmu_set_epod(epod_id, EPOD_STATE_OFF);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t}\n\t\tepod_ramret[epod_id] = false;\n\t} else {\n\t\tif (epod_ramret[epod_id]) {\n\t\t\tret = prcmu_set_epod(epod_id, EPOD_STATE_RAMRET);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t} else {\n\t\t\tret = prcmu_set_epod(epod_id, EPOD_STATE_OFF);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t}\n\t\tepod_on[epod_id] = false;\n\t}\n\n\treturn 0;\n}\n\n \nstatic int db8500_regulator_switch_enable(struct regulator_dev *rdev)\n{\n\tstruct dbx500_regulator_info *info = rdev_get_drvdata(rdev);\n\tint ret;\n\n\tif (info == NULL)\n\t\treturn -EINVAL;\n\n\tdev_vdbg(rdev_get_dev(rdev), \"regulator-switch-%s-enable\\n\",\n\t\tinfo->desc.name);\n\n\tret = enable_epod(info->epod_id, info->is_ramret);\n\tif (ret < 0) {\n\t\tdev_err(rdev_get_dev(rdev),\n\t\t\t\"regulator-switch-%s-enable: prcmu call failed\\n\",\n\t\t\tinfo->desc.name);\n\t\tgoto out;\n\t}\n\n\tinfo->is_enabled = true;\nout:\n\treturn ret;\n}\n\nstatic int db8500_regulator_switch_disable(struct regulator_dev *rdev)\n{\n\tstruct dbx500_regulator_info *info = rdev_get_drvdata(rdev);\n\tint ret;\n\n\tif (info == NULL)\n\t\treturn -EINVAL;\n\n\tdev_vdbg(rdev_get_dev(rdev), \"regulator-switch-%s-disable\\n\",\n\t\tinfo->desc.name);\n\n\tret = disable_epod(info->epod_id, info->is_ramret);\n\tif (ret < 0) {\n\t\tdev_err(rdev_get_dev(rdev),\n\t\t\t\"regulator_switch-%s-disable: prcmu call failed\\n\",\n\t\t\tinfo->desc.name);\n\t\tgoto out;\n\t}\n\n\tinfo->is_enabled = false;\nout:\n\treturn ret;\n}\n\nstatic int db8500_regulator_switch_is_enabled(struct regulator_dev *rdev)\n{\n\tstruct dbx500_regulator_info *info = rdev_get_drvdata(rdev);\n\n\tif (info == NULL)\n\t\treturn -EINVAL;\n\n\tdev_vdbg(rdev_get_dev(rdev),\n\t\t\"regulator-switch-%s-is_enabled (is_enabled): %i\\n\",\n\t\tinfo->desc.name, info->is_enabled);\n\n\treturn info->is_enabled;\n}\n\nstatic const struct regulator_ops db8500_regulator_switch_ops = {\n\t.enable\t\t\t= db8500_regulator_switch_enable,\n\t.disable\t\t= db8500_regulator_switch_disable,\n\t.is_enabled\t\t= db8500_regulator_switch_is_enabled,\n};\n\n \nstatic struct dbx500_regulator_info\ndbx500_regulator_info[DB8500_NUM_REGULATORS] = {\n\t[DB8500_REGULATOR_VAPE] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-vape\",\n\t\t\t.of_match = of_match_ptr(\"db8500_vape\"),\n\t\t\t.id\t= DB8500_REGULATOR_VAPE,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t},\n\t[DB8500_REGULATOR_VARM] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-varm\",\n\t\t\t.of_match = of_match_ptr(\"db8500_varm\"),\n\t\t\t.id\t= DB8500_REGULATOR_VARM,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t},\n\t[DB8500_REGULATOR_VMODEM] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-vmodem\",\n\t\t\t.of_match = of_match_ptr(\"db8500_vmodem\"),\n\t\t\t.id\t= DB8500_REGULATOR_VMODEM,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t},\n\t[DB8500_REGULATOR_VPLL] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-vpll\",\n\t\t\t.of_match = of_match_ptr(\"db8500_vpll\"),\n\t\t\t.id\t= DB8500_REGULATOR_VPLL,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t},\n\t[DB8500_REGULATOR_VSMPS1] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-vsmps1\",\n\t\t\t.of_match = of_match_ptr(\"db8500_vsmps1\"),\n\t\t\t.id\t= DB8500_REGULATOR_VSMPS1,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t},\n\t[DB8500_REGULATOR_VSMPS2] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-vsmps2\",\n\t\t\t.of_match = of_match_ptr(\"db8500_vsmps2\"),\n\t\t\t.id\t= DB8500_REGULATOR_VSMPS2,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t\t.fixed_uV = 1800000,\n\t\t\t.n_voltages = 1,\n\t\t},\n\t\t.exclude_from_power_state = true,\n\t},\n\t[DB8500_REGULATOR_VSMPS3] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-vsmps3\",\n\t\t\t.of_match = of_match_ptr(\"db8500_vsmps3\"),\n\t\t\t.id\t= DB8500_REGULATOR_VSMPS3,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t},\n\t[DB8500_REGULATOR_VRF1] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-vrf1\",\n\t\t\t.of_match = of_match_ptr(\"db8500_vrf1\"),\n\t\t\t.id\t= DB8500_REGULATOR_VRF1,\n\t\t\t.ops\t= &db8500_regulator_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t},\n\t[DB8500_REGULATOR_SWITCH_SVAMMDSP] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-sva-mmdsp\",\n\t\t\t.of_match = of_match_ptr(\"db8500_sva_mmdsp\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_SVAMMDSP,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_SVAMMDSP,\n\t},\n\t[DB8500_REGULATOR_SWITCH_SVAMMDSPRET] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-sva-mmdsp-ret\",\n\t\t\t.of_match = of_match_ptr(\"db8500_sva_mmdsp_ret\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_SVAMMDSPRET,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_SVAMMDSP,\n\t\t.is_ramret = true,\n\t},\n\t[DB8500_REGULATOR_SWITCH_SVAPIPE] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-sva-pipe\",\n\t\t\t.of_match = of_match_ptr(\"db8500_sva_pipe\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_SVAPIPE,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_SVAPIPE,\n\t},\n\t[DB8500_REGULATOR_SWITCH_SIAMMDSP] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-sia-mmdsp\",\n\t\t\t.of_match = of_match_ptr(\"db8500_sia_mmdsp\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_SIAMMDSP,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_SIAMMDSP,\n\t},\n\t[DB8500_REGULATOR_SWITCH_SIAMMDSPRET] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-sia-mmdsp-ret\",\n\t\t\t.of_match = of_match_ptr(\"db8500_sia_mmdsp_ret\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_SIAMMDSPRET,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_SIAMMDSP,\n\t\t.is_ramret = true,\n\t},\n\t[DB8500_REGULATOR_SWITCH_SIAPIPE] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-sia-pipe\",\n\t\t\t.of_match = of_match_ptr(\"db8500_sia_pipe\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_SIAPIPE,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_SIAPIPE,\n\t},\n\t[DB8500_REGULATOR_SWITCH_SGA] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-sga\",\n\t\t\t.of_match = of_match_ptr(\"db8500_sga\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_SGA,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_SGA,\n\t},\n\t[DB8500_REGULATOR_SWITCH_B2R2_MCDE] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-b2r2-mcde\",\n\t\t\t.of_match = of_match_ptr(\"db8500_b2r2_mcde\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_B2R2_MCDE,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_B2R2_MCDE,\n\t},\n\t[DB8500_REGULATOR_SWITCH_ESRAM12] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-esram12\",\n\t\t\t.of_match = of_match_ptr(\"db8500_esram12\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_ESRAM12,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id\t= EPOD_ID_ESRAM12,\n\t\t.is_enabled\t= true,\n\t},\n\t[DB8500_REGULATOR_SWITCH_ESRAM12RET] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-esram12-ret\",\n\t\t\t.of_match = of_match_ptr(\"db8500_esram12_ret\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_ESRAM12RET,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_ESRAM12,\n\t\t.is_ramret = true,\n\t},\n\t[DB8500_REGULATOR_SWITCH_ESRAM34] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-esram34\",\n\t\t\t.of_match = of_match_ptr(\"db8500_esram34\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_ESRAM34,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id\t= EPOD_ID_ESRAM34,\n\t\t.is_enabled\t= true,\n\t},\n\t[DB8500_REGULATOR_SWITCH_ESRAM34RET] = {\n\t\t.desc = {\n\t\t\t.name\t= \"db8500-esram34-ret\",\n\t\t\t.of_match = of_match_ptr(\"db8500_esram34_ret\"),\n\t\t\t.id\t= DB8500_REGULATOR_SWITCH_ESRAM34RET,\n\t\t\t.ops\t= &db8500_regulator_switch_ops,\n\t\t\t.type\t= REGULATOR_VOLTAGE,\n\t\t\t.owner\t= THIS_MODULE,\n\t\t},\n\t\t.epod_id = EPOD_ID_ESRAM34,\n\t\t.is_ramret = true,\n\t},\n};\n\nstatic int db8500_regulator_probe(struct platform_device *pdev)\n{\n\tstruct regulator_init_data *db8500_init_data;\n\tstruct dbx500_regulator_info *info;\n\tstruct regulator_config config = { };\n\tstruct regulator_dev *rdev;\n\tint err, i;\n\n\tdb8500_init_data = dev_get_platdata(&pdev->dev);\n\n\tfor (i = 0; i < ARRAY_SIZE(dbx500_regulator_info); i++) {\n\t\t \n\t\tinfo = &dbx500_regulator_info[i];\n\n\t\tconfig.driver_data = info;\n\t\tconfig.dev = &pdev->dev;\n\t\tif (db8500_init_data)\n\t\t\tconfig.init_data = &db8500_init_data[i];\n\n\t\trdev = devm_regulator_register(&pdev->dev, &info->desc,\n\t\t\t\t\t       &config);\n\t\tif (IS_ERR(rdev)) {\n\t\t\terr = PTR_ERR(rdev);\n\t\t\tdev_err(&pdev->dev, \"failed to register %s: err %i\\n\",\n\t\t\t\tinfo->desc.name, err);\n\t\t\treturn err;\n\t\t}\n\t\tdev_dbg(&pdev->dev, \"regulator-%s-probed\\n\", info->desc.name);\n\t}\n\n\tux500_regulator_debug_init(pdev, dbx500_regulator_info,\n\t\t\t\t   ARRAY_SIZE(dbx500_regulator_info));\n\treturn 0;\n}\n\nstatic int db8500_regulator_remove(struct platform_device *pdev)\n{\n\tux500_regulator_debug_exit();\n\n\treturn 0;\n}\n\nstatic struct platform_driver db8500_regulator_driver = {\n\t.driver = {\n\t\t.name = \"db8500-prcmu-regulators\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = db8500_regulator_probe,\n\t.remove = db8500_regulator_remove,\n};\n\nstatic int __init db8500_regulator_init(void)\n{\n\treturn platform_driver_register(&db8500_regulator_driver);\n}\n\nstatic void __exit db8500_regulator_exit(void)\n{\n\tplatform_driver_unregister(&db8500_regulator_driver);\n}\n\narch_initcall(db8500_regulator_init);\nmodule_exit(db8500_regulator_exit);\n\nMODULE_AUTHOR(\"STMicroelectronics/ST-Ericsson\");\nMODULE_DESCRIPTION(\"DB8500 regulator driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}