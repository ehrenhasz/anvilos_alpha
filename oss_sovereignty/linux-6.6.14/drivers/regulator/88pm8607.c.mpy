{
  "module_name": "88pm8607.c",
  "hash_id": "44da53d05cbe4ac7d5dc16bc1e5ab1f80b3bb98201bef6098365c624f4e16049",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/88pm8607.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/err.h>\n#include <linux/of.h>\n#include <linux/regulator/of_regulator.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/mfd/88pm860x.h>\n#include <linux/module.h>\n\nstruct pm8607_regulator_info {\n\tstruct regulator_desc\tdesc;\n\n\tunsigned int\t*vol_suspend;\n\n\tint\tslope_double;\n};\n\nstatic const unsigned int BUCK1_table[] = {\n\t 725000,  750000,  775000,  800000,  825000,  850000,  875000,  900000,\n\t 925000,  950000,  975000, 1000000, 1025000, 1050000, 1075000, 1100000,\n\t1125000, 1150000, 1175000, 1200000, 1225000, 1250000, 1275000, 1300000,\n\t1325000, 1350000, 1375000, 1400000, 1425000, 1450000, 1475000, 1500000,\n\t      0,   25000,   50000,   75000,  100000,  125000,  150000,  175000,\n\t 200000,  225000,  250000,  275000,  300000,  325000,  350000,  375000,\n\t 400000,  425000,  450000,  475000,  500000,  525000,  550000,  575000,\n\t 600000,  625000,  650000,  675000,  700000,  725000,  750000,  775000,\n};\n\nstatic const unsigned int BUCK1_suspend_table[] = {\n\t      0,   25000,   50000,   75000,  100000,  125000,  150000,  175000,\n\t 200000,  225000,  250000,  275000,  300000,  325000,  350000,  375000,\n\t 400000,  425000,  450000,  475000,  500000,  525000,  550000,  575000,\n\t 600000,  625000,  650000,  675000,  700000,  725000,  750000,  775000,\n\t 800000,  825000,  850000,  875000,  900000,  925000,  950000,  975000,\n\t1000000, 1025000, 1050000, 1075000, 1100000, 1125000, 1150000, 1175000,\n\t1200000, 1225000, 1250000, 1275000, 1300000, 1325000, 1350000, 1375000,\n\t1400000, 1425000, 1450000, 1475000, 1500000, 1500000, 1500000, 1500000,\n};\n\nstatic const unsigned int BUCK2_table[] = {\n\t      0,   50000,  100000,  150000,  200000,  250000,  300000,  350000,\n\t 400000,  450000,  500000,  550000,  600000,  650000,  700000,  750000,\n\t 800000,  850000,  900000,  950000, 1000000, 1050000, 1100000, 1150000,\n\t1200000, 1250000, 1300000, 1350000, 1400000, 1450000, 1500000, 1550000,\n\t1600000, 1650000, 1700000, 1750000, 1800000, 1850000, 1900000, 1950000,\n\t2000000, 2050000, 2100000, 2150000, 2200000, 2250000, 2300000, 2350000,\n\t2400000, 2450000, 2500000, 2550000, 2600000, 2650000, 2700000, 2750000,\n\t2800000, 2850000, 2900000, 2950000, 3000000, 3000000, 3000000, 3000000,\n};\n\nstatic const unsigned int BUCK2_suspend_table[] = {\n\t      0,   50000,  100000,  150000,  200000,  250000,  300000,  350000,\n\t 400000,  450000,  500000,  550000,  600000,  650000,  700000,  750000,\n\t 800000,  850000,  900000,  950000, 1000000, 1050000, 1100000, 1150000,\n\t1200000, 1250000, 1300000, 1350000, 1400000, 1450000, 1500000, 1550000,\n\t1600000, 1650000, 1700000, 1750000, 1800000, 1850000, 1900000, 1950000,\n\t2000000, 2050000, 2100000, 2150000, 2200000, 2250000, 2300000, 2350000,\n\t2400000, 2450000, 2500000, 2550000, 2600000, 2650000, 2700000, 2750000,\n\t2800000, 2850000, 2900000, 2950000, 3000000, 3000000, 3000000, 3000000,\n};\n\nstatic const unsigned int BUCK3_table[] = {\n\t      0,   25000,   50000,   75000,  100000,  125000,  150000,  175000,\n\t 200000,  225000,  250000,  275000,  300000,  325000,  350000,  375000,\n\t 400000,  425000,  450000,  475000,  500000,  525000,  550000,  575000,\n\t 600000,  625000,  650000,  675000,  700000,  725000,  750000,  775000,\n\t 800000,  825000,  850000,  875000,  900000,  925000,  950000,  975000,\n\t1000000, 1025000, 1050000, 1075000, 1100000, 1125000, 1150000, 1175000,\n\t1200000, 1225000, 1250000, 1275000, 1300000, 1325000, 1350000, 1375000,\n\t1400000, 1425000, 1450000, 1475000, 1500000, 1500000, 1500000, 1500000,\n};\n\nstatic const unsigned int BUCK3_suspend_table[] = {\n\t      0,   25000,   50000,   75000,  100000,  125000,  150000,  175000,\n\t 200000,  225000,  250000,  275000,  300000,  325000,  350000,  375000,\n\t 400000,  425000,  450000,  475000,  500000,  525000,  550000,  575000,\n\t 600000,  625000,  650000,  675000,  700000,  725000,  750000,  775000,\n\t 800000,  825000,  850000,  875000,  900000,  925000,  950000,  975000,\n\t1000000, 1025000, 1050000, 1075000, 1100000, 1125000, 1150000, 1175000,\n\t1200000, 1225000, 1250000, 1275000, 1300000, 1325000, 1350000, 1375000,\n\t1400000, 1425000, 1450000, 1475000, 1500000, 1500000, 1500000, 1500000,\n};\n\nstatic const unsigned int LDO1_table[] = {\n\t1800000, 1200000, 2800000, 0,\n};\n\nstatic const unsigned int LDO1_suspend_table[] = {\n\t1800000, 1200000, 0, 0,\n};\n\nstatic const unsigned int LDO2_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 3300000,\n};\n\nstatic const unsigned int LDO2_suspend_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n};\n\nstatic const unsigned int LDO3_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 3300000,\n};\n\nstatic const unsigned int LDO3_suspend_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n};\n\nstatic const unsigned int LDO4_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2900000, 3300000,\n};\n\nstatic const unsigned int LDO4_suspend_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2900000, 2900000,\n};\n\nstatic const unsigned int LDO5_table[] = {\n\t2900000, 3000000, 3100000, 3300000,\n};\n\nstatic const unsigned int LDO5_suspend_table[] = {\n\t2900000, 0, 0, 0,\n};\n\nstatic const unsigned int LDO6_table[] = {\n\t1800000, 1850000, 2600000, 2650000, 2700000, 2750000, 2800000, 3300000,\n};\n\nstatic const unsigned int LDO6_suspend_table[] = {\n\t1800000, 1850000, 2600000, 2650000, 2700000, 2750000, 2800000, 2900000,\n};\n\nstatic const unsigned int LDO7_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n};\n\nstatic const unsigned int LDO7_suspend_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n};\n\nstatic const unsigned int LDO8_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n};\n\nstatic const unsigned int LDO8_suspend_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n};\n\nstatic const unsigned int LDO9_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 3300000,\n};\n\nstatic const unsigned int LDO9_suspend_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n};\n\nstatic const unsigned int LDO10_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 3300000,\n\t1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000,\n};\n\nstatic const unsigned int LDO10_suspend_table[] = {\n\t1800000, 1850000, 1900000, 2700000, 2750000, 2800000, 2850000, 2900000,\n\t1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000,\n};\n\nstatic const unsigned int LDO12_table[] = {\n\t1800000, 1900000, 2700000, 2800000, 2900000, 3000000, 3100000, 3300000,\n\t1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000,\n};\n\nstatic const unsigned int LDO12_suspend_table[] = {\n\t1800000, 1900000, 2700000, 2800000, 2900000, 2900000, 2900000, 2900000,\n\t1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000, 1200000,\n};\n\nstatic const unsigned int LDO13_table[] = {\n\t1200000, 1300000, 1800000, 2000000, 2500000, 2800000, 3000000, 0,\n};\n\nstatic const unsigned int LDO13_suspend_table[] = {\n\t0,\n};\n\nstatic const unsigned int LDO14_table[] = {\n\t1800000, 1850000, 2700000, 2750000, 2800000, 2850000, 2900000, 3300000,\n};\n\nstatic const unsigned int LDO14_suspend_table[] = {\n\t1800000, 1850000, 2700000, 2750000, 2800000, 2850000, 2900000, 2900000,\n};\n\nstatic int pm8607_list_voltage(struct regulator_dev *rdev, unsigned index)\n{\n\tstruct pm8607_regulator_info *info = rdev_get_drvdata(rdev);\n\tint ret;\n\n\tret = regulator_list_voltage_table(rdev, index);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (info->slope_double)\n\t\tret <<= 1;\n\n\treturn ret;\n}\n\nstatic const struct regulator_ops pm8607_regulator_ops = {\n\t.list_voltage\t= pm8607_list_voltage,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n};\n\nstatic const struct regulator_ops pm8606_preg_ops = {\n\t.enable\t\t= regulator_enable_regmap,\n\t.disable\t= regulator_disable_regmap,\n\t.is_enabled\t= regulator_is_enabled_regmap,\n};\n\n#define PM8606_PREG(ereg, ebit)\t\t\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t.desc\t= {\t\t\t\t\t\t\t\\\n\t\t.name\t= \"PREG\",\t\t\t\t\t\\\n\t\t.of_match = of_match_ptr(\"PREG\"),\t\t\t\\\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\t\t\\\n\t\t.ops\t= &pm8606_preg_ops,\t\t\t\t\\\n\t\t.type\t= REGULATOR_CURRENT,\t\t\t\t\\\n\t\t.id\t= PM8606_ID_PREG,\t\t\t\t\\\n\t\t.owner\t= THIS_MODULE,\t\t\t\t\t\\\n\t\t.enable_reg = PM8606_##ereg,\t\t\t\t\\\n\t\t.enable_mask = (ebit),\t\t\t\t\t\\\n\t\t.enable_is_inverted = true,\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\\\n}\n\n#define PM8607_DVC(vreg, ureg, ubit, ereg, ebit)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t.desc\t= {\t\t\t\t\t\t\t\\\n\t\t.name\t= #vreg,\t\t\t\t\t\\\n\t\t.of_match = of_match_ptr(#vreg),\t\t\t\\\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\t\t\\\n\t\t.ops\t= &pm8607_regulator_ops,\t\t\t\\\n\t\t.type\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.id\t= PM8607_ID_##vreg,\t\t\t\t\\\n\t\t.owner\t= THIS_MODULE,\t\t\t\t\t\\\n\t\t.volt_table = vreg##_table,\t\t\t\t\\\n\t\t.n_voltages = ARRAY_SIZE(vreg##_table),\t\t\t\\\n\t\t.vsel_reg = PM8607_##vreg,\t\t\t\t\\\n\t\t.vsel_mask = ARRAY_SIZE(vreg##_table) - 1,\t\t\\\n\t\t.apply_reg = PM8607_##ureg,\t\t\t\t\\\n\t\t.apply_bit = (ubit),\t\t\t\t\t\\\n\t\t.enable_reg = PM8607_##ereg,\t\t\t\t\\\n\t\t.enable_mask = 1 << (ebit),\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\\\n\t.slope_double\t= (0),\t\t\t\t\t\t\\\n\t.vol_suspend\t= (unsigned int *)&vreg##_suspend_table,\t\\\n}\n\n#define PM8607_LDO(_id, vreg, shift, ereg, ebit)\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\t.desc\t= {\t\t\t\t\t\t\t\\\n\t\t.name\t= \"LDO\" #_id,\t\t\t\t\t\\\n\t\t.of_match = of_match_ptr(\"LDO\" #_id),\t\t\t\\\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\t\t\\\n\t\t.ops\t= &pm8607_regulator_ops,\t\t\t\\\n\t\t.type\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.id\t= PM8607_ID_LDO##_id,\t\t\t\t\\\n\t\t.owner\t= THIS_MODULE,\t\t\t\t\t\\\n\t\t.volt_table = LDO##_id##_table,\t\t\t\t\\\n\t\t.n_voltages = ARRAY_SIZE(LDO##_id##_table),\t\t\\\n\t\t.vsel_reg = PM8607_##vreg,\t\t\t\t\\\n\t\t.vsel_mask = (ARRAY_SIZE(LDO##_id##_table) - 1) << (shift), \\\n\t\t.enable_reg = PM8607_##ereg,\t\t\t\t\\\n\t\t.enable_mask = 1 << (ebit),\t\t\t\t\\\n\t},\t\t\t\t\t\t\t\t\\\n\t.slope_double\t= (0),\t\t\t\t\t\t\\\n\t.vol_suspend\t= (unsigned int *)&LDO##_id##_suspend_table,\t\\\n}\n\nstatic struct pm8607_regulator_info pm8607_regulator_info[] = {\n\tPM8607_DVC(BUCK1, GO, BIT(0), SUPPLIES_EN11, 0),\n\tPM8607_DVC(BUCK2, GO, BIT(1), SUPPLIES_EN11, 1),\n\tPM8607_DVC(BUCK3, GO, BIT(2), SUPPLIES_EN11, 2),\n\n\tPM8607_LDO(1,         LDO1, 0, SUPPLIES_EN11, 3),\n\tPM8607_LDO(2,         LDO2, 0, SUPPLIES_EN11, 4),\n\tPM8607_LDO(3,         LDO3, 0, SUPPLIES_EN11, 5),\n\tPM8607_LDO(4,         LDO4, 0, SUPPLIES_EN11, 6),\n\tPM8607_LDO(5,         LDO5, 0, SUPPLIES_EN11, 7),\n\tPM8607_LDO(6,         LDO6, 0, SUPPLIES_EN12, 0),\n\tPM8607_LDO(7,         LDO7, 0, SUPPLIES_EN12, 1),\n\tPM8607_LDO(8,         LDO8, 0, SUPPLIES_EN12, 2),\n\tPM8607_LDO(9,         LDO9, 0, SUPPLIES_EN12, 3),\n\tPM8607_LDO(10,        LDO10, 0, SUPPLIES_EN12, 4),\n\tPM8607_LDO(12,        LDO12, 0, SUPPLIES_EN12, 5),\n\tPM8607_LDO(13, VIBRATOR_SET, 1, VIBRATOR_SET, 0),\n\tPM8607_LDO(14,        LDO14, 0, SUPPLIES_EN12, 6),\n};\n\nstatic struct pm8607_regulator_info pm8606_regulator_info[] = {\n\tPM8606_PREG(PREREGULATORB, 5),\n};\n\nstatic int pm8607_regulator_probe(struct platform_device *pdev)\n{\n\tstruct pm860x_chip *chip = dev_get_drvdata(pdev->dev.parent);\n\tstruct pm8607_regulator_info *info = NULL;\n\tstruct regulator_init_data *pdata = dev_get_platdata(&pdev->dev);\n\tstruct regulator_config config = { };\n\tstruct regulator_dev *rdev;\n\tstruct resource *res;\n\tint i;\n\n\tres = platform_get_resource(pdev, IORESOURCE_REG, 0);\n\tif (res) {\n\t\t \n\t\tfor (i = 0; i < ARRAY_SIZE(pm8607_regulator_info); i++) {\n\t\t\tinfo = &pm8607_regulator_info[i];\n\t\t\tif (info->desc.vsel_reg == res->start)\n\t\t\t\tbreak;\n\t\t}\n\t\tif (i == ARRAY_SIZE(pm8607_regulator_info)) {\n\t\t\tdev_err(&pdev->dev, \"Failed to find regulator %llu\\n\",\n\t\t\t\t(unsigned long long)res->start);\n\t\t\treturn -EINVAL;\n\t\t}\n\t} else {\n\t\t \n\t\tinfo = &pm8606_regulator_info[0];\n\t\t \n\t\ti = -1;\n\t}\n\n\t \n\tif ((i == PM8607_ID_BUCK3) && chip->buck3_double)\n\t\tinfo->slope_double = 1;\n\n\tconfig.dev = chip->dev;\n\tconfig.driver_data = info;\n\n\tif (pdata)\n\t\tconfig.init_data = pdata;\n\n\tif (chip->id == CHIP_PM8607)\n\t\tconfig.regmap = chip->regmap;\n\telse\n\t\tconfig.regmap = chip->regmap_companion;\n\n\trdev = devm_regulator_register(&pdev->dev, &info->desc, &config);\n\tif (IS_ERR(rdev)) {\n\t\tdev_err(&pdev->dev, \"failed to register regulator %s\\n\",\n\t\t\tinfo->desc.name);\n\t\treturn PTR_ERR(rdev);\n\t}\n\n\tplatform_set_drvdata(pdev, info);\n\treturn 0;\n}\n\nstatic const struct platform_device_id pm8607_regulator_driver_ids[] = {\n\t{\n\t\t.name\t= \"88pm860x-regulator\",\n\t\t.driver_data\t= 0,\n\t}, {\n\t\t.name\t= \"88pm860x-preg\",\n\t\t.driver_data\t= 0,\n\t},\n\t{ },\n};\nMODULE_DEVICE_TABLE(platform, pm8607_regulator_driver_ids);\n\nstatic struct platform_driver pm8607_regulator_driver = {\n\t.driver\t\t= {\n\t\t.name\t= \"88pm860x-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe\t\t= pm8607_regulator_probe,\n\t.id_table\t= pm8607_regulator_driver_ids,\n};\n\nstatic int __init pm8607_regulator_init(void)\n{\n\treturn platform_driver_register(&pm8607_regulator_driver);\n}\nsubsys_initcall(pm8607_regulator_init);\n\nstatic void __exit pm8607_regulator_exit(void)\n{\n\tplatform_driver_unregister(&pm8607_regulator_driver);\n}\nmodule_exit(pm8607_regulator_exit);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Haojian Zhuang <haojian.zhuang@marvell.com>\");\nMODULE_DESCRIPTION(\"Regulator Driver for Marvell 88PM8607 PMIC\");\nMODULE_ALIAS(\"platform:88pm8607-regulator\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}