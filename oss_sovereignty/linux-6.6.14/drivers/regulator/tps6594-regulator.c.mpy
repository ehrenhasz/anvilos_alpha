{
  "module_name": "tps6594-regulator.c",
  "hash_id": "5fd3610dd4ab9a07ceb047df0ff2de35c5d0af48284fb22880aa9cd2df40c2d8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/tps6594-regulator.c",
  "human_readable_source": "\n\n\n\n\n\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/of_regulator.h>\n\n#include <linux/mfd/tps6594.h>\n\n#define BUCK_NB\t\t5\n#define LDO_NB\t\t4\n#define MULTI_PHASE_NB\t4\n#define REGS_INT_NB\t4\n\nenum tps6594_regulator_id {\n\t \n\tTPS6594_BUCK_1,\n\tTPS6594_BUCK_2,\n\tTPS6594_BUCK_3,\n\tTPS6594_BUCK_4,\n\tTPS6594_BUCK_5,\n\n\t \n\tTPS6594_LDO_1,\n\tTPS6594_LDO_2,\n\tTPS6594_LDO_3,\n\tTPS6594_LDO_4,\n};\n\nenum tps6594_multi_regulator_id {\n\t \n\tTPS6594_BUCK_12,\n\tTPS6594_BUCK_34,\n\tTPS6594_BUCK_123,\n\tTPS6594_BUCK_1234,\n};\n\nstruct tps6594_regulator_irq_type {\n\tconst char *irq_name;\n\tconst char *regulator_name;\n\tconst char *event_name;\n\tunsigned long event;\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_ext_regulator_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_VCCA_OV, \"VCCA\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_VCCA_UV, \"VCCA\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_VMON1_OV, \"VMON1\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_VMON1_UV, \"VMON1\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_VMON1_RV, \"VMON1\", \"residual voltage\",\n\t  REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_VMON2_OV, \"VMON2\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_VMON2_UV, \"VMON2\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_VMON2_RV, \"VMON2\", \"residual voltage\",\n\t  REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n};\n\nstruct tps6594_regulator_irq_data {\n\tstruct device *dev;\n\tstruct tps6594_regulator_irq_type *type;\n\tstruct regulator_dev *rdev;\n};\n\nstruct tps6594_ext_regulator_irq_data {\n\tstruct device *dev;\n\tstruct tps6594_regulator_irq_type *type;\n};\n\n#define TPS6594_REGULATOR(_name, _of, _id, _type, _ops, _n, _vr, _vm, _er, \\\n\t\t\t   _em, _cr, _cm, _lr, _nlr, _delay, _fuv, \\\n\t\t\t   _ct, _ncl, _bpm) \\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.name\t\t\t= _name,\t\t\t\\\n\t\t.of_match\t\t= _of,\t\t\t\t\\\n\t\t.regulators_node\t= of_match_ptr(\"regulators\"),\t\\\n\t\t.supply_name\t\t= _of,\t\t\t\t\\\n\t\t.id\t\t\t= _id,\t\t\t\t\\\n\t\t.ops\t\t\t= &(_ops),\t\t\t\\\n\t\t.n_voltages\t\t= _n,\t\t\t\t\\\n\t\t.type\t\t\t= _type,\t\t\t\\\n\t\t.owner\t\t\t= THIS_MODULE,\t\t\t\\\n\t\t.vsel_reg\t\t= _vr,\t\t\t\t\\\n\t\t.vsel_mask\t\t= _vm,\t\t\t\t\\\n\t\t.csel_reg\t\t= _cr,\t\t\t\t\\\n\t\t.csel_mask\t\t= _cm,\t\t\t\t\\\n\t\t.curr_table\t\t= _ct,\t\t\t\t\\\n\t\t.n_current_limits\t= _ncl,\t\t\t\t\\\n\t\t.enable_reg\t\t= _er,\t\t\t\t\\\n\t\t.enable_mask\t\t= _em,\t\t\t\t\\\n\t\t.volt_table\t\t= NULL,\t\t\t\t\\\n\t\t.linear_ranges\t\t= _lr,\t\t\t\t\\\n\t\t.n_linear_ranges\t= _nlr,\t\t\t\t\\\n\t\t.ramp_delay\t\t= _delay,\t\t\t\\\n\t\t.fixed_uV\t\t= _fuv,\t\t\t\t\\\n\t\t.bypass_reg\t\t= _vr,\t\t\t\t\\\n\t\t.bypass_mask\t\t= _bpm,\t\t\t\t\\\n\t}\t\t\t\t\t\t\t\t\\\n\nstatic const struct linear_range bucks_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(300000, 0x0, 0xe, 20000),\n\tREGULATOR_LINEAR_RANGE(600000, 0xf, 0x72, 5000),\n\tREGULATOR_LINEAR_RANGE(1100000, 0x73, 0xaa, 10000),\n\tREGULATOR_LINEAR_RANGE(1660000, 0xab, 0xff, 20000),\n};\n\nstatic const struct linear_range ldos_1_2_3_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(600000, 0x4, 0x3a, 50000),\n};\n\nstatic const struct linear_range ldos_4_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(1200000, 0x20, 0x74, 25000),\n};\n\n \nstatic const struct regulator_ops tps6594_bucks_ops = {\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\n};\n\n \nstatic const struct regulator_ops tps6594_ldos_1_2_3_ops = {\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.set_bypass\t\t= regulator_set_bypass_regmap,\n\t.get_bypass\t\t= regulator_get_bypass_regmap,\n};\n\n \nstatic const struct regulator_ops tps6594_ldos_4_ops = {\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n};\n\nstatic const struct regulator_desc buck_regs[] = {\n\tTPS6594_REGULATOR(\"BUCK1\", \"buck1\", TPS6594_BUCK_1,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(0),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(0),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 0, 0, NULL, 0, 0),\n\tTPS6594_REGULATOR(\"BUCK2\", \"buck2\", TPS6594_BUCK_2,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(1),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(1),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 0, 0, NULL, 0, 0),\n\tTPS6594_REGULATOR(\"BUCK3\", \"buck3\", TPS6594_BUCK_3,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(2),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(2),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 0, 0, NULL, 0, 0),\n\tTPS6594_REGULATOR(\"BUCK4\", \"buck4\", TPS6594_BUCK_4,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(3),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(3),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 0, 0, NULL, 0, 0),\n\tTPS6594_REGULATOR(\"BUCK5\", \"buck5\", TPS6594_BUCK_5,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(4),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(4),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 0, 0, NULL, 0, 0),\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_buck1_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_BUCK1_OV, \"BUCK1\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_BUCK1_UV, \"BUCK1\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_BUCK1_SC, \"BUCK1\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_BUCK1_ILIM, \"BUCK1\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_buck2_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_BUCK2_OV, \"BUCK2\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_BUCK2_UV, \"BUCK2\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_BUCK2_SC, \"BUCK2\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_BUCK2_ILIM, \"BUCK2\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_buck3_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_BUCK3_OV, \"BUCK3\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_BUCK3_UV, \"BUCK3\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_BUCK3_SC, \"BUCK3\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_BUCK3_ILIM, \"BUCK3\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_buck4_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_BUCK4_OV, \"BUCK4\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_BUCK4_UV, \"BUCK4\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_BUCK4_SC, \"BUCK4\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_BUCK4_ILIM, \"BUCK4\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_buck5_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_BUCK5_OV, \"BUCK5\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_BUCK5_UV, \"BUCK5\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_BUCK5_SC, \"BUCK5\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_BUCK5_ILIM, \"BUCK5\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_ldo1_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_LDO1_OV, \"LDO1\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_LDO1_UV, \"LDO1\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_LDO1_SC, \"LDO1\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_LDO1_ILIM, \"LDO1\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_ldo2_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_LDO2_OV, \"LDO2\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_LDO2_UV, \"LDO2\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_LDO2_SC, \"LDO2\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_LDO2_ILIM, \"LDO2\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_ldo3_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_LDO3_OV, \"LDO3\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_LDO3_UV, \"LDO3\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_LDO3_SC, \"LDO3\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_LDO3_ILIM, \"LDO3\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type tps6594_ldo4_irq_types[] = {\n\t{ TPS6594_IRQ_NAME_LDO4_OV, \"LDO4\", \"overvoltage\", REGULATOR_EVENT_OVER_VOLTAGE_WARN },\n\t{ TPS6594_IRQ_NAME_LDO4_UV, \"LDO4\", \"undervoltage\", REGULATOR_EVENT_UNDER_VOLTAGE },\n\t{ TPS6594_IRQ_NAME_LDO4_SC, \"LDO4\", \"short circuit\", REGULATOR_EVENT_REGULATION_OUT },\n\t{ TPS6594_IRQ_NAME_LDO4_ILIM, \"LDO4\", \"reach ilim, overcurrent\",\n\t  REGULATOR_EVENT_OVER_CURRENT },\n};\n\nstatic struct tps6594_regulator_irq_type *tps6594_bucks_irq_types[] = {\n\ttps6594_buck1_irq_types,\n\ttps6594_buck2_irq_types,\n\ttps6594_buck3_irq_types,\n\ttps6594_buck4_irq_types,\n\ttps6594_buck5_irq_types,\n};\n\nstatic struct tps6594_regulator_irq_type *tps6594_ldos_irq_types[] = {\n\ttps6594_ldo1_irq_types,\n\ttps6594_ldo2_irq_types,\n\ttps6594_ldo3_irq_types,\n\ttps6594_ldo4_irq_types,\n};\n\nstatic const struct regulator_desc multi_regs[] = {\n\tTPS6594_REGULATOR(\"BUCK12\", \"buck12\", TPS6594_BUCK_1,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(1),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(1),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 4000, 0, NULL, 0, 0),\n\tTPS6594_REGULATOR(\"BUCK34\", \"buck34\", TPS6594_BUCK_3,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(3),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(3),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 0, 0, NULL, 0, 0),\n\tTPS6594_REGULATOR(\"BUCK123\", \"buck123\", TPS6594_BUCK_1,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(1),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(1),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 4000, 0, NULL, 0, 0),\n\tTPS6594_REGULATOR(\"BUCK1234\", \"buck1234\", TPS6594_BUCK_1,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_bucks_ops, TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_VOUT_1(1),\n\t\t\t  TPS6594_MASK_BUCKS_VSET,\n\t\t\t  TPS6594_REG_BUCKX_CTRL(1),\n\t\t\t  TPS6594_BIT_BUCK_EN, 0, 0, bucks_ranges,\n\t\t\t  4, 4000, 0, NULL, 0, 0),\n};\n\nstatic const struct regulator_desc ldo_regs[] = {\n\tTPS6594_REGULATOR(\"LDO1\", \"ldo1\", TPS6594_LDO_1,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_ldos_1_2_3_ops, TPS6594_MASK_LDO123_VSET,\n\t\t\t  TPS6594_REG_LDOX_VOUT(0),\n\t\t\t  TPS6594_MASK_LDO123_VSET,\n\t\t\t  TPS6594_REG_LDOX_CTRL(0),\n\t\t\t  TPS6594_BIT_LDO_EN, 0, 0, ldos_1_2_3_ranges,\n\t\t\t  1, 0, 0, NULL, 0, TPS6594_BIT_LDO_BYPASS),\n\tTPS6594_REGULATOR(\"LDO2\", \"ldo2\", TPS6594_LDO_2,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_ldos_1_2_3_ops, TPS6594_MASK_LDO123_VSET,\n\t\t\t  TPS6594_REG_LDOX_VOUT(1),\n\t\t\t  TPS6594_MASK_LDO123_VSET,\n\t\t\t  TPS6594_REG_LDOX_CTRL(1),\n\t\t\t  TPS6594_BIT_LDO_EN, 0, 0, ldos_1_2_3_ranges,\n\t\t\t  1, 0, 0, NULL, 0, TPS6594_BIT_LDO_BYPASS),\n\tTPS6594_REGULATOR(\"LDO3\", \"ldo3\", TPS6594_LDO_3,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_ldos_1_2_3_ops, TPS6594_MASK_LDO123_VSET,\n\t\t\t  TPS6594_REG_LDOX_VOUT(2),\n\t\t\t  TPS6594_MASK_LDO123_VSET,\n\t\t\t  TPS6594_REG_LDOX_CTRL(2),\n\t\t\t  TPS6594_BIT_LDO_EN, 0, 0, ldos_1_2_3_ranges,\n\t\t\t  1, 0, 0, NULL, 0, TPS6594_BIT_LDO_BYPASS),\n\tTPS6594_REGULATOR(\"LDO4\", \"ldo4\", TPS6594_LDO_4,\n\t\t\t  REGULATOR_VOLTAGE, tps6594_ldos_4_ops, TPS6594_MASK_LDO4_VSET >> 1,\n\t\t\t  TPS6594_REG_LDOX_VOUT(3),\n\t\t\t  TPS6594_MASK_LDO4_VSET,\n\t\t\t  TPS6594_REG_LDOX_CTRL(3),\n\t\t\t  TPS6594_BIT_LDO_EN, 0, 0, ldos_4_ranges,\n\t\t\t  1, 0, 0, NULL, 0, 0),\n};\n\nstatic irqreturn_t tps6594_regulator_irq_handler(int irq, void *data)\n{\n\tstruct tps6594_regulator_irq_data *irq_data = data;\n\n\tif (irq_data->type->event_name[0] == '\\0') {\n\t\t \n\t\tdev_err(irq_data->dev,\n\t\t\t\"System was put in shutdown due to timeout during an active or standby transition.\\n\");\n\t\treturn IRQ_HANDLED;\n\t}\n\n\tdev_err(irq_data->dev, \"Error IRQ trap %s for %s\\n\",\n\t\tirq_data->type->event_name, irq_data->type->regulator_name);\n\n\tregulator_notifier_call_chain(irq_data->rdev,\n\t\t\t\t      irq_data->type->event, NULL);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int tps6594_request_reg_irqs(struct platform_device *pdev,\n\t\t\t\t    struct regulator_dev *rdev,\n\t\t\t\t    struct tps6594_regulator_irq_data *irq_data,\n\t\t\t\t    struct tps6594_regulator_irq_type *tps6594_regs_irq_types,\n\t\t\t\t    int *irq_idx)\n{\n\tstruct tps6594_regulator_irq_type *irq_type;\n\tstruct tps6594 *tps = dev_get_drvdata(pdev->dev.parent);\n\tint j;\n\tint irq;\n\tint error;\n\n\tfor (j = 0; j < REGS_INT_NB; j++) {\n\t\tirq_type = &tps6594_regs_irq_types[j];\n\t\tirq = platform_get_irq_byname(pdev, irq_type->irq_name);\n\t\tif (irq < 0)\n\t\t\treturn -EINVAL;\n\n\t\tirq_data[*irq_idx].dev = tps->dev;\n\t\tirq_data[*irq_idx].type = irq_type;\n\t\tirq_data[*irq_idx].rdev = rdev;\n\n\t\terror = devm_request_threaded_irq(tps->dev, irq, NULL,\n\t\t\t\t\t\t  tps6594_regulator_irq_handler, IRQF_ONESHOT,\n\t\t\t\t\t\t  irq_type->irq_name, &irq_data[*irq_idx]);\n\t\tif (error) {\n\t\t\tdev_err(tps->dev, \"tps6594 failed to request %s IRQ %d: %d\\n\",\n\t\t\t\tirq_type->irq_name, irq, error);\n\t\t\treturn error;\n\t\t}\n\t\t(*irq_idx)++;\n\t}\n\treturn 0;\n}\n\nstatic int tps6594_regulator_probe(struct platform_device *pdev)\n{\n\tstruct tps6594 *tps = dev_get_drvdata(pdev->dev.parent);\n\tstruct regulator_dev *rdev;\n\tstruct device_node *np = NULL;\n\tstruct device_node *np_pmic_parent = NULL;\n\tstruct regulator_config config = {};\n\tstruct tps6594_regulator_irq_data *irq_data;\n\tstruct tps6594_ext_regulator_irq_data *irq_ext_reg_data;\n\tstruct tps6594_regulator_irq_type *irq_type;\n\tu8 buck_configured[BUCK_NB] = { 0 };\n\tu8 buck_multi[MULTI_PHASE_NB] = { 0 };\n\tstatic const char * const multiphases[] = {\"buck12\", \"buck123\", \"buck1234\", \"buck34\"};\n\tstatic const char *npname;\n\tint error, i, irq, multi, delta;\n\tint irq_idx = 0;\n\tint buck_idx = 0;\n\tsize_t ext_reg_irq_nb = 2;\n\tsize_t reg_irq_nb;\n\tenum {\n\t\tMULTI_BUCK12,\n\t\tMULTI_BUCK123,\n\t\tMULTI_BUCK1234,\n\t\tMULTI_BUCK12_34,\n\t\tMULTI_FIRST = MULTI_BUCK12,\n\t\tMULTI_LAST = MULTI_BUCK12_34,\n\t\tMULTI_NUM = MULTI_LAST - MULTI_FIRST + 1\n\t};\n\n\tconfig.dev = tps->dev;\n\tconfig.driver_data = tps;\n\tconfig.regmap = tps->regmap;\n\n\t \n\tfor (multi = MULTI_FIRST; multi < MULTI_NUM; multi++) {\n\t\tnp = of_find_node_by_name(tps->dev->of_node, multiphases[multi]);\n\t\tnpname = of_node_full_name(np);\n\t\tnp_pmic_parent = of_get_parent(of_get_parent(np));\n\t\tif (of_node_cmp(of_node_full_name(np_pmic_parent), tps->dev->of_node->full_name))\n\t\t\tcontinue;\n\t\tdelta = strcmp(npname, multiphases[multi]);\n\t\tif (!delta) {\n\t\t\tswitch (multi) {\n\t\t\tcase MULTI_BUCK12:\n\t\t\t\tbuck_multi[0] = 1;\n\t\t\t\tbuck_configured[0] = 1;\n\t\t\t\tbuck_configured[1] = 1;\n\t\t\t\tbreak;\n\t\t\t \n\t\t\tcase MULTI_BUCK12_34:\n\t\t\t\tbuck_multi[0] = 1;\n\t\t\t\tbuck_multi[1] = 1;\n\t\t\t\tbuck_configured[0] = 1;\n\t\t\t\tbuck_configured[1] = 1;\n\t\t\t\tbuck_configured[2] = 1;\n\t\t\t\tbuck_configured[3] = 1;\n\t\t\t\tbreak;\n\t\t\tcase MULTI_BUCK123:\n\t\t\t\tbuck_multi[2] = 1;\n\t\t\t\tbuck_configured[0] = 1;\n\t\t\t\tbuck_configured[1] = 1;\n\t\t\t\tbuck_configured[2] = 1;\n\t\t\t\tbreak;\n\t\t\tcase MULTI_BUCK1234:\n\t\t\t\tbuck_multi[3] = 1;\n\t\t\t\tbuck_configured[0] = 1;\n\t\t\t\tbuck_configured[1] = 1;\n\t\t\t\tbuck_configured[2] = 1;\n\t\t\t\tbuck_configured[3] = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (tps->chip_id == LP8764) {\n\t\t \n\t\tbuck_configured[4] = 1;\n\t\treg_irq_nb = size_mul(REGS_INT_NB, (BUCK_NB - 1));\n\t} else {\n\t\treg_irq_nb = size_mul(REGS_INT_NB, (size_add(BUCK_NB, LDO_NB)));\n\t}\n\n\tirq_data = devm_kmalloc_array(tps->dev, reg_irq_nb,\n\t\t\t\t      sizeof(struct tps6594_regulator_irq_data), GFP_KERNEL);\n\tif (!irq_data)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < MULTI_PHASE_NB; i++) {\n\t\tif (buck_multi[i] == 0)\n\t\t\tcontinue;\n\n\t\trdev = devm_regulator_register(&pdev->dev, &multi_regs[i], &config);\n\t\tif (IS_ERR(rdev))\n\t\t\treturn dev_err_probe(tps->dev, PTR_ERR(rdev),\n\t\t\t\t\t     \"failed to register %s regulator\\n\",\n\t\t\t\t\t     pdev->name);\n\n\t\t \n\t\tif (i == 1)\n\t\t\tbuck_idx = 2;\n\t\terror = tps6594_request_reg_irqs(pdev, rdev, irq_data,\n\t\t\t\t\t\t tps6594_bucks_irq_types[buck_idx], &irq_idx);\n\t\tif (error)\n\t\t\treturn error;\n\t\terror = tps6594_request_reg_irqs(pdev, rdev, irq_data,\n\t\t\t\t\t\t tps6594_bucks_irq_types[buck_idx + 1], &irq_idx);\n\t\tif (error)\n\t\t\treturn error;\n\n\t\tif (i == 2 || i == 3) {\n\t\t\terror = tps6594_request_reg_irqs(pdev, rdev, irq_data,\n\t\t\t\t\t\t\t tps6594_bucks_irq_types[buck_idx + 2],\n\t\t\t\t\t\t\t &irq_idx);\n\t\t\tif (error)\n\t\t\t\treturn error;\n\t\t}\n\t\tif (i == 3) {\n\t\t\terror = tps6594_request_reg_irqs(pdev, rdev, irq_data,\n\t\t\t\t\t\t\t tps6594_bucks_irq_types[buck_idx + 3],\n\t\t\t\t\t\t\t &irq_idx);\n\t\t\tif (error)\n\t\t\t\treturn error;\n\t\t}\n\t}\n\n\tfor (i = 0; i < BUCK_NB; i++) {\n\t\tif (buck_configured[i] == 1)\n\t\t\tcontinue;\n\n\t\trdev = devm_regulator_register(&pdev->dev, &buck_regs[i], &config);\n\t\tif (IS_ERR(rdev))\n\t\t\treturn dev_err_probe(tps->dev, PTR_ERR(rdev),\n\t\t\t\t\t     \"failed to register %s regulator\\n\",\n\t\t\t\t\t     pdev->name);\n\n\t\terror = tps6594_request_reg_irqs(pdev, rdev, irq_data,\n\t\t\t\t\t\t tps6594_bucks_irq_types[i], &irq_idx);\n\t\tif (error)\n\t\t\treturn error;\n\t}\n\n\t \n\tif (tps->chip_id != LP8764) {\n\t\tfor (i = 0; i < ARRAY_SIZE(ldo_regs); i++) {\n\t\t\trdev = devm_regulator_register(&pdev->dev, &ldo_regs[i], &config);\n\t\t\tif (IS_ERR(rdev))\n\t\t\t\treturn dev_err_probe(tps->dev, PTR_ERR(rdev),\n\t\t\t\t\t\t     \"failed to register %s regulator\\n\",\n\t\t\t\t\t\t     pdev->name);\n\n\t\t\terror = tps6594_request_reg_irqs(pdev, rdev, irq_data,\n\t\t\t\t\t\t\t tps6594_ldos_irq_types[i],\n\t\t\t\t\t\t\t &irq_idx);\n\t\t\tif (error)\n\t\t\t\treturn error;\n\t\t}\n\t}\n\n\tif (tps->chip_id == LP8764)\n\t\text_reg_irq_nb = ARRAY_SIZE(tps6594_ext_regulator_irq_types);\n\n\tirq_ext_reg_data = devm_kmalloc_array(tps->dev,\n\t\t\t\t\text_reg_irq_nb,\n\t\t\t\t\tsizeof(struct tps6594_ext_regulator_irq_data),\n\t\t\t\t\tGFP_KERNEL);\n\tif (!irq_ext_reg_data)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < ext_reg_irq_nb; ++i) {\n\t\tirq_type = &tps6594_ext_regulator_irq_types[i];\n\n\t\tirq = platform_get_irq_byname(pdev, irq_type->irq_name);\n\t\tif (irq < 0)\n\t\t\treturn -EINVAL;\n\n\t\tirq_ext_reg_data[i].dev = tps->dev;\n\t\tirq_ext_reg_data[i].type = irq_type;\n\n\t\terror = devm_request_threaded_irq(tps->dev, irq, NULL,\n\t\t\t\t\t\t  tps6594_regulator_irq_handler,\n\t\t\t\t\t\t  IRQF_ONESHOT,\n\t\t\t\t\t\t  irq_type->irq_name,\n\t\t\t\t\t\t  &irq_ext_reg_data[i]);\n\t\tif (error)\n\t\t\treturn dev_err_probe(tps->dev, error,\n\t\t\t\t\t     \"failed to request %s IRQ %d\\n\",\n\t\t\t\t\t     irq_type->irq_name, irq);\n\t}\n\treturn 0;\n}\n\nstatic struct platform_driver tps6594_regulator_driver = {\n\t.driver = {\n\t\t.name = \"tps6594-regulator\",\n\t},\n\t.probe = tps6594_regulator_probe,\n};\n\nmodule_platform_driver(tps6594_regulator_driver);\n\nMODULE_ALIAS(\"platform:tps6594-regulator\");\nMODULE_AUTHOR(\"Jerome Neanne <jneanne@baylibre.com>\");\nMODULE_DESCRIPTION(\"TPS6594 voltage regulator driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}