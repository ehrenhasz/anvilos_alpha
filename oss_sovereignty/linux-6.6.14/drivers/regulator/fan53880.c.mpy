{
  "module_name": "fan53880.c",
  "hash_id": "07dd2bd382b45bbd0b4553f8a990b897c4601f95833a321edc6636b1ee039867",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/fan53880.c",
  "human_readable_source": "\n#include <linux/module.h>\n#include <linux/i2c.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n\nenum fan53880_regulator_ids {\n\tFAN53880_LDO1,\n\tFAN53880_LDO2,\n\tFAN53880_LDO3,\n\tFAN53880_LDO4,\n\tFAN53880_BUCK,\n\tFAN53880_BOOST,\n};\n\nenum fan53880_registers {\n\tFAN53880_PRODUCT_ID = 0x00,\n\tFAN53880_SILICON_REV,\n\tFAN53880_BUCKVOUT,\n\tFAN53880_BOOSTVOUT,\n\tFAN53880_LDO1VOUT,\n\tFAN53880_LDO2VOUT,\n\tFAN53880_LDO3VOUT,\n\tFAN53880_LDO4VOUT,\n\tFAN53880_IOUT,\n\tFAN53880_ENABLE,\n\tFAN53880_ENABLE_BOOST,\n};\n\n#define FAN53880_ID\t0x01\n\nstatic const struct regulator_ops fan53880_ops = {\n\t.list_voltage = regulator_list_voltage_linear_range,\n\t.map_voltage = regulator_map_voltage_linear_range,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n};\n\n#define FAN53880_LDO(_num, _supply, _default)\t\t\t\t\\\n\t[FAN53880_LDO ## _num] = {\t\t\t\t\t\\\n\t\t.name =\t\t   \"LDO\"#_num,\t\t\t\t\\\n\t\t.of_match =\t   \"LDO\"#_num,\t\t\\\n\t\t.regulators_node = \"regulators\",\t\t\\\n\t\t.type =\t\t   REGULATOR_VOLTAGE,\t\t\t\\\n\t\t.owner =\t   THIS_MODULE,\t\t\t\t\\\n\t\t.linear_ranges =   (struct linear_range[]) {\t\t\\\n\t\t      REGULATOR_LINEAR_RANGE(_default, 0x0, 0x0, 0),\t\\\n\t\t      REGULATOR_LINEAR_RANGE(800000, 0xf, 0x73, 25000),\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.n_linear_ranges = 2,\t\t\t\t\t\\\n\t\t.n_voltages =\t   0x74,\t\t\t\t\\\n\t\t.vsel_reg =\t   FAN53880_LDO ## _num ## VOUT,\t\\\n\t\t.vsel_mask =\t   0x7f,\t\t\t\t\\\n\t\t.enable_reg =\t   FAN53880_ENABLE,\t\t\t\\\n\t\t.enable_mask =\t   BIT(_num - 1),\t\t\t\\\n\t\t.enable_time =\t   150,\t\t\t\t\t\\\n\t\t.supply_name =\t   _supply,\t\t\t\t\\\n\t\t.ops =\t\t   &fan53880_ops,\t\t\t\\\n\t}\n\nstatic const struct regulator_desc fan53880_regulators[] = {\n\tFAN53880_LDO(1, \"VIN12\", 2800000),\n\tFAN53880_LDO(2, \"VIN12\", 2800000),\n\tFAN53880_LDO(3, \"VIN3\", 1800000),\n\tFAN53880_LDO(4, \"VIN4\", 1800000),\n\t[FAN53880_BUCK] = {\n\t\t.name =\t\t   \"BUCK\",\n\t\t.of_match =\t   \"BUCK\",\n\t\t.regulators_node = \"regulators\",\n\t\t.type =\t\t   REGULATOR_VOLTAGE,\n\t\t.owner =\t   THIS_MODULE,\n\t\t.linear_ranges =   (struct linear_range[]) {\n\t\t      REGULATOR_LINEAR_RANGE(1100000, 0x0, 0x0, 0),\n\t\t      REGULATOR_LINEAR_RANGE(600000, 0x1f, 0xf7, 12500),\n\t\t},\n\t\t.n_linear_ranges = 2,\n\t\t.n_voltages =\t   0xf8,\n\t\t.vsel_reg =\t   FAN53880_BUCKVOUT,\n\t\t.vsel_mask =\t   0xff,\n\t\t.enable_reg =\t   FAN53880_ENABLE,\n\t\t.enable_mask =\t   0x10,\n\t\t.enable_time =\t   480,\n\t\t.supply_name =\t   \"PVIN\",\n\t\t.ops =\t\t   &fan53880_ops,\n\t},\n\t[FAN53880_BOOST] = {\n\t\t.name =\t\t   \"BOOST\",\n\t\t.of_match =\t   \"BOOST\",\n\t\t.regulators_node = \"regulators\",\n\t\t.type =\t\t   REGULATOR_VOLTAGE,\n\t\t.owner =\t   THIS_MODULE,\n\t\t.linear_ranges =   (struct linear_range[]) {\n\t\t      REGULATOR_LINEAR_RANGE(5000000, 0x0, 0x0, 0),\n\t\t      REGULATOR_LINEAR_RANGE(3000000, 0x4, 0x70, 25000),\n\t\t},\n\t\t.n_linear_ranges = 2,\n\t\t.n_voltages =\t   0x71,\n\t\t.vsel_reg =\t   FAN53880_BOOSTVOUT,\n\t\t.vsel_mask =\t   0x7f,\n\t\t.enable_reg =\t   FAN53880_ENABLE_BOOST,\n\t\t.enable_mask =\t   0xff,\n\t\t.enable_time =\t   580,\n\t\t.supply_name =\t   \"PVIN\",\n\t\t.ops =\t\t   &fan53880_ops,\n\t},\n};\n\nstatic const struct regmap_config fan53880_regmap = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\t.max_register = FAN53880_ENABLE_BOOST,\n};\n\nstatic int fan53880_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct regulator_config config = { };\n\tstruct regulator_dev *rdev;\n\tstruct regmap *regmap;\n\tint i, ret;\n\tunsigned int data;\n\n\tregmap = devm_regmap_init_i2c(i2c, &fan53880_regmap);\n\tif (IS_ERR(regmap)) {\n\t\tret = PTR_ERR(regmap);\n\t\tdev_err(&i2c->dev, \"Failed to create regmap: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tret = regmap_read(regmap, FAN53880_PRODUCT_ID, &data);\n\tif (ret < 0) {\n\t\tdev_err(&i2c->dev, \"Failed to read PRODUCT_ID: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\tif (data != FAN53880_ID) {\n\t\tdev_err(&i2c->dev, \"Unsupported device id: 0x%x.\\n\", data);\n\t\treturn -ENODEV;\n\t}\n\n\tconfig.dev = &i2c->dev;\n\tconfig.init_data = NULL;\n\n\tfor (i = 0; i < ARRAY_SIZE(fan53880_regulators); i++) {\n\t\trdev = devm_regulator_register(&i2c->dev,\n\t\t\t\t\t       &fan53880_regulators[i],\n\t\t\t\t\t       &config);\n\t\tif (IS_ERR(rdev)) {\n\t\t\tret = PTR_ERR(rdev);\n\t\t\tdev_err(&i2c->dev, \"Failed to register %s: %d\\n\",\n\t\t\t\tfan53880_regulators[i].name, ret);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic const struct of_device_id fan53880_dt_ids[] = {\n\t{ .compatible = \"onnn,fan53880\", },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, fan53880_dt_ids);\n\nstatic const struct i2c_device_id fan53880_i2c_id[] = {\n\t{ \"fan53880\", },\n\t{}\n};\nMODULE_DEVICE_TABLE(i2c, fan53880_i2c_id);\n\nstatic struct i2c_driver fan53880_regulator_driver = {\n\t.driver = {\n\t\t.name = \"fan53880\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t\t.of_match_table\t= fan53880_dt_ids,\n\t},\n\t.probe = fan53880_i2c_probe,\n\t.id_table = fan53880_i2c_id,\n};\nmodule_i2c_driver(fan53880_regulator_driver);\n\nMODULE_DESCRIPTION(\"FAN53880 PMIC voltage regulator driver\");\nMODULE_AUTHOR(\"Christoph Fritz <chf.fritz@googlemail.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}