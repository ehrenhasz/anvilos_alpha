{
  "module_name": "rk808-regulator.c",
  "hash_id": "802f2e66b59c951c2f50ab32b6c3f94e50b5e71b39ba8b5799fc6e8948e0d489",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/rk808-regulator.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/gpio.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_gpio.h>\n#include <linux/mfd/rk808.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/of_regulator.h>\n#include <linux/gpio/consumer.h>\n\n \n#define RK808_BUCK_VSEL_MASK\t0x3f\n#define RK808_BUCK4_VSEL_MASK\t0xf\n#define RK808_LDO_VSEL_MASK\t0x1f\n\n#define RK809_BUCK5_VSEL_MASK\t\t0x7\n\n#define RK817_LDO_VSEL_MASK\t\t0x7f\n#define RK817_BOOST_VSEL_MASK\t\t0x7\n#define RK817_BUCK_VSEL_MASK\t\t0x7f\n\n#define RK818_BUCK_VSEL_MASK\t\t0x3f\n#define RK818_BUCK4_VSEL_MASK\t\t0x1f\n#define RK818_LDO_VSEL_MASK\t\t0x1f\n#define RK818_LDO3_ON_VSEL_MASK\t\t0xf\n#define RK818_BOOST_ON_VSEL_MASK\t0xe0\n\n#define RK806_DCDC_SLP_REG_OFFSET\t0x0A\n#define RK806_NLDO_SLP_REG_OFFSET\t0x05\n#define RK806_PLDO_SLP_REG_OFFSET\t0x06\n\n#define RK806_BUCK_SEL_CNT\t\t0xff\n#define RK806_LDO_SEL_CNT\t\t0xff\n\n \n#define RK808_RAMP_RATE_OFFSET\t\t3\n#define RK808_RAMP_RATE_MASK\t\t(3 << RK808_RAMP_RATE_OFFSET)\n#define RK808_RAMP_RATE_2MV_PER_US\t(0 << RK808_RAMP_RATE_OFFSET)\n#define RK808_RAMP_RATE_4MV_PER_US\t(1 << RK808_RAMP_RATE_OFFSET)\n#define RK808_RAMP_RATE_6MV_PER_US\t(2 << RK808_RAMP_RATE_OFFSET)\n#define RK808_RAMP_RATE_10MV_PER_US\t(3 << RK808_RAMP_RATE_OFFSET)\n\n#define RK808_DVS2_POL\t\tBIT(2)\n#define RK808_DVS1_POL\t\tBIT(1)\n\n \n#define RK808_SLP_REG_OFFSET 1\n\n \n#define RK808_DVS_REG_OFFSET 2\n\n \n#define RK808_SLP_SET_OFF_REG_OFFSET 2\n\n \n#define MAX_STEPS_ONE_TIME 8\n\n#define ENABLE_MASK(id)\t\t\t(BIT(id) | BIT(4 + (id)))\n#define DISABLE_VAL(id)\t\t\t(BIT(4 + (id)))\n\n#define RK817_BOOST_DESC(_id, _match, _supply, _min, _max, _step, _vreg,\\\n\t_vmask, _ereg, _emask, _enval, _disval, _etime, m_drop)\t\t\\\n\t{\t\t\t\t\t\t\t\\\n\t\t.name\t\t= (_match),\t\t\t\t\\\n\t\t.supply_name\t= (_supply),\t\t\t\t\\\n\t\t.of_match\t= of_match_ptr(_match),\t\t\t\\\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\t\t\\\n\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\\\n\t\t.id\t\t= (_id),\t\t\t\t\\\n\t\t.n_voltages\t= (((_max) - (_min)) / (_step) + 1),\t\\\n\t\t.owner\t\t= THIS_MODULE,\t\t\t\t\\\n\t\t.min_uV\t\t= (_min) * 1000,\t\t\t\\\n\t\t.uV_step\t= (_step) * 1000,\t\t\t\\\n\t\t.vsel_reg\t= (_vreg),\t\t\t\t\\\n\t\t.vsel_mask\t= (_vmask),\t\t\t\t\\\n\t\t.enable_reg\t= (_ereg),\t\t\t\t\\\n\t\t.enable_mask\t= (_emask),\t\t\t\t\\\n\t\t.enable_val     = (_enval),\t\t\t\t\\\n\t\t.disable_val     = (_disval),\t\t\t\t\\\n\t\t.enable_time\t= (_etime),\t\t\t\t\\\n\t\t.min_dropout_uV = (m_drop) * 1000,\t\t\t\\\n\t\t.ops\t\t= &rk817_boost_ops,\t\t\t\\\n\t}\n\n#define RK8XX_DESC_COM(_id, _match, _supply, _min, _max, _step, _vreg,\t\\\n\t_vmask, _ereg, _emask, _enval, _disval, _etime, _ops)\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.name\t\t= (_match),\t\t\t\t\\\n\t\t.supply_name\t= (_supply),\t\t\t\t\\\n\t\t.of_match\t= of_match_ptr(_match),\t\t\t\\\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\t\t\\\n\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\\\n\t\t.id\t\t= (_id),\t\t\t\t\\\n\t\t.n_voltages\t= (((_max) - (_min)) / (_step) + 1),\t\\\n\t\t.owner\t\t= THIS_MODULE,\t\t\t\t\\\n\t\t.min_uV\t\t= (_min) * 1000,\t\t\t\\\n\t\t.uV_step\t= (_step) * 1000,\t\t\t\\\n\t\t.vsel_reg\t= (_vreg),\t\t\t\t\\\n\t\t.vsel_mask\t= (_vmask),\t\t\t\t\\\n\t\t.enable_reg\t= (_ereg),\t\t\t\t\\\n\t\t.enable_mask\t= (_emask),\t\t\t\t\\\n\t\t.enable_val     = (_enval),\t\t\t\t\\\n\t\t.disable_val     = (_disval),\t\t\t\t\\\n\t\t.enable_time\t= (_etime),\t\t\t\t\\\n\t\t.ops\t\t= _ops,\t\t\t\\\n\t}\n\n#define RK805_DESC(_id, _match, _supply, _min, _max, _step, _vreg,\t\\\n\t_vmask, _ereg, _emask, _etime)\t\t\t\t\t\\\n\tRK8XX_DESC_COM(_id, _match, _supply, _min, _max, _step, _vreg,\t\\\n\t_vmask, _ereg, _emask, 0, 0, _etime, &rk805_reg_ops)\n\n#define RK806_REGULATOR(_name, _supply_name, _id, _ops,\\\n\t\t\t_n_voltages, _vr, _er, _lr, ctrl_bit,\\\n\t\t\t_rr, _rm, _rt)\\\n[_id] = {\\\n\t\t.name = _name,\\\n\t\t.supply_name = _supply_name,\\\n\t\t.of_match = of_match_ptr(_name),\\\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\\\n\t\t.id = _id,\\\n\t\t.ops = &_ops,\\\n\t\t.type = REGULATOR_VOLTAGE,\\\n\t\t.n_voltages = _n_voltages,\\\n\t\t.linear_ranges = _lr,\\\n\t\t.n_linear_ranges = ARRAY_SIZE(_lr),\\\n\t\t.vsel_reg = _vr,\\\n\t\t.vsel_mask = 0xff,\\\n\t\t.enable_reg = _er,\\\n\t\t.enable_mask = ENABLE_MASK(ctrl_bit),\\\n\t\t.enable_val = ENABLE_MASK(ctrl_bit),\\\n\t\t.disable_val = DISABLE_VAL(ctrl_bit),\\\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\\\n\t\t.ramp_reg = _rr,\\\n\t\t.ramp_mask = _rm,\\\n\t\t.ramp_delay_table = _rt, \\\n\t\t.n_ramp_values = ARRAY_SIZE(_rt), \\\n\t\t.owner = THIS_MODULE,\\\n\t}\n\n#define RK8XX_DESC(_id, _match, _supply, _min, _max, _step, _vreg,\t\\\n\t_vmask, _ereg, _emask, _etime)\t\t\t\t\t\\\n\tRK8XX_DESC_COM(_id, _match, _supply, _min, _max, _step, _vreg,\t\\\n\t_vmask, _ereg, _emask, 0, 0, _etime, &rk808_reg_ops)\n\n#define RK817_DESC(_id, _match, _supply, _min, _max, _step, _vreg,\t\\\n\t_vmask, _ereg, _emask, _disval, _etime)\t\t\t\t\\\n\tRK8XX_DESC_COM(_id, _match, _supply, _min, _max, _step, _vreg,\t\\\n\t_vmask, _ereg, _emask, _emask, _disval, _etime, &rk817_reg_ops)\n\n#define RKXX_DESC_SWITCH_COM(_id, _match, _supply, _ereg, _emask,\t\\\n\t_enval, _disval, _ops)\t\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.name\t\t= (_match),\t\t\t\t\\\n\t\t.supply_name\t= (_supply),\t\t\t\t\\\n\t\t.of_match\t= of_match_ptr(_match),\t\t\t\\\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\t\t\\\n\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\\\n\t\t.id\t\t= (_id),\t\t\t\t\\\n\t\t.enable_reg\t= (_ereg),\t\t\t\t\\\n\t\t.enable_mask\t= (_emask),\t\t\t\t\\\n\t\t.enable_val     = (_enval),\t\t\t\t\\\n\t\t.disable_val     = (_disval),\t\t\t\t\\\n\t\t.owner\t\t= THIS_MODULE,\t\t\t\t\\\n\t\t.ops\t\t= _ops\t\t\t\t\t\\\n\t}\n\n#define RK817_DESC_SWITCH(_id, _match, _supply, _ereg, _emask,\t\t\\\n\t_disval)\t\t\t\t\t\t\t\\\n\tRKXX_DESC_SWITCH_COM(_id, _match, _supply, _ereg, _emask,\t\\\n\t_emask, _disval, &rk817_switch_ops)\n\n#define RK8XX_DESC_SWITCH(_id, _match, _supply, _ereg, _emask)\t\t\\\n\tRKXX_DESC_SWITCH_COM(_id, _match, _supply, _ereg, _emask,\t\\\n\t0, 0, &rk808_switch_ops)\n\nstruct rk8xx_register_bit {\n\tu8 reg;\n\tu8 bit;\n};\n\n#define RK8XX_REG_BIT(_reg, _bit)\t\t\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.reg = _reg,\t\t\t\t\t\t\\\n\t\t.bit = BIT(_bit),\t\t\t\t\t\t\\\n\t}\n\nstruct rk808_regulator_data {\n\tstruct gpio_desc *dvs_gpio[2];\n};\n\nstatic const struct linear_range rk808_ldo3_voltage_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(800000, 0, 13, 100000),\n\tREGULATOR_LINEAR_RANGE(2500000, 15, 15, 0),\n};\n\n#define RK809_BUCK5_SEL_CNT\t\t(8)\n\nstatic const struct linear_range rk809_buck5_voltage_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(1500000, 0, 0, 0),\n\tREGULATOR_LINEAR_RANGE(1800000, 1, 3, 200000),\n\tREGULATOR_LINEAR_RANGE(2800000, 4, 5, 200000),\n\tREGULATOR_LINEAR_RANGE(3300000, 6, 7, 300000),\n};\n\n#define RK817_BUCK1_MIN0 500000\n#define RK817_BUCK1_MAX0 1500000\n\n#define RK817_BUCK1_MIN1 1600000\n#define RK817_BUCK1_MAX1 2400000\n\n#define RK817_BUCK3_MAX1 3400000\n\n#define RK817_BUCK1_STP0 12500\n#define RK817_BUCK1_STP1 100000\n\n#define RK817_BUCK1_SEL0 ((RK817_BUCK1_MAX0 - RK817_BUCK1_MIN0) /\\\n\t\t\t\t\t\t  RK817_BUCK1_STP0)\n#define RK817_BUCK1_SEL1 ((RK817_BUCK1_MAX1 - RK817_BUCK1_MIN1) /\\\n\t\t\t\t\t\t  RK817_BUCK1_STP1)\n\n#define RK817_BUCK3_SEL1 ((RK817_BUCK3_MAX1 - RK817_BUCK1_MIN1) /\\\n\t\t\t\t\t\t  RK817_BUCK1_STP1)\n\n#define RK817_BUCK1_SEL_CNT (RK817_BUCK1_SEL0 + RK817_BUCK1_SEL1 + 1)\n#define RK817_BUCK3_SEL_CNT (RK817_BUCK1_SEL0 + RK817_BUCK3_SEL1 + 1)\n\nstatic const struct linear_range rk817_buck1_voltage_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(RK817_BUCK1_MIN0, 0,\n\t\t\t       RK817_BUCK1_SEL0, RK817_BUCK1_STP0),\n\tREGULATOR_LINEAR_RANGE(RK817_BUCK1_MIN1, RK817_BUCK1_SEL0 + 1,\n\t\t\t       RK817_BUCK1_SEL_CNT, RK817_BUCK1_STP1),\n};\n\nstatic const struct linear_range rk817_buck3_voltage_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(RK817_BUCK1_MIN0, 0,\n\t\t\t       RK817_BUCK1_SEL0, RK817_BUCK1_STP0),\n\tREGULATOR_LINEAR_RANGE(RK817_BUCK1_MIN1, RK817_BUCK1_SEL0 + 1,\n\t\t\t       RK817_BUCK3_SEL_CNT, RK817_BUCK1_STP1),\n};\n\nstatic const unsigned int rk808_buck1_2_ramp_table[] = {\n\t2000, 4000, 6000, 10000\n};\n\n \nstatic const unsigned int rk817_buck1_4_ramp_table[] = {\n\t3000, 6300, 12500, 25000\n};\n\nstatic int rk806_set_mode_dcdc(struct regulator_dev *rdev, unsigned int mode)\n{\n\tint rid = rdev_get_id(rdev);\n\tint ctr_bit, reg;\n\n\treg = RK806_POWER_FPWM_EN0 + rid / 8;\n\tctr_bit = rid % 8;\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_FAST:\n\t\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t\t  PWM_MODE_MSK << ctr_bit,\n\t\t\t\t\t  FPWM_MODE << ctr_bit);\n\tcase REGULATOR_MODE_NORMAL:\n\t\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t\t  PWM_MODE_MSK << ctr_bit,\n\t\t\t\t\t  AUTO_PWM_MODE << ctr_bit);\n\tdefault:\n\t\tdev_err(rdev_get_dev(rdev), \"mode unsupported: %u\\n\", mode);\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic unsigned int rk806_get_mode_dcdc(struct regulator_dev *rdev)\n{\n\tint rid = rdev_get_id(rdev);\n\tint ctr_bit, reg;\n\tunsigned int val;\n\tint err;\n\n\treg = RK806_POWER_FPWM_EN0 + rid / 8;\n\tctr_bit = rid % 8;\n\n\terr = regmap_read(rdev->regmap, reg, &val);\n\tif (err)\n\t\treturn err;\n\n\tif ((val >> ctr_bit) & FPWM_MODE)\n\t\treturn REGULATOR_MODE_FAST;\n\telse\n\t\treturn REGULATOR_MODE_NORMAL;\n}\n\nstatic const struct rk8xx_register_bit rk806_dcdc_rate2[] = {\n\tRK8XX_REG_BIT(0xEB, 0),\n\tRK8XX_REG_BIT(0xEB, 1),\n\tRK8XX_REG_BIT(0xEB, 2),\n\tRK8XX_REG_BIT(0xEB, 3),\n\tRK8XX_REG_BIT(0xEB, 4),\n\tRK8XX_REG_BIT(0xEB, 5),\n\tRK8XX_REG_BIT(0xEB, 6),\n\tRK8XX_REG_BIT(0xEB, 7),\n\tRK8XX_REG_BIT(0xEA, 0),\n\tRK8XX_REG_BIT(0xEA, 1),\n};\n\nstatic const unsigned int rk806_ramp_delay_table_dcdc[] = {\n\t50000, 25000, 12500, 6250, 3125, 1560, 961, 390\n};\n\nstatic int rk806_set_ramp_delay_dcdc(struct regulator_dev *rdev, int ramp_delay)\n{\n\tint rid = rdev_get_id(rdev);\n\tint regval, ramp_value, ret;\n\n\tret = regulator_find_closest_bigger(ramp_delay, rdev->desc->ramp_delay_table,\n\t\t\t\t\t    rdev->desc->n_ramp_values, &ramp_value);\n\tif (ret) {\n\t\tdev_warn(rdev_get_dev(rdev),\n\t\t\t \"Can't set ramp-delay %u, setting %u\\n\", ramp_delay,\n\t\t\t rdev->desc->ramp_delay_table[ramp_value]);\n\t}\n\n\tregval = ramp_value << (ffs(rdev->desc->ramp_mask) - 1);\n\n\tret = regmap_update_bits(rdev->regmap, rdev->desc->ramp_reg,\n\t\t\t\t rdev->desc->ramp_mask, regval);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\n\tregval = (ramp_value >> 2) & 0x1 ? rk806_dcdc_rate2[rid].bit : 0;\n\treturn regmap_update_bits(rdev->regmap, rk806_dcdc_rate2[rid].reg,\n\t\t\t\t  rk806_dcdc_rate2[rid].bit,\n\t\t\t\t  regval);\n}\n\nstatic const unsigned int rk806_ramp_delay_table_ldo[] = {\n\t100000, 50000, 25000, 12500, 6280, 3120, 1900, 780\n};\n\nstatic int rk806_set_suspend_voltage_range(struct regulator_dev *rdev, int reg_offset, int uv)\n{\n\tint sel = regulator_map_voltage_linear_range(rdev, uv, uv);\n\tunsigned int reg;\n\n\tif (sel < 0)\n\t\treturn -EINVAL;\n\n\treg = rdev->desc->vsel_reg + reg_offset;\n\n\treturn regmap_update_bits(rdev->regmap, reg, rdev->desc->vsel_mask, sel);\n}\n\nstatic int rk806_set_suspend_voltage_range_dcdc(struct regulator_dev *rdev, int uv)\n{\n\treturn rk806_set_suspend_voltage_range(rdev, RK806_DCDC_SLP_REG_OFFSET, uv);\n}\n\nstatic int rk806_set_suspend_voltage_range_nldo(struct regulator_dev *rdev, int uv)\n{\n\treturn rk806_set_suspend_voltage_range(rdev, RK806_NLDO_SLP_REG_OFFSET, uv);\n}\n\nstatic int rk806_set_suspend_voltage_range_pldo(struct regulator_dev *rdev, int uv)\n{\n\treturn rk806_set_suspend_voltage_range(rdev, RK806_PLDO_SLP_REG_OFFSET, uv);\n}\n\nstatic int rk808_buck1_2_get_voltage_sel_regmap(struct regulator_dev *rdev)\n{\n\tstruct rk808_regulator_data *pdata = rdev_get_drvdata(rdev);\n\tint id = rdev_get_id(rdev);\n\tstruct gpio_desc *gpio = pdata->dvs_gpio[id];\n\tunsigned int val;\n\tint ret;\n\n\tif (!gpio || gpiod_get_value(gpio) == 0)\n\t\treturn regulator_get_voltage_sel_regmap(rdev);\n\n\tret = regmap_read(rdev->regmap,\n\t\t\t  rdev->desc->vsel_reg + RK808_DVS_REG_OFFSET,\n\t\t\t  &val);\n\tif (ret != 0)\n\t\treturn ret;\n\n\tval &= rdev->desc->vsel_mask;\n\tval >>= ffs(rdev->desc->vsel_mask) - 1;\n\n\treturn val;\n}\n\nstatic int rk808_buck1_2_i2c_set_voltage_sel(struct regulator_dev *rdev,\n\t\t\t\t\t     unsigned sel)\n{\n\tint ret, delta_sel;\n\tunsigned int old_sel, tmp, val, mask = rdev->desc->vsel_mask;\n\n\tret = regmap_read(rdev->regmap, rdev->desc->vsel_reg, &val);\n\tif (ret != 0)\n\t\treturn ret;\n\n\ttmp = val & ~mask;\n\told_sel = val & mask;\n\told_sel >>= ffs(mask) - 1;\n\tdelta_sel = sel - old_sel;\n\n\t \n\twhile (delta_sel > MAX_STEPS_ONE_TIME) {\n\t\told_sel += MAX_STEPS_ONE_TIME;\n\t\tval = old_sel << (ffs(mask) - 1);\n\t\tval |= tmp;\n\n\t\t \n\t\tret = regmap_write(rdev->regmap, rdev->desc->vsel_reg, val);\n\t\tdelta_sel = sel - old_sel;\n\t}\n\n\tsel <<= ffs(mask) - 1;\n\tval = tmp | sel;\n\tret = regmap_write(rdev->regmap, rdev->desc->vsel_reg, val);\n\n\t \n\tudelay(1);\n\n\treturn ret;\n}\n\nstatic int rk808_buck1_2_set_voltage_sel(struct regulator_dev *rdev,\n\t\t\t\t\t unsigned sel)\n{\n\tstruct rk808_regulator_data *pdata = rdev_get_drvdata(rdev);\n\tint id = rdev_get_id(rdev);\n\tstruct gpio_desc *gpio = pdata->dvs_gpio[id];\n\tunsigned int reg = rdev->desc->vsel_reg;\n\tunsigned old_sel;\n\tint ret, gpio_level;\n\n\tif (!gpio)\n\t\treturn rk808_buck1_2_i2c_set_voltage_sel(rdev, sel);\n\n\tgpio_level = gpiod_get_value(gpio);\n\tif (gpio_level == 0) {\n\t\treg += RK808_DVS_REG_OFFSET;\n\t\tret = regmap_read(rdev->regmap, rdev->desc->vsel_reg, &old_sel);\n\t} else {\n\t\tret = regmap_read(rdev->regmap,\n\t\t\t\t  reg + RK808_DVS_REG_OFFSET,\n\t\t\t\t  &old_sel);\n\t}\n\n\tif (ret != 0)\n\t\treturn ret;\n\n\tsel <<= ffs(rdev->desc->vsel_mask) - 1;\n\tsel |= old_sel & ~rdev->desc->vsel_mask;\n\n\tret = regmap_write(rdev->regmap, reg, sel);\n\tif (ret)\n\t\treturn ret;\n\n\tgpiod_set_value(gpio, !gpio_level);\n\n\treturn ret;\n}\n\nstatic int rk808_buck1_2_set_voltage_time_sel(struct regulator_dev *rdev,\n\t\t\t\t       unsigned int old_selector,\n\t\t\t\t       unsigned int new_selector)\n{\n\tstruct rk808_regulator_data *pdata = rdev_get_drvdata(rdev);\n\tint id = rdev_get_id(rdev);\n\tstruct gpio_desc *gpio = pdata->dvs_gpio[id];\n\n\t \n\tif (!gpio)\n\t\treturn 0;\n\n\treturn regulator_set_voltage_time_sel(rdev, old_selector, new_selector);\n}\n\nstatic int rk808_set_suspend_voltage(struct regulator_dev *rdev, int uv)\n{\n\tunsigned int reg;\n\tint sel = regulator_map_voltage_linear(rdev, uv, uv);\n\n\tif (sel < 0)\n\t\treturn -EINVAL;\n\n\treg = rdev->desc->vsel_reg + RK808_SLP_REG_OFFSET;\n\n\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t  rdev->desc->vsel_mask,\n\t\t\t\t  sel);\n}\n\nstatic int rk808_set_suspend_voltage_range(struct regulator_dev *rdev, int uv)\n{\n\tunsigned int reg;\n\tint sel = regulator_map_voltage_linear_range(rdev, uv, uv);\n\n\tif (sel < 0)\n\t\treturn -EINVAL;\n\n\treg = rdev->desc->vsel_reg + RK808_SLP_REG_OFFSET;\n\n\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t  rdev->desc->vsel_mask,\n\t\t\t\t  sel);\n}\n\nstatic int rk805_set_suspend_enable(struct regulator_dev *rdev)\n{\n\tunsigned int reg;\n\n\treg = rdev->desc->enable_reg + RK808_SLP_SET_OFF_REG_OFFSET;\n\n\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t  rdev->desc->enable_mask,\n\t\t\t\t  rdev->desc->enable_mask);\n}\n\nstatic int rk805_set_suspend_disable(struct regulator_dev *rdev)\n{\n\tunsigned int reg;\n\n\treg = rdev->desc->enable_reg + RK808_SLP_SET_OFF_REG_OFFSET;\n\n\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t  rdev->desc->enable_mask,\n\t\t\t\t  0);\n}\n\nstatic const struct rk8xx_register_bit rk806_suspend_bits[] = {\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 0),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 1),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 2),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 3),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 4),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 5),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 6),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN0, 7),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN1, 6),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN1, 7),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN1, 0),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN1, 1),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN1, 2),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN1, 3),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN1, 4),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN2, 1),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN2, 2),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN2, 3),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN2, 4),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN2, 5),\n\tRK8XX_REG_BIT(RK806_POWER_SLP_EN2, 0),\n};\n\nstatic int rk806_set_suspend_enable(struct regulator_dev *rdev)\n{\n\tint rid = rdev_get_id(rdev);\n\n\treturn regmap_update_bits(rdev->regmap, rk806_suspend_bits[rid].reg,\n\t\t\t\t  rk806_suspend_bits[rid].bit,\n\t\t\t\t  rk806_suspend_bits[rid].bit);\n}\n\nstatic int rk806_set_suspend_disable(struct regulator_dev *rdev)\n{\n\tint rid = rdev_get_id(rdev);\n\n\treturn regmap_update_bits(rdev->regmap, rk806_suspend_bits[rid].reg,\n\t\t\t\t  rk806_suspend_bits[rid].bit, 0);\n}\n\nstatic int rk808_set_suspend_enable(struct regulator_dev *rdev)\n{\n\tunsigned int reg;\n\n\treg = rdev->desc->enable_reg + RK808_SLP_SET_OFF_REG_OFFSET;\n\n\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t  rdev->desc->enable_mask,\n\t\t\t\t  0);\n}\n\nstatic int rk808_set_suspend_disable(struct regulator_dev *rdev)\n{\n\tunsigned int reg;\n\n\treg = rdev->desc->enable_reg + RK808_SLP_SET_OFF_REG_OFFSET;\n\n\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t  rdev->desc->enable_mask,\n\t\t\t\t  rdev->desc->enable_mask);\n}\n\nstatic int rk817_set_suspend_enable_ctrl(struct regulator_dev *rdev,\n\t\t\t\t\t unsigned int en)\n{\n\tunsigned int reg;\n\tint id = rdev_get_id(rdev);\n\tunsigned int id_slp, msk, val;\n\n\tif (id >= RK817_ID_DCDC1 && id <= RK817_ID_DCDC4)\n\t\tid_slp = id;\n\telse if (id >= RK817_ID_LDO1 && id <= RK817_ID_LDO8)\n\t\tid_slp = 8 + (id - RK817_ID_LDO1);\n\telse if (id >= RK817_ID_LDO9 && id <= RK809_ID_SW2)\n\t\tid_slp = 4 + (id - RK817_ID_LDO9);\n\telse\n\t\treturn -EINVAL;\n\n\treg = RK817_POWER_SLP_EN_REG(id_slp / 8);\n\n\tmsk = BIT(id_slp % 8);\n\tif (en)\n\t\tval = msk;\n\telse\n\t\tval = 0;\n\n\treturn regmap_update_bits(rdev->regmap, reg, msk, val);\n}\n\nstatic int rk817_set_suspend_enable(struct regulator_dev *rdev)\n{\n\treturn rk817_set_suspend_enable_ctrl(rdev, 1);\n}\n\nstatic int rk817_set_suspend_disable(struct regulator_dev *rdev)\n{\n\treturn rk817_set_suspend_enable_ctrl(rdev, 0);\n}\n\nstatic int rk8xx_set_suspend_mode(struct regulator_dev *rdev, unsigned int mode)\n{\n\tunsigned int reg;\n\n\treg = rdev->desc->vsel_reg + RK808_SLP_REG_OFFSET;\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_FAST:\n\t\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t\t  PWM_MODE_MSK, FPWM_MODE);\n\tcase REGULATOR_MODE_NORMAL:\n\t\treturn regmap_update_bits(rdev->regmap, reg,\n\t\t\t\t\t  PWM_MODE_MSK, AUTO_PWM_MODE);\n\tdefault:\n\t\tdev_err(&rdev->dev, \"do not support this mode\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic int rk8xx_set_mode(struct regulator_dev *rdev, unsigned int mode)\n{\n\tswitch (mode) {\n\tcase REGULATOR_MODE_FAST:\n\t\treturn regmap_update_bits(rdev->regmap, rdev->desc->vsel_reg,\n\t\t\t\t\t  PWM_MODE_MSK, FPWM_MODE);\n\tcase REGULATOR_MODE_NORMAL:\n\t\treturn regmap_update_bits(rdev->regmap, rdev->desc->vsel_reg,\n\t\t\t\t\t  PWM_MODE_MSK, AUTO_PWM_MODE);\n\tdefault:\n\t\tdev_err(&rdev->dev, \"do not support this mode\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\treturn 0;\n}\n\nstatic unsigned int rk8xx_get_mode(struct regulator_dev *rdev)\n{\n\tunsigned int val;\n\tint err;\n\n\terr = regmap_read(rdev->regmap, rdev->desc->vsel_reg, &val);\n\tif (err)\n\t\treturn err;\n\n\tif (val & FPWM_MODE)\n\t\treturn REGULATOR_MODE_FAST;\n\telse\n\t\treturn REGULATOR_MODE_NORMAL;\n}\n\nstatic int rk8xx_is_enabled_wmsk_regmap(struct regulator_dev *rdev)\n{\n\tunsigned int val;\n\tint ret;\n\n\tret = regmap_read(rdev->regmap, rdev->desc->enable_reg, &val);\n\tif (ret != 0)\n\t\treturn ret;\n\n\t \n\tval |= (rdev->desc->enable_mask & 0xf0);\n\tval &= rdev->desc->enable_mask;\n\n\tif (rdev->desc->enable_is_inverted) {\n\t\tif (rdev->desc->enable_val)\n\t\t\treturn val != rdev->desc->enable_val;\n\t\treturn (val == 0);\n\t}\n\tif (rdev->desc->enable_val)\n\t\treturn val == rdev->desc->enable_val;\n\treturn val != 0;\n}\n\nstatic unsigned int rk8xx_regulator_of_map_mode(unsigned int mode)\n{\n\tswitch (mode) {\n\tcase 1:\n\t\treturn REGULATOR_MODE_FAST;\n\tcase 2:\n\t\treturn REGULATOR_MODE_NORMAL;\n\tdefault:\n\t\treturn REGULATOR_MODE_INVALID;\n\t}\n}\n\nstatic const struct regulator_ops rk805_reg_ops = {\n\t.list_voltage           = regulator_list_voltage_linear,\n\t.map_voltage            = regulator_map_voltage_linear,\n\t.get_voltage_sel        = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel        = regulator_set_voltage_sel_regmap,\n\t.enable                 = regulator_enable_regmap,\n\t.disable                = regulator_disable_regmap,\n\t.is_enabled             = regulator_is_enabled_regmap,\n\t.set_suspend_voltage    = rk808_set_suspend_voltage,\n\t.set_suspend_enable     = rk805_set_suspend_enable,\n\t.set_suspend_disable    = rk805_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk805_switch_ops = {\n\t.enable                 = regulator_enable_regmap,\n\t.disable                = regulator_disable_regmap,\n\t.is_enabled             = regulator_is_enabled_regmap,\n\t.set_suspend_enable     = rk805_set_suspend_enable,\n\t.set_suspend_disable    = rk805_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk806_ops_dcdc = {\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel        = regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.set_mode\t\t= rk806_set_mode_dcdc,\n\t.get_mode\t\t= rk806_get_mode_dcdc,\n\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= rk8xx_is_enabled_wmsk_regmap,\n\n\t.set_suspend_mode\t= rk806_set_mode_dcdc,\n\t.set_ramp_delay\t\t= rk806_set_ramp_delay_dcdc,\n\n\t.set_suspend_voltage\t= rk806_set_suspend_voltage_range_dcdc,\n\t.set_suspend_enable\t= rk806_set_suspend_enable,\n\t.set_suspend_disable\t= rk806_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk806_ops_nldo = {\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel        = regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\n\t.set_ramp_delay\t\t= regulator_set_ramp_delay_regmap,\n\n\t.set_suspend_voltage\t= rk806_set_suspend_voltage_range_nldo,\n\t.set_suspend_enable\t= rk806_set_suspend_enable,\n\t.set_suspend_disable\t= rk806_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk806_ops_pldo = {\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel        = regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\n\t.set_ramp_delay\t\t= regulator_set_ramp_delay_regmap,\n\n\t.set_suspend_voltage\t= rk806_set_suspend_voltage_range_pldo,\n\t.set_suspend_enable\t= rk806_set_suspend_enable,\n\t.set_suspend_disable\t= rk806_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk808_buck1_2_ops = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.get_voltage_sel\t= rk808_buck1_2_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= rk808_buck1_2_set_voltage_sel,\n\t.set_voltage_time_sel\t= rk808_buck1_2_set_voltage_time_sel,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.set_ramp_delay\t\t= regulator_set_ramp_delay_regmap,\n\t.set_suspend_voltage\t= rk808_set_suspend_voltage,\n\t.set_suspend_enable\t= rk808_set_suspend_enable,\n\t.set_suspend_disable\t= rk808_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk808_reg_ops = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.set_suspend_voltage\t= rk808_set_suspend_voltage,\n\t.set_suspend_enable\t= rk808_set_suspend_enable,\n\t.set_suspend_disable\t= rk808_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk808_reg_ops_ranges = {\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.set_suspend_voltage\t= rk808_set_suspend_voltage_range,\n\t.set_suspend_enable\t= rk808_set_suspend_enable,\n\t.set_suspend_disable\t= rk808_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk808_switch_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.set_suspend_enable\t= rk808_set_suspend_enable,\n\t.set_suspend_disable\t= rk808_set_suspend_disable,\n};\n\nstatic const struct linear_range rk805_buck_1_2_voltage_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(712500, 0, 59, 12500),\n\tREGULATOR_LINEAR_RANGE(1800000, 60, 62, 200000),\n\tREGULATOR_LINEAR_RANGE(2300000, 63, 63, 0),\n};\n\nstatic const struct regulator_ops rk809_buck5_ops_range = {\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= rk8xx_is_enabled_wmsk_regmap,\n\t.set_suspend_voltage\t= rk808_set_suspend_voltage_range,\n\t.set_suspend_enable\t= rk817_set_suspend_enable,\n\t.set_suspend_disable\t= rk817_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk817_reg_ops = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= rk8xx_is_enabled_wmsk_regmap,\n\t.set_suspend_voltage\t= rk808_set_suspend_voltage,\n\t.set_suspend_enable\t= rk817_set_suspend_enable,\n\t.set_suspend_disable\t= rk817_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk817_boost_ops = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= rk8xx_is_enabled_wmsk_regmap,\n\t.set_suspend_enable\t= rk817_set_suspend_enable,\n\t.set_suspend_disable\t= rk817_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk817_buck_ops_range = {\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= rk8xx_is_enabled_wmsk_regmap,\n\t.set_mode\t\t= rk8xx_set_mode,\n\t.get_mode\t\t= rk8xx_get_mode,\n\t.set_suspend_mode\t= rk8xx_set_suspend_mode,\n\t.set_ramp_delay\t\t= regulator_set_ramp_delay_regmap,\n\t.set_suspend_voltage\t= rk808_set_suspend_voltage_range,\n\t.set_suspend_enable\t= rk817_set_suspend_enable,\n\t.set_suspend_disable\t= rk817_set_suspend_disable,\n};\n\nstatic const struct regulator_ops rk817_switch_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= rk8xx_is_enabled_wmsk_regmap,\n\t.set_suspend_enable\t= rk817_set_suspend_enable,\n\t.set_suspend_disable\t= rk817_set_suspend_disable,\n};\n\nstatic const struct regulator_desc rk805_reg[] = {\n\t{\n\t\t.name = \"DCDC_REG1\",\n\t\t.supply_name = \"vcc1\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG1\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK805_ID_DCDC1,\n\t\t.ops = &rk808_reg_ops_ranges,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = 64,\n\t\t.linear_ranges = rk805_buck_1_2_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk805_buck_1_2_voltage_ranges),\n\t\t.vsel_reg = RK805_BUCK1_ON_VSEL_REG,\n\t\t.vsel_mask = RK818_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK805_DCDC_EN_REG,\n\t\t.enable_mask = BIT(0),\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG2\",\n\t\t.supply_name = \"vcc2\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG2\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK805_ID_DCDC2,\n\t\t.ops = &rk808_reg_ops_ranges,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = 64,\n\t\t.linear_ranges = rk805_buck_1_2_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk805_buck_1_2_voltage_ranges),\n\t\t.vsel_reg = RK805_BUCK2_ON_VSEL_REG,\n\t\t.vsel_mask = RK818_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK805_DCDC_EN_REG,\n\t\t.enable_mask = BIT(1),\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG3\",\n\t\t.supply_name = \"vcc3\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG3\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK805_ID_DCDC3,\n\t\t.ops = &rk805_switch_ops,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = 1,\n\t\t.enable_reg = RK805_DCDC_EN_REG,\n\t\t.enable_mask = BIT(2),\n\t\t.owner = THIS_MODULE,\n\t},\n\n\tRK805_DESC(RK805_ID_DCDC4, \"DCDC_REG4\", \"vcc4\", 800, 3400, 100,\n\t\tRK805_BUCK4_ON_VSEL_REG, RK818_BUCK4_VSEL_MASK,\n\t\tRK805_DCDC_EN_REG, BIT(3), 0),\n\n\tRK805_DESC(RK805_ID_LDO1, \"LDO_REG1\", \"vcc5\", 800, 3400, 100,\n\t\tRK805_LDO1_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK805_LDO_EN_REG,\n\t\tBIT(0), 400),\n\tRK805_DESC(RK805_ID_LDO2, \"LDO_REG2\", \"vcc5\", 800, 3400, 100,\n\t\tRK805_LDO2_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK805_LDO_EN_REG,\n\t\tBIT(1), 400),\n\tRK805_DESC(RK805_ID_LDO3, \"LDO_REG3\", \"vcc6\", 800, 3400, 100,\n\t\tRK805_LDO3_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK805_LDO_EN_REG,\n\t\tBIT(2), 400),\n};\n\nstatic const struct linear_range rk806_buck_voltage_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(500000, 0, 160, 6250),  \n\tREGULATOR_LINEAR_RANGE(1500000, 161, 237, 25000),  \n\tREGULATOR_LINEAR_RANGE(3400000, 238, 255, 0),\n};\n\nstatic const struct linear_range rk806_ldo_voltage_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(500000, 0, 232, 12500),  \n\tREGULATOR_LINEAR_RANGE(3400000, 233, 255, 0),  \n};\n\nstatic const struct regulator_desc rk806_reg[] = {\n\tRK806_REGULATOR(\"dcdc-reg1\", \"vcc1\", RK806_ID_DCDC1, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK1_ON_VSEL,\n\t\t\tRK806_POWER_EN0, rk806_buck_voltage_ranges, 0,\n\t\t\tRK806_BUCK1_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\tRK806_REGULATOR(\"dcdc-reg2\", \"vcc2\", RK806_ID_DCDC2, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK2_ON_VSEL,\n\t\t\tRK806_POWER_EN0, rk806_buck_voltage_ranges, 1,\n\t\t\tRK806_BUCK2_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\tRK806_REGULATOR(\"dcdc-reg3\", \"vcc3\", RK806_ID_DCDC3, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK3_ON_VSEL,\n\t\t\tRK806_POWER_EN0, rk806_buck_voltage_ranges, 2,\n\t\t\tRK806_BUCK3_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\tRK806_REGULATOR(\"dcdc-reg4\", \"vcc4\", RK806_ID_DCDC4, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK4_ON_VSEL,\n\t\t\tRK806_POWER_EN0, rk806_buck_voltage_ranges, 3,\n\t\t\tRK806_BUCK4_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\n\tRK806_REGULATOR(\"dcdc-reg5\", \"vcc5\", RK806_ID_DCDC5, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK5_ON_VSEL,\n\t\t\tRK806_POWER_EN1, rk806_buck_voltage_ranges, 0,\n\t\t\tRK806_BUCK5_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\tRK806_REGULATOR(\"dcdc-reg6\", \"vcc6\", RK806_ID_DCDC6, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK6_ON_VSEL,\n\t\t\tRK806_POWER_EN1, rk806_buck_voltage_ranges, 1,\n\t\t\tRK806_BUCK6_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\tRK806_REGULATOR(\"dcdc-reg7\", \"vcc7\", RK806_ID_DCDC7, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK7_ON_VSEL,\n\t\t\tRK806_POWER_EN1, rk806_buck_voltage_ranges, 2,\n\t\t\tRK806_BUCK7_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\tRK806_REGULATOR(\"dcdc-reg8\", \"vcc8\", RK806_ID_DCDC8, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK8_ON_VSEL,\n\t\t\tRK806_POWER_EN1, rk806_buck_voltage_ranges, 3,\n\t\t\tRK806_BUCK8_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\n\tRK806_REGULATOR(\"dcdc-reg9\", \"vcc9\", RK806_ID_DCDC9, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK9_ON_VSEL,\n\t\t\tRK806_POWER_EN2, rk806_buck_voltage_ranges, 0,\n\t\t\tRK806_BUCK9_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\tRK806_REGULATOR(\"dcdc-reg10\", \"vcc10\", RK806_ID_DCDC10, rk806_ops_dcdc,\n\t\t\tRK806_BUCK_SEL_CNT, RK806_BUCK10_ON_VSEL,\n\t\t\tRK806_POWER_EN2, rk806_buck_voltage_ranges, 1,\n\t\t\tRK806_BUCK10_CONFIG, 0xc0, rk806_ramp_delay_table_dcdc),\n\n\tRK806_REGULATOR(\"nldo-reg1\", \"vcc13\", RK806_ID_NLDO1, rk806_ops_nldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_NLDO1_ON_VSEL,\n\t\t\tRK806_POWER_EN3, rk806_ldo_voltage_ranges, 0,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\tRK806_REGULATOR(\"nldo-reg2\", \"vcc13\", RK806_ID_NLDO2, rk806_ops_nldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_NLDO2_ON_VSEL,\n\t\t\tRK806_POWER_EN3, rk806_ldo_voltage_ranges, 1,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\tRK806_REGULATOR(\"nldo-reg3\", \"vcc13\", RK806_ID_NLDO3, rk806_ops_nldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_NLDO3_ON_VSEL,\n\t\t\tRK806_POWER_EN3, rk806_ldo_voltage_ranges, 2,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\tRK806_REGULATOR(\"nldo-reg4\", \"vcc14\", RK806_ID_NLDO4, rk806_ops_nldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_NLDO4_ON_VSEL,\n\t\t\tRK806_POWER_EN3, rk806_ldo_voltage_ranges, 3,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\n\tRK806_REGULATOR(\"nldo-reg5\", \"vcc14\", RK806_ID_NLDO5, rk806_ops_nldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_NLDO5_ON_VSEL,\n\t\t\tRK806_POWER_EN5, rk806_ldo_voltage_ranges, 2,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\n\tRK806_REGULATOR(\"pldo-reg1\", \"vcc11\", RK806_ID_PLDO1, rk806_ops_pldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_PLDO1_ON_VSEL,\n\t\t\tRK806_POWER_EN4, rk806_ldo_voltage_ranges, 1,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\tRK806_REGULATOR(\"pldo-reg2\", \"vcc11\", RK806_ID_PLDO2, rk806_ops_pldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_PLDO2_ON_VSEL,\n\t\t\tRK806_POWER_EN4, rk806_ldo_voltage_ranges, 2,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\tRK806_REGULATOR(\"pldo-reg3\", \"vcc11\", RK806_ID_PLDO3, rk806_ops_pldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_PLDO3_ON_VSEL,\n\t\t\tRK806_POWER_EN4, rk806_ldo_voltage_ranges, 3,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\n\tRK806_REGULATOR(\"pldo-reg4\", \"vcc12\", RK806_ID_PLDO4, rk806_ops_pldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_PLDO4_ON_VSEL,\n\t\t\tRK806_POWER_EN5, rk806_ldo_voltage_ranges, 0,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\tRK806_REGULATOR(\"pldo-reg5\", \"vcc12\", RK806_ID_PLDO5, rk806_ops_pldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_PLDO5_ON_VSEL,\n\t\t\tRK806_POWER_EN5, rk806_ldo_voltage_ranges, 1,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n\n\tRK806_REGULATOR(\"pldo-reg6\", \"vcca\", RK806_ID_PLDO6, rk806_ops_pldo,\n\t\t\tRK806_LDO_SEL_CNT, RK806_PLDO6_ON_VSEL,\n\t\t\tRK806_POWER_EN4, rk806_ldo_voltage_ranges, 0,\n\t\t\t0xEA, 0x38, rk806_ramp_delay_table_ldo),\n};\n\n\nstatic const struct regulator_desc rk808_reg[] = {\n\t{\n\t\t.name = \"DCDC_REG1\",\n\t\t.supply_name = \"vcc1\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG1\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK808_ID_DCDC1,\n\t\t.ops = &rk808_buck1_2_ops,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.min_uV = 712500,\n\t\t.uV_step = 12500,\n\t\t.n_voltages = 64,\n\t\t.vsel_reg = RK808_BUCK1_ON_VSEL_REG,\n\t\t.vsel_mask = RK808_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK808_DCDC_EN_REG,\n\t\t.enable_mask = BIT(0),\n\t\t.ramp_reg = RK808_BUCK1_CONFIG_REG,\n\t\t.ramp_mask = RK808_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk808_buck1_2_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk808_buck1_2_ramp_table),\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG2\",\n\t\t.supply_name = \"vcc2\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG2\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK808_ID_DCDC2,\n\t\t.ops = &rk808_buck1_2_ops,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.min_uV = 712500,\n\t\t.uV_step = 12500,\n\t\t.n_voltages = 64,\n\t\t.vsel_reg = RK808_BUCK2_ON_VSEL_REG,\n\t\t.vsel_mask = RK808_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK808_DCDC_EN_REG,\n\t\t.enable_mask = BIT(1),\n\t\t.ramp_reg = RK808_BUCK2_CONFIG_REG,\n\t\t.ramp_mask = RK808_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk808_buck1_2_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk808_buck1_2_ramp_table),\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG3\",\n\t\t.supply_name = \"vcc3\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG3\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK808_ID_DCDC3,\n\t\t.ops = &rk808_switch_ops,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = 1,\n\t\t.enable_reg = RK808_DCDC_EN_REG,\n\t\t.enable_mask = BIT(2),\n\t\t.owner = THIS_MODULE,\n\t},\n\tRK8XX_DESC(RK808_ID_DCDC4, \"DCDC_REG4\", \"vcc4\", 1800, 3300, 100,\n\t\tRK808_BUCK4_ON_VSEL_REG, RK808_BUCK4_VSEL_MASK,\n\t\tRK808_DCDC_EN_REG, BIT(3), 0),\n\tRK8XX_DESC(RK808_ID_LDO1, \"LDO_REG1\", \"vcc6\", 1800, 3400, 100,\n\t\tRK808_LDO1_ON_VSEL_REG, RK808_LDO_VSEL_MASK, RK808_LDO_EN_REG,\n\t\tBIT(0), 400),\n\tRK8XX_DESC(RK808_ID_LDO2, \"LDO_REG2\", \"vcc6\", 1800, 3400, 100,\n\t\tRK808_LDO2_ON_VSEL_REG, RK808_LDO_VSEL_MASK, RK808_LDO_EN_REG,\n\t\tBIT(1), 400),\n\t{\n\t\t.name = \"LDO_REG3\",\n\t\t.supply_name = \"vcc7\",\n\t\t.of_match = of_match_ptr(\"LDO_REG3\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK808_ID_LDO3,\n\t\t.ops = &rk808_reg_ops_ranges,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = 16,\n\t\t.linear_ranges = rk808_ldo3_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk808_ldo3_voltage_ranges),\n\t\t.vsel_reg = RK808_LDO3_ON_VSEL_REG,\n\t\t.vsel_mask = RK808_BUCK4_VSEL_MASK,\n\t\t.enable_reg = RK808_LDO_EN_REG,\n\t\t.enable_mask = BIT(2),\n\t\t.enable_time = 400,\n\t\t.owner = THIS_MODULE,\n\t},\n\tRK8XX_DESC(RK808_ID_LDO4, \"LDO_REG4\", \"vcc9\", 1800, 3400, 100,\n\t\tRK808_LDO4_ON_VSEL_REG, RK808_LDO_VSEL_MASK, RK808_LDO_EN_REG,\n\t\tBIT(3), 400),\n\tRK8XX_DESC(RK808_ID_LDO5, \"LDO_REG5\", \"vcc9\", 1800, 3400, 100,\n\t\tRK808_LDO5_ON_VSEL_REG, RK808_LDO_VSEL_MASK, RK808_LDO_EN_REG,\n\t\tBIT(4), 400),\n\tRK8XX_DESC(RK808_ID_LDO6, \"LDO_REG6\", \"vcc10\", 800, 2500, 100,\n\t\tRK808_LDO6_ON_VSEL_REG, RK808_LDO_VSEL_MASK, RK808_LDO_EN_REG,\n\t\tBIT(5), 400),\n\tRK8XX_DESC(RK808_ID_LDO7, \"LDO_REG7\", \"vcc7\", 800, 2500, 100,\n\t\tRK808_LDO7_ON_VSEL_REG, RK808_LDO_VSEL_MASK, RK808_LDO_EN_REG,\n\t\tBIT(6), 400),\n\tRK8XX_DESC(RK808_ID_LDO8, \"LDO_REG8\", \"vcc11\", 1800, 3400, 100,\n\t\tRK808_LDO8_ON_VSEL_REG, RK808_LDO_VSEL_MASK, RK808_LDO_EN_REG,\n\t\tBIT(7), 400),\n\tRK8XX_DESC_SWITCH(RK808_ID_SWITCH1, \"SWITCH_REG1\", \"vcc8\",\n\t\tRK808_DCDC_EN_REG, BIT(5)),\n\tRK8XX_DESC_SWITCH(RK808_ID_SWITCH2, \"SWITCH_REG2\", \"vcc12\",\n\t\tRK808_DCDC_EN_REG, BIT(6)),\n};\n\nstatic const struct regulator_desc rk809_reg[] = {\n\t{\n\t\t.name = \"DCDC_REG1\",\n\t\t.supply_name = \"vcc1\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG1\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC1,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK1_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck1_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck1_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK1_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC1),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC1),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC1),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC1),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG2\",\n\t\t.supply_name = \"vcc2\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG2\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC2,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK1_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck1_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck1_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK2_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC2),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC2),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC2),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC2),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG3\",\n\t\t.supply_name = \"vcc3\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG3\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC3,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK1_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck1_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck1_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK3_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC3),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC3),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC3),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC3),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG4\",\n\t\t.supply_name = \"vcc4\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG4\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC4,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK3_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck3_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck3_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK4_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC4),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC4),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC4),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC4),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t},\n\t{\n\t\t.name = \"DCDC_REG5\",\n\t\t.supply_name = \"vcc9\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG5\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK809_ID_DCDC5,\n\t\t.ops = &rk809_buck5_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK809_BUCK5_SEL_CNT,\n\t\t.linear_ranges = rk809_buck5_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk809_buck5_voltage_ranges),\n\t\t.vsel_reg = RK809_BUCK5_CONFIG(0),\n\t\t.vsel_mask = RK809_BUCK5_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(3),\n\t\t.enable_mask = ENABLE_MASK(1),\n\t\t.enable_val = ENABLE_MASK(1),\n\t\t.disable_val = DISABLE_VAL(1),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t},\n\tRK817_DESC(RK817_ID_LDO1, \"LDO_REG1\", \"vcc5\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(0), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(0),\n\t\t   DISABLE_VAL(0), 400),\n\tRK817_DESC(RK817_ID_LDO2, \"LDO_REG2\", \"vcc5\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(1), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(1),\n\t\t   DISABLE_VAL(1), 400),\n\tRK817_DESC(RK817_ID_LDO3, \"LDO_REG3\", \"vcc5\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(2), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(2),\n\t\t   DISABLE_VAL(2), 400),\n\tRK817_DESC(RK817_ID_LDO4, \"LDO_REG4\", \"vcc6\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(3), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(3),\n\t\t   DISABLE_VAL(3), 400),\n\tRK817_DESC(RK817_ID_LDO5, \"LDO_REG5\", \"vcc6\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(4), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(0),\n\t\t   DISABLE_VAL(0), 400),\n\tRK817_DESC(RK817_ID_LDO6, \"LDO_REG6\", \"vcc6\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(5), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(1),\n\t\t   DISABLE_VAL(1), 400),\n\tRK817_DESC(RK817_ID_LDO7, \"LDO_REG7\", \"vcc7\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(6), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(2),\n\t\t   DISABLE_VAL(2), 400),\n\tRK817_DESC(RK817_ID_LDO8, \"LDO_REG8\", \"vcc7\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(7), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(3),\n\t\t   DISABLE_VAL(3), 400),\n\tRK817_DESC(RK817_ID_LDO9, \"LDO_REG9\", \"vcc7\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(8), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(3), ENABLE_MASK(0),\n\t\t   DISABLE_VAL(0), 400),\n\tRK817_DESC_SWITCH(RK809_ID_SW1, \"SWITCH_REG1\", \"vcc9\",\n\t\t\t  RK817_POWER_EN_REG(3), ENABLE_MASK(2),\n\t\t\t  DISABLE_VAL(2)),\n\tRK817_DESC_SWITCH(RK809_ID_SW2, \"SWITCH_REG2\", \"vcc8\",\n\t\t\t  RK817_POWER_EN_REG(3), ENABLE_MASK(3),\n\t\t\t  DISABLE_VAL(3)),\n};\n\nstatic const struct regulator_desc rk817_reg[] = {\n\t{\n\t\t.name = \"DCDC_REG1\",\n\t\t.supply_name = \"vcc1\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG1\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC1,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK1_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck1_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck1_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK1_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC1),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC1),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC1),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC1),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG2\",\n\t\t.supply_name = \"vcc2\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG2\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC2,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK1_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck1_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck1_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK2_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC2),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC2),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC2),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC2),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG3\",\n\t\t.supply_name = \"vcc3\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG3\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC3,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK1_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck1_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck1_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK3_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC3),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC3),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC3),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC3),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG4\",\n\t\t.supply_name = \"vcc4\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG4\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK817_ID_DCDC4,\n\t\t.ops = &rk817_buck_ops_range,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = RK817_BUCK3_SEL_CNT + 1,\n\t\t.linear_ranges = rk817_buck3_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk817_buck3_voltage_ranges),\n\t\t.vsel_reg = RK817_BUCK4_ON_VSEL_REG,\n\t\t.vsel_mask = RK817_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK817_POWER_EN_REG(0),\n\t\t.enable_mask = ENABLE_MASK(RK817_ID_DCDC4),\n\t\t.enable_val = ENABLE_MASK(RK817_ID_DCDC4),\n\t\t.disable_val = DISABLE_VAL(RK817_ID_DCDC4),\n\t\t.ramp_reg = RK817_BUCK_CONFIG_REG(RK817_ID_DCDC4),\n\t\t.ramp_mask = RK817_RAMP_RATE_MASK,\n\t\t.ramp_delay_table = rk817_buck1_4_ramp_table,\n\t\t.n_ramp_values = ARRAY_SIZE(rk817_buck1_4_ramp_table),\n\t\t.of_map_mode = rk8xx_regulator_of_map_mode,\n\t\t.owner = THIS_MODULE,\n\t},\n\tRK817_DESC(RK817_ID_LDO1, \"LDO_REG1\", \"vcc5\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(0), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(0),\n\t\t   DISABLE_VAL(0), 400),\n\tRK817_DESC(RK817_ID_LDO2, \"LDO_REG2\", \"vcc5\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(1), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(1),\n\t\t   DISABLE_VAL(1), 400),\n\tRK817_DESC(RK817_ID_LDO3, \"LDO_REG3\", \"vcc5\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(2), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(2),\n\t\t   DISABLE_VAL(2), 400),\n\tRK817_DESC(RK817_ID_LDO4, \"LDO_REG4\", \"vcc6\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(3), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(1), ENABLE_MASK(3),\n\t\t   DISABLE_VAL(3), 400),\n\tRK817_DESC(RK817_ID_LDO5, \"LDO_REG5\", \"vcc6\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(4), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(0),\n\t\t   DISABLE_VAL(0), 400),\n\tRK817_DESC(RK817_ID_LDO6, \"LDO_REG6\", \"vcc6\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(5), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(1),\n\t\t   DISABLE_VAL(1), 400),\n\tRK817_DESC(RK817_ID_LDO7, \"LDO_REG7\", \"vcc7\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(6), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(2),\n\t\t   DISABLE_VAL(2), 400),\n\tRK817_DESC(RK817_ID_LDO8, \"LDO_REG8\", \"vcc7\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(7), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(2), ENABLE_MASK(3),\n\t\t   DISABLE_VAL(3), 400),\n\tRK817_DESC(RK817_ID_LDO9, \"LDO_REG9\", \"vcc7\", 600, 3400, 25,\n\t\t   RK817_LDO_ON_VSEL_REG(8), RK817_LDO_VSEL_MASK,\n\t\t   RK817_POWER_EN_REG(3), ENABLE_MASK(0),\n\t\t   DISABLE_VAL(0), 400),\n\tRK817_BOOST_DESC(RK817_ID_BOOST, \"BOOST\", \"vcc8\", 4700, 5400, 100,\n\t\t\t RK817_BOOST_OTG_CFG, RK817_BOOST_VSEL_MASK,\n\t\t\t RK817_POWER_EN_REG(3), ENABLE_MASK(1), ENABLE_MASK(1),\n\t\t   DISABLE_VAL(1), 400, 3500 - 5400),\n\tRK817_DESC_SWITCH(RK817_ID_BOOST_OTG_SW, \"OTG_SWITCH\", \"vcc9\",\n\t\t\t  RK817_POWER_EN_REG(3), ENABLE_MASK(2),\n\t\t\t  DISABLE_VAL(2)),\n};\n\nstatic const struct regulator_desc rk818_reg[] = {\n\t{\n\t\t.name = \"DCDC_REG1\",\n\t\t.supply_name = \"vcc1\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG1\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK818_ID_DCDC1,\n\t\t.ops = &rk808_reg_ops,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.min_uV = 712500,\n\t\t.uV_step = 12500,\n\t\t.n_voltages = 64,\n\t\t.vsel_reg = RK818_BUCK1_ON_VSEL_REG,\n\t\t.vsel_mask = RK818_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK818_DCDC_EN_REG,\n\t\t.enable_mask = BIT(0),\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG2\",\n\t\t.supply_name = \"vcc2\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG2\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK818_ID_DCDC2,\n\t\t.ops = &rk808_reg_ops,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.min_uV = 712500,\n\t\t.uV_step = 12500,\n\t\t.n_voltages = 64,\n\t\t.vsel_reg = RK818_BUCK2_ON_VSEL_REG,\n\t\t.vsel_mask = RK818_BUCK_VSEL_MASK,\n\t\t.enable_reg = RK818_DCDC_EN_REG,\n\t\t.enable_mask = BIT(1),\n\t\t.owner = THIS_MODULE,\n\t}, {\n\t\t.name = \"DCDC_REG3\",\n\t\t.supply_name = \"vcc3\",\n\t\t.of_match = of_match_ptr(\"DCDC_REG3\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK818_ID_DCDC3,\n\t\t.ops = &rk808_switch_ops,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = 1,\n\t\t.enable_reg = RK818_DCDC_EN_REG,\n\t\t.enable_mask = BIT(2),\n\t\t.owner = THIS_MODULE,\n\t},\n\tRK8XX_DESC(RK818_ID_DCDC4, \"DCDC_REG4\", \"vcc4\", 1800, 3600, 100,\n\t\tRK818_BUCK4_ON_VSEL_REG, RK818_BUCK4_VSEL_MASK,\n\t\tRK818_DCDC_EN_REG, BIT(3), 0),\n\tRK8XX_DESC(RK818_ID_BOOST, \"DCDC_BOOST\", \"boost\", 4700, 5400, 100,\n\t\tRK818_BOOST_LDO9_ON_VSEL_REG, RK818_BOOST_ON_VSEL_MASK,\n\t\tRK818_DCDC_EN_REG, BIT(4), 0),\n\tRK8XX_DESC(RK818_ID_LDO1, \"LDO_REG1\", \"vcc6\", 1800, 3400, 100,\n\t\tRK818_LDO1_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK818_LDO_EN_REG,\n\t\tBIT(0), 400),\n\tRK8XX_DESC(RK818_ID_LDO2, \"LDO_REG2\", \"vcc6\", 1800, 3400, 100,\n\t\tRK818_LDO2_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK818_LDO_EN_REG,\n\t\tBIT(1), 400),\n\t{\n\t\t.name = \"LDO_REG3\",\n\t\t.supply_name = \"vcc7\",\n\t\t.of_match = of_match_ptr(\"LDO_REG3\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id = RK818_ID_LDO3,\n\t\t.ops = &rk808_reg_ops_ranges,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.n_voltages = 16,\n\t\t.linear_ranges = rk808_ldo3_voltage_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rk808_ldo3_voltage_ranges),\n\t\t.vsel_reg = RK818_LDO3_ON_VSEL_REG,\n\t\t.vsel_mask = RK818_LDO3_ON_VSEL_MASK,\n\t\t.enable_reg = RK818_LDO_EN_REG,\n\t\t.enable_mask = BIT(2),\n\t\t.enable_time = 400,\n\t\t.owner = THIS_MODULE,\n\t},\n\tRK8XX_DESC(RK818_ID_LDO4, \"LDO_REG4\", \"vcc8\", 1800, 3400, 100,\n\t\tRK818_LDO4_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK818_LDO_EN_REG,\n\t\tBIT(3), 400),\n\tRK8XX_DESC(RK818_ID_LDO5, \"LDO_REG5\", \"vcc7\", 1800, 3400, 100,\n\t\tRK818_LDO5_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK818_LDO_EN_REG,\n\t\tBIT(4), 400),\n\tRK8XX_DESC(RK818_ID_LDO6, \"LDO_REG6\", \"vcc8\", 800, 2500, 100,\n\t\tRK818_LDO6_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK818_LDO_EN_REG,\n\t\tBIT(5), 400),\n\tRK8XX_DESC(RK818_ID_LDO7, \"LDO_REG7\", \"vcc7\", 800, 2500, 100,\n\t\tRK818_LDO7_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK818_LDO_EN_REG,\n\t\tBIT(6), 400),\n\tRK8XX_DESC(RK818_ID_LDO8, \"LDO_REG8\", \"vcc8\", 1800, 3400, 100,\n\t\tRK818_LDO8_ON_VSEL_REG, RK818_LDO_VSEL_MASK, RK818_LDO_EN_REG,\n\t\tBIT(7), 400),\n\tRK8XX_DESC(RK818_ID_LDO9, \"LDO_REG9\", \"vcc9\", 1800, 3400, 100,\n\t\tRK818_BOOST_LDO9_ON_VSEL_REG, RK818_LDO_VSEL_MASK,\n\t\tRK818_DCDC_EN_REG, BIT(5), 400),\n\tRK8XX_DESC_SWITCH(RK818_ID_SWITCH, \"SWITCH_REG\", \"vcc9\",\n\t\tRK818_DCDC_EN_REG, BIT(6)),\n\tRK8XX_DESC_SWITCH(RK818_ID_HDMI_SWITCH, \"HDMI_SWITCH\", \"h_5v\",\n\t\tRK818_H5V_EN_REG, BIT(0)),\n\tRK8XX_DESC_SWITCH(RK818_ID_OTG_SWITCH, \"OTG_SWITCH\", \"usb\",\n\t\tRK818_DCDC_EN_REG, BIT(7)),\n};\n\nstatic int rk808_regulator_dt_parse_pdata(struct device *dev,\n\t\t\t\t   struct regmap *map,\n\t\t\t\t   struct rk808_regulator_data *pdata)\n{\n\tstruct device_node *np;\n\tint tmp, ret = 0, i;\n\n\tnp = of_get_child_by_name(dev->of_node, \"regulators\");\n\tif (!np)\n\t\treturn -ENXIO;\n\n\tfor (i = 0; i < ARRAY_SIZE(pdata->dvs_gpio); i++) {\n\t\tpdata->dvs_gpio[i] =\n\t\t\tdevm_gpiod_get_index_optional(dev, \"dvs\", i,\n\t\t\t\t\t\t      GPIOD_OUT_LOW);\n\t\tif (IS_ERR(pdata->dvs_gpio[i])) {\n\t\t\tret = PTR_ERR(pdata->dvs_gpio[i]);\n\t\t\tdev_err(dev, \"failed to get dvs%d gpio (%d)\\n\", i, ret);\n\t\t\tgoto dt_parse_end;\n\t\t}\n\n\t\tif (!pdata->dvs_gpio[i]) {\n\t\t\tdev_info(dev, \"there is no dvs%d gpio\\n\", i);\n\t\t\tcontinue;\n\t\t}\n\n\t\ttmp = i ? RK808_DVS2_POL : RK808_DVS1_POL;\n\t\tret = regmap_update_bits(map, RK808_IO_POL_REG, tmp,\n\t\t\t\tgpiod_is_active_low(pdata->dvs_gpio[i]) ?\n\t\t\t\t0 : tmp);\n\t}\n\ndt_parse_end:\n\tof_node_put(np);\n\treturn ret;\n}\n\nstatic int rk808_regulator_probe(struct platform_device *pdev)\n{\n\tstruct rk808 *rk808 = dev_get_drvdata(pdev->dev.parent);\n\tstruct regulator_config config = {};\n\tstruct regulator_dev *rk808_rdev;\n\tstruct rk808_regulator_data *pdata;\n\tconst struct regulator_desc *regulators;\n\tstruct regmap *regmap;\n\tint ret, i, nregulators;\n\n\tpdev->dev.of_node = pdev->dev.parent->of_node;\n\tpdev->dev.of_node_reused = true;\n\n\tregmap = dev_get_regmap(pdev->dev.parent, NULL);\n\tif (!regmap)\n\t\treturn -ENODEV;\n\n\tpdata = devm_kzalloc(&pdev->dev, sizeof(*pdata), GFP_KERNEL);\n\tif (!pdata)\n\t\treturn -ENOMEM;\n\n\tret = rk808_regulator_dt_parse_pdata(&pdev->dev, regmap, pdata);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tplatform_set_drvdata(pdev, pdata);\n\n\tswitch (rk808->variant) {\n\tcase RK805_ID:\n\t\tregulators = rk805_reg;\n\t\tnregulators = RK805_NUM_REGULATORS;\n\t\tbreak;\n\tcase RK806_ID:\n\t\tregulators = rk806_reg;\n\t\tnregulators = ARRAY_SIZE(rk806_reg);\n\t\tbreak;\n\tcase RK808_ID:\n\t\tregulators = rk808_reg;\n\t\tnregulators = RK808_NUM_REGULATORS;\n\t\tbreak;\n\tcase RK809_ID:\n\t\tregulators = rk809_reg;\n\t\tnregulators = RK809_NUM_REGULATORS;\n\t\tbreak;\n\tcase RK817_ID:\n\t\tregulators = rk817_reg;\n\t\tnregulators = RK817_NUM_REGULATORS;\n\t\tbreak;\n\tcase RK818_ID:\n\t\tregulators = rk818_reg;\n\t\tnregulators = RK818_NUM_REGULATORS;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(&pdev->dev, \"unsupported RK8XX ID %lu\\n\",\n\t\t\trk808->variant);\n\t\treturn -EINVAL;\n\t}\n\n\tconfig.dev = &pdev->dev;\n\tconfig.driver_data = pdata;\n\tconfig.regmap = regmap;\n\n\t \n\tfor (i = 0; i < nregulators; i++) {\n\t\trk808_rdev = devm_regulator_register(&pdev->dev,\n\t\t\t\t\t\t     &regulators[i], &config);\n\t\tif (IS_ERR(rk808_rdev))\n\t\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(rk808_rdev),\n\t\t\t\t\t     \"failed to register %d regulator\\n\", i);\n\t}\n\n\treturn 0;\n}\n\nstatic struct platform_driver rk808_regulator_driver = {\n\t.probe = rk808_regulator_probe,\n\t.driver = {\n\t\t.name = \"rk808-regulator\",\n\t\t.probe_type = PROBE_FORCE_SYNCHRONOUS,\n\t},\n};\n\nmodule_platform_driver(rk808_regulator_driver);\n\nMODULE_DESCRIPTION(\"regulator driver for the RK805/RK808/RK818 series PMICs\");\nMODULE_AUTHOR(\"Tony xie <tony.xie@rock-chips.com>\");\nMODULE_AUTHOR(\"Chris Zhong <zyw@rock-chips.com>\");\nMODULE_AUTHOR(\"Zhang Qing <zhangqing@rock-chips.com>\");\nMODULE_AUTHOR(\"Wadim Egorov <w.egorov@phytec.de>\");\nMODULE_AUTHOR(\"Xu Shengfei <xsf@rock-chips.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:rk808-regulator\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}