{
  "module_name": "lp8788-ldo.c",
  "hash_id": "275c97bde09d1237b9ea052aedcd4a660d6971d7ac87dc63b34066e8ea3e2771",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/lp8788-ldo.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n#include <linux/gpio/consumer.h>\n#include <linux/mfd/lp8788.h>\n\n \n#define LP8788_EN_LDO_A\t\t\t0x0D\t \n#define LP8788_EN_LDO_B\t\t\t0x0E\t \n#define LP8788_EN_LDO_C\t\t\t0x0F\t \n#define LP8788_EN_SEL\t\t\t0x10\n#define LP8788_DLDO1_VOUT\t\t0x2E\n#define LP8788_DLDO2_VOUT\t\t0x2F\n#define LP8788_DLDO3_VOUT\t\t0x30\n#define LP8788_DLDO4_VOUT\t\t0x31\n#define LP8788_DLDO5_VOUT\t\t0x32\n#define LP8788_DLDO6_VOUT\t\t0x33\n#define LP8788_DLDO7_VOUT\t\t0x34\n#define LP8788_DLDO8_VOUT\t\t0x35\n#define LP8788_DLDO9_VOUT\t\t0x36\n#define LP8788_DLDO10_VOUT\t\t0x37\n#define LP8788_DLDO11_VOUT\t\t0x38\n#define LP8788_DLDO12_VOUT\t\t0x39\n#define LP8788_ALDO1_VOUT\t\t0x3A\n#define LP8788_ALDO2_VOUT\t\t0x3B\n#define LP8788_ALDO3_VOUT\t\t0x3C\n#define LP8788_ALDO4_VOUT\t\t0x3D\n#define LP8788_ALDO5_VOUT\t\t0x3E\n#define LP8788_ALDO6_VOUT\t\t0x3F\n#define LP8788_ALDO7_VOUT\t\t0x40\n#define LP8788_ALDO8_VOUT\t\t0x41\n#define LP8788_ALDO9_VOUT\t\t0x42\n#define LP8788_ALDO10_VOUT\t\t0x43\n#define LP8788_DLDO1_TIMESTEP\t\t0x44\n\n \n#define LP8788_EN_DLDO1_M\t\tBIT(0)\t \n#define LP8788_EN_DLDO2_M\t\tBIT(1)\n#define LP8788_EN_DLDO3_M\t\tBIT(2)\n#define LP8788_EN_DLDO4_M\t\tBIT(3)\n#define LP8788_EN_DLDO5_M\t\tBIT(4)\n#define LP8788_EN_DLDO6_M\t\tBIT(5)\n#define LP8788_EN_DLDO7_M\t\tBIT(6)\n#define LP8788_EN_DLDO8_M\t\tBIT(7)\n#define LP8788_EN_DLDO9_M\t\tBIT(0)\n#define LP8788_EN_DLDO10_M\t\tBIT(1)\n#define LP8788_EN_DLDO11_M\t\tBIT(2)\n#define LP8788_EN_DLDO12_M\t\tBIT(3)\n#define LP8788_EN_ALDO1_M\t\tBIT(4)\n#define LP8788_EN_ALDO2_M\t\tBIT(5)\n#define LP8788_EN_ALDO3_M\t\tBIT(6)\n#define LP8788_EN_ALDO4_M\t\tBIT(7)\n#define LP8788_EN_ALDO5_M\t\tBIT(0)\n#define LP8788_EN_ALDO6_M\t\tBIT(1)\n#define LP8788_EN_ALDO7_M\t\tBIT(2)\n#define LP8788_EN_ALDO8_M\t\tBIT(3)\n#define LP8788_EN_ALDO9_M\t\tBIT(4)\n#define LP8788_EN_ALDO10_M\t\tBIT(5)\n#define LP8788_EN_SEL_DLDO911_M\t\tBIT(0)\t \n#define LP8788_EN_SEL_DLDO7_M\t\tBIT(1)\n#define LP8788_EN_SEL_ALDO7_M\t\tBIT(2)\n#define LP8788_EN_SEL_ALDO5_M\t\tBIT(3)\n#define LP8788_EN_SEL_ALDO234_M\t\tBIT(4)\n#define LP8788_EN_SEL_ALDO1_M\t\tBIT(5)\n#define LP8788_VOUT_5BIT_M\t\t0x1F\t \n#define LP8788_VOUT_4BIT_M\t\t0x0F\n#define LP8788_VOUT_3BIT_M\t\t0x07\n#define LP8788_VOUT_1BIT_M\t\t0x01\n#define LP8788_STARTUP_TIME_M\t\t0xF8\t \n#define LP8788_STARTUP_TIME_S\t\t3\n\n#define ENABLE_TIME_USEC\t\t32\n\nenum lp8788_ldo_id {\n\tDLDO1,\n\tDLDO2,\n\tDLDO3,\n\tDLDO4,\n\tDLDO5,\n\tDLDO6,\n\tDLDO7,\n\tDLDO8,\n\tDLDO9,\n\tDLDO10,\n\tDLDO11,\n\tDLDO12,\n\tALDO1,\n\tALDO2,\n\tALDO3,\n\tALDO4,\n\tALDO5,\n\tALDO6,\n\tALDO7,\n\tALDO8,\n\tALDO9,\n\tALDO10,\n};\n\nstruct lp8788_ldo {\n\tstruct lp8788 *lp;\n\tstruct regulator_desc *desc;\n\tstruct regulator_dev *regulator;\n\tstruct gpio_desc *ena_gpiod;\n};\n\n \nstatic const int lp8788_dldo1239_vtbl[] = {\n\t1800000, 1900000, 2000000, 2100000, 2200000, 2300000, 2400000, 2500000,\n\t2600000, 2700000, 2800000, 2900000, 3000000, 2850000, 2850000, 2850000,\n\t2850000, 2850000, 2850000, 2850000, 2850000, 2850000, 2850000, 2850000,\n\t2850000, 2850000, 2850000, 2850000, 2850000, 2850000, 2850000, 2850000,\n};\n\n \nstatic const int lp8788_dldo4_vtbl[] = { 1800000, 3000000 };\n\n \nstatic const int lp8788_dldo578_aldo6_vtbl[] = {\n\t1800000, 1900000, 2000000, 2100000, 2200000, 2300000, 2400000, 2500000,\n\t2600000, 2700000, 2800000, 2900000, 3000000, 3000000, 3000000, 3000000,\n};\n\n \nstatic const int lp8788_dldo6_vtbl[] = {\n\t3000000, 3100000, 3200000, 3300000, 3400000, 3500000, 3600000, 3600000,\n};\n\n \nstatic const int lp8788_dldo1011_vtbl[] = {\n\t1100000, 1150000, 1200000, 1250000, 1300000, 1350000, 1400000, 1450000,\n\t1500000, 1500000, 1500000, 1500000, 1500000, 1500000, 1500000, 1500000,\n};\n\n \nstatic const int lp8788_aldo1_vtbl[] = { 1800000, 2850000 };\n\n \nstatic const int lp8788_aldo7_vtbl[] = {\n\t1200000, 1300000, 1400000, 1500000, 1600000, 1700000, 1800000, 1800000,\n};\n\nstatic int lp8788_ldo_enable_time(struct regulator_dev *rdev)\n{\n\tstruct lp8788_ldo *ldo = rdev_get_drvdata(rdev);\n\tenum lp8788_ldo_id id = rdev_get_id(rdev);\n\tu8 val, addr = LP8788_DLDO1_TIMESTEP + id;\n\n\tif (lp8788_read_byte(ldo->lp, addr, &val))\n\t\treturn -EINVAL;\n\n\tval = (val & LP8788_STARTUP_TIME_M) >> LP8788_STARTUP_TIME_S;\n\n\treturn ENABLE_TIME_USEC * val;\n}\n\nstatic const struct regulator_ops lp8788_ldo_voltage_table_ops = {\n\t.list_voltage = regulator_list_voltage_table,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.enable_time = lp8788_ldo_enable_time,\n};\n\nstatic const struct regulator_ops lp8788_ldo_voltage_fixed_ops = {\n\t.list_voltage = regulator_list_voltage_linear,\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.enable_time = lp8788_ldo_enable_time,\n};\n\nstatic const struct regulator_desc lp8788_dldo_desc[] = {\n\t{\n\t\t.name = \"dldo1\",\n\t\t.id = DLDO1,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo1239_vtbl),\n\t\t.volt_table = lp8788_dldo1239_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO1_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_5BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO1_M,\n\t},\n\t{\n\t\t.name = \"dldo2\",\n\t\t.id = DLDO2,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo1239_vtbl),\n\t\t.volt_table = lp8788_dldo1239_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO2_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_5BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO2_M,\n\t},\n\t{\n\t\t.name = \"dldo3\",\n\t\t.id = DLDO3,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo1239_vtbl),\n\t\t.volt_table = lp8788_dldo1239_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO3_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_5BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO3_M,\n\t},\n\t{\n\t\t.name = \"dldo4\",\n\t\t.id = DLDO4,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo4_vtbl),\n\t\t.volt_table = lp8788_dldo4_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO4_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_1BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO4_M,\n\t},\n\t{\n\t\t.name = \"dldo5\",\n\t\t.id = DLDO5,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo578_aldo6_vtbl),\n\t\t.volt_table = lp8788_dldo578_aldo6_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO5_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_4BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO5_M,\n\t},\n\t{\n\t\t.name = \"dldo6\",\n\t\t.id = DLDO6,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo6_vtbl),\n\t\t.volt_table = lp8788_dldo6_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO6_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_3BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO6_M,\n\t},\n\t{\n\t\t.name = \"dldo7\",\n\t\t.id = DLDO7,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo578_aldo6_vtbl),\n\t\t.volt_table = lp8788_dldo578_aldo6_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO7_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_4BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO7_M,\n\t},\n\t{\n\t\t.name = \"dldo8\",\n\t\t.id = DLDO8,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo578_aldo6_vtbl),\n\t\t.volt_table = lp8788_dldo578_aldo6_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO8_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_4BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_A,\n\t\t.enable_mask = LP8788_EN_DLDO8_M,\n\t},\n\t{\n\t\t.name = \"dldo9\",\n\t\t.id = DLDO9,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo1239_vtbl),\n\t\t.volt_table = lp8788_dldo1239_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO9_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_5BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_DLDO9_M,\n\t},\n\t{\n\t\t.name = \"dldo10\",\n\t\t.id = DLDO10,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo1011_vtbl),\n\t\t.volt_table = lp8788_dldo1011_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO10_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_4BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_DLDO10_M,\n\t},\n\t{\n\t\t.name = \"dldo11\",\n\t\t.id = DLDO11,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo1011_vtbl),\n\t\t.volt_table = lp8788_dldo1011_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_DLDO11_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_4BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_DLDO11_M,\n\t},\n\t{\n\t\t.name = \"dldo12\",\n\t\t.id = DLDO12,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_DLDO12_M,\n\t\t.min_uV = 2500000,\n\t},\n};\n\nstatic const struct regulator_desc lp8788_aldo_desc[] = {\n\t{\n\t\t.name = \"aldo1\",\n\t\t.id = ALDO1,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_aldo1_vtbl),\n\t\t.volt_table = lp8788_aldo1_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_ALDO1_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_1BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_ALDO1_M,\n\t},\n\t{\n\t\t.name = \"aldo2\",\n\t\t.id = ALDO2,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_ALDO2_M,\n\t\t.min_uV = 2850000,\n\t},\n\t{\n\t\t.name = \"aldo3\",\n\t\t.id = ALDO3,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_ALDO3_M,\n\t\t.min_uV = 2850000,\n\t},\n\t{\n\t\t.name = \"aldo4\",\n\t\t.id = ALDO4,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_B,\n\t\t.enable_mask = LP8788_EN_ALDO4_M,\n\t\t.min_uV = 2850000,\n\t},\n\t{\n\t\t.name = \"aldo5\",\n\t\t.id = ALDO5,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_C,\n\t\t.enable_mask = LP8788_EN_ALDO5_M,\n\t\t.min_uV = 2850000,\n\t},\n\t{\n\t\t.name = \"aldo6\",\n\t\t.id = ALDO6,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_dldo578_aldo6_vtbl),\n\t\t.volt_table = lp8788_dldo578_aldo6_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_ALDO6_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_4BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_C,\n\t\t.enable_mask = LP8788_EN_ALDO6_M,\n\t},\n\t{\n\t\t.name = \"aldo7\",\n\t\t.id = ALDO7,\n\t\t.ops = &lp8788_ldo_voltage_table_ops,\n\t\t.n_voltages = ARRAY_SIZE(lp8788_aldo7_vtbl),\n\t\t.volt_table = lp8788_aldo7_vtbl,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.vsel_reg = LP8788_ALDO7_VOUT,\n\t\t.vsel_mask = LP8788_VOUT_3BIT_M,\n\t\t.enable_reg = LP8788_EN_LDO_C,\n\t\t.enable_mask = LP8788_EN_ALDO7_M,\n\t},\n\t{\n\t\t.name = \"aldo8\",\n\t\t.id = ALDO8,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_C,\n\t\t.enable_mask = LP8788_EN_ALDO8_M,\n\t\t.min_uV = 2500000,\n\t},\n\t{\n\t\t.name = \"aldo9\",\n\t\t.id = ALDO9,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_C,\n\t\t.enable_mask = LP8788_EN_ALDO9_M,\n\t\t.min_uV = 2500000,\n\t},\n\t{\n\t\t.name = \"aldo10\",\n\t\t.id = ALDO10,\n\t\t.ops = &lp8788_ldo_voltage_fixed_ops,\n\t\t.n_voltages = 1,\n\t\t.type = REGULATOR_VOLTAGE,\n\t\t.owner = THIS_MODULE,\n\t\t.enable_reg = LP8788_EN_LDO_C,\n\t\t.enable_mask = LP8788_EN_ALDO10_M,\n\t\t.min_uV = 1100000,\n\t},\n};\n\nstatic int lp8788_config_ldo_enable_mode(struct platform_device *pdev,\n\t\t\t\t\tstruct lp8788_ldo *ldo,\n\t\t\t\t\tenum lp8788_ldo_id id)\n{\n\tstruct lp8788 *lp = ldo->lp;\n\tenum lp8788_ext_ldo_en_id enable_id;\n\tstatic const u8 en_mask[] = {\n\t\t[EN_ALDO1]   = LP8788_EN_SEL_ALDO1_M,\n\t\t[EN_ALDO234] = LP8788_EN_SEL_ALDO234_M,\n\t\t[EN_ALDO5]   = LP8788_EN_SEL_ALDO5_M,\n\t\t[EN_ALDO7]   = LP8788_EN_SEL_ALDO7_M,\n\t\t[EN_DLDO7]   = LP8788_EN_SEL_DLDO7_M,\n\t\t[EN_DLDO911] = LP8788_EN_SEL_DLDO911_M,\n\t};\n\n\tswitch (id) {\n\tcase DLDO7:\n\t\tenable_id = EN_DLDO7;\n\t\tbreak;\n\tcase DLDO9:\n\tcase DLDO11:\n\t\tenable_id = EN_DLDO911;\n\t\tbreak;\n\tcase ALDO1:\n\t\tenable_id = EN_ALDO1;\n\t\tbreak;\n\tcase ALDO2 ... ALDO4:\n\t\tenable_id = EN_ALDO234;\n\t\tbreak;\n\tcase ALDO5:\n\t\tenable_id = EN_ALDO5;\n\t\tbreak;\n\tcase ALDO7:\n\t\tenable_id = EN_ALDO7;\n\t\tbreak;\n\tdefault:\n\t\treturn 0;\n\t}\n\n\t \n\tldo->ena_gpiod = gpiod_get_index_optional(&pdev->dev,\n\t\t\t\t\t       \"enable\",\n\t\t\t\t\t       enable_id,\n\t\t\t\t\t       GPIOD_OUT_HIGH |\n\t\t\t\t\t       GPIOD_FLAGS_BIT_NONEXCLUSIVE);\n\tif (IS_ERR(ldo->ena_gpiod))\n\t\treturn PTR_ERR(ldo->ena_gpiod);\n\n\t \n\tif (!ldo->ena_gpiod)\n\t\tgoto set_default_ldo_enable_mode;\n\n\treturn 0;\n\nset_default_ldo_enable_mode:\n\treturn lp8788_update_bits(lp, LP8788_EN_SEL, en_mask[enable_id], 0);\n}\n\nstatic int lp8788_dldo_probe(struct platform_device *pdev)\n{\n\tstruct lp8788 *lp = dev_get_drvdata(pdev->dev.parent);\n\tint id = pdev->id;\n\tstruct lp8788_ldo *ldo;\n\tstruct regulator_config cfg = { };\n\tstruct regulator_dev *rdev;\n\tint ret;\n\n\tldo = devm_kzalloc(&pdev->dev, sizeof(struct lp8788_ldo), GFP_KERNEL);\n\tif (!ldo)\n\t\treturn -ENOMEM;\n\n\tldo->lp = lp;\n\tret = lp8788_config_ldo_enable_mode(pdev, ldo, id);\n\tif (ret)\n\t\treturn ret;\n\n\tif (ldo->ena_gpiod)\n\t\tcfg.ena_gpiod = ldo->ena_gpiod;\n\n\tcfg.dev = pdev->dev.parent;\n\tcfg.init_data = lp->pdata ? lp->pdata->dldo_data[id] : NULL;\n\tcfg.driver_data = ldo;\n\tcfg.regmap = lp->regmap;\n\n\trdev = devm_regulator_register(&pdev->dev, &lp8788_dldo_desc[id], &cfg);\n\tif (IS_ERR(rdev)) {\n\t\tret = PTR_ERR(rdev);\n\t\tdev_err(&pdev->dev, \"DLDO%d regulator register err = %d\\n\",\n\t\t\t\tid + 1, ret);\n\t\treturn ret;\n\t}\n\n\tldo->regulator = rdev;\n\tplatform_set_drvdata(pdev, ldo);\n\n\treturn 0;\n}\n\nstatic struct platform_driver lp8788_dldo_driver = {\n\t.probe = lp8788_dldo_probe,\n\t.driver = {\n\t\t.name = LP8788_DEV_DLDO,\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n};\n\nstatic int lp8788_aldo_probe(struct platform_device *pdev)\n{\n\tstruct lp8788 *lp = dev_get_drvdata(pdev->dev.parent);\n\tint id = pdev->id;\n\tstruct lp8788_ldo *ldo;\n\tstruct regulator_config cfg = { };\n\tstruct regulator_dev *rdev;\n\tint ret;\n\n\tldo = devm_kzalloc(&pdev->dev, sizeof(struct lp8788_ldo), GFP_KERNEL);\n\tif (!ldo)\n\t\treturn -ENOMEM;\n\n\tldo->lp = lp;\n\tret = lp8788_config_ldo_enable_mode(pdev, ldo, id + ALDO1);\n\tif (ret)\n\t\treturn ret;\n\n\tif (ldo->ena_gpiod)\n\t\tcfg.ena_gpiod = ldo->ena_gpiod;\n\n\tcfg.dev = pdev->dev.parent;\n\tcfg.init_data = lp->pdata ? lp->pdata->aldo_data[id] : NULL;\n\tcfg.driver_data = ldo;\n\tcfg.regmap = lp->regmap;\n\n\trdev = devm_regulator_register(&pdev->dev, &lp8788_aldo_desc[id], &cfg);\n\tif (IS_ERR(rdev)) {\n\t\tret = PTR_ERR(rdev);\n\t\tdev_err(&pdev->dev, \"ALDO%d regulator register err = %d\\n\",\n\t\t\t\tid + 1, ret);\n\t\treturn ret;\n\t}\n\n\tldo->regulator = rdev;\n\tplatform_set_drvdata(pdev, ldo);\n\n\treturn 0;\n}\n\nstatic struct platform_driver lp8788_aldo_driver = {\n\t.probe = lp8788_aldo_probe,\n\t.driver = {\n\t\t.name = LP8788_DEV_ALDO,\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n};\n\nstatic struct platform_driver * const drivers[] = {\n\t&lp8788_dldo_driver,\n\t&lp8788_aldo_driver,\n};\n\nstatic int __init lp8788_ldo_init(void)\n{\n\treturn platform_register_drivers(drivers, ARRAY_SIZE(drivers));\n}\nsubsys_initcall(lp8788_ldo_init);\n\nstatic void __exit lp8788_ldo_exit(void)\n{\n\tplatform_unregister_drivers(drivers, ARRAY_SIZE(drivers));\n}\nmodule_exit(lp8788_ldo_exit);\n\nMODULE_DESCRIPTION(\"TI LP8788 LDO Driver\");\nMODULE_AUTHOR(\"Milo Kim\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:lp8788-dldo\");\nMODULE_ALIAS(\"platform:lp8788-aldo\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}