{
  "module_name": "sc2731-regulator.c",
  "hash_id": "4ec77ed501f1be29f47d5fdd66ad05b7df2217879b1f85910cd2f2faf2eabab2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/sc2731-regulator.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/of_regulator.h>\n\n \n#define SC2731_PWR_WR_PROT\t\t0xf0c\n#define SC2731_WR_UNLOCK_VALUE\t\t0x6e7f\n\n \n#define SC2731_POWER_PD_SW\t\t0xc28\n#define SC2731_LDO_CAMA0_PD\t\t0xcfc\n#define SC2731_LDO_CAMA1_PD\t\t0xd04\n#define SC2731_LDO_CAMMOT_PD\t\t0xd0c\n#define SC2731_LDO_VLDO_PD\t\t0xd6c\n#define SC2731_LDO_EMMCCORE_PD\t\t0xd2c\n#define SC2731_LDO_SDCORE_PD\t\t0xd74\n#define SC2731_LDO_SDIO_PD\t\t0xd70\n#define SC2731_LDO_WIFIPA_PD\t\t0xd4c\n#define SC2731_LDO_USB33_PD\t\t0xd5c\n#define SC2731_LDO_CAMD0_PD\t\t0xd7c\n#define SC2731_LDO_CAMD1_PD\t\t0xd84\n#define SC2731_LDO_CON_PD\t\t0xd8c\n#define SC2731_LDO_CAMIO_PD\t\t0xd94\n#define SC2731_LDO_SRAM_PD\t\t0xd78\n\n \n#define SC2731_DCDC_CPU0_PD_MASK\tBIT(4)\n#define SC2731_DCDC_CPU1_PD_MASK\tBIT(3)\n#define SC2731_DCDC_RF_PD_MASK\t\tBIT(11)\n#define SC2731_LDO_CAMA0_PD_MASK\tBIT(0)\n#define SC2731_LDO_CAMA1_PD_MASK\tBIT(0)\n#define SC2731_LDO_CAMMOT_PD_MASK\tBIT(0)\n#define SC2731_LDO_VLDO_PD_MASK\t\tBIT(0)\n#define SC2731_LDO_EMMCCORE_PD_MASK\tBIT(0)\n#define SC2731_LDO_SDCORE_PD_MASK\tBIT(0)\n#define SC2731_LDO_SDIO_PD_MASK\t\tBIT(0)\n#define SC2731_LDO_WIFIPA_PD_MASK\tBIT(0)\n#define SC2731_LDO_USB33_PD_MASK\tBIT(0)\n#define SC2731_LDO_CAMD0_PD_MASK\tBIT(0)\n#define SC2731_LDO_CAMD1_PD_MASK\tBIT(0)\n#define SC2731_LDO_CON_PD_MASK\t\tBIT(0)\n#define SC2731_LDO_CAMIO_PD_MASK\tBIT(0)\n#define SC2731_LDO_SRAM_PD_MASK\t\tBIT(0)\n\n \n#define SC2731_DCDC_CPU0_VOL\t\t0xc54\n#define SC2731_DCDC_CPU1_VOL\t\t0xc64\n#define SC2731_DCDC_RF_VOL\t\t0xcb8\n#define SC2731_LDO_CAMA0_VOL\t\t0xd00\n#define SC2731_LDO_CAMA1_VOL\t\t0xd08\n#define SC2731_LDO_CAMMOT_VOL\t\t0xd10\n#define SC2731_LDO_VLDO_VOL\t\t0xd28\n#define SC2731_LDO_EMMCCORE_VOL\t\t0xd30\n#define SC2731_LDO_SDCORE_VOL\t\t0xd38\n#define SC2731_LDO_SDIO_VOL\t\t0xd40\n#define SC2731_LDO_WIFIPA_VOL\t\t0xd50\n#define SC2731_LDO_USB33_VOL\t\t0xd60\n#define SC2731_LDO_CAMD0_VOL\t\t0xd80\n#define SC2731_LDO_CAMD1_VOL\t\t0xd88\n#define SC2731_LDO_CON_VOL\t\t0xd90\n#define SC2731_LDO_CAMIO_VOL\t\t0xd98\n#define SC2731_LDO_SRAM_VOL\t\t0xdB0\n\n \n#define SC2731_DCDC_CPU0_VOL_MASK\tGENMASK(8, 0)\n#define SC2731_DCDC_CPU1_VOL_MASK\tGENMASK(8, 0)\n#define SC2731_DCDC_RF_VOL_MASK\t\tGENMASK(8, 0)\n#define SC2731_LDO_CAMA0_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_CAMA1_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_CAMMOT_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_VLDO_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_EMMCCORE_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_SDCORE_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_SDIO_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_WIFIPA_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_USB33_VOL_MASK\tGENMASK(7, 0)\n#define SC2731_LDO_CAMD0_VOL_MASK\tGENMASK(6, 0)\n#define SC2731_LDO_CAMD1_VOL_MASK\tGENMASK(6, 0)\n#define SC2731_LDO_CON_VOL_MASK\t\tGENMASK(6, 0)\n#define SC2731_LDO_CAMIO_VOL_MASK\tGENMASK(6, 0)\n#define SC2731_LDO_SRAM_VOL_MASK\tGENMASK(6, 0)\n\nenum sc2731_regulator_id {\n\tSC2731_BUCK_CPU0,\n\tSC2731_BUCK_CPU1,\n\tSC2731_BUCK_RF,\n\tSC2731_LDO_CAMA0,\n\tSC2731_LDO_CAMA1,\n\tSC2731_LDO_CAMMOT,\n\tSC2731_LDO_VLDO,\n\tSC2731_LDO_EMMCCORE,\n\tSC2731_LDO_SDCORE,\n\tSC2731_LDO_SDIO,\n\tSC2731_LDO_WIFIPA,\n\tSC2731_LDO_USB33,\n\tSC2731_LDO_CAMD0,\n\tSC2731_LDO_CAMD1,\n\tSC2731_LDO_CON,\n\tSC2731_LDO_CAMIO,\n\tSC2731_LDO_SRAM,\n};\n\nstatic const struct regulator_ops sc2731_regu_linear_ops = {\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.list_voltage = regulator_list_voltage_linear,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n};\n\n#define SC2731_REGU_LINEAR(_id, en_reg, en_mask, vreg, vmask,\t\\\n\t\t\t  vstep, vmin, vmax) {\t\t\t\\\n\t.name\t\t\t= #_id,\t\t\t\t\\\n\t.of_match\t\t= of_match_ptr(#_id),\t\t\\\n\t.ops\t\t\t= &sc2731_regu_linear_ops,\t\\\n\t.type\t\t\t= REGULATOR_VOLTAGE,\t\t\\\n\t.id\t\t\t= SC2731_##_id,\t\t\t\\\n\t.owner\t\t\t= THIS_MODULE,\t\t\t\\\n\t.min_uV\t\t\t= vmin,\t\t\t\t\\\n\t.n_voltages\t\t= ((vmax) - (vmin)) / (vstep) + 1,\t\\\n\t.uV_step\t\t= vstep,\t\t\t\\\n\t.enable_is_inverted\t= true,\t\t\t\t\\\n\t.enable_val\t\t= 0,\t\t\t\t\\\n\t.enable_reg\t\t= en_reg,\t\t\t\\\n\t.enable_mask\t\t= en_mask,\t\t\t\\\n\t.vsel_reg\t\t= vreg,\t\t\t\t\\\n\t.vsel_mask\t\t= vmask,\t\t\t\\\n}\n\nstatic const struct regulator_desc regulators[] = {\n\tSC2731_REGU_LINEAR(BUCK_CPU0, SC2731_POWER_PD_SW,\n\t\t\t   SC2731_DCDC_CPU0_PD_MASK, SC2731_DCDC_CPU0_VOL,\n\t\t\t   SC2731_DCDC_CPU0_VOL_MASK, 3125, 400000, 1996875),\n\tSC2731_REGU_LINEAR(BUCK_CPU1, SC2731_POWER_PD_SW,\n\t\t\t   SC2731_DCDC_CPU1_PD_MASK, SC2731_DCDC_CPU1_VOL,\n\t\t\t   SC2731_DCDC_CPU1_VOL_MASK, 3125, 400000, 1996875),\n\tSC2731_REGU_LINEAR(BUCK_RF, SC2731_POWER_PD_SW, SC2731_DCDC_RF_PD_MASK,\n\t\t\t   SC2731_DCDC_RF_VOL, SC2731_DCDC_RF_VOL_MASK,\n\t\t\t   3125, 600000, 2196875),\n\tSC2731_REGU_LINEAR(LDO_CAMA0, SC2731_LDO_CAMA0_PD,\n\t\t\t   SC2731_LDO_CAMA0_PD_MASK, SC2731_LDO_CAMA0_VOL,\n\t\t\t   SC2731_LDO_CAMA0_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_CAMA1, SC2731_LDO_CAMA1_PD,\n\t\t\t   SC2731_LDO_CAMA1_PD_MASK, SC2731_LDO_CAMA1_VOL,\n\t\t\t   SC2731_LDO_CAMA1_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_CAMMOT, SC2731_LDO_CAMMOT_PD,\n\t\t\t   SC2731_LDO_CAMMOT_PD_MASK, SC2731_LDO_CAMMOT_VOL,\n\t\t\t   SC2731_LDO_CAMMOT_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_VLDO, SC2731_LDO_VLDO_PD,\n\t\t\t   SC2731_LDO_VLDO_PD_MASK, SC2731_LDO_VLDO_VOL,\n\t\t\t   SC2731_LDO_VLDO_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_EMMCCORE, SC2731_LDO_EMMCCORE_PD,\n\t\t\t   SC2731_LDO_EMMCCORE_PD_MASK, SC2731_LDO_EMMCCORE_VOL,\n\t\t\t   SC2731_LDO_EMMCCORE_VOL_MASK, 10000, 1200000,\n\t\t\t   3750000),\n\tSC2731_REGU_LINEAR(LDO_SDCORE, SC2731_LDO_SDCORE_PD,\n\t\t\t   SC2731_LDO_SDCORE_PD_MASK, SC2731_LDO_SDCORE_VOL,\n\t\t\t   SC2731_LDO_SDCORE_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_SDIO, SC2731_LDO_SDIO_PD,\n\t\t\t   SC2731_LDO_SDIO_PD_MASK, SC2731_LDO_SDIO_VOL,\n\t\t\t   SC2731_LDO_SDIO_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_WIFIPA, SC2731_LDO_WIFIPA_PD,\n\t\t\t   SC2731_LDO_WIFIPA_PD_MASK, SC2731_LDO_WIFIPA_VOL,\n\t\t\t   SC2731_LDO_WIFIPA_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_USB33, SC2731_LDO_USB33_PD,\n\t\t\t   SC2731_LDO_USB33_PD_MASK, SC2731_LDO_USB33_VOL,\n\t\t\t   SC2731_LDO_USB33_VOL_MASK, 10000, 1200000, 3750000),\n\tSC2731_REGU_LINEAR(LDO_CAMD0, SC2731_LDO_CAMD0_PD,\n\t\t\t   SC2731_LDO_CAMD0_PD_MASK, SC2731_LDO_CAMD0_VOL,\n\t\t\t   SC2731_LDO_CAMD0_VOL_MASK, 6250, 1000000, 1793750),\n\tSC2731_REGU_LINEAR(LDO_CAMD1, SC2731_LDO_CAMD1_PD,\n\t\t\t   SC2731_LDO_CAMD1_PD_MASK, SC2731_LDO_CAMD1_VOL,\n\t\t\t   SC2731_LDO_CAMD1_VOL_MASK, 6250, 1000000, 1793750),\n\tSC2731_REGU_LINEAR(LDO_CON, SC2731_LDO_CON_PD,\n\t\t\t   SC2731_LDO_CON_PD_MASK, SC2731_LDO_CON_VOL,\n\t\t\t   SC2731_LDO_CON_VOL_MASK, 6250, 1000000, 1793750),\n\tSC2731_REGU_LINEAR(LDO_CAMIO, SC2731_LDO_CAMIO_PD,\n\t\t\t   SC2731_LDO_CAMIO_PD_MASK, SC2731_LDO_CAMIO_VOL,\n\t\t\t   SC2731_LDO_CAMIO_VOL_MASK, 6250, 1000000, 1793750),\n\tSC2731_REGU_LINEAR(LDO_SRAM, SC2731_LDO_SRAM_PD,\n\t\t\t   SC2731_LDO_SRAM_PD_MASK, SC2731_LDO_SRAM_VOL,\n\t\t\t   SC2731_LDO_SRAM_VOL_MASK, 6250, 1000000, 1793750),\n};\n\nstatic int sc2731_regulator_unlock(struct regmap *regmap)\n{\n\treturn regmap_write(regmap, SC2731_PWR_WR_PROT,\n\t\t\t    SC2731_WR_UNLOCK_VALUE);\n}\n\nstatic int sc2731_regulator_probe(struct platform_device *pdev)\n{\n\tint i, ret;\n\tstruct regmap *regmap;\n\tstruct regulator_config config = { };\n\tstruct regulator_dev *rdev;\n\n\tregmap = dev_get_regmap(pdev->dev.parent, NULL);\n\tif (!regmap) {\n\t\tdev_err(&pdev->dev, \"failed to get regmap.\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tret = sc2731_regulator_unlock(regmap);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"failed to release regulator lock\\n\");\n\t\treturn ret;\n\t}\n\n\tconfig.dev = &pdev->dev;\n\tconfig.regmap = regmap;\n\n\tfor (i = 0; i < ARRAY_SIZE(regulators); i++) {\n\t\trdev = devm_regulator_register(&pdev->dev, &regulators[i],\n\t\t\t\t\t       &config);\n\t\tif (IS_ERR(rdev)) {\n\t\t\tdev_err(&pdev->dev, \"failed to register regulator %s\\n\",\n\t\t\t\tregulators[i].name);\n\t\t\treturn PTR_ERR(rdev);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic struct platform_driver sc2731_regulator_driver = {\n\t.driver = {\n\t\t.name = \"sc27xx-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = sc2731_regulator_probe,\n};\n\nmodule_platform_driver(sc2731_regulator_driver);\n\nMODULE_AUTHOR(\"Chen Junhui <erick.chen@spreadtrum.com>\");\nMODULE_DESCRIPTION(\"Spreadtrum SC2731 regulator driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}