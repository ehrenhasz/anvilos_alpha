{
  "module_name": "hi6421-regulator.c",
  "hash_id": "4a3077ea9ca8332fbd15a6ee53d32b20e30e1e1b3ecf81c8c80a43ab38a63590",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/hi6421-regulator.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n\n#include <linux/slab.h>\n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/err.h>\n#include <linux/platform_device.h>\n#include <linux/of.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/of_regulator.h>\n#include <linux/mfd/hi6421-pmic.h>\n\n \nstruct hi6421_regulator_pdata {\n\tstruct mutex lock;\n};\n\n \nstruct hi6421_regulator_info {\n\tstruct regulator_desc\tdesc;\n\tu8\t\tmode_mask;\n\tu32\t\teco_microamp;\n};\n\n \nenum hi6421_regulator_id {\n\tHI6421_LDO0,\n\tHI6421_LDO1,\n\tHI6421_LDO2,\n\tHI6421_LDO3,\n\tHI6421_LDO4,\n\tHI6421_LDO5,\n\tHI6421_LDO6,\n\tHI6421_LDO7,\n\tHI6421_LDO8,\n\tHI6421_LDO9,\n\tHI6421_LDO10,\n\tHI6421_LDO11,\n\tHI6421_LDO12,\n\tHI6421_LDO13,\n\tHI6421_LDO14,\n\tHI6421_LDO15,\n\tHI6421_LDO16,\n\tHI6421_LDO17,\n\tHI6421_LDO18,\n\tHI6421_LDO19,\n\tHI6421_LDO20,\n\tHI6421_LDOAUDIO,\n\tHI6421_BUCK0,\n\tHI6421_BUCK1,\n\tHI6421_BUCK2,\n\tHI6421_BUCK3,\n\tHI6421_BUCK4,\n\tHI6421_BUCK5,\n\tHI6421_NUM_REGULATORS,\n};\n\n \nstatic const unsigned int ldo_0_voltages[] = {\n\t1500000, 1800000, 2400000, 2500000,\n\t2600000, 2700000, 2850000, 3000000,\n};\n\n \nstatic const unsigned int ldo_8_voltages[] = {\n\t1500000, 1800000, 2400000, 2600000,\n\t2700000, 2850000, 3000000, 3300000,\n};\n\n \nstatic const struct linear_range ldo_audio_volt_range[] = {\n\tREGULATOR_LINEAR_RANGE(2800000, 0, 3, 50000),\n\tREGULATOR_LINEAR_RANGE(3000000, 4, 7, 100000),\n};\n\nstatic const unsigned int buck_3_voltages[] = {\n\t 950000, 1050000, 1100000, 1117000,\n\t1134000, 1150000, 1167000, 1200000,\n};\n\nstatic const unsigned int buck_4_voltages[] = {\n\t1150000, 1200000, 1250000, 1350000,\n\t1700000, 1800000, 1900000, 2000000,\n};\n\nstatic const unsigned int buck_5_voltages[] = {\n\t1150000, 1200000, 1250000, 1350000,\n\t1600000, 1700000, 1800000, 1900000,\n};\n\nstatic const struct regulator_ops hi6421_ldo_ops;\nstatic const struct regulator_ops hi6421_ldo_linear_ops;\nstatic const struct regulator_ops hi6421_ldo_linear_range_ops;\nstatic const struct regulator_ops hi6421_buck012_ops;\nstatic const struct regulator_ops hi6421_buck345_ops;\n\n#define HI6421_LDO_ENABLE_TIME (350)\n \n#define HI6421_LDO(_id, _match, v_table, vreg, vmask, ereg, emask,\t\\\n\t\t   odelay, ecomask, ecoamp)\t\t\t\t\\\n\t[HI6421_##_id] = {\t\t\t\t\t\t\\\n\t\t.desc = {\t\t\t\t\t\t\\\n\t\t\t.name\t\t= #_id,\t\t\t\t\\\n\t\t\t.of_match        = #_match,\t\t\t\\\n\t\t\t.regulators_node = \"regulators\",\t\t\\\n\t\t\t.ops\t\t= &hi6421_ldo_ops,\t\t\\\n\t\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\\\n\t\t\t.id\t\t= HI6421_##_id,\t\t\t\\\n\t\t\t.owner\t\t= THIS_MODULE,\t\t\t\\\n\t\t\t.n_voltages\t= ARRAY_SIZE(v_table),\t\t\\\n\t\t\t.volt_table\t= v_table,\t\t\t\\\n\t\t\t.vsel_reg\t= HI6421_REG_TO_BUS_ADDR(vreg),\t\\\n\t\t\t.vsel_mask\t= vmask,\t\t\t\\\n\t\t\t.enable_reg\t= HI6421_REG_TO_BUS_ADDR(ereg),\t\\\n\t\t\t.enable_mask\t= emask,\t\t\t\\\n\t\t\t.enable_time\t= HI6421_LDO_ENABLE_TIME,\t\\\n\t\t\t.off_on_delay\t= odelay,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.mode_mask\t\t= ecomask,\t\t\t\\\n\t\t.eco_microamp\t\t= ecoamp,\t\t\t\\\n\t}\n\n \n#define HI6421_LDO_LINEAR(_id, _match, _min_uV, n_volt, vstep, vreg, vmask,\\\n\t\t\t  ereg, emask, odelay, ecomask, ecoamp)\t\t\\\n\t[HI6421_##_id] = {\t\t\t\t\t\t\\\n\t\t.desc = {\t\t\t\t\t\t\\\n\t\t\t.name\t\t= #_id,\t\t\t\t\\\n\t\t\t.of_match        = #_match,\t\t\t\\\n\t\t\t.regulators_node = \"regulators\",\t\t\\\n\t\t\t.ops\t\t= &hi6421_ldo_linear_ops,\t\\\n\t\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\\\n\t\t\t.id\t\t= HI6421_##_id,\t\t\t\\\n\t\t\t.owner\t\t= THIS_MODULE,\t\t\t\\\n\t\t\t.min_uV\t\t= _min_uV,\t\t\t\\\n\t\t\t.n_voltages\t= n_volt,\t\t\t\\\n\t\t\t.uV_step\t= vstep,\t\t\t\\\n\t\t\t.vsel_reg\t= HI6421_REG_TO_BUS_ADDR(vreg),\t\\\n\t\t\t.vsel_mask\t= vmask,\t\t\t\\\n\t\t\t.enable_reg\t= HI6421_REG_TO_BUS_ADDR(ereg),\t\\\n\t\t\t.enable_mask\t= emask,\t\t\t\\\n\t\t\t.enable_time\t= HI6421_LDO_ENABLE_TIME,\t\\\n\t\t\t.off_on_delay\t= odelay,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.mode_mask\t\t= ecomask,\t\t\t\\\n\t\t.eco_microamp\t\t= ecoamp,\t\t\t\\\n\t}\n\n \n#define HI6421_LDO_LINEAR_RANGE(_id, _match, n_volt, volt_ranges, vreg, vmask,\\\n\t\t\t\tereg, emask, odelay, ecomask, ecoamp)\t\\\n\t[HI6421_##_id] = {\t\t\t\t\t\t\\\n\t\t.desc = {\t\t\t\t\t\t\\\n\t\t\t.name\t\t= #_id,\t\t\t\t\\\n\t\t\t.of_match        = #_match,\t\t\t\\\n\t\t\t.regulators_node = \"regulators\",\t\t\\\n\t\t\t.ops\t\t= &hi6421_ldo_linear_range_ops,\t\\\n\t\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\\\n\t\t\t.id\t\t= HI6421_##_id,\t\t\t\\\n\t\t\t.owner\t\t= THIS_MODULE,\t\t\t\\\n\t\t\t.n_voltages\t= n_volt,\t\t\t\\\n\t\t\t.linear_ranges\t= volt_ranges,\t\t\t\\\n\t\t\t.n_linear_ranges = ARRAY_SIZE(volt_ranges),\t\\\n\t\t\t.vsel_reg\t= HI6421_REG_TO_BUS_ADDR(vreg),\t\\\n\t\t\t.vsel_mask\t= vmask,\t\t\t\\\n\t\t\t.enable_reg\t= HI6421_REG_TO_BUS_ADDR(ereg),\t\\\n\t\t\t.enable_mask\t= emask,\t\t\t\\\n\t\t\t.enable_time\t= HI6421_LDO_ENABLE_TIME,\t\\\n\t\t\t.off_on_delay\t= odelay,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.mode_mask\t\t= ecomask,\t\t\t\\\n\t\t.eco_microamp\t\t= ecoamp,\t\t\t\\\n\t}\n\n \n#define HI6421_BUCK012(_id, _match, vreg, vmask, ereg, emask, sleepmask,\\\n\t\t\tetime, odelay)\t\t\t\t\t\\\n\t[HI6421_##_id] = {\t\t\t\t\t\t\\\n\t\t.desc = {\t\t\t\t\t\t\\\n\t\t\t.name\t\t= #_id,\t\t\t\t\\\n\t\t\t.of_match        = #_match,\t\t\t\\\n\t\t\t.regulators_node = \"regulators\",\t\t\\\n\t\t\t.ops\t\t= &hi6421_buck012_ops,\t\t\\\n\t\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\\\n\t\t\t.id\t\t= HI6421_##_id,\t\t\t\\\n\t\t\t.owner\t\t= THIS_MODULE,\t\t\t\\\n\t\t\t.min_uV\t\t= 700000,\t\t\t\\\n\t\t\t.n_voltages\t= 128,\t\t\t\t\\\n\t\t\t.uV_step\t= 7086,\t\t\t\t\\\n\t\t\t.vsel_reg\t= HI6421_REG_TO_BUS_ADDR(vreg),\t\\\n\t\t\t.vsel_mask\t= vmask,\t\t\t\\\n\t\t\t.enable_reg\t= HI6421_REG_TO_BUS_ADDR(ereg),\t\\\n\t\t\t.enable_mask\t= emask,\t\t\t\\\n\t\t\t.enable_time\t= etime,\t\t\t\\\n\t\t\t.off_on_delay\t= odelay,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.mode_mask\t\t= sleepmask,\t\t\t\\\n\t}\n\n \n#define HI6421_BUCK345(_id, _match, v_table, vreg, vmask, ereg, emask,\t\\\n\t\t\todelay, sleepmask)\t\t\t\t\\\n\t[HI6421_##_id] = {\t\t\t\t\t\t\\\n\t\t.desc = {\t\t\t\t\t\t\\\n\t\t\t.name\t\t= #_id,\t\t\t\t\\\n\t\t\t.of_match        = #_match,\t\t\t\\\n\t\t\t.regulators_node = \"regulators\",\t\t\\\n\t\t\t.ops\t\t= &hi6421_buck345_ops,\t\t\\\n\t\t\t.type\t\t= REGULATOR_VOLTAGE,\t\t\\\n\t\t\t.id\t\t= HI6421_##_id,\t\t\t\\\n\t\t\t.owner\t\t= THIS_MODULE,\t\t\t\\\n\t\t\t.n_voltages\t= ARRAY_SIZE(v_table),\t\t\\\n\t\t\t.volt_table\t= v_table,\t\t\t\\\n\t\t\t.vsel_reg\t= HI6421_REG_TO_BUS_ADDR(vreg),\t\\\n\t\t\t.vsel_mask\t= vmask,\t\t\t\\\n\t\t\t.enable_reg\t= HI6421_REG_TO_BUS_ADDR(ereg),\t\\\n\t\t\t.enable_mask\t= emask,\t\t\t\\\n\t\t\t.enable_time\t= HI6421_LDO_ENABLE_TIME,\t\\\n\t\t\t.off_on_delay\t= odelay,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.mode_mask\t\t= sleepmask,\t\t\t\\\n\t}\n\n \nstatic struct hi6421_regulator_info\n\t\thi6421_regulator_info[HI6421_NUM_REGULATORS] = {\n\tHI6421_LDO(LDO0, hi6421_vout0, ldo_0_voltages, 0x20, 0x07, 0x20, 0x10,\n\t\t   10000, 0x20, 8000),\n\tHI6421_LDO_LINEAR(LDO1, hi6421_vout1, 1700000, 4, 100000, 0x21, 0x03,\n\t\t\t  0x21, 0x10, 10000, 0x20, 5000),\n\tHI6421_LDO_LINEAR(LDO2, hi6421_vout2, 1050000, 8, 50000, 0x22, 0x07,\n\t\t\t  0x22, 0x10, 20000, 0x20, 8000),\n\tHI6421_LDO_LINEAR(LDO3, hi6421_vout3, 1050000, 8, 50000, 0x23, 0x07,\n\t\t\t  0x23, 0x10, 20000, 0x20, 8000),\n\tHI6421_LDO(LDO4, hi6421_vout4, ldo_0_voltages, 0x24, 0x07, 0x24, 0x10,\n\t\t   20000, 0x20, 8000),\n\tHI6421_LDO(LDO5, hi6421_vout5, ldo_0_voltages, 0x25, 0x07, 0x25, 0x10,\n\t\t   20000, 0x20, 8000),\n\tHI6421_LDO(LDO6, hi6421_vout6, ldo_0_voltages, 0x26, 0x07, 0x26, 0x10,\n\t\t   20000, 0x20, 8000),\n\tHI6421_LDO(LDO7, hi6421_vout7, ldo_0_voltages, 0x27, 0x07, 0x27, 0x10,\n\t\t   20000, 0x20, 5000),\n\tHI6421_LDO(LDO8, hi6421_vout8, ldo_8_voltages, 0x28, 0x07, 0x28, 0x10,\n\t\t   20000, 0x20, 8000),\n\tHI6421_LDO(LDO9, hi6421_vout9, ldo_0_voltages, 0x29, 0x07, 0x29, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO10, hi6421_vout10, ldo_0_voltages, 0x2a, 0x07, 0x2a, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO11, hi6421_vout11, ldo_0_voltages, 0x2b, 0x07, 0x2b, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO12, hi6421_vout12, ldo_0_voltages, 0x2c, 0x07, 0x2c, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO13, hi6421_vout13, ldo_0_voltages, 0x2d, 0x07, 0x2d, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO14, hi6421_vout14, ldo_0_voltages, 0x2e, 0x07, 0x2e, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO15, hi6421_vout15, ldo_8_voltages, 0x2f, 0x07, 0x2f, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO16, hi6421_vout16, ldo_0_voltages, 0x30, 0x07, 0x30, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO17, hi6421_vout17, ldo_0_voltages, 0x31, 0x07, 0x31, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO18, hi6421_vout18, ldo_0_voltages, 0x32, 0x07, 0x32, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO19, hi6421_vout19, ldo_0_voltages, 0x33, 0x07, 0x33, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO(LDO20, hi6421_vout20, ldo_0_voltages, 0x34, 0x07, 0x34, 0x10,\n\t\t   40000, 0x20, 8000),\n\tHI6421_LDO_LINEAR_RANGE(LDOAUDIO, hi6421_vout_audio, 8,\n\t\t\t\tldo_audio_volt_range, 0x36, 0x70, 0x36, 0x01,\n\t\t\t\t40000, 0x02, 5000),\n\tHI6421_BUCK012(BUCK0, hi6421_buck0, 0x0d, 0x7f, 0x0c, 0x01, 0x10, 400,\n\t\t       20000),\n\tHI6421_BUCK012(BUCK1, hi6421_buck1, 0x0f, 0x7f, 0x0e, 0x01, 0x10, 400,\n\t\t       20000),\n\tHI6421_BUCK012(BUCK2, hi6421_buck2, 0x11, 0x7f, 0x10, 0x01, 0x10, 350,\n\t\t       100),\n\tHI6421_BUCK345(BUCK3, hi6421_buck3, buck_3_voltages, 0x13, 0x07, 0x12,\n\t\t       0x01, 20000, 0x10),\n\tHI6421_BUCK345(BUCK4, hi6421_buck4, buck_4_voltages, 0x15, 0x07, 0x14,\n\t\t       0x01, 20000, 0x10),\n\tHI6421_BUCK345(BUCK5, hi6421_buck5, buck_5_voltages, 0x17, 0x07, 0x16,\n\t\t       0x01, 20000, 0x10),\n};\n\nstatic int hi6421_regulator_enable(struct regulator_dev *rdev)\n{\n\tstruct hi6421_regulator_pdata *pdata = rdev_get_drvdata(rdev);\n\n\t \n\tmutex_lock(&pdata->lock);\n\n\t \n\tregulator_enable_regmap(rdev);\n\n\tmutex_unlock(&pdata->lock);\n\treturn 0;\n}\n\nstatic unsigned int hi6421_regulator_ldo_get_mode(struct regulator_dev *rdev)\n{\n\tstruct hi6421_regulator_info *info;\n\tunsigned int reg_val;\n\n\tinfo = container_of(rdev->desc, struct hi6421_regulator_info, desc);\n\tregmap_read(rdev->regmap, rdev->desc->enable_reg, &reg_val);\n\tif (reg_val & info->mode_mask)\n\t\treturn REGULATOR_MODE_IDLE;\n\n\treturn REGULATOR_MODE_NORMAL;\n}\n\nstatic unsigned int hi6421_regulator_buck_get_mode(struct regulator_dev *rdev)\n{\n\tstruct hi6421_regulator_info *info;\n\tunsigned int reg_val;\n\n\tinfo = container_of(rdev->desc, struct hi6421_regulator_info, desc);\n\tregmap_read(rdev->regmap, rdev->desc->enable_reg, &reg_val);\n\tif (reg_val & info->mode_mask)\n\t\treturn REGULATOR_MODE_STANDBY;\n\n\treturn REGULATOR_MODE_NORMAL;\n}\n\nstatic int hi6421_regulator_ldo_set_mode(struct regulator_dev *rdev,\n\t\t\t\t\t\tunsigned int mode)\n{\n\tstruct hi6421_regulator_info *info;\n\tunsigned int new_mode;\n\n\tinfo = container_of(rdev->desc, struct hi6421_regulator_info, desc);\n\tswitch (mode) {\n\tcase REGULATOR_MODE_NORMAL:\n\t\tnew_mode = 0;\n\t\tbreak;\n\tcase REGULATOR_MODE_IDLE:\n\t\tnew_mode = info->mode_mask;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tregmap_update_bits(rdev->regmap, rdev->desc->enable_reg,\n\t\t\t   info->mode_mask, new_mode);\n\n\treturn 0;\n}\n\nstatic int hi6421_regulator_buck_set_mode(struct regulator_dev *rdev,\n\t\t\t\t\t\tunsigned int mode)\n{\n\tstruct hi6421_regulator_info *info;\n\tunsigned int new_mode;\n\n\tinfo = container_of(rdev->desc, struct hi6421_regulator_info, desc);\n\tswitch (mode) {\n\tcase REGULATOR_MODE_NORMAL:\n\t\tnew_mode = 0;\n\t\tbreak;\n\tcase REGULATOR_MODE_STANDBY:\n\t\tnew_mode = info->mode_mask;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tregmap_update_bits(rdev->regmap, rdev->desc->enable_reg,\n\t\t\t   info->mode_mask, new_mode);\n\n\treturn 0;\n}\n\nstatic unsigned int\nhi6421_regulator_ldo_get_optimum_mode(struct regulator_dev *rdev,\n\t\t\tint input_uV, int output_uV, int load_uA)\n{\n\tstruct hi6421_regulator_info *info;\n\n\tinfo = container_of(rdev->desc, struct hi6421_regulator_info, desc);\n\n\tif (load_uA > info->eco_microamp)\n\t\treturn REGULATOR_MODE_NORMAL;\n\n\treturn REGULATOR_MODE_IDLE;\n}\n\nstatic const struct regulator_ops hi6421_ldo_ops = {\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.enable = hi6421_regulator_enable,\n\t.disable = regulator_disable_regmap,\n\t.list_voltage = regulator_list_voltage_table,\n\t.map_voltage = regulator_map_voltage_ascend,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_mode = hi6421_regulator_ldo_get_mode,\n\t.set_mode = hi6421_regulator_ldo_set_mode,\n\t.get_optimum_mode = hi6421_regulator_ldo_get_optimum_mode,\n};\n\nstatic const struct regulator_ops hi6421_ldo_linear_ops = {\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.enable = hi6421_regulator_enable,\n\t.disable = regulator_disable_regmap,\n\t.list_voltage = regulator_list_voltage_linear,\n\t.map_voltage = regulator_map_voltage_linear,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_mode = hi6421_regulator_ldo_get_mode,\n\t.set_mode = hi6421_regulator_ldo_set_mode,\n\t.get_optimum_mode = hi6421_regulator_ldo_get_optimum_mode,\n};\n\nstatic const struct regulator_ops hi6421_ldo_linear_range_ops = {\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.enable = hi6421_regulator_enable,\n\t.disable = regulator_disable_regmap,\n\t.list_voltage = regulator_list_voltage_linear_range,\n\t.map_voltage = regulator_map_voltage_linear_range,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_mode = hi6421_regulator_ldo_get_mode,\n\t.set_mode = hi6421_regulator_ldo_set_mode,\n\t.get_optimum_mode = hi6421_regulator_ldo_get_optimum_mode,\n};\n\nstatic const struct regulator_ops hi6421_buck012_ops = {\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.enable = hi6421_regulator_enable,\n\t.disable = regulator_disable_regmap,\n\t.list_voltage = regulator_list_voltage_linear,\n\t.map_voltage = regulator_map_voltage_linear,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_mode = hi6421_regulator_buck_get_mode,\n\t.set_mode = hi6421_regulator_buck_set_mode,\n};\n\nstatic const struct regulator_ops hi6421_buck345_ops = {\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.enable = hi6421_regulator_enable,\n\t.disable = regulator_disable_regmap,\n\t.list_voltage = regulator_list_voltage_table,\n\t.map_voltage = regulator_map_voltage_ascend,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_mode = hi6421_regulator_buck_get_mode,\n\t.set_mode = hi6421_regulator_buck_set_mode,\n};\n\nstatic int hi6421_regulator_probe(struct platform_device *pdev)\n{\n\tstruct hi6421_pmic *pmic = dev_get_drvdata(pdev->dev.parent);\n\tstruct hi6421_regulator_pdata *pdata;\n\tstruct hi6421_regulator_info *info;\n\tstruct regulator_config config = { };\n\tstruct regulator_dev *rdev;\n\tint i;\n\n\tpdata = devm_kzalloc(&pdev->dev, sizeof(*pdata), GFP_KERNEL);\n\tif (!pdata)\n\t\treturn -ENOMEM;\n\tmutex_init(&pdata->lock);\n\n\tfor (i = 0; i < ARRAY_SIZE(hi6421_regulator_info); i++) {\n\t\t \n\t\tinfo = &hi6421_regulator_info[i];\n\n\t\tconfig.dev = pdev->dev.parent;\n\t\tconfig.driver_data = pdata;\n\t\tconfig.regmap = pmic->regmap;\n\n\t\trdev = devm_regulator_register(&pdev->dev, &info->desc,\n\t\t\t\t\t       &config);\n\t\tif (IS_ERR(rdev)) {\n\t\t\tdev_err(&pdev->dev, \"failed to register regulator %s\\n\",\n\t\t\t\tinfo->desc.name);\n\t\t\treturn PTR_ERR(rdev);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id hi6421_regulator_table[] = {\n\t{ .name = \"hi6421-regulator\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(platform, hi6421_regulator_table);\n\nstatic struct platform_driver hi6421_regulator_driver = {\n\t.id_table = hi6421_regulator_table,\n\t.driver = {\n\t\t.name\t= \"hi6421-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe\t= hi6421_regulator_probe,\n};\nmodule_platform_driver(hi6421_regulator_driver);\n\nMODULE_AUTHOR(\"Guodong Xu <guodong.xu@linaro.org>\");\nMODULE_DESCRIPTION(\"Hi6421 regulator driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}