{
  "module_name": "da9062-regulator.c",
  "hash_id": "d7c732c822bb7734539397d67af182815fe1447169348bfd2db33238ca1d9bf2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/da9062-regulator.c",
  "human_readable_source": "\n\n\n\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/err.h>\n#include <linux/slab.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/of_regulator.h>\n#include <linux/mfd/da9062/core.h>\n#include <linux/mfd/da9062/registers.h>\n#include <dt-bindings/regulator/dlg,da9063-regulator.h>\n\n \nenum {\n\tDA9061_ID_BUCK1,\n\tDA9061_ID_BUCK2,\n\tDA9061_ID_BUCK3,\n\tDA9061_ID_LDO1,\n\tDA9061_ID_LDO2,\n\tDA9061_ID_LDO3,\n\tDA9061_ID_LDO4,\n\tDA9061_MAX_REGULATORS,\n};\n\nenum {\n\tDA9062_ID_BUCK1,\n\tDA9062_ID_BUCK2,\n\tDA9062_ID_BUCK3,\n\tDA9062_ID_BUCK4,\n\tDA9062_ID_LDO1,\n\tDA9062_ID_LDO2,\n\tDA9062_ID_LDO3,\n\tDA9062_ID_LDO4,\n\tDA9062_MAX_REGULATORS,\n};\n\n \nstruct da9062_regulator_info {\n\tstruct regulator_desc desc;\n\t \n\tstruct reg_field mode;\n\tstruct reg_field suspend;\n\tstruct reg_field sleep;\n\tstruct reg_field suspend_sleep;\n\tunsigned int suspend_vsel_reg;\n\t \n\tstruct reg_field oc_event;\n};\n\n \nstruct da9062_regulator {\n\tstruct regulator_desc\t\t\tdesc;\n\tstruct regulator_dev\t\t\t*rdev;\n\tstruct da9062\t\t\t\t*hw;\n\tconst struct da9062_regulator_info\t*info;\n\n\tstruct regmap_field\t\t\t*mode;\n\tstruct regmap_field\t\t\t*suspend;\n\tstruct regmap_field\t\t\t*sleep;\n\tstruct regmap_field\t\t\t*suspend_sleep;\n};\n\n \nstruct da9062_regulators {\n\tint\t\t\t\t\tirq_ldo_lim;\n\tunsigned\t\t\t\tn_regulators;\n\t \n\tstruct da9062_regulator\t\t\tregulator[];\n};\n\n \n\n \nstatic const unsigned int da9062_buck_a_limits[] = {\n\t 500000,  600000,  700000,  800000,  900000, 1000000, 1100000, 1200000,\n\t1300000, 1400000, 1500000, 1600000, 1700000, 1800000, 1900000, 2000000\n};\n\n \nstatic const unsigned int da9062_buck_b_limits[] = {\n\t1500000, 1600000, 1700000, 1800000, 1900000, 2000000, 2100000, 2200000,\n\t2300000, 2400000, 2500000, 2600000, 2700000, 2800000, 2900000, 3000000\n};\n\nstatic unsigned int da9062_map_buck_mode(unsigned int mode)\n{\n\tswitch (mode) {\n\tcase DA9063_BUCK_MODE_SLEEP:\n\t\treturn REGULATOR_MODE_STANDBY;\n\tcase DA9063_BUCK_MODE_SYNC:\n\t\treturn REGULATOR_MODE_FAST;\n\tcase DA9063_BUCK_MODE_AUTO:\n\t\treturn REGULATOR_MODE_NORMAL;\n\tdefault:\n\t\treturn REGULATOR_MODE_INVALID;\n\t}\n}\n\nstatic int da9062_buck_set_mode(struct regulator_dev *rdev, unsigned mode)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\tunsigned val;\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_FAST:\n\t\tval = DA9063_BUCK_MODE_SYNC;\n\t\tbreak;\n\tcase REGULATOR_MODE_NORMAL:\n\t\tval = DA9063_BUCK_MODE_AUTO;\n\t\tbreak;\n\tcase REGULATOR_MODE_STANDBY:\n\t\tval = DA9063_BUCK_MODE_SLEEP;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn regmap_field_write(regl->mode, val);\n}\n\n \n\nstatic unsigned da9062_buck_get_mode(struct regulator_dev *rdev)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\tunsigned int val;\n\tint ret;\n\n\tret = regmap_field_read(regl->mode, &val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tswitch (val) {\n\tdefault:\n\t\t \n\t\tbreak;\n\tcase DA9063_BUCK_MODE_SLEEP:\n\t\treturn REGULATOR_MODE_STANDBY;\n\tcase DA9063_BUCK_MODE_SYNC:\n\t\treturn REGULATOR_MODE_FAST;\n\tcase DA9063_BUCK_MODE_AUTO:\n\t\treturn REGULATOR_MODE_NORMAL;\n\t}\n\n\tret = regmap_field_read(regl->sleep, &val);\n\tif (ret < 0)\n\t\treturn 0;\n\n\tif (val)\n\t\treturn REGULATOR_MODE_STANDBY;\n\telse\n\t\treturn REGULATOR_MODE_FAST;\n}\n\n \n\nstatic int da9062_ldo_set_mode(struct regulator_dev *rdev, unsigned mode)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\tunsigned val;\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_NORMAL:\n\t\tval = 0;\n\t\tbreak;\n\tcase REGULATOR_MODE_STANDBY:\n\t\tval = 1;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn regmap_field_write(regl->sleep, val);\n}\n\nstatic unsigned da9062_ldo_get_mode(struct regulator_dev *rdev)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\tint ret, val;\n\n\tret = regmap_field_read(regl->sleep, &val);\n\tif (ret < 0)\n\t\treturn 0;\n\n\tif (val)\n\t\treturn REGULATOR_MODE_STANDBY;\n\telse\n\t\treturn REGULATOR_MODE_NORMAL;\n}\n\nstatic int da9062_buck_get_status(struct regulator_dev *rdev)\n{\n\tint ret = regulator_is_enabled_regmap(rdev);\n\n\tif (ret == 0) {\n\t\tret = REGULATOR_STATUS_OFF;\n\t} else if (ret > 0) {\n\t\tret = da9062_buck_get_mode(rdev);\n\t\tif (ret > 0)\n\t\t\tret = regulator_mode_to_status(ret);\n\t\telse if (ret == 0)\n\t\t\tret = -EIO;\n\t}\n\n\treturn ret;\n}\n\nstatic int da9062_ldo_get_status(struct regulator_dev *rdev)\n{\n\tint ret = regulator_is_enabled_regmap(rdev);\n\n\tif (ret == 0) {\n\t\tret = REGULATOR_STATUS_OFF;\n\t} else if (ret > 0) {\n\t\tret = da9062_ldo_get_mode(rdev);\n\t\tif (ret > 0)\n\t\t\tret = regulator_mode_to_status(ret);\n\t\telse if (ret == 0)\n\t\t\tret = -EIO;\n\t}\n\n\treturn ret;\n}\n\nstatic int da9062_set_suspend_voltage(struct regulator_dev *rdev, int uv)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\tconst struct da9062_regulator_info *rinfo = regl->info;\n\tint ret, sel;\n\n\tsel = regulator_map_voltage_linear(rdev, uv, uv);\n\tif (sel < 0)\n\t\treturn sel;\n\n\tsel <<= ffs(rdev->desc->vsel_mask) - 1;\n\n\tret = regmap_update_bits(regl->hw->regmap, rinfo->suspend_vsel_reg,\n\t\t\t\t rdev->desc->vsel_mask, sel);\n\n\treturn ret;\n}\n\nstatic int da9062_suspend_enable(struct regulator_dev *rdev)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\n\treturn regmap_field_write(regl->suspend, 1);\n}\n\nstatic int da9062_suspend_disable(struct regulator_dev *rdev)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\n\treturn regmap_field_write(regl->suspend, 0);\n}\n\nstatic int da9062_buck_set_suspend_mode(struct regulator_dev *rdev,\n\t\t\t\t\tunsigned mode)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\tint val;\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_FAST:\n\t\tval = DA9063_BUCK_MODE_SYNC;\n\t\tbreak;\n\tcase REGULATOR_MODE_NORMAL:\n\t\tval = DA9063_BUCK_MODE_AUTO;\n\t\tbreak;\n\tcase REGULATOR_MODE_STANDBY:\n\t\tval = DA9063_BUCK_MODE_SLEEP;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn regmap_field_write(regl->mode, val);\n}\n\nstatic int da9062_ldo_set_suspend_mode(struct regulator_dev *rdev,\n\t\t\t\t\t\tunsigned mode)\n{\n\tstruct da9062_regulator *regl = rdev_get_drvdata(rdev);\n\tunsigned val;\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_NORMAL:\n\t\tval = 0;\n\t\tbreak;\n\tcase REGULATOR_MODE_STANDBY:\n\t\tval = 1;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn regmap_field_write(regl->suspend_sleep, val);\n}\n\nstatic const struct regulator_ops da9062_buck_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.set_current_limit\t= regulator_set_current_limit_regmap,\n\t.get_current_limit\t= regulator_get_current_limit_regmap,\n\t.set_mode\t\t= da9062_buck_set_mode,\n\t.get_mode\t\t= da9062_buck_get_mode,\n\t.get_status\t\t= da9062_buck_get_status,\n\t.set_suspend_voltage\t= da9062_set_suspend_voltage,\n\t.set_suspend_enable\t= da9062_suspend_enable,\n\t.set_suspend_disable\t= da9062_suspend_disable,\n\t.set_suspend_mode\t= da9062_buck_set_suspend_mode,\n};\n\nstatic const struct regulator_ops da9062_ldo_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.set_mode\t\t= da9062_ldo_set_mode,\n\t.get_mode\t\t= da9062_ldo_get_mode,\n\t.get_status\t\t= da9062_ldo_get_status,\n\t.set_suspend_voltage\t= da9062_set_suspend_voltage,\n\t.set_suspend_enable\t= da9062_suspend_enable,\n\t.set_suspend_disable\t= da9062_suspend_disable,\n\t.set_suspend_mode\t= da9062_ldo_set_suspend_mode,\n};\n\n \nstatic const struct da9062_regulator_info local_da9061_regulator_info[] = {\n\t{\n\t\t.desc.id = DA9061_ID_BUCK1,\n\t\t.desc.name = \"DA9061 BUCK1\",\n\t\t.desc.of_match = of_match_ptr(\"buck1\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_buck_ops,\n\t\t.desc.min_uV = (300) * 1000,\n\t\t.desc.uV_step = (10) * 1000,\n\t\t.desc.n_voltages = ((1570) - (300))/(10) + 1,\n\t\t.desc.curr_table = da9062_buck_a_limits,\n\t\t.desc.n_current_limits = ARRAY_SIZE(da9062_buck_a_limits),\n\t\t.desc.csel_reg = DA9062AA_BUCK_ILIM_C,\n\t\t.desc.csel_mask = DA9062AA_BUCK1_ILIM_MASK,\n\t\t.desc.enable_reg = DA9062AA_BUCK1_CONT,\n\t\t.desc.enable_mask = DA9062AA_BUCK1_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VBUCK1_A,\n\t\t.desc.vsel_mask = DA9062AA_VBUCK1_A_MASK,\n\t\t.desc.linear_min_sel = 0,\n\t\t.desc.of_map_mode = da9062_map_buck_mode,\n\t\t.sleep = REG_FIELD(DA9062AA_VBUCK1_A,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK1_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VBUCK1_B,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK1_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VBUCK1_B,\n\t\t.mode = REG_FIELD(DA9062AA_BUCK1_CFG,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_MODE_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK1_MODE_MASK)) - 1),\n\t\t.suspend = REG_FIELD(DA9062AA_BUCK1_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_BUCK1_CONF_MASK) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9061_ID_BUCK2,\n\t\t.desc.name = \"DA9061 BUCK2\",\n\t\t.desc.of_match = of_match_ptr(\"buck2\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_buck_ops,\n\t\t.desc.min_uV = (800) * 1000,\n\t\t.desc.uV_step = (20) * 1000,\n\t\t.desc.n_voltages = ((3340) - (800))/(20) + 1,\n\t\t.desc.curr_table = da9062_buck_b_limits,\n\t\t.desc.n_current_limits = ARRAY_SIZE(da9062_buck_b_limits),\n\t\t.desc.csel_reg = DA9062AA_BUCK_ILIM_A,\n\t\t.desc.csel_mask = DA9062AA_BUCK3_ILIM_MASK,\n\t\t.desc.enable_reg = DA9062AA_BUCK3_CONT,\n\t\t.desc.enable_mask = DA9062AA_BUCK3_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VBUCK3_A,\n\t\t.desc.vsel_mask = DA9062AA_VBUCK3_A_MASK,\n\t\t.desc.linear_min_sel = 0,\n\t\t.desc.of_map_mode = da9062_map_buck_mode,\n\t\t.sleep = REG_FIELD(DA9062AA_VBUCK3_A,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK3_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VBUCK3_B,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK3_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VBUCK3_B,\n\t\t.mode = REG_FIELD(DA9062AA_BUCK3_CFG,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_MODE_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK3_MODE_MASK)) - 1),\n\t\t.suspend = REG_FIELD(DA9062AA_BUCK3_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_BUCK3_CONF_MASK) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9061_ID_BUCK3,\n\t\t.desc.name = \"DA9061 BUCK3\",\n\t\t.desc.of_match = of_match_ptr(\"buck3\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_buck_ops,\n\t\t.desc.min_uV = (530) * 1000,\n\t\t.desc.uV_step = (10) * 1000,\n\t\t.desc.n_voltages = ((1800) - (530))/(10) + 1,\n\t\t.desc.curr_table = da9062_buck_a_limits,\n\t\t.desc.n_current_limits = ARRAY_SIZE(da9062_buck_a_limits),\n\t\t.desc.csel_reg = DA9062AA_BUCK_ILIM_B,\n\t\t.desc.csel_mask = DA9062AA_BUCK4_ILIM_MASK,\n\t\t.desc.enable_reg = DA9062AA_BUCK4_CONT,\n\t\t.desc.enable_mask = DA9062AA_BUCK4_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VBUCK4_A,\n\t\t.desc.vsel_mask = DA9062AA_VBUCK4_A_MASK,\n\t\t.desc.linear_min_sel = 0,\n\t\t.desc.of_map_mode = da9062_map_buck_mode,\n\t\t.sleep = REG_FIELD(DA9062AA_VBUCK4_A,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK4_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VBUCK4_B,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK4_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VBUCK4_B,\n\t\t.mode = REG_FIELD(DA9062AA_BUCK4_CFG,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_MODE_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK4_MODE_MASK)) - 1),\n\t\t.suspend = REG_FIELD(DA9062AA_BUCK4_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_BUCK4_CONF_MASK) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9061_ID_LDO1,\n\t\t.desc.name = \"DA9061 LDO1\",\n\t\t.desc.of_match = of_match_ptr(\"ldo1\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO1_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO1_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO1_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO1_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO1_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO1_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO1_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO1_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO1_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO1_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO1_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO1_ILIM_MASK)) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9061_ID_LDO2,\n\t\t.desc.name = \"DA9061 LDO2\",\n\t\t.desc.of_match = of_match_ptr(\"ldo2\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO2_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO2_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO2_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO2_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO2_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO2_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO2_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO2_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO2_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO2_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO2_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO2_ILIM_MASK)) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9061_ID_LDO3,\n\t\t.desc.name = \"DA9061 LDO3\",\n\t\t.desc.of_match = of_match_ptr(\"ldo3\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO3_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO3_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO3_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO3_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO3_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO3_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO3_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO3_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO3_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO3_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO3_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO3_ILIM_MASK)) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9061_ID_LDO4,\n\t\t.desc.name = \"DA9061 LDO4\",\n\t\t.desc.of_match = of_match_ptr(\"ldo4\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO4_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO4_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO4_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO4_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO4_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO4_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO4_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO4_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO4_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO4_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO4_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO4_ILIM_MASK)) - 1),\n\t},\n};\n\n \nstatic const struct da9062_regulator_info local_da9062_regulator_info[] = {\n\t{\n\t\t.desc.id = DA9062_ID_BUCK1,\n\t\t.desc.name = \"DA9062 BUCK1\",\n\t\t.desc.of_match = of_match_ptr(\"buck1\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_buck_ops,\n\t\t.desc.min_uV = (300) * 1000,\n\t\t.desc.uV_step = (10) * 1000,\n\t\t.desc.n_voltages = ((1570) - (300))/(10) + 1,\n\t\t.desc.curr_table = da9062_buck_a_limits,\n\t\t.desc.n_current_limits = ARRAY_SIZE(da9062_buck_a_limits),\n\t\t.desc.csel_reg = DA9062AA_BUCK_ILIM_C,\n\t\t.desc.csel_mask = DA9062AA_BUCK1_ILIM_MASK,\n\t\t.desc.enable_reg = DA9062AA_BUCK1_CONT,\n\t\t.desc.enable_mask = DA9062AA_BUCK1_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VBUCK1_A,\n\t\t.desc.vsel_mask = DA9062AA_VBUCK1_A_MASK,\n\t\t.desc.linear_min_sel = 0,\n\t\t.desc.of_map_mode = da9062_map_buck_mode,\n\t\t.sleep = REG_FIELD(DA9062AA_VBUCK1_A,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK1_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VBUCK1_B,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK1_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VBUCK1_B,\n\t\t.mode = REG_FIELD(DA9062AA_BUCK1_CFG,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_MODE_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK1_MODE_MASK)) - 1),\n\t\t.suspend = REG_FIELD(DA9062AA_BUCK1_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK1_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_BUCK1_CONF_MASK) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9062_ID_BUCK2,\n\t\t.desc.name = \"DA9062 BUCK2\",\n\t\t.desc.of_match = of_match_ptr(\"buck2\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_buck_ops,\n\t\t.desc.min_uV = (300) * 1000,\n\t\t.desc.uV_step = (10) * 1000,\n\t\t.desc.n_voltages = ((1570) - (300))/(10) + 1,\n\t\t.desc.curr_table = da9062_buck_a_limits,\n\t\t.desc.n_current_limits = ARRAY_SIZE(da9062_buck_a_limits),\n\t\t.desc.csel_reg = DA9062AA_BUCK_ILIM_C,\n\t\t.desc.csel_mask = DA9062AA_BUCK2_ILIM_MASK,\n\t\t.desc.enable_reg = DA9062AA_BUCK2_CONT,\n\t\t.desc.enable_mask = DA9062AA_BUCK2_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VBUCK2_A,\n\t\t.desc.vsel_mask = DA9062AA_VBUCK2_A_MASK,\n\t\t.desc.linear_min_sel = 0,\n\t\t.desc.of_map_mode = da9062_map_buck_mode,\n\t\t.sleep = REG_FIELD(DA9062AA_VBUCK2_A,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK2_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK2_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VBUCK2_B,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK2_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK2_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VBUCK2_B,\n\t\t.mode = REG_FIELD(DA9062AA_BUCK2_CFG,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK2_MODE_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK2_MODE_MASK)) - 1),\n\t\t.suspend = REG_FIELD(DA9062AA_BUCK2_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK2_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_BUCK2_CONF_MASK) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9062_ID_BUCK3,\n\t\t.desc.name = \"DA9062 BUCK3\",\n\t\t.desc.of_match = of_match_ptr(\"buck3\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_buck_ops,\n\t\t.desc.min_uV = (800) * 1000,\n\t\t.desc.uV_step = (20) * 1000,\n\t\t.desc.n_voltages = ((3340) - (800))/(20) + 1,\n\t\t.desc.curr_table = da9062_buck_b_limits,\n\t\t.desc.n_current_limits = ARRAY_SIZE(da9062_buck_b_limits),\n\t\t.desc.csel_reg = DA9062AA_BUCK_ILIM_A,\n\t\t.desc.csel_mask = DA9062AA_BUCK3_ILIM_MASK,\n\t\t.desc.enable_reg = DA9062AA_BUCK3_CONT,\n\t\t.desc.enable_mask = DA9062AA_BUCK3_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VBUCK3_A,\n\t\t.desc.vsel_mask = DA9062AA_VBUCK3_A_MASK,\n\t\t.desc.linear_min_sel = 0,\n\t\t.desc.of_map_mode = da9062_map_buck_mode,\n\t\t.sleep = REG_FIELD(DA9062AA_VBUCK3_A,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK3_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VBUCK3_B,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK3_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VBUCK3_B,\n\t\t.mode = REG_FIELD(DA9062AA_BUCK3_CFG,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_MODE_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK3_MODE_MASK)) - 1),\n\t\t.suspend = REG_FIELD(DA9062AA_BUCK3_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK3_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_BUCK3_CONF_MASK) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9062_ID_BUCK4,\n\t\t.desc.name = \"DA9062 BUCK4\",\n\t\t.desc.of_match = of_match_ptr(\"buck4\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_buck_ops,\n\t\t.desc.min_uV = (530) * 1000,\n\t\t.desc.uV_step = (10) * 1000,\n\t\t.desc.n_voltages = ((1800) - (530))/(10) + 1,\n\t\t.desc.curr_table = da9062_buck_a_limits,\n\t\t.desc.n_current_limits = ARRAY_SIZE(da9062_buck_a_limits),\n\t\t.desc.csel_reg = DA9062AA_BUCK_ILIM_B,\n\t\t.desc.csel_mask = DA9062AA_BUCK4_ILIM_MASK,\n\t\t.desc.enable_reg = DA9062AA_BUCK4_CONT,\n\t\t.desc.enable_mask = DA9062AA_BUCK4_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VBUCK4_A,\n\t\t.desc.vsel_mask = DA9062AA_VBUCK4_A_MASK,\n\t\t.desc.linear_min_sel = 0,\n\t\t.desc.of_map_mode = da9062_map_buck_mode,\n\t\t.sleep = REG_FIELD(DA9062AA_VBUCK4_A,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK4_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VBUCK4_B,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK4_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VBUCK4_B,\n\t\t.mode = REG_FIELD(DA9062AA_BUCK4_CFG,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_MODE_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_BUCK4_MODE_MASK)) - 1),\n\t\t.suspend = REG_FIELD(DA9062AA_BUCK4_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_BUCK4_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_BUCK4_CONF_MASK) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9062_ID_LDO1,\n\t\t.desc.name = \"DA9062 LDO1\",\n\t\t.desc.of_match = of_match_ptr(\"ldo1\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO1_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO1_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO1_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO1_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO1_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO1_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO1_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO1_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO1_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO1_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO1_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO1_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO1_ILIM_MASK)) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9062_ID_LDO2,\n\t\t.desc.name = \"DA9062 LDO2\",\n\t\t.desc.of_match = of_match_ptr(\"ldo2\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO2_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO2_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO2_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO2_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO2_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO2_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO2_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO2_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO2_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO2_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO2_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO2_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO2_ILIM_MASK)) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9062_ID_LDO3,\n\t\t.desc.name = \"DA9062 LDO3\",\n\t\t.desc.of_match = of_match_ptr(\"ldo3\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO3_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO3_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO3_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO3_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO3_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO3_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO3_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO3_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO3_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO3_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO3_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO3_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO3_ILIM_MASK)) - 1),\n\t},\n\t{\n\t\t.desc.id = DA9062_ID_LDO4,\n\t\t.desc.name = \"DA9062 LDO4\",\n\t\t.desc.of_match = of_match_ptr(\"ldo4\"),\n\t\t.desc.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.desc.ops = &da9062_ldo_ops,\n\t\t.desc.min_uV = (900) * 1000,\n\t\t.desc.uV_step = (50) * 1000,\n\t\t.desc.n_voltages = ((3600) - (900))/(50) + 1\n\t\t\t\t+ DA9062AA_VLDO_A_MIN_SEL,\n\t\t.desc.enable_reg = DA9062AA_LDO4_CONT,\n\t\t.desc.enable_mask = DA9062AA_LDO4_EN_MASK,\n\t\t.desc.vsel_reg = DA9062AA_VLDO4_A,\n\t\t.desc.vsel_mask = DA9062AA_VLDO4_A_MASK,\n\t\t.desc.linear_min_sel = DA9062AA_VLDO_A_MIN_SEL,\n\t\t.sleep = REG_FIELD(DA9062AA_VLDO4_A,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_SL_A_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO4_SL_A_MASK)) - 1),\n\t\t.suspend_sleep = REG_FIELD(DA9062AA_VLDO4_B,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_SL_B_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO4_SL_B_MASK)) - 1),\n\t\t.suspend_vsel_reg = DA9062AA_VLDO4_B,\n\t\t.suspend = REG_FIELD(DA9062AA_LDO4_CONT,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_CONF_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz(DA9062AA_LDO4_CONF_MASK) - 1),\n\t\t.oc_event = REG_FIELD(DA9062AA_STATUS_D,\n\t\t\t__builtin_ffs((int)DA9062AA_LDO4_ILIM_MASK) - 1,\n\t\t\tsizeof(unsigned int) * 8 -\n\t\t\t__builtin_clz((DA9062AA_LDO4_ILIM_MASK)) - 1),\n\t},\n};\n\n \nstatic irqreturn_t da9062_ldo_lim_event(int irq, void *data)\n{\n\tstruct da9062_regulators *regulators = data;\n\tstruct da9062 *hw = regulators->regulator[0].hw;\n\tstruct da9062_regulator *regl;\n\tint handled = IRQ_NONE;\n\tint bits, i, ret;\n\n\tret = regmap_read(hw->regmap, DA9062AA_STATUS_D, &bits);\n\tif (ret < 0) {\n\t\tdev_err(hw->dev,\n\t\t\t\"Failed to read LDO overcurrent indicator\\n\");\n\t\tgoto ldo_lim_error;\n\t}\n\n\tfor (i = regulators->n_regulators - 1; i >= 0; i--) {\n\t\tregl = &regulators->regulator[i];\n\t\tif (regl->info->oc_event.reg != DA9062AA_STATUS_D)\n\t\t\tcontinue;\n\n\t\tif (BIT(regl->info->oc_event.lsb) & bits) {\n\t\t\tregulator_notifier_call_chain(regl->rdev,\n\t\t\t\t\tREGULATOR_EVENT_OVER_CURRENT, NULL);\n\t\t\thandled = IRQ_HANDLED;\n\t\t}\n\t}\n\nldo_lim_error:\n\treturn handled;\n}\n\nstatic int da9062_regulator_probe(struct platform_device *pdev)\n{\n\tstruct da9062 *chip = dev_get_drvdata(pdev->dev.parent);\n\tstruct da9062_regulators *regulators;\n\tstruct da9062_regulator *regl;\n\tstruct regulator_config config = { };\n\tconst struct da9062_regulator_info *rinfo;\n\tint n, ret;\n\tint max_regulators;\n\n\tswitch (chip->chip_type) {\n\tcase COMPAT_TYPE_DA9061:\n\t\tmax_regulators = DA9061_MAX_REGULATORS;\n\t\trinfo = local_da9061_regulator_info;\n\t\tbreak;\n\tcase COMPAT_TYPE_DA9062:\n\t\tmax_regulators = DA9062_MAX_REGULATORS;\n\t\trinfo = local_da9062_regulator_info;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(chip->dev, \"Unrecognised chip type\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\t \n\tregulators = devm_kzalloc(&pdev->dev, struct_size(regulators, regulator,\n\t\t\t\t  max_regulators), GFP_KERNEL);\n\tif (!regulators)\n\t\treturn -ENOMEM;\n\n\tregulators->n_regulators = max_regulators;\n\tplatform_set_drvdata(pdev, regulators);\n\n\tfor (n = 0; n < regulators->n_regulators; n++) {\n\t\t \n\t\tregl = &regulators->regulator[n];\n\t\tregl->hw = chip;\n\t\tregl->info = &rinfo[n];\n\t\tregl->desc = regl->info->desc;\n\t\tregl->desc.type = REGULATOR_VOLTAGE;\n\t\tregl->desc.owner = THIS_MODULE;\n\n\t\tif (regl->info->mode.reg) {\n\t\t\tregl->mode = devm_regmap_field_alloc(\n\t\t\t\t\t&pdev->dev,\n\t\t\t\t\tchip->regmap,\n\t\t\t\t\tregl->info->mode);\n\t\t\tif (IS_ERR(regl->mode))\n\t\t\t\treturn PTR_ERR(regl->mode);\n\t\t}\n\n\t\tif (regl->info->suspend.reg) {\n\t\t\tregl->suspend = devm_regmap_field_alloc(\n\t\t\t\t\t&pdev->dev,\n\t\t\t\t\tchip->regmap,\n\t\t\t\t\tregl->info->suspend);\n\t\t\tif (IS_ERR(regl->suspend))\n\t\t\t\treturn PTR_ERR(regl->suspend);\n\t\t}\n\n\t\tif (regl->info->sleep.reg) {\n\t\t\tregl->sleep = devm_regmap_field_alloc(\n\t\t\t\t\t&pdev->dev,\n\t\t\t\t\tchip->regmap,\n\t\t\t\t\tregl->info->sleep);\n\t\t\tif (IS_ERR(regl->sleep))\n\t\t\t\treturn PTR_ERR(regl->sleep);\n\t\t}\n\n\t\tif (regl->info->suspend_sleep.reg) {\n\t\t\tregl->suspend_sleep = devm_regmap_field_alloc(\n\t\t\t\t\t&pdev->dev,\n\t\t\t\t\tchip->regmap,\n\t\t\t\t\tregl->info->suspend_sleep);\n\t\t\tif (IS_ERR(regl->suspend_sleep))\n\t\t\t\treturn PTR_ERR(regl->suspend_sleep);\n\t\t}\n\n\t\t \n\t\tmemset(&config, 0, sizeof(config));\n\t\tconfig.dev = chip->dev;\n\t\tconfig.driver_data = regl;\n\t\tconfig.regmap = chip->regmap;\n\n\t\tregl->rdev = devm_regulator_register(&pdev->dev, &regl->desc,\n\t\t\t\t\t\t     &config);\n\t\tif (IS_ERR(regl->rdev)) {\n\t\t\tdev_err(&pdev->dev,\n\t\t\t\t\"Failed to register %s regulator\\n\",\n\t\t\t\tregl->desc.name);\n\t\t\treturn PTR_ERR(regl->rdev);\n\t\t}\n\t}\n\n\t \n\tregulators->irq_ldo_lim = platform_get_irq_byname_optional(pdev, \"LDO_LIM\");\n\tif (regulators->irq_ldo_lim < 0)\n\t\treturn 0;\n\n\tret = devm_request_threaded_irq(&pdev->dev, regulators->irq_ldo_lim,\n\t\t\t\t\tNULL, da9062_ldo_lim_event,\n\t\t\t\t\tIRQF_TRIGGER_LOW | IRQF_ONESHOT,\n\t\t\t\t\t\"LDO_LIM\", regulators);\n\tif (ret) {\n\t\tdev_warn(&pdev->dev,\n\t\t\t \"Failed to request LDO_LIM IRQ.\\n\");\n\t\tregulators->irq_ldo_lim = -ENXIO;\n\t}\n\n\treturn 0;\n}\n\nstatic struct platform_driver da9062_regulator_driver = {\n\t.driver = {\n\t\t.name = \"da9062-regulators\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = da9062_regulator_probe,\n};\n\nstatic int __init da9062_regulator_init(void)\n{\n\treturn platform_driver_register(&da9062_regulator_driver);\n}\nsubsys_initcall(da9062_regulator_init);\n\nstatic void __exit da9062_regulator_cleanup(void)\n{\n\tplatform_driver_unregister(&da9062_regulator_driver);\n}\nmodule_exit(da9062_regulator_cleanup);\n\n \nMODULE_AUTHOR(\"S Twiss <stwiss.opensource@diasemi.com>\");\nMODULE_DESCRIPTION(\"REGULATOR device driver for Dialog DA9062 and DA9061\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:da9062-regulators\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}