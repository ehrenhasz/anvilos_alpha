{
  "module_name": "max77802-regulator.c",
  "hash_id": "4219efa9b89007e665dd22e2d10e3d653b7eded2dc478cbfc63451565fad43c3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/max77802-regulator.c",
  "human_readable_source": "\n\n\n\n\n\n\n\n\n\n\n\n\n#include <linux/kernel.h>\n#include <linux/bug.h>\n#include <linux/err.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/of_regulator.h>\n#include <linux/mfd/max77686.h>\n#include <linux/mfd/max77686-private.h>\n#include <dt-bindings/regulator/maxim,max77802.h>\n\n \n#define MAX77802_RAMP_DELAY\t\t100000\t\t \n\n#define MAX77802_OPMODE_SHIFT_LDO\t6\n#define MAX77802_OPMODE_BUCK234_SHIFT\t4\n#define MAX77802_OPMODE_MASK\t\t0x3\n\n#define MAX77802_VSEL_MASK\t\t0x3F\n#define MAX77802_DVS_VSEL_MASK\t\t0xFF\n\n#define MAX77802_RAMP_RATE_MASK_2BIT\t0xC0\n#define MAX77802_RAMP_RATE_SHIFT_2BIT\t6\n#define MAX77802_RAMP_RATE_MASK_4BIT\t0xF0\n#define MAX77802_RAMP_RATE_SHIFT_4BIT\t4\n\n#define MAX77802_STATUS_OFF\t\t0x0\n#define MAX77802_OFF_PWRREQ\t\t0x1\n#define MAX77802_LP_PWRREQ\t\t0x2\n\nstatic const unsigned int max77802_buck234_ramp_table[] = {\n\t12500,\n\t25000,\n\t50000,\n\t100000,\n};\n\nstatic const unsigned int max77802_buck16_ramp_table[] = {\n\t1000,\t2000,\t3030,\t4000,\n\t5000,\t5880,\t7140,\t8330,\n\t9090,\t10000,\t11110,\t12500,\n\t16670,\t25000,\t50000,\t100000,\n};\n\nstruct max77802_regulator_prv {\n\t \n\tunsigned int opmode[MAX77802_REG_MAX];\n};\n\nstatic inline unsigned int max77802_map_mode(unsigned int mode)\n{\n\treturn mode == MAX77802_OPMODE_NORMAL ?\n\t\tREGULATOR_MODE_NORMAL : REGULATOR_MODE_STANDBY;\n}\n\nstatic int max77802_get_opmode_shift(int id)\n{\n\tif (id == MAX77802_BUCK1 || (id >= MAX77802_BUCK5 &&\n\t\t\t\t     id <= MAX77802_BUCK10))\n\t\treturn 0;\n\n\tif (id >= MAX77802_BUCK2 && id <= MAX77802_BUCK4)\n\t\treturn MAX77802_OPMODE_BUCK234_SHIFT;\n\n\tif (id >= MAX77802_LDO1 && id <= MAX77802_LDO35)\n\t\treturn MAX77802_OPMODE_SHIFT_LDO;\n\n\treturn -EINVAL;\n}\n\n \nstatic int max77802_set_suspend_disable(struct regulator_dev *rdev)\n{\n\tunsigned int val = MAX77802_OFF_PWRREQ;\n\tstruct max77802_regulator_prv *max77802 = rdev_get_drvdata(rdev);\n\tunsigned int id = rdev_get_id(rdev);\n\tint shift = max77802_get_opmode_shift(id);\n\n\tif (WARN_ON_ONCE(id >= ARRAY_SIZE(max77802->opmode)))\n\t\treturn -EINVAL;\n\tmax77802->opmode[id] = val;\n\treturn regmap_update_bits(rdev->regmap, rdev->desc->enable_reg,\n\t\t\t\t  rdev->desc->enable_mask, val << shift);\n}\n\n \nstatic int max77802_set_mode(struct regulator_dev *rdev, unsigned int mode)\n{\n\tstruct max77802_regulator_prv *max77802 = rdev_get_drvdata(rdev);\n\tunsigned int id = rdev_get_id(rdev);\n\tunsigned int val;\n\tint shift = max77802_get_opmode_shift(id);\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_STANDBY:\n\t\tval = MAX77802_OPMODE_LP;\t \n\t\tbreak;\n\tcase REGULATOR_MODE_NORMAL:\n\t\tval = MAX77802_OPMODE_NORMAL;\t \n\t\tbreak;\n\tdefault:\n\t\tdev_warn(&rdev->dev, \"%s: regulator mode: 0x%x not supported\\n\",\n\t\t\t rdev->desc->name, mode);\n\t\treturn -EINVAL;\n\t}\n\n\tif (WARN_ON_ONCE(id >= ARRAY_SIZE(max77802->opmode)))\n\t\treturn -EINVAL;\n\n\tmax77802->opmode[id] = val;\n\treturn regmap_update_bits(rdev->regmap, rdev->desc->enable_reg,\n\t\t\t\t  rdev->desc->enable_mask, val << shift);\n}\n\nstatic unsigned max77802_get_mode(struct regulator_dev *rdev)\n{\n\tstruct max77802_regulator_prv *max77802 = rdev_get_drvdata(rdev);\n\tunsigned int id = rdev_get_id(rdev);\n\n\tif (WARN_ON_ONCE(id >= ARRAY_SIZE(max77802->opmode)))\n\t\treturn -EINVAL;\n\treturn max77802_map_mode(max77802->opmode[id]);\n}\n\n \nstatic int max77802_set_suspend_mode(struct regulator_dev *rdev,\n\t\t\t\t     unsigned int mode)\n{\n\tstruct max77802_regulator_prv *max77802 = rdev_get_drvdata(rdev);\n\tunsigned int id = rdev_get_id(rdev);\n\tunsigned int val;\n\tint shift = max77802_get_opmode_shift(id);\n\n\tif (WARN_ON_ONCE(id >= ARRAY_SIZE(max77802->opmode)))\n\t\treturn -EINVAL;\n\n\t \n\tif (max77802->opmode[id] == MAX77802_OFF_PWRREQ) {\n\t\tdev_warn(&rdev->dev, \"%s: is disabled, mode: 0x%x not set\\n\",\n\t\t\t rdev->desc->name, mode);\n\t\treturn 0;\n\t}\n\n\tswitch (mode) {\n\tcase REGULATOR_MODE_STANDBY:\n\t\t \n\t\tif (max77802->opmode[id] == MAX77802_OPMODE_NORMAL)\n\t\t\tval = MAX77802_LP_PWRREQ;\n\t\telse\n\t\t\treturn 0;\n\t\tbreak;\n\tcase REGULATOR_MODE_NORMAL:\n\t\t \n\t\tif (max77802->opmode[id] == MAX77802_OPMODE_LP)\n\t\t\tdev_warn(&rdev->dev, \"%s: in Low Power: 0x%x invalid\\n\",\n\t\t\t\t rdev->desc->name, mode);\n\t\treturn 0;\n\tdefault:\n\t\tdev_warn(&rdev->dev, \"%s: regulator mode: 0x%x not supported\\n\",\n\t\t\t rdev->desc->name, mode);\n\t\treturn -EINVAL;\n\t}\n\n\treturn regmap_update_bits(rdev->regmap, rdev->desc->enable_reg,\n\t\t\t\t  rdev->desc->enable_mask, val << shift);\n}\n\nstatic int max77802_enable(struct regulator_dev *rdev)\n{\n\tstruct max77802_regulator_prv *max77802 = rdev_get_drvdata(rdev);\n\tunsigned int id = rdev_get_id(rdev);\n\tint shift = max77802_get_opmode_shift(id);\n\n\tif (WARN_ON_ONCE(id >= ARRAY_SIZE(max77802->opmode)))\n\t\treturn -EINVAL;\n\tif (max77802->opmode[id] == MAX77802_OFF_PWRREQ)\n\t\tmax77802->opmode[id] = MAX77802_OPMODE_NORMAL;\n\n\treturn regmap_update_bits(rdev->regmap, rdev->desc->enable_reg,\n\t\t\t\t  rdev->desc->enable_mask,\n\t\t\t\t  max77802->opmode[id] << shift);\n}\n\n \nstatic const struct regulator_ops max77802_ldo_ops_logic1 = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= max77802_enable,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.set_suspend_disable\t= max77802_set_suspend_disable,\n\t.set_suspend_mode\t= max77802_set_suspend_mode,\n};\n\n \nstatic const struct regulator_ops max77802_ldo_ops_logic2 = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= max77802_enable,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.set_mode\t\t= max77802_set_mode,\n\t.get_mode\t\t= max77802_get_mode,\n\t.set_suspend_mode\t= max77802_set_suspend_mode,\n};\n\n \nstatic const struct regulator_ops max77802_buck_16_dvs_ops = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= max77802_enable,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.set_ramp_delay\t\t= regulator_set_ramp_delay_regmap,\n\t.set_suspend_disable\t= max77802_set_suspend_disable,\n};\n\n \nstatic const struct regulator_ops max77802_buck_234_ops = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= max77802_enable,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.set_ramp_delay\t\t= regulator_set_ramp_delay_regmap,\n\t.set_suspend_disable\t= max77802_set_suspend_disable,\n\t.set_suspend_mode\t= max77802_set_suspend_mode,\n};\n\n \nstatic const struct regulator_ops max77802_buck_dvs_ops = {\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n\t.map_voltage\t\t= regulator_map_voltage_linear,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= max77802_enable,\n\t.disable\t\t= regulator_disable_regmap,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.set_voltage_time_sel\t= regulator_set_voltage_time_sel,\n\t.set_suspend_disable\t= max77802_set_suspend_disable,\n};\n\n \n#define regulator_77802_desc_p_ldo(num, supply, log)\t{\t\t\\\n\t.name\t\t= \"LDO\"#num,\t\t\t\t\t\\\n\t.of_match\t= of_match_ptr(\"LDO\"#num),\t\t\t\\\n\t.regulators_node\t= of_match_ptr(\"regulators\"),\t\t\\\n\t.id\t\t= MAX77802_LDO##num,\t\t\t\t\\\n\t.supply_name\t= \"inl\"#supply,\t\t\t\t\t\\\n\t.ops\t\t= &max77802_ldo_ops_logic##log,\t\t\t\\\n\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t.owner\t\t= THIS_MODULE,\t\t\t\t\t\\\n\t.min_uV\t\t= 800000,\t\t\t\t\t\\\n\t.uV_step\t= 50000,\t\t\t\t\t\\\n\t.ramp_delay\t= MAX77802_RAMP_DELAY,\t\t\t\t\\\n\t.n_voltages\t= 1 << 6,\t\t\t\t\t\\\n\t.vsel_reg\t= MAX77802_REG_LDO1CTRL1 + num - 1,\t\t\\\n\t.vsel_mask\t= MAX77802_VSEL_MASK,\t\t\t\t\\\n\t.enable_reg\t= MAX77802_REG_LDO1CTRL1 + num - 1,\t\t\\\n\t.enable_mask\t= MAX77802_OPMODE_MASK << MAX77802_OPMODE_SHIFT_LDO, \\\n\t.of_map_mode\t= max77802_map_mode,\t\t\t\t\\\n}\n\n \n#define regulator_77802_desc_n_ldo(num, supply, log)   {\t\t\\\n\t.name\t\t= \"LDO\"#num,\t\t\t\t\t\\\n\t.of_match\t= of_match_ptr(\"LDO\"#num),\t\t\t\\\n\t.regulators_node\t= of_match_ptr(\"regulators\"),\t\t\\\n\t.id\t\t= MAX77802_LDO##num,\t\t\t\t\\\n\t.supply_name\t= \"inl\"#supply,\t\t\t\t\t\\\n\t.ops\t\t= &max77802_ldo_ops_logic##log,\t\t\t\\\n\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t.owner\t\t= THIS_MODULE,\t\t\t\t\t\\\n\t.min_uV\t\t= 800000,\t\t\t\t\t\\\n\t.uV_step\t= 25000,\t\t\t\t\t\\\n\t.ramp_delay\t= MAX77802_RAMP_DELAY,\t\t\t\t\\\n\t.n_voltages\t= 1 << 6,\t\t\t\t\t\\\n\t.vsel_reg\t= MAX77802_REG_LDO1CTRL1 + num - 1,\t\t\\\n\t.vsel_mask\t= MAX77802_VSEL_MASK,\t\t\t\t\\\n\t.enable_reg\t= MAX77802_REG_LDO1CTRL1 + num - 1,\t\t\\\n\t.enable_mask\t= MAX77802_OPMODE_MASK << MAX77802_OPMODE_SHIFT_LDO, \\\n\t.of_map_mode\t= max77802_map_mode,\t\t\t\t\\\n}\n\n \n#define regulator_77802_desc_16_buck(num)\t{\t\t\\\n\t.name\t\t= \"BUCK\"#num,\t\t\t\t\t\\\n\t.of_match\t= of_match_ptr(\"BUCK\"#num),\t\t\t\\\n\t.regulators_node\t= of_match_ptr(\"regulators\"),\t\t\\\n\t.id\t\t= MAX77802_BUCK##num,\t\t\t\t\\\n\t.supply_name\t= \"inb\"#num,\t\t\t\t\t\\\n\t.ops\t\t= &max77802_buck_16_dvs_ops,\t\t\t\\\n\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t.owner\t\t= THIS_MODULE,\t\t\t\t\t\\\n\t.min_uV\t\t= 612500,\t\t\t\t\t\\\n\t.uV_step\t= 6250,\t\t\t\t\t\t\\\n\t.ramp_delay\t= MAX77802_RAMP_DELAY,\t\t\t\t\\\n\t.n_voltages\t= 1 << 8,\t\t\t\t\t\\\n\t.vsel_reg\t= MAX77802_REG_BUCK ## num ## DVS1,\t\t\\\n\t.vsel_mask\t= MAX77802_DVS_VSEL_MASK,\t\t\t\\\n\t.enable_reg\t= MAX77802_REG_BUCK ## num ## CTRL,\t\t\\\n\t.enable_mask\t= MAX77802_OPMODE_MASK,\t\t\t\t\\\n\t.ramp_reg\t= MAX77802_REG_BUCK ## num ## CTRL,\t\t\\\n\t.ramp_mask\t= MAX77802_RAMP_RATE_MASK_4BIT,\t\t\t\\\n\t.ramp_delay_table = max77802_buck16_ramp_table,\t\t\t\\\n\t.n_ramp_values\t= ARRAY_SIZE(max77802_buck16_ramp_table),\t\\\n\t.of_map_mode\t= max77802_map_mode,\t\t\t\t\\\n}\n\n \n#define regulator_77802_desc_234_buck(num)\t{\t\t\\\n\t.name\t\t= \"BUCK\"#num,\t\t\t\t\t\\\n\t.of_match\t= of_match_ptr(\"BUCK\"#num),\t\t\t\\\n\t.regulators_node\t= of_match_ptr(\"regulators\"),\t\t\\\n\t.id\t\t= MAX77802_BUCK##num,\t\t\t\t\\\n\t.supply_name\t= \"inb\"#num,\t\t\t\t\t\\\n\t.ops\t\t= &max77802_buck_234_ops,\t\t\t\\\n\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t.owner\t\t= THIS_MODULE,\t\t\t\t\t\\\n\t.min_uV\t\t= 600000,\t\t\t\t\t\\\n\t.uV_step\t= 6250,\t\t\t\t\t\t\\\n\t.ramp_delay\t= MAX77802_RAMP_DELAY,\t\t\t\t\\\n\t.n_voltages\t= 0x91,\t\t\t\t\t\t\\\n\t.vsel_reg\t= MAX77802_REG_BUCK ## num ## DVS1,\t\t\\\n\t.vsel_mask\t= MAX77802_DVS_VSEL_MASK,\t\t\t\\\n\t.enable_reg\t= MAX77802_REG_BUCK ## num ## CTRL1,\t\t\\\n\t.enable_mask\t= MAX77802_OPMODE_MASK <<\t\t\t\\\n\t\t\t\tMAX77802_OPMODE_BUCK234_SHIFT,\t\t\\\n\t.ramp_reg\t= MAX77802_REG_BUCK ## num ## CTRL1,\t\t\\\n\t.ramp_mask\t= MAX77802_RAMP_RATE_MASK_2BIT,\t\t\t\\\n\t.ramp_delay_table = max77802_buck234_ramp_table,\t\t\\\n\t.n_ramp_values\t= ARRAY_SIZE(max77802_buck234_ramp_table),\t\\\n\t.of_map_mode\t= max77802_map_mode,\t\t\t\t\\\n}\n\n \n#define regulator_77802_desc_buck5(num)\t\t{\t\t\\\n\t.name\t\t= \"BUCK\"#num,\t\t\t\t\t\\\n\t.of_match\t= of_match_ptr(\"BUCK\"#num),\t\t\t\\\n\t.regulators_node\t= of_match_ptr(\"regulators\"),\t\t\\\n\t.id\t\t= MAX77802_BUCK##num,\t\t\t\t\\\n\t.supply_name\t= \"inb\"#num,\t\t\t\t\t\\\n\t.ops\t\t= &max77802_buck_dvs_ops,\t\t\t\\\n\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t.owner\t\t= THIS_MODULE,\t\t\t\t\t\\\n\t.min_uV\t\t= 750000,\t\t\t\t\t\\\n\t.uV_step\t= 50000,\t\t\t\t\t\\\n\t.ramp_delay\t= MAX77802_RAMP_DELAY,\t\t\t\t\\\n\t.n_voltages\t= 1 << 6,\t\t\t\t\t\\\n\t.vsel_reg\t= MAX77802_REG_BUCK5OUT,\t\t\t\\\n\t.vsel_mask\t= MAX77802_VSEL_MASK,\t\t\t\t\\\n\t.enable_reg\t= MAX77802_REG_BUCK5CTRL,\t\t\t\\\n\t.enable_mask\t= MAX77802_OPMODE_MASK,\t\t\t\t\\\n\t.of_map_mode\t= max77802_map_mode,\t\t\t\t\\\n}\n\n \n#define regulator_77802_desc_buck7_10(num)\t{\t\t\\\n\t.name\t\t= \"BUCK\"#num,\t\t\t\t\t\\\n\t.of_match\t= of_match_ptr(\"BUCK\"#num),\t\t\t\\\n\t.regulators_node\t= of_match_ptr(\"regulators\"),\t\t\\\n\t.id\t\t= MAX77802_BUCK##num,\t\t\t\t\\\n\t.supply_name\t= \"inb\"#num,\t\t\t\t\t\\\n\t.ops\t\t= &max77802_buck_dvs_ops,\t\t\t\\\n\t.type\t\t= REGULATOR_VOLTAGE,\t\t\t\t\\\n\t.owner\t\t= THIS_MODULE,\t\t\t\t\t\\\n\t.min_uV\t\t= 750000,\t\t\t\t\t\\\n\t.uV_step\t= 50000,\t\t\t\t\t\\\n\t.ramp_delay\t= MAX77802_RAMP_DELAY,\t\t\t\t\\\n\t.n_voltages\t= 1 << 6,\t\t\t\t\t\\\n\t.vsel_reg\t= MAX77802_REG_BUCK7OUT + (num - 7) * 3,\t\\\n\t.vsel_mask\t= MAX77802_VSEL_MASK,\t\t\t\t\\\n\t.enable_reg\t= MAX77802_REG_BUCK7CTRL + (num - 7) * 3,\t\\\n\t.enable_mask\t= MAX77802_OPMODE_MASK,\t\t\t\t\\\n\t.of_map_mode\t= max77802_map_mode,\t\t\t\t\\\n}\n\nstatic const struct regulator_desc regulators[] = {\n\tregulator_77802_desc_16_buck(1),\n\tregulator_77802_desc_234_buck(2),\n\tregulator_77802_desc_234_buck(3),\n\tregulator_77802_desc_234_buck(4),\n\tregulator_77802_desc_buck5(5),\n\tregulator_77802_desc_16_buck(6),\n\tregulator_77802_desc_buck7_10(7),\n\tregulator_77802_desc_buck7_10(8),\n\tregulator_77802_desc_buck7_10(9),\n\tregulator_77802_desc_buck7_10(10),\n\tregulator_77802_desc_n_ldo(1, 10, 2),\n\tregulator_77802_desc_n_ldo(2, 10, 1),\n\tregulator_77802_desc_p_ldo(3, 3, 2),\n\tregulator_77802_desc_p_ldo(4, 6, 1),\n\tregulator_77802_desc_p_ldo(5, 3, 1),\n\tregulator_77802_desc_p_ldo(6, 3, 1),\n\tregulator_77802_desc_p_ldo(7, 3, 1),\n\tregulator_77802_desc_n_ldo(8, 1, 1),\n\tregulator_77802_desc_p_ldo(9, 5, 1),\n\tregulator_77802_desc_p_ldo(10, 4, 1),\n\tregulator_77802_desc_p_ldo(11, 4, 1),\n\tregulator_77802_desc_p_ldo(12, 9, 1),\n\tregulator_77802_desc_p_ldo(13, 4, 1),\n\tregulator_77802_desc_p_ldo(14, 4, 1),\n\tregulator_77802_desc_n_ldo(15, 1, 1),\n\tregulator_77802_desc_n_ldo(17, 2, 1),\n\tregulator_77802_desc_p_ldo(18, 7, 1),\n\tregulator_77802_desc_p_ldo(19, 5, 1),\n\tregulator_77802_desc_p_ldo(20, 7, 2),\n\tregulator_77802_desc_p_ldo(21, 6, 2),\n\tregulator_77802_desc_p_ldo(23, 9, 1),\n\tregulator_77802_desc_p_ldo(24, 6, 1),\n\tregulator_77802_desc_p_ldo(25, 9, 1),\n\tregulator_77802_desc_p_ldo(26, 9, 1),\n\tregulator_77802_desc_n_ldo(27, 2, 1),\n\tregulator_77802_desc_p_ldo(28, 7, 1),\n\tregulator_77802_desc_p_ldo(29, 7, 1),\n\tregulator_77802_desc_n_ldo(30, 2, 1),\n\tregulator_77802_desc_p_ldo(32, 9, 1),\n\tregulator_77802_desc_p_ldo(33, 6, 1),\n\tregulator_77802_desc_p_ldo(34, 9, 1),\n\tregulator_77802_desc_n_ldo(35, 2, 1),\n};\n\nstatic int max77802_pmic_probe(struct platform_device *pdev)\n{\n\tstruct max77686_dev *iodev = dev_get_drvdata(pdev->dev.parent);\n\tstruct max77802_regulator_prv *max77802;\n\tint i, val;\n\tstruct regulator_config config = { };\n\n\tmax77802 = devm_kzalloc(&pdev->dev,\n\t\t\t\tsizeof(struct max77802_regulator_prv),\n\t\t\t\tGFP_KERNEL);\n\tif (!max77802)\n\t\treturn -ENOMEM;\n\n\tconfig.dev = iodev->dev;\n\tconfig.regmap = iodev->regmap;\n\tconfig.driver_data = max77802;\n\tplatform_set_drvdata(pdev, max77802);\n\n\tfor (i = 0; i < MAX77802_REG_MAX; i++) {\n\t\tstruct regulator_dev *rdev;\n\t\tunsigned int id = regulators[i].id;\n\t\tint shift = max77802_get_opmode_shift(id);\n\t\tint ret;\n\n\t\tret = regmap_read(iodev->regmap, regulators[i].enable_reg, &val);\n\t\tif (ret < 0) {\n\t\t\tdev_warn(&pdev->dev,\n\t\t\t\t\"cannot read current mode for %d\\n\", i);\n\t\t\tval = MAX77802_OPMODE_NORMAL;\n\t\t} else {\n\t\t\tval = val >> shift & MAX77802_OPMODE_MASK;\n\t\t}\n\n\t\t \n\t\tif (id < ARRAY_SIZE(max77802->opmode)) {\n\t\t\tif (val == MAX77802_STATUS_OFF)\n\t\t\t\tmax77802->opmode[id] = MAX77802_OPMODE_NORMAL;\n\t\t\telse\n\t\t\t\tmax77802->opmode[id] = val;\n\t\t}\n\n\t\trdev = devm_regulator_register(&pdev->dev,\n\t\t\t\t\t       &regulators[i], &config);\n\t\tif (IS_ERR(rdev)) {\n\t\t\tret = PTR_ERR(rdev);\n\t\t\tdev_err(&pdev->dev,\n\t\t\t\t\"regulator init failed for %d: %d\\n\", i, ret);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id max77802_pmic_id[] = {\n\t{\"max77802-pmic\", 0},\n\t{ },\n};\nMODULE_DEVICE_TABLE(platform, max77802_pmic_id);\n\nstatic struct platform_driver max77802_pmic_driver = {\n\t.driver = {\n\t\t.name = \"max77802-pmic\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = max77802_pmic_probe,\n\t.id_table = max77802_pmic_id,\n};\n\nmodule_platform_driver(max77802_pmic_driver);\n\nMODULE_DESCRIPTION(\"MAXIM 77802 Regulator Driver\");\nMODULE_AUTHOR(\"Simon Glass <sjg@chromium.org>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}