{
  "module_name": "rt5033-regulator.c",
  "hash_id": "16155736b74bffcfe8c9c04896222698c7f3557f8c177f33ac48c6f8ca9451c9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/rt5033-regulator.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n#include <linux/mfd/rt5033.h>\n#include <linux/mfd/rt5033-private.h>\n#include <linux/regulator/of_regulator.h>\n\nstatic const struct linear_range rt5033_buck_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(1000000, 0, 20, 100000),\n\tREGULATOR_LINEAR_RANGE(3000000, 21, 31, 0),\n};\n\nstatic const struct linear_range rt5033_ldo_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(1200000, 0, 18, 100000),\n\tREGULATOR_LINEAR_RANGE(3000000, 19, 31, 0),\n};\n\nstatic const struct regulator_ops rt5033_safe_ldo_ops = {\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear,\n};\n\nstatic const struct regulator_ops rt5033_buck_ops = {\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n};\n\nstatic const struct regulator_desc rt5033_supported_regulators[] = {\n\t[RT5033_BUCK] = {\n\t\t.name\t\t= \"BUCK\",\n\t\t.of_match\t= of_match_ptr(\"BUCK\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id\t\t= RT5033_BUCK,\n\t\t.ops\t\t= &rt5033_buck_ops,\n\t\t.type\t\t= REGULATOR_VOLTAGE,\n\t\t.owner\t\t= THIS_MODULE,\n\t\t.n_voltages\t= RT5033_REGULATOR_BUCK_VOLTAGE_STEP_NUM,\n\t\t.linear_ranges\t= rt5033_buck_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rt5033_buck_ranges),\n\t\t.enable_reg\t= RT5033_REG_CTRL,\n\t\t.enable_mask\t= RT5033_CTRL_EN_BUCK_MASK,\n\t\t.vsel_reg\t= RT5033_REG_BUCK_CTRL,\n\t\t.vsel_mask\t= RT5033_BUCK_CTRL_MASK,\n\t},\n\t[RT5033_LDO] = {\n\t\t.name\t\t= \"LDO\",\n\t\t.of_match\t= of_match_ptr(\"LDO\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id\t\t= RT5033_LDO,\n\t\t.ops\t\t= &rt5033_buck_ops,\n\t\t.type\t\t= REGULATOR_VOLTAGE,\n\t\t.owner\t\t= THIS_MODULE,\n\t\t.n_voltages\t= RT5033_REGULATOR_LDO_VOLTAGE_STEP_NUM,\n\t\t.linear_ranges\t= rt5033_ldo_ranges,\n\t\t.n_linear_ranges = ARRAY_SIZE(rt5033_ldo_ranges),\n\t\t.enable_reg\t= RT5033_REG_CTRL,\n\t\t.enable_mask\t= RT5033_CTRL_EN_LDO_MASK,\n\t\t.vsel_reg\t= RT5033_REG_LDO_CTRL,\n\t\t.vsel_mask\t= RT5033_LDO_CTRL_MASK,\n\t},\n\t[RT5033_SAFE_LDO] = {\n\t\t.name\t\t= \"SAFE_LDO\",\n\t\t.of_match\t= of_match_ptr(\"SAFE_LDO\"),\n\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t.id\t\t= RT5033_SAFE_LDO,\n\t\t.ops\t\t= &rt5033_safe_ldo_ops,\n\t\t.type\t\t= REGULATOR_VOLTAGE,\n\t\t.owner\t\t= THIS_MODULE,\n\t\t.n_voltages\t= 1,\n\t\t.min_uV\t\t= RT5033_REGULATOR_SAFE_LDO_VOLTAGE,\n\t\t.enable_reg\t= RT5033_REG_CTRL,\n\t\t.enable_mask\t= RT5033_CTRL_EN_SAFE_LDO_MASK,\n\t},\n};\n\nstatic int rt5033_regulator_probe(struct platform_device *pdev)\n{\n\tstruct rt5033_dev *rt5033 = dev_get_drvdata(pdev->dev.parent);\n\tint ret, i;\n\tstruct regulator_config config = {};\n\n\tconfig.dev = rt5033->dev;\n\tconfig.driver_data = rt5033;\n\n\tfor (i = 0; i < ARRAY_SIZE(rt5033_supported_regulators); i++) {\n\t\tstruct regulator_dev *regulator;\n\n\t\tconfig.regmap = rt5033->regmap;\n\n\t\tregulator = devm_regulator_register(&pdev->dev,\n\t\t\t\t&rt5033_supported_regulators[i], &config);\n\t\tif (IS_ERR(regulator)) {\n\t\t\tret = PTR_ERR(regulator);\n\t\t\tdev_err(&pdev->dev,\n\t\t\t\t\"Regulator init failed %d: with error: %d\\n\",\n\t\t\t\ti, ret);\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id rt5033_regulator_id[] = {\n\t{ \"rt5033-regulator\", },\n\t{ }\n};\nMODULE_DEVICE_TABLE(platform, rt5033_regulator_id);\n\nstatic struct platform_driver rt5033_regulator_driver = {\n\t.driver = {\n\t\t.name = \"rt5033-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe\t\t= rt5033_regulator_probe,\n\t.id_table\t= rt5033_regulator_id,\n};\nmodule_platform_driver(rt5033_regulator_driver);\n\nMODULE_DESCRIPTION(\"Richtek RT5033 Regulator driver\");\nMODULE_AUTHOR(\"Beomho Seo <beomho.seo@samsung.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}