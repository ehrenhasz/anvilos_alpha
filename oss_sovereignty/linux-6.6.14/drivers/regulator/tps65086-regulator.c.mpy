{
  "module_name": "tps65086-regulator.c",
  "hash_id": "c79924d01c46d706267ce4776a9b930c7292c9a0826270761d384c5528074543",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/tps65086-regulator.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n\n#include <linux/mfd/tps65086.h>\n\nenum tps65086_regulators { BUCK1, BUCK2, BUCK3, BUCK4, BUCK5, BUCK6, LDOA1,\n\tLDOA2, LDOA3, VTT, SWA1, SWB1, SWB2 };\n\n \nenum tps65086_ids {\n\tTPS6508640 = 0,\n\tTPS65086401,\n\tTPS6508641,\n\tTPS65086470,\n};\n\n#define TPS65086_REGULATOR(_name, _of, _id, _nv, _vr, _vm, _er, _em, _lr, _dr, _dm)\t\\\n\t[_id] = {\t\t\t\t\t\t\t\\\n\t\t.desc = {\t\t\t\t\t\t\\\n\t\t\t.name\t\t\t= _name,\t\t\\\n\t\t\t.of_match\t\t= of_match_ptr(_of),\t\\\n\t\t\t.regulators_node\t= \"regulators\",\t\t\\\n\t\t\t.of_parse_cb\t\t= tps65086_of_parse_cb,\t\\\n\t\t\t.id\t\t\t= _id,\t\t\t\\\n\t\t\t.ops\t\t\t= &reg_ops,\t\t\\\n\t\t\t.n_voltages\t\t= _nv,\t\t\t\\\n\t\t\t.type\t\t\t= REGULATOR_VOLTAGE,\t\\\n\t\t\t.owner\t\t\t= THIS_MODULE,\t\t\\\n\t\t\t.vsel_reg\t\t= _vr,\t\t\t\\\n\t\t\t.vsel_mask\t\t= _vm,\t\t\t\\\n\t\t\t.enable_reg\t\t= _er,\t\t\t\\\n\t\t\t.enable_mask\t\t= _em,\t\t\t\\\n\t\t\t.volt_table\t\t= NULL,\t\t\t\\\n\t\t\t.linear_ranges\t\t= _lr,\t\t\t\\\n\t\t\t.n_linear_ranges\t= ARRAY_SIZE(_lr),\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t\t.decay_reg = _dr,\t\t\t\t\t\\\n\t\t.decay_mask = _dm,\t\t\t\t\t\\\n\t}\n\n#define TPS65086_SWITCH(_name, _of, _id, _er, _em)\t\t\t\\\n\t[_id] = {\t\t\t\t\t\t\t\\\n\t\t.desc = {\t\t\t\t\t\t\\\n\t\t\t.name\t\t\t= _name,\t\t\\\n\t\t\t.of_match\t\t= of_match_ptr(_of),\t\\\n\t\t\t.regulators_node\t= \"regulators\",\t\t\\\n\t\t\t.of_parse_cb\t\t= tps65086_of_parse_cb,\t\\\n\t\t\t.id\t\t\t= _id,\t\t\t\\\n\t\t\t.ops\t\t\t= &switch_ops,\t\t\\\n\t\t\t.type\t\t\t= REGULATOR_VOLTAGE,\t\\\n\t\t\t.owner\t\t\t= THIS_MODULE,\t\t\\\n\t\t\t.enable_reg\t\t= _er,\t\t\t\\\n\t\t\t.enable_mask\t\t= _em,\t\t\t\\\n\t\t},\t\t\t\t\t\t\t\\\n\t}\n\n\n#define TPS65086_REGULATOR_CONFIG(_chip_id, _config)\t\t\t\\\n\t[_chip_id] = {\t\t\t\t\t\t\t\\\n\t\t.config = _config,\t\t\t\t\t\\\n\t\t.num_elems = ARRAY_SIZE(_config),\t\t\t\\\n\t}\n\nstruct tps65086_regulator {\n\tstruct regulator_desc desc;\n\tunsigned int decay_reg;\n\tunsigned int decay_mask;\n};\n\nstruct tps65086_regulator_config {\n\tstruct tps65086_regulator * const config;\n\tconst unsigned int num_elems;\n};\n\nstatic const struct linear_range tps65086_10mv_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(0, 0x0, 0x0, 0),\n\tREGULATOR_LINEAR_RANGE(410000, 0x1, 0x7F, 10000),\n};\n\nstatic const struct linear_range tps65086_buck126_25mv_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(0, 0x0, 0x0, 0),\n\tREGULATOR_LINEAR_RANGE(1000000, 0x1, 0x18, 0),\n\tREGULATOR_LINEAR_RANGE(1025000, 0x19, 0x7F, 25000),\n};\n\nstatic const struct linear_range tps65086_buck345_25mv_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(0, 0x0, 0x0, 0),\n\tREGULATOR_LINEAR_RANGE(425000, 0x1, 0x7F, 25000),\n};\n\nstatic const struct linear_range tps65086_ldoa1_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(1350000, 0x0, 0x0, 0),\n\tREGULATOR_LINEAR_RANGE(1500000, 0x1, 0x7, 100000),\n\tREGULATOR_LINEAR_RANGE(2300000, 0x8, 0xB, 100000),\n\tREGULATOR_LINEAR_RANGE(2850000, 0xC, 0xD, 150000),\n\tREGULATOR_LINEAR_RANGE(3300000, 0xE, 0xE, 0),\n};\n\nstatic const struct linear_range tps65086_ldoa23_ranges[] = {\n\tREGULATOR_LINEAR_RANGE(700000, 0x0, 0xD, 50000),\n\tREGULATOR_LINEAR_RANGE(1400000, 0xE, 0xF, 100000),\n};\n\n \nstatic const struct regulator_ops reg_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n\t.map_voltage\t\t= regulator_map_voltage_linear_range,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_linear_range,\n};\n\n \nstatic const struct regulator_ops switch_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n};\n\nstatic int tps65086_of_parse_cb(struct device_node *dev,\n\t\t\t\tconst struct regulator_desc *desc,\n\t\t\t\tstruct regulator_config *config);\n\nstatic struct tps65086_regulator tps6508640_regulator_config[] = {\n\tTPS65086_REGULATOR(\"BUCK1\", \"buck1\", BUCK1, 0x80, TPS65086_BUCK1CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK1CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK2\", \"buck2\", BUCK2, 0x80, TPS65086_BUCK2CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(1),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK2CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK3\", \"buck3\", BUCK3, 0x80, TPS65086_BUCK3VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(2),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK3DECAY,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK4\", \"buck4\", BUCK4, 0x80, TPS65086_BUCK4VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK4CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK4VID,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK5\", \"buck5\", BUCK5, 0x80, TPS65086_BUCK5VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK5CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK5CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK6\", \"buck6\", BUCK6, 0x80, TPS65086_BUCK6VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK6CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK6CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"LDOA1\", \"ldoa1\", LDOA1, 0xF, TPS65086_LDOA1CTRL,\n\t\t\t   VDOA1_VID_MASK, TPS65086_SWVTT_EN, BIT(7),\n\t\t\t   tps65086_ldoa1_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA2\", \"ldoa2\", LDOA2, 0x10, TPS65086_LDOA2VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA2CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA3\", \"ldoa3\", LDOA3, 0x10, TPS65086_LDOA3VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA3CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_SWITCH(\"VTT\", \"vtt\", VTT, TPS65086_SWVTT_EN, BIT(4)),\n\tTPS65086_SWITCH(\"SWA1\", \"swa1\", SWA1, TPS65086_SWVTT_EN, BIT(5)),\n\tTPS65086_SWITCH(\"SWB1\", \"swb1\", SWB1, TPS65086_SWVTT_EN, BIT(6)),\n\tTPS65086_SWITCH(\"SWB2\", \"swb2\", SWB2, TPS65086_LDOA1CTRL, BIT(0)),\n};\n\nstatic struct tps65086_regulator tps65086401_regulator_config[] = {\n\tTPS65086_REGULATOR(\"BUCK1\", \"buck1\", BUCK1, 0x80, TPS65086_BUCK1CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK1CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK2\", \"buck2\", BUCK2, 0x80, TPS65086_BUCK2CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(1),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK2CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK3\", \"buck3\", BUCK3, 0x80, TPS65086_BUCK3VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(2),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK3DECAY,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK4\", \"buck4\", BUCK4, 0x80, TPS65086_BUCK4VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK4CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK4VID,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK5\", \"buck5\", BUCK5, 0x80, TPS65086_BUCK5VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK5CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK5CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK6\", \"buck6\", BUCK6, 0x80, TPS65086_BUCK6VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK6CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK6CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"LDOA1\", \"ldoa1\", LDOA1, 0xF, TPS65086_LDOA1CTRL,\n\t\t\t   VDOA1_VID_MASK, TPS65086_SWVTT_EN, BIT(7),\n\t\t\t   tps65086_ldoa1_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA2\", \"ldoa2\", LDOA2, 0x10, TPS65086_LDOA2VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA2CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA3\", \"ldoa3\", LDOA3, 0x10, TPS65086_LDOA3VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA3CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_SWITCH(\"VTT\", \"vtt\", VTT, TPS65086_SWVTT_EN, BIT(4)),\n\tTPS65086_SWITCH(\"SWA1\", \"swa1\", SWA1, TPS65086_SWVTT_EN, BIT(5)),\n\tTPS65086_SWITCH(\"SWB1\", \"swb1\", SWB1, TPS65086_SWVTT_EN, BIT(6)),\n};\n\nstatic struct tps65086_regulator tps6508641_regulator_config[] = {\n\tTPS65086_REGULATOR(\"BUCK1\", \"buck1\", BUCK1, 0x80, TPS65086_BUCK1CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK1CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK2\", \"buck2\", BUCK2, 0x80, TPS65086_BUCK2CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(1),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK2CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK3\", \"buck3\", BUCK3, 0x80, TPS65086_BUCK3VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(2),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK3DECAY,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK4\", \"buck4\", BUCK4, 0x80, TPS65086_BUCK4VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK4CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK4VID,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK5\", \"buck5\", BUCK5, 0x80, TPS65086_BUCK5VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK5CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK5CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK6\", \"buck6\", BUCK6, 0x80, TPS65086_BUCK6VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK6CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK6CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"LDOA1\", \"ldoa1\", LDOA1, 0xF, TPS65086_LDOA1CTRL,\n\t\t\t   VDOA1_VID_MASK, TPS65086_SWVTT_EN, BIT(7),\n\t\t\t   tps65086_ldoa1_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA2\", \"ldoa2\", LDOA2, 0x10, TPS65086_LDOA2VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA2CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA3\", \"ldoa3\", LDOA3, 0x10, TPS65086_LDOA3VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA3CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_SWITCH(\"VTT\", \"vtt\", VTT, TPS65086_SWVTT_EN, BIT(4)),\n\tTPS65086_SWITCH(\"SWA1\", \"swa1\", SWA1, TPS65086_SWVTT_EN, BIT(5)),\n\tTPS65086_SWITCH(\"SWB1\", \"swb1\", SWB1, TPS65086_SWVTT_EN, BIT(6)),\n};\n\nstatic struct tps65086_regulator tps65086470_regulator_config[] = {\n\tTPS65086_REGULATOR(\"BUCK1\", \"buck1\", BUCK1, 0x80, TPS65086_BUCK1CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK1CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK2\", \"buck2\", BUCK2, 0x80, TPS65086_BUCK2CTRL,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(1),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK2CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK3\", \"buck3\", BUCK3, 0x80, TPS65086_BUCK3VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK123CTRL, BIT(2),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK3DECAY,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK4\", \"buck4\", BUCK4, 0x80, TPS65086_BUCK4VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK4CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK4VID,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK5\", \"buck5\", BUCK5, 0x80, TPS65086_BUCK5VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK5CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK5CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"BUCK6\", \"buck6\", BUCK6, 0x80, TPS65086_BUCK6VID,\n\t\t\t   BUCK_VID_MASK, TPS65086_BUCK6CTRL, BIT(0),\n\t\t\t   tps65086_10mv_ranges, TPS65086_BUCK6CTRL,\n\t\t\t   BIT(0)),\n\tTPS65086_REGULATOR(\"LDOA1\", \"ldoa1\", LDOA1, 0xF, TPS65086_LDOA1CTRL,\n\t\t\t   VDOA1_VID_MASK, TPS65086_LDOA1CTRL, BIT(0),\n\t\t\t   tps65086_ldoa1_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA2\", \"ldoa2\", LDOA2, 0x10, TPS65086_LDOA2VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA2CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_REGULATOR(\"LDOA3\", \"ldoa3\", LDOA3, 0x10, TPS65086_LDOA3VID,\n\t\t\t   VDOA23_VID_MASK, TPS65086_LDOA3CTRL, BIT(0),\n\t\t\t   tps65086_ldoa23_ranges, 0, 0),\n\tTPS65086_SWITCH(\"VTT\", \"vtt\", VTT, TPS65086_SWVTT_EN, BIT(4)),\n\tTPS65086_SWITCH(\"SWA1\", \"swa1\", SWA1, TPS65086_SWVTT_EN, BIT(5)),\n\tTPS65086_SWITCH(\"SWB1\", \"swb1\", SWB1, TPS65086_SWVTT_EN, BIT(6)),\n\tTPS65086_SWITCH(\"SWB2\", \"swb2\", SWB2, TPS65086_SWVTT_EN, BIT(7)),\n};\n\nstatic const struct tps65086_regulator_config regulator_configs[] = {\n\tTPS65086_REGULATOR_CONFIG(TPS6508640, tps6508640_regulator_config),\n\tTPS65086_REGULATOR_CONFIG(TPS65086401, tps65086401_regulator_config),\n\tTPS65086_REGULATOR_CONFIG(TPS6508641, tps6508641_regulator_config),\n\tTPS65086_REGULATOR_CONFIG(TPS65086470, tps65086470_regulator_config)\n};\n\nstatic int tps65086_of_parse_cb(struct device_node *node,\n\t\t\t\tconst struct regulator_desc *desc,\n\t\t\t\tstruct regulator_config *config)\n{\n\tstruct tps65086 * const tps = dev_get_drvdata(config->dev);\n\tstruct tps65086_regulator *regulators = tps->reg_config->config;\n\tint ret;\n\n\t \n\tif (of_property_read_bool(node, \"ti,regulator-step-size-25mv\")) {\n\t\tswitch (desc->id) {\n\t\tcase BUCK1:\n\t\tcase BUCK2:\n\t\tcase BUCK6:\n\t\t\tregulators[desc->id].desc.linear_ranges =\n\t\t\t\ttps65086_buck126_25mv_ranges;\n\t\t\tregulators[desc->id].desc.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(tps65086_buck126_25mv_ranges);\n\t\t\tbreak;\n\t\tcase BUCK3:\n\t\tcase BUCK4:\n\t\tcase BUCK5:\n\t\t\tregulators[desc->id].desc.linear_ranges =\n\t\t\t\ttps65086_buck345_25mv_ranges;\n\t\t\tregulators[desc->id].desc.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(tps65086_buck345_25mv_ranges);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tdev_warn(config->dev, \"25mV step mode only valid for BUCK regulators\\n\");\n\t\t}\n\t}\n\n\t \n\tif (desc->id <= BUCK6 && of_property_read_bool(node, \"ti,regulator-decay\")) {\n\t\tret = regmap_write_bits(config->regmap,\n\t\t\t\t\tregulators[desc->id].decay_reg,\n\t\t\t\t\tregulators[desc->id].decay_mask,\n\t\t\t\t\tregulators[desc->id].decay_mask);\n\t\tif (ret) {\n\t\t\tdev_err(config->dev, \"Error setting decay\\n\");\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int tps65086_regulator_probe(struct platform_device *pdev)\n{\n\tstruct tps65086 *tps = dev_get_drvdata(pdev->dev.parent);\n\tstruct regulator_config config = { };\n\tunsigned int selector_reg_config;\n\tstruct regulator_dev *rdev;\n\tint i;\n\n\t \n\tswitch (tps->chip_id) {\n\tcase TPS6508640_ID:\n\t\tselector_reg_config = TPS6508640;\n\t\tbreak;\n\tcase TPS65086401_ID:\n\t\tselector_reg_config = TPS65086401;\n\t\tbreak;\n\tcase TPS6508641_ID:\n\t\tselector_reg_config = TPS6508641;\n\t\tbreak;\n\tcase TPS65086470_ID:\n\t\tselector_reg_config = TPS65086470;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(tps->dev, \"Unknown device ID. Cannot determine regulator config.\\n\");\n\t\treturn -ENODEV;\n\t}\n\ttps->reg_config = &regulator_configs[selector_reg_config];\n\n\tplatform_set_drvdata(pdev, tps);\n\n\tconfig.dev = &pdev->dev;\n\tconfig.dev->of_node = tps->dev->of_node;\n\tconfig.driver_data = tps;\n\tconfig.regmap = tps->regmap;\n\n\tfor (i = 0; i < tps->reg_config->num_elems; ++i) {\n\t\tstruct regulator_desc * const desc_ptr = &tps->reg_config->config[i].desc;\n\n\t\tdev_dbg(tps->dev, \"Index: %u; Regulator name: \\\"%s\\\"; Regulator ID: %d\\n\",\n\t\t\ti, desc_ptr->name, desc_ptr->id);\n\n\t\trdev = devm_regulator_register(&pdev->dev, desc_ptr, &config);\n\t\tif (IS_ERR(rdev)) {\n\t\t\tdev_err(tps->dev, \"failed to register %d \\\"%s\\\" regulator\\n\",\n\t\t\t\ti, desc_ptr->name);\n\t\t\treturn PTR_ERR(rdev);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id tps65086_regulator_id_table[] = {\n\t{ \"tps65086-regulator\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(platform, tps65086_regulator_id_table);\n\nstatic struct platform_driver tps65086_regulator_driver = {\n\t.driver = {\n\t\t.name = \"tps65086-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = tps65086_regulator_probe,\n\t.id_table = tps65086_regulator_id_table,\n};\nmodule_platform_driver(tps65086_regulator_driver);\n\nMODULE_AUTHOR(\"Andrew F. Davis <afd@ti.com>\");\nMODULE_DESCRIPTION(\"TPS65086 Regulator driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}