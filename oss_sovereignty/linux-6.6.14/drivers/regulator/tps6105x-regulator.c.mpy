{
  "module_name": "tps6105x-regulator.c",
  "hash_id": "aa6eac34fbcb22ed8fd7f05c45ed9d231ec7b8e19def3d884e03063551cf1415",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/tps6105x-regulator.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/err.h>\n#include <linux/regmap.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n#include <linux/mfd/core.h>\n#include <linux/mfd/tps6105x.h>\n\nstatic const unsigned int tps6105x_voltages[] = {\n\t4500000,\n\t5000000,\n\t5250000,\n\t5000000,  \n};\n\nstatic const struct regulator_ops tps6105x_regulator_ops = {\n\t.enable\t\t= regulator_enable_regmap,\n\t.disable\t= regulator_disable_regmap,\n\t.is_enabled\t= regulator_is_enabled_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.list_voltage\t= regulator_list_voltage_table,\n};\n\nstatic const struct regulator_desc tps6105x_regulator_desc = {\n\t.name\t\t= \"tps6105x-boost\",\n\t.of_match\t= of_match_ptr(\"regulator\"),\n\t.ops\t\t= &tps6105x_regulator_ops,\n\t.type\t\t= REGULATOR_VOLTAGE,\n\t.id\t\t= 0,\n\t.owner\t\t= THIS_MODULE,\n\t.n_voltages\t= ARRAY_SIZE(tps6105x_voltages),\n\t.volt_table\t= tps6105x_voltages,\n\t.vsel_reg\t= TPS6105X_REG_0,\n\t.vsel_mask\t= TPS6105X_REG0_VOLTAGE_MASK,\n\t.enable_reg\t= TPS6105X_REG_0,\n\t.enable_mask\t= TPS6105X_REG0_MODE_MASK,\n\t.enable_val\t= TPS6105X_REG0_MODE_VOLTAGE <<\n\t\t\t  TPS6105X_REG0_MODE_SHIFT,\n};\n\n \nstatic int tps6105x_regulator_probe(struct platform_device *pdev)\n{\n\tstruct tps6105x *tps6105x = dev_get_platdata(&pdev->dev);\n\tstruct tps6105x_platform_data *pdata = tps6105x->pdata;\n\tstruct regulator_config config = { };\n\tint ret;\n\n\t \n\tif (pdata->mode != TPS6105X_MODE_VOLTAGE) {\n\t\tdev_info(&pdev->dev,\n\t\t\t\"chip not in voltage mode mode, exit probe\\n\");\n\t\treturn 0;\n\t}\n\n\tconfig.dev = &tps6105x->client->dev;\n\tconfig.init_data = pdata->regulator_data;\n\tconfig.driver_data = tps6105x;\n\tconfig.of_node = pdev->dev.parent->of_node;\n\tconfig.regmap = tps6105x->regmap;\n\n\t \n\ttps6105x->regulator = devm_regulator_register(&pdev->dev,\n\t\t\t\t\t\t      &tps6105x_regulator_desc,\n\t\t\t\t\t\t      &config);\n\tif (IS_ERR(tps6105x->regulator)) {\n\t\tret = PTR_ERR(tps6105x->regulator);\n\t\tdev_err(&tps6105x->client->dev,\n\t\t\t\"failed to register regulator\\n\");\n\t\treturn ret;\n\t}\n\tplatform_set_drvdata(pdev, tps6105x);\n\n\treturn 0;\n}\n\nstatic struct platform_driver tps6105x_regulator_driver = {\n\t.driver = {\n\t\t.name  = \"tps6105x-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = tps6105x_regulator_probe,\n};\n\nstatic __init int tps6105x_regulator_init(void)\n{\n\treturn platform_driver_register(&tps6105x_regulator_driver);\n}\nsubsys_initcall(tps6105x_regulator_init);\n\nstatic __exit void tps6105x_regulator_exit(void)\n{\n\tplatform_driver_unregister(&tps6105x_regulator_driver);\n}\nmodule_exit(tps6105x_regulator_exit);\n\nMODULE_AUTHOR(\"Linus Walleij <linus.walleij@linaro.org>\");\nMODULE_DESCRIPTION(\"TPS6105x regulator driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"platform:tps6105x-regulator\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}