{
  "module_name": "sm5703-regulator.c",
  "hash_id": "498c09df8bc30fbdd42a4bdc9637ef62d01828d39d25cb2ff0f25251f66705dd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/sm5703-regulator.c",
  "human_readable_source": "\n\n#include <linux/mfd/sm5703.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/of_regulator.h>\n\nenum sm5703_regulators {\n\tSM5703_BUCK,\n\tSM5703_LDO1,\n\tSM5703_LDO2,\n\tSM5703_LDO3,\n\tSM5703_USBLDO1,\n\tSM5703_USBLDO2,\n\tSM5703_VBUS,\n\tSM5703_MAX_REGULATORS,\n};\n\nstatic const int sm5703_ldo_voltagemap[] = {\n\t1500000, 1800000, 2600000, 2800000, 3000000, 3300000,\n};\n\nstatic const int sm5703_buck_voltagemap[] = {\n\t1000000, 1000000, 1000000, 1000000,\n\t1000000, 1000000, 1000000, 1000000,\n\t1000000, 1000000, 1000000, 1100000,\n\t1200000, 1300000, 1400000, 1500000,\n\t1600000, 1700000, 1800000, 1900000,\n\t2000000, 2100000, 2200000, 2300000,\n\t2400000, 2500000, 2600000, 2700000,\n\t2800000, 2900000, 3000000, 3000000,\n};\n\n#define SM5703USBLDO(_name, _id)\t\t\t\t\t\\\n\t[SM5703_USBLDO ## _id] = {\t\t\t\t\t\\\n\t\t.name = _name,\t\t\t\t\t\t\\\n\t\t.of_match = _name,\t\t\t\t\t\\\n\t\t.regulators_node = \"regulators\",\t\t\t\\\n\t\t.type = REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.id = SM5703_USBLDO ## _id,\t\t\t\t\\\n\t\t.ops = &sm5703_regulator_ops_fixed,\t\t\t\\\n\t\t.n_voltages = 1,\t\t\t\t\t\\\n\t\t.fixed_uV = SM5703_USBLDO_MICROVOLT,\t\t\t\\\n\t\t.enable_reg = SM5703_REG_USBLDO12,\t\t\t\\\n\t\t.enable_mask = SM5703_REG_EN_USBLDO ##_id,\t\t\\\n\t\t.owner\t\t\t= THIS_MODULE,\t\t\t\\\n\t}\n\n#define SM5703VBUS(_name)\t\t\t\t\t\t\\\n\t[SM5703_VBUS] = {\t\t\t\t\t\t\\\n\t\t.name = _name,\t\t\t\t\t\t\\\n\t\t.of_match = _name,\t\t\t\t\t\\\n\t\t.regulators_node = \"regulators\",\t\t\t\\\n\t\t.type = REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.id = SM5703_VBUS,\t\t\t\t\t\\\n\t\t.ops = &sm5703_regulator_ops_fixed,\t\t\t\\\n\t\t.n_voltages = 1,\t\t\t\t\t\\\n\t\t.fixed_uV = SM5703_VBUS_MICROVOLT,\t\t\t\\\n\t\t.enable_reg = SM5703_REG_CNTL,\t\t\t\t\\\n\t\t.enable_mask = SM5703_OPERATION_MODE_MASK,\t\t\\\n\t\t.enable_val = SM5703_OPERATION_MODE_USB_OTG_MODE,\t\\\n\t\t.disable_val = SM5703_OPERATION_MODE_CHARGING_ON,\t\\\n\t\t.owner\t\t\t= THIS_MODULE,\t\t\t\\\n\t}\n\n#define SM5703BUCK(_name)\t\t\t\t\t\t\\\n\t[SM5703_BUCK] = {\t\t\t\t\t\t\\\n\t\t.name = _name,\t\t\t\t\t\t\\\n\t\t.of_match = _name,\t\t\t\t\t\\\n\t\t.regulators_node = \"regulators\",\t\t\t\\\n\t\t.type = REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.id = SM5703_BUCK,\t\t\t\t\t\\\n\t\t.ops = &sm5703_regulator_ops,\t\t\t\t\\\n\t\t.n_voltages = ARRAY_SIZE(sm5703_buck_voltagemap),\t\\\n\t\t.volt_table = sm5703_buck_voltagemap,\t\t\t\\\n\t\t.vsel_reg = SM5703_REG_BUCK,\t\t\t\t\\\n\t\t.vsel_mask = SM5703_BUCK_VOLT_MASK,\t\t\t\\\n\t\t.enable_reg = SM5703_REG_BUCK,\t\t\t\t\\\n\t\t.enable_mask = SM5703_REG_EN_BUCK,\t\t\t\\\n\t\t.owner\t\t\t= THIS_MODULE,\t\t\t\\\n\t}\n\n#define SM5703LDO(_name, _id)\t\t\t\t\t\t\\\n\t[SM5703_LDO ## _id] = {\t\t\t\t\t\t\\\n\t\t.name = _name,\t\t\t\t\t\t\\\n\t\t.of_match = _name,\t\t\t\t\t\\\n\t\t.regulators_node = \"regulators\",\t\t\t\\\n\t\t.type = REGULATOR_VOLTAGE,\t\t\t\t\\\n\t\t.id = SM5703_LDO ## _id,\t\t\t\t\\\n\t\t.ops = &sm5703_regulator_ops,\t\t\t\t\\\n\t\t.n_voltages = ARRAY_SIZE(sm5703_ldo_voltagemap),\t\\\n\t\t.volt_table = sm5703_ldo_voltagemap,\t\t\t\\\n\t\t.vsel_reg = SM5703_REG_LDO ##_id,\t\t\t\\\n\t\t.vsel_mask = SM5703_LDO_VOLT_MASK,\t\t\t\\\n\t\t.enable_reg = SM5703_REG_LDO ##_id,\t\t\t\\\n\t\t.enable_mask = SM5703_LDO_EN,\t\t\t\t\\\n\t\t.owner\t\t\t= THIS_MODULE,\t\t\t\\\n\t}\n\nstatic const struct regulator_ops sm5703_regulator_ops = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n\t.list_voltage\t\t= regulator_list_voltage_table,\n\t.get_voltage_sel\t= regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel\t= regulator_set_voltage_sel_regmap,\n};\n\nstatic const struct regulator_ops sm5703_regulator_ops_fixed = {\n\t.enable\t\t\t= regulator_enable_regmap,\n\t.disable\t\t= regulator_disable_regmap,\n\t.is_enabled\t\t= regulator_is_enabled_regmap,\n};\n\nstatic struct regulator_desc sm5703_regulators_desc[SM5703_MAX_REGULATORS] = {\n\tSM5703BUCK(\"buck\"),\n\tSM5703LDO(\"ldo1\", 1),\n\tSM5703LDO(\"ldo2\", 2),\n\tSM5703LDO(\"ldo3\", 3),\n\tSM5703USBLDO(\"usbldo1\", 1),\n\tSM5703USBLDO(\"usbldo2\", 2),\n\tSM5703VBUS(\"vbus\"),\n};\n\nstatic int sm5703_regulator_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct regulator_config config = { NULL, };\n\tstruct regulator_dev *rdev;\n\tstruct sm5703_dev *sm5703 = dev_get_drvdata(pdev->dev.parent);\n\tint i;\n\n\tconfig.dev = dev->parent;\n\tconfig.regmap = sm5703->regmap;\n\n\tfor (i = 0; i < SM5703_MAX_REGULATORS; i++) {\n\t\trdev = devm_regulator_register(dev,\n\t\t\t\t\t       &sm5703_regulators_desc[i],\n\t\t\t\t\t       &config);\n\t\tif (IS_ERR(rdev))\n\t\t\treturn dev_err_probe(dev, PTR_ERR(rdev),\n\t\t\t\t\t     \"Failed to register a regulator\\n\");\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id sm5703_regulator_id[] = {\n\t{ \"sm5703-regulator\", 0 },\n\t{}\n};\nMODULE_DEVICE_TABLE(platform, sm5703_regulator_id);\n\nstatic struct platform_driver sm5703_regulator_driver = {\n\t.driver = {\n\t\t.name = \"sm5703-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe\t= sm5703_regulator_probe,\n\t.id_table\t= sm5703_regulator_id,\n};\n\nmodule_platform_driver(sm5703_regulator_driver);\n\nMODULE_DESCRIPTION(\"Silicon Mitus SM5703 LDO/Buck/USB regulator driver\");\nMODULE_AUTHOR(\"Markuss Broks <markuss.broks@gmail.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}