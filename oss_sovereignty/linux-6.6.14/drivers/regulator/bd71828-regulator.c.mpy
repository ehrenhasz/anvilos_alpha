{
  "module_name": "bd71828-regulator.c",
  "hash_id": "9e4c72a1bd74c64bbbd0fd025a36333316def293b36538be81a75c56962dee7b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/bd71828-regulator.c",
  "human_readable_source": "\n\n\n\n\n#include <linux/delay.h>\n#include <linux/err.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/mfd/rohm-bd71828.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/of_regulator.h>\n\nstruct reg_init {\n\tunsigned int reg;\n\tunsigned int mask;\n\tunsigned int val;\n};\nstruct bd71828_regulator_data {\n\tstruct regulator_desc desc;\n\tconst struct rohm_dvs_config dvs;\n\tconst struct reg_init *reg_inits;\n\tint reg_init_amnt;\n};\n\nstatic const struct reg_init buck1_inits[] = {\n\t \n\t{\n\t\t.reg = BD71828_REG_PS_CTRL_1,\n\t\t.mask = BD71828_MASK_DVS_BUCK1_CTRL,\n\t\t.val = BD71828_DVS_BUCK1_CTRL_I2C,\n\t},\n};\n\nstatic const struct reg_init buck2_inits[] = {\n\t{\n\t\t.reg = BD71828_REG_PS_CTRL_1,\n\t\t.mask = BD71828_MASK_DVS_BUCK2_CTRL,\n\t\t.val = BD71828_DVS_BUCK2_CTRL_I2C,\n\t},\n};\n\nstatic const struct reg_init buck6_inits[] = {\n\t{\n\t\t.reg = BD71828_REG_PS_CTRL_1,\n\t\t.mask = BD71828_MASK_DVS_BUCK6_CTRL,\n\t\t.val = BD71828_DVS_BUCK6_CTRL_I2C,\n\t},\n};\n\nstatic const struct reg_init buck7_inits[] = {\n\t{\n\t\t.reg = BD71828_REG_PS_CTRL_1,\n\t\t.mask = BD71828_MASK_DVS_BUCK7_CTRL,\n\t\t.val = BD71828_DVS_BUCK7_CTRL_I2C,\n\t},\n};\n\nstatic const struct linear_range bd71828_buck1267_volts[] = {\n\tREGULATOR_LINEAR_RANGE(500000, 0x00, 0xef, 6250),\n\tREGULATOR_LINEAR_RANGE(2000000, 0xf0, 0xff, 0),\n};\n\nstatic const struct linear_range bd71828_buck3_volts[] = {\n\tREGULATOR_LINEAR_RANGE(1200000, 0x00, 0x0f, 50000),\n\tREGULATOR_LINEAR_RANGE(2000000, 0x10, 0x1f, 0),\n};\n\nstatic const struct linear_range bd71828_buck4_volts[] = {\n\tREGULATOR_LINEAR_RANGE(1000000, 0x00, 0x1f, 25000),\n\tREGULATOR_LINEAR_RANGE(1800000, 0x20, 0x3f, 0),\n};\n\nstatic const struct linear_range bd71828_buck5_volts[] = {\n\tREGULATOR_LINEAR_RANGE(2500000, 0x00, 0x0f, 50000),\n\tREGULATOR_LINEAR_RANGE(3300000, 0x10, 0x1f, 0),\n};\n\nstatic const struct linear_range bd71828_ldo_volts[] = {\n\tREGULATOR_LINEAR_RANGE(800000, 0x00, 0x31, 50000),\n\tREGULATOR_LINEAR_RANGE(3300000, 0x32, 0x3f, 0),\n};\n\nstatic const unsigned int bd71828_ramp_delay[] = { 2500, 5000, 10000, 20000 };\n\nstatic int buck_set_hw_dvs_levels(struct device_node *np,\n\t\t\t\t  const struct regulator_desc *desc,\n\t\t\t\t  struct regulator_config *cfg)\n{\n\tstruct bd71828_regulator_data *data;\n\n\tdata = container_of(desc, struct bd71828_regulator_data, desc);\n\n\treturn rohm_regulator_set_dvs_levels(&data->dvs, np, desc, cfg->regmap);\n}\n\nstatic int ldo6_parse_dt(struct device_node *np,\n\t\t\t const struct regulator_desc *desc,\n\t\t\t struct regulator_config *cfg)\n{\n\tint ret, i;\n\tuint32_t uv = 0;\n\tunsigned int en;\n\tstruct regmap *regmap = cfg->regmap;\n\tstatic const char * const props[] = { \"rohm,dvs-run-voltage\",\n\t\t\t\t\t      \"rohm,dvs-idle-voltage\",\n\t\t\t\t\t      \"rohm,dvs-suspend-voltage\",\n\t\t\t\t\t      \"rohm,dvs-lpsr-voltage\" };\n\tunsigned int mask[] = { BD71828_MASK_RUN_EN, BD71828_MASK_IDLE_EN,\n\t\t\t       BD71828_MASK_SUSP_EN, BD71828_MASK_LPSR_EN };\n\n\tfor (i = 0; i < ARRAY_SIZE(props); i++) {\n\t\tret = of_property_read_u32(np, props[i], &uv);\n\t\tif (ret) {\n\t\t\tif (ret != -EINVAL)\n\t\t\t\treturn ret;\n\t\t\tcontinue;\n\t\t}\n\t\tif (uv)\n\t\t\ten = 0xffffffff;\n\t\telse\n\t\t\ten = 0;\n\n\t\tret = regmap_update_bits(regmap, desc->enable_reg, mask[i], en);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\treturn 0;\n}\n\nstatic const struct regulator_ops bd71828_buck_ops = {\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.list_voltage = regulator_list_voltage_linear_range,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n};\n\nstatic const struct regulator_ops bd71828_dvs_buck_ops = {\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.list_voltage = regulator_list_voltage_linear_range,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_time_sel = regulator_set_voltage_time_sel,\n\t.set_ramp_delay = regulator_set_ramp_delay_regmap,\n};\n\nstatic const struct regulator_ops bd71828_ldo_ops = {\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n\t.list_voltage = regulator_list_voltage_linear_range,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n};\n\nstatic const struct regulator_ops bd71828_ldo6_ops = {\n\t.enable = regulator_enable_regmap,\n\t.disable = regulator_disable_regmap,\n\t.is_enabled = regulator_is_enabled_regmap,\n};\n\nstatic const struct bd71828_regulator_data bd71828_rdata[] = {\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck1\",\n\t\t\t.of_match = of_match_ptr(\"BUCK1\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_BUCK1,\n\t\t\t.ops = &bd71828_dvs_buck_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_buck1267_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_buck1267_volts),\n\t\t\t.n_voltages = BD71828_BUCK1267_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_BUCK1_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_BUCK1_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.ramp_delay_table = bd71828_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd71828_ramp_delay),\n\t\t\t.ramp_reg = BD71828_REG_BUCK1_MODE,\n\t\t\t.ramp_mask = BD71828_MASK_RAMP_DELAY,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_BUCK1_VOLT,\n\t\t\t.run_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_reg = BD71828_REG_BUCK1_IDLE_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_reg = BD71828_REG_BUCK1_SUSP_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t\t \n\t\t\t.lpsr_reg = BD71828_REG_BUCK1_SUSP_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t},\n\t\t.reg_inits = buck1_inits,\n\t\t.reg_init_amnt = ARRAY_SIZE(buck1_inits),\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck2\",\n\t\t\t.of_match = of_match_ptr(\"BUCK2\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_BUCK2,\n\t\t\t.ops = &bd71828_dvs_buck_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_buck1267_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_buck1267_volts),\n\t\t\t.n_voltages = BD71828_BUCK1267_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_BUCK2_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_BUCK2_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.ramp_delay_table = bd71828_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd71828_ramp_delay),\n\t\t\t.ramp_reg = BD71828_REG_BUCK2_MODE,\n\t\t\t.ramp_mask = BD71828_MASK_RAMP_DELAY,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_BUCK2_VOLT,\n\t\t\t.run_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_reg = BD71828_REG_BUCK2_IDLE_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_reg = BD71828_REG_BUCK2_SUSP_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t\t.lpsr_reg = BD71828_REG_BUCK2_SUSP_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t},\n\t\t.reg_inits = buck2_inits,\n\t\t.reg_init_amnt = ARRAY_SIZE(buck2_inits),\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck3\",\n\t\t\t.of_match = of_match_ptr(\"BUCK3\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_BUCK3,\n\t\t\t.ops = &bd71828_buck_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_buck3_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_buck3_volts),\n\t\t\t.n_voltages = BD71828_BUCK3_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_BUCK3_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_BUCK3_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_BUCK3_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_BUCK3_VOLT,\n\t\t\t.idle_reg = BD71828_REG_BUCK3_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_BUCK3_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_BUCK3_VOLT,\n\t\t\t.run_mask = BD71828_MASK_BUCK3_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_BUCK3_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_BUCK3_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_BUCK3_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck4\",\n\t\t\t.of_match = of_match_ptr(\"BUCK4\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_BUCK4,\n\t\t\t.ops = &bd71828_buck_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_buck4_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_buck4_volts),\n\t\t\t.n_voltages = BD71828_BUCK4_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_BUCK4_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_BUCK4_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_BUCK4_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_BUCK4_VOLT,\n\t\t\t.idle_reg = BD71828_REG_BUCK4_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_BUCK4_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_BUCK4_VOLT,\n\t\t\t.run_mask = BD71828_MASK_BUCK4_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_BUCK4_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_BUCK4_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_BUCK4_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck5\",\n\t\t\t.of_match = of_match_ptr(\"BUCK5\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_BUCK5,\n\t\t\t.ops = &bd71828_buck_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_buck5_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_buck5_volts),\n\t\t\t.n_voltages = BD71828_BUCK5_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_BUCK5_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_BUCK5_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_BUCK5_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_BUCK5_VOLT,\n\t\t\t.idle_reg = BD71828_REG_BUCK5_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_BUCK5_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_BUCK5_VOLT,\n\t\t\t.run_mask = BD71828_MASK_BUCK5_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_BUCK5_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_BUCK5_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_BUCK5_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck6\",\n\t\t\t.of_match = of_match_ptr(\"BUCK6\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_BUCK6,\n\t\t\t.ops = &bd71828_dvs_buck_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_buck1267_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_buck1267_volts),\n\t\t\t.n_voltages = BD71828_BUCK1267_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_BUCK6_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_BUCK6_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.ramp_delay_table = bd71828_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd71828_ramp_delay),\n\t\t\t.ramp_reg = BD71828_REG_BUCK6_MODE,\n\t\t\t.ramp_mask = BD71828_MASK_RAMP_DELAY,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_BUCK6_VOLT,\n\t\t\t.run_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_reg = BD71828_REG_BUCK6_IDLE_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_reg = BD71828_REG_BUCK6_SUSP_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t\t.lpsr_reg = BD71828_REG_BUCK6_SUSP_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t},\n\t\t.reg_inits = buck6_inits,\n\t\t.reg_init_amnt = ARRAY_SIZE(buck6_inits),\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck7\",\n\t\t\t.of_match = of_match_ptr(\"BUCK7\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_BUCK7,\n\t\t\t.ops = &bd71828_dvs_buck_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_buck1267_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_buck1267_volts),\n\t\t\t.n_voltages = BD71828_BUCK1267_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_BUCK7_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_BUCK7_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.ramp_delay_table = bd71828_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd71828_ramp_delay),\n\t\t\t.ramp_reg = BD71828_REG_BUCK7_MODE,\n\t\t\t.ramp_mask = BD71828_MASK_RAMP_DELAY,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_BUCK7_VOLT,\n\t\t\t.run_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_reg = BD71828_REG_BUCK7_IDLE_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_reg = BD71828_REG_BUCK7_SUSP_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t\t.lpsr_reg = BD71828_REG_BUCK7_SUSP_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_BUCK1267_VOLT,\n\t\t},\n\t\t.reg_inits = buck7_inits,\n\t\t.reg_init_amnt = ARRAY_SIZE(buck7_inits),\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo1\",\n\t\t\t.of_match = of_match_ptr(\"LDO1\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_LDO1,\n\t\t\t.ops = &bd71828_ldo_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_ldo_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_ldo_volts),\n\t\t\t.n_voltages = BD71828_LDO_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_LDO1_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_LDO1_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_LDO1_VOLT,\n\t\t\t.idle_reg = BD71828_REG_LDO1_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_LDO1_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_LDO1_VOLT,\n\t\t\t.run_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\t}, {\n\t\t.desc = {\n\t\t\t.name = \"ldo2\",\n\t\t\t.of_match = of_match_ptr(\"LDO2\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_LDO2,\n\t\t\t.ops = &bd71828_ldo_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_ldo_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_ldo_volts),\n\t\t\t.n_voltages = BD71828_LDO_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_LDO2_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_LDO2_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_LDO2_VOLT,\n\t\t\t.idle_reg = BD71828_REG_LDO2_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_LDO2_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_LDO2_VOLT,\n\t\t\t.run_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\t}, {\n\t\t.desc = {\n\t\t\t.name = \"ldo3\",\n\t\t\t.of_match = of_match_ptr(\"LDO3\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_LDO3,\n\t\t\t.ops = &bd71828_ldo_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_ldo_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_ldo_volts),\n\t\t\t.n_voltages = BD71828_LDO_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_LDO3_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_LDO3_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_LDO3_VOLT,\n\t\t\t.idle_reg = BD71828_REG_LDO3_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_LDO3_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_LDO3_VOLT,\n\t\t\t.run_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\n\t}, {\n\t\t.desc = {\n\t\t\t.name = \"ldo4\",\n\t\t\t.of_match = of_match_ptr(\"LDO4\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_LDO4,\n\t\t\t.ops = &bd71828_ldo_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_ldo_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_ldo_volts),\n\t\t\t.n_voltages = BD71828_LDO_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_LDO4_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_LDO4_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_LDO4_VOLT,\n\t\t\t.idle_reg = BD71828_REG_LDO4_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_LDO4_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_LDO4_VOLT,\n\t\t\t.run_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\t}, {\n\t\t.desc = {\n\t\t\t.name = \"ldo5\",\n\t\t\t.of_match = of_match_ptr(\"LDO5\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_LDO5,\n\t\t\t.ops = &bd71828_ldo_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_ldo_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_ldo_volts),\n\t\t\t.n_voltages = BD71828_LDO_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_LDO5_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_LDO5_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t \n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_LDO5_VOLT,\n\t\t\t.idle_reg = BD71828_REG_LDO5_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_LDO5_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_LDO5_VOLT,\n\t\t\t.run_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\n\t}, {\n\t\t.desc = {\n\t\t\t.name = \"ldo6\",\n\t\t\t.of_match = of_match_ptr(\"LDO6\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_LDO6,\n\t\t\t.ops = &bd71828_ldo6_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.fixed_uV = BD71828_LDO_6_VOLTAGE,\n\t\t\t.n_voltages = 1,\n\t\t\t.enable_reg = BD71828_REG_LDO6_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t \n\t\t\t.of_parse_cb = ldo6_parse_dt,\n\t\t},\n\t}, {\n\t\t.desc = {\n\t\t\t \n\t\t\t.name = \"ldo7\",\n\t\t\t.of_match = of_match_ptr(\"LDO7\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD71828_LDO_SNVS,\n\t\t\t.ops = &bd71828_ldo_ops,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.linear_ranges = bd71828_ldo_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71828_ldo_volts),\n\t\t\t.n_voltages = BD71828_LDO_VOLTS,\n\t\t\t.enable_reg = BD71828_REG_LDO7_EN,\n\t\t\t.enable_mask = BD71828_MASK_RUN_EN,\n\t\t\t.vsel_reg = BD71828_REG_LDO7_VOLT,\n\t\t\t.vsel_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t \n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND |\n\t\t\t\t     ROHM_DVS_LEVEL_LPSR,\n\t\t\t.run_reg = BD71828_REG_LDO7_VOLT,\n\t\t\t.idle_reg = BD71828_REG_LDO7_VOLT,\n\t\t\t.suspend_reg = BD71828_REG_LDO7_VOLT,\n\t\t\t.lpsr_reg = BD71828_REG_LDO7_VOLT,\n\t\t\t.run_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.suspend_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.lpsr_mask = BD71828_MASK_LDO_VOLT,\n\t\t\t.idle_on_mask = BD71828_MASK_IDLE_EN,\n\t\t\t.suspend_on_mask = BD71828_MASK_SUSP_EN,\n\t\t\t.lpsr_on_mask = BD71828_MASK_LPSR_EN,\n\t\t},\n\n\t},\n};\n\nstatic int bd71828_probe(struct platform_device *pdev)\n{\n\tint i, j, ret;\n\tstruct regulator_config config = {\n\t\t.dev = pdev->dev.parent,\n\t};\n\n\tconfig.regmap = dev_get_regmap(pdev->dev.parent, NULL);\n\tif (!config.regmap)\n\t\treturn -ENODEV;\n\n\tfor (i = 0; i < ARRAY_SIZE(bd71828_rdata); i++) {\n\t\tstruct regulator_dev *rdev;\n\t\tconst struct bd71828_regulator_data *rd;\n\n\t\trd = &bd71828_rdata[i];\n\t\trdev = devm_regulator_register(&pdev->dev,\n\t\t\t\t\t       &rd->desc, &config);\n\t\tif (IS_ERR(rdev))\n\t\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(rdev),\n\t\t\t\t\t     \"failed to register %s regulator\\n\",\n\t\t\t\t\t     rd->desc.name);\n\n\t\tfor (j = 0; j < rd->reg_init_amnt; j++) {\n\t\t\tret = regmap_update_bits(config.regmap,\n\t\t\t\t\t\t rd->reg_inits[j].reg,\n\t\t\t\t\t\t rd->reg_inits[j].mask,\n\t\t\t\t\t\t rd->reg_inits[j].val);\n\t\t\tif (ret)\n\t\t\t\treturn dev_err_probe(&pdev->dev, ret,\n\t\t\t\t\t\t     \"regulator %s init failed\\n\",\n\t\t\t\t\t\t     rd->desc.name);\n\t\t}\n\t}\n\treturn 0;\n}\n\nstatic struct platform_driver bd71828_regulator = {\n\t.driver = {\n\t\t.name = \"bd71828-pmic\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = bd71828_probe,\n};\n\nmodule_platform_driver(bd71828_regulator);\n\nMODULE_AUTHOR(\"Matti Vaittinen <matti.vaittinen@fi.rohmeurope.com>\");\nMODULE_DESCRIPTION(\"BD71828 voltage regulator driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:bd71828-pmic\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}