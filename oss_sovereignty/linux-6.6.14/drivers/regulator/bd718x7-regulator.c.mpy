{
  "module_name": "bd718x7-regulator.c",
  "hash_id": "5ca3777397356023d7a4adc4c61451d272425334db74773399c7ff7725998f9c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/bd718x7-regulator.c",
  "human_readable_source": "\n\n\n\n#include <linux/delay.h>\n#include <linux/err.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/mfd/rohm-bd718x7.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/of_regulator.h>\n#include <linux/slab.h>\n\n \n#define BD71847_BUCK1_STARTUP_TIME 144\n#define BD71847_BUCK2_STARTUP_TIME 162\n#define BD71847_BUCK3_STARTUP_TIME 162\n#define BD71847_BUCK4_STARTUP_TIME 240\n#define BD71847_BUCK5_STARTUP_TIME 270\n#define BD71847_BUCK6_STARTUP_TIME 200\n#define BD71847_LDO1_STARTUP_TIME  440\n#define BD71847_LDO2_STARTUP_TIME  370\n#define BD71847_LDO3_STARTUP_TIME  310\n#define BD71847_LDO4_STARTUP_TIME  400\n#define BD71847_LDO5_STARTUP_TIME  530\n#define BD71847_LDO6_STARTUP_TIME  400\n\n#define BD71837_BUCK1_STARTUP_TIME 160\n#define BD71837_BUCK2_STARTUP_TIME 180\n#define BD71837_BUCK3_STARTUP_TIME 180\n#define BD71837_BUCK4_STARTUP_TIME 180\n#define BD71837_BUCK5_STARTUP_TIME 160\n#define BD71837_BUCK6_STARTUP_TIME 240\n#define BD71837_BUCK7_STARTUP_TIME 220\n#define BD71837_BUCK8_STARTUP_TIME 200\n#define BD71837_LDO1_STARTUP_TIME  440\n#define BD71837_LDO2_STARTUP_TIME  370\n#define BD71837_LDO3_STARTUP_TIME  310\n#define BD71837_LDO4_STARTUP_TIME  400\n#define BD71837_LDO5_STARTUP_TIME  310\n#define BD71837_LDO6_STARTUP_TIME  400\n#define BD71837_LDO7_STARTUP_TIME  530\n\n \n#define BD718XX_HWOPNAME(swopname) swopname##_hwcontrol\n\n#define BD718XX_OPS(name, _list_voltage, _map_voltage, _set_voltage_sel, \\\n\t\t   _get_voltage_sel, _set_voltage_time_sel, _set_ramp_delay, \\\n\t\t   _set_uvp, _set_ovp)\t\t\t\t\\\nstatic const struct regulator_ops name = {\t\t\t\\\n\t.enable = regulator_enable_regmap,\t\t\t\\\n\t.disable = regulator_disable_regmap,\t\t\t\\\n\t.is_enabled = regulator_is_enabled_regmap,\t\t\\\n\t.list_voltage = (_list_voltage),\t\t\t\\\n\t.map_voltage = (_map_voltage),\t\t\t\t\\\n\t.set_voltage_sel = (_set_voltage_sel),\t\t\t\\\n\t.get_voltage_sel = (_get_voltage_sel),\t\t\t\\\n\t.set_voltage_time_sel = (_set_voltage_time_sel),\t\\\n\t.set_ramp_delay = (_set_ramp_delay),\t\t\t\\\n\t.set_under_voltage_protection = (_set_uvp),\t\t\\\n\t.set_over_voltage_protection = (_set_ovp),\t\t\\\n};\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\\\nstatic const struct regulator_ops BD718XX_HWOPNAME(name) = {\t\\\n\t.is_enabled = always_enabled_by_hwstate,\t\t\\\n\t.list_voltage = (_list_voltage),\t\t\t\\\n\t.map_voltage = (_map_voltage),\t\t\t\t\\\n\t.set_voltage_sel = (_set_voltage_sel),\t\t\t\\\n\t.get_voltage_sel = (_get_voltage_sel),\t\t\t\\\n\t.set_voltage_time_sel = (_set_voltage_time_sel),\t\\\n\t.set_ramp_delay = (_set_ramp_delay),\t\t\t\\\n\t.set_under_voltage_protection = (_set_uvp),\t\t\\\n\t.set_over_voltage_protection = (_set_ovp),\t\t\\\n}\t\t\t\t\t\t\t\t\\\n\n \nstatic const unsigned int bd718xx_ramp_delay[] = { 10000, 5000, 2500, 1250 };\n\n \nstatic int always_enabled_by_hwstate(struct regulator_dev *rdev)\n{\n\treturn 1;\n}\n\nstatic int never_enabled_by_hwstate(struct regulator_dev *rdev)\n{\n\treturn 0;\n}\n\nstatic int bd71837_get_buck34_enable_hwctrl(struct regulator_dev *rdev)\n{\n\tint ret;\n\tunsigned int val;\n\n\tret = regmap_read(rdev->regmap, rdev->desc->enable_reg, &val);\n\tif (ret)\n\t\treturn ret;\n\n\treturn !!(BD718XX_BUCK_RUN_ON & val);\n}\n\nstatic void voltage_change_done(struct regulator_dev *rdev, unsigned int sel,\n\t\t\t\tunsigned int *mask)\n{\n\tint ret;\n\n\tif (*mask) {\n\t\t \n\t\tmsleep(1);\n\n\t\tret = regmap_clear_bits(rdev->regmap, BD718XX_REG_MVRFLTMASK2,\n\t\t\t\t\t *mask);\n\t\tif (ret)\n\t\t\tdev_err(&rdev->dev,\n\t\t\t\t\"Failed to re-enable voltage monitoring (%d)\\n\",\n\t\t\t\tret);\n\t}\n}\n\nstatic int voltage_change_prepare(struct regulator_dev *rdev, unsigned int sel,\n\t\t\t\t  unsigned int *mask)\n{\n\tint ret;\n\n\t*mask = 0;\n\tif (rdev->desc->ops->is_enabled(rdev)) {\n\t\tint now, new;\n\n\t\tnow = rdev->desc->ops->get_voltage_sel(rdev);\n\t\tif (now < 0)\n\t\t\treturn now;\n\n\t\tnow = rdev->desc->ops->list_voltage(rdev, now);\n\t\tif (now < 0)\n\t\t\treturn now;\n\n\t\tnew = rdev->desc->ops->list_voltage(rdev, sel);\n\t\tif (new < 0)\n\t\t\treturn new;\n\n\t\t \n\t\tif (new > now) {\n\t\t\tint tmp;\n\t\t\tint prot_bit;\n\t\t\tint ldo_offset = rdev->desc->id - BD718XX_LDO1;\n\n\t\t\tprot_bit = BD718XX_LDO1_VRMON80 << ldo_offset;\n\t\t\tret = regmap_read(rdev->regmap, BD718XX_REG_MVRFLTMASK2,\n\t\t\t\t\t  &tmp);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(&rdev->dev,\n\t\t\t\t\t\"Failed to read voltage monitoring state\\n\");\n\t\t\t\treturn ret;\n\t\t\t}\n\n\t\t\tif (!(tmp & prot_bit)) {\n\t\t\t\t \n\t\t\t\tret = regmap_set_bits(rdev->regmap,\n\t\t\t\t\t\t      BD718XX_REG_MVRFLTMASK2,\n\t\t\t\t\t\t      prot_bit);\n\t\t\t\t \n\t\t\t\t*mask = prot_bit;\n\t\t\t}\n\t\t\tif (ret) {\n\t\t\t\tdev_err(&rdev->dev,\n\t\t\t\t\t\"Failed to stop voltage monitoring\\n\");\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic int bd718xx_set_voltage_sel_restricted(struct regulator_dev *rdev,\n\t\t\t\t\t\t    unsigned int sel)\n{\n\tint ret;\n\tint mask;\n\n\tret = voltage_change_prepare(rdev, sel, &mask);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regulator_set_voltage_sel_regmap(rdev, sel);\n\tvoltage_change_done(rdev, sel, &mask);\n\n\treturn ret;\n}\n\nstatic int bd718xx_set_voltage_sel_pickable_restricted(\n\t\tstruct regulator_dev *rdev, unsigned int sel)\n{\n\tint ret;\n\tint mask;\n\n\tret = voltage_change_prepare(rdev, sel, &mask);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regulator_set_voltage_sel_pickable_regmap(rdev, sel);\n\tvoltage_change_done(rdev, sel, &mask);\n\n\treturn ret;\n}\n\nstatic int bd71837_set_voltage_sel_pickable_restricted(\n\t\tstruct regulator_dev *rdev, unsigned int sel)\n{\n\tif (rdev->desc->ops->is_enabled(rdev))\n\t\treturn -EBUSY;\n\n\treturn regulator_set_voltage_sel_pickable_regmap(rdev, sel);\n}\n\n \nstatic const struct linear_range bd718xx_dvs_buck_volts[] = {\n\tREGULATOR_LINEAR_RANGE(700000, 0x00, 0x3C, 10000),\n\tREGULATOR_LINEAR_RANGE(1300000, 0x3D, 0x3F, 0),\n};\n\n \nstatic const struct linear_range bd71837_buck5_volts[] = {\n\t \n\tREGULATOR_LINEAR_RANGE(700000, 0x00, 0x03, 100000),\n\tREGULATOR_LINEAR_RANGE(1050000, 0x04, 0x05, 50000),\n\tREGULATOR_LINEAR_RANGE(1200000, 0x06, 0x07, 150000),\n\t \n\tREGULATOR_LINEAR_RANGE(675000, 0x0, 0x3, 100000),\n\tREGULATOR_LINEAR_RANGE(1025000, 0x4, 0x5, 50000),\n\tREGULATOR_LINEAR_RANGE(1175000, 0x6, 0x7, 150000),\n};\n\n \nstatic const unsigned int bd71837_buck5_volt_range_sel[] = {\n\t0x0, 0x0, 0x0, 0x1, 0x1, 0x1\n};\n\n \nstatic const struct linear_range bd71847_buck3_volts[] = {\n\t \n\tREGULATOR_LINEAR_RANGE(700000, 0x00, 0x03, 100000),\n\tREGULATOR_LINEAR_RANGE(1050000, 0x04, 0x05, 50000),\n\tREGULATOR_LINEAR_RANGE(1200000, 0x06, 0x07, 150000),\n\t \n\tREGULATOR_LINEAR_RANGE(550000, 0x0, 0x7, 50000),\n\t \n\tREGULATOR_LINEAR_RANGE(675000, 0x0, 0x3, 100000),\n\tREGULATOR_LINEAR_RANGE(1025000, 0x4, 0x5, 50000),\n\tREGULATOR_LINEAR_RANGE(1175000, 0x6, 0x7, 150000),\n};\n\nstatic const unsigned int bd71847_buck3_volt_range_sel[] = {\n\t0x0, 0x0, 0x0, 0x1, 0x2, 0x2, 0x2\n};\n\nstatic const struct linear_range bd71847_buck4_volts[] = {\n\tREGULATOR_LINEAR_RANGE(3000000, 0x00, 0x03, 100000),\n\tREGULATOR_LINEAR_RANGE(2600000, 0x00, 0x03, 100000),\n};\n\nstatic const unsigned int bd71847_buck4_volt_range_sel[] = { 0x0, 0x1 };\n\n \nstatic const struct linear_range bd71837_buck6_volts[] = {\n\tREGULATOR_LINEAR_RANGE(3000000, 0x00, 0x03, 100000),\n};\n\n \nstatic const unsigned int bd718xx_3rd_nodvs_buck_volts[] = {\n\t1605000, 1695000, 1755000, 1800000, 1845000, 1905000, 1950000, 1995000\n};\n\n \nstatic const struct linear_range bd718xx_4th_nodvs_buck_volts[] = {\n\tREGULATOR_LINEAR_RANGE(800000, 0x00, 0x3C, 10000),\n};\n\n \nstatic const struct linear_range bd718xx_ldo1_volts[] = {\n\tREGULATOR_LINEAR_RANGE(3000000, 0x00, 0x03, 100000),\n\tREGULATOR_LINEAR_RANGE(1600000, 0x00, 0x03, 100000),\n};\n\nstatic const unsigned int bd718xx_ldo1_volt_range_sel[] = { 0x0, 0x1 };\n\n \nstatic const unsigned int ldo_2_volts[] = {\n\t900000, 800000\n};\n\n \nstatic const struct linear_range bd718xx_ldo3_volts[] = {\n\tREGULATOR_LINEAR_RANGE(1800000, 0x00, 0x0F, 100000),\n};\n\n \nstatic const struct linear_range bd718xx_ldo4_volts[] = {\n\tREGULATOR_LINEAR_RANGE(900000, 0x00, 0x09, 100000),\n};\n\n \nstatic const struct linear_range bd71837_ldo5_volts[] = {\n\tREGULATOR_LINEAR_RANGE(1800000, 0x00, 0x0F, 100000),\n};\n\n \nstatic const struct linear_range bd71847_ldo5_volts[] = {\n\tREGULATOR_LINEAR_RANGE(1800000, 0x00, 0x0F, 100000),\n\tREGULATOR_LINEAR_RANGE(800000, 0x00, 0x0F, 100000),\n};\n\nstatic const unsigned int bd71847_ldo5_volt_range_sel[] = { 0x0, 0x1 };\n\n \nstatic const struct linear_range bd718xx_ldo6_volts[] = {\n\tREGULATOR_LINEAR_RANGE(900000, 0x00, 0x09, 100000),\n};\n\n \nstatic const struct linear_range bd71837_ldo7_volts[] = {\n\tREGULATOR_LINEAR_RANGE(1800000, 0x00, 0x0F, 100000),\n};\n\nstruct reg_init {\n\tunsigned int reg;\n\tunsigned int mask;\n\tunsigned int val;\n};\nstruct bd718xx_regulator_data {\n\tstruct regulator_desc desc;\n\tconst struct rohm_dvs_config dvs;\n\tconst struct reg_init init;\n\tconst struct reg_init *additional_inits;\n\tint additional_init_amnt;\n};\n\nstatic int bd718x7_xvp_sanity_check(struct regulator_dev *rdev, int lim_uV,\n\t\t\t\t    int severity)\n{\n\t \n\tif (severity != REGULATOR_SEVERITY_PROT) {\n\t\tdev_err(&rdev->dev,\n\t\t\t\"Unsupported Under Voltage protection level\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tif (lim_uV)\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nstatic int bd718x7_set_ldo_uvp(struct regulator_dev *rdev, int lim_uV,\n\t\t\t       int severity, bool enable)\n{\n\tint ldo_offset = rdev->desc->id - BD718XX_LDO1;\n\tint prot_bit, ret;\n\n\tret = bd718x7_xvp_sanity_check(rdev, lim_uV, severity);\n\tif (ret)\n\t\treturn ret;\n\n\tprot_bit = BD718XX_LDO1_VRMON80 << ldo_offset;\n\n\tif (enable)\n\t\treturn regmap_clear_bits(rdev->regmap, BD718XX_REG_MVRFLTMASK2,\n\t\t\t\t\t prot_bit);\n\n\treturn regmap_set_bits(rdev->regmap, BD718XX_REG_MVRFLTMASK2,\n\t\t\t       prot_bit);\n}\n\nstatic int bd718x7_get_buck_prot_reg(int id, int *reg)\n{\n\n\tif (id > BD718XX_BUCK8) {\n\t\tWARN_ON(id > BD718XX_BUCK8);\n\t\treturn -EINVAL;\n\t}\n\n\tif (id > BD718XX_BUCK4)\n\t\t*reg = BD718XX_REG_MVRFLTMASK0;\n\telse\n\t\t*reg = BD718XX_REG_MVRFLTMASK1;\n\n\treturn 0;\n}\n\nstatic int bd718x7_get_buck_ovp_info(int id, int *reg, int *bit)\n{\n\tint ret;\n\n\tret = bd718x7_get_buck_prot_reg(id, reg);\n\tif (ret)\n\t\treturn ret;\n\n\t*bit = BIT((id % 4) * 2 + 1);\n\n\treturn 0;\n}\n\nstatic int bd718x7_get_buck_uvp_info(int id, int *reg, int *bit)\n{\n\tint ret;\n\n\tret = bd718x7_get_buck_prot_reg(id, reg);\n\tif (ret)\n\t\treturn ret;\n\n\t*bit = BIT((id % 4) * 2);\n\n\treturn 0;\n}\n\nstatic int bd718x7_set_buck_uvp(struct regulator_dev *rdev, int lim_uV,\n\t\t\t\tint severity, bool enable)\n{\n\tint bit, reg, ret;\n\n\tret = bd718x7_xvp_sanity_check(rdev, lim_uV, severity);\n\tif (ret)\n\t\treturn ret;\n\n\tret = bd718x7_get_buck_uvp_info(rdev->desc->id, &reg, &bit);\n\tif (ret)\n\t\treturn ret;\n\n\tif (enable)\n\t\treturn regmap_clear_bits(rdev->regmap, reg, bit);\n\n\treturn regmap_set_bits(rdev->regmap, reg, bit);\n\n}\n\nstatic int bd718x7_set_buck_ovp(struct regulator_dev *rdev, int lim_uV,\n\t\t\t\tint severity,\n\t\t\t\tbool enable)\n{\n\tint bit, reg, ret;\n\n\tret = bd718x7_xvp_sanity_check(rdev, lim_uV, severity);\n\tif (ret)\n\t\treturn ret;\n\n\tret = bd718x7_get_buck_ovp_info(rdev->desc->id, &reg, &bit);\n\tif (ret)\n\t\treturn ret;\n\n\tif (enable)\n\t\treturn regmap_clear_bits(rdev->regmap, reg, bit);\n\n\treturn regmap_set_bits(rdev->regmap, reg, bit);\n}\n\n \nBD718XX_OPS(bd718xx_pickable_range_ldo_ops,\n\t    regulator_list_voltage_pickable_linear_range, NULL,\n\t    bd718xx_set_voltage_sel_pickable_restricted,\n\t    regulator_get_voltage_sel_pickable_regmap, NULL, NULL,\n\t    bd718x7_set_ldo_uvp, NULL);\n\n \nstatic const struct regulator_ops bd718xx_ldo5_ops_hwstate = {\n\t.is_enabled = never_enabled_by_hwstate,\n\t.list_voltage = regulator_list_voltage_pickable_linear_range,\n\t.set_voltage_sel = bd718xx_set_voltage_sel_pickable_restricted,\n\t.get_voltage_sel = regulator_get_voltage_sel_pickable_regmap,\n\t.set_under_voltage_protection = bd718x7_set_ldo_uvp,\n};\n\nBD718XX_OPS(bd718xx_pickable_range_buck_ops,\n\t    regulator_list_voltage_pickable_linear_range, NULL,\n\t    regulator_set_voltage_sel_pickable_regmap,\n\t    regulator_get_voltage_sel_pickable_regmap,\n\t    regulator_set_voltage_time_sel, NULL, bd718x7_set_buck_uvp,\n\t    bd718x7_set_buck_ovp);\n\nBD718XX_OPS(bd718xx_ldo_regulator_ops, regulator_list_voltage_linear_range,\n\t    NULL, bd718xx_set_voltage_sel_restricted,\n\t    regulator_get_voltage_sel_regmap, NULL, NULL, bd718x7_set_ldo_uvp,\n\t    NULL);\n\nBD718XX_OPS(bd718xx_ldo_regulator_nolinear_ops, regulator_list_voltage_table,\n\t    NULL, bd718xx_set_voltage_sel_restricted,\n\t    regulator_get_voltage_sel_regmap, NULL, NULL, bd718x7_set_ldo_uvp,\n\t    NULL);\n\nBD718XX_OPS(bd718xx_buck_regulator_ops, regulator_list_voltage_linear_range,\n\t    NULL, regulator_set_voltage_sel_regmap,\n\t    regulator_get_voltage_sel_regmap, regulator_set_voltage_time_sel,\n\t    NULL, bd718x7_set_buck_uvp, bd718x7_set_buck_ovp);\n\nBD718XX_OPS(bd718xx_buck_regulator_nolinear_ops, regulator_list_voltage_table,\n\t    regulator_map_voltage_ascend, regulator_set_voltage_sel_regmap,\n\t    regulator_get_voltage_sel_regmap, regulator_set_voltage_time_sel,\n\t    NULL, bd718x7_set_buck_uvp, bd718x7_set_buck_ovp);\n\n \nBD718XX_OPS(bd71837_pickable_range_ldo_ops,\n\t    regulator_list_voltage_pickable_linear_range, NULL,\n\t    bd71837_set_voltage_sel_pickable_restricted,\n\t    regulator_get_voltage_sel_pickable_regmap, NULL, NULL,\n\t    bd718x7_set_ldo_uvp, NULL);\n\nBD718XX_OPS(bd71837_pickable_range_buck_ops,\n\t    regulator_list_voltage_pickable_linear_range, NULL,\n\t    bd71837_set_voltage_sel_pickable_restricted,\n\t    regulator_get_voltage_sel_pickable_regmap,\n\t    regulator_set_voltage_time_sel, NULL, bd718x7_set_buck_uvp,\n\t    bd718x7_set_buck_ovp);\n\nBD718XX_OPS(bd71837_ldo_regulator_ops, regulator_list_voltage_linear_range,\n\t    NULL, rohm_regulator_set_voltage_sel_restricted,\n\t    regulator_get_voltage_sel_regmap, NULL, NULL, bd718x7_set_ldo_uvp,\n\t    NULL);\n\nBD718XX_OPS(bd71837_ldo_regulator_nolinear_ops, regulator_list_voltage_table,\n\t    NULL, rohm_regulator_set_voltage_sel_restricted,\n\t    regulator_get_voltage_sel_regmap, NULL, NULL, bd718x7_set_ldo_uvp,\n\t    NULL);\n\nBD718XX_OPS(bd71837_buck_regulator_ops, regulator_list_voltage_linear_range,\n\t    NULL, rohm_regulator_set_voltage_sel_restricted,\n\t    regulator_get_voltage_sel_regmap, regulator_set_voltage_time_sel,\n\t    NULL, bd718x7_set_buck_uvp, bd718x7_set_buck_ovp);\n\nBD718XX_OPS(bd71837_buck_regulator_nolinear_ops, regulator_list_voltage_table,\n\t    regulator_map_voltage_ascend, rohm_regulator_set_voltage_sel_restricted,\n\t    regulator_get_voltage_sel_regmap, regulator_set_voltage_time_sel,\n\t    NULL, bd718x7_set_buck_uvp, bd718x7_set_buck_ovp);\n \nstatic const struct regulator_ops bd71837_buck34_ops_hwctrl = {\n\t.is_enabled = bd71837_get_buck34_enable_hwctrl,\n\t.list_voltage = regulator_list_voltage_linear_range,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_time_sel = regulator_set_voltage_time_sel,\n\t.set_ramp_delay = regulator_set_ramp_delay_regmap,\n\t.set_under_voltage_protection = bd718x7_set_buck_uvp,\n\t.set_over_voltage_protection = bd718x7_set_buck_ovp,\n};\n\n \nBD718XX_OPS(bd718xx_dvs_buck_regulator_ops, regulator_list_voltage_linear_range,\n\t    NULL, regulator_set_voltage_sel_regmap,\n\t    regulator_get_voltage_sel_regmap, regulator_set_voltage_time_sel,\n\t    regulator_set_ramp_delay_regmap, bd718x7_set_buck_uvp,\n\t    bd718x7_set_buck_ovp);\n\n\n\n \nstatic const struct reg_init bd71837_ldo5_inits[] = {\n\t{\n\t\t.reg = BD718XX_REG_MVRFLTMASK2,\n\t\t.mask = BD718XX_LDO5_VRMON80,\n\t\t.val = BD718XX_LDO5_VRMON80,\n\t},\n};\n\nstatic const struct reg_init bd71837_ldo6_inits[] = {\n\t{\n\t\t.reg = BD718XX_REG_MVRFLTMASK2,\n\t\t.mask = BD718XX_LDO6_VRMON80,\n\t\t.val = BD718XX_LDO6_VRMON80,\n\t},\n};\n\nstatic int buck_set_hw_dvs_levels(struct device_node *np,\n\t\t\t    const struct regulator_desc *desc,\n\t\t\t    struct regulator_config *cfg)\n{\n\tstruct bd718xx_regulator_data *data;\n\n\tdata = container_of(desc, struct bd718xx_regulator_data, desc);\n\n\treturn rohm_regulator_set_dvs_levels(&data->dvs, np, desc, cfg->regmap);\n}\n\nstatic const struct regulator_ops *bd71847_swcontrol_ops[] = {\n\t&bd718xx_dvs_buck_regulator_ops, &bd718xx_dvs_buck_regulator_ops,\n\t&bd718xx_pickable_range_buck_ops, &bd718xx_pickable_range_buck_ops,\n\t&bd718xx_buck_regulator_nolinear_ops, &bd718xx_buck_regulator_ops,\n\t&bd718xx_pickable_range_ldo_ops, &bd718xx_ldo_regulator_nolinear_ops,\n\t&bd718xx_ldo_regulator_ops, &bd718xx_ldo_regulator_ops,\n\t&bd718xx_pickable_range_ldo_ops, &bd718xx_ldo_regulator_ops,\n};\n\nstatic const struct regulator_ops *bd71847_hwcontrol_ops[] = {\n\t&BD718XX_HWOPNAME(bd718xx_dvs_buck_regulator_ops),\n\t&BD718XX_HWOPNAME(bd718xx_dvs_buck_regulator_ops),\n\t&BD718XX_HWOPNAME(bd718xx_pickable_range_buck_ops),\n\t&BD718XX_HWOPNAME(bd718xx_pickable_range_buck_ops),\n\t&BD718XX_HWOPNAME(bd718xx_buck_regulator_nolinear_ops),\n\t&BD718XX_HWOPNAME(bd718xx_buck_regulator_ops),\n\t&BD718XX_HWOPNAME(bd718xx_pickable_range_ldo_ops),\n\t&BD718XX_HWOPNAME(bd718xx_ldo_regulator_nolinear_ops),\n\t&BD718XX_HWOPNAME(bd718xx_ldo_regulator_ops),\n\t&BD718XX_HWOPNAME(bd718xx_ldo_regulator_ops),\n\t&bd718xx_ldo5_ops_hwstate,\n\t&BD718XX_HWOPNAME(bd718xx_ldo_regulator_ops),\n};\n\nstatic struct bd718xx_regulator_data bd71847_regulators[] = {\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck1\",\n\t\t\t.of_match = of_match_ptr(\"BUCK1\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK1,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_DVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_dvs_buck_volts,\n\t\t\t.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(bd718xx_dvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_BUCK1_VOLT_RUN,\n\t\t\t.vsel_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.enable_reg = BD718XX_REG_BUCK1_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71847_BUCK1_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.ramp_delay_table = bd718xx_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd718xx_ramp_delay),\n\t\t\t.ramp_reg = BD718XX_REG_BUCK1_CTRL,\n\t\t\t.ramp_mask = BUCK_RAMPRATE_MASK,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND,\n\t\t\t.run_reg = BD718XX_REG_BUCK1_VOLT_RUN,\n\t\t\t.run_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.idle_reg = BD718XX_REG_BUCK1_VOLT_IDLE,\n\t\t\t.idle_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.suspend_reg = BD718XX_REG_BUCK1_VOLT_SUSP,\n\t\t\t.suspend_mask = DVS_BUCK_RUN_MASK,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_BUCK1_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck2\",\n\t\t\t.of_match = of_match_ptr(\"BUCK2\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK2,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_DVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_dvs_buck_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_dvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_BUCK2_VOLT_RUN,\n\t\t\t.vsel_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.enable_reg = BD718XX_REG_BUCK2_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71847_BUCK2_STARTUP_TIME,\n\t\t\t.ramp_delay_table = bd718xx_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd718xx_ramp_delay),\n\t\t\t.ramp_reg = BD718XX_REG_BUCK2_CTRL,\n\t\t\t.ramp_mask = BUCK_RAMPRATE_MASK,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE,\n\t\t\t.run_reg = BD718XX_REG_BUCK2_VOLT_RUN,\n\t\t\t.run_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.idle_reg = BD718XX_REG_BUCK2_VOLT_IDLE,\n\t\t\t.idle_mask = DVS_BUCK_RUN_MASK,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_BUCK2_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck3\",\n\t\t\t.of_match = of_match_ptr(\"BUCK3\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK3,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD71847_BUCK3_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd71847_buck3_volts,\n\t\t\t.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(bd71847_buck3_volts),\n\t\t\t.vsel_reg = BD718XX_REG_1ST_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD718XX_1ST_NODVS_BUCK_MASK,\n\t\t\t.vsel_range_reg = BD718XX_REG_1ST_NODVS_BUCK_VOLT,\n\t\t\t.vsel_range_mask = BD71847_BUCK3_RANGE_MASK,\n\t\t\t.linear_range_selectors_bitfield = bd71847_buck3_volt_range_sel,\n\t\t\t.enable_reg = BD718XX_REG_1ST_NODVS_BUCK_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71847_BUCK3_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_1ST_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck4\",\n\t\t\t.of_match = of_match_ptr(\"BUCK4\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK4,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD71847_BUCK4_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd71847_buck4_volts,\n\t\t\t.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(bd71847_buck4_volts),\n\t\t\t.enable_reg = BD718XX_REG_2ND_NODVS_BUCK_CTRL,\n\t\t\t.vsel_reg = BD718XX_REG_2ND_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD71847_BUCK4_MASK,\n\t\t\t.vsel_range_reg = BD718XX_REG_2ND_NODVS_BUCK_VOLT,\n\t\t\t.vsel_range_mask = BD71847_BUCK4_RANGE_MASK,\n\t\t\t.linear_range_selectors_bitfield = bd71847_buck4_volt_range_sel,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71847_BUCK4_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_2ND_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck5\",\n\t\t\t.of_match = of_match_ptr(\"BUCK5\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK5,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.volt_table = &bd718xx_3rd_nodvs_buck_volts[0],\n\t\t\t.n_voltages = ARRAY_SIZE(bd718xx_3rd_nodvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_3RD_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD718XX_3RD_NODVS_BUCK_MASK,\n\t\t\t.enable_reg = BD718XX_REG_3RD_NODVS_BUCK_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71847_BUCK5_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_3RD_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck6\",\n\t\t\t.of_match = of_match_ptr(\"BUCK6\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK6,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_4TH_NODVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_4th_nodvs_buck_volts,\n\t\t\t.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(bd718xx_4th_nodvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_4TH_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD718XX_4TH_NODVS_BUCK_MASK,\n\t\t\t.enable_reg = BD718XX_REG_4TH_NODVS_BUCK_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71847_BUCK6_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_4TH_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo1\",\n\t\t\t.of_match = of_match_ptr(\"LDO1\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO1,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO1_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo1_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo1_volts),\n\t\t\t.vsel_reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO1_MASK,\n\t\t\t.vsel_range_reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.vsel_range_mask = BD718XX_LDO1_RANGE_MASK,\n\t\t\t.linear_range_selectors_bitfield = bd718xx_ldo1_volt_range_sel,\n\t\t\t.enable_reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71847_LDO1_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo2\",\n\t\t\t.of_match = of_match_ptr(\"LDO2\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO2,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.volt_table = &ldo_2_volts[0],\n\t\t\t.vsel_reg = BD718XX_REG_LDO2_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO2_MASK,\n\t\t\t.n_voltages = ARRAY_SIZE(ldo_2_volts),\n\t\t\t.enable_reg = BD718XX_REG_LDO2_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71847_LDO2_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO2_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo3\",\n\t\t\t.of_match = of_match_ptr(\"LDO3\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO3,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO3_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo3_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo3_volts),\n\t\t\t.vsel_reg = BD718XX_REG_LDO3_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO3_MASK,\n\t\t\t.enable_reg = BD718XX_REG_LDO3_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71847_LDO3_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO3_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo4\",\n\t\t\t.of_match = of_match_ptr(\"LDO4\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO4,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO4_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo4_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo4_volts),\n\t\t\t.vsel_reg = BD718XX_REG_LDO4_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO4_MASK,\n\t\t\t.enable_reg = BD718XX_REG_LDO4_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71847_LDO4_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO4_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo5\",\n\t\t\t.of_match = of_match_ptr(\"LDO5\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO5,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD71847_LDO5_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd71847_ldo5_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71847_ldo5_volts),\n\t\t\t.vsel_reg = BD718XX_REG_LDO5_VOLT,\n\t\t\t.vsel_mask = BD71847_LDO5_MASK,\n\t\t\t.vsel_range_reg = BD718XX_REG_LDO5_VOLT,\n\t\t\t.vsel_range_mask = BD71847_LDO5_RANGE_MASK,\n\t\t\t.linear_range_selectors_bitfield = bd71847_ldo5_volt_range_sel,\n\t\t\t.enable_reg = BD718XX_REG_LDO5_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71847_LDO5_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO5_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo6\",\n\t\t\t.of_match = of_match_ptr(\"LDO6\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO6,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO6_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo6_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo6_volts),\n\t\t\t \n\t\t\t.supply_name = \"buck5\",\n\t\t\t.vsel_reg = BD718XX_REG_LDO6_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO6_MASK,\n\t\t\t.enable_reg = BD718XX_REG_LDO6_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71847_LDO6_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO6_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n};\n\nstatic const struct regulator_ops *bd71837_swcontrol_ops[] = {\n\t&bd718xx_dvs_buck_regulator_ops, &bd718xx_dvs_buck_regulator_ops,\n\t&bd718xx_dvs_buck_regulator_ops, &bd718xx_dvs_buck_regulator_ops,\n\t&bd71837_pickable_range_buck_ops, &bd71837_buck_regulator_ops,\n\t&bd71837_buck_regulator_nolinear_ops, &bd71837_buck_regulator_ops,\n\t&bd71837_pickable_range_ldo_ops, &bd71837_ldo_regulator_nolinear_ops,\n\t&bd71837_ldo_regulator_ops, &bd71837_ldo_regulator_ops,\n\t&bd71837_ldo_regulator_ops, &bd71837_ldo_regulator_ops,\n\t&bd71837_ldo_regulator_ops,\n};\n\nstatic const struct regulator_ops *bd71837_hwcontrol_ops[] = {\n\t&BD718XX_HWOPNAME(bd718xx_dvs_buck_regulator_ops),\n\t&BD718XX_HWOPNAME(bd718xx_dvs_buck_regulator_ops),\n\t&bd71837_buck34_ops_hwctrl, &bd71837_buck34_ops_hwctrl,\n\t&BD718XX_HWOPNAME(bd71837_pickable_range_buck_ops),\n\t&BD718XX_HWOPNAME(bd71837_buck_regulator_ops),\n\t&BD718XX_HWOPNAME(bd71837_buck_regulator_nolinear_ops),\n\t&BD718XX_HWOPNAME(bd71837_buck_regulator_ops),\n\t&BD718XX_HWOPNAME(bd71837_pickable_range_ldo_ops),\n\t&BD718XX_HWOPNAME(bd71837_ldo_regulator_nolinear_ops),\n\t&BD718XX_HWOPNAME(bd71837_ldo_regulator_ops),\n\t&BD718XX_HWOPNAME(bd71837_ldo_regulator_ops),\n\t&BD718XX_HWOPNAME(bd71837_ldo_regulator_ops),\n\t&BD718XX_HWOPNAME(bd71837_ldo_regulator_ops),\n\t&BD718XX_HWOPNAME(bd71837_ldo_regulator_ops),\n};\n\nstatic struct bd718xx_regulator_data bd71837_regulators[] = {\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck1\",\n\t\t\t.of_match = of_match_ptr(\"BUCK1\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK1,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_DVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_dvs_buck_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_dvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_BUCK1_VOLT_RUN,\n\t\t\t.vsel_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.enable_reg = BD718XX_REG_BUCK1_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK1_STARTUP_TIME,\n\t\t\t.ramp_delay_table = bd718xx_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd718xx_ramp_delay),\n\t\t\t.ramp_reg = BD718XX_REG_BUCK1_CTRL,\n\t\t\t.ramp_mask = BUCK_RAMPRATE_MASK,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE |\n\t\t\t\t     ROHM_DVS_LEVEL_SUSPEND,\n\t\t\t.run_reg = BD718XX_REG_BUCK1_VOLT_RUN,\n\t\t\t.run_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.idle_reg = BD718XX_REG_BUCK1_VOLT_IDLE,\n\t\t\t.idle_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.suspend_reg = BD718XX_REG_BUCK1_VOLT_SUSP,\n\t\t\t.suspend_mask = DVS_BUCK_RUN_MASK,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_BUCK1_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck2\",\n\t\t\t.of_match = of_match_ptr(\"BUCK2\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK2,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_DVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_dvs_buck_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_dvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_BUCK2_VOLT_RUN,\n\t\t\t.vsel_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.enable_reg = BD718XX_REG_BUCK2_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK2_STARTUP_TIME,\n\t\t\t.ramp_delay_table = bd718xx_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd718xx_ramp_delay),\n\t\t\t.ramp_reg = BD718XX_REG_BUCK2_CTRL,\n\t\t\t.ramp_mask = BUCK_RAMPRATE_MASK,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN | ROHM_DVS_LEVEL_IDLE,\n\t\t\t.run_reg = BD718XX_REG_BUCK2_VOLT_RUN,\n\t\t\t.run_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.idle_reg = BD718XX_REG_BUCK2_VOLT_IDLE,\n\t\t\t.idle_mask = DVS_BUCK_RUN_MASK,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_BUCK2_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck3\",\n\t\t\t.of_match = of_match_ptr(\"BUCK3\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK3,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_DVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_dvs_buck_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_dvs_buck_volts),\n\t\t\t.vsel_reg = BD71837_REG_BUCK3_VOLT_RUN,\n\t\t\t.vsel_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.enable_reg = BD71837_REG_BUCK3_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK3_STARTUP_TIME,\n\t\t\t.ramp_delay_table = bd718xx_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd718xx_ramp_delay),\n\t\t\t.ramp_reg = BD71837_REG_BUCK3_CTRL,\n\t\t\t.ramp_mask = BUCK_RAMPRATE_MASK,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN,\n\t\t\t.run_reg = BD71837_REG_BUCK3_VOLT_RUN,\n\t\t\t.run_mask = DVS_BUCK_RUN_MASK,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD71837_REG_BUCK3_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck4\",\n\t\t\t.of_match = of_match_ptr(\"BUCK4\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK4,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_DVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_dvs_buck_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_dvs_buck_volts),\n\t\t\t.vsel_reg = BD71837_REG_BUCK4_VOLT_RUN,\n\t\t\t.vsel_mask = DVS_BUCK_RUN_MASK,\n\t\t\t.enable_reg = BD71837_REG_BUCK4_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK4_STARTUP_TIME,\n\t\t\t.ramp_delay_table = bd718xx_ramp_delay,\n\t\t\t.n_ramp_values = ARRAY_SIZE(bd718xx_ramp_delay),\n\t\t\t.ramp_reg = BD71837_REG_BUCK4_CTRL,\n\t\t\t.ramp_mask = BUCK_RAMPRATE_MASK,\n\t\t\t.owner = THIS_MODULE,\n\t\t\t.of_parse_cb = buck_set_hw_dvs_levels,\n\t\t},\n\t\t.dvs = {\n\t\t\t.level_map = ROHM_DVS_LEVEL_RUN,\n\t\t\t.run_reg = BD71837_REG_BUCK4_VOLT_RUN,\n\t\t\t.run_mask = DVS_BUCK_RUN_MASK,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD71837_REG_BUCK4_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck5\",\n\t\t\t.of_match = of_match_ptr(\"BUCK5\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK5,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD71837_BUCK5_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd71837_buck5_volts,\n\t\t\t.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(bd71837_buck5_volts),\n\t\t\t.vsel_reg = BD718XX_REG_1ST_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD71837_BUCK5_MASK,\n\t\t\t.vsel_range_reg = BD718XX_REG_1ST_NODVS_BUCK_VOLT,\n\t\t\t.vsel_range_mask = BD71837_BUCK5_RANGE_MASK,\n\t\t\t.linear_range_selectors_bitfield = bd71837_buck5_volt_range_sel,\n\t\t\t.enable_reg = BD718XX_REG_1ST_NODVS_BUCK_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK5_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_1ST_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck6\",\n\t\t\t.of_match = of_match_ptr(\"BUCK6\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK6,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD71837_BUCK6_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd71837_buck6_volts,\n\t\t\t.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(bd71837_buck6_volts),\n\t\t\t.vsel_reg = BD718XX_REG_2ND_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD71837_BUCK6_MASK,\n\t\t\t.enable_reg = BD718XX_REG_2ND_NODVS_BUCK_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK6_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_2ND_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck7\",\n\t\t\t.of_match = of_match_ptr(\"BUCK7\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK7,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.volt_table = &bd718xx_3rd_nodvs_buck_volts[0],\n\t\t\t.n_voltages = ARRAY_SIZE(bd718xx_3rd_nodvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_3RD_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD718XX_3RD_NODVS_BUCK_MASK,\n\t\t\t.enable_reg = BD718XX_REG_3RD_NODVS_BUCK_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK7_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_3RD_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"buck8\",\n\t\t\t.of_match = of_match_ptr(\"BUCK8\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_BUCK8,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_4TH_NODVS_BUCK_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_4th_nodvs_buck_volts,\n\t\t\t.n_linear_ranges =\n\t\t\t\tARRAY_SIZE(bd718xx_4th_nodvs_buck_volts),\n\t\t\t.vsel_reg = BD718XX_REG_4TH_NODVS_BUCK_VOLT,\n\t\t\t.vsel_mask = BD718XX_4TH_NODVS_BUCK_MASK,\n\t\t\t.enable_reg = BD718XX_REG_4TH_NODVS_BUCK_CTRL,\n\t\t\t.enable_mask = BD718XX_BUCK_EN,\n\t\t\t.enable_time = BD71837_BUCK8_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_4TH_NODVS_BUCK_CTRL,\n\t\t\t.mask = BD718XX_BUCK_SEL,\n\t\t\t.val = BD718XX_BUCK_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo1\",\n\t\t\t.of_match = of_match_ptr(\"LDO1\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO1,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO1_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo1_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo1_volts),\n\t\t\t.vsel_reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO1_MASK,\n\t\t\t.vsel_range_reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.vsel_range_mask = BD718XX_LDO1_RANGE_MASK,\n\t\t\t.linear_range_selectors_bitfield = bd718xx_ldo1_volt_range_sel,\n\t\t\t.enable_reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71837_LDO1_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO1_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo2\",\n\t\t\t.of_match = of_match_ptr(\"LDO2\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO2,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.volt_table = &ldo_2_volts[0],\n\t\t\t.vsel_reg = BD718XX_REG_LDO2_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO2_MASK,\n\t\t\t.n_voltages = ARRAY_SIZE(ldo_2_volts),\n\t\t\t.enable_reg = BD718XX_REG_LDO2_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71837_LDO2_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO2_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo3\",\n\t\t\t.of_match = of_match_ptr(\"LDO3\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO3,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO3_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo3_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo3_volts),\n\t\t\t.vsel_reg = BD718XX_REG_LDO3_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO3_MASK,\n\t\t\t.enable_reg = BD718XX_REG_LDO3_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71837_LDO3_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO3_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo4\",\n\t\t\t.of_match = of_match_ptr(\"LDO4\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO4,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO4_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo4_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo4_volts),\n\t\t\t.vsel_reg = BD718XX_REG_LDO4_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO4_MASK,\n\t\t\t.enable_reg = BD718XX_REG_LDO4_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71837_LDO4_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO4_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo5\",\n\t\t\t.of_match = of_match_ptr(\"LDO5\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO5,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD71837_LDO5_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd71837_ldo5_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71837_ldo5_volts),\n\t\t\t \n\t\t\t.supply_name = \"buck6\",\n\t\t\t.vsel_reg = BD718XX_REG_LDO5_VOLT,\n\t\t\t.vsel_mask = BD71837_LDO5_MASK,\n\t\t\t.enable_reg = BD718XX_REG_LDO5_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71837_LDO5_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO5_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t\t.additional_inits = bd71837_ldo5_inits,\n\t\t.additional_init_amnt = ARRAY_SIZE(bd71837_ldo5_inits),\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo6\",\n\t\t\t.of_match = of_match_ptr(\"LDO6\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO6,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD718XX_LDO6_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd718xx_ldo6_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd718xx_ldo6_volts),\n\t\t\t \n\t\t\t.supply_name = \"buck7\",\n\t\t\t.vsel_reg = BD718XX_REG_LDO6_VOLT,\n\t\t\t.vsel_mask = BD718XX_LDO6_MASK,\n\t\t\t.enable_reg = BD718XX_REG_LDO6_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71837_LDO6_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD718XX_REG_LDO6_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t\t.additional_inits = bd71837_ldo6_inits,\n\t\t.additional_init_amnt = ARRAY_SIZE(bd71837_ldo6_inits),\n\t},\n\t{\n\t\t.desc = {\n\t\t\t.name = \"ldo7\",\n\t\t\t.of_match = of_match_ptr(\"LDO7\"),\n\t\t\t.regulators_node = of_match_ptr(\"regulators\"),\n\t\t\t.id = BD718XX_LDO7,\n\t\t\t.type = REGULATOR_VOLTAGE,\n\t\t\t.n_voltages = BD71837_LDO7_VOLTAGE_NUM,\n\t\t\t.linear_ranges = bd71837_ldo7_volts,\n\t\t\t.n_linear_ranges = ARRAY_SIZE(bd71837_ldo7_volts),\n\t\t\t.vsel_reg = BD71837_REG_LDO7_VOLT,\n\t\t\t.vsel_mask = BD71837_LDO7_MASK,\n\t\t\t.enable_reg = BD71837_REG_LDO7_VOLT,\n\t\t\t.enable_mask = BD718XX_LDO_EN,\n\t\t\t.enable_time = BD71837_LDO7_STARTUP_TIME,\n\t\t\t.owner = THIS_MODULE,\n\t\t},\n\t\t.init = {\n\t\t\t.reg = BD71837_REG_LDO7_VOLT,\n\t\t\t.mask = BD718XX_LDO_SEL,\n\t\t\t.val = BD718XX_LDO_SEL,\n\t\t},\n\t},\n};\n\nstatic void mark_hw_controlled(struct device *dev, struct device_node *np,\n\t\t\t       struct bd718xx_regulator_data *reg_data,\n\t\t\t       unsigned int num_reg_data, int *info)\n{\n\tint i;\n\n\tfor (i = 1; i <= num_reg_data; i++) {\n\t\tif (!of_node_name_eq(np, reg_data[i-1].desc.of_match))\n\t\t\tcontinue;\n\n\t\t*info |= 1 << (i - 1);\n\t\tdev_dbg(dev, \"regulator %d runlevel controlled\\n\", i);\n\t\treturn;\n\t}\n\tdev_warn(dev, \"Bad regulator node\\n\");\n}\n\n \nstatic int setup_feedback_loop(struct device *dev, struct device_node *np,\n\t\t\t       struct bd718xx_regulator_data *reg_data,\n\t\t\t       unsigned int num_reg_data, int fb_uv)\n{\n\tint i, r1, r2, ret;\n\n\t \n\n\tfor (i = 0; i < num_reg_data; i++) {\n\t\tstruct regulator_desc *desc = &reg_data[i].desc;\n\t\tint j;\n\n\t\tif (!of_node_name_eq(np, desc->of_match))\n\t\t\tcontinue;\n\n\t\t \n\t\tif (desc->id >= BD718XX_LDO1)\n\t\t\treturn -EINVAL;\n\n\t\tret = of_property_read_u32(np, \"rohm,feedback-pull-up-r1-ohms\",\n\t\t\t\t\t   &r1);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (!r1)\n\t\t\treturn -EINVAL;\n\n\t\tret = of_property_read_u32(np, \"rohm,feedback-pull-up-r2-ohms\",\n\t\t\t\t\t   &r2);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tif (desc->n_linear_ranges && desc->linear_ranges) {\n\t\t\tstruct linear_range *new;\n\n\t\t\tnew = devm_kzalloc(dev, desc->n_linear_ranges *\n\t\t\t\t\t   sizeof(struct linear_range),\n\t\t\t\t\t   GFP_KERNEL);\n\t\t\tif (!new)\n\t\t\t\treturn -ENOMEM;\n\n\t\t\tfor (j = 0; j < desc->n_linear_ranges; j++) {\n\t\t\t\tint min = desc->linear_ranges[j].min;\n\t\t\t\tint step = desc->linear_ranges[j].step;\n\n\t\t\t\tmin -= (fb_uv - min)*r2/r1;\n\t\t\t\tstep = step * (r1 + r2);\n\t\t\t\tstep /= r1;\n\n\t\t\t\tnew[j].min = min;\n\t\t\t\tnew[j].step = step;\n\n\t\t\t\tdev_dbg(dev, \"%s: old range min %d, step %d\\n\",\n\t\t\t\t\tdesc->name, desc->linear_ranges[j].min,\n\t\t\t\t\tdesc->linear_ranges[j].step);\n\t\t\t\tdev_dbg(dev, \"new range min %d, step %d\\n\", min,\n\t\t\t\t\tstep);\n\t\t\t}\n\t\t\tdesc->linear_ranges = new;\n\t\t}\n\t\tdev_dbg(dev, \"regulator '%s' has FB pull-up configured\\n\",\n\t\t\tdesc->name);\n\n\t\treturn 0;\n\t}\n\n\treturn -ENODEV;\n}\n\nstatic int get_special_regulators(struct device *dev,\n\t\t\t\t  struct bd718xx_regulator_data *reg_data,\n\t\t\t\t  unsigned int num_reg_data, int *info)\n{\n\tint ret;\n\tstruct device_node *np;\n\tstruct device_node *nproot = dev->of_node;\n\tint uv;\n\n\t*info = 0;\n\n\tnproot = of_get_child_by_name(nproot, \"regulators\");\n\tif (!nproot) {\n\t\tdev_err(dev, \"failed to find regulators node\\n\");\n\t\treturn -ENODEV;\n\t}\n\tfor_each_child_of_node(nproot, np) {\n\t\tif (of_property_read_bool(np, \"rohm,no-regulator-enable-control\"))\n\t\t\tmark_hw_controlled(dev, np, reg_data, num_reg_data,\n\t\t\t\t\t   info);\n\t\tret = of_property_read_u32(np, \"rohm,fb-pull-up-microvolt\",\n\t\t\t\t\t   &uv);\n\t\tif (ret) {\n\t\t\tif (ret == -EINVAL)\n\t\t\t\tcontinue;\n\t\t\telse\n\t\t\t\tgoto err_out;\n\t\t}\n\n\t\tret = setup_feedback_loop(dev, np, reg_data, num_reg_data, uv);\n\t\tif (ret)\n\t\t\tgoto err_out;\n\t}\n\n\tof_node_put(nproot);\n\treturn 0;\n\nerr_out:\n\tof_node_put(np);\n\tof_node_put(nproot);\n\n\treturn ret;\n}\n\nstatic int bd718xx_probe(struct platform_device *pdev)\n{\n\tstruct regmap *regmap;\n\tstruct regulator_config config = { 0 };\n\tint i, j, err, omit_enable;\n\tbool use_snvs;\n\tstruct bd718xx_regulator_data *reg_data;\n\tunsigned int num_reg_data;\n\tenum rohm_chip_type chip = platform_get_device_id(pdev)->driver_data;\n\tconst struct regulator_ops **swops, **hwops;\n\n\tregmap = dev_get_regmap(pdev->dev.parent, NULL);\n\tif (!regmap) {\n\t\tdev_err(&pdev->dev, \"No MFD driver data\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tswitch (chip) {\n\tcase ROHM_CHIP_TYPE_BD71837:\n\t\treg_data = bd71837_regulators;\n\t\tnum_reg_data = ARRAY_SIZE(bd71837_regulators);\n\t\tswops = &bd71837_swcontrol_ops[0];\n\t\thwops = &bd71837_hwcontrol_ops[0];\n\t\tbreak;\n\tcase ROHM_CHIP_TYPE_BD71847:\n\t\treg_data = bd71847_regulators;\n\t\tnum_reg_data = ARRAY_SIZE(bd71847_regulators);\n\t\tswops = &bd71847_swcontrol_ops[0];\n\t\thwops = &bd71847_hwcontrol_ops[0];\n\t\tbreak;\n\tdefault:\n\t\tdev_err(&pdev->dev, \"Unsupported chip type\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\t \n\terr = regmap_update_bits(regmap, BD718XX_REG_REGLOCK,\n\t\t\t\t (REGLOCK_PWRSEQ | REGLOCK_VREG), 0);\n\tif (err)\n\t\treturn dev_err_probe(&pdev->dev, err, \"Failed to unlock PMIC\\n\");\n\n\tdev_dbg(&pdev->dev, \"Unlocked lock register 0x%x\\n\",\n\t\tBD718XX_REG_REGLOCK);\n\n\tuse_snvs = of_property_read_bool(pdev->dev.parent->of_node,\n\t\t\t\t\t \"rohm,reset-snvs-powered\");\n\n\t \n\tif (!use_snvs) {\n\t\terr = regmap_update_bits(regmap, BD718XX_REG_TRANS_COND1,\n\t\t\t\t\t BD718XX_ON_REQ_POWEROFF_MASK |\n\t\t\t\t\t BD718XX_SWRESET_POWEROFF_MASK |\n\t\t\t\t\t BD718XX_WDOG_POWEROFF_MASK |\n\t\t\t\t\t BD718XX_KEY_L_POWEROFF_MASK,\n\t\t\t\t\t BD718XX_POWOFF_TO_RDY);\n\t\tif (err)\n\t\t\treturn dev_err_probe(&pdev->dev, err,\n\t\t\t\t\t     \"Failed to change reset target\\n\");\n\n\t\tdev_dbg(&pdev->dev, \"Changed all resets from SVNS to READY\\n\");\n\t}\n\n\tconfig.dev = pdev->dev.parent;\n\tconfig.regmap = regmap;\n\t \n\terr = get_special_regulators(pdev->dev.parent, reg_data, num_reg_data,\n\t\t\t\t     &omit_enable);\n\tif (err)\n\t\treturn err;\n\n\tfor (i = 0; i < num_reg_data; i++) {\n\n\t\tstruct regulator_desc *desc;\n\t\tstruct regulator_dev *rdev;\n\t\tstruct bd718xx_regulator_data *r;\n\t\tint no_enable_control = omit_enable & (1 << i);\n\n\t\tr = &reg_data[i];\n\t\tdesc = &r->desc;\n\n\t\tif (no_enable_control)\n\t\t\tdesc->ops = hwops[i];\n\t\telse\n\t\t\tdesc->ops = swops[i];\n\n\t\trdev = devm_regulator_register(&pdev->dev, desc, &config);\n\t\tif (IS_ERR(rdev))\n\t\t\treturn dev_err_probe(&pdev->dev, PTR_ERR(rdev),\n\t\t\t\t\t     \"failed to register %s regulator\\n\",\n\t\t\t\t\t     desc->name);\n\n\t\t \n\t\tif (!no_enable_control && (!use_snvs ||\n\t\t    !rdev->constraints->always_on ||\n\t\t    !rdev->constraints->boot_on)) {\n\t\t\terr = regmap_update_bits(regmap, r->init.reg,\n\t\t\t\t\t\t r->init.mask, r->init.val);\n\t\t\tif (err)\n\t\t\t\treturn dev_err_probe(&pdev->dev, err,\n\t\t\t\t\t\"Failed to take control for (%s)\\n\",\n\t\t\t\t\tdesc->name);\n\t\t}\n\t\tfor (j = 0; j < r->additional_init_amnt; j++) {\n\t\t\terr = regmap_update_bits(regmap,\n\t\t\t\t\t\t r->additional_inits[j].reg,\n\t\t\t\t\t\t r->additional_inits[j].mask,\n\t\t\t\t\t\t r->additional_inits[j].val);\n\t\t\tif (err)\n\t\t\t\treturn dev_err_probe(&pdev->dev, err,\n\t\t\t\t\t\"Buck (%s) initialization failed\\n\",\n\t\t\t\t\tdesc->name);\n\t\t}\n\t}\n\n\treturn err;\n}\n\nstatic const struct platform_device_id bd718x7_pmic_id[] = {\n\t{ \"bd71837-pmic\", ROHM_CHIP_TYPE_BD71837 },\n\t{ \"bd71847-pmic\", ROHM_CHIP_TYPE_BD71847 },\n\t{ },\n};\nMODULE_DEVICE_TABLE(platform, bd718x7_pmic_id);\n\nstatic struct platform_driver bd718xx_regulator = {\n\t.driver = {\n\t\t.name = \"bd718xx-pmic\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t},\n\t.probe = bd718xx_probe,\n\t.id_table = bd718x7_pmic_id,\n};\n\nmodule_platform_driver(bd718xx_regulator);\n\nMODULE_AUTHOR(\"Matti Vaittinen <matti.vaittinen@fi.rohmeurope.com>\");\nMODULE_DESCRIPTION(\"BD71837/BD71847 voltage regulator driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:bd718xx-pmic\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}