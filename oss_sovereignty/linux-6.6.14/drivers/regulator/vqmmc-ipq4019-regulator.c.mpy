{
  "module_name": "vqmmc-ipq4019-regulator.c",
  "hash_id": "eebccca7d255cf8c34fbd6ddab93e4f2064f62ebe04ca4e35700a152798feb8d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/regulator/vqmmc-ipq4019-regulator.c",
  "human_readable_source": "\n\n\n\n\n\n\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/regulator/driver.h>\n#include <linux/regulator/machine.h>\n#include <linux/regulator/of_regulator.h>\n\nstatic const unsigned int ipq4019_vmmc_voltages[] = {\n\t1500000, 1800000, 2500000, 3000000,\n};\n\nstatic const struct regulator_ops ipq4019_regulator_voltage_ops = {\n\t.list_voltage = regulator_list_voltage_table,\n\t.map_voltage = regulator_map_voltage_ascend,\n\t.get_voltage_sel = regulator_get_voltage_sel_regmap,\n\t.set_voltage_sel = regulator_set_voltage_sel_regmap,\n};\n\nstatic const struct regulator_desc vmmc_regulator = {\n\t.name\t\t= \"vmmcq\",\n\t.ops\t\t= &ipq4019_regulator_voltage_ops,\n\t.type\t\t= REGULATOR_VOLTAGE,\n\t.owner\t\t= THIS_MODULE,\n\t.volt_table\t= ipq4019_vmmc_voltages,\n\t.n_voltages\t= ARRAY_SIZE(ipq4019_vmmc_voltages),\n\t.vsel_reg\t= 0,\n\t.vsel_mask\t= 0x3,\n};\n\nstatic const struct regmap_config ipq4019_vmmcq_regmap_config = {\n\t.reg_bits\t= 32,\n\t.reg_stride\t= 4,\n\t.val_bits\t= 32,\n};\n\nstatic int ipq4019_regulator_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct regulator_init_data *init_data;\n\tstruct regulator_config cfg = {};\n\tstruct regulator_dev *rdev;\n\tstruct regmap *rmap;\n\tvoid __iomem *base;\n\n\tinit_data = of_get_regulator_init_data(dev, dev->of_node,\n\t\t\t\t\t       &vmmc_regulator);\n\tif (!init_data)\n\t\treturn -EINVAL;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\trmap = devm_regmap_init_mmio(dev, base, &ipq4019_vmmcq_regmap_config);\n\tif (IS_ERR(rmap))\n\t\treturn PTR_ERR(rmap);\n\n\tcfg.dev = dev;\n\tcfg.init_data = init_data;\n\tcfg.of_node = dev->of_node;\n\tcfg.regmap = rmap;\n\n\trdev = devm_regulator_register(dev, &vmmc_regulator, &cfg);\n\tif (IS_ERR(rdev)) {\n\t\tdev_err(dev, \"Failed to register regulator: %ld\\n\",\n\t\t\tPTR_ERR(rdev));\n\t\treturn PTR_ERR(rdev);\n\t}\n\tplatform_set_drvdata(pdev, rdev);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id regulator_ipq4019_of_match[] = {\n\t{ .compatible = \"qcom,vqmmc-ipq4019-regulator\", },\n\t{},\n};\n\nstatic struct platform_driver ipq4019_regulator_driver = {\n\t.probe = ipq4019_regulator_probe,\n\t.driver = {\n\t\t.name = \"vqmmc-ipq4019-regulator\",\n\t\t.probe_type = PROBE_PREFER_ASYNCHRONOUS,\n\t\t.of_match_table = of_match_ptr(regulator_ipq4019_of_match),\n\t},\n};\nmodule_platform_driver(ipq4019_regulator_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Mantas Pucka <mantas@8devices.com>\");\nMODULE_DESCRIPTION(\"IPQ4019 VQMMC voltage regulator\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}