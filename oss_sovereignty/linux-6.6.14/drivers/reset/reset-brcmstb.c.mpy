{
  "module_name": "reset-brcmstb.c",
  "hash_id": "b4f1d12e7e79bf7dfac976d93e223cd13945838da197908f3ab11f08c74d0121",
  "original_prompt": "Ingested from linux-6.6.14/drivers/reset/reset-brcmstb.c",
  "human_readable_source": "\n \n#include <linux/delay.h>\n#include <linux/device.h>\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/reset-controller.h>\n#include <linux/types.h>\n\nstruct brcmstb_reset {\n\tvoid __iomem *base;\n\tstruct reset_controller_dev rcdev;\n};\n\n#define SW_INIT_SET\t\t0x00\n#define SW_INIT_CLEAR\t\t0x04\n#define SW_INIT_STATUS\t\t0x08\n\n#define SW_INIT_BIT(id)\t\tBIT((id) & 0x1f)\n#define SW_INIT_BANK(id)\t((id) >> 5)\n\n \n#define SW_INIT_BANK_SIZE\t0x18\n\nstatic inline\nstruct brcmstb_reset *to_brcmstb(struct reset_controller_dev *rcdev)\n{\n\treturn container_of(rcdev, struct brcmstb_reset, rcdev);\n}\n\nstatic int brcmstb_reset_assert(struct reset_controller_dev *rcdev,\n\t\t\t\tunsigned long id)\n{\n\tunsigned int off = SW_INIT_BANK(id) * SW_INIT_BANK_SIZE;\n\tstruct brcmstb_reset *priv = to_brcmstb(rcdev);\n\n\twritel_relaxed(SW_INIT_BIT(id), priv->base + off + SW_INIT_SET);\n\n\treturn 0;\n}\n\nstatic int brcmstb_reset_deassert(struct reset_controller_dev *rcdev,\n\t\t\t\t  unsigned long id)\n{\n\tunsigned int off = SW_INIT_BANK(id) * SW_INIT_BANK_SIZE;\n\tstruct brcmstb_reset *priv = to_brcmstb(rcdev);\n\n\twritel_relaxed(SW_INIT_BIT(id), priv->base + off + SW_INIT_CLEAR);\n\t \n\tusleep_range(100, 200);\n\n\treturn 0;\n}\n\nstatic int brcmstb_reset_status(struct reset_controller_dev *rcdev,\n\t\t\t\tunsigned long id)\n{\n\tunsigned int off = SW_INIT_BANK(id) * SW_INIT_BANK_SIZE;\n\tstruct brcmstb_reset *priv = to_brcmstb(rcdev);\n\n\treturn readl_relaxed(priv->base + off + SW_INIT_STATUS) &\n\t\t\t     SW_INIT_BIT(id);\n}\n\nstatic const struct reset_control_ops brcmstb_reset_ops = {\n\t.assert\t= brcmstb_reset_assert,\n\t.deassert = brcmstb_reset_deassert,\n\t.status = brcmstb_reset_status,\n};\n\nstatic int brcmstb_reset_probe(struct platform_device *pdev)\n{\n\tstruct device *kdev = &pdev->dev;\n\tstruct brcmstb_reset *priv;\n\tstruct resource *res;\n\n\tpriv = devm_kzalloc(kdev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\tpriv->base = devm_ioremap_resource(kdev, res);\n\tif (IS_ERR(priv->base))\n\t\treturn PTR_ERR(priv->base);\n\n\tdev_set_drvdata(kdev, priv);\n\n\tpriv->rcdev.owner = THIS_MODULE;\n\tpriv->rcdev.nr_resets = DIV_ROUND_DOWN_ULL(resource_size(res),\n\t\t\t\t\t\t   SW_INIT_BANK_SIZE) * 32;\n\tpriv->rcdev.ops = &brcmstb_reset_ops;\n\tpriv->rcdev.of_node = kdev->of_node;\n\t \n\n\treturn devm_reset_controller_register(kdev, &priv->rcdev);\n}\n\nstatic const struct of_device_id brcmstb_reset_of_match[] = {\n\t{ .compatible = \"brcm,brcmstb-reset\" },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, brcmstb_reset_of_match);\n\nstatic struct platform_driver brcmstb_reset_driver = {\n\t.probe\t= brcmstb_reset_probe,\n\t.driver\t= {\n\t\t.name = \"brcmstb-reset\",\n\t\t.of_match_table = brcmstb_reset_of_match,\n\t},\n};\nmodule_platform_driver(brcmstb_reset_driver);\n\nMODULE_AUTHOR(\"Broadcom\");\nMODULE_DESCRIPTION(\"Broadcom STB reset controller\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}