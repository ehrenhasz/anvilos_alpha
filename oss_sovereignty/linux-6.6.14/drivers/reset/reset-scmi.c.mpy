{
  "module_name": "reset-scmi.c",
  "hash_id": "dc4abccc020e5d3067259ac781377400d7cceb6f907d21e703d8da9c4b3e6a48",
  "original_prompt": "Ingested from linux-6.6.14/drivers/reset/reset-scmi.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/device.h>\n#include <linux/reset-controller.h>\n#include <linux/scmi_protocol.h>\n\nstatic const struct scmi_reset_proto_ops *reset_ops;\n\n \nstruct scmi_reset_data {\n\tstruct reset_controller_dev rcdev;\n\tconst struct scmi_protocol_handle *ph;\n};\n\n#define to_scmi_reset_data(p)\tcontainer_of((p), struct scmi_reset_data, rcdev)\n#define to_scmi_handle(p)\t(to_scmi_reset_data(p)->ph)\n\n \nstatic int\nscmi_reset_assert(struct reset_controller_dev *rcdev, unsigned long id)\n{\n\tconst struct scmi_protocol_handle *ph = to_scmi_handle(rcdev);\n\n\treturn reset_ops->assert(ph, id);\n}\n\n \nstatic int\nscmi_reset_deassert(struct reset_controller_dev *rcdev, unsigned long id)\n{\n\tconst struct scmi_protocol_handle *ph = to_scmi_handle(rcdev);\n\n\treturn reset_ops->deassert(ph, id);\n}\n\n \nstatic int\nscmi_reset_reset(struct reset_controller_dev *rcdev, unsigned long id)\n{\n\tconst struct scmi_protocol_handle *ph = to_scmi_handle(rcdev);\n\n\treturn reset_ops->reset(ph, id);\n}\n\nstatic const struct reset_control_ops scmi_reset_ops = {\n\t.assert\t\t= scmi_reset_assert,\n\t.deassert\t= scmi_reset_deassert,\n\t.reset\t\t= scmi_reset_reset,\n};\n\nstatic int scmi_reset_probe(struct scmi_device *sdev)\n{\n\tstruct scmi_reset_data *data;\n\tstruct device *dev = &sdev->dev;\n\tstruct device_node *np = dev->of_node;\n\tconst struct scmi_handle *handle = sdev->handle;\n\tstruct scmi_protocol_handle *ph;\n\n\tif (!handle)\n\t\treturn -ENODEV;\n\n\treset_ops = handle->devm_protocol_get(sdev, SCMI_PROTOCOL_RESET, &ph);\n\tif (IS_ERR(reset_ops))\n\t\treturn PTR_ERR(reset_ops);\n\n\tdata = devm_kzalloc(dev, sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tdata->rcdev.ops = &scmi_reset_ops;\n\tdata->rcdev.owner = THIS_MODULE;\n\tdata->rcdev.of_node = np;\n\tdata->rcdev.nr_resets = reset_ops->num_domains_get(ph);\n\tdata->ph = ph;\n\n\treturn devm_reset_controller_register(dev, &data->rcdev);\n}\n\nstatic const struct scmi_device_id scmi_id_table[] = {\n\t{ SCMI_PROTOCOL_RESET, \"reset\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(scmi, scmi_id_table);\n\nstatic struct scmi_driver scmi_reset_driver = {\n\t.name = \"scmi-reset\",\n\t.probe = scmi_reset_probe,\n\t.id_table = scmi_id_table,\n};\nmodule_scmi_driver(scmi_reset_driver);\n\nMODULE_AUTHOR(\"Sudeep Holla <sudeep.holla@arm.com>\");\nMODULE_DESCRIPTION(\"ARM SCMI reset controller driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}