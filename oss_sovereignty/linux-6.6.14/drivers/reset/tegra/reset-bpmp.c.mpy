{
  "module_name": "reset-bpmp.c",
  "hash_id": "a2b41eaa58213f31b70a63533668bacf340567971802224f6513aae4882baaf2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/reset/tegra/reset-bpmp.c",
  "human_readable_source": "\n \n\n#include <linux/reset-controller.h>\n\n#include <soc/tegra/bpmp.h>\n#include <soc/tegra/bpmp-abi.h>\n\nstatic struct tegra_bpmp *to_tegra_bpmp(struct reset_controller_dev *rstc)\n{\n\treturn container_of(rstc, struct tegra_bpmp, rstc);\n}\n\nstatic int tegra_bpmp_reset_common(struct reset_controller_dev *rstc,\n\t\t\t\t   enum mrq_reset_commands command,\n\t\t\t\t   unsigned int id)\n{\n\tstruct tegra_bpmp *bpmp = to_tegra_bpmp(rstc);\n\tstruct mrq_reset_request request;\n\tstruct tegra_bpmp_message msg;\n\tint err;\n\n\tmemset(&request, 0, sizeof(request));\n\trequest.cmd = command;\n\trequest.reset_id = id;\n\n\tmemset(&msg, 0, sizeof(msg));\n\tmsg.mrq = MRQ_RESET;\n\tmsg.tx.data = &request;\n\tmsg.tx.size = sizeof(request);\n\n\terr = tegra_bpmp_transfer(bpmp, &msg);\n\tif (err)\n\t\treturn err;\n\tif (msg.rx.ret)\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nstatic int tegra_bpmp_reset_module(struct reset_controller_dev *rstc,\n\t\t\t\t   unsigned long id)\n{\n\treturn tegra_bpmp_reset_common(rstc, CMD_RESET_MODULE, id);\n}\n\nstatic int tegra_bpmp_reset_assert(struct reset_controller_dev *rstc,\n\t\t\t\t   unsigned long id)\n{\n\treturn tegra_bpmp_reset_common(rstc, CMD_RESET_ASSERT, id);\n}\n\nstatic int tegra_bpmp_reset_deassert(struct reset_controller_dev *rstc,\n\t\t\t\t     unsigned long id)\n{\n\treturn tegra_bpmp_reset_common(rstc, CMD_RESET_DEASSERT, id);\n}\n\nstatic const struct reset_control_ops tegra_bpmp_reset_ops = {\n\t.reset = tegra_bpmp_reset_module,\n\t.assert = tegra_bpmp_reset_assert,\n\t.deassert = tegra_bpmp_reset_deassert,\n};\n\nint tegra_bpmp_init_resets(struct tegra_bpmp *bpmp)\n{\n\tbpmp->rstc.ops = &tegra_bpmp_reset_ops;\n\tbpmp->rstc.owner = THIS_MODULE;\n\tbpmp->rstc.of_node = bpmp->dev->of_node;\n\tbpmp->rstc.nr_resets = bpmp->soc->num_resets;\n\n\treturn devm_reset_controller_register(bpmp->dev, &bpmp->rstc);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}