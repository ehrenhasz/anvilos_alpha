{
  "module_name": "reset-stih407.c",
  "hash_id": "d89d527177e27fb394fdd29bdd015c74d54ec62ee146330bb3a6618448b13cd7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/reset/sti/reset-stih407.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_platform.h>\n#include <linux/platform_device.h>\n#include <dt-bindings/reset/stih407-resets.h>\n#include \"reset-syscfg.h\"\n\n \nstatic const char stih407_core[] = \"st,stih407-core-syscfg\";\nstatic const char stih407_sbc_reg[] = \"st,stih407-sbc-reg-syscfg\";\nstatic const char stih407_lpm[] = \"st,stih407-lpm-syscfg\";\n\n#define STIH407_PDN_0(_bit) \\\n\t_SYSCFG_RST_CH(stih407_core, SYSCFG_5000, _bit, SYSSTAT_5500, _bit)\n#define STIH407_PDN_1(_bit) \\\n\t_SYSCFG_RST_CH(stih407_core, SYSCFG_5001, _bit, SYSSTAT_5501, _bit)\n#define STIH407_PDN_ETH(_bit, _stat) \\\n\t_SYSCFG_RST_CH(stih407_sbc_reg, SYSCFG_4032, _bit, SYSSTAT_4520, _stat)\n\n \n#define SYSCFG_5000\t0x0\n#define SYSSTAT_5500\t0x7d0\n \n#define SYSCFG_5001\t0x4\n#define SYSSTAT_5501\t0x7d4\n\n \n#define SYSCFG_4032\t0x80\n#define SYSSTAT_4520\t0x820\n#define SYSCFG_4002\t0x8\n\nstatic const struct syscfg_reset_channel_data stih407_powerdowns[] = {\n\t[STIH407_EMISS_POWERDOWN] = STIH407_PDN_0(1),\n\t[STIH407_NAND_POWERDOWN] = STIH407_PDN_0(0),\n\t[STIH407_USB3_POWERDOWN] = STIH407_PDN_1(6),\n\t[STIH407_USB2_PORT1_POWERDOWN] = STIH407_PDN_1(5),\n\t[STIH407_USB2_PORT0_POWERDOWN] = STIH407_PDN_1(4),\n\t[STIH407_PCIE1_POWERDOWN] = STIH407_PDN_1(3),\n\t[STIH407_PCIE0_POWERDOWN] = STIH407_PDN_1(2),\n\t[STIH407_SATA1_POWERDOWN] = STIH407_PDN_1(1),\n\t[STIH407_SATA0_POWERDOWN] = STIH407_PDN_1(0),\n\t[STIH407_ETH1_POWERDOWN] = STIH407_PDN_ETH(0, 2),\n};\n\n \n#define SYSCFG_5128\t0x200\n#define SYSCFG_5131\t0x20c\n#define SYSCFG_5132\t0x210\n\n#define LPM_SYSCFG_1\t0x4\t \n\n#define STIH407_SRST_CORE(_reg, _bit) \\\n\t_SYSCFG_RST_CH_NO_ACK(stih407_core, _reg, _bit)\n\n#define STIH407_SRST_SBC(_reg, _bit) \\\n\t_SYSCFG_RST_CH_NO_ACK(stih407_sbc_reg, _reg, _bit)\n\n#define STIH407_SRST_LPM(_reg, _bit) \\\n\t_SYSCFG_RST_CH_NO_ACK(stih407_lpm, _reg, _bit)\n\nstatic const struct syscfg_reset_channel_data stih407_softresets[] = {\n\t[STIH407_ETH1_SOFTRESET] = STIH407_SRST_SBC(SYSCFG_4002, 4),\n\t[STIH407_MMC1_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 3),\n\t[STIH407_USB2_PORT0_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 28),\n\t[STIH407_USB2_PORT1_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 29),\n\t[STIH407_PICOPHY_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 30),\n\t[STIH407_IRB_SOFTRESET] = STIH407_SRST_LPM(LPM_SYSCFG_1, 6),\n\t[STIH407_PCIE0_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 6),\n\t[STIH407_PCIE1_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 15),\n\t[STIH407_SATA0_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 7),\n\t[STIH407_SATA1_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 16),\n\t[STIH407_MIPHY0_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 4),\n\t[STIH407_MIPHY1_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 13),\n\t[STIH407_MIPHY2_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 22),\n\t[STIH407_SATA0_PWR_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 5),\n\t[STIH407_SATA1_PWR_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 14),\n\t[STIH407_DELTA_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 3),\n\t[STIH407_BLITTER_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 10),\n\t[STIH407_HDTVOUT_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 11),\n\t[STIH407_HDQVDP_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 12),\n\t[STIH407_VDP_AUX_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 14),\n\t[STIH407_COMPO_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 15),\n\t[STIH407_HDMI_TX_PHY_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 21),\n\t[STIH407_JPEG_DEC_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 23),\n\t[STIH407_VP8_DEC_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 24),\n\t[STIH407_GPU_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 30),\n\t[STIH407_HVA_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 0),\n\t[STIH407_ERAM_HVA_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5132, 1),\n\t[STIH407_LPM_SOFTRESET] = STIH407_SRST_SBC(SYSCFG_4002, 2),\n\t[STIH407_KEYSCAN_SOFTRESET] = STIH407_SRST_LPM(LPM_SYSCFG_1, 8),\n\t[STIH407_ST231_AUD_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 26),\n\t[STIH407_ST231_DMU_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 27),\n\t[STIH407_ST231_GP0_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5131, 28),\n\t[STIH407_ST231_GP1_SOFTRESET] = STIH407_SRST_CORE(SYSCFG_5128, 2),\n};\n\n \n#define SYSCFG_5061\t0x0f4\n\nstatic const struct syscfg_reset_channel_data stih407_picophyresets[] = {\n\t[STIH407_PICOPHY0_RESET] = STIH407_SRST_CORE(SYSCFG_5061, 5),\n\t[STIH407_PICOPHY1_RESET] = STIH407_SRST_CORE(SYSCFG_5061, 6),\n\t[STIH407_PICOPHY2_RESET] = STIH407_SRST_CORE(SYSCFG_5061, 7),\n};\n\nstatic const struct syscfg_reset_controller_data stih407_powerdown_controller = {\n\t.wait_for_ack = true,\n\t.nr_channels = ARRAY_SIZE(stih407_powerdowns),\n\t.channels = stih407_powerdowns,\n};\n\nstatic const struct syscfg_reset_controller_data stih407_softreset_controller = {\n\t.wait_for_ack = false,\n\t.active_low = true,\n\t.nr_channels = ARRAY_SIZE(stih407_softresets),\n\t.channels = stih407_softresets,\n};\n\nstatic const struct syscfg_reset_controller_data stih407_picophyreset_controller = {\n\t.wait_for_ack = false,\n\t.nr_channels = ARRAY_SIZE(stih407_picophyresets),\n\t.channels = stih407_picophyresets,\n};\n\nstatic const struct of_device_id stih407_reset_match[] = {\n\t{\n\t\t.compatible = \"st,stih407-powerdown\",\n\t\t.data = &stih407_powerdown_controller,\n\t},\n\t{\n\t\t.compatible = \"st,stih407-softreset\",\n\t\t.data = &stih407_softreset_controller,\n\t},\n\t{\n\t\t.compatible = \"st,stih407-picophyreset\",\n\t\t.data = &stih407_picophyreset_controller,\n\t},\n\t{   },\n};\n\nstatic struct platform_driver stih407_reset_driver = {\n\t.probe = syscfg_reset_probe,\n\t.driver = {\n\t\t.name = \"reset-stih407\",\n\t\t.of_match_table = stih407_reset_match,\n\t},\n};\n\nstatic int __init stih407_reset_init(void)\n{\n\treturn platform_driver_register(&stih407_reset_driver);\n}\n\narch_initcall(stih407_reset_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}