{
  "module_name": "reset-socfpga.c",
  "hash_id": "3f2c23da11dae045fc31bd33be252971b412b9833dce7a6b46af4ad95430db49",
  "original_prompt": "Ingested from linux-6.6.14/drivers/reset/reset-socfpga.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/init.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n#include <linux/reset-controller.h>\n#include <linux/reset/reset-simple.h>\n#include <linux/reset/socfpga.h>\n#include <linux/slab.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n\n#define SOCFPGA_NR_BANKS\t8\n\nstatic int a10_reset_init(struct device_node *np)\n{\n\tstruct reset_simple_data *data;\n\tstruct resource res;\n\tresource_size_t size;\n\tint ret;\n\tu32 reg_offset = 0x10;\n\n\tdata = kzalloc(sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tret = of_address_to_resource(np, 0, &res);\n\tif (ret)\n\t\tgoto err_alloc;\n\n\tsize = resource_size(&res);\n\tif (!request_mem_region(res.start, size, np->name)) {\n\t\tret = -EBUSY;\n\t\tgoto err_alloc;\n\t}\n\n\tdata->membase = ioremap(res.start, size);\n\tif (!data->membase) {\n\t\tret = -ENOMEM;\n\t\tgoto release_region;\n\t}\n\n\tif (of_property_read_u32(np, \"altr,modrst-offset\", &reg_offset))\n\t\tpr_warn(\"missing altr,modrst-offset property, assuming 0x10\\n\");\n\tdata->membase += reg_offset;\n\n\tspin_lock_init(&data->lock);\n\n\tdata->rcdev.owner = THIS_MODULE;\n\tdata->rcdev.nr_resets = SOCFPGA_NR_BANKS * 32;\n\tdata->rcdev.ops = &reset_simple_ops;\n\tdata->rcdev.of_node = np;\n\tdata->status_active_low = true;\n\n\tret = reset_controller_register(&data->rcdev);\n\tif (ret)\n\t\tpr_err(\"unable to register device\\n\");\n\n\treturn ret;\n\nrelease_region:\n\trelease_mem_region(res.start, size);\n\nerr_alloc:\n\tkfree(data);\n\treturn ret;\n};\n\n \nstatic const struct of_device_id socfpga_early_reset_dt_ids[] __initconst = {\n\t{ .compatible = \"altr,rst-mgr\", },\n\t{   },\n};\n\nvoid __init socfpga_reset_init(void)\n{\n\tstruct device_node *np;\n\n\tfor_each_matching_node(np, socfpga_early_reset_dt_ids)\n\t\ta10_reset_init(np);\n}\n\n \nstatic const struct of_device_id socfpga_reset_dt_ids[] = {\n\t{ .compatible = \"altr,rst-mgr\", },\n\t{   },\n};\n\nstatic int reset_simple_probe(struct platform_device *pdev)\n{\n\treturn 0;\n}\n\nstatic struct platform_driver reset_socfpga_driver = {\n\t.probe\t= reset_simple_probe,\n\t.driver = {\n\t\t.name\t\t= \"socfpga-reset\",\n\t\t.of_match_table\t= socfpga_reset_dt_ids,\n\t},\n};\nbuiltin_platform_driver(reset_socfpga_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}