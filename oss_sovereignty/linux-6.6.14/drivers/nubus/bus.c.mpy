{
  "module_name": "bus.c",
  "hash_id": "11298b955a067b2bd0b5b66f1fcb8b0802c5e0ae5de0cd399a7ea882e82a31f1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/nubus/bus.c",
  "human_readable_source": "\n\n\n\n\n\n#include <linux/device.h>\n#include <linux/dma-mapping.h>\n#include <linux/list.h>\n#include <linux/nubus.h>\n#include <linux/seq_file.h>\n#include <linux/slab.h>\n\n#define to_nubus_board(d)       container_of(d, struct nubus_board, dev)\n#define to_nubus_driver(d)      container_of(d, struct nubus_driver, driver)\n\nstatic int nubus_device_probe(struct device *dev)\n{\n\tstruct nubus_driver *ndrv = to_nubus_driver(dev->driver);\n\tint err = -ENODEV;\n\n\tif (ndrv->probe)\n\t\terr = ndrv->probe(to_nubus_board(dev));\n\treturn err;\n}\n\nstatic void nubus_device_remove(struct device *dev)\n{\n\tstruct nubus_driver *ndrv = to_nubus_driver(dev->driver);\n\n\tif (ndrv->remove)\n\t\tndrv->remove(to_nubus_board(dev));\n}\n\nstruct bus_type nubus_bus_type = {\n\t.name\t\t= \"nubus\",\n\t.probe\t\t= nubus_device_probe,\n\t.remove\t\t= nubus_device_remove,\n};\nEXPORT_SYMBOL(nubus_bus_type);\n\nint nubus_driver_register(struct nubus_driver *ndrv)\n{\n\tndrv->driver.bus = &nubus_bus_type;\n\treturn driver_register(&ndrv->driver);\n}\nEXPORT_SYMBOL(nubus_driver_register);\n\nvoid nubus_driver_unregister(struct nubus_driver *ndrv)\n{\n\tdriver_unregister(&ndrv->driver);\n}\nEXPORT_SYMBOL(nubus_driver_unregister);\n\nstatic struct device nubus_parent = {\n\t.init_name\t= \"nubus\",\n};\n\nstatic int __init nubus_bus_register(void)\n{\n\treturn bus_register(&nubus_bus_type);\n}\npostcore_initcall(nubus_bus_register);\n\nint __init nubus_parent_device_register(void)\n{\n\treturn device_register(&nubus_parent);\n}\n\nstatic void nubus_device_release(struct device *dev)\n{\n\tstruct nubus_board *board = to_nubus_board(dev);\n\tstruct nubus_rsrc *fres, *tmp;\n\n\tlist_for_each_entry_safe(fres, tmp, &nubus_func_rsrcs, list)\n\t\tif (fres->board == board) {\n\t\t\tlist_del(&fres->list);\n\t\t\tkfree(fres);\n\t\t}\n\tkfree(board);\n}\n\nint nubus_device_register(struct nubus_board *board)\n{\n\tboard->dev.parent = &nubus_parent;\n\tboard->dev.release = nubus_device_release;\n\tboard->dev.bus = &nubus_bus_type;\n\tdev_set_name(&board->dev, \"slot.%X\", board->slot);\n\tboard->dev.dma_mask = &board->dev.coherent_dma_mask;\n\tdma_set_mask(&board->dev, DMA_BIT_MASK(32));\n\treturn device_register(&board->dev);\n}\n\nstatic int nubus_print_device_name_fn(struct device *dev, void *data)\n{\n\tstruct nubus_board *board = to_nubus_board(dev);\n\tstruct seq_file *m = data;\n\n\tseq_printf(m, \"Slot %X: %s\\n\", board->slot, board->name);\n\treturn 0;\n}\n\nint nubus_proc_show(struct seq_file *m, void *data)\n{\n\treturn bus_for_each_dev(&nubus_bus_type, NULL, m,\n\t\t\t\tnubus_print_device_name_fn);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}