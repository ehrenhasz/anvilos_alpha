{
  "module_name": "omap-ocp2scp.c",
  "hash_id": "bdc9600445dcae78ccc0ad71b8ef123a3f4063d0a5fa159f886696c02f3754e4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/bus/omap-ocp2scp.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/err.h>\n#include <linux/pm_runtime.h>\n#include <linux/of.h>\n#include <linux/of_platform.h>\n\n#define OCP2SCP_TIMING 0x18\n#define SYNC2_MASK 0xf\n\nstatic int ocp2scp_remove_devices(struct device *dev, void *c)\n{\n\tstruct platform_device *pdev = to_platform_device(dev);\n\n\tplatform_device_unregister(pdev);\n\n\treturn 0;\n}\n\nstatic int omap_ocp2scp_probe(struct platform_device *pdev)\n{\n\tint ret;\n\tu32 reg;\n\tvoid __iomem *regs;\n\tstruct resource *res;\n\tstruct device_node *np = pdev->dev.of_node;\n\n\tif (np) {\n\t\tret = of_platform_populate(np, NULL, NULL, &pdev->dev);\n\t\tif (ret) {\n\t\t\tdev_err(&pdev->dev,\n\t\t\t    \"failed to add resources for ocp2scp child\\n\");\n\t\t\tgoto err0;\n\t\t}\n\t}\n\n\tpm_runtime_enable(&pdev->dev);\n\t \n\tif (!of_device_is_compatible(np, \"ti,am437x-ocp2scp\")) {\n\t\tres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\t\tregs = devm_ioremap_resource(&pdev->dev, res);\n\t\tif (IS_ERR(regs)) {\n\t\t\tret = PTR_ERR(regs);\n\t\t\tgoto err1;\n\t\t}\n\n\t\tpm_runtime_get_sync(&pdev->dev);\n\t\treg = readl_relaxed(regs + OCP2SCP_TIMING);\n\t\treg &= ~(SYNC2_MASK);\n\t\treg |= 0x6;\n\t\twritel_relaxed(reg, regs + OCP2SCP_TIMING);\n\t\tpm_runtime_put_sync(&pdev->dev);\n\t}\n\n\treturn 0;\n\nerr1:\n\tpm_runtime_disable(&pdev->dev);\n\nerr0:\n\tdevice_for_each_child(&pdev->dev, NULL, ocp2scp_remove_devices);\n\n\treturn ret;\n}\n\nstatic int omap_ocp2scp_remove(struct platform_device *pdev)\n{\n\tpm_runtime_disable(&pdev->dev);\n\tdevice_for_each_child(&pdev->dev, NULL, ocp2scp_remove_devices);\n\n\treturn 0;\n}\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id omap_ocp2scp_id_table[] = {\n\t{ .compatible = \"ti,omap-ocp2scp\" },\n\t{ .compatible = \"ti,am437x-ocp2scp\" },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, omap_ocp2scp_id_table);\n#endif\n\nstatic struct platform_driver omap_ocp2scp_driver = {\n\t.probe\t\t= omap_ocp2scp_probe,\n\t.remove\t\t= omap_ocp2scp_remove,\n\t.driver\t\t= {\n\t\t.name\t= \"omap-ocp2scp\",\n\t\t.of_match_table = of_match_ptr(omap_ocp2scp_id_table),\n\t},\n};\n\nmodule_platform_driver(omap_ocp2scp_driver);\n\nMODULE_ALIAS(\"platform:omap-ocp2scp\");\nMODULE_AUTHOR(\"Texas Instruments Inc.\");\nMODULE_DESCRIPTION(\"OMAP OCP2SCP driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}