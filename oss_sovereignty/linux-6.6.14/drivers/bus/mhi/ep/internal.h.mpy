{
  "module_name": "internal.h",
  "hash_id": "0ab18c7ecd345c8b13812f0ed25351e1c0d0f817b945650e0516310be7cfe6c5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/bus/mhi/ep/internal.h",
  "human_readable_source": " \n \n\n#ifndef _MHI_EP_INTERNAL_\n#define _MHI_EP_INTERNAL_\n\n#include <linux/bitfield.h>\n\n#include \"../common.h\"\n\nextern struct bus_type mhi_ep_bus_type;\n\n#define MHI_REG_OFFSET\t\t\t\t0x100\n#define BHI_REG_OFFSET\t\t\t\t0x200\n\n \n#define EP_MHIREGLEN\t\t\t\t(MHI_REG_OFFSET + MHIREGLEN)\n#define EP_MHIVER\t\t\t\t(MHI_REG_OFFSET + MHIVER)\n#define EP_MHICFG\t\t\t\t(MHI_REG_OFFSET + MHICFG)\n#define EP_CHDBOFF\t\t\t\t(MHI_REG_OFFSET + CHDBOFF)\n#define EP_ERDBOFF\t\t\t\t(MHI_REG_OFFSET + ERDBOFF)\n#define EP_BHIOFF\t\t\t\t(MHI_REG_OFFSET + BHIOFF)\n#define EP_BHIEOFF\t\t\t\t(MHI_REG_OFFSET + BHIEOFF)\n#define EP_DEBUGOFF\t\t\t\t(MHI_REG_OFFSET + DEBUGOFF)\n#define EP_MHICTRL\t\t\t\t(MHI_REG_OFFSET + MHICTRL)\n#define EP_MHISTATUS\t\t\t\t(MHI_REG_OFFSET + MHISTATUS)\n#define EP_CCABAP_LOWER\t\t\t\t(MHI_REG_OFFSET + CCABAP_LOWER)\n#define EP_CCABAP_HIGHER\t\t\t(MHI_REG_OFFSET + CCABAP_HIGHER)\n#define EP_ECABAP_LOWER\t\t\t\t(MHI_REG_OFFSET + ECABAP_LOWER)\n#define EP_ECABAP_HIGHER\t\t\t(MHI_REG_OFFSET + ECABAP_HIGHER)\n#define EP_CRCBAP_LOWER\t\t\t\t(MHI_REG_OFFSET + CRCBAP_LOWER)\n#define EP_CRCBAP_HIGHER\t\t\t(MHI_REG_OFFSET + CRCBAP_HIGHER)\n#define EP_CRDB_LOWER\t\t\t\t(MHI_REG_OFFSET + CRDB_LOWER)\n#define EP_CRDB_HIGHER\t\t\t\t(MHI_REG_OFFSET + CRDB_HIGHER)\n#define EP_MHICTRLBASE_LOWER\t\t\t(MHI_REG_OFFSET + MHICTRLBASE_LOWER)\n#define EP_MHICTRLBASE_HIGHER\t\t\t(MHI_REG_OFFSET + MHICTRLBASE_HIGHER)\n#define EP_MHICTRLLIMIT_LOWER\t\t\t(MHI_REG_OFFSET + MHICTRLLIMIT_LOWER)\n#define EP_MHICTRLLIMIT_HIGHER\t\t\t(MHI_REG_OFFSET + MHICTRLLIMIT_HIGHER)\n#define EP_MHIDATABASE_LOWER\t\t\t(MHI_REG_OFFSET + MHIDATABASE_LOWER)\n#define EP_MHIDATABASE_HIGHER\t\t\t(MHI_REG_OFFSET + MHIDATABASE_HIGHER)\n#define EP_MHIDATALIMIT_LOWER\t\t\t(MHI_REG_OFFSET + MHIDATALIMIT_LOWER)\n#define EP_MHIDATALIMIT_HIGHER\t\t\t(MHI_REG_OFFSET + MHIDATALIMIT_HIGHER)\n\n \n#define EP_BHI_INTVEC\t\t\t\t(BHI_REG_OFFSET + BHI_INTVEC)\n#define EP_BHI_EXECENV\t\t\t\t(BHI_REG_OFFSET + BHI_EXECENV)\n\n \n#define CHDB_LOWER_n(n)\t\t\t\t(0x400 + 0x8 * (n))\n#define CHDB_HIGHER_n(n)\t\t\t(0x404 + 0x8 * (n))\n#define ERDB_LOWER_n(n)\t\t\t\t(0x800 + 0x8 * (n))\n#define ERDB_HIGHER_n(n)\t\t\t(0x804 + 0x8 * (n))\n\n#define MHI_CTRL_INT_STATUS\t\t\t0x4\n#define MHI_CTRL_INT_STATUS_MSK\t\t\tBIT(0)\n#define MHI_CTRL_INT_STATUS_CRDB_MSK\t\tBIT(1)\n#define MHI_CHDB_INT_STATUS_n(n)\t\t(0x28 + 0x4 * (n))\n#define MHI_ERDB_INT_STATUS_n(n)\t\t(0x38 + 0x4 * (n))\n\n#define MHI_CTRL_INT_CLEAR\t\t\t0x4c\n#define MHI_CTRL_INT_MMIO_WR_CLEAR\t\tBIT(2)\n#define MHI_CTRL_INT_CRDB_CLEAR\t\t\tBIT(1)\n#define MHI_CTRL_INT_CRDB_MHICTRL_CLEAR\t\tBIT(0)\n\n#define MHI_CHDB_INT_CLEAR_n(n)\t\t\t(0x70 + 0x4 * (n))\n#define MHI_CHDB_INT_CLEAR_n_CLEAR_ALL\t\tGENMASK(31, 0)\n#define MHI_ERDB_INT_CLEAR_n(n)\t\t\t(0x80 + 0x4 * (n))\n#define MHI_ERDB_INT_CLEAR_n_CLEAR_ALL\t\tGENMASK(31, 0)\n\n \n#define MHI_CTRL_INT_MASK\t\t\t0x94\n#define MHI_CTRL_INT_MASK_MASK\t\t\tGENMASK(1, 0)\n#define MHI_CTRL_MHICTRL_MASK\t\t\tBIT(0)\n#define MHI_CTRL_CRDB_MASK\t\t\tBIT(1)\n\n#define MHI_CHDB_INT_MASK_n(n)\t\t\t(0xb8 + 0x4 * (n))\n#define MHI_CHDB_INT_MASK_n_EN_ALL\t\tGENMASK(31, 0)\n#define MHI_ERDB_INT_MASK_n(n)\t\t\t(0xc8 + 0x4 * (n))\n#define MHI_ERDB_INT_MASK_n_EN_ALL\t\tGENMASK(31, 0)\n\n#define NR_OF_CMD_RINGS\t\t\t\t1\n#define MHI_MASK_ROWS_CH_DB\t\t\t4\n#define MHI_MASK_ROWS_EV_DB\t\t\t4\n#define MHI_MASK_CH_LEN\t\t\t\t32\n#define MHI_MASK_EV_LEN\t\t\t\t32\n\n \nstruct mhi_generic_ctx {\n\t__le32 reserved0;\n\t__le32 reserved1;\n\t__le32 reserved2;\n\n\t__le64 rbase __packed __aligned(4);\n\t__le64 rlen __packed __aligned(4);\n\t__le64 rp __packed __aligned(4);\n\t__le64 wp __packed __aligned(4);\n};\n\nenum mhi_ep_ring_type {\n\tRING_TYPE_CMD,\n\tRING_TYPE_ER,\n\tRING_TYPE_CH,\n};\n\n \nunion mhi_ep_ring_ctx {\n\tstruct mhi_cmd_ctxt cmd;\n\tstruct mhi_event_ctxt ev;\n\tstruct mhi_chan_ctxt ch;\n\tstruct mhi_generic_ctx generic;\n};\n\nstruct mhi_ep_ring_item {\n\tstruct list_head node;\n\tstruct mhi_ep_ring *ring;\n};\n\nstruct mhi_ep_ring {\n\tstruct mhi_ep_cntrl *mhi_cntrl;\n\tunion mhi_ep_ring_ctx *ring_ctx;\n\tstruct mhi_ring_element *ring_cache;\n\tenum mhi_ep_ring_type type;\n\tu64 rbase;\n\tsize_t rd_offset;\n\tsize_t wr_offset;\n\tsize_t ring_size;\n\tu32 db_offset_h;\n\tu32 db_offset_l;\n\tu32 ch_id;\n\tu32 er_index;\n\tu32 irq_vector;\n\tbool started;\n};\n\nstruct mhi_ep_cmd {\n\tstruct mhi_ep_ring ring;\n};\n\nstruct mhi_ep_event {\n\tstruct mhi_ep_ring ring;\n};\n\nstruct mhi_ep_state_transition {\n\tstruct list_head node;\n\tenum mhi_state state;\n};\n\nstruct mhi_ep_chan {\n\tchar *name;\n\tstruct mhi_ep_device *mhi_dev;\n\tstruct mhi_ep_ring ring;\n\tstruct mutex lock;\n\tvoid (*xfer_cb)(struct mhi_ep_device *mhi_dev, struct mhi_result *result);\n\tenum mhi_ch_state state;\n\tenum dma_data_direction dir;\n\tu64 tre_loc;\n\tu32 tre_size;\n\tu32 tre_bytes_left;\n\tu32 chan;\n\tbool skip_td;\n};\n\n \nvoid mhi_ep_ring_init(struct mhi_ep_ring *ring, enum mhi_ep_ring_type type, u32 id);\nvoid mhi_ep_ring_reset(struct mhi_ep_cntrl *mhi_cntrl, struct mhi_ep_ring *ring);\nint mhi_ep_ring_start(struct mhi_ep_cntrl *mhi_cntrl, struct mhi_ep_ring *ring,\n\t\t      union mhi_ep_ring_ctx *ctx);\nsize_t mhi_ep_ring_addr2offset(struct mhi_ep_ring *ring, u64 ptr);\nint mhi_ep_ring_add_element(struct mhi_ep_ring *ring, struct mhi_ring_element *element);\nvoid mhi_ep_ring_inc_index(struct mhi_ep_ring *ring);\nint mhi_ep_update_wr_offset(struct mhi_ep_ring *ring);\n\n \nu32 mhi_ep_mmio_read(struct mhi_ep_cntrl *mhi_cntrl, u32 offset);\nvoid mhi_ep_mmio_write(struct mhi_ep_cntrl *mhi_cntrl, u32 offset, u32 val);\nvoid mhi_ep_mmio_masked_write(struct mhi_ep_cntrl *mhi_cntrl, u32 offset, u32 mask, u32 val);\nu32 mhi_ep_mmio_masked_read(struct mhi_ep_cntrl *dev, u32 offset, u32 mask);\nvoid mhi_ep_mmio_enable_ctrl_interrupt(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_disable_ctrl_interrupt(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_enable_cmdb_interrupt(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_disable_cmdb_interrupt(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_enable_chdb(struct mhi_ep_cntrl *mhi_cntrl, u32 ch_id);\nvoid mhi_ep_mmio_disable_chdb(struct mhi_ep_cntrl *mhi_cntrl, u32 ch_id);\nvoid mhi_ep_mmio_enable_chdb_interrupts(struct mhi_ep_cntrl *mhi_cntrl);\nbool mhi_ep_mmio_read_chdb_status_interrupts(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_mask_interrupts(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_get_chc_base(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_get_erc_base(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_get_crc_base(struct mhi_ep_cntrl *mhi_cntrl);\nu64 mhi_ep_mmio_get_db(struct mhi_ep_ring *ring);\nvoid mhi_ep_mmio_set_env(struct mhi_ep_cntrl *mhi_cntrl, u32 value);\nvoid mhi_ep_mmio_clear_reset(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_reset(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_get_mhi_state(struct mhi_ep_cntrl *mhi_cntrl, enum mhi_state *state,\n\t\t\t       bool *mhi_reset);\nvoid mhi_ep_mmio_init(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_mmio_update_ner(struct mhi_ep_cntrl *mhi_cntrl);\n\n \nint mhi_ep_send_state_change_event(struct mhi_ep_cntrl *mhi_cntrl, enum mhi_state state);\nint mhi_ep_send_ee_event(struct mhi_ep_cntrl *mhi_cntrl, enum mhi_ee_type exec_env);\nbool mhi_ep_check_mhi_state(struct mhi_ep_cntrl *mhi_cntrl, enum mhi_state cur_mhi_state,\n\t\t\t    enum mhi_state mhi_state);\nint mhi_ep_set_mhi_state(struct mhi_ep_cntrl *mhi_cntrl, enum mhi_state mhi_state);\nint mhi_ep_set_m0_state(struct mhi_ep_cntrl *mhi_cntrl);\nint mhi_ep_set_m3_state(struct mhi_ep_cntrl *mhi_cntrl);\nint mhi_ep_set_ready_state(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_handle_syserr(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_resume_channels(struct mhi_ep_cntrl *mhi_cntrl);\nvoid mhi_ep_suspend_channels(struct mhi_ep_cntrl *mhi_cntrl);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}