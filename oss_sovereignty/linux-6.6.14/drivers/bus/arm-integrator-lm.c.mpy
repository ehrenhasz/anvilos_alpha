{
  "module_name": "arm-integrator-lm.c",
  "hash_id": "1b15340450b31441b4059c71c23a2158004d3956ca138f02f0f86abafa42b471",
  "original_prompt": "Ingested from linux-6.6.14/drivers/bus/arm-integrator-lm.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/of_platform.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/platform_device.h>\n#include <linux/bitops.h>\n#include <linux/mfd/syscon.h>\n#include <linux/regmap.h>\n\n \n#define INTEGRATOR_SC_DEC_OFFSET\t0x10\n\n \n#define INTEGRATOR_AP_EXP_BASE\t\t0xc0000000\n#define INTEGRATOR_AP_EXP_STRIDE\t0x10000000\n\nstatic int integrator_lm_populate(int num, struct device *dev)\n{\n\tstruct device_node *np = dev->of_node;\n\tstruct device_node *child;\n\tu32 base;\n\tint ret;\n\n\tbase = INTEGRATOR_AP_EXP_BASE + (num * INTEGRATOR_AP_EXP_STRIDE);\n\n\t \n\tfor_each_available_child_of_node(np, child) {\n\t\tstruct resource res;\n\n\t\tret = of_address_to_resource(child, 0, &res);\n\t\tif (ret) {\n\t\t\tdev_info(dev, \"no valid address on child\\n\");\n\t\t\tcontinue;\n\t\t}\n\n\t\t \n\t\tif (res.start == base) {\n\t\t\tdev_info(dev, \"populate module @0x%08x from DT\\n\",\n\t\t\t\t base);\n\t\t\tret = of_platform_default_populate(child, NULL, dev);\n\t\t\tif (ret) {\n\t\t\t\tdev_err(dev, \"failed to populate module\\n\");\n\t\t\t\tof_node_put(child);\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nstatic const struct of_device_id integrator_ap_syscon_match[] = {\n\t{ .compatible = \"arm,integrator-ap-syscon\"},\n\t{ },\n};\n\nstatic int integrator_ap_lm_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct device_node *syscon;\n\tstatic struct regmap *map;\n\tu32 val;\n\tint ret;\n\tint i;\n\n\t \n\tsyscon = of_find_matching_node(NULL, integrator_ap_syscon_match);\n\tif (!syscon) {\n\t\tdev_err(dev,\n\t\t\t\"could not find Integrator/AP system controller\\n\");\n\t\treturn -ENODEV;\n\t}\n\tmap = syscon_node_to_regmap(syscon);\n\tif (IS_ERR(map)) {\n\t\tdev_err(dev,\n\t\t\t\"could not find Integrator/AP system controller\\n\");\n\t\treturn PTR_ERR(map);\n\t}\n\n\tret = regmap_read(map, INTEGRATOR_SC_DEC_OFFSET, &val);\n\tif (ret) {\n\t\tdev_err(dev, \"could not read from Integrator/AP syscon\\n\");\n\t\treturn ret;\n\t}\n\n\t \n\tfor (i = 0; i < 4; i++) {\n\t\tif (!(val & BIT(4 + i)))\n\t\t\tcontinue;\n\n\t\tdev_info(dev, \"detected module in slot %d\\n\", i);\n\t\tret = integrator_lm_populate(i, dev);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct of_device_id integrator_ap_lm_match[] = {\n\t{ .compatible = \"arm,integrator-ap-lm\"},\n\t{ },\n};\n\nstatic struct platform_driver integrator_ap_lm_driver = {\n\t.probe = integrator_ap_lm_probe,\n\t.driver = {\n\t\t.name = \"integratorap-lm\",\n\t\t.of_match_table = integrator_ap_lm_match,\n\t},\n};\nmodule_platform_driver(integrator_ap_lm_driver);\nMODULE_AUTHOR(\"Linus Walleij <linus.walleij@linaro.org>\");\nMODULE_DESCRIPTION(\"Integrator AP Logical Module driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}