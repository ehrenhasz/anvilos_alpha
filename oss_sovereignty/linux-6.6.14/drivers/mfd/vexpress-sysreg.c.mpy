{
  "module_name": "vexpress-sysreg.c",
  "hash_id": "b8e41646a229abebebbd9057efb98a808a2cdbff7e4decfa0104917a1f96a4a4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/vexpress-sysreg.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/driver.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/mfd/core.h>\n#include <linux/module.h>\n#include <linux/of_platform.h>\n#include <linux/platform_data/syscon.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <linux/stat.h>\n\n#define SYS_ID\t\t\t0x000\n#define SYS_SW\t\t\t0x004\n#define SYS_LED\t\t\t0x008\n#define SYS_100HZ\t\t0x024\n#define SYS_FLAGSSET\t\t0x030\n#define SYS_FLAGSCLR\t\t0x034\n#define SYS_NVFLAGS\t\t0x038\n#define SYS_NVFLAGSSET\t\t0x038\n#define SYS_NVFLAGSCLR\t\t0x03c\n#define SYS_MCI\t\t\t0x048\n#define SYS_FLASH\t\t0x04c\n#define SYS_CFGSW\t\t0x058\n#define SYS_24MHZ\t\t0x05c\n#define SYS_MISC\t\t0x060\n#define SYS_DMA\t\t\t0x064\n#define SYS_PROCID0\t\t0x084\n#define SYS_PROCID1\t\t0x088\n#define SYS_CFGDATA\t\t0x0a0\n#define SYS_CFGCTRL\t\t0x0a4\n#define SYS_CFGSTAT\t\t0x0a8\n\n \n\nstatic struct bgpio_pdata vexpress_sysreg_sys_led_pdata = {\n\t.label = \"sys_led\",\n\t.base = -1,\n\t.ngpio = 8,\n};\n\nstatic struct bgpio_pdata vexpress_sysreg_sys_mci_pdata = {\n\t.label = \"sys_mci\",\n\t.base = -1,\n\t.ngpio = 2,\n};\n\nstatic struct bgpio_pdata vexpress_sysreg_sys_flash_pdata = {\n\t.label = \"sys_flash\",\n\t.base = -1,\n\t.ngpio = 1,\n};\n\nstatic struct mfd_cell vexpress_sysreg_cells[] = {\n\t{\n\t\t.name = \"basic-mmio-gpio\",\n\t\t.of_compatible = \"arm,vexpress-sysreg,sys_led\",\n\t\t.num_resources = 1,\n\t\t.resources = &DEFINE_RES_MEM_NAMED(SYS_LED, 0x4, \"dat\"),\n\t\t.platform_data = &vexpress_sysreg_sys_led_pdata,\n\t\t.pdata_size = sizeof(vexpress_sysreg_sys_led_pdata),\n\t}, {\n\t\t.name = \"basic-mmio-gpio\",\n\t\t.of_compatible = \"arm,vexpress-sysreg,sys_mci\",\n\t\t.num_resources = 1,\n\t\t.resources = &DEFINE_RES_MEM_NAMED(SYS_MCI, 0x4, \"dat\"),\n\t\t.platform_data = &vexpress_sysreg_sys_mci_pdata,\n\t\t.pdata_size = sizeof(vexpress_sysreg_sys_mci_pdata),\n\t}, {\n\t\t.name = \"basic-mmio-gpio\",\n\t\t.of_compatible = \"arm,vexpress-sysreg,sys_flash\",\n\t\t.num_resources = 1,\n\t\t.resources = &DEFINE_RES_MEM_NAMED(SYS_FLASH, 0x4, \"dat\"),\n\t\t.platform_data = &vexpress_sysreg_sys_flash_pdata,\n\t\t.pdata_size = sizeof(vexpress_sysreg_sys_flash_pdata),\n\t}, {\n\t\t.name = \"vexpress-syscfg\",\n\t\t.num_resources = 1,\n\t\t.resources = &DEFINE_RES_MEM(SYS_MISC, 0x4c),\n\t}\n};\n\nstatic int vexpress_sysreg_probe(struct platform_device *pdev)\n{\n\tstruct resource *mem;\n\tvoid __iomem *base;\n\tstruct gpio_chip *mmc_gpio_chip;\n\n\tmem = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\tif (!mem)\n\t\treturn -EINVAL;\n\n\tbase = devm_ioremap(&pdev->dev, mem->start, resource_size(mem));\n\tif (!base)\n\t\treturn -ENOMEM;\n\n\t \n\tmmc_gpio_chip = devm_kzalloc(&pdev->dev, sizeof(*mmc_gpio_chip),\n\t\t\tGFP_KERNEL);\n\tif (!mmc_gpio_chip)\n\t\treturn -ENOMEM;\n\tbgpio_init(mmc_gpio_chip, &pdev->dev, 0x4, base + SYS_MCI,\n\t\t\tNULL, NULL, NULL, NULL, 0);\n\tmmc_gpio_chip->ngpio = 2;\n\tdevm_gpiochip_add_data(&pdev->dev, mmc_gpio_chip, NULL);\n\n\treturn devm_mfd_add_devices(&pdev->dev, PLATFORM_DEVID_AUTO,\n\t\t\tvexpress_sysreg_cells,\n\t\t\tARRAY_SIZE(vexpress_sysreg_cells), mem, 0, NULL);\n}\n\nstatic const struct of_device_id vexpress_sysreg_match[] = {\n\t{ .compatible = \"arm,vexpress-sysreg\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, vexpress_sysreg_match);\n\nstatic struct platform_driver vexpress_sysreg_driver = {\n\t.driver = {\n\t\t.name = \"vexpress-sysreg\",\n\t\t.of_match_table = vexpress_sysreg_match,\n\t},\n\t.probe = vexpress_sysreg_probe,\n};\n\nmodule_platform_driver(vexpress_sysreg_driver);\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}