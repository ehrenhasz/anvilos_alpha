{
  "module_name": "ucb1x00-assabet.c",
  "hash_id": "f8fbeb962f45216c8ebfb256546938dfcdeac4cdc993733ac54a4c34c5b59b33",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/ucb1x00-assabet.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/fs.h>\n#include <linux/gpio_keys.h>\n#include <linux/input.h>\n#include <linux/platform_device.h>\n#include <linux/proc_fs.h>\n#include <linux/mfd/ucb1x00.h>\n\n#define UCB1X00_ATTR(name,input)\\\nstatic ssize_t name##_show(struct device *dev, struct device_attribute *attr, \\\n\t\t\t   char *buf)\t\\\n{\t\t\t\t\t\t\t\t\\\n\tstruct ucb1x00 *ucb = classdev_to_ucb1x00(dev);\t\t\\\n\tint val;\t\t\t\t\t\t\\\n\tucb1x00_adc_enable(ucb);\t\t\t\t\\\n\tval = ucb1x00_adc_read(ucb, input, UCB_NOSYNC);\t\t\\\n\tucb1x00_adc_disable(ucb);\t\t\t\t\\\n\treturn sprintf(buf, \"%d\\n\", val);\t\t\t\\\n}\t\t\t\t\t\t\t\t\\\nstatic DEVICE_ATTR_RO(name)\n\nUCB1X00_ATTR(vbatt, UCB_ADC_INP_AD1);\nUCB1X00_ATTR(vcharger, UCB_ADC_INP_AD0);\nUCB1X00_ATTR(batt_temp, UCB_ADC_INP_AD2);\n\nstatic int ucb1x00_assabet_add(struct ucb1x00_dev *dev)\n{\n\tstruct ucb1x00 *ucb = dev->ucb;\n\tstruct platform_device *pdev;\n\tstruct gpio_keys_platform_data keys;\n\tstatic struct gpio_keys_button buttons[6];\n\tunsigned i;\n\n\tmemset(buttons, 0, sizeof(buttons));\n\tmemset(&keys, 0, sizeof(keys));\n\n\tfor (i = 0; i < ARRAY_SIZE(buttons); i++) {\n\t\tbuttons[i].code = BTN_0 + i;\n\t\tbuttons[i].gpio = ucb->gpio.base + i;\n\t\tbuttons[i].type = EV_KEY;\n\t\tbuttons[i].can_disable = true;\n\t}\n\n\tkeys.buttons = buttons;\n\tkeys.nbuttons = ARRAY_SIZE(buttons);\n\tkeys.poll_interval = 50;\n\tkeys.name = \"ucb1x00\";\n\n\tpdev = platform_device_register_data(&ucb->dev, \"gpio-keys\", -1,\n\t\t&keys, sizeof(keys));\n\n\tdevice_create_file(&ucb->dev, &dev_attr_vbatt);\n\tdevice_create_file(&ucb->dev, &dev_attr_vcharger);\n\tdevice_create_file(&ucb->dev, &dev_attr_batt_temp);\n\n\tdev->priv = pdev;\n\treturn 0;\n}\n\nstatic void ucb1x00_assabet_remove(struct ucb1x00_dev *dev)\n{\n\tstruct platform_device *pdev = dev->priv;\n\n\tif (!IS_ERR(pdev))\n\t\tplatform_device_unregister(pdev);\n\n\tdevice_remove_file(&dev->ucb->dev, &dev_attr_batt_temp);\n\tdevice_remove_file(&dev->ucb->dev, &dev_attr_vcharger);\n\tdevice_remove_file(&dev->ucb->dev, &dev_attr_vbatt);\n}\n\nstatic struct ucb1x00_driver ucb1x00_assabet_driver = {\n\t.add\t= ucb1x00_assabet_add,\n\t.remove\t= ucb1x00_assabet_remove,\n};\n\nstatic int __init ucb1x00_assabet_init(void)\n{\n\treturn ucb1x00_register_driver(&ucb1x00_assabet_driver);\n}\n\nstatic void __exit ucb1x00_assabet_exit(void)\n{\n\tucb1x00_unregister_driver(&ucb1x00_assabet_driver);\n}\n\nmodule_init(ucb1x00_assabet_init);\nmodule_exit(ucb1x00_assabet_exit);\n\nMODULE_AUTHOR(\"Russell King <rmk@arm.linux.org.uk>\");\nMODULE_DESCRIPTION(\"Assabet noddy testing only example ADC driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}