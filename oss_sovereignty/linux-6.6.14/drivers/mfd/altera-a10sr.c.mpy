{
  "module_name": "altera-a10sr.c",
  "hash_id": "26cea036c761e769599c36d494acbd7bfad7b9f685838bac86b26870d92c551a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/altera-a10sr.c",
  "human_readable_source": "\n \n\n#include <linux/mfd/altera-a10sr.h>\n#include <linux/mfd/core.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/spi/spi.h>\n\nstatic const struct mfd_cell altr_a10sr_subdev_info[] = {\n\t{\n\t\t.name = \"altr_a10sr_gpio\",\n\t\t.of_compatible = \"altr,a10sr-gpio\",\n\t},\n\t{\n\t\t.name = \"altr_a10sr_reset\",\n\t\t.of_compatible = \"altr,a10sr-reset\",\n\t},\n};\n\nstatic bool altr_a10sr_reg_readable(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase ALTR_A10SR_VERSION_READ:\n\tcase ALTR_A10SR_LED_REG:\n\tcase ALTR_A10SR_PBDSW_REG:\n\tcase ALTR_A10SR_PBDSW_IRQ_REG:\n\tcase ALTR_A10SR_PWR_GOOD1_REG:\n\tcase ALTR_A10SR_PWR_GOOD2_REG:\n\tcase ALTR_A10SR_PWR_GOOD3_REG:\n\tcase ALTR_A10SR_FMCAB_REG:\n\tcase ALTR_A10SR_HPS_RST_REG:\n\tcase ALTR_A10SR_USB_QSPI_REG:\n\tcase ALTR_A10SR_SFPA_REG:\n\tcase ALTR_A10SR_SFPB_REG:\n\tcase ALTR_A10SR_I2C_M_REG:\n\tcase ALTR_A10SR_WARM_RST_REG:\n\tcase ALTR_A10SR_WR_KEY_REG:\n\tcase ALTR_A10SR_PMBUS_REG:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool altr_a10sr_reg_writeable(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase ALTR_A10SR_LED_REG:\n\tcase ALTR_A10SR_PBDSW_IRQ_REG:\n\tcase ALTR_A10SR_FMCAB_REG:\n\tcase ALTR_A10SR_HPS_RST_REG:\n\tcase ALTR_A10SR_USB_QSPI_REG:\n\tcase ALTR_A10SR_SFPA_REG:\n\tcase ALTR_A10SR_SFPB_REG:\n\tcase ALTR_A10SR_WARM_RST_REG:\n\tcase ALTR_A10SR_WR_KEY_REG:\n\tcase ALTR_A10SR_PMBUS_REG:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool altr_a10sr_reg_volatile(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase ALTR_A10SR_PBDSW_REG:\n\tcase ALTR_A10SR_PBDSW_IRQ_REG:\n\tcase ALTR_A10SR_PWR_GOOD1_REG:\n\tcase ALTR_A10SR_PWR_GOOD2_REG:\n\tcase ALTR_A10SR_PWR_GOOD3_REG:\n\tcase ALTR_A10SR_HPS_RST_REG:\n\tcase ALTR_A10SR_I2C_M_REG:\n\tcase ALTR_A10SR_WARM_RST_REG:\n\tcase ALTR_A10SR_WR_KEY_REG:\n\tcase ALTR_A10SR_PMBUS_REG:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_config altr_a10sr_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.cache_type = REGCACHE_NONE,\n\n\t.use_single_read = true,\n\t.use_single_write = true,\n\t.read_flag_mask = 1,\n\t.write_flag_mask = 0,\n\n\t.max_register = ALTR_A10SR_WR_KEY_REG,\n\t.readable_reg = altr_a10sr_reg_readable,\n\t.writeable_reg = altr_a10sr_reg_writeable,\n\t.volatile_reg = altr_a10sr_reg_volatile,\n\n};\n\nstatic int altr_a10sr_spi_probe(struct spi_device *spi)\n{\n\tint ret;\n\tstruct altr_a10sr *a10sr;\n\n\ta10sr = devm_kzalloc(&spi->dev, sizeof(*a10sr),\n\t\t\t     GFP_KERNEL);\n\tif (!a10sr)\n\t\treturn -ENOMEM;\n\n\tspi->mode = SPI_MODE_3;\n\tspi->bits_per_word = 8;\n\tspi_setup(spi);\n\n\ta10sr->dev = &spi->dev;\n\n\tspi_set_drvdata(spi, a10sr);\n\n\ta10sr->regmap = devm_regmap_init_spi(spi, &altr_a10sr_regmap_config);\n\tif (IS_ERR(a10sr->regmap)) {\n\t\tret = PTR_ERR(a10sr->regmap);\n\t\tdev_err(&spi->dev, \"Failed to allocate register map: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\n\tret = devm_mfd_add_devices(a10sr->dev, PLATFORM_DEVID_AUTO,\n\t\t\t\t   altr_a10sr_subdev_info,\n\t\t\t\t   ARRAY_SIZE(altr_a10sr_subdev_info),\n\t\t\t\t   NULL, 0, NULL);\n\tif (ret)\n\t\tdev_err(a10sr->dev, \"Failed to register sub-devices: %d\\n\",\n\t\t\tret);\n\n\treturn ret;\n}\n\nstatic const struct of_device_id altr_a10sr_spi_of_match[] = {\n\t{ .compatible = \"altr,a10sr\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, altr_a10sr_spi_of_match);\n\nstatic const struct spi_device_id altr_a10sr_spi_ids[] = {\n\t{ .name = \"a10sr\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(spi, altr_a10sr_spi_ids);\n\nstatic struct spi_driver altr_a10sr_spi_driver = {\n\t.probe = altr_a10sr_spi_probe,\n\t.driver = {\n\t\t.name = \"altr_a10sr\",\n\t\t.of_match_table = altr_a10sr_spi_of_match,\n\t},\n\t.id_table = altr_a10sr_spi_ids,\n};\nbuiltin_driver(altr_a10sr_spi_driver, spi_register_driver)\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}