{
  "module_name": "da9063-irq.c",
  "hash_id": "13750c752004243107af3b660dd12c4e4f35a2150f622c3099d238dd1dce4200",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/da9063-irq.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/irq.h>\n#include <linux/mfd/core.h>\n#include <linux/interrupt.h>\n#include <linux/regmap.h>\n#include <linux/mfd/da9063/core.h>\n\n#define\tDA9063_REG_EVENT_A_OFFSET\t0\n#define\tDA9063_REG_EVENT_B_OFFSET\t1\n#define\tDA9063_REG_EVENT_C_OFFSET\t2\n#define\tDA9063_REG_EVENT_D_OFFSET\t3\n\nstatic const struct regmap_irq da9063_irqs[] = {\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_ONKEY,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_ONKEY),\n\tREGMAP_IRQ_REG(DA9063_IRQ_ALARM,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_ALARM),\n\tREGMAP_IRQ_REG(DA9063_IRQ_TICK,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_TICK),\n\tREGMAP_IRQ_REG(DA9063_IRQ_ADC_RDY,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_ADC_RDY),\n\tREGMAP_IRQ_REG(DA9063_IRQ_SEQ_RDY,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_SEQ_RDY),\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_WAKE,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_WAKE),\n\tREGMAP_IRQ_REG(DA9063_IRQ_TEMP,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_TEMP),\n\tREGMAP_IRQ_REG(DA9063_IRQ_COMP_1V2,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_COMP_1V2),\n\tREGMAP_IRQ_REG(DA9063_IRQ_LDO_LIM,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_LDO_LIM),\n\tREGMAP_IRQ_REG(DA9063_IRQ_REG_UVOV,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_UVOV),\n\tREGMAP_IRQ_REG(DA9063_IRQ_DVC_RDY,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_DVC_RDY),\n\tREGMAP_IRQ_REG(DA9063_IRQ_VDD_MON,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_VDD_MON),\n\tREGMAP_IRQ_REG(DA9063_IRQ_WARN,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_VDD_WARN),\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI0,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI0),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI1,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI1),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI2,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI2),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI3,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI3),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI4,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI4),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI5,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI5),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI6,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI6),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI7,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI7),\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI8,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI8),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI9,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI9),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI10,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI10),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI11,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI11),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI12,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI12),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI13,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI13),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI14,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI14),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI15,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI15),\n};\n\nstatic const struct regmap_irq_chip da9063_irq_chip = {\n\t.name = \"da9063-irq\",\n\t.irqs = da9063_irqs,\n\t.num_irqs = ARRAY_SIZE(da9063_irqs),\n\t.num_regs = 4,\n\t.status_base = DA9063_REG_EVENT_A,\n\t.mask_base = DA9063_REG_IRQ_MASK_A,\n\t.ack_base = DA9063_REG_EVENT_A,\n\t.init_ack_masked = true,\n};\n\nstatic const struct regmap_irq da9063l_irqs[] = {\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_ONKEY,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_ONKEY),\n\tREGMAP_IRQ_REG(DA9063_IRQ_ADC_RDY,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_ADC_RDY),\n\tREGMAP_IRQ_REG(DA9063_IRQ_SEQ_RDY,\n\t\t       DA9063_REG_EVENT_A_OFFSET, DA9063_M_SEQ_RDY),\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_WAKE,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_WAKE),\n\tREGMAP_IRQ_REG(DA9063_IRQ_TEMP,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_TEMP),\n\tREGMAP_IRQ_REG(DA9063_IRQ_COMP_1V2,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_COMP_1V2),\n\tREGMAP_IRQ_REG(DA9063_IRQ_LDO_LIM,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_LDO_LIM),\n\tREGMAP_IRQ_REG(DA9063_IRQ_REG_UVOV,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_UVOV),\n\tREGMAP_IRQ_REG(DA9063_IRQ_DVC_RDY,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_DVC_RDY),\n\tREGMAP_IRQ_REG(DA9063_IRQ_VDD_MON,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_VDD_MON),\n\tREGMAP_IRQ_REG(DA9063_IRQ_WARN,\n\t\t       DA9063_REG_EVENT_B_OFFSET, DA9063_M_VDD_WARN),\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI0,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI0),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI1,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI1),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI2,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI2),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI3,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI3),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI4,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI4),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI5,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI5),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI6,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI6),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI7,\n\t\t       DA9063_REG_EVENT_C_OFFSET, DA9063_M_GPI7),\n\t \n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI8,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI8),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI9,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI9),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI10,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI10),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI11,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI11),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI12,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI12),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI13,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI13),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI14,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI14),\n\tREGMAP_IRQ_REG(DA9063_IRQ_GPI15,\n\t\t       DA9063_REG_EVENT_D_OFFSET, DA9063_M_GPI15),\n};\n\nstatic const struct regmap_irq_chip da9063l_irq_chip = {\n\t.name = \"da9063l-irq\",\n\t.irqs = da9063l_irqs,\n\t.num_irqs = ARRAY_SIZE(da9063l_irqs),\n\t.num_regs = 4,\n\t.status_base = DA9063_REG_EVENT_A,\n\t.mask_base = DA9063_REG_IRQ_MASK_A,\n\t.ack_base = DA9063_REG_EVENT_A,\n\t.init_ack_masked = true,\n};\n\nint da9063_irq_init(struct da9063 *da9063)\n{\n\tconst struct regmap_irq_chip *irq_chip;\n\tint ret;\n\n\tif (!da9063->chip_irq) {\n\t\tdev_err(da9063->dev, \"No IRQ configured\\n\");\n\t\treturn -EINVAL;\n\t}\n\n\tif (da9063->type == PMIC_TYPE_DA9063)\n\t\tirq_chip = &da9063_irq_chip;\n\telse\n\t\tirq_chip = &da9063l_irq_chip;\n\n\tret = devm_regmap_add_irq_chip(da9063->dev, da9063->regmap,\n\t\t\tda9063->chip_irq,\n\t\t\tIRQF_TRIGGER_LOW | IRQF_ONESHOT | IRQF_SHARED,\n\t\t\tda9063->irq_base, irq_chip, &da9063->regmap_irq);\n\tif (ret) {\n\t\tdev_err(da9063->dev, \"Failed to reguest IRQ %d: %d\\n\",\n\t\t\t\tda9063->chip_irq, ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}