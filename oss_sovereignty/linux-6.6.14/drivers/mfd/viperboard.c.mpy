{
  "module_name": "viperboard.c",
  "hash_id": "866228390da2ad6aad3c551187cba2562c02f0b1e3bdb9080111dcf1831f570a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/viperboard.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/errno.h>\n#include <linux/module.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n#include <linux/mutex.h>\n\n#include <linux/mfd/core.h>\n#include <linux/mfd/viperboard.h>\n\n#include <linux/usb.h>\n\n\nstatic const struct usb_device_id vprbrd_table[] = {\n\t{ USB_DEVICE(0x2058, 0x1005) },    \n\t{ }                                \n};\n\nMODULE_DEVICE_TABLE(usb, vprbrd_table);\n\nstatic const struct mfd_cell vprbrd_devs[] = {\n\t{\n\t\t.name = \"viperboard-gpio\",\n\t},\n\t{\n\t\t.name = \"viperboard-i2c\",\n\t},\n\t{\n\t\t.name = \"viperboard-adc\",\n\t},\n};\n\nstatic int vprbrd_probe(struct usb_interface *interface,\n\t\t\t      const struct usb_device_id *id)\n{\n\tstruct vprbrd *vb;\n\n\tu16 version = 0;\n\tint pipe, ret;\n\n\t \n\tvb = kzalloc(sizeof(*vb), GFP_KERNEL);\n\tif (!vb)\n\t\treturn -ENOMEM;\n\n\tmutex_init(&vb->lock);\n\n\tvb->usb_dev = usb_get_dev(interface_to_usbdev(interface));\n\n\t \n\tusb_set_intfdata(interface, vb);\n\tdev_set_drvdata(&vb->pdev.dev, vb);\n\n\t \n\tpipe = usb_rcvctrlpipe(vb->usb_dev, 0);\n\tret = usb_control_msg(vb->usb_dev, pipe, VPRBRD_USB_REQUEST_MAJOR,\n\t\tVPRBRD_USB_TYPE_IN, 0x0000, 0x0000, vb->buf, 1,\n\t\tVPRBRD_USB_TIMEOUT_MS);\n\tif (ret == 1)\n\t\tversion = vb->buf[0];\n\n\tret = usb_control_msg(vb->usb_dev, pipe, VPRBRD_USB_REQUEST_MINOR,\n\t\tVPRBRD_USB_TYPE_IN, 0x0000, 0x0000, vb->buf, 1,\n\t\tVPRBRD_USB_TIMEOUT_MS);\n\tif (ret == 1) {\n\t\tversion <<= 8;\n\t\tversion = version | vb->buf[0];\n\t}\n\n\tdev_info(&interface->dev,\n\t\t \"version %x.%02x found at bus %03d address %03d\\n\",\n\t\t version >> 8, version & 0xff,\n\t\t vb->usb_dev->bus->busnum, vb->usb_dev->devnum);\n\n\tret = mfd_add_hotplug_devices(&interface->dev, vprbrd_devs,\n\t\t\t\t      ARRAY_SIZE(vprbrd_devs));\n\tif (ret != 0) {\n\t\tdev_err(&interface->dev, \"Failed to add mfd devices to core.\");\n\t\tgoto error;\n\t}\n\n\treturn 0;\n\nerror:\n\tif (vb) {\n\t\tusb_put_dev(vb->usb_dev);\n\t\tkfree(vb);\n\t}\n\n\treturn ret;\n}\n\nstatic void vprbrd_disconnect(struct usb_interface *interface)\n{\n\tstruct vprbrd *vb = usb_get_intfdata(interface);\n\n\tmfd_remove_devices(&interface->dev);\n\tusb_set_intfdata(interface, NULL);\n\tusb_put_dev(vb->usb_dev);\n\tkfree(vb);\n\n\tdev_dbg(&interface->dev, \"disconnected\\n\");\n}\n\nstatic struct usb_driver vprbrd_driver = {\n\t.name\t\t= \"viperboard\",\n\t.probe\t\t= vprbrd_probe,\n\t.disconnect\t= vprbrd_disconnect,\n\t.id_table\t= vprbrd_table,\n};\n\nmodule_usb_driver(vprbrd_driver);\n\nMODULE_DESCRIPTION(\"Nano River Technologies viperboard mfd core driver\");\nMODULE_AUTHOR(\"Lars Poeschel <poeschel@lemonage.de>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}