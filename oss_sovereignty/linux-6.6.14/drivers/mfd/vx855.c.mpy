{
  "module_name": "vx855.c",
  "hash_id": "2b2002a7a7bf1ad2732918b60cb46a6c603edacd7a037ce0d38f9af11413fa64",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/vx855.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/platform_device.h>\n#include <linux/pci.h>\n#include <linux/mfd/core.h>\n\n \n#define VX855_CFG_PMIO_OFFSET\t0x88\n\n \n#define VX855_PMIO_ACPI\t\t0x00\n#define VX855_PMIO_ACPI_LEN\t0x0b\n\n \n#define VX855_PMIO_PPM\t\t0x10\n#define VX855_PMIO_PPM_LEN\t0x08\n\n \n#define VX855_PMIO_GPPM\t\t0x20\n#define VX855_PMIO_R_GPI\t0x48\n#define VX855_PMIO_R_GPO\t0x4c\n#define VX855_PMIO_GPPM_LEN\t0x33\n\n#define VSPIC_MMIO_SIZE\t0x1000\n\nstatic struct resource vx855_gpio_resources[] = {\n\t{\n\t\t.flags = IORESOURCE_IO,\n\t},\n\t{\n\t\t.flags = IORESOURCE_IO,\n\t},\n};\n\nstatic const struct mfd_cell vx855_cells[] = {\n\t{\n\t\t.name = \"vx855_gpio\",\n\t\t.num_resources = ARRAY_SIZE(vx855_gpio_resources),\n\t\t.resources = vx855_gpio_resources,\n\n\t\t \n\t\t.ignore_resource_conflicts = true,\n\t},\n};\n\nstatic int vx855_probe(struct pci_dev *pdev,\n\t\t\t\t const struct pci_device_id *id)\n{\n\tint ret;\n\tu16 gpio_io_offset;\n\n\tret = pci_enable_device(pdev);\n\tif (ret)\n\t\treturn -ENODEV;\n\n\tpci_read_config_word(pdev, VX855_CFG_PMIO_OFFSET, &gpio_io_offset);\n\tif (!gpio_io_offset) {\n\t\tdev_warn(&pdev->dev,\n\t\t\t\"BIOS did not assign PMIO base offset?!?\\n\");\n\t\tret = -ENODEV;\n\t\tgoto out;\n\t}\n\n\t \n\tgpio_io_offset &= 0xff80;\n\n\t \n\tvx855_gpio_resources[0].start = gpio_io_offset + VX855_PMIO_R_GPI;\n\tvx855_gpio_resources[0].end = vx855_gpio_resources[0].start + 3;\n\tvx855_gpio_resources[1].start = gpio_io_offset + VX855_PMIO_R_GPO;\n\tvx855_gpio_resources[1].end = vx855_gpio_resources[1].start + 3;\n\n\tret = mfd_add_devices(&pdev->dev, -1, vx855_cells, ARRAY_SIZE(vx855_cells),\n\t\t\tNULL, 0, NULL);\n\n\t \n\treturn -ENODEV;\nout:\n\tpci_disable_device(pdev);\n\treturn ret;\n}\n\nstatic void vx855_remove(struct pci_dev *pdev)\n{\n\tmfd_remove_devices(&pdev->dev);\n\tpci_disable_device(pdev);\n}\n\nstatic const struct pci_device_id vx855_pci_tbl[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_VIA, PCI_DEVICE_ID_VIA_VX855) },\n\t{ 0, }\n};\nMODULE_DEVICE_TABLE(pci, vx855_pci_tbl);\n\nstatic struct pci_driver vx855_pci_driver = {\n\t.name\t\t= \"vx855\",\n\t.id_table\t= vx855_pci_tbl,\n\t.probe\t\t= vx855_probe,\n\t.remove\t\t= vx855_remove,\n};\n\nmodule_pci_driver(vx855_pci_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Harald Welte <HaraldWelte@viatech.com>\");\nMODULE_DESCRIPTION(\"Driver for the VIA VX855 chipset\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}