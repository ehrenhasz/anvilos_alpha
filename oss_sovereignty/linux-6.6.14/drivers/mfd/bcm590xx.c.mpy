{
  "module_name": "bcm590xx.c",
  "hash_id": "a5c8a1cc6908934e2be9d84712a5c47ead8c1be9072fbfcaf05415adcf329756",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/bcm590xx.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/i2c.h>\n#include <linux/init.h>\n#include <linux/mfd/bcm590xx.h>\n#include <linux/mfd/core.h>\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/of.h>\n#include <linux/regmap.h>\n#include <linux/slab.h>\n\nstatic const struct mfd_cell bcm590xx_devs[] = {\n\t{\n\t\t.name = \"bcm590xx-vregs\",\n\t},\n};\n\nstatic const struct regmap_config bcm590xx_regmap_config_pri = {\n\t.reg_bits\t= 8,\n\t.val_bits\t= 8,\n\t.max_register\t= BCM590XX_MAX_REGISTER_PRI,\n\t.cache_type\t= REGCACHE_RBTREE,\n};\n\nstatic const struct regmap_config bcm590xx_regmap_config_sec = {\n\t.reg_bits\t= 8,\n\t.val_bits\t= 8,\n\t.max_register\t= BCM590XX_MAX_REGISTER_SEC,\n\t.cache_type\t= REGCACHE_RBTREE,\n};\n\nstatic int bcm590xx_i2c_probe(struct i2c_client *i2c_pri)\n{\n\tstruct bcm590xx *bcm590xx;\n\tint ret;\n\n\tbcm590xx = devm_kzalloc(&i2c_pri->dev, sizeof(*bcm590xx), GFP_KERNEL);\n\tif (!bcm590xx)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c_pri, bcm590xx);\n\tbcm590xx->dev = &i2c_pri->dev;\n\tbcm590xx->i2c_pri = i2c_pri;\n\n\tbcm590xx->regmap_pri = devm_regmap_init_i2c(i2c_pri,\n\t\t\t\t\t\t &bcm590xx_regmap_config_pri);\n\tif (IS_ERR(bcm590xx->regmap_pri)) {\n\t\tret = PTR_ERR(bcm590xx->regmap_pri);\n\t\tdev_err(&i2c_pri->dev, \"primary regmap init failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\t \n\tbcm590xx->i2c_sec = i2c_new_dummy_device(i2c_pri->adapter,\n\t\t\t\t\t  i2c_pri->addr | BIT(2));\n\tif (IS_ERR(bcm590xx->i2c_sec)) {\n\t\tdev_err(&i2c_pri->dev, \"failed to add secondary I2C device\\n\");\n\t\treturn PTR_ERR(bcm590xx->i2c_sec);\n\t}\n\ti2c_set_clientdata(bcm590xx->i2c_sec, bcm590xx);\n\n\tbcm590xx->regmap_sec = devm_regmap_init_i2c(bcm590xx->i2c_sec,\n\t\t\t\t\t\t&bcm590xx_regmap_config_sec);\n\tif (IS_ERR(bcm590xx->regmap_sec)) {\n\t\tret = PTR_ERR(bcm590xx->regmap_sec);\n\t\tdev_err(&bcm590xx->i2c_sec->dev,\n\t\t\t\"secondary regmap init failed: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\n\tret = devm_mfd_add_devices(&i2c_pri->dev, -1, bcm590xx_devs,\n\t\t\t\t   ARRAY_SIZE(bcm590xx_devs), NULL, 0, NULL);\n\tif (ret < 0) {\n\t\tdev_err(&i2c_pri->dev, \"failed to add sub-devices: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\n\treturn 0;\n\nerr:\n\ti2c_unregister_device(bcm590xx->i2c_sec);\n\treturn ret;\n}\n\nstatic const struct of_device_id bcm590xx_of_match[] = {\n\t{ .compatible = \"brcm,bcm59056\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(of, bcm590xx_of_match);\n\nstatic const struct i2c_device_id bcm590xx_i2c_id[] = {\n\t{ \"bcm59056\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, bcm590xx_i2c_id);\n\nstatic struct i2c_driver bcm590xx_i2c_driver = {\n\t.driver = {\n\t\t   .name = \"bcm590xx\",\n\t\t   .of_match_table = bcm590xx_of_match,\n\t},\n\t.probe = bcm590xx_i2c_probe,\n\t.id_table = bcm590xx_i2c_id,\n};\nmodule_i2c_driver(bcm590xx_i2c_driver);\n\nMODULE_AUTHOR(\"Matt Porter <mporter@linaro.org>\");\nMODULE_DESCRIPTION(\"BCM590xx multi-function driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}