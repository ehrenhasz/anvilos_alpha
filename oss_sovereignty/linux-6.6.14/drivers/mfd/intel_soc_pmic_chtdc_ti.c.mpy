{
  "module_name": "intel_soc_pmic_chtdc_ti.c",
  "hash_id": "a8ed818f3b36f4b837a1c6e5356e56da40f5676a998065b48b30f847fcf6f1cf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/intel_soc_pmic_chtdc_ti.c",
  "human_readable_source": "\n \n\n#include <linux/acpi.h>\n#include <linux/interrupt.h>\n#include <linux/i2c.h>\n#include <linux/mfd/core.h>\n#include <linux/mfd/intel_soc_pmic.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n\n#define CHTDC_TI_IRQLVL1\t0x01\n#define CHTDC_TI_MASK_IRQLVL1\t0x02\n\n \nenum {\n\tCHTDC_TI_PWRBTN = 0,\t \n\tCHTDC_TI_DIETMPWARN,\t \n\tCHTDC_TI_ADCCMPL,\t \n\t \n\tCHTDC_TI_VBATLOW = 4,\t \n\tCHTDC_TI_VBUSDET,\t \n\t \n\tCHTDC_TI_CCEOCAL = 7,\t \n};\n\nstatic const struct resource power_button_resources[] = {\n\tDEFINE_RES_IRQ(CHTDC_TI_PWRBTN),\n};\n\nstatic const struct resource thermal_resources[] = {\n\tDEFINE_RES_IRQ(CHTDC_TI_DIETMPWARN),\n};\n\nstatic const struct resource adc_resources[] = {\n\tDEFINE_RES_IRQ(CHTDC_TI_ADCCMPL),\n};\n\nstatic const struct resource pwrsrc_resources[] = {\n\tDEFINE_RES_IRQ(CHTDC_TI_VBUSDET),\n};\n\nstatic const struct resource battery_resources[] = {\n\tDEFINE_RES_IRQ(CHTDC_TI_VBATLOW),\n\tDEFINE_RES_IRQ(CHTDC_TI_CCEOCAL),\n};\n\nstatic struct mfd_cell chtdc_ti_dev[] = {\n\t{\n\t\t.name = \"chtdc_ti_pwrbtn\",\n\t\t.num_resources = ARRAY_SIZE(power_button_resources),\n\t\t.resources = power_button_resources,\n\t}, {\n\t\t.name = \"chtdc_ti_adc\",\n\t\t.num_resources = ARRAY_SIZE(adc_resources),\n\t\t.resources = adc_resources,\n\t}, {\n\t\t.name = \"chtdc_ti_thermal\",\n\t\t.num_resources = ARRAY_SIZE(thermal_resources),\n\t\t.resources = thermal_resources,\n\t}, {\n\t\t.name = \"chtdc_ti_pwrsrc\",\n\t\t.num_resources = ARRAY_SIZE(pwrsrc_resources),\n\t\t.resources = pwrsrc_resources,\n\t}, {\n\t\t.name = \"chtdc_ti_battery\",\n\t\t.num_resources = ARRAY_SIZE(battery_resources),\n\t\t.resources = battery_resources,\n\t},\n\t{\t.name = \"chtdc_ti_region\", },\n};\n\nstatic const struct regmap_config chtdc_ti_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\t.max_register = 128,\n\t.cache_type = REGCACHE_NONE,\n};\n\nstatic const struct regmap_irq chtdc_ti_irqs[] = {\n\tREGMAP_IRQ_REG(CHTDC_TI_PWRBTN, 0, BIT(CHTDC_TI_PWRBTN)),\n\tREGMAP_IRQ_REG(CHTDC_TI_DIETMPWARN, 0, BIT(CHTDC_TI_DIETMPWARN)),\n\tREGMAP_IRQ_REG(CHTDC_TI_ADCCMPL, 0, BIT(CHTDC_TI_ADCCMPL)),\n\tREGMAP_IRQ_REG(CHTDC_TI_VBATLOW, 0, BIT(CHTDC_TI_VBATLOW)),\n\tREGMAP_IRQ_REG(CHTDC_TI_VBUSDET, 0, BIT(CHTDC_TI_VBUSDET)),\n\tREGMAP_IRQ_REG(CHTDC_TI_CCEOCAL, 0, BIT(CHTDC_TI_CCEOCAL)),\n};\n\nstatic const struct regmap_irq_chip chtdc_ti_irq_chip = {\n\t.name = KBUILD_MODNAME,\n\t.irqs = chtdc_ti_irqs,\n\t.num_irqs = ARRAY_SIZE(chtdc_ti_irqs),\n\t.num_regs = 1,\n\t.status_base = CHTDC_TI_IRQLVL1,\n\t.mask_base = CHTDC_TI_MASK_IRQLVL1,\n\t.ack_base = CHTDC_TI_IRQLVL1,\n};\n\nstatic int chtdc_ti_probe(struct i2c_client *i2c)\n{\n\tstruct device *dev = &i2c->dev;\n\tstruct intel_soc_pmic *pmic;\n\tint ret;\n\n\tpmic = devm_kzalloc(dev, sizeof(*pmic), GFP_KERNEL);\n\tif (!pmic)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, pmic);\n\n\tpmic->regmap = devm_regmap_init_i2c(i2c, &chtdc_ti_regmap_config);\n\tif (IS_ERR(pmic->regmap))\n\t\treturn PTR_ERR(pmic->regmap);\n\tpmic->irq = i2c->irq;\n\n\tret = devm_regmap_add_irq_chip(dev, pmic->regmap, pmic->irq,\n\t\t\t\t       IRQF_ONESHOT, 0,\n\t\t\t\t       &chtdc_ti_irq_chip,\n\t\t\t\t       &pmic->irq_chip_data);\n\tif (ret)\n\t\treturn ret;\n\n\treturn devm_mfd_add_devices(dev, PLATFORM_DEVID_NONE, chtdc_ti_dev,\n\t\t\t\t    ARRAY_SIZE(chtdc_ti_dev), NULL, 0,\n\t\t\t\t    regmap_irq_get_domain(pmic->irq_chip_data));\n}\n\nstatic void chtdc_ti_shutdown(struct i2c_client *i2c)\n{\n\tstruct intel_soc_pmic *pmic = i2c_get_clientdata(i2c);\n\n\tdisable_irq(pmic->irq);\n}\n\nstatic int chtdc_ti_suspend(struct device *dev)\n{\n\tstruct intel_soc_pmic *pmic = dev_get_drvdata(dev);\n\n\tdisable_irq(pmic->irq);\n\n\treturn 0;\n}\n\nstatic int chtdc_ti_resume(struct device *dev)\n{\n\tstruct intel_soc_pmic *pmic = dev_get_drvdata(dev);\n\n\tenable_irq(pmic->irq);\n\n\treturn 0;\n}\n\nstatic DEFINE_SIMPLE_DEV_PM_OPS(chtdc_ti_pm_ops, chtdc_ti_suspend, chtdc_ti_resume);\n\nstatic const struct acpi_device_id chtdc_ti_acpi_ids[] = {\n\t{ \"INT33F5\" },\n\t{ },\n};\nMODULE_DEVICE_TABLE(acpi, chtdc_ti_acpi_ids);\n\nstatic struct i2c_driver chtdc_ti_i2c_driver = {\n\t.driver = {\n\t\t.name = \"intel_soc_pmic_chtdc_ti\",\n\t\t.pm = pm_sleep_ptr(&chtdc_ti_pm_ops),\n\t\t.acpi_match_table = chtdc_ti_acpi_ids,\n\t},\n\t.probe = chtdc_ti_probe,\n\t.shutdown = chtdc_ti_shutdown,\n};\nmodule_i2c_driver(chtdc_ti_i2c_driver);\n\nMODULE_DESCRIPTION(\"I2C driver for Intel SoC Dollar Cove TI PMIC\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}