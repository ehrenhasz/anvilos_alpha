{
  "module_name": "sec-irq.c",
  "hash_id": "23cff226f6de09785548dbcd97e86b2237b5d664cc294efa77c208b9bc0caeb8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/sec-irq.c",
  "human_readable_source": "\n\n\n\n\n#include <linux/device.h>\n#include <linux/interrupt.h>\n#include <linux/irq.h>\n#include <linux/module.h>\n#include <linux/regmap.h>\n\n#include <linux/mfd/samsung/core.h>\n#include <linux/mfd/samsung/irq.h>\n#include <linux/mfd/samsung/s2mps11.h>\n#include <linux/mfd/samsung/s2mps14.h>\n#include <linux/mfd/samsung/s2mpu02.h>\n#include <linux/mfd/samsung/s5m8767.h>\n\nstatic const struct regmap_irq s2mps11_irqs[] = {\n\t[S2MPS11_IRQ_PWRONF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRONF_MASK,\n\t},\n\t[S2MPS11_IRQ_PWRONR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRONR_MASK,\n\t},\n\t[S2MPS11_IRQ_JIGONBF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_JIGONBF_MASK,\n\t},\n\t[S2MPS11_IRQ_JIGONBR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_JIGONBR_MASK,\n\t},\n\t[S2MPS11_IRQ_ACOKBF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_ACOKBF_MASK,\n\t},\n\t[S2MPS11_IRQ_ACOKBR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_ACOKBR_MASK,\n\t},\n\t[S2MPS11_IRQ_PWRON1S] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRON1S_MASK,\n\t},\n\t[S2MPS11_IRQ_MRB] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_MRB_MASK,\n\t},\n\t[S2MPS11_IRQ_RTC60S] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTC60S_MASK,\n\t},\n\t[S2MPS11_IRQ_RTCA1] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTCA1_MASK,\n\t},\n\t[S2MPS11_IRQ_RTCA0] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTCA0_MASK,\n\t},\n\t[S2MPS11_IRQ_SMPL] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_SMPL_MASK,\n\t},\n\t[S2MPS11_IRQ_RTC1S] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTC1S_MASK,\n\t},\n\t[S2MPS11_IRQ_WTSR] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_WTSR_MASK,\n\t},\n\t[S2MPS11_IRQ_INT120C] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS11_IRQ_INT120C_MASK,\n\t},\n\t[S2MPS11_IRQ_INT140C] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS11_IRQ_INT140C_MASK,\n\t},\n};\n\nstatic const struct regmap_irq s2mps14_irqs[] = {\n\t[S2MPS14_IRQ_PWRONF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRONF_MASK,\n\t},\n\t[S2MPS14_IRQ_PWRONR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRONR_MASK,\n\t},\n\t[S2MPS14_IRQ_JIGONBF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_JIGONBF_MASK,\n\t},\n\t[S2MPS14_IRQ_JIGONBR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_JIGONBR_MASK,\n\t},\n\t[S2MPS14_IRQ_ACOKBF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_ACOKBF_MASK,\n\t},\n\t[S2MPS14_IRQ_ACOKBR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_ACOKBR_MASK,\n\t},\n\t[S2MPS14_IRQ_PWRON1S] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRON1S_MASK,\n\t},\n\t[S2MPS14_IRQ_MRB] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_MRB_MASK,\n\t},\n\t[S2MPS14_IRQ_RTC60S] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTC60S_MASK,\n\t},\n\t[S2MPS14_IRQ_RTCA1] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTCA1_MASK,\n\t},\n\t[S2MPS14_IRQ_RTCA0] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTCA0_MASK,\n\t},\n\t[S2MPS14_IRQ_SMPL] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_SMPL_MASK,\n\t},\n\t[S2MPS14_IRQ_RTC1S] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTC1S_MASK,\n\t},\n\t[S2MPS14_IRQ_WTSR] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_WTSR_MASK,\n\t},\n\t[S2MPS14_IRQ_INT120C] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS11_IRQ_INT120C_MASK,\n\t},\n\t[S2MPS14_IRQ_INT140C] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS11_IRQ_INT140C_MASK,\n\t},\n\t[S2MPS14_IRQ_TSD] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS14_IRQ_TSD_MASK,\n\t},\n};\n\nstatic const struct regmap_irq s2mpu02_irqs[] = {\n\t[S2MPU02_IRQ_PWRONF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRONF_MASK,\n\t},\n\t[S2MPU02_IRQ_PWRONR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRONR_MASK,\n\t},\n\t[S2MPU02_IRQ_JIGONBF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_JIGONBF_MASK,\n\t},\n\t[S2MPU02_IRQ_JIGONBR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_JIGONBR_MASK,\n\t},\n\t[S2MPU02_IRQ_ACOKBF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_ACOKBF_MASK,\n\t},\n\t[S2MPU02_IRQ_ACOKBR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_ACOKBR_MASK,\n\t},\n\t[S2MPU02_IRQ_PWRON1S] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_PWRON1S_MASK,\n\t},\n\t[S2MPU02_IRQ_MRB] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S2MPS11_IRQ_MRB_MASK,\n\t},\n\t[S2MPU02_IRQ_RTC60S] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTC60S_MASK,\n\t},\n\t[S2MPU02_IRQ_RTCA1] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTCA1_MASK,\n\t},\n\t[S2MPU02_IRQ_RTCA0] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTCA0_MASK,\n\t},\n\t[S2MPU02_IRQ_SMPL] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_SMPL_MASK,\n\t},\n\t[S2MPU02_IRQ_RTC1S] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_RTC1S_MASK,\n\t},\n\t[S2MPU02_IRQ_WTSR] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S2MPS11_IRQ_WTSR_MASK,\n\t},\n\t[S2MPU02_IRQ_INT120C] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS11_IRQ_INT120C_MASK,\n\t},\n\t[S2MPU02_IRQ_INT140C] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS11_IRQ_INT140C_MASK,\n\t},\n\t[S2MPU02_IRQ_TSD] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S2MPS14_IRQ_TSD_MASK,\n\t},\n};\n\nstatic const struct regmap_irq s5m8767_irqs[] = {\n\t[S5M8767_IRQ_PWRR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S5M8767_IRQ_PWRR_MASK,\n\t},\n\t[S5M8767_IRQ_PWRF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S5M8767_IRQ_PWRF_MASK,\n\t},\n\t[S5M8767_IRQ_PWR1S] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S5M8767_IRQ_PWR1S_MASK,\n\t},\n\t[S5M8767_IRQ_JIGR] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S5M8767_IRQ_JIGR_MASK,\n\t},\n\t[S5M8767_IRQ_JIGF] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S5M8767_IRQ_JIGF_MASK,\n\t},\n\t[S5M8767_IRQ_LOWBAT2] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S5M8767_IRQ_LOWBAT2_MASK,\n\t},\n\t[S5M8767_IRQ_LOWBAT1] = {\n\t\t.reg_offset = 0,\n\t\t.mask = S5M8767_IRQ_LOWBAT1_MASK,\n\t},\n\t[S5M8767_IRQ_MRB] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S5M8767_IRQ_MRB_MASK,\n\t},\n\t[S5M8767_IRQ_DVSOK2] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S5M8767_IRQ_DVSOK2_MASK,\n\t},\n\t[S5M8767_IRQ_DVSOK3] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S5M8767_IRQ_DVSOK3_MASK,\n\t},\n\t[S5M8767_IRQ_DVSOK4] = {\n\t\t.reg_offset = 1,\n\t\t.mask = S5M8767_IRQ_DVSOK4_MASK,\n\t},\n\t[S5M8767_IRQ_RTC60S] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S5M8767_IRQ_RTC60S_MASK,\n\t},\n\t[S5M8767_IRQ_RTCA1] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S5M8767_IRQ_RTCA1_MASK,\n\t},\n\t[S5M8767_IRQ_RTCA2] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S5M8767_IRQ_RTCA2_MASK,\n\t},\n\t[S5M8767_IRQ_SMPL] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S5M8767_IRQ_SMPL_MASK,\n\t},\n\t[S5M8767_IRQ_RTC1S] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S5M8767_IRQ_RTC1S_MASK,\n\t},\n\t[S5M8767_IRQ_WTSR] = {\n\t\t.reg_offset = 2,\n\t\t.mask = S5M8767_IRQ_WTSR_MASK,\n\t},\n};\n\nstatic const struct regmap_irq_chip s2mps11_irq_chip = {\n\t.name = \"s2mps11\",\n\t.irqs = s2mps11_irqs,\n\t.num_irqs = ARRAY_SIZE(s2mps11_irqs),\n\t.num_regs = 3,\n\t.status_base = S2MPS11_REG_INT1,\n\t.mask_base = S2MPS11_REG_INT1M,\n\t.ack_base = S2MPS11_REG_INT1,\n};\n\n#define S2MPS1X_IRQ_CHIP_COMMON_DATA\t\t\\\n\t.irqs = s2mps14_irqs,\t\t\t\\\n\t.num_irqs = ARRAY_SIZE(s2mps14_irqs),\t\\\n\t.num_regs = 3,\t\t\t\t\\\n\t.status_base = S2MPS14_REG_INT1,\t\\\n\t.mask_base = S2MPS14_REG_INT1M,\t\t\\\n\t.ack_base = S2MPS14_REG_INT1\t\t\\\n\nstatic const struct regmap_irq_chip s2mps13_irq_chip = {\n\t.name = \"s2mps13\",\n\tS2MPS1X_IRQ_CHIP_COMMON_DATA,\n};\n\nstatic const struct regmap_irq_chip s2mps14_irq_chip = {\n\t.name = \"s2mps14\",\n\tS2MPS1X_IRQ_CHIP_COMMON_DATA,\n};\n\nstatic const struct regmap_irq_chip s2mps15_irq_chip = {\n\t.name = \"s2mps15\",\n\tS2MPS1X_IRQ_CHIP_COMMON_DATA,\n};\n\nstatic const struct regmap_irq_chip s2mpu02_irq_chip = {\n\t.name = \"s2mpu02\",\n\t.irqs = s2mpu02_irqs,\n\t.num_irqs = ARRAY_SIZE(s2mpu02_irqs),\n\t.num_regs = 3,\n\t.status_base = S2MPU02_REG_INT1,\n\t.mask_base = S2MPU02_REG_INT1M,\n\t.ack_base = S2MPU02_REG_INT1,\n};\n\nstatic const struct regmap_irq_chip s5m8767_irq_chip = {\n\t.name = \"s5m8767\",\n\t.irqs = s5m8767_irqs,\n\t.num_irqs = ARRAY_SIZE(s5m8767_irqs),\n\t.num_regs = 3,\n\t.status_base = S5M8767_REG_INT1,\n\t.mask_base = S5M8767_REG_INT1M,\n\t.ack_base = S5M8767_REG_INT1,\n};\n\nint sec_irq_init(struct sec_pmic_dev *sec_pmic)\n{\n\tint ret = 0;\n\tint type = sec_pmic->device_type;\n\tconst struct regmap_irq_chip *sec_irq_chip;\n\n\tif (!sec_pmic->irq) {\n\t\tdev_warn(sec_pmic->dev,\n\t\t\t \"No interrupt specified, no interrupts\\n\");\n\t\treturn 0;\n\t}\n\n\tswitch (type) {\n\tcase S5M8767X:\n\t\tsec_irq_chip = &s5m8767_irq_chip;\n\t\tbreak;\n\tcase S2MPA01:\n\t\tsec_irq_chip = &s2mps14_irq_chip;\n\t\tbreak;\n\tcase S2MPS11X:\n\t\tsec_irq_chip = &s2mps11_irq_chip;\n\t\tbreak;\n\tcase S2MPS13X:\n\t\tsec_irq_chip = &s2mps13_irq_chip;\n\t\tbreak;\n\tcase S2MPS14X:\n\t\tsec_irq_chip = &s2mps14_irq_chip;\n\t\tbreak;\n\tcase S2MPS15X:\n\t\tsec_irq_chip = &s2mps15_irq_chip;\n\t\tbreak;\n\tcase S2MPU02:\n\t\tsec_irq_chip = &s2mpu02_irq_chip;\n\t\tbreak;\n\tdefault:\n\t\tdev_err(sec_pmic->dev, \"Unknown device type %lu\\n\",\n\t\t\tsec_pmic->device_type);\n\t\treturn -EINVAL;\n\t}\n\n\tret = devm_regmap_add_irq_chip(sec_pmic->dev, sec_pmic->regmap_pmic,\n\t\t\t\t       sec_pmic->irq, IRQF_ONESHOT,\n\t\t\t\t       0, sec_irq_chip, &sec_pmic->irq_data);\n\tif (ret != 0) {\n\t\tdev_err(sec_pmic->dev, \"Failed to register IRQ chip: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\t \n\tBUILD_BUG_ON(((enum s2mps14_irq)S2MPS11_IRQ_RTCA0) != S2MPS14_IRQ_RTCA0);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(sec_irq_init);\n\nMODULE_AUTHOR(\"Sangbeom Kim <sbkim73@samsung.com>\");\nMODULE_AUTHOR(\"Chanwoo Choi <cw00.choi@samsung.com>\");\nMODULE_AUTHOR(\"Krzysztof Kozlowski <krzk@kernel.org>\");\nMODULE_DESCRIPTION(\"Interrupt support for the S5M MFD\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}