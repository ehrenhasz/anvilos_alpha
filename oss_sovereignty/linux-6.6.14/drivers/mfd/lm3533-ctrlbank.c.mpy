{
  "module_name": "lm3533-ctrlbank.c",
  "hash_id": "6d4b1f8c403e3de5f89bf7592a27bf174c19e62925165ada9f2a2cb105cd4ffb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/lm3533-ctrlbank.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/module.h>\n\n#include <linux/mfd/lm3533.h>\n\n\n#define LM3533_MAX_CURRENT_MIN\t\t5000\n#define LM3533_MAX_CURRENT_MAX\t\t29800\n#define LM3533_MAX_CURRENT_STEP\t\t800\n\n#define LM3533_PWM_MAX\t\t\t0x3f\n\n#define LM3533_REG_PWM_BASE\t\t0x14\n#define LM3533_REG_MAX_CURRENT_BASE\t0x1f\n#define LM3533_REG_CTRLBANK_ENABLE\t0x27\n#define LM3533_REG_BRIGHTNESS_BASE\t0x40\n\n\nstatic inline u8 lm3533_ctrlbank_get_reg(struct lm3533_ctrlbank *cb, u8 base)\n{\n\treturn base + cb->id;\n}\n\nint lm3533_ctrlbank_enable(struct lm3533_ctrlbank *cb)\n{\n\tu8 mask;\n\tint ret;\n\n\tdev_dbg(cb->dev, \"%s - %d\\n\", __func__, cb->id);\n\n\tmask = 1 << cb->id;\n\tret = lm3533_update(cb->lm3533, LM3533_REG_CTRLBANK_ENABLE,\n\t\t\t\t\t\t\t\tmask, mask);\n\tif (ret)\n\t\tdev_err(cb->dev, \"failed to enable ctrlbank %d\\n\", cb->id);\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(lm3533_ctrlbank_enable);\n\nint lm3533_ctrlbank_disable(struct lm3533_ctrlbank *cb)\n{\n\tu8 mask;\n\tint ret;\n\n\tdev_dbg(cb->dev, \"%s - %d\\n\", __func__, cb->id);\n\n\tmask = 1 << cb->id;\n\tret = lm3533_update(cb->lm3533, LM3533_REG_CTRLBANK_ENABLE, 0, mask);\n\tif (ret)\n\t\tdev_err(cb->dev, \"failed to disable ctrlbank %d\\n\", cb->id);\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(lm3533_ctrlbank_disable);\n\n \nint lm3533_ctrlbank_set_max_current(struct lm3533_ctrlbank *cb, u16 imax)\n{\n\tu8 reg;\n\tu8 val;\n\tint ret;\n\n\tif (imax < LM3533_MAX_CURRENT_MIN || imax > LM3533_MAX_CURRENT_MAX)\n\t\treturn -EINVAL;\n\n\tval = (imax - LM3533_MAX_CURRENT_MIN) / LM3533_MAX_CURRENT_STEP;\n\n\treg = lm3533_ctrlbank_get_reg(cb, LM3533_REG_MAX_CURRENT_BASE);\n\tret = lm3533_write(cb->lm3533, reg, val);\n\tif (ret)\n\t\tdev_err(cb->dev, \"failed to set max current\\n\");\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(lm3533_ctrlbank_set_max_current);\n\nint lm3533_ctrlbank_set_brightness(struct lm3533_ctrlbank *cb, u8 val)\n{\n\tu8 reg;\n\tint ret;\n\n\treg = lm3533_ctrlbank_get_reg(cb, LM3533_REG_BRIGHTNESS_BASE);\n\tret = lm3533_write(cb->lm3533, reg, val);\n\tif (ret)\n\t\tdev_err(cb->dev, \"failed to set brightness\\n\");\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(lm3533_ctrlbank_set_brightness);\n\nint lm3533_ctrlbank_get_brightness(struct lm3533_ctrlbank *cb, u8 *val)\n{\n\tu8 reg;\n\tint ret;\n\n\treg = lm3533_ctrlbank_get_reg(cb, LM3533_REG_BRIGHTNESS_BASE);\n\tret = lm3533_read(cb->lm3533, reg, val);\n\tif (ret)\n\t\tdev_err(cb->dev, \"failed to get brightness\\n\");\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(lm3533_ctrlbank_get_brightness);\n\n \nint lm3533_ctrlbank_set_pwm(struct lm3533_ctrlbank *cb, u8 val)\n{\n\tu8 reg;\n\tint ret;\n\n\tif (val > LM3533_PWM_MAX)\n\t\treturn -EINVAL;\n\n\treg = lm3533_ctrlbank_get_reg(cb, LM3533_REG_PWM_BASE);\n\tret = lm3533_write(cb->lm3533, reg, val);\n\tif (ret)\n\t\tdev_err(cb->dev, \"failed to set PWM mask\\n\");\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(lm3533_ctrlbank_set_pwm);\n\nint lm3533_ctrlbank_get_pwm(struct lm3533_ctrlbank *cb, u8 *val)\n{\n\tu8 reg;\n\tint ret;\n\n\treg = lm3533_ctrlbank_get_reg(cb, LM3533_REG_PWM_BASE);\n\tret = lm3533_read(cb->lm3533, reg, val);\n\tif (ret)\n\t\tdev_err(cb->dev, \"failed to get PWM mask\\n\");\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(lm3533_ctrlbank_get_pwm);\n\nMODULE_AUTHOR(\"Johan Hovold <jhovold@gmail.com>\");\nMODULE_DESCRIPTION(\"LM3533 Control Bank interface\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}