{
  "module_name": "menf21bmc.c",
  "hash_id": "4038fb00060c608e6cca1e6549a5608a43b8b9da6a23b2b77ead1e15f87c9f4f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/menf21bmc.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/i2c.h>\n#include <linux/mfd/core.h>\n\n#define BMC_CMD_WDT_EXIT_PROD\t0x18\n#define BMC_CMD_WDT_PROD_STAT\t0x19\n#define BMC_CMD_REV_MAJOR\t0x80\n#define BMC_CMD_REV_MINOR\t0x81\n#define BMC_CMD_REV_MAIN\t0x82\n\nstatic struct mfd_cell menf21bmc_cell[] = {\n\t{ .name = \"menf21bmc_wdt\", },\n\t{ .name = \"menf21bmc_led\", },\n\t{ .name = \"menf21bmc_hwmon\", }\n};\n\nstatic int menf21bmc_wdt_exit_prod_mode(struct i2c_client *client)\n{\n\tint val, ret;\n\n\tval = i2c_smbus_read_byte_data(client, BMC_CMD_WDT_PROD_STAT);\n\tif (val < 0)\n\t\treturn val;\n\n\t \n\tif (val == 0x00) {\n\t\tdev_info(&client->dev,\n\t\t\t\"BMC in production mode. Exit production mode\\n\");\n\n\t\tret = i2c_smbus_write_byte(client, BMC_CMD_WDT_EXIT_PROD);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic int\nmenf21bmc_probe(struct i2c_client *client)\n{\n\tint rev_major, rev_minor, rev_main;\n\tint ret;\n\n\tret = i2c_check_functionality(client->adapter,\n\t\t\t\t      I2C_FUNC_SMBUS_BYTE_DATA |\n\t\t\t\t      I2C_FUNC_SMBUS_WORD_DATA |\n\t\t\t\t      I2C_FUNC_SMBUS_BYTE);\n\tif (!ret)\n\t\treturn -ENODEV;\n\n\trev_major = i2c_smbus_read_word_data(client, BMC_CMD_REV_MAJOR);\n\tif (rev_major < 0) {\n\t\tdev_err(&client->dev, \"failed to get BMC major revision\\n\");\n\t\treturn rev_major;\n\t}\n\n\trev_minor = i2c_smbus_read_word_data(client, BMC_CMD_REV_MINOR);\n\tif (rev_minor < 0) {\n\t\tdev_err(&client->dev, \"failed to get BMC minor revision\\n\");\n\t\treturn rev_minor;\n\t}\n\n\trev_main = i2c_smbus_read_word_data(client, BMC_CMD_REV_MAIN);\n\tif (rev_main < 0) {\n\t\tdev_err(&client->dev, \"failed to get BMC main revision\\n\");\n\t\treturn rev_main;\n\t}\n\n\tdev_info(&client->dev, \"FW Revision: %02d.%02d.%02d\\n\",\n\t\t rev_major, rev_minor, rev_main);\n\n\t \n\tret = menf21bmc_wdt_exit_prod_mode(client);\n\tif (ret < 0) {\n\t\tdev_err(&client->dev, \"failed to leave production mode\\n\");\n\t\treturn ret;\n\t}\n\n\tret = devm_mfd_add_devices(&client->dev, 0, menf21bmc_cell,\n\t\t\t\t   ARRAY_SIZE(menf21bmc_cell), NULL, 0, NULL);\n\tif (ret < 0) {\n\t\tdev_err(&client->dev, \"failed to add BMC sub-devices\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct i2c_device_id menf21bmc_id_table[] = {\n\t{ \"menf21bmc\" },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, menf21bmc_id_table);\n\nstatic struct i2c_driver menf21bmc_driver = {\n\t.driver.name\t= \"menf21bmc\",\n\t.id_table\t= menf21bmc_id_table,\n\t.probe\t\t= menf21bmc_probe,\n};\n\nmodule_i2c_driver(menf21bmc_driver);\n\nMODULE_DESCRIPTION(\"MEN 14F021P00 BMC mfd core driver\");\nMODULE_AUTHOR(\"Andreas Werner <andreas.werner@men.de>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}