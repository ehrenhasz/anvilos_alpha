{
  "module_name": "da9052-irq.c",
  "hash_id": "1091b717c83ce11f1f596e5dfcabc11b3d5d058ab075b4b9325baa17284087f0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/da9052-irq.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/delay.h>\n#include <linux/input.h>\n#include <linux/interrupt.h>\n#include <linux/irq.h>\n#include <linux/irqdomain.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n\n#include <linux/mfd/da9052/da9052.h>\n#include <linux/mfd/da9052/reg.h>\n\n#define DA9052_NUM_IRQ_REGS\t\t4\n#define DA9052_IRQ_MASK_POS_1\t\t0x01\n#define DA9052_IRQ_MASK_POS_2\t\t0x02\n#define DA9052_IRQ_MASK_POS_3\t\t0x04\n#define DA9052_IRQ_MASK_POS_4\t\t0x08\n#define DA9052_IRQ_MASK_POS_5\t\t0x10\n#define DA9052_IRQ_MASK_POS_6\t\t0x20\n#define DA9052_IRQ_MASK_POS_7\t\t0x40\n#define DA9052_IRQ_MASK_POS_8\t\t0x80\n\nstatic const struct regmap_irq da9052_irqs[] = {\n\t[DA9052_IRQ_DCIN] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_1,\n\t},\n\t[DA9052_IRQ_VBUS] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_2,\n\t},\n\t[DA9052_IRQ_DCINREM] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_3,\n\t},\n\t[DA9052_IRQ_VBUSREM] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_4,\n\t},\n\t[DA9052_IRQ_VDDLOW] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_5,\n\t},\n\t[DA9052_IRQ_ALARM] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_6,\n\t},\n\t[DA9052_IRQ_SEQRDY] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_7,\n\t},\n\t[DA9052_IRQ_COMP1V2] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9052_IRQ_MASK_POS_8,\n\t},\n\t[DA9052_IRQ_NONKEY] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_1,\n\t},\n\t[DA9052_IRQ_IDFLOAT] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_2,\n\t},\n\t[DA9052_IRQ_IDGND] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_3,\n\t},\n\t[DA9052_IRQ_CHGEND] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_4,\n\t},\n\t[DA9052_IRQ_TBAT] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_5,\n\t},\n\t[DA9052_IRQ_ADC_EOM] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_6,\n\t},\n\t[DA9052_IRQ_PENDOWN] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_7,\n\t},\n\t[DA9052_IRQ_TSIREADY] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9052_IRQ_MASK_POS_8,\n\t},\n\t[DA9052_IRQ_GPI0] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_1,\n\t},\n\t[DA9052_IRQ_GPI1] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_2,\n\t},\n\t[DA9052_IRQ_GPI2] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_3,\n\t},\n\t[DA9052_IRQ_GPI3] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_4,\n\t},\n\t[DA9052_IRQ_GPI4] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_5,\n\t},\n\t[DA9052_IRQ_GPI5] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_6,\n\t},\n\t[DA9052_IRQ_GPI6] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_7,\n\t},\n\t[DA9052_IRQ_GPI7] = {\n\t\t.reg_offset = 2,\n\t\t.mask = DA9052_IRQ_MASK_POS_8,\n\t},\n\t[DA9052_IRQ_GPI8] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_1,\n\t},\n\t[DA9052_IRQ_GPI9] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_2,\n\t},\n\t[DA9052_IRQ_GPI10] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_3,\n\t},\n\t[DA9052_IRQ_GPI11] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_4,\n\t},\n\t[DA9052_IRQ_GPI12] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_5,\n\t},\n\t[DA9052_IRQ_GPI13] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_6,\n\t},\n\t[DA9052_IRQ_GPI14] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_7,\n\t},\n\t[DA9052_IRQ_GPI15] = {\n\t\t.reg_offset = 3,\n\t\t.mask = DA9052_IRQ_MASK_POS_8,\n\t},\n};\n\nstatic const struct regmap_irq_chip da9052_regmap_irq_chip = {\n\t.name = \"da9052_irq\",\n\t.status_base = DA9052_EVENT_A_REG,\n\t.mask_base = DA9052_IRQ_MASK_A_REG,\n\t.ack_base = DA9052_EVENT_A_REG,\n\t.num_regs = DA9052_NUM_IRQ_REGS,\n\t.irqs = da9052_irqs,\n\t.num_irqs = ARRAY_SIZE(da9052_irqs),\n};\n\nstatic int da9052_map_irq(struct da9052 *da9052, int irq)\n{\n\treturn regmap_irq_get_virq(da9052->irq_data, irq);\n}\n\nint da9052_enable_irq(struct da9052 *da9052, int irq)\n{\n\tirq = da9052_map_irq(da9052, irq);\n\tif (irq < 0)\n\t\treturn irq;\n\n\tenable_irq(irq);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(da9052_enable_irq);\n\nint da9052_disable_irq(struct da9052 *da9052, int irq)\n{\n\tirq = da9052_map_irq(da9052, irq);\n\tif (irq < 0)\n\t\treturn irq;\n\n\tdisable_irq(irq);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(da9052_disable_irq);\n\nint da9052_disable_irq_nosync(struct da9052 *da9052, int irq)\n{\n\tirq = da9052_map_irq(da9052, irq);\n\tif (irq < 0)\n\t\treturn irq;\n\n\tdisable_irq_nosync(irq);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(da9052_disable_irq_nosync);\n\nint da9052_request_irq(struct da9052 *da9052, int irq, char *name,\n\t\t\t   irq_handler_t handler, void *data)\n{\n\tirq = da9052_map_irq(da9052, irq);\n\tif (irq < 0)\n\t\treturn irq;\n\n\treturn request_threaded_irq(irq, NULL, handler,\n\t\t\t\t     IRQF_TRIGGER_LOW | IRQF_ONESHOT,\n\t\t\t\t     name, data);\n}\nEXPORT_SYMBOL_GPL(da9052_request_irq);\n\nvoid da9052_free_irq(struct da9052 *da9052, int irq, void *data)\n{\n\tirq = da9052_map_irq(da9052, irq);\n\tif (irq < 0)\n\t\treturn;\n\n\tfree_irq(irq, data);\n}\nEXPORT_SYMBOL_GPL(da9052_free_irq);\n\nstatic irqreturn_t da9052_auxadc_irq(int irq, void *irq_data)\n{\n\tstruct da9052 *da9052 = irq_data;\n\n\tcomplete(&da9052->done);\n\n\treturn IRQ_HANDLED;\n}\n\nint da9052_irq_init(struct da9052 *da9052)\n{\n\tint ret;\n\n\tret = regmap_add_irq_chip(da9052->regmap, da9052->chip_irq,\n\t\t\t\t  IRQF_TRIGGER_LOW | IRQF_ONESHOT,\n\t\t\t\t  -1, &da9052_regmap_irq_chip,\n\t\t\t\t  &da9052->irq_data);\n\tif (ret < 0) {\n\t\tdev_err(da9052->dev, \"regmap_add_irq_chip failed: %d\\n\", ret);\n\t\tgoto regmap_err;\n\t}\n\n\tenable_irq_wake(da9052->chip_irq);\n\n\tret = da9052_request_irq(da9052, DA9052_IRQ_ADC_EOM, \"adc-irq\",\n\t\t\t    da9052_auxadc_irq, da9052);\n\n\tif (ret != 0) {\n\t\tdev_err(da9052->dev, \"DA9052_IRQ_ADC_EOM failed: %d\\n\", ret);\n\t\tgoto request_irq_err;\n\t}\n\n\treturn 0;\n\nrequest_irq_err:\n\tregmap_del_irq_chip(da9052->chip_irq, da9052->irq_data);\nregmap_err:\n\treturn ret;\n\n}\n\nint da9052_irq_exit(struct da9052 *da9052)\n{\n\tda9052_free_irq(da9052, DA9052_IRQ_ADC_EOM, da9052);\n\tregmap_del_irq_chip(da9052->chip_irq, da9052->irq_data);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}