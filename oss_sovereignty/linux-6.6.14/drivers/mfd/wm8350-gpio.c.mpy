{
  "module_name": "wm8350-gpio.c",
  "hash_id": "9d335f105f66af83d148bc32ff6b896f14e5eae2800b11a97c94fcf29878cd29",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/wm8350-gpio.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n\n#include <linux/mfd/wm8350/core.h>\n#include <linux/mfd/wm8350/gpio.h>\n#include <linux/mfd/wm8350/pmic.h>\n\nstatic int gpio_set_dir(struct wm8350 *wm8350, int gpio, int dir)\n{\n\tint ret;\n\n\twm8350_reg_unlock(wm8350);\n\tif (dir == WM8350_GPIO_DIR_OUT)\n\t\tret = wm8350_clear_bits(wm8350,\n\t\t\t\t\tWM8350_GPIO_CONFIGURATION_I_O,\n\t\t\t\t\t1 << gpio);\n\telse\n\t\tret = wm8350_set_bits(wm8350,\n\t\t\t\t      WM8350_GPIO_CONFIGURATION_I_O,\n\t\t\t\t      1 << gpio);\n\twm8350_reg_lock(wm8350);\n\treturn ret;\n}\n\nstatic int wm8350_gpio_set_debounce(struct wm8350 *wm8350, int gpio, int db)\n{\n\tif (db == WM8350_GPIO_DEBOUNCE_ON)\n\t\treturn wm8350_set_bits(wm8350, WM8350_GPIO_DEBOUNCE,\n\t\t\t\t       1 << gpio);\n\telse\n\t\treturn wm8350_clear_bits(wm8350,\n\t\t\t\t\t WM8350_GPIO_DEBOUNCE, 1 << gpio);\n}\n\nstatic int gpio_set_func(struct wm8350 *wm8350, int gpio, int func)\n{\n\tu16 reg;\n\n\twm8350_reg_unlock(wm8350);\n\tswitch (gpio) {\n\tcase 0:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\n\t\t    & ~WM8350_GP0_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\n\t\t\t\t reg | ((func & 0xf) << 0));\n\t\tbreak;\n\tcase 1:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\n\t\t    & ~WM8350_GP1_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\n\t\t\t\t reg | ((func & 0xf) << 4));\n\t\tbreak;\n\tcase 2:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\n\t\t    & ~WM8350_GP2_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\n\t\t\t\t reg | ((func & 0xf) << 8));\n\t\tbreak;\n\tcase 3:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_1)\n\t\t    & ~WM8350_GP3_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_1,\n\t\t\t\t reg | ((func & 0xf) << 12));\n\t\tbreak;\n\tcase 4:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\n\t\t    & ~WM8350_GP4_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\n\t\t\t\t reg | ((func & 0xf) << 0));\n\t\tbreak;\n\tcase 5:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\n\t\t    & ~WM8350_GP5_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\n\t\t\t\t reg | ((func & 0xf) << 4));\n\t\tbreak;\n\tcase 6:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\n\t\t    & ~WM8350_GP6_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\n\t\t\t\t reg | ((func & 0xf) << 8));\n\t\tbreak;\n\tcase 7:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_2)\n\t\t    & ~WM8350_GP7_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_2,\n\t\t\t\t reg | ((func & 0xf) << 12));\n\t\tbreak;\n\tcase 8:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\n\t\t    & ~WM8350_GP8_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\n\t\t\t\t reg | ((func & 0xf) << 0));\n\t\tbreak;\n\tcase 9:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\n\t\t    & ~WM8350_GP9_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\n\t\t\t\t reg | ((func & 0xf) << 4));\n\t\tbreak;\n\tcase 10:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\n\t\t    & ~WM8350_GP10_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\n\t\t\t\t reg | ((func & 0xf) << 8));\n\t\tbreak;\n\tcase 11:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_3)\n\t\t    & ~WM8350_GP11_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_3,\n\t\t\t\t reg | ((func & 0xf) << 12));\n\t\tbreak;\n\tcase 12:\n\t\treg = wm8350_reg_read(wm8350, WM8350_GPIO_FUNCTION_SELECT_4)\n\t\t    & ~WM8350_GP12_FN_MASK;\n\t\twm8350_reg_write(wm8350, WM8350_GPIO_FUNCTION_SELECT_4,\n\t\t\t\t reg | ((func & 0xf) << 0));\n\t\tbreak;\n\tdefault:\n\t\twm8350_reg_lock(wm8350);\n\t\treturn -EINVAL;\n\t}\n\n\twm8350_reg_lock(wm8350);\n\treturn 0;\n}\n\nstatic int gpio_set_pull_up(struct wm8350 *wm8350, int gpio, int up)\n{\n\tif (up)\n\t\treturn wm8350_set_bits(wm8350,\n\t\t\t\t       WM8350_GPIO_PIN_PULL_UP_CONTROL,\n\t\t\t\t       1 << gpio);\n\telse\n\t\treturn wm8350_clear_bits(wm8350,\n\t\t\t\t\t WM8350_GPIO_PIN_PULL_UP_CONTROL,\n\t\t\t\t\t 1 << gpio);\n}\n\nstatic int gpio_set_pull_down(struct wm8350 *wm8350, int gpio, int down)\n{\n\tif (down)\n\t\treturn wm8350_set_bits(wm8350,\n\t\t\t\t       WM8350_GPIO_PULL_DOWN_CONTROL,\n\t\t\t\t       1 << gpio);\n\telse\n\t\treturn wm8350_clear_bits(wm8350,\n\t\t\t\t\t WM8350_GPIO_PULL_DOWN_CONTROL,\n\t\t\t\t\t 1 << gpio);\n}\n\nstatic int gpio_set_polarity(struct wm8350 *wm8350, int gpio, int pol)\n{\n\tif (pol == WM8350_GPIO_ACTIVE_HIGH)\n\t\treturn wm8350_set_bits(wm8350,\n\t\t\t\t       WM8350_GPIO_PIN_POLARITY_TYPE,\n\t\t\t\t       1 << gpio);\n\telse\n\t\treturn wm8350_clear_bits(wm8350,\n\t\t\t\t\t WM8350_GPIO_PIN_POLARITY_TYPE,\n\t\t\t\t\t 1 << gpio);\n}\n\nstatic int gpio_set_invert(struct wm8350 *wm8350, int gpio, int invert)\n{\n\tif (invert == WM8350_GPIO_INVERT_ON)\n\t\treturn wm8350_set_bits(wm8350, WM8350_GPIO_INT_MODE, 1 << gpio);\n\telse\n\t\treturn wm8350_clear_bits(wm8350,\n\t\t\t\t\t WM8350_GPIO_INT_MODE, 1 << gpio);\n}\n\nint wm8350_gpio_config(struct wm8350 *wm8350, int gpio, int dir, int func,\n\t\t       int pol, int pull, int invert, int debounce)\n{\n\t \n\tif (pull == WM8350_GPIO_PULL_NONE) {\n\t\tif (gpio_set_pull_up(wm8350, gpio, 0))\n\t\t\tgoto err;\n\t\tif (gpio_set_pull_down(wm8350, gpio, 0))\n\t\t\tgoto err;\n\t} else if (pull == WM8350_GPIO_PULL_UP) {\n\t\tif (gpio_set_pull_down(wm8350, gpio, 0))\n\t\t\tgoto err;\n\t\tif (gpio_set_pull_up(wm8350, gpio, 1))\n\t\t\tgoto err;\n\t} else if (pull == WM8350_GPIO_PULL_DOWN) {\n\t\tif (gpio_set_pull_up(wm8350, gpio, 0))\n\t\t\tgoto err;\n\t\tif (gpio_set_pull_down(wm8350, gpio, 1))\n\t\t\tgoto err;\n\t}\n\n\tif (gpio_set_invert(wm8350, gpio, invert))\n\t\tgoto err;\n\tif (gpio_set_polarity(wm8350, gpio, pol))\n\t\tgoto err;\n\tif (wm8350_gpio_set_debounce(wm8350, gpio, debounce))\n\t\tgoto err;\n\tif (gpio_set_dir(wm8350, gpio, dir))\n\t\tgoto err;\n\treturn gpio_set_func(wm8350, gpio, func);\n\nerr:\n\treturn -EIO;\n}\nEXPORT_SYMBOL_GPL(wm8350_gpio_config);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}