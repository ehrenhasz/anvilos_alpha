{
  "module_name": "wm831x-i2c.c",
  "hash_id": "16fab88c471e7fe6e865e3466032372cb82b8d513c6478eda76196a6c960193c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/wm831x-i2c.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/i2c.h>\n#include <linux/delay.h>\n#include <linux/mfd/core.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/of.h>\n#include <linux/of_device.h>\n#include <linux/regmap.h>\n\n#include <linux/mfd/wm831x/core.h>\n#include <linux/mfd/wm831x/pdata.h>\n\nstatic int wm831x_i2c_probe(struct i2c_client *i2c)\n{\n\tconst struct i2c_device_id *id = i2c_client_get_device_id(i2c);\n\tstruct wm831x_pdata *pdata = dev_get_platdata(&i2c->dev);\n\tconst struct of_device_id *of_id;\n\tstruct wm831x *wm831x;\n\tenum wm831x_parent type;\n\tint ret;\n\n\tif (i2c->dev.of_node) {\n\t\tof_id = of_match_device(wm831x_of_match, &i2c->dev);\n\t\tif (!of_id) {\n\t\t\tdev_err(&i2c->dev, \"Failed to match device\\n\");\n\t\t\treturn -ENODEV;\n\t\t}\n\t\ttype = (uintptr_t)of_id->data;\n\t} else {\n\t\ttype = (enum wm831x_parent)id->driver_data;\n\t}\n\n\twm831x = devm_kzalloc(&i2c->dev, sizeof(struct wm831x), GFP_KERNEL);\n\tif (wm831x == NULL)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, wm831x);\n\twm831x->dev = &i2c->dev;\n\twm831x->type = type;\n\n\twm831x->regmap = devm_regmap_init_i2c(i2c, &wm831x_regmap_config);\n\tif (IS_ERR(wm831x->regmap)) {\n\t\tret = PTR_ERR(wm831x->regmap);\n\t\tdev_err(wm831x->dev, \"Failed to allocate register map: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\n\tif (pdata)\n\t\tmemcpy(&wm831x->pdata, pdata, sizeof(*pdata));\n\n\treturn wm831x_device_init(wm831x, i2c->irq);\n}\n\nstatic int wm831x_i2c_suspend(struct device *dev)\n{\n\tstruct wm831x *wm831x = dev_get_drvdata(dev);\n\n\treturn wm831x_device_suspend(wm831x);\n}\n\nstatic int wm831x_i2c_poweroff(struct device *dev)\n{\n\tstruct wm831x *wm831x = dev_get_drvdata(dev);\n\n\twm831x_device_shutdown(wm831x);\n\n\treturn 0;\n}\n\nstatic const struct i2c_device_id wm831x_i2c_id[] = {\n\t{ \"wm8310\", WM8310 },\n\t{ \"wm8311\", WM8311 },\n\t{ \"wm8312\", WM8312 },\n\t{ \"wm8320\", WM8320 },\n\t{ \"wm8321\", WM8321 },\n\t{ \"wm8325\", WM8325 },\n\t{ \"wm8326\", WM8326 },\n\t{ }\n};\n\nstatic const struct dev_pm_ops wm831x_pm_ops = {\n\t.suspend = wm831x_i2c_suspend,\n\t.poweroff = wm831x_i2c_poweroff,\n};\n\nstatic struct i2c_driver wm831x_i2c_driver = {\n\t.driver = {\n\t\t.name = \"wm831x\",\n\t\t.pm = &wm831x_pm_ops,\n\t\t.of_match_table = of_match_ptr(wm831x_of_match),\n\t\t.suppress_bind_attrs = true,\n\t},\n\t.probe = wm831x_i2c_probe,\n\t.id_table = wm831x_i2c_id,\n};\n\nstatic int __init wm831x_i2c_init(void)\n{\n\tint ret;\n\n\tret = i2c_add_driver(&wm831x_i2c_driver);\n\tif (ret != 0)\n\t\tpr_err(\"Failed to register wm831x I2C driver: %d\\n\", ret);\n\n\treturn ret;\n}\nsubsys_initcall(wm831x_i2c_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}