{
  "module_name": "rt5120.c",
  "hash_id": "bc8ab17ff354608a3b9442daca21ddff6a4ab9a31a3087126e934eeb0138bfe8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/rt5120.c",
  "human_readable_source": "\n \n\n#include <linux/i2c.h>\n#include <linux/kernel.h>\n#include <linux/mfd/core.h>\n#include <linux/module.h>\n#include <linux/mod_devicetable.h>\n#include <linux/regmap.h>\n\n#define RT5120_REG_INTENABLE\t0x1D\n#define RT5120_REG_INTSTAT\t0x1E\n#define RT5120_REG_FZCMODE\t0x44\n\n#define RT5120_INT_HOTDIE\t0\n#define RT5120_INT_PWRKEY_REL\t5\n#define RT5120_INT_PWRKEY_PRESS\t6\n\nstatic const struct regmap_range rt5120_rd_yes_ranges[] = {\n\tregmap_reg_range(0x03, 0x13),\n\tregmap_reg_range(0x1c, 0x20),\n\tregmap_reg_range(0x44, 0x44),\n};\n\nstatic const struct regmap_range rt5120_wr_yes_ranges[] = {\n\tregmap_reg_range(0x06, 0x13),\n\tregmap_reg_range(0x1c, 0x20),\n\tregmap_reg_range(0x44, 0x44),\n};\n\nstatic const struct regmap_access_table rt5120_rd_table = {\n\t.yes_ranges = rt5120_rd_yes_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(rt5120_rd_yes_ranges),\n};\n\nstatic const struct regmap_access_table rt5120_wr_table = {\n\t.yes_ranges = rt5120_wr_yes_ranges,\n\t.n_yes_ranges = ARRAY_SIZE(rt5120_wr_yes_ranges),\n};\n\nstatic const struct regmap_config rt5120_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\t.max_register = RT5120_REG_FZCMODE,\n\n\t.wr_table = &rt5120_wr_table,\n\t.rd_table = &rt5120_rd_table,\n};\n\nstatic const struct regmap_irq rt5120_irqs[] = {\n\tREGMAP_IRQ_REG_LINE(RT5120_INT_HOTDIE, 8),\n\tREGMAP_IRQ_REG_LINE(RT5120_INT_PWRKEY_REL, 8),\n\tREGMAP_IRQ_REG_LINE(RT5120_INT_PWRKEY_PRESS, 8),\n};\n\nstatic const struct regmap_irq_chip rt5120_irq_chip = {\n\t.name = \"rt5120-pmic\",\n\t.status_base = RT5120_REG_INTSTAT,\n\t.unmask_base = RT5120_REG_INTENABLE,\n\t.ack_base = RT5120_REG_INTSTAT,\n\t.use_ack = true,\n\t.num_regs = 1,\n\t.irqs = rt5120_irqs,\n\t.num_irqs = ARRAY_SIZE(rt5120_irqs),\n};\n\nstatic const struct resource rt5120_regulator_resources[] = {\n\tDEFINE_RES_IRQ(RT5120_INT_HOTDIE),\n};\n\nstatic const struct resource rt5120_pwrkey_resources[] = {\n\tDEFINE_RES_IRQ_NAMED(RT5120_INT_PWRKEY_PRESS, \"pwrkey-press\"),\n\tDEFINE_RES_IRQ_NAMED(RT5120_INT_PWRKEY_REL, \"pwrkey-release\"),\n};\n\nstatic const struct mfd_cell rt5120_devs[] = {\n\tMFD_CELL_RES(\"rt5120-regulator\", rt5120_regulator_resources),\n\tMFD_CELL_OF(\"rt5120-pwrkey\", rt5120_pwrkey_resources, NULL, 0, 0, \"richtek,rt5120-pwrkey\"),\n};\n\nstatic int rt5120_probe(struct i2c_client *i2c)\n{\n\tstruct device *dev = &i2c->dev;\n\tstruct regmap *regmap;\n\tstruct regmap_irq_chip_data *irq_data;\n\tint ret;\n\n\tregmap = devm_regmap_init_i2c(i2c, &rt5120_regmap_config);\n\tif (IS_ERR(regmap))\n\t\treturn dev_err_probe(dev, PTR_ERR(regmap),\n\t\t\t\t     \"Failed to init regmap\\n\");\n\n\tret = devm_regmap_add_irq_chip(dev, regmap, i2c->irq, IRQF_ONESHOT, 0,\n\t\t\t\t       &rt5120_irq_chip, &irq_data);\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret, \"Failed to add IRQ chip\\n\");\n\n\treturn devm_mfd_add_devices(dev, PLATFORM_DEVID_AUTO, rt5120_devs,\n\t\t\t\t    ARRAY_SIZE(rt5120_devs), NULL, 0,\n\t\t\t\t    regmap_irq_get_domain(irq_data));\n}\n\nstatic const struct of_device_id rt5120_device_match_table[] = {\n\t{ .compatible = \"richtek,rt5120\" },\n\t{}\n};\nMODULE_DEVICE_TABLE(of, rt5120_device_match_table);\n\nstatic struct i2c_driver rt5120_driver = {\n\t.driver = {\n\t\t.name = \"rt5120\",\n\t\t.of_match_table = rt5120_device_match_table,\n\t},\n\t.probe = rt5120_probe,\n};\nmodule_i2c_driver(rt5120_driver);\n\nMODULE_AUTHOR(\"ChiYuan Huang <cy_huang@richtek.com>\");\nMODULE_DESCRIPTION(\"Richtek RT5120 I2C driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}