{
  "module_name": "da9055-core.c",
  "hash_id": "95057094e94e6fff1f2d05d57ee0b82682e4155f435b1bc2c9ec6d7709611973",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/da9055-core.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/input.h>\n#include <linux/irq.h>\n#include <linux/mutex.h>\n\n#include <linux/mfd/core.h>\n#include <linux/mfd/da9055/core.h>\n#include <linux/mfd/da9055/pdata.h>\n#include <linux/mfd/da9055/reg.h>\n\n#define DA9055_IRQ_NONKEY_MASK\t\t0x01\n#define DA9055_IRQ_ALM_MASK\t\t0x02\n#define DA9055_IRQ_TICK_MASK\t\t0x04\n#define DA9055_IRQ_ADC_MASK\t\t0x08\n#define DA9055_IRQ_BUCK_ILIM_MASK\t0x08\n\nstatic bool da9055_register_readable(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA9055_REG_STATUS_A:\n\tcase DA9055_REG_STATUS_B:\n\tcase DA9055_REG_EVENT_A:\n\tcase DA9055_REG_EVENT_B:\n\tcase DA9055_REG_EVENT_C:\n\tcase DA9055_REG_IRQ_MASK_A:\n\tcase DA9055_REG_IRQ_MASK_B:\n\tcase DA9055_REG_IRQ_MASK_C:\n\n\tcase DA9055_REG_CONTROL_A:\n\tcase DA9055_REG_CONTROL_B:\n\tcase DA9055_REG_CONTROL_C:\n\tcase DA9055_REG_CONTROL_D:\n\tcase DA9055_REG_CONTROL_E:\n\n\tcase DA9055_REG_ADC_MAN:\n\tcase DA9055_REG_ADC_CONT:\n\tcase DA9055_REG_VSYS_MON:\n\tcase DA9055_REG_ADC_RES_L:\n\tcase DA9055_REG_ADC_RES_H:\n\tcase DA9055_REG_VSYS_RES:\n\tcase DA9055_REG_ADCIN1_RES:\n\tcase DA9055_REG_ADCIN2_RES:\n\tcase DA9055_REG_ADCIN3_RES:\n\n\tcase DA9055_REG_COUNT_S:\n\tcase DA9055_REG_COUNT_MI:\n\tcase DA9055_REG_COUNT_H:\n\tcase DA9055_REG_COUNT_D:\n\tcase DA9055_REG_COUNT_MO:\n\tcase DA9055_REG_COUNT_Y:\n\tcase DA9055_REG_ALARM_H:\n\tcase DA9055_REG_ALARM_D:\n\tcase DA9055_REG_ALARM_MI:\n\tcase DA9055_REG_ALARM_MO:\n\tcase DA9055_REG_ALARM_Y:\n\n\tcase DA9055_REG_GPIO0_1:\n\tcase DA9055_REG_GPIO2:\n\tcase DA9055_REG_GPIO_MODE0_2:\n\n\tcase DA9055_REG_BCORE_CONT:\n\tcase DA9055_REG_BMEM_CONT:\n\tcase DA9055_REG_LDO1_CONT:\n\tcase DA9055_REG_LDO2_CONT:\n\tcase DA9055_REG_LDO3_CONT:\n\tcase DA9055_REG_LDO4_CONT:\n\tcase DA9055_REG_LDO5_CONT:\n\tcase DA9055_REG_LDO6_CONT:\n\tcase DA9055_REG_BUCK_LIM:\n\tcase DA9055_REG_BCORE_MODE:\n\tcase DA9055_REG_VBCORE_A:\n\tcase DA9055_REG_VBMEM_A:\n\tcase DA9055_REG_VLDO1_A:\n\tcase DA9055_REG_VLDO2_A:\n\tcase DA9055_REG_VLDO3_A:\n\tcase DA9055_REG_VLDO4_A:\n\tcase DA9055_REG_VLDO5_A:\n\tcase DA9055_REG_VLDO6_A:\n\tcase DA9055_REG_VBCORE_B:\n\tcase DA9055_REG_VBMEM_B:\n\tcase DA9055_REG_VLDO1_B:\n\tcase DA9055_REG_VLDO2_B:\n\tcase DA9055_REG_VLDO3_B:\n\tcase DA9055_REG_VLDO4_B:\n\tcase DA9055_REG_VLDO5_B:\n\tcase DA9055_REG_VLDO6_B:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool da9055_register_writeable(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA9055_REG_STATUS_A:\n\tcase DA9055_REG_STATUS_B:\n\tcase DA9055_REG_EVENT_A:\n\tcase DA9055_REG_EVENT_B:\n\tcase DA9055_REG_EVENT_C:\n\tcase DA9055_REG_IRQ_MASK_A:\n\tcase DA9055_REG_IRQ_MASK_B:\n\tcase DA9055_REG_IRQ_MASK_C:\n\n\tcase DA9055_REG_CONTROL_A:\n\tcase DA9055_REG_CONTROL_B:\n\tcase DA9055_REG_CONTROL_C:\n\tcase DA9055_REG_CONTROL_D:\n\tcase DA9055_REG_CONTROL_E:\n\n\tcase DA9055_REG_ADC_MAN:\n\tcase DA9055_REG_ADC_CONT:\n\tcase DA9055_REG_VSYS_MON:\n\tcase DA9055_REG_ADC_RES_L:\n\tcase DA9055_REG_ADC_RES_H:\n\tcase DA9055_REG_VSYS_RES:\n\tcase DA9055_REG_ADCIN1_RES:\n\tcase DA9055_REG_ADCIN2_RES:\n\tcase DA9055_REG_ADCIN3_RES:\n\n\tcase DA9055_REG_COUNT_S:\n\tcase DA9055_REG_COUNT_MI:\n\tcase DA9055_REG_COUNT_H:\n\tcase DA9055_REG_COUNT_D:\n\tcase DA9055_REG_COUNT_MO:\n\tcase DA9055_REG_COUNT_Y:\n\tcase DA9055_REG_ALARM_H:\n\tcase DA9055_REG_ALARM_D:\n\tcase DA9055_REG_ALARM_MI:\n\tcase DA9055_REG_ALARM_MO:\n\tcase DA9055_REG_ALARM_Y:\n\n\tcase DA9055_REG_GPIO0_1:\n\tcase DA9055_REG_GPIO2:\n\tcase DA9055_REG_GPIO_MODE0_2:\n\n\tcase DA9055_REG_BCORE_CONT:\n\tcase DA9055_REG_BMEM_CONT:\n\tcase DA9055_REG_LDO1_CONT:\n\tcase DA9055_REG_LDO2_CONT:\n\tcase DA9055_REG_LDO3_CONT:\n\tcase DA9055_REG_LDO4_CONT:\n\tcase DA9055_REG_LDO5_CONT:\n\tcase DA9055_REG_LDO6_CONT:\n\tcase DA9055_REG_BUCK_LIM:\n\tcase DA9055_REG_BCORE_MODE:\n\tcase DA9055_REG_VBCORE_A:\n\tcase DA9055_REG_VBMEM_A:\n\tcase DA9055_REG_VLDO1_A:\n\tcase DA9055_REG_VLDO2_A:\n\tcase DA9055_REG_VLDO3_A:\n\tcase DA9055_REG_VLDO4_A:\n\tcase DA9055_REG_VLDO5_A:\n\tcase DA9055_REG_VLDO6_A:\n\tcase DA9055_REG_VBCORE_B:\n\tcase DA9055_REG_VBMEM_B:\n\tcase DA9055_REG_VLDO1_B:\n\tcase DA9055_REG_VLDO2_B:\n\tcase DA9055_REG_VLDO3_B:\n\tcase DA9055_REG_VLDO4_B:\n\tcase DA9055_REG_VLDO5_B:\n\tcase DA9055_REG_VLDO6_B:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool da9055_register_volatile(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase DA9055_REG_STATUS_A:\n\tcase DA9055_REG_STATUS_B:\n\tcase DA9055_REG_EVENT_A:\n\tcase DA9055_REG_EVENT_B:\n\tcase DA9055_REG_EVENT_C:\n\n\tcase DA9055_REG_CONTROL_A:\n\tcase DA9055_REG_CONTROL_E:\n\n\tcase DA9055_REG_ADC_MAN:\n\tcase DA9055_REG_ADC_RES_L:\n\tcase DA9055_REG_ADC_RES_H:\n\tcase DA9055_REG_VSYS_RES:\n\tcase DA9055_REG_ADCIN1_RES:\n\tcase DA9055_REG_ADCIN2_RES:\n\tcase DA9055_REG_ADCIN3_RES:\n\n\tcase DA9055_REG_COUNT_S:\n\tcase DA9055_REG_COUNT_MI:\n\tcase DA9055_REG_COUNT_H:\n\tcase DA9055_REG_COUNT_D:\n\tcase DA9055_REG_COUNT_MO:\n\tcase DA9055_REG_COUNT_Y:\n\tcase DA9055_REG_ALARM_MI:\n\n\tcase DA9055_REG_BCORE_CONT:\n\tcase DA9055_REG_BMEM_CONT:\n\tcase DA9055_REG_LDO1_CONT:\n\tcase DA9055_REG_LDO2_CONT:\n\tcase DA9055_REG_LDO3_CONT:\n\tcase DA9055_REG_LDO4_CONT:\n\tcase DA9055_REG_LDO5_CONT:\n\tcase DA9055_REG_LDO6_CONT:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_irq da9055_irqs[] = {\n\t[DA9055_IRQ_NONKEY] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9055_IRQ_NONKEY_MASK,\n\t},\n\t[DA9055_IRQ_ALARM] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9055_IRQ_ALM_MASK,\n\t},\n\t[DA9055_IRQ_TICK] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9055_IRQ_TICK_MASK,\n\t},\n\t[DA9055_IRQ_HWMON] = {\n\t\t.reg_offset = 0,\n\t\t.mask = DA9055_IRQ_ADC_MASK,\n\t},\n\t[DA9055_IRQ_REGULATOR] = {\n\t\t.reg_offset = 1,\n\t\t.mask = DA9055_IRQ_BUCK_ILIM_MASK,\n\t},\n};\n\nconst struct regmap_config da9055_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.cache_type = REGCACHE_RBTREE,\n\n\t.max_register = DA9055_MAX_REGISTER_CNT,\n\t.readable_reg = da9055_register_readable,\n\t.writeable_reg = da9055_register_writeable,\n\t.volatile_reg = da9055_register_volatile,\n};\nEXPORT_SYMBOL_GPL(da9055_regmap_config);\n\nstatic const struct resource da9055_onkey_resource =\n\tDEFINE_RES_IRQ_NAMED(DA9055_IRQ_NONKEY, \"ONKEY\");\n\nstatic const struct resource da9055_rtc_resource[] = {\n\tDEFINE_RES_IRQ_NAMED(DA9055_IRQ_ALARM, \"ALM\"),\n\tDEFINE_RES_IRQ_NAMED(DA9055_IRQ_TICK, \"TICK\"),\n};\n\nstatic const struct resource da9055_hwmon_resource =\n\tDEFINE_RES_IRQ_NAMED(DA9055_IRQ_HWMON, \"HWMON\");\n\nstatic const struct resource da9055_ld05_6_resource =\n\tDEFINE_RES_IRQ_NAMED(DA9055_IRQ_REGULATOR, \"REGULATOR\");\n\nstatic const struct mfd_cell da9055_devs[] = {\n\t{\n\t\t.of_compatible = \"dlg,da9055-gpio\",\n\t\t.name = \"da9055-gpio\",\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.id = 1,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.id = 2,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.id = 3,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.id = 4,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.id = 5,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.id = 6,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.id = 7,\n\t\t.resources = &da9055_ld05_6_resource,\n\t\t.num_resources = 1,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-regulator\",\n\t\t.name = \"da9055-regulator\",\n\t\t.resources = &da9055_ld05_6_resource,\n\t\t.num_resources = 1,\n\t\t.id = 8,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-onkey\",\n\t\t.name = \"da9055-onkey\",\n\t\t.resources = &da9055_onkey_resource,\n\t\t.num_resources = 1,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-rtc\",\n\t\t.name = \"da9055-rtc\",\n\t\t.resources = da9055_rtc_resource,\n\t\t.num_resources = ARRAY_SIZE(da9055_rtc_resource),\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-hwmon\",\n\t\t.name = \"da9055-hwmon\",\n\t\t.resources = &da9055_hwmon_resource,\n\t\t.num_resources = 1,\n\t},\n\t{\n\t\t.of_compatible = \"dlg,da9055-watchdog\",\n\t\t.name = \"da9055-watchdog\",\n\t},\n};\n\nstatic const struct regmap_irq_chip da9055_regmap_irq_chip = {\n\t.name = \"da9055_irq\",\n\t.status_base = DA9055_REG_EVENT_A,\n\t.mask_base = DA9055_REG_IRQ_MASK_A,\n\t.ack_base = DA9055_REG_EVENT_A,\n\t.num_regs = 3,\n\t.irqs = da9055_irqs,\n\t.num_irqs = ARRAY_SIZE(da9055_irqs),\n};\n\nint da9055_device_init(struct da9055 *da9055)\n{\n\tstruct da9055_pdata *pdata = dev_get_platdata(da9055->dev);\n\tint ret;\n\tuint8_t clear_events[3] = {0xFF, 0xFF, 0xFF};\n\n\tif (pdata && pdata->init != NULL)\n\t\tpdata->init(da9055);\n\n\tif (!pdata || !pdata->irq_base)\n\t\tda9055->irq_base = -1;\n\telse\n\t\tda9055->irq_base = pdata->irq_base;\n\n\tret = da9055_group_write(da9055, DA9055_REG_EVENT_A, 3, clear_events);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tret = regmap_add_irq_chip(da9055->regmap, da9055->chip_irq,\n\t\t\t\t  IRQF_TRIGGER_LOW | IRQF_ONESHOT,\n\t\t\t\t  da9055->irq_base, &da9055_regmap_irq_chip,\n\t\t\t\t  &da9055->irq_data);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tda9055->irq_base = regmap_irq_chip_get_base(da9055->irq_data);\n\n\tret = mfd_add_devices(da9055->dev, -1,\n\t\t\t      da9055_devs, ARRAY_SIZE(da9055_devs),\n\t\t\t      NULL, da9055->irq_base, NULL);\n\tif (ret)\n\t\tgoto err;\n\n\treturn 0;\n\nerr:\n\tmfd_remove_devices(da9055->dev);\n\treturn ret;\n}\n\nvoid da9055_device_exit(struct da9055 *da9055)\n{\n\tregmap_del_irq_chip(da9055->chip_irq, da9055->irq_data);\n\tmfd_remove_devices(da9055->dev);\n}\n\nMODULE_DESCRIPTION(\"Core support for the DA9055 PMIC\");\nMODULE_AUTHOR(\"David Dajun Chen <dchen@diasemi.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}