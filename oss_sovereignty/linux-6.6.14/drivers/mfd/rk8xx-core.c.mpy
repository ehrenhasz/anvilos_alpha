{
  "module_name": "rk8xx-core.c",
  "hash_id": "57d23c8a69d6a2d0b8ce527108e49e64635ff03d4ece994a8de9eea0c9f7fc7b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/rk8xx-core.c",
  "human_readable_source": "\n \n\n#include <linux/interrupt.h>\n#include <linux/mfd/rk808.h>\n#include <linux/mfd/core.h>\n#include <linux/module.h>\n#include <linux/property.h>\n#include <linux/regmap.h>\n#include <linux/reboot.h>\n\nstruct rk808_reg_data {\n\tint addr;\n\tint mask;\n\tint value;\n};\n\nstatic const struct resource rtc_resources[] = {\n\tDEFINE_RES_IRQ(RK808_IRQ_RTC_ALARM),\n};\n\nstatic const struct resource rk817_rtc_resources[] = {\n\tDEFINE_RES_IRQ(RK817_IRQ_RTC_ALARM),\n};\n\nstatic const struct resource rk805_key_resources[] = {\n\tDEFINE_RES_IRQ(RK805_IRQ_PWRON_RISE),\n\tDEFINE_RES_IRQ(RK805_IRQ_PWRON_FALL),\n};\n\nstatic struct resource rk806_pwrkey_resources[] = {\n\tDEFINE_RES_IRQ(RK806_IRQ_PWRON_FALL),\n\tDEFINE_RES_IRQ(RK806_IRQ_PWRON_RISE),\n};\n\nstatic const struct resource rk817_pwrkey_resources[] = {\n\tDEFINE_RES_IRQ(RK817_IRQ_PWRON_RISE),\n\tDEFINE_RES_IRQ(RK817_IRQ_PWRON_FALL),\n};\n\nstatic const struct resource rk817_charger_resources[] = {\n\tDEFINE_RES_IRQ(RK817_IRQ_PLUG_IN),\n\tDEFINE_RES_IRQ(RK817_IRQ_PLUG_OUT),\n};\n\nstatic const struct mfd_cell rk805s[] = {\n\t{ .name = \"rk808-clkout\", },\n\t{ .name = \"rk808-regulator\", },\n\t{ .name = \"rk805-pinctrl\", },\n\t{\n\t\t.name = \"rk808-rtc\",\n\t\t.num_resources = ARRAY_SIZE(rtc_resources),\n\t\t.resources = &rtc_resources[0],\n\t},\n\t{\t.name = \"rk805-pwrkey\",\n\t\t.num_resources = ARRAY_SIZE(rk805_key_resources),\n\t\t.resources = &rk805_key_resources[0],\n\t},\n};\n\nstatic const struct mfd_cell rk806s[] = {\n\t{ .name = \"rk805-pinctrl\", },\n\t{ .name = \"rk808-regulator\", },\n\t{\n\t\t.name = \"rk805-pwrkey\",\n\t\t.resources = rk806_pwrkey_resources,\n\t\t.num_resources = ARRAY_SIZE(rk806_pwrkey_resources),\n\t},\n};\n\nstatic const struct mfd_cell rk808s[] = {\n\t{ .name = \"rk808-clkout\", },\n\t{ .name = \"rk808-regulator\", },\n\t{\n\t\t.name = \"rk808-rtc\",\n\t\t.num_resources = ARRAY_SIZE(rtc_resources),\n\t\t.resources = rtc_resources,\n\t},\n};\n\nstatic const struct mfd_cell rk817s[] = {\n\t{ .name = \"rk808-clkout\", },\n\t{ .name = \"rk808-regulator\", },\n\t{\n\t\t.name = \"rk805-pwrkey\",\n\t\t.num_resources = ARRAY_SIZE(rk817_pwrkey_resources),\n\t\t.resources = &rk817_pwrkey_resources[0],\n\t},\n\t{\n\t\t.name = \"rk808-rtc\",\n\t\t.num_resources = ARRAY_SIZE(rk817_rtc_resources),\n\t\t.resources = &rk817_rtc_resources[0],\n\t},\n\t{ .name = \"rk817-codec\", },\n\t{\n\t\t.name = \"rk817-charger\",\n\t\t.num_resources = ARRAY_SIZE(rk817_charger_resources),\n\t\t.resources = &rk817_charger_resources[0],\n\t},\n};\n\nstatic const struct mfd_cell rk818s[] = {\n\t{ .name = \"rk808-clkout\", },\n\t{ .name = \"rk808-regulator\", },\n\t{\n\t\t.name = \"rk808-rtc\",\n\t\t.num_resources = ARRAY_SIZE(rtc_resources),\n\t\t.resources = rtc_resources,\n\t},\n};\n\nstatic const struct rk808_reg_data rk805_pre_init_reg[] = {\n\t{RK805_BUCK1_CONFIG_REG, RK805_BUCK1_2_ILMAX_MASK,\n\t\t\t\t RK805_BUCK1_2_ILMAX_4000MA},\n\t{RK805_BUCK2_CONFIG_REG, RK805_BUCK1_2_ILMAX_MASK,\n\t\t\t\t RK805_BUCK1_2_ILMAX_4000MA},\n\t{RK805_BUCK3_CONFIG_REG, RK805_BUCK3_4_ILMAX_MASK,\n\t\t\t\t RK805_BUCK3_ILMAX_3000MA},\n\t{RK805_BUCK4_CONFIG_REG, RK805_BUCK3_4_ILMAX_MASK,\n\t\t\t\t RK805_BUCK4_ILMAX_3500MA},\n\t{RK805_BUCK4_CONFIG_REG, BUCK_ILMIN_MASK, BUCK_ILMIN_400MA},\n\t{RK805_THERMAL_REG, TEMP_HOTDIE_MSK, TEMP115C},\n};\n\nstatic const struct rk808_reg_data rk806_pre_init_reg[] = {\n\t{ RK806_GPIO_INT_CONFIG, RK806_INT_POL_MSK, RK806_INT_POL_L },\n\t{ RK806_SYS_CFG3, RK806_SLAVE_RESTART_FUN_MSK, RK806_SLAVE_RESTART_FUN_EN },\n\t{ RK806_SYS_OPTION, RK806_SYS_ENB2_2M_MSK, RK806_SYS_ENB2_2M_EN },\n};\n\nstatic const struct rk808_reg_data rk808_pre_init_reg[] = {\n\t{ RK808_BUCK3_CONFIG_REG, BUCK_ILMIN_MASK,  BUCK_ILMIN_150MA },\n\t{ RK808_BUCK4_CONFIG_REG, BUCK_ILMIN_MASK,  BUCK_ILMIN_200MA },\n\t{ RK808_BOOST_CONFIG_REG, BOOST_ILMIN_MASK, BOOST_ILMIN_100MA },\n\t{ RK808_BUCK1_CONFIG_REG, BUCK1_RATE_MASK,  BUCK_ILMIN_200MA },\n\t{ RK808_BUCK2_CONFIG_REG, BUCK2_RATE_MASK,  BUCK_ILMIN_200MA },\n\t{ RK808_DCDC_UV_ACT_REG,  BUCK_UV_ACT_MASK, BUCK_UV_ACT_DISABLE},\n\t{ RK808_VB_MON_REG,       MASK_ALL,         VB_LO_ACT |\n\t\t\t\t\t\t    VB_LO_SEL_3500MV },\n};\n\nstatic const struct rk808_reg_data rk817_pre_init_reg[] = {\n\t{RK817_RTC_CTRL_REG, RTC_STOP, RTC_STOP},\n\t \n\t{ RK817_CODEC_DTOP_VUCTL, MASK_ALL, 0x03 },\n\t{ RK817_CODEC_DTOP_VUCTIME, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DTOP_LPT_SRST, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DTOP_DIGEN_CLKE, MASK_ALL, 0x00 },\n\t \n\t{ RK817_CODEC_AREF_RTCFG0, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_AREF_RTCFG1, MASK_ALL, 0x06 },\n\t{ RK817_CODEC_AADC_CFG0, MASK_ALL, 0xc8 },\n\t \n\t{ RK817_CODEC_AADC_CFG1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_VOLL, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_VOLR, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_SR_ACL0, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_ALC1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_ALC2, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_NG, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_HPF, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DADC_RVOLL, MASK_ALL, 0xff },\n\t{ RK817_CODEC_DADC_RVOLR, MASK_ALL, 0xff },\n\t{ RK817_CODEC_AMIC_CFG0, MASK_ALL, 0x70 },\n\t{ RK817_CODEC_AMIC_CFG1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_PGA_GAIN, MASK_ALL, 0x66 },\n\t{ RK817_CODEC_DMIC_LMT1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_LMT2, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_NG1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_NG2, MASK_ALL, 0x00 },\n\t \n\t{ RK817_CODEC_ADAC_CFG0, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_ADAC_CFG1, MASK_ALL, 0x07 },\n\t{ RK817_CODEC_DDAC_POPD_DACST, MASK_ALL, 0x82 },\n\t{ RK817_CODEC_DDAC_VOLL, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_VOLR, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_SR_LMT0, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_LMT1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_LMT2, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_MUTE_MIXCTL, MASK_ALL, 0xa0 },\n\t{ RK817_CODEC_DDAC_RVOLL, MASK_ALL, 0xff },\n\t{ RK817_CODEC_DADC_RVOLR, MASK_ALL, 0xff },\n\t{ RK817_CODEC_AMIC_CFG0, MASK_ALL, 0x70 },\n\t{ RK817_CODEC_AMIC_CFG1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_PGA_GAIN, MASK_ALL, 0x66 },\n\t{ RK817_CODEC_DMIC_LMT1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_LMT2, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_NG1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DMIC_NG2, MASK_ALL, 0x00 },\n\t \n\t{ RK817_CODEC_ADAC_CFG0, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_ADAC_CFG1, MASK_ALL, 0x07 },\n\t{ RK817_CODEC_DDAC_POPD_DACST, MASK_ALL, 0x82 },\n\t{ RK817_CODEC_DDAC_VOLL, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_VOLR, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_SR_LMT0, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_LMT1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_LMT2, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DDAC_MUTE_MIXCTL, MASK_ALL, 0xa0 },\n\t{ RK817_CODEC_DDAC_RVOLL, MASK_ALL, 0xff },\n\t{ RK817_CODEC_DDAC_RVOLR, MASK_ALL, 0xff },\n\t{ RK817_CODEC_AHP_ANTI0, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_AHP_ANTI1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_AHP_CFG0, MASK_ALL, 0xe0 },\n\t{ RK817_CODEC_AHP_CFG1, MASK_ALL, 0x1f },\n\t{ RK817_CODEC_AHP_CP, MASK_ALL, 0x09 },\n\t{ RK817_CODEC_ACLASSD_CFG1, MASK_ALL, 0x69 },\n\t{ RK817_CODEC_ACLASSD_CFG2, MASK_ALL, 0x44 },\n\t{ RK817_CODEC_APLL_CFG0, MASK_ALL, 0x04 },\n\t{ RK817_CODEC_APLL_CFG1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_APLL_CFG2, MASK_ALL, 0x30 },\n\t{ RK817_CODEC_APLL_CFG3, MASK_ALL, 0x19 },\n\t{ RK817_CODEC_APLL_CFG4, MASK_ALL, 0x65 },\n\t{ RK817_CODEC_APLL_CFG5, MASK_ALL, 0x01 },\n\t{ RK817_CODEC_DI2S_CKM, MASK_ALL, 0x01 },\n\t{ RK817_CODEC_DI2S_RSD, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DI2S_RXCR1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DI2S_RXCR2, MASK_ALL, 0x17 },\n\t{ RK817_CODEC_DI2S_RXCMD_TSD, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DI2S_TXCR1, MASK_ALL, 0x00 },\n\t{ RK817_CODEC_DI2S_TXCR2, MASK_ALL, 0x17 },\n\t{ RK817_CODEC_DI2S_TXCR3_TXCMD, MASK_ALL, 0x00 },\n\t{RK817_GPIO_INT_CFG, RK817_INT_POL_MSK, RK817_INT_POL_L},\n\t{RK817_SYS_CFG(1), RK817_HOTDIE_TEMP_MSK | RK817_TSD_TEMP_MSK,\n\t\t\t\t\t   RK817_HOTDIE_105 | RK817_TSD_140},\n};\n\nstatic const struct rk808_reg_data rk818_pre_init_reg[] = {\n\t \n\t{ RK818_BUCK2_CONFIG_REG, BUCK2_RATE_MASK,  BUCK_ILMIN_250MA },\n\t{ RK818_BUCK4_CONFIG_REG, BUCK_ILMIN_MASK,  BUCK_ILMIN_250MA },\n\t{ RK818_BOOST_CONFIG_REG, BOOST_ILMIN_MASK, BOOST_ILMIN_100MA },\n\t{ RK818_USB_CTRL_REG,\t  RK818_USB_ILIM_SEL_MASK,\n\t\t\t\t\t\t    RK818_USB_ILMIN_2000MA },\n\t \n\t{ RK818_USB_CTRL_REG,\t  RK818_USB_CHG_SD_VSEL_MASK,\n\t\t\t\t\t\t    (0x7 << 4) },\n\t \n\t{ RK818_H5V_EN_REG,\t  BIT(1),\t    RK818_REF_RDY_CTRL },\n\t \n\t{ RK818_H5V_EN_REG,\t  BIT(0),\t    RK818_H5V_EN },\n\t{ RK808_VB_MON_REG,\t  MASK_ALL,\t    VB_LO_ACT |\n\t\t\t\t\t\t    VB_LO_SEL_3500MV },\n};\n\nstatic const struct regmap_irq rk805_irqs[] = {\n\t[RK805_IRQ_PWRON_RISE] = {\n\t\t.mask = RK805_IRQ_PWRON_RISE_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK805_IRQ_VB_LOW] = {\n\t\t.mask = RK805_IRQ_VB_LOW_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK805_IRQ_PWRON] = {\n\t\t.mask = RK805_IRQ_PWRON_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK805_IRQ_PWRON_LP] = {\n\t\t.mask = RK805_IRQ_PWRON_LP_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK805_IRQ_HOTDIE] = {\n\t\t.mask = RK805_IRQ_HOTDIE_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK805_IRQ_RTC_ALARM] = {\n\t\t.mask = RK805_IRQ_RTC_ALARM_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK805_IRQ_RTC_PERIOD] = {\n\t\t.mask = RK805_IRQ_RTC_PERIOD_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK805_IRQ_PWRON_FALL] = {\n\t\t.mask = RK805_IRQ_PWRON_FALL_MSK,\n\t\t.reg_offset = 0,\n\t},\n};\n\nstatic const struct regmap_irq rk806_irqs[] = {\n\t \n\tREGMAP_IRQ_REG(RK806_IRQ_PWRON_FALL, 0, RK806_INT_STS_PWRON_FALL),\n\tREGMAP_IRQ_REG(RK806_IRQ_PWRON_RISE, 0, RK806_INT_STS_PWRON_RISE),\n\tREGMAP_IRQ_REG(RK806_IRQ_PWRON, 0, RK806_INT_STS_PWRON),\n\tREGMAP_IRQ_REG(RK806_IRQ_PWRON_LP, 0, RK806_INT_STS_PWRON_LP),\n\tREGMAP_IRQ_REG(RK806_IRQ_HOTDIE, 0, RK806_INT_STS_HOTDIE),\n\tREGMAP_IRQ_REG(RK806_IRQ_VDC_RISE, 0, RK806_INT_STS_VDC_RISE),\n\tREGMAP_IRQ_REG(RK806_IRQ_VDC_FALL, 0, RK806_INT_STS_VDC_FALL),\n\tREGMAP_IRQ_REG(RK806_IRQ_VB_LO, 0, RK806_INT_STS_VB_LO),\n\t \n\tREGMAP_IRQ_REG(RK806_IRQ_REV0, 1, RK806_INT_STS_REV0),\n\tREGMAP_IRQ_REG(RK806_IRQ_REV1, 1, RK806_INT_STS_REV1),\n\tREGMAP_IRQ_REG(RK806_IRQ_REV2, 1, RK806_INT_STS_REV2),\n\tREGMAP_IRQ_REG(RK806_IRQ_CRC_ERROR, 1, RK806_INT_STS_CRC_ERROR),\n\tREGMAP_IRQ_REG(RK806_IRQ_SLP3_GPIO, 1, RK806_INT_STS_SLP3_GPIO),\n\tREGMAP_IRQ_REG(RK806_IRQ_SLP2_GPIO, 1, RK806_INT_STS_SLP2_GPIO),\n\tREGMAP_IRQ_REG(RK806_IRQ_SLP1_GPIO, 1, RK806_INT_STS_SLP1_GPIO),\n\tREGMAP_IRQ_REG(RK806_IRQ_WDT, 1, RK806_INT_STS_WDT),\n};\n\nstatic const struct regmap_irq rk808_irqs[] = {\n\t \n\t[RK808_IRQ_VOUT_LO] = {\n\t\t.mask = RK808_IRQ_VOUT_LO_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK808_IRQ_VB_LO] = {\n\t\t.mask = RK808_IRQ_VB_LO_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK808_IRQ_PWRON] = {\n\t\t.mask = RK808_IRQ_PWRON_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK808_IRQ_PWRON_LP] = {\n\t\t.mask = RK808_IRQ_PWRON_LP_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK808_IRQ_HOTDIE] = {\n\t\t.mask = RK808_IRQ_HOTDIE_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK808_IRQ_RTC_ALARM] = {\n\t\t.mask = RK808_IRQ_RTC_ALARM_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK808_IRQ_RTC_PERIOD] = {\n\t\t.mask = RK808_IRQ_RTC_PERIOD_MSK,\n\t\t.reg_offset = 0,\n\t},\n\n\t \n\t[RK808_IRQ_PLUG_IN_INT] = {\n\t\t.mask = RK808_IRQ_PLUG_IN_INT_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK808_IRQ_PLUG_OUT_INT] = {\n\t\t.mask = RK808_IRQ_PLUG_OUT_INT_MSK,\n\t\t.reg_offset = 1,\n\t},\n};\n\nstatic const struct regmap_irq rk818_irqs[] = {\n\t \n\t[RK818_IRQ_VOUT_LO] = {\n\t\t.mask = RK818_IRQ_VOUT_LO_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK818_IRQ_VB_LO] = {\n\t\t.mask = RK818_IRQ_VB_LO_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK818_IRQ_PWRON] = {\n\t\t.mask = RK818_IRQ_PWRON_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK818_IRQ_PWRON_LP] = {\n\t\t.mask = RK818_IRQ_PWRON_LP_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK818_IRQ_HOTDIE] = {\n\t\t.mask = RK818_IRQ_HOTDIE_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK818_IRQ_RTC_ALARM] = {\n\t\t.mask = RK818_IRQ_RTC_ALARM_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK818_IRQ_RTC_PERIOD] = {\n\t\t.mask = RK818_IRQ_RTC_PERIOD_MSK,\n\t\t.reg_offset = 0,\n\t},\n\t[RK818_IRQ_USB_OV] = {\n\t\t.mask = RK818_IRQ_USB_OV_MSK,\n\t\t.reg_offset = 0,\n\t},\n\n\t \n\t[RK818_IRQ_PLUG_IN] = {\n\t\t.mask = RK818_IRQ_PLUG_IN_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK818_IRQ_PLUG_OUT] = {\n\t\t.mask = RK818_IRQ_PLUG_OUT_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK818_IRQ_CHG_OK] = {\n\t\t.mask = RK818_IRQ_CHG_OK_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK818_IRQ_CHG_TE] = {\n\t\t.mask = RK818_IRQ_CHG_TE_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK818_IRQ_CHG_TS1] = {\n\t\t.mask = RK818_IRQ_CHG_TS1_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK818_IRQ_TS2] = {\n\t\t.mask = RK818_IRQ_TS2_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK818_IRQ_CHG_CVTLIM] = {\n\t\t.mask = RK818_IRQ_CHG_CVTLIM_MSK,\n\t\t.reg_offset = 1,\n\t},\n\t[RK818_IRQ_DISCHG_ILIM] = {\n\t\t.mask = RK818_IRQ_DISCHG_ILIM_MSK,\n\t\t.reg_offset = 1,\n\t},\n};\n\nstatic const struct regmap_irq rk817_irqs[RK817_IRQ_END] = {\n\tREGMAP_IRQ_REG_LINE(0, 8),\n\tREGMAP_IRQ_REG_LINE(1, 8),\n\tREGMAP_IRQ_REG_LINE(2, 8),\n\tREGMAP_IRQ_REG_LINE(3, 8),\n\tREGMAP_IRQ_REG_LINE(4, 8),\n\tREGMAP_IRQ_REG_LINE(5, 8),\n\tREGMAP_IRQ_REG_LINE(6, 8),\n\tREGMAP_IRQ_REG_LINE(7, 8),\n\tREGMAP_IRQ_REG_LINE(8, 8),\n\tREGMAP_IRQ_REG_LINE(9, 8),\n\tREGMAP_IRQ_REG_LINE(10, 8),\n\tREGMAP_IRQ_REG_LINE(11, 8),\n\tREGMAP_IRQ_REG_LINE(12, 8),\n\tREGMAP_IRQ_REG_LINE(13, 8),\n\tREGMAP_IRQ_REG_LINE(14, 8),\n\tREGMAP_IRQ_REG_LINE(15, 8),\n\tREGMAP_IRQ_REG_LINE(16, 8),\n\tREGMAP_IRQ_REG_LINE(17, 8),\n\tREGMAP_IRQ_REG_LINE(18, 8),\n\tREGMAP_IRQ_REG_LINE(19, 8),\n\tREGMAP_IRQ_REG_LINE(20, 8),\n\tREGMAP_IRQ_REG_LINE(21, 8),\n\tREGMAP_IRQ_REG_LINE(22, 8),\n\tREGMAP_IRQ_REG_LINE(23, 8)\n};\n\nstatic struct regmap_irq_chip rk805_irq_chip = {\n\t.name = \"rk805\",\n\t.irqs = rk805_irqs,\n\t.num_irqs = ARRAY_SIZE(rk805_irqs),\n\t.num_regs = 1,\n\t.status_base = RK805_INT_STS_REG,\n\t.mask_base = RK805_INT_STS_MSK_REG,\n\t.ack_base = RK805_INT_STS_REG,\n\t.init_ack_masked = true,\n};\n\nstatic struct regmap_irq_chip rk806_irq_chip = {\n\t.name = \"rk806\",\n\t.irqs = rk806_irqs,\n\t.num_irqs = ARRAY_SIZE(rk806_irqs),\n\t.num_regs = 2,\n\t.irq_reg_stride = 2,\n\t.mask_base = RK806_INT_MSK0,\n\t.status_base = RK806_INT_STS0,\n\t.ack_base = RK806_INT_STS0,\n\t.init_ack_masked = true,\n};\n\nstatic const struct regmap_irq_chip rk808_irq_chip = {\n\t.name = \"rk808\",\n\t.irqs = rk808_irqs,\n\t.num_irqs = ARRAY_SIZE(rk808_irqs),\n\t.num_regs = 2,\n\t.irq_reg_stride = 2,\n\t.status_base = RK808_INT_STS_REG1,\n\t.mask_base = RK808_INT_STS_MSK_REG1,\n\t.ack_base = RK808_INT_STS_REG1,\n\t.init_ack_masked = true,\n};\n\nstatic struct regmap_irq_chip rk817_irq_chip = {\n\t.name = \"rk817\",\n\t.irqs = rk817_irqs,\n\t.num_irqs = ARRAY_SIZE(rk817_irqs),\n\t.num_regs = 3,\n\t.irq_reg_stride = 2,\n\t.status_base = RK817_INT_STS_REG0,\n\t.mask_base = RK817_INT_STS_MSK_REG0,\n\t.ack_base = RK817_INT_STS_REG0,\n\t.init_ack_masked = true,\n};\n\nstatic const struct regmap_irq_chip rk818_irq_chip = {\n\t.name = \"rk818\",\n\t.irqs = rk818_irqs,\n\t.num_irqs = ARRAY_SIZE(rk818_irqs),\n\t.num_regs = 2,\n\t.irq_reg_stride = 2,\n\t.status_base = RK818_INT_STS_REG1,\n\t.mask_base = RK818_INT_STS_MSK_REG1,\n\t.ack_base = RK818_INT_STS_REG1,\n\t.init_ack_masked = true,\n};\n\nstatic int rk808_power_off(struct sys_off_data *data)\n{\n\tstruct rk808 *rk808 = data->cb_data;\n\tint ret;\n\tunsigned int reg, bit;\n\n\tswitch (rk808->variant) {\n\tcase RK805_ID:\n\t\treg = RK805_DEV_CTRL_REG;\n\t\tbit = DEV_OFF;\n\t\tbreak;\n\tcase RK808_ID:\n\t\treg = RK808_DEVCTRL_REG,\n\t\tbit = DEV_OFF_RST;\n\t\tbreak;\n\tcase RK809_ID:\n\tcase RK817_ID:\n\t\treg = RK817_SYS_CFG(3);\n\t\tbit = DEV_OFF;\n\t\tbreak;\n\tcase RK818_ID:\n\t\treg = RK818_DEVCTRL_REG;\n\t\tbit = DEV_OFF;\n\t\tbreak;\n\tdefault:\n\t\treturn NOTIFY_DONE;\n\t}\n\tret = regmap_update_bits(rk808->regmap, reg, bit, bit);\n\tif (ret)\n\t\tdev_err(rk808->dev, \"Failed to shutdown device!\\n\");\n\n\treturn NOTIFY_DONE;\n}\n\nstatic int rk808_restart(struct sys_off_data *data)\n{\n\tstruct rk808 *rk808 = data->cb_data;\n\tunsigned int reg, bit;\n\tint ret;\n\n\tswitch (rk808->variant) {\n\tcase RK809_ID:\n\tcase RK817_ID:\n\t\treg = RK817_SYS_CFG(3);\n\t\tbit = DEV_RST;\n\t\tbreak;\n\n\tdefault:\n\t\treturn NOTIFY_DONE;\n\t}\n\tret = regmap_update_bits(rk808->regmap, reg, bit, bit);\n\tif (ret)\n\t\tdev_err(rk808->dev, \"Failed to restart device!\\n\");\n\n\treturn NOTIFY_DONE;\n}\n\nvoid rk8xx_shutdown(struct device *dev)\n{\n\tstruct rk808 *rk808 = dev_get_drvdata(dev);\n\tint ret;\n\n\tswitch (rk808->variant) {\n\tcase RK805_ID:\n\t\tret = regmap_update_bits(rk808->regmap,\n\t\t\t\t\t RK805_GPIO_IO_POL_REG,\n\t\t\t\t\t SLP_SD_MSK,\n\t\t\t\t\t SHUTDOWN_FUN);\n\t\tbreak;\n\tcase RK809_ID:\n\tcase RK817_ID:\n\t\tret = regmap_update_bits(rk808->regmap,\n\t\t\t\t\t RK817_SYS_CFG(3),\n\t\t\t\t\t RK817_SLPPIN_FUNC_MSK,\n\t\t\t\t\t SLPPIN_DN_FUN);\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\tif (ret)\n\t\tdev_warn(dev,\n\t\t\t \"Cannot switch to power down function\\n\");\n}\nEXPORT_SYMBOL_GPL(rk8xx_shutdown);\n\nint rk8xx_probe(struct device *dev, int variant, unsigned int irq, struct regmap *regmap)\n{\n\tstruct rk808 *rk808;\n\tconst struct rk808_reg_data *pre_init_reg;\n\tconst struct mfd_cell *cells;\n\tint dual_support = 0;\n\tint nr_pre_init_regs;\n\tint nr_cells;\n\tint ret;\n\tint i;\n\n\trk808 = devm_kzalloc(dev, sizeof(*rk808), GFP_KERNEL);\n\tif (!rk808)\n\t\treturn -ENOMEM;\n\trk808->dev = dev;\n\trk808->variant = variant;\n\trk808->regmap = regmap;\n\tdev_set_drvdata(dev, rk808);\n\n\tswitch (rk808->variant) {\n\tcase RK805_ID:\n\t\trk808->regmap_irq_chip = &rk805_irq_chip;\n\t\tpre_init_reg = rk805_pre_init_reg;\n\t\tnr_pre_init_regs = ARRAY_SIZE(rk805_pre_init_reg);\n\t\tcells = rk805s;\n\t\tnr_cells = ARRAY_SIZE(rk805s);\n\t\tbreak;\n\tcase RK806_ID:\n\t\trk808->regmap_irq_chip = &rk806_irq_chip;\n\t\tpre_init_reg = rk806_pre_init_reg;\n\t\tnr_pre_init_regs = ARRAY_SIZE(rk806_pre_init_reg);\n\t\tcells = rk806s;\n\t\tnr_cells = ARRAY_SIZE(rk806s);\n\t\tdual_support = IRQF_SHARED;\n\t\tbreak;\n\tcase RK808_ID:\n\t\trk808->regmap_irq_chip = &rk808_irq_chip;\n\t\tpre_init_reg = rk808_pre_init_reg;\n\t\tnr_pre_init_regs = ARRAY_SIZE(rk808_pre_init_reg);\n\t\tcells = rk808s;\n\t\tnr_cells = ARRAY_SIZE(rk808s);\n\t\tbreak;\n\tcase RK818_ID:\n\t\trk808->regmap_irq_chip = &rk818_irq_chip;\n\t\tpre_init_reg = rk818_pre_init_reg;\n\t\tnr_pre_init_regs = ARRAY_SIZE(rk818_pre_init_reg);\n\t\tcells = rk818s;\n\t\tnr_cells = ARRAY_SIZE(rk818s);\n\t\tbreak;\n\tcase RK809_ID:\n\tcase RK817_ID:\n\t\trk808->regmap_irq_chip = &rk817_irq_chip;\n\t\tpre_init_reg = rk817_pre_init_reg;\n\t\tnr_pre_init_regs = ARRAY_SIZE(rk817_pre_init_reg);\n\t\tcells = rk817s;\n\t\tnr_cells = ARRAY_SIZE(rk817s);\n\t\tbreak;\n\tdefault:\n\t\tdev_err(dev, \"Unsupported RK8XX ID %lu\\n\", rk808->variant);\n\t\treturn -EINVAL;\n\t}\n\n\tif (!irq)\n\t\treturn dev_err_probe(dev, -EINVAL, \"No interrupt support, no core IRQ\\n\");\n\n\tret = devm_regmap_add_irq_chip(dev, rk808->regmap, irq,\n\t\t\t\t       IRQF_ONESHOT | dual_support, -1,\n\t\t\t\t       rk808->regmap_irq_chip, &rk808->irq_data);\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret, \"Failed to add irq_chip\\n\");\n\n\tfor (i = 0; i < nr_pre_init_regs; i++) {\n\t\tret = regmap_update_bits(rk808->regmap,\n\t\t\t\t\tpre_init_reg[i].addr,\n\t\t\t\t\tpre_init_reg[i].mask,\n\t\t\t\t\tpre_init_reg[i].value);\n\t\tif (ret)\n\t\t\treturn dev_err_probe(dev, ret, \"0x%x write err\\n\",\n\t\t\t\t\t     pre_init_reg[i].addr);\n\t}\n\n\tret = devm_mfd_add_devices(dev, PLATFORM_DEVID_AUTO, cells, nr_cells, NULL, 0,\n\t\t\t      regmap_irq_get_domain(rk808->irq_data));\n\tif (ret)\n\t\treturn dev_err_probe(dev, ret, \"failed to add MFD devices\\n\");\n\n\tif (device_property_read_bool(dev, \"rockchip,system-power-controller\")) {\n\t\tret = devm_register_sys_off_handler(dev,\n\t\t\t\t    SYS_OFF_MODE_POWER_OFF_PREPARE, SYS_OFF_PRIO_HIGH,\n\t\t\t\t    &rk808_power_off, rk808);\n\t\tif (ret)\n\t\t\treturn dev_err_probe(dev, ret,\n\t\t\t\t\t     \"failed to register poweroff handler\\n\");\n\n\t\tswitch (rk808->variant) {\n\t\tcase RK809_ID:\n\t\tcase RK817_ID:\n\t\t\tret = devm_register_sys_off_handler(dev,\n\t\t\t\t\t\t\t    SYS_OFF_MODE_RESTART, SYS_OFF_PRIO_HIGH,\n\t\t\t\t\t\t\t    &rk808_restart, rk808);\n\t\t\tif (ret)\n\t\t\t\tdev_warn(dev, \"failed to register rst handler, %d\\n\", ret);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tdev_dbg(dev, \"pmic controlled board reset not supported\\n\");\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(rk8xx_probe);\n\nint rk8xx_suspend(struct device *dev)\n{\n\tstruct rk808 *rk808 = dev_get_drvdata(dev);\n\tint ret = 0;\n\n\tswitch (rk808->variant) {\n\tcase RK805_ID:\n\t\tret = regmap_update_bits(rk808->regmap,\n\t\t\t\t\t RK805_GPIO_IO_POL_REG,\n\t\t\t\t\t SLP_SD_MSK,\n\t\t\t\t\t SLEEP_FUN);\n\t\tbreak;\n\tcase RK809_ID:\n\tcase RK817_ID:\n\t\tret = regmap_update_bits(rk808->regmap,\n\t\t\t\t\t RK817_SYS_CFG(3),\n\t\t\t\t\t RK817_SLPPIN_FUNC_MSK,\n\t\t\t\t\t SLPPIN_SLP_FUN);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(rk8xx_suspend);\n\nint rk8xx_resume(struct device *dev)\n{\n\tstruct rk808 *rk808 = dev_get_drvdata(dev);\n\tint ret = 0;\n\n\tswitch (rk808->variant) {\n\tcase RK809_ID:\n\tcase RK817_ID:\n\t\tret = regmap_update_bits(rk808->regmap,\n\t\t\t\t\t RK817_SYS_CFG(3),\n\t\t\t\t\t RK817_SLPPIN_FUNC_MSK,\n\t\t\t\t\t SLPPIN_NULL_FUN);\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(rk8xx_resume);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Chris Zhong <zyw@rock-chips.com>\");\nMODULE_AUTHOR(\"Zhang Qing <zhangqing@rock-chips.com>\");\nMODULE_AUTHOR(\"Wadim Egorov <w.egorov@phytec.de>\");\nMODULE_DESCRIPTION(\"RK8xx PMIC core\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}