{
  "module_name": "lp87565.c",
  "hash_id": "00cb31344add9084573090754d0875ecf50586eca53106e0814293e88bc8bd4f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/lp87565.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/consumer.h>\n#include <linux/interrupt.h>\n#include <linux/mfd/core.h>\n#include <linux/module.h>\n#include <linux/of_device.h>\n#include <linux/regmap.h>\n\n#include <linux/mfd/lp87565.h>\n\nstatic const struct regmap_config lp87565_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\t.max_register = LP87565_REG_MAX,\n};\n\nstatic const struct mfd_cell lp87565_cells[] = {\n\t{ .name = \"lp87565-q1-regulator\", },\n\t{ .name = \"lp87565-q1-gpio\", },\n};\n\nstatic const struct of_device_id of_lp87565_match_table[] = {\n\t{ .compatible = \"ti,lp87565\", },\n\t{\n\t\t.compatible = \"ti,lp87524-q1\",\n\t\t.data = (void *)LP87565_DEVICE_TYPE_LP87524_Q1,\n\t},\n\t{\n\t\t.compatible = \"ti,lp87565-q1\",\n\t\t.data = (void *)LP87565_DEVICE_TYPE_LP87565_Q1,\n\t},\n\t{\n\t\t.compatible = \"ti,lp87561-q1\",\n\t\t.data = (void *)LP87565_DEVICE_TYPE_LP87561_Q1,\n\t},\n\t{}\n};\nMODULE_DEVICE_TABLE(of, of_lp87565_match_table);\n\nstatic int lp87565_probe(struct i2c_client *client)\n{\n\tstruct lp87565 *lp87565;\n\tconst struct of_device_id *of_id;\n\tint ret;\n\tunsigned int otpid;\n\n\tlp87565 = devm_kzalloc(&client->dev, sizeof(*lp87565), GFP_KERNEL);\n\tif (!lp87565)\n\t\treturn -ENOMEM;\n\n\tlp87565->dev = &client->dev;\n\n\tlp87565->regmap = devm_regmap_init_i2c(client, &lp87565_regmap_config);\n\tif (IS_ERR(lp87565->regmap)) {\n\t\tret = PTR_ERR(lp87565->regmap);\n\t\tdev_err(lp87565->dev,\n\t\t\t\"Failed to initialize register map: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\tlp87565->reset_gpio = devm_gpiod_get_optional(lp87565->dev, \"reset\",\n\t\t\t\t\t\t      GPIOD_OUT_LOW);\n\tif (IS_ERR(lp87565->reset_gpio)) {\n\t\tret = PTR_ERR(lp87565->reset_gpio);\n\t\tif (ret == -EPROBE_DEFER)\n\t\t\treturn ret;\n\t}\n\n\tif (lp87565->reset_gpio) {\n\t\tgpiod_set_value_cansleep(lp87565->reset_gpio, 1);\n\t\t \n\t\tusleep_range(2000, 4000);\n\n\t\tgpiod_set_value_cansleep(lp87565->reset_gpio, 0);\n\t\t \n\t\tusleep_range(1500, 3000);\n\t}\n\n\tret = regmap_read(lp87565->regmap, LP87565_REG_OTP_REV, &otpid);\n\tif (ret) {\n\t\tdev_err(lp87565->dev, \"Failed to read OTP ID\\n\");\n\t\treturn ret;\n\t}\n\n\tlp87565->rev = otpid & LP87565_OTP_REV_OTP_ID;\n\n\tof_id = of_match_device(of_lp87565_match_table, &client->dev);\n\tif (of_id)\n\t\tlp87565->dev_type = (uintptr_t)of_id->data;\n\n\ti2c_set_clientdata(client, lp87565);\n\n\treturn devm_mfd_add_devices(lp87565->dev, PLATFORM_DEVID_AUTO,\n\t\t\t\t    lp87565_cells, ARRAY_SIZE(lp87565_cells),\n\t\t\t\t    NULL, 0, NULL);\n}\n\nstatic void lp87565_shutdown(struct i2c_client *client)\n{\n\tstruct lp87565 *lp87565 = i2c_get_clientdata(client);\n\n\tgpiod_set_value_cansleep(lp87565->reset_gpio, 1);\n}\n\nstatic const struct i2c_device_id lp87565_id_table[] = {\n\t{ \"lp87565-q1\", 0 },\n\t{ },\n};\nMODULE_DEVICE_TABLE(i2c, lp87565_id_table);\n\nstatic struct i2c_driver lp87565_driver = {\n\t.driver\t= {\n\t\t.name\t= \"lp87565\",\n\t\t.of_match_table = of_lp87565_match_table,\n\t},\n\t.probe = lp87565_probe,\n\t.shutdown = lp87565_shutdown,\n\t.id_table = lp87565_id_table,\n};\nmodule_i2c_driver(lp87565_driver);\n\nMODULE_AUTHOR(\"J Keerthy <j-keerthy@ti.com>\");\nMODULE_DESCRIPTION(\"lp87565 chip family Multi-Function Device driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}