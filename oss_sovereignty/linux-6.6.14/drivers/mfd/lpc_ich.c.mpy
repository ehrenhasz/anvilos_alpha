{
  "module_name": "lpc_ich.c",
  "hash_id": "58ebd2940327f44baacb0b3745addd1c3010b9c650319eb6fec431ea529a0d87",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/lpc_ich.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/errno.h>\n#include <linux/acpi.h>\n#include <linux/pci.h>\n#include <linux/pinctrl/pinctrl.h>\n#include <linux/mfd/core.h>\n#include <linux/mfd/lpc_ich.h>\n#include <linux/platform_data/itco_wdt.h>\n#include <linux/platform_data/x86/p2sb.h>\n\n#define ACPIBASE\t\t0x40\n#define ACPIBASE_GPE_OFF\t0x28\n#define ACPIBASE_GPE_END\t0x2f\n#define ACPIBASE_SMI_OFF\t0x30\n#define ACPIBASE_SMI_END\t0x33\n#define ACPIBASE_PMC_OFF\t0x08\n#define ACPIBASE_PMC_END\t0x0c\n#define ACPIBASE_TCO_OFF\t0x60\n#define ACPIBASE_TCO_END\t0x7f\n#define ACPICTRL_PMCBASE\t0x44\n\n#define ACPIBASE_GCS_OFF\t0x3410\n#define ACPIBASE_GCS_END\t0x3414\n\n#define SPIBASE_BYT\t\t0x54\n#define SPIBASE_BYT_SZ\t\t512\n#define SPIBASE_BYT_EN\t\tBIT(1)\n#define BYT_BCR\t\t\t0xfc\n#define BYT_BCR_WPD\t\tBIT(0)\n\n#define SPIBASE_LPT\t\t0x3800\n#define SPIBASE_LPT_SZ\t\t512\n#define BCR\t\t\t0xdc\n#define BCR_WPD\t\t\tBIT(0)\n\n#define GPIOBASE_ICH0\t\t0x58\n#define GPIOCTRL_ICH0\t\t0x5C\n#define GPIOBASE_ICH6\t\t0x48\n#define GPIOCTRL_ICH6\t\t0x4C\n\n#define RCBABASE\t\t0xf0\n\n#define wdt_io_res(i) wdt_res(0, i)\n#define wdt_mem_res(i) wdt_res(ICH_RES_MEM_OFF, i)\n#define wdt_res(b, i) (&wdt_ich_res[(b) + (i)])\n\nstruct lpc_ich_priv {\n\tint chipset;\n\n\tint abase;\t\t \n\tint actrl_pbase;\t \n\tint gbase;\t\t \n\tint gctrl;\t\t \n\n\tint abase_save;\t\t \n\tint actrl_pbase_save;\t\t \n\tint gctrl_save;\t\t \n};\n\nstatic struct resource wdt_ich_res[] = {\n\t \n\t{\n\t\t.flags = IORESOURCE_IO,\n\t},\n\t \n\t{\n\t\t.flags = IORESOURCE_IO,\n\t},\n\t \n\t{\n\t\t.flags = IORESOURCE_MEM,\n\t},\n};\n\nstatic struct resource gpio_ich_res[] = {\n\t \n\t{\n\t\t.flags = IORESOURCE_IO,\n\t},\n\t \n\t{\n\t\t.flags = IORESOURCE_IO,\n\t},\n};\n\nstatic struct resource intel_spi_res[] = {\n\t{\n\t\t.flags = IORESOURCE_MEM,\n\t}\n};\n\nstatic struct mfd_cell lpc_ich_wdt_cell = {\n\t.name = \"iTCO_wdt\",\n\t.num_resources = ARRAY_SIZE(wdt_ich_res),\n\t.resources = wdt_ich_res,\n\t.ignore_resource_conflicts = true,\n};\n\nstatic struct mfd_cell lpc_ich_gpio_cell = {\n\t.name = \"gpio_ich\",\n\t.num_resources = ARRAY_SIZE(gpio_ich_res),\n\t.resources = gpio_ich_res,\n\t.ignore_resource_conflicts = true,\n};\n\n#define APL_GPIO_NORTH\t\t0\n#define APL_GPIO_NORTHWEST\t1\n#define APL_GPIO_WEST\t\t2\n#define APL_GPIO_SOUTHWEST\t3\n#define APL_GPIO_NR_DEVICES\t4\n\n \nstatic resource_size_t apl_gpio_offsets[APL_GPIO_NR_DEVICES] = {\n\t[APL_GPIO_NORTH]\t= 0xc50000,\n\t[APL_GPIO_NORTHWEST]\t= 0xc40000,\n\t[APL_GPIO_WEST]\t\t= 0xc70000,\n\t[APL_GPIO_SOUTHWEST]\t= 0xc00000,\n};\n\n#define APL_GPIO_RESOURCE_SIZE\t\t0x1000\n\n#define APL_GPIO_IRQ\t\t\t14\n\nstatic struct resource apl_gpio_resources[APL_GPIO_NR_DEVICES][2] = {\n\t[APL_GPIO_NORTH] = {\n\t\tDEFINE_RES_MEM(0, 0),\n\t\tDEFINE_RES_IRQ(APL_GPIO_IRQ),\n\t},\n\t[APL_GPIO_NORTHWEST] = {\n\t\tDEFINE_RES_MEM(0, 0),\n\t\tDEFINE_RES_IRQ(APL_GPIO_IRQ),\n\t},\n\t[APL_GPIO_WEST] = {\n\t\tDEFINE_RES_MEM(0, 0),\n\t\tDEFINE_RES_IRQ(APL_GPIO_IRQ),\n\t},\n\t[APL_GPIO_SOUTHWEST] = {\n\t\tDEFINE_RES_MEM(0, 0),\n\t\tDEFINE_RES_IRQ(APL_GPIO_IRQ),\n\t},\n};\n\nstatic const struct mfd_cell apl_gpio_devices[APL_GPIO_NR_DEVICES] = {\n\t[APL_GPIO_NORTH] = {\n\t\t.name = \"apollolake-pinctrl\",\n\t\t.id = APL_GPIO_NORTH,\n\t\t.num_resources = ARRAY_SIZE(apl_gpio_resources[APL_GPIO_NORTH]),\n\t\t.resources = apl_gpio_resources[APL_GPIO_NORTH],\n\t\t.ignore_resource_conflicts = true,\n\t},\n\t[APL_GPIO_NORTHWEST] = {\n\t\t.name = \"apollolake-pinctrl\",\n\t\t.id = APL_GPIO_NORTHWEST,\n\t\t.num_resources = ARRAY_SIZE(apl_gpio_resources[APL_GPIO_NORTHWEST]),\n\t\t.resources = apl_gpio_resources[APL_GPIO_NORTHWEST],\n\t\t.ignore_resource_conflicts = true,\n\t},\n\t[APL_GPIO_WEST] = {\n\t\t.name = \"apollolake-pinctrl\",\n\t\t.id = APL_GPIO_WEST,\n\t\t.num_resources = ARRAY_SIZE(apl_gpio_resources[APL_GPIO_WEST]),\n\t\t.resources = apl_gpio_resources[APL_GPIO_WEST],\n\t\t.ignore_resource_conflicts = true,\n\t},\n\t[APL_GPIO_SOUTHWEST] = {\n\t\t.name = \"apollolake-pinctrl\",\n\t\t.id = APL_GPIO_SOUTHWEST,\n\t\t.num_resources = ARRAY_SIZE(apl_gpio_resources[APL_GPIO_SOUTHWEST]),\n\t\t.resources = apl_gpio_resources[APL_GPIO_SOUTHWEST],\n\t\t.ignore_resource_conflicts = true,\n\t},\n};\n\nstatic struct mfd_cell lpc_ich_spi_cell = {\n\t.name = \"intel-spi\",\n\t.num_resources = ARRAY_SIZE(intel_spi_res),\n\t.resources = intel_spi_res,\n\t.ignore_resource_conflicts = true,\n};\n\n \nenum lpc_chipsets {\n\tLPC_ICH = 0,\t \n\tLPC_ICH0,\t \n\tLPC_ICH2,\t \n\tLPC_ICH2M,\t \n\tLPC_ICH3,\t \n\tLPC_ICH3M,\t \n\tLPC_ICH4,\t \n\tLPC_ICH4M,\t \n\tLPC_CICH,\t \n\tLPC_ICH5,\t \n\tLPC_6300ESB,\t \n\tLPC_ICH6,\t \n\tLPC_ICH6M,\t \n\tLPC_ICH6W,\t \n\tLPC_631XESB,\t \n\tLPC_ICH7,\t \n\tLPC_ICH7DH,\t \n\tLPC_ICH7M,\t \n\tLPC_ICH7MDH,\t \n\tLPC_NM10,\t \n\tLPC_ICH8,\t \n\tLPC_ICH8DH,\t \n\tLPC_ICH8DO,\t \n\tLPC_ICH8M,\t \n\tLPC_ICH8ME,\t \n\tLPC_ICH9,\t \n\tLPC_ICH9R,\t \n\tLPC_ICH9DH,\t \n\tLPC_ICH9DO,\t \n\tLPC_ICH9M,\t \n\tLPC_ICH9ME,\t \n\tLPC_ICH10,\t \n\tLPC_ICH10R,\t \n\tLPC_ICH10D,\t \n\tLPC_ICH10DO,\t \n\tLPC_PCH,\t \n\tLPC_PCHM,\t \n\tLPC_P55,\t \n\tLPC_PM55,\t \n\tLPC_H55,\t \n\tLPC_QM57,\t \n\tLPC_H57,\t \n\tLPC_HM55,\t \n\tLPC_Q57,\t \n\tLPC_HM57,\t \n\tLPC_PCHMSFF,\t \n\tLPC_QS57,\t \n\tLPC_3400,\t \n\tLPC_3420,\t \n\tLPC_3450,\t \n\tLPC_EP80579,\t \n\tLPC_CPT,\t \n\tLPC_CPTD,\t \n\tLPC_CPTM,\t \n\tLPC_PBG,\t \n\tLPC_DH89XXCC,\t \n\tLPC_PPT,\t \n\tLPC_LPT,\t \n\tLPC_LPT_LP,\t \n\tLPC_WBG,\t \n\tLPC_AVN,\t \n\tLPC_BAYTRAIL,    \n\tLPC_COLETO,\t \n\tLPC_WPT_LP,\t \n\tLPC_BRASWELL,\t \n\tLPC_LEWISBURG,\t \n\tLPC_9S,\t\t \n\tLPC_APL,\t \n\tLPC_GLK,\t \n\tLPC_COUGARMOUNTAIN, \n};\n\nstatic struct lpc_ich_info lpc_chipset_info[] = {\n\t[LPC_ICH] = {\n\t\t.name = \"ICH\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH0] = {\n\t\t.name = \"ICH0\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH2] = {\n\t\t.name = \"ICH2\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH2M] = {\n\t\t.name = \"ICH2-M\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH3] = {\n\t\t.name = \"ICH3-S\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH3M] = {\n\t\t.name = \"ICH3-M\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH4] = {\n\t\t.name = \"ICH4\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH4M] = {\n\t\t.name = \"ICH4-M\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_CICH] = {\n\t\t.name = \"C-ICH\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH5] = {\n\t\t.name = \"ICH5 or ICH5R\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_6300ESB] = {\n\t\t.name = \"6300ESB\",\n\t\t.iTCO_version = 1,\n\t},\n\t[LPC_ICH6] = {\n\t\t.name = \"ICH6 or ICH6R\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V6_GPIO,\n\t},\n\t[LPC_ICH6M] = {\n\t\t.name = \"ICH6-M\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V6_GPIO,\n\t},\n\t[LPC_ICH6W] = {\n\t\t.name = \"ICH6W or ICH6RW\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V6_GPIO,\n\t},\n\t[LPC_631XESB] = {\n\t\t.name = \"631xESB/632xESB\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V6_GPIO,\n\t},\n\t[LPC_ICH7] = {\n\t\t.name = \"ICH7 or ICH7R\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH7DH] = {\n\t\t.name = \"ICH7DH\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH7M] = {\n\t\t.name = \"ICH7-M or ICH7-U\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH7MDH] = {\n\t\t.name = \"ICH7-M DH\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_NM10] = {\n\t\t.name = \"NM10\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH8] = {\n\t\t.name = \"ICH8 or ICH8R\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH8DH] = {\n\t\t.name = \"ICH8DH\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH8DO] = {\n\t\t.name = \"ICH8DO\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH8M] = {\n\t\t.name = \"ICH8M\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH8ME] = {\n\t\t.name = \"ICH8M-E\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V7_GPIO,\n\t},\n\t[LPC_ICH9] = {\n\t\t.name = \"ICH9\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V9_GPIO,\n\t},\n\t[LPC_ICH9R] = {\n\t\t.name = \"ICH9R\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V9_GPIO,\n\t},\n\t[LPC_ICH9DH] = {\n\t\t.name = \"ICH9DH\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V9_GPIO,\n\t},\n\t[LPC_ICH9DO] = {\n\t\t.name = \"ICH9DO\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V9_GPIO,\n\t},\n\t[LPC_ICH9M] = {\n\t\t.name = \"ICH9M\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V9_GPIO,\n\t},\n\t[LPC_ICH9ME] = {\n\t\t.name = \"ICH9M-E\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V9_GPIO,\n\t},\n\t[LPC_ICH10] = {\n\t\t.name = \"ICH10\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V10CONS_GPIO,\n\t},\n\t[LPC_ICH10R] = {\n\t\t.name = \"ICH10R\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V10CONS_GPIO,\n\t},\n\t[LPC_ICH10D] = {\n\t\t.name = \"ICH10D\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V10CORP_GPIO,\n\t},\n\t[LPC_ICH10DO] = {\n\t\t.name = \"ICH10DO\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V10CORP_GPIO,\n\t},\n\t[LPC_PCH] = {\n\t\t.name = \"PCH Desktop Full Featured\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_PCHM] = {\n\t\t.name = \"PCH Mobile Full Featured\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_P55] = {\n\t\t.name = \"P55\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_PM55] = {\n\t\t.name = \"PM55\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_H55] = {\n\t\t.name = \"H55\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_QM57] = {\n\t\t.name = \"QM57\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_H57] = {\n\t\t.name = \"H57\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_HM55] = {\n\t\t.name = \"HM55\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_Q57] = {\n\t\t.name = \"Q57\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_HM57] = {\n\t\t.name = \"HM57\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_PCHMSFF] = {\n\t\t.name = \"PCH Mobile SFF Full Featured\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_QS57] = {\n\t\t.name = \"QS57\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_3400] = {\n\t\t.name = \"3400\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_3420] = {\n\t\t.name = \"3420\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_3450] = {\n\t\t.name = \"3450\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_EP80579] = {\n\t\t.name = \"EP80579\",\n\t\t.iTCO_version = 2,\n\t},\n\t[LPC_CPT] = {\n\t\t.name = \"Cougar Point\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_CPTD] = {\n\t\t.name = \"Cougar Point Desktop\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_CPTM] = {\n\t\t.name = \"Cougar Point Mobile\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_PBG] = {\n\t\t.name = \"Patsburg\",\n\t\t.iTCO_version = 2,\n\t},\n\t[LPC_DH89XXCC] = {\n\t\t.name = \"DH89xxCC\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_PPT] = {\n\t\t.name = \"Panther Point\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_LPT] = {\n\t\t.name = \"Lynx Point\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t\t.spi_type = INTEL_SPI_LPT,\n\t},\n\t[LPC_LPT_LP] = {\n\t\t.name = \"Lynx Point_LP\",\n\t\t.iTCO_version = 2,\n\t\t.spi_type = INTEL_SPI_LPT,\n\t},\n\t[LPC_WBG] = {\n\t\t.name = \"Wellsburg\",\n\t\t.iTCO_version = 2,\n\t},\n\t[LPC_AVN] = {\n\t\t.name = \"Avoton SoC\",\n\t\t.iTCO_version = 3,\n\t\t.gpio_version = AVOTON_GPIO,\n\t\t.spi_type = INTEL_SPI_BYT,\n\t},\n\t[LPC_BAYTRAIL] = {\n\t\t.name = \"Bay Trail SoC\",\n\t\t.iTCO_version = 3,\n\t\t.spi_type = INTEL_SPI_BYT,\n\t},\n\t[LPC_COLETO] = {\n\t\t.name = \"Coleto Creek\",\n\t\t.iTCO_version = 2,\n\t},\n\t[LPC_WPT_LP] = {\n\t\t.name = \"Wildcat Point_LP\",\n\t\t.iTCO_version = 2,\n\t\t.spi_type = INTEL_SPI_LPT,\n\t},\n\t[LPC_BRASWELL] = {\n\t\t.name = \"Braswell SoC\",\n\t\t.iTCO_version = 3,\n\t\t.spi_type = INTEL_SPI_BYT,\n\t},\n\t[LPC_LEWISBURG] = {\n\t\t.name = \"Lewisburg\",\n\t\t.iTCO_version = 2,\n\t},\n\t[LPC_9S] = {\n\t\t.name = \"9 Series\",\n\t\t.iTCO_version = 2,\n\t\t.gpio_version = ICH_V5_GPIO,\n\t},\n\t[LPC_APL] = {\n\t\t.name = \"Apollo Lake SoC\",\n\t\t.iTCO_version = 5,\n\t\t.spi_type = INTEL_SPI_BXT,\n\t},\n\t[LPC_GLK] = {\n\t\t.name = \"Gemini Lake SoC\",\n\t\t.spi_type = INTEL_SPI_BXT,\n\t},\n\t[LPC_COUGARMOUNTAIN] = {\n\t\t.name = \"Cougar Mountain SoC\",\n\t\t.iTCO_version = 3,\n\t},\n};\n\n \nstatic const struct pci_device_id lpc_ich_ids[] = {\n\t{ PCI_VDEVICE(INTEL, 0x0f1c), LPC_BAYTRAIL},\n\t{ PCI_VDEVICE(INTEL, 0x1c41), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c42), LPC_CPTD},\n\t{ PCI_VDEVICE(INTEL, 0x1c43), LPC_CPTM},\n\t{ PCI_VDEVICE(INTEL, 0x1c44), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c45), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c46), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c47), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c48), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c49), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c4a), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c4b), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c4c), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c4d), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c4e), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c4f), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c50), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c51), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c52), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c53), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c54), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c55), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c56), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c57), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c58), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c59), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c5a), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c5b), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c5c), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c5d), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c5e), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1c5f), LPC_CPT},\n\t{ PCI_VDEVICE(INTEL, 0x1d40), LPC_PBG},\n\t{ PCI_VDEVICE(INTEL, 0x1d41), LPC_PBG},\n\t{ PCI_VDEVICE(INTEL, 0x1e40), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e41), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e42), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e43), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e44), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e45), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e46), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e47), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e48), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e49), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e4a), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e4b), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e4c), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e4d), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e4e), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e4f), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e50), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e51), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e52), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e53), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e54), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e55), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e56), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e57), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e58), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e59), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e5a), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e5b), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e5c), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e5d), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e5e), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1e5f), LPC_PPT},\n\t{ PCI_VDEVICE(INTEL, 0x1f38), LPC_AVN},\n\t{ PCI_VDEVICE(INTEL, 0x1f39), LPC_AVN},\n\t{ PCI_VDEVICE(INTEL, 0x1f3a), LPC_AVN},\n\t{ PCI_VDEVICE(INTEL, 0x1f3b), LPC_AVN},\n\t{ PCI_VDEVICE(INTEL, 0x229c), LPC_BRASWELL},\n\t{ PCI_VDEVICE(INTEL, 0x2310), LPC_DH89XXCC},\n\t{ PCI_VDEVICE(INTEL, 0x2390), LPC_COLETO},\n\t{ PCI_VDEVICE(INTEL, 0x2410), LPC_ICH},\n\t{ PCI_VDEVICE(INTEL, 0x2420), LPC_ICH0},\n\t{ PCI_VDEVICE(INTEL, 0x2440), LPC_ICH2},\n\t{ PCI_VDEVICE(INTEL, 0x244c), LPC_ICH2M},\n\t{ PCI_VDEVICE(INTEL, 0x2450), LPC_CICH},\n\t{ PCI_VDEVICE(INTEL, 0x2480), LPC_ICH3},\n\t{ PCI_VDEVICE(INTEL, 0x248c), LPC_ICH3M},\n\t{ PCI_VDEVICE(INTEL, 0x24c0), LPC_ICH4},\n\t{ PCI_VDEVICE(INTEL, 0x24cc), LPC_ICH4M},\n\t{ PCI_VDEVICE(INTEL, 0x24d0), LPC_ICH5},\n\t{ PCI_VDEVICE(INTEL, 0x25a1), LPC_6300ESB},\n\t{ PCI_VDEVICE(INTEL, 0x2640), LPC_ICH6},\n\t{ PCI_VDEVICE(INTEL, 0x2641), LPC_ICH6M},\n\t{ PCI_VDEVICE(INTEL, 0x2642), LPC_ICH6W},\n\t{ PCI_VDEVICE(INTEL, 0x2670), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2671), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2672), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2673), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2674), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2675), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2676), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2677), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2678), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x2679), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x267a), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x267b), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x267c), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x267d), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x267e), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x267f), LPC_631XESB},\n\t{ PCI_VDEVICE(INTEL, 0x27b0), LPC_ICH7DH},\n\t{ PCI_VDEVICE(INTEL, 0x27b8), LPC_ICH7},\n\t{ PCI_VDEVICE(INTEL, 0x27b9), LPC_ICH7M},\n\t{ PCI_VDEVICE(INTEL, 0x27bc), LPC_NM10},\n\t{ PCI_VDEVICE(INTEL, 0x27bd), LPC_ICH7MDH},\n\t{ PCI_VDEVICE(INTEL, 0x2810), LPC_ICH8},\n\t{ PCI_VDEVICE(INTEL, 0x2811), LPC_ICH8ME},\n\t{ PCI_VDEVICE(INTEL, 0x2812), LPC_ICH8DH},\n\t{ PCI_VDEVICE(INTEL, 0x2814), LPC_ICH8DO},\n\t{ PCI_VDEVICE(INTEL, 0x2815), LPC_ICH8M},\n\t{ PCI_VDEVICE(INTEL, 0x2912), LPC_ICH9DH},\n\t{ PCI_VDEVICE(INTEL, 0x2914), LPC_ICH9DO},\n\t{ PCI_VDEVICE(INTEL, 0x2916), LPC_ICH9R},\n\t{ PCI_VDEVICE(INTEL, 0x2917), LPC_ICH9ME},\n\t{ PCI_VDEVICE(INTEL, 0x2918), LPC_ICH9},\n\t{ PCI_VDEVICE(INTEL, 0x2919), LPC_ICH9M},\n\t{ PCI_VDEVICE(INTEL, 0x3197), LPC_GLK},\n\t{ PCI_VDEVICE(INTEL, 0x2b9c), LPC_COUGARMOUNTAIN},\n\t{ PCI_VDEVICE(INTEL, 0x3a14), LPC_ICH10DO},\n\t{ PCI_VDEVICE(INTEL, 0x3a16), LPC_ICH10R},\n\t{ PCI_VDEVICE(INTEL, 0x3a18), LPC_ICH10},\n\t{ PCI_VDEVICE(INTEL, 0x3a1a), LPC_ICH10D},\n\t{ PCI_VDEVICE(INTEL, 0x3b00), LPC_PCH},\n\t{ PCI_VDEVICE(INTEL, 0x3b01), LPC_PCHM},\n\t{ PCI_VDEVICE(INTEL, 0x3b02), LPC_P55},\n\t{ PCI_VDEVICE(INTEL, 0x3b03), LPC_PM55},\n\t{ PCI_VDEVICE(INTEL, 0x3b06), LPC_H55},\n\t{ PCI_VDEVICE(INTEL, 0x3b07), LPC_QM57},\n\t{ PCI_VDEVICE(INTEL, 0x3b08), LPC_H57},\n\t{ PCI_VDEVICE(INTEL, 0x3b09), LPC_HM55},\n\t{ PCI_VDEVICE(INTEL, 0x3b0a), LPC_Q57},\n\t{ PCI_VDEVICE(INTEL, 0x3b0b), LPC_HM57},\n\t{ PCI_VDEVICE(INTEL, 0x3b0d), LPC_PCHMSFF},\n\t{ PCI_VDEVICE(INTEL, 0x3b0f), LPC_QS57},\n\t{ PCI_VDEVICE(INTEL, 0x3b12), LPC_3400},\n\t{ PCI_VDEVICE(INTEL, 0x3b14), LPC_3420},\n\t{ PCI_VDEVICE(INTEL, 0x3b16), LPC_3450},\n\t{ PCI_VDEVICE(INTEL, 0x5031), LPC_EP80579},\n\t{ PCI_VDEVICE(INTEL, 0x5ae8), LPC_APL},\n\t{ PCI_VDEVICE(INTEL, 0x8c40), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c41), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c42), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c43), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c44), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c45), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c46), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c47), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c48), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c49), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c4a), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c4b), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c4c), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c4d), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c4e), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c4f), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c50), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c51), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c52), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c53), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c54), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c55), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c56), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c57), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c58), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c59), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c5a), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c5b), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c5c), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c5d), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c5e), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8c5f), LPC_LPT},\n\t{ PCI_VDEVICE(INTEL, 0x8cc1), LPC_9S},\n\t{ PCI_VDEVICE(INTEL, 0x8cc2), LPC_9S},\n\t{ PCI_VDEVICE(INTEL, 0x8cc3), LPC_9S},\n\t{ PCI_VDEVICE(INTEL, 0x8cc4), LPC_9S},\n\t{ PCI_VDEVICE(INTEL, 0x8cc6), LPC_9S},\n\t{ PCI_VDEVICE(INTEL, 0x8d40), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d41), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d42), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d43), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d44), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d45), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d46), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d47), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d48), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d49), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d4a), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d4b), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d4c), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d4d), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d4e), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d4f), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d50), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d51), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d52), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d53), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d54), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d55), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d56), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d57), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d58), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d59), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d5a), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d5b), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d5c), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d5d), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d5e), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x8d5f), LPC_WBG},\n\t{ PCI_VDEVICE(INTEL, 0x9c40), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9c41), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9c42), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9c43), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9c44), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9c45), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9c46), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9c47), LPC_LPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9cc1), LPC_WPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9cc2), LPC_WPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9cc3), LPC_WPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9cc5), LPC_WPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9cc6), LPC_WPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9cc7), LPC_WPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0x9cc9), LPC_WPT_LP},\n\t{ PCI_VDEVICE(INTEL, 0xa1c1), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa1c2), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa1c3), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa1c4), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa1c5), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa1c6), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa1c7), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa242), LPC_LEWISBURG},\n\t{ PCI_VDEVICE(INTEL, 0xa243), LPC_LEWISBURG},\n\t{ 0, },\t\t\t \n};\nMODULE_DEVICE_TABLE(pci, lpc_ich_ids);\n\nstatic void lpc_ich_restore_config_space(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\n\tif (priv->abase_save >= 0) {\n\t\tpci_write_config_byte(dev, priv->abase, priv->abase_save);\n\t\tpriv->abase_save = -1;\n\t}\n\n\tif (priv->actrl_pbase_save >= 0) {\n\t\tpci_write_config_byte(dev, priv->actrl_pbase,\n\t\t\tpriv->actrl_pbase_save);\n\t\tpriv->actrl_pbase_save = -1;\n\t}\n\n\tif (priv->gctrl_save >= 0) {\n\t\tpci_write_config_byte(dev, priv->gctrl, priv->gctrl_save);\n\t\tpriv->gctrl_save = -1;\n\t}\n}\n\nstatic void lpc_ich_enable_acpi_space(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tu8 reg_save;\n\n\tswitch (lpc_chipset_info[priv->chipset].iTCO_version) {\n\tcase 3:\n\t\t \n\t\tpci_read_config_byte(dev, priv->abase, &reg_save);\n\t\tpci_write_config_byte(dev, priv->abase, reg_save | 0x2);\n\t\tpriv->abase_save = reg_save;\n\t\tbreak;\n\tdefault:\n\t\t \n\t\tpci_read_config_byte(dev, priv->actrl_pbase, &reg_save);\n\t\tpci_write_config_byte(dev, priv->actrl_pbase, reg_save | 0x80);\n\t\tpriv->actrl_pbase_save = reg_save;\n\t\tbreak;\n\t}\n}\n\nstatic void lpc_ich_enable_gpio_space(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tu8 reg_save;\n\n\tpci_read_config_byte(dev, priv->gctrl, &reg_save);\n\tpci_write_config_byte(dev, priv->gctrl, reg_save | 0x10);\n\tpriv->gctrl_save = reg_save;\n}\n\nstatic void lpc_ich_enable_pmc_space(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tu8 reg_save;\n\n\tpci_read_config_byte(dev, priv->actrl_pbase, &reg_save);\n\tpci_write_config_byte(dev, priv->actrl_pbase, reg_save | 0x2);\n\n\tpriv->actrl_pbase_save = reg_save;\n}\n\nstatic int lpc_ich_finalize_wdt_cell(struct pci_dev *dev)\n{\n\tstruct itco_wdt_platform_data *pdata;\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tstruct lpc_ich_info *info;\n\tstruct mfd_cell *cell = &lpc_ich_wdt_cell;\n\n\tpdata = devm_kzalloc(&dev->dev, sizeof(*pdata), GFP_KERNEL);\n\tif (!pdata)\n\t\treturn -ENOMEM;\n\n\tinfo = &lpc_chipset_info[priv->chipset];\n\n\tpdata->version = info->iTCO_version;\n\tstrscpy(pdata->name, info->name, sizeof(pdata->name));\n\n\tcell->platform_data = pdata;\n\tcell->pdata_size = sizeof(*pdata);\n\treturn 0;\n}\n\nstatic void lpc_ich_finalize_gpio_cell(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tstruct mfd_cell *cell = &lpc_ich_gpio_cell;\n\n\tcell->platform_data = &lpc_chipset_info[priv->chipset];\n\tcell->pdata_size = sizeof(struct lpc_ich_info);\n}\n\n \nstatic int lpc_ich_check_conflict_gpio(struct resource *res)\n{\n\tint ret;\n\tu8 use_gpio = 0;\n\n\tif (resource_size(res) >= 0x50 &&\n\t    !acpi_check_region(res->start + 0x40, 0x10, \"LPC ICH GPIO3\"))\n\t\tuse_gpio |= 1 << 2;\n\n\tif (!acpi_check_region(res->start + 0x30, 0x10, \"LPC ICH GPIO2\"))\n\t\tuse_gpio |= 1 << 1;\n\n\tret = acpi_check_region(res->start + 0x00, 0x30, \"LPC ICH GPIO1\");\n\tif (!ret)\n\t\tuse_gpio |= 1 << 0;\n\n\treturn use_gpio ? use_gpio : ret;\n}\n\nstatic int lpc_ich_init_gpio(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tu32 base_addr_cfg;\n\tu32 base_addr;\n\tint ret;\n\tbool acpi_conflict = false;\n\tstruct resource *res;\n\n\t \n\tpci_read_config_dword(dev, priv->abase, &base_addr_cfg);\n\tbase_addr = base_addr_cfg & 0x0000ff80;\n\tif (!base_addr) {\n\t\tdev_notice(&dev->dev, \"I/O space for ACPI uninitialized\\n\");\n\t\tlpc_ich_gpio_cell.num_resources--;\n\t\tgoto gpe0_done;\n\t}\n\n\tres = &gpio_ich_res[ICH_RES_GPE0];\n\tres->start = base_addr + ACPIBASE_GPE_OFF;\n\tres->end = base_addr + ACPIBASE_GPE_END;\n\tret = acpi_check_resource_conflict(res);\n\tif (ret) {\n\t\t \n\t\tlpc_ich_gpio_cell.num_resources--;\n\t\tacpi_conflict = true;\n\t} else {\n\t\tlpc_ich_enable_acpi_space(dev);\n\t}\n\ngpe0_done:\n\t \n\tpci_read_config_dword(dev, priv->gbase, &base_addr_cfg);\n\tbase_addr = base_addr_cfg & 0x0000ff80;\n\tif (!base_addr) {\n\t\tdev_notice(&dev->dev, \"I/O space for GPIO uninitialized\\n\");\n\t\tret = -ENODEV;\n\t\tgoto gpio_done;\n\t}\n\n\t \n\tres = &gpio_ich_res[ICH_RES_GPIO];\n\tres->start = base_addr;\n\tswitch (lpc_chipset_info[priv->chipset].gpio_version) {\n\tcase ICH_V5_GPIO:\n\tcase ICH_V10CORP_GPIO:\n\t\tres->end = res->start + 128 - 1;\n\t\tbreak;\n\tdefault:\n\t\tres->end = res->start + 64 - 1;\n\t\tbreak;\n\t}\n\n\tret = lpc_ich_check_conflict_gpio(res);\n\tif (ret < 0) {\n\t\t \n\t\tacpi_conflict = true;\n\t\tgoto gpio_done;\n\t}\n\tlpc_chipset_info[priv->chipset].use_gpio = ret;\n\tlpc_ich_enable_gpio_space(dev);\n\n\tlpc_ich_finalize_gpio_cell(dev);\n\tret = mfd_add_devices(&dev->dev, PLATFORM_DEVID_AUTO,\n\t\t\t      &lpc_ich_gpio_cell, 1, NULL, 0, NULL);\n\ngpio_done:\n\tif (acpi_conflict)\n\t\tpr_warn(\"Resource conflict(s) found affecting %s\\n\",\n\t\t\t\tlpc_ich_gpio_cell.name);\n\treturn ret;\n}\n\nstatic int lpc_ich_init_wdt(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tu32 base_addr_cfg;\n\tu32 base_addr;\n\tint ret;\n\tstruct resource *res;\n\n\t \n\tif (acpi_has_watchdog())\n\t\treturn -ENODEV;\n\n\t \n\tpci_read_config_dword(dev, priv->abase, &base_addr_cfg);\n\tbase_addr = base_addr_cfg & 0x0000ff80;\n\tif (!base_addr) {\n\t\tdev_notice(&dev->dev, \"I/O space for ACPI uninitialized\\n\");\n\t\tret = -ENODEV;\n\t\tgoto wdt_done;\n\t}\n\n\tres = wdt_io_res(ICH_RES_IO_TCO);\n\tres->start = base_addr + ACPIBASE_TCO_OFF;\n\tres->end = base_addr + ACPIBASE_TCO_END;\n\n\tres = wdt_io_res(ICH_RES_IO_SMI);\n\tres->start = base_addr + ACPIBASE_SMI_OFF;\n\tres->end = base_addr + ACPIBASE_SMI_END;\n\n\tlpc_ich_enable_acpi_space(dev);\n\n\t \n\tif (lpc_chipset_info[priv->chipset].iTCO_version == 1) {\n\t\t \n\t\tlpc_ich_wdt_cell.num_resources--;\n\t} else if (lpc_chipset_info[priv->chipset].iTCO_version == 2) {\n\t\tpci_read_config_dword(dev, RCBABASE, &base_addr_cfg);\n\t\tbase_addr = base_addr_cfg & 0xffffc000;\n\t\tif (!(base_addr_cfg & 1)) {\n\t\t\tdev_notice(&dev->dev, \"RCBA is disabled by \"\n\t\t\t\t\t\"hardware/BIOS, device disabled\\n\");\n\t\t\tret = -ENODEV;\n\t\t\tgoto wdt_done;\n\t\t}\n\t\tres = wdt_mem_res(ICH_RES_MEM_GCS_PMC);\n\t\tres->start = base_addr + ACPIBASE_GCS_OFF;\n\t\tres->end = base_addr + ACPIBASE_GCS_END;\n\t} else if (lpc_chipset_info[priv->chipset].iTCO_version == 3) {\n\t\tlpc_ich_enable_pmc_space(dev);\n\t\tpci_read_config_dword(dev, ACPICTRL_PMCBASE, &base_addr_cfg);\n\t\tbase_addr = base_addr_cfg & 0xfffffe00;\n\n\t\tres = wdt_mem_res(ICH_RES_MEM_GCS_PMC);\n\t\tres->start = base_addr + ACPIBASE_PMC_OFF;\n\t\tres->end = base_addr + ACPIBASE_PMC_END;\n\t}\n\n\tret = lpc_ich_finalize_wdt_cell(dev);\n\tif (ret)\n\t\tgoto wdt_done;\n\n\tret = mfd_add_devices(&dev->dev, PLATFORM_DEVID_AUTO,\n\t\t\t      &lpc_ich_wdt_cell, 1, NULL, 0, NULL);\n\nwdt_done:\n\treturn ret;\n}\n\nstatic int lpc_ich_init_pinctrl(struct pci_dev *dev)\n{\n\tstruct resource base;\n\tunsigned int i;\n\tint ret;\n\n\t \n\tif (acpi_dev_present(\"INT3452\", NULL, -1))\n\t\treturn -EEXIST;\n\n\tret = p2sb_bar(dev->bus, 0, &base);\n\tif (ret)\n\t\treturn ret;\n\n\tfor (i = 0; i < ARRAY_SIZE(apl_gpio_devices); i++) {\n\t\tstruct resource *mem = &apl_gpio_resources[i][0];\n\t\tresource_size_t offset = apl_gpio_offsets[i];\n\n\t\t \n\t\tmem->start = base.start + offset;\n\t\tmem->end = base.start + offset + APL_GPIO_RESOURCE_SIZE - 1;\n\t\tmem->flags = base.flags;\n\t}\n\n\treturn mfd_add_devices(&dev->dev, 0, apl_gpio_devices,\n\t\t\t       ARRAY_SIZE(apl_gpio_devices), NULL, 0, NULL);\n}\n\nstatic bool lpc_ich_byt_set_writeable(void __iomem *base, void *data)\n{\n\tu32 val;\n\n\tval = readl(base + BYT_BCR);\n\tif (!(val & BYT_BCR_WPD)) {\n\t\tval |= BYT_BCR_WPD;\n\t\twritel(val, base + BYT_BCR);\n\t\tval = readl(base + BYT_BCR);\n\t}\n\n\treturn val & BYT_BCR_WPD;\n}\n\nstatic bool lpc_ich_set_writeable(struct pci_bus *bus, unsigned int devfn)\n{\n\tu32 bcr;\n\n\tpci_bus_read_config_dword(bus, devfn, BCR, &bcr);\n\tif (!(bcr & BCR_WPD)) {\n\t\tbcr |= BCR_WPD;\n\t\tpci_bus_write_config_dword(bus, devfn, BCR, bcr);\n\t\tpci_bus_read_config_dword(bus, devfn, BCR, &bcr);\n\t}\n\n\treturn bcr & BCR_WPD;\n}\n\nstatic bool lpc_ich_lpt_set_writeable(void __iomem *base, void *data)\n{\n\tstruct pci_dev *pdev = data;\n\n\treturn lpc_ich_set_writeable(pdev->bus, pdev->devfn);\n}\n\nstatic bool lpc_ich_bxt_set_writeable(void __iomem *base, void *data)\n{\n\tstruct pci_dev *pdev = data;\n\n\treturn lpc_ich_set_writeable(pdev->bus, PCI_DEVFN(13, 2));\n}\n\nstatic int lpc_ich_init_spi(struct pci_dev *dev)\n{\n\tstruct lpc_ich_priv *priv = pci_get_drvdata(dev);\n\tstruct resource *res = &intel_spi_res[0];\n\tstruct intel_spi_boardinfo *info;\n\tu32 spi_base, rcba;\n\tint ret;\n\n\tinfo = devm_kzalloc(&dev->dev, sizeof(*info), GFP_KERNEL);\n\tif (!info)\n\t\treturn -ENOMEM;\n\n\tinfo->type = lpc_chipset_info[priv->chipset].spi_type;\n\n\tswitch (info->type) {\n\tcase INTEL_SPI_BYT:\n\t\tpci_read_config_dword(dev, SPIBASE_BYT, &spi_base);\n\t\tif (spi_base & SPIBASE_BYT_EN) {\n\t\t\tres->start = spi_base & ~(SPIBASE_BYT_SZ - 1);\n\t\t\tres->end = res->start + SPIBASE_BYT_SZ - 1;\n\n\t\t\tinfo->set_writeable = lpc_ich_byt_set_writeable;\n\t\t}\n\t\tbreak;\n\n\tcase INTEL_SPI_LPT:\n\t\tpci_read_config_dword(dev, RCBABASE, &rcba);\n\t\tif (rcba & 1) {\n\t\t\tspi_base = round_down(rcba, SPIBASE_LPT_SZ);\n\t\t\tres->start = spi_base + SPIBASE_LPT;\n\t\t\tres->end = res->start + SPIBASE_LPT_SZ - 1;\n\n\t\t\tinfo->set_writeable = lpc_ich_lpt_set_writeable;\n\t\t\tinfo->data = dev;\n\t\t}\n\t\tbreak;\n\n\tcase INTEL_SPI_BXT:\n\t\t \n\t\tret = p2sb_bar(dev->bus, PCI_DEVFN(13, 2), res);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\tinfo->set_writeable = lpc_ich_bxt_set_writeable;\n\t\tinfo->data = dev;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\tif (!res->start)\n\t\treturn -ENODEV;\n\n\tlpc_ich_spi_cell.platform_data = info;\n\tlpc_ich_spi_cell.pdata_size = sizeof(*info);\n\n\treturn mfd_add_devices(&dev->dev, PLATFORM_DEVID_NONE,\n\t\t\t       &lpc_ich_spi_cell, 1, NULL, 0, NULL);\n}\n\nstatic int lpc_ich_probe(struct pci_dev *dev,\n\t\t\t\tconst struct pci_device_id *id)\n{\n\tstruct lpc_ich_priv *priv;\n\tint ret;\n\tbool cell_added = false;\n\n\tpriv = devm_kzalloc(&dev->dev,\n\t\t\t    sizeof(struct lpc_ich_priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tpriv->chipset = id->driver_data;\n\n\tpriv->actrl_pbase_save = -1;\n\tpriv->abase_save = -1;\n\n\tpriv->abase = ACPIBASE;\n\tpriv->actrl_pbase = ACPICTRL_PMCBASE;\n\n\tpriv->gctrl_save = -1;\n\tif (priv->chipset <= LPC_ICH5) {\n\t\tpriv->gbase = GPIOBASE_ICH0;\n\t\tpriv->gctrl = GPIOCTRL_ICH0;\n\t} else {\n\t\tpriv->gbase = GPIOBASE_ICH6;\n\t\tpriv->gctrl = GPIOCTRL_ICH6;\n\t}\n\n\tpci_set_drvdata(dev, priv);\n\n\tif (lpc_chipset_info[priv->chipset].iTCO_version) {\n\t\tret = lpc_ich_init_wdt(dev);\n\t\tif (!ret)\n\t\t\tcell_added = true;\n\t}\n\n\tif (lpc_chipset_info[priv->chipset].gpio_version) {\n\t\tret = lpc_ich_init_gpio(dev);\n\t\tif (!ret)\n\t\t\tcell_added = true;\n\t}\n\n\tif (priv->chipset == LPC_APL) {\n\t\tret = lpc_ich_init_pinctrl(dev);\n\t\tif (!ret)\n\t\t\tcell_added = true;\n\t}\n\n\tif (lpc_chipset_info[priv->chipset].spi_type) {\n\t\tret = lpc_ich_init_spi(dev);\n\t\tif (!ret)\n\t\t\tcell_added = true;\n\t}\n\n\t \n\tif (!cell_added) {\n\t\tdev_warn(&dev->dev, \"No MFD cells added\\n\");\n\t\tlpc_ich_restore_config_space(dev);\n\t\treturn -ENODEV;\n\t}\n\n\treturn 0;\n}\n\nstatic void lpc_ich_remove(struct pci_dev *dev)\n{\n\tmfd_remove_devices(&dev->dev);\n\tlpc_ich_restore_config_space(dev);\n}\n\nstatic struct pci_driver lpc_ich_driver = {\n\t.name\t\t= \"lpc_ich\",\n\t.id_table\t= lpc_ich_ids,\n\t.probe\t\t= lpc_ich_probe,\n\t.remove\t\t= lpc_ich_remove,\n};\n\nmodule_pci_driver(lpc_ich_driver);\n\nMODULE_AUTHOR(\"Aaron Sierra <asierra@xes-inc.com>\");\nMODULE_DESCRIPTION(\"LPC interface for Intel ICH\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}