{
  "module_name": "tps6507x.c",
  "hash_id": "7769e00c20031b2c414f5496b82d6db357c5e32758e3651d325610cca661e0fb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/tps6507x.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/i2c.h>\n#include <linux/of.h>\n#include <linux/mfd/core.h>\n#include <linux/mfd/tps6507x.h>\n\nstatic const struct mfd_cell tps6507x_devs[] = {\n\t{\n\t\t.name = \"tps6507x-pmic\",\n\t},\n\t{\n\t\t.name = \"tps6507x-ts\",\n\t},\n};\n\n\nstatic int tps6507x_i2c_read_device(struct tps6507x_dev *tps6507x, char reg,\n\t\t\t\t  int bytes, void *dest)\n{\n\tstruct i2c_client *i2c = tps6507x->i2c_client;\n\tstruct i2c_msg xfer[2];\n\tint ret;\n\n\t \n\txfer[0].addr = i2c->addr;\n\txfer[0].flags = 0;\n\txfer[0].len = 1;\n\txfer[0].buf = &reg;\n\n\t \n\txfer[1].addr = i2c->addr;\n\txfer[1].flags = I2C_M_RD;\n\txfer[1].len = bytes;\n\txfer[1].buf = dest;\n\n\tret = i2c_transfer(i2c->adapter, xfer, 2);\n\tif (ret == 2)\n\t\tret = 0;\n\telse if (ret >= 0)\n\t\tret = -EIO;\n\n\treturn ret;\n}\n\nstatic int tps6507x_i2c_write_device(struct tps6507x_dev *tps6507x, char reg,\n\t\t\t\t   int bytes, void *src)\n{\n\tstruct i2c_client *i2c = tps6507x->i2c_client;\n\t \n\tu8 msg[TPS6507X_MAX_REGISTER + 1];\n\tint ret;\n\n\tif (bytes > TPS6507X_MAX_REGISTER)\n\t\treturn -EINVAL;\n\n\tmsg[0] = reg;\n\tmemcpy(&msg[1], src, bytes);\n\n\tret = i2c_master_send(i2c, msg, bytes + 1);\n\tif (ret < 0)\n\t\treturn ret;\n\tif (ret != bytes + 1)\n\t\treturn -EIO;\n\treturn 0;\n}\n\nstatic int tps6507x_i2c_probe(struct i2c_client *i2c)\n{\n\tstruct tps6507x_dev *tps6507x;\n\n\ttps6507x = devm_kzalloc(&i2c->dev, sizeof(struct tps6507x_dev),\n\t\t\t\tGFP_KERNEL);\n\tif (tps6507x == NULL)\n\t\treturn -ENOMEM;\n\n\ti2c_set_clientdata(i2c, tps6507x);\n\ttps6507x->dev = &i2c->dev;\n\ttps6507x->i2c_client = i2c;\n\ttps6507x->read_dev = tps6507x_i2c_read_device;\n\ttps6507x->write_dev = tps6507x_i2c_write_device;\n\n\treturn devm_mfd_add_devices(tps6507x->dev, -1, tps6507x_devs,\n\t\t\t\t    ARRAY_SIZE(tps6507x_devs), NULL, 0, NULL);\n}\n\nstatic const struct i2c_device_id tps6507x_i2c_id[] = {\n\t{ \"tps6507x\", 0 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(i2c, tps6507x_i2c_id);\n\n#ifdef CONFIG_OF\nstatic const struct of_device_id tps6507x_of_match[] = {\n\t{.compatible = \"ti,tps6507x\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, tps6507x_of_match);\n#endif\n\nstatic struct i2c_driver tps6507x_i2c_driver = {\n\t.driver = {\n\t\t   .name = \"tps6507x\",\n\t\t   .of_match_table = of_match_ptr(tps6507x_of_match),\n\t},\n\t.probe = tps6507x_i2c_probe,\n\t.id_table = tps6507x_i2c_id,\n};\n\nstatic int __init tps6507x_i2c_init(void)\n{\n\treturn i2c_add_driver(&tps6507x_i2c_driver);\n}\n \nsubsys_initcall(tps6507x_i2c_init);\n\nstatic void __exit tps6507x_i2c_exit(void)\n{\n\ti2c_del_driver(&tps6507x_i2c_driver);\n}\nmodule_exit(tps6507x_i2c_exit);\n\nMODULE_DESCRIPTION(\"TPS6507x chip family multi-function driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}