{
  "module_name": "si476x-prop.c",
  "hash_id": "4becef02a9fec66cd222a40271a9f60f61a444c42bf46a7eb628095638eada6a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/si476x-prop.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n\n#include <linux/mfd/si476x-core.h>\n\nstruct si476x_property_range {\n\tu16 low, high;\n};\n\nstatic bool si476x_core_element_is_in_array(u16 element,\n\t\t\t\t\t    const u16 array[],\n\t\t\t\t\t    size_t size)\n{\n\tint i;\n\n\tfor (i = 0; i < size; i++)\n\t\tif (element == array[i])\n\t\t\treturn true;\n\n\treturn false;\n}\n\nstatic bool si476x_core_element_is_in_range(u16 element,\n\t\t\t\t\t    const struct si476x_property_range range[],\n\t\t\t\t\t    size_t size)\n{\n\tint i;\n\n\tfor (i = 0; i < size; i++)\n\t\tif (element <= range[i].high && element >= range[i].low)\n\t\t\treturn true;\n\n\treturn false;\n}\n\nstatic bool si476x_core_is_valid_property_a10(struct si476x_core *core,\n\t\t\t\t\t      u16 property)\n{\n\tstatic const u16 valid_properties[] = {\n\t\t0x0000,\n\t\t0x0500, 0x0501,\n\t\t0x0600,\n\t\t0x0709, 0x070C, 0x070D, 0x70E, 0x710,\n\t\t0x0718,\n\t\t0x1207, 0x1208,\n\t\t0x2007,\n\t\t0x2300,\n\t};\n\n\tstatic const struct si476x_property_range valid_ranges[] = {\n\t\t{ 0x0200, 0x0203 },\n\t\t{ 0x0300, 0x0303 },\n\t\t{ 0x0400, 0x0404 },\n\t\t{ 0x0700, 0x0707 },\n\t\t{ 0x1100, 0x1102 },\n\t\t{ 0x1200, 0x1204 },\n\t\t{ 0x1300, 0x1306 },\n\t\t{ 0x2000, 0x2005 },\n\t\t{ 0x2100, 0x2104 },\n\t\t{ 0x2106, 0x2106 },\n\t\t{ 0x2200, 0x220E },\n\t\t{ 0x3100, 0x3104 },\n\t\t{ 0x3207, 0x320F },\n\t\t{ 0x3300, 0x3304 },\n\t\t{ 0x3500, 0x3517 },\n\t\t{ 0x3600, 0x3617 },\n\t\t{ 0x3700, 0x3717 },\n\t\t{ 0x4000, 0x4003 },\n\t};\n\n\treturn\tsi476x_core_element_is_in_range(property, valid_ranges,\n\t\t\t\t\t\tARRAY_SIZE(valid_ranges)) ||\n\t\tsi476x_core_element_is_in_array(property, valid_properties,\n\t\t\t\t\t\tARRAY_SIZE(valid_properties));\n}\n\nstatic bool si476x_core_is_valid_property_a20(struct si476x_core *core,\n\t\t\t\t\t      u16 property)\n{\n\tstatic const u16 valid_properties[] = {\n\t\t0x071B,\n\t\t0x1006,\n\t\t0x2210,\n\t\t0x3401,\n\t};\n\n\tstatic const struct si476x_property_range valid_ranges[] = {\n\t\t{ 0x2215, 0x2219 },\n\t};\n\n\treturn\tsi476x_core_is_valid_property_a10(core, property) ||\n\t\tsi476x_core_element_is_in_range(property, valid_ranges,\n\t\t\t\t\t\tARRAY_SIZE(valid_ranges))  ||\n\t\tsi476x_core_element_is_in_array(property, valid_properties,\n\t\t\t\t\t\tARRAY_SIZE(valid_properties));\n}\n\nstatic bool si476x_core_is_valid_property_a30(struct si476x_core *core,\n\t\t\t\t\t      u16 property)\n{\n\tstatic const u16 valid_properties[] = {\n\t\t0x071C, 0x071D,\n\t\t0x1007, 0x1008,\n\t\t0x220F, 0x2214,\n\t\t0x2301,\n\t\t0x3105, 0x3106,\n\t\t0x3402,\n\t};\n\n\tstatic const struct si476x_property_range valid_ranges[] = {\n\t\t{ 0x0405, 0x0411 },\n\t\t{ 0x2008, 0x200B },\n\t\t{ 0x2220, 0x2223 },\n\t\t{ 0x3100, 0x3106 },\n\t};\n\n\treturn\tsi476x_core_is_valid_property_a20(core, property) ||\n\t\tsi476x_core_element_is_in_range(property, valid_ranges,\n\t\t\t\t\t\tARRAY_SIZE(valid_ranges)) ||\n\t\tsi476x_core_element_is_in_array(property, valid_properties,\n\t\t\t\t\t\tARRAY_SIZE(valid_properties));\n}\n\ntypedef bool (*valid_property_pred_t) (struct si476x_core *, u16);\n\nstatic bool si476x_core_is_valid_property(struct si476x_core *core,\n\t\t\t\t\t  u16 property)\n{\n\tstatic const valid_property_pred_t is_valid_property[] = {\n\t\t[SI476X_REVISION_A10] = si476x_core_is_valid_property_a10,\n\t\t[SI476X_REVISION_A20] = si476x_core_is_valid_property_a20,\n\t\t[SI476X_REVISION_A30] = si476x_core_is_valid_property_a30,\n\t};\n\n\tBUG_ON(core->revision > SI476X_REVISION_A30 ||\n\t       core->revision == -1);\n\treturn is_valid_property[core->revision](core, property);\n}\n\n\nstatic bool si476x_core_is_readonly_property(struct si476x_core *core,\n\t\t\t\t\t     u16 property)\n{\n\tBUG_ON(core->revision > SI476X_REVISION_A30 ||\n\t       core->revision == -1);\n\n\tswitch (core->revision) {\n\tcase SI476X_REVISION_A10:\n\t\treturn (property == 0x3200);\n\tcase SI476X_REVISION_A20:\n\t\treturn (property == 0x1006 ||\n\t\t\tproperty == 0x2210 ||\n\t\t\tproperty == 0x3200);\n\tcase SI476X_REVISION_A30:\n\t\treturn false;\n\t}\n\n\treturn false;\n}\n\nstatic bool si476x_core_regmap_readable_register(struct device *dev,\n\t\t\t\t\t\t unsigned int reg)\n{\n\tstruct i2c_client *client = to_i2c_client(dev);\n\tstruct si476x_core *core = i2c_get_clientdata(client);\n\n\treturn si476x_core_is_valid_property(core, (u16) reg);\n\n}\n\nstatic bool si476x_core_regmap_writable_register(struct device *dev,\n\t\t\t\t\t\t unsigned int reg)\n{\n\tstruct i2c_client *client = to_i2c_client(dev);\n\tstruct si476x_core *core = i2c_get_clientdata(client);\n\n\treturn si476x_core_is_valid_property(core, (u16) reg) &&\n\t\t!si476x_core_is_readonly_property(core, (u16) reg);\n}\n\n\nstatic int si476x_core_regmap_write(void *context, unsigned int reg,\n\t\t\t\t    unsigned int val)\n{\n\treturn si476x_core_cmd_set_property(context, reg, val);\n}\n\nstatic int si476x_core_regmap_read(void *context, unsigned int reg,\n\t\t\t\t   unsigned *val)\n{\n\tstruct si476x_core *core = context;\n\tint err;\n\n\terr = si476x_core_cmd_get_property(core, reg);\n\tif (err < 0)\n\t\treturn err;\n\n\t*val = err;\n\n\treturn 0;\n}\n\n\nstatic const struct regmap_config si476x_regmap_config = {\n\t.reg_bits = 16,\n\t.val_bits = 16,\n\n\t.max_register = 0x4003,\n\n\t.writeable_reg = si476x_core_regmap_writable_register,\n\t.readable_reg = si476x_core_regmap_readable_register,\n\n\t.reg_read = si476x_core_regmap_read,\n\t.reg_write = si476x_core_regmap_write,\n\n\t.cache_type = REGCACHE_RBTREE,\n};\n\nstruct regmap *devm_regmap_init_si476x(struct si476x_core *core)\n{\n\treturn devm_regmap_init(&core->client->dev, NULL,\n\t\t\t\tcore, &si476x_regmap_config);\n}\nEXPORT_SYMBOL_GPL(devm_regmap_init_si476x);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}