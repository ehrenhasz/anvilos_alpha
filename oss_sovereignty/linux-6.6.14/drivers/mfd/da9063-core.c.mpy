{
  "module_name": "da9063-core.c",
  "hash_id": "4baaf39ab4fe9b54eb2a753a5f02515559b55bd0640504689e9b9813b9a3f77a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/da9063-core.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/device.h>\n#include <linux/delay.h>\n#include <linux/interrupt.h>\n#include <linux/mutex.h>\n#include <linux/mfd/core.h>\n#include <linux/regmap.h>\n\n#include <linux/mfd/da9063/core.h>\n#include <linux/mfd/da9063/registers.h>\n\n#include <linux/proc_fs.h>\n#include <linux/kthread.h>\n#include <linux/uaccess.h>\n\n\nstatic const struct resource da9063_regulators_resources[] = {\n\t{\n\t\t.name\t= \"LDO_LIM\",\n\t\t.start\t= DA9063_IRQ_LDO_LIM,\n\t\t.end\t= DA9063_IRQ_LDO_LIM,\n\t\t.flags\t= IORESOURCE_IRQ,\n\t},\n};\n\nstatic const struct resource da9063_rtc_resources[] = {\n\t{\n\t\t.name\t= \"ALARM\",\n\t\t.start\t= DA9063_IRQ_ALARM,\n\t\t.end\t= DA9063_IRQ_ALARM,\n\t\t.flags\t= IORESOURCE_IRQ,\n\t},\n\t{\n\t\t.name\t= \"TICK\",\n\t\t.start\t= DA9063_IRQ_TICK,\n\t\t.end\t= DA9063_IRQ_TICK,\n\t\t.flags\t= IORESOURCE_IRQ,\n\t}\n};\n\nstatic const struct resource da9063_onkey_resources[] = {\n\t{\n\t\t.name\t= \"ONKEY\",\n\t\t.start\t= DA9063_IRQ_ONKEY,\n\t\t.end\t= DA9063_IRQ_ONKEY,\n\t\t.flags\t= IORESOURCE_IRQ,\n\t},\n};\n\nstatic const struct resource da9063_hwmon_resources[] = {\n\t{\n\t\t.start\t= DA9063_IRQ_ADC_RDY,\n\t\t.end\t= DA9063_IRQ_ADC_RDY,\n\t\t.flags\t= IORESOURCE_IRQ,\n\t},\n};\n\n\nstatic const struct mfd_cell da9063_common_devs[] = {\n\t{\n\t\t.name\t\t= DA9063_DRVNAME_REGULATORS,\n\t\t.num_resources\t= ARRAY_SIZE(da9063_regulators_resources),\n\t\t.resources\t= da9063_regulators_resources,\n\t},\n\t{\n\t\t.name\t\t= DA9063_DRVNAME_LEDS,\n\t},\n\t{\n\t\t.name\t\t= DA9063_DRVNAME_WATCHDOG,\n\t\t.of_compatible\t= \"dlg,da9063-watchdog\",\n\t},\n\t{\n\t\t.name\t\t= DA9063_DRVNAME_HWMON,\n\t\t.num_resources\t= ARRAY_SIZE(da9063_hwmon_resources),\n\t\t.resources\t= da9063_hwmon_resources,\n\t},\n\t{\n\t\t.name\t\t= DA9063_DRVNAME_ONKEY,\n\t\t.num_resources\t= ARRAY_SIZE(da9063_onkey_resources),\n\t\t.resources\t= da9063_onkey_resources,\n\t\t.of_compatible = \"dlg,da9063-onkey\",\n\t},\n\t{\n\t\t.name\t\t= DA9063_DRVNAME_VIBRATION,\n\t},\n};\n\n \nstatic const struct mfd_cell da9063_devs[] = {\n\t{\n\t\t.name\t\t= DA9063_DRVNAME_RTC,\n\t\t.num_resources\t= ARRAY_SIZE(da9063_rtc_resources),\n\t\t.resources\t= da9063_rtc_resources,\n\t\t.of_compatible\t= \"dlg,da9063-rtc\",\n\t},\n};\n\nstatic int da9063_clear_fault_log(struct da9063 *da9063)\n{\n\tint ret = 0;\n\tint fault_log = 0;\n\n\tret = regmap_read(da9063->regmap, DA9063_REG_FAULT_LOG, &fault_log);\n\tif (ret < 0) {\n\t\tdev_err(da9063->dev, \"Cannot read FAULT_LOG.\\n\");\n\t\treturn -EIO;\n\t}\n\n\tif (fault_log) {\n\t\tif (fault_log & DA9063_TWD_ERROR)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_TWD_ERROR\\n\");\n\t\tif (fault_log & DA9063_POR)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_POR\\n\");\n\t\tif (fault_log & DA9063_VDD_FAULT)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_VDD_FAULT\\n\");\n\t\tif (fault_log & DA9063_VDD_START)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_VDD_START\\n\");\n\t\tif (fault_log & DA9063_TEMP_CRIT)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_TEMP_CRIT\\n\");\n\t\tif (fault_log & DA9063_KEY_RESET)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_KEY_RESET\\n\");\n\t\tif (fault_log & DA9063_NSHUTDOWN)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_NSHUTDOWN\\n\");\n\t\tif (fault_log & DA9063_WAIT_SHUT)\n\t\t\tdev_dbg(da9063->dev,\n\t\t\t\t\"Fault log entry detected: DA9063_WAIT_SHUT\\n\");\n\t}\n\n\tret = regmap_write(da9063->regmap,\n\t\t\t   DA9063_REG_FAULT_LOG,\n\t\t\t   fault_log);\n\tif (ret < 0)\n\t\tdev_err(da9063->dev,\n\t\t\t\"Cannot reset FAULT_LOG values %d\\n\", ret);\n\n\treturn ret;\n}\n\nint da9063_device_init(struct da9063 *da9063, unsigned int irq)\n{\n\tint ret;\n\n\tret = da9063_clear_fault_log(da9063);\n\tif (ret < 0)\n\t\tdev_err(da9063->dev, \"Cannot clear fault log\\n\");\n\n\tda9063->flags = 0;\n\tda9063->irq_base = -1;\n\tda9063->chip_irq = irq;\n\n\tret = da9063_irq_init(da9063);\n\tif (ret) {\n\t\tdev_err(da9063->dev, \"Cannot initialize interrupts.\\n\");\n\t\treturn ret;\n\t}\n\n\tda9063->irq_base = regmap_irq_chip_get_base(da9063->regmap_irq);\n\n\tret = devm_mfd_add_devices(da9063->dev, PLATFORM_DEVID_NONE,\n\t\t\t\t   da9063_common_devs,\n\t\t\t\t   ARRAY_SIZE(da9063_common_devs),\n\t\t\t\t   NULL, da9063->irq_base, NULL);\n\tif (ret) {\n\t\tdev_err(da9063->dev, \"Failed to add child devices\\n\");\n\t\treturn ret;\n\t}\n\n\tif (da9063->type == PMIC_TYPE_DA9063) {\n\t\tret = devm_mfd_add_devices(da9063->dev, PLATFORM_DEVID_NONE,\n\t\t\t\t\t   da9063_devs, ARRAY_SIZE(da9063_devs),\n\t\t\t\t\t   NULL, da9063->irq_base, NULL);\n\t\tif (ret) {\n\t\t\tdev_err(da9063->dev, \"Failed to add child devices\\n\");\n\t\t\treturn ret;\n\t\t}\n\t}\n\n\treturn ret;\n}\n\nMODULE_DESCRIPTION(\"PMIC driver for Dialog DA9063\");\nMODULE_AUTHOR(\"Krystian Garbaciak\");\nMODULE_AUTHOR(\"Michal Hajduk\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}