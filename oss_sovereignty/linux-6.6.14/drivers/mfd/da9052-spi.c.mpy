{
  "module_name": "da9052-spi.c",
  "hash_id": "3adb3b89b104f8e16a7ea96440a86b863a4d9f3fae677b696b6b9e8e66b44498",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/da9052-spi.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/input.h>\n#include <linux/mfd/core.h>\n#include <linux/spi/spi.h>\n#include <linux/err.h>\n\n#include <linux/mfd/da9052/da9052.h>\n\nstatic int da9052_spi_probe(struct spi_device *spi)\n{\n\tstruct regmap_config config;\n\tint ret;\n\tconst struct spi_device_id *id = spi_get_device_id(spi);\n\tstruct da9052 *da9052;\n\n\tda9052 = devm_kzalloc(&spi->dev, sizeof(struct da9052), GFP_KERNEL);\n\tif (!da9052)\n\t\treturn -ENOMEM;\n\n\tspi->mode = SPI_MODE_0;\n\tspi->bits_per_word = 8;\n\tspi_setup(spi);\n\n\tda9052->dev = &spi->dev;\n\tda9052->chip_irq = spi->irq;\n\n\tspi_set_drvdata(spi, da9052);\n\n\tconfig = da9052_regmap_config;\n\tconfig.read_flag_mask = 1;\n\tconfig.reg_bits = 7;\n\tconfig.pad_bits = 1;\n\tconfig.val_bits = 8;\n\tconfig.use_single_read = true;\n\tconfig.use_single_write = true;\n\n\tda9052->regmap = devm_regmap_init_spi(spi, &config);\n\tif (IS_ERR(da9052->regmap)) {\n\t\tret = PTR_ERR(da9052->regmap);\n\t\tdev_err(&spi->dev, \"Failed to allocate register map: %d\\n\",\n\t\t\tret);\n\t\treturn ret;\n\t}\n\n\treturn da9052_device_init(da9052, id->driver_data);\n}\n\nstatic void da9052_spi_remove(struct spi_device *spi)\n{\n\tstruct da9052 *da9052 = spi_get_drvdata(spi);\n\n\tda9052_device_exit(da9052);\n}\n\nstatic const struct spi_device_id da9052_spi_id[] = {\n\t{\"da9052\", DA9052},\n\t{\"da9053-aa\", DA9053_AA},\n\t{\"da9053-ba\", DA9053_BA},\n\t{\"da9053-bb\", DA9053_BB},\n\t{\"da9053-bc\", DA9053_BC},\n\t{}\n};\n\nstatic struct spi_driver da9052_spi_driver = {\n\t.probe = da9052_spi_probe,\n\t.remove = da9052_spi_remove,\n\t.id_table = da9052_spi_id,\n\t.driver = {\n\t\t.name = \"da9052\",\n\t},\n};\n\nstatic int __init da9052_spi_init(void)\n{\n\tint ret;\n\n\tret = spi_register_driver(&da9052_spi_driver);\n\tif (ret != 0) {\n\t\tpr_err(\"Failed to register DA9052 SPI driver, %d\\n\", ret);\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\nsubsys_initcall(da9052_spi_init);\n\nstatic void __exit da9052_spi_exit(void)\n{\n\tspi_unregister_driver(&da9052_spi_driver);\n}\nmodule_exit(da9052_spi_exit);\n\nMODULE_AUTHOR(\"David Dajun Chen <dchen@diasemi.com>\");\nMODULE_DESCRIPTION(\"SPI driver for Dialog DA9052 PMIC\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}