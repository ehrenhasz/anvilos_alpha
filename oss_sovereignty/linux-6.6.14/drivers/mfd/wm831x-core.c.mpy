{
  "module_name": "wm831x-core.c",
  "hash_id": "c8976a9f2e5979c137ebf63eb7ee08ea85aca4b690a96690054ba2fc37ccacfd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mfd/wm831x-core.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/export.h>\n#include <linux/bcd.h>\n#include <linux/delay.h>\n#include <linux/mfd/core.h>\n#include <linux/slab.h>\n#include <linux/err.h>\n#include <linux/mod_devicetable.h>\n\n#include <linux/mfd/wm831x/core.h>\n#include <linux/mfd/wm831x/pdata.h>\n#include <linux/mfd/wm831x/irq.h>\n#include <linux/mfd/wm831x/auxadc.h>\n#include <linux/mfd/wm831x/otp.h>\n#include <linux/mfd/wm831x/pmu.h>\n#include <linux/mfd/wm831x/regulator.h>\n\n \nconst unsigned int wm831x_isinkv_values[WM831X_ISINK_MAX_ISEL + 1] = {\n\t2,\n\t2,\n\t3,\n\t3,\n\t4,\n\t5,\n\t6,\n\t7,\n\t8,\n\t10,\n\t11,\n\t13,\n\t16,\n\t19,\n\t23,\n\t27,\n\t32,\n\t38,\n\t45,\n\t54,\n\t64,\n\t76,\n\t91,\n\t108,\n\t128,\n\t152,\n\t181,\n\t215,\n\t256,\n\t304,\n\t362,\n\t431,\n\t512,\n\t609,\n\t724,\n\t861,\n\t1024,\n\t1218,\n\t1448,\n\t1722,\n\t2048,\n\t2435,\n\t2896,\n\t3444,\n\t4096,\n\t4871,\n\t5793,\n\t6889,\n\t8192,\n\t9742,\n\t11585,\n\t13777,\n\t16384,\n\t19484,\n\t23170,\n\t27554,\n};\nEXPORT_SYMBOL_GPL(wm831x_isinkv_values);\n\nstatic int wm831x_reg_locked(struct wm831x *wm831x, unsigned short reg)\n{\n\tif (!wm831x->locked)\n\t\treturn 0;\n\n\tswitch (reg) {\n\tcase WM831X_WATCHDOG:\n\tcase WM831X_DC4_CONTROL:\n\tcase WM831X_ON_PIN_CONTROL:\n\tcase WM831X_BACKUP_CHARGER_CONTROL:\n\tcase WM831X_CHARGER_CONTROL_1:\n\tcase WM831X_CHARGER_CONTROL_2:\n\t\treturn 1;\n\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\n \nvoid wm831x_reg_lock(struct wm831x *wm831x)\n{\n\tint ret;\n\n\tret = wm831x_reg_write(wm831x, WM831X_SECURITY_KEY, 0);\n\tif (ret == 0) {\n\t\tdev_vdbg(wm831x->dev, \"Registers locked\\n\");\n\n\t\tmutex_lock(&wm831x->io_lock);\n\t\tWARN_ON(wm831x->locked);\n\t\twm831x->locked = 1;\n\t\tmutex_unlock(&wm831x->io_lock);\n\t} else {\n\t\tdev_err(wm831x->dev, \"Failed to lock registers: %d\\n\", ret);\n\t}\n\n}\nEXPORT_SYMBOL_GPL(wm831x_reg_lock);\n\n \nint wm831x_reg_unlock(struct wm831x *wm831x)\n{\n\tint ret;\n\n\t \n\tret = wm831x_reg_write(wm831x, WM831X_SECURITY_KEY, 0x9716);\n\tif (ret == 0) {\n\t\tdev_vdbg(wm831x->dev, \"Registers unlocked\\n\");\n\n\t\tmutex_lock(&wm831x->io_lock);\n\t\tWARN_ON(!wm831x->locked);\n\t\twm831x->locked = 0;\n\t\tmutex_unlock(&wm831x->io_lock);\n\t}\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(wm831x_reg_unlock);\n\nstatic bool wm831x_reg_readable(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase WM831X_RESET_ID:\n\tcase WM831X_REVISION:\n\tcase WM831X_PARENT_ID:\n\tcase WM831X_SYSVDD_CONTROL:\n\tcase WM831X_THERMAL_MONITORING:\n\tcase WM831X_POWER_STATE:\n\tcase WM831X_WATCHDOG:\n\tcase WM831X_ON_PIN_CONTROL:\n\tcase WM831X_RESET_CONTROL:\n\tcase WM831X_CONTROL_INTERFACE:\n\tcase WM831X_SECURITY_KEY:\n\tcase WM831X_SOFTWARE_SCRATCH:\n\tcase WM831X_OTP_CONTROL:\n\tcase WM831X_GPIO_LEVEL:\n\tcase WM831X_SYSTEM_STATUS:\n\tcase WM831X_ON_SOURCE:\n\tcase WM831X_OFF_SOURCE:\n\tcase WM831X_SYSTEM_INTERRUPTS:\n\tcase WM831X_INTERRUPT_STATUS_1:\n\tcase WM831X_INTERRUPT_STATUS_2:\n\tcase WM831X_INTERRUPT_STATUS_3:\n\tcase WM831X_INTERRUPT_STATUS_4:\n\tcase WM831X_INTERRUPT_STATUS_5:\n\tcase WM831X_IRQ_CONFIG:\n\tcase WM831X_SYSTEM_INTERRUPTS_MASK:\n\tcase WM831X_INTERRUPT_STATUS_1_MASK:\n\tcase WM831X_INTERRUPT_STATUS_2_MASK:\n\tcase WM831X_INTERRUPT_STATUS_3_MASK:\n\tcase WM831X_INTERRUPT_STATUS_4_MASK:\n\tcase WM831X_INTERRUPT_STATUS_5_MASK:\n\tcase WM831X_RTC_WRITE_COUNTER:\n\tcase WM831X_RTC_TIME_1:\n\tcase WM831X_RTC_TIME_2:\n\tcase WM831X_RTC_ALARM_1:\n\tcase WM831X_RTC_ALARM_2:\n\tcase WM831X_RTC_CONTROL:\n\tcase WM831X_RTC_TRIM:\n\tcase WM831X_TOUCH_CONTROL_1:\n\tcase WM831X_TOUCH_CONTROL_2:\n\tcase WM831X_TOUCH_DATA_X:\n\tcase WM831X_TOUCH_DATA_Y:\n\tcase WM831X_TOUCH_DATA_Z:\n\tcase WM831X_AUXADC_DATA:\n\tcase WM831X_AUXADC_CONTROL:\n\tcase WM831X_AUXADC_SOURCE:\n\tcase WM831X_COMPARATOR_CONTROL:\n\tcase WM831X_COMPARATOR_1:\n\tcase WM831X_COMPARATOR_2:\n\tcase WM831X_COMPARATOR_3:\n\tcase WM831X_COMPARATOR_4:\n\tcase WM831X_GPIO1_CONTROL:\n\tcase WM831X_GPIO2_CONTROL:\n\tcase WM831X_GPIO3_CONTROL:\n\tcase WM831X_GPIO4_CONTROL:\n\tcase WM831X_GPIO5_CONTROL:\n\tcase WM831X_GPIO6_CONTROL:\n\tcase WM831X_GPIO7_CONTROL:\n\tcase WM831X_GPIO8_CONTROL:\n\tcase WM831X_GPIO9_CONTROL:\n\tcase WM831X_GPIO10_CONTROL:\n\tcase WM831X_GPIO11_CONTROL:\n\tcase WM831X_GPIO12_CONTROL:\n\tcase WM831X_GPIO13_CONTROL:\n\tcase WM831X_GPIO14_CONTROL:\n\tcase WM831X_GPIO15_CONTROL:\n\tcase WM831X_GPIO16_CONTROL:\n\tcase WM831X_CHARGER_CONTROL_1:\n\tcase WM831X_CHARGER_CONTROL_2:\n\tcase WM831X_CHARGER_STATUS:\n\tcase WM831X_BACKUP_CHARGER_CONTROL:\n\tcase WM831X_STATUS_LED_1:\n\tcase WM831X_STATUS_LED_2:\n\tcase WM831X_CURRENT_SINK_1:\n\tcase WM831X_CURRENT_SINK_2:\n\tcase WM831X_DCDC_ENABLE:\n\tcase WM831X_LDO_ENABLE:\n\tcase WM831X_DCDC_STATUS:\n\tcase WM831X_LDO_STATUS:\n\tcase WM831X_DCDC_UV_STATUS:\n\tcase WM831X_LDO_UV_STATUS:\n\tcase WM831X_DC1_CONTROL_1:\n\tcase WM831X_DC1_CONTROL_2:\n\tcase WM831X_DC1_ON_CONFIG:\n\tcase WM831X_DC1_SLEEP_CONTROL:\n\tcase WM831X_DC1_DVS_CONTROL:\n\tcase WM831X_DC2_CONTROL_1:\n\tcase WM831X_DC2_CONTROL_2:\n\tcase WM831X_DC2_ON_CONFIG:\n\tcase WM831X_DC2_SLEEP_CONTROL:\n\tcase WM831X_DC2_DVS_CONTROL:\n\tcase WM831X_DC3_CONTROL_1:\n\tcase WM831X_DC3_CONTROL_2:\n\tcase WM831X_DC3_ON_CONFIG:\n\tcase WM831X_DC3_SLEEP_CONTROL:\n\tcase WM831X_DC4_CONTROL:\n\tcase WM831X_DC4_SLEEP_CONTROL:\n\tcase WM831X_EPE1_CONTROL:\n\tcase WM831X_EPE2_CONTROL:\n\tcase WM831X_LDO1_CONTROL:\n\tcase WM831X_LDO1_ON_CONTROL:\n\tcase WM831X_LDO1_SLEEP_CONTROL:\n\tcase WM831X_LDO2_CONTROL:\n\tcase WM831X_LDO2_ON_CONTROL:\n\tcase WM831X_LDO2_SLEEP_CONTROL:\n\tcase WM831X_LDO3_CONTROL:\n\tcase WM831X_LDO3_ON_CONTROL:\n\tcase WM831X_LDO3_SLEEP_CONTROL:\n\tcase WM831X_LDO4_CONTROL:\n\tcase WM831X_LDO4_ON_CONTROL:\n\tcase WM831X_LDO4_SLEEP_CONTROL:\n\tcase WM831X_LDO5_CONTROL:\n\tcase WM831X_LDO5_ON_CONTROL:\n\tcase WM831X_LDO5_SLEEP_CONTROL:\n\tcase WM831X_LDO6_CONTROL:\n\tcase WM831X_LDO6_ON_CONTROL:\n\tcase WM831X_LDO6_SLEEP_CONTROL:\n\tcase WM831X_LDO7_CONTROL:\n\tcase WM831X_LDO7_ON_CONTROL:\n\tcase WM831X_LDO7_SLEEP_CONTROL:\n\tcase WM831X_LDO8_CONTROL:\n\tcase WM831X_LDO8_ON_CONTROL:\n\tcase WM831X_LDO8_SLEEP_CONTROL:\n\tcase WM831X_LDO9_CONTROL:\n\tcase WM831X_LDO9_ON_CONTROL:\n\tcase WM831X_LDO9_SLEEP_CONTROL:\n\tcase WM831X_LDO10_CONTROL:\n\tcase WM831X_LDO10_ON_CONTROL:\n\tcase WM831X_LDO10_SLEEP_CONTROL:\n\tcase WM831X_LDO11_ON_CONTROL:\n\tcase WM831X_LDO11_SLEEP_CONTROL:\n\tcase WM831X_POWER_GOOD_SOURCE_1:\n\tcase WM831X_POWER_GOOD_SOURCE_2:\n\tcase WM831X_CLOCK_CONTROL_1:\n\tcase WM831X_CLOCK_CONTROL_2:\n\tcase WM831X_FLL_CONTROL_1:\n\tcase WM831X_FLL_CONTROL_2:\n\tcase WM831X_FLL_CONTROL_3:\n\tcase WM831X_FLL_CONTROL_4:\n\tcase WM831X_FLL_CONTROL_5:\n\tcase WM831X_UNIQUE_ID_1:\n\tcase WM831X_UNIQUE_ID_2:\n\tcase WM831X_UNIQUE_ID_3:\n\tcase WM831X_UNIQUE_ID_4:\n\tcase WM831X_UNIQUE_ID_5:\n\tcase WM831X_UNIQUE_ID_6:\n\tcase WM831X_UNIQUE_ID_7:\n\tcase WM831X_UNIQUE_ID_8:\n\tcase WM831X_FACTORY_OTP_ID:\n\tcase WM831X_FACTORY_OTP_1:\n\tcase WM831X_FACTORY_OTP_2:\n\tcase WM831X_FACTORY_OTP_3:\n\tcase WM831X_FACTORY_OTP_4:\n\tcase WM831X_FACTORY_OTP_5:\n\tcase WM831X_CUSTOMER_OTP_ID:\n\tcase WM831X_DC1_OTP_CONTROL:\n\tcase WM831X_DC2_OTP_CONTROL:\n\tcase WM831X_DC3_OTP_CONTROL:\n\tcase WM831X_LDO1_2_OTP_CONTROL:\n\tcase WM831X_LDO3_4_OTP_CONTROL:\n\tcase WM831X_LDO5_6_OTP_CONTROL:\n\tcase WM831X_LDO7_8_OTP_CONTROL:\n\tcase WM831X_LDO9_10_OTP_CONTROL:\n\tcase WM831X_LDO11_EPE_CONTROL:\n\tcase WM831X_GPIO1_OTP_CONTROL:\n\tcase WM831X_GPIO2_OTP_CONTROL:\n\tcase WM831X_GPIO3_OTP_CONTROL:\n\tcase WM831X_GPIO4_OTP_CONTROL:\n\tcase WM831X_GPIO5_OTP_CONTROL:\n\tcase WM831X_GPIO6_OTP_CONTROL:\n\tcase WM831X_DBE_CHECK_DATA:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool wm831x_reg_writeable(struct device *dev, unsigned int reg)\n{\n\tstruct wm831x *wm831x = dev_get_drvdata(dev);\n\n\tif (wm831x_reg_locked(wm831x, reg))\n\t\treturn false;\n\n\tswitch (reg) {\n\tcase WM831X_SYSVDD_CONTROL:\n\tcase WM831X_THERMAL_MONITORING:\n\tcase WM831X_POWER_STATE:\n\tcase WM831X_WATCHDOG:\n\tcase WM831X_ON_PIN_CONTROL:\n\tcase WM831X_RESET_CONTROL:\n\tcase WM831X_CONTROL_INTERFACE:\n\tcase WM831X_SECURITY_KEY:\n\tcase WM831X_SOFTWARE_SCRATCH:\n\tcase WM831X_OTP_CONTROL:\n\tcase WM831X_GPIO_LEVEL:\n\tcase WM831X_INTERRUPT_STATUS_1:\n\tcase WM831X_INTERRUPT_STATUS_2:\n\tcase WM831X_INTERRUPT_STATUS_3:\n\tcase WM831X_INTERRUPT_STATUS_4:\n\tcase WM831X_INTERRUPT_STATUS_5:\n\tcase WM831X_IRQ_CONFIG:\n\tcase WM831X_SYSTEM_INTERRUPTS_MASK:\n\tcase WM831X_INTERRUPT_STATUS_1_MASK:\n\tcase WM831X_INTERRUPT_STATUS_2_MASK:\n\tcase WM831X_INTERRUPT_STATUS_3_MASK:\n\tcase WM831X_INTERRUPT_STATUS_4_MASK:\n\tcase WM831X_INTERRUPT_STATUS_5_MASK:\n\tcase WM831X_RTC_TIME_1:\n\tcase WM831X_RTC_TIME_2:\n\tcase WM831X_RTC_ALARM_1:\n\tcase WM831X_RTC_ALARM_2:\n\tcase WM831X_RTC_CONTROL:\n\tcase WM831X_RTC_TRIM:\n\tcase WM831X_TOUCH_CONTROL_1:\n\tcase WM831X_TOUCH_CONTROL_2:\n\tcase WM831X_AUXADC_CONTROL:\n\tcase WM831X_AUXADC_SOURCE:\n\tcase WM831X_COMPARATOR_CONTROL:\n\tcase WM831X_COMPARATOR_1:\n\tcase WM831X_COMPARATOR_2:\n\tcase WM831X_COMPARATOR_3:\n\tcase WM831X_COMPARATOR_4:\n\tcase WM831X_GPIO1_CONTROL:\n\tcase WM831X_GPIO2_CONTROL:\n\tcase WM831X_GPIO3_CONTROL:\n\tcase WM831X_GPIO4_CONTROL:\n\tcase WM831X_GPIO5_CONTROL:\n\tcase WM831X_GPIO6_CONTROL:\n\tcase WM831X_GPIO7_CONTROL:\n\tcase WM831X_GPIO8_CONTROL:\n\tcase WM831X_GPIO9_CONTROL:\n\tcase WM831X_GPIO10_CONTROL:\n\tcase WM831X_GPIO11_CONTROL:\n\tcase WM831X_GPIO12_CONTROL:\n\tcase WM831X_GPIO13_CONTROL:\n\tcase WM831X_GPIO14_CONTROL:\n\tcase WM831X_GPIO15_CONTROL:\n\tcase WM831X_GPIO16_CONTROL:\n\tcase WM831X_CHARGER_CONTROL_1:\n\tcase WM831X_CHARGER_CONTROL_2:\n\tcase WM831X_CHARGER_STATUS:\n\tcase WM831X_BACKUP_CHARGER_CONTROL:\n\tcase WM831X_STATUS_LED_1:\n\tcase WM831X_STATUS_LED_2:\n\tcase WM831X_CURRENT_SINK_1:\n\tcase WM831X_CURRENT_SINK_2:\n\tcase WM831X_DCDC_ENABLE:\n\tcase WM831X_LDO_ENABLE:\n\tcase WM831X_DC1_CONTROL_1:\n\tcase WM831X_DC1_CONTROL_2:\n\tcase WM831X_DC1_ON_CONFIG:\n\tcase WM831X_DC1_SLEEP_CONTROL:\n\tcase WM831X_DC1_DVS_CONTROL:\n\tcase WM831X_DC2_CONTROL_1:\n\tcase WM831X_DC2_CONTROL_2:\n\tcase WM831X_DC2_ON_CONFIG:\n\tcase WM831X_DC2_SLEEP_CONTROL:\n\tcase WM831X_DC2_DVS_CONTROL:\n\tcase WM831X_DC3_CONTROL_1:\n\tcase WM831X_DC3_CONTROL_2:\n\tcase WM831X_DC3_ON_CONFIG:\n\tcase WM831X_DC3_SLEEP_CONTROL:\n\tcase WM831X_DC4_CONTROL:\n\tcase WM831X_DC4_SLEEP_CONTROL:\n\tcase WM831X_EPE1_CONTROL:\n\tcase WM831X_EPE2_CONTROL:\n\tcase WM831X_LDO1_CONTROL:\n\tcase WM831X_LDO1_ON_CONTROL:\n\tcase WM831X_LDO1_SLEEP_CONTROL:\n\tcase WM831X_LDO2_CONTROL:\n\tcase WM831X_LDO2_ON_CONTROL:\n\tcase WM831X_LDO2_SLEEP_CONTROL:\n\tcase WM831X_LDO3_CONTROL:\n\tcase WM831X_LDO3_ON_CONTROL:\n\tcase WM831X_LDO3_SLEEP_CONTROL:\n\tcase WM831X_LDO4_CONTROL:\n\tcase WM831X_LDO4_ON_CONTROL:\n\tcase WM831X_LDO4_SLEEP_CONTROL:\n\tcase WM831X_LDO5_CONTROL:\n\tcase WM831X_LDO5_ON_CONTROL:\n\tcase WM831X_LDO5_SLEEP_CONTROL:\n\tcase WM831X_LDO6_CONTROL:\n\tcase WM831X_LDO6_ON_CONTROL:\n\tcase WM831X_LDO6_SLEEP_CONTROL:\n\tcase WM831X_LDO7_CONTROL:\n\tcase WM831X_LDO7_ON_CONTROL:\n\tcase WM831X_LDO7_SLEEP_CONTROL:\n\tcase WM831X_LDO8_CONTROL:\n\tcase WM831X_LDO8_ON_CONTROL:\n\tcase WM831X_LDO8_SLEEP_CONTROL:\n\tcase WM831X_LDO9_CONTROL:\n\tcase WM831X_LDO9_ON_CONTROL:\n\tcase WM831X_LDO9_SLEEP_CONTROL:\n\tcase WM831X_LDO10_CONTROL:\n\tcase WM831X_LDO10_ON_CONTROL:\n\tcase WM831X_LDO10_SLEEP_CONTROL:\n\tcase WM831X_LDO11_ON_CONTROL:\n\tcase WM831X_LDO11_SLEEP_CONTROL:\n\tcase WM831X_POWER_GOOD_SOURCE_1:\n\tcase WM831X_POWER_GOOD_SOURCE_2:\n\tcase WM831X_CLOCK_CONTROL_1:\n\tcase WM831X_CLOCK_CONTROL_2:\n\tcase WM831X_FLL_CONTROL_1:\n\tcase WM831X_FLL_CONTROL_2:\n\tcase WM831X_FLL_CONTROL_3:\n\tcase WM831X_FLL_CONTROL_4:\n\tcase WM831X_FLL_CONTROL_5:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic bool wm831x_reg_volatile(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase WM831X_SYSTEM_STATUS:\n\tcase WM831X_ON_SOURCE:\n\tcase WM831X_OFF_SOURCE:\n\tcase WM831X_GPIO_LEVEL:\n\tcase WM831X_SYSTEM_INTERRUPTS:\n\tcase WM831X_INTERRUPT_STATUS_1:\n\tcase WM831X_INTERRUPT_STATUS_2:\n\tcase WM831X_INTERRUPT_STATUS_3:\n\tcase WM831X_INTERRUPT_STATUS_4:\n\tcase WM831X_INTERRUPT_STATUS_5:\n\tcase WM831X_RTC_TIME_1:\n\tcase WM831X_RTC_TIME_2:\n\tcase WM831X_TOUCH_DATA_X:\n\tcase WM831X_TOUCH_DATA_Y:\n\tcase WM831X_TOUCH_DATA_Z:\n\tcase WM831X_AUXADC_DATA:\n\tcase WM831X_CHARGER_STATUS:\n\tcase WM831X_DCDC_STATUS:\n\tcase WM831X_LDO_STATUS:\n\tcase WM831X_DCDC_UV_STATUS:\n\tcase WM831X_LDO_UV_STATUS:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\n \nint wm831x_reg_read(struct wm831x *wm831x, unsigned short reg)\n{\n\tunsigned int val;\n\tint ret;\n\n\tret = regmap_read(wm831x->regmap, reg, &val);\n\n\tif (ret < 0)\n\t\treturn ret;\n\telse\n\t\treturn val;\n}\nEXPORT_SYMBOL_GPL(wm831x_reg_read);\n\n \nint wm831x_bulk_read(struct wm831x *wm831x, unsigned short reg,\n\t\t     int count, u16 *buf)\n{\n\treturn regmap_bulk_read(wm831x->regmap, reg, buf, count);\n}\nEXPORT_SYMBOL_GPL(wm831x_bulk_read);\n\nstatic int wm831x_write(struct wm831x *wm831x, unsigned short reg,\n\t\t\tint bytes, void *src)\n{\n\tu16 *buf = src;\n\tint i, ret;\n\n\tBUG_ON(bytes % 2);\n\tBUG_ON(bytes <= 0);\n\n\tfor (i = 0; i < bytes / 2; i++) {\n\t\tif (wm831x_reg_locked(wm831x, reg))\n\t\t\treturn -EPERM;\n\n\t\tdev_vdbg(wm831x->dev, \"Write %04x to R%d(0x%x)\\n\",\n\t\t\t buf[i], reg + i, reg + i);\n\t\tret = regmap_write(wm831x->regmap, reg + i, buf[i]);\n\t\tif (ret != 0)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\n \nint wm831x_reg_write(struct wm831x *wm831x, unsigned short reg,\n\t\t     unsigned short val)\n{\n\tint ret;\n\n\tmutex_lock(&wm831x->io_lock);\n\n\tret = wm831x_write(wm831x, reg, 2, &val);\n\n\tmutex_unlock(&wm831x->io_lock);\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(wm831x_reg_write);\n\n \nint wm831x_set_bits(struct wm831x *wm831x, unsigned short reg,\n\t\t    unsigned short mask, unsigned short val)\n{\n\tint ret;\n\n\tmutex_lock(&wm831x->io_lock);\n\n\tif (!wm831x_reg_locked(wm831x, reg))\n\t\tret = regmap_update_bits(wm831x->regmap, reg, mask, val);\n\telse\n\t\tret = -EPERM;\n\n\tmutex_unlock(&wm831x->io_lock);\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(wm831x_set_bits);\n\nstatic const struct resource wm831x_dcdc1_resources[] = {\n\t{\n\t\t.start = WM831X_DC1_CONTROL_1,\n\t\t.end   = WM831X_DC1_DVS_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_DC1, \"UV\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_HC_DC1, \"HC\"),\n};\n\n\nstatic const struct resource wm831x_dcdc2_resources[] = {\n\t{\n\t\t.start = WM831X_DC2_CONTROL_1,\n\t\t.end   = WM831X_DC2_DVS_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_DC2, \"UV\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_HC_DC2, \"HC\"),\n};\n\nstatic const struct resource wm831x_dcdc3_resources[] = {\n\t{\n\t\t.start = WM831X_DC3_CONTROL_1,\n\t\t.end   = WM831X_DC3_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_DC3, \"UV\"),\n};\n\nstatic const struct resource wm831x_dcdc4_resources[] = {\n\t{\n\t\t.start = WM831X_DC4_CONTROL,\n\t\t.end   = WM831X_DC4_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_DC4, \"UV\"),\n};\n\nstatic const struct resource wm8320_dcdc4_buck_resources[] = {\n\t{\n\t\t.start = WM831X_DC4_CONTROL,\n\t\t.end   = WM832X_DC4_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_DC4, \"UV\"),\n};\n\nstatic const struct resource wm831x_gpio_resources[] = {\n\t{\n\t\t.start = WM831X_IRQ_GPIO_1,\n\t\t.end   = WM831X_IRQ_GPIO_16,\n\t\t.flags = IORESOURCE_IRQ,\n\t},\n};\n\nstatic const struct resource wm831x_isink1_resources[] = {\n\t{\n\t\t.start = WM831X_CURRENT_SINK_1,\n\t\t.end   = WM831X_CURRENT_SINK_1,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ(WM831X_IRQ_CS1),\n};\n\nstatic const struct resource wm831x_isink2_resources[] = {\n\t{\n\t\t.start = WM831X_CURRENT_SINK_2,\n\t\t.end   = WM831X_CURRENT_SINK_2,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ(WM831X_IRQ_CS2),\n};\n\nstatic const struct resource wm831x_ldo1_resources[] = {\n\t{\n\t\t.start = WM831X_LDO1_CONTROL,\n\t\t.end   = WM831X_LDO1_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO1, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo2_resources[] = {\n\t{\n\t\t.start = WM831X_LDO2_CONTROL,\n\t\t.end   = WM831X_LDO2_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO2, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo3_resources[] = {\n\t{\n\t\t.start = WM831X_LDO3_CONTROL,\n\t\t.end   = WM831X_LDO3_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO3, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo4_resources[] = {\n\t{\n\t\t.start = WM831X_LDO4_CONTROL,\n\t\t.end   = WM831X_LDO4_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO4, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo5_resources[] = {\n\t{\n\t\t.start = WM831X_LDO5_CONTROL,\n\t\t.end   = WM831X_LDO5_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO5, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo6_resources[] = {\n\t{\n\t\t.start = WM831X_LDO6_CONTROL,\n\t\t.end   = WM831X_LDO6_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO6, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo7_resources[] = {\n\t{\n\t\t.start = WM831X_LDO7_CONTROL,\n\t\t.end   = WM831X_LDO7_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO7, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo8_resources[] = {\n\t{\n\t\t.start = WM831X_LDO8_CONTROL,\n\t\t.end   = WM831X_LDO8_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO8, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo9_resources[] = {\n\t{\n\t\t.start = WM831X_LDO9_CONTROL,\n\t\t.end   = WM831X_LDO9_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO9, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo10_resources[] = {\n\t{\n\t\t.start = WM831X_LDO10_CONTROL,\n\t\t.end   = WM831X_LDO10_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_UV_LDO10, \"UV\"),\n};\n\nstatic const struct resource wm831x_ldo11_resources[] = {\n\t{\n\t\t.start = WM831X_LDO11_ON_CONTROL,\n\t\t.end   = WM831X_LDO11_SLEEP_CONTROL,\n\t\t.flags = IORESOURCE_REG,\n\t},\n};\n\nstatic const struct resource wm831x_on_resources[] = {\n\tDEFINE_RES_IRQ(WM831X_IRQ_ON),\n};\n\n\nstatic const struct resource wm831x_power_resources[] = {\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_PPM_SYSLO, \"SYSLO\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_PPM_PWR_SRC, \"PWR SRC\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_PPM_USB_CURR, \"USB CURR\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_BATT_HOT, \"BATT HOT\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_BATT_COLD, \"BATT COLD\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_BATT_FAIL, \"BATT FAIL\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_OV, \"OV\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_END, \"END\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_TO, \"TO\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_MODE, \"MODE\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_CHG_START, \"START\"),\n};\n\nstatic const struct resource wm831x_rtc_resources[] = {\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_RTC_PER, \"PER\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_RTC_ALM, \"ALM\"),\n};\n\nstatic const struct resource wm831x_status1_resources[] = {\n\t{\n\t\t.start = WM831X_STATUS_LED_1,\n\t\t.end   = WM831X_STATUS_LED_1,\n\t\t.flags = IORESOURCE_REG,\n\t},\n};\n\nstatic const struct resource wm831x_status2_resources[] = {\n\t{\n\t\t.start = WM831X_STATUS_LED_2,\n\t\t.end   = WM831X_STATUS_LED_2,\n\t\t.flags = IORESOURCE_REG,\n\t},\n};\n\nstatic const struct resource wm831x_touch_resources[] = {\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_TCHPD, \"TCHPD\"),\n\tDEFINE_RES_IRQ_NAMED(WM831X_IRQ_TCHDATA, \"TCHDATA\"),\n};\n\nstatic const struct resource wm831x_wdt_resources[] = {\n\tDEFINE_RES_IRQ(WM831X_IRQ_WDOG_TO),\n};\n\nstatic const struct mfd_cell wm8310_devs[] = {\n\t{\n\t\t.name = \"wm831x-backup\",\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc1_resources),\n\t\t.resources = wm831x_dcdc1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc2_resources),\n\t\t.resources = wm831x_dcdc2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckp\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc3_resources),\n\t\t.resources = wm831x_dcdc3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-boostp\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc4_resources),\n\t\t.resources = wm831x_dcdc4_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-clk\",\n\t},\n\t{\n\t\t.name = \"wm831x-epe\",\n\t\t.id = 1,\n\t},\n\t{\n\t\t.name = \"wm831x-epe\",\n\t\t.id = 2,\n\t},\n\t{\n\t\t.name = \"wm831x-gpio\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_gpio_resources),\n\t\t.resources = wm831x_gpio_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-hwmon\",\n\t},\n\t{\n\t\t.name = \"wm831x-isink\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_isink1_resources),\n\t\t.resources = wm831x_isink1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-isink\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_isink2_resources),\n\t\t.resources = wm831x_isink2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo1_resources),\n\t\t.resources = wm831x_ldo1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo2_resources),\n\t\t.resources = wm831x_ldo2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo3_resources),\n\t\t.resources = wm831x_ldo3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo4_resources),\n\t\t.resources = wm831x_ldo4_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 5,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo5_resources),\n\t\t.resources = wm831x_ldo5_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 6,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo6_resources),\n\t\t.resources = wm831x_ldo6_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 7,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo7_resources),\n\t\t.resources = wm831x_ldo7_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 8,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo8_resources),\n\t\t.resources = wm831x_ldo8_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 9,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo9_resources),\n\t\t.resources = wm831x_ldo9_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 10,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo10_resources),\n\t\t.resources = wm831x_ldo10_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-alive-ldo\",\n\t\t.id = 11,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo11_resources),\n\t\t.resources = wm831x_ldo11_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-on\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_on_resources),\n\t\t.resources = wm831x_on_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-power\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_power_resources),\n\t\t.resources = wm831x_power_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status1_resources),\n\t\t.resources = wm831x_status1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status2_resources),\n\t\t.resources = wm831x_status2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-watchdog\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_wdt_resources),\n\t\t.resources = wm831x_wdt_resources,\n\t},\n};\n\nstatic const struct mfd_cell wm8311_devs[] = {\n\t{\n\t\t.name = \"wm831x-backup\",\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc1_resources),\n\t\t.resources = wm831x_dcdc1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc2_resources),\n\t\t.resources = wm831x_dcdc2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckp\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc3_resources),\n\t\t.resources = wm831x_dcdc3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-boostp\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc4_resources),\n\t\t.resources = wm831x_dcdc4_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-clk\",\n\t},\n\t{\n\t\t.name = \"wm831x-epe\",\n\t\t.id = 1,\n\t},\n\t{\n\t\t.name = \"wm831x-epe\",\n\t\t.id = 2,\n\t},\n\t{\n\t\t.name = \"wm831x-gpio\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_gpio_resources),\n\t\t.resources = wm831x_gpio_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-hwmon\",\n\t},\n\t{\n\t\t.name = \"wm831x-isink\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_isink1_resources),\n\t\t.resources = wm831x_isink1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-isink\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_isink2_resources),\n\t\t.resources = wm831x_isink2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo1_resources),\n\t\t.resources = wm831x_ldo1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo2_resources),\n\t\t.resources = wm831x_ldo2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo3_resources),\n\t\t.resources = wm831x_ldo3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo4_resources),\n\t\t.resources = wm831x_ldo4_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 5,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo5_resources),\n\t\t.resources = wm831x_ldo5_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 7,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo7_resources),\n\t\t.resources = wm831x_ldo7_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-alive-ldo\",\n\t\t.id = 11,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo11_resources),\n\t\t.resources = wm831x_ldo11_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-on\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_on_resources),\n\t\t.resources = wm831x_on_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-power\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_power_resources),\n\t\t.resources = wm831x_power_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status1_resources),\n\t\t.resources = wm831x_status1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status2_resources),\n\t\t.resources = wm831x_status2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-watchdog\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_wdt_resources),\n\t\t.resources = wm831x_wdt_resources,\n\t},\n};\n\nstatic const struct mfd_cell wm8312_devs[] = {\n\t{\n\t\t.name = \"wm831x-backup\",\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc1_resources),\n\t\t.resources = wm831x_dcdc1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc2_resources),\n\t\t.resources = wm831x_dcdc2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckp\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc3_resources),\n\t\t.resources = wm831x_dcdc3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-boostp\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc4_resources),\n\t\t.resources = wm831x_dcdc4_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-clk\",\n\t},\n\t{\n\t\t.name = \"wm831x-epe\",\n\t\t.id = 1,\n\t},\n\t{\n\t\t.name = \"wm831x-epe\",\n\t\t.id = 2,\n\t},\n\t{\n\t\t.name = \"wm831x-gpio\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_gpio_resources),\n\t\t.resources = wm831x_gpio_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-hwmon\",\n\t},\n\t{\n\t\t.name = \"wm831x-isink\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_isink1_resources),\n\t\t.resources = wm831x_isink1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-isink\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_isink2_resources),\n\t\t.resources = wm831x_isink2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo1_resources),\n\t\t.resources = wm831x_ldo1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo2_resources),\n\t\t.resources = wm831x_ldo2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo3_resources),\n\t\t.resources = wm831x_ldo3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo4_resources),\n\t\t.resources = wm831x_ldo4_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 5,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo5_resources),\n\t\t.resources = wm831x_ldo5_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 6,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo6_resources),\n\t\t.resources = wm831x_ldo6_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 7,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo7_resources),\n\t\t.resources = wm831x_ldo7_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 8,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo8_resources),\n\t\t.resources = wm831x_ldo8_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 9,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo9_resources),\n\t\t.resources = wm831x_ldo9_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 10,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo10_resources),\n\t\t.resources = wm831x_ldo10_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-alive-ldo\",\n\t\t.id = 11,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo11_resources),\n\t\t.resources = wm831x_ldo11_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-on\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_on_resources),\n\t\t.resources = wm831x_on_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-power\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_power_resources),\n\t\t.resources = wm831x_power_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status1_resources),\n\t\t.resources = wm831x_status1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status2_resources),\n\t\t.resources = wm831x_status2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-watchdog\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_wdt_resources),\n\t\t.resources = wm831x_wdt_resources,\n\t},\n};\n\nstatic const struct mfd_cell wm8320_devs[] = {\n\t{\n\t\t.name = \"wm831x-backup\",\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc1_resources),\n\t\t.resources = wm831x_dcdc1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckv\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc2_resources),\n\t\t.resources = wm831x_dcdc2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckp\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_dcdc3_resources),\n\t\t.resources = wm831x_dcdc3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-buckp\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm8320_dcdc4_buck_resources),\n\t\t.resources = wm8320_dcdc4_buck_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-clk\",\n\t},\n\t{\n\t\t.name = \"wm831x-gpio\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_gpio_resources),\n\t\t.resources = wm831x_gpio_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-hwmon\",\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo1_resources),\n\t\t.resources = wm831x_ldo1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo2_resources),\n\t\t.resources = wm831x_ldo2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 3,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo3_resources),\n\t\t.resources = wm831x_ldo3_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 4,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo4_resources),\n\t\t.resources = wm831x_ldo4_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 5,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo5_resources),\n\t\t.resources = wm831x_ldo5_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-ldo\",\n\t\t.id = 6,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo6_resources),\n\t\t.resources = wm831x_ldo6_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 7,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo7_resources),\n\t\t.resources = wm831x_ldo7_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 8,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo8_resources),\n\t\t.resources = wm831x_ldo8_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 9,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo9_resources),\n\t\t.resources = wm831x_ldo9_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-aldo\",\n\t\t.id = 10,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo10_resources),\n\t\t.resources = wm831x_ldo10_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-alive-ldo\",\n\t\t.id = 11,\n\t\t.num_resources = ARRAY_SIZE(wm831x_ldo11_resources),\n\t\t.resources = wm831x_ldo11_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-on\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_on_resources),\n\t\t.resources = wm831x_on_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 1,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status1_resources),\n\t\t.resources = wm831x_status1_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-status\",\n\t\t.id = 2,\n\t\t.num_resources = ARRAY_SIZE(wm831x_status2_resources),\n\t\t.resources = wm831x_status2_resources,\n\t},\n\t{\n\t\t.name = \"wm831x-watchdog\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_wdt_resources),\n\t\t.resources = wm831x_wdt_resources,\n\t},\n};\n\nstatic const struct mfd_cell touch_devs[] = {\n\t{\n\t\t.name = \"wm831x-touch\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_touch_resources),\n\t\t.resources = wm831x_touch_resources,\n\t},\n};\n\nstatic const struct mfd_cell rtc_devs[] = {\n\t{\n\t\t.name = \"wm831x-rtc\",\n\t\t.num_resources = ARRAY_SIZE(wm831x_rtc_resources),\n\t\t.resources = wm831x_rtc_resources,\n\t},\n};\n\nstatic const struct mfd_cell backlight_devs[] = {\n\t{\n\t\t.name = \"wm831x-backlight\",\n\t},\n};\n\nstruct regmap_config wm831x_regmap_config = {\n\t.reg_bits = 16,\n\t.val_bits = 16,\n\n\t.cache_type = REGCACHE_MAPLE,\n\n\t.max_register = WM831X_DBE_CHECK_DATA,\n\t.readable_reg = wm831x_reg_readable,\n\t.writeable_reg = wm831x_reg_writeable,\n\t.volatile_reg = wm831x_reg_volatile,\n};\nEXPORT_SYMBOL_GPL(wm831x_regmap_config);\n\nconst struct of_device_id wm831x_of_match[] = {\n\t{ .compatible = \"wlf,wm8310\", .data = (void *)WM8310 },\n\t{ .compatible = \"wlf,wm8311\", .data = (void *)WM8311 },\n\t{ .compatible = \"wlf,wm8312\", .data = (void *)WM8312 },\n\t{ .compatible = \"wlf,wm8320\", .data = (void *)WM8320 },\n\t{ .compatible = \"wlf,wm8321\", .data = (void *)WM8321 },\n\t{ .compatible = \"wlf,wm8325\", .data = (void *)WM8325 },\n\t{ .compatible = \"wlf,wm8326\", .data = (void *)WM8326 },\n\t{ },\n};\nEXPORT_SYMBOL_GPL(wm831x_of_match);\n\n \nint wm831x_device_init(struct wm831x *wm831x, int irq)\n{\n\tstruct wm831x_pdata *pdata = &wm831x->pdata;\n\tint rev, wm831x_num;\n\tenum wm831x_parent parent;\n\tint ret, i;\n\n\tmutex_init(&wm831x->io_lock);\n\tmutex_init(&wm831x->key_lock);\n\tdev_set_drvdata(wm831x->dev, wm831x);\n\n\twm831x->soft_shutdown = pdata->soft_shutdown;\n\n\tret = wm831x_reg_read(wm831x, WM831X_PARENT_ID);\n\tif (ret < 0) {\n\t\tdev_err(wm831x->dev, \"Failed to read parent ID: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\tswitch (ret) {\n\tcase 0x6204:\n\tcase 0x6246:\n\t\tbreak;\n\tdefault:\n\t\tdev_err(wm831x->dev, \"Device is not a WM831x: ID %x\\n\", ret);\n\t\tret = -EINVAL;\n\t\tgoto err;\n\t}\n\n\tret = wm831x_reg_read(wm831x, WM831X_REVISION);\n\tif (ret < 0) {\n\t\tdev_err(wm831x->dev, \"Failed to read revision: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\trev = (ret & WM831X_PARENT_REV_MASK) >> WM831X_PARENT_REV_SHIFT;\n\n\tret = wm831x_reg_read(wm831x, WM831X_RESET_ID);\n\tif (ret < 0) {\n\t\tdev_err(wm831x->dev, \"Failed to read device ID: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\n\t \n\tif (ret == 0) {\n\t\tdev_info(wm831x->dev, \"Device is an engineering sample\\n\");\n\t\tret = wm831x->type;\n\t}\n\n\tswitch (ret) {\n\tcase WM8310:\n\t\tparent = WM8310;\n\t\twm831x->num_gpio = 16;\n\t\twm831x->charger_irq_wake = 1;\n\t\tif (rev > 0) {\n\t\t\twm831x->has_gpio_ena = 1;\n\t\t\twm831x->has_cs_sts = 1;\n\t\t}\n\n\t\tdev_info(wm831x->dev, \"WM8310 revision %c\\n\", 'A' + rev);\n\t\tbreak;\n\n\tcase WM8311:\n\t\tparent = WM8311;\n\t\twm831x->num_gpio = 16;\n\t\twm831x->charger_irq_wake = 1;\n\t\tif (rev > 0) {\n\t\t\twm831x->has_gpio_ena = 1;\n\t\t\twm831x->has_cs_sts = 1;\n\t\t}\n\n\t\tdev_info(wm831x->dev, \"WM8311 revision %c\\n\", 'A' + rev);\n\t\tbreak;\n\n\tcase WM8312:\n\t\tparent = WM8312;\n\t\twm831x->num_gpio = 16;\n\t\twm831x->charger_irq_wake = 1;\n\t\tif (rev > 0) {\n\t\t\twm831x->has_gpio_ena = 1;\n\t\t\twm831x->has_cs_sts = 1;\n\t\t}\n\n\t\tdev_info(wm831x->dev, \"WM8312 revision %c\\n\", 'A' + rev);\n\t\tbreak;\n\n\tcase WM8320:\n\t\tparent = WM8320;\n\t\twm831x->num_gpio = 12;\n\t\tdev_info(wm831x->dev, \"WM8320 revision %c\\n\", 'A' + rev);\n\t\tbreak;\n\n\tcase WM8321:\n\t\tparent = WM8321;\n\t\twm831x->num_gpio = 12;\n\t\tdev_info(wm831x->dev, \"WM8321 revision %c\\n\", 'A' + rev);\n\t\tbreak;\n\n\tcase WM8325:\n\t\tparent = WM8325;\n\t\twm831x->num_gpio = 12;\n\t\tdev_info(wm831x->dev, \"WM8325 revision %c\\n\", 'A' + rev);\n\t\tbreak;\n\n\tcase WM8326:\n\t\tparent = WM8326;\n\t\twm831x->num_gpio = 12;\n\t\tdev_info(wm831x->dev, \"WM8326 revision %c\\n\", 'A' + rev);\n\t\tbreak;\n\n\tdefault:\n\t\tdev_err(wm831x->dev, \"Unknown WM831x device %04x\\n\", ret);\n\t\tret = -EINVAL;\n\t\tgoto err;\n\t}\n\n\t \n\tif (parent != wm831x->type)\n\t\tdev_warn(wm831x->dev, \"Device was registered as a WM%x\\n\",\n\t\t\t wm831x->type);\n\n\t \n\tret = wm831x_reg_read(wm831x, WM831X_SECURITY_KEY);\n\tif (ret < 0) {\n\t\tdev_err(wm831x->dev, \"Failed to read security key: %d\\n\", ret);\n\t\tgoto err;\n\t}\n\tif (ret != 0) {\n\t\tdev_warn(wm831x->dev, \"Security key had non-zero value %x\\n\",\n\t\t\t ret);\n\t\twm831x_reg_write(wm831x, WM831X_SECURITY_KEY, 0);\n\t}\n\twm831x->locked = 1;\n\n\tif (pdata->pre_init) {\n\t\tret = pdata->pre_init(wm831x);\n\t\tif (ret != 0) {\n\t\t\tdev_err(wm831x->dev, \"pre_init() failed: %d\\n\", ret);\n\t\t\tgoto err;\n\t\t}\n\t}\n\n\tfor (i = 0; i < ARRAY_SIZE(pdata->gpio_defaults); i++) {\n\t\tif (!pdata->gpio_defaults[i])\n\t\t\tcontinue;\n\n\t\twm831x_reg_write(wm831x,\n\t\t\t\t WM831X_GPIO1_CONTROL + i,\n\t\t\t\t pdata->gpio_defaults[i] & 0xffff);\n\t}\n\n\t \n\tif (pdata->wm831x_num)\n\t\twm831x_num = pdata->wm831x_num * 10;\n\telse\n\t\twm831x_num = -1;\n\n\tret = wm831x_irq_init(wm831x, irq);\n\tif (ret != 0)\n\t\tgoto err;\n\n\twm831x_auxadc_init(wm831x);\n\n\t \n\tswitch (parent) {\n\tcase WM8310:\n\t\tret = mfd_add_devices(wm831x->dev, wm831x_num,\n\t\t\t\t      wm8310_devs, ARRAY_SIZE(wm8310_devs),\n\t\t\t\t      NULL, 0, NULL);\n\t\tbreak;\n\n\tcase WM8311:\n\t\tret = mfd_add_devices(wm831x->dev, wm831x_num,\n\t\t\t\t      wm8311_devs, ARRAY_SIZE(wm8311_devs),\n\t\t\t\t      NULL, 0, NULL);\n\t\tif (!pdata->disable_touch)\n\t\t\tmfd_add_devices(wm831x->dev, wm831x_num,\n\t\t\t\t\ttouch_devs, ARRAY_SIZE(touch_devs),\n\t\t\t\t\tNULL, 0, NULL);\n\t\tbreak;\n\n\tcase WM8312:\n\t\tret = mfd_add_devices(wm831x->dev, wm831x_num,\n\t\t\t\t      wm8312_devs, ARRAY_SIZE(wm8312_devs),\n\t\t\t\t      NULL, 0, NULL);\n\t\tif (!pdata->disable_touch)\n\t\t\tmfd_add_devices(wm831x->dev, wm831x_num,\n\t\t\t\t\ttouch_devs, ARRAY_SIZE(touch_devs),\n\t\t\t\t\tNULL, 0, NULL);\n\t\tbreak;\n\n\tcase WM8320:\n\tcase WM8321:\n\tcase WM8325:\n\tcase WM8326:\n\t\tret = mfd_add_devices(wm831x->dev, wm831x_num,\n\t\t\t\t      wm8320_devs, ARRAY_SIZE(wm8320_devs),\n\t\t\t\t      NULL, 0, NULL);\n\t\tbreak;\n\n\tdefault:\n\t\t \n\t\tBUG();\n\t}\n\n\tif (ret != 0) {\n\t\tdev_err(wm831x->dev, \"Failed to add children\\n\");\n\t\tgoto err_irq;\n\t}\n\n\t \n\tret = wm831x_reg_read(wm831x, WM831X_CLOCK_CONTROL_2);\n\tif (ret < 0) {\n\t\tdev_err(wm831x->dev, \"Failed to read clock status: %d\\n\", ret);\n\t\tgoto err_irq;\n\t}\n\n\tif (ret & WM831X_XTAL_ENA) {\n\t\tret = mfd_add_devices(wm831x->dev, wm831x_num,\n\t\t\t\t      rtc_devs, ARRAY_SIZE(rtc_devs),\n\t\t\t\t      NULL, 0, NULL);\n\t\tif (ret != 0) {\n\t\t\tdev_err(wm831x->dev, \"Failed to add RTC: %d\\n\", ret);\n\t\t\tgoto err_irq;\n\t\t}\n\t} else {\n\t\tdev_info(wm831x->dev, \"32.768kHz clock disabled, no RTC\\n\");\n\t}\n\n\tif (pdata->backlight) {\n\t\t \n\t\tret = mfd_add_devices(wm831x->dev, wm831x_num, backlight_devs,\n\t\t\t\t      ARRAY_SIZE(backlight_devs), NULL,\n\t\t\t\t      0, NULL);\n\t\tif (ret < 0)\n\t\t\tdev_err(wm831x->dev, \"Failed to add backlight: %d\\n\",\n\t\t\t\tret);\n\t}\n\n\twm831x_otp_init(wm831x);\n\n\tif (pdata->post_init) {\n\t\tret = pdata->post_init(wm831x);\n\t\tif (ret != 0) {\n\t\t\tdev_err(wm831x->dev, \"post_init() failed: %d\\n\", ret);\n\t\t\tgoto err_irq;\n\t\t}\n\t}\n\n\treturn 0;\n\nerr_irq:\n\twm831x_irq_exit(wm831x);\nerr:\n\tmfd_remove_devices(wm831x->dev);\n\treturn ret;\n}\n\nint wm831x_device_suspend(struct wm831x *wm831x)\n{\n\tint reg, mask;\n\n\t \n\tif (wm831x->charger_irq_wake) {\n\t\treg = wm831x_reg_read(wm831x, WM831X_INTERRUPT_STATUS_2_MASK);\n\n\t\tmask = WM831X_CHG_BATT_HOT_EINT |\n\t\t\tWM831X_CHG_BATT_COLD_EINT |\n\t\t\tWM831X_CHG_BATT_FAIL_EINT |\n\t\t\tWM831X_CHG_OV_EINT | WM831X_CHG_END_EINT |\n\t\t\tWM831X_CHG_TO_EINT | WM831X_CHG_MODE_EINT |\n\t\t\tWM831X_CHG_START_EINT;\n\n\t\t \n\t\tif (reg & mask)\n\t\t\treg = wm831x_reg_read(wm831x,\n\t\t\t\t\t      WM831X_INTERRUPT_STATUS_2);\n\n\t\tif (reg & mask) {\n\t\t\tdev_info(wm831x->dev,\n\t\t\t\t \"Acknowledging masked charger IRQs: %x\\n\",\n\t\t\t\t reg & mask);\n\t\t\twm831x_reg_write(wm831x, WM831X_INTERRUPT_STATUS_2,\n\t\t\t\t\t reg & mask);\n\t\t}\n\t}\n\n\treturn 0;\n}\n\nvoid wm831x_device_shutdown(struct wm831x *wm831x)\n{\n\tif (wm831x->soft_shutdown) {\n\t\tdev_info(wm831x->dev, \"Initiating shutdown...\\n\");\n\t\twm831x_set_bits(wm831x, WM831X_POWER_STATE, WM831X_CHIP_ON, 0);\n\t}\n}\nEXPORT_SYMBOL_GPL(wm831x_device_shutdown);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}