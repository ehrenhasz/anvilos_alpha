{
  "module_name": "devsynth.c",
  "hash_id": "a21da72b7f5808162639b513d726f99a2af2dca86d3a00948d3c0c9f322c10c1",
  "original_prompt": "Ingested from linux-6.6.14/drivers/accessibility/speakup/devsynth.c",
  "human_readable_source": "\n#include <linux/errno.h>\n#include <linux/miscdevice.h>\t \n#include <linux/types.h>\n#include <linux/uaccess.h>\n\n#include \"speakup.h\"\n#include \"spk_priv.h\"\n\nstatic int misc_registered;\nstatic int dev_opened;\n\nstatic ssize_t speakup_file_write(struct file *fp, const char __user *buffer,\n\t\t\t\t  size_t nbytes, loff_t *ppos)\n{\n\tsize_t count = nbytes;\n\tconst char __user *ptr = buffer;\n\tsize_t bytes;\n\tunsigned long flags;\n\tu_char buf[256];\n\n\tif (!synth)\n\t\treturn -ENODEV;\n\twhile (count > 0) {\n\t\tbytes = min(count, sizeof(buf));\n\t\tif (copy_from_user(buf, ptr, bytes))\n\t\t\treturn -EFAULT;\n\t\tcount -= bytes;\n\t\tptr += bytes;\n\t\tspin_lock_irqsave(&speakup_info.spinlock, flags);\n\t\tsynth_write(buf, bytes);\n\t\tspin_unlock_irqrestore(&speakup_info.spinlock, flags);\n\t}\n\treturn (ssize_t)nbytes;\n}\n\nstatic ssize_t speakup_file_read(struct file *fp, char __user *buf,\n\t\t\t\t size_t nbytes, loff_t *ppos)\n{\n\treturn 0;\n}\n\nstatic int speakup_file_open(struct inode *ip, struct file *fp)\n{\n\tif (!synth)\n\t\treturn -ENODEV;\n\tif (xchg(&dev_opened, 1))\n\t\treturn -EBUSY;\n\treturn 0;\n}\n\nstatic int speakup_file_release(struct inode *ip, struct file *fp)\n{\n\tdev_opened = 0;\n\treturn 0;\n}\n\nstatic const struct file_operations synth_fops = {\n\t.read = speakup_file_read,\n\t.write = speakup_file_write,\n\t.open = speakup_file_open,\n\t.release = speakup_file_release,\n};\n\nstatic struct miscdevice synth_device = {\n\t.minor = MISC_DYNAMIC_MINOR,\n\t.name = \"synth\",\n\t.fops = &synth_fops,\n};\n\nvoid speakup_register_devsynth(void)\n{\n\tif (misc_registered != 0)\n\t\treturn;\n \n\tif (misc_register(&synth_device)) {\n\t\tpr_warn(\"Couldn't initialize miscdevice /dev/synth.\\n\");\n\t} else {\n\t\tpr_info(\"initialized device: /dev/synth, node (MAJOR %d, MINOR %d)\\n\",\n\t\t\tMISC_MAJOR, synth_device.minor);\n\t\tmisc_registered = 1;\n\t}\n}\n\nvoid speakup_unregister_devsynth(void)\n{\n\tif (!misc_registered)\n\t\treturn;\n\tpr_info(\"speakup: unregistering synth device /dev/synth\\n\");\n\tmisc_deregister(&synth_device);\n\tmisc_registered = 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}