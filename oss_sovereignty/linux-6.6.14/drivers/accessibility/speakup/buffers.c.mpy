{
  "module_name": "buffers.c",
  "hash_id": "f062fed8ab963c4623483861c02492dfc96975bb1f9d3a15358143298e080569",
  "original_prompt": "Ingested from linux-6.6.14/drivers/accessibility/speakup/buffers.c",
  "human_readable_source": "\n#include <linux/console.h>\n#include <linux/types.h>\n#include <linux/wait.h>\n\n#include \"speakup.h\"\n#include \"spk_priv.h\"\n\n#define SYNTH_BUF_SIZE 8192\t \n\nstatic u16 synth_buffer[SYNTH_BUF_SIZE];\t \nstatic u16 *buff_in = synth_buffer;\nstatic u16 *buff_out = synth_buffer;\nstatic u16 *buffer_end = synth_buffer + SYNTH_BUF_SIZE - 1;\n\n \nvoid speakup_start_ttys(void)\n{\n\tint i;\n\n\tfor (i = 0; i < MAX_NR_CONSOLES; i++) {\n\t\tif (speakup_console[i] && speakup_console[i]->tty_stopped)\n\t\t\tcontinue;\n\t\tif (vc_cons[i].d && vc_cons[i].d->port.tty)\n\t\t\tstart_tty(vc_cons[i].d->port.tty);\n\t}\n}\nEXPORT_SYMBOL_GPL(speakup_start_ttys);\n\nstatic void speakup_stop_ttys(void)\n{\n\tint i;\n\n\tfor (i = 0; i < MAX_NR_CONSOLES; i++)\n\t\tif (vc_cons[i].d && vc_cons[i].d->port.tty)\n\t\t\tstop_tty(vc_cons[i].d->port.tty);\n}\n\nstatic int synth_buffer_free(void)\n{\n\tint chars_free;\n\n\tif (buff_in >= buff_out)\n\t\tchars_free = SYNTH_BUF_SIZE - (buff_in - buff_out);\n\telse\n\t\tchars_free = buff_out - buff_in;\n\treturn chars_free;\n}\n\nint synth_buffer_empty(void)\n{\n\treturn (buff_in == buff_out);\n}\nEXPORT_SYMBOL_GPL(synth_buffer_empty);\n\nvoid synth_buffer_add(u16 ch)\n{\n\tif (!synth->alive) {\n\t\t \n\t\treturn;\n\t}\n\tif (synth_buffer_free() <= 100) {\n\t\tsynth_start();\n\t\tspeakup_stop_ttys();\n\t}\n\tif (synth_buffer_free() <= 1)\n\t\treturn;\n\t*buff_in++ = ch;\n\tif (buff_in > buffer_end)\n\t\tbuff_in = synth_buffer;\n\t \n\tspk_paused = false;\n}\n\nu16 synth_buffer_getc(void)\n{\n\tu16 ch;\n\n\tif (buff_out == buff_in)\n\t\treturn 0;\n\tch = *buff_out++;\n\tif (buff_out > buffer_end)\n\t\tbuff_out = synth_buffer;\n\treturn ch;\n}\nEXPORT_SYMBOL_GPL(synth_buffer_getc);\n\nu16 synth_buffer_peek(void)\n{\n\tif (buff_out == buff_in)\n\t\treturn 0;\n\treturn *buff_out;\n}\nEXPORT_SYMBOL_GPL(synth_buffer_peek);\n\nvoid synth_buffer_skip_nonlatin1(void)\n{\n\twhile (buff_out != buff_in) {\n\t\tif (*buff_out < 0x100)\n\t\t\treturn;\n\t\tbuff_out++;\n\t\tif (buff_out > buffer_end)\n\t\t\tbuff_out = synth_buffer;\n\t}\n}\nEXPORT_SYMBOL_GPL(synth_buffer_skip_nonlatin1);\n\nvoid synth_buffer_clear(void)\n{\n\tbuff_in = synth_buffer;\n\tbuff_out = synth_buffer;\n}\nEXPORT_SYMBOL_GPL(synth_buffer_clear);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}