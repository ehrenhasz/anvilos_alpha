{
  "module_name": "pata_sch.c",
  "hash_id": "7f3eceebacaf6361d209fbf465699371e4b4d2bd95199b139d5ceb7a764a781b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/pata_sch.c",
  "human_readable_source": "\n \n\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/blkdev.h>\n#include <linux/delay.h>\n#include <linux/device.h>\n#include <scsi/scsi_host.h>\n#include <linux/libata.h>\n#include <linux/dmi.h>\n\n#define DRV_NAME\t\"pata_sch\"\n#define DRV_VERSION\t\"0.2\"\n\n \nenum {\n\tD0TIM\t= 0x80,\t\t \n\tD1TIM\t= 0x84,\t\t \n\tPM\t= 0x07,\t\t \n\tMDM\t= (0x03 << 8),\t \n\tUDM\t= (0x07 << 16),  \n\tPPE\t= (1 << 30),\t \n\tUSD\t= (1 << 31),\t \n};\n\nstatic int sch_init_one(struct pci_dev *pdev,\n\t\t\t const struct pci_device_id *ent);\nstatic void sch_set_piomode(struct ata_port *ap, struct ata_device *adev);\nstatic void sch_set_dmamode(struct ata_port *ap, struct ata_device *adev);\n\nstatic const struct pci_device_id sch_pci_tbl[] = {\n\t \n\t{ PCI_VDEVICE(INTEL, PCI_DEVICE_ID_INTEL_SCH_IDE), 0 },\n\t{ }\t \n};\n\nstatic struct pci_driver sch_pci_driver = {\n\t.name\t\t\t= DRV_NAME,\n\t.id_table\t\t= sch_pci_tbl,\n\t.probe\t\t\t= sch_init_one,\n\t.remove\t\t\t= ata_pci_remove_one,\n#ifdef CONFIG_PM_SLEEP\n\t.suspend\t\t= ata_pci_device_suspend,\n\t.resume\t\t\t= ata_pci_device_resume,\n#endif\n};\n\nstatic const struct scsi_host_template sch_sht = {\n\tATA_BMDMA_SHT(DRV_NAME),\n};\n\nstatic struct ata_port_operations sch_pata_ops = {\n\t.inherits\t\t= &ata_bmdma_port_ops,\n\t.cable_detect\t\t= ata_cable_unknown,\n\t.set_piomode\t\t= sch_set_piomode,\n\t.set_dmamode\t\t= sch_set_dmamode,\n};\n\nstatic const struct ata_port_info sch_port_info = {\n\t.flags\t\t= ATA_FLAG_SLAVE_POSS,\n\t.pio_mask\t= ATA_PIO4,\n\t.mwdma_mask\t= ATA_MWDMA2,\n\t.udma_mask\t= ATA_UDMA5,\n\t.port_ops\t= &sch_pata_ops,\n};\n\nMODULE_AUTHOR(\"Alek Du <alek.du@intel.com>\");\nMODULE_DESCRIPTION(\"SCSI low-level driver for Intel SCH PATA controllers\");\nMODULE_LICENSE(\"GPL\");\nMODULE_DEVICE_TABLE(pci, sch_pci_tbl);\nMODULE_VERSION(DRV_VERSION);\n\n \n\nstatic void sch_set_piomode(struct ata_port *ap, struct ata_device *adev)\n{\n\tunsigned int pio\t= adev->pio_mode - XFER_PIO_0;\n\tstruct pci_dev *dev\t= to_pci_dev(ap->host->dev);\n\tunsigned int port\t= adev->devno ? D1TIM : D0TIM;\n\tunsigned int data;\n\n\tpci_read_config_dword(dev, port, &data);\n\t \n\t \n\tdata &= ~(PM | PPE);\n\tdata |= pio;\n\t \n\tif (adev->class == ATA_DEV_ATA)\n\t\tdata |= PPE;\n\tpci_write_config_dword(dev, port, data);\n}\n\n \n\nstatic void sch_set_dmamode(struct ata_port *ap, struct ata_device *adev)\n{\n\tunsigned int dma_mode\t= adev->dma_mode;\n\tstruct pci_dev *dev\t= to_pci_dev(ap->host->dev);\n\tunsigned int port\t= adev->devno ? D1TIM : D0TIM;\n\tunsigned int data;\n\n\tpci_read_config_dword(dev, port, &data);\n\t \n\tif (dma_mode >= XFER_UDMA_0) {\n\t\t \n\t\tdata |= USD;\n\t\tdata &= ~UDM;\n\t\tdata |= (dma_mode - XFER_UDMA_0) << 16;\n\t} else {  \n\t\tdata &= ~(USD | MDM);\n\t\tdata |= (dma_mode - XFER_MW_DMA_0) << 8;\n\t}\n\tpci_write_config_dword(dev, port, data);\n}\n\n \n\nstatic int sch_init_one(struct pci_dev *pdev, const struct pci_device_id *ent)\n{\n\tconst struct ata_port_info *ppi[] = { &sch_port_info, NULL };\n\n\tata_print_version_once(&pdev->dev, DRV_VERSION);\n\n\treturn ata_pci_bmdma_init_one(pdev, ppi, &sch_sht, NULL, 0);\n}\n\nmodule_pci_driver(sch_pci_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}