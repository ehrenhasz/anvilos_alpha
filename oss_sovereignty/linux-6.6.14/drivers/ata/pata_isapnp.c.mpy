{
  "module_name": "pata_isapnp.c",
  "hash_id": "d0c5da0269e4c3c53eec564e6296d881cef716c5053100ed0cf78318ea5cb030",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/pata_isapnp.c",
  "human_readable_source": "\n\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/isapnp.h>\n#include <linux/init.h>\n#include <linux/blkdev.h>\n#include <linux/delay.h>\n#include <scsi/scsi_host.h>\n#include <linux/ata.h>\n#include <linux/libata.h>\n\n#define DRV_NAME \"pata_isapnp\"\n#define DRV_VERSION \"0.2.5\"\n\nstatic const struct scsi_host_template isapnp_sht = {\n\tATA_PIO_SHT(DRV_NAME),\n};\n\nstatic struct ata_port_operations isapnp_port_ops = {\n\t.inherits\t= &ata_sff_port_ops,\n\t.cable_detect\t= ata_cable_40wire,\n};\n\nstatic struct ata_port_operations isapnp_noalt_port_ops = {\n\t.inherits\t= &ata_sff_port_ops,\n\t.cable_detect\t= ata_cable_40wire,\n\t \n\t.lost_interrupt = ATA_OP_NULL,\n};\n\n \n\nstatic int isapnp_init_one(struct pnp_dev *idev, const struct pnp_device_id *dev_id)\n{\n\tstruct ata_host *host;\n\tstruct ata_port *ap;\n\tvoid __iomem *cmd_addr, *ctl_addr;\n\tint irq = 0;\n\tirq_handler_t handler = NULL;\n\n\tif (pnp_port_valid(idev, 0) == 0)\n\t\treturn -ENODEV;\n\n\tif (pnp_irq_valid(idev, 0)) {\n\t\tirq = pnp_irq(idev, 0);\n\t\thandler = ata_sff_interrupt;\n\t}\n\n\t \n\thost = ata_host_alloc(&idev->dev, 1);\n\tif (!host)\n\t\treturn -ENOMEM;\n\n\t \n\tcmd_addr = devm_ioport_map(&idev->dev, pnp_port_start(idev, 0), 8);\n\tif (!cmd_addr)\n\t\treturn -ENOMEM;\n\n\tap = host->ports[0];\n\n\tap->ops = &isapnp_noalt_port_ops;\n\tap->pio_mask = ATA_PIO0;\n\tap->flags |= ATA_FLAG_SLAVE_POSS;\n\n\tap->ioaddr.cmd_addr = cmd_addr;\n\n\tif (pnp_port_valid(idev, 1)) {\n\t\tctl_addr = devm_ioport_map(&idev->dev,\n\t\t\t\t\t   pnp_port_start(idev, 1), 1);\n\t\tif (!ctl_addr)\n\t\t\treturn -ENOMEM;\n\n\t\tap->ioaddr.altstatus_addr = ctl_addr;\n\t\tap->ioaddr.ctl_addr = ctl_addr;\n\t\tap->ops = &isapnp_port_ops;\n\t}\n\n\tata_sff_std_ports(&ap->ioaddr);\n\n\tata_port_desc(ap, \"cmd 0x%llx ctl 0x%llx\",\n\t\t      (unsigned long long)pnp_port_start(idev, 0),\n\t\t      (unsigned long long)pnp_port_start(idev, 1));\n\n\t \n\treturn ata_host_activate(host, irq, handler, 0,\n\t\t\t\t &isapnp_sht);\n}\n\n \n\nstatic void isapnp_remove_one(struct pnp_dev *idev)\n{\n\tstruct device *dev = &idev->dev;\n\tstruct ata_host *host = dev_get_drvdata(dev);\n\n\tata_host_detach(host);\n}\n\nstatic struct pnp_device_id isapnp_devices[] = {\n  \t \n\t{.id = \"PNP0600\", .driver_data = 0},\n\t{.id = \"\"}\n};\n\nMODULE_DEVICE_TABLE(pnp, isapnp_devices);\n\nstatic struct pnp_driver isapnp_driver = {\n\t.name\t\t= DRV_NAME,\n\t.id_table\t= isapnp_devices,\n\t.probe\t\t= isapnp_init_one,\n\t.remove\t\t= isapnp_remove_one,\n};\n\nmodule_pnp_driver(isapnp_driver);\nMODULE_AUTHOR(\"Alan Cox\");\nMODULE_DESCRIPTION(\"low-level driver for ISA PnP ATA\");\nMODULE_LICENSE(\"GPL\");\nMODULE_VERSION(DRV_VERSION);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}