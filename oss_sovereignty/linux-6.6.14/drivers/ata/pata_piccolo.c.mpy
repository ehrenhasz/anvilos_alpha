{
  "module_name": "pata_piccolo.c",
  "hash_id": "728fdd4ee9f2371e18b18cab2b6ea8c9a218cf6691a0b74c56df2c9467c477e8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/pata_piccolo.c",
  "human_readable_source": " \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/blkdev.h>\n#include <linux/delay.h>\n#include <scsi/scsi_host.h>\n#include <linux/libata.h>\n\n#define DRV_NAME \"pata_piccolo\"\n#define DRV_VERSION \"0.0.1\"\n\n\n\nstatic void tosh_set_piomode(struct ata_port *ap, struct ata_device *adev)\n{\n\tstatic const u16 pio[6] = {\t \n\t\t0x0566, 0x0433, 0x0311, 0x0201, 0x0200, 0x0100\n\t};\n\tstruct pci_dev *pdev = to_pci_dev(ap->host->dev);\n\tu16 conf;\n\tpci_read_config_word(pdev, 0x50, &conf);\n\tconf &= 0xE088;\n\tconf |= pio[adev->pio_mode - XFER_PIO_0];\n\tpci_write_config_word(pdev, 0x50, conf);\n}\n\nstatic void tosh_set_dmamode(struct ata_port *ap, struct ata_device *adev)\n{\n\tstruct pci_dev *pdev = to_pci_dev(ap->host->dev);\n\tu32 conf;\n\tpci_read_config_dword(pdev, 0x5C, &conf);\n\tconf &= 0x78FFE088;\t \n\tif (adev->dma_mode >= XFER_UDMA_0) {\n\t\tint udma = adev->dma_mode - XFER_UDMA_0;\n\t\tconf |= 0x80000000;\n\t\tconf |= (udma + 2) << 28;\n\t\tconf |= (2 - udma) * 0x111;\t \n\t} else {\n\t\tstatic const u32 mwdma[4] = {\n\t\t\t0x0655, 0x0200, 0x0200, 0x0100\n\t\t};\n\t\tconf |= mwdma[adev->dma_mode - XFER_MW_DMA_0];\n\t}\n\tpci_write_config_dword(pdev, 0x5C, conf);\n}\n\n\nstatic const struct scsi_host_template tosh_sht = {\n\tATA_BMDMA_SHT(DRV_NAME),\n};\n\nstatic struct ata_port_operations tosh_port_ops = {\n\t.inherits\t= &ata_bmdma_port_ops,\n\t.cable_detect\t= ata_cable_unknown,\n\t.set_piomode\t= tosh_set_piomode,\n\t.set_dmamode\t= tosh_set_dmamode\n};\n\n \n\nstatic int ata_tosh_init_one(struct pci_dev *dev, const struct pci_device_id *id)\n{\n\tstatic const struct ata_port_info info = {\n\t\t.flags = ATA_FLAG_SLAVE_POSS,\n\t\t.pio_mask = ATA_PIO5,\n\t\t.mwdma_mask = ATA_MWDMA2,\n\t\t.udma_mask = ATA_UDMA2,\n\t\t.port_ops = &tosh_port_ops\n\t};\n\tconst struct ata_port_info *ppi[] = { &info, &ata_dummy_port_info };\n\t \n\treturn ata_pci_bmdma_init_one(dev, ppi, &tosh_sht, NULL, 0);\n}\n\nstatic struct pci_device_id ata_tosh[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_TOSHIBA,PCI_DEVICE_ID_TOSHIBA_PICCOLO_1), },\n\t{ PCI_DEVICE(PCI_VENDOR_ID_TOSHIBA,PCI_DEVICE_ID_TOSHIBA_PICCOLO_2),  },\n\t{ PCI_DEVICE(PCI_VENDOR_ID_TOSHIBA,PCI_DEVICE_ID_TOSHIBA_PICCOLO_3),  },\n\t{ PCI_DEVICE(PCI_VENDOR_ID_TOSHIBA,PCI_DEVICE_ID_TOSHIBA_PICCOLO_5),  },\n\t{ 0, },\n};\n\nstatic struct pci_driver ata_tosh_pci_driver = {\n\t.name \t\t= DRV_NAME,\n\t.id_table\t= ata_tosh,\n\t.probe \t\t= ata_tosh_init_one,\n\t.remove\t\t= ata_pci_remove_one,\n#ifdef CONFIG_PM_SLEEP\n\t.suspend\t= ata_pci_device_suspend,\n\t.resume\t\t= ata_pci_device_resume,\n#endif\n};\n\nmodule_pci_driver(ata_tosh_pci_driver);\n\nMODULE_AUTHOR(\"Alan Cox\");\nMODULE_DESCRIPTION(\"Low level driver for Toshiba Piccolo ATA\");\nMODULE_LICENSE(\"GPL\");\nMODULE_DEVICE_TABLE(pci, ata_tosh);\nMODULE_VERSION(DRV_VERSION);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}