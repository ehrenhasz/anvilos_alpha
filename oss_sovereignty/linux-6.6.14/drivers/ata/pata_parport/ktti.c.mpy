{
  "module_name": "ktti.c",
  "hash_id": "4a0236d81a03e892700591e52b77322cede9858378ad9372c37bae6ee3687625",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/pata_parport/ktti.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/wait.h>\n#include <asm/io.h>\n#include \"pata_parport.h\"\n\n#define j44(a, b)\t(((a >> 4) & 0x0f) | (b & 0xf0))\n\n \nstatic int cont_map[2] = { 0x10, 0x08 };\n\nstatic void ktti_write_regr(struct pi_adapter *pi, int cont, int regr, int val)\n{\n\tint r = regr + cont_map[cont];\n\n\tw0(r); w2(0xb); w2(0xa); w2(3); w2(6);\n\tw0(val); w2(3); w0(0); w2(6); w2(0xb);\n}\n\nstatic int ktti_read_regr(struct pi_adapter *pi, int cont, int regr)\n{\n\tint a, b, r;\n\n        r = regr + cont_map[cont];\n\n\tw0(r); w2(0xb); w2(0xa); w2(9); w2(0xc); w2(9);\n\ta = r1(); w2(0xc);  b = r1(); w2(9); w2(0xc); w2(9);\n\treturn j44(a, b);\n}\n\nstatic void ktti_read_block(struct pi_adapter *pi, char *buf, int count)\n{\n\tint k, a, b;\n\n\tfor (k = 0; k < count / 2; k++) {\n\t\tw0(0x10); w2(0xb); w2(0xa); w2(9); w2(0xc); w2(9);\n\t\ta = r1(); w2(0xc); b = r1(); w2(9);\n\t\tbuf[2*k] = j44(a, b);\n\t\ta = r1(); w2(0xc); b = r1(); w2(9);\n\t\tbuf[2*k+1] = j44(a, b);\n\t}\n}\n\nstatic void ktti_write_block(struct pi_adapter *pi, char *buf, int count)\n{\n\tint k;\n\n\tfor (k = 0; k < count / 2; k++) {\n\t\tw0(0x10); w2(0xb); w2(0xa); w2(3); w2(6);\n\t\tw0(buf[2 * k]); w2(3);\n\t\tw0(buf[2 * k + 1]); w2(6);\n\t\tw2(0xb);\n\t}\n}\n\nstatic void ktti_connect(struct pi_adapter *pi)\n{\n\tpi->saved_r0 = r0();\n\tpi->saved_r2 = r2();\n\tw2(0xb); w2(0xa); w0(0); w2(3); w2(6);\n}\n\nstatic void ktti_disconnect(struct pi_adapter *pi)\n{\n\tw2(0xb); w2(0xa); w0(0xa0); w2(3); w2(4);\n\tw0(pi->saved_r0);\n\tw2(pi->saved_r2);\n}\n\nstatic void ktti_log_adapter(struct pi_adapter *pi)\n{\n\tdev_info(&pi->dev, \"KT adapter at 0x%x, delay %d\\n\",\n\t\t pi->port, pi->delay);\n}\n\nstatic struct pi_protocol ktti = {\n\t.owner\t\t= THIS_MODULE,\n\t.name\t\t= \"ktti\",\n\t.max_mode\t= 1,\n\t.epp_first\t= 2,\n\t.default_delay\t= 1,\n\t.max_units\t= 1,\n\t.write_regr\t= ktti_write_regr,\n\t.read_regr\t= ktti_read_regr,\n\t.write_block\t= ktti_write_block,\n\t.read_block\t= ktti_read_block,\n\t.connect\t= ktti_connect,\n\t.disconnect\t= ktti_disconnect,\n\t.log_adapter\t= ktti_log_adapter,\n};\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Grant R. Guenther <grant@torque.net>\");\nMODULE_DESCRIPTION(\"KT Technology parallel port IDE adapter protocol driver\");\nmodule_pata_parport_driver(ktti);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}