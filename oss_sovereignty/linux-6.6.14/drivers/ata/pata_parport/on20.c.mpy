{
  "module_name": "on20.c",
  "hash_id": "b3b705b5d81618526d632a441603f4b7fbe9f07a9c2aa4acb8d7441c4e088f52",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/pata_parport/on20.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/kernel.h>\n#include <linux/types.h>\n#include <linux/wait.h>\n#include <asm/io.h>\n#include \"pata_parport.h\"\n\n#define op(f)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\\\n\t\tw2(4); w0(f); w2(5); w2(0xd);\t\\\n\t\tw2(5); w2(0xd); w2(5); w2(4);\t\\\n\t} while (0)\n\n#define vl(v)\t\t\t\t\t\\\n\tdo {\t\t\t\t\t\\\n\t\tw2(4); w0(v); w2(5);\t\t\\\n\t\tw2(7); w2(5); w2(4);\t\t\\\n\t} while (0)\n\n#define j44(a, b)\t(((a >> 4) & 0x0f) | (b & 0xf0))\n\n \n\nstatic int on20_read_regr(struct pi_adapter *pi, int cont, int regr)\n{\n\tint h, l, r;\n\n\tr = (regr << 2) + 1 + cont;\n\n\top(1); vl(r); op(0);\n\n\tswitch (pi->mode) {\n\tcase 0:\n\t\tw2(4); w2(6); l = r1();\n\t\tw2(4); w2(6); h = r1();\n\t\tw2(4); w2(6); w2(4); w2(6); w2(4);\n\t\treturn j44(l, h);\n\tcase 1:\n\t\tw2(4); w2(0x26); r = r0();\n\t\tw2(4); w2(0x26); w2(4);\n\t\treturn r;\n\t}\n\n\treturn -1;\n}\n\nstatic void on20_write_regr(struct pi_adapter *pi, int cont, int regr, int val)\n{\n\tint r = (regr << 2) + 1 + cont;\n\n\top(1); vl(r);\n\top(0); vl(val);\n\top(0); vl(val);\n}\n\nstatic void on20_connect(struct pi_adapter *pi)\n{\n\tpi->saved_r0 = r0();\n\tpi->saved_r2 = r2();\n\n\tw2(4); w0(0); w2(0xc); w2(4); w2(6); w2(4); w2(6); w2(4);\n\tif (pi->mode) {\n\t\top(2); vl(8); op(2); vl(9);\n\t} else {\n\t\top(2); vl(0); op(2); vl(8);\n\t}\n}\n\nstatic void on20_disconnect(struct pi_adapter *pi)\n{\n\tw2(4); w0(7); w2(4); w2(0xc); w2(4);\n\tw0(pi->saved_r0);\n\tw2(pi->saved_r2);\n}\n\nstatic void on20_read_block(struct pi_adapter *pi, char *buf, int count)\n{\n\tint k, l, h;\n\n\top(1); vl(1); op(0);\n\n\tfor (k = 0; k < count; k++) {\n\t\tif (pi->mode) {\n\t\t\tw2(4); w2(0x26); buf[k] = r0();\n\t\t} else {\n\t\t\tw2(6); l = r1(); w2(4);\n\t\t\tw2(6); h = r1(); w2(4);\n\t\t\tbuf[k] = j44(l, h);\n\t\t}\n\t}\n\tw2(4);\n}\n\nstatic void on20_write_block(struct pi_adapter *pi, char *buf, int count)\n{\n\tint k;\n\n\top(1); vl(1); op(0);\n\n\tfor (k = 0; k < count; k++) {\n\t\tw2(5); w0(buf[k]); w2(7);\n\t}\n\tw2(4);\n}\n\nstatic void on20_log_adapter(struct pi_adapter *pi)\n{\n\tchar *mode_string[2] = { \"4-bit\", \"8-bit\" };\n\n\tdev_info(&pi->dev,\n\t\t \"OnSpec 90c20 at 0x%x, mode %d (%s), delay %d\\n\",\n\t\t pi->port, pi->mode, mode_string[pi->mode], pi->delay);\n}\n\nstatic struct pi_protocol on20 = {\n\t.owner\t\t= THIS_MODULE,\n\t.name\t\t= \"on20\",\n\t.max_mode\t= 2,\n\t.epp_first\t= 2,\n\t.default_delay\t= 1,\n\t.max_units\t= 1,\n\t.write_regr\t= on20_write_regr,\n\t.read_regr\t= on20_read_regr,\n\t.write_block\t= on20_write_block,\n\t.read_block\t= on20_read_block,\n\t.connect\t= on20_connect,\n\t.disconnect\t= on20_disconnect,\n\t.log_adapter\t= on20_log_adapter,\n};\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Grant R. Guenther <grant@torque.net>\");\nMODULE_DESCRIPTION(\"Onspec 90c20 parallel port IDE adapter protocol driver\");\nmodule_pata_parport_driver(on20);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}