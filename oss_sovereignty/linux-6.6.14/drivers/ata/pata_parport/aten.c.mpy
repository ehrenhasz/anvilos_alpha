{
  "module_name": "aten.c",
  "hash_id": "a49e348ad803ed2d771fd1937451e012c3f356aa2d0f875f70328b6f5c46402a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/pata_parport/aten.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/kernel.h>\n#include <linux/wait.h>\n#include <linux/types.h>\n#include <asm/io.h>\n#include \"pata_parport.h\"\n\n#define j44(a,b)                ((((a>>4)&0x0f)|(b&0xf0))^0x88)\n\n \nstatic int  cont_map[2] = { 0x08, 0x20 };\n\nstatic void aten_write_regr(struct pi_adapter *pi, int cont, int regr, int val)\n{\n\tint r = regr + cont_map[cont] + 0x80;\n\n\tw0(r); w2(0xe); w2(6); w0(val); w2(7); w2(6); w2(0xc);\n}\n\nstatic int aten_read_regr(struct pi_adapter *pi, int cont, int regr)\n{\n\tint  a, b, r;\n\n\tr = regr + cont_map[cont] + 0x40;\n\n\tswitch (pi->mode) {\n\n\tcase 0:\n\t\tw0(r); w2(0xe); w2(6);\n\t\tw2(7); w2(6); w2(0);\n\t\ta = r1(); w0(0x10); b = r1(); w2(0xc);\n\t\treturn j44(a,b);\n\n\tcase 1:\n\t\tr |= 0x10;\n\t\tw0(r); w2(0xe); w2(6); w0(0xff);\n\t\tw2(0x27); w2(0x26); w2(0x20);\n\t\ta = r0();\n\t\tw2(0x26); w2(0xc);\n\t\treturn a;\n\t}\n\treturn -1;\n}\n\nstatic void aten_read_block(struct pi_adapter *pi, char *buf, int count)\n{\n\tint  k, a, b, c, d;\n\n\tswitch (pi->mode) {\n\n\tcase 0:\n\t\tw0(0x48); w2(0xe); w2(6);\n\t\tfor (k = 0; k < count / 2; k++) {\n\t\t\tw2(7); w2(6); w2(2);\n\t\t\ta = r1(); w0(0x58); b = r1();\n\t\t\tw2(0); d = r1(); w0(0x48); c = r1();\n\t\t\tbuf[2 * k] = j44(c, d);\n\t\t\tbuf[2 * k + 1] = j44(a, b);\n\t\t}\n\t\tw2(0xc);\n\t\tbreak;\n\n\tcase 1:\n\t\tw0(0x58); w2(0xe); w2(6);\n\t\tfor (k = 0; k < count / 2; k++) {\n\t\t\tw2(0x27); w2(0x26); w2(0x22);\n\t\t\ta = r0(); w2(0x20); b = r0();\n\t\t\tbuf[2 * k] = b;\n\t\t\tbuf[2 * k + 1] = a;\n\t\t}\n\t\tw2(0x26); w2(0xc);\n\t\tbreak;\n\t}\n}\n\nstatic void aten_write_block(struct pi_adapter *pi, char *buf, int count)\n{\n\tint k;\n\n\tw0(0x88); w2(0xe); w2(6);\n\tfor (k = 0; k < count / 2; k++) {\n\t\tw0(buf[2 * k + 1]); w2(0xe); w2(6);\n\t\tw0(buf[2 * k]); w2(7); w2(6);\n\t}\n\tw2(0xc);\n}\n\nstatic void aten_connect(struct pi_adapter *pi)\n{\n\tpi->saved_r0 = r0();\n\tpi->saved_r2 = r2();\n\tw2(0xc);\n}\n\nstatic void aten_disconnect(struct pi_adapter *pi)\n{\n\tw0(pi->saved_r0);\n\tw2(pi->saved_r2);\n}\n\nstatic void aten_log_adapter(struct pi_adapter *pi)\n{\n\tchar *mode_string[2] = { \"4-bit\", \"8-bit\" };\n\n\tdev_info(&pi->dev,\n\t\t \"ATEN EH-100 at 0x%x, mode %d (%s), delay %d\\n\",\n\t\t pi->port, pi->mode, mode_string[pi->mode], pi->delay);\n}\n\nstatic struct pi_protocol aten = {\n\t.owner\t\t= THIS_MODULE,\n\t.name\t\t= \"aten\",\n\t.max_mode\t= 2,\n\t.epp_first\t= 2,\n\t.default_delay\t= 1,\n\t.max_units\t= 1,\n\t.write_regr\t= aten_write_regr,\n\t.read_regr\t= aten_read_regr,\n\t.write_block\t= aten_write_block,\n\t.read_block\t= aten_read_block,\n\t.connect\t= aten_connect,\n\t.disconnect\t= aten_disconnect,\n\t.log_adapter\t= aten_log_adapter,\n};\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Grant R. Guenther <grant@torque.net>\");\nMODULE_DESCRIPTION(\"ATEN EH-100 parallel port IDE adapter protocol driver\");\nmodule_pata_parport_driver(aten);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}