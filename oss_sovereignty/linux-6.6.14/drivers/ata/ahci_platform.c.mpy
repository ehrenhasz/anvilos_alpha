{
  "module_name": "ahci_platform.c",
  "hash_id": "cdf954b9c4ba2db6164e232d8165615d97f4de6874545fe417cfb40cf68a21cf",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/ahci_platform.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/pm.h>\n#include <linux/device.h>\n#include <linux/platform_device.h>\n#include <linux/property.h>\n#include <linux/libata.h>\n#include <linux/ahci_platform.h>\n#include <linux/pci_ids.h>\n#include \"ahci.h\"\n\n#define DRV_NAME \"ahci\"\n\nstatic const struct ata_port_info ahci_port_info = {\n\t.flags\t\t= AHCI_FLAG_COMMON,\n\t.pio_mask\t= ATA_PIO4,\n\t.udma_mask\t= ATA_UDMA6,\n\t.port_ops\t= &ahci_platform_ops,\n};\n\nstatic const struct ata_port_info ahci_port_info_nolpm = {\n\t.flags\t\t= AHCI_FLAG_COMMON | ATA_FLAG_NO_LPM,\n\t.pio_mask\t= ATA_PIO4,\n\t.udma_mask\t= ATA_UDMA6,\n\t.port_ops\t= &ahci_platform_ops,\n};\n\nstatic const struct scsi_host_template ahci_platform_sht = {\n\tAHCI_SHT(DRV_NAME),\n};\n\nstatic int ahci_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct ahci_host_priv *hpriv;\n\tconst struct ata_port_info *port;\n\tint rc;\n\n\thpriv = ahci_platform_get_resources(pdev,\n\t\t\t\t\t    AHCI_PLATFORM_GET_RESETS);\n\tif (IS_ERR(hpriv))\n\t\treturn PTR_ERR(hpriv);\n\n\trc = ahci_platform_enable_resources(hpriv);\n\tif (rc)\n\t\treturn rc;\n\n\tif (device_is_compatible(dev, \"hisilicon,hisi-ahci\"))\n\t\thpriv->flags |= AHCI_HFLAG_NO_FBS | AHCI_HFLAG_NO_NCQ;\n\n\tport = device_get_match_data(dev);\n\tif (!port)\n\t\tport = &ahci_port_info;\n\n\trc = ahci_platform_init_host(pdev, hpriv, port,\n\t\t\t\t     &ahci_platform_sht);\n\tif (rc)\n\t\tgoto disable_resources;\n\n\treturn 0;\ndisable_resources:\n\tahci_platform_disable_resources(hpriv);\n\treturn rc;\n}\n\nstatic SIMPLE_DEV_PM_OPS(ahci_pm_ops, ahci_platform_suspend,\n\t\t\t ahci_platform_resume);\n\nstatic const struct of_device_id ahci_of_match[] = {\n\t{ .compatible = \"generic-ahci\", },\n\t \n\t{ .compatible = \"ibm,476gtr-ahci\", },\n\t{ .compatible = \"hisilicon,hisi-ahci\", },\n\t{ .compatible = \"cavium,octeon-7130-ahci\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, ahci_of_match);\n\nstatic const struct acpi_device_id ahci_acpi_match[] = {\n\t{ \"APMC0D33\", (unsigned long)&ahci_port_info_nolpm },\n\t{ ACPI_DEVICE_CLASS(PCI_CLASS_STORAGE_SATA_AHCI, 0xffffff) },\n\t{},\n};\nMODULE_DEVICE_TABLE(acpi, ahci_acpi_match);\n\nstatic struct platform_driver ahci_driver = {\n\t.probe = ahci_probe,\n\t.remove_new = ata_platform_remove_one,\n\t.shutdown = ahci_platform_shutdown,\n\t.driver = {\n\t\t.name = DRV_NAME,\n\t\t.of_match_table = ahci_of_match,\n\t\t.acpi_match_table = ahci_acpi_match,\n\t\t.pm = &ahci_pm_ops,\n\t},\n};\nmodule_platform_driver(ahci_driver);\n\nMODULE_DESCRIPTION(\"AHCI SATA platform driver\");\nMODULE_AUTHOR(\"Anton Vorontsov <avorontsov@ru.mvista.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:ahci\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}