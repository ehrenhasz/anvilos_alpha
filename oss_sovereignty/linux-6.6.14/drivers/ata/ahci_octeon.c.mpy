{
  "module_name": "ahci_octeon.c",
  "hash_id": "dd4b63ec6ac612fba81ce79d1663a0fbcabc0452f41f6b1d9c1725ada7d18006",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/ahci_octeon.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/dma-mapping.h>\n#include <linux/platform_device.h>\n#include <linux/of_platform.h>\n\n#include <asm/octeon/octeon.h>\n\n#define CVMX_SATA_UCTL_SHIM_CFG\t\t0xE8\n\n#define SATA_UCTL_ENDIAN_MODE_BIG\t1\n#define SATA_UCTL_ENDIAN_MODE_LITTLE\t0\n#define SATA_UCTL_ENDIAN_MODE_MASK\t3\n\n#define SATA_UCTL_DMA_ENDIAN_MODE_SHIFT\t8\n#define SATA_UCTL_CSR_ENDIAN_MODE_SHIFT\t0\n#define SATA_UCTL_DMA_READ_CMD_SHIFT\t12\n\nstatic int ahci_octeon_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct device_node *node = dev->of_node;\n\tvoid __iomem *base;\n\tu64 cfg;\n\tint ret;\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tcfg = cvmx_readq_csr(base + CVMX_SATA_UCTL_SHIM_CFG);\n\n\tcfg &= ~(SATA_UCTL_ENDIAN_MODE_MASK << SATA_UCTL_DMA_ENDIAN_MODE_SHIFT);\n\tcfg &= ~(SATA_UCTL_ENDIAN_MODE_MASK << SATA_UCTL_CSR_ENDIAN_MODE_SHIFT);\n\n#ifdef __BIG_ENDIAN\n\tcfg |= SATA_UCTL_ENDIAN_MODE_BIG << SATA_UCTL_DMA_ENDIAN_MODE_SHIFT;\n\tcfg |= SATA_UCTL_ENDIAN_MODE_BIG << SATA_UCTL_CSR_ENDIAN_MODE_SHIFT;\n#else\n\tcfg |= SATA_UCTL_ENDIAN_MODE_LITTLE << SATA_UCTL_DMA_ENDIAN_MODE_SHIFT;\n\tcfg |= SATA_UCTL_ENDIAN_MODE_LITTLE << SATA_UCTL_CSR_ENDIAN_MODE_SHIFT;\n#endif\n\n\tcfg |= 1 << SATA_UCTL_DMA_READ_CMD_SHIFT;\n\n\tcvmx_writeq_csr(base + CVMX_SATA_UCTL_SHIM_CFG, cfg);\n\n\tif (!node) {\n\t\tdev_err(dev, \"no device node, failed to add octeon sata\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tret = of_platform_populate(node, NULL, NULL, dev);\n\tif (ret) {\n\t\tdev_err(dev, \"failed to add ahci-platform core\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct of_device_id octeon_ahci_match[] = {\n\t{ .compatible = \"cavium,octeon-7130-sata-uctl\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, octeon_ahci_match);\n\nstatic struct platform_driver ahci_octeon_driver = {\n\t.probe          = ahci_octeon_probe,\n\t.driver         = {\n\t\t.name   = \"octeon-ahci\",\n\t\t.of_match_table = octeon_ahci_match,\n\t},\n};\n\nmodule_platform_driver(ahci_octeon_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Cavium, Inc. <support@cavium.com>\");\nMODULE_DESCRIPTION(\"Cavium Inc. sata config.\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}