{
  "module_name": "ahci.h",
  "hash_id": "2d68b48f94454205d817c818e15310fcfddba2af52e5528554fdd78339aa6d87",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/ahci.h",
  "human_readable_source": " \n \n\n#ifndef _AHCI_H\n#define _AHCI_H\n\n#include <linux/pci.h>\n#include <linux/clk.h>\n#include <linux/libata.h>\n#include <linux/phy/phy.h>\n#include <linux/regulator/consumer.h>\n#include <linux/bits.h>\n\n \n#define EM_CTRL_MSG_TYPE              0x000f0000\n\n \n#define EM_MSG_LED_HBA_PORT           0x0000000f\n#define EM_MSG_LED_PMP_SLOT           0x0000ff00\n#define EM_MSG_LED_VALUE              0xffff0000\n#define EM_MSG_LED_VALUE_ACTIVITY     0x00070000\n#define EM_MSG_LED_VALUE_OFF          0xfff80000\n#define EM_MSG_LED_VALUE_ON           0x00010000\n\nenum {\n\tAHCI_MAX_PORTS\t\t= 32,\n\tAHCI_MAX_SG\t\t= 168,  \n\tAHCI_DMA_BOUNDARY\t= 0xffffffff,\n\tAHCI_MAX_CMDS\t\t= 32,\n\tAHCI_CMD_SZ\t\t= 32,\n\tAHCI_CMD_SLOT_SZ\t= AHCI_MAX_CMDS * AHCI_CMD_SZ,\n\tAHCI_RX_FIS_SZ\t\t= 256,\n\tAHCI_CMD_TBL_CDB\t= 0x40,\n\tAHCI_CMD_TBL_HDR_SZ\t= 0x80,\n\tAHCI_CMD_TBL_SZ\t\t= AHCI_CMD_TBL_HDR_SZ + (AHCI_MAX_SG * 16),\n\tAHCI_CMD_TBL_AR_SZ\t= AHCI_CMD_TBL_SZ * AHCI_MAX_CMDS,\n\tAHCI_PORT_PRIV_DMA_SZ\t= AHCI_CMD_SLOT_SZ + AHCI_CMD_TBL_AR_SZ +\n\t\t\t\t  AHCI_RX_FIS_SZ,\n\tAHCI_PORT_PRIV_FBS_DMA_SZ\t= AHCI_CMD_SLOT_SZ +\n\t\t\t\t\t  AHCI_CMD_TBL_AR_SZ +\n\t\t\t\t\t  (AHCI_RX_FIS_SZ * 16),\n\tAHCI_IRQ_ON_SG\t\t= BIT(31),\n\tAHCI_CMD_ATAPI\t\t= BIT(5),\n\tAHCI_CMD_WRITE\t\t= BIT(6),\n\tAHCI_CMD_PREFETCH\t= BIT(7),\n\tAHCI_CMD_RESET\t\t= BIT(8),\n\tAHCI_CMD_CLR_BUSY\t= BIT(10),\n\n\tRX_FIS_PIO_SETUP\t= 0x20,\t \n\tRX_FIS_D2H_REG\t\t= 0x40,\t \n\tRX_FIS_SDB\t\t= 0x58,  \n\tRX_FIS_UNK\t\t= 0x60,  \n\n\t \n\tHOST_CAP\t\t= 0x00,  \n\tHOST_CTL\t\t= 0x04,  \n\tHOST_IRQ_STAT\t\t= 0x08,  \n\tHOST_PORTS_IMPL\t\t= 0x0c,  \n\tHOST_VERSION\t\t= 0x10,  \n\tHOST_EM_LOC\t\t= 0x1c,  \n\tHOST_EM_CTL\t\t= 0x20,  \n\tHOST_CAP2\t\t= 0x24,  \n\n\t \n\tHOST_RESET\t\t= BIT(0),   \n\tHOST_IRQ_EN\t\t= BIT(1),   \n\tHOST_MRSM\t\t= BIT(2),   \n\tHOST_AHCI_EN\t\t= BIT(31),  \n\n\t \n\tHOST_CAP_SXS\t\t= BIT(5),   \n\tHOST_CAP_EMS\t\t= BIT(6),   \n\tHOST_CAP_CCC\t\t= BIT(7),   \n\tHOST_CAP_PART\t\t= BIT(13),  \n\tHOST_CAP_SSC\t\t= BIT(14),  \n\tHOST_CAP_PIO_MULTI\t= BIT(15),  \n\tHOST_CAP_FBS\t\t= BIT(16),  \n\tHOST_CAP_PMP\t\t= BIT(17),  \n\tHOST_CAP_ONLY\t\t= BIT(18),  \n\tHOST_CAP_CLO\t\t= BIT(24),  \n\tHOST_CAP_LED\t\t= BIT(25),  \n\tHOST_CAP_ALPM\t\t= BIT(26),  \n\tHOST_CAP_SSS\t\t= BIT(27),  \n\tHOST_CAP_MPS\t\t= BIT(28),  \n\tHOST_CAP_SNTF\t\t= BIT(29),  \n\tHOST_CAP_NCQ\t\t= BIT(30),  \n\tHOST_CAP_64\t\t= BIT(31),  \n\n\t \n\tHOST_CAP2_BOH\t\t= BIT(0),   \n\tHOST_CAP2_NVMHCI\t= BIT(1),   \n\tHOST_CAP2_APST\t\t= BIT(2),   \n\tHOST_CAP2_SDS\t\t= BIT(3),   \n\tHOST_CAP2_SADM\t\t= BIT(4),   \n\tHOST_CAP2_DESO\t\t= BIT(5),   \n\n\t \n\tPORT_LST_ADDR\t\t= 0x00,  \n\tPORT_LST_ADDR_HI\t= 0x04,  \n\tPORT_FIS_ADDR\t\t= 0x08,  \n\tPORT_FIS_ADDR_HI\t= 0x0c,  \n\tPORT_IRQ_STAT\t\t= 0x10,  \n\tPORT_IRQ_MASK\t\t= 0x14,  \n\tPORT_CMD\t\t= 0x18,  \n\tPORT_TFDATA\t\t= 0x20,\t \n\tPORT_SIG\t\t= 0x24,\t \n\tPORT_CMD_ISSUE\t\t= 0x38,  \n\tPORT_SCR_STAT\t\t= 0x28,  \n\tPORT_SCR_CTL\t\t= 0x2c,  \n\tPORT_SCR_ERR\t\t= 0x30,  \n\tPORT_SCR_ACT\t\t= 0x34,  \n\tPORT_SCR_NTF\t\t= 0x3c,  \n\tPORT_FBS\t\t= 0x40,  \n\tPORT_DEVSLP\t\t= 0x44,  \n\n\t \n\tPORT_IRQ_COLD_PRES\t= BIT(31),  \n\tPORT_IRQ_TF_ERR\t\t= BIT(30),  \n\tPORT_IRQ_HBUS_ERR\t= BIT(29),  \n\tPORT_IRQ_HBUS_DATA_ERR\t= BIT(28),  \n\tPORT_IRQ_IF_ERR\t\t= BIT(27),  \n\tPORT_IRQ_IF_NONFATAL\t= BIT(26),  \n\tPORT_IRQ_OVERFLOW\t= BIT(24),  \n\tPORT_IRQ_BAD_PMP\t= BIT(23),  \n\n\tPORT_IRQ_PHYRDY\t\t= BIT(22),  \n\tPORT_IRQ_DMPS\t\t= BIT(7),   \n\tPORT_IRQ_CONNECT\t= BIT(6),   \n\tPORT_IRQ_SG_DONE\t= BIT(5),   \n\tPORT_IRQ_UNK_FIS\t= BIT(4),   \n\tPORT_IRQ_SDB_FIS\t= BIT(3),   \n\tPORT_IRQ_DMAS_FIS\t= BIT(2),   \n\tPORT_IRQ_PIOS_FIS\t= BIT(1),   \n\tPORT_IRQ_D2H_REG_FIS\t= BIT(0),   \n\n\tPORT_IRQ_FREEZE\t\t= PORT_IRQ_HBUS_ERR |\n\t\t\t\t  PORT_IRQ_IF_ERR |\n\t\t\t\t  PORT_IRQ_CONNECT |\n\t\t\t\t  PORT_IRQ_PHYRDY |\n\t\t\t\t  PORT_IRQ_UNK_FIS |\n\t\t\t\t  PORT_IRQ_BAD_PMP,\n\tPORT_IRQ_ERROR\t\t= PORT_IRQ_FREEZE |\n\t\t\t\t  PORT_IRQ_TF_ERR |\n\t\t\t\t  PORT_IRQ_HBUS_DATA_ERR,\n\tDEF_PORT_IRQ\t\t= PORT_IRQ_ERROR | PORT_IRQ_SG_DONE |\n\t\t\t\t  PORT_IRQ_SDB_FIS | PORT_IRQ_DMAS_FIS |\n\t\t\t\t  PORT_IRQ_PIOS_FIS | PORT_IRQ_D2H_REG_FIS,\n\n\t \n\tPORT_CMD_ASP\t\t= BIT(27),  \n\tPORT_CMD_ALPE\t\t= BIT(26),  \n\tPORT_CMD_ATAPI\t\t= BIT(24),  \n\tPORT_CMD_FBSCP\t\t= BIT(22),  \n\tPORT_CMD_ESP\t\t= BIT(21),  \n\tPORT_CMD_CPD\t\t= BIT(20),  \n\tPORT_CMD_MPSP\t\t= BIT(19),  \n\tPORT_CMD_HPCP\t\t= BIT(18),  \n\tPORT_CMD_PMP\t\t= BIT(17),  \n\tPORT_CMD_LIST_ON\t= BIT(15),  \n\tPORT_CMD_FIS_ON\t\t= BIT(14),  \n\tPORT_CMD_FIS_RX\t\t= BIT(4),   \n\tPORT_CMD_CLO\t\t= BIT(3),   \n\tPORT_CMD_POWER_ON\t= BIT(2),   \n\tPORT_CMD_SPIN_UP\t= BIT(1),   \n\tPORT_CMD_START\t\t= BIT(0),   \n\n\tPORT_CMD_ICC_MASK\t= (0xfu << 28),  \n\tPORT_CMD_ICC_ACTIVE\t= (0x1u << 28),  \n\tPORT_CMD_ICC_PARTIAL\t= (0x2u << 28),  \n\tPORT_CMD_ICC_SLUMBER\t= (0x6u << 28),  \n\n\t \n\tPORT_CMD_CAP\t\t= PORT_CMD_HPCP | PORT_CMD_MPSP |\n\t\t\t\t  PORT_CMD_CPD | PORT_CMD_ESP | PORT_CMD_FBSCP,\n\n\t \n\tPORT_FBS_DWE_OFFSET\t= 16,  \n\tPORT_FBS_ADO_OFFSET\t= 12,  \n\tPORT_FBS_DEV_OFFSET\t= 8,   \n\tPORT_FBS_DEV_MASK\t= (0xf << PORT_FBS_DEV_OFFSET),   \n\tPORT_FBS_SDE\t\t= BIT(2),  \n\tPORT_FBS_DEC\t\t= BIT(1),  \n\tPORT_FBS_EN\t\t= BIT(0),  \n\n\t \n\tPORT_DEVSLP_DM_OFFSET\t= 25,              \n\tPORT_DEVSLP_DM_MASK\t= (0xf << 25),     \n\tPORT_DEVSLP_DITO_OFFSET\t= 15,              \n\tPORT_DEVSLP_MDAT_OFFSET\t= 10,              \n\tPORT_DEVSLP_DETO_OFFSET\t= 2,               \n\tPORT_DEVSLP_DSP\t\t= BIT(1),          \n\tPORT_DEVSLP_ADSE\t= BIT(0),          \n\n\t \n\n#define AHCI_HFLAGS(flags)\t\t.private_data\t= (void *)(flags)\n\n\tAHCI_HFLAG_NO_NCQ\t\t= BIT(0),\n\tAHCI_HFLAG_IGN_IRQ_IF_ERR\t= BIT(1),  \n\tAHCI_HFLAG_IGN_SERR_INTERNAL\t= BIT(2),  \n\tAHCI_HFLAG_32BIT_ONLY\t\t= BIT(3),  \n\tAHCI_HFLAG_MV_PATA\t\t= BIT(4),  \n\tAHCI_HFLAG_NO_MSI\t\t= BIT(5),  \n\tAHCI_HFLAG_NO_PMP\t\t= BIT(6),  \n\tAHCI_HFLAG_SECT255\t\t= BIT(8),  \n\tAHCI_HFLAG_YES_NCQ\t\t= BIT(9),  \n\tAHCI_HFLAG_NO_SUSPEND\t\t= BIT(10),  \n\tAHCI_HFLAG_SRST_TOUT_IS_OFFLINE\t= BIT(11),  \n\tAHCI_HFLAG_NO_SNTF\t\t= BIT(12),  \n\tAHCI_HFLAG_NO_FPDMA_AA\t\t= BIT(13),  \n\tAHCI_HFLAG_YES_FBS\t\t= BIT(14),  \n\tAHCI_HFLAG_DELAY_ENGINE\t\t= BIT(15),  \n\tAHCI_HFLAG_NO_DEVSLP\t\t= BIT(17),  \n\tAHCI_HFLAG_NO_FBS\t\t= BIT(18),  \n\n#ifdef CONFIG_PCI_MSI\n\tAHCI_HFLAG_MULTI_MSI\t\t= BIT(20),  \n#else\n\t \n\tAHCI_HFLAG_MULTI_MSI\t\t= 0,\n#endif\n\tAHCI_HFLAG_WAKE_BEFORE_STOP\t= BIT(22),  \n\tAHCI_HFLAG_YES_ALPM\t\t= BIT(23),  \n\tAHCI_HFLAG_NO_WRITE_TO_RO\t= BIT(24),  \n\tAHCI_HFLAG_USE_LPM_POLICY\t= BIT(25),  \n\tAHCI_HFLAG_SUSPEND_PHYS\t\t= BIT(26),  \n\tAHCI_HFLAG_NO_SXS\t\t= BIT(28),  \n\n\t \n\n\tAHCI_FLAG_COMMON\t\t= ATA_FLAG_SATA | ATA_FLAG_PIO_DMA |\n\t\t\t\t\t  ATA_FLAG_ACPI_SATA | ATA_FLAG_AN,\n\n\tICH_MAP\t\t\t\t= 0x90,  \n\tPCS_6\t\t\t\t= 0x92,  \n\tPCS_7\t\t\t\t= 0x94,  \n\n\t \n\tEM_MAX_SLOTS\t\t\t= SATA_PMP_MAX_PORTS,\n\tEM_MAX_RETRY\t\t\t= 5,\n\n\t \n\tEM_CTL_RST\t\t= BIT(9),  \n\tEM_CTL_TM\t\t= BIT(8),  \n\tEM_CTL_MR\t\t= BIT(0),  \n\tEM_CTL_ALHD\t\t= BIT(26),  \n\tEM_CTL_XMT\t\t= BIT(25),  \n\tEM_CTL_SMB\t\t= BIT(24),  \n\tEM_CTL_SGPIO\t\t= BIT(19),  \n\tEM_CTL_SES\t\t= BIT(18),  \n\tEM_CTL_SAFTE\t\t= BIT(17),  \n\tEM_CTL_LED\t\t= BIT(16),  \n\n\t \n\tEM_MSG_TYPE_LED\t\t= BIT(0),  \n\tEM_MSG_TYPE_SAFTE\t= BIT(1),  \n\tEM_MSG_TYPE_SES2\t= BIT(2),  \n\tEM_MSG_TYPE_SGPIO\t= BIT(3),  \n};\n\nstruct ahci_cmd_hdr {\n\t__le32\t\t\topts;\n\t__le32\t\t\tstatus;\n\t__le32\t\t\ttbl_addr;\n\t__le32\t\t\ttbl_addr_hi;\n\t__le32\t\t\treserved[4];\n};\n\nstruct ahci_sg {\n\t__le32\t\t\taddr;\n\t__le32\t\t\taddr_hi;\n\t__le32\t\t\treserved;\n\t__le32\t\t\tflags_size;\n};\n\nstruct ahci_em_priv {\n\tenum sw_activity blink_policy;\n\tstruct timer_list timer;\n\tunsigned long saved_activity;\n\tunsigned long activity;\n\tunsigned long led_state;\n\tstruct ata_link *link;\n};\n\nstruct ahci_port_priv {\n\tstruct ata_link\t\t*active_link;\n\tstruct ahci_cmd_hdr\t*cmd_slot;\n\tdma_addr_t\t\tcmd_slot_dma;\n\tvoid\t\t\t*cmd_tbl;\n\tdma_addr_t\t\tcmd_tbl_dma;\n\tvoid\t\t\t*rx_fis;\n\tdma_addr_t\t\trx_fis_dma;\n\t \n\tunsigned int\t\tncq_saw_d2h:1;\n\tunsigned int\t\tncq_saw_dmas:1;\n\tunsigned int\t\tncq_saw_sdb:1;\n\tspinlock_t\t\tlock;\t\t \n\tu32 \t\t\tintr_mask;\t \n\tbool\t\t\tfbs_supported;\t \n\tbool\t\t\tfbs_enabled;\t \n\tint\t\t\tfbs_last_dev;\t \n\t \n\tstruct ahci_em_priv\tem_priv[EM_MAX_SLOTS];\n\tchar\t\t\t*irq_desc;\t \n};\n\nstruct ahci_host_priv {\n\t \n\tunsigned int\t\tflags;\t\t \n\tu32\t\t\tmask_port_map;\t \n\n\tvoid __iomem *\t\tmmio;\t\t \n\tu32\t\t\tcap;\t\t \n\tu32\t\t\tcap2;\t\t \n\tu32\t\t\tversion;\t \n\tu32\t\t\tport_map;\t \n\tu32\t\t\tsaved_cap;\t \n\tu32\t\t\tsaved_cap2;\t \n\tu32\t\t\tsaved_port_map;\t \n\tu32\t\t\tsaved_port_cap[AHCI_MAX_PORTS];  \n\tu32 \t\t\tem_loc;  \n\tu32\t\t\tem_buf_sz;\t \n\tu32\t\t\tem_msg_type;\t \n\tu32\t\t\tremapped_nvme;\t \n\tbool\t\t\tgot_runtime_pm;  \n\tunsigned int\t\tn_clks;\n\tstruct clk_bulk_data\t*clks;\t\t \n\tunsigned int\t\tf_rsts;\n\tstruct reset_control\t*rsts;\t\t \n\tstruct regulator\t**target_pwrs;\t \n\tstruct regulator\t*ahci_regulator; \n\tstruct regulator\t*phy_regulator; \n\t \n\tstruct phy\t\t**phys;\n\tunsigned\t\tnports;\t\t \n\tvoid\t\t\t*plat_data;\t \n\tunsigned int\t\tirq;\t\t \n\t \n\tvoid\t\t\t(*start_engine)(struct ata_port *ap);\n\t \n\tint\t\t\t(*stop_engine)(struct ata_port *ap);\n\n\tirqreturn_t \t\t(*irq_handler)(int irq, void *dev_instance);\n\n\t \n\tint\t\t\t(*get_irq_vector)(struct ata_host *host,\n\t\t\t\t\t\t  int port);\n};\n\nextern int ahci_ignore_sss;\n\nextern const struct attribute_group *ahci_shost_groups[];\nextern const struct attribute_group *ahci_sdev_groups[];\n\n \n#define AHCI_SHT(drv_name)\t\t\t\t\t\t\\\n\t__ATA_BASE_SHT(drv_name),\t\t\t\t\t\\\n\t.can_queue\t\t= AHCI_MAX_CMDS,\t\t\t\\\n\t.sg_tablesize\t\t= AHCI_MAX_SG,\t\t\t\t\\\n\t.dma_boundary\t\t= AHCI_DMA_BOUNDARY,\t\t\t\\\n\t.shost_groups\t\t= ahci_shost_groups,\t\t\t\\\n\t.sdev_groups\t\t= ahci_sdev_groups,\t\t\t\\\n\t.change_queue_depth     = ata_scsi_change_queue_depth,\t\t\\\n\t.tag_alloc_policy       = BLK_TAG_ALLOC_RR,             \t\\\n\t.slave_configure        = ata_scsi_slave_config\n\nextern struct ata_port_operations ahci_ops;\nextern struct ata_port_operations ahci_platform_ops;\nextern struct ata_port_operations ahci_pmp_retry_srst_ops;\n\nunsigned int ahci_dev_classify(struct ata_port *ap);\nvoid ahci_fill_cmd_slot(struct ahci_port_priv *pp, unsigned int tag,\n\t\t\tu32 opts);\nvoid ahci_save_initial_config(struct device *dev,\n\t\t\t      struct ahci_host_priv *hpriv);\nvoid ahci_init_controller(struct ata_host *host);\nint ahci_reset_controller(struct ata_host *host);\n\nint ahci_do_softreset(struct ata_link *link, unsigned int *class,\n\t\t      int pmp, unsigned long deadline,\n\t\t      int (*check_ready)(struct ata_link *link));\n\nint ahci_do_hardreset(struct ata_link *link, unsigned int *class,\n\t\t      unsigned long deadline, bool *online);\n\nunsigned int ahci_qc_issue(struct ata_queued_cmd *qc);\nint ahci_stop_engine(struct ata_port *ap);\nvoid ahci_start_fis_rx(struct ata_port *ap);\nvoid ahci_start_engine(struct ata_port *ap);\nint ahci_check_ready(struct ata_link *link);\nint ahci_kick_engine(struct ata_port *ap);\nint ahci_port_resume(struct ata_port *ap);\nvoid ahci_set_em_messages(struct ahci_host_priv *hpriv,\n\t\t\t  struct ata_port_info *pi);\nint ahci_reset_em(struct ata_host *host);\nvoid ahci_print_info(struct ata_host *host, const char *scc_s);\nint ahci_host_activate(struct ata_host *host, const struct scsi_host_template *sht);\nvoid ahci_error_handler(struct ata_port *ap);\nu32 ahci_handle_port_intr(struct ata_host *host, u32 irq_masked);\n\nstatic inline void __iomem *__ahci_port_base(struct ahci_host_priv *hpriv,\n\t\t\t\t\t     unsigned int port_no)\n{\n\tvoid __iomem *mmio = hpriv->mmio;\n\n\treturn mmio + 0x100 + (port_no * 0x80);\n}\n\nstatic inline void __iomem *ahci_port_base(struct ata_port *ap)\n{\n\tstruct ahci_host_priv *hpriv = ap->host->private_data;\n\n\treturn __ahci_port_base(hpriv, ap->port_no);\n}\n\nstatic inline int ahci_nr_ports(u32 cap)\n{\n\treturn (cap & 0x1f) + 1;\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}