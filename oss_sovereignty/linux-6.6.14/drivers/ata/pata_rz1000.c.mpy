{
  "module_name": "pata_rz1000.c",
  "hash_id": "0778d1438439721ecb865d710f5f44d9d21f31c99ae472e4da6f1b2d13fa0842",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ata/pata_rz1000.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/blkdev.h>\n#include <linux/delay.h>\n#include <scsi/scsi_host.h>\n#include <linux/libata.h>\n\n#define DRV_NAME\t\"pata_rz1000\"\n#define DRV_VERSION\t\"0.2.4\"\n\n\n \n\nstatic int rz1000_set_mode(struct ata_link *link, struct ata_device **unused)\n{\n\tstruct ata_device *dev;\n\n\tata_for_each_dev(dev, link, ENABLED) {\n\t\t \n\t\tdev->pio_mode = XFER_PIO_0;\n\t\tdev->xfer_mode = XFER_PIO_0;\n\t\tdev->xfer_shift = ATA_SHIFT_PIO;\n\t\tdev->flags |= ATA_DFLAG_PIO;\n\t\tata_dev_info(dev, \"configured for PIO\\n\");\n\t}\n\treturn 0;\n}\n\n\nstatic const struct scsi_host_template rz1000_sht = {\n\tATA_PIO_SHT(DRV_NAME),\n};\n\nstatic struct ata_port_operations rz1000_port_ops = {\n\t.inherits\t= &ata_sff_port_ops,\n\t.cable_detect\t= ata_cable_40wire,\n\t.set_mode\t= rz1000_set_mode,\n};\n\nstatic int rz1000_fifo_disable(struct pci_dev *pdev)\n{\n\tu16 reg;\n\t \n\tif (pci_read_config_word(pdev, 0x40, &reg) != 0)\n\t\treturn -1;\n\treg &= 0xDFFF;\n\tif (pci_write_config_word(pdev, 0x40, reg) != 0)\n\t\treturn -1;\n\tdev_info(&pdev->dev, \"disabled chipset readahead.\\n\");\n\treturn 0;\n}\n\n \n\nstatic int rz1000_init_one (struct pci_dev *pdev, const struct pci_device_id *ent)\n{\n\tstatic const struct ata_port_info info = {\n\t\t.flags = ATA_FLAG_SLAVE_POSS,\n\t\t.pio_mask = ATA_PIO4,\n\t\t.port_ops = &rz1000_port_ops\n\t};\n\tconst struct ata_port_info *ppi[] = { &info, NULL };\n\n\tata_print_version_once(&pdev->dev, DRV_VERSION);\n\n\tif (rz1000_fifo_disable(pdev) == 0)\n\t\treturn ata_pci_sff_init_one(pdev, ppi, &rz1000_sht, NULL, 0);\n\n\tdev_err(&pdev->dev, \"failed to disable read-ahead on chipset.\\n\");\n\t \n\treturn -ENODEV;\n}\n\n#ifdef CONFIG_PM_SLEEP\nstatic int rz1000_reinit_one(struct pci_dev *pdev)\n{\n\tstruct ata_host *host = pci_get_drvdata(pdev);\n\tint rc;\n\n\trc = ata_pci_device_do_resume(pdev);\n\tif (rc)\n\t\treturn rc;\n\n\t \n\tif (rz1000_fifo_disable(pdev))\n\t\tpanic(\"rz1000 fifo\");\n\n\tata_host_resume(host);\n\treturn 0;\n}\n#endif\n\nstatic const struct pci_device_id pata_rz1000[] = {\n\t{ PCI_VDEVICE(PCTECH, PCI_DEVICE_ID_PCTECH_RZ1000), },\n\t{ PCI_VDEVICE(PCTECH, PCI_DEVICE_ID_PCTECH_RZ1001), },\n\n\t{ },\n};\n\nstatic struct pci_driver rz1000_pci_driver = {\n\t.name \t\t= DRV_NAME,\n\t.id_table\t= pata_rz1000,\n\t.probe \t\t= rz1000_init_one,\n\t.remove\t\t= ata_pci_remove_one,\n#ifdef CONFIG_PM_SLEEP\n\t.suspend\t= ata_pci_device_suspend,\n\t.resume\t\t= rz1000_reinit_one,\n#endif\n};\n\nmodule_pci_driver(rz1000_pci_driver);\n\nMODULE_AUTHOR(\"Alan Cox\");\nMODULE_DESCRIPTION(\"low-level driver for RZ1000 PCI ATA\");\nMODULE_LICENSE(\"GPL\");\nMODULE_DEVICE_TABLE(pci, pata_rz1000);\nMODULE_VERSION(DRV_VERSION);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}