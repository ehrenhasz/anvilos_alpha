{
  "module_name": "ppc_cbe_cpufreq_pervasive.c",
  "hash_id": "df2bd0231a6a82443b7496c998ac6376ec990535bb382bf3aac27a71165c58ba",
  "original_prompt": "Ingested from linux-6.6.14/drivers/cpufreq/ppc_cbe_cpufreq_pervasive.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/kernel.h>\n#include <linux/time.h>\n#include <asm/machdep.h>\n#include <asm/hw_irq.h>\n#include <asm/cell-regs.h>\n\n#include \"ppc_cbe_cpufreq.h\"\n\n \nstatic u64 MIC_Slow_Fast_Timer_table[] = {\n\t[0 ... 7] = 0x007fc00000000000ull,\n};\n\n \nstatic u64 MIC_Slow_Next_Timer_table[] = {\n\t0x0000240000000000ull,\n\t0x0000268000000000ull,\n\t0x000029C000000000ull,\n\t0x00002D0000000000ull,\n\t0x0000300000000000ull,\n\t0x0000334000000000ull,\n\t0x000039C000000000ull,\n\t0x00003FC000000000ull,\n};\n\n\nint cbe_cpufreq_set_pmode(int cpu, unsigned int pmode)\n{\n\tstruct cbe_pmd_regs __iomem *pmd_regs;\n\tstruct cbe_mic_tm_regs __iomem *mic_tm_regs;\n\tunsigned long flags;\n\tu64 value;\n#ifdef DEBUG\n\tlong time;\n#endif\n\n\tlocal_irq_save(flags);\n\n\tmic_tm_regs = cbe_get_cpu_mic_tm_regs(cpu);\n\tpmd_regs = cbe_get_cpu_pmd_regs(cpu);\n\n#ifdef DEBUG\n\ttime = jiffies;\n#endif\n\n\tout_be64(&mic_tm_regs->slow_fast_timer_0, MIC_Slow_Fast_Timer_table[pmode]);\n\tout_be64(&mic_tm_regs->slow_fast_timer_1, MIC_Slow_Fast_Timer_table[pmode]);\n\n\tout_be64(&mic_tm_regs->slow_next_timer_0, MIC_Slow_Next_Timer_table[pmode]);\n\tout_be64(&mic_tm_regs->slow_next_timer_1, MIC_Slow_Next_Timer_table[pmode]);\n\n\tvalue = in_be64(&pmd_regs->pmcr);\n\t \n\tvalue &= 0xFFFFFFFFFFFFFFF8ull;\n\t \n\tvalue |= pmode;\n\n\tout_be64(&pmd_regs->pmcr, value);\n\n#ifdef DEBUG\n\t \n\tvalue = in_be64(&pmd_regs->pmsr) & 0x07;\n\twhile (value != pmode) {\n\t\tcpu_relax();\n\t\tvalue = in_be64(&pmd_regs->pmsr) & 0x07;\n\t}\n\n\ttime = jiffies  - time;\n\ttime = jiffies_to_msecs(time);\n\tpr_debug(\"had to wait %lu ms for a transition using \" \\\n\t\t \"pervasive unit\\n\", time);\n#endif\n\tlocal_irq_restore(flags);\n\n\treturn 0;\n}\n\n\nint cbe_cpufreq_get_pmode(int cpu)\n{\n\tint ret;\n\tstruct cbe_pmd_regs __iomem *pmd_regs;\n\n\tpmd_regs = cbe_get_cpu_pmd_regs(cpu);\n\tret = in_be64(&pmd_regs->pmsr) & 0x07;\n\n\treturn ret;\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}