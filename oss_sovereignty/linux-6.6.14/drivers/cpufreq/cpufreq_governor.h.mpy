{
  "module_name": "cpufreq_governor.h",
  "hash_id": "ddafc9867086ae72e796b66fcfb09669bdec7a16be93d9e70301d349aabdf182",
  "original_prompt": "Ingested from linux-6.6.14/drivers/cpufreq/cpufreq_governor.h",
  "human_readable_source": " \n \n\n#ifndef _CPUFREQ_GOVERNOR_H\n#define _CPUFREQ_GOVERNOR_H\n\n#include <linux/atomic.h>\n#include <linux/irq_work.h>\n#include <linux/cpufreq.h>\n#include <linux/sched/cpufreq.h>\n#include <linux/kernel_stat.h>\n#include <linux/module.h>\n#include <linux/mutex.h>\n\n \nenum {OD_NORMAL_SAMPLE, OD_SUB_SAMPLE};\n\n \n\n \nstruct dbs_data {\n\tstruct gov_attr_set attr_set;\n\tstruct dbs_governor *gov;\n\tvoid *tuners;\n\tunsigned int ignore_nice_load;\n\tunsigned int sampling_rate;\n\tunsigned int sampling_down_factor;\n\tunsigned int up_threshold;\n\tunsigned int io_is_busy;\n};\n\nstatic inline struct dbs_data *to_dbs_data(struct gov_attr_set *attr_set)\n{\n\treturn container_of(attr_set, struct dbs_data, attr_set);\n}\n\n#define gov_show_one(_gov, file_name)\t\t\t\t\t\\\nstatic ssize_t file_name##_show\t\t\t\t\t\t\\\n(struct gov_attr_set *attr_set, char *buf)\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tstruct dbs_data *dbs_data = to_dbs_data(attr_set);\t\t\\\n\tstruct _gov##_dbs_tuners *tuners = dbs_data->tuners;\t\t\\\n\treturn sprintf(buf, \"%u\\n\", tuners->file_name);\t\t\t\\\n}\n\n#define gov_show_one_common(file_name)\t\t\t\t\t\\\nstatic ssize_t file_name##_show\t\t\t\t\t\t\\\n(struct gov_attr_set *attr_set, char *buf)\t\t\t\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\tstruct dbs_data *dbs_data = to_dbs_data(attr_set);\t\t\\\n\treturn sprintf(buf, \"%u\\n\", dbs_data->file_name);\t\t\\\n}\n\n#define gov_attr_ro(_name)\t\t\t\t\t\t\\\nstatic struct governor_attr _name = __ATTR_RO(_name)\n\n#define gov_attr_rw(_name)\t\t\t\t\t\t\\\nstatic struct governor_attr _name = __ATTR_RW(_name)\n\n \nstruct policy_dbs_info {\n\tstruct cpufreq_policy *policy;\n\t \n\tstruct mutex update_mutex;\n\n\tu64 last_sample_time;\n\ts64 sample_delay_ns;\n\tatomic_t work_count;\n\tstruct irq_work irq_work;\n\tstruct work_struct work;\n\t \n\tstruct dbs_data *dbs_data;\n\tstruct list_head list;\n\t \n\tunsigned int rate_mult;\n\tunsigned int idle_periods;\t \n\t \n\tbool is_shared;\t\t \n\tbool work_in_progress;\t \n};\n\nstatic inline void gov_update_sample_delay(struct policy_dbs_info *policy_dbs,\n\t\t\t\t\t   unsigned int delay_us)\n{\n\tpolicy_dbs->sample_delay_ns = delay_us * NSEC_PER_USEC;\n}\n\n \nstruct cpu_dbs_info {\n\tu64 prev_cpu_idle;\n\tu64 prev_update_time;\n\tu64 prev_cpu_nice;\n\t \n\tunsigned int prev_load;\n\tstruct update_util_data update_util;\n\tstruct policy_dbs_info *policy_dbs;\n};\n\n \nstruct dbs_governor {\n\tstruct cpufreq_governor gov;\n\tstruct kobj_type kobj_type;\n\n\t \n\tstruct dbs_data *gdbs_data;\n\n\tunsigned int (*gov_dbs_update)(struct cpufreq_policy *policy);\n\tstruct policy_dbs_info *(*alloc)(void);\n\tvoid (*free)(struct policy_dbs_info *policy_dbs);\n\tint (*init)(struct dbs_data *dbs_data);\n\tvoid (*exit)(struct dbs_data *dbs_data);\n\tvoid (*start)(struct cpufreq_policy *policy);\n};\n\nstatic inline struct dbs_governor *dbs_governor_of(struct cpufreq_policy *policy)\n{\n\treturn container_of(policy->governor, struct dbs_governor, gov);\n}\n\n \nint cpufreq_dbs_governor_init(struct cpufreq_policy *policy);\nvoid cpufreq_dbs_governor_exit(struct cpufreq_policy *policy);\nint cpufreq_dbs_governor_start(struct cpufreq_policy *policy);\nvoid cpufreq_dbs_governor_stop(struct cpufreq_policy *policy);\nvoid cpufreq_dbs_governor_limits(struct cpufreq_policy *policy);\n\n#define CPUFREQ_DBS_GOVERNOR_INITIALIZER(_name_)\t\t\t\\\n\t{\t\t\t\t\t\t\t\t\\\n\t\t.name = _name_,\t\t\t\t\t\t\\\n\t\t.flags = CPUFREQ_GOV_DYNAMIC_SWITCHING,\t\t\t\\\n\t\t.owner = THIS_MODULE,\t\t\t\t\t\\\n\t\t.init = cpufreq_dbs_governor_init,\t\t\t\\\n\t\t.exit = cpufreq_dbs_governor_exit,\t\t\t\\\n\t\t.start = cpufreq_dbs_governor_start,\t\t\t\\\n\t\t.stop = cpufreq_dbs_governor_stop,\t\t\t\\\n\t\t.limits = cpufreq_dbs_governor_limits,\t\t\t\\\n\t}\n\n \nstruct od_ops {\n\tunsigned int (*powersave_bias_target)(struct cpufreq_policy *policy,\n\t\t\tunsigned int freq_next, unsigned int relation);\n};\n\nunsigned int dbs_update(struct cpufreq_policy *policy);\nvoid od_register_powersave_bias_handler(unsigned int (*f)\n\t\t(struct cpufreq_policy *, unsigned int, unsigned int),\n\t\tunsigned int powersave_bias);\nvoid od_unregister_powersave_bias_handler(void);\nssize_t sampling_rate_store(struct gov_attr_set *attr_set, const char *buf,\n\t\t\t    size_t count);\nvoid gov_update_cpu_data(struct dbs_data *dbs_data);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}