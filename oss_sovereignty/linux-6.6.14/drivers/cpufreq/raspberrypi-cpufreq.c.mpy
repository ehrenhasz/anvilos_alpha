{
  "module_name": "raspberrypi-cpufreq.c",
  "hash_id": "0639a1fdd1224924d45e7ee268ae1b0077df633f11b209401bc8320daa9fdbbb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/cpufreq/raspberrypi-cpufreq.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/cpu.h>\n#include <linux/cpufreq.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/pm_opp.h>\n\n#define RASPBERRYPI_FREQ_INTERVAL\t100000000\n\nstatic struct platform_device *cpufreq_dt;\n\nstatic int raspberrypi_cpufreq_probe(struct platform_device *pdev)\n{\n\tstruct device *cpu_dev;\n\tunsigned long min, max;\n\tunsigned long rate;\n\tstruct clk *clk;\n\tint ret;\n\n\tcpu_dev = get_cpu_device(0);\n\tif (!cpu_dev) {\n\t\tpr_err(\"Cannot get CPU for cpufreq driver\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tclk = clk_get(cpu_dev, NULL);\n\tif (IS_ERR(clk)) {\n\t\tdev_err(cpu_dev, \"Cannot get clock for CPU0\\n\");\n\t\treturn PTR_ERR(clk);\n\t}\n\n\t \n\tmin = roundup(clk_round_rate(clk, 0), RASPBERRYPI_FREQ_INTERVAL);\n\tmax = roundup(clk_round_rate(clk, ULONG_MAX), RASPBERRYPI_FREQ_INTERVAL);\n\tclk_put(clk);\n\n\tfor (rate = min; rate <= max; rate += RASPBERRYPI_FREQ_INTERVAL) {\n\t\tret = dev_pm_opp_add(cpu_dev, rate, 0);\n\t\tif (ret)\n\t\t\tgoto remove_opp;\n\t}\n\n\tcpufreq_dt = platform_device_register_simple(\"cpufreq-dt\", -1, NULL, 0);\n\tret = PTR_ERR_OR_ZERO(cpufreq_dt);\n\tif (ret) {\n\t\tdev_err(cpu_dev, \"Failed to create platform device, %d\\n\", ret);\n\t\tgoto remove_opp;\n\t}\n\n\treturn 0;\n\nremove_opp:\n\tdev_pm_opp_remove_all_dynamic(cpu_dev);\n\n\treturn ret;\n}\n\nstatic void raspberrypi_cpufreq_remove(struct platform_device *pdev)\n{\n\tstruct device *cpu_dev;\n\n\tcpu_dev = get_cpu_device(0);\n\tif (cpu_dev)\n\t\tdev_pm_opp_remove_all_dynamic(cpu_dev);\n\n\tplatform_device_unregister(cpufreq_dt);\n}\n\n \nstatic struct platform_driver raspberrypi_cpufreq_driver = {\n\t.driver = {\n\t\t.name = \"raspberrypi-cpufreq\",\n\t},\n\t.probe          = raspberrypi_cpufreq_probe,\n\t.remove_new\t= raspberrypi_cpufreq_remove,\n};\nmodule_platform_driver(raspberrypi_cpufreq_driver);\n\nMODULE_AUTHOR(\"Nicolas Saenz Julienne <nsaenzjulienne@suse.de\");\nMODULE_DESCRIPTION(\"Raspberry Pi cpufreq driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:raspberrypi-cpufreq\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}