{
  "module_name": "tegra20-cpufreq.c",
  "hash_id": "215044dd94a50b8c9a832433058f3b6efc8f092ef97694388b756eb826316f10",
  "original_prompt": "Ingested from linux-6.6.14/drivers/cpufreq/tegra20-cpufreq.c",
  "human_readable_source": "\n \n\n#include <linux/bits.h>\n#include <linux/cpu.h>\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm_opp.h>\n#include <linux/types.h>\n\n#include <soc/tegra/common.h>\n#include <soc/tegra/fuse.h>\n\nstatic bool cpu0_node_has_opp_v2_prop(void)\n{\n\tstruct device_node *np = of_cpu_device_node_get(0);\n\tbool ret = false;\n\n\tif (of_property_present(np, \"operating-points-v2\"))\n\t\tret = true;\n\n\tof_node_put(np);\n\treturn ret;\n}\n\nstatic void tegra20_cpufreq_put_supported_hw(void *opp_token)\n{\n\tdev_pm_opp_put_supported_hw((unsigned long) opp_token);\n}\n\nstatic void tegra20_cpufreq_dt_unregister(void *cpufreq_dt)\n{\n\tplatform_device_unregister(cpufreq_dt);\n}\n\nstatic int tegra20_cpufreq_probe(struct platform_device *pdev)\n{\n\tstruct platform_device *cpufreq_dt;\n\tstruct device *cpu_dev;\n\tu32 versions[2];\n\tint err;\n\n\tif (!cpu0_node_has_opp_v2_prop()) {\n\t\tdev_err(&pdev->dev, \"operating points not found\\n\");\n\t\tdev_err(&pdev->dev, \"please update your device tree\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tif (of_machine_is_compatible(\"nvidia,tegra20\")) {\n\t\tversions[0] = BIT(tegra_sku_info.cpu_process_id);\n\t\tversions[1] = BIT(tegra_sku_info.soc_speedo_id);\n\t} else {\n\t\tversions[0] = BIT(tegra_sku_info.cpu_process_id);\n\t\tversions[1] = BIT(tegra_sku_info.cpu_speedo_id);\n\t}\n\n\tdev_info(&pdev->dev, \"hardware version 0x%x 0x%x\\n\",\n\t\t versions[0], versions[1]);\n\n\tcpu_dev = get_cpu_device(0);\n\tif (WARN_ON(!cpu_dev))\n\t\treturn -ENODEV;\n\n\terr = dev_pm_opp_set_supported_hw(cpu_dev, versions, 2);\n\tif (err < 0) {\n\t\tdev_err(&pdev->dev, \"failed to set supported hw: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\terr = devm_add_action_or_reset(&pdev->dev,\n\t\t\t\t       tegra20_cpufreq_put_supported_hw,\n\t\t\t\t       (void *)((unsigned long) err));\n\tif (err)\n\t\treturn err;\n\n\tcpufreq_dt = platform_device_register_simple(\"cpufreq-dt\", -1, NULL, 0);\n\terr = PTR_ERR_OR_ZERO(cpufreq_dt);\n\tif (err) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"failed to create cpufreq-dt device: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\terr = devm_add_action_or_reset(&pdev->dev,\n\t\t\t\t       tegra20_cpufreq_dt_unregister,\n\t\t\t\t       cpufreq_dt);\n\tif (err)\n\t\treturn err;\n\n\treturn 0;\n}\n\nstatic struct platform_driver tegra20_cpufreq_driver = {\n\t.probe\t\t= tegra20_cpufreq_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"tegra20-cpufreq\",\n\t},\n};\nmodule_platform_driver(tegra20_cpufreq_driver);\n\nMODULE_ALIAS(\"platform:tegra20-cpufreq\");\nMODULE_AUTHOR(\"Colin Cross <ccross@android.com>\");\nMODULE_DESCRIPTION(\"NVIDIA Tegra20 cpufreq driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}