{
  "module_name": "tc-dwc-g210-pci.c",
  "hash_id": "13573a1d1050d0e685e9dd26b026d35f9e48fd88ae5f8142e45ad0b801bda451",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ufs/host/tc-dwc-g210-pci.c",
  "human_readable_source": "\n \n\n#include <ufs/ufshcd.h>\n#include \"ufshcd-dwc.h\"\n#include \"tc-dwc-g210.h\"\n\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/pm_runtime.h>\n\n \n#define TC_G210_20BIT 20\n#define TC_G210_40BIT 40\n#define TC_G210_INV 0\n\nstatic int tc_type = TC_G210_INV;\nmodule_param(tc_type, int, 0);\nMODULE_PARM_DESC(tc_type, \"Test Chip Type (20 = 20-bit, 40 = 40-bit)\");\n\n \nstatic struct ufs_hba_variant_ops tc_dwc_g210_pci_hba_vops = {\n\t.name                   = \"tc-dwc-g210-pci\",\n\t.link_startup_notify\t= ufshcd_dwc_link_startup_notify,\n};\n\n \nstatic void tc_dwc_g210_pci_remove(struct pci_dev *pdev)\n{\n\tstruct ufs_hba *hba = pci_get_drvdata(pdev);\n\n\tpm_runtime_forbid(&pdev->dev);\n\tpm_runtime_get_noresume(&pdev->dev);\n\tufshcd_remove(hba);\n}\n\n \nstatic int\ntc_dwc_g210_pci_probe(struct pci_dev *pdev, const struct pci_device_id *id)\n{\n\tstruct ufs_hba *hba;\n\tvoid __iomem *mmio_base;\n\tint err;\n\n\t \n\tif (tc_type == TC_G210_20BIT) {\n\t\ttc_dwc_g210_pci_hba_vops.phy_initialization =\n\t\t\t\t\t\ttc_dwc_g210_config_20_bit;\n\t} else if (tc_type == TC_G210_40BIT) {\n\t\ttc_dwc_g210_pci_hba_vops.phy_initialization =\n\t\t\t\t\t\ttc_dwc_g210_config_40_bit;\n\t} else {\n\t\tdev_err(&pdev->dev, \"test chip version not specified\\n\");\n\t\treturn -EPERM;\n\t}\n\n\terr = pcim_enable_device(pdev);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"pcim_enable_device failed\\n\");\n\t\treturn err;\n\t}\n\n\tpci_set_master(pdev);\n\n\terr = pcim_iomap_regions(pdev, 1 << 0, UFSHCD);\n\tif (err < 0) {\n\t\tdev_err(&pdev->dev, \"request and iomap failed\\n\");\n\t\treturn err;\n\t}\n\n\tmmio_base = pcim_iomap_table(pdev)[0];\n\n\terr = ufshcd_alloc_host(&pdev->dev, &hba);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"Allocation failed\\n\");\n\t\treturn err;\n\t}\n\n\thba->vops = &tc_dwc_g210_pci_hba_vops;\n\n\terr = ufshcd_init(hba, mmio_base, pdev->irq);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"Initialization failed\\n\");\n\t\treturn err;\n\t}\n\n\tpm_runtime_put_noidle(&pdev->dev);\n\tpm_runtime_allow(&pdev->dev);\n\n\treturn 0;\n}\n\nstatic const struct dev_pm_ops tc_dwc_g210_pci_pm_ops = {\n\tSET_SYSTEM_SLEEP_PM_OPS(ufshcd_system_suspend, ufshcd_system_resume)\n\tSET_RUNTIME_PM_OPS(ufshcd_runtime_suspend, ufshcd_runtime_resume, NULL)\n\t.prepare\t = ufshcd_suspend_prepare,\n\t.complete\t = ufshcd_resume_complete,\n};\n\nstatic const struct pci_device_id tc_dwc_g210_pci_tbl[] = {\n\t{ PCI_VENDOR_ID_SYNOPSYS, 0xB101, PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0 },\n\t{ PCI_VENDOR_ID_SYNOPSYS, 0xB102, PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0 },\n\t{ }\t \n};\n\nMODULE_DEVICE_TABLE(pci, tc_dwc_g210_pci_tbl);\n\nstatic struct pci_driver tc_dwc_g210_pci_driver = {\n\t.name = \"tc-dwc-g210-pci\",\n\t.id_table = tc_dwc_g210_pci_tbl,\n\t.probe = tc_dwc_g210_pci_probe,\n\t.remove = tc_dwc_g210_pci_remove,\n\t.driver = {\n\t\t.pm = &tc_dwc_g210_pci_pm_ops\n\t},\n};\n\nmodule_pci_driver(tc_dwc_g210_pci_driver);\n\nMODULE_AUTHOR(\"Joao Pinto <Joao.Pinto@synopsys.com>\");\nMODULE_DESCRIPTION(\"Synopsys Test Chip G210 PCI glue driver\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}