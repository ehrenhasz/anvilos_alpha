{
  "module_name": "ufs-fault-injection.c",
  "hash_id": "2413321cda92c1e6f43f543c9c218f54025cfd99d5dfb4965f328d86fe9eb5c6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ufs/core/ufs-fault-injection.c",
  "human_readable_source": "\n\n#include <linux/kconfig.h>\n#include <linux/types.h>\n#include <linux/fault-inject.h>\n#include <linux/module.h>\n#include \"ufs-fault-injection.h\"\n\nstatic int ufs_fault_get(char *buffer, const struct kernel_param *kp);\nstatic int ufs_fault_set(const char *val, const struct kernel_param *kp);\n\nstatic const struct kernel_param_ops ufs_fault_ops = {\n\t.get = ufs_fault_get,\n\t.set = ufs_fault_set,\n};\n\nenum { FAULT_INJ_STR_SIZE = 80 };\n\n \nstatic char g_trigger_eh_str[FAULT_INJ_STR_SIZE];\nmodule_param_cb(trigger_eh, &ufs_fault_ops, g_trigger_eh_str, 0644);\nMODULE_PARM_DESC(trigger_eh,\n\t\"Fault injection. trigger_eh=<interval>,<probability>,<space>,<times>\");\nstatic DECLARE_FAULT_ATTR(ufs_trigger_eh_attr);\n\nstatic char g_timeout_str[FAULT_INJ_STR_SIZE];\nmodule_param_cb(timeout, &ufs_fault_ops, g_timeout_str, 0644);\nMODULE_PARM_DESC(timeout,\n\t\"Fault injection. timeout=<interval>,<probability>,<space>,<times>\");\nstatic DECLARE_FAULT_ATTR(ufs_timeout_attr);\n\nstatic int ufs_fault_get(char *buffer, const struct kernel_param *kp)\n{\n\tconst char *fault_str = kp->arg;\n\n\treturn sysfs_emit(buffer, \"%s\\n\", fault_str);\n}\n\nstatic int ufs_fault_set(const char *val, const struct kernel_param *kp)\n{\n\tstruct fault_attr *attr = NULL;\n\n\tif (kp->arg == g_trigger_eh_str)\n\t\tattr = &ufs_trigger_eh_attr;\n\telse if (kp->arg == g_timeout_str)\n\t\tattr = &ufs_timeout_attr;\n\n\tif (WARN_ON_ONCE(!attr))\n\t\treturn -EINVAL;\n\n\tif (!setup_fault_attr(attr, (char *)val))\n\t\treturn -EINVAL;\n\n\tstrscpy(kp->arg, val, FAULT_INJ_STR_SIZE);\n\n\treturn 0;\n}\n\nbool ufs_trigger_eh(void)\n{\n\treturn should_fail(&ufs_trigger_eh_attr, 1);\n}\n\nbool ufs_fail_completion(void)\n{\n\treturn should_fail(&ufs_timeout_attr, 1);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}