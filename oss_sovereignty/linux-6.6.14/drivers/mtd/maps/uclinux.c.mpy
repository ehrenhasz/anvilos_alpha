{
  "module_name": "uclinux.c",
  "hash_id": "2eda10d0d887b2fecf3b4af13b4f9eba7f0331c04573821a4f5c27cafe4e6db9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/maps/uclinux.c",
  "human_readable_source": " \n\n \n\n \n\n#include <linux/moduleparam.h>\n#include <linux/types.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/fs.h>\n#include <linux/mm.h>\n#include <linux/major.h>\n#include <linux/mtd/mtd.h>\n#include <linux/mtd/map.h>\n#include <linux/mtd/partitions.h>\n#include <asm/io.h>\n#include <asm/sections.h>\n\n \n\n#ifdef CONFIG_MTD_ROM\n#define MAP_NAME \"rom\"\n#else\n#define MAP_NAME \"ram\"\n#endif\n\nstatic struct map_info uclinux_ram_map = {\n\t.name = MAP_NAME,\n\t.size = 0,\n};\n\nstatic unsigned long physaddr = -1;\nmodule_param(physaddr, ulong, S_IRUGO);\n\nstatic struct mtd_info *uclinux_ram_mtdinfo;\n\n \n\nstatic const struct mtd_partition uclinux_romfs[] = {\n\t{ .name = \"ROMfs\" }\n};\n\n#define\tNUM_PARTITIONS\tARRAY_SIZE(uclinux_romfs)\n\n \n\nstatic int uclinux_point(struct mtd_info *mtd, loff_t from, size_t len,\n\tsize_t *retlen, void **virt, resource_size_t *phys)\n{\n\tstruct map_info *map = mtd->priv;\n\t*virt = map->virt + from;\n\tif (phys)\n\t\t*phys = map->phys + from;\n\t*retlen = len;\n\treturn(0);\n}\n\n \n\nstatic int __init uclinux_mtd_init(void)\n{\n\tstruct mtd_info *mtd;\n\tstruct map_info *mapp;\n\n\tmapp = &uclinux_ram_map;\n\n\tif (physaddr == -1)\n\t\tmapp->phys = (resource_size_t)__bss_stop;\n\telse\n\t\tmapp->phys = physaddr;\n\n\tif (!mapp->size)\n\t\tmapp->size = PAGE_ALIGN(ntohl(*((unsigned long *)(mapp->phys + 8))));\n\tmapp->bankwidth = 4;\n\n\tprintk(\"uclinux[mtd]: probe address=0x%x size=0x%x\\n\",\n\t       \t(int) mapp->phys, (int) mapp->size);\n\n\t \n\tmapp->virt = phys_to_virt(mapp->phys);\n\n\tif (mapp->virt == 0) {\n\t\tprintk(\"uclinux[mtd]: no virtual mapping?\\n\");\n\t\treturn(-EIO);\n\t}\n\n\tsimple_map_init(mapp);\n\n\tmtd = do_map_probe(\"map_\" MAP_NAME, mapp);\n\tif (!mtd) {\n\t\tprintk(\"uclinux[mtd]: failed to find a mapping?\\n\");\n\t\treturn(-ENXIO);\n\t}\n\n\tmtd->owner = THIS_MODULE;\n\tmtd->_point = uclinux_point;\n\tmtd->priv = mapp;\n\n\tuclinux_ram_mtdinfo = mtd;\n\tmtd_device_register(mtd, uclinux_romfs, NUM_PARTITIONS);\n\n\treturn(0);\n}\ndevice_initcall(uclinux_mtd_init);\n\n \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}