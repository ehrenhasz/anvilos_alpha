{
  "module_name": "ts5500_flash.c",
  "hash_id": "d0d3c931042829c7f0b24816cf64d6fcaa9a3db30347800639abc4c2537ec637",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/maps/ts5500_flash.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/mtd/map.h>\n#include <linux/mtd/mtd.h>\n#include <linux/mtd/partitions.h>\n#include <linux/types.h>\n\n\n#define WINDOW_ADDR\t0x09400000\n#define WINDOW_SIZE\t0x00200000\n\nstatic struct map_info ts5500_map = {\n\t.name = \"TS-5500 Flash\",\n\t.size = WINDOW_SIZE,\n\t.bankwidth = 1,\n\t.phys = WINDOW_ADDR\n};\n\nstatic const struct mtd_partition ts5500_partitions[] = {\n\t{\n\t\t.name = \"Drive A\",\n\t\t.offset = 0,\n\t\t.size = 0x0e0000\n\t},\n\t{\n\t\t.name = \"BIOS\",\n\t\t.offset = 0x0e0000,\n\t\t.size = 0x020000,\n\t},\n\t{\n\t\t.name = \"Drive B\",\n\t\t.offset = 0x100000,\n\t\t.size = 0x100000\n\t}\n};\n\n#define NUM_PARTITIONS ARRAY_SIZE(ts5500_partitions)\n\nstatic struct mtd_info *mymtd;\n\nstatic int __init init_ts5500_map(void)\n{\n\tint rc = 0;\n\n\tts5500_map.virt = ioremap(ts5500_map.phys, ts5500_map.size);\n\n\tif (!ts5500_map.virt) {\n\t\tprintk(KERN_ERR \"Failed to ioremap\\n\");\n\t\trc = -EIO;\n\t\tgoto err2;\n\t}\n\n\tsimple_map_init(&ts5500_map);\n\n\tmymtd = do_map_probe(\"jedec_probe\", &ts5500_map);\n\tif (!mymtd)\n\t\tmymtd = do_map_probe(\"map_rom\", &ts5500_map);\n\n\tif (!mymtd) {\n\t\trc = -ENXIO;\n\t\tgoto err1;\n\t}\n\n\tmymtd->owner = THIS_MODULE;\n\tmtd_device_register(mymtd, ts5500_partitions, NUM_PARTITIONS);\n\n\treturn 0;\n\nerr1:\n\tiounmap(ts5500_map.virt);\nerr2:\n\treturn rc;\n}\n\nstatic void __exit cleanup_ts5500_map(void)\n{\n\tif (mymtd) {\n\t\tmtd_device_unregister(mymtd);\n\t\tmap_destroy(mymtd);\n\t}\n\n\tif (ts5500_map.virt) {\n\t\tiounmap(ts5500_map.virt);\n\t\tts5500_map.virt = NULL;\n\t}\n}\n\nmodule_init(init_ts5500_map);\nmodule_exit(cleanup_ts5500_map);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Sean Young <sean@mess.org>\");\nMODULE_DESCRIPTION(\"MTD map driver for Technology Systems TS-5500 board\");\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}