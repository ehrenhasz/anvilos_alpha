{
  "module_name": "physmap-ixp4xx.c",
  "hash_id": "d2942df22c5dc63cf8f0b21d0ae3354c6b4f9f66f98a6f27eceedfe31fc43561",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/maps/physmap-ixp4xx.c",
  "human_readable_source": "\n \n#include <linux/export.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/mtd/map.h>\n#include <linux/mtd/xip.h>\n#include \"physmap-ixp4xx.h\"\n\n \n#ifndef CONFIG_CPU_BIG_ENDIAN\n\nstatic inline u16 flash_read16(void __iomem *addr)\n{\n\treturn be16_to_cpu(__raw_readw((void __iomem *)((unsigned long)addr ^ 0x2)));\n}\n\nstatic inline void flash_write16(u16 d, void __iomem *addr)\n{\n\t__raw_writew(cpu_to_be16(d), (void __iomem *)((unsigned long)addr ^ 0x2));\n}\n\n#define\tBYTE0(h)\t((h) & 0xFF)\n#define\tBYTE1(h)\t(((h) >> 8) & 0xFF)\n\n#else\n\nstatic inline u16 flash_read16(const void __iomem *addr)\n{\n\treturn __raw_readw(addr);\n}\n\nstatic inline void flash_write16(u16 d, void __iomem *addr)\n{\n\t__raw_writew(d, addr);\n}\n\n#define\tBYTE0(h)\t(((h) >> 8) & 0xFF)\n#define\tBYTE1(h)\t((h) & 0xFF)\n#endif\n\nstatic map_word ixp4xx_read16(struct map_info *map, unsigned long ofs)\n{\n\tmap_word val;\n\n\tval.x[0] = flash_read16(map->virt + ofs);\n\treturn val;\n}\n\n \nstatic void ixp4xx_copy_from(struct map_info *map, void *to,\n\t\t\t     unsigned long from, ssize_t len)\n{\n\tu8 *dest = (u8 *) to;\n\tvoid __iomem *src = map->virt + from;\n\n\tif (len <= 0)\n\t\treturn;\n\n\tif (from & 1) {\n\t\t*dest++ = BYTE1(flash_read16(src-1));\n\t\tsrc++;\n\t\t--len;\n\t}\n\n\twhile (len >= 2) {\n\t\tu16 data = flash_read16(src);\n\t\t*dest++ = BYTE0(data);\n\t\t*dest++ = BYTE1(data);\n\t\tsrc += 2;\n\t\tlen -= 2;\n\t}\n\n\tif (len > 0)\n\t\t*dest++ = BYTE0(flash_read16(src));\n}\n\nstatic void ixp4xx_write16(struct map_info *map, map_word d, unsigned long adr)\n{\n\tflash_write16(d.x[0], map->virt + adr);\n}\n\nint of_flash_probe_ixp4xx(struct platform_device *pdev,\n\t\t\t  struct device_node *np,\n\t\t\t  struct map_info *map)\n{\n\tstruct device *dev = &pdev->dev;\n\n\t \n\tif (!of_device_is_compatible(np, \"intel,ixp4xx-flash\"))\n\t\treturn 0;\n\n\tmap->read = ixp4xx_read16;\n\tmap->write = ixp4xx_write16;\n\tmap->copy_from = ixp4xx_copy_from;\n\tmap->copy_to = NULL;\n\n\tdev_info(dev, \"initialized Intel IXP4xx-specific physmap control\\n\");\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}