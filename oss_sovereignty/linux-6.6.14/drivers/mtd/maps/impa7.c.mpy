{
  "module_name": "impa7.c",
  "hash_id": "fb5fda230a0865c35c841e1fdc31ca03c05038cd3dfd59b8aea66197095d780c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/maps/impa7.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <asm/io.h>\n#include <linux/mtd/mtd.h>\n#include <linux/mtd/map.h>\n#include <linux/mtd/partitions.h>\n\n#define WINDOW_ADDR0 0x00000000       \n#define WINDOW_SIZE0 0x00800000\n#define WINDOW_ADDR1 0x10000000       \n#define WINDOW_SIZE1 0x00800000\n#define NUM_FLASHBANKS 2\n#define BUSWIDTH     4\n\n#define MSG_PREFIX \"impA7:\"    \n#define MTDID      \"impa7-%d\"   \n\nstatic struct mtd_info *impa7_mtd[NUM_FLASHBANKS];\n\nstatic const char * const rom_probe_types[] = { \"jedec_probe\", NULL };\n\nstatic struct map_info impa7_map[NUM_FLASHBANKS] = {\n\t{\n\t\t.name = \"impA7 NOR Flash Bank #0\",\n\t\t.size = WINDOW_SIZE0,\n\t\t.bankwidth = BUSWIDTH,\n\t},\n\t{\n\t\t.name = \"impA7 NOR Flash Bank #1\",\n\t\t.size = WINDOW_SIZE1,\n\t\t.bankwidth = BUSWIDTH,\n\t},\n};\n\n \nstatic const struct mtd_partition partitions[] =\n{\n\t{\n\t\t.name = \"FileSystem\",\n\t\t.size = 0x800000,\n\t\t.offset = 0x00000000\n\t},\n};\n\nstatic int __init init_impa7(void)\n{\n\tconst char * const *type;\n\tint i;\n\tstatic struct { u_long addr; u_long size; } pt[NUM_FLASHBANKS] = {\n\t  { WINDOW_ADDR0, WINDOW_SIZE0 },\n\t  { WINDOW_ADDR1, WINDOW_SIZE1 },\n        };\n\tint devicesfound = 0;\n\n\tfor(i=0; i<NUM_FLASHBANKS; i++)\n\t{\n\t\tprintk(KERN_NOTICE MSG_PREFIX \"probing 0x%08lx at 0x%08lx\\n\",\n\t\t       pt[i].size, pt[i].addr);\n\n\t\timpa7_map[i].phys = pt[i].addr;\n\t\timpa7_map[i].virt = ioremap(pt[i].addr, pt[i].size);\n\t\tif (!impa7_map[i].virt) {\n\t\t\tprintk(MSG_PREFIX \"failed to ioremap\\n\");\n\t\t\treturn -EIO;\n\t\t}\n\t\tsimple_map_init(&impa7_map[i]);\n\n\t\timpa7_mtd[i] = NULL;\n\t\ttype = rom_probe_types;\n\t\tfor(; !impa7_mtd[i] && *type; type++) {\n\t\t\timpa7_mtd[i] = do_map_probe(*type, &impa7_map[i]);\n\t\t}\n\n\t\tif (impa7_mtd[i]) {\n\t\t\timpa7_mtd[i]->owner = THIS_MODULE;\n\t\t\tdevicesfound++;\n\t\t\tmtd_device_register(impa7_mtd[i], partitions,\n\t\t\t\t\t    ARRAY_SIZE(partitions));\n\t\t} else {\n\t\t\tiounmap((void __iomem *)impa7_map[i].virt);\n\t\t}\n\t}\n\treturn devicesfound == 0 ? -ENXIO : 0;\n}\n\nstatic void __exit cleanup_impa7(void)\n{\n\tint i;\n\tfor (i=0; i<NUM_FLASHBANKS; i++) {\n\t\tif (impa7_mtd[i]) {\n\t\t\tmtd_device_unregister(impa7_mtd[i]);\n\t\t\tmap_destroy(impa7_mtd[i]);\n\t\t\tiounmap((void __iomem *)impa7_map[i].virt);\n\t\t\timpa7_map[i].virt = NULL;\n\t\t}\n\t}\n}\n\nmodule_init(init_impa7);\nmodule_exit(cleanup_impa7);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Pavel Bartusek <pba@sysgo.de>\");\nMODULE_DESCRIPTION(\"MTD map driver for implementa impA7\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}