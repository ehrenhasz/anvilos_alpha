{
  "module_name": "cfi_flagadm.c",
  "hash_id": "efc70cd18fb3f44085aa989ad605c2021707deed790125350fc2f612f08857c8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/maps/cfi_flagadm.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <asm/io.h>\n#include <linux/mtd/mtd.h>\n#include <linux/mtd/map.h>\n#include <linux/mtd/partitions.h>\n\n\n \n\n#define FLASH_PHYS_ADDR 0x40000000\n#define FLASH_SIZE 0x400000\n\n#define FLASH_PARTITION0_ADDR 0x00000000\n#define FLASH_PARTITION0_SIZE 0x00020000\n\n#define FLASH_PARTITION1_ADDR 0x00020000\n#define FLASH_PARTITION1_SIZE 0x000A0000\n\n#define FLASH_PARTITION2_ADDR 0x000C0000\n#define FLASH_PARTITION2_SIZE 0x00180000\n\n#define FLASH_PARTITION3_ADDR 0x00240000\n#define FLASH_PARTITION3_SIZE 0x001C0000\n\n\nstatic struct map_info flagadm_map = {\n\t\t.name =\t\t\"FlagaDM flash device\",\n\t\t.size =\t\tFLASH_SIZE,\n\t\t.bankwidth =\t2,\n};\n\nstatic const struct mtd_partition flagadm_parts[] = {\n\t{\n\t\t.name =\t\t\"Bootloader\",\n\t\t.offset\t=\tFLASH_PARTITION0_ADDR,\n\t\t.size =\t\tFLASH_PARTITION0_SIZE\n\t},\n\t{\n\t\t.name =\t\t\"Kernel image\",\n\t\t.offset =\tFLASH_PARTITION1_ADDR,\n\t\t.size =\t\tFLASH_PARTITION1_SIZE\n\t},\n\t{\n\t\t.name =\t\t\"Initial ramdisk image\",\n\t\t.offset =\tFLASH_PARTITION2_ADDR,\n\t\t.size =\t\tFLASH_PARTITION2_SIZE\n\t},\n\t{\n\t\t.name =\t\t\"Persistent storage\",\n\t\t.offset =\tFLASH_PARTITION3_ADDR,\n\t\t.size =\t\tFLASH_PARTITION3_SIZE\n\t}\n};\n\n#define PARTITION_COUNT ARRAY_SIZE(flagadm_parts)\n\nstatic struct mtd_info *mymtd;\n\nstatic int __init init_flagadm(void)\n{\n\tprintk(KERN_NOTICE \"FlagaDM flash device: %x at %x\\n\",\n\t\t\tFLASH_SIZE, FLASH_PHYS_ADDR);\n\n\tflagadm_map.phys = FLASH_PHYS_ADDR;\n\tflagadm_map.virt = ioremap(FLASH_PHYS_ADDR,\n\t\t\t\t\tFLASH_SIZE);\n\n\tif (!flagadm_map.virt) {\n\t\tprintk(\"Failed to ioremap\\n\");\n\t\treturn -EIO;\n\t}\n\n\tsimple_map_init(&flagadm_map);\n\n\tmymtd = do_map_probe(\"cfi_probe\", &flagadm_map);\n\tif (mymtd) {\n\t\tmymtd->owner = THIS_MODULE;\n\t\tmtd_device_register(mymtd, flagadm_parts, PARTITION_COUNT);\n\t\tprintk(KERN_NOTICE \"FlagaDM flash device initialized\\n\");\n\t\treturn 0;\n\t}\n\n\tiounmap((void __iomem *)flagadm_map.virt);\n\treturn -ENXIO;\n}\n\nstatic void __exit cleanup_flagadm(void)\n{\n\tif (mymtd) {\n\t\tmtd_device_unregister(mymtd);\n\t\tmap_destroy(mymtd);\n\t}\n\tif (flagadm_map.virt) {\n\t\tiounmap((void __iomem *)flagadm_map.virt);\n\t\tflagadm_map.virt = NULL;\n\t}\n}\n\nmodule_init(init_flagadm);\nmodule_exit(cleanup_flagadm);\n\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"K\u00e1ri Dav\u00ed\u00f0sson <kd@flaga.is>\");\nMODULE_DESCRIPTION(\"MTD map driver for Flaga digital module\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}