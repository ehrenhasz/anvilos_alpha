{
  "module_name": "mtdblock_ro.c",
  "hash_id": "8867c77ea2d0bf783954c248c754f8d335e8a2a82a9e00e6be4783cde12e5f7a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/mtdblock_ro.c",
  "human_readable_source": "\n \n\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/mtd/mtd.h>\n#include <linux/mtd/blktrans.h>\n#include <linux/module.h>\n#include <linux/major.h>\n\nstatic int mtdblock_readsect(struct mtd_blktrans_dev *dev,\n\t\t\t      unsigned long block, char *buf)\n{\n\tsize_t retlen;\n\tint err;\n\n\terr = mtd_read(dev->mtd, (block * 512), 512, &retlen, buf);\n\tif (err && !mtd_is_bitflip(err))\n\t\treturn 1;\n\treturn 0;\n}\n\nstatic int mtdblock_writesect(struct mtd_blktrans_dev *dev,\n\t\t\t      unsigned long block, char *buf)\n{\n\tsize_t retlen;\n\n\tif (mtd_write(dev->mtd, (block * 512), 512, &retlen, buf))\n\t\treturn 1;\n\treturn 0;\n}\n\nstatic void mtdblock_add_mtd(struct mtd_blktrans_ops *tr, struct mtd_info *mtd)\n{\n\tstruct mtd_blktrans_dev *dev = kzalloc(sizeof(*dev), GFP_KERNEL);\n\n\tif (!dev)\n\t\treturn;\n\n\tdev->mtd = mtd;\n\tdev->devnum = mtd->index;\n\n\tdev->size = mtd->size >> 9;\n\tdev->tr = tr;\n\tdev->readonly = 1;\n\n\tif (mtd_type_is_nand(mtd))\n\t\tpr_warn_ratelimited(\"%s: MTD device '%s' is NAND, please consider using UBI block devices instead.\\n\",\n\t\t\ttr->name, mtd->name);\n\n\tif (add_mtd_blktrans_dev(dev))\n\t\tkfree(dev);\n}\n\nstatic void mtdblock_remove_dev(struct mtd_blktrans_dev *dev)\n{\n\tdel_mtd_blktrans_dev(dev);\n}\n\nstatic struct mtd_blktrans_ops mtdblock_tr = {\n\t.name\t\t= \"mtdblock\",\n\t.major\t\t= MTD_BLOCK_MAJOR,\n\t.part_bits\t= 0,\n\t.blksize \t= 512,\n\t.readsect\t= mtdblock_readsect,\n\t.writesect\t= mtdblock_writesect,\n\t.add_mtd\t= mtdblock_add_mtd,\n\t.remove_dev\t= mtdblock_remove_dev,\n\t.owner\t\t= THIS_MODULE,\n};\n\nmodule_mtd_blktrans(mtdblock_tr);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"David Woodhouse <dwmw2@infradead.org>\");\nMODULE_DESCRIPTION(\"Simple read-only block device emulation access to MTD devices\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}