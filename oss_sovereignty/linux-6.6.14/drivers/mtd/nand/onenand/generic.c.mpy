{
  "module_name": "generic.c",
  "hash_id": "5c40831f55273d39d7a785b4507329a89fa5613229dd0d3e75c0c1b40d8a8492",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/nand/onenand/generic.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/slab.h>\n#include <linux/platform_device.h>\n#include <linux/mtd/mtd.h>\n#include <linux/mtd/onenand.h>\n#include <linux/mtd/partitions.h>\n#include <linux/io.h>\n\n \n#define DRIVER_NAME\t\"onenand-flash\"\n\nstruct onenand_info {\n\tstruct mtd_info\t\tmtd;\n\tstruct onenand_chip\tonenand;\n};\n\nstatic int generic_onenand_probe(struct platform_device *pdev)\n{\n\tstruct onenand_info *info;\n\tstruct onenand_platform_data *pdata = dev_get_platdata(&pdev->dev);\n\tstruct resource *res = pdev->resource;\n\tunsigned long size = resource_size(res);\n\tint err;\n\n\tinfo = kzalloc(sizeof(struct onenand_info), GFP_KERNEL);\n\tif (!info)\n\t\treturn -ENOMEM;\n\n\tif (!request_mem_region(res->start, size, dev_name(&pdev->dev))) {\n\t\terr = -EBUSY;\n\t\tgoto out_free_info;\n\t}\n\n\tinfo->onenand.base = ioremap(res->start, size);\n\tif (!info->onenand.base) {\n\t\terr = -ENOMEM;\n\t\tgoto out_release_mem_region;\n\t}\n\n\tinfo->onenand.mmcontrol = pdata ? pdata->mmcontrol : NULL;\n\n\terr = platform_get_irq(pdev, 0);\n\tif (err < 0)\n\t\tgoto out_iounmap;\n\n\tinfo->onenand.irq = err;\n\n\tinfo->mtd.dev.parent = &pdev->dev;\n\tinfo->mtd.priv = &info->onenand;\n\n\tif (onenand_scan(&info->mtd, 1)) {\n\t\terr = -ENXIO;\n\t\tgoto out_iounmap;\n\t}\n\n\terr = mtd_device_register(&info->mtd, pdata ? pdata->parts : NULL,\n\t\t\t\t  pdata ? pdata->nr_parts : 0);\n\n\tplatform_set_drvdata(pdev, info);\n\n\treturn 0;\n\nout_iounmap:\n\tiounmap(info->onenand.base);\nout_release_mem_region:\n\trelease_mem_region(res->start, size);\nout_free_info:\n\tkfree(info);\n\n\treturn err;\n}\n\nstatic void generic_onenand_remove(struct platform_device *pdev)\n{\n\tstruct onenand_info *info = platform_get_drvdata(pdev);\n\tstruct resource *res = pdev->resource;\n\tunsigned long size = resource_size(res);\n\n\tif (info) {\n\t\tonenand_release(&info->mtd);\n\t\trelease_mem_region(res->start, size);\n\t\tiounmap(info->onenand.base);\n\t\tkfree(info);\n\t}\n}\n\nstatic struct platform_driver generic_onenand_driver = {\n\t.driver = {\n\t\t.name\t\t= DRIVER_NAME,\n\t},\n\t.probe\t\t= generic_onenand_probe,\n\t.remove_new\t= generic_onenand_remove,\n};\n\nmodule_platform_driver(generic_onenand_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Kyungmin Park <kyungmin.park@samsung.com>\");\nMODULE_DESCRIPTION(\"Glue layer for OneNAND flash on generic boards\");\nMODULE_ALIAS(\"platform:\" DRIVER_NAME);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}