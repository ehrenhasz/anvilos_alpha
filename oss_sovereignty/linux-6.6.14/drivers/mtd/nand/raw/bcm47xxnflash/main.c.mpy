{
  "module_name": "main.c",
  "hash_id": "fbf8d081c856857d2a2e7dfc77b0b4319ecf7c9ba853e3b122095979767163e3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/nand/raw/bcm47xxnflash/main.c",
  "human_readable_source": "\n \n\n#include \"bcm47xxnflash.h\"\n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/platform_device.h>\n#include <linux/bcma/bcma.h>\n\nMODULE_DESCRIPTION(\"NAND flash driver for BCMA bus\");\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Rafa\u0142 Mi\u0142ecki\");\n\nstatic const char *probes[] = { \"bcm47xxpart\", NULL };\n\nstatic int bcm47xxnflash_probe(struct platform_device *pdev)\n{\n\tstruct bcma_nflash *nflash = dev_get_platdata(&pdev->dev);\n\tstruct bcm47xxnflash *b47n;\n\tstruct mtd_info *mtd;\n\tint err = 0;\n\n\tb47n = devm_kzalloc(&pdev->dev, sizeof(*b47n), GFP_KERNEL);\n\tif (!b47n)\n\t\treturn -ENOMEM;\n\n\tnand_set_controller_data(&b47n->nand_chip, b47n);\n\tmtd = nand_to_mtd(&b47n->nand_chip);\n\tmtd->dev.parent = &pdev->dev;\n\tb47n->cc = container_of(nflash, struct bcma_drv_cc, nflash);\n\n\tif (b47n->cc->core->bus->chipinfo.id == BCMA_CHIP_ID_BCM4706) {\n\t\terr = bcm47xxnflash_ops_bcm4706_init(b47n);\n\t} else {\n\t\tpr_err(\"Device not supported\\n\");\n\t\terr = -ENOTSUPP;\n\t}\n\tif (err) {\n\t\tpr_err(\"Initialization failed: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\tplatform_set_drvdata(pdev, b47n);\n\n\terr = mtd_device_parse_register(mtd, probes, NULL, NULL, 0);\n\tif (err) {\n\t\tpr_err(\"Failed to register MTD device: %d\\n\", err);\n\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\nstatic void bcm47xxnflash_remove(struct platform_device *pdev)\n{\n\tstruct bcm47xxnflash *nflash = platform_get_drvdata(pdev);\n\tstruct nand_chip *chip = &nflash->nand_chip;\n\tint ret;\n\n\tret = mtd_device_unregister(nand_to_mtd(chip));\n\tWARN_ON(ret);\n\tnand_cleanup(chip);\n}\n\nstatic struct platform_driver bcm47xxnflash_driver = {\n\t.probe\t= bcm47xxnflash_probe,\n\t.remove_new = bcm47xxnflash_remove,\n\t.driver = {\n\t\t.name = \"bcma_nflash\",\n\t},\n};\n\nmodule_platform_driver(bcm47xxnflash_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}