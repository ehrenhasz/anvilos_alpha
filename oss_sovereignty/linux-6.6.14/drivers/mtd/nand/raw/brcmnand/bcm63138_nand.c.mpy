{
  "module_name": "bcm63138_nand.c",
  "hash_id": "255bd89c925c551a68f85fa98def61b2f45f0057992291542bfc6aedbd100d7d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/nand/raw/brcmnand/bcm63138_nand.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/io.h>\n#include <linux/ioport.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n\n#include \"brcmnand.h\"\n\nstruct bcm63138_nand_soc {\n\tstruct brcmnand_soc soc;\n\tvoid __iomem *base;\n};\n\n#define BCM63138_NAND_INT_STATUS\t\t0x00\n#define BCM63138_NAND_INT_EN\t\t\t0x04\n\nenum {\n\tBCM63138_CTLRDY\t\t= BIT(4),\n};\n\nstatic bool bcm63138_nand_intc_ack(struct brcmnand_soc *soc)\n{\n\tstruct bcm63138_nand_soc *priv =\n\t\t\tcontainer_of(soc, struct bcm63138_nand_soc, soc);\n\tvoid __iomem *mmio = priv->base + BCM63138_NAND_INT_STATUS;\n\tu32 val = brcmnand_readl(mmio);\n\n\tif (val & BCM63138_CTLRDY) {\n\t\tbrcmnand_writel(val & ~BCM63138_CTLRDY, mmio);\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\nstatic void bcm63138_nand_intc_set(struct brcmnand_soc *soc, bool en)\n{\n\tstruct bcm63138_nand_soc *priv =\n\t\t\tcontainer_of(soc, struct bcm63138_nand_soc, soc);\n\tvoid __iomem *mmio = priv->base + BCM63138_NAND_INT_EN;\n\tu32 val = brcmnand_readl(mmio);\n\n\tif (en)\n\t\tval |= BCM63138_CTLRDY;\n\telse\n\t\tval &= ~BCM63138_CTLRDY;\n\n\tbrcmnand_writel(val, mmio);\n}\n\nstatic int bcm63138_nand_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct bcm63138_nand_soc *priv;\n\tstruct brcmnand_soc *soc;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\tsoc = &priv->soc;\n\n\tpriv->base = devm_platform_ioremap_resource_byname(pdev, \"nand-int-base\");\n\tif (IS_ERR(priv->base))\n\t\treturn PTR_ERR(priv->base);\n\n\tsoc->ctlrdy_ack = bcm63138_nand_intc_ack;\n\tsoc->ctlrdy_set_enabled = bcm63138_nand_intc_set;\n\n\treturn brcmnand_probe(pdev, soc);\n}\n\nstatic const struct of_device_id bcm63138_nand_of_match[] = {\n\t{ .compatible = \"brcm,nand-bcm63138\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, bcm63138_nand_of_match);\n\nstatic struct platform_driver bcm63138_nand_driver = {\n\t.probe\t\t\t= bcm63138_nand_probe,\n\t.remove\t\t\t= brcmnand_remove,\n\t.driver = {\n\t\t.name\t\t= \"bcm63138_nand\",\n\t\t.pm\t\t= &brcmnand_pm_ops,\n\t\t.of_match_table\t= bcm63138_nand_of_match,\n\t}\n};\nmodule_platform_driver(bcm63138_nand_driver);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_AUTHOR(\"Brian Norris\");\nMODULE_DESCRIPTION(\"NAND driver for BCM63138\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}