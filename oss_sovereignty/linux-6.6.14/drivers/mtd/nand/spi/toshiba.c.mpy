{
  "module_name": "toshiba.c",
  "hash_id": "38858259e7c4eebebced14ef450fecc92c5b3ca3acad0db59d16e768808e4857",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/nand/spi/toshiba.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/mtd/spinand.h>\n\n \n#define SPINAND_MFR_TOSHIBA\t\t0x98\n#define TOSH_STATUS_ECC_HAS_BITFLIPS_T\t(3 << 4)\n\nstatic SPINAND_OP_VARIANTS(read_cache_variants,\n\t\tSPINAND_PAGE_READ_FROM_CACHE_X4_OP(0, 1, NULL, 0),\n\t\tSPINAND_PAGE_READ_FROM_CACHE_X2_OP(0, 1, NULL, 0),\n\t\tSPINAND_PAGE_READ_FROM_CACHE_OP(true, 0, 1, NULL, 0),\n\t\tSPINAND_PAGE_READ_FROM_CACHE_OP(false, 0, 1, NULL, 0));\n\nstatic SPINAND_OP_VARIANTS(write_cache_x4_variants,\n\t\tSPINAND_PROG_LOAD_X4(true, 0, NULL, 0),\n\t\tSPINAND_PROG_LOAD(true, 0, NULL, 0));\n\nstatic SPINAND_OP_VARIANTS(update_cache_x4_variants,\n\t\tSPINAND_PROG_LOAD_X4(false, 0, NULL, 0),\n\t\tSPINAND_PROG_LOAD(false, 0, NULL, 0));\n\n \nstatic SPINAND_OP_VARIANTS(write_cache_variants,\n\t\tSPINAND_PROG_LOAD(true, 0, NULL, 0));\n\nstatic SPINAND_OP_VARIANTS(update_cache_variants,\n\t\tSPINAND_PROG_LOAD(false, 0, NULL, 0));\n\nstatic int tx58cxgxsxraix_ooblayout_ecc(struct mtd_info *mtd, int section,\n\t\t\t\t\tstruct mtd_oob_region *region)\n{\n\tif (section > 0)\n\t\treturn -ERANGE;\n\n\tregion->offset = mtd->oobsize / 2;\n\tregion->length = mtd->oobsize / 2;\n\n\treturn 0;\n}\n\nstatic int tx58cxgxsxraix_ooblayout_free(struct mtd_info *mtd, int section,\n\t\t\t\t\t struct mtd_oob_region *region)\n{\n\tif (section > 0)\n\t\treturn -ERANGE;\n\n\t \n\tregion->offset = 2;\n\tregion->length = (mtd->oobsize / 2) - 2;\n\n\treturn 0;\n}\n\nstatic const struct mtd_ooblayout_ops tx58cxgxsxraix_ooblayout = {\n\t.ecc = tx58cxgxsxraix_ooblayout_ecc,\n\t.free = tx58cxgxsxraix_ooblayout_free,\n};\n\nstatic int tx58cxgxsxraix_ecc_get_status(struct spinand_device *spinand,\n\t\t\t\t\t u8 status)\n{\n\tstruct nand_device *nand = spinand_to_nand(spinand);\n\tu8 mbf = 0;\n\tstruct spi_mem_op op = SPINAND_GET_FEATURE_OP(0x30, spinand->scratchbuf);\n\n\tswitch (status & STATUS_ECC_MASK) {\n\tcase STATUS_ECC_NO_BITFLIPS:\n\t\treturn 0;\n\n\tcase STATUS_ECC_UNCOR_ERROR:\n\t\treturn -EBADMSG;\n\n\tcase STATUS_ECC_HAS_BITFLIPS:\n\tcase TOSH_STATUS_ECC_HAS_BITFLIPS_T:\n\t\t \n\t\tif (spi_mem_exec_op(spinand->spimem, &op))\n\t\t\treturn nanddev_get_ecc_conf(nand)->strength;\n\n\t\tmbf = *(spinand->scratchbuf) >> 4;\n\n\t\tif (WARN_ON(mbf > nanddev_get_ecc_conf(nand)->strength || !mbf))\n\t\t\treturn nanddev_get_ecc_conf(nand)->strength;\n\n\t\treturn mbf;\n\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn -EINVAL;\n}\n\nstatic const struct spinand_info toshiba_spinand_table[] = {\n\t \n\tSPINAND_INFO(\"TC58CVG0S3HRAIG\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xC2),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 1024, 20, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_variants,\n\t\t\t\t\t      &update_cache_variants),\n\t\t     0,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CVG1S3HRAIG\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xCB),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_variants,\n\t\t\t\t\t      &update_cache_variants),\n\t\t     0,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CVG2S0HRAIG\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xCD),\n\t\t     NAND_MEMORG(1, 4096, 256, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_variants,\n\t\t\t\t\t      &update_cache_variants),\n\t\t     0,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CYG0S3HRAIG\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xB2),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 1024, 20, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_variants,\n\t\t\t\t\t      &update_cache_variants),\n\t\t     0,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CYG1S3HRAIG\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xBB),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_variants,\n\t\t\t\t\t      &update_cache_variants),\n\t\t     0,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CYG2S0HRAIG\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xBD),\n\t\t     NAND_MEMORG(1, 4096, 256, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_variants,\n\t\t\t\t\t      &update_cache_variants),\n\t\t     0,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\n\t \n\t \n\tSPINAND_INFO(\"TC58CVG0S3HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xE2),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 1024, 20, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CVG1S3HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xEB),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CVG2S0HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xED),\n\t\t     NAND_MEMORG(1, 4096, 256, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TH58CVG3S0HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xE4),\n\t\t     NAND_MEMORG(1, 4096, 256, 64, 4096, 80, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CYG0S3HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xD2),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 1024, 20, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CYG1S3HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xDB),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58CYG2S0HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xDD),\n\t\t     NAND_MEMORG(1, 4096, 256, 64, 2048, 40, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TH58CYG3S0HRAIJ\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xD4),\n\t\t     NAND_MEMORG(1, 4096, 256, 64, 4096, 80, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TC58NYG0S3HBAI4\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xA1),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 1024, 20, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_variants,\n\t\t\t\t\t      &update_cache_variants),\n\t\t     0,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TH58NYG2S3HBAI4\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xAC),\n\t\t     NAND_MEMORG(1, 2048, 128, 64, 4096, 80, 1, 2, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n\t \n\tSPINAND_INFO(\"TH58NYG3S0HBAI6\",\n\t\t     SPINAND_ID(SPINAND_READID_METHOD_OPCODE_DUMMY, 0xA3),\n\t\t     NAND_MEMORG(1, 4096, 256, 64, 4096, 80, 1, 1, 1),\n\t\t     NAND_ECCREQ(8, 512),\n\t\t     SPINAND_INFO_OP_VARIANTS(&read_cache_variants,\n\t\t\t\t\t      &write_cache_x4_variants,\n\t\t\t\t\t      &update_cache_x4_variants),\n\t\t     SPINAND_HAS_QE_BIT,\n\t\t     SPINAND_ECCINFO(&tx58cxgxsxraix_ooblayout,\n\t\t\t\t     tx58cxgxsxraix_ecc_get_status)),\n};\n\nstatic const struct spinand_manufacturer_ops toshiba_spinand_manuf_ops = {\n};\n\nconst struct spinand_manufacturer toshiba_spinand_manufacturer = {\n\t.id = SPINAND_MFR_TOSHIBA,\n\t.name = \"Toshiba\",\n\t.chips = toshiba_spinand_table,\n\t.nchips = ARRAY_SIZE(toshiba_spinand_table),\n\t.ops = &toshiba_spinand_manuf_ops,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}