{
  "module_name": "map_rom.c",
  "hash_id": "75ddaea7497135b8ef0378b76ea00cd809f96b27064386a7822e8558f0f2b22b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/chips/map_rom.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <asm/io.h>\n#include <asm/byteorder.h>\n#include <linux/errno.h>\n#include <linux/slab.h>\n#include <linux/init.h>\n#include <linux/of.h>\n#include <linux/mtd/mtd.h>\n#include <linux/mtd/map.h>\n\nstatic int maprom_read (struct mtd_info *, loff_t, size_t, size_t *, u_char *);\nstatic int maprom_write (struct mtd_info *, loff_t, size_t, size_t *, const u_char *);\nstatic void maprom_nop (struct mtd_info *);\nstatic struct mtd_info *map_rom_probe(struct map_info *map);\nstatic int maprom_erase (struct mtd_info *mtd, struct erase_info *info);\nstatic int maprom_point (struct mtd_info *mtd, loff_t from, size_t len,\n\t\t\t size_t *retlen, void **virt, resource_size_t *phys);\nstatic int maprom_unpoint(struct mtd_info *mtd, loff_t from, size_t len);\n\n\nstatic struct mtd_chip_driver maprom_chipdrv = {\n\t.probe\t= map_rom_probe,\n\t.name\t= \"map_rom\",\n\t.module\t= THIS_MODULE\n};\n\nstatic unsigned int default_erasesize(struct map_info *map)\n{\n\tconst __be32 *erase_size = NULL;\n\n\terase_size = of_get_property(map->device_node, \"erase-size\", NULL);\n\n\treturn !erase_size ? map->size : be32_to_cpu(*erase_size);\n}\n\nstatic struct mtd_info *map_rom_probe(struct map_info *map)\n{\n\tstruct mtd_info *mtd;\n\n\tmtd = kzalloc(sizeof(*mtd), GFP_KERNEL);\n\tif (!mtd)\n\t\treturn NULL;\n\n\tmap->fldrv = &maprom_chipdrv;\n\tmtd->priv = map;\n\tmtd->name = map->name;\n\tmtd->type = MTD_ROM;\n\tmtd->size = map->size;\n\tmtd->_point = maprom_point;\n\tmtd->_unpoint = maprom_unpoint;\n\tmtd->_read = maprom_read;\n\tmtd->_write = maprom_write;\n\tmtd->_sync = maprom_nop;\n\tmtd->_erase = maprom_erase;\n\tmtd->flags = MTD_CAP_ROM;\n\tmtd->erasesize = default_erasesize(map);\n\tmtd->writesize = 1;\n\tmtd->writebufsize = 1;\n\n\t__module_get(THIS_MODULE);\n\treturn mtd;\n}\n\n\nstatic int maprom_point(struct mtd_info *mtd, loff_t from, size_t len,\n\t\t\tsize_t *retlen, void **virt, resource_size_t *phys)\n{\n\tstruct map_info *map = mtd->priv;\n\n\tif (!map->virt)\n\t\treturn -EINVAL;\n\t*virt = map->virt + from;\n\tif (phys)\n\t\t*phys = map->phys + from;\n\t*retlen = len;\n\treturn 0;\n}\n\nstatic int maprom_unpoint(struct mtd_info *mtd, loff_t from, size_t len)\n{\n\treturn 0;\n}\n\nstatic int maprom_read (struct mtd_info *mtd, loff_t from, size_t len, size_t *retlen, u_char *buf)\n{\n\tstruct map_info *map = mtd->priv;\n\n\tmap_copy_from(map, buf, from, len);\n\t*retlen = len;\n\treturn 0;\n}\n\nstatic void maprom_nop(struct mtd_info *mtd)\n{\n\t \n}\n\nstatic int maprom_write (struct mtd_info *mtd, loff_t to, size_t len, size_t *retlen, const u_char *buf)\n{\n\treturn -EROFS;\n}\n\nstatic int maprom_erase (struct mtd_info *mtd, struct erase_info *info)\n{\n\t \n\treturn -EROFS;\n}\n\nstatic int __init map_rom_init(void)\n{\n\tregister_mtd_chip_driver(&maprom_chipdrv);\n\treturn 0;\n}\n\nstatic void __exit map_rom_exit(void)\n{\n\tunregister_mtd_chip_driver(&maprom_chipdrv);\n}\n\nmodule_init(map_rom_init);\nmodule_exit(map_rom_exit);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"David Woodhouse <dwmw2@infradead.org>\");\nMODULE_DESCRIPTION(\"MTD chip driver for ROM chips\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}