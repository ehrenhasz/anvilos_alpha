{
  "module_name": "chipreg.c",
  "hash_id": "a09801d6541db563fe7e82511f03f5dd61bbbca845989f5372cc937783538e99",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/chips/chipreg.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/kmod.h>\n#include <linux/spinlock.h>\n#include <linux/slab.h>\n#include <linux/mtd/map.h>\n#include <linux/mtd/mtd.h>\n\nstatic DEFINE_SPINLOCK(chip_drvs_lock);\nstatic LIST_HEAD(chip_drvs_list);\n\nvoid register_mtd_chip_driver(struct mtd_chip_driver *drv)\n{\n\tspin_lock(&chip_drvs_lock);\n\tlist_add(&drv->list, &chip_drvs_list);\n\tspin_unlock(&chip_drvs_lock);\n}\n\nvoid unregister_mtd_chip_driver(struct mtd_chip_driver *drv)\n{\n\tspin_lock(&chip_drvs_lock);\n\tlist_del(&drv->list);\n\tspin_unlock(&chip_drvs_lock);\n}\n\nstatic struct mtd_chip_driver *get_mtd_chip_driver (const char *name)\n{\n\tstruct mtd_chip_driver *ret = NULL, *this;\n\n\tspin_lock(&chip_drvs_lock);\n\n\tlist_for_each_entry(this, &chip_drvs_list, list) {\n\t\tif (!strcmp(this->name, name)) {\n\t\t\tret = this;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (ret && !try_module_get(ret->module))\n\t\tret = NULL;\n\n\tspin_unlock(&chip_drvs_lock);\n\n\treturn ret;\n}\n\n\t \n\nstruct mtd_info *do_map_probe(const char *name, struct map_info *map)\n{\n\tstruct mtd_chip_driver *drv;\n\tstruct mtd_info *ret;\n\n\tdrv = get_mtd_chip_driver(name);\n\n\tif (!drv && !request_module(\"%s\", name))\n\t\tdrv = get_mtd_chip_driver(name);\n\n\tif (!drv)\n\t\treturn NULL;\n\n\tret = drv->probe(map);\n\n\t \n\tmodule_put(drv->module);\n\n\treturn ret;\n}\n \nvoid map_destroy(struct mtd_info *mtd)\n{\n\tstruct map_info *map = mtd->priv;\n\n\tif (map->fldrv->destroy)\n\t\tmap->fldrv->destroy(mtd);\n\n\tmodule_put(map->fldrv->module);\n\n\tkfree(mtd);\n}\n\nEXPORT_SYMBOL(register_mtd_chip_driver);\nEXPORT_SYMBOL(unregister_mtd_chip_driver);\nEXPORT_SYMBOL(do_map_probe);\nEXPORT_SYMBOL(map_destroy);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"David Woodhouse <dwmw2@infradead.org>\");\nMODULE_DESCRIPTION(\"Core routines for registering and invoking MTD chip drivers\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}