{
  "module_name": "sysfs.c",
  "hash_id": "dce9550769203c00bac20ecb9b6b0abfc272498cdf77a6ba7b35f96b77f45be8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mtd/spi-nor/sysfs.c",
  "human_readable_source": "\n\n#include <linux/mtd/spi-nor.h>\n#include <linux/spi/spi.h>\n#include <linux/spi/spi-mem.h>\n#include <linux/sysfs.h>\n\n#include \"core.h\"\n\nstatic ssize_t manufacturer_show(struct device *dev,\n\t\t\t\t struct device_attribute *attr, char *buf)\n{\n\tstruct spi_device *spi = to_spi_device(dev);\n\tstruct spi_mem *spimem = spi_get_drvdata(spi);\n\tstruct spi_nor *nor = spi_mem_get_drvdata(spimem);\n\n\treturn sysfs_emit(buf, \"%s\\n\", nor->manufacturer->name);\n}\nstatic DEVICE_ATTR_RO(manufacturer);\n\nstatic ssize_t partname_show(struct device *dev,\n\t\t\t     struct device_attribute *attr, char *buf)\n{\n\tstruct spi_device *spi = to_spi_device(dev);\n\tstruct spi_mem *spimem = spi_get_drvdata(spi);\n\tstruct spi_nor *nor = spi_mem_get_drvdata(spimem);\n\n\treturn sysfs_emit(buf, \"%s\\n\", nor->info->name);\n}\nstatic DEVICE_ATTR_RO(partname);\n\nstatic ssize_t jedec_id_show(struct device *dev,\n\t\t\t     struct device_attribute *attr, char *buf)\n{\n\tstruct spi_device *spi = to_spi_device(dev);\n\tstruct spi_mem *spimem = spi_get_drvdata(spi);\n\tstruct spi_nor *nor = spi_mem_get_drvdata(spimem);\n\tconst u8 *id = nor->info->id_len ? nor->info->id : nor->id;\n\tu8 id_len = nor->info->id_len ?: SPI_NOR_MAX_ID_LEN;\n\n\treturn sysfs_emit(buf, \"%*phN\\n\", id_len, id);\n}\nstatic DEVICE_ATTR_RO(jedec_id);\n\nstatic struct attribute *spi_nor_sysfs_entries[] = {\n\t&dev_attr_manufacturer.attr,\n\t&dev_attr_partname.attr,\n\t&dev_attr_jedec_id.attr,\n\tNULL\n};\n\nstatic ssize_t sfdp_read(struct file *filp, struct kobject *kobj,\n\t\t\t struct bin_attribute *bin_attr, char *buf,\n\t\t\t loff_t off, size_t count)\n{\n\tstruct spi_device *spi = to_spi_device(kobj_to_dev(kobj));\n\tstruct spi_mem *spimem = spi_get_drvdata(spi);\n\tstruct spi_nor *nor = spi_mem_get_drvdata(spimem);\n\tstruct sfdp *sfdp = nor->sfdp;\n\tsize_t sfdp_size = sfdp->num_dwords * sizeof(*sfdp->dwords);\n\n\treturn memory_read_from_buffer(buf, count, &off, nor->sfdp->dwords,\n\t\t\t\t       sfdp_size);\n}\nstatic BIN_ATTR_RO(sfdp, 0);\n\nstatic struct bin_attribute *spi_nor_sysfs_bin_entries[] = {\n\t&bin_attr_sfdp,\n\tNULL\n};\n\nstatic umode_t spi_nor_sysfs_is_visible(struct kobject *kobj,\n\t\t\t\t\tstruct attribute *attr, int n)\n{\n\tstruct spi_device *spi = to_spi_device(kobj_to_dev(kobj));\n\tstruct spi_mem *spimem = spi_get_drvdata(spi);\n\tstruct spi_nor *nor = spi_mem_get_drvdata(spimem);\n\n\tif (attr == &dev_attr_manufacturer.attr && !nor->manufacturer)\n\t\treturn 0;\n\tif (attr == &dev_attr_jedec_id.attr && !nor->info->id_len && !nor->id)\n\t\treturn 0;\n\n\treturn 0444;\n}\n\nstatic umode_t spi_nor_sysfs_is_bin_visible(struct kobject *kobj,\n\t\t\t\t\t    struct bin_attribute *attr, int n)\n{\n\tstruct spi_device *spi = to_spi_device(kobj_to_dev(kobj));\n\tstruct spi_mem *spimem = spi_get_drvdata(spi);\n\tstruct spi_nor *nor = spi_mem_get_drvdata(spimem);\n\n\tif (attr == &bin_attr_sfdp && nor->sfdp)\n\t\treturn 0444;\n\n\treturn 0;\n}\n\nstatic const struct attribute_group spi_nor_sysfs_group = {\n\t.name\t\t= \"spi-nor\",\n\t.is_visible\t= spi_nor_sysfs_is_visible,\n\t.is_bin_visible\t= spi_nor_sysfs_is_bin_visible,\n\t.attrs\t\t= spi_nor_sysfs_entries,\n\t.bin_attrs\t= spi_nor_sysfs_bin_entries,\n};\n\nconst struct attribute_group *spi_nor_sysfs_groups[] = {\n\t&spi_nor_sysfs_group,\n\tNULL\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}