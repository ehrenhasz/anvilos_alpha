{
  "module_name": "serial_port.c",
  "hash_id": "332c43a110eed4bc9c8d6892672f745b1ad597a281c377b4a4649855ad910ae2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/tty/serial/serial_port.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/module.h>\n#include <linux/pm_runtime.h>\n#include <linux/serial_core.h>\n#include <linux/spinlock.h>\n\n#include \"serial_base.h\"\n\n#define SERIAL_PORT_AUTOSUSPEND_DELAY_MS\t500\n\n \nstatic int __serial_port_busy(struct uart_port *port)\n{\n\treturn !uart_tx_stopped(port) &&\n\t\tuart_circ_chars_pending(&port->state->xmit);\n}\n\nstatic int serial_port_runtime_resume(struct device *dev)\n{\n\tstruct serial_port_device *port_dev = to_serial_base_port_device(dev);\n\tstruct uart_port *port;\n\tunsigned long flags;\n\n\tport = port_dev->port;\n\n\tif (port->flags & UPF_DEAD)\n\t\tgoto out;\n\n\t \n\tspin_lock_irqsave(&port->lock, flags);\n\tif (__serial_port_busy(port))\n\t\tport->ops->start_tx(port);\n\tspin_unlock_irqrestore(&port->lock, flags);\n\nout:\n\tpm_runtime_mark_last_busy(dev);\n\n\treturn 0;\n}\n\nstatic DEFINE_RUNTIME_DEV_PM_OPS(serial_port_pm,\n\t\t\t\t NULL, serial_port_runtime_resume, NULL);\n\nstatic int serial_port_probe(struct device *dev)\n{\n\tpm_runtime_enable(dev);\n\tpm_runtime_set_autosuspend_delay(dev, SERIAL_PORT_AUTOSUSPEND_DELAY_MS);\n\tpm_runtime_use_autosuspend(dev);\n\n\treturn 0;\n}\n\nstatic int serial_port_remove(struct device *dev)\n{\n\tpm_runtime_dont_use_autosuspend(dev);\n\tpm_runtime_disable(dev);\n\n\treturn 0;\n}\n\n \nint uart_add_one_port(struct uart_driver *drv, struct uart_port *port)\n{\n\treturn serial_ctrl_register_port(drv, port);\n}\nEXPORT_SYMBOL(uart_add_one_port);\n\nvoid uart_remove_one_port(struct uart_driver *drv, struct uart_port *port)\n{\n\tserial_ctrl_unregister_port(drv, port);\n}\nEXPORT_SYMBOL(uart_remove_one_port);\n\nstatic struct device_driver serial_port_driver = {\n\t.name = \"port\",\n\t.suppress_bind_attrs = true,\n\t.probe = serial_port_probe,\n\t.remove = serial_port_remove,\n\t.pm = pm_ptr(&serial_port_pm),\n};\n\nint serial_base_port_init(void)\n{\n\treturn serial_base_driver_register(&serial_port_driver);\n}\n\nvoid serial_base_port_exit(void)\n{\n\tserial_base_driver_unregister(&serial_port_driver);\n}\n\nMODULE_AUTHOR(\"Tony Lindgren <tony@atomide.com>\");\nMODULE_DESCRIPTION(\"Serial controller port driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}