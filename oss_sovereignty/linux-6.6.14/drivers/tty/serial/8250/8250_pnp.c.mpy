{
  "module_name": "8250_pnp.c",
  "hash_id": "bf29ef665cef18125123ccea3a88c49a5d804f17338b132786f8df47607f9178",
  "original_prompt": "Ingested from linux-6.6.14/drivers/tty/serial/8250/8250_pnp.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/pnp.h>\n#include <linux/string.h>\n#include <linux/kernel.h>\n#include <linux/property.h>\n#include <linux/serial_core.h>\n#include <linux/bitops.h>\n\n#include <asm/byteorder.h>\n\n#include \"8250.h\"\n\n#define UNKNOWN_DEV 0x3000\n#define CIR_PORT\t0x0800\n\nstatic const struct pnp_device_id pnp_dev_table[] = {\n\t \n\t \n\t{\t\"AAC000F\",\t\t0\t},\n\t \n\t \n\t{\t\"ADC0001\",\t\t0\t},\n\t \n\t{\t\"ADC0002\",\t\t0\t},\n\t \n\t{\t\"AEI0250\",\t\t0\t},\n\t \n\t{\t\"AEI1240\",\t\t0\t},\n\t \n\t{\t\"AKY1021\",\t\t0  \t},\n\t \n\t{\t\"ALI5123\",\t\t0\t},\n\t \n\t{\t\"AZT4001\",\t\t0\t},\n\t \n\t{\t\"BDP3336\",\t\t0\t},\n\t \n\t \n\t{\t\"BRI0A49\",\t\t0\t},\n\t \n\t{\t\"BRI1400\",\t\t0\t},\n\t \n\t{\t\"BRI3400\",\t\t0\t},\n\t \n\t \n\t{\t\"CPI4050\",\t\t0\t},\n\t \n\t \n\t{\t\"CTL3001\",\t\t0\t},\n\t \n\t{\t\"CTL3011\",\t\t0\t},\n\t \n\t{\t\"DAV0336\",\t\t0\t},\n\t \n\t \n\t{\t\"DMB1032\",\t\t0\t},\n\t \n\t{\t\"DMB2001\",\t\t0\t},\n\t \n\t \n\t{\t\"ETT0002\",\t\t0\t},\n\t \n\t \n\t{\t\"FUJ0202\",\t\t0\t},\n\t \n\t{\t\"FUJ0205\",\t\t0\t},\n\t \n\t{\t\"FUJ0206\",\t\t0\t},\n\t \n\t{\t\"FUJ0209\",\t\t0\t},\n\t \n\t \n\t{\t\"GVC000F\",\t\t0\t},\n\t \n\t{\t\"GVC0303\",\t\t0\t},\n\t \n\t \n\t{\t\"HAY0001\",\t\t0\t},\n\t \n\t{\t\"HAY000C\",\t\t0\t},\n\t \n\t{\t\"HAY000D\",\t\t0\t},\n\t \n\t{\t\"HAY5670\",\t\t0\t},\n\t \n\t{\t\"HAY5674\",\t\t0\t},\n\t \n\t{\t\"HAY5675\",\t\t0\t},\n\t \n\t{\t\"HAYF000\",\t\t0\t},\n\t \n\t{\t\"HAYF001\",\t\t0\t},\n\t \n\t \n\t{\t\"IBM0033\",\t\t0\t},\n\t \n\t \n\t{\t\"PNP4972\",\t\t0\t},\n\t \n\t \n\t{\t\"IXDC801\",\t\t0\t},\n\t \n\t{\t\"IXDC901\",\t\t0\t},\n\t \n\t{\t\"IXDD801\",\t\t0\t},\n\t \n\t{\t\"IXDD901\",\t\t0\t},\n\t \n\t{\t\"IXDF401\",\t\t0\t},\n\t \n\t{\t\"IXDF801\",\t\t0\t},\n\t \n\t{\t\"IXDF901\",\t\t0\t},\n\t \n\t \n\t{\t\"KOR4522\",\t\t0\t},\n\t \n\t{\t\"KORF661\",\t\t0\t},\n\t \n\t \n\t{\t\"LAS4040\",\t\t0\t},\n\t \n\t{\t\"LAS4540\",\t\t0\t},\n\t \n\t{\t\"LAS5440\",\t\t0\t},\n\t \n\t \n\t{\t\"MNP0281\",\t\t0\t},\n\t \n\t{\t\"MNP0336\",\t\t0\t},\n\t \n\t{\t\"MNP0339\",\t\t0\t},\n\t \n\t{\t\"MNP0342\",\t\t0\t},\n\t \n\t{\t\"MNP0500\",\t\t0\t},\n\t \n\t{\t\"MNP0501\",\t\t0\t},\n\t \n\t{\t\"MNP0502\",\t\t0\t},\n\t \n\t \n\t{\t\"MOT1105\",\t\t0\t},\n\t \n\t{\t\"MOT1111\",\t\t0\t},\n\t \n\t{\t\"MOT1114\",\t\t0\t},\n\t \n\t{\t\"MOT1115\",\t\t0\t},\n\t \n\t{\t\"MOT1190\",\t\t0\t},\n\t \n\t{\t\"MOT1501\",\t\t0\t},\n\t \n\t{\t\"MOT1502\",\t\t0\t},\n\t \n\t{\t\"MOT1505\",\t\t0\t},\n\t \n\t{\t\"MOT1509\",\t\t0\t},\n\t \n\t{\t\"MOT150A\",\t\t0\t},\n\t \n\t{\t\"MOT150F\",\t\t0\t},\n\t \n\t{\t\"MOT1510\",\t\t0\t},\n\t \n\t{\t\"MOT1550\",\t\t0\t},\n\t \n\t{\t\"MOT1560\",\t\t0\t},\n\t \n\t{\t\"MOT1580\",\t\t0\t},\n\t \n\t{\t\"MOT15B0\",\t\t0\t},\n\t \n\t{\t\"MOT15F0\",\t\t0\t},\n\t \n\t \n\t{\t\"MVX00A1\",\t\t0\t},\n\t \n\t{\t\"MVX00F2\",\t\t0\t},\n\t \n\t{\t\"nEC8241\",\t\t0\t},\n\t \n\t{\t\"PMC2430\",\t\t0\t},\n\t \n\t \n\t{\t\"PNP0500\",\t\t0\t},\n\t \n\t{\t\"PNP0501\",\t\t0\t},\n\t \n\t{\t\"PNPC000\",\t\t0\t},\n\t \n\t{\t\"PNPC001\",\t\t0\t},\n\t \n\t{\t\"PNPC031\",\t\t0\t},\n\t \n\t{\t\"PNPC032\",\t\t0\t},\n\t \n\t{\t\"PNPC100\",\t\t0\t},\n\t \n\t{\t\"PNPC101\",\t\t0\t},\n\t \n\t{\t\"PNPC102\",\t\t0\t},\n\t \n\t{\t\"PNPC103\",\t\t0\t},\n\t \n\t{\t\"PNPC104\",\t\t0\t},\n\t \n\t{\t\"PNPC105\",\t\t0\t},\n\t \n\t{\t\"PNPC106\",\t\t0\t},\n\t \n\t{\t\"PNPC107\",\t\t0\t},\n\t \n\t{\t\"PNPC108\",\t\t0\t},\n\t \n\t{\t\"PNPC109\",\t\t0\t},\n\t \n\t{\t\"PNPC10A\",\t\t0\t},\n\t \n\t{\t\"PNPC10B\",\t\t0\t},\n\t \n\t{\t\"PNPC10C\",\t\t0\t},\n\t \n\t{\t\"PNPC10D\",\t\t0\t},\n\t \n\t{\t\"PNPC10E\",\t\t0\t},\n\t \n\t{\t\"PNPC10F\",\t\t0\t},\n\t \n\t{\t\"PNP2000\",\t\t0\t},\n\t \n\t \n\t \n\t \n\t{\t\"ROK0030\",\t\t0\t},\n\t \n\t \n\t{\t\"ROK0100\",\t\t0\t},\n\t \n\t{\t\"ROK4120\",\t\t0\t},\n\t \n\t \n\t{\t\"ROK4920\",\t\t0\t},\n\t \n\t \n\t \n\t \n\t \n\t \n\t{\t\"RSS00A0\",\t\t0\t},\n\t \n\t{\t\"RSS0262\",\t\t0\t},\n\t \n\t{       \"RSS0250\",              0       },\n\t \n\t{\t\"SUP1310\",\t\t0\t},\n\t \n\t{\t\"SUP1381\",\t\t0\t},\n\t \n\t{\t\"SUP1421\",\t\t0\t},\n\t \n\t{\t\"SUP1590\",\t\t0\t},\n\t \n\t{\t\"SUP1620\",\t\t0\t},\n\t \n\t{\t\"SUP1760\",\t\t0\t},\n\t \n\t{\t\"SUP2171\",\t\t0\t},\n\t \n\t \n\t{\t\"TEX0011\",\t\t0\t},\n\t \n\t \n\t{\t\"UAC000F\",\t\t0\t},\n\t \n\t \n\t{\t\"USR0000\",\t\t0\t},\n\t \n\t{\t\"USR0002\",\t\t0\t},\n\t \n\t{\t\"USR0004\",\t\t0\t},\n\t \n\t{\t\"USR0006\",\t\t0\t},\n\t \n\t{\t\"USR0007\",\t\t0\t},\n\t \n\t{\t\"USR0009\",\t\t0\t},\n\t \n\t{\t\"USR2002\",\t\t0\t},\n\t \n\t{\t\"USR2070\",\t\t0\t},\n\t \n\t{\t\"USR2080\",\t\t0\t},\n\t \n\t{\t\"USR3031\",\t\t0\t},\n\t \n\t{\t\"USR3050\",\t\t0\t},\n\t \n\t{\t\"USR3070\",\t\t0\t},\n\t \n\t{\t\"USR3080\",\t\t0\t},\n\t \n\t{\t\"USR3090\",\t\t0\t},\n\t \n\t{\t\"USR9100\",\t\t0\t},\n\t \n\t{\t\"USR9160\",\t\t0\t},\n\t \n\t{\t\"USR9170\",\t\t0\t},\n\t \n\t{\t\"USR9180\",\t\t0\t},\n\t \n\t{\t\"USR9190\",\t\t0\t},\n\t \n\t{\t\"WACFXXX\",\t\t0\t},\n\t \n\t{       \"FPI2002\",              0 },\n\t \n\t{       \"FUJ02B2\",              0 },\n\t{       \"FUJ02B3\",              0 },\n\t \n\t{       \"FUJ02B4\",              0 },\n\t \n\t{       \"FUJ02B6\",              0 },\n\t{       \"FUJ02B7\",              0 },\n\t{       \"FUJ02B8\",              0 },\n\t{       \"FUJ02B9\",              0 },\n\t{       \"FUJ02BC\",              0 },\n\t \n\t{\t\"FUJ02E5\",\t\t0\t},\n\t \n\t{\t\"FUJ02E6\",\t\t0\t},\n\t \n\t{\t\"FUJ02E7\",\t\t0\t},\n\t \n\t{\t\"FUJ02E9\",\t\t0\t},\n\t \n\t{\t\"LTS0001\",\t\t0       },\n\t \n\t{\t\"WCI0003\",\t\t0\t},\n\t \n\t{\t\"PNPCXXX\",\t\tUNKNOWN_DEV\t},\n\t \n\t{\t\"PNPDXXX\",\t\tUNKNOWN_DEV\t},\n\t \n\t{\t\"WEC1022\",\t\tCIR_PORT\t},\n\t \n\t{\t\"SMCF010\",\t\tCIR_PORT\t},\n\t{\t\"\",\t\t\t0\t}\n};\n\nMODULE_DEVICE_TABLE(pnp, pnp_dev_table);\n\nstatic const char *modem_names[] = {\n\t\"MODEM\", \"Modem\", \"modem\", \"FAX\", \"Fax\", \"fax\",\n\t\"56K\", \"56k\", \"K56\", \"33.6\", \"28.8\", \"14.4\",\n\t\"33,600\", \"28,800\", \"14,400\", \"33.600\", \"28.800\", \"14.400\",\n\t\"33600\", \"28800\", \"14400\", \"V.90\", \"V.34\", \"V.32\", NULL\n};\n\nstatic bool check_name(const char *name)\n{\n\tconst char **tmp;\n\n\tfor (tmp = modem_names; *tmp; tmp++)\n\t\tif (strstr(name, *tmp))\n\t\t\treturn true;\n\n\treturn false;\n}\n\nstatic bool check_resources(struct pnp_dev *dev)\n{\n\tstatic const resource_size_t base[] = {0x2f8, 0x3f8, 0x2e8, 0x3e8};\n\tunsigned int i;\n\n\tfor (i = 0; i < ARRAY_SIZE(base); i++) {\n\t\tif (pnp_possible_config(dev, IORESOURCE_IO, base[i], 8))\n\t\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n \nstatic int serial_pnp_guess_board(struct pnp_dev *dev)\n{\n\tif (!(check_name(pnp_dev_name(dev)) ||\n\t    (dev->card && check_name(dev->card->name))))\n\t\treturn -ENODEV;\n\n\tif (check_resources(dev))\n\t\treturn 0;\n\n\treturn -ENODEV;\n}\n\nstatic int\nserial_pnp_probe(struct pnp_dev *dev, const struct pnp_device_id *dev_id)\n{\n\tstruct uart_8250_port uart, *port;\n\tint ret, line, flags = dev_id->driver_data;\n\n\tif (flags & UNKNOWN_DEV) {\n\t\tret = serial_pnp_guess_board(dev);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\tmemset(&uart, 0, sizeof(uart));\n\tif (pnp_irq_valid(dev, 0))\n\t\tuart.port.irq = pnp_irq(dev, 0);\n\tif ((flags & CIR_PORT) && pnp_port_valid(dev, 2)) {\n\t\tuart.port.iobase = pnp_port_start(dev, 2);\n\t\tuart.port.iotype = UPIO_PORT;\n\t} else if (pnp_port_valid(dev, 0)) {\n\t\tuart.port.iobase = pnp_port_start(dev, 0);\n\t\tuart.port.iotype = UPIO_PORT;\n\t} else if (pnp_mem_valid(dev, 0)) {\n\t\tuart.port.mapbase = pnp_mem_start(dev, 0);\n\t\tuart.port.iotype = UPIO_MEM;\n\t\tuart.port.flags = UPF_IOREMAP;\n\t} else\n\t\treturn -ENODEV;\n\n\tdev_dbg(&dev->dev,\n\t\t \"Setup PNP port: port %#lx, mem %#llx, irq %u, type %u\\n\",\n\t\t uart.port.iobase, (unsigned long long)uart.port.mapbase,\n\t\t uart.port.irq, uart.port.iotype);\n\n\tif (flags & CIR_PORT) {\n\t\tuart.port.flags |= UPF_FIXED_PORT | UPF_FIXED_TYPE;\n\t\tuart.port.type = PORT_8250_CIR;\n\t}\n\n\tuart.port.flags |= UPF_SKIP_TEST | UPF_BOOT_AUTOCONF;\n\tif (pnp_irq_flags(dev, 0) & IORESOURCE_IRQ_SHAREABLE)\n\t\tuart.port.flags |= UPF_SHARE_IRQ;\n\tuart.port.uartclk = 1843200;\n\tdevice_property_read_u32(&dev->dev, \"clock-frequency\", &uart.port.uartclk);\n\tuart.port.dev = &dev->dev;\n\n\tline = serial8250_register_8250_port(&uart);\n\tif (line < 0 || (flags & CIR_PORT))\n\t\treturn -ENODEV;\n\n\tport = serial8250_get_port(line);\n\tif (uart_console(&port->port))\n\t\tdev->capabilities |= PNP_CONSOLE;\n\n\tpnp_set_drvdata(dev, (void *)((long)line + 1));\n\treturn 0;\n}\n\nstatic void serial_pnp_remove(struct pnp_dev *dev)\n{\n\tlong line = (long)pnp_get_drvdata(dev);\n\n\tdev->capabilities &= ~PNP_CONSOLE;\n\tif (line)\n\t\tserial8250_unregister_port(line - 1);\n}\n\nstatic int __maybe_unused serial_pnp_suspend(struct device *dev)\n{\n\tlong line = (long)dev_get_drvdata(dev);\n\n\tif (!line)\n\t\treturn -ENODEV;\n\tserial8250_suspend_port(line - 1);\n\treturn 0;\n}\n\nstatic int __maybe_unused serial_pnp_resume(struct device *dev)\n{\n\tlong line = (long)dev_get_drvdata(dev);\n\n\tif (!line)\n\t\treturn -ENODEV;\n\tserial8250_resume_port(line - 1);\n\treturn 0;\n}\n\nstatic SIMPLE_DEV_PM_OPS(serial_pnp_pm_ops, serial_pnp_suspend, serial_pnp_resume);\n\nstatic struct pnp_driver serial_pnp_driver = {\n\t.name\t\t= \"serial\",\n\t.probe\t\t= serial_pnp_probe,\n\t.remove\t\t= serial_pnp_remove,\n\t.driver         = {\n\t\t.pm     = &serial_pnp_pm_ops,\n\t},\n\t.id_table\t= pnp_dev_table,\n};\n\nint serial8250_pnp_init(void)\n{\n\treturn pnp_register_driver(&serial_pnp_driver);\n}\n\nvoid serial8250_pnp_exit(void)\n{\n\tpnp_unregister_driver(&serial_pnp_driver);\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}