{
  "module_name": "hvc_rtas.c",
  "hash_id": "32155bd212de19496668c161cb2374679a1b2c0a19c1f302863130bcbf2d6a5a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/tty/hvc/hvc_rtas.c",
  "human_readable_source": "\n \n\n#include <linux/console.h>\n#include <linux/delay.h>\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/moduleparam.h>\n#include <linux/types.h>\n\n#include <asm/irq.h>\n#include <asm/rtas.h>\n#include \"hvc_console.h\"\n\n#define hvc_rtas_cookie 0x67781e15\nstatic struct hvc_struct *hvc_rtas_dev;\n\nstatic int rtascons_put_char_token = RTAS_UNKNOWN_SERVICE;\nstatic int rtascons_get_char_token = RTAS_UNKNOWN_SERVICE;\n\nstatic inline int hvc_rtas_write_console(uint32_t vtermno, const char *buf,\n\t\tint count)\n{\n\tint i;\n\n\tfor (i = 0; i < count; i++) {\n\t\tif (rtas_call(rtascons_put_char_token, 1, 1, NULL, buf[i]))\n\t\t\tbreak;\n\t}\n\n\treturn i;\n}\n\nstatic int hvc_rtas_read_console(uint32_t vtermno, char *buf, int count)\n{\n\tint i, c;\n\n\tfor (i = 0; i < count; i++) {\n\t\tif (rtas_call(rtascons_get_char_token, 0, 2, &c))\n\t\t\tbreak;\n\n\t\tbuf[i] = c;\n\t}\n\n\treturn i;\n}\n\nstatic const struct hv_ops hvc_rtas_get_put_ops = {\n\t.get_chars = hvc_rtas_read_console,\n\t.put_chars = hvc_rtas_write_console,\n};\n\nstatic int __init hvc_rtas_init(void)\n{\n\tstruct hvc_struct *hp;\n\n\tif (rtascons_put_char_token == RTAS_UNKNOWN_SERVICE)\n\t\trtascons_put_char_token = rtas_token(\"put-term-char\");\n\tif (rtascons_put_char_token == RTAS_UNKNOWN_SERVICE)\n\t\treturn -EIO;\n\n\tif (rtascons_get_char_token == RTAS_UNKNOWN_SERVICE)\n\t\trtascons_get_char_token = rtas_token(\"get-term-char\");\n\tif (rtascons_get_char_token == RTAS_UNKNOWN_SERVICE)\n\t\treturn -EIO;\n\n\tBUG_ON(hvc_rtas_dev);\n\n\t \n\thp = hvc_alloc(hvc_rtas_cookie, 0, &hvc_rtas_get_put_ops, 16);\n\tif (IS_ERR(hp))\n\t\treturn PTR_ERR(hp);\n\n\thvc_rtas_dev = hp;\n\n\treturn 0;\n}\ndevice_initcall(hvc_rtas_init);\n\n \nstatic int __init hvc_rtas_console_init(void)\n{\n\trtascons_put_char_token = rtas_token(\"put-term-char\");\n\tif (rtascons_put_char_token == RTAS_UNKNOWN_SERVICE)\n\t\treturn -EIO;\n\n\trtascons_get_char_token = rtas_token(\"get-term-char\");\n\tif (rtascons_get_char_token == RTAS_UNKNOWN_SERVICE)\n\t\treturn -EIO;\n\n\thvc_instantiate(hvc_rtas_cookie, 0, &hvc_rtas_get_put_ops);\n\tadd_preferred_console(\"hvc\", 0, NULL);\n\n\treturn 0;\n}\nconsole_initcall(hvc_rtas_console_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}