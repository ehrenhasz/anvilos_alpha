{
  "module_name": "tty_baudrate.c",
  "hash_id": "c33b6e401238799fedda94caaf1aea57f42c14bb0a7ff3217fbbb884b676b72f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/tty/tty_baudrate.c",
  "human_readable_source": "\n \n\n#include <linux/types.h>\n#include <linux/kernel.h>\n#include <linux/termios.h>\n#include <linux/tty.h>\n#include <linux/export.h>\n#include \"tty.h\"\n\n\n \nstatic const speed_t baud_table[] = {\n\t0, 50, 75, 110, 134, 150, 200, 300, 600, 1200, 1800, 2400,\n\t4800, 9600, 19200, 38400, 57600, 115200, 230400, 460800,\n#ifdef __sparc__\n\t76800, 153600, 307200, 614400, 921600, 500000, 576000,\n\t1000000, 1152000, 1500000, 2000000\n#else\n\t500000, 576000, 921600, 1000000, 1152000, 1500000, 2000000,\n\t2500000, 3000000, 3500000, 4000000\n#endif\n};\n\nstatic const tcflag_t baud_bits[] = {\n\tB0, B50, B75, B110, B134, B150, B200, B300, B600, B1200, B1800, B2400,\n\tB4800, B9600, B19200, B38400, B57600, B115200, B230400, B460800,\n#ifdef __sparc__\n\tB76800, B153600, B307200, B614400, B921600, B500000, B576000,\n\tB1000000, B1152000, B1500000, B2000000\n#else\n\tB500000, B576000, B921600, B1000000, B1152000, B1500000, B2000000,\n\tB2500000, B3000000, B3500000, B4000000\n#endif\n};\n\nstatic int n_baud_table = ARRAY_SIZE(baud_table);\n\n \n\nspeed_t tty_termios_baud_rate(const struct ktermios *termios)\n{\n\tunsigned int cbaud;\n\n\tcbaud = termios->c_cflag & CBAUD;\n\n\t \n\tif (cbaud == BOTHER)\n\t\treturn termios->c_ospeed;\n\n\tif (cbaud & CBAUDEX) {\n\t\tcbaud &= ~CBAUDEX;\n\t\tcbaud += 15;\n\t}\n\treturn cbaud >= n_baud_table ? 0 : baud_table[cbaud];\n}\nEXPORT_SYMBOL(tty_termios_baud_rate);\n\n \n\nspeed_t tty_termios_input_baud_rate(const struct ktermios *termios)\n{\n\tunsigned int cbaud = (termios->c_cflag >> IBSHIFT) & CBAUD;\n\n\tif (cbaud == B0)\n\t\treturn tty_termios_baud_rate(termios);\n\n\t \n\tif (cbaud == BOTHER)\n\t\treturn termios->c_ispeed;\n\n\tif (cbaud & CBAUDEX) {\n\t\tcbaud &= ~CBAUDEX;\n\t\tcbaud += 15;\n\t}\n\treturn cbaud >= n_baud_table ? 0 : baud_table[cbaud];\n}\nEXPORT_SYMBOL(tty_termios_input_baud_rate);\n\n \n\nvoid tty_termios_encode_baud_rate(struct ktermios *termios,\n\t\t\t\t  speed_t ibaud, speed_t obaud)\n{\n\tint i = 0;\n\tint ifound = -1, ofound = -1;\n\tint iclose = ibaud/50, oclose = obaud/50;\n\tint ibinput = 0;\n\n\tif (obaud == 0)\t\t\t \n\t\tibaud = 0;\t\t \n\n\ttermios->c_ispeed = ibaud;\n\ttermios->c_ospeed = obaud;\n\n\tif (((termios->c_cflag >> IBSHIFT) & CBAUD) != B0)\n\t\tibinput = 1;\t \n\n\t \n\n\tif ((termios->c_cflag & CBAUD) == BOTHER) {\n\t\toclose = 0;\n\t\tif (!ibinput)\n\t\t\ticlose = 0;\n\t}\n\tif (((termios->c_cflag >> IBSHIFT) & CBAUD) == BOTHER)\n\t\ticlose = 0;\n\n\ttermios->c_cflag &= ~CBAUD;\n\ttermios->c_cflag &= ~(CBAUD << IBSHIFT);\n\n\t \n\n\tdo {\n\t\tif (obaud - oclose <= baud_table[i] &&\n\t\t    obaud + oclose >= baud_table[i]) {\n\t\t\ttermios->c_cflag |= baud_bits[i];\n\t\t\tofound = i;\n\t\t}\n\t\tif (ibaud - iclose <= baud_table[i] &&\n\t\t    ibaud + iclose >= baud_table[i]) {\n\t\t\t \n\t\t\tif (ofound == i && !ibinput) {\n\t\t\t\tifound  = i;\n\t\t\t} else {\n\t\t\t\tifound = i;\n\t\t\t\ttermios->c_cflag |= (baud_bits[i] << IBSHIFT);\n\t\t\t}\n\t\t}\n\t} while (++i < n_baud_table);\n\n\t \n\tif (ofound == -1)\n\t\ttermios->c_cflag |= BOTHER;\n\t \n\tif (ifound == -1 && (ibaud != obaud || ibinput))\n\t\ttermios->c_cflag |= (BOTHER << IBSHIFT);\n}\nEXPORT_SYMBOL_GPL(tty_termios_encode_baud_rate);\n\n \n\nvoid tty_encode_baud_rate(struct tty_struct *tty, speed_t ibaud, speed_t obaud)\n{\n\ttty_termios_encode_baud_rate(&tty->termios, ibaud, obaud);\n}\nEXPORT_SYMBOL_GPL(tty_encode_baud_rate);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}