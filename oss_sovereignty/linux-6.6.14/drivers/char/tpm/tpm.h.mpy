{
  "module_name": "tpm.h",
  "hash_id": "1a8bf5080b180719d6f36f6e33e9681f8372d3bd2796ab67ad48f38c44597a54",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/tpm/tpm.h",
  "human_readable_source": " \n \n\n#ifndef __TPM_H__\n#define __TPM_H__\n\n#include <linux/module.h>\n#include <linux/delay.h>\n#include <linux/mutex.h>\n#include <linux/sched.h>\n#include <linux/platform_device.h>\n#include <linux/io.h>\n#include <linux/tpm.h>\n#include <linux/tpm_eventlog.h>\n\n#ifdef CONFIG_X86\n#include <asm/intel-family.h>\n#endif\n\n#define TPM_MINOR\t\t224\t \n#define TPM_BUFSIZE\t\t4096\n#define TPM_NUM_DEVICES\t\t65536\n#define TPM_RETRY\t\t50\n\nenum tpm_timeout {\n\tTPM_TIMEOUT = 5,\t \n\tTPM_TIMEOUT_RETRY = 100,  \n\tTPM_TIMEOUT_RANGE_US = 300,\t \n\tTPM_TIMEOUT_POLL = 1,\t \n\tTPM_TIMEOUT_USECS_MIN = 100,       \n\tTPM_TIMEOUT_USECS_MAX = 500       \n};\n\n \nenum tpm_addr {\n\tTPM_SUPERIO_ADDR = 0x2E,\n\tTPM_ADDR = 0x4E,\n};\n\n#define TPM_WARN_RETRY          0x800\n#define TPM_WARN_DOING_SELFTEST 0x802\n#define TPM_ERR_DEACTIVATED     0x6\n#define TPM_ERR_DISABLED        0x7\n#define TPM_ERR_FAILEDSELFTEST  0x1C\n#define TPM_ERR_INVALID_POSTINIT 38\n\n#define TPM_TAG_RQU_COMMAND 193\n\n \n#define TPM2_SPACE_BUFFER_SIZE\t\t16384  \n\nstruct\tstclear_flags_t {\n\t__be16\ttag;\n\tu8\tdeactivated;\n\tu8\tdisableForceClear;\n\tu8\tphysicalPresence;\n\tu8\tphysicalPresenceLock;\n\tu8\tbGlobalLock;\n} __packed;\n\nstruct tpm1_version {\n\tu8 major;\n\tu8 minor;\n\tu8 rev_major;\n\tu8 rev_minor;\n} __packed;\n\nstruct tpm1_version2 {\n\t__be16 tag;\n\tstruct tpm1_version version;\n} __packed;\n\nstruct\ttimeout_t {\n\t__be32\ta;\n\t__be32\tb;\n\t__be32\tc;\n\t__be32\td;\n} __packed;\n\nstruct duration_t {\n\t__be32\ttpm_short;\n\t__be32\ttpm_medium;\n\t__be32\ttpm_long;\n} __packed;\n\nstruct permanent_flags_t {\n\t__be16\ttag;\n\tu8\tdisable;\n\tu8\townership;\n\tu8\tdeactivated;\n\tu8\treadPubek;\n\tu8\tdisableOwnerClear;\n\tu8\tallowMaintenance;\n\tu8\tphysicalPresenceLifetimeLock;\n\tu8\tphysicalPresenceHWEnable;\n\tu8\tphysicalPresenceCMDEnable;\n\tu8\tCEKPUsed;\n\tu8\tTPMpost;\n\tu8\tTPMpostLock;\n\tu8\tFIPS;\n\tu8\toperator;\n\tu8\tenableRevokeEK;\n\tu8\tnvLocked;\n\tu8\treadSRKPub;\n\tu8\ttpmEstablished;\n\tu8\tmaintenanceDone;\n\tu8\tdisableFullDALogicInfo;\n} __packed;\n\ntypedef union {\n\tstruct\tpermanent_flags_t perm_flags;\n\tstruct\tstclear_flags_t\tstclear_flags;\n\t__u8\towned;\n\t__be32\tnum_pcrs;\n\tstruct tpm1_version version1;\n\tstruct tpm1_version2 version2;\n\t__be32\tmanufacturer_id;\n\tstruct timeout_t  timeout;\n\tstruct duration_t duration;\n} cap_t;\n\nenum tpm_capabilities {\n\tTPM_CAP_FLAG = 4,\n\tTPM_CAP_PROP = 5,\n\tTPM_CAP_VERSION_1_1 = 0x06,\n\tTPM_CAP_VERSION_1_2 = 0x1A,\n};\n\nenum tpm_sub_capabilities {\n\tTPM_CAP_PROP_PCR = 0x101,\n\tTPM_CAP_PROP_MANUFACTURER = 0x103,\n\tTPM_CAP_FLAG_PERM = 0x108,\n\tTPM_CAP_FLAG_VOL = 0x109,\n\tTPM_CAP_PROP_OWNER = 0x111,\n\tTPM_CAP_PROP_TIS_TIMEOUT = 0x115,\n\tTPM_CAP_PROP_TIS_DURATION = 0x120,\n};\n\nenum tpm2_pt_props {\n\tTPM2_PT_NONE = 0x00000000,\n\tTPM2_PT_GROUP = 0x00000100,\n\tTPM2_PT_FIXED = TPM2_PT_GROUP * 1,\n\tTPM2_PT_FAMILY_INDICATOR = TPM2_PT_FIXED + 0,\n\tTPM2_PT_LEVEL = TPM2_PT_FIXED + 1,\n\tTPM2_PT_REVISION = TPM2_PT_FIXED + 2,\n\tTPM2_PT_DAY_OF_YEAR = TPM2_PT_FIXED + 3,\n\tTPM2_PT_YEAR = TPM2_PT_FIXED + 4,\n\tTPM2_PT_MANUFACTURER = TPM2_PT_FIXED + 5,\n\tTPM2_PT_VENDOR_STRING_1 = TPM2_PT_FIXED + 6,\n\tTPM2_PT_VENDOR_STRING_2 = TPM2_PT_FIXED + 7,\n\tTPM2_PT_VENDOR_STRING_3 = TPM2_PT_FIXED + 8,\n\tTPM2_PT_VENDOR_STRING_4 = TPM2_PT_FIXED + 9,\n\tTPM2_PT_VENDOR_TPM_TYPE = TPM2_PT_FIXED + 10,\n\tTPM2_PT_FIRMWARE_VERSION_1 = TPM2_PT_FIXED + 11,\n\tTPM2_PT_FIRMWARE_VERSION_2 = TPM2_PT_FIXED + 12,\n\tTPM2_PT_INPUT_BUFFER = TPM2_PT_FIXED + 13,\n\tTPM2_PT_HR_TRANSIENT_MIN = TPM2_PT_FIXED + 14,\n\tTPM2_PT_HR_PERSISTENT_MIN = TPM2_PT_FIXED + 15,\n\tTPM2_PT_HR_LOADED_MIN = TPM2_PT_FIXED + 16,\n\tTPM2_PT_ACTIVE_SESSIONS_MAX = TPM2_PT_FIXED + 17,\n\tTPM2_PT_PCR_COUNT = TPM2_PT_FIXED + 18,\n\tTPM2_PT_PCR_SELECT_MIN = TPM2_PT_FIXED + 19,\n\tTPM2_PT_CONTEXT_GAP_MAX = TPM2_PT_FIXED + 20,\n\tTPM2_PT_NV_COUNTERS_MAX = TPM2_PT_FIXED + 22,\n\tTPM2_PT_NV_INDEX_MAX = TPM2_PT_FIXED + 23,\n\tTPM2_PT_MEMORY = TPM2_PT_FIXED + 24,\n\tTPM2_PT_CLOCK_UPDATE = TPM2_PT_FIXED + 25,\n\tTPM2_PT_CONTEXT_HASH = TPM2_PT_FIXED + 26,\n\tTPM2_PT_CONTEXT_SYM = TPM2_PT_FIXED + 27,\n\tTPM2_PT_CONTEXT_SYM_SIZE = TPM2_PT_FIXED + 28,\n\tTPM2_PT_ORDERLY_COUNT = TPM2_PT_FIXED + 29,\n\tTPM2_PT_MAX_COMMAND_SIZE = TPM2_PT_FIXED + 30,\n\tTPM2_PT_MAX_RESPONSE_SIZE = TPM2_PT_FIXED + 31,\n\tTPM2_PT_MAX_DIGEST = TPM2_PT_FIXED + 32,\n\tTPM2_PT_MAX_OBJECT_CONTEXT = TPM2_PT_FIXED + 33,\n\tTPM2_PT_MAX_SESSION_CONTEXT = TPM2_PT_FIXED + 34,\n\tTPM2_PT_PS_FAMILY_INDICATOR = TPM2_PT_FIXED + 35,\n\tTPM2_PT_PS_LEVEL = TPM2_PT_FIXED + 36,\n\tTPM2_PT_PS_REVISION = TPM2_PT_FIXED + 37,\n\tTPM2_PT_PS_DAY_OF_YEAR = TPM2_PT_FIXED + 38,\n\tTPM2_PT_PS_YEAR = TPM2_PT_FIXED + 39,\n\tTPM2_PT_SPLIT_MAX = TPM2_PT_FIXED + 40,\n\tTPM2_PT_TOTAL_COMMANDS = TPM2_PT_FIXED + 41,\n\tTPM2_PT_LIBRARY_COMMANDS = TPM2_PT_FIXED + 42,\n\tTPM2_PT_VENDOR_COMMANDS = TPM2_PT_FIXED + 43,\n\tTPM2_PT_NV_BUFFER_MAX = TPM2_PT_FIXED + 44,\n\tTPM2_PT_MODES = TPM2_PT_FIXED + 45,\n\tTPM2_PT_MAX_CAP_BUFFER = TPM2_PT_FIXED + 46,\n\tTPM2_PT_VAR = TPM2_PT_GROUP * 2,\n\tTPM2_PT_PERMANENT = TPM2_PT_VAR + 0,\n\tTPM2_PT_STARTUP_CLEAR = TPM2_PT_VAR + 1,\n\tTPM2_PT_HR_NV_INDEX = TPM2_PT_VAR + 2,\n\tTPM2_PT_HR_LOADED = TPM2_PT_VAR + 3,\n\tTPM2_PT_HR_LOADED_AVAIL = TPM2_PT_VAR + 4,\n\tTPM2_PT_HR_ACTIVE = TPM2_PT_VAR + 5,\n\tTPM2_PT_HR_ACTIVE_AVAIL = TPM2_PT_VAR + 6,\n\tTPM2_PT_HR_TRANSIENT_AVAIL = TPM2_PT_VAR + 7,\n\tTPM2_PT_HR_PERSISTENT = TPM2_PT_VAR + 8,\n\tTPM2_PT_HR_PERSISTENT_AVAIL = TPM2_PT_VAR + 9,\n\tTPM2_PT_NV_COUNTERS = TPM2_PT_VAR + 10,\n\tTPM2_PT_NV_COUNTERS_AVAIL = TPM2_PT_VAR + 11,\n\tTPM2_PT_ALGORITHM_SET = TPM2_PT_VAR + 12,\n\tTPM2_PT_LOADED_CURVES = TPM2_PT_VAR + 13,\n\tTPM2_PT_LOCKOUT_COUNTER = TPM2_PT_VAR + 14,\n\tTPM2_PT_MAX_AUTH_FAIL = TPM2_PT_VAR + 15,\n\tTPM2_PT_LOCKOUT_INTERVAL = TPM2_PT_VAR + 16,\n\tTPM2_PT_LOCKOUT_RECOVERY = TPM2_PT_VAR + 17,\n\tTPM2_PT_NV_WRITE_RECOVERY = TPM2_PT_VAR + 18,\n\tTPM2_PT_AUDIT_COUNTER_0 = TPM2_PT_VAR + 19,\n\tTPM2_PT_AUDIT_COUNTER_1 = TPM2_PT_VAR + 20,\n};\n\n \n#define TPM_MAX_RNG_DATA\t128\n\nextern const struct class tpm_class;\nextern const struct class tpmrm_class;\nextern dev_t tpm_devt;\nextern const struct file_operations tpm_fops;\nextern const struct file_operations tpmrm_fops;\nextern struct idr dev_nums_idr;\n\nssize_t tpm_transmit(struct tpm_chip *chip, u8 *buf, size_t bufsiz);\nint tpm_get_timeouts(struct tpm_chip *);\nint tpm_auto_startup(struct tpm_chip *chip);\n\nint tpm1_pm_suspend(struct tpm_chip *chip, u32 tpm_suspend_pcr);\nint tpm1_auto_startup(struct tpm_chip *chip);\nint tpm1_do_selftest(struct tpm_chip *chip);\nint tpm1_get_timeouts(struct tpm_chip *chip);\nunsigned long tpm1_calc_ordinal_duration(struct tpm_chip *chip, u32 ordinal);\nint tpm1_pcr_extend(struct tpm_chip *chip, u32 pcr_idx, const u8 *hash,\n\t\t    const char *log_msg);\nint tpm1_pcr_read(struct tpm_chip *chip, u32 pcr_idx, u8 *res_buf);\nssize_t tpm1_getcap(struct tpm_chip *chip, u32 subcap_id, cap_t *cap,\n\t\t    const char *desc, size_t min_cap_length);\nint tpm1_get_random(struct tpm_chip *chip, u8 *out, size_t max);\nint tpm1_get_pcr_allocation(struct tpm_chip *chip);\nunsigned long tpm_calc_ordinal_duration(struct tpm_chip *chip, u32 ordinal);\nint tpm_pm_suspend(struct device *dev);\nint tpm_pm_resume(struct device *dev);\nint tpm_class_shutdown(struct device *dev);\n\nstatic inline void tpm_msleep(unsigned int delay_msec)\n{\n\tusleep_range((delay_msec * 1000) - TPM_TIMEOUT_RANGE_US,\n\t\t     delay_msec * 1000);\n};\n\nint tpm_chip_bootstrap(struct tpm_chip *chip);\nint tpm_chip_start(struct tpm_chip *chip);\nvoid tpm_chip_stop(struct tpm_chip *chip);\nstruct tpm_chip *tpm_find_get_ops(struct tpm_chip *chip);\n\nstruct tpm_chip *tpm_chip_alloc(struct device *dev,\n\t\t\t\tconst struct tpm_class_ops *ops);\nstruct tpm_chip *tpmm_chip_alloc(struct device *pdev,\n\t\t\t\t const struct tpm_class_ops *ops);\nint tpm_chip_register(struct tpm_chip *chip);\nvoid tpm_chip_unregister(struct tpm_chip *chip);\n\nvoid tpm_sysfs_add_device(struct tpm_chip *chip);\n\n\n#ifdef CONFIG_ACPI\nextern void tpm_add_ppi(struct tpm_chip *chip);\n#else\nstatic inline void tpm_add_ppi(struct tpm_chip *chip)\n{\n}\n#endif\n\nint tpm2_get_timeouts(struct tpm_chip *chip);\nint tpm2_pcr_read(struct tpm_chip *chip, u32 pcr_idx,\n\t\t  struct tpm_digest *digest, u16 *digest_size_ptr);\nint tpm2_pcr_extend(struct tpm_chip *chip, u32 pcr_idx,\n\t\t    struct tpm_digest *digests);\nint tpm2_get_random(struct tpm_chip *chip, u8 *dest, size_t max);\nssize_t tpm2_get_tpm_pt(struct tpm_chip *chip, u32 property_id,\n\t\t\tu32 *value, const char *desc);\n\nssize_t tpm2_get_pcr_allocation(struct tpm_chip *chip);\nint tpm2_auto_startup(struct tpm_chip *chip);\nvoid tpm2_shutdown(struct tpm_chip *chip, u16 shutdown_type);\nunsigned long tpm2_calc_ordinal_duration(struct tpm_chip *chip, u32 ordinal);\nint tpm2_probe(struct tpm_chip *chip);\nint tpm2_get_cc_attrs_tbl(struct tpm_chip *chip);\nint tpm2_find_cc(struct tpm_chip *chip, u32 cc);\nint tpm2_init_space(struct tpm_space *space, unsigned int buf_size);\nvoid tpm2_del_space(struct tpm_chip *chip, struct tpm_space *space);\nvoid tpm2_flush_space(struct tpm_chip *chip);\nint tpm2_prepare_space(struct tpm_chip *chip, struct tpm_space *space, u8 *cmd,\n\t\t       size_t cmdsiz);\nint tpm2_commit_space(struct tpm_chip *chip, struct tpm_space *space, void *buf,\n\t\t      size_t *bufsiz);\nint tpm_devs_add(struct tpm_chip *chip);\nvoid tpm_devs_remove(struct tpm_chip *chip);\n\nvoid tpm_bios_log_setup(struct tpm_chip *chip);\nvoid tpm_bios_log_teardown(struct tpm_chip *chip);\nint tpm_dev_common_init(void);\nvoid tpm_dev_common_exit(void);\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}