{
  "module_name": "xillybus_pcie.c",
  "hash_id": "9af9a46d4f028366fee15fc9c1d5ca3b53827019aa10fae786dc4f3955d0bc73",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/xillybus/xillybus_pcie.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/pci.h>\n#include <linux/slab.h>\n#include \"xillybus.h\"\n\nMODULE_DESCRIPTION(\"Xillybus driver for PCIe\");\nMODULE_AUTHOR(\"Eli Billauer, Xillybus Ltd.\");\nMODULE_ALIAS(\"xillybus_pcie\");\nMODULE_LICENSE(\"GPL v2\");\n\n#define PCI_DEVICE_ID_XILLYBUS\t\t0xebeb\n\n#define PCI_VENDOR_ID_ACTEL\t\t0x11aa\n#define PCI_VENDOR_ID_LATTICE\t\t0x1204\n\nstatic const char xillyname[] = \"xillybus_pcie\";\n\nstatic const struct pci_device_id xillyids[] = {\n\t{PCI_DEVICE(PCI_VENDOR_ID_XILINX, PCI_DEVICE_ID_XILLYBUS)},\n\t{PCI_DEVICE(PCI_VENDOR_ID_ALTERA, PCI_DEVICE_ID_XILLYBUS)},\n\t{PCI_DEVICE(PCI_VENDOR_ID_ACTEL, PCI_DEVICE_ID_XILLYBUS)},\n\t{PCI_DEVICE(PCI_VENDOR_ID_LATTICE, PCI_DEVICE_ID_XILLYBUS)},\n\t{   }\n};\n\nstatic int xilly_probe(struct pci_dev *pdev,\n\t\t       const struct pci_device_id *ent)\n{\n\tstruct xilly_endpoint *endpoint;\n\tint rc;\n\n\tendpoint = xillybus_init_endpoint(&pdev->dev);\n\n\tif (!endpoint)\n\t\treturn -ENOMEM;\n\n\tpci_set_drvdata(pdev, endpoint);\n\n\tendpoint->owner = THIS_MODULE;\n\n\trc = pcim_enable_device(pdev);\n\tif (rc) {\n\t\tdev_err(endpoint->dev,\n\t\t\t\"pcim_enable_device() failed. Aborting.\\n\");\n\t\treturn rc;\n\t}\n\n\t \n\n\tpci_disable_link_state(pdev, PCIE_LINK_STATE_L0S);\n\n\tif (!(pci_resource_flags(pdev, 0) & IORESOURCE_MEM)) {\n\t\tdev_err(endpoint->dev,\n\t\t\t\"Incorrect BAR configuration. Aborting.\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\trc = pcim_iomap_regions(pdev, 0x01, xillyname);\n\tif (rc) {\n\t\tdev_err(endpoint->dev,\n\t\t\t\"pcim_iomap_regions() failed. Aborting.\\n\");\n\t\treturn rc;\n\t}\n\n\tendpoint->registers = pcim_iomap_table(pdev)[0];\n\n\tpci_set_master(pdev);\n\n\t \n\tif (pci_enable_msi(pdev)) {\n\t\tdev_err(endpoint->dev,\n\t\t\t\"Failed to enable MSI interrupts. Aborting.\\n\");\n\t\treturn -ENODEV;\n\t}\n\trc = devm_request_irq(&pdev->dev, pdev->irq, xillybus_isr, 0,\n\t\t\t      xillyname, endpoint);\n\tif (rc) {\n\t\tdev_err(endpoint->dev,\n\t\t\t\"Failed to register MSI handler. Aborting.\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\t \n\n\tif (!dma_set_mask(&pdev->dev, DMA_BIT_MASK(32))) {\n\t\tendpoint->dma_using_dac = 0;\n\t} else if (!dma_set_mask(&pdev->dev, DMA_BIT_MASK(64))) {\n\t\tendpoint->dma_using_dac = 1;\n\t} else {\n\t\tdev_err(endpoint->dev, \"Failed to set DMA mask. Aborting.\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\treturn xillybus_endpoint_discovery(endpoint);\n}\n\nstatic void xilly_remove(struct pci_dev *pdev)\n{\n\tstruct xilly_endpoint *endpoint = pci_get_drvdata(pdev);\n\n\txillybus_endpoint_remove(endpoint);\n}\n\nMODULE_DEVICE_TABLE(pci, xillyids);\n\nstatic struct pci_driver xillybus_driver = {\n\t.name = xillyname,\n\t.id_table = xillyids,\n\t.probe = xilly_probe,\n\t.remove = xilly_remove,\n};\n\nmodule_pci_driver(xillybus_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}