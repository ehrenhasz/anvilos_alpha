{
  "module_name": "3780i.c",
  "hash_id": "e9326967ff90e2d13bd37dd27ddb8518e6f6f6a6872a30a751d5f198f14bad7a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/mwave/3780i.c",
  "human_readable_source": " \n\n#include <linux/kernel.h>\n#include <linux/unistd.h>\n#include <linux/delay.h>\n#include <linux/ioport.h>\n#include <linux/bitops.h>\n#include <linux/sched.h>\t \n\n#include <asm/io.h>\n#include <linux/uaccess.h>\n#include <asm/irq.h>\n#include \"smapi.h\"\n#include \"mwavedd.h\"\n#include \"3780i.h\"\n\nstatic DEFINE_SPINLOCK(dsp_lock);\n\nstatic void PaceMsaAccess(unsigned short usDspBaseIO)\n{\n\tcond_resched();\n\tudelay(100);\n\tcond_resched();\n}\n\nunsigned short dsp3780I_ReadMsaCfg(unsigned short usDspBaseIO,\n                                   unsigned long ulMsaAddr)\n{\n\tunsigned long flags;\n\tunsigned short val;\n\n\tPRINTK_3(TRACE_3780I,\n\t\t\"3780i::dsp3780I_ReadMsaCfg entry usDspBaseIO %x ulMsaAddr %lx\\n\",\n\t\tusDspBaseIO, ulMsaAddr);\n\n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_MsaAddrLow, (unsigned short) ulMsaAddr);\n\tOutWordDsp(DSP_MsaAddrHigh, (unsigned short) (ulMsaAddr >> 16));\n\tval = InWordDsp(DSP_MsaDataDSISHigh);\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\tPRINTK_2(TRACE_3780I, \"3780i::dsp3780I_ReadMsaCfg exit val %x\\n\", val);\n\n\treturn val;\n}\n\nvoid dsp3780I_WriteMsaCfg(unsigned short usDspBaseIO,\n                          unsigned long ulMsaAddr, unsigned short usValue)\n{\n\tunsigned long flags;\n\n\tPRINTK_4(TRACE_3780I,\n\t\t\"3780i::dsp3780i_WriteMsaCfg entry usDspBaseIO %x ulMsaAddr %lx usValue %x\\n\",\n\t\tusDspBaseIO, ulMsaAddr, usValue);\n\n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_MsaAddrLow, (unsigned short) ulMsaAddr);\n\tOutWordDsp(DSP_MsaAddrHigh, (unsigned short) (ulMsaAddr >> 16));\n\tOutWordDsp(DSP_MsaDataDSISHigh, usValue);\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n}\n\nstatic void dsp3780I_WriteGenCfg(unsigned short usDspBaseIO, unsigned uIndex,\n\t\t\t\t unsigned char ucValue)\n{\n\tDSP_ISA_SLAVE_CONTROL rSlaveControl;\n\tDSP_ISA_SLAVE_CONTROL rSlaveControl_Save;\n\n\n\tPRINTK_4(TRACE_3780I,\n\t\t\"3780i::dsp3780i_WriteGenCfg entry usDspBaseIO %x uIndex %x ucValue %x\\n\",\n\t\tusDspBaseIO, uIndex, ucValue);\n\n\tMKBYTE(rSlaveControl) = InByteDsp(DSP_IsaSlaveControl);\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780i_WriteGenCfg rSlaveControl %x\\n\",\n\t\tMKBYTE(rSlaveControl));\n\n\trSlaveControl_Save = rSlaveControl;\n\trSlaveControl.ConfigMode = true;\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780i_WriteGenCfg entry rSlaveControl+ConfigMode %x\\n\",\n\t\tMKBYTE(rSlaveControl));\n\n\tOutByteDsp(DSP_IsaSlaveControl, MKBYTE(rSlaveControl));\n\tOutByteDsp(DSP_ConfigAddress, (unsigned char) uIndex);\n\tOutByteDsp(DSP_ConfigData, ucValue);\n\tOutByteDsp(DSP_IsaSlaveControl, MKBYTE(rSlaveControl_Save));\n\n\tPRINTK_1(TRACE_3780I, \"3780i::dsp3780i_WriteGenCfg exit\\n\");\n\n\n}\n\n#if 0\nunsigned char dsp3780I_ReadGenCfg(unsigned short usDspBaseIO,\n                                  unsigned uIndex)\n{\n\tDSP_ISA_SLAVE_CONTROL rSlaveControl;\n\tDSP_ISA_SLAVE_CONTROL rSlaveControl_Save;\n\tunsigned char ucValue;\n\n\n\tPRINTK_3(TRACE_3780I,\n\t\t\"3780i::dsp3780i_ReadGenCfg entry usDspBaseIO %x uIndex %x\\n\",\n\t\tusDspBaseIO, uIndex);\n\n\tMKBYTE(rSlaveControl) = InByteDsp(DSP_IsaSlaveControl);\n\trSlaveControl_Save = rSlaveControl;\n\trSlaveControl.ConfigMode = true;\n\tOutByteDsp(DSP_IsaSlaveControl, MKBYTE(rSlaveControl));\n\tOutByteDsp(DSP_ConfigAddress, (unsigned char) uIndex);\n\tucValue = InByteDsp(DSP_ConfigData);\n\tOutByteDsp(DSP_IsaSlaveControl, MKBYTE(rSlaveControl_Save));\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780i_ReadGenCfg exit ucValue %x\\n\", ucValue);\n\n\n\treturn ucValue;\n}\n#endif   \n\nint dsp3780I_EnableDSP(DSP_3780I_CONFIG_SETTINGS * pSettings,\n                       unsigned short *pIrqMap,\n                       unsigned short *pDmaMap)\n{\n\tunsigned long flags;\n\tunsigned short usDspBaseIO = pSettings->usDspBaseIO;\n\tint i;\n\tDSP_UART_CFG_1 rUartCfg1;\n\tDSP_UART_CFG_2 rUartCfg2;\n\tDSP_HBRIDGE_CFG_1 rHBridgeCfg1;\n\tDSP_HBRIDGE_CFG_2 rHBridgeCfg2;\n\tDSP_BUSMASTER_CFG_1 rBusmasterCfg1;\n\tDSP_BUSMASTER_CFG_2 rBusmasterCfg2;\n\tDSP_ISA_PROT_CFG rIsaProtCfg;\n\tDSP_POWER_MGMT_CFG rPowerMgmtCfg;\n\tDSP_HBUS_TIMER_CFG rHBusTimerCfg;\n\tDSP_LBUS_TIMEOUT_DISABLE rLBusTimeoutDisable;\n\tDSP_CHIP_RESET rChipReset;\n\tDSP_CLOCK_CONTROL_1 rClockControl1;\n\tDSP_CLOCK_CONTROL_2 rClockControl2;\n\tDSP_ISA_SLAVE_CONTROL rSlaveControl;\n\tDSP_HBRIDGE_CONTROL rHBridgeControl;\n\tunsigned short ChipID = 0;\n\tunsigned short tval;\n\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780I_EnableDSP entry pSettings->bDSPEnabled %x\\n\",\n\t\tpSettings->bDSPEnabled);\n\n\n\tif (!pSettings->bDSPEnabled) {\n\t\tPRINTK_ERROR( KERN_ERR \"3780i::dsp3780I_EnableDSP: Error: DSP not enabled. Aborting.\\n\" );\n\t\treturn -EIO;\n\t}\n\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780i_EnableDSP entry pSettings->bModemEnabled %x\\n\",\n\t\tpSettings->bModemEnabled);\n\n\tif (pSettings->bModemEnabled) {\n\t\trUartCfg1.Reserved = rUartCfg2.Reserved = 0;\n\t\trUartCfg1.IrqActiveLow = pSettings->bUartIrqActiveLow;\n\t\trUartCfg1.IrqPulse = pSettings->bUartIrqPulse;\n\t\trUartCfg1.Irq =\n\t\t\t(unsigned char) pIrqMap[pSettings->usUartIrq];\n\t\tswitch (pSettings->usUartBaseIO) {\n\t\tcase 0x03F8:\n\t\t\trUartCfg1.BaseIO = 0;\n\t\t\tbreak;\n\t\tcase 0x02F8:\n\t\t\trUartCfg1.BaseIO = 1;\n\t\t\tbreak;\n\t\tcase 0x03E8:\n\t\t\trUartCfg1.BaseIO = 2;\n\t\t\tbreak;\n\t\tcase 0x02E8:\n\t\t\trUartCfg1.BaseIO = 3;\n\t\t\tbreak;\n\t\t}\n\t\trUartCfg2.Enable = true;\n\t}\n\n\trHBridgeCfg1.Reserved = rHBridgeCfg2.Reserved = 0;\n\trHBridgeCfg1.IrqActiveLow = pSettings->bDspIrqActiveLow;\n\trHBridgeCfg1.IrqPulse = pSettings->bDspIrqPulse;\n\trHBridgeCfg1.Irq = (unsigned char) pIrqMap[pSettings->usDspIrq];\n\trHBridgeCfg1.AccessMode = 1;\n\trHBridgeCfg2.Enable = true;\n\n\n\trBusmasterCfg2.Reserved = 0;\n\trBusmasterCfg1.Dma = (unsigned char) pDmaMap[pSettings->usDspDma];\n\trBusmasterCfg1.NumTransfers =\n\t\t(unsigned char) pSettings->usNumTransfers;\n\trBusmasterCfg1.ReRequest = (unsigned char) pSettings->usReRequest;\n\trBusmasterCfg1.MEMCS16 = pSettings->bEnableMEMCS16;\n\trBusmasterCfg2.IsaMemCmdWidth =\n\t\t(unsigned char) pSettings->usIsaMemCmdWidth;\n\n\n\trIsaProtCfg.Reserved = 0;\n\trIsaProtCfg.GateIOCHRDY = pSettings->bGateIOCHRDY;\n\n\trPowerMgmtCfg.Reserved = 0;\n\trPowerMgmtCfg.Enable = pSettings->bEnablePwrMgmt;\n\n\trHBusTimerCfg.LoadValue =\n\t\t(unsigned char) pSettings->usHBusTimerLoadValue;\n\n\trLBusTimeoutDisable.Reserved = 0;\n\trLBusTimeoutDisable.DisableTimeout =\n\t\tpSettings->bDisableLBusTimeout;\n\n\tMKWORD(rChipReset) = ~pSettings->usChipletEnable;\n\n\trClockControl1.Reserved1 = rClockControl1.Reserved2 = 0;\n\trClockControl1.N_Divisor = pSettings->usN_Divisor;\n\trClockControl1.M_Multiplier = pSettings->usM_Multiplier;\n\n\trClockControl2.Reserved = 0;\n\trClockControl2.PllBypass = pSettings->bPllBypass;\n\n\t \n\t \n\trSlaveControl.ClockControl = 0;\n\trSlaveControl.SoftReset = true;\n\trSlaveControl.ConfigMode = false;\n\trSlaveControl.Reserved = 0;\n\n\tPRINTK_4(TRACE_3780I,\n\t\t\"3780i::dsp3780i_EnableDSP usDspBaseIO %x index %x taddr %x\\n\",\n\t\tusDspBaseIO, DSP_IsaSlaveControl,\n\t\tusDspBaseIO + DSP_IsaSlaveControl);\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780i_EnableDSP rSlaveContrl %x\\n\",\n\t\tMKWORD(rSlaveControl));\n\n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_IsaSlaveControl, MKWORD(rSlaveControl));\n\tMKWORD(tval) = InWordDsp(DSP_IsaSlaveControl);\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780i_EnableDSP rSlaveControl 2 %x\\n\", tval);\n\n\n\tfor (i = 0; i < 11; i++)\n\t\tudelay(2000);\n\n\trSlaveControl.SoftReset = false;\n\tOutWordDsp(DSP_IsaSlaveControl, MKWORD(rSlaveControl));\n\n\tMKWORD(tval) = InWordDsp(DSP_IsaSlaveControl);\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780i_EnableDSP rSlaveControl 3 %x\\n\", tval);\n\n\n\t \n\tWriteGenCfg(DSP_HBridgeCfg1Index, MKBYTE(rHBridgeCfg1));\n\tWriteGenCfg(DSP_HBridgeCfg2Index, MKBYTE(rHBridgeCfg2));\n\tWriteGenCfg(DSP_BusMasterCfg1Index, MKBYTE(rBusmasterCfg1));\n\tWriteGenCfg(DSP_BusMasterCfg2Index, MKBYTE(rBusmasterCfg2));\n\tWriteGenCfg(DSP_IsaProtCfgIndex, MKBYTE(rIsaProtCfg));\n\tWriteGenCfg(DSP_PowerMgCfgIndex, MKBYTE(rPowerMgmtCfg));\n\tWriteGenCfg(DSP_HBusTimerCfgIndex, MKBYTE(rHBusTimerCfg));\n\n\tif (pSettings->bModemEnabled) {\n\t\tWriteGenCfg(DSP_UartCfg1Index, MKBYTE(rUartCfg1));\n\t\tWriteGenCfg(DSP_UartCfg2Index, MKBYTE(rUartCfg2));\n\t}\n\n\n\trHBridgeControl.EnableDspInt = false;\n\trHBridgeControl.MemAutoInc = true;\n\trHBridgeControl.IoAutoInc = false;\n\trHBridgeControl.DiagnosticMode = false;\n\n\tPRINTK_3(TRACE_3780I,\n\t\t\"3780i::dsp3780i_EnableDSP DSP_HBridgeControl %x rHBridgeControl %x\\n\",\n\t\tDSP_HBridgeControl, MKWORD(rHBridgeControl));\n\n\tOutWordDsp(DSP_HBridgeControl, MKWORD(rHBridgeControl));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\tWriteMsaCfg(DSP_LBusTimeoutDisable, MKWORD(rLBusTimeoutDisable));\n\tWriteMsaCfg(DSP_ClockControl_1, MKWORD(rClockControl1));\n\tWriteMsaCfg(DSP_ClockControl_2, MKWORD(rClockControl2));\n\tWriteMsaCfg(DSP_ChipReset, MKWORD(rChipReset));\n\n\tChipID = ReadMsaCfg(DSP_ChipID);\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780I_EnableDSP exiting bRC=true, ChipID %x\\n\",\n\t\tChipID);\n\n\treturn 0;\n}\n\nint dsp3780I_DisableDSP(DSP_3780I_CONFIG_SETTINGS * pSettings)\n{\n\tunsigned long flags;\n\tunsigned short usDspBaseIO = pSettings->usDspBaseIO;\n\tDSP_ISA_SLAVE_CONTROL rSlaveControl;\n\n\n\tPRINTK_1(TRACE_3780I, \"3780i::dsp3780i_DisableDSP entry\\n\");\n\n\trSlaveControl.ClockControl = 0;\n\trSlaveControl.SoftReset = true;\n\trSlaveControl.ConfigMode = false;\n\trSlaveControl.Reserved = 0;\n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_IsaSlaveControl, MKWORD(rSlaveControl));\n\n\tudelay(5);\n\n\trSlaveControl.ClockControl = 1;\n\tOutWordDsp(DSP_IsaSlaveControl, MKWORD(rSlaveControl));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\tudelay(5);\n\n\n\tPRINTK_1(TRACE_3780I, \"3780i::dsp3780i_DisableDSP exit\\n\");\n\n\treturn 0;\n}\n\nint dsp3780I_Reset(DSP_3780I_CONFIG_SETTINGS * pSettings)\n{\n\tunsigned long flags;\n\tunsigned short usDspBaseIO = pSettings->usDspBaseIO;\n\tDSP_BOOT_DOMAIN rBootDomain;\n\tDSP_HBRIDGE_CONTROL rHBridgeControl;\n\n\n\tPRINTK_1(TRACE_3780I, \"3780i::dsp3780i_Reset entry\\n\");\n\n\tspin_lock_irqsave(&dsp_lock, flags);\n\t \n\tMKWORD(rHBridgeControl) = InWordDsp(DSP_HBridgeControl);\n\n\tPRINTK_2(TRACE_3780I, \"3780i::dsp3780i_Reset rHBridgeControl %x\\n\",\n\t\tMKWORD(rHBridgeControl));\n\n\trHBridgeControl.EnableDspInt = false;\n\tOutWordDsp(DSP_HBridgeControl, MKWORD(rHBridgeControl));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t \n\trBootDomain.ResetCore = true;\n\trBootDomain.Halt = true;\n\trBootDomain.NMI = true;\n\trBootDomain.Reserved = 0;\n\n\tPRINTK_2(TRACE_3780I, \"3780i::dsp3780i_Reset rBootDomain %x\\n\",\n\t\tMKWORD(rBootDomain));\n\n\tWriteMsaCfg(DSP_MspBootDomain, MKWORD(rBootDomain));\n\n\t \n\tWriteMsaCfg(DSP_ChipReset, 0xFFFF);\n\tudelay(5);\n\tWriteMsaCfg(DSP_ChipReset,\n\t\t\t(unsigned short) (~pSettings->usChipletEnable));\n\n\n\tPRINTK_1(TRACE_3780I, \"3780i::dsp3780i_Reset exit bRC=0\\n\");\n\n\treturn 0;\n}\n\n\nint dsp3780I_Run(DSP_3780I_CONFIG_SETTINGS * pSettings)\n{\n\tunsigned long flags;\n\tunsigned short usDspBaseIO = pSettings->usDspBaseIO;\n\tDSP_BOOT_DOMAIN rBootDomain;\n\tDSP_HBRIDGE_CONTROL rHBridgeControl;\n\n\n\tPRINTK_1(TRACE_3780I, \"3780i::dsp3780i_Run entry\\n\");\n\n\n\t \n\trBootDomain.ResetCore = true;\n\trBootDomain.Halt = false;\n\trBootDomain.NMI = true;\n\trBootDomain.Reserved = 0;\n\tWriteMsaCfg(DSP_MspBootDomain, MKWORD(rBootDomain));\n\n\tudelay(5);\n\n\trBootDomain.ResetCore = false;\n\tWriteMsaCfg(DSP_MspBootDomain, MKWORD(rBootDomain));\n\tudelay(5);\n\n\trBootDomain.NMI = false;\n\tWriteMsaCfg(DSP_MspBootDomain, MKWORD(rBootDomain));\n\tudelay(5);\n\n\t \n\tspin_lock_irqsave(&dsp_lock, flags);\n\tMKWORD(rHBridgeControl) = InWordDsp(DSP_HBridgeControl);\n\trHBridgeControl.EnableDspInt = true;\n\n\tPRINTK_2(TRACE_3780I, \"3780i::dsp3780i_Run rHBridgeControl %x\\n\",\n\t\tMKWORD(rHBridgeControl));\n\n\tOutWordDsp(DSP_HBridgeControl, MKWORD(rHBridgeControl));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\n\tPRINTK_1(TRACE_3780I, \"3780i::dsp3780i_Run exit bRC=true\\n\");\n\n\treturn 0;\n}\n\n\nint dsp3780I_ReadDStore(unsigned short usDspBaseIO, void __user *pvBuffer,\n                        unsigned uCount, unsigned long ulDSPAddr)\n{\n\tunsigned long flags;\n\tunsigned short __user *pusBuffer = pvBuffer;\n\tunsigned short val;\n\n\n\tPRINTK_5(TRACE_3780I,\n\t\t\"3780i::dsp3780I_ReadDStore entry usDspBaseIO %x, pusBuffer %p, uCount %x, ulDSPAddr %lx\\n\",\n\t\tusDspBaseIO, pusBuffer, uCount, ulDSPAddr);\n\n\n\t \n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_MsaAddrLow, (unsigned short) ulDSPAddr);\n\tOutWordDsp(DSP_MsaAddrHigh, (unsigned short) (ulDSPAddr >> 16));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t \n\twhile (uCount-- != 0) {\n\t\tspin_lock_irqsave(&dsp_lock, flags);\n\t\tval = InWordDsp(DSP_MsaDataDSISHigh);\n\t\tspin_unlock_irqrestore(&dsp_lock, flags);\n\t\tif(put_user(val, pusBuffer++))\n\t\t\treturn -EFAULT;\n\n\t\tPRINTK_3(TRACE_3780I,\n\t\t\t\"3780I::dsp3780I_ReadDStore uCount %x val %x\\n\",\n\t\t\tuCount, val);\n\n\t\tPaceMsaAccess(usDspBaseIO);\n\t}\n\n\n\tPRINTK_1(TRACE_3780I,\n\t\t\"3780I::dsp3780I_ReadDStore exit bRC=true\\n\");\n\n\treturn 0;\n}\n\nint dsp3780I_ReadAndClearDStore(unsigned short usDspBaseIO,\n                                void __user *pvBuffer, unsigned uCount,\n                                unsigned long ulDSPAddr)\n{\n\tunsigned long flags;\n\tunsigned short __user *pusBuffer = pvBuffer;\n\tunsigned short val;\n\n\n\tPRINTK_5(TRACE_3780I,\n\t\t\"3780i::dsp3780I_ReadAndDStore entry usDspBaseIO %x, pusBuffer %p, uCount %x, ulDSPAddr %lx\\n\",\n\t\tusDspBaseIO, pusBuffer, uCount, ulDSPAddr);\n\n\n\t \n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_MsaAddrLow, (unsigned short) ulDSPAddr);\n\tOutWordDsp(DSP_MsaAddrHigh, (unsigned short) (ulDSPAddr >> 16));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t \n\twhile (uCount-- != 0) {\n\t\tspin_lock_irqsave(&dsp_lock, flags);\n\t\tval = InWordDsp(DSP_ReadAndClear);\n\t\tspin_unlock_irqrestore(&dsp_lock, flags);\n\t\tif(put_user(val, pusBuffer++))\n\t\t\treturn -EFAULT;\n\n\t\tPRINTK_3(TRACE_3780I,\n\t\t\t\"3780I::dsp3780I_ReadAndCleanDStore uCount %x val %x\\n\",\n\t\t\tuCount, val);\n\n\t\tPaceMsaAccess(usDspBaseIO);\n\t}\n\n\n\tPRINTK_1(TRACE_3780I,\n\t\t\"3780I::dsp3780I_ReadAndClearDStore exit bRC=true\\n\");\n\n\treturn 0;\n}\n\n\nint dsp3780I_WriteDStore(unsigned short usDspBaseIO, void __user *pvBuffer,\n                         unsigned uCount, unsigned long ulDSPAddr)\n{\n\tunsigned long flags;\n\tunsigned short __user *pusBuffer = pvBuffer;\n\n\n\tPRINTK_5(TRACE_3780I,\n\t\t\"3780i::dsp3780D_WriteDStore entry usDspBaseIO %x, pusBuffer %p, uCount %x, ulDSPAddr %lx\\n\",\n\t\tusDspBaseIO, pusBuffer, uCount, ulDSPAddr);\n\n\n\t \n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_MsaAddrLow, (unsigned short) ulDSPAddr);\n\tOutWordDsp(DSP_MsaAddrHigh, (unsigned short) (ulDSPAddr >> 16));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t \n\twhile (uCount-- != 0) {\n\t\tunsigned short val;\n\t\tif(get_user(val, pusBuffer++))\n\t\t\treturn -EFAULT;\n\t\tspin_lock_irqsave(&dsp_lock, flags);\n\t\tOutWordDsp(DSP_MsaDataDSISHigh, val);\n\t\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t\tPRINTK_3(TRACE_3780I,\n\t\t\t\"3780I::dsp3780I_WriteDStore uCount %x val %x\\n\",\n\t\t\tuCount, val);\n\n\t\tPaceMsaAccess(usDspBaseIO);\n\t}\n\n\n\tPRINTK_1(TRACE_3780I,\n\t\t\"3780I::dsp3780D_WriteDStore exit bRC=true\\n\");\n\n\treturn 0;\n}\n\n\nint dsp3780I_ReadIStore(unsigned short usDspBaseIO, void __user *pvBuffer,\n                        unsigned uCount, unsigned long ulDSPAddr)\n{\n\tunsigned long flags;\n\tunsigned short __user *pusBuffer = pvBuffer;\n\n\tPRINTK_5(TRACE_3780I,\n\t\t\"3780i::dsp3780I_ReadIStore entry usDspBaseIO %x, pusBuffer %p, uCount %x, ulDSPAddr %lx\\n\",\n\t\tusDspBaseIO, pusBuffer, uCount, ulDSPAddr);\n\n\t \n\tulDSPAddr = (ulDSPAddr << 2) | (1 << 22);\n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_MsaAddrLow, (unsigned short) ulDSPAddr);\n\tOutWordDsp(DSP_MsaAddrHigh, (unsigned short) (ulDSPAddr >> 16));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t \n\twhile (uCount-- != 0) {\n\t\tunsigned short val_lo, val_hi;\n\t\tspin_lock_irqsave(&dsp_lock, flags);\n\t\tval_lo = InWordDsp(DSP_MsaDataISLow);\n\t\tval_hi = InWordDsp(DSP_MsaDataDSISHigh);\n\t\tspin_unlock_irqrestore(&dsp_lock, flags);\n\t\tif(put_user(val_lo, pusBuffer++))\n\t\t\treturn -EFAULT;\n\t\tif(put_user(val_hi, pusBuffer++))\n\t\t\treturn -EFAULT;\n\n\t\tPRINTK_4(TRACE_3780I,\n\t\t\t\"3780I::dsp3780I_ReadIStore uCount %x val_lo %x val_hi %x\\n\",\n\t\t\tuCount, val_lo, val_hi);\n\n\t\tPaceMsaAccess(usDspBaseIO);\n\n\t}\n\n\tPRINTK_1(TRACE_3780I,\n\t\t\"3780I::dsp3780I_ReadIStore exit bRC=true\\n\");\n\n\treturn 0;\n}\n\n\nint dsp3780I_WriteIStore(unsigned short usDspBaseIO, void __user *pvBuffer,\n                         unsigned uCount, unsigned long ulDSPAddr)\n{\n\tunsigned long flags;\n\tunsigned short __user *pusBuffer = pvBuffer;\n\n\tPRINTK_5(TRACE_3780I,\n\t\t\"3780i::dsp3780I_WriteIStore entry usDspBaseIO %x, pusBuffer %p, uCount %x, ulDSPAddr %lx\\n\",\n\t\tusDspBaseIO, pusBuffer, uCount, ulDSPAddr);\n\n\n\t \n\tulDSPAddr = (ulDSPAddr << 2) | (1 << 22);\n\tspin_lock_irqsave(&dsp_lock, flags);\n\tOutWordDsp(DSP_MsaAddrLow, (unsigned short) ulDSPAddr);\n\tOutWordDsp(DSP_MsaAddrHigh, (unsigned short) (ulDSPAddr >> 16));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t \n\twhile (uCount-- != 0) {\n\t\tunsigned short val_lo, val_hi;\n\t\tif(get_user(val_lo, pusBuffer++))\n\t\t\treturn -EFAULT;\n\t\tif(get_user(val_hi, pusBuffer++))\n\t\t\treturn -EFAULT;\n\t\tspin_lock_irqsave(&dsp_lock, flags);\n\t\tOutWordDsp(DSP_MsaDataISLow, val_lo);\n\t\tOutWordDsp(DSP_MsaDataDSISHigh, val_hi);\n\t\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\t\tPRINTK_4(TRACE_3780I,\n\t\t\t\"3780I::dsp3780I_WriteIStore uCount %x val_lo %x val_hi %x\\n\",\n\t\t\tuCount, val_lo, val_hi);\n\n\t\tPaceMsaAccess(usDspBaseIO);\n\n\t}\n\n\tPRINTK_1(TRACE_3780I,\n\t\t\"3780I::dsp3780I_WriteIStore exit bRC=true\\n\");\n\n\treturn 0;\n}\n\n\nint dsp3780I_GetIPCSource(unsigned short usDspBaseIO,\n                          unsigned short *pusIPCSource)\n{\n\tunsigned long flags;\n\tDSP_HBRIDGE_CONTROL rHBridgeControl;\n\tunsigned short temp;\n\n\n\tPRINTK_3(TRACE_3780I,\n\t\t\"3780i::dsp3780I_GetIPCSource entry usDspBaseIO %x pusIPCSource %p\\n\",\n\t\tusDspBaseIO, pusIPCSource);\n\n\t \n\tspin_lock_irqsave(&dsp_lock, flags);\n\tMKWORD(rHBridgeControl) = InWordDsp(DSP_HBridgeControl);\n\trHBridgeControl.EnableDspInt = false;\n\tOutWordDsp(DSP_HBridgeControl, MKWORD(rHBridgeControl));\n\n\t*pusIPCSource = InWordDsp(DSP_Interrupt);\n\ttemp = (unsigned short) ~(*pusIPCSource);\n\n\tPRINTK_3(TRACE_3780I,\n\t\t\"3780i::dsp3780I_GetIPCSource, usIPCSource %x ~ %x\\n\",\n\t\t*pusIPCSource, temp);\n\n\tOutWordDsp(DSP_Interrupt, (unsigned short) ~(*pusIPCSource));\n\n\trHBridgeControl.EnableDspInt = true;\n\tOutWordDsp(DSP_HBridgeControl, MKWORD(rHBridgeControl));\n\tspin_unlock_irqrestore(&dsp_lock, flags);\n\n\n\tPRINTK_2(TRACE_3780I,\n\t\t\"3780i::dsp3780I_GetIPCSource exit usIPCSource %x\\n\",\n\t\t*pusIPCSource);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}