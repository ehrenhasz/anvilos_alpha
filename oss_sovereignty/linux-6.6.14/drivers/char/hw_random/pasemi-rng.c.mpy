{
  "module_name": "pasemi-rng.c",
  "hash_id": "221c6fc3f8eaae88154f5081fabffdf4c7b5b1d676cdb9a63c26f9c21dcdcd70",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/hw_random/pasemi-rng.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/mod_devicetable.h>\n#include <linux/platform_device.h>\n#include <linux/hw_random.h>\n#include <linux/delay.h>\n#include <linux/io.h>\n\n#define SDCRNG_CTL_REG\t\t\t0x00\n#define   SDCRNG_CTL_FVLD_M\t\t0x0000f000\n#define   SDCRNG_CTL_FVLD_S\t\t12\n#define   SDCRNG_CTL_KSZ\t\t0x00000800\n#define   SDCRNG_CTL_RSRC_CRG\t\t0x00000010\n#define   SDCRNG_CTL_RSRC_RRG\t\t0x00000000\n#define   SDCRNG_CTL_CE\t\t\t0x00000004\n#define   SDCRNG_CTL_RE\t\t\t0x00000002\n#define   SDCRNG_CTL_DR\t\t\t0x00000001\n#define   SDCRNG_CTL_SELECT_RRG_RNG\t(SDCRNG_CTL_RE | SDCRNG_CTL_RSRC_RRG)\n#define   SDCRNG_CTL_SELECT_CRG_RNG\t(SDCRNG_CTL_CE | SDCRNG_CTL_RSRC_CRG)\n#define SDCRNG_VAL_REG\t\t\t0x20\n\n#define MODULE_NAME \"pasemi_rng\"\n\nstatic int pasemi_rng_data_present(struct hwrng *rng, int wait)\n{\n\tvoid __iomem *rng_regs = (void __iomem *)rng->priv;\n\tint data, i;\n\n\tfor (i = 0; i < 20; i++) {\n\t\tdata = (in_le32(rng_regs + SDCRNG_CTL_REG)\n\t\t\t& SDCRNG_CTL_FVLD_M) ? 1 : 0;\n\t\tif (data || !wait)\n\t\t\tbreak;\n\t\tudelay(10);\n\t}\n\treturn data;\n}\n\nstatic int pasemi_rng_data_read(struct hwrng *rng, u32 *data)\n{\n\tvoid __iomem *rng_regs = (void __iomem *)rng->priv;\n\t*data = in_le32(rng_regs + SDCRNG_VAL_REG);\n\treturn 4;\n}\n\nstatic int pasemi_rng_init(struct hwrng *rng)\n{\n\tvoid __iomem *rng_regs = (void __iomem *)rng->priv;\n\tu32 ctl;\n\n\tctl = SDCRNG_CTL_DR | SDCRNG_CTL_SELECT_RRG_RNG | SDCRNG_CTL_KSZ;\n\tout_le32(rng_regs + SDCRNG_CTL_REG, ctl);\n\tout_le32(rng_regs + SDCRNG_CTL_REG, ctl & ~SDCRNG_CTL_DR);\n\n\treturn 0;\n}\n\nstatic void pasemi_rng_cleanup(struct hwrng *rng)\n{\n\tvoid __iomem *rng_regs = (void __iomem *)rng->priv;\n\tu32 ctl;\n\n\tctl = SDCRNG_CTL_RE | SDCRNG_CTL_CE;\n\tout_le32(rng_regs + SDCRNG_CTL_REG,\n\t\t in_le32(rng_regs + SDCRNG_CTL_REG) & ~ctl);\n}\n\nstatic struct hwrng pasemi_rng = {\n\t.name\t\t= MODULE_NAME,\n\t.init\t\t= pasemi_rng_init,\n\t.cleanup\t= pasemi_rng_cleanup,\n\t.data_present\t= pasemi_rng_data_present,\n\t.data_read\t= pasemi_rng_data_read,\n};\n\nstatic int rng_probe(struct platform_device *pdev)\n{\n\tvoid __iomem *rng_regs;\n\n\trng_regs = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(rng_regs))\n\t\treturn PTR_ERR(rng_regs);\n\n\tpasemi_rng.priv = (unsigned long)rng_regs;\n\n\tpr_info(\"Registering PA Semi RNG\\n\");\n\treturn devm_hwrng_register(&pdev->dev, &pasemi_rng);\n}\n\nstatic const struct of_device_id rng_match[] = {\n\t{ .compatible      = \"1682m-rng\", },\n\t{ .compatible      = \"pasemi,pwrficient-rng\", },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, rng_match);\n\nstatic struct platform_driver rng_driver = {\n\t.driver = {\n\t\t.name = \"pasemi-rng\",\n\t\t.of_match_table = rng_match,\n\t},\n\t.probe\t\t= rng_probe,\n};\n\nmodule_platform_driver(rng_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Egor Martovetsky <egor@pasemi.com>\");\nMODULE_DESCRIPTION(\"H/W RNG driver for PA Semi processor\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}