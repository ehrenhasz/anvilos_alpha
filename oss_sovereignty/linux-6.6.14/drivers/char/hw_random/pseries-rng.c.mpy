{
  "module_name": "pseries-rng.c",
  "hash_id": "12297317e7cd0ebbc35a3833754d52bbb09b9ed76f6b4e8a00b7c99b25fb82ff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/hw_random/pseries-rng.c",
  "human_readable_source": "\n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/hw_random.h>\n#include <asm/vio.h>\n\n\nstatic int pseries_rng_read(struct hwrng *rng, void *data, size_t max, bool wait)\n{\n\tu64 buffer[PLPAR_HCALL_BUFSIZE];\n\tint rc;\n\n\trc = plpar_hcall(H_RANDOM, (unsigned long *)buffer);\n\tif (rc != H_SUCCESS) {\n\t\tpr_err_ratelimited(\"H_RANDOM call failed %d\\n\", rc);\n\t\treturn -EIO;\n\t}\n\tmemcpy(data, buffer, 8);\n\n\t \n\treturn 8;\n}\n\n \nstatic unsigned long pseries_rng_get_desired_dma(struct vio_dev *vdev)\n{\n\treturn 0;\n};\n\nstatic struct hwrng pseries_rng = {\n\t.name\t\t= KBUILD_MODNAME,\n\t.read\t\t= pseries_rng_read,\n};\n\nstatic int pseries_rng_probe(struct vio_dev *dev,\n\t\tconst struct vio_device_id *id)\n{\n\treturn hwrng_register(&pseries_rng);\n}\n\nstatic void pseries_rng_remove(struct vio_dev *dev)\n{\n\thwrng_unregister(&pseries_rng);\n}\n\nstatic const struct vio_device_id pseries_rng_driver_ids[] = {\n\t{ \"ibm,random-v1\", \"ibm,random\"},\n\t{ \"\", \"\" }\n};\nMODULE_DEVICE_TABLE(vio, pseries_rng_driver_ids);\n\nstatic struct vio_driver pseries_rng_driver = {\n\t.name = KBUILD_MODNAME,\n\t.probe = pseries_rng_probe,\n\t.remove = pseries_rng_remove,\n\t.get_desired_dma = pseries_rng_get_desired_dma,\n\t.id_table = pseries_rng_driver_ids\n};\n\nstatic int __init rng_init(void)\n{\n\tpr_info(\"Registering IBM pSeries RNG driver\\n\");\n\treturn vio_register_driver(&pseries_rng_driver);\n}\n\nmodule_init(rng_init);\n\nstatic void __exit rng_exit(void)\n{\n\tvio_unregister_driver(&pseries_rng_driver);\n}\nmodule_exit(rng_exit);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_AUTHOR(\"Michael Neuling <mikey@neuling.org>\");\nMODULE_DESCRIPTION(\"H/W RNG driver for IBM pSeries processors\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}