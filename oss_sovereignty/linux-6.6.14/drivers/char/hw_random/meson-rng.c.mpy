{
  "module_name": "meson-rng.c",
  "hash_id": "0cba2a843b565215a96ec35a35105140fe5c66703f4f398f364d809f233da190",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/hw_random/meson-rng.c",
  "human_readable_source": "\n \n#include <linux/err.h>\n#include <linux/module.h>\n#include <linux/io.h>\n#include <linux/platform_device.h>\n#include <linux/hw_random.h>\n#include <linux/slab.h>\n#include <linux/types.h>\n#include <linux/of.h>\n#include <linux/clk.h>\n\n#define RNG_DATA 0x00\n\nstruct meson_rng_data {\n\tvoid __iomem *base;\n\tstruct hwrng rng;\n};\n\nstatic int meson_rng_read(struct hwrng *rng, void *buf, size_t max, bool wait)\n{\n\tstruct meson_rng_data *data =\n\t\t\tcontainer_of(rng, struct meson_rng_data, rng);\n\n\t*(u32 *)buf = readl_relaxed(data->base + RNG_DATA);\n\n\treturn sizeof(u32);\n}\n\nstatic int meson_rng_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct meson_rng_data *data;\n\tstruct clk *core_clk;\n\n\tdata = devm_kzalloc(dev, sizeof(*data), GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tdata->base = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(data->base))\n\t\treturn PTR_ERR(data->base);\n\n\tcore_clk = devm_clk_get_optional_enabled(dev, \"core\");\n\tif (IS_ERR(core_clk))\n\t\treturn dev_err_probe(dev, PTR_ERR(core_clk),\n\t\t\t\t     \"Failed to get core clock\\n\");\n\n\tdata->rng.name = pdev->name;\n\tdata->rng.read = meson_rng_read;\n\n\treturn devm_hwrng_register(dev, &data->rng);\n}\n\nstatic const struct of_device_id meson_rng_of_match[] = {\n\t{ .compatible = \"amlogic,meson-rng\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, meson_rng_of_match);\n\nstatic struct platform_driver meson_rng_driver = {\n\t.probe\t= meson_rng_probe,\n\t.driver\t= {\n\t\t.name = \"meson-rng\",\n\t\t.of_match_table = meson_rng_of_match,\n\t},\n};\n\nmodule_platform_driver(meson_rng_driver);\n\nMODULE_DESCRIPTION(\"Meson H/W Random Number Generator driver\");\nMODULE_AUTHOR(\"Lawrence Mok <lawrence.mok@amlogic.com>\");\nMODULE_AUTHOR(\"Neil Armstrong <narmstrong@baylibre.com>\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}