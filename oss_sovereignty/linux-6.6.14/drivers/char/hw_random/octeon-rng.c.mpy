{
  "module_name": "octeon-rng.c",
  "hash_id": "6a016b98cff7814ea27f389c66c208b0956759b884eab33f3c371391034092ee",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/hw_random/octeon-rng.c",
  "human_readable_source": " \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/device.h>\n#include <linux/hw_random.h>\n#include <linux/io.h>\n#include <linux/gfp.h>\n\n#include <asm/octeon/octeon.h>\n#include <asm/octeon/cvmx-rnm-defs.h>\n\nstruct octeon_rng {\n\tstruct hwrng ops;\n\tvoid __iomem *control_status;\n\tvoid __iomem *result;\n};\n\nstatic int octeon_rng_init(struct hwrng *rng)\n{\n\tunion cvmx_rnm_ctl_status ctl;\n\tstruct octeon_rng *p = container_of(rng, struct octeon_rng, ops);\n\n\tctl.u64 = 0;\n\tctl.s.ent_en = 1;  \n\tctl.s.rng_en = 1;  \n\tcvmx_write_csr((__force u64)p->control_status, ctl.u64);\n\treturn 0;\n}\n\nstatic void octeon_rng_cleanup(struct hwrng *rng)\n{\n\tunion cvmx_rnm_ctl_status ctl;\n\tstruct octeon_rng *p = container_of(rng, struct octeon_rng, ops);\n\n\tctl.u64 = 0;\n\t \n\tcvmx_write_csr((__force u64)p->control_status, ctl.u64);\n}\n\nstatic int octeon_rng_data_read(struct hwrng *rng, u32 *data)\n{\n\tstruct octeon_rng *p = container_of(rng, struct octeon_rng, ops);\n\n\t*data = cvmx_read64_uint32((__force u64)p->result);\n\treturn sizeof(u32);\n}\n\nstatic int octeon_rng_probe(struct platform_device *pdev)\n{\n\tstruct resource *res_ports;\n\tstruct resource *res_result;\n\tstruct octeon_rng *rng;\n\tint ret;\n\tstruct hwrng ops = {\n\t\t.name = \"octeon\",\n\t\t.init = octeon_rng_init,\n\t\t.cleanup = octeon_rng_cleanup,\n\t\t.data_read = octeon_rng_data_read\n\t};\n\n\trng = devm_kzalloc(&pdev->dev, sizeof(*rng), GFP_KERNEL);\n\tif (!rng)\n\t\treturn -ENOMEM;\n\n\tres_ports = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\tif (!res_ports)\n\t\treturn -ENOENT;\n\n\tres_result = platform_get_resource(pdev, IORESOURCE_MEM, 1);\n\tif (!res_result)\n\t\treturn -ENOENT;\n\n\n\trng->control_status = devm_ioremap(&pdev->dev,\n\t\t\t\t\t\t   res_ports->start,\n\t\t\t\t\t\t   sizeof(u64));\n\tif (!rng->control_status)\n\t\treturn -ENOENT;\n\n\trng->result = devm_ioremap(&pdev->dev,\n\t\t\t\t\t   res_result->start,\n\t\t\t\t\t   sizeof(u64));\n\tif (!rng->result)\n\t\treturn -ENOENT;\n\n\trng->ops = ops;\n\n\tplatform_set_drvdata(pdev, &rng->ops);\n\tret = devm_hwrng_register(&pdev->dev, &rng->ops);\n\tif (ret)\n\t\treturn -ENOENT;\n\n\tdev_info(&pdev->dev, \"Octeon Random Number Generator\\n\");\n\n\treturn 0;\n}\n\nstatic struct platform_driver octeon_rng_driver = {\n\t.driver = {\n\t\t.name\t\t= \"octeon_rng\",\n\t},\n\t.probe\t\t= octeon_rng_probe,\n};\n\nmodule_platform_driver(octeon_rng_driver);\n\nMODULE_AUTHOR(\"David Daney\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}