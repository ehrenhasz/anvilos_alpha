{
  "module_name": "nomadik-rng.c",
  "hash_id": "a3ff90b721de702c9de9d36afbfff16c3457f22d898f3c09648558e76020063c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/char/hw_random/nomadik-rng.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/amba/bus.h>\n#include <linux/hw_random.h>\n#include <linux/io.h>\n#include <linux/clk.h>\n#include <linux/err.h>\n\nstatic int nmk_rng_read(struct hwrng *rng, void *data, size_t max, bool wait)\n{\n\tvoid __iomem *base = (void __iomem *)rng->priv;\n\n\t \n\t*(u16 *)data = __raw_readl(base + 8) & 0xffff;\n\treturn 2;\n}\n\n \nstatic struct hwrng nmk_rng = {\n\t.name\t\t= \"nomadik\",\n\t.read\t\t= nmk_rng_read,\n};\n\nstatic int nmk_rng_probe(struct amba_device *dev, const struct amba_id *id)\n{\n\tstruct clk *rng_clk;\n\tvoid __iomem *base;\n\tint ret;\n\n\trng_clk = devm_clk_get_enabled(&dev->dev, NULL);\n\tif (IS_ERR(rng_clk))\n\t\treturn dev_err_probe(&dev->dev, PTR_ERR(rng_clk), \"could not get rng clock\\n\");\n\n\tret = amba_request_regions(dev, dev->dev.init_name);\n\tif (ret)\n\t\treturn ret;\n\tret = -ENOMEM;\n\tbase = devm_ioremap(&dev->dev, dev->res.start,\n\t\t\t    resource_size(&dev->res));\n\tif (!base)\n\t\tgoto out_release;\n\tnmk_rng.priv = (unsigned long)base;\n\tret = devm_hwrng_register(&dev->dev, &nmk_rng);\n\tif (ret)\n\t\tgoto out_release;\n\treturn 0;\n\nout_release:\n\tamba_release_regions(dev);\n\treturn ret;\n}\n\nstatic void nmk_rng_remove(struct amba_device *dev)\n{\n\tamba_release_regions(dev);\n}\n\nstatic const struct amba_id nmk_rng_ids[] = {\n\t{\n\t\t.id\t= 0x000805e1,\n\t\t.mask\t= 0x000fffff,  \n\t},\n\t{0, 0},\n};\n\nMODULE_DEVICE_TABLE(amba, nmk_rng_ids);\n\nstatic struct amba_driver nmk_rng_driver = {\n\t.drv = {\n\t\t.owner = THIS_MODULE,\n\t\t.name = \"rng\",\n\t\t},\n\t.probe = nmk_rng_probe,\n\t.remove = nmk_rng_remove,\n\t.id_table = nmk_rng_ids,\n};\n\nmodule_amba_driver(nmk_rng_driver);\n\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}