{
  "module_name": "userimask.c",
  "hash_id": "f7a7460686573830184f63a9bcc36eb402ce395eb6afcd6fcaa8a50fa33434dd",
  "original_prompt": "Ingested from linux-6.6.14/drivers/sh/intc/userimask.c",
  "human_readable_source": " \n#define pr_fmt(fmt) \"intc: \" fmt\n\n#include <linux/errno.h>\n#include <linux/device.h>\n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/stat.h>\n#include <linux/sizes.h>\n#include \"internals.h\"\n\nstatic void __iomem *uimask;\n\nstatic ssize_t\nshow_intc_userimask(struct device *dev,\n\t\t    struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%d\\n\", (__raw_readl(uimask) >> 4) & 0xf);\n}\n\nstatic ssize_t\nstore_intc_userimask(struct device *dev,\n\t\t     struct device_attribute *attr,\n\t\t     const char *buf, size_t count)\n{\n\tunsigned long level;\n\n\tlevel = simple_strtoul(buf, NULL, 10);\n\n\t \n\tif (level >= intc_get_dfl_prio_level())\n\t\treturn -EINVAL;\n\n\t__raw_writel(0xa5 << 24 | level << 4, uimask);\n\n\treturn count;\n}\n\nstatic DEVICE_ATTR(userimask, S_IRUSR | S_IWUSR,\n\t\t   show_intc_userimask, store_intc_userimask);\n\n\nstatic int __init userimask_sysdev_init(void)\n{\n\tstruct device *dev_root;\n\tint ret = 0;\n\n\tif (unlikely(!uimask))\n\t\treturn -ENXIO;\n\n\tdev_root = bus_get_dev_root(&intc_subsys);\n\tif (dev_root) {\n\t\tret = device_create_file(dev_root, &dev_attr_userimask);\n\t\tput_device(dev_root);\n\t}\n\treturn ret;\n}\nlate_initcall(userimask_sysdev_init);\n\nint register_intc_userimask(unsigned long addr)\n{\n\tif (unlikely(uimask))\n\t\treturn -EBUSY;\n\n\tuimask = ioremap(addr, SZ_4K);\n\tif (unlikely(!uimask))\n\t\treturn -ENOMEM;\n\n\tpr_info(\"userimask support registered for levels 0 -> %d\\n\",\n\t\tintc_get_dfl_prio_level() - 1);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}