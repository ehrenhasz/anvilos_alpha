{
  "module_name": "access.c",
  "hash_id": "6913a790e831296e9c8a7bbd71bcdf3d7cd9fe858a417e851c57e8498ed774c6",
  "original_prompt": "Ingested from linux-6.6.14/drivers/sh/intc/access.c",
  "human_readable_source": " \n#include <linux/io.h>\n#include \"internals.h\"\n\nunsigned long intc_phys_to_virt(struct intc_desc_int *d, unsigned long address)\n{\n\tstruct intc_window *window;\n\tint k;\n\n\t \n\tfor (k = 0; k < d->nr_windows; k++) {\n\t\twindow = d->window + k;\n\n\t\tif (address < window->phys)\n\t\t\tcontinue;\n\n\t\tif (address >= (window->phys + window->size))\n\t\t\tcontinue;\n\n\t\taddress -= window->phys;\n\t\taddress += (unsigned long)window->virt;\n\n\t\treturn address;\n\t}\n\n\t \n\treturn address;\n}\n\nunsigned int intc_get_reg(struct intc_desc_int *d, unsigned long address)\n{\n\tunsigned int k;\n\n\taddress = intc_phys_to_virt(d, address);\n\n\tfor (k = 0; k < d->nr_reg; k++) {\n\t\tif (d->reg[k] == address)\n\t\t\treturn k;\n\t}\n\n\tBUG();\n\treturn 0;\n}\n\nunsigned int intc_set_field_from_handle(unsigned int value,\n\t\t\t\t\tunsigned int field_value,\n\t\t\t\t\tunsigned int handle)\n{\n\tunsigned int width = _INTC_WIDTH(handle);\n\tunsigned int shift = _INTC_SHIFT(handle);\n\n\tvalue &= ~(((1 << width) - 1) << shift);\n\tvalue |= field_value << shift;\n\treturn value;\n}\n\nunsigned long intc_get_field_from_handle(unsigned int value, unsigned int handle)\n{\n\tunsigned int width = _INTC_WIDTH(handle);\n\tunsigned int shift = _INTC_SHIFT(handle);\n\tunsigned int mask = ((1 << width) - 1) << shift;\n\n\treturn (value & mask) >> shift;\n}\n\nstatic unsigned long test_8(unsigned long addr, unsigned long h,\n\t\t\t    unsigned long ignore)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\treturn intc_get_field_from_handle(__raw_readb(ptr), h);\n}\n\nstatic unsigned long test_16(unsigned long addr, unsigned long h,\n\t\t\t     unsigned long ignore)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\treturn intc_get_field_from_handle(__raw_readw(ptr), h);\n}\n\nstatic unsigned long test_32(unsigned long addr, unsigned long h,\n\t\t\t     unsigned long ignore)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\treturn intc_get_field_from_handle(__raw_readl(ptr), h);\n}\n\nstatic unsigned long write_8(unsigned long addr, unsigned long h,\n\t\t\t     unsigned long data)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\t__raw_writeb(intc_set_field_from_handle(0, data, h), ptr);\n\t(void)__raw_readb(ptr);\t \n\treturn 0;\n}\n\nstatic unsigned long write_16(unsigned long addr, unsigned long h,\n\t\t\t      unsigned long data)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\t__raw_writew(intc_set_field_from_handle(0, data, h), ptr);\n\t(void)__raw_readw(ptr);\t \n\treturn 0;\n}\n\nstatic unsigned long write_32(unsigned long addr, unsigned long h,\n\t\t\t      unsigned long data)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\t__raw_writel(intc_set_field_from_handle(0, data, h), ptr);\n\t(void)__raw_readl(ptr);\t \n\treturn 0;\n}\n\nstatic unsigned long modify_8(unsigned long addr, unsigned long h,\n\t\t\t      unsigned long data)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\tunsigned long flags;\n\tunsigned int value;\n\tlocal_irq_save(flags);\n\tvalue = intc_set_field_from_handle(__raw_readb(ptr), data, h);\n\t__raw_writeb(value, ptr);\n\t(void)__raw_readb(ptr);\t \n\tlocal_irq_restore(flags);\n\treturn 0;\n}\n\nstatic unsigned long modify_16(unsigned long addr, unsigned long h,\n\t\t\t       unsigned long data)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\tunsigned long flags;\n\tunsigned int value;\n\tlocal_irq_save(flags);\n\tvalue = intc_set_field_from_handle(__raw_readw(ptr), data, h);\n\t__raw_writew(value, ptr);\n\t(void)__raw_readw(ptr);\t \n\tlocal_irq_restore(flags);\n\treturn 0;\n}\n\nstatic unsigned long modify_32(unsigned long addr, unsigned long h,\n\t\t\t       unsigned long data)\n{\n\tvoid __iomem *ptr = (void __iomem *)addr;\n\tunsigned long flags;\n\tunsigned int value;\n\tlocal_irq_save(flags);\n\tvalue = intc_set_field_from_handle(__raw_readl(ptr), data, h);\n\t__raw_writel(value, ptr);\n\t(void)__raw_readl(ptr);\t \n\tlocal_irq_restore(flags);\n\treturn 0;\n}\n\nstatic unsigned long intc_mode_field(unsigned long addr,\n\t\t\t\t     unsigned long handle,\n\t\t\t\t     unsigned long (*fn)(unsigned long,\n\t\t\t\t\t\tunsigned long,\n\t\t\t\t\t\tunsigned long),\n\t\t\t\t     unsigned int irq)\n{\n\treturn fn(addr, handle, ((1 << _INTC_WIDTH(handle)) - 1));\n}\n\nstatic unsigned long intc_mode_zero(unsigned long addr,\n\t\t\t\t    unsigned long handle,\n\t\t\t\t    unsigned long (*fn)(unsigned long,\n\t\t\t\t\t       unsigned long,\n\t\t\t\t\t       unsigned long),\n\t\t\t\t    unsigned int irq)\n{\n\treturn fn(addr, handle, 0);\n}\n\nstatic unsigned long intc_mode_prio(unsigned long addr,\n\t\t\t\t    unsigned long handle,\n\t\t\t\t    unsigned long (*fn)(unsigned long,\n\t\t\t\t\t       unsigned long,\n\t\t\t\t\t       unsigned long),\n\t\t\t\t    unsigned int irq)\n{\n\treturn fn(addr, handle, intc_get_prio_level(irq));\n}\n\nunsigned long (*intc_reg_fns[])(unsigned long addr,\n\t\t\t\tunsigned long h,\n\t\t\t\tunsigned long data) = {\n\t[REG_FN_TEST_BASE + 0] = test_8,\n\t[REG_FN_TEST_BASE + 1] = test_16,\n\t[REG_FN_TEST_BASE + 3] = test_32,\n\t[REG_FN_WRITE_BASE + 0] = write_8,\n\t[REG_FN_WRITE_BASE + 1] = write_16,\n\t[REG_FN_WRITE_BASE + 3] = write_32,\n\t[REG_FN_MODIFY_BASE + 0] = modify_8,\n\t[REG_FN_MODIFY_BASE + 1] = modify_16,\n\t[REG_FN_MODIFY_BASE + 3] = modify_32,\n};\n\nunsigned long (*intc_enable_fns[])(unsigned long addr,\n\t\t\t\t   unsigned long handle,\n\t\t\t\t   unsigned long (*fn)(unsigned long,\n\t\t\t\t\t    unsigned long,\n\t\t\t\t\t    unsigned long),\n\t\t\t\t   unsigned int irq) = {\n\t[MODE_ENABLE_REG] = intc_mode_field,\n\t[MODE_MASK_REG] = intc_mode_zero,\n\t[MODE_DUAL_REG] = intc_mode_field,\n\t[MODE_PRIO_REG] = intc_mode_prio,\n\t[MODE_PCLR_REG] = intc_mode_prio,\n};\n\nunsigned long (*intc_disable_fns[])(unsigned long addr,\n\t\t\t\t    unsigned long handle,\n\t\t\t\t    unsigned long (*fn)(unsigned long,\n\t\t\t\t\t     unsigned long,\n\t\t\t\t\t     unsigned long),\n\t\t\t\t    unsigned int irq) = {\n\t[MODE_ENABLE_REG] = intc_mode_zero,\n\t[MODE_MASK_REG] = intc_mode_field,\n\t[MODE_DUAL_REG] = intc_mode_field,\n\t[MODE_PRIO_REG] = intc_mode_zero,\n\t[MODE_PCLR_REG] = intc_mode_field,\n};\n\nunsigned long (*intc_enable_noprio_fns[])(unsigned long addr,\n\t\t\t\t\t  unsigned long handle,\n\t\t\t\t\t  unsigned long (*fn)(unsigned long,\n\t\t\t\t\t\tunsigned long,\n\t\t\t\t\t\tunsigned long),\n\t\t\t\t\t  unsigned int irq) = {\n\t[MODE_ENABLE_REG] = intc_mode_field,\n\t[MODE_MASK_REG] = intc_mode_zero,\n\t[MODE_DUAL_REG] = intc_mode_field,\n\t[MODE_PRIO_REG] = intc_mode_field,\n\t[MODE_PCLR_REG] = intc_mode_field,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}