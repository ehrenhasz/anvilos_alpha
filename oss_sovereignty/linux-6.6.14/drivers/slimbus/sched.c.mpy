{
  "module_name": "sched.c",
  "hash_id": "5ef227f6503b46e80efbca54174e34e01390c1aecb24629a454b17b3eec10eec",
  "original_prompt": "Ingested from linux-6.6.14/drivers/slimbus/sched.c",
  "human_readable_source": "\n \n\n#include <linux/errno.h>\n#include \"slimbus.h\"\n\n \nint slim_ctrl_clk_pause(struct slim_controller *ctrl, bool wakeup, u8 restart)\n{\n\tint i, ret = 0;\n\tunsigned long flags;\n\tstruct slim_sched *sched = &ctrl->sched;\n\tstruct slim_val_inf msg = {0, 0, NULL, NULL};\n\n\tDEFINE_SLIM_BCAST_TXN(txn, SLIM_MSG_MC_BEGIN_RECONFIGURATION,\n\t\t\t\t3, SLIM_LA_MANAGER, &msg);\n\n\tif (wakeup == false && restart > SLIM_CLK_UNSPECIFIED)\n\t\treturn -EINVAL;\n\n\tmutex_lock(&sched->m_reconf);\n\tif (wakeup) {\n\t\tif (sched->clk_state == SLIM_CLK_ACTIVE) {\n\t\t\tmutex_unlock(&sched->m_reconf);\n\t\t\treturn 0;\n\t\t}\n\n\t\t \n\t\tret = wait_for_completion_timeout(&sched->pause_comp,\n\t\t\t\tmsecs_to_jiffies(100));\n\t\tif (!ret) {\n\t\t\tmutex_unlock(&sched->m_reconf);\n\t\t\tpr_err(\"Previous clock pause did not finish\");\n\t\t\treturn -ETIMEDOUT;\n\t\t}\n\t\tret = 0;\n\n\t\t \n\t\tif (sched->clk_state == SLIM_CLK_PAUSED && ctrl->wakeup)\n\t\t\tret = ctrl->wakeup(ctrl);\n\t\tif (!ret)\n\t\t\tsched->clk_state = SLIM_CLK_ACTIVE;\n\t\tmutex_unlock(&sched->m_reconf);\n\n\t\treturn ret;\n\t}\n\n\t \n\tif (ctrl->sched.clk_state == SLIM_CLK_PAUSED) {\n\t\tmutex_unlock(&sched->m_reconf);\n\t\treturn 0;\n\t}\n\n\tspin_lock_irqsave(&ctrl->txn_lock, flags);\n\tfor (i = 0; i < SLIM_MAX_TIDS; i++) {\n\t\t \n\t\tif (idr_find(&ctrl->tid_idr, i)) {\n\t\t\tspin_unlock_irqrestore(&ctrl->txn_lock, flags);\n\t\t\tmutex_unlock(&sched->m_reconf);\n\t\t\treturn -EBUSY;\n\t\t}\n\t}\n\tspin_unlock_irqrestore(&ctrl->txn_lock, flags);\n\n\tsched->clk_state = SLIM_CLK_ENTERING_PAUSE;\n\n\t \n\tret = slim_do_transfer(ctrl, &txn);\n\tif (ret)\n\t\tgoto clk_pause_ret;\n\n\ttxn.mc = SLIM_MSG_MC_NEXT_PAUSE_CLOCK;\n\ttxn.rl = 4;\n\tmsg.num_bytes = 1;\n\tmsg.wbuf = &restart;\n\tret = slim_do_transfer(ctrl, &txn);\n\tif (ret)\n\t\tgoto clk_pause_ret;\n\n\ttxn.mc = SLIM_MSG_MC_RECONFIGURE_NOW;\n\ttxn.rl = 3;\n\tmsg.num_bytes = 1;\n\tmsg.wbuf = NULL;\n\tret = slim_do_transfer(ctrl, &txn);\n\nclk_pause_ret:\n\tif (ret) {\n\t\tsched->clk_state = SLIM_CLK_ACTIVE;\n\t} else {\n\t\tsched->clk_state = SLIM_CLK_PAUSED;\n\t\tcomplete(&sched->pause_comp);\n\t}\n\tmutex_unlock(&sched->m_reconf);\n\n\treturn ret;\n}\nEXPORT_SYMBOL_GPL(slim_ctrl_clk_pause);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}