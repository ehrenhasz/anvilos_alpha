{
  "module_name": "slimbus.h",
  "hash_id": "a90189d9908328f4a3a1b788286d4307abe498ba507160b4d75cacc7138478b5",
  "original_prompt": "Ingested from linux-6.6.14/drivers/slimbus/slimbus.h",
  "human_readable_source": " \n \n\n#ifndef _DRIVERS_SLIMBUS_H\n#define _DRIVERS_SLIMBUS_H\n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/mutex.h>\n#include <linux/completion.h>\n#include <linux/slimbus.h>\n\n \n#define SLIM_CL_PER_SUPERFRAME\t\t6144\n#define SLIM_CL_PER_SUPERFRAME_DIV8\t(SLIM_CL_PER_SUPERFRAME >> 3)\n\n \n#define SLIM_MSG_MT_CORE\t\t\t0x0\n#define SLIM_MSG_MT_DEST_REFERRED_USER\t\t0x2\n#define SLIM_MSG_MT_SRC_REFERRED_USER\t\t0x6\n\n \n#define SLIM_MSG_MT_MASK\tGENMASK(2, 0)\n#define SLIM_MSG_MT_SHIFT\t5\n#define SLIM_MSG_RL_MASK\tGENMASK(4, 0)\n#define SLIM_MSG_RL_SHIFT\t0\n#define SLIM_MSG_MC_MASK\tGENMASK(6, 0)\n#define SLIM_MSG_MC_SHIFT\t0\n#define SLIM_MSG_DT_MASK\tGENMASK(1, 0)\n#define SLIM_MSG_DT_SHIFT\t4\n\n#define SLIM_HEADER_GET_MT(b)\t((b >> SLIM_MSG_MT_SHIFT) & SLIM_MSG_MT_MASK)\n#define SLIM_HEADER_GET_RL(b)\t((b >> SLIM_MSG_RL_SHIFT) & SLIM_MSG_RL_MASK)\n#define SLIM_HEADER_GET_MC(b)\t((b >> SLIM_MSG_MC_SHIFT) & SLIM_MSG_MC_MASK)\n#define SLIM_HEADER_GET_DT(b)\t((b >> SLIM_MSG_DT_SHIFT) & SLIM_MSG_DT_MASK)\n\n \n#define SLIM_MSG_MC_REPORT_PRESENT               0x1\n#define SLIM_MSG_MC_ASSIGN_LOGICAL_ADDRESS       0x2\n#define SLIM_MSG_MC_REPORT_ABSENT                0xF\n\n \n#define SLIM_MSG_MC_CONNECT_SOURCE\t\t0x10\n#define SLIM_MSG_MC_CONNECT_SINK\t\t0x11\n#define SLIM_MSG_MC_DISCONNECT_PORT\t\t0x14\n#define SLIM_MSG_MC_CHANGE_CONTENT\t\t0x18\n\n \n#define SLIM_MSG_MC_BEGIN_RECONFIGURATION        0x40\n#define SLIM_MSG_MC_NEXT_PAUSE_CLOCK             0x4A\n#define SLIM_MSG_MC_NEXT_DEFINE_CHANNEL          0x50\n#define SLIM_MSG_MC_NEXT_DEFINE_CONTENT          0x51\n#define SLIM_MSG_MC_NEXT_ACTIVATE_CHANNEL        0x54\n#define SLIM_MSG_MC_NEXT_DEACTIVATE_CHANNEL      0x55\n#define SLIM_MSG_MC_NEXT_REMOVE_CHANNEL          0x58\n#define SLIM_MSG_MC_RECONFIGURE_NOW              0x5F\n\n \n#define SLIM_CLK_FAST\t\t\t\t0\n#define SLIM_CLK_CONST_PHASE\t\t\t1\n#define SLIM_CLK_UNSPECIFIED\t\t\t2\n\n \n#define SLIM_MSG_DEST_LOGICALADDR\t0\n#define SLIM_MSG_DEST_ENUMADDR\t\t1\n#define\tSLIM_MSG_DEST_BROADCAST\t\t3\n\n \n#define SLIM_MAX_CLK_GEAR\t\t10\n#define SLIM_MIN_CLK_GEAR\t\t1\n#define SLIM_SLOT_LEN_BITS\t\t4\n\n \n#define SLIM_CHANNEL_CONTENT_FL\t\tBIT(7)\n\n \n#define SLIM_CL_PER_SUPERFRAME\t\t6144\n#define SLIM_SLOTS_PER_SUPERFRAME\t(SLIM_CL_PER_SUPERFRAME >> 2)\n#define SLIM_SL_PER_SUPERFRAME\t\t(SLIM_CL_PER_SUPERFRAME >> 2)\n \n#define SLIM_LA_MANAGER 0xFF\n\n#define SLIM_MAX_TIDS\t\t\t256\n \nstruct slim_framer {\n\tstruct device\t\tdev;\n\tstruct slim_eaddr\te_addr;\n\tint\t\t\trootfreq;\n\tint\t\t\tsuperfreq;\n};\n\n#define to_slim_framer(d) container_of(d, struct slim_framer, dev)\n\n \nstruct slim_msg_txn {\n\tu8\t\t\trl;\n\tu8\t\t\tmt;\n\tu8\t\t\tmc;\n\tu8\t\t\tdt;\n\tu16\t\t\tec;\n\tu8\t\t\ttid;\n\tu8\t\t\tla;\n\tstruct slim_val_inf\t*msg;\n\tstruct\tcompletion\t*comp;\n};\n\n \n#define DEFINE_SLIM_LDEST_TXN(name, mc, rl, la, msg) \\\n\tstruct slim_msg_txn name = { rl, 0, mc, SLIM_MSG_DEST_LOGICALADDR, 0,\\\n\t\t\t\t\t0, la, msg, }\n\n#define DEFINE_SLIM_BCAST_TXN(name, mc, rl, la, msg) \\\n\tstruct slim_msg_txn name = { rl, 0, mc, SLIM_MSG_DEST_BROADCAST, 0,\\\n\t\t\t\t\t0, la, msg, }\n\n#define DEFINE_SLIM_EDEST_TXN(name, mc, rl, la, msg) \\\n\tstruct slim_msg_txn name = { rl, 0, mc, SLIM_MSG_DEST_ENUMADDR, 0,\\\n\t\t\t\t\t0, la, msg, }\n \nenum slim_clk_state {\n\tSLIM_CLK_ACTIVE,\n\tSLIM_CLK_ENTERING_PAUSE,\n\tSLIM_CLK_PAUSED,\n};\n\n \nstruct slim_sched {\n\tenum slim_clk_state\tclk_state;\n\tstruct completion\tpause_comp;\n\tstruct mutex\t\tm_reconf;\n};\n\n \nenum slim_port_direction {\n\tSLIM_PORT_SINK = 0,\n\tSLIM_PORT_SOURCE,\n};\n \nenum slim_port_state {\n\tSLIM_PORT_DISCONNECTED = 0,\n\tSLIM_PORT_UNCONFIGURED,\n\tSLIM_PORT_CONFIGURED,\n};\n\n \nenum slim_channel_state {\n\tSLIM_CH_STATE_DISCONNECTED = 0,\n\tSLIM_CH_STATE_ALLOCATED,\n\tSLIM_CH_STATE_ASSOCIATED,\n\tSLIM_CH_STATE_DEFINED,\n\tSLIM_CH_STATE_CONTENT_DEFINED,\n\tSLIM_CH_STATE_ACTIVE,\n\tSLIM_CH_STATE_REMOVED,\n};\n\n \nenum slim_ch_data_fmt {\n\tSLIM_CH_DATA_FMT_NOT_DEFINED = 0,\n\tSLIM_CH_DATA_FMT_LPCM_AUDIO = 1,\n\tSLIM_CH_DATA_FMT_IEC61937_COMP_AUDIO = 2,\n\tSLIM_CH_DATA_FMT_PACKED_PDM_AUDIO = 3,\n};\n\n \nenum slim_ch_aux_bit_fmt {\n\tSLIM_CH_AUX_FMT_NOT_APPLICABLE = 0,\n\tSLIM_CH_AUX_FMT_ZCUV_TUNNEL_IEC60958 = 1,\n\tSLIM_CH_AUX_FMT_USER_DEFINED = 0xF,\n};\n\n \nstruct slim_channel {\n\tint id;\n\tint prrate;\n\tint seg_dist;\n\tenum slim_ch_data_fmt data_fmt;\n\tenum slim_ch_aux_bit_fmt aux_fmt;\n\tenum slim_channel_state state;\n};\n\n \nstruct slim_port {\n\tint id;\n\tenum slim_port_direction direction;\n\tenum slim_port_state state;\n\tstruct slim_channel ch;\n};\n\n \nenum slim_transport_protocol {\n\tSLIM_PROTO_ISO = 0,\n\tSLIM_PROTO_PUSH,\n\tSLIM_PROTO_PULL,\n\tSLIM_PROTO_LOCKED,\n\tSLIM_PROTO_ASYNC_SMPLX,\n\tSLIM_PROTO_ASYNC_HALF_DUP,\n\tSLIM_PROTO_EXT_SMPLX,\n\tSLIM_PROTO_EXT_HALF_DUP,\n};\n\n \nstruct slim_stream_runtime {\n\tconst char *name;\n\tstruct slim_device *dev;\n\tint direction;\n\tenum slim_transport_protocol prot;\n\tunsigned int rate;\n\tunsigned int bps;\n\tunsigned int ratem;\n\tint num_ports;\n\tstruct slim_port *ports;\n\tstruct list_head node;\n};\n\n \nstruct slim_controller {\n\tstruct device\t\t*dev;\n\tunsigned int\t\tid;\n\tchar\t\t\tname[SLIMBUS_NAME_SIZE];\n\tint\t\t\tmin_cg;\n\tint\t\t\tmax_cg;\n\tint\t\t\tclkgear;\n\tstruct ida\t\tladdr_ida;\n\tstruct slim_framer\t*a_framer;\n\tstruct mutex\t\tlock;\n\tstruct list_head\tdevices;\n\tstruct idr\t\ttid_idr;\n\tspinlock_t\t\ttxn_lock;\n\tstruct slim_sched\tsched;\n\tint\t\t\t(*xfer_msg)(struct slim_controller *ctrl,\n\t\t\t\t\t    struct slim_msg_txn *tx);\n\tint\t\t\t(*set_laddr)(struct slim_controller *ctrl,\n\t\t\t\t\t     struct slim_eaddr *ea, u8 laddr);\n\tint\t\t\t(*get_laddr)(struct slim_controller *ctrl,\n\t\t\t\t\t     struct slim_eaddr *ea, u8 *laddr);\n\tint\t\t(*enable_stream)(struct slim_stream_runtime *rt);\n\tint\t\t(*disable_stream)(struct slim_stream_runtime *rt);\n\tint\t\t\t(*wakeup)(struct slim_controller *ctrl);\n};\n\nint slim_device_report_present(struct slim_controller *ctrl,\n\t\t\t       struct slim_eaddr *e_addr, u8 *laddr);\nvoid slim_report_absent(struct slim_device *sbdev);\nint slim_register_controller(struct slim_controller *ctrl);\nint slim_unregister_controller(struct slim_controller *ctrl);\nvoid slim_msg_response(struct slim_controller *ctrl, u8 *reply, u8 tid, u8 l);\nint slim_do_transfer(struct slim_controller *ctrl, struct slim_msg_txn *txn);\nint slim_ctrl_clk_pause(struct slim_controller *ctrl, bool wakeup, u8 restart);\nint slim_alloc_txn_tid(struct slim_controller *ctrl, struct slim_msg_txn *txn);\nvoid slim_free_txn_tid(struct slim_controller *ctrl, struct slim_msg_txn *txn);\n\nstatic inline bool slim_tid_txn(u8 mt, u8 mc)\n{\n\treturn (mt == SLIM_MSG_MT_CORE &&\n\t\t(mc == SLIM_MSG_MC_REQUEST_INFORMATION ||\n\t\t mc == SLIM_MSG_MC_REQUEST_CLEAR_INFORMATION ||\n\t\t mc == SLIM_MSG_MC_REQUEST_VALUE ||\n\t\t mc == SLIM_MSG_MC_REQUEST_CHANGE_VALUE));\n}\n\nstatic inline bool slim_ec_txn(u8 mt, u8 mc)\n{\n\treturn (mt == SLIM_MSG_MT_CORE &&\n\t\t((mc >= SLIM_MSG_MC_REQUEST_INFORMATION &&\n\t\t  mc <= SLIM_MSG_MC_REPORT_INFORMATION) ||\n\t\t (mc >= SLIM_MSG_MC_REQUEST_VALUE &&\n\t\t  mc <= SLIM_MSG_MC_CHANGE_VALUE)));\n}\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}