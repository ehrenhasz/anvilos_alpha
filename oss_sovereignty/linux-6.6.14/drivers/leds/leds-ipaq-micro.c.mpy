{
  "module_name": "leds-ipaq-micro.c",
  "hash_id": "c7881c7124222a1bfe49eb062f3050c5b74c817d04bddd1b8ddc0aeb2b674cf4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/leds-ipaq-micro.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/mfd/ipaq-micro.h>\n#include <linux/leds.h>\n\n#define LED_YELLOW\t0x00\n#define LED_GREEN\t0x01\n\n#define LED_EN       (1 << 4)  \n#define LED_AUTOSTOP (1 << 5)  \n#define LED_ALWAYS   (1 << 6)  \n\nstatic int micro_leds_brightness_set(struct led_classdev *led_cdev,\n\t\t\t\t      enum led_brightness value)\n{\n\tstruct ipaq_micro *micro = dev_get_drvdata(led_cdev->dev->parent->parent);\n\t \n\tstruct ipaq_micro_msg msg = {\n\t\t.id = MSG_NOTIFY_LED,\n\t\t.tx_len = 4,\n\t};\n\n\tmsg.tx_data[0] = LED_GREEN;\n\tmsg.tx_data[1] = 0;\n\tif (value) {\n\t\tmsg.tx_data[2] = 0;  \n\t\tmsg.tx_data[3] = 1;\n\t} else {\n\t\tmsg.tx_data[2] = 1;\n\t\tmsg.tx_data[3] = 0;  \n\t}\n\treturn ipaq_micro_tx_msg_sync(micro, &msg);\n}\n\n \n#define IPAQ_LED_MAX_DUTY 25600\n\nstatic int micro_leds_blink_set(struct led_classdev *led_cdev,\n\t\t\t\tunsigned long *delay_on,\n\t\t\t\tunsigned long *delay_off)\n{\n\tstruct ipaq_micro *micro = dev_get_drvdata(led_cdev->dev->parent->parent);\n\t \n\tstruct ipaq_micro_msg msg = {\n\t\t.id = MSG_NOTIFY_LED,\n\t\t.tx_len = 4,\n\t};\n\n\tmsg.tx_data[0] = LED_GREEN;\n\tif (*delay_on > IPAQ_LED_MAX_DUTY ||\n\t    *delay_off > IPAQ_LED_MAX_DUTY)\n\t\treturn -EINVAL;\n\n\tif (*delay_on == 0 && *delay_off == 0) {\n\t\t*delay_on = 100;\n\t\t*delay_off = 100;\n\t}\n\n\tmsg.tx_data[1] = 0;\n\tif (*delay_on >= IPAQ_LED_MAX_DUTY)\n\t\tmsg.tx_data[2] = 0;\n\telse\n\t\tmsg.tx_data[2] = (u8) DIV_ROUND_CLOSEST(*delay_on, 100);\n\tif (*delay_off >= IPAQ_LED_MAX_DUTY)\n\t\tmsg.tx_data[3] = 0;\n\telse\n\t\tmsg.tx_data[3] = (u8) DIV_ROUND_CLOSEST(*delay_off, 100);\n\treturn ipaq_micro_tx_msg_sync(micro, &msg);\n}\n\nstatic struct led_classdev micro_led = {\n\t.name\t\t\t= \"led-ipaq-micro\",\n\t.brightness_set_blocking = micro_leds_brightness_set,\n\t.blink_set\t\t= micro_leds_blink_set,\n\t.flags\t\t\t= LED_CORE_SUSPENDRESUME,\n};\n\nstatic int micro_leds_probe(struct platform_device *pdev)\n{\n\tint ret;\n\n\tret = devm_led_classdev_register(&pdev->dev, &micro_led);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"registering led failed: %d\\n\", ret);\n\t\treturn ret;\n\t}\n\tdev_info(&pdev->dev, \"iPAQ micro notification LED driver\\n\");\n\n\treturn 0;\n}\n\nstatic struct platform_driver micro_leds_device_driver = {\n\t.driver = {\n\t\t.name    = \"ipaq-micro-leds\",\n\t},\n\t.probe   = micro_leds_probe,\n};\nmodule_platform_driver(micro_leds_device_driver);\n\nMODULE_LICENSE(\"GPL\");\nMODULE_DESCRIPTION(\"driver for iPAQ Atmel micro leds\");\nMODULE_ALIAS(\"platform:ipaq-micro-leds\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}