{
  "module_name": "leds-cobalt-raq.c",
  "hash_id": "c0b295c96921ab9bee27f83b0d1d90ed59aa836ee820c167fec536265a136216",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/leds-cobalt-raq.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/ioport.h>\n#include <linux/leds.h>\n#include <linux/platform_device.h>\n#include <linux/spinlock.h>\n#include <linux/types.h>\n#include <linux/export.h>\n\n#define LED_WEB\t\t0x04\n#define LED_POWER_OFF\t0x08\n\nstatic void __iomem *led_port;\nstatic u8 led_value;\nstatic DEFINE_SPINLOCK(led_value_lock);\n\nstatic void raq_web_led_set(struct led_classdev *led_cdev,\n\t\t\t    enum led_brightness brightness)\n{\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&led_value_lock, flags);\n\n\tif (brightness)\n\t\tled_value |= LED_WEB;\n\telse\n\t\tled_value &= ~LED_WEB;\n\twriteb(led_value, led_port);\n\n\tspin_unlock_irqrestore(&led_value_lock, flags);\n}\n\nstatic struct led_classdev raq_web_led = {\n\t.name\t\t= \"raq::web\",\n\t.brightness_set\t= raq_web_led_set,\n};\n\nstatic void raq_power_off_led_set(struct led_classdev *led_cdev,\n\t\t\t\t  enum led_brightness brightness)\n{\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&led_value_lock, flags);\n\n\tif (brightness)\n\t\tled_value |= LED_POWER_OFF;\n\telse\n\t\tled_value &= ~LED_POWER_OFF;\n\twriteb(led_value, led_port);\n\n\tspin_unlock_irqrestore(&led_value_lock, flags);\n}\n\nstatic struct led_classdev raq_power_off_led = {\n\t.name\t\t\t= \"raq::power-off\",\n\t.brightness_set\t\t= raq_power_off_led_set,\n\t.default_trigger\t= \"power-off\",\n};\n\nstatic int cobalt_raq_led_probe(struct platform_device *pdev)\n{\n\tstruct resource *res;\n\tint retval;\n\n\tres = platform_get_resource(pdev, IORESOURCE_MEM, 0);\n\tif (!res)\n\t\treturn -EBUSY;\n\n\tled_port = devm_ioremap(&pdev->dev, res->start, resource_size(res));\n\tif (!led_port)\n\t\treturn -ENOMEM;\n\n\tretval = led_classdev_register(&pdev->dev, &raq_power_off_led);\n\tif (retval)\n\t\tgoto err_null;\n\n\tretval = led_classdev_register(&pdev->dev, &raq_web_led);\n\tif (retval)\n\t\tgoto err_unregister;\n\n\treturn 0;\n\nerr_unregister:\n\tled_classdev_unregister(&raq_power_off_led);\n\nerr_null:\n\tled_port = NULL;\n\n\treturn retval;\n}\n\nstatic struct platform_driver cobalt_raq_led_driver = {\n\t.probe\t= cobalt_raq_led_probe,\n\t.driver = {\n\t\t.name\t= \"cobalt-raq-leds\",\n\t},\n};\n\nbuiltin_platform_driver(cobalt_raq_led_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}