{
  "module_name": "leds-tps6105x.c",
  "hash_id": "df7c6fe71116024b29d962ba7230ea32599d5416e707688799ddcea38b3cc186",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/leds-tps6105x.c",
  "human_readable_source": "\n \n\n#include <linux/leds.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/mfd/tps6105x.h>\n#include <linux/regmap.h>\n\nstruct tps6105x_priv {\n\tstruct regmap *regmap;\n\tstruct led_classdev cdev;\n\tstruct fwnode_handle *fwnode;\n};\n\nstatic void tps6105x_handle_put(void *data)\n{\n\tstruct tps6105x_priv *priv = data;\n\n\tfwnode_handle_put(priv->fwnode);\n}\n\nstatic int tps6105x_brightness_set(struct led_classdev *cdev,\n\t\t\t\t  enum led_brightness brightness)\n{\n\tstruct tps6105x_priv *priv = container_of(cdev, struct tps6105x_priv,\n\t\t\t\t\t\t\tcdev);\n\n\treturn regmap_update_bits(priv->regmap, TPS6105X_REG_0,\n\t\t\t\t  TPS6105X_REG0_TORCHC_MASK,\n\t\t\t\t  brightness << TPS6105X_REG0_TORCHC_SHIFT);\n}\n\nstatic int tps6105x_led_probe(struct platform_device *pdev)\n{\n\tstruct tps6105x *tps6105x = dev_get_platdata(&pdev->dev);\n\tstruct tps6105x_platform_data *pdata = tps6105x->pdata;\n\tstruct led_init_data init_data = { };\n\tstruct tps6105x_priv *priv;\n\tint ret;\n\n\t \n\tif (pdata->mode != TPS6105X_MODE_TORCH) {\n\t\tdev_info(&pdev->dev,\n\t\t\t\"chip not in torch mode, exit probe\");\n\t\treturn -EINVAL;\n\t}\n\n\tpriv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\t \n\tpriv->fwnode = device_get_next_child_node(pdev->dev.parent, NULL);\n\tret = devm_add_action_or_reset(&pdev->dev, tps6105x_handle_put, priv);\n\tif (ret)\n\t\treturn ret;\n\tpriv->regmap = tps6105x->regmap;\n\tpriv->cdev.brightness_set_blocking = tps6105x_brightness_set;\n\tpriv->cdev.max_brightness = 7;\n\tinit_data.devicename = \"tps6105x\";\n\tinit_data.default_label = \":torch\";\n\tinit_data.fwnode = priv->fwnode;\n\n\tret = regmap_update_bits(tps6105x->regmap, TPS6105X_REG_0,\n\t\t\t\t TPS6105X_REG0_MODE_MASK |\n\t\t\t\t\tTPS6105X_REG0_TORCHC_MASK,\n\t\t\t\t TPS6105X_REG0_MODE_TORCH <<\n\t\t\t\t\tTPS6105X_REG0_MODE_SHIFT);\n\tif (ret)\n\t\treturn ret;\n\n\treturn devm_led_classdev_register_ext(&pdev->dev, &priv->cdev,\n\t\t\t\t\t      &init_data);\n}\n\nstatic struct platform_driver led_driver = {\n\t.probe = tps6105x_led_probe,\n\t.driver = {\n\t\t.name = \"tps6105x-leds\",\n\t},\n};\n\nmodule_platform_driver(led_driver);\n\nMODULE_DESCRIPTION(\"TPS6105x LED driver\");\nMODULE_AUTHOR(\"Sven Van Asbroeck <TheSven73@gmail.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}