{
  "module_name": "leds-ot200.c",
  "hash_id": "f5025e6b58db94fb7bf4f0bc322b167ea928dbed8ae68ce68d2ef2a297854d8e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/leds-ot200.c",
  "human_readable_source": " \n\n#include <linux/kernel.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n#include <linux/leds.h>\n#include <linux/io.h>\n#include <linux/module.h>\n\n\nstruct ot200_led {\n\tstruct led_classdev cdev;\n\tconst char *name;\n\tunsigned long port;\n\tu8 mask;\n};\n\n \n\nstatic struct ot200_led leds[] = {\n\t{\n\t\t.name = \"led_run\",\n\t\t.port = 0x5a,\n\t\t.mask = BIT(0),\n\t},\n\t{\n\t\t.name = \"led_init\",\n\t\t.port = 0x5a,\n\t\t.mask = BIT(1),\n\t},\n\t{\n\t\t.name = \"led_err\",\n\t\t.port = 0x5a,\n\t\t.mask = BIT(2),\n\t},\n\t{\n\t\t.name = \"led_1\",\n\t\t.port = 0x49,\n\t\t.mask = BIT(6),\n\t},\n\t{\n\t\t.name = \"led_2\",\n\t\t.port = 0x49,\n\t\t.mask = BIT(5),\n\t},\n\t{\n\t\t.name = \"led_3\",\n\t\t.port = 0x49,\n\t\t.mask = BIT(4),\n\t},\n\t{\n\t\t.name = \"led_4\",\n\t\t.port = 0x49,\n\t\t.mask = BIT(3),\n\t},\n\t{\n\t\t.name = \"led_5\",\n\t\t.port = 0x49,\n\t\t.mask = BIT(2),\n\t},\n\t{\n\t\t.name = \"led_6\",\n\t\t.port = 0x49,\n\t\t.mask = BIT(1),\n\t},\n\t{\n\t\t.name = \"led_7\",\n\t\t.port = 0x49,\n\t\t.mask = BIT(0),\n\t}\n};\n\nstatic DEFINE_SPINLOCK(value_lock);\n\n \nstatic u8 leds_back;\nstatic u8 leds_front;\n\nstatic void ot200_led_brightness_set(struct led_classdev *led_cdev,\n\t\tenum led_brightness value)\n{\n\tstruct ot200_led *led = container_of(led_cdev, struct ot200_led, cdev);\n\tu8 *val;\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&value_lock, flags);\n\n\tif (led->port == 0x49)\n\t\tval = &leds_front;\n\telse if (led->port == 0x5a)\n\t\tval = &leds_back;\n\telse\n\t\tBUG();\n\n\tif (value == LED_OFF)\n\t\t*val &= ~led->mask;\n\telse\n\t\t*val |= led->mask;\n\n\toutb(*val, led->port);\n\tspin_unlock_irqrestore(&value_lock, flags);\n}\n\nstatic int ot200_led_probe(struct platform_device *pdev)\n{\n\tint i;\n\tint ret;\n\n\tfor (i = 0; i < ARRAY_SIZE(leds); i++) {\n\n\t\tleds[i].cdev.name = leds[i].name;\n\t\tleds[i].cdev.brightness_set = ot200_led_brightness_set;\n\n\t\tret = devm_led_classdev_register(&pdev->dev, &leds[i].cdev);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t}\n\n\tleds_front = 0;\t\t \n\tleds_back = BIT(1);\t \n\toutb(leds_front, 0x49);\n\toutb(leds_back, 0x5a);\n\n\treturn 0;\n}\n\nstatic struct platform_driver ot200_led_driver = {\n\t.probe\t\t= ot200_led_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"leds-ot200\",\n\t},\n};\n\nmodule_platform_driver(ot200_led_driver);\n\nMODULE_AUTHOR(\"Sebastian A. Siewior <bigeasy@linutronix.de>\");\nMODULE_DESCRIPTION(\"ot200 LED driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:leds-ot200\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}