{
  "module_name": "simatic-ipc-leds-gpio-core.c",
  "hash_id": "80a5982af04e12f3c318d2304ec125131ccc7deebd314f1f1047fb60e31c53e2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/simple/simatic-ipc-leds-gpio-core.c",
  "human_readable_source": "\n \n\n#include <linux/gpio/machine.h>\n#include <linux/gpio/consumer.h>\n#include <linux/leds.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/platform_data/x86/simatic-ipc-base.h>\n\n#include \"simatic-ipc-leds-gpio.h\"\n\nstatic struct platform_device *simatic_leds_pdev;\n\nstatic const struct gpio_led simatic_ipc_gpio_leds[] = {\n\t{ .name = \"red:\" LED_FUNCTION_STATUS \"-1\" },\n\t{ .name = \"green:\" LED_FUNCTION_STATUS \"-1\" },\n\t{ .name = \"red:\" LED_FUNCTION_STATUS \"-2\" },\n\t{ .name = \"green:\" LED_FUNCTION_STATUS \"-2\" },\n\t{ .name = \"red:\" LED_FUNCTION_STATUS \"-3\" },\n\t{ .name = \"green:\" LED_FUNCTION_STATUS \"-3\" },\n};\n\nstatic const struct gpio_led_platform_data simatic_ipc_gpio_leds_pdata = {\n\t.num_leds\t= ARRAY_SIZE(simatic_ipc_gpio_leds),\n\t.leds\t\t= simatic_ipc_gpio_leds,\n};\n\nint simatic_ipc_leds_gpio_remove(struct platform_device *pdev,\n\t\t\t\t struct gpiod_lookup_table *table,\n\t\t\t\t struct gpiod_lookup_table *table_extra)\n{\n\tgpiod_remove_lookup_table(table);\n\tgpiod_remove_lookup_table(table_extra);\n\tplatform_device_unregister(simatic_leds_pdev);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(simatic_ipc_leds_gpio_remove);\n\nint simatic_ipc_leds_gpio_probe(struct platform_device *pdev,\n\t\t\t\tstruct gpiod_lookup_table *table,\n\t\t\t\tstruct gpiod_lookup_table *table_extra)\n{\n\tconst struct simatic_ipc_platform *plat = pdev->dev.platform_data;\n\tstruct device *dev = &pdev->dev;\n\tstruct gpio_desc *gpiod;\n\tint err;\n\n\tswitch (plat->devmode) {\n\tcase SIMATIC_IPC_DEVICE_127E:\n\tcase SIMATIC_IPC_DEVICE_227G:\n\tcase SIMATIC_IPC_DEVICE_BX_21A:\n\t\tbreak;\n\tdefault:\n\t\treturn -ENODEV;\n\t}\n\n\tgpiod_add_lookup_table(table);\n\tsimatic_leds_pdev = platform_device_register_resndata(NULL,\n\t\t\"leds-gpio\", PLATFORM_DEVID_NONE, NULL, 0,\n\t\t&simatic_ipc_gpio_leds_pdata,\n\t\tsizeof(simatic_ipc_gpio_leds_pdata));\n\tif (IS_ERR(simatic_leds_pdev)) {\n\t\terr = PTR_ERR(simatic_leds_pdev);\n\t\tgoto out;\n\t}\n\n\tif (!table_extra)\n\t\treturn 0;\n\n\ttable_extra->dev_id = dev_name(dev);\n\tgpiod_add_lookup_table(table_extra);\n\n\t \n\tgpiod = gpiod_get_index(dev, NULL, 6, GPIOD_OUT_LOW);\n\tif (IS_ERR(gpiod)) {\n\t\terr = PTR_ERR(gpiod);\n\t\tgoto out;\n\t}\n\tgpiod_put(gpiod);\n\n\t \n\tgpiod = gpiod_get_index(dev, NULL, 7, GPIOD_OUT_LOW);\n\tif (IS_ERR(gpiod)) {\n\t\terr = PTR_ERR(gpiod);\n\t\tgoto out;\n\t}\n\tgpiod_put(gpiod);\n\n\treturn 0;\nout:\n\tsimatic_ipc_leds_gpio_remove(pdev, table, table_extra);\n\n\treturn err;\n}\nEXPORT_SYMBOL_GPL(simatic_ipc_leds_gpio_probe);\n\nMODULE_LICENSE(\"GPL v2\");\nMODULE_SOFTDEP(\"pre: platform:leds-gpio\");\nMODULE_AUTHOR(\"Henning Schild <henning.schild@siemens.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}