{
  "module_name": "ledtrig-timer.c",
  "hash_id": "9d7b87692c04c414b56e7a9a7a29aaf0343c4f1032a14ec08bf1f738d7558710",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/trigger/ledtrig-timer.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/init.h>\n#include <linux/device.h>\n#include <linux/ctype.h>\n#include <linux/slab.h>\n#include <linux/leds.h>\n\nstatic ssize_t led_delay_on_show(struct device *dev,\n\t\tstruct device_attribute *attr, char *buf)\n{\n\tstruct led_classdev *led_cdev = led_trigger_get_led(dev);\n\n\treturn sprintf(buf, \"%lu\\n\", led_cdev->blink_delay_on);\n}\n\nstatic ssize_t led_delay_on_store(struct device *dev,\n\t\tstruct device_attribute *attr, const char *buf, size_t size)\n{\n\tstruct led_classdev *led_cdev = led_trigger_get_led(dev);\n\tunsigned long state;\n\tssize_t ret;\n\n\tret = kstrtoul(buf, 10, &state);\n\tif (ret)\n\t\treturn ret;\n\n\tled_blink_set(led_cdev, &state, &led_cdev->blink_delay_off);\n\tled_cdev->blink_delay_on = state;\n\n\treturn size;\n}\n\nstatic ssize_t led_delay_off_show(struct device *dev,\n\t\tstruct device_attribute *attr, char *buf)\n{\n\tstruct led_classdev *led_cdev = led_trigger_get_led(dev);\n\n\treturn sprintf(buf, \"%lu\\n\", led_cdev->blink_delay_off);\n}\n\nstatic ssize_t led_delay_off_store(struct device *dev,\n\t\tstruct device_attribute *attr, const char *buf, size_t size)\n{\n\tstruct led_classdev *led_cdev = led_trigger_get_led(dev);\n\tunsigned long state;\n\tssize_t ret;\n\n\tret = kstrtoul(buf, 10, &state);\n\tif (ret)\n\t\treturn ret;\n\n\tled_blink_set(led_cdev, &led_cdev->blink_delay_on, &state);\n\tled_cdev->blink_delay_off = state;\n\n\treturn size;\n}\n\nstatic DEVICE_ATTR(delay_on, 0644, led_delay_on_show, led_delay_on_store);\nstatic DEVICE_ATTR(delay_off, 0644, led_delay_off_show, led_delay_off_store);\n\nstatic struct attribute *timer_trig_attrs[] = {\n\t&dev_attr_delay_on.attr,\n\t&dev_attr_delay_off.attr,\n\tNULL\n};\nATTRIBUTE_GROUPS(timer_trig);\n\nstatic void pattern_init(struct led_classdev *led_cdev)\n{\n\tu32 *pattern;\n\tunsigned int size = 0;\n\n\tpattern = led_get_default_pattern(led_cdev, &size);\n\tif (!pattern)\n\t\treturn;\n\n\tif (size != 2) {\n\t\tdev_warn(led_cdev->dev,\n\t\t\t \"Expected 2 but got %u values for delays pattern\\n\",\n\t\t\t size);\n\t\tgoto out;\n\t}\n\n\tled_cdev->blink_delay_on = pattern[0];\n\tled_cdev->blink_delay_off = pattern[1];\n\t \n\nout:\n\tkfree(pattern);\n}\n\nstatic int timer_trig_activate(struct led_classdev *led_cdev)\n{\n\tif (led_cdev->flags & LED_INIT_DEFAULT_TRIGGER) {\n\t\tpattern_init(led_cdev);\n\t\t \n\t\tled_cdev->flags &= ~LED_INIT_DEFAULT_TRIGGER;\n\t}\n\n\t \n\tflush_work(&led_cdev->set_brightness_work);\n\tled_blink_set(led_cdev, &led_cdev->blink_delay_on,\n\t\t      &led_cdev->blink_delay_off);\n\n\treturn 0;\n}\n\nstatic void timer_trig_deactivate(struct led_classdev *led_cdev)\n{\n\t \n\tled_set_brightness(led_cdev, LED_OFF);\n}\n\nstatic struct led_trigger timer_led_trigger = {\n\t.name     = \"timer\",\n\t.activate = timer_trig_activate,\n\t.deactivate = timer_trig_deactivate,\n\t.groups = timer_trig_groups,\n};\nmodule_led_trigger(timer_led_trigger);\n\nMODULE_AUTHOR(\"Richard Purdie <rpurdie@openedhand.com>\");\nMODULE_DESCRIPTION(\"Timer LED trigger\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}