{
  "module_name": "leds-acer-a500.c",
  "hash_id": "e9f71554777b52d95c81013a62d0c0974941cc7378dfee4b242843d6305528aa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/leds-acer-a500.c",
  "human_readable_source": "\n\n#include <linux/leds.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\n#define A500_EC_LED_DELAY_USEC\t(100 * 1000)\n\nenum {\n\tREG_RESET_LEDS = 0x40,\n\tREG_POWER_LED_ON = 0x42,\n\tREG_CHARGE_LED_ON = 0x43,\n\tREG_ANDROID_LEDS_OFF = 0x5a,\n};\n\nstruct a500_led {\n\tstruct led_classdev cdev;\n\tconst struct reg_sequence *enable_seq;\n\tstruct a500_led *other;\n\tstruct regmap *rmap;\n};\n\nstatic const struct reg_sequence a500_ec_leds_reset_seq[] = {\n\tREG_SEQ(REG_RESET_LEDS, 0x0, A500_EC_LED_DELAY_USEC),\n\tREG_SEQ(REG_ANDROID_LEDS_OFF, 0x0, A500_EC_LED_DELAY_USEC),\n};\n\nstatic const struct reg_sequence a500_ec_white_led_enable_seq[] = {\n\tREG_SEQ(REG_POWER_LED_ON, 0x0, A500_EC_LED_DELAY_USEC),\n};\n\nstatic const struct reg_sequence a500_ec_orange_led_enable_seq[] = {\n\tREG_SEQ(REG_CHARGE_LED_ON, 0x0, A500_EC_LED_DELAY_USEC),\n};\n\nstatic int a500_ec_led_brightness_set(struct led_classdev *led_cdev,\n\t\t\t\t      enum led_brightness value)\n{\n\tstruct a500_led *led = container_of(led_cdev, struct a500_led, cdev);\n\tstruct reg_sequence control_seq[2];\n\tunsigned int num_regs = 1;\n\n\tif (value) {\n\t\tcontrol_seq[0] = led->enable_seq[0];\n\t} else {\n\t\t \n\t\tif (led->other->cdev.brightness)\n\t\t\tnum_regs = 2;\n\n\t\tcontrol_seq[0] = a500_ec_leds_reset_seq[0];\n\t\tcontrol_seq[1] = led->other->enable_seq[0];\n\t}\n\n\treturn regmap_multi_reg_write(led->rmap, control_seq, num_regs);\n}\n\nstatic int a500_ec_leds_probe(struct platform_device *pdev)\n{\n\tstruct a500_led *white_led, *orange_led;\n\tstruct regmap *rmap;\n\tint err;\n\n\trmap = dev_get_regmap(pdev->dev.parent, \"KB930\");\n\tif (!rmap)\n\t\treturn -EINVAL;\n\n\t \n\tregmap_multi_reg_write(rmap, a500_ec_leds_reset_seq, 2);\n\n\twhite_led = devm_kzalloc(&pdev->dev, sizeof(*white_led), GFP_KERNEL);\n\tif (!white_led)\n\t\treturn -ENOMEM;\n\n\twhite_led->cdev.name = \"power:white\";\n\twhite_led->cdev.brightness_set_blocking = a500_ec_led_brightness_set;\n\twhite_led->cdev.flags = LED_CORE_SUSPENDRESUME;\n\twhite_led->cdev.max_brightness = 1;\n\twhite_led->enable_seq = a500_ec_white_led_enable_seq;\n\twhite_led->rmap = rmap;\n\n\torange_led = devm_kzalloc(&pdev->dev, sizeof(*orange_led), GFP_KERNEL);\n\tif (!orange_led)\n\t\treturn -ENOMEM;\n\n\torange_led->cdev.name = \"power:orange\";\n\torange_led->cdev.brightness_set_blocking = a500_ec_led_brightness_set;\n\torange_led->cdev.flags = LED_CORE_SUSPENDRESUME;\n\torange_led->cdev.max_brightness = 1;\n\torange_led->enable_seq = a500_ec_orange_led_enable_seq;\n\torange_led->rmap = rmap;\n\n\twhite_led->other = orange_led;\n\torange_led->other = white_led;\n\n\terr = devm_led_classdev_register(&pdev->dev, &white_led->cdev);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"failed to register white LED\\n\");\n\t\treturn err;\n\t}\n\n\terr = devm_led_classdev_register(&pdev->dev, &orange_led->cdev);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"failed to register orange LED\\n\");\n\t\treturn err;\n\t}\n\n\treturn 0;\n}\n\nstatic struct platform_driver a500_ec_leds_driver = {\n\t.driver = {\n\t\t.name = \"acer-a500-iconia-leds\",\n\t},\n\t.probe = a500_ec_leds_probe,\n};\nmodule_platform_driver(a500_ec_leds_driver);\n\nMODULE_DESCRIPTION(\"LED driver for Acer Iconia Tab A500 Power Button\");\nMODULE_AUTHOR(\"Dmitry Osipenko <digetx@gmail.com>\");\nMODULE_ALIAS(\"platform:acer-a500-iconia-leds\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}