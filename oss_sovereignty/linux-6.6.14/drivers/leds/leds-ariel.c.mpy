{
  "module_name": "leds-ariel.c",
  "hash_id": "3697c139fd6d4c9c8e9cb300aacef7ce39860cb418a4d31bbcb9b20a91804c05",
  "original_prompt": "Ingested from linux-6.6.14/drivers/leds/leds-ariel.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/leds.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\nenum ec_index {\n\tEC_BLUE_LED\t= 0x01,\n\tEC_AMBER_LED\t= 0x02,\n\tEC_GREEN_LED\t= 0x03,\n};\n\nenum {\n\tEC_LED_OFF\t= 0x00,\n\tEC_LED_STILL\t= 0x01,\n\tEC_LED_FADE\t= 0x02,\n\tEC_LED_BLINK\t= 0x03,\n};\n\nstruct ariel_led {\n\tstruct regmap *ec_ram;\n\tenum ec_index ec_index;\n\tstruct led_classdev led_cdev;\n};\n\n#define led_cdev_to_ariel_led(c) container_of(c, struct ariel_led, led_cdev)\n\nstatic enum led_brightness ariel_led_get(struct led_classdev *led_cdev)\n{\n\tstruct ariel_led *led = led_cdev_to_ariel_led(led_cdev);\n\tunsigned int led_status = 0;\n\n\tif (regmap_read(led->ec_ram, led->ec_index, &led_status))\n\t\treturn LED_OFF;\n\n\tif (led_status == EC_LED_STILL)\n\t\treturn LED_FULL;\n\telse\n\t\treturn LED_OFF;\n}\n\nstatic void ariel_led_set(struct led_classdev *led_cdev,\n\t\t\t  enum led_brightness brightness)\n{\n\tstruct ariel_led *led = led_cdev_to_ariel_led(led_cdev);\n\n\tif (brightness == LED_OFF)\n\t\tregmap_write(led->ec_ram, led->ec_index, EC_LED_OFF);\n\telse\n\t\tregmap_write(led->ec_ram, led->ec_index, EC_LED_STILL);\n}\n\nstatic int ariel_blink_set(struct led_classdev *led_cdev,\n\t\t\t   unsigned long *delay_on, unsigned long *delay_off)\n{\n\tstruct ariel_led *led = led_cdev_to_ariel_led(led_cdev);\n\n\tif (*delay_on == 0 && *delay_off == 0)\n\t\treturn -EINVAL;\n\n\tif (*delay_on == 0) {\n\t\tregmap_write(led->ec_ram, led->ec_index, EC_LED_OFF);\n\t} else if (*delay_off == 0) {\n\t\tregmap_write(led->ec_ram, led->ec_index, EC_LED_STILL);\n\t} else {\n\t\t*delay_on = 500;\n\t\t*delay_off = 500;\n\t\tregmap_write(led->ec_ram, led->ec_index, EC_LED_BLINK);\n\t}\n\n\treturn 0;\n}\n\n#define NLEDS 3\n\nstatic int ariel_led_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct ariel_led *leds;\n\tstruct regmap *ec_ram;\n\tint ret;\n\tint i;\n\n\tec_ram = dev_get_regmap(dev->parent, \"ec_ram\");\n\tif (!ec_ram)\n\t\treturn -ENODEV;\n\n\tleds = devm_kcalloc(dev, NLEDS, sizeof(*leds), GFP_KERNEL);\n\tif (!leds)\n\t\treturn -ENOMEM;\n\n\tleds[0].ec_index = EC_BLUE_LED;\n\tleds[0].led_cdev.name = \"blue:power\";\n\tleds[0].led_cdev.default_trigger = \"default-on\";\n\n\tleds[1].ec_index = EC_AMBER_LED;\n\tleds[1].led_cdev.name = \"amber:status\";\n\n\tleds[2].ec_index = EC_GREEN_LED;\n\tleds[2].led_cdev.name = \"green:status\";\n\tleds[2].led_cdev.default_trigger = \"default-on\";\n\n\tfor (i = 0; i < NLEDS; i++) {\n\t\tleds[i].ec_ram = ec_ram;\n\t\tleds[i].led_cdev.brightness_get = ariel_led_get;\n\t\tleds[i].led_cdev.brightness_set = ariel_led_set;\n\t\tleds[i].led_cdev.blink_set = ariel_blink_set;\n\n\t\tret = devm_led_classdev_register(dev, &leds[i].led_cdev);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic struct platform_driver ariel_led_driver = {\n\t.probe = ariel_led_probe,\n\t.driver = {\n\t\t.name = \"dell-wyse-ariel-led\",\n\t},\n};\nmodule_platform_driver(ariel_led_driver);\n\nMODULE_AUTHOR(\"Lubomir Rintel <lkundrak@v3.sk>\");\nMODULE_DESCRIPTION(\"Dell Wyse 3020 Status LEDs Driver\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}