{
  "module_name": "optee_private.h",
  "hash_id": "2f7e0966cb4d0d8de12222029c99ec4042f2f06b553f670c7eb4098f4613d058",
  "original_prompt": "Ingested from linux-6.6.14/drivers/tee/optee/optee_private.h",
  "human_readable_source": " \n \n\n#ifndef OPTEE_PRIVATE_H\n#define OPTEE_PRIVATE_H\n\n#include <linux/arm-smccc.h>\n#include <linux/rhashtable.h>\n#include <linux/semaphore.h>\n#include <linux/tee_drv.h>\n#include <linux/types.h>\n#include \"optee_msg.h\"\n\n#define DRIVER_NAME \"optee\"\n\n#define OPTEE_MAX_ARG_SIZE\t1024\n\n \n#define TEEC_SUCCESS\t\t\t0x00000000\n#define TEEC_ERROR_BAD_PARAMETERS\t0xFFFF0006\n#define TEEC_ERROR_NOT_SUPPORTED\t0xFFFF000A\n#define TEEC_ERROR_COMMUNICATION\t0xFFFF000E\n#define TEEC_ERROR_OUT_OF_MEMORY\t0xFFFF000C\n#define TEEC_ERROR_BUSY\t\t\t0xFFFF000D\n#define TEEC_ERROR_SHORT_BUFFER\t\t0xFFFF0010\n\n#define TEEC_ORIGIN_COMMS\t\t0x00000002\n\n \n#define OPTEE_DEFAULT_MAX_NOTIF_VALUE\t255\n\ntypedef void (optee_invoke_fn)(unsigned long, unsigned long, unsigned long,\n\t\t\t\tunsigned long, unsigned long, unsigned long,\n\t\t\t\tunsigned long, unsigned long,\n\t\t\t\tstruct arm_smccc_res *);\n\nstruct optee_call_waiter {\n\tstruct list_head list_node;\n\tstruct completion c;\n};\n\nstruct optee_call_queue {\n\t \n\tstruct mutex mutex;\n\tstruct list_head waiters;\n};\n\nstruct optee_notif {\n\tu_int max_key;\n\t \n\tspinlock_t lock;\n\tstruct list_head db;\n\tu_long *bitmap;\n};\n\n#define OPTEE_SHM_ARG_ALLOC_PRIV\tBIT(0)\n#define OPTEE_SHM_ARG_SHARED\t\tBIT(1)\nstruct optee_shm_arg_entry;\nstruct optee_shm_arg_cache {\n\tu32 flags;\n\t \n\tstruct mutex mutex;\n\tstruct list_head shm_args;\n};\n\n \nstruct optee_supp {\n\t \n\tstruct mutex mutex;\n\tstruct tee_context *ctx;\n\n\tint req_id;\n\tstruct list_head reqs;\n\tstruct idr idr;\n\tstruct completion reqs_c;\n};\n\n \nstruct optee_pcpu {\n\tstruct optee *optee;\n};\n\n \nstruct optee_smc {\n\toptee_invoke_fn *invoke_fn;\n\tvoid *memremaped_shm;\n\tu32 sec_caps;\n\tunsigned int notif_irq;\n\tstruct optee_pcpu __percpu *optee_pcpu;\n\tstruct workqueue_struct *notif_pcpu_wq;\n\tstruct work_struct notif_pcpu_work;\n\tunsigned int notif_cpuhp_state;\n};\n\n \nstruct optee_ffa {\n\tstruct ffa_device *ffa_dev;\n\t \n\tstruct mutex mutex;\n\tstruct rhashtable global_ids;\n};\n\nstruct optee;\n\n \nstruct optee_ops {\n\tint (*do_call_with_arg)(struct tee_context *ctx,\n\t\t\t\tstruct tee_shm *shm_arg, u_int offs);\n\tint (*to_msg_param)(struct optee *optee,\n\t\t\t    struct optee_msg_param *msg_params,\n\t\t\t    size_t num_params, const struct tee_param *params);\n\tint (*from_msg_param)(struct optee *optee, struct tee_param *params,\n\t\t\t      size_t num_params,\n\t\t\t      const struct optee_msg_param *msg_params);\n};\n\n \nstruct optee {\n\tstruct tee_device *supp_teedev;\n\tstruct tee_device *teedev;\n\tconst struct optee_ops *ops;\n\tstruct tee_context *ctx;\n\tunion {\n\t\tstruct optee_smc smc;\n\t\tstruct optee_ffa ffa;\n\t};\n\tstruct optee_shm_arg_cache shm_arg_cache;\n\tstruct optee_call_queue call_queue;\n\tstruct optee_notif notif;\n\tstruct optee_supp supp;\n\tstruct tee_shm_pool *pool;\n\tunsigned int rpc_param_count;\n\tbool   scan_bus_done;\n\tstruct workqueue_struct *scan_bus_wq;\n\tstruct work_struct scan_bus_work;\n};\n\nstruct optee_session {\n\tstruct list_head list_node;\n\tu32 session_id;\n};\n\nstruct optee_context_data {\n\t \n\tstruct mutex mutex;\n\tstruct list_head sess_list;\n};\n\nstruct optee_rpc_param {\n\tu32\ta0;\n\tu32\ta1;\n\tu32\ta2;\n\tu32\ta3;\n\tu32\ta4;\n\tu32\ta5;\n\tu32\ta6;\n\tu32\ta7;\n};\n\n \nstruct optee_call_ctx {\n\t \n\tvoid *pages_list;\n\tsize_t num_entries;\n};\n\nint optee_notif_init(struct optee *optee, u_int max_key);\nvoid optee_notif_uninit(struct optee *optee);\nint optee_notif_wait(struct optee *optee, u_int key);\nint optee_notif_send(struct optee *optee, u_int key);\n\nu32 optee_supp_thrd_req(struct tee_context *ctx, u32 func, size_t num_params,\n\t\t\tstruct tee_param *param);\n\nvoid optee_supp_init(struct optee_supp *supp);\nvoid optee_supp_uninit(struct optee_supp *supp);\nvoid optee_supp_release(struct optee_supp *supp);\n\nint optee_supp_recv(struct tee_context *ctx, u32 *func, u32 *num_params,\n\t\t    struct tee_param *param);\nint optee_supp_send(struct tee_context *ctx, u32 ret, u32 num_params,\n\t\t    struct tee_param *param);\n\nint optee_open_session(struct tee_context *ctx,\n\t\t       struct tee_ioctl_open_session_arg *arg,\n\t\t       struct tee_param *param);\nint optee_close_session_helper(struct tee_context *ctx, u32 session);\nint optee_close_session(struct tee_context *ctx, u32 session);\nint optee_invoke_func(struct tee_context *ctx, struct tee_ioctl_invoke_arg *arg,\n\t\t      struct tee_param *param);\nint optee_cancel_req(struct tee_context *ctx, u32 cancel_id, u32 session);\n\n#define PTA_CMD_GET_DEVICES\t\t0x0\n#define PTA_CMD_GET_DEVICES_SUPP\t0x1\nint optee_enumerate_devices(u32 func);\nvoid optee_unregister_devices(void);\n\nint optee_pool_op_alloc_helper(struct tee_shm_pool *pool, struct tee_shm *shm,\n\t\t\t       size_t size, size_t align,\n\t\t\t       int (*shm_register)(struct tee_context *ctx,\n\t\t\t\t\t\t   struct tee_shm *shm,\n\t\t\t\t\t\t   struct page **pages,\n\t\t\t\t\t\t   size_t num_pages,\n\t\t\t\t\t\t   unsigned long start));\nvoid optee_pool_op_free_helper(struct tee_shm_pool *pool, struct tee_shm *shm,\n\t\t\t       int (*shm_unregister)(struct tee_context *ctx,\n\t\t\t\t\t\t     struct tee_shm *shm));\n\n\nvoid optee_remove_common(struct optee *optee);\nint optee_open(struct tee_context *ctx, bool cap_memref_null);\nvoid optee_release(struct tee_context *ctx);\nvoid optee_release_supp(struct tee_context *ctx);\n\nstatic inline void optee_from_msg_param_value(struct tee_param *p, u32 attr,\n\t\t\t\t\t      const struct optee_msg_param *mp)\n{\n\tp->attr = TEE_IOCTL_PARAM_ATTR_TYPE_VALUE_INPUT +\n\t\t  attr - OPTEE_MSG_ATTR_TYPE_VALUE_INPUT;\n\tp->u.value.a = mp->u.value.a;\n\tp->u.value.b = mp->u.value.b;\n\tp->u.value.c = mp->u.value.c;\n}\n\nstatic inline void optee_to_msg_param_value(struct optee_msg_param *mp,\n\t\t\t\t\t    const struct tee_param *p)\n{\n\tmp->attr = OPTEE_MSG_ATTR_TYPE_VALUE_INPUT + p->attr -\n\t\t   TEE_IOCTL_PARAM_ATTR_TYPE_VALUE_INPUT;\n\tmp->u.value.a = p->u.value.a;\n\tmp->u.value.b = p->u.value.b;\n\tmp->u.value.c = p->u.value.c;\n}\n\nvoid optee_cq_wait_init(struct optee_call_queue *cq,\n\t\t\tstruct optee_call_waiter *w);\nvoid optee_cq_wait_for_completion(struct optee_call_queue *cq,\n\t\t\t\t  struct optee_call_waiter *w);\nvoid optee_cq_wait_final(struct optee_call_queue *cq,\n\t\t\t struct optee_call_waiter *w);\nint optee_check_mem_type(unsigned long start, size_t num_pages);\n\nvoid optee_shm_arg_cache_init(struct optee *optee, u32 flags);\nvoid optee_shm_arg_cache_uninit(struct optee *optee);\nstruct optee_msg_arg *optee_get_msg_arg(struct tee_context *ctx,\n\t\t\t\t\tsize_t num_params,\n\t\t\t\t\tstruct optee_shm_arg_entry **entry,\n\t\t\t\t\tstruct tee_shm **shm_ret,\n\t\t\t\t\tu_int *offs);\nvoid optee_free_msg_arg(struct tee_context *ctx,\n\t\t\tstruct optee_shm_arg_entry *entry, u_int offs);\nsize_t optee_msg_arg_size(size_t rpc_param_count);\n\n\nstruct tee_shm *optee_rpc_cmd_alloc_suppl(struct tee_context *ctx, size_t sz);\nvoid optee_rpc_cmd_free_suppl(struct tee_context *ctx, struct tee_shm *shm);\nvoid optee_rpc_cmd(struct tee_context *ctx, struct optee *optee,\n\t\t   struct optee_msg_arg *arg);\n\n \n\nstatic inline void *reg_pair_to_ptr(u32 reg0, u32 reg1)\n{\n\treturn (void *)(unsigned long)(((u64)reg0 << 32) | reg1);\n}\n\nstatic inline void reg_pair_from_64(u32 *reg0, u32 *reg1, u64 val)\n{\n\t*reg0 = val >> 32;\n\t*reg1 = val;\n}\n\n \nint optee_smc_abi_register(void);\nvoid optee_smc_abi_unregister(void);\nint optee_ffa_abi_register(void);\nvoid optee_ffa_abi_unregister(void);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}