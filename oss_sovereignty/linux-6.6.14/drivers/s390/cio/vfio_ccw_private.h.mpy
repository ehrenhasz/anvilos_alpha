{
  "module_name": "vfio_ccw_private.h",
  "hash_id": "d9d39a06964e75cc67f58b9fe83c802de2168303a45ee2799fbd85f24d415163",
  "original_prompt": "Ingested from linux-6.6.14/drivers/s390/cio/vfio_ccw_private.h",
  "human_readable_source": " \n \n\n#ifndef _VFIO_CCW_PRIVATE_H_\n#define _VFIO_CCW_PRIVATE_H_\n\n#include <linux/completion.h>\n#include <linux/eventfd.h>\n#include <linux/workqueue.h>\n#include <linux/vfio_ccw.h>\n#include <linux/vfio.h>\n#include <linux/mdev.h>\n#include <asm/crw.h>\n#include <asm/debug.h>\n\n#include \"css.h\"\n#include \"vfio_ccw_cp.h\"\n\n#define VFIO_CCW_OFFSET_SHIFT   10\n#define VFIO_CCW_OFFSET_TO_INDEX(off)\t(off >> VFIO_CCW_OFFSET_SHIFT)\n#define VFIO_CCW_INDEX_TO_OFFSET(index)\t((u64)(index) << VFIO_CCW_OFFSET_SHIFT)\n#define VFIO_CCW_OFFSET_MASK\t(((u64)(1) << VFIO_CCW_OFFSET_SHIFT) - 1)\n\n \nstruct vfio_ccw_private;\nstruct vfio_ccw_region;\n\nstruct vfio_ccw_regops {\n\tssize_t\t(*read)(struct vfio_ccw_private *private, char __user *buf,\n\t\t\tsize_t count, loff_t *ppos);\n\tssize_t\t(*write)(struct vfio_ccw_private *private,\n\t\t\t const char __user *buf, size_t count, loff_t *ppos);\n\tvoid\t(*release)(struct vfio_ccw_private *private,\n\t\t\t   struct vfio_ccw_region *region);\n};\n\nstruct vfio_ccw_region {\n\tu32\t\t\t\ttype;\n\tu32\t\t\t\tsubtype;\n\tconst struct vfio_ccw_regops\t*ops;\n\tvoid\t\t\t\t*data;\n\tsize_t\t\t\t\tsize;\n\tu32\t\t\t\tflags;\n};\n\nint vfio_ccw_register_dev_region(struct vfio_ccw_private *private,\n\t\t\t\t unsigned int subtype,\n\t\t\t\t const struct vfio_ccw_regops *ops,\n\t\t\t\t size_t size, u32 flags, void *data);\nvoid vfio_ccw_unregister_dev_regions(struct vfio_ccw_private *private);\n\nint vfio_ccw_register_async_dev_regions(struct vfio_ccw_private *private);\nint vfio_ccw_register_schib_dev_regions(struct vfio_ccw_private *private);\nint vfio_ccw_register_crw_dev_regions(struct vfio_ccw_private *private);\n\nstruct vfio_ccw_crw {\n\tstruct list_head\tnext;\n\tstruct crw\t\tcrw;\n};\n\n \nstruct vfio_ccw_parent {\n\tstruct device\t\tdev;\n\n\tstruct mdev_parent\tparent;\n\tstruct mdev_type\tmdev_type;\n\tstruct mdev_type\t*mdev_types[];\n};\n\n \nstruct vfio_ccw_private {\n\tstruct vfio_device vdev;\n\tint\t\t\tstate;\n\tstruct completion\t*completion;\n\tstruct ccw_io_region\t*io_region;\n\tstruct mutex\t\tio_mutex;\n\tstruct vfio_ccw_region *region;\n\tstruct ccw_cmd_region\t*cmd_region;\n\tstruct ccw_schib_region *schib_region;\n\tstruct ccw_crw_region\t*crw_region;\n\tint num_regions;\n\n\tstruct channel_program\tcp;\n\tstruct irb\t\tirb;\n\tunion scsw\t\tscsw;\n\tstruct list_head\tcrw;\n\n\tstruct eventfd_ctx\t*io_trigger;\n\tstruct eventfd_ctx\t*crw_trigger;\n\tstruct eventfd_ctx\t*req_trigger;\n\tstruct work_struct\tio_work;\n\tstruct work_struct\tcrw_work;\n} __aligned(8);\n\nint vfio_ccw_sch_quiesce(struct subchannel *sch);\nvoid vfio_ccw_sch_io_todo(struct work_struct *work);\nvoid vfio_ccw_crw_todo(struct work_struct *work);\n\nextern struct mdev_driver vfio_ccw_mdev_driver;\n\n \nenum vfio_ccw_state {\n\tVFIO_CCW_STATE_NOT_OPER,\n\tVFIO_CCW_STATE_STANDBY,\n\tVFIO_CCW_STATE_IDLE,\n\tVFIO_CCW_STATE_CP_PROCESSING,\n\tVFIO_CCW_STATE_CP_PENDING,\n\t \n\tNR_VFIO_CCW_STATES\n};\n\n \nenum vfio_ccw_event {\n\tVFIO_CCW_EVENT_NOT_OPER,\n\tVFIO_CCW_EVENT_IO_REQ,\n\tVFIO_CCW_EVENT_INTERRUPT,\n\tVFIO_CCW_EVENT_ASYNC_REQ,\n\tVFIO_CCW_EVENT_OPEN,\n\tVFIO_CCW_EVENT_CLOSE,\n\t \n\tNR_VFIO_CCW_EVENTS\n};\n\n \ntypedef void (fsm_func_t)(struct vfio_ccw_private *, enum vfio_ccw_event);\nextern fsm_func_t *vfio_ccw_jumptable[NR_VFIO_CCW_STATES][NR_VFIO_CCW_EVENTS];\n\nstatic inline void vfio_ccw_fsm_event(struct vfio_ccw_private *private,\n\t\t\t\t      enum vfio_ccw_event event)\n{\n\tstruct subchannel *sch = to_subchannel(private->vdev.dev->parent);\n\n\tif (sch)\n\t\ttrace_vfio_ccw_fsm_event(sch->schid, private->state, event);\n\tvfio_ccw_jumptable[private->state][event](private, event);\n}\n\nextern struct workqueue_struct *vfio_ccw_work_q;\nextern struct kmem_cache *vfio_ccw_io_region;\nextern struct kmem_cache *vfio_ccw_cmd_region;\nextern struct kmem_cache *vfio_ccw_schib_region;\nextern struct kmem_cache *vfio_ccw_crw_region;\n\n \nextern debug_info_t *vfio_ccw_debug_msg_id;\nextern debug_info_t *vfio_ccw_debug_trace_id;\n\n#define VFIO_CCW_TRACE_EVENT(imp, txt) \\\n\t\tdebug_text_event(vfio_ccw_debug_trace_id, imp, txt)\n\n#define VFIO_CCW_MSG_EVENT(imp, args...) \\\n\t\tdebug_sprintf_event(vfio_ccw_debug_msg_id, imp, ##args)\n\nstatic inline void VFIO_CCW_HEX_EVENT(int level, void *data, int length)\n{\n\tdebug_event(vfio_ccw_debug_trace_id, level, data, length);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}