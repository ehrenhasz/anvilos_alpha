{
  "module_name": "idset.c",
  "hash_id": "190a473ab710b5d1190602f63eeaca9851224792569a96bfb45a3826a46f24e9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/s390/cio/idset.c",
  "human_readable_source": "\n \n\n#include <linux/vmalloc.h>\n#include <linux/bitmap.h>\n#include <linux/bitops.h>\n#include \"idset.h\"\n#include \"css.h\"\n\nstruct idset {\n\tint num_ssid;\n\tint num_id;\n\tunsigned long bitmap[];\n};\n\nstatic inline unsigned long bitmap_size(int num_ssid, int num_id)\n{\n\treturn BITS_TO_LONGS(num_ssid * num_id) * sizeof(unsigned long);\n}\n\nstatic struct idset *idset_new(int num_ssid, int num_id)\n{\n\tstruct idset *set;\n\n\tset = vmalloc(sizeof(struct idset) + bitmap_size(num_ssid, num_id));\n\tif (set) {\n\t\tset->num_ssid = num_ssid;\n\t\tset->num_id = num_id;\n\t\tmemset(set->bitmap, 0, bitmap_size(num_ssid, num_id));\n\t}\n\treturn set;\n}\n\nvoid idset_free(struct idset *set)\n{\n\tvfree(set);\n}\n\nvoid idset_fill(struct idset *set)\n{\n\tmemset(set->bitmap, 0xff, bitmap_size(set->num_ssid, set->num_id));\n}\n\nstatic inline void idset_add(struct idset *set, int ssid, int id)\n{\n\tset_bit(ssid * set->num_id + id, set->bitmap);\n}\n\nstatic inline void idset_del(struct idset *set, int ssid, int id)\n{\n\tclear_bit(ssid * set->num_id + id, set->bitmap);\n}\n\nstatic inline int idset_contains(struct idset *set, int ssid, int id)\n{\n\treturn test_bit(ssid * set->num_id + id, set->bitmap);\n}\n\nstruct idset *idset_sch_new(void)\n{\n\treturn idset_new(max_ssid + 1, __MAX_SUBCHANNEL + 1);\n}\n\nvoid idset_sch_add(struct idset *set, struct subchannel_id schid)\n{\n\tidset_add(set, schid.ssid, schid.sch_no);\n}\n\nvoid idset_sch_del(struct idset *set, struct subchannel_id schid)\n{\n\tidset_del(set, schid.ssid, schid.sch_no);\n}\n\n \nvoid idset_sch_del_subseq(struct idset *set, struct subchannel_id schid)\n{\n\tint pos = schid.ssid * set->num_id + schid.sch_no;\n\n\tbitmap_clear(set->bitmap, pos, set->num_id - schid.sch_no);\n}\n\nint idset_sch_contains(struct idset *set, struct subchannel_id schid)\n{\n\treturn idset_contains(set, schid.ssid, schid.sch_no);\n}\n\nint idset_is_empty(struct idset *set)\n{\n\treturn bitmap_empty(set->bitmap, set->num_ssid * set->num_id);\n}\n\nvoid idset_add_set(struct idset *to, struct idset *from)\n{\n\tint len = min(to->num_ssid * to->num_id, from->num_ssid * from->num_id);\n\n\tbitmap_or(to->bitmap, to->bitmap, from->bitmap, len);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}