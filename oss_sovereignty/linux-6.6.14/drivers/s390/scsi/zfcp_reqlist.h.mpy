{
  "module_name": "zfcp_reqlist.h",
  "hash_id": "c9b486a9affb9be854474b679bee7332af353ba0f7253fd4ccddead5efa43f07",
  "original_prompt": "Ingested from linux-6.6.14/drivers/s390/scsi/zfcp_reqlist.h",
  "human_readable_source": " \n \n\n#ifndef ZFCP_REQLIST_H\n#define ZFCP_REQLIST_H\n\n#include <linux/types.h>\n\n \n#define ZFCP_REQ_LIST_BUCKETS 128u\n\n \nstruct zfcp_reqlist {\n\tspinlock_t lock;\n\tstruct list_head buckets[ZFCP_REQ_LIST_BUCKETS];\n};\n\nstatic inline size_t zfcp_reqlist_hash(u64 req_id)\n{\n\treturn req_id % ZFCP_REQ_LIST_BUCKETS;\n}\n\n \nstatic inline struct zfcp_reqlist *zfcp_reqlist_alloc(void)\n{\n\tsize_t i;\n\tstruct zfcp_reqlist *rl;\n\n\trl = kzalloc(sizeof(struct zfcp_reqlist), GFP_KERNEL);\n\tif (!rl)\n\t\treturn NULL;\n\n\tspin_lock_init(&rl->lock);\n\n\tfor (i = 0; i < ZFCP_REQ_LIST_BUCKETS; i++)\n\t\tINIT_LIST_HEAD(&rl->buckets[i]);\n\n\treturn rl;\n}\n\n \nstatic inline int zfcp_reqlist_isempty(struct zfcp_reqlist *rl)\n{\n\tsize_t i;\n\n\tfor (i = 0; i < ZFCP_REQ_LIST_BUCKETS; i++)\n\t\tif (!list_empty(&rl->buckets[i]))\n\t\t\treturn 0;\n\treturn 1;\n}\n\n \nstatic inline void zfcp_reqlist_free(struct zfcp_reqlist *rl)\n{\n\t \n\tBUG_ON(!zfcp_reqlist_isempty(rl));\n\n\tkfree(rl);\n}\n\nstatic inline struct zfcp_fsf_req *\n_zfcp_reqlist_find(struct zfcp_reqlist *rl, u64 req_id)\n{\n\tstruct zfcp_fsf_req *req;\n\tsize_t i;\n\n\ti = zfcp_reqlist_hash(req_id);\n\tlist_for_each_entry(req, &rl->buckets[i], list)\n\t\tif (req->req_id == req_id)\n\t\t\treturn req;\n\treturn NULL;\n}\n\n \nstatic inline struct zfcp_fsf_req *\nzfcp_reqlist_find(struct zfcp_reqlist *rl, u64 req_id)\n{\n\tunsigned long flags;\n\tstruct zfcp_fsf_req *req;\n\n\tspin_lock_irqsave(&rl->lock, flags);\n\treq = _zfcp_reqlist_find(rl, req_id);\n\tspin_unlock_irqrestore(&rl->lock, flags);\n\n\treturn req;\n}\n\n \nstatic inline struct zfcp_fsf_req *\nzfcp_reqlist_find_rm(struct zfcp_reqlist *rl, u64 req_id)\n{\n\tunsigned long flags;\n\tstruct zfcp_fsf_req *req;\n\n\tspin_lock_irqsave(&rl->lock, flags);\n\treq = _zfcp_reqlist_find(rl, req_id);\n\tif (req)\n\t\tlist_del(&req->list);\n\tspin_unlock_irqrestore(&rl->lock, flags);\n\n\treturn req;\n}\n\n \nstatic inline void zfcp_reqlist_add(struct zfcp_reqlist *rl,\n\t\t\t\t    struct zfcp_fsf_req *req)\n{\n\tsize_t i;\n\tunsigned long flags;\n\n\ti = zfcp_reqlist_hash(req->req_id);\n\n\tspin_lock_irqsave(&rl->lock, flags);\n\tlist_add_tail(&req->list, &rl->buckets[i]);\n\tspin_unlock_irqrestore(&rl->lock, flags);\n}\n\n \nstatic inline void zfcp_reqlist_move(struct zfcp_reqlist *rl,\n\t\t\t\t     struct list_head *list)\n{\n\tsize_t i;\n\tunsigned long flags;\n\n\tspin_lock_irqsave(&rl->lock, flags);\n\tfor (i = 0; i < ZFCP_REQ_LIST_BUCKETS; i++)\n\t\tlist_splice_init(&rl->buckets[i], list);\n\tspin_unlock_irqrestore(&rl->lock, flags);\n}\n\n \nstatic inline void\nzfcp_reqlist_apply_for_all(struct zfcp_reqlist *rl,\n\t\t\t   void (*f)(struct zfcp_fsf_req *, void *), void *data)\n{\n\tstruct zfcp_fsf_req *req;\n\tunsigned long flags;\n\tsize_t i;\n\n\tspin_lock_irqsave(&rl->lock, flags);\n\tfor (i = 0; i < ZFCP_REQ_LIST_BUCKETS; i++)\n\t\tlist_for_each_entry(req, &rl->buckets[i], list)\n\t\t\tf(req, data);\n\tspin_unlock_irqrestore(&rl->lock, flags);\n}\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}