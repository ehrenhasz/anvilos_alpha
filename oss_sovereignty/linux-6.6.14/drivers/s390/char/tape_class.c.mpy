{
  "module_name": "tape_class.c",
  "hash_id": "06d04eed11394a72579d2ac0bf8e0cba09a92f93be2bb34ff1392f277bc3a64e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/s390/char/tape_class.c",
  "human_readable_source": "\n \n\n#define KMSG_COMPONENT \"tape\"\n#define pr_fmt(fmt) KMSG_COMPONENT \": \" fmt\n\n#include <linux/slab.h>\n\n#include \"tape_class.h\"\n\nMODULE_AUTHOR(\"Stefan Bader <shbader@de.ibm.com>\");\nMODULE_DESCRIPTION(\n\t\"Copyright IBM Corp. 2004   All Rights Reserved.\\n\"\n\t\"tape_class.c\"\n);\nMODULE_LICENSE(\"GPL\");\n\nstatic struct class *tape_class;\n\n \nstruct tape_class_device *register_tape_dev(\n\tstruct device *\t\tdevice,\n\tdev_t\t\t\tdev,\n\tconst struct file_operations *fops,\n\tchar *\t\t\tdevice_name,\n\tchar *\t\t\tmode_name)\n{\n\tstruct tape_class_device *\ttcd;\n\tint\t\trc;\n\tchar *\t\ts;\n\n\ttcd = kzalloc(sizeof(struct tape_class_device), GFP_KERNEL);\n\tif (!tcd)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tstrscpy(tcd->device_name, device_name, TAPECLASS_NAME_LEN);\n\tfor (s = strchr(tcd->device_name, '/'); s; s = strchr(s, '/'))\n\t\t*s = '!';\n\tstrscpy(tcd->mode_name, mode_name, TAPECLASS_NAME_LEN);\n\tfor (s = strchr(tcd->mode_name, '/'); s; s = strchr(s, '/'))\n\t\t*s = '!';\n\n\ttcd->char_device = cdev_alloc();\n\tif (!tcd->char_device) {\n\t\trc = -ENOMEM;\n\t\tgoto fail_with_tcd;\n\t}\n\n\ttcd->char_device->owner = fops->owner;\n\ttcd->char_device->ops   = fops;\n\n\trc = cdev_add(tcd->char_device, dev, 1);\n\tif (rc)\n\t\tgoto fail_with_cdev;\n\n\ttcd->class_device = device_create(tape_class, device,\n\t\t\t\t\t  tcd->char_device->dev, NULL,\n\t\t\t\t\t  \"%s\", tcd->device_name);\n\trc = PTR_ERR_OR_ZERO(tcd->class_device);\n\tif (rc)\n\t\tgoto fail_with_cdev;\n\trc = sysfs_create_link(\n\t\t&device->kobj,\n\t\t&tcd->class_device->kobj,\n\t\ttcd->mode_name\n\t);\n\tif (rc)\n\t\tgoto fail_with_class_device;\n\n\treturn tcd;\n\nfail_with_class_device:\n\tdevice_destroy(tape_class, tcd->char_device->dev);\n\nfail_with_cdev:\n\tcdev_del(tcd->char_device);\n\nfail_with_tcd:\n\tkfree(tcd);\n\n\treturn ERR_PTR(rc);\n}\nEXPORT_SYMBOL(register_tape_dev);\n\nvoid unregister_tape_dev(struct device *device, struct tape_class_device *tcd)\n{\n\tif (tcd != NULL && !IS_ERR(tcd)) {\n\t\tsysfs_remove_link(&device->kobj, tcd->mode_name);\n\t\tdevice_destroy(tape_class, tcd->char_device->dev);\n\t\tcdev_del(tcd->char_device);\n\t\tkfree(tcd);\n\t}\n}\nEXPORT_SYMBOL(unregister_tape_dev);\n\n\nstatic int __init tape_init(void)\n{\n\ttape_class = class_create(\"tape390\");\n\n\treturn 0;\n}\n\nstatic void __exit tape_exit(void)\n{\n\tclass_destroy(tape_class);\n\ttape_class = NULL;\n}\n\npostcore_initcall(tape_init);\nmodule_exit(tape_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}