{
  "module_name": "scm_drv.c",
  "hash_id": "1210a249b3aefa5bb887043a9f0f6a1a46cc2b9cc25feca492b9f6c7fe6ffd9c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/s390/block/scm_drv.c",
  "human_readable_source": "\n \n\n#define KMSG_COMPONENT \"scm_block\"\n#define pr_fmt(fmt) KMSG_COMPONENT \": \" fmt\n\n#include <linux/module.h>\n#include <linux/slab.h>\n#include <asm/eadm.h>\n#include \"scm_blk.h\"\n\nstatic void scm_notify(struct scm_device *scmdev, enum scm_event event)\n{\n\tstruct scm_blk_dev *bdev = dev_get_drvdata(&scmdev->dev);\n\n\tswitch (event) {\n\tcase SCM_CHANGE:\n\t\tpr_info(\"%lx: The capabilities of the SCM increment changed\\n\",\n\t\t\t(unsigned long) scmdev->address);\n\t\tSCM_LOG(2, \"State changed\");\n\t\tSCM_LOG_STATE(2, scmdev);\n\t\tbreak;\n\tcase SCM_AVAIL:\n\t\tSCM_LOG(2, \"Increment available\");\n\t\tSCM_LOG_STATE(2, scmdev);\n\t\tscm_blk_set_available(bdev);\n\t\tbreak;\n\t}\n}\n\nstatic int scm_probe(struct scm_device *scmdev)\n{\n\tstruct scm_blk_dev *bdev;\n\tint ret;\n\n\tSCM_LOG(2, \"probe\");\n\tSCM_LOG_STATE(2, scmdev);\n\n\tif (scmdev->attrs.oper_state != OP_STATE_GOOD)\n\t\treturn -EINVAL;\n\n\tbdev = kzalloc(sizeof(*bdev), GFP_KERNEL);\n\tif (!bdev)\n\t\treturn -ENOMEM;\n\n\tdev_set_drvdata(&scmdev->dev, bdev);\n\tret = scm_blk_dev_setup(bdev, scmdev);\n\tif (ret) {\n\t\tdev_set_drvdata(&scmdev->dev, NULL);\n\t\tkfree(bdev);\n\t\tgoto out;\n\t}\n\nout:\n\treturn ret;\n}\n\nstatic void scm_remove(struct scm_device *scmdev)\n{\n\tstruct scm_blk_dev *bdev = dev_get_drvdata(&scmdev->dev);\n\n\tscm_blk_dev_cleanup(bdev);\n\tdev_set_drvdata(&scmdev->dev, NULL);\n\tkfree(bdev);\n}\n\nstatic struct scm_driver scm_drv = {\n\t.drv = {\n\t\t.name = \"scm_block\",\n\t\t.owner = THIS_MODULE,\n\t},\n\t.notify = scm_notify,\n\t.probe = scm_probe,\n\t.remove = scm_remove,\n\t.handler = scm_blk_irq,\n};\n\nint __init scm_drv_init(void)\n{\n\treturn scm_driver_register(&scm_drv);\n}\n\nvoid scm_drv_cleanup(void)\n{\n\tscm_driver_unregister(&scm_drv);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}