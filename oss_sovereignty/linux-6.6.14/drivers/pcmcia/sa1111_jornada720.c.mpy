{
  "module_name": "sa1111_jornada720.c",
  "hash_id": "5d631d8c5b94b6f4697c7c76cd467d8d28b4d505268a44471ee13d59108cac7a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pcmcia/sa1111_jornada720.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/device.h>\n#include <linux/errno.h>\n#include <linux/gpio/consumer.h>\n#include <linux/init.h>\n#include <linux/io.h>\n\n#include <mach/hardware.h>\n#include <asm/mach-types.h>\n\n#include \"sa1111_generic.h\"\n\n \nenum {\n\tJ720_GPIO_PWR,\n\tJ720_GPIO_3V,\n\tJ720_GPIO_MAX,\n};\nstruct jornada720_data {\n\tstruct gpio_desc *gpio[J720_GPIO_MAX];\n};\n\nstatic int jornada720_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\n{\n\tstruct device *dev = skt->socket.dev.parent;\n\tstruct jornada720_data *j;\n\n\tj = devm_kzalloc(dev, sizeof(*j), GFP_KERNEL);\n\tif (!j)\n\t\treturn -ENOMEM;\n\n\tj->gpio[J720_GPIO_PWR] = devm_gpiod_get(dev, skt->nr ? \"s1-power\" :\n\t\t\t\t\t\t\"s0-power\", GPIOD_OUT_LOW);\n\tif (IS_ERR(j->gpio[J720_GPIO_PWR]))\n\t\treturn PTR_ERR(j->gpio[J720_GPIO_PWR]);\n\n\tj->gpio[J720_GPIO_3V] = devm_gpiod_get(dev, skt->nr ? \"s1-3v\" :\n\t\t\t\t\t       \"s0-3v\", GPIOD_OUT_LOW);\n\tif (IS_ERR(j->gpio[J720_GPIO_3V]))\n\t\treturn PTR_ERR(j->gpio[J720_GPIO_3V]);\n\n\tskt->driver_data = j;\n\n\treturn 0;\n}\n\nstatic int\njornada720_pcmcia_configure_socket(struct soc_pcmcia_socket *skt, const socket_state_t *state)\n{\n\tstruct jornada720_data *j = skt->driver_data;\n\tDECLARE_BITMAP(values, J720_GPIO_MAX) = { 0, };\n\tint ret;\n\n\tprintk(KERN_INFO \"%s(): config socket %d vcc %d vpp %d\\n\", __func__,\n\t\tskt->nr, state->Vcc, state->Vpp);\n\n\tswitch (skt->nr) {\n\tcase 0:\n\t\tswitch (state->Vcc) {\n\t\tdefault:\n\t\tcase  0:\n\t\t\t__assign_bit(J720_GPIO_PWR, values, 0);\n\t\t\t__assign_bit(J720_GPIO_3V, values, 0);\n\t\t\tbreak;\n\t\tcase 33:\n\t\t\t__assign_bit(J720_GPIO_PWR, values, 1);\n\t\t\t__assign_bit(J720_GPIO_3V, values, 1);\n\t\t\tbreak;\n\t\tcase 50:\n\t\t\t__assign_bit(J720_GPIO_PWR, values, 1);\n\t\t\t__assign_bit(J720_GPIO_3V, values, 0);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tcase 1:\n\t\tswitch (state->Vcc) {\n\t\tdefault:\n\t\tcase 0:\n\t\t\t__assign_bit(J720_GPIO_PWR, values, 0);\n\t\t\t__assign_bit(J720_GPIO_3V, values, 0);\n\t\t\tbreak;\n\t\tcase 33:\n\t\tcase 50:\n\t\t\t__assign_bit(J720_GPIO_PWR, values, 1);\n\t\t\t__assign_bit(J720_GPIO_3V, values, 1);\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\n\tdefault:\n\t\treturn -1;\n\t}\n\n\tif (state->Vpp != state->Vcc && state->Vpp != 0) {\n\t\tprintk(KERN_ERR \"%s(): slot cannot support VPP %u\\n\",\n\t\t\t__func__, state->Vpp);\n\t\treturn -EPERM;\n\t}\n\n\tret = sa1111_pcmcia_configure_socket(skt, state);\n\tif (ret == 0)\n\t\tret = gpiod_set_array_value_cansleep(J720_GPIO_MAX, j->gpio,\n\t\t\t\t\t\t     NULL, values);\n\n\treturn ret;\n}\n\nstatic struct pcmcia_low_level jornada720_pcmcia_ops = {\n\t.owner\t\t\t= THIS_MODULE,\n\t.hw_init\t\t= jornada720_pcmcia_hw_init,\n\t.configure_socket\t= jornada720_pcmcia_configure_socket,\n\t.first\t\t\t= 0,\n\t.nr\t\t\t= 2,\n};\n\nint pcmcia_jornada720_init(struct sa1111_dev *sadev)\n{\n\t \n\tGRER |= 0x00000002;\n\n\tsa11xx_drv_pcmcia_ops(&jornada720_pcmcia_ops);\n\treturn sa1111_pcmcia_add(sadev, &jornada720_pcmcia_ops,\n\t\t\t\t sa11xx_drv_pcmcia_add_one);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}