{
  "module_name": "socket_sysfs.c",
  "hash_id": "de6c9d62e485c22425203466c336a105935ad5018f28ff775de4f3a5e55e7f60",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pcmcia/socket_sysfs.c",
  "human_readable_source": "\n \n\n#include <linux/module.h>\n#include <linux/moduleparam.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/string.h>\n#include <linux/major.h>\n#include <linux/errno.h>\n#include <linux/mm.h>\n#include <linux/interrupt.h>\n#include <linux/timer.h>\n#include <linux/ioport.h>\n#include <linux/delay.h>\n#include <linux/pm.h>\n#include <linux/device.h>\n#include <linux/mutex.h>\n#include <asm/irq.h>\n\n#include <pcmcia/ss.h>\n#include <pcmcia/cistpl.h>\n#include <pcmcia/cisreg.h>\n#include <pcmcia/ds.h>\n#include \"cs_internal.h\"\n\n#define to_socket(_dev) container_of(_dev, struct pcmcia_socket, dev)\n\nstatic ssize_t pccard_show_type(struct device *dev, struct device_attribute *attr,\n\t\t\t\tchar *buf)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\n\tif (!(s->state & SOCKET_PRESENT))\n\t\treturn -ENODEV;\n\tif (s->state & SOCKET_CARDBUS)\n\t\treturn sysfs_emit(buf, \"32-bit\\n\");\n\treturn sysfs_emit(buf, \"16-bit\\n\");\n}\nstatic DEVICE_ATTR(card_type, 0444, pccard_show_type, NULL);\n\nstatic ssize_t pccard_show_voltage(struct device *dev, struct device_attribute *attr,\n\t\t\t\t   char *buf)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\n\tif (!(s->state & SOCKET_PRESENT))\n\t\treturn -ENODEV;\n\tif (s->socket.Vcc)\n\t\treturn sysfs_emit(buf, \"%d.%dV\\n\", s->socket.Vcc / 10,\n\t\t\t       s->socket.Vcc % 10);\n\treturn sysfs_emit(buf, \"X.XV\\n\");\n}\nstatic DEVICE_ATTR(card_voltage, 0444, pccard_show_voltage, NULL);\n\nstatic ssize_t pccard_show_vpp(struct device *dev, struct device_attribute *attr,\n\t\t\t       char *buf)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\tif (!(s->state & SOCKET_PRESENT))\n\t\treturn -ENODEV;\n\treturn sysfs_emit(buf, \"%d.%dV\\n\", s->socket.Vpp / 10, s->socket.Vpp % 10);\n}\nstatic DEVICE_ATTR(card_vpp, 0444, pccard_show_vpp, NULL);\n\nstatic ssize_t pccard_show_vcc(struct device *dev, struct device_attribute *attr,\n\t\t\t       char *buf)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\tif (!(s->state & SOCKET_PRESENT))\n\t\treturn -ENODEV;\n\treturn sysfs_emit(buf, \"%d.%dV\\n\", s->socket.Vcc / 10, s->socket.Vcc % 10);\n}\nstatic DEVICE_ATTR(card_vcc, 0444, pccard_show_vcc, NULL);\n\n\nstatic ssize_t pccard_store_insert(struct device *dev, struct device_attribute *attr,\n\t\t\t\t   const char *buf, size_t count)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\n\tif (!count)\n\t\treturn -EINVAL;\n\n\tpcmcia_parse_uevents(s, PCMCIA_UEVENT_INSERT);\n\n\treturn count;\n}\nstatic DEVICE_ATTR(card_insert, 0200, NULL, pccard_store_insert);\n\n\nstatic ssize_t pccard_show_card_pm_state(struct device *dev,\n\t\t\t\t\t struct device_attribute *attr,\n\t\t\t\t\t char *buf)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\treturn sysfs_emit(buf, \"%s\\n\", s->state & SOCKET_SUSPEND ? \"off\" : \"on\");\n}\n\nstatic ssize_t pccard_store_card_pm_state(struct device *dev,\n\t\t\t\t\t  struct device_attribute *attr,\n\t\t\t\t\t  const char *buf, size_t count)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\tssize_t ret = count;\n\n\tif (!count)\n\t\treturn -EINVAL;\n\n\tif (!strncmp(buf, \"off\", 3))\n\t\tpcmcia_parse_uevents(s, PCMCIA_UEVENT_SUSPEND);\n\telse {\n\t\tif (!strncmp(buf, \"on\", 2))\n\t\t\tpcmcia_parse_uevents(s, PCMCIA_UEVENT_RESUME);\n\t\telse\n\t\t\tret = -EINVAL;\n\t}\n\n\treturn ret;\n}\nstatic DEVICE_ATTR(card_pm_state, 0644, pccard_show_card_pm_state, pccard_store_card_pm_state);\n\nstatic ssize_t pccard_store_eject(struct device *dev,\n\t\t\t\t  struct device_attribute *attr,\n\t\t\t\t  const char *buf, size_t count)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\n\tif (!count)\n\t\treturn -EINVAL;\n\n\tpcmcia_parse_uevents(s, PCMCIA_UEVENT_EJECT);\n\n\treturn count;\n}\nstatic DEVICE_ATTR(card_eject, 0200, NULL, pccard_store_eject);\n\n\nstatic ssize_t pccard_show_irq_mask(struct device *dev,\n\t\t\t\t    struct device_attribute *attr,\n\t\t\t\t    char *buf)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\treturn sysfs_emit(buf, \"0x%04x\\n\", s->irq_mask);\n}\n\nstatic ssize_t pccard_store_irq_mask(struct device *dev,\n\t\t\t\t     struct device_attribute *attr,\n\t\t\t\t     const char *buf, size_t count)\n{\n\tssize_t ret;\n\tstruct pcmcia_socket *s = to_socket(dev);\n\tu32 mask;\n\n\tif (!count)\n\t\treturn -EINVAL;\n\n\tret = sscanf(buf, \"0x%x\\n\", &mask);\n\n\tif (ret == 1) {\n\t\tmutex_lock(&s->ops_mutex);\n\t\ts->irq_mask &= mask;\n\t\tmutex_unlock(&s->ops_mutex);\n\t\tret = 0;\n\t}\n\n\treturn ret ? ret : count;\n}\nstatic DEVICE_ATTR(card_irq_mask, 0600, pccard_show_irq_mask, pccard_store_irq_mask);\n\n\nstatic ssize_t pccard_show_resource(struct device *dev,\n\t\t\t\t    struct device_attribute *attr, char *buf)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\treturn sysfs_emit(buf, \"%s\\n\", s->resource_setup_done ? \"yes\" : \"no\");\n}\n\nstatic ssize_t pccard_store_resource(struct device *dev,\n\t\t\t\t     struct device_attribute *attr,\n\t\t\t\t     const char *buf, size_t count)\n{\n\tstruct pcmcia_socket *s = to_socket(dev);\n\n\tif (!count)\n\t\treturn -EINVAL;\n\n\tmutex_lock(&s->ops_mutex);\n\tif (!s->resource_setup_done)\n\t\ts->resource_setup_done = 1;\n\tmutex_unlock(&s->ops_mutex);\n\n\tpcmcia_parse_uevents(s, PCMCIA_UEVENT_REQUERY);\n\n\treturn count;\n}\nstatic DEVICE_ATTR(available_resources_setup_done, 0600, pccard_show_resource, pccard_store_resource);\n\nstatic struct attribute *pccard_socket_attributes[] = {\n\t&dev_attr_card_type.attr,\n\t&dev_attr_card_voltage.attr,\n\t&dev_attr_card_vpp.attr,\n\t&dev_attr_card_vcc.attr,\n\t&dev_attr_card_insert.attr,\n\t&dev_attr_card_pm_state.attr,\n\t&dev_attr_card_eject.attr,\n\t&dev_attr_card_irq_mask.attr,\n\t&dev_attr_available_resources_setup_done.attr,\n\tNULL,\n};\n\nstatic const struct attribute_group socket_attrs = {\n\t.attrs = pccard_socket_attributes,\n};\n\nint pccard_sysfs_add_socket(struct device *dev)\n{\n\treturn sysfs_create_group(&dev->kobj, &socket_attrs);\n}\n\nvoid pccard_sysfs_remove_socket(struct device *dev)\n{\n\tsysfs_remove_group(&dev->kobj, &socket_attrs);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}