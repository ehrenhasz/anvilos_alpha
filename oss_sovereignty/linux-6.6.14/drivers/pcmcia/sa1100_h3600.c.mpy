{
  "module_name": "sa1100_h3600.c",
  "hash_id": "9944ded6727b7c6044caa5471ff3b98b9d7d7d14bc0e40a45402c78556089ad8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/pcmcia/sa1100_h3600.c",
  "human_readable_source": "\n \n#include <linux/module.h>\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/interrupt.h>\n#include <linux/init.h>\n#include <linux/delay.h>\n#include <linux/gpio.h>\n\n#include <mach/hardware.h>\n#include <asm/irq.h>\n#include <asm/mach-types.h>\n#include <mach/h3xxx.h>\n\n#include \"sa1100_generic.h\"\n\nstatic int h3600_pcmcia_hw_init(struct soc_pcmcia_socket *skt)\n{\n\tint err;\n\n\tskt->stat[SOC_STAT_CD].name = skt->nr ? \"pcmcia1-detect\" : \"pcmcia0-detect\";\n\tskt->stat[SOC_STAT_RDY].name = skt->nr ? \"pcmcia1-ready\" : \"pcmcia0-ready\";\n\n\terr = soc_pcmcia_request_gpiods(skt);\n\tif (err)\n\t\treturn err;\n\n\tswitch (skt->nr) {\n\tcase 0:\n\t\terr = gpio_request(H3XXX_EGPIO_OPT_NVRAM_ON, \"OPT NVRAM ON\");\n\t\tif (err)\n\t\t\tgoto err01;\n\t\terr = gpio_direction_output(H3XXX_EGPIO_OPT_NVRAM_ON, 0);\n\t\tif (err)\n\t\t\tgoto err03;\n\t\terr = gpio_request(H3XXX_EGPIO_OPT_ON, \"OPT ON\");\n\t\tif (err)\n\t\t\tgoto err03;\n\t\terr = gpio_direction_output(H3XXX_EGPIO_OPT_ON, 0);\n\t\tif (err)\n\t\t\tgoto err04;\n\t\terr = gpio_request(H3XXX_EGPIO_OPT_RESET, \"OPT RESET\");\n\t\tif (err)\n\t\t\tgoto err04;\n\t\terr = gpio_direction_output(H3XXX_EGPIO_OPT_RESET, 0);\n\t\tif (err)\n\t\t\tgoto err05;\n\t\terr = gpio_request(H3XXX_EGPIO_CARD_RESET, \"PCMCIA CARD RESET\");\n\t\tif (err)\n\t\t\tgoto err05;\n\t\terr = gpio_direction_output(H3XXX_EGPIO_CARD_RESET, 0);\n\t\tif (err)\n\t\t\tgoto err06;\n\t\tbreak;\n\tcase 1:\n\t\tbreak;\n\t}\n\treturn 0;\n\nerr06:\tgpio_free(H3XXX_EGPIO_CARD_RESET);\nerr05:\tgpio_free(H3XXX_EGPIO_OPT_RESET);\nerr04:\tgpio_free(H3XXX_EGPIO_OPT_ON);\nerr03:\tgpio_free(H3XXX_EGPIO_OPT_NVRAM_ON);\nerr01:\tgpio_free(H3XXX_GPIO_PCMCIA_IRQ0);\n\treturn err;\n}\n\nstatic void h3600_pcmcia_hw_shutdown(struct soc_pcmcia_socket *skt)\n{\n\tswitch (skt->nr) {\n\tcase 0:\n\t\t \n\t\tgpio_set_value(H3XXX_EGPIO_OPT_NVRAM_ON, 0);\n\t\tgpio_set_value(H3XXX_EGPIO_OPT_ON, 0);\n\t\tgpio_set_value(H3XXX_EGPIO_OPT_RESET, 1);\n\n\t\tgpio_free(H3XXX_EGPIO_CARD_RESET);\n\t\tgpio_free(H3XXX_EGPIO_OPT_RESET);\n\t\tgpio_free(H3XXX_EGPIO_OPT_ON);\n\t\tgpio_free(H3XXX_EGPIO_OPT_NVRAM_ON);\n\t\tbreak;\n\tcase 1:\n\t\tbreak;\n\t}\n}\n\nstatic void\nh3600_pcmcia_socket_state(struct soc_pcmcia_socket *skt, struct pcmcia_state *state)\n{\n\tstate->bvd1 = 0;\n\tstate->bvd2 = 0;\n\tstate->vs_3v = 0;\n\tstate->vs_Xv = 0;\n}\n\nstatic int\nh3600_pcmcia_configure_socket(struct soc_pcmcia_socket *skt, const socket_state_t *state)\n{\n\tif (state->Vcc != 0 && state->Vcc != 33 && state->Vcc != 50) {\n\t\tprintk(KERN_ERR \"h3600_pcmcia: unrecognized Vcc %u.%uV\\n\",\n\t\t       state->Vcc / 10, state->Vcc % 10);\n\t\treturn -1;\n\t}\n\n\tgpio_set_value(H3XXX_EGPIO_CARD_RESET, !!(state->flags & SS_RESET));\n\n\t \n\n\treturn 0;\n}\n\nstatic void h3600_pcmcia_socket_init(struct soc_pcmcia_socket *skt)\n{\n\t \n\tgpio_set_value(H3XXX_EGPIO_OPT_NVRAM_ON, 1);\n\tgpio_set_value(H3XXX_EGPIO_OPT_ON, 1);\n\tgpio_set_value(H3XXX_EGPIO_OPT_RESET, 0);\n\n\tmsleep(10);\n}\n\nstatic void h3600_pcmcia_socket_suspend(struct soc_pcmcia_socket *skt)\n{\n\t \n\tif (skt->nr == 1) {\n\t\tgpio_set_value(H3XXX_EGPIO_OPT_ON, 0);\n\t\tgpio_set_value(H3XXX_EGPIO_OPT_NVRAM_ON, 0);\n\t\t \n\t\tgpio_set_value(H3XXX_EGPIO_OPT_RESET, 1);\n\t}\n}\n\nstruct pcmcia_low_level h3600_pcmcia_ops = { \n\t.owner\t\t\t= THIS_MODULE,\n\t.hw_init\t\t= h3600_pcmcia_hw_init,\n\t.hw_shutdown\t\t= h3600_pcmcia_hw_shutdown,\n\t.socket_state\t\t= h3600_pcmcia_socket_state,\n\t.configure_socket\t= h3600_pcmcia_configure_socket,\n\n\t.socket_init\t\t= h3600_pcmcia_socket_init,\n\t.socket_suspend\t\t= h3600_pcmcia_socket_suspend,\n};\n\nint pcmcia_h3600_init(struct device *dev)\n{\n\tint ret = -ENODEV;\n\n\tif (machine_is_h3600())\n\t\tret = sa11xx_drv_pcmcia_probe(dev, &h3600_pcmcia_ops, 0, 2);\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}