{
  "module_name": "cqhci.h",
  "hash_id": "3ddc57b675ecb7a49f259883a5d5c4f18c3121570e3110bc75d05e2426ff7c40",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mmc/host/cqhci.h",
  "human_readable_source": " \n \n#ifndef LINUX_MMC_CQHCI_H\n#define LINUX_MMC_CQHCI_H\n\n#include <linux/compiler.h>\n#include <linux/bitfield.h>\n#include <linux/bitops.h>\n#include <linux/spinlock_types.h>\n#include <linux/types.h>\n#include <linux/completion.h>\n#include <linux/wait.h>\n#include <linux/irqreturn.h>\n#include <asm/io.h>\n\n \n \n#define CQHCI_VER\t\t\t0x00\n#define CQHCI_VER_MAJOR(x)\t\t(((x) & GENMASK(11, 8)) >> 8)\n#define CQHCI_VER_MINOR1(x)\t\t(((x) & GENMASK(7, 4)) >> 4)\n#define CQHCI_VER_MINOR2(x)\t\t((x) & GENMASK(3, 0))\n\n \n#define CQHCI_CAP\t\t\t0x04\n#define CQHCI_CAP_CS\t\t\t0x10000000  \n#define CQHCI_CAP_ITCFMUL\t\tGENMASK(15, 12)\n#define CQHCI_ITCFMUL(x)\t\tFIELD_GET(CQHCI_CAP_ITCFMUL, (x))\n\n \n#define CQHCI_CFG\t\t\t0x08\n#define CQHCI_DCMD\t\t\t0x00001000\n#define CQHCI_TASK_DESC_SZ\t\t0x00000100\n#define CQHCI_CRYPTO_GENERAL_ENABLE\t0x00000002\n#define CQHCI_ENABLE\t\t\t0x00000001\n\n \n#define CQHCI_CTL\t\t\t0x0C\n#define CQHCI_CLEAR_ALL_TASKS\t\t0x00000100\n#define CQHCI_HALT\t\t\t0x00000001\n\n \n#define CQHCI_IS\t\t\t0x10\n#define CQHCI_IS_HAC\t\t\tBIT(0)\n#define CQHCI_IS_TCC\t\t\tBIT(1)\n#define CQHCI_IS_RED\t\t\tBIT(2)\n#define CQHCI_IS_TCL\t\t\tBIT(3)\n#define CQHCI_IS_GCE\t\t\tBIT(4)  \n#define CQHCI_IS_ICCE\t\t\tBIT(5)  \n\n#define CQHCI_IS_MASK (CQHCI_IS_TCC | CQHCI_IS_RED | \\\n\t\t       CQHCI_IS_GCE | CQHCI_IS_ICCE)\n\n \n#define CQHCI_ISTE\t\t\t0x14\n\n \n#define CQHCI_ISGE\t\t\t0x18\n\n \n#define CQHCI_IC\t\t\t0x1C\n#define CQHCI_IC_ENABLE\t\t\tBIT(31)\n#define CQHCI_IC_RESET\t\t\tBIT(16)\n#define CQHCI_IC_ICCTHWEN\t\tBIT(15)\n#define CQHCI_IC_ICCTH(x)\t\t(((x) & 0x1F) << 8)\n#define CQHCI_IC_ICTOVALWEN\t\tBIT(7)\n#define CQHCI_IC_ICTOVAL(x)\t\t((x) & 0x7F)\n\n \n#define CQHCI_TDLBA\t\t\t0x20\n\n \n#define CQHCI_TDLBAU\t\t\t0x24\n\n \n#define CQHCI_TDBR\t\t\t0x28\n\n \n#define CQHCI_TCN\t\t\t0x2C\n\n \n#define CQHCI_DQS\t\t\t0x30\n\n \n#define CQHCI_DPT\t\t\t0x34\n\n \n#define CQHCI_TCLR\t\t\t0x38\n\n \n#define CQHCI_TDPE\t\t\t0x3c\n\n \n#define CQHCI_SSC1\t\t\t0x40\n#define CQHCI_SSC1_CBC_MASK\t\tGENMASK(19, 16)\n\n \n#define CQHCI_SSC2\t\t\t0x44\n\n \n#define CQHCI_CRDCT\t\t\t0x48\n\n \n#define CQHCI_RMEM\t\t\t0x50\n\n \n#define CQHCI_TERRI\t\t\t0x54\n\n#define CQHCI_TERRI_C_INDEX(x)\t\t((x) & GENMASK(5, 0))\n#define CQHCI_TERRI_C_TASK(x)\t\t(((x) & GENMASK(12, 8)) >> 8)\n#define CQHCI_TERRI_C_VALID(x)\t\t((x) & BIT(15))\n#define CQHCI_TERRI_D_INDEX(x)\t\t(((x) & GENMASK(21, 16)) >> 16)\n#define CQHCI_TERRI_D_TASK(x)\t\t(((x) & GENMASK(28, 24)) >> 24)\n#define CQHCI_TERRI_D_VALID(x)\t\t((x) & BIT(31))\n\n \n#define CQHCI_CRI\t\t\t0x58\n\n \n#define CQHCI_CRA\t\t\t0x5C\n\n \n#define CQHCI_CCAP\t\t\t0x100\n#define CQHCI_CRYPTOCAP\t\t\t0x104\n\n#define CQHCI_INT_ALL\t\t\t0xF\n#define CQHCI_IC_DEFAULT_ICCTH\t\t31\n#define CQHCI_IC_DEFAULT_ICTOVAL\t1\n\n \n#define CQHCI_VALID(x)\t\t\t(((x) & 1) << 0)\n#define CQHCI_END(x)\t\t\t(((x) & 1) << 1)\n#define CQHCI_INT(x)\t\t\t(((x) & 1) << 2)\n#define CQHCI_ACT(x)\t\t\t(((x) & 0x7) << 3)\n\n \n#define CQHCI_FORCED_PROG(x)\t\t(((x) & 1) << 6)\n#define CQHCI_CONTEXT(x)\t\t(((x) & 0xF) << 7)\n#define CQHCI_DATA_TAG(x)\t\t(((x) & 1) << 11)\n#define CQHCI_DATA_DIR(x)\t\t(((x) & 1) << 12)\n#define CQHCI_PRIORITY(x)\t\t(((x) & 1) << 13)\n#define CQHCI_QBAR(x)\t\t\t(((x) & 1) << 14)\n#define CQHCI_REL_WRITE(x)\t\t(((x) & 1) << 15)\n#define CQHCI_BLK_COUNT(x)\t\t(((x) & 0xFFFF) << 16)\n#define CQHCI_BLK_ADDR(x)\t\t(((x) & 0xFFFFFFFF) << 32)\n\n \n#define CQHCI_CMD_INDEX(x)\t\t(((x) & 0x3F) << 16)\n#define CQHCI_CMD_TIMING(x)\t\t(((x) & 1) << 22)\n#define CQHCI_RESP_TYPE(x)\t\t(((x) & 0x3) << 23)\n\n \n#define CQHCI_CRYPTO_ENABLE_BIT\t\t(1ULL << 47)\n#define CQHCI_CRYPTO_KEYSLOT(x)\t\t((u64)(x) << 32)\n\n \n#define CQHCI_DAT_LENGTH(x)\t\t(((x) & 0xFFFF) << 16)\n#define CQHCI_DAT_ADDR_LO(x)\t\t(((x) & 0xFFFFFFFF) << 32)\n#define CQHCI_DAT_ADDR_HI(x)\t\t(((x) & 0xFFFFFFFF) << 0)\n\n \nunion cqhci_crypto_capabilities {\n\t__le32 reg_val;\n\tstruct {\n\t\tu8 num_crypto_cap;\n\t\tu8 config_count;\n\t\tu8 reserved;\n\t\tu8 config_array_ptr;\n\t};\n};\n\nenum cqhci_crypto_key_size {\n\tCQHCI_CRYPTO_KEY_SIZE_INVALID\t= 0,\n\tCQHCI_CRYPTO_KEY_SIZE_128\t= 1,\n\tCQHCI_CRYPTO_KEY_SIZE_192\t= 2,\n\tCQHCI_CRYPTO_KEY_SIZE_256\t= 3,\n\tCQHCI_CRYPTO_KEY_SIZE_512\t= 4,\n};\n\nenum cqhci_crypto_alg {\n\tCQHCI_CRYPTO_ALG_AES_XTS\t\t= 0,\n\tCQHCI_CRYPTO_ALG_BITLOCKER_AES_CBC\t= 1,\n\tCQHCI_CRYPTO_ALG_AES_ECB\t\t= 2,\n\tCQHCI_CRYPTO_ALG_ESSIV_AES_CBC\t\t= 3,\n};\n\n \nunion cqhci_crypto_cap_entry {\n\t__le32 reg_val;\n\tstruct {\n\t\tu8 algorithm_id;\n\t\tu8 sdus_mask;  \n\t\tu8 key_size;\n\t\tu8 reserved;\n\t};\n};\n\n#define CQHCI_CRYPTO_CONFIGURATION_ENABLE (1 << 7)\n#define CQHCI_CRYPTO_KEY_MAX_SIZE 64\n \nunion cqhci_crypto_cfg_entry {\n\t__le32 reg_val[32];\n\tstruct {\n\t\tu8 crypto_key[CQHCI_CRYPTO_KEY_MAX_SIZE];\n\t\tu8 data_unit_size;\n\t\tu8 crypto_cap_idx;\n\t\tu8 reserved_1;\n\t\tu8 config_enable;\n\t\tu8 reserved_multi_host;\n\t\tu8 reserved_2;\n\t\tu8 vsb[2];\n\t\tu8 reserved_3[56];\n\t};\n};\n\nstruct cqhci_host_ops;\nstruct mmc_host;\nstruct mmc_request;\nstruct cqhci_slot;\n\nstruct cqhci_host {\n\tconst struct cqhci_host_ops *ops;\n\tvoid __iomem *mmio;\n\tstruct mmc_host *mmc;\n\n\tspinlock_t lock;\n\n\t \n\tunsigned int rca;\n\n\t \n\tbool dma64;\n\tint num_slots;\n\tint qcnt;\n\n\tu32 dcmd_slot;\n\tu32 caps;\n#define CQHCI_TASK_DESC_SZ_128\t\t0x1\n\n\tu32 quirks;\n#define CQHCI_QUIRK_SHORT_TXFR_DESC_SZ\t0x1\n\n\tbool enabled;\n\tbool halted;\n\tbool init_done;\n\tbool activated;\n\tbool waiting_for_idle;\n\tbool recovery_halt;\n\n\tsize_t desc_size;\n\tsize_t data_size;\n\n\tu8 *desc_base;\n\n\t \n\tu8 slot_sz;\n\n\t \n\tu8 task_desc_len;\n\n\t \n\tu8 link_desc_len;\n\n\tu8 *trans_desc_base;\n\t \n\tu8 trans_desc_len;\n\n\tdma_addr_t desc_dma_base;\n\tdma_addr_t trans_desc_dma_base;\n\n\tstruct completion halt_comp;\n\twait_queue_head_t wait_queue;\n\tstruct cqhci_slot *slot;\n\n#ifdef CONFIG_MMC_CRYPTO\n\tunion cqhci_crypto_capabilities crypto_capabilities;\n\tunion cqhci_crypto_cap_entry *crypto_cap_array;\n\tu32 crypto_cfg_register;\n#endif\n};\n\nstruct cqhci_host_ops {\n\tvoid (*dumpregs)(struct mmc_host *mmc);\n\tvoid (*write_l)(struct cqhci_host *host, u32 val, int reg);\n\tu32 (*read_l)(struct cqhci_host *host, int reg);\n\tvoid (*enable)(struct mmc_host *mmc);\n\tvoid (*disable)(struct mmc_host *mmc, bool recovery);\n\tvoid (*update_dcmd_desc)(struct mmc_host *mmc, struct mmc_request *mrq,\n\t\t\t\t u64 *data);\n\tvoid (*pre_enable)(struct mmc_host *mmc);\n\tvoid (*post_disable)(struct mmc_host *mmc);\n#ifdef CONFIG_MMC_CRYPTO\n\tint (*program_key)(struct cqhci_host *cq_host,\n\t\t\t   const union cqhci_crypto_cfg_entry *cfg, int slot);\n#endif\n};\n\nstatic inline void cqhci_writel(struct cqhci_host *host, u32 val, int reg)\n{\n\tif (unlikely(host->ops->write_l))\n\t\thost->ops->write_l(host, val, reg);\n\telse\n\t\twritel_relaxed(val, host->mmio + reg);\n}\n\nstatic inline u32 cqhci_readl(struct cqhci_host *host, int reg)\n{\n\tif (unlikely(host->ops->read_l))\n\t\treturn host->ops->read_l(host, reg);\n\telse\n\t\treturn readl_relaxed(host->mmio + reg);\n}\n\nstruct platform_device;\n\nirqreturn_t cqhci_irq(struct mmc_host *mmc, u32 intmask, int cmd_error,\n\t\t      int data_error);\nint cqhci_init(struct cqhci_host *cq_host, struct mmc_host *mmc, bool dma64);\nstruct cqhci_host *cqhci_pltfm_init(struct platform_device *pdev);\nint cqhci_deactivate(struct mmc_host *mmc);\nstatic inline int cqhci_suspend(struct mmc_host *mmc)\n{\n\treturn cqhci_deactivate(mmc);\n}\nint cqhci_resume(struct mmc_host *mmc);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}