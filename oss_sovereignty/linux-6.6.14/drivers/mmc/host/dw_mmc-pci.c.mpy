{
  "module_name": "dw_mmc-pci.c",
  "hash_id": "d36942764d47090be8e4d58dc6ba084593d4323880f28849b7681d94585860e0",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mmc/host/dw_mmc-pci.c",
  "human_readable_source": "\n \n\n#include <linux/interrupt.h>\n#include <linux/module.h>\n#include <linux/io.h>\n#include <linux/irq.h>\n#include <linux/pci.h>\n#include <linux/pm_runtime.h>\n#include <linux/slab.h>\n#include <linux/mmc/host.h>\n#include <linux/mmc/mmc.h>\n#include \"dw_mmc.h\"\n\n#define PCI_BAR_NO 2\n#define SYNOPSYS_DW_MCI_VENDOR_ID 0x700\n#define SYNOPSYS_DW_MCI_DEVICE_ID 0x1107\n \n#define DW_MCI_CAPABILITIES (MMC_CAP_4_BIT_DATA | MMC_CAP_MMC_HIGHSPEED |\\\n\t\t\t\tMMC_CAP_SD_HIGHSPEED | MMC_CAP_8_BIT_DATA |\\\n\t\t\t\tMMC_CAP_SDIO_IRQ)\n\nstatic struct dw_mci_board pci_board_data = {\n\t.caps\t\t\t\t= DW_MCI_CAPABILITIES,\n\t.bus_hz\t\t\t\t= 33 * 1000 * 1000,\n\t.detect_delay_ms\t\t= 200,\n\t.fifo_depth\t\t\t= 32,\n};\n\nstatic int dw_mci_pci_probe(struct pci_dev *pdev,\n\t\t\t    const struct pci_device_id *entries)\n{\n\tstruct dw_mci *host;\n\tint ret;\n\n\tret = pcim_enable_device(pdev);\n\tif (ret)\n\t\treturn ret;\n\n\thost = devm_kzalloc(&pdev->dev, sizeof(struct dw_mci), GFP_KERNEL);\n\tif (!host)\n\t\treturn -ENOMEM;\n\n\thost->irq = pdev->irq;\n\thost->irq_flags = IRQF_SHARED;\n\thost->dev = &pdev->dev;\n\thost->pdata = &pci_board_data;\n\n\tret = pcim_iomap_regions(pdev, 1 << PCI_BAR_NO, pci_name(pdev));\n\tif (ret)\n\t\treturn ret;\n\n\thost->regs = pcim_iomap_table(pdev)[PCI_BAR_NO];\n\n\tpci_set_master(pdev);\n\n\tret = dw_mci_probe(host);\n\tif (ret)\n\t\treturn ret;\n\n\tpci_set_drvdata(pdev, host);\n\n\treturn 0;\n}\n\nstatic void dw_mci_pci_remove(struct pci_dev *pdev)\n{\n\tstruct dw_mci *host = pci_get_drvdata(pdev);\n\n\tdw_mci_remove(host);\n}\n\nstatic const struct dev_pm_ops dw_mci_pci_dev_pm_ops = {\n\tSET_SYSTEM_SLEEP_PM_OPS(pm_runtime_force_suspend,\n\t\t\t\tpm_runtime_force_resume)\n\tSET_RUNTIME_PM_OPS(dw_mci_runtime_suspend,\n\t\t\t   dw_mci_runtime_resume,\n\t\t\t   NULL)\n};\n\nstatic const struct pci_device_id dw_mci_pci_id[] = {\n\t{ PCI_DEVICE(SYNOPSYS_DW_MCI_VENDOR_ID, SYNOPSYS_DW_MCI_DEVICE_ID) },\n\t{}\n};\nMODULE_DEVICE_TABLE(pci, dw_mci_pci_id);\n\nstatic struct pci_driver dw_mci_pci_driver = {\n\t.name\t\t= \"dw_mmc_pci\",\n\t.id_table\t= dw_mci_pci_id,\n\t.probe\t\t= dw_mci_pci_probe,\n\t.remove\t\t= dw_mci_pci_remove,\n\t.driver\t\t=\t{\n\t\t.pm =   &dw_mci_pci_dev_pm_ops,\n\t},\n};\n\nmodule_pci_driver(dw_mci_pci_driver);\n\nMODULE_DESCRIPTION(\"DW Multimedia Card PCI Interface driver\");\nMODULE_AUTHOR(\"Shashidhar Hiremath <shashidharh@vayavyalabs.com>\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}