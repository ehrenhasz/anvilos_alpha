{
  "module_name": "sdhci-pci-dwc-mshc.c",
  "hash_id": "3ac2c6b801e9b4e400d82893b3d210bd1668a7190cc788c76e01ccef574bdc12",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mmc/host/sdhci-pci-dwc-mshc.c",
  "human_readable_source": "\n \n\n#include \"sdhci.h\"\n#include \"sdhci-pci.h\"\n\n#define SDHCI_VENDOR_PTR_R\t0xE8\n\n \n#define SDHC_GPIO_OUT\t\t0x34\n#define SDHC_AT_CTRL_R\t\t0x40\n#define SDHC_SW_TUNE_EN\t\t0x00000010\n\n \n#define SDHC_MMCM_DIV_REG\t0x1020\n#define DIV_REG_100_MHZ\t\t0x1145\n#define DIV_REG_200_MHZ\t\t0x1083\n#define SDHC_MMCM_CLKFBOUT\t0x1024\n#define CLKFBOUT_100_MHZ\t0x0000\n#define CLKFBOUT_200_MHZ\t0x0080\n#define SDHC_CCLK_MMCM_RST\t0x00000001\n\nstatic void sdhci_snps_set_clock(struct sdhci_host *host, unsigned int clock)\n{\n\tu16 clk;\n\tu32 reg, vendor_ptr;\n\n\tvendor_ptr = sdhci_readw(host, SDHCI_VENDOR_PTR_R);\n\n\t \n\treg = sdhci_readl(host, (SDHC_AT_CTRL_R + vendor_ptr));\n\treg &= ~SDHC_SW_TUNE_EN;\n\tsdhci_writel(host, reg, (SDHC_AT_CTRL_R + vendor_ptr));\n\n\tif (clock <= 52000000) {\n\t\tsdhci_set_clock(host, clock);\n\t} else {\n\t\t \n\t\treg = sdhci_readl(host, (SDHC_GPIO_OUT + vendor_ptr));\n\t\treg |= SDHC_CCLK_MMCM_RST;\n\t\tsdhci_writel(host, reg, (SDHC_GPIO_OUT + vendor_ptr));\n\n\t\t \n\t\tif (clock == 100000000) {\n\t\t\tsdhci_writel(host, DIV_REG_100_MHZ, SDHC_MMCM_DIV_REG);\n\t\t\tsdhci_writel(host, CLKFBOUT_100_MHZ,\n\t\t\t\t\tSDHC_MMCM_CLKFBOUT);\n\t\t} else {\n\t\t\tsdhci_writel(host, DIV_REG_200_MHZ, SDHC_MMCM_DIV_REG);\n\t\t\tsdhci_writel(host, CLKFBOUT_200_MHZ,\n\t\t\t\t\tSDHC_MMCM_CLKFBOUT);\n\t\t}\n\n\t\t \n\t\treg = sdhci_readl(host, (SDHC_GPIO_OUT + vendor_ptr));\n\t\treg &= ~SDHC_CCLK_MMCM_RST;\n\t\tsdhci_writel(host, reg, (SDHC_GPIO_OUT + vendor_ptr));\n\n\t\t \n\t\tclk = SDHCI_PROG_CLOCK_MODE | SDHCI_CLOCK_INT_EN |\n\t\t\tSDHCI_CLOCK_CARD_EN;\n\t\tsdhci_writew(host, clk, SDHCI_CLOCK_CONTROL);\n\t}\n}\n\nstatic const struct sdhci_ops sdhci_snps_ops = {\n\t.set_clock\t= sdhci_snps_set_clock,\n\t.enable_dma\t= sdhci_pci_enable_dma,\n\t.set_bus_width\t= sdhci_set_bus_width,\n\t.reset\t\t= sdhci_reset,\n\t.set_uhs_signaling = sdhci_set_uhs_signaling,\n};\n\nconst struct sdhci_pci_fixes sdhci_snps = {\n\t.ops\t\t= &sdhci_snps_ops,\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}