{
  "module_name": "mmci.h",
  "hash_id": "bc616db8487a97c5f505c0cd19d09bf0af059c7ad4e45b3d197258648c64ecdc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mmc/host/mmci.h",
  "human_readable_source": " \n \n#define MMCIPOWER\t\t0x000\n#define MCI_PWR_OFF\t\t0x00\n#define MCI_PWR_UP\t\t0x02\n#define MCI_PWR_ON\t\t0x03\n#define MCI_OD\t\t\t(1 << 6)\n#define MCI_ROD\t\t\t(1 << 7)\n \n#define MCI_ST_DATA2DIREN\t(1 << 2)\n#define MCI_ST_CMDDIREN\t\t(1 << 3)\n#define MCI_ST_DATA0DIREN\t(1 << 4)\n#define MCI_ST_DATA31DIREN\t(1 << 5)\n#define MCI_ST_FBCLKEN\t\t(1 << 7)\n#define MCI_ST_DATA74DIREN\t(1 << 8)\n \n#define MCI_STM32_PWR_CYC\t0x02\n#define MCI_STM32_VSWITCH\tBIT(2)\n#define MCI_STM32_VSWITCHEN\tBIT(3)\n#define MCI_STM32_DIRPOL\tBIT(4)\n\n#define MMCICLOCK\t\t0x004\n#define MCI_CLK_ENABLE\t\t(1 << 8)\n#define MCI_CLK_PWRSAVE\t\t(1 << 9)\n#define MCI_CLK_BYPASS\t\t(1 << 10)\n#define MCI_4BIT_BUS\t\t(1 << 11)\n \n#define MCI_ST_8BIT_BUS\t\t(1 << 12)\n#define MCI_ST_U300_HWFCEN\t(1 << 13)\n#define MCI_ST_UX500_NEG_EDGE\t(1 << 13)\n#define MCI_ST_UX500_HWFCEN\t(1 << 14)\n#define MCI_ST_UX500_CLK_INV\t(1 << 15)\n \n#define MCI_ARM_HWFCEN\t\t(1 << 12)\n\n \n#define MCI_QCOM_CLK_WIDEBUS_8\t(BIT(10) | BIT(11))\n#define MCI_QCOM_CLK_FLOWENA\tBIT(12)\n#define MCI_QCOM_CLK_INVERTOUT\tBIT(13)\n\n \n#define MCI_QCOM_CLK_SELECT_IN_FBCLK\tBIT(15)\n#define MCI_QCOM_CLK_SELECT_IN_DDR_MODE\t(BIT(14) | BIT(15))\n\n \n#define MCI_STM32_CLK_CLKDIV_MSK\tGENMASK(9, 0)\n#define MCI_STM32_CLK_WIDEBUS_4\t\tBIT(14)\n#define MCI_STM32_CLK_WIDEBUS_8\t\tBIT(15)\n#define MCI_STM32_CLK_NEGEDGE\t\tBIT(16)\n#define MCI_STM32_CLK_HWFCEN\t\tBIT(17)\n#define MCI_STM32_CLK_DDR\t\tBIT(18)\n#define MCI_STM32_CLK_BUSSPEED\t\tBIT(19)\n#define MCI_STM32_CLK_SEL_MSK\t\tGENMASK(21, 20)\n#define MCI_STM32_CLK_SELCK\t\t(0 << 20)\n#define MCI_STM32_CLK_SELCKIN\t\t(1 << 20)\n#define MCI_STM32_CLK_SELFBCK\t\t(2 << 20)\n\n#define MMCIARGUMENT\t\t0x008\n\n \n#define MMCICOMMAND\t\t0x00c\n#define MCI_CPSM_RESPONSE\tBIT(6)\n#define MCI_CPSM_LONGRSP\tBIT(7)\n#define MCI_CPSM_INTERRUPT\tBIT(8)\n#define MCI_CPSM_PENDING\tBIT(9)\n#define MCI_CPSM_ENABLE\t\tBIT(10)\n \n#define MCI_CPSM_ST_SDIO_SUSP\t\tBIT(11)\n#define MCI_CPSM_ST_ENCMD_COMPL\t\tBIT(12)\n#define MCI_CPSM_ST_NIEN\t\tBIT(13)\n#define MCI_CPSM_ST_CE_ATACMD\t\tBIT(14)\n \n#define MCI_CPSM_QCOM_PROGENA\t\tBIT(11)\n#define MCI_CPSM_QCOM_DATCMD\t\tBIT(12)\n#define MCI_CPSM_QCOM_MCIABORT\t\tBIT(13)\n#define MCI_CPSM_QCOM_CCSENABLE\t\tBIT(14)\n#define MCI_CPSM_QCOM_CCSDISABLE\tBIT(15)\n#define MCI_CPSM_QCOM_AUTO_CMD19\tBIT(16)\n#define MCI_CPSM_QCOM_AUTO_CMD21\tBIT(21)\n \n#define MCI_CPSM_STM32_CMDTRANS\t\tBIT(6)\n#define MCI_CPSM_STM32_CMDSTOP\t\tBIT(7)\n#define MCI_CPSM_STM32_WAITRESP_MASK\tGENMASK(9, 8)\n#define MCI_CPSM_STM32_NORSP\t\t(0 << 8)\n#define MCI_CPSM_STM32_SRSP_CRC\t\t(1 << 8)\n#define MCI_CPSM_STM32_SRSP\t\t(2 << 8)\n#define MCI_CPSM_STM32_LRSP_CRC\t\t(3 << 8)\n#define MCI_CPSM_STM32_ENABLE\t\tBIT(12)\n\n#define MMCIRESPCMD\t\t0x010\n#define MMCIRESPONSE0\t\t0x014\n#define MMCIRESPONSE1\t\t0x018\n#define MMCIRESPONSE2\t\t0x01c\n#define MMCIRESPONSE3\t\t0x020\n#define MMCIDATATIMER\t\t0x024\n#define MMCIDATALENGTH\t\t0x028\n\n \n#define MMCIDATACTRL\t\t0x02c\n#define MCI_DPSM_ENABLE\t\tBIT(0)\n#define MCI_DPSM_DIRECTION\tBIT(1)\n#define MCI_DPSM_MODE\t\tBIT(2)\n#define MCI_DPSM_DMAENABLE\tBIT(3)\n#define MCI_DPSM_BLOCKSIZE\tBIT(4)\n \n#define MCI_DPSM_ST_RWSTART\tBIT(8)\n#define MCI_DPSM_ST_RWSTOP\tBIT(9)\n#define MCI_DPSM_ST_RWMOD\tBIT(10)\n#define MCI_DPSM_ST_SDIOEN\tBIT(11)\n \n#define MCI_DPSM_ST_DMAREQCTL\tBIT(12)\n#define MCI_DPSM_ST_DBOOTMODEEN\tBIT(13)\n#define MCI_DPSM_ST_BUSYMODE\tBIT(14)\n#define MCI_DPSM_ST_DDRMODE\tBIT(15)\n \n#define MCI_DPSM_QCOM_DATA_PEND\tBIT(17)\n#define MCI_DPSM_QCOM_RX_DATA_PEND BIT(20)\n \n#define MCI_DPSM_STM32_MODE_BLOCK\t(0 << 2)\n#define MCI_DPSM_STM32_MODE_SDIO\t(1 << 2)\n#define MCI_DPSM_STM32_MODE_STREAM\t(2 << 2)\n#define MCI_DPSM_STM32_MODE_BLOCK_STOP\t(3 << 2)\n\n#define MMCIDATACNT\t\t0x030\n#define MMCISTATUS\t\t0x034\n#define MCI_CMDCRCFAIL\t\t(1 << 0)\n#define MCI_DATACRCFAIL\t\t(1 << 1)\n#define MCI_CMDTIMEOUT\t\t(1 << 2)\n#define MCI_DATATIMEOUT\t\t(1 << 3)\n#define MCI_TXUNDERRUN\t\t(1 << 4)\n#define MCI_RXOVERRUN\t\t(1 << 5)\n#define MCI_CMDRESPEND\t\t(1 << 6)\n#define MCI_CMDSENT\t\t(1 << 7)\n#define MCI_DATAEND\t\t(1 << 8)\n#define MCI_STARTBITERR\t\t(1 << 9)\n#define MCI_DATABLOCKEND\t(1 << 10)\n#define MCI_CMDACTIVE\t\t(1 << 11)\n#define MCI_TXACTIVE\t\t(1 << 12)\n#define MCI_RXACTIVE\t\t(1 << 13)\n#define MCI_TXFIFOHALFEMPTY\t(1 << 14)\n#define MCI_RXFIFOHALFFULL\t(1 << 15)\n#define MCI_TXFIFOFULL\t\t(1 << 16)\n#define MCI_RXFIFOFULL\t\t(1 << 17)\n#define MCI_TXFIFOEMPTY\t\t(1 << 18)\n#define MCI_RXFIFOEMPTY\t\t(1 << 19)\n#define MCI_TXDATAAVLBL\t\t(1 << 20)\n#define MCI_RXDATAAVLBL\t\t(1 << 21)\n \n#define MCI_ST_SDIOIT\t\t(1 << 22)\n#define MCI_ST_CEATAEND\t\t(1 << 23)\n#define MCI_ST_CARDBUSY\t\t(1 << 24)\n \n#define MCI_STM32_BUSYD0\tBIT(20)\n#define MCI_STM32_BUSYD0END\tBIT(21)\n#define MCI_STM32_VSWEND\tBIT(25)\n\n#define MMCICLEAR\t\t0x038\n#define MCI_CMDCRCFAILCLR\t(1 << 0)\n#define MCI_DATACRCFAILCLR\t(1 << 1)\n#define MCI_CMDTIMEOUTCLR\t(1 << 2)\n#define MCI_DATATIMEOUTCLR\t(1 << 3)\n#define MCI_TXUNDERRUNCLR\t(1 << 4)\n#define MCI_RXOVERRUNCLR\t(1 << 5)\n#define MCI_CMDRESPENDCLR\t(1 << 6)\n#define MCI_CMDSENTCLR\t\t(1 << 7)\n#define MCI_DATAENDCLR\t\t(1 << 8)\n#define MCI_STARTBITERRCLR\t(1 << 9)\n#define MCI_DATABLOCKENDCLR\t(1 << 10)\n \n#define MCI_ST_SDIOITC\t\t(1 << 22)\n#define MCI_ST_CEATAENDC\t(1 << 23)\n#define MCI_ST_BUSYENDC\t\t(1 << 24)\n \n#define MCI_STM32_VSWENDC\tBIT(25)\n#define MCI_STM32_CKSTOPC\tBIT(26)\n\n#define MMCIMASK0\t\t0x03c\n#define MCI_CMDCRCFAILMASK\t(1 << 0)\n#define MCI_DATACRCFAILMASK\t(1 << 1)\n#define MCI_CMDTIMEOUTMASK\t(1 << 2)\n#define MCI_DATATIMEOUTMASK\t(1 << 3)\n#define MCI_TXUNDERRUNMASK\t(1 << 4)\n#define MCI_RXOVERRUNMASK\t(1 << 5)\n#define MCI_CMDRESPENDMASK\t(1 << 6)\n#define MCI_CMDSENTMASK\t\t(1 << 7)\n#define MCI_DATAENDMASK\t\t(1 << 8)\n#define MCI_STARTBITERRMASK\t(1 << 9)\n#define MCI_DATABLOCKENDMASK\t(1 << 10)\n#define MCI_CMDACTIVEMASK\t(1 << 11)\n#define MCI_TXACTIVEMASK\t(1 << 12)\n#define MCI_RXACTIVEMASK\t(1 << 13)\n#define MCI_TXFIFOHALFEMPTYMASK\t(1 << 14)\n#define MCI_RXFIFOHALFFULLMASK\t(1 << 15)\n#define MCI_TXFIFOFULLMASK\t(1 << 16)\n#define MCI_RXFIFOFULLMASK\t(1 << 17)\n#define MCI_TXFIFOEMPTYMASK\t(1 << 18)\n#define MCI_RXFIFOEMPTYMASK\t(1 << 19)\n#define MCI_TXDATAAVLBLMASK\t(1 << 20)\n#define MCI_RXDATAAVLBLMASK\t(1 << 21)\n \n#define MCI_ST_SDIOITMASK\t(1 << 22)\n#define MCI_ST_CEATAENDMASK\t(1 << 23)\n#define MCI_ST_BUSYENDMASK\t(1 << 24)\n \n#define MCI_STM32_BUSYD0ENDMASK\tBIT(21)\n\n#define MMCIMASK1\t\t0x040\n\n \n#define MMCI_STM32_FIFOTHRR\t0x044\n#define MMCI_STM32_THR_MASK\tGENMASK(3, 0)\n\n#define MMCIFIFOCNT\t\t0x048\n#define MMCIFIFO\t\t0x080  \n\n \n#define MMCI_STM32_IDMACTRLR\t0x050\n#define MMCI_STM32_IDMAEN\tBIT(0)\n#define MMCI_STM32_IDMALLIEN\tBIT(1)\n\n#define MMCI_STM32_IDMABSIZER\t\t0x054\n\n#define MMCI_STM32_IDMABASE0R\t0x058\n\n#define MMCI_STM32_IDMALAR\t0x64\n#define MMCI_STM32_IDMALA_MASK\tGENMASK(13, 0)\n#define MMCI_STM32_ABR\t\tBIT(29)\n#define MMCI_STM32_ULS\t\tBIT(30)\n#define MMCI_STM32_ULA\t\tBIT(31)\n\n#define MMCI_STM32_IDMABAR\t0x68\n\n#define MCI_IRQENABLE\t\\\n\t(MCI_CMDCRCFAILMASK | MCI_DATACRCFAILMASK | MCI_CMDTIMEOUTMASK | \\\n\tMCI_DATATIMEOUTMASK | MCI_TXUNDERRUNMASK | MCI_RXOVERRUNMASK |\t\\\n\tMCI_CMDRESPENDMASK | MCI_CMDSENTMASK)\n\n \n#define MCI_IRQ_PIO_MASK \\\n\t(MCI_RXFIFOHALFFULLMASK | MCI_RXDATAAVLBLMASK | \\\n\t MCI_TXFIFOHALFEMPTYMASK)\n\n#define MCI_IRQ_PIO_STM32_MASK \\\n\t(MCI_RXFIFOHALFFULLMASK | MCI_TXFIFOHALFEMPTYMASK)\n\n#define NR_SG\t\t128\n\n#define MMCI_PINCTRL_STATE_OPENDRAIN \"opendrain\"\n\nstruct clk;\nstruct dma_chan;\nstruct mmci_host;\n\n \nenum mmci_busy_state {\n\tMMCI_BUSY_WAITING_FOR_START_IRQ,\n\tMMCI_BUSY_WAITING_FOR_END_IRQ,\n\tMMCI_BUSY_DONE,\n};\n\n \nstruct variant_data {\n\tunsigned int\t\tclkreg;\n\tunsigned int\t\tclkreg_enable;\n\tunsigned int\t\tclkreg_8bit_bus_enable;\n\tunsigned int\t\tclkreg_neg_edge_enable;\n\tunsigned int\t\tcmdreg_cpsm_enable;\n\tunsigned int\t\tcmdreg_lrsp_crc;\n\tunsigned int\t\tcmdreg_srsp_crc;\n\tunsigned int\t\tcmdreg_srsp;\n\tunsigned int\t\tcmdreg_stop;\n\tunsigned int\t\tdatalength_bits;\n\tunsigned int\t\tfifosize;\n\tunsigned int\t\tfifohalfsize;\n\tunsigned int\t\tdata_cmd_enable;\n\tunsigned int\t\tdatactrl_mask_ddrmode;\n\tunsigned int\t\tdatactrl_mask_sdio;\n\tunsigned int\t\tdatactrl_blocksz;\n\tu8\t\t\tdatactrl_any_blocksz:1;\n\tu8\t\t\tdma_power_of_2:1;\n\tu8\t\t\tdatactrl_first:1;\n\tu8\t\t\tdatacnt_useless:1;\n\tu8\t\t\tst_sdio:1;\n\tu8\t\t\tst_clkdiv:1;\n\tu8\t\t\tstm32_clkdiv:1;\n\tu32\t\t\tpwrreg_powerup;\n\tu32\t\t\tf_max;\n\tu8\t\t\tsignal_direction:1;\n\tu8\t\t\tpwrreg_clkgate:1;\n\tu8\t\t\tbusy_detect:1;\n\tu8\t\t\tbusy_timeout:1;\n\tu32\t\t\tbusy_dpsm_flag;\n\tu32\t\t\tbusy_detect_flag;\n\tu32\t\t\tbusy_detect_mask;\n\tu8\t\t\tpwrreg_nopower:1;\n\tu8\t\t\texplicit_mclk_control:1;\n\tu8\t\t\tqcom_fifo:1;\n\tu8\t\t\tqcom_dml:1;\n\tu8\t\t\treversed_irq_handling:1;\n\tu8\t\t\tmmcimask1:1;\n\tunsigned int\t\tirq_pio_mask;\n\tu32\t\t\tstart_err;\n\tu32\t\t\topendrain;\n\tu8\t\t\tdma_lli:1;\n\tu32\t\t\tstm32_idmabsize_mask;\n\tu32\t\t\tstm32_idmabsize_align;\n\tvoid (*init)(struct mmci_host *host);\n};\n\n \nstruct mmci_host_ops {\n\tint (*validate_data)(struct mmci_host *host, struct mmc_data *data);\n\tint (*prep_data)(struct mmci_host *host, struct mmc_data *data,\n\t\t\t bool next);\n\tvoid (*unprep_data)(struct mmci_host *host, struct mmc_data *data,\n\t\t\t    int err);\n\tu32 (*get_datactrl_cfg)(struct mmci_host *host);\n\tvoid (*get_next_data)(struct mmci_host *host, struct mmc_data *data);\n\tint (*dma_setup)(struct mmci_host *host);\n\tvoid (*dma_release)(struct mmci_host *host);\n\tint (*dma_start)(struct mmci_host *host, unsigned int *datactrl);\n\tvoid (*dma_finalize)(struct mmci_host *host, struct mmc_data *data);\n\tvoid (*dma_error)(struct mmci_host *host);\n\tvoid (*set_clkreg)(struct mmci_host *host, unsigned int desired);\n\tvoid (*set_pwrreg)(struct mmci_host *host, unsigned int pwr);\n\tbool (*busy_complete)(struct mmci_host *host, struct mmc_command *cmd, u32 status, u32 err_msk);\n\tvoid (*pre_sig_volt_switch)(struct mmci_host *host);\n\tint (*post_sig_volt_switch)(struct mmci_host *host, struct mmc_ios *ios);\n};\n\nstruct mmci_host {\n\tphys_addr_t\t\tphybase;\n\tvoid __iomem\t\t*base;\n\tstruct mmc_request\t*mrq;\n\tstruct mmc_command\t*cmd;\n\tstruct mmc_command\tstop_abort;\n\tstruct mmc_data\t\t*data;\n\tstruct mmc_host\t\t*mmc;\n\tstruct clk\t\t*clk;\n\tu8\t\t\tsingleirq:1;\n\n\tstruct reset_control\t*rst;\n\n\tspinlock_t\t\tlock;\n\n\tunsigned int\t\tmclk;\n\t \n\tunsigned int\t\tclock_cache;\n\tunsigned int\t\tcclk;\n\tu32\t\t\tpwr_reg;\n\tu32\t\t\tpwr_reg_add;\n\tu32\t\t\tclk_reg;\n\tu32\t\t\tclk_reg_add;\n\tu32\t\t\tdatactrl_reg;\n\tenum mmci_busy_state\tbusy_state;\n\tu32\t\t\tbusy_status;\n\tu32\t\t\tmask1_reg;\n\tu8\t\t\tvqmmc_enabled:1;\n\tstruct mmci_platform_data *plat;\n\tstruct mmc_host_ops\t*mmc_ops;\n\tstruct mmci_host_ops\t*ops;\n\tstruct variant_data\t*variant;\n\tvoid\t\t\t*variant_priv;\n\tstruct pinctrl\t\t*pinctrl;\n\tstruct pinctrl_state\t*pins_opendrain;\n\n\tu8\t\t\thw_designer;\n\tu8\t\t\thw_revision:4;\n\n\tstruct timer_list\ttimer;\n\tunsigned int\t\toldstat;\n\tu32\t\t\tirq_action;\n\n\t \n\tstruct sg_mapping_iter\tsg_miter;\n\tunsigned int\t\tsize;\n\tint (*get_rx_fifocnt)(struct mmci_host *h, u32 status, int remain);\n\n\tu8\t\t\tuse_dma:1;\n\tu8\t\t\tdma_in_progress:1;\n\tvoid\t\t\t*dma_priv;\n\n\ts32\t\t\tnext_cookie;\n\tstruct delayed_work\tux500_busy_timeout_work;\n};\n\n#define dma_inprogress(host)\t((host)->dma_in_progress)\n\nvoid mmci_write_clkreg(struct mmci_host *host, u32 clk);\nvoid mmci_write_pwrreg(struct mmci_host *host, u32 pwr);\n\nstatic inline u32 mmci_dctrl_blksz(struct mmci_host *host)\n{\n\treturn (ffs(host->data->blksz) - 1) << 4;\n}\n\n#ifdef CONFIG_DMA_ENGINE\nint mmci_dmae_prep_data(struct mmci_host *host, struct mmc_data *data,\n\t\t\tbool next);\nvoid mmci_dmae_unprep_data(struct mmci_host *host, struct mmc_data *data,\n\t\t\t   int err);\nvoid mmci_dmae_get_next_data(struct mmci_host *host, struct mmc_data *data);\nint mmci_dmae_setup(struct mmci_host *host);\nvoid mmci_dmae_release(struct mmci_host *host);\nint mmci_dmae_start(struct mmci_host *host, unsigned int *datactrl);\nvoid mmci_dmae_finalize(struct mmci_host *host, struct mmc_data *data);\nvoid mmci_dmae_error(struct mmci_host *host);\n#endif\n\n#ifdef CONFIG_MMC_QCOM_DML\nvoid qcom_variant_init(struct mmci_host *host);\n#else\nstatic inline void qcom_variant_init(struct mmci_host *host) {}\n#endif\n\n#ifdef CONFIG_MMC_STM32_SDMMC\nvoid sdmmc_variant_init(struct mmci_host *host);\n#else\nstatic inline void sdmmc_variant_init(struct mmci_host *host) {}\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}