{
  "module_name": "tmio_mmc.h",
  "hash_id": "5c55d9604fab59d3e1652441e3be7355efecb289296ddcbacec660d56ceffa52",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mmc/host/tmio_mmc.h",
  "human_readable_source": " \n \n\n#ifndef TMIO_MMC_H\n#define TMIO_MMC_H\n\n#include <linux/dmaengine.h>\n#include <linux/highmem.h>\n#include <linux/mutex.h>\n#include <linux/pagemap.h>\n#include <linux/scatterlist.h>\n#include <linux/spinlock.h>\n#include <linux/interrupt.h>\n\n#define CTL_SD_CMD 0x00\n#define CTL_ARG_REG 0x04\n#define CTL_STOP_INTERNAL_ACTION 0x08\n#define CTL_XFER_BLK_COUNT 0xa\n#define CTL_RESPONSE 0x0c\n \n#define CTL_STATUS 0x1c\n \n#define CTL_IRQ_MASK 0x20\n#define CTL_SD_CARD_CLK_CTL 0x24\n#define CTL_SD_XFER_LEN 0x26\n#define CTL_SD_MEM_CARD_OPT 0x28\n#define CTL_SD_ERROR_DETAIL_STATUS 0x2c\n#define CTL_SD_DATA_PORT 0x30\n#define CTL_TRANSACTION_CTL 0x34\n#define CTL_SDIO_STATUS 0x36\n#define CTL_SDIO_IRQ_MASK 0x38\n#define CTL_DMA_ENABLE 0xd8\n#define CTL_RESET_SD 0xe0\n#define CTL_VERSION 0xe2\n#define CTL_SDIF_MODE 0xe6  \n\n \n#define TMIO_STOP_STP\t\tBIT(0)\n#define TMIO_STOP_SEC\t\tBIT(8)\n\n \n#define TMIO_STAT_CMDRESPEND    BIT(0)\n#define TMIO_STAT_DATAEND       BIT(2)\n#define TMIO_STAT_CARD_REMOVE   BIT(3)\n#define TMIO_STAT_CARD_INSERT   BIT(4)\n#define TMIO_STAT_SIGSTATE      BIT(5)\n#define TMIO_STAT_WRPROTECT     BIT(7)\n#define TMIO_STAT_CARD_REMOVE_A BIT(8)\n#define TMIO_STAT_CARD_INSERT_A BIT(9)\n#define TMIO_STAT_SIGSTATE_A    BIT(10)\n\n \n#define TMIO_STAT_CMD_IDX_ERR   BIT(16)\n#define TMIO_STAT_CRCFAIL       BIT(17)\n#define TMIO_STAT_STOPBIT_ERR   BIT(18)\n#define TMIO_STAT_DATATIMEOUT   BIT(19)\n#define TMIO_STAT_RXOVERFLOW    BIT(20)\n#define TMIO_STAT_TXUNDERRUN    BIT(21)\n#define TMIO_STAT_CMDTIMEOUT    BIT(22)\n#define TMIO_STAT_DAT0\t\tBIT(23)\t \n#define TMIO_STAT_RXRDY         BIT(24)\n#define TMIO_STAT_TXRQ          BIT(25)\n#define TMIO_STAT_ALWAYS_SET_27\tBIT(27)  \n#define TMIO_STAT_ILL_FUNC      BIT(29)  \n#define TMIO_STAT_SCLKDIVEN     BIT(29)  \n#define TMIO_STAT_CMD_BUSY      BIT(30)\n#define TMIO_STAT_ILL_ACCESS    BIT(31)\n\n \n#define\tCLK_CTL_DIV_MASK\t0xff\n#define\tCLK_CTL_SCLKEN\t\tBIT(8)\n\n \n#define CARD_OPT_TOP_MASK\t0xf0\n#define CARD_OPT_TOP_SHIFT\t4\n#define CARD_OPT_EXTOP\t\tBIT(9)  \n#define CARD_OPT_WIDTH8\t\tBIT(13)\n#define CARD_OPT_ALWAYS1\tBIT(14)\n#define CARD_OPT_WIDTH\t\tBIT(15)\n\n \n#define TMIO_SDIO_STAT_IOIRQ\t0x0001\n#define TMIO_SDIO_STAT_EXPUB52\t0x4000\n#define TMIO_SDIO_STAT_EXWT\t0x8000\n#define TMIO_SDIO_MASK_ALL\t0xc007\n\n#define TMIO_SDIO_SETBITS_MASK\t0x0006\n\n \n#define DMA_ENABLE_DMASDRW\tBIT(1)\n\n \n#define SDIF_MODE_HS400\t\tBIT(0)  \n\n \n \n#define TMIO_MASK_ALL           0x837f031d\n#define TMIO_MASK_ALL_RCAR2\t0x8b7f031d\n#define TMIO_MASK_READOP  (TMIO_STAT_RXRDY | TMIO_STAT_DATAEND)\n#define TMIO_MASK_WRITEOP (TMIO_STAT_TXRQ | TMIO_STAT_DATAEND)\n#define TMIO_MASK_CMD     (TMIO_STAT_CMDRESPEND | TMIO_STAT_CMDTIMEOUT | \\\n\t\tTMIO_STAT_CARD_REMOVE | TMIO_STAT_CARD_INSERT)\n#define TMIO_MASK_IRQ     (TMIO_MASK_READOP | TMIO_MASK_WRITEOP | TMIO_MASK_CMD)\n\n#define TMIO_MAX_BLK_SIZE 512\n\nstruct tmio_mmc_data;\nstruct tmio_mmc_host;\n\nstruct tmio_mmc_dma_ops {\n\tvoid (*start)(struct tmio_mmc_host *host, struct mmc_data *data);\n\tvoid (*enable)(struct tmio_mmc_host *host, bool enable);\n\tvoid (*request)(struct tmio_mmc_host *host,\n\t\t\tstruct tmio_mmc_data *pdata);\n\tvoid (*release)(struct tmio_mmc_host *host);\n\tvoid (*abort)(struct tmio_mmc_host *host);\n\tvoid (*dataend)(struct tmio_mmc_host *host);\n\n\t \n\tvoid (*end)(struct tmio_mmc_host *host);\t \n\tbool (*dma_irq)(struct tmio_mmc_host *host);\n};\n\nstruct tmio_mmc_host {\n\tvoid __iomem *ctl;\n\tstruct mmc_command      *cmd;\n\tstruct mmc_request      *mrq;\n\tstruct mmc_data         *data;\n\tstruct mmc_host         *mmc;\n\tstruct mmc_host_ops     ops;\n\n\t \n\tvoid (*set_pwr)(struct platform_device *host, int state);\n\n\t \n\tstruct scatterlist      *sg_ptr;\n\tstruct scatterlist      *sg_orig;\n\tunsigned int            sg_len;\n\tunsigned int            sg_off;\n\tunsigned int\t\tbus_shift;\n\n\tstruct platform_device *pdev;\n\tstruct tmio_mmc_data *pdata;\n\n\t \n\tbool\t\t\tdma_on;\n\tstruct dma_chan\t\t*chan_rx;\n\tstruct dma_chan\t\t*chan_tx;\n\tstruct tasklet_struct\tdma_issue;\n\tstruct scatterlist\tbounce_sg;\n\tu8\t\t\t*bounce_buf;\n\n\t \n\tstruct delayed_work\tdelayed_reset_work;\n\tstruct work_struct\tdone;\n\n\t \n\tu32\t\t\tsdcard_irq_mask;\n\tu32\t\t\tsdio_irq_mask;\n\tunsigned int\t\tclk_cache;\n\tu32\t\t\tsdcard_irq_setbit_mask;\n\tu32\t\t\tsdcard_irq_mask_all;\n\n\tspinlock_t\t\tlock;\t\t \n\tunsigned long\t\tlast_req_ts;\n\tstruct mutex\t\tios_lock;\t \n\tbool\t\t\tnative_hotplug;\n\tbool\t\t\tsdio_irq_enabled;\n\n\t \n\tint (*clk_enable)(struct tmio_mmc_host *host);\n\tvoid (*set_clock)(struct tmio_mmc_host *host, unsigned int clock);\n\n\t \n\tvoid (*clk_disable)(struct tmio_mmc_host *host);\n\tint (*multi_io_quirk)(struct mmc_card *card,\n\t\t\t      unsigned int direction, int blk_size);\n\tint (*write16_hook)(struct tmio_mmc_host *host, int addr);\n\tvoid (*reset)(struct tmio_mmc_host *host, bool preserve);\n\tbool (*check_retune)(struct tmio_mmc_host *host, struct mmc_request *mrq);\n\tvoid (*fixup_request)(struct tmio_mmc_host *host, struct mmc_request *mrq);\n\tunsigned int (*get_timeout_cycles)(struct tmio_mmc_host *host);\n\n\tconst struct tmio_mmc_dma_ops *dma_ops;\n};\n\nstruct tmio_mmc_host *tmio_mmc_host_alloc(struct platform_device *pdev,\n\t\t\t\t\t  struct tmio_mmc_data *pdata);\nvoid tmio_mmc_host_free(struct tmio_mmc_host *host);\nint tmio_mmc_host_probe(struct tmio_mmc_host *host);\nvoid tmio_mmc_host_remove(struct tmio_mmc_host *host);\nvoid tmio_mmc_do_data_irq(struct tmio_mmc_host *host);\n\nvoid tmio_mmc_enable_mmc_irqs(struct tmio_mmc_host *host, u32 i);\nvoid tmio_mmc_disable_mmc_irqs(struct tmio_mmc_host *host, u32 i);\nirqreturn_t tmio_mmc_irq(int irq, void *devid);\n\n#ifdef CONFIG_PM\nint tmio_mmc_host_runtime_suspend(struct device *dev);\nint tmio_mmc_host_runtime_resume(struct device *dev);\n#endif\n\nstatic inline u16 sd_ctrl_read16(struct tmio_mmc_host *host, int addr)\n{\n\treturn ioread16(host->ctl + (addr << host->bus_shift));\n}\n\nstatic inline void sd_ctrl_read16_rep(struct tmio_mmc_host *host, int addr,\n\t\t\t\t      u16 *buf, int count)\n{\n\tioread16_rep(host->ctl + (addr << host->bus_shift), buf, count);\n}\n\nstatic inline u32 sd_ctrl_read16_and_16_as_32(struct tmio_mmc_host *host,\n\t\t\t\t\t      int addr)\n{\n\treturn ioread16(host->ctl + (addr << host->bus_shift)) |\n\t       ioread16(host->ctl + ((addr + 2) << host->bus_shift)) << 16;\n}\n\nstatic inline void sd_ctrl_read32_rep(struct tmio_mmc_host *host, int addr,\n\t\t\t\t      u32 *buf, int count)\n{\n\tioread32_rep(host->ctl + (addr << host->bus_shift), buf, count);\n}\n\nstatic inline void sd_ctrl_write16(struct tmio_mmc_host *host, int addr,\n\t\t\t\t   u16 val)\n{\n\t \n\tif (host->write16_hook && host->write16_hook(host, addr))\n\t\treturn;\n\tiowrite16(val, host->ctl + (addr << host->bus_shift));\n}\n\nstatic inline void sd_ctrl_write16_rep(struct tmio_mmc_host *host, int addr,\n\t\t\t\t       u16 *buf, int count)\n{\n\tiowrite16_rep(host->ctl + (addr << host->bus_shift), buf, count);\n}\n\nstatic inline void sd_ctrl_write32_as_16_and_16(struct tmio_mmc_host *host,\n\t\t\t\t\t\tint addr, u32 val)\n{\n\tif (addr == CTL_IRQ_MASK || addr == CTL_STATUS)\n\t\tval |= host->sdcard_irq_setbit_mask;\n\n\tiowrite16(val & 0xffff, host->ctl + (addr << host->bus_shift));\n\tiowrite16(val >> 16, host->ctl + ((addr + 2) << host->bus_shift));\n}\n\nstatic inline void sd_ctrl_write32(struct tmio_mmc_host *host, int addr, u32 val)\n{\n\tiowrite32(val, host->ctl + (addr << host->bus_shift));\n}\n\nstatic inline void sd_ctrl_write32_rep(struct tmio_mmc_host *host, int addr,\n\t\t\t\t       const u32 *buf, int count)\n{\n\tiowrite32_rep(host->ctl + (addr << host->bus_shift), buf, count);\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}