{
  "module_name": "dw_mmc-bluefield.c",
  "hash_id": "37a8500310956cbbadfa8c318659e6088d0a686ac3f6cc0b49a693b6951a1b32",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mmc/host/dw_mmc-bluefield.c",
  "human_readable_source": "\n \n\n#include <linux/bitfield.h>\n#include <linux/bitops.h>\n#include <linux/mmc/host.h>\n#include <linux/mmc/mmc.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm_runtime.h>\n\n#include \"dw_mmc.h\"\n#include \"dw_mmc-pltfm.h\"\n\n#define UHS_REG_EXT_SAMPLE_MASK\t\tGENMASK(22, 16)\n#define UHS_REG_EXT_DRIVE_MASK\t\tGENMASK(29, 23)\n#define BLUEFIELD_UHS_REG_EXT_SAMPLE\t2\n#define BLUEFIELD_UHS_REG_EXT_DRIVE\t4\n\nstatic void dw_mci_bluefield_set_ios(struct dw_mci *host, struct mmc_ios *ios)\n{\n\tu32 reg;\n\n\t \n\treg = mci_readl(host, UHS_REG_EXT);\n\treg &= ~UHS_REG_EXT_SAMPLE_MASK;\n\treg |= FIELD_PREP(UHS_REG_EXT_SAMPLE_MASK,\n\t\t\t  BLUEFIELD_UHS_REG_EXT_SAMPLE);\n\treg &= ~UHS_REG_EXT_DRIVE_MASK;\n\treg |= FIELD_PREP(UHS_REG_EXT_DRIVE_MASK, BLUEFIELD_UHS_REG_EXT_DRIVE);\n\tmci_writel(host, UHS_REG_EXT, reg);\n}\n\nstatic const struct dw_mci_drv_data bluefield_drv_data = {\n\t.set_ios\t\t= dw_mci_bluefield_set_ios\n};\n\nstatic const struct of_device_id dw_mci_bluefield_match[] = {\n\t{ .compatible = \"mellanox,bluefield-dw-mshc\",\n\t  .data = &bluefield_drv_data },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, dw_mci_bluefield_match);\n\nstatic int dw_mci_bluefield_probe(struct platform_device *pdev)\n{\n\treturn dw_mci_pltfm_register(pdev, &bluefield_drv_data);\n}\n\nstatic struct platform_driver dw_mci_bluefield_pltfm_driver = {\n\t.probe\t\t= dw_mci_bluefield_probe,\n\t.remove_new\t= dw_mci_pltfm_remove,\n\t.driver\t\t= {\n\t\t.name\t\t= \"dwmmc_bluefield\",\n\t\t.probe_type\t= PROBE_PREFER_ASYNCHRONOUS,\n\t\t.of_match_table\t= dw_mci_bluefield_match,\n\t\t.pm\t\t= &dw_mci_pltfm_pmops,\n\t},\n};\n\nmodule_platform_driver(dw_mci_bluefield_pltfm_driver);\n\nMODULE_DESCRIPTION(\"BlueField DW Multimedia Card driver\");\nMODULE_AUTHOR(\"Mellanox Technologies\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}