{
  "module_name": "dw_mmc.h",
  "hash_id": "5016dc56d3591a6cd07aa14a53738604d7d0c4f0aa9f2bdacdf5dc0ece29cd8f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/mmc/host/dw_mmc.h",
  "human_readable_source": " \n \n\n#ifndef _DW_MMC_H_\n#define _DW_MMC_H_\n\n#include <linux/scatterlist.h>\n#include <linux/mmc/core.h>\n#include <linux/dmaengine.h>\n#include <linux/reset.h>\n#include <linux/fault-inject.h>\n#include <linux/hrtimer.h>\n#include <linux/interrupt.h>\n\nenum dw_mci_state {\n\tSTATE_IDLE = 0,\n\tSTATE_SENDING_CMD,\n\tSTATE_SENDING_DATA,\n\tSTATE_DATA_BUSY,\n\tSTATE_SENDING_STOP,\n\tSTATE_DATA_ERROR,\n\tSTATE_SENDING_CMD11,\n\tSTATE_WAITING_CMD11_DONE,\n};\n\nenum {\n\tEVENT_CMD_COMPLETE = 0,\n\tEVENT_XFER_COMPLETE,\n\tEVENT_DATA_COMPLETE,\n\tEVENT_DATA_ERROR,\n};\n\nenum dw_mci_cookie {\n\tCOOKIE_UNMAPPED,\n\tCOOKIE_PRE_MAPPED,\t \n\tCOOKIE_MAPPED,\t\t \n};\n\nstruct mmc_data;\n\nenum {\n\tTRANS_MODE_PIO = 0,\n\tTRANS_MODE_IDMAC,\n\tTRANS_MODE_EDMAC\n};\n\nstruct dw_mci_dma_slave {\n\tstruct dma_chan *ch;\n\tenum dma_transfer_direction direction;\n};\n\n \nstruct dw_mci {\n\tspinlock_t\t\tlock;\n\tspinlock_t\t\tirq_lock;\n\tvoid __iomem\t\t*regs;\n\tvoid __iomem\t\t*fifo_reg;\n\tu32\t\t\tdata_addr_override;\n\tbool\t\t\twm_aligned;\n\n\tstruct scatterlist\t*sg;\n\tstruct sg_mapping_iter\tsg_miter;\n\n\tstruct mmc_request\t*mrq;\n\tstruct mmc_command\t*cmd;\n\tstruct mmc_data\t\t*data;\n\tstruct mmc_command\tstop_abort;\n\tunsigned int\t\tprev_blksz;\n\tunsigned char\t\ttiming;\n\n\t \n\tint\t\t\tuse_dma;\n\tint\t\t\tusing_dma;\n\tint\t\t\tdma_64bit_address;\n\n\tdma_addr_t\t\tsg_dma;\n\tvoid\t\t\t*sg_cpu;\n\tconst struct dw_mci_dma_ops\t*dma_ops;\n\t \n\tunsigned int\t\tring_size;\n\n\t \n\tstruct dw_mci_dma_slave *dms;\n\t \n\tresource_size_t\t\tphy_regs;\n\n\tu32\t\t\tcmd_status;\n\tu32\t\t\tdata_status;\n\tu32\t\t\tstop_cmdr;\n\tu32\t\t\tdir_status;\n\tstruct tasklet_struct\ttasklet;\n\tunsigned long\t\tpending_events;\n\tunsigned long\t\tcompleted_events;\n\tenum dw_mci_state\tstate;\n\tstruct list_head\tqueue;\n\n\tu32\t\t\tbus_hz;\n\tu32\t\t\tcurrent_speed;\n\tu32\t\t\tminimum_speed;\n\tu32\t\t\tfifoth_val;\n\tu16\t\t\tverid;\n\tstruct device\t\t*dev;\n\tstruct dw_mci_board\t*pdata;\n\tconst struct dw_mci_drv_data\t*drv_data;\n\tvoid\t\t\t*priv;\n\tstruct clk\t\t*biu_clk;\n\tstruct clk\t\t*ciu_clk;\n\tstruct dw_mci_slot\t*slot;\n\n\t \n\tint\t\t\tfifo_depth;\n\tint\t\t\tdata_shift;\n\tu8\t\t\tpart_buf_start;\n\tu8\t\t\tpart_buf_count;\n\tunion {\n\t\tu16\t\tpart_buf16;\n\t\tu32\t\tpart_buf32;\n\t\tu64\t\tpart_buf;\n\t};\n\tvoid (*push_data)(struct dw_mci *host, void *buf, int cnt);\n\tvoid (*pull_data)(struct dw_mci *host, void *buf, int cnt);\n\n\tu32\t\t\tquirks;\n\tbool\t\t\tvqmmc_enabled;\n\tunsigned long\t\tirq_flags;  \n\tint\t\t\tirq;\n\n\tint\t\t\tsdio_id0;\n\n\tstruct timer_list       cmd11_timer;\n\tstruct timer_list       cto_timer;\n\tstruct timer_list       dto_timer;\n\n#ifdef CONFIG_FAULT_INJECTION\n\tstruct fault_attr\tfail_data_crc;\n\tstruct hrtimer\t\tfault_timer;\n#endif\n};\n\n \nstruct dw_mci_dma_ops {\n\t \n\tint (*init)(struct dw_mci *host);\n\tint (*start)(struct dw_mci *host, unsigned int sg_len);\n\tvoid (*complete)(void *host);\n\tvoid (*stop)(struct dw_mci *host);\n\tvoid (*cleanup)(struct dw_mci *host);\n\tvoid (*exit)(struct dw_mci *host);\n};\n\nstruct dma_pdata;\n\n \nstruct dw_mci_board {\n\tunsigned int bus_hz;  \n\n\tu32 caps;\t \n\tu32 caps2;\t \n\tu32 pm_caps;\t \n\t \n\tunsigned int fifo_depth;\n\n\t \n\tu32 detect_delay_ms;\n\n\tstruct reset_control *rstc;\n\tstruct dw_mci_dma_ops *dma_ops;\n\tstruct dma_pdata *data;\n};\n\n \n#define DW_MMC_QUIRK_EXTENDED_TMOUT            BIT(0)\n\n#define DW_MMC_240A\t\t0x240a\n#define DW_MMC_280A\t\t0x280a\n\n#define SDMMC_CTRL\t\t0x000\n#define SDMMC_PWREN\t\t0x004\n#define SDMMC_CLKDIV\t\t0x008\n#define SDMMC_CLKSRC\t\t0x00c\n#define SDMMC_CLKENA\t\t0x010\n#define SDMMC_TMOUT\t\t0x014\n#define SDMMC_CTYPE\t\t0x018\n#define SDMMC_BLKSIZ\t\t0x01c\n#define SDMMC_BYTCNT\t\t0x020\n#define SDMMC_INTMASK\t\t0x024\n#define SDMMC_CMDARG\t\t0x028\n#define SDMMC_CMD\t\t0x02c\n#define SDMMC_RESP0\t\t0x030\n#define SDMMC_RESP1\t\t0x034\n#define SDMMC_RESP2\t\t0x038\n#define SDMMC_RESP3\t\t0x03c\n#define SDMMC_MINTSTS\t\t0x040\n#define SDMMC_RINTSTS\t\t0x044\n#define SDMMC_STATUS\t\t0x048\n#define SDMMC_FIFOTH\t\t0x04c\n#define SDMMC_CDETECT\t\t0x050\n#define SDMMC_WRTPRT\t\t0x054\n#define SDMMC_GPIO\t\t0x058\n#define SDMMC_TCBCNT\t\t0x05c\n#define SDMMC_TBBCNT\t\t0x060\n#define SDMMC_DEBNCE\t\t0x064\n#define SDMMC_USRID\t\t0x068\n#define SDMMC_VERID\t\t0x06c\n#define SDMMC_HCON\t\t0x070\n#define SDMMC_UHS_REG\t\t0x074\n#define SDMMC_RST_N\t\t0x078\n#define SDMMC_BMOD\t\t0x080\n#define SDMMC_PLDMND\t\t0x084\n#define SDMMC_DBADDR\t\t0x088\n#define SDMMC_IDSTS\t\t0x08c\n#define SDMMC_IDINTEN\t\t0x090\n#define SDMMC_DSCADDR\t\t0x094\n#define SDMMC_BUFADDR\t\t0x098\n#define SDMMC_CDTHRCTL\t\t0x100\n#define SDMMC_UHS_REG_EXT\t0x108\n#define SDMMC_DDR_REG\t\t0x10c\n#define SDMMC_ENABLE_SHIFT\t0x110\n#define SDMMC_DATA(x)\t\t(x)\n \n#define SDMMC_DBADDRL\t\t0x088\n#define SDMMC_DBADDRU\t\t0x08c\n#define SDMMC_IDSTS64\t\t0x090\n#define SDMMC_IDINTEN64\t\t0x094\n#define SDMMC_DSCADDRL\t\t0x098\n#define SDMMC_DSCADDRU\t\t0x09c\n#define SDMMC_BUFADDRL\t\t0x0A0\n#define SDMMC_BUFADDRU\t\t0x0A4\n\n \n#define DATA_OFFSET\t\t0x100\n#define DATA_240A_OFFSET\t0x200\n\n \n#define _SBF(f, v)\t\t((v) << (f))\n\n \n#define SDMMC_CTRL_USE_IDMAC\t\tBIT(25)\n#define SDMMC_CTRL_CEATA_INT_EN\t\tBIT(11)\n#define SDMMC_CTRL_SEND_AS_CCSD\t\tBIT(10)\n#define SDMMC_CTRL_SEND_CCSD\t\tBIT(9)\n#define SDMMC_CTRL_ABRT_READ_DATA\tBIT(8)\n#define SDMMC_CTRL_SEND_IRQ_RESP\tBIT(7)\n#define SDMMC_CTRL_READ_WAIT\t\tBIT(6)\n#define SDMMC_CTRL_DMA_ENABLE\t\tBIT(5)\n#define SDMMC_CTRL_INT_ENABLE\t\tBIT(4)\n#define SDMMC_CTRL_DMA_RESET\t\tBIT(2)\n#define SDMMC_CTRL_FIFO_RESET\t\tBIT(1)\n#define SDMMC_CTRL_RESET\t\tBIT(0)\n \n#define SDMMC_CLKEN_LOW_PWR\t\tBIT(16)\n#define SDMMC_CLKEN_ENABLE\t\tBIT(0)\n \n#define SDMMC_TMOUT_DATA(n)\t\t_SBF(8, (n))\n#define SDMMC_TMOUT_DATA_MSK\t\t0xFFFFFF00\n#define SDMMC_TMOUT_RESP(n)\t\t((n) & 0xFF)\n#define SDMMC_TMOUT_RESP_MSK\t\t0xFF\n \n#define SDMMC_CTYPE_8BIT\t\tBIT(16)\n#define SDMMC_CTYPE_4BIT\t\tBIT(0)\n#define SDMMC_CTYPE_1BIT\t\t0\n \n#define SDMMC_INT_SDIO(n)\t\tBIT(16 + (n))\n#define SDMMC_INT_EBE\t\t\tBIT(15)\n#define SDMMC_INT_ACD\t\t\tBIT(14)\n#define SDMMC_INT_SBE\t\t\tBIT(13)\n#define SDMMC_INT_HLE\t\t\tBIT(12)\n#define SDMMC_INT_FRUN\t\t\tBIT(11)\n#define SDMMC_INT_HTO\t\t\tBIT(10)\n#define SDMMC_INT_VOLT_SWITCH\t\tBIT(10)  \n#define SDMMC_INT_DRTO\t\t\tBIT(9)\n#define SDMMC_INT_RTO\t\t\tBIT(8)\n#define SDMMC_INT_DCRC\t\t\tBIT(7)\n#define SDMMC_INT_RCRC\t\t\tBIT(6)\n#define SDMMC_INT_RXDR\t\t\tBIT(5)\n#define SDMMC_INT_TXDR\t\t\tBIT(4)\n#define SDMMC_INT_DATA_OVER\t\tBIT(3)\n#define SDMMC_INT_CMD_DONE\t\tBIT(2)\n#define SDMMC_INT_RESP_ERR\t\tBIT(1)\n#define SDMMC_INT_CD\t\t\tBIT(0)\n#define SDMMC_INT_ERROR\t\t\t0xbfc2\n \n#define SDMMC_CMD_START\t\t\tBIT(31)\n#define SDMMC_CMD_USE_HOLD_REG\tBIT(29)\n#define SDMMC_CMD_VOLT_SWITCH\t\tBIT(28)\n#define SDMMC_CMD_CCS_EXP\t\tBIT(23)\n#define SDMMC_CMD_CEATA_RD\t\tBIT(22)\n#define SDMMC_CMD_UPD_CLK\t\tBIT(21)\n#define SDMMC_CMD_INIT\t\t\tBIT(15)\n#define SDMMC_CMD_STOP\t\t\tBIT(14)\n#define SDMMC_CMD_PRV_DAT_WAIT\t\tBIT(13)\n#define SDMMC_CMD_SEND_STOP\t\tBIT(12)\n#define SDMMC_CMD_STRM_MODE\t\tBIT(11)\n#define SDMMC_CMD_DAT_WR\t\tBIT(10)\n#define SDMMC_CMD_DAT_EXP\t\tBIT(9)\n#define SDMMC_CMD_RESP_CRC\t\tBIT(8)\n#define SDMMC_CMD_RESP_LONG\t\tBIT(7)\n#define SDMMC_CMD_RESP_EXP\t\tBIT(6)\n#define SDMMC_CMD_INDX(n)\t\t((n) & 0x1F)\n \n#define SDMMC_GET_FCNT(x)\t\t(((x)>>17) & 0x1FFF)\n#define SDMMC_STATUS_DMA_REQ\t\tBIT(31)\n#define SDMMC_STATUS_BUSY\t\tBIT(9)\n \n#define SDMMC_SET_FIFOTH(m, r, t)\t(((m) & 0x7) << 28 | \\\n\t\t\t\t\t ((r) & 0xFFF) << 16 | \\\n\t\t\t\t\t ((t) & 0xFFF))\n \n#define DMA_INTERFACE_IDMA\t\t(0x0)\n#define DMA_INTERFACE_DWDMA\t\t(0x1)\n#define DMA_INTERFACE_GDMA\t\t(0x2)\n#define DMA_INTERFACE_NODMA\t\t(0x3)\n#define SDMMC_GET_TRANS_MODE(x)\t\t(((x)>>16) & 0x3)\n#define SDMMC_GET_SLOT_NUM(x)\t\t((((x)>>1) & 0x1F) + 1)\n#define SDMMC_GET_HDATA_WIDTH(x)\t(((x)>>7) & 0x7)\n#define SDMMC_GET_ADDR_CONFIG(x)\t(((x)>>27) & 0x1)\n \n#define SDMMC_IDMAC_INT_AI\t\tBIT(9)\n#define SDMMC_IDMAC_INT_NI\t\tBIT(8)\n#define SDMMC_IDMAC_INT_CES\t\tBIT(5)\n#define SDMMC_IDMAC_INT_DU\t\tBIT(4)\n#define SDMMC_IDMAC_INT_FBE\t\tBIT(2)\n#define SDMMC_IDMAC_INT_RI\t\tBIT(1)\n#define SDMMC_IDMAC_INT_TI\t\tBIT(0)\n \n#define SDMMC_IDMAC_ENABLE\t\tBIT(7)\n#define SDMMC_IDMAC_FB\t\t\tBIT(1)\n#define SDMMC_IDMAC_SWRESET\t\tBIT(0)\n \n#define SDMMC_RST_HWACTIVE\t\t0x1\n \n#define SDMMC_GET_VERID(x)\t\t((x) & 0xFFFF)\n \n#define SDMMC_SET_THLD(v, x)\t\t(((v) & 0xFFF) << 16 | (x))\n#define SDMMC_CARD_WR_THR_EN\t\tBIT(2)\n#define SDMMC_CARD_RD_THR_EN\t\tBIT(0)\n \n#define SDMMC_UHS_DDR\t\t\tBIT(16)\n#define SDMMC_UHS_18V\t\t\tBIT(0)\n \n#define SDMMC_DDR_HS400\t\t\tBIT(31)\n \n#define SDMMC_ENABLE_PHASE\t\tBIT(0)\n \n#define SDMMC_CTRL_ALL_RESET_FLAGS \\\n\t(SDMMC_CTRL_RESET | SDMMC_CTRL_FIFO_RESET | SDMMC_CTRL_DMA_RESET)\n\n \n#define mci_fifo_readw(__reg)\t__raw_readw(__reg)\n#define mci_fifo_readl(__reg)\t__raw_readl(__reg)\n#define mci_fifo_readq(__reg)\t__raw_readq(__reg)\n\n#define mci_fifo_writew(__value, __reg)\t__raw_writew(__reg, __value)\n#define mci_fifo_writel(__value, __reg)\t__raw_writel(__reg, __value)\n#define mci_fifo_writeq(__value, __reg)\t__raw_writeq(__reg, __value)\n\n \n#define mci_readl(dev, reg)\t\t\t\\\n\treadl_relaxed((dev)->regs + SDMMC_##reg)\n#define mci_writel(dev, reg, value)\t\t\t\\\n\twritel_relaxed((value), (dev)->regs + SDMMC_##reg)\n\n \n#define mci_readw(dev, reg)\t\t\t\\\n\treadw_relaxed((dev)->regs + SDMMC_##reg)\n#define mci_writew(dev, reg, value)\t\t\t\\\n\twritew_relaxed((value), (dev)->regs + SDMMC_##reg)\n\n \n#ifdef readq\n#define mci_readq(dev, reg)\t\t\t\\\n\treadq_relaxed((dev)->regs + SDMMC_##reg)\n#define mci_writeq(dev, reg, value)\t\t\t\\\n\twriteq_relaxed((value), (dev)->regs + SDMMC_##reg)\n#else\n \n#define mci_readq(dev, reg)\t\t\t\\\n\t(*(volatile u64 __force *)((dev)->regs + SDMMC_##reg))\n#define mci_writeq(dev, reg, value)\t\t\t\\\n\t(*(volatile u64 __force *)((dev)->regs + SDMMC_##reg) = (value))\n\n#define __raw_writeq(__value, __reg) \\\n\t(*(volatile u64 __force *)(__reg) = (__value))\n#define __raw_readq(__reg) (*(volatile u64 __force *)(__reg))\n#endif\n\nextern int dw_mci_probe(struct dw_mci *host);\nextern void dw_mci_remove(struct dw_mci *host);\n#ifdef CONFIG_PM\nextern int dw_mci_runtime_suspend(struct device *device);\nextern int dw_mci_runtime_resume(struct device *device);\n#endif\n\n \nstruct dw_mci_slot {\n\tstruct mmc_host\t\t*mmc;\n\tstruct dw_mci\t\t*host;\n\n\tu32\t\t\tctype;\n\n\tstruct mmc_request\t*mrq;\n\tstruct list_head\tqueue_node;\n\n\tunsigned int\t\tclock;\n\tunsigned int\t\t__clk_old;\n\n\tunsigned long\t\tflags;\n#define DW_MMC_CARD_PRESENT\t0\n#define DW_MMC_CARD_NEED_INIT\t1\n#define DW_MMC_CARD_NO_LOW_PWR\t2\n#define DW_MMC_CARD_NO_USE_HOLD 3\n#define DW_MMC_CARD_NEEDS_POLL\t4\n\tint\t\t\tid;\n\tint\t\t\tsdio_id;\n};\n\n \nstruct dw_mci_drv_data {\n\tunsigned long\t*caps;\n\tu32\t\tnum_caps;\n\tu32\t\tcommon_caps;\n\tint\t\t(*init)(struct dw_mci *host);\n\tvoid\t\t(*set_ios)(struct dw_mci *host, struct mmc_ios *ios);\n\tint\t\t(*parse_dt)(struct dw_mci *host);\n\tint\t\t(*execute_tuning)(struct dw_mci_slot *slot, u32 opcode);\n\tint\t\t(*prepare_hs400_tuning)(struct dw_mci *host,\n\t\t\t\t\t\tstruct mmc_ios *ios);\n\tint\t\t(*switch_voltage)(struct mmc_host *mmc,\n\t\t\t\t\t  struct mmc_ios *ios);\n\tvoid\t\t(*set_data_timeout)(struct dw_mci *host,\n\t\t\t\t\t  unsigned int timeout_ns);\n\tu32\t\t(*get_drto_clks)(struct dw_mci *host);\n};\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}