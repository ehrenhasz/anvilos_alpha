{
  "module_name": "ntb_hw_amd.h",
  "hash_id": "0104160776e15f29f0f146d668d22e119bb24ccf7cbef9939c1eb8c1ff80dc0a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ntb/hw/amd/ntb_hw_amd.h",
  "human_readable_source": " \n\n#ifndef NTB_HW_AMD_H\n#define NTB_HW_AMD_H\n\n#include <linux/ntb.h>\n#include <linux/pci.h>\n\n#define AMD_LINK_HB_TIMEOUT\tmsecs_to_jiffies(1000)\n#define NTB_LNK_STA_SPEED_MASK\t0x000F0000\n#define NTB_LNK_STA_WIDTH_MASK\t0x03F00000\n#define NTB_LNK_STA_SPEED(x)\t(((x) & NTB_LNK_STA_SPEED_MASK) >> 16)\n#define NTB_LNK_STA_WIDTH(x)\t(((x) & NTB_LNK_STA_WIDTH_MASK) >> 20)\n\n#ifndef read64\n#ifdef readq\n#define read64 readq\n#else\n#define read64 _read64\nstatic inline u64 _read64(void __iomem *mmio)\n{\n\tu64 low, high;\n\n\tlow = readl(mmio);\n\thigh = readl(mmio + sizeof(u32));\n\treturn low | (high << 32);\n}\n#endif\n#endif\n\n#ifndef write64\n#ifdef writeq\n#define write64 writeq\n#else\n#define write64 _write64\nstatic inline void _write64(u64 val, void __iomem *mmio)\n{\n\twritel(val, mmio);\n\twritel(val >> 32, mmio + sizeof(u32));\n}\n#endif\n#endif\n\nenum {\n\t \n\tAMD_DB_CNT\t\t= 16,\n\tAMD_MSIX_VECTOR_CNT\t= 24,\n\tAMD_SPADS_CNT\t\t= 16,\n\n\t \n\tAMD_CNTL_OFFSET\t\t= 0x200,\n\n\t \n\tPMM_REG_CTL\t\t= BIT(21),\n\tSMM_REG_CTL\t\t= BIT(20),\n\tSMM_REG_ACC_PATH\t= BIT(18),\n\tPMM_REG_ACC_PATH\t= BIT(17),\n\tNTB_CLK_EN\t\t= BIT(16),\n\n\tAMD_STA_OFFSET\t\t= 0x204,\n\tAMD_PGSLV_OFFSET\t= 0x208,\n\tAMD_SPAD_MUX_OFFSET\t= 0x20C,\n\tAMD_SPAD_OFFSET\t\t= 0x210,\n\tAMD_RSMU_HCID\t\t= 0x250,\n\tAMD_RSMU_SIID\t\t= 0x254,\n\tAMD_PSION_OFFSET\t= 0x300,\n\tAMD_SSION_OFFSET\t= 0x330,\n\tAMD_MMINDEX_OFFSET\t= 0x400,\n\tAMD_MMDATA_OFFSET\t= 0x404,\n\tAMD_SIDEINFO_OFFSET\t= 0x408,\n\n\tAMD_SIDE_MASK\t\t= BIT(0),\n\tAMD_SIDE_READY\t\t= BIT(1),\n\n\t \n\tAMD_ROMBARLMT_OFFSET\t= 0x410,\n\tAMD_BAR1LMT_OFFSET\t= 0x414,\n\tAMD_BAR23LMT_OFFSET\t= 0x418,\n\tAMD_BAR45LMT_OFFSET\t= 0x420,\n\t \n\tAMD_POMBARXLAT_OFFSET\t= 0x428,\n\tAMD_BAR1XLAT_OFFSET\t= 0x430,\n\tAMD_BAR23XLAT_OFFSET\t= 0x438,\n\tAMD_BAR45XLAT_OFFSET\t= 0x440,\n\t \n\tAMD_DBFM_OFFSET\t\t= 0x450,\n\tAMD_DBREQ_OFFSET\t= 0x454,\n\tAMD_MIRRDBSTAT_OFFSET\t= 0x458,\n\tAMD_DBMASK_OFFSET\t= 0x45C,\n\tAMD_DBSTAT_OFFSET\t= 0x460,\n\tAMD_INTMASK_OFFSET\t= 0x470,\n\tAMD_INTSTAT_OFFSET\t= 0x474,\n\n\t \n\tAMD_PEER_FLUSH_EVENT\t= BIT(0),\n\tAMD_PEER_RESET_EVENT\t= BIT(1),\n\tAMD_PEER_D3_EVENT\t= BIT(2),\n\tAMD_PEER_PMETO_EVENT\t= BIT(3),\n\tAMD_PEER_D0_EVENT\t= BIT(4),\n\tAMD_LINK_UP_EVENT\t= BIT(5),\n\tAMD_LINK_DOWN_EVENT\t= BIT(6),\n\tAMD_EVENT_INTMASK\t= (AMD_PEER_FLUSH_EVENT |\n\t\t\t\tAMD_PEER_RESET_EVENT | AMD_PEER_D3_EVENT |\n\t\t\t\tAMD_PEER_PMETO_EVENT | AMD_PEER_D0_EVENT |\n\t\t\t\tAMD_LINK_UP_EVENT | AMD_LINK_DOWN_EVENT),\n\n\tAMD_PMESTAT_OFFSET\t= 0x480,\n\tAMD_PMSGTRIG_OFFSET\t= 0x490,\n\tAMD_LTRLATENCY_OFFSET\t= 0x494,\n\tAMD_FLUSHTRIG_OFFSET\t= 0x498,\n\n\t \n\tAMD_SMUACK_OFFSET\t= 0x4A0,\n\tAMD_SINRST_OFFSET\t= 0x4A4,\n\tAMD_RSPNUM_OFFSET\t= 0x4A8,\n\tAMD_SMU_SPADMUTEX\t= 0x4B0,\n\tAMD_SMU_SPADOFFSET\t= 0x4B4,\n\n\tAMD_PEER_OFFSET\t\t= 0x400,\n};\n\nstruct ntb_dev_data {\n\tconst unsigned char mw_count;\n\tconst unsigned int mw_idx;\n};\n\nstruct amd_ntb_dev;\n\nstruct amd_ntb_vec {\n\tstruct amd_ntb_dev\t*ndev;\n\tint\t\t\tnum;\n};\n\nstruct amd_ntb_dev {\n\tstruct ntb_dev ntb;\n\n\tu32 ntb_side;\n\tu32 lnk_sta;\n\tu32 cntl_sta;\n\tu32 peer_sta;\n\n\tstruct ntb_dev_data *dev_data;\n\tunsigned char mw_count;\n\tunsigned char spad_count;\n\tunsigned char db_count;\n\tunsigned char msix_vec_count;\n\n\tu64 db_valid_mask;\n\tu64 db_mask;\n\tu64 db_last_bit;\n\tu32 int_mask;\n\n\tstruct msix_entry *msix;\n\tstruct amd_ntb_vec *vec;\n\n\t \n\tspinlock_t db_mask_lock;\n\n\tvoid __iomem *self_mmio;\n\tvoid __iomem *peer_mmio;\n\tunsigned int self_spad;\n\tunsigned int peer_spad;\n\n\tstruct delayed_work hb_timer;\n\n\tstruct dentry *debugfs_dir;\n\tstruct dentry *debugfs_info;\n};\n\n#define ntb_ndev(__ntb) container_of(__ntb, struct amd_ntb_dev, ntb)\n#define hb_ndev(__work) container_of(__work, struct amd_ntb_dev, hb_timer.work)\n\nstatic void amd_set_side_info_reg(struct amd_ntb_dev *ndev, bool peer);\nstatic void amd_clear_side_info_reg(struct amd_ntb_dev *ndev, bool peer);\nstatic int amd_poll_link(struct amd_ntb_dev *ndev);\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}