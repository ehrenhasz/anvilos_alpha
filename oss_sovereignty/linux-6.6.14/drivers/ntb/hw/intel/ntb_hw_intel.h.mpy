{
  "module_name": "ntb_hw_intel.h",
  "hash_id": "134e519ce1e4a4d1957caaba25d8beb7566cf6f6d633c9c1df608cba671b7756",
  "original_prompt": "Ingested from linux-6.6.14/drivers/ntb/hw/intel/ntb_hw_intel.h",
  "human_readable_source": " \n\n#ifndef NTB_HW_INTEL_H\n#define NTB_HW_INTEL_H\n\n#include <linux/ntb.h>\n#include <linux/pci.h>\n#include <linux/io-64-nonatomic-lo-hi.h>\n\n \n#define PCI_DEVICE_ID_INTEL_NTB_B2B_JSF\t0x3725\n#define PCI_DEVICE_ID_INTEL_NTB_PS_JSF\t0x3726\n#define PCI_DEVICE_ID_INTEL_NTB_SS_JSF\t0x3727\n#define PCI_DEVICE_ID_INTEL_NTB_B2B_SNB\t0x3C0D\n#define PCI_DEVICE_ID_INTEL_NTB_PS_SNB\t0x3C0E\n#define PCI_DEVICE_ID_INTEL_NTB_SS_SNB\t0x3C0F\n#define PCI_DEVICE_ID_INTEL_NTB_B2B_IVT\t0x0E0D\n#define PCI_DEVICE_ID_INTEL_NTB_PS_IVT\t0x0E0E\n#define PCI_DEVICE_ID_INTEL_NTB_SS_IVT\t0x0E0F\n#define PCI_DEVICE_ID_INTEL_NTB_B2B_HSX\t0x2F0D\n#define PCI_DEVICE_ID_INTEL_NTB_PS_HSX\t0x2F0E\n#define PCI_DEVICE_ID_INTEL_NTB_SS_HSX\t0x2F0F\n#define PCI_DEVICE_ID_INTEL_NTB_B2B_BDX\t0x6F0D\n#define PCI_DEVICE_ID_INTEL_NTB_PS_BDX\t0x6F0E\n#define PCI_DEVICE_ID_INTEL_NTB_SS_BDX\t0x6F0F\n#define PCI_DEVICE_ID_INTEL_NTB_B2B_SKX\t0x201C\n#define PCI_DEVICE_ID_INTEL_NTB_B2B_ICX\t0x347e\n#define PCI_DEVICE_ID_INTEL_NTB_B2B_GNR\t0x0db4\n\n \n#define NTB_CTL_CFG_LOCK\t\tBIT(0)\n#define NTB_CTL_DISABLE\t\t\tBIT(1)\n#define NTB_CTL_S2P_BAR2_SNOOP\t\tBIT(2)\n#define NTB_CTL_P2S_BAR2_SNOOP\t\tBIT(4)\n#define NTB_CTL_S2P_BAR4_SNOOP\t\tBIT(6)\n#define NTB_CTL_P2S_BAR4_SNOOP\t\tBIT(8)\n#define NTB_CTL_S2P_BAR5_SNOOP\t\tBIT(12)\n#define NTB_CTL_P2S_BAR5_SNOOP\t\tBIT(14)\n\n#define NTB_LNK_STA_ACTIVE_BIT\t\t0x2000\n#define NTB_LNK_STA_SPEED_MASK\t\t0x000f\n#define NTB_LNK_STA_WIDTH_MASK\t\t0x03f0\n#define NTB_LNK_STA_ACTIVE(x)\t\t(!!((x) & NTB_LNK_STA_ACTIVE_BIT))\n#define NTB_LNK_STA_SPEED(x)\t\t((x) & NTB_LNK_STA_SPEED_MASK)\n#define NTB_LNK_STA_WIDTH(x)\t\t(((x) & NTB_LNK_STA_WIDTH_MASK) >> 4)\n\n \n#define NTB_UNSAFE_DB\t\t\tBIT_ULL(0)\n#define NTB_UNSAFE_SPAD\t\t\tBIT_ULL(1)\n\n#define NTB_BAR_MASK_64\t\t\t~(0xfull)\n#define NTB_BAR_MASK_32\t\t\t~(0xfu)\n\nstruct intel_ntb_dev;\n\nstruct intel_ntb_reg {\n\tint (*poll_link)(struct intel_ntb_dev *ndev);\n\tint (*link_is_up)(struct intel_ntb_dev *ndev);\n\tu64 (*db_ioread)(const void __iomem *mmio);\n\tvoid (*db_iowrite)(u64 db_bits, void __iomem *mmio);\n\tunsigned long\t\t\tntb_ctl;\n\tresource_size_t\t\t\tdb_size;\n\tint\t\t\t\tmw_bar[];\n};\n\nstruct intel_ntb_alt_reg {\n\tunsigned long\t\t\tdb_bell;\n\tunsigned long\t\t\tdb_mask;\n\tunsigned long\t\t\tdb_clear;\n\tunsigned long\t\t\tspad;\n};\n\nstruct intel_ntb_xlat_reg {\n\tunsigned long\t\t\tbar0_base;\n\tunsigned long\t\t\tbar2_xlat;\n\tunsigned long\t\t\tbar2_limit;\n\tunsigned short\t\t\tbar2_idx;\n};\n\nstruct intel_b2b_addr {\n\tphys_addr_t\t\t\tbar0_addr;\n\tphys_addr_t\t\t\tbar2_addr64;\n\tphys_addr_t\t\t\tbar4_addr64;\n\tphys_addr_t\t\t\tbar4_addr32;\n\tphys_addr_t\t\t\tbar5_addr32;\n};\n\nstruct intel_ntb_vec {\n\tstruct intel_ntb_dev\t\t*ndev;\n\tint\t\t\t\tnum;\n};\n\nstruct intel_ntb_dev {\n\tstruct ntb_dev\t\t\tntb;\n\n\t \n\tunsigned long\t\t\tb2b_off;\n\t \n\tunsigned int\t\t\tb2b_idx;\n\n\t \n\tbool\t\t\t\tbar4_split;\n\n\tu32\t\t\t\tntb_ctl;\n\tu32\t\t\t\tlnk_sta;\n\n\tunsigned char\t\t\tmw_count;\n\tunsigned char\t\t\tspad_count;\n\tunsigned char\t\t\tdb_count;\n\tunsigned char\t\t\tdb_vec_count;\n\tunsigned char\t\t\tdb_vec_shift;\n\n\tu64\t\t\t\tdb_valid_mask;\n\tu64\t\t\t\tdb_link_mask;\n\tu64\t\t\t\tdb_mask;\n\n\t \n\tspinlock_t\t\t\tdb_mask_lock;\n\n\tstruct msix_entry\t\t*msix;\n\tstruct intel_ntb_vec\t\t*vec;\n\n\tconst struct intel_ntb_reg\t*reg;\n\tconst struct intel_ntb_alt_reg\t*self_reg;\n\tconst struct intel_ntb_alt_reg\t*peer_reg;\n\tconst struct intel_ntb_xlat_reg\t*xlat_reg;\n\tvoid\t\t\t\t__iomem *self_mmio;\n\tvoid\t\t\t\t__iomem *peer_mmio;\n\tphys_addr_t\t\t\tpeer_addr;\n\n\tunsigned long\t\t\tlast_ts;\n\tstruct delayed_work\t\thb_timer;\n\n\tunsigned long\t\t\thwerr_flags;\n\tunsigned long\t\t\tunsafe_flags;\n\tunsigned long\t\t\tunsafe_flags_ignore;\n\n\tstruct dentry\t\t\t*debugfs_dir;\n\tstruct dentry\t\t\t*debugfs_info;\n\n\t \n\tint\t\t\t\tdev_up;\n};\n\n#define ntb_ndev(__ntb) container_of(__ntb, struct intel_ntb_dev, ntb)\n#define hb_ndev(__work) container_of(__work, struct intel_ntb_dev, \\\n\t\t\t\t     hb_timer.work)\n\nstatic inline int pdev_is_gen1(struct pci_dev *pdev)\n{\n\tswitch (pdev->device) {\n\tcase PCI_DEVICE_ID_INTEL_NTB_SS_JSF:\n\tcase PCI_DEVICE_ID_INTEL_NTB_SS_SNB:\n\tcase PCI_DEVICE_ID_INTEL_NTB_SS_IVT:\n\tcase PCI_DEVICE_ID_INTEL_NTB_SS_HSX:\n\tcase PCI_DEVICE_ID_INTEL_NTB_SS_BDX:\n\tcase PCI_DEVICE_ID_INTEL_NTB_PS_JSF:\n\tcase PCI_DEVICE_ID_INTEL_NTB_PS_SNB:\n\tcase PCI_DEVICE_ID_INTEL_NTB_PS_IVT:\n\tcase PCI_DEVICE_ID_INTEL_NTB_PS_HSX:\n\tcase PCI_DEVICE_ID_INTEL_NTB_PS_BDX:\n\tcase PCI_DEVICE_ID_INTEL_NTB_B2B_JSF:\n\tcase PCI_DEVICE_ID_INTEL_NTB_B2B_SNB:\n\tcase PCI_DEVICE_ID_INTEL_NTB_B2B_IVT:\n\tcase PCI_DEVICE_ID_INTEL_NTB_B2B_HSX:\n\tcase PCI_DEVICE_ID_INTEL_NTB_B2B_BDX:\n\t\treturn 1;\n\t}\n\treturn 0;\n}\n\nstatic inline int pdev_is_gen3(struct pci_dev *pdev)\n{\n\tif (pdev->device == PCI_DEVICE_ID_INTEL_NTB_B2B_SKX)\n\t\treturn 1;\n\n\treturn 0;\n}\n\nstatic inline int pdev_is_gen4(struct pci_dev *pdev)\n{\n\tif (pdev->device == PCI_DEVICE_ID_INTEL_NTB_B2B_ICX)\n\t\treturn 1;\n\n\treturn 0;\n}\n\nstatic inline int pdev_is_gen5(struct pci_dev *pdev)\n{\n\treturn pdev->device == PCI_DEVICE_ID_INTEL_NTB_B2B_GNR;\n}\n\n#endif\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}