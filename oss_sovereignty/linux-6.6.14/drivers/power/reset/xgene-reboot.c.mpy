{
  "module_name": "xgene-reboot.c",
  "hash_id": "296a60bcef8e45f4773f7834f5ce30717a13bba373e411424952845685fe3158",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/xgene-reboot.c",
  "human_readable_source": "\n \n#include <linux/delay.h>\n#include <linux/io.h>\n#include <linux/notifier.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n#include <linux/reboot.h>\n#include <linux/stat.h>\n#include <linux/slab.h>\n\nstruct xgene_reboot_context {\n\tstruct device *dev;\n\tvoid *csr;\n\tu32 mask;\n\tstruct notifier_block restart_handler;\n};\n\nstatic int xgene_restart_handler(struct notifier_block *this,\n\t\t\t\t unsigned long mode, void *cmd)\n{\n\tstruct xgene_reboot_context *ctx =\n\t\tcontainer_of(this, struct xgene_reboot_context,\n\t\t\t     restart_handler);\n\n\t \n\twritel(ctx->mask, ctx->csr);\n\n\tmdelay(1000);\n\n\tdev_emerg(ctx->dev, \"Unable to restart system\\n\");\n\n\treturn NOTIFY_DONE;\n}\n\nstatic int xgene_reboot_probe(struct platform_device *pdev)\n{\n\tstruct xgene_reboot_context *ctx;\n\tstruct device *dev = &pdev->dev;\n\tint err;\n\n\tctx = devm_kzalloc(dev, sizeof(*ctx), GFP_KERNEL);\n\tif (!ctx)\n\t\treturn -ENOMEM;\n\n\tctx->csr = of_iomap(dev->of_node, 0);\n\tif (!ctx->csr) {\n\t\tdev_err(dev, \"can not map resource\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tif (of_property_read_u32(dev->of_node, \"mask\", &ctx->mask))\n\t\tctx->mask = 0xFFFFFFFF;\n\n\tctx->dev = dev;\n\tctx->restart_handler.notifier_call = xgene_restart_handler;\n\tctx->restart_handler.priority = 128;\n\terr = register_restart_handler(&ctx->restart_handler);\n\tif (err) {\n\t\tiounmap(ctx->csr);\n\t\tdev_err(dev, \"cannot register restart handler (err=%d)\\n\", err);\n\t}\n\n\treturn err;\n}\n\nstatic const struct of_device_id xgene_reboot_of_match[] = {\n\t{ .compatible = \"apm,xgene-reboot\" },\n\t{}\n};\n\nstatic struct platform_driver xgene_reboot_driver = {\n\t.probe = xgene_reboot_probe,\n\t.driver = {\n\t\t.name = \"xgene-reboot\",\n\t\t.of_match_table = xgene_reboot_of_match,\n\t},\n};\n\nstatic int __init xgene_reboot_init(void)\n{\n\treturn platform_driver_register(&xgene_reboot_driver);\n}\ndevice_initcall(xgene_reboot_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}