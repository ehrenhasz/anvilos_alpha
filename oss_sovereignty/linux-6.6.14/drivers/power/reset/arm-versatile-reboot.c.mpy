{
  "module_name": "arm-versatile-reboot.c",
  "hash_id": "4a3e1f4472a9b4e4bd8a28c4c756413b5eb7e01c083b48dcd05009e384947296",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/arm-versatile-reboot.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/mfd/syscon.h>\n#include <linux/reboot.h>\n#include <linux/regmap.h>\n#include <linux/of.h>\n\n#define INTEGRATOR_HDR_CTRL_OFFSET\t0x0C\n#define INTEGRATOR_HDR_LOCK_OFFSET\t0x14\n#define INTEGRATOR_CM_CTRL_RESET\t(1 << 3)\n\n#define VERSATILE_SYS_LOCK_OFFSET\t0x20\n#define VERSATILE_SYS_RESETCTL_OFFSET\t0x40\n\n \n#define VERSATILE_LOCK_VAL\t\t0xA05F\n\n \nenum versatile_reboot {\n\tINTEGRATOR_REBOOT_CM,\n\tVERSATILE_REBOOT_CM,\n\tREALVIEW_REBOOT_EB,\n\tREALVIEW_REBOOT_PB1176,\n\tREALVIEW_REBOOT_PB11MP,\n\tREALVIEW_REBOOT_PBA8,\n\tREALVIEW_REBOOT_PBX,\n};\n\n \nstatic struct regmap *syscon_regmap;\nstatic enum versatile_reboot versatile_reboot_type;\n\nstatic const struct of_device_id versatile_reboot_of_match[] = {\n\t{\n\t\t.compatible = \"arm,core-module-integrator\",\n\t\t.data = (void *)INTEGRATOR_REBOOT_CM\n\t},\n\t{\n\t\t.compatible = \"arm,core-module-versatile\",\n\t\t.data = (void *)VERSATILE_REBOOT_CM,\n\t},\n\t{\n\t\t.compatible = \"arm,realview-eb-syscon\",\n\t\t.data = (void *)REALVIEW_REBOOT_EB,\n\t},\n\t{\n\t\t.compatible = \"arm,realview-pb1176-syscon\",\n\t\t.data = (void *)REALVIEW_REBOOT_PB1176,\n\t},\n\t{\n\t\t.compatible = \"arm,realview-pb11mp-syscon\",\n\t\t.data = (void *)REALVIEW_REBOOT_PB11MP,\n\t},\n\t{\n\t\t.compatible = \"arm,realview-pba8-syscon\",\n\t\t.data = (void *)REALVIEW_REBOOT_PBA8,\n\t},\n\t{\n\t\t.compatible = \"arm,realview-pbx-syscon\",\n\t\t.data = (void *)REALVIEW_REBOOT_PBX,\n\t},\n\t{},\n};\n\nstatic int versatile_reboot(struct notifier_block *this, unsigned long mode,\n\t\t\t    void *cmd)\n{\n\t \n\t \n\tswitch (versatile_reboot_type) {\n\tcase INTEGRATOR_REBOOT_CM:\n\t\tregmap_write(syscon_regmap, INTEGRATOR_HDR_LOCK_OFFSET,\n\t\t\t     VERSATILE_LOCK_VAL);\n\t\tregmap_update_bits(syscon_regmap,\n\t\t\t\t   INTEGRATOR_HDR_CTRL_OFFSET,\n\t\t\t\t   INTEGRATOR_CM_CTRL_RESET,\n\t\t\t\t   INTEGRATOR_CM_CTRL_RESET);\n\t\tbreak;\n\tcase VERSATILE_REBOOT_CM:\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_LOCK_OFFSET,\n\t\t\t     VERSATILE_LOCK_VAL);\n\t\tregmap_update_bits(syscon_regmap,\n\t\t\t\t   VERSATILE_SYS_RESETCTL_OFFSET,\n\t\t\t\t   0x0107,\n\t\t\t\t   0x0105);\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_LOCK_OFFSET,\n\t\t\t     0);\n\t\tbreak;\n\tcase REALVIEW_REBOOT_EB:\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_LOCK_OFFSET,\n\t\t\t     VERSATILE_LOCK_VAL);\n\t\tregmap_write(syscon_regmap,\n\t\t\t     VERSATILE_SYS_RESETCTL_OFFSET, 0x0008);\n\t\tbreak;\n\tcase REALVIEW_REBOOT_PB1176:\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_LOCK_OFFSET,\n\t\t\t     VERSATILE_LOCK_VAL);\n\t\tregmap_write(syscon_regmap,\n\t\t\t     VERSATILE_SYS_RESETCTL_OFFSET, 0x0100);\n\t\tbreak;\n\tcase REALVIEW_REBOOT_PB11MP:\n\tcase REALVIEW_REBOOT_PBA8:\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_LOCK_OFFSET,\n\t\t\t     VERSATILE_LOCK_VAL);\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_RESETCTL_OFFSET,\n\t\t\t     0x0000);\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_RESETCTL_OFFSET,\n\t\t\t     0x0004);\n\t\tbreak;\n\tcase REALVIEW_REBOOT_PBX:\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_LOCK_OFFSET,\n\t\t\t     VERSATILE_LOCK_VAL);\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_RESETCTL_OFFSET,\n\t\t\t     0x00f0);\n\t\tregmap_write(syscon_regmap, VERSATILE_SYS_RESETCTL_OFFSET,\n\t\t\t     0x00f4);\n\t\tbreak;\n\t}\n\tdsb();\n\n\treturn NOTIFY_DONE;\n}\n\nstatic struct notifier_block versatile_reboot_nb = {\n\t.notifier_call = versatile_reboot,\n\t.priority = 192,\n};\n\nstatic int __init versatile_reboot_probe(void)\n{\n\tconst struct of_device_id *reboot_id;\n\tstruct device_node *np;\n\tint err;\n\n\tnp = of_find_matching_node_and_match(NULL, versatile_reboot_of_match,\n\t\t\t\t\t\t &reboot_id);\n\tif (!np)\n\t\treturn -ENODEV;\n\tversatile_reboot_type = (enum versatile_reboot)reboot_id->data;\n\n\tsyscon_regmap = syscon_node_to_regmap(np);\n\tof_node_put(np);\n\tif (IS_ERR(syscon_regmap))\n\t\treturn PTR_ERR(syscon_regmap);\n\n\terr = register_restart_handler(&versatile_reboot_nb);\n\tif (err)\n\t\treturn err;\n\n\tpr_info(\"versatile reboot driver registered\\n\");\n\treturn 0;\n}\ndevice_initcall(versatile_reboot_probe);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}