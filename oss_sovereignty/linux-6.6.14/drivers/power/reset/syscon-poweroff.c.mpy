{
  "module_name": "syscon-poweroff.c",
  "hash_id": "b1790931b38951ed647e589b5d1412681dac892fc163dca911cda6567b6147bb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/syscon-poweroff.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/io.h>\n#include <linux/notifier.h>\n#include <linux/mfd/syscon.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm.h>\n#include <linux/regmap.h>\n\nstatic struct regmap *map;\nstatic u32 offset;\nstatic u32 value;\nstatic u32 mask;\n\nstatic void syscon_poweroff(void)\n{\n\t \n\tregmap_update_bits(map, offset, mask, value);\n\n\tmdelay(1000);\n\n\tpr_emerg(\"Unable to poweroff system\\n\");\n}\n\nstatic int syscon_poweroff_probe(struct platform_device *pdev)\n{\n\tint mask_err, value_err;\n\n\tmap = syscon_regmap_lookup_by_phandle(pdev->dev.of_node, \"regmap\");\n\tif (IS_ERR(map)) {\n\t\tdev_err(&pdev->dev, \"unable to get syscon\");\n\t\treturn PTR_ERR(map);\n\t}\n\n\tif (of_property_read_u32(pdev->dev.of_node, \"offset\", &offset)) {\n\t\tdev_err(&pdev->dev, \"unable to read 'offset'\");\n\t\treturn -EINVAL;\n\t}\n\n\tvalue_err = of_property_read_u32(pdev->dev.of_node, \"value\", &value);\n\tmask_err = of_property_read_u32(pdev->dev.of_node, \"mask\", &mask);\n\tif (value_err && mask_err) {\n\t\tdev_err(&pdev->dev, \"unable to read 'value' and 'mask'\");\n\t\treturn -EINVAL;\n\t}\n\n\tif (value_err) {\n\t\t \n\t\tvalue = mask;\n\t\tmask = 0xFFFFFFFF;\n\t} else if (mask_err) {\n\t\t \n\t\tmask = 0xFFFFFFFF;\n\t}\n\n\tif (pm_power_off) {\n\t\tdev_err(&pdev->dev, \"pm_power_off already claimed for %ps\",\n\t\t\tpm_power_off);\n\t\treturn -EBUSY;\n\t}\n\n\tpm_power_off = syscon_poweroff;\n\n\treturn 0;\n}\n\nstatic int syscon_poweroff_remove(struct platform_device *pdev)\n{\n\tif (pm_power_off == syscon_poweroff)\n\t\tpm_power_off = NULL;\n\n\treturn 0;\n}\n\nstatic const struct of_device_id syscon_poweroff_of_match[] = {\n\t{ .compatible = \"syscon-poweroff\" },\n\t{}\n};\n\nstatic struct platform_driver syscon_poweroff_driver = {\n\t.probe = syscon_poweroff_probe,\n\t.remove = syscon_poweroff_remove,\n\t.driver = {\n\t\t.name = \"syscon-poweroff\",\n\t\t.of_match_table = syscon_poweroff_of_match,\n\t},\n};\n\nstatic int __init syscon_poweroff_register(void)\n{\n\treturn platform_driver_register(&syscon_poweroff_driver);\n}\ndevice_initcall(syscon_poweroff_register);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}