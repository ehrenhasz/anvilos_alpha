{
  "module_name": "regulator-poweroff.c",
  "hash_id": "d3591ee79ab96c71cae2761a0627af9ed6cb0de3a32b42d0b01755cf29d33359",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/regulator-poweroff.c",
  "human_readable_source": "\n \n#include <linux/delay.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/pm.h>\n#include <linux/regulator/consumer.h>\n\n#define TIMEOUT_MS 3000\n\n \nstatic struct regulator *cpu_regulator;\n\nstatic void regulator_poweroff_do_poweroff(void)\n{\n\tif (cpu_regulator && regulator_is_enabled(cpu_regulator))\n\t\tregulator_force_disable(cpu_regulator);\n\n\t \n\tmdelay(TIMEOUT_MS);\n\n\tWARN_ON(1);\n}\n\nstatic int regulator_poweroff_probe(struct platform_device *pdev)\n{\n\t \n\tif (pm_power_off != NULL) {\n\t\tdev_err(&pdev->dev,\n\t\t\t\"%s: pm_power_off function already registered\\n\",\n\t\t\t__func__);\n\t\treturn -EBUSY;\n\t}\n\n\tcpu_regulator = devm_regulator_get(&pdev->dev, \"cpu\");\n\tif (IS_ERR(cpu_regulator))\n\t\treturn PTR_ERR(cpu_regulator);\n\n\tpm_power_off = &regulator_poweroff_do_poweroff;\n\treturn 0;\n}\n\nstatic int regulator_poweroff_remove(__maybe_unused struct platform_device *pdev)\n{\n\tif (pm_power_off == &regulator_poweroff_do_poweroff)\n\t\tpm_power_off = NULL;\n\n\treturn 0;\n}\n\nstatic const struct of_device_id of_regulator_poweroff_match[] = {\n\t{ .compatible = \"regulator-poweroff\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, of_regulator_poweroff_match);\n\nstatic struct platform_driver regulator_poweroff_driver = {\n\t.probe = regulator_poweroff_probe,\n\t.remove = regulator_poweroff_remove,\n\t.driver = {\n\t\t.name = \"poweroff-regulator\",\n\t\t.of_match_table = of_regulator_poweroff_match,\n\t},\n};\n\nmodule_platform_driver(regulator_poweroff_driver);\n\nMODULE_AUTHOR(\"Michael Klein <michael@fossekall.de>\");\nMODULE_DESCRIPTION(\"Regulator poweroff driver\");\nMODULE_ALIAS(\"platform:poweroff-regulator\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}