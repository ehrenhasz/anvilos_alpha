{
  "module_name": "tps65086-restart.c",
  "hash_id": "eee5007bbc9dba240df01c5fd6e6946715cf08f79ebc552249de9ff6db1d8c32",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/tps65086-restart.c",
  "human_readable_source": "\n \n\n#include <linux/mfd/tps65086.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/reboot.h>\n\nstruct tps65086_restart {\n\tstruct notifier_block handler;\n\tstruct device *dev;\n};\n\nstatic int tps65086_restart_notify(struct notifier_block *this,\n\t\t\t\t   unsigned long mode, void *cmd)\n{\n\tstruct tps65086_restart *tps65086_restart =\n\t\tcontainer_of(this, struct tps65086_restart, handler);\n\tstruct tps65086 *tps65086 = dev_get_drvdata(tps65086_restart->dev->parent);\n\tint ret;\n\n\tret = regmap_write(tps65086->regmap, TPS65086_FORCESHUTDN, 1);\n\tif (ret) {\n\t\tdev_err(tps65086_restart->dev, \"%s: error writing to tps65086 pmic: %d\\n\",\n\t\t\t__func__, ret);\n\t\treturn NOTIFY_DONE;\n\t}\n\n\t \n\tmdelay(200);\n\n\tWARN_ON(1);\n\n\treturn NOTIFY_DONE;\n}\n\nstatic int tps65086_restart_probe(struct platform_device *pdev)\n{\n\tstruct tps65086_restart *tps65086_restart;\n\tint ret;\n\n\ttps65086_restart = devm_kzalloc(&pdev->dev, sizeof(*tps65086_restart), GFP_KERNEL);\n\tif (!tps65086_restart)\n\t\treturn -ENOMEM;\n\n\tplatform_set_drvdata(pdev, tps65086_restart);\n\n\ttps65086_restart->handler.notifier_call = tps65086_restart_notify;\n\ttps65086_restart->handler.priority = 192;\n\ttps65086_restart->dev = &pdev->dev;\n\n\tret = register_restart_handler(&tps65086_restart->handler);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"%s: cannot register restart handler: %d\\n\",\n\t\t\t__func__, ret);\n\t\treturn -ENODEV;\n\t}\n\n\treturn 0;\n}\n\nstatic int tps65086_restart_remove(struct platform_device *pdev)\n{\n\tstruct tps65086_restart *tps65086_restart = platform_get_drvdata(pdev);\n\tint ret;\n\n\tret = unregister_restart_handler(&tps65086_restart->handler);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"%s: cannot unregister restart handler: %d\\n\",\n\t\t\t__func__, ret);\n\t\treturn -ENODEV;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct platform_device_id tps65086_restart_id_table[] = {\n\t{ \"tps65086-reset\", },\n\t{   }\n};\nMODULE_DEVICE_TABLE(platform, tps65086_restart_id_table);\n\nstatic struct platform_driver tps65086_restart_driver = {\n\t.driver = {\n\t\t.name = \"tps65086-restart\",\n\t},\n\t.probe = tps65086_restart_probe,\n\t.remove = tps65086_restart_remove,\n\t.id_table = tps65086_restart_id_table,\n};\nmodule_platform_driver(tps65086_restart_driver);\n\nMODULE_AUTHOR(\"Emil Renner Berthing <kernel@esmil.dk>\");\nMODULE_DESCRIPTION(\"TPS65086 restart driver\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}