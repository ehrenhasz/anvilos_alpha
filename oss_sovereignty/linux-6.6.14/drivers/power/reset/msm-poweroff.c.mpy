{
  "module_name": "msm-poweroff.c",
  "hash_id": "1d0eac89e62589db88ccdb2372de6d85749f9312c25be7a570e8c44c57d508ea",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/msm-poweroff.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/err.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/module.h>\n#include <linux/reboot.h>\n#include <linux/pm.h>\n\nstatic void __iomem *msm_ps_hold;\nstatic int deassert_pshold(struct notifier_block *nb, unsigned long action,\n\t\t\t   void *data)\n{\n\twritel(0, msm_ps_hold);\n\tmdelay(10000);\n\n\treturn NOTIFY_DONE;\n}\n\nstatic struct notifier_block restart_nb = {\n\t.notifier_call = deassert_pshold,\n\t.priority = 128,\n};\n\nstatic void do_msm_poweroff(void)\n{\n\tdeassert_pshold(&restart_nb, 0, NULL);\n}\n\nstatic int msm_restart_probe(struct platform_device *pdev)\n{\n\tmsm_ps_hold = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(msm_ps_hold))\n\t\treturn PTR_ERR(msm_ps_hold);\n\n\tregister_restart_handler(&restart_nb);\n\n\tpm_power_off = do_msm_poweroff;\n\n\treturn 0;\n}\n\nstatic const struct of_device_id of_msm_restart_match[] = {\n\t{ .compatible = \"qcom,pshold\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, of_msm_restart_match);\n\nstatic struct platform_driver msm_restart_driver = {\n\t.probe = msm_restart_probe,\n\t.driver = {\n\t\t.name = \"msm-restart\",\n\t\t.of_match_table = of_match_ptr(of_msm_restart_match),\n\t},\n};\n\nstatic int __init msm_restart_init(void)\n{\n\treturn platform_driver_register(&msm_restart_driver);\n}\ndevice_initcall(msm_restart_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}