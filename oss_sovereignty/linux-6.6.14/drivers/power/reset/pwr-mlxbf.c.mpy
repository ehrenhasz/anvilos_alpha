{
  "module_name": "pwr-mlxbf.c",
  "hash_id": "19403d30da853d03d430e39140f36988a380b0d622b88ccf9c01ea4da7eeb5c3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/pwr-mlxbf.c",
  "human_readable_source": "\n\n \n\n#include <linux/acpi.h>\n#include <linux/device.h>\n#include <linux/devm-helpers.h>\n#include <linux/interrupt.h>\n#include <linux/kernel.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/pm.h>\n#include <linux/reboot.h>\n#include <linux/types.h>\n\nstruct pwr_mlxbf {\n\tstruct work_struct send_work;\n\tconst char *hid;\n};\n\nstatic void pwr_mlxbf_send_work(struct work_struct *work)\n{\n\tacpi_bus_generate_netlink_event(\"button/power.*\", \"Power Button\", 0x80, 1);\n}\n\nstatic irqreturn_t pwr_mlxbf_irq(int irq, void *ptr)\n{\n\tconst char *rst_pwr_hid = \"MLNXBF24\";\n\tconst char *low_pwr_hid = \"MLNXBF29\";\n\tstruct pwr_mlxbf *priv = ptr;\n\n\tif (!strncmp(priv->hid, rst_pwr_hid, 8))\n\t\temergency_restart();\n\n\tif (!strncmp(priv->hid, low_pwr_hid, 8))\n\t\tschedule_work(&priv->send_work);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int pwr_mlxbf_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct acpi_device *adev;\n\tstruct pwr_mlxbf *priv;\n\tconst char *hid;\n\tint irq, err;\n\n\tpriv = devm_kzalloc(dev, sizeof(*priv), GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tadev = ACPI_COMPANION(dev);\n\tif (!adev)\n\t\treturn -ENXIO;\n\n\thid = acpi_device_hid(adev);\n\tpriv->hid = hid;\n\n\tirq = acpi_dev_gpio_irq_get(ACPI_COMPANION(dev), 0);\n\tif (irq < 0)\n\t\treturn dev_err_probe(dev, irq, \"Error getting %s irq.\\n\", priv->hid);\n\n\terr = devm_work_autocancel(dev, &priv->send_work, pwr_mlxbf_send_work);\n\tif (err)\n\t\treturn err;\n\n\terr = devm_request_irq(dev, irq, pwr_mlxbf_irq, 0, hid, priv);\n\tif (err)\n\t\tdev_err(dev, \"Failed request of %s irq\\n\", priv->hid);\n\n\treturn err;\n}\n\nstatic const struct acpi_device_id __maybe_unused pwr_mlxbf_acpi_match[] = {\n\t{ \"MLNXBF24\", 0 },\n\t{ \"MLNXBF29\", 0 },\n\t{},\n};\nMODULE_DEVICE_TABLE(acpi, pwr_mlxbf_acpi_match);\n\nstatic struct platform_driver pwr_mlxbf_driver = {\n\t.driver = {\n\t\t.name = \"pwr_mlxbf\",\n\t\t.acpi_match_table = pwr_mlxbf_acpi_match,\n\t},\n\t.probe    = pwr_mlxbf_probe,\n};\n\nmodule_platform_driver(pwr_mlxbf_driver);\n\nMODULE_DESCRIPTION(\"Mellanox BlueField power driver\");\nMODULE_AUTHOR(\"Asmaa Mnebhi <asmaa@nvidia.com>\");\nMODULE_LICENSE(\"Dual BSD/GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}