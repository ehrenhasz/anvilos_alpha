{
  "module_name": "as3722-poweroff.c",
  "hash_id": "76a79fb3c9c709b6c1c9ccbb40f8f03ed34b8d08ff49a0927c21d8419f1abeef",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/as3722-poweroff.c",
  "human_readable_source": "\n \n\n#include <linux/mfd/as3722.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/slab.h>\n\nstruct as3722_poweroff {\n\tstruct device *dev;\n\tstruct as3722 *as3722;\n};\n\nstatic struct as3722_poweroff *as3722_pm_poweroff;\n\nstatic void as3722_pm_power_off(void)\n{\n\tint ret;\n\n\tif (!as3722_pm_poweroff) {\n\t\tpr_err(\"AS3722 poweroff is not initialised\\n\");\n\t\treturn;\n\t}\n\n\tret = as3722_update_bits(as3722_pm_poweroff->as3722,\n\t\tAS3722_RESET_CONTROL_REG, AS3722_POWER_OFF, AS3722_POWER_OFF);\n\tif (ret < 0)\n\t\tdev_err(as3722_pm_poweroff->dev,\n\t\t\t\"RESET_CONTROL_REG update failed, %d\\n\", ret);\n}\n\nstatic int as3722_poweroff_probe(struct platform_device *pdev)\n{\n\tstruct as3722_poweroff *as3722_poweroff;\n\tstruct device_node *np = pdev->dev.parent->of_node;\n\n\tif (!np)\n\t\treturn -EINVAL;\n\n\tif (!of_property_read_bool(np, \"ams,system-power-controller\"))\n\t\treturn 0;\n\n\tas3722_poweroff = devm_kzalloc(&pdev->dev, sizeof(*as3722_poweroff),\n\t\t\t\tGFP_KERNEL);\n\tif (!as3722_poweroff)\n\t\treturn -ENOMEM;\n\n\tas3722_poweroff->as3722 = dev_get_drvdata(pdev->dev.parent);\n\tas3722_poweroff->dev = &pdev->dev;\n\tas3722_pm_poweroff = as3722_poweroff;\n\tif (!pm_power_off)\n\t\tpm_power_off = as3722_pm_power_off;\n\n\treturn 0;\n}\n\nstatic int as3722_poweroff_remove(struct platform_device *pdev)\n{\n\tif (pm_power_off == as3722_pm_power_off)\n\t\tpm_power_off = NULL;\n\tas3722_pm_poweroff = NULL;\n\n\treturn 0;\n}\n\nstatic struct platform_driver as3722_poweroff_driver = {\n\t.driver = {\n\t\t.name = \"as3722-power-off\",\n\t},\n\t.probe = as3722_poweroff_probe,\n\t.remove = as3722_poweroff_remove,\n};\n\nmodule_platform_driver(as3722_poweroff_driver);\n\nMODULE_DESCRIPTION(\"Power off driver for ams AS3722 PMIC Device\");\nMODULE_ALIAS(\"platform:as3722-power-off\");\nMODULE_AUTHOR(\"Laxman Dewangan <ldewangan@nvidia.com>\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}