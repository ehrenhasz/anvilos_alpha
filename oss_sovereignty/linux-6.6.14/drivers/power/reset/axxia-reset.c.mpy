{
  "module_name": "axxia-reset.c",
  "hash_id": "d600df2290bf6f95a885e73ed0fe440113171a00937b1915012181a335fd0892",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/reset/axxia-reset.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/kernel.h>\n#include <linux/mfd/syscon.h>\n#include <linux/module.h>\n#include <linux/notifier.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/reboot.h>\n#include <linux/regmap.h>\n\n#define SC_CRIT_WRITE_KEY\t0x1000\n#define SC_LATCH_ON_RESET\t0x1004\n#define SC_RESET_CONTROL\t0x1008\n#define   RSTCTL_RST_ZERO\t(1<<3)\n#define   RSTCTL_RST_FAB\t(1<<2)\n#define   RSTCTL_RST_CHIP\t(1<<1)\n#define   RSTCTL_RST_SYS\t(1<<0)\n#define SC_EFUSE_INT_STATUS\t0x180c\n#define   EFUSE_READ_DONE\t(1<<31)\n\nstatic struct regmap *syscon;\n\nstatic int axxia_restart_handler(struct notifier_block *this,\n\t\t\t\t unsigned long mode, void *cmd)\n{\n\t \n\tregmap_write(syscon, SC_CRIT_WRITE_KEY, 0xab);\n\t \n\tregmap_write(syscon, SC_LATCH_ON_RESET, 0x00000040);\n\t \n\tregmap_write(syscon, SC_EFUSE_INT_STATUS, EFUSE_READ_DONE);\n\t \n\tregmap_update_bits(syscon, SC_RESET_CONTROL,\n\t\t\t   RSTCTL_RST_CHIP, RSTCTL_RST_CHIP);\n\n\treturn NOTIFY_DONE;\n}\n\nstatic struct notifier_block axxia_restart_nb = {\n\t.notifier_call = axxia_restart_handler,\n\t.priority = 128,\n};\n\nstatic int axxia_reset_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tint err;\n\n\tsyscon = syscon_regmap_lookup_by_phandle(dev->of_node, \"syscon\");\n\tif (IS_ERR(syscon)) {\n\t\tpr_err(\"%pOFn: syscon lookup failed\\n\", dev->of_node);\n\t\treturn PTR_ERR(syscon);\n\t}\n\n\terr = register_restart_handler(&axxia_restart_nb);\n\tif (err)\n\t\tdev_err(dev, \"cannot register restart handler (err=%d)\\n\", err);\n\n\treturn err;\n}\n\nstatic const struct of_device_id of_axxia_reset_match[] = {\n\t{ .compatible = \"lsi,axm55xx-reset\", },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, of_axxia_reset_match);\n\nstatic struct platform_driver axxia_reset_driver = {\n\t.probe = axxia_reset_probe,\n\t.driver = {\n\t\t.name = \"axxia-reset\",\n\t\t.of_match_table = of_match_ptr(of_axxia_reset_match),\n\t},\n};\n\nstatic int __init axxia_reset_init(void)\n{\n\treturn platform_driver_register(&axxia_reset_driver);\n}\ndevice_initcall(axxia_reset_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}