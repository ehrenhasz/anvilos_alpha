{
  "module_name": "da9150-charger.c",
  "hash_id": "d2ac505cb650dcad6e7aebb3cbeaf6a4053ed172db533c0fb7dc512ac357a65c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/supply/da9150-charger.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/interrupt.h>\n#include <linux/power_supply.h>\n#include <linux/notifier.h>\n#include <linux/usb/phy.h>\n#include <linux/iio/consumer.h>\n#include <linux/mfd/da9150/core.h>\n#include <linux/mfd/da9150/registers.h>\n\n \nstruct da9150_charger {\n\tstruct da9150 *da9150;\n\tstruct device *dev;\n\n\tstruct power_supply *usb;\n\tstruct power_supply *battery;\n\tstruct power_supply *supply_online;\n\n\tstruct usb_phy *usb_phy;\n\tstruct notifier_block otg_nb;\n\tstruct work_struct otg_work;\n\tunsigned long usb_event;\n\n\tstruct iio_channel *ibus_chan;\n\tstruct iio_channel *vbus_chan;\n\tstruct iio_channel *tjunc_chan;\n\tstruct iio_channel *vbat_chan;\n};\n\nstatic inline int da9150_charger_supply_online(struct da9150_charger *charger,\n\t\t\t\t\t       struct power_supply *psy,\n\t\t\t\t\t       union power_supply_propval *val)\n{\n\tval->intval = (psy == charger->supply_online) ? 1 : 0;\n\n\treturn 0;\n}\n\n \nstatic int da9150_charger_vbus_voltage_now(struct da9150_charger *charger,\n\t\t\t\t\t   union power_supply_propval *val)\n{\n\tint v_val, ret;\n\n\t \n\tret = iio_read_channel_processed(charger->vbus_chan, &v_val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tval->intval = v_val * 1000;\n\n\treturn 0;\n}\n\nstatic int da9150_charger_ibus_current_avg(struct da9150_charger *charger,\n\t\t\t\t\t   union power_supply_propval *val)\n{\n\tint i_val, ret;\n\n\t \n\tret = iio_read_channel_processed(charger->ibus_chan, &i_val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tval->intval = i_val * 1000;\n\n\treturn 0;\n}\n\nstatic int da9150_charger_tjunc_temp(struct da9150_charger *charger,\n\t\t\t\t     union power_supply_propval *val)\n{\n\tint t_val, ret;\n\n\t \n\tret = iio_read_channel_processed(charger->tjunc_chan, &t_val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t \n\tval->intval = t_val / 100;\n\n\treturn 0;\n}\n\nstatic enum power_supply_property da9150_charger_props[] = {\n\tPOWER_SUPPLY_PROP_ONLINE,\n\tPOWER_SUPPLY_PROP_VOLTAGE_NOW,\n\tPOWER_SUPPLY_PROP_CURRENT_AVG,\n\tPOWER_SUPPLY_PROP_TEMP,\n};\n\nstatic int da9150_charger_get_prop(struct power_supply *psy,\n\t\t\t\t   enum power_supply_property psp,\n\t\t\t\t   union power_supply_propval *val)\n{\n\tstruct da9150_charger *charger = dev_get_drvdata(psy->dev.parent);\n\tint ret;\n\n\tswitch (psp) {\n\tcase POWER_SUPPLY_PROP_ONLINE:\n\t\tret = da9150_charger_supply_online(charger, psy, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_VOLTAGE_NOW:\n\t\tret = da9150_charger_vbus_voltage_now(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_CURRENT_AVG:\n\t\tret = da9150_charger_ibus_current_avg(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_TEMP:\n\t\tret = da9150_charger_tjunc_temp(charger, val);\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\n \nstatic int da9150_charger_battery_status(struct da9150_charger *charger,\n\t\t\t\t\t union power_supply_propval *val)\n{\n\tu8 reg;\n\n\t \n\treg = da9150_reg_read(charger->da9150, DA9150_STATUS_H);\n\n\tif (((reg & DA9150_VBUS_STAT_MASK) == DA9150_VBUS_STAT_OFF) ||\n\t    ((reg & DA9150_VBUS_STAT_MASK) == DA9150_VBUS_STAT_WAIT)) {\n\t\tval->intval = POWER_SUPPLY_STATUS_DISCHARGING;\n\n\t\treturn 0;\n\t}\n\n\treg = da9150_reg_read(charger->da9150, DA9150_STATUS_J);\n\n\t \n\tswitch (reg & DA9150_CHG_STAT_MASK) {\n\tcase DA9150_CHG_STAT_ACT:\n\tcase DA9150_CHG_STAT_PRE:\n\tcase DA9150_CHG_STAT_CC:\n\tcase DA9150_CHG_STAT_CV:\n\t\tval->intval = POWER_SUPPLY_STATUS_CHARGING;\n\t\tbreak;\n\tcase DA9150_CHG_STAT_OFF:\n\tcase DA9150_CHG_STAT_SUSP:\n\tcase DA9150_CHG_STAT_TEMP:\n\tcase DA9150_CHG_STAT_TIME:\n\tcase DA9150_CHG_STAT_BAT:\n\t\tval->intval = POWER_SUPPLY_STATUS_NOT_CHARGING;\n\t\tbreak;\n\tcase DA9150_CHG_STAT_FULL:\n\t\tval->intval = POWER_SUPPLY_STATUS_FULL;\n\t\tbreak;\n\tdefault:\n\t\tval->intval = POWER_SUPPLY_STATUS_UNKNOWN;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int da9150_charger_battery_health(struct da9150_charger *charger,\n\t\t\t\t\t union power_supply_propval *val)\n{\n\tu8 reg;\n\n\treg = da9150_reg_read(charger->da9150, DA9150_STATUS_J);\n\n\t \n\tswitch (reg & DA9150_CHG_TEMP_MASK) {\n\tcase DA9150_CHG_TEMP_UNDER:\n\t\tval->intval = POWER_SUPPLY_HEALTH_COLD;\n\t\treturn 0;\n\tcase DA9150_CHG_TEMP_OVER:\n\t\tval->intval = POWER_SUPPLY_HEALTH_OVERHEAT;\n\t\treturn 0;\n\tdefault:\n\t\tbreak;\n\t}\n\n\t \n\tswitch (reg & DA9150_CHG_STAT_MASK) {\n\tcase DA9150_CHG_STAT_ACT:\n\tcase DA9150_CHG_STAT_PRE:\n\t\tval->intval = POWER_SUPPLY_HEALTH_DEAD;\n\t\tbreak;\n\tcase DA9150_CHG_STAT_TIME:\n\t\tval->intval = POWER_SUPPLY_HEALTH_UNSPEC_FAILURE;\n\t\tbreak;\n\tdefault:\n\t\tval->intval = POWER_SUPPLY_HEALTH_GOOD;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int da9150_charger_battery_present(struct da9150_charger *charger,\n\t\t\t\t\t  union power_supply_propval *val)\n{\n\tu8 reg;\n\n\t \n\treg = da9150_reg_read(charger->da9150, DA9150_STATUS_J);\n\tif ((reg & DA9150_CHG_STAT_MASK) == DA9150_CHG_STAT_BAT)\n\t\tval->intval = 0;\n\telse\n\t\tval->intval = 1;\n\n\treturn 0;\n}\n\nstatic int da9150_charger_battery_charge_type(struct da9150_charger *charger,\n\t\t\t\t\t      union power_supply_propval *val)\n{\n\tu8 reg;\n\n\treg = da9150_reg_read(charger->da9150, DA9150_STATUS_J);\n\n\tswitch (reg & DA9150_CHG_STAT_MASK) {\n\tcase DA9150_CHG_STAT_CC:\n\t\tval->intval = POWER_SUPPLY_CHARGE_TYPE_FAST;\n\t\tbreak;\n\tcase DA9150_CHG_STAT_ACT:\n\tcase DA9150_CHG_STAT_PRE:\n\tcase DA9150_CHG_STAT_CV:\n\t\tval->intval = POWER_SUPPLY_CHARGE_TYPE_TRICKLE;\n\t\tbreak;\n\tdefault:\n\t\tval->intval = POWER_SUPPLY_CHARGE_TYPE_NONE;\n\t\tbreak;\n\t}\n\n\treturn 0;\n}\n\nstatic int da9150_charger_battery_voltage_min(struct da9150_charger *charger,\n\t\t\t\t\t      union power_supply_propval *val)\n{\n\tu8 reg;\n\n\treg = da9150_reg_read(charger->da9150, DA9150_PPR_CHGCTRL_C);\n\n\t \n\tval->intval = ((reg & DA9150_CHG_VFAULT_MASK) * 50000) + 2500000;\n\n\treturn 0;\n}\n\nstatic int da9150_charger_battery_voltage_now(struct da9150_charger *charger,\n\t\t\t\t\t      union power_supply_propval *val)\n{\n\tint v_val, ret;\n\n\t \n\tret = iio_read_channel_processed(charger->vbat_chan, &v_val);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tval->intval = v_val * 1000;\n\n\treturn 0;\n}\n\nstatic int da9150_charger_battery_current_max(struct da9150_charger *charger,\n\t\t\t\t\t      union power_supply_propval *val)\n{\n\tint reg;\n\n\treg = da9150_reg_read(charger->da9150, DA9150_PPR_CHGCTRL_D);\n\n\t \n\tval->intval = reg * 25000;\n\n\treturn 0;\n}\n\nstatic int da9150_charger_battery_voltage_max(struct da9150_charger *charger,\n\t\t\t\t\t      union power_supply_propval *val)\n{\n\tu8 reg;\n\n\treg = da9150_reg_read(charger->da9150, DA9150_PPR_CHGCTRL_B);\n\n\t \n\tval->intval = ((reg & DA9150_CHG_VBAT_MASK) * 25000) + 3650000;\n\treturn 0;\n}\n\nstatic enum power_supply_property da9150_charger_bat_props[] = {\n\tPOWER_SUPPLY_PROP_STATUS,\n\tPOWER_SUPPLY_PROP_ONLINE,\n\tPOWER_SUPPLY_PROP_HEALTH,\n\tPOWER_SUPPLY_PROP_PRESENT,\n\tPOWER_SUPPLY_PROP_CHARGE_TYPE,\n\tPOWER_SUPPLY_PROP_VOLTAGE_MIN_DESIGN,\n\tPOWER_SUPPLY_PROP_VOLTAGE_NOW,\n\tPOWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT_MAX,\n\tPOWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE_MAX,\n};\n\nstatic int da9150_charger_battery_get_prop(struct power_supply *psy,\n\t\t\t\t\t   enum power_supply_property psp,\n\t\t\t\t\t   union power_supply_propval *val)\n{\n\tstruct da9150_charger *charger = dev_get_drvdata(psy->dev.parent);\n\tint ret;\n\n\tswitch (psp) {\n\tcase POWER_SUPPLY_PROP_STATUS:\n\t\tret = da9150_charger_battery_status(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_ONLINE:\n\t\tret = da9150_charger_supply_online(charger, psy, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_HEALTH:\n\t\tret = da9150_charger_battery_health(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_PRESENT:\n\t\tret = da9150_charger_battery_present(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_CHARGE_TYPE:\n\t\tret = da9150_charger_battery_charge_type(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_VOLTAGE_MIN_DESIGN:\n\t\tret = da9150_charger_battery_voltage_min(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_VOLTAGE_NOW:\n\t\tret = da9150_charger_battery_voltage_now(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT_MAX:\n\t\tret = da9150_charger_battery_current_max(charger, val);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE_MAX:\n\t\tret = da9150_charger_battery_voltage_max(charger, val);\n\t\tbreak;\n\tdefault:\n\t\tret = -EINVAL;\n\t\tbreak;\n\t}\n\n\treturn ret;\n}\n\nstatic irqreturn_t da9150_charger_chg_irq(int irq, void *data)\n{\n\tstruct da9150_charger *charger = data;\n\n\tpower_supply_changed(charger->battery);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t da9150_charger_tjunc_irq(int irq, void *data)\n{\n\tstruct da9150_charger *charger = data;\n\n\t \n\tdev_crit(charger->dev, \"TJunc over temperature!!!\\n\");\n\tpower_supply_changed(charger->usb);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t da9150_charger_vfault_irq(int irq, void *data)\n{\n\tstruct da9150_charger *charger = data;\n\n\t \n\tdev_crit(charger->dev, \"VSYS under voltage!!!\\n\");\n\tpower_supply_changed(charger->usb);\n\tpower_supply_changed(charger->battery);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic irqreturn_t da9150_charger_vbus_irq(int irq, void *data)\n{\n\tstruct da9150_charger *charger = data;\n\tu8 reg;\n\n\treg = da9150_reg_read(charger->da9150, DA9150_STATUS_H);\n\n\t \n\tswitch (reg & DA9150_VBUS_STAT_MASK) {\n\tcase DA9150_VBUS_STAT_OFF:\n\tcase DA9150_VBUS_STAT_WAIT:\n\t\tcharger->supply_online = charger->battery;\n\t\tbreak;\n\tcase DA9150_VBUS_STAT_CHG:\n\t\tcharger->supply_online = charger->usb;\n\t\tbreak;\n\tdefault:\n\t\tdev_warn(charger->dev, \"Unknown VBUS state - reg = 0x%x\\n\",\n\t\t\t reg);\n\t\tcharger->supply_online = NULL;\n\t\tbreak;\n\t}\n\n\tpower_supply_changed(charger->usb);\n\tpower_supply_changed(charger->battery);\n\n\treturn IRQ_HANDLED;\n}\n\nstatic void da9150_charger_otg_work(struct work_struct *data)\n{\n\tstruct da9150_charger *charger =\n\t\tcontainer_of(data, struct da9150_charger, otg_work);\n\n\tswitch (charger->usb_event) {\n\tcase USB_EVENT_ID:\n\t\t \n\t\tda9150_set_bits(charger->da9150, DA9150_PPR_BKCTRL_A,\n\t\t\t\tDA9150_VBUS_MODE_MASK, DA9150_VBUS_MODE_OTG);\n\t\tbreak;\n\tcase USB_EVENT_NONE:\n\t\t \n\t\tpower_supply_changed(charger->usb);\n\t\tpower_supply_changed(charger->battery);\n\t\tda9150_set_bits(charger->da9150, DA9150_PPR_BKCTRL_A,\n\t\t\t\tDA9150_VBUS_MODE_MASK, DA9150_VBUS_MODE_CHG);\n\t\tbreak;\n\t}\n}\n\nstatic int da9150_charger_otg_ncb(struct notifier_block *nb, unsigned long val,\n\t\t\t\t  void *priv)\n{\n\tstruct da9150_charger *charger =\n\t\tcontainer_of(nb, struct da9150_charger, otg_nb);\n\n\tdev_dbg(charger->dev, \"DA9150 OTG notify %lu\\n\", val);\n\n\tcharger->usb_event = val;\n\tschedule_work(&charger->otg_work);\n\n\treturn NOTIFY_OK;\n}\n\nstatic int da9150_charger_register_irq(struct platform_device *pdev,\n\t\t\t\t       irq_handler_t handler,\n\t\t\t\t       const char *irq_name)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct da9150_charger *charger = platform_get_drvdata(pdev);\n\tint irq, ret;\n\n\tirq = platform_get_irq_byname(pdev, irq_name);\n\tif (irq < 0)\n\t\treturn irq;\n\n\tret = request_threaded_irq(irq, NULL, handler, IRQF_ONESHOT, irq_name,\n\t\t\t\t   charger);\n\tif (ret)\n\t\tdev_err(dev, \"Failed to request IRQ %d: %d\\n\", irq, ret);\n\n\treturn ret;\n}\n\nstatic void da9150_charger_unregister_irq(struct platform_device *pdev,\n\t\t\t\t\t  const char *irq_name)\n{\n\tstruct da9150_charger *charger = platform_get_drvdata(pdev);\n\tint irq;\n\n\tirq = platform_get_irq_byname(pdev, irq_name);\n\tif (irq < 0)\n\t\treturn;\n\n\tfree_irq(irq, charger);\n}\n\nstatic const struct power_supply_desc usb_desc = {\n\t.name\t\t= \"da9150-usb\",\n\t.type\t\t= POWER_SUPPLY_TYPE_USB,\n\t.properties\t= da9150_charger_props,\n\t.num_properties\t= ARRAY_SIZE(da9150_charger_props),\n\t.get_property\t= da9150_charger_get_prop,\n};\n\nstatic const struct power_supply_desc battery_desc = {\n\t.name\t\t= \"da9150-battery\",\n\t.type\t\t= POWER_SUPPLY_TYPE_BATTERY,\n\t.properties\t= da9150_charger_bat_props,\n\t.num_properties\t= ARRAY_SIZE(da9150_charger_bat_props),\n\t.get_property\t= da9150_charger_battery_get_prop,\n};\n\nstatic int da9150_charger_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct da9150 *da9150 = dev_get_drvdata(dev->parent);\n\tstruct da9150_charger *charger;\n\tu8 reg;\n\tint ret;\n\n\tcharger = devm_kzalloc(dev, sizeof(struct da9150_charger), GFP_KERNEL);\n\tif (!charger)\n\t\treturn -ENOMEM;\n\n\tplatform_set_drvdata(pdev, charger);\n\tcharger->da9150 = da9150;\n\tcharger->dev = dev;\n\n\t \n\tcharger->ibus_chan = iio_channel_get(dev, \"CHAN_IBUS\");\n\tif (IS_ERR(charger->ibus_chan)) {\n\t\tret = PTR_ERR(charger->ibus_chan);\n\t\tgoto ibus_chan_fail;\n\t}\n\n\tcharger->vbus_chan = iio_channel_get(dev, \"CHAN_VBUS\");\n\tif (IS_ERR(charger->vbus_chan)) {\n\t\tret = PTR_ERR(charger->vbus_chan);\n\t\tgoto vbus_chan_fail;\n\t}\n\n\tcharger->tjunc_chan = iio_channel_get(dev, \"CHAN_TJUNC\");\n\tif (IS_ERR(charger->tjunc_chan)) {\n\t\tret = PTR_ERR(charger->tjunc_chan);\n\t\tgoto tjunc_chan_fail;\n\t}\n\n\tcharger->vbat_chan = iio_channel_get(dev, \"CHAN_VBAT\");\n\tif (IS_ERR(charger->vbat_chan)) {\n\t\tret = PTR_ERR(charger->vbat_chan);\n\t\tgoto vbat_chan_fail;\n\t}\n\n\t \n\tcharger->usb = power_supply_register(dev, &usb_desc, NULL);\n\tif (IS_ERR(charger->usb)) {\n\t\tret = PTR_ERR(charger->usb);\n\t\tgoto usb_fail;\n\t}\n\n\tcharger->battery = power_supply_register(dev, &battery_desc, NULL);\n\tif (IS_ERR(charger->battery)) {\n\t\tret = PTR_ERR(charger->battery);\n\t\tgoto battery_fail;\n\t}\n\n\t \n\treg = da9150_reg_read(da9150, DA9150_STATUS_H);\n\n\tswitch (reg & DA9150_VBUS_STAT_MASK) {\n\tcase DA9150_VBUS_STAT_OFF:\n\tcase DA9150_VBUS_STAT_WAIT:\n\t\tcharger->supply_online = charger->battery;\n\t\tbreak;\n\tcase DA9150_VBUS_STAT_CHG:\n\t\tcharger->supply_online = charger->usb;\n\t\tbreak;\n\tdefault:\n\t\tdev_warn(dev, \"Unknown VBUS state - reg = 0x%x\\n\", reg);\n\t\tcharger->supply_online = NULL;\n\t\tbreak;\n\t}\n\n\t \n\tcharger->usb_phy = devm_usb_get_phy(dev, USB_PHY_TYPE_USB2);\n\tif (!IS_ERR_OR_NULL(charger->usb_phy)) {\n\t\tINIT_WORK(&charger->otg_work, da9150_charger_otg_work);\n\t\tcharger->otg_nb.notifier_call = da9150_charger_otg_ncb;\n\t\tusb_register_notifier(charger->usb_phy, &charger->otg_nb);\n\t}\n\n\t \n\tret = da9150_charger_register_irq(pdev, da9150_charger_chg_irq,\n\t\t\t\t\t  \"CHG_STATUS\");\n\tif (ret < 0)\n\t\tgoto chg_irq_fail;\n\n\tret = da9150_charger_register_irq(pdev, da9150_charger_tjunc_irq,\n\t\t\t\t\t  \"CHG_TJUNC\");\n\tif (ret < 0)\n\t\tgoto tjunc_irq_fail;\n\n\tret = da9150_charger_register_irq(pdev, da9150_charger_vfault_irq,\n\t\t\t\t\t  \"CHG_VFAULT\");\n\tif (ret < 0)\n\t\tgoto vfault_irq_fail;\n\n\tret = da9150_charger_register_irq(pdev, da9150_charger_vbus_irq,\n\t\t\t\t\t  \"CHG_VBUS\");\n\tif (ret < 0)\n\t\tgoto vbus_irq_fail;\n\n\treturn 0;\n\n\nvbus_irq_fail:\n\tda9150_charger_unregister_irq(pdev, \"CHG_VFAULT\");\nvfault_irq_fail:\n\tda9150_charger_unregister_irq(pdev, \"CHG_TJUNC\");\ntjunc_irq_fail:\n\tda9150_charger_unregister_irq(pdev, \"CHG_STATUS\");\nchg_irq_fail:\n\tif (!IS_ERR_OR_NULL(charger->usb_phy))\n\t\tusb_unregister_notifier(charger->usb_phy, &charger->otg_nb);\nbattery_fail:\n\tpower_supply_unregister(charger->usb);\n\nusb_fail:\n\tiio_channel_release(charger->vbat_chan);\n\nvbat_chan_fail:\n\tiio_channel_release(charger->tjunc_chan);\n\ntjunc_chan_fail:\n\tiio_channel_release(charger->vbus_chan);\n\nvbus_chan_fail:\n\tiio_channel_release(charger->ibus_chan);\n\nibus_chan_fail:\n\treturn ret;\n}\n\nstatic int da9150_charger_remove(struct platform_device *pdev)\n{\n\tstruct da9150_charger *charger = platform_get_drvdata(pdev);\n\tint irq;\n\n\t \n\tirq = platform_get_irq_byname(pdev, \"CHG_VBUS\");\n\tfree_irq(irq, charger);\n\n\tirq = platform_get_irq_byname(pdev, \"CHG_VFAULT\");\n\tfree_irq(irq, charger);\n\n\tirq = platform_get_irq_byname(pdev, \"CHG_TJUNC\");\n\tfree_irq(irq, charger);\n\n\tirq = platform_get_irq_byname(pdev, \"CHG_STATUS\");\n\tfree_irq(irq, charger);\n\n\tif (!IS_ERR_OR_NULL(charger->usb_phy))\n\t\tusb_unregister_notifier(charger->usb_phy, &charger->otg_nb);\n\tcancel_work_sync(&charger->otg_work);\n\n\tpower_supply_unregister(charger->battery);\n\tpower_supply_unregister(charger->usb);\n\n\t \n\tiio_channel_release(charger->ibus_chan);\n\tiio_channel_release(charger->vbus_chan);\n\tiio_channel_release(charger->tjunc_chan);\n\tiio_channel_release(charger->vbat_chan);\n\n\treturn 0;\n}\n\nstatic struct platform_driver da9150_charger_driver = {\n\t.driver = {\n\t\t.name = \"da9150-charger\",\n\t},\n\t.probe = da9150_charger_probe,\n\t.remove = da9150_charger_remove,\n};\n\nmodule_platform_driver(da9150_charger_driver);\n\nMODULE_DESCRIPTION(\"Charger Driver for DA9150\");\nMODULE_AUTHOR(\"Adam Thomson <Adam.Thomson.Opensource@diasemi.com>\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}