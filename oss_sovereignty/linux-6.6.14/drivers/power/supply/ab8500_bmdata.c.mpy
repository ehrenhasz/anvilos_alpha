{
  "module_name": "ab8500_bmdata.c",
  "hash_id": "314ef8f064ac299d18b7e30e24fd55b2bee3ea5796dd90bdfd3156cf5db3aa74",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/supply/ab8500_bmdata.c",
  "human_readable_source": "\n#include <linux/export.h>\n#include <linux/power_supply.h>\n#include <linux/of.h>\n\n#include \"ab8500-bm.h\"\n\n \n#define AB8500_TEMP_UNDER\t3\n \n#define AB8500_TEMP_LOW\t\t8\n \n#define AB8500_TEMP_HIGH\t43\n \n#define AB8500_TEMP_OVER\t48\n \n#define AB8500_TEMP_HYSTERESIS\t3\n\nstatic struct power_supply_battery_ocv_table ocv_cap_tbl[] = {\n\t{ .ocv = 4186000, .capacity = 100},\n\t{ .ocv = 4163000, .capacity = 99},\n\t{ .ocv = 4114000, .capacity = 95},\n\t{ .ocv = 4068000, .capacity = 90},\n\t{ .ocv = 3990000, .capacity = 80},\n\t{ .ocv = 3926000, .capacity = 70},\n\t{ .ocv = 3898000, .capacity = 65},\n\t{ .ocv = 3866000, .capacity = 60},\n\t{ .ocv = 3833000, .capacity = 55},\n\t{ .ocv = 3812000, .capacity = 50},\n\t{ .ocv = 3787000, .capacity = 40},\n\t{ .ocv = 3768000, .capacity = 30},\n\t{ .ocv = 3747000, .capacity = 25},\n\t{ .ocv = 3730000, .capacity = 20},\n\t{ .ocv = 3705000, .capacity = 15},\n\t{ .ocv = 3699000, .capacity = 14},\n\t{ .ocv = 3684000, .capacity = 12},\n\t{ .ocv = 3672000, .capacity = 9},\n\t{ .ocv = 3657000, .capacity = 7},\n\t{ .ocv = 3638000, .capacity = 6},\n\t{ .ocv = 3556000, .capacity = 4},\n\t{ .ocv = 3424000, .capacity = 2},\n\t{ .ocv = 3317000, .capacity = 1},\n\t{ .ocv = 3094000, .capacity = 0},\n};\n\n \nstatic struct power_supply_resistance_temp_table temp_to_batres_tbl_thermistor[] = {\n\t{ .temp = 40, .resistance = 40   },\n\t{ .temp = 30, .resistance = 45   },\n\t{ .temp = 20, .resistance = 55   },\n\t{ .temp = 10, .resistance = 77   },\n\t{ .temp = 00, .resistance = 108   },\n\t{ .temp = -10, .resistance = 158   },\n\t{ .temp = -20, .resistance = 198   },\n};\n\nstatic struct power_supply_maintenance_charge_table ab8500_maint_charg_table[] = {\n\t{\n\t\t \n\t\t.charge_current_max_ua = 400000,\n\t\t.charge_voltage_max_uv = 4050000,\n\t\t.charge_safety_timer_minutes = 60*60,\n\t},\n\t{\n\t\t \n\t\t.charge_current_max_ua = 400000,\n\t\t.charge_voltage_max_uv = 4000000,\n\t\t.charge_safety_timer_minutes = 200*60,\n\t}\n};\n\nstatic const struct ab8500_bm_capacity_levels cap_levels = {\n\t.critical\t= 2,\n\t.low\t\t= 10,\n\t.normal\t\t= 70,\n\t.high\t\t= 95,\n\t.full\t\t= 100,\n};\n\nstatic const struct ab8500_fg_parameters fg = {\n\t.recovery_sleep_timer = 10,\n\t.recovery_total_time = 100,\n\t.init_timer = 1,\n\t.init_discard_time = 5,\n\t.init_total_time = 40,\n\t.high_curr_time = 60,\n\t.accu_charging = 30,\n\t.accu_high_curr = 30,\n\t.high_curr_threshold_ua = 50000,\n\t.lowbat_threshold_uv = 3100000,\n\t.battok_falling_th_sel0 = 2860,\n\t.battok_raising_th_sel1 = 2860,\n\t.maint_thres = 95,\n\t.user_cap_limit = 15,\n\t.pcut_enable = 1,\n\t.pcut_max_time = 127,\n\t.pcut_flag_time = 112,\n\t.pcut_max_restart = 15,\n\t.pcut_debounce_time = 2,\n};\n\nstatic const struct ab8500_maxim_parameters ab8500_maxi_params = {\n\t.ena_maxi = true,\n\t.chg_curr_ua = 910000,\n\t.wait_cycles = 10,\n\t.charger_curr_step_ua = 100000,\n};\n\nstatic const struct ab8500_bm_charger_parameters chg = {\n\t.usb_volt_max_uv\t= 5500000,\n\t.usb_curr_max_ua\t= 1500000,\n\t.ac_volt_max_uv\t\t= 7500000,\n\t.ac_curr_max_ua\t\t= 1500000,\n};\n\n \nstruct ab8500_bm_data ab8500_bm_data = {\n\t.main_safety_tmr_h      = 4,\n\t.temp_interval_chg      = 20,\n\t.temp_interval_nochg    = 120,\n\t.usb_safety_tmr_h       = 4,\n\t.bkup_bat_v             = BUP_VCH_SEL_2P6V,\n\t.bkup_bat_i             = BUP_ICH_SEL_150UA,\n\t.capacity_scaling       = false,\n\t.chg_unknown_bat        = false,\n\t.enable_overshoot       = false,\n\t.fg_res                 = 100,\n\t.cap_levels             = &cap_levels,\n\t.interval_charging      = 5,\n\t.interval_not_charging  = 120,\n\t.maxi                   = &ab8500_maxi_params,\n\t.chg_params             = &chg,\n\t.fg_params              = &fg,\n};\n\nint ab8500_bm_of_probe(struct power_supply *psy,\n\t\t       struct ab8500_bm_data *bm)\n{\n\tstruct power_supply_battery_info *bi;\n\tstruct device *dev = &psy->dev;\n\tint ret;\n\n\tret = power_supply_get_battery_info(psy, &bm->bi);\n\tif (ret) {\n\t\tdev_err(dev, \"cannot retrieve battery info\\n\");\n\t\treturn ret;\n\t}\n\tbi = bm->bi;\n\n\t \n\tif (bi->charge_full_design_uah < 0)\n\t\t \n\t\tbi->charge_full_design_uah = 612000;\n\n\t \n\tif ((bi->voltage_min_design_uv < 0) ||\n\t    (bi->voltage_max_design_uv < 0)) {\n\t\t \n\t\tbi->voltage_min_design_uv = 3700000;\n\t\t \n\t\tbi->voltage_max_design_uv = 4050000;\n\t}\n\n\tif (bi->constant_charge_current_max_ua < 0)\n\t\tbi->constant_charge_current_max_ua = 400000;\n\n\tif (bi->constant_charge_voltage_max_uv < 0)\n\t\tbi->constant_charge_voltage_max_uv = 4100000;\n\n\tif (bi->charge_term_current_ua)\n\t\t \n\t\tbi->charge_term_current_ua = 200000;\n\n\tif (!bi->maintenance_charge || !bi->maintenance_charge_size) {\n\t\tbi->maintenance_charge = ab8500_maint_charg_table;\n\t\tbi->maintenance_charge_size = ARRAY_SIZE(ab8500_maint_charg_table);\n\t}\n\n\tif (bi->alert_low_temp_charge_current_ua < 0 ||\n\t    bi->alert_low_temp_charge_voltage_uv < 0)\n\t{\n\t\tbi->alert_low_temp_charge_current_ua = 300000;\n\t\tbi->alert_low_temp_charge_voltage_uv = 4000000;\n\t}\n\tif (bi->alert_high_temp_charge_current_ua < 0 ||\n\t    bi->alert_high_temp_charge_voltage_uv < 0)\n\t{\n\t\tbi->alert_high_temp_charge_current_ua = 300000;\n\t\tbi->alert_high_temp_charge_voltage_uv = 4000000;\n\t}\n\n\t \n\tif ((bi->factory_internal_resistance_uohm < 0) ||\n\t    !bi->resist_table) {\n\t\tbi->factory_internal_resistance_uohm = 300000;\n\t\tbi->resist_table = temp_to_batres_tbl_thermistor;\n\t\tbi->resist_table_size = ARRAY_SIZE(temp_to_batres_tbl_thermistor);\n\t}\n\n\t \n\tif (bi->bti_resistance_ohm < 0 ||\n\t    bi->bti_resistance_tolerance < 0) {\n\t\tbi->bti_resistance_ohm = 7000;\n\t\tbi->bti_resistance_tolerance = 20;\n\t}\n\n\tif (!bi->ocv_table[0]) {\n\t\t \n\t\tbi->ocv_temp[0] = 25;\n\t\tbi->ocv_table[0] = ocv_cap_tbl;\n\t\tbi->ocv_table_size[0] = ARRAY_SIZE(ocv_cap_tbl);\n\t}\n\n\tif (bi->temp_min == INT_MIN)\n\t\tbi->temp_min = AB8500_TEMP_UNDER;\n\tif (bi->temp_max == INT_MAX)\n\t\tbi->temp_max = AB8500_TEMP_OVER;\n\tif (bi->temp_alert_min == INT_MIN)\n\t\tbi->temp_alert_min = AB8500_TEMP_LOW;\n\tif (bi->temp_alert_max == INT_MAX)\n\t\tbi->temp_alert_max = AB8500_TEMP_HIGH;\n\tbm->temp_hysteresis = AB8500_TEMP_HYSTERESIS;\n\n\treturn 0;\n}\n\nvoid ab8500_bm_of_remove(struct power_supply *psy,\n\t\t\t struct ab8500_bm_data *bm)\n{\n\tpower_supply_put_battery_info(psy, bm->bi);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}