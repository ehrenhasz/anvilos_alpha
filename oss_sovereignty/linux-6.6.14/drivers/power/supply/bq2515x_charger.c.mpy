{
  "module_name": "bq2515x_charger.c",
  "hash_id": "dece02c166f53b3082e2e7cc00da897b495e05f02105875b13146d0b9bbeaf96",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/supply/bq2515x_charger.c",
  "human_readable_source": "\n\n\n\n#include <linux/err.h>\n#include <linux/i2c.h>\n#include <linux/init.h>\n#include <linux/kernel.h>\n#include <linux/module.h>\n#include <linux/gpio/consumer.h>\n#include <linux/power_supply.h>\n#include <linux/regmap.h>\n#include <linux/types.h>\n\n#define BQ2515X_MANUFACTURER \"Texas Instruments\"\n\n#define BQ2515X_STAT0\t\t0x00\n#define BQ2515X_STAT1\t\t0x01\n#define BQ2515X_STAT2\t\t0x02\n#define BQ2515X_FLAG0\t\t0x03\n#define BQ2515X_FLAG1\t\t0x04\n#define BQ2515X_FLAG2\t\t0x05\n#define BQ2515X_FLAG3\t\t0x06\n#define BQ2515X_MASK0\t\t0x07\n#define BQ2515X_MASK1\t\t0x08\n#define BQ2515X_MASK2\t\t0x09\n#define BQ2515X_MASK3\t\t0x0a\n#define BQ2515X_VBAT_CTRL\t0x12\n#define BQ2515X_ICHG_CTRL\t0x13\n#define BQ2515X_PCHRGCTRL\t0x14\n#define BQ2515X_TERMCTRL\t0x15\n#define BQ2515X_BUVLO\t\t0x16\n#define BQ2515X_CHARGERCTRL0\t0x17\n#define BQ2515X_CHARGERCTRL1\t0x18\n#define BQ2515X_ILIMCTRL\t0x19\n#define BQ2515X_LDOCTRL\t\t0x1d\n#define BQ2515X_MRCTRL\t\t0x30\n#define BQ2515X_ICCTRL0\t\t0x35\n#define BQ2515X_ICCTRL1\t\t0x36\n#define BQ2515X_ICCTRL2\t\t0x37\n#define BQ2515X_ADCCTRL0\t0x40\n#define BQ2515X_ADCCTRL1\t0x41\n#define BQ2515X_ADC_VBAT_M\t0x42\n#define BQ2515X_ADC_VBAT_L\t0x43\n#define BQ2515X_ADC_TS_M\t0x44\n#define BQ2515X_ADC_TS_L\t0x45\n#define BQ2515X_ADC_ICHG_M\t0x46\n#define BQ2515X_ADC_ICHG_L\t0x47\n#define BQ2515X_ADC_ADCIN_M\t0x48\n#define BQ2515X_ADC_ADCIN_L\t0x49\n#define BQ2515X_ADC_VIN_M\t0x4a\n#define BQ2515X_ADC_VIN_L\t0x4b\n#define BQ2515X_ADC_PMID_M\t0x4c\n#define BQ2515X_ADC_PMID_L\t0x4d\n#define BQ2515X_ADC_IIN_M\t0x4e\n#define BQ2515X_ADC_IIN_L\t0x4f\n#define BQ2515X_ADC_COMP1_M\t0x52\n#define BQ2515X_ADC_COMP1_L\t0X53\n#define BQ2515X_ADC_COMP2_M\t0X54\n#define BQ2515X_ADC_COMP2_L\t0x55\n#define BQ2515X_ADC_COMP3_M\t0x56\n#define BQ2515X_ADC_COMP3_L\t0x57\n#define BQ2515X_ADC_READ_EN\t0x58\n#define BQ2515X_TS_FASTCHGCTRL\t0x61\n#define BQ2515X_TS_COLD\t\t0x62\n#define BQ2515X_TS_COOL\t\t0x63\n#define BQ2515X_TS_WARM\t\t0x64\n#define BQ2515X_TS_HOT\t\t0x65\n#define BQ2515X_DEVICE_ID\t0x6f\n\n#define BQ2515X_DEFAULT_ICHG_UA\t\t10000\n#define BQ25150_DEFAULT_ILIM_UA\t\t100000\n#define BQ25155_DEFAULT_ILIM_UA\t\t500000\n#define BQ2515X_DEFAULT_VBAT_REG_UV\t4200000\n#define BQ2515X_DEFAULT_IPRECHARGE_UA\t2500\n\n#define BQ2515X_DIVISOR\t\t\t\t65536\n#define BQ2515X_VBAT_BASE_VOLT\t\t\t3600000\n#define BQ2515X_VBAT_REG_MAX\t\t\t4600000\n#define BQ2515X_VBAT_REG_MIN\t\t\t3600000\n#define BQ2515X_VBAT_STEP_UV\t\t\t10000\n#define BQ2515X_UV_FACTOR\t\t\t1000000\n#define BQ2515X_VBAT_MULTIPLIER\t\t\t6\n#define BQ2515X_ICHG_DIVISOR\t\t\t52429\n#define BQ2515X_ICHG_CURR_STEP_THRESH_UA\t318750\n#define BQ2515X_ICHG_MIN_UA\t\t\t0\n#define BQ2515X_ICHG_MAX_UA\t\t\t500000\n#define BQ2515X_ICHG_RNG_1B0_UA\t\t\t1250\n#define BQ2515X_ICHG_RNG_1B1_UA\t\t\t2500\n#define BQ2515X_VLOWV_SEL_1B0_UV\t\t3000000\n#define BQ2515X_VLOWV_SEL_1B1_UV\t\t2800000\n#define BQ2515X_PRECHRG_ICHRG_RNGE_1875_UA\t18750\n#define BQ2515X_PRECHRG_ICHRG_RNGE_3750_UA\t37500\n#define BQ2515X_TWAKE2_MIN_US\t\t\t1700000\n#define BQ2515X_TWAKE2_MAX_US\t\t\t2300000\n\n#define BQ2515X_ILIM_150MA\t0x2\n#define BQ2515X_ILIM_MASK\t0x7\n#define BQ2515X_ILIM_MIN\t50000\n#define BQ2515X_ILIM_MAX\t600000\n#define BQ2515X_HEALTH_MASK\t0xf\n#define BQ2515X_ICHGRNG_MASK\t0x80\n#define BQ2515X_STAT0_MASK\t0x0f\n#define BQ2515X_STAT1_MASK\t0x1f\n#define BQ2515X_PRECHARGE_MASK\t0x1f\n\n#define BQ2515X_TS_HOT_STAT\t\tBIT(0)\n#define BQ2515X_TS_WARM_STAT\t\tBIT(1)\n#define BQ2515X_TS_COOL_STAT\t\tBIT(2)\n#define BQ2515X_TS_COLD_STAT\t\tBIT(3)\n#define BQ2515X_SAFETY_TIMER_EXP\tBIT(5)\n\n#define BQ2515X_EN_VBAT_READ\t\tBIT(3)\n#define BQ2515X_EN_ICHG_READ\t\tBIT(5)\n\n#define BQ2515X_VIN_GOOD\t\tBIT(0)\n#define BQ2515X_CHRG_DONE\t\tBIT(5)\n#define BQ2515X_CV_CHRG_MODE\t\tBIT(6)\n\n#define BQ2515X_VIN_OVP_FAULT_STAT\tBIT(7)\n\n#define BQ2515X_WATCHDOG_DISABLE\tBIT(4)\n\n#define BQ2515X_ICHARGE_RANGE\t\tBIT(7)\n\n#define BQ2515X_VLOWV_SEL\t\tBIT(5)\n\n#define BQ2515X_CHARGER_DISABLE\t\tBIT(0)\n\n#define BQ2515X_HWRESET_14S_WD\t\tBIT(1)\n\nstatic const int bq2515x_ilim_lvl_values[] = {\n\t50000, 100000, 150000, 200000, 300000, 400000, 500000, 600000\n};\n\n \nstruct bq2515x_init_data {\n\tint ilim;\n\tint ichg;\n\tint vbatreg;\n\tint iprechg;\n};\n\nenum bq2515x_id {\n\tBQ25150,\n\tBQ25155,\n};\n\n \nstruct bq2515x_device {\n\tstruct power_supply *mains;\n\tstruct power_supply *battery;\n\tstruct regmap *regmap;\n\tstruct device *dev;\n\n\tstruct gpio_desc *reset_gpio;\n\tstruct gpio_desc *powerdown_gpio;\n\tstruct gpio_desc *ac_detect_gpio;\n\tstruct gpio_desc *ce_gpio;\n\n\tchar model_name[I2C_NAME_SIZE];\n\tint device_id;\n\tbool mains_online;\n\n\tstruct bq2515x_init_data init_data;\n};\n\nstatic const struct reg_default bq25150_reg_defaults[] = {\n\t{BQ2515X_FLAG0, 0x0},\n\t{BQ2515X_FLAG1, 0x0},\n\t{BQ2515X_FLAG2, 0x0},\n\t{BQ2515X_FLAG3, 0x0},\n\t{BQ2515X_MASK0, 0x0},\n\t{BQ2515X_MASK1, 0x0},\n\t{BQ2515X_MASK2, 0x71},\n\t{BQ2515X_MASK3, 0x0},\n\t{BQ2515X_VBAT_CTRL, 0x3C},\n\t{BQ2515X_ICHG_CTRL, 0x8},\n\t{BQ2515X_PCHRGCTRL, 0x2},\n\t{BQ2515X_TERMCTRL, 0x14},\n\t{BQ2515X_BUVLO, 0x0},\n\t{BQ2515X_CHARGERCTRL0, 0x82},\n\t{BQ2515X_CHARGERCTRL1, 0x42},\n\t{BQ2515X_ILIMCTRL, 0x1},\n\t{BQ2515X_LDOCTRL, 0xB0},\n\t{BQ2515X_MRCTRL, 0x2A},\n\t{BQ2515X_ICCTRL0, 0x10},\n\t{BQ2515X_ICCTRL1, 0x0},\n\t{BQ2515X_ICCTRL2, 0x0},\n\t{BQ2515X_ADCCTRL0, 0x2},\n\t{BQ2515X_ADCCTRL1, 0x40},\n\t{BQ2515X_ADC_COMP1_M, 0x23},\n\t{BQ2515X_ADC_COMP1_L, 0x20},\n\t{BQ2515X_ADC_COMP2_M, 0x38},\n\t{BQ2515X_ADC_COMP2_L, 0x90},\n\t{BQ2515X_ADC_COMP3_M, 0x0},\n\t{BQ2515X_ADC_COMP3_L, 0x0},\n\t{BQ2515X_ADC_READ_EN, 0x0},\n\t{BQ2515X_TS_FASTCHGCTRL, 0x34},\n\t{BQ2515X_TS_COLD, 0x7C},\n\t{BQ2515X_TS_COOL, 0x6D},\n\t{BQ2515X_TS_WARM, 0x38},\n\t{BQ2515X_TS_HOT, 0x27},\n\t{BQ2515X_DEVICE_ID, 0x20},\n};\n\nstatic const struct reg_default bq25155_reg_defaults[] = {\n\t{BQ2515X_FLAG0, 0x0},\n\t{BQ2515X_FLAG1, 0x0},\n\t{BQ2515X_FLAG2, 0x0},\n\t{BQ2515X_FLAG3, 0x0},\n\t{BQ2515X_MASK0, 0x0},\n\t{BQ2515X_MASK1, 0x0},\n\t{BQ2515X_MASK2, 0x71},\n\t{BQ2515X_MASK3, 0x0},\n\t{BQ2515X_VBAT_CTRL, 0x3C},\n\t{BQ2515X_ICHG_CTRL, 0x8},\n\t{BQ2515X_PCHRGCTRL, 0x2},\n\t{BQ2515X_TERMCTRL, 0x14},\n\t{BQ2515X_BUVLO, 0x0},\n\t{BQ2515X_CHARGERCTRL0, 0x82},\n\t{BQ2515X_CHARGERCTRL1, 0xC2},\n\t{BQ2515X_ILIMCTRL, 0x6},\n\t{BQ2515X_LDOCTRL, 0xB0},\n\t{BQ2515X_MRCTRL, 0x2A},\n\t{BQ2515X_ICCTRL0, 0x10},\n\t{BQ2515X_ICCTRL1, 0x0},\n\t{BQ2515X_ICCTRL2, 0x40},\n\t{BQ2515X_ADCCTRL0, 0x2},\n\t{BQ2515X_ADCCTRL1, 0x40},\n\t{BQ2515X_ADC_COMP1_M, 0x23},\n\t{BQ2515X_ADC_COMP1_L, 0x20},\n\t{BQ2515X_ADC_COMP2_M, 0x38},\n\t{BQ2515X_ADC_COMP2_L, 0x90},\n\t{BQ2515X_ADC_COMP3_M, 0x0},\n\t{BQ2515X_ADC_COMP3_L, 0x0},\n\t{BQ2515X_ADC_READ_EN, 0x0},\n\t{BQ2515X_TS_FASTCHGCTRL, 0x34},\n\t{BQ2515X_TS_COLD, 0x7C},\n\t{BQ2515X_TS_COOL, 0x6D},\n\t{BQ2515X_TS_WARM, 0x38},\n\t{BQ2515X_TS_HOT, 0x27},\n\t{BQ2515X_DEVICE_ID, 0x35},\n};\n\nstatic int bq2515x_wake_up(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tint val;\n\n\t \n\tret = regmap_read(bq2515x->regmap, BQ2515X_STAT0, &val);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tgpiod_set_value_cansleep(bq2515x->powerdown_gpio, 0);\n\n\tgpiod_set_value_cansleep(bq2515x->reset_gpio, 0);\n\tusleep_range(BQ2515X_TWAKE2_MIN_US, BQ2515X_TWAKE2_MAX_US);\n\tgpiod_set_value_cansleep(bq2515x->reset_gpio, 1);\n\n\treturn regmap_write(bq2515x->regmap, BQ2515X_ADC_READ_EN,\n\t\t\t\t(BQ2515X_EN_VBAT_READ | BQ2515X_EN_ICHG_READ));\n}\n\nstatic int bq2515x_update_ps_status(struct bq2515x_device *bq2515x)\n{\n\tbool dc = false;\n\tunsigned int val;\n\tint ret;\n\n\tif (bq2515x->ac_detect_gpio)\n\t\tval = gpiod_get_value_cansleep(bq2515x->ac_detect_gpio);\n\telse {\n\t\tret = regmap_read(bq2515x->regmap, BQ2515X_STAT0, &val);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tdc = val & BQ2515X_VIN_GOOD;\n\n\tret = bq2515x->mains_online != dc;\n\n\tbq2515x->mains_online = dc;\n\n\treturn ret;\n}\n\nstatic int bq2515x_disable_watchdog_timers(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\n\tret = regmap_update_bits(bq2515x->regmap, BQ2515X_CHARGERCTRL0,\n\t\t\tBQ2515X_WATCHDOG_DISABLE, BQ2515X_WATCHDOG_DISABLE);\n\tif (ret)\n\t\treturn ret;\n\n\treturn regmap_update_bits(bq2515x->regmap, BQ2515X_ICCTRL2,\n\t\t\t\t\t\tBQ2515X_HWRESET_14S_WD, 0);\n}\n\nstatic int bq2515x_get_battery_voltage_now(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tint vbat_msb;\n\tint vbat_lsb;\n\tuint32_t vbat_measurement;\n\n\tif (!bq2515x->mains_online)\n\t\tbq2515x_wake_up(bq2515x);\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_ADC_VBAT_M, &vbat_msb);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_ADC_VBAT_L, &vbat_lsb);\n\tif (ret)\n\t\treturn ret;\n\n\tvbat_measurement = (vbat_msb << 8) | vbat_lsb;\n\n\treturn vbat_measurement * (BQ2515X_UV_FACTOR / BQ2515X_DIVISOR) *\n\t\t\t\t\t\tBQ2515X_VBAT_MULTIPLIER;\n}\n\nstatic int bq2515x_get_battery_current_now(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tint ichg_msb;\n\tint ichg_lsb;\n\tuint32_t ichg_measurement;\n\tu16 ichg_multiplier = BQ2515X_ICHG_RNG_1B0_UA;\n\tunsigned int ichg_reg_code, reg_code;\n\tunsigned int icharge_range = 0, pchrgctrl;\n\tunsigned int buvlo, vlowv_sel, vlowv = BQ2515X_VLOWV_SEL_1B0_UV;\n\n\tif (!bq2515x->mains_online)\n\t\treturn -ENODATA;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_ADC_ICHG_M, &ichg_msb);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_ADC_ICHG_L, &ichg_lsb);\n\tif (ret)\n\t\treturn ret;\n\n\tichg_measurement = (ichg_msb << 8) | ichg_lsb;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_BUVLO, &buvlo);\n\tif (ret)\n\t\treturn ret;\n\n\tvlowv_sel = buvlo & BQ2515X_VLOWV_SEL;\n\n\tif (vlowv_sel)\n\t\tvlowv = BQ2515X_VLOWV_SEL_1B1_UV;\n\n\tif (bq2515x_get_battery_voltage_now(bq2515x) < vlowv) {\n\t\tret = regmap_read(bq2515x->regmap, BQ2515X_PCHRGCTRL,\n\t\t\t\t\t\t\t\t&pchrgctrl);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\treg_code = pchrgctrl & BQ2515X_PRECHARGE_MASK;\n\t} else {\n\t\tret = regmap_read(bq2515x->regmap, BQ2515X_ICHG_CTRL,\n\t\t\t\t\t\t\t&ichg_reg_code);\n\t\tif (ret)\n\t\t\treturn ret;\n\n\t\treg_code = ichg_reg_code;\n\t}\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_PCHRGCTRL, &pchrgctrl);\n\tif (ret)\n\t\treturn ret;\n\n\ticharge_range = pchrgctrl & BQ2515X_ICHARGE_RANGE;\n\n\tif (icharge_range)\n\t\tichg_multiplier = BQ2515X_ICHG_RNG_1B1_UA;\n\n\treturn reg_code * (ichg_multiplier * ichg_measurement /\n\t\t\t\t\t\t\tBQ2515X_ICHG_DIVISOR);\n}\n\nstatic bool bq2515x_get_charge_disable(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tint ce_pin;\n\tint icctrl2;\n\tint charger_disable;\n\n\tce_pin = gpiod_get_value_cansleep(bq2515x->ce_gpio);\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_ICCTRL2, &icctrl2);\n\tif (ret)\n\t\treturn ret;\n\n\tcharger_disable = icctrl2 & BQ2515X_CHARGER_DISABLE;\n\n\tif (charger_disable || ce_pin)\n\t\treturn true;\n\n\treturn false;\n}\n\nstatic int bq2515x_set_charge_disable(struct bq2515x_device *bq2515x, int val)\n{\n\tgpiod_set_value_cansleep(bq2515x->ce_gpio, val);\n\n\treturn regmap_update_bits(bq2515x->regmap, BQ2515X_ICCTRL2,\n\t\t\t\t\tBQ2515X_CHARGER_DISABLE, val);\n}\n\nstatic int bq2515x_get_const_charge_current(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tu16 ichg_multiplier = BQ2515X_ICHG_RNG_1B0_UA;\n\tunsigned int ichg_reg_code;\n\tunsigned int pchrgctrl;\n\tunsigned int icharge_range;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_ICHG_CTRL, &ichg_reg_code);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_PCHRGCTRL, &pchrgctrl);\n\tif (ret)\n\t\treturn ret;\n\n\ticharge_range = pchrgctrl & BQ2515X_ICHARGE_RANGE;\n\n\tif (icharge_range)\n\t\tichg_multiplier = BQ2515X_ICHG_RNG_1B1_UA;\n\n\treturn ichg_reg_code * ichg_multiplier;\n}\n\nstatic int bq2515x_set_const_charge_current(struct bq2515x_device *bq2515x,\n\t\t\t\t\t\t\t\tint val)\n{\n\tint ret;\n\tunsigned int ichg_reg_code;\n\tu16 ichg_multiplier = BQ2515X_ICHG_RNG_1B0_UA;\n\tunsigned int icharge_range = 0;\n\n\tif (val > BQ2515X_ICHG_MAX_UA || val < BQ2515X_ICHG_MIN_UA)\n\t\treturn -EINVAL;\n\n\tif (val > BQ2515X_ICHG_CURR_STEP_THRESH_UA) {\n\t\tichg_multiplier = BQ2515X_ICHG_RNG_1B1_UA;\n\t\ticharge_range = BQ2515X_ICHARGE_RANGE;\n\t}\n\n\tbq2515x_set_charge_disable(bq2515x, 1);\n\n\tret = regmap_update_bits(bq2515x->regmap, BQ2515X_PCHRGCTRL,\n\t\t\t\t\tBQ2515X_ICHARGE_RANGE, icharge_range);\n\tif (ret)\n\t\treturn ret;\n\n\tichg_reg_code = val / ichg_multiplier;\n\n\tret = regmap_write(bq2515x->regmap, BQ2515X_ICHG_CTRL, ichg_reg_code);\n\tif (ret)\n\t\treturn ret;\n\n\treturn bq2515x_set_charge_disable(bq2515x, 0);\n}\n\nstatic int bq2515x_get_precharge_current(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tunsigned int pchrgctrl;\n\tunsigned int icharge_range;\n\tu16 precharge_multiplier = BQ2515X_ICHG_RNG_1B0_UA;\n\tunsigned int precharge_reg_code;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_PCHRGCTRL, &pchrgctrl);\n\tif (ret)\n\t\treturn ret;\n\n\ticharge_range = pchrgctrl & BQ2515X_ICHARGE_RANGE;\n\n\tif (icharge_range)\n\t\tprecharge_multiplier = BQ2515X_ICHG_RNG_1B1_UA;\n\n\tprecharge_reg_code = pchrgctrl & BQ2515X_PRECHARGE_MASK;\n\n\treturn precharge_reg_code * precharge_multiplier;\n}\n\nstatic int bq2515x_set_precharge_current(struct bq2515x_device *bq2515x,\n\t\t\t\t\tint val)\n{\n\tint ret;\n\tunsigned int pchrgctrl;\n\tunsigned int icharge_range;\n\tunsigned int precharge_reg_code;\n\tunsigned int precharge_multiplier = BQ2515X_ICHG_RNG_1B0_UA;\n\tunsigned int precharge_max_ua = BQ2515X_PRECHRG_ICHRG_RNGE_1875_UA;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_PCHRGCTRL, &pchrgctrl);\n\tif (ret)\n\t\treturn ret;\n\n\ticharge_range = pchrgctrl & BQ2515X_ICHARGE_RANGE;\n\n\tif (icharge_range) {\n\t\tprecharge_max_ua = BQ2515X_PRECHRG_ICHRG_RNGE_3750_UA;\n\t\tprecharge_multiplier = BQ2515X_ICHG_RNG_1B1_UA;\n\t} else {\n\t\tprecharge_max_ua = BQ2515X_PRECHRG_ICHRG_RNGE_1875_UA;\n\t\tprecharge_multiplier = BQ2515X_ICHG_RNG_1B0_UA;\n\t}\n\tif (val > precharge_max_ua || val < BQ2515X_ICHG_MIN_UA)\n\t\treturn -EINVAL;\n\n\tprecharge_reg_code = val / precharge_multiplier;\n\n\tret = bq2515x_set_charge_disable(bq2515x, 1);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_update_bits(bq2515x->regmap, BQ2515X_PCHRGCTRL,\n\t\t\t\tBQ2515X_PRECHARGE_MASK, precharge_reg_code);\n\tif (ret)\n\t\treturn ret;\n\n\treturn bq2515x_set_charge_disable(bq2515x, 0);\n}\n\nstatic int bq2515x_charging_status(struct bq2515x_device *bq2515x,\n\t\t\t\t   union power_supply_propval *val)\n{\n\tbool status0_no_fault;\n\tbool status1_no_fault;\n\tbool ce_status;\n\tbool charge_done;\n\tunsigned int status;\n\tint ret;\n\n\tif (!bq2515x->mains_online) {\n\t\tval->intval = POWER_SUPPLY_STATUS_DISCHARGING;\n\t\treturn 0;\n\t}\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_STAT0, &status);\n\tif (ret)\n\t\treturn ret;\n\n\t \n\tif (((status & BQ2515X_STAT0_MASK) == true) &\n\t\t\t((status & BQ2515X_CHRG_DONE) == false)) {\n\t\tstatus0_no_fault = true;\n\t\tcharge_done = false;\n\t} else if (status & BQ2515X_CHRG_DONE) {\n\t\tcharge_done = true;\n\t\tstatus0_no_fault = false;\n\t} else {\n\t\tstatus0_no_fault = false;\n\t\tcharge_done = false;\n\t}\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_STAT1, &status);\n\tif (ret)\n\t\treturn ret;\n\t \n\tif ((status & BQ2515X_STAT1_MASK) == false)\n\t\tstatus1_no_fault = true;\n\telse\n\t\tstatus1_no_fault = false;\n\n\tce_status = (!bq2515x_get_charge_disable(bq2515x));\n\n\t \n\tif (status0_no_fault & status1_no_fault & ce_status)\n\t\tval->intval = POWER_SUPPLY_STATUS_CHARGING;\n\telse if (charge_done)\n\t\tval->intval = POWER_SUPPLY_STATUS_FULL;\n\telse if (!(status0_no_fault & status1_no_fault & ce_status))\n\t\tval->intval = POWER_SUPPLY_STATUS_NOT_CHARGING;\n\n\treturn 0;\n}\n\nstatic int bq2515x_get_batt_reg(struct bq2515x_device *bq2515x)\n{\n\tint vbat_reg_code;\n\tint ret;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_VBAT_CTRL, &vbat_reg_code);\n\tif (ret)\n\t\treturn ret;\n\n\treturn BQ2515X_VBAT_BASE_VOLT + vbat_reg_code * BQ2515X_VBAT_STEP_UV;\n}\n\nstatic int bq2515x_set_batt_reg(struct bq2515x_device *bq2515x, int val)\n{\n\tint vbat_reg_code;\n\n\tif (val > BQ2515X_VBAT_REG_MAX || val < BQ2515X_VBAT_REG_MIN)\n\t\treturn -EINVAL;\n\n\tvbat_reg_code = (val - BQ2515X_VBAT_BASE_VOLT) / BQ2515X_VBAT_STEP_UV;\n\n\treturn regmap_write(bq2515x->regmap, BQ2515X_VBAT_CTRL, vbat_reg_code);\n}\n\nstatic int bq2515x_get_ilim_lvl(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tint ilimctrl;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_ILIMCTRL, &ilimctrl);\n\tif (ret)\n\t\treturn ret;\n\n\treturn bq2515x_ilim_lvl_values[ilimctrl & BQ2515X_ILIM_MASK];\n}\n\nstatic int bq2515x_set_ilim_lvl(struct bq2515x_device *bq2515x, int val)\n{\n\tint i = 0;\n\tunsigned int array_size = ARRAY_SIZE(bq2515x_ilim_lvl_values);\n\n\tfor (i = array_size - 1; i > 0; i--) {\n\t\tif (val >= bq2515x_ilim_lvl_values[i])\n\t\t\tbreak;\n\t}\n\treturn regmap_write(bq2515x->regmap, BQ2515X_ILIMCTRL, i);\n}\n\nstatic int bq2515x_power_supply_property_is_writeable(struct power_supply *psy,\n\t\t\t\t\tenum power_supply_property prop)\n{\n\tswitch (prop) {\n\tcase POWER_SUPPLY_PROP_INPUT_CURRENT_LIMIT:\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE:\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT:\n\tcase POWER_SUPPLY_PROP_PRECHARGE_CURRENT:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic int bq2515x_charger_get_health(struct bq2515x_device *bq2515x,\n\t\t\t\t      union power_supply_propval *val)\n{\n\tint health = POWER_SUPPLY_HEALTH_GOOD;\n\tint ret;\n\tunsigned int stat1;\n\tunsigned int flag3;\n\n\tif (!bq2515x->mains_online)\n\t\tbq2515x_wake_up(bq2515x);\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_FLAG3, &flag3);\n\tif (ret)\n\t\treturn ret;\n\n\tret = regmap_read(bq2515x->regmap, BQ2515X_STAT1, &stat1);\n\tif (ret)\n\t\treturn ret;\n\n\tif (stat1 & BQ2515X_HEALTH_MASK) {\n\t\tswitch (stat1 & BQ2515X_HEALTH_MASK) {\n\t\tcase BQ2515X_TS_HOT_STAT:\n\t\t\thealth = POWER_SUPPLY_HEALTH_HOT;\n\t\t\tbreak;\n\t\tcase BQ2515X_TS_WARM_STAT:\n\t\t\thealth = POWER_SUPPLY_HEALTH_WARM;\n\t\t\tbreak;\n\t\tcase BQ2515X_TS_COOL_STAT:\n\t\t\thealth = POWER_SUPPLY_HEALTH_COOL;\n\t\t\tbreak;\n\t\tcase BQ2515X_TS_COLD_STAT:\n\t\t\thealth = POWER_SUPPLY_HEALTH_COLD;\n\t\t\tbreak;\n\t\tdefault:\n\t\t\thealth = POWER_SUPPLY_HEALTH_UNKNOWN;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (stat1 & BQ2515X_VIN_OVP_FAULT_STAT)\n\t\thealth = POWER_SUPPLY_HEALTH_OVERVOLTAGE;\n\n\tif (flag3 & BQ2515X_SAFETY_TIMER_EXP)\n\t\thealth = POWER_SUPPLY_HEALTH_SAFETY_TIMER_EXPIRE;\n\n\tval->intval = health;\n\treturn 0;\n}\n\nstatic int bq2515x_mains_set_property(struct power_supply *psy,\n\t\tenum power_supply_property prop,\n\t\tconst union power_supply_propval *val)\n{\n\tstruct bq2515x_device *bq2515x = power_supply_get_drvdata(psy);\n\tint ret;\n\n\tswitch (prop) {\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE:\n\t\tret = bq2515x_set_batt_reg(bq2515x, val->intval);\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT:\n\t\tret = bq2515x_set_const_charge_current(bq2515x, val->intval);\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_INPUT_CURRENT_LIMIT:\n\t\tret = bq2515x_set_ilim_lvl(bq2515x, val->intval);\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_PRECHARGE_CURRENT:\n\t\tret = bq2515x_set_precharge_current(bq2515x, val->intval);\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn ret;\n}\n\nstatic int bq2515x_mains_get_property(struct power_supply *psy,\n\t\t\t\t     enum power_supply_property prop,\n\t\t\t\t     union power_supply_propval *val)\n{\n\tstruct bq2515x_device *bq2515x = power_supply_get_drvdata(psy);\n\tint ret = 0;\n\n\tswitch (prop) {\n\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT:\n\t\tret = bq2515x_get_const_charge_current(bq2515x);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE:\n\t\tret = bq2515x_get_batt_reg(bq2515x);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_PRECHARGE_CURRENT:\n\t\tret = bq2515x_get_precharge_current(bq2515x);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_ONLINE:\n\t\tval->intval = bq2515x->mains_online;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_HEALTH:\n\t\tret = bq2515x_charger_get_health(bq2515x, val);\n\t\tif (ret)\n\t\t\tval->intval = POWER_SUPPLY_HEALTH_UNKNOWN;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_INPUT_CURRENT_LIMIT:\n\t\tret = bq2515x_get_ilim_lvl(bq2515x);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_MODEL_NAME:\n\t\tval->strval = bq2515x->model_name;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_MANUFACTURER:\n\t\tval->strval = BQ2515X_MANUFACTURER;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_STATUS:\n\t\tret = bq2515x_charging_status(bq2515x, val);\n\t\tif (ret)\n\t\t\treturn ret;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\n\treturn ret;\n}\n\nstatic int bq2515x_battery_get_property(struct power_supply *psy,\n\t\t\t\t       enum power_supply_property prop,\n\t\t\t\t       union power_supply_propval *val)\n{\n\tstruct bq2515x_device *bq2515x = power_supply_get_drvdata(psy);\n\tint ret;\n\n\tret = bq2515x_update_ps_status(bq2515x);\n\tif (ret)\n\t\treturn ret;\n\n\tswitch (prop) {\n\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE_MAX:\n\t\tret = bq2515x->init_data.vbatreg;\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT_MAX:\n\t\tret = bq2515x->init_data.ichg;\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_VOLTAGE_NOW:\n\t\tret = bq2515x_get_battery_voltage_now(bq2515x);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tcase POWER_SUPPLY_PROP_CURRENT_NOW:\n\t\tret = bq2515x_get_battery_current_now(bq2515x);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tval->intval = ret;\n\t\tbreak;\n\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\treturn 0;\n}\n\nstatic const enum power_supply_property bq2515x_battery_properties[] = {\n\tPOWER_SUPPLY_PROP_VOLTAGE_NOW,\n\tPOWER_SUPPLY_PROP_CURRENT_NOW,\n\tPOWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT_MAX,\n\tPOWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE_MAX,\n};\n\nstatic const enum power_supply_property bq2515x_mains_properties[] = {\n\tPOWER_SUPPLY_PROP_ONLINE,\n\tPOWER_SUPPLY_PROP_STATUS,\n\tPOWER_SUPPLY_PROP_HEALTH,\n\tPOWER_SUPPLY_PROP_INPUT_CURRENT_LIMIT,\n\tPOWER_SUPPLY_PROP_MODEL_NAME,\n\tPOWER_SUPPLY_PROP_MANUFACTURER,\n\tPOWER_SUPPLY_PROP_CONSTANT_CHARGE_VOLTAGE,\n\tPOWER_SUPPLY_PROP_CONSTANT_CHARGE_CURRENT,\n\tPOWER_SUPPLY_PROP_PRECHARGE_CURRENT,\n};\n\nstatic const struct power_supply_desc bq2515x_mains_desc = {\n\t.name\t\t\t= \"bq2515x-mains\",\n\t.type\t\t\t= POWER_SUPPLY_TYPE_MAINS,\n\t.get_property\t\t= bq2515x_mains_get_property,\n\t.set_property\t\t= bq2515x_mains_set_property,\n\t.properties\t\t= bq2515x_mains_properties,\n\t.num_properties\t\t= ARRAY_SIZE(bq2515x_mains_properties),\n\t.property_is_writeable\t= bq2515x_power_supply_property_is_writeable,\n};\n\nstatic const struct power_supply_desc bq2515x_battery_desc = {\n\t.name\t\t\t= \"bq2515x-battery\",\n\t.type\t\t\t= POWER_SUPPLY_TYPE_BATTERY,\n\t.get_property\t\t= bq2515x_battery_get_property,\n\t.properties\t\t= bq2515x_battery_properties,\n\t.num_properties\t\t= ARRAY_SIZE(bq2515x_battery_properties),\n\t.property_is_writeable\t= bq2515x_power_supply_property_is_writeable,\n};\n\nstatic int bq2515x_power_supply_register(struct bq2515x_device *bq2515x,\n\t\tstruct device *dev, struct power_supply_config psy_cfg)\n{\n\tbq2515x->mains = devm_power_supply_register(bq2515x->dev,\n\t\t\t\t\t\t    &bq2515x_mains_desc,\n\t\t\t\t\t\t    &psy_cfg);\n\tif (IS_ERR(bq2515x->mains))\n\t\treturn -EINVAL;\n\n\tbq2515x->battery = devm_power_supply_register(bq2515x->dev,\n\t\t\t\t\t\t      &bq2515x_battery_desc,\n\t\t\t\t\t\t      &psy_cfg);\n\tif (IS_ERR(bq2515x->battery))\n\t\treturn -EINVAL;\n\n\treturn 0;\n}\n\nstatic int bq2515x_hw_init(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\tstruct power_supply_battery_info *bat_info;\n\n\tret = bq2515x_disable_watchdog_timers(bq2515x);\n\tif (ret)\n\t\treturn ret;\n\n\tif (bq2515x->init_data.ilim) {\n\t\tret = bq2515x_set_ilim_lvl(bq2515x, bq2515x->init_data.ilim);\n\t\tif (ret)\n\t\t\treturn ret;\n\t}\n\n\tret = power_supply_get_battery_info(bq2515x->mains, &bat_info);\n\tif (ret) {\n\t\tdev_warn(bq2515x->dev, \"battery info missing, default values will be applied\\n\");\n\n\t\tbq2515x->init_data.ichg = BQ2515X_DEFAULT_ICHG_UA;\n\n\t\tbq2515x->init_data.vbatreg = BQ2515X_DEFAULT_VBAT_REG_UV;\n\n\t\tbq2515x->init_data.iprechg = BQ2515X_DEFAULT_IPRECHARGE_UA;\n\n\t} else {\n\t\tbq2515x->init_data.ichg =\n\t\t\t\tbat_info->constant_charge_current_max_ua;\n\n\t\tbq2515x->init_data.vbatreg =\n\t\t\t\tbat_info->constant_charge_voltage_max_uv;\n\n\t\tbq2515x->init_data.iprechg =\n\t\t\t\tbat_info->precharge_current_ua;\n\t}\n\n\tret = bq2515x_set_const_charge_current(bq2515x,\n\t\t\t\t\t\tbq2515x->init_data.ichg);\n\tif (ret)\n\t\treturn ret;\n\n\tret = bq2515x_set_batt_reg(bq2515x, bq2515x->init_data.vbatreg);\n\tif (ret)\n\t\treturn ret;\n\n\treturn bq2515x_set_precharge_current(bq2515x,\n\t\t\t\t\t\tbq2515x->init_data.iprechg);\n}\n\nstatic int bq2515x_read_properties(struct bq2515x_device *bq2515x)\n{\n\tint ret;\n\n\tret = device_property_read_u32(bq2515x->dev,\n\t\t\t\t      \"input-current-limit-microamp\",\n\t\t\t\t      &bq2515x->init_data.ilim);\n\tif (ret) {\n\t\tswitch (bq2515x->device_id) {\n\t\tcase BQ25150:\n\t\t\tbq2515x->init_data.ilim = BQ25150_DEFAULT_ILIM_UA;\n\t\t\tbreak;\n\t\tcase BQ25155:\n\t\t\tbq2515x->init_data.ilim = BQ25155_DEFAULT_ILIM_UA;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tbq2515x->ac_detect_gpio = devm_gpiod_get_optional(bq2515x->dev,\n\t\t\t\t\t\t   \"ac-detect\", GPIOD_IN);\n\tif (IS_ERR(bq2515x->ac_detect_gpio)) {\n\t\tret = PTR_ERR(bq2515x->ac_detect_gpio);\n\t\tdev_err(bq2515x->dev, \"Failed to get ac detect\");\n\t\treturn ret;\n\t}\n\n\tbq2515x->reset_gpio = devm_gpiod_get_optional(bq2515x->dev,\n\t\t\t\t\t\t   \"reset\", GPIOD_OUT_LOW);\n\tif (IS_ERR(bq2515x->reset_gpio)) {\n\t\tret = PTR_ERR(bq2515x->reset_gpio);\n\t\tdev_err(bq2515x->dev, \"Failed to get reset\");\n\t\treturn ret;\n\t}\n\n\tbq2515x->powerdown_gpio = devm_gpiod_get_optional(bq2515x->dev,\n\t\t\t\t\t\t\"powerdown\", GPIOD_OUT_LOW);\n\tif (IS_ERR(bq2515x->powerdown_gpio)) {\n\t\tret = PTR_ERR(bq2515x->powerdown_gpio);\n\t\tdev_err(bq2515x->dev, \"Failed to get powerdown\");\n\t\treturn ret;\n\t}\n\n\tbq2515x->ce_gpio = devm_gpiod_get_optional(bq2515x->dev,\n\t\t\t\t\t\t   \"charge-enable\",\n\t\t\t\t\t\t   GPIOD_OUT_LOW);\n\tif (IS_ERR(bq2515x->ce_gpio)) {\n\t\tret = PTR_ERR(bq2515x->ce_gpio);\n\t\tdev_err(bq2515x->dev, \"Failed to get ce\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic bool bq2515x_volatile_register(struct device *dev, unsigned int reg)\n{\n\tswitch (reg) {\n\tcase BQ2515X_STAT0 ... BQ2515X_FLAG3:\n\tcase BQ2515X_ADC_VBAT_M ... BQ2515X_ADC_IIN_L:\n\t\treturn true;\n\tdefault:\n\t\treturn false;\n\t}\n}\n\nstatic const struct regmap_config bq25150_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.max_register\t\t= BQ2515X_DEVICE_ID,\n\t.reg_defaults\t\t= bq25150_reg_defaults,\n\t.num_reg_defaults\t= ARRAY_SIZE(bq25150_reg_defaults),\n\t.cache_type\t\t= REGCACHE_RBTREE,\n\t.volatile_reg\t\t= bq2515x_volatile_register,\n};\n\nstatic const struct regmap_config bq25155_regmap_config = {\n\t.reg_bits = 8,\n\t.val_bits = 8,\n\n\t.max_register\t\t= BQ2515X_DEVICE_ID,\n\t.reg_defaults\t\t= bq25155_reg_defaults,\n\t.num_reg_defaults\t= ARRAY_SIZE(bq25155_reg_defaults),\n\t.cache_type\t\t= REGCACHE_RBTREE,\n\t.volatile_reg\t\t= bq2515x_volatile_register,\n};\n\nstatic int bq2515x_probe(struct i2c_client *client)\n{\n\tconst struct i2c_device_id *id = i2c_client_get_device_id(client);\n\tstruct device *dev = &client->dev;\n\tstruct bq2515x_device *bq2515x;\n\tstruct power_supply_config charger_cfg = {};\n\tint ret;\n\n\tbq2515x = devm_kzalloc(dev, sizeof(*bq2515x), GFP_KERNEL);\n\tif (!bq2515x)\n\t\treturn -ENOMEM;\n\n\tbq2515x->dev = dev;\n\n\tstrncpy(bq2515x->model_name, id->name, I2C_NAME_SIZE);\n\n\tbq2515x->device_id = id->driver_data;\n\n\tswitch (bq2515x->device_id) {\n\tcase BQ25150:\n\t\tbq2515x->regmap = devm_regmap_init_i2c(client,\n\t\t\t\t\t\t&bq25150_regmap_config);\n\t\tbreak;\n\tcase BQ25155:\n\t\tbq2515x->regmap = devm_regmap_init_i2c(client,\n\t\t\t\t\t\t&bq25155_regmap_config);\n\t\tbreak;\n\t}\n\n\tif (IS_ERR(bq2515x->regmap)) {\n\t\tdev_err(dev, \"failed to allocate register map\\n\");\n\t\treturn PTR_ERR(bq2515x->regmap);\n\t}\n\n\ti2c_set_clientdata(client, bq2515x);\n\n\tcharger_cfg.drv_data = bq2515x;\n\tcharger_cfg.of_node = dev->of_node;\n\n\tret = bq2515x_read_properties(bq2515x);\n\tif (ret) {\n\t\tdev_err(dev, \"Failed to read device tree properties %d\\n\",\n\t\t\t\t\t\t\t\t\tret);\n\t\treturn ret;\n\t}\n\n\tret = bq2515x_power_supply_register(bq2515x, dev, charger_cfg);\n\tif (ret) {\n\t\tdev_err(dev, \"failed to register power supply\\n\");\n\t\treturn ret;\n\t}\n\n\tret = bq2515x_hw_init(bq2515x);\n\tif (ret) {\n\t\tdev_err(dev, \"Cannot initialize the chip\\n\");\n\t\treturn ret;\n\t}\n\n\treturn 0;\n}\n\nstatic const struct i2c_device_id bq2515x_i2c_ids[] = {\n\t{ \"bq25150\", BQ25150, },\n\t{ \"bq25155\", BQ25155, },\n\t{},\n};\nMODULE_DEVICE_TABLE(i2c, bq2515x_i2c_ids);\n\nstatic const struct of_device_id bq2515x_of_match[] = {\n\t{ .compatible = \"ti,bq25150\", },\n\t{ .compatible = \"ti,bq25155\", },\n\t{ },\n};\nMODULE_DEVICE_TABLE(of, bq2515x_of_match);\n\nstatic struct i2c_driver bq2515x_driver = {\n\t.driver = {\n\t\t.name = \"bq2515x-charger\",\n\t\t.of_match_table = bq2515x_of_match,\n\t},\n\t.probe = bq2515x_probe,\n\t.id_table = bq2515x_i2c_ids,\n};\nmodule_i2c_driver(bq2515x_driver);\n\nMODULE_AUTHOR(\"Dan Murphy <dmurphy@ti.com>\");\nMODULE_AUTHOR(\"Ricardo Rivera-Matos <r-rivera-matos@ti.com>\");\nMODULE_DESCRIPTION(\"BQ2515X charger driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}