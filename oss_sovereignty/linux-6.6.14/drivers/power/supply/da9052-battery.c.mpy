{
  "module_name": "da9052-battery.c",
  "hash_id": "d39a5b319b017e04ccfea5dac10be14e50bc641aadcc195e8e624fc73831e431",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/supply/da9052-battery.c",
  "human_readable_source": "\n \n\n#include <linux/delay.h>\n#include <linux/freezer.h>\n#include <linux/fs.h>\n#include <linux/jiffies.h>\n#include <linux/module.h>\n#include <linux/timer.h>\n#include <linux/uaccess.h>\n#include <linux/platform_device.h>\n#include <linux/power_supply.h>\n\n#include <linux/mfd/da9052/da9052.h>\n#include <linux/mfd/da9052/pdata.h>\n#include <linux/mfd/da9052/reg.h>\n\n \n#define DA9052_BAT_CUTOFF_VOLT\t\t2800\n#define DA9052_BAT_TSH\t\t\t62000\n#define DA9052_BAT_LOW_CAP\t\t4\n#define DA9052_AVG_SZ\t\t\t4\n#define DA9052_VC_TBL_SZ\t\t68\n#define DA9052_VC_TBL_REF_SZ\t\t3\n\n#define DA9052_ISET_USB_MASK\t\t0x0F\n#define DA9052_CHG_USB_ILIM_MASK\t0x40\n#define DA9052_CHG_LIM_COLS\t\t16\n\n#define DA9052_MEAN(x, y)\t\t((x + y) / 2)\n\nenum charger_type_enum {\n\tDA9052_NOCHARGER = 1,\n\tDA9052_CHARGER,\n};\n\nstatic const u16 da9052_chg_current_lim[2][DA9052_CHG_LIM_COLS] = {\n\t{70,  80,  90,  100, 110, 120, 400,  450,\n\t 500, 550, 600, 650, 700, 900, 1100, 1300},\n\t{80,  90,  100, 110,  120,  400,  450,  500,\n\t 550, 600, 800, 1000, 1200, 1400, 1600, 1800},\n};\n\nstatic const u16 vc_tbl_ref[3] = {10, 25, 40};\n \nstatic u32 const vc_tbl[3][68][2] = {\n\t \n\t{\n\t{4082, 100}, {4036, 98},\n\t{4020, 96}, {4008, 95},\n\t{3997, 93}, {3983, 91},\n\t{3964, 90}, {3943, 88},\n\t{3926, 87}, {3912, 85},\n\t{3900, 84}, {3890, 82},\n\t{3881, 80}, {3873, 79},\n\t{3865, 77}, {3857, 76},\n\t{3848, 74}, {3839, 73},\n\t{3829, 71}, {3820, 70},\n\t{3811, 68}, {3802, 67},\n\t{3794, 65}, {3785, 64},\n\t{3778, 62}, {3770, 61},\n\t{3763, 59}, {3756, 58},\n\t{3750, 56}, {3744, 55},\n\t{3738, 53}, {3732, 52},\n\t{3727, 50}, {3722, 49},\n\t{3717, 47}, {3712, 46},\n\t{3708, 44}, {3703, 43},\n\t{3700, 41}, {3696, 40},\n\t{3693, 38}, {3691, 37},\n\t{3688, 35}, {3686, 34},\n\t{3683, 32}, {3681, 31},\n\t{3678, 29}, {3675, 28},\n\t{3672, 26}, {3669, 25},\n\t{3665, 23}, {3661, 22},\n\t{3656, 21}, {3651, 19},\n\t{3645, 18}, {3639, 16},\n\t{3631, 15}, {3622, 13},\n\t{3611, 12}, {3600, 10},\n\t{3587, 9}, {3572, 7},\n\t{3548, 6}, {3503, 5},\n\t{3420, 3}, {3268, 2},\n\t{2992, 1}, {2746, 0}\n\t},\n\t \n\t{\n\t{4102, 100}, {4065, 98},\n\t{4048, 96}, {4034, 95},\n\t{4021, 93}, {4011, 92},\n\t{4001, 90}, {3986, 88},\n\t{3968, 87}, {3952, 85},\n\t{3938, 84}, {3926, 82},\n\t{3916, 81}, {3908, 79},\n\t{3900, 77}, {3892, 76},\n\t{3883, 74}, {3874, 73},\n\t{3864, 71}, {3855, 70},\n\t{3846, 68}, {3836, 67},\n\t{3827, 65}, {3819, 64},\n\t{3810, 62}, {3801, 61},\n\t{3793, 59}, {3786, 58},\n\t{3778, 56}, {3772, 55},\n\t{3765, 53}, {3759, 52},\n\t{3754, 50}, {3748, 49},\n\t{3743, 47}, {3738, 46},\n\t{3733, 44}, {3728, 43},\n\t{3724, 41}, {3720, 40},\n\t{3716, 38}, {3712, 37},\n\t{3709, 35}, {3706, 34},\n\t{3703, 33}, {3701, 31},\n\t{3698, 30}, {3696, 28},\n\t{3693, 27}, {3690, 25},\n\t{3687, 24}, {3683, 22},\n\t{3680, 21}, {3675, 19},\n\t{3671, 18}, {3666, 17},\n\t{3660, 15}, {3654, 14},\n\t{3647, 12}, {3639, 11},\n\t{3630, 9}, {3621, 8},\n\t{3613, 6}, {3606, 5},\n\t{3597, 4}, {3582, 2},\n\t{3546, 1}, {2747, 0}\n\t},\n\t \n\t{\n\t{4114, 100}, {4081, 98},\n\t{4065, 96}, {4050, 95},\n\t{4036, 93}, {4024, 92},\n\t{4013, 90}, {4002, 88},\n\t{3990, 87}, {3976, 85},\n\t{3962, 84}, {3950, 82},\n\t{3939, 81}, {3930, 79},\n\t{3921, 77}, {3912, 76},\n\t{3902, 74}, {3893, 73},\n\t{3883, 71}, {3874, 70},\n\t{3865, 68}, {3856, 67},\n\t{3847, 65}, {3838, 64},\n\t{3829, 62}, {3820, 61},\n\t{3812, 59}, {3803, 58},\n\t{3795, 56}, {3787, 55},\n\t{3780, 53}, {3773, 52},\n\t{3767, 50}, {3761, 49},\n\t{3756, 47}, {3751, 46},\n\t{3746, 44}, {3741, 43},\n\t{3736, 41}, {3732, 40},\n\t{3728, 38}, {3724, 37},\n\t{3720, 35}, {3716, 34},\n\t{3713, 33}, {3710, 31},\n\t{3707, 30}, {3704, 28},\n\t{3701, 27}, {3698, 25},\n\t{3695, 24}, {3691, 22},\n\t{3686, 21}, {3681, 19},\n\t{3676, 18}, {3671, 17},\n\t{3666, 15}, {3661, 14},\n\t{3655, 12}, {3648, 11},\n\t{3640, 9}, {3632, 8},\n\t{3622, 6}, {3616, 5},\n\t{3611, 4}, {3604, 2},\n\t{3594, 1}, {2747, 0}\n\t}\n};\n\nstruct da9052_battery {\n\tstruct da9052 *da9052;\n\tstruct power_supply *psy;\n\tstruct notifier_block nb;\n\tint charger_type;\n\tint status;\n\tint health;\n};\n\nstatic inline int volt_reg_to_mV(int value)\n{\n\treturn ((value * 1000) / 512) + 2500;\n}\n\nstatic inline int ichg_reg_to_mA(int value)\n{\n\treturn (value * 3900) / 1000;\n}\n\nstatic int da9052_read_chgend_current(struct da9052_battery *bat,\n\t\t\t\t       int *current_mA)\n{\n\tint ret;\n\n\tif (bat->status == POWER_SUPPLY_STATUS_DISCHARGING)\n\t\treturn -EINVAL;\n\n\tret = da9052_reg_read(bat->da9052, DA9052_ICHG_END_REG);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t*current_mA = ichg_reg_to_mA(ret & DA9052_ICHGEND_ICHGEND);\n\n\treturn 0;\n}\n\nstatic int da9052_read_chg_current(struct da9052_battery *bat, int *current_mA)\n{\n\tint ret;\n\n\tif (bat->status == POWER_SUPPLY_STATUS_DISCHARGING)\n\t\treturn -EINVAL;\n\n\tret = da9052_reg_read(bat->da9052, DA9052_ICHG_AV_REG);\n\tif (ret < 0)\n\t\treturn ret;\n\n\t*current_mA = ichg_reg_to_mA(ret & DA9052_ICHGAV_ICHGAV);\n\n\treturn 0;\n}\n\nstatic int da9052_bat_check_status(struct da9052_battery *bat, int *status)\n{\n\tu8 v[2] = {0, 0};\n\tu8 bat_status;\n\tu8 chg_end;\n\tint ret;\n\tint chg_current;\n\tint chg_end_current;\n\tbool dcinsel;\n\tbool dcindet;\n\tbool vbussel;\n\tbool vbusdet;\n\tbool dc;\n\tbool vbus;\n\n\tret = da9052_group_read(bat->da9052, DA9052_STATUS_A_REG, 2, v);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tbat_status = v[0];\n\tchg_end = v[1];\n\n\tdcinsel = bat_status & DA9052_STATUSA_DCINSEL;\n\tdcindet = bat_status & DA9052_STATUSA_DCINDET;\n\tvbussel = bat_status & DA9052_STATUSA_VBUSSEL;\n\tvbusdet = bat_status & DA9052_STATUSA_VBUSDET;\n\tdc = dcinsel && dcindet;\n\tvbus = vbussel && vbusdet;\n\n\t \n\tif (dc || vbus) {\n\t\tbat->charger_type = DA9052_CHARGER;\n\n\t\t \n\t\tif ((chg_end & DA9052_STATUSB_CHGEND) != 0) {\n\t\t\tret = da9052_read_chg_current(bat, &chg_current);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\t\t\tret = da9052_read_chgend_current(bat, &chg_end_current);\n\t\t\tif (ret < 0)\n\t\t\t\treturn ret;\n\n\t\t\tif (chg_current >= chg_end_current)\n\t\t\t\tbat->status = POWER_SUPPLY_STATUS_CHARGING;\n\t\t\telse\n\t\t\t\tbat->status = POWER_SUPPLY_STATUS_NOT_CHARGING;\n\t\t} else {\n\t\t\t \n\t\t\tbat->status = POWER_SUPPLY_STATUS_CHARGING;\n\t\t}\n\t} else if (dcindet || vbusdet) {\n\t\t\tbat->charger_type = DA9052_CHARGER;\n\t\t\tbat->status = POWER_SUPPLY_STATUS_NOT_CHARGING;\n\t} else {\n\t\tbat->charger_type = DA9052_NOCHARGER;\n\t\tbat->status = POWER_SUPPLY_STATUS_DISCHARGING;\n\t}\n\n\tif (status != NULL)\n\t\t*status = bat->status;\n\treturn 0;\n}\n\nstatic int da9052_bat_read_volt(struct da9052_battery *bat, int *volt_mV)\n{\n\tint volt;\n\n\tvolt = da9052_adc_manual_read(bat->da9052, DA9052_ADC_MAN_MUXSEL_VBAT);\n\tif (volt < 0)\n\t\treturn volt;\n\n\t*volt_mV = volt_reg_to_mV(volt);\n\n\treturn 0;\n}\n\nstatic int da9052_bat_check_presence(struct da9052_battery *bat, int *illegal)\n{\n\tint bat_temp;\n\n\tbat_temp = da9052_adc_read_temp(bat->da9052);\n\tif (bat_temp < 0)\n\t\treturn bat_temp;\n\n\tif (bat_temp > DA9052_BAT_TSH)\n\t\t*illegal = 1;\n\telse\n\t\t*illegal = 0;\n\n\treturn 0;\n}\n\nstatic int da9052_bat_interpolate(int vbat_lower, int  vbat_upper,\n\t\t\t\t   int level_lower, int level_upper,\n\t\t\t\t   int bat_voltage)\n{\n\tint tmp;\n\n\ttmp = ((level_upper - level_lower) * 1000) / (vbat_upper - vbat_lower);\n\ttmp = level_lower + (((bat_voltage - vbat_lower) * tmp) / 1000);\n\n\treturn tmp;\n}\n\nstatic unsigned char da9052_determine_vc_tbl_index(unsigned char adc_temp)\n{\n\tint i;\n\n\tif (adc_temp <= vc_tbl_ref[0])\n\t\treturn 0;\n\n\tif (adc_temp > vc_tbl_ref[DA9052_VC_TBL_REF_SZ - 1])\n\t\treturn DA9052_VC_TBL_REF_SZ - 1;\n\n\tfor (i = 0; i < DA9052_VC_TBL_REF_SZ - 1; i++) {\n\t\tif ((adc_temp > vc_tbl_ref[i]) &&\n\t\t    (adc_temp <= DA9052_MEAN(vc_tbl_ref[i], vc_tbl_ref[i + 1])))\n\t\t\t\treturn i;\n\t\tif ((adc_temp > DA9052_MEAN(vc_tbl_ref[i], vc_tbl_ref[i + 1]))\n\t\t     && (adc_temp <= vc_tbl_ref[i]))\n\t\t\t\treturn i + 1;\n\t}\n\t \n\tWARN_ON(1);\n\treturn 0;\n}\n\nstatic int da9052_bat_read_capacity(struct da9052_battery *bat, int *capacity)\n{\n\tint adc_temp;\n\tint bat_voltage;\n\tint vbat_lower;\n\tint vbat_upper;\n\tint level_upper;\n\tint level_lower;\n\tint ret;\n\tint flag;\n\tint i = 0;\n\tint j;\n\n\tret = da9052_bat_read_volt(bat, &bat_voltage);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tadc_temp = da9052_adc_read_temp(bat->da9052);\n\tif (adc_temp < 0)\n\t\treturn adc_temp;\n\n\ti = da9052_determine_vc_tbl_index(adc_temp);\n\n\tif (bat_voltage >= vc_tbl[i][0][0]) {\n\t\t*capacity = 100;\n\t\treturn 0;\n\t}\n\tif (bat_voltage <= vc_tbl[i][DA9052_VC_TBL_SZ - 1][0]) {\n\t\t*capacity = 0;\n\t\treturn 0;\n\t}\n\tflag = 0;\n\n\tfor (j = 0; j < (DA9052_VC_TBL_SZ-1); j++) {\n\t\tif ((bat_voltage <= vc_tbl[i][j][0]) &&\n\t\t    (bat_voltage >= vc_tbl[i][j + 1][0])) {\n\t\t\tvbat_upper = vc_tbl[i][j][0];\n\t\t\tvbat_lower = vc_tbl[i][j + 1][0];\n\t\t\tlevel_upper = vc_tbl[i][j][1];\n\t\t\tlevel_lower = vc_tbl[i][j + 1][1];\n\t\t\tflag = 1;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (!flag)\n\t\treturn -EIO;\n\n\t*capacity = da9052_bat_interpolate(vbat_lower, vbat_upper, level_lower,\n\t\t\t\t\t   level_upper, bat_voltage);\n\n\treturn 0;\n}\n\nstatic int da9052_bat_check_health(struct da9052_battery *bat, int *health)\n{\n\tint ret;\n\tint bat_illegal;\n\tint capacity;\n\n\tret = da9052_bat_check_presence(bat, &bat_illegal);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (bat_illegal) {\n\t\tbat->health = POWER_SUPPLY_HEALTH_UNKNOWN;\n\t\treturn 0;\n\t}\n\n\tif (bat->health != POWER_SUPPLY_HEALTH_OVERHEAT) {\n\t\tret = da9052_bat_read_capacity(bat, &capacity);\n\t\tif (ret < 0)\n\t\t\treturn ret;\n\t\tif (capacity < DA9052_BAT_LOW_CAP)\n\t\t\tbat->health = POWER_SUPPLY_HEALTH_DEAD;\n\t\telse\n\t\t\tbat->health = POWER_SUPPLY_HEALTH_GOOD;\n\t}\n\n\t*health = bat->health;\n\n\treturn 0;\n}\n\nstatic irqreturn_t da9052_bat_irq(int irq, void *data)\n{\n\tstruct da9052_battery *bat = data;\n\tint virq;\n\n\tvirq = regmap_irq_get_virq(bat->da9052->irq_data, irq);\n\tirq -= virq;\n\n\tif (irq == DA9052_IRQ_CHGEND)\n\t\tbat->status = POWER_SUPPLY_STATUS_FULL;\n\telse\n\t\tda9052_bat_check_status(bat, NULL);\n\n\tif (irq == DA9052_IRQ_CHGEND || irq == DA9052_IRQ_DCIN ||\n\t    irq == DA9052_IRQ_VBUS || irq == DA9052_IRQ_TBAT) {\n\t\tpower_supply_changed(bat->psy);\n\t}\n\n\treturn IRQ_HANDLED;\n}\n\nstatic int da9052_USB_current_notifier(struct notifier_block *nb,\n\t\t\t\t\tunsigned long events, void *data)\n{\n\tu8 row;\n\tu8 col;\n\tint *current_mA = data;\n\tint ret;\n\tstruct da9052_battery *bat = container_of(nb, struct da9052_battery,\n\t\t\t\t\t\t  nb);\n\n\tif (bat->status == POWER_SUPPLY_STATUS_DISCHARGING)\n\t\treturn -EPERM;\n\n\tret = da9052_reg_read(bat->da9052, DA9052_CHGBUCK_REG);\n\tif (ret & DA9052_CHG_USB_ILIM_MASK)\n\t\treturn -EPERM;\n\n\tif (bat->da9052->chip_id == DA9052)\n\t\trow = 0;\n\telse\n\t\trow = 1;\n\n\tif (*current_mA < da9052_chg_current_lim[row][0] ||\n\t    *current_mA > da9052_chg_current_lim[row][DA9052_CHG_LIM_COLS - 1])\n\t\treturn -EINVAL;\n\n\tfor (col = 0; col <= DA9052_CHG_LIM_COLS - 1 ; col++) {\n\t\tif (*current_mA <= da9052_chg_current_lim[row][col])\n\t\t\tbreak;\n\t}\n\n\treturn da9052_reg_update(bat->da9052, DA9052_ISET_REG,\n\t\t\t\t DA9052_ISET_USB_MASK, col);\n}\n\nstatic int da9052_bat_get_property(struct power_supply *psy,\n\t\t\t\t    enum power_supply_property psp,\n\t\t\t\t    union power_supply_propval *val)\n{\n\tint ret;\n\tint illegal;\n\tstruct da9052_battery *bat = power_supply_get_drvdata(psy);\n\n\tret = da9052_bat_check_presence(bat, &illegal);\n\tif (ret < 0)\n\t\treturn ret;\n\n\tif (illegal && psp != POWER_SUPPLY_PROP_PRESENT)\n\t\treturn -ENODEV;\n\n\tswitch (psp) {\n\tcase POWER_SUPPLY_PROP_STATUS:\n\t\tret = da9052_bat_check_status(bat, &val->intval);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_ONLINE:\n\t\tval->intval =\n\t\t\t(bat->charger_type == DA9052_NOCHARGER) ? 0 : 1;\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_PRESENT:\n\t\tret = da9052_bat_check_presence(bat, &val->intval);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_HEALTH:\n\t\tret = da9052_bat_check_health(bat, &val->intval);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_VOLTAGE_MIN_DESIGN:\n\t\tval->intval = DA9052_BAT_CUTOFF_VOLT * 1000;\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_VOLTAGE_AVG:\n\t\tret = da9052_bat_read_volt(bat, &val->intval);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_CURRENT_AVG:\n\t\tret = da9052_read_chg_current(bat, &val->intval);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_CAPACITY:\n\t\tret = da9052_bat_read_capacity(bat, &val->intval);\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_TEMP:\n\t\tval->intval = da9052_adc_read_temp(bat->da9052);\n\t\tret = val->intval;\n\t\tbreak;\n\tcase POWER_SUPPLY_PROP_TECHNOLOGY:\n\t\tval->intval = POWER_SUPPLY_TECHNOLOGY_LION;\n\t\tbreak;\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n\treturn ret;\n}\n\nstatic enum power_supply_property da9052_bat_props[] = {\n\tPOWER_SUPPLY_PROP_STATUS,\n\tPOWER_SUPPLY_PROP_ONLINE,\n\tPOWER_SUPPLY_PROP_PRESENT,\n\tPOWER_SUPPLY_PROP_HEALTH,\n\tPOWER_SUPPLY_PROP_VOLTAGE_MIN_DESIGN,\n\tPOWER_SUPPLY_PROP_VOLTAGE_AVG,\n\tPOWER_SUPPLY_PROP_CURRENT_AVG,\n\tPOWER_SUPPLY_PROP_CAPACITY,\n\tPOWER_SUPPLY_PROP_TEMP,\n\tPOWER_SUPPLY_PROP_TECHNOLOGY,\n};\n\nstatic struct power_supply_desc psy_desc = {\n\t.name\t\t= \"da9052-bat\",\n\t.type\t\t= POWER_SUPPLY_TYPE_BATTERY,\n\t.properties\t= da9052_bat_props,\n\t.num_properties\t= ARRAY_SIZE(da9052_bat_props),\n\t.get_property\t= da9052_bat_get_property,\n};\n\nstatic char *da9052_bat_irqs[] = {\n\t\"BATT TEMP\",\n\t\"DCIN DET\",\n\t\"DCIN REM\",\n\t\"VBUS DET\",\n\t\"VBUS REM\",\n\t\"CHG END\",\n};\n\nstatic int da9052_bat_irq_bits[] = {\n\tDA9052_IRQ_TBAT,\n\tDA9052_IRQ_DCIN,\n\tDA9052_IRQ_DCINREM,\n\tDA9052_IRQ_VBUS,\n\tDA9052_IRQ_VBUSREM,\n\tDA9052_IRQ_CHGEND,\n};\n\nstatic s32 da9052_bat_probe(struct platform_device *pdev)\n{\n\tstruct da9052_pdata *pdata;\n\tstruct da9052_battery *bat;\n\tstruct power_supply_config psy_cfg = {};\n\tint ret;\n\tint i;\n\n\tbat = devm_kzalloc(&pdev->dev, sizeof(struct da9052_battery),\n\t\t\t\tGFP_KERNEL);\n\tif (!bat)\n\t\treturn -ENOMEM;\n\n\tpsy_cfg.drv_data = bat;\n\n\tbat->da9052 = dev_get_drvdata(pdev->dev.parent);\n\tbat->charger_type = DA9052_NOCHARGER;\n\tbat->status = POWER_SUPPLY_STATUS_UNKNOWN;\n\tbat->health = POWER_SUPPLY_HEALTH_UNKNOWN;\n\tbat->nb.notifier_call = da9052_USB_current_notifier;\n\n\tpdata = bat->da9052->dev->platform_data;\n\tif (pdata != NULL && pdata->use_for_apm)\n\t\tpsy_desc.use_for_apm = pdata->use_for_apm;\n\telse\n\t\tpsy_desc.use_for_apm = 1;\n\n\tfor (i = 0; i < ARRAY_SIZE(da9052_bat_irqs); i++) {\n\t\tret = da9052_request_irq(bat->da9052,\n\t\t\t\tda9052_bat_irq_bits[i], da9052_bat_irqs[i],\n\t\t\t\tda9052_bat_irq, bat);\n\n\t\tif (ret != 0) {\n\t\t\tdev_err(bat->da9052->dev,\n\t\t\t\t\"DA9052 failed to request %s IRQ: %d\\n\",\n\t\t\t\tda9052_bat_irqs[i], ret);\n\t\t\tgoto err;\n\t\t}\n\t}\n\n\tbat->psy = power_supply_register(&pdev->dev, &psy_desc, &psy_cfg);\n\tif (IS_ERR(bat->psy)) {\n\t\tret = PTR_ERR(bat->psy);\n\t\tgoto err;\n\t}\n\n\tplatform_set_drvdata(pdev, bat);\n\treturn 0;\n\nerr:\n\twhile (--i >= 0)\n\t\tda9052_free_irq(bat->da9052, da9052_bat_irq_bits[i], bat);\n\n\treturn ret;\n}\nstatic int da9052_bat_remove(struct platform_device *pdev)\n{\n\tint i;\n\tstruct da9052_battery *bat = platform_get_drvdata(pdev);\n\n\tfor (i = 0; i < ARRAY_SIZE(da9052_bat_irqs); i++)\n\t\tda9052_free_irq(bat->da9052, da9052_bat_irq_bits[i], bat);\n\n\tpower_supply_unregister(bat->psy);\n\n\treturn 0;\n}\n\nstatic struct platform_driver da9052_bat_driver = {\n\t.probe = da9052_bat_probe,\n\t.remove = da9052_bat_remove,\n\t.driver = {\n\t\t.name = \"da9052-bat\",\n\t},\n};\nmodule_platform_driver(da9052_bat_driver);\n\nMODULE_DESCRIPTION(\"DA9052 BAT Device Driver\");\nMODULE_AUTHOR(\"David Dajun Chen <dchen@diasemi.com>\");\nMODULE_LICENSE(\"GPL\");\nMODULE_ALIAS(\"platform:da9052-bat\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}