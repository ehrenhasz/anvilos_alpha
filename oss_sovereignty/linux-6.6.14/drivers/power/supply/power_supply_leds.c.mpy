{
  "module_name": "power_supply_leds.c",
  "hash_id": "2de2a1d86e1b3584f65669975dd763818348e57d412ca7f3f4e41929829d7b88",
  "original_prompt": "Ingested from linux-6.6.14/drivers/power/supply/power_supply_leds.c",
  "human_readable_source": "\n \n\n#include <linux/kernel.h>\n#include <linux/device.h>\n#include <linux/power_supply.h>\n#include <linux/slab.h>\n#include <linux/leds.h>\n\n#include \"power_supply.h\"\n\n \n\nstatic void power_supply_update_bat_leds(struct power_supply *psy)\n{\n\tunion power_supply_propval status;\n\n\tif (power_supply_get_property(psy, POWER_SUPPLY_PROP_STATUS, &status))\n\t\treturn;\n\n\tdev_dbg(&psy->dev, \"%s %d\\n\", __func__, status.intval);\n\n\tswitch (status.intval) {\n\tcase POWER_SUPPLY_STATUS_FULL:\n\t\tled_trigger_event(psy->charging_full_trig, LED_FULL);\n\t\tled_trigger_event(psy->charging_trig, LED_OFF);\n\t\tled_trigger_event(psy->full_trig, LED_FULL);\n\t\t \n\t\tled_trigger_event(psy->charging_blink_full_solid_trig, LED_OFF);\n\t\tled_trigger_event(psy->charging_blink_full_solid_trig, LED_FULL);\n\t\tbreak;\n\tcase POWER_SUPPLY_STATUS_CHARGING:\n\t\tled_trigger_event(psy->charging_full_trig, LED_FULL);\n\t\tled_trigger_event(psy->charging_trig, LED_FULL);\n\t\tled_trigger_event(psy->full_trig, LED_OFF);\n\t\tled_trigger_blink(psy->charging_blink_full_solid_trig, 0, 0);\n\t\tbreak;\n\tdefault:\n\t\tled_trigger_event(psy->charging_full_trig, LED_OFF);\n\t\tled_trigger_event(psy->charging_trig, LED_OFF);\n\t\tled_trigger_event(psy->full_trig, LED_OFF);\n\t\tled_trigger_event(psy->charging_blink_full_solid_trig,\n\t\t\tLED_OFF);\n\t\tbreak;\n\t}\n}\n\nstatic int power_supply_create_bat_triggers(struct power_supply *psy)\n{\n\tpsy->charging_full_trig_name = kasprintf(GFP_KERNEL,\n\t\t\t\t\t\"%s-charging-or-full\", psy->desc->name);\n\tif (!psy->charging_full_trig_name)\n\t\tgoto charging_full_failed;\n\n\tpsy->charging_trig_name = kasprintf(GFP_KERNEL,\n\t\t\t\t\t\"%s-charging\", psy->desc->name);\n\tif (!psy->charging_trig_name)\n\t\tgoto charging_failed;\n\n\tpsy->full_trig_name = kasprintf(GFP_KERNEL, \"%s-full\", psy->desc->name);\n\tif (!psy->full_trig_name)\n\t\tgoto full_failed;\n\n\tpsy->charging_blink_full_solid_trig_name = kasprintf(GFP_KERNEL,\n\t\t\"%s-charging-blink-full-solid\", psy->desc->name);\n\tif (!psy->charging_blink_full_solid_trig_name)\n\t\tgoto charging_blink_full_solid_failed;\n\n\tled_trigger_register_simple(psy->charging_full_trig_name,\n\t\t\t\t    &psy->charging_full_trig);\n\tled_trigger_register_simple(psy->charging_trig_name,\n\t\t\t\t    &psy->charging_trig);\n\tled_trigger_register_simple(psy->full_trig_name,\n\t\t\t\t    &psy->full_trig);\n\tled_trigger_register_simple(psy->charging_blink_full_solid_trig_name,\n\t\t\t\t    &psy->charging_blink_full_solid_trig);\n\n\treturn 0;\n\ncharging_blink_full_solid_failed:\n\tkfree(psy->full_trig_name);\nfull_failed:\n\tkfree(psy->charging_trig_name);\ncharging_failed:\n\tkfree(psy->charging_full_trig_name);\ncharging_full_failed:\n\treturn -ENOMEM;\n}\n\nstatic void power_supply_remove_bat_triggers(struct power_supply *psy)\n{\n\tled_trigger_unregister_simple(psy->charging_full_trig);\n\tled_trigger_unregister_simple(psy->charging_trig);\n\tled_trigger_unregister_simple(psy->full_trig);\n\tled_trigger_unregister_simple(psy->charging_blink_full_solid_trig);\n\tkfree(psy->charging_blink_full_solid_trig_name);\n\tkfree(psy->full_trig_name);\n\tkfree(psy->charging_trig_name);\n\tkfree(psy->charging_full_trig_name);\n}\n\n \n\nstatic void power_supply_update_gen_leds(struct power_supply *psy)\n{\n\tunion power_supply_propval online;\n\n\tif (power_supply_get_property(psy, POWER_SUPPLY_PROP_ONLINE, &online))\n\t\treturn;\n\n\tdev_dbg(&psy->dev, \"%s %d\\n\", __func__, online.intval);\n\n\tif (online.intval)\n\t\tled_trigger_event(psy->online_trig, LED_FULL);\n\telse\n\t\tled_trigger_event(psy->online_trig, LED_OFF);\n}\n\nstatic int power_supply_create_gen_triggers(struct power_supply *psy)\n{\n\tpsy->online_trig_name = kasprintf(GFP_KERNEL, \"%s-online\",\n\t\t\t\t\t  psy->desc->name);\n\tif (!psy->online_trig_name)\n\t\treturn -ENOMEM;\n\n\tled_trigger_register_simple(psy->online_trig_name, &psy->online_trig);\n\n\treturn 0;\n}\n\nstatic void power_supply_remove_gen_triggers(struct power_supply *psy)\n{\n\tled_trigger_unregister_simple(psy->online_trig);\n\tkfree(psy->online_trig_name);\n}\n\n \n\nvoid power_supply_update_leds(struct power_supply *psy)\n{\n\tif (psy->desc->type == POWER_SUPPLY_TYPE_BATTERY)\n\t\tpower_supply_update_bat_leds(psy);\n\telse\n\t\tpower_supply_update_gen_leds(psy);\n}\n\nint power_supply_create_triggers(struct power_supply *psy)\n{\n\tif (psy->desc->type == POWER_SUPPLY_TYPE_BATTERY)\n\t\treturn power_supply_create_bat_triggers(psy);\n\treturn power_supply_create_gen_triggers(psy);\n}\n\nvoid power_supply_remove_triggers(struct power_supply *psy)\n{\n\tif (psy->desc->type == POWER_SUPPLY_TYPE_BATTERY)\n\t\tpower_supply_remove_bat_triggers(psy);\n\telse\n\t\tpower_supply_remove_gen_triggers(psy);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}