{
  "module_name": "rtrs-clt.h",
  "hash_id": "29ccccb7a1c050442ed184dbb612280864cf0ec483b883b35fd8af2932a1c5e8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/ulp/rtrs/rtrs-clt.h",
  "human_readable_source": " \n \n\n#ifndef RTRS_CLT_H\n#define RTRS_CLT_H\n\n#include <linux/device.h>\n#include \"rtrs-pri.h\"\n\n \nenum rtrs_clt_state {\n\tRTRS_CLT_CONNECTING,\n\tRTRS_CLT_CONNECTING_ERR,\n\tRTRS_CLT_RECONNECTING,\n\tRTRS_CLT_CONNECTED,\n\tRTRS_CLT_CLOSING,\n\tRTRS_CLT_CLOSED,\n\tRTRS_CLT_DEAD,\n};\n\nenum rtrs_mp_policy {\n\tMP_POLICY_RR,\n\tMP_POLICY_MIN_INFLIGHT,\n\tMP_POLICY_MIN_LATENCY,\n};\n\n \nstruct rtrs_clt_stats_reconnects {\n\tint successful_cnt;\n\tint fail_cnt;\n};\n\n \nstruct rtrs_clt_stats_cpu_migr {\n\tatomic_t from;\n\tint to;\n};\n\n \nstruct rtrs_clt_stats_rdma {\n\tstruct {\n\t\tu64 cnt;\n\t\tu64 size_total;\n\t} dir[2];\n\n\tu64 failover_cnt;\n};\n\nstruct rtrs_clt_stats_pcpu {\n\tstruct rtrs_clt_stats_cpu_migr\t\tcpu_migr;\n\tstruct rtrs_clt_stats_rdma\t\trdma;\n};\n\nstruct rtrs_clt_stats {\n\tstruct kobject\t\t\t\tkobj_stats;\n\tstruct rtrs_clt_stats_pcpu    __percpu\t*pcpu_stats;\n\tstruct rtrs_clt_stats_reconnects\treconnects;\n\tatomic_t\t\t\t\tinflight;\n};\n\nstruct rtrs_clt_con {\n\tstruct rtrs_con\tc;\n\tstruct rtrs_iu\t\t*rsp_ius;\n\tu32\t\t\tqueue_num;\n\tunsigned int\t\tcpu;\n\tstruct mutex\t\tcon_mutex;\n\tint\t\t\tcm_err;\n};\n\n \nstruct rtrs_permit {\n\tenum rtrs_clt_con_type con_type;\n\tunsigned int cpu_id;\n\tunsigned int mem_id;\n\tunsigned int mem_off;\n};\n\n \nstruct rtrs_clt_io_req {\n\tstruct list_head        list;\n\tstruct rtrs_iu\t\t*iu;\n\tstruct scatterlist\t*sglist;  \n\tunsigned int\t\tsg_cnt;\n\tunsigned int\t\tsg_size;\n\tunsigned int\t\tdata_len;\n\tunsigned int\t\tusr_len;\n\tvoid\t\t\t*priv;\n\tbool\t\t\tin_use;\n\tenum rtrs_mp_policy     mp_policy;\n\tstruct rtrs_clt_con\t*con;\n\tstruct rtrs_sg_desc\t*desc;\n\tstruct ib_sge\t\t*sge;\n\tstruct rtrs_permit\t*permit;\n\tenum dma_data_direction dir;\n\tvoid\t\t\t(*conf)(void *priv, int errno);\n\tunsigned long\t\tstart_jiffies;\n\n\tstruct ib_mr\t\t*mr;\n\tstruct ib_cqe\t\tinv_cqe;\n\tstruct completion\tinv_comp;\n\tint\t\t\tinv_errno;\n\tbool\t\t\tneed_inv_comp;\n\tbool\t\t\tneed_inv;\n\trefcount_t\t\tref;\n};\n\nstruct rtrs_rbuf {\n\tu64 addr;\n\tu32 rkey;\n};\n\nstruct rtrs_clt_path {\n\tstruct rtrs_path\ts;\n\tstruct rtrs_clt_sess\t*clt;\n\twait_queue_head_t\tstate_wq;\n\tenum rtrs_clt_state\tstate;\n\tatomic_t\t\tconnected_cnt;\n\tstruct mutex\t\tinit_mutex;\n\tstruct rtrs_clt_io_req\t*reqs;\n\tstruct delayed_work\treconnect_dwork;\n\tstruct work_struct\tclose_work;\n\tstruct work_struct\terr_recovery_work;\n\tunsigned int\t\treconnect_attempts;\n\tbool\t\t\testablished;\n\tstruct rtrs_rbuf\t*rbufs;\n\tsize_t\t\t\tmax_io_size;\n\tu32\t\t\tmax_hdr_size;\n\tu32\t\t\tchunk_size;\n\tsize_t\t\t\tqueue_depth;\n\tu32\t\t\tmax_pages_per_mr;\n\tu32\t\t\tflags;\n\tstruct kobject\t\tkobj;\n\tu8\t\t\tfor_new_clt;\n\tstruct rtrs_clt_stats\t*stats;\n\t \n\tu8\t\t\thca_port;\n\tchar                    hca_name[IB_DEVICE_NAME_MAX];\n\tstruct list_head __percpu\n\t\t\t\t*mp_skip_entry;\n};\n\nstruct rtrs_clt_sess {\n\tstruct list_head\tpaths_list;  \n\tsize_t\t\t\tpaths_num;\n\tstruct rtrs_clt_path\n\t__rcu * __percpu\t*pcpu_path;\n\tuuid_t\t\t\tpaths_uuid;\n\tint\t\t\tpaths_up;\n\tstruct mutex\t\tpaths_mutex;\n\tstruct mutex\t\tpaths_ev_mutex;\n\tchar\t\t\tsessname[NAME_MAX];\n\tu16\t\t\tport;\n\tunsigned int\t\tmax_reconnect_attempts;\n\tunsigned int\t\treconnect_delay_sec;\n\tunsigned int\t\tmax_segments;\n\tvoid\t\t\t*permits;\n\tunsigned long\t\t*permits_map;\n\tsize_t\t\t\tqueue_depth;\n\tsize_t\t\t\tmax_io_size;\n\twait_queue_head_t\tpermits_wait;\n\tsize_t\t\t\tpdu_sz;\n\tvoid\t\t\t*priv;\n\tvoid\t\t\t(*link_ev)(void *priv,\n\t\t\t\t\t   enum rtrs_clt_link_ev ev);\n\tstruct device\t\tdev;\n\tstruct kobject\t\t*kobj_paths;\n\tenum rtrs_mp_policy\tmp_policy;\n};\n\nstatic inline struct rtrs_clt_con *to_clt_con(struct rtrs_con *c)\n{\n\treturn container_of(c, struct rtrs_clt_con, c);\n}\n\nstatic inline struct rtrs_clt_path *to_clt_path(struct rtrs_path *s)\n{\n\treturn container_of(s, struct rtrs_clt_path, s);\n}\n\nstatic inline int permit_size(struct rtrs_clt_sess *clt)\n{\n\treturn sizeof(struct rtrs_permit) + clt->pdu_sz;\n}\n\nstatic inline struct rtrs_permit *get_permit(struct rtrs_clt_sess *clt,\n\t\t\t\t\t     int idx)\n{\n\treturn (struct rtrs_permit *)(clt->permits + permit_size(clt) * idx);\n}\n\nint rtrs_clt_reconnect_from_sysfs(struct rtrs_clt_path *path);\nvoid rtrs_clt_close_conns(struct rtrs_clt_path *clt_path, bool wait);\nint rtrs_clt_create_path_from_sysfs(struct rtrs_clt_sess *clt,\n\t\t\t\t     struct rtrs_addr *addr);\nint rtrs_clt_remove_path_from_sysfs(struct rtrs_clt_path *path,\n\t\t\t\t     const struct attribute *sysfs_self);\n\nvoid rtrs_clt_set_max_reconnect_attempts(struct rtrs_clt_sess *clt, int value);\nint rtrs_clt_get_max_reconnect_attempts(const struct rtrs_clt_sess *clt);\nvoid free_path(struct rtrs_clt_path *clt_path);\n\n \n\nint rtrs_clt_init_stats(struct rtrs_clt_stats *stats);\n\nvoid rtrs_clt_inc_failover_cnt(struct rtrs_clt_stats *s);\n\nvoid rtrs_clt_update_wc_stats(struct rtrs_clt_con *con);\nvoid rtrs_clt_update_all_stats(struct rtrs_clt_io_req *req, int dir);\n\nint rtrs_clt_reset_rdma_lat_distr_stats(struct rtrs_clt_stats *stats,\n\t\t\t\t\t bool enable);\nssize_t rtrs_clt_stats_rdma_lat_distr_to_str(struct rtrs_clt_stats *stats,\n\t\t\t\t\t      char *page);\nint rtrs_clt_reset_cpu_migr_stats(struct rtrs_clt_stats *stats, bool enable);\nint rtrs_clt_stats_migration_from_cnt_to_str(struct rtrs_clt_stats *stats, char *buf);\nint rtrs_clt_stats_migration_to_cnt_to_str(struct rtrs_clt_stats *stats, char *buf);\nint rtrs_clt_reset_reconnects_stat(struct rtrs_clt_stats *stats, bool enable);\nint rtrs_clt_stats_reconnects_to_str(struct rtrs_clt_stats *stats, char *buf);\nint rtrs_clt_reset_rdma_stats(struct rtrs_clt_stats *stats, bool enable);\nssize_t rtrs_clt_stats_rdma_to_str(struct rtrs_clt_stats *stats,\n\t\t\t\t    char *page);\nint rtrs_clt_reset_all_stats(struct rtrs_clt_stats *stats, bool enable);\nssize_t rtrs_clt_reset_all_help(struct rtrs_clt_stats *stats,\n\t\t\t\t char *page);\n\n \n\nint rtrs_clt_create_sysfs_root_files(struct rtrs_clt_sess *clt);\nvoid rtrs_clt_destroy_sysfs_root(struct rtrs_clt_sess *clt);\n\nint rtrs_clt_create_path_files(struct rtrs_clt_path *clt_path);\nvoid rtrs_clt_destroy_path_files(struct rtrs_clt_path *clt_path,\n\t\t\t\t  const struct attribute *sysfs_self);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}