{
  "module_name": "ib_srp.h",
  "hash_id": "1088170e4063bca93633e20f258518d1fa42b190cc20df2a76251260e3221e40",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/ulp/srp/ib_srp.h",
  "human_readable_source": " \n\n#ifndef IB_SRP_H\n#define IB_SRP_H\n\n#include <linux/types.h>\n#include <linux/list.h>\n#include <linux/mutex.h>\n#include <linux/scatterlist.h>\n\n#include <scsi/scsi_host.h>\n#include <scsi/scsi_cmnd.h>\n\n#include <rdma/ib_verbs.h>\n#include <rdma/ib_sa.h>\n#include <rdma/ib_cm.h>\n#include <rdma/rdma_cm.h>\n\nenum {\n\tSRP_PATH_REC_TIMEOUT_MS\t= 1000,\n\tSRP_ABORT_TIMEOUT_MS\t= 5000,\n\n\tSRP_PORT_REDIRECT\t= 1,\n\tSRP_DLID_REDIRECT\t= 2,\n\tSRP_STALE_CONN\t\t= 3,\n\n\tSRP_DEF_SG_TABLESIZE\t= 12,\n\n\tSRP_DEFAULT_QUEUE_SIZE\t= 1 << 6,\n\tSRP_RSP_SQ_SIZE\t\t= 1,\n\tSRP_TSK_MGMT_SQ_SIZE\t= 1,\n\tSRP_DEFAULT_CMD_SQ_SIZE = SRP_DEFAULT_QUEUE_SIZE - SRP_RSP_SQ_SIZE -\n\t\t\t\t  SRP_TSK_MGMT_SQ_SIZE,\n\n\tSRP_MAX_PAGES_PER_MR\t= 512,\n\n\tSRP_MAX_ADD_CDB_LEN\t= 16,\n\n\tSRP_MAX_IMM_SGE\t\t= 2,\n\tSRP_MAX_SGE\t\t= SRP_MAX_IMM_SGE + 1,\n\t \n\tSRP_IMM_DATA_OFFSET\t= sizeof(struct srp_cmd) +\n\t\t\t\t  SRP_MAX_ADD_CDB_LEN +\n\t\t\t\t  sizeof(struct srp_imm_buf),\n};\n\nenum {\n\tSRP_TAG_NO_REQ\t\t= ~0U,\n\tSRP_TAG_TSK_MGMT\t= BIT(31),\n};\n\nenum srp_target_state {\n\tSRP_TARGET_SCANNING,\n\tSRP_TARGET_LIVE,\n\tSRP_TARGET_REMOVED,\n};\n\nenum srp_iu_type {\n\tSRP_IU_CMD,\n\tSRP_IU_TSK_MGMT,\n\tSRP_IU_RSP,\n};\n\n \nstruct srp_device {\n\tstruct list_head\tdev_list;\n\tstruct ib_device       *dev;\n\tstruct ib_pd\t       *pd;\n\tu32\t\t\tglobal_rkey;\n\tu64\t\t\tmr_page_mask;\n\tint\t\t\tmr_page_size;\n\tint\t\t\tmr_max_size;\n\tint\t\t\tmax_pages_per_mr;\n\tbool\t\t\thas_fr;\n\tbool\t\t\tuse_fast_reg;\n};\n\n \nstruct srp_host {\n\tstruct srp_device      *srp_dev;\n\tu32\t\t\tport;\n\tstruct device\t\tdev;\n\tstruct list_head\ttarget_list;\n\tspinlock_t\t\ttarget_lock;\n\tstruct list_head\tlist;\n\tstruct mutex\t\tadd_target_mutex;\n};\n\nstruct srp_request {\n\tstruct scsi_cmnd       *scmnd;\n\tstruct srp_iu\t       *cmd;\n\tstruct srp_fr_desc     **fr_list;\n\tstruct srp_direct_buf  *indirect_desc;\n\tdma_addr_t\t\tindirect_dma_addr;\n\tshort\t\t\tnmdesc;\n\tstruct ib_cqe\t\treg_cqe;\n};\n\n \nstruct srp_rdma_ch {\n\t \n\tstruct list_head\tfree_tx;\n\tspinlock_t\t\tlock;\n\ts32\t\t\treq_lim;\n\n\t \n\tstruct srp_target_port *target ____cacheline_aligned_in_smp;\n\tstruct ib_cq\t       *send_cq;\n\tstruct ib_cq\t       *recv_cq;\n\tstruct ib_qp\t       *qp;\n\tstruct srp_fr_pool     *fr_pool;\n\tuint32_t\t\tmax_it_iu_len;\n\tuint32_t\t\tmax_ti_iu_len;\n\tu8\t\t\tmax_imm_sge;\n\tbool\t\t\tuse_imm_data;\n\n\t \n\n\tstruct completion\tdone;\n\tint\t\t\tstatus;\n\n\tunion {\n\t\tstruct ib_cm {\n\t\t\tstruct sa_path_rec\tpath;\n\t\t\tstruct ib_sa_query\t*path_query;\n\t\t\tint\t\t\tpath_query_id;\n\t\t\tstruct ib_cm_id\t\t*cm_id;\n\t\t} ib_cm;\n\t\tstruct rdma_cm {\n\t\t\tstruct rdma_cm_id\t*cm_id;\n\t\t} rdma_cm;\n\t};\n\n\tstruct srp_iu\t      **tx_ring;\n\tstruct srp_iu\t      **rx_ring;\n\tint\t\t\tcomp_vector;\n\n\tu64\t\t\ttsk_mgmt_tag;\n\tstruct completion\ttsk_mgmt_done;\n\tu8\t\t\ttsk_mgmt_status;\n\tbool\t\t\tconnected;\n};\n\n \nstruct srp_target_port {\n\t \n\tspinlock_t\t\tlock;\n\n\t \n\tu32\t\t\tglobal_rkey;\n\tstruct srp_rdma_ch\t*ch;\n\tstruct net\t\t*net;\n\tu32\t\t\tch_count;\n\tu32\t\t\tlkey;\n\tenum srp_target_state\tstate;\n\tuint32_t\t\tmax_it_iu_size;\n\tunsigned int\t\tcmd_sg_cnt;\n\tunsigned int\t\tindirect_size;\n\tbool\t\t\tallow_ext_sg;\n\n\t \n\tunion ib_gid\t\tsgid;\n\t__be64\t\t\tid_ext;\n\t__be64\t\t\tioc_guid;\n\t__be64\t\t\tinitiator_ext;\n\tu16\t\t\tio_class;\n\tstruct srp_host\t       *srp_host;\n\tstruct Scsi_Host       *scsi_host;\n\tstruct srp_rport       *rport;\n\tchar\t\t\ttarget_name[32];\n\tunsigned int\t\tscsi_id;\n\tunsigned int\t\tsg_tablesize;\n\tunsigned int\t\ttarget_can_queue;\n\tint\t\t\tmr_pool_size;\n\tint\t\t\tmr_per_cmd;\n\tint\t\t\tqueue_size;\n\tint\t\t\tcomp_vector;\n\tint\t\t\ttl_retry_count;\n\n\tbool\t\t\tusing_rdma_cm;\n\n\tunion {\n\t\tstruct {\n\t\t\t__be64\t\t\tservice_id;\n\t\t\tunion ib_gid\t\torig_dgid;\n\t\t\t__be16\t\t\tpkey;\n\t\t} ib_cm;\n\t\tstruct {\n\t\t\tunion {\n\t\t\t\tstruct sockaddr_in\tip4;\n\t\t\t\tstruct sockaddr_in6\tip6;\n\t\t\t\tstruct sockaddr\t\tsa;\n\t\t\t\tstruct sockaddr_storage ss;\n\t\t\t} src;\n\t\t\tunion {\n\t\t\t\tstruct sockaddr_in\tip4;\n\t\t\t\tstruct sockaddr_in6\tip6;\n\t\t\t\tstruct sockaddr\t\tsa;\n\t\t\t\tstruct sockaddr_storage ss;\n\t\t\t} dst;\n\t\t\tbool src_specified;\n\t\t} rdma_cm;\n\t};\n\n\tu32\t\t\trq_tmo_jiffies;\n\n\tint\t\t\tzero_req_lim;\n\n\tstruct work_struct\ttl_err_work;\n\tstruct work_struct\tremove_work;\n\n\tstruct list_head\tlist;\n\tbool\t\t\tqp_in_error;\n};\n\nstruct srp_iu {\n\tstruct list_head\tlist;\n\tu64\t\t\tdma;\n\tvoid\t\t       *buf;\n\tsize_t\t\t\tsize;\n\tenum dma_data_direction\tdirection;\n\tu32\t\t\tnum_sge;\n\tstruct ib_sge\t\tsge[SRP_MAX_SGE];\n\tstruct ib_cqe\t\tcqe;\n};\n\n \nstruct srp_fr_desc {\n\tstruct list_head\t\tentry;\n\tstruct ib_mr\t\t\t*mr;\n};\n\n \nstruct srp_fr_pool {\n\tint\t\t\tsize;\n\tint\t\t\tmax_page_list_len;\n\tspinlock_t\t\tlock;\n\tstruct list_head\tfree_list;\n\tstruct srp_fr_desc\tdesc[];\n};\n\n \nstruct srp_map_state {\n\tunion {\n\t\tstruct {\n\t\t\tstruct srp_fr_desc **next;\n\t\t\tstruct srp_fr_desc **end;\n\t\t} fr;\n\t\tstruct {\n\t\t\tvoid\t\t   **next;\n\t\t\tvoid\t\t   **end;\n\t\t} gen;\n\t};\n\tstruct srp_direct_buf  *desc;\n\tunion {\n\t\tu64\t\t\t*pages;\n\t\tstruct scatterlist\t*sg;\n\t};\n\tdma_addr_t\t\tbase_dma_addr;\n\tu32\t\t\tdma_len;\n\tu32\t\t\ttotal_len;\n\tunsigned int\t\tnpages;\n\tunsigned int\t\tnmdesc;\n\tunsigned int\t\tndesc;\n};\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}