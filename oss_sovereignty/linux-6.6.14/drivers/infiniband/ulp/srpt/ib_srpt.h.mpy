{
  "module_name": "ib_srpt.h",
  "hash_id": "01c58563071bc1ebc09213c57ea805d97f97eae5af32de80b31ee5930a37da67",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/ulp/srpt/ib_srpt.h",
  "human_readable_source": " \n\n#ifndef IB_SRPT_H\n#define IB_SRPT_H\n\n#include <linux/types.h>\n#include <linux/list.h>\n#include <linux/wait.h>\n\n#include <rdma/ib_verbs.h>\n#include <rdma/ib_sa.h>\n#include <rdma/ib_cm.h>\n#include <rdma/rdma_cm.h>\n#include <rdma/rw.h>\n\n#include <scsi/srp.h>\n\n#include \"ib_dm_mad.h\"\n\n \n#define SRP_SERVICE_NAME_PREFIX\t\t\"SRP.T10:\"\n\nstruct srpt_nexus;\n\nenum {\n\t \n\tSRP_PROTOCOL = 0x0108,\n\tSRP_PROTOCOL_VERSION = 0x0001,\n\tSRP_IO_SUBCLASS = 0x609e,\n\tSRP_SEND_TO_IOC = 0x01,\n\tSRP_SEND_FROM_IOC = 0x02,\n\tSRP_RDMA_READ_FROM_IOC = 0x08,\n\tSRP_RDMA_WRITE_FROM_IOC = 0x20,\n\n\t \n\tSRP_MTCH_ACTION = 0x03,  \n\tSRP_LOSOLNT = 0x10,  \n\tSRP_CRSOLNT = 0x20,  \n\tSRP_AESOLNT = 0x40,  \n\n\t \n\tSRP_SCSOLNT = 0x02,  \n\tSRP_UCSOLNT = 0x04,  \n\n\t \n\tSRP_SOLNT = 0x01,  \n\n\t \n\tSRP_TSK_MGMT_SUCCESS = 0x00,\n\tSRP_TSK_MGMT_FUNC_NOT_SUPP = 0x04,\n\tSRP_TSK_MGMT_FAILED = 0x05,\n\n\t \n\tSRP_CMD_SIMPLE_Q = 0x0,\n\tSRP_CMD_HEAD_OF_Q = 0x1,\n\tSRP_CMD_ORDERED_Q = 0x2,\n\tSRP_CMD_ACA = 0x4,\n\n\tSRPT_DEF_SG_TABLESIZE = 128,\n\n\tMIN_SRPT_SQ_SIZE = 16,\n\tDEF_SRPT_SQ_SIZE = 4096,\n\tMAX_SRPT_RQ_SIZE = 128,\n\tMIN_SRPT_SRQ_SIZE = 4,\n\tDEFAULT_SRPT_SRQ_SIZE = 4095,\n\tMAX_SRPT_SRQ_SIZE = 65535,\n\tMAX_SRPT_RDMA_SIZE = 1U << 24,\n\tMAX_SRPT_RSP_SIZE = 1024,\n\n\tSRP_MAX_ADD_CDB_LEN = 16,\n\tSRP_MAX_IMM_DATA_OFFSET = 80,\n\tSRP_MAX_IMM_DATA = 8 * 1024,\n\tMIN_MAX_REQ_SIZE = 996,\n\tDEFAULT_MAX_REQ_SIZE_1 = sizeof(struct srp_cmd)  +\n\t\t\t\t SRP_MAX_ADD_CDB_LEN +\n\t\t\t\t sizeof(struct srp_indirect_buf)  +\n\t\t\t\t 128 * sizeof(struct srp_direct_buf) ,\n\tDEFAULT_MAX_REQ_SIZE_2 = SRP_MAX_IMM_DATA_OFFSET +\n\t\t\t\t sizeof(struct srp_imm_buf) + SRP_MAX_IMM_DATA,\n\tDEFAULT_MAX_REQ_SIZE = DEFAULT_MAX_REQ_SIZE_1 > DEFAULT_MAX_REQ_SIZE_2 ?\n\t\t\t       DEFAULT_MAX_REQ_SIZE_1 : DEFAULT_MAX_REQ_SIZE_2,\n\n\tMIN_MAX_RSP_SIZE = sizeof(struct srp_rsp)  + 4,\n\tDEFAULT_MAX_RSP_SIZE = 256,  \n\n\tDEFAULT_MAX_RDMA_SIZE = 65536,\n};\n\n \nenum srpt_command_state {\n\tSRPT_STATE_NEW\t\t = 0,\n\tSRPT_STATE_NEED_DATA\t = 1,\n\tSRPT_STATE_DATA_IN\t = 2,\n\tSRPT_STATE_CMD_RSP_SENT\t = 3,\n\tSRPT_STATE_MGMT\t\t = 4,\n\tSRPT_STATE_MGMT_RSP_SENT = 5,\n\tSRPT_STATE_DONE\t\t = 6,\n};\n\n \nstruct srpt_ioctx {\n\tstruct ib_cqe\t\tcqe;\n\tvoid\t\t\t*buf;\n\tdma_addr_t\t\tdma;\n\tuint32_t\t\toffset;\n\tuint32_t\t\tindex;\n};\n\n \nstruct srpt_recv_ioctx {\n\tstruct srpt_ioctx\tioctx;\n\tstruct list_head\twait_list;\n\tint\t\t\tbyte_len;\n};\n\nstruct srpt_rw_ctx {\n\tstruct rdma_rw_ctx\trw;\n\tstruct scatterlist\t*sg;\n\tunsigned int\t\tnents;\n};\n\n \nstruct srpt_send_ioctx {\n\tstruct srpt_ioctx\tioctx;\n\tstruct srpt_rdma_ch\t*ch;\n\tstruct srpt_recv_ioctx\t*recv_ioctx;\n\n\tstruct srpt_rw_ctx\ts_rw_ctx;\n\tstruct srpt_rw_ctx\t*rw_ctxs;\n\n\tstruct scatterlist\timm_sg;\n\n\tstruct ib_cqe\t\trdma_cqe;\n\tenum srpt_command_state\tstate;\n\tstruct se_cmd\t\tcmd;\n\tu8\t\t\tn_rdma;\n\tu8\t\t\tn_rw_ctx;\n\tbool\t\t\tqueue_status_only;\n\tu8\t\t\tsense_data[TRANSPORT_SENSE_BUFFER];\n};\n\n \nenum rdma_ch_state {\n\tCH_CONNECTING,\n\tCH_LIVE,\n\tCH_DISCONNECTING,\n\tCH_DRAINING,\n\tCH_DISCONNECTED,\n};\n\n \nstruct srpt_rdma_ch {\n\tstruct srpt_nexus\t*nexus;\n\tstruct ib_qp\t\t*qp;\n\tunion {\n\t\tstruct {\n\t\t\tstruct ib_cm_id\t\t*cm_id;\n\t\t} ib_cm;\n\t\tstruct {\n\t\t\tstruct rdma_cm_id\t*cm_id;\n\t\t} rdma_cm;\n\t};\n\tstruct ib_cq\t\t*cq;\n\tu32\t\t\tcq_size;\n\tstruct ib_cqe\t\tzw_cqe;\n\tstruct rcu_head\t\trcu;\n\tstruct kref\t\tkref;\n\tstruct completion\t*closed;\n\tint\t\t\trq_size;\n\tu32\t\t\tmax_rsp_size;\n\tatomic_t\t\tsq_wr_avail;\n\tstruct srpt_port\t*sport;\n\tint\t\t\tmax_ti_iu_len;\n\tatomic_t\t\treq_lim;\n\tatomic_t\t\treq_lim_delta;\n\tu16\t\t\timm_data_offset;\n\tspinlock_t\t\tspinlock;\n\tenum rdma_ch_state\tstate;\n\tstruct kmem_cache\t*rsp_buf_cache;\n\tstruct srpt_send_ioctx\t**ioctx_ring;\n\tstruct kmem_cache\t*req_buf_cache;\n\tstruct srpt_recv_ioctx\t**ioctx_recv_ring;\n\tstruct list_head\tlist;\n\tstruct list_head\tcmd_wait_list;\n\tuint16_t\t\tpkey;\n\tbool\t\t\tusing_rdma_cm;\n\tbool\t\t\tprocessing_wait_list;\n\tstruct se_session\t*sess;\n\tu8\t\t\tsess_name[40];\n\tstruct work_struct\trelease_work;\n};\n\n \nstruct srpt_nexus {\n\tstruct rcu_head\t\trcu;\n\tstruct list_head\tentry;\n\tstruct list_head\tch_list;\n\tu8\t\t\ti_port_id[16];\n\tu8\t\t\tt_port_id[16];\n};\n\n \nstruct srpt_port_attrib {\n\tu32\t\t\tsrp_max_rdma_size;\n\tu32\t\t\tsrp_max_rsp_size;\n\tu32\t\t\tsrp_sq_size;\n\tbool\t\t\tuse_srq;\n};\n\n \nstruct srpt_tpg {\n\tstruct list_head\tentry;\n\tstruct srpt_port_id\t*sport_id;\n\tstruct se_portal_group\ttpg;\n};\n\n \nstruct srpt_port_id {\n\tstruct mutex\t\tmutex;\n\tstruct list_head\ttpg_list;\n\tstruct se_wwn\t\twwn;\n\tchar\t\t\tname[64];\n};\n\n \nstruct srpt_port {\n\tstruct srpt_device\t*sdev;\n\tstruct ib_mad_agent\t*mad_agent;\n\tbool\t\t\tenabled;\n\tu8\t\t\tport;\n\tu32\t\t\tsm_lid;\n\tu32\t\t\tlid;\n\tunion ib_gid\t\tgid;\n\tstruct work_struct\twork;\n\tchar\t\t\tguid_name[64];\n\tstruct srpt_port_id\t*guid_id;\n\tchar\t\t\tgid_name[64];\n\tstruct srpt_port_id\t*gid_id;\n\tstruct srpt_port_attrib port_attrib;\n\tatomic_t\t\trefcount;\n\tstruct completion\t*freed_channels;\n\tstruct mutex\t\tmutex;\n\tstruct list_head\tnexus_list;\n};\n\n \nstruct srpt_device {\n\tstruct kref\t\trefcnt;\n\tstruct ib_device\t*device;\n\tstruct ib_pd\t\t*pd;\n\tu32\t\t\tlkey;\n\tstruct ib_srq\t\t*srq;\n\tstruct ib_cm_id\t\t*cm_id;\n\tint\t\t\tsrq_size;\n\tstruct mutex\t\tsdev_mutex;\n\tbool\t\t\tuse_srq;\n\tstruct kmem_cache\t*req_buf_cache;\n\tstruct srpt_recv_ioctx\t**ioctx_ring;\n\tstruct ib_event_handler\tevent_handler;\n\tstruct list_head\tlist;\n\tstruct srpt_port        port[];\n};\n\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}