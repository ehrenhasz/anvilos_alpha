{
  "module_name": "ipoib_fs.c",
  "hash_id": "270861c892662466faa373278cf8b7ca1f328fb6e06aa3dbf6db2838d7792f5d",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/ulp/ipoib/ipoib_fs.c",
  "human_readable_source": " \n\n#include <linux/err.h>\n#include <linux/seq_file.h>\n#include <linux/slab.h>\n\nstruct file_operations;\n\n#include <linux/debugfs.h>\n#include <linux/export.h>\n\n#include \"ipoib.h\"\n\nstatic struct dentry *ipoib_root;\n\nstatic void format_gid(union ib_gid *gid, char *buf)\n{\n\tint i, n;\n\n\tfor (n = 0, i = 0; i < 8; ++i) {\n\t\tn += sprintf(buf + n, \"%x\",\n\t\t\t     be16_to_cpu(((__be16 *) gid->raw)[i]));\n\t\tif (i < 7)\n\t\t\tbuf[n++] = ':';\n\t}\n}\n\nstatic void *ipoib_mcg_seq_start(struct seq_file *file, loff_t *pos)\n{\n\tstruct ipoib_mcast_iter *iter;\n\tloff_t n = *pos;\n\n\titer = ipoib_mcast_iter_init(file->private);\n\tif (!iter)\n\t\treturn NULL;\n\n\twhile (n--) {\n\t\tif (ipoib_mcast_iter_next(iter)) {\n\t\t\tkfree(iter);\n\t\t\treturn NULL;\n\t\t}\n\t}\n\n\treturn iter;\n}\n\nstatic void *ipoib_mcg_seq_next(struct seq_file *file, void *iter_ptr,\n\t\t\t\t   loff_t *pos)\n{\n\tstruct ipoib_mcast_iter *iter = iter_ptr;\n\n\t(*pos)++;\n\n\tif (ipoib_mcast_iter_next(iter)) {\n\t\tkfree(iter);\n\t\treturn NULL;\n\t}\n\n\treturn iter;\n}\n\nstatic void ipoib_mcg_seq_stop(struct seq_file *file, void *iter_ptr)\n{\n\t \n}\n\nstatic int ipoib_mcg_seq_show(struct seq_file *file, void *iter_ptr)\n{\n\tstruct ipoib_mcast_iter *iter = iter_ptr;\n\tchar gid_buf[sizeof \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\"];\n\tunion ib_gid mgid;\n\tunsigned long created;\n\tunsigned int queuelen, complete, send_only;\n\n\tif (!iter)\n\t\treturn 0;\n\n\tipoib_mcast_iter_read(iter, &mgid, &created, &queuelen,\n\t\t\t      &complete, &send_only);\n\n\tformat_gid(&mgid, gid_buf);\n\n\tseq_printf(file,\n\t\t   \"GID: %s\\n\"\n\t\t   \"  created: %10ld\\n\"\n\t\t   \"  queuelen: %9d\\n\"\n\t\t   \"  complete: %9s\\n\"\n\t\t   \"  send_only: %8s\\n\"\n\t\t   \"\\n\",\n\t\t   gid_buf, created, queuelen,\n\t\t   complete ? \"yes\" : \"no\",\n\t\t   send_only ? \"yes\" : \"no\");\n\n\treturn 0;\n}\n\nstatic const struct seq_operations ipoib_mcg_sops = {\n\t.start = ipoib_mcg_seq_start,\n\t.next  = ipoib_mcg_seq_next,\n\t.stop  = ipoib_mcg_seq_stop,\n\t.show  = ipoib_mcg_seq_show,\n};\n\nDEFINE_SEQ_ATTRIBUTE(ipoib_mcg);\n\nstatic void *ipoib_path_seq_start(struct seq_file *file, loff_t *pos)\n{\n\tstruct ipoib_path_iter *iter;\n\tloff_t n = *pos;\n\n\titer = ipoib_path_iter_init(file->private);\n\tif (!iter)\n\t\treturn NULL;\n\n\twhile (n--) {\n\t\tif (ipoib_path_iter_next(iter)) {\n\t\t\tkfree(iter);\n\t\t\treturn NULL;\n\t\t}\n\t}\n\n\treturn iter;\n}\n\nstatic void *ipoib_path_seq_next(struct seq_file *file, void *iter_ptr,\n\t\t\t\t   loff_t *pos)\n{\n\tstruct ipoib_path_iter *iter = iter_ptr;\n\n\t(*pos)++;\n\n\tif (ipoib_path_iter_next(iter)) {\n\t\tkfree(iter);\n\t\treturn NULL;\n\t}\n\n\treturn iter;\n}\n\nstatic void ipoib_path_seq_stop(struct seq_file *file, void *iter_ptr)\n{\n\t \n}\n\nstatic int ipoib_path_seq_show(struct seq_file *file, void *iter_ptr)\n{\n\tstruct ipoib_path_iter *iter = iter_ptr;\n\tchar gid_buf[sizeof \"ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff\"];\n\tstruct ipoib_path path;\n\tint rate;\n\n\tif (!iter)\n\t\treturn 0;\n\n\tipoib_path_iter_read(iter, &path);\n\n\tformat_gid(&path.pathrec.dgid, gid_buf);\n\n\tseq_printf(file,\n\t\t   \"GID: %s\\n\"\n\t\t   \"  complete: %6s\\n\",\n\t\t   gid_buf, sa_path_get_dlid(&path.pathrec) ? \"yes\" : \"no\");\n\n\tif (sa_path_get_dlid(&path.pathrec)) {\n\t\trate = ib_rate_to_mbps(path.pathrec.rate);\n\n\t\tseq_printf(file,\n\t\t\t   \"  DLID:     0x%04x\\n\"\n\t\t\t   \"  SL: %12d\\n\"\n\t\t\t   \"  rate: %8d.%d Gb/sec\\n\",\n\t\t\t   be32_to_cpu(sa_path_get_dlid(&path.pathrec)),\n\t\t\t   path.pathrec.sl,\n\t\t\t   rate / 1000, rate % 1000);\n\t}\n\n\tseq_putc(file, '\\n');\n\n\treturn 0;\n}\n\nstatic const struct seq_operations ipoib_path_sops = {\n\t.start = ipoib_path_seq_start,\n\t.next  = ipoib_path_seq_next,\n\t.stop  = ipoib_path_seq_stop,\n\t.show  = ipoib_path_seq_show,\n};\n\nDEFINE_SEQ_ATTRIBUTE(ipoib_path);\n\nvoid ipoib_create_debug_files(struct net_device *dev)\n{\n\tstruct ipoib_dev_priv *priv = ipoib_priv(dev);\n\tchar name[IFNAMSIZ + sizeof(\"_path\")];\n\n\tsnprintf(name, sizeof(name), \"%s_mcg\", dev->name);\n\tpriv->mcg_dentry = debugfs_create_file(name, S_IFREG | S_IRUGO,\n\t\t\t\t\t       ipoib_root, dev, &ipoib_mcg_fops);\n\n\tsnprintf(name, sizeof(name), \"%s_path\", dev->name);\n\tpriv->path_dentry = debugfs_create_file(name, S_IFREG | S_IRUGO,\n\t\t\t\t\t\tipoib_root, dev, &ipoib_path_fops);\n}\n\nvoid ipoib_delete_debug_files(struct net_device *dev)\n{\n\tstruct ipoib_dev_priv *priv = ipoib_priv(dev);\n\n\tdebugfs_remove(priv->mcg_dentry);\n\tdebugfs_remove(priv->path_dentry);\n\tpriv->mcg_dentry = priv->path_dentry = NULL;\n}\n\nvoid ipoib_register_debugfs(void)\n{\n\tipoib_root = debugfs_create_dir(\"ipoib\", NULL);\n}\n\nvoid ipoib_unregister_debugfs(void)\n{\n\tdebugfs_remove(ipoib_root);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}