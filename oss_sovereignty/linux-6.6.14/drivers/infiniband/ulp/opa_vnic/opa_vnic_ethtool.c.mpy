{
  "module_name": "opa_vnic_ethtool.c",
  "hash_id": "3b6a695a032694db3143b37a7598c57578ec1f58ea688d5eb68abf5a84fbd4e4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/ulp/opa_vnic/opa_vnic_ethtool.c",
  "human_readable_source": " \n\n \n\n#include <linux/ethtool.h>\n\n#include \"opa_vnic_internal.h\"\n\nenum {NETDEV_STATS, VNIC_STATS};\n\nstruct vnic_stats {\n\tchar stat_string[ETH_GSTRING_LEN];\n\tstruct {\n\t\tint sizeof_stat;\n\t\tint stat_offset;\n\t};\n};\n\n#define VNIC_STAT(m)            { sizeof_field(struct opa_vnic_stats, m),   \\\n\t\t\t\t  offsetof(struct opa_vnic_stats, m) }\n\nstatic struct vnic_stats vnic_gstrings_stats[] = {\n\t \n\t{\"rx_packets\", VNIC_STAT(netstats.rx_packets)},\n\t{\"tx_packets\", VNIC_STAT(netstats.tx_packets)},\n\t{\"rx_bytes\", VNIC_STAT(netstats.rx_bytes)},\n\t{\"tx_bytes\", VNIC_STAT(netstats.tx_bytes)},\n\t{\"rx_errors\", VNIC_STAT(netstats.rx_errors)},\n\t{\"tx_errors\", VNIC_STAT(netstats.tx_errors)},\n\t{\"rx_dropped\", VNIC_STAT(netstats.rx_dropped)},\n\t{\"tx_dropped\", VNIC_STAT(netstats.tx_dropped)},\n\n\t \n\t{\"tx_unicast\", VNIC_STAT(tx_grp.unicast)},\n\t{\"tx_mcastbcast\", VNIC_STAT(tx_grp.mcastbcast)},\n\t{\"tx_untagged\", VNIC_STAT(tx_grp.untagged)},\n\t{\"tx_vlan\", VNIC_STAT(tx_grp.vlan)},\n\n\t{\"tx_64_size\", VNIC_STAT(tx_grp.s_64)},\n\t{\"tx_65_127\", VNIC_STAT(tx_grp.s_65_127)},\n\t{\"tx_128_255\", VNIC_STAT(tx_grp.s_128_255)},\n\t{\"tx_256_511\", VNIC_STAT(tx_grp.s_256_511)},\n\t{\"tx_512_1023\", VNIC_STAT(tx_grp.s_512_1023)},\n\t{\"tx_1024_1518\", VNIC_STAT(tx_grp.s_1024_1518)},\n\t{\"tx_1519_max\", VNIC_STAT(tx_grp.s_1519_max)},\n\n\t{\"rx_unicast\", VNIC_STAT(rx_grp.unicast)},\n\t{\"rx_mcastbcast\", VNIC_STAT(rx_grp.mcastbcast)},\n\t{\"rx_untagged\", VNIC_STAT(rx_grp.untagged)},\n\t{\"rx_vlan\", VNIC_STAT(rx_grp.vlan)},\n\n\t{\"rx_64_size\", VNIC_STAT(rx_grp.s_64)},\n\t{\"rx_65_127\", VNIC_STAT(rx_grp.s_65_127)},\n\t{\"rx_128_255\", VNIC_STAT(rx_grp.s_128_255)},\n\t{\"rx_256_511\", VNIC_STAT(rx_grp.s_256_511)},\n\t{\"rx_512_1023\", VNIC_STAT(rx_grp.s_512_1023)},\n\t{\"rx_1024_1518\", VNIC_STAT(rx_grp.s_1024_1518)},\n\t{\"rx_1519_max\", VNIC_STAT(rx_grp.s_1519_max)},\n\n\t \n\t{\"rx_fifo_errors\", VNIC_STAT(netstats.rx_fifo_errors)},\n\t{\"rx_length_errors\", VNIC_STAT(netstats.rx_length_errors)},\n\n\t{\"tx_fifo_errors\", VNIC_STAT(netstats.tx_fifo_errors)},\n\t{\"tx_carrier_errors\", VNIC_STAT(netstats.tx_carrier_errors)},\n\n\t{\"tx_dlid_zero\", VNIC_STAT(tx_dlid_zero)},\n\t{\"tx_drop_state\", VNIC_STAT(tx_drop_state)},\n\t{\"rx_drop_state\", VNIC_STAT(rx_drop_state)},\n\t{\"rx_oversize\", VNIC_STAT(rx_oversize)},\n\t{\"rx_runt\", VNIC_STAT(rx_runt)},\n};\n\n#define VNIC_STATS_LEN  ARRAY_SIZE(vnic_gstrings_stats)\n\n \nstatic void vnic_get_drvinfo(struct net_device *netdev,\n\t\t\t     struct ethtool_drvinfo *drvinfo)\n{\n\tstrscpy(drvinfo->driver, opa_vnic_driver_name, sizeof(drvinfo->driver));\n\tstrscpy(drvinfo->bus_info, dev_name(netdev->dev.parent),\n\t\tsizeof(drvinfo->bus_info));\n}\n\n \nstatic int vnic_get_sset_count(struct net_device *netdev, int sset)\n{\n\treturn (sset == ETH_SS_STATS) ? VNIC_STATS_LEN : -EOPNOTSUPP;\n}\n\n \nstatic void vnic_get_ethtool_stats(struct net_device *netdev,\n\t\t\t\t   struct ethtool_stats *stats, u64 *data)\n{\n\tstruct opa_vnic_adapter *adapter = opa_vnic_priv(netdev);\n\tstruct opa_vnic_stats vstats;\n\tint i;\n\n\tmemset(&vstats, 0, sizeof(vstats));\n\tspin_lock(&adapter->stats_lock);\n\tadapter->rn_ops->ndo_get_stats64(netdev, &vstats.netstats);\n\tspin_unlock(&adapter->stats_lock);\n\tfor (i = 0; i < VNIC_STATS_LEN; i++) {\n\t\tchar *p = (char *)&vstats + vnic_gstrings_stats[i].stat_offset;\n\n\t\tdata[i] = (vnic_gstrings_stats[i].sizeof_stat ==\n\t\t\t   sizeof(u64)) ? *(u64 *)p : *(u32 *)p;\n\t}\n}\n\n \nstatic void vnic_get_strings(struct net_device *netdev, u32 stringset, u8 *data)\n{\n\tint i;\n\n\tif (stringset != ETH_SS_STATS)\n\t\treturn;\n\n\tfor (i = 0; i < VNIC_STATS_LEN; i++)\n\t\tmemcpy(data + i * ETH_GSTRING_LEN,\n\t\t       vnic_gstrings_stats[i].stat_string,\n\t\t       ETH_GSTRING_LEN);\n}\n\n \nstatic const struct ethtool_ops opa_vnic_ethtool_ops = {\n\t.get_drvinfo = vnic_get_drvinfo,\n\t.get_link = ethtool_op_get_link,\n\t.get_strings = vnic_get_strings,\n\t.get_sset_count = vnic_get_sset_count,\n\t.get_ethtool_stats = vnic_get_ethtool_stats,\n};\n\n \nvoid opa_vnic_set_ethtool_ops(struct net_device *netdev)\n{\n\tnetdev->ethtool_ops = &opa_vnic_ethtool_ops;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}