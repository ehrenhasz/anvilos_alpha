{
  "module_name": "mthca_memfree.h",
  "hash_id": "1408df1ad19915688d013d3ebe89a7b347a938d859fd1e465126dd662d05ef16",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/mthca/mthca_memfree.h",
  "human_readable_source": " \n\n#ifndef MTHCA_MEMFREE_H\n#define MTHCA_MEMFREE_H\n\n#include <linux/list.h>\n#include <linux/mutex.h>\n\n#define MTHCA_ICM_CHUNK_LEN \\\n\t((256 - sizeof (struct list_head) - 2 * sizeof (int)) /\t\t\\\n\t (sizeof (struct scatterlist)))\n\nenum {\n\tMTHCA_ICM_PAGE_SHIFT\t= 12,\n\tMTHCA_ICM_PAGE_SIZE\t= 1 << MTHCA_ICM_PAGE_SHIFT,\n\tMTHCA_DB_REC_PER_PAGE\t= MTHCA_ICM_PAGE_SIZE / 8\n};\n\nstruct mthca_icm_chunk {\n\tstruct list_head   list;\n\tint                npages;\n\tint                nsg;\n\tstruct scatterlist mem[MTHCA_ICM_CHUNK_LEN];\n};\n\nstruct mthca_icm {\n\tstruct list_head chunk_list;\n\tint              refcount;\n};\n\nstruct mthca_icm_table {\n\tu64               virt;\n\tint               num_icm;\n\tint               num_obj;\n\tint               obj_size;\n\tint               lowmem;\n\tint               coherent;\n\tstruct mutex      mutex;\n\tstruct mthca_icm *icm[];\n};\n\nstruct mthca_icm_iter {\n\tstruct mthca_icm       *icm;\n\tstruct mthca_icm_chunk *chunk;\n\tint                     page_idx;\n};\n\nstruct mthca_dev;\n\nstruct mthca_icm *mthca_alloc_icm(struct mthca_dev *dev, int npages,\n\t\t\t\t  gfp_t gfp_mask, int coherent);\nvoid mthca_free_icm(struct mthca_dev *dev, struct mthca_icm *icm, int coherent);\n\nstruct mthca_icm_table *mthca_alloc_icm_table(struct mthca_dev *dev,\n\t\t\t\t\t      u64 virt, int obj_size,\n\t\t\t\t\t      int nobj, int reserved,\n\t\t\t\t\t      int use_lowmem, int use_coherent);\nvoid mthca_free_icm_table(struct mthca_dev *dev, struct mthca_icm_table *table);\nint mthca_table_get(struct mthca_dev *dev, struct mthca_icm_table *table, int obj);\nvoid mthca_table_put(struct mthca_dev *dev, struct mthca_icm_table *table, int obj);\nvoid *mthca_table_find(struct mthca_icm_table *table, int obj, dma_addr_t *dma_handle);\nint mthca_table_get_range(struct mthca_dev *dev, struct mthca_icm_table *table,\n\t\t\t  int start, int end);\nvoid mthca_table_put_range(struct mthca_dev *dev, struct mthca_icm_table *table,\n\t\t\t   int start, int end);\n\nstatic inline void mthca_icm_first(struct mthca_icm *icm,\n\t\t\t\t   struct mthca_icm_iter *iter)\n{\n\titer->icm      = icm;\n\titer->chunk    = list_empty(&icm->chunk_list) ?\n\t\tNULL : list_entry(icm->chunk_list.next,\n\t\t\t\t  struct mthca_icm_chunk, list);\n\titer->page_idx = 0;\n}\n\nstatic inline int mthca_icm_last(struct mthca_icm_iter *iter)\n{\n\treturn !iter->chunk;\n}\n\nstatic inline void mthca_icm_next(struct mthca_icm_iter *iter)\n{\n\tif (++iter->page_idx >= iter->chunk->nsg) {\n\t\tif (iter->chunk->list.next == &iter->icm->chunk_list) {\n\t\t\titer->chunk = NULL;\n\t\t\treturn;\n\t\t}\n\n\t\titer->chunk = list_entry(iter->chunk->list.next,\n\t\t\t\t\t struct mthca_icm_chunk, list);\n\t\titer->page_idx = 0;\n\t}\n}\n\nstatic inline dma_addr_t mthca_icm_addr(struct mthca_icm_iter *iter)\n{\n\treturn sg_dma_address(&iter->chunk->mem[iter->page_idx]);\n}\n\nstatic inline unsigned long mthca_icm_size(struct mthca_icm_iter *iter)\n{\n\treturn sg_dma_len(&iter->chunk->mem[iter->page_idx]);\n}\n\nstruct mthca_db_page {\n\tDECLARE_BITMAP(used, MTHCA_DB_REC_PER_PAGE);\n\t__be64    *db_rec;\n\tdma_addr_t mapping;\n};\n\nstruct mthca_db_table {\n\tint \t       \t      npages;\n\tint \t       \t      max_group1;\n\tint \t       \t      min_group2;\n\tstruct mthca_db_page *page;\n\tstruct mutex          mutex;\n};\n\nenum mthca_db_type {\n\tMTHCA_DB_TYPE_INVALID   = 0x0,\n\tMTHCA_DB_TYPE_CQ_SET_CI = 0x1,\n\tMTHCA_DB_TYPE_CQ_ARM    = 0x2,\n\tMTHCA_DB_TYPE_SQ        = 0x3,\n\tMTHCA_DB_TYPE_RQ        = 0x4,\n\tMTHCA_DB_TYPE_SRQ       = 0x5,\n\tMTHCA_DB_TYPE_GROUP_SEP = 0x7\n};\n\nstruct mthca_user_db_table;\nstruct mthca_uar;\n\nint mthca_map_user_db(struct mthca_dev *dev, struct mthca_uar *uar,\n\t\t      struct mthca_user_db_table *db_tab, int index, u64 uaddr);\nvoid mthca_unmap_user_db(struct mthca_dev *dev, struct mthca_uar *uar,\n\t\t\t struct mthca_user_db_table *db_tab, int index);\nstruct mthca_user_db_table *mthca_init_user_db_tab(struct mthca_dev *dev);\nvoid mthca_cleanup_user_db_tab(struct mthca_dev *dev, struct mthca_uar *uar,\n\t\t\t       struct mthca_user_db_table *db_tab);\n\nint mthca_init_db_tab(struct mthca_dev *dev);\nvoid mthca_cleanup_db_tab(struct mthca_dev *dev);\nint mthca_alloc_db(struct mthca_dev *dev, enum mthca_db_type type,\n\t\t   u32 qn, __be32 **db);\nvoid mthca_free_db(struct mthca_dev *dev, int type, int db_index);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}