{
  "module_name": "hns_roce_restrack.c",
  "hash_id": "27ea2a8e7f0ae6f81cb5dc1f79b76189e3ee1a3c1565310717f993f8ef6d0142",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/hns/hns_roce_restrack.c",
  "human_readable_source": "\n\n\n#include <rdma/rdma_cm.h>\n#include <rdma/restrack.h>\n#include <uapi/rdma/rdma_netlink.h>\n#include \"hnae3.h\"\n#include \"hns_roce_common.h\"\n#include \"hns_roce_device.h\"\n#include \"hns_roce_hw_v2.h\"\n\nint hns_roce_fill_res_cq_entry(struct sk_buff *msg, struct ib_cq *ib_cq)\n{\n\tstruct hns_roce_cq *hr_cq = to_hr_cq(ib_cq);\n\tstruct nlattr *table_attr;\n\n\ttable_attr = nla_nest_start(msg, RDMA_NLDEV_ATTR_DRIVER);\n\tif (!table_attr)\n\t\treturn -EMSGSIZE;\n\n\tif (rdma_nl_put_driver_u32(msg, \"cq_depth\", hr_cq->cq_depth))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32(msg, \"cons_index\", hr_cq->cons_index))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32(msg, \"cqe_size\", hr_cq->cqe_size))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32(msg, \"arm_sn\", hr_cq->arm_sn))\n\t\tgoto err;\n\n\tnla_nest_end(msg, table_attr);\n\n\treturn 0;\n\nerr:\n\tnla_nest_cancel(msg, table_attr);\n\n\treturn -EMSGSIZE;\n}\n\nint hns_roce_fill_res_cq_entry_raw(struct sk_buff *msg, struct ib_cq *ib_cq)\n{\n\tstruct hns_roce_dev *hr_dev = to_hr_dev(ib_cq->device);\n\tstruct hns_roce_cq *hr_cq = to_hr_cq(ib_cq);\n\tstruct hns_roce_v2_cq_context context;\n\tint ret;\n\n\tif (!hr_dev->hw->query_cqc)\n\t\treturn -EINVAL;\n\n\tret = hr_dev->hw->query_cqc(hr_dev, hr_cq->cqn, &context);\n\tif (ret)\n\t\treturn -EINVAL;\n\n\tret = nla_put(msg, RDMA_NLDEV_ATTR_RES_RAW, sizeof(context), &context);\n\n\treturn ret;\n}\n\nint hns_roce_fill_res_qp_entry(struct sk_buff *msg, struct ib_qp *ib_qp)\n{\n\tstruct hns_roce_qp *hr_qp = to_hr_qp(ib_qp);\n\tstruct nlattr *table_attr;\n\n\ttable_attr = nla_nest_start(msg, RDMA_NLDEV_ATTR_DRIVER);\n\tif (!table_attr)\n\t\treturn -EMSGSIZE;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"sq_wqe_cnt\", hr_qp->sq.wqe_cnt))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"sq_max_gs\", hr_qp->sq.max_gs))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"rq_wqe_cnt\", hr_qp->rq.wqe_cnt))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"rq_max_gs\", hr_qp->rq.max_gs))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"ext_sge_sge_cnt\", hr_qp->sge.sge_cnt))\n\t\tgoto err;\n\n\tnla_nest_end(msg, table_attr);\n\n\treturn 0;\n\nerr:\n\tnla_nest_cancel(msg, table_attr);\n\n\treturn -EMSGSIZE;\n}\n\nint hns_roce_fill_res_qp_entry_raw(struct sk_buff *msg, struct ib_qp *ib_qp)\n{\n\tstruct hns_roce_dev *hr_dev = to_hr_dev(ib_qp->device);\n\tstruct hns_roce_qp *hr_qp = to_hr_qp(ib_qp);\n\tstruct hns_roce_v2_qp_context context;\n\tint ret;\n\n\tif (!hr_dev->hw->query_qpc)\n\t\treturn -EINVAL;\n\n\tret = hr_dev->hw->query_qpc(hr_dev, hr_qp->qpn, &context);\n\tif (ret)\n\t\treturn -EINVAL;\n\n\tret = nla_put(msg, RDMA_NLDEV_ATTR_RES_RAW, sizeof(context), &context);\n\n\treturn ret;\n}\n\nint hns_roce_fill_res_mr_entry(struct sk_buff *msg, struct ib_mr *ib_mr)\n{\n\tstruct hns_roce_mr *hr_mr = to_hr_mr(ib_mr);\n\tstruct nlattr *table_attr;\n\n\ttable_attr = nla_nest_start(msg, RDMA_NLDEV_ATTR_DRIVER);\n\tif (!table_attr)\n\t\treturn -EMSGSIZE;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"pbl_hop_num\", hr_mr->pbl_hop_num))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"ba_pg_shift\",\n\t\t\t\t       hr_mr->pbl_mtr.hem_cfg.ba_pg_shift))\n\t\tgoto err;\n\n\tif (rdma_nl_put_driver_u32_hex(msg, \"buf_pg_shift\",\n\t\t\t\t       hr_mr->pbl_mtr.hem_cfg.buf_pg_shift))\n\t\tgoto err;\n\n\tnla_nest_end(msg, table_attr);\n\n\treturn 0;\n\nerr:\n\tnla_nest_cancel(msg, table_attr);\n\n\treturn -EMSGSIZE;\n}\n\nint hns_roce_fill_res_mr_entry_raw(struct sk_buff *msg, struct ib_mr *ib_mr)\n{\n\tstruct hns_roce_dev *hr_dev = to_hr_dev(ib_mr->device);\n\tstruct hns_roce_mr *hr_mr = to_hr_mr(ib_mr);\n\tstruct hns_roce_v2_mpt_entry context;\n\tint ret;\n\n\tif (!hr_dev->hw->query_mpt)\n\t\treturn -EINVAL;\n\n\tret = hr_dev->hw->query_mpt(hr_dev, hr_mr->key, &context);\n\tif (ret)\n\t\treturn -EINVAL;\n\n\tret = nla_put(msg, RDMA_NLDEV_ATTR_RES_RAW, sizeof(context), &context);\n\n\treturn ret;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}