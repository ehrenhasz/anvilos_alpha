{
  "module_name": "mad.h",
  "hash_id": "8271154e13f273b63173509eef628c9289180e4e10b6cf2885cf57b25ea9d49f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/hfi1/mad.h",
  "human_readable_source": " \n \n\n#ifndef _HFI1_MAD_H\n#define _HFI1_MAD_H\n\n#include <rdma/ib_pma.h>\n#include <rdma/opa_smi.h>\n#include <rdma/opa_port_info.h>\n#include \"opa_compat.h\"\n\n \n#define OPA_TRAP_GID_NOW_IN_SERVICE             cpu_to_be16(64)\n#define OPA_TRAP_GID_OUT_OF_SERVICE             cpu_to_be16(65)\n#define OPA_TRAP_ADD_MULTICAST_GROUP            cpu_to_be16(66)\n#define OPA_TRAL_DEL_MULTICAST_GROUP            cpu_to_be16(67)\n#define OPA_TRAP_UNPATH                         cpu_to_be16(68)\n#define OPA_TRAP_REPATH                         cpu_to_be16(69)\n#define OPA_TRAP_PORT_CHANGE_STATE              cpu_to_be16(128)\n#define OPA_TRAP_LINK_INTEGRITY                 cpu_to_be16(129)\n#define OPA_TRAP_EXCESSIVE_BUFFER_OVERRUN       cpu_to_be16(130)\n#define OPA_TRAP_FLOW_WATCHDOG                  cpu_to_be16(131)\n#define OPA_TRAP_CHANGE_CAPABILITY              cpu_to_be16(144)\n#define OPA_TRAP_CHANGE_SYSGUID                 cpu_to_be16(145)\n#define OPA_TRAP_BAD_M_KEY                      cpu_to_be16(256)\n#define OPA_TRAP_BAD_P_KEY                      cpu_to_be16(257)\n#define OPA_TRAP_BAD_Q_KEY                      cpu_to_be16(258)\n#define OPA_TRAP_SWITCH_BAD_PKEY                cpu_to_be16(259)\n#define OPA_SMA_TRAP_DATA_LINK_WIDTH            cpu_to_be16(2048)\n\n \n#define\tOPA_NOTICE_TRAP_LWDE_CHG        0x08  \n#define OPA_NOTICE_TRAP_LSE_CHG         0x04  \n#define OPA_NOTICE_TRAP_LWE_CHG         0x02  \n#define OPA_NOTICE_TRAP_NODE_DESC_CHG   0x01\n\nstruct opa_mad_notice_attr {\n\tu8 generic_type;\n\tu8 prod_type_msb;\n\t__be16 prod_type_lsb;\n\t__be16 trap_num;\n\t__be16 toggle_count;\n\t__be32 issuer_lid;\n\t__be32 reserved1;\n\tunion ib_gid issuer_gid;\n\n\tunion {\n\t\tstruct {\n\t\t\tu8\tdetails[64];\n\t\t} raw_data;\n\n\t\tstruct {\n\t\t\tunion ib_gid\tgid;\n\t\t} __packed ntc_64_65_66_67;\n\n\t\tstruct {\n\t\t\t__be32\tlid;\n\t\t} __packed ntc_128;\n\n\t\tstruct {\n\t\t\t__be32\tlid;\t\t \n\t\t\tu8\tport_num;\t \n\t\t} __packed ntc_129_130_131;\n\n\t\tstruct {\n\t\t\t__be32\tlid;\t\t \n\t\t\t__be32\tnew_cap_mask;\t \n\t\t\t__be16\treserved2;\n\t\t\t__be16\tcap_mask3;\n\t\t\t__be16\tchange_flags;\t \n\t\t} __packed ntc_144;\n\n\t\tstruct {\n\t\t\t__be64\tnew_sys_guid;\n\t\t\t__be32\tlid;\t\t \n\t\t} __packed ntc_145;\n\n\t\tstruct {\n\t\t\t__be32\tlid;\n\t\t\t__be32\tdr_slid;\n\t\t\tu8\tmethod;\n\t\t\tu8\tdr_trunc_hop;\n\t\t\t__be16\tattr_id;\n\t\t\t__be32\tattr_mod;\n\t\t\t__be64\tmkey;\n\t\t\tu8\tdr_rtn_path[30];\n\t\t} __packed ntc_256;\n\n\t\tstruct {\n\t\t\t__be32\t\tlid1;\n\t\t\t__be32\t\tlid2;\n\t\t\t__be32\t\tkey;\n\t\t\tu8\t\tsl;\t \n\t\t\tu8\t\treserved3[3];\n\t\t\tunion ib_gid\tgid1;\n\t\t\tunion ib_gid\tgid2;\n\t\t\t__be32\t\tqp1;\t \n\t\t\t__be32\t\tqp2;\t \n\t\t} __packed ntc_257_258;\n\n\t\tstruct {\n\t\t\t__be16\t\tflags;\t \n\t\t\t__be16\t\tpkey;\n\t\t\t__be32\t\tlid1;\n\t\t\t__be32\t\tlid2;\n\t\t\tu8\t\tsl;\t \n\t\t\tu8\t\treserved4[3];\n\t\t\tunion ib_gid\tgid1;\n\t\t\tunion ib_gid\tgid2;\n\t\t\t__be32\t\tqp1;\t \n\t\t\t__be32\t\tqp2;\t \n\t\t} __packed ntc_259;\n\n\t\tstruct {\n\t\t\t__be32\tlid;\n\t\t} __packed ntc_2048;\n\n\t};\n\tu8\tclass_data[];\n};\n\n#define IB_VLARB_LOWPRI_0_31    1\n#define IB_VLARB_LOWPRI_32_63   2\n#define IB_VLARB_HIGHPRI_0_31   3\n#define IB_VLARB_HIGHPRI_32_63  4\n\n#define OPA_MAX_PREEMPT_CAP         32\n#define OPA_VLARB_LOW_ELEMENTS       0\n#define OPA_VLARB_HIGH_ELEMENTS      1\n#define OPA_VLARB_PREEMPT_ELEMENTS   2\n#define OPA_VLARB_PREEMPT_MATRIX     3\n\n#define IB_PMA_PORT_COUNTERS_CONG       cpu_to_be16(0xFF00)\n#define LINK_SPEED_25G\t\t1\n#define LINK_SPEED_12_5G\t2\n#define LINK_WIDTH_DEFAULT\t4\n#define DECIMAL_FACTORING\t1000\n \n#define FACTOR_LINK_WIDTH\t(LINK_WIDTH_DEFAULT * DECIMAL_FACTORING)\n\nstruct ib_pma_portcounters_cong {\n\tu8 reserved;\n\tu8 reserved1;\n\t__be16 port_check_rate;\n\t__be16 symbol_error_counter;\n\tu8 link_error_recovery_counter;\n\tu8 link_downed_counter;\n\t__be16 port_rcv_errors;\n\t__be16 port_rcv_remphys_errors;\n\t__be16 port_rcv_switch_relay_errors;\n\t__be16 port_xmit_discards;\n\tu8 port_xmit_constraint_errors;\n\tu8 port_rcv_constraint_errors;\n\tu8 reserved2;\n\tu8 link_overrun_errors;  \n\t__be16 reserved3;\n\t__be16 vl15_dropped;\n\t__be64 port_xmit_data;\n\t__be64 port_rcv_data;\n\t__be64 port_xmit_packets;\n\t__be64 port_rcv_packets;\n\t__be64 port_xmit_wait;\n\t__be64 port_adr_events;\n} __packed;\n\n#define IB_SMP_UNSUP_VERSION    cpu_to_be16(0x0004)\n#define IB_SMP_UNSUP_METHOD     cpu_to_be16(0x0008)\n#define IB_SMP_UNSUP_METH_ATTR  cpu_to_be16(0x000C)\n#define IB_SMP_INVALID_FIELD    cpu_to_be16(0x001C)\n\n#define OPA_MAX_PREEMPT_CAP         32\n#define OPA_VLARB_LOW_ELEMENTS       0\n#define OPA_VLARB_HIGH_ELEMENTS      1\n#define OPA_VLARB_PREEMPT_ELEMENTS   2\n#define OPA_VLARB_PREEMPT_MATRIX     3\n\n#define HFI1_XMIT_RATE_UNSUPPORTED               0x0\n#define HFI1_XMIT_RATE_PICO                      0x7\n \n#define HFI1_CONG_TIMER_PSINTERVAL               0x1DCD64EC\n\n#define IB_CC_SVCTYPE_RC 0x0\n#define IB_CC_SVCTYPE_UC 0x1\n#define IB_CC_SVCTYPE_RD 0x2\n#define IB_CC_SVCTYPE_UD 0x3\n\n \n#define OPA_CC_LOG_TYPE_HFI\t2\n\nstruct opa_hfi1_cong_log_event_internal {\n\tu32 lqpn;\n\tu32 rqpn;\n\tu8 sl;\n\tu8 svc_type;\n\tu32 rlid;\n\tu64 timestamp;  \n};\n\nstruct opa_hfi1_cong_log_event {\n\tu8 local_qp_cn_entry[3];\n\tu8 remote_qp_number_cn_entry[3];\n\tu8 sl_svc_type_cn_entry;  \n\tu8 reserved;\n\t__be32 remote_lid_cn_entry;\n\t__be32 timestamp_cn_entry;\n} __packed;\n\n#define OPA_CONG_LOG_ELEMS\t96\n\nstruct opa_hfi1_cong_log {\n\tu8 log_type;\n\tu8 congestion_flags;\n\t__be16 threshold_event_counter;\n\t__be32 current_time_stamp;\n\tu8 threshold_cong_event_map[OPA_MAX_SLS / 8];\n\tstruct opa_hfi1_cong_log_event events[OPA_CONG_LOG_ELEMS];\n} __packed;\n\n#define IB_CC_TABLE_CAP_DEFAULT 31\n\n \n#define IB_CC_CCS_PC_SL_BASED 0x01\n\nstruct opa_congestion_setting_entry {\n\tu8 ccti_increase;\n\tu8 reserved;\n\t__be16 ccti_timer;\n\tu8 trigger_threshold;\n\tu8 ccti_min;  \n} __packed;\n\nstruct opa_congestion_setting_entry_shadow {\n\tu8 ccti_increase;\n\tu8 reserved;\n\tu16 ccti_timer;\n\tu8 trigger_threshold;\n\tu8 ccti_min;  \n} __packed;\n\nstruct opa_congestion_setting_attr {\n\t__be32 control_map;\n\t__be16 port_control;\n\tstruct opa_congestion_setting_entry entries[OPA_MAX_SLS];\n} __packed;\n\nstruct opa_congestion_setting_attr_shadow {\n\tu32 control_map;\n\tu16 port_control;\n\tstruct opa_congestion_setting_entry_shadow entries[OPA_MAX_SLS];\n} __packed;\n\n#define IB_CC_TABLE_ENTRY_INCREASE_DEFAULT 1\n#define IB_CC_TABLE_ENTRY_TIMER_DEFAULT 1\n\n \n#define IB_CCT_ENTRIES 64\n#define IB_CCT_MIN_ENTRIES (IB_CCT_ENTRIES * 2)\n\nstruct ib_cc_table_entry {\n\t__be16 entry;  \n};\n\nstruct ib_cc_table_entry_shadow {\n\tu16 entry;  \n};\n\nstruct ib_cc_table_attr {\n\t__be16 ccti_limit;  \n\tstruct ib_cc_table_entry ccti_entries[IB_CCT_ENTRIES];\n} __packed;\n\nstruct ib_cc_table_attr_shadow {\n\tu16 ccti_limit;  \n\tstruct ib_cc_table_entry_shadow ccti_entries[IB_CCT_ENTRIES];\n} __packed;\n\n#define CC_TABLE_SHADOW_MAX \\\n\t(IB_CC_TABLE_CAP_DEFAULT * IB_CCT_ENTRIES)\n\nstruct cc_table_shadow {\n\tu16 ccti_limit;  \n\tstruct ib_cc_table_entry_shadow entries[CC_TABLE_SHADOW_MAX];\n} __packed;\n\n \nstruct cc_state {\n\tstruct rcu_head rcu;\n\tstruct cc_table_shadow cct;\n\tstruct opa_congestion_setting_attr_shadow cong_setting;\n};\n\n \n\n \n#define OPA_AM_NPORT_SHIFT\t24\n#define OPA_AM_NPORT_MASK\t0xff\n#define OPA_AM_NPORT_SMASK\t(OPA_AM_NPORT_MASK << OPA_AM_NPORT_SHIFT)\n#define OPA_AM_NPORT(am)\t(((am) >> OPA_AM_NPORT_SHIFT) & \\\n\t\t\t\t\tOPA_AM_NPORT_MASK)\n\n#define OPA_AM_NBLK_SHIFT\t24\n#define OPA_AM_NBLK_MASK\t0xff\n#define OPA_AM_NBLK_SMASK\t(OPA_AM_NBLK_MASK << OPA_AM_NBLK_SHIFT)\n#define OPA_AM_NBLK(am)\t\t(((am) >> OPA_AM_NBLK_SHIFT) & \\\n\t\t\t\t\tOPA_AM_NBLK_MASK)\n\n#define OPA_AM_START_BLK_SHIFT\t0\n#define OPA_AM_START_BLK_MASK\t0xff\n#define OPA_AM_START_BLK_SMASK\t(OPA_AM_START_BLK_MASK << \\\n\t\t\t\t\tOPA_AM_START_BLK_SHIFT)\n#define OPA_AM_START_BLK(am)\t(((am) >> OPA_AM_START_BLK_SHIFT) & \\\n\t\t\t\t\tOPA_AM_START_BLK_MASK)\n\n#define OPA_AM_PORTNUM_SHIFT\t0\n#define OPA_AM_PORTNUM_MASK\t0xff\n#define OPA_AM_PORTNUM_SMASK\t(OPA_AM_PORTNUM_MASK << OPA_AM_PORTNUM_SHIFT)\n#define OPA_AM_PORTNUM(am)\t(((am) >> OPA_AM_PORTNUM_SHIFT) & \\\n\t\t\t\t\tOPA_AM_PORTNUM_MASK)\n\n#define OPA_AM_ASYNC_SHIFT\t12\n#define OPA_AM_ASYNC_MASK\t0x1\n#define OPA_AM_ASYNC_SMASK\t(OPA_AM_ASYNC_MASK << OPA_AM_ASYNC_SHIFT)\n#define OPA_AM_ASYNC(am)\t(((am) >> OPA_AM_ASYNC_SHIFT) & \\\n\t\t\t\t\tOPA_AM_ASYNC_MASK)\n\n#define OPA_AM_START_SM_CFG_SHIFT\t9\n#define OPA_AM_START_SM_CFG_MASK\t0x1\n#define OPA_AM_START_SM_CFG_SMASK\t(OPA_AM_START_SM_CFG_MASK << \\\n\t\t\t\t\t\tOPA_AM_START_SM_CFG_SHIFT)\n#define OPA_AM_START_SM_CFG(am)\t\t(((am) >> OPA_AM_START_SM_CFG_SHIFT) \\\n\t\t\t\t\t\t& OPA_AM_START_SM_CFG_MASK)\n\n#define OPA_AM_CI_ADDR_SHIFT\t19\n#define OPA_AM_CI_ADDR_MASK\t0xfff\n#define OPA_AM_CI_ADDR_SMASK\t(OPA_AM_CI_ADDR_MASK << OPA_CI_ADDR_SHIFT)\n#define OPA_AM_CI_ADDR(am)\t(((am) >> OPA_AM_CI_ADDR_SHIFT) & \\\n\t\t\t\t\tOPA_AM_CI_ADDR_MASK)\n\n#define OPA_AM_CI_LEN_SHIFT\t13\n#define OPA_AM_CI_LEN_MASK\t0x3f\n#define OPA_AM_CI_LEN_SMASK\t(OPA_AM_CI_LEN_MASK << OPA_CI_LEN_SHIFT)\n#define OPA_AM_CI_LEN(am)\t(((am) >> OPA_AM_CI_LEN_SHIFT) & \\\n\t\t\t\t\tOPA_AM_CI_LEN_MASK)\n\n \n#define OPA_EI_STATUS_SMASK\t0x80\n#define OPA_EI_CODE_SMASK\t0x0f\n\nstruct vl_limit {\n\t__be16 dedicated;\n\t__be16 shared;\n};\n\nstruct buffer_control {\n\t__be16 reserved;\n\t__be16 overall_shared_limit;\n\tstruct vl_limit vl[OPA_MAX_VLS];\n};\n\nstruct sc2vlnt {\n\tu8 vlnt[32];  \n};\n\n \n#define COUNTER_MASK(q, n) (q << ((9 - n) * 3))\n#define COUNTER_MASK0_9 \\\n\tcpu_to_be32(COUNTER_MASK(1, 0) | \\\n\t\t    COUNTER_MASK(1, 1) | \\\n\t\t    COUNTER_MASK(1, 2) | \\\n\t\t    COUNTER_MASK(1, 3) | \\\n\t\t    COUNTER_MASK(1, 4))\n\nvoid hfi1_event_pkey_change(struct hfi1_devdata *dd, u32 port);\nvoid hfi1_handle_trap_timer(struct timer_list *t);\nu16 tx_link_width(u16 link_width);\nu64 get_xmit_wait_counters(struct hfi1_pportdata *ppd, u16 link_width,\n\t\t\t   u16 link_speed, int vl);\n \nstatic inline u16 get_link_speed(u16 link_speed)\n{\n\treturn (link_speed == 1) ?\n\t\t LINK_SPEED_12_5G : LINK_SPEED_25G;\n}\n\n \nstatic inline u64 convert_xmit_counter(u64 xmit_wait_val, u16 link_width,\n\t\t\t\t       u16 link_speed)\n{\n\treturn (xmit_wait_val * 2 * (FACTOR_LINK_WIDTH / link_width)\n\t\t * link_speed) / DECIMAL_FACTORING;\n}\n#endif\t\t\t\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}