{
  "module_name": "trace.c",
  "hash_id": "3fd3b7cfa89a2f000d78413cab88fd570e47d2c6cdd272f78d654ff7e3dd4c5c",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/hfi1/trace.c",
  "human_readable_source": "\n \n#define CREATE_TRACE_POINTS\n#include \"trace.h\"\n#include \"exp_rcv.h\"\n#include \"ipoib.h\"\n\nstatic u8 __get_ib_hdr_len(struct ib_header *hdr)\n{\n\tstruct ib_other_headers *ohdr;\n\tu8 opcode;\n\n\tif (ib_get_lnh(hdr) == HFI1_LRH_BTH)\n\t\tohdr = &hdr->u.oth;\n\telse\n\t\tohdr = &hdr->u.l.oth;\n\topcode = ib_bth_get_opcode(ohdr);\n\treturn hdr_len_by_opcode[opcode] == 0 ?\n\t       0 : hdr_len_by_opcode[opcode] - (12 + 8);\n}\n\nstatic u8 __get_16b_hdr_len(struct hfi1_16b_header *hdr)\n{\n\tstruct ib_other_headers *ohdr = NULL;\n\tu8 opcode;\n\tu8 l4 = hfi1_16B_get_l4(hdr);\n\n\tif (l4 == OPA_16B_L4_FM) {\n\t\topcode = IB_OPCODE_UD_SEND_ONLY;\n\t\treturn (8 + 8);  \n\t}\n\n\tif (l4 == OPA_16B_L4_IB_LOCAL)\n\t\tohdr = &hdr->u.oth;\n\telse\n\t\tohdr = &hdr->u.l.oth;\n\n\topcode = ib_bth_get_opcode(ohdr);\n\treturn hdr_len_by_opcode[opcode] == 0 ?\n\t       0 : hdr_len_by_opcode[opcode] - (12 + 8 + 8);\n}\n\nu8 hfi1_trace_packet_hdr_len(struct hfi1_packet *packet)\n{\n\tif (packet->etype != RHF_RCV_TYPE_BYPASS)\n\t\treturn __get_ib_hdr_len(packet->hdr);\n\telse\n\t\treturn __get_16b_hdr_len(packet->hdr);\n}\n\nu8 hfi1_trace_opa_hdr_len(struct hfi1_opa_header *opa_hdr)\n{\n\tif (!opa_hdr->hdr_type)\n\t\treturn __get_ib_hdr_len(&opa_hdr->ibh);\n\telse\n\t\treturn __get_16b_hdr_len(&opa_hdr->opah);\n}\n\nconst char *hfi1_trace_get_packet_l4_str(u8 l4)\n{\n\tif (l4)\n\t\treturn \"16B\";\n\telse\n\t\treturn \"9B\";\n}\n\nconst char *hfi1_trace_get_packet_l2_str(u8 l2)\n{\n\tswitch (l2) {\n\tcase 0:\n\t\treturn \"0\";\n\tcase 1:\n\t\treturn \"1\";\n\tcase 2:\n\t\treturn \"16B\";\n\tcase 3:\n\t\treturn \"9B\";\n\t}\n\treturn \"\";\n}\n\n#define IMM_PRN  \"imm:%d\"\n#define RETH_PRN \"reth vaddr:0x%.16llx rkey:0x%.8x dlen:0x%.8x\"\n#define AETH_PRN \"aeth syn:0x%.2x %s msn:0x%.8x\"\n#define DETH_PRN \"deth qkey:0x%.8x sqpn:0x%.6x\"\n#define DETH_ENTROPY_PRN \"deth qkey:0x%.8x sqpn:0x%.6x entropy:0x%.2x\"\n#define IETH_PRN \"ieth rkey:0x%.8x\"\n#define ATOMICACKETH_PRN \"origdata:%llx\"\n#define ATOMICETH_PRN \"vaddr:0x%llx rkey:0x%.8x sdata:%llx cdata:%llx\"\n#define TID_RDMA_KDETH \"kdeth0 0x%x kdeth1 0x%x\"\n#define TID_RDMA_KDETH_DATA \"kdeth0 0x%x: kver %u sh %u intr %u tidctrl %u tid %x offset %x kdeth1 0x%x: jkey %x\"\n#define TID_READ_REQ_PRN \"tid_flow_psn 0x%x tid_flow_qp 0x%x verbs_qp 0x%x\"\n#define TID_READ_RSP_PRN \"verbs_qp 0x%x\"\n#define TID_WRITE_REQ_PRN \"original_qp 0x%x\"\n#define TID_WRITE_RSP_PRN \"tid_flow_psn 0x%x tid_flow_qp 0x%x verbs_qp 0x%x\"\n#define TID_WRITE_DATA_PRN \"verbs_qp 0x%x\"\n#define TID_ACK_PRN \"tid_flow_psn 0x%x verbs_psn 0x%x tid_flow_qp 0x%x verbs_qp 0x%x\"\n#define TID_RESYNC_PRN \"verbs_qp 0x%x\"\n\n#define OP(transport, op) IB_OPCODE_## transport ## _ ## op\n\nstatic const char *parse_syndrome(u8 syndrome)\n{\n\tswitch (syndrome >> 5) {\n\tcase 0:\n\t\treturn \"ACK\";\n\tcase 1:\n\t\treturn \"RNRNAK\";\n\tcase 3:\n\t\treturn \"NAK\";\n\t}\n\treturn \"\";\n}\n\nvoid hfi1_trace_parse_9b_bth(struct ib_other_headers *ohdr,\n\t\t\t     u8 *ack, bool *becn, bool *fecn, u8 *mig,\n\t\t\t     u8 *se, u8 *pad, u8 *opcode, u8 *tver,\n\t\t\t     u16 *pkey, u32 *psn, u32 *qpn)\n{\n\t*ack = ib_bth_get_ackreq(ohdr);\n\t*becn = ib_bth_get_becn(ohdr);\n\t*fecn = ib_bth_get_fecn(ohdr);\n\t*mig = ib_bth_get_migreq(ohdr);\n\t*se = ib_bth_get_se(ohdr);\n\t*pad = ib_bth_get_pad(ohdr);\n\t*opcode = ib_bth_get_opcode(ohdr);\n\t*tver = ib_bth_get_tver(ohdr);\n\t*pkey = ib_bth_get_pkey(ohdr);\n\t*psn = mask_psn(ib_bth_get_psn(ohdr));\n\t*qpn = ib_bth_get_qpn(ohdr);\n}\n\nvoid hfi1_trace_parse_16b_bth(struct ib_other_headers *ohdr,\n\t\t\t      u8 *ack, u8 *mig, u8 *opcode,\n\t\t\t      u8 *pad, u8 *se, u8 *tver,\n\t\t\t      u32 *psn, u32 *qpn)\n{\n\t*ack = ib_bth_get_ackreq(ohdr);\n\t*mig = ib_bth_get_migreq(ohdr);\n\t*opcode = ib_bth_get_opcode(ohdr);\n\t*pad = ib_bth_get_pad(ohdr);\n\t*se = ib_bth_get_se(ohdr);\n\t*tver = ib_bth_get_tver(ohdr);\n\t*psn = mask_psn(ib_bth_get_psn(ohdr));\n\t*qpn = ib_bth_get_qpn(ohdr);\n}\n\nstatic u16 ib_get_len(const struct ib_header *hdr)\n{\n\treturn be16_to_cpu(hdr->lrh[2]);\n}\n\nvoid hfi1_trace_parse_9b_hdr(struct ib_header *hdr, bool sc5,\n\t\t\t     u8 *lnh, u8 *lver, u8 *sl, u8 *sc,\n\t\t\t     u16 *len, u32 *dlid, u32 *slid)\n{\n\t*lnh = ib_get_lnh(hdr);\n\t*lver = ib_get_lver(hdr);\n\t*sl = ib_get_sl(hdr);\n\t*sc = ib_get_sc(hdr) | (sc5 << 4);\n\t*len = ib_get_len(hdr);\n\t*dlid = ib_get_dlid(hdr);\n\t*slid = ib_get_slid(hdr);\n}\n\nvoid hfi1_trace_parse_16b_hdr(struct hfi1_16b_header *hdr,\n\t\t\t      u8 *age, bool *becn, bool *fecn,\n\t\t\t      u8 *l4, u8 *rc, u8 *sc,\n\t\t\t      u16 *entropy, u16 *len, u16 *pkey,\n\t\t\t      u32 *dlid, u32 *slid)\n{\n\t*age = hfi1_16B_get_age(hdr);\n\t*becn = hfi1_16B_get_becn(hdr);\n\t*fecn = hfi1_16B_get_fecn(hdr);\n\t*l4 = hfi1_16B_get_l4(hdr);\n\t*rc = hfi1_16B_get_rc(hdr);\n\t*sc = hfi1_16B_get_sc(hdr);\n\t*entropy = hfi1_16B_get_entropy(hdr);\n\t*len = hfi1_16B_get_len(hdr);\n\t*pkey = hfi1_16B_get_pkey(hdr);\n\t*dlid = hfi1_16B_get_dlid(hdr);\n\t*slid = hfi1_16B_get_slid(hdr);\n}\n\n#define LRH_PRN \"len:%d sc:%d dlid:0x%.4x slid:0x%.4x \"\n#define LRH_9B_PRN \"lnh:%d,%s lver:%d sl:%d\"\n#define LRH_16B_PRN \"age:%d becn:%d fecn:%d l4:%d \" \\\n\t\t    \"rc:%d sc:%d pkey:0x%.4x entropy:0x%.4x\"\nconst char *hfi1_trace_fmt_lrh(struct trace_seq *p, bool bypass,\n\t\t\t       u8 age, bool becn, bool fecn, u8 l4,\n\t\t\t       u8 lnh, const char *lnh_name, u8 lver,\n\t\t\t       u8 rc, u8 sc, u8 sl, u16 entropy,\n\t\t\t       u16 len, u16 pkey, u32 dlid, u32 slid)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\n\ttrace_seq_printf(p, LRH_PRN, len, sc, dlid, slid);\n\n\tif (bypass)\n\t\ttrace_seq_printf(p, LRH_16B_PRN,\n\t\t\t\t age, becn, fecn, l4, rc, sc, pkey, entropy);\n\n\telse\n\t\ttrace_seq_printf(p, LRH_9B_PRN,\n\t\t\t\t lnh, lnh_name, lver, sl);\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\n#define BTH_9B_PRN \\\n\t\"op:0x%.2x,%s se:%d m:%d pad:%d tver:%d pkey:0x%.4x \" \\\n\t\"f:%d b:%d qpn:0x%.6x a:%d psn:0x%.8x\"\n#define BTH_16B_PRN \\\n\t\"op:0x%.2x,%s se:%d m:%d pad:%d tver:%d \" \\\n\t\"qpn:0x%.6x a:%d psn:0x%.8x\"\n#define L4_FM_16B_PRN \\\n\t\"op:0x%.2x,%s dest_qpn:0x%.6x src_qpn:0x%.6x\"\nconst char *hfi1_trace_fmt_rest(struct trace_seq *p, bool bypass, u8 l4,\n\t\t\t\tu8 ack, bool becn, bool fecn, u8 mig,\n\t\t\t\tu8 se, u8 pad, u8 opcode, const char *opname,\n\t\t\t\tu8 tver, u16 pkey, u32 psn, u32 qpn,\n\t\t\t\tu32 dest_qpn, u32 src_qpn)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\n\tif (bypass)\n\t\tif (l4 == OPA_16B_L4_FM)\n\t\t\ttrace_seq_printf(p, L4_FM_16B_PRN,\n\t\t\t\t\t opcode, opname, dest_qpn, src_qpn);\n\t\telse\n\t\t\ttrace_seq_printf(p, BTH_16B_PRN,\n\t\t\t\t\t opcode, opname,\n\t\t\t\t\t se, mig, pad, tver, qpn, ack, psn);\n\n\telse\n\t\ttrace_seq_printf(p, BTH_9B_PRN,\n\t\t\t\t opcode, opname,\n\t\t\t\t se, mig, pad, tver, pkey, fecn, becn,\n\t\t\t\t qpn, ack, psn);\n\ttrace_seq_putc(p, 0);\n\n\treturn ret;\n}\n\nconst char *parse_everbs_hdrs(\n\tstruct trace_seq *p,\n\tu8 opcode, u8 l4, u32 dest_qpn, u32 src_qpn,\n\tvoid *ehdrs)\n{\n\tunion ib_ehdrs *eh = ehdrs;\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\n\tif (l4 == OPA_16B_L4_FM) {\n\t\ttrace_seq_printf(p, \"mgmt pkt\");\n\t\tgoto out;\n\t}\n\n\tswitch (opcode) {\n\t \n\tcase OP(RC, SEND_LAST_WITH_IMMEDIATE):\n\tcase OP(UC, SEND_LAST_WITH_IMMEDIATE):\n\tcase OP(RC, SEND_ONLY_WITH_IMMEDIATE):\n\tcase OP(UC, SEND_ONLY_WITH_IMMEDIATE):\n\tcase OP(RC, RDMA_WRITE_LAST_WITH_IMMEDIATE):\n\tcase OP(UC, RDMA_WRITE_LAST_WITH_IMMEDIATE):\n\t\ttrace_seq_printf(p, IMM_PRN,\n\t\t\t\t be32_to_cpu(eh->imm_data));\n\t\tbreak;\n\t \n\tcase OP(RC, RDMA_WRITE_ONLY_WITH_IMMEDIATE):\n\tcase OP(UC, RDMA_WRITE_ONLY_WITH_IMMEDIATE):\n\t\ttrace_seq_printf(p, RETH_PRN \" \" IMM_PRN,\n\t\t\t\t get_ib_reth_vaddr(&eh->rc.reth),\n\t\t\t\t be32_to_cpu(eh->rc.reth.rkey),\n\t\t\t\t be32_to_cpu(eh->rc.reth.length),\n\t\t\t\t be32_to_cpu(eh->rc.imm_data));\n\t\tbreak;\n\t \n\tcase OP(RC, RDMA_READ_REQUEST):\n\tcase OP(RC, RDMA_WRITE_FIRST):\n\tcase OP(UC, RDMA_WRITE_FIRST):\n\tcase OP(RC, RDMA_WRITE_ONLY):\n\tcase OP(UC, RDMA_WRITE_ONLY):\n\t\ttrace_seq_printf(p, RETH_PRN,\n\t\t\t\t get_ib_reth_vaddr(&eh->rc.reth),\n\t\t\t\t be32_to_cpu(eh->rc.reth.rkey),\n\t\t\t\t be32_to_cpu(eh->rc.reth.length));\n\t\tbreak;\n\tcase OP(RC, RDMA_READ_RESPONSE_FIRST):\n\tcase OP(RC, RDMA_READ_RESPONSE_LAST):\n\tcase OP(RC, RDMA_READ_RESPONSE_ONLY):\n\tcase OP(RC, ACKNOWLEDGE):\n\t\ttrace_seq_printf(p, AETH_PRN, be32_to_cpu(eh->aeth) >> 24,\n\t\t\t\t parse_syndrome(be32_to_cpu(eh->aeth) >> 24),\n\t\t\t\t be32_to_cpu(eh->aeth) & IB_MSN_MASK);\n\t\tbreak;\n\tcase OP(TID_RDMA, WRITE_REQ):\n\t\ttrace_seq_printf(p, TID_RDMA_KDETH \" \" RETH_PRN \" \"\n\t\t\t\t TID_WRITE_REQ_PRN,\n\t\t\t\t le32_to_cpu(eh->tid_rdma.w_req.kdeth0),\n\t\t\t\t le32_to_cpu(eh->tid_rdma.w_req.kdeth1),\n\t\t\t\t ib_u64_get(&eh->tid_rdma.w_req.reth.vaddr),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_req.reth.rkey),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_req.reth.length),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_req.verbs_qp));\n\t\tbreak;\n\tcase OP(TID_RDMA, WRITE_RESP):\n\t\ttrace_seq_printf(p, TID_RDMA_KDETH \" \" AETH_PRN \" \"\n\t\t\t\t TID_WRITE_RSP_PRN,\n\t\t\t\t le32_to_cpu(eh->tid_rdma.w_rsp.kdeth0),\n\t\t\t\t le32_to_cpu(eh->tid_rdma.w_rsp.kdeth1),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_rsp.aeth) >> 24,\n\t\t\t\t parse_syndrome( \n\t\t\t\t\t be32_to_cpu(eh->tid_rdma.w_rsp.aeth)\n\t\t\t\t\t >> 24),\n\t\t\t\t (be32_to_cpu(eh->tid_rdma.w_rsp.aeth) &\n\t\t\t\t  IB_MSN_MASK),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_rsp.tid_flow_psn),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_rsp.tid_flow_qp),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_rsp.verbs_qp));\n\t\tbreak;\n\tcase OP(TID_RDMA, WRITE_DATA_LAST):\n\tcase OP(TID_RDMA, WRITE_DATA):\n\t\ttrace_seq_printf(p, TID_RDMA_KDETH_DATA \" \" TID_WRITE_DATA_PRN,\n\t\t\t\t le32_to_cpu(eh->tid_rdma.w_data.kdeth0),\n\t\t\t\t KDETH_GET(eh->tid_rdma.w_data.kdeth0, KVER),\n\t\t\t\t KDETH_GET(eh->tid_rdma.w_data.kdeth0, SH),\n\t\t\t\t KDETH_GET(eh->tid_rdma.w_data.kdeth0, INTR),\n\t\t\t\t KDETH_GET(eh->tid_rdma.w_data.kdeth0, TIDCTRL),\n\t\t\t\t KDETH_GET(eh->tid_rdma.w_data.kdeth0, TID),\n\t\t\t\t KDETH_GET(eh->tid_rdma.w_data.kdeth0, OFFSET),\n\t\t\t\t le32_to_cpu(eh->tid_rdma.w_data.kdeth1),\n\t\t\t\t KDETH_GET(eh->tid_rdma.w_data.kdeth1, JKEY),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.w_data.verbs_qp));\n\t\tbreak;\n\tcase OP(TID_RDMA, READ_REQ):\n\t\ttrace_seq_printf(p, TID_RDMA_KDETH \" \" RETH_PRN \" \"\n\t\t\t\t TID_READ_REQ_PRN,\n\t\t\t\t le32_to_cpu(eh->tid_rdma.r_req.kdeth0),\n\t\t\t\t le32_to_cpu(eh->tid_rdma.r_req.kdeth1),\n\t\t\t\t ib_u64_get(&eh->tid_rdma.r_req.reth.vaddr),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.r_req.reth.rkey),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.r_req.reth.length),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.r_req.tid_flow_psn),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.r_req.tid_flow_qp),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.r_req.verbs_qp));\n\t\tbreak;\n\tcase OP(TID_RDMA, READ_RESP):\n\t\ttrace_seq_printf(p, TID_RDMA_KDETH_DATA \" \" AETH_PRN \" \"\n\t\t\t\t TID_READ_RSP_PRN,\n\t\t\t\t le32_to_cpu(eh->tid_rdma.r_rsp.kdeth0),\n\t\t\t\t KDETH_GET(eh->tid_rdma.r_rsp.kdeth0, KVER),\n\t\t\t\t KDETH_GET(eh->tid_rdma.r_rsp.kdeth0, SH),\n\t\t\t\t KDETH_GET(eh->tid_rdma.r_rsp.kdeth0, INTR),\n\t\t\t\t KDETH_GET(eh->tid_rdma.r_rsp.kdeth0, TIDCTRL),\n\t\t\t\t KDETH_GET(eh->tid_rdma.r_rsp.kdeth0, TID),\n\t\t\t\t KDETH_GET(eh->tid_rdma.r_rsp.kdeth0, OFFSET),\n\t\t\t\t le32_to_cpu(eh->tid_rdma.r_rsp.kdeth1),\n\t\t\t\t KDETH_GET(eh->tid_rdma.r_rsp.kdeth1, JKEY),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.r_rsp.aeth) >> 24,\n\t\t\t\t parse_syndrome( \n\t\t\t\t\t be32_to_cpu(eh->tid_rdma.r_rsp.aeth)\n\t\t\t\t\t >> 24),\n\t\t\t\t (be32_to_cpu(eh->tid_rdma.r_rsp.aeth) &\n\t\t\t\t  IB_MSN_MASK),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.r_rsp.verbs_qp));\n\t\tbreak;\n\tcase OP(TID_RDMA, ACK):\n\t\ttrace_seq_printf(p, TID_RDMA_KDETH \" \" AETH_PRN \" \"\n\t\t\t\t TID_ACK_PRN,\n\t\t\t\t le32_to_cpu(eh->tid_rdma.ack.kdeth0),\n\t\t\t\t le32_to_cpu(eh->tid_rdma.ack.kdeth1),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.ack.aeth) >> 24,\n\t\t\t\t parse_syndrome( \n\t\t\t\t\t be32_to_cpu(eh->tid_rdma.ack.aeth)\n\t\t\t\t\t >> 24),\n\t\t\t\t (be32_to_cpu(eh->tid_rdma.ack.aeth) &\n\t\t\t\t  IB_MSN_MASK),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.ack.tid_flow_psn),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.ack.verbs_psn),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.ack.tid_flow_qp),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.ack.verbs_qp));\n\t\tbreak;\n\tcase OP(TID_RDMA, RESYNC):\n\t\ttrace_seq_printf(p, TID_RDMA_KDETH \" \" TID_RESYNC_PRN,\n\t\t\t\t le32_to_cpu(eh->tid_rdma.resync.kdeth0),\n\t\t\t\t le32_to_cpu(eh->tid_rdma.resync.kdeth1),\n\t\t\t\t be32_to_cpu(eh->tid_rdma.resync.verbs_qp));\n\t\tbreak;\n\t \n\tcase OP(RC, ATOMIC_ACKNOWLEDGE):\n\t\ttrace_seq_printf(p, AETH_PRN \" \" ATOMICACKETH_PRN,\n\t\t\t\t be32_to_cpu(eh->at.aeth) >> 24,\n\t\t\t\t parse_syndrome(be32_to_cpu(eh->at.aeth) >> 24),\n\t\t\t\t be32_to_cpu(eh->at.aeth) & IB_MSN_MASK,\n\t\t\t\t ib_u64_get(&eh->at.atomic_ack_eth));\n\t\tbreak;\n\t \n\tcase OP(RC, COMPARE_SWAP):\n\tcase OP(RC, FETCH_ADD):\n\t\ttrace_seq_printf(p, ATOMICETH_PRN,\n\t\t\t\t get_ib_ateth_vaddr(&eh->atomic_eth),\n\t\t\t\t eh->atomic_eth.rkey,\n\t\t\t\t get_ib_ateth_swap(&eh->atomic_eth),\n\t\t\t\t get_ib_ateth_compare(&eh->atomic_eth));\n\t\tbreak;\n\t \n\tcase OP(UD, SEND_ONLY):\n\t\ttrace_seq_printf(p, DETH_ENTROPY_PRN,\n\t\t\t\t be32_to_cpu(eh->ud.deth[0]),\n\t\t\t\t be32_to_cpu(eh->ud.deth[1]) & RVT_QPN_MASK,\n\t\t\t\t be32_to_cpu(eh->ud.deth[1]) >>\n\t\t\t\t\t     HFI1_IPOIB_ENTROPY_SHIFT);\n\t\tbreak;\n\tcase OP(UD, SEND_ONLY_WITH_IMMEDIATE):\n\t\ttrace_seq_printf(p, DETH_PRN,\n\t\t\t\t be32_to_cpu(eh->ud.deth[0]),\n\t\t\t\t be32_to_cpu(eh->ud.deth[1]) & RVT_QPN_MASK);\n\t\tbreak;\n\t \n\tcase OP(RC, SEND_LAST_WITH_INVALIDATE):\n\tcase OP(RC, SEND_ONLY_WITH_INVALIDATE):\n\t\ttrace_seq_printf(p, IETH_PRN,\n\t\t\t\t be32_to_cpu(eh->ieth));\n\t\tbreak;\n\t}\nout:\n\ttrace_seq_putc(p, 0);\n\treturn ret;\n}\n\nconst char *parse_sdma_flags(\n\tstruct trace_seq *p,\n\tu64 desc0, u64 desc1)\n{\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\tchar flags[5] = { 'x', 'x', 'x', 'x', 0 };\n\n\tflags[0] = (desc1 & SDMA_DESC1_INT_REQ_FLAG) ? 'I' : '-';\n\tflags[1] = (desc1 & SDMA_DESC1_HEAD_TO_HOST_FLAG) ?  'H' : '-';\n\tflags[2] = (desc0 & SDMA_DESC0_FIRST_DESC_FLAG) ? 'F' : '-';\n\tflags[3] = (desc0 & SDMA_DESC0_LAST_DESC_FLAG) ? 'L' : '-';\n\ttrace_seq_printf(p, \"%s\", flags);\n\tif (desc0 & SDMA_DESC0_FIRST_DESC_FLAG)\n\t\ttrace_seq_printf(p, \" amode:%u aidx:%u alen:%u\",\n\t\t\t\t (u8)((desc1 >> SDMA_DESC1_HEADER_MODE_SHIFT) &\n\t\t\t\t      SDMA_DESC1_HEADER_MODE_MASK),\n\t\t\t\t (u8)((desc1 >> SDMA_DESC1_HEADER_INDEX_SHIFT) &\n\t\t\t\t      SDMA_DESC1_HEADER_INDEX_MASK),\n\t\t\t\t (u8)((desc1 >> SDMA_DESC1_HEADER_DWS_SHIFT) &\n\t\t\t\t      SDMA_DESC1_HEADER_DWS_MASK));\n\treturn ret;\n}\n\nconst char *print_u32_array(\n\tstruct trace_seq *p,\n\tu32 *arr, int len)\n{\n\tint i;\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\n\tfor (i = 0; i < len ; i++)\n\t\ttrace_seq_printf(p, \"%s%#x\", i == 0 ? \"\" : \" \", arr[i]);\n\ttrace_seq_putc(p, 0);\n\treturn ret;\n}\n\nu8 hfi1_trace_get_tid_ctrl(u32 ent)\n{\n\treturn EXP_TID_GET(ent, CTRL);\n}\n\nu16 hfi1_trace_get_tid_len(u32 ent)\n{\n\treturn EXP_TID_GET(ent, LEN);\n}\n\nu16 hfi1_trace_get_tid_idx(u32 ent)\n{\n\treturn EXP_TID_GET(ent, IDX);\n}\n\nstruct hfi1_ctxt_hist {\n\tatomic_t count;\n\tatomic_t data[255];\n};\n\nstatic struct hfi1_ctxt_hist hist = {\n\t.count = ATOMIC_INIT(0)\n};\n\nconst char *hfi1_trace_print_rsm_hist(struct trace_seq *p, unsigned int ctxt)\n{\n\tint i, len = ARRAY_SIZE(hist.data);\n\tconst char *ret = trace_seq_buffer_ptr(p);\n\tunsigned long packet_count = atomic_fetch_inc(&hist.count);\n\n\ttrace_seq_printf(p, \"packet[%lu]\", packet_count);\n\tfor (i = 0; i < len; ++i) {\n\t\tunsigned long val;\n\t\tatomic_t *count = &hist.data[i];\n\n\t\tif (ctxt == i)\n\t\t\tval = atomic_fetch_inc(count);\n\t\telse\n\t\t\tval = atomic_read(count);\n\n\t\tif (val)\n\t\t\ttrace_seq_printf(p, \"(%d:%lu)\", i, val);\n\t}\n\ttrace_seq_putc(p, 0);\n\treturn ret;\n}\n\n__hfi1_trace_fn(AFFINITY);\n__hfi1_trace_fn(PKT);\n__hfi1_trace_fn(PROC);\n__hfi1_trace_fn(SDMA);\n__hfi1_trace_fn(LINKVERB);\n__hfi1_trace_fn(DEBUG);\n__hfi1_trace_fn(SNOOP);\n__hfi1_trace_fn(CNTR);\n__hfi1_trace_fn(PIO);\n__hfi1_trace_fn(DC8051);\n__hfi1_trace_fn(FIRMWARE);\n__hfi1_trace_fn(RCVCTRL);\n__hfi1_trace_fn(TID);\n__hfi1_trace_fn(MMU);\n__hfi1_trace_fn(IOCTL);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}