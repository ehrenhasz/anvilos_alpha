{
  "module_name": "vnic.h",
  "hash_id": "a27762a8cb6c64fe37ef0ab9a532a4b8e0bb8df91d136ea1ca54631bfce23790",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/hfi1/vnic.h",
  "human_readable_source": " \n \n\n#ifndef _HFI1_VNIC_H\n#define _HFI1_VNIC_H\n#include <rdma/opa_vnic.h>\n#include \"hfi.h\"\n#include \"sdma.h\"\n\n#define HFI1_VNIC_MAX_TXQ     16\n#define HFI1_VNIC_MAX_PAD     12\n\n \n#define HFI1_VNIC_L4_HDR_OFFSET  OPA_VNIC_L2_HDR_LEN\n\n#define HFI1_VNIC_GET_L4_HDR(data)   \\\n\t(*((u16 *)((u8 *)(data) + HFI1_VNIC_L4_HDR_OFFSET)))\n\n#define HFI1_VNIC_GET_VESWID(data)   \\\n\t(HFI1_VNIC_GET_L4_HDR(data) & 0xFFF)\n\n \n#define HFI1_VNIC_SC_OFFSET_LOW 6\n#define HFI1_VNIC_SC_OFFSET_HI  7\n#define HFI1_VNIC_SC_SHIFT      4\n\n#define HFI1_VNIC_MAX_QUEUE 16\n#define HFI1_NUM_VNIC_CTXT 8\n\n \nstruct hfi1_vnic_sdma {\n\tstruct hfi1_devdata *dd;\n\tstruct sdma_engine  *sde;\n\tstruct hfi1_vnic_vport_info *vinfo;\n\tstruct iowait wait;\n\tstruct sdma_txreq stx;\n\tunsigned int state;\n\tu8 q_idx;\n\tbool pkts_sent;\n};\n\n \nstruct hfi1_vnic_rx_queue {\n\tu8                           idx;\n\tstruct hfi1_vnic_vport_info *vinfo;\n\tstruct net_device           *netdev;\n\tstruct napi_struct           napi;\n};\n\n \nstruct hfi1_vnic_vport_info {\n\tstruct hfi1_devdata *dd;\n\tstruct net_device   *netdev;\n\tunsigned long        flags;\n\n\t \n\tstruct mutex         lock;\n\n\tu8  num_tx_q;\n\tu8  num_rx_q;\n\tu16 vesw_id;\n\tstruct hfi1_vnic_rx_queue rxq[HFI1_NUM_VNIC_CTXT];\n\n\tstruct opa_vnic_stats  stats[HFI1_VNIC_MAX_QUEUE];\n\tstruct hfi1_vnic_sdma  sdma[HFI1_VNIC_MAX_TXQ];\n};\n\n#define v_dbg(format, arg...) \\\n\tnetdev_dbg(vinfo->netdev, format, ## arg)\n#define v_err(format, arg...) \\\n\tnetdev_err(vinfo->netdev, format, ## arg)\n#define v_info(format, arg...) \\\n\tnetdev_info(vinfo->netdev, format, ## arg)\n\n \nvoid hfi1_vnic_setup(struct hfi1_devdata *dd);\nint hfi1_vnic_txreq_init(struct hfi1_devdata *dd);\nvoid hfi1_vnic_txreq_deinit(struct hfi1_devdata *dd);\n\nvoid hfi1_vnic_bypass_rcv(struct hfi1_packet *packet);\nvoid hfi1_vnic_sdma_init(struct hfi1_vnic_vport_info *vinfo);\nbool hfi1_vnic_sdma_write_avail(struct hfi1_vnic_vport_info *vinfo,\n\t\t\t\tu8 q_idx);\n\n \nstruct net_device *hfi1_vnic_alloc_rn(struct ib_device *device,\n\t\t\t\t      u32 port_num,\n\t\t\t\t      enum rdma_netdev_t type,\n\t\t\t\t      const char *name,\n\t\t\t\t      unsigned char name_assign_type,\n\t\t\t\t      void (*setup)(struct net_device *));\nint hfi1_vnic_send_dma(struct hfi1_devdata *dd, u8 q_idx,\n\t\t       struct hfi1_vnic_vport_info *vinfo,\n\t\t       struct sk_buff *skb, u64 pbc, u8 plen);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}