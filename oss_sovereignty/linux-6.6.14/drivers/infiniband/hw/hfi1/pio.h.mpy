{
  "module_name": "pio.h",
  "hash_id": "250fac4305994ba764d81a62096df868777e6ea416a7f5bb02180b5a18dae17e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/hfi1/pio.h",
  "human_readable_source": " \n \n\n#ifndef _PIO_H\n#define _PIO_H\n \n#define SC_KERNEL 0\n#define SC_VL15   1\n#define SC_ACK    2\n#define SC_USER   3\t \n#define SC_MAX    4\t \n\n \n#define INVALID_SCI 0xff\n\n \ntypedef void (*pio_release_cb)(void *arg, int code);\n\n \n#define PRC_OK\t\t0\t \n#define PRC_STATUS_ERR\t0x01\t \n#define PRC_PBC\t\t0x02\t \n#define PRC_THRESHOLD\t0x04\t \n#define PRC_FILL_ERR\t0x08\t \n#define PRC_FORCE\t0x10\t \n#define PRC_SC_DISABLE\t0x20\t \n\n \nunion mix {\n\tu64 val64;\n\tu32 val32[2];\n\tu8  val8[8];\n};\n\n \nstruct pio_buf {\n\tstruct send_context *sc; \n\tpio_release_cb cb;\t \n\tvoid *arg;\t\t \n\tvoid __iomem *start;\t \n\tvoid __iomem *end;\t \n\tunsigned long sent_at;\t \n\tunion mix carry;\t \n\tu16 qw_written;\t\t \n\tu8 carry_bytes;\t \n};\n\n \nunion pio_shadow_ring {\n\tstruct pio_buf pbuf;\n} ____cacheline_aligned;\n\n \nstruct send_context {\n\t \n\tstruct hfi1_devdata *dd;\t\t \n\tunion pio_shadow_ring *sr;\t \n\tvoid __iomem *base_addr;\t \n\tu32 __percpu *buffers_allocated; \n\tu32 size;\t\t\t \n\n\tint node;\t\t\t \n\tu32 sr_size;\t\t\t \n\tu16 flags;\t\t\t \n\tu8  type;\t\t\t \n\tu8  sw_index;\t\t\t \n\tu8  hw_context;\t\t\t \n\tu8  group;\t\t\t \n\n\t \n\tspinlock_t alloc_lock ____cacheline_aligned_in_smp;\n\tu32 sr_head;\t\t\t \n\tunsigned long fill;\t\t \n\tunsigned long alloc_free;\t \n\tu32 fill_wrap;\t\t\t \n\tu32 credits;\t\t\t \n\t \n\n\t \n\tspinlock_t release_lock ____cacheline_aligned_in_smp;\n\tu32 sr_tail;\t\t\t \n\tunsigned long free;\t\t \n\tvolatile __le64 *hw_free;\t \n\t \n\tstruct list_head piowait  ____cacheline_aligned_in_smp;\n\tseqlock_t waitlock;\n\n\tspinlock_t credit_ctrl_lock ____cacheline_aligned_in_smp;\n\tu32 credit_intr_count;\t\t \n\tu64 credit_ctrl;\t\t \n\twait_queue_head_t halt_wait;     \n\tstruct work_struct halt_work;\t \n};\n\n \n#define SCF_ENABLED 0x01\n#define SCF_IN_FREE 0x02\n#define SCF_HALTED  0x04\n#define SCF_FROZEN  0x08\n#define SCF_LINK_DOWN 0x10\n\nstruct send_context_info {\n\tstruct send_context *sc;\t \n\tu16 allocated;\t\t\t \n\tu16 type;\t\t\t \n\tu16 base;\t\t\t \n\tu16 credits;\t\t\t \n};\n\n \nstruct credit_return {\n\tvolatile __le64 cr[8];\n};\n\n \nstruct credit_return_base {\n\tstruct credit_return *va;\n\tdma_addr_t dma;\n};\n\n \nstruct sc_config_sizes {\n\tshort int size;\n\tshort int count;\n};\n\n \n\n \n#define INIT_SC_PER_VL 2\n\n \nstruct pio_map_elem {\n\tu32 mask;\n\tstruct send_context *ksc[];\n};\n\n \nstruct pio_vl_map {\n\tstruct rcu_head list;\n\tu32 mask;\n\tu8 actual_vls;\n\tu8 vls;\n\tstruct pio_map_elem *map[];\n};\n\nint pio_map_init(struct hfi1_devdata *dd, u8 port, u8 num_vls,\n\t\t u8 *vl_scontexts);\nvoid free_pio_map(struct hfi1_devdata *dd);\nstruct send_context *pio_select_send_context_vl(struct hfi1_devdata *dd,\n\t\t\t\t\t\tu32 selector, u8 vl);\nstruct send_context *pio_select_send_context_sc(struct hfi1_devdata *dd,\n\t\t\t\t\t\tu32 selector, u8 sc5);\n\n \nint init_credit_return(struct hfi1_devdata *dd);\nvoid free_credit_return(struct hfi1_devdata *dd);\nint init_sc_pools_and_sizes(struct hfi1_devdata *dd);\nint init_send_contexts(struct hfi1_devdata *dd);\nint init_pervl_scs(struct hfi1_devdata *dd);\nstruct send_context *sc_alloc(struct hfi1_devdata *dd, int type,\n\t\t\t      uint hdrqentsize, int numa);\nvoid sc_free(struct send_context *sc);\nint sc_enable(struct send_context *sc);\nvoid sc_disable(struct send_context *sc);\nint sc_restart(struct send_context *sc);\nvoid sc_return_credits(struct send_context *sc);\nvoid sc_flush(struct send_context *sc);\nvoid sc_drop(struct send_context *sc);\nvoid sc_stop(struct send_context *sc, int bit);\nstruct pio_buf *sc_buffer_alloc(struct send_context *sc, u32 dw_len,\n\t\t\t\tpio_release_cb cb, void *arg);\nvoid sc_release_update(struct send_context *sc);\nvoid sc_group_release_update(struct hfi1_devdata *dd, u32 hw_context);\nvoid sc_add_credit_return_intr(struct send_context *sc);\nvoid sc_del_credit_return_intr(struct send_context *sc);\nvoid sc_set_cr_threshold(struct send_context *sc, u32 new_threshold);\nu32 sc_percent_to_threshold(struct send_context *sc, u32 percent);\nu32 sc_mtu_to_threshold(struct send_context *sc, u32 mtu, u32 hdrqentsize);\nvoid hfi1_sc_wantpiobuf_intr(struct send_context *sc, u32 needint);\nvoid sc_wait(struct hfi1_devdata *dd);\nvoid set_pio_integrity(struct send_context *sc);\n\n \nvoid pio_reset_all(struct hfi1_devdata *dd);\nvoid pio_freeze(struct hfi1_devdata *dd);\nvoid pio_kernel_unfreeze(struct hfi1_devdata *dd);\nvoid pio_kernel_linkup(struct hfi1_devdata *dd);\n\n \n#define PSC_GLOBAL_ENABLE 0\n#define PSC_GLOBAL_DISABLE 1\n#define PSC_GLOBAL_VLARB_ENABLE 2\n#define PSC_GLOBAL_VLARB_DISABLE 3\n#define PSC_CM_RESET 4\n#define PSC_DATA_VL_ENABLE 5\n#define PSC_DATA_VL_DISABLE 6\n\nvoid __cm_reset(struct hfi1_devdata *dd, u64 sendctrl);\nvoid pio_send_control(struct hfi1_devdata *dd, int op);\n\n \nvoid pio_copy(struct hfi1_devdata *dd, struct pio_buf *pbuf, u64 pbc,\n\t      const void *from, size_t count);\nvoid seg_pio_copy_start(struct pio_buf *pbuf, u64 pbc,\n\t\t\tconst void *from, size_t nbytes);\nvoid seg_pio_copy_mid(struct pio_buf *pbuf, const void *from, size_t nbytes);\nvoid seg_pio_copy_end(struct pio_buf *pbuf);\n\nvoid seqfile_dump_sci(struct seq_file *s, u32 i,\n\t\t      struct send_context_info *sci);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}