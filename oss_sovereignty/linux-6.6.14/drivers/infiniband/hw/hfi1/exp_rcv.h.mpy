{
  "module_name": "exp_rcv.h",
  "hash_id": "aa4530b4fa34c69cfba127be05ae1fa47fad4890da1c4a95bbf7678b2d259703",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/hfi1/exp_rcv.h",
  "human_readable_source": " \n \n\n#ifndef _HFI1_EXP_RCV_H\n#define _HFI1_EXP_RCV_H\n#include \"hfi.h\"\n\n#define EXP_TID_SET_EMPTY(set) (set.count == 0 && list_empty(&set.list))\n\n#define EXP_TID_TIDLEN_MASK   0x7FFULL\n#define EXP_TID_TIDLEN_SHIFT  0\n#define EXP_TID_TIDCTRL_MASK  0x3ULL\n#define EXP_TID_TIDCTRL_SHIFT 20\n#define EXP_TID_TIDIDX_MASK   0x3FFULL\n#define EXP_TID_TIDIDX_SHIFT  22\n#define EXP_TID_GET(tid, field)\t\\\n\t(((tid) >> EXP_TID_TID##field##_SHIFT) & EXP_TID_TID##field##_MASK)\n\n#define EXP_TID_SET(field, value)\t\t\t\\\n\t(((value) & EXP_TID_TID##field##_MASK) <<\t\\\n\t EXP_TID_TID##field##_SHIFT)\n#define EXP_TID_CLEAR(tid, field) ({\t\t\t\t\t\\\n\t\t(tid) &= ~(EXP_TID_TID##field##_MASK <<\t\t\t\\\n\t\t\t   EXP_TID_TID##field##_SHIFT);\t\t\t\\\n\t\t})\n#define EXP_TID_RESET(tid, field, value) do {\t\t\t\t\\\n\t\tEXP_TID_CLEAR(tid, field);\t\t\t\t\\\n\t\t(tid) |= EXP_TID_SET(field, (value));\t\t\t\\\n\t} while (0)\n\n \n#define KDETH_OFFSET_SHIFT        0\n#define KDETH_OFFSET_MASK         0x7fff\n#define KDETH_OM_SHIFT            15\n#define KDETH_OM_MASK             0x1\n#define KDETH_TID_SHIFT           16\n#define KDETH_TID_MASK            0x3ff\n#define KDETH_TIDCTRL_SHIFT       26\n#define KDETH_TIDCTRL_MASK        0x3\n#define KDETH_INTR_SHIFT          28\n#define KDETH_INTR_MASK           0x1\n#define KDETH_SH_SHIFT            29\n#define KDETH_SH_MASK             0x1\n#define KDETH_KVER_SHIFT          30\n#define KDETH_KVER_MASK           0x3\n#define KDETH_JKEY_SHIFT          0x0\n#define KDETH_JKEY_MASK           0xff\n#define KDETH_HCRC_UPPER_SHIFT    16\n#define KDETH_HCRC_UPPER_MASK     0xff\n#define KDETH_HCRC_LOWER_SHIFT    24\n#define KDETH_HCRC_LOWER_MASK     0xff\n\n#define KDETH_GET(val, field)\t\t\t\t\t\t\\\n\t(((le32_to_cpu((val))) >> KDETH_##field##_SHIFT) & KDETH_##field##_MASK)\n#define KDETH_SET(dw, field, val) do {\t\t\t\t\t\\\n\t\tu32 dwval = le32_to_cpu(dw);\t\t\t\t\\\n\t\tdwval &= ~(KDETH_##field##_MASK << KDETH_##field##_SHIFT); \\\n\t\tdwval |= (((val) & KDETH_##field##_MASK) << \\\n\t\t\t  KDETH_##field##_SHIFT);\t\t\t\\\n\t\tdw = cpu_to_le32(dwval);\t\t\t\t\\\n\t} while (0)\n\n#define KDETH_RESET(dw, field, val) ({ dw = 0; KDETH_SET(dw, field, val); })\n\n \n#define KDETH_OM_SMALL     4\n#define KDETH_OM_SMALL_SHIFT     2\n#define KDETH_OM_LARGE     64\n#define KDETH_OM_LARGE_SHIFT     6\n#define KDETH_OM_MAX_SIZE  (1 << ((KDETH_OM_LARGE / KDETH_OM_SMALL) + 1))\n\nstruct tid_group {\n\tstruct list_head list;\n\tu32 base;\n\tu8 size;\n\tu8 used;\n\tu8 map;\n};\n\n \nstatic inline void rcv_array_wc_fill(struct hfi1_devdata *dd, u32 index)\n{\n\t \n\tif ((dd->flags & HFI1_PRESENT) && dd->rcvarray_wc) {\n\t\twriteq(0, dd->rcvarray_wc + (index * 8));\n\t\tif ((index & 3) == 3)\n\t\t\tflush_wc();\n\t}\n}\n\nstatic inline void tid_group_add_tail(struct tid_group *grp,\n\t\t\t\t      struct exp_tid_set *set)\n{\n\tlist_add_tail(&grp->list, &set->list);\n\tset->count++;\n}\n\nstatic inline void tid_group_remove(struct tid_group *grp,\n\t\t\t\t    struct exp_tid_set *set)\n{\n\tlist_del_init(&grp->list);\n\tset->count--;\n}\n\nstatic inline void tid_group_move(struct tid_group *group,\n\t\t\t\t  struct exp_tid_set *s1,\n\t\t\t\t  struct exp_tid_set *s2)\n{\n\ttid_group_remove(group, s1);\n\ttid_group_add_tail(group, s2);\n}\n\nstatic inline struct tid_group *tid_group_pop(struct exp_tid_set *set)\n{\n\tstruct tid_group *grp =\n\t\tlist_first_entry(&set->list, struct tid_group, list);\n\tlist_del_init(&grp->list);\n\tset->count--;\n\treturn grp;\n}\n\nstatic inline u32 create_tid(u32 rcventry, u32 npages)\n{\n\tu32 pair = rcventry & ~0x1;\n\n\treturn EXP_TID_SET(IDX, pair >> 1) |\n\t\tEXP_TID_SET(CTRL, 1 << (rcventry - pair)) |\n\t\tEXP_TID_SET(LEN, npages);\n}\n\n \nstatic inline u16\nhfi1_tid_group_to_idx(struct hfi1_ctxtdata *rcd, struct tid_group *grp)\n{\n\treturn grp - &rcd->groups[0];\n}\n\n \nstatic inline struct tid_group *\nhfi1_idx_to_tid_group(struct hfi1_ctxtdata *rcd, u16 idx)\n{\n\treturn &rcd->groups[idx];\n}\n\nint hfi1_alloc_ctxt_rcv_groups(struct hfi1_ctxtdata *rcd);\nvoid hfi1_free_ctxt_rcv_groups(struct hfi1_ctxtdata *rcd);\nvoid hfi1_exp_tid_group_init(struct hfi1_ctxtdata *rcd);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}