{
  "module_name": "trace_tx.h",
  "hash_id": "73f6aa622184cef9ea9d8b6d47497787dbe5cdb2b4e79f2bcb6e9e58af037793",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/hfi1/trace_tx.h",
  "human_readable_source": " \n \n#if !defined(__HFI1_TRACE_TX_H) || defined(TRACE_HEADER_MULTI_READ)\n#define __HFI1_TRACE_TX_H\n\n#include <linux/tracepoint.h>\n#include <linux/trace_seq.h>\n\n#include \"hfi.h\"\n#include \"mad.h\"\n#include \"sdma.h\"\n#include \"ipoib.h\"\n#include \"user_sdma.h\"\n\nconst char *parse_sdma_flags(struct trace_seq *p, u64 desc0, u64 desc1);\n\n#define __parse_sdma_flags(desc0, desc1) parse_sdma_flags(p, desc0, desc1)\n\n#undef TRACE_SYSTEM\n#define TRACE_SYSTEM hfi1_tx\n\nTRACE_EVENT(hfi1_piofree,\n\t    TP_PROTO(struct send_context *sc, int extra),\n\t    TP_ARGS(sc, extra),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(sc->dd)\n\t    __field(u32, sw_index)\n\t    __field(u32, hw_context)\n\t    __field(int, extra)\n\t    ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(sc->dd);\n\t    __entry->sw_index = sc->sw_index;\n\t    __entry->hw_context = sc->hw_context;\n\t    __entry->extra = extra;\n\t    ),\n\t    TP_printk(\"[%s] ctxt %u(%u) extra %d\",\n\t\t      __get_str(dev),\n\t\t      __entry->sw_index,\n\t\t      __entry->hw_context,\n\t\t      __entry->extra\n\t    )\n);\n\nTRACE_EVENT(hfi1_wantpiointr,\n\t    TP_PROTO(struct send_context *sc, u32 needint, u64 credit_ctrl),\n\t    TP_ARGS(sc, needint, credit_ctrl),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(sc->dd)\n\t\t\t__field(u32, sw_index)\n\t\t\t__field(u32, hw_context)\n\t\t\t__field(u32, needint)\n\t\t\t__field(u64, credit_ctrl)\n\t\t\t),\n\t    TP_fast_assign(DD_DEV_ASSIGN(sc->dd);\n\t\t\t__entry->sw_index = sc->sw_index;\n\t\t\t__entry->hw_context = sc->hw_context;\n\t\t\t__entry->needint = needint;\n\t\t\t__entry->credit_ctrl = credit_ctrl;\n\t\t\t),\n\t    TP_printk(\"[%s] ctxt %u(%u) on %d credit_ctrl 0x%llx\",\n\t\t      __get_str(dev),\n\t\t      __entry->sw_index,\n\t\t      __entry->hw_context,\n\t\t      __entry->needint,\n\t\t      (unsigned long long)__entry->credit_ctrl\n\t\t      )\n);\n\nDECLARE_EVENT_CLASS(hfi1_qpsleepwakeup_template,\n\t\t    TP_PROTO(struct rvt_qp *qp, u32 flags),\n\t\t    TP_ARGS(qp, flags),\n\t\t    TP_STRUCT__entry(\n\t\t    DD_DEV_ENTRY(dd_from_ibdev(qp->ibqp.device))\n\t\t    __field(u32, qpn)\n\t\t    __field(u32, flags)\n\t\t    __field(u32, s_flags)\n\t\t    __field(u32, ps_flags)\n\t\t    __field(unsigned long, iow_flags)\n\t\t    ),\n\t\t    TP_fast_assign(\n\t\t    DD_DEV_ASSIGN(dd_from_ibdev(qp->ibqp.device));\n\t\t    __entry->flags = flags;\n\t\t    __entry->qpn = qp->ibqp.qp_num;\n\t\t    __entry->s_flags = qp->s_flags;\n\t\t    __entry->ps_flags =\n\t\t\t((struct hfi1_qp_priv *)qp->priv)->s_flags;\n\t\t    __entry->iow_flags =\n\t\t\t((struct hfi1_qp_priv *)qp->priv)->s_iowait.flags;\n\t\t    ),\n\t\t    TP_printk(\n\t\t    \"[%s] qpn 0x%x flags 0x%x s_flags 0x%x ps_flags 0x%x iow_flags 0x%lx\",\n\t\t    __get_str(dev),\n\t\t    __entry->qpn,\n\t\t    __entry->flags,\n\t\t    __entry->s_flags,\n\t\t    __entry->ps_flags,\n\t\t    __entry->iow_flags\n\t\t    )\n);\n\nDEFINE_EVENT(hfi1_qpsleepwakeup_template, hfi1_qpwakeup,\n\t     TP_PROTO(struct rvt_qp *qp, u32 flags),\n\t     TP_ARGS(qp, flags));\n\nDEFINE_EVENT(hfi1_qpsleepwakeup_template, hfi1_qpsleep,\n\t     TP_PROTO(struct rvt_qp *qp, u32 flags),\n\t     TP_ARGS(qp, flags));\n\nTRACE_EVENT(hfi1_sdma_descriptor,\n\t    TP_PROTO(struct sdma_engine *sde,\n\t\t     u64 desc0,\n\t\t     u64 desc1,\n\t\t     u16 e,\n\t\t     void *descp),\n\t\t     TP_ARGS(sde, desc0, desc1, e, descp),\n\t\t     TP_STRUCT__entry(DD_DEV_ENTRY(sde->dd)\n\t\t     __field(void *, descp)\n\t\t     __field(u64, desc0)\n\t\t     __field(u64, desc1)\n\t\t     __field(u16, e)\n\t\t     __field(u8, idx)\n\t\t     ),\n\t\t     TP_fast_assign(DD_DEV_ASSIGN(sde->dd);\n\t\t     __entry->desc0 = desc0;\n\t\t     __entry->desc1 = desc1;\n\t\t     __entry->idx = sde->this_idx;\n\t\t     __entry->descp = descp;\n\t\t     __entry->e = e;\n\t\t     ),\n\t    TP_printk(\n\t    \"[%s] SDE(%u) flags:%s addr:0x%016llx gen:%u len:%u d0:%016llx d1:%016llx to %p,%u\",\n\t    __get_str(dev),\n\t    __entry->idx,\n\t    __parse_sdma_flags(__entry->desc0, __entry->desc1),\n\t    (__entry->desc0 >> SDMA_DESC0_PHY_ADDR_SHIFT) &\n\t    SDMA_DESC0_PHY_ADDR_MASK,\n\t    (u8)((__entry->desc1 >> SDMA_DESC1_GENERATION_SHIFT) &\n\t    SDMA_DESC1_GENERATION_MASK),\n\t    (u16)((__entry->desc0 >> SDMA_DESC0_BYTE_COUNT_SHIFT) &\n\t    SDMA_DESC0_BYTE_COUNT_MASK),\n\t    __entry->desc0,\n\t    __entry->desc1,\n\t    __entry->descp,\n\t    __entry->e\n\t    )\n);\n\nTRACE_EVENT(hfi1_sdma_engine_select,\n\t    TP_PROTO(struct hfi1_devdata *dd, u32 sel, u8 vl, u8 idx),\n\t    TP_ARGS(dd, sel, vl, idx),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(dd)\n\t    __field(u32, sel)\n\t    __field(u8, vl)\n\t    __field(u8, idx)\n\t    ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(dd);\n\t    __entry->sel = sel;\n\t    __entry->vl = vl;\n\t    __entry->idx = idx;\n\t    ),\n\t    TP_printk(\"[%s] selecting SDE %u sel 0x%x vl %u\",\n\t\t      __get_str(dev),\n\t\t      __entry->idx,\n\t\t      __entry->sel,\n\t\t      __entry->vl\n\t\t      )\n);\n\nTRACE_EVENT(hfi1_sdma_user_free_queues,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt),\n\t    TP_ARGS(dd, ctxt, subctxt),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(dd)\n\t\t\t     __field(u16, ctxt)\n\t\t\t     __field(u16, subctxt)\n\t\t\t     ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(dd);\n\t\t\t   __entry->ctxt = ctxt;\n\t\t\t   __entry->subctxt = subctxt;\n\t\t\t   ),\n\t    TP_printk(\"[%s] SDMA [%u:%u] Freeing user SDMA queues\",\n\t\t      __get_str(dev),\n\t\t      __entry->ctxt,\n\t\t      __entry->subctxt\n\t\t      )\n);\n\nTRACE_EVENT(hfi1_sdma_user_process_request,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt,\n\t\t     u16 comp_idx),\n\t    TP_ARGS(dd, ctxt, subctxt, comp_idx),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(dd)\n\t\t\t     __field(u16, ctxt)\n\t\t\t     __field(u16, subctxt)\n\t\t\t     __field(u16, comp_idx)\n\t\t\t     ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(dd);\n\t\t\t   __entry->ctxt = ctxt;\n\t\t\t   __entry->subctxt = subctxt;\n\t\t\t   __entry->comp_idx = comp_idx;\n\t\t\t   ),\n\t    TP_printk(\"[%s] SDMA [%u:%u] Using req/comp entry: %u\",\n\t\t      __get_str(dev),\n\t\t      __entry->ctxt,\n\t\t      __entry->subctxt,\n\t\t      __entry->comp_idx\n\t\t      )\n);\n\nDECLARE_EVENT_CLASS(\n\thfi1_sdma_value_template,\n\tTP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt, u16 comp_idx,\n\t\t u32 value),\n\tTP_ARGS(dd, ctxt, subctxt, comp_idx, value),\n\tTP_STRUCT__entry(DD_DEV_ENTRY(dd)\n\t\t\t __field(u16, ctxt)\n\t\t\t __field(u16, subctxt)\n\t\t\t __field(u16, comp_idx)\n\t\t\t __field(u32, value)\n\t\t),\n\tTP_fast_assign(DD_DEV_ASSIGN(dd);\n\t\t       __entry->ctxt = ctxt;\n\t\t       __entry->subctxt = subctxt;\n\t\t       __entry->comp_idx = comp_idx;\n\t\t       __entry->value = value;\n\t\t),\n\tTP_printk(\"[%s] SDMA [%u:%u:%u] value: %u\",\n\t\t  __get_str(dev),\n\t\t  __entry->ctxt,\n\t\t  __entry->subctxt,\n\t\t  __entry->comp_idx,\n\t\t  __entry->value\n\t\t)\n);\n\nDEFINE_EVENT(hfi1_sdma_value_template, hfi1_sdma_user_initial_tidoffset,\n\t     TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt,\n\t\t      u16 comp_idx, u32 tidoffset),\n\t     TP_ARGS(dd, ctxt, subctxt, comp_idx, tidoffset));\n\nDEFINE_EVENT(hfi1_sdma_value_template, hfi1_sdma_user_data_length,\n\t     TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt,\n\t\t      u16 comp_idx, u32 data_len),\n\t     TP_ARGS(dd, ctxt, subctxt, comp_idx, data_len));\n\nDEFINE_EVENT(hfi1_sdma_value_template, hfi1_sdma_user_compute_length,\n\t     TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt,\n\t\t      u16 comp_idx, u32 data_len),\n\t     TP_ARGS(dd, ctxt, subctxt, comp_idx, data_len));\n\nTRACE_EVENT(hfi1_sdma_user_tid_info,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt,\n\t\t     u16 comp_idx, u32 tidoffset, u32 units, u8 shift),\n\t    TP_ARGS(dd, ctxt, subctxt, comp_idx, tidoffset, units, shift),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(dd)\n\t\t\t     __field(u16, ctxt)\n\t\t\t     __field(u16, subctxt)\n\t\t\t     __field(u16, comp_idx)\n\t\t\t     __field(u32, tidoffset)\n\t\t\t     __field(u32, units)\n\t\t\t     __field(u8, shift)\n\t\t\t     ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(dd);\n\t\t\t   __entry->ctxt = ctxt;\n\t\t\t   __entry->subctxt = subctxt;\n\t\t\t   __entry->comp_idx = comp_idx;\n\t\t\t   __entry->tidoffset = tidoffset;\n\t\t\t   __entry->units = units;\n\t\t\t   __entry->shift = shift;\n\t\t\t   ),\n\t    TP_printk(\"[%s] SDMA [%u:%u:%u] TID offset %ubytes %uunits om %u\",\n\t\t      __get_str(dev),\n\t\t      __entry->ctxt,\n\t\t      __entry->subctxt,\n\t\t      __entry->comp_idx,\n\t\t      __entry->tidoffset,\n\t\t      __entry->units,\n\t\t      __entry->shift\n\t\t      )\n);\n\nTRACE_EVENT(hfi1_sdma_request,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u16 subctxt,\n\t\t     unsigned long dim),\n\t    TP_ARGS(dd, ctxt, subctxt, dim),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(dd)\n\t\t\t     __field(u16, ctxt)\n\t\t\t     __field(u16, subctxt)\n\t\t\t     __field(unsigned long, dim)\n\t\t\t     ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(dd);\n\t\t\t   __entry->ctxt = ctxt;\n\t\t\t   __entry->subctxt = subctxt;\n\t\t\t   __entry->dim = dim;\n\t\t\t   ),\n\t    TP_printk(\"[%s] SDMA from %u:%u (%lu)\",\n\t\t      __get_str(dev),\n\t\t      __entry->ctxt,\n\t\t      __entry->subctxt,\n\t\t      __entry->dim\n\t\t      )\n);\n\nDECLARE_EVENT_CLASS(hfi1_sdma_engine_class,\n\t\t    TP_PROTO(struct sdma_engine *sde, u64 status),\n\t\t    TP_ARGS(sde, status),\n\t\t    TP_STRUCT__entry(DD_DEV_ENTRY(sde->dd)\n\t\t    __field(u64, status)\n\t\t    __field(u8, idx)\n\t\t    ),\n\t\t    TP_fast_assign(DD_DEV_ASSIGN(sde->dd);\n\t\t    __entry->status = status;\n\t\t    __entry->idx = sde->this_idx;\n\t\t    ),\n\t\t    TP_printk(\"[%s] SDE(%u) status %llx\",\n\t\t\t      __get_str(dev),\n\t\t\t      __entry->idx,\n\t\t\t      (unsigned long long)__entry->status\n\t\t\t      )\n);\n\nDEFINE_EVENT(hfi1_sdma_engine_class, hfi1_sdma_engine_interrupt,\n\t     TP_PROTO(struct sdma_engine *sde, u64 status),\n\t     TP_ARGS(sde, status)\n);\n\nDEFINE_EVENT(hfi1_sdma_engine_class, hfi1_sdma_engine_progress,\n\t     TP_PROTO(struct sdma_engine *sde, u64 status),\n\t     TP_ARGS(sde, status)\n);\n\nDECLARE_EVENT_CLASS(hfi1_sdma_ahg_ad,\n\t\t    TP_PROTO(struct sdma_engine *sde, int aidx),\n\t\t    TP_ARGS(sde, aidx),\n\t\t    TP_STRUCT__entry(DD_DEV_ENTRY(sde->dd)\n\t\t    __field(int, aidx)\n\t\t    __field(u8, idx)\n\t\t    ),\n\t\t    TP_fast_assign(DD_DEV_ASSIGN(sde->dd);\n\t\t    __entry->idx = sde->this_idx;\n\t\t    __entry->aidx = aidx;\n\t\t    ),\n\t\t    TP_printk(\"[%s] SDE(%u) aidx %d\",\n\t\t\t      __get_str(dev),\n\t\t\t      __entry->idx,\n\t\t\t      __entry->aidx\n\t\t\t      )\n);\n\nDEFINE_EVENT(hfi1_sdma_ahg_ad, hfi1_ahg_allocate,\n\t     TP_PROTO(struct sdma_engine *sde, int aidx),\n\t     TP_ARGS(sde, aidx));\n\nDEFINE_EVENT(hfi1_sdma_ahg_ad, hfi1_ahg_deallocate,\n\t     TP_PROTO(struct sdma_engine *sde, int aidx),\n\t     TP_ARGS(sde, aidx));\n\n#ifdef CONFIG_HFI1_DEBUG_SDMA_ORDER\nTRACE_EVENT(hfi1_sdma_progress,\n\t    TP_PROTO(struct sdma_engine *sde,\n\t\t     u16 hwhead,\n\t\t     u16 swhead,\n\t\t     struct sdma_txreq *txp\n\t\t     ),\n\t    TP_ARGS(sde, hwhead, swhead, txp),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(sde->dd)\n\t    __field(u64, sn)\n\t    __field(u16, hwhead)\n\t    __field(u16, swhead)\n\t    __field(u16, txnext)\n\t    __field(u16, tx_tail)\n\t    __field(u16, tx_head)\n\t    __field(u8, idx)\n\t    ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(sde->dd);\n\t    __entry->hwhead = hwhead;\n\t    __entry->swhead = swhead;\n\t    __entry->tx_tail = sde->tx_tail;\n\t    __entry->tx_head = sde->tx_head;\n\t    __entry->txnext = txp ? txp->next_descq_idx : ~0;\n\t    __entry->idx = sde->this_idx;\n\t    __entry->sn = txp ? txp->sn : ~0;\n\t    ),\n\t    TP_printk(\n\t    \"[%s] SDE(%u) sn %llu hwhead %u swhead %u next_descq_idx %u tx_head %u tx_tail %u\",\n\t    __get_str(dev),\n\t    __entry->idx,\n\t    __entry->sn,\n\t    __entry->hwhead,\n\t    __entry->swhead,\n\t    __entry->txnext,\n\t    __entry->tx_head,\n\t    __entry->tx_tail\n\t    )\n);\n#else\nTRACE_EVENT(hfi1_sdma_progress,\n\t    TP_PROTO(struct sdma_engine *sde,\n\t\t     u16 hwhead, u16 swhead,\n\t\t     struct sdma_txreq *txp\n\t\t     ),\n\t    TP_ARGS(sde, hwhead, swhead, txp),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(sde->dd)\n\t\t    __field(u16, hwhead)\n\t\t    __field(u16, swhead)\n\t\t    __field(u16, txnext)\n\t\t    __field(u16, tx_tail)\n\t\t    __field(u16, tx_head)\n\t\t    __field(u8, idx)\n\t\t    ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(sde->dd);\n\t\t    __entry->hwhead = hwhead;\n\t\t    __entry->swhead = swhead;\n\t\t    __entry->tx_tail = sde->tx_tail;\n\t\t    __entry->tx_head = sde->tx_head;\n\t\t    __entry->txnext = txp ? txp->next_descq_idx : ~0;\n\t\t    __entry->idx = sde->this_idx;\n\t\t    ),\n\t    TP_printk(\n\t\t    \"[%s] SDE(%u) hwhead %u swhead %u next_descq_idx %u tx_head %u tx_tail %u\",\n\t\t    __get_str(dev),\n\t\t    __entry->idx,\n\t\t    __entry->hwhead,\n\t\t    __entry->swhead,\n\t\t    __entry->txnext,\n\t\t    __entry->tx_head,\n\t\t    __entry->tx_tail\n\t    )\n);\n#endif\n\nDECLARE_EVENT_CLASS(hfi1_sdma_sn,\n\t\t    TP_PROTO(struct sdma_engine *sde, u64 sn),\n\t\t    TP_ARGS(sde, sn),\n\t\t    TP_STRUCT__entry(DD_DEV_ENTRY(sde->dd)\n\t\t    __field(u64, sn)\n\t\t    __field(u8, idx)\n\t\t    ),\n\t\t    TP_fast_assign(DD_DEV_ASSIGN(sde->dd);\n\t\t    __entry->sn = sn;\n\t\t    __entry->idx = sde->this_idx;\n\t\t    ),\n\t\t    TP_printk(\"[%s] SDE(%u) sn %llu\",\n\t\t\t      __get_str(dev),\n\t\t\t      __entry->idx,\n\t\t\t      __entry->sn\n\t\t\t      )\n);\n\nDEFINE_EVENT(hfi1_sdma_sn, hfi1_sdma_out_sn,\n\t     TP_PROTO(\n\t     struct sdma_engine *sde,\n\t     u64 sn\n\t     ),\n\t     TP_ARGS(sde, sn)\n);\n\nDEFINE_EVENT(hfi1_sdma_sn, hfi1_sdma_in_sn,\n\t     TP_PROTO(struct sdma_engine *sde, u64 sn),\n\t     TP_ARGS(sde, sn)\n);\n\n#define USDMA_HDR_FORMAT \\\n\t\"[%s:%u:%u:%u] PBC=(0x%x 0x%x) LRH=(0x%x 0x%x) BTH=(0x%x 0x%x 0x%x) KDETH=(0x%x 0x%x 0x%x 0x%x 0x%x 0x%x 0x%x 0x%x 0x%x) TIDVal=0x%x\"\n\nTRACE_EVENT(hfi1_sdma_user_header,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u8 subctxt, u16 req,\n\t\t     struct hfi1_pkt_header *hdr, u32 tidval),\n\t    TP_ARGS(dd, ctxt, subctxt, req, hdr, tidval),\n\t    TP_STRUCT__entry(\n\t\t    DD_DEV_ENTRY(dd)\n\t\t    __field(u16, ctxt)\n\t\t    __field(u8, subctxt)\n\t\t    __field(u16, req)\n\t\t    __field(u32, pbc0)\n\t\t    __field(u32, pbc1)\n\t\t    __field(u32, lrh0)\n\t\t    __field(u32, lrh1)\n\t\t    __field(u32, bth0)\n\t\t    __field(u32, bth1)\n\t\t    __field(u32, bth2)\n\t\t    __field(u32, kdeth0)\n\t\t    __field(u32, kdeth1)\n\t\t    __field(u32, kdeth2)\n\t\t    __field(u32, kdeth3)\n\t\t    __field(u32, kdeth4)\n\t\t    __field(u32, kdeth5)\n\t\t    __field(u32, kdeth6)\n\t\t    __field(u32, kdeth7)\n\t\t    __field(u32, kdeth8)\n\t\t    __field(u32, tidval)\n\t\t    ),\n\t\t    TP_fast_assign(\n\t\t    __le32 *pbc = (__le32 *)hdr->pbc;\n\t\t    __be32 *lrh = (__be32 *)hdr->lrh;\n\t\t    __be32 *bth = (__be32 *)hdr->bth;\n\t\t    __le32 *kdeth = (__le32 *)&hdr->kdeth;\n\n\t\t    DD_DEV_ASSIGN(dd);\n\t\t    __entry->ctxt = ctxt;\n\t\t    __entry->subctxt = subctxt;\n\t\t    __entry->req = req;\n\t\t    __entry->pbc0 = le32_to_cpu(pbc[0]);\n\t\t    __entry->pbc1 = le32_to_cpu(pbc[1]);\n\t\t    __entry->lrh0 = be32_to_cpu(lrh[0]);\n\t\t    __entry->lrh1 = be32_to_cpu(lrh[1]);\n\t\t    __entry->bth0 = be32_to_cpu(bth[0]);\n\t\t    __entry->bth1 = be32_to_cpu(bth[1]);\n\t\t    __entry->bth2 = be32_to_cpu(bth[2]);\n\t\t    __entry->kdeth0 = le32_to_cpu(kdeth[0]);\n\t\t    __entry->kdeth1 = le32_to_cpu(kdeth[1]);\n\t\t    __entry->kdeth2 = le32_to_cpu(kdeth[2]);\n\t\t    __entry->kdeth3 = le32_to_cpu(kdeth[3]);\n\t\t    __entry->kdeth4 = le32_to_cpu(kdeth[4]);\n\t\t    __entry->kdeth5 = le32_to_cpu(kdeth[5]);\n\t\t    __entry->kdeth6 = le32_to_cpu(kdeth[6]);\n\t\t    __entry->kdeth7 = le32_to_cpu(kdeth[7]);\n\t\t    __entry->kdeth8 = le32_to_cpu(kdeth[8]);\n\t\t    __entry->tidval = tidval;\n\t    ),\n\t    TP_printk(USDMA_HDR_FORMAT,\n\t\t      __get_str(dev),\n\t\t      __entry->ctxt,\n\t\t      __entry->subctxt,\n\t\t      __entry->req,\n\t\t      __entry->pbc1,\n\t\t      __entry->pbc0,\n\t\t      __entry->lrh0,\n\t\t      __entry->lrh1,\n\t\t      __entry->bth0,\n\t\t      __entry->bth1,\n\t\t      __entry->bth2,\n\t\t      __entry->kdeth0,\n\t\t      __entry->kdeth1,\n\t\t      __entry->kdeth2,\n\t\t      __entry->kdeth3,\n\t\t      __entry->kdeth4,\n\t\t      __entry->kdeth5,\n\t\t      __entry->kdeth6,\n\t\t      __entry->kdeth7,\n\t\t      __entry->kdeth8,\n\t\t      __entry->tidval\n\t    )\n);\n\n#define SDMA_UREQ_FMT \\\n\t\"[%s:%u:%u] ver/op=0x%x, iovcnt=%u, npkts=%u, frag=%u, idx=%u\"\nTRACE_EVENT(hfi1_sdma_user_reqinfo,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u8 subctxt, u16 *i),\n\t    TP_ARGS(dd, ctxt, subctxt, i),\n\t    TP_STRUCT__entry(\n\t\t    DD_DEV_ENTRY(dd)\n\t\t    __field(u16, ctxt)\n\t\t    __field(u8, subctxt)\n\t\t    __field(u8, ver_opcode)\n\t\t    __field(u8, iovcnt)\n\t\t    __field(u16, npkts)\n\t\t    __field(u16, fragsize)\n\t\t    __field(u16, comp_idx)\n\t    ),\n\t    TP_fast_assign(\n\t\t    DD_DEV_ASSIGN(dd);\n\t\t    __entry->ctxt = ctxt;\n\t\t    __entry->subctxt = subctxt;\n\t\t    __entry->ver_opcode = i[0] & 0xff;\n\t\t    __entry->iovcnt = (i[0] >> 8) & 0xff;\n\t\t    __entry->npkts = i[1];\n\t\t    __entry->fragsize = i[2];\n\t\t    __entry->comp_idx = i[3];\n\t    ),\n\t    TP_printk(SDMA_UREQ_FMT,\n\t\t      __get_str(dev),\n\t\t      __entry->ctxt,\n\t\t      __entry->subctxt,\n\t\t      __entry->ver_opcode,\n\t\t      __entry->iovcnt,\n\t\t      __entry->npkts,\n\t\t      __entry->fragsize,\n\t\t      __entry->comp_idx\n\t\t      )\n);\n\n#define usdma_complete_name(st) { st, #st }\n#define show_usdma_complete_state(st)\t\t\t\\\n\t__print_symbolic(st,\t\t\t\t\\\n\t\t\tusdma_complete_name(FREE),\t\\\n\t\t\tusdma_complete_name(QUEUED),\t\\\n\t\t\tusdma_complete_name(COMPLETE), \\\n\t\t\tusdma_complete_name(ERROR))\n\nTRACE_EVENT(hfi1_sdma_user_completion,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u8 subctxt, u16 idx,\n\t\t     u8 state, int code),\n\t    TP_ARGS(dd, ctxt, subctxt, idx, state, code),\n\t    TP_STRUCT__entry(\n\t    DD_DEV_ENTRY(dd)\n\t    __field(u16, ctxt)\n\t    __field(u8, subctxt)\n\t    __field(u16, idx)\n\t    __field(u8, state)\n\t    __field(int, code)\n\t    ),\n\t    TP_fast_assign(\n\t    DD_DEV_ASSIGN(dd);\n\t    __entry->ctxt = ctxt;\n\t    __entry->subctxt = subctxt;\n\t    __entry->idx = idx;\n\t    __entry->state = state;\n\t    __entry->code = code;\n\t    ),\n\t    TP_printk(\"[%s:%u:%u:%u] SDMA completion state %s (%d)\",\n\t\t      __get_str(dev), __entry->ctxt, __entry->subctxt,\n\t\t      __entry->idx, show_usdma_complete_state(__entry->state),\n\t\t      __entry->code)\n);\n\nTRACE_EVENT(hfi1_usdma_defer,\n\t    TP_PROTO(struct hfi1_user_sdma_pkt_q *pq,\n\t\t     struct sdma_engine *sde,\n\t\t     struct iowait *wait),\n\t    TP_ARGS(pq, sde, wait),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(pq->dd)\n\t\t\t     __field(struct hfi1_user_sdma_pkt_q *, pq)\n\t\t\t     __field(struct sdma_engine *, sde)\n\t\t\t     __field(struct iowait *, wait)\n\t\t\t     __field(int, engine)\n\t\t\t     __field(int, empty)\n\t\t\t     ),\n\t     TP_fast_assign(DD_DEV_ASSIGN(pq->dd);\n\t\t\t    __entry->pq = pq;\n\t\t\t    __entry->sde = sde;\n\t\t\t    __entry->wait = wait;\n\t\t\t    __entry->engine = sde->this_idx;\n\t\t\t    __entry->empty = list_empty(&__entry->wait->list);\n\t\t\t    ),\n\t     TP_printk(\"[%s] pq %llx sde %llx wait %llx engine %d empty %d\",\n\t\t       __get_str(dev),\n\t\t       (unsigned long long)__entry->pq,\n\t\t       (unsigned long long)__entry->sde,\n\t\t       (unsigned long long)__entry->wait,\n\t\t       __entry->engine,\n\t\t       __entry->empty\n\t\t)\n);\n\nTRACE_EVENT(hfi1_usdma_activate,\n\t    TP_PROTO(struct hfi1_user_sdma_pkt_q *pq,\n\t\t     struct iowait *wait,\n\t\t     int reason),\n\t    TP_ARGS(pq, wait, reason),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(pq->dd)\n\t\t\t     __field(struct hfi1_user_sdma_pkt_q *, pq)\n\t\t\t     __field(struct iowait *, wait)\n\t\t\t     __field(int, reason)\n\t\t\t     ),\n\t     TP_fast_assign(DD_DEV_ASSIGN(pq->dd);\n\t\t\t    __entry->pq = pq;\n\t\t\t    __entry->wait = wait;\n\t\t\t    __entry->reason = reason;\n\t\t\t    ),\n\t     TP_printk(\"[%s] pq %llx wait %llx reason %d\",\n\t\t       __get_str(dev),\n\t\t       (unsigned long long)__entry->pq,\n\t\t       (unsigned long long)__entry->wait,\n\t\t       __entry->reason\n\t\t)\n);\n\nTRACE_EVENT(hfi1_usdma_we,\n\t    TP_PROTO(struct hfi1_user_sdma_pkt_q *pq,\n\t\t     int we_ret),\n\t    TP_ARGS(pq, we_ret),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(pq->dd)\n\t\t\t     __field(struct hfi1_user_sdma_pkt_q *, pq)\n\t\t\t     __field(int, state)\n\t\t\t     __field(int, we_ret)\n\t\t\t     ),\n\t     TP_fast_assign(DD_DEV_ASSIGN(pq->dd);\n\t\t\t    __entry->pq = pq;\n\t\t\t    __entry->state = pq->state;\n\t\t\t    __entry->we_ret = we_ret;\n\t\t\t    ),\n\t     TP_printk(\"[%s] pq %llx state %d we_ret %d\",\n\t\t       __get_str(dev),\n\t\t       (unsigned long long)__entry->pq,\n\t\t       __entry->state,\n\t\t       __entry->we_ret\n\t\t)\n);\n\nconst char *print_u32_array(struct trace_seq *, u32 *, int);\n#define __print_u32_hex(arr, len) print_u32_array(p, arr, len)\n\nTRACE_EVENT(hfi1_sdma_user_header_ahg,\n\t    TP_PROTO(struct hfi1_devdata *dd, u16 ctxt, u8 subctxt, u16 req,\n\t\t     u8 sde, u8 ahgidx, u32 *ahg, int len, u32 tidval),\n\t    TP_ARGS(dd, ctxt, subctxt, req, sde, ahgidx, ahg, len, tidval),\n\t    TP_STRUCT__entry(\n\t    DD_DEV_ENTRY(dd)\n\t    __field(u16, ctxt)\n\t    __field(u8, subctxt)\n\t    __field(u16, req)\n\t    __field(u8, sde)\n\t    __field(u8, idx)\n\t    __field(int, len)\n\t    __field(u32, tidval)\n\t    __array(u32, ahg, 10)\n\t    ),\n\t    TP_fast_assign(\n\t    DD_DEV_ASSIGN(dd);\n\t    __entry->ctxt = ctxt;\n\t    __entry->subctxt = subctxt;\n\t    __entry->req = req;\n\t    __entry->sde = sde;\n\t    __entry->idx = ahgidx;\n\t    __entry->len = len;\n\t    __entry->tidval = tidval;\n\t    memcpy(__entry->ahg, ahg, len * sizeof(u32));\n\t    ),\n\t    TP_printk(\"[%s:%u:%u:%u] (SDE%u/AHG%u) ahg[0-%d]=(%s) TIDVal=0x%x\",\n\t\t      __get_str(dev),\n\t\t      __entry->ctxt,\n\t\t      __entry->subctxt,\n\t\t      __entry->req,\n\t\t      __entry->sde,\n\t\t      __entry->idx,\n\t\t      __entry->len - 1,\n\t\t      __print_u32_hex(__entry->ahg, __entry->len),\n\t\t      __entry->tidval\n\t\t      )\n);\n\nTRACE_EVENT(hfi1_sdma_state,\n\t    TP_PROTO(struct sdma_engine *sde,\n\t\t     const char *cstate,\n\t\t     const char *nstate\n\t\t     ),\n\t    TP_ARGS(sde, cstate, nstate),\n\t    TP_STRUCT__entry(DD_DEV_ENTRY(sde->dd)\n\t\t__string(curstate, cstate)\n\t\t__string(newstate, nstate)\n\t    ),\n\t    TP_fast_assign(DD_DEV_ASSIGN(sde->dd);\n\t\t__assign_str(curstate, cstate);\n\t\t__assign_str(newstate, nstate);\n\t    ),\n\t    TP_printk(\"[%s] current state %s new state %s\",\n\t\t      __get_str(dev),\n\t\t      __get_str(curstate),\n\t\t      __get_str(newstate)\n\t    )\n);\n\n#define BCT_FORMAT \\\n\t\"shared_limit %x vls 0-7 [%x,%x][%x,%x][%x,%x][%x,%x][%x,%x][%x,%x][%x,%x][%x,%x] 15 [%x,%x]\"\n\n#define BCT(field) \\\n\tbe16_to_cpu( \\\n\t((struct buffer_control *)__get_dynamic_array(bct))->field \\\n\t)\n\nDECLARE_EVENT_CLASS(hfi1_bct_template,\n\t\t    TP_PROTO(struct hfi1_devdata *dd,\n\t\t\t     struct buffer_control *bc),\n\t\t    TP_ARGS(dd, bc),\n\t\t    TP_STRUCT__entry(DD_DEV_ENTRY(dd)\n\t\t    __dynamic_array(u8, bct, sizeof(*bc))\n\t\t    ),\n\t\t    TP_fast_assign(DD_DEV_ASSIGN(dd);\n\t\t\t\t   memcpy(__get_dynamic_array(bct), bc,\n\t\t\t\t\t  sizeof(*bc));\n\t\t    ),\n\t\t    TP_printk(BCT_FORMAT,\n\t\t\t      BCT(overall_shared_limit),\n\n\t\t\t      BCT(vl[0].dedicated),\n\t\t\t      BCT(vl[0].shared),\n\n\t\t\t      BCT(vl[1].dedicated),\n\t\t\t      BCT(vl[1].shared),\n\n\t\t\t      BCT(vl[2].dedicated),\n\t\t\t      BCT(vl[2].shared),\n\n\t\t\t      BCT(vl[3].dedicated),\n\t\t\t      BCT(vl[3].shared),\n\n\t\t\t      BCT(vl[4].dedicated),\n\t\t\t      BCT(vl[4].shared),\n\n\t\t\t      BCT(vl[5].dedicated),\n\t\t\t      BCT(vl[5].shared),\n\n\t\t\t      BCT(vl[6].dedicated),\n\t\t\t      BCT(vl[6].shared),\n\n\t\t\t      BCT(vl[7].dedicated),\n\t\t\t      BCT(vl[7].shared),\n\n\t\t\t      BCT(vl[15].dedicated),\n\t\t\t      BCT(vl[15].shared)\n\t\t    )\n);\n\nDEFINE_EVENT(hfi1_bct_template, bct_set,\n\t     TP_PROTO(struct hfi1_devdata *dd, struct buffer_control *bc),\n\t     TP_ARGS(dd, bc));\n\nDEFINE_EVENT(hfi1_bct_template, bct_get,\n\t     TP_PROTO(struct hfi1_devdata *dd, struct buffer_control *bc),\n\t     TP_ARGS(dd, bc));\n\nTRACE_EVENT(\n\thfi1_qp_send_completion,\n\tTP_PROTO(struct rvt_qp *qp, struct rvt_swqe *wqe, u32 idx),\n\tTP_ARGS(qp, wqe, idx),\n\tTP_STRUCT__entry(\n\t\tDD_DEV_ENTRY(dd_from_ibdev(qp->ibqp.device))\n\t\t__field(struct rvt_swqe *, wqe)\n\t\t__field(u64, wr_id)\n\t\t__field(u32, qpn)\n\t\t__field(u32, qpt)\n\t\t__field(u32, length)\n\t\t__field(u32, idx)\n\t\t__field(u32, ssn)\n\t\t__field(enum ib_wr_opcode, opcode)\n\t\t__field(int, send_flags)\n\t),\n\tTP_fast_assign(\n\t\tDD_DEV_ASSIGN(dd_from_ibdev(qp->ibqp.device));\n\t\t__entry->wqe = wqe;\n\t\t__entry->wr_id = wqe->wr.wr_id;\n\t\t__entry->qpn = qp->ibqp.qp_num;\n\t\t__entry->qpt = qp->ibqp.qp_type;\n\t\t__entry->length = wqe->length;\n\t\t__entry->idx = idx;\n\t\t__entry->ssn = wqe->ssn;\n\t\t__entry->opcode = wqe->wr.opcode;\n\t\t__entry->send_flags = wqe->wr.send_flags;\n\t),\n\tTP_printk(\n\t\t\"[%s] qpn 0x%x qpt %u wqe %p idx %u wr_id %llx length %u ssn %u opcode %x send_flags %x\",\n\t\t__get_str(dev),\n\t\t__entry->qpn,\n\t\t__entry->qpt,\n\t\t__entry->wqe,\n\t\t__entry->idx,\n\t\t__entry->wr_id,\n\t\t__entry->length,\n\t\t__entry->ssn,\n\t\t__entry->opcode,\n\t\t__entry->send_flags\n\t)\n);\n\nDECLARE_EVENT_CLASS(\n\thfi1_do_send_template,\n\tTP_PROTO(struct rvt_qp *qp, bool flag),\n\tTP_ARGS(qp, flag),\n\tTP_STRUCT__entry(\n\t\tDD_DEV_ENTRY(dd_from_ibdev(qp->ibqp.device))\n\t\t__field(u32, qpn)\n\t\t__field(bool, flag)\n\t),\n\tTP_fast_assign(\n\t\tDD_DEV_ASSIGN(dd_from_ibdev(qp->ibqp.device));\n\t\t__entry->qpn = qp->ibqp.qp_num;\n\t\t__entry->flag = flag;\n\t),\n\tTP_printk(\n\t\t\"[%s] qpn %x flag %d\",\n\t\t__get_str(dev),\n\t\t__entry->qpn,\n\t\t__entry->flag\n\t)\n);\n\nDEFINE_EVENT(\n\thfi1_do_send_template, hfi1_rc_do_send,\n\tTP_PROTO(struct rvt_qp *qp, bool flag),\n\tTP_ARGS(qp, flag)\n);\n\nDEFINE_EVENT( \n\thfi1_do_send_template, hfi1_rc_do_tid_send,\n\tTP_PROTO(struct rvt_qp *qp, bool flag),\n\tTP_ARGS(qp, flag)\n);\n\nDEFINE_EVENT(\n\thfi1_do_send_template, hfi1_rc_expired_time_slice,\n\tTP_PROTO(struct rvt_qp *qp, bool flag),\n\tTP_ARGS(qp, flag)\n);\n\nDECLARE_EVENT_CLASS( \n\thfi1_ipoib_txq_template,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq),\n\tTP_STRUCT__entry( \n\t\tDD_DEV_ENTRY(txq->priv->dd)\n\t\t__field(struct hfi1_ipoib_txq *, txq)\n\t\t__field(struct sdma_engine *, sde)\n\t\t__field(ulong, head)\n\t\t__field(ulong, tail)\n\t\t__field(uint, used)\n\t\t__field(uint, flow)\n\t\t__field(int, stops)\n\t\t__field(int, no_desc)\n\t\t__field(u8, idx)\n\t\t__field(u8, stopped)\n\t),\n\tTP_fast_assign( \n\t\tDD_DEV_ASSIGN(txq->priv->dd);\n\t\t__entry->txq = txq;\n\t\t__entry->sde = txq->sde;\n\t\t__entry->head = txq->tx_ring.head;\n\t\t__entry->tail = txq->tx_ring.tail;\n\t\t__entry->idx = txq->q_idx;\n\t\t__entry->used =\n\t\t\ttxq->tx_ring.sent_txreqs -\n\t\t\ttxq->tx_ring.complete_txreqs;\n\t\t__entry->flow = txq->flow.as_int;\n\t\t__entry->stops = atomic_read(&txq->tx_ring.stops);\n\t\t__entry->no_desc = atomic_read(&txq->tx_ring.no_desc);\n\t\t__entry->stopped =\n\t\t __netif_subqueue_stopped(txq->priv->netdev, txq->q_idx);\n\t),\n\tTP_printk( \n\t\t\"[%s] txq %llx idx %u sde %llx:%u cpu %d head %lx tail %lx flow %x used %u stops %d no_desc %d stopped %u\",\n\t\t__get_str(dev),\n\t\t(unsigned long long)__entry->txq,\n\t\t__entry->idx,\n\t\t(unsigned long long)__entry->sde,\n\t\t__entry->sde ? __entry->sde->this_idx : 0,\n\t\t__entry->sde ? __entry->sde->cpu : 0,\n\t\t__entry->head,\n\t\t__entry->tail,\n\t\t__entry->flow,\n\t\t__entry->used,\n\t\t__entry->stops,\n\t\t__entry->no_desc,\n\t\t__entry->stopped\n\t)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_stop,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_wake,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_flow_flush,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_flow_switch,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_wakeup,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_full,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_queued,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_xmit_stopped,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_xmit_unstopped,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDECLARE_EVENT_CLASS( \n\thfi1_ipoib_tx_template,\n\tTP_PROTO(struct ipoib_txreq *tx, u32 idx),\n\tTP_ARGS(tx, idx),\n\tTP_STRUCT__entry( \n\t\tDD_DEV_ENTRY(tx->txq->priv->dd)\n\t\t__field(struct ipoib_txreq *, tx)\n\t\t__field(struct hfi1_ipoib_txq *, txq)\n\t\t__field(struct sk_buff *, skb)\n\t\t__field(ulong, idx)\n\t),\n\tTP_fast_assign( \n\t\tDD_DEV_ASSIGN(tx->txq->priv->dd);\n\t\t__entry->tx = tx;\n\t\t__entry->skb = tx->skb;\n\t\t__entry->txq = tx->txq;\n\t\t__entry->idx = idx;\n\t),\n\tTP_printk( \n\t\t\"[%s] tx %llx txq %llx,%u skb %llx idx %lu\",\n\t\t__get_str(dev),\n\t\t(unsigned long long)__entry->tx,\n\t\t(unsigned long long)__entry->txq,\n\t\t__entry->txq ? __entry->txq->q_idx : 0,\n\t\t(unsigned long long)__entry->skb,\n\t\t__entry->idx\n\t)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_tx_template, hfi1_tx_produce,\n\tTP_PROTO(struct ipoib_txreq *tx, u32 idx),\n\tTP_ARGS(tx, idx)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_tx_template, hfi1_tx_consume,\n\tTP_PROTO(struct ipoib_txreq *tx, u32 idx),\n\tTP_ARGS(tx, idx)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_alloc_tx,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_poll,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\nDEFINE_EVENT( \n\thfi1_ipoib_txq_template, hfi1_txq_complete,\n\tTP_PROTO(struct hfi1_ipoib_txq *txq),\n\tTP_ARGS(txq)\n);\n\n#endif  \n\n#undef TRACE_INCLUDE_PATH\n#undef TRACE_INCLUDE_FILE\n#define TRACE_INCLUDE_PATH .\n#define TRACE_INCLUDE_FILE trace_tx\n#include <trace/define_trace.h>\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}