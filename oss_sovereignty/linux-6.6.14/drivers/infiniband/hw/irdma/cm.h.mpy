{
  "module_name": "cm.h",
  "hash_id": "9fb85336dc5f3bb763fb30afb389d081b8d49ba3ac46afa193b0d3feba60f54b",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/irdma/cm.h",
  "human_readable_source": " \n \n#ifndef IRDMA_CM_H\n#define IRDMA_CM_H\n\n#define IRDMA_MPA_REQUEST_ACCEPT\t1\n#define IRDMA_MPA_REQUEST_REJECT\t2\n\n \n#define IEFT_MPA_KEY_REQ\t\"MPA ID Req Frame\"\n#define IEFT_MPA_KEY_REP\t\"MPA ID Rep Frame\"\n#define IETF_MPA_KEY_SIZE\t16\n#define IETF_MPA_VER\t\t1\n#define IETF_MAX_PRIV_DATA_LEN\t512\n#define IETF_MPA_FRAME_SIZE\t20\n#define IETF_RTR_MSG_SIZE\t4\n#define IETF_MPA_V2_FLAG\t0x10\n#define SNDMARKER_SEQNMASK\t0x000001ff\n#define IRDMA_MAX_IETF_SIZE\t32\n\n \n#define IETF_PEER_TO_PEER\t0x8000\n#define IETF_FLPDU_ZERO_LEN\t0x4000\n#define IETF_RDMA0_WRITE\t0x8000\n#define IETF_RDMA0_READ\t\t0x4000\n#define IETF_NO_IRD_ORD\t\t0x3fff\n\n#define MAX_PORTS\t65536\n\n#define IRDMA_PASSIVE_STATE_INDICATED\t0\n#define IRDMA_DO_NOT_SEND_RESET_EVENT\t1\n#define IRDMA_SEND_RESET_EVENT\t\t2\n\n#define MAX_IRDMA_IFS\t4\n\n#define SET_ACK\t\t1\n#define SET_SYN\t\t2\n#define SET_FIN\t\t4\n#define SET_RST\t\t8\n\n#define TCP_OPTIONS_PADDING\t3\n\n#define IRDMA_DEFAULT_RETRYS\t64\n#define IRDMA_DEFAULT_RETRANS\t32\n#define IRDMA_DEFAULT_TTL\t\t0x40\n#define IRDMA_DEFAULT_RTT_VAR\t\t6\n#define IRDMA_DEFAULT_SS_THRESH\t\t0x3fffffff\n#define IRDMA_DEFAULT_REXMIT_THRESH\t8\n\n#define IRDMA_RETRY_TIMEOUT\tHZ\n#define IRDMA_SHORT_TIME\t10\n#define IRDMA_LONG_TIME\t\t(2 * HZ)\n#define IRDMA_MAX_TIMEOUT\t((unsigned long)(12 * HZ))\n\n#define IRDMA_CM_HASHTABLE_SIZE\t\t1024\n#define IRDMA_CM_TCP_TIMER_INTERVAL\t3000\n#define IRDMA_CM_DEFAULT_MTU\t\t1540\n#define IRDMA_CM_DEFAULT_FRAME_CNT\t10\n#define IRDMA_CM_THREAD_STACK_SIZE\t256\n#define IRDMA_CM_DEFAULT_RCV_WND\t64240\n#define IRDMA_CM_DEFAULT_RCV_WND_SCALED\t0x3FFFC\n#define IRDMA_CM_DEFAULT_RCV_WND_SCALE\t2\n#define IRDMA_CM_DEFAULT_FREE_PKTS\t10\n#define IRDMA_CM_FREE_PKT_LO_WATERMARK\t2\n#define IRDMA_CM_DEFAULT_MSS\t\t536\n#define IRDMA_CM_DEFAULT_MPA_VER\t2\n#define IRDMA_CM_DEFAULT_SEQ\t\t0x159bf75f\n#define IRDMA_CM_DEFAULT_LOCAL_ID\t0x3b47\n#define IRDMA_CM_DEFAULT_SEQ2\t\t0x18ed5740\n#define IRDMA_CM_DEFAULT_LOCAL_ID2\t0xb807\n#define IRDMA_MAX_CM_BUF\t\t(IRDMA_MAX_IETF_SIZE + IETF_MAX_PRIV_DATA_LEN)\n\nenum ietf_mpa_flags {\n\tIETF_MPA_FLAGS_REJECT  = 0x20,\n\tIETF_MPA_FLAGS_CRC     = 0x40,\n\tIETF_MPA_FLAGS_MARKERS = 0x80,\n};\n\nenum irdma_timer_type {\n\tIRDMA_TIMER_TYPE_SEND,\n\tIRDMA_TIMER_TYPE_CLOSE,\n};\n\nenum option_nums {\n\tOPTION_NUM_EOL,\n\tOPTION_NUM_NONE,\n\tOPTION_NUM_MSS,\n\tOPTION_NUM_WINDOW_SCALE,\n\tOPTION_NUM_SACK_PERM,\n\tOPTION_NUM_SACK,\n\tOPTION_NUM_WRITE0 = 0xbc,\n};\n\n \nenum irdma_cm_node_state {\n\tIRDMA_CM_STATE_UNKNOWN,\n\tIRDMA_CM_STATE_INITED,\n\tIRDMA_CM_STATE_LISTENING,\n\tIRDMA_CM_STATE_SYN_RCVD,\n\tIRDMA_CM_STATE_SYN_SENT,\n\tIRDMA_CM_STATE_ONE_SIDE_ESTABLISHED,\n\tIRDMA_CM_STATE_ESTABLISHED,\n\tIRDMA_CM_STATE_ACCEPTING,\n\tIRDMA_CM_STATE_MPAREQ_SENT,\n\tIRDMA_CM_STATE_MPAREQ_RCVD,\n\tIRDMA_CM_STATE_MPAREJ_RCVD,\n\tIRDMA_CM_STATE_OFFLOADED,\n\tIRDMA_CM_STATE_FIN_WAIT1,\n\tIRDMA_CM_STATE_FIN_WAIT2,\n\tIRDMA_CM_STATE_CLOSE_WAIT,\n\tIRDMA_CM_STATE_TIME_WAIT,\n\tIRDMA_CM_STATE_LAST_ACK,\n\tIRDMA_CM_STATE_CLOSING,\n\tIRDMA_CM_STATE_LISTENER_DESTROYED,\n\tIRDMA_CM_STATE_CLOSED,\n};\n\nenum mpa_frame_ver {\n\tIETF_MPA_V1 = 1,\n\tIETF_MPA_V2 = 2,\n};\n\nenum mpa_frame_key {\n\tMPA_KEY_REQUEST,\n\tMPA_KEY_REPLY,\n};\n\nenum send_rdma0 {\n\tSEND_RDMA_READ_ZERO  = 1,\n\tSEND_RDMA_WRITE_ZERO = 2,\n};\n\nenum irdma_tcpip_pkt_type {\n\tIRDMA_PKT_TYPE_UNKNOWN,\n\tIRDMA_PKT_TYPE_SYN,\n\tIRDMA_PKT_TYPE_SYNACK,\n\tIRDMA_PKT_TYPE_ACK,\n\tIRDMA_PKT_TYPE_FIN,\n\tIRDMA_PKT_TYPE_RST,\n};\n\nenum irdma_cm_listener_state {\n\tIRDMA_CM_LISTENER_PASSIVE_STATE = 1,\n\tIRDMA_CM_LISTENER_ACTIVE_STATE  = 2,\n\tIRDMA_CM_LISTENER_EITHER_STATE  = 3,\n};\n\n \nenum irdma_cm_event_type {\n\tIRDMA_CM_EVENT_UNKNOWN,\n\tIRDMA_CM_EVENT_ESTABLISHED,\n\tIRDMA_CM_EVENT_MPA_REQ,\n\tIRDMA_CM_EVENT_MPA_CONNECT,\n\tIRDMA_CM_EVENT_MPA_ACCEPT,\n\tIRDMA_CM_EVENT_MPA_REJECT,\n\tIRDMA_CM_EVENT_MPA_ESTABLISHED,\n\tIRDMA_CM_EVENT_CONNECTED,\n\tIRDMA_CM_EVENT_RESET,\n\tIRDMA_CM_EVENT_ABORTED,\n};\n\nstruct ietf_mpa_v1 {\n\tu8 key[IETF_MPA_KEY_SIZE];\n\tu8 flags;\n\tu8 rev;\n\t__be16 priv_data_len;\n\tu8 priv_data[];\n};\n\nstruct ietf_rtr_msg {\n\t__be16 ctrl_ird;\n\t__be16 ctrl_ord;\n};\n\nstruct ietf_mpa_v2 {\n\tu8 key[IETF_MPA_KEY_SIZE];\n\tu8 flags;\n\tu8 rev;\n\t__be16 priv_data_len;\n\tstruct ietf_rtr_msg rtr_msg;\n\tu8 priv_data[];\n};\n\nstruct option_base {\n\tu8 optionnum;\n\tu8 len;\n};\n\nstruct option_mss {\n\tu8 optionnum;\n\tu8 len;\n\t__be16 mss;\n};\n\nstruct option_windowscale {\n\tu8 optionnum;\n\tu8 len;\n\tu8 shiftcount;\n};\n\nunion all_known_options {\n\tchar eol;\n\tstruct option_base base;\n\tstruct option_mss mss;\n\tstruct option_windowscale windowscale;\n};\n\nstruct irdma_timer_entry {\n\tstruct list_head list;\n\tunsigned long timetosend;  \n\tstruct irdma_puda_buf *sqbuf;\n\tu32 type;\n\tu32 retrycount;\n\tu32 retranscount;\n\tu32 context;\n\tu32 send_retrans;\n\tint close_when_complete;\n};\n\n \nstruct irdma_cm_tcp_context {\n\tu8 client;\n\tu32 loc_seq_num;\n\tu32 loc_ack_num;\n\tu32 rem_ack_num;\n\tu32 rcv_nxt;\n\tu32 loc_id;\n\tu32 rem_id;\n\tu32 snd_wnd;\n\tu32 max_snd_wnd;\n\tu32 rcv_wnd;\n\tu32 mss;\n\tu8 snd_wscale;\n\tu8 rcv_wscale;\n};\n\nstruct irdma_apbvt_entry {\n\tstruct hlist_node hlist;\n\tu32 use_cnt;\n\tu16 port;\n};\n\nstruct irdma_cm_listener {\n\tstruct list_head list;\n\tstruct iw_cm_id *cm_id;\n\tstruct irdma_cm_core *cm_core;\n\tstruct irdma_device *iwdev;\n\tstruct list_head child_listen_list;\n\tstruct irdma_apbvt_entry *apbvt_entry;\n\tenum irdma_cm_listener_state listener_state;\n\trefcount_t refcnt;\n\tatomic_t pend_accepts_cnt;\n\tu32 loc_addr[4];\n\tu32 reused_node;\n\tint backlog;\n\tu16 loc_port;\n\tu16 vlan_id;\n\tu8 loc_mac[ETH_ALEN];\n\tu8 user_pri;\n\tu8 tos;\n\tbool qhash_set:1;\n\tbool ipv4:1;\n};\n\nstruct irdma_kmem_info {\n\tvoid *addr;\n\tu32 size;\n};\n\nstruct irdma_mpa_priv_info {\n\tconst void *addr;\n\tu32 size;\n};\n\nstruct irdma_cm_node {\n\tstruct irdma_qp *iwqp;\n\tstruct irdma_device *iwdev;\n\tstruct irdma_sc_dev *dev;\n\tstruct irdma_cm_tcp_context tcp_cntxt;\n\tstruct irdma_cm_core *cm_core;\n\tstruct irdma_timer_entry *send_entry;\n\tstruct irdma_timer_entry *close_entry;\n\tstruct irdma_cm_listener *listener;\n\tstruct list_head timer_entry;\n\tstruct list_head reset_entry;\n\tstruct list_head teardown_entry;\n\tstruct irdma_apbvt_entry *apbvt_entry;\n\tstruct rcu_head rcu_head;\n\tstruct irdma_mpa_priv_info pdata;\n\tstruct irdma_sc_ah *ah;\n\tunion {\n\t\tstruct ietf_mpa_v1 mpa_frame;\n\t\tstruct ietf_mpa_v2 mpa_v2_frame;\n\t};\n\tstruct irdma_kmem_info mpa_hdr;\n\tstruct iw_cm_id *cm_id;\n\tstruct hlist_node list;\n\tstruct completion establish_comp;\n\tspinlock_t retrans_list_lock;  \n\tatomic_t passive_state;\n\trefcount_t refcnt;\n\tenum irdma_cm_node_state state;\n\tenum send_rdma0 send_rdma0_op;\n\tenum mpa_frame_ver mpa_frame_rev;\n\tu32 loc_addr[4], rem_addr[4];\n\tu16 loc_port, rem_port;\n\tint apbvt_set;\n\tint accept_pend;\n\tu16 vlan_id;\n\tu16 ird_size;\n\tu16 ord_size;\n\tu16 mpav2_ird_ord;\n\tu16 lsmm_size;\n\tu8 pdata_buf[IETF_MAX_PRIV_DATA_LEN];\n\tu8 loc_mac[ETH_ALEN];\n\tu8 rem_mac[ETH_ALEN];\n\tu8 user_pri;\n\tu8 tos;\n\tbool ack_rcvd:1;\n\tbool qhash_set:1;\n\tbool ipv4:1;\n\tbool snd_mark_en:1;\n\tbool rcv_mark_en:1;\n\tbool do_lpb:1;\n\tbool accelerated:1;\n};\n\n \nstruct irdma_cm_info {\n\tstruct iw_cm_id *cm_id;\n\tu16 loc_port;\n\tu16 rem_port;\n\tu32 loc_addr[4];\n\tu32 rem_addr[4];\n\tu32 qh_qpid;\n\tu16 vlan_id;\n\tint backlog;\n\tu8 user_pri;\n\tu8 tos;\n\tbool ipv4;\n};\n\nstruct irdma_cm_event {\n\tenum irdma_cm_event_type type;\n\tstruct irdma_cm_info cm_info;\n\tstruct work_struct event_work;\n\tstruct irdma_cm_node *cm_node;\n};\n\nstruct irdma_cm_core {\n\tstruct irdma_device *iwdev;\n\tstruct irdma_sc_dev *dev;\n\tstruct list_head listen_list;\n\tDECLARE_HASHTABLE(cm_hash_tbl, 8);\n\tDECLARE_HASHTABLE(apbvt_hash_tbl, 8);\n\tstruct timer_list tcp_timer;\n\tstruct workqueue_struct *event_wq;\n\tspinlock_t ht_lock;  \n\tspinlock_t listen_list_lock;  \n\tspinlock_t apbvt_lock;  \n\tu64 stats_nodes_created;\n\tu64 stats_nodes_destroyed;\n\tu64 stats_listen_created;\n\tu64 stats_listen_destroyed;\n\tu64 stats_listen_nodes_created;\n\tu64 stats_listen_nodes_destroyed;\n\tu64 stats_lpbs;\n\tu64 stats_accepts;\n\tu64 stats_rejects;\n\tu64 stats_connect_errs;\n\tu64 stats_passive_errs;\n\tu64 stats_pkt_retrans;\n\tu64 stats_backlog_drops;\n\tstruct irdma_puda_buf *(*form_cm_frame)(struct irdma_cm_node *cm_node,\n\t\t\t\t\t\tstruct irdma_kmem_info *options,\n\t\t\t\t\t\tstruct irdma_kmem_info *hdr,\n\t\t\t\t\t\tstruct irdma_mpa_priv_info *pdata,\n\t\t\t\t\t\tu8 flags);\n\tint (*cm_create_ah)(struct irdma_cm_node *cm_node, bool wait);\n\tvoid (*cm_free_ah)(struct irdma_cm_node *cm_node);\n};\n\nint irdma_schedule_cm_timer(struct irdma_cm_node *cm_node,\n\t\t\t    struct irdma_puda_buf *sqbuf,\n\t\t\t    enum irdma_timer_type type, int send_retrans,\n\t\t\t    int close_when_complete);\n\nstatic inline u8 irdma_tos2dscp(u8 tos)\n{\n#define IRDMA_DSCP_VAL GENMASK(7, 2)\n\treturn (u8)FIELD_GET(IRDMA_DSCP_VAL, tos);\n}\n\nint irdma_accept(struct iw_cm_id *cm_id, struct iw_cm_conn_param *conn_param);\nint irdma_reject(struct iw_cm_id *cm_id, const void *pdata, u8 pdata_len);\nint irdma_connect(struct iw_cm_id *cm_id, struct iw_cm_conn_param *conn_param);\nint irdma_create_listen(struct iw_cm_id *cm_id, int backlog);\nint irdma_destroy_listen(struct iw_cm_id *cm_id);\nint irdma_add_arp(struct irdma_pci_f *rf, u32 *ip, bool ipv4, const u8 *mac);\nvoid irdma_cm_teardown_connections(struct irdma_device *iwdev, u32 *ipaddr,\n\t\t\t\t   struct irdma_cm_info *nfo,\n\t\t\t\t   bool disconnect_all);\nint irdma_cm_start(struct irdma_device *dev);\nint irdma_cm_stop(struct irdma_device *dev);\nbool irdma_ipv4_is_lpb(u32 loc_addr, u32 rem_addr);\nbool irdma_ipv6_is_lpb(u32 *loc_addr, u32 *rem_addr);\nint irdma_arp_table(struct irdma_pci_f *rf, u32 *ip_addr, bool ipv4,\n\t\t    const u8 *mac_addr, u32 action);\nvoid irdma_if_notify(struct irdma_device *iwdev, struct net_device *netdev,\n\t\t     u32 *ipaddr, bool ipv4, bool ifup);\nbool irdma_port_in_use(struct irdma_cm_core *cm_core, u16 port);\nvoid irdma_send_ack(struct irdma_cm_node *cm_node);\nvoid irdma_lpb_nop(struct irdma_sc_qp *qp);\nvoid irdma_rem_ref_cm_node(struct irdma_cm_node *cm_node);\nvoid irdma_add_conn_est_qh(struct irdma_cm_node *cm_node);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}