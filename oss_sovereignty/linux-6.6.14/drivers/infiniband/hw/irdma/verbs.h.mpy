{
  "module_name": "verbs.h",
  "hash_id": "c1b68aa8cc3041534ee75fd006c4da51fcf0bc3595351c56efa95a1d181498fa",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/irdma/verbs.h",
  "human_readable_source": " \n \n#ifndef IRDMA_VERBS_H\n#define IRDMA_VERBS_H\n\n#define IRDMA_MAX_SAVED_PHY_PGADDR\t4\n#define IRDMA_FLUSH_DELAY_MS\t\t20\n\n#define IRDMA_PKEY_TBL_SZ\t\t1\n#define IRDMA_DEFAULT_PKEY\t\t0xFFFF\n\nstruct irdma_ucontext {\n\tstruct ib_ucontext ibucontext;\n\tstruct irdma_device *iwdev;\n\tstruct rdma_user_mmap_entry *db_mmap_entry;\n\tstruct list_head cq_reg_mem_list;\n\tspinlock_t cq_reg_mem_list_lock;  \n\tstruct list_head qp_reg_mem_list;\n\tspinlock_t qp_reg_mem_list_lock;  \n\tint abi_ver;\n\tu8 legacy_mode : 1;\n\tu8 use_raw_attrs : 1;\n};\n\nstruct irdma_pd {\n\tstruct ib_pd ibpd;\n\tstruct irdma_sc_pd sc_pd;\n};\n\nunion irdma_sockaddr {\n\tstruct sockaddr_in saddr_in;\n\tstruct sockaddr_in6 saddr_in6;\n};\n\nstruct irdma_av {\n\tu8 macaddr[16];\n\tstruct rdma_ah_attr attrs;\n\tunion irdma_sockaddr sgid_addr;\n\tunion irdma_sockaddr dgid_addr;\n\tu8 net_type;\n};\n\nstruct irdma_ah {\n\tstruct ib_ah ibah;\n\tstruct irdma_sc_ah sc_ah;\n\tstruct irdma_pd *pd;\n\tstruct irdma_av av;\n\tu8 sgid_index;\n\tunion ib_gid dgid;\n\tstruct hlist_node list;\n\trefcount_t refcnt;\n\tstruct irdma_ah *parent_ah;  \n};\n\nstruct irdma_hmc_pble {\n\tunion {\n\t\tu32 idx;\n\t\tdma_addr_t addr;\n\t};\n};\n\nstruct irdma_cq_mr {\n\tstruct irdma_hmc_pble cq_pbl;\n\tdma_addr_t shadow;\n\tbool split;\n};\n\nstruct irdma_qp_mr {\n\tstruct irdma_hmc_pble sq_pbl;\n\tstruct irdma_hmc_pble rq_pbl;\n\tdma_addr_t shadow;\n\tstruct page *sq_page;\n};\n\nstruct irdma_cq_buf {\n\tstruct irdma_dma_mem kmem_buf;\n\tstruct irdma_cq_uk cq_uk;\n\tstruct irdma_hw *hw;\n\tstruct list_head list;\n\tstruct work_struct work;\n};\n\nstruct irdma_pbl {\n\tstruct list_head list;\n\tunion {\n\t\tstruct irdma_qp_mr qp_mr;\n\t\tstruct irdma_cq_mr cq_mr;\n\t};\n\n\tbool pbl_allocated:1;\n\tbool on_list:1;\n\tu64 user_base;\n\tstruct irdma_pble_alloc pble_alloc;\n\tstruct irdma_mr *iwmr;\n};\n\nstruct irdma_mr {\n\tunion {\n\t\tstruct ib_mr ibmr;\n\t\tstruct ib_mw ibmw;\n\t};\n\tstruct ib_umem *region;\n\tu16 type;\n\tu32 page_cnt;\n\tu64 page_size;\n\tu32 npages;\n\tu32 stag;\n\tu64 len;\n\tu64 pgaddrmem[IRDMA_MAX_SAVED_PHY_PGADDR];\n\tstruct irdma_pbl iwpbl;\n};\n\nstruct irdma_cq {\n\tstruct ib_cq ibcq;\n\tstruct irdma_sc_cq sc_cq;\n\tu16 cq_head;\n\tu16 cq_size;\n\tu16 cq_num;\n\tbool user_mode;\n\tatomic_t armed;\n\tenum irdma_cmpl_notify last_notify;\n\tu32 polled_cmpls;\n\tu32 cq_mem_size;\n\tstruct irdma_dma_mem kmem;\n\tstruct irdma_dma_mem kmem_shadow;\n\tstruct completion free_cq;\n\trefcount_t refcnt;\n\tspinlock_t lock;  \n\tstruct irdma_pbl *iwpbl;\n\tstruct irdma_pbl *iwpbl_shadow;\n\tstruct list_head resize_list;\n\tstruct irdma_cq_poll_info cur_cqe;\n\tstruct list_head cmpl_generated;\n};\n\nstruct irdma_cmpl_gen {\n\tstruct list_head list;\n\tstruct irdma_cq_poll_info cpi;\n};\n\nstruct disconn_work {\n\tstruct work_struct work;\n\tstruct irdma_qp *iwqp;\n};\n\nstruct iw_cm_id;\n\nstruct irdma_qp_kmode {\n\tstruct irdma_dma_mem dma_mem;\n\tstruct irdma_sq_uk_wr_trk_info *sq_wrid_mem;\n\tu64 *rq_wrid_mem;\n};\n\nstruct irdma_qp {\n\tstruct ib_qp ibqp;\n\tstruct irdma_sc_qp sc_qp;\n\tstruct irdma_device *iwdev;\n\tstruct irdma_cq *iwscq;\n\tstruct irdma_cq *iwrcq;\n\tstruct irdma_pd *iwpd;\n\tstruct rdma_user_mmap_entry *push_wqe_mmap_entry;\n\tstruct rdma_user_mmap_entry *push_db_mmap_entry;\n\tstruct irdma_qp_host_ctx_info ctx_info;\n\tunion {\n\t\tstruct irdma_iwarp_offload_info iwarp_info;\n\t\tstruct irdma_roce_offload_info roce_info;\n\t};\n\n\tunion {\n\t\tstruct irdma_tcp_offload_info tcp_info;\n\t\tstruct irdma_udp_offload_info udp_info;\n\t};\n\n\tstruct irdma_ah roce_ah;\n\tstruct list_head teardown_entry;\n\trefcount_t refcnt;\n\tstruct iw_cm_id *cm_id;\n\tstruct irdma_cm_node *cm_node;\n\tstruct delayed_work dwork_flush;\n\tstruct ib_mr *lsmm_mr;\n\tatomic_t hw_mod_qp_pend;\n\tenum ib_qp_state ibqp_state;\n\tu32 qp_mem_size;\n\tu32 last_aeq;\n\tint max_send_wr;\n\tint max_recv_wr;\n\tatomic_t close_timer_started;\n\tspinlock_t lock;  \n\tstruct irdma_qp_context *iwqp_context;\n\tvoid *pbl_vbase;\n\tdma_addr_t pbl_pbase;\n\tstruct page *page;\n\tu8 active_conn : 1;\n\tu8 user_mode : 1;\n\tu8 hte_added : 1;\n\tu8 flush_issued : 1;\n\tu8 sig_all : 1;\n\tu8 pau_mode : 1;\n\tu8 suspend_pending : 1;\n\tu8 rsvd : 1;\n\tu8 iwarp_state;\n\tu16 term_sq_flush_code;\n\tu16 term_rq_flush_code;\n\tu8 hw_iwarp_state;\n\tu8 hw_tcp_state;\n\tstruct irdma_qp_kmode kqp;\n\tstruct irdma_dma_mem host_ctx;\n\tstruct timer_list terminate_timer;\n\tstruct irdma_pbl *iwpbl;\n\tstruct irdma_dma_mem q2_ctx_mem;\n\tstruct irdma_dma_mem ietf_mem;\n\tstruct completion free_qp;\n\twait_queue_head_t waitq;\n\twait_queue_head_t mod_qp_waitq;\n\tu8 rts_ae_rcvd;\n};\n\nenum irdma_mmap_flag {\n\tIRDMA_MMAP_IO_NC,\n\tIRDMA_MMAP_IO_WC,\n};\n\nstruct irdma_user_mmap_entry {\n\tstruct rdma_user_mmap_entry rdma_entry;\n\tu64 bar_offset;\n\tu8 mmap_flag;\n};\n\nstatic inline u16 irdma_fw_major_ver(struct irdma_sc_dev *dev)\n{\n\treturn (u16)FIELD_GET(IRDMA_FW_VER_MAJOR, dev->feature_info[IRDMA_FEATURE_FW_INFO]);\n}\n\nstatic inline u16 irdma_fw_minor_ver(struct irdma_sc_dev *dev)\n{\n\treturn (u16)FIELD_GET(IRDMA_FW_VER_MINOR, dev->feature_info[IRDMA_FEATURE_FW_INFO]);\n}\n\nstatic inline void set_ib_wc_op_sq(struct irdma_cq_poll_info *cq_poll_info,\n\t\t\t\t   struct ib_wc *entry)\n{\n\tswitch (cq_poll_info->op_type) {\n\tcase IRDMA_OP_TYPE_RDMA_WRITE:\n\tcase IRDMA_OP_TYPE_RDMA_WRITE_SOL:\n\t\tentry->opcode = IB_WC_RDMA_WRITE;\n\t\tbreak;\n\tcase IRDMA_OP_TYPE_RDMA_READ_INV_STAG:\n\tcase IRDMA_OP_TYPE_RDMA_READ:\n\t\tentry->opcode = IB_WC_RDMA_READ;\n\t\tbreak;\n\tcase IRDMA_OP_TYPE_SEND_SOL:\n\tcase IRDMA_OP_TYPE_SEND_SOL_INV:\n\tcase IRDMA_OP_TYPE_SEND_INV:\n\tcase IRDMA_OP_TYPE_SEND:\n\t\tentry->opcode = IB_WC_SEND;\n\t\tbreak;\n\tcase IRDMA_OP_TYPE_FAST_REG_NSMR:\n\t\tentry->opcode = IB_WC_REG_MR;\n\t\tbreak;\n\tcase IRDMA_OP_TYPE_INV_STAG:\n\t\tentry->opcode = IB_WC_LOCAL_INV;\n\t\tbreak;\n\tdefault:\n\t\tentry->status = IB_WC_GENERAL_ERR;\n\t}\n}\n\nstatic inline void set_ib_wc_op_rq(struct irdma_cq_poll_info *cq_poll_info,\n\t\t\t\t   struct ib_wc *entry, bool send_imm_support)\n{\n\t \n\tif (!send_imm_support) {\n\t\tentry->opcode = cq_poll_info->imm_valid ?\n\t\t\t\t\tIB_WC_RECV_RDMA_WITH_IMM :\n\t\t\t\t\tIB_WC_RECV;\n\t\treturn;\n\t}\n\n\tswitch (cq_poll_info->op_type) {\n\tcase IB_OPCODE_RDMA_WRITE_ONLY_WITH_IMMEDIATE:\n\tcase IB_OPCODE_RDMA_WRITE_LAST_WITH_IMMEDIATE:\n\t\tentry->opcode = IB_WC_RECV_RDMA_WITH_IMM;\n\t\tbreak;\n\tdefault:\n\t\tentry->opcode = IB_WC_RECV;\n\t}\n}\n\nvoid irdma_mcast_mac(u32 *ip_addr, u8 *mac, bool ipv4);\nint irdma_ib_register_device(struct irdma_device *iwdev);\nvoid irdma_ib_unregister_device(struct irdma_device *iwdev);\nvoid irdma_ib_dealloc_device(struct ib_device *ibdev);\nvoid irdma_ib_qp_event(struct irdma_qp *iwqp, enum irdma_qp_event_type event);\nvoid irdma_generate_flush_completions(struct irdma_qp *iwqp);\nvoid irdma_remove_cmpls_list(struct irdma_cq *iwcq);\nint irdma_generated_cmpls(struct irdma_cq *iwcq, struct irdma_cq_poll_info *cq_poll_info);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}