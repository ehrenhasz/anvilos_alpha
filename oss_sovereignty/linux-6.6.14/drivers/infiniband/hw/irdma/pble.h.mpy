{
  "module_name": "pble.h",
  "hash_id": "2716657219100d632b878b158101381e6fdefb01ccd67a823c3166e62b44c8a3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/irdma/pble.h",
  "human_readable_source": " \n \n#ifndef IRDMA_PBLE_H\n#define IRDMA_PBLE_H\n\n#define PBLE_SHIFT\t\t6\n#define PBLE_PER_PAGE\t\t512\n#define HMC_PAGED_BP_SHIFT\t12\n#define PBLE_512_SHIFT\t\t9\n#define PBLE_INVALID_IDX\t0xffffffff\n\nenum irdma_pble_level {\n\tPBLE_LEVEL_0 = 0,\n\tPBLE_LEVEL_1 = 1,\n\tPBLE_LEVEL_2 = 2,\n};\n\nenum irdma_alloc_type {\n\tPBLE_NO_ALLOC\t  = 0,\n\tPBLE_SD_CONTIGOUS = 1,\n\tPBLE_SD_PAGED\t  = 2,\n};\n\nstruct irdma_chunk;\n\nstruct irdma_pble_chunkinfo {\n\tstruct irdma_chunk *pchunk;\n\tu64 bit_idx;\n\tu64 bits_used;\n};\n\nstruct irdma_pble_info {\n\tu64 *addr;\n\tu32 idx;\n\tu32 cnt;\n\tstruct irdma_pble_chunkinfo chunkinfo;\n};\n\nstruct irdma_pble_level2 {\n\tstruct irdma_pble_info root;\n\tstruct irdma_pble_info *leaf;\n\tstruct irdma_virt_mem leafmem;\n\tu32 leaf_cnt;\n};\n\nstruct irdma_pble_alloc {\n\tu32 total_cnt;\n\tenum irdma_pble_level level;\n\tunion {\n\t\tstruct irdma_pble_info level1;\n\t\tstruct irdma_pble_level2 level2;\n\t};\n};\n\nstruct sd_pd_idx {\n\tu32 sd_idx;\n\tu32 pd_idx;\n\tu32 rel_pd_idx;\n};\n\nstruct irdma_add_page_info {\n\tstruct irdma_chunk *chunk;\n\tstruct irdma_hmc_sd_entry *sd_entry;\n\tstruct irdma_hmc_info *hmc_info;\n\tstruct sd_pd_idx idx;\n\tu32 pages;\n};\n\nstruct irdma_chunk {\n\tstruct list_head list;\n\tstruct irdma_dma_info dmainfo;\n\tunsigned long *bitmapbuf;\n\n\tu32 sizeofbitmap;\n\tu64 size;\n\tvoid *vaddr;\n\tu64 fpm_addr;\n\tu32 pg_cnt;\n\tenum irdma_alloc_type type;\n\tstruct irdma_sc_dev *dev;\n\tstruct irdma_virt_mem chunkmem;\n};\n\nstruct irdma_pble_prm {\n\tstruct list_head clist;\n\tspinlock_t prm_lock;  \n\tu64 total_pble_alloc;\n\tu64 free_pble_cnt;\n\tu8 pble_shift;\n};\n\nstruct irdma_hmc_pble_rsrc {\n\tu32 unallocated_pble;\n\tstruct mutex pble_mutex_lock;  \n\tstruct irdma_sc_dev *dev;\n\tu64 fpm_base_addr;\n\tu64 next_fpm_addr;\n\tstruct irdma_pble_prm pinfo;\n\tu64 allocdpbles;\n\tu64 freedpbles;\n\tu32 stats_direct_sds;\n\tu32 stats_paged_sds;\n\tu64 stats_alloc_ok;\n\tu64 stats_alloc_fail;\n\tu64 stats_alloc_freed;\n\tu64 stats_lvl1;\n\tu64 stats_lvl2;\n};\n\nvoid irdma_destroy_pble_prm(struct irdma_hmc_pble_rsrc *pble_rsrc);\nint irdma_hmc_init_pble(struct irdma_sc_dev *dev,\n\t\t\tstruct irdma_hmc_pble_rsrc *pble_rsrc);\nvoid irdma_free_pble(struct irdma_hmc_pble_rsrc *pble_rsrc,\n\t\t     struct irdma_pble_alloc *palloc);\nint irdma_get_pble(struct irdma_hmc_pble_rsrc *pble_rsrc,\n\t\t   struct irdma_pble_alloc *palloc, u32 pble_cnt,\n\t\t   u8 lvl);\nint irdma_prm_add_pble_mem(struct irdma_pble_prm *pprm,\n\t\t\t   struct irdma_chunk *pchunk);\nint irdma_prm_get_pbles(struct irdma_pble_prm *pprm,\n\t\t\tstruct irdma_pble_chunkinfo *chunkinfo, u64 mem_size,\n\t\t\tu64 **vaddr, u64 *fpm_addr);\nvoid irdma_prm_return_pbles(struct irdma_pble_prm *pprm,\n\t\t\t    struct irdma_pble_chunkinfo *chunkinfo);\nvoid irdma_pble_acquire_lock(struct irdma_hmc_pble_rsrc *pble_rsrc,\n\t\t\t     unsigned long *flags);\nvoid irdma_pble_release_lock(struct irdma_hmc_pble_rsrc *pble_rsrc,\n\t\t\t     unsigned long *flags);\nvoid irdma_pble_free_paged_mem(struct irdma_chunk *chunk);\nint irdma_pble_get_paged_mem(struct irdma_chunk *chunk, u32 pg_cnt);\nvoid irdma_prm_rem_bitmapmem(struct irdma_hw *hw, struct irdma_chunk *chunk);\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}