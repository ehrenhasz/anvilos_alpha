{
  "module_name": "umr.h",
  "hash_id": "b32a11cb77c2d5f393106529995938026048ed9d25d02462b3fe3e9025a13a64",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/mlx5/umr.h",
  "human_readable_source": " \n \n\n#ifndef _MLX5_IB_UMR_H\n#define _MLX5_IB_UMR_H\n\n#include \"mlx5_ib.h\"\n\n\n#define MLX5_MAX_UMR_SHIFT 16\n#define MLX5_MAX_UMR_PAGES (1 << MLX5_MAX_UMR_SHIFT)\n\n#define MLX5_IB_UMR_OCTOWORD\t       16\n#define MLX5_IB_UMR_XLT_ALIGNMENT      64\n\nint mlx5r_umr_resource_init(struct mlx5_ib_dev *dev);\nvoid mlx5r_umr_resource_cleanup(struct mlx5_ib_dev *dev);\n\nstatic inline bool mlx5r_umr_can_load_pas(struct mlx5_ib_dev *dev,\n\t\t\t\t\t  size_t length)\n{\n\t \n\tif (MLX5_CAP_GEN(dev->mdev, umr_modify_entity_size_disabled))\n\t\treturn false;\n\n\t \n\tif (!MLX5_CAP_GEN(dev->mdev, umr_extended_translation_offset) &&\n\t    length >= MLX5_MAX_UMR_PAGES * PAGE_SIZE)\n\t\treturn false;\n\treturn true;\n}\n\n \nstatic inline bool mlx5r_umr_can_reconfig(struct mlx5_ib_dev *dev,\n\t\t\t\t\t  unsigned int current_access_flags,\n\t\t\t\t\t  unsigned int target_access_flags)\n{\n\tunsigned int diffs = current_access_flags ^ target_access_flags;\n\n\tif ((diffs & IB_ACCESS_REMOTE_ATOMIC) &&\n\t    MLX5_CAP_GEN(dev->mdev, atomic) &&\n\t    MLX5_CAP_GEN(dev->mdev, umr_modify_atomic_disabled))\n\t\treturn false;\n\n\tif ((diffs & IB_ACCESS_RELAXED_ORDERING) &&\n\t    MLX5_CAP_GEN(dev->mdev, relaxed_ordering_write) &&\n\t    !MLX5_CAP_GEN(dev->mdev, relaxed_ordering_write_umr))\n\t\treturn false;\n\n\tif ((diffs & IB_ACCESS_RELAXED_ORDERING) &&\n\t    (MLX5_CAP_GEN(dev->mdev, relaxed_ordering_read) ||\n\t     MLX5_CAP_GEN(dev->mdev, relaxed_ordering_read_pci_enabled)) &&\n\t    !MLX5_CAP_GEN(dev->mdev, relaxed_ordering_read_umr))\n\t\treturn false;\n\n\treturn true;\n}\n\nstatic inline u64 mlx5r_umr_get_xlt_octo(u64 bytes)\n{\n\treturn ALIGN(bytes, MLX5_IB_UMR_XLT_ALIGNMENT) /\n\t       MLX5_IB_UMR_OCTOWORD;\n}\n\nstruct mlx5r_umr_context {\n\tstruct ib_cqe cqe;\n\tenum ib_wc_status status;\n\tstruct completion done;\n};\n\nstruct mlx5r_umr_wqe {\n\tstruct mlx5_wqe_umr_ctrl_seg ctrl_seg;\n\tstruct mlx5_mkey_seg mkey_seg;\n\tstruct mlx5_wqe_data_seg data_seg;\n};\n\nint mlx5r_umr_revoke_mr(struct mlx5_ib_mr *mr);\nint mlx5r_umr_rereg_pd_access(struct mlx5_ib_mr *mr, struct ib_pd *pd,\n\t\t\t      int access_flags);\nint mlx5r_umr_update_mr_pas(struct mlx5_ib_mr *mr, unsigned int flags);\nint mlx5r_umr_update_xlt(struct mlx5_ib_mr *mr, u64 idx, int npages,\n\t\t\t int page_shift, int flags);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}