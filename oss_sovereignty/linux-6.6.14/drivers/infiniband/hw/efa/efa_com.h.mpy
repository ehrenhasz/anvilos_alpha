{
  "module_name": "efa_com.h",
  "hash_id": "73705aa2a3cae7dadb584e1c43965b2c28fe1bb86d9eb74c38bfdb20d90dfbbc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/efa/efa_com.h",
  "human_readable_source": " \n \n\n#ifndef _EFA_COM_H_\n#define _EFA_COM_H_\n\n#include <linux/delay.h>\n#include <linux/device.h>\n#include <linux/dma-mapping.h>\n#include <linux/semaphore.h>\n#include <linux/sched.h>\n\n#include <rdma/ib_verbs.h>\n\n#include \"efa_common_defs.h\"\n#include \"efa_admin_defs.h\"\n#include \"efa_admin_cmds_defs.h\"\n#include \"efa_regs_defs.h\"\n\n#define EFA_MAX_HANDLERS 256\n\nstruct efa_com_admin_cq {\n\tstruct efa_admin_acq_entry *entries;\n\tdma_addr_t dma_addr;\n\tspinlock_t lock;  \n\n\tu16 cc;  \n\tu8 phase;\n};\n\nstruct efa_com_admin_sq {\n\tstruct efa_admin_aq_entry *entries;\n\tdma_addr_t dma_addr;\n\tspinlock_t lock;  \n\n\tu32 __iomem *db_addr;\n\n\tu16 cc;  \n\tu16 pc;  \n\tu8 phase;\n\n};\n\n \nstruct efa_com_stats_admin {\n\tatomic64_t submitted_cmd;\n\tatomic64_t completed_cmd;\n\tatomic64_t cmd_err;\n\tatomic64_t no_completion;\n};\n\nenum {\n\tEFA_AQ_STATE_RUNNING_BIT = 0,\n\tEFA_AQ_STATE_POLLING_BIT = 1,\n};\n\nstruct efa_com_admin_queue {\n\tvoid *dmadev;\n\tvoid *efa_dev;\n\tstruct efa_comp_ctx *comp_ctx;\n\tu32 completion_timeout;  \n\tu16 poll_interval;  \n\tu16 depth;\n\tstruct efa_com_admin_cq cq;\n\tstruct efa_com_admin_sq sq;\n\tu16 msix_vector_idx;\n\n\tunsigned long state;\n\n\t \n\tstruct semaphore avail_cmds;\n\n\tstruct efa_com_stats_admin stats;\n\n\tspinlock_t comp_ctx_lock;  \n\tu32 *comp_ctx_pool;\n\tu16 comp_ctx_pool_next;\n};\n\nstruct efa_aenq_handlers;\nstruct efa_com_eq;\ntypedef void (*efa_eqe_handler)(struct efa_com_eq *eeq,\n\t\t\t\tstruct efa_admin_eqe *eqe);\n\nstruct efa_com_aenq {\n\tstruct efa_admin_aenq_entry *entries;\n\tstruct efa_aenq_handlers *aenq_handlers;\n\tdma_addr_t dma_addr;\n\tu32 cc;  \n\tu16 msix_vector_idx;\n\tu16 depth;\n\tu8 phase;\n};\n\nstruct efa_com_mmio_read {\n\tstruct efa_admin_mmio_req_read_less_resp *read_resp;\n\tdma_addr_t read_resp_dma_addr;\n\tu16 seq_num;\n\tu16 mmio_read_timeout;  \n\t \n\tspinlock_t lock;\n};\n\nstruct efa_com_dev {\n\tstruct efa_com_admin_queue aq;\n\tstruct efa_com_aenq aenq;\n\tu8 __iomem *reg_bar;\n\tvoid *dmadev;\n\tvoid *efa_dev;\n\tu32 supported_features;\n\tu32 dma_addr_bits;\n\n\tstruct efa_com_mmio_read mmio_read;\n};\n\nstruct efa_com_eq {\n\tstruct efa_com_dev *edev;\n\tstruct efa_admin_eqe *eqes;\n\tdma_addr_t dma_addr;\n\tu32 cc;  \n\tu16 eqn;\n\tu16 depth;\n\tu8 phase;\n\tefa_eqe_handler cb;\n};\n\nstruct efa_com_create_eq_params {\n\tdma_addr_t dma_addr;\n\tu32 event_bitmask;\n\tu16 depth;\n\tu8 entry_size_in_bytes;\n\tu8 msix_vec;\n};\n\nstruct efa_com_create_eq_result {\n\tu16 eqn;\n};\n\nstruct efa_com_destroy_eq_params {\n\tu16 eqn;\n};\n\ntypedef void (*efa_aenq_handler)(void *data,\n\t      struct efa_admin_aenq_entry *aenq_e);\n\n \nstruct efa_aenq_handlers {\n\tefa_aenq_handler handlers[EFA_MAX_HANDLERS];\n\tefa_aenq_handler unimplemented_handler;\n};\n\nvoid efa_com_set_dma_addr(dma_addr_t addr, u32 *addr_high, u32 *addr_low);\nint efa_com_admin_init(struct efa_com_dev *edev,\n\t\t       struct efa_aenq_handlers *aenq_handlers);\nvoid efa_com_admin_destroy(struct efa_com_dev *edev);\nint efa_com_eq_init(struct efa_com_dev *edev, struct efa_com_eq *eeq,\n\t\t    efa_eqe_handler cb, u16 depth, u8 msix_vec);\nvoid efa_com_eq_destroy(struct efa_com_dev *edev, struct efa_com_eq *eeq);\nint efa_com_dev_reset(struct efa_com_dev *edev,\n\t\t      enum efa_regs_reset_reason_types reset_reason);\nvoid efa_com_set_admin_polling_mode(struct efa_com_dev *edev, bool polling);\nvoid efa_com_admin_q_comp_intr_handler(struct efa_com_dev *edev);\nint efa_com_mmio_reg_read_init(struct efa_com_dev *edev);\nvoid efa_com_mmio_reg_read_destroy(struct efa_com_dev *edev);\n\nint efa_com_validate_version(struct efa_com_dev *edev);\nint efa_com_get_dma_width(struct efa_com_dev *edev);\n\nint efa_com_cmd_exec(struct efa_com_admin_queue *aq,\n\t\t     struct efa_admin_aq_entry *cmd,\n\t\t     size_t cmd_size,\n\t\t     struct efa_admin_acq_entry *comp,\n\t\t     size_t comp_size);\nvoid efa_com_aenq_intr_handler(struct efa_com_dev *edev, void *data);\nvoid efa_com_eq_comp_intr_handler(struct efa_com_dev *edev,\n\t\t\t\t  struct efa_com_eq *eeq);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}