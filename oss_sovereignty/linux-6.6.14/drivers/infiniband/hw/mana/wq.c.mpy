{
  "module_name": "wq.c",
  "hash_id": "96827e8d6c4f6740908eb14e20e2c51c65ac26caeb0154a8bba4b9042339ef77",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/mana/wq.c",
  "human_readable_source": "\n \n\n#include \"mana_ib.h\"\n\nstruct ib_wq *mana_ib_create_wq(struct ib_pd *pd,\n\t\t\t\tstruct ib_wq_init_attr *init_attr,\n\t\t\t\tstruct ib_udata *udata)\n{\n\tstruct mana_ib_dev *mdev =\n\t\tcontainer_of(pd->device, struct mana_ib_dev, ib_dev);\n\tstruct mana_ib_create_wq ucmd = {};\n\tstruct mana_ib_wq *wq;\n\tstruct ib_umem *umem;\n\tint err;\n\n\tif (udata->inlen < sizeof(ucmd))\n\t\treturn ERR_PTR(-EINVAL);\n\n\terr = ib_copy_from_udata(&ucmd, udata, min(sizeof(ucmd), udata->inlen));\n\tif (err) {\n\t\tibdev_dbg(&mdev->ib_dev,\n\t\t\t  \"Failed to copy from udata for create wq, %d\\n\", err);\n\t\treturn ERR_PTR(err);\n\t}\n\n\twq = kzalloc(sizeof(*wq), GFP_KERNEL);\n\tif (!wq)\n\t\treturn ERR_PTR(-ENOMEM);\n\n\tibdev_dbg(&mdev->ib_dev, \"ucmd wq_buf_addr 0x%llx\\n\", ucmd.wq_buf_addr);\n\n\tumem = ib_umem_get(pd->device, ucmd.wq_buf_addr, ucmd.wq_buf_size,\n\t\t\t   IB_ACCESS_LOCAL_WRITE);\n\tif (IS_ERR(umem)) {\n\t\terr = PTR_ERR(umem);\n\t\tibdev_dbg(&mdev->ib_dev,\n\t\t\t  \"Failed to get umem for create wq, err %d\\n\", err);\n\t\tgoto err_free_wq;\n\t}\n\n\twq->umem = umem;\n\twq->wqe = init_attr->max_wr;\n\twq->wq_buf_size = ucmd.wq_buf_size;\n\twq->rx_object = INVALID_MANA_HANDLE;\n\n\terr = mana_ib_gd_create_dma_region(mdev, wq->umem, &wq->gdma_region);\n\tif (err) {\n\t\tibdev_dbg(&mdev->ib_dev,\n\t\t\t  \"Failed to create dma region for create wq, %d\\n\",\n\t\t\t  err);\n\t\tgoto err_release_umem;\n\t}\n\n\tibdev_dbg(&mdev->ib_dev,\n\t\t  \"mana_ib_gd_create_dma_region ret %d gdma_region 0x%llx\\n\",\n\t\t  err, wq->gdma_region);\n\n\t \n\n\treturn &wq->ibwq;\n\nerr_release_umem:\n\tib_umem_release(umem);\n\nerr_free_wq:\n\tkfree(wq);\n\n\treturn ERR_PTR(err);\n}\n\nint mana_ib_modify_wq(struct ib_wq *wq, struct ib_wq_attr *wq_attr,\n\t\t      u32 wq_attr_mask, struct ib_udata *udata)\n{\n\t \n\treturn -EOPNOTSUPP;\n}\n\nint mana_ib_destroy_wq(struct ib_wq *ibwq, struct ib_udata *udata)\n{\n\tstruct mana_ib_wq *wq = container_of(ibwq, struct mana_ib_wq, ibwq);\n\tstruct ib_device *ib_dev = ibwq->device;\n\tstruct mana_ib_dev *mdev;\n\n\tmdev = container_of(ib_dev, struct mana_ib_dev, ib_dev);\n\n\tmana_ib_gd_destroy_dma_region(mdev, wq->gdma_region);\n\tib_umem_release(wq->umem);\n\n\tkfree(wq);\n\n\treturn 0;\n}\n\nint mana_ib_create_rwq_ind_table(struct ib_rwq_ind_table *ib_rwq_ind_table,\n\t\t\t\t struct ib_rwq_ind_table_init_attr *init_attr,\n\t\t\t\t struct ib_udata *udata)\n{\n\t \n\treturn 0;\n}\n\nint mana_ib_destroy_rwq_ind_table(struct ib_rwq_ind_table *ib_rwq_ind_tbl)\n{\n\t \n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}