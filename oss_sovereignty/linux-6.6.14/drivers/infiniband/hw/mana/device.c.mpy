{
  "module_name": "device.c",
  "hash_id": "da185fa365439e75350c84eb3a948809ed7be1904ebebdbb9f6fca825ca283d8",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/mana/device.c",
  "human_readable_source": "\n \n\n#include \"mana_ib.h\"\n#include <net/mana/mana_auxiliary.h>\n\nMODULE_DESCRIPTION(\"Microsoft Azure Network Adapter IB driver\");\nMODULE_LICENSE(\"GPL\");\nMODULE_IMPORT_NS(NET_MANA);\n\nstatic const struct ib_device_ops mana_ib_dev_ops = {\n\t.owner = THIS_MODULE,\n\t.driver_id = RDMA_DRIVER_MANA,\n\t.uverbs_abi_ver = MANA_IB_UVERBS_ABI_VERSION,\n\n\t.alloc_pd = mana_ib_alloc_pd,\n\t.alloc_ucontext = mana_ib_alloc_ucontext,\n\t.create_cq = mana_ib_create_cq,\n\t.create_qp = mana_ib_create_qp,\n\t.create_rwq_ind_table = mana_ib_create_rwq_ind_table,\n\t.create_wq = mana_ib_create_wq,\n\t.dealloc_pd = mana_ib_dealloc_pd,\n\t.dealloc_ucontext = mana_ib_dealloc_ucontext,\n\t.dereg_mr = mana_ib_dereg_mr,\n\t.destroy_cq = mana_ib_destroy_cq,\n\t.destroy_qp = mana_ib_destroy_qp,\n\t.destroy_rwq_ind_table = mana_ib_destroy_rwq_ind_table,\n\t.destroy_wq = mana_ib_destroy_wq,\n\t.disassociate_ucontext = mana_ib_disassociate_ucontext,\n\t.get_port_immutable = mana_ib_get_port_immutable,\n\t.mmap = mana_ib_mmap,\n\t.modify_qp = mana_ib_modify_qp,\n\t.modify_wq = mana_ib_modify_wq,\n\t.query_device = mana_ib_query_device,\n\t.query_gid = mana_ib_query_gid,\n\t.query_port = mana_ib_query_port,\n\t.reg_user_mr = mana_ib_reg_user_mr,\n\n\tINIT_RDMA_OBJ_SIZE(ib_cq, mana_ib_cq, ibcq),\n\tINIT_RDMA_OBJ_SIZE(ib_pd, mana_ib_pd, ibpd),\n\tINIT_RDMA_OBJ_SIZE(ib_qp, mana_ib_qp, ibqp),\n\tINIT_RDMA_OBJ_SIZE(ib_ucontext, mana_ib_ucontext, ibucontext),\n\tINIT_RDMA_OBJ_SIZE(ib_rwq_ind_table, mana_ib_rwq_ind_table,\n\t\t\t   ib_ind_table),\n};\n\nstatic int mana_ib_probe(struct auxiliary_device *adev,\n\t\t\t const struct auxiliary_device_id *id)\n{\n\tstruct mana_adev *madev = container_of(adev, struct mana_adev, adev);\n\tstruct gdma_dev *mdev = madev->mdev;\n\tstruct mana_context *mc;\n\tstruct mana_ib_dev *dev;\n\tint ret;\n\n\tmc = mdev->driver_data;\n\n\tdev = ib_alloc_device(mana_ib_dev, ib_dev);\n\tif (!dev)\n\t\treturn -ENOMEM;\n\n\tib_set_device_ops(&dev->ib_dev, &mana_ib_dev_ops);\n\n\tdev->ib_dev.phys_port_cnt = mc->num_ports;\n\n\tibdev_dbg(&dev->ib_dev, \"mdev=%p id=%d num_ports=%d\\n\", mdev,\n\t\t  mdev->dev_id.as_uint32, dev->ib_dev.phys_port_cnt);\n\n\tdev->gdma_dev = mdev;\n\tdev->ib_dev.node_type = RDMA_NODE_IB_CA;\n\n\t \n\tdev->ib_dev.num_comp_vectors = 1;\n\tdev->ib_dev.dev.parent = mdev->gdma_context->dev;\n\n\tret = ib_register_device(&dev->ib_dev, \"mana_%d\",\n\t\t\t\t mdev->gdma_context->dev);\n\tif (ret) {\n\t\tib_dealloc_device(&dev->ib_dev);\n\t\treturn ret;\n\t}\n\n\tdev_set_drvdata(&adev->dev, dev);\n\n\treturn 0;\n}\n\nstatic void mana_ib_remove(struct auxiliary_device *adev)\n{\n\tstruct mana_ib_dev *dev = dev_get_drvdata(&adev->dev);\n\n\tib_unregister_device(&dev->ib_dev);\n\tib_dealloc_device(&dev->ib_dev);\n}\n\nstatic const struct auxiliary_device_id mana_id_table[] = {\n\t{\n\t\t.name = \"mana.rdma\",\n\t},\n\t{},\n};\n\nMODULE_DEVICE_TABLE(auxiliary, mana_id_table);\n\nstatic struct auxiliary_driver mana_driver = {\n\t.name = \"rdma\",\n\t.probe = mana_ib_probe,\n\t.remove = mana_ib_remove,\n\t.id_table = mana_id_table,\n};\n\nmodule_auxiliary_driver(mana_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}