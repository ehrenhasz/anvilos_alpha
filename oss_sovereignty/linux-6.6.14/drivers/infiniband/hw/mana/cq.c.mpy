{
  "module_name": "cq.c",
  "hash_id": "26229f4c269a9b8c449e93e94ff0b517390ebc4f241a1ecffdcc1ea18cecad38",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/mana/cq.c",
  "human_readable_source": "\n \n\n#include \"mana_ib.h\"\n\nint mana_ib_create_cq(struct ib_cq *ibcq, const struct ib_cq_init_attr *attr,\n\t\t      struct ib_udata *udata)\n{\n\tstruct mana_ib_cq *cq = container_of(ibcq, struct mana_ib_cq, ibcq);\n\tstruct ib_device *ibdev = ibcq->device;\n\tstruct mana_ib_create_cq ucmd = {};\n\tstruct mana_ib_dev *mdev;\n\tint err;\n\n\tmdev = container_of(ibdev, struct mana_ib_dev, ib_dev);\n\n\tif (udata->inlen < sizeof(ucmd))\n\t\treturn -EINVAL;\n\n\terr = ib_copy_from_udata(&ucmd, udata, min(sizeof(ucmd), udata->inlen));\n\tif (err) {\n\t\tibdev_dbg(ibdev,\n\t\t\t  \"Failed to copy from udata for create cq, %d\\n\", err);\n\t\treturn err;\n\t}\n\n\tif (attr->cqe > MAX_SEND_BUFFERS_PER_QUEUE) {\n\t\tibdev_dbg(ibdev, \"CQE %d exceeding limit\\n\", attr->cqe);\n\t\treturn -EINVAL;\n\t}\n\n\tcq->cqe = attr->cqe;\n\tcq->umem = ib_umem_get(ibdev, ucmd.buf_addr, cq->cqe * COMP_ENTRY_SIZE,\n\t\t\t       IB_ACCESS_LOCAL_WRITE);\n\tif (IS_ERR(cq->umem)) {\n\t\terr = PTR_ERR(cq->umem);\n\t\tibdev_dbg(ibdev, \"Failed to get umem for create cq, err %d\\n\",\n\t\t\t  err);\n\t\treturn err;\n\t}\n\n\terr = mana_ib_gd_create_dma_region(mdev, cq->umem, &cq->gdma_region);\n\tif (err) {\n\t\tibdev_dbg(ibdev,\n\t\t\t  \"Failed to create dma region for create cq, %d\\n\",\n\t\t\t  err);\n\t\tgoto err_release_umem;\n\t}\n\n\tibdev_dbg(ibdev,\n\t\t  \"mana_ib_gd_create_dma_region ret %d gdma_region 0x%llx\\n\",\n\t\t  err, cq->gdma_region);\n\n\t \n\n\treturn 0;\n\nerr_release_umem:\n\tib_umem_release(cq->umem);\n\treturn err;\n}\n\nint mana_ib_destroy_cq(struct ib_cq *ibcq, struct ib_udata *udata)\n{\n\tstruct mana_ib_cq *cq = container_of(ibcq, struct mana_ib_cq, ibcq);\n\tstruct ib_device *ibdev = ibcq->device;\n\tstruct mana_ib_dev *mdev;\n\n\tmdev = container_of(ibdev, struct mana_ib_dev, ib_dev);\n\n\tmana_ib_gd_destroy_dma_region(mdev, cq->gdma_region);\n\tib_umem_release(cq->umem);\n\n\treturn 0;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}