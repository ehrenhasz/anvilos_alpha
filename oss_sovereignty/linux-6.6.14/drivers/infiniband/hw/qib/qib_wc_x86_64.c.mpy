{
  "module_name": "qib_wc_x86_64.c",
  "hash_id": "34f391377bee6382674abee438e5e4ba62d987a2e86e68887f0f0ff64ac355cc",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/hw/qib/qib_wc_x86_64.c",
  "human_readable_source": " \n\n \n\n#include <linux/pci.h>\n#include <asm/mtrr.h>\n#include <asm/processor.h>\n\n#include \"qib.h\"\n\n \nint qib_enable_wc(struct qib_devdata *dd)\n{\n\tint ret = 0;\n\tu64 pioaddr, piolen;\n\tunsigned bits;\n\tconst unsigned long addr = pci_resource_start(dd->pcidev, 0);\n\tconst size_t len = pci_resource_len(dd->pcidev, 0);\n\n\t \n\tif (dd->piobcnt2k && dd->piobcnt4k) {\n\t\t \n\t\tunsigned long pio2kbase, pio4kbase;\n\n\t\tpio2kbase = dd->piobufbase & 0xffffffffUL;\n\t\tpio4kbase = (dd->piobufbase >> 32) & 0xffffffffUL;\n\t\tif (pio2kbase < pio4kbase) {\n\t\t\t \n\t\t\tpioaddr = addr + pio2kbase;\n\t\t\tpiolen = pio4kbase - pio2kbase +\n\t\t\t\tdd->piobcnt4k * dd->align4k;\n\t\t} else {\n\t\t\tpioaddr = addr + pio4kbase;\n\t\t\tpiolen = pio2kbase - pio4kbase +\n\t\t\t\tdd->piobcnt2k * dd->palign;\n\t\t}\n\t} else {   \n\t\tpioaddr = addr + dd->piobufbase;\n\t\tpiolen = dd->piobcnt2k * dd->palign +\n\t\t\tdd->piobcnt4k * dd->align4k;\n\t}\n\n\tfor (bits = 0; !(piolen & (1ULL << bits)); bits++)\n\t\t;  \n\n\tif (piolen != (1ULL << bits)) {\n\t\tpiolen >>= bits;\n\t\twhile (piolen >>= 1)\n\t\t\tbits++;\n\t\tpiolen = 1ULL << (bits + 1);\n\t}\n\tif (pioaddr & (piolen - 1)) {\n\t\tu64 atmp = pioaddr & ~(piolen - 1);\n\n\t\tif (atmp < addr || (atmp + piolen) > (addr + len)) {\n\t\t\tqib_dev_err(dd,\n\t\t\t\t\"No way to align address/size (%llx/%llx), no WC mtrr\\n\",\n\t\t\t\t(unsigned long long) atmp,\n\t\t\t\t(unsigned long long) piolen << 1);\n\t\t\tret = -ENODEV;\n\t\t} else {\n\t\t\tpioaddr = atmp;\n\t\t\tpiolen <<= 1;\n\t\t}\n\t}\n\n\tif (!ret) {\n\t\tdd->wc_cookie = arch_phys_wc_add(pioaddr, piolen);\n\t\tif (dd->wc_cookie < 0)\n\t\t\t \n\t\t\tret = dd->wc_cookie;\n\t}\n\n\treturn ret;\n}\n\n \nvoid qib_disable_wc(struct qib_devdata *dd)\n{\n\tarch_phys_wc_del(dd->wc_cookie);\n}\n\n \nint qib_unordered_wc(void)\n{\n\treturn boot_cpu_data.x86_vendor != X86_VENDOR_AMD;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}