{
  "module_name": "mad.c",
  "hash_id": "d09c9c2d0abf495cce7e70d040f5da8fb12361a6ed3f70c537044f12e669d366",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/sw/rdmavt/mad.c",
  "human_readable_source": "\n \n\n#include <rdma/ib_mad.h>\n#include \"mad.h\"\n#include \"vt.h\"\n\n \nint rvt_process_mad(struct ib_device *ibdev, int mad_flags, u32 port_num,\n\t\t    const struct ib_wc *in_wc, const struct ib_grh *in_grh,\n\t\t    const struct ib_mad_hdr *in, size_t in_mad_size,\n\t\t    struct ib_mad_hdr *out, size_t *out_mad_size,\n\t\t    u16 *out_mad_pkey_index)\n{\n\t \n\treturn IB_MAD_RESULT_FAILURE;\n}\n\nstatic void rvt_send_mad_handler(struct ib_mad_agent *agent,\n\t\t\t\t struct ib_mad_send_wc *mad_send_wc)\n{\n\tib_free_send_mad(mad_send_wc->send_buf);\n}\n\n \nint rvt_create_mad_agents(struct rvt_dev_info *rdi)\n{\n\tstruct ib_mad_agent *agent;\n\tstruct rvt_ibport *rvp;\n\tint p;\n\tint ret;\n\n\tfor (p = 0; p < rdi->dparms.nports; p++) {\n\t\trvp = rdi->ports[p];\n\t\tagent = ib_register_mad_agent(&rdi->ibdev, p + 1,\n\t\t\t\t\t      IB_QPT_SMI,\n\t\t\t\t\t      NULL, 0, rvt_send_mad_handler,\n\t\t\t\t\t      NULL, NULL, 0);\n\t\tif (IS_ERR(agent)) {\n\t\t\tret = PTR_ERR(agent);\n\t\t\tgoto err;\n\t\t}\n\n\t\trvp->send_agent = agent;\n\n\t\tif (rdi->driver_f.notify_create_mad_agent)\n\t\t\trdi->driver_f.notify_create_mad_agent(rdi, p);\n\t}\n\n\treturn 0;\n\nerr:\n\tfor (p = 0; p < rdi->dparms.nports; p++) {\n\t\trvp = rdi->ports[p];\n\t\tif (rvp->send_agent) {\n\t\t\tagent = rvp->send_agent;\n\t\t\trvp->send_agent = NULL;\n\t\t\tib_unregister_mad_agent(agent);\n\t\t\tif (rdi->driver_f.notify_free_mad_agent)\n\t\t\t\trdi->driver_f.notify_free_mad_agent(rdi, p);\n\t\t}\n\t}\n\n\treturn ret;\n}\n\n \nvoid rvt_free_mad_agents(struct rvt_dev_info *rdi)\n{\n\tstruct ib_mad_agent *agent;\n\tstruct rvt_ibport *rvp;\n\tint p;\n\n\tfor (p = 0; p < rdi->dparms.nports; p++) {\n\t\trvp = rdi->ports[p];\n\t\tif (rvp->send_agent) {\n\t\t\tagent = rvp->send_agent;\n\t\t\trvp->send_agent = NULL;\n\t\t\tib_unregister_mad_agent(agent);\n\t\t}\n\t\tif (rvp->sm_ah) {\n\t\t\trdma_destroy_ah(&rvp->sm_ah->ibah,\n\t\t\t\t\tRDMA_DESTROY_AH_SLEEPABLE);\n\t\t\trvp->sm_ah = NULL;\n\t\t}\n\n\t\tif (rdi->driver_f.notify_free_mad_agent)\n\t\t\trdi->driver_f.notify_free_mad_agent(rdi, p);\n\t}\n}\n\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}