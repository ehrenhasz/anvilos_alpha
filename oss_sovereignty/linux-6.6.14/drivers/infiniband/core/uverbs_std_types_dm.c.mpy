{
  "module_name": "uverbs_std_types_dm.c",
  "hash_id": "89783cb0ada7a81b87cc0848840193a5b7b8b24b27cdc7cc5353fcedbfec6ef3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/core/uverbs_std_types_dm.c",
  "human_readable_source": " \n\n#include \"rdma_core.h\"\n#include \"uverbs.h\"\n#include <rdma/uverbs_std_types.h>\n\nstatic int uverbs_free_dm(struct ib_uobject *uobject,\n\t\t\t  enum rdma_remove_reason why,\n\t\t\t  struct uverbs_attr_bundle *attrs)\n{\n\tstruct ib_dm *dm = uobject->object;\n\n\tif (atomic_read(&dm->usecnt))\n\t\treturn -EBUSY;\n\n\treturn dm->device->ops.dealloc_dm(dm, attrs);\n}\n\nstatic int UVERBS_HANDLER(UVERBS_METHOD_DM_ALLOC)(\n\tstruct uverbs_attr_bundle *attrs)\n{\n\tstruct ib_dm_alloc_attr attr = {};\n\tstruct ib_uobject *uobj =\n\t\tuverbs_attr_get(attrs, UVERBS_ATTR_ALLOC_DM_HANDLE)\n\t\t\t->obj_attr.uobject;\n\tstruct ib_device *ib_dev = attrs->context->device;\n\tstruct ib_dm *dm;\n\tint ret;\n\n\tif (!ib_dev->ops.alloc_dm)\n\t\treturn -EOPNOTSUPP;\n\n\tret = uverbs_copy_from(&attr.length, attrs,\n\t\t\t       UVERBS_ATTR_ALLOC_DM_LENGTH);\n\tif (ret)\n\t\treturn ret;\n\n\tret = uverbs_copy_from(&attr.alignment, attrs,\n\t\t\t       UVERBS_ATTR_ALLOC_DM_ALIGNMENT);\n\tif (ret)\n\t\treturn ret;\n\n\tdm = ib_dev->ops.alloc_dm(ib_dev, attrs->context, &attr, attrs);\n\tif (IS_ERR(dm))\n\t\treturn PTR_ERR(dm);\n\n\tdm->device  = ib_dev;\n\tdm->length  = attr.length;\n\tdm->uobject = uobj;\n\tatomic_set(&dm->usecnt, 0);\n\n\tuobj->object = dm;\n\n\treturn 0;\n}\n\nDECLARE_UVERBS_NAMED_METHOD(\n\tUVERBS_METHOD_DM_ALLOC,\n\tUVERBS_ATTR_IDR(UVERBS_ATTR_ALLOC_DM_HANDLE,\n\t\t\tUVERBS_OBJECT_DM,\n\t\t\tUVERBS_ACCESS_NEW,\n\t\t\tUA_MANDATORY),\n\tUVERBS_ATTR_PTR_IN(UVERBS_ATTR_ALLOC_DM_LENGTH,\n\t\t\t   UVERBS_ATTR_TYPE(u64),\n\t\t\t   UA_MANDATORY),\n\tUVERBS_ATTR_PTR_IN(UVERBS_ATTR_ALLOC_DM_ALIGNMENT,\n\t\t\t   UVERBS_ATTR_TYPE(u32),\n\t\t\t   UA_MANDATORY));\n\nDECLARE_UVERBS_NAMED_METHOD_DESTROY(\n\tUVERBS_METHOD_DM_FREE,\n\tUVERBS_ATTR_IDR(UVERBS_ATTR_FREE_DM_HANDLE,\n\t\t\tUVERBS_OBJECT_DM,\n\t\t\tUVERBS_ACCESS_DESTROY,\n\t\t\tUA_MANDATORY));\n\nDECLARE_UVERBS_NAMED_OBJECT(UVERBS_OBJECT_DM,\n\t\t\t    UVERBS_TYPE_ALLOC_IDR(uverbs_free_dm),\n\t\t\t    &UVERBS_METHOD(UVERBS_METHOD_DM_ALLOC),\n\t\t\t    &UVERBS_METHOD(UVERBS_METHOD_DM_FREE));\n\nconst struct uapi_definition uverbs_def_obj_dm[] = {\n\tUAPI_DEF_CHAIN_OBJ_TREE_NAMED(UVERBS_OBJECT_DM,\n\t\t\t\t      UAPI_DEF_OBJ_NEEDS_FN(dealloc_dm)),\n\t{}\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}