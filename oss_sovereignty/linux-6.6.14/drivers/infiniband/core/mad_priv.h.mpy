{
  "module_name": "mad_priv.h",
  "hash_id": "f2917646d49030734b113565df13d2fcb9151a1895f7b88c95c0a15f01f125a4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/core/mad_priv.h",
  "human_readable_source": " \n\n#ifndef __IB_MAD_PRIV_H__\n#define __IB_MAD_PRIV_H__\n\n#include <linux/completion.h>\n#include <linux/err.h>\n#include <linux/workqueue.h>\n#include <rdma/ib_mad.h>\n#include <rdma/ib_smi.h>\n#include <rdma/opa_smi.h>\n\n#define IB_MAD_QPS_CORE\t\t2  \n\n \n#define IB_MAD_QP_SEND_SIZE\t128\n#define IB_MAD_QP_RECV_SIZE\t512\n#define IB_MAD_QP_MIN_SIZE\t64\n#define IB_MAD_QP_MAX_SIZE\t8192\n#define IB_MAD_SEND_REQ_MAX_SG\t2\n#define IB_MAD_RECV_REQ_MAX_SG\t1\n\n#define IB_MAD_SEND_Q_PSN\t0\n\n \n#define MAX_MGMT_CLASS\t\t80\n#define MAX_MGMT_VERSION\t0x83\n#define MAX_MGMT_OUI\t\t8\n#define MAX_MGMT_VENDOR_RANGE2\t(IB_MGMT_CLASS_VENDOR_RANGE2_END - \\\n\t\t\t\tIB_MGMT_CLASS_VENDOR_RANGE2_START + 1)\n\nstruct ib_mad_list_head {\n\tstruct list_head list;\n\tstruct ib_cqe cqe;\n\tstruct ib_mad_queue *mad_queue;\n};\n\nstruct ib_mad_private_header {\n\tstruct ib_mad_list_head mad_list;\n\tstruct ib_mad_recv_wc recv_wc;\n\tstruct ib_wc wc;\n\tu64 mapping;\n} __packed;\n\nstruct ib_mad_private {\n\tstruct ib_mad_private_header header;\n\tsize_t mad_size;\n\tstruct ib_grh grh;\n\tu8 mad[];\n} __packed;\n\nstruct ib_rmpp_segment {\n\tstruct list_head list;\n\tu32 num;\n\tu8 data[];\n};\n\nstruct ib_mad_agent_private {\n\tstruct ib_mad_agent agent;\n\tstruct ib_mad_reg_req *reg_req;\n\tstruct ib_mad_qp_info *qp_info;\n\n\tspinlock_t lock;\n\tstruct list_head send_list;\n\tstruct list_head wait_list;\n\tstruct list_head done_list;\n\tstruct delayed_work timed_work;\n\tunsigned long timeout;\n\tstruct list_head local_list;\n\tstruct work_struct local_work;\n\tstruct list_head rmpp_list;\n\n\trefcount_t refcount;\n\tunion {\n\t\tstruct completion comp;\n\t\tstruct rcu_head rcu;\n\t};\n};\n\nstruct ib_mad_snoop_private {\n\tstruct ib_mad_agent agent;\n\tstruct ib_mad_qp_info *qp_info;\n\tint snoop_index;\n\tint mad_snoop_flags;\n\tstruct completion comp;\n};\n\nstruct ib_mad_send_wr_private {\n\tstruct ib_mad_list_head mad_list;\n\tstruct list_head agent_list;\n\tstruct ib_mad_agent_private *mad_agent_priv;\n\tstruct ib_mad_send_buf send_buf;\n\tu64 header_mapping;\n\tu64 payload_mapping;\n\tstruct ib_ud_wr send_wr;\n\tstruct ib_sge sg_list[IB_MAD_SEND_REQ_MAX_SG];\n\t__be64 tid;\n\tunsigned long timeout;\n\tint max_retries;\n\tint retries_left;\n\tint retry;\n\tint refcount;\n\tenum ib_wc_status status;\n\n\t \n\tstruct list_head rmpp_list;\n\tstruct ib_rmpp_segment *last_ack_seg;\n\tstruct ib_rmpp_segment *cur_seg;\n\tint last_ack;\n\tint seg_num;\n\tint newwin;\n\tint pad;\n};\n\nstruct ib_mad_local_private {\n\tstruct list_head completion_list;\n\tstruct ib_mad_private *mad_priv;\n\tstruct ib_mad_agent_private *recv_mad_agent;\n\tstruct ib_mad_send_wr_private *mad_send_wr;\n\tsize_t return_wc_byte_len;\n};\n\nstruct ib_mad_mgmt_method_table {\n\tstruct ib_mad_agent_private *agent[IB_MGMT_MAX_METHODS];\n};\n\nstruct ib_mad_mgmt_class_table {\n\tstruct ib_mad_mgmt_method_table *method_table[MAX_MGMT_CLASS];\n};\n\nstruct ib_mad_mgmt_vendor_class {\n\tu8\toui[MAX_MGMT_OUI][3];\n\tstruct ib_mad_mgmt_method_table *method_table[MAX_MGMT_OUI];\n};\n\nstruct ib_mad_mgmt_vendor_class_table {\n\tstruct ib_mad_mgmt_vendor_class *vendor_class[MAX_MGMT_VENDOR_RANGE2];\n};\n\nstruct ib_mad_mgmt_version_table {\n\tstruct ib_mad_mgmt_class_table *class;\n\tstruct ib_mad_mgmt_vendor_class_table *vendor;\n};\n\nstruct ib_mad_queue {\n\tspinlock_t lock;\n\tstruct list_head list;\n\tint count;\n\tint max_active;\n\tstruct ib_mad_qp_info *qp_info;\n};\n\nstruct ib_mad_qp_info {\n\tstruct ib_mad_port_private *port_priv;\n\tstruct ib_qp *qp;\n\tstruct ib_mad_queue send_queue;\n\tstruct ib_mad_queue recv_queue;\n\tstruct list_head overflow_list;\n\tspinlock_t snoop_lock;\n\tstruct ib_mad_snoop_private **snoop_table;\n\tint snoop_table_size;\n\tatomic_t snoop_count;\n};\n\nstruct ib_mad_port_private {\n\tstruct list_head port_list;\n\tstruct ib_device *device;\n\tint port_num;\n\tstruct ib_cq *cq;\n\tstruct ib_pd *pd;\n\n\tspinlock_t reg_lock;\n\tstruct ib_mad_mgmt_version_table version[MAX_MGMT_VERSION];\n\tstruct workqueue_struct *wq;\n\tstruct ib_mad_qp_info qp_info[IB_MAD_QPS_CORE];\n};\n\nint ib_send_mad(struct ib_mad_send_wr_private *mad_send_wr);\n\nstruct ib_mad_send_wr_private *\nib_find_send_mad(const struct ib_mad_agent_private *mad_agent_priv,\n\t\t const struct ib_mad_recv_wc *mad_recv_wc);\n\nvoid ib_mad_complete_send_wr(struct ib_mad_send_wr_private *mad_send_wr,\n\t\t\t     struct ib_mad_send_wc *mad_send_wc);\n\nvoid ib_mark_mad_done(struct ib_mad_send_wr_private *mad_send_wr);\n\nvoid ib_reset_mad_timeout(struct ib_mad_send_wr_private *mad_send_wr,\n\t\t\t  unsigned long timeout_ms);\n\n#endif\t \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}