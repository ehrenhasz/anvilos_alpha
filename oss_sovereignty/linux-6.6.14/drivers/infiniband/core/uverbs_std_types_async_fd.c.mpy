{
  "module_name": "uverbs_std_types_async_fd.c",
  "hash_id": "4b1ff7f4ca8282fa996808f8af6987b614b584c1803d4bd643d1d25c3a533391",
  "original_prompt": "Ingested from linux-6.6.14/drivers/infiniband/core/uverbs_std_types_async_fd.c",
  "human_readable_source": "\n \n\n#include <rdma/uverbs_std_types.h>\n#include <rdma/uverbs_ioctl.h>\n#include \"rdma_core.h\"\n#include \"uverbs.h\"\n\nstatic int UVERBS_HANDLER(UVERBS_METHOD_ASYNC_EVENT_ALLOC)(\n\tstruct uverbs_attr_bundle *attrs)\n{\n\tstruct ib_uobject *uobj =\n\t\tuverbs_attr_get_uobject(attrs, UVERBS_METHOD_ASYNC_EVENT_ALLOC);\n\n\tib_uverbs_init_async_event_file(\n\t\tcontainer_of(uobj, struct ib_uverbs_async_event_file, uobj));\n\treturn 0;\n}\n\nstatic void uverbs_async_event_destroy_uobj(struct ib_uobject *uobj,\n\t\t\t\t\t    enum rdma_remove_reason why)\n{\n\tstruct ib_uverbs_async_event_file *event_file =\n\t\tcontainer_of(uobj, struct ib_uverbs_async_event_file, uobj);\n\n\tib_unregister_event_handler(&event_file->event_handler);\n\n\tif (why == RDMA_REMOVE_DRIVER_REMOVE)\n\t\tib_uverbs_async_handler(event_file, 0, IB_EVENT_DEVICE_FATAL,\n\t\t\t\t\tNULL, NULL);\n}\n\nint uverbs_async_event_release(struct inode *inode, struct file *filp)\n{\n\tstruct ib_uverbs_async_event_file *event_file;\n\tstruct ib_uobject *uobj = filp->private_data;\n\tint ret;\n\n\tif (!uobj)\n\t\treturn uverbs_uobject_fd_release(inode, filp);\n\n\tevent_file =\n\t\tcontainer_of(uobj, struct ib_uverbs_async_event_file, uobj);\n\n\t \n\tuverbs_uobject_get(uobj);\n\tret = uverbs_uobject_fd_release(inode, filp);\n\tib_uverbs_free_event_queue(&event_file->ev_queue);\n\tuverbs_uobject_put(uobj);\n\treturn ret;\n}\n\nDECLARE_UVERBS_NAMED_METHOD(\n\tUVERBS_METHOD_ASYNC_EVENT_ALLOC,\n\tUVERBS_ATTR_FD(UVERBS_ATTR_ASYNC_EVENT_ALLOC_FD_HANDLE,\n\t\t       UVERBS_OBJECT_ASYNC_EVENT,\n\t\t       UVERBS_ACCESS_NEW,\n\t\t       UA_MANDATORY));\n\nDECLARE_UVERBS_NAMED_OBJECT(\n\tUVERBS_OBJECT_ASYNC_EVENT,\n\tUVERBS_TYPE_ALLOC_FD(sizeof(struct ib_uverbs_async_event_file),\n\t\t\t     uverbs_async_event_destroy_uobj,\n\t\t\t     &uverbs_async_event_fops,\n\t\t\t     \"[infinibandevent]\",\n\t\t\t     O_RDONLY),\n\t&UVERBS_METHOD(UVERBS_METHOD_ASYNC_EVENT_ALLOC));\n\nconst struct uapi_definition uverbs_def_obj_async_fd[] = {\n\tUAPI_DEF_CHAIN_OBJ_TREE_NAMED(UVERBS_OBJECT_ASYNC_EVENT),\n\t{}\n};\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}