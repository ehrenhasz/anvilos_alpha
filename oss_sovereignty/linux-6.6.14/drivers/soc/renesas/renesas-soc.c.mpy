{
  "module_name": "renesas-soc.c",
  "hash_id": "ad8f0b6aa1ed00ce5eec12a32c3fb1ac0b5a28b3d5e2f40993eeb067037840eb",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/renesas/renesas-soc.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/slab.h>\n#include <linux/string.h>\n#include <linux/sys_soc.h>\n\n\nstruct renesas_family {\n\tconst char name[16];\n\tu32 reg;\t\t\t \n};\n\nstatic const struct renesas_family fam_rcar_gen1 __initconst __maybe_unused = {\n\t.name\t= \"R-Car Gen1\",\n\t.reg\t= 0xff000044,\t\t \n};\n\nstatic const struct renesas_family fam_rcar_gen2 __initconst __maybe_unused = {\n\t.name\t= \"R-Car Gen2\",\n\t.reg\t= 0xff000044,\t\t \n};\n\nstatic const struct renesas_family fam_rcar_gen3 __initconst __maybe_unused = {\n\t.name\t= \"R-Car Gen3\",\n\t.reg\t= 0xfff00044,\t\t \n};\n\nstatic const struct renesas_family fam_rcar_gen4 __initconst __maybe_unused = {\n\t.name\t= \"R-Car Gen4\",\n};\n\nstatic const struct renesas_family fam_rmobile __initconst __maybe_unused = {\n\t.name\t= \"R-Mobile\",\n\t.reg\t= 0xe600101c,\t\t \n};\n\nstatic const struct renesas_family fam_rza1 __initconst __maybe_unused = {\n\t.name\t= \"RZ/A1\",\n};\n\nstatic const struct renesas_family fam_rza2 __initconst __maybe_unused = {\n\t.name\t= \"RZ/A2\",\n};\n\nstatic const struct renesas_family fam_rzfive __initconst __maybe_unused = {\n\t.name\t= \"RZ/Five\",\n};\n\nstatic const struct renesas_family fam_rzg1 __initconst __maybe_unused = {\n\t.name\t= \"RZ/G1\",\n\t.reg\t= 0xff000044,\t\t \n};\n\nstatic const struct renesas_family fam_rzg2 __initconst __maybe_unused = {\n\t.name\t= \"RZ/G2\",\n\t.reg\t= 0xfff00044,\t\t \n};\n\nstatic const struct renesas_family fam_rzg2l __initconst __maybe_unused = {\n\t.name\t= \"RZ/G2L\",\n};\n\nstatic const struct renesas_family fam_rzg2ul __initconst __maybe_unused = {\n\t.name\t= \"RZ/G2UL\",\n};\n\nstatic const struct renesas_family fam_rzv2l __initconst __maybe_unused = {\n\t.name\t= \"RZ/V2L\",\n};\n\nstatic const struct renesas_family fam_rzv2m __initconst __maybe_unused = {\n\t.name\t= \"RZ/V2M\",\n};\n\nstatic const struct renesas_family fam_shmobile __initconst __maybe_unused = {\n\t.name\t= \"SH-Mobile\",\n\t.reg\t= 0xe600101c,\t\t \n};\n\n\nstruct renesas_soc {\n\tconst struct renesas_family *family;\n\tu32 id;\n};\n\nstatic const struct renesas_soc soc_rz_a1h __initconst __maybe_unused = {\n\t.family\t= &fam_rza1,\n};\n\nstatic const struct renesas_soc soc_rz_a2m __initconst __maybe_unused = {\n\t.family\t= &fam_rza2,\n\t.id\t= 0x3b,\n};\n\nstatic const struct renesas_soc soc_rmobile_ape6 __initconst __maybe_unused = {\n\t.family\t= &fam_rmobile,\n\t.id\t= 0x3f,\n};\n\nstatic const struct renesas_soc soc_rmobile_a1 __initconst __maybe_unused = {\n\t.family\t= &fam_rmobile,\n\t.id\t= 0x40,\n};\n\nstatic const struct renesas_soc soc_rz_five __initconst __maybe_unused = {\n\t.family = &fam_rzfive,\n\t.id     = 0x847c447,\n};\n\nstatic const struct renesas_soc soc_rz_g1h __initconst __maybe_unused = {\n\t.family\t= &fam_rzg1,\n\t.id\t= 0x45,\n};\n\nstatic const struct renesas_soc soc_rz_g1m __initconst __maybe_unused = {\n\t.family\t= &fam_rzg1,\n\t.id\t= 0x47,\n};\n\nstatic const struct renesas_soc soc_rz_g1n __initconst __maybe_unused = {\n\t.family\t= &fam_rzg1,\n\t.id\t= 0x4b,\n};\n\nstatic const struct renesas_soc soc_rz_g1e __initconst __maybe_unused = {\n\t.family\t= &fam_rzg1,\n\t.id\t= 0x4c,\n};\n\nstatic const struct renesas_soc soc_rz_g1c __initconst __maybe_unused = {\n\t.family\t= &fam_rzg1,\n\t.id\t= 0x53,\n};\n\nstatic const struct renesas_soc soc_rz_g2m __initconst __maybe_unused = {\n\t.family\t= &fam_rzg2,\n\t.id\t= 0x52,\n};\n\nstatic const struct renesas_soc soc_rz_g2n __initconst __maybe_unused = {\n\t.family = &fam_rzg2,\n\t.id     = 0x55,\n};\n\nstatic const struct renesas_soc soc_rz_g2e __initconst __maybe_unused = {\n\t.family\t= &fam_rzg2,\n\t.id\t= 0x57,\n};\n\nstatic const struct renesas_soc soc_rz_g2h __initconst __maybe_unused = {\n\t.family\t= &fam_rzg2,\n\t.id\t= 0x4f,\n};\n\nstatic const struct renesas_soc soc_rz_g2l __initconst __maybe_unused = {\n\t.family = &fam_rzg2l,\n\t.id     = 0x841c447,\n};\n\nstatic const struct renesas_soc soc_rz_g2ul __initconst __maybe_unused = {\n\t.family = &fam_rzg2ul,\n\t.id     = 0x8450447,\n};\n\nstatic const struct renesas_soc soc_rz_v2l __initconst __maybe_unused = {\n\t.family = &fam_rzv2l,\n\t.id     = 0x8447447,\n};\n\nstatic const struct renesas_soc soc_rz_v2m __initconst __maybe_unused = {\n\t.family = &fam_rzv2m,\n};\n\nstatic const struct renesas_soc soc_rcar_m1a __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen1,\n};\n\nstatic const struct renesas_soc soc_rcar_h1 __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen1,\n\t.id\t= 0x3b,\n};\n\nstatic const struct renesas_soc soc_rcar_h2 __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen2,\n\t.id\t= 0x45,\n};\n\nstatic const struct renesas_soc soc_rcar_m2_w __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen2,\n\t.id\t= 0x47,\n};\n\nstatic const struct renesas_soc soc_rcar_v2h __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen2,\n\t.id\t= 0x4a,\n};\n\nstatic const struct renesas_soc soc_rcar_m2_n __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen2,\n\t.id\t= 0x4b,\n};\n\nstatic const struct renesas_soc soc_rcar_e2 __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen2,\n\t.id\t= 0x4c,\n};\n\nstatic const struct renesas_soc soc_rcar_h3 __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen3,\n\t.id\t= 0x4f,\n};\n\nstatic const struct renesas_soc soc_rcar_m3_w __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen3,\n\t.id\t= 0x52,\n};\n\nstatic const struct renesas_soc soc_rcar_m3_n __initconst __maybe_unused = {\n\t.family = &fam_rcar_gen3,\n\t.id     = 0x55,\n};\n\nstatic const struct renesas_soc soc_rcar_v3m __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen3,\n\t.id\t= 0x54,\n};\n\nstatic const struct renesas_soc soc_rcar_v3h __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen3,\n\t.id\t= 0x56,\n};\n\nstatic const struct renesas_soc soc_rcar_e3 __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen3,\n\t.id\t= 0x57,\n};\n\nstatic const struct renesas_soc soc_rcar_d3 __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen3,\n\t.id\t= 0x58,\n};\n\nstatic const struct renesas_soc soc_rcar_v3u __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen4,\n\t.id\t= 0x59,\n};\n\nstatic const struct renesas_soc soc_rcar_s4 __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen4,\n\t.id\t= 0x5a,\n};\n\nstatic const struct renesas_soc soc_rcar_v4h __initconst __maybe_unused = {\n\t.family\t= &fam_rcar_gen4,\n\t.id\t= 0x5c,\n};\n\nstatic const struct renesas_soc soc_shmobile_ag5 __initconst __maybe_unused = {\n\t.family\t= &fam_shmobile,\n\t.id\t= 0x37,\n};\n\n\nstatic const struct of_device_id renesas_socs[] __initconst __maybe_unused = {\n#ifdef CONFIG_ARCH_R7S72100\n\t{ .compatible = \"renesas,r7s72100\",\t.data = &soc_rz_a1h },\n#endif\n#ifdef CONFIG_ARCH_R7S9210\n\t{ .compatible = \"renesas,r7s9210\",\t.data = &soc_rz_a2m },\n#endif\n#ifdef CONFIG_ARCH_R8A73A4\n\t{ .compatible = \"renesas,r8a73a4\",\t.data = &soc_rmobile_ape6 },\n#endif\n#ifdef CONFIG_ARCH_R8A7740\n\t{ .compatible = \"renesas,r8a7740\",\t.data = &soc_rmobile_a1 },\n#endif\n#ifdef CONFIG_ARCH_R8A7742\n\t{ .compatible = \"renesas,r8a7742\",\t.data = &soc_rz_g1h },\n#endif\n#ifdef CONFIG_ARCH_R8A7743\n\t{ .compatible = \"renesas,r8a7743\",\t.data = &soc_rz_g1m },\n#endif\n#ifdef CONFIG_ARCH_R8A7744\n\t{ .compatible = \"renesas,r8a7744\",\t.data = &soc_rz_g1n },\n#endif\n#ifdef CONFIG_ARCH_R8A7745\n\t{ .compatible = \"renesas,r8a7745\",\t.data = &soc_rz_g1e },\n#endif\n#ifdef CONFIG_ARCH_R8A77470\n\t{ .compatible = \"renesas,r8a77470\",\t.data = &soc_rz_g1c },\n#endif\n#ifdef CONFIG_ARCH_R8A774A1\n\t{ .compatible = \"renesas,r8a774a1\",\t.data = &soc_rz_g2m },\n#endif\n#ifdef CONFIG_ARCH_R8A774B1\n\t{ .compatible = \"renesas,r8a774b1\",\t.data = &soc_rz_g2n },\n#endif\n#ifdef CONFIG_ARCH_R8A774C0\n\t{ .compatible = \"renesas,r8a774c0\",\t.data = &soc_rz_g2e },\n#endif\n#ifdef CONFIG_ARCH_R8A774E1\n\t{ .compatible = \"renesas,r8a774e1\",\t.data = &soc_rz_g2h },\n#endif\n#ifdef CONFIG_ARCH_R8A7778\n\t{ .compatible = \"renesas,r8a7778\",\t.data = &soc_rcar_m1a },\n#endif\n#ifdef CONFIG_ARCH_R8A7779\n\t{ .compatible = \"renesas,r8a7779\",\t.data = &soc_rcar_h1 },\n#endif\n#ifdef CONFIG_ARCH_R8A7790\n\t{ .compatible = \"renesas,r8a7790\",\t.data = &soc_rcar_h2 },\n#endif\n#ifdef CONFIG_ARCH_R8A7791\n\t{ .compatible = \"renesas,r8a7791\",\t.data = &soc_rcar_m2_w },\n#endif\n#ifdef CONFIG_ARCH_R8A7792\n\t{ .compatible = \"renesas,r8a7792\",\t.data = &soc_rcar_v2h },\n#endif\n#ifdef CONFIG_ARCH_R8A7793\n\t{ .compatible = \"renesas,r8a7793\",\t.data = &soc_rcar_m2_n },\n#endif\n#ifdef CONFIG_ARCH_R8A7794\n\t{ .compatible = \"renesas,r8a7794\",\t.data = &soc_rcar_e2 },\n#endif\n#ifdef CONFIG_ARCH_R8A77951\n\t{ .compatible = \"renesas,r8a7795\",\t.data = &soc_rcar_h3 },\n\t{ .compatible = \"renesas,r8a779m0\",\t.data = &soc_rcar_h3 },\n\t{ .compatible = \"renesas,r8a779m1\",\t.data = &soc_rcar_h3 },\n\t{ .compatible = \"renesas,r8a779m8\",\t.data = &soc_rcar_h3 },\n\t{ .compatible = \"renesas,r8a779mb\",\t.data = &soc_rcar_h3 },\n#endif\n#ifdef CONFIG_ARCH_R8A77960\n\t{ .compatible = \"renesas,r8a7796\",\t.data = &soc_rcar_m3_w },\n#endif\n#ifdef CONFIG_ARCH_R8A77961\n\t{ .compatible = \"renesas,r8a77961\",\t.data = &soc_rcar_m3_w },\n\t{ .compatible = \"renesas,r8a779m2\",\t.data = &soc_rcar_m3_w },\n\t{ .compatible = \"renesas,r8a779m3\",\t.data = &soc_rcar_m3_w },\n#endif\n#ifdef CONFIG_ARCH_R8A77965\n\t{ .compatible = \"renesas,r8a77965\",\t.data = &soc_rcar_m3_n },\n\t{ .compatible = \"renesas,r8a779m4\",\t.data = &soc_rcar_m3_n },\n\t{ .compatible = \"renesas,r8a779m5\",\t.data = &soc_rcar_m3_n },\n#endif\n#ifdef CONFIG_ARCH_R8A77970\n\t{ .compatible = \"renesas,r8a77970\",\t.data = &soc_rcar_v3m },\n#endif\n#ifdef CONFIG_ARCH_R8A77980\n\t{ .compatible = \"renesas,r8a77980\",\t.data = &soc_rcar_v3h },\n#endif\n#ifdef CONFIG_ARCH_R8A77990\n\t{ .compatible = \"renesas,r8a77990\",\t.data = &soc_rcar_e3 },\n\t{ .compatible = \"renesas,r8a779m6\",\t.data = &soc_rcar_e3 },\n#endif\n#ifdef CONFIG_ARCH_R8A77995\n\t{ .compatible = \"renesas,r8a77995\",\t.data = &soc_rcar_d3 },\n\t{ .compatible = \"renesas,r8a779m7\",\t.data = &soc_rcar_d3 },\n#endif\n#ifdef CONFIG_ARCH_R8A779A0\n\t{ .compatible = \"renesas,r8a779a0\",\t.data = &soc_rcar_v3u },\n#endif\n#ifdef CONFIG_ARCH_R8A779F0\n\t{ .compatible = \"renesas,r8a779f0\",\t.data = &soc_rcar_s4 },\n#endif\n#ifdef CONFIG_ARCH_R8A779G0\n\t{ .compatible = \"renesas,r8a779g0\",\t.data = &soc_rcar_v4h },\n#endif\n#ifdef CONFIG_ARCH_R9A07G043\n#ifdef CONFIG_RISCV\n\t{ .compatible = \"renesas,r9a07g043\",\t.data = &soc_rz_five },\n#else\n\t{ .compatible = \"renesas,r9a07g043\",\t.data = &soc_rz_g2ul },\n#endif\n#endif\n#ifdef CONFIG_ARCH_R9A07G044\n\t{ .compatible = \"renesas,r9a07g044\",\t.data = &soc_rz_g2l },\n#endif\n#ifdef CONFIG_ARCH_R9A07G054\n\t{ .compatible = \"renesas,r9a07g054\",\t.data = &soc_rz_v2l },\n#endif\n#ifdef CONFIG_ARCH_R9A09G011\n\t{ .compatible = \"renesas,r9a09g011\",\t.data = &soc_rz_v2m },\n#endif\n#ifdef CONFIG_ARCH_SH73A0\n\t{ .compatible = \"renesas,sh73a0\",\t.data = &soc_shmobile_ag5 },\n#endif\n\t{   }\n};\n\nstruct renesas_id {\n\tunsigned int offset;\n\tu32 mask;\n};\n\nstatic const struct renesas_id id_bsid __initconst = {\n\t.offset = 0,\n\t.mask = 0xff0000,\n\t \n};\n\nstatic const struct renesas_id id_rzg2l __initconst = {\n\t.offset = 0xa04,\n\t.mask = 0xfffffff,\n};\n\nstatic const struct renesas_id id_rzv2m __initconst = {\n\t.offset = 0x104,\n\t.mask = 0xff,\n};\n\nstatic const struct renesas_id id_prr __initconst = {\n\t.offset = 0,\n\t.mask = 0xff00,\n};\n\nstatic const struct of_device_id renesas_ids[] __initconst = {\n\t{ .compatible = \"renesas,bsid\",\t\t\t.data = &id_bsid },\n\t{ .compatible = \"renesas,r9a07g043-sysc\",\t.data = &id_rzg2l },\n\t{ .compatible = \"renesas,r9a07g044-sysc\",\t.data = &id_rzg2l },\n\t{ .compatible = \"renesas,r9a07g054-sysc\",\t.data = &id_rzg2l },\n\t{ .compatible = \"renesas,r9a09g011-sys\",\t.data = &id_rzv2m },\n\t{ .compatible = \"renesas,prr\",\t\t\t.data = &id_prr },\n\t{   }\n};\n\nstatic int __init renesas_soc_init(void)\n{\n\tstruct soc_device_attribute *soc_dev_attr;\n\tunsigned int product, eshi = 0, eslo;\n\tconst struct renesas_family *family;\n\tconst struct of_device_id *match;\n\tconst struct renesas_soc *soc;\n\tconst struct renesas_id *id;\n\tvoid __iomem *chipid = NULL;\n\tconst char *rev_prefix = \"\";\n\tstruct soc_device *soc_dev;\n\tstruct device_node *np;\n\tconst char *soc_id;\n\tint ret;\n\n\tmatch = of_match_node(renesas_socs, of_root);\n\tif (!match)\n\t\treturn -ENODEV;\n\n\tsoc_id = strchr(match->compatible, ',') + 1;\n\tsoc = match->data;\n\tfamily = soc->family;\n\n\tnp = of_find_matching_node_and_match(NULL, renesas_ids, &match);\n\tif (np) {\n\t\tid = match->data;\n\t\tchipid = of_iomap(np, 0);\n\t\tof_node_put(np);\n\t} else if (soc->id && family->reg) {\n\t\t \n\t\tid = &id_prr;\n\t\tchipid = ioremap(family->reg, 4);\n\t}\n\n\tsoc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);\n\tif (!soc_dev_attr) {\n\t\tif (chipid)\n\t\t\tiounmap(chipid);\n\t\treturn -ENOMEM;\n\t}\n\n\tnp = of_find_node_by_path(\"/\");\n\tof_property_read_string(np, \"model\", &soc_dev_attr->machine);\n\tof_node_put(np);\n\n\tsoc_dev_attr->family = kstrdup_const(family->name, GFP_KERNEL);\n\tsoc_dev_attr->soc_id = kstrdup_const(soc_id, GFP_KERNEL);\n\n\tif (chipid) {\n\t\tproduct = readl(chipid + id->offset);\n\t\tiounmap(chipid);\n\n\t\tif (id == &id_prr) {\n\t\t\t \n\t\t\tif ((product & 0x7fff) == 0x5210)\n\t\t\t\tproduct ^= 0x11;\n\t\t\t \n\t\t\tif ((product & 0x7fff) == 0x5211)\n\t\t\t\tproduct ^= 0x12;\n\n\t\t\teshi = ((product >> 4) & 0x0f) + 1;\n\t\t\teslo = product & 0xf;\n\t\t\tsoc_dev_attr->revision = kasprintf(GFP_KERNEL, \"ES%u.%u\",\n\t\t\t\t\t\t\t   eshi, eslo);\n\t\t}  else if (id == &id_rzg2l) {\n\t\t\teshi =  ((product >> 28) & 0x0f);\n\t\t\tsoc_dev_attr->revision = kasprintf(GFP_KERNEL, \"%u\",\n\t\t\t\t\t\t\t   eshi);\n\t\t\trev_prefix = \"Rev \";\n\t\t} else if (id == &id_rzv2m) {\n\t\t\teshi = ((product >> 4) & 0x0f);\n\t\t\teslo = product & 0xf;\n\t\t\tsoc_dev_attr->revision = kasprintf(GFP_KERNEL, \"%u.%u\",\n\t\t\t\t\t\t\t   eshi, eslo);\n\t\t}\n\n\t\tif (soc->id &&\n\t\t    ((product & id->mask) >> __ffs(id->mask)) != soc->id) {\n\t\t\tpr_warn(\"SoC mismatch (product = 0x%x)\\n\", product);\n\t\t\tret = -ENODEV;\n\t\t\tgoto free_soc_dev_attr;\n\t\t}\n\t}\n\n\tpr_info(\"Detected Renesas %s %s %s%s\\n\", soc_dev_attr->family,\n\t\tsoc_dev_attr->soc_id, rev_prefix, soc_dev_attr->revision ?: \"\");\n\n\tsoc_dev = soc_device_register(soc_dev_attr);\n\tif (IS_ERR(soc_dev)) {\n\t\tret = PTR_ERR(soc_dev);\n\t\tgoto free_soc_dev_attr;\n\t}\n\n\treturn 0;\n\nfree_soc_dev_attr:\n\tkfree(soc_dev_attr->revision);\n\tkfree_const(soc_dev_attr->soc_id);\n\tkfree_const(soc_dev_attr->family);\n\tkfree(soc_dev_attr);\n\treturn ret;\n}\nearly_initcall(renesas_soc_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}