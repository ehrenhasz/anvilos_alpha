{
  "module_name": "rcar-rst.c",
  "hash_id": "2b8aab031b625ba3e2643deb25613aacb95087bfcb91b1b23730e4ea256e5579",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/renesas/rcar-rst.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/io.h>\n#include <linux/of_address.h>\n#include <linux/soc/renesas/rcar-rst.h>\n\n#define WDTRSTCR_RESET\t\t0xA55A0002\n#define WDTRSTCR\t\t0x0054\n#define GEN4_WDTRSTCR\t\t0x0010\n\n#define CR7BAR\t\t\t0x0070\n#define CR7BAREN\t\tBIT(4)\n#define CR7BAR_MASK\t\t0xFFFC0000\n\nstatic void __iomem *rcar_rst_base;\nstatic u32 saved_mode __initdata;\nstatic int (*rcar_rst_set_rproc_boot_addr_func)(u64 boot_addr);\n\nstatic int rcar_rst_enable_wdt_reset(void __iomem *base)\n{\n\tiowrite32(WDTRSTCR_RESET, base + WDTRSTCR);\n\treturn 0;\n}\n\nstatic int rcar_rst_v3u_enable_wdt_reset(void __iomem *base)\n{\n\tiowrite32(WDTRSTCR_RESET, base + GEN4_WDTRSTCR);\n\treturn 0;\n}\n\n \nstatic int rcar_rst_set_gen3_rproc_boot_addr(u64 boot_addr)\n{\n\tif (boot_addr & ~(u64)CR7BAR_MASK) {\n\t\tpr_err(\"Invalid boot address got %llx\\n\", boot_addr);\n\t\treturn -EINVAL;\n\t}\n\n\tiowrite32(boot_addr, rcar_rst_base + CR7BAR);\n\tiowrite32(boot_addr | CR7BAREN, rcar_rst_base + CR7BAR);\n\n\treturn 0;\n}\n\nstruct rst_config {\n\tunsigned int modemr;\t\t \n\tint (*configure)(void __iomem *base);\t \n\tint (*set_rproc_boot_addr)(u64 boot_addr);\n};\n\nstatic const struct rst_config rcar_rst_gen1 __initconst = {\n\t.modemr = 0x20,\n};\n\nstatic const struct rst_config rcar_rst_gen2 __initconst = {\n\t.modemr = 0x60,\n\t.configure = rcar_rst_enable_wdt_reset,\n};\n\nstatic const struct rst_config rcar_rst_gen3 __initconst = {\n\t.modemr = 0x60,\n\t.set_rproc_boot_addr = rcar_rst_set_gen3_rproc_boot_addr,\n};\n\n \nstatic const struct rst_config rcar_rst_v3u __initconst = {\n\t.modemr = 0x00,\t\t \n\t.configure = rcar_rst_v3u_enable_wdt_reset,\n};\n\nstatic const struct rst_config rcar_rst_gen4 __initconst = {\n\t.modemr = 0x00,\t\t \n};\n\nstatic const struct of_device_id rcar_rst_matches[] __initconst = {\n\t \n\t{ .compatible = \"renesas,r8a7742-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a7743-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a7744-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a7745-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a77470-rst\", .data = &rcar_rst_gen2 },\n\t \n\t{ .compatible = \"renesas,r8a774a1-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a774b1-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a774c0-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a774e1-rst\", .data = &rcar_rst_gen3 },\n\t \n\t{ .compatible = \"renesas,r8a7778-reset-wdt\", .data = &rcar_rst_gen1 },\n\t{ .compatible = \"renesas,r8a7779-reset-wdt\", .data = &rcar_rst_gen1 },\n\t \n\t{ .compatible = \"renesas,r8a7790-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a7791-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a7792-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a7793-rst\", .data = &rcar_rst_gen2 },\n\t{ .compatible = \"renesas,r8a7794-rst\", .data = &rcar_rst_gen2 },\n\t \n\t{ .compatible = \"renesas,r8a7795-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a7796-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a77961-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a77965-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a77970-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a77980-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a77990-rst\", .data = &rcar_rst_gen3 },\n\t{ .compatible = \"renesas,r8a77995-rst\", .data = &rcar_rst_gen3 },\n\t \n\t{ .compatible = \"renesas,r8a779a0-rst\", .data = &rcar_rst_v3u },\n\t{ .compatible = \"renesas,r8a779f0-rst\", .data = &rcar_rst_gen4 },\n\t{ .compatible = \"renesas,r8a779g0-rst\", .data = &rcar_rst_gen4 },\n\t{   }\n};\n\nstatic int __init rcar_rst_init(void)\n{\n\tconst struct of_device_id *match;\n\tconst struct rst_config *cfg;\n\tstruct device_node *np;\n\tvoid __iomem *base;\n\tint error = 0;\n\n\tnp = of_find_matching_node_and_match(NULL, rcar_rst_matches, &match);\n\tif (!np)\n\t\treturn -ENODEV;\n\n\tbase = of_iomap(np, 0);\n\tif (!base) {\n\t\tpr_warn(\"%pOF: Cannot map regs\\n\", np);\n\t\terror = -ENOMEM;\n\t\tgoto out_put;\n\t}\n\n\trcar_rst_base = base;\n\tcfg = match->data;\n\trcar_rst_set_rproc_boot_addr_func = cfg->set_rproc_boot_addr;\n\n\tsaved_mode = ioread32(base + cfg->modemr);\n\tif (cfg->configure) {\n\t\terror = cfg->configure(base);\n\t\tif (error) {\n\t\t\tpr_warn(\"%pOF: Cannot run SoC specific configuration\\n\",\n\t\t\t\tnp);\n\t\t\tgoto out_put;\n\t\t}\n\t}\n\n\tpr_debug(\"%pOF: MODE = 0x%08x\\n\", np, saved_mode);\n\nout_put:\n\tof_node_put(np);\n\treturn error;\n}\n\nint __init rcar_rst_read_mode_pins(u32 *mode)\n{\n\tint error;\n\n\tif (!rcar_rst_base) {\n\t\terror = rcar_rst_init();\n\t\tif (error)\n\t\t\treturn error;\n\t}\n\n\t*mode = saved_mode;\n\treturn 0;\n}\n\nint rcar_rst_set_rproc_boot_addr(u64 boot_addr)\n{\n\tif (!rcar_rst_set_rproc_boot_addr_func)\n\t\treturn -EIO;\n\n\treturn rcar_rst_set_rproc_boot_addr_func(boot_addr);\n}\nEXPORT_SYMBOL_GPL(rcar_rst_set_rproc_boot_addr);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}