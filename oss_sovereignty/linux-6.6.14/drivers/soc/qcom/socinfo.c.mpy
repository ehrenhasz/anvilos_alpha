{
  "module_name": "socinfo.c",
  "hash_id": "129ef0a824e478a74a23e3e227b76f14521cd07ad1bd0ca4a5f906bc11821a6e",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/qcom/socinfo.c",
  "human_readable_source": "\n \n\n#include <linux/debugfs.h>\n#include <linux/err.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n#include <linux/random.h>\n#include <linux/slab.h>\n#include <linux/soc/qcom/smem.h>\n#include <linux/soc/qcom/socinfo.h>\n#include <linux/string.h>\n#include <linux/stringify.h>\n#include <linux/sys_soc.h>\n#include <linux/types.h>\n\n#include <asm/unaligned.h>\n\n#include <dt-bindings/arm/qcom,ids.h>\n\n \n#define SOCINFO_MAJOR(ver) (((ver) >> 16) & 0xffff)\n#define SOCINFO_MINOR(ver) ((ver) & 0xffff)\n#define SOCINFO_VERSION(maj, min)  ((((maj) & 0xffff) << 16)|((min) & 0xffff))\n\n \n#define qcom_board_id(id) QCOM_ID_ ## id, __stringify(id)\n#define qcom_board_id_named(id, name) QCOM_ID_ ## id, (name)\n\n#ifdef CONFIG_DEBUG_FS\n#define SMEM_IMAGE_VERSION_BLOCKS_COUNT        32\n#define SMEM_IMAGE_VERSION_SIZE                4096\n#define SMEM_IMAGE_VERSION_NAME_SIZE           75\n#define SMEM_IMAGE_VERSION_VARIANT_SIZE        20\n#define SMEM_IMAGE_VERSION_OEM_SIZE            32\n\n \n#define SMEM_IMAGE_TABLE_BOOT_INDEX     0\n#define SMEM_IMAGE_TABLE_TZ_INDEX       1\n#define SMEM_IMAGE_TABLE_RPM_INDEX      3\n#define SMEM_IMAGE_TABLE_APPS_INDEX     10\n#define SMEM_IMAGE_TABLE_MPSS_INDEX     11\n#define SMEM_IMAGE_TABLE_ADSP_INDEX     12\n#define SMEM_IMAGE_TABLE_CNSS_INDEX     13\n#define SMEM_IMAGE_TABLE_VIDEO_INDEX    14\n#define SMEM_IMAGE_VERSION_TABLE       469\n\n \nstatic const char *const socinfo_image_names[] = {\n\t[SMEM_IMAGE_TABLE_ADSP_INDEX] = \"adsp\",\n\t[SMEM_IMAGE_TABLE_APPS_INDEX] = \"apps\",\n\t[SMEM_IMAGE_TABLE_BOOT_INDEX] = \"boot\",\n\t[SMEM_IMAGE_TABLE_CNSS_INDEX] = \"cnss\",\n\t[SMEM_IMAGE_TABLE_MPSS_INDEX] = \"mpss\",\n\t[SMEM_IMAGE_TABLE_RPM_INDEX] = \"rpm\",\n\t[SMEM_IMAGE_TABLE_TZ_INDEX] = \"tz\",\n\t[SMEM_IMAGE_TABLE_VIDEO_INDEX] = \"video\",\n};\n\nstatic const char *const pmic_models[] = {\n\t[0]  = \"Unknown PMIC model\",\n\t[1]  = \"PM8941\",\n\t[2]  = \"PM8841\",\n\t[3]  = \"PM8019\",\n\t[4]  = \"PM8226\",\n\t[5]  = \"PM8110\",\n\t[6]  = \"PMA8084\",\n\t[7]  = \"PMI8962\",\n\t[8]  = \"PMD9635\",\n\t[9]  = \"PM8994\",\n\t[10] = \"PMI8994\",\n\t[11] = \"PM8916\",\n\t[12] = \"PM8004\",\n\t[13] = \"PM8909/PM8058\",\n\t[14] = \"PM8028\",\n\t[15] = \"PM8901\",\n\t[16] = \"PM8950/PM8027\",\n\t[17] = \"PMI8950/ISL9519\",\n\t[18] = \"PMK8001/PM8921\",\n\t[19] = \"PMI8996/PM8018\",\n\t[20] = \"PM8998/PM8015\",\n\t[21] = \"PMI8998/PM8014\",\n\t[22] = \"PM8821\",\n\t[23] = \"PM8038\",\n\t[24] = \"PM8005/PM8922\",\n\t[25] = \"PM8917\",\n\t[26] = \"PM660L\",\n\t[27] = \"PM660\",\n\t[30] = \"PM8150\",\n\t[31] = \"PM8150L\",\n\t[32] = \"PM8150B\",\n\t[33] = \"PMK8002\",\n\t[36] = \"PM8009\",\n\t[37] = \"PMI632\",\n\t[38] = \"PM8150C\",\n\t[40] = \"PM6150\",\n\t[41] = \"SMB2351\",\n\t[44] = \"PM8008\",\n\t[45] = \"PM6125\",\n\t[46] = \"PM7250B\",\n\t[47] = \"PMK8350\",\n\t[48] = \"PM8350\",\n\t[49] = \"PM8350C\",\n\t[50] = \"PM8350B\",\n\t[51] = \"PMR735A\",\n\t[52] = \"PMR735B\",\n\t[55] = \"PM2250\",\n\t[58] = \"PM8450\",\n\t[65] = \"PM8010\",\n};\n\nstruct socinfo_params {\n\tu32 raw_device_family;\n\tu32 hw_plat_subtype;\n\tu32 accessory_chip;\n\tu32 raw_device_num;\n\tu32 chip_family;\n\tu32 foundry_id;\n\tu32 plat_ver;\n\tu32 raw_ver;\n\tu32 hw_plat;\n\tu32 fmt;\n\tu32 nproduct_id;\n\tu32 num_clusters;\n\tu32 ncluster_array_offset;\n\tu32 num_subset_parts;\n\tu32 nsubset_parts_array_offset;\n\tu32 nmodem_supported;\n\tu32 feature_code;\n\tu32 pcode;\n\tu32 oem_variant;\n\tu32 num_func_clusters;\n\tu32 boot_cluster;\n\tu32 boot_core;\n};\n\nstruct smem_image_version {\n\tchar name[SMEM_IMAGE_VERSION_NAME_SIZE];\n\tchar variant[SMEM_IMAGE_VERSION_VARIANT_SIZE];\n\tchar pad;\n\tchar oem[SMEM_IMAGE_VERSION_OEM_SIZE];\n};\n#endif  \n\nstruct qcom_socinfo {\n\tstruct soc_device *soc_dev;\n\tstruct soc_device_attribute attr;\n#ifdef CONFIG_DEBUG_FS\n\tstruct dentry *dbg_root;\n\tstruct socinfo_params info;\n#endif  \n};\n\nstruct soc_id {\n\tunsigned int id;\n\tconst char *name;\n};\n\nstatic const struct soc_id soc_id[] = {\n\t{ qcom_board_id(MSM8260) },\n\t{ qcom_board_id(MSM8660) },\n\t{ qcom_board_id(APQ8060) },\n\t{ qcom_board_id(MSM8960) },\n\t{ qcom_board_id(APQ8064) },\n\t{ qcom_board_id(MSM8930) },\n\t{ qcom_board_id(MSM8630) },\n\t{ qcom_board_id(MSM8230) },\n\t{ qcom_board_id(APQ8030) },\n\t{ qcom_board_id(MSM8627) },\n\t{ qcom_board_id(MSM8227) },\n\t{ qcom_board_id(MSM8660A) },\n\t{ qcom_board_id(MSM8260A) },\n\t{ qcom_board_id(APQ8060A) },\n\t{ qcom_board_id(MSM8974) },\n\t{ qcom_board_id(MSM8225) },\n\t{ qcom_board_id(MSM8625) },\n\t{ qcom_board_id(MPQ8064) },\n\t{ qcom_board_id(MSM8960AB) },\n\t{ qcom_board_id(APQ8060AB) },\n\t{ qcom_board_id(MSM8260AB) },\n\t{ qcom_board_id(MSM8660AB) },\n\t{ qcom_board_id(MSM8930AA) },\n\t{ qcom_board_id(MSM8630AA) },\n\t{ qcom_board_id(MSM8230AA) },\n\t{ qcom_board_id(MSM8626) },\n\t{ qcom_board_id(MSM8610) },\n\t{ qcom_board_id(APQ8064AB) },\n\t{ qcom_board_id(MSM8930AB) },\n\t{ qcom_board_id(MSM8630AB) },\n\t{ qcom_board_id(MSM8230AB) },\n\t{ qcom_board_id(APQ8030AB) },\n\t{ qcom_board_id(MSM8226) },\n\t{ qcom_board_id(MSM8526) },\n\t{ qcom_board_id(APQ8030AA) },\n\t{ qcom_board_id(MSM8110) },\n\t{ qcom_board_id(MSM8210) },\n\t{ qcom_board_id(MSM8810) },\n\t{ qcom_board_id(MSM8212) },\n\t{ qcom_board_id(MSM8612) },\n\t{ qcom_board_id(MSM8112) },\n\t{ qcom_board_id(MSM8125) },\n\t{ qcom_board_id(MSM8225Q) },\n\t{ qcom_board_id(MSM8625Q) },\n\t{ qcom_board_id(MSM8125Q) },\n\t{ qcom_board_id(APQ8064AA) },\n\t{ qcom_board_id(APQ8084) },\n\t{ qcom_board_id(MSM8130) },\n\t{ qcom_board_id(MSM8130AA) },\n\t{ qcom_board_id(MSM8130AB) },\n\t{ qcom_board_id(MSM8627AA) },\n\t{ qcom_board_id(MSM8227AA) },\n\t{ qcom_board_id(APQ8074) },\n\t{ qcom_board_id(MSM8274) },\n\t{ qcom_board_id(MSM8674) },\n\t{ qcom_board_id(MDM9635) },\n\t{ qcom_board_id_named(MSM8974PRO_AC, \"MSM8974PRO-AC\") },\n\t{ qcom_board_id(MSM8126) },\n\t{ qcom_board_id(APQ8026) },\n\t{ qcom_board_id(MSM8926) },\n\t{ qcom_board_id(IPQ8062) },\n\t{ qcom_board_id(IPQ8064) },\n\t{ qcom_board_id(IPQ8066) },\n\t{ qcom_board_id(IPQ8068) },\n\t{ qcom_board_id(MSM8326) },\n\t{ qcom_board_id(MSM8916) },\n\t{ qcom_board_id(MSM8994) },\n\t{ qcom_board_id_named(APQ8074PRO_AA, \"APQ8074PRO-AA\") },\n\t{ qcom_board_id_named(APQ8074PRO_AB, \"APQ8074PRO-AB\") },\n\t{ qcom_board_id_named(APQ8074PRO_AC, \"APQ8074PRO-AC\") },\n\t{ qcom_board_id_named(MSM8274PRO_AA, \"MSM8274PRO-AA\") },\n\t{ qcom_board_id_named(MSM8274PRO_AB, \"MSM8274PRO-AB\") },\n\t{ qcom_board_id_named(MSM8274PRO_AC, \"MSM8274PRO-AC\") },\n\t{ qcom_board_id_named(MSM8674PRO_AA, \"MSM8674PRO-AA\") },\n\t{ qcom_board_id_named(MSM8674PRO_AB, \"MSM8674PRO-AB\") },\n\t{ qcom_board_id_named(MSM8674PRO_AC, \"MSM8674PRO-AC\") },\n\t{ qcom_board_id_named(MSM8974PRO_AA, \"MSM8974PRO-AA\") },\n\t{ qcom_board_id_named(MSM8974PRO_AB, \"MSM8974PRO-AB\") },\n\t{ qcom_board_id(APQ8028) },\n\t{ qcom_board_id(MSM8128) },\n\t{ qcom_board_id(MSM8228) },\n\t{ qcom_board_id(MSM8528) },\n\t{ qcom_board_id(MSM8628) },\n\t{ qcom_board_id(MSM8928) },\n\t{ qcom_board_id(MSM8510) },\n\t{ qcom_board_id(MSM8512) },\n\t{ qcom_board_id(MSM8936) },\n\t{ qcom_board_id(MDM9640) },\n\t{ qcom_board_id(MSM8939) },\n\t{ qcom_board_id(APQ8036) },\n\t{ qcom_board_id(APQ8039) },\n\t{ qcom_board_id(MSM8236) },\n\t{ qcom_board_id(MSM8636) },\n\t{ qcom_board_id(MSM8909) },\n\t{ qcom_board_id(MSM8996) },\n\t{ qcom_board_id(APQ8016) },\n\t{ qcom_board_id(MSM8216) },\n\t{ qcom_board_id(MSM8116) },\n\t{ qcom_board_id(MSM8616) },\n\t{ qcom_board_id(MSM8992) },\n\t{ qcom_board_id(APQ8092) },\n\t{ qcom_board_id(APQ8094) },\n\t{ qcom_board_id(MSM8209) },\n\t{ qcom_board_id(MSM8208) },\n\t{ qcom_board_id(MDM9209) },\n\t{ qcom_board_id(MDM9309) },\n\t{ qcom_board_id(MDM9609) },\n\t{ qcom_board_id(MSM8239) },\n\t{ qcom_board_id(MSM8952) },\n\t{ qcom_board_id(APQ8009) },\n\t{ qcom_board_id(MSM8956) },\n\t{ qcom_board_id(MSM8929) },\n\t{ qcom_board_id(MSM8629) },\n\t{ qcom_board_id(MSM8229) },\n\t{ qcom_board_id(APQ8029) },\n\t{ qcom_board_id(APQ8056) },\n\t{ qcom_board_id(MSM8609) },\n\t{ qcom_board_id(APQ8076) },\n\t{ qcom_board_id(MSM8976) },\n\t{ qcom_board_id(IPQ8065) },\n\t{ qcom_board_id(IPQ8069) },\n\t{ qcom_board_id(MDM9650) },\n\t{ qcom_board_id(MDM9655) },\n\t{ qcom_board_id(MDM9250) },\n\t{ qcom_board_id(MDM9255) },\n\t{ qcom_board_id(MDM9350) },\n\t{ qcom_board_id(APQ8052) },\n\t{ qcom_board_id(MDM9607) },\n\t{ qcom_board_id(APQ8096) },\n\t{ qcom_board_id(MSM8998) },\n\t{ qcom_board_id(MSM8953) },\n\t{ qcom_board_id(MSM8937) },\n\t{ qcom_board_id(APQ8037) },\n\t{ qcom_board_id(MDM8207) },\n\t{ qcom_board_id(MDM9207) },\n\t{ qcom_board_id(MDM9307) },\n\t{ qcom_board_id(MDM9628) },\n\t{ qcom_board_id(MSM8909W) },\n\t{ qcom_board_id(APQ8009W) },\n\t{ qcom_board_id(MSM8996L) },\n\t{ qcom_board_id(MSM8917) },\n\t{ qcom_board_id(APQ8053) },\n\t{ qcom_board_id(MSM8996SG) },\n\t{ qcom_board_id(APQ8017) },\n\t{ qcom_board_id(MSM8217) },\n\t{ qcom_board_id(MSM8617) },\n\t{ qcom_board_id(MSM8996AU) },\n\t{ qcom_board_id(APQ8096AU) },\n\t{ qcom_board_id(APQ8096SG) },\n\t{ qcom_board_id(MSM8940) },\n\t{ qcom_board_id(SDX201) },\n\t{ qcom_board_id(SDM660) },\n\t{ qcom_board_id(SDM630) },\n\t{ qcom_board_id(APQ8098) },\n\t{ qcom_board_id(MSM8920) },\n\t{ qcom_board_id(SDM845) },\n\t{ qcom_board_id(MDM9206) },\n\t{ qcom_board_id(IPQ8074) },\n\t{ qcom_board_id(SDA660) },\n\t{ qcom_board_id(SDM658) },\n\t{ qcom_board_id(SDA658) },\n\t{ qcom_board_id(SDA630) },\n\t{ qcom_board_id(MSM8905) },\n\t{ qcom_board_id(SDX202) },\n\t{ qcom_board_id(SDM450) },\n\t{ qcom_board_id(SM8150) },\n\t{ qcom_board_id(SDA845) },\n\t{ qcom_board_id(IPQ8072) },\n\t{ qcom_board_id(IPQ8076) },\n\t{ qcom_board_id(IPQ8078) },\n\t{ qcom_board_id(SDM636) },\n\t{ qcom_board_id(SDA636) },\n\t{ qcom_board_id(SDM632) },\n\t{ qcom_board_id(SDA632) },\n\t{ qcom_board_id(SDA450) },\n\t{ qcom_board_id(SDM439) },\n\t{ qcom_board_id(SDM429) },\n\t{ qcom_board_id(SM8250) },\n\t{ qcom_board_id(SA8155) },\n\t{ qcom_board_id(SDA439) },\n\t{ qcom_board_id(SDA429) },\n\t{ qcom_board_id(SM7150) },\n\t{ qcom_board_id(IPQ8070) },\n\t{ qcom_board_id(IPQ8071) },\n\t{ qcom_board_id(QM215) },\n\t{ qcom_board_id(IPQ8072A) },\n\t{ qcom_board_id(IPQ8074A) },\n\t{ qcom_board_id(IPQ8076A) },\n\t{ qcom_board_id(IPQ8078A) },\n\t{ qcom_board_id(SM6125) },\n\t{ qcom_board_id(IPQ8070A) },\n\t{ qcom_board_id(IPQ8071A) },\n\t{ qcom_board_id(IPQ6018) },\n\t{ qcom_board_id(IPQ6028) },\n\t{ qcom_board_id(SDM429W) },\n\t{ qcom_board_id(SM4250) },\n\t{ qcom_board_id(IPQ6000) },\n\t{ qcom_board_id(IPQ6010) },\n\t{ qcom_board_id(SC7180) },\n\t{ qcom_board_id(SM6350) },\n\t{ qcom_board_id(QCM2150) },\n\t{ qcom_board_id(SDA429W) },\n\t{ qcom_board_id(SM8350) },\n\t{ qcom_board_id(QCM2290) },\n\t{ qcom_board_id(SM7125) },\n\t{ qcom_board_id(SM6115) },\n\t{ qcom_board_id(IPQ5010) },\n\t{ qcom_board_id(IPQ5018) },\n\t{ qcom_board_id(IPQ5028) },\n\t{ qcom_board_id(SC8280XP) },\n\t{ qcom_board_id(IPQ6005) },\n\t{ qcom_board_id(QRB5165) },\n\t{ qcom_board_id(SM8450) },\n\t{ qcom_board_id(SM7225) },\n\t{ qcom_board_id(SA8295P) },\n\t{ qcom_board_id(SA8540P) },\n\t{ qcom_board_id(QCM4290) },\n\t{ qcom_board_id(QCS4290) },\n\t{ qcom_board_id_named(SM8450_2, \"SM8450\") },\n\t{ qcom_board_id_named(SM8450_3, \"SM8450\") },\n\t{ qcom_board_id(SC7280) },\n\t{ qcom_board_id(SC7180P) },\n\t{ qcom_board_id(IPQ5000) },\n\t{ qcom_board_id(IPQ0509) },\n\t{ qcom_board_id(IPQ0518) },\n\t{ qcom_board_id(SM6375) },\n\t{ qcom_board_id(IPQ9514) },\n\t{ qcom_board_id(IPQ9550) },\n\t{ qcom_board_id(IPQ9554) },\n\t{ qcom_board_id(IPQ9570) },\n\t{ qcom_board_id(IPQ9574) },\n\t{ qcom_board_id(SM8550) },\n\t{ qcom_board_id(IPQ5016) },\n\t{ qcom_board_id(IPQ9510) },\n\t{ qcom_board_id(QRB4210) },\n\t{ qcom_board_id(QRB2210) },\n\t{ qcom_board_id(SA8775P) },\n\t{ qcom_board_id(QRU1000) },\n\t{ qcom_board_id(QDU1000) },\n\t{ qcom_board_id(SM4450) },\n\t{ qcom_board_id(QDU1010) },\n\t{ qcom_board_id(QRU1032) },\n\t{ qcom_board_id(QRU1052) },\n\t{ qcom_board_id(QRU1062) },\n\t{ qcom_board_id(IPQ5332) },\n\t{ qcom_board_id(IPQ5322) },\n\t{ qcom_board_id(IPQ5312) },\n\t{ qcom_board_id(IPQ5302) },\n\t{ qcom_board_id(IPQ5300) },\n};\n\nstatic const char *socinfo_machine(struct device *dev, unsigned int id)\n{\n\tint idx;\n\n\tfor (idx = 0; idx < ARRAY_SIZE(soc_id); idx++) {\n\t\tif (soc_id[idx].id == id)\n\t\t\treturn soc_id[idx].name;\n\t}\n\n\treturn NULL;\n}\n\n#ifdef CONFIG_DEBUG_FS\n\n#define QCOM_OPEN(name, _func)\t\t\t\t\t\t\\\nstatic int qcom_open_##name(struct inode *inode, struct file *file)\t\\\n{\t\t\t\t\t\t\t\t\t\\\n\treturn single_open(file, _func, inode->i_private);\t\t\\\n}\t\t\t\t\t\t\t\t\t\\\n\t\t\t\t\t\t\t\t\t\\\nstatic const struct file_operations qcom_ ##name## _ops = {\t\t\\\n\t.open = qcom_open_##name,\t\t\t\t\t\\\n\t.read = seq_read,\t\t\t\t\t\t\\\n\t.llseek = seq_lseek,\t\t\t\t\t\t\\\n\t.release = single_release,\t\t\t\t\t\\\n}\n\n#define DEBUGFS_ADD(info, name)\t\t\t\t\t\t\\\n\tdebugfs_create_file(__stringify(name), 0444,\t\t\t\\\n\t\t\t    qcom_socinfo->dbg_root,\t\t\t\\\n\t\t\t    info, &qcom_ ##name## _ops)\n\n\nstatic int qcom_show_build_id(struct seq_file *seq, void *p)\n{\n\tstruct socinfo *socinfo = seq->private;\n\n\tseq_printf(seq, \"%s\\n\", socinfo->build_id);\n\n\treturn 0;\n}\n\nstatic int qcom_show_pmic_model(struct seq_file *seq, void *p)\n{\n\tstruct socinfo *socinfo = seq->private;\n\tint model = SOCINFO_MINOR(le32_to_cpu(socinfo->pmic_model));\n\n\tif (model < 0)\n\t\treturn -EINVAL;\n\n\tif (model < ARRAY_SIZE(pmic_models) && pmic_models[model])\n\t\tseq_printf(seq, \"%s\\n\", pmic_models[model]);\n\telse\n\t\tseq_printf(seq, \"unknown (%d)\\n\", model);\n\n\treturn 0;\n}\n\nstatic int qcom_show_pmic_model_array(struct seq_file *seq, void *p)\n{\n\tstruct socinfo *socinfo = seq->private;\n\tunsigned int num_pmics = le32_to_cpu(socinfo->num_pmics);\n\tunsigned int pmic_array_offset = le32_to_cpu(socinfo->pmic_array_offset);\n\tint i;\n\tvoid *ptr = socinfo;\n\n\tptr += pmic_array_offset;\n\n\t \n\tfor (i = 0; i < num_pmics; i++) {\n\t\tunsigned int model = SOCINFO_MINOR(get_unaligned_le32(ptr + 2 * i * sizeof(u32)));\n\t\tunsigned int die_rev = get_unaligned_le32(ptr + (2 * i + 1) * sizeof(u32));\n\n\t\tif (model < ARRAY_SIZE(pmic_models) && pmic_models[model])\n\t\t\tseq_printf(seq, \"%s %u.%u\\n\", pmic_models[model],\n\t\t\t\t   SOCINFO_MAJOR(die_rev),\n\t\t\t\t   SOCINFO_MINOR(die_rev));\n\t\telse\n\t\t\tseq_printf(seq, \"unknown (%d)\\n\", model);\n\t}\n\n\treturn 0;\n}\n\nstatic int qcom_show_pmic_die_revision(struct seq_file *seq, void *p)\n{\n\tstruct socinfo *socinfo = seq->private;\n\n\tseq_printf(seq, \"%u.%u\\n\",\n\t\t   SOCINFO_MAJOR(le32_to_cpu(socinfo->pmic_die_rev)),\n\t\t   SOCINFO_MINOR(le32_to_cpu(socinfo->pmic_die_rev)));\n\n\treturn 0;\n}\n\nstatic int qcom_show_chip_id(struct seq_file *seq, void *p)\n{\n\tstruct socinfo *socinfo = seq->private;\n\n\tseq_printf(seq, \"%s\\n\", socinfo->chip_id);\n\n\treturn 0;\n}\n\nQCOM_OPEN(build_id, qcom_show_build_id);\nQCOM_OPEN(pmic_model, qcom_show_pmic_model);\nQCOM_OPEN(pmic_model_array, qcom_show_pmic_model_array);\nQCOM_OPEN(pmic_die_rev, qcom_show_pmic_die_revision);\nQCOM_OPEN(chip_id, qcom_show_chip_id);\n\n#define DEFINE_IMAGE_OPS(type)\t\t\t\t\t\\\nstatic int show_image_##type(struct seq_file *seq, void *p)\t\t  \\\n{\t\t\t\t\t\t\t\t  \\\n\tstruct smem_image_version *image_version = seq->private;  \\\n\tif (image_version->type[0] != '\\0')\t\t\t  \\\n\t\tseq_printf(seq, \"%s\\n\", image_version->type);\t  \\\n\treturn 0;\t\t\t\t\t\t  \\\n}\t\t\t\t\t\t\t\t  \\\nstatic int open_image_##type(struct inode *inode, struct file *file)\t  \\\n{\t\t\t\t\t\t\t\t\t  \\\n\treturn single_open(file, show_image_##type, inode->i_private); \\\n}\t\t\t\t\t\t\t\t\t  \\\n\t\t\t\t\t\t\t\t\t  \\\nstatic const struct file_operations qcom_image_##type##_ops = {\t  \\\n\t.open = open_image_##type,\t\t\t\t\t  \\\n\t.read = seq_read,\t\t\t\t\t\t  \\\n\t.llseek = seq_lseek,\t\t\t\t\t\t  \\\n\t.release = single_release,\t\t\t\t\t  \\\n}\n\nDEFINE_IMAGE_OPS(name);\nDEFINE_IMAGE_OPS(variant);\nDEFINE_IMAGE_OPS(oem);\n\nstatic void socinfo_debugfs_init(struct qcom_socinfo *qcom_socinfo,\n\t\t\t\t struct socinfo *info, size_t info_size)\n{\n\tstruct smem_image_version *versions;\n\tstruct dentry *dentry;\n\tsize_t size;\n\tint i;\n\tunsigned int num_pmics;\n\tunsigned int pmic_array_offset;\n\n\tqcom_socinfo->dbg_root = debugfs_create_dir(\"qcom_socinfo\", NULL);\n\n\tqcom_socinfo->info.fmt = __le32_to_cpu(info->fmt);\n\n\tdebugfs_create_x32(\"info_fmt\", 0444, qcom_socinfo->dbg_root,\n\t\t\t   &qcom_socinfo->info.fmt);\n\n\tswitch (qcom_socinfo->info.fmt) {\n\tcase SOCINFO_VERSION(0, 19):\n\t\tqcom_socinfo->info.num_func_clusters = __le32_to_cpu(info->num_func_clusters);\n\t\tqcom_socinfo->info.boot_cluster = __le32_to_cpu(info->boot_cluster);\n\t\tqcom_socinfo->info.boot_core = __le32_to_cpu(info->boot_core);\n\n\t\tdebugfs_create_u32(\"num_func_clusters\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.num_func_clusters);\n\t\tdebugfs_create_u32(\"boot_cluster\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.boot_cluster);\n\t\tdebugfs_create_u32(\"boot_core\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.boot_core);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 18):\n\tcase SOCINFO_VERSION(0, 17):\n\t\tqcom_socinfo->info.oem_variant = __le32_to_cpu(info->oem_variant);\n\t\tdebugfs_create_u32(\"oem_variant\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.oem_variant);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 16):\n\t\tqcom_socinfo->info.feature_code = __le32_to_cpu(info->feature_code);\n\t\tqcom_socinfo->info.pcode = __le32_to_cpu(info->pcode);\n\n\t\tdebugfs_create_u32(\"feature_code\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.feature_code);\n\t\tdebugfs_create_u32(\"pcode\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.pcode);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 15):\n\t\tqcom_socinfo->info.nmodem_supported = __le32_to_cpu(info->nmodem_supported);\n\n\t\tdebugfs_create_u32(\"nmodem_supported\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.nmodem_supported);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 14):\n\t\tqcom_socinfo->info.num_clusters = __le32_to_cpu(info->num_clusters);\n\t\tqcom_socinfo->info.ncluster_array_offset = __le32_to_cpu(info->ncluster_array_offset);\n\t\tqcom_socinfo->info.num_subset_parts = __le32_to_cpu(info->num_subset_parts);\n\t\tqcom_socinfo->info.nsubset_parts_array_offset =\n\t\t\t__le32_to_cpu(info->nsubset_parts_array_offset);\n\n\t\tdebugfs_create_u32(\"num_clusters\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.num_clusters);\n\t\tdebugfs_create_u32(\"ncluster_array_offset\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.ncluster_array_offset);\n\t\tdebugfs_create_u32(\"num_subset_parts\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.num_subset_parts);\n\t\tdebugfs_create_u32(\"nsubset_parts_array_offset\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.nsubset_parts_array_offset);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 13):\n\t\tqcom_socinfo->info.nproduct_id = __le32_to_cpu(info->nproduct_id);\n\n\t\tdebugfs_create_u32(\"nproduct_id\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.nproduct_id);\n\t\tDEBUGFS_ADD(info, chip_id);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 12):\n\t\tqcom_socinfo->info.chip_family =\n\t\t\t__le32_to_cpu(info->chip_family);\n\t\tqcom_socinfo->info.raw_device_family =\n\t\t\t__le32_to_cpu(info->raw_device_family);\n\t\tqcom_socinfo->info.raw_device_num =\n\t\t\t__le32_to_cpu(info->raw_device_num);\n\n\t\tdebugfs_create_x32(\"chip_family\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.chip_family);\n\t\tdebugfs_create_x32(\"raw_device_family\", 0444,\n\t\t\t\t   qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.raw_device_family);\n\t\tdebugfs_create_x32(\"raw_device_number\", 0444,\n\t\t\t\t   qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.raw_device_num);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 11):\n\t\tnum_pmics = le32_to_cpu(info->num_pmics);\n\t\tpmic_array_offset = le32_to_cpu(info->pmic_array_offset);\n\t\tif (pmic_array_offset + 2 * num_pmics * sizeof(u32) <= info_size)\n\t\t\tDEBUGFS_ADD(info, pmic_model_array);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 10):\n\tcase SOCINFO_VERSION(0, 9):\n\t\tqcom_socinfo->info.foundry_id = __le32_to_cpu(info->foundry_id);\n\n\t\tdebugfs_create_u32(\"foundry_id\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.foundry_id);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 8):\n\tcase SOCINFO_VERSION(0, 7):\n\t\tDEBUGFS_ADD(info, pmic_model);\n\t\tDEBUGFS_ADD(info, pmic_die_rev);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 6):\n\t\tqcom_socinfo->info.hw_plat_subtype =\n\t\t\t__le32_to_cpu(info->hw_plat_subtype);\n\n\t\tdebugfs_create_u32(\"hardware_platform_subtype\", 0444,\n\t\t\t\t   qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.hw_plat_subtype);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 5):\n\t\tqcom_socinfo->info.accessory_chip =\n\t\t\t__le32_to_cpu(info->accessory_chip);\n\n\t\tdebugfs_create_u32(\"accessory_chip\", 0444,\n\t\t\t\t   qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.accessory_chip);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 4):\n\t\tqcom_socinfo->info.plat_ver = __le32_to_cpu(info->plat_ver);\n\n\t\tdebugfs_create_u32(\"platform_version\", 0444,\n\t\t\t\t   qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.plat_ver);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 3):\n\t\tqcom_socinfo->info.hw_plat = __le32_to_cpu(info->hw_plat);\n\n\t\tdebugfs_create_u32(\"hardware_platform\", 0444,\n\t\t\t\t   qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.hw_plat);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 2):\n\t\tqcom_socinfo->info.raw_ver  = __le32_to_cpu(info->raw_ver);\n\n\t\tdebugfs_create_u32(\"raw_version\", 0444, qcom_socinfo->dbg_root,\n\t\t\t\t   &qcom_socinfo->info.raw_ver);\n\t\tfallthrough;\n\tcase SOCINFO_VERSION(0, 1):\n\t\tDEBUGFS_ADD(info, build_id);\n\t\tbreak;\n\t}\n\n\tversions = qcom_smem_get(QCOM_SMEM_HOST_ANY, SMEM_IMAGE_VERSION_TABLE,\n\t\t\t\t &size);\n\n\tfor (i = 0; i < ARRAY_SIZE(socinfo_image_names); i++) {\n\t\tif (!socinfo_image_names[i])\n\t\t\tcontinue;\n\n\t\tdentry = debugfs_create_dir(socinfo_image_names[i],\n\t\t\t\t\t    qcom_socinfo->dbg_root);\n\t\tdebugfs_create_file(\"name\", 0444, dentry, &versions[i],\n\t\t\t\t    &qcom_image_name_ops);\n\t\tdebugfs_create_file(\"variant\", 0444, dentry, &versions[i],\n\t\t\t\t    &qcom_image_variant_ops);\n\t\tdebugfs_create_file(\"oem\", 0444, dentry, &versions[i],\n\t\t\t\t    &qcom_image_oem_ops);\n\t}\n}\n\nstatic void socinfo_debugfs_exit(struct qcom_socinfo *qcom_socinfo)\n{\n\tdebugfs_remove_recursive(qcom_socinfo->dbg_root);\n}\n#else\nstatic void socinfo_debugfs_init(struct qcom_socinfo *qcom_socinfo,\n\t\t\t\t struct socinfo *info, size_t info_size)\n{\n}\nstatic void socinfo_debugfs_exit(struct qcom_socinfo *qcom_socinfo) {  }\n#endif  \n\nstatic int qcom_socinfo_probe(struct platform_device *pdev)\n{\n\tstruct qcom_socinfo *qs;\n\tstruct socinfo *info;\n\tsize_t item_size;\n\n\tinfo = qcom_smem_get(QCOM_SMEM_HOST_ANY, SMEM_HW_SW_BUILD_ID,\n\t\t\t      &item_size);\n\tif (IS_ERR(info)) {\n\t\tdev_err(&pdev->dev, \"Couldn't find socinfo\\n\");\n\t\treturn PTR_ERR(info);\n\t}\n\n\tqs = devm_kzalloc(&pdev->dev, sizeof(*qs), GFP_KERNEL);\n\tif (!qs)\n\t\treturn -ENOMEM;\n\n\tqs->attr.family = \"Snapdragon\";\n\tqs->attr.machine = socinfo_machine(&pdev->dev,\n\t\t\t\t\t   le32_to_cpu(info->id));\n\tqs->attr.soc_id = devm_kasprintf(&pdev->dev, GFP_KERNEL, \"%u\",\n\t\t\t\t\t le32_to_cpu(info->id));\n\tqs->attr.revision = devm_kasprintf(&pdev->dev, GFP_KERNEL, \"%u.%u\",\n\t\t\t\t\t   SOCINFO_MAJOR(le32_to_cpu(info->ver)),\n\t\t\t\t\t   SOCINFO_MINOR(le32_to_cpu(info->ver)));\n\tif (offsetof(struct socinfo, serial_num) <= item_size)\n\t\tqs->attr.serial_number = devm_kasprintf(&pdev->dev, GFP_KERNEL,\n\t\t\t\t\t\t\t\"%u\",\n\t\t\t\t\t\t\tle32_to_cpu(info->serial_num));\n\n\tqs->soc_dev = soc_device_register(&qs->attr);\n\tif (IS_ERR(qs->soc_dev))\n\t\treturn PTR_ERR(qs->soc_dev);\n\n\tsocinfo_debugfs_init(qs, info, item_size);\n\n\t \n\tadd_device_randomness(info, item_size);\n\n\tplatform_set_drvdata(pdev, qs);\n\n\treturn 0;\n}\n\nstatic int qcom_socinfo_remove(struct platform_device *pdev)\n{\n\tstruct qcom_socinfo *qs = platform_get_drvdata(pdev);\n\n\tsoc_device_unregister(qs->soc_dev);\n\n\tsocinfo_debugfs_exit(qs);\n\n\treturn 0;\n}\n\nstatic struct platform_driver qcom_socinfo_driver = {\n\t.probe = qcom_socinfo_probe,\n\t.remove = qcom_socinfo_remove,\n\t.driver  = {\n\t\t.name = \"qcom-socinfo\",\n\t},\n};\n\nmodule_platform_driver(qcom_socinfo_driver);\n\nMODULE_DESCRIPTION(\"Qualcomm SoCinfo driver\");\nMODULE_LICENSE(\"GPL v2\");\nMODULE_ALIAS(\"platform:qcom-socinfo\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}