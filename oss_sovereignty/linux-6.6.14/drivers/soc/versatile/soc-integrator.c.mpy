{
  "module_name": "soc-integrator.c",
  "hash_id": "9b1acdd2d9e3ea3bf6c930d11d8e3bd6d09144ec93cc2011ec3f0de11065c500",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/versatile/soc-integrator.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/slab.h>\n#include <linux/sys_soc.h>\n#include <linux/platform_device.h>\n#include <linux/mfd/syscon.h>\n#include <linux/regmap.h>\n#include <linux/of.h>\n\n#define INTEGRATOR_HDR_ID_OFFSET\t0x00\n\nstatic u32 integrator_coreid;\n\nstatic const struct of_device_id integrator_cm_match[] = {\n\t{ .compatible = \"arm,core-module-integrator\", },\n\t{ }\n};\n\nstatic const char *integrator_arch_str(u32 id)\n{\n\tswitch ((id >> 16) & 0xff) {\n\tcase 0x00:\n\t\treturn \"ASB little-endian\";\n\tcase 0x01:\n\t\treturn \"AHB little-endian\";\n\tcase 0x03:\n\t\treturn \"AHB-Lite system bus, bi-endian\";\n\tcase 0x04:\n\t\treturn \"AHB\";\n\tcase 0x08:\n\t\treturn \"AHB system bus, ASB processor bus\";\n\tdefault:\n\t\treturn \"Unknown\";\n\t}\n}\n\nstatic const char *integrator_fpga_str(u32 id)\n{\n\tswitch ((id >> 12) & 0xf) {\n\tcase 0x01:\n\t\treturn \"XC4062\";\n\tcase 0x02:\n\t\treturn \"XC4085\";\n\tcase 0x03:\n\t\treturn \"XVC600\";\n\tcase 0x04:\n\t\treturn \"EPM7256AE (Altera PLD)\";\n\tdefault:\n\t\treturn \"Unknown\";\n\t}\n}\n\nstatic ssize_t\nmanufacturer_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%02x\\n\", integrator_coreid >> 24);\n}\n\nstatic DEVICE_ATTR_RO(manufacturer);\n\nstatic ssize_t\narch_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%s\\n\", integrator_arch_str(integrator_coreid));\n}\n\nstatic DEVICE_ATTR_RO(arch);\n\nstatic ssize_t\nfpga_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%s\\n\", integrator_fpga_str(integrator_coreid));\n}\n\nstatic DEVICE_ATTR_RO(fpga);\n\nstatic ssize_t\nbuild_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%02x\\n\", (integrator_coreid >> 4) & 0xFF);\n}\n\nstatic DEVICE_ATTR_RO(build);\n\nstatic struct attribute *integrator_attrs[] = {\n\t&dev_attr_manufacturer.attr,\n\t&dev_attr_arch.attr,\n\t&dev_attr_fpga.attr,\n\t&dev_attr_build.attr,\n\tNULL\n};\n\nATTRIBUTE_GROUPS(integrator);\n\nstatic int __init integrator_soc_init(void)\n{\n\tstruct regmap *syscon_regmap;\n\tstruct soc_device *soc_dev;\n\tstruct soc_device_attribute *soc_dev_attr;\n\tstruct device_node *np;\n\tstruct device *dev;\n\tu32 val;\n\tint ret;\n\n\tnp = of_find_matching_node(NULL, integrator_cm_match);\n\tif (!np)\n\t\treturn -ENODEV;\n\n\tsyscon_regmap = syscon_node_to_regmap(np);\n\tif (IS_ERR(syscon_regmap))\n\t\treturn PTR_ERR(syscon_regmap);\n\n\tret = regmap_read(syscon_regmap, INTEGRATOR_HDR_ID_OFFSET,\n\t\t\t  &val);\n\tif (ret)\n\t\treturn -ENODEV;\n\tintegrator_coreid = val;\n\n\tsoc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);\n\tif (!soc_dev_attr)\n\t\treturn -ENOMEM;\n\n\tsoc_dev_attr->soc_id = \"Integrator\";\n\tsoc_dev_attr->machine = \"Integrator\";\n\tsoc_dev_attr->family = \"Versatile\";\n\tsoc_dev_attr->custom_attr_group = integrator_groups[0];\n\tsoc_dev = soc_device_register(soc_dev_attr);\n\tif (IS_ERR(soc_dev)) {\n\t\tkfree(soc_dev_attr);\n\t\treturn -ENODEV;\n\t}\n\tdev = soc_device_to_device(soc_dev);\n\n\tdev_info(dev, \"Detected ARM core module:\\n\");\n\tdev_info(dev, \"    Manufacturer: %02x\\n\", (val >> 24));\n\tdev_info(dev, \"    Architecture: %s\\n\", integrator_arch_str(val));\n\tdev_info(dev, \"    FPGA: %s\\n\", integrator_fpga_str(val));\n\tdev_info(dev, \"    Build: %02x\\n\", (val >> 4) & 0xFF);\n\tdev_info(dev, \"    Rev: %c\\n\", ('A' + (val & 0x03)));\n\n\treturn 0;\n}\ndevice_initcall(integrator_soc_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}