{
  "module_name": "soc-realview.c",
  "hash_id": "5e94dba241c332a87d8c2cfb44e374aa61d77c28a5088a642fffc14c7c48235f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/versatile/soc-realview.c",
  "human_readable_source": "\n \n#include <linux/init.h>\n#include <linux/io.h>\n#include <linux/slab.h>\n#include <linux/sys_soc.h>\n#include <linux/platform_device.h>\n#include <linux/mfd/syscon.h>\n#include <linux/regmap.h>\n#include <linux/of.h>\n\n \n#define REALVIEW_SYS_ID_OFFSET 0x00\n\nstatic const struct of_device_id realview_soc_of_match[] = {\n\t{ .compatible = \"arm,realview-eb-soc\",\t},\n\t{ .compatible = \"arm,realview-pb1176-soc\", },\n\t{ .compatible = \"arm,realview-pb11mp-soc\", },\n\t{ .compatible = \"arm,realview-pba8-soc\", },\n\t{ .compatible = \"arm,realview-pbx-soc\", },\n\t{ }\n};\n\nstatic u32 realview_coreid;\n\nstatic const char *realview_arch_str(u32 id)\n{\n\tswitch ((id >> 8) & 0xf) {\n\tcase 0x04:\n\t\treturn \"AHB\";\n\tcase 0x05:\n\t\treturn \"Multi-layer AXI\";\n\tdefault:\n\t\treturn \"Unknown\";\n\t}\n}\n\nstatic ssize_t\nmanufacturer_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%02x\\n\", realview_coreid >> 24);\n}\n\nstatic DEVICE_ATTR_RO(manufacturer);\n\nstatic ssize_t\nboard_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"HBI-%03x\\n\", ((realview_coreid >> 16) & 0xfff));\n}\n\nstatic DEVICE_ATTR_RO(board);\n\nstatic ssize_t\nfpga_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%s\\n\", realview_arch_str(realview_coreid));\n}\n\nstatic DEVICE_ATTR_RO(fpga);\n\nstatic ssize_t\nbuild_show(struct device *dev, struct device_attribute *attr, char *buf)\n{\n\treturn sprintf(buf, \"%02x\\n\", (realview_coreid & 0xFF));\n}\n\nstatic DEVICE_ATTR_RO(build);\n\nstatic struct attribute *realview_attrs[] = {\n\t&dev_attr_manufacturer.attr,\n\t&dev_attr_board.attr,\n\t&dev_attr_fpga.attr,\n\t&dev_attr_build.attr,\n\tNULL\n};\n\nATTRIBUTE_GROUPS(realview);\n\nstatic int realview_soc_probe(struct platform_device *pdev)\n{\n\tstruct regmap *syscon_regmap;\n\tstruct soc_device *soc_dev;\n\tstruct soc_device_attribute *soc_dev_attr;\n\tstruct device_node *np = pdev->dev.of_node;\n\tint ret;\n\n\tsyscon_regmap = syscon_regmap_lookup_by_phandle(np, \"regmap\");\n\tif (IS_ERR(syscon_regmap))\n\t\treturn PTR_ERR(syscon_regmap);\n\n\tsoc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);\n\tif (!soc_dev_attr)\n\t\treturn -ENOMEM;\n\n\tret = of_property_read_string(np, \"compatible\",\n\t\t\t\t      &soc_dev_attr->soc_id);\n\tif (ret)\n\t\treturn -EINVAL;\n\n\tsoc_dev_attr->machine = \"RealView\";\n\tsoc_dev_attr->family = \"Versatile\";\n\tsoc_dev_attr->custom_attr_group = realview_groups[0];\n\tsoc_dev = soc_device_register(soc_dev_attr);\n\tif (IS_ERR(soc_dev)) {\n\t\tkfree(soc_dev_attr);\n\t\treturn -ENODEV;\n\t}\n\tret = regmap_read(syscon_regmap, REALVIEW_SYS_ID_OFFSET,\n\t\t\t  &realview_coreid);\n\tif (ret)\n\t\treturn -ENODEV;\n\n\tdev_info(&pdev->dev, \"RealView Syscon Core ID: 0x%08x, HBI-%03x\\n\",\n\t\t realview_coreid,\n\t\t ((realview_coreid >> 16) & 0xfff));\n\t \n\treturn 0;\n}\n\nstatic struct platform_driver realview_soc_driver = {\n\t.probe = realview_soc_probe,\n\t.driver = {\n\t\t.name = \"realview-soc\",\n\t\t.of_match_table = realview_soc_of_match,\n\t},\n};\nbuiltin_platform_driver(realview_soc_driver);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}