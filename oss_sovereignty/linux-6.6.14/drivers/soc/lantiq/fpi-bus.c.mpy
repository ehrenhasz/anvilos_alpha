{
  "module_name": "fpi-bus.c",
  "hash_id": "54431bf0e1a9923b832dcd1a78095e792e89bee5f1ff673cf31a182a93543e9f",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/lantiq/fpi-bus.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/err.h>\n#include <linux/mfd/syscon.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/of_platform.h>\n#include <linux/platform_device.h>\n#include <linux/property.h>\n#include <linux/regmap.h>\n\n#include <lantiq_soc.h>\n\n#define XBAR_ALWAYS_LAST\t0x430\n#define XBAR_FPI_BURST_EN\tBIT(1)\n#define XBAR_AHB_BURST_EN\tBIT(2)\n\n#define RCU_VR9_BE_AHB1S\t0x00000008\n\nstatic int ltq_fpi_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct device_node *np = dev->of_node;\n\tstruct regmap *rcu_regmap;\n\tvoid __iomem *xbar_membase;\n\tu32 rcu_ahb_endianness_reg_offset;\n\tint ret;\n\n\txbar_membase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(xbar_membase))\n\t\treturn PTR_ERR(xbar_membase);\n\n\t \n\trcu_regmap = syscon_regmap_lookup_by_phandle(np, \"lantiq,rcu\");\n\tif (IS_ERR(rcu_regmap))\n\t\treturn PTR_ERR(rcu_regmap);\n\n\tret = device_property_read_u32(dev, \"lantiq,offset-endianness\",\n\t\t\t\t       &rcu_ahb_endianness_reg_offset);\n\tif (ret) {\n\t\tdev_err(&pdev->dev, \"Failed to get RCU reg offset\\n\");\n\t\treturn ret;\n\t}\n\n\tret = regmap_update_bits(rcu_regmap, rcu_ahb_endianness_reg_offset,\n\t\t\t\t RCU_VR9_BE_AHB1S, RCU_VR9_BE_AHB1S);\n\tif (ret) {\n\t\tdev_warn(&pdev->dev,\n\t\t\t \"Failed to configure RCU AHB endianness\\n\");\n\t\treturn ret;\n\t}\n\n\t \n\tltq_w32_mask(XBAR_FPI_BURST_EN, 0, xbar_membase + XBAR_ALWAYS_LAST);\n\n\treturn of_platform_populate(dev->of_node, NULL, NULL, dev);\n}\n\nstatic const struct of_device_id ltq_fpi_match[] = {\n\t{ .compatible = \"lantiq,xrx200-fpi\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, ltq_fpi_match);\n\nstatic struct platform_driver ltq_fpi_driver = {\n\t.probe = ltq_fpi_probe,\n\t.driver = {\n\t\t.name = \"fpi-xway\",\n\t\t.of_match_table = ltq_fpi_match,\n\t},\n};\n\nmodule_platform_driver(ltq_fpi_driver);\n\nMODULE_DESCRIPTION(\"Lantiq FPI bus driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}