{
  "module_name": "common.c",
  "hash_id": "5eb02ed384d873d1012d938a48b85b9fb82a77ee7a196f00c322826e4e03ecec",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/bcm/brcmstb/common.c",
  "human_readable_source": "\n \n\n#include <linux/io.h>\n#include <linux/of.h>\n#include <linux/of_address.h>\n#include <linux/slab.h>\n#include <linux/soc/brcmstb/brcmstb.h>\n#include <linux/sys_soc.h>\n\nstatic u32 family_id;\nstatic u32 product_id;\n\nu32 brcmstb_get_family_id(void)\n{\n\treturn family_id;\n}\nEXPORT_SYMBOL(brcmstb_get_family_id);\n\nu32 brcmstb_get_product_id(void)\n{\n\treturn product_id;\n}\nEXPORT_SYMBOL(brcmstb_get_product_id);\n\nstatic const struct of_device_id sun_top_ctrl_match[] = {\n\t{ .compatible = \"brcm,bcm7125-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7346-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7358-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7360-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7362-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7420-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7425-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7429-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,bcm7435-sun-top-ctrl\", },\n\t{ .compatible = \"brcm,brcmstb-sun-top-ctrl\", },\n\t{ }\n};\n\nstatic int __init brcmstb_soc_device_early_init(void)\n{\n\tstruct device_node *sun_top_ctrl;\n\tvoid __iomem *sun_top_ctrl_base;\n\tint ret = 0;\n\n\t \n\tsun_top_ctrl = of_find_matching_node(NULL, sun_top_ctrl_match);\n\tif (!sun_top_ctrl)\n\t\treturn ret;\n\n\tsun_top_ctrl_base = of_iomap(sun_top_ctrl, 0);\n\tif (!sun_top_ctrl_base) {\n\t\tret = -ENODEV;\n\t\tgoto out;\n\t}\n\n\tfamily_id = readl(sun_top_ctrl_base);\n\tproduct_id = readl(sun_top_ctrl_base + 0x4);\n\tiounmap(sun_top_ctrl_base);\nout:\n\tof_node_put(sun_top_ctrl);\n\treturn ret;\n}\nearly_initcall(brcmstb_soc_device_early_init);\n\nstatic int __init brcmstb_soc_device_init(void)\n{\n\tstruct soc_device_attribute *soc_dev_attr;\n\tstruct device_node *sun_top_ctrl;\n\tstruct soc_device *soc_dev;\n\tint ret = 0;\n\n\t \n\tsun_top_ctrl = of_find_matching_node(NULL, sun_top_ctrl_match);\n\tif (!sun_top_ctrl)\n\t\treturn ret;\n\n\tsoc_dev_attr = kzalloc(sizeof(*soc_dev_attr), GFP_KERNEL);\n\tif (!soc_dev_attr) {\n\t\tret = -ENOMEM;\n\t\tgoto out;\n\t}\n\n\tsoc_dev_attr->family = kasprintf(GFP_KERNEL, \"%x\",\n\t\t\t\t\t family_id >> 28 ?\n\t\t\t\t\t family_id >> 16 : family_id >> 8);\n\tsoc_dev_attr->soc_id = kasprintf(GFP_KERNEL, \"%x\",\n\t\t\t\t\t product_id >> 28 ?\n\t\t\t\t\t product_id >> 16 : product_id >> 8);\n\tsoc_dev_attr->revision = kasprintf(GFP_KERNEL, \"%c%d\",\n\t\t\t\t\t ((product_id & 0xf0) >> 4) + 'A',\n\t\t\t\t\t   product_id & 0xf);\n\n\tsoc_dev = soc_device_register(soc_dev_attr);\n\tif (IS_ERR(soc_dev)) {\n\t\tkfree(soc_dev_attr->family);\n\t\tkfree(soc_dev_attr->soc_id);\n\t\tkfree(soc_dev_attr->revision);\n\t\tkfree(soc_dev_attr);\n\t\tret = -ENOMEM;\n\t}\nout:\n\tof_node_put(sun_top_ctrl);\n\treturn ret;\n}\narch_initcall(brcmstb_soc_device_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}