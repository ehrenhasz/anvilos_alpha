{
  "module_name": "qbman-portal.h",
  "hash_id": "0273d85afc877ee65623ac56c09f4b12263b3b0f3c60dffa0ab4d8092c632ed7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/fsl/dpio/qbman-portal.h",
  "human_readable_source": " \n \n#ifndef __FSL_QBMAN_PORTAL_H\n#define __FSL_QBMAN_PORTAL_H\n\n#include <soc/fsl/dpaa2-fd.h>\n\n#define QMAN_REV_4000   0x04000000\n#define QMAN_REV_4100   0x04010000\n#define QMAN_REV_4101   0x04010001\n#define QMAN_REV_5000   0x05000000\n\n#define QMAN_REV_MASK   0xffff0000\n\nstruct dpaa2_dq;\nstruct qbman_swp;\n\n \nstruct qbman_swp_desc {\n\tvoid *cena_bar;  \n\tvoid __iomem *cinh_bar;  \n\tu32 qman_version;\n\tu32 qman_clk;\n\tu32 qman_256_cycles_per_ns;\n};\n\n#define QBMAN_SWP_INTERRUPT_EQRI 0x01\n#define QBMAN_SWP_INTERRUPT_EQDI 0x02\n#define QBMAN_SWP_INTERRUPT_DQRI 0x04\n#define QBMAN_SWP_INTERRUPT_RCRI 0x08\n#define QBMAN_SWP_INTERRUPT_RCDI 0x10\n#define QBMAN_SWP_INTERRUPT_VDCI 0x20\n\n \nstruct qbman_pull_desc {\n\tu8 verb;\n\tu8 numf;\n\tu8 tok;\n\tu8 reserved;\n\t__le32 dq_src;\n\t__le64 rsp_addr;\n\tu64 rsp_addr_virt;\n\tu8 padding[40];\n};\n\nenum qbman_pull_type_e {\n\t \n\tqbman_pull_type_prio = 1,\n\t \n\tqbman_pull_type_active,\n\t \n\tqbman_pull_type_active_noics\n};\n\n \n#define QBMAN_RESULT_MASK      0x7f\n#define QBMAN_RESULT_DQ        0x60\n#define QBMAN_RESULT_FQRN      0x21\n#define QBMAN_RESULT_FQRNI     0x22\n#define QBMAN_RESULT_FQPN      0x24\n#define QBMAN_RESULT_FQDAN     0x25\n#define QBMAN_RESULT_CDAN      0x26\n#define QBMAN_RESULT_CSCN_MEM  0x27\n#define QBMAN_RESULT_CGCU      0x28\n#define QBMAN_RESULT_BPSCN     0x29\n#define QBMAN_RESULT_CSCN_WQ   0x2a\n\n \n#define QBMAN_FQ_SCHEDULE\t0x48\n#define QBMAN_FQ_FORCE\t\t0x49\n#define QBMAN_FQ_XON\t\t0x4d\n#define QBMAN_FQ_XOFF\t\t0x4e\n\n \nstruct qbman_eq_desc {\n\tu8 verb;\n\tu8 dca;\n\t__le16 seqnum;\n\t__le16 orpid;\n\t__le16 reserved1;\n\t__le32 tgtid;\n\t__le32 tag;\n\t__le16 qdbin;\n\tu8 qpri;\n\tu8 reserved[3];\n\tu8 wae;\n\tu8 rspid;\n\t__le64 rsp_addr;\n};\n\nstruct qbman_eq_desc_with_fd {\n\tstruct qbman_eq_desc desc;\n\tu8 fd[32];\n};\n\n \nstruct qbman_release_desc {\n\tu8 verb;\n\tu8 reserved;\n\t__le16 bpid;\n\t__le32 reserved2;\n\t__le64 buf[7];\n};\n\n \n#define QBMAN_MC_RSLT_OK      0xf0\n\n#define CODE_CDAN_WE_EN    0x1\n#define CODE_CDAN_WE_CTX   0x4\n\n \nstruct qbman_swp {\n\tconst struct qbman_swp_desc *desc;\n\tvoid *addr_cena;\n\tvoid __iomem *addr_cinh;\n\n\t \n\tstruct {\n\t\tu32 valid_bit;  \n\t} mc;\n\n\t \n\tstruct {\n\t\tu32 valid_bit;  \n\t} mr;\n\n\t \n\tu32 sdq;\n\n\t \n\tstruct {\n\t\tatomic_t available;  \n\t\tu32 valid_bit;  \n\t\tstruct dpaa2_dq *storage;  \n\t} vdq;\n\n\t \n\tstruct {\n\t\tu32 next_idx;\n\t\tu32 valid_bit;\n\t\tu8 dqrr_size;\n\t\tint reset_bug;  \n\t} dqrr;\n\n\tstruct {\n\t\tu32 pi;\n\t\tu32 pi_vb;\n\t\tu32 pi_ring_size;\n\t\tu32 pi_ci_mask;\n\t\tu32 ci;\n\t\tint available;\n\t\tu32 pend;\n\t\tu32 no_pfdr;\n\t} eqcr;\n\n\tspinlock_t access_spinlock;\n\n\t \n\tu32 irq_threshold;\n\tu32 irq_holdoff;\n\tint use_adaptive_rx_coalesce;\n};\n\n \nextern\nint (*qbman_swp_enqueue_ptr)(struct qbman_swp *s,\n\t\t\t     const struct qbman_eq_desc *d,\n\t\t\t     const struct dpaa2_fd *fd);\nextern\nint (*qbman_swp_enqueue_multiple_ptr)(struct qbman_swp *s,\n\t\t\t\t      const struct qbman_eq_desc *d,\n\t\t\t\t      const struct dpaa2_fd *fd,\n\t\t\t\t      uint32_t *flags,\n\t\t\t\t      int num_frames);\nextern\nint (*qbman_swp_enqueue_multiple_desc_ptr)(struct qbman_swp *s,\n\t\t\t\t\t   const struct qbman_eq_desc *d,\n\t\t\t\t\t   const struct dpaa2_fd *fd,\n\t\t\t\t\t   int num_frames);\nextern\nint (*qbman_swp_pull_ptr)(struct qbman_swp *s, struct qbman_pull_desc *d);\nextern\nconst struct dpaa2_dq *(*qbman_swp_dqrr_next_ptr)(struct qbman_swp *s);\nextern\nint (*qbman_swp_release_ptr)(struct qbman_swp *s,\n\t\t\t     const struct qbman_release_desc *d,\n\t\t\t     const u64 *buffers,\n\t\t\t     unsigned int num_buffers);\n\n \nstruct qbman_swp *qbman_swp_init(const struct qbman_swp_desc *d);\nvoid qbman_swp_finish(struct qbman_swp *p);\nu32 qbman_swp_interrupt_read_status(struct qbman_swp *p);\nvoid qbman_swp_interrupt_clear_status(struct qbman_swp *p, u32 mask);\nu32 qbman_swp_interrupt_get_trigger(struct qbman_swp *p);\nvoid qbman_swp_interrupt_set_trigger(struct qbman_swp *p, u32 mask);\nint qbman_swp_interrupt_get_inhibit(struct qbman_swp *p);\nvoid qbman_swp_interrupt_set_inhibit(struct qbman_swp *p, int inhibit);\n\nvoid qbman_swp_push_get(struct qbman_swp *p, u8 channel_idx, int *enabled);\nvoid qbman_swp_push_set(struct qbman_swp *p, u8 channel_idx, int enable);\n\nvoid qbman_pull_desc_clear(struct qbman_pull_desc *d);\nvoid qbman_pull_desc_set_storage(struct qbman_pull_desc *d,\n\t\t\t\t struct dpaa2_dq *storage,\n\t\t\t\t dma_addr_t storage_phys,\n\t\t\t\t int stash);\nvoid qbman_pull_desc_set_numframes(struct qbman_pull_desc *d, u8 numframes);\nvoid qbman_pull_desc_set_fq(struct qbman_pull_desc *d, u32 fqid);\nvoid qbman_pull_desc_set_wq(struct qbman_pull_desc *d, u32 wqid,\n\t\t\t    enum qbman_pull_type_e dct);\nvoid qbman_pull_desc_set_channel(struct qbman_pull_desc *d, u32 chid,\n\t\t\t\t enum qbman_pull_type_e dct);\n\nvoid qbman_swp_dqrr_consume(struct qbman_swp *s, const struct dpaa2_dq *dq);\n\nint qbman_result_has_new_result(struct qbman_swp *p, const struct dpaa2_dq *dq);\n\nvoid qbman_eq_desc_clear(struct qbman_eq_desc *d);\nvoid qbman_eq_desc_set_no_orp(struct qbman_eq_desc *d, int respond_success);\nvoid qbman_eq_desc_set_token(struct qbman_eq_desc *d, u8 token);\nvoid qbman_eq_desc_set_fq(struct qbman_eq_desc *d, u32 fqid);\nvoid qbman_eq_desc_set_qd(struct qbman_eq_desc *d, u32 qdid,\n\t\t\t  u32 qd_bin, u32 qd_prio);\n\n\nvoid qbman_release_desc_clear(struct qbman_release_desc *d);\nvoid qbman_release_desc_set_bpid(struct qbman_release_desc *d, u16 bpid);\nvoid qbman_release_desc_set_rcdi(struct qbman_release_desc *d, int enable);\n\nint qbman_swp_acquire(struct qbman_swp *s, u16 bpid, u64 *buffers,\n\t\t      unsigned int num_buffers);\nint qbman_swp_alt_fq_state(struct qbman_swp *s, u32 fqid,\n\t\t\t   u8 alt_fq_verb);\nint qbman_swp_CDAN_set(struct qbman_swp *s, u16 channelid,\n\t\t       u8 we_mask, u8 cdan_en,\n\t\t       u64 ctx);\n\nvoid *qbman_swp_mc_start(struct qbman_swp *p);\nvoid qbman_swp_mc_submit(struct qbman_swp *p, void *cmd, u8 cmd_verb);\nvoid *qbman_swp_mc_result(struct qbman_swp *p);\n\n \nstatic inline int\nqbman_swp_enqueue(struct qbman_swp *s, const struct qbman_eq_desc *d,\n\t\t  const struct dpaa2_fd *fd)\n{\n\treturn qbman_swp_enqueue_ptr(s, d, fd);\n}\n\n \nstatic inline int\nqbman_swp_enqueue_multiple(struct qbman_swp *s,\n\t\t\t   const struct qbman_eq_desc *d,\n\t\t\t   const struct dpaa2_fd *fd,\n\t\t\t   uint32_t *flags,\n\t\t\t   int num_frames)\n{\n\treturn qbman_swp_enqueue_multiple_ptr(s, d, fd, flags, num_frames);\n}\n\n \nstatic inline int\nqbman_swp_enqueue_multiple_desc(struct qbman_swp *s,\n\t\t\t\tconst struct qbman_eq_desc *d,\n\t\t\t\tconst struct dpaa2_fd *fd,\n\t\t\t\tint num_frames)\n{\n\treturn qbman_swp_enqueue_multiple_desc_ptr(s, d, fd, num_frames);\n}\n\n \nstatic inline int qbman_result_is_DQ(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_DQ);\n}\n\n \nstatic inline int qbman_result_is_SCN(const struct dpaa2_dq *dq)\n{\n\treturn !qbman_result_is_DQ(dq);\n}\n\n \nstatic inline int qbman_result_is_FQDAN(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_FQDAN);\n}\n\n \nstatic inline int qbman_result_is_CDAN(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_CDAN);\n}\n\n \nstatic inline int qbman_result_is_CSCN(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_CSCN_WQ);\n}\n\n \nstatic inline int qbman_result_is_BPSCN(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_BPSCN);\n}\n\n \nstatic inline int qbman_result_is_CGCU(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_CGCU);\n}\n\n \nstatic inline int qbman_result_is_FQRN(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_FQRN);\n}\n\n \nstatic inline int qbman_result_is_FQRNI(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_FQRNI);\n}\n\n  \nstatic inline int qbman_result_is_FQPN(const struct dpaa2_dq *dq)\n{\n\treturn ((dq->dq.verb & QBMAN_RESULT_MASK) == QBMAN_RESULT_FQPN);\n}\n\n \nstatic inline u8 qbman_result_SCN_state(const struct dpaa2_dq *scn)\n{\n\treturn scn->scn.state;\n}\n\n#define SCN_RID_MASK 0x00FFFFFF\n\n \nstatic inline u32 qbman_result_SCN_rid(const struct dpaa2_dq *scn)\n{\n\treturn le32_to_cpu(scn->scn.rid_tok) & SCN_RID_MASK;\n}\n\n \nstatic inline u64 qbman_result_SCN_ctx(const struct dpaa2_dq *scn)\n{\n\treturn le64_to_cpu(scn->scn.ctx);\n}\n\n \nstatic inline int qbman_swp_fq_schedule(struct qbman_swp *s, u32 fqid)\n{\n\treturn qbman_swp_alt_fq_state(s, fqid, QBMAN_FQ_SCHEDULE);\n}\n\n \nstatic inline int qbman_swp_fq_force(struct qbman_swp *s, u32 fqid)\n{\n\treturn qbman_swp_alt_fq_state(s, fqid, QBMAN_FQ_FORCE);\n}\n\n \nstatic inline int qbman_swp_fq_xon(struct qbman_swp *s, u32 fqid)\n{\n\treturn qbman_swp_alt_fq_state(s, fqid, QBMAN_FQ_XON);\n}\n\n \nstatic inline int qbman_swp_fq_xoff(struct qbman_swp *s, u32 fqid)\n{\n\treturn qbman_swp_alt_fq_state(s, fqid, QBMAN_FQ_XOFF);\n}\n\n \n\n \nstatic inline int qbman_swp_CDAN_set_context(struct qbman_swp *s, u16 channelid,\n\t\t\t\t\t     u64 ctx)\n{\n\treturn qbman_swp_CDAN_set(s, channelid,\n\t\t\t\t  CODE_CDAN_WE_CTX,\n\t\t\t\t  0, ctx);\n}\n\n \nstatic inline int qbman_swp_CDAN_enable(struct qbman_swp *s, u16 channelid)\n{\n\treturn qbman_swp_CDAN_set(s, channelid,\n\t\t\t\t  CODE_CDAN_WE_EN,\n\t\t\t\t  1, 0);\n}\n\n \nstatic inline int qbman_swp_CDAN_disable(struct qbman_swp *s, u16 channelid)\n{\n\treturn qbman_swp_CDAN_set(s, channelid,\n\t\t\t\t  CODE_CDAN_WE_EN,\n\t\t\t\t  0, 0);\n}\n\n \nstatic inline int qbman_swp_CDAN_set_context_enable(struct qbman_swp *s,\n\t\t\t\t\t\t    u16 channelid,\n\t\t\t\t\t\t    u64 ctx)\n{\n\treturn qbman_swp_CDAN_set(s, channelid,\n\t\t\t\t  CODE_CDAN_WE_EN | CODE_CDAN_WE_CTX,\n\t\t\t\t  1, ctx);\n}\n\n \nstatic inline void *qbman_swp_mc_complete(struct qbman_swp *swp, void *cmd,\n\t\t\t\t\t  u8 cmd_verb)\n{\n\tint loopvar = 2000;\n\n\tqbman_swp_mc_submit(swp, cmd, cmd_verb);\n\n\tdo {\n\t\tcmd = qbman_swp_mc_result(swp);\n\t} while (!cmd && loopvar--);\n\n\tWARN_ON(!loopvar);\n\n\treturn cmd;\n}\n\n \nstruct qbman_fq_query_np_rslt {\n\tu8 verb;\n\tu8 rslt;\n\tu8 st1;\n\tu8 st2;\n\tu8 reserved[2];\n\t__le16 od1_sfdr;\n\t__le16 od2_sfdr;\n\t__le16 od3_sfdr;\n\t__le16 ra1_sfdr;\n\t__le16 ra2_sfdr;\n\t__le32 pfdr_hptr;\n\t__le32 pfdr_tptr;\n\t__le32 frm_cnt;\n\t__le32 byte_cnt;\n\t__le16 ics_surp;\n\tu8 is;\n\tu8 reserved2[29];\n};\n\nint qbman_fq_query_state(struct qbman_swp *s, u32 fqid,\n\t\t\t struct qbman_fq_query_np_rslt *r);\nu32 qbman_fq_state_frame_count(const struct qbman_fq_query_np_rslt *r);\nu32 qbman_fq_state_byte_count(const struct qbman_fq_query_np_rslt *r);\n\nstruct qbman_bp_query_rslt {\n\tu8 verb;\n\tu8 rslt;\n\tu8 reserved[4];\n\tu8 bdi;\n\tu8 state;\n\t__le32 fill;\n\t__le32 hdotr;\n\t__le16 swdet;\n\t__le16 swdxt;\n\t__le16 hwdet;\n\t__le16 hwdxt;\n\t__le16 swset;\n\t__le16 swsxt;\n\t__le16 vbpid;\n\t__le16 icid;\n\t__le64 bpscn_addr;\n\t__le64 bpscn_ctx;\n\t__le16 hw_targ;\n\tu8 dbe;\n\tu8 reserved2;\n\tu8 sdcnt;\n\tu8 hdcnt;\n\tu8 sscnt;\n\tu8 reserved3[9];\n};\n\nint qbman_bp_query(struct qbman_swp *s, u16 bpid,\n\t\t   struct qbman_bp_query_rslt *r);\n\nu32 qbman_bp_info_num_free_bufs(struct qbman_bp_query_rslt *a);\n\n \nstatic inline int qbman_swp_release(struct qbman_swp *s,\n\t\t\t\t    const struct qbman_release_desc *d,\n\t\t\t\t    const u64 *buffers,\n\t\t\t\t    unsigned int num_buffers)\n{\n\treturn qbman_swp_release_ptr(s, d, buffers, num_buffers);\n}\n\n \nstatic inline int qbman_swp_pull(struct qbman_swp *s,\n\t\t\t\t struct qbman_pull_desc *d)\n{\n\treturn qbman_swp_pull_ptr(s, d);\n}\n\n \nstatic inline const struct dpaa2_dq *qbman_swp_dqrr_next(struct qbman_swp *s)\n{\n\treturn qbman_swp_dqrr_next_ptr(s);\n}\n\nint qbman_swp_set_irq_coalescing(struct qbman_swp *p, u32 irq_threshold,\n\t\t\t\t u32 irq_holdoff);\n\nvoid qbman_swp_get_irq_coalescing(struct qbman_swp *p, u32 *irq_threshold,\n\t\t\t\t  u32 *irq_holdoff);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}