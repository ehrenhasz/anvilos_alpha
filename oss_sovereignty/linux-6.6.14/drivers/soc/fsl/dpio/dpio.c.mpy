{
  "module_name": "dpio.c",
  "hash_id": "906756692cd87a12d8b3a499f292835a34ca7b9e10357b5e2874981c5f22b5f9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/fsl/dpio/dpio.c",
  "human_readable_source": "\n \n#include <linux/kernel.h>\n#include <linux/fsl/mc.h>\n\n#include \"dpio.h\"\n#include \"dpio-cmd.h\"\n\n \n\n \nint dpio_open(struct fsl_mc_io *mc_io,\n\t      u32 cmd_flags,\n\t      int dpio_id,\n\t      u16 *token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpio_cmd_open *dpio_cmd;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_OPEN,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  0);\n\tdpio_cmd = (struct dpio_cmd_open *)cmd.params;\n\tdpio_cmd->dpio_id = cpu_to_le32(dpio_id);\n\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\t*token = mc_cmd_hdr_read_token(&cmd);\n\n\treturn 0;\n}\n\n \nint dpio_close(struct fsl_mc_io *mc_io,\n\t       u32 cmd_flags,\n\t       u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_CLOSE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpio_enable(struct fsl_mc_io *mc_io,\n\t\tu32 cmd_flags,\n\t\tu16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_ENABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpio_disable(struct fsl_mc_io *mc_io,\n\t\t u32 cmd_flags,\n\t\t u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_DISABLE,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpio_get_attributes(struct fsl_mc_io *mc_io,\n\t\t\tu32 cmd_flags,\n\t\t\tu16 token,\n\t\t\tstruct dpio_attr *attr)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpio_rsp_get_attr *dpio_rsp;\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_GET_ATTR,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\tdpio_rsp = (struct dpio_rsp_get_attr *)cmd.params;\n\tattr->id = le32_to_cpu(dpio_rsp->id);\n\tattr->qbman_portal_id = le16_to_cpu(dpio_rsp->qbman_portal_id);\n\tattr->num_priorities = dpio_rsp->num_priorities;\n\tattr->channel_mode = dpio_rsp->channel_mode & DPIO_CHANNEL_MODE_MASK;\n\tattr->qbman_portal_ce_offset =\n\t\tle64_to_cpu(dpio_rsp->qbman_portal_ce_addr);\n\tattr->qbman_portal_ci_offset =\n\t\tle64_to_cpu(dpio_rsp->qbman_portal_ci_addr);\n\tattr->qbman_version = le32_to_cpu(dpio_rsp->qbman_version);\n\tattr->clk = le32_to_cpu(dpio_rsp->clk);\n\n\treturn 0;\n}\n\nint dpio_set_stashing_destination(struct fsl_mc_io *mc_io,\n\t\t\t\t  u32 cmd_flags,\n\t\t\t\t  u16 token,\n\t\t\t\t  u8 sdest)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tstruct dpio_stashing_dest *dpio_cmd;\n\n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_SET_STASHING_DEST,\n\t\t\t\t\t  cmd_flags, token);\n\tdpio_cmd = (struct dpio_stashing_dest *)cmd.params;\n\tdpio_cmd->sdest = sdest;\n\n\treturn mc_send_command(mc_io, &cmd);\n}\n\n \nint dpio_get_api_version(struct fsl_mc_io *mc_io,\n\t\t\t u32 cmd_flags,\n\t\t\t u16 *major_ver,\n\t\t\t u16 *minor_ver)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\tint err;\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_GET_API_VERSION,\n\t\t\t\t\t  cmd_flags, 0);\n\n\terr = mc_send_command(mc_io, &cmd);\n\tif (err)\n\t\treturn err;\n\n\t \n\tmc_cmd_read_api_version(&cmd, major_ver, minor_ver);\n\n\treturn 0;\n}\n\n \nint dpio_reset(struct fsl_mc_io *mc_io,\n\t       u32 cmd_flags,\n\t       u16 token)\n{\n\tstruct fsl_mc_command cmd = { 0 };\n\n\t \n\tcmd.header = mc_encode_cmd_header(DPIO_CMDID_RESET,\n\t\t\t\t\t  cmd_flags,\n\t\t\t\t\t  token);\n\n\t \n\treturn mc_send_command(mc_io, &cmd);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}