{
  "module_name": "bman_test_api.c",
  "hash_id": "0aa6c935314c7a0c2baff0e2392f3e8ea5b3993eb3257bf35ba19f7d4f143a54",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/fsl/qbman/bman_test_api.c",
  "human_readable_source": " \n\n#include \"bman_test.h\"\n\n#define NUM_BUFS\t93\n#define LOOPS\t\t3\n#define BMAN_TOKEN_MASK 0x00FFFFFFFFFFLLU\n\nstatic struct bman_pool *pool;\nstatic struct bm_buffer bufs_in[NUM_BUFS] ____cacheline_aligned;\nstatic struct bm_buffer bufs_out[NUM_BUFS] ____cacheline_aligned;\nstatic int bufs_received;\n\nstatic void bufs_init(void)\n{\n\tint i;\n\n\tfor (i = 0; i < NUM_BUFS; i++)\n\t\tbm_buffer_set64(&bufs_in[i], 0xfedc01234567LLU * i);\n\tbufs_received = 0;\n}\n\nstatic inline int bufs_cmp(const struct bm_buffer *a, const struct bm_buffer *b)\n{\n\tif (bman_ip_rev == BMAN_REV20 || bman_ip_rev == BMAN_REV21) {\n\n\t\t \n\t\tif ((bm_buffer_get64(a) & BMAN_TOKEN_MASK) <\n\t\t    (bm_buffer_get64(b) & BMAN_TOKEN_MASK))\n\t\t\treturn -1;\n\t\tif ((bm_buffer_get64(a) & BMAN_TOKEN_MASK) >\n\t\t    (bm_buffer_get64(b) & BMAN_TOKEN_MASK))\n\t\t\treturn 1;\n\t} else {\n\t\tif (bm_buffer_get64(a) < bm_buffer_get64(b))\n\t\t\treturn -1;\n\t\tif (bm_buffer_get64(a) > bm_buffer_get64(b))\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}\n\nstatic void bufs_confirm(void)\n{\n\tint i, j;\n\n\tfor (i = 0; i < NUM_BUFS; i++) {\n\t\tint matches = 0;\n\n\t\tfor (j = 0; j < NUM_BUFS; j++)\n\t\t\tif (!bufs_cmp(&bufs_in[i], &bufs_out[j]))\n\t\t\t\tmatches++;\n\t\tWARN_ON(matches != 1);\n\t}\n}\n\n \nvoid bman_test_api(void)\n{\n\tint i, loops = LOOPS;\n\n\tbufs_init();\n\n\tpr_info(\"%s(): Starting\\n\", __func__);\n\n\tpool = bman_new_pool();\n\tif (!pool) {\n\t\tpr_crit(\"bman_new_pool() failed\\n\");\n\t\tgoto failed;\n\t}\n\n\t \ndo_loop:\n\ti = 0;\n\twhile (i < NUM_BUFS) {\n\t\tint num = 8;\n\n\t\tif (i + num > NUM_BUFS)\n\t\t\tnum = NUM_BUFS - i;\n\t\tif (bman_release(pool, bufs_in + i, num)) {\n\t\t\tpr_crit(\"bman_release() failed\\n\");\n\t\t\tgoto failed;\n\t\t}\n\t\ti += num;\n\t}\n\n\t \n\twhile (i > 0) {\n\t\tint tmp, num = 8;\n\n\t\tif (num > i)\n\t\t\tnum = i;\n\t\ttmp = bman_acquire(pool, bufs_out + i - num, num);\n\t\tWARN_ON(tmp != num);\n\t\ti -= num;\n\t}\n\ti = bman_acquire(pool, NULL, 1);\n\tWARN_ON(i > 0);\n\n\tbufs_confirm();\n\n\tif (--loops)\n\t\tgoto do_loop;\n\n\t \n\tbman_free_pool(pool);\n\tpr_info(\"%s(): Finished\\n\", __func__);\n\treturn;\n\nfailed:\n\tWARN_ON(1);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}