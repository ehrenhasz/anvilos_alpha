{
  "module_name": "speedo-tegra20.c",
  "hash_id": "b7945d667cb6816fc133977264e89f9e1e85a8722bb9417ff3c4e90cfa2b126a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/tegra/fuse/speedo-tegra20.c",
  "human_readable_source": "\n \n\n#include <linux/bug.h>\n#include <linux/device.h>\n#include <linux/kernel.h>\n\n#include <soc/tegra/fuse.h>\n\n#include \"fuse.h\"\n\n#define CPU_SPEEDO_LSBIT\t\t20\n#define CPU_SPEEDO_MSBIT\t\t29\n#define CPU_SPEEDO_REDUND_LSBIT\t\t30\n#define CPU_SPEEDO_REDUND_MSBIT\t\t39\n#define CPU_SPEEDO_REDUND_OFFS\t(CPU_SPEEDO_REDUND_MSBIT - CPU_SPEEDO_MSBIT)\n\n#define SOC_SPEEDO_LSBIT\t\t40\n#define SOC_SPEEDO_MSBIT\t\t47\n#define SOC_SPEEDO_REDUND_LSBIT\t\t48\n#define SOC_SPEEDO_REDUND_MSBIT\t\t55\n#define SOC_SPEEDO_REDUND_OFFS\t(SOC_SPEEDO_REDUND_MSBIT - SOC_SPEEDO_MSBIT)\n\n#define SPEEDO_MULT\t\t\t4\n\n#define PROCESS_CORNERS_NUM\t\t4\n\n#define SPEEDO_ID_SELECT_0(rev)\t\t((rev) <= 2)\n#define SPEEDO_ID_SELECT_1(sku)\t\t\\\n\t(((sku) != 20) && ((sku) != 23) && ((sku) != 24) && \\\n\t ((sku) != 27) && ((sku) != 28))\n\nenum {\n\tSPEEDO_ID_0,\n\tSPEEDO_ID_1,\n\tSPEEDO_ID_2,\n\tSPEEDO_ID_COUNT,\n};\n\nstatic const u32 __initconst cpu_process_speedos[][PROCESS_CORNERS_NUM] = {\n\t{315, 366, 420, UINT_MAX},\n\t{303, 368, 419, UINT_MAX},\n\t{316, 331, 383, UINT_MAX},\n};\n\nstatic const u32 __initconst soc_process_speedos[][PROCESS_CORNERS_NUM] = {\n\t{165, 195, 224, UINT_MAX},\n\t{165, 195, 224, UINT_MAX},\n\t{165, 195, 224, UINT_MAX},\n};\n\nvoid __init tegra20_init_speedo_data(struct tegra_sku_info *sku_info)\n{\n\tu32 reg;\n\tu32 val;\n\tint i;\n\n\tBUILD_BUG_ON(ARRAY_SIZE(cpu_process_speedos) != SPEEDO_ID_COUNT);\n\tBUILD_BUG_ON(ARRAY_SIZE(soc_process_speedos) != SPEEDO_ID_COUNT);\n\n\tif (SPEEDO_ID_SELECT_0(sku_info->revision))\n\t\tsku_info->soc_speedo_id = SPEEDO_ID_0;\n\telse if (SPEEDO_ID_SELECT_1(sku_info->sku_id))\n\t\tsku_info->soc_speedo_id = SPEEDO_ID_1;\n\telse\n\t\tsku_info->soc_speedo_id = SPEEDO_ID_2;\n\n\tval = 0;\n\tfor (i = CPU_SPEEDO_MSBIT; i >= CPU_SPEEDO_LSBIT; i--) {\n\t\treg = tegra_fuse_read_spare(i) |\n\t\t\ttegra_fuse_read_spare(i + CPU_SPEEDO_REDUND_OFFS);\n\t\tval = (val << 1) | (reg & 0x1);\n\t}\n\tval = val * SPEEDO_MULT;\n\tpr_debug(\"Tegra CPU speedo value %u\\n\", val);\n\n\tfor (i = 0; i < (PROCESS_CORNERS_NUM - 1); i++) {\n\t\tif (val <= cpu_process_speedos[sku_info->soc_speedo_id][i])\n\t\t\tbreak;\n\t}\n\tsku_info->cpu_process_id = i;\n\n\tval = 0;\n\tfor (i = SOC_SPEEDO_MSBIT; i >= SOC_SPEEDO_LSBIT; i--) {\n\t\treg = tegra_fuse_read_spare(i) |\n\t\t\ttegra_fuse_read_spare(i + SOC_SPEEDO_REDUND_OFFS);\n\t\tval = (val << 1) | (reg & 0x1);\n\t}\n\tval = val * SPEEDO_MULT;\n\tpr_debug(\"Core speedo value %u\\n\", val);\n\n\tfor (i = 0; i < (PROCESS_CORNERS_NUM - 1); i++) {\n\t\tif (val <= soc_process_speedos[sku_info->soc_speedo_id][i])\n\t\t\tbreak;\n\t}\n\tsku_info->soc_process_id = i;\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}