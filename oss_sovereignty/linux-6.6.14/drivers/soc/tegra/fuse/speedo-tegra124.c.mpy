{
  "module_name": "speedo-tegra124.c",
  "hash_id": "d53d38237de2f029956fa556a2f5bd41137912d0cd60f638b9b22a677341fdff",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/tegra/fuse/speedo-tegra124.c",
  "human_readable_source": "\n \n\n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/bug.h>\n\n#include <soc/tegra/fuse.h>\n\n#include \"fuse.h\"\n\n#define CPU_PROCESS_CORNERS\t2\n#define GPU_PROCESS_CORNERS\t2\n#define SOC_PROCESS_CORNERS\t2\n\n#define FUSE_CPU_SPEEDO_0\t0x14\n#define FUSE_CPU_SPEEDO_1\t0x2c\n#define FUSE_CPU_SPEEDO_2\t0x30\n#define FUSE_SOC_SPEEDO_0\t0x34\n#define FUSE_SOC_SPEEDO_1\t0x38\n#define FUSE_SOC_SPEEDO_2\t0x3c\n#define FUSE_CPU_IDDQ\t\t0x18\n#define FUSE_SOC_IDDQ\t\t0x40\n#define FUSE_GPU_IDDQ\t\t0x128\n#define FUSE_FT_REV\t\t0x28\n\nenum {\n\tTHRESHOLD_INDEX_0,\n\tTHRESHOLD_INDEX_1,\n\tTHRESHOLD_INDEX_COUNT,\n};\n\nstatic const u32 __initconst cpu_process_speedos[][CPU_PROCESS_CORNERS] = {\n\t{2190,\tUINT_MAX},\n\t{0,\tUINT_MAX},\n};\n\nstatic const u32 __initconst gpu_process_speedos[][GPU_PROCESS_CORNERS] = {\n\t{1965,\tUINT_MAX},\n\t{0,\tUINT_MAX},\n};\n\nstatic const u32 __initconst soc_process_speedos[][SOC_PROCESS_CORNERS] = {\n\t{2101,\tUINT_MAX},\n\t{0,\tUINT_MAX},\n};\n\nstatic void __init rev_sku_to_speedo_ids(struct tegra_sku_info *sku_info,\n\t\t\t\t\t int *threshold)\n{\n\tint sku = sku_info->sku_id;\n\n\t \n\tsku_info->cpu_speedo_id = 0;\n\tsku_info->soc_speedo_id = 0;\n\tsku_info->gpu_speedo_id = 0;\n\t*threshold = THRESHOLD_INDEX_0;\n\n\tswitch (sku) {\n\tcase 0x00:  \n\tcase 0x0F:\n\tcase 0x23:\n\t\t \n\t\tbreak;\n\tcase 0x83:\n\t\tsku_info->cpu_speedo_id = 2;\n\t\tbreak;\n\n\tcase 0x1F:\n\tcase 0x87:\n\tcase 0x27:\n\t\tsku_info->cpu_speedo_id = 2;\n\t\tsku_info->soc_speedo_id = 0;\n\t\tsku_info->gpu_speedo_id = 1;\n\t\t*threshold = THRESHOLD_INDEX_0;\n\t\tbreak;\n\tcase 0x81:\n\tcase 0x21:\n\tcase 0x07:\n\t\tsku_info->cpu_speedo_id = 1;\n\t\tsku_info->soc_speedo_id = 1;\n\t\tsku_info->gpu_speedo_id = 1;\n\t\t*threshold = THRESHOLD_INDEX_1;\n\t\tbreak;\n\tcase 0x49:\n\tcase 0x4A:\n\tcase 0x48:\n\t\tsku_info->cpu_speedo_id = 4;\n\t\tsku_info->soc_speedo_id = 2;\n\t\tsku_info->gpu_speedo_id = 3;\n\t\t*threshold = THRESHOLD_INDEX_1;\n\t\tbreak;\n\tdefault:\n\t\tpr_err(\"Tegra Unknown SKU %d\\n\", sku);\n\t\t \n\t\tbreak;\n\t}\n}\n\nvoid __init tegra124_init_speedo_data(struct tegra_sku_info *sku_info)\n{\n\tint i, threshold, soc_speedo_0_value;\n\n\tBUILD_BUG_ON(ARRAY_SIZE(cpu_process_speedos) !=\n\t\t\tTHRESHOLD_INDEX_COUNT);\n\tBUILD_BUG_ON(ARRAY_SIZE(gpu_process_speedos) !=\n\t\t\tTHRESHOLD_INDEX_COUNT);\n\tBUILD_BUG_ON(ARRAY_SIZE(soc_process_speedos) !=\n\t\t\tTHRESHOLD_INDEX_COUNT);\n\n\tsku_info->cpu_speedo_value = tegra_fuse_read_early(FUSE_CPU_SPEEDO_0);\n\tif (sku_info->cpu_speedo_value == 0) {\n\t\tpr_warn(\"Tegra Warning: Speedo value not fused.\\n\");\n\t\tWARN_ON(1);\n\t\treturn;\n\t}\n\n\t \n\tsku_info->gpu_speedo_value = tegra_fuse_read_early(FUSE_CPU_SPEEDO_2);\n\tsoc_speedo_0_value = tegra_fuse_read_early(FUSE_SOC_SPEEDO_0);\n\n\trev_sku_to_speedo_ids(sku_info, &threshold);\n\n\tsku_info->cpu_iddq_value = tegra_fuse_read_early(FUSE_CPU_IDDQ);\n\n\tfor (i = 0; i < GPU_PROCESS_CORNERS; i++)\n\t\tif (sku_info->gpu_speedo_value <\n\t\t\tgpu_process_speedos[threshold][i])\n\t\t\tbreak;\n\tsku_info->gpu_process_id = i;\n\n\tfor (i = 0; i < CPU_PROCESS_CORNERS; i++)\n\t\tif (sku_info->cpu_speedo_value <\n\t\t\tcpu_process_speedos[threshold][i])\n\t\t\t\tbreak;\n\tsku_info->cpu_process_id = i;\n\n\tfor (i = 0; i < SOC_PROCESS_CORNERS; i++)\n\t\tif (soc_speedo_0_value <\n\t\t\tsoc_process_speedos[threshold][i])\n\t\t\tbreak;\n\tsku_info->soc_process_id = i;\n\n\tpr_debug(\"Tegra GPU Speedo ID=%d, Speedo Value=%d\\n\",\n\t\t sku_info->gpu_speedo_id, sku_info->gpu_speedo_value);\n}\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}