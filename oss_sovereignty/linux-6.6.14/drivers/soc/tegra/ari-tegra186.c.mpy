{
  "module_name": "ari-tegra186.c",
  "hash_id": "eede7edc4fd29dd5fdf2f274234c487d07263826075b53118f0e453828975fc3",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/tegra/ari-tegra186.c",
  "human_readable_source": "\n \n\n#include <linux/arm-smccc.h>\n#include <linux/kernel.h>\n#include <linux/of.h>\n#include <linux/panic_notifier.h>\n\n#define SMC_SIP_INVOKE_MCE\t\t\t0xc2ffff00\n#define MCE_SMC_READ_MCA\t\t\t12\n\n#define MCA_ARI_CMD_RD_SERR\t\t\t1\n\n#define MCA_ARI_RW_SUBIDX_STAT\t\t\t1\n#define SERR_STATUS_VAL\t\t\t\tBIT_ULL(63)\n\n#define MCA_ARI_RW_SUBIDX_ADDR\t\t\t2\n#define MCA_ARI_RW_SUBIDX_MSC1\t\t\t3\n#define MCA_ARI_RW_SUBIDX_MSC2\t\t\t4\n\nstatic const char * const bank_names[] = {\n\t\"SYS:DPMU\", \"ROC:IOB\", \"ROC:MCB\", \"ROC:CCE\", \"ROC:CQX\", \"ROC:CTU\",\n};\n\nstatic void read_uncore_mca(u8 cmd, u8 idx, u8 subidx, u8 inst, u64 *data)\n{\n\tstruct arm_smccc_res res;\n\n\tarm_smccc_smc(SMC_SIP_INVOKE_MCE | MCE_SMC_READ_MCA,\n\t\t      ((u64)inst << 24) | ((u64)idx << 16) |\n\t\t\t      ((u64)subidx << 8) | ((u64)cmd << 0),\n\t\t      0, 0, 0, 0, 0, 0, &res);\n\n\t*data = res.a2;\n}\n\nstatic int tegra186_ari_panic_handler(struct notifier_block *nb,\n\t\t\t\t      unsigned long code, void *unused)\n{\n\tu64 status;\n\tint i;\n\n\tfor (i = 0; i < ARRAY_SIZE(bank_names); i++) {\n\t\tread_uncore_mca(MCA_ARI_CMD_RD_SERR, i, MCA_ARI_RW_SUBIDX_STAT,\n\t\t\t\t0, &status);\n\n\t\tif (status & SERR_STATUS_VAL) {\n\t\t\tu64 addr, misc1, misc2;\n\n\t\t\tread_uncore_mca(MCA_ARI_CMD_RD_SERR, i,\n\t\t\t\t\tMCA_ARI_RW_SUBIDX_ADDR, 0, &addr);\n\t\t\tread_uncore_mca(MCA_ARI_CMD_RD_SERR, i,\n\t\t\t\t\tMCA_ARI_RW_SUBIDX_MSC1, 0, &misc1);\n\t\t\tread_uncore_mca(MCA_ARI_CMD_RD_SERR, i,\n\t\t\t\t\tMCA_ARI_RW_SUBIDX_MSC2, 0, &misc2);\n\n\t\t\tpr_crit(\"Machine Check Error in %s\\n\"\n\t\t\t\t\"  status=0x%llx addr=0x%llx\\n\"\n\t\t\t\t\"  msc1=0x%llx msc2=0x%llx\\n\",\n\t\t\t\tbank_names[i], status, addr, misc1, misc2);\n\t\t}\n\t}\n\n\treturn NOTIFY_DONE;\n}\n\nstatic struct notifier_block tegra186_ari_panic_nb = {\n\t.notifier_call = tegra186_ari_panic_handler,\n};\n\nstatic int __init tegra186_ari_init(void)\n{\n\tif (of_machine_is_compatible(\"nvidia,tegra186\"))\n\t\tatomic_notifier_chain_register(&panic_notifier_list, &tegra186_ari_panic_nb);\n\n\treturn 0;\n}\nearly_initcall(tegra186_ari_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}