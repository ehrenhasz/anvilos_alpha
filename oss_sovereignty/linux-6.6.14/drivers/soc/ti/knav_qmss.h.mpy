{
  "module_name": "knav_qmss.h",
  "hash_id": "bb5a216f2a1439127b8a2b13e05d028af88ab68a622dfb3b29bbc04094f26bf7",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/ti/knav_qmss.h",
  "human_readable_source": " \n \n\n#ifndef __KNAV_QMSS_H__\n#define __KNAV_QMSS_H__\n\n#include <linux/percpu.h>\n\n#define THRESH_GTE\tBIT(7)\n#define THRESH_LT\t0\n\n#define PDSP_CTRL_PC_MASK\t0xffff0000\n#define PDSP_CTRL_SOFT_RESET\tBIT(0)\n#define PDSP_CTRL_ENABLE\tBIT(1)\n#define PDSP_CTRL_RUNNING\tBIT(15)\n\n#define ACC_MAX_CHANNEL\t\t48\n#define ACC_DEFAULT_PERIOD\t25  \n\n#define ACC_CHANNEL_INT_BASE\t\t2\n\n#define ACC_LIST_ENTRY_TYPE\t\t1\n#define ACC_LIST_ENTRY_WORDS\t\t(1 << ACC_LIST_ENTRY_TYPE)\n#define ACC_LIST_ENTRY_QUEUE_IDX\t0\n#define ACC_LIST_ENTRY_DESC_IDX\t(ACC_LIST_ENTRY_WORDS - 1)\n\n#define ACC_CMD_DISABLE_CHANNEL\t0x80\n#define ACC_CMD_ENABLE_CHANNEL\t0x81\n#define ACC_CFG_MULTI_QUEUE\t\tBIT(21)\n\n#define ACC_INTD_OFFSET_EOI\t\t(0x0010)\n#define ACC_INTD_OFFSET_COUNT(ch)\t(0x0300 + 4 * (ch))\n#define ACC_INTD_OFFSET_STATUS(ch)\t(0x0200 + 4 * ((ch) / 32))\n\n#define RANGE_MAX_IRQS\t\t\t64\n\n#define ACC_DESCS_MAX\t\tSZ_1K\n#define ACC_DESCS_MASK\t\t(ACC_DESCS_MAX - 1)\n#define DESC_SIZE_MASK\t\t0xful\n#define DESC_PTR_MASK\t\t(~DESC_SIZE_MASK)\n\n#define KNAV_NAME_SIZE\t\t\t32\n\nenum knav_acc_result {\n\tACC_RET_IDLE,\n\tACC_RET_SUCCESS,\n\tACC_RET_INVALID_COMMAND,\n\tACC_RET_INVALID_CHANNEL,\n\tACC_RET_INACTIVE_CHANNEL,\n\tACC_RET_ACTIVE_CHANNEL,\n\tACC_RET_INVALID_QUEUE,\n\tACC_RET_INVALID_RET,\n};\n\nstruct knav_reg_config {\n\tu32\t\trevision;\n\tu32\t\t__pad1;\n\tu32\t\tdivert;\n\tu32\t\tlink_ram_base0;\n\tu32\t\tlink_ram_size0;\n\tu32\t\tlink_ram_base1;\n\tu32\t\t__pad2[2];\n\tu32\t\tstarvation[];\n};\n\nstruct knav_reg_region {\n\tu32\t\tbase;\n\tu32\t\tstart_index;\n\tu32\t\tsize_count;\n\tu32\t\t__pad;\n};\n\nstruct knav_reg_pdsp_regs {\n\tu32\t\tcontrol;\n\tu32\t\tstatus;\n\tu32\t\tcycle_count;\n\tu32\t\tstall_count;\n};\n\nstruct knav_reg_acc_command {\n\tu32\t\tcommand;\n\tu32\t\tqueue_mask;\n\tu32\t\tlist_dma;\n\tu32\t\tqueue_num;\n\tu32\t\ttimer_config;\n};\n\nstruct knav_link_ram_block {\n\tdma_addr_t\t dma;\n\tvoid\t\t*virt;\n\tsize_t\t\t size;\n};\n\nstruct knav_acc_info {\n\tu32\t\t\t pdsp_id;\n\tu32\t\t\t start_channel;\n\tu32\t\t\t list_entries;\n\tu32\t\t\t pacing_mode;\n\tu32\t\t\t timer_count;\n\tint\t\t\t mem_size;\n\tint\t\t\t list_size;\n\tstruct knav_pdsp_info\t*pdsp;\n};\n\nstruct knav_acc_channel {\n\tu32\t\t\tchannel;\n\tu32\t\t\tlist_index;\n\tu32\t\t\topen_mask;\n\tu32\t\t\t*list_cpu[2];\n\tdma_addr_t\t\tlist_dma[2];\n\tchar\t\t\tname[KNAV_NAME_SIZE];\n\tatomic_t\t\tretrigger_count;\n};\n\nstruct knav_pdsp_info {\n\tconst char\t\t\t\t\t*name;\n\tstruct knav_reg_pdsp_regs  __iomem\t\t*regs;\n\tunion {\n\t\tvoid __iomem\t\t\t\t*command;\n\t\tstruct knav_reg_acc_command __iomem\t*acc_command;\n\t\tu32 __iomem\t\t\t\t*qos_command;\n\t};\n\tvoid __iomem\t\t\t\t\t*intd;\n\tu32 __iomem\t\t\t\t\t*iram;\n\tu32\t\t\t\t\t\tid;\n\tstruct list_head\t\t\t\tlist;\n\tbool\t\t\t\t\t\tloaded;\n\tbool\t\t\t\t\t\tstarted;\n};\n\nstruct knav_qmgr_info {\n\tunsigned\t\t\tstart_queue;\n\tunsigned\t\t\tnum_queues;\n\tstruct knav_reg_config __iomem\t*reg_config;\n\tstruct knav_reg_region __iomem\t*reg_region;\n\tstruct knav_reg_queue __iomem\t*reg_push, *reg_pop, *reg_peek;\n\tvoid __iomem\t\t\t*reg_status;\n\tstruct list_head\t\tlist;\n};\n\n#define KNAV_NUM_LINKRAM\t2\n\n \nstruct knav_queue_stats {\n\tunsigned int pushes;\n\tunsigned int pops;\n\tunsigned int push_errors;\n\tunsigned int pop_errors;\n\tunsigned int notifies;\n};\n\n \nstruct knav_reg_queue {\n\tu32\t\tentry_count;\n\tu32\t\tbyte_count;\n\tu32\t\tpacket_size;\n\tu32\t\tptr_size_thresh;\n};\n\n \nstruct knav_region {\n\tdma_addr_t\t\tdma_start, dma_end;\n\tvoid\t\t\t*virt_start, *virt_end;\n\tunsigned\t\tdesc_size;\n\tunsigned\t\tused_desc;\n\tunsigned\t\tid;\n\tunsigned\t\tnum_desc;\n\tunsigned\t\tlink_index;\n\tconst char\t\t*name;\n\tstruct list_head\tlist;\n\tstruct list_head\tpools;\n};\n\n \nstruct knav_pool {\n\tstruct device\t\t\t*dev;\n\tstruct knav_region\t\t*region;\n\tstruct knav_queue\t\t*queue;\n\tstruct knav_device\t\t*kdev;\n\tint\t\t\t\tregion_offset;\n\tint\t\t\t\tnum_desc;\n\tint\t\t\t\tdesc_size;\n\tint\t\t\t\tregion_id;\n\tconst char\t\t\t*name;\n\tstruct list_head\t\tlist;\n\tstruct list_head\t\tregion_inst;\n};\n\n \nstruct knav_queue_inst {\n\tu32\t\t\t\t*descs;\n\tatomic_t\t\t\tdesc_head, desc_tail, desc_count;\n\tstruct knav_acc_channel\t*acc;\n\tstruct knav_device\t\t*kdev;\n\tstruct knav_range_info\t\t*range;\n\tstruct knav_qmgr_info\t\t*qmgr;\n\tu32\t\t\t\tid;\n\tint\t\t\t\tirq_num;\n\tint\t\t\t\tnotify_needed;\n\tatomic_t\t\t\tnum_notifiers;\n\tstruct list_head\t\thandles;\n\tconst char\t\t\t*name;\n\tconst char\t\t\t*irq_name;\n};\n\n \nstruct knav_queue {\n\tstruct knav_reg_queue __iomem\t*reg_push, *reg_pop, *reg_peek;\n\tstruct knav_queue_inst\t\t*inst;\n\tstruct knav_queue_stats __percpu\t*stats;\n\tknav_queue_notify_fn\t\tnotifier_fn;\n\tvoid\t\t\t\t*notifier_fn_arg;\n\tatomic_t\t\t\tnotifier_enabled;\n\tstruct rcu_head\t\t\trcu;\n\tunsigned\t\t\tflags;\n\tstruct list_head\t\tlist;\n};\n\nenum qmss_version {\n\tQMSS,\n\tQMSS_66AK2G,\n};\n\nstruct knav_device {\n\tstruct device\t\t\t\t*dev;\n\tunsigned\t\t\t\tbase_id;\n\tunsigned\t\t\t\tnum_queues;\n\tunsigned\t\t\t\tnum_queues_in_use;\n\tunsigned\t\t\t\tinst_shift;\n\tstruct knav_link_ram_block\t\tlink_rams[KNAV_NUM_LINKRAM];\n\tvoid\t\t\t\t\t*instances;\n\tstruct list_head\t\t\tregions;\n\tstruct list_head\t\t\tqueue_ranges;\n\tstruct list_head\t\t\tpools;\n\tstruct list_head\t\t\tpdsps;\n\tstruct list_head\t\t\tqmgrs;\n\tenum qmss_version\t\t\tversion;\n};\n\nstruct knav_range_ops {\n\tint\t(*init_range)(struct knav_range_info *range);\n\tint\t(*free_range)(struct knav_range_info *range);\n\tint\t(*init_queue)(struct knav_range_info *range,\n\t\t\t      struct knav_queue_inst *inst);\n\tint\t(*open_queue)(struct knav_range_info *range,\n\t\t\t      struct knav_queue_inst *inst, unsigned flags);\n\tint\t(*close_queue)(struct knav_range_info *range,\n\t\t\t       struct knav_queue_inst *inst);\n\tint\t(*set_notify)(struct knav_range_info *range,\n\t\t\t      struct knav_queue_inst *inst, bool enabled);\n};\n\nstruct knav_irq_info {\n\tint\t\tirq;\n\tstruct cpumask\t*cpu_mask;\n};\n\nstruct knav_range_info {\n\tconst char\t\t\t*name;\n\tstruct knav_device\t\t*kdev;\n\tunsigned\t\t\tqueue_base;\n\tunsigned\t\t\tnum_queues;\n\tvoid\t\t\t\t*queue_base_inst;\n\tunsigned\t\t\tflags;\n\tstruct list_head\t\tlist;\n\tstruct knav_range_ops\t\t*ops;\n\tstruct knav_acc_info\t\tacc_info;\n\tstruct knav_acc_channel\t*acc;\n\tunsigned\t\t\tnum_irqs;\n\tstruct knav_irq_info\t\tirqs[RANGE_MAX_IRQS];\n};\n\n#define RANGE_RESERVED\t\tBIT(0)\n#define RANGE_HAS_IRQ\t\tBIT(1)\n#define RANGE_HAS_ACCUMULATOR\tBIT(2)\n#define RANGE_MULTI_QUEUE\tBIT(3)\n\n#define for_each_region(kdev, region)\t\t\t\t\\\n\tlist_for_each_entry(region, &kdev->regions, list)\n\n#define first_region(kdev)\t\t\t\t\t\\\n\tlist_first_entry_or_null(&kdev->regions, \\\n\t\t\t\t struct knav_region, list)\n\n#define for_each_queue_range(kdev, range)\t\t\t\\\n\tlist_for_each_entry(range, &kdev->queue_ranges, list)\n\n#define first_queue_range(kdev)\t\t\t\t\t\\\n\tlist_first_entry_or_null(&kdev->queue_ranges, \\\n\t\t\t\t struct knav_range_info, list)\n\n#define for_each_pool(kdev, pool)\t\t\t\t\\\n\tlist_for_each_entry(pool, &kdev->pools, list)\n\n#define for_each_pdsp(kdev, pdsp)\t\t\t\t\\\n\tlist_for_each_entry(pdsp, &kdev->pdsps, list)\n\n#define for_each_qmgr(kdev, qmgr)\t\t\t\t\\\n\tlist_for_each_entry(qmgr, &kdev->qmgrs, list)\n\nstatic inline struct knav_pdsp_info *\nknav_find_pdsp(struct knav_device *kdev, unsigned pdsp_id)\n{\n\tstruct knav_pdsp_info *pdsp;\n\n\tfor_each_pdsp(kdev, pdsp)\n\t\tif (pdsp_id == pdsp->id)\n\t\t\treturn pdsp;\n\treturn NULL;\n}\n\nextern int knav_init_acc_range(struct knav_device *kdev,\n\t\t\t\t\tstruct device_node *node,\n\t\t\t\t\tstruct knav_range_info *range);\nextern void knav_queue_notify(struct knav_queue_inst *inst);\n\n#endif  \n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}