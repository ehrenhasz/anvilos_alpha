{
  "module_name": "meson-clk-measure.c",
  "hash_id": "8aab012b0f7a29e1319d5073e81ef7470f146ce8efa62119380c353052a41c0a",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/amlogic/meson-clk-measure.c",
  "human_readable_source": "\n \n\n#include <linux/of_address.h>\n#include <linux/platform_device.h>\n#include <linux/bitfield.h>\n#include <linux/seq_file.h>\n#include <linux/debugfs.h>\n#include <linux/regmap.h>\n#include <linux/module.h>\n\nstatic DEFINE_MUTEX(measure_lock);\n\n#define MSR_CLK_DUTY\t\t0x0\n#define MSR_CLK_REG0\t\t0x4\n#define MSR_CLK_REG1\t\t0x8\n#define MSR_CLK_REG2\t\t0xc\n\n#define MSR_DURATION\t\tGENMASK(15, 0)\n#define MSR_ENABLE\t\tBIT(16)\n#define MSR_CONT\t\tBIT(17)  \n#define MSR_INTR\t\tBIT(18)  \n#define MSR_RUN\t\t\tBIT(19)\n#define MSR_CLK_SRC\t\tGENMASK(26, 20)\n#define MSR_BUSY\t\tBIT(31)\n\n#define MSR_VAL_MASK\t\tGENMASK(15, 0)\n\n#define DIV_MIN\t\t\t32\n#define DIV_STEP\t\t32\n#define DIV_MAX\t\t\t640\n\n#define CLK_MSR_MAX\t\t128\n\nstruct meson_msr_id {\n\tstruct meson_msr *priv;\n\tunsigned int id;\n\tconst char *name;\n};\n\nstruct meson_msr {\n\tstruct regmap *regmap;\n\tstruct meson_msr_id msr_table[CLK_MSR_MAX];\n};\n\n#define CLK_MSR_ID(__id, __name) \\\n\t[__id] = {.id = __id, .name = __name,}\n\nstatic struct meson_msr_id clk_msr_m8[CLK_MSR_MAX] = {\n\tCLK_MSR_ID(0, \"ring_osc_out_ee0\"),\n\tCLK_MSR_ID(1, \"ring_osc_out_ee1\"),\n\tCLK_MSR_ID(2, \"ring_osc_out_ee2\"),\n\tCLK_MSR_ID(3, \"a9_ring_osck\"),\n\tCLK_MSR_ID(6, \"vid_pll\"),\n\tCLK_MSR_ID(7, \"clk81\"),\n\tCLK_MSR_ID(8, \"encp\"),\n\tCLK_MSR_ID(9, \"encl\"),\n\tCLK_MSR_ID(11, \"eth_rmii\"),\n\tCLK_MSR_ID(13, \"amclk\"),\n\tCLK_MSR_ID(14, \"fec_clk_0\"),\n\tCLK_MSR_ID(15, \"fec_clk_1\"),\n\tCLK_MSR_ID(16, \"fec_clk_2\"),\n\tCLK_MSR_ID(18, \"a9_clk_div16\"),\n\tCLK_MSR_ID(19, \"hdmi_sys\"),\n\tCLK_MSR_ID(20, \"rtc_osc_clk_out\"),\n\tCLK_MSR_ID(21, \"i2s_clk_in_src0\"),\n\tCLK_MSR_ID(22, \"clk_rmii_from_pad\"),\n\tCLK_MSR_ID(23, \"hdmi_ch0_tmds\"),\n\tCLK_MSR_ID(24, \"lvds_fifo\"),\n\tCLK_MSR_ID(26, \"sc_clk_int\"),\n\tCLK_MSR_ID(28, \"sar_adc\"),\n\tCLK_MSR_ID(30, \"mpll_clk_test_out\"),\n\tCLK_MSR_ID(31, \"audac_clkpi\"),\n\tCLK_MSR_ID(32, \"vdac\"),\n\tCLK_MSR_ID(33, \"sdhc_rx\"),\n\tCLK_MSR_ID(34, \"sdhc_sd\"),\n\tCLK_MSR_ID(35, \"mali\"),\n\tCLK_MSR_ID(36, \"hdmi_tx_pixel\"),\n\tCLK_MSR_ID(38, \"vdin_meas\"),\n\tCLK_MSR_ID(39, \"pcm_sclk\"),\n\tCLK_MSR_ID(40, \"pcm_mclk\"),\n\tCLK_MSR_ID(41, \"eth_rx_tx\"),\n\tCLK_MSR_ID(42, \"pwm_d\"),\n\tCLK_MSR_ID(43, \"pwm_c\"),\n\tCLK_MSR_ID(44, \"pwm_b\"),\n\tCLK_MSR_ID(45, \"pwm_a\"),\n\tCLK_MSR_ID(46, \"pcm2_sclk\"),\n\tCLK_MSR_ID(47, \"ddr_dpll_pt\"),\n\tCLK_MSR_ID(48, \"pwm_f\"),\n\tCLK_MSR_ID(49, \"pwm_e\"),\n\tCLK_MSR_ID(59, \"hcodec\"),\n\tCLK_MSR_ID(60, \"usb_32k_alt\"),\n\tCLK_MSR_ID(61, \"gpio\"),\n\tCLK_MSR_ID(62, \"vid2_pll\"),\n\tCLK_MSR_ID(63, \"mipi_csi_cfg\"),\n};\n\nstatic struct meson_msr_id clk_msr_gx[CLK_MSR_MAX] = {\n\tCLK_MSR_ID(0, \"ring_osc_out_ee_0\"),\n\tCLK_MSR_ID(1, \"ring_osc_out_ee_1\"),\n\tCLK_MSR_ID(2, \"ring_osc_out_ee_2\"),\n\tCLK_MSR_ID(3, \"a53_ring_osc\"),\n\tCLK_MSR_ID(4, \"gp0_pll\"),\n\tCLK_MSR_ID(6, \"enci\"),\n\tCLK_MSR_ID(7, \"clk81\"),\n\tCLK_MSR_ID(8, \"encp\"),\n\tCLK_MSR_ID(9, \"encl\"),\n\tCLK_MSR_ID(10, \"vdac\"),\n\tCLK_MSR_ID(11, \"rgmii_tx\"),\n\tCLK_MSR_ID(12, \"pdm\"),\n\tCLK_MSR_ID(13, \"amclk\"),\n\tCLK_MSR_ID(14, \"fec_0\"),\n\tCLK_MSR_ID(15, \"fec_1\"),\n\tCLK_MSR_ID(16, \"fec_2\"),\n\tCLK_MSR_ID(17, \"sys_pll_div16\"),\n\tCLK_MSR_ID(18, \"sys_cpu_div16\"),\n\tCLK_MSR_ID(19, \"hdmitx_sys\"),\n\tCLK_MSR_ID(20, \"rtc_osc_out\"),\n\tCLK_MSR_ID(21, \"i2s_in_src0\"),\n\tCLK_MSR_ID(22, \"eth_phy_ref\"),\n\tCLK_MSR_ID(23, \"hdmi_todig\"),\n\tCLK_MSR_ID(26, \"sc_int\"),\n\tCLK_MSR_ID(28, \"sar_adc\"),\n\tCLK_MSR_ID(31, \"mpll_test_out\"),\n\tCLK_MSR_ID(32, \"vdec\"),\n\tCLK_MSR_ID(35, \"mali\"),\n\tCLK_MSR_ID(36, \"hdmi_tx_pixel\"),\n\tCLK_MSR_ID(37, \"i958\"),\n\tCLK_MSR_ID(38, \"vdin_meas\"),\n\tCLK_MSR_ID(39, \"pcm_sclk\"),\n\tCLK_MSR_ID(40, \"pcm_mclk\"),\n\tCLK_MSR_ID(41, \"eth_rx_or_rmii\"),\n\tCLK_MSR_ID(42, \"mp0_out\"),\n\tCLK_MSR_ID(43, \"fclk_div5\"),\n\tCLK_MSR_ID(44, \"pwm_b\"),\n\tCLK_MSR_ID(45, \"pwm_a\"),\n\tCLK_MSR_ID(46, \"vpu\"),\n\tCLK_MSR_ID(47, \"ddr_dpll_pt\"),\n\tCLK_MSR_ID(48, \"mp1_out\"),\n\tCLK_MSR_ID(49, \"mp2_out\"),\n\tCLK_MSR_ID(50, \"mp3_out\"),\n\tCLK_MSR_ID(51, \"nand_core\"),\n\tCLK_MSR_ID(52, \"sd_emmc_b\"),\n\tCLK_MSR_ID(53, \"sd_emmc_a\"),\n\tCLK_MSR_ID(55, \"vid_pll_div_out\"),\n\tCLK_MSR_ID(56, \"cci\"),\n\tCLK_MSR_ID(57, \"wave420l_c\"),\n\tCLK_MSR_ID(58, \"wave420l_b\"),\n\tCLK_MSR_ID(59, \"hcodec\"),\n\tCLK_MSR_ID(60, \"alt_32k\"),\n\tCLK_MSR_ID(61, \"gpio_msr\"),\n\tCLK_MSR_ID(62, \"hevc\"),\n\tCLK_MSR_ID(66, \"vid_lock\"),\n\tCLK_MSR_ID(70, \"pwm_f\"),\n\tCLK_MSR_ID(71, \"pwm_e\"),\n\tCLK_MSR_ID(72, \"pwm_d\"),\n\tCLK_MSR_ID(73, \"pwm_c\"),\n\tCLK_MSR_ID(75, \"aoclkx2_int\"),\n\tCLK_MSR_ID(76, \"aoclk_int\"),\n\tCLK_MSR_ID(77, \"rng_ring_osc_0\"),\n\tCLK_MSR_ID(78, \"rng_ring_osc_1\"),\n\tCLK_MSR_ID(79, \"rng_ring_osc_2\"),\n\tCLK_MSR_ID(80, \"rng_ring_osc_3\"),\n\tCLK_MSR_ID(81, \"vapb\"),\n\tCLK_MSR_ID(82, \"ge2d\"),\n};\n\nstatic struct meson_msr_id clk_msr_axg[CLK_MSR_MAX] = {\n\tCLK_MSR_ID(0, \"ring_osc_out_ee_0\"),\n\tCLK_MSR_ID(1, \"ring_osc_out_ee_1\"),\n\tCLK_MSR_ID(2, \"ring_osc_out_ee_2\"),\n\tCLK_MSR_ID(3, \"a53_ring_osc\"),\n\tCLK_MSR_ID(4, \"gp0_pll\"),\n\tCLK_MSR_ID(5, \"gp1_pll\"),\n\tCLK_MSR_ID(7, \"clk81\"),\n\tCLK_MSR_ID(9, \"encl\"),\n\tCLK_MSR_ID(17, \"sys_pll_div16\"),\n\tCLK_MSR_ID(18, \"sys_cpu_div16\"),\n\tCLK_MSR_ID(20, \"rtc_osc_out\"),\n\tCLK_MSR_ID(23, \"mmc_clk\"),\n\tCLK_MSR_ID(28, \"sar_adc\"),\n\tCLK_MSR_ID(31, \"mpll_test_out\"),\n\tCLK_MSR_ID(40, \"mod_eth_tx_clk\"),\n\tCLK_MSR_ID(41, \"mod_eth_rx_clk_rmii\"),\n\tCLK_MSR_ID(42, \"mp0_out\"),\n\tCLK_MSR_ID(43, \"fclk_div5\"),\n\tCLK_MSR_ID(44, \"pwm_b\"),\n\tCLK_MSR_ID(45, \"pwm_a\"),\n\tCLK_MSR_ID(46, \"vpu\"),\n\tCLK_MSR_ID(47, \"ddr_dpll_pt\"),\n\tCLK_MSR_ID(48, \"mp1_out\"),\n\tCLK_MSR_ID(49, \"mp2_out\"),\n\tCLK_MSR_ID(50, \"mp3_out\"),\n\tCLK_MSR_ID(51, \"sd_emmm_c\"),\n\tCLK_MSR_ID(52, \"sd_emmc_b\"),\n\tCLK_MSR_ID(61, \"gpio_msr\"),\n\tCLK_MSR_ID(66, \"audio_slv_lrclk_c\"),\n\tCLK_MSR_ID(67, \"audio_slv_lrclk_b\"),\n\tCLK_MSR_ID(68, \"audio_slv_lrclk_a\"),\n\tCLK_MSR_ID(69, \"audio_slv_sclk_c\"),\n\tCLK_MSR_ID(70, \"audio_slv_sclk_b\"),\n\tCLK_MSR_ID(71, \"audio_slv_sclk_a\"),\n\tCLK_MSR_ID(72, \"pwm_d\"),\n\tCLK_MSR_ID(73, \"pwm_c\"),\n\tCLK_MSR_ID(74, \"wifi_beacon\"),\n\tCLK_MSR_ID(75, \"tdmin_lb_lrcl\"),\n\tCLK_MSR_ID(76, \"tdmin_lb_sclk\"),\n\tCLK_MSR_ID(77, \"rng_ring_osc_0\"),\n\tCLK_MSR_ID(78, \"rng_ring_osc_1\"),\n\tCLK_MSR_ID(79, \"rng_ring_osc_2\"),\n\tCLK_MSR_ID(80, \"rng_ring_osc_3\"),\n\tCLK_MSR_ID(81, \"vapb\"),\n\tCLK_MSR_ID(82, \"ge2d\"),\n\tCLK_MSR_ID(84, \"audio_resample\"),\n\tCLK_MSR_ID(85, \"audio_pdm_sys\"),\n\tCLK_MSR_ID(86, \"audio_spdifout\"),\n\tCLK_MSR_ID(87, \"audio_spdifin\"),\n\tCLK_MSR_ID(88, \"audio_lrclk_f\"),\n\tCLK_MSR_ID(89, \"audio_lrclk_e\"),\n\tCLK_MSR_ID(90, \"audio_lrclk_d\"),\n\tCLK_MSR_ID(91, \"audio_lrclk_c\"),\n\tCLK_MSR_ID(92, \"audio_lrclk_b\"),\n\tCLK_MSR_ID(93, \"audio_lrclk_a\"),\n\tCLK_MSR_ID(94, \"audio_sclk_f\"),\n\tCLK_MSR_ID(95, \"audio_sclk_e\"),\n\tCLK_MSR_ID(96, \"audio_sclk_d\"),\n\tCLK_MSR_ID(97, \"audio_sclk_c\"),\n\tCLK_MSR_ID(98, \"audio_sclk_b\"),\n\tCLK_MSR_ID(99, \"audio_sclk_a\"),\n\tCLK_MSR_ID(100, \"audio_mclk_f\"),\n\tCLK_MSR_ID(101, \"audio_mclk_e\"),\n\tCLK_MSR_ID(102, \"audio_mclk_d\"),\n\tCLK_MSR_ID(103, \"audio_mclk_c\"),\n\tCLK_MSR_ID(104, \"audio_mclk_b\"),\n\tCLK_MSR_ID(105, \"audio_mclk_a\"),\n\tCLK_MSR_ID(106, \"pcie_refclk_n\"),\n\tCLK_MSR_ID(107, \"pcie_refclk_p\"),\n\tCLK_MSR_ID(108, \"audio_locker_out\"),\n\tCLK_MSR_ID(109, \"audio_locker_in\"),\n};\n\nstatic struct meson_msr_id clk_msr_g12a[CLK_MSR_MAX] = {\n\tCLK_MSR_ID(0, \"ring_osc_out_ee_0\"),\n\tCLK_MSR_ID(1, \"ring_osc_out_ee_1\"),\n\tCLK_MSR_ID(2, \"ring_osc_out_ee_2\"),\n\tCLK_MSR_ID(3, \"sys_cpu_ring_osc\"),\n\tCLK_MSR_ID(4, \"gp0_pll\"),\n\tCLK_MSR_ID(6, \"enci\"),\n\tCLK_MSR_ID(7, \"clk81\"),\n\tCLK_MSR_ID(8, \"encp\"),\n\tCLK_MSR_ID(9, \"encl\"),\n\tCLK_MSR_ID(10, \"vdac\"),\n\tCLK_MSR_ID(11, \"eth_tx\"),\n\tCLK_MSR_ID(12, \"hifi_pll\"),\n\tCLK_MSR_ID(13, \"mod_tcon\"),\n\tCLK_MSR_ID(14, \"fec_0\"),\n\tCLK_MSR_ID(15, \"fec_1\"),\n\tCLK_MSR_ID(16, \"fec_2\"),\n\tCLK_MSR_ID(17, \"sys_pll_div16\"),\n\tCLK_MSR_ID(18, \"sys_cpu_div16\"),\n\tCLK_MSR_ID(19, \"lcd_an_ph2\"),\n\tCLK_MSR_ID(20, \"rtc_osc_out\"),\n\tCLK_MSR_ID(21, \"lcd_an_ph3\"),\n\tCLK_MSR_ID(22, \"eth_phy_ref\"),\n\tCLK_MSR_ID(23, \"mpll_50m\"),\n\tCLK_MSR_ID(24, \"eth_125m\"),\n\tCLK_MSR_ID(25, \"eth_rmii\"),\n\tCLK_MSR_ID(26, \"sc_int\"),\n\tCLK_MSR_ID(27, \"in_mac\"),\n\tCLK_MSR_ID(28, \"sar_adc\"),\n\tCLK_MSR_ID(29, \"pcie_inp\"),\n\tCLK_MSR_ID(30, \"pcie_inn\"),\n\tCLK_MSR_ID(31, \"mpll_test_out\"),\n\tCLK_MSR_ID(32, \"vdec\"),\n\tCLK_MSR_ID(33, \"sys_cpu_ring_osc_1\"),\n\tCLK_MSR_ID(34, \"eth_mpll_50m\"),\n\tCLK_MSR_ID(35, \"mali\"),\n\tCLK_MSR_ID(36, \"hdmi_tx_pixel\"),\n\tCLK_MSR_ID(37, \"cdac\"),\n\tCLK_MSR_ID(38, \"vdin_meas\"),\n\tCLK_MSR_ID(39, \"bt656\"),\n\tCLK_MSR_ID(41, \"eth_rx_or_rmii\"),\n\tCLK_MSR_ID(42, \"mp0_out\"),\n\tCLK_MSR_ID(43, \"fclk_div5\"),\n\tCLK_MSR_ID(44, \"pwm_b\"),\n\tCLK_MSR_ID(45, \"pwm_a\"),\n\tCLK_MSR_ID(46, \"vpu\"),\n\tCLK_MSR_ID(47, \"ddr_dpll_pt\"),\n\tCLK_MSR_ID(48, \"mp1_out\"),\n\tCLK_MSR_ID(49, \"mp2_out\"),\n\tCLK_MSR_ID(50, \"mp3_out\"),\n\tCLK_MSR_ID(51, \"sd_emmc_c\"),\n\tCLK_MSR_ID(52, \"sd_emmc_b\"),\n\tCLK_MSR_ID(53, \"sd_emmc_a\"),\n\tCLK_MSR_ID(54, \"vpu_clkc\"),\n\tCLK_MSR_ID(55, \"vid_pll_div_out\"),\n\tCLK_MSR_ID(56, \"wave420l_a\"),\n\tCLK_MSR_ID(57, \"wave420l_c\"),\n\tCLK_MSR_ID(58, \"wave420l_b\"),\n\tCLK_MSR_ID(59, \"hcodec\"),\n\tCLK_MSR_ID(61, \"gpio_msr\"),\n\tCLK_MSR_ID(62, \"hevcb\"),\n\tCLK_MSR_ID(63, \"dsi_meas\"),\n\tCLK_MSR_ID(64, \"spicc_1\"),\n\tCLK_MSR_ID(65, \"spicc_0\"),\n\tCLK_MSR_ID(66, \"vid_lock\"),\n\tCLK_MSR_ID(67, \"dsi_phy\"),\n\tCLK_MSR_ID(68, \"hdcp22_esm\"),\n\tCLK_MSR_ID(69, \"hdcp22_skp\"),\n\tCLK_MSR_ID(70, \"pwm_f\"),\n\tCLK_MSR_ID(71, \"pwm_e\"),\n\tCLK_MSR_ID(72, \"pwm_d\"),\n\tCLK_MSR_ID(73, \"pwm_c\"),\n\tCLK_MSR_ID(75, \"hevcf\"),\n\tCLK_MSR_ID(77, \"rng_ring_osc_0\"),\n\tCLK_MSR_ID(78, \"rng_ring_osc_1\"),\n\tCLK_MSR_ID(79, \"rng_ring_osc_2\"),\n\tCLK_MSR_ID(80, \"rng_ring_osc_3\"),\n\tCLK_MSR_ID(81, \"vapb\"),\n\tCLK_MSR_ID(82, \"ge2d\"),\n\tCLK_MSR_ID(83, \"co_rx\"),\n\tCLK_MSR_ID(84, \"co_tx\"),\n\tCLK_MSR_ID(89, \"hdmi_todig\"),\n\tCLK_MSR_ID(90, \"hdmitx_sys\"),\n\tCLK_MSR_ID(91, \"sys_cpub_div16\"),\n\tCLK_MSR_ID(92, \"sys_pll_cpub_div16\"),\n\tCLK_MSR_ID(94, \"eth_phy_rx\"),\n\tCLK_MSR_ID(95, \"eth_phy_pll\"),\n\tCLK_MSR_ID(96, \"vpu_b\"),\n\tCLK_MSR_ID(97, \"cpu_b_tmp\"),\n\tCLK_MSR_ID(98, \"ts\"),\n\tCLK_MSR_ID(99, \"ring_osc_out_ee_3\"),\n\tCLK_MSR_ID(100, \"ring_osc_out_ee_4\"),\n\tCLK_MSR_ID(101, \"ring_osc_out_ee_5\"),\n\tCLK_MSR_ID(102, \"ring_osc_out_ee_6\"),\n\tCLK_MSR_ID(103, \"ring_osc_out_ee_7\"),\n\tCLK_MSR_ID(104, \"ring_osc_out_ee_8\"),\n\tCLK_MSR_ID(105, \"ring_osc_out_ee_9\"),\n\tCLK_MSR_ID(106, \"ephy_test\"),\n\tCLK_MSR_ID(107, \"au_dac_g128x\"),\n\tCLK_MSR_ID(108, \"audio_locker_out\"),\n\tCLK_MSR_ID(109, \"audio_locker_in\"),\n\tCLK_MSR_ID(110, \"audio_tdmout_c_sclk\"),\n\tCLK_MSR_ID(111, \"audio_tdmout_b_sclk\"),\n\tCLK_MSR_ID(112, \"audio_tdmout_a_sclk\"),\n\tCLK_MSR_ID(113, \"audio_tdmin_lb_sclk\"),\n\tCLK_MSR_ID(114, \"audio_tdmin_c_sclk\"),\n\tCLK_MSR_ID(115, \"audio_tdmin_b_sclk\"),\n\tCLK_MSR_ID(116, \"audio_tdmin_a_sclk\"),\n\tCLK_MSR_ID(117, \"audio_resample\"),\n\tCLK_MSR_ID(118, \"audio_pdm_sys\"),\n\tCLK_MSR_ID(119, \"audio_spdifout_b\"),\n\tCLK_MSR_ID(120, \"audio_spdifout\"),\n\tCLK_MSR_ID(121, \"audio_spdifin\"),\n\tCLK_MSR_ID(122, \"audio_pdm_dclk\"),\n};\n\nstatic struct meson_msr_id clk_msr_sm1[CLK_MSR_MAX] = {\n\tCLK_MSR_ID(0, \"ring_osc_out_ee_0\"),\n\tCLK_MSR_ID(1, \"ring_osc_out_ee_1\"),\n\tCLK_MSR_ID(2, \"ring_osc_out_ee_2\"),\n\tCLK_MSR_ID(3, \"ring_osc_out_ee_3\"),\n\tCLK_MSR_ID(4, \"gp0_pll\"),\n\tCLK_MSR_ID(5, \"gp1_pll\"),\n\tCLK_MSR_ID(6, \"enci\"),\n\tCLK_MSR_ID(7, \"clk81\"),\n\tCLK_MSR_ID(8, \"encp\"),\n\tCLK_MSR_ID(9, \"encl\"),\n\tCLK_MSR_ID(10, \"vdac\"),\n\tCLK_MSR_ID(11, \"eth_tx\"),\n\tCLK_MSR_ID(12, \"hifi_pll\"),\n\tCLK_MSR_ID(13, \"mod_tcon\"),\n\tCLK_MSR_ID(14, \"fec_0\"),\n\tCLK_MSR_ID(15, \"fec_1\"),\n\tCLK_MSR_ID(16, \"fec_2\"),\n\tCLK_MSR_ID(17, \"sys_pll_div16\"),\n\tCLK_MSR_ID(18, \"sys_cpu_div16\"),\n\tCLK_MSR_ID(19, \"lcd_an_ph2\"),\n\tCLK_MSR_ID(20, \"rtc_osc_out\"),\n\tCLK_MSR_ID(21, \"lcd_an_ph3\"),\n\tCLK_MSR_ID(22, \"eth_phy_ref\"),\n\tCLK_MSR_ID(23, \"mpll_50m\"),\n\tCLK_MSR_ID(24, \"eth_125m\"),\n\tCLK_MSR_ID(25, \"eth_rmii\"),\n\tCLK_MSR_ID(26, \"sc_int\"),\n\tCLK_MSR_ID(27, \"in_mac\"),\n\tCLK_MSR_ID(28, \"sar_adc\"),\n\tCLK_MSR_ID(29, \"pcie_inp\"),\n\tCLK_MSR_ID(30, \"pcie_inn\"),\n\tCLK_MSR_ID(31, \"mpll_test_out\"),\n\tCLK_MSR_ID(32, \"vdec\"),\n\tCLK_MSR_ID(34, \"eth_mpll_50m\"),\n\tCLK_MSR_ID(35, \"mali\"),\n\tCLK_MSR_ID(36, \"hdmi_tx_pixel\"),\n\tCLK_MSR_ID(37, \"cdac\"),\n\tCLK_MSR_ID(38, \"vdin_meas\"),\n\tCLK_MSR_ID(39, \"bt656\"),\n\tCLK_MSR_ID(40, \"arm_ring_osc_out_4\"),\n\tCLK_MSR_ID(41, \"eth_rx_or_rmii\"),\n\tCLK_MSR_ID(42, \"mp0_out\"),\n\tCLK_MSR_ID(43, \"fclk_div5\"),\n\tCLK_MSR_ID(44, \"pwm_b\"),\n\tCLK_MSR_ID(45, \"pwm_a\"),\n\tCLK_MSR_ID(46, \"vpu\"),\n\tCLK_MSR_ID(47, \"ddr_dpll_pt\"),\n\tCLK_MSR_ID(48, \"mp1_out\"),\n\tCLK_MSR_ID(49, \"mp2_out\"),\n\tCLK_MSR_ID(50, \"mp3_out\"),\n\tCLK_MSR_ID(51, \"sd_emmc_c\"),\n\tCLK_MSR_ID(52, \"sd_emmc_b\"),\n\tCLK_MSR_ID(53, \"sd_emmc_a\"),\n\tCLK_MSR_ID(54, \"vpu_clkc\"),\n\tCLK_MSR_ID(55, \"vid_pll_div_out\"),\n\tCLK_MSR_ID(56, \"wave420l_a\"),\n\tCLK_MSR_ID(57, \"wave420l_c\"),\n\tCLK_MSR_ID(58, \"wave420l_b\"),\n\tCLK_MSR_ID(59, \"hcodec\"),\n\tCLK_MSR_ID(60, \"arm_ring_osc_out_5\"),\n\tCLK_MSR_ID(61, \"gpio_msr\"),\n\tCLK_MSR_ID(62, \"hevcb\"),\n\tCLK_MSR_ID(63, \"dsi_meas\"),\n\tCLK_MSR_ID(64, \"spicc_1\"),\n\tCLK_MSR_ID(65, \"spicc_0\"),\n\tCLK_MSR_ID(66, \"vid_lock\"),\n\tCLK_MSR_ID(67, \"dsi_phy\"),\n\tCLK_MSR_ID(68, \"hdcp22_esm\"),\n\tCLK_MSR_ID(69, \"hdcp22_skp\"),\n\tCLK_MSR_ID(70, \"pwm_f\"),\n\tCLK_MSR_ID(71, \"pwm_e\"),\n\tCLK_MSR_ID(72, \"pwm_d\"),\n\tCLK_MSR_ID(73, \"pwm_c\"),\n\tCLK_MSR_ID(74, \"arm_ring_osc_out_6\"),\n\tCLK_MSR_ID(75, \"hevcf\"),\n\tCLK_MSR_ID(76, \"arm_ring_osc_out_7\"),\n\tCLK_MSR_ID(77, \"rng_ring_osc_0\"),\n\tCLK_MSR_ID(78, \"rng_ring_osc_1\"),\n\tCLK_MSR_ID(79, \"rng_ring_osc_2\"),\n\tCLK_MSR_ID(80, \"rng_ring_osc_3\"),\n\tCLK_MSR_ID(81, \"vapb\"),\n\tCLK_MSR_ID(82, \"ge2d\"),\n\tCLK_MSR_ID(83, \"co_rx\"),\n\tCLK_MSR_ID(84, \"co_tx\"),\n\tCLK_MSR_ID(85, \"arm_ring_osc_out_8\"),\n\tCLK_MSR_ID(86, \"arm_ring_osc_out_9\"),\n\tCLK_MSR_ID(87, \"mipi_dsi_phy\"),\n\tCLK_MSR_ID(88, \"cis2_adapt\"),\n\tCLK_MSR_ID(89, \"hdmi_todig\"),\n\tCLK_MSR_ID(90, \"hdmitx_sys\"),\n\tCLK_MSR_ID(91, \"nna_core\"),\n\tCLK_MSR_ID(92, \"nna_axi\"),\n\tCLK_MSR_ID(93, \"vad\"),\n\tCLK_MSR_ID(94, \"eth_phy_rx\"),\n\tCLK_MSR_ID(95, \"eth_phy_pll\"),\n\tCLK_MSR_ID(96, \"vpu_b\"),\n\tCLK_MSR_ID(97, \"cpu_b_tmp\"),\n\tCLK_MSR_ID(98, \"ts\"),\n\tCLK_MSR_ID(99, \"arm_ring_osc_out_10\"),\n\tCLK_MSR_ID(100, \"arm_ring_osc_out_11\"),\n\tCLK_MSR_ID(101, \"arm_ring_osc_out_12\"),\n\tCLK_MSR_ID(102, \"arm_ring_osc_out_13\"),\n\tCLK_MSR_ID(103, \"arm_ring_osc_out_14\"),\n\tCLK_MSR_ID(104, \"arm_ring_osc_out_15\"),\n\tCLK_MSR_ID(105, \"arm_ring_osc_out_16\"),\n\tCLK_MSR_ID(106, \"ephy_test\"),\n\tCLK_MSR_ID(107, \"au_dac_g128x\"),\n\tCLK_MSR_ID(108, \"audio_locker_out\"),\n\tCLK_MSR_ID(109, \"audio_locker_in\"),\n\tCLK_MSR_ID(110, \"audio_tdmout_c_sclk\"),\n\tCLK_MSR_ID(111, \"audio_tdmout_b_sclk\"),\n\tCLK_MSR_ID(112, \"audio_tdmout_a_sclk\"),\n\tCLK_MSR_ID(113, \"audio_tdmin_lb_sclk\"),\n\tCLK_MSR_ID(114, \"audio_tdmin_c_sclk\"),\n\tCLK_MSR_ID(115, \"audio_tdmin_b_sclk\"),\n\tCLK_MSR_ID(116, \"audio_tdmin_a_sclk\"),\n\tCLK_MSR_ID(117, \"audio_resample\"),\n\tCLK_MSR_ID(118, \"audio_pdm_sys\"),\n\tCLK_MSR_ID(119, \"audio_spdifout_b\"),\n\tCLK_MSR_ID(120, \"audio_spdifout\"),\n\tCLK_MSR_ID(121, \"audio_spdifin\"),\n\tCLK_MSR_ID(122, \"audio_pdm_dclk\"),\n\tCLK_MSR_ID(123, \"audio_resampled\"),\n\tCLK_MSR_ID(124, \"earcrx_pll\"),\n\tCLK_MSR_ID(125, \"earcrx_pll_test\"),\n\tCLK_MSR_ID(126, \"csi_phy0\"),\n\tCLK_MSR_ID(127, \"csi2_data\"),\n};\n\nstatic int meson_measure_id(struct meson_msr_id *clk_msr_id,\n\t\t\t       unsigned int duration)\n{\n\tstruct meson_msr *priv = clk_msr_id->priv;\n\tunsigned int val;\n\tint ret;\n\n\tret = mutex_lock_interruptible(&measure_lock);\n\tif (ret)\n\t\treturn ret;\n\n\tregmap_write(priv->regmap, MSR_CLK_REG0, 0);\n\n\t \n\tregmap_update_bits(priv->regmap, MSR_CLK_REG0, MSR_DURATION,\n\t\t\t   FIELD_PREP(MSR_DURATION, duration - 1));\n\n\t \n\tregmap_update_bits(priv->regmap, MSR_CLK_REG0, MSR_CLK_SRC,\n\t\t\t   FIELD_PREP(MSR_CLK_SRC, clk_msr_id->id));\n\n\t \n\tregmap_update_bits(priv->regmap, MSR_CLK_REG0,\n\t\t\t   MSR_RUN | MSR_ENABLE,\n\t\t\t   MSR_RUN | MSR_ENABLE);\n\n\tret = regmap_read_poll_timeout(priv->regmap, MSR_CLK_REG0,\n\t\t\t\t       val, !(val & MSR_BUSY), 10, 10000);\n\tif (ret) {\n\t\tmutex_unlock(&measure_lock);\n\t\treturn ret;\n\t}\n\n\t \n\tregmap_update_bits(priv->regmap, MSR_CLK_REG0, MSR_ENABLE, 0);\n\n\t \n\tregmap_read(priv->regmap, MSR_CLK_REG2, &val);\n\n\tmutex_unlock(&measure_lock);\n\n\tif (val >= MSR_VAL_MASK)\n\t\treturn -EINVAL;\n\n\treturn DIV_ROUND_CLOSEST_ULL((val & MSR_VAL_MASK) * 1000000ULL,\n\t\t\t\t     duration);\n}\n\nstatic int meson_measure_best_id(struct meson_msr_id *clk_msr_id,\n\t\t\t\t    unsigned int *precision)\n{\n\tunsigned int duration = DIV_MAX;\n\tint ret;\n\n\t \n\tdo {\n\t\tret = meson_measure_id(clk_msr_id, duration);\n\t\tif (ret >= 0)\n\t\t\t*precision = (2 * 1000000) / duration;\n\t\telse\n\t\t\tduration -= DIV_STEP;\n\t} while (duration >= DIV_MIN && ret == -EINVAL);\n\n\treturn ret;\n}\n\nstatic int clk_msr_show(struct seq_file *s, void *data)\n{\n\tstruct meson_msr_id *clk_msr_id = s->private;\n\tunsigned int precision = 0;\n\tint val;\n\n\tval = meson_measure_best_id(clk_msr_id, &precision);\n\tif (val < 0)\n\t\treturn val;\n\n\tseq_printf(s, \"%d\\t+/-%dHz\\n\", val, precision);\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(clk_msr);\n\nstatic int clk_msr_summary_show(struct seq_file *s, void *data)\n{\n\tstruct meson_msr_id *msr_table = s->private;\n\tunsigned int precision = 0;\n\tint val, i;\n\n\tseq_puts(s, \"  clock                     rate    precision\\n\");\n\tseq_puts(s, \"---------------------------------------------\\n\");\n\n\tfor (i = 0 ; i < CLK_MSR_MAX ; ++i) {\n\t\tif (!msr_table[i].name)\n\t\t\tcontinue;\n\n\t\tval = meson_measure_best_id(&msr_table[i], &precision);\n\t\tif (val < 0)\n\t\t\treturn val;\n\n\t\tseq_printf(s, \" %-20s %10d    +/-%dHz\\n\",\n\t\t\t   msr_table[i].name, val, precision);\n\t}\n\n\treturn 0;\n}\nDEFINE_SHOW_ATTRIBUTE(clk_msr_summary);\n\nstatic const struct regmap_config meson_clk_msr_regmap_config = {\n\t.reg_bits = 32,\n\t.val_bits = 32,\n\t.reg_stride = 4,\n\t.max_register = MSR_CLK_REG2,\n};\n\nstatic int meson_msr_probe(struct platform_device *pdev)\n{\n\tconst struct meson_msr_id *match_data;\n\tstruct meson_msr *priv;\n\tstruct dentry *root, *clks;\n\tvoid __iomem *base;\n\tint i;\n\n\tpriv = devm_kzalloc(&pdev->dev, sizeof(struct meson_msr),\n\t\t\t    GFP_KERNEL);\n\tif (!priv)\n\t\treturn -ENOMEM;\n\n\tmatch_data = device_get_match_data(&pdev->dev);\n\tif (!match_data) {\n\t\tdev_err(&pdev->dev, \"failed to get match data\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\tmemcpy(priv->msr_table, match_data, sizeof(priv->msr_table));\n\n\tbase = devm_platform_ioremap_resource(pdev, 0);\n\tif (IS_ERR(base))\n\t\treturn PTR_ERR(base);\n\n\tpriv->regmap = devm_regmap_init_mmio(&pdev->dev, base,\n\t\t\t\t\t     &meson_clk_msr_regmap_config);\n\tif (IS_ERR(priv->regmap))\n\t\treturn PTR_ERR(priv->regmap);\n\n\troot = debugfs_create_dir(\"meson-clk-msr\", NULL);\n\tclks = debugfs_create_dir(\"clks\", root);\n\n\tdebugfs_create_file(\"measure_summary\", 0444, root,\n\t\t\t    priv->msr_table, &clk_msr_summary_fops);\n\n\tfor (i = 0 ; i < CLK_MSR_MAX ; ++i) {\n\t\tif (!priv->msr_table[i].name)\n\t\t\tcontinue;\n\n\t\tpriv->msr_table[i].priv = priv;\n\n\t\tdebugfs_create_file(priv->msr_table[i].name, 0444, clks,\n\t\t\t\t    &priv->msr_table[i], &clk_msr_fops);\n\t}\n\n\treturn 0;\n}\n\nstatic const struct of_device_id meson_msr_match_table[] = {\n\t{\n\t\t.compatible = \"amlogic,meson-gx-clk-measure\",\n\t\t.data = (void *)clk_msr_gx,\n\t},\n\t{\n\t\t.compatible = \"amlogic,meson8-clk-measure\",\n\t\t.data = (void *)clk_msr_m8,\n\t},\n\t{\n\t\t.compatible = \"amlogic,meson8b-clk-measure\",\n\t\t.data = (void *)clk_msr_m8,\n\t},\n\t{\n\t\t.compatible = \"amlogic,meson-axg-clk-measure\",\n\t\t.data = (void *)clk_msr_axg,\n\t},\n\t{\n\t\t.compatible = \"amlogic,meson-g12a-clk-measure\",\n\t\t.data = (void *)clk_msr_g12a,\n\t},\n\t{\n\t\t.compatible = \"amlogic,meson-sm1-clk-measure\",\n\t\t.data = (void *)clk_msr_sm1,\n\t},\n\t{   }\n};\nMODULE_DEVICE_TABLE(of, meson_msr_match_table);\n\nstatic struct platform_driver meson_msr_driver = {\n\t.probe\t= meson_msr_probe,\n\t.driver = {\n\t\t.name\t\t= \"meson_msr\",\n\t\t.of_match_table\t= meson_msr_match_table,\n\t},\n};\nmodule_platform_driver(meson_msr_driver);\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}