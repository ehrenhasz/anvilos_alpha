{
  "module_name": "mtk-mutex.c",
  "hash_id": "75d1eba15be85a208225cc4f3a665ce33474e812130870537039f55618827848",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/mediatek/mtk-mutex.c",
  "human_readable_source": "\n \n\n#include <linux/clk.h>\n#include <linux/iopoll.h>\n#include <linux/module.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n#include <linux/soc/mediatek/mtk-mmsys.h>\n#include <linux/soc/mediatek/mtk-mutex.h>\n#include <linux/soc/mediatek/mtk-cmdq.h>\n\n#define MTK_MUTEX_MAX_HANDLES\t\t\t10\n\n#define MT2701_MUTEX0_MOD0\t\t\t0x2c\n#define MT2701_MUTEX0_SOF0\t\t\t0x30\n#define MT8183_MUTEX0_MOD0\t\t\t0x30\n#define MT8183_MUTEX0_SOF0\t\t\t0x2c\n\n#define DISP_REG_MUTEX_EN(n)\t\t\t(0x20 + 0x20 * (n))\n#define DISP_REG_MUTEX(n)\t\t\t(0x24 + 0x20 * (n))\n#define DISP_REG_MUTEX_RST(n)\t\t\t(0x28 + 0x20 * (n))\n#define DISP_REG_MUTEX_MOD(mutex_mod_reg, n)\t(mutex_mod_reg + 0x20 * (n))\n#define DISP_REG_MUTEX_MOD1(mutex_mod_reg, n)\t((mutex_mod_reg) + 0x20 * (n) + 0x4)\n#define DISP_REG_MUTEX_SOF(mutex_sof_reg, n)\t(mutex_sof_reg + 0x20 * (n))\n#define DISP_REG_MUTEX_MOD2(n)\t\t\t(0x34 + 0x20 * (n))\n\n#define INT_MUTEX\t\t\t\tBIT(1)\n\n#define MT8186_MUTEX_MOD_DISP_OVL0\t\t0\n#define MT8186_MUTEX_MOD_DISP_OVL0_2L\t\t1\n#define MT8186_MUTEX_MOD_DISP_RDMA0\t\t2\n#define MT8186_MUTEX_MOD_DISP_COLOR0\t\t4\n#define MT8186_MUTEX_MOD_DISP_CCORR0\t\t5\n#define MT8186_MUTEX_MOD_DISP_AAL0\t\t7\n#define MT8186_MUTEX_MOD_DISP_GAMMA0\t\t8\n#define MT8186_MUTEX_MOD_DISP_POSTMASK0\t\t9\n#define MT8186_MUTEX_MOD_DISP_DITHER0\t\t10\n#define MT8186_MUTEX_MOD_DISP_RDMA1\t\t17\n\n#define MT8186_MUTEX_SOF_SINGLE_MODE\t\t0\n#define MT8186_MUTEX_SOF_DSI0\t\t\t1\n#define MT8186_MUTEX_SOF_DPI0\t\t\t2\n#define MT8186_MUTEX_EOF_DSI0\t\t\t(MT8186_MUTEX_SOF_DSI0 << 6)\n#define MT8186_MUTEX_EOF_DPI0\t\t\t(MT8186_MUTEX_SOF_DPI0 << 6)\n\n#define MT8167_MUTEX_MOD_DISP_PWM\t\t1\n#define MT8167_MUTEX_MOD_DISP_OVL0\t\t6\n#define MT8167_MUTEX_MOD_DISP_OVL1\t\t7\n#define MT8167_MUTEX_MOD_DISP_RDMA0\t\t8\n#define MT8167_MUTEX_MOD_DISP_RDMA1\t\t9\n#define MT8167_MUTEX_MOD_DISP_WDMA0\t\t10\n#define MT8167_MUTEX_MOD_DISP_CCORR\t\t11\n#define MT8167_MUTEX_MOD_DISP_COLOR\t\t12\n#define MT8167_MUTEX_MOD_DISP_AAL\t\t13\n#define MT8167_MUTEX_MOD_DISP_GAMMA\t\t14\n#define MT8167_MUTEX_MOD_DISP_DITHER\t\t15\n#define MT8167_MUTEX_MOD_DISP_UFOE\t\t16\n\n#define MT8192_MUTEX_MOD_DISP_OVL0\t\t0\n#define MT8192_MUTEX_MOD_DISP_OVL0_2L\t\t1\n#define MT8192_MUTEX_MOD_DISP_RDMA0\t\t2\n#define MT8192_MUTEX_MOD_DISP_COLOR0\t\t4\n#define MT8192_MUTEX_MOD_DISP_CCORR0\t\t5\n#define MT8192_MUTEX_MOD_DISP_AAL0\t\t6\n#define MT8192_MUTEX_MOD_DISP_GAMMA0\t\t7\n#define MT8192_MUTEX_MOD_DISP_POSTMASK0\t\t8\n#define MT8192_MUTEX_MOD_DISP_DITHER0\t\t9\n#define MT8192_MUTEX_MOD_DISP_OVL2_2L\t\t16\n#define MT8192_MUTEX_MOD_DISP_RDMA4\t\t17\n\n#define MT8183_MUTEX_MOD_DISP_RDMA0\t\t0\n#define MT8183_MUTEX_MOD_DISP_RDMA1\t\t1\n#define MT8183_MUTEX_MOD_DISP_OVL0\t\t9\n#define MT8183_MUTEX_MOD_DISP_OVL0_2L\t\t10\n#define MT8183_MUTEX_MOD_DISP_OVL1_2L\t\t11\n#define MT8183_MUTEX_MOD_DISP_WDMA0\t\t12\n#define MT8183_MUTEX_MOD_DISP_COLOR0\t\t13\n#define MT8183_MUTEX_MOD_DISP_CCORR0\t\t14\n#define MT8183_MUTEX_MOD_DISP_AAL0\t\t15\n#define MT8183_MUTEX_MOD_DISP_GAMMA0\t\t16\n#define MT8183_MUTEX_MOD_DISP_DITHER0\t\t17\n\n#define MT8183_MUTEX_MOD_MDP_RDMA0\t\t2\n#define MT8183_MUTEX_MOD_MDP_RSZ0\t\t4\n#define MT8183_MUTEX_MOD_MDP_RSZ1\t\t5\n#define MT8183_MUTEX_MOD_MDP_TDSHP0\t\t6\n#define MT8183_MUTEX_MOD_MDP_WROT0\t\t7\n#define MT8183_MUTEX_MOD_MDP_WDMA\t\t8\n#define MT8183_MUTEX_MOD_MDP_AAL0\t\t23\n#define MT8183_MUTEX_MOD_MDP_CCORR0\t\t24\n\n#define MT8186_MUTEX_MOD_MDP_RDMA0\t\t0\n#define MT8186_MUTEX_MOD_MDP_AAL0\t\t2\n#define MT8186_MUTEX_MOD_MDP_HDR0\t\t4\n#define MT8186_MUTEX_MOD_MDP_RSZ0\t\t5\n#define MT8186_MUTEX_MOD_MDP_RSZ1\t\t6\n#define MT8186_MUTEX_MOD_MDP_WROT0\t\t7\n#define MT8186_MUTEX_MOD_MDP_TDSHP0\t\t9\n#define MT8186_MUTEX_MOD_MDP_COLOR0\t\t14\n\n#define MT8173_MUTEX_MOD_DISP_OVL0\t\t11\n#define MT8173_MUTEX_MOD_DISP_OVL1\t\t12\n#define MT8173_MUTEX_MOD_DISP_RDMA0\t\t13\n#define MT8173_MUTEX_MOD_DISP_RDMA1\t\t14\n#define MT8173_MUTEX_MOD_DISP_RDMA2\t\t15\n#define MT8173_MUTEX_MOD_DISP_WDMA0\t\t16\n#define MT8173_MUTEX_MOD_DISP_WDMA1\t\t17\n#define MT8173_MUTEX_MOD_DISP_COLOR0\t\t18\n#define MT8173_MUTEX_MOD_DISP_COLOR1\t\t19\n#define MT8173_MUTEX_MOD_DISP_AAL\t\t20\n#define MT8173_MUTEX_MOD_DISP_GAMMA\t\t21\n#define MT8173_MUTEX_MOD_DISP_UFOE\t\t22\n#define MT8173_MUTEX_MOD_DISP_PWM0\t\t23\n#define MT8173_MUTEX_MOD_DISP_PWM1\t\t24\n#define MT8173_MUTEX_MOD_DISP_OD\t\t25\n\n#define MT8188_MUTEX_MOD_DISP_OVL0\t\t0\n#define MT8188_MUTEX_MOD_DISP_WDMA0\t\t1\n#define MT8188_MUTEX_MOD_DISP_RDMA0\t\t2\n#define MT8188_MUTEX_MOD_DISP_COLOR0\t\t3\n#define MT8188_MUTEX_MOD_DISP_CCORR0\t\t4\n#define MT8188_MUTEX_MOD_DISP_AAL0\t\t5\n#define MT8188_MUTEX_MOD_DISP_GAMMA0\t\t6\n#define MT8188_MUTEX_MOD_DISP_DITHER0\t\t7\n#define MT8188_MUTEX_MOD_DISP_DSI0\t\t8\n#define MT8188_MUTEX_MOD_DISP_DSC_WRAP0_CORE0\t9\n#define MT8188_MUTEX_MOD_DISP_VPP_MERGE\t\t20\n#define MT8188_MUTEX_MOD_DISP_DP_INTF0\t\t21\n#define MT8188_MUTEX_MOD_DISP_POSTMASK0\t\t24\n#define MT8188_MUTEX_MOD2_DISP_PWM0\t\t33\n\n#define MT8195_MUTEX_MOD_DISP_OVL0\t\t0\n#define MT8195_MUTEX_MOD_DISP_WDMA0\t\t1\n#define MT8195_MUTEX_MOD_DISP_RDMA0\t\t2\n#define MT8195_MUTEX_MOD_DISP_COLOR0\t\t3\n#define MT8195_MUTEX_MOD_DISP_CCORR0\t\t4\n#define MT8195_MUTEX_MOD_DISP_AAL0\t\t5\n#define MT8195_MUTEX_MOD_DISP_GAMMA0\t\t6\n#define MT8195_MUTEX_MOD_DISP_DITHER0\t\t7\n#define MT8195_MUTEX_MOD_DISP_DSI0\t\t8\n#define MT8195_MUTEX_MOD_DISP_DSC_WRAP0_CORE0\t9\n#define MT8195_MUTEX_MOD_DISP_VPP_MERGE\t\t20\n#define MT8195_MUTEX_MOD_DISP_DP_INTF0\t\t21\n#define MT8195_MUTEX_MOD_DISP_PWM0\t\t27\n\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA0\t0\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA1\t1\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA2\t2\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA3\t3\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA4\t4\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA5\t5\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA6\t6\n#define MT8195_MUTEX_MOD_DISP1_MDP_RDMA7\t7\n#define MT8195_MUTEX_MOD_DISP1_VPP_MERGE0\t8\n#define MT8195_MUTEX_MOD_DISP1_VPP_MERGE1\t9\n#define MT8195_MUTEX_MOD_DISP1_VPP_MERGE2\t10\n#define MT8195_MUTEX_MOD_DISP1_VPP_MERGE3\t11\n#define MT8195_MUTEX_MOD_DISP1_VPP_MERGE4\t12\n#define MT8195_MUTEX_MOD_DISP1_DISP_MIXER\t18\n#define MT8195_MUTEX_MOD_DISP1_DPI0\t\t25\n#define MT8195_MUTEX_MOD_DISP1_DPI1\t\t26\n#define MT8195_MUTEX_MOD_DISP1_DP_INTF0\t\t27\n\n \n#define MT8195_MUTEX_MOD_MDP_RDMA0             0\n#define MT8195_MUTEX_MOD_MDP_FG0               1\n#define MT8195_MUTEX_MOD_MDP_STITCH0           2\n#define MT8195_MUTEX_MOD_MDP_HDR0              3\n#define MT8195_MUTEX_MOD_MDP_AAL0              4\n#define MT8195_MUTEX_MOD_MDP_RSZ0              5\n#define MT8195_MUTEX_MOD_MDP_TDSHP0            6\n#define MT8195_MUTEX_MOD_MDP_COLOR0            7\n#define MT8195_MUTEX_MOD_MDP_OVL0              8\n#define MT8195_MUTEX_MOD_MDP_PAD0              9\n#define MT8195_MUTEX_MOD_MDP_TCC0              10\n#define MT8195_MUTEX_MOD_MDP_WROT0             11\n\n \n#define MT8195_MUTEX_MOD_MDP_TCC1              3\n#define MT8195_MUTEX_MOD_MDP_RDMA1             4\n#define MT8195_MUTEX_MOD_MDP_RDMA2             5\n#define MT8195_MUTEX_MOD_MDP_RDMA3             6\n#define MT8195_MUTEX_MOD_MDP_FG1               7\n#define MT8195_MUTEX_MOD_MDP_FG2               8\n#define MT8195_MUTEX_MOD_MDP_FG3               9\n#define MT8195_MUTEX_MOD_MDP_HDR1              10\n#define MT8195_MUTEX_MOD_MDP_HDR2              11\n#define MT8195_MUTEX_MOD_MDP_HDR3              12\n#define MT8195_MUTEX_MOD_MDP_AAL1              13\n#define MT8195_MUTEX_MOD_MDP_AAL2              14\n#define MT8195_MUTEX_MOD_MDP_AAL3              15\n#define MT8195_MUTEX_MOD_MDP_RSZ1              16\n#define MT8195_MUTEX_MOD_MDP_RSZ2              17\n#define MT8195_MUTEX_MOD_MDP_RSZ3              18\n#define MT8195_MUTEX_MOD_MDP_TDSHP1            19\n#define MT8195_MUTEX_MOD_MDP_TDSHP2            20\n#define MT8195_MUTEX_MOD_MDP_TDSHP3            21\n#define MT8195_MUTEX_MOD_MDP_MERGE2            22\n#define MT8195_MUTEX_MOD_MDP_MERGE3            23\n#define MT8195_MUTEX_MOD_MDP_COLOR1            24\n#define MT8195_MUTEX_MOD_MDP_COLOR2            25\n#define MT8195_MUTEX_MOD_MDP_COLOR3            26\n#define MT8195_MUTEX_MOD_MDP_OVL1              27\n#define MT8195_MUTEX_MOD_MDP_PAD1              28\n#define MT8195_MUTEX_MOD_MDP_PAD2              29\n#define MT8195_MUTEX_MOD_MDP_PAD3              30\n#define MT8195_MUTEX_MOD_MDP_WROT1             31\n#define MT8195_MUTEX_MOD_MDP_WROT2             32\n#define MT8195_MUTEX_MOD_MDP_WROT3             33\n\n#define MT8365_MUTEX_MOD_DISP_OVL0\t\t7\n#define MT8365_MUTEX_MOD_DISP_OVL0_2L\t\t8\n#define MT8365_MUTEX_MOD_DISP_RDMA0\t\t9\n#define MT8365_MUTEX_MOD_DISP_RDMA1\t\t10\n#define MT8365_MUTEX_MOD_DISP_WDMA0\t\t11\n#define MT8365_MUTEX_MOD_DISP_COLOR0\t\t12\n#define MT8365_MUTEX_MOD_DISP_CCORR\t\t13\n#define MT8365_MUTEX_MOD_DISP_AAL\t\t14\n#define MT8365_MUTEX_MOD_DISP_GAMMA\t\t15\n#define MT8365_MUTEX_MOD_DISP_DITHER\t\t16\n#define MT8365_MUTEX_MOD_DISP_DSI0\t\t17\n#define MT8365_MUTEX_MOD_DISP_PWM0\t\t20\n#define MT8365_MUTEX_MOD_DISP_DPI0\t\t22\n\n#define MT2712_MUTEX_MOD_DISP_PWM2\t\t10\n#define MT2712_MUTEX_MOD_DISP_OVL0\t\t11\n#define MT2712_MUTEX_MOD_DISP_OVL1\t\t12\n#define MT2712_MUTEX_MOD_DISP_RDMA0\t\t13\n#define MT2712_MUTEX_MOD_DISP_RDMA1\t\t14\n#define MT2712_MUTEX_MOD_DISP_RDMA2\t\t15\n#define MT2712_MUTEX_MOD_DISP_WDMA0\t\t16\n#define MT2712_MUTEX_MOD_DISP_WDMA1\t\t17\n#define MT2712_MUTEX_MOD_DISP_COLOR0\t\t18\n#define MT2712_MUTEX_MOD_DISP_COLOR1\t\t19\n#define MT2712_MUTEX_MOD_DISP_AAL0\t\t20\n#define MT2712_MUTEX_MOD_DISP_UFOE\t\t22\n#define MT2712_MUTEX_MOD_DISP_PWM0\t\t23\n#define MT2712_MUTEX_MOD_DISP_PWM1\t\t24\n#define MT2712_MUTEX_MOD_DISP_OD0\t\t25\n#define MT2712_MUTEX_MOD2_DISP_AAL1\t\t33\n#define MT2712_MUTEX_MOD2_DISP_OD1\t\t34\n\n#define MT2701_MUTEX_MOD_DISP_OVL\t\t3\n#define MT2701_MUTEX_MOD_DISP_WDMA\t\t6\n#define MT2701_MUTEX_MOD_DISP_COLOR\t\t7\n#define MT2701_MUTEX_MOD_DISP_BLS\t\t9\n#define MT2701_MUTEX_MOD_DISP_RDMA0\t\t10\n#define MT2701_MUTEX_MOD_DISP_RDMA1\t\t12\n\n#define MT2712_MUTEX_SOF_SINGLE_MODE\t\t0\n#define MT2712_MUTEX_SOF_DSI0\t\t\t1\n#define MT2712_MUTEX_SOF_DSI1\t\t\t2\n#define MT2712_MUTEX_SOF_DPI0\t\t\t3\n#define MT2712_MUTEX_SOF_DPI1\t\t\t4\n#define MT2712_MUTEX_SOF_DSI2\t\t\t5\n#define MT2712_MUTEX_SOF_DSI3\t\t\t6\n#define MT8167_MUTEX_SOF_DPI0\t\t\t2\n#define MT8167_MUTEX_SOF_DPI1\t\t\t3\n#define MT8183_MUTEX_SOF_DSI0\t\t\t1\n#define MT8183_MUTEX_SOF_DPI0\t\t\t2\n#define MT8188_MUTEX_SOF_DSI0\t\t\t1\n#define MT8188_MUTEX_SOF_DP_INTF0\t\t3\n#define MT8195_MUTEX_SOF_DSI0\t\t\t1\n#define MT8195_MUTEX_SOF_DSI1\t\t\t2\n#define MT8195_MUTEX_SOF_DP_INTF0\t\t3\n#define MT8195_MUTEX_SOF_DP_INTF1\t\t4\n#define MT8195_MUTEX_SOF_DPI0\t\t\t6  \n#define MT8195_MUTEX_SOF_DPI1\t\t\t5  \n\n#define MT8183_MUTEX_EOF_DSI0\t\t\t(MT8183_MUTEX_SOF_DSI0 << 6)\n#define MT8183_MUTEX_EOF_DPI0\t\t\t(MT8183_MUTEX_SOF_DPI0 << 6)\n#define MT8188_MUTEX_EOF_DSI0\t\t\t(MT8188_MUTEX_SOF_DSI0 << 7)\n#define MT8188_MUTEX_EOF_DP_INTF0\t\t(MT8188_MUTEX_SOF_DP_INTF0 << 7)\n#define MT8195_MUTEX_EOF_DSI0\t\t\t(MT8195_MUTEX_SOF_DSI0 << 7)\n#define MT8195_MUTEX_EOF_DSI1\t\t\t(MT8195_MUTEX_SOF_DSI1 << 7)\n#define MT8195_MUTEX_EOF_DP_INTF0\t\t(MT8195_MUTEX_SOF_DP_INTF0 << 7)\n#define MT8195_MUTEX_EOF_DP_INTF1\t\t(MT8195_MUTEX_SOF_DP_INTF1 << 7)\n#define MT8195_MUTEX_EOF_DPI0\t\t\t(MT8195_MUTEX_SOF_DPI0 << 7)\n#define MT8195_MUTEX_EOF_DPI1\t\t\t(MT8195_MUTEX_SOF_DPI1 << 7)\n\nstruct mtk_mutex {\n\tu8 id;\n\tbool claimed;\n};\n\nenum mtk_mutex_sof_id {\n\tMUTEX_SOF_SINGLE_MODE,\n\tMUTEX_SOF_DSI0,\n\tMUTEX_SOF_DSI1,\n\tMUTEX_SOF_DPI0,\n\tMUTEX_SOF_DPI1,\n\tMUTEX_SOF_DSI2,\n\tMUTEX_SOF_DSI3,\n\tMUTEX_SOF_DP_INTF0,\n\tMUTEX_SOF_DP_INTF1,\n\tDDP_MUTEX_SOF_MAX,\n};\n\nstruct mtk_mutex_data {\n\tconst unsigned int *mutex_mod;\n\tconst unsigned int *mutex_sof;\n\tconst unsigned int mutex_mod_reg;\n\tconst unsigned int mutex_sof_reg;\n\tconst unsigned int *mutex_table_mod;\n\tconst bool no_clk;\n};\n\nstruct mtk_mutex_ctx {\n\tstruct device\t\t\t*dev;\n\tstruct clk\t\t\t*clk;\n\tvoid __iomem\t\t\t*regs;\n\tstruct mtk_mutex\t\tmutex[MTK_MUTEX_MAX_HANDLES];\n\tconst struct mtk_mutex_data\t*data;\n\tphys_addr_t\t\t\taddr;\n\tstruct cmdq_client_reg\t\tcmdq_reg;\n};\n\nstatic const unsigned int mt2701_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_BLS] = MT2701_MUTEX_MOD_DISP_BLS,\n\t[DDP_COMPONENT_COLOR0] = MT2701_MUTEX_MOD_DISP_COLOR,\n\t[DDP_COMPONENT_OVL0] = MT2701_MUTEX_MOD_DISP_OVL,\n\t[DDP_COMPONENT_RDMA0] = MT2701_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA1] = MT2701_MUTEX_MOD_DISP_RDMA1,\n\t[DDP_COMPONENT_WDMA0] = MT2701_MUTEX_MOD_DISP_WDMA,\n};\n\nstatic const unsigned int mt2712_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_AAL0] = MT2712_MUTEX_MOD_DISP_AAL0,\n\t[DDP_COMPONENT_AAL1] = MT2712_MUTEX_MOD2_DISP_AAL1,\n\t[DDP_COMPONENT_COLOR0] = MT2712_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_COLOR1] = MT2712_MUTEX_MOD_DISP_COLOR1,\n\t[DDP_COMPONENT_OD0] = MT2712_MUTEX_MOD_DISP_OD0,\n\t[DDP_COMPONENT_OD1] = MT2712_MUTEX_MOD2_DISP_OD1,\n\t[DDP_COMPONENT_OVL0] = MT2712_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_OVL1] = MT2712_MUTEX_MOD_DISP_OVL1,\n\t[DDP_COMPONENT_PWM0] = MT2712_MUTEX_MOD_DISP_PWM0,\n\t[DDP_COMPONENT_PWM1] = MT2712_MUTEX_MOD_DISP_PWM1,\n\t[DDP_COMPONENT_PWM2] = MT2712_MUTEX_MOD_DISP_PWM2,\n\t[DDP_COMPONENT_RDMA0] = MT2712_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA1] = MT2712_MUTEX_MOD_DISP_RDMA1,\n\t[DDP_COMPONENT_RDMA2] = MT2712_MUTEX_MOD_DISP_RDMA2,\n\t[DDP_COMPONENT_UFOE] = MT2712_MUTEX_MOD_DISP_UFOE,\n\t[DDP_COMPONENT_WDMA0] = MT2712_MUTEX_MOD_DISP_WDMA0,\n\t[DDP_COMPONENT_WDMA1] = MT2712_MUTEX_MOD_DISP_WDMA1,\n};\n\nstatic const unsigned int mt8167_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_AAL0] = MT8167_MUTEX_MOD_DISP_AAL,\n\t[DDP_COMPONENT_CCORR] = MT8167_MUTEX_MOD_DISP_CCORR,\n\t[DDP_COMPONENT_COLOR0] = MT8167_MUTEX_MOD_DISP_COLOR,\n\t[DDP_COMPONENT_DITHER0] = MT8167_MUTEX_MOD_DISP_DITHER,\n\t[DDP_COMPONENT_GAMMA] = MT8167_MUTEX_MOD_DISP_GAMMA,\n\t[DDP_COMPONENT_OVL0] = MT8167_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_OVL1] = MT8167_MUTEX_MOD_DISP_OVL1,\n\t[DDP_COMPONENT_PWM0] = MT8167_MUTEX_MOD_DISP_PWM,\n\t[DDP_COMPONENT_RDMA0] = MT8167_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA1] = MT8167_MUTEX_MOD_DISP_RDMA1,\n\t[DDP_COMPONENT_UFOE] = MT8167_MUTEX_MOD_DISP_UFOE,\n\t[DDP_COMPONENT_WDMA0] = MT8167_MUTEX_MOD_DISP_WDMA0,\n};\n\nstatic const unsigned int mt8173_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_AAL0] = MT8173_MUTEX_MOD_DISP_AAL,\n\t[DDP_COMPONENT_COLOR0] = MT8173_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_COLOR1] = MT8173_MUTEX_MOD_DISP_COLOR1,\n\t[DDP_COMPONENT_GAMMA] = MT8173_MUTEX_MOD_DISP_GAMMA,\n\t[DDP_COMPONENT_OD0] = MT8173_MUTEX_MOD_DISP_OD,\n\t[DDP_COMPONENT_OVL0] = MT8173_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_OVL1] = MT8173_MUTEX_MOD_DISP_OVL1,\n\t[DDP_COMPONENT_PWM0] = MT8173_MUTEX_MOD_DISP_PWM0,\n\t[DDP_COMPONENT_PWM1] = MT8173_MUTEX_MOD_DISP_PWM1,\n\t[DDP_COMPONENT_RDMA0] = MT8173_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA1] = MT8173_MUTEX_MOD_DISP_RDMA1,\n\t[DDP_COMPONENT_RDMA2] = MT8173_MUTEX_MOD_DISP_RDMA2,\n\t[DDP_COMPONENT_UFOE] = MT8173_MUTEX_MOD_DISP_UFOE,\n\t[DDP_COMPONENT_WDMA0] = MT8173_MUTEX_MOD_DISP_WDMA0,\n\t[DDP_COMPONENT_WDMA1] = MT8173_MUTEX_MOD_DISP_WDMA1,\n};\n\nstatic const unsigned int mt8183_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_AAL0] = MT8183_MUTEX_MOD_DISP_AAL0,\n\t[DDP_COMPONENT_CCORR] = MT8183_MUTEX_MOD_DISP_CCORR0,\n\t[DDP_COMPONENT_COLOR0] = MT8183_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_DITHER0] = MT8183_MUTEX_MOD_DISP_DITHER0,\n\t[DDP_COMPONENT_GAMMA] = MT8183_MUTEX_MOD_DISP_GAMMA0,\n\t[DDP_COMPONENT_OVL0] = MT8183_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_OVL_2L0] = MT8183_MUTEX_MOD_DISP_OVL0_2L,\n\t[DDP_COMPONENT_OVL_2L1] = MT8183_MUTEX_MOD_DISP_OVL1_2L,\n\t[DDP_COMPONENT_RDMA0] = MT8183_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA1] = MT8183_MUTEX_MOD_DISP_RDMA1,\n\t[DDP_COMPONENT_WDMA0] = MT8183_MUTEX_MOD_DISP_WDMA0,\n};\n\nstatic const unsigned int mt8183_mutex_table_mod[MUTEX_MOD_IDX_MAX] = {\n\t[MUTEX_MOD_IDX_MDP_RDMA0] = MT8183_MUTEX_MOD_MDP_RDMA0,\n\t[MUTEX_MOD_IDX_MDP_RSZ0] = MT8183_MUTEX_MOD_MDP_RSZ0,\n\t[MUTEX_MOD_IDX_MDP_RSZ1] = MT8183_MUTEX_MOD_MDP_RSZ1,\n\t[MUTEX_MOD_IDX_MDP_TDSHP0] = MT8183_MUTEX_MOD_MDP_TDSHP0,\n\t[MUTEX_MOD_IDX_MDP_WROT0] = MT8183_MUTEX_MOD_MDP_WROT0,\n\t[MUTEX_MOD_IDX_MDP_WDMA] = MT8183_MUTEX_MOD_MDP_WDMA,\n\t[MUTEX_MOD_IDX_MDP_AAL0] = MT8183_MUTEX_MOD_MDP_AAL0,\n\t[MUTEX_MOD_IDX_MDP_CCORR0] = MT8183_MUTEX_MOD_MDP_CCORR0,\n};\n\nstatic const unsigned int mt8186_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_AAL0] = MT8186_MUTEX_MOD_DISP_AAL0,\n\t[DDP_COMPONENT_CCORR] = MT8186_MUTEX_MOD_DISP_CCORR0,\n\t[DDP_COMPONENT_COLOR0] = MT8186_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_DITHER0] = MT8186_MUTEX_MOD_DISP_DITHER0,\n\t[DDP_COMPONENT_GAMMA] = MT8186_MUTEX_MOD_DISP_GAMMA0,\n\t[DDP_COMPONENT_OVL0] = MT8186_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_OVL_2L0] = MT8186_MUTEX_MOD_DISP_OVL0_2L,\n\t[DDP_COMPONENT_POSTMASK0] = MT8186_MUTEX_MOD_DISP_POSTMASK0,\n\t[DDP_COMPONENT_RDMA0] = MT8186_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA1] = MT8186_MUTEX_MOD_DISP_RDMA1,\n};\n\nstatic const unsigned int mt8186_mdp_mutex_table_mod[MUTEX_MOD_IDX_MAX] = {\n\t[MUTEX_MOD_IDX_MDP_RDMA0] = MT8186_MUTEX_MOD_MDP_RDMA0,\n\t[MUTEX_MOD_IDX_MDP_RSZ0] = MT8186_MUTEX_MOD_MDP_RSZ0,\n\t[MUTEX_MOD_IDX_MDP_RSZ1] = MT8186_MUTEX_MOD_MDP_RSZ1,\n\t[MUTEX_MOD_IDX_MDP_TDSHP0] = MT8186_MUTEX_MOD_MDP_TDSHP0,\n\t[MUTEX_MOD_IDX_MDP_WROT0] = MT8186_MUTEX_MOD_MDP_WROT0,\n\t[MUTEX_MOD_IDX_MDP_HDR0] = MT8186_MUTEX_MOD_MDP_HDR0,\n\t[MUTEX_MOD_IDX_MDP_AAL0] = MT8186_MUTEX_MOD_MDP_AAL0,\n\t[MUTEX_MOD_IDX_MDP_COLOR0] = MT8186_MUTEX_MOD_MDP_COLOR0,\n};\n\nstatic const unsigned int mt8188_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_OVL0] = MT8188_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_WDMA0] = MT8188_MUTEX_MOD_DISP_WDMA0,\n\t[DDP_COMPONENT_RDMA0] = MT8188_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_COLOR0] = MT8188_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_CCORR] = MT8188_MUTEX_MOD_DISP_CCORR0,\n\t[DDP_COMPONENT_AAL0] = MT8188_MUTEX_MOD_DISP_AAL0,\n\t[DDP_COMPONENT_GAMMA] = MT8188_MUTEX_MOD_DISP_GAMMA0,\n\t[DDP_COMPONENT_POSTMASK0] = MT8188_MUTEX_MOD_DISP_POSTMASK0,\n\t[DDP_COMPONENT_DITHER0] = MT8188_MUTEX_MOD_DISP_DITHER0,\n\t[DDP_COMPONENT_MERGE0] = MT8188_MUTEX_MOD_DISP_VPP_MERGE,\n\t[DDP_COMPONENT_DSC0] = MT8188_MUTEX_MOD_DISP_DSC_WRAP0_CORE0,\n\t[DDP_COMPONENT_DSI0] = MT8188_MUTEX_MOD_DISP_DSI0,\n\t[DDP_COMPONENT_PWM0] = MT8188_MUTEX_MOD2_DISP_PWM0,\n\t[DDP_COMPONENT_DP_INTF0] = MT8188_MUTEX_MOD_DISP_DP_INTF0,\n};\n\nstatic const unsigned int mt8192_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_AAL0] = MT8192_MUTEX_MOD_DISP_AAL0,\n\t[DDP_COMPONENT_CCORR] = MT8192_MUTEX_MOD_DISP_CCORR0,\n\t[DDP_COMPONENT_COLOR0] = MT8192_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_DITHER0] = MT8192_MUTEX_MOD_DISP_DITHER0,\n\t[DDP_COMPONENT_GAMMA] = MT8192_MUTEX_MOD_DISP_GAMMA0,\n\t[DDP_COMPONENT_POSTMASK0] = MT8192_MUTEX_MOD_DISP_POSTMASK0,\n\t[DDP_COMPONENT_OVL0] = MT8192_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_OVL_2L0] = MT8192_MUTEX_MOD_DISP_OVL0_2L,\n\t[DDP_COMPONENT_OVL_2L2] = MT8192_MUTEX_MOD_DISP_OVL2_2L,\n\t[DDP_COMPONENT_RDMA0] = MT8192_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA4] = MT8192_MUTEX_MOD_DISP_RDMA4,\n};\n\nstatic const unsigned int mt8195_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_OVL0] = MT8195_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_WDMA0] = MT8195_MUTEX_MOD_DISP_WDMA0,\n\t[DDP_COMPONENT_RDMA0] = MT8195_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_COLOR0] = MT8195_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_CCORR] = MT8195_MUTEX_MOD_DISP_CCORR0,\n\t[DDP_COMPONENT_AAL0] = MT8195_MUTEX_MOD_DISP_AAL0,\n\t[DDP_COMPONENT_GAMMA] = MT8195_MUTEX_MOD_DISP_GAMMA0,\n\t[DDP_COMPONENT_DITHER0] = MT8195_MUTEX_MOD_DISP_DITHER0,\n\t[DDP_COMPONENT_MERGE0] = MT8195_MUTEX_MOD_DISP_VPP_MERGE,\n\t[DDP_COMPONENT_DSC0] = MT8195_MUTEX_MOD_DISP_DSC_WRAP0_CORE0,\n\t[DDP_COMPONENT_DSI0] = MT8195_MUTEX_MOD_DISP_DSI0,\n\t[DDP_COMPONENT_PWM0] = MT8195_MUTEX_MOD_DISP_PWM0,\n\t[DDP_COMPONENT_DP_INTF0] = MT8195_MUTEX_MOD_DISP_DP_INTF0,\n\t[DDP_COMPONENT_MDP_RDMA0] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA0,\n\t[DDP_COMPONENT_MDP_RDMA1] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA1,\n\t[DDP_COMPONENT_MDP_RDMA2] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA2,\n\t[DDP_COMPONENT_MDP_RDMA3] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA3,\n\t[DDP_COMPONENT_MDP_RDMA4] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA4,\n\t[DDP_COMPONENT_MDP_RDMA5] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA5,\n\t[DDP_COMPONENT_MDP_RDMA6] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA6,\n\t[DDP_COMPONENT_MDP_RDMA7] = MT8195_MUTEX_MOD_DISP1_MDP_RDMA7,\n\t[DDP_COMPONENT_MERGE1] = MT8195_MUTEX_MOD_DISP1_VPP_MERGE0,\n\t[DDP_COMPONENT_MERGE2] = MT8195_MUTEX_MOD_DISP1_VPP_MERGE1,\n\t[DDP_COMPONENT_MERGE3] = MT8195_MUTEX_MOD_DISP1_VPP_MERGE2,\n\t[DDP_COMPONENT_MERGE4] = MT8195_MUTEX_MOD_DISP1_VPP_MERGE3,\n\t[DDP_COMPONENT_ETHDR_MIXER] = MT8195_MUTEX_MOD_DISP1_DISP_MIXER,\n\t[DDP_COMPONENT_MERGE5] = MT8195_MUTEX_MOD_DISP1_VPP_MERGE4,\n\t[DDP_COMPONENT_DP_INTF1] = MT8195_MUTEX_MOD_DISP1_DP_INTF0,\n};\n\nstatic const unsigned int mt8195_mutex_table_mod[MUTEX_MOD_IDX_MAX] = {\n\t[MUTEX_MOD_IDX_MDP_RDMA0] = MT8195_MUTEX_MOD_MDP_RDMA0,\n\t[MUTEX_MOD_IDX_MDP_RDMA1] = MT8195_MUTEX_MOD_MDP_RDMA1,\n\t[MUTEX_MOD_IDX_MDP_RDMA2] = MT8195_MUTEX_MOD_MDP_RDMA2,\n\t[MUTEX_MOD_IDX_MDP_RDMA3] = MT8195_MUTEX_MOD_MDP_RDMA3,\n\t[MUTEX_MOD_IDX_MDP_STITCH0] = MT8195_MUTEX_MOD_MDP_STITCH0,\n\t[MUTEX_MOD_IDX_MDP_FG0] = MT8195_MUTEX_MOD_MDP_FG0,\n\t[MUTEX_MOD_IDX_MDP_FG1] = MT8195_MUTEX_MOD_MDP_FG1,\n\t[MUTEX_MOD_IDX_MDP_FG2] = MT8195_MUTEX_MOD_MDP_FG2,\n\t[MUTEX_MOD_IDX_MDP_FG3] = MT8195_MUTEX_MOD_MDP_FG3,\n\t[MUTEX_MOD_IDX_MDP_HDR0] = MT8195_MUTEX_MOD_MDP_HDR0,\n\t[MUTEX_MOD_IDX_MDP_HDR1] = MT8195_MUTEX_MOD_MDP_HDR1,\n\t[MUTEX_MOD_IDX_MDP_HDR2] = MT8195_MUTEX_MOD_MDP_HDR2,\n\t[MUTEX_MOD_IDX_MDP_HDR3] = MT8195_MUTEX_MOD_MDP_HDR3,\n\t[MUTEX_MOD_IDX_MDP_AAL0] = MT8195_MUTEX_MOD_MDP_AAL0,\n\t[MUTEX_MOD_IDX_MDP_AAL1] = MT8195_MUTEX_MOD_MDP_AAL1,\n\t[MUTEX_MOD_IDX_MDP_AAL2] = MT8195_MUTEX_MOD_MDP_AAL2,\n\t[MUTEX_MOD_IDX_MDP_AAL3] = MT8195_MUTEX_MOD_MDP_AAL3,\n\t[MUTEX_MOD_IDX_MDP_RSZ0] = MT8195_MUTEX_MOD_MDP_RSZ0,\n\t[MUTEX_MOD_IDX_MDP_RSZ1] = MT8195_MUTEX_MOD_MDP_RSZ1,\n\t[MUTEX_MOD_IDX_MDP_RSZ2] = MT8195_MUTEX_MOD_MDP_RSZ2,\n\t[MUTEX_MOD_IDX_MDP_RSZ3] = MT8195_MUTEX_MOD_MDP_RSZ3,\n\t[MUTEX_MOD_IDX_MDP_MERGE2] = MT8195_MUTEX_MOD_MDP_MERGE2,\n\t[MUTEX_MOD_IDX_MDP_MERGE3] = MT8195_MUTEX_MOD_MDP_MERGE3,\n\t[MUTEX_MOD_IDX_MDP_TDSHP0] = MT8195_MUTEX_MOD_MDP_TDSHP0,\n\t[MUTEX_MOD_IDX_MDP_TDSHP1] = MT8195_MUTEX_MOD_MDP_TDSHP1,\n\t[MUTEX_MOD_IDX_MDP_TDSHP2] = MT8195_MUTEX_MOD_MDP_TDSHP2,\n\t[MUTEX_MOD_IDX_MDP_TDSHP3] = MT8195_MUTEX_MOD_MDP_TDSHP3,\n\t[MUTEX_MOD_IDX_MDP_COLOR0] = MT8195_MUTEX_MOD_MDP_COLOR0,\n\t[MUTEX_MOD_IDX_MDP_COLOR1] = MT8195_MUTEX_MOD_MDP_COLOR1,\n\t[MUTEX_MOD_IDX_MDP_COLOR2] = MT8195_MUTEX_MOD_MDP_COLOR2,\n\t[MUTEX_MOD_IDX_MDP_COLOR3] = MT8195_MUTEX_MOD_MDP_COLOR3,\n\t[MUTEX_MOD_IDX_MDP_OVL0] = MT8195_MUTEX_MOD_MDP_OVL0,\n\t[MUTEX_MOD_IDX_MDP_OVL1] = MT8195_MUTEX_MOD_MDP_OVL1,\n\t[MUTEX_MOD_IDX_MDP_PAD0] = MT8195_MUTEX_MOD_MDP_PAD0,\n\t[MUTEX_MOD_IDX_MDP_PAD1] = MT8195_MUTEX_MOD_MDP_PAD1,\n\t[MUTEX_MOD_IDX_MDP_PAD2] = MT8195_MUTEX_MOD_MDP_PAD2,\n\t[MUTEX_MOD_IDX_MDP_PAD3] = MT8195_MUTEX_MOD_MDP_PAD3,\n\t[MUTEX_MOD_IDX_MDP_TCC0] = MT8195_MUTEX_MOD_MDP_TCC0,\n\t[MUTEX_MOD_IDX_MDP_TCC1] = MT8195_MUTEX_MOD_MDP_TCC1,\n\t[MUTEX_MOD_IDX_MDP_WROT0] = MT8195_MUTEX_MOD_MDP_WROT0,\n\t[MUTEX_MOD_IDX_MDP_WROT1] = MT8195_MUTEX_MOD_MDP_WROT1,\n\t[MUTEX_MOD_IDX_MDP_WROT2] = MT8195_MUTEX_MOD_MDP_WROT2,\n\t[MUTEX_MOD_IDX_MDP_WROT3] = MT8195_MUTEX_MOD_MDP_WROT3,\n};\n\nstatic const unsigned int mt8365_mutex_mod[DDP_COMPONENT_ID_MAX] = {\n\t[DDP_COMPONENT_AAL0] = MT8365_MUTEX_MOD_DISP_AAL,\n\t[DDP_COMPONENT_CCORR] = MT8365_MUTEX_MOD_DISP_CCORR,\n\t[DDP_COMPONENT_COLOR0] = MT8365_MUTEX_MOD_DISP_COLOR0,\n\t[DDP_COMPONENT_DITHER0] = MT8365_MUTEX_MOD_DISP_DITHER,\n\t[DDP_COMPONENT_DPI0] = MT8365_MUTEX_MOD_DISP_DPI0,\n\t[DDP_COMPONENT_DSI0] = MT8365_MUTEX_MOD_DISP_DSI0,\n\t[DDP_COMPONENT_GAMMA] = MT8365_MUTEX_MOD_DISP_GAMMA,\n\t[DDP_COMPONENT_OVL0] = MT8365_MUTEX_MOD_DISP_OVL0,\n\t[DDP_COMPONENT_OVL_2L0] = MT8365_MUTEX_MOD_DISP_OVL0_2L,\n\t[DDP_COMPONENT_PWM0] = MT8365_MUTEX_MOD_DISP_PWM0,\n\t[DDP_COMPONENT_RDMA0] = MT8365_MUTEX_MOD_DISP_RDMA0,\n\t[DDP_COMPONENT_RDMA1] = MT8365_MUTEX_MOD_DISP_RDMA1,\n\t[DDP_COMPONENT_WDMA0] = MT8365_MUTEX_MOD_DISP_WDMA0,\n};\n\nstatic const unsigned int mt2712_mutex_sof[DDP_MUTEX_SOF_MAX] = {\n\t[MUTEX_SOF_SINGLE_MODE] = MUTEX_SOF_SINGLE_MODE,\n\t[MUTEX_SOF_DSI0] = MUTEX_SOF_DSI0,\n\t[MUTEX_SOF_DSI1] = MUTEX_SOF_DSI1,\n\t[MUTEX_SOF_DPI0] = MUTEX_SOF_DPI0,\n\t[MUTEX_SOF_DPI1] = MUTEX_SOF_DPI1,\n\t[MUTEX_SOF_DSI2] = MUTEX_SOF_DSI2,\n\t[MUTEX_SOF_DSI3] = MUTEX_SOF_DSI3,\n};\n\nstatic const unsigned int mt6795_mutex_sof[DDP_MUTEX_SOF_MAX] = {\n\t[MUTEX_SOF_SINGLE_MODE] = MUTEX_SOF_SINGLE_MODE,\n\t[MUTEX_SOF_DSI0] = MUTEX_SOF_DSI0,\n\t[MUTEX_SOF_DSI1] = MUTEX_SOF_DSI1,\n\t[MUTEX_SOF_DPI0] = MUTEX_SOF_DPI0,\n};\n\nstatic const unsigned int mt8167_mutex_sof[DDP_MUTEX_SOF_MAX] = {\n\t[MUTEX_SOF_SINGLE_MODE] = MUTEX_SOF_SINGLE_MODE,\n\t[MUTEX_SOF_DSI0] = MUTEX_SOF_DSI0,\n\t[MUTEX_SOF_DPI0] = MT8167_MUTEX_SOF_DPI0,\n\t[MUTEX_SOF_DPI1] = MT8167_MUTEX_SOF_DPI1,\n};\n\n \nstatic const unsigned int mt8183_mutex_sof[DDP_MUTEX_SOF_MAX] = {\n\t[MUTEX_SOF_SINGLE_MODE] = MUTEX_SOF_SINGLE_MODE,\n\t[MUTEX_SOF_DSI0] = MUTEX_SOF_DSI0 | MT8183_MUTEX_EOF_DSI0,\n\t[MUTEX_SOF_DPI0] = MT8183_MUTEX_SOF_DPI0 | MT8183_MUTEX_EOF_DPI0,\n};\n\nstatic const unsigned int mt8186_mutex_sof[MUTEX_SOF_DSI3 + 1] = {\n\t[MUTEX_SOF_SINGLE_MODE] = MUTEX_SOF_SINGLE_MODE,\n\t[MUTEX_SOF_DSI0] = MT8186_MUTEX_SOF_DSI0 | MT8186_MUTEX_EOF_DSI0,\n\t[MUTEX_SOF_DPI0] = MT8186_MUTEX_SOF_DPI0 | MT8186_MUTEX_EOF_DPI0,\n};\n\n \nstatic const unsigned int mt8188_mutex_sof[DDP_MUTEX_SOF_MAX] = {\n\t[MUTEX_SOF_SINGLE_MODE] = MUTEX_SOF_SINGLE_MODE,\n\t[MUTEX_SOF_DSI0] =\n\t\tMT8188_MUTEX_SOF_DSI0 | MT8188_MUTEX_EOF_DSI0,\n\t[MUTEX_SOF_DP_INTF0] =\n\t\tMT8188_MUTEX_SOF_DP_INTF0 | MT8188_MUTEX_EOF_DP_INTF0,\n};\n\nstatic const unsigned int mt8195_mutex_sof[DDP_MUTEX_SOF_MAX] = {\n\t[MUTEX_SOF_SINGLE_MODE] = MUTEX_SOF_SINGLE_MODE,\n\t[MUTEX_SOF_DSI0] = MT8195_MUTEX_SOF_DSI0 | MT8195_MUTEX_EOF_DSI0,\n\t[MUTEX_SOF_DSI1] = MT8195_MUTEX_SOF_DSI1 | MT8195_MUTEX_EOF_DSI1,\n\t[MUTEX_SOF_DPI0] = MT8195_MUTEX_SOF_DPI0 | MT8195_MUTEX_EOF_DPI0,\n\t[MUTEX_SOF_DPI1] = MT8195_MUTEX_SOF_DPI1 | MT8195_MUTEX_EOF_DPI1,\n\t[MUTEX_SOF_DP_INTF0] =\n\t\tMT8195_MUTEX_SOF_DP_INTF0 | MT8195_MUTEX_EOF_DP_INTF0,\n\t[MUTEX_SOF_DP_INTF1] =\n\t\tMT8195_MUTEX_SOF_DP_INTF1 | MT8195_MUTEX_EOF_DP_INTF1,\n};\n\nstatic const struct mtk_mutex_data mt2701_mutex_driver_data = {\n\t.mutex_mod = mt2701_mutex_mod,\n\t.mutex_sof = mt2712_mutex_sof,\n\t.mutex_mod_reg = MT2701_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT2701_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt2712_mutex_driver_data = {\n\t.mutex_mod = mt2712_mutex_mod,\n\t.mutex_sof = mt2712_mutex_sof,\n\t.mutex_mod_reg = MT2701_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT2701_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt6795_mutex_driver_data = {\n\t.mutex_mod = mt8173_mutex_mod,\n\t.mutex_sof = mt6795_mutex_sof,\n\t.mutex_mod_reg = MT2701_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT2701_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt8167_mutex_driver_data = {\n\t.mutex_mod = mt8167_mutex_mod,\n\t.mutex_sof = mt8167_mutex_sof,\n\t.mutex_mod_reg = MT2701_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT2701_MUTEX0_SOF0,\n\t.no_clk = true,\n};\n\nstatic const struct mtk_mutex_data mt8173_mutex_driver_data = {\n\t.mutex_mod = mt8173_mutex_mod,\n\t.mutex_sof = mt2712_mutex_sof,\n\t.mutex_mod_reg = MT2701_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT2701_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt8183_mutex_driver_data = {\n\t.mutex_mod = mt8183_mutex_mod,\n\t.mutex_sof = mt8183_mutex_sof,\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n\t.mutex_table_mod = mt8183_mutex_table_mod,\n\t.no_clk = true,\n};\n\nstatic const struct mtk_mutex_data mt8186_mdp_mutex_driver_data = {\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n\t.mutex_table_mod = mt8186_mdp_mutex_table_mod,\n};\n\nstatic const struct mtk_mutex_data mt8186_mutex_driver_data = {\n\t.mutex_mod = mt8186_mutex_mod,\n\t.mutex_sof = mt8186_mutex_sof,\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt8188_mutex_driver_data = {\n\t.mutex_mod = mt8188_mutex_mod,\n\t.mutex_sof = mt8188_mutex_sof,\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt8192_mutex_driver_data = {\n\t.mutex_mod = mt8192_mutex_mod,\n\t.mutex_sof = mt8183_mutex_sof,\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt8195_mutex_driver_data = {\n\t.mutex_mod = mt8195_mutex_mod,\n\t.mutex_sof = mt8195_mutex_sof,\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n};\n\nstatic const struct mtk_mutex_data mt8195_vpp_mutex_driver_data = {\n\t.mutex_sof = mt8195_mutex_sof,\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n\t.mutex_table_mod = mt8195_mutex_table_mod,\n};\n\nstatic const struct mtk_mutex_data mt8365_mutex_driver_data = {\n\t.mutex_mod = mt8365_mutex_mod,\n\t.mutex_sof = mt8183_mutex_sof,\n\t.mutex_mod_reg = MT8183_MUTEX0_MOD0,\n\t.mutex_sof_reg = MT8183_MUTEX0_SOF0,\n\t.no_clk = true,\n};\n\nstruct mtk_mutex *mtk_mutex_get(struct device *dev)\n{\n\tstruct mtk_mutex_ctx *mtx = dev_get_drvdata(dev);\n\tint i;\n\n\tfor (i = 0; i < MTK_MUTEX_MAX_HANDLES; i++)\n\t\tif (!mtx->mutex[i].claimed) {\n\t\t\tmtx->mutex[i].claimed = true;\n\t\t\treturn &mtx->mutex[i];\n\t\t}\n\n\treturn ERR_PTR(-EBUSY);\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_get);\n\nvoid mtk_mutex_put(struct mtk_mutex *mutex)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\tmutex->claimed = false;\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_put);\n\nint mtk_mutex_prepare(struct mtk_mutex *mutex)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\treturn clk_prepare_enable(mtx->clk);\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_prepare);\n\nvoid mtk_mutex_unprepare(struct mtk_mutex *mutex)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\tclk_disable_unprepare(mtx->clk);\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_unprepare);\n\nvoid mtk_mutex_add_comp(struct mtk_mutex *mutex,\n\t\t\tenum mtk_ddp_comp_id id)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\tunsigned int reg;\n\tunsigned int sof_id;\n\tunsigned int offset;\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\tswitch (id) {\n\tcase DDP_COMPONENT_DSI0:\n\t\tsof_id = MUTEX_SOF_DSI0;\n\t\tbreak;\n\tcase DDP_COMPONENT_DSI1:\n\t\tsof_id = MUTEX_SOF_DSI0;\n\t\tbreak;\n\tcase DDP_COMPONENT_DSI2:\n\t\tsof_id = MUTEX_SOF_DSI2;\n\t\tbreak;\n\tcase DDP_COMPONENT_DSI3:\n\t\tsof_id = MUTEX_SOF_DSI3;\n\t\tbreak;\n\tcase DDP_COMPONENT_DPI0:\n\t\tsof_id = MUTEX_SOF_DPI0;\n\t\tbreak;\n\tcase DDP_COMPONENT_DPI1:\n\t\tsof_id = MUTEX_SOF_DPI1;\n\t\tbreak;\n\tcase DDP_COMPONENT_DP_INTF0:\n\t\tsof_id = MUTEX_SOF_DP_INTF0;\n\t\tbreak;\n\tcase DDP_COMPONENT_DP_INTF1:\n\t\tsof_id = MUTEX_SOF_DP_INTF1;\n\t\tbreak;\n\tdefault:\n\t\tif (mtx->data->mutex_mod[id] < 32) {\n\t\t\toffset = DISP_REG_MUTEX_MOD(mtx->data->mutex_mod_reg,\n\t\t\t\t\t\t    mutex->id);\n\t\t\treg = readl_relaxed(mtx->regs + offset);\n\t\t\treg |= 1 << mtx->data->mutex_mod[id];\n\t\t\twritel_relaxed(reg, mtx->regs + offset);\n\t\t} else {\n\t\t\toffset = DISP_REG_MUTEX_MOD2(mutex->id);\n\t\t\treg = readl_relaxed(mtx->regs + offset);\n\t\t\treg |= 1 << (mtx->data->mutex_mod[id] - 32);\n\t\t\twritel_relaxed(reg, mtx->regs + offset);\n\t\t}\n\t\treturn;\n\t}\n\n\twritel_relaxed(mtx->data->mutex_sof[sof_id],\n\t\t       mtx->regs +\n\t\t       DISP_REG_MUTEX_SOF(mtx->data->mutex_sof_reg, mutex->id));\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_add_comp);\n\nvoid mtk_mutex_remove_comp(struct mtk_mutex *mutex,\n\t\t\t   enum mtk_ddp_comp_id id)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\tunsigned int reg;\n\tunsigned int offset;\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\tswitch (id) {\n\tcase DDP_COMPONENT_DSI0:\n\tcase DDP_COMPONENT_DSI1:\n\tcase DDP_COMPONENT_DSI2:\n\tcase DDP_COMPONENT_DSI3:\n\tcase DDP_COMPONENT_DPI0:\n\tcase DDP_COMPONENT_DPI1:\n\tcase DDP_COMPONENT_DP_INTF0:\n\tcase DDP_COMPONENT_DP_INTF1:\n\t\twritel_relaxed(MUTEX_SOF_SINGLE_MODE,\n\t\t\t       mtx->regs +\n\t\t\t       DISP_REG_MUTEX_SOF(mtx->data->mutex_sof_reg,\n\t\t\t\t\t\t  mutex->id));\n\t\tbreak;\n\tdefault:\n\t\tif (mtx->data->mutex_mod[id] < 32) {\n\t\t\toffset = DISP_REG_MUTEX_MOD(mtx->data->mutex_mod_reg,\n\t\t\t\t\t\t    mutex->id);\n\t\t\treg = readl_relaxed(mtx->regs + offset);\n\t\t\treg &= ~(1 << mtx->data->mutex_mod[id]);\n\t\t\twritel_relaxed(reg, mtx->regs + offset);\n\t\t} else {\n\t\t\toffset = DISP_REG_MUTEX_MOD2(mutex->id);\n\t\t\treg = readl_relaxed(mtx->regs + offset);\n\t\t\treg &= ~(1 << (mtx->data->mutex_mod[id] - 32));\n\t\t\twritel_relaxed(reg, mtx->regs + offset);\n\t\t}\n\t\tbreak;\n\t}\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_remove_comp);\n\nvoid mtk_mutex_enable(struct mtk_mutex *mutex)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\twritel(1, mtx->regs + DISP_REG_MUTEX_EN(mutex->id));\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_enable);\n\nint mtk_mutex_enable_by_cmdq(struct mtk_mutex *mutex, void *pkt)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\tstruct cmdq_pkt *cmdq_pkt = (struct cmdq_pkt *)pkt;\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\tif (!mtx->cmdq_reg.size) {\n\t\tdev_err(mtx->dev, \"mediatek,gce-client-reg hasn't been set\");\n\t\treturn -ENODEV;\n\t}\n\n\tcmdq_pkt_write(cmdq_pkt, mtx->cmdq_reg.subsys,\n\t\t       mtx->addr + DISP_REG_MUTEX_EN(mutex->id), 1);\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_enable_by_cmdq);\n\nvoid mtk_mutex_disable(struct mtk_mutex *mutex)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\twritel(0, mtx->regs + DISP_REG_MUTEX_EN(mutex->id));\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_disable);\n\nvoid mtk_mutex_acquire(struct mtk_mutex *mutex)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\tu32 tmp;\n\n\twritel(1, mtx->regs + DISP_REG_MUTEX_EN(mutex->id));\n\twritel(1, mtx->regs + DISP_REG_MUTEX(mutex->id));\n\tif (readl_poll_timeout_atomic(mtx->regs + DISP_REG_MUTEX(mutex->id),\n\t\t\t\t      tmp, tmp & INT_MUTEX, 1, 10000))\n\t\tpr_err(\"could not acquire mutex %d\\n\", mutex->id);\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_acquire);\n\nvoid mtk_mutex_release(struct mtk_mutex *mutex)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\n\twritel(0, mtx->regs + DISP_REG_MUTEX(mutex->id));\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_release);\n\nint mtk_mutex_write_mod(struct mtk_mutex *mutex,\n\t\t\tenum mtk_mutex_mod_index idx, bool clear)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\tunsigned int reg;\n\tu32 reg_offset, id_offset = 0;\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\tif (idx < MUTEX_MOD_IDX_MDP_RDMA0 ||\n\t    idx >= MUTEX_MOD_IDX_MAX) {\n\t\tdev_err(mtx->dev, \"Not supported MOD table index : %d\", idx);\n\t\treturn -EINVAL;\n\t}\n\n\t \n\tif (mtx->data->mutex_table_mod[idx] < 32) {\n\t\treg_offset = DISP_REG_MUTEX_MOD(mtx->data->mutex_mod_reg,\n\t\t\t\t\t\tmutex->id);\n\t} else {\n\t\treg_offset = DISP_REG_MUTEX_MOD1(mtx->data->mutex_mod_reg,\n\t\t\t\t\t\t mutex->id);\n\t\tid_offset = 32;\n\t}\n\n\treg = readl_relaxed(mtx->regs + reg_offset);\n\tif (clear)\n\t\treg &= ~BIT(mtx->data->mutex_table_mod[idx] - id_offset);\n\telse\n\t\treg |= BIT(mtx->data->mutex_table_mod[idx] - id_offset);\n\n\twritel_relaxed(reg, mtx->regs + reg_offset);\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_write_mod);\n\nint mtk_mutex_write_sof(struct mtk_mutex *mutex,\n\t\t\tenum mtk_mutex_sof_index idx)\n{\n\tstruct mtk_mutex_ctx *mtx = container_of(mutex, struct mtk_mutex_ctx,\n\t\t\t\t\t\t mutex[mutex->id]);\n\n\tWARN_ON(&mtx->mutex[mutex->id] != mutex);\n\n\tif (idx < MUTEX_SOF_IDX_SINGLE_MODE ||\n\t    idx >= MUTEX_SOF_IDX_MAX) {\n\t\tdev_err(mtx->dev, \"Not supported SOF index : %d\", idx);\n\t\treturn -EINVAL;\n\t}\n\n\twritel_relaxed(idx, mtx->regs +\n\t\t       DISP_REG_MUTEX_SOF(mtx->data->mutex_sof_reg, mutex->id));\n\n\treturn 0;\n}\nEXPORT_SYMBOL_GPL(mtk_mutex_write_sof);\n\nstatic int mtk_mutex_probe(struct platform_device *pdev)\n{\n\tstruct device *dev = &pdev->dev;\n\tstruct mtk_mutex_ctx *mtx;\n\tstruct resource *regs;\n\tint i, ret;\n\n\tmtx = devm_kzalloc(dev, sizeof(*mtx), GFP_KERNEL);\n\tif (!mtx)\n\t\treturn -ENOMEM;\n\n\tfor (i = 0; i < MTK_MUTEX_MAX_HANDLES; i++)\n\t\tmtx->mutex[i].id = i;\n\n\tmtx->data = of_device_get_match_data(dev);\n\n\tif (!mtx->data->no_clk) {\n\t\tmtx->clk = devm_clk_get(dev, NULL);\n\t\tif (IS_ERR(mtx->clk))\n\t\t\treturn dev_err_probe(dev, PTR_ERR(mtx->clk), \"Failed to get clock\\n\");\n\t}\n\n\tmtx->regs = devm_platform_get_and_ioremap_resource(pdev, 0, &regs);\n\tif (IS_ERR(mtx->regs)) {\n\t\tdev_err(dev, \"Failed to map mutex registers\\n\");\n\t\treturn PTR_ERR(mtx->regs);\n\t}\n\tmtx->addr = regs->start;\n\n\t \n\tret = cmdq_dev_get_client_reg(dev, &mtx->cmdq_reg, 0);\n\tif (ret)\n\t\tdev_dbg(dev, \"No mediatek,gce-client-reg!\\n\");\n\n\tplatform_set_drvdata(pdev, mtx);\n\n\treturn 0;\n}\n\nstatic const struct of_device_id mutex_driver_dt_match[] = {\n\t{ .compatible = \"mediatek,mt2701-disp-mutex\", .data = &mt2701_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt2712-disp-mutex\", .data = &mt2712_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt6795-disp-mutex\", .data = &mt6795_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8167-disp-mutex\", .data = &mt8167_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8173-disp-mutex\", .data = &mt8173_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8183-disp-mutex\", .data = &mt8183_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8186-disp-mutex\", .data = &mt8186_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8186-mdp3-mutex\", .data = &mt8186_mdp_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8188-disp-mutex\", .data = &mt8188_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8192-disp-mutex\", .data = &mt8192_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8195-disp-mutex\", .data = &mt8195_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8195-vpp-mutex\",  .data = &mt8195_vpp_mutex_driver_data },\n\t{ .compatible = \"mediatek,mt8365-disp-mutex\", .data = &mt8365_mutex_driver_data },\n\t{   },\n};\nMODULE_DEVICE_TABLE(of, mutex_driver_dt_match);\n\nstatic struct platform_driver mtk_mutex_driver = {\n\t.probe\t\t= mtk_mutex_probe,\n\t.driver\t\t= {\n\t\t.name\t= \"mediatek-mutex\",\n\t\t.of_match_table = mutex_driver_dt_match,\n\t},\n};\nmodule_platform_driver(mtk_mutex_driver);\n\nMODULE_AUTHOR(\"Yongqiang Niu <yongqiang.niu@mediatek.com>\");\nMODULE_DESCRIPTION(\"MediaTek SoC MUTEX driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}