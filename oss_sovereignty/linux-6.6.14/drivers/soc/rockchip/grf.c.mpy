{
  "module_name": "grf.c",
  "hash_id": "f2fe31bc14b97feeca1bf3db0a3ffaefadb96194422ea07267d7e23d2fe8edd9",
  "original_prompt": "Ingested from linux-6.6.14/drivers/soc/rockchip/grf.c",
  "human_readable_source": "\n \n\n#include <linux/err.h>\n#include <linux/mfd/syscon.h>\n#include <linux/of.h>\n#include <linux/platform_device.h>\n#include <linux/regmap.h>\n\n#define HIWORD_UPDATE(val, mask, shift) \\\n\t\t((val) << (shift) | (mask) << ((shift) + 16))\n\nstruct rockchip_grf_value {\n\tconst char *desc;\n\tu32 reg;\n\tu32 val;\n};\n\nstruct rockchip_grf_info {\n\tconst struct rockchip_grf_value *values;\n\tint num_values;\n};\n\n#define RK3036_GRF_SOC_CON0\t\t0x140\n\nstatic const struct rockchip_grf_value rk3036_defaults[] __initconst = {\n\t \n\t{ \"jtag switching\", RK3036_GRF_SOC_CON0, HIWORD_UPDATE(0, 1, 11) },\n};\n\nstatic const struct rockchip_grf_info rk3036_grf __initconst = {\n\t.values = rk3036_defaults,\n\t.num_values = ARRAY_SIZE(rk3036_defaults),\n};\n\n#define RK3128_GRF_SOC_CON0\t\t0x140\n\nstatic const struct rockchip_grf_value rk3128_defaults[] __initconst = {\n\t{ \"jtag switching\", RK3128_GRF_SOC_CON0, HIWORD_UPDATE(0, 1, 8) },\n};\n\nstatic const struct rockchip_grf_info rk3128_grf __initconst = {\n\t.values = rk3128_defaults,\n\t.num_values = ARRAY_SIZE(rk3128_defaults),\n};\n\n#define RK3228_GRF_SOC_CON6\t\t0x418\n\nstatic const struct rockchip_grf_value rk3228_defaults[] __initconst = {\n\t{ \"jtag switching\", RK3228_GRF_SOC_CON6, HIWORD_UPDATE(0, 1, 8) },\n};\n\nstatic const struct rockchip_grf_info rk3228_grf __initconst = {\n\t.values = rk3228_defaults,\n\t.num_values = ARRAY_SIZE(rk3228_defaults),\n};\n\n#define RK3288_GRF_SOC_CON0\t\t0x244\n#define RK3288_GRF_SOC_CON2\t\t0x24c\n\nstatic const struct rockchip_grf_value rk3288_defaults[] __initconst = {\n\t{ \"jtag switching\", RK3288_GRF_SOC_CON0, HIWORD_UPDATE(0, 1, 12) },\n\t{ \"pwm select\", RK3288_GRF_SOC_CON2, HIWORD_UPDATE(1, 1, 0) },\n};\n\nstatic const struct rockchip_grf_info rk3288_grf __initconst = {\n\t.values = rk3288_defaults,\n\t.num_values = ARRAY_SIZE(rk3288_defaults),\n};\n\n#define RK3328_GRF_SOC_CON4\t\t0x410\n\nstatic const struct rockchip_grf_value rk3328_defaults[] __initconst = {\n\t{ \"jtag switching\", RK3328_GRF_SOC_CON4, HIWORD_UPDATE(0, 1, 12) },\n};\n\nstatic const struct rockchip_grf_info rk3328_grf __initconst = {\n\t.values = rk3328_defaults,\n\t.num_values = ARRAY_SIZE(rk3328_defaults),\n};\n\n#define RK3368_GRF_SOC_CON15\t\t0x43c\n\nstatic const struct rockchip_grf_value rk3368_defaults[] __initconst = {\n\t{ \"jtag switching\", RK3368_GRF_SOC_CON15, HIWORD_UPDATE(0, 1, 13) },\n};\n\nstatic const struct rockchip_grf_info rk3368_grf __initconst = {\n\t.values = rk3368_defaults,\n\t.num_values = ARRAY_SIZE(rk3368_defaults),\n};\n\n#define RK3399_GRF_SOC_CON7\t\t0xe21c\n\nstatic const struct rockchip_grf_value rk3399_defaults[] __initconst = {\n\t{ \"jtag switching\", RK3399_GRF_SOC_CON7, HIWORD_UPDATE(0, 1, 12) },\n};\n\nstatic const struct rockchip_grf_info rk3399_grf __initconst = {\n\t.values = rk3399_defaults,\n\t.num_values = ARRAY_SIZE(rk3399_defaults),\n};\n\n#define RK3566_GRF_USB3OTG0_CON1\t0x0104\n\nstatic const struct rockchip_grf_value rk3566_defaults[] __initconst = {\n\t{ \"usb3otg port switch\", RK3566_GRF_USB3OTG0_CON1, HIWORD_UPDATE(0, 1, 12) },\n\t{ \"usb3otg clock switch\", RK3566_GRF_USB3OTG0_CON1, HIWORD_UPDATE(1, 1, 7) },\n\t{ \"usb3otg disable usb3\", RK3566_GRF_USB3OTG0_CON1, HIWORD_UPDATE(1, 1, 0) },\n};\n\nstatic const struct rockchip_grf_info rk3566_pipegrf __initconst = {\n\t.values = rk3566_defaults,\n\t.num_values = ARRAY_SIZE(rk3566_defaults),\n};\n\n#define RK3588_GRF_SOC_CON6\t\t0x0318\n\nstatic const struct rockchip_grf_value rk3588_defaults[] __initconst = {\n\t{ \"jtag switching\", RK3588_GRF_SOC_CON6, HIWORD_UPDATE(0, 1, 14) },\n};\n\nstatic const struct rockchip_grf_info rk3588_sysgrf __initconst = {\n\t.values = rk3588_defaults,\n\t.num_values = ARRAY_SIZE(rk3588_defaults),\n};\n\n\nstatic const struct of_device_id rockchip_grf_dt_match[] __initconst = {\n\t{\n\t\t.compatible = \"rockchip,rk3036-grf\",\n\t\t.data = (void *)&rk3036_grf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3128-grf\",\n\t\t.data = (void *)&rk3128_grf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3228-grf\",\n\t\t.data = (void *)&rk3228_grf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3288-grf\",\n\t\t.data = (void *)&rk3288_grf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3328-grf\",\n\t\t.data = (void *)&rk3328_grf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3368-grf\",\n\t\t.data = (void *)&rk3368_grf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3399-grf\",\n\t\t.data = (void *)&rk3399_grf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3566-pipe-grf\",\n\t\t.data = (void *)&rk3566_pipegrf,\n\t}, {\n\t\t.compatible = \"rockchip,rk3588-sys-grf\",\n\t\t.data = (void *)&rk3588_sysgrf,\n\t},\n\t{   },\n};\n\nstatic int __init rockchip_grf_init(void)\n{\n\tconst struct rockchip_grf_info *grf_info;\n\tconst struct of_device_id *match;\n\tstruct device_node *np;\n\tstruct regmap *grf;\n\tint ret, i;\n\n\tnp = of_find_matching_node_and_match(NULL, rockchip_grf_dt_match,\n\t\t\t\t\t     &match);\n\tif (!np)\n\t\treturn -ENODEV;\n\tif (!match || !match->data) {\n\t\tpr_err(\"%s: missing grf data\\n\", __func__);\n\t\tof_node_put(np);\n\t\treturn -EINVAL;\n\t}\n\n\tgrf_info = match->data;\n\n\tgrf = syscon_node_to_regmap(np);\n\tof_node_put(np);\n\tif (IS_ERR(grf)) {\n\t\tpr_err(\"%s: could not get grf syscon\\n\", __func__);\n\t\treturn PTR_ERR(grf);\n\t}\n\n\tfor (i = 0; i < grf_info->num_values; i++) {\n\t\tconst struct rockchip_grf_value *val = &grf_info->values[i];\n\n\t\tpr_debug(\"%s: adjusting %s in %#6x to %#10x\\n\", __func__,\n\t\t\tval->desc, val->reg, val->val);\n\t\tret = regmap_write(grf, val->reg, val->val);\n\t\tif (ret < 0)\n\t\t\tpr_err(\"%s: write to %#6x failed with %d\\n\",\n\t\t\t       __func__, val->reg, ret);\n\t}\n\n\treturn 0;\n}\npostcore_initcall(rockchip_grf_init);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}