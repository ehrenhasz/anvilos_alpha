{
  "module_name": "abituguru3.c",
  "hash_id": "d9764c671535d3f8c16048d7fbb401c5a8ef27ec892b430b3b7cbba5885258f4",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/abituguru3.c",
  "human_readable_source": "\n \n \n\n#define pr_fmt(fmt) KBUILD_MODNAME \": \" fmt\n\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/jiffies.h>\n#include <linux/mutex.h>\n#include <linux/err.h>\n#include <linux/delay.h>\n#include <linux/platform_device.h>\n#include <linux/hwmon.h>\n#include <linux/hwmon-sysfs.h>\n#include <linux/dmi.h>\n#include <linux/io.h>\n\n \n#define ABIT_UGURU3_SETTINGS_BANK\t\t0x01\n#define ABIT_UGURU3_SENSORS_BANK\t\t0x08\n#define ABIT_UGURU3_MISC_BANK\t\t\t0x09\n#define ABIT_UGURU3_ALARMS_START\t\t0x1E\n#define ABIT_UGURU3_SETTINGS_START\t\t0x24\n#define ABIT_UGURU3_VALUES_START\t\t0x80\n#define ABIT_UGURU3_BOARD_ID\t\t\t0x0A\n \t\t\t      \n#define ABIT_UGURU3_TEMP_HIGH_ALARM_ENABLE\t0x01  \n#define ABIT_UGURU3_VOLT_HIGH_ALARM_ENABLE\t0x02  \n#define ABIT_UGURU3_VOLT_LOW_ALARM_ENABLE\t0x04  \n#define ABIT_UGURU3_TEMP_HIGH_ALARM_FLAG\t0x10  \n#define ABIT_UGURU3_VOLT_HIGH_ALARM_FLAG\t0x20  \n#define ABIT_UGURU3_VOLT_LOW_ALARM_FLAG\t\t0x40  \n#define ABIT_UGURU3_FAN_LOW_ALARM_ENABLE\t0x01  \n#define ABIT_UGURU3_BEEP_ENABLE\t\t\t0x08  \n#define ABIT_UGURU3_SHUTDOWN_ENABLE\t\t0x80  \n \n#define ABIT_UGURU3_IN_SENSOR\t\t\t0\n#define ABIT_UGURU3_TEMP_SENSOR\t\t\t1\n#define ABIT_UGURU3_FAN_SENSOR\t\t\t2\n\n \n#define ABIT_UGURU3_WAIT_TIMEOUT\t\t250\n \n#define ABIT_UGURU3_SYNCHRONIZE_TIMEOUT\t\t5\n \n#define ABIT_UGURU3_NAME\t\t\t\"abituguru3\"\n#define ABIT_UGURU3_DEBUG(format, arg...)\t\t\\\n\tdo {\t\t\t\t\t\t\\\n\t\tif (verbose)\t\t\t\t\\\n\t\t\tpr_debug(format , ## arg);\t\\\n\t} while (0)\n\n \n#define ABIT_UGURU3_MAX_NO_SENSORS 26\n \n#define ABIT_UGURU3_IN_NAMES_LENGTH \\\n\t\t\t\t(11 + 2 * 9 + 2 * 15 + 2 * 22 + 10 + 14 + 11)\n \n#define ABIT_UGURU3_TEMP_NAMES_LENGTH (13 + 11 + 12 + 13 + 20 + 12 + 16 + 13)\n \n#define ABIT_UGURU3_FAN_NAMES_LENGTH (12 + 10 + 12 + 19 + 11 + 15 + 12)\n \n#define ABIT_UGURU3_SYSFS_NAMES_LENGTH (16 * ABIT_UGURU3_IN_NAMES_LENGTH + \\\n\t(ABIT_UGURU3_MAX_NO_SENSORS - 16) * ABIT_UGURU3_TEMP_NAMES_LENGTH)\n\n \n \n#define ABIT_UGURU3_BASE\t\t\t0x00E0\n#define ABIT_UGURU3_CMD\t\t\t\t0x00\n#define ABIT_UGURU3_DATA\t\t\t0x04\n#define ABIT_UGURU3_REGION_LENGTH\t\t5\n \n#define ABIT_UGURU3_SUCCESS\t\t\t-1\n \n#define ABIT_UGURU3_STATUS_READY_FOR_READ\t0x01\n#define ABIT_UGURU3_STATUS_BUSY\t\t\t0x02\n\n\n \nstruct abituguru3_sensor_info {\n\tconst char *name;\n\tint port;\n\tint type;\n\tint multiplier;\n\tint divisor;\n\tint offset;\n};\n\n \n#define ABIT_UGURU3_MAX_DMI_NAMES 2\n\nstruct abituguru3_motherboard_info {\n\tu16 id;\n\tconst char *dmi_name[ABIT_UGURU3_MAX_DMI_NAMES + 1];\n\t \n\tstruct abituguru3_sensor_info sensors[ABIT_UGURU3_MAX_NO_SENSORS + 1];\n};\n\n \nstruct abituguru3_data {\n\tstruct device *hwmon_dev;\t \n\tstruct mutex update_lock;\t \n\tunsigned short addr;\t\t \n\tbool valid;\t\t\t \n\tunsigned long last_updated;\t \n\n\t \n\tstruct sensor_device_attribute_2 sysfs_attr[ABIT_UGURU3_MAX_NO_SENSORS\n\t\t* 10];\n\n\t \n\tchar sysfs_names[ABIT_UGURU3_SYSFS_NAMES_LENGTH];\n\n\t \n\tconst struct abituguru3_sensor_info *sensors;\n\n\t \n\n\t \n\tu8 alarms[48/8];\n\n\t \n\tu8 value[48];\n\n\t \n\tu8 settings[48][3];\n};\n\n\n \nstatic const struct abituguru3_motherboard_info abituguru3_motherboards[] = {\n\t{ 0x000C, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH & PCIE 1.5V\",\t 4, 0, 10, 1, 0 },\n\t\t{ \"MCH 2.5V\",\t\t 5, 0, 20, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS FAN\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x000D, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH & PCIE 1.5V\",\t 4, 0, 10, 1, 0 },\n\t\t{ \"MCH 2.5V\",\t\t 5, 0, 20, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM1\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t37, 2, 60, 1, 0 },\n\t\t{ \"AUX4 Fan\",\t\t38, 2, 60, 1, 0 },\n\t\t{ \"AUX5 Fan\",\t\t39, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x000E, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH & PCIE 1.5V\",\t 4, 0, 10, 1, 0 },\n\t\t{ \"MCH 2.5V\",\t\t 5, 0, 20, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x000F, { NULL }  , {\n\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH & PCIE 1.5V\",\t 4, 0, 10, 1, 0 },\n\t\t{ \"MCH 2.5V\",\t\t 5, 0, 20, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0010, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"NB 1.4V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"SB 1.5V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"SYS\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"OTES1 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0011, { \"AT8 32X\", NULL }, {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VDDA 2.5V\",\t 6, 0, 20, 1, 0 },\n\t\t{ \"NB 1.8V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"NB 1.8V Dual\",\t 5, 0, 10, 1, 0 },\n\t\t{ \"HTV 1.2\",\t\t 3, 0, 10, 1, 0 },\n\t\t{ \"PCIE 1.2V\",\t\t12, 0, 10, 1, 0 },\n\t\t{ \"NB 1.2V\",\t\t13, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"NB\",\t\t\t25, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t37, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0012, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"HyperTransport\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"CPU VDDA 2.5V\",\t 5, 0, 20, 1, 0 },\n\t\t{ \"NB\",\t\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"SB\",\t\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"SYS\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0013, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH & PCIE 1.5V\",\t 4, 0, 10, 1, 0 },\n\t\t{ \"MCH 2.5V\",\t\t 5, 0, 20, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM1\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t37, 2, 60, 1, 0 },\n\t\t{ \"AUX4 Fan\",\t\t38, 2, 60, 1, 0 },\n\t\t{ \"AUX5 Fan\",\t\t39, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0014, { \"AB9\", \"AB9 Pro\", NULL }, {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 10, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH & PCIE 1.5V\",\t 4, 0, 10, 1, 0 },\n\t\t{ \"MCH 2.5V\",\t\t 5, 0, 20, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0015, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"HyperTransport\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"CPU VDDA 2.5V\",\t 5, 0, 20, 1, 0 },\n\t\t{ \"NB\",\t\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"SB\",\t\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"SYS\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0016, { \"AW9D-MAX\", NULL }, {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH & PCIE 1.5V\",\t 4, 0, 10, 1, 0 },\n\t\t{ \"MCH 2.5V\",\t\t 5, 0, 20, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM1\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"NB Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t37, 2, 60, 1, 0 },\n\t\t{ \"OTES1 Fan\",\t\t38, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0017, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"HyperTransport\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"CPU VDDA 2.5V\",\t 6, 0, 20, 1, 0 },\n\t\t{ \"NB 1.8V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"NB 1.2V \",\t\t13, 0, 10, 1, 0 },\n\t\t{ \"SB 1.2V\",\t\t 5, 0, 10, 1, 0 },\n\t\t{ \"PCIE 1.2V\",\t\t12, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"ATX +3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"ATX 5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"CPU FAN\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"SYS FAN\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 FAN\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX2 FAN\",\t\t36, 2, 60, 1, 0 },\n\t\t{ \"AUX3 FAN\",\t\t37, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0018, { \"AB9 QuadGT\", NULL }, {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT\",\t\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH 1.25V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"ICHIO 1.5V\",\t\t 5, 0, 10, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase1\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase5\",\t\t30, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0019, { \"IN9 32X MAX\", NULL }, {\n\t\t{ \"CPU Core\",\t\t 7, 0, 10, 1, 0 },\n\t\t{ \"DDR2\",\t\t13, 0, 20, 1, 0 },\n\t\t{ \"DDR2 VTT\",\t\t14, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT\",\t\t 3, 0, 20, 1, 0 },\n\t\t{ \"NB 1.2V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"SB 1.5V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"HyperTransport\",\t 5, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t12, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (4-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"ATX +3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"ATX 5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase1\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase5\",\t\t30, 1, 1, 1, 0 },\n\t\t{ \"CPU FAN\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"SYS FAN\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 FAN\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"AUX2 FAN\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX3 FAN\",\t\t36, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x001A, { \"IP35 Pro\", \"IP35 Pro XE\", NULL }, {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT 1.2V\",\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH 1.25V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"ICHIO 1.5V\",\t\t 5, 0, 10, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (8-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase5\",\t\t30, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ \"AUX4 Fan\",\t\t37, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x001B, { NULL }  , {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR3\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR3 VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT\",\t\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH 1.25V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"ICHIO 1.5V\",\t\t 5, 0, 10, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (8-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase1\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase5\",\t\t30, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x001C, { \"IX38 QuadGT\", NULL }, {\n\t\t{ \"CPU Core\",\t\t 0, 0, 10, 1, 0 },\n\t\t{ \"DDR2\",\t\t 1, 0, 20, 1, 0 },\n\t\t{ \"DDR2 VTT\",\t\t 2, 0, 10, 1, 0 },\n\t\t{ \"CPU VTT\",\t\t 3, 0, 10, 1, 0 },\n\t\t{ \"MCH 1.25V\",\t\t 4, 0, 10, 1, 0 },\n\t\t{ \"ICHIO 1.5V\",\t\t 5, 0, 10, 1, 0 },\n\t\t{ \"ICH 1.05V\",\t\t 6, 0, 10, 1, 0 },\n\t\t{ \"ATX +12V (24-Pin)\",\t 7, 0, 60, 1, 0 },\n\t\t{ \"ATX +12V (8-pin)\",\t 8, 0, 60, 1, 0 },\n\t\t{ \"ATX +5V\",\t\t 9, 0, 30, 1, 0 },\n\t\t{ \"+3.3V\",\t\t10, 0, 20, 1, 0 },\n\t\t{ \"5VSB\",\t\t11, 0, 30, 1, 0 },\n\t\t{ \"CPU\",\t\t24, 1, 1, 1, 0 },\n\t\t{ \"System\",\t\t25, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase1\",\t\t26, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase2\",\t\t27, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase3\",\t\t28, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase4\",\t\t29, 1, 1, 1, 0 },\n\t\t{ \"PWM Phase5\",\t\t30, 1, 1, 1, 0 },\n\t\t{ \"CPU Fan\",\t\t32, 2, 60, 1, 0 },\n\t\t{ \"SYS Fan\",\t\t34, 2, 60, 1, 0 },\n\t\t{ \"AUX1 Fan\",\t\t33, 2, 60, 1, 0 },\n\t\t{ \"AUX2 Fan\",\t\t35, 2, 60, 1, 0 },\n\t\t{ \"AUX3 Fan\",\t\t36, 2, 60, 1, 0 },\n\t\t{ NULL, 0, 0, 0, 0, 0 } }\n\t},\n\t{ 0x0000, { NULL }, { { NULL, 0, 0, 0, 0, 0 } } }\n};\n\n\n \nstatic bool force;\nmodule_param(force, bool, 0);\nMODULE_PARM_DESC(force, \"Set to one to force detection.\");\n \nstatic bool verbose = 1;\nmodule_param(verbose, bool, 0644);\nMODULE_PARM_DESC(verbose, \"Enable/disable verbose error reporting\");\n\nstatic const char *never_happen = \"This should never happen.\";\nstatic const char *report_this =\n\t\"Please report this to the abituguru3 maintainer (see MAINTAINERS)\";\n\n \nstatic int abituguru3_wait_while_busy(struct abituguru3_data *data)\n{\n\tu8 x;\n\tint timeout = ABIT_UGURU3_WAIT_TIMEOUT;\n\n\twhile ((x = inb_p(data->addr + ABIT_UGURU3_DATA)) &\n\t\t\tABIT_UGURU3_STATUS_BUSY) {\n\t\ttimeout--;\n\t\tif (timeout == 0)\n\t\t\treturn x;\n\t\t \n\t\tif (timeout == 1)\n\t\t\tmsleep(1);\n\t}\n\treturn ABIT_UGURU3_SUCCESS;\n}\n\n \nstatic int abituguru3_wait_for_read(struct abituguru3_data *data)\n{\n\tu8 x;\n\tint timeout = ABIT_UGURU3_WAIT_TIMEOUT;\n\n\twhile (!((x = inb_p(data->addr + ABIT_UGURU3_DATA)) &\n\t\t\tABIT_UGURU3_STATUS_READY_FOR_READ)) {\n\t\ttimeout--;\n\t\tif (timeout == 0)\n\t\t\treturn x;\n\t\t \n\t\tif (timeout == 1)\n\t\t\tmsleep(1);\n\t}\n\treturn ABIT_UGURU3_SUCCESS;\n}\n\n \nstatic int abituguru3_synchronize(struct abituguru3_data *data)\n{\n\tint x, timeout = ABIT_UGURU3_SYNCHRONIZE_TIMEOUT;\n\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"synchronize timeout during initial busy \"\n\t\t\t\"wait, status: 0x%02x\\n\", x);\n\t\treturn -EIO;\n\t}\n\n\toutb(0x20, data->addr + ABIT_UGURU3_DATA);\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"synchronize timeout after sending 0x20, \"\n\t\t\t\"status: 0x%02x\\n\", x);\n\t\treturn -EIO;\n\t}\n\n\toutb(0x10, data->addr + ABIT_UGURU3_CMD);\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"synchronize timeout after sending 0x10, \"\n\t\t\t\"status: 0x%02x\\n\", x);\n\t\treturn -EIO;\n\t}\n\n\toutb(0x00, data->addr + ABIT_UGURU3_CMD);\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"synchronize timeout after sending 0x00, \"\n\t\t\t\"status: 0x%02x\\n\", x);\n\t\treturn -EIO;\n\t}\n\n\tx = abituguru3_wait_for_read(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"synchronize timeout waiting for read, \"\n\t\t\t\"status: 0x%02x\\n\", x);\n\t\treturn -EIO;\n\t}\n\n\twhile ((x = inb(data->addr + ABIT_UGURU3_CMD)) != 0xAC) {\n\t\ttimeout--;\n\t\tif (timeout == 0) {\n\t\t\tABIT_UGURU3_DEBUG(\"synchronize timeout cmd does not \"\n\t\t\t\t\"hold 0xAC after synchronize, cmd: 0x%02x\\n\",\n\t\t\t\tx);\n\t\t\treturn -EIO;\n\t\t}\n\t\tmsleep(1);\n\t}\n\treturn 0;\n}\n\n \nstatic int abituguru3_read(struct abituguru3_data *data, u8 bank, u8 offset,\n\tu8 count, u8 *buf)\n{\n\tint i, x;\n\n\tx = abituguru3_synchronize(data);\n\tif (x)\n\t\treturn x;\n\n\toutb(0x1A, data->addr + ABIT_UGURU3_DATA);\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"read from 0x%02x:0x%02x timed out after \"\n\t\t\t\"sending 0x1A, status: 0x%02x\\n\", (unsigned int)bank,\n\t\t\t(unsigned int)offset, x);\n\t\treturn -EIO;\n\t}\n\n\toutb(bank, data->addr + ABIT_UGURU3_CMD);\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"read from 0x%02x:0x%02x timed out after \"\n\t\t\t\"sending the bank, status: 0x%02x\\n\",\n\t\t\t(unsigned int)bank, (unsigned int)offset, x);\n\t\treturn -EIO;\n\t}\n\n\toutb(offset, data->addr + ABIT_UGURU3_CMD);\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"read from 0x%02x:0x%02x timed out after \"\n\t\t\t\"sending the offset, status: 0x%02x\\n\",\n\t\t\t(unsigned int)bank, (unsigned int)offset, x);\n\t\treturn -EIO;\n\t}\n\n\toutb(count, data->addr + ABIT_UGURU3_CMD);\n\tx = abituguru3_wait_while_busy(data);\n\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\tABIT_UGURU3_DEBUG(\"read from 0x%02x:0x%02x timed out after \"\n\t\t\t\"sending the count, status: 0x%02x\\n\",\n\t\t\t(unsigned int)bank, (unsigned int)offset, x);\n\t\treturn -EIO;\n\t}\n\n\tfor (i = 0; i < count; i++) {\n\t\tx = abituguru3_wait_for_read(data);\n\t\tif (x != ABIT_UGURU3_SUCCESS) {\n\t\t\tABIT_UGURU3_DEBUG(\"timeout reading byte %d from \"\n\t\t\t\t\"0x%02x:0x%02x, status: 0x%02x\\n\", i,\n\t\t\t\t(unsigned int)bank, (unsigned int)offset, x);\n\t\t\tbreak;\n\t\t}\n\t\tbuf[i] = inb(data->addr + ABIT_UGURU3_CMD);\n\t}\n\treturn i;\n}\n\n \nstatic int abituguru3_read_increment_offset(struct abituguru3_data *data,\n\t\t\t\t\t    u8 bank, u8 offset, u8 count,\n\t\t\t\t\t    u8 *buf, int offset_count)\n{\n\tint i, x;\n\n\tfor (i = 0; i < offset_count; i++) {\n\t\tx = abituguru3_read(data, bank, offset + i, count,\n\t\t\t\t    buf + i * count);\n\t\tif (x != count) {\n\t\t\tif (x < 0)\n\t\t\t\treturn x;\n\t\t\treturn i * count + x;\n\t\t}\n\t}\n\n\treturn i * count;\n}\n\n \nstatic struct abituguru3_data *abituguru3_update_device(struct device *dev);\n\nstatic ssize_t show_value(struct device *dev,\n\tstruct device_attribute *devattr, char *buf)\n{\n\tint value;\n\tstruct sensor_device_attribute_2 *attr = to_sensor_dev_attr_2(devattr);\n\tstruct abituguru3_data *data = abituguru3_update_device(dev);\n\tconst struct abituguru3_sensor_info *sensor;\n\n\tif (!data)\n\t\treturn -EIO;\n\n\tsensor = &data->sensors[attr->index];\n\n\t \n\tif (attr->nr)\n\t\tvalue = data->settings[sensor->port][attr->nr];\n\telse\n\t\tvalue = data->value[sensor->port];\n\n\t \n\tvalue = (value * sensor->multiplier) / sensor->divisor +\n\t\tsensor->offset;\n\n\t \n\tif (sensor->type == ABIT_UGURU3_TEMP_SENSOR)\n\t\tvalue *= 1000;\n\n\treturn sprintf(buf, \"%d\\n\", value);\n}\n\nstatic ssize_t show_alarm(struct device *dev,\n\tstruct device_attribute *devattr, char *buf)\n{\n\tint port;\n\tstruct sensor_device_attribute_2 *attr = to_sensor_dev_attr_2(devattr);\n\tstruct abituguru3_data *data = abituguru3_update_device(dev);\n\n\tif (!data)\n\t\treturn -EIO;\n\n\tport = data->sensors[attr->index].port;\n\n\t \n\tif ((data->alarms[port / 8] & (0x01 << (port % 8))) &&\n\t\t\t(!attr->nr || (data->settings[port][0] & attr->nr)))\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\nstatic ssize_t show_mask(struct device *dev,\n\tstruct device_attribute *devattr, char *buf)\n{\n\tstruct sensor_device_attribute_2 *attr = to_sensor_dev_attr_2(devattr);\n\tstruct abituguru3_data *data = dev_get_drvdata(dev);\n\n\tif (data->settings[data->sensors[attr->index].port][0] & attr->nr)\n\t\treturn sprintf(buf, \"1\\n\");\n\telse\n\t\treturn sprintf(buf, \"0\\n\");\n}\n\nstatic ssize_t show_label(struct device *dev,\n\tstruct device_attribute *devattr, char *buf)\n{\n\tstruct sensor_device_attribute_2 *attr = to_sensor_dev_attr_2(devattr);\n\tstruct abituguru3_data *data = dev_get_drvdata(dev);\n\n\treturn sprintf(buf, \"%s\\n\", data->sensors[attr->index].name);\n}\n\nstatic ssize_t show_name(struct device *dev,\n\tstruct device_attribute *devattr, char *buf)\n{\n\treturn sprintf(buf, \"%s\\n\", ABIT_UGURU3_NAME);\n}\n\n \nstatic const\nstruct sensor_device_attribute_2 abituguru3_sysfs_templ[3][10] = { {\n\tSENSOR_ATTR_2(in%d_input, 0444, show_value, NULL, 0, 0),\n\tSENSOR_ATTR_2(in%d_min, 0444, show_value, NULL, 1, 0),\n\tSENSOR_ATTR_2(in%d_max, 0444, show_value, NULL, 2, 0),\n\tSENSOR_ATTR_2(in%d_min_alarm, 0444, show_alarm, NULL,\n\t\tABIT_UGURU3_VOLT_LOW_ALARM_FLAG, 0),\n\tSENSOR_ATTR_2(in%d_max_alarm, 0444, show_alarm, NULL,\n\t\tABIT_UGURU3_VOLT_HIGH_ALARM_FLAG, 0),\n\tSENSOR_ATTR_2(in%d_beep, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_BEEP_ENABLE, 0),\n\tSENSOR_ATTR_2(in%d_shutdown, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_SHUTDOWN_ENABLE, 0),\n\tSENSOR_ATTR_2(in%d_min_alarm_enable, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_VOLT_LOW_ALARM_ENABLE, 0),\n\tSENSOR_ATTR_2(in%d_max_alarm_enable, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_VOLT_HIGH_ALARM_ENABLE, 0),\n\tSENSOR_ATTR_2(in%d_label, 0444, show_label, NULL, 0, 0)\n\t}, {\n\tSENSOR_ATTR_2(temp%d_input, 0444, show_value, NULL, 0, 0),\n\tSENSOR_ATTR_2(temp%d_max, 0444, show_value, NULL, 1, 0),\n\tSENSOR_ATTR_2(temp%d_crit, 0444, show_value, NULL, 2, 0),\n\tSENSOR_ATTR_2(temp%d_alarm, 0444, show_alarm, NULL, 0, 0),\n\tSENSOR_ATTR_2(temp%d_beep, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_BEEP_ENABLE, 0),\n\tSENSOR_ATTR_2(temp%d_shutdown, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_SHUTDOWN_ENABLE, 0),\n\tSENSOR_ATTR_2(temp%d_alarm_enable, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_TEMP_HIGH_ALARM_ENABLE, 0),\n\tSENSOR_ATTR_2(temp%d_label, 0444, show_label, NULL, 0, 0)\n\t}, {\n\tSENSOR_ATTR_2(fan%d_input, 0444, show_value, NULL, 0, 0),\n\tSENSOR_ATTR_2(fan%d_min, 0444, show_value, NULL, 1, 0),\n\tSENSOR_ATTR_2(fan%d_alarm, 0444, show_alarm, NULL, 0, 0),\n\tSENSOR_ATTR_2(fan%d_beep, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_BEEP_ENABLE, 0),\n\tSENSOR_ATTR_2(fan%d_shutdown, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_SHUTDOWN_ENABLE, 0),\n\tSENSOR_ATTR_2(fan%d_alarm_enable, 0444, show_mask, NULL,\n\t\tABIT_UGURU3_FAN_LOW_ALARM_ENABLE, 0),\n\tSENSOR_ATTR_2(fan%d_label, 0444, show_label, NULL, 0, 0)\n} };\n\nstatic struct sensor_device_attribute_2 abituguru3_sysfs_attr[] = {\n\tSENSOR_ATTR_2(name, 0444, show_name, NULL, 0, 0),\n};\n\nstatic int abituguru3_probe(struct platform_device *pdev)\n{\n\tconst int no_sysfs_attr[3] = { 10, 8, 7 };\n\tint sensor_index[3] = { 0, 1, 1 };\n\tstruct abituguru3_data *data;\n\tint i, j, type, used, sysfs_names_free, sysfs_attr_i, res = -ENODEV;\n\tchar *sysfs_filename;\n\tu8 buf[2];\n\tu16 id;\n\n\tdata = devm_kzalloc(&pdev->dev, sizeof(struct abituguru3_data),\n\t\t\t    GFP_KERNEL);\n\tif (!data)\n\t\treturn -ENOMEM;\n\n\tdata->addr = platform_get_resource(pdev, IORESOURCE_IO, 0)->start;\n\tmutex_init(&data->update_lock);\n\tplatform_set_drvdata(pdev, data);\n\n\t \n\ti = abituguru3_read(data, ABIT_UGURU3_MISC_BANK, ABIT_UGURU3_BOARD_ID,\n\t\t\t    2, buf);\n\tif (i != 2)\n\t\tgoto abituguru3_probe_error;\n\n\t \n\tif (!abituguru3_update_device(&pdev->dev))\n\t\tgoto abituguru3_probe_error;\n\n\t \n\tid = ((u16)buf[0] << 8) | (u16)buf[1];\n\tfor (i = 0; abituguru3_motherboards[i].id; i++)\n\t\tif (abituguru3_motherboards[i].id == id)\n\t\t\tbreak;\n\tif (!abituguru3_motherboards[i].id) {\n\t\tpr_err(\"error unknown motherboard ID: %04X. %s\\n\",\n\t\t       (unsigned int)id, report_this);\n\t\tgoto abituguru3_probe_error;\n\t}\n\tdata->sensors = abituguru3_motherboards[i].sensors;\n\n\tpr_info(\"found Abit uGuru3, motherboard ID: %04X\\n\", (unsigned int)id);\n\n\t \n\tsysfs_attr_i = 0;\n\tsysfs_filename = data->sysfs_names;\n\tsysfs_names_free = ABIT_UGURU3_SYSFS_NAMES_LENGTH;\n\tfor (i = 0; data->sensors[i].name; i++) {\n\t\t \n\t\tif (i >= ABIT_UGURU3_MAX_NO_SENSORS) {\n\t\t\tpr_err(\"Fatal error motherboard has more sensors then ABIT_UGURU3_MAX_NO_SENSORS. %s %s\\n\",\n\t\t\t       never_happen, report_this);\n\t\t\tres = -ENAMETOOLONG;\n\t\t\tgoto abituguru3_probe_error;\n\t\t}\n\t\ttype = data->sensors[i].type;\n\t\tfor (j = 0; j < no_sysfs_attr[type]; j++) {\n\t\t\tused = snprintf(sysfs_filename, sysfs_names_free,\n\t\t\t\tabituguru3_sysfs_templ[type][j].dev_attr.attr.\n\t\t\t\tname, sensor_index[type]) + 1;\n\t\t\tdata->sysfs_attr[sysfs_attr_i] =\n\t\t\t\tabituguru3_sysfs_templ[type][j];\n\t\t\tdata->sysfs_attr[sysfs_attr_i].dev_attr.attr.name =\n\t\t\t\tsysfs_filename;\n\t\t\tdata->sysfs_attr[sysfs_attr_i].index = i;\n\t\t\tsysfs_filename += used;\n\t\t\tsysfs_names_free -= used;\n\t\t\tsysfs_attr_i++;\n\t\t}\n\t\tsensor_index[type]++;\n\t}\n\t \n\tif (sysfs_names_free < 0) {\n\t\tpr_err(\"Fatal error ran out of space for sysfs attr names. %s %s\\n\",\n\t\t       never_happen, report_this);\n\t\tres = -ENAMETOOLONG;\n\t\tgoto abituguru3_probe_error;\n\t}\n\n\t \n\tfor (i = 0; i < sysfs_attr_i; i++)\n\t\tif (device_create_file(&pdev->dev,\n\t\t\t\t&data->sysfs_attr[i].dev_attr))\n\t\t\tgoto abituguru3_probe_error;\n\tfor (i = 0; i < ARRAY_SIZE(abituguru3_sysfs_attr); i++)\n\t\tif (device_create_file(&pdev->dev,\n\t\t\t\t&abituguru3_sysfs_attr[i].dev_attr))\n\t\t\tgoto abituguru3_probe_error;\n\n\tdata->hwmon_dev = hwmon_device_register(&pdev->dev);\n\tif (IS_ERR(data->hwmon_dev)) {\n\t\tres = PTR_ERR(data->hwmon_dev);\n\t\tgoto abituguru3_probe_error;\n\t}\n\n\treturn 0;  \n\nabituguru3_probe_error:\n\tfor (i = 0; data->sysfs_attr[i].dev_attr.attr.name; i++)\n\t\tdevice_remove_file(&pdev->dev, &data->sysfs_attr[i].dev_attr);\n\tfor (i = 0; i < ARRAY_SIZE(abituguru3_sysfs_attr); i++)\n\t\tdevice_remove_file(&pdev->dev,\n\t\t\t&abituguru3_sysfs_attr[i].dev_attr);\n\treturn res;\n}\n\nstatic int abituguru3_remove(struct platform_device *pdev)\n{\n\tint i;\n\tstruct abituguru3_data *data = platform_get_drvdata(pdev);\n\n\thwmon_device_unregister(data->hwmon_dev);\n\tfor (i = 0; data->sysfs_attr[i].dev_attr.attr.name; i++)\n\t\tdevice_remove_file(&pdev->dev, &data->sysfs_attr[i].dev_attr);\n\tfor (i = 0; i < ARRAY_SIZE(abituguru3_sysfs_attr); i++)\n\t\tdevice_remove_file(&pdev->dev,\n\t\t\t&abituguru3_sysfs_attr[i].dev_attr);\n\treturn 0;\n}\n\nstatic struct abituguru3_data *abituguru3_update_device(struct device *dev)\n{\n\tint i;\n\tstruct abituguru3_data *data = dev_get_drvdata(dev);\n\n\tmutex_lock(&data->update_lock);\n\tif (!data->valid || time_after(jiffies, data->last_updated + HZ)) {\n\t\t \n\t\tdata->valid = false;\n\t\t \n\t\tif (abituguru3_read_increment_offset(data,\n\t\t\t\tABIT_UGURU3_SETTINGS_BANK,\n\t\t\t\tABIT_UGURU3_ALARMS_START,\n\t\t\t\t1, data->alarms, 48/8) != (48/8))\n\t\t\tgoto LEAVE_UPDATE;\n\t\t \n\t\tfor (i = 0; i < 32; i++) {\n\t\t\tif (abituguru3_read(data, ABIT_UGURU3_SENSORS_BANK,\n\t\t\t\t\tABIT_UGURU3_VALUES_START + i,\n\t\t\t\t\t1, &data->value[i]) != 1)\n\t\t\t\tgoto LEAVE_UPDATE;\n\t\t\tif (abituguru3_read_increment_offset(data,\n\t\t\t\t\tABIT_UGURU3_SETTINGS_BANK,\n\t\t\t\t\tABIT_UGURU3_SETTINGS_START + i * 3,\n\t\t\t\t\t1,\n\t\t\t\t\tdata->settings[i], 3) != 3)\n\t\t\t\tgoto LEAVE_UPDATE;\n\t\t}\n\t\t \n\t\tfor (i = 0; i < 16; i++) {\n\t\t\tif (abituguru3_read(data, ABIT_UGURU3_SENSORS_BANK,\n\t\t\t\t\tABIT_UGURU3_VALUES_START + 32 + i,\n\t\t\t\t\t1, &data->value[32 + i]) != 1)\n\t\t\t\tgoto LEAVE_UPDATE;\n\t\t\tif (abituguru3_read_increment_offset(data,\n\t\t\t\t\tABIT_UGURU3_SETTINGS_BANK,\n\t\t\t\t\tABIT_UGURU3_SETTINGS_START + 32 * 3 +\n\t\t\t\t\t\ti * 2, 1,\n\t\t\t\t\tdata->settings[32 + i], 2) != 2)\n\t\t\t\tgoto LEAVE_UPDATE;\n\t\t}\n\t\tdata->last_updated = jiffies;\n\t\tdata->valid = true;\n\t}\nLEAVE_UPDATE:\n\tmutex_unlock(&data->update_lock);\n\tif (data->valid)\n\t\treturn data;\n\telse\n\t\treturn NULL;\n}\n\nstatic int abituguru3_suspend(struct device *dev)\n{\n\tstruct abituguru3_data *data = dev_get_drvdata(dev);\n\t \n\tmutex_lock(&data->update_lock);\n\treturn 0;\n}\n\nstatic int abituguru3_resume(struct device *dev)\n{\n\tstruct abituguru3_data *data = dev_get_drvdata(dev);\n\tmutex_unlock(&data->update_lock);\n\treturn 0;\n}\n\nstatic DEFINE_SIMPLE_DEV_PM_OPS(abituguru3_pm, abituguru3_suspend, abituguru3_resume);\n\nstatic struct platform_driver abituguru3_driver = {\n\t.driver = {\n\t\t.name\t= ABIT_UGURU3_NAME,\n\t\t.pm\t= pm_sleep_ptr(&abituguru3_pm),\n\t},\n\t.probe\t= abituguru3_probe,\n\t.remove\t= abituguru3_remove,\n};\n\nstatic int __init abituguru3_dmi_detect(void)\n{\n\tconst char *board_vendor, *board_name;\n\tint i, err = (force) ? 1 : -ENODEV;\n\tconst char *const *dmi_name;\n\tsize_t sublen;\n\n\tboard_vendor = dmi_get_system_info(DMI_BOARD_VENDOR);\n\tif (!board_vendor || strcmp(board_vendor, \"http://www.abit.com.tw/\"))\n\t\treturn err;\n\n\tboard_name = dmi_get_system_info(DMI_BOARD_NAME);\n\tif (!board_name)\n\t\treturn err;\n\n\t \n\tsublen = strcspn(board_name, \"(\");\n\twhile (sublen > 0 && board_name[sublen - 1] == ' ')\n\t\tsublen--;\n\n\tfor (i = 0; abituguru3_motherboards[i].id; i++) {\n\t\tdmi_name = abituguru3_motherboards[i].dmi_name;\n\t\tfor ( ; *dmi_name; dmi_name++) {\n\t\t\tif (strlen(*dmi_name) != sublen)\n\t\t\t\tcontinue;\n\t\t\tif (!strncasecmp(board_name, *dmi_name, sublen))\n\t\t\t\treturn 0;\n\t\t}\n\t}\n\n\t \n\treturn 1;\n}\n\n \n\nstatic int __init abituguru3_detect(void)\n{\n\t \n\tu8 data_val = inb_p(ABIT_UGURU3_BASE + ABIT_UGURU3_DATA);\n\tu8 cmd_val = inb_p(ABIT_UGURU3_BASE + ABIT_UGURU3_CMD);\n\tif (((data_val == 0x00) || (data_val == 0x08)) &&\n\t\t\t((cmd_val == 0xAC) || (cmd_val == 0x05) ||\n\t\t\t (cmd_val == 0x55)))\n\t\treturn 0;\n\n\tABIT_UGURU3_DEBUG(\"no Abit uGuru3 found, data = 0x%02X, cmd = \"\n\t\t\"0x%02X\\n\", (unsigned int)data_val, (unsigned int)cmd_val);\n\n\tif (force) {\n\t\tpr_info(\"Assuming Abit uGuru3 is present because of \\\"force\\\" parameter\\n\");\n\t\treturn 0;\n\t}\n\n\t \n\treturn -ENODEV;\n}\n\nstatic struct platform_device *abituguru3_pdev;\n\nstatic int __init abituguru3_init(void)\n{\n\tstruct resource res = { .flags = IORESOURCE_IO };\n\tint err;\n\n\t \n\terr = abituguru3_dmi_detect();\n\tif (err < 0)\n\t\treturn err;\n\n\t \n\tif (err > 0) {\n\t\terr = abituguru3_detect();\n\t\tif (err)\n\t\t\treturn err;\n\n\t\tpr_warn(\"this motherboard was not detected using DMI. \"\n\t\t\t\"Please send the output of \\\"dmidecode\\\" to the abituguru3 maintainer (see MAINTAINERS)\\n\");\n\t}\n\n\terr = platform_driver_register(&abituguru3_driver);\n\tif (err)\n\t\tgoto exit;\n\n\tabituguru3_pdev = platform_device_alloc(ABIT_UGURU3_NAME,\n\t\t\t\t\t\tABIT_UGURU3_BASE);\n\tif (!abituguru3_pdev) {\n\t\tpr_err(\"Device allocation failed\\n\");\n\t\terr = -ENOMEM;\n\t\tgoto exit_driver_unregister;\n\t}\n\n\tres.start = ABIT_UGURU3_BASE;\n\tres.end = ABIT_UGURU3_BASE + ABIT_UGURU3_REGION_LENGTH - 1;\n\tres.name = ABIT_UGURU3_NAME;\n\n\terr = platform_device_add_resources(abituguru3_pdev, &res, 1);\n\tif (err) {\n\t\tpr_err(\"Device resource addition failed (%d)\\n\", err);\n\t\tgoto exit_device_put;\n\t}\n\n\terr = platform_device_add(abituguru3_pdev);\n\tif (err) {\n\t\tpr_err(\"Device addition failed (%d)\\n\", err);\n\t\tgoto exit_device_put;\n\t}\n\n\treturn 0;\n\nexit_device_put:\n\tplatform_device_put(abituguru3_pdev);\nexit_driver_unregister:\n\tplatform_driver_unregister(&abituguru3_driver);\nexit:\n\treturn err;\n}\n\nstatic void __exit abituguru3_exit(void)\n{\n\tplatform_device_unregister(abituguru3_pdev);\n\tplatform_driver_unregister(&abituguru3_driver);\n}\n\nMODULE_AUTHOR(\"Hans de Goede <hdegoede@redhat.com>\");\nMODULE_DESCRIPTION(\"Abit uGuru3 Sensor device\");\nMODULE_LICENSE(\"GPL\");\n\nmodule_init(abituguru3_init);\nmodule_exit(abituguru3_exit);\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}