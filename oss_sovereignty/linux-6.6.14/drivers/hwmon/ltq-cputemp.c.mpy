{
  "module_name": "ltq-cputemp.c",
  "hash_id": "f3f7ec6be235f3719d3581ec3f4628e632838427b1749f739683ff61c684b9b2",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/ltq-cputemp.c",
  "human_readable_source": "\n \n\n#include <linux/bitops.h>\n#include <linux/delay.h>\n#include <linux/hwmon.h>\n#include <linux/hwmon-sysfs.h>\n#include <linux/init.h>\n#include <linux/mod_devicetable.h>\n#include <linux/module.h>\n#include <linux/platform_device.h>\n\n#include <lantiq_soc.h>\n\n \n#define CGU_GPHY1_CR   0x0040\n#define CGU_TEMP_PD    BIT(19)\n\nstatic void ltq_cputemp_enable(void)\n{\n\tltq_cgu_w32(ltq_cgu_r32(CGU_GPHY1_CR) | CGU_TEMP_PD, CGU_GPHY1_CR);\n}\n\nstatic void ltq_cputemp_disable(void *data)\n{\n\tltq_cgu_w32(ltq_cgu_r32(CGU_GPHY1_CR) & ~CGU_TEMP_PD, CGU_GPHY1_CR);\n}\n\nstatic int ltq_read(struct device *dev, enum hwmon_sensor_types type,\n\t\t    u32 attr, int channel, long *temp)\n{\n\tint value;\n\n\tswitch (attr) {\n\tcase hwmon_temp_input:\n\t\t \n\t\tvalue = (ltq_cgu_r32(CGU_GPHY1_CR) >> 9) & 0x01FF;\n\t\tvalue = value * 5;\n\t\t \n\t\tvalue -= 380;\n\t\t \n\t\tvalue = value * 100;\n\t\tbreak;\n\tdefault:\n\t\treturn -EOPNOTSUPP;\n\t}\n\n\t*temp = value;\n\treturn 0;\n}\n\nstatic umode_t ltq_is_visible(const void *_data, enum hwmon_sensor_types type,\n\t\t\t      u32 attr, int channel)\n{\n\tif (type != hwmon_temp)\n\t\treturn 0;\n\n\tswitch (attr) {\n\tcase hwmon_temp_input:\n\t\treturn 0444;\n\tdefault:\n\t\treturn 0;\n\t}\n}\n\nstatic const struct hwmon_channel_info * const ltq_info[] = {\n\tHWMON_CHANNEL_INFO(chip,\n\t\t\t   HWMON_C_REGISTER_TZ),\n\tHWMON_CHANNEL_INFO(temp,\n\t\t\t   HWMON_T_INPUT),\n\tNULL\n};\n\nstatic const struct hwmon_ops ltq_hwmon_ops = {\n\t.is_visible = ltq_is_visible,\n\t.read = ltq_read,\n};\n\nstatic const struct hwmon_chip_info ltq_chip_info = {\n\t.ops = &ltq_hwmon_ops,\n\t.info = ltq_info,\n};\n\nstatic int ltq_cputemp_probe(struct platform_device *pdev)\n{\n\tstruct device *hwmon_dev;\n\tint err = 0;\n\n\t \n\tif (ltq_soc_type() != SOC_TYPE_VR9_2)\n\t\treturn -ENODEV;\n\n\terr = devm_add_action(&pdev->dev, ltq_cputemp_disable, NULL);\n\tif (err)\n\t\treturn err;\n\n\tltq_cputemp_enable();\n\n\thwmon_dev = devm_hwmon_device_register_with_info(&pdev->dev,\n\t\t\t\t\t\t\t \"ltq_cputemp\",\n\t\t\t\t\t\t\t NULL,\n\t\t\t\t\t\t\t &ltq_chip_info,\n\t\t\t\t\t\t\t NULL);\n\n\tif (IS_ERR(hwmon_dev)) {\n\t\tdev_err(&pdev->dev, \"Failed to register as hwmon device\");\n\t\treturn PTR_ERR(hwmon_dev);\n\t}\n\n\treturn 0;\n}\n\nconst struct of_device_id ltq_cputemp_match[] = {\n\t{ .compatible = \"lantiq,cputemp\" },\n\t{},\n};\nMODULE_DEVICE_TABLE(of, ltq_cputemp_match);\n\nstatic struct platform_driver ltq_cputemp_driver = {\n\t.probe = ltq_cputemp_probe,\n\t.driver = {\n\t\t.name = \"ltq-cputemp\",\n\t\t.of_match_table = ltq_cputemp_match,\n\t},\n};\n\nmodule_platform_driver(ltq_cputemp_driver);\n\nMODULE_AUTHOR(\"Florian Eckert <fe@dev.tdt.de>\");\nMODULE_DESCRIPTION(\"Lantiq cpu temperature sensor driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}