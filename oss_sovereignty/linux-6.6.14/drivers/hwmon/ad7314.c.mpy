{
  "module_name": "ad7314.c",
  "hash_id": "5030bb2297da2ff97712ff7b98b8ace5d7ee289a8d38546e0a2deb91f9b26939",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/ad7314.c",
  "human_readable_source": "\n \n#include <linux/device.h>\n#include <linux/kernel.h>\n#include <linux/slab.h>\n#include <linux/sysfs.h>\n#include <linux/spi/spi.h>\n#include <linux/module.h>\n#include <linux/err.h>\n#include <linux/hwmon.h>\n#include <linux/hwmon-sysfs.h>\n#include <linux/bitops.h>\n\n \n#define AD7314_TEMP_MASK\t\t0x7FE0\n#define AD7314_TEMP_SHIFT\t\t5\n\n \n#define ADT7301_TEMP_MASK\t\t0x3FFF\n\nenum ad7314_variant {\n\tadt7301,\n\tadt7302,\n\tad7314,\n};\n\nstruct ad7314_data {\n\tstruct spi_device\t*spi_dev;\n\tu16 rx ____cacheline_aligned;\n};\n\nstatic int ad7314_spi_read(struct ad7314_data *chip)\n{\n\tint ret;\n\n\tret = spi_read(chip->spi_dev, (u8 *)&chip->rx, sizeof(chip->rx));\n\tif (ret < 0) {\n\t\tdev_err(&chip->spi_dev->dev, \"SPI read error\\n\");\n\t\treturn ret;\n\t}\n\n\treturn be16_to_cpu(chip->rx);\n}\n\nstatic ssize_t ad7314_temperature_show(struct device *dev,\n\t\t\t\t       struct device_attribute *attr,\n\t\t\t\t       char *buf)\n{\n\tstruct ad7314_data *chip = dev_get_drvdata(dev);\n\ts16 data;\n\tint ret;\n\n\tret = ad7314_spi_read(chip);\n\tif (ret < 0)\n\t\treturn ret;\n\tswitch (spi_get_device_id(chip->spi_dev)->driver_data) {\n\tcase ad7314:\n\t\tdata = (ret & AD7314_TEMP_MASK) >> AD7314_TEMP_SHIFT;\n\t\tdata = sign_extend32(data, 9);\n\n\t\treturn sprintf(buf, \"%d\\n\", 250 * data);\n\tcase adt7301:\n\tcase adt7302:\n\t\t \n\t\tdata = ret & ADT7301_TEMP_MASK;\n\t\tdata = sign_extend32(data, 13);\n\n\t\treturn sprintf(buf, \"%d\\n\",\n\t\t\t       DIV_ROUND_CLOSEST(data * 3125, 100));\n\tdefault:\n\t\treturn -EINVAL;\n\t}\n}\n\nstatic SENSOR_DEVICE_ATTR_RO(temp1_input, ad7314_temperature, 0);\n\nstatic struct attribute *ad7314_attrs[] = {\n\t&sensor_dev_attr_temp1_input.dev_attr.attr,\n\tNULL,\n};\n\nATTRIBUTE_GROUPS(ad7314);\n\nstatic int ad7314_probe(struct spi_device *spi_dev)\n{\n\tstruct ad7314_data *chip;\n\tstruct device *hwmon_dev;\n\n\tchip = devm_kzalloc(&spi_dev->dev, sizeof(*chip), GFP_KERNEL);\n\tif (chip == NULL)\n\t\treturn -ENOMEM;\n\n\tchip->spi_dev = spi_dev;\n\thwmon_dev = devm_hwmon_device_register_with_groups(&spi_dev->dev,\n\t\t\t\t\t\t\t   spi_dev->modalias,\n\t\t\t\t\t\t\t   chip, ad7314_groups);\n\treturn PTR_ERR_OR_ZERO(hwmon_dev);\n}\n\nstatic const struct spi_device_id ad7314_id[] = {\n\t{ \"adt7301\", adt7301 },\n\t{ \"adt7302\", adt7302 },\n\t{ \"ad7314\", ad7314 },\n\t{ }\n};\nMODULE_DEVICE_TABLE(spi, ad7314_id);\n\nstatic struct spi_driver ad7314_driver = {\n\t.driver = {\n\t\t.name = \"ad7314\",\n\t},\n\t.probe = ad7314_probe,\n\t.id_table = ad7314_id,\n};\n\nmodule_spi_driver(ad7314_driver);\n\nMODULE_AUTHOR(\"Sonic Zhang <sonic.zhang@analog.com>\");\nMODULE_DESCRIPTION(\"Analog Devices AD7314, ADT7301 and ADT7302 digital temperature sensor driver\");\nMODULE_LICENSE(\"GPL v2\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}