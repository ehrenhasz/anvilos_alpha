{
  "module_name": "i5500_temp.c",
  "hash_id": "a917320c161dc2a9e76bb56b771b2a281d7b22ada5afab9a57875a5100eb9404",
  "original_prompt": "Ingested from linux-6.6.14/drivers/hwmon/i5500_temp.c",
  "human_readable_source": "\n \n\n#include <linux/bitops.h>\n#include <linux/module.h>\n#include <linux/init.h>\n#include <linux/slab.h>\n#include <linux/jiffies.h>\n#include <linux/device.h>\n#include <linux/pci.h>\n#include <linux/hwmon.h>\n#include <linux/err.h>\n#include <linux/mutex.h>\n\n \n#define REG_TSTHRCATA\t0xE2\n#define REG_TSCTRL\t0xE8\n#define REG_TSTHRRPEX\t0xEB\n#define REG_TSTHRLO\t0xEC\n#define REG_TSTHRHI\t0xEE\n#define REG_CTHINT\t0xF0\n#define REG_TSFSC\t0xF3\n#define REG_CTSTS\t0xF4\n#define REG_TSTHRRQPI\t0xF5\n#define REG_CTCTRL\t0xF7\n#define REG_TSTIMER\t0xF8\n\nstatic umode_t i5500_is_visible(const void *drvdata, enum hwmon_sensor_types type, u32 attr,\n\t\t\t\tint channel)\n{\n\treturn 0444;\n}\n\nstatic int i5500_read(struct device *dev, enum hwmon_sensor_types type, u32 attr, int channel,\n\t\t      long *val)\n{\n\tstruct pci_dev *pdev = to_pci_dev(dev->parent);\n\tu16 tsthr;\n\ts8 tsfsc;\n\tu8 ctsts;\n\n\tswitch (type) {\n\tcase hwmon_temp:\n\t\tswitch (attr) {\n\t\t \n\t\tcase hwmon_temp_input:\n\t\t\tpci_read_config_word(pdev, REG_TSTHRHI, &tsthr);\n\t\t\tpci_read_config_byte(pdev, REG_TSFSC, &tsfsc);\n\t\t\t*val = (tsthr - tsfsc) * 500;\n\t\t\treturn 0;\n\t\tcase hwmon_temp_max:\n\t\t\tpci_read_config_word(pdev, REG_TSTHRHI, &tsthr);\n\t\t\t*val = tsthr * 500;\n\t\t\treturn 0;\n\t\tcase hwmon_temp_max_hyst:\n\t\t\tpci_read_config_word(pdev, REG_TSTHRLO, &tsthr);\n\t\t\t*val = tsthr * 500;\n\t\t\treturn 0;\n\t\tcase hwmon_temp_crit:\n\t\t\tpci_read_config_word(pdev, REG_TSTHRCATA, &tsthr);\n\t\t\t*val = tsthr * 500;\n\t\t\treturn 0;\n\t\tcase hwmon_temp_max_alarm:\n\t\t\tpci_read_config_byte(pdev, REG_CTSTS, &ctsts);\n\t\t\t*val = !!(ctsts & BIT(1));\n\t\t\treturn 0;\n\t\tcase hwmon_temp_crit_alarm:\n\t\t\tpci_read_config_byte(pdev, REG_CTSTS, &ctsts);\n\t\t\t*val = !!(ctsts & BIT(0));\n\t\t\treturn 0;\n\t\tdefault:\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\tbreak;\n\t}\n\n\treturn -EOPNOTSUPP;\n}\n\nstatic const struct hwmon_ops i5500_ops = {\n\t.is_visible = i5500_is_visible,\n\t.read = i5500_read,\n};\n\nstatic const struct hwmon_channel_info * const i5500_info[] = {\n\tHWMON_CHANNEL_INFO(chip, HWMON_C_REGISTER_TZ),\n\tHWMON_CHANNEL_INFO(temp,\n\t\t\t   HWMON_T_INPUT | HWMON_T_MAX | HWMON_T_MAX_HYST | HWMON_T_CRIT |\n\t\t\t   HWMON_T_MAX_ALARM | HWMON_T_CRIT_ALARM\n\t\t\t   ),\n\tNULL\n};\n\nstatic const struct hwmon_chip_info i5500_chip_info = {\n\t.ops = &i5500_ops,\n\t.info = i5500_info,\n};\n\nstatic const struct pci_device_id i5500_temp_ids[] = {\n\t{ PCI_DEVICE(PCI_VENDOR_ID_INTEL, 0x3438) },\n\t{ 0 },\n};\n\nMODULE_DEVICE_TABLE(pci, i5500_temp_ids);\n\nstatic int i5500_temp_probe(struct pci_dev *pdev,\n\t\t\t    const struct pci_device_id *id)\n{\n\tint err;\n\tstruct device *hwmon_dev;\n\tu32 tstimer;\n\ts8 tsfsc;\n\n\terr = pcim_enable_device(pdev);\n\tif (err) {\n\t\tdev_err(&pdev->dev, \"Failed to enable device\\n\");\n\t\treturn err;\n\t}\n\n\tpci_read_config_byte(pdev, REG_TSFSC, &tsfsc);\n\tpci_read_config_dword(pdev, REG_TSTIMER, &tstimer);\n\tif (tsfsc == 0x7F && tstimer == 0x07D30D40) {\n\t\tdev_notice(&pdev->dev, \"Sensor seems to be disabled\\n\");\n\t\treturn -ENODEV;\n\t}\n\n\thwmon_dev = devm_hwmon_device_register_with_info(&pdev->dev, \"intel5500\", NULL,\n\t\t\t\t\t\t\t &i5500_chip_info, NULL);\n\treturn PTR_ERR_OR_ZERO(hwmon_dev);\n}\n\nstatic struct pci_driver i5500_temp_driver = {\n\t.name = \"i5500_temp\",\n\t.id_table = i5500_temp_ids,\n\t.probe = i5500_temp_probe,\n};\n\nmodule_pci_driver(i5500_temp_driver);\n\nMODULE_AUTHOR(\"Jean Delvare <jdelvare@suse.de>\");\nMODULE_DESCRIPTION(\"Intel 5500/5520/X58 chipset thermal sensor driver\");\nMODULE_LICENSE(\"GPL\");\n",
  "logic_map": {},
  "failure_modes": [],
  "crash_correlation_map": {}
}